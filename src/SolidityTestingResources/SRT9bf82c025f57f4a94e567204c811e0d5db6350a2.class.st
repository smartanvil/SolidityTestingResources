Class {
	#name : #SRT9bf82c025f57f4a94e567204c811e0d5db6350a2,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9bf82c025f57f4a94e567204c811e0d5db6350a2 >> base64 [
	^ 'Ly8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKLy8gVGhpcyBhcGkgaXMgY3VycmVudGx5IHRhcmdldGVkIGF0IDAuNC4xOCwgcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIG9yIG9yYWNsaXplQVBJXzAuNCB3aGVyZSBuZWNlc3NhcnkKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBPcmFjbGl6ZUkgewogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSBwdWJsaWMgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHB1YmxpYyByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChieXRlczMyKTsKfQoKY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KCmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgewogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCAqIDYwICogMjQ7CiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCAqIDYwICogMjQgKiA3OwogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwICogNjAgKiAyNCAqIDMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfQW5kcm9pZCA9IDB4MjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9MZWRnZXIgPSAweDMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTmF0aXZlID0gMHhGMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21haW5uZXQgPSAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfY29uc2Vuc3lzID0gMTYxOwoKICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7CgogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmICgoYWRkcmVzcyhPQVIpID09IDApIHx8IChnZXRDb2RlU2l6ZShhZGRyZXNzKE9BUikpID09IDApKQogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKCiAgICAgICAgaWYgKGFkZHJlc3Mob3JhY2xpemUpICE9IE9BUi5nZXRBZGRyZXNzKCkpCiAgICAgICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwoKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICByZXR1cm4gb3JhY2xpemVfc2V0TmV0d29yaygpOwogICAgICAgIG5ldHdvcmtJRDsKICAgICAgICAvLyBzaWxlbmNlIHRoZSB3YXJuaW5nIGFuZCByZW1haW4gYmFja3dhcmRzIGNvbXBhdGlibGUKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCkgPiAwKSB7Ly9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpID4gMCkgey8vcm9wc3RlbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JvcHN0ZW4zIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKSA+IDApIHsvL2tvdmFuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpID4gMCkgey8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpID4gMCkgey8vZXRoZXJldW0tYnJpZGdlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRikgPiAwKSB7Ly9ldGhlci5jYW1wIGlkZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpID4gMCkgey8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgcHVibGljIHsKICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHB1YmxpYyB7CiAgICAgICAgcmV0dXJuOwogICAgICAgIG15aWQ7CiAgICAgICAgcmVzdWx0OwogICAgICAgIHByb29mOwogICAgICAgIC8vIFNpbGVuY2UgY29tcGlsZXIgd2FybmluZ3MKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIDIwMDAwMCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIDIwMDAwMCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UodWludCBnYXNQcmljZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUucmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9zaXplKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYnJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpICYmIChicmVzdWx0W2ldIDw9IDU3KSkgewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGVsc2UgX2ItLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7CiAgICAgICAgICAgICAgICBtaW50ICs9IHVpbnQoYnJlc3VsdFtpXSkgLSA0ODsKICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChfYiA+IDApIG1pbnQgKj0gMTAgKiogX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlcykgewogICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkgLyAyMyArIDM7CiAgICAgICAgICAgIC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgfQogICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgY3RyKys7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgIGN0cisrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhMmNib3IoYnl0ZXNbXSBhcnIpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpIC8gMjMgKyAzOwogICAgICAgICAgICAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgIH0KICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgIGN0cisrOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICBjdHIrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KCgogICAgc3RyaW5nIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZShzdHJpbmcgX25ldHdvcmtfbmFtZSkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX25ldHdvcmtfbmFtZSA9IF9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfbmV3UmFuZG9tRFNRdWVyeSh1aW50IF9kZWxheSwgdWludCBfbmJ5dGVzLCB1aW50IF9jdXN0b21HYXNMaW1pdCkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7CiAgICAgICAgcmVxdWlyZSgoX25ieXRlcyA+IDApICYmIChfbmJ5dGVzIDw9IDMyKSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG5ieXRlcyA9IG5ldyBieXRlcygxKTsKICAgICAgICBuYnl0ZXNbMF0gPSBieXRlKF9uYnl0ZXMpOwogICAgICAgIGJ5dGVzIG1lbW9yeSB1bm9uY2UgPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uS2V5SGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uS2V5SGFzaF9ieXRlczMyID0gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG1zdG9yZSh1bm9uY2UsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQodW5vbmNlLCAweDIwKSwgeG9yKGJsb2NraGFzaChzdWIobnVtYmVyLCAxKSksIHhvcihjb2luYmFzZSwgdGltZXN0YW1wKSkpCiAgICAgICAgICAgIG1zdG9yZShzZXNzaW9uS2V5SGFzaCwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZChzZXNzaW9uS2V5SGFzaCwgMHgyMCksIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIpCiAgICAgICAgfQogICAgICAgIGJ5dGVzWzNdIG1lbW9yeSBhcmdzID0gW3Vub25jZSwgbmJ5dGVzLCBzZXNzaW9uS2V5SGFzaF07CiAgICAgICAgYnl0ZXMzMiBxdWVyeUlkID0gb3JhY2xpemVfcXVlcnkoX2RlbGF5LCAicmFuZG9tIiwgYXJncywgX2N1c3RvbUdhc0xpbWl0KTsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KHF1ZXJ5SWQsIGtlY2NhazI1NihieXRlczgoX2RlbGF5KSwgYXJnc1sxXSwgc2hhMjU2KGFyZ3NbMF0pLCBhcmdzWzJdKSk7CiAgICAgICAgcmV0dXJuIHF1ZXJ5SWQ7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzMzIgY29tbWl0bWVudCkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPSBjb21taXRtZW50OwogICAgfQoKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBieXRlczMyKSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzOwogICAgbWFwcGluZyhieXRlczMyID0+IGJvb2wpIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkOwoKICAgIGZ1bmN0aW9uIHZlcmlmeVNpZyhieXRlczMyIHRvc2lnbmgsIGJ5dGVzIGRlcnNpZywgYnl0ZXMgcHVia2V5KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIHNpZ29rOwogICAgICAgIGFkZHJlc3Mgc2lnbmVyOwoKICAgICAgICBieXRlczMyIHNpZ3I7CiAgICAgICAgYnl0ZXMzMiBzaWdzOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lncl8gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIHVpbnQgb2Zmc2V0ID0gNCArICh1aW50KGRlcnNpZ1szXSkgLSAweDIwKTsKICAgICAgICBzaWdyXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCwgMzIsIHNpZ3JfLCAwKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2lnc18gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIG9mZnNldCArPSAzMiArIDI7CiAgICAgICAgc2lnc18gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQgKyAodWludChkZXJzaWdbb2Zmc2V0IC0gMV0pIC0gMHgyMCksIDMyLCBzaWdzXywgMCk7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2lnciA6PSBtbG9hZChhZGQoc2lncl8sIDMyKSkKICAgICAgICAgICAgc2lncyA6PSBtbG9hZChhZGQoc2lnc18sIDMyKSkKICAgICAgICB9CgoKICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjcsIHNpZ3IsIHNpZ3MpOwogICAgICAgIGlmIChhZGRyZXNzKGtlY2NhazI1NihwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjgsIHNpZ3IsIHNpZ3MpOwogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moa2VjY2FrMjU2KHB1YmtleSkpID09IHNpZ25lcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkoYnl0ZXMgcHJvb2YsIHVpbnQgc2lnMm9mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc2lnb2s7CgogICAgICAgIC8vIFN0ZXAgNjogdmVyaWZ5IHRoZSBhdHRlc3RhdGlvbiBzaWduYXR1cmUsIEFQUEtFWTEgbXVzdCBzaWduIHRoZSBzZXNzaW9uS2V5IGZyb20gdGhlIGNvcnJlY3QgbGVkZ2VyIGFwcCAoQ09ERUhBU0gpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzIgPSBuZXcgYnl0ZXModWludChwcm9vZltzaWcyb2Zmc2V0ICsgMV0pICsgMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LCBzaWcyLmxlbmd0aCwgc2lnMiwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzICsgMSwgNjQsIGFwcGtleTFfcHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSArIDY1ICsgMzIpOwogICAgICAgIHRvc2lnbjJbMF0gPSBieXRlKDEpOwogICAgICAgIC8vcm9sZQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCAtIDY1LCA2NSwgdG9zaWduMiwgMSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IENPREVIQVNIID0gaGV4ImZkOTRmYTcxYmMwYmExMGQzOWQ0NjRkMGQ4ZjQ2NWVmZWVmMGEyNzY0ZTM4ODdmY2M5ZGY0MWRlZDIwZjUwNWMiOwogICAgICAgIGNvcHlCeXRlcyhDT0RFSEFTSCwgMCwgMzIsIHRvc2lnbjIsIDEgKyA2NSk7CiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjIpLCBzaWcyLCBhcHBrZXkxX3B1YmtleSk7CgogICAgICAgIGlmIChzaWdvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA3OiB2ZXJpZnkgdGhlIEFQUEtFWTEgcHJvdmVuYW5jZSAobXVzdCBiZSBzaWduZWQgYnkgTGVkZ2VyKQogICAgICAgIGJ5dGVzIG1lbW9yeSBMRURHRVJLRVkgPSBoZXgiN2ZiOTU2NDY5YzVjOWI4OTg0MGQ1NWI0MzUzN2U2NmE5OGRkNDgxMWVhMGEyNzIyNDI3MmMyZTU2MjI5MTFlODUzN2EyZjhlODZhNDZiYWVjODI4NjRlOThkZDAxZTljY2MyZjhiYzVkZmM5Y2JlNWE5MWEyOTA0OThkZDk2ZTQiOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMyA9IG5ldyBieXRlcygxICsgNjUpOwogICAgICAgIHRvc2lnbjNbMF0gPSAweEZFOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMywgNjUsIHRvc2lnbjMsIDEpOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMyA9IG5ldyBieXRlcyh1aW50KHByb29mWzMgKyA2NSArIDFdKSArIDIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMyArIDY1LCBzaWczLmxlbmd0aCwgc2lnMywgMCk7CgogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24zKSwgc2lnMywgTEVER0VSS0VZKTsKCiAgICAgICAgcmV0dXJuIHNpZ29rOwogICAgfQoKICAgIG1vZGlmaWVyIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5KGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIHsKICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQogICAgICAgIHJlcXVpcmUoKF9wcm9vZlswXSA9PSAiTCIpICYmIChfcHJvb2ZbMV0gPT0gIlAiKSAmJiAoX3Byb29mWzJdID09IDEpKTsKCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOwogICAgICAgIHJlcXVpcmUocHJvb2ZWZXJpZmllZCk7CgogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3JldHVybkNvZGUoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgaW50ZXJuYWwgcmV0dXJucyAodWludDgpewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgaWYgKChfcHJvb2ZbMF0gIT0gIkwiKSB8fCAoX3Byb29mWzFdICE9ICJQIikgfHwgKF9wcm9vZlsyXSAhPSAxKSkgcmV0dXJuIDE7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgcmV0dXJuIDI7CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoQnl0ZXMzMlByZWZpeChieXRlczMyIGNvbnRlbnQsIGJ5dGVzIHByZWZpeCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIG1hdGNoXyA9IHRydWU7CgogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IHByZWZpeC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoY29udGVudFtpXSAhPSBwcmVmaXhbaV0pIG1hdGNoXyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1hdGNoXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihieXRlcyBwcm9vZiwgYnl0ZXMzMiBxdWVyeUlkLCBieXRlcyByZXN1bHQsIHN0cmluZyBjb250ZXh0X25hbWUpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgY2hlY2tvazsKCgogICAgICAgIC8vIFN0ZXAgMjogdGhlIHVuaXF1ZSBrZXloYXNoIGhhcyB0byBtYXRjaCB3aXRoIHRoZSBzaGEyNTYgb2YgKGNvbnRleHQgbmFtZSArIHF1ZXJ5SWQpCiAgICAgICAgdWludCBsZWRnZXJQcm9vZkxlbmd0aCA9IDMgKyA2NSArICh1aW50KHByb29mWzMgKyA2NSArIDFdKSArIDIpICsgMzI7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGtleWhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgsIDMyLCBrZXloYXNoLCAwKTsKICAgICAgICBjaGVja29rID0gKGtlY2NhazI1NihrZXloYXNoKSA9PSBrZWNjYWsyNTYoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoICsgKDMyICsgOCArIDEgKyAzMikgKyAxXSkgKyAyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoICsgKDMyICsgOCArIDEgKyAzMiksIHNpZzEubGVuZ3RoLCBzaWcxLCAwKTsKCgogICAgICAgIC8vIFN0ZXAgMzogd2UgYXNzdW1lIHNpZzEgaXMgdmFsaWQgKGl0IHdpbGwgYmUgdmVyaWZpZWQgZHVyaW5nIHN0ZXAgNSkgYW5kIHdlIHZlcmlmeSBpZiAncmVzdWx0JyBpcyB0aGUgcHJlZml4IG9mIHNoYTI1NihzaWcxKQogICAgICAgIGNoZWNrb2sgPSBtYXRjaEJ5dGVzMzJQcmVmaXgoc2hhMjU2KHNpZzEpLCByZXN1bHQpOwogICAgICAgIGlmIChjaGVja29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDQ6IGNvbW1pdG1lbnQgbWF0Y2ggdmVyaWZpY2F0aW9uLCBrZWNjYWsyNTYoZGVsYXksIG5ieXRlcywgdW5vbmNlLCBzZXNzaW9uS2V5SGFzaCkgPT0gY29tbWl0bWVudCBpbiBzdG9yYWdlLgogICAgICAgIC8vIFRoaXMgaXMgdG8gdmVyaWZ5IHRoYXQgdGhlIGNvbXB1dGVkIGFyZ3MgbWF0Y2ggd2l0aCB0aGUgb25lcyBzcGVjaWZpZWQgaW4gdGhlIHF1ZXJ5LgogICAgICAgIGJ5dGVzIG1lbW9yeSBjb21taXRtZW50U2xpY2UxID0gbmV3IGJ5dGVzKDggKyAxICsgMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGggKyAzMiwgOCArIDEgKyAzMiwgY29tbWl0bWVudFNsaWNlMSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uUHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICB1aW50IHNpZzJvZmZzZXQgPSBsZWRnZXJQcm9vZkxlbmd0aCArIDMyICsgKDggKyAxICsgMzIpICsgc2lnMS5sZW5ndGggKyA2NTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQgLSA2NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOwoKICAgICAgICBieXRlczMyIHNlc3Npb25QdWJrZXlIYXNoID0gc2hhMjU2KHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID09IGtlY2NhazI1Nihjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpIHsvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA1OiB2YWxpZGl0eSB2ZXJpZmljYXRpb24gZm9yIHNpZzEgKGtleWhhc2ggYW5kIGFyZ3Mgc2lnbmVkIHdpdGggdGhlIHNlc3Npb25LZXkpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjEgPSBuZXcgYnl0ZXMoMzIgKyA4ICsgMSArIDMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMiArIDggKyAxICsgMzIsIHRvc2lnbjEsIDApOwogICAgICAgIGNoZWNrb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjEpLCBzaWcxLCBzZXNzaW9uUHVia2V5KTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB2ZXJpZnkgaWYgc2Vzc2lvblB1YmtleUhhc2ggd2FzIHZlcmlmaWVkIGFscmVhZHksIGlmIG5vdC4uIGxldCdzIGRvIGl0IQogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPT0gZmFsc2UpIHsKICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdOwogICAgfQoKCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gY29weUJ5dGVzKGJ5dGVzIGZyb20sIHVpbnQgZnJvbU9mZnNldCwgdWludCBsZW5ndGgsIGJ5dGVzIHRvLCB1aW50IHRvT2Zmc2V0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbAogICAgICAgIHJlcXVpcmUodG8ubGVuZ3RoID49IG1pbkxlbmd0aCk7CiAgICAgICAgLy8gU2hvdWxkIGJlIGEgYmV0dGVyIHdheT8KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgdG1wIDo9IG1sb2FkKGFkZChmcm9tLCBpKSkKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgLy8gRHVwbGljYXRlIFNvbGlkaXR5J3MgZWNyZWNvdmVyLCBidXQgY2F0Y2hpbmcgdGhlIENBTEwgcmV0dXJuIHZhbHVlCiAgICBmdW5jdGlvbiBzYWZlcl9lY3JlY292ZXIoYnl0ZXMzMiBoYXNoLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgewogICAgICAgIGJvb2wgcmV0OwogICAgICAgIGFkZHJlc3MgYWRkcjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc2l6ZSA6PSBtbG9hZCgweDQwKQogICAgICAgICAgICBtc3RvcmUoc2l6ZSwgaGFzaCkKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCAzMiksIHYpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgNjQpLCByKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDk2KSwgcykKCiAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgIC8vICAgICAgIHRoZSByZXR1cm4gY29kZQogICAgICAgICAgICByZXQgOj0gY2FsbCgzMDAwLCAxLCAwLCBzaXplLCAxMjgsIHNpemUsIDMyKQogICAgICAgICAgICBhZGRyIDo9IG1sb2FkKHNpemUpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgLy8gVGhlIHNpZ25hdHVyZSBmb3JtYXQgaXMgYSBjb21wYWN0IGZvcm0gb2Y6CiAgICAgICAgLy8gICB7Ynl0ZXMzMiByfXtieXRlczMyIHN9e3VpbnQ4IHZ9CiAgICAgICAgLy8gQ29tcGFjdCBtZWFucywgdWludDggaXMgbm90IHBhZGRlZCB0byAzMiBieXRlcy4KICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHIgOj0gbWxvYWQoYWRkKHNpZywgMzIpKQogICAgICAgICAgICBzIDo9IG1sb2FkKGFkZChzaWcsIDY0KSkKCiAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAvLyBUaGVyZSBpcyBubyAnbWxvYWQ4JyB0byBkbyB0aGlzLCBidXQgdGhhdCB3b3VsZCBiZSBuaWNlci4KICAgICAgICAgICAgdiA6PSBieXRlKDAsIG1sb2FkKGFkZChzaWcsIDk2KSkpCgogICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOgogICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cwogICAgICAgIC8vIHVzZSB0aGUgc2Vjb25kIGJlc3Qgb3B0aW9uLCAnYW5kJwogICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkKICAgICAgICB9CgogICAgICAgIC8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAogICAgICAgIC8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQogICAgICAgIC8vCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwogICAgICAgIGlmICh2IDwgMjcpCiAgICAgICAgICAgIHYgKz0gMjc7CgogICAgICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICByZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwogICAgfQoKfQovLyA8L09SQUNMSVpFX0FQST4KCgovKgogKiBAdGl0bGUgU3RyaW5nICYgc2xpY2UgdXRpbGl0eSBsaWJyYXJ5IGZvciBTb2xpZGl0eSBjb250cmFjdHMuCiAqIEBhdXRob3IgTmljayBKb2huc29uIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNTEzMDIzMzAzMjM5M2YzODM1MTEzZjNlMjUzNTNlMjU3ZjNmMzQyNSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTQ7CgpsaWJyYXJ5IHN0cmluZ3MgewogICAgc3RydWN0IHNsaWNlIHsKICAgICAgICB1aW50IF9sZW47CiAgICAgICAgdWludCBfcHRyOwogICAgfQoKICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IgKDsgbGVuID49IDMyOyBsZW4gLT0gMzIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG1sb2FkKHNyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVzdCArPSAzMjsKICAgICAgICAgICAgc3JjICs9IDMyOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKICAgICAgICB1aW50IG1hc2sgPSAyNTYgKiogKDMyIC0gbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQogICAgICAgICAgICBsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKGRlc3QpLCBtYXNrKQogICAgICAgICAgICBtc3RvcmUoZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0b1NsaWNlKHN0cmluZyBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmLCAweDIwKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2xpY2UoYnl0ZXMoc2VsZikubGVuZ3RoLCBwdHIpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjb3B5KHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgcmV0dXJuIHNsaWNlKHNlbGYuX2xlbiwgc2VsZi5fcHRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b1N0cmluZyhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHtyZXRwdHIgOj0gYWRkKHJldCwgMzIpfQoKICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmV5b25kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICBib29sIGVxdWFsID0gdHJ1ZTsKICAgICAgICBpZiAoc2VsZi5fcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW5ndGggOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuZ3RoKSwgc2hhMyhuZWVkbGVwdHIsIGxlbmd0aCkpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcXVhbCkgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBuZWVkbGUuX2xlbjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzZWxmOwogICAgfQoKICAgIGZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW5ndGggOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKGtlY2NhazI1NihzZWxmcHRyLCBsZW5ndGgpLCBrZWNjYWsyNTYobmVlZGxlcHRyLCBsZW5ndGgpKQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXF1YWwpIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIGZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CiAgICAgICAgdWludCBpZHg7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY4IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBsZXQgZW5kIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGxvb3AgOgogICAgICAgICAgICAgICAgICAgIGp1bXBpKGV4aXQsIGVxKGFuZChtbG9hZChwdHIpLCBtYXNrKSwgbmVlZGxlZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChwdHIsIDEpCiAgICAgICAgICAgICAgICAgICAganVtcGkobG9vcCwgbHQoc3ViKHB0ciwgMSksIGVuZCkpCiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmcHRyLCBzZWxmbGVuKQogICAgICAgICAgICAgICAgICAgIGV4aXQgOgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7aGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKX0KICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHI7CiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkge3Rlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pfQogICAgICAgICAgICAgICAgICAgIGlmIChoYXNoID09IHRlc3RIYXNoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHRyOwogICAgICAgICAgICAgICAgICAgIHB0ciArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxmcHRyICsgc2VsZmxlbjsKICAgIH0KCiAgICBmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICB0b2tlbi5fcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHRva2VuLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7CiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgLy8gTm90IGZvdW5kCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyID0gcHRyICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b2tlbjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgewogICAgICAgIHNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwogICAgfQp9Cgpjb250cmFjdCBDcnlwdG9Mb3R0byBpcyB1c2luZ09yYWNsaXplIHsKICAgIHVzaW5nIHN0cmluZ3MgZm9yICo7CgogICAgYWRkcmVzcyBPd25lcjsKCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBsb3R0b1ByaWNlID0gMTAgZmlubmV5OwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgZHVyYXRpb24gPSAxIGRheXM7CgogICAgdWludDggcHVibGljIGNvbnN0YW50IGxvdHRvTGVuZ3RoID0gNjsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBsb3R0b0xvd2VzdE51bWJlciA9IDE7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgbG90dG9IaWdoZXN0TnVtYmVyID0gMTU7CgogICAgdWludDggcHVibGljIGNvbnN0YW50IHNpeE1hdGNoUGF5b3V0SW5QZXJjZW50ID0gNzc7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgYm9udXNNYXRjaFBheW91dEluUGVyY2VudCA9IDExOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGZpdmVNYXRjaFBheW91dEluUGVyY2VudCA9IDExOwogICAgdWludDggcHVibGljIGNvbnN0YW50IG93bmVyU2hhcmVJblBlcmNlbnQgPSAxOwogICAgdWludDggcHVibGljIGNvbnN0YW50IG51bVR1cm5zVG9SZXZvbHZlID0gMTA7CgogICAgc3RyaW5nIGNvbnN0YW50IG9yYWNsaXplZFF1ZXJ5ID0gIlNvcnRbcmFuZG9tc2FtcGxlIFtyYW5nZSBbMSwgMTVdLCA3XV0sIHJhbmRvbXNhbXBsZSBbcmFuZ2UgWzAsIDZdLCAxXSI7CiAgICBzdHJpbmcgY29uc3RhbnQgb3JhY2xpemVkUXVlcnlTb3VyY2UgPSAiV29sZnJhbUFscGhhIjsKCiAgICBib29sIHB1YmxpYyBpc0xvdHRvU3RhcnRlZCA9IGZhbHNlOwogICAgdWludDMyIHB1YmxpYyB0dXJuID0gMDsKICAgIHVpbnQzMiBwdWJsaWMgZ2FzRm9yT3JhY2xpemVkUXVlcnkgPSA2MDAwMDA7CiAgICB1aW50MjU2IHB1YmxpYyByYWlzZWRBbW91bnQgPSAwOwoKICAgIHVpbnQ4W10gbG90dG9OdW1iZXJzID0gbmV3IHVpbnQ4W10obG90dG9MZW5ndGgpOwogICAgdWludDggYm9udXNOdW1iZXI7CiAgICBlbnVtIGxvdHRvUmFuayB7Tk9OQ0UsIEZJVkVfTUFUQ0gsIEJPTlVTX01BVENILCBTSVhfTUFUQ0gsIERFRkFVTFR9CiAgICB1aW50MjU2IHB1YmxpYyBmaW5pc2hXaGVuOwogICAgdWludDI1NltdIGJldHRpbmdzOwogICAgdWludDI1NltdIGFjY051bUJldHRpbmdzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludDMyID0+IHVpbnQ2NFtdKSkgdGlja2V0czsKCiAgICB1aW50MjU2W10gcHVibGljIHJhaXNlZEFtb3VudHM7CiAgICB1aW50MjU2W10gcHVibGljIHVudGFrZW5Qcml6ZUFtb3VudHM7CiAgICB1aW50MzJbXSBlbmNvZGVkTG90dG9SZXN1bHRzOwogICAgdWludDMyW10gbnVtRml2ZU1hdGNoV2lubmVyczsKICAgIHVpbnQzMltdIG51bUJvbnVzTWF0Y2hXaW5uZXJzOwogICAgdWludDMyW10gbnVtU2l4TWF0Y2hXaW5uZXJzOwogICAgdWludDMyW10gbm9uY2VzOwoKICAgIHVpbnQ2NFtdIHB1YmxpYyB0aW1lc3RhbXBzOwoKICAgIGJ5dGVzMzIgb3JhY2xlQ2FsbGJhY2tJZDsKCiAgICBldmVudCBMb3R0b1N0YXJ0KHVpbnQzMiB0dXJuKTsKICAgIGV2ZW50IEZ1bmRSYWlzZWQoYWRkcmVzcyBidXllciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiByYWlzZWRBbW91bnQpOwogICAgZXZlbnQgTG90dG9OdW1iZXJzQW5ub3VuY2VkKHVpbnQ4W10gbG90dG9OdW1iZXJzLCB1aW50OCBib251c051bWJlciwgdWludDI1NiByYWlzZWRBbW91bnQsIHVpbnQzMiBudW1GaXZlTWF0Y2hXaW5uZXJzLCB1aW50MzIgbnVtQm9udXNNYXRjaFdpbm5lcnMsIHVpbnQzMiBudW1TaXhNYXRjaFdpbm5lcnMpOwogICAgZXZlbnQgU2l4TWF0Y2hQcml6ZVRha2VuKGFkZHJlc3Mgd2lubmVyLCB1aW50MjU2IHByaXplQW1vdW50KTsKICAgIGV2ZW50IEJvbnVzTWF0Y2hQcml6ZVRha2VuKGFkZHJlc3Mgd2lubmVyLCB1aW50MjU2IHByaXplQW1vdW50KTsKICAgIGV2ZW50IEZpdmVNYXRjaFByaXplVGFrZW4oYWRkcmVzcyB3aW5uZXIsIHVpbnQyNTYgcHJpemVBbW91bnQpOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IE93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPcmFjbGUgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2hlbkxvdHRvTm90U3RhcnRlZCB7CiAgICAgICAgcmVxdWlyZShpc0xvdHRvU3RhcnRlZCA9PSBmYWxzZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2hlbkxvdHRvU3RhcnRlZCB7CiAgICAgICAgcmVxdWlyZShpc0xvdHRvU3RhcnRlZCA9PSB0cnVlKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIENyeXB0b0xvdHRvKCkgewogICAgICAgIE93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBsYXVuY2hMb3R0bygpIG9ubHlPd25lciB7CiAgICAgICAgb3JhY2xlQ2FsbGJhY2tJZCA9IG9yYWNsaXplX3F1ZXJ5KG9yYWNsaXplZFF1ZXJ5U291cmNlLCBvcmFjbGl6ZWRRdWVyeSwgZ2FzRm9yT3JhY2xpemVkUXVlcnkpOwogICAgfQoKICAgIC8vIEVtZXJnZW5jeSBmdW5jdGlvbiB0byBjYWxsIG9ubHkgd2hlbiB0aGUgdHVybiBtaXNzZWQgb3JhY2xpemVkX3F1ZXJ5IGJlY2F1c2VkIG9mIGdhcyBtYW5hZ2VtZW50IGZhaWx1cmUgYW5kIG5vIGNoYW5jZSB0byByZXN1bWUgYnkgaXRzZWxmLgogICAgZnVuY3Rpb24gcmVzdW1lTG90dG8oKSBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoZmluaXNoV2hlbiA8IG5vdyk7CiAgICAgICAgb3JhY2xlQ2FsbGJhY2tJZCA9IG9yYWNsaXplX3F1ZXJ5KG9yYWNsaXplZFF1ZXJ5U291cmNlLCBvcmFjbGl6ZWRRdWVyeSwgZ2FzRm9yT3JhY2xpemVkUXVlcnkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEdhc0Zvck9yYWNsaXplZFF1ZXJ5KHVpbnQzMiBfZ2FzTGltaXQpIG9ubHlPd25lciB7CiAgICAgICAgZ2FzRm9yT3JhY2xpemVkUXVlcnkgPSBfZ2FzTGltaXQ7CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQpIG9ubHlPcmFjbGUgewogICAgICAgIHJlcXVpcmUobXlpZCA9PSBvcmFjbGVDYWxsYmFja0lkKTsKICAgICAgICAKICAgICAgICBpZiAodHVybiA+IDApCiAgICAgICAgICAgIF9maW5pc2hMb3R0bygpOwogICAgICAgIF9zZXRMb3R0b051bWJlcnMocmVzdWx0KTsKICAgICAgICBfc3RhcnRMb3R0bygpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9zdGFydExvdHRvKCkgb25seVdoZW5Mb3R0b05vdFN0YXJ0ZWQgaW50ZXJuYWwgewogICAgICAgIHR1cm4rKzsKICAgICAgICBmaW5pc2hXaGVuID0gbm93ICsgZHVyYXRpb247CiAgICAgICAgb3JhY2xlQ2FsbGJhY2tJZCA9IG9yYWNsaXplX3F1ZXJ5KGR1cmF0aW9uLCBvcmFjbGl6ZWRRdWVyeVNvdXJjZSwgb3JhY2xpemVkUXVlcnksIGdhc0Zvck9yYWNsaXplZFF1ZXJ5KTsKICAgICAgICBpc0xvdHRvU3RhcnRlZCA9IHRydWU7CiAgICAgICAgbnVtRml2ZU1hdGNoV2lubmVycy5wdXNoKDApOwogICAgICAgIG51bUJvbnVzTWF0Y2hXaW5uZXJzLnB1c2goMCk7CiAgICAgICAgbnVtU2l4TWF0Y2hXaW5uZXJzLnB1c2goMCk7CiAgICAgICAgbm9uY2VzLnB1c2goMCk7CiAgICAgICAgTG90dG9TdGFydCh0dXJuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfZmluaXNoTG90dG8oKSBvbmx5V2hlbkxvdHRvU3RhcnRlZCBpbnRlcm5hbCB7CiAgICAgICAgaXNMb3R0b1N0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICBfc2F2ZUxvdHRvUmVzdWx0KCk7CiAgICAgICAgTG90dG9OdW1iZXJzQW5ub3VuY2VkKGxvdHRvTnVtYmVycywgYm9udXNOdW1iZXIsIHJhaXNlZEFtb3VudHNbdHVybiAtIDFdLCBudW1GaXZlTWF0Y2hXaW5uZXJzW3R1cm4gLSAxXSwgbnVtQm9udXNNYXRjaFdpbm5lcnNbdHVybiAtIDFdLCBudW1TaXhNYXRjaFdpbm5lcnNbdHVybiAtIDFdKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0TG90dG9OdW1iZXJzKHN0cmluZyBfc3RyRGF0YSkgb25seVdoZW5Mb3R0b05vdFN0YXJ0ZWQgaW50ZXJuYWwgewogICAgICAgIHVpbnQ4W10gbWVtb3J5IF9sb3R0b051bWJlcnMgPSBuZXcgdWludDhbXShsb3R0b0xlbmd0aCk7CiAgICAgICAgdWludDggX2JvbnVzTnVtYmVyOwogICAgICAgIHZhciBzbGljZWRTdHJpbmcgPSBfc3RyRGF0YS50b1NsaWNlKCk7CiAgICAgICAgc2xpY2VkU3RyaW5nLmJleW9uZCgie3siLnRvU2xpY2UoKSkudW50aWwoIn0iLnRvU2xpY2UoKSk7CiAgICAgICAgdmFyIF9zdHJMb3R0b051bWJlcnMgPSBzbGljZWRTdHJpbmcuc3BsaXQoJ30sIHsnLnRvU2xpY2UoKSk7CgogICAgICAgIHZhciBfYm9udXNOdW1iZXJJbmRleCA9IHVpbnQ4KHBhcnNlSW50KHNsaWNlZFN0cmluZy50b1N0cmluZygpKSk7CiAgICAgICAgdWludDggX2xvdHRvTG93ZXN0TnVtYmVyID0gbG90dG9Mb3dlc3ROdW1iZXI7CiAgICAgICAgdWludDggX2xvdHRvSGlnaGVzdE51bWJlciA9IGxvdHRvSGlnaGVzdE51bWJlcjsKICAgICAgICB1aW50OCBfbm9uY2UgPSAwOwoKICAgICAgICBmb3IgKHVpbnQ4IF9pbmRleCA9IDA7IF9pbmRleCA8IGxvdHRvTGVuZ3RoICsgMTsgX2luZGV4KyspIHsKICAgICAgICAgICAgdmFyIHNwbGl0ZWQgPSBfc3RyTG90dG9OdW1iZXJzLnNwbGl0KCcsICcudG9TbGljZSgpKTsKICAgICAgICAgICAgaWYgKF9pbmRleCA9PSBfYm9udXNOdW1iZXJJbmRleCkgewogICAgICAgICAgICAgICAgYm9udXNOdW1iZXIgPSB1aW50OChwYXJzZUludChzcGxpdGVkLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAgICAgIF9ub25jZSA9IDE7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBfbG90dG9OdW1iZXJzW19pbmRleCAtIF9ub25jZV0gPSB1aW50OChwYXJzZUludChzcGxpdGVkLnRvU3RyaW5nKCkpKTsKICAgICAgICAgICAgcmVxdWlyZShfbG90dG9OdW1iZXJzW19pbmRleCAtIF9ub25jZV0gPj0gX2xvdHRvTG93ZXN0TnVtYmVyICYmIF9sb3R0b051bWJlcnNbX2luZGV4IC0gX25vbmNlXSA8PSBfbG90dG9IaWdoZXN0TnVtYmVyKTsKICAgICAgICAgICAgaWYgKF9pbmRleCAtIF9ub25jZSA+IDApCiAgICAgICAgICAgICAgICByZXF1aXJlKF9sb3R0b051bWJlcnNbX2luZGV4IC0gX25vbmNlIC0gMV0gPCBfbG90dG9OdW1iZXJzW19pbmRleCAtIF9ub25jZV0pOwogICAgICAgICAgICBsb3R0b051bWJlcnNbX2luZGV4IC0gX25vbmNlXSA9IF9sb3R0b051bWJlcnNbX2luZGV4IC0gX25vbmNlXTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX3NhdmVMb3R0b1Jlc3VsdCgpIG9ubHlXaGVuTG90dG9Ob3RTdGFydGVkIGludGVybmFsIHsKICAgICAgICB1aW50MzIgX2VuY29kZWRMb3R0b1Jlc3VsdCA9IDA7CiAgICAgICAgdmFyIF9yYWlzZWRBbW91bnQgPSByYWlzZWRBbW91bnQ7CgogICAgICAgIC8vIGxvdHRvTnVtYmVyc1s2XSAgICAgICAgICAyNCBiaXRzICBbMC4uMjNdCiAgICAgICAgZm9yICh1aW50OCBfaW5kZXggPSAwOyBfaW5kZXggPCBsb3R0b051bWJlcnMubGVuZ3RoOyBfaW5kZXgrKykgewogICAgICAgICAgICBfZW5jb2RlZExvdHRvUmVzdWx0IHw9IHVpbnQzMihsb3R0b051bWJlcnNbX2luZGV4XSkgPDwgKF9pbmRleCAqIDQpOwogICAgICAgIH0KCiAgICAgICAgLy8gYm9udXNOdW1iZXIgICAgICAgICAgICAgICA0IGJpdHMgIFsyNC4uMjddCiAgICAgICAgX2VuY29kZWRMb3R0b1Jlc3VsdCB8PSB1aW50MzIoYm9udXNOdW1iZXIpIDw8ICgyNCk7CgogICAgICAgIHVpbnQyNTYgX3RvdGFsUHJpemVBbW91bnQgPSAwOwoKICAgICAgICBpZiAobnVtRml2ZU1hdGNoV2lubmVyc1t0dXJuIC0gMV0gPiAwKQogICAgICAgICAgICBfdG90YWxQcml6ZUFtb3VudCArPSBfcmFpc2VkQW1vdW50ICogZml2ZU1hdGNoUGF5b3V0SW5QZXJjZW50IC8gMTAwOwoKICAgICAgICBpZiAobnVtQm9udXNNYXRjaFdpbm5lcnNbdHVybiAtIDFdID4gMCkKICAgICAgICAgICAgX3RvdGFsUHJpemVBbW91bnQgKz0gX3JhaXNlZEFtb3VudCAqIGJvbnVzTWF0Y2hQYXlvdXRJblBlcmNlbnQgLyAxMDA7CgogICAgICAgIGlmIChudW1TaXhNYXRjaFdpbm5lcnNbdHVybiAtIDFdID4gMCkKICAgICAgICAgICAgX3RvdGFsUHJpemVBbW91bnQgKz0gX3JhaXNlZEFtb3VudCAqIHNpeE1hdGNoUGF5b3V0SW5QZXJjZW50IC8gMTAwOwoKICAgICAgICByYWlzZWRBbW91bnRzLnB1c2goX3JhaXNlZEFtb3VudCk7CiAgICAgICAgdW50YWtlblByaXplQW1vdW50cy5wdXNoKF90b3RhbFByaXplQW1vdW50KTsKICAgICAgICBlbmNvZGVkTG90dG9SZXN1bHRzLnB1c2goX2VuY29kZWRMb3R0b1Jlc3VsdCk7CiAgICAgICAgYWNjTnVtQmV0dGluZ3MucHVzaChiZXR0aW5ncy5sZW5ndGgpOwogICAgICAgIHRpbWVzdGFtcHMucHVzaCh1aW50NjQobm93KSk7CgogICAgICAgIHZhciBfb3duZXJTaGFyZSA9IF9yYWlzZWRBbW91bnQgKiBvd25lclNoYXJlSW5QZXJjZW50IC8gMTAwOwogICAgICAgIE93bmVyLnRyYW5zZmVyKF9vd25lclNoYXJlKTsKCiAgICAgICAgdWludDMyIF9udW1UdXJuc1RvUmV2b2x2ZSA9IHVpbnQzMihudW1UdXJuc1RvUmV2b2x2ZSk7CiAgICAgICAgdWludDI1NiBfYW1vdW50VG9DYXJyeU92ZXIgPSAwOwogICAgICAgIGlmICh0dXJuID4gX251bVR1cm5zVG9SZXZvbHZlKQogICAgICAgICAgICBfYW1vdW50VG9DYXJyeU92ZXIgPSB1bnRha2VuUHJpemVBbW91bnRzW3R1cm4gLSBfbnVtVHVybnNUb1Jldm9sdmUgLSAxXTsKICAgICAgICByYWlzZWRBbW91bnQgPSBfcmFpc2VkQW1vdW50IC0gX3RvdGFsUHJpemVBbW91bnQgLSBfb3duZXJTaGFyZSArIF9hbW91bnRUb0NhcnJ5T3ZlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMb3R0b1Jlc3VsdCh1aW50MjU2IF90dXJuKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2LCB1aW50MzIsIHVpbnQzMiwgdWludDMyKSB7CiAgICAgICAgcmVxdWlyZShfdHVybiA8IHR1cm4gJiYgX3R1cm4gPiAwKTsKICAgICAgICByZXR1cm4gKHJhaXNlZEFtb3VudHNbX3R1cm4gLSAxXSwgdW50YWtlblByaXplQW1vdW50c1tfdHVybiAtIDFdLCBudW1GaXZlTWF0Y2hXaW5uZXJzW190dXJuIC0gMV0sIG51bUJvbnVzTWF0Y2hXaW5uZXJzW190dXJuIC0gMV0sIG51bVNpeE1hdGNoV2lubmVyc1tfdHVybiAtIDFdKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMb3R0b051bWJlcnModWludDI1NiBfdHVybikgY29uc3RhbnQgcmV0dXJucyAodWludDhbXSwgdWludDgpIHsKICAgICAgICByZXF1aXJlKF90dXJuIDwgdHVybiAmJiBfdHVybiA+IDApOwogICAgICAgIHZhciBfZW5jb2RlZExvdHRvUmVzdWx0ID0gZW5jb2RlZExvdHRvUmVzdWx0c1tfdHVybiAtIDFdOwogICAgICAgIHVpbnQ4W10gbWVtb3J5IF9sb3R0b051bWJlcnMgPSBuZXcgdWludDhbXShsb3R0b0xlbmd0aCk7CiAgICAgICAgdWludDggX2JvbnVzTnVtYmVyOwoKICAgICAgICBmb3IgKHVpbnQ4IF9pbmRleCA9IDA7IF9pbmRleCA8IF9sb3R0b051bWJlcnMubGVuZ3RoOyBfaW5kZXgrKykgewogICAgICAgICAgICBfbG90dG9OdW1iZXJzW19pbmRleF0gPSB1aW50OCgoX2VuY29kZWRMb3R0b1Jlc3VsdCA+PiAoX2luZGV4ICogNCkpICYgKDIgKiogNCAtIDEpKTsKICAgICAgICB9CiAgICAgICAgX2JvbnVzTnVtYmVyID0gdWludDgoKF9lbmNvZGVkTG90dG9SZXN1bHQgPj4gMjQpICYgKDIgKiogNCAtIDEpKTsKICAgICAgICByZXR1cm4gKF9sb3R0b051bWJlcnMsIF9ib251c051bWJlcik7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5VGlja2V0cyh1aW50IF9udW1UaWNrZXRzLCB1aW50OFtdIF9iZXROdW1iZXJzTGlzdCwgYm9vbCBfaXNBdXRvR2VuZXJhdGVkKSBwYXlhYmxlIG9ubHlXaGVuTG90dG9TdGFydGVkIHsKICAgICAgICByZXF1aXJlKGZpbmlzaFdoZW4gPiBub3cpOwogICAgICAgIHZhciBfbG90dG9MZW5ndGggPSBsb3R0b0xlbmd0aDsKICAgICAgICByZXF1aXJlKF9iZXROdW1iZXJzTGlzdC5sZW5ndGggPT0gX251bVRpY2tldHMgKiBfbG90dG9MZW5ndGgpOwogICAgICAgIHVpbnQgX3RvdGFsUHJpY2UgPSBfbnVtVGlja2V0cyAqIGxvdHRvUHJpY2U7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gX3RvdGFsUHJpY2UpOwoKICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCBfbnVtVGlja2V0czsgaisrKSB7CiAgICAgICAgICAgIHJlcXVpcmUoX2JldE51bWJlcnNMaXN0W2ogKiBfbG90dG9MZW5ndGhdID49IGxvdHRvTG93ZXN0TnVtYmVyICYmIF9iZXROdW1iZXJzTGlzdFsoaiArIDEpICogX2xvdHRvTGVuZ3RoIC0gMV0gPD0gbG90dG9IaWdoZXN0TnVtYmVyKTsKICAgICAgICAgICAgZm9yICh1aW50IF9pbmRleCA9IDA7IF9pbmRleCA8IF9sb3R0b0xlbmd0aCAtIDE7IF9pbmRleCsrKSB7CiAgICAgICAgICAgICAgICByZXF1aXJlKF9iZXROdW1iZXJzTGlzdFtfaW5kZXggKyBqICogX2xvdHRvTGVuZ3RoXSA8IF9iZXROdW1iZXJzTGlzdFtfaW5kZXggKyAxICsgaiAqIF9sb3R0b0xlbmd0aF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1aW50OFtdIG1lbW9yeSBfYmV0TnVtYmVycyA9IG5ldyB1aW50OFtdKGxvdHRvTGVuZ3RoKTsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgX251bVRpY2tldHM7IGorKykgewogICAgICAgICAgICBmb3IgKF9pbmRleCA9IDA7IF9pbmRleCA8IF9sb3R0b0xlbmd0aCAtIDE7IF9pbmRleCsrKSB7CiAgICAgICAgICAgICAgICBfYmV0TnVtYmVyc1tfaW5kZXhdID0gX2JldE51bWJlcnNMaXN0W19pbmRleCArIGogKiBfbG90dG9MZW5ndGhdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9iZXROdW1iZXJzW19pbmRleF0gPSBfYmV0TnVtYmVyc0xpc3RbX2luZGV4ICsgaiAqIF9sb3R0b0xlbmd0aF07CiAgICAgICAgICAgIF9zYXZlQmV0dGluZ0FuZFRpY2tldChfYmV0TnVtYmVycywgX2lzQXV0b0dlbmVyYXRlZCk7CiAgICAgICAgfQoKICAgICAgICByYWlzZWRBbW91bnQgKz0gX3RvdGFsUHJpY2U7CiAgICAgICAgT3duZXIudHJhbnNmZXIobXNnLnZhbHVlIC0gX3RvdGFsUHJpY2UpOwogICAgICAgIEZ1bmRSYWlzZWQobXNnLnNlbmRlciwgbXNnLnZhbHVlLCByYWlzZWRBbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRMb3R0b1JhbmsodWludDhbXSBfYmV0TnVtYmVycykgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAobG90dG9SYW5rKSB7CiAgICAgICAgdWludDggX2xvdHRvTGVuZ3RoID0gbG90dG9MZW5ndGg7CiAgICAgICAgdWludDhbXSBtZW1vcnkgX2xvdHRvTnVtYmVycyA9IG5ldyB1aW50OFtdKF9sb3R0b0xlbmd0aCk7CiAgICAgICAgdWludDggX2luZGV4TG90dG8gPSAwOwogICAgICAgIHVpbnQ4IF9pbmRleEJldCA9IDA7CiAgICAgICAgdWludDggX251bU1hdGNoID0gMDsKCiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IF9sb3R0b0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIF9sb3R0b051bWJlcnNbaV0gPSBsb3R0b051bWJlcnNbaV07CiAgICAgICAgfQoKICAgICAgICB3aGlsZSAoX2luZGV4TG90dG8gPCBfbG90dG9MZW5ndGggJiYgX2luZGV4QmV0IDwgX2xvdHRvTGVuZ3RoKSB7CiAgICAgICAgICAgIGlmIChfYmV0TnVtYmVyc1tfaW5kZXhCZXRdID09IF9sb3R0b051bWJlcnNbX2luZGV4TG90dG9dKSB7CiAgICAgICAgICAgICAgICBfbnVtTWF0Y2grKzsKICAgICAgICAgICAgICAgIF9pbmRleEJldCsrOwogICAgICAgICAgICAgICAgX2luZGV4TG90dG8rKzsKICAgICAgICAgICAgICAgIGlmIChfbnVtTWF0Y2ggPiA0KQogICAgICAgICAgICAgICAgICAgIGZvciAodWludDggX2J1cm5lciA9IDA7IF9idXJuZXIgPCA2OyBfYnVybmVyKyspIHt9CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChfYmV0TnVtYmVyc1tfaW5kZXhCZXRdIDwgX2xvdHRvTnVtYmVyc1tfaW5kZXhMb3R0b10pIHsKICAgICAgICAgICAgICAgIF9pbmRleEJldCsrOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgX2luZGV4TG90dG8rKzsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoX251bU1hdGNoID09IF9sb3R0b0xlbmd0aCAtIDEpIHsKICAgICAgICAgICAgdWludDggX2JvbnVzTnVtYmVyID0gYm9udXNOdW1iZXI7CiAgICAgICAgICAgIGZvciAodWludDggX2luZGV4ID0gMDsgX2luZGV4IDwgbG90dG9MZW5ndGg7IF9pbmRleCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoX2JldE51bWJlcnNbX2luZGV4XSA9PSBfYm9udXNOdW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKF9idXJuZXIgPSAwOyBfYnVybmVyIDwgNjsgX2J1cm5lcisrKSB7fQogICAgICAgICAgICAgICAgICAgIHJldHVybiBsb3R0b1JhbmsuQk9OVVNfTUFUQ0g7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGxvdHRvUmFuay5GSVZFX01BVENIOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChfbnVtTWF0Y2ggPT0gX2xvdHRvTGVuZ3RoKSB7CiAgICAgICAgICAgIGZvciAoX2J1cm5lciA9IDA7IF9idXJuZXIgPCAxMjsgX2J1cm5lcisrKSB7fQogICAgICAgICAgICByZXR1cm4gbG90dG9SYW5rLlNJWF9NQVRDSDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBsb3R0b1JhbmsuREVGQVVMVDsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2F2ZUJldHRpbmdBbmRUaWNrZXQodWludDhbXSBfYmV0TnVtYmVycywgYm9vbCBfaXNBdXRvR2VuZXJhdGVkKSBpbnRlcm5hbCBvbmx5V2hlbkxvdHRvU3RhcnRlZCB7CiAgICAgICAgcmVxdWlyZShfYmV0TnVtYmVycy5sZW5ndGggPT0gNiAmJiBsb3R0b0hpZ2hlc3ROdW1iZXIgPD0gMTYpOwogICAgICAgIHVpbnQyNTYgX2VuY29kZWRCZXR0aW5nID0gMDsKICAgICAgICB1aW50NjQgX2VuY29kZWRUaWNrZXQgPSAwOwogICAgICAgIHVpbnQyNTYgX25vbmNlMjU2ID0gMDsKICAgICAgICB1aW50NjQgX25vbmNlNjQgPSAwOwoKICAgICAgICAvLyBpc1Rha2VuICAgICAgICAgICAgICAgICAgIDEgYml0ICAgICAgYmV0dGluZ1swXSAgICAgICAgICAgICAgICAgIHRpY2tldFswXQogICAgICAgIC8vIGlzQXV0b0dlbmVyYXRlZCAgICAgICAgICAgMSBiaXQgICAgICBiZXR0aW5nWzFdICAgICAgICAgICAgICAgICAgdGlja2V0WzFdCiAgICAgICAgLy8gYmV0TnVtYmVyc1s2XSAgICAgICAgICAgIDI0IGJpdHMgICAgIGJldHRpbmdbMi4uMjVdICAgICAgICAgICAgICB0aWNrZXRbMi4uMjVdCiAgICAgICAgLy8gbG90dG9SYW5rLkZJVkVfTUFUQ0ggICAgICAxIGJpdCAgICAgIGJldHRpbmdbMjZdICAgICAgICAgICAgICAgICB0aWNrZXRbMjZdCiAgICAgICAgLy8gbG90dG9SYW5rLkJPTlVTX01BVENIICAgICAxIGJpdCAgICAgIGJldHRpbmdbMjddICAgICAgICAgICAgICAgICB0aWNrZXRbMjddCiAgICAgICAgLy8gbG90dG9SYW5rLlNJWF9NQVRDSCAgICAgICAxIGJpdCAgICAgIGJldHRpbmdbMjhdICAgICAgICAgICAgICAgICB0aWNrZXRbMjhdCiAgICAgICAgLy8gc2VuZGVyIGFkZHJlc3MgICAgICAgICAgMTYwIGJpdHMgICAgIGJldHRpbmdbMjkuLjE4OF0KICAgICAgICAvLyB0aW1lc3RhbXAgICAgICAgICAgICAgICAgMzYgYml0cyAgICAgYmV0dGluZ1sxODkuLjIyNF0gICAgICAgICAgIHRpY2tldFsyOS4uNjRdCgogICAgICAgIC8vIGlzQXV0b0dlbmVyYXRlZAogICAgICAgIGlmIChfaXNBdXRvR2VuZXJhdGVkKSB7CiAgICAgICAgICAgIF9lbmNvZGVkQmV0dGluZyB8PSB1aW50MjU2KDEpIDw8IDE7CiAgICAgICAgICAgIF9lbmNvZGVkVGlja2V0IHw9IHVpbnQ2NCgxKSA8PCAxOwogICAgICAgIH0KCiAgICAgICAgLy8gYmV0TnVtYmVyc1s2XQogICAgICAgIGZvciAodWludDggX2luZGV4ID0gMDsgX2luZGV4IDwgX2JldE51bWJlcnMubGVuZ3RoOyBfaW5kZXgrKykgewogICAgICAgICAgICB1aW50MjU2IF9iZXROdW1iZXIgPSB1aW50MjU2KF9iZXROdW1iZXJzW19pbmRleF0pIDw8IChfaW5kZXggKiA0ICsgMik7CiAgICAgICAgICAgIF9lbmNvZGVkQmV0dGluZyB8PSBfYmV0TnVtYmVyOwogICAgICAgICAgICBfZW5jb2RlZFRpY2tldCB8PSB1aW50NjQoX2JldE51bWJlcik7CiAgICAgICAgfQoKICAgICAgICAvLyBsb3R0b1JhbmsuRklWRV9NQVRDSCwgbG90dG9SYW5rLkJPTlVTX01BVENILCBsb3R0b1JhbmsuU0lYX01BVENICiAgICAgICAgbG90dG9SYW5rIF9sb3R0b1JhbmsgPSBfZ2V0TG90dG9SYW5rKF9iZXROdW1iZXJzKTsKICAgICAgICBpZiAoX2xvdHRvUmFuayA9PSBsb3R0b1JhbmsuRklWRV9NQVRDSCkgewogICAgICAgICAgICBudW1GaXZlTWF0Y2hXaW5uZXJzW3R1cm4gLSAxXSsrOwogICAgICAgICAgICBfZW5jb2RlZEJldHRpbmcgfD0gdWludDI1NigxKSA8PCAyNjsKICAgICAgICAgICAgX2VuY29kZWRUaWNrZXQgfD0gdWludDY0KDEpIDw8IDI2OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChfbG90dG9SYW5rID09IGxvdHRvUmFuay5CT05VU19NQVRDSCkgewogICAgICAgICAgICBudW1Cb251c01hdGNoV2lubmVyc1t0dXJuIC0gMV0rKzsKICAgICAgICAgICAgX2VuY29kZWRCZXR0aW5nIHw9IHVpbnQyNTYoMSkgPDwgMjc7CiAgICAgICAgICAgIF9lbmNvZGVkVGlja2V0IHw9IHVpbnQ2NCgxKSA8PCAyNzsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoX2xvdHRvUmFuayA9PSBsb3R0b1JhbmsuU0lYX01BVENIKSB7CiAgICAgICAgICAgIG51bVNpeE1hdGNoV2lubmVyc1t0dXJuIC0gMV0rKzsKICAgICAgICAgICAgX2VuY29kZWRCZXR0aW5nIHw9IHVpbnQyNTYoMSkgPDwgMjg7CiAgICAgICAgICAgIF9lbmNvZGVkVGlja2V0IHw9IHVpbnQ2NCgxKSA8PCAyODsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBub25jZXNbdHVybiAtIDFdKys7CiAgICAgICAgICAgIF9ub25jZTI1NiB8PSB1aW50MjU2KDEpIDw8IDI5OwogICAgICAgICAgICBfbm9uY2U2NCB8PSB1aW50NjQoMSkgPDwgMjk7CiAgICAgICAgfQoKICAgICAgICAvLyBzZW5kZXIgYWRkcmVzcwogICAgICAgIF9lbmNvZGVkQmV0dGluZyB8PSB1aW50MjU2KG1zZy5zZW5kZXIpIDw8IDI5OwoKICAgICAgICAvLyB0aW1lc3RhbXAKICAgICAgICBfZW5jb2RlZEJldHRpbmcgfD0gbm93IDw8IDE4OTsKICAgICAgICBfZW5jb2RlZFRpY2tldCB8PSB1aW50NjQobm93KSA8PCAyOTsKCiAgICAgICAgLy8gcHVzaCB0aWNrZXQKICAgICAgICB0aWNrZXRzW21zZy5zZW5kZXJdW3R1cm5dLnB1c2goX2VuY29kZWRUaWNrZXQpOwogICAgICAgIC8vIHB1c2ggYmV0dGluZwogICAgICAgIGJldHRpbmdzLnB1c2goX2VuY29kZWRCZXR0aW5nKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXROdW1CZXR0aW5ncygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYmV0dGluZ3MubGVuZ3RoOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFR1cm4odWludDI1NiBfYmV0dGluZ0lkKSBjb25zdGFudCByZXR1cm5zICh1aW50MzIpIHsKICAgICAgICB1aW50MzIgX3R1cm4gPSB0dXJuOwogICAgICAgIHJlcXVpcmUoX3R1cm4gPiAwKTsKICAgICAgICByZXF1aXJlKF9iZXR0aW5nSWQgPCBiZXR0aW5ncy5sZW5ndGgpOwoKICAgICAgICBpZiAoX3R1cm4gPT0gMSB8fCBfYmV0dGluZ0lkIDwgYWNjTnVtQmV0dGluZ3NbMF0pCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChfYmV0dGluZ0lkID49IGFjY051bUJldHRpbmdzW190dXJuIC0gMl0pCiAgICAgICAgICAgIHJldHVybiBfdHVybjsKCiAgICAgICAgdWludDMyIGkgPSAwOwogICAgICAgIHVpbnQzMiBqID0gX3R1cm4gLSAxOwogICAgICAgIHVpbnQzMiBtaWQgPSAwOwoKICAgICAgICB3aGlsZSAoaSA8IGopIHsKICAgICAgICAgICAgbWlkID0gKGkgKyBqKSAvIDI7CgogICAgICAgICAgICBpZiAoYWNjTnVtQmV0dGluZ3NbbWlkXSA9PSBfYmV0dGluZ0lkKQogICAgICAgICAgICAgICAgcmV0dXJuIG1pZCArIDI7CgogICAgICAgICAgICBpZiAoX2JldHRpbmdJZCA8IGFjY051bUJldHRpbmdzW21pZF0pIHsKICAgICAgICAgICAgICAgIGlmIChtaWQgPiAwICYmIF9iZXR0aW5nSWQgPiBhY2NOdW1CZXR0aW5nc1ttaWQgLSAxXSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWlkICsgMTsKICAgICAgICAgICAgICAgIGogPSBtaWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobWlkIDwgX3R1cm4gLSAyICYmIF9iZXR0aW5nSWQgPCBhY2NOdW1CZXR0aW5nc1ttaWQgKyAxXSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWlkICsgMjsKICAgICAgICAgICAgICAgIGkgPSBtaWQgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBtaWQgKyAyOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJldHRpbmcodWludDI1NiBpKSBjb25zdGFudCByZXR1cm5zIChib29sLCBib29sLCB1aW50OFtdLCBsb3R0b1JhbmssIHVpbnQzMil7CiAgICAgICAgcmVxdWlyZShpIDwgYmV0dGluZ3MubGVuZ3RoKTsKICAgICAgICB1aW50MjU2IF9iZXR0aW5nID0gYmV0dGluZ3NbaV07CgogICAgICAgIC8vIGlzVGFrZW4gICAgICAgICAgICAgICAgICAgICAgMSBiaXQgICAgICBbMF0KICAgICAgICBib29sIF9pc1Rha2VuOwogICAgICAgIGlmIChfYmV0dGluZyAmIDEgPT0gMSkKICAgICAgICAgICAgX2lzVGFrZW4gPSB0cnVlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2lzQXV0b0dlbmVyYXRlZCA9IGZhbHNlOwoKICAgICAgICAvLyBfaXNBdXRvR2VuZXJhdGVkICAgICAgICAgICAgIDEgYml0ICAgICAgWzFdCiAgICAgICAgYm9vbCBfaXNBdXRvR2VuZXJhdGVkOwogICAgICAgIGlmICgoX2JldHRpbmcgPj4gMSkgJiAxID09IDEpCiAgICAgICAgICAgIF9pc0F1dG9HZW5lcmF0ZWQgPSB0cnVlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgX2lzQXV0b0dlbmVyYXRlZCA9IGZhbHNlOwoKICAgICAgICAvLyA2IGJldE51bWJlcnMgICAgICAgICAgICAgICAgMjQgYml0cyAgICAgWzIuLjI1XQogICAgICAgIHVpbnQ4W10gbWVtb3J5IF9iZXROdW1iZXJzID0gbmV3IHVpbnQ4W10obG90dG9MZW5ndGgpOwogICAgICAgIGZvciAodWludDggX2luZGV4ID0gMDsgX2luZGV4IDwgbG90dG9MZW5ndGg7IF9pbmRleCsrKSB7CiAgICAgICAgICAgIF9iZXROdW1iZXJzW19pbmRleF0gPSB1aW50OCgoX2JldHRpbmcgPj4gKF9pbmRleCAqIDQgKyAyKSkgJiAoMiAqKiA0IC0gMSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gIF90aW1lc3RhbXAgICAgICAgICAgICAgICAgICAgYml0cyAgICAgWzE4OS4uMjU1XQogICAgICAgIHVpbnQxMjggX3RpbWVzdGFtcDsKICAgICAgICBfdGltZXN0YW1wID0gdWludDEyOCgoX2JldHRpbmcgPj4gMTg5KSAmICgyICoqIDY3IC0gMSkpOwoKICAgICAgICB1aW50MzIgX3R1cm4gPSBnZXRUdXJuKGkpOwogICAgICAgIGlmIChfdHVybiA9PSB0dXJuICYmIGlzTG90dG9TdGFydGVkKQogICAgICAgICAgICByZXR1cm4gKF9pc1Rha2VuLCBfaXNBdXRvR2VuZXJhdGVkLCBfYmV0TnVtYmVycywgbG90dG9SYW5rLk5PTkNFLCBfdHVybik7CgogICAgICAgIC8vIHJldHVybiBsb3R0b1Jhbmsgb25seSB3aGVuIHRoZSB0dXJuIGlzIGZpbmlzaGVkCiAgICAgICAgLy8gbG90dG9SYW5rICAgICAgICAgICAgICAgICAgICAzIGJpdHMgICAgIFsyNi4uMjhdCiAgICAgICAgbG90dG9SYW5rIF9sb3R0b1JhbmsgPSBsb3R0b1JhbmsuREVGQVVMVDsKICAgICAgICBpZiAoKF9iZXR0aW5nID4+IDI2KSAmIDEgPT0gMSkKICAgICAgICAgICAgX2xvdHRvUmFuayA9IGxvdHRvUmFuay5GSVZFX01BVENIOwogICAgICAgIGlmICgoX2JldHRpbmcgPj4gMjcpICYgMSA9PSAxKQogICAgICAgICAgICBfbG90dG9SYW5rID0gbG90dG9SYW5rLkJPTlVTX01BVENIOwogICAgICAgIGlmICgoX2JldHRpbmcgPj4gMjgpICYgMSA9PSAxKQogICAgICAgICAgICBfbG90dG9SYW5rID0gbG90dG9SYW5rLlNJWF9NQVRDSDsKCiAgICAgICAgcmV0dXJuIChfaXNUYWtlbiwgX2lzQXV0b0dlbmVyYXRlZCwgX2JldE51bWJlcnMsIF9sb3R0b1JhbmssIF90dXJuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCZXR0aW5nRXh0cmEodWludDI1NiBpKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzLCB1aW50MTI4KXsKICAgICAgICByZXF1aXJlKGkgPCBiZXR0aW5ncy5sZW5ndGgpOwogICAgICAgIHVpbnQyNTYgX2JldHRpbmcgPSBiZXR0aW5nc1tpXTsKICAgICAgICB1aW50MTI4IF90aW1lc3RhbXAgPSB1aW50MTI4KChfYmV0dGluZyA+PiAxODkpICYgKDIgKiogNjcgLSAxKSk7CiAgICAgICAgYWRkcmVzcyBfYmVuZWZpY2lhcnkgPSBhZGRyZXNzKChfYmV0dGluZyA+PiAyOSkgJiAoMiAqKiAxNjAgLSAxKSk7CiAgICAgICAgcmV0dXJuIChfYmVuZWZpY2lhcnksIF90aW1lc3RhbXApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE15UmVzdWx0KHVpbnQzMiBfdHVybikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiwgdWludDMyLCB1aW50MzIsIHVpbnQzMiwgdWludDI1NikgewogICAgICAgIHJlcXVpcmUoX3R1cm4gPiAwKTsKICAgICAgICBpZiAoX3R1cm4gPT0gdHVybikKICAgICAgICAgICAgcmVxdWlyZSghaXNMb3R0b1N0YXJ0ZWQpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmVxdWlyZShfdHVybiA8IHR1cm4pOwoKICAgICAgICB1aW50MjU2IF9udW1NeVRpY2tldHMgPSB0aWNrZXRzW21zZy5zZW5kZXJdW190dXJuXS5sZW5ndGg7CiAgICAgICAgdWludDI1NiBfdG90YWxQcml6ZUFtb3VudCA9IDA7CiAgICAgICAgdWludDY0IF90aWNrZXQ7CiAgICAgICAgdWludDMyIF9udW1TaXhNYXRjaFByaXplcyA9IDA7CiAgICAgICAgdWludDMyIF9udW1Cb251c01hdGNoUHJpemVzID0gMDsKICAgICAgICB1aW50MzIgX251bUZpdmVNYXRjaFByaXplcyA9IDA7CgogICAgICAgIGlmIChfbnVtTXlUaWNrZXRzID09IDApIHsKICAgICAgICAgICAgcmV0dXJuICgwLCAwLCAwLCAwLCAwKTsKICAgICAgICB9CgogICAgICAgIGZvciAodWludDI1NiBfaW5kZXggPSAwOyBfaW5kZXggPCBfbnVtTXlUaWNrZXRzOyBfaW5kZXgrKykgewogICAgICAgICAgICBfdGlja2V0ID0gdGlja2V0c1ttc2cuc2VuZGVyXVtfdHVybl1bX2luZGV4XTsKICAgICAgICAgICAgaWYgKChfdGlja2V0ID4+IDI2KSAmIDEgPT0gMSkgewogICAgICAgICAgICAgICAgX251bUZpdmVNYXRjaFByaXplcysrOwogICAgICAgICAgICAgICAgX3RvdGFsUHJpemVBbW91bnQgKz0gX2dldEZpdmVNYXRjaFByaXplQW1vdW50KF90dXJuKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICgoX3RpY2tldCA+PiAyNykgJiAxID09IDEpIHsKICAgICAgICAgICAgICAgIF9udW1Cb251c01hdGNoUHJpemVzKys7CiAgICAgICAgICAgICAgICBfdG90YWxQcml6ZUFtb3VudCArPSBfZ2V0Qm9udXNNYXRjaFByaXplQW1vdW50KF90dXJuKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICgoX3RpY2tldCA+PiAyOCkgJiAxID09IDEpIHsKICAgICAgICAgICAgICAgIF9udW1TaXhNYXRjaFByaXplcysrOwogICAgICAgICAgICAgICAgX3RvdGFsUHJpemVBbW91bnQgKz0gX2dldFNpeE1hdGNoUHJpemVBbW91bnQoX3R1cm4pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAoX251bU15VGlja2V0cywgX251bVNpeE1hdGNoUHJpemVzLCBfbnVtQm9udXNNYXRjaFByaXplcywgX251bUZpdmVNYXRjaFByaXplcywgX3RvdGFsUHJpemVBbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE51bU15VGlja2V0cyh1aW50MzIgX3R1cm4pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF90dXJuID4gMCAmJiBfdHVybiA8PSB0dXJuKTsKICAgICAgICByZXR1cm4gdGlja2V0c1ttc2cuc2VuZGVyXVtfdHVybl0ubGVuZ3RoOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE15VGlja2V0KHVpbnQzMiBfdHVybiwgdWludDI1NiBpKSBjb25zdGFudCByZXR1cm5zIChib29sLCBib29sLCB1aW50OFtdLCBsb3R0b1JhbmssIHVpbnQ2NCl7CiAgICAgICAgcmVxdWlyZShfdHVybiA8PSB0dXJuKTsKICAgICAgICByZXF1aXJlKGkgPCB0aWNrZXRzW21zZy5zZW5kZXJdW190dXJuXS5sZW5ndGgpOwogICAgICAgIHVpbnQ2NCBfdGlja2V0ID0gdGlja2V0c1ttc2cuc2VuZGVyXVtfdHVybl1baV07CgogICAgICAgIC8vIGlzVGFrZW4gICAgICAgICAgICAgICAgICAgMSBiaXQgICAgICB0aWNrZXRbMF0KICAgICAgICBib29sIF9pc1Rha2VuID0gZmFsc2U7CiAgICAgICAgaWYgKChfdGlja2V0ICYgMSkgPT0gMSkKICAgICAgICAgICAgX2lzVGFrZW4gPSB0cnVlOwoKICAgICAgICAvLyBpc0F1dG9HZW5lcmF0ZWQgICAgICAgICAgIDEgYml0ICAgICAgdGlja2V0WzFdCiAgICAgICAgYm9vbCBfaXNBdXRvR2VuZXJhdGVkID0gZmFsc2U7CiAgICAgICAgaWYgKChfdGlja2V0ID4+IDEpICYgMSA9PSAxKQogICAgICAgICAgICBfaXNBdXRvR2VuZXJhdGVkID0gdHJ1ZTsKCiAgICAgICAgLy8gYmV0TnVtYmVyc1s2XSAgICAgICAgICAgIDI0IGJpdHMgICAgIHRpY2tldFsyLi4yNV0KICAgICAgICB1aW50OFtdIG1lbW9yeSBfYmV0TnVtYmVycyA9IG5ldyB1aW50OFtdKGxvdHRvTGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQ4IF9pbmRleCA9IDA7IF9pbmRleCA8IGxvdHRvTGVuZ3RoOyBfaW5kZXgrKykgewogICAgICAgICAgICBfYmV0TnVtYmVyc1tfaW5kZXhdID0gdWludDgoKF90aWNrZXQgPj4gKF9pbmRleCAqIDQgKyAyKSkgJiAoMiAqKiA0IC0gMSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gdGltZXN0YW1wICAgICAgICAgICAgICAgIDM2IGJpdHMgICAgIHRpY2tldFsyOS4uNjRdCiAgICAgICAgdWludDY0IF90aW1lc3RhbXAgPSB1aW50NjQoKF90aWNrZXQgPj4gMjkpICYgKDIgKiogMzYgLSAxKSk7CgogICAgICAgIGlmIChfdHVybiA9PSB0dXJuKQogICAgICAgICAgICByZXR1cm4gKF9pc1Rha2VuLCBfaXNBdXRvR2VuZXJhdGVkLCBfYmV0TnVtYmVycywgbG90dG9SYW5rLk5PTkNFLCBfdGltZXN0YW1wKTsKCiAgICAgICAgLy8gcmV0dXJuIGxvdHRvUmFuayBvbmx5IHdoZW4gdGhlIHR1cm4gaXMgZmluaXNoZWQKCiAgICAgICAgLy8gbG90dG9SYW5rLkZJVkVfTUFUQ0ggICAgICAxIGJpdCAgICAgIHRpY2tldFsyNl0KICAgICAgICAvLyBsb3R0b1JhbmsuQk9OVVNfTUFUQ0ggICAgIDEgYml0ICAgICAgdGlja2V0WzI3XQogICAgICAgIC8vIGxvdHRvUmFuay5TSVhfTUFUQ0ggICAgICAgMSBiaXQgICAgICB0aWNrZXRbMjhdCiAgICAgICAgbG90dG9SYW5rIF9sb3R0b1JhbmsgPSBsb3R0b1JhbmsuREVGQVVMVDsKICAgICAgICBpZiAoKF90aWNrZXQgPj4gMjYpICYgMSA9PSAxKQogICAgICAgICAgICBfbG90dG9SYW5rID0gbG90dG9SYW5rLkZJVkVfTUFUQ0g7CiAgICAgICAgaWYgKChfdGlja2V0ID4+IDI3KSAmIDEgPT0gMSkKICAgICAgICAgICAgX2xvdHRvUmFuayA9IGxvdHRvUmFuay5CT05VU19NQVRDSDsKICAgICAgICBpZiAoKF90aWNrZXQgPj4gMjgpICYgMSA9PSAxKQogICAgICAgICAgICBfbG90dG9SYW5rID0gbG90dG9SYW5rLlNJWF9NQVRDSDsKCiAgICAgICAgcmV0dXJuIChfaXNUYWtlbiwgX2lzQXV0b0dlbmVyYXRlZCwgX2JldE51bWJlcnMsIF9sb3R0b1JhbmssIF90aW1lc3RhbXApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE15VW50YWtlblByaXplcyh1aW50MzIgX3R1cm4pIGNvbnN0YW50IHJldHVybnMgKHVpbnQzMltdKSB7CiAgICAgICAgcmVxdWlyZShfdHVybiA+IDAgJiYgX3R1cm4gPCB0dXJuKTsKICAgICAgICB1aW50MjU2IF9udW1NeVRpY2tldHMgPSB0aWNrZXRzW21zZy5zZW5kZXJdW190dXJuXS5sZW5ndGg7CgogICAgICAgIHVpbnQzMltdIG1lbW9yeSBfcHJpemVzID0gbmV3IHVpbnQzMltdKDUwKTsKICAgICAgICB1aW50MjU2IF9pbmRleFByaXplcyA9IDA7CgogICAgICAgIGZvciAodWludDE2IF9pbmRleDsgX2luZGV4IDwgX251bU15VGlja2V0czsgX2luZGV4KyspIHsKICAgICAgICAgICAgdWludDY0IF90aWNrZXQgPSB0aWNrZXRzW21zZy5zZW5kZXJdW190dXJuXVtfaW5kZXhdOwogICAgICAgICAgICBpZiAoKChfdGlja2V0ID4+IDI2KSAmIDEgPT0gMSkgJiYgKF90aWNrZXQgJiAxID09IDApKQogICAgICAgICAgICAgICAgX3ByaXplc1tfaW5kZXhQcml6ZXMrK10gPSBfaW5kZXg7CiAgICAgICAgICAgIGVsc2UgaWYgKCgoX3RpY2tldCA+PiAyNykgJiAxID09IDEpICYmIChfdGlja2V0ICYgMSA9PSAwKSkKICAgICAgICAgICAgICAgIF9wcml6ZXNbX2luZGV4UHJpemVzKytdID0gX2luZGV4OwogICAgICAgICAgICBlbHNlIGlmICgoKF90aWNrZXQgPj4gMjgpICYgMSA9PSAxKSAmJiAoX3RpY2tldCAmIDEgPT0gMCkpCiAgICAgICAgICAgICAgICBfcHJpemVzW19pbmRleFByaXplcysrXSA9IF9pbmRleDsKICAgICAgICAgICAgaWYgKF9pbmRleFByaXplcyA+PSA1MCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdWludDMyW10gbWVtb3J5IF9yZXRQcml6ZXMgPSBuZXcgdWludDMyW10oX2luZGV4UHJpemVzKTsKCiAgICAgICAgZm9yIChfaW5kZXggPSAwOyBfaW5kZXggPCBfaW5kZXhQcml6ZXM7IF9pbmRleCsrKSB7CiAgICAgICAgICAgIF9yZXRQcml6ZXNbX2luZGV4XSA9IF9wcml6ZXNbX2luZGV4XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChfcmV0UHJpemVzKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0YWtlUHJpemUodWludDMyIF90dXJuLCB1aW50MjU2IGkpIHsKICAgICAgICByZXF1aXJlKF90dXJuID4gMCAmJiBfdHVybiA8IHR1cm4pOwogICAgICAgIGlmICh0dXJuID4gbnVtVHVybnNUb1Jldm9sdmUpCiAgICAgICAgICAgIHJlcXVpcmUoX3R1cm4gPj0gdHVybiAtIG51bVR1cm5zVG9SZXZvbHZlKTsKCiAgICAgICAgcmVxdWlyZShpIDwgdGlja2V0c1ttc2cuc2VuZGVyXVtfdHVybl0ubGVuZ3RoKTsKICAgICAgICB2YXIgX3RpY2tldCA9IHRpY2tldHNbbXNnLnNlbmRlcl1bX3R1cm5dW2ldOwoKICAgICAgICAvLyBpc1Rha2VuIG11c3QgYmUgZmFsc2UKICAgICAgICByZXF1aXJlKChfdGlja2V0ICYgMSkgPT0gMCk7CgogICAgICAgIC8vIGxvdHRvUmFuay5GSVZFX01BVENIICAgICAgMSBiaXQgICBbMjZdCiAgICAgICAgLy8gbG90dG9SYW5rLkJPTlVTX01BVENIICAgICAxIGJpdCAgIFsyN10KICAgICAgICAvLyBsb3R0b1JhbmsuU0lYX01BVENIICAgICAgIDEgYml0ICAgWzI4XQogICAgICAgIGlmICgoX3RpY2tldCA+PiAyNikgJiAxID09IDEpIHsKICAgICAgICAgICAgdWludDI1NiBfcHJpemVBbW91bnQgPSBfZ2V0Rml2ZU1hdGNoUHJpemVBbW91bnQoX3R1cm4pOwogICAgICAgICAgICByZXF1aXJlKF9wcml6ZUFtb3VudCA+IDApOwogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKF9wcml6ZUFtb3VudCk7CiAgICAgICAgICAgIEZpdmVNYXRjaFByaXplVGFrZW4obXNnLnNlbmRlciwgX3ByaXplQW1vdW50KTsKICAgICAgICAgICAgdGlja2V0c1ttc2cuc2VuZGVyXVtfdHVybl1baV0gfD0gMTsKICAgICAgICAgICAgdW50YWtlblByaXplQW1vdW50c1tfdHVybiAtIDFdIC09IF9wcml6ZUFtb3VudDsKICAgICAgICB9IGVsc2UgaWYgKChfdGlja2V0ID4+IDI3KSAmIDEgPT0gMSkgewogICAgICAgICAgICBfcHJpemVBbW91bnQgPSBfZ2V0Qm9udXNNYXRjaFByaXplQW1vdW50KF90dXJuKTsKICAgICAgICAgICAgcmVxdWlyZShfcHJpemVBbW91bnQgPiAwKTsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihfcHJpemVBbW91bnQpOwogICAgICAgICAgICBCb251c01hdGNoUHJpemVUYWtlbihtc2cuc2VuZGVyLCBfcHJpemVBbW91bnQpOwogICAgICAgICAgICB0aWNrZXRzW21zZy5zZW5kZXJdW190dXJuXVtpXSB8PSAxOwogICAgICAgICAgICB1bnRha2VuUHJpemVBbW91bnRzW190dXJuIC0gMV0gLT0gX3ByaXplQW1vdW50OwogICAgICAgIH0gZWxzZSBpZiAoKF90aWNrZXQgPj4gMjgpICYgMSA9PSAxKSB7CiAgICAgICAgICAgIF9wcml6ZUFtb3VudCA9IF9nZXRTaXhNYXRjaFByaXplQW1vdW50KF90dXJuKTsKICAgICAgICAgICAgcmVxdWlyZShfcHJpemVBbW91bnQgPiAwKTsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihfcHJpemVBbW91bnQpOwogICAgICAgICAgICBTaXhNYXRjaFByaXplVGFrZW4obXNnLnNlbmRlciwgX3ByaXplQW1vdW50KTsKICAgICAgICAgICAgdGlja2V0c1ttc2cuc2VuZGVyXVtfdHVybl1baV0gfD0gMTsKICAgICAgICAgICAgdW50YWtlblByaXplQW1vdW50c1tfdHVybiAtIDFdIC09IF9wcml6ZUFtb3VudDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX2dldEZpdmVNYXRjaFByaXplQW1vdW50KHVpbnQyNTYgX3R1cm4pIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF90dXJuID4gMCAmJiBfdHVybiA8IHR1cm4pOwogICAgICAgIHVpbnQyNTYgX251bUZpdmVNYXRjaFdpbm5lcnMgPSB1aW50MjU2KG51bUZpdmVNYXRjaFdpbm5lcnNbX3R1cm4gLSAxXSk7CiAgICAgICAgaWYgKF9udW1GaXZlTWF0Y2hXaW5uZXJzID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiByYWlzZWRBbW91bnRzW190dXJuIC0gMV0gKiBmaXZlTWF0Y2hQYXlvdXRJblBlcmNlbnQgLyAxMDAgLyBfbnVtRml2ZU1hdGNoV2lubmVyczsKICAgIH0KCiAgICBmdW5jdGlvbiBfZ2V0Qm9udXNNYXRjaFByaXplQW1vdW50KHVpbnQyNTYgX3R1cm4pIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF90dXJuID4gMCAmJiBfdHVybiA8IHR1cm4pOwogICAgICAgIHVpbnQyNTYgX251bUJvbnVzTWF0Y2hXaW5uZXJzID0gdWludDI1NihudW1Cb251c01hdGNoV2lubmVyc1tfdHVybiAtIDFdKTsKICAgICAgICBpZiAoX251bUJvbnVzTWF0Y2hXaW5uZXJzID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiByYWlzZWRBbW91bnRzW190dXJuIC0gMV0gKiBib251c01hdGNoUGF5b3V0SW5QZXJjZW50IC8gMTAwIC8gX251bUJvbnVzTWF0Y2hXaW5uZXJzOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRTaXhNYXRjaFByaXplQW1vdW50KHVpbnQyNTYgX3R1cm4pIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF90dXJuID4gMCAmJiBfdHVybiA8IHR1cm4pOwogICAgICAgIHVpbnQyNTYgX251bVNpeE1hdGNoV2lubmVycyA9IHVpbnQyNTYobnVtU2l4TWF0Y2hXaW5uZXJzW190dXJuIC0gMV0pOwogICAgICAgIGlmIChfbnVtU2l4TWF0Y2hXaW5uZXJzID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiByYWlzZWRBbW91bnRzW190dXJuIC0gMV0gKiBzaXhNYXRjaFBheW91dEluUGVyY2VudCAvIDEwMCAvIF9udW1TaXhNYXRjaFdpbm5lcnM7CiAgICB9CgogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIH0KfQ=='.
	

]
