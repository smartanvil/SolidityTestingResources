Class {
	#name : #SRT2139ecd8246594ef21267eafdae924130f967a3e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2139ecd8246594ef21267eafdae924130f967a3e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8vIGFjY2VwdGVkIGZyb20gemVwcGVsaW4tc29saWRpdHkgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQovKgogKiBFUkMyMCBpbnRlcmZhY2UKICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgewogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCi8vIGFjY2VwdGVkIGZyb20gemVwcGVsaW4tc29saWRpdHkgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA+IDApOwogICAgICAgIHVpbnQgYyA9IGEgLyBiOwogICAgICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEgJiYgYyA+PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgICAgICBpZiAoIWFzc2VydGlvbikgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9Cgp9CgovLy8gQHRpdGxlIE11bHRpc2lnbmF0dXJlIHdhbGxldCAtIEFsbG93cyBtdWx0aXBsZSBwYXJ0aWVzIHRvIGFncmVlIG9uIHRyYW5zYWN0aW9ucyBiZWZvcmUgZXhlY3V0aW9uLgovLy8gQGF1dGhvciBTdGVmYW4gR2VvcmdlIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI4MWYyZjVlNGU3ZTBlZmFmZTZlNGVlZjNlNmU0YzFlMmVlZWZmMmU0ZWZmMmY4ZjJhZmVmZTRmNSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CmNvbnRyYWN0IE11bHRpU2lnV2FsbGV0IHsKCiAgICAvLyBmbGFnIHRvIGRldGVybWluZSBpZiBhZGRyZXNzIGlzIGZvciBhIHJlYWwgY29udHJhY3Qgb3Igbm90CiAgICBib29sIHB1YmxpYyBpc011bHRpU2lnV2FsbGV0ID0gZmFsc2U7CgogICAgdWludCBjb25zdGFudCBwdWJsaWMgTUFYX09XTkVSX0NPVU5UID0gNTA7CgogICAgZXZlbnQgQ29uZmlybWF0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IFJldm9jYXRpb24oYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgU3VibWlzc2lvbih1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBFeGVjdXRpb24odWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgRXhlY3V0aW9uRmFpbHVyZSh1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBEZXBvc2l0KGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgT3duZXJBZGRpdGlvbihhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lcik7CiAgICBldmVudCBSZXF1aXJlbWVudENoYW5nZSh1aW50IHJlcXVpcmVkKTsKCiAgICBtYXBwaW5nICh1aW50ID0+IFRyYW5zYWN0aW9uKSBwdWJsaWMgdHJhbnNhY3Rpb25zOwogICAgbWFwcGluZyAodWludCA9PiBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpKSBwdWJsaWMgY29uZmlybWF0aW9uczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzT3duZXI7CiAgICBhZGRyZXNzW10gcHVibGljIG93bmVyczsKICAgIHVpbnQgcHVibGljIHJlcXVpcmVkOwogICAgdWludCBwdWJsaWMgdHJhbnNhY3Rpb25Db3VudDsKCiAgICBzdHJ1Y3QgVHJhbnNhY3Rpb24gewogICAgYWRkcmVzcyBkZXN0aW5hdGlvbjsKICAgIHVpbnQgdmFsdWU7CiAgICBieXRlcyBkYXRhOwogICAgYm9vbCBleGVjdXRlZDsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2FsbGV0KCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJEb2VzTm90RXhpc3QoYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmIChpc093bmVyW293bmVyXSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvd25lckV4aXN0cyhhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgaWYgKCFpc093bmVyW293bmVyXSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB0cmFuc2FjdGlvbkV4aXN0cyh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICBpZiAodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmRlc3RpbmF0aW9uID09IDApIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmICghY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90Q29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCwgYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyXSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RFeGVjdXRlZCh1aW50IHRyYW5zYWN0aW9uSWQpIHsKICAgICAgICBpZiAodHJhbnNhY3Rpb25zW3RyYW5zYWN0aW9uSWRdLmV4ZWN1dGVkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdE51bGwoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIGlmIChfYWRkcmVzcyA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkUmVxdWlyZW1lbnQodWludCBvd25lckNvdW50LCB1aW50IF9yZXF1aXJlZCkgewogICAgICAgIGlmIChvd25lckNvdW50ID4gTUFYX09XTkVSX0NPVU5UKSB0aHJvdzsKICAgICAgICBpZiAoX3JlcXVpcmVkID4gb3duZXJDb3VudCkgdGhyb3c7CiAgICAgICAgaWYgKF9yZXF1aXJlZCA9PSAwKSB0aHJvdzsKICAgICAgICBpZiAob3duZXJDb3VudCA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIGFsbG93cyB0byBkZXBvc2l0IGV0aGVyLgogICAgZnVuY3Rpb24oKQogICAgcGF5YWJsZQogICAgewogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKQogICAgICAgIERlcG9zaXQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvKgogICAgICogUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBzZXRzIGluaXRpYWwgb3duZXJzIGFuZCByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucy4KICAgIC8vLyBAcGFyYW0gX293bmVycyBMaXN0IG9mIGluaXRpYWwgb3duZXJzLgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBNdWx0aVNpZ1dhbGxldChhZGRyZXNzW10gX293bmVycywgdWludCBfcmVxdWlyZWQpCiAgICBwdWJsaWMKICAgIHZhbGlkUmVxdWlyZW1lbnQoX293bmVycy5sZW5ndGgsIF9yZXF1aXJlZCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPF9vd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGlzT3duZXJbX293bmVyc1tpXV0gfHwgX293bmVyc1tpXSA9PSAwKSB0aHJvdzsKICAgICAgICAgICAgaXNPd25lcltfb3duZXJzW2ldXSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlzTXVsdGlTaWdXYWxsZXQgPSB0cnVlOwogICAgICAgIG93bmVycyA9IF9vd25lcnM7CiAgICAgICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIGFkZCBhIG5ldyBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG5ldyBvd25lci4KICAgIGZ1bmN0aW9uIGFkZE93bmVyKGFkZHJlc3Mgb3duZXIpCiAgICBwdWJsaWMKICAgIG9ubHlXYWxsZXQKICAgIG93bmVyRG9lc05vdEV4aXN0KG93bmVyKQogICAgbm90TnVsbChvd25lcikKICAgIHZhbGlkUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCArIDEsIHJlcXVpcmVkKQogICAgewogICAgICAgIGlzT3duZXJbb3duZXJdID0gdHJ1ZTsKICAgICAgICBvd25lcnMucHVzaChvd25lcik7CiAgICAgICAgT3duZXJBZGRpdGlvbihvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHJlbW92ZSBhbiBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG93bmVyLgogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBvd25lcikKICAgIHB1YmxpYwogICAgb25seVdhbGxldAogICAgb3duZXJFeGlzdHMob3duZXIpCiAgICB7CiAgICAgICAgaXNPd25lcltvd25lcl0gPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPG93bmVycy5sZW5ndGggLSAxOyBpKyspCiAgICAgICAgaWYgKG93bmVyc1tpXSA9PSBvd25lcikgewogICAgICAgICAgICBvd25lcnNbaV0gPSBvd25lcnNbb3duZXJzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgb3duZXJzLmxlbmd0aCAtPSAxOwogICAgICAgIGlmIChyZXF1aXJlZCA+IG93bmVycy5sZW5ndGgpCiAgICAgICAgY2hhbmdlUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCk7CiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gcmVwbGFjZSBhbiBvd25lciB3aXRoIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2Ygb3duZXIgdG8gYmUgcmVwbGFjZWQuCiAgICAvLy8gQHBhcmFtIG5ld093bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgLy8vIEBwYXJhbSBpbmRleCB0aGUgaW5keCBvZiB0aGUgb3duZXIgdG8gYmUgcmVwbGFjZWQKICAgIGZ1bmN0aW9uIHJlcGxhY2VPd25lckluZGV4ZWQoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBuZXdPd25lciwgdWludCBpbmRleCkKICAgIHB1YmxpYwogICAgb25seVdhbGxldAogICAgb3duZXJFeGlzdHMob3duZXIpCiAgICBvd25lckRvZXNOb3RFeGlzdChuZXdPd25lcikKICAgIHsKICAgICAgICBpZiAob3duZXJzW2luZGV4XSAhPSBvd25lcikgdGhyb3c7CiAgICAgICAgb3duZXJzW2luZGV4XSA9IG5ld093bmVyOwogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7CiAgICAgICAgaXNPd25lcltuZXdPd25lcl0gPSB0cnVlOwogICAgICAgIE93bmVyUmVtb3ZhbChvd25lcik7CiAgICAgICAgT3duZXJBZGRpdGlvbihuZXdPd25lcik7CiAgICB9CgoKICAgIC8vLyBAZGV2IEFsbG93cyB0byBjaGFuZ2UgdGhlIG51bWJlciBvZiByZXF1aXJlZCBjb25maXJtYXRpb25zLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIF9yZXF1aXJlZCBOdW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4KICAgIGZ1bmN0aW9uIGNoYW5nZVJlcXVpcmVtZW50KHVpbnQgX3JlcXVpcmVkKQogICAgcHVibGljCiAgICBvbmx5V2FsbGV0CiAgICB2YWxpZFJlcXVpcmVtZW50KG93bmVycy5sZW5ndGgsIF9yZXF1aXJlZCkKICAgIHsKICAgICAgICByZXF1aXJlZCA9IF9yZXF1aXJlZDsKICAgICAgICBSZXF1aXJlbWVudENoYW5nZShfcmVxdWlyZWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byBzdWJtaXQgYW5kIGNvbmZpcm0gYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gZGVzdGluYXRpb24gVHJhbnNhY3Rpb24gdGFyZ2V0IGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHZhbHVlIFRyYW5zYWN0aW9uIGV0aGVyIHZhbHVlLgogICAgLy8vIEBwYXJhbSBkYXRhIFRyYW5zYWN0aW9uIGRhdGEgcGF5bG9hZC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgdHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBzdWJtaXRUcmFuc2FjdGlvbihhZGRyZXNzIGRlc3RpbmF0aW9uLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKQogICAgcHVibGljCiAgICByZXR1cm5zICh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgdHJhbnNhY3Rpb25JZCA9IGFkZFRyYW5zYWN0aW9uKGRlc3RpbmF0aW9uLCB2YWx1ZSwgZGF0YSk7CiAgICAgICAgY29uZmlybVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBjb25maXJtVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgcHVibGljCiAgICBvd25lckV4aXN0cyhtc2cuc2VuZGVyKQogICAgdHJhbnNhY3Rpb25FeGlzdHModHJhbnNhY3Rpb25JZCkKICAgIG5vdENvbmZpcm1lZCh0cmFuc2FjdGlvbklkLCBtc2cuc2VuZGVyKQogICAgewogICAgICAgIGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCB0cmFuc2FjdGlvbklkKTsKICAgICAgICBleGVjdXRlVHJhbnNhY3Rpb24odHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFuIG93bmVyIHRvIHJldm9rZSBhIGNvbmZpcm1hdGlvbiBmb3IgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIHJldm9rZUNvbmZpcm1hdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBwdWJsaWMKICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICBjb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikKICAgIG5vdEV4ZWN1dGVkKHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVttc2cuc2VuZGVyXSA9IGZhbHNlOwogICAgICAgIFJldm9jYXRpb24obXNnLnNlbmRlciwgdHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY29uZmlybWF0aW9uIHN0YXR1cyBvZiBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgLy8vIEByZXR1cm4gQ29uZmlybWF0aW9uIHN0YXR1cy4KICAgIGZ1bmN0aW9uIGlzQ29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxvd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkKICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgICAgaWYgKGNvdW50ID09IHJlcXVpcmVkKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLy8vIEBkZXYgQWxsb3dzIGFueW9uZSB0byBleGVjdXRlIGEgY29uZmlybWVkIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gZXhlY3V0ZVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIGludGVybmFsCiAgICBub3RFeGVjdXRlZCh0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIGlmIChpc0NvbmZpcm1lZCh0cmFuc2FjdGlvbklkKSkgewogICAgICAgICAgICBUcmFuc2FjdGlvbiB0eCA9IHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXTsKICAgICAgICAgICAgdHguZXhlY3V0ZWQgPSB0cnVlOwogICAgICAgICAgICBpZiAodHguZGVzdGluYXRpb24uY2FsbC52YWx1ZSh0eC52YWx1ZSkodHguZGF0YSkpCiAgICAgICAgICAgIEV4ZWN1dGlvbih0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBFeGVjdXRpb25GYWlsdXJlKHRyYW5zYWN0aW9uSWQpOwogICAgICAgICAgICAgICAgdHguZXhlY3V0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBZGRzIGEgbmV3IHRyYW5zYWN0aW9uIHRvIHRoZSB0cmFuc2FjdGlvbiBtYXBwaW5nLCBpZiB0cmFuc2FjdGlvbiBkb2VzIG5vdCBleGlzdCB5ZXQuCiAgICAvLy8gQHBhcmFtIGRlc3RpbmF0aW9uIFRyYW5zYWN0aW9uIHRhcmdldCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUcmFuc2FjdGlvbiBldGhlciB2YWx1ZS4KICAgIC8vLyBAcGFyYW0gZGF0YSBUcmFuc2FjdGlvbiBkYXRhIHBheWxvYWQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gYWRkVHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkKICAgIGludGVybmFsCiAgICBub3ROdWxsKGRlc3RpbmF0aW9uKQogICAgcmV0dXJucyAodWludCB0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIHRyYW5zYWN0aW9uSWQgPSB0cmFuc2FjdGlvbkNvdW50OwogICAgICAgIHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXSA9IFRyYW5zYWN0aW9uKHsKICAgICAgICBkZXN0aW5hdGlvbjogZGVzdGluYXRpb24sCiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgZXhlY3V0ZWQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgdHJhbnNhY3Rpb25Db3VudCArPSAxOwogICAgICAgIFN1Ym1pc3Npb24odHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLyoKICAgICAqIFdlYjMgY2FsbCBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBvZiBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBnZXRDb25maXJtYXRpb25Db3VudCh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50IGNvdW50KQogICAgewogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aDsgaSsrKQogICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pCiAgICAgICAgY291bnQgKz0gMTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRvdGFsIG51bWJlciBvZiB0cmFuc2FjdGlvbnMgYWZ0ZXIgZmlsZXJzIGFyZSBhcHBsaWVkLgogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLgogICAgLy8vIEByZXR1cm4gVG90YWwgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhZnRlciBmaWx0ZXJzIGFyZSBhcHBsaWVkLgogICAgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25Db3VudChib29sIHBlbmRpbmcsIGJvb2wgZXhlY3V0ZWQpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50IGNvdW50KQogICAgewogICAgICAgIGZvciAodWludCBpPTA7IGk8dHJhbnNhY3Rpb25Db3VudDsgaSsrKQogICAgICAgIGlmICgocGVuZGluZyAmJiAhdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKSB8fAogICAgICAgIChleGVjdXRlZCAmJiB0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQpKQogICAgICAgIGNvdW50ICs9IDE7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIG93bmVycy4KICAgIC8vLyBAcmV0dXJuIExpc3Qgb2Ygb3duZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0T3duZXJzKCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKGFkZHJlc3NbXSkKICAgIHsKICAgICAgICByZXR1cm4gb3duZXJzOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgYXJyYXkgd2l0aCBvd25lciBhZGRyZXNzZXMsIHdoaWNoIGNvbmZpcm1lZCB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYXJyYXkgb2Ygb3duZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9ucyh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zIChhZGRyZXNzW10gX2NvbmZpcm1hdGlvbnMpCiAgICB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBjb25maXJtYXRpb25zVGVtcCA9IG5ldyBhZGRyZXNzW10ob3duZXJzLmxlbmd0aCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaT0wOyBpPG93bmVycy5sZW5ndGg7IGkrKykKICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKSB7CiAgICAgICAgICAgIGNvbmZpcm1hdGlvbnNUZW1wW2NvdW50XSA9IG93bmVyc1tpXTsKICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICB9CiAgICAgICAgX2NvbmZpcm1hdGlvbnMgPSBuZXcgYWRkcmVzc1tdKGNvdW50KTsKICAgICAgICBmb3IgKGk9MDsgaTxjb3VudDsgaSsrKQogICAgICAgIF9jb25maXJtYXRpb25zW2ldID0gY29uZmlybWF0aW9uc1RlbXBbaV07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBsaXN0IG9mIHRyYW5zYWN0aW9uIElEcyBpbiBkZWZpbmVkIHJhbmdlLgogICAgLy8vIEBwYXJhbSBmcm9tIEluZGV4IHN0YXJ0IHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSB0byBJbmRleCBlbmQgcG9zaXRpb24gb2YgdHJhbnNhY3Rpb24gYXJyYXkuCiAgICAvLy8gQHBhcmFtIHBlbmRpbmcgSW5jbHVkZSBwZW5kaW5nIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gZXhlY3V0ZWQgSW5jbHVkZSBleGVjdXRlZCB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIGFycmF5IG9mIHRyYW5zYWN0aW9uIElEcy4KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uSWRzKHVpbnQgZnJvbSwgdWludCB0bywgYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludFtdIF90cmFuc2FjdGlvbklkcykKICAgIHsKICAgICAgICB1aW50W10gbWVtb3J5IHRyYW5zYWN0aW9uSWRzVGVtcCA9IG5ldyB1aW50W10odHJhbnNhY3Rpb25Db3VudCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaT0wOyBpPHRyYW5zYWN0aW9uQ291bnQ7IGkrKykKICAgICAgICBpZiAoKHBlbmRpbmcgJiYgIXRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkgfHwKICAgICAgICAoZXhlY3V0ZWQgJiYgdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKSkKICAgICAgICB7CiAgICAgICAgICAgIHRyYW5zYWN0aW9uSWRzVGVtcFtjb3VudF0gPSBpOwogICAgICAgICAgICBjb3VudCArPSAxOwogICAgICAgIH0KICAgICAgICBfdHJhbnNhY3Rpb25JZHMgPSBuZXcgdWludFtdKHRvIC0gZnJvbSk7CiAgICAgICAgZm9yIChpPWZyb207IGk8dG87IGkrKykKICAgICAgICBfdHJhbnNhY3Rpb25JZHNbaSAtIGZyb21dID0gdHJhbnNhY3Rpb25JZHNUZW1wW2ldOwogICAgfQoKfQoKY29udHJhY3QgT2xkVG9rZW4gaXMgRVJDMjAgewogICAgLy8gZmxhZyB0byBkZXRlcm1pbmUgaWYgYWRkcmVzcyBpcyBmb3IgYSByZWFsIGNvbnRyYWN0IG9yIG5vdAogICAgYm9vbCBwdWJsaWMgaXNEZWNlbnRCZXRUb2tlbjsKCiAgICBhZGRyZXNzIHB1YmxpYyBkZWNlbnRCZXRNdWx0aXNpZzsKfQoKY29udHJhY3QgTmV4dFVwZ3JhZGVBZ2VudCBpcyBTYWZlTWF0aCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICBib29sIHB1YmxpYyBpc1VwZ3JhZGVBZ2VudDsKCiAgICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwoKICAgIGZ1bmN0aW9uIGZpbmFsaXplVXBncmFkZSgpIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBzZXRPcmlnaW5hbFN1cHBseSgpIHB1YmxpYzsKfQoKLy8vIEB0aXRsZSBUaW1lLWxvY2tlZCB2YXVsdCBvZiB0b2tlbnMgYWxsb2NhdGVkIHRvIERlY2VudEJldCBhZnRlciAzNjUgZGF5cwpjb250cmFjdCBOZXdEZWNlbnRCZXRWYXVsdCBpcyBTYWZlTWF0aCB7CgogICAgLy8gZmxhZyB0byBkZXRlcm1pbmUgaWYgYWRkcmVzcyBpcyBmb3IgYSByZWFsIGNvbnRyYWN0IG9yIG5vdAogICAgYm9vbCBwdWJsaWMgaXNEZWNlbnRCZXRWYXVsdCA9IGZhbHNlOwoKICAgIE5ld0RlY2VudEJldFRva2VuIGRlY2VudEJldFRva2VuOwoKICAgIGFkZHJlc3MgZGVjZW50QmV0TXVsdGlzaWc7CgogICAgdWludDI1NiB1bmxvY2tlZEF0VGltZTsKCiAgICAvLyAxIHllYXIgbG9ja3VwCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCB0aW1lT2Zmc2V0ID0gNDcgd2Vla3M7CgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyB0aGUgRGVjZW50QmV0IE11bHRpc2lnIGFkZHJlc3MgYW5kCiAgICAvLy8gdG90YWwgbnVtYmVyIG9mIGxvY2tlZCB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIGZ1bmN0aW9uIE5ld0RlY2VudEJldFZhdWx0KGFkZHJlc3MgX2RlY2VudEJldE11bHRpc2lnKSAvKiogaW50ZXJuYWwgKi8gewogICAgICAgIGlmIChfZGVjZW50QmV0TXVsdGlzaWcgPT0gMHgwKSByZXZlcnQoKTsKICAgICAgICBkZWNlbnRCZXRUb2tlbiA9IE5ld0RlY2VudEJldFRva2VuKG1zZy5zZW5kZXIpOwogICAgICAgIGRlY2VudEJldE11bHRpc2lnID0gX2RlY2VudEJldE11bHRpc2lnOwogICAgICAgIGlzRGVjZW50QmV0VmF1bHQgPSB0cnVlOwoKICAgICAgICAvLyAxIHllYXIgbGF0ZXIKICAgICAgICB1bmxvY2tlZEF0VGltZSA9IHNhZmVBZGQoZ2V0VGltZSgpLCB0aW1lT2Zmc2V0KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBsb2NrZWQgdG9rZW5zIHRvIERlY2VudC5iZXQncyBtdWx0aXNpZyB3YWxsZXQKICAgIGZ1bmN0aW9uIHVubG9jaygpIGV4dGVybmFsIHsKICAgICAgICAvLyBXYWl0IHlvdXIgdHVybiEKICAgICAgICBpZiAoZ2V0VGltZSgpIDwgdW5sb2NrZWRBdFRpbWUpIHJldmVydCgpOwogICAgICAgIC8vIFdpbGwgZmFpbCBpZiBhbGxvY2F0aW9uIChhbmQgdGhlcmVmb3JlIHRvVHJhbnNmZXIpIGlzIDAuCiAgICAgICAgaWYgKCFkZWNlbnRCZXRUb2tlbi50cmFuc2ZlcihkZWNlbnRCZXRNdWx0aXNpZywgZGVjZW50QmV0VG9rZW4uYmFsYW5jZU9mKHRoaXMpKSkgcmV2ZXJ0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZSgpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIC8vIGRpc2FsbG93IEVUSCBwYXltZW50cyB0byBUaW1lVmF1bHQKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9Cgp9Cgpjb250cmFjdCBOZXdEZWNlbnRCZXRUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGggewoKICAgIC8vIFRva2VuIGluZm9ybWF0aW9uCiAgICBib29sIHB1YmxpYyBpc0RlY2VudEJldFRva2VuOwoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJEZWNlbnQuQmV0IFRva2VuIjsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJEQkVUIjsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OyAgLy8gZGVjaW1hbCBwbGFjZXMKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBob3VzZVBlcmNlbnRPZlRvdGFsID0gMTA7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdmF1bHRQZXJjZW50T2ZUb3RhbCA9IDE4OwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGJvdW50eVBlcmNlbnRPZlRvdGFsID0gMjsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBjcm93ZGZ1bmRQZXJjZW50T2ZUb3RhbCA9IDcwOwoKICAgIC8vIGZsYWcgdG8gZGV0ZXJtaW5lIGlmIGFkZHJlc3MgaXMgZm9yIGEgcmVhbCBjb250cmFjdCBvciBub3QKICAgIGJvb2wgcHVibGljIGlzTmV3VG9rZW4gPSBmYWxzZTsKCiAgICAvLyBUb2tlbiBpbmZvcm1hdGlvbgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gVXBncmFkZSBpbmZvcm1hdGlvbgogICAgTmV3VXBncmFkZUFnZW50IHB1YmxpYyB1cGdyYWRlQWdlbnQ7CgogICAgTmV4dFVwZ3JhZGVBZ2VudCBwdWJsaWMgbmV4dFVwZ3JhZGVBZ2VudDsKCiAgICBib29sIHB1YmxpYyBmaW5hbGl6ZWROZXh0VXBncmFkZSA9IGZhbHNlOwoKICAgIGFkZHJlc3MgcHVibGljIG5leHRVcGdyYWRlTWFzdGVyOwoKICAgIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CgogICAgZXZlbnQgVXBncmFkZUZpbmFsaXplZChhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyBuZXh0VXBncmFkZUFnZW50KTsKCiAgICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxVcGdyYWRlZDsKCiAgICAvLyBPbGQgVG9rZW4gSW5mb3JtYXRpb24KICAgIE9sZFRva2VuIHB1YmxpYyBvbGRUb2tlbjsKCiAgICBhZGRyZXNzIHB1YmxpYyBkZWNlbnRCZXRNdWx0aXNpZzsKCiAgICB1aW50MjU2IHB1YmxpYyBvbGRUb2tlblRvdGFsU3VwcGx5OwoKICAgIE5ld0RlY2VudEJldFZhdWx0IHB1YmxpYyB0aW1lVmF1bHQ7CgogICAgZnVuY3Rpb24gTmV3RGVjZW50QmV0VG9rZW4oYWRkcmVzcyBfdXBncmFkZUFnZW50LAogICAgYWRkcmVzcyBfb2xkVG9rZW4sIGFkZHJlc3MgX25leHRVcGdyYWRlTWFzdGVyKSBwdWJsaWMgewoKICAgICAgICBpc05ld1Rva2VuID0gdHJ1ZTsKCiAgICAgICAgaXNEZWNlbnRCZXRUb2tlbiA9IHRydWU7CgogICAgICAgIGlmIChfdXBncmFkZUFnZW50ID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgdXBncmFkZUFnZW50ID0gTmV3VXBncmFkZUFnZW50KF91cGdyYWRlQWdlbnQpOwoKICAgICAgICBpZiAoX25leHRVcGdyYWRlTWFzdGVyID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgbmV4dFVwZ3JhZGVNYXN0ZXIgPSBfbmV4dFVwZ3JhZGVNYXN0ZXI7CgogICAgICAgIG9sZFRva2VuID0gT2xkVG9rZW4oX29sZFRva2VuKTsKICAgICAgICBpZiAoIW9sZFRva2VuLmlzRGVjZW50QmV0VG9rZW4oKSkgcmV2ZXJ0KCk7CiAgICAgICAgb2xkVG9rZW5Ub3RhbFN1cHBseSA9IG9sZFRva2VuLnRvdGFsU3VwcGx5KCk7CgogICAgICAgIGRlY2VudEJldE11bHRpc2lnID0gb2xkVG9rZW4uZGVjZW50QmV0TXVsdGlzaWcoKTsKICAgICAgICBpZiAoIU11bHRpU2lnV2FsbGV0KGRlY2VudEJldE11bHRpc2lnKS5pc011bHRpU2lnV2FsbGV0KCkpIHJldmVydCgpOwoKICAgICAgICB0aW1lVmF1bHQgPSBuZXcgTmV3RGVjZW50QmV0VmF1bHQoZGVjZW50QmV0TXVsdGlzaWcpOwogICAgICAgIGlmICghdGltZVZhdWx0LmlzRGVjZW50QmV0VmF1bHQoKSkgcmV2ZXJ0KCk7CgogICAgICAgIC8vIEZvdW5kZXIncyBzdXBwbHkgOiAxOCUgb2YgdG90YWwgZ29lcyB0byB2YXVsdCwgdGltZSBsb2NrZWQgZm9yIDEgeWVhcgogICAgICAgIHVpbnQyNTYgdmF1bHRUb2tlbnMgPSBzYWZlRGl2KHNhZmVNdWwob2xkVG9rZW5Ub3RhbFN1cHBseSwgdmF1bHRQZXJjZW50T2ZUb3RhbCksCiAgICAgICAgY3Jvd2RmdW5kUGVyY2VudE9mVG90YWwpOwogICAgICAgIGJhbGFuY2VzW3RpbWVWYXVsdF0gPSBzYWZlQWRkKGJhbGFuY2VzW3RpbWVWYXVsdF0sIHZhdWx0VG9rZW5zKTsKICAgICAgICBUcmFuc2ZlcigwLCB0aW1lVmF1bHQsIHZhdWx0VG9rZW5zKTsKCiAgICAgICAgLy8gSG91c2U6IDEwJSBvZiB0b3RhbCBnb2VzIHRvIERlY2VudC5iZXQgZm9yIGluaXRpYWwgaG91c2Ugc2V0dXAKICAgICAgICB1aW50MjU2IGhvdXNlVG9rZW5zID0gc2FmZURpdihzYWZlTXVsKG9sZFRva2VuVG90YWxTdXBwbHksIGhvdXNlUGVyY2VudE9mVG90YWwpLAogICAgICAgIGNyb3dkZnVuZFBlcmNlbnRPZlRvdGFsKTsKICAgICAgICBiYWxhbmNlc1tkZWNlbnRCZXRNdWx0aXNpZ10gPSBzYWZlQWRkKGJhbGFuY2VzW2RlY2VudEJldE11bHRpc2lnXSwgaG91c2VUb2tlbnMpOwogICAgICAgIFRyYW5zZmVyKDAsIGRlY2VudEJldE11bHRpc2lnLCBob3VzZVRva2Vucyk7CgogICAgICAgIC8vIEJvdW50aWVzOiAyJSBvZiB0b3RhbCBnb2VzIHRvIERlY2VudCBiZXQgZm9yIGJvdW50aWVzCiAgICAgICAgdWludDI1NiBib3VudHlUb2tlbnMgPSBzYWZlRGl2KHNhZmVNdWwob2xkVG9rZW5Ub3RhbFN1cHBseSwgYm91bnR5UGVyY2VudE9mVG90YWwpLAogICAgICAgIGNyb3dkZnVuZFBlcmNlbnRPZlRvdGFsKTsKICAgICAgICBiYWxhbmNlc1tkZWNlbnRCZXRNdWx0aXNpZ10gPSBzYWZlQWRkKGJhbGFuY2VzW2RlY2VudEJldE11bHRpc2lnXSwgYm91bnR5VG9rZW5zKTsKICAgICAgICBUcmFuc2ZlcigwLCBkZWNlbnRCZXRNdWx0aXNpZywgYm91bnR5VG9rZW5zKTsKCiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHNhZmVBZGQodmF1bHRUb2tlbnMsIGhvdXNlVG9rZW5zKSwgYm91bnR5VG9rZW5zKTsKICAgIH0KCiAgICAvLyBVcGdyYWRlLXJlbGF0ZWQgbWV0aG9kcwogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW4oYWRkcmVzcyBfdGFyZ2V0LCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyh1cGdyYWRlQWdlbnQpKSByZXZlcnQoKTsKICAgICAgICBpZiAoX2Ftb3VudCA9PSAwKSByZXZlcnQoKTsKCiAgICAgICAgYmFsYW5jZXNbX3RhcmdldF0gPSBzYWZlQWRkKGJhbGFuY2VzW190YXJnZXRdLCBfYW1vdW50KTsKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVBZGQodG90YWxTdXBwbHksIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF90YXJnZXQsIF90YXJnZXQsIF9hbW91bnQpOwogICAgfQoKICAgIC8vIEVSQzIwIGludGVyZmFjZTogdHJhbnNmZXIgX3ZhbHVlIG5ldyB0b2tlbnMgZnJvbSBtc2cuc2VuZGVyIHRvIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoX3RvID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHVwZ3JhZGVBZ2VudCkpIHJldmVydCgpOwogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcyh0aGlzKSkgcmV2ZXJ0KCk7CiAgICAgICAgLy9pZiAoX3RvID09IGFkZHJlc3MoVXBncmFkZUFnZW50KHVwZ3JhZGVBZ2VudCkub2xkVG9rZW4oKSkpIHJldmVydCgpOwogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2Uge3JldHVybiBmYWxzZTt9CiAgICB9CgogICAgLy8gRVJDMjAgaW50ZXJmYWNlOiB0cmFuc2ZlciBfdmFsdWUgbmV3IHRva2VucyBmcm9tIF9mcm9tIHRvIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKF90byA9PSAweDApIHJldmVydCgpOwogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcyh1cGdyYWRlQWdlbnQpKSByZXZlcnQoKTsKICAgICAgICBpZiAoX3RvID09IGFkZHJlc3ModGhpcykpIHJldmVydCgpOwogICAgICAgIC8vaWYgKF90byA9PSBhZGRyZXNzKFVwZ3JhZGVBZ2VudCh1cGdyYWRlQWdlbnQpLm9sZFRva2VuKCkpKSByZXZlcnQoKTsKICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUpIHsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2Uge3JldHVybiBmYWxzZTt9CiAgICB9CgogICAgLy8gRVJDMjAgaW50ZXJmYWNlOiBkZWxlZ2F0ZSB0cmFuc2ZlciByaWdodHMgb2YgdXAgdG8gX3ZhbHVlIG5ldyB0b2tlbnMgZnJvbQogICAgLy8gbXNnLnNlbmRlciB0byBfc3BlbmRlcgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gRVJDMjAgaW50ZXJmYWNlOiByZXR1cm5zIHRoZSBhbW91bnQgb2YgbmV3IHRva2VucyBiZWxvbmdpbmcgdG8gX293bmVyCiAgICAvLyB0aGF0IF9zcGVuZGVyIGNhbiBzcGVuZCB2aWEgdHJhbnNmZXJGcm9tCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8gRVJDMjAgaW50ZXJmYWNlOiByZXR1cm5zIHRoZSB3bW91bnQgb2YgbmV3IHRva2VucyBiZWxvbmdpbmcgdG8gX293bmVyCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIC8vIFRva2VuIHVwZ3JhZGUgZnVuY3Rpb25hbGl0eQoKICAgIC8vLyBAbm90aWNlIFVwZ3JhZGUgdG9rZW5zIHRvIHRoZSBuZXcgdG9rZW4gY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIHZhbHVlIFRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIHVwZ3JhZGUKICAgIGZ1bmN0aW9uIHVwZ3JhZGUodWludDI1NiB2YWx1ZSkgZXh0ZXJuYWwgewogICAgICAgIGlmIChuZXh0VXBncmFkZUFnZW50Lm93bmVyKCkgPT0gMHgwKSByZXZlcnQoKTsKICAgICAgICAvLyBuZWVkIGEgcmVhbCB1cGdyYWRlQWdlbnQgYWRkcmVzcwogICAgICAgIGlmIChmaW5hbGl6ZWROZXh0VXBncmFkZSkgcmV2ZXJ0KCk7CiAgICAgICAgLy8gY2Fubm90IHVwZ3JhZGUgaWYgZmluYWxpemVkCgogICAgICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLgogICAgICAgIGlmICh2YWx1ZSA9PSAwKSByZXZlcnQoKTsKICAgICAgICBpZiAodmFsdWUgPiBiYWxhbmNlc1ttc2cuc2VuZGVyXSkgcmV2ZXJ0KCk7CgogICAgICAgIC8vIHVwZGF0ZSB0aGUgYmFsYW5jZXMgaGVyZSBmaXJzdCBiZWZvcmUgY2FsbGluZyBvdXQgKHJlZW50cmFuY3kpCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCB2YWx1ZSk7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCB2YWx1ZSk7CiAgICAgICAgdG90YWxVcGdyYWRlZCA9IHNhZmVBZGQodG90YWxVcGdyYWRlZCwgdmFsdWUpOwogICAgICAgIG5leHRVcGdyYWRlQWdlbnQudXBncmFkZUZyb20obXNnLnNlbmRlciwgdmFsdWUpOwogICAgICAgIFVwZ3JhZGUobXNnLnNlbmRlciwgbmV4dFVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBhZGRyZXNzIG9mIG5leHQgdXBncmFkZSB0YXJnZXQgY29udHJhY3QgYW5kIGVuYWJsZSB1cGdyYWRlCiAgICAvLy8gcHJvY2Vzcy4KICAgIC8vLyBAcGFyYW0gYWdlbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIFVwZ3JhZGVBZ2VudCBjb250cmFjdAogICAgZnVuY3Rpb24gc2V0TmV4dFVwZ3JhZGVBZ2VudChhZGRyZXNzIGFnZW50KSBleHRlcm5hbCB7CiAgICAgICAgaWYgKGFnZW50ID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgLy8gZG9uJ3Qgc2V0IGFnZW50IHRvIG5vdGhpbmcKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBuZXh0VXBncmFkZU1hc3RlcikgcmV2ZXJ0KCk7CiAgICAgICAgLy8gT25seSBhIG1hc3RlciBjYW4gZGVzaWduYXRlIHRoZSBuZXh0IGFnZW50CiAgICAgICAgbmV4dFVwZ3JhZGVBZ2VudCA9IE5leHRVcGdyYWRlQWdlbnQoYWdlbnQpOwogICAgICAgIGlmICghbmV4dFVwZ3JhZGVBZ2VudC5pc1VwZ3JhZGVBZ2VudCgpKSByZXZlcnQoKTsKICAgICAgICBuZXh0VXBncmFkZUFnZW50LnNldE9yaWdpbmFsU3VwcGx5KCk7CiAgICAgICAgVXBncmFkZUFnZW50U2V0KG5leHRVcGdyYWRlQWdlbnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBhZGRyZXNzIG9mIG5leHQgdXBncmFkZSBtYXN0ZXIgYW5kIGVuYWJsZSB1cGdyYWRlCiAgICAvLy8gcHJvY2Vzcy4KICAgIC8vLyBAcGFyYW0gbWFzdGVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBtYW5hZ2UgdXBncmFkZXMsIG5vdCB0aGUgdXBncmFkZUFnZW50IGNvbnRyYWN0IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldE5leHRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKG1hc3RlciA9PSAweDApIHJldmVydCgpOwogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG5leHRVcGdyYWRlTWFzdGVyKSByZXZlcnQoKTsKICAgICAgICAvLyBPbmx5IGEgbWFzdGVyIGNhbiBkZXNpZ25hdGUgdGhlIG5leHQgbWFzdGVyCiAgICAgICAgbmV4dFVwZ3JhZGVNYXN0ZXIgPSBtYXN0ZXI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgZmluYWxpemUgdGhlIHVwZ3JhZGUKICAgIC8vLyBAZGV2IFJlcXVpcmVkIHN0YXRlOiBTdWNjZXNzCiAgICBmdW5jdGlvbiBmaW5hbGl6ZU5leHRVcGdyYWRlKCkgZXh0ZXJuYWwgewogICAgICAgIGlmIChuZXh0VXBncmFkZUFnZW50Lm93bmVyKCkgPT0gMHgwKSByZXZlcnQoKTsKICAgICAgICAvLyB3ZSBuZWVkIGEgdmFsaWQgdXBncmFkZSBhZ2VudAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG5leHRVcGdyYWRlTWFzdGVyKSByZXZlcnQoKTsKICAgICAgICAvLyBvbmx5IHVwZ3JhZGVNYXN0ZXIgY2FuIGZpbmFsaXplCiAgICAgICAgaWYgKGZpbmFsaXplZE5leHRVcGdyYWRlKSByZXZlcnQoKTsKICAgICAgICAvLyBjYW4ndCBmaW5hbGl6ZSB0d2ljZQoKICAgICAgICBmaW5hbGl6ZWROZXh0VXBncmFkZSA9IHRydWU7CiAgICAgICAgLy8gcHJldmVudCBmdXR1cmUgdXBncmFkZXMKCiAgICAgICAgbmV4dFVwZ3JhZGVBZ2VudC5maW5hbGl6ZVVwZ3JhZGUoKTsKICAgICAgICAvLyBjYWxsIGZpbmFsaXplIHVwZ3JhZGUgb24gbmV3IGNvbnRyYWN0CiAgICAgICAgVXBncmFkZUZpbmFsaXplZChtc2cuc2VuZGVyLCBuZXh0VXBncmFkZUFnZW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiB0aHJvd3MgdG8gYXZvaWQgYWNjaWRlbnRhbGx5IGxvc2luZyBtb25leQogICAgZnVuY3Rpb24oKSB7cmV2ZXJ0KCk7fQp9CgoKLy9UZXN0IHRoZSB3aG9sZSBwcm9jZXNzIGFnYWluc3QgdGhpczogaHR0cHM6Ly93d3cua2luZ29mdGhlZXRoZXIuY29tL2NvbnRyYWN0LXNhZmV0eS1jaGVja2xpc3QuaHRtbApjb250cmFjdCBOZXdVcGdyYWRlQWdlbnQgaXMgU2FmZU1hdGggewoKICAgIC8vIGZsYWcgdG8gZGV0ZXJtaW5lIGlmIGFkZHJlc3MgaXMgZm9yIGEgcmVhbCBjb250cmFjdCBvciBub3QKICAgIGJvb2wgcHVibGljIGlzVXBncmFkZUFnZW50ID0gZmFsc2U7CgogICAgLy8gQ29udHJhY3QgaW5mb3JtYXRpb24KICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIC8vIFVwZ3JhZGUgaW5mb3JtYXRpb24KICAgIGJvb2wgcHVibGljIHVwZ3JhZGVIYXNCZWd1biA9IGZhbHNlOwoKICAgIGJvb2wgcHVibGljIGZpbmFsaXplZFVwZ3JhZGUgPSBmYWxzZTsKCiAgICBPbGRUb2tlbiBwdWJsaWMgb2xkVG9rZW47CgogICAgYWRkcmVzcyBwdWJsaWMgZGVjZW50QmV0TXVsdGlzaWc7CgogICAgTmV3RGVjZW50QmV0VG9rZW4gcHVibGljIG5ld1Rva2VuOwoKICAgIHVpbnQyNTYgcHVibGljIG9yaWdpbmFsU3VwcGx5OyAvLyB0aGUgb3JpZ2luYWwgdG90YWwgc3VwcGx5IG9mIG9sZCB0b2tlbnMKCiAgICB1aW50MjU2IHB1YmxpYyBjb3JyZWN0T3JpZ2luYWxTdXBwbHk7IC8vIENvcnJlY3Qgb3JpZ2luYWwgc3VwcGx5IGFjY291bnRpbmcgZm9yIDMwJSBtaW50ZWQgYXQgZmluYWxpemVDcm93ZGZ1bmRpbmcKCiAgICB1aW50MjU2IHB1YmxpYyBtaW50ZWRQZXJjZW50T2ZUb2tlbnMgPSAzMDsgLy8gQW1vdW50IG9mIHRva2VucyB0aGF0J3JlIG1pbnRlZCBhdCBmaW5hbGl6ZUNyb3dkZnVuZGluZwoKICAgIHVpbnQyNTYgcHVibGljIGNyb3dkZnVuZFBlcmNlbnRPZlRva2VucyA9IDcwOwoKICAgIHVpbnQyNTYgcHVibGljIG1pbnRlZFRva2VuczsKCiAgICBldmVudCBOZXdUb2tlblNldChhZGRyZXNzIHRva2VuKTsKCiAgICBldmVudCBVcGdyYWRlSGFzQmVndW4oKTsKCiAgICBldmVudCBJbnZhcmlhbnRDaGVja0ZhaWxlZCh1aW50IG9sZFRva2VuU3VwcGx5LCB1aW50IG5ld1Rva2VuU3VwcGx5LCB1aW50IG9yaWdpbmFsU3VwcGx5LCB1aW50IHZhbHVlKTsKCiAgICBldmVudCBJbnZhcmlhbnRDaGVja1Bhc3NlZCh1aW50IG9sZFRva2VuU3VwcGx5LCB1aW50IG5ld1Rva2VuU3VwcGx5LCB1aW50IG9yaWdpbmFsU3VwcGx5LCB1aW50IHZhbHVlKTsKCiAgICBmdW5jdGlvbiBOZXdVcGdyYWRlQWdlbnQoYWRkcmVzcyBfb2xkVG9rZW4pIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgaXNVcGdyYWRlQWdlbnQgPSB0cnVlOwogICAgICAgIG9sZFRva2VuID0gT2xkVG9rZW4oX29sZFRva2VuKTsKICAgICAgICBpZiAoIW9sZFRva2VuLmlzRGVjZW50QmV0VG9rZW4oKSkgcmV2ZXJ0KCk7CiAgICAgICAgZGVjZW50QmV0TXVsdGlzaWcgPSBvbGRUb2tlbi5kZWNlbnRCZXRNdWx0aXNpZygpOwogICAgICAgIG9yaWdpbmFsU3VwcGx5ID0gb2xkVG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgICBtaW50ZWRUb2tlbnMgPSBzYWZlRGl2KHNhZmVNdWwob3JpZ2luYWxTdXBwbHksIG1pbnRlZFBlcmNlbnRPZlRva2VucyksIGNyb3dkZnVuZFBlcmNlbnRPZlRva2Vucyk7CiAgICAgICAgY29ycmVjdE9yaWdpbmFsU3VwcGx5ID0gc2FmZUFkZChvcmlnaW5hbFN1cHBseSwgbWludGVkVG9rZW5zKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVjayB0byBtYWtlIHN1cmUgdGhhdCB0aGUgY3VycmVudCBzdW0gb2Ygb2xkIGFuZAogICAgLy8vIG5ldyB2ZXJzaW9uIHRva2VucyBpcyBzdGlsbCBlcXVhbCB0byB0aGUgb3JpZ2luYWwgbnVtYmVyIG9mIG9sZCB2ZXJzaW9uCiAgICAvLy8gdG9rZW5zCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbnVtYmVyIG9mIERCRVRzIHRvIHVwZ3JhZGUKICAgIGZ1bmN0aW9uIHNhZmV0eUludmFyaWFudENoZWNrKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgewogICAgICAgIGlmICghbmV3VG9rZW4uaXNOZXdUb2tlbigpKSByZXZlcnQoKTsKICAgICAgICAvLyBBYm9ydCBpZiBuZXcgdG9rZW4gY29udHJhY3QgaGFzIG5vdCBiZWVuIHNldAogICAgICAgIHVpbnQgb2xkU3VwcGx5ID0gb2xkVG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50IG5ld1N1cHBseSA9IG5ld1Rva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgaWYgKHNhZmVBZGQob2xkU3VwcGx5LCBuZXdTdXBwbHkpICE9IHNhZmVTdWIoY29ycmVjdE9yaWdpbmFsU3VwcGx5LCBfdmFsdWUpKSB7CiAgICAgICAgICAgIEludmFyaWFudENoZWNrRmFpbGVkKG9sZFN1cHBseSwgbmV3U3VwcGx5LCBjb3JyZWN0T3JpZ2luYWxTdXBwbHksIF92YWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgSW52YXJpYW50Q2hlY2tQYXNzZWQob2xkU3VwcGx5LCBuZXdTdXBwbHksIGNvcnJlY3RPcmlnaW5hbFN1cHBseSwgX3ZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0cyB0aGUgbmV3IHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX25ld1Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdG9rZW4gY29udHJhY3QKICAgIGZ1bmN0aW9uIHNldE5ld1Rva2VuKGFkZHJlc3MgX25ld1Rva2VuKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHJldmVydCgpOwogICAgICAgIGlmIChfbmV3VG9rZW4gPT0gMHgwKSByZXZlcnQoKTsKICAgICAgICBpZiAodXBncmFkZUhhc0JlZ3VuKSByZXZlcnQoKTsKICAgICAgICAvLyBDYW5ub3QgY2hhbmdlIHRva2VuIGFmdGVyIHVwZ3JhZGUgaGFzIGJlZ3VuCgogICAgICAgIG5ld1Rva2VuID0gTmV3RGVjZW50QmV0VG9rZW4oX25ld1Rva2VuKTsKICAgICAgICBpZiAoIW5ld1Rva2VuLmlzTmV3VG9rZW4oKSkgcmV2ZXJ0KCk7CiAgICAgICAgTmV3VG9rZW5TZXQobmV3VG9rZW4pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldHMgZmxhZyB0byBwcmV2ZW50IGNoYW5naW5nIG5ld1Rva2VuIGFmdGVyIHVwZ3JhZGUKICAgIGZ1bmN0aW9uIHNldFVwZ3JhZGVIYXNCZWd1bigpIGludGVybmFsIHsKICAgICAgICBpZiAoIXVwZ3JhZGVIYXNCZWd1bikgewogICAgICAgICAgICB1cGdyYWRlSGFzQmVndW4gPSB0cnVlOwogICAgICAgICAgICBVcGdyYWRlSGFzQmVndW4oKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBuZXcgdmVyc2lvbiB0b2tlbnMgZnJvbSB0aGUgbmV3IHRva2VuCiAgICAvLy8gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIHVwZ3JhZGVyCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbnVtYmVyIG9mIHRva2VucyB0byB1cGdyYWRlCiAgICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKICAgICAgICBpZihmaW5hbGl6ZWRVcGdyYWRlKSByZXZlcnQoKTsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhZGRyZXNzKG9sZFRva2VuKSkgcmV2ZXJ0KCk7CiAgICAgICAgLy8gTXVsdGlzaWcgY2FuJ3QgdXBncmFkZSBzaW5jZSB0b2tlbnMgYXJlIG1pbnRlZCBmb3IgaXQgaW4gbmV3IHRva2VuIGNvbnN0cnVjdG9yIGFzIGl0IGlzbid0IHBhcnQKICAgICAgICAvLyBvZiB0b3RhbFN1cHBseSBvZiBvbGRUb2tlbi4KICAgICAgICBpZiAoX2Zyb20gPT0gZGVjZW50QmV0TXVsdGlzaWcpIHJldmVydCgpOwogICAgICAgIC8vIG9ubHkgdXBncmFkZSBmcm9tIG9sZFRva2VuCiAgICAgICAgaWYgKCFuZXdUb2tlbi5pc05ld1Rva2VuKCkpIHJldmVydCgpOwogICAgICAgIC8vIG5lZWQgYSByZWFsIG5ld1Rva2VuIQoKICAgICAgICBzZXRVcGdyYWRlSGFzQmVndW4oKTsKICAgICAgICAvLyBSaWdodCBoZXJlIG9sZFRva2VuIGhhcyBhbHJlYWR5IGJlZW4gdXBkYXRlZCwgYnV0IGNvcnJlc3BvbmRpbmcKICAgICAgICAvLyBEQkVUcyBoYXZlIG5vdCBiZWVuIGNyZWF0ZWQgaW4gdGhlIG5ld1Rva2VuIGNvbnRyYWN0IHlldAogICAgICAgIHNhZmV0eUludmFyaWFudENoZWNrKF92YWx1ZSk7CgogICAgICAgIG5ld1Rva2VuLmNyZWF0ZVRva2VuKF9mcm9tLCBfdmFsdWUpOwoKICAgICAgICAvL1JpZ2h0IGhlcmUgdG90YWxTdXBwbHkgaW52YXJpYW50IG11c3QgaG9sZAogICAgICAgIHNhZmV0eUludmFyaWFudENoZWNrKDApOwogICAgfQoKICAgIC8vIEluaXRpYWxpemVzIG9yaWdpbmFsIHN1cHBseSBmcm9tIG9sZCB0b2tlbiB0b3RhbCBzdXBwbHkKICAgIGZ1bmN0aW9uIHNldE9yaWdpbmFsU3VwcGx5KCkgcHVibGljIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhZGRyZXNzKG9sZFRva2VuKSkgcmV2ZXJ0KCk7CiAgICAgICAgb3JpZ2luYWxTdXBwbHkgPSBvbGRUb2tlbi50b3RhbFN1cHBseSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXplVXBncmFkZSgpIHB1YmxpYyB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyhvbGRUb2tlbikpIHJldmVydCgpOwogICAgICAgIGZpbmFsaXplZFVwZ3JhZGUgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIGRpc2FsbG93cyBkZXBvc2l0aW5nIGV0aGVyLgogICAgZnVuY3Rpb24oKSB7cmV2ZXJ0KCk7fQoKfQ=='.
	

]
