Class {
	#name : #SRT9D8B33f8719470478DBD48711d004a0736d86956,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9D8B33f8719470478DBD48711d004a0736d86956 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgQ2xhaW1hYmxlCiAqIEBkZXYgRXh0ZW5zaW9uIGZvciB0aGUgT3duYWJsZSBjb250cmFjdCwgd2hlcmUgdGhlIG93bmVyc2hpcCBuZWVkcyB0byBiZSBjbGFpbWVkLgogKiBUaGlzIGFsbG93cyB0aGUgbmV3IG93bmVyIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIuCiAqLwpjb250cmFjdCBDbGFpbWFibGUgaXMgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ093bmVyOwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgcGVuZGluZ093bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlQZW5kaW5nT3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcGVuZGluZ093bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBzZXQgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICBwZW5kaW5nT3duZXIgPSBuZXdPd25lcjsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcyB0byBmaW5hbGl6ZSB0aGUgdHJhbnNmZXIuCiAgICovCiAgZnVuY3Rpb24gY2xhaW1Pd25lcnNoaXAoKSBvbmx5UGVuZGluZ093bmVyIHB1YmxpYyB7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgcGVuZGluZ093bmVyKTsKICAgIG93bmVyID0gcGVuZGluZ093bmVyOwogICAgcGVuZGluZ093bmVyID0gYWRkcmVzcygwKTsKICB9Cn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBTYWZlRVJDMjAKICogQGRldiBXcmFwcGVycyBhcm91bmQgRVJDMjAgb3BlcmF0aW9ucyB0aGF0IHRocm93IG9uIGZhaWx1cmUuCiAqIFRvIHVzZSB0aGlzIGxpYnJhcnkgeW91IGNhbiBhZGQgYSBgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMDtgIHN0YXRlbWVudCB0byB5b3VyIGNvbnRyYWN0LAogKiB3aGljaCBhbGxvd3MgeW91IHRvIGNhbGwgdGhlIHNhZmUgb3BlcmF0aW9ucyBhcyBgdG9rZW4uc2FmZVRyYW5zZmVyKC4uLilgLCBldGMuCiAqLwpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBDb250cmFjdHMgdGhhdCBzaG91bGQgYmUgYWJsZSB0byByZWNvdmVyIHRva2VucwogKiBAYXV0aG9yIFN5bFRpCiAqIEBkZXYgVGhpcyBhbGxvdyBhIGNvbnRyYWN0IHRvIHJlY292ZXIgYW55IEVSQzIwIHRva2VuIHJlY2VpdmVkIGluIGEgY29udHJhY3QgYnkgdHJhbnNmZXJyaW5nIHRoZSBiYWxhbmNlIHRvIHRoZSBjb250cmFjdCBvd25lci4KICogVGhpcyB3aWxsIHByZXZlbnQgYW55IGFjY2lkZW50YWwgbG9zcyBvZiB0b2tlbnMuCiAqLwpjb250cmFjdCBDYW5SZWNsYWltVG9rZW4gaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMEJhc2ljOwoKICAvKioKICAgKiBAZGV2IFJlY2xhaW0gYWxsIEVSQzIwQmFzaWMgY29tcGF0aWJsZSB0b2tlbnMKICAgKiBAcGFyYW0gdG9rZW4gRVJDMjBCYXNpYyBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgKi8KICBmdW5jdGlvbiByZWNsYWltVG9rZW4oRVJDMjBCYXNpYyB0b2tlbikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHRva2VuLnNhZmVUcmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgfQoKfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgYWNjZXNzIGNvbnRyb2wgdG8gdGhlIE1ldGFHYW1lIGNvbnRyYWN0Lgpjb250cmFjdCBNZXRhR2FtZUFjY2Vzc0NvbnRyb2wgaXMgQ2xhaW1hYmxlLCBQYXVzYWJsZSwgQ2FuUmVjbGFpbVRva2VuIHsKICAgIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgICAKICAgIGZ1bmN0aW9uIE1ldGFHYW1lQWNjZXNzQ29udHJvbCgpIHB1YmxpYyB7CiAgICAgICAgLy8gVGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENGTy4KICAgICAgICBjZm9BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDRk8tb25seSBmdW5jdGlvbmFsaXR5LgogICAgbW9kaWZpZXIgb25seUNGTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2ZvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDRk8uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IGNvbnRyYWN0IG93bmVyLgogICAgLy8vIEBwYXJhbSBfbmV3Q0ZPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0ZPLgogICAgZnVuY3Rpb24gc2V0Q0ZPKGFkZHJlc3MgX25ld0NGTykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9uZXdDRk8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNmb0FkZHJlc3MgPSBfbmV3Q0ZPOwogICAgfQp9CgoKLy8vIEBkZXYgRGVmaW5lcyBiYXNlIGRhdGEgc3RydWN0dXJlcyBmb3IgTWV0YUdhbWUuCmNvbnRyYWN0IE1ldGFHYW1lQmFzZSBpcyBNZXRhR2FtZUFjY2Vzc0NvbnRyb2wgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaWRlbnRpZmllclRvT3duZXI7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGlkZW50aWZpZXJUb0FwcHJvdmVkOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBvd25lcnNoaXBEZWVkQ291bnQ7CiAgICAKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgaWRlbnRpZmllclRvUGFyZW50SWRlbnRpZmllcjsKICAgIAogICAgLy8vIEBkZXYgQWxsIGV4aXN0aW5nIGlkZW50aWZpZXJzLgogICAgdWludDI1NltdIHB1YmxpYyBpZGVudGlmaWVyczsKICAgIAogICAgLy8vIEBub3RpY2UgR2V0IGFsbCBtaW50ZWQgaWRlbnRpZmllcnM7CiAgICBmdW5jdGlvbiBnZXRBbGxJZGVudGlmaWVycygpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10pIHsKICAgICAgICByZXR1cm4gaWRlbnRpZmllcnM7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGlkZW50aWZpZXIgb2YgdGhlIHBhcmVudCBvZiBhbiBpZGVudGlmaWVyLgogICAgLy8vIFRoZSBwYXJlbnQgaWRlbnRpZmllciBpcyAwIGlmIHRoZSBpZGVudGlmaWVyIGhhcyBubyBwYXJlbnQuCiAgICAvLy8gQHBhcmFtIGlkZW50aWZpZXIgVGhlIGlkZW50aWZpZXIgdG8gZ2V0IHRoZSBwYXJlbnQgaWRlbnRpZmllciBvZi4KICAgIGZ1bmN0aW9uIHBhcmVudE9mKHVpbnQyNTYgaWRlbnRpZmllcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IHBhcmVudElkZW50aWZpZXIpIHsKICAgICAgICBwYXJlbnRJZGVudGlmaWVyID0gaWRlbnRpZmllclRvUGFyZW50SWRlbnRpZmllcltpZGVudGlmaWVyXTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgSW50ZXJmYWNlIGZvciBjb250cmFjdHMgY29uZm9ybWluZyB0byBFUkMtNzIxOiBEZWVkIFN0YW5kYXJkCi8vLyBAYXV0aG9yIFdpbGxpYW0gRW50cmlrZW4gKGh0dHBzOi8vcGhvci5uZXQpLCBldCBhbC4KLy8vIEBkZXYgU3BlY2lmaWNhdGlvbiBhdCBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9wdWxsLzg0MSAoRFJBRlQpCmludGVyZmFjZSBFUkM3MjEgewoKICAgIC8vIENPTVBMSUFOQ0UgV0lUSCBFUkMtMTY1IChEUkFGVCkgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBFUkMtMTY1IChkcmFmdCkgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgaXRzZWxmCiAgICAvLyBieXRlczQgaW50ZXJuYWwgY29uc3RhbnQgSU5URVJGQUNFX1NJR05BVFVSRV9FUkMxNjUgPSAvLyAweDAxZmZjOWE3CiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KScpKTsKCiAgICAvLy8gQGRldiBFUkMtMTY1IChkcmFmdCkgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDNzIxCiAgICAvLyBieXRlczQgaW50ZXJuYWwgY29uc3RhbnQgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEgPSAvLyAweGRhNjcxYjliCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1Nignb3duZXJPZih1aW50MjU2KScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NignY291bnRPZkRlZWRzKCknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2NvdW50T2ZEZWVkc0J5T3duZXIoYWRkcmVzcyknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2RlZWRPZk93bmVyQnlJbmRleChhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdhcHByb3ZlKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rha2VPd25lcnNoaXAodWludDI1NiknKSk7CgogICAgLy8vIEBub3RpY2UgUXVlcnkgYSBjb250cmFjdCB0byBzZWUgaWYgaXQgc3VwcG9ydHMgYSBjZXJ0YWluIGludGVyZmFjZQogICAgLy8vIEBkZXYgUmV0dXJucyBgdHJ1ZWAgdGhlIGludGVyZmFjZSBpcyBzdXBwb3J0ZWQgYW5kIGBmYWxzZWAgb3RoZXJ3aXNlLAogICAgLy8vICByZXR1cm5zIGB0cnVlYCBmb3IgSU5URVJGQUNFX1NJR05BVFVSRV9FUkMxNjUgYW5kCiAgICAvLy8gIElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxLCBzZWUgRVJDLTE2NSBmb3Igb3RoZXIgaW50ZXJmYWNlIHNpZ25hdHVyZXMuCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpOwoKICAgIC8vIFBVQkxJQyBRVUVSWSBGVU5DVElPTlMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBGaW5kIHRoZSBvd25lciBvZiBhIGRlZWQKICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBmb3IgYSBkZWVkIHdlIGFyZSBpbnNwZWN0aW5nCiAgICAvLy8gQGRldiBEZWVkcyBhc3NpZ25lZCB0byB6ZXJvIGFkZHJlc3MgYXJlIGNvbnNpZGVyZWQgZGVzdHJveWVkLCBhbmQKICAgIC8vLyAgcXVlcmllcyBhYm91dCB0aGVtIGRvIHRocm93LgogICAgLy8vIEByZXR1cm4gVGhlIG5vbi16ZXJvIGFkZHJlc3Mgb2YgdGhlIG93bmVyIG9mIGRlZWQgYF9kZWVkSWRgLCBvciBgdGhyb3dgCiAgICAvLy8gIGlmIGRlZWQgYF9kZWVkSWRgIGlzIG5vdCB0cmFja2VkIGJ5IHRoaXMgY29udHJhY3QKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MgX293bmVyKTsKCiAgICAvLy8gQG5vdGljZSBDb3VudCBkZWVkcyB0cmFja2VkIGJ5IHRoaXMgY29udHJhY3QKICAgIC8vLyBAcmV0dXJuIEEgY291bnQgb2YgdGhlIGRlZWRzIHRyYWNrZWQgYnkgdGhpcyBjb250cmFjdCwgd2hlcmUgZWFjaCBvbmUgb2YKICAgIC8vLyAgdGhlbSBoYXMgYW4gYXNzaWduZWQgYW5kIHF1ZXJ5YWJsZSBvd25lcgogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfY291bnQpOwoKICAgIC8vLyBAbm90aWNlIENvdW50IGFsbCBkZWVkcyBhc3NpZ25lZCB0byBhbiBvd25lcgogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBfb3duZXJgIGlzIHRoZSB6ZXJvIGFkZHJlc3MsIHJlcHJlc2VudGluZyBkZXN0cm95ZWQgZGVlZHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBbiBhZGRyZXNzIHdoZXJlIHdlIGFyZSBpbnRlcmVzdGVkIGluIGRlZWRzIG93bmVkIGJ5IHRoZW0KICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgZGVlZHMgb3duZWQgYnkgYF9vd25lcmAsIHBvc3NpYmx5IHplcm8KICAgIGZ1bmN0aW9uIGNvdW50T2ZEZWVkc0J5T3duZXIoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2NvdW50KTsKCiAgICAvLy8gQG5vdGljZSBFbnVtZXJhdGUgZGVlZHMgYXNzaWduZWQgdG8gYW4gb3duZXIKICAgIC8vLyBAZGV2IFRocm93cyBpZiBgX2luZGV4YCA+PSBgY291bnRPZkRlZWRzQnlPd25lcihfb3duZXIpYCBvciBpZgogICAgLy8vICBgX293bmVyYCBpcyB0aGUgemVybyBhZGRyZXNzLCByZXByZXNlbnRpbmcgZGVzdHJveWVkIGRlZWRzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQW4gYWRkcmVzcyB3aGVyZSB3ZSBhcmUgaW50ZXJlc3RlZCBpbiBkZWVkcyBvd25lZCBieSB0aGVtCiAgICAvLy8gQHBhcmFtIF9pbmRleCBBIGNvdW50ZXIgYmV0d2VlbiB6ZXJvIGFuZCBgY291bnRPZkRlZWRzQnlPd25lcihfb3duZXIpYCwKICAgIC8vLyAgaW5jbHVzaXZlCiAgICAvLy8gQHJldHVybiBUaGUgaWRlbnRpZmllciBmb3IgdGhlIGBfaW5kZXhgdGggZGVlZCBhc3NpZ25lZCB0byBgX293bmVyYCwKICAgIC8vLyAgIChzb3J0IG9yZGVyIG5vdCBzcGVjaWZpZWQpCiAgICBmdW5jdGlvbiBkZWVkT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2RlZWRJZCk7CgogICAgLy8gVFJBTlNGRVIgTUVDSEFOSVNNIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFRoaXMgZXZlbnQgZW1pdHMgd2hlbiBvd25lcnNoaXAgb2YgYW55IGRlZWQgY2hhbmdlcyBieSBhbnkKICAgIC8vLyAgbWVjaGFuaXNtLiBUaGlzIGV2ZW50IGVtaXRzIHdoZW4gZGVlZHMgYXJlIGNyZWF0ZWQgKGBmcm9tYCA9PSAwKSBhbmQKICAgIC8vLyAgZGVzdHJveWVkIChgdG9gID09IDApLiBFeGNlcHRpb246IGR1cmluZyBjb250cmFjdCBjcmVhdGlvbiwgYW55CiAgICAvLy8gIHRyYW5zZmVycyBtYXkgb2NjdXIgd2l0aG91dCBlbWl0dGluZyBgVHJhbnNmZXJgLgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBpbmRleGVkIGRlZWRJZCk7CgogICAgLy8vIEBkZXYgVGhpcyBldmVudCBlbWl0cyBvbiBhbnkgc3VjY2Vzc2Z1bCBjYWxsIHRvCiAgICAvLy8gIGBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2RlZWRJZClgLiBFeGNlcHRpb246IGRvZXMgbm90IGVtaXQKICAgIC8vLyAgaWYgYW4gb3duZXIgcmV2b2tlcyBhcHByb3ZhbCAoYF90b2AgPT0gMHgwKSBvbiBhIGRlZWQgd2l0aCBubyBleGlzdGluZwogICAgLy8vICBhcHByb3ZhbC4KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIGFwcHJvdmVkLCB1aW50MjU2IGluZGV4ZWQgZGVlZElkKTsKCiAgICAvLy8gQG5vdGljZSBBcHByb3ZlIGEgbmV3IG93bmVyIHRvIHRha2UgeW91ciBkZWVkLCBvciByZXZva2UgYXBwcm92YWwgYnkKICAgIC8vLyAgc2V0dGluZyB0aGUgemVybyBhZGRyZXNzLiBZb3UgbWF5IGBhcHByb3ZlYCBhbnkgbnVtYmVyIG9mIHRpbWVzIHdoaWxlCiAgICAvLy8gIHRoZSBkZWVkIGlzIGFzc2lnbmVkIHRvIHlvdSwgb25seSB0aGUgbW9zdCByZWNlbnQgYXBwcm92YWwgbWF0dGVycy4KICAgIC8vLyBAZGV2IFRocm93cyBpZiBgbXNnLnNlbmRlcmAgZG9lcyBub3Qgb3duIGRlZWQgYF9kZWVkSWRgIG9yIGlmIGBfdG9gID09CiAgICAvLy8gIGBtc2cuc2VuZGVyYC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgZGVlZCB5b3UgYXJlIGdyYW50aW5nIG93bmVyc2hpcCBvZgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBleHRlcm5hbDsKCiAgICAvLy8gQG5vdGljZSBCZWNvbWUgb3duZXIgb2YgYSBkZWVkIGZvciB3aGljaCB5b3UgYXJlIGN1cnJlbnRseSBhcHByb3ZlZAogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBtc2cuc2VuZGVyYCBpcyBub3QgYXBwcm92ZWQgdG8gYmVjb21lIHRoZSBvd25lciBvZgogICAgLy8vICBgZGVlZElkYCBvciBpZiBgbXNnLnNlbmRlcmAgY3VycmVudGx5IG93bnMgYF9kZWVkSWRgLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBkZWVkIHRoYXQgaXMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfZGVlZElkKSBleHRlcm5hbDsKICAgIAogICAgLy8gU1BFQyBFWFRFTlNJT05TIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIGRlZWQgdG8gYSBuZXcgb3duZXIuCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgYG1zZy5zZW5kZXJgIGRvZXMgbm90IG93biBkZWVkIGBfZGVlZElkYCBvciBpZgogICAgLy8vICBgX3RvYCA9PSAweDAuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBkZWVkIHlvdSBhcmUgdHJhbnNmZXJyaW5nLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWw7Cn0KCgovLy8gQHRpdGxlIE1ldGFkYXRhIGV4dGVuc2lvbiB0byBFUkMtNzIxIGludGVyZmFjZQovLy8gQGF1dGhvciBXaWxsaWFtIEVudHJpa2VuIChodHRwczovL3Bob3IubmV0KQovLy8gQGRldiBTcGVjaWZpY2F0aW9uIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL3B1bGwvODQxIChEUkFGVCkKaW50ZXJmYWNlIEVSQzcyMU1ldGFkYXRhIHsKCiAgICAvLy8gQGRldiBFUkMtMTY1IChkcmFmdCkgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDNzIxCiAgICAvLyBieXRlczQgaW50ZXJuYWwgY29uc3RhbnQgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjFNZXRhZGF0YSA9IC8vIDB4MmE3ODZmMTEKICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCduYW1lKCknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N5bWJvbCgpJykpIF4KICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdkZWVkVXJpKHVpbnQyNTYpJykpOwoKICAgIC8vLyBAbm90aWNlIEEgZGVzY3JpcHRpdmUgbmFtZSBmb3IgYSBjb2xsZWN0aW9uIG9mIGRlZWRzIG1hbmFnZWQgYnkgdGhpcwogICAgLy8vICBjb250cmFjdAogICAgLy8vIEBkZXYgV2FsbGV0cyBhbmQgZXhjaGFuZ2VzIE1BWSBkaXNwbGF5IHRoaXMgdG8gdGhlIGVuZCB1c2VyLgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfZGVlZE5hbWUpOwoKICAgIC8vLyBAbm90aWNlIEFuIGFiYnJldmlhdGVkIG5hbWUgZm9yIGRlZWRzIG1hbmFnZWQgYnkgdGhpcyBjb250cmFjdAogICAgLy8vIEBkZXYgV2FsbGV0cyBhbmQgZXhjaGFuZ2VzIE1BWSBkaXNwbGF5IHRoaXMgdG8gdGhlIGVuZCB1c2VyLgogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9kZWVkU3ltYm9sKTsKCiAgICAvLy8gQG5vdGljZSBBIGRpc3RpbmN0IFVSSSAoUkZDIDM5ODYpIGZvciBhIGdpdmVuIHRva2VuLgogICAgLy8vIEBkZXYgSWY6CiAgICAvLy8gICogVGhlIFVSSSBpcyBhIFVSTAogICAgLy8vICAqIFRoZSBVUkwgaXMgYWNjZXNzaWJsZQogICAgLy8vICAqIFRoZSBVUkwgcG9pbnRzIHRvIGEgdmFsaWQgSlNPTiBmaWxlIGZvcm1hdCAoRUNNQS00MDQgMm5kIGVkLikKICAgIC8vLyAgKiBUaGUgSlNPTiBiYXNlIGVsZW1lbnQgaXMgYW4gb2JqZWN0CiAgICAvLy8gIHRoZW4gdGhlc2UgbmFtZXMgb2YgdGhlIGJhc2UgZWxlbWVudCBTSEFMTCBoYXZlIHNwZWNpYWwgbWVhbmluZzoKICAgIC8vLyAgKiAibmFtZSI6IEEgc3RyaW5nIGlkZW50aWZ5aW5nIHRoZSBpdGVtIHRvIHdoaWNoIGBfZGVlZElkYCBncmFudHMKICAgIC8vLyAgICBvd25lcnNoaXAKICAgIC8vLyAgKiAiZGVzY3JpcHRpb24iOiBBIHN0cmluZyBkZXRhaWxpbmcgdGhlIGl0ZW0gdG8gd2hpY2ggYF9kZWVkSWRgIGdyYW50cwogICAgLy8vICAgIG93bmVyc2hpcAogICAgLy8vICAqICJpbWFnZSI6IEEgVVJJIHBvaW50aW5nIHRvIGEgZmlsZSBvZiBpbWFnZS8qIG1pbWUgdHlwZSByZXByZXNlbnRpbmcKICAgIC8vLyAgICB0aGUgaXRlbSB0byB3aGljaCBgX2RlZWRJZGAgZ3JhbnRzIG93bmVyc2hpcAogICAgLy8vICBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICAvLy8gIENvbnNpZGVyIG1ha2luZyBhbnkgaW1hZ2VzIGF0IGEgd2lkdGggYmV0d2VlbiAzMjAgYW5kIDEwODAgcGl4ZWxzIGFuZAogICAgLy8vICBhc3BlY3QgcmF0aW8gYmV0d2VlbiAxLjkxOjEgYW5kIDQ6NSBpbmNsdXNpdmUuCiAgICBmdW5jdGlvbiBkZWVkVXJpKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcgX3VyaSk7Cn0KCgovLy8gQGRldiBIb2xkcyBkZWVkIGZ1bmN0aW9uYWxpdHkgc3VjaCBhcyBhcHByb3ZpbmcgYW5kIHRyYW5zZmVycmluZy4gSW1wbGVtZW50cyBFUkM3MjEuCmNvbnRyYWN0IE1ldGFHYW1lRGVlZCBpcyBNZXRhR2FtZUJhc2UsIEVSQzcyMSwgRVJDNzIxTWV0YWRhdGEgewogICAgCiAgICAvLy8gQG5vdGljZSBOYW1lIG9mIHRoZSBjb2xsZWN0aW9uIG9mIGRlZWRzIChub24tZnVuZ2libGUgdG9rZW4pLCBhcyBkZWZpbmVkIGluIEVSQzcyMU1ldGFkYXRhLgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfZGVlZE5hbWUpIHsKICAgICAgICBfZGVlZE5hbWUgPSAiTWV0YUdhbWUiOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTeW1ib2wgb2YgdGhlIGNvbGxlY3Rpb24gb2YgZGVlZHMgKG5vbi1mdW5naWJsZSB0b2tlbiksIGFzIGRlZmluZWQgaW4gRVJDNzIxTWV0YWRhdGEuCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcgX2RlZWRTeW1ib2wpIHsKICAgICAgICBfZGVlZFN5bWJvbCA9ICJNRyI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBpdHNlbGYKICAgIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSA9IC8vIDB4MDFmZmM5YTcKICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSA9IC8vIDB4ZGE2NzFiOWIKICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdjb3VudE9mRGVlZHMoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignZGVlZE9mT3duZXJCeUluZGV4KGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndGFrZU93bmVyc2hpcCh1aW50MjU2KScpKTsKICAgICAgICAKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU1ldGFkYXRhID0gLy8gMHgyYTc4NmYxMQogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3ltYm9sKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2RlZWRVcmkodWludDI1NiknKSk7CiAgICAKICAgIC8vLyBAbm90aWNlIEludHJvc3BlY3Rpb24gaW50ZXJmYWNlIGFzIHBlciBFUkMtMTY1IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KS4KICAgIC8vLyBSZXR1cm5zIHRydWUgZm9yIGFueSBzdGFuZGFyZGl6ZWQgaW50ZXJmYWNlcyBpbXBsZW1lbnRlZCBieSB0aGlzIGNvbnRyYWN0LgogICAgLy8vIChFUkMtMTY1IGFuZCBFUkMtNzIxLikKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIChfaW50ZXJmYWNlSUQgPT0gSU5URVJGQUNFX1NJR05BVFVSRV9FUkMxNjUpCiAgICAgICAgICAgIHx8IChfaW50ZXJmYWNlSUQgPT0gSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEpCiAgICAgICAgICAgIHx8IChfaW50ZXJmYWNlSUQgPT0gSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjFNZXRhZGF0YSkKICAgICAgICApOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIG93bnMgYSBwYXJ0aWN1bGFyIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIgdG8gY2hlY2sgZm9yLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBkZWVkIGlkZW50aWZpZXIgdG8gY2hlY2sgZm9yLgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGlkZW50aWZpZXJUb093bmVyW19kZWVkSWRdID09IF9vd25lcjsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQXBwcm92ZSBhIGdpdmVuIGFkZHJlc3MgdG8gdGFrZSBvd25lcnNoaXAgb2YgYSBkZWVkLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBhcHByb3ZpbmcgdGFraW5nIG93bmVyc2hpcC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGFwcHJvdmUgdGFraW5nIG93bmVyc2hpcC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBnaXZlIGFwcHJvdmFsIGZvci4KICAgIGZ1bmN0aW9uIF9hcHByb3ZlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHsKICAgICAgICBpZGVudGlmaWVyVG9BcHByb3ZlZFtfZGVlZElkXSA9IF90bzsKICAgICAgICAKICAgICAgICAvLyBFbWl0IGV2ZW50LgogICAgICAgIEFwcHJvdmFsKF9mcm9tLCBfdG8sIF9kZWVkSWQpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGhhcyBhcHByb3ZhbCB0byB0YWtlIG93bmVyc2hpcCBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCBUaGUgYWRkcmVzcyBvZiB0aGUgY2xhaW1hbnQgdG8gY2hlY2sgZm9yLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNoZWNrIGZvci4KICAgIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfZGVlZElkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gaWRlbnRpZmllclRvQXBwcm92ZWRbX2RlZWRJZF0gPT0gX2NsYWltYW50OwogICAgfQogICAgCiAgICAvLy8gQGRldiBBc3NpZ25zIG93bmVyc2hpcCBvZiBhIHNwZWNpZmljIGRlZWQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdGhlIGRlZWQgZnJvbS4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRoZSBkZWVkIHRvLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHsKICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIGRlZWRzIGlzIGNhcHBlZCBhdCByb3dzICogY29scywgc28gdGhpcyBjYW5ub3QKICAgICAgICAvLyBiZSBvdmVyZmxvd2VkIGlmIHRob3NlIHBhcmFtZXRlcnMgYXJlIHNlbnNpYmxlLgogICAgICAgIG93bmVyc2hpcERlZWRDb3VudFtfdG9dKys7CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgb3duZXJzaGlwLgogICAgICAgIGlkZW50aWZpZXJUb093bmVyW19kZWVkSWRdID0gX3RvOwogICAgICAgIAogICAgICAgIC8vIFdoZW4gYSBuZXcgZGVlZCBpcyBtaW50ZWQsIHRoZSBfZnJvbSBhZGRyZXNzIGlzIDB4MCwgYnV0IHdlCiAgICAgICAgLy8gZG8gbm90IHRyYWNrIGRlZWQgb3duZXJzaGlwIG9mIDB4MC4KICAgICAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lcnNoaXBEZWVkQ291bnRbX2Zyb21dLS07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDbGVhciB0YWtpbmcgb3duZXJzaGlwIGFwcHJvdmFsLgogICAgICAgICAgICBkZWxldGUgaWRlbnRpZmllclRvQXBwcm92ZWRbX2RlZWRJZF07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEVtaXQgdGhlIHRyYW5zZmVyIGV2ZW50LgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9kZWVkSWQpOwogICAgfQogICAgCiAgICAvLyBFUkMgNzIxIGltcGxlbWVudGF0aW9uCiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBkZWVkcyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGNvdW50T2ZEZWVkcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gaWRlbnRpZmllcnMubGVuZ3RoOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZGVlZHMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICBmdW5jdGlvbiBjb3VudE9mRGVlZHNCeU93bmVyKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcERlZWRDb3VudFtfb3duZXJdOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBhZGRyZXNzIGN1cnJlbnRseSBhc3NpZ25lZCBvd25lcnNoaXAgb2YgYSBnaXZlbiBkZWVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MgX293bmVyKSB7CiAgICAgICAgX293bmVyID0gaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF07CgogICAgICAgIHJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBBcHByb3ZlIGEgZ2l2ZW4gYWRkcmVzcyB0byB0YWtlIG93bmVyc2hpcCBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byBhcHByb3ZlIHRha2luZyBvd2VybnNoaXAuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gZ2l2ZSBhcHByb3ZhbCBmb3IuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IF9kZWVkSWRzID0gbmV3IHVpbnQyNTZbXSgxKTsKICAgICAgICBfZGVlZElkc1swXSA9IF9kZWVkSWQ7CiAgICAgICAgCiAgICAgICAgYXBwcm92ZU11bHRpcGxlKF90bywgX2RlZWRJZHMpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBBcHByb3ZlIGEgZ2l2ZW4gYWRkcmVzcyB0byB0YWtlIG93bmVyc2hpcCBvZiBtdWx0aXBsZSBkZWVkcy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGFwcHJvdmUgdGFraW5nIG93bmVyc2hpcC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZHMgVGhlIGlkZW50aWZpZXJzIG9mIHRoZSBkZWVkcyB0byBnaXZlIGFwcHJvdmFsIGZvci4KICAgIGZ1bmN0aW9uIGFwcHJvdmVNdWx0aXBsZShhZGRyZXNzIF90bywgdWludDI1NltdIF9kZWVkSWRzKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gRW5zdXJlIHRoZSBzZW5kZXIgaXMgbm90IGFwcHJvdmluZyB0aGVtc2VsdmVzLgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBfdG8pOwogICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RlZWRJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdWludDI1NiBfZGVlZElkID0gX2RlZWRJZHNbaV07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXF1aXJlIHRoZSBzZW5kZXIgaXMgdGhlIG93bmVyIG9mIHRoZSBkZWVkLgogICAgICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFBlcmZvcm0gdGhlIGFwcHJvdmFsLgogICAgICAgICAgICBfYXBwcm92ZShtc2cuc2VuZGVyLCBfdG8sIF9kZWVkSWQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBkZWVkIHRvIGFub3RoZXIgYWRkcmVzcy4gSWYgdHJhbnNmZXJyaW5nIHRvIGEgc21hcnQKICAgIC8vLyBjb250cmFjdCBiZSBWRVJZIENBUkVGVUwgdG8gZW5zdXJlIHRoYXQgaXQgaXMgYXdhcmUgb2YgRVJDLTcyMSwgb3IgeW91cgogICAgLy8vIGRlZWQgbWF5IGJlIGxvc3QgZm9yZXZlci4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gdHJhbnNmZXIuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgdWludDI1NltdIG1lbW9yeSBfZGVlZElkcyA9IG5ldyB1aW50MjU2W10oMSk7CiAgICAgICAgX2RlZWRJZHNbMF0gPSBfZGVlZElkOwogICAgICAgIAogICAgICAgIHRyYW5zZmVyTXVsdGlwbGUoX3RvLCBfZGVlZElkcyk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVycyBtdWx0aXBsZSBkZWVkcyB0byBhbm90aGVyIGFkZHJlc3MuIElmIHRyYW5zZmVycmluZyB0bwogICAgLy8vIGEgc21hcnQgY29udHJhY3QgYmUgVkVSWSBDQVJFRlVMIHRvIGVuc3VyZSB0aGF0IGl0IGlzIGF3YXJlIG9mIEVSQy03MjEsCiAgICAvLy8gb3IgeW91ciBkZWVkcyBtYXkgYmUgbG9zdCBmb3JldmVyLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZHMgVGhlIGlkZW50aWZpZXJzIG9mIHRoZSBkZWVkcyB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyTXVsdGlwbGUoYWRkcmVzcyBfdG8sIHVpbnQyNTZbXSBfZGVlZElkcykgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RlZWRJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdWludDI1NiBfZGVlZElkID0gX2RlZWRJZHNbaV07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBPbmUgY2FuIG9ubHkgdHJhbnNmZXIgdGhlaXIgb3duIGRlZWRzLgogICAgICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKCiAgICAgICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcAogICAgICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfZGVlZElkKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgZGVlZCBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUgY2FsbGluZwogICAgLy8vIGFkZHJlc3MgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgdWludDI1NltdIG1lbW9yeSBfZGVlZElkcyA9IG5ldyB1aW50MjU2W10oMSk7CiAgICAgICAgX2RlZWRJZHNbMF0gPSBfZGVlZElkOwogICAgICAgIAogICAgICAgIHRha2VPd25lcnNoaXBNdWx0aXBsZShfZGVlZElkcyk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIG11bHRpcGxlIGRlZWRzIG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZQogICAgLy8vIGNhbGxpbmcgYWRkcmVzcyBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZGVlZElkcyBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXBNdWx0aXBsZSh1aW50MjU2W10gX2RlZWRJZHMpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfZGVlZElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50MjU2IF9kZWVkSWQgPSBfZGVlZElkc1tpXTsKICAgICAgICAgICAgYWRkcmVzcyBfZnJvbSA9IGlkZW50aWZpZXJUb093bmVyW19kZWVkSWRdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHRyYW5zZmVyIGFwcHJvdmFsCiAgICAgICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKCiAgICAgICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCAoYWxzbyBjbGVhcnMgcGVuZGluZyBhcHByb3ZhbHMgYW5kIGVtaXRzIFRyYW5zZmVyIGV2ZW50KS4KICAgICAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBtc2cuc2VuZGVyLCBfZGVlZElkKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBsaXN0IG9mIGFsbCBkZWVkIGlkZW50aWZpZXJzIGFzc2lnbmVkIHRvIGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgd2hvc2UgZGVlZHMgd2UgYXJlIGludGVyZXN0ZWQgaW4uCiAgICAvLy8gQGRldiBUaGlzIG1ldGhvZCBNVVNUIE5FVkVSIGJlIGNhbGxlZCBieSBzbWFydCBjb250cmFjdCBjb2RlLiBJdCdzIHZlcnkKICAgIC8vLyBleHBlbnNpdmUgYW5kIGlzIG5vdCBzdXBwb3J0ZWQgaW4gY29udHJhY3QtdG8tY29udHJhY3QgY2FsbHMgYXMgaXQgcmV0dXJucwogICAgLy8vIGEgZHluYW1pYyBhcnJheSAob25seSBzdXBwb3J0ZWQgZm9yIHdlYjMgY2FsbHMpLgogICAgZnVuY3Rpb24gZGVlZHNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdKSB7CiAgICAgICAgdWludDI1NiBkZWVkQ291bnQgPSBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcik7CgogICAgICAgIGlmIChkZWVkQ291bnQgPT0gMCkgewogICAgICAgICAgICAvLyBSZXR1cm4gYW4gZW1wdHkgYXJyYXkuCiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXShkZWVkQ291bnQpOwogICAgICAgICAgICB1aW50MjU2IHRvdGFsRGVlZHMgPSBjb3VudE9mRGVlZHMoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKHVpbnQyNTYgZGVlZE51bWJlciA9IDA7IGRlZWROdW1iZXIgPCB0b3RhbERlZWRzOyBkZWVkTnVtYmVyKyspIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgaWRlbnRpZmllciA9IGlkZW50aWZpZXJzW2RlZWROdW1iZXJdOwogICAgICAgICAgICAgICAgaWYgKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBpZGVudGlmaWVyOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGEgZGVlZCBpZGVudGlmaWVyIG9mIHRoZSBvd25lciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIgd2Ugd2FudCB0byBnZXQgYSBkZWVkIGZvci4KICAgIC8vLyBAcGFyYW0gX2luZGV4IFRoZSBpbmRleCBvZiB0aGUgZGVlZCB3ZSB3YW50LgogICAgZnVuY3Rpb24gZGVlZE9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gVGhlIGluZGV4IHNob3VsZCBiZSB2YWxpZC4KICAgICAgICByZXF1aXJlKF9pbmRleCA8IGNvdW50T2ZEZWVkc0J5T3duZXIoX293bmVyKSk7CgogICAgICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgZGVlZHMsIGFjY291bnRpbmcgdGhlIG51bWJlciBvZiBkZWVkcyBvZiB0aGUgb3duZXIgd2UndmUgc2Vlbi4KICAgICAgICB1aW50MjU2IHNlZW4gPSAwOwogICAgICAgIHVpbnQyNTYgdG90YWxEZWVkcyA9IGNvdW50T2ZEZWVkcygpOwogICAgICAgIAogICAgICAgIGZvciAodWludDI1NiBkZWVkTnVtYmVyID0gMDsgZGVlZE51bWJlciA8IHRvdGFsRGVlZHM7IGRlZWROdW1iZXIrKykgewogICAgICAgICAgICB1aW50MjU2IGlkZW50aWZpZXIgPSBpZGVudGlmaWVyc1tkZWVkTnVtYmVyXTsKICAgICAgICAgICAgaWYgKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgaWYgKHNlZW4gPT0gX2luZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkZW50aWZpZXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlZW4rKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhbiAob2ZmLWNoYWluKSBtZXRhZGF0YSB1cmwgZm9yIHRoZSBnaXZlbiBkZWVkLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGdldCB0aGUgbWV0YWRhdGEKICAgIC8vLyB1cmwgZm9yLgogICAgLy8vIEBkZXYgSW1wbGVtZW50YXRpb24gb2Ygb3B0aW9uYWwgRVJDLTcyMSBmdW5jdGlvbmFsaXR5LgogICAgZnVuY3Rpb24gZGVlZFVyaSh1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nIHVyaSkgewogICAgICAgIC8vIEFzc3VtZSBhIG1heGltdW0gZGVlZCBpZCBsZW5ndGguCiAgICAgICAgcmVxdWlyZSAoX2RlZWRJZCA8IDEwMDAwMDApOwogICAgICAgIAogICAgICAgIHVyaSA9ICJodHRwczovL21ldGEucXVhenIuaW8vY2FyZC94eHh4eHh4IjsKICAgICAgICBieXRlcyBtZW1vcnkgX3VyaSA9IGJ5dGVzKHVyaSk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgNzsgaSsrKSB7CiAgICAgICAgICAgIF91cmlbMzMgLSBpXSA9IGJ5dGUoNDggKyAoX2RlZWRJZCAvIDEwICoqIGkpICUgMTApOwogICAgICAgIH0KICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgUHVsbFBheW1lbnQKICogQGRldiBCYXNlIGNvbnRyYWN0IHN1cHBvcnRpbmcgYXN5bmMgc2VuZCBmb3IgcHVsbCBwYXltZW50cy4gSW5oZXJpdCBmcm9tIHRoaXMKICogY29udHJhY3QgYW5kIHVzZSBhc3luY1NlbmQgaW5zdGVhZCBvZiBzZW5kLgogKi8KY29udHJhY3QgUHVsbFBheW1lbnQgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHBheW1lbnRzOwogIHVpbnQyNTYgcHVibGljIHRvdGFsUGF5bWVudHM7CgogIC8qKgogICogQGRldiB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlLCBjYWxsZWQgYnkgcGF5ZWUuCiAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkgcHVibGljIHsKICAgIGFkZHJlc3MgcGF5ZWUgPSBtc2cuc2VuZGVyOwogICAgdWludDI1NiBwYXltZW50ID0gcGF5bWVudHNbcGF5ZWVdOwoKICAgIHJlcXVpcmUocGF5bWVudCAhPSAwKTsKICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IHBheW1lbnQpOwoKICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLnN1YihwYXltZW50KTsKICAgIHBheW1lbnRzW3BheWVlXSA9IDA7CgogICAgYXNzZXJ0KHBheWVlLnNlbmQocGF5bWVudCkpOwogIH0KCiAgLyoqCiAgKiBAZGV2IENhbGxlZCBieSB0aGUgcGF5ZXIgdG8gc3RvcmUgdGhlIHNlbnQgYW1vdW50IGFzIGNyZWRpdCB0byBiZSBwdWxsZWQuCiAgKiBAcGFyYW0gZGVzdCBUaGUgZGVzdGluYXRpb24gYWRkcmVzcyBvZiB0aGUgZnVuZHMuCiAgKiBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgKi8KICBmdW5jdGlvbiBhc3luY1NlbmQoYWRkcmVzcyBkZXN0LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgcGF5bWVudHNbZGVzdF0gPSBwYXltZW50c1tkZXN0XS5hZGQoYW1vdW50KTsKICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLmFkZChhbW91bnQpOwogIH0KfQoKCi8vLyBAZGV2IERlZmluZXMgYmFzZSBkYXRhIHN0cnVjdHVyZXMgZm9yIE1ldGFHYW1lLgpjb250cmFjdCBNZXRhR2FtZUZpbmFuY2UgaXMgTWV0YUdhbWVEZWVkLCBQdWxsUGF5bWVudCB7CiAgICAvLy8gQG5vdGljZSBUaGUgZGl2aWRlbmQgZ2l2ZW4gdG8gYWxsIHBhcmVudHMgb2YgYSBkZWVkLCAKICAgIC8vLyBpbiAxLzEwMDB0aCBvZiBhIHBlcmNlbnRhZ2UuCiAgICB1aW50MjU2IHB1YmxpYyBkaXZpZGVuZFBhcmVudHNQZXJjZW50YWdlID0gMTAwMDsKICAgIAogICAgLy8vIEBub3RpY2UgVGhlIG1pbmltdW0gZmVlIGZvciB0aGUgY29udHJhY3QgaW4gMS8xMDAwdGgKICAgIC8vLyBvZiBhIHBlcmNlbnRhZ2UuCiAgICB1aW50MjU2IHB1YmxpYyBtaW5pbXVtRmVlUGVyY2VudGFnZSA9IDI1MDA7CiAgICAKICAgIC8vLyBAbm90aWNlIFRoZSBtaW5pbXVtIHRvdGFsIHBhaWQgaW4gZmVlcyBhbmQgZGl2aWRlbmRzLgogICAgLy8vIElmIHRoZXJlIGFyZSAoYWxtb3N0KSBubyBkaXZpZGVuZHMgdG8gYmUgcGFpZCwgdGhlIGZlZQogICAgLy8vIGZvciB0aGUgY29udHJhY3QgaXMgaGlnaGVyLiBUaGlzIGhhcHBlbnMgZm9yIGRlZWRzIGF0CiAgICAvLy8gb3IgbmVhciB0aGUgdG9wIG9mIHRoZSBoaWVyYXJjaHkuIEluIDEvMTAwMHRoIG9mIGEKICAgIC8vLyBwZXJjZW50YWdlLgogICAgdWludDI1NiBwdWJsaWMgbWluaW11bUZlZVBsdXNEaXZpZGVuZHNQZXJjZW50YWdlID0gODAwMDsKICAgIAogICAgLy8vIEBub3RpY2UgTW9zdC1yZWNlbnQgY2FyZCBidXllcnMuIFRoZXNlIHdpbGwgYmUgZ2l2ZW4KICAgIC8vLyBkaXZpZGVuZHMgb24gdGhlIG5leHQgc2FsZS4gVGhlbiwgdGhlIGJ1eWVycyB3aWxsIGJlCiAgICAvLy8gc2hpZnRlZCwgdGhlIGxlYXN0IHJlY2VudCBidXllciBkcm9wcGVkLCBhbmQgdGhlIGJ1eWVyCiAgICAvLy8gb2YgdGhpcyBzYWxlIGlzIGFkZGVkIGFzIHRoZSBtb3N0IHJlY2VudCBidXllci4KICAgIGFkZHJlc3NbXSBwdWJsaWMgcmVjZW50QnV5ZXJzID0gbmV3IGFkZHJlc3NbXSg2KTsKICAgIAogICAgLy8vIEBub3RpY2UgVGhlIGRpdmlkZW5kIGdpdmVuIHRvIHRoZSBtb3N0IHJlY2VudCBidXllcnMsCiAgICAvLy8gaW4gMS8xMDAwdGggb2YgYSBwZXJjZW50YWdlLiBUaGUgZGl2aWRlbmQgZGVjcmVhc2VzIGJ5CiAgICAvLy8gdGhlIGdpdmVuIGZhY3RvciBmb3Igc3Vic2VxdWVudCBsZXZlbHMgb2YgcmVjZW50IGJ1eWVycy4KICAgIHVpbnQyNTYgcHVibGljIGRpdmlkZW5kUmVjZW50QnV5ZXJzUGVyY2VudGFnZSA9IDEwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBkaXZpZGVuZFJlY2VudEJ1eWVyc1BlcmNlbnRhZ2VEZWNyZWFzZUZhY3RvciA9IDI7CiAgICAKICAgIC8vIEBkZXYgQSBtYXBwaW5nIGZyb20gZGVlZCBpZGVudGlmaWVycyB0byB0aGUgYnV5b3V0IHByaWNlLgogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgaWRlbnRpZmllclRvUHJpY2U7CiAgICAKICAgIC8vLyBAbm90aWNlIFRoZSB0aHJlc2hvbGQgZm9yIGEgcGF5bWVudCB0byBiZSBzZW50IGRpcmVjdGx5LAogICAgLy8vIGluc3RlYWQgb2YgYWRkZWQgdG8gYSBiZW5lZmljaWFyeSdzIGJhbGFuY2UuCiAgICB1aW50MjU2IHB1YmxpYyBkaXJlY3RQYXltZW50VGhyZXNob2xkID0gMCBldGhlcjsKICAgIAogICAgLy8vIEBub3RpY2UgQm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgZGVlZCBwcmljZSBjYW4gYmUgY2hhbmdlZAogICAgLy8vIG1hbnVhbGx5LgogICAgYm9vbCBwdWJsaWMgYWxsb3dDaGFuZ2VQcmljZSA9IGZhbHNlOwogICAgCiAgICAvLy8gQG5vdGljZSBUaGUgbWF4aW11bSBkZXB0aCBmb3Igd2hpY2ggZGl2aWRlbmRzIHdpbGwgYmUgcGFpZCB0byBwYXJlbnRzLgogICAgdWludDI1NiBwdWJsaWMgbWF4RGl2aWRlbmREZXB0aCA9IDY7CiAgICAKICAgIC8vLyBAZGV2IFRoaXMgZXZlbnQgaXMgZW1pdHRlZCB3aGVuIGEgZGVlZCdzIGJ1eW91dCBwcmljZSBpcyBpbml0aWFsbHkgc2V0IG9yIGNoYW5nZWQuCiAgICBldmVudCBQcmljZSh1aW50MjU2IGluZGV4ZWQgaWRlbnRpZmllciwgdWludDI1NiBwcmljZSwgdWludDI1NiBuZXh0UHJpY2UpOwogICAgCiAgICAvLy8gQGRldiBUaGlzIGV2ZW50IGlzIGVtaXR0ZWQgd2hlbiBhIGRlZWQgaXMgYm91Z2h0IG91dC4KICAgIGV2ZW50IEJ1eShhZGRyZXNzIGluZGV4ZWQgb2xkT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lciwgdWludDI1NiBpbmRleGVkIGlkZW50aWZpZXIsIHVpbnQyNTYgcHJpY2UsIHVpbnQyNTYgb3duZXJXaW5uaW5ncyk7CiAgICAKICAgIC8vLyBAZGV2IFRoaXMgZXZlbnQgaXMgZW1pdHRlZCB3aGVuIGEgZGl2aWRlbmQgaXMgcGFpZC4KICAgIGV2ZW50IERpdmlkZW5kUGFpZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgaW5kZXhlZCBpZGVudGlmaWVyQm91Z2h0LCB1aW50MjU2IGluZGV4ZWQgaWRlbnRpZmllciwgdWludDI1NiBkaXZpZGVuZCk7CiAgICAKICAgIC8vLyBAbm90aWNlIFNldCB0aGUgdGhyZXNob2xkIGZvciBhIHBheW1lbnQgdG8gYmUgc2VudCBkaXJlY3RseS4KICAgIC8vLyBAcGFyYW0gdGhyZXNob2xkIFRoZSB0aHJlc2hvbGQgZm9yIGEgcGF5bWVudCB0byBiZSBzZW50IGRpcmVjdGx5LgogICAgZnVuY3Rpb24gc2V0RGlyZWN0UGF5bWVudFRocmVzaG9sZCh1aW50MjU2IHRocmVzaG9sZCkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgZGlyZWN0UGF5bWVudFRocmVzaG9sZCA9IHRocmVzaG9sZDsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgU2V0IHdoZXRoZXIgcHJpY2VzIGNhbiBiZSBjaGFuZ2VkIG1hbnVhbGx5LgogICAgLy8vIEBwYXJhbSBfYWxsb3dDaGFuZ2VQcmljZSBCb29sIGluZGljaWF0aW5nIHdldGhlciBwcmljZXMgY2FuIGJlIGNoYW5nZWQgbWFudWFsbHkuCiAgICBmdW5jdGlvbiBzZXRBbGxvd0NoYW5nZVByaWNlKGJvb2wgX2FsbG93Q2hhbmdlUHJpY2UpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIGFsbG93Q2hhbmdlUHJpY2UgPSBfYWxsb3dDaGFuZ2VQcmljZTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgU2V0IHRoZSBtYXhpbXVtIGRpdmlkZW5kIGRlcHRoLgogICAgLy8vIEBwYXJhbSBfbWF4RGl2aWRlbmREZXB0aCBUaGUgbWF4aW11bSBkaXZpZGVuZCBkZXB0aC4KICAgIGZ1bmN0aW9uIHNldE1heERpdmlkZW5kRGVwdGgodWludDI1NiBfbWF4RGl2aWRlbmREZXB0aCkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgbWF4RGl2aWRlbmREZXB0aCA9IF9tYXhEaXZpZGVuZERlcHRoOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGUgdGhlIG5leHQgcHJpY2UgZ2l2ZW4gdGhlIGN1cnJlbnQgcHJpY2UuCiAgICAvLy8gQHBhcmFtIGN1cnJlbnRQcmljZSBUaGUgY3VycmVudCBwcmljZS4KICAgIGZ1bmN0aW9uIG5leHRQcmljZSh1aW50MjU2IGN1cnJlbnRQcmljZSkgcHVibGljIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgaWYgKGN1cnJlbnRQcmljZSA8IDEgZXRoZXIpIHsKICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRQcmljZS5tdWwoMjAwKS5kaXYoMTAwKTsgLy8gMTAwJSBpbmNyZWFzZQogICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFByaWNlIDwgNSBldGhlcikgewogICAgICAgICAgICByZXR1cm4gY3VycmVudFByaWNlLm11bCgxNTApLmRpdigxMDApOyAvLyA1MCUgaW5jcmVhc2UKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gY3VycmVudFByaWNlLm11bCgxMzUpLmRpdigxMDApOyAvLyAzNSUgaW5jcmVhc2UKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNldCB0aGUgcHJpY2Ugb2YgYSBkZWVkLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNoYW5nZSB0aGUgcHJpY2Ugb2YuCiAgICAvLy8gQHBhcmFtIG5ld1ByaWNlIFRoZSBuZXcgcHJpY2Ugb2YgdGhlIGRlZWQuCiAgICBmdW5jdGlvbiBjaGFuZ2VEZWVkUHJpY2UodWludDI1NiBpZGVudGlmaWVyLCB1aW50MjU2IG5ld1ByaWNlKSBwdWJsaWMgewogICAgICAgIC8vIFRoZSBtZXNzYWdlIHNlbmRlciBtdXN0IGJlIHRoZSBkZWVkIG93bmVyLgogICAgICAgIHJlcXVpcmUoaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgCiAgICAgICAgLy8gUHJpY2UgY2hhbmdlcyBtdXN0IGJlIGVuYWJsZWQuCiAgICAgICAgcmVxdWlyZShhbGxvd0NoYW5nZVByaWNlKTsKICAgICAgICAKICAgICAgICAvLyBUaGUgbmV3IHByaWNlIG11c3QgYmUgbG93ZXIgdGhhbiB0aGUgY3VycmVudCBwcmljZS4KICAgICAgICByZXF1aXJlKG5ld1ByaWNlIDwgaWRlbnRpZmllclRvUHJpY2VbaWRlbnRpZmllcl0pOwogICAgICAgIAogICAgICAgIC8vIFNldCB0aGUgbmV3IHByaWNlLgogICAgICAgIGlkZW50aWZpZXJUb1ByaWNlW2lkZW50aWZpZXJdID0gbmV3UHJpY2U7CiAgICAgICAgUHJpY2UoaWRlbnRpZmllciwgbmV3UHJpY2UsIG5leHRQcmljZShuZXdQcmljZSkpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXQgdGhlIGluaXRpYWwgcHJpY2Ugb2YgYSBkZWVkLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNoYW5nZSB0aGUgcHJpY2Ugb2YuCiAgICAvLy8gQHBhcmFtIG5ld1ByaWNlIFRoZSBuZXcgcHJpY2Ugb2YgdGhlIGRlZWQuCiAgICBmdW5jdGlvbiBjaGFuZ2VJbml0aWFsUHJpY2UodWludDI1NiBpZGVudGlmaWVyLCB1aW50MjU2IG5ld1ByaWNlKSBwdWJsaWMgb25seUNGTyB7ICAgICAgICAKICAgICAgICAvLyBUaGUgZGVlZCBtdXN0IGJlIG93bmVkIGJ5IHRoZSBjb250cmFjdC4KICAgICAgICByZXF1aXJlKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIAogICAgICAgIC8vIFNldCB0aGUgbmV3IHByaWNlLgogICAgICAgIGlkZW50aWZpZXJUb1ByaWNlW2lkZW50aWZpZXJdID0gbmV3UHJpY2U7CiAgICAgICAgUHJpY2UoaWRlbnRpZmllciwgbmV3UHJpY2UsIG5leHRQcmljZShuZXdQcmljZSkpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBQYXkgZGl2aWRlbmRzIHRvIHBhcmVudHMgb2YgYSBkZWVkLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyQm91Z2h0IFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRoYXQgd2FzIGJvdWdodC4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBwYXkgaXRzIHBhcmVudHMgZGl2aWRlbmRzIGZvciAocmVjdXJzZWQpLgogICAgLy8vIEBwYXJhbSBkaXZpZGVuZCBUaGUgZGl2aWRlbmQgdG8gYmUgcGFpZCB0byBwYXJlbnRzIG9mIHRoZSBkZWVkLgogICAgLy8vIEBwYXJhbSBkZXB0aCBUaGUgZGVwdGggb2YgdGhpcyBkaXZpZGVuZC4KICAgIGZ1bmN0aW9uIF9wYXlQYXJlbnREaXZpZGVuZHModWludDI1NiBpZGVudGlmaWVyQm91Z2h0LCB1aW50MjU2IGlkZW50aWZpZXIsIHVpbnQyNTYgZGl2aWRlbmQsIHVpbnQyNTYgZGVwdGgpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zKHVpbnQyNTYgdG90YWxEaXZpZGVuZHNQYWlkKQogICAgewogICAgICAgIHVpbnQyNTYgcGFyZW50SWRlbnRpZmllciA9IGlkZW50aWZpZXJUb1BhcmVudElkZW50aWZpZXJbaWRlbnRpZmllcl07CiAgICAgICAgCiAgICAgICAgaWYgKHBhcmVudElkZW50aWZpZXIgIT0gMCAmJiBkZXB0aCA8IG1heERpdmlkZW5kRGVwdGgpIHsKICAgICAgICAgICAgYWRkcmVzcyBwYXJlbnRPd25lciA9IGlkZW50aWZpZXJUb093bmVyW3BhcmVudElkZW50aWZpZXJdOwogICAgICAgIAogICAgICAgICAgICBpZiAocGFyZW50T3duZXIgIT0gYWRkcmVzcyh0aGlzKSkgeyAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2VuZCBkaXZpZGVuZCB0byB0aGUgb3duZXIgb2YgdGhlIHBhcmVudC4KICAgICAgICAgICAgICAgIF9zZW5kRnVuZHMocGFyZW50T3duZXIsIGRpdmlkZW5kKTsKICAgICAgICAgICAgICAgIERpdmlkZW5kUGFpZChwYXJlbnRPd25lciwgaWRlbnRpZmllckJvdWdodCwgcGFyZW50SWRlbnRpZmllciwgZGl2aWRlbmQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICB0b3RhbERpdmlkZW5kc1BhaWQgPSBkaXZpZGVuZDsKICAgICAgICAKICAgICAgICAgICAgLy8gUmVjdXJzaXZlbHkgcGF5IGRpdmlkZW5kcyB0byBwYXJlbnRzIG9mIHBhcmVudHMuCiAgICAgICAgICAgIHVpbnQyNTYgZGl2aWRlbmRzUGFpZCA9IF9wYXlQYXJlbnREaXZpZGVuZHMoaWRlbnRpZmllckJvdWdodCwgcGFyZW50SWRlbnRpZmllciwgZGl2aWRlbmQsIGRlcHRoICsgMSk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0b3RhbERpdmlkZW5kc1BhaWQgPSB0b3RhbERpdmlkZW5kc1BhaWQuYWRkKGRpdmlkZW5kc1BhaWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIE5vdCBzdHJpY3RseSBuZWNlc3NhcnkgdG8gc2V0IHRoaXMgdG8gMCBleHBsaWNpdGx5Li4uIGJ1dCBtYWtlcwogICAgICAgICAgICAvLyBpdCBjbGVhcmVyIHRvIHNlZSB3aGF0IGhhcHBlbnMuCiAgICAgICAgICAgIHRvdGFsRGl2aWRlbmRzUGFpZCA9IDA7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiBQYXkgZGl2aWRlbmRzIHRvIHJlY2VudCBidXllcnMuCiAgICAvLy8gQHBhcmFtIHByaWNlIFRoZSBwcmljZSBvZiB0aGUgY2FyZCB0aGF0IHdhcyBib3VnaHQuCiAgICBmdW5jdGlvbiBfcGF5UmVjZW50QnV5ZXJEaXZpZGVuZHModWludDI1NiBwcmljZSkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnModWludDI1NiB0b3RhbERpdmlkZW5kc1BhaWQpCiAgICB7CiAgICAgICAgdWludDI1NiBkaXZpZGVuZCA9IHByaWNlLm11bChkaXZpZGVuZFJlY2VudEJ1eWVyc1BlcmNlbnRhZ2UpLmRpdigxMDAwMDApOwogICAgICAgIAogICAgICAgIC8vIFBheSBmaXJzdCBkaXZpZGVuZC4KICAgICAgICBpZiAocmVjZW50QnV5ZXJzWzBdICE9IDB4MCkgewogICAgICAgICAgICBfc2VuZEZ1bmRzKHJlY2VudEJ1eWVyc1swXSwgZGl2aWRlbmQpOwogICAgICAgIH0KICAgICAgICB0b3RhbERpdmlkZW5kc1BhaWQgPSBkaXZpZGVuZDsKICAgICAgICAKICAgICAgICAvLyBQYXkgc2Vjb25kIGRpdmlkZW5kLgogICAgICAgIGRpdmlkZW5kID0gZGl2aWRlbmQuZGl2KGRpdmlkZW5kUmVjZW50QnV5ZXJzUGVyY2VudGFnZURlY3JlYXNlRmFjdG9yKTsKICAgICAgICBpZiAocmVjZW50QnV5ZXJzWzFdICE9IDB4MCkgewogICAgICAgICAgICBfc2VuZEZ1bmRzKHJlY2VudEJ1eWVyc1sxXSwgZGl2aWRlbmQpOwogICAgICAgIH0KICAgICAgICB0b3RhbERpdmlkZW5kc1BhaWQgPSB0b3RhbERpdmlkZW5kc1BhaWQuYWRkKGRpdmlkZW5kKTsKICAgICAgICAKICAgICAgICAvLyBQYXkgdGhpcmQgZGl2aWRlbmQuCiAgICAgICAgZGl2aWRlbmQgPSBkaXZpZGVuZC5kaXYoZGl2aWRlbmRSZWNlbnRCdXllcnNQZXJjZW50YWdlRGVjcmVhc2VGYWN0b3IpOwogICAgICAgIGlmIChyZWNlbnRCdXllcnNbMl0gIT0gMHgwKSB7CiAgICAgICAgICAgIF9zZW5kRnVuZHMocmVjZW50QnV5ZXJzWzJdLCBkaXZpZGVuZCk7CiAgICAgICAgfQogICAgICAgIHRvdGFsRGl2aWRlbmRzUGFpZCA9IHRvdGFsRGl2aWRlbmRzUGFpZC5hZGQoZGl2aWRlbmQpOwogICAgICAgIAogICAgICAgIC8vIFBheSBmb3VydGggZGl2aWRlbmQuCiAgICAgICAgZGl2aWRlbmQgPSBkaXZpZGVuZC5kaXYoZGl2aWRlbmRSZWNlbnRCdXllcnNQZXJjZW50YWdlRGVjcmVhc2VGYWN0b3IpOwogICAgICAgIGlmIChyZWNlbnRCdXllcnNbM10gIT0gMHgwKSB7CiAgICAgICAgICAgIF9zZW5kRnVuZHMocmVjZW50QnV5ZXJzWzNdLCBkaXZpZGVuZCk7CiAgICAgICAgfQogICAgICAgIHRvdGFsRGl2aWRlbmRzUGFpZCA9IHRvdGFsRGl2aWRlbmRzUGFpZC5hZGQoZGl2aWRlbmQpOwogICAgICAgIAogICAgICAgIC8vIFBheSBmaWZ0aCBkaXZpZGVuZC4KICAgICAgICBkaXZpZGVuZCA9IGRpdmlkZW5kLmRpdihkaXZpZGVuZFJlY2VudEJ1eWVyc1BlcmNlbnRhZ2VEZWNyZWFzZUZhY3Rvcik7CiAgICAgICAgaWYgKHJlY2VudEJ1eWVyc1s0XSAhPSAweDApIHsKICAgICAgICAgICAgX3NlbmRGdW5kcyhyZWNlbnRCdXllcnNbNF0sIGRpdmlkZW5kKTsKICAgICAgICB9CiAgICAgICAgdG90YWxEaXZpZGVuZHNQYWlkID0gdG90YWxEaXZpZGVuZHNQYWlkLmFkZChkaXZpZGVuZCk7CiAgICAgICAgCiAgICAgICAgLy8gUGF5IHNpeHRoIGRpdmlkZW5kLgogICAgICAgIGRpdmlkZW5kID0gZGl2aWRlbmQuZGl2KGRpdmlkZW5kUmVjZW50QnV5ZXJzUGVyY2VudGFnZURlY3JlYXNlRmFjdG9yKTsKICAgICAgICBpZiAocmVjZW50QnV5ZXJzWzVdICE9IDB4MCkgewogICAgICAgICAgICBfc2VuZEZ1bmRzKHJlY2VudEJ1eWVyc1s1XSwgZGl2aWRlbmQpOwogICAgICAgIH0KICAgICAgICB0b3RhbERpdmlkZW5kc1BhaWQgPSB0b3RhbERpdmlkZW5kc1BhaWQuYWRkKGRpdmlkZW5kKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUGF5IHRyYWRlIGRpdmlkZW5kcy4KICAgIC8vLyBAcGFyYW0gcHJpY2UgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGNhcmQgdGhhdCB3YXMgYm91Z2h0LgogICAgLy8vIEBwYXJhbSBwcmljZSBUaGUgcHJpY2Ugb2YgdGhlIGNhcmQgdGhhdCB3YXMgYm91Z2h0LgogICAgZnVuY3Rpb24gX3BheURpdmlkZW5kcyh1aW50MjU2IGlkZW50aWZpZXIsIHVpbnQyNTYgcHJpY2UpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zKHVpbnQyNTYgdG90YWxEaXZpZGVuZHNQYWlkKQogICAgewogICAgICAgIC8vIFBheSBwYXJlbnQgZGl2aWRlbmRzLgogICAgICAgIHVpbnQyNTYgcGFyZW50RGl2aWRlbmQgPSBwcmljZS5tdWwoZGl2aWRlbmRQYXJlbnRzUGVyY2VudGFnZSkuZGl2KDEwMDAwMCk7CiAgICAgICAgdG90YWxEaXZpZGVuZHNQYWlkID0gX3BheVBhcmVudERpdmlkZW5kcyhpZGVudGlmaWVyLCBpZGVudGlmaWVyLCBwYXJlbnREaXZpZGVuZCwgMCk7CiAgICAgICAgCiAgICAgICAgLy8gUGF5IHJlY2VudCBidXllciBkaXZpZGVuZHMuCiAgICAgICAgdG90YWxEaXZpZGVuZHNQYWlkID0gdG90YWxEaXZpZGVuZHNQYWlkLmFkZChfcGF5UmVjZW50QnV5ZXJEaXZpZGVuZHMocHJpY2UpKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIHRoZSBjb250cmFjdCBmZWUuCiAgICAvLy8gQHBhcmFtIHByaWNlIFRoZSBwcmljZSBvZiB0aGUgYnV5b3V0LgogICAgLy8vIEBwYXJhbSBkaXZpZGVuZHNQYWlkIFRoZSB0b3RhbCBhbW91bnQgcGFpZCBpbiBkaXZpZGVuZHMuCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVGZWUodWludDI1NiBwcmljZSwgdWludDI1NiBkaXZpZGVuZHNQYWlkKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYgZmVlKSB7CiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBhYnNvbHV0ZSBtaW5pbXVtIGZlZS4KICAgICAgICBmZWUgPSBwcmljZS5tdWwobWluaW11bUZlZVBlcmNlbnRhZ2UpLmRpdigxMDAwMDApOwogICAgICAgIAogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgbWluaW11bSBmZWUgcGx1cyBkaXZpZGVuZHMgcGF5YWJsZS4KICAgICAgICAvLyBTZWUgYWxzbyB0aGUgZXhwbGFuYXRpb24gYXQgdGhlIGRlZmluaXRpb24gb2YKICAgICAgICAvLyBtaW5pbXVtRmVlUGx1c0RpdmlkZW5kcy4KICAgICAgICB1aW50MjU2IF9taW5pbXVtRmVlUGx1c0RpdmlkZW5kcyA9IHByaWNlLm11bChtaW5pbXVtRmVlUGx1c0RpdmlkZW5kc1BlcmNlbnRhZ2UpLmRpdigxMDAwMDApOwogICAgICAgIAogICAgICAgIGlmIChfbWluaW11bUZlZVBsdXNEaXZpZGVuZHMgPiBkaXZpZGVuZHNQYWlkKSB7CiAgICAgICAgICAgIHVpbnQyNTYgZmVlTWludXNEaXZpZGVuZHMgPSBfbWluaW11bUZlZVBsdXNEaXZpZGVuZHMuc3ViKGRpdmlkZW5kc1BhaWQpOwogICAgICAgIAogICAgICAgICAgICAvLyBUaGUgbWluaW11bSB0b3RhbCBwYWlkIGluICdmZWVzIHBsdXMgZGl2aWRlbmRzJywgbWludXMgZGl2aWRlbmRzLCBpcwogICAgICAgICAgICAvLyBncmVhdGVyIHRoYW4gdGhlIG1pbmltdW0gZmVlLiBTZXQgdGhlIGZlZSB0byB0aGlzIHZhbHVlLgogICAgICAgICAgICBpZiAoZmVlTWludXNEaXZpZGVuZHMgPiBmZWUpIHsKICAgICAgICAgICAgICAgIGZlZSA9IGZlZU1pbnVzRGl2aWRlbmRzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiBTaGlmdCB0aGUgNiBtb3N0IHJlY2VudCBidXllcnMsIGFuZCBhZGQgdGhlIG5ldyBidXllcgogICAgLy8vIHRvIHRoZSBmcm9udC4KICAgIC8vLyBAcGFyYW0gbmV3QnV5ZXIgVGhlIGJ1eWVyIHRvIGFkZCB0byB0aGUgZnJvbnQgb2YgdGhlIHJlY2VudAogICAgLy8vIGJ1eWVycyBsaXN0LgogICAgZnVuY3Rpb24gX3NoaWZ0UmVjZW50QnV5ZXJzKGFkZHJlc3MgbmV3QnV5ZXIpIGludGVybmFsIHsKICAgICAgICByZWNlbnRCdXllcnNbNV0gPSByZWNlbnRCdXllcnNbNF07CiAgICAgICAgcmVjZW50QnV5ZXJzWzRdID0gcmVjZW50QnV5ZXJzWzNdOwogICAgICAgIHJlY2VudEJ1eWVyc1szXSA9IHJlY2VudEJ1eWVyc1syXTsKICAgICAgICByZWNlbnRCdXllcnNbMl0gPSByZWNlbnRCdXllcnNbMV07CiAgICAgICAgcmVjZW50QnV5ZXJzWzFdID0gcmVjZW50QnV5ZXJzWzBdOwogICAgICAgIHJlY2VudEJ1eWVyc1swXSA9IG5ld0J1eWVyOwogICAgfQogICAgCiAgICAvLy8gQGRldiBTZW5kIGZ1bmRzIHRvIGEgYmVuZWZpY2lhcnkuIElmIHNlbmRpbmcgZmFpbHMsIGFzc2lnbgogICAgLy8vIGZ1bmRzIHRvIHRoZSBiZW5lZmljaWFyeSdzIGJhbGFuY2UgZm9yIG1hbnVhbCB3aXRoZHJhd2FsLgogICAgLy8vIEBwYXJhbSBiZW5lZmljaWFyeSBUaGUgYmVuZWZpY2lhcnkncyBhZGRyZXNzIHRvIHNlbmQgZnVuZHMgdG8KICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gc2VuZC4KICAgIGZ1bmN0aW9uIF9zZW5kRnVuZHMoYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgICAgICBpZiAoYW1vdW50IDwgZGlyZWN0UGF5bWVudFRocmVzaG9sZCkgewogICAgICAgICAgICAvLyBBbW91bnQgaXMgdW5kZXIgc2VuZCB0aHJlc2hvbGQuIFNlbmQgZnVuZHMgYXN5bmNocm9ub3VzbHkKICAgICAgICAgICAgLy8gZm9yIG1hbnVhbCB3aXRoZHJhd2FsIGJ5IHRoZSBiZW5lZmljaWFyeS4KICAgICAgICAgICAgYXN5bmNTZW5kKGJlbmVmaWNpYXJ5LCBhbW91bnQpOwogICAgICAgIH0gZWxzZSBpZiAoIWJlbmVmaWNpYXJ5LnNlbmQoYW1vdW50KSkgewogICAgICAgICAgICAvLyBGYWlsZWQgdG8gc2VuZCBmdW5kcy4gVGhpcyBjYW4gaGFwcGVuIGR1ZSB0byBhIGZhaWx1cmUgaW4KICAgICAgICAgICAgLy8gZmFsbGJhY2sgY29kZSBvZiB0aGUgYmVuZWZpY2lhcnksIG9yIGJlY2F1c2Ugb2YgY2FsbHN0YWNrCiAgICAgICAgICAgIC8vIGRlcHRoLgogICAgICAgICAgICAvLyBTZW5kIGZ1bmRzIGFzeW5jaHJvbm91c2x5IGZvciBtYW51YWwgd2l0aGRyYXdhbCBieSB0aGUKICAgICAgICAgICAgLy8gYmVuZWZpY2lhcnkuCiAgICAgICAgICAgIGFzeW5jU2VuZChiZW5lZmljaWFyeSwgYW1vdW50KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFdpdGhkcmF3ICh1bm93ZWQpIGNvbnRyYWN0IGJhbGFuY2UuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0ZyZWVCYWxhbmNlKCkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBmcmVlICh1bm93ZWQpIGJhbGFuY2UuIFRoaXMgbmV2ZXIgdW5kZXJmbG93cywgYXMKICAgICAgICAvLyB0b3RhbFBheW1lbnRzIGlzIGd1YXJhbnRlZWQgdG8gYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZQogICAgICAgIC8vIGNvbnRyYWN0IGJhbGFuY2UuCiAgICAgICAgdWludDI1NiBmcmVlQmFsYW5jZSA9IHRoaXMuYmFsYW5jZSAtIHRvdGFsUGF5bWVudHM7CiAgICAgICAgCiAgICAgICAgY2ZvQWRkcmVzcy50cmFuc2ZlcihmcmVlQmFsYW5jZSk7CiAgICB9Cn0KCgovLy8gQGRldiBEZWZpbmVzIGNvcmUgTWV0YUdhbWUgZnVuY3Rpb25hbGl0eS4KY29udHJhY3QgTWV0YUdhbWVDb3JlIGlzIE1ldGFHYW1lRmluYW5jZSB7CiAgICAKICAgIGZ1bmN0aW9uIE1ldGFHYW1lQ29yZSgpIHB1YmxpYyB7CiAgICAgICAgLy8gU3RhcnQgdGhlIGNvbnRyYWN0IHBhdXNlZC4KICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBjb2xsZWN0aWJsZS4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciBvZiB0aGUgY29sbGVjdGlibGUgdGhhdCBpcyB0byBiZSBjcmVhdGVkLgogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgaW5pdGlhbCBvd25lci4gQmxhbmsgaWYgdGhpcyBjb250cmFjdCBzaG91bGQKICAgIC8vLyBiZSB0aGUgaW5pdGlhbCBvd25lci4KICAgIC8vLyBAcGFyYW0gcGFyZW50SWRlbnRpZmllciBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGFyZW50IG9mIHRoZSBjb2xsZWN0aWJsZSwgd2hpY2gKICAgIC8vLyByZWNlaXZlcyBkaXZpZGVuZHMgd2hlbiB0aGlzIGNvbGxlY3RpYmxlIHRyYWRlcy4KICAgIC8vLyBAcGFyYW0gcHJpY2UgVGhlIGluaXRpYWwgcHJpY2Ugb2YgdGhlIGNvbGxlY3RpYmxlLgogICAgZnVuY3Rpb24gY3JlYXRlQ29sbGVjdGlibGUodWludDI1NiBpZGVudGlmaWVyLCBhZGRyZXNzIG93bmVyLCB1aW50MjU2IHBhcmVudElkZW50aWZpZXIsIHVpbnQyNTYgcHJpY2UpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIC8vIFRoZSBpZGVudGlmaWVyIG11c3QgYmUgdmFsaWQuIElkZW50aWZpZXIgMCBpcyByZXNlcnZlZAogICAgICAgIC8vIHRvIG1hcmsgYSBjb2xsZWN0aWJsZSBhcyBoYXZpbmcgbm8gcGFyZW50LgogICAgICAgIHJlcXVpcmUoaWRlbnRpZmllciA+PSAxKTsKICAgIAogICAgICAgIC8vIFRoZSBpZGVudGlmaWVyIG11c3Qgbm90IGV4aXN0IHlldC4KICAgICAgICByZXF1aXJlKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdID09IDB4MCk7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIHRoZSBpZGVudGlmaWVyIHRvIHRoZSBsaXN0IG9mIGV4aXN0aW5nIGlkZW50aWZpZXJzLgogICAgICAgIGlkZW50aWZpZXJzLnB1c2goaWRlbnRpZmllcik7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBpbml0aWFsT3duZXIgPSBvd25lcjsKICAgICAgICAKICAgICAgICBpZiAoaW5pdGlhbE93bmVyID09IDB4MCkgewogICAgICAgICAgICAvLyBTZXQgdGhlIGluaXRpYWwgb3duZXIgdG8gYmUgdGhlIGNvbnRyYWN0IGl0c2VsZi4KICAgICAgICAgICAgaW5pdGlhbE93bmVyID0gYWRkcmVzcyh0aGlzKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIGNvbGxlY3RpYmxlIHRvIHRoZSBpbml0aWFsIG93bmVyLgogICAgICAgIF90cmFuc2ZlcigweDAsIGluaXRpYWxPd25lciwgaWRlbnRpZmllcik7CiAgICAgICAgCiAgICAgICAgLy8gU2V0IHRoZSBwYXJlbnQgaWRlbnRpZmllci4KICAgICAgICBpZGVudGlmaWVyVG9QYXJlbnRJZGVudGlmaWVyW2lkZW50aWZpZXJdID0gcGFyZW50SWRlbnRpZmllcjsKICAgICAgICAKICAgICAgICAvLyBTZXQgdGhlIGluaXRpYWwgcHJpY2UuCiAgICAgICAgaWRlbnRpZmllclRvUHJpY2VbaWRlbnRpZmllcl0gPSBwcmljZTsKICAgICAgICAKICAgICAgICAvLyBFbWl0IHByaWNlIGV2ZW50LgogICAgICAgIFByaWNlKGlkZW50aWZpZXIsIHByaWNlLCBuZXh0UHJpY2UocHJpY2UpKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgU2V0IHRoZSBwYXJlbnQgY29sbGVjdGlibGUgb2YgYSBjb2xsZWN0aWJsZS4KICAgIGZ1bmN0aW9uIHNldFBhcmVudCh1aW50MjU2IGlkZW50aWZpZXIsIHVpbnQyNTYgcGFyZW50SWRlbnRpZmllcikgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgLy8gVGhlIGRlZWQgbXVzdCBleGlzdC4KICAgICAgICByZXF1aXJlKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdICE9IDB4MCk7CiAgICAgICAgCiAgICAgICAgaWRlbnRpZmllclRvUGFyZW50SWRlbnRpZmllcltpZGVudGlmaWVyXSA9IHBhcmVudElkZW50aWZpZXI7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEJ1eSBhIGNvbGxlY3RpYmxlLgogICAgZnVuY3Rpb24gYnV5KHVpbnQyNTYgaWRlbnRpZmllcikgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBUaGUgY29sbGVjdGlibGUgbXVzdCBleGlzdC4KICAgICAgICByZXF1aXJlKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdICE9IDB4MCk7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBvbGRPd25lciA9IGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdOwogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBpZGVudGlmaWVyVG9QcmljZVtpZGVudGlmaWVyXTsKICAgICAgICAKICAgICAgICAvLyBUaGUgb2xkIG93bmVyIG11c3Qgbm90IGJlIHRoZSBzYW1lIGFzIHRoZSBidXllci4KICAgICAgICByZXF1aXJlKG9sZE93bmVyICE9IG1zZy5zZW5kZXIpOwogICAgICAgIAogICAgICAgIC8vIEVub3VnaCBldGhlciBtdXN0IGJlIHByb3ZpZGVkLgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHByaWNlKTsKICAgICAgICAKICAgICAgICAvLyBTZXQgdGhlIG5ldyBwcmljZS4KICAgICAgICB1aW50MjU2IG5ld1ByaWNlID0gbmV4dFByaWNlKHByaWNlKTsKICAgICAgICBpZGVudGlmaWVyVG9QcmljZVtpZGVudGlmaWVyXSA9IG5ld1ByaWNlOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIHRoZSBjb2xsZWN0aWJsZS4KICAgICAgICBfdHJhbnNmZXIob2xkT3duZXIsIG1zZy5zZW5kZXIsIGlkZW50aWZpZXIpOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgcHJpY2UgY2hhbmdlIGV2ZW50LgogICAgICAgIFByaWNlKGlkZW50aWZpZXIsIG5ld1ByaWNlLCBuZXh0UHJpY2UobmV3UHJpY2UpKTsKICAgICAgICAKICAgICAgICAvLyBFbWl0IGJ1eSBldmVudC4KICAgICAgICBCdXkob2xkT3duZXIsIG1zZy5zZW5kZXIsIGlkZW50aWZpZXIsIHByaWNlLCBvbGRPd25lcldpbm5pbmdzKTsKICAgICAgICAKICAgICAgICAvLyBQYXkgZGl2aWRlbmRzLgogICAgICAgIHVpbnQyNTYgZGl2aWRlbmRzUGFpZCA9IF9wYXlEaXZpZGVuZHMoaWRlbnRpZmllciwgcHJpY2UpOwogICAgICAgIAogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgY29udHJhY3QgZmVlLgogICAgICAgIHVpbnQyNTYgZmVlID0gY2FsY3VsYXRlRmVlKHByaWNlLCBkaXZpZGVuZHNQYWlkKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHdpbm5pbmdzIGZvciB0aGUgcHJldmlvdXMgb3duZXIuCiAgICAgICAgdWludDI1NiBvbGRPd25lcldpbm5pbmdzID0gcHJpY2Uuc3ViKGRpdmlkZW5kc1BhaWQpLnN1YihmZWUpOwogICAgICAgIAogICAgICAgIC8vIEFkZCB0aGUgYnV5ZXIgdG8gdGhlIHJlY2VudCBidXllciBsaXN0LgogICAgICAgIF9zaGlmdFJlY2VudEJ1eWVycyhtc2cuc2VuZGVyKTsKICAgICAgICAKICAgICAgICBpZiAob2xkT3duZXIgIT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICAvLyBUaGUgb2xkIG93bmVyIGlzIG5vdCB0aGlzIGNvbnRyYWN0IGl0c2VsZi4KICAgICAgICAgICAgLy8gUGF5IHRoZSBvbGQgb3duZXIuCiAgICAgICAgICAgIF9zZW5kRnVuZHMob2xkT3duZXIsIG9sZE93bmVyV2lubmluZ3MpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgb3ZlcnNwZW50IGV0aGVyLiBUaGlzIGNhbm5vdCB1bmRlcmZsb3csIGFzIHRoZSByZXF1aXJlCiAgICAgICAgLy8gZ3VhcmFudGVlcyBwcmljZSB0byBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gbXNnLnZhbHVlLgogICAgICAgIHVpbnQyNTYgZXhjZXNzID0gbXNnLnZhbHVlIC0gcHJpY2U7CiAgICAgICAgCiAgICAgICAgaWYgKGV4Y2VzcyA+IDApIHsKICAgICAgICAgICAgLy8gUmVmdW5kIG92ZXJzcGVudCBFdGhlci4KICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlc3MpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJuIGEgY29sbGVjdGlibGUncyBkZXRhaWxzLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBjb2xsZWN0aWJsZSB0byBnZXQgZGV0YWlscyBmb3IuCiAgICBmdW5jdGlvbiBnZXREZWVkKHVpbnQyNTYgaWRlbnRpZmllcikKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKHVpbnQyNTYgZGVlZElkLCBhZGRyZXNzIG93bmVyLCB1aW50MjU2IGJ1eVByaWNlLCB1aW50MjU2IG5leHRCdXlQcmljZSkKICAgIHsKICAgICAgICBkZWVkSWQgPSBpZGVudGlmaWVyOwogICAgICAgIG93bmVyID0gaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl07CiAgICAgICAgYnV5UHJpY2UgPSBpZGVudGlmaWVyVG9QcmljZVtpZGVudGlmaWVyXTsKICAgICAgICBuZXh0QnV5UHJpY2UgPSBuZXh0UHJpY2UoYnV5UHJpY2UpOwogICAgfQp9'.
	

]
