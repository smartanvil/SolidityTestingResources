Class {
	#name : #SRTa7ace3440fd2d6afa37d12f18e3a9f25c55d1e47,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa7ace3440fd2d6afa37d12f18e3a9f25c55d1e47 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgpsaWJyYXJ5IFRyZWVMaWIgewogIHVzaW5nIEludGVydmFsTGliIGZvciBJbnRlcnZhbExpYi5JbnRlcnZhbDsKICB1c2luZyBMaXN0TGliIGZvciBMaXN0TGliLkxpc3Q7CiAgLy8gVE9ETzogcmVtb3ZlIG5lZWQgZm9yIHJlZGVmaW5pdGlvbiBoZXJlCiAgdWludDggY29uc3RhbnQgU0VBUkNIX0RPTkUgPSAweDAwOwogIHVpbnQ4IGNvbnN0YW50IFNFQVJDSF9FQVJMSUVSID0gMHgwMTsKICB1aW50OCBjb25zdGFudCBTRUFSQ0hfTEFURVIgPSAweDEwOwoKICBib29sIGNvbnN0YW50IFRSQVZFUlNFRF9FQVJMSUVSID0gZmFsc2U7CiAgYm9vbCBjb25zdGFudCBUUkFWRVJTRURfTEFURVIgPSB0cnVlOwoKICBzdHJ1Y3QgVHJlZSB7CiAgICAvLyBnbG9iYWwgdGFibGUgb2YgaW50ZXJ2YWxzCiAgICBtYXBwaW5nICh1aW50ID0+IEludGVydmFsTGliLkludGVydmFsKSBpbnRlcnZhbHM7CiAgICB1aW50IG51bUludGVydmFsczsKCiAgICAvLyB0cmVlIG5vZGVzCiAgICBtYXBwaW5nICh1aW50ID0+IE5vZGUpIG5vZGVzOwogICAgdWludCBudW1Ob2RlczsKCiAgICAvLyBwb2ludGVyIHRvIHJvb3Qgb2YgdHJlZQogICAgdWludCByb290Tm9kZTsKICB9CgogIHN0cnVjdCBOb2RlIHsKICAgIHVpbnQgZWFybGllcjsKICAgIHVpbnQgbGF0ZXI7CgogICAgTGlzdExpYi5MaXN0IGludGVydmFsczsKICB9CgogIC8qCiAgICogYWRkaW5nIGludGVydmFscwogICAqLwogIGZ1bmN0aW9uIGFkZEludGVydmFsKFRyZWUgc3RvcmFnZSB0cmVlLAoJCSAgICAgICB1aW50IGJlZ2luLAoJCSAgICAgICB1aW50IGVuZCwKCQkgICAgICAgYnl0ZXMzMiBkYXRhKQogICAgaW50ZXJuYWwKICB7CiAgICB1aW50IGludGVydmFsSUQgPSBfY3JlYXRlSW50ZXJ2YWwodHJlZSwgYmVnaW4sIGVuZCwgZGF0YSk7CgogICAgLy8gaWYgdGhlIHRyZWUgaXMgZW1wdHksIGNyZWF0ZSB0aGUgcm9vdAogICAgaWYgKHRyZWUucm9vdE5vZGUgPT0gMCkgewogICAgICB2YXIgbm9kZUlEID0gX2NyZWF0ZU5vZGUodHJlZSk7CiAgICAgIHRyZWUucm9vdE5vZGUgPSBub2RlSUQ7CgogICAgICB0cmVlLm5vZGVzW25vZGVJRF0uaW50ZXJ2YWxzLmFkZChiZWdpbiwgZW5kLCBpbnRlcnZhbElEKTsKCiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvKgogICAgICogZGVwdGgtZmlyc3Qgc2VhcmNoIHRyZWUgZm9yIHBsYWNlIHRvIGFkZCBpbnRlcnZhbC4KICAgICAqIGZvciBlYWNoIHN0ZXAgb2YgdGhlIHNlYXJjaDoKICAgICAqICAgaWYgdGhlIG5ldyBpbnRlcnZhbCBjb250YWlucyB0aGUgY3VycmVudCBub2RlJ3MgY2VudGVyOgogICAgICogICAgIGFkZCBpbnRlcnZhbCB0byBjdXJyZW50IG5vZGUKICAgICAqICAgICBzdG9wIHNlYXJjaAogICAgICoKICAgICAqICAgaWYgdGhlIG5ldyBpbnRlcnZhbCA8IGNlbnRlcjoKICAgICAqICAgICByZWN1cnNlICJiZWZvcmUiCiAgICAgKiAgIGlmIHRoZSBuZXcgaW50ZXJ2YWwgPiBjZW50ZXI6CiAgICAgKiAgICAgcmVjdXJzZSAiYWZ0ZXIiCiAgICAgKi8KICAgIHVpbnQgY3VySUQgPSB0cmVlLnJvb3ROb2RlOwoKICAgIGJvb2wgZm91bmQgPSBmYWxzZTsKICAgIGRvIHsKICAgICAgTm9kZSBzdG9yYWdlIGN1ck5vZGUgPSB0cmVlLm5vZGVzW2N1cklEXTsKCgogICAgICAvLyB0cmFjayBkaXJlY3Rpb24gb2YgcmVjdXJzaW9uIGVhY2ggc3RlcCwgdG8gdXBkYXRlIGNvcnJlY3QgcG9pbnRlcgogICAgICAvLyB1cG9uIG5lZWRpbmcgdG8gYWRkIGEgbmV3IG5vZGUKICAgICAgYm9vbCByZWN1cnNlRGlyZWN0aW9uOwoKICAgICAgaWYgKGVuZCA8PSBjdXJOb2RlLmludGVydmFscy5jZW50ZXIpIHsKCS8vIHRyYXZlcnNlIGJlZm9yZQoJY3VySUQgPSBjdXJOb2RlLmVhcmxpZXI7CglyZWN1cnNlRGlyZWN0aW9uID0gVFJBVkVSU0VEX0VBUkxJRVI7CiAgICAgIH0gZWxzZSBpZiAoYmVnaW4gPiBjdXJOb2RlLmludGVydmFscy5jZW50ZXIpIHsKCS8vIHRyYXZlcnNlIGFmdGVyCgljdXJJRCA9IGN1ck5vZGUubGF0ZXI7CglyZWN1cnNlRGlyZWN0aW9uID0gVFJBVkVSU0VEX0xBVEVSOwogICAgICB9IGVsc2UgewoJLy8gZm91bmQhCglmb3VuZCA9IHRydWU7CglicmVhazsKICAgICAgfQoKICAgICAgLy8gaWYgdHJhdmVyc2luZyB5aWVsZHMgbnVsbCBwb2ludGVyIGZvciBjaGlsZCBub2RlLCBtdXN0IGNyZWF0ZQogICAgICBpZiAoY3VySUQgPT0gMCkgewoJY3VySUQgPSBfY3JlYXRlTm9kZSh0cmVlKTsKCgkvLyB1cGRhdGUgYXBwcm9wcmlhdGUgcG9pbnRlcgoJaWYgKHJlY3Vyc2VEaXJlY3Rpb24gPT0gVFJBVkVSU0VEX0VBUkxJRVIpIHsKCSAgY3VyTm9kZS5lYXJsaWVyID0gY3VySUQ7Cgl9IGVsc2UgewoJICBjdXJOb2RlLmxhdGVyID0gY3VySUQ7Cgl9CgoJLy8gY3JlYXRpbmcgYSBuZXcgbm9kZSBtZWFucyB3ZSd2ZSBmb3VuZCB0aGUgcGxhY2UgdG8gcHV0IHRoZSBpbnRlcnZhbAoJZm91bmQgPSB0cnVlOwogICAgICB9CiAgICB9IHdoaWxlICghZm91bmQpOwoKICAgIHRyZWUubm9kZXNbY3VySURdLmludGVydmFscy5hZGQoYmVnaW4sIGVuZCwgaW50ZXJ2YWxJRCk7CiAgfQoKICAvKgogICAqIHJldHJpZXZhbAogICAqLwogIGZ1bmN0aW9uIGdldEludGVydmFsKFRyZWUgc3RvcmFnZSB0cmVlLCB1aW50IGludGVydmFsSUQpCiAgICBjb25zdGFudAogICAgaW50ZXJuYWwKICAgIHJldHVybnMgKHVpbnQgYmVnaW4sIHVpbnQgZW5kLCBieXRlczMyIGRhdGEpCiAgewogICAgcmVxdWlyZShpbnRlcnZhbElEID4gMCAmJiBpbnRlcnZhbElEIDw9IHRyZWUubnVtSW50ZXJ2YWxzKTsKCiAgICB2YXIgaW50ZXJ2YWwgPSB0cmVlLmludGVydmFsc1tpbnRlcnZhbElEXTsKICAgIHJldHVybiAoaW50ZXJ2YWwuYmVnaW4sIGludGVydmFsLmVuZCwgaW50ZXJ2YWwuZGF0YSk7CiAgfQoKICAvKgogICAqIHNlYXJjaGluZwogICAqLwogIGZ1bmN0aW9uIHNlYXJjaChUcmVlIHN0b3JhZ2UgdHJlZSwgdWludCBwb2ludCkKICAgIGNvbnN0YW50CiAgICBpbnRlcm5hbAogICAgcmV0dXJucyAodWludFtdIG1lbW9yeSBpbnRlcnZhbElEcykKICB7CiAgICAvLyBjYW4ndCBzZWFyY2ggZW1wdHkgdHJlZXMKICAgIHJlcXVpcmUodHJlZS5yb290Tm9kZSAhPSAweDApOwoKICAgIC8vIEhBQ0sgcmVwZWF0ZWRseSBtYWxsb2NzIG5ldyBhcnJheXMgb2YgbWF0Y2hpbmcgaW50ZXJ2YWwgSURzCiAgICBpbnRlcnZhbElEcyA9IG5ldyB1aW50W10oMCk7CiAgICB1aW50W10gbWVtb3J5IHRlbXBJRHM7CiAgICB1aW50W10gbWVtb3J5IG1hdGNoaW5nSURzOwogICAgdWludCBpOyAgLy8gZm9yIGxpc3QgY29weWluZyBsb29wcwoKICAgIC8qCiAgICAgKiBzZWFyY2ggdHJhdmVyc2FsCiAgICAgKgogICAgICogc3RhcnRpbmcgYXQgcm9vdCBub2RlCiAgICAgKi8KICAgIHVpbnQgY3VySUQgPSB0cmVlLnJvb3ROb2RlOwogICAgdWludDggc2VhcmNoTmV4dDsKICAgIGRvIHsKICAgICAgTm9kZSBzdG9yYWdlIGN1ck5vZGUgPSB0cmVlLm5vZGVzW2N1cklEXTsKCiAgICAgIC8qCiAgICAgICAqIHNlYXJjaCBjdXJyZW50IG5vZGUKICAgICAgICovCiAgICAgIChtYXRjaGluZ0lEcywgc2VhcmNoTmV4dCkgPSBjdXJOb2RlLmludGVydmFscy5tYXRjaGluZyhwb2ludCk7CgogICAgICAvKgogICAgICAgKiBhZGQgbWF0Y2hpbmcgaW50ZXJ2YWxzIHRvIHJlc3VsdHMgYXJyYXkKICAgICAgICoKICAgICAgICogYWxsb2NhdGUgdGVtcCBhcnJheSBhbmQgY29weSBpbiBib3RoIHByaW9yIGFuZCBuZXcgbWF0Y2hlcwogICAgICAgKi8KICAgICAgaWYgKG1hdGNoaW5nSURzLmxlbmd0aCA+IDApIHsKCXRlbXBJRHMgPSBuZXcgdWludFtdKGludGVydmFsSURzLmxlbmd0aCArIG1hdGNoaW5nSURzLmxlbmd0aCk7Cglmb3IgKGkgPSAwOyBpIDwgaW50ZXJ2YWxJRHMubGVuZ3RoOyBpKyspIHsKCSAgdGVtcElEc1tpXSA9IGludGVydmFsSURzW2ldOwoJfQoJZm9yIChpID0gMDsgaSA8IG1hdGNoaW5nSURzLmxlbmd0aDsgaSsrKSB7CgkgIHRlbXBJRHNbaSArIGludGVydmFsSURzLmxlbmd0aF0gPSBtYXRjaGluZ0lEc1tpXTsKCX0KCWludGVydmFsSURzID0gdGVtcElEczsKICAgICAgfQoKICAgICAgLyoKICAgICAgICogcmVjdXJzZSBhY2NvcmRpbmcgdG8gbm9kZSBzZWFyY2ggcmVzdWx0cwogICAgICAgKi8KICAgICAgaWYgKHNlYXJjaE5leHQgPT0gU0VBUkNIX0VBUkxJRVIpIHsKCWN1cklEID0gY3VyTm9kZS5lYXJsaWVyOwogICAgICB9IGVsc2UgaWYgKHNlYXJjaE5leHQgPT0gU0VBUkNIX0xBVEVSKSB7IC8vIFNFQVJDSF9MQVRFUgoJY3VySUQgPSBjdXJOb2RlLmxhdGVyOwogICAgICB9CiAgICB9IHdoaWxlIChzZWFyY2hOZXh0ICE9IFNFQVJDSF9ET05FICYmIGN1cklEICE9IDB4MCk7CiAgfQoKCiAgLyoKICAgKiBkYXRhIGNyZWF0ZSBoZWxwZXJzIGhlbHBlcnMKICAgKi8KICBmdW5jdGlvbiBfY3JlYXRlSW50ZXJ2YWwoVHJlZSBzdG9yYWdlIHRyZWUsIHVpbnQgYmVnaW4sIHVpbnQgZW5kLCBieXRlczMyIGRhdGEpCiAgICBpbnRlcm5hbAogICAgcmV0dXJucyAodWludCBpbnRlcnZhbElEKQogIHsKICAgIGludGVydmFsSUQgPSArK3RyZWUubnVtSW50ZXJ2YWxzOwoKICAgIHRyZWUuaW50ZXJ2YWxzW2ludGVydmFsSURdID0gSW50ZXJ2YWxMaWIuSW50ZXJ2YWwoewogICAgICBiZWdpbjogYmVnaW4sCiAgICAgIGVuZDogZW5kLAogICAgICBkYXRhOiBkYXRhCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIF9jcmVhdGVOb2RlKFRyZWUgc3RvcmFnZSB0cmVlKSByZXR1cm5zICh1aW50IG5vZGVJRCkgewogICAgbm9kZUlEID0gKyt0cmVlLm51bU5vZGVzOwogICAgdHJlZS5ub2Rlc1tub2RlSURdID0gTm9kZSh7CiAgICAgIGVhcmxpZXI6IDAsCiAgICAgIGxhdGVyOiAwLAogICAgICBpbnRlcnZhbHM6IExpc3RMaWIuY3JlYXRlTmV3KG5vZGVJRCkKICAgIH0pOwogIH0KfQoKbGlicmFyeSBJbnRlcnZhbExpYiB7CiAgc3RydWN0IEludGVydmFsIHsKICAgIHVpbnQgYmVnaW47CiAgICB1aW50IGVuZDsKICAgIGJ5dGVzMzIgZGF0YTsKICB9Cn0KCmxpYnJhcnkgR3JvdmVMaWIgewogICAgICAgIC8qCiAgICAgICAgICogIEluZGV4ZXMgZm9yIG9yZGVyZWQgZGF0YQogICAgICAgICAqCiAgICAgICAgICogIEFkZHJlc3M6IDB4N2MxZWIyMDdjMDdlN2FiMTNjZjI0NTU4NWJkMDNkMGZhNDc4ZDAzNAogICAgICAgICAqLwogICAgICAgIHN0cnVjdCBJbmRleCB7CiAgICAgICAgICAgICAgICBieXRlczMyIHJvb3Q7CiAgICAgICAgICAgICAgICBtYXBwaW5nIChieXRlczMyID0+IE5vZGUpIG5vZGVzOwogICAgICAgIH0KCiAgICAgICAgc3RydWN0IE5vZGUgewogICAgICAgICAgICAgICAgYnl0ZXMzMiBpZDsKICAgICAgICAgICAgICAgIGludCB2YWx1ZTsKICAgICAgICAgICAgICAgIGJ5dGVzMzIgcGFyZW50OwogICAgICAgICAgICAgICAgYnl0ZXMzMiBsZWZ0OwogICAgICAgICAgICAgICAgYnl0ZXMzMiByaWdodDsKICAgICAgICAgICAgICAgIHVpbnQgaGVpZ2h0OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbWF4KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICAgIGlmIChhID49IGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBiOwogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAgKiAgTm9kZSBnZXR0ZXJzCiAgICAgICAgICovCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgbm9kZS4KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSWQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgICAgICByZXR1cm4gaW5kZXgubm9kZXNbaWRdLmlkOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIHZhbHVlIGZvciB0aGUgbm9kZS4KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4KICAgICAgICBmdW5jdGlvbiBnZXROb2RlVmFsdWUoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoaW50KSB7CiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tpZF0udmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgaGVpZ2h0IG9mIHRoZSBub2RlLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLgogICAgICAgIGZ1bmN0aW9uIGdldE5vZGVIZWlnaHQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgICAgICByZXR1cm4gaW5kZXgubm9kZXNbaWRdLmhlaWdodDsKICAgICAgICB9CgogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSBwYXJlbnQgaWQgb2YgdGhlIG5vZGUuCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLgogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZVBhcmVudChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tpZF0ucGFyZW50OwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgUmV0cmlldmUgdGhlIGxlZnQgY2hpbGQgaWQgb2YgdGhlIG5vZGUuCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCB0aGUgbm9kZSBpcyBwYXJ0IG9mLgogICAgICAgIC8vLyBAcGFyYW0gaWQgVGhlIGlkIGZvciB0aGUgbm9kZSB0byBiZSBsb29rZWQgdXAuCiAgICAgICAgZnVuY3Rpb24gZ2V0Tm9kZUxlZnRDaGlsZChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tpZF0ubGVmdDsKICAgICAgICB9CgogICAgICAgIC8vLyBAZGV2IFJldHJpZXZlIHRoZSByaWdodCBjaGlsZCBpZCBvZiB0aGUgbm9kZS4KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4KICAgICAgICBmdW5jdGlvbiBnZXROb2RlUmlnaHRDaGlsZChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgIHJldHVybiBpbmRleC5ub2Rlc1tpZF0ucmlnaHQ7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgbm9kZSBpZCBvZiB0aGUgbmV4dCBub2RlIGluIHRoZSB0cmVlLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSBpZCBmb3IgdGhlIG5vZGUgdG8gYmUgbG9va2VkIHVwLgogICAgICAgIGZ1bmN0aW9uIGdldFByZXZpb3VzTm9kZShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2lkXTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5pZCA9PSAweDApIHsKICAgICAgICAgICAgICAgIC8vIFVua25vd24gbm9kZSwganVzdCByZXR1cm4gMHgwOwogICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTm9kZSBtZW1vcnkgY2hpbGQ7CgogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubGVmdCAhPSAweDApIHsKICAgICAgICAgICAgICAgIC8vIFRyYWNlIGxlZnQgdG8gbGF0ZXN0IGNoaWxkIGluIGxlZnQgdHJlZS4KICAgICAgICAgICAgICAgIGNoaWxkID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07CgogICAgICAgICAgICAgICAgd2hpbGUgKGNoaWxkLnJpZ2h0ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IGluZGV4Lm5vZGVzW2NoaWxkLnJpZ2h0XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZC5pZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnBhcmVudCAhPSAweDApIHsKICAgICAgICAgICAgICAgIC8vIE5vdyB3ZSB0cmFjZSBiYWNrIHVwIHRocm91Z2ggcGFyZW50IHJlbGF0aW9uc2hpcHMsIGxvb2tpbmcKICAgICAgICAgICAgICAgIC8vIGZvciBhIGxpbmsgd2hlcmUgdGhlIGNoaWxkIGlzIHRoZSByaWdodCBjaGlsZCBvZiBpdCdzCiAgICAgICAgICAgICAgICAvLyBwYXJlbnQuCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucGFyZW50XTsKICAgICAgICAgICAgICAgIGNoaWxkID0gY3VycmVudE5vZGU7CgogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LnJpZ2h0ID09IGNoaWxkLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQuaWQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LnBhcmVudCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNoaWxkID0gcGFyZW50OwogICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IGluZGV4Lm5vZGVzW3BhcmVudC5wYXJlbnRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBmaXJzdCBub2RlLCBhbmQgaGFzIG5vIHByZXZpb3VzIG5vZGUuCiAgICAgICAgICAgIHJldHVybiAweDA7CiAgICAgICAgfQoKICAgICAgICAvLy8gQGRldiBSZXRyaWV2ZSB0aGUgbm9kZSBpZCBvZiB0aGUgcHJldmlvdXMgbm9kZSBpbiB0aGUgdHJlZS4KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHRoZSBub2RlIGlzIHBhcnQgb2YuCiAgICAgICAgLy8vIEBwYXJhbSBpZCBUaGUgaWQgZm9yIHRoZSBub2RlIHRvIGJlIGxvb2tlZCB1cC4KICAgICAgICBmdW5jdGlvbiBnZXROZXh0Tm9kZShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2lkXTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5pZCA9PSAweDApIHsKICAgICAgICAgICAgICAgIC8vIFVua25vd24gbm9kZSwganVzdCByZXR1cm4gMHgwOwogICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTm9kZSBtZW1vcnkgY2hpbGQ7CgogICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucmlnaHQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAvLyBUcmFjZSByaWdodCB0byBlYXJsaWVzdCBjaGlsZCBpbiByaWdodCB0cmVlLgogICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07CgogICAgICAgICAgICAgICAgd2hpbGUgKGNoaWxkLmxlZnQgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIGNoaWxkID0gaW5kZXgubm9kZXNbY2hpbGQubGVmdF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQuaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5wYXJlbnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbm9kZSBpcyB0aGUgbGVmdCBjaGlsZCBvZiBpdCdzIHBhcmVudCwgdGhlbiB0aGUKICAgICAgICAgICAgICAgIC8vIHBhcmVudCBpcyB0aGUgbmV4dCBvbmUuCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucGFyZW50XTsKICAgICAgICAgICAgICAgIGNoaWxkID0gY3VycmVudE5vZGU7CgogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gY2hpbGQuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5pZDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucGFyZW50ID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBwYXJlbnQ7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gaW5kZXgubm9kZXNbcGFyZW50LnBhcmVudF07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gTm93IHdlIG5lZWQgdG8gdHJhY2UgYWxsIHRoZSB3YXkgdXAgY2hlY2tpbmcgdG8gc2VlIGlmIGFueSBwYXJlbnQgaXMgdGhlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZpbmFsIG5vZGUuCiAgICAgICAgICAgIHJldHVybiAweDA7CiAgICAgICAgfQoKCiAgICAgICAgLy8vIEBkZXYgVXBkYXRlcyBvciBJbnNlcnRzIHRoZSBpZCBpbnRvIHRoZSBpbmRleCBhdCBpdHMgYXBwcm9wcmlhdGUgbG9jYXRpb24gYmFzZWQgb24gdGhlIHZhbHVlIHByb3ZpZGVkLgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgdGhlIG5vZGUgaXMgcGFydCBvZi4KICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRoZSBpbmRleCBub2RlIHdpbGwgcmVwcmVzZW50LgogICAgICAgIC8vLyBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIG9mIHRoZSBkYXRhIGVsZW1lbnQgdGhhdCByZXByZXNlbnRzIGl0J3MgdG90YWwgb3JkZXJpbmcgd2l0aCByZXNwZWN0IHRvIG90aGVyIGVsZW1lbnRlcy4KICAgICAgICBmdW5jdGlvbiBpbnNlcnQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCwgaW50IHZhbHVlKSBwdWJsaWMgewogICAgICAgICAgICAgICAgaWYgKGluZGV4Lm5vZGVzW2lkXS5pZCA9PSBpZCkgewogICAgICAgICAgICAgICAgICAgIC8vIEEgbm9kZSB3aXRoIHRoaXMgaWQgYWxyZWFkeSBleGlzdHMuICBJZiB0aGUgdmFsdWUgaXMKICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2FtZSwgdGhlbiBqdXN0IHJldHVybiBlYXJseSwgb3RoZXJ3aXNlLCByZW1vdmUgaXQKICAgICAgICAgICAgICAgICAgICAvLyBhbmQgcmVpbnNlcnQgaXQuCiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4Lm5vZGVzW2lkXS52YWx1ZSA9PSB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlbW92ZShpbmRleCwgaWQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJ5dGVzMzIgcHJldmlvdXNOb2RlSWQgPSAweDA7CgogICAgICAgICAgICAgICAgaWYgKGluZGV4LnJvb3QgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXgucm9vdCA9IGlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbaW5kZXgucm9vdF07CgogICAgICAgICAgICAgICAgLy8gRG8gaW5zZXJ0aW9uCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5pZCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIG5ldyB1bnBvcHVsYXRlZCBub2RlLgogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5pZCA9IGlkOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5wYXJlbnQgPSBwcmV2aW91c05vZGVJZDsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHByZXZpb3VzIG5vZGUgaWQuCiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNOb2RlSWQgPSBjdXJyZW50Tm9kZS5pZDsKCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG5ldyBub2RlIGJlbG9uZ3MgaW4gdGhlIHJpZ2h0IHN1YnRyZWUKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPj0gY3VycmVudE5vZGUudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnJpZ2h0ID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUucmlnaHQgPSBpZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgbmV3IG5vZGUgYmVsb25ncyBpbiB0aGUgbGVmdCBzdWJ0cmVlLgogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5sZWZ0ID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS5sZWZ0ID0gaWQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gUmViYWxhbmNlIHRoZSB0cmVlCiAgICAgICAgICAgICAgICBfcmViYWxhbmNlVHJlZShpbmRleCwgY3VycmVudE5vZGUuaWQpOwogICAgICAgIH0KCiAgICAgICAgLy8vIEBkZXYgQ2hlY2tzIHdoZXRoZXIgYSBub2RlIGZvciB0aGUgZ2l2ZW4gdW5pcXVlIGlkZW50aWZpZXIgZXhpc3RzIHdpdGhpbiB0aGUgZ2l2ZW4gaW5kZXguCiAgICAgICAgLy8vIEBwYXJhbSBpbmRleCBUaGUgaW5kZXggdGhhdCBzaG91bGQgYmUgc2VhcmNoZWQKICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRvIGNoZWNrIGZvci4KICAgICAgICBmdW5jdGlvbiBleGlzdHMoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgICByZXR1cm4gKGluZGV4Lm5vZGVzW2lkXS5oZWlnaHQgPiAwKTsKICAgICAgICB9CgogICAgICAgIC8vLyBAZGV2IFJlbW92ZSB0aGUgbm9kZSBmb3IgdGhlIGdpdmVuIHVuaXF1ZSBpZGVudGlmaWVyIGZyb20gdGhlIGluZGV4LgogICAgICAgIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IHRoYXQgc2hvdWxkIGJlIHJlbW92ZWQKICAgICAgICAvLy8gQHBhcmFtIGlkIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBlbGVtZW50IHRvIHJlbW92ZS4KICAgICAgICBmdW5jdGlvbiByZW1vdmUoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgcHVibGljIHsKICAgICAgICAgICAgYnl0ZXMzMiByZWJhbGFuY2VPcmlnaW47CgogICAgICAgICAgICBOb2RlIHN0b3JhZ2Ugbm9kZVRvRGVsZXRlID0gaW5kZXgubm9kZXNbaWRdOwoKICAgICAgICAgICAgaWYgKG5vZGVUb0RlbGV0ZS5pZCAhPSBpZCkgewogICAgICAgICAgICAgICAgLy8gVGhlIGlkIGRvZXMgbm90IGV4aXN0IGluIHRoZSB0cmVlLgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobm9kZVRvRGVsZXRlLmxlZnQgIT0gMHgwIHx8IG5vZGVUb0RlbGV0ZS5yaWdodCAhPSAweDApIHsKICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBub3QgYSBsZWFmIG5vZGUgYW5kIHRodXMgbXVzdCByZXBsYWNlIGl0c2VsZiBpbgogICAgICAgICAgICAgICAgLy8gaXQncyB0cmVlIGJ5IGVpdGhlciB0aGUgcHJldmlvdXMgb3IgbmV4dCBub2RlLgogICAgICAgICAgICAgICAgaWYgKG5vZGVUb0RlbGV0ZS5sZWZ0ICE9IDB4MCkgewogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBndWFyYW50ZWVkIHRvIG5vdCBoYXZlIGEgcmlnaHQgY2hpbGQuCiAgICAgICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIHJlcGxhY2VtZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2dldFByZXZpb3VzTm9kZShpbmRleCwgbm9kZVRvRGVsZXRlLmlkKV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZ3VhcmFudGVlZCB0byBub3QgaGF2ZSBhIGxlZnQgY2hpbGQuCiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZW1lbnROb2RlID0gaW5kZXgubm9kZXNbZ2V0TmV4dE5vZGUoaW5kZXgsIG5vZGVUb0RlbGV0ZS5pZCldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gVGhlIHJlcGxhY2VtZW50Tm9kZSBpcyBndWFyYW50ZWVkIHRvIGhhdmUgYSBwYXJlbnQuCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgcGFyZW50ID0gaW5kZXgubm9kZXNbcmVwbGFjZW1lbnROb2RlLnBhcmVudF07CgogICAgICAgICAgICAgICAgLy8gS2VlcCBub3RlIG9mIHRoZSBsb2NhdGlvbiB0aGF0IG91ciB0cmVlIHJlYmFsYW5jaW5nIHNob3VsZAogICAgICAgICAgICAgICAgLy8gc3RhcnQgYXQuCiAgICAgICAgICAgICAgICByZWJhbGFuY2VPcmlnaW4gPSByZXBsYWNlbWVudE5vZGUuaWQ7CgogICAgICAgICAgICAgICAgLy8gSm9pbiB0aGUgcGFyZW50IG9mIHRoZSByZXBsYWNlbWVudCBub2RlIHdpdGggYW55IHN1YnRyZWUgb2YKICAgICAgICAgICAgICAgIC8vIHRoZSByZXBsYWNlbWVudCBub2RlLiAgV2UgY2FuIGd1YXJhbnRlZSB0aGF0IHRoZSByZXBsYWNlbWVudAogICAgICAgICAgICAgICAgLy8gbm9kZSBoYXMgYXQgbW9zdCBvbmUgc3VidHJlZSBiZWNhdXNlIG9mIGhvdyBnZXROZXh0Tm9kZSBhbmQKICAgICAgICAgICAgICAgIC8vIGdldFByZXZpb3VzTm9kZSBhcmUgdXNlZC4KICAgICAgICAgICAgICAgIGlmIChwYXJlbnQubGVmdCA9PSByZXBsYWNlbWVudE5vZGUuaWQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IHJlcGxhY2VtZW50Tm9kZS5yaWdodDsKICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnROb2RlLnJpZ2h0ICE9IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgY2hpbGQgPSBpbmRleC5ub2Rlc1tyZXBsYWNlbWVudE5vZGUucmlnaHRdOwogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSBwYXJlbnQuaWQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSByZXBsYWNlbWVudE5vZGUuaWQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmlnaHQgPSByZXBsYWNlbWVudE5vZGUubGVmdDsKICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZW1lbnROb2RlLmxlZnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gaW5kZXgubm9kZXNbcmVwbGFjZW1lbnROb2RlLmxlZnRdOwogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5wYXJlbnQgPSBwYXJlbnQuaWQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIE5vdyB3ZSByZXBsYWNlIHRoZSBub2RlVG9EZWxldGUgd2l0aCB0aGUgcmVwbGFjZW1lbnROb2RlLgogICAgICAgICAgICAgICAgLy8gVGhpcyBpbmNsdWRlcyBwYXJlbnQvY2hpbGQgcmVsYXRpb25zaGlwcyBmb3IgYWxsIG9mIHRoZQogICAgICAgICAgICAgICAgLy8gcGFyZW50LCB0aGUgbGVmdCBjaGlsZCwgYW5kIHRoZSByaWdodCBjaGlsZC4KICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZS5wYXJlbnQgPSBub2RlVG9EZWxldGUucGFyZW50OwogICAgICAgICAgICAgICAgaWYgKG5vZGVUb0RlbGV0ZS5wYXJlbnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gaW5kZXgubm9kZXNbbm9kZVRvRGVsZXRlLnBhcmVudF07CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ID09IG5vZGVUb0RlbGV0ZS5pZCkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IHJlcGxhY2VtZW50Tm9kZS5pZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBub2RlVG9EZWxldGUuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJpZ2h0ID0gcmVwbGFjZW1lbnROb2RlLmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBub2RlIHdlIGFyZSBkZWxldGluZyBpcyB0aGUgcm9vdCBub2RlIHVwZGF0ZSB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBpbmRleCByb290IG5vZGUgcG9pbnRlci4KICAgICAgICAgICAgICAgICAgICBpbmRleC5yb290ID0gcmVwbGFjZW1lbnROb2RlLmlkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZS5sZWZ0ID0gbm9kZVRvRGVsZXRlLmxlZnQ7CiAgICAgICAgICAgICAgICBpZiAobm9kZVRvRGVsZXRlLmxlZnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUubGVmdF07CiAgICAgICAgICAgICAgICAgICAgY2hpbGQucGFyZW50ID0gcmVwbGFjZW1lbnROb2RlLmlkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50Tm9kZS5yaWdodCA9IG5vZGVUb0RlbGV0ZS5yaWdodDsKICAgICAgICAgICAgICAgIGlmIChub2RlVG9EZWxldGUucmlnaHQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBpbmRleC5ub2Rlc1tub2RlVG9EZWxldGUucmlnaHRdOwogICAgICAgICAgICAgICAgICAgIGNoaWxkLnBhcmVudCA9IHJlcGxhY2VtZW50Tm9kZS5pZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChub2RlVG9EZWxldGUucGFyZW50ICE9IDB4MCkgewogICAgICAgICAgICAgICAgLy8gVGhlIG5vZGUgYmVpbmcgZGVsZXRlZCBpcyBhIGxlYWYgbm9kZSBzbyB3ZSBvbmx5IGVyYXNlIGl0J3MKICAgICAgICAgICAgICAgIC8vIHBhcmVudCBsaW5rYWdlLgogICAgICAgICAgICAgICAgcGFyZW50ID0gaW5kZXgubm9kZXNbbm9kZVRvRGVsZXRlLnBhcmVudF07CgogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ID09IG5vZGVUb0RlbGV0ZS5pZCkgewogICAgICAgICAgICAgICAgICAgIHBhcmVudC5sZWZ0ID0gMHgwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBub2RlVG9EZWxldGUuaWQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmlnaHQgPSAweDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8ga2VlcCBub3RlIG9mIHdoZXJlIHRoZSByZWJhbGFuY2luZyBzaG91bGQgYmVnaW4uCiAgICAgICAgICAgICAgICByZWJhbGFuY2VPcmlnaW4gPSBwYXJlbnQuaWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGJvdGggYSBsZWFmIG5vZGUgYW5kIHRoZSByb290IG5vZGUsIHNvIHdlIG5lZWQgdG8KICAgICAgICAgICAgICAgIC8vIHVuc2V0IHRoZSByb290IG5vZGUgcG9pbnRlci4KICAgICAgICAgICAgICAgIGluZGV4LnJvb3QgPSAweDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE5vdyB3ZSB6ZXJvIG91dCBhbGwgb2YgdGhlIGZpZWxkcyBvbiB0aGUgbm9kZVRvRGVsZXRlLgogICAgICAgICAgICBub2RlVG9EZWxldGUuaWQgPSAweDA7CiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS52YWx1ZSA9IDA7CiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5wYXJlbnQgPSAweDA7CiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5sZWZ0ID0gMHgwOwogICAgICAgICAgICBub2RlVG9EZWxldGUucmlnaHQgPSAweDA7CiAgICAgICAgICAgIG5vZGVUb0RlbGV0ZS5oZWlnaHQgPSAwOwoKICAgICAgICAgICAgLy8gV2FsayBiYWNrIHVwIHRoZSB0cmVlIHJlYmFsYW5jaW5nCiAgICAgICAgICAgIGlmIChyZWJhbGFuY2VPcmlnaW4gIT0gMHgwKSB7CiAgICAgICAgICAgICAgICBfcmViYWxhbmNlVHJlZShpbmRleCwgcmViYWxhbmNlT3JpZ2luKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYnl0ZXMyIGNvbnN0YW50IEdUID0gIj4iOwogICAgICAgIGJ5dGVzMiBjb25zdGFudCBMVCA9ICI8IjsKICAgICAgICBieXRlczIgY29uc3RhbnQgR1RFID0gIj49IjsKICAgICAgICBieXRlczIgY29uc3RhbnQgTFRFID0gIjw9IjsKICAgICAgICBieXRlczIgY29uc3RhbnQgRVEgPSAiPT0iOwoKICAgICAgICBmdW5jdGlvbiBfY29tcGFyZShpbnQgbGVmdCwgYnl0ZXMyIG9wZXJhdG9yLCBpbnQgcmlnaHQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgICAgIG9wZXJhdG9yID09IEdUIHx8IG9wZXJhdG9yID09IExUIHx8IG9wZXJhdG9yID09IEdURSB8fAogICAgICAgICAgICAgICAgb3BlcmF0b3IgPT0gTFRFIHx8IG9wZXJhdG9yID09IEVRCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gR1QpIHsKICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA+IHJpZ2h0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gTFQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA8IHJpZ2h0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3BlcmF0b3IgPT0gR1RFKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKGxlZnQgPj0gcmlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PSBMVEUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAobGVmdCA8PSByaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wZXJhdG9yID09IEVRKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKGxlZnQgPT0gcmlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfZ2V0TWF4aW11bShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2lkXTsKCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLnJpZ2h0XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF9nZXRNaW5pbXVtKEluZGV4IHN0b3JhZ2UgaW5kZXgsIGJ5dGVzMzIgaWQpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbaWRdOwoKICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS52YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5sZWZ0XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvKiogQGRldiBRdWVyeSB0aGUgaW5kZXggZm9yIHRoZSBlZGdlLW1vc3Qgbm9kZSB0aGF0IHNhdGlzZmllcyB0aGUKICAgICAgICAgKiAgZ2l2ZW4gcXVlcnkuICBGb3IgPiwgPj0sIGFuZCA9PSwgdGhpcyB3aWxsIGJlIHRoZSBsZWZ0LW1vc3Qgbm9kZQogICAgICAgICAqICB0aGF0IHNhdGlzZmllcyB0aGUgY29tcGFyaXNvbi4gIEZvciA8IGFuZCA8PSB0aGlzIHdpbGwgYmUgdGhlCiAgICAgICAgICogIHJpZ2h0LW1vc3Qgbm9kZSB0aGF0IHNhdGlzZmllcyB0aGUgY29tcGFyaXNvbi4KICAgICAgICAgKi8KICAgICAgICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCB0aGF0IHNob3VsZCBiZSBxdWVyaWVkCiAgICAgICAgLyoqIEBwYXJhbSBvcGVyYXRvciBPbmUgb2YgJz4nLCAnPj0nLCAnPCcsICc8PScsICc9PScgdG8gc3BlY2lmeSB3aGF0CiAgICAgICAgICogIHR5cGUgb2YgY29tcGFyaXNvbiBvcGVyYXRvciBzaG91bGQgYmUgdXNlZC4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBxdWVyeShJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczIgb3BlcmF0b3IsIGludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIgcm9vdE5vZGVJZCA9IGluZGV4LnJvb3Q7CgogICAgICAgICAgICAgICAgaWYgKHJvb3ROb2RlSWQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRW1wdHkgdHJlZS4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMHgwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW3Jvb3ROb2RlSWRdOwoKICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jb21wYXJlKGN1cnJlbnROb2RlLnZhbHVlLCBvcGVyYXRvciwgdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgZm91bmQgYSBtYXRjaCBidXQgaXQgbWlnaHQgbm90IGJlIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyAqY29ycmVjdCogbWF0Y2guCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0b3IgPT0gTFQpIHx8IChvcGVyYXRvciA9PSBMVEUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGtlZXAgdHJhdmVyc2luZyByaWdodCB1bnRpbCB0aGlzIGlzIG5vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb25nZXIgdHJ1ZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGUuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2NvbXBhcmUoX2dldE1pbmltdW0oaW5kZXgsIGN1cnJlbnROb2RlLnJpZ2h0KSwgb3BlcmF0b3IsIHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBzdGlsbCBub2RlcyB0byB0aGUgcmlnaHQgdGhhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hdGNoLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucmlnaHRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLmlkOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9wZXJhdG9yID09IEdUKSB8fCAob3BlcmF0b3IgPT0gR1RFKSB8fCAob3BlcmF0b3IgPT0gRVEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGtlZXAgdHJhdmVyc2luZyBsZWZ0IHVudGlsIHRoaXMgaXMgbm8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvbmdlciB0cnVlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmxlZnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnROb2RlLmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9jb21wYXJlKF9nZXRNYXhpbXVtKGluZGV4LCBjdXJyZW50Tm9kZS5sZWZ0KSwgb3BlcmF0b3IsIHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUubGVmdF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE5vZGUuaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0b3IgPT0gTFQpIHx8IChvcGVyYXRvciA9PSBMVEUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5sZWZ0ID09IDB4MCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgYXJlIG5vIG5vZGVzIHRoYXQgYXJlIGxlc3MgdGhhbiB0aGUgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHJldHVybiBudWxsLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2N1cnJlbnROb2RlLmxlZnRdOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgob3BlcmF0b3IgPT0gR1QpIHx8IChvcGVyYXRvciA9PSBHVEUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5yaWdodCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBubyBub2RlcyB0aGF0IGFyZSBncmVhdGVyIHRoYW4gdGhlIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzbyByZXR1cm4gbnVsbC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAweDA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5yaWdodF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKG9wZXJhdG9yID09IEVRKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS52YWx1ZSA8IHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUucmlnaHQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDB4MDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucmlnaHRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS52YWx1ZSA+IHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudE5vZGUubGVmdCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMHgwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBpbmRleC5ub2Rlc1tjdXJyZW50Tm9kZS5sZWZ0XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX3JlYmFsYW5jZVRyZWUoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgaW50ZXJuYWwgewogICAgICAgICAgICAvLyBUcmFjZSBiYWNrIHVwIHJlYmFsYW5jaW5nIHRoZSB0cmVlIGFuZCB1cGRhdGluZyBoZWlnaHRzIGFzCiAgICAgICAgICAgIC8vIG5lZWRlZC4uCiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBjdXJyZW50Tm9kZSA9IGluZGV4Lm5vZGVzW2lkXTsKCiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICBpbnQgYmFsYW5jZUZhY3RvciA9IF9nZXRCYWxhbmNlRmFjdG9yKGluZGV4LCBjdXJyZW50Tm9kZS5pZCk7CgogICAgICAgICAgICAgICAgaWYgKGJhbGFuY2VGYWN0b3IgPT0gMikgewogICAgICAgICAgICAgICAgICAgIC8vIFJpZ2h0IHJvdGF0aW9uICh0cmVlIGlzIGhlYXZ5IG9uIHRoZSBsZWZ0KQogICAgICAgICAgICAgICAgICAgIGlmIChfZ2V0QmFsYW5jZUZhY3RvcihpbmRleCwgY3VycmVudE5vZGUubGVmdCkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHN1YnRyZWUgaXMgbGVhbmluZyByaWdodCBzbyBpdCBuZWVkIHRvIGJlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJvdGF0ZWQgbGVmdCBiZWZvcmUgdGhlIGN1cnJlbnQgbm9kZSBpcyByb3RhdGVkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJpZ2h0LgogICAgICAgICAgICAgICAgICAgICAgICBfcm90YXRlTGVmdChpbmRleCwgY3VycmVudE5vZGUubGVmdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9yb3RhdGVSaWdodChpbmRleCwgY3VycmVudE5vZGUuaWQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlRmFjdG9yID09IC0yKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTGVmdCByb3RhdGlvbiAodHJlZSBpcyBoZWF2eSBvbiB0aGUgcmlnaHQpCiAgICAgICAgICAgICAgICAgICAgaWYgKF9nZXRCYWxhbmNlRmFjdG9yKGluZGV4LCBjdXJyZW50Tm9kZS5yaWdodCkgPT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgc3VidHJlZSBpcyBsZWFuaW5nIGxlZnQgc28gaXQgbmVlZCB0byBiZQogICAgICAgICAgICAgICAgICAgICAgICAvLyByb3RhdGVkIHJpZ2h0IGJlZm9yZSB0aGUgY3VycmVudCBub2RlIGlzIHJvdGF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGVmdC4KICAgICAgICAgICAgICAgICAgICAgICAgX3JvdGF0ZVJpZ2h0KGluZGV4LCBjdXJyZW50Tm9kZS5yaWdodCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9yb3RhdGVMZWZ0KGluZGV4LCBjdXJyZW50Tm9kZS5pZCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCgtMSA8PSBiYWxhbmNlRmFjdG9yKSAmJiAoYmFsYW5jZUZhY3RvciA8PSAxKSkgewogICAgICAgICAgICAgICAgICAgIF91cGRhdGVOb2RlSGVpZ2h0KGluZGV4LCBjdXJyZW50Tm9kZS5pZCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLnBhcmVudCA9PSAweDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBSZWFjaGVkIHRoZSByb290IHdoaWNoIG1heSBiZSBuZXcgZHVlIHRvIHRyZWUKICAgICAgICAgICAgICAgICAgICAvLyByb3RhdGlvbiwgc28gc2V0IGl0IGFzIHRoZSByb290IGFuZCB0aGVuIGJyZWFrLgogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gaW5kZXgubm9kZXNbY3VycmVudE5vZGUucGFyZW50XTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX2dldEJhbGFuY2VGYWN0b3IoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2Ugbm9kZSA9IGluZGV4Lm5vZGVzW2lkXTsKCiAgICAgICAgICAgICAgICByZXR1cm4gaW50KGluZGV4Lm5vZGVzW25vZGUubGVmdF0uaGVpZ2h0KSAtIGludChpbmRleC5ub2Rlc1tub2RlLnJpZ2h0XS5oZWlnaHQpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX3VwZGF0ZU5vZGVIZWlnaHQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgaW50ZXJuYWwgewogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIG5vZGUgPSBpbmRleC5ub2Rlc1tpZF07CgogICAgICAgICAgICAgICAgbm9kZS5oZWlnaHQgPSBtYXgoaW5kZXgubm9kZXNbbm9kZS5sZWZ0XS5oZWlnaHQsIGluZGV4Lm5vZGVzW25vZGUucmlnaHRdLmhlaWdodCkgKyAxOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gX3JvdGF0ZUxlZnQoSW5kZXggc3RvcmFnZSBpbmRleCwgYnl0ZXMzMiBpZCkgaW50ZXJuYWwgewogICAgICAgICAgICBOb2RlIHN0b3JhZ2Ugb3JpZ2luYWxSb290ID0gaW5kZXgubm9kZXNbaWRdOwoKICAgICAgICAgICAgLy8gQ2Fubm90IHJvdGF0ZSBsZWZ0IGlmIHRoZXJlIGlzIG5vIHJpZ2h0IG9yaWdpbmFsUm9vdCB0byByb3RhdGUgaW50bwogICAgICAgICAgICAvLyBwbGFjZS4KICAgICAgICAgICAgYXNzZXJ0KG9yaWdpbmFsUm9vdC5yaWdodCAhPSAweDApOwoKICAgICAgICAgICAgLy8gVGhlIHJpZ2h0IGNoaWxkIGlzIHRoZSBuZXcgcm9vdCwgc28gaXQgZ2V0cyB0aGUgb3JpZ2luYWwKICAgICAgICAgICAgLy8gYG9yaWdpbmFsUm9vdC5wYXJlbnRgIGFzIGl0J3MgcGFyZW50LgogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgbmV3Um9vdCA9IGluZGV4Lm5vZGVzW29yaWdpbmFsUm9vdC5yaWdodF07CiAgICAgICAgICAgIG5ld1Jvb3QucGFyZW50ID0gb3JpZ2luYWxSb290LnBhcmVudDsKCiAgICAgICAgICAgIC8vIFRoZSBvcmlnaW5hbCByb290IG5lZWRzIHRvIGhhdmUgaXQncyByaWdodCBjaGlsZCBudWxsZWQgb3V0LgogICAgICAgICAgICBvcmlnaW5hbFJvb3QucmlnaHQgPSAweDA7CgogICAgICAgICAgICBpZiAob3JpZ2luYWxSb290LnBhcmVudCAhPSAweDApIHsKICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGEgcGFyZW50IG5vZGUsIGl0IG5lZWRzIHRvIG5vdyBwb2ludCBkb3dud2FyZCBhdAogICAgICAgICAgICAgICAgLy8gdGhlIG5ld1Jvb3Qgd2hpY2ggaXMgcm90YXRpbmcgaW50byB0aGUgcGxhY2Ugd2hlcmUgYG5vZGVgIHdhcy4KICAgICAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBwYXJlbnQgPSBpbmRleC5ub2Rlc1tvcmlnaW5hbFJvb3QucGFyZW50XTsKCiAgICAgICAgICAgICAgICAvLyBmaWd1cmUgb3V0IGlmIHdlJ3JlIGEgbGVmdCBvciByaWdodCBjaGlsZCBhbmQgaGF2ZSB0aGUKICAgICAgICAgICAgICAgIC8vIHBhcmVudCBwb2ludCB0byB0aGUgbmV3IG5vZGUuCiAgICAgICAgICAgICAgICBpZiAocGFyZW50LmxlZnQgPT0gb3JpZ2luYWxSb290LmlkKSB7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50LmxlZnQgPSBuZXdSb290LmlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhcmVudC5yaWdodCA9PSBvcmlnaW5hbFJvb3QuaWQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmlnaHQgPSBuZXdSb290LmlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgaWYgKG5ld1Jvb3QubGVmdCAhPSAwKSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV3IHJvb3QgaGFkIGEgbGVmdCBjaGlsZCwgdGhhdCBtb3ZlcyB0byBiZSB0aGUKICAgICAgICAgICAgICAgIC8vIG5ldyByaWdodCBjaGlsZCBvZiB0aGUgb3JpZ2luYWwgcm9vdCBub2RlCiAgICAgICAgICAgICAgICBOb2RlIHN0b3JhZ2UgbGVmdENoaWxkID0gaW5kZXgubm9kZXNbbmV3Um9vdC5sZWZ0XTsKICAgICAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5yaWdodCA9IGxlZnRDaGlsZC5pZDsKICAgICAgICAgICAgICAgIGxlZnRDaGlsZC5wYXJlbnQgPSBvcmlnaW5hbFJvb3QuaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbmV3Um9vdCdzIGxlZnQgbm9kZSB0byBwb2ludCBhdCB0aGUgb3JpZ2luYWwgbm9kZS4KICAgICAgICAgICAgb3JpZ2luYWxSb290LnBhcmVudCA9IG5ld1Jvb3QuaWQ7CiAgICAgICAgICAgIG5ld1Jvb3QubGVmdCA9IG9yaWdpbmFsUm9vdC5pZDsKCiAgICAgICAgICAgIGlmIChuZXdSb290LnBhcmVudCA9PSAweDApIHsKICAgICAgICAgICAgICAgIGluZGV4LnJvb3QgPSBuZXdSb290LmlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBUT0RPOiBhcmUgYm90aCBvZiB0aGVzZSB1cGRhdGVzIG5lY2Vzc2FyeT8KICAgICAgICAgICAgX3VwZGF0ZU5vZGVIZWlnaHQoaW5kZXgsIG9yaWdpbmFsUm9vdC5pZCk7CiAgICAgICAgICAgIF91cGRhdGVOb2RlSGVpZ2h0KGluZGV4LCBuZXdSb290LmlkKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF9yb3RhdGVSaWdodChJbmRleCBzdG9yYWdlIGluZGV4LCBieXRlczMyIGlkKSBpbnRlcm5hbCB7CiAgICAgICAgICAgIE5vZGUgc3RvcmFnZSBvcmlnaW5hbFJvb3QgPSBpbmRleC5ub2Rlc1tpZF07CgogICAgICAgICAgICAvLyBDYW5ub3Qgcm90YXRlIHJpZ2h0IGlmIHRoZXJlIGlzIG5vIGxlZnQgbm9kZSB0byByb3RhdGUgaW50bwogICAgICAgICAgICAvLyBwbGFjZS4KICAgICAgICAgICAgYXNzZXJ0KG9yaWdpbmFsUm9vdC5sZWZ0ICE9IDB4MCk7CgogICAgICAgICAgICAvLyBUaGUgbGVmdCBjaGlsZCBpcyB0YWtpbmcgdGhlIHBsYWNlIG9mIG5vZGUsIHNvIHdlIHVwZGF0ZSBpdCdzCiAgICAgICAgICAgIC8vIHBhcmVudCB0byBiZSB0aGUgb3JpZ2luYWwgcGFyZW50IG9mIHRoZSBub2RlLgogICAgICAgICAgICBOb2RlIHN0b3JhZ2UgbmV3Um9vdCA9IGluZGV4Lm5vZGVzW29yaWdpbmFsUm9vdC5sZWZ0XTsKICAgICAgICAgICAgbmV3Um9vdC5wYXJlbnQgPSBvcmlnaW5hbFJvb3QucGFyZW50OwoKICAgICAgICAgICAgLy8gTnVsbCBvdXQgdGhlIG9yaWdpbmFsUm9vdC5sZWZ0CiAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5sZWZ0ID0gMHgwOwoKICAgICAgICAgICAgaWYgKG9yaWdpbmFsUm9vdC5wYXJlbnQgIT0gMHgwKSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbm9kZSBoYXMgYSBwYXJlbnQsIHVwZGF0ZSB0aGUgY29ycmVjdCBjaGlsZCB0byBwb2ludAogICAgICAgICAgICAgICAgLy8gYXQgdGhlIG5ld1Jvb3Qgbm93LgogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIHBhcmVudCA9IGluZGV4Lm5vZGVzW29yaWdpbmFsUm9vdC5wYXJlbnRdOwoKICAgICAgICAgICAgICAgIGlmIChwYXJlbnQubGVmdCA9PSBvcmlnaW5hbFJvb3QuaWQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQubGVmdCA9IG5ld1Jvb3QuaWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocGFyZW50LnJpZ2h0ID09IG9yaWdpbmFsUm9vdC5pZCkgewogICAgICAgICAgICAgICAgICAgIHBhcmVudC5yaWdodCA9IG5ld1Jvb3QuaWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChuZXdSb290LnJpZ2h0ICE9IDB4MCkgewogICAgICAgICAgICAgICAgTm9kZSBzdG9yYWdlIHJpZ2h0Q2hpbGQgPSBpbmRleC5ub2Rlc1tuZXdSb290LnJpZ2h0XTsKICAgICAgICAgICAgICAgIG9yaWdpbmFsUm9vdC5sZWZ0ID0gbmV3Um9vdC5yaWdodDsKICAgICAgICAgICAgICAgIHJpZ2h0Q2hpbGQucGFyZW50ID0gb3JpZ2luYWxSb290LmlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBVcGRhdGUgdGhlIG5ldyByb290J3MgcmlnaHQgbm9kZSB0byBwb2ludCB0byB0aGUgb3JpZ2luYWwgbm9kZS4KICAgICAgICAgICAgb3JpZ2luYWxSb290LnBhcmVudCA9IG5ld1Jvb3QuaWQ7CiAgICAgICAgICAgIG5ld1Jvb3QucmlnaHQgPSBvcmlnaW5hbFJvb3QuaWQ7CgogICAgICAgICAgICBpZiAobmV3Um9vdC5wYXJlbnQgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICBpbmRleC5yb290ID0gbmV3Um9vdC5pZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUmVjb21wdXRlIGhlaWdodHMuCiAgICAgICAgICAgIF91cGRhdGVOb2RlSGVpZ2h0KGluZGV4LCBvcmlnaW5hbFJvb3QuaWQpOwogICAgICAgICAgICBfdXBkYXRlTm9kZUhlaWdodChpbmRleCwgbmV3Um9vdC5pZCk7CiAgICAgICAgfQp9CgpsaWJyYXJ5IExpc3RMaWIgewogIHVpbnQ4IGNvbnN0YW50IFNFQVJDSF9ET05FID0gMHgwMDsKICB1aW50OCBjb25zdGFudCBTRUFSQ0hfRUFSTElFUiA9IDB4MDE7CiAgdWludDggY29uc3RhbnQgU0VBUkNIX0xBVEVSID0gMHgxMDsKCiAgdXNpbmcgR3JvdmVMaWIgZm9yIEdyb3ZlTGliLkluZGV4OwogIHVzaW5nIEludGVydmFsTGliIGZvciBJbnRlcnZhbExpYi5JbnRlcnZhbDsKCiAgc3RydWN0IExpc3QgewogICAgdWludCBsZW5ndGg7CiAgICB1aW50IGNlbnRlcjsKCiAgICAvLyBtYXBzIGl0ZW0gSUQgdG8gaXRlbXMKICAgIG1hcHBpbmcgKHVpbnQgPT4gSW50ZXJ2YWxMaWIuSW50ZXJ2YWwpIGl0ZW1zOwoKICAgIEdyb3ZlTGliLkluZGV4IGJlZ2luSW5kZXg7CiAgICBHcm92ZUxpYi5JbmRleCBlbmRJbmRleDsKICAgIGJ5dGVzMzIgbG93ZXN0QmVnaW47CiAgICBieXRlczMyIGhpZ2hlc3RFbmQ7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVOZXcoKQogICAgaW50ZXJuYWwKICAgIHJldHVybnMgKExpc3QpCiAgewogICAgcmV0dXJuIGNyZWF0ZU5ldyhibG9jay5udW1iZXIpOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlTmV3KHVpbnQgaWQpCiAgICBpbnRlcm5hbAogICAgcmV0dXJucyAoTGlzdCkKICB7CiAgICByZXR1cm4gTGlzdCh7CiAgICAgIGxlbmd0aDogMCwKICAgICAgY2VudGVyOiAweERFQURCRUVGLAogICAgICBsb3dlc3RCZWdpbjogMHgwLAogICAgICBoaWdoZXN0RW5kOiAweDAsCiAgICAgIGJlZ2luSW5kZXg6IEdyb3ZlTGliLkluZGV4KHNoYTModGhpcywgYnl0ZXMzMihpZCAqIDIpKSksCiAgICAgIGVuZEluZGV4OiBHcm92ZUxpYi5JbmRleChzaGEzKHRoaXMsIGJ5dGVzMzIoaWQgKiAyICsgMSkpKQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBhZGQoTGlzdCBzdG9yYWdlIGxpc3QsIHVpbnQgYmVnaW4sIHVpbnQgZW5kLCB1aW50IGludGVydmFsSUQpIGludGVybmFsIHsKICAgIHZhciBfaW50ZXJ2YWxJRCA9IGJ5dGVzMzIoaW50ZXJ2YWxJRCk7CiAgICB2YXIgX2JlZ2luID0gX2dldEJlZ2luSW5kZXhLZXkoYmVnaW4pOwogICAgdmFyIF9lbmQgPSBfZ2V0RW5kSW5kZXhLZXkoZW5kKTsKCiAgICBsaXN0LmJlZ2luSW5kZXguaW5zZXJ0KF9pbnRlcnZhbElELCBfYmVnaW4pOwogICAgbGlzdC5lbmRJbmRleC5pbnNlcnQoX2ludGVydmFsSUQsIF9lbmQpOwogICAgbGlzdC5sZW5ndGgrKzsKCiAgICBpZiAobGlzdC5sZW5ndGggPT0gMSkgewogICAgICBsaXN0Lmxvd2VzdEJlZ2luID0gbGlzdC5iZWdpbkluZGV4LnJvb3Q7CiAgICAgIGxpc3QuaGlnaGVzdEVuZCA9IGxpc3QuZW5kSW5kZXgucm9vdDsKICAgICAgbGlzdC5jZW50ZXIgPSBiZWdpbiArIChlbmQgLSBiZWdpbikgLyAyOwoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBuZXdMb3dlc3QgPSBsaXN0LmJlZ2luSW5kZXguZ2V0UHJldmlvdXNOb2RlKGxpc3QubG93ZXN0QmVnaW4pOwogICAgaWYgKG5ld0xvd2VzdCAhPSAweDApIHsKICAgICAgbGlzdC5sb3dlc3RCZWdpbiA9IG5ld0xvd2VzdDsKICAgIH0KCiAgICB2YXIgbmV3SGlnaGVzdCA9IGxpc3QuZW5kSW5kZXguZ2V0TmV4dE5vZGUobGlzdC5oaWdoZXN0RW5kKTsKICAgIGlmIChuZXdIaWdoZXN0ICE9IDB4MCkgewogICAgICBsaXN0LmhpZ2hlc3RFbmQgPSBuZXdIaWdoZXN0OwogICAgfQogIH0KCiAgLyoKICAgKiBAZGV2IFNlYXJjaGVzIGludGVydmFsIGxpc3QgZm9yOgogICAqICAgLSBtYXRjaGluZyBpbnRlcnZhbHMKICAgKiAgIC0gaW5mb3JtYXRpb24gb24gaG93IHNlYXJjaCBzaG91bGQgcHJvY2VlZAogICAqIEBwYXJhbSBub2RlIFRoZSBub2RlIHRvIHNlYXJjaAogICAqIEBwYXJhbSBwb2ludCBUaGUgcG9pbnQgdG8gc2VhcmNoIGZvcgogICAqLwogIGZ1bmN0aW9uIG1hdGNoaW5nKExpc3Qgc3RvcmFnZSBsaXN0LCB1aW50IHBvaW50KQogICAgY29uc3RhbnQKICAgIGludGVybmFsCiAgICByZXR1cm5zICh1aW50W10gbWVtb3J5IGludGVydmFsSURzLCB1aW50OCBzZWFyY2hOZXh0KQogIHsKICAgIHVpbnRbXSBtZW1vcnkgX2ludGVydmFsSURzID0gbmV3IHVpbnRbXShsaXN0Lmxlbmd0aCk7CiAgICB1aW50IG51bSA9IDA7CgogICAgYnl0ZXMzMiBjdXI7CgogICAgaWYgKHBvaW50ID09IGxpc3QuY2VudGVyKSB7CiAgICAgIC8qCiAgICAgICAqIGNhc2U6IHBvaW50IGV4YWN0bHkgbWF0Y2hlcyB0aGUgbGlzdCdzIGNlbnRlcgogICAgICAgKgogICAgICAgKiBjb2xsZWN0IChhbGwpIG1hdGNoaW5nIGludGVydmFscyAoZXZlcnkgaW50ZXJ2YWwgaW4gbGlzdCwgYnkgZGVmKQogICAgICAgKi8KICAgICAgY3VyID0gbGlzdC5sb3dlc3RCZWdpbjsKICAgICAgd2hpbGUgKGN1ciAhPSAweDApIHsKCV9pbnRlcnZhbElEc1tudW1dID0gdWludChsaXN0LmJlZ2luSW5kZXguZ2V0Tm9kZUlkKGN1cikpOwoJbnVtKys7CgljdXIgPSBfbmV4dChsaXN0LCBjdXIpOwogICAgICB9CgogICAgICAvKgogICAgICAgKiBzZWFyY2ggaXMgZG9uZToKICAgICAgICogbm8gb3RoZXIgbm9kZXMgaW4gdHJlZSBoYXZlIGludGVydmFscyBjb250YWluaW5nIHBvaW50CiAgICAgICAqLwogICAgICBzZWFyY2hOZXh0ID0gU0VBUkNIX0RPTkU7CiAgICB9IGVsc2UgaWYgKHBvaW50IDwgbGlzdC5jZW50ZXIpIHsKICAgICAgLyoKICAgICAgICogY2FzZTogcG9pbnQgaXMgZWFybGllciB0aGFuIGNlbnRlci4KICAgICAgICoKICAgICAgICoKICAgICAgICogY29sbGVjdCBtYXRjaGluZyBpbnRlcnZhbHMuCiAgICAgICAqCiAgICAgICAqIHNob3J0Y3V0OgogICAgICAgKgogICAgICAgKiAgIHN0YXJ0aW5nIHdpdGggbG93ZXN0IGJlZ2lubmluZyBpbnRlcnZhbCwgc2VhcmNoIHNvcnRlZCBiZWdpbiBsaXN0CiAgICAgICAqICAgdW50aWwgYmVnaW4gaXMgbGF0ZXIgdGhhbiBwb2ludAogICAgICAgKgogICAgICAgKgkgICAgICAgcG9pbnQKICAgICAgICogICAgICAgICAgICAgICAgIDoKICAgICAgICogICAgICAgICAgICAgICAgIDogICBjZW50ZXIKICAgICAgICogICAgICAgICAgICAgICAgIDogICAgIHwKICAgICAgICogICAgICAgICgwKSAqLS0tLTotLS0tLXwtLS0tLS0tLS0tbwogICAgICAgKiAgICAgICAgKDEpICAgICotOi0tLS0tfC0tLW8KICAgICAgICogICAgICAgICgtKSAgICAgIHggKi0tLXwtLS0tLS1vCiAgICAgICAqICAgICAgICAoLSkgICAgICAgICAqLS18LS1vCiAgICAgICAqICAgICAgICAoLSkgICAgICAgICAgKi18LS0tLW8KICAgICAgICoKICAgICAgICoKICAgICAgICogICAgdGhpcyB3b3JrcyBiZWNhdXNlIGludGVydmFscyBjb250YWluZWQgaW4gYW4gaW50ZXJ2YWwgbGlzdCBhcmUKICAgICAgICogICAgZ3VhcmFudGVlZCB0b2NvbnRhaW4gYGNlbnRlcmAKICAgICAgICovCiAgICAgIGN1ciA9IGxpc3QubG93ZXN0QmVnaW47CiAgICAgIHdoaWxlIChjdXIgIT0gMHgwKSB7Cgl1aW50IGJlZ2luID0gX2JlZ2luKGxpc3QsIGN1cik7CglpZiAoYmVnaW4gPiBwb2ludCkgewoJICBicmVhazsKCX0KCglfaW50ZXJ2YWxJRHNbbnVtXSA9IHVpbnQobGlzdC5iZWdpbkluZGV4LmdldE5vZGVJZChjdXIpKTsKCW51bSsrOwoKCWN1ciA9IF9uZXh0KGxpc3QsIGN1cik7CiAgICAgIH0KCiAgICAgIC8qCiAgICAgICAqIHNlYXJjaCBzaG91bGQgcHJvY2VlZCB0byBlYXJsaWVyCiAgICAgICAqLwogICAgICBzZWFyY2hOZXh0ID0gU0VBUkNIX0VBUkxJRVI7CiAgICB9IGVsc2UgaWYgKHBvaW50ID4gbGlzdC5jZW50ZXIpIHsKICAgICAgLyoKICAgICAgICogY2FzZTogcG9pbnQgaXMgbGF0ZXIgdGhhbiBjZW50ZXIuCiAgICAgICAqCiAgICAgICAqCiAgICAgICAqIGNvbGxlY3QgbWF0Y2hpbmcgaW50ZXJ2YWxzLgogICAgICAgKgogICAgICAgKiBzaG9ydGN1dDoKICAgICAgICoKICAgICAgICogICBzdGFydGluZyB3aXRoIGhpZ2hlc3QgZW5kaW5nIGludGVydmFsLCBzZWFyY2ggc29ydGVkIGVuZCBsaXN0CiAgICAgICAqICAgdW50aWwgZW5kIGlzIGVhcmxpZXIgdGhhbiBvciBlcXVhbCB0byBwb2ludAogICAgICAgKgogICAgICAgKgkJCSAgICBwb2ludAogICAgICAgKgkJCSAgICA6CiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgY2VudGVyIDoKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgIHwgICAgOgogICAgICAgKiAgICAgICAgICAgICotLS0tLS0tLS0tfC0tLS06LS0tLS1vICgwKQogICAgICAgKiAgICAgICAgICAgICAgICAgICAqLS0tfC0tLS06LW8gICAgICgxKQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICotfC0tLS1vCSAgICAobm90IG1hdGNoaW5nLCBkb25lLikKICAgICAgICogICAgICAgICAgICAgICAqLS0tLS0tLXwtLS1vCSAgICAoLSkKICAgICAgICogICAgICAgICAgICAgICAgICAgICotLXwtLW8JICAgICgtKQogICAgICAgKgogICAgICAgKgogICAgICAgKiAgICB0aGlzIHdvcmtzIGJlY2F1c2UgaW50ZXJ2YWxzIGNvbnRhaW5lZCBpbiBhbiBpbnRlcnZhbCBsaXN0IGFyZQogICAgICAgKiAgICBndWFyYW50ZWVkIHRvIGNvbnRhaW4gYGNlbnRlcmAKICAgICAgICovCiAgICAgIGN1ciA9IGxpc3QuaGlnaGVzdEVuZDsKICAgICAgd2hpbGUgKGN1ciAhPSAweDApIHsKCXVpbnQgZW5kID0gX2VuZChsaXN0LCBjdXIpOwoJaWYgKGVuZCA8PSBwb2ludCkgewoJICBicmVhazsKCX0KCglfaW50ZXJ2YWxJRHNbbnVtXSA9IHVpbnQobGlzdC5lbmRJbmRleC5nZXROb2RlSWQoY3VyKSk7CgludW0rKzsKCgljdXIgPSBfcHJldmlvdXMobGlzdCwgY3VyKTsKICAgICAgfQoKICAgICAgLyoKICAgICAgICogc2VhcmNoIHByb2NlZWRzIHRvIGxhdGVyIGludGVydmFscwogICAgICAgKi8KICAgICAgc2VhcmNoTmV4dCA9IFNFQVJDSF9MQVRFUjsKICAgIH0KCiAgICAvKgogICAgICogcmV0dXJuIGNvcnJlY3RseS1zaXplZCBhcnJheSBvZiBpbnRlcnZhbElEcwogICAgICovCiAgICBpZiAobnVtID09IF9pbnRlcnZhbElEcy5sZW5ndGgpIHsKICAgICAgaW50ZXJ2YWxJRHMgPSBfaW50ZXJ2YWxJRHM7CiAgICB9IGVsc2UgewogICAgICBpbnRlcnZhbElEcyA9IG5ldyB1aW50W10obnVtKTsKICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtOyBpKyspIHsKCWludGVydmFsSURzW2ldID0gX2ludGVydmFsSURzW2ldOwogICAgICB9CiAgICB9CiAgfQoKICAvKgogICAqIEdyb3ZlIGxpbmtlZCBsaXN0IHRyYXZlcnNhbAogICAqLwogIGZ1bmN0aW9uIF9iZWdpbihMaXN0IHN0b3JhZ2UgbGlzdCwgYnl0ZXMzMiBpbmRleE5vZGUpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBfZ2V0QmVnaW4obGlzdC5iZWdpbkluZGV4LmdldE5vZGVWYWx1ZShpbmRleE5vZGUpKTsKICB9CgogIGZ1bmN0aW9uIF9lbmQoTGlzdCBzdG9yYWdlIGxpc3QsIGJ5dGVzMzIgaW5kZXhOb2RlKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gX2dldEVuZChsaXN0LmVuZEluZGV4LmdldE5vZGVWYWx1ZShpbmRleE5vZGUpKTsKICB9CgogIGZ1bmN0aW9uIF9uZXh0KExpc3Qgc3RvcmFnZSBsaXN0LCBieXRlczMyIGN1cikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMikgewogICAgcmV0dXJuIGxpc3QuYmVnaW5JbmRleC5nZXROZXh0Tm9kZShjdXIpOwogIH0KCiAgZnVuY3Rpb24gX3ByZXZpb3VzKExpc3Qgc3RvcmFnZSBsaXN0LCBieXRlczMyIGN1cikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMikgewogICAgcmV0dXJuIGxpc3QuZW5kSW5kZXguZ2V0UHJldmlvdXNOb2RlKGN1cik7CiAgfQoKICAvKgogICAqIHVpbnQgLyBpbnQgY29udmVyc2lvbnMgZm9yIEdyb3ZlIG5vZGVJRHMKICAgKi8KICBmdW5jdGlvbiBfZ2V0QmVnaW5JbmRleEtleSh1aW50IGJlZ2luKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgIC8vIGNvbnZlcnQgdG8gc2lnbmVkIGludCBpbiBvcmRlci1wcmVzZXJ2aW5nIG1hbm5lcgogICAgcmV0dXJuIGludChiZWdpbiAtIDB4ODAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgfQoKICBmdW5jdGlvbiBfZ2V0RW5kSW5kZXhLZXkodWludCBlbmQpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGludCkgewogICAgLy8gY29udmVydCB0byBzaWduZWQgaW50IGluIG9yZGVyLXByZXNlcnZpbmcgbWFubmVyCiAgICByZXR1cm4gaW50KGVuZCAtIDB4ODAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgfQoKICBmdW5jdGlvbiBfZ2V0QmVnaW4oaW50IGJlZ2luSW5kZXhLZXkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIC8vIGNvbnZlcnQgdG8gdW5zaWduZWQgaW50IGluIG9yZGVyLXByZXNlcnZpbmcgbWFubmVyCiAgICByZXR1cm4gdWludChiZWdpbkluZGV4S2V5KSArIDB4ODAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsKICB9CgogIGZ1bmN0aW9uIF9nZXRFbmQoaW50IGVuZEluZGV4S2V5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAvLyBjb252ZXJ0IHRvIHVuc2lnbmVkIGludCBpbiBvcmRlci1wcmVzZXJ2aW5nIG1hbm5lcgogICAgcmV0dXJuIHVpbnQoZW5kSW5kZXhLZXkpICsgMHg4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwogIH0KfQ=='.
	

]
