Class {
	#name : #SRT139132e99c03d9bce03256796163303603dc1a59,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT139132e99c03d9bce03256796163303603dc1a59 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKGEgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgoKY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKfQoKCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAgIHVpbnQyNTYgdG90YWxTdXBwbHlfOwoKICAvKioKICAqIEBkZXYgdG90YWwgbnVtYmVyIG9mIHRva2VucyBpbiBleGlzdGVuY2UKICAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5XzsKICAgIH0KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKfQoKCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJNRSBUb2tlbiI7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJNRVQiOwogICAgdWludDggcHVibGljIGRlY2ltYWxzID0gMTg7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogIC8qKgogICAqIEBkZXYgSW5jcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfYWRkZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBpbmNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAvKioKICAgKiBAZGV2IERlY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICoKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBkZWNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3N1YnRyYWN0ZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBkZWNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAqLwogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgICAgIH0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKfQoKCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogICAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogICAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgICAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgICAgIF87CiAgICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG9ubHlPd25lciBjYW5NaW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB0b3RhbFN1cHBseV8gPSB0b3RhbFN1cHBseV8uYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgICAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICAgIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBwdWJsaWMgb25seU93bmVyIGNhbk1pbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICAgICAgTWludEZpbmlzaGVkKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCgpjb250cmFjdCBFUkM3MjEgewogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF90b2tlbklkKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfYXBwcm92ZWQsIHVpbnQyNTYgX3Rva2VuSWQpOwoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MgX293bmVyKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYzsKfQoKCmNvbnRyYWN0IEVSQzcyMVRva2VuIGlzIEVSQzcyMSwgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IE5BTUUgPSAiRVJDLU1FIENvbnRyaWJ1dGlvbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFNZTUJPTCA9ICJNRUMiOwoKICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgcHJpdmF0ZSB0b3RhbFRva2VuczsKCiAgICAvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gb3duZXIKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHJpdmF0ZSB0b2tlbk93bmVyOwoKICAgIC8vIE1hcHBpbmcgZnJvbSB0b2tlbiBJRCB0byBhcHByb3ZlZCBhZGRyZXNzCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHByaXZhdGUgdG9rZW5BcHByb3ZhbHM7CgogICAgLy8gTWFwcGluZyBmcm9tIG93bmVyIHRvIGxpc3Qgb2Ygb3duZWQgdG9rZW4gSURzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTZbXSkgcHJpdmF0ZSBvd25lZFRva2VuczsKCiAgICAvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gaW5kZXggb2YgdGhlIG93bmVyIHRva2VucyBsaXN0CiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikgcHJpdmF0ZSBvd25lZFRva2Vuc0luZGV4OwoKICAgIHN0cnVjdCBDb250cmlidXRpb24gewogICAgICAgIGFkZHJlc3MgY29udHJpYnV0b3I7IC8vIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cmlidXRvciBpbiB0aGUgY3Jvd2RzYWxlCiAgICAgICAgdWludDI1NiBjb250cmlidXRpb25BbW91bnQ7IC8vIFRoZSBhbW91bnQgb2YgdGhlIGNvbnRyaWJ1dGlvbgogICAgICAgIHVpbnQ2NCBjb250cmlidXRpb25UaW1lc3RhbXA7IC8vIFRoZSB0aW1lIGF0IHdoaWNoIHRoZSBjb250cmlidXRpb24gd2FzIG1hZGUKICAgIH0KCiAgICBDb250cmlidXRpb25bXSBwdWJsaWMgY29udHJpYnV0aW9uczsKCiAgICBldmVudCBDb250cmlidXRpb25NaW50ZWQoYWRkcmVzcyBpbmRleGVkIF9taW50ZXIsIHVpbnQyNTYgX2NvbnRyaWJ1dGlvblNlbnQsIHVpbnQyNTYgX3Rva2VuSWQpOwoKICAvKioKICAqIEBkZXYgR3VhcmFudGVlcyBtc2cuc2VuZGVyIGlzIG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbgogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIHZhbGlkYXRlIGl0cyBvd25lcnNoaXAgYmVsb25ncyB0byBtc2cuc2VuZGVyCiAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHsKICAgICAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IG1zZy5zZW5kZXIpOwogICAgICAgIF87CiAgICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHN0b3JlZCBieSB0aGUgY29udHJhY3QKICAqIEByZXR1cm4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGNvbnRyaWJ1dGlvbnMubGVuZ3RoOwogICAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyB0byBxdWVyeSB0aGUgYmFsYW5jZSBvZgogICogQHJldHVybiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcwogICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXS5sZW5ndGg7CiAgICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBsaXN0IG9mIHRva2VucyBvd25lZCBieSBhIGdpdmVuIGFkZHJlc3MKICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyB0byBxdWVyeSB0aGUgdG9rZW5zIG9mCiAgKiBAcmV0dXJuIHVpbnQyNTZbXSByZXByZXNlbnRpbmcgdGhlIGxpc3Qgb2YgdG9rZW5zIG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcwogICovCiAgICBmdW5jdGlvbiB0b2tlbnNPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NltdKSB7CiAgICAgICAgcmV0dXJuIG93bmVkVG9rZW5zW19vd25lcl07CiAgICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBvd25lciBvZiB0aGUgc3BlY2lmaWVkIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIG93bmVyIG9mCiAgKiBAcmV0dXJuIG93bmVyIGFkZHJlc3MgY3VycmVudGx5IG1hcmtlZCBhcyB0aGUgb3duZXIgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKi8KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIGFkZHJlc3Mgb3duZXIgPSB0b2tlbk93bmVyW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJldHVybiBvd25lcjsKICAgIH0KCiAgLyoqCiAgICogQGRldiBHZXRzIHRoZSBhcHByb3ZlZCBhZGRyZXNzIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgZ2l2ZW4gdG9rZW4gSUQKICAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIGFwcHJvdmFsIG9mCiAgICogQHJldHVybiBhZGRyZXNzIGN1cnJlbnRseSBhcHByb3ZlZCB0byB0YWtlIG93bmVyc2hpcCBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVkRm9yKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdOwogICAgfQoKICAvKioKICAqIEBkZXYgVHJhbnNmZXJzIHRoZSBvd25lcnNoaXAgb2YgYSBnaXZlbiB0b2tlbiBJRCB0byBhbm90aGVyIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gYWRkcmVzcyB0byByZWNlaXZlIHRoZSBvd25lcnNoaXAgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyBvbmx5T3duZXJPZihfdG9rZW5JZCkgewogICAgICAgIGNsZWFyQXBwcm92YWxBbmRUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgLyoqCiAgKiBAZGV2IEFwcHJvdmVzIGFub3RoZXIgYWRkcmVzcyB0byBjbGFpbSBmb3IgdGhlIG93bmVyc2hpcCBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG8gYWRkcmVzcyB0byBiZSBhcHByb3ZlZCBmb3IgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgYXBwcm92ZWQKICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIG9ubHlPd25lck9mKF90b2tlbklkKSB7CiAgICAgICAgYWRkcmVzcyBvd25lciA9IG93bmVyT2YoX3Rva2VuSWQpOwogICAgICAgIHJlcXVpcmUoX3RvICE9IG93bmVyKTsKICAgICAgICBpZiAoYXBwcm92ZWRGb3IoX3Rva2VuSWQpICE9IDAgfHwgX3RvICE9IDApIHsKICAgICAgICAgICAgdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdID0gX3RvOwogICAgICAgICAgICBBcHByb3ZhbChvd25lciwgX3RvLCBfdG9rZW5JZCk7CiAgICAgICAgfQogICAgfQoKICAvKioKICAqIEBkZXYgQ2xhaW1zIHRoZSBvd25lcnNoaXAgb2YgYSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIGJlaW5nIGNsYWltZWQgYnkgdGhlIG1zZy5zZW5kZXIKICAqLwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoaXNBcHByb3ZlZEZvcihtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIGNsZWFyQXBwcm92YWxBbmRUcmFuc2Zlcihvd25lck9mKF90b2tlbklkKSwgbXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgfQoKICAvKioKICAqIEBkZXYgTWludCB0b2tlbiBmdW5jdGlvbgogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgb3duIHRoZSBtaW50ZWQgdG9rZW4KICAqLwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgQ29udHJpYnV0aW9uIG1lbW9yeSBjb250cmlidXRpb24gPSBDb250cmlidXRpb24oewogICAgICAgICAgICBjb250cmlidXRvcjogX3RvLAogICAgICAgICAgICBjb250cmlidXRpb25BbW91bnQ6IF9hbW91bnQsCiAgICAgICAgICAgIGNvbnRyaWJ1dGlvblRpbWVzdGFtcDogdWludDY0KG5vdykKICAgICAgICB9KTsKICAgICAgICB1aW50MjU2IHRva2VuSWQgPSBjb250cmlidXRpb25zLnB1c2goY29udHJpYnV0aW9uKSAtIDE7CgogICAgICAgIGFkZFRva2VuKF90bywgdG9rZW5JZCk7CiAgICAgICAgVHJhbnNmZXIoMHgwLCBfdG8sIHRva2VuSWQpOwogICAgICAgIENvbnRyaWJ1dGlvbk1pbnRlZChfdG8sIF9hbW91bnQsIHRva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvbnRyaWJ1dG9yKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMoYWRkcmVzcyBjb250cmlidXRvcikgewogICAgICAgIENvbnRyaWJ1dGlvbiBtZW1vcnkgY29udHJpYnV0aW9uID0gY29udHJpYnV0aW9uc1tfdG9rZW5JZF07CiAgICAgICAgY29udHJpYnV0b3IgPSBjb250cmlidXRpb24uY29udHJpYnV0b3I7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0aW9uQW1vdW50KHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NiBjb250cmlidXRpb25BbW91bnQpIHsKICAgICAgICBDb250cmlidXRpb24gbWVtb3J5IGNvbnRyaWJ1dGlvbiA9IGNvbnRyaWJ1dGlvbnNbX3Rva2VuSWRdOwogICAgICAgIGNvbnRyaWJ1dGlvbkFtb3VudCA9IGNvbnRyaWJ1dGlvbi5jb250cmlidXRpb25BbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0aW9uVGltZSh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQ2NCBjb250cmlidXRpb25UaW1lc3RhbXApIHsKICAgICAgICBDb250cmlidXRpb24gbWVtb3J5IGNvbnRyaWJ1dGlvbiA9IGNvbnRyaWJ1dGlvbnNbX3Rva2VuSWRdOwogICAgICAgIGNvbnRyaWJ1dGlvblRpbWVzdGFtcCA9IGNvbnRyaWJ1dGlvbi5jb250cmlidXRpb25UaW1lc3RhbXA7CiAgICB9CgogIC8qKgogICogQGRldiBCdXJucyBhIHNwZWNpZmljIHRva2VuCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gYmVpbmcgYnVybmVkIGJ5IHRoZSBtc2cuc2VuZGVyCiAgKi8KICAgIGZ1bmN0aW9uIF9idXJuKHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIG9ubHlPd25lck9mKF90b2tlbklkKSB7CiAgICAgICAgaWYgKGFwcHJvdmVkRm9yKF90b2tlbklkKSAhPSAwKSB7CiAgICAgICAgICAgIGNsZWFyQXBwcm92YWwobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgIH0KICAgICAgICByZW1vdmVUb2tlbihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBfdG9rZW5JZCk7CiAgICB9CgogIC8qKgogICAqIEBkZXYgVGVsbHMgd2hldGhlciB0aGUgbXNnLnNlbmRlciBpcyBhcHByb3ZlZCBmb3IgdGhlIGdpdmVuIHRva2VuIElEIG9yIG5vdAogICAqIFRoaXMgZnVuY3Rpb24gaXMgbm90IHByaXZhdGUgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGluIGZ1cnRoZXIgaW1wbGVtZW50YXRpb25zIGxpa2UgdGhlIG9wZXJhdGFibGUgRVJDNzIxCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIG9mIHRoZSBvd25lciB0byBxdWVyeSB0aGUgYXBwcm92YWwgb2YKICAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIGFwcHJvdmFsIG9mCiAgICogQHJldHVybiBib29sIHdoZXRoZXIgdGhlIG1zZy5zZW5kZXIgaXMgYXBwcm92ZWQgZm9yIHRoZSBnaXZlbiB0b2tlbiBJRCBvciBub3QKICAgKi8KICAgIGZ1bmN0aW9uIGlzQXBwcm92ZWRGb3IoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhcHByb3ZlZEZvcihfdG9rZW5JZCkgPT0gX293bmVyOwogICAgfQoKICAvKioKICAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2xlYXIgY3VycmVudCBhcHByb3ZhbCBhbmQgdHJhbnNmZXIgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdGhlIHRva2VuIHRvCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAqLwogICAgZnVuY3Rpb24gY2xlYXJBcHByb3ZhbEFuZFRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gb3duZXJPZihfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUob3duZXJPZihfdG9rZW5JZCkgPT0gX2Zyb20pOwoKICAgICAgICBjbGVhckFwcHJvdmFsKF9mcm9tLCBfdG9rZW5JZCk7CiAgICAgICAgcmVtb3ZlVG9rZW4oX2Zyb20sIF90b2tlbklkKTsKICAgICAgICBhZGRUb2tlbihfdG8sIF90b2tlbklkKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogIC8qKgogICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBjbGVhciBjdXJyZW50IGFwcHJvdmFsIG9mIGEgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICovCiAgICBmdW5jdGlvbiBjbGVhckFwcHJvdmFsKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKICAgICAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IF9vd25lcik7CiAgICAgICAgdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdID0gMDsKICAgICAgICBBcHByb3ZhbChfb3duZXIsIDAsIF90b2tlbklkKTsKICAgIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGFkZCBhIHRva2VuIElEIHRvIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwogICogQHBhcmFtIF90byBhZGRyZXNzIHJlcHJlc2VudGluZyB0aGUgbmV3IG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIGFkZGVkIHRvIHRoZSB0b2tlbnMgbGlzdCBvZiB0aGUgZ2l2ZW4gYWRkcmVzcwogICovCiAgICBmdW5jdGlvbiBhZGRUb2tlbihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSB7CiAgICAgICAgcmVxdWlyZSh0b2tlbk93bmVyW190b2tlbklkXSA9PSBhZGRyZXNzKDApKTsKICAgICAgICB0b2tlbk93bmVyW190b2tlbklkXSA9IF90bzsKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IGJhbGFuY2VPZihfdG8pOwogICAgICAgIG93bmVkVG9rZW5zW190b10ucHVzaChfdG9rZW5JZCk7CiAgICAgICAgb3duZWRUb2tlbnNJbmRleFtfdG9rZW5JZF0gPSBsZW5ndGg7CiAgICAgICAgdG90YWxUb2tlbnMgPSB0b3RhbFRva2Vucy5hZGQoMSk7CiAgICB9CgogIC8qKgogICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byByZW1vdmUgYSB0b2tlbiBJRCBmcm9tIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwogICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgcmVwcmVzZW50aW5nIHRoZSBwcmV2aW91cyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSByZW1vdmVkIGZyb20gdGhlIHRva2VucyBsaXN0IG9mIHRoZSBnaXZlbiBhZGRyZXNzCiAgKi8KICAgIGZ1bmN0aW9uIHJlbW92ZVRva2VuKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewogICAgICAgIHJlcXVpcmUob3duZXJPZihfdG9rZW5JZCkgPT0gX2Zyb20pOwoKICAgICAgICB1aW50MjU2IHRva2VuSW5kZXggPSBvd25lZFRva2Vuc0luZGV4W190b2tlbklkXTsKICAgICAgICB1aW50MjU2IGxhc3RUb2tlbkluZGV4ID0gYmFsYW5jZU9mKF9mcm9tKS5zdWIoMSk7CiAgICAgICAgdWludDI1NiBsYXN0VG9rZW4gPSBvd25lZFRva2Vuc1tfZnJvbV1bbGFzdFRva2VuSW5kZXhdOwoKICAgICAgICB0b2tlbk93bmVyW190b2tlbklkXSA9IDA7CiAgICAgICAgb3duZWRUb2tlbnNbX2Zyb21dW3Rva2VuSW5kZXhdID0gbGFzdFRva2VuOwogICAgICAgIG93bmVkVG9rZW5zW19mcm9tXVtsYXN0VG9rZW5JbmRleF0gPSAwOwogICAgLy8gTm90ZSB0aGF0IHRoaXMgd2lsbCBoYW5kbGUgc2luZ2xlLWVsZW1lbnQgYXJyYXlzLiBJbiB0aGF0IGNhc2UsIGJvdGggdG9rZW5JbmRleCBhbmQgbGFzdFRva2VuSW5kZXggYXJlIGdvaW5nIHRvCiAgICAvLyBiZSB6ZXJvLiBUaGVuIHdlIGNhbiBtYWtlIHN1cmUgdGhhdCB3ZSB3aWxsIHJlbW92ZSBfdG9rZW5JZCBmcm9tIHRoZSBvd25lZFRva2VucyBsaXN0IHNpbmNlIHdlIGFyZSBmaXJzdCBzd2FwcGluZwogICAgLy8gdGhlIGxhc3RUb2tlbiB0byB0aGUgZmlyc3QgcG9zaXRpb24sIGFuZCB0aGVuIGRyb3BwaW5nIHRoZSBlbGVtZW50IHBsYWNlZCBpbiB0aGUgbGFzdCBwb3NpdGlvbiBvZiB0aGUgbGlzdAoKICAgICAgICBvd25lZFRva2Vuc1tfZnJvbV0ubGVuZ3RoLS07CiAgICAgICAgb3duZWRUb2tlbnNJbmRleFtfdG9rZW5JZF0gPSAwOwogICAgICAgIG93bmVkVG9rZW5zSW5kZXhbbGFzdFRva2VuXSA9IHRva2VuSW5kZXg7CiAgICAgICAgdG90YWxUb2tlbnMgPSB0b3RhbFRva2Vucy5zdWIoMSk7CiAgICB9Cn0KCgovKgoqCiogRVJDLU1FIEJldGEgR2FtZQoqCiogQGF1dGhvciBHaGlsaWEgV2VsZGVzc2VsYXNpZQoqCiogWW91ciBtaXNzaW9uLCBpZiB5b3UgY2hvb3NlIHRvIGFjY2VwdCBpdDogZ2V0IGFjY2VzcyB0byB0aGUgRVJDLU1FIGJldGEuCiogSG93IGRvIHlvdSBkbyB0aGF0PyBJdCdzIHNpbXBsZS4KKiAgIDEuIEJlY29tZSBla3NwZXJ0IGRldmxvcGVyCiogICAyLiA/Pz8KKiAgIDMuIFByb2ZpdAoqCiogSGludDogVGhvc2Ugd2hvIGNhbiBtaW50IGEgY2VydGFpbiBhc3NldCB3aWxsIGhhdmUgYWNjZXNzIHRvIHRoZSBiZXRhCioKKiBXQVJOSU5HCiogLSBZb3UgbWlnaHQgd2FubmEgcmVhZCB0aGUgY29kZSAoZG9uJ3QgbG9vayBhdCBpdCB0b28gY2xvc2VseSB0aG8ganVzdCBzZW5kIHlvdXIgRVRIIHRvIHRoZSBhZGRyZXNzKQoqIC0gQmV3YXJlIHBlb3BsZSB3YWl0aW5nIHRvIHVzZSB5b3VyIGZ1bmRzIHRvIGJlYXQgdGhlIGdhbWUgYXQgeW91ciBleHBlbnNlIChEb24ndCBnZXQgZmluZXNzZWQgYm9pISkKKgoqIEpvaW4gdXMgb24gRGlzY29yZDogaHR0cHM6Ly9kaXNjb3JkLmdnL25EZFRtNXoKKgoqIE9oIGFuZCB0aGFua3MgZm9yIHBhcnRpY2lwYXRpbmcgaW4gb3VyIHByZXNhbGUKKgoqCiovCgovL1Rva2VuIEdhbWUgY29udHJhY3QgLSBhbGxvd3Mgc2tpbGxlZCBwbGF5ZXJzIHRvIGdhaW4gYWNjZXNzIHRvIHRoZSBFUkMtTUUgYmV0YQpjb250cmFjdCBUb2tlbkdhbWUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy8gVGhlIE1FLVRva2VuIGJlaW5nIG1pbnRlZAogICAgTWludGFibGVUb2tlbiBwdWJsaWMgdG9rZW47CiAgICAvLyBUaGUgTkZUIGJlaW5nIG1pbnRlZCwgdGhvdWdodCBpdCBtaWdodCBiZSB1c2VmdWwKICAgIEVSQzcyMVRva2VuIHB1YmxpYyBwYXNzOwogICAgLy8gQSBtYXBwaW5nIG9mIGFsbCB0aGUgcGVvcGxlIHdobyBmdW5kZWQgdG8gdGhlIHByZXNhbGUKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZnVuZGVyczsKICAgIC8vIEFuIGFycmF5IG9mIGFsbCB0aGUgcGVvcGxlIHdobyBiZWF0IHRoZSBnYW1lCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzV2lubmVyOwogICAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZDsKICAgIC8vIGNhcCBvZiB0aGUgQ3Jvd2RzYWxlCiAgICB1aW50MjU2IHB1YmxpYyBjYXAgPSA3MDAwIGV0aGVyOwogICAgLy8gTXkgd2FsbGV0CiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogICAgZXZlbnQgR2FtZVdvbihhZGRyZXNzIGluZGV4ZWQgd2lubmVyLCB1aW50MjU2IHZhbHVlVW5sb2NrZWQpOwoKICAgIC8vQ29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFRva2VuR2FtZShFUkM3MjFUb2tlbiBfcGFzcywgTWludGFibGVUb2tlbiBfdG9rZW4pIHB1YmxpYyB7CiAgICAgICAgcGFzcyA9IF9wYXNzOwogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgICAgIHdhbGxldCA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8gQmVhdGluZyB0aGUgZ2FtZSBzaG91bGQgYmUgYXMgc2ltcGxlIGFzIHNlbmRpbmcgYWxsIG9mIHlvdXIgRVRIIHRvIHRoZSBjb250cmFjdCBhZGRyZXNzCiAgICAvLyBJZGsgdGhvIEkgY291bGQgYmUgd3JvbmcgOikKICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBiZWF0R2FtZSgpOwogICAgfQoKICAgIC8vIElmIHlvdSBjYWxsIHRoaXMgZnVuY3Rpb24geW91IHNob3VsZCBiZWF0IHRoZSBnYW1lLi4uIEkgdGhpbmsKICAgIGZ1bmN0aW9uIGJlYXRHYW1lKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUod2VpUmFpc2VkLmFkZChtc2cudmFsdWUpIDw9IGNhcCk7CiAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZChtc2cudmFsdWUpOyAvLyB1cGRhdGUgc3RhdGUKICAgICAgICBmdW5kZXJzW21zZy5zZW5kZXJdID0gZnVuZGVyc1ttc2cuc2VuZGVyXS5hZGQobXNnLnZhbHVlKTsKICAgICAgICB3YWxsZXQudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLyBDaGVjayB0aGUgYmFsYW5jZQogICAgZnVuY3Rpb24gZ2V0QmFsYW5jZSgpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgIH0KCiAgICAvLyBZb3UgbWlnaHQgd2FubmEgY2hlY2sgaWYgdGhlIGNhcCBoYXMgYmVlbiByZWFjaGVkIGJlZm9yZSBkb2luZyBhbnl0aGluZwogICAgZnVuY3Rpb24gY2FwUmVhY2hlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gY2FwOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gd2FsbGV0KTsKICAgICAgICB0b2tlbi50cmFuc2Zlck93bmVyc2hpcCh3YWxsZXQpOwogICAgICAgIHBhc3MudHJhbnNmZXJPd25lcnNoaXAod2FsbGV0KTsKICAgIH0KCiAgICAvLyBJIHdvdWxkbid0IGNhbGwgdGhpcyBpZiBJIHdlcmUgeW91LCB3aG8ga25vd3Mgd2hhdCBjb3VsZCBoYXBwZW4KICAgIGZ1bmN0aW9uIGxvc2VHYW1lKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+IDApOwogICAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQodGhpcy5iYWxhbmNlKTsgLy8gdXBkYXRlIHN0YXRlCgogICAgICAgIGlzV2lubmVyW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBmdW5kZXJzW21zZy5zZW5kZXJdID0gZnVuZGVyc1ttc2cuc2VuZGVyXS5hZGQodGhpcy5iYWxhbmNlKTsKCiAgICAgICAgcmVjZWl2ZVByaXplKG1zZy5zZW5kZXIsIHRoaXMuYmFsYW5jZSk7CiAgICAgICAgR2FtZVdvbihtc2cuc2VuZGVyLCB0aGlzLmJhbGFuY2UpOwoKICAgICAgICB3YWxsZXQudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlbkFtb3VudCh1aW50MjU2IHdlaUFtb3VudCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICAvLyBob3cgbWFueSB0b2tlbiB1bml0cyBhIGJ1eWVyIGdldHMgcGVyIHdlaQogICAgICAgIHJldHVybiB3ZWlBbW91bnQubXVsKDEwMDAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWNlaXZlUHJpemUoYWRkcmVzcyBfd2lubmVyLCB1aW50MjU2IF9wcml6ZU1vbmV5KSBwcml2YXRlIHsKICAgICAgICAvLyBUaGUgY29kZSBmb3IgdG9rZW4gbWludGluZwogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gZ2V0VG9rZW5BbW91bnQoX3ByaXplTW9uZXkpOwogICAgICAgIHRva2VuLm1pbnQoX3dpbm5lciwgdG9rZW5zKTsKICAgICAgICAvLyBUaGUgY29kZSBmb3IgdGhlIHBhc3MgbWludGluZwogICAgICAgIHBhc3MubWludChfd2lubmVyLCBfcHJpemVNb25leSk7CiAgICB9Cgp9'.
	

]
