Class {
	#name : #SRTf2fbb2939981594e25d93e6226231fcc1b01718e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf2fbb2939981594e25d93e6226231fcc1b01718e >> base64 [
	^ 'bGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdXJlIGludGVybmFsICByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVyZSBpbnRlcm5hbCAgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgcHVyZSBpbnRlcm5hbCAgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIHB1cmUgaW50ZXJuYWwgIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IFRva2VuIHsKICAgIC8qIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBpcyByZXBsYWNlZCB3aXRoOgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICovCiAgICAvLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBhZGRyZXNzIHB1YmxpYyBzYWxlOwogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzQWxsb3dlZDsKICAgIAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gewoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZFRyYW5zZmVyCiAgICAgICAJcmV0dXJucyAoYm9vbCBzdWNjZXNzKSAKICAgIHsKICAgICAgICAvL0RlZmF1bHQgYXNzdW1lcyB0b3RhbFN1cHBseSBjYW4ndCBiZSBvdmVyIG1heCAoMl4yNTYgLSAxKS4KICAgICAgICAvL0lmIHlvdXIgdG9rZW4gbGVhdmVzIG91dCB0b3RhbFN1cHBseSBhbmQgY2FuIGlzc3VlIG1vcmUgdG9rZW5zIGFzIHRpbWUgZ29lcyBvbiwgeW91IG5lZWQgdG8gY2hlY2sgaWYgaXQgZG9lc24ndCB3cmFwLgogICAgICAgIC8vUmVwbGFjZSB0aGUgaWYgd2l0aCB0aGlzIG9uZSBpbnN0ZWFkLgogICAgICAgIC8vcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pOwogICAgCXJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLnN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gU2FmZU1hdGguYWRkKGJhbGFuY2VzW190b10sX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZFRyYW5zZmVyCiAgICAgIAlyZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICAgIHsKICAgICAgICAvL3NhbWUgYXMgYWJvdmUuIFJlcGxhY2UgdGhpcyBsaW5lIHdpdGggdGhlIGZvbGxvd2luZyBpZiB5b3Ugd2FudCB0byBwcm90ZWN0IGFnYWluc3Qgd3JhcHBpbmcgdWludHMuCiAgICAgICAgLy9yZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKTsKCSAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gU2FmZU1hdGguYWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gU2FmZU1hdGguc3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLnN1YihhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICBtb2RpZmllciB2YWxpZFRyYW5zZmVyKCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2FsZSB8fCB0cmFuc2ZlcnNBbGxvd2VkKTsKICAgICAgICBfOwogICAgfSAgIAp9Cgpjb250cmFjdCBIdW1hblN0YW5kYXJkVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgLyogUHVibGljIHZhcmlhYmxlcyBvZiB0aGUgdG9rZW4gKi8KCiAgICAvKgogICAgTk9URToKICAgIFRoZSBmb2xsb3dpbmcgdmFyaWFibGVzIGFyZSBPUFRJT05BTCB2YW5pdGllcy4gT25lIGRvZXMgbm90IGhhdmUgdG8gaW5jbHVkZSB0aGVtLgogICAgVGhleSBhbGxvdyBvbmUgdG8gY3VzdG9taXNlIHRoZSB0b2tlbiBjb250cmFjdCAmIGluIG5vIHdheSBpbmZsdWVuY2VzIHRoZSBjb3JlIGZ1bmN0aW9uYWxpdHkuCiAgICBTb21lIHdhbGxldHMvaW50ZXJmYWNlcyBtaWdodCBub3QgZXZlbiBib3RoZXIgdG8gbG9vayBhdCB0aGlzIGluZm9ybWF0aW9uLgogICAgKi8KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgICAgLy9mYW5jeSBuYW1lOiBlZyBTaW1vbiBCdWNrcwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAgICAvL0hvdyBtYW55IGRlY2ltYWxzIHRvIHNob3cuIGllLiBUaGVyZSBjb3VsZCAxMDAwIGJhc2UgdW5pdHMgd2l0aCAzIGRlY2ltYWxzLiBNZWFuaW5nIDAuOTgwIFNCWCA9IDk4MCBiYXNlIHVuaXRzLiBJdCdzIGxpa2UgY29tcGFyaW5nIDEgd2VpIHRvIDEgZXRoZXIuCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZWcgU0JYCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnSDAuMSc7ICAgICAgIC8vaHVtYW4gMC4xIHN0YW5kYXJkLiBKdXN0IGFuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZS4KCiAgICBmdW5jdGlvbiBIdW1hblN0YW5kYXJkVG9rZW4oCiAgICAgICAgdWludDI1NiBfaW5pdGlhbEFtb3VudCwKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYWRkcmVzcyBfc2FsZSkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IF9pbml0aWFsQW1vdW50OyAgICAgICAgICAgICAgIC8vIEdpdmUgdGhlIGNyZWF0b3IgYWxsIGluaXRpYWwgdG9rZW5zCiAgICAgICAgdG90YWxTdXBwbHkgPSBfaW5pdGlhbEFtb3VudDsgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdG90YWwgc3VwcGx5CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFtb3VudCBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBzYWxlID0gX3NhbGU7CiAgICAgICAgdHJhbnNmZXJzQWxsb3dlZCA9IGZhbHNlOwogICAgfQoKICAgIC8qIEFwcHJvdmVzIGFuZCB0aGVuIGNhbGxzIHRoZSByZWNlaXZpbmcgY29udHJhY3QgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZXh0cmFEYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CgogICAgICAgIC8vY2FsbCB0aGUgcmVjZWl2ZUFwcHJvdmFsIGZ1bmN0aW9uIG9uIHRoZSBjb250cmFjdCB5b3Ugd2FudCB0byBiZSBub3RpZmllZC4gVGhpcyBjcmFmdHMgdGhlIGZ1bmN0aW9uIHNpZ25hdHVyZSBtYW51YWxseSBzbyBvbmUgZG9lc24ndCBoYXZlIHRvIGluY2x1ZGUgYSBjb250cmFjdCBpbiBoZXJlIGp1c3QgZm9yIHRoaXMuCiAgICAgICAgLy9yZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUsIGFkZHJlc3MgX3Rva2VuQ29udHJhY3QsIGJ5dGVzIF9leHRyYURhdGEpCiAgICAgICAgLy9pdCBpcyBhc3N1bWVkIHRoYXQgd2hlbiBkb2VzIHRoaXMgdGhhdCB0aGUgY2FsbCAqc2hvdWxkKiBzdWNjZWVkLCBvdGhlcndpc2Ugb25lIHdvdWxkIHVzZSB2YW5pbGxhIGFwcHJvdmUgaW5zdGVhZC4KICAgICAgICByZXF1aXJlKF9zcGVuZGVyLmNhbGwoYnl0ZXM0KGJ5dGVzMzIoa2VjY2FrMjU2KCJyZWNlaXZlQXBwcm92YWwoYWRkcmVzcyx1aW50MjU2LGFkZHJlc3MsYnl0ZXMpIikpKSwgbXNnLnNlbmRlciwgX3ZhbHVlLCB0aGlzLCBfZXh0cmFEYXRhKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gcmV2ZXJzZVB1cmNoYXNlKGFkZHJlc3MgX3Rva2VuSG9sZGVyKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlTYWxlCiAgICB7CiAgICAgICAgcmVxdWlyZSghdHJhbnNmZXJzQWxsb3dlZCk7CiAgICAgICAgdWludCB2YWx1ZSA9IGJhbGFuY2VzW190b2tlbkhvbGRlcl07CiAgICAgICAgYmFsYW5jZXNbX3Rva2VuSG9sZGVyXSA9IFNhZmVNYXRoLnN1YihiYWxhbmNlc1tfdG9rZW5Ib2xkZXJdLCB2YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbc2FsZV0gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbc2FsZV0sIHZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfdG9rZW5Ib2xkZXIsIHNhbGUsIHZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVUcmFuc2ZlckxvY2soKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlTYWxlCiAgICB7CiAgICAgICAgdHJhbnNmZXJzQWxsb3dlZCA9IHRydWU7CiAgICB9CgogICAgbW9kaWZpZXIgb25seVNhbGUoKQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzYWxlKTsKICAgICAgICBfOwogICAgfQp9Cgpjb250cmFjdCBEaXNidXJzZW1lbnQgewoKICAgIC8qCiAgICAgKiAgU3RvcmFnZQogICAgICovCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIHJlY2VpdmVyOwogICAgdWludCBwdWJsaWMgZGlzYnVyc2VtZW50UGVyaW9kOwogICAgdWludCBwdWJsaWMgc3RhcnREYXRlOwogICAgdWludCBwdWJsaWMgd2l0aGRyYXduVG9rZW5zOwogICAgVG9rZW4gcHVibGljIHRva2VuOwoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIGlzT3duZXIoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpCiAgICAgICAgICAgIC8vIE9ubHkgb3duZXIgaXMgYWxsb3dlZCB0byBwcm9jZWVkCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNSZWNlaXZlcigpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSByZWNlaXZlcikKICAgICAgICAgICAgLy8gT25seSByZWNlaXZlciBpcyBhbGxvd2VkIHRvIHByb2NlZWQKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1NldFVwKCkgewogICAgICAgIGlmIChhZGRyZXNzKHRva2VuKSA9PSAwKQogICAgICAgICAgICAvLyBDb250cmFjdCBpcyBub3Qgc2V0IHVwCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgY29udHJhY3Qgb3duZXIKICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyIFJlY2VpdmVyIG9mIHZlc3RlZCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Rpc2J1cnNlbWVudFBlcmlvZCBWZXN0aW5nIHBlcmlvZCBpbiBzZWNvbmRzCiAgICAvLy8gQHBhcmFtIF9zdGFydERhdGUgU3RhcnQgZGF0ZSBvZiBkaXNidXJzZW1lbnQgcGVyaW9kIChjbGlmZikKICAgIGZ1bmN0aW9uIERpc2J1cnNlbWVudChhZGRyZXNzIF9yZWNlaXZlciwgdWludCBfZGlzYnVyc2VtZW50UGVyaW9kLCB1aW50IF9zdGFydERhdGUpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgaWYgKF9yZWNlaXZlciA9PSAwIHx8IF9kaXNidXJzZW1lbnRQZXJpb2QgPT0gMCkKICAgICAgICAgICAgLy8gQXJndW1lbnRzIGFyZSBudWxsCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICByZWNlaXZlciA9IF9yZWNlaXZlcjsKICAgICAgICBkaXNidXJzZW1lbnRQZXJpb2QgPSBfZGlzYnVyc2VtZW50UGVyaW9kOwogICAgICAgIHN0YXJ0RGF0ZSA9IF9zdGFydERhdGU7CiAgICAgICAgaWYgKHN0YXJ0RGF0ZSA9PSAwKQogICAgICAgICAgICBzdGFydERhdGUgPSBub3c7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0dXAgZnVuY3Rpb24gc2V0cyBleHRlcm5hbCBjb250cmFjdHMnIGFkZHJlc3NlcwogICAgLy8vIEBwYXJhbSBfdG9rZW4gVG9rZW4gYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0dXAoVG9rZW4gX3Rva2VuKQogICAgICAgIHB1YmxpYwogICAgICAgIGlzT3duZXIKICAgIHsKICAgICAgICBpZiAoYWRkcmVzcyh0b2tlbikgIT0gMCB8fCBhZGRyZXNzKF90b2tlbikgPT0gMCkKICAgICAgICAgICAgLy8gU2V0dXAgd2FzIGV4ZWN1dGVkIGFscmVhZHkgb3IgYWRkcmVzcyBpcyBudWxsCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICBmdW5jdGlvbiB3aXRoZHJhdyhhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgaXNSZWNlaXZlcgogICAgICAgIGlzU2V0VXAKICAgIHsKICAgICAgICB1aW50IG1heFRva2VucyA9IGNhbGNNYXhXaXRoZHJhdygpOwogICAgICAgIGlmIChfdmFsdWUgPiBtYXhUb2tlbnMpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIHdpdGhkcmF3blRva2VucyA9IFNhZmVNYXRoLmFkZCh3aXRoZHJhd25Ub2tlbnMsIF92YWx1ZSk7CiAgICAgICAgdG9rZW4udHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgdGhlIG1heGltdW0gYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiB2ZXN0ZWQgdG9rZW5zIHRvIHdpdGhkcmF3CiAgICBmdW5jdGlvbiBjYWxjTWF4V2l0aGRyYXcoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICB1aW50IG1heFRva2VucyA9IFNhZmVNYXRoLm11bChTYWZlTWF0aC5hZGQodG9rZW4uYmFsYW5jZU9mKHRoaXMpLCB3aXRoZHJhd25Ub2tlbnMpLCBTYWZlTWF0aC5zdWIobm93LHN0YXJ0RGF0ZSkpIC8gZGlzYnVyc2VtZW50UGVyaW9kOwogICAgICAgIC8vdWludCBtYXhUb2tlbnMgPSAodG9rZW4uYmFsYW5jZU9mKHRoaXMpICsgd2l0aGRyYXduVG9rZW5zKSAqIChub3cgLSBzdGFydERhdGUpIC8gZGlzYnVyc2VtZW50UGVyaW9kOwogICAgICAgIGlmICh3aXRoZHJhd25Ub2tlbnMgPj0gbWF4VG9rZW5zIHx8IHN0YXJ0RGF0ZSA+IG5vdykKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKFNhZmVNYXRoLnN1YihtYXhUb2tlbnMsIHdpdGhkcmF3blRva2VucykgPiB0b2tlbi50b3RhbFN1cHBseSgpKQogICAgICAgICAgICByZXR1cm4gdG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKG1heFRva2Vucywgd2l0aGRyYXduVG9rZW5zKTsKICAgIH0KfQoKY29udHJhY3QgU2FsZSB7CgogICAgLy8gRVZFTlRTCiAgICBldmVudCBUcmFuc2ZlcnJlZFRpbWVsb2NrZWRUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSwgYWRkcmVzcyBkaXNidXJzZW1lbnQsdWludCBiZW5lZmljaWFyeVRva2Vucyk7CiAgICBldmVudCBQdXJjaGFzZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgTG9ja2VkVW5zb2xkVG9rZW5zKHVpbnQgbnVtVG9rZW5zTG9ja2VkLCBhZGRyZXNzIGRpc2J1cnNlcik7CgogICAgLy8gU1RPUkFHRQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgVE9UQUxfU1VQUExZID0gMTAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9QUklWQVRFID0gNzUwMjAwMDAwMDAwMDAwMDAwOwoKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBERUNJTUFMUyA9IDk7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IE5BTUUgPSAiTGV2ZXJqIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgU1lNQk9MID0gIkxFViI7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIHdoaXRlbGlzdEFkbWluOwogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogICAgSHVtYW5TdGFuZGFyZFRva2VuIHB1YmxpYyB0b2tlbjsKICAgIHVpbnQgcHVibGljIGZyZWV6ZUJsb2NrOwogICAgdWludCBwdWJsaWMgc3RhcnRCbG9jazsKICAgIHVpbnQgcHVibGljIGVuZEJsb2NrOwogICAgdWludCBwdWJsaWMgcHJpY2VfaW5fd2VpID0gMzMzMzMzOyAvL3dlaSBwZXIgMTAqKi05IG9mIGEgTEVWIQogICAgdWludCBwdWJsaWMgcHJpdmF0ZUFsbG9jYXRlZCA9IDA7CiAgICBib29sIHB1YmxpYyBzZXR1cENvbXBsZXRlRmxhZyA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgZW1lcmdlbmN5RmxhZyA9IGZhbHNlOwogICAgYWRkcmVzc1tdIHB1YmxpYyBkaXNidXJzZW1lbnRzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB3aGl0ZWxpc3RSZWdpc3RyYW50czsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgd2hpdGVsaXN0UmVnaXN0cmFudHNGbGFnOwogICAgYm9vbCBwdWJsaWMgcHVibGljU2FsZSA9IGZhbHNlOwoKICAgIC8vIFBVQkxJQyBGVU5DVElPTlMKICAgIGZ1bmN0aW9uIFNhbGUoCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgdWludCBfZnJlZXplQmxvY2ssCiAgICAgICAgdWludCBfc3RhcnRCbG9jaywKICAgICAgICB1aW50IF9lbmRCbG9jaywKICAgICAgICBhZGRyZXNzIF93aGl0ZWxpc3RBZG1pbikKICAgICAgICBwdWJsaWMgCiAgICAgICAgY2hlY2tCbG9ja051bWJlcklucHV0cyhfZnJlZXplQmxvY2ssIF9zdGFydEJsb2NrLCBfZW5kQmxvY2spCiAgICB7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgd2hpdGVsaXN0QWRtaW4gPSBfd2hpdGVsaXN0QWRtaW47CiAgICAgICAgdG9rZW4gPSBuZXcgSHVtYW5TdGFuZGFyZFRva2VuKFRPVEFMX1NVUFBMWSwgTkFNRSwgREVDSU1BTFMsIFNZTUJPTCwgYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgZnJlZXplQmxvY2sgPSBfZnJlZXplQmxvY2s7CiAgICAgICAgc3RhcnRCbG9jayA9IF9zdGFydEJsb2NrOwogICAgICAgIGVuZEJsb2NrID0gX2VuZEJsb2NrOwogICAgICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0aGlzLCB0b2tlbi50b3RhbFN1cHBseSgpKSk7CiAgICAgICAgYXNzZXJ0KHRva2VuLmJhbGFuY2VPZih0aGlzKSA9PSB0b2tlbi50b3RhbFN1cHBseSgpKTsKICAgICAgICBhc3NlcnQodG9rZW4uYmFsYW5jZU9mKHRoaXMpID09IFRPVEFMX1NVUFBMWSk7CiAgICB9CgogICAgZnVuY3Rpb24gcHVyY2hhc2VUb2tlbnMoKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICBzZXR1cENvbXBsZXRlCiAgICAgICAgbm90SW5FbWVyZ2VuY3kKICAgICAgICBzYWxlSW5Qcm9ncmVzcwogICAgewogICAgICAgIHJlcXVpcmUod2hpdGVsaXN0UmVnaXN0cmFudHNGbGFnW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIC8qIENhbGN1bGF0ZSB3aGV0aGVyIGFueSBvZiB0aGUgbXNnLnZhbHVlIG5lZWRzIHRvIGJlIHJldHVybmVkIHRvCiAgICAgICAgICAgdGhlIHNlbmRlci4gVGhlIHB1cmNoYXNlQW1vdW50IGlzIHRoZSBhY3R1YWwgbnVtYmVyIG9mIHRva2VucyB3aGljaAogICAgICAgICAgIHdpbGwgYmUgcHVyY2hhc2VkLiAqLwogICAgICAgIHVpbnQgcHVyY2hhc2VBbW91bnQgPSBtc2cudmFsdWUgLyBwcmljZV9pbl93ZWk7IAogICAgICAgIHVpbnQgZXhjZXNzQW1vdW50ID0gbXNnLnZhbHVlICUgcHJpY2VfaW5fd2VpOwoKICAgICAgICBpZiAoIXB1YmxpY1NhbGUpewogICAgICAgICAgICByZXF1aXJlKHdoaXRlbGlzdFJlZ2lzdHJhbnRzW21zZy5zZW5kZXJdID4gMCApOwogICAgICAgICAgICB1aW50IHRlbXBXaGl0ZWxpc3RBbW91bnQgPSB3aGl0ZWxpc3RSZWdpc3RyYW50c1ttc2cuc2VuZGVyXTsKICAgICAgICAgICAgaWYgKHB1cmNoYXNlQW1vdW50ID4gd2hpdGVsaXN0UmVnaXN0cmFudHNbbXNnLnNlbmRlcl0pewogICAgICAgICAgICAgICAgdWludCBleHRyYSA9IFNhZmVNYXRoLnN1YihwdXJjaGFzZUFtb3VudCx3aGl0ZWxpc3RSZWdpc3RyYW50c1ttc2cuc2VuZGVyXSk7CiAgICAgICAgICAgICAgICBwdXJjaGFzZUFtb3VudCA9IHdoaXRlbGlzdFJlZ2lzdHJhbnRzW21zZy5zZW5kZXJdOwogICAgICAgICAgICAgICAgZXhjZXNzQW1vdW50ID0gU2FmZU1hdGguYWRkKGV4Y2Vzc0Ftb3VudCxleHRyYSpwcmljZV9pbl93ZWkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaXRlbGlzdFJlZ2lzdHJhbnRzW21zZy5zZW5kZXJdID0gU2FmZU1hdGguc3ViKHdoaXRlbGlzdFJlZ2lzdHJhbnRzW21zZy5zZW5kZXJdLCBwdXJjaGFzZUFtb3VudCk7CiAgICAgICAgICAgIGFzc2VydCh3aGl0ZWxpc3RSZWdpc3RyYW50c1ttc2cuc2VuZGVyXSA8IHRlbXBXaGl0ZWxpc3RBbW91bnQpOwogICAgICAgIH0gIAoKICAgICAgICAvLyBDYW5ub3QgcHVyY2hhc2UgbW9yZSB0b2tlbnMgdGhhbiB0aGlzIGNvbnRyYWN0IGhhcyBhdmFpbGFibGUgdG8gc2VsbAogICAgICAgIHJlcXVpcmUocHVyY2hhc2VBbW91bnQgPD0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpKTsKICAgICAgICAvLyBSZXR1cm4gYW55IGV4Y2VzcyBtc2cudmFsdWUKICAgICAgICBpZiAoZXhjZXNzQW1vdW50ID4gMCl7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXhjZXNzQW1vdW50KTsKICAgICAgICB9CiAgICAgICAgLy8gRm9yd2FyZCByZWNlaXZlZCBldGhlciBtaW51cyBhbnkgZXhjZXNzQW1vdW50IHRvIHRoZSB3YWxsZXQKICAgICAgICB3YWxsZXQudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAvLyBUcmFuc2ZlciB0aGUgc3VtIG9mIHRva2VucyB0b2tlblB1cmNoYXNlIHRvIHRoZSBtc2cuc2VuZGVyCiAgICAgICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHB1cmNoYXNlQW1vdW50KSk7CiAgICAgICAgUHVyY2hhc2VkVG9rZW5zKG1zZy5zZW5kZXIsIHB1cmNoYXNlQW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2NrVW5zb2xkVG9rZW5zKGFkZHJlc3MgX3Vuc29sZFRva2Vuc1dhbGxldCkKICAgICAgICBwdWJsaWMKICAgICAgICBzYWxlRW5kZWQKICAgICAgICBzZXR1cENvbXBsZXRlCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgRGlzYnVyc2VtZW50IGRpc2J1cnNlbWVudCA9IG5ldyBEaXNidXJzZW1lbnQoCiAgICAgICAgICAgIF91bnNvbGRUb2tlbnNXYWxsZXQsCiAgICAgICAgICAgIDEqMzY1KjI0KjYwKjYwLAogICAgICAgICAgICBibG9jay50aW1lc3RhbXAKICAgICAgICApOwogICAgICAgIGRpc2J1cnNlbWVudC5zZXR1cCh0b2tlbik7CiAgICAgICAgdWludCBhbW91bnRUb0xvY2sgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgZGlzYnVyc2VtZW50cy5wdXNoKGRpc2J1cnNlbWVudCk7CiAgICAgICAgdG9rZW4udHJhbnNmZXIoZGlzYnVyc2VtZW50LCBhbW91bnRUb0xvY2spOwogICAgICAgIExvY2tlZFVuc29sZFRva2VucyhhbW91bnRUb0xvY2ssIGRpc2J1cnNlbWVudCk7CiAgICB9CgogICAgLy8gT1dORVItT05MWSBGVU5DVElPTlMKICAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVUaW1lbG9ja2VkVG9rZW5zKAogICAgICAgIGFkZHJlc3NbXSBfYmVuZWZpY2lhcmllcywKICAgICAgICB1aW50W10gX2JlbmVmaWNpYXJpZXNUb2tlbnMsCiAgICAgICAgdWludFtdIF90aW1lbG9ja1N0YXJ0cywKICAgICAgICB1aW50W10gX3BlcmlvZHMKICAgICkgCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgc2FsZU5vdEVuZGVkCiAgICB7IAogICAgICAgIGFzc2VydCghc2V0dXBDb21wbGV0ZUZsYWcpOwogICAgICAgIGFzc2VydChfYmVuZWZpY2lhcmllc1Rva2Vucy5sZW5ndGggPCAxMSk7CiAgICAgICAgYXNzZXJ0KF9iZW5lZmljaWFyaWVzLmxlbmd0aCA9PSBfYmVuZWZpY2lhcmllc1Rva2Vucy5sZW5ndGgpOwogICAgICAgIGFzc2VydChfYmVuZWZpY2lhcmllc1Rva2Vucy5sZW5ndGggPT0gX3RpbWVsb2NrU3RhcnRzLmxlbmd0aCk7CiAgICAgICAgYXNzZXJ0KF90aW1lbG9ja1N0YXJ0cy5sZW5ndGggPT0gX3BlcmlvZHMubGVuZ3RoKTsKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IF9iZW5lZmljaWFyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUocHJpdmF0ZUFsbG9jYXRlZCArIF9iZW5lZmljaWFyaWVzVG9rZW5zW2ldIDw9IE1BWF9QUklWQVRFKTsKICAgICAgICAgICAgcHJpdmF0ZUFsbG9jYXRlZCA9IFNhZmVNYXRoLmFkZChwcml2YXRlQWxsb2NhdGVkLCBfYmVuZWZpY2lhcmllc1Rva2Vuc1tpXSk7CiAgICAgICAgICAgIGFkZHJlc3MgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcmllc1tpXTsKICAgICAgICAgICAgdWludCBiZW5lZmljaWFyeVRva2VucyA9IF9iZW5lZmljaWFyaWVzVG9rZW5zW2ldOwogICAgICAgICAgICBEaXNidXJzZW1lbnQgZGlzYnVyc2VtZW50ID0gbmV3IERpc2J1cnNlbWVudCgKICAgICAgICAgICAgICAgIGJlbmVmaWNpYXJ5LAogICAgICAgICAgICAgICAgX3BlcmlvZHNbaV0sCiAgICAgICAgICAgICAgICBfdGltZWxvY2tTdGFydHNbaV0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgZGlzYnVyc2VtZW50LnNldHVwKHRva2VuKTsKICAgICAgICAgICAgdG9rZW4udHJhbnNmZXIoZGlzYnVyc2VtZW50LCBiZW5lZmljaWFyeVRva2Vucyk7CiAgICAgICAgICAgIGRpc2J1cnNlbWVudHMucHVzaChkaXNidXJzZW1lbnQpOwogICAgICAgICAgICBUcmFuc2ZlcnJlZFRpbWVsb2NrZWRUb2tlbnMoYmVuZWZpY2lhcnksIGRpc2J1cnNlbWVudCwgYmVuZWZpY2lhcnlUb2tlbnMpOwogICAgICAgIH0KICAgICAgICBhc3NlcnQodG9rZW4uYmFsYW5jZU9mKHRoaXMpID49IChTYWZlTWF0aC5zdWIoVE9UQUxfU1VQUExZLCBNQVhfUFJJVkFURSkpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlUHJlc2FsZVRva2VucyhhZGRyZXNzW10gX2J1eWVycywgdWludFtdIF9hbW91bnRzKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgICAgIHNhbGVOb3RFbmRlZAogICAgewogICAgICAgIGFzc2VydCghc2V0dXBDb21wbGV0ZUZsYWcpOwogICAgICAgIHJlcXVpcmUoX2J1eWVycy5sZW5ndGggPCAxMSk7CiAgICAgICAgcmVxdWlyZShfYnV5ZXJzLmxlbmd0aCA9PSBfYW1vdW50cy5sZW5ndGgpOwogICAgICAgIGZvcih1aW50IGk9MDsgaSA8IF9idXllcnMubGVuZ3RoOyBpKyspewogICAgICAgICAgICByZXF1aXJlKFNhZmVNYXRoLmFkZChwcml2YXRlQWxsb2NhdGVkLCBfYW1vdW50c1tpXSkgPD0gTUFYX1BSSVZBVEUpOwogICAgICAgICAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIoX2J1eWVyc1tpXSwgX2Ftb3VudHNbaV0pKTsKICAgICAgICAgICAgcHJpdmF0ZUFsbG9jYXRlZCA9IFNhZmVNYXRoLmFkZChwcml2YXRlQWxsb2NhdGVkLCBfYW1vdW50c1tpXSk7CiAgICAgICAgICAgIFB1cmNoYXNlZFRva2VucyhfYnV5ZXJzW2ldLCBfYW1vdW50c1tpXSk7CiAgICAgICAgfQogICAgICAgIGFzc2VydCh0b2tlbi5iYWxhbmNlT2YodGhpcykgPj0gKFNhZmVNYXRoLnN1YihUT1RBTF9TVVBQTFksIE1BWF9QUklWQVRFKSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZVRyYW5zZmVyTG9jaygpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgdG9rZW4ucmVtb3ZlVHJhbnNmZXJMb2NrKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmV2ZXJzZVB1cmNoYXNlKGFkZHJlc3MgX3Rva2VuSG9sZGVyKQogICAgICAgIHBheWFibGUKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICB1aW50IHJlZnVuZCA9IFNhZmVNYXRoLm11bCh0b2tlbi5iYWxhbmNlT2YoX3Rva2VuSG9sZGVyKSxwcmljZV9pbl93ZWkpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHJlZnVuZCk7CiAgICAgICAgdWludCBleGNlc3NBbW91bnQgPSBTYWZlTWF0aC5zdWIobXNnLnZhbHVlLCByZWZ1bmQpOwogICAgICAgIGlmIChleGNlc3NBbW91bnQgPiAwKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXhjZXNzQW1vdW50KTsKICAgICAgICB9CgogICAgICAgIF90b2tlbkhvbGRlci50cmFuc2ZlcihyZWZ1bmQpOwogICAgICAgIHRva2VuLnJldmVyc2VQdXJjaGFzZShfdG9rZW5Ib2xkZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNldHVwQ29tcGxldGUoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUod2FsbGV0IT0wKTsKICAgICAgICByZXF1aXJlKHByaXZhdGVBbGxvY2F0ZWQhPTApOyAgCiAgICAgICAgc2V0dXBDb21wbGV0ZUZsYWcgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZVdhbGxldChhZGRyZXNzIF93YWxsZXQpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgd2FsbGV0ID0gX3dhbGxldDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSAwKTsKICAgICAgICBvd25lciA9IF9uZXdPd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VXaGl0ZWxpc3RBZG1pbihhZGRyZXNzIF9uZXdBZG1pbikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKF9uZXdBZG1pbiAhPSAwKTsKICAgICAgICB3aGl0ZWxpc3RBZG1pbiA9IF9uZXdBZG1pbjsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VQcmljZSh1aW50IF9uZXdQcmljZSkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgICAgICBub3RGcm96ZW4KICAgICAgICB2YWxpZFByaWNlKF9uZXdQcmljZSkKICAgIHsKICAgICAgICBwcmljZV9pbl93ZWkgPSBfbmV3UHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlU3RhcnRCbG9jayh1aW50IF9uZXdCbG9jaykKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgICAgICBub3RGcm96ZW4KICAgIHsKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA8PSBfbmV3QmxvY2sgJiYgX25ld0Jsb2NrIDwgc3RhcnRCbG9jayk7CiAgICAgICAgZnJlZXplQmxvY2sgPSBTYWZlTWF0aC5zdWIoX25ld0Jsb2NrICwgU2FmZU1hdGguc3ViKHN0YXJ0QmxvY2ssIGZyZWV6ZUJsb2NrKSk7CiAgICAgICAgc3RhcnRCbG9jayA9IF9uZXdCbG9jazsKICAgIH0KCiAgICBmdW5jdGlvbiBlbWVyZ2VuY3lUb2dnbGUoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGVtZXJnZW5jeUZsYWcgPSAhZW1lcmdlbmN5RmxhZzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkV2hpdGVsaXN0KGFkZHJlc3NbXSBfcHVyY2hhc2VyLCB1aW50W10gX2Ftb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2hpdGVsaXN0QWRtaW4KICAgICAgICBzYWxlTm90RW5kZWQKICAgIHsKICAgICAgICBhc3NlcnQoX3B1cmNoYXNlci5sZW5ndGggPCAxMSApOwogICAgICAgIGFzc2VydChfcHVyY2hhc2VyLmxlbmd0aCA9PSBfYW1vdW50Lmxlbmd0aCk7CiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBfcHVyY2hhc2VyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHdoaXRlbGlzdFJlZ2lzdHJhbnRzW19wdXJjaGFzZXJbaV1dID0gX2Ftb3VudFtpXTsKICAgICAgICAgICAgd2hpdGVsaXN0UmVnaXN0cmFudHNGbGFnW19wdXJjaGFzZXJbaV1dID0gdHJ1ZTsKICAgICAgICAgICAgCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHN0YXJ0UHVibGljU2FsZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgaWYgKCFwdWJsaWNTYWxlKXsKICAgICAgICAgICAgcHVibGljU2FsZSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8vIE1PRElGSUVSUwogICAgbW9kaWZpZXIgc2FsZUVuZGVkIHsKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+PSBlbmRCbG9jayk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIHNhbGVOb3RFbmRlZCB7CiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPCBlbmRCbG9jayk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgb25seVdoaXRlbGlzdEFkbWluIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSB3aGl0ZWxpc3RBZG1pbik7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIG5vdEZyb3plbiB7CiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPCBmcmVlemVCbG9jayk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIHNhbGVJblByb2dyZXNzIHsKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+PSBzdGFydEJsb2NrICYmIGJsb2NrLm51bWJlciA8IGVuZEJsb2NrKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgc2V0dXBDb21wbGV0ZSB7CiAgICAgICAgYXNzZXJ0KHNldHVwQ29tcGxldGVGbGFnKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgbm90SW5FbWVyZ2VuY3kgewogICAgICAgIGFzc2VydChlbWVyZ2VuY3lGbGFnID09IGZhbHNlKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY2hlY2tCbG9ja051bWJlcklucHV0cyh1aW50IF9mcmVlemUsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQpIHsKICAgICAgICByZXF1aXJlKF9mcmVlemUgPj0gYmxvY2subnVtYmVyCiAgICAgICAgJiYgX3N0YXJ0ID49IF9mcmVlemUKICAgICAgICAmJiBfZW5kID49IF9zdGFydCk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIHZhbGlkUHJpY2UodWludCBfcHJpY2UpewogICAgICAgIHJlcXVpcmUoX3ByaWNlID4gMCk7CiAgICAgICAgXzsKICAgIH0KfQ=='.
	

]
