Class {
	#name : #SRTeba49ddea9f59f0a80ecbb1fb7a585ce0bfe5a5e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTeba49ddea9f59f0a80ecbb1fb7a585ce0bfe5a5e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBvd25lZCB7CiAgICAvLyBPd25lcidzIGFkZHJlc3MKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIC8vIEhhcmRjb2RlZCBhZGRyZXNzIG9mIHN1cGVyIG93bmVyIChmb3Igc2VjdXJpdHkgcmVhc29ucykKICAgIGFkZHJlc3MgaW50ZXJuYWwgc3VwZXJfb3duZXIgPSAweDYzMENDNGM4M2ZDYzExMjFmZUQwNDExMjYyMjdkMjVCYmViNTE5NTk7CgogICAgYWRkcmVzcyBpbnRlcm5hbCBib3VudHlBZGRyID0gMHgxMDk0NUE5MzkxNGFEYjFENjhiNmVGYUFhNEE1OURmQjIxQmE5OTUxOwoKICAgIC8vIEhhcmRjb2RlZCBhZGRyZXNzZXMgb2YgZm91bmRlcnMgZm9yIHdpdGhkcmF3IGFmdGVyIGdyYWNlUGVyaW9kIGlzIHN1Y2NlZWQgKGZvciBzZWN1cml0eSByZWFzb25zKQogICAgYWRkcmVzc1syXSBpbnRlcm5hbCBmb3VuZGVyc0FkZHJlc3NlcyA9IFsKICAgICAgICAweDJmMDcyRjAwMzI4QjYxNzYyNTdDMjFFNjQ5MjU3NjA5OTA1NjEwMDEsCiAgICAgICAgMHgyNjQwZDRiM2JhRjNGNkNGOWJCNTczMkZlMzdmRTFhOTczNWEzMkNFCiAgICBdOwoKICAgIC8vIENvbnN0cnVjdG9yIG9mIHBhcmVudCB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIG93bmVkKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8gTW9kaWZpZXIgZm9yIG93bmVyJ3MgZnVuY3Rpb25zIG9mIHRoZSBjb250cmFjdAogICAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgICBpZiAoKG1zZy5zZW5kZXIgIT0gb3duZXIpICYmIChtc2cuc2VuZGVyICE9IHN1cGVyX293bmVyKSkgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBNb2RpZmllciBmb3Igc3VwZXItb3duZXIncyBmdW5jdGlvbnMgb2YgdGhlIGNvbnRyYWN0CiAgICBtb2RpZmllciBvbmx5U3VwZXJPd25lciB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gc3VwZXJfb3duZXIpIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gUmV0dXJuIHRydWUgaWYgc2VuZGVyIGlzIG93bmVyIG9yIHN1cGVyLW93bmVyIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNPd25lcigpIGludGVybmFsIHJldHVybnMoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKChtc2cuc2VuZGVyID09IG93bmVyKSB8fCAobXNnLnNlbmRlciA9PSBzdXBlcl9vd25lcikpIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBDaGFuZ2UgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgIHB1YmxpYyBvbmx5U3VwZXJPd25lciB7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KfQoKCmNvbnRyYWN0IHRva2VuUmVjaXBpZW50IHsKICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYzsKfQoKCmNvbnRyYWN0IFNURSBpcyBvd25lZCB7CgkvLyBFUkMgMjAgdmFyaWFibGVzCiAgICBzdHJpbmcgcHVibGljIHN0YW5kYXJkID0gJ1Rva2VuIDAuMSc7CiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgLy8gLS0tCiAgICAKICAgIHVpbnQyNTYgcHVibGljIGljb1JhaXNlZEVUSDsgLy8gYW1vdW50IG9mIHJhaXNlZCBpbiBFVEgKICAgIHVpbnQyNTYgcHVibGljIHNvbGRlZFN1cHBseTsgLy8gdG90YWwgYW1vdW50IG9mIHRva2VuIHNvbGRlZCBzdXBwbHkgICAgICAgICAKCQoJLy8gY3VycmVudCBzcGVlZCBvZiBuZXR3b3JrCgl1aW50MjU2IHB1YmxpYyBibG9ja3NQZXJIb3VyOwoJCiAgICAvKiAKICAgIAlTZWxsL0J1eSBwcmljZXMgaW4gd2VpIAogICAgCTEgRVRIID0gMTBeMTggb2Ygd2VpCiAgICAqLwogICAgdWludDI1NiBwdWJsaWMgc2VsbFByaWNlOwogICAgdWludDI1NiBwdWJsaWMgYnV5UHJpY2U7CiAgICAKICAgIC8vIFdoYXQgcGVyY2VudCB3aWxsIGJlIHJldHVybmVkIHRvIFByZXNhbGVycyBhZnRlciBJQ08gKGluIHBlcmNlbnRzIGZyb20gSUNPIHN1bSkKICAgIHVpbnQzMiAgcHVibGljIHBlcmNlbnRUb1ByZXNhbGVyc0Zyb21JQ087CS8vIGluICUgKiAxMDAsIGV4YW1wbGUgMTAlID0gMTAwMAogICAgdWludDI1NiBwdWJsaWMgd2VpVG9QcmVzYWxlcnNGcm9tSUNPOwkJLy8gaW4gd2VpCiAgICAKCS8qIHByZVNhbGUgcGFyYW1zICovCgl1aW50MjU2IHB1YmxpYyBwcmVzYWxlQW1vdW50RVRIOwoKICAgIC8qIEdyYWNlIHBlcmlvZCBwYXJhbWV0ZXJzICovCiAgICB1aW50MjU2IHB1YmxpYyBncmFjZVBlcmlvZFN0YXJ0QmxvY2s7CiAgICB1aW50MjU2IHB1YmxpYyBncmFjZVBlcmlvZFN0b3BCbG9jazsKICAgIHVpbnQyNTYgcHVibGljIGdyYWNlUGVyaW9kTWluVHJhbjsJCQkvLyBtaW5pbXVtIHN1bSBvZiB0cmFuc2FjdGlvbiBmb3IgSUNPIGluIHdlaQogICAgdWludDI1NiBwdWJsaWMgZ3JhY2VQZXJpb2RNYXhUYXJnZXQ7CQkvLyBpbiBTVEUgKiAxMF44CiAgICB1aW50MjU2IHB1YmxpYyBncmFjZVBlcmlvZEFtb3VudDsJCQkvLyBpbiBTVEUgKiAxMF44CiAgICAKICAgIHVpbnQyNTYgcHVibGljIGJ1cm5BZnRlclNvbGRBbW91bnQ7CiAgICAKICAgIGJvb2wgcHVibGljIGljb0ZpbmlzaGVkOwkvLyBJQ08gaXMgZmluaXNoZWQgPwoKICAgIHVpbnQzMiBwdWJsaWMgcGVyY2VudFRvRm91bmRlcnNBZnRlcklDTzsgLy8gaW4gJSAqIDEwMCwgZXhhbXBsZSAzMCUgPSAzMDAwCgogICAgYm9vbCBwdWJsaWMgYWxsb3dUcmFuc2ZlcnM7IC8vIGlmIHRydWUgdGhlbiBhbGxvdyBjb2luIHRyYW5zZmVycwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgdHJhbnNmZXJGcm9tV2hpdGVMaXN0OwoKICAgIC8qIEFycmF5IHdpdGggYWxsIGJhbGFuY2VzICovCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VPZjsKCiAgICAvKiBQcmVzYWxlIGludmVzdG9ycyBsaXN0ICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwcmVzYWxlSW52ZXN0b3JzRVRIOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcHJlc2FsZUludmVzdG9yczsKCiAgICAvKiBJY28gSW52ZXN0b3JzIGxpc3QgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGljb0ludmVzdG9yczsKCiAgICAvLyBEaXZpZGVuZHMgdmFyaWFibGVzCiAgICB1aW50MzIgcHVibGljIGRpdmlkZW5kc1JvdW5kOyAvLyByb3VuZCBudW1iZXIgb2YgZGl2aWRlbmRzICAgIAogICAgdWludDI1NiBwdWJsaWMgZGl2aWRlbmRzU3VtOyAvLyBzdW0gZm9yIGRpdmlkZW5kcyBpbiBjdXJyZW50IHJvdW5kIChpbiB3ZWkpCiAgICB1aW50MjU2IHB1YmxpYyBkaXZpZGVuZHNCdWZmZXI7IC8vIHN1bSBmb3IgZGl2aWRlbmRzIGluIGN1cnJlbnQgcm91bmQgKGluIHdlaSkKCiAgICAvKiBQYWlkIGRpdmlkZW5kcyAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcodWludDMyID0+IHVpbnQyNTYpKSBwdWJsaWMgcGFpZERpdmlkZW5kczsKCQoJLyogVHJ1c3RlZCBhY2NvdW50cyBsaXN0ICovCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpKSBwdWJsaWMgYWxsb3dhbmNlOwogICAgICAgIAogICAgLyogRXZlbnRzIG9mIHRva2VuICovCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGZyb20sIHVpbnQyNTYgdmFsdWUpOwoKCiAgICAvKiBUb2tlbiBjb25zdHJ1Y3RvciAqLwogICAgZnVuY3Rpb24gU1RFKHN0cmluZyBfdG9rZW5OYW1lLCBzdHJpbmcgX3Rva2VuU3ltYm9sKSBwdWJsaWMgewogICAgICAgIC8vIEluaXRpYWwgc3VwcGx5IG9mIHRva2VuCiAgICAgICAgLy8gV2Ugc2V0IG9ubHkgNzBtIG9mIHN1cHBseSBiZWNhdXNlIGFmdGVyIElDTyB3YXMgZmluaXNoZWQsIGZvdW5kZXJzIGdldCBhZGRpdGlvbmFsIDMwJSBvZiB0b2tlbiBzdXBwbHkKICAgICAgICB0b3RhbFN1cHBseSA9IDcwMDAwMDAwICogMTAwMDAwMDAwOwoKICAgICAgICBiYWxhbmNlT2ZbdGhpc10gPSB0b3RhbFN1cHBseTsKCiAgICAgICAgLy8gSW5pdGlhbCBzdW0gb2Ygc29sZGVkIHN1cHBseSBkdXJpbmcgcHJlU2FsZQogICAgICAgIHNvbGRlZFN1cHBseSA9IDE2NTE5MDAxOTEyMjc5OTM7CiAgICAgICAgcHJlc2FsZUFtb3VudEVUSCA9IDE1MDE3Mjc0NDY1NzA5MTgxODc1ODYzOwoKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7CiAgICAgICAgZGVjaW1hbHMgPSA4OwoKICAgICAgICBpY29SYWlzZWRFVEggPSAwOwogICAgICAgIAogICAgICAgIGJsb2Nrc1BlckhvdXIgPSAyNjA7CgogICAgICAgIC8vICUgb2YgY29tcGFueSBjb3N0IHRyYW5zZmVyIHRvIGZvdW5kZXJzIGFmdGVyIElDTyAqIDEwMCwgMzAlID0gMzAwMAogICAgICAgIHBlcmNlbnRUb0ZvdW5kZXJzQWZ0ZXJJQ08gPSAzMDAwOwoKICAgICAgICAvLyAlIHRvIHByZXNhbGVycyBhZnRlciBJQ08gKiAxMDAsIDEwJSA9IDEwMDAKICAgICAgICBwZXJjZW50VG9QcmVzYWxlcnNGcm9tSUNPID0gMTAwMDsKCiAgICAgICAgLy8gR3JhY2VQZXJpb2QgYW5kIElDTyBmaW5pc2hlZCBmbGFncwogICAgICAgIGljb0ZpbmlzaGVkID0gZmFsc2U7CgogICAgICAgIC8vIEFsbG93IHRyYW5zZmVycyB0b2tlbiBCRUZPUkUgSUNPIGFuZCBQUkVTQUxFIGVuZHMKICAgICAgICBhbGxvd1RyYW5zZmVycyA9IGZhbHNlOwoKICAgICAgICAvLyBJTklUIFZBTFVFUyBGT1IgSUNPIFNUQVJUCiAgICAgICAgYnV5UHJpY2UgPSAyMDAwMDAwMDsgLy8gMC4wMDIgRVRIIGZvciAxIFNURQogICAgICAgIGdyYWNlUGVyaW9kU3RhcnRCbG9jayA9IDQ2MTU5MTg7CiAgICAgICAgZ3JhY2VQZXJpb2RTdG9wQmxvY2sgPSBncmFjZVBlcmlvZFN0YXJ0QmxvY2sgKyBibG9ja3NQZXJIb3VyICogODsgLy8gKyA4IGhvdXJzCiAgICAgICAgZ3JhY2VQZXJpb2RBbW91bnQgPSAwOwogICAgICAgIGdyYWNlUGVyaW9kTWF4VGFyZ2V0ID0gNTAwMDAwMCAqIDEwMDAwMDAwMDsgLy8gNSwwMDAsMDAwIFNURSBmb3IgZ3JhY2UgcGVyaW9kCiAgICAgICAgZ3JhY2VQZXJpb2RNaW5UcmFuID0gMTAwMDAwMDAwMDAwMDAwMDAwOyAvLyAwLjEgRVRICiAgICAgICAgYnVybkFmdGVyU29sZEFtb3VudCA9IDMwMDAwMDAwOwogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICB9CgogICAgLyogVHJhbnNmZXIgY29pbnMgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKICAgICAgICBpZiAoX3RvID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKGJhbGFuY2VPZlttc2cuc2VuZGVyXSA8IF92YWx1ZSkgcmV2ZXJ0KCk7IC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaAogICAgICAgIGlmIChiYWxhbmNlT2ZbX3RvXSArIF92YWx1ZSA8IGJhbGFuY2VPZltfdG9dKSByZXZlcnQoKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93cwogICAgICAgIC8vIENhbmNlbCB0cmFuc2ZlciB0cmFuc2FjdGlvbnMgYmVmb3JlIElDTyB3YXMgZmluaXNoZWQKICAgICAgICBpZiAoKCFpY29GaW5pc2hlZCkgJiYgKG1zZy5zZW5kZXIgIT0gYm91bnR5QWRkcikgJiYgKCFhbGxvd1RyYW5zZmVycykpIHJldmVydCgpOwogICAgICAgIC8vIENhbGMgZGl2aWRlbmRzIGZvciBfZnJvbSBhbmQgZm9yIF90byBhZGRyZXNzZXMKICAgICAgICB1aW50MjU2IGRpdkFtb3VudF9mcm9tID0gMDsKICAgICAgICB1aW50MjU2IGRpdkFtb3VudF90byA9IDA7CiAgICAgICAgaWYgKChkaXZpZGVuZHNSb3VuZCAhPSAwKSAmJiAoZGl2aWRlbmRzQnVmZmVyID4gMCkpIHsKICAgICAgICAgICAgZGl2QW1vdW50X2Zyb20gPSBjYWxjRGl2aWRlbmRzU3VtKG1zZy5zZW5kZXIpOwogICAgICAgICAgICBpZiAoKGRpdkFtb3VudF9mcm9tID09IDApICYmIChwYWlkRGl2aWRlbmRzW21zZy5zZW5kZXJdW2RpdmlkZW5kc1JvdW5kXSA9PSAwKSkgcGFpZERpdmlkZW5kc1ttc2cuc2VuZGVyXVtkaXZpZGVuZHNSb3VuZF0gPSAxOwogICAgICAgICAgICBkaXZBbW91bnRfdG8gPSBjYWxjRGl2aWRlbmRzU3VtKF90byk7CiAgICAgICAgICAgIGlmICgoZGl2QW1vdW50X3RvID09IDApICYmIChwYWlkRGl2aWRlbmRzW190b11bZGl2aWRlbmRzUm91bmRdID09IDApKSBwYWlkRGl2aWRlbmRzW190b11bZGl2aWRlbmRzUm91bmRdID0gMTsKICAgICAgICB9CiAgICAgICAgLy8gRW5kIG9mIGNhbGMgZGl2aWRlbmRzCgogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSAtPSBfdmFsdWU7IC8vIFN1YnRyYWN0IGZyb20gdGhlIHNlbmRlcgogICAgICAgIGJhbGFuY2VPZltfdG9dICs9IF92YWx1ZTsgLy8gQWRkIHRoZSBzYW1lIHRvIHRoZSByZWNpcGllbnQKCiAgICAgICAgaWYgKGRpdkFtb3VudF9mcm9tID4gMCkgewogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChkaXZBbW91bnRfZnJvbSkpIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICBpZiAoZGl2QW1vdW50X3RvID4gMCkgewogICAgICAgICAgICBpZiAoIV90by5zZW5kKGRpdkFtb3VudF90bykpIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgLyogTm90aWZ5IGFueW9uZSBsaXN0ZW5pbmcgdGhhdCB0aGlzIHRyYW5zZmVyIHRvb2sgcGxhY2UgKi8KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLyogQWxsb3cgYW5vdGhlciBjb250cmFjdCB0byBzcGVuZCBzb21lIHRva2VucyAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKiBBcHByb3ZlIGFuZCB0aGVuIGNvbW11bmljYXRlIHRoZSBhcHByb3ZlZCBjb250cmFjdCBpbiBhIHNpbmdsZSB0eCAqLwogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2VzcykgewogICAgICAgIHRva2VuUmVjaXBpZW50IHNwZW5kZXIgPSB0b2tlblJlY2lwaWVudChfc3BlbmRlcik7CiAgICAgICAgaWYgKGFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSkpIHsKICAgICAgICAgICAgc3BlbmRlci5yZWNlaXZlQXBwcm92YWwobXNnLnNlbmRlciwgX3ZhbHVlLCB0aGlzLCBfZXh0cmFEYXRhKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNEaXZpZGVuZHNTdW0oYWRkcmVzcyBfZm9yKSBwcml2YXRlIHJldHVybnModWludDI1NiBkaXZpZGVuZHNBbW91bnQpIHsKICAgICAgICBpZiAoZGl2aWRlbmRzUm91bmQgPT0gMCkgcmV0dXJuIDA7CiAgICAgICAgaWYgKGRpdmlkZW5kc0J1ZmZlciA9PSAwKSByZXR1cm4gMDsKICAgICAgICBpZiAoYmFsYW5jZU9mW19mb3JdID09IDApIHJldHVybiAwOwogICAgICAgIGlmIChwYWlkRGl2aWRlbmRzW19mb3JdW2RpdmlkZW5kc1JvdW5kXSAhPSAwKSByZXR1cm4gMDsKICAgICAgICB1aW50MjU2IGRpdkFtb3VudCA9IDA7CiAgICAgICAgZGl2QW1vdW50ID0gKGRpdmlkZW5kc1N1bSAqICgoYmFsYW5jZU9mW19mb3JdICogMTAwMDAwMDAwMDAwMDAwMDApIC8gdG90YWxTdXBwbHkpKSAvIDEwMDAwMDAwMDAwMDAwMDAwOwogICAgICAgIC8vIERvIG5vdCBjYWxjIGRpdmlkZW5kcyBsZXNzIG9yIGVxdWFsIHRoYW4gMC4wMDAxIEVUSAogICAgICAgIGlmIChkaXZBbW91bnQgPCAxMDAwMDAwMDAwMDAwMDApIHsKICAgICAgICAgICAgcGFpZERpdmlkZW5kc1tfZm9yXVtkaXZpZGVuZHNSb3VuZF0gPSAxOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgaWYgKGRpdkFtb3VudCA+IGRpdmlkZW5kc0J1ZmZlcikgewogICAgICAgICAgICBkaXZBbW91bnQgPSBkaXZpZGVuZHNCdWZmZXI7CiAgICAgICAgICAgIGRpdmlkZW5kc0J1ZmZlciA9IDA7CiAgICAgICAgfSBlbHNlIGRpdmlkZW5kc0J1ZmZlciAtPSBkaXZBbW91bnQ7CiAgICAgICAgcGFpZERpdmlkZW5kc1tfZm9yXVtkaXZpZGVuZHNSb3VuZF0gKz0gZGl2QW1vdW50OwogICAgICAgIHJldHVybiBkaXZBbW91bnQ7CiAgICB9CgogICAgLyogQSBjb250cmFjdCBhdHRlbXB0cyB0byBnZXQgdGhlIGNvaW5zICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyhib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoX3RvID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKGJhbGFuY2VPZltfZnJvbV0gPCBfdmFsdWUpIHJldmVydCgpOyAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2gKICAgICAgICBpZiAoKGJhbGFuY2VPZltfdG9dICsgX3ZhbHVlKSA8IGJhbGFuY2VPZltfdG9dKSByZXZlcnQoKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93cyAgICAgICAgCiAgICAgICAgaWYgKF92YWx1ZSA+IGFsbG93YW5jZVtfZnJvbV1bbXNnLnNlbmRlcl0pIHJldmVydCgpOyAvLyBDaGVjayBhbGxvd2FuY2UKICAgICAgICAvLyBDYW5jZWwgdHJhbnNmZXIgdHJhbnNhY3Rpb25zIGJlZm9yZSBJY28gYW5kIGdyYWNlUGVyaW9kIHdhcyBmaW5pc2hlZAogICAgICAgIGlmICgoIWljb0ZpbmlzaGVkKSAmJiAoX2Zyb20gIT0gYm91bnR5QWRkcikgJiYgKCF0cmFuc2ZlckZyb21XaGl0ZUxpc3RbX2Zyb21dKSAmJiAoIWFsbG93VHJhbnNmZXJzKSkgcmV2ZXJ0KCk7CgogICAgICAgIC8vIENhbGMgZGl2aWRlbmRzIGZvciBfZnJvbSBhbmQgZm9yIF90byBhZGRyZXNzZXMKICAgICAgICB1aW50MjU2IGRpdkFtb3VudF9mcm9tID0gMDsKICAgICAgICB1aW50MjU2IGRpdkFtb3VudF90byA9IDA7CiAgICAgICAgaWYgKChkaXZpZGVuZHNSb3VuZCAhPSAwKSAmJiAoZGl2aWRlbmRzQnVmZmVyID4gMCkpIHsKICAgICAgICAgICAgZGl2QW1vdW50X2Zyb20gPSBjYWxjRGl2aWRlbmRzU3VtKF9mcm9tKTsKICAgICAgICAgICAgaWYgKChkaXZBbW91bnRfZnJvbSA9PSAwKSAmJiAocGFpZERpdmlkZW5kc1tfZnJvbV1bZGl2aWRlbmRzUm91bmRdID09IDApKSBwYWlkRGl2aWRlbmRzW19mcm9tXVtkaXZpZGVuZHNSb3VuZF0gPSAxOwogICAgICAgICAgICBkaXZBbW91bnRfdG8gPSBjYWxjRGl2aWRlbmRzU3VtKF90byk7CiAgICAgICAgICAgIGlmICgoZGl2QW1vdW50X3RvID09IDApICYmIChwYWlkRGl2aWRlbmRzW190b11bZGl2aWRlbmRzUm91bmRdID09IDApKSBwYWlkRGl2aWRlbmRzW190b11bZGl2aWRlbmRzUm91bmRdID0gMTsKICAgICAgICB9CiAgICAgICAgLy8gRW5kIG9mIGNhbGMgZGl2aWRlbmRzCgogICAgICAgIGJhbGFuY2VPZltfZnJvbV0gLT0gX3ZhbHVlOyAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICBiYWxhbmNlT2ZbX3RvXSArPSBfdmFsdWU7IC8vIEFkZCB0aGUgc2FtZSB0byB0aGUgcmVjaXBpZW50CiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgogICAgICAgIGlmIChkaXZBbW91bnRfZnJvbSA+IDApIHsKICAgICAgICAgICAgaWYgKCFfZnJvbS5zZW5kKGRpdkFtb3VudF9mcm9tKSkgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIGlmIChkaXZBbW91bnRfdG8gPiAwKSB7CiAgICAgICAgICAgIGlmICghX3RvLnNlbmQoZGl2QW1vdW50X3RvKSkgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvKiBBZG1pbiBmdW5jdGlvbiBmb3IgdHJhbnNmZXIgY29pbnMgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbUFkbWluKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlPd25lciByZXR1cm5zKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChfdG8gPT0gMHgwKSByZXZlcnQoKTsKICAgICAgICBpZiAoYmFsYW5jZU9mW19mcm9tXSA8IF92YWx1ZSkgcmV2ZXJ0KCk7IC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaAogICAgICAgIGlmICgoYmFsYW5jZU9mW190b10gKyBfdmFsdWUpIDwgYmFsYW5jZU9mW190b10pIHJldmVydCgpOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3dzICAgICAgICAKCiAgICAgICAgLy8gQ2FsYyBkaXZpZGVuZHMgZm9yIF9mcm9tIGFuZCBmb3IgX3RvIGFkZHJlc3NlcwogICAgICAgIHVpbnQyNTYgZGl2QW1vdW50X2Zyb20gPSAwOwogICAgICAgIHVpbnQyNTYgZGl2QW1vdW50X3RvID0gMDsKICAgICAgICBpZiAoKGRpdmlkZW5kc1JvdW5kICE9IDApICYmIChkaXZpZGVuZHNCdWZmZXIgPiAwKSkgewogICAgICAgICAgICBkaXZBbW91bnRfZnJvbSA9IGNhbGNEaXZpZGVuZHNTdW0oX2Zyb20pOwogICAgICAgICAgICBpZiAoKGRpdkFtb3VudF9mcm9tID09IDApICYmIChwYWlkRGl2aWRlbmRzW19mcm9tXVtkaXZpZGVuZHNSb3VuZF0gPT0gMCkpIHBhaWREaXZpZGVuZHNbX2Zyb21dW2RpdmlkZW5kc1JvdW5kXSA9IDE7CiAgICAgICAgICAgIGRpdkFtb3VudF90byA9IGNhbGNEaXZpZGVuZHNTdW0oX3RvKTsKICAgICAgICAgICAgaWYgKChkaXZBbW91bnRfdG8gPT0gMCkgJiYgKHBhaWREaXZpZGVuZHNbX3RvXVtkaXZpZGVuZHNSb3VuZF0gPT0gMCkpIHBhaWREaXZpZGVuZHNbX3RvXVtkaXZpZGVuZHNSb3VuZF0gPSAxOwogICAgICAgIH0KICAgICAgICAvLyBFbmQgb2YgY2FsYyBkaXZpZGVuZHMKCiAgICAgICAgYmFsYW5jZU9mW19mcm9tXSAtPSBfdmFsdWU7IC8vIFN1YnRyYWN0IGZyb20gdGhlIHNlbmRlcgogICAgICAgIGJhbGFuY2VPZltfdG9dICs9IF92YWx1ZTsgLy8gQWRkIHRoZSBzYW1lIHRvIHRoZSByZWNpcGllbnQKCiAgICAgICAgaWYgKGRpdkFtb3VudF9mcm9tID4gMCkgewogICAgICAgICAgICBpZiAoIV9mcm9tLnNlbmQoZGl2QW1vdW50X2Zyb20pKSByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRpdkFtb3VudF90byA+IDApIHsKICAgICAgICAgICAgaWYgKCFfdG8uc2VuZChkaXZBbW91bnRfdG8pKSByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gYW55b25lIHNlbmQgRVRIcyB0byB0aGlzIHRva2VuCiAgICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgaWYgKGlzT3duZXIoKSkgewoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2IGFtb3VudCA9IDA7CiAgICAgICAgICAgIGFtb3VudCA9IG1zZy52YWx1ZSAvIGJ1eVByaWNlOyAvLyBjYWxjdWxhdGVzIHRoZSBhbW91bnQgb2YgU1RFCgogICAgICAgICAgICB1aW50MjU2IGFtb3VudFRvUHJlc2FsZUludmVzdG9yID0gMDsKCiAgICAgICAgICAgIC8vIEdyYWNlUGVyaW9kIGlmIGN1cnJlbnQgdGltZXN0YW1wIGJldHdlZW4gZ3JhY2VQZXJpb2RTdGFydEJsb2NrIGFuZCBncmFjZVBlcmlvZFN0b3BCbG9jawogICAgICAgICAgICBpZiAoIChibG9jay5udW1iZXIgPj0gZ3JhY2VQZXJpb2RTdGFydEJsb2NrKSAmJiAoYmxvY2subnVtYmVyIDw9IGdyYWNlUGVyaW9kU3RvcEJsb2NrKSApIHsKICAgICAgICAgICAgICAgIGlmICggKG1zZy52YWx1ZSA8IGdyYWNlUGVyaW9kTWluVHJhbikgfHwgKGdyYWNlUGVyaW9kQW1vdW50ID4gZ3JhY2VQZXJpb2RNYXhUYXJnZXQpICkgcmV2ZXJ0KCk7CiAgICAgICAgICAgICAgICBncmFjZVBlcmlvZEFtb3VudCArPSBhbW91bnQ7CiAgICAgICAgICAgICAgICBpY29SYWlzZWRFVEggKz0gbXNnLnZhbHVlOwogICAgICAgICAgICAgICAgaWNvSW52ZXN0b3JzW21zZy5zZW5kZXJdICs9IGFtb3VudDsKICAgICAgICAgICAgICAgIGJhbGFuY2VPZlt0aGlzXSAtPSBhbW91bnQgKiAxMCAvIDEwMDsKICAgICAgICAgICAgICAgIGJhbGFuY2VPZltib3VudHlBZGRyXSArPSBhbW91bnQgKiAxMCAvIDEwMDsKICAgICAgICAgICAgICAgIHNvbGRlZFN1cHBseSArPSBhbW91bnQgKyBhbW91bnQgKiAxMCAvIDEwMDsKCiAgICAgICAgICAgIC8vIFBheW1lbnQgdG8gcHJlc2VsbGVycyB3aGVuIElDTyB3YXMgZmluaXNoZWQKCSAgICAgICAgfSBlbHNlIGlmICgoaWNvRmluaXNoZWQpICYmIChwcmVzYWxlSW52ZXN0b3JzRVRIW21zZy5zZW5kZXJdID4gMCkgJiYgKHdlaVRvUHJlc2FsZXJzRnJvbUlDTyA+IDApKSB7CiAgICAgICAgICAgICAgICBhbW91bnRUb1ByZXNhbGVJbnZlc3RvciA9IG1zZy52YWx1ZSArIChwcmVzYWxlSW52ZXN0b3JzRVRIW21zZy5zZW5kZXJdICogMTAwMDAwMDAwIC8gcHJlc2FsZUFtb3VudEVUSCkgKiBpY29SYWlzZWRFVEggKiBwZXJjZW50VG9QcmVzYWxlcnNGcm9tSUNPIC8gKDEwMDAwMDAwMCAqIDEwMDAwKTsKICAgICAgICAgICAgICAgIGlmIChhbW91bnRUb1ByZXNhbGVJbnZlc3RvciA+IHdlaVRvUHJlc2FsZXJzRnJvbUlDTykgewogICAgICAgICAgICAgICAgICAgIGFtb3VudFRvUHJlc2FsZUludmVzdG9yID0gd2VpVG9QcmVzYWxlcnNGcm9tSUNPOwogICAgICAgICAgICAgICAgICAgIHdlaVRvUHJlc2FsZXJzRnJvbUlDTyA9IDA7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHdlaVRvUHJlc2FsZXJzRnJvbUlDTyAtPSBhbW91bnRUb1ByZXNhbGVJbnZlc3RvcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCQkJaWYgKGJ1eVByaWNlID4gMCkgewoJCQkJaWYgKGJhbGFuY2VPZlt0aGlzXSA8IGFtb3VudCkgcmV2ZXJ0KCk7CQkJCS8vIGNoZWNrcyBpZiBpdCBoYXMgZW5vdWdoIHRvIHNlbGwKCQkJCWJhbGFuY2VPZlt0aGlzXSAtPSBhbW91bnQ7CQkJCQkJCS8vIHN1YnRyYWN0cyBhbW91bnQgZnJvbSB0b2tlbiBiYWxhbmNlICAgIAkJICAgIAoJCQkJYmFsYW5jZU9mW21zZy5zZW5kZXJdICs9IGFtb3VudDsJCQkJCS8vIGFkZHMgdGhlIGFtb3VudCB0byBidXllcidzIGJhbGFuY2UgICAgCQkgICAgCgkJCX0gZWxzZSBpZiAoIGFtb3VudFRvUHJlc2FsZUludmVzdG9yID09IDAgKSByZXZlcnQoKTsJLy8gUmV2ZXJ0IGlmIGJ1eVByaWNlID0gMCBhbmQgYgoJCQkKCQkJaWYgKGFtb3VudFRvUHJlc2FsZUludmVzdG9yID4gMCkgewoJCQkJcHJlc2FsZUludmVzdG9yc0VUSFttc2cuc2VuZGVyXSA9IDA7CgkJCQlpZiAoICFtc2cuc2VuZGVyLnNlbmQoYW1vdW50VG9QcmVzYWxlSW52ZXN0b3IpICkgcmV2ZXJ0KCk7IC8vIFNlbmQgYW1vdW50VG9QcmVzYWxlSW52ZXN0b3IgdG8gcHJlc2FsZWVyIGFmdGVyIEljbwoJCQl9CgkJCVRyYW5zZmVyKHRoaXMsIG1zZy5zZW5kZXIsIGFtb3VudCk7CQkJCQkvLyBleGVjdXRlIGFuIGV2ZW50IHJlZmxlY3RpbmcgdGhlIGNoYW5nZQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsKHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgewogICAgICAgIGlmIChzZWxsUHJpY2UgPT0gMCkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKGJhbGFuY2VPZlttc2cuc2VuZGVyXSA8IGFtb3VudCkgcmV2ZXJ0KCk7CS8vIGNoZWNrcyBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2ggdG8gc2VsbAogICAgICAgIHVpbnQyNTYgZXRoQW1vdW50ID0gYW1vdW50ICogc2VsbFByaWNlOwkJCS8vIGFtb3VudCBvZiBFVEggZm9yIHNlbGwKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gLT0gYW1vdW50OwkJCQkvLyBzdWJ0cmFjdHMgdGhlIGFtb3VudCBmcm9tIHNlbGxlcidzIGJhbGFuY2UKICAgICAgICBiYWxhbmNlT2ZbdGhpc10gKz0gYW1vdW50OwkJCQkJCS8vIGFkZHMgdGhlIGFtb3VudCB0byB0b2tlbiBiYWxhbmNlCiAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoZXRoQW1vdW50KSkgcmV2ZXJ0KCk7CQkvLyBzZW5kcyBldGhlciB0byB0aGUgc2VsbGVyLgogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRoaXMsIGFtb3VudCk7CiAgICB9CgoKICAgIC8qIAogICAgCVNldCBwYXJhbXMgb2YgSUNPCiAgICAJCiAgICAJX2F1Y3Rpb25zU3RhcnRCbG9jaywgX2F1Y3Rpb25zU3RvcEJsb2NrIC0gYmxvY2sgbnVtYmVyIG9mIHN0YXJ0IGFuZCBzdG9wIG9mIEljbwogICAgCV9hdWN0aW9uc01pblRyYW4gLSBtaW5pbXVtIHRyYW5zYWN0aW9uIGFtb3VudCBmb3IgSWNvIGluIHdlaQogICAgKi8KICAgIGZ1bmN0aW9uIHNldElDT1BhcmFtcyh1aW50MjU2IF9ncmFjZVBlcmlvZFByaWNlLCB1aW50MzIgX2dyYWNlUGVyaW9kU3RhcnRCbG9jaywgdWludDMyIF9ncmFjZVBlcmlvZFN0b3BCbG9jaywgdWludDI1NiBfZ3JhY2VQZXJpb2RNYXhUYXJnZXQsIHVpbnQyNTYgX2dyYWNlUGVyaW9kTWluVHJhbiwgYm9vbCBfcmVzZXRBbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgCWdyYWNlUGVyaW9kU3RhcnRCbG9jayA9IF9ncmFjZVBlcmlvZFN0YXJ0QmxvY2s7CiAgICAgICAgZ3JhY2VQZXJpb2RTdG9wQmxvY2sgPSBfZ3JhY2VQZXJpb2RTdG9wQmxvY2s7CiAgICAgICAgZ3JhY2VQZXJpb2RNYXhUYXJnZXQgPSBfZ3JhY2VQZXJpb2RNYXhUYXJnZXQ7CiAgICAgICAgZ3JhY2VQZXJpb2RNaW5UcmFuID0gX2dyYWNlUGVyaW9kTWluVHJhbjsKICAgICAgICAKICAgICAgICBidXlQcmljZSA9IF9ncmFjZVBlcmlvZFByaWNlOyAgICAJCiAgICAJCiAgICAgICAgaWNvRmluaXNoZWQgPSBmYWxzZTsgICAgICAgIAoKICAgICAgICBpZiAoX3Jlc2V0QW1vdW50KSBpY29SYWlzZWRFVEggPSAwOwogICAgfQoKICAgIC8vIEluaXRpYXRlIGRpdmlkZW5kcyByb3VuZCAoIG93bmVyIGNhbiB0cmFuc2ZlciBFVEggdG8gY29udHJhY3QgYW5kIGluaXRpYXRlIGRpdmlkZW5kcyByb3VuZCApCiAgICAvLyBhRGl2aWRlbmRzUm91bmQgLSBpcyBpbnRlZ2VyIHZhbHVlIG9mIGRpdmlkZW5kcyBwZXJpb2Qgc3VjaCBhcyBZWVlZTU0gZXhhbXBsZSAyMDE3MTIgKHllYXIgMjAxNywgbW9udGggMTIpCiAgICBmdW5jdGlvbiBzZXREaXZpZGVuZHModWludDMyIF9kaXZpZGVuZHNSb3VuZCkgcHVibGljIHBheWFibGUgb25seU93bmVyIHsKICAgICAgICBpZiAoX2RpdmlkZW5kc1JvdW5kID4gMCkgewogICAgICAgICAgICBpZiAobXNnLnZhbHVlIDwgMTAwMDAwMDAwMDAwMDAwMCkgcmV2ZXJ0KCk7CiAgICAgICAgICAgIGRpdmlkZW5kc1N1bSA9IG1zZy52YWx1ZTsKICAgICAgICAgICAgZGl2aWRlbmRzQnVmZmVyID0gbXNnLnZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRpdmlkZW5kc1N1bSA9IDA7CiAgICAgICAgICAgIGRpdmlkZW5kc0J1ZmZlciA9IDA7CiAgICAgICAgfQogICAgICAgIGRpdmlkZW5kc1JvdW5kID0gX2RpdmlkZW5kc1JvdW5kOwogICAgfQoKICAgIC8vIEdldCBkaXZpZGVuZHMKICAgIGZ1bmN0aW9uIGdldERpdmlkZW5kcygpIHB1YmxpYyB7CiAgICAgICAgaWYgKGRpdmlkZW5kc0J1ZmZlciA9PSAwKSByZXZlcnQoKTsKICAgICAgICBpZiAoYmFsYW5jZU9mW21zZy5zZW5kZXJdID09IDApIHJldmVydCgpOwogICAgICAgIGlmIChwYWlkRGl2aWRlbmRzW21zZy5zZW5kZXJdW2RpdmlkZW5kc1JvdW5kXSAhPSAwKSByZXZlcnQoKTsKICAgICAgICB1aW50MjU2IGRpdkFtb3VudCA9IGNhbGNEaXZpZGVuZHNTdW0obXNnLnNlbmRlcik7CiAgICAgICAgaWYgKGRpdkFtb3VudCA+PSAxMDAwMDAwMDAwMDAwMDApIHsKICAgICAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoZGl2QW1vdW50KSkgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFNldCBzZWxsIGFuZCBidXkgcHJpY2VzIGZvciB0b2tlbgogICAgZnVuY3Rpb24gc2V0UHJpY2VzKHVpbnQyNTYgX2J1eVByaWNlLCB1aW50MjU2IF9zZWxsUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGJ1eVByaWNlID0gX2J1eVByaWNlOwogICAgICAgIHNlbGxQcmljZSA9IF9zZWxsUHJpY2U7CiAgICB9CgoKICAgIC8vIFNldCBzZWxsIGFuZCBidXkgcHJpY2VzIGZvciB0b2tlbgogICAgZnVuY3Rpb24gc2V0QWxsb3dUcmFuc2ZlcnMoYm9vbCBfYWxsb3dUcmFuc2ZlcnMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGFsbG93VHJhbnNmZXJzID0gX2FsbG93VHJhbnNmZXJzOwogICAgfQoKICAgIC8vIFN0b3AgZ3JhY2VQZXJpb2QKICAgIGZ1bmN0aW9uIHN0b3BHcmFjZVBlcmlvZCgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGdyYWNlUGVyaW9kU3RvcEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIGJ1eVByaWNlID0gMDsKICAgICAgICBzZWxsUHJpY2UgPSAwOwogICAgfQoKICAgIC8vIFN0b3AgSUNPCiAgICBmdW5jdGlvbiBzdG9wSUNPKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYgKCBncmFjZVBlcmlvZFN0b3BCbG9jayA+IGJsb2NrLm51bWJlciApIGdyYWNlUGVyaW9kU3RvcEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIAogICAgICAgIGljb0ZpbmlzaGVkID0gdHJ1ZTsKCiAgICAgICAgd2VpVG9QcmVzYWxlcnNGcm9tSUNPID0gaWNvUmFpc2VkRVRIICogcGVyY2VudFRvUHJlc2FsZXJzRnJvbUlDTyAvIDEwMDAwOwoKICAgICAgICBpZiAoc29sZGVkU3VwcGx5ID49IChidXJuQWZ0ZXJTb2xkQW1vdW50ICogMTAwMDAwMDAwKSkgewoKICAgICAgICAgICAgdWludDI1NiBjb21wYW55Q29zdCA9IHNvbGRlZFN1cHBseSAqIDEwMDAwMDAgKiAxMDAwMDsKICAgICAgICAgICAgY29tcGFueUNvc3QgPSBjb21wYW55Q29zdCAvICgxMDAwMCAtIHBlcmNlbnRUb0ZvdW5kZXJzQWZ0ZXJJQ08pIC8gMTAwMDAwMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVpbnQyNTYgYW1vdW50VG9Gb3VuZGVycyA9IGNvbXBhbnlDb3N0IC0gc29sZGVkU3VwcGx5OwoKICAgICAgICAgICAgLy8gQnVybiBleHRyYSBjb2lucyBpZiBjdXJyZW50IGJhbGFuY2Ugb2YgdG9rZW4gZ3JlYXRlciB0aGFuIGFtb3VudFRvRm91bmRlcnMgCiAgICAgICAgICAgIGlmIChiYWxhbmNlT2ZbdGhpc10gPiBhbW91bnRUb0ZvdW5kZXJzKSB7CiAgICAgICAgICAgICAgICBCdXJuKHRoaXMsIChiYWxhbmNlT2ZbdGhpc10tYW1vdW50VG9Gb3VuZGVycykpOwogICAgICAgICAgICAgICAgYmFsYW5jZU9mW3RoaXNdID0gMDsKICAgICAgICAgICAgICAgIHRvdGFsU3VwcGx5ID0gY29tcGFueUNvc3Q7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b3RhbFN1cHBseSArPSBhbW91bnRUb0ZvdW5kZXJzIC0gYmFsYW5jZU9mW3RoaXNdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBiYWxhbmNlT2Zbb3duZXJdICs9IGFtb3VudFRvRm91bmRlcnM7CiAgICAgICAgICAgIGJhbGFuY2VPZlt0aGlzXSA9IDA7CiAgICAgICAgICAgIFRyYW5zZmVyKHRoaXMsIG93bmVyLCBhbW91bnRUb0ZvdW5kZXJzKTsKICAgICAgICB9CgogICAgICAgIGJ1eVByaWNlID0gMDsKICAgICAgICBzZWxsUHJpY2UgPSAwOwogICAgfQogICAgCiAgICAKICAgIC8vIFdpdGhkcmF3IEVUSCB0byBmb3VuZGVycyAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9Gb3VuZGVycyh1aW50MjU2IGFtb3VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICAJdWludDI1NiBhbW91bnRfdG9fd2l0aGRyYXcgPSBhbW91bnQgKiAxMDAwMDAwMDAwMDAwMDAwOyAvLyAwLjAwMSBFVEgKICAgICAgICBpZiAoKHRoaXMuYmFsYW5jZSAtIHdlaVRvUHJlc2FsZXJzRnJvbUlDTykgPCBhbW91bnRfdG9fd2l0aGRyYXcpIHJldmVydCgpOwogICAgICAgIGFtb3VudF90b193aXRoZHJhdyA9IGFtb3VudF90b193aXRoZHJhdyAvIGZvdW5kZXJzQWRkcmVzc2VzLmxlbmd0aDsKICAgICAgICB1aW50OCBpID0gMDsKICAgICAgICB1aW50OCBlcnJvcnMgPSAwOwogICAgICAgIAogICAgICAgIGZvciAoaSA9IDA7IGkgPCBmb3VuZGVyc0FkZHJlc3Nlcy5sZW5ndGg7IGkrKykgewoJCQlpZiAoIWZvdW5kZXJzQWRkcmVzc2VzW2ldLnNlbmQoYW1vdW50X3RvX3dpdGhkcmF3KSkgewoJCQkJZXJyb3JzKys7CgkJCX0KCQl9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldEJsb2NrUGVySG91cih1aW50MjU2IF9ibG9ja3NQZXJIb3VyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIAlibG9ja3NQZXJIb3VyID0gX2Jsb2Nrc1BlckhvdXI7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldEJ1cm5BZnRlclNvbGRBbW91bnQodWludDI1NiBfYnVybkFmdGVyU29sZEFtb3VudCkgIHB1YmxpYyBvbmx5T3duZXIgewogICAgCWJ1cm5BZnRlclNvbGRBbW91bnQgPSBfYnVybkFmdGVyU29sZEFtb3VudDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0VHJhbnNmZXJGcm9tV2hpdGVMaXN0KGFkZHJlc3MgX2Zyb20sIGJvb2wgX2FsbG93KSBwdWJsaWMgb25seU93bmVyIHsKICAgIAl0cmFuc2ZlckZyb21XaGl0ZUxpc3RbX2Zyb21dID0gX2FsbG93OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZGRQcmVzYWxlSW52ZXN0b3IoYWRkcmVzcyBfYWRkciwgdWludDI1NiBfYW1vdW50RVRILCB1aW50MjU2IF9hbW91bnRTVEUgKSBwdWJsaWMgb25seU93bmVyIHsgICAgCQoJICAgIHByZXNhbGVJbnZlc3RvcnNbX2FkZHJdICs9IF9hbW91bnRTVEU7CgkgICAgYmFsYW5jZU9mW3RoaXNdIC09IF9hbW91bnRTVEU7CgkJYmFsYW5jZU9mW19hZGRyXSArPSBfYW1vdW50U1RFOwoJICAgIAoJICAgIGlmICggX2Ftb3VudEVUSCA+IDAgKSB7CgkgICAgCXByZXNhbGVJbnZlc3RvcnNFVEhbX2FkZHJdICs9IF9hbW91bnRFVEg7CgkJCWJhbGFuY2VPZlt0aGlzXSAtPSBfYW1vdW50U1RFIC8gMTA7CgkJCWJhbGFuY2VPZltib3VudHlBZGRyXSArPSBfYW1vdW50U1RFIC8gMTA7CgkJCS8vcHJlc2FsZUFtb3VudEVUSCArPSBfYW1vdW50RVRIOwoJCX0KCQkKCSAgICBUcmFuc2Zlcih0aGlzLCBfYWRkciwgX2Ftb3VudFNURSk7CiAgICB9CiAgICAKICAgIC8qKi8gICAgCiAgICAgICAgCiAgICAvLyBCVVJOIGNvaW5zIGluIEhFTEwhIChzZW5kZXIgYmFsYW5jZSkKICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBhbW91bnQpIHB1YmxpYyB7CiAgICAgICAgaWYgKGJhbGFuY2VPZlttc2cuc2VuZGVyXSA8IGFtb3VudCkgcmV2ZXJ0KCk7IC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaAogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSAtPSBhbW91bnQ7IC8vIFN1YnRyYWN0IGZyb20gdGhlIHNlbmRlcgogICAgICAgIHRvdGFsU3VwcGx5IC09IGFtb3VudDsgLy8gVXBkYXRlcyB0b3RhbFN1cHBseQogICAgICAgIEJ1cm4obXNnLnNlbmRlciwgYW1vdW50KTsKICAgIH0KCiAgICAvLyBCVVJOIGNvaW5zIG9mIHRva2VuIGluIEhFTEwhCiAgICBmdW5jdGlvbiBidXJuQ29udHJhY3RDb2lucyh1aW50MjU2IGFtb3VudCkgcHVibGljIG9ubHlTdXBlck93bmVyIHsKICAgICAgICBpZiAoYmFsYW5jZU9mW3RoaXNdIDwgYW1vdW50KSByZXZlcnQoKTsgLy8gQ2hlY2sgaWYgdGhlIHNlbmRlciBoYXMgZW5vdWdoCiAgICAgICAgYmFsYW5jZU9mW3RoaXNdIC09IGFtb3VudDsgLy8gU3VidHJhY3QgZnJvbSB0aGUgY29udHJhY3QgYmFsYW5jZQogICAgICAgIHRvdGFsU3VwcGx5IC09IGFtb3VudDsgLy8gVXBkYXRlcyB0b3RhbFN1cHBseQogICAgICAgIEJ1cm4odGhpcywgYW1vdW50KTsKICAgIH0KCiAgICAvKiBUaGlzIHVubmFtZWQgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyIHNvbWVvbmUgdHJpZXMgdG8gc2VuZCBldGhlciB0byBpdCAqLwogICAgZnVuY3Rpb24oKSBpbnRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBidXkoKTsKICAgIH0KfQ=='.
	

]
