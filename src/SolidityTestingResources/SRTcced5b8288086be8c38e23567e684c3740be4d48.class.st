Class {
	#name : #SRTcced5b8288086be8c38e23567e684c3740be4d48,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcced5b8288086be8c38e23567e684c3740be4d48 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCmNvbnRyYWN0IE9sZFNtYXJ0Um91bGV0dGVUb2tlbgp7CglmdW5jdGlvbiBiYWxhbmNlT2YoIGFkZHJlc3Mgd2hvICkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CglmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgc3VwcGx5KTsKCWZ1bmN0aW9uIHRlbXBUb2tlbnNCYWxhbmNlT2YoIGFkZHJlc3Mgd2hvICkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CglmdW5jdGlvbiB0ZW1wVG9rZW5zUGVyaW9kT2YoIGFkZHJlc3Mgd2hvICkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CglmdW5jdGlvbiBnZXRDb3VudEhvbGRlcnMoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpOwoJZnVuY3Rpb24gZ2V0Q291bnRUZW1wSG9sZGVycygpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnModWludDI1Nik7CglmdW5jdGlvbiBnZXRJdGVtSG9sZGVycyh1aW50MjU2IGluZGV4KSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpOwoJZnVuY3Rpb24gZ2V0SXRlbVRlbXBIb2xkZXJzKHVpbnQyNTYgaW5kZXgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcyk7CglmdW5jdGlvbiBpc09wZXJhdGlvbkJsb2NrZWQoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgU21hcnRSb3VsZXR0ZVRva2VuIHsKCXN0cmluZyBwdWJsaWMgc3RhbmRhcmQgPSAnRVJDMjAnOwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAvLyB0b2tlbiBuYW1lCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgLy8gdG9rZW4gc3ltYm9sCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7IC8vIGEgbnVtYmVyIG9mIHN5bWJvbHMgYWZ0ZXIgY29tbWEKCglzdHJ1Y3QgaG9sZGVyRGF0YSB7CgkJLyoqCgkJKglUb2tlbiBob2xkZXJzIGRldGFpbHMKCQkqLwoJCXVpbnQyNTYgdG9rZW5zX2NvdW50OwoJCWJvb2wgaW5pdDsKCX0KCglzdHJ1Y3QgdGVtcEhvbGRlckRhdGEgewoJCS8qKgoJCSoJVGVtcG9yYXJ5IHRva2VuIGhvbGRlcnMgZGV0YWlscwoJCSovCgkJdWludDI1NiB0b2tlbnNfY291bnQ7CgkJdWludDI1NiBzdGFydF9kYXRlOwoJCXVpbnQyNTYgZW5kX2RhdGU7CgkJYm9vbCBpbml0OwoJfQoKCWFkZHJlc3NbXSBsaXN0QWRkckhvbGRlcnM7IC8vIHBlcm1hbmVudCB0b2tlbiBob2xkZXJzIGxpc3QKCgltYXBwaW5nKCBhZGRyZXNzID0+IGhvbGRlckRhdGEgKSBfYmFsYW5jZXM7IC8vIHRva2VuIG93bmVyc2hpcAoJbWFwcGluZyggYWRkcmVzcyA9PiB0ZW1wSG9sZGVyRGF0YSApIF90ZW1wX2JhbGFuY2U7IC8vIHRlbXBvcmFyeSB0b2tlbiBvd25lcnNoaXAKCW1hcHBpbmcoIGFkZHJlc3MgPT4gbWFwcGluZyggYWRkcmVzcyA9PiB1aW50MjU2ICkgKSBfYXBwcm92YWxzOyAvLyB0b2tlbiB0cmFuc2ZlciByaWdodAoKCWJvb2wgc3RvcF9vcGVyYXRpb247IC8vIHRyYW5zYWN0aW9uIHN0b3AKCQoJdWludDI1NiBfc3VwcGx5OyAvLyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zCgl1aW50MjU2IF9pbml0X2NvdW50X3Rva2VuczsgLy8gaW5pdGlhbCBhbW91bnQgb2YgdG9rZW5zCgl1aW50MjU2IHB1YmxpYyBjb3N0T2ZPbmVUb2tlbjsgLy8gdG9rZW4gcHJpY2UgZXF1aXZhbGVudCB0byB3ZWkKCQoJYWRkcmVzcyB3YWxsZXRfSUNPOwoJYm9vbCBlbmFibGVJQ087IC8vIGljbyBzdGF0dXMgKGxhdW5jaGVkIG9yIG5vdCkKCXVpbnQyNTYgbWluX3ZhbHVlX2J1eVRva2VuOyAvL2luIHdlaQoJdWludDI1NiBtYXhfdmFsdWVfYnV5VG9rZW47IC8vaW4gd2VpCgoJYWRkcmVzcyBmb25kX3dhbGxldDsKCWFkZHJlc3MgZGV2ZWxvcGVyX3dhbGxldDsKCglhZGRyZXNzIGRpdmlkZW50X2NvbnRyYWN0ID0gYWRkcmVzcygweDApOwoJCglldmVudCBUb2tlbkJ1eShhZGRyZXNzIGJ1eWVyLCB1aW50MjU2IGFtb3VudE9mVG9rZW5zKTsKCgkvLyBlbWlzc2lvbiBsaW1pdHMKCXVpbnQyNTYgbWF4X3ZhbHVlX2JldDsgLy8gbWF4aW11bSBzaXplIG9mIGJldCBmb3IgZW1pc3Npb24KCXVpbnQyNTYgbWF4X2NvZWZfcGxheWVyOyAvLyBtYXhpbXVtIHNpemUgb2YgZW1pc3Npb24gY29lZmZpY2llbnQgZm9yIGEgcGxheWVyCgl1aW50MjU2IG1heF9jb2VmX3BhcnRuZXI7IC8vIG1heGltdW0gc2l6ZSBvZiBlbWlzc2lvbiBjb2VmZmljaWVudCBmb3IgYW4gYWZmaWxpYXRlCgoKCWFkZHJlc3MgZGV2ZWxvcGVyOyAvLyBkZXZlbG9wZXIncyBhZGRyZXNzCglhZGRyZXNzIG1hbmFnZXI7IC8vIGNvbnRyYWN0IG1hbmFnaW5nIGFkZHJlc3MgKG1hbmFnZW1lbnQgY2FuIGJlIG1hZGUgZnJvbSB0aGUgc21hcnQgY29udHJhY3QpCgoJc3RydWN0IGdhbWVzRGF0YSB7CgkJYm9vbCBpbml0OwoJfQoKCW1hcHBpbmcoIGFkZHJlc3MgPT4gZ2FtZXNEYXRhKSBsaXN0R2FtZXM7IC8vIExpc3Qgb2YgYWxsb3dlZCBnYW1lcwoJYWRkcmVzc1tdIGFkZHJHYW1lczsKCgkvL29sZCB0b2tlbiBjb250cmFjdCBmb3IgZGF0YSByZXN0b3JhZ2UKCU9sZFNtYXJ0Um91bGV0dGVUb2tlbiBvbGRTbWFydFRva2VuOwoKCXVpbnQyNTYgY291bnRIb2xkZXJzVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3Q7IC8vYW1vdW50IG9mIHBlcm1hbmVudCB0b2tlbiBob2xkZXJzIHdob3NlIGJhbGFuY2UgaGFzIGJlZW4gcmVzdG9yZWQKCXVpbnQyNTYgY291bnRIb2xkZXJzVGVtcFRyYW5zZmVycmVkRnJvbU9sZENvbnRyYWN0OyAvL2Ftb3VudCBvZiB0ZW1wb3JhcnkgdG9rZW4gaG9sZGVycyB3aG9zZSBiYWxhbmNlIGhhcyBiZWVuIHJlc3RvcmVkCgoJZnVuY3Rpb24gU21hcnRSb3VsZXR0ZVRva2VuKCkKCXsKCQlfaW5pdF9jb3VudF90b2tlbnMgPSAxMDAwMDAwMDAwMDAwMDAwMDA7CgkJZGV2ZWxvcGVyX3dhbGxldCA9IGFkZHJlc3MoMHg4NTIxRTFmOTIyMEEyNTFkRTBhYjc4ZjZhMkU4NzU0Q2E5RTc1MjQyKTsKCQl3YWxsZXRfSUNPID0gYWRkcmVzcygweDJkZmY4N2Y4ODkyZDY1ZjdhOTdiMTI4N2U3OTU0MDUwOThhZTdiN2YpOwoJCWZvbmRfd2FsbGV0ID0gYWRkcmVzcygweDM1MDFERDJCNTE1RURDMTkyMGY5MDA3NzgyRGE1YWMwMTg5MjI1MDIpOwoKICAgICAgICBuYW1lID0gJ1JvdWxldHRlIFRva2VuJzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIHN5bWJvbCA9ICdSTFQnOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBkZWNpbWFscyA9IDEwOwogICAgICAgIGNvc3RPZk9uZVRva2VuID0gMTUwMDAwMDAwMDAwMDAwMDsKCgkJbWF4X3ZhbHVlX2JldCA9IDI1NjAwMDAwMDAwMDAwMDAwMDA7CgkJbWF4X2NvZWZfcGxheWVyID0gMzAwOwoJCW1heF9jb2VmX3BhcnRuZXIgPSA1MDsKCgkJZGV2ZWxvcGVyID0gbXNnLnNlbmRlcjsKCQltYW5hZ2VyID0gbXNnLnNlbmRlcjsJCQoJCQoJCWVuYWJsZUlDTyA9IGZhbHNlOwoJCW1pbl92YWx1ZV9idXlUb2tlbiA9IDE1MDAwMDAwMDAwMDAwMDAwMDsKCQltYXhfdmFsdWVfYnV5VG9rZW4gPSA1MDAwMDAwMDAwMDAwMDAwMDAwMDA7CgoJCXN0b3Bfb3BlcmF0aW9uID0gZmFsc2U7CgoJCW9sZFNtYXJ0VG9rZW4gPSBPbGRTbWFydFJvdWxldHRlVG9rZW4oMHgyYTY1MDM1NmJkODk0MzcwY2MxZDZhYmE3MWIzNmMwYWQ2YjNkYzE4KTsKCQljb3VudEhvbGRlcnNUcmFuc2ZlcnJlZEZyb21PbGRDb250cmFjdD0gMDsKCQljb3VudEhvbGRlcnNUZW1wVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3QgPSAwOwoJfQoKCW1vZGlmaWVyIGlzRGV2ZWxvcGVyKCl7CgkJaWYgKG1zZy5zZW5kZXIhPWRldmVsb3BlcikgdGhyb3c7CgkJXzsKCX0KCgltb2RpZmllciBpc01hbmFnZXIoKXsKCQlpZiAobXNnLnNlbmRlciE9bWFuYWdlcikgdGhyb3c7CgkJXzsKCX0KCgltb2RpZmllciBpc0FjY2Vzc1N0b3BPcGVyYXRpb24oKXsKCQlpZiAobXNnLnNlbmRlciE9bWFuYWdlciAmJiBtc2cuc2VuZGVyIT1kZXZlbG9wZXIgJiYgKG1zZy5zZW5kZXIhPWRpdmlkZW50X2NvbnRyYWN0IHx8IGRpdmlkZW50X2NvbnRyYWN0PT1hZGRyZXNzKDB4MCkpKSB0aHJvdzsKCQlfOwoJfQoKCWZ1bmN0aW9uIElzVHJhbnNmZXJGcm9tT2xkQ29udHJhY3REb25lKCkgY29uc3RhbnQgcmV0dXJucyhib29sKQoJewoJCXJldHVybiBjb3VudEhvbGRlcnNUcmFuc2ZlcnJlZEZyb21PbGRDb250cmFjdCA9PSBvbGRTbWFydFRva2VuLmdldENvdW50SG9sZGVycygpOwoJfQoKCS8qKgogICAgKglyZXN0b3JlQWxsUGVyc2lzdGVudFRva2VucygpIC0gZnVuY3Rpb24gb2YgcmVzdG9yaW5nIHRoZSBiYWxhbmNlIG9mIHBlcm1hbmVudCB0b2tlbiBob2xkZXJzLiBPbmNlIHRoZSBmdW5jdGlvbiBoYXMgYmVlbiBjb21wbGV0ZWQsCiAgICAqCWJsb2NrY2hhaW4gc2F2ZXMgdGhlIGluZGV4IHdpdGggd2hpY2ggdG9rZW4gaG9sZGVycyBhZGRyZXNzZXMgd2lsbCBzdGFydCBiZWluZyByZWNlaXZlZCBkdXJpbmcgdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBvcGVyYXRpb24uCiAgICAqCiAgICAqCUBwYXJhbSBsaW1pdCAtIGFtb3VudCBvZiB0b2tlbiBob2xkZXJzIGFkZHJlc3NlcyByZXF1aXJpbmcgdGhlIGJhbGFuY2UgcmVzdG9yYWdlLgogICAgKgogICAgKiovCglmdW5jdGlvbiByZXN0b3JlQWxsUGVyc2lzdGVudFRva2Vucyh1aW50MjU2IGxpbWl0KQoJewoJCWlmKG9sZFNtYXJ0VG9rZW4uaXNPcGVyYXRpb25CbG9ja2VkKCkgJiYgdGhpcy5pc09wZXJhdGlvbkJsb2NrZWQoKSkKCQl7CgkJCXVpbnQyNTYgbGVuID0gb2xkU21hcnRUb2tlbi5nZXRDb3VudEhvbGRlcnMoKTsKCQkJdWludDI1NiBpID0gY291bnRIb2xkZXJzVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3Q7CgkJCWZvcig7IGkgPCBsZW47IGkrKykKCQkJewoJCQkJYWRkcmVzcyBob2xkZXIgPSBvbGRTbWFydFRva2VuLmdldEl0ZW1Ib2xkZXJzKGkpOwoJCQkJdWludDI1NiBjb3VudF90b2tlbnMgPSBvbGRTbWFydFRva2VuLmJhbGFuY2VPZihob2xkZXIpOwoJCQkJaWYoaG9sZGVyID09IGFkZHJlc3MoMHgyYTY1MDM1NmJkODk0MzcwY2MxZDZhYmE3MWIzNmMwYWQ2YjNkYzE4KSkgewoJCQkJCWlmKCFfYmFsYW5jZXNbZm9uZF93YWxsZXRdLmluaXQpewoJCQkJCQlhZGRVc2VyVG9MaXN0KGZvbmRfd2FsbGV0KTsKCQkJCQkJX2JhbGFuY2VzW2ZvbmRfd2FsbGV0XSA9IGhvbGRlckRhdGEoY291bnRfdG9rZW5zLCB0cnVlKTsKCQkJCQl9CgkJCQkJZWxzZXsKCQkJCQkJX2JhbGFuY2VzW2ZvbmRfd2FsbGV0XS50b2tlbnNfY291bnQgKz0gY291bnRfdG9rZW5zOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2V7CgkJCQkJYWRkVXNlclRvTGlzdChob2xkZXIpOwoJCQkJCV9iYWxhbmNlc1tob2xkZXJdID0gaG9sZGVyRGF0YShjb3VudF90b2tlbnMsIHRydWUpOwoJCQkJfQoKCQkJCV9zdXBwbHkgKz0gY291bnRfdG9rZW5zOwoKCQkJCWlmIChsaW1pdCAtIDEgPT0gMCkgYnJlYWs7CgkJCQlsaW1pdC0tOwoJCQl9CgkJCWNvdW50SG9sZGVyc1RyYW5zZmVycmVkRnJvbU9sZENvbnRyYWN0ID0gaTsKCQl9Cgl9CgoJZnVuY3Rpb24gSXNUcmFuc2ZlclRlbXBGcm9tT2xkQ29udHJhY3REb25lKCkgY29uc3RhbnQgcmV0dXJucyhib29sKQoJewoJCXJldHVybiBjb3VudEhvbGRlcnNUZW1wVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3QgPT0gb2xkU21hcnRUb2tlbi5nZXRDb3VudFRlbXBIb2xkZXJzKCk7Cgl9CgoJLyoqCiAgICAqCXJlc3RvcmVBbGxUZW1wVG9rZW5zKCkgLSBmdW5jdGlvbiBvZiB0ZW1ucG9yYXJ5IHRva2VuIGJhbGFuY2UgcmVzdG9yYWdlLiBPbmNlIHRoZSBmdW5jdGlvbiBoYXMgYmVlbiBjb21wbGV0ZWQsCiAgICAqCWJsb2NrY2hhaW4gc2F2ZXMgdGhlIGluZGV4IHdpdGggd2hpY2ggdGVtcG9yYXJ5IHRva2VuIGhvbGRlcnMgYWRkcmVzc2VzIHdpbGwgc3RhcnQgYmVpbmcgcmVjZWl2ZWQgZHVyaW5nIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gb3BlcmF0aW9uLgogICAgKgogICAgKglAcGFyYW0gbGltaXQgLSBhbW91bnQgb2YgdG9rZW4gaG9sZGVycyBhZGRyZXNzZXMgcmVxdWlyaW5nIHRoZSBiYWxhbmNlIHJlc3RvcmFnZS4KICAgICoKICAgICoqLwoJZnVuY3Rpb24gcmVzdG9yZUFsbFRlbXBUb2tlbnModWludDI1NiBsaW1pdCkKCXsKCQlpZihvbGRTbWFydFRva2VuLmlzT3BlcmF0aW9uQmxvY2tlZCgpICYmIHRoaXMuaXNPcGVyYXRpb25CbG9ja2VkKCkpCgkJewoJCQl1aW50MjU2IGxlbiA9IG9sZFNtYXJ0VG9rZW4uZ2V0Q291bnRUZW1wSG9sZGVycygpOwoJCQl1aW50MjU2IGkgPSBjb3VudEhvbGRlcnNUZW1wVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3Q7CgkJCWZvcig7IGkgPCBsZW47IGkrKykKCQkJewoJCQkJYWRkcmVzcyBob2xkZXIgPSBvbGRTbWFydFRva2VuLmdldEl0ZW1UZW1wSG9sZGVycyhpKTsKCQkJCXVpbnQyNTYgY291bnRfdG9rZW5zID0gb2xkU21hcnRUb2tlbi50ZW1wVG9rZW5zQmFsYW5jZU9mKGhvbGRlcik7CgoJCQkJaWYoaG9sZGVyID09IGFkZHJlc3MoMHgyYTY1MDM1NmJkODk0MzcwY2MxZDZhYmE3MWIzNmMwYWQ2YjNkYzE4KSkgewoJCQkJCWlmKCFfYmFsYW5jZXNbZm9uZF93YWxsZXRdLmluaXQpewoJCQkJCQlfYmFsYW5jZXNbZm9uZF93YWxsZXRdID0gaG9sZGVyRGF0YShjb3VudF90b2tlbnMsIHRydWUpOwoJCQkJCQlhZGRVc2VyVG9MaXN0KGZvbmRfd2FsbGV0KTsKCQkJCQl9CgkJCQkJZWxzZXsKCQkJCQkJX2JhbGFuY2VzW2ZvbmRfd2FsbGV0XS50b2tlbnNfY291bnQgKz0gY291bnRfdG9rZW5zOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2V7CgkJCQkJbGlzdEFkZHJUZW1wSG9sZGVycy5wdXNoKGhvbGRlcik7CgkJCQkJdWludDI1NiBlbmRfZGF0ZSA9IG9sZFNtYXJ0VG9rZW4udGVtcFRva2Vuc1BlcmlvZE9mKGhvbGRlcik7CgkJCQkJX3RlbXBfYmFsYW5jZVtob2xkZXJdID0gdGVtcEhvbGRlckRhdGEoY291bnRfdG9rZW5zLCBub3csIGVuZF9kYXRlLCB0cnVlKTsKCQkJCX0KCgkJCQlfc3VwcGx5ICs9IGNvdW50X3Rva2VuczsKCgkJCQlpZiAobGltaXQgLSAxID09IDApIGJyZWFrOwoJCQkJbGltaXQtLTsKCQkJfQoJCQljb3VudEhvbGRlcnNUZW1wVHJhbnNmZXJyZWRGcm9tT2xkQ29udHJhY3QgPSBpOwoJCX0KCX0KCgoJZnVuY3Rpb24gY2hhbmdlRGV2ZWxvcGVyKGFkZHJlc3MgbmV3X2RldmVsb3BlcikgaXNEZXZlbG9wZXIKCXsKCQlpZihuZXdfZGV2ZWxvcGVyID09IGFkZHJlc3MoMHgwKSkgdGhyb3c7CgkJZGV2ZWxvcGVyID0gbmV3X2RldmVsb3BlcjsKCX0KCglmdW5jdGlvbiBjaGFuZ2VNYW5hZ2VyKGFkZHJlc3MgbmV3X21hbmFnZXIpIGlzTWFuYWdlciBleHRlcm5hbAoJewoJCWlmKG5ld19tYW5hZ2VyID09IGFkZHJlc3MoMHgwKSkgdGhyb3c7CgkJbWFuYWdlciA9IG5ld19tYW5hZ2VyOwoJfQoKCWZ1bmN0aW9uIGNoYW5nZU1heFZhbHVlQmV0Rm9yRW1pc3Npb24odWludDI1NiBuZXdfdmFsdWUpIGlzTWFuYWdlciBleHRlcm5hbAoJewoJCWlmKG5ld192YWx1ZSA9PSAwKSB0aHJvdzsKCQltYXhfdmFsdWVfYmV0ID0gbmV3X3ZhbHVlOwoJfQoKCWZ1bmN0aW9uIGNoYW5nZU1heENvZWZQbGF5ZXJGb3JFbWlzc2lvbih1aW50MjU2IG5ld192YWx1ZSkgaXNNYW5hZ2VyIGV4dGVybmFsCgl7CgkJaWYobmV3X3ZhbHVlID4gMTAwMCkgdGhyb3c7CgkJbWF4X2NvZWZfcGxheWVyID0gbmV3X3ZhbHVlOwoJfQoKCWZ1bmN0aW9uIGNoYW5nZU1heENvZWZQYXJ0bmVyRm9yRW1pc3Npb24odWludDI1NiBuZXdfdmFsdWUpIGlzTWFuYWdlciBleHRlcm5hbAoJewoJCWlmKG5ld192YWx1ZSA+IDEwMDApIHRocm93OwoJCW1heF9jb2VmX3BhcnRuZXIgPSBuZXdfdmFsdWU7Cgl9CgoJZnVuY3Rpb24gY2hhbmdlRGl2aWRlbnRDb250cmFjdChhZGRyZXNzIG5ld19jb250cmFjdCkgaXNNYW5hZ2VyIGV4dGVybmFsCgl7CgkJaWYobmV3X2NvbnRyYWN0IT1hZGRyZXNzKDB4MCkpIHRocm93OwoJCWRpdmlkZW50X2NvbnRyYWN0ID0gbmV3X2NvbnRyYWN0OwoJfQoKCWZ1bmN0aW9uIG5ld0Nvc3RUb2tlbih1aW50MjU2IG5ld19jb3N0KQlpc01hbmFnZXIgZXh0ZXJuYWwKCXsKCQlpZihuZXdfY29zdCA9PSAwKSB0aHJvdzsKCQljb3N0T2ZPbmVUb2tlbiA9IG5ld19jb3N0OwoJfQoKCWZ1bmN0aW9uIGdldENvc3RUb2tlbigpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnModWludDI1NikKCXsKCQlyZXR1cm4gY29zdE9mT25lVG9rZW47Cgl9CgoJZnVuY3Rpb24gYWRkTmV3R2FtZShhZGRyZXNzIG5ld19nYW1lKSBpc01hbmFnZXIgZXh0ZXJuYWwKCXsKCQlpZihuZXdfZ2FtZSA9PSBhZGRyZXNzKDB4MCkpIHRocm93OwoJCWxpc3RHYW1lc1tuZXdfZ2FtZV0gPSBnYW1lc0RhdGEodHJ1ZSk7CgkJYWRkckdhbWVzLnB1c2gobmV3X2dhbWUpOwoJfQoKCWZ1bmN0aW9uIGRlbGV0ZUdhbWUoYWRkcmVzcyBnYW1lKSBpc01hbmFnZXIgZXh0ZXJuYWwKCXsKCQlpZihnYW1lID09IGFkZHJlc3MoMHgwKSkgdGhyb3c7CgkJaWYobGlzdEdhbWVzW2dhbWVdLmluaXQpewoJCQlsaXN0R2FtZXNbZ2FtZV0uaW5pdCA9IGZhbHNlOwoJCX0KCX0KCglmdW5jdGlvbiBhZGRVc2VyVG9MaXN0KGFkZHJlc3MgdXNlcikgaW50ZXJuYWwgewoJCWlmKCFfYmFsYW5jZXNbdXNlcl0uaW5pdCl7CgkJCWxpc3RBZGRySG9sZGVycy5wdXNoKHVzZXIpOwoJCX0KCX0KCiAgICBmdW5jdGlvbiBnZXRMaXN0QWRkcmVzc0hvbGRlcnMoKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3NbXSl7CiAgICAgICAgcmV0dXJuIGxpc3RBZGRySG9sZGVyczsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb3VudEhvbGRlcnMoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiBsaXN0QWRkckhvbGRlcnMubGVuZ3RoOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEl0ZW1Ib2xkZXJzKHVpbnQyNTYgaW5kZXgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcyl7CiAgICAgICAgaWYoaW5kZXggPj0gbGlzdEFkZHJIb2xkZXJzLmxlbmd0aCkgcmV0dXJuIGFkZHJlc3MoMHgwKTsKICAgICAgICBlbHNlIHJldHVybiBsaXN0QWRkckhvbGRlcnNbaW5kZXhdOwogICAgfQoKCWZ1bmN0aW9uIGdhbWVMaXN0T2YoIGFkZHJlc3Mgd2hvICkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCB2YWx1ZSkgewoJCWdhbWVzRGF0YSBnYW1lX2RhdGEgPSBsaXN0R2FtZXNbd2hvXTsKCQlyZXR1cm4gZ2FtZV9kYXRhLmluaXQ7Cgl9CgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIFRva2VucyBGdW5jdGlvbnMKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwoKICAgIGZ1bmN0aW9uIHN0b3BPcGVyYXRpb24oKSBpc01hbmFnZXIgZXh0ZXJuYWwgewoJCXN0b3Bfb3BlcmF0aW9uID0gdHJ1ZTsKCX0KCglmdW5jdGlvbiBzdGFydE9wZXJhdGlvbigpIGlzTWFuYWdlciBleHRlcm5hbCB7CgkJc3RvcF9vcGVyYXRpb24gPSBmYWxzZTsKCX0KCglmdW5jdGlvbiBpc09wZXJhdGlvbkJsb2NrZWQoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsKCQlyZXR1cm4gc3RvcF9vcGVyYXRpb247Cgl9CgoJZnVuY3Rpb24gaXNPcGVyYXRpb25BbGxvd2VkKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7CgkJcmV0dXJuICFzdG9wX29wZXJhdGlvbjsKCX0KCglmdW5jdGlvbiBydW5JQ08oKSBpc01hbmFnZXIgZXh0ZXJuYWwgewoJCWVuYWJsZUlDTyA9IHRydWU7CgkJc3RvcF9vcGVyYXRpb24gPSB0cnVlOwoJfQoKCWZ1bmN0aW9uIHN0b3BJQ08oKSBpc01hbmFnZXIgZXh0ZXJuYWwgewoJCWVuYWJsZUlDTyA9IGZhbHNlOwoJCXN0b3Bfb3BlcmF0aW9uID0gZmFsc2U7Cgl9CgoJZnVuY3Rpb24gaW5mb0lDTygpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpewoJCXJldHVybiBlbmFibGVJQ087Cgl9CgoJZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSkgewoJCXJldHVybiBfc3VwcGx5OwoJfQoKCWZ1bmN0aW9uIGluaXRDb3VudFRva2VucygpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgaW5pdF9jb3VudCkgewoJCXJldHVybiBfaW5pdF9jb3VudF90b2tlbnM7Cgl9CgoJLyoqCiAgICAqICBiYWxhbmNlT2YoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIGNoZWNrIGNvbmNyZXRlIHRva2VucyBiYWxhbmNlCiAgICAqCiAgICAqICBAcGFyYW0gd2hvIC0gYWNjb3VudCBvd25lcgogICAgKgogICAgKiAgQHJldHVybiB0aGUgdmFsdWUgb2YgYmFsYW5jZQogICAgKi8KCWZ1bmN0aW9uIGJhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHZhbHVlKSB7CgkJcmV0dXJuIF9iYWxhbmNlc1t3aG9dLnRva2Vuc19jb3VudDsKCX0KCgkvKioKICAgICoKICAgICogYWxsb3dhbmNlKCkgLSBjb25zdGFudCBmdW5jdGlvbiB0byBjaGVjayBob3cgbXVjaCBpcwogICAgKiAgICAgICAgICAgICAgIHBlcm1pdHRlZCB0byBzcGVuZCB0byAzcmQgcGVyc29uIGZyb20gb3duZXIgYmFsYW5jZQogICAgKgogICAgKiAgQHBhcmFtIG93bmVyICAgLSBvd25lciBvZiB0aGUgYmFsYW5jZQogICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJtaXR0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uCiAgICAqCiAgICAqICBAcmV0dXJuIC0gcmVtYWluaW5nIHJpZ2h0IHRvIHNwZW5kCiAgICAqCiAgICAqLwoJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBfYWxsb3dhbmNlKSB7CgkJcmV0dXJuIF9hcHByb3ZhbHNbb3duZXJdW3NwZW5kZXJdOwoJfQoKCglmdW5jdGlvbiBzYWZlVG9BZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKCQkvLyBvdmVyZmxvdyBjaGVjawoJCXJldHVybiAoYSArIGIgPj0gYSAmJiBhICsgYiA+PSBiKTsKCX0KCgkvKioKICAgICogdHJhbnNmZXIoKSAtIHRyYW5zZmVyIHRva2VucyBmcm9tIG1zZy5zZW5kZXIgYmFsYW5jZQogICAgKiAgICAgICAgICAgICAgdG8gcmVxdWVzdGVkIGFjY291bnQKICAgICoKICAgICogIEBwYXJhbSB0byAgICAtIHRhcmdldCBhZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VucwogICAgKiAgQHBhcmFtIHZhbHVlIC0gYW1tb3VudCBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICoKICAgICogIEByZXR1cm4gLSBzdWNjZXNzIC8gZmFpbHVyZSBvZiB0aGUgdHJhbnNhY3Rpb24KICAgICovCglmdW5jdGlvbiB0cmFuc2ZlciggYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewoJCWlmKHRoaXMuaXNPcGVyYXRpb25CbG9ja2VkKCkpIHRocm93OwoKCQlpZiggX2JhbGFuY2VzW21zZy5zZW5kZXJdLnRva2Vuc19jb3VudCA8IHZhbHVlICkgewoJCSAgICB0aHJvdzsKCQl9CgkJaWYoICFzYWZlVG9BZGQoX2JhbGFuY2VzW3RvXS50b2tlbnNfY291bnQsIHZhbHVlKSApIHsKCQkgICAgdGhyb3c7CgkJfQoKCQlfYmFsYW5jZXNbbXNnLnNlbmRlcl0udG9rZW5zX2NvdW50IC09IHZhbHVlOwoJCWlmKF9iYWxhbmNlc1t0b10uaW5pdCl7CgkJCV9iYWxhbmNlc1t0b10udG9rZW5zX2NvdW50ICs9IHZhbHVlOwoJCX0KCQllbHNlewoJCQlhZGRVc2VyVG9MaXN0KHRvKTsKCQkJX2JhbGFuY2VzW3RvXSA9IGhvbGRlckRhdGEodmFsdWUsIHRydWUpOwoJCX0KCgkJVHJhbnNmZXIoIG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSApOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgogICAgKiB0cmFuc2ZlckZyb20oKSAtIHVzZWQgdG8gbW92ZSBhbGxvd2VkIGZ1bmRzIGZyb20gb3RoZXIgb3duZXIKICAgICogICAgICAgICAgICAgICAgICBhY2NvdW50CiAgICAqCiAgICAqICBAcGFyYW0gZnJvbSAgLSBtb3ZlIGZ1bmRzIGZyb20gYWNjb3VudAogICAgKiAgQHBhcmFtIHRvICAgIC0gbW92ZSBmdW5kcyB0byBhY2NvdW50CiAgICAqICBAcGFyYW0gdmFsdWUgLSBtb3ZlIHRoZSB2YWx1ZQogICAgKgogICAgKiAgQHJldHVybiAtIHJldHVybiB0cnVlIG9uIHN1Y2Nlc3MgZmFsc2Ugb3RoZXJ3aXNlCiAgICAqLwoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spIAoJewoJCWlmKHRoaXMuaXNPcGVyYXRpb25CbG9ja2VkKCkpIHRocm93OwoKCQlpZiggX2JhbGFuY2VzW2Zyb21dLnRva2Vuc19jb3VudCA8IHZhbHVlICkgewoJCSAgICB0aHJvdzsKCQl9CgkJCgkJaWYoIF9hcHByb3ZhbHNbZnJvbV1bbXNnLnNlbmRlcl0gPCB2YWx1ZSApIHsKCQkgICAgdGhyb3c7CgkJfQoJCWlmKCAhc2FmZVRvQWRkKF9iYWxhbmNlc1t0b10udG9rZW5zX2NvdW50LCB2YWx1ZSkgKSB7CgkJICAgIHRocm93OwoJCX0KCQkvLyB0cmFuc2ZlciBhbmQgcmV0dXJuIHRydWUKCQlfYXBwcm92YWxzW2Zyb21dW21zZy5zZW5kZXJdIC09IHZhbHVlOwoJCV9iYWxhbmNlc1tmcm9tXS50b2tlbnNfY291bnQgLT0gdmFsdWU7CgkJaWYoX2JhbGFuY2VzW3RvXS5pbml0KXsKCQkJX2JhbGFuY2VzW3RvXS50b2tlbnNfY291bnQgKz0gdmFsdWU7CgkJfQoJCWVsc2V7CgkJCWFkZFVzZXJUb0xpc3QodG8pOwoJCQlfYmFsYW5jZXNbdG9dID0gaG9sZGVyRGF0YSh2YWx1ZSwgdHJ1ZSk7CgkJfQkJCgkJCgkJVHJhbnNmZXIoIGZyb20sIHRvLCB2YWx1ZSApOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgogICAgICoKICAgICAqIGFwcHJvdmUoKSAtIGZ1bmN0aW9uIGFwcHJvdmVzIHRvIGEgcGVyc29uIHRvIHNwZW5kIHNvbWUgdG9rZW5zIGZyb20KICAgICAqICAgICAgICAgICBvd25lciBiYWxhbmNlLgogICAgICoKICAgICAqICBAcGFyYW0gc3BlbmRlciAtIHBlcnNvbiB3aG9tIHRoaXMgcmlnaHQgYmVlbiBncmFudGVkLgogICAgICogIEBwYXJhbSB2YWx1ZSAgIC0gdmFsdWUgdG8gc3BlbmQuCiAgICAgKgogICAgICogIEByZXR1cm4gdHJ1ZSBpbiBjYXNlIG9mIHN1Y2Nlc3MsIG90aGVyd2lzZSBmYWlsdXJlCiAgICAgKgogICAgICovCglmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgCgl7CgkJaWYodGhpcy5pc09wZXJhdGlvbkJsb2NrZWQoKSkgdGhyb3c7CgoJCV9hcHByb3ZhbHNbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKCQlBcHByb3ZhbCggbXNnLnNlbmRlciwgc3BlbmRlciwgdmFsdWUgKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglldmVudCBFbWlzc2lvbihhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYmV0LCB1aW50MjU2IGNvZWYsIHVpbnQyNTYgZGVjaW1hbHMsIHVpbnQyNTYgY29zdF90b2tlbik7CgoJLyoqCiAgICAqCiAgICAqICBlbWlzc2lvbigpIC0gZW1pc3Npb24gb2YgdG9rZW5zIGluaXRpYXRlZCBieSB0aGUgZ2FtZSBjb250cmFjdC4KICAgICoKICAgICogIEBwYXJhbSBwbGF5ZXIgICAgICAgLSBwbGF5ZXIncyBhZGRyZXNzLgogICAgKiAgQHBhcmFtIHBhcnRuZXIgICAgICAtIGFmZmlsaWF0ZSdzIGFkZHJlc3MuCiAgICAqICBAcGFyYW0gdmFsdWVfYmV0ICAgIC0gcGxheWVyJ3MgYmV0IHZhbHVlLgogICAgKiAgQHBhcmFtIGNvZWZfcGxheWVyICAtIHBsYXllcidzIGNvZWZmaWNpZW50IGVtaXNzaW9uLgogICAgKiAgQHBhcmFtIGNvZWZfcGFydG5lciAtIGFmZmlsaWF0ZSdzIGNvZWZmaWNpZW50IGVtaXNzaW9uLgogICAgKgogICAgKiAgQHJldHVybiAodHJ1ZSwgMCkgaW4gY2FzZSBvZiBzdWNjZXNzLCBvdGhlcndpc2UgKEZhbHNlLCBlcnJvcl9jb2RlKQogICAgKgogICAgKgogICAgKiAgRXJyb3IgY29kZSAxIC0gb3BlcmF0aW9uIHN0b3BlZAogICAgKiAgRXJyb3IgY29kZSAyIC0gc2VuZGVyIGFkZHJlc3MgaXMgbm90IGluIGdhbWVzIGxpc3QKICAgICogIEVycm9yIGNvZGUgMyAtIGluY29ycmVjdCBwbGF5ZXIncyBhZGRyZXNzCiAgICAqICBFcnJvciBjb2RlIDQgLSBpbmNvcnJlY3QgdmFsdWUgYmV0CiAgICAqICBFcnJvciBjb2RlIDUgLSBpbmNvcnJlY3QgZW1pc3Npb24gY29lZmZpY2llbnQKICAgICovCglmdW5jdGlvbiBlbWlzc2lvbihhZGRyZXNzIHBsYXllciwgYWRkcmVzcyBwYXJ0bmVyLCB1aW50MjU2IHZhbHVlX2JldCwgdWludDI1NiBjb2VmX3BsYXllciwgdWludDI1NiBjb2VmX3BhcnRuZXIpIGV4dGVybmFsIHJldHVybnModWludDI1NiwgdWludDgpIHsKICAgICAgICBpZih0aGlzLmlzT3BlcmF0aW9uQmxvY2tlZCgpKSByZXR1cm4gKDAsIDEpOwoKICAgICAgICBpZihsaXN0R2FtZXNbbXNnLnNlbmRlcl0uaW5pdCA9PSBmYWxzZSkgcmV0dXJuICgwLCAyKTsKICAgICAgICBpZihwbGF5ZXIgPT0gYWRkcmVzcygweDApKSByZXR1cm4gKDAsIDMpOwogICAgICAgIGlmKHZhbHVlX2JldCA9PSAwIHx8IHZhbHVlX2JldCA+IG1heF92YWx1ZV9iZXQpIHJldHVybiAoMCwgNCk7CiAgICAgICAgaWYoY29lZl9wbGF5ZXIgPiBtYXhfY29lZl9wbGF5ZXIgfHwgY29lZl9wYXJ0bmVyID4gbWF4X2NvZWZfcGFydG5lcikgcmV0dXJuICgwLCA1KTsKCgkJdWludDI1NiBkZWNpbWFsc190b2tlbiA9IDEwKip1aW50MjU2KGRlY2ltYWxzKTsKCgkJdWludDI1NiBwbGF5ZXJfdG9rZW4gPSAoKHZhbHVlX2JldCpjb2VmX3BsYXllcipkZWNpbWFsc190b2tlbikvMTAwMDApL2Nvc3RPZk9uZVRva2VuOwoJCWlmKF9iYWxhbmNlc1twbGF5ZXJdLmluaXQpewoJCQlfYmFsYW5jZXNbcGxheWVyXS50b2tlbnNfY291bnQgKz0gcGxheWVyX3Rva2VuOwoJCX0KCQllbHNlewoJCQlhZGRVc2VyVG9MaXN0KHBsYXllcik7CgkJCV9iYWxhbmNlc1twbGF5ZXJdID0gaG9sZGVyRGF0YShwbGF5ZXJfdG9rZW4sIHRydWUpOwoJCX0KCQlFbWlzc2lvbihwbGF5ZXIsIHBsYXllcl90b2tlbiwgdmFsdWVfYmV0LCBjb2VmX3BsYXllciwgZGVjaW1hbHNfdG9rZW4sIGNvc3RPZk9uZVRva2VuKTsKCgkJdWludDI1NiBwYXJ0bmVyX3Rva2VuID0gMDsKCQlpZihwYXJ0bmVyICE9IGFkZHJlc3MoMHgwKSl7CgkJCXBhcnRuZXJfdG9rZW4gPSAoKHZhbHVlX2JldCpjb2VmX3BhcnRuZXIqZGVjaW1hbHNfdG9rZW4pLzEwMDAwKS9jb3N0T2ZPbmVUb2tlbjsKCQkJaWYoX2JhbGFuY2VzW3BhcnRuZXJdLmluaXQpewoJCQkJX2JhbGFuY2VzW3BhcnRuZXJdLnRva2Vuc19jb3VudCArPSBwYXJ0bmVyX3Rva2VuOwoJCQl9CgkJCWVsc2V7CgkJCQlhZGRVc2VyVG9MaXN0KHBhcnRuZXIpOwoJCQkJX2JhbGFuY2VzW3BhcnRuZXJdID0gaG9sZGVyRGF0YShwYXJ0bmVyX3Rva2VuLCB0cnVlKTsKCQkJfQoJCQlFbWlzc2lvbihwYXJ0bmVyLCBwYXJ0bmVyX3Rva2VuLCB2YWx1ZV9iZXQsIGNvZWZfcGFydG5lciwgZGVjaW1hbHNfdG9rZW4sIGNvc3RPZk9uZVRva2VuKTsKCQl9CgoJCV9zdXBwbHkgKz0gKHBsYXllcl90b2tlbitwYXJ0bmVyX3Rva2VuKTsKCgkJcmV0dXJuIChwbGF5ZXJfdG9rZW4sIDApOwoJfQoKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBUZW1wb3JhcnkgVG9rZW5zCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJYWRkcmVzc1tdIGxpc3RBZGRyVGVtcEhvbGRlcnM7CglldmVudCBUZW1wVG9rZW5zU2VuZChhZGRyZXNzIGluZGV4ZWQgcmVjaXBpZW50LCB1aW50MjU2IGNvdW50LCB1aW50MjU2IHN0YXJ0LCB1aW50MjU2IGVuZCk7CgoJLyoqCiAgICAgKgogICAgICogIHNlbmRUZW1wVG9rZW5zKCkgLSBzZW5kaW5nIHRlbXBvcmFyeSB0b2tlbnMgdG8gYWRkcmVzcy4KICAgICAqCiAgICAgKiAgQHBhcmFtIHJlY2lwaWVudCAtIHJlY2lwaWVudCdzIGFkZHJlc3MuCiAgICAgKiAgQHBhcmFtIGNvdW50ICAgICAtIHRlbXBvcmFyeSB0b2tlbnMgYW1vdW50LgogICAgICogIEBwYXJhbSBwZXJpb2QgICAgLSBwZXJpb2Qgb2YgcG9zc2Vzc2lvbiBvZiB0aGUgdG9rZW5zIGluIHNlY29uZHMuCiAgICAgKgogICAgICovCglmdW5jdGlvbiBzZW5kVGVtcFRva2VucyhhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBjb3VudCwgdWludDI1NiBwZXJpb2QpIGlzRGV2ZWxvcGVyIHsKCQlpZih0aGlzLmlzT3BlcmF0aW9uQmxvY2tlZCgpKSB0aHJvdzsKCgkJaWYoY291bnQ9PTAgfHwgcGVyaW9kPT0wKSB0aHJvdzsKCQkKCQl1aW50MjU2IGRlY2ltYWxzX3Rva2VuID0gMTAqKnVpbnQyNTYoZGVjaW1hbHMpOwoJCWNvdW50ID0gY291bnQqZGVjaW1hbHNfdG9rZW47CgoJCWlmKF9iYWxhbmNlc1tmb25kX3dhbGxldF0udG9rZW5zX2NvdW50IDwgY291bnQpIHRocm93OwoJCWlmKF90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS50b2tlbnNfY291bnQgPiAwKSB0aHJvdzsKCgkJaWYoIV90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS5pbml0KXsKCQkJX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdID0gdGVtcEhvbGRlckRhdGEoY291bnQsIG5vdywgbm93ICsgcGVyaW9kLCB0cnVlKTsKCQkJbGlzdEFkZHJUZW1wSG9sZGVycy5wdXNoKHJlY2lwaWVudCk7CgkJfQoJCWVsc2V7CgkJCV90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS50b2tlbnNfY291bnQgPSBjb3VudDsKCQkJX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdLnN0YXJ0X2RhdGUgPSBub3c7CgkJCV90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS5lbmRfZGF0ZSA9IG5vdyArIHBlcmlvZDsKCQl9CgkJX2JhbGFuY2VzW2ZvbmRfd2FsbGV0XS50b2tlbnNfY291bnQgLT0gY291bnQ7CgkJVGVtcFRva2Vuc1NlbmQocmVjaXBpZW50LCBjb3VudCwgX3RlbXBfYmFsYW5jZVtyZWNpcGllbnRdLnN0YXJ0X2RhdGUsIF90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS5lbmRfZGF0ZSk7Cgl9CgoJZnVuY3Rpb24gdGVtcFRva2Vuc0JhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CgkJaWYoX3RlbXBfYmFsYW5jZVt3aG9dLmVuZF9kYXRlIDwgbm93KSByZXR1cm4gMDsKCQllbHNlIHJldHVybiBfdGVtcF9iYWxhbmNlW3dob10udG9rZW5zX2NvdW50OwoJfQoKCWZ1bmN0aW9uIHRlbXBUb2tlbnNQZXJpb2RPZiggYWRkcmVzcyB3aG8gKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CgkJaWYoX3RlbXBfYmFsYW5jZVt3aG9dLmVuZF9kYXRlIDwgbm93KSByZXR1cm4gMDsKCQllbHNlIHJldHVybiBfdGVtcF9iYWxhbmNlW3dob10uZW5kX2RhdGU7Cgl9CgoJLyoqCiAgICAgKgogICAgICogIHJldHVyblRlbXBUb2tlbnMoKSAtIHJldHVybiBvZiB0ZW1wb3JhcnkgdG9rZW5zIGFmdGVyIHRoZSBleHBpcmF0aW9uIG9mIHBvc3Nlc3Npb24gdGltZS4KICAgICAqCiAgICAgKiAgQHBhcmFtIHJlY2lwaWVudCAtIHRlbXBvcmFyeSB0b2tlbiBob2xkZXIgYWRkcmVzcy4KICAgICAqCiAgICAgKi8KCWZ1bmN0aW9uIHJldHVyblRlbXBUb2tlbnMoYWRkcmVzcyByZWNpcGllbnQpIGlzRGV2ZWxvcGVyIHsKCQlpZih0aGlzLmlzT3BlcmF0aW9uQmxvY2tlZCgpKSB0aHJvdzsKCQkKCQlpZihfdGVtcF9iYWxhbmNlW3JlY2lwaWVudF0udG9rZW5zX2NvdW50ID09IDApIHRocm93OwoKCQlfYmFsYW5jZXNbZm9uZF93YWxsZXRdLnRva2Vuc19jb3VudCArPSBfdGVtcF9iYWxhbmNlW3JlY2lwaWVudF0udG9rZW5zX2NvdW50OwoJCV90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS50b2tlbnNfY291bnQgPSAwOwoJCV90ZW1wX2JhbGFuY2VbcmVjaXBpZW50XS5zdGFydF9kYXRlID0gMDsKCQlfdGVtcF9iYWxhbmNlW3JlY2lwaWVudF0uZW5kX2RhdGUgPSAwOwoJfQoKCWZ1bmN0aW9uIGdldExpc3RUZW1wSG9sZGVycygpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzc1tdKXsKCQlyZXR1cm4gbGlzdEFkZHJUZW1wSG9sZGVyczsKCX0KCglmdW5jdGlvbiBnZXRDb3VudFRlbXBIb2xkZXJzKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KXsKCQlyZXR1cm4gbGlzdEFkZHJUZW1wSG9sZGVycy5sZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0SXRlbVRlbXBIb2xkZXJzKHVpbnQyNTYgaW5kZXgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcyl7CgkJaWYoaW5kZXggPj0gbGlzdEFkZHJUZW1wSG9sZGVycy5sZW5ndGgpIHJldHVybiBhZGRyZXNzKDB4MCk7CgkJZWxzZSByZXR1cm4gbGlzdEFkZHJUZW1wSG9sZGVyc1tpbmRleF07Cgl9CgoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIEludmVzdCBGdW5jdGlvbnMKCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoJZnVuY3Rpb24oKSBwYXlhYmxlCgl7CQoJCWlmKHRoaXMuaXNPcGVyYXRpb25CbG9ja2VkKCkpIHRocm93OwoJCWlmKG1zZy5zZW5kZXIgPT0gZGV2ZWxvcGVyKSB0aHJvdzsKCQlpZihtc2cuc2VuZGVyID09IG1hbmFnZXIpIHRocm93OwoJCWlmKG1zZy5zZW5kZXIgPT0gZGV2ZWxvcGVyX3dhbGxldCkgdGhyb3c7CgkJaWYobXNnLnNlbmRlciA9PSB3YWxsZXRfSUNPKSB0aHJvdzsKCQlpZihtc2cuc2VuZGVyID09IGZvbmRfd2FsbGV0KSB0aHJvdzsKCgkJaWYobGlzdEdhbWVzW21zZy5zZW5kZXJdLmluaXQpIHRocm93OwoKCQlpZihlbmFibGVJQ08gPT0gZmFsc2UpIHRocm93OwoJCQkKCQlpZihtc2cudmFsdWUgPCBtaW5fdmFsdWVfYnV5VG9rZW4pIHRocm93OwoJCQoJCXVpbnQyNTYgdmFsdWVfc2VuZCA9IG1zZy52YWx1ZTsKCQlpZih2YWx1ZV9zZW5kID4gbWF4X3ZhbHVlX2J1eVRva2VuKXsKCQkJdmFsdWVfc2VuZCA9IG1heF92YWx1ZV9idXlUb2tlbjsKCQkJaWYobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZS1tYXhfdmFsdWVfYnV5VG9rZW4pPT1mYWxzZSkgdGhyb3c7CgkJfQoKCQl1aW50MjU2IGRlY2ltYWxzX3Rva2VuID0gMTAqKnVpbnQyNTYoZGVjaW1hbHMpOwoJCQoJCXVpbnQyNTYgY291bnRfdG9rZW5zID0gKHZhbHVlX3NlbmQqZGVjaW1hbHNfdG9rZW4pL2Nvc3RPZk9uZVRva2VuOwoJCQoJCWlmKGNvdW50X3Rva2VucyA+X2JhbGFuY2VzW3dhbGxldF9JQ09dLnRva2Vuc19jb3VudCApewoJCQljb3VudF90b2tlbnMgPSBfYmFsYW5jZXNbd2FsbGV0X0lDT10udG9rZW5zX2NvdW50OwoJCX0KCQlpZih2YWx1ZV9zZW5kID4gKGNvdW50X3Rva2Vucypjb3N0T2ZPbmVUb2tlbikvZGVjaW1hbHNfdG9rZW4pewkJCQkKCQkJaWYobXNnLnNlbmRlci5zZW5kKHZhbHVlX3NlbmQtKChjb3VudF90b2tlbnMqY29zdE9mT25lVG9rZW4pL2RlY2ltYWxzX3Rva2VuKSk9PWZhbHNlKSB0aHJvdzsKCQkJdmFsdWVfc2VuZCA9IChjb3VudF90b2tlbnMqY29zdE9mT25lVG9rZW4pL2RlY2ltYWxzX3Rva2VuOwoJCX0KCgkJaWYoIV9iYWxhbmNlc1ttc2cuc2VuZGVyXS5pbml0KXsKCQkJaWYgKF9iYWxhbmNlc1t3YWxsZXRfSUNPXS50b2tlbnNfY291bnQgPCBjb3VudF90b2tlbnMpIHRocm93OwoJCQlhZGRVc2VyVG9MaXN0KG1zZy5zZW5kZXIpOwoJCQlfYmFsYW5jZXNbd2FsbGV0X0lDT10udG9rZW5zX2NvdW50IC09IGNvdW50X3Rva2VuczsKCQkJX2JhbGFuY2VzW21zZy5zZW5kZXJdID0gaG9sZGVyRGF0YShjb3VudF90b2tlbnMsIHRydWUpOwoJCX0KCQllbHNlewoJCQlpZigoKF9iYWxhbmNlc1ttc2cuc2VuZGVyXS50b2tlbnNfY291bnQqY29zdE9mT25lVG9rZW4pL2RlY2ltYWxzX3Rva2VuKSsoKGNvdW50X3Rva2Vucypjb3N0T2ZPbmVUb2tlbikvZGVjaW1hbHNfdG9rZW4pPm1heF92YWx1ZV9idXlUb2tlbikgewoJCQkJY291bnRfdG9rZW5zID0gKChtYXhfdmFsdWVfYnV5VG9rZW4qZGVjaW1hbHNfdG9rZW4pL2Nvc3RPZk9uZVRva2VuKS1fYmFsYW5jZXNbbXNnLnNlbmRlcl0udG9rZW5zX2NvdW50OwkJCQkJCgkJCQlpZihtc2cuc2VuZGVyLnNlbmQodmFsdWVfc2VuZC0oKGNvdW50X3Rva2Vucypjb3N0T2ZPbmVUb2tlbikvZGVjaW1hbHNfdG9rZW4pKT09ZmFsc2UpIHRocm93OwoJCQkJdmFsdWVfc2VuZCA9IChjb3VudF90b2tlbnMqY29zdE9mT25lVG9rZW4pL2RlY2ltYWxzX3Rva2VuOwoJCQl9CgoJCQlpZiAoX2JhbGFuY2VzW3dhbGxldF9JQ09dLnRva2Vuc19jb3VudCA8IGNvdW50X3Rva2VucykgdGhyb3c7CgkJCV9iYWxhbmNlc1t3YWxsZXRfSUNPXS50b2tlbnNfY291bnQgLT0gY291bnRfdG9rZW5zOwoJCQlfYmFsYW5jZXNbbXNnLnNlbmRlcl0udG9rZW5zX2NvdW50ICs9IGNvdW50X3Rva2VuczsKCQl9CgoJCWlmKHZhbHVlX3NlbmQ+MCl7CgkJCWlmKHdhbGxldF9JQ08uc2VuZCh2YWx1ZV9zZW5kKT09ZmFsc2UpIHRocm93OwoJCX0KCgkJaWYoY291bnRfdG9rZW5zPjApewoJCQlUb2tlbkJ1eShtc2cuc2VuZGVyLCBjb3VudF90b2tlbnMpOwoJCX0KCgkJaWYoX2JhbGFuY2VzW3dhbGxldF9JQ09dLnRva2Vuc19jb3VudCA9PSAwKXsKCQkJZW5hYmxlSUNPID0gZmFsc2U7CgkJfQoJfQp9'.
	

]
