Class {
	#name : #SRTa76ea481aebdd5703e476cfcb2315d4e014232c1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa76ea481aebdd5703e476cfcb2315d4e014232c1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Cgpjb250cmFjdCBKOFRUb2tlbkNvbmZpZyB7CiAgICAvLyBUaGUgSjhUIGRlY2ltYWxzCiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgVE9LRU5fREVDSU1BTFMgPSA4OwoKICAgIC8vIFRoZSBKOFQgZGVjaW1hbCBmYWN0b3IgdG8gb2J0YWluIGx1Y2t5cwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSjhUX0RFQ0lNQUxTX0ZBQ1RPUiA9IDEwKip1aW50MjU2KFRPS0VOX0RFQ0lNQUxTKTsKfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBCdXJuYWJsZSBUb2tlbgogKiBAZGV2IFRva2VuIHRoYXQgY2FuIGJlIGlycmV2ZXJzaWJseSBidXJuZWQgKGRlc3Ryb3llZCkuCiAqLwpjb250cmFjdCBCdXJuYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludDI1NiB2YWx1ZSk7CgogICAgLyoqCiAgICAgKiBAZGV2IEJ1cm5zIGEgc3BlY2lmaWMgYW1vdW50IG9mIHRva2Vucy4KICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSBidXJuZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKCiAgICAgICAgYWRkcmVzcyBidXJuZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGJhbGFuY2VzW2J1cm5lcl0gPSBiYWxhbmNlc1tidXJuZXJdLnN1YihfdmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CiAgICAgICAgQnVybihidXJuZXIsIF92YWx1ZSk7CiAgICB9Cn0KCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gQHRpdGxlIEo4VCBUb2tlbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLwovLyBAZGV2IEVSQzIwIEo4VCBUb2tlbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vCi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8KLy8gSjhUIFRva2VucyBhcmUgZGl2aXNpYmxlIGJ5IDFlOCAoMTAwLDAwMCwwMDApIGJhc2UgICAgICAgICAgICAgICAvLwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vCi8vIEo4VCBhcmUgZGlzcGxheWVkIHVzaW5nIDggZGVjaW1hbCBwbGFjZXMgb2YgcHJlY2lzaW9uLiAgICAgICAgICAgLy8KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLwovLyAxIEo4VCBpcyBlcXVpdmFsZW50IHRvIDEwMDAwMDAwMCBsdWNreXM6ICAgICAgICAgICAgICAgICAgICAgICAgIC8vCi8vICAgMTAwMDAwMDAwID09IDEgKiAxMCoqOCA9PSAxZTggPT0gT25lIEh1bmRyZWQgTWlsbGlvbiBsdWNreXMgICAgLy8KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLwovLyAxLDUgQmlsbGlvbiBKOFQgKHRvdGFsIHN1cHBseSkgaXMgZXF1aXZhbGVudCB0bzogICAgICAgICAgICAgICAgIC8vCi8vICAgMTUwMDAwMDAwMDAwMDAwMDAwID09IDE1MDAwMDAwMDAgKiAxMCoqOCA9PSAxLDVlMTcgbHVja3lzICAgICAgLy8KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgpjb250cmFjdCBKOFRUb2tlbiBpcyBKOFRUb2tlbkNvbmZpZywgQnVybmFibGVUb2tlbiwgT3duYWJsZSB7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgICAgICAgICAgICA9ICJKOFQgVG9rZW4iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgICAgICAgICAgPSAiSjhUIjsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzICAgICAgID0gVE9LRU5fREVDSU1BTFM7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBJTklUSUFMX1NVUFBMWSA9IDE1MDAwMDAwMDAgKiAoMTAgKiogdWludDI1NihkZWNpbWFscykpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwoKICAgIGZ1bmN0aW9uIEo4VFRva2VuKCkgewogICAgICAgIHRvdGFsU3VwcGx5ID0gSU5JVElBTF9TVVBQTFk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBJTklUSUFMX1NVUFBMWTsKCiAgICAgICAgLy9odHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC5tZCN0cmFuc2Zlci0xCiAgICAgICAgLy9FSVAgMjA6IEEgdG9rZW4gY29udHJhY3Qgd2hpY2ggY3JlYXRlcyBuZXcgdG9rZW5zIFNIT1VMRCB0cmlnZ2VyIGEKICAgICAgICAvL1RyYW5zZmVyIGV2ZW50IHdpdGggdGhlIF9mcm9tIGFkZHJlc3Mgc2V0IHRvIDB4MAogICAgICAgIC8vd2hlbiB0b2tlbnMgYXJlIGNyZWF0ZWQuCiAgICAgICAgVHJhbnNmZXIoMHgwLCBtc2cuc2VuZGVyLCBJTklUSUFMX1NVUFBMWSk7CiAgICAgfQp9CgoKY29udHJhY3QgQUNMTWFuYWdlZCBpcyBPd25hYmxlIHsKICAgIAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBBQ0xNYW5hZ2VkIFBST1BFUlRJRVMgLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vIFRoZSBvcGVyYXRpb25hbCBhY2wgYWRkcmVzcwogICAgYWRkcmVzcyBwdWJsaWMgb3BzQWRkcmVzczsKCiAgICAvLyBUaGUgYWRtaW4gYWNsIGFkZHJlc3MKICAgIGFkZHJlc3MgcHVibGljIGFkbWluQWRkcmVzczsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBBQ0xNYW5hZ2VkIEZVTkNUSU9OUyBhbmQgTU9ESUZJRVJTIC8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gQUNMTWFuYWdlZCgpIHB1YmxpYyBPd25hYmxlKCkge30KCiAgICAvLyBVcGRhdGVzIHRoZSBvcHNBZGRyZXNzIHByb3BldHkgd2l0aCB0aGUgbmV3IF9vcHNBZGRyZXNzIHZhbHVlCiAgICBmdW5jdGlvbiBzZXRPcHNBZGRyZXNzKGFkZHJlc3MgX29wc0FkZHJlc3MpIGV4dGVybmFsIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfb3BzQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9vcHNBZGRyZXNzICE9IGFkZHJlc3ModGhpcykpOwoKICAgICAgICBvcHNBZGRyZXNzID0gX29wc0FkZHJlc3M7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgYWRtaW5BZGRyZXNzIHByb3BldHkgd2l0aCB0aGUgbmV3IF9hZG1pbkFkZHJlc3MgdmFsdWUKICAgIGZ1bmN0aW9uIHNldEFkbWluQWRkcmVzcyhhZGRyZXNzIF9hZG1pbkFkZHJlc3MpIGV4dGVybmFsIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfYWRtaW5BZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2FkbWluQWRkcmVzcyAhPSBhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgYWRtaW5BZGRyZXNzID0gX2FkbWluQWRkcmVzczsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvL0NoZWNrcyBpZiBhbiBhZGRyZXNzIGlzIG93bmVyCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHJlc3VsdCA9IChfYWRkcmVzcyA9PSBvd25lcik7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvL0NoZWNrcyBpZiBhbiBhZGRyZXNzIGlzIG9wZXJhdG9yCiAgICBmdW5jdGlvbiBpc09wcyhhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCByZXN1bHQgPSAoX2FkZHJlc3MgPT0gb3BzQWRkcmVzcyk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvL0NoZWNrcyBpZiBhbiBhZGRyZXNzIGlzIG9wcyBvciBhZG1pbgogICAgZnVuY3Rpb24gaXNPcHNPckFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHJlc3VsdCA9IChfYWRkcmVzcyA9PSBvcHNBZGRyZXNzIHx8IF9hZGRyZXNzID09IGFkbWluQWRkcmVzcyk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvL0NoZWNrcyBpZiBhbiBhZGRyZXNzIGlzIG9wcyxvd25lciBvciBhZG1pbgogICAgZnVuY3Rpb24gaXNPd25lck9yT3BzT3JBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCByZXN1bHQgPSAoX2FkZHJlc3MgPT0gb3BzQWRkcmVzcyB8fCBfYWRkcmVzcyA9PSBhZG1pbkFkZHJlc3MgfHwgX2FkZHJlc3MgPT0gb3duZXIpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy9DaGVja3Mgd2hldGhlciB0aGUgbXNnLnNlbmRlciBhZGRyZXNzIGlzIGVxdWFsIHRvIHRoZSBhZG1pbkFkZHJlc3MgcHJvcGVydHkgb3Igbm90CiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgLy9OZWVkcyB0byBiZSBzZXQuIERlZmF1bHQgY29uc3RydWN0b3Igd2lsbCBzZXQgMHgwOwogICAgICAgIGFkZHJlc3MgX2FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyA9PSBhZG1pbkFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gQ2hlY2tzIHdoZXRoZXIgdGhlIG1zZy5zZW5kZXIgYWRkcmVzcyBpcyBlcXVhbCB0byB0aGUgb3BzQWRkcmVzcyBwcm9wZXJ0eSBvciBub3QKICAgIG1vZGlmaWVyIG9ubHlPcHMoKSB7CiAgICAgICAgLy9OZWVkcyB0byBiZSBzZXQuIERlZmF1bHQgY29uc3RydWN0b3Igd2lsbCBzZXQgMHgwOwogICAgICAgIGFkZHJlc3MgX2FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyA9PSBvcHNBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIENoZWNrcyB3aGV0aGVyIHRoZSBtc2cuc2VuZGVyIGFkZHJlc3MgaXMgZXF1YWwgdG8gdGhlIG9wc0FkZHJlc3Mgb3IgYWRtaW5BZGRyZXNzIHByb3BlcnR5CiAgICBtb2RpZmllciBvbmx5QWRtaW5BbmRPcHMoKSB7CiAgICAgICAgLy9OZWVkcyB0byBiZSBzZXQuIERlZmF1bHQgY29uc3RydWN0b3Igd2lsbCBzZXQgMHgwOwogICAgICAgIGFkZHJlc3MgX2FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyA9PSBvcHNBZGRyZXNzIHx8IF9hZGRyZXNzID09IGFkbWluQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KfQoKY29udHJhY3QgQ3Jvd2RzYWxlQ29uZmlnIGlzIEo4VFRva2VuQ29uZmlnIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vIERlZmF1bHQgc3RhcnQgdG9rZW4gc2FsZSBkYXRlIGlzIDI4dGggRmVicnVhcnkgMTU6MDAgU0dQIDIwMTgKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFNUQVJUX1RJTUVTVEFNUCA9IDE1MTk4MDEyMDA7CgogICAgLy8gRGVmYXVsdCBlbmQgdG9rZW4gc2FsZSBkYXRlIGlzIDE0dGggTWFyY2ggMTU6MDAgU0dQIDIwMTgKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEVORF9USU1FU1RBTVAgICA9IDE1MjEwMTA4MDA7CgogICAgLy8gVGhlIEVUSCBkZWNpbWFsIGZhY3RvciB0byBvYnRhaW4gd2VpcwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgRVRIX0RFQ0lNQUxTX0ZBQ1RPUiA9IDEwKip1aW50MjU2KDE4KTsKCiAgICAvLyBUaGUgdG9rZW4gc2FsZSBzdXBwbHkgCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9TQUxFX1NVUFBMWSA9IDQ1MDAwMDAwMCAqIEo4VF9ERUNJTUFMU19GQUNUT1I7CgogICAgLy8gVGhlIG1pbmltdW0gY29udHJpYnV0aW9uIGFtb3VudCBpbiB3ZWlzCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBNSU5fQ09OVFJJQlVUSU9OX1dFSVMgPSAwLjEgZXRoZXI7CgogICAgLy8gVGhlIG1heGltdW0gY29udHJpYnV0aW9uIGFtb3VudCBpbiB3ZWlzCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBNQVhfQ09OVFJJQlVUSU9OX1dFSVMgPSAxMCBldGhlcjsKCiAgICAvL0BXQVJOSU5HOiBXT1JLSU5HIFdJVEggS0lMTy1NVUxUSVBMRVMgVE8gQVZPSUQgSU1QT1NTSUJMRSBESVZJU0lPTlMgT0YgRkxPQVRJTkcgUE9JTlRTLgogICAgdWludDI1NiBjb25zdGFudCBkb2xsYXJfcGVyX2tpbG9fdG9rZW4gPSAxMDA7IC8vMC4xIGRvbGxhciBwZXIgdG9rZW4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGRvbGxhcnNfcGVyX2tpbG9fZXRoZXIgPSA5MDAwMDA7IC8vOTAwJCBwZXIgZXRoZXIKICAgIC8vVE9LRU5TX1BFUl9FVEhFUiA9IGRvbGxhcnNfcGVyX2V0aGVyIC8gZG9sbGFyX3Blcl90b2tlbgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSU5JVElBTF9UT0tFTlNfUEVSX0VUSEVSID0gZG9sbGFyc19wZXJfa2lsb19ldGhlci5kaXYoZG9sbGFyX3Blcl9raWxvX3Rva2VuKTsKfQoKY29udHJhY3QgTGVkZ2VyIGlzIEFDTE1hbmFnZWQgewogICAgCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTGVkZ2VyIFBST1BFUlRJRVMgLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gVGhlIEFsbG9jYXRpb24gc3RydWN0IHJlcHJlc2VudHMgYSB0b2tlbiBzYWxlIHB1cmNoYXNlCiAgICAvLyBhbW91bnRHcmFudGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAgLy8gaGFzQ2xhaW1lZEJvbnVzVG9rZW5zIHdoZXRoZXIgdGhlIGFsbG9jYXRpb24gaGFzIGJlZW4gYWxyZWR5IGNsYWltZWQKICAgIHN0cnVjdCBBbGxvY2F0aW9uIHsKICAgICAgICB1aW50MjU2IGFtb3VudEdyYW50ZWQ7CiAgICAgICAgdWludDI1NiBhbW91bnRCb251c0dyYW50ZWQ7CiAgICAgICAgYm9vbCBoYXNDbGFpbWVkQm9udXNUb2tlbnM7CiAgICB9CgogICAgLy8gQ29udHJpYnV0aW9uUGhhc2UgZW51bSBjYXNlcyBhcmUKICAgIC8vIFByZVNhbGVDb250cmlidXRpb24sIHRoZSBjb250cmlidXRpb24gaGFzIGJlZW4gbWFkZSBpbiB0aGUgcHJlc2FsZSBwaGFzZQogICAgLy8gUGFydG5lckNvbnRyaWJ1dGlvbiwgdGhlIGNvbnRyaWJ1dGlvbiBoYXMgYmVlbiBtYWRlIGluIHRoZSBwcml2YXRlIHBoYXNlCiAgICBlbnVtIENvbnRyaWJ1dGlvblBoYXNlIHsKICAgICAgICBQcmVTYWxlQ29udHJpYnV0aW9uLCBQYXJ0bmVyQ29udHJpYnV0aW9uCiAgICB9CgogICAgLy8gTWFwIG9mIGFkcmVzc2VzIHRoYXQgcHVyY2hhc2VkIHRva2VucyBvbiB0aGUgcHJlc2FsZSBwaGFzZQogICAgbWFwcGluZyhhZGRyZXNzID0+IEFsbG9jYXRpb24pIHB1YmxpYyBwcmVzYWxlQWxsb2NhdGlvbnM7CgogICAgLy8gTWFwIG9mIGFkcmVzc2VzIHRoYXQgcHVyY2hhc2VkIHRva2VucyBvbiB0aGUgcHJpdmF0ZSBwaGFzZQogICAgbWFwcGluZyhhZGRyZXNzID0+IEFsbG9jYXRpb24pIHB1YmxpYyBwYXJ0bmVyQWxsb2NhdGlvbnM7CgogICAgLy8gUmVmZXJlbmNlIHRvIHRoZSBKOFRUb2tlbiBjb250cmFjdAogICAgSjhUVG9rZW4gcHVibGljIHRva2VuQ29udHJhY3Q7CgogICAgLy8gUmVmZXJlbmNlIHRvIHRoZSBDcm93ZHNhbGUgY29udHJhY3QKICAgIENyb3dkc2FsZSBwdWJsaWMgY3Jvd2RzYWxlQ29udHJhY3Q7CgogICAgLy8gVG90YWwgcHJpdmF0ZSBhbGxvY2F0aW9uLCBjb3VudGluZyB0aGUgYW1vdW50IG9mIHRva2VucyBmcm9tIHRoZQogICAgLy8gcGFydG5lciBhbmQgdGhlIHByZXNhbGUgcGhhc2UKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsUHJpdmF0ZUFsbG9jYXRpb247CgogICAgLy8gV2hldGhlciB0aGUgdG9rZW4gYWxsb2NhdGlvbnMgY2FuIGJlIGNsYWltZWQgb24gdGhlIHBhcnRuZXIgc2FsZSBwaGFzZQogICAgYm9vbCBwdWJsaWMgY2FuQ2xhaW1QYXJ0bmVyVG9rZW5zOwoKICAgIC8vIFdoZXRoZXIgdGhlIHRva2VuIGFsbG9jYXRpb25zIGNhbiBiZSBjbGFpbWVkIG9uIHRoZSBwcmVzYWxlIHNhbGUgcGhhc2UKICAgIGJvb2wgcHVibGljIGNhbkNsYWltUHJlc2FsZVRva2VuczsKCiAgICAvLyBXaGV0aGVyIHRoZSBib251cyB0b2tlbiBhbGxvY2F0aW9ucyBjYW4gYmUgY2xhaW1lZAogICAgYm9vbCBwdWJsaWMgY2FuQ2xhaW1QcmVzYWxlQm9udXNUb2tlbnNQaGFzZTE7CiAgICBib29sIHB1YmxpYyBjYW5DbGFpbVByZXNhbGVCb251c1Rva2Vuc1BoYXNlMjsKCiAgICAvLyBXaGV0aGVyIHRoZSBib251cyB0b2tlbiBhbGxvY2F0aW9ucyBjYW4gYmUgY2xhaW1lZAogICAgYm9vbCBwdWJsaWMgY2FuQ2xhaW1QYXJ0bmVyQm9udXNUb2tlbnNQaGFzZTE7CiAgICBib29sIHB1YmxpYyBjYW5DbGFpbVBhcnRuZXJCb251c1Rva2Vuc1BoYXNlMjsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBMZWRnZXIgRVZFTlRTIC8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gVHJpZ2dlcmVkIHdoZW4gYW4gYWxsb2NhdGlvbiBoYXMgYmVlbiBncmFudGVkCiAgICBldmVudCBBbGxvY2F0aW9uR3JhbnRlZChhZGRyZXNzIF9jb250cmlidXRvciwgdWludDI1NiBfYW1vdW50LCB1aW50OCBfcGhhc2UpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIGFuIGFsbG9jYXRpb24gaGFzIGJlZW4gcmV2b2tlZAogICAgZXZlbnQgQWxsb2NhdGlvblJldm9rZWQoYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQyNTYgX2Ftb3VudCwgdWludDggX3BoYXNlKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiBhbiBhbGxvY2F0aW9uIGhhcyBiZWVuIGNsYWltZWQKICAgIGV2ZW50IEFsbG9jYXRpb25DbGFpbWVkKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50MjU2IF9hbW91bnQpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIGEgYm9udXMgYWxsb2NhdGlvbiBoYXMgYmVlbiBjbGFpbWVkCiAgICBldmVudCBBbGxvY2F0aW9uQm9udXNDbGFpbWVkKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50MjU2IF9hbW91bnQpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIGNyb3dkc2FsZSBjb250cmFjdCB1cGRhdGVkCiAgICBldmVudCBDcm93ZHNhbGVDb250cmFjdFVwZGF0ZWQoYWRkcmVzcyBfd2hvLCBhZGRyZXNzIF9vbGRfYWRkcmVzcywgYWRkcmVzcyBfbmV3X2FkZHJlc3MpOwoKICAgIC8vVHJpZ2dlcmVkIHdoZW4gYW55IGNhbiBjbGFpbSB0b2tlbiBib29sZWFuIGlzIHVwZGF0ZWQuIF90eXBlIHBhcmFtIGluZGljYXRlcyB3aGljaCBpcyB1cGRhdGVkLgogICAgZXZlbnQgQ2FuQ2xhaW1Ub2tlbnNVcGRhdGVkKGFkZHJlc3MgX3dobywgc3RyaW5nIF90eXBlLCBib29sIF9vbGRDYW5DbGFpbSwgYm9vbCBfbmV3Q2FuQ2xhaW0pOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIExlZGdlciBGVU5DVElPTlMgLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLyBMZWRnZXIgY29uc3RydWN0b3IKICAgIC8vIFNldHMgZGVmYXVsdCB2YWx1ZXMgZm9yIGNhbkNsYWltUHJlc2FsZVRva2VucyBhbmQgY2FuQ2xhaW1QYXJ0bmVyVG9rZW5zIHByb3BlcnRpZXMKICAgIGZ1bmN0aW9uIExlZGdlcihKOFRUb2tlbiBfdG9rZW5Db250cmFjdCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoX3Rva2VuQ29udHJhY3QpICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHRva2VuQ29udHJhY3QgPSBfdG9rZW5Db250cmFjdDsKICAgICAgICBjYW5DbGFpbVByZXNhbGVUb2tlbnMgPSBmYWxzZTsKICAgICAgICBjYW5DbGFpbVBhcnRuZXJUb2tlbnMgPSBmYWxzZTsKICAgICAgICBjYW5DbGFpbVByZXNhbGVCb251c1Rva2Vuc1BoYXNlMSA9IGZhbHNlOwogICAgICAgIGNhbkNsYWltUHJlc2FsZUJvbnVzVG9rZW5zUGhhc2UyID0gZmFsc2U7CiAgICAgICAgY2FuQ2xhaW1QYXJ0bmVyQm9udXNUb2tlbnNQaGFzZTEgPSBmYWxzZTsKICAgICAgICBjYW5DbGFpbVBhcnRuZXJCb251c1Rva2Vuc1BoYXNlMiA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIGNsYWltVG9rZW5zKCk7CiAgICB9CgogICAgLy8gUmV2b2tlcyBhbiBhbGxvY2F0aW9uIGZyb20gdGhlIGNvbnRyaWJ1dG9yIHdpdGggYWRkcmVzcyBfY29udHJpYnV0b3IKICAgIC8vIERlbGV0ZXMgdGhlIGFsbG9jYXRpb24gZnJvbSB0aGUgY29ycmVzcG9uZGluZyBtYXBwaW5nIHByb3BlcnR5IGFuZCB0cmFuc2ZlcnMKICAgIC8vIHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIG9mIHRoZSBhbGxvY2F0aW9uIGJhY2sgdG8gdGhlIENyb3dkc2FsZSBjb250cmFjdAogICAgZnVuY3Rpb24gcmV2b2tlQWxsb2NhdGlvbihhZGRyZXNzIF9jb250cmlidXRvciwgdWludDggX3BoYXNlKSBwdWJsaWMgb25seUFkbWluQW5kT3BzIHBheWFibGUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2NvbnRyaWJ1dG9yICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2NvbnRyaWJ1dG9yICE9IGFkZHJlc3ModGhpcykpOwoKICAgICAgICAvLyBDYW4ndCByZXZva2UgIGFuIGFsbG9jYXRpb24gaWYgdGhlIGNvbnRyaWJ1dGlvbiBwaGFzZSBpcyBub3QgaW4gdGhlIENvbnRyaWJ1dGlvblBoYXNlIGVudW0KICAgICAgICBDb250cmlidXRpb25QaGFzZSBfY29udHJpYnV0aW9uUGhhc2UgPSBDb250cmlidXRpb25QaGFzZShfcGhhc2UpOwogICAgICAgIHJlcXVpcmUoX2NvbnRyaWJ1dGlvblBoYXNlID09IENvbnRyaWJ1dGlvblBoYXNlLlByZVNhbGVDb250cmlidXRpb24gfHwKICAgICAgICAgICAgICAgIF9jb250cmlidXRpb25QaGFzZSA9PSBDb250cmlidXRpb25QaGFzZS5QYXJ0bmVyQ29udHJpYnV0aW9uKTsKCiAgICAgICAgdWludDI1NiBncmFudGVkQWxsb2NhdGlvbiA9IDA7CgogICAgICAgIC8vIERlbGV0ZXMgdGhlIGFsbG9jYXRpb24gZnJvbSB0aGUgcmVzcGVjdGl2ZSBtYXBwaW5nCiAgICAgICAgaWYgKF9jb250cmlidXRpb25QaGFzZSA9PSBDb250cmlidXRpb25QaGFzZS5QcmVTYWxlQ29udHJpYnV0aW9uKSB7CiAgICAgICAgICAgIGdyYW50ZWRBbGxvY2F0aW9uID0gcHJlc2FsZUFsbG9jYXRpb25zW19jb250cmlidXRvcl0uYW1vdW50R3JhbnRlZC5hZGQocHJlc2FsZUFsbG9jYXRpb25zW19jb250cmlidXRvcl0uYW1vdW50Qm9udXNHcmFudGVkKTsKICAgICAgICAgICAgZGVsZXRlIHByZXNhbGVBbGxvY2F0aW9uc1tfY29udHJpYnV0b3JdOwogICAgICAgIH0gZWxzZSBpZiAoX2NvbnRyaWJ1dGlvblBoYXNlID09IENvbnRyaWJ1dGlvblBoYXNlLlBhcnRuZXJDb250cmlidXRpb24pIHsKICAgICAgICAgICAgZ3JhbnRlZEFsbG9jYXRpb24gPSBwYXJ0bmVyQWxsb2NhdGlvbnNbX2NvbnRyaWJ1dG9yXS5hbW91bnRHcmFudGVkLmFkZChwYXJ0bmVyQWxsb2NhdGlvbnNbX2NvbnRyaWJ1dG9yXS5hbW91bnRCb251c0dyYW50ZWQpOwogICAgICAgICAgICBkZWxldGUgcGFydG5lckFsbG9jYXRpb25zW19jb250cmlidXRvcl07CiAgICAgICAgfQoKICAgICAgICAvLyBUaGUgZ3JhbnRlZCBhbW91bnQgYWxsb2NhdGlvbiBtdXN0IGJlIGxlc3MgdGhhdCB0aGUgY3VycmVudCB0b2tlbiBzdXBwbHkgb24gdGhlIGNvbnRyYWN0CiAgICAgICAgdWludDI1NiBjdXJyZW50U3VwcGx5ID0gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShncmFudGVkQWxsb2NhdGlvbiA8PSBjdXJyZW50U3VwcGx5KTsKCiAgICAgICAgLy8gVXBkYXRlcyB0aGUgdG90YWwgcHJpdmF0ZSBhbGxvY2F0aW9uIHN1YnN0cmFjdGluZyB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGhhcyBiZWVuIHJldm9rZWQKICAgICAgICByZXF1aXJlKGdyYW50ZWRBbGxvY2F0aW9uIDw9IHRvdGFsUHJpdmF0ZUFsbG9jYXRpb24pOwogICAgICAgIHRvdGFsUHJpdmF0ZUFsbG9jYXRpb24gPSB0b3RhbFByaXZhdGVBbGxvY2F0aW9uLnN1YihncmFudGVkQWxsb2NhdGlvbik7CiAgICAgICAgCiAgICAgICAgLy8gV2Ugc2VudCBiYWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgaGFzIGJlZW4gcmV2b2tlZCB0byB0aGUgY29yd2RzYWxlIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0LnRyYW5zZmVyKGFkZHJlc3MoY3Jvd2RzYWxlQ29udHJhY3QpLCBncmFudGVkQWxsb2NhdGlvbikpOwoKICAgICAgICBBbGxvY2F0aW9uUmV2b2tlZChfY29udHJpYnV0b3IsIGdyYW50ZWRBbGxvY2F0aW9uLCBfcGhhc2UpOwoKICAgICAgICByZXR1cm4gZ3JhbnRlZEFsbG9jYXRpb247CgogICAgfQoKICAgIC8vIEFkZHMgYSBuZXcgYWxsb2NhdGlvbiBmb3IgdGhlIGNvbnRyaWJ1dG9yIHdpdGggYWRkcmVzcyBfY29udHJpYnV0b3IKICAgIGZ1bmN0aW9uIGFkZEFsbG9jYXRpb24oYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfYm9udXMsIHVpbnQ4IF9waGFzZSkgcHVibGljIG9ubHlBZG1pbkFuZE9wcyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfY29udHJpYnV0b3IgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfY29udHJpYnV0b3IgIT0gYWRkcmVzcyh0aGlzKSk7CgogICAgICAgIC8vIENhbid0IGNyZWF0ZSBvciB1cGRhdGUgYW4gYWxsb2NhdGlvbiBpZiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhbGxvY2F0ZWQgaXMgbm90IGdyZWF0ZXIgdGhhbiB6ZXJvCiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CgogICAgICAgIC8vIENhbid0IGNyZWF0ZSBhbiBhbGxvY2F0aW9uIGlmIHRoZSBjb250cmlidXRpb24gcGhhc2UgaXMgbm90IGluIHRoZSBDb250cmlidXRpb25QaGFzZSBlbnVtCiAgICAgICAgQ29udHJpYnV0aW9uUGhhc2UgX2NvbnRyaWJ1dGlvblBoYXNlID0gQ29udHJpYnV0aW9uUGhhc2UoX3BoYXNlKTsKICAgICAgICByZXF1aXJlKF9jb250cmlidXRpb25QaGFzZSA9PSBDb250cmlidXRpb25QaGFzZS5QcmVTYWxlQ29udHJpYnV0aW9uIHx8CiAgICAgICAgICAgICAgICBfY29udHJpYnV0aW9uUGhhc2UgPT0gQ29udHJpYnV0aW9uUGhhc2UuUGFydG5lckNvbnRyaWJ1dGlvbik7CgoKICAgICAgICB1aW50MjU2IHRvdGFsQW1vdW50ID0gX2Ftb3VudC5hZGQoX2JvbnVzKTsKICAgICAgICB1aW50MjU2IHRvdGFsR3JhbnRlZEFsbG9jYXRpb24gPSAwOwogICAgICAgIHVpbnQyNTYgdG90YWxHcmFudGVkQm9udXNBbGxvY2F0aW9uID0gMDsKCiAgICAgICAgLy8gRmV0Y2ggdGhlIGFsbG9jYXRpb24gZnJvbSB0aGUgcmVzcGVjdGl2ZSBtYXBwaW5nIGFuZCB1cGRhdGVzIHRoZSBncmFudGVkIGFtb3VudCBvZiB0b2tlbnMKICAgICAgICBpZiAoX2NvbnRyaWJ1dGlvblBoYXNlID09IENvbnRyaWJ1dGlvblBoYXNlLlByZVNhbGVDb250cmlidXRpb24pIHsKICAgICAgICAgICAgdG90YWxHcmFudGVkQWxsb2NhdGlvbiA9IHByZXNhbGVBbGxvY2F0aW9uc1tfY29udHJpYnV0b3JdLmFtb3VudEdyYW50ZWQuYWRkKF9hbW91bnQpOwogICAgICAgICAgICB0b3RhbEdyYW50ZWRCb251c0FsbG9jYXRpb24gPSBwcmVzYWxlQWxsb2NhdGlvbnNbX2NvbnRyaWJ1dG9yXS5hbW91bnRCb251c0dyYW50ZWQuYWRkKF9ib251cyk7CiAgICAgICAgICAgIHByZXNhbGVBbGxvY2F0aW9uc1tfY29udHJpYnV0b3JdID0gQWxsb2NhdGlvbih0b3RhbEdyYW50ZWRBbGxvY2F0aW9uLCB0b3RhbEdyYW50ZWRCb251c0FsbG9jYXRpb24sIGZhbHNlKTsKICAgICAgICB9IGVsc2UgaWYgKF9jb250cmlidXRpb25QaGFzZSA9PSBDb250cmlidXRpb25QaGFzZS5QYXJ0bmVyQ29udHJpYnV0aW9uKSB7CiAgICAgICAgICAgIHRvdGFsR3JhbnRlZEFsbG9jYXRpb24gPSBwYXJ0bmVyQWxsb2NhdGlvbnNbX2NvbnRyaWJ1dG9yXS5hbW91bnRHcmFudGVkLmFkZChfYW1vdW50KTsKICAgICAgICAgICAgdG90YWxHcmFudGVkQm9udXNBbGxvY2F0aW9uID0gcGFydG5lckFsbG9jYXRpb25zW19jb250cmlidXRvcl0uYW1vdW50Qm9udXNHcmFudGVkLmFkZChfYm9udXMpOwogICAgICAgICAgICBwYXJ0bmVyQWxsb2NhdGlvbnNbX2NvbnRyaWJ1dG9yXSA9IEFsbG9jYXRpb24odG90YWxHcmFudGVkQWxsb2NhdGlvbiwgdG90YWxHcmFudGVkQm9udXNBbGxvY2F0aW9uLCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGVzIHRoZSBjb250cmFjdCBkYXRhCiAgICAgICAgdG90YWxQcml2YXRlQWxsb2NhdGlvbiA9IHRvdGFsUHJpdmF0ZUFsbG9jYXRpb24uYWRkKHRvdGFsQW1vdW50KTsKCiAgICAgICAgQWxsb2NhdGlvbkdyYW50ZWQoX2NvbnRyaWJ1dG9yLCB0b3RhbEFtb3VudCwgX3BoYXNlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVGhlIGNsYWltVG9rZW5zKCkgZnVuY3Rpb24gaGFuZGxlcyB0aGUgY29udHJpYnV0aW9uIHRva2VuIGNsYWltLgogICAgLy8gVG9rZW5zIGNhbiBvbmx5IGJlIGNsYWltZWQgYWZ0ZXIgd2Ugb3BlbiB0aGlzIHBoYXNlLgogICAgLy8gVGhlIGxvY2tvdXRzIHBlcmlvZHMgYXJlIGRlZmluZWQgYnkgdGhlIGZvdW5kYXRpb24uCiAgICAvLyBUaGVyZSBhcmUgMiBkaWZmZXJlbnQgbG9ja291dHM6CiAgICAvLyAgICAgIFByZXNhbGUgbG9ja291dAogICAgLy8gICAgICBQYXJ0bmVyIGxvY2tvdXQKICAgIC8vCiAgICAvLyBBIGNvbnRyaWJ1dG9yIHRoYXQgaGFzIGNvbnRyaWJ1dGVkIGluIGFsbCB0aGUgcGhhc2VzIGNhbiBjbGFpbQogICAgLy8gYWxsIGl0cyB0b2tlbnMsIGJ1dCBvbmx5IHRoZSBvbmVzIHRoYXQgYXJlIGFjY2VzaWJsZSB0byBjbGFpbQogICAgLy8gYmUgdHJhbnNmZXJlZC4KICAgIC8vIAogICAgLy8gQSBjb250cmlidXRvciBjYW4gY2xhaW0gaXRzIHRva2VucyBhZnRlciBlYWNoIHBoYXNlIGhhcyBiZWVuIG9wZW5lZAogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgdWludDI1NiBhbW91bnRUb1RyYW5zZmVyID0gMDsKCiAgICAgICAgLy8gV2UgbmVlZCB0byBjaGVjayBpZiB0aGUgY29udHJpYnV0b3IgaGFzIG1hZGUgYSBjb250cmlidXRpb24gb24gZWFjaAogICAgICAgIC8vIHBoYXNlLCBwcmVzYWxlIGFuZCBwYXJ0bmVyCiAgICAgICAgQWxsb2NhdGlvbiBzdG9yYWdlIHByZXNhbGVBID0gcHJlc2FsZUFsbG9jYXRpb25zW21zZy5zZW5kZXJdOwogICAgICAgIGlmIChwcmVzYWxlQS5hbW91bnRHcmFudGVkID4gMCAmJiBjYW5DbGFpbVByZXNhbGVUb2tlbnMpIHsKICAgICAgICAgICAgYW1vdW50VG9UcmFuc2ZlciA9IGFtb3VudFRvVHJhbnNmZXIuYWRkKHByZXNhbGVBLmFtb3VudEdyYW50ZWQpOwogICAgICAgICAgICBwcmVzYWxlQS5hbW91bnRHcmFudGVkID0gMDsKICAgICAgICB9CgogICAgICAgIEFsbG9jYXRpb24gc3RvcmFnZSBwYXJ0bmVyQSA9IHBhcnRuZXJBbGxvY2F0aW9uc1ttc2cuc2VuZGVyXTsKICAgICAgICBpZiAocGFydG5lckEuYW1vdW50R3JhbnRlZCA+IDAgJiYgY2FuQ2xhaW1QYXJ0bmVyVG9rZW5zKSB7CiAgICAgICAgICAgIGFtb3VudFRvVHJhbnNmZXIgPSBhbW91bnRUb1RyYW5zZmVyLmFkZChwYXJ0bmVyQS5hbW91bnRHcmFudGVkKTsKICAgICAgICAgICAgcGFydG5lckEuYW1vdW50R3JhbnRlZCA9IDA7CiAgICAgICAgfQoKICAgICAgICAvLyBUaGUgYW1vdW50IHRvIHRyYW5zZmVyIG11c3QgZ3JlYXRlciB0aGFuIHplcm8KICAgICAgICByZXF1aXJlKGFtb3VudFRvVHJhbnNmZXIgPiAwKTsKCiAgICAgICAgLy8gVGhlIGFtb3VudCB0byB0cmFuc2ZlciBtdXN0IGJlIGxlc3Mgb3IgZXF1YWwgdG8gdGhlIGN1cnJlbnQgc3VwcGx5CiAgICAgICAgdWludDI1NiBjdXJyZW50U3VwcGx5ID0gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShhbW91bnRUb1RyYW5zZmVyIDw9IGN1cnJlbnRTdXBwbHkpOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIHRoZSB0b2tlbiBhbGxvY2F0aW9uIHRvIGNvbnRyaWJ1dG9yCiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0LnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudFRvVHJhbnNmZXIpKTsKICAgICAgICBBbGxvY2F0aW9uQ2xhaW1lZChtc2cuc2VuZGVyLCBhbW91bnRUb1RyYW5zZmVyKTsKICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNsYWltQm9udXMoKSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpOwoKICAgICAgICB1aW50MjU2IGFtb3VudFRvVHJhbnNmZXIgPSAwOwoKICAgICAgICAvLyBCT05VUyBQSEFTRSAxCiAgICAgICAgQWxsb2NhdGlvbiBzdG9yYWdlIHByZXNhbGUgPSBwcmVzYWxlQWxsb2NhdGlvbnNbbXNnLnNlbmRlcl07CiAgICAgICAgaWYgKHByZXNhbGUuYW1vdW50Qm9udXNHcmFudGVkID4gMCAmJiAhcHJlc2FsZS5oYXNDbGFpbWVkQm9udXNUb2tlbnMgJiYgY2FuQ2xhaW1QcmVzYWxlQm9udXNUb2tlbnNQaGFzZTEpIHsKICAgICAgICAgICAgdWludDI1NiBhbW91bnRQcmVzYWxlID0gcHJlc2FsZS5hbW91bnRCb251c0dyYW50ZWQuZGl2KDIpOwogICAgICAgICAgICBhbW91bnRUb1RyYW5zZmVyID0gYW1vdW50UHJlc2FsZTsKICAgICAgICAgICAgcHJlc2FsZS5hbW91bnRCb251c0dyYW50ZWQgPSBhbW91bnRQcmVzYWxlOwogICAgICAgICAgICBwcmVzYWxlLmhhc0NsYWltZWRCb251c1Rva2VucyA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBBbGxvY2F0aW9uIHN0b3JhZ2UgcGFydG5lciA9IHBhcnRuZXJBbGxvY2F0aW9uc1ttc2cuc2VuZGVyXTsKICAgICAgICBpZiAocGFydG5lci5hbW91bnRCb251c0dyYW50ZWQgPiAwICYmICFwYXJ0bmVyLmhhc0NsYWltZWRCb251c1Rva2VucyAmJiBjYW5DbGFpbVBhcnRuZXJCb251c1Rva2Vuc1BoYXNlMSkgewogICAgICAgICAgICB1aW50MjU2IGFtb3VudFBhcnRuZXIgPSBwYXJ0bmVyLmFtb3VudEJvbnVzR3JhbnRlZC5kaXYoMik7CiAgICAgICAgICAgIGFtb3VudFRvVHJhbnNmZXIgPSBhbW91bnRUb1RyYW5zZmVyLmFkZChhbW91bnRQYXJ0bmVyKTsKICAgICAgICAgICAgcGFydG5lci5hbW91bnRCb251c0dyYW50ZWQgPSBhbW91bnRQYXJ0bmVyOwogICAgICAgICAgICBwYXJ0bmVyLmhhc0NsYWltZWRCb251c1Rva2VucyA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBCT05VUyBQSEFTRSAyCiAgICAgICAgaWYgKHByZXNhbGUuYW1vdW50Qm9udXNHcmFudGVkID4gMCAmJiBjYW5DbGFpbVByZXNhbGVCb251c1Rva2Vuc1BoYXNlMikgewogICAgICAgICAgICBhbW91bnRUb1RyYW5zZmVyID0gYW1vdW50VG9UcmFuc2Zlci5hZGQocHJlc2FsZS5hbW91bnRCb251c0dyYW50ZWQpOwogICAgICAgICAgICBwcmVzYWxlLmFtb3VudEJvbnVzR3JhbnRlZCA9IDA7CiAgICAgICAgfQoKICAgICAgICBpZiAocGFydG5lci5hbW91bnRCb251c0dyYW50ZWQgPiAwICYmIGNhbkNsYWltUGFydG5lckJvbnVzVG9rZW5zUGhhc2UyKSB7CiAgICAgICAgICAgIGFtb3VudFRvVHJhbnNmZXIgPSBhbW91bnRUb1RyYW5zZmVyLmFkZChwYXJ0bmVyLmFtb3VudEJvbnVzR3JhbnRlZCk7CiAgICAgICAgICAgIHBhcnRuZXIuYW1vdW50Qm9udXNHcmFudGVkID0gMDsKICAgICAgICB9CgogICAgICAgIC8vIFRoZSBhbW91bnQgdG8gdHJhbnNmZXIgbXVzdCBncmVhdGVyIHRoYW4gemVybwogICAgICAgIHJlcXVpcmUoYW1vdW50VG9UcmFuc2ZlciA+IDApOwoKICAgICAgICAvLyBUaGUgYW1vdW50IHRvIHRyYW5zZmVyIG11c3QgYmUgbGVzcyBvciBlcXVhbCB0byB0aGUgY3VycmVudCBzdXBwbHkKICAgICAgICB1aW50MjU2IGN1cnJlbnRTdXBwbHkgPSB0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKGFtb3VudFRvVHJhbnNmZXIgPD0gY3VycmVudFN1cHBseSk7CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIHRva2VuIGFsbG9jYXRpb24gdG8gY29udHJpYnV0b3IKICAgICAgICByZXF1aXJlKHRva2VuQ29udHJhY3QudHJhbnNmZXIobXNnLnNlbmRlciwgYW1vdW50VG9UcmFuc2ZlcikpOwogICAgICAgIEFsbG9jYXRpb25Cb251c0NsYWltZWQobXNnLnNlbmRlciwgYW1vdW50VG9UcmFuc2Zlcik7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFVwZGF0ZXMgdGhlIGNhbkNsYWltUHJlc2FsZVRva2VucyBwcm9wZXR5IHdpdGggdGhlIG5ldyBfY2FuQ2xhaW1Ub2tlbnMgdmFsdWUKICAgIGZ1bmN0aW9uIHNldENhbkNsYWltUHJlc2FsZVRva2Vucyhib29sIF9jYW5DbGFpbVRva2VucykgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIF9vbGRDYW5DbGFpbSA9IGNhbkNsYWltUHJlc2FsZVRva2VuczsKICAgICAgICBjYW5DbGFpbVByZXNhbGVUb2tlbnMgPSBfY2FuQ2xhaW1Ub2tlbnM7CiAgICAgICAgQ2FuQ2xhaW1Ub2tlbnNVcGRhdGVkKG1zZy5zZW5kZXIsICdjYW5DbGFpbVByZXNhbGVUb2tlbnMnLCBfb2xkQ2FuQ2xhaW0sIF9jYW5DbGFpbVRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgY2FuQ2xhaW1QYXJ0bmVyVG9rZW5zIHByb3BlcnR5IHdpdGggdGhlIG5ldyBfY2FuQ2xhaW1Ub2tlbnMgdmFsdWUKICAgIGZ1bmN0aW9uIHNldENhbkNsYWltUGFydG5lclRva2Vucyhib29sIF9jYW5DbGFpbVRva2VucykgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIF9vbGRDYW5DbGFpbSA9IGNhbkNsYWltUGFydG5lclRva2VuczsKICAgICAgICBjYW5DbGFpbVBhcnRuZXJUb2tlbnMgPSBfY2FuQ2xhaW1Ub2tlbnM7CiAgICAgICAgQ2FuQ2xhaW1Ub2tlbnNVcGRhdGVkKG1zZy5zZW5kZXIsICdjYW5DbGFpbVBhcnRuZXJUb2tlbnMnLCBfb2xkQ2FuQ2xhaW0sIF9jYW5DbGFpbVRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgY2FuQ2xhaW1Cb251c1Rva2VucyBwcm9wZXJ0eSB3aXRoIHRoZSBuZXcgX2NhbkNsYWltVG9rZW5zIHZhbHVlCiAgICBmdW5jdGlvbiBzZXRDYW5DbGFpbVByZXNhbGVCb251c1Rva2Vuc1BoYXNlMShib29sIF9jYW5DbGFpbVRva2VucykgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIF9vbGRDYW5DbGFpbSA9IGNhbkNsYWltUHJlc2FsZUJvbnVzVG9rZW5zUGhhc2UxOwogICAgICAgIGNhbkNsYWltUHJlc2FsZUJvbnVzVG9rZW5zUGhhc2UxID0gX2NhbkNsYWltVG9rZW5zOwogICAgICAgIENhbkNsYWltVG9rZW5zVXBkYXRlZChtc2cuc2VuZGVyLCAnY2FuQ2xhaW1QcmVzYWxlQm9udXNUb2tlbnNQaGFzZTEnLCBfb2xkQ2FuQ2xhaW0sIF9jYW5DbGFpbVRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgY2FuQ2xhaW1Cb251c1Rva2VucyBwcm9wZXJ0eSB3aXRoIHRoZSBuZXcgX2NhbkNsYWltVG9rZW5zIHZhbHVlCiAgICBmdW5jdGlvbiBzZXRDYW5DbGFpbVByZXNhbGVCb251c1Rva2Vuc1BoYXNlMihib29sIF9jYW5DbGFpbVRva2VucykgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIF9vbGRDYW5DbGFpbSA9IGNhbkNsYWltUHJlc2FsZUJvbnVzVG9rZW5zUGhhc2UyOwogICAgICAgIGNhbkNsYWltUHJlc2FsZUJvbnVzVG9rZW5zUGhhc2UyID0gX2NhbkNsYWltVG9rZW5zOwogICAgICAgIENhbkNsYWltVG9rZW5zVXBkYXRlZChtc2cuc2VuZGVyLCAnY2FuQ2xhaW1QcmVzYWxlQm9udXNUb2tlbnNQaGFzZTInLCBfb2xkQ2FuQ2xhaW0sIF9jYW5DbGFpbVRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgY2FuQ2xhaW1Cb251c1Rva2VucyBwcm9wZXJ0eSB3aXRoIHRoZSBuZXcgX2NhbkNsYWltVG9rZW5zIHZhbHVlCiAgICBmdW5jdGlvbiBzZXRDYW5DbGFpbVBhcnRuZXJCb251c1Rva2Vuc1BoYXNlMShib29sIF9jYW5DbGFpbVRva2VucykgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIF9vbGRDYW5DbGFpbSA9IGNhbkNsYWltUGFydG5lckJvbnVzVG9rZW5zUGhhc2UxOwogICAgICAgIGNhbkNsYWltUGFydG5lckJvbnVzVG9rZW5zUGhhc2UxID0gX2NhbkNsYWltVG9rZW5zOwogICAgICAgIENhbkNsYWltVG9rZW5zVXBkYXRlZChtc2cuc2VuZGVyLCAnY2FuQ2xhaW1QYXJ0bmVyQm9udXNUb2tlbnNQaGFzZTEnLCBfb2xkQ2FuQ2xhaW0sIF9jYW5DbGFpbVRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgY2FuQ2xhaW1Cb251c1Rva2VucyBwcm9wZXJ0eSB3aXRoIHRoZSBuZXcgX2NhbkNsYWltVG9rZW5zIHZhbHVlCiAgICBmdW5jdGlvbiBzZXRDYW5DbGFpbVBhcnRuZXJCb251c1Rva2Vuc1BoYXNlMihib29sIF9jYW5DbGFpbVRva2VucykgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIF9vbGRDYW5DbGFpbSA9IGNhbkNsYWltUGFydG5lckJvbnVzVG9rZW5zUGhhc2UyOwogICAgICAgIGNhbkNsYWltUGFydG5lckJvbnVzVG9rZW5zUGhhc2UyID0gX2NhbkNsYWltVG9rZW5zOwogICAgICAgIENhbkNsYWltVG9rZW5zVXBkYXRlZChtc2cuc2VuZGVyLCAnY2FuQ2xhaW1QYXJ0bmVyQm9udXNUb2tlbnNQaGFzZTInLCBfb2xkQ2FuQ2xhaW0sIF9jYW5DbGFpbVRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IHByb3BlcnR5IHdpdGggdGhlIG5ldyBfY3Jvd2RzYWxlQ29udHJhY3QgdmFsdWUKICAgIGZ1bmN0aW9uIHNldENyb3dkc2FsZUNvbnRyYWN0KENyb3dkc2FsZSBfY3Jvd2RzYWxlQ29udHJhY3QpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFkZHJlc3Mgb2xkX2Nyb3dkc2FsZV9hZGRyZXNzID0gY3Jvd2RzYWxlQ29udHJhY3Q7CgogICAgICAgIGNyb3dkc2FsZUNvbnRyYWN0ID0gX2Nyb3dkc2FsZUNvbnRyYWN0OwoKICAgICAgICBDcm93ZHNhbGVDb250cmFjdFVwZGF0ZWQobXNnLnNlbmRlciwgb2xkX2Nyb3dkc2FsZV9hZGRyZXNzLCBjcm93ZHNhbGVDb250cmFjdCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9Cgpjb250cmFjdCBDcm93ZHNhbGUgaXMgQUNMTWFuYWdlZCwgQ3Jvd2RzYWxlQ29uZmlnIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ3Jvd2RzYWxlIFBST1BFUlRJRVMgLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gVGhlIEo4VFRva2VuIHNtYXJ0IGNvbnRyYWN0IHJlZmVyZW5jZQogICAgSjhUVG9rZW4gcHVibGljIHRva2VuQ29udHJhY3Q7CgogICAgLy8gVGhlIExlZGdlciBzbWFydCBjb250cmFjdCByZWZlcmVuY2UKICAgIExlZGdlciBwdWJsaWMgbGVkZ2VyQ29udHJhY3Q7CgogICAgLy8gVGhlIHN0YXJ0IHRva2VuIHNhbGUgZGF0ZSByZXByZXNlbnRlZCBhcyBhIHRpbWVzdGFtcAogICAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lc3RhbXA7CgogICAgLy8gVGhlIGVuZCB0b2tlbiBzYWxlIGRhdGUgcmVwcmVzZW50ZWQgYXMgYSB0aW1lc3RhbXAKICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWVzdGFtcDsKCiAgICAvLyBSYXRpbyBvZiBKOFQgdG9rZW5zIHRvIHBlciBldGhlcgogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zUGVyRXRoZXI7CgogICAgLy8gVGhlIHRvdGFsIGFtb3VudCBvZiB3ZWkgcmFpc2VkIGluIHRoZSB0b2tlbiBzYWxlCiAgICAvLyBJbmNsdWRpbmcgcHJlc2FsZXMgKGluIGV0aCkgYW5kIHB1YmxpYyBzYWxlCiAgICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogICAgLy8gVGhlIGN1cnJlbnQgdG90YWwgYW1vdW50IG9mIHRva2VucyBzb2xkIGluIHRoZSB0b2tlbiBzYWxlCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFRva2Vuc1NvbGQ7CgogICAgLy8gVGhlIG1pbmltdW0gYW5kIG1heGltdW0gZXRoIGNvbnRyaWJ1dGlvbiBhY2NlcHRlZCBpbiB0aGUgdG9rZW4gc2FsZQogICAgdWludDI1NiBwdWJsaWMgbWluQ29udHJpYnV0aW9uOwogICAgdWludDI1NiBwdWJsaWMgbWF4Q29udHJpYnV0aW9uOwoKICAgIC8vIFRoZSB3YWxsZXQgYWRkcmVzcyB3aGVyZSB0aGUgdG9rZW4gc2FsZSBzZW5kcyBhbGwgZXRoIGNvbnRyaWJ1dGlvbnMKICAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgICAvLyBDb250cm9scyB3aGV0aGVyIHRoZSB0b2tlbiBzYWxlIGhhcyBmaW5pc2hlZCBvciBub3QKICAgIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CgogICAgLy8gTWFwIG9mIGFkcmVzc2VzIHRoYXQgcmVxdWVzdGVkIHRvIHB1cmNoYXNlIHRva2VucwogICAgLy8gQ29udHJpYnV0b3JzIG9mIHRoZSB0b2tlbiBzYWxlIGFyZSBzZWdtZW50ZWQgYXM6CiAgICAvLyAgQ2Fubm90Q29udHJpYnV0ZTogQ2Fubm90IGNvbnRyaWJ1dGUgaW4gYW55IHBoYXNlICh1aW50OCAgLSAwKQogICAgLy8gIFByZVNhbGVDb250cmlidXRvcjogQ2FuIGNvbnRyaWJ1dGUgb24gYm90aCBwcmUtc2FsZSBhbmQgcHViaWMgc2FsZSBwaGFzZXMgKHVpbnQ4ICAtIDEpCiAgICAvLyAgUHVibGljU2FsZUNvbnRyaWJ1dG9yOiBDYW4gY29udHJpYnV0ZSBvbiBoZSBwdWJsaWMgc2FsZSBwaGFzZSAodWludDggIC0gMikKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBXaGl0ZWxpc3RQZXJtaXNzaW9uKSBwdWJsaWMgd2hpdGVsaXN0OwoKICAgIC8vIE1hcCBvZiBhZGRyZXNzZXMgdGhhdCBoYXMgYWxyZWFkeSBjb250cmlidXRlZCBvbiB0aGUgdG9rZW4gc2FsZQogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBoYXNDb250cmlidXRlZDsKCiAgICBlbnVtIFdoaXRlbGlzdFBlcm1pc3Npb24gewogICAgICAgIENhbm5vdENvbnRyaWJ1dGUsIFByZVNhbGVDb250cmlidXRvciwgUHVibGljU2FsZUNvbnRyaWJ1dG9yIAogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENyb3dkc2FsZSBFVkVOVFMgLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiBhIGNvbnRyaWJ1dGlvbiBpbiB0aGUgcHVibGljIHNhbGUgaGFzIGJlZW4gcHJvY2Vzc2VkIGNvcnJlY3RseQogICAgZXZlbnQgVG9rZW5zUHVyY2hhc2VkKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50MjU2IF9hbW91bnQpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIHRoZSB3aGl0ZWxpc3QgaGFzIGJlZW4gdXBkYXRlZAogICAgZXZlbnQgV2hpdGVMaXN0VXBkYXRlZChhZGRyZXNzIF93aG8sIGFkZHJlc3MgX2FjY291bnQsIFdoaXRlbGlzdFBlcm1pc3Npb24gX3BoYXNlKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0aGUgQ3Jvd2RzYWxlIGhhcyBiZWVuIGNyZWF0ZWQKICAgIGV2ZW50IENvbnRyYWN0Q3JlYXRlZCgpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIGEgcHJlc2FsZSBoYXMgYmVlbiBhZGRlZAogICAgLy8gVGhlIHBoYXNlIHBhcmFtZXRlciBjYW4gYmUgYSBzdHJhdGVnaWMgcGFydG5lciBjb250cmlidXRpb24gb3IgYSBwcmVzYWxlIGNvbnRyaWJ1dGlvbgogICAgZXZlbnQgUHJlc2FsZUFkZGVkKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50MjU2IF9hbW91bnQsIHVpbnQ4IF9waGFzZSk7CgogICAgLy8gVHJpZ2dlcmVkIHdoZW4gdGhlIHRva2Vuc1BlckV0aGVyIHByb3BlcnR5IGhhcyBiZWVuIHVwZGF0ZWQKICAgIGV2ZW50IFRva2Vuc1BlckV0aGVyVXBkYXRlZChhZGRyZXNzIF93aG8sIHVpbnQyNTYgX29sZFZhbHVlLCB1aW50MjU2IF9uZXdWYWx1ZSk7CgogICAgLy8gVHJpZ2dlcmVkIHdoZW4gdGhlIHN0YXJ0VGltZXN0YW1wIHByb3BlcnR5IGhhcyBiZWVuIHVwZGF0ZWQKICAgIGV2ZW50IFN0YXJ0VGltZXN0YW1wVXBkYXRlZChhZGRyZXNzIF93aG8sIHVpbnQyNTYgX29sZFZhbHVlLCB1aW50MjU2IF9uZXdWYWx1ZSk7CgogICAgLy8gVHJpZ2dlcmVkIHdoZW4gdGhlIGVuZFRpbWVzdGFtcCBwcm9wZXJ0eSBoYXMgYmVlbiB1cGRhdGVkCiAgICBldmVudCBFbmRUaW1lc3RhbXBVcGRhdGVkKGFkZHJlc3MgX3dobywgdWludDI1NiBfb2xkVmFsdWUsIHVpbnQyNTYgX25ld1ZhbHVlKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0aGUgd2FsbGV0IHByb3BlcnR5IGhhcyBiZWVuIHVwZGF0ZWQKICAgIGV2ZW50IFdhbGxldFVwZGF0ZWQoYWRkcmVzcyBfd2hvLCBhZGRyZXNzIF9vbGRXYWxsZXQsIGFkZHJlc3MgX25ld1dhbGxldCk7CgogICAgLy8gVHJpZ2dlcmVkIHdoZW4gdGhlIG1pbkNvbnRyaWJ1dGlvbiBwcm9wZXJ0eSBoYXMgYmVlbiB1cGRhdGVkCiAgICBldmVudCBNaW5Db250cmlidXRpb25VcGRhdGVkKGFkZHJlc3MgX3dobywgdWludDI1NiBfb2xkVmFsdWUsIHVpbnQyNTYgX25ld1ZhbHVlKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0aGUgbWF4Q29udHJpYnV0aW9uIHByb3BlcnR5IGhhcyBiZWVuIHVwZGF0ZWQKICAgIGV2ZW50IE1heENvbnRyaWJ1dGlvblVwZGF0ZWQoYWRkcmVzcyBfd2hvLCB1aW50MjU2IF9vbGRWYWx1ZSwgdWludDI1NiBfbmV3VmFsdWUpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIHRoZSB0b2tlbiBzYWxlIGhhcyBmaW5hbGl6ZWQKICAgIGV2ZW50IEZpbmFsaXplZChhZGRyZXNzIF93aG8sIHVpbnQyNTYgX3RpbWVzdGFtcCk7CgogICAgLy8gVHJpZ2dlcmVkIHdoZW4gdGhlIHRva2VuIHNhbGUgaGFzIGZpbmFsaXplZCBhbmQgdGhlcmUgd2hlcmUgc3RpbGwgdG9rZW4gdG8gc2FsZQogICAgLy8gV2hlbiB0aGUgdG9rZW4gYXJlIG5vdCBzb2xkLCB3ZSBidXJuIHRoZW0KICAgIGV2ZW50IEJ1cm5lZChhZGRyZXNzIF93aG8sIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfdGltZXN0YW1wKTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDcm93ZHNhbGUgRlVOQ1RJT05TIC8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAKCiAgICAvLyBDcm93ZHNhbGUgY29uc3RydWN0b3IKICAgIC8vIFRha2VzIGRlZmF1bHQgdmFsdWVzIGZyb20gdGhlIENyb3dkc2FsZUNvbmZpZyBzbWFydCBjb250cmFjdAogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKAogICAgICAgIEo4VFRva2VuIF90b2tlbkNvbnRyYWN0LAogICAgICAgIExlZGdlciBfbGVkZ2VyQ29udHJhY3QsCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0CiAgICApIHB1YmxpYwogICAgewogICAgICAgIHVpbnQyNTYgX3N0YXJ0ICAgICAgICAgICAgPSBTVEFSVF9USU1FU1RBTVA7CiAgICAgICAgdWludDI1NiBfZW5kICAgICAgICAgICAgICA9IEVORF9USU1FU1RBTVA7CiAgICAgICAgdWludDI1NiBfc3VwcGx5ICAgICAgICAgICA9IFRPS0VOX1NBTEVfU1VQUExZOwogICAgICAgIHVpbnQyNTYgX21pbl9jb250cmlidXRpb24gPSBNSU5fQ09OVFJJQlVUSU9OX1dFSVM7CiAgICAgICAgdWludDI1NiBfbWF4X2NvbnRyaWJ1dGlvbiA9IE1BWF9DT05UUklCVVRJT05fV0VJUzsKICAgICAgICB1aW50MjU2IF90b2tlbnNQZXJFdGhlciAgID0gSU5JVElBTF9UT0tFTlNfUEVSX0VUSEVSOwoKICAgICAgICByZXF1aXJlKF9zdGFydCA+IGN1cnJlbnRUaW1lKCkpOwogICAgICAgIHJlcXVpcmUoX2VuZCA+IF9zdGFydCk7CiAgICAgICAgcmVxdWlyZShfdG9rZW5zUGVyRXRoZXIgPiAwKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoX3Rva2VuQ29udHJhY3QpICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhfbGVkZ2VyQ29udHJhY3QpICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgbGVkZ2VyQ29udHJhY3QgICA9IF9sZWRnZXJDb250cmFjdDsKICAgICAgICB0b2tlbkNvbnRyYWN0ICAgID0gX3Rva2VuQ29udHJhY3Q7CiAgICAgICAgc3RhcnRUaW1lc3RhbXAgICA9IF9zdGFydDsKICAgICAgICBlbmRUaW1lc3RhbXAgICAgID0gX2VuZDsKICAgICAgICB0b2tlbnNQZXJFdGhlciAgID0gX3Rva2Vuc1BlckV0aGVyOwogICAgICAgIG1pbkNvbnRyaWJ1dGlvbiA9IF9taW5fY29udHJpYnV0aW9uOwogICAgICAgIG1heENvbnRyaWJ1dGlvbiA9IF9tYXhfY29udHJpYnV0aW9uOwogICAgICAgIHdhbGxldCAgICAgICAgICAgPSBfd2FsbGV0OwogICAgICAgIHRvdGFsVG9rZW5zU29sZCAgPSAwOwogICAgICAgIHdlaVJhaXNlZCAgICAgICAgPSAwOwogICAgICAgIGlzRmluYWxpemVkICAgICAgPSBmYWxzZTsgIAoKICAgICAgICBDb250cmFjdENyZWF0ZWQoKTsKICAgIH0KCiAgICAvLyBVcGRhdGVzIHRoZSB0b2tlblBlckV0aGVyIHByb3BldHkgd2l0aCB0aGUgbmV3IF90b2tlbnNQZXJFdGhlciB2YWx1ZQogICAgZnVuY3Rpb24gc2V0VG9rZW5zUGVyRXRoZXIodWludDI1NiBfdG9rZW5zUGVyRXRoZXIpIGV4dGVybmFsIG9ubHlBZG1pbiBvbmx5QmVmb3JlU2FsZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG9rZW5zUGVyRXRoZXIgPiAwKTsKCiAgICAgICAgdWludDI1NiBfb2xkVmFsdWUgPSB0b2tlbnNQZXJFdGhlcjsKICAgICAgICB0b2tlbnNQZXJFdGhlciA9IF90b2tlbnNQZXJFdGhlcjsKCiAgICAgICAgVG9rZW5zUGVyRXRoZXJVcGRhdGVkKG1zZy5zZW5kZXIsIF9vbGRWYWx1ZSwgdG9rZW5zUGVyRXRoZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFVwZGF0ZXMgdGhlIHN0YXJ0VGltZXN0YW1wIHByb3BldHkgd2l0aCB0aGUgbmV3IF9zdGFydCB2YWx1ZQogICAgZnVuY3Rpb24gc2V0U3RhcnRUaW1lc3RhbXAodWludDI1NiBfc3RhcnQpIGV4dGVybmFsIG9ubHlBZG1pbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfc3RhcnQgPCBlbmRUaW1lc3RhbXApOwogICAgICAgIHJlcXVpcmUoX3N0YXJ0ID4gY3VycmVudFRpbWUoKSk7CgogICAgICAgIHVpbnQyNTYgX29sZFZhbHVlID0gc3RhcnRUaW1lc3RhbXA7CiAgICAgICAgc3RhcnRUaW1lc3RhbXAgPSBfc3RhcnQ7CgogICAgICAgIFN0YXJ0VGltZXN0YW1wVXBkYXRlZChtc2cuc2VuZGVyLCBfb2xkVmFsdWUsIHN0YXJ0VGltZXN0YW1wKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgZW5kVGltZXN0YW1wIHByb3BldHkgd2l0aCB0aGUgbmV3IF9lbmQgdmFsdWUKICAgIGZ1bmN0aW9uIHNldEVuZFRpbWVzdGFtcCh1aW50MjU2IF9lbmQpIGV4dGVybmFsIG9ubHlBZG1pbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfZW5kID4gc3RhcnRUaW1lc3RhbXApOwoKICAgICAgICB1aW50MjU2IF9vbGRWYWx1ZSA9IGVuZFRpbWVzdGFtcDsKICAgICAgICBlbmRUaW1lc3RhbXAgPSBfZW5kOwoKICAgICAgICBFbmRUaW1lc3RhbXBVcGRhdGVkKG1zZy5zZW5kZXIsIF9vbGRWYWx1ZSwgZW5kVGltZXN0YW1wKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBVcGRhdGVzIHRoZSB3YWxsZXQgcHJvcGV0eSB3aXRoIHRoZSBuZXcgX25ld1dhbGxldCB2YWx1ZQogICAgZnVuY3Rpb24gdXBkYXRlV2FsbGV0KGFkZHJlc3MgX25ld1dhbGxldCkgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9uZXdXYWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBfb2xkVmFsdWUgPSB3YWxsZXQ7CiAgICAgICAgd2FsbGV0ID0gX25ld1dhbGxldDsKICAgICAgICAKICAgICAgICBXYWxsZXRVcGRhdGVkKG1zZy5zZW5kZXIsIF9vbGRWYWx1ZSwgd2FsbGV0KTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBVcGRhdGVzIHRoZSBtaW5Db250cmlidXRpb24gcHJvcGV0eSB3aXRoIHRoZSBuZXcgX25ld01pbkNvbnRyb2J1dGlvbiB2YWx1ZQogICAgZnVuY3Rpb24gc2V0TWluQ29udHJpYnV0aW9uKHVpbnQyNTYgX25ld01pbkNvbnRyaWJ1dGlvbikgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9uZXdNaW5Db250cmlidXRpb24gPD0gbWF4Q29udHJpYnV0aW9uKTsKCiAgICAgICAgdWludDI1NiBfb2xkVmFsdWUgPSBtaW5Db250cmlidXRpb247CiAgICAgICAgbWluQ29udHJpYnV0aW9uID0gX25ld01pbkNvbnRyaWJ1dGlvbjsKICAgICAgICAKICAgICAgICBNaW5Db250cmlidXRpb25VcGRhdGVkKG1zZy5zZW5kZXIsIF9vbGRWYWx1ZSwgbWluQ29udHJpYnV0aW9uKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBVcGRhdGVzIHRoZSBtYXhDb250cmlidXRpb24gcHJvcGV0eSB3aXRoIHRoZSBuZXcgX25ld01heENvbnRyaWJ1dGlvbiB2YWx1ZQogICAgZnVuY3Rpb24gc2V0TWF4Q29udHJpYnV0aW9uKHVpbnQyNTYgX25ld01heENvbnRyaWJ1dGlvbikgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9uZXdNYXhDb250cmlidXRpb24gPiBtaW5Db250cmlidXRpb24pOwoKICAgICAgICB1aW50MjU2IF9vbGRWYWx1ZSA9IG1heENvbnRyaWJ1dGlvbjsKICAgICAgICBtYXhDb250cmlidXRpb24gPSBfbmV3TWF4Q29udHJpYnV0aW9uOwogICAgICAgIAogICAgICAgIE1heENvbnRyaWJ1dGlvblVwZGF0ZWQobXNnLnNlbmRlciwgX29sZFZhbHVlLCBtYXhDb250cmlidXRpb24pOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIE1haW4gcHVibGljIGZ1bmN0aW9uLgogICAgZnVuY3Rpb24gKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcHVyY2hhc2VUb2tlbnMoKTsKICAgIH0KCiAgICAvLyBSZXZva2VzIGEgcHJlc2FsZSBhbGxvY2F0aW9uIGZyb20gdGhlIGNvbnRyaWJ1dG9yIHdpdGggYWRkcmVzcyBfY29udHJpYnV0b3IKICAgIC8vIFVwZGF0ZXMgdGhlIHRvdGFsVG9rZW5zU29sZCBwcm9wZXJ0eSBzdWJzdHJhY3RpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB3aGVyZSBwcmV2aW91c2x5IGFsbG9jYXRlZAogICAgZnVuY3Rpb24gcmV2b2tlUHJlc2FsZShhZGRyZXNzIF9jb250cmlidXRvciwgdWludDggX2NvbnRyaWJ1dG9yUGhhc2UpIGV4dGVybmFsIG9ubHlBZG1pbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfY29udHJpYnV0b3IgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIFdlIGNhbiBvbmx5IHJldm9rZSBhbGxvY2F0aW9ucyBmcm9tIHByZSBzYWxlIG9yIHN0cmF0ZWdpYyBwYXJ0bmVycwogICAgICAgIC8vIENvbnRyaWJ1dGlvblBoYXNlLlByZVNhbGVDb250cmlidXRpb24gPT0gMCwgIENvbnRyaWJ1dGlvblBoYXNlLlBhcnRuZXJDb250cmlidXRpb24gPT0gMQogICAgICAgIHJlcXVpcmUoX2NvbnRyaWJ1dG9yUGhhc2UgPT0gMCB8fCBfY29udHJpYnV0b3JQaGFzZSA9PSAxKTsKCiAgICAgICAgdWludDI1NiBsdWNreXMgPSBsZWRnZXJDb250cmFjdC5yZXZva2VBbGxvY2F0aW9uKF9jb250cmlidXRvciwgX2NvbnRyaWJ1dG9yUGhhc2UpOwogICAgICAgIAogICAgICAgIHJlcXVpcmUobHVja3lzID4gMCk7CiAgICAgICAgcmVxdWlyZShsdWNreXMgPD0gdG90YWxUb2tlbnNTb2xkKTsKICAgICAgICAKICAgICAgICB0b3RhbFRva2Vuc1NvbGQgPSB0b3RhbFRva2Vuc1NvbGQuc3ViKGx1Y2t5cyk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQWRkcyBhIG5ldyBwcmVzYWxlIGFsbG9jYXRpb24gZm9yIHRoZSBjb250cmlidXRvciB3aXRoIGFkZHJlc3MgX2NvbnRyaWJ1dG9yCiAgICAvLyBXZSBjYW4gb25seSBhbGxvY2F0ZSBwcmVzYWxlIGJlZm9yZSB0aGUgdG9rZW4gc2FsZSBoYXMgYmVlbiBpbml0aWFsaXplZAogICAgZnVuY3Rpb24gYWRkUHJlc2FsZShhZGRyZXNzIF9jb250cmlidXRvciwgdWludDI1NiBfdG9rZW5zLCB1aW50MjU2IF9ib251cywgdWludDggX2NvbnRyaWJ1dG9yUGhhc2UpIGV4dGVybmFsIG9ubHlBZG1pbkFuZE9wcyBvbmx5QmVmb3JlU2FsZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG9rZW5zID4gMCk7CiAgICAgICAgcmVxdWlyZShfYm9udXMgPiAwKTsKCiAgICAgICAgLy8gQ29udmVydHMgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gb3VyIHNtYWxsZXN0IEo4VCB2YWx1ZSwgbHVja3kKICAgICAgICB1aW50MjU2IGx1Y2t5cyA9IF90b2tlbnMubXVsKEo4VF9ERUNJTUFMU19GQUNUT1IpOwogICAgICAgIHVpbnQyNTYgYm9udXNMdWNreXMgPSBfYm9udXMubXVsKEo4VF9ERUNJTUFMU19GQUNUT1IpOwogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnMgPSBsdWNreXMuYWRkKGJvbnVzTHVja3lzKTsKCiAgICAgICAgdWludDI1NiBhdmFpbGFibGVUb2tlbnNUb1B1cmNoYXNlID0gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZSh0b3RhbFRva2VucyA8PSBhdmFpbGFibGVUb2tlbnNUb1B1cmNoYXNlKTsKCiAgICAgICAgLy8gSW5zZXJ0IHRoZSBuZXcgYWxsb2NhdGlvbiB0byB0aGUgTGVkZ2VyCiAgICAgICAgcmVxdWlyZShsZWRnZXJDb250cmFjdC5hZGRBbGxvY2F0aW9uKF9jb250cmlidXRvciwgbHVja3lzLCBib251c0x1Y2t5cywgX2NvbnRyaWJ1dG9yUGhhc2UpKTsKICAgICAgICAvLyBUcmFuc2ZlcnMgdGhlIHRva2VucyBmb3JtIHRoZSBDcm93ZHNhbGUgY29udHJhY3QgdG8gdGhlIExlZGdlciBjb250cmFjdAogICAgICAgIHJlcXVpcmUodG9rZW5Db250cmFjdC50cmFuc2ZlcihhZGRyZXNzKGxlZGdlckNvbnRyYWN0KSwgdG90YWxUb2tlbnMpKTsKCiAgICAgICAgLy8gVXBkYXRlcyB0b3RhbFRva2Vuc1NvbGQgcHJvcGVydHkKICAgICAgICB0b3RhbFRva2Vuc1NvbGQgPSB0b3RhbFRva2Vuc1NvbGQuYWRkKHRvdGFsVG9rZW5zKTsKCiAgICAgICAgLy8gSWYgd2UgcmVhY2ggdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VsbCB3ZSBmaW5pbGl6ZSB0aGUgdG9rZW4gc2FsZQogICAgICAgIGF2YWlsYWJsZVRva2Vuc1RvUHVyY2hhc2UgPSB0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgICAgICBpZiAoYXZhaWxhYmxlVG9rZW5zVG9QdXJjaGFzZSA9PSAwKSB7CiAgICAgICAgICAgIGZpbmFsaXphdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgLy8gVHJpZ2dlciBQcmVzYWxlQWRkZWQgZXZlbnQKICAgICAgICBQcmVzYWxlQWRkZWQoX2NvbnRyaWJ1dG9yLCB0b3RhbFRva2VucywgX2NvbnRyaWJ1dG9yUGhhc2UpOwogICAgfQoKICAgIC8vIFRoZSBwdXJjaGFzZVRva2VucyBmdW5jdGlvbiBoYW5kbGVzIHRoZSB0b2tlbiBwdXJjaGFzZSBmbG93CiAgICBmdW5jdGlvbiBwdXJjaGFzZVRva2VucygpIHB1YmxpYyBwYXlhYmxlIG9ubHlEdXJpbmdTYWxlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhZGRyZXNzIGNvbnRyaWJ1dG9yID0gbXNnLnNlbmRlcjsKICAgICAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAgICAgLy8gQSBjb250cmlidXRvciBjYW4gb25seSBjb250cmlidXRlIG9uY2Ugb24gdGhlIHB1YmxpYyBzYWxlCiAgICAgICAgcmVxdWlyZShoYXNDb250cmlidXRlZFtjb250cmlidXRvcl0gPT0gZmFsc2UpOwogICAgICAgIC8vIFRoZSBjb250cmlidXRvciBhZGRyZXNzIG11c3QgYmUgd2hpdGVsaXN0ZWQgaW4gb3JkZXIgdG8gYmUgYWJsZSB0byBwdXJjaGFzZSB0b2tlbnMKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dG9yQ2FuQ29udHJpYnV0ZShjb250cmlidXRvcikpOwogICAgICAgIC8vIFRoZSB3ZWlBbW91bnQgbXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRoYW4gbWluQ29udHJpYnV0aW9uCiAgICAgICAgcmVxdWlyZSh3ZWlBbW91bnQgPj0gbWluQ29udHJpYnV0aW9uKTsKICAgICAgICAvLyBUaGUgd2VpQW1vdW50IGNhbm5vdCBiZSBncmVhdGVyIHRoYW4gbWF4Q29udHJpYnV0aW9uCiAgICAgICAgcmVxdWlyZSh3ZWlBbW91bnQgPD0gbWF4Q29udHJpYnV0aW9uKTsKICAgICAgICAvLyBUaGUgYXZhaWxhYmxlVG9rZW5zVG9QdXJjaGFzZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwCiAgICAgICAgcmVxdWlyZSh0b3RhbFRva2Vuc1NvbGQgPCBUT0tFTl9TQUxFX1NVUFBMWSk7CiAgICAgICAgdWludDI1NiBhdmFpbGFibGVUb2tlbnNUb1B1cmNoYXNlID0gVE9LRU5fU0FMRV9TVVBQTFkuc3ViKHRvdGFsVG9rZW5zU29sZCk7CgogICAgICAgIC8vIFdlIG5lZWQgdG8gY29udmVydCB0aGUgdG9rZW5zUGVyRXRoZXIgdG8gbHVja3lzICgxMCoqOCkKICAgICAgICB1aW50MjU2IGx1Y2t5UGVyRXRoZXIgPSB0b2tlbnNQZXJFdGhlci5tdWwoSjhUX0RFQ0lNQUxTX0ZBQ1RPUik7CgogICAgICAgIC8vIEluIG9yZGVyIHRvIGNhbGN1bGF0ZSB0aGUgdG9rZW5zIGFtb3VudCB0byBiZSBhbGxvY2F0ZWQgdG8gdGhlIGNvbnRyYnV0b3IKICAgICAgICAvLyB3ZSBuZWVkIHRvIG11bHRpcGx5IHRoZSBhbW91bnQgb2Ygd2VpIHNlbnQgYnkgbHVja3lQZXJFdGhlciBhbmQgZGl2aWRlIHRoZQogICAgICAgIC8vIHJlc3VsdCBmb3IgdGhlIGV0aGVyIGRlY2ltYWwgZmFjdG9yICgxMCoqMTgpCiAgICAgICAgdWludDI1NiB0b2tlbnNBbW91bnQgPSB3ZWlBbW91bnQubXVsKGx1Y2t5UGVyRXRoZXIpLmRpdihFVEhfREVDSU1BTFNfRkFDVE9SKTsKICAgICAgICAKCiAgICAgICAgdWludDI1NiByZWZ1bmQgPSAwOwogICAgICAgIHVpbnQyNTYgdG9rZW5zVG9QdXJjaGFzZSA9IHRva2Vuc0Ftb3VudDsKICAgICAgICAKICAgICAgICAvLyBJZiB0aGUgdG9rZW4gcHVyY2hhc2UgYW1vdW50IGlzIGJpZ2dlciB0aGFuIHRoZSByZW1haW5pbmcgdG9rZW4gYWxsb2NhdGlvbgogICAgICAgIC8vIHdlIGNhbiBvbmx5IHNlbGwgdGhlIHJlbWFpbmdpbmcgdG9rZW5zIGFuZCByZWZ1bmQgdGhlIHVudXNlZCBhbW91bnQgb2YgZXRoCiAgICAgICAgaWYgKGF2YWlsYWJsZVRva2Vuc1RvUHVyY2hhc2UgPCB0b2tlbnNBbW91bnQpIHsKICAgICAgICAgICAgdG9rZW5zVG9QdXJjaGFzZSA9IGF2YWlsYWJsZVRva2Vuc1RvUHVyY2hhc2U7CiAgICAgICAgICAgIHdlaUFtb3VudCA9IHRva2Vuc1RvUHVyY2hhc2UubXVsKEVUSF9ERUNJTUFMU19GQUNUT1IpLmRpdihsdWNreVBlckV0aGVyKTsKICAgICAgICAgICAgcmVmdW5kID0gbXNnLnZhbHVlLnN1Yih3ZWlBbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgLy8gV2UgdXBkYXRlIHRoZSB0b2tlbiBzYWxlIGNvbnRyYWN0IGRhdGEKICAgICAgICB0b3RhbFRva2Vuc1NvbGQgPSB0b3RhbFRva2Vuc1NvbGQuYWRkKHRva2Vuc1RvUHVyY2hhc2UpOwogICAgICAgIHVpbnQyNTYgd2VpVG9QdXJjaGFzZSA9IHRva2Vuc1RvUHVyY2hhc2UuZGl2KHRva2Vuc1BlckV0aGVyKTsKICAgICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaVRvUHVyY2hhc2UpOwoKICAgICAgICAvLyBUcmFuc2ZlcnMgdGhlIHRva2VucyBmb3JtIHRoZSBDcm93ZHNhbGUgY29udHJhY3QgdG8gY29udHJpdXRvcnMgd2FsbGV0CiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0LnRyYW5zZmVyKGNvbnRyaWJ1dG9yLCB0b2tlbnNUb1B1cmNoYXNlKSk7CgogICAgICAgIC8vIElzc3VlIGEgcmVmdW5kIGZvciBhbnkgdW51c2VkIGV0aGVyIAogICAgICAgIGlmIChyZWZ1bmQgPiAwKSB7CiAgICAgICAgICAgIGNvbnRyaWJ1dG9yLnRyYW5zZmVyKHJlZnVuZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBUcmFuc2ZlciBldGhlciBjb250cmlidXRpb24gdG8gdGhlIHdhbGxldAogICAgICAgIHdhbGxldC50cmFuc2Zlcih3ZWlBbW91bnQpOwoKICAgICAgICAvLyBVcGRhdGUgaGFzQ29udHJpYnV0ZWQgbWFwcGluZwogICAgICAgIGhhc0NvbnRyaWJ1dGVkW2NvbnRyaWJ1dG9yXSA9IHRydWU7CgogICAgICAgIFRva2Vuc1B1cmNoYXNlZChjb250cmlidXRvciwgdG9rZW5zVG9QdXJjaGFzZSk7CgogICAgICAgIC8vIElmIHdlIHJlYWNoIHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbGwgd2UgZmluaWxpemUgdGhlIHRva2VuIHNhbGUKICAgICAgICBpZiAodG90YWxUb2tlbnNTb2xkID09IFRPS0VOX1NBTEVfU1VQUExZKSB7CiAgICAgICAgICAgIGZpbmFsaXphdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gVXBkYXRlcyB0aGUgd2hpdGVsaXN0CiAgICBmdW5jdGlvbiB1cGRhdGVXaGl0ZWxpc3QoYWRkcmVzcyBfYWNjb3VudCwgV2hpdGVsaXN0UGVybWlzc2lvbiBfcGVybWlzc2lvbikgZXh0ZXJuYWwgb25seUFkbWluQW5kT3BzIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9hY2NvdW50ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3Blcm1pc3Npb24gPT0gV2hpdGVsaXN0UGVybWlzc2lvbi5QcmVTYWxlQ29udHJpYnV0b3IgfHwgX3Blcm1pc3Npb24gPT0gV2hpdGVsaXN0UGVybWlzc2lvbi5QdWJsaWNTYWxlQ29udHJpYnV0b3IgfHwgX3Blcm1pc3Npb24gPT0gV2hpdGVsaXN0UGVybWlzc2lvbi5DYW5ub3RDb250cmlidXRlKTsKICAgICAgICByZXF1aXJlKCFzYWxlSGFzRmluaXNoZWQoKSk7CgogICAgICAgIHdoaXRlbGlzdFtfYWNjb3VudF0gPSBfcGVybWlzc2lvbjsKCiAgICAgICAgYWRkcmVzcyBfd2hvID0gbXNnLnNlbmRlcjsKICAgICAgICBXaGl0ZUxpc3RVcGRhdGVkKF93aG8sIF9hY2NvdW50LCBfcGVybWlzc2lvbik7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVdoaXRlbGlzdF9iYXRjaChhZGRyZXNzW10gX2FjY291bnRzLCBXaGl0ZWxpc3RQZXJtaXNzaW9uIF9wZXJtaXNzaW9uKSBleHRlcm5hbCBvbmx5QWRtaW5BbmRPcHMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3Blcm1pc3Npb24gPT0gV2hpdGVsaXN0UGVybWlzc2lvbi5QcmVTYWxlQ29udHJpYnV0b3IgfHwgX3Blcm1pc3Npb24gPT0gV2hpdGVsaXN0UGVybWlzc2lvbi5QdWJsaWNTYWxlQ29udHJpYnV0b3IgfHwgX3Blcm1pc3Npb24gPT0gV2hpdGVsaXN0UGVybWlzc2lvbi5DYW5ub3RDb250cmlidXRlKTsKICAgICAgICByZXF1aXJlKCFzYWxlSGFzRmluaXNoZWQoKSk7CgogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgX2FjY291bnRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoX2FjY291bnRzW2ldICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICB3aGl0ZWxpc3RbX2FjY291bnRzW2ldXSA9IF9wZXJtaXNzaW9uOwogICAgICAgICAgICBXaGl0ZUxpc3RVcGRhdGVkKG1zZy5zZW5kZXIsIF9hY2NvdW50c1tpXSwgX3Blcm1pc3Npb24pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQ2hlY2tzIHRoYXQgdGhlIHN0YXR1cyBvZiBhbiBhZGRyZXNzIGFjY291bnQKICAgIC8vIENvbnRyaWJ1dG9ycyBvZiB0aGUgdG9rZW4gc2FsZSBhcmUgc2VnbWVudGVkIGFzOgogICAgLy8gIFByZVNhbGVDb250cmlidXRvcjogQ2FuIGNvbnRyaWJ1dGUgb24gYm90aCBwcmUtc2FsZSBhbmQgcHViaWMgc2FsZSBwaGFzZXMKICAgIC8vICBQdWJsaWNTYWxlQ29udHJpYnV0b3I6IENhbiBjb250cmlidXRlIG9uIGhlIHB1YmxpYyBzYWxlIHBoYXNlCiAgICAvLyAgQ2Fubm90Q29udHJpYnV0ZTogQ2Fubm90IGNvbnRyaWJ1dGUgaW4gYW55IHBoYXNlCiAgICBmdW5jdGlvbiBjb250cmlidXRvckNhbkNvbnRyaWJ1dGUoYWRkcmVzcyBfY29udHJpYnV0b3JBZGRyZXNzKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIFdoaXRlbGlzdFBlcm1pc3Npb24gX2NvbnRyaWJ1dG9yUGhhc2UgPSB3aGl0ZWxpc3RbX2NvbnRyaWJ1dG9yQWRkcmVzc107CgogICAgICAgIGlmIChfY29udHJpYnV0b3JQaGFzZSA9PSBXaGl0ZWxpc3RQZXJtaXNzaW9uLkNhbm5vdENvbnRyaWJ1dGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKF9jb250cmlidXRvclBoYXNlID09IFdoaXRlbGlzdFBlcm1pc3Npb24uUHJlU2FsZUNvbnRyaWJ1dG9yIHx8IAogICAgICAgICAgICBfY29udHJpYnV0b3JQaGFzZSA9PSBXaGl0ZWxpc3RQZXJtaXNzaW9uLlB1YmxpY1NhbGVDb250cmlidXRvcikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBjdXJyZW50IHRpbWUKICAgIGZ1bmN0aW9uIGN1cnJlbnRUaW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBub3c7CiAgICB9CgogICAgLy8gQ2hlY2tzIGlmIHRoZSBzYWxlIGhhcyBmaW5pc2hlZAogICAgZnVuY3Rpb24gc2FsZUhhc0ZpbmlzaGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChpc0ZpbmFsaXplZCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChlbmRUaW1lc3RhbXAgPCBjdXJyZW50VGltZSgpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRvdGFsVG9rZW5zU29sZCA9PSBUT0tFTl9TQUxFX1NVUFBMWSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QmVmb3JlU2FsZSgpIHsKICAgICAgICByZXF1aXJlKGN1cnJlbnRUaW1lKCkgPCBzdGFydFRpbWVzdGFtcCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RHVyaW5nU2FsZSgpIHsKICAgICAgICB1aW50MjU2IF9jdXJyZW50VGltZSA9IGN1cnJlbnRUaW1lKCk7CiAgICAgICAgcmVxdWlyZShzdGFydFRpbWVzdGFtcCA8IF9jdXJyZW50VGltZSk7CiAgICAgICAgcmVxdWlyZShfY3VycmVudFRpbWUgPCBlbmRUaW1lc3RhbXApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVBvc3RTYWxlKCkgewogICAgICAgIHJlcXVpcmUoZW5kVGltZXN0YW1wIDwgY3VycmVudFRpbWUoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUFJJVkFURSBGVU5DVElPTlMgLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gVGhpcyBtZXRob2QgaXMgZm9yIHRvIGJlIGNhbGxlZCBvbmx5IGZvciB0aGUgb3duZXIuIFRoaXMgd2F5IHdlIHByb3RlY3QgZm9yIGFueW9uZSB3aG8gd2FubmEgZmluYWxpemUgdGhlIElDTy4KICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgZXh0ZXJuYWwgb25seUFkbWluIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZmluYWxpemF0aW9uKCk7CiAgICB9CgogICAgLy8gT25seSB1c2VkIGJ5IGZpbmFsaXplIGFuZCBzZXRGaW5hbGl6ZWQuCiAgICAvLyBPdmVybG9hZGVkIGxvZ2ljIGZvciB0d28gdXNlcy4KICAgIC8vIE5PVEU6IEluIGNhc2UgZmluYWxpemUgaXMgY2FsbGVkIGJ5IGFuIHVzZXIgYW5kIG5vdCBmcm9tIGFkZFByZXNhbGUoKS9wdXJjaGFzZVRva2VuKCkKICAgIC8vIHdpbGwgZGlmZiB0b3RhbCBzdXBwbHkgd2l0aCBzb2xkIHN1cHBseSB0byBidXJuIHRva2VuLgogICAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgcHJpdmF0ZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwoKICAgICAgICBpc0ZpbmFsaXplZCA9IHRydWU7CgogICAgICAgIAogICAgICAgIGlmICh0b3RhbFRva2Vuc1NvbGQgPCBUT0tFTl9TQUxFX1NVUFBMWSkgewogICAgICAgICAgICB1aW50MjU2IHRvQnVybiA9IFRPS0VOX1NBTEVfU1VQUExZLnN1Yih0b3RhbFRva2Vuc1NvbGQpOwogICAgICAgICAgICB0b2tlbkNvbnRyYWN0LmJ1cm4odG9CdXJuKTsKICAgICAgICAgICAgQnVybmVkKG1zZy5zZW5kZXIsIHRvQnVybiwgY3VycmVudFRpbWUoKSk7CiAgICAgICAgfQoKICAgICAgICBGaW5hbGl6ZWQobXNnLnNlbmRlciwgY3VycmVudFRpbWUoKSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhbGVTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRva2VuQ29udHJhY3QuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgfQp9'.
	

]
