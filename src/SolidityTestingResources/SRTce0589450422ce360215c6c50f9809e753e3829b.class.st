Class {
	#name : #SRTce0589450422ce360215c6c50f9809e753e3829b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTce0589450422ce360215c6c50f9809e753e3829b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAgIC8qKgogICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAgKiBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKfQoKLyoqCiAqIEB0aXRsZSBDb250cmFjdHMgdGhhdCBzaG91bGQgbm90IG93biBFdGhlcgogKiBAYXV0aG9yIFJlbWNvIEJsb2VtZW4gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNDMzMTI2MmUyMDJjMDM3MSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj7PgC5jb20+CiAqIEBkZXYgVGhpcyB0cmllcyB0byBibG9jayBpbmNvbWluZyBldGhlciB0byBwcmV2ZW50IGFjY2lkZW50YWwgbG9zcyBvZiBFdGhlci4gU2hvdWxkIEV0aGVyIGVuZCB1cAogKiBpbiB0aGUgY29udHJhY3QsIGl0IHdpbGwgYWxsb3cgdGhlIG93bmVyIHRvIHJlY2xhaW0gdGhpcyBldGhlci4KICogQG5vdGljZSBFdGhlciBjYW4gc3RpbGwgYmUgc2VuZCB0byB0aGlzIGNvbnRyYWN0IGJ5OgogKiBjYWxsaW5nIGZ1bmN0aW9ucyBsYWJlbGVkIGBwYXlhYmxlYAogKiBgc2VsZmRlc3RydWN0KGNvbnRyYWN0X2FkZHJlc3MpYAogKiBtaW5pbmcgZGlyZWN0bHkgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MKKi8KY29udHJhY3QgSGFzTm9FdGhlciBpcyBPd25hYmxlIHsKCiAgICAvKioKICAgICogQGRldiBDb25zdHJ1Y3RvciB0aGF0IHJlamVjdHMgaW5jb21pbmcgRXRoZXIKICAgICogQGRldiBUaGUgYHBheWFibGVgIGZsYWcgaXMgYWRkZWQgc28gd2UgY2FuIGFjY2VzcyBgbXNnLnZhbHVlYCB3aXRob3V0IGNvbXBpbGVyIHdhcm5pbmcuIElmIHdlCiAgICAqIGxlYXZlIG91dCBwYXlhYmxlLCB0aGVuIFNvbGlkaXR5IHdpbGwgYWxsb3cgaW5oZXJpdGluZyBjb250cmFjdHMgdG8gaW1wbGVtZW50IGEgcGF5YWJsZQogICAgKiBjb25zdHJ1Y3Rvci4gQnkgZG9pbmcgaXQgdGhpcyB3YXkgd2UgcHJldmVudCBhIHBheWFibGUgY29uc3RydWN0b3IgZnJvbSB3b3JraW5nLiBBbHRlcm5hdGl2ZWx5CiAgICAqIHdlIGNvdWxkIHVzZSBhc3NlbWJseSB0byBhY2Nlc3MgbXNnLnZhbHVlLgogICAgKi8KICAgIGZ1bmN0aW9uIEhhc05vRXRoZXIoKSBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRGlzYWxsb3dzIGRpcmVjdCBzZW5kIGJ5IHNldHRpbmdzIGEgZGVmYXVsdCBmdW5jdGlvbiB3aXRob3V0IHRoZSBgcGF5YWJsZWAgZmxhZy4KICAgICAqLwogICAgZnVuY3Rpb24oKSBleHRlcm5hbCB7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVyIGFsbCBFdGhlciBoZWxkIGJ5IHRoZSBjb250cmFjdCB0byB0aGUgb3duZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlY2xhaW1FdGhlcigpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgYXNzZXJ0KG93bmVyLnNlbmQodGhpcy5iYWxhbmNlKSk7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KfQoKLyoqCiAqIEZpeGVkIGNyb3dkc2FsZSBwcmljaW5nIC0gZXZlcnlib2R5IGdldHMgdGhlIHNhbWUgcHJpY2UuCiAqLwpjb250cmFjdCBQcmljaW5nU3RyYXRlZ3kgaXMgSGFzTm9FdGhlciB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICAvKiBIb3cgbWFueSB3ZWlzIG9uZSB0b2tlbiBjb3N0cyAqLwogICAgdWludDI1NiBwdWJsaWMgb25lVG9rZW5JbldlaTsKCiAgICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGVBZGRyZXNzOwoKICAgIGZ1bmN0aW9uIFByaWNpbmdTdHJhdGVneShhZGRyZXNzIF9jcm93ZHNhbGUpIHsKICAgICAgICBjcm93ZHNhbGVBZGRyZXNzID0gX2Nyb3dkc2FsZTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q3Jvd2RzYWxlKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjcm93ZHNhbGVBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHRoZSBjdXJyZW50IHByaWNlIGZvciBidXkgaW4gYW1vdW50LgogICAgICoKICAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2RlY2ltYWxzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQyNTYgbXVsdGlwbGllciA9IDEwICoqIF9kZWNpbWFsczsKICAgICAgICB1aW50MjU2IHdlaUFtb3VudCA9IF92YWx1ZS5tdWwobXVsdGlwbGllcik7CiAgICAgICAgdWludDI1NiB0b2tlbnMgPSB3ZWlBbW91bnQuZGl2KG9uZVRva2VuSW5XZWkpOwogICAgICAgIHJldHVybiB0b2tlbnM7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5QcmljZUluV2VpKHVpbnQgX29uZVRva2VuSW5XZWkpIG9ubHlDcm93ZHNhbGUgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBvbmVUb2tlbkluV2VpID0gX29uZVRva2VuSW5XZWk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgICBldmVudCBQYXVzZSgpOwogICAgZXZlbnQgVW5wYXVzZSgpOwoKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgICAvKioKICAgICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgICAqLwogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgICAqLwogICAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgICovCiAgICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBQYXVzZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICAgIFVucGF1c2UoKTsKICAgIH0KfQoKY29udHJhY3QgUk5UTXVsdGlTaWdXYWxsZXQgewogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgQ29uZmlybWF0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKCiAgICBldmVudCBSZXZvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKCiAgICBldmVudCBTdWJtaXNzaW9uKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKCiAgICBldmVudCBFeGVjdXRpb24odWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwoKICAgIGV2ZW50IEV4ZWN1dGlvbkZhaWx1cmUodWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwoKICAgIGV2ZW50IERlcG9zaXQoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgdWludCB2YWx1ZSk7CgogICAgZXZlbnQgT3duZXJBZGRpdGlvbihhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwoKICAgIGV2ZW50IE93bmVyUmVtb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwoKICAgIGV2ZW50IFJlcXVpcmVtZW50Q2hhbmdlKHVpbnQgcmVxdWlyZWQpOwoKICAgIGV2ZW50IFBhdXNlKCk7CgogICAgZXZlbnQgVW5wYXVzZSgpOwoKICAgIC8qCiAgICAgKiAgQ29uc3RhbnRzCiAgICAgKi8KICAgIHVpbnQgY29uc3RhbnQgcHVibGljIE1BWF9PV05FUl9DT1VOVCA9IDEwOwoKICAgIHVpbnQgY29uc3RhbnQgcHVibGljIEFETUlOU19DT1VOVCA9IDI7CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIG1hcHBpbmcodWludCA9PiBXYWxsZXRUcmFuc2FjdGlvbikgcHVibGljIHRyYW5zYWN0aW9uczsKCiAgICBtYXBwaW5nKHVpbnQgPT4gbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpKSBwdWJsaWMgY29uZmlybWF0aW9uczsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzT3duZXI7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0FkbWluOwoKICAgIGFkZHJlc3NbXSBwdWJsaWMgb3duZXJzOwoKICAgIGFkZHJlc3NbXSBwdWJsaWMgYWRtaW5zOwoKICAgIHVpbnQgcHVibGljIHJlcXVpcmVkOwoKICAgIHVpbnQgcHVibGljIHRyYW5zYWN0aW9uQ291bnQ7CgogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogICAgc3RydWN0IFdhbGxldFRyYW5zYWN0aW9uIHsKICAgICAgICBhZGRyZXNzIHNlbmRlcjsKICAgICAgICBhZGRyZXNzIGRlc3RpbmF0aW9uOwogICAgICAgIHVpbnQgdmFsdWU7CiAgICAgICAgYnl0ZXMgZGF0YTsKICAgICAgICBib29sIGV4ZWN1dGVkOwogICAgfQoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2FsbGV0KCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICByZXF1aXJlKCFpc093bmVyW293bmVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvd25lckV4aXN0cyhhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgcmVxdWlyZShpc093bmVyW293bmVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBhZG1pbkV4aXN0cyhhZGRyZXNzIGFkbWluKSB7CiAgICAgICAgcmVxdWlyZShpc0FkbWluW2FkbWluXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBhZG1pbkRvZXNOb3RFeGlzdChhZGRyZXNzIGFkbWluKSB7CiAgICAgICAgcmVxdWlyZSghaXNBZG1pblthZG1pbl0pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdHJhbnNhY3Rpb25FeGlzdHModWludCB0cmFuc2FjdGlvbklkKSB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0uZGVzdGluYXRpb24gIT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBjb25maXJtZWQodWludCB0cmFuc2FjdGlvbklkLCBhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgcmVxdWlyZShjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RDb25maXJtZWQodWludCB0cmFuc2FjdGlvbklkLCBhZGRyZXNzIG93bmVyKSB7CiAgICAgICAgcmVxdWlyZSghY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcl0pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90RXhlY3V0ZWQodWludCB0cmFuc2FjdGlvbklkKSB7CiAgICAgICAgaWYgKHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5leGVjdXRlZCkKICAgICAgICAgICAgcmVxdWlyZShmYWxzZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3ROdWxsKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRSZXF1aXJlbWVudCh1aW50IG93bmVyQ291bnQsIHVpbnQgX3JlcXVpcmVkKSB7CiAgICAgICAgaWYgKG93bmVyQ291bnQgPiBNQVhfT1dORVJfQ09VTlQKICAgICAgICB8fCBfcmVxdWlyZWQgPiBvd25lckNvdW50CiAgICAgICAgfHwgX3JlcXVpcmVkID09IDAKICAgICAgICB8fCBvd25lckNvdW50ID09IDApIHsKICAgICAgICAgICAgcmVxdWlyZShmYWxzZSk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRBZG1pbnNDb3VudCh1aW50IGFkbWluc0NvdW50KSB7CiAgICAgICAgcmVxdWlyZShhZG1pbnNDb3VudCA9PSBBRE1JTlNfQ09VTlQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gYWxsb3dzIHRvIGRlcG9zaXQgZXRoZXIuCiAgICBmdW5jdGlvbigpCiAgICB3aGVuTm90UGF1c2VkCiAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IDApCiAgICAgICAgICAgIERlcG9zaXQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvKgogICAgICogUHVibGljIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBzZXRzIGluaXRpYWwgYWRtaW5zIGFuZCByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucy4KICAgIC8vLyBAcGFyYW0gX2FkbWlucyBMaXN0IG9mIGluaXRpYWwgb3duZXJzLgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBSTlRNdWx0aVNpZ1dhbGxldChhZGRyZXNzW10gX2FkbWlucywgdWludCBfcmVxdWlyZWQpCiAgICBwdWJsaWMKICAgICAgICAvLyAgICB2YWxpZEFkbWluc0NvdW50KF9hZG1pbnMubGVuZ3RoKQogICAgICAgIC8vICAgIHZhbGlkUmVxdWlyZW1lbnQoX2FkbWlucy5sZW5ndGgsIF9yZXF1aXJlZCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYWRtaW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUoX2FkbWluc1tpXSAhPSAwICYmICFpc093bmVyW19hZG1pbnNbaV1dICYmICFpc0FkbWluW19hZG1pbnNbaV1dKTsKICAgICAgICAgICAgaXNBZG1pbltfYWRtaW5zW2ldXSA9IHRydWU7CiAgICAgICAgICAgIGlzT3duZXJbX2FkbWluc1tpXV0gPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYWRtaW5zID0gX2FkbWluczsKICAgICAgICBvd25lcnMgPSBfYWRtaW5zOwogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgfQoKICAgIC8vLyBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgIGZ1bmN0aW9uIHBhdXNlKCkgYWRtaW5FeGlzdHMobXNnLnNlbmRlcikgd2hlbk5vdFBhdXNlZCBwdWJsaWMgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICAgICAgUGF1c2UoKTsKICAgIH0KCiAgICAvLy8gQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgYWRtaW5FeGlzdHMobXNnLnNlbmRlcikgd2hlblBhdXNlZCBwdWJsaWMgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICAgIFVucGF1c2UoKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gYWRkIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgZnVuY3Rpb24gYWRkT3duZXIoYWRkcmVzcyBvd25lcikKICAgIHB1YmxpYwogICAgd2hlbk5vdFBhdXNlZAogICAgYWRtaW5FeGlzdHMobXNnLnNlbmRlcikKICAgIG93bmVyRG9lc05vdEV4aXN0KG93bmVyKQogICAgbm90TnVsbChvd25lcikKICAgIHZhbGlkUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCArIDEsIHJlcXVpcmVkKQogICAgewogICAgICAgIGlzT3duZXJbb3duZXJdID0gdHJ1ZTsKICAgICAgICBvd25lcnMucHVzaChvd25lcik7CiAgICAgICAgT3duZXJBZGRpdGlvbihvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHJlbW92ZSBhbiBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG93bmVyLgogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBvd25lcikKICAgIHB1YmxpYwogICAgd2hlbk5vdFBhdXNlZAogICAgYWRtaW5FeGlzdHMobXNnLnNlbmRlcikKICAgIGFkbWluRG9lc05vdEV4aXN0KG93bmVyKQogICAgb3duZXJFeGlzdHMob3duZXIpCiAgICB7CiAgICAgICAgaXNPd25lcltvd25lcl0gPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoIC0gMTsgaSsrKQogICAgICAgICAgICBpZiAob3duZXJzW2ldID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBvd25lcnNbb3duZXJzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICBvd25lcnMubGVuZ3RoIC09IDE7CiAgICAgICAgaWYgKHJlcXVpcmVkID4gb3duZXJzLmxlbmd0aCkKICAgICAgICAgICAgY2hhbmdlUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCk7CiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gcmVwbGFjZSBhbiBvd25lciB3aXRoIGEgbmV3IG93bmVyLiBUcmFuc2FjdGlvbiBoYXMgdG8gYmUgc2VudCBieSB3YWxsZXQuCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2Ygb3duZXIgdG8gYmUgcmVwbGFjZWQuCiAgICAvLy8gQHBhcmFtIG5ld093bmVyIEFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgZnVuY3Rpb24gcmVwbGFjZU93bmVyKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgbmV3T3duZXIpCiAgICBwdWJsaWMKICAgIHdoZW5Ob3RQYXVzZWQKICAgIGFkbWluRXhpc3RzKG1zZy5zZW5kZXIpCiAgICBhZG1pbkRvZXNOb3RFeGlzdChvd25lcikKICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgb3duZXJEb2VzTm90RXhpc3QobmV3T3duZXIpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3duZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAob3duZXJzW2ldID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBuZXdPd25lcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgaXNPd25lcltvd25lcl0gPSBmYWxzZTsKICAgICAgICBpc093bmVyW25ld093bmVyXSA9IHRydWU7CiAgICAgICAgT3duZXJSZW1vdmFsKG93bmVyKTsKICAgICAgICBPd25lckFkZGl0aW9uKG5ld093bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gY2hhbmdlIHRoZSBudW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCkKICAgIHB1YmxpYwogICAgd2hlbk5vdFBhdXNlZAogICAgYWRtaW5FeGlzdHMobXNnLnNlbmRlcikKICAgIHZhbGlkUmVxdWlyZW1lbnQob3duZXJzLmxlbmd0aCwgX3JlcXVpcmVkKQogICAgewogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgICAgIFJlcXVpcmVtZW50Q2hhbmdlKF9yZXF1aXJlZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFuIG93bmVyIHRvIHN1Ym1pdCBhbmQgY29uZmlybSBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBUcmFuc2FjdGlvbiB0YXJnZXQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdmFsdWUgVHJhbnNhY3Rpb24gZXRoZXIgdmFsdWUuCiAgICAvLy8gQHBhcmFtIGRhdGEgVHJhbnNhY3Rpb24gZGF0YSBwYXlsb2FkLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0cmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIHN1Ym1pdFRyYW5zYWN0aW9uKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpCiAgICBwdWJsaWMKICAgIHdoZW5Ob3RQYXVzZWQKICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICByZXR1cm5zICh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgdHJhbnNhY3Rpb25JZCA9IGFkZFRyYW5zYWN0aW9uKGRlc3RpbmF0aW9uLCB2YWx1ZSwgZGF0YSk7CiAgICAgICAgY29uZmlybVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiBjb25maXJtVHJhbnNhY3Rpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgcHVibGljCiAgICB3aGVuTm90UGF1c2VkCiAgICBvd25lckV4aXN0cyhtc2cuc2VuZGVyKQogICAgdHJhbnNhY3Rpb25FeGlzdHModHJhbnNhY3Rpb25JZCkKICAgIG5vdENvbmZpcm1lZCh0cmFuc2FjdGlvbklkLCBtc2cuc2VuZGVyKQogICAgewogICAgICAgIGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCB0cmFuc2FjdGlvbklkKTsKICAgICAgICBleGVjdXRlVHJhbnNhY3Rpb24odHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFuIG93bmVyIHRvIHJldm9rZSBhIGNvbmZpcm1hdGlvbiBmb3IgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIHJldm9rZUNvbmZpcm1hdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBwdWJsaWMKICAgIHdoZW5Ob3RQYXVzZWQKICAgIG93bmVyRXhpc3RzKG1zZy5zZW5kZXIpCiAgICBjb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikKICAgIG5vdEV4ZWN1dGVkKHRyYW5zYWN0aW9uSWQpCiAgICB7CiAgICAgICAgY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVttc2cuc2VuZGVyXSA9IGZhbHNlOwogICAgICAgIFJldm9jYXRpb24obXNnLnNlbmRlciwgdHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFueW9uZSB0byBleGVjdXRlIGEgY29uZmlybWVkIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gZXhlY3V0ZVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHB1YmxpYwogICAgd2hlbk5vdFBhdXNlZAogICAgb3duZXJFeGlzdHMobXNnLnNlbmRlcikKICAgIGNvbmZpcm1lZCh0cmFuc2FjdGlvbklkLCBtc2cuc2VuZGVyKQogICAgbm90RXhlY3V0ZWQodHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICBpZiAoaXNDb25maXJtZWQodHJhbnNhY3Rpb25JZCkpIHsKICAgICAgICAgICAgV2FsbGV0VHJhbnNhY3Rpb24gc3RvcmFnZSB3YWxsZXRUcmFuc2FjdGlvbiA9IHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXTsKICAgICAgICAgICAgd2FsbGV0VHJhbnNhY3Rpb24uZXhlY3V0ZWQgPSB0cnVlOwogICAgICAgICAgICBpZiAod2FsbGV0VHJhbnNhY3Rpb24uZGVzdGluYXRpb24uY2FsbC52YWx1ZSh3YWxsZXRUcmFuc2FjdGlvbi52YWx1ZSkod2FsbGV0VHJhbnNhY3Rpb24uZGF0YSkpCiAgICAgICAgICAgICAgICBFeGVjdXRpb24odHJhbnNhY3Rpb25JZCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRXhlY3V0aW9uRmFpbHVyZSh0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgICAgIHdhbGxldFRyYW5zYWN0aW9uLmV4ZWN1dGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY29uZmlybWF0aW9uIHN0YXR1cyBvZiBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgLy8vIEByZXR1cm4gQ29uZmlybWF0aW9uIHN0YXR1cy4KICAgIGZ1bmN0aW9uIGlzQ29uZmlybWVkKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pCiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgICAgICAgICBpZiAoY291bnQgPT0gcmVxdWlyZWQpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgICovCiAgICAvLy8gQGRldiBBZGRzIGEgbmV3IHRyYW5zYWN0aW9uIHRvIHRoZSB0cmFuc2FjdGlvbiBtYXBwaW5nLCBpZiB0cmFuc2FjdGlvbiBkb2VzIG5vdCBleGlzdCB5ZXQuCiAgICAvLy8gQHBhcmFtIGRlc3RpbmF0aW9uIFRyYW5zYWN0aW9uIHRhcmdldCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUcmFuc2FjdGlvbiBldGhlciB2YWx1ZS4KICAgIC8vLyBAcGFyYW0gZGF0YSBUcmFuc2FjdGlvbiBkYXRhIHBheWxvYWQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gYWRkVHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkKICAgIGludGVybmFsCiAgICBub3ROdWxsKGRlc3RpbmF0aW9uKQogICAgcmV0dXJucyAodWludCB0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIHRyYW5zYWN0aW9uSWQgPSB0cmFuc2FjdGlvbkNvdW50OwogICAgICAgIHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXSA9IFdhbGxldFRyYW5zYWN0aW9uKHsKICAgICAgICAgICAgc2VuZGVyIDogbXNnLnNlbmRlciwKICAgICAgICAgICAgZGVzdGluYXRpb24gOiBkZXN0aW5hdGlvbiwKICAgICAgICAgICAgdmFsdWUgOiB2YWx1ZSwKICAgICAgICAgICAgZGF0YSA6IGRhdGEsCiAgICAgICAgICAgIGV4ZWN1dGVkIDogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgdHJhbnNhY3Rpb25Db3VudCArPSAxOwogICAgICAgIFN1Ym1pc3Npb24odHJhbnNhY3Rpb25JZCk7CiAgICB9CgogICAgLyoKICAgICAqIFdlYjMgY2FsbCBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBvZiBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBnZXRDb25maXJtYXRpb25Db3VudCh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zICh1aW50IGNvdW50KQogICAgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG93bmVycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0b3RhbCBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIGFmdGVyIGZpbGVycyBhcmUgYXBwbGllZC4KICAgIC8vLyBAcGFyYW0gcGVuZGluZyBJbmNsdWRlIHBlbmRpbmcgdHJhbnNhY3Rpb25zLgogICAgLy8vIEBwYXJhbSBleGVjdXRlZCBJbmNsdWRlIGV4ZWN1dGVkIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcmV0dXJuIFRvdGFsIG51bWJlciBvZiB0cmFuc2FjdGlvbnMgYWZ0ZXIgZmlsdGVycyBhcmUgYXBwbGllZC4KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uQ291bnQoYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludCBjb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0cmFuc2FjdGlvbkNvdW50OyBpKyspCiAgICAgICAgICAgIGlmIChwZW5kaW5nICYmICF0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQKICAgICAgICAgICAgfHwgZXhlY3V0ZWQgJiYgdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKQogICAgICAgICAgICAgICAgY291bnQgKz0gMTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGxpc3Qgb2Ygb3duZXJzLgogICAgLy8vIEByZXR1cm4gTGlzdCBvZiBvd25lciBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRPd25lcnMoKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAoYWRkcmVzc1tdKQogICAgewogICAgICAgIHJldHVybiBvd25lcnM7CiAgICB9CgogICAgLy8gQGRldiBSZXR1cm5zIGxpc3Qgb2YgYWRtaW5zLgogICAgLy8gQHJldHVybiBMaXN0IG9mIGFkbWluIGFkZHJlc3NlcwogICAgZnVuY3Rpb24gZ2V0QWRtaW5zKCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKGFkZHJlc3NbXSkKICAgIHsKICAgICAgICByZXR1cm4gYWRtaW5zOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgYXJyYXkgd2l0aCBvd25lciBhZGRyZXNzZXMsIHdoaWNoIGNvbmZpcm1lZCB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYXJyYXkgb2Ygb3duZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9ucyh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zIChhZGRyZXNzW10gX2NvbmZpcm1hdGlvbnMpCiAgICB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBjb25maXJtYXRpb25zVGVtcCA9IG5ldyBhZGRyZXNzW10ob3duZXJzLmxlbmd0aCk7CiAgICAgICAgdWludCBjb3VudCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pIHsKICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbnNUZW1wW2NvdW50XSA9IG93bmVyc1tpXTsKICAgICAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICBfY29uZmlybWF0aW9ucyA9IG5ldyBhZGRyZXNzW10oY291bnQpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKQogICAgICAgICAgICBfY29uZmlybWF0aW9uc1tpXSA9IGNvbmZpcm1hdGlvbnNUZW1wW2ldOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiB0cmFuc2FjdGlvbiBJRHMgaW4gZGVmaW5lZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gZnJvbSBJbmRleCBzdGFydCBwb3NpdGlvbiBvZiB0cmFuc2FjdGlvbiBhcnJheS4KICAgIC8vLyBAcGFyYW0gdG8gSW5kZXggZW5kIHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBhcnJheSBvZiB0cmFuc2FjdGlvbiBJRHMuCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbklkcyh1aW50IGZyb20sIHVpbnQgdG8sIGJvb2wgcGVuZGluZywgYm9vbCBleGVjdXRlZCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnRbXSBfdHJhbnNhY3Rpb25JZHMpCiAgICB7CiAgICAgICAgdWludFtdIG1lbW9yeSB0cmFuc2FjdGlvbklkc1RlbXAgPSBuZXcgdWludFtdKHRyYW5zYWN0aW9uQ291bnQpOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdHJhbnNhY3Rpb25Db3VudDsgaSsrKQogICAgICAgICAgICBpZiAocGVuZGluZyAmJiAhdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkCiAgICAgICAgICAgIHx8IGV4ZWN1dGVkICYmIHRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25JZHNUZW1wW2NvdW50XSA9IGk7CiAgICAgICAgICAgICAgICBjb3VudCArPSAxOwogICAgICAgICAgICB9CiAgICAgICAgX3RyYW5zYWN0aW9uSWRzID0gbmV3IHVpbnRbXSh0byAtIGZyb20pOwogICAgICAgIGZvciAoaSA9IGZyb207IGkgPCB0bzsgaSsrKQogICAgICAgICAgICBfdHJhbnNhY3Rpb25JZHNbaSAtIGZyb21dID0gdHJhbnNhY3Rpb25JZHNUZW1wW2ldOwogICAgfQp9Cgpjb250cmFjdCBSbnRQcmVzYWxlRXRoZXJldW1EZXBvc2l0IGlzIFBhdXNhYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHVpbnQyNTYgcHVibGljIG92ZXJhbGxUYWtlbkV0aGVyID0gMDsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlY2VpdmVkRXRoZXI7CgogICAgc3RydWN0IERvbmF0b3IgewogICAgICAgIGFkZHJlc3MgYWRkcjsKICAgICAgICB1aW50MjU2IGRvbmF0ZWQ7CiAgICB9CgogICAgRG9uYXRvcltdIGRvbmF0b3JzOwoKICAgIFJOVE11bHRpU2lnV2FsbGV0IHB1YmxpYyB3YWxsZXQ7CgogICAgZnVuY3Rpb24gUm50UHJlc2FsZUV0aGVyZXVtRGVwb3NpdChhZGRyZXNzIF93YWxsZXRBZGRyZXNzKSB7CiAgICAgICAgd2FsbGV0ID0gUk5UTXVsdGlTaWdXYWxsZXQoX3dhbGxldEFkZHJlc3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZURvbmF0b3IoYWRkcmVzcyBfYWRkcmVzcykgaW50ZXJuYWwgewogICAgICAgIGJvb2wgaXNGb3VuZCA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGRvbmF0b3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChkb25hdG9yc1tpXS5hZGRyID09IF9hZGRyZXNzKSB7CiAgICAgICAgICAgICAgICBkb25hdG9yc1tpXS5kb25hdGVkID0gcmVjZWl2ZWRFdGhlcltfYWRkcmVzc107CiAgICAgICAgICAgICAgICBpc0ZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghaXNGb3VuZCkgewogICAgICAgICAgICBkb25hdG9ycy5wdXNoKERvbmF0b3IoX2FkZHJlc3MsIHJlY2VpdmVkRXRoZXJbX2FkZHJlc3NdKSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldERvbmF0b3JzTnVtYmVyKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBkb25hdG9ycy5sZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RG9uYXRvcih1aW50IHBvcykgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcywgdWludDI1NikgewogICAgICAgIHJldHVybiAoZG9uYXRvcnNbcG9zXS5hZGRyLCBkb25hdG9yc1twb3NdLmRvbmF0ZWQpOwogICAgfQoKICAgIC8qCiAgICAgKiBGYWxsYmFjayBmdW5jdGlvbiBmb3Igc2VuZGluZyBldGhlciB0byB3YWxsZXQgYW5kIHVwZGF0ZSBkb25hdG9ycyBpbmZvCiAgICAgKi8KICAgIGZ1bmN0aW9uKCkgd2hlbk5vdFBhdXNlZCBwYXlhYmxlIHsKICAgICAgICB3YWxsZXQudHJhbnNmZXIobXNnLnZhbHVlKTsKCiAgICAgICAgb3ZlcmFsbFRha2VuRXRoZXIgPSBvdmVyYWxsVGFrZW5FdGhlci5hZGQobXNnLnZhbHVlKTsKICAgICAgICByZWNlaXZlZEV0aGVyW21zZy5zZW5kZXJdID0gcmVjZWl2ZWRFdGhlclttc2cuc2VuZGVyXS5hZGQobXNnLnZhbHVlKTsKCiAgICAgICAgdXBkYXRlRG9uYXRvcihtc2cuc2VuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWNlaXZlZEV0aGVyRnJvbShhZGRyZXNzIF9mcm9tKSB3aGVuTm90UGF1c2VkIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHJlY2VpdmVkRXRoZXJbX2Zyb21dOwogICAgfQoKICAgIGZ1bmN0aW9uIG15RXRoZXIoKSB3aGVuTm90UGF1c2VkIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHJlY2VpdmVkRXRoZXJbbXNnLnNlbmRlcl07CiAgICB9Cn0KCmNvbnRyYWN0IFByZXNhbGVGaW5hbGl6ZUFnZW50IGlzIEhhc05vRXRoZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgUm50UHJlc2FsZUV0aGVyZXVtRGVwb3NpdCBwdWJsaWMgZGVwb3NpdDsKCiAgICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGVBZGRyZXNzOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5zRm9yQWRkcmVzczsKCiAgICB1aW50MjU2IHB1YmxpYyB3ZWlQZXJUb2tlbiA9IDA7CgogICAgYm9vbCBwdWJsaWMgc2FuZSA9IHRydWU7CgogICAgZnVuY3Rpb24gUHJlc2FsZUZpbmFsaXplQWdlbnQoYWRkcmVzcyBfZGVwb3NpdCwgYWRkcmVzcyBfY3Jvd2RzYWxlKXsKICAgICAgICBkZXBvc2l0ID0gUm50UHJlc2FsZUV0aGVyZXVtRGVwb3NpdChfZGVwb3NpdCk7CiAgICAgICAgY3Jvd2RzYWxlQWRkcmVzcyA9IF9jcm93ZHNhbGU7CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNyb3dkc2FsZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3Jvd2RzYWxlQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzYW5lOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENyb3dkc2FsZUFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgY3Jvd2RzYWxlQWRkcmVzcyA9IF9hZGRyZXNzOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXplUHJlc2FsZSh1aW50MjU2IHByZXNhbGVUb2tlbnMpIG9ubHlDcm93ZHNhbGUgcHVibGljIHsKICAgICAgICByZXF1aXJlKHNhbmUpOwogICAgICAgIHVpbnQyNTYgb3ZlcmFsbEV0aGVyID0gZGVwb3NpdC5vdmVyYWxsVGFrZW5FdGhlcigpOwogICAgICAgIHVpbnQyNTYgbXVsdGlwbGllciA9IDEwICoqIDE4OwogICAgICAgIG92ZXJhbGxFdGhlciA9IG92ZXJhbGxFdGhlci5tdWwobXVsdGlwbGllcik7CiAgICAgICAgd2VpUGVyVG9rZW4gPSBvdmVyYWxsRXRoZXIuZGl2KHByZXNhbGVUb2tlbnMpOwogICAgICAgIHJlcXVpcmUod2VpUGVyVG9rZW4gPiAwKTsKICAgICAgICBzYW5lID0gZmFsc2U7CiAgICB9Cn0KCmNvbnRyYWN0IElSbnRUb2tlbiB7CiAgICB1aW50MjU2IHB1YmxpYyBkZWNpbWFscyA9IDE4OwoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5ID0gMTAwMDAwMDAwMCAqICgxMCAqKiAxOCk7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIlJOVCBUb2tlbiI7CgogICAgc3RyaW5nIHB1YmxpYyBjb2RlID0gIlJOVCI7CgoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cn0KCmNvbnRyYWN0IFJudENyb3dkc2FsZSBpcyBQYXVzYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBlbnVtIFN0YXR1cyB7VW5rbm93biwgUHJlc2FsZSwgSUNPLCBGaW5hbGl6ZWR9IC8vIENyb3dkc2FsZSBzdGF0dXMKCiAgICBTdGF0dXMgcHVibGljIGN1cnJlbnRTdGF0dXMgPSBTdGF0dXMuVW5rbm93bjsKCiAgICBib29sIHB1YmxpYyBpc1ByZXNhbGVTdGFydGVkID0gZmFsc2U7CgogICAgYm9vbCBwdWJsaWMgaXNQcmVzYWxlRmluYWxpemVkID0gZmFsc2U7CgogICAgYm9vbCBwdWJsaWMgaXNJY29TdGFydGVkID0gZmFsc2U7CgogICAgYm9vbCBwdWJsaWMgaXNJY29GaW5hbGl6ZWQgPSBmYWxzZTsKCiAgICB1aW50MjU2IHB1YmxpYyBpY29SZWNlaXZlZFdlaTsKCiAgICB1aW50MjU2IHB1YmxpYyBpY29Ub2tlbnNTb2xkOwoKICAgIHVpbnQyNTYgcHVibGljIGljb0ludmVzdG1lbnRzQ291bnQgPSAwOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaWNvSW52ZXN0bWVudHM7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpY29Ub2tlblRyYW5zZmVyczsKCiAgICBJUm50VG9rZW4gcHVibGljIHRva2VuOwoKICAgIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5OwoKICAgIFByZXNhbGVGaW5hbGl6ZUFnZW50IHB1YmxpYyBwcmVzYWxlRmluYWxpemVBZ2VudDsKCiAgICBSbnRQcmVzYWxlRXRoZXJldW1EZXBvc2l0IHB1YmxpYyBkZXBvc2l0OwoKICAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgICBhZGRyZXNzIHB1YmxpYyBwcm94eTsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRva2Vuc0FsbG9jYXRpb25BbGxvd2VkOwoKICAgIHVpbnQgcHVibGljIHByZXNhbGVTdGFydFRpbWU7CgogICAgdWludCBwdWJsaWMgcHJlc2FsZUVuZFRpbWU7CgogICAgdWludCBwdWJsaWMgaWNvU3RhcnRUaW1lOwoKICAgIHVpbnQgcHVibGljIGljb0VuZFRpbWU7CgogICAgLyoqCiAgICBAbm90aWNlIEEgbmV3IGludmVzdG1lbnQgd2FzIG1hZGUuCiAgICAqLwogICAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgYnl0ZXMxNiBpbmRleGVkIGN1c3RvbWVySWQpOwoKICAgIGV2ZW50IFByZXNhbGVTdGFydGVkKHVpbnQgdGltZXN0YW1wKTsKCiAgICBldmVudCBQcmVzYWxlRmluYWxpemVkKHVpbnQgdGltZXN0YW1wKTsKCiAgICBldmVudCBJY29TdGFydGVkKHVpbnQgdGltZXN0YW1wKTsKCiAgICBldmVudCBJY29GaW5hbGl6ZWQodWludCB0aW1lc3RhbXApOwoKICAgIC8qKgogICAgQG5vdGljZSBUb2tlbiBwcmljZSB3YXMgY2FsY3VsYXRlZC4KICAgICovCiAgICBldmVudCBUb2tlbnNQZXJXZWlSZWNlaXZlZCh1aW50IHRva2VuUHJpY2UpOwoKICAgIC8qKgogICAgQG5vdGljZSBQcmVzYWxlIHRva2VucyB3YXMgY2xhaW1lZC4KICAgICovCiAgICBldmVudCBQcmVzYWxlVG9rZW5zQ2xhaW1lZCh1aW50IGNvdW50KTsKCiAgICBmdW5jdGlvbiBSbnRDcm93ZHNhbGUoYWRkcmVzcyBfdG9rZW5BZGRyZXNzKSB7CiAgICAgICAgdG9rZW4gPSBJUm50VG9rZW4oX3Rva2VuQWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIEFsbG93IGNhbGwgZnVuY3Rpb24gb25seSBpZiBjcm93ZHNhbGUgb24gc3BlY2lmaWVkIHN0YXR1cy4KICAgICovCiAgICBtb2RpZmllciBpblN0YXR1cyhTdGF0dXMgc3RhdHVzKSB7CiAgICAgICAgcmVxdWlyZShnZXRDcm93ZHNhbGVTdGF0dXMoKSA9PSBzdGF0dXMpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIENoZWNrIHRoYXQgYWRkcmVzcyBjYW4gYWxsb2NhdGUgdG9rZW5zLgogICAgKi8KICAgIG1vZGlmaWVyIGNhbkFsbG9jYXRlVG9rZW5zIHsKICAgICAgICByZXF1aXJlKHRva2Vuc0FsbG9jYXRpb25BbGxvd2VkW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIEFsbG93IGFkZHJlc3MgdG8gY2FsbCBhbGxvY2F0ZSBmdW5jdGlvbi4KICAgIEBwYXJhbSBfYWRkciBBZGRyZXNzIGZvciBhbGxvd2FuY2UKICAgIEBwYXJhbSBfYWxsb3cgQWxsb3dhbmNlCiAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dBbGxvY2F0aW9uKGFkZHJlc3MgX2FkZHIsIGJvb2wgX2FsbG93KSBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIHRva2Vuc0FsbG9jYXRpb25BbGxvd2VkW19hZGRyXSA9IF9hbGxvdzsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgU2V0IFByZXNhbGVGaW5hbGl6ZUFnZW50IGFkZHJlc3MuCiAgICBAZGV2IFVzZWQgdG8gY2FsY3VsYXRlIHByaWNlIGZvciBvbmUgdG9rZW4uCiAgICAqLwogICAgZnVuY3Rpb24gc2V0UHJlc2FsZUZpbmFsaXplQWdlbnQoYWRkcmVzcyBfYWdlbnRBZGRyZXNzKSB3aGVuTm90UGF1c2VkIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgcHJlc2FsZUZpbmFsaXplQWdlbnQgPSBQcmVzYWxlRmluYWxpemVBZ2VudChfYWdlbnRBZGRyZXNzKTsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgU2V0IFByaWNpbmdTdHJhdGVneSBhZGRyZXNzLgogICAgQGRldiBVc2VkIHRvIGNhbGN1bGF0ZSB0b2tlbnMgdGhhdCB3aWxsIGJlIHJlY2VpdmVkIHRocm91Z2ggaW52ZXN0bWVudC4KICAgICovCiAgICBmdW5jdGlvbiBzZXRQcmljaW5nU3RhcnRlZ3koYWRkcmVzcyBfcHJpY2luZ1N0cmF0ZWd5QWRkcmVzcykgd2hlbk5vdFBhdXNlZCBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIHByaWNpbmdTdHJhdGVneSA9IFByaWNpbmdTdHJhdGVneShfcHJpY2luZ1N0cmF0ZWd5QWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIFNldCBSTlRNdWx0aVNpZ1dhbGxldCBhZGRyZXNzLgogICAgQGRldiBXYWxsZXQgZm9yIGludmVzdGVkIHdlaS4KICAgICovCiAgICBmdW5jdGlvbiBzZXRNdWx0aVNpZ1dhbGxldChhZGRyZXNzIF93YWxsZXRBZGRyZXNzKSB3aGVuTm90UGF1c2VkIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgd2FsbGV0ID0gX3dhbGxldEFkZHJlc3M7CiAgICB9CgoKICAgIC8qKgogICAgQG5vdGljZSBTZXQgUm50VG9rZW5Qcm94eSBhZGRyZXNzLgogICAgKi8KICAgIGZ1bmN0aW9uIHNldEJhY2tlbmRQcm94eUJ1eWVyKGFkZHJlc3MgX3Byb3h5QWRkcmVzcykgd2hlbk5vdFBhdXNlZCBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIHByb3h5ID0gX3Byb3h5QWRkcmVzczsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgU2V0IFJudFByZXNhbGVFaHRlcmV1bURlcG9zaXQgYWRkcmVzcy4KICAgIEBkZXYgRGVwb3NpdCB1c2VkIHRvIGNhbGN1bGF0ZSBwcmVzYWxlIHRva2Vucy4KICAgICovCiAgICBmdW5jdGlvbiBzZXRQcmVzYWxlRXRoZXJldW1EZXBvc2l0KGFkZHJlc3MgX2RlcG9zaXRBZGRyZXNzKSB3aGVuTm90UGF1c2VkIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgZGVwb3NpdCA9IFJudFByZXNhbGVFdGhlcmV1bURlcG9zaXQoX2RlcG9zaXRBZGRyZXNzKTsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgR2V0IGN1cnJlbnQgY3Jvd2RzYWxlIHN0YXR1cy4KICAgIEByZXR1cm4geyBPbmUgb2YgcG9zc2libGUgY3Jvd2RzYWxlIHN0YXR1c2VzIFtVbmtub3duLCBQcmVzYWxlLCBJQ08sIEZpbmFsaXplZF0gfQogICAgKi8KICAgIGZ1bmN0aW9uIGdldENyb3dkc2FsZVN0YXR1cygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChTdGF0dXMpIHsKICAgICAgICByZXR1cm4gY3VycmVudFN0YXR1czsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgU3RhcnQgcHJlc2FsZSBhbmQgdHJhY2sgc3RhcnQgdGltZS4KICAgICovCiAgICBmdW5jdGlvbiBzdGFydFByZXNhbGUoKSB3aGVuTm90UGF1c2VkIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSghaXNQcmVzYWxlU3RhcnRlZCk7CgogICAgICAgIGN1cnJlbnRTdGF0dXMgPSBTdGF0dXMuUHJlc2FsZTsKICAgICAgICBpc1ByZXNhbGVTdGFydGVkID0gdHJ1ZTsKCiAgICAgICAgcHJlc2FsZVN0YXJ0VGltZSA9IG5vdzsKICAgICAgICBQcmVzYWxlU3RhcnRlZChwcmVzYWxlU3RhcnRUaW1lKTsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgRmluYWxpemUgcHJlc2FsZSwgY2FsY3VsYXRlIHRva2VuIHByaWNlLCB0cmFjayBmaW5hbGl6ZSB0aW1lLgogICAgKi8KICAgIGZ1bmN0aW9uIGZpbmFsaXplUHJlc2FsZSgpIHdoZW5Ob3RQYXVzZWQgb25seU93bmVyIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGlzUHJlc2FsZVN0YXJ0ZWQgJiYgIWlzUHJlc2FsZUZpbmFsaXplZCk7CiAgICAgICAgcmVxdWlyZShwcmVzYWxlRmluYWxpemVBZ2VudC5pc1NhbmUoKSk7CgogICAgICAgIHVpbnQyNTYgcHJlc2FsZVN1cHBseSA9IHRva2VuLnRvdGFsU3VwcGx5KCk7CgogICAgICAgIC8vIFByZXNhbGUgc3VwcGx5IGlzIDIwJSBvZiB0b3RhbAogICAgICAgIHByZXNhbGVTdXBwbHkgPSBwcmVzYWxlU3VwcGx5LmRpdig1KTsKCiAgICAgICAgcHJlc2FsZUZpbmFsaXplQWdlbnQuZmluYWxpemVQcmVzYWxlKHByZXNhbGVTdXBwbHkpOwogICAgICAgIHVpbnQgdG9rZW5XZWkgPSBwcmVzYWxlRmluYWxpemVBZ2VudC53ZWlQZXJUb2tlbigpOwogICAgICAgIHByaWNpbmdTdHJhdGVneS5zZXRUb2tlblByaWNlSW5XZWkodG9rZW5XZWkpOwogICAgICAgIFRva2Vuc1BlcldlaVJlY2VpdmVkKHRva2VuV2VpKTsKCiAgICAgICAgcmVxdWlyZSh0b2tlbldlaSA+IDApOwoKICAgICAgICBjdXJyZW50U3RhdHVzID0gU3RhdHVzLlVua25vd247CiAgICAgICAgaXNQcmVzYWxlRmluYWxpemVkID0gdHJ1ZTsKCiAgICAgICAgcHJlc2FsZUVuZFRpbWUgPSBub3c7CiAgICAgICAgUHJlc2FsZUZpbmFsaXplZChwcmVzYWxlRW5kVGltZSk7CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIFN0YXJ0IElDTyBhbmQgdHJhY2sgc3RhcnQgdGltZS4KICAgICovCiAgICBmdW5jdGlvbiBzdGFydEljbygpIHdoZW5Ob3RQYXVzZWQgb25seU93bmVyIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKCFpc0ljb1N0YXJ0ZWQgJiYgaXNQcmVzYWxlRmluYWxpemVkKTsKCiAgICAgICAgY3VycmVudFN0YXR1cyA9IFN0YXR1cy5JQ087CiAgICAgICAgaXNJY29TdGFydGVkID0gdHJ1ZTsKCiAgICAgICAgaWNvU3RhcnRUaW1lID0gbm93OwogICAgICAgIEljb1N0YXJ0ZWQoaWNvU3RhcnRUaW1lKTsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgRmluYWxpemUgSUNPIGFuZCB0cmFjayBmaW5hbGl6ZSB0aW1lLgogICAgKi8KICAgIGZ1bmN0aW9uIGZpbmFsaXplSWNvKCkgd2hlbk5vdFBhdXNlZCBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoIWlzSWNvRmluYWxpemVkICYmIGlzSWNvU3RhcnRlZCk7CgogICAgICAgIGN1cnJlbnRTdGF0dXMgPSBTdGF0dXMuRmluYWxpemVkOwogICAgICAgIGlzSWNvRmluYWxpemVkID0gdHJ1ZTsKCiAgICAgICAgaWNvRW5kVGltZSA9IG5vdzsKICAgICAgICBJY29GaW5hbGl6ZWQoaWNvRW5kVGltZSk7CiAgICB9CgoKICAgIC8qKgogICAgQG5vdGljZSBIYW5kbGUgaW52ZXN0ZWQgd2VpLgogICAgQGRldiBTZW5kIHNvbWUgYW1vdW50IG9mIHdlaSB0byB3YWxsZXQgYW5kIGdldCB0b2tlbnMgdGhhdCB3aWxsIGJlIGNhbGN1bGF0ZWQgYWNjb3JkaW5nIFByaWNpbmcgU3RyYXRlZ3kuCiAgICAgICAgIEl0IHdpbGwgdHJhbnNmZXIgZXRoZXIgdG8gd2FsbGV0IG9ubHkgaWYgaW52ZXN0bWVudCBkaWQgaW5zaWRlIGV0aGVyZXVtIHVzaW5nIHBheWFibGUgbWV0aG9kLgogICAgQHBhcmFtIF9yZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2Vucy4KICAgIEBwYXJhbSBfY3VzdG9tZXJVdWlkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUuCiAgICAqLwogICAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyBfcmVjZWl2ZXIsIGJ5dGVzMTYgX2N1c3RvbWVyVXVpZCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBwcmljaW5nU3RyYXRlZ3kuY2FsY3VsYXRlUHJpY2Uod2VpQW1vdW50LCAxOCk7CgogICAgICAgIHJlcXVpcmUodG9rZW5BbW91bnQgIT0gMCk7CgogICAgICAgIGlmIChpY29JbnZlc3RtZW50c1tfcmVjZWl2ZXJdID09IDApIHsKICAgICAgICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgICAgICAgaWNvSW52ZXN0bWVudHNDb3VudCsrOwogICAgICAgIH0KICAgICAgICBpY29JbnZlc3RtZW50c1tfcmVjZWl2ZXJdID0gaWNvSW52ZXN0bWVudHNbX3JlY2VpdmVyXS5hZGQod2VpQW1vdW50KTsKICAgICAgICBpY29Ub2tlblRyYW5zZmVyc1tfcmVjZWl2ZXJdID0gaWNvVG9rZW5UcmFuc2ZlcnNbX3JlY2VpdmVyXS5hZGQodG9rZW5BbW91bnQpOwogICAgICAgIGljb1JlY2VpdmVkV2VpID0gaWNvUmVjZWl2ZWRXZWkuYWRkKHdlaUFtb3VudCk7CiAgICAgICAgaWNvVG9rZW5zU29sZCA9IGljb1Rva2Vuc1NvbGQuYWRkKHRva2VuQW1vdW50KTsKCiAgICAgICAgYXNzaWduVG9rZW5zKG93bmVyLCBfcmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKCiAgICAgICAgLy8gUG9ja2V0IHRoZSBtb25leQogICAgICAgIHdhbGxldC50cmFuc2Zlcih3ZWlBbW91bnQpOwoKICAgICAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgICAgIEludmVzdGVkKF9yZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgX2N1c3RvbWVyVXVpZCk7CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIEhhbmRsZSB0b2tlbnMgYWxsb2NhdGluZy4KICAgIEBkZXYgVXNlcyB3aGVuIHRva2VucyB3YXMgYm91Z2h0IG5vdCBpbiBldGhlcmV1bQogICAgQHBhcmFtIF9yZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2Vucy4KICAgIEBwYXJhbSBfY3VzdG9tZXJVdWlkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUuCiAgICBAcGFyYW0gX3dlaUFtb3VudCBXZWkgYW1vdW50LCB0aGF0IHNob3VsZCBiZSBzcGVjaWZpZWQgb25seSBpZiB1c2VyIHdhcyBpbnZlc3RlZCBvdXQKICAgICovCiAgICBmdW5jdGlvbiBhbGxvY2F0ZUludGVybmFsKGFkZHJlc3MgX3JlY2VpdmVyLCBieXRlczE2IF9jdXN0b21lclV1aWQsIHVpbnQyNTYgX3dlaUFtb3VudCkgcHJpdmF0ZSB7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudCA9IHByaWNpbmdTdHJhdGVneS5jYWxjdWxhdGVQcmljZShfd2VpQW1vdW50LCAxOCk7CgogICAgICAgIHJlcXVpcmUodG9rZW5BbW91bnQgIT0gMCk7CgogICAgICAgIGlmIChpY29JbnZlc3RtZW50c1tfcmVjZWl2ZXJdID09IDApIHsKICAgICAgICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgICAgICAgaWNvSW52ZXN0bWVudHNDb3VudCsrOwogICAgICAgIH0KICAgICAgICBpY29JbnZlc3RtZW50c1tfcmVjZWl2ZXJdID0gaWNvSW52ZXN0bWVudHNbX3JlY2VpdmVyXS5hZGQoX3dlaUFtb3VudCk7CiAgICAgICAgaWNvVG9rZW5UcmFuc2ZlcnNbX3JlY2VpdmVyXSA9IGljb1Rva2VuVHJhbnNmZXJzW19yZWNlaXZlcl0uYWRkKHRva2VuQW1vdW50KTsKICAgICAgICBpY29SZWNlaXZlZFdlaSA9IGljb1JlY2VpdmVkV2VpLmFkZChfd2VpQW1vdW50KTsKICAgICAgICBpY29Ub2tlbnNTb2xkID0gaWNvVG9rZW5zU29sZC5hZGQodG9rZW5BbW91bnQpOwoKICAgICAgICBhc3NpZ25Ub2tlbnMob3duZXIsIF9yZWNlaXZlciwgdG9rZW5BbW91bnQpOwoKICAgICAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgICAgIEludmVzdGVkKF9yZWNlaXZlciwgX3dlaUFtb3VudCwgdG9rZW5BbW91bnQsIF9jdXN0b21lclV1aWQpOwogICAgfQoKICAgIC8qKgogICAgQG5vdGljZSBBbGxvY2F0ZSB0b2tlbnMgdG8gc3BlY2lmaWVkIGFkZHJlc3MuCiAgICBAZGV2IEZ1bmN0aW9uIHRoYXQgc2hvdWxkIGJlIHVzZWQgb25seSBieSBwcm94eSB0byBoYW5kbGUgcGF5bWVudHMgb3V0c2lkZSBldGhlcmV1bS4KICAgIEBwYXJhbSBfcmVjZWl2ZXIgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgd2hvIHJlY2VpdmVzIHRoZSB0b2tlbnMuCiAgICBAcGFyYW0gX2N1c3RvbWVyVXVpZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlLgogICAgQHBhcmFtIF93ZWlBbW91bnQgVXNlciBpbnZlc3RlZCBhbW91bnQgb2YgbW9uZXkgaW4gd2VpLgogICAgKi8KICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9rZW5zKGFkZHJlc3MgX3JlY2VpdmVyLCBieXRlczE2IF9jdXN0b21lclV1aWQsIHVpbnQyNTYgX3dlaUFtb3VudCkgd2hlbk5vdFBhdXNlZCBjYW5BbGxvY2F0ZVRva2VucyBwdWJsaWMgewogICAgICAgIGFsbG9jYXRlSW50ZXJuYWwoX3JlY2VpdmVyLCBfY3VzdG9tZXJVdWlkLCBfd2VpQW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgTWFrZSBhbiBpbnZlc3RtZW50LgogICAgQGRldiBDYW4gYmUgY2FsbGVkIG9ubHkgYXQgSUNPIHN0YXR1cy4gU2hvdWxkIGhhdmUgd2VpICE9IDAuCiAgICBAcGFyYW0gX2N1c3RvbWVyVXVpZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlCiAgICAqLwogICAgZnVuY3Rpb24gaW52ZXN0KGJ5dGVzMTYgX2N1c3RvbWVyVXVpZCkgd2hlbk5vdFBhdXNlZCBpblN0YXR1cyhTdGF0dXMuSUNPKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgaW52ZXN0SW50ZXJuYWwobXNnLnNlbmRlciwgX2N1c3RvbWVyVXVpZCk7CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIEZ1bmN0aW9uIGZvciBjbGFpbWluZyB0b2tlbnMgZm9yIHByZXNhbGUgaW52ZXN0b3JzLgogICAgQGRldiBDYW4gYmUgY2FsbGVkIG9ubHkgYWZ0ZXIgcHJlc2FsZSBlbmRzLiBUb2tlbnMgd2lsbCBiZSB0cmFuc2ZlcmVkIHRvIGNhbGxlcnMgYWRkcmVzcy4KICAgICovCiAgICBmdW5jdGlvbiBjbGFpbVByZXNhbGVUb2tlbnMoKSB3aGVuTm90UGF1c2VkIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGlzUHJlc2FsZUZpbmFsaXplZCA9PSB0cnVlKTsKCiAgICAgICAgdWludDI1NiBzZW5kZXJFdGhlciA9IGRlcG9zaXQucmVjZWl2ZWRFdGhlckZyb20obXNnLnNlbmRlcik7CiAgICAgICAgdWludDI1NiBtdWx0aXBsaWVyID0gMTAgKiogMTg7CiAgICAgICAgc2VuZGVyRXRoZXIgPSBzZW5kZXJFdGhlci5tdWwobXVsdGlwbGllcik7CiAgICAgICAgdWludDI1NiB0b2tlbldlaSA9IHByaWNpbmdTdHJhdGVneS5vbmVUb2tlbkluV2VpKCk7CiAgICAgICAgdWludDI1NiB0b2tlbnNBbW91bnQgPSBzZW5kZXJFdGhlci5kaXYodG9rZW5XZWkpOwoKICAgICAgICByZXF1aXJlKHRva2Vuc0Ftb3VudCA+IDApOwogICAgICAgIHRva2VuLnRyYW5zZmVyRnJvbShvd25lciwgbXNnLnNlbmRlciwgdG9rZW5zQW1vdW50KTsKICAgICAgICBQcmVzYWxlVG9rZW5zQ2xhaW1lZCh0b2tlbnNBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgQG5vdGljZSBUcmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3Rvci4KICAgICovCiAgICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfcmVjZWl2ZXIsIHVpbnQgX3Rva2VuQW1vdW50KSBwcml2YXRlIHsKICAgICAgICB0b2tlbi50cmFuc2ZlckZyb20oX2Zyb20sIF9yZWNlaXZlciwgX3Rva2VuQW1vdW50KTsKICAgIH0KfQ=='.
	

]
