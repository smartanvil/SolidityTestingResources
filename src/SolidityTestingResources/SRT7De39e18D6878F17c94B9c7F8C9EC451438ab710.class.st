Class {
	#name : #SRT7De39e18D6878F17c94B9c7F8C9EC451438ab710,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7De39e18D6878F17c94B9c7F8C9EC451438ab710 >> base64 [
	^ 'LyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Ci8vLyBAdGl0bGUgT3duYWJsZQovLy8gQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljCi8vLyAgICAgIGF1dGhvcml6YXRpb24gY29udHJvbCBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YKLy8vICAgICAgInVzZXIgcGVybWlzc2lvbnMiLgpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgLy8vIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QKICAgIC8vLyAgICAgIHRvIHRoZSBzZW5kZXIuCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICAvLy8gQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIC8vLyBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhCiAgICAvLy8gICAgICBuZXdPd25lci4KICAgIC8vLyBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICB9CiAgICB9Cn0vKgogIENvcHlyaWdodCAyMDE3IExvb3ByaW5nIFByb2plY3QgTHRkIChMb29wcmluZyBGb3VuZGF0aW9uKS4KICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwovLy8gQHRpdGxlIFVpbnRVdGlsCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzMjU2NTM1YzViNTc1ZTcyNWU1ZDVkNDI0MDViNWM1NTFjNWQ0MDU1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KLy8vIEBkZXYgdWludCB1dGlsaXR5IGZ1bmN0aW9ucwpsaWJyYXJ5IE1hdGhVaW50IHsKICAgIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IGMpIHsKICAgICAgICBjID0gYSAqIGI7CiAgICAgICAgcmVxdWlyZShhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICB9CiAgICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CiAgICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCBjKSB7CiAgICAgICAgYyA9IGEgKyBiOwogICAgICAgIHJlcXVpcmUoYyA+PSBhKTsKICAgIH0KICAgIGZ1bmN0aW9uIHRvbGVyYW50U3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgYykgewogICAgICAgIHJldHVybiAoYSA+PSBiKSA/IGEgLSBiIDogMDsKICAgIH0KICAgIC8vLyBAZGV2IGNhbGN1bGF0ZSB0aGUgc3F1YXJlIG9mIENvZWZmaWNpZW50IG9mIFZhcmlhdGlvbiAoQ1YpCiAgICAvLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29lZmZpY2llbnRfb2ZfdmFyaWF0aW9uCiAgICBmdW5jdGlvbiBjdnNxdWFyZSgKICAgICAgICB1aW50W10gYXJyLAogICAgICAgIHVpbnQgc2NhbGUKICAgICAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICB1aW50IGxlbiA9IGFyci5sZW5ndGg7CiAgICAgICAgcmVxdWlyZShsZW4gPiAxKTsKICAgICAgICByZXF1aXJlKHNjYWxlID4gMCk7CiAgICAgICAgdWludCBhdmcgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGF2ZyArPSBhcnJbaV07CiAgICAgICAgfQogICAgICAgIGF2ZyA9IGF2ZyAvIGxlbjsKICAgICAgICBpZiAoYXZnID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQgY3ZzID0gMDsKICAgICAgICB1aW50IHMgPSAwOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBzID0gYXJyW2ldID4gYXZnID8gYXJyW2ldIC0gYXZnIDogYXZnIC0gYXJyW2ldOwogICAgICAgICAgICBjdnMgKz0gbXVsKHMsIHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKG11bChtdWwoY3ZzLCBzY2FsZSkgLyBhdmcsIHNjYWxlKSAvIGF2ZykgLyAobGVuIC0gMSk7CiAgICB9Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKLy8vIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMApjb250cmFjdCBFUkMyMCB7CiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKCQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBMb29wcmluZyBUb2tlbiBFeGNoYW5nZSBQcm90b2NvbCBDb250cmFjdCBJbnRlcmZhY2UKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjlkZjlmY2YzZjRmOGYxZGRmMWYyZjJlZGVmZjRmM2ZhYjNmMmVmZmEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImJjZDdkM2QyZGJkMGQ1ZGRkMmRiZmNkMGQzZDNjY2NlZDVkMmRiOTJkM2NlZGIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pgpjb250cmFjdCBMb29wcmluZ1Byb3RvY29sIHsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBDb25zdGFudHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIHVpbnQgICAgcHVibGljIGNvbnN0YW50IEZFRV9TRUxFQ1RfTFJDICAgICAgICAgICAgICAgPSAwOwogICAgdWludCAgICBwdWJsaWMgY29uc3RhbnQgRkVFX1NFTEVDVF9NQVJHSU5fU1BMSVQgICAgICA9IDE7CiAgICB1aW50ICAgIHB1YmxpYyBjb25zdGFudCBGRUVfU0VMRUNUX01BWF9WQUxVRSAgICAgICAgID0gMTsKICAgIHVpbnQ4ICAgcHVibGljIGNvbnN0YW50IE1BUkdJTl9TUExJVF9QRVJDRU5UQUdFX0JBU0UgPSAxMDA7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gU3RydWN0cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQHBhcmFtIHRva2VuUyAgICAgICBUb2tlbiB0byBzZWxsLgogICAgLy8vIEBwYXJhbSB0b2tlbkIgICAgICAgVG9rZW4gdG8gYnV5LgogICAgLy8vIEBwYXJhbSBhbW91bnRTICAgICAgTWF4aW11bSBhbW91bnQgb2YgdG9rZW5TIHRvIHNlbGwuCiAgICAvLy8gQHBhcmFtIGFtb3VudEIgICAgICBNaW5pbXVtIGFtb3VudCBvZiB0b2tlbkIgdG8gYnV5IGlmIGFsbCBhbW91bnRTIHNvbGQuCiAgICAvLy8gQHBhcmFtIHRpbWVzdGFtcCAgICBJbmRpY2F0aW5nIHdoZW4gdGhpcyBvcmRlciBpcyBjcmVhdGVkL3NpZ25lZC4KICAgIC8vLyBAcGFyYW0gdHRsICAgICAgICAgIEluZGljYXRpbmcgYWZ0ZXIgaG93IG1hbnkgc2Vjb25kcyBmcm9tIGB0aW1lc3RhbXBgCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGlzIG9yZGVyIHdpbGwgZXhwaXJlLgogICAgLy8vIEBwYXJhbSBzYWx0ICAgICAgICAgQSByYW5kb20gbnVtYmVyIHRvIG1ha2UgdGhpcyBvcmRlcidzIGhhc2ggdW5pcXVlLgogICAgLy8vIEBwYXJhbSBscmNGZWUgICAgICAgTWF4IGFtb3VudCBvZiBMUkMgdG8gcGF5IGZvciBtaW5lci4gVGhlIHJlYWwgYW1vdW50CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0byBwYXkgaXMgcHJvcG9ydGlvbmFsIHRvIGZpbGwgYW1vdW50LgogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50QiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBJZiB0cnVlLCB0aGlzIG9yZGVyIGRvZXMgbm90IGFjY2VwdCBidXlpbmcgbW9yZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhhbiBgYW1vdW50QmAuCiAgICAvLy8gQHBhcmFtIG1hcmdpblNwbGl0UGVyY2VudGFnZSAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBUaGUgcGVyY2VudGFnZSBvZiBtYXJnaW4gcGFpZCB0byBtaW5lci4KICAgIC8vLyBAcGFyYW0gdiAgICAgICAgICAgIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAgIC8vLyBAcGFyYW0gciAgICAgICAgICAgIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgICAvLy8gQHBhcmFtIHMgICAgICAgICAgICBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgc3RydWN0IE9yZGVyIHsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIGFkZHJlc3MgdG9rZW5TOwogICAgICAgIGFkZHJlc3MgdG9rZW5COwogICAgICAgIHVpbnQgICAgYW1vdW50UzsKICAgICAgICB1aW50ICAgIGFtb3VudEI7CiAgICAgICAgdWludCAgICBscmNGZWU7CiAgICAgICAgYm9vbCAgICBidXlOb01vcmVUaGFuQW1vdW50QjsKICAgICAgICB1aW50OCAgIG1hcmdpblNwbGl0UGVyY2VudGFnZTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBQdWJsaWMgRnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAZGV2IFN1Ym1pdCBhIG9yZGVyLXJpbmcgZm9yIHZhbGlkYXRpb24gYW5kIHNldHRsZW1lbnQuCiAgICAvLy8gQHBhcmFtIGFkZHJlc3NMaXN0ICBMaXN0IG9mIGVhY2ggb3JkZXIncyBvd25lciBhbmQgdG9rZW5TLiBOb3RlIHRoYXQgbmV4dAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgb3JkZXIncyBgdG9rZW5TYCBlcXVhbHMgdGhpcyBvcmRlcidzIGB0b2tlbkJgLgogICAgLy8vIEBwYXJhbSB1aW50QXJnc0xpc3QgTGlzdCBvZiB1aW50LXR5cGUgYXJndW1lbnRzIGluIHRoaXMgb3JkZXI6CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBhbW91bnRTLCBhbW91bnRCLCB0aW1lc3RhbXAsIHR0bCwgc2FsdCwgbHJjRmVlLAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgcmF0ZUFtb3VudFMuCiAgICAvLy8gQHBhcmFtIHVpbnQ4QXJnc0xpc3QgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgTGlzdCBvZiB1bml0OC10eXBlIGFyZ3VtZW50cywgaW4gdGhpcyBvcmRlcjoKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIG1hcmdpblNwbGl0UGVyY2VudGFnZUxpc3QsIGZlZVNlbGVjdGlvbkxpc3QuCiAgICAvLy8gQHBhcmFtIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBUaGlzIGluZGljYXRlcyB3aGVuIGEgb3JkZXIgc2hvdWxkIGJlIGNvbnNpZGVyZWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGFzICdjb21wbGV0ZWx5IGZpbGxlZCcuCiAgICAvLy8gQHBhcmFtIHZMaXN0ICAgICAgICBMaXN0IG9mIHYgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHYgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSByTGlzdCAgICAgICAgTGlzdCBvZiByIGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICByIHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gc0xpc3QgICAgICAgIExpc3Qgb2YgcyBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgcyB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHJpbmdtaW5lciAgICBUaGUgYWRkcmVzcyB0aGF0IHNpZ25lZCB0aGlzIHR4LgogICAgLy8vIEBwYXJhbSBmZWVSZWNlcGllbnQgVGhlIHJlY2VwaWVudCBhZGRyZXNzIGZvciBmZWUgY29sbGVjdGlvbi4gSWYgdGhpcyBpcwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgJzB4MCcsIGFsbCBmZWVzIHdpbGwgYmUgcGFpZCB0byB0aGUgYWRkcmVzcyB3aG8gaGFkCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBzaWduZWQgdGhpcyB0cmFuc2FjdGlvbiwgbm90IGBtc2cuc2VuZGVyYC4gTm90ZWQgaWYKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExSQyBuZWVkIHRvIGJlIHBhaWQgYmFjayB0byBvcmRlciBvd25lciBhcyB0aGUgcmVzdWx0CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvZiBmZWUgc2VsZWN0aW9uIG1vZGVsLCBMUkMgd2lsbCBhbHNvIGJlIHNlbnQgZnJvbQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhpcyBhZGRyZXNzLgogICAgZnVuY3Rpb24gc3VibWl0UmluZygKICAgICAgICBhZGRyZXNzWzJdW10gICAgYWRkcmVzc0xpc3QsCiAgICAgICAgdWludFs3XVtdICAgICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICB1aW50OFsyXVtdICAgICAgdWludDhBcmdzTGlzdCwKICAgICAgICBib29sW10gICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgIHVpbnQ4W10gICAgICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHNMaXN0LAogICAgICAgIGFkZHJlc3MgICAgICAgICByaW5nbWluZXIsCiAgICAgICAgYWRkcmVzcyAgICAgICAgIGZlZVJlY2VwaWVudAogICAgICAgICkgcHVibGljOwogICAgLy8vIEBkZXYgQ2FuY2VsIGEgb3JkZXIuIGNhbmNlbCBhbW91bnQoYW1vdW50UyBvciBhbW91bnRCKSBjYW4gYmUgc3BlY2lmaWVkCiAgICAvLy8gICAgICBpbiBvcmRlclZhbHVlcy4KICAgIC8vLyBAcGFyYW0gYWRkcmVzc2VzICAgICAgICAgIG93bmVyLCB0b2tlblMsIHRva2VuQgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyAgICAgICAgYW1vdW50UywgYW1vdW50QiwgdGltZXN0YW1wLCB0dGwsIHNhbHQsIGxyY0ZlZSwKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEFtb3VudFMsIGFuZCBjYW5jZWxBbW91bnRCLgogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50QiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIGluZGljYXRlcyB3aGVuIGEgb3JkZXIgc2hvdWxkIGJlIGNvbnNpZGVyZWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzICdjb21wbGV0ZWx5IGZpbGxlZCcuCiAgICAvLy8gQHBhcmFtIG1hcmdpblNwbGl0UGVyY2VudGFnZSAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBQZXJjZW50YWdlIG9mIG1hcmdpbiBzcGxpdCB0byBzaGFyZSB3aXRoIG1pbmVyLgogICAgLy8vIEBwYXJhbSB2ICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcigKICAgICAgICBhZGRyZXNzWzNdIGFkZHJlc3NlcywKICAgICAgICB1aW50WzddICAgIG9yZGVyVmFsdWVzLAogICAgICAgIGJvb2wgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgdWludDggICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UsCiAgICAgICAgdWludDggICAgICB2LAogICAgICAgIGJ5dGVzMzIgICAgciwKICAgICAgICBieXRlczMyICAgIHMKICAgICAgICApIHB1YmxpYzsKICAgIC8vLyBAZGV2ICAgU2V0IGEgY3V0b2ZmIHRpbWVzdGFtcCB0byBpbnZhbGlkYXRlIGFsbCBvcmRlcnMgd2hvc2UgdGltZXN0YW1wCiAgICAvLy8gICAgICAgIGlzIHNtYWxsZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgbmV3IHZhbHVlIG9mIHRoZSBhZGRyZXNzJ3MgY3V0b2ZmCiAgICAvLy8gICAgICAgIHRpbWVzdGFtcC4KICAgIC8vLyBAcGFyYW0gY3V0b2ZmIFRoZSBjdXRvZmYgdGltZXN0YW1wLCB3aWxsIGRlZmF1bHQgdG8gYGJsb2NrLnRpbWVzdGFtcGAKICAgIC8vLyAgICAgICAgaWYgaXQgaXMgMC4KICAgIGZ1bmN0aW9uIHNldEN1dG9mZih1aW50IGN1dG9mZikgcHVibGljOwp9Ci8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8vLyBAdGl0bGUgVG9rZW4gUmVnaXN0ZXIgQ29udHJhY3QKLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI3MDFiMWYxZTE3MWMxOTExMWUxNzMwMWMxZjFmMDAwMjE5MWUxNzVlMWYwMjE3Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4sCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI3MjE2MTMxYzFiMTcxZTMyMWUxZDFkMDIwMDFiMWMxNTVjMWQwMDE1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmxpYnJhcnkgTWF0aEJ5dGVzMzIgewogICAgZnVuY3Rpb24geG9yUmVkdWNlKAogICAgICAgIGJ5dGVzMzJbXSAgIGFyciwKICAgICAgICB1aW50ICAgICAgICBsZW4KICAgICAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMiByZXMpCiAgICB7CiAgICAgICAgcmVzID0gYXJyWzBdOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHJlcyBePSBhcnJbaV07CiAgICAgICAgfQogICAgfQp9Ci8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8vLyBAdGl0bGUgVG9rZW4gUmVnaXN0ZXIgQ29udHJhY3QKLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJkOWIyYjZiN2JlYjViMGI4YjdiZTk5YjViNmI2YTlhYmIwYjdiZWY3YjZhYmJlIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4sCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI2ZjBiMGUwMTA2MGEwMzJmMDMwMDAwMWYxZDA2MDEwODQxMDAxZDA4Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmxpYnJhcnkgTWF0aFVpbnQ4IHsKICAgIGZ1bmN0aW9uIHhvclJlZHVjZSgKICAgICAgICB1aW50OFtdIGFyciwKICAgICAgICB1aW50ICAgIGxlbgogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50OCByZXMpCiAgICB7CiAgICAgICAgcmVzID0gYXJyWzBdOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHJlcyBePSBhcnJbaV07CiAgICAgICAgfQogICAgfQp9Ci8vLyBAdGl0bGUgUmluZyBIYXNoIFJlZ2lzdHJ5IENvbnRyYWN0Ci8vLyBAYXV0aG9yIEtvbmdsaWFuZyBaaG9uZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMmM0NzQzNDI0YjQwNDU0ZDQyNGI2YzQwNDM0MzVjNWU0NTQyNGIwMjQzNWU0YiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNTYzMjM3MzgzZjMzM2ExNjNhMzkzOTI2MjQzZjM4MzE3ODM5MjQzMSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+Lgpjb250cmFjdCBSaW5naGFzaFJlZ2lzdHJ5IHsKICAgIHVzaW5nIE1hdGhCeXRlczMyICAgZm9yIGJ5dGVzMzJbXTsKICAgIHVzaW5nIE1hdGhVaW50OCAgICAgZm9yIHVpbnQ4W107CiAgICB1aW50IHB1YmxpYyBibG9ja3NUb0xpdmU7CiAgICBzdHJ1Y3QgU3VibWlzc2lvbiB7CiAgICAgICAgYWRkcmVzcyByaW5nbWluZXI7CiAgICAgICAgdWludCBibG9jazsKICAgIH0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gU3VibWlzc2lvbikgc3VibWlzc2lvbnM7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gRXZlbnRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBSaW5naGFzaFN1Ym1pdHRlZCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3JpbmdtaW5lciwKICAgICAgICBieXRlczMyIGluZGV4ZWQgX3JpbmdoYXNoCiAgICApOwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIENvbnN0cnVjdG9yICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgZnVuY3Rpb24gUmluZ2hhc2hSZWdpc3RyeSh1aW50IF9ibG9ja3NUb0xpdmUpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShfYmxvY2tzVG9MaXZlID4gMCk7CiAgICAgICAgYmxvY2tzVG9MaXZlID0gX2Jsb2Nrc1RvTGl2ZTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBQdWJsaWMgRnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIGZ1bmN0aW9uIHN1Ym1pdFJpbmdoYXNoKAogICAgICAgIGFkZHJlc3MgICAgIHJpbmdtaW5lciwKICAgICAgICBieXRlczMyICAgICByaW5naGFzaAogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKGNhblN1Ym1pdChyaW5naGFzaCwgcmluZ21pbmVyKSk7IC8vLCAiUmluZ2hhc2ggc3VibWl0dGVkIik7CiAgICAgICAgc3VibWlzc2lvbnNbcmluZ2hhc2hdID0gU3VibWlzc2lvbihyaW5nbWluZXIsIGJsb2NrLm51bWJlcik7CiAgICAgICAgUmluZ2hhc2hTdWJtaXR0ZWQocmluZ21pbmVyLCByaW5naGFzaCk7CiAgICB9CiAgICBmdW5jdGlvbiBiYXRjaFN1Ym1pdFJpbmdoYXNoKAogICAgICAgIGFkZHJlc3NbXSAgICAgcmluZ21pbmVyTGlzdCwKICAgICAgICBieXRlczMyW10gICAgIHJpbmdoYXNoTGlzdAogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICB1aW50IHNpemUgPSByaW5nbWluZXJMaXN0Lmxlbmd0aDsKICAgICAgICByZXF1aXJlKHNpemUgPiAwKTsKICAgICAgICByZXF1aXJlKHNpemUgPT0gcmluZ2hhc2hMaXN0Lmxlbmd0aCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHN1Ym1pdFJpbmdoYXNoKHJpbmdtaW5lckxpc3RbaV0sIHJpbmdoYXNoTGlzdFtpXSk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIHRoZSBoYXNoIG9mIGEgcmluZy4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJpbmdoYXNoKAogICAgICAgIHVpbnQgICAgICAgIHJpbmdTaXplLAogICAgICAgIHVpbnQ4W10gICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgIHNMaXN0CiAgICAgICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zIChieXRlczMyKQogICAgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIHJpbmdTaXplID09IHZMaXN0Lmxlbmd0aCAtIDEgJiYgKAogICAgICAgICAgICByaW5nU2l6ZSA9PSByTGlzdC5sZW5ndGggLSAxICYmICgKICAgICAgICAgICAgcmluZ1NpemUgPT0gc0xpc3QubGVuZ3RoIC0gMSkpCiAgICAgICAgKTsgLy8sICJpbnZhbGlkIHJpbmcgZGF0YSIpOwogICAgICAgIHJldHVybiBrZWNjYWsyNTYoCiAgICAgICAgICAgIHZMaXN0LnhvclJlZHVjZShyaW5nU2l6ZSksCiAgICAgICAgICAgIHJMaXN0LnhvclJlZHVjZShyaW5nU2l6ZSksCiAgICAgICAgICAgIHNMaXN0LnhvclJlZHVjZShyaW5nU2l6ZSkKICAgICAgICApOwogICAgfQogICAgIC8vLyByZXR1cm4gdmFsdWUgYXR0cmlidXRlc1syXSBjb250YWlucyB0aGUgZm9sbG93aW5nIHZhbHVlcyBpbiB0aGlzIG9yZGVyOgogICAgIC8vLyBjYW5TdWJtaXQsIGlzUmVzZXJ2ZWQuCiAgICBmdW5jdGlvbiBjb21wdXRlQW5kR2V0UmluZ2hhc2hJbmZvKAogICAgICAgIHVpbnQgICAgICAgIHJpbmdTaXplLAogICAgICAgIGFkZHJlc3MgICAgIHJpbmdtaW5lciwKICAgICAgICB1aW50OFtdICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICByTGlzdCwKICAgICAgICBieXRlczMyW10gICBzTGlzdAogICAgICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChieXRlczMyIHJpbmdoYXNoLCBib29sWzJdIGF0dHJpYnV0ZXMpCiAgICB7CiAgICAgICAgcmluZ2hhc2ggPSBjYWxjdWxhdGVSaW5naGFzaCgKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIHZMaXN0LAogICAgICAgICAgICByTGlzdCwKICAgICAgICAgICAgc0xpc3QKICAgICAgICApOwogICAgICAgIGF0dHJpYnV0ZXNbMF0gPSBjYW5TdWJtaXQocmluZ2hhc2gsIHJpbmdtaW5lcik7CiAgICAgICAgYXR0cmlidXRlc1sxXSA9IGlzUmVzZXJ2ZWQocmluZ2hhc2gsIHJpbmdtaW5lcik7CiAgICB9CiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGEgcmluZydzIGhhc2ggY2FuIGJlIHN1Ym1pdHRlZDsKICAgIC8vLyBmYWxzZSBvdGhlcndpc2UuCiAgICBmdW5jdGlvbiBjYW5TdWJtaXQoCiAgICAgICAgYnl0ZXMzMiByaW5naGFzaCwKICAgICAgICBhZGRyZXNzIHJpbmdtaW5lcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB2YXIgc3VibWlzc2lvbiA9IHN1Ym1pc3Npb25zW3JpbmdoYXNoXTsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBzdWJtaXNzaW9uLnJpbmdtaW5lciA9PSBhZGRyZXNzKDApIHx8ICgKICAgICAgICAgICAgc3VibWlzc2lvbi5ibG9jayArIGJsb2Nrc1RvTGl2ZSA8IGJsb2NrLm51bWJlcikgfHwgKAogICAgICAgICAgICBzdWJtaXNzaW9uLnJpbmdtaW5lciA9PSByaW5nbWluZXIpCiAgICAgICAgKTsKICAgIH0KICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgYSByaW5nJ3MgaGFzaCB3YXMgc3VibWl0dGVkIGFuZCBzdGlsbCB2YWxpZDsKICAgIC8vLyBmYWxzZSBvdGhlcndpc2UuCiAgICBmdW5jdGlvbiBpc1Jlc2VydmVkKAogICAgICAgIGJ5dGVzMzIgcmluZ2hhc2gsCiAgICAgICAgYWRkcmVzcyByaW5nbWluZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdmFyIHN1Ym1pc3Npb24gPSBzdWJtaXNzaW9uc1tyaW5naGFzaF07CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgc3VibWlzc2lvbi5ibG9jayArIGJsb2Nrc1RvTGl2ZSA+PSBibG9jay5udW1iZXIgJiYgKAogICAgICAgICAgICBzdWJtaXNzaW9uLnJpbmdtaW5lciA9PSByaW5nbWluZXIpCiAgICAgICAgKTsKICAgIH0KfQovKgogIENvcHlyaWdodCAyMDE3IExvb3ByaW5nIFByb2plY3QgTHRkIChMb29wcmluZyBGb3VuZGF0aW9uKS4KICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwovLy8gQHRpdGxlIFRva2VuIFJlZ2lzdGVyIENvbnRyYWN0Ci8vLyBAYXV0aG9yIEtvbmdsaWFuZyBaaG9uZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNDAyYjJmMmUyNzJjMjkyMTJlMjcwMDJjMmYyZjMwMzIyOTJlMjc2ZTJmMzIyNyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYzBhNGExYWVhOWE1YWM4MGFjYWZhZmIwYjJhOWFlYTdlZWFmYjJhNyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+Lgpjb250cmFjdCBUb2tlblJlZ2lzdHJ5IGlzIE93bmFibGUgewogICAgYWRkcmVzc1tdIHB1YmxpYyB0b2tlbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHRva2VuTWFwOwogICAgbWFwcGluZyAoc3RyaW5nID0+IGFkZHJlc3MpIHRva2VuU3ltYm9sTWFwOwogICAgZnVuY3Rpb24gcmVnaXN0ZXJUb2tlbihhZGRyZXNzIF90b2tlbiwgc3RyaW5nIF9zeW1ib2wpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKCFpc1Rva2VuUmVnaXN0ZXJlZEJ5U3ltYm9sKF9zeW1ib2wpKTsKICAgICAgICByZXF1aXJlKCFpc1Rva2VuUmVnaXN0ZXJlZChfdG9rZW4pKTsKICAgICAgICB0b2tlbnMucHVzaChfdG9rZW4pOwogICAgICAgIHRva2VuTWFwW190b2tlbl0gPSB0cnVlOwogICAgICAgIHRva2VuU3ltYm9sTWFwW19zeW1ib2xdID0gX3Rva2VuOwogICAgfQogICAgZnVuY3Rpb24gdW5yZWdpc3RlclRva2VuKGFkZHJlc3MgX3Rva2VuLCBzdHJpbmcgX3N5bWJvbCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUoX3Rva2VuICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUodG9rZW5TeW1ib2xNYXBbX3N5bWJvbF0gPT0gX3Rva2VuKTsKICAgICAgICBkZWxldGUgdG9rZW5TeW1ib2xNYXBbX3N5bWJvbF07CiAgICAgICAgZGVsZXRlIHRva2VuTWFwW190b2tlbl07CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0b2tlbnNbaV0gPT0gX3Rva2VuKSB7CiAgICAgICAgICAgICAgICB0b2tlbnNbaV0gPSB0b2tlbnNbdG9rZW5zLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgdG9rZW5zLmxlbmd0aCAtLTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaXNUb2tlblJlZ2lzdGVyZWRCeVN5bWJvbChzdHJpbmcgc3ltYm9sKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiB0b2tlblN5bWJvbE1hcFtzeW1ib2xdICE9IGFkZHJlc3MoMCk7CiAgICB9CiAgICBmdW5jdGlvbiBpc1Rva2VuUmVnaXN0ZXJlZChhZGRyZXNzIF90b2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gdG9rZW5NYXBbX3Rva2VuXTsKICAgIH0KICAgIGZ1bmN0aW9uIGFyZUFsbFRva2Vuc1JlZ2lzdGVyZWQoYWRkcmVzc1tdIHRva2VuTGlzdCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCF0b2tlbk1hcFt0b2tlbkxpc3RbaV1dKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzQnlTeW1ib2woc3RyaW5nIHN5bWJvbCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3MpCiAgICB7CiAgICAgICAgcmV0dXJuIHRva2VuU3ltYm9sTWFwW3N5bWJvbF07CiAgICB9Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBUb2tlblRyYW5zZmVyRGVsZWdhdGUgLSBBY3RzIGFzIGEgbWlkZGxlIG1hbiB0byB0cmFuc2ZlciBFUkMyMCB0b2tlbnMKLy8vIG9uIGJlaGFsZiBvZiBkaWZmZXJlbnQgdmVyc2lvbnMgb2YgTG9vcHJpbmcgcHJvdG9jb2wgdG8gYXZvaWQgRVJDMjAKLy8vIHJlLWF1dGhvcml6YXRpb24uCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJmMDk0OTE5ZTk5OTU5Y2IwOWM5ZjlmODA4Mjk5OWU5N2RlOWY4Mjk3Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmNvbnRyYWN0IFRva2VuVHJhbnNmZXJEZWxlZ2F0ZSBpcyBPd25hYmxlIHsKICAgIHVzaW5nIE1hdGhVaW50IGZvciB1aW50OwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFZhcmlhYmxlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgbWFwcGluZyhhZGRyZXNzID0+IEFkZHJlc3NJbmZvKSBwcml2YXRlIGFkZHJlc3NJbmZvczsKICAgIGFkZHJlc3MgcHVibGljIGxhdGVzdEFkZHJlc3M7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gU3RydWN0cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBzdHJ1Y3QgQWRkcmVzc0luZm8gewogICAgICAgIGFkZHJlc3MgcHJldmlvdXM7CiAgICAgICAgdWludDMyICBpbmRleDsKICAgICAgICBib29sICAgIGF1dGhvcml6ZWQ7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gTW9kaWZpZXJzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBtb2RpZmllciBvbmx5QXV0aG9yaXplZCgpIHsKICAgICAgICBpZiAoaXNBZGRyZXNzQXV0aG9yaXplZChtc2cuc2VuZGVyKSA9PSBmYWxzZSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBFdmVudHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIGV2ZW50IEFkZHJlc3NBdXRob3JpemVkKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50MzIgbnVtYmVyKTsKICAgIGV2ZW50IEFkZHJlc3NEZWF1dGhvcml6ZWQoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQzMiBudW1iZXIpOwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFB1YmxpYyBGdW5jdGlvbnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBkZXYgQWRkIGEgTG9vcHJpbmcgcHJvdG9jb2wgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkciBBIGxvb3ByaW5nIHByb3RvY29sIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBhdXRob3JpemVBZGRyZXNzKGFkZHJlc3MgYWRkcikKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIEFkZHJlc3NJbmZvIHN0b3JhZ2UgYWRkckluZm8gPSBhZGRyZXNzSW5mb3NbYWRkcl07CiAgICAgICAgaWYgKGFkZHJJbmZvLmluZGV4ICE9IDApIHsgLy8gZXhpc3RpbmcKICAgICAgICAgICAgaWYgKGFkZHJJbmZvLmF1dGhvcml6ZWQgPT0gZmFsc2UpIHsgLy8gcmUtYXV0aG9yaXplCiAgICAgICAgICAgICAgICBhZGRySW5mby5hdXRob3JpemVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIEFkZHJlc3NBdXRob3JpemVkKGFkZHIsIGFkZHJJbmZvLmluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFkZHJlc3MgcHJldiA9IGxhdGVzdEFkZHJlc3M7CiAgICAgICAgICAgIGlmIChwcmV2ID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgICAgIGFkZHJJbmZvLmluZGV4ID0gMTsKICAgICAgICAgICAgICAgIGFkZHJJbmZvLmF1dGhvcml6ZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWRkckluZm8ucHJldmlvdXMgPSBwcmV2OwogICAgICAgICAgICAgICAgYWRkckluZm8uaW5kZXggPSBhZGRyZXNzSW5mb3NbcHJldl0uaW5kZXggKyAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZHJJbmZvLmF1dGhvcml6ZWQgPSB0cnVlOwogICAgICAgICAgICBsYXRlc3RBZGRyZXNzID0gYWRkcjsKICAgICAgICAgICAgQWRkcmVzc0F1dGhvcml6ZWQoYWRkciwgYWRkckluZm8uaW5kZXgpOwogICAgICAgIH0KICAgIH0KICAgIC8vLyBAZGV2IFJlbW92ZSBhIExvb3ByaW5nIHByb3RvY29sIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIGFkZHIgQSBsb29wcmluZyBwcm90b2NvbCBhZGRyZXNzLgogICAgZnVuY3Rpb24gZGVhdXRob3JpemVBZGRyZXNzKGFkZHJlc3MgYWRkcikKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIHVpbnQzMiBpbmRleCA9IGFkZHJlc3NJbmZvc1thZGRyXS5pbmRleDsKICAgICAgICBpZiAoaW5kZXggIT0gMCkgewogICAgICAgICAgICBhZGRyZXNzSW5mb3NbYWRkcl0uYXV0aG9yaXplZCA9IGZhbHNlOwogICAgICAgICAgICBBZGRyZXNzRGVhdXRob3JpemVkKGFkZHIsIGluZGV4KTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpc0FkZHJlc3NBdXRob3JpemVkKGFkZHJlc3MgYWRkcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYWRkcmVzc0luZm9zW2FkZHJdLmF1dGhvcml6ZWQ7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRMYXRlc3RBdXRob3JpemVkQWRkcmVzc2VzKHVpbnQgbWF4KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSBhZGRyZXNzZXMpCiAgICB7CiAgICAgICAgYWRkcmVzc2VzID0gbmV3IGFkZHJlc3NbXShtYXgpOwogICAgICAgIGFkZHJlc3MgYWRkciA9IGxhdGVzdEFkZHJlc3M7CiAgICAgICAgQWRkcmVzc0luZm8gbWVtb3J5IGFkZHJJbmZvOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHdoaWxlIChhZGRyICE9IGFkZHJlc3MoMCkgJiYgbWF4IDwgY291bnQpIHsKICAgICAgICAgICAgYWRkckluZm8gPSBhZGRyZXNzSW5mb3NbYWRkcl07CiAgICAgICAgICAgIGlmIChhZGRySW5mby5pbmRleCA9PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRyZXNzZXNbY291bnQrK10gPSBhZGRyOwogICAgICAgICAgICBhZGRyID0gYWRkckluZm8ucHJldmlvdXM7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgSW52b2tlIEVSQzIwIHRyYW5zZmVyRnJvbSBtZXRob2QuCiAgICAvLy8gQHBhcmFtIHRva2VuIEFkZHJlc3Mgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGZyb20gQWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbiBmcm9tLgogICAgLy8vIEBwYXJhbSB0byBBZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VuIHRvLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBBbW91bnQgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuKAogICAgICAgIGFkZHJlc3MgdG9rZW4sCiAgICAgICAgYWRkcmVzcyBmcm9tLAogICAgICAgIGFkZHJlc3MgdG8sCiAgICAgICAgdWludCAgICB2YWx1ZSkKICAgICAgICBvbmx5QXV0aG9yaXplZAogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgaWYgKHZhbHVlID4gMCAmJiBmcm9tICE9IHRvKSB7CiAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICBFUkMyMCh0b2tlbikudHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSkKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBiYXRjaFRyYW5zZmVyVG9rZW4oCiAgICAgICAgdWludCByaW5nU2l6ZSwgCiAgICAgICAgYWRkcmVzcyBscmNUb2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBmZWVSZWNpcGllbnQsCiAgICAgICAgYnl0ZXMzMltdIGJhdGNoKQogICAgICAgIG9ubHlBdXRob3JpemVkCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKGJhdGNoLmxlbmd0aCA9PSByaW5nU2l6ZSAqIDYpOwogICAgICAgIHVpbnQgcCA9IHJpbmdTaXplICogMjsKICAgICAgICB2YXIgbHJjID0gRVJDMjAobHJjVG9rZW5BZGRyZXNzKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgcHJldiA9ICgoaSArIHJpbmdTaXplIC0gMSkgJSByaW5nU2l6ZSk7CiAgICAgICAgICAgIGFkZHJlc3MgdG9rZW5TID0gYWRkcmVzcyhiYXRjaFtpXSk7CiAgICAgICAgICAgIGFkZHJlc3Mgb3duZXIgPSBhZGRyZXNzKGJhdGNoW3JpbmdTaXplICsgaV0pOwogICAgICAgICAgICBhZGRyZXNzIHByZXZPd25lciA9IGFkZHJlc3MoYmF0Y2hbcmluZ1NpemUgKyBwcmV2XSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBQYXkgdG9rZW5TIHRvIHByZXZpb3VzIG9yZGVyLCBvciB0byBtaW5lciBhcyBwcmV2aW91cyBvcmRlcidzCiAgICAgICAgICAgIC8vIG1hcmdpbiBzcGxpdCBvci9hbmQgdGhpcyBvcmRlcidzIG1hcmdpbiBzcGxpdC4KICAgICAgICAgICAgRVJDMjAgX3Rva2VuUzsKICAgICAgICAgICAgLy8gVHJ5IHRvIGNyZWF0ZSBFUkMyMCBpbnN0YW5jZXMgb25seSBvbmNlIHBlciB0b2tlbi4KICAgICAgICAgICAgaWYgKG93bmVyICE9IHByZXZPd25lciB8fCBvd25lciAhPSBmZWVSZWNpcGllbnQgJiYgYmF0Y2hbcCsxXSAhPSAwKSB7CiAgICAgICAgICAgICAgICBfdG9rZW5TID0gRVJDMjAodG9rZW5TKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBIZXJlIGJhdGNoW3BdIGhhcyBiZWVuIGNoZWNrZWQgbm90IHRvIGJlIDAuCiAgICAgICAgICAgIGlmIChvd25lciAhPSBwcmV2T3duZXIpIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICAgICAgX3Rva2VuUy50cmFuc2ZlckZyb20ob3duZXIsIHByZXZPd25lciwgdWludChiYXRjaFtwXSkpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvd25lciAhPSBmZWVSZWNpcGllbnQpIHsKICAgICAgICAgICAgICAgIGlmIChiYXRjaFtwKzFdICE9IDApIHsKICAgICAgICAgICAgICAgICAgICByZXF1aXJlKAogICAgICAgICAgICAgICAgICAgICAgICBfdG9rZW5TLnRyYW5zZmVyRnJvbShvd25lciwgZmVlUmVjaXBpZW50LCB1aW50KGJhdGNoW3ArMV0pKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgaWYgKGJhdGNoW3ArMl0gIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICAgICAgICAgIGxyYy50cmFuc2ZlckZyb20oZmVlUmVjaXBpZW50LCBvd25lciwgdWludChiYXRjaFtwKzJdKSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGJhdGNoW3ArM10gIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICAgICAgICAgIGxyYy50cmFuc2ZlckZyb20ob3duZXIsIGZlZVJlY2lwaWVudCwgdWludChiYXRjaFtwKzNdKSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHAgKz0gNDsKICAgICAgICB9CiAgICB9Cn0KLy8vIEB0aXRsZSBMb29wcmluZyBUb2tlbiBFeGNoYW5nZSBQcm90b2NvbCBJbXBsZW1lbnRhdGlvbiBDb250cmFjdCB2MQovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZTk4ZDg4ODc4MDhjODVhOTg1ODY4Njk5OWI4MDg3OGVjNzg2OWI4ZSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LAovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImUxOGE4ZThmODY4ZDg4ODA4Zjg2YTE4ZDhlOGU5MTkzODg4Zjg2Y2Y4ZTkzODYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pgpjb250cmFjdCBMb29wcmluZ1Byb3RvY29sSW1wbCBpcyBMb29wcmluZ1Byb3RvY29sIHsKICAgIHVzaW5nIE1hdGhVaW50IGZvciB1aW50OwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFZhcmlhYmxlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgYWRkcmVzcyBwdWJsaWMgIGxyY1Rva2VuQWRkcmVzcyAgICAgICAgICAgICA9IGFkZHJlc3MoMCk7CiAgICBhZGRyZXNzIHB1YmxpYyAgdG9rZW5SZWdpc3RyeUFkZHJlc3MgICAgICAgID0gYWRkcmVzcygwKTsKICAgIGFkZHJlc3MgcHVibGljICByaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcyAgICAgPSBhZGRyZXNzKDApOwogICAgYWRkcmVzcyBwdWJsaWMgIGRlbGVnYXRlQWRkcmVzcyAgICAgICAgICAgICA9IGFkZHJlc3MoMCk7CiAgICB1aW50ICAgIHB1YmxpYyAgbWF4UmluZ1NpemUgICAgICAgICAgICAgICAgID0gMDsKICAgIHVpbnQ2NCAgcHVibGljICByaW5nSW5kZXggICAgICAgICAgICAgICAgICAgPSAwOwogICAgLy8gRXhjaGFuZ2UgcmF0ZSAocmF0ZSkgaXMgdGhlIGFtb3VudCB0byBzZWxsIG9yIHNvbGQgZGl2aWRlZCBieSB0aGUgYW1vdW50CiAgICAvLyB0byBidXkgb3IgYm91Z2h0LgogICAgLy8KICAgIC8vIFJhdGUgcmF0aW8gaXMgdGhlIHJhdGlvIGJldHdlZW4gZXhlY3V0ZWQgcmF0ZSBhbmQgYW4gb3JkZXIncyBvcmlnaW5hbAogICAgLy8gcmF0ZS4KICAgIC8vCiAgICAvLyBUbyByZXF1aXJlIGFsbCBvcmRlcnMnIHJhdGUgcmF0aW9zIHRvIGhhdmUgY29lZmZpY2llbnQgb2Z2YXJpYXRpb24gKENWKQogICAgLy8gc21hbGxlciB0aGFuIDIuNSUsIGZvciBhbiBleGFtcGxlICwgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkIHNob3VsZCBiZToKICAgIC8vICAgICBgKDAuMDI1ICogUkFURV9SQVRJT19TQ0FMRSleMmAgb3IgNjI1MDAuCiAgICB1aW50ICAgIHB1YmxpYyAgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkICAgICAgID0gMDsKICAgIHVpbnQgICAgcHVibGljIGNvbnN0YW50IFJBVEVfUkFUSU9fU0NBTEUgICAgPSAxMDAwMDsKICAgIHVpbnQ2NCAgcHVibGljIGNvbnN0YW50IEVOVEVSRURfTUFTSyAgICAgICAgPSAxIDw8IDYzOwogICAgLy8gVGhlIGZvbGxvd2luZyBtYXAgaXMgdXNlZCB0byBrZWVwIHRyYWNlIG9mIG9yZGVyIGZpbGwgYW5kIGNhbmNlbGxhdGlvbgogICAgLy8gaGlzdG9yeS4KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcHVibGljIGNhbmNlbGxlZE9yRmlsbGVkOwogICAgLy8gQSBtYXAgZnJvbSBhZGRyZXNzIHRvIGl0cyBjdXRvZmYgdGltZXN0YW1wLgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgY3V0b2ZmczsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBTdHJ1Y3RzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIHN0cnVjdCBSYXRlIHsKICAgICAgICB1aW50IGFtb3VudFM7CiAgICAgICAgdWludCBhbW91bnRCOwogICAgfQogICAgLy8vIEBwYXJhbSBvcmRlciAgICAgICAgVGhlIG9yaWdpbmFsIG9yZGVyCiAgICAvLy8gQHBhcmFtIG9yZGVySGFzaCAgICBUaGUgb3JkZXIncyBoYXNoCiAgICAvLy8gQHBhcmFtIGZlZVNlbGVjdGlvbiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBBIG1pbmVyLXN1cHBsaWVkIHZhbHVlIGluZGljYXRpbmcgaWYgTFJDICh2YWx1ZSA9IDApCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvciBtYXJnaW4gc3BsaXQgaXMgY2hvb3NlbiBieSB0aGUgbWluZXIgKHZhbHVlID0gMSkuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBXZSBtYXkgc3VwcG9ydCBtb3JlIGZlZSBtb2RlbCBpbiB0aGUgZnV0dXJlLgogICAgLy8vIEBwYXJhbSByYXRlICAgICAgICAgRXhjaGFuZ2UgcmF0ZSBwcm92aWRlZCBieSBtaW5lci4KICAgIC8vLyBAcGFyYW0gYXZhaWxhYmxlQW1vdW50UyAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBUaGUgYWN0dWFsIHNwZW5kYWJsZSBhbW91bnRTLgogICAgLy8vIEBwYXJhbSBmaWxsQW1vdW50UyAgQW1vdW50IG9mIHRva2VuUyB0byBzZWxsLCBjYWxjdWxhdGVkIGJ5IHByb3RvY29sLgogICAgLy8vIEBwYXJhbSBscmNSZXdhcmQgICAgVGhlIGFtb3VudCBvZiBMUkMgcGFpZCBieSBtaW5lciB0byBvcmRlciBvd25lciBpbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2UgZm9yIG1hcmdpbiBzcGxpdC4KICAgIC8vLyBAcGFyYW0gbHJjRmVlICAgICAgIFRoZSBhbW91bnQgb2YgTFIgcGFpZCBieSBvcmRlciBvd25lciB0byBtaW5lci4KICAgIC8vLyBAcGFyYW0gc3BsaXRTICAgICAgVG9rZW5TIHBhaWQgdG8gbWluZXIuCiAgICAvLy8gQHBhcmFtIHNwbGl0QiAgICAgIFRva2VuQiBwYWlkIHRvIG1pbmVyLgogICAgc3RydWN0IE9yZGVyU3RhdGUgewogICAgICAgIE9yZGVyICAgb3JkZXI7CiAgICAgICAgYnl0ZXMzMiBvcmRlckhhc2g7CiAgICAgICAgdWludDggICBmZWVTZWxlY3Rpb247CiAgICAgICAgUmF0ZSAgICByYXRlOwogICAgICAgIHVpbnQgICAgYXZhaWxhYmxlQW1vdW50UzsKICAgICAgICB1aW50ICAgIGZpbGxBbW91bnRTOwogICAgICAgIHVpbnQgICAgbHJjUmV3YXJkOwogICAgICAgIHVpbnQgICAgbHJjRmVlOwogICAgICAgIHVpbnQgICAgc3BsaXRTOwogICAgICAgIHVpbnQgICAgc3BsaXRCOwogICAgfQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEV2ZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgUmluZ01pbmVkKAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX3JpbmdJbmRleCwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF90aW1lLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2Jsb2NrbnVtYmVyLAogICAgICAgIGJ5dGVzMzIgICAgIGluZGV4ZWQgX3JpbmdoYXNoLAogICAgICAgIGFkZHJlc3MgICAgIGluZGV4ZWQgX21pbmVyLAogICAgICAgIGFkZHJlc3MgICAgIGluZGV4ZWQgX2ZlZVJlY2lwaWVudCwKICAgICAgICBib29sICAgICAgICAgICAgICAgIF9pc1JpbmdoYXNoUmVzZXJ2ZWQKICAgICk7CiAgICBldmVudCBPcmRlckZpbGxlZCgKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9yaW5nSW5kZXgsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfdGltZSwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9ibG9ja251bWJlciwKICAgICAgICBieXRlczMyICAgICBpbmRleGVkIF9yaW5naGFzaCwKICAgICAgICBieXRlczMyICAgICAgICAgICAgIF9wcmV2T3JkZXJIYXNoLAogICAgICAgIGJ5dGVzMzIgICAgIGluZGV4ZWQgX29yZGVySGFzaCwKICAgICAgICBieXRlczMyICAgICAgICAgICAgICBfbmV4dE9yZGVySGFzaCwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9hbW91bnRTLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2Ftb3VudEIsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfbHJjUmV3YXJkLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2xyY0ZlZQogICAgKTsKICAgIGV2ZW50IE9yZGVyQ2FuY2VsbGVkKAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX3RpbWUsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfYmxvY2tudW1iZXIsCiAgICAgICAgYnl0ZXMzMiAgICAgaW5kZXhlZCBfb3JkZXJIYXNoLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2Ftb3VudENhbmNlbGxlZAogICAgKTsKICAgIGV2ZW50IEN1dG9mZlRpbWVzdGFtcENoYW5nZWQoCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfdGltZSwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9ibG9ja251bWJlciwKICAgICAgICBhZGRyZXNzICAgICBpbmRleGVkIF9hZGRyZXNzLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2N1dG9mZgogICAgKTsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBDb25zdHJ1Y3RvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIGZ1bmN0aW9uIExvb3ByaW5nUHJvdG9jb2xJbXBsKAogICAgICAgIGFkZHJlc3MgX2xyY1Rva2VuQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF90b2tlblJlZ2lzdHJ5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9yaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9kZWxlZ2F0ZUFkZHJlc3MsCiAgICAgICAgdWludCAgICBfbWF4UmluZ1NpemUsCiAgICAgICAgdWludCAgICBfcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkCiAgICAgICAgKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoYWRkcmVzcygwKSAhPSBfbHJjVG9rZW5BZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoMCkgIT0gX3Rva2VuUmVnaXN0cnlBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoMCkgIT0gX3JpbmdoYXNoUmVnaXN0cnlBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoMCkgIT0gX2RlbGVnYXRlQWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShfbWF4UmluZ1NpemUgPiAxKTsKICAgICAgICByZXF1aXJlKF9yYXRlUmF0aW9DVlNUaHJlc2hvbGQgPiAwKTsKICAgICAgICBscmNUb2tlbkFkZHJlc3MgPSBfbHJjVG9rZW5BZGRyZXNzOwogICAgICAgIHRva2VuUmVnaXN0cnlBZGRyZXNzID0gX3Rva2VuUmVnaXN0cnlBZGRyZXNzOwogICAgICAgIHJpbmdoYXNoUmVnaXN0cnlBZGRyZXNzID0gX3JpbmdoYXNoUmVnaXN0cnlBZGRyZXNzOwogICAgICAgIGRlbGVnYXRlQWRkcmVzcyA9IF9kZWxlZ2F0ZUFkZHJlc3M7CiAgICAgICAgbWF4UmluZ1NpemUgPSBfbWF4UmluZ1NpemU7CiAgICAgICAgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkID0gX3JhdGVSYXRpb0NWU1RocmVzaG9sZDsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBQdWJsaWMgRnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAZGV2IERpc2FibGUgZGVmYXVsdCBmdW5jdGlvbi4KICAgIGZ1bmN0aW9uICgpCiAgICAgICAgcGF5YWJsZQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJldmVydCgpOwogICAgfQogICAgLy8vIEBkZXYgU3VibWl0IGEgb3JkZXItcmluZyBmb3IgdmFsaWRhdGlvbiBhbmQgc2V0dGxlbWVudC4KICAgIC8vLyBAcGFyYW0gYWRkcmVzc0xpc3QgIExpc3Qgb2YgZWFjaCBvcmRlcidzIHRva2VuUy4gTm90ZSB0aGF0IG5leHQgb3JkZXIncwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYHRva2VuU2AgZXF1YWxzIHRoaXMgb3JkZXIncyBgdG9rZW5CYC4KICAgIC8vLyBAcGFyYW0gdWludEFyZ3NMaXN0IExpc3Qgb2YgdWludC10eXBlIGFyZ3VtZW50cyBpbiB0aGlzIG9yZGVyOgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYW1vdW50UywgYW1vdW50QiwgdGltZXN0YW1wLCB0dGwsIHNhbHQsIGxyY0ZlZSwKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHJhdGVBbW91bnRTLgogICAgLy8vIEBwYXJhbSB1aW50OEFyZ3NMaXN0IC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExpc3Qgb2YgdW5pdDgtdHlwZSBhcmd1bWVudHMsIGluIHRoaXMgb3JkZXI6CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2VMaXN0LGZlZVNlbGVjdGlvbkxpc3QuCiAgICAvLy8gQHBhcmFtIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBUaGlzIGluZGljYXRlcyB3aGVuIGEgb3JkZXIgc2hvdWxkIGJlIGNvbnNpZGVyZWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGFzICdjb21wbGV0ZWx5IGZpbGxlZCcuCiAgICAvLy8gQHBhcmFtIHZMaXN0ICAgICAgICBMaXN0IG9mIHYgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHYgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSByTGlzdCAgICAgICAgTGlzdCBvZiByIGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICByIHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gc0xpc3QgICAgICAgIExpc3Qgb2YgcyBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgcyB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHJpbmdtaW5lciAgICBUaGUgYWRkcmVzcyB0aGF0IHNpZ25lZCB0aGlzIHR4LgogICAgLy8vIEBwYXJhbSBmZWVSZWNpcGllbnQgVGhlIFJlY2lwaWVudCBhZGRyZXNzIGZvciBmZWUgY29sbGVjdGlvbi4gSWYgdGhpcyBpcwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgJzB4MCcsIGFsbCBmZWVzIHdpbGwgYmUgcGFpZCB0byB0aGUgYWRkcmVzcyB3aG8gaGFkCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBzaWduZWQgdGhpcyB0cmFuc2FjdGlvbiwgbm90IGBtc2cuc2VuZGVyYC4gTm90ZWQgaWYKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExSQyBuZWVkIHRvIGJlIHBhaWQgYmFjayB0byBvcmRlciBvd25lciBhcyB0aGUgcmVzdWx0CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvZiBmZWUgc2VsZWN0aW9uIG1vZGVsLCBMUkMgd2lsbCBhbHNvIGJlIHNlbnQgZnJvbQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhpcyBhZGRyZXNzLgogICAgZnVuY3Rpb24gc3VibWl0UmluZygKICAgICAgICBhZGRyZXNzWzJdW10gIGFkZHJlc3NMaXN0LAogICAgICAgIHVpbnRbN11bXSAgICAgdWludEFyZ3NMaXN0LAogICAgICAgIHVpbnQ4WzJdW10gICAgdWludDhBcmdzTGlzdCwKICAgICAgICBib29sW10gICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICB1aW50OFtdICAgICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICBzTGlzdCwKICAgICAgICBhZGRyZXNzICAgICAgIHJpbmdtaW5lciwKICAgICAgICBhZGRyZXNzICAgICAgIGZlZVJlY2lwaWVudAogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvLyBDaGVjayBpZiB0aGUgaGlnaGVzdCBiaXQgb2YgcmluZ0luZGV4IGlzICcxJy4KICAgICAgICByZXF1aXJlKHJpbmdJbmRleCAmIEVOVEVSRURfTUFTSyAhPSBFTlRFUkVEX01BU0spOyAvLyAiYXR0ZW1wdGVkIHRvIHJlLWVudCBzdWJtaXRSaW5nIGZ1bmN0aW9uIik7CiAgICAgICAgLy8gU2V0IHRoZSBoaWdoZXN0IGJpdCBvZiByaW5nSW5kZXggdG8gJzEnLgogICAgICAgIHJpbmdJbmRleCB8PSBFTlRFUkVEX01BU0s7CiAgICAgICAgLy9DaGVjayByaW5nIHNpemUKICAgICAgICB1aW50IHJpbmdTaXplID0gYWRkcmVzc0xpc3QubGVuZ3RoOwogICAgICAgIHJlcXVpcmUocmluZ1NpemUgPiAxICYmIHJpbmdTaXplIDw9IG1heFJpbmdTaXplKTsgLy8gImludmFsaWQgcmluZyBzaXplIik7CiAgICAgICAgdmVyaWZ5SW5wdXREYXRhSW50ZWdyaXR5KAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgYWRkcmVzc0xpc3QsCiAgICAgICAgICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICAgICAgdWludDhBcmdzTGlzdCwKICAgICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgICAgICB2TGlzdCwKICAgICAgICAgICAgckxpc3QsCiAgICAgICAgICAgIHNMaXN0CiAgICAgICAgKTsKICAgICAgICB2ZXJpZnlUb2tlbnNSZWdpc3RlcmVkKHJpbmdTaXplLCBhZGRyZXNzTGlzdCk7CiAgICAgICAgdmFyIChyaW5naGFzaCwgcmluZ2hhc2hBdHRyaWJ1dGVzKSA9IFJpbmdoYXNoUmVnaXN0cnkoCiAgICAgICAgICAgIHJpbmdoYXNoUmVnaXN0cnlBZGRyZXNzCiAgICAgICAgKS5jb21wdXRlQW5kR2V0UmluZ2hhc2hJbmZvKAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgcmluZ21pbmVyLAogICAgICAgICAgICB2TGlzdCwKICAgICAgICAgICAgckxpc3QsCiAgICAgICAgICAgIHNMaXN0CiAgICAgICAgKTsKICAgICAgICAvL0NoZWNrIGlmIHdlIGNhbiBzdWJtaXQgdGhpcyByaW5naGFzaC4KICAgICAgICByZXF1aXJlKHJpbmdoYXNoQXR0cmlidXRlc1swXSk7IC8vICJSaW5nIGNsYWltZWQgYnkgb3RoZXJzIik7CiAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKAogICAgICAgICAgICByaW5nbWluZXIsCiAgICAgICAgICAgIHJpbmdoYXNoLAogICAgICAgICAgICB2TGlzdFtyaW5nU2l6ZV0sCiAgICAgICAgICAgIHJMaXN0W3JpbmdTaXplXSwKICAgICAgICAgICAgc0xpc3RbcmluZ1NpemVdCiAgICAgICAgKTsKICAgICAgICBUb2tlblRyYW5zZmVyRGVsZWdhdGUgZGVsZWdhdGUgPSBUb2tlblRyYW5zZmVyRGVsZWdhdGUoZGVsZWdhdGVBZGRyZXNzKTsKICAgICAgICAvL0Fzc2VtYmxlIGlucHV0IGRhdGEgaW50byBzdHJ1Y3RzIHNvIHdlIGNhbiBwYXNzIHRoZW0gdG8gb3RoZXIgZnVuY3Rpb25zLgogICAgICAgIHZhciBvcmRlcnMgPSBhc3NlbWJsZU9yZGVycygKICAgICAgICAgICAgZGVsZWdhdGUsCiAgICAgICAgICAgIGFkZHJlc3NMaXN0LAogICAgICAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CiAgICAgICAgaWYgKGZlZVJlY2lwaWVudCA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGZlZVJlY2lwaWVudCA9IHJpbmdtaW5lcjsKICAgICAgICB9CiAgICAgICAgaGFuZGxlUmluZygKICAgICAgICAgICAgZGVsZWdhdGUsCiAgICAgICAgICAgIHJpbmdTaXplLAogICAgICAgICAgICByaW5naGFzaCwKICAgICAgICAgICAgb3JkZXJzLAogICAgICAgICAgICByaW5nbWluZXIsCiAgICAgICAgICAgIGZlZVJlY2lwaWVudCwKICAgICAgICAgICAgcmluZ2hhc2hBdHRyaWJ1dGVzWzFdCiAgICAgICAgKTsKICAgICAgICByaW5nSW5kZXggPSByaW5nSW5kZXggXiBFTlRFUkVEX01BU0sgKyAxOwogICAgfQogICAgLy8vIEBkZXYgQ2FuY2VsIGEgb3JkZXIuIGNhbmNlbCBhbW91bnQoYW1vdW50UyBvciBhbW91bnRCKSBjYW4gYmUgc3BlY2lmaWVkCiAgICAvLy8gICAgICBpbiBvcmRlclZhbHVlcy4KICAgIC8vLyBAcGFyYW0gYWRkcmVzc2VzICAgICAgICAgIG93bmVyLCB0b2tlblMsIHRva2VuQgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyAgICAgICAgYW1vdW50UywgYW1vdW50QiwgdGltZXN0YW1wLCB0dGwsIHNhbHQsIGxyY0ZlZSwKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEFtb3VudFMsIGFuZCBjYW5jZWxBbW91bnRCLgogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50QiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIGluZGljYXRlcyB3aGVuIGEgb3JkZXIgc2hvdWxkIGJlIGNvbnNpZGVyZWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzICdjb21wbGV0ZWx5IGZpbGxlZCcuCiAgICAvLy8gQHBhcmFtIG1hcmdpblNwbGl0UGVyY2VudGFnZSAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBQZXJjZW50YWdlIG9mIG1hcmdpbiBzcGxpdCB0byBzaGFyZSB3aXRoIG1pbmVyLgogICAgLy8vIEBwYXJhbSB2ICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcigKICAgICAgICBhZGRyZXNzWzNdIGFkZHJlc3NlcywKICAgICAgICB1aW50WzddICAgIG9yZGVyVmFsdWVzLAogICAgICAgIGJvb2wgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgdWludDggICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UsCiAgICAgICAgdWludDggICAgICB2LAogICAgICAgIGJ5dGVzMzIgICAgciwKICAgICAgICBieXRlczMyICAgIHMKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgdWludCBjYW5jZWxBbW91bnQgPSBvcmRlclZhbHVlc1s2XTsKICAgICAgICByZXF1aXJlKGNhbmNlbEFtb3VudCA+IDApOyAvLyAiYW1vdW50IHRvIGNhbmNlbCBpcyB6ZXJvIik7CiAgICAgICAgdmFyIG9yZGVyID0gT3JkZXIoCiAgICAgICAgICAgIGFkZHJlc3Nlc1swXSwKICAgICAgICAgICAgYWRkcmVzc2VzWzFdLAogICAgICAgICAgICBhZGRyZXNzZXNbMl0sCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzBdLAogICAgICAgICAgICBvcmRlclZhbHVlc1sxXSwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbNV0sCiAgICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCLAogICAgICAgICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UKICAgICAgICApOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmRlci5vd25lcik7IC8vICJjYW5jZWxPcmRlciBub3Qgc3VibWl0dGVkIGJ5IG9yZGVyIG93bmVyIik7CiAgICAgICAgYnl0ZXMzMiBvcmRlckhhc2ggPSBjYWxjdWxhdGVPcmRlckhhc2goCiAgICAgICAgICAgIG9yZGVyLAogICAgICAgICAgICBvcmRlclZhbHVlc1syXSwgLy8gdGltZXN0YW1wCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzNdLCAvLyB0dGwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbNF0gIC8vIHNhbHQKICAgICAgICApOwogICAgICAgIHZlcmlmeVNpZ25hdHVyZSgKICAgICAgICAgICAgb3JkZXIub3duZXIsCiAgICAgICAgICAgIG9yZGVySGFzaCwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcwogICAgICAgICk7CiAgICAgICAgY2FuY2VsbGVkT3JGaWxsZWRbb3JkZXJIYXNoXSA9IGNhbmNlbGxlZE9yRmlsbGVkW29yZGVySGFzaF0uYWRkKGNhbmNlbEFtb3VudCk7CiAgICAgICAgT3JkZXJDYW5jZWxsZWQoCiAgICAgICAgICAgIGJsb2NrLnRpbWVzdGFtcCwKICAgICAgICAgICAgYmxvY2subnVtYmVyLAogICAgICAgICAgICBvcmRlckhhc2gsCiAgICAgICAgICAgIGNhbmNlbEFtb3VudAogICAgICAgICk7CiAgICB9CiAgICAvLy8gQGRldiAgIFNldCBhIGN1dG9mZiB0aW1lc3RhbXAgdG8gaW52YWxpZGF0ZSBhbGwgb3JkZXJzIHdob3NlIHRpbWVzdGFtcAogICAgLy8vICAgICAgICBpcyBzbWFsbGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIG5ldyB2YWx1ZSBvZiB0aGUgYWRkcmVzcydzIGN1dG9mZgogICAgLy8vICAgICAgICB0aW1lc3RhbXAuCiAgICAvLy8gQHBhcmFtIGN1dG9mZiBUaGUgY3V0b2ZmIHRpbWVzdGFtcCwgd2lsbCBkZWZhdWx0IHRvIGBibG9jay50aW1lc3RhbXBgCiAgICAvLy8gICAgICAgIGlmIGl0IGlzIDAuCiAgICBmdW5jdGlvbiBzZXRDdXRvZmYodWludCBjdXRvZmYpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgdWludCB0ID0gY3V0b2ZmOwogICAgICAgIGlmICh0ID09IDApIHsKICAgICAgICAgICAgdCA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShjdXRvZmZzW21zZy5zZW5kZXJdIDwgdCk7IC8vICJhdHRlbXB0ZWQgdG8gc2V0IGN1dG9mZiB0byBhIHNtYWxsZXIgdmFsdWUiKTsKICAgICAgICBjdXRvZmZzW21zZy5zZW5kZXJdID0gdDsKICAgICAgICBDdXRvZmZUaW1lc3RhbXBDaGFuZ2VkKAogICAgICAgICAgICBibG9jay50aW1lc3RhbXAsCiAgICAgICAgICAgIGJsb2NrLm51bWJlciwKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgdAogICAgICAgICk7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gSW50ZXJuYWwgJiBQcml2YXRlIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQGRldiBWYWxpZGF0ZSBhIHJpbmcuCiAgICBmdW5jdGlvbiB2ZXJpZnlSaW5nSGFzTm9TdWJSaW5nKAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgT3JkZXJTdGF0ZVtdICBvcmRlcnMKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUKICAgIHsKICAgICAgICAvLyBDaGVjayB0aGUgcmluZyBoYXMgbm8gc3ViLXJpbmcuCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemUgLSAxOyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyB0b2tlblMgPSBvcmRlcnNbaV0ub3JkZXIudG9rZW5TOwogICAgICAgICAgICBmb3IgKHVpbnQgaiA9IGkgKyAxOyBqIDwgcmluZ1NpemU7IGorKykgewogICAgICAgICAgICAgICAgcmVxdWlyZSh0b2tlblMgIT0gb3JkZXJzW2pdLm9yZGVyLnRva2VuUyk7IC8vICJmb3VuZCBzdWItcmluZyIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gdmVyaWZ5VG9rZW5zUmVnaXN0ZXJlZCgKICAgICAgICB1aW50ICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIGFkZHJlc3NbMl1bXSAgYWRkcmVzc0xpc3QKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgIHsKICAgICAgICAvLyBFeHRyYWN0IHRoZSB0b2tlbiBhZGRyZXNzZXMKICAgICAgICB2YXIgdG9rZW5zID0gbmV3IGFkZHJlc3NbXShyaW5nU2l6ZSk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB0b2tlbnNbaV0gPSBhZGRyZXNzTGlzdFtpXVsxXTsKICAgICAgICB9CiAgICAgICAgLy8gVGVzdCBhbGwgdG9rZW4gYWRkcmVzc2VzIGF0IG9uY2UKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBUb2tlblJlZ2lzdHJ5KHRva2VuUmVnaXN0cnlBZGRyZXNzKS5hcmVBbGxUb2tlbnNSZWdpc3RlcmVkKHRva2VucykKICAgICAgICApOyAvLyAidG9rZW4gbm90IHJlZ2lzdGVyZWQiKTsKICAgIH0KICAgIGZ1bmN0aW9uIGhhbmRsZVJpbmcoCiAgICAgICAgVG9rZW5UcmFuc2ZlckRlbGVnYXRlIGRlbGVnYXRlLAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgYnl0ZXMzMiAgICAgICByaW5naGFzaCwKICAgICAgICBPcmRlclN0YXRlW10gIG9yZGVycywKICAgICAgICBhZGRyZXNzICAgICAgIG1pbmVyLAogICAgICAgIGFkZHJlc3MgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgIGJvb2wgICAgICAgICAgaXNSaW5naGFzaFJlc2VydmVkCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgIHsKICAgICAgICAvLyBEbyB0aGUgaGFyZCB3b3JrLgogICAgICAgIHZlcmlmeVJpbmdIYXNOb1N1YlJpbmcocmluZ1NpemUsIG9yZGVycyk7CiAgICAgICAgLy8gRXhjaGFuZ2UgcmF0ZXMgY2FsY3VsYXRpb24gYXJlIHBlcmZvcm1lZCBieSByaW5nLW1pbmVycyBhcyBzb2xpZGl0eQogICAgICAgIC8vIGNhbm5vdCBnZXQgcG93ZXItb2YtMS9uIG9wZXJhdGlvbiwgdGhlcmVmb3JlIHdlIGhhdmUgdG8gdmVyaWZ5CiAgICAgICAgLy8gdGhlc2UgcmF0ZXMgYXJlIGNvcnJlY3QuCiAgICAgICAgdmVyaWZ5TWluZXJTdXBwbGllZEZpbGxSYXRlcyhyaW5nU2l6ZSwgb3JkZXJzKTsKICAgICAgICAvLyBTY2FsZSBkb3duIGVhY2ggb3JkZXIgaW5kZXBlbmRlbnRseSBieSBzdWJzdHJhY3RpbmcgYW1vdW50LWZpbGxlZCBhbmQKICAgICAgICAvLyBhbW91bnQtY2FuY2VsbGVkLiBPcmRlciBvd25lcidzIGN1cnJlbnQgYmFsYW5jZSBhbmQgYWxsb3dhbmNlIGFyZQogICAgICAgIC8vIG5vdCB0YWtlbiBpbnRvIGNvbnNpZGVyYXRpb24gaW4gdGhlc2Ugb3BlcmF0aW9ucy4KICAgICAgICBzY2FsZVJpbmdCYXNlZE9uSGlzdG9yaWNhbFJlY29yZHMocmluZ1NpemUsIG9yZGVycyk7CiAgICAgICAgLy8gQmFzZWQgb24gdGhlIGFscmVhZHkgdmVyaWZpZWQgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlZCBieSByaW5nLW1pbmVycywKICAgICAgICAvLyB3ZSBjYW4gZnVydGh1ciBzY2FsZSBkb3duIG9yZGVycyBiYXNlZCBvbiB0b2tlbiBiYWxhbmNlIGFuZCBhbGxvd2FuY2UsCiAgICAgICAgLy8gdGhlbiBmaW5kIHRoZSBzbWFsbGVzdCBvcmRlciBvZiB0aGUgcmluZywgdGhlbiBjYWxjdWxhdGUgZWFjaCBvcmRlcidzCiAgICAgICAgLy8gYGZpbGxBbW91bnRTYC4KICAgICAgICBjYWxjdWxhdGVSaW5nRmlsbEFtb3VudChyaW5nU2l6ZSwgb3JkZXJzKTsKICAgICAgICBhZGRyZXNzIF9scmNUb2tlbkFkZHJlc3MgPSBscmNUb2tlbkFkZHJlc3M7CiAgICAgICAgLy8gQ2FsY3VsYXRlIGVhY2ggb3JkZXIncyBgbHJjRmVlYCBhbmQgYGxyY1Jld3JhcmRgIGFuZCBzcGxpY3QgaG93IG11Y2gKICAgICAgICAvLyBvZiBgZmlsbEFtb3VudFNgIHNoYWxsIGJlIHBhaWQgdG8gbWF0Y2hpbmcgb3JkZXIgb3IgbWluZXIgYXMgbWFyZ2luCiAgICAgICAgLy8gc3BsaXQuCiAgICAgICAgY2FsY3VsYXRlUmluZ0ZlZXMoCiAgICAgICAgICAgIGRlbGVnYXRlLAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgb3JkZXJzLAogICAgICAgICAgICBmZWVSZWNpcGllbnQsCiAgICAgICAgICAgIF9scmNUb2tlbkFkZHJlc3MKICAgICAgICApOwogICAgICAgIC8vLyBNYWtlIHBheW1lbnRzLgogICAgICAgIHNldHRsZVJpbmcoCiAgICAgICAgICAgIGRlbGVnYXRlLAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgb3JkZXJzLAogICAgICAgICAgICByaW5naGFzaCwKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICBfbHJjVG9rZW5BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBSaW5nTWluZWQoCiAgICAgICAgICAgIHJpbmdJbmRleCBeIEVOVEVSRURfTUFTSywKICAgICAgICAgICAgYmxvY2sudGltZXN0YW1wLAogICAgICAgICAgICBibG9jay5udW1iZXIsCiAgICAgICAgICAgIHJpbmdoYXNoLAogICAgICAgICAgICBtaW5lciwKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICBpc1JpbmdoYXNoUmVzZXJ2ZWQKICAgICAgICApOwogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlVHJhbnNmZXJCYXRjaCgKICAgICAgICB1aW50ICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIE9yZGVyU3RhdGVbXSAgb3JkZXJzCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMltdIGJhdGNoKQogICAgewogICAgICAgIGJhdGNoID0gbmV3IGJ5dGVzMzJbXShyaW5nU2l6ZSAqIDYpOyAvLyByaW5nU2l6ZSAqICh0b2tlblMgKyBvd25lcikgKyByaW5nU2l6ZSAqIDQgYW1vdW50cwogICAgICAgIAogICAgICAgIHVpbnQgcCA9IHJpbmdTaXplICogMjsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IG9yZGVyc1tpXTsKICAgICAgICAgICAgdmFyIHByZXYgPSBvcmRlcnNbKGkgKyByaW5nU2l6ZSAtIDEpICUgcmluZ1NpemVdOwoJCQkKICAgICAgICAgICAgLy8gU3RvcmUgdG9rZW5TIGFuZCBvd25lciBvZiBldmVyeSBvcmRlcgogICAgICAgICAgICBiYXRjaFtpXSA9IGJ5dGVzMzIoc3RhdGUub3JkZXIudG9rZW5TKTsKICAgICAgICAgICAgYmF0Y2hbcmluZ1NpemUgKyBpXSA9IGJ5dGVzMzIoc3RhdGUub3JkZXIub3duZXIpOwoJCSAgICAKICAgICAgICAgICAgLy8gU3RvcmUgYWxsIGFtb3VudHMKICAgICAgICAgICAgYmF0Y2hbcF0gPSBieXRlczMyKHN0YXRlLmZpbGxBbW91bnRTIC0gcHJldi5zcGxpdEIpOwogICAgICAgICAgICBiYXRjaFtwKzFdID0gYnl0ZXMzMihwcmV2LnNwbGl0QiArIHN0YXRlLnNwbGl0Uyk7CiAgICAgICAgICAgIGJhdGNoW3ArMl0gPSBieXRlczMyKHN0YXRlLmxyY1Jld2FyZCk7CiAgICAgICAgICAgIGJhdGNoW3ArM10gPSBieXRlczMyKHN0YXRlLmxyY0ZlZSk7CiAgICAgICAgICAgIHAgKz0gNDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhdGNoOwogICAgfQogICAgZnVuY3Rpb24gc2V0dGxlUmluZygKICAgICAgICBUb2tlblRyYW5zZmVyRGVsZWdhdGUgZGVsZWdhdGUsCiAgICAgICAgdWludCAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICBPcmRlclN0YXRlW10gIG9yZGVycywKICAgICAgICBieXRlczMyICAgICAgIHJpbmdoYXNoLAogICAgICAgIGFkZHJlc3MgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgIGFkZHJlc3MgICAgICAgX2xyY1Rva2VuQWRkcmVzcwogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBvcmRlcnNbaV07CiAgICAgICAgICAgIHZhciBwcmV2ID0gb3JkZXJzWyhpICsgcmluZ1NpemUgLSAxKSAlIHJpbmdTaXplXTsKICAgICAgICAgICAgdmFyIG5leHQgPSBvcmRlcnNbKGkgKyAxKSAlIHJpbmdTaXplXTsKICAgICAgICAgICAgLy8gVXBkYXRlIGZpbGwgcmVjb3JkcwogICAgICAgICAgICBpZiAoc3RhdGUub3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgICAgIGNhbmNlbGxlZE9yRmlsbGVkW3N0YXRlLm9yZGVySGFzaF0gKz0gbmV4dC5maWxsQW1vdW50UzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNhbmNlbGxlZE9yRmlsbGVkW3N0YXRlLm9yZGVySGFzaF0gKz0gc3RhdGUuZmlsbEFtb3VudFM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgT3JkZXJGaWxsZWQoCiAgICAgICAgICAgICAgICByaW5nSW5kZXggXiBFTlRFUkVEX01BU0ssCiAgICAgICAgICAgICAgICBibG9jay50aW1lc3RhbXAsCiAgICAgICAgICAgICAgICBibG9jay5udW1iZXIsCiAgICAgICAgICAgICAgICByaW5naGFzaCwKICAgICAgICAgICAgICAgIHByZXYub3JkZXJIYXNoLAogICAgICAgICAgICAgICAgc3RhdGUub3JkZXJIYXNoLAogICAgICAgICAgICAgICAgbmV4dC5vcmRlckhhc2gsCiAgICAgICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50UyArIHN0YXRlLnNwbGl0UywKICAgICAgICAgICAgICAgIG5leHQuZmlsbEFtb3VudFMgLSBzdGF0ZS5zcGxpdEIsCiAgICAgICAgICAgICAgICBzdGF0ZS5scmNSZXdhcmQsCiAgICAgICAgICAgICAgICBzdGF0ZS5scmNGZWUKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZGVsZWdhdGUuYmF0Y2hUcmFuc2ZlclRva2VuKHJpbmdTaXplLCBfbHJjVG9rZW5BZGRyZXNzLCBmZWVSZWNpcGllbnQsCiAgICAgICAgICAgIGNyZWF0ZVRyYW5zZmVyQmF0Y2goCiAgICAgICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgICAgIG9yZGVycwogICAgICAgICAgICApCiAgICAgICAgKTsKICAgIH0KICAgIC8vLyBAZGV2IFZlcmlmeSBtaW5lciBoYXMgY2FsY3VsdGUgdGhlIHJhdGVzIGNvcnJlY3RseS4KICAgIGZ1bmN0aW9uIHZlcmlmeU1pbmVyU3VwcGxpZWRGaWxsUmF0ZXMoCiAgICAgICAgdWludCAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICBPcmRlclN0YXRlW10gIG9yZGVycwogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgewogICAgICAgIHZhciByYXRlUmF0aW9zID0gbmV3IHVpbnRbXShyaW5nU2l6ZSk7CiAgICAgICAgdWludCBfcmF0ZVJhdGlvU2NhbGUgPSBSQVRFX1JBVElPX1NDQUxFOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgdWludCBzMWIwID0gb3JkZXJzW2ldLnJhdGUuYW1vdW50Uy5tdWwob3JkZXJzW2ldLm9yZGVyLmFtb3VudEIpOwogICAgICAgICAgICB1aW50IHMwYjEgPSBvcmRlcnNbaV0ub3JkZXIuYW1vdW50Uy5tdWwob3JkZXJzW2ldLnJhdGUuYW1vdW50Qik7CiAgICAgICAgICAgIHJlcXVpcmUoczFiMCA8PSBzMGIxKTsgLy8gIm1pbmVyIHN1cHBsaWVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXMgaW52YWxpZCBkaXNjb3VudCIpOwogICAgICAgICAgICByYXRlUmF0aW9zW2ldID0gX3JhdGVSYXRpb1NjYWxlLm11bChzMWIwKSAvIHMwYjE7CiAgICAgICAgfQogICAgICAgIHVpbnQgY3ZzID0gTWF0aFVpbnQuY3ZzcXVhcmUocmF0ZVJhdGlvcywgX3JhdGVSYXRpb1NjYWxlKTsKICAgICAgICByZXF1aXJlKGN2cyA8PSByYXRlUmF0aW9DVlNUaHJlc2hvbGQpOyAvLyAibWluZXIgc3VwcGxpZWQgZXhjaGFuZ2UgcmF0ZSBpcyBub3QgZXZlbmx5IGRpc2NvdW50ZWQiKTsKICAgIH0KICAgIC8vLyBAZGV2IENhbGN1bGF0ZSBlYWNoIG9yZGVyJ3MgZmVlIG9yIExSQyByZXdhcmQuCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSaW5nRmVlcygKICAgICAgICBUb2tlblRyYW5zZmVyRGVsZWdhdGUgZGVsZWdhdGUsCiAgICAgICAgdWludCAgICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIE9yZGVyU3RhdGVbXSAgICBvcmRlcnMsCiAgICAgICAgYWRkcmVzcyAgICAgICAgIGZlZVJlY2lwaWVudCwKICAgICAgICBhZGRyZXNzICAgICAgICAgX2xyY1Rva2VuQWRkcmVzcwogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgewogICAgICAgIHVpbnQgbWluZXJMcmNTcGVuZGFibGUgPSBnZXRTcGVuZGFibGUoCiAgICAgICAgICAgIGRlbGVnYXRlLAogICAgICAgICAgICBfbHJjVG9rZW5BZGRyZXNzLAogICAgICAgICAgICBmZWVSZWNpcGllbnQKICAgICAgICApOwogICAgICAgIHVpbnQ4IF9tYXJnaW5TcGxpdFBlcmNlbnRhZ2VCYXNlID0gTUFSR0lOX1NQTElUX1BFUkNFTlRBR0VfQkFTRTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IG9yZGVyc1tpXTsKICAgICAgICAgICAgdmFyIG5leHQgPSBvcmRlcnNbKGkgKyAxKSAlIHJpbmdTaXplXTsKICAgICAgICAgICAgdWludCBscmNTcGVuZGFibGUgPSBnZXRTcGVuZGFibGUoCiAgICAgICAgICAgICAgICBkZWxlZ2F0ZSwKICAgICAgICAgICAgICAgIF9scmNUb2tlbkFkZHJlc3MsCiAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5vd25lcgogICAgICAgICAgICApOwogICAgICAgICAgICAvLyBJZiBvcmRlciBkb2Vzbid0IGhhdmUgZW5vdWdoIExSQywgc2V0IG1hcmdpbiBzcGxpdCB0byAxMDAlLgogICAgICAgICAgICBpZiAobHJjU3BlbmRhYmxlIDwgc3RhdGUubHJjRmVlKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5scmNGZWUgPSBscmNTcGVuZGFibGU7CiAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5tYXJnaW5TcGxpdFBlcmNlbnRhZ2UgPSBfbWFyZ2luU3BsaXRQZXJjZW50YWdlQmFzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBXaGVuIGFuIG9yZGVyJ3MgTFJDIGZlZSBpcyAwIG9yIHNtYWxsZXIgdGhhbiB0aGUgc3BlY2lmaWVkIGZlZSwKICAgICAgICAgICAgLy8gd2UgaGVscCBtaW5lciBhdXRvbWF0aWNhbGx5IHNlbGVjdCBtYXJnaW4tc3BsaXQuCiAgICAgICAgICAgIGlmIChzdGF0ZS5scmNGZWUgPT0gMCkgewogICAgICAgICAgICAgICAgc3RhdGUub3JkZXIubWFyZ2luU3BsaXRQZXJjZW50YWdlID0gX21hcmdpblNwbGl0UGVyY2VudGFnZUJhc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmZlZVNlbGVjdGlvbiA9PSBGRUVfU0VMRUNUX01BUkdJTl9TUExJVCB8fCBzdGF0ZS5scmNGZWUgPT0gMCkgewogICAgICAgICAgICAgICAgLy8gT25seSBjYWxjdWxhdGUgc3BsaXQgd2hlbiBtaW5lciBoYXMgZW5vdWdoIExSQzsKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBhbGwgc3BsaXRzIGFyZSAwLgogICAgICAgICAgICAgICAgaWYgKG1pbmVyTHJjU3BlbmRhYmxlID49IHN0YXRlLmxyY0ZlZSkgewogICAgICAgICAgICAgICAgICAgIHVpbnQgc3BsaXQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm9yZGVyLmJ1eU5vTW9yZVRoYW5BbW91bnRCKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0ID0gKG5leHQuZmlsbEFtb3VudFMubXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIuYW1vdW50UwogICAgICAgICAgICAgICAgICAgICAgICApIC8gc3RhdGUub3JkZXIuYW1vdW50Qikuc3ViKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzcGxpdCA9IG5leHQuZmlsbEFtb3VudFMuc3ViKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMubXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLmFtb3VudEIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgLyBzdGF0ZS5vcmRlci5hbW91bnRTCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5vcmRlci5tYXJnaW5TcGxpdFBlcmNlbnRhZ2UgIT0gX21hcmdpblNwbGl0UGVyY2VudGFnZUJhc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXQgPSBzcGxpdC5tdWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5tYXJnaW5TcGxpdFBlcmNlbnRhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgKSAvIF9tYXJnaW5TcGxpdFBlcmNlbnRhZ2VCYXNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUub3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3BsaXRTID0gc3BsaXQ7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3BsaXRCID0gc3BsaXQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaW1wbGljaXRzIG9yZGVyIHdpdGggc21hbGxlciBpbmRleCBpbiB0aGUgcmluZyB3aWxsCiAgICAgICAgICAgICAgICAgICAgLy8gYmUgcGFpZCBMUkMgcmV3YXJkIGZpcnN0LCBzbyB0aGUgb3JkZXJzIGluIHRoZSByaW5nIGRvZXMKICAgICAgICAgICAgICAgICAgICAvLyBtYXRlci4KICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbmVyTHJjU3BlbmRhYmxlID0gbWluZXJMcmNTcGVuZGFibGUuc3ViKHN0YXRlLmxyY0ZlZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY1Jld2FyZCA9IHN0YXRlLmxyY0ZlZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5mZWVTZWxlY3Rpb24gPT0gRkVFX1NFTEVDVF9MUkMpIHsKICAgICAgICAgICAgICAgIG1pbmVyTHJjU3BlbmRhYmxlICs9IHN0YXRlLmxyY0ZlZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOyAvLyAidW5zdXBwb3J0ZWQgZmVlIHNlbGVjdGlvbiB2YWx1ZSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIGVhY2ggb3JkZXIncyBmaWxsIGFtb3VudC4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJpbmdGaWxsQW1vdW50KAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgT3JkZXJTdGF0ZVtdICBvcmRlcnMKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUgCiAgICB7CiAgICAgICAgdWludCBzbWFsbGVzdElkeCA9IDA7CiAgICAgICAgdWludCBpOwogICAgICAgIHVpbnQgajsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICBqID0gKGkgKyAxKSAlIHJpbmdTaXplOwogICAgICAgICAgICBzbWFsbGVzdElkeCA9IGNhbGN1bGF0ZU9yZGVyRmlsbEFtb3VudCgKICAgICAgICAgICAgICAgIG9yZGVyc1tpXSwKICAgICAgICAgICAgICAgIG9yZGVyc1tqXSwKICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICBqLAogICAgICAgICAgICAgICAgc21hbGxlc3RJZHgKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHNtYWxsZXN0SWR4OyBpKyspIHsKICAgICAgICAgICAgY2FsY3VsYXRlT3JkZXJGaWxsQW1vdW50KAogICAgICAgICAgICAgICAgb3JkZXJzW2ldLAogICAgICAgICAgICAgICAgb3JkZXJzWyhpICsgMSkgJSByaW5nU2l6ZV0sCiAgICAgICAgICAgICAgICAwLCAgICAgICAgICAgICAgIC8vIE5vdCBuZWVkZWQKICAgICAgICAgICAgICAgIDAsICAgICAgICAgICAgICAgLy8gTm90IG5lZWRlZAogICAgICAgICAgICAgICAgMCAgICAgICAgICAgICAgICAvLyBOb3QgbmVlZGVkCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEByZXR1cm4gVGhlIHNtYWxsZXN0IG9yZGVyJ3MgaW5kZXguCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVPcmRlckZpbGxBbW91bnQoCiAgICAgICAgT3JkZXJTdGF0ZSAgICAgICAgc3RhdGUsCiAgICAgICAgT3JkZXJTdGF0ZSAgICAgICAgbmV4dCwKICAgICAgICB1aW50ICAgICAgICAgICAgICBpLAogICAgICAgIHVpbnQgICAgICAgICAgICAgIGosCiAgICAgICAgdWludCAgICAgICAgICAgICAgc21hbGxlc3RJZHgKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50IG5ld1NtYWxsZXN0SWR4KQogICAgewogICAgICAgIC8vIERlZmF1bHQgdG8gdGhlIHNhbWUgc21hbGxlc3QgaW5kZXgKICAgICAgICBuZXdTbWFsbGVzdElkeCA9IHNtYWxsZXN0SWR4OwogICAgICAgIHVpbnQgZmlsbEFtb3VudEIgPSBzdGF0ZS5maWxsQW1vdW50Uy5tdWwoCiAgICAgICAgICAgIHN0YXRlLnJhdGUuYW1vdW50QgogICAgICAgICkgLyBzdGF0ZS5yYXRlLmFtb3VudFM7CiAgICAgICAgaWYgKHN0YXRlLm9yZGVyLmJ1eU5vTW9yZVRoYW5BbW91bnRCKSB7CiAgICAgICAgICAgIGlmIChmaWxsQW1vdW50QiA+IHN0YXRlLm9yZGVyLmFtb3VudEIpIHsKICAgICAgICAgICAgICAgIGZpbGxBbW91bnRCID0gc3RhdGUub3JkZXIuYW1vdW50QjsKICAgICAgICAgICAgICAgIHN0YXRlLmZpbGxBbW91bnRTID0gZmlsbEFtb3VudEIubXVsKAogICAgICAgICAgICAgICAgICAgIHN0YXRlLnJhdGUuYW1vdW50UwogICAgICAgICAgICAgICAgKSAvIHN0YXRlLnJhdGUuYW1vdW50QjsKICAgICAgICAgICAgICAgIG5ld1NtYWxsZXN0SWR4ID0gaTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGF0ZS5scmNGZWUgPSBzdGF0ZS5vcmRlci5scmNGZWUubXVsKAogICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50UwogICAgICAgICkgLyBzdGF0ZS5vcmRlci5hbW91bnRTOwogICAgICAgIGlmIChmaWxsQW1vdW50QiA8PSBuZXh0LmZpbGxBbW91bnRTKSB7CiAgICAgICAgICAgIG5leHQuZmlsbEFtb3VudFMgPSBmaWxsQW1vdW50QjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdTbWFsbGVzdElkeCA9IGo7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgU2NhbGUgZG93biBhbGwgb3JkZXJzIGJhc2VkIG9uIGhpc3RvcmljYWwgZmlsbCBvciBjYW5jZWxsYXRpb24KICAgIC8vLyAgICAgIHN0YXRzIGJ1dCBrZXkgdGhlIG9yZGVyJ3Mgb3JpZ2luYWwgZXhjaGFuZ2UgcmF0ZS4KICAgIGZ1bmN0aW9uIHNjYWxlUmluZ0Jhc2VkT25IaXN0b3JpY2FsUmVjb3JkcygKICAgICAgICB1aW50ICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIE9yZGVyU3RhdGVbXSAgb3JkZXJzCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBvcmRlcnNbaV07CiAgICAgICAgICAgIHZhciBvcmRlciA9IHN0YXRlLm9yZGVyOwogICAgICAgICAgICB1aW50IGFtb3VudDsKICAgICAgICAgICAgaWYgKG9yZGVyLmJ1eU5vTW9yZVRoYW5BbW91bnRCKSB7CiAgICAgICAgICAgICAgICBhbW91bnQgPSBvcmRlci5hbW91bnRCLnRvbGVyYW50U3ViKAogICAgICAgICAgICAgICAgICAgIGNhbmNlbGxlZE9yRmlsbGVkW3N0YXRlLm9yZGVySGFzaF0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBvcmRlci5hbW91bnRTID0gYW1vdW50Lm11bChvcmRlci5hbW91bnRTKSAvIG9yZGVyLmFtb3VudEI7CiAgICAgICAgICAgICAgICBvcmRlci5scmNGZWUgPSBhbW91bnQubXVsKG9yZGVyLmxyY0ZlZSkgLyBvcmRlci5hbW91bnRCOwogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50QiA9IGFtb3VudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFtb3VudCA9IG9yZGVyLmFtb3VudFMudG9sZXJhbnRTdWIoCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkT3JGaWxsZWRbc3RhdGUub3JkZXJIYXNoXQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudEIgPSBhbW91bnQubXVsKG9yZGVyLmFtb3VudEIpIC8gb3JkZXIuYW1vdW50UzsKICAgICAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSA9IGFtb3VudC5tdWwob3JkZXIubHJjRmVlKSAvIG9yZGVyLmFtb3VudFM7CiAgICAgICAgICAgICAgICBvcmRlci5hbW91bnRTID0gYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcXVpcmUob3JkZXIuYW1vdW50UyA+IDApOyAvLyAiYW1vdW50UyBpcyB6ZXJvIik7CiAgICAgICAgICAgIHJlcXVpcmUob3JkZXIuYW1vdW50QiA+IDApOyAvLyAiYW1vdW50QiBpcyB6ZXJvIik7CiAgICAgICAgICAgIHN0YXRlLmZpbGxBbW91bnRTID0gKAogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50UyA8IHN0YXRlLmF2YWlsYWJsZUFtb3VudFMgPwogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50UyA6IHN0YXRlLmF2YWlsYWJsZUFtb3VudFMKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgRVJDMjAgdG9rZW4gdGhhdCBjYW4gYmUgc3BlbnQgYnkgdGhpcyBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGdldFNwZW5kYWJsZSgKICAgICAgICBUb2tlblRyYW5zZmVyRGVsZWdhdGUgZGVsZWdhdGUsCiAgICAgICAgYWRkcmVzcyB0b2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyB0b2tlbk93bmVyCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICB2YXIgdG9rZW4gPSBFUkMyMCh0b2tlbkFkZHJlc3MpOwogICAgICAgIHVpbnQgYWxsb3dhbmNlID0gdG9rZW4uYWxsb3dhbmNlKAogICAgICAgICAgICB0b2tlbk93bmVyLAogICAgICAgICAgICBhZGRyZXNzKGRlbGVnYXRlKQogICAgICAgICk7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRva2VuT3duZXIpOwogICAgICAgIHJldHVybiAoYWxsb3dhbmNlIDwgYmFsYW5jZSA/IGFsbG93YW5jZSA6IGJhbGFuY2UpOwogICAgfQogICAgLy8vIEBkZXYgdmVyaWZ5IGlucHV0IGRhdGEncyBiYXNpYyBpbnRlZ3JpdHkuCiAgICBmdW5jdGlvbiB2ZXJpZnlJbnB1dERhdGFJbnRlZ3JpdHkoCiAgICAgICAgdWludCAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICBhZGRyZXNzWzJdW10gIGFkZHJlc3NMaXN0LAogICAgICAgIHVpbnRbN11bXSAgICAgdWludEFyZ3NMaXN0LAogICAgICAgIHVpbnQ4WzJdW10gICAgdWludDhBcmdzTGlzdCwKICAgICAgICBib29sW10gICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICB1aW50OFtdICAgICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICBzTGlzdAogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgcHVyZQogICAgewogICAgICAgIHJlcXVpcmUocmluZ1NpemUgPT0gYWRkcmVzc0xpc3QubGVuZ3RoKTsgLy8gInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSBhZGRyZXNzTGlzdCIpOwogICAgICAgIHJlcXVpcmUocmluZ1NpemUgPT0gdWludEFyZ3NMaXN0Lmxlbmd0aCk7IC8vICJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gdWludEFyZ3NMaXN0Iik7CiAgICAgICAgcmVxdWlyZShyaW5nU2l6ZSA9PSB1aW50OEFyZ3NMaXN0Lmxlbmd0aCk7IC8vICJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gdWludDhBcmdzTGlzdCIpOwogICAgICAgIHJlcXVpcmUocmluZ1NpemUgPT0gYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0Lmxlbmd0aCk7IC8vICJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0Iik7CiAgICAgICAgcmVxdWlyZShyaW5nU2l6ZSArIDEgPT0gdkxpc3QubGVuZ3RoKTsgLy8gInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSB2TGlzdCIpOwogICAgICAgIHJlcXVpcmUocmluZ1NpemUgKyAxID09IHJMaXN0Lmxlbmd0aCk7IC8vICJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gckxpc3QiKTsKICAgICAgICByZXF1aXJlKHJpbmdTaXplICsgMSA9PSBzTGlzdC5sZW5ndGgpOyAvLyAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHNMaXN0Iik7CiAgICAgICAgLy8gVmFsaWRhdGUgcmluZy1taW5pbmcgcmVsYXRlZCBhcmd1bWVudHMuCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICByZXF1aXJlKHVpbnRBcmdzTGlzdFtpXVs2XSA+IDApOyAvLyAib3JkZXIgcmF0ZUFtb3VudFMgaXMgemVybyIpOwogICAgICAgICAgICByZXF1aXJlKHVpbnQ4QXJnc0xpc3RbaV1bMV0gPD0gRkVFX1NFTEVDVF9NQVhfVkFMVUUpOyAvLyAiaW52YWxpZCBvcmRlciBmZWUgc2VsZWN0aW9uIik7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgICAgICAgIGFzc21ibGUgb3JkZXIgcGFyYW1ldGVycyBpbnRvIE9yZGVyIHN0cnVjdC4KICAgIC8vLyBAcmV0dXJuICAgICBBIGxpc3Qgb2Ygb3JkZXJzLgogICAgZnVuY3Rpb24gYXNzZW1ibGVPcmRlcnMoCiAgICAgICAgVG9rZW5UcmFuc2ZlckRlbGVnYXRlIGRlbGVnYXRlLAogICAgICAgIGFkZHJlc3NbMl1bXSAgICBhZGRyZXNzTGlzdCwKICAgICAgICB1aW50WzddW10gICAgICAgdWludEFyZ3NMaXN0LAogICAgICAgIHVpbnQ4WzJdW10gICAgICB1aW50OEFyZ3NMaXN0LAogICAgICAgIGJvb2xbXSAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgdWludDhbXSAgICAgICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICByTGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgc0xpc3QKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChPcmRlclN0YXRlW10gb3JkZXJzKQogICAgewogICAgICAgIHVpbnQgcmluZ1NpemUgPSBhZGRyZXNzTGlzdC5sZW5ndGg7CiAgICAgICAgb3JkZXJzID0gbmV3IE9yZGVyU3RhdGVbXShyaW5nU2l6ZSk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB2YXIgb3JkZXIgPSBPcmRlcigKICAgICAgICAgICAgICAgIGFkZHJlc3NMaXN0W2ldWzBdLAogICAgICAgICAgICAgICAgYWRkcmVzc0xpc3RbaV1bMV0sCiAgICAgICAgICAgICAgICBhZGRyZXNzTGlzdFsoaSArIDEpICUgcmluZ1NpemVdWzFdLAogICAgICAgICAgICAgICAgdWludEFyZ3NMaXN0W2ldWzBdLAogICAgICAgICAgICAgICAgdWludEFyZ3NMaXN0W2ldWzFdLAogICAgICAgICAgICAgICAgdWludEFyZ3NMaXN0W2ldWzVdLAogICAgICAgICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0W2ldLAogICAgICAgICAgICAgICAgdWludDhBcmdzTGlzdFtpXVswXQogICAgICAgICAgICApOwogICAgICAgICAgICBieXRlczMyIG9yZGVySGFzaCA9IGNhbGN1bGF0ZU9yZGVySGFzaCgKICAgICAgICAgICAgICAgIG9yZGVyLAogICAgICAgICAgICAgICAgdWludEFyZ3NMaXN0W2ldWzJdLCAvLyB0aW1lc3RhbXAKICAgICAgICAgICAgICAgIHVpbnRBcmdzTGlzdFtpXVszXSwgLy8gdHRsCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bNF0gIC8vIHNhbHQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKAogICAgICAgICAgICAgICAgb3JkZXIub3duZXIsCiAgICAgICAgICAgICAgICBvcmRlckhhc2gsCiAgICAgICAgICAgICAgICB2TGlzdFtpXSwKICAgICAgICAgICAgICAgIHJMaXN0W2ldLAogICAgICAgICAgICAgICAgc0xpc3RbaV0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgdmFsaWRhdGVPcmRlcigKICAgICAgICAgICAgICAgIG9yZGVyLAogICAgICAgICAgICAgICAgdWludEFyZ3NMaXN0W2ldWzJdLCAvLyB0aW1lc3RhbXAKICAgICAgICAgICAgICAgIHVpbnRBcmdzTGlzdFtpXVszXSwgLy8gdHRsCiAgICAgICAgICAgICAgICB1aW50QXJnc0xpc3RbaV1bNF0gIC8vIHNhbHQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgb3JkZXJzW2ldID0gT3JkZXJTdGF0ZSgKICAgICAgICAgICAgICAgIG9yZGVyLAogICAgICAgICAgICAgICAgb3JkZXJIYXNoLAogICAgICAgICAgICAgICAgdWludDhBcmdzTGlzdFtpXVsxXSwgIC8vIGZlZVNlbGVjdGlvbgogICAgICAgICAgICAgICAgUmF0ZSh1aW50QXJnc0xpc3RbaV1bNl0sIG9yZGVyLmFtb3VudEIpLAogICAgICAgICAgICAgICAgZ2V0U3BlbmRhYmxlKGRlbGVnYXRlLCBvcmRlci50b2tlblMsIG9yZGVyLm93bmVyKSwKICAgICAgICAgICAgICAgIDAsICAgLy8gZmlsbEFtb3VudFMKICAgICAgICAgICAgICAgIDAsICAgLy8gbHJjUmV3YXJkCiAgICAgICAgICAgICAgICAwLCAgIC8vIGxyY0ZlZQogICAgICAgICAgICAgICAgMCwgICAvLyBzcGxpdFMKICAgICAgICAgICAgICAgIDAgICAgLy8gc3BsaXRCCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJlcXVpcmUob3JkZXJzW2ldLmF2YWlsYWJsZUFtb3VudFMgPiAwKTsgLy8gIm9yZGVyIHNwZW5kYWJsZSBhbW91bnRTIGlzIHplcm8iKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQGRldiB2YWxpZGF0ZSBvcmRlcidzIHBhcmFtZXRlcnMgYXJlIE9LLgogICAgZnVuY3Rpb24gdmFsaWRhdGVPcmRlcigKICAgICAgICBPcmRlciAgICAgICAgb3JkZXIsCiAgICAgICAgdWludCAgICAgICAgIHRpbWVzdGFtcCwKICAgICAgICB1aW50ICAgICAgICAgdHRsLAogICAgICAgIHVpbnQgICAgICAgICBzYWx0CiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICB7CiAgICAgICAgcmVxdWlyZShvcmRlci5vd25lciAhPSBhZGRyZXNzKDApKTsgLy8gImludmFsaWQgb3JkZXIgb3duZXIiKTsKICAgICAgICByZXF1aXJlKG9yZGVyLnRva2VuUyAhPSBhZGRyZXNzKDApKTsgLy8gImludmFsaWQgb3JkZXIgdG9rZW5TIik7CiAgICAgICAgcmVxdWlyZShvcmRlci50b2tlbkIgIT0gYWRkcmVzcygwKSk7IC8vICJpbnZhbGlkIG9yZGVyIHRva2VuQiIpOwogICAgICAgIHJlcXVpcmUob3JkZXIuYW1vdW50UyAhPSAwKTsgLy8gImludmFsaWQgb3JkZXIgYW1vdW50UyIpOwogICAgICAgIHJlcXVpcmUob3JkZXIuYW1vdW50QiAhPSAwKTsgLy8gImludmFsaWQgb3JkZXIgYW1vdW50QiIpOwogICAgICAgIHJlcXVpcmUodGltZXN0YW1wIDw9IGJsb2NrLnRpbWVzdGFtcCk7IC8vICJvcmRlciBpcyB0b28gZWFybHkgdG8gbWF0Y2giKTsKICAgICAgICByZXF1aXJlKHRpbWVzdGFtcCA+IGN1dG9mZnNbb3JkZXIub3duZXJdKTsgLy8gIm9yZGVyIGlzIGN1dCBvZmYiKTsKICAgICAgICByZXF1aXJlKHR0bCAhPSAwKTsgLy8gIm9yZGVyIHR0bCBpcyAwIik7CiAgICAgICAgcmVxdWlyZSh0aW1lc3RhbXAgKyB0dGwgPiBibG9jay50aW1lc3RhbXApOyAvLyAib3JkZXIgaXMgZXhwaXJlZCIpOwogICAgICAgIHJlcXVpcmUoc2FsdCAhPSAwKTsgLy8gImludmFsaWQgb3JkZXIgc2FsdCIpOwogICAgICAgIHJlcXVpcmUob3JkZXIubWFyZ2luU3BsaXRQZXJjZW50YWdlIDw9IE1BUkdJTl9TUExJVF9QRVJDRU5UQUdFX0JBU0UpOyAvLyAiaW52YWxpZCBvcmRlciBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UiKTsKICAgIH0KICAgIC8vLyBAZGV2IEdldCB0aGUgS2VjY2FrLTI1NiBoYXNoIG9mIG9yZGVyIHdpdGggc3BlY2lmaWVkIHBhcmFtZXRlcnMuCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVPcmRlckhhc2goCiAgICAgICAgT3JkZXIgICAgICAgIG9yZGVyLAogICAgICAgIHVpbnQgICAgICAgICB0aW1lc3RhbXAsCiAgICAgICAgdWludCAgICAgICAgIHR0bCwKICAgICAgICB1aW50ICAgICAgICAgc2FsdAogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJ5dGVzMzIpCiAgICB7CiAgICAgICAgcmV0dXJuIGtlY2NhazI1NigKICAgICAgICAgICAgYWRkcmVzcyh0aGlzKSwKICAgICAgICAgICAgb3JkZXIub3duZXIsCiAgICAgICAgICAgIG9yZGVyLnRva2VuUywKICAgICAgICAgICAgb3JkZXIudG9rZW5CLAogICAgICAgICAgICBvcmRlci5hbW91bnRTLAogICAgICAgICAgICBvcmRlci5hbW91bnRCLAogICAgICAgICAgICB0aW1lc3RhbXAsCiAgICAgICAgICAgIHR0bCwKICAgICAgICAgICAgc2FsdCwKICAgICAgICAgICAgb3JkZXIubHJjRmVlLAogICAgICAgICAgICBvcmRlci5idXlOb01vcmVUaGFuQW1vdW50QiwKICAgICAgICAgICAgb3JkZXIubWFyZ2luU3BsaXRQZXJjZW50YWdlCiAgICAgICAgKTsKICAgIH0KICAgIC8vLyBAZGV2IFZlcmlmeSBzaWduZXIncyBzaWduYXR1cmUuCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWduYXR1cmUoCiAgICAgICAgYWRkcmVzcyBzaWduZXIsCiAgICAgICAgYnl0ZXMzMiBoYXNoLAogICAgICAgIHVpbnQ4ICAgdiwKICAgICAgICBieXRlczMyIHIsCiAgICAgICAgYnl0ZXMzMiBzCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICBwdXJlCiAgICB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgc2lnbmVyID09IGVjcmVjb3ZlcigKICAgICAgICAgICAgICAgIGtlY2NhazI1NigiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiLCBoYXNoKSwKICAgICAgICAgICAgICAgIHYsCiAgICAgICAgICAgICAgICByLAogICAgICAgICAgICAgICAgcwogICAgICAgICAgICApCiAgICAgICAgKTsgLy8gImludmFsaWQgc2lnbmF0dXJlIik7CiAgICB9Cn0='.
	

]
