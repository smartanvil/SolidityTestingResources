Class {
	#name : #SRT737ac585809c0f64ee09d7b8050d195d14f14c55,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT737ac585809c0f64ee09d7b8050d195d14f14c55 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoKICAgIEJhbmNvciBDb252ZXJ0ZXIgRXh0ZW5zaW9ucyBpbnRlcmZhY2UKKi8KY29udHJhY3QgSUJhbmNvckNvbnZlcnRlckV4dGVuc2lvbnMgewogICAgZnVuY3Rpb24gZm9ybXVsYSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKElCYW5jb3JGb3JtdWxhKSB7fQogICAgZnVuY3Rpb24gZ2FzUHJpY2VMaW1pdCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKElCYW5jb3JHYXNQcmljZUxpbWl0KSB7fQogICAgZnVuY3Rpb24gcXVpY2tDb252ZXJ0ZXIoKSBwdWJsaWMgdmlldyByZXR1cm5zIChJQmFuY29yUXVpY2tDb252ZXJ0ZXIpIHt9Cn0KCgpjb250cmFjdCBJQmFuY29yRm9ybXVsYSB7CiAgICBmdW5jdGlvbiBjYWxjdWxhdGVQdXJjaGFzZVJldHVybih1aW50MjU2IF9zdXBwbHksIHVpbnQyNTYgX2Nvbm5lY3RvckJhbGFuY2UsIHVpbnQzMiBfY29ubmVjdG9yV2VpZ2h0LCB1aW50MjU2IF9kZXBvc2l0QW1vdW50KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVNhbGVSZXR1cm4odWludDI1NiBfc3VwcGx5LCB1aW50MjU2IF9jb25uZWN0b3JCYWxhbmNlLCB1aW50MzIgX2Nvbm5lY3RvcldlaWdodCwgdWludDI1NiBfc2VsbEFtb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7Cn0KCgpjb250cmFjdCBJQmFuY29yR2FzUHJpY2VMaW1pdCB7CiAgICBmdW5jdGlvbiBnYXNQcmljZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHt9Cn0KCgpjb250cmFjdCBJQmFuY29yUXVpY2tDb252ZXJ0ZXIgewogICAgZnVuY3Rpb24gY29udmVydChJRVJDMjBUb2tlbltdIF9wYXRoLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBjb252ZXJ0Rm9yKElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuLCBhZGRyZXNzIF9mb3IpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQyNTYpOwp9CgoKY29udHJhY3QgSUVSQzIwVG9rZW4gewogICAgLy8gdGhlc2UgZnVuY3Rpb25zIGFyZW4ndCBhYnN0cmFjdCBzaW5jZSB0aGUgY29tcGlsZXIgZW1pdHMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgZ2V0dGVyIGZ1bmN0aW9ucyBhcyBleHRlcm5hbAogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykge30KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykge30KICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHt9CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHt9CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgX293bmVyOyB9CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgX293bmVyOyBfc3BlbmRlcjsgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwp9CgoKY29udHJhY3QgSU93bmVkIHsKICAgIC8vIHRoaXMgZnVuY3Rpb24gaXNuJ3QgYWJzdHJhY3Qgc2luY2UgdGhlIGNvbXBpbGVyIGVtaXRzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGdldHRlciBmdW5jdGlvbnMgYXMgZXh0ZXJuYWwKICAgIGZ1bmN0aW9uIG93bmVyKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykge30KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljOwogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgcHVibGljOwp9CgoKY29udHJhY3QgSVRva2VuSG9sZGVyIGlzIElPd25lZCB7CiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKfQoKCmNvbnRyYWN0IElFdGhlclRva2VuIGlzIElUb2tlbkhvbGRlciwgSUVSQzIwVG9rZW4gewogICAgZnVuY3Rpb24gZGVwb3NpdCgpIHB1YmxpYyBwYXlhYmxlOwogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludDI1NiBfYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiB3aXRoZHJhd1RvKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKfQoKCgpjb250cmFjdCBJU21hcnRUb2tlbiBpcyBJT3duZWQsIElFUkMyMFRva2VuIHsKICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcnMoYm9vbCBfZGlzYWJsZSkgcHVibGljOwogICAgZnVuY3Rpb24gaXNzdWUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwogICAgZnVuY3Rpb24gZGVzdHJveShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKfQoKCmNvbnRyYWN0IElUb2tlbkNvbnZlcnRlciB7CiAgICBmdW5jdGlvbiBjb252ZXJ0aWJsZVRva2VuQ291bnQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MTYpOwogICAgZnVuY3Rpb24gY29udmVydGlibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gZ2V0UmV0dXJuKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gY29udmVydChJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKICAgIC8vIGRlcHJlY2F0ZWQsIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkKICAgIGZ1bmN0aW9uIGNoYW5nZShJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKfQoKCmNvbnRyYWN0IE93bmVkIGlzIElPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICAgIGV2ZW50IE93bmVyVXBkYXRlKGFkZHJlc3MgaW5kZXhlZCBfcHJldk93bmVyLCBhZGRyZXNzIGluZGV4ZWQgX25ld093bmVyKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gT3duZWQoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLyBhbGxvd3MgZXhlY3V0aW9uIGJ5IHRoZSBvd25lciBvbmx5CiAgICBtb2RpZmllciBvd25lck9ubHkgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYWxsb3dzIHRyYW5zZmVycmluZyB0aGUgY29udHJhY3Qgb3duZXJzaGlwCiAgICAgICAgdGhlIG5ldyBvd25lciBzdGlsbCBuZWVkcyB0byBhY2NlcHQgdGhlIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgoKICAgICAgICBAcGFyYW0gX25ld093bmVyICAgIG5ldyBjb250cmFjdCBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSBvd25lcik7CiAgICAgICAgbmV3T3duZXIgPSBfbmV3T3duZXI7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1c2VkIGJ5IGEgbmV3IG93bmVyIHRvIGFjY2VwdCBhbiBvd25lcnNoaXAgdHJhbnNmZXIKICAgICovCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuZXdPd25lcik7CiAgICAgICAgT3duZXJVcGRhdGUob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgICAgIG5ld093bmVyID0gYWRkcmVzcygwKTsKICAgIH0KfQoKCgpjb250cmFjdCBVdGlscyB7CiAgICAvKioKICAgICAgICBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIFV0aWxzKCkgcHVibGljIHsKICAgIH0KCiAgICAvLyB2ZXJpZmllcyB0aGF0IGFuIGFtb3VudCBpcyBncmVhdGVyIHRoYW4gemVybwogICAgbW9kaWZpZXIgZ3JlYXRlclRoYW5aZXJvKHVpbnQyNTYgX2Ftb3VudCkgewogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA+IDApOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGFuIGFkZHJlc3MgLSBjdXJyZW50bHkgb25seSBjaGVja3MgdGhhdCBpdCBpc24ndCBudWxsCiAgICBtb2RpZmllciB2YWxpZEFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2ZXJpZmllcyB0aGF0IHRoZSBhZGRyZXNzIGlzIGRpZmZlcmVudCB0aGFuIHRoaXMgY29udHJhY3QgYWRkcmVzcwogICAgbW9kaWZpZXIgbm90VGhpcyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIE92ZXJmbG93IHByb3RlY3RlZCBtYXRoIGZ1bmN0aW9ucwoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgc3VtIG9mIF94IGFuZCBfeSwgYXNzZXJ0cyBpZiB0aGUgY2FsY3VsYXRpb24gb3ZlcmZsb3dzCgogICAgICAgIEBwYXJhbSBfeCAgIHZhbHVlIDEKICAgICAgICBAcGFyYW0gX3kgICB2YWx1ZSAyCgogICAgICAgIEByZXR1cm4gc3VtCiAgICAqLwogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHogPSBfeCArIF95OwogICAgICAgIGFzc2VydCh6ID49IF94KTsKICAgICAgICByZXR1cm4gejsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGRpZmZlcmVuY2Ugb2YgX3ggbWludXMgX3ksIGFzc2VydHMgaWYgdGhlIHN1YnRyYWN0aW9uIHJlc3VsdHMgaW4gYSBuZWdhdGl2ZSBudW1iZXIKCiAgICAgICAgQHBhcmFtIF94ICAgbWludWVuZAogICAgICAgIEBwYXJhbSBfeSAgIHN1YnRyYWhlbmQKCiAgICAgICAgQHJldHVybiBkaWZmZXJlbmNlCiAgICAqLwogICAgZnVuY3Rpb24gc2FmZVN1Yih1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoX3ggPj0gX3kpOwogICAgICAgIHJldHVybiBfeCAtIF95OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgcHJvZHVjdCBvZiBtdWx0aXBseWluZyBfeCBieSBfeSwgYXNzZXJ0cyBpZiB0aGUgY2FsY3VsYXRpb24gb3ZlcmZsb3dzCgogICAgICAgIEBwYXJhbSBfeCAgIGZhY3RvciAxCiAgICAgICAgQHBhcmFtIF95ICAgZmFjdG9yIDIKCiAgICAgICAgQHJldHVybiBwcm9kdWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHogPSBfeCAqIF95OwogICAgICAgIGFzc2VydChfeCA9PSAwIHx8IHogLyBfeCA9PSBfeSk7CiAgICAgICAgcmV0dXJuIHo7CiAgICB9Cn0KCgpjb250cmFjdCBUb2tlbkhvbGRlciBpcyBJVG9rZW5Ib2xkZXIsIE93bmVkLCBVdGlscyB7CiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gVG9rZW5Ib2xkZXIoKSBwdWJsaWMgewogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgd2l0aGRyYXdzIHRva2VucyBoZWxkIGJ5IHRoZSBjb250cmFjdCBhbmQgc2VuZHMgdGhlbSB0byBhbiBhY2NvdW50CiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lcgoKICAgICAgICBAcGFyYW0gX3Rva2VuICAgRVJDMjAgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdG8gICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgYW1vdW50IHRvIHdpdGhkcmF3CiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoSUVSQzIwVG9rZW4gX3Rva2VuLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykKICAgICAgICBub3RUaGlzKF90bykKICAgIHsKICAgICAgICBhc3NlcnQoX3Rva2VuLnRyYW5zZmVyKF90bywgX2Ftb3VudCkpOwogICAgfQp9CgoKY29udHJhY3QgU21hcnRUb2tlbkNvbnRyb2xsZXIgaXMgVG9rZW5Ib2xkZXIgewogICAgSVNtYXJ0VG9rZW4gcHVibGljIHRva2VuOyAgIC8vIHNtYXJ0IHRva2VuCgogICAgLyoqCiAgICAgICAgQGRldiBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIFNtYXJ0VG9rZW5Db250cm9sbGVyKElTbWFydFRva2VuIF90b2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgewogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgfQoKICAgIC8vIGVuc3VyZXMgdGhhdCB0aGUgY29udHJvbGxlciBpcyB0aGUgdG9rZW4ncyBvd25lcgogICAgbW9kaWZpZXIgYWN0aXZlKCkgewogICAgICAgIGFzc2VydCh0b2tlbi5vd25lcigpID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gZW5zdXJlcyB0aGF0IHRoZSBjb250cm9sbGVyIGlzIG5vdCB0aGUgdG9rZW4ncyBvd25lcgogICAgbW9kaWZpZXIgaW5hY3RpdmUoKSB7CiAgICAgICAgYXNzZXJ0KHRva2VuLm93bmVyKCkgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGFsbG93cyB0cmFuc2ZlcnJpbmcgdGhlIHRva2VuIG93bmVyc2hpcAogICAgICAgIHRoZSBuZXcgb3duZXIgc3RpbGwgbmVlZCB0byBhY2NlcHQgdGhlIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgoKICAgICAgICBAcGFyYW0gX25ld093bmVyICAgIG5ldyB0b2tlbiBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW5Pd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHRva2VuLnRyYW5zZmVyT3duZXJzaGlwKF9uZXdPd25lcik7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1c2VkIGJ5IGEgbmV3IG93bmVyIHRvIGFjY2VwdCBhIHRva2VuIG93bmVyc2hpcCB0cmFuc2ZlcgogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKICAgICovCiAgICBmdW5jdGlvbiBhY2NlcHRUb2tlbk93bmVyc2hpcCgpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHRva2VuLmFjY2VwdE93bmVyc2hpcCgpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZGlzYWJsZXMvZW5hYmxlcyB0b2tlbiB0cmFuc2ZlcnMKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCgogICAgICAgIEBwYXJhbSBfZGlzYWJsZSAgICB0cnVlIHRvIGRpc2FibGUgdHJhbnNmZXJzLCBmYWxzZSB0byBlbmFibGUgdGhlbQogICAgKi8KICAgIGZ1bmN0aW9uIGRpc2FibGVUb2tlblRyYW5zZmVycyhib29sIF9kaXNhYmxlKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICB0b2tlbi5kaXNhYmxlVHJhbnNmZXJzKF9kaXNhYmxlKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHdpdGhkcmF3cyB0b2tlbnMgaGVsZCBieSB0aGUgY29udHJvbGxlciBhbmQgc2VuZHMgdGhlbSB0byBhbiBhY2NvdW50CiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lcgoKICAgICAgICBAcGFyYW0gX3Rva2VuICAgRVJDMjAgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdG8gICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgYW1vdW50IHRvIHdpdGhkcmF3CiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdGcm9tVG9rZW4oCiAgICAgICAgSUVSQzIwVG9rZW4gX3Rva2VuLCAKICAgICAgICBhZGRyZXNzIF90bywgCiAgICAgICAgdWludDI1NiBfYW1vdW50CiAgICApIAogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgewogICAgICAgIElUb2tlbkhvbGRlcih0b2tlbikud2l0aGRyYXdUb2tlbnMoX3Rva2VuLCBfdG8sIF9hbW91bnQpOwogICAgfQp9Cgpjb250cmFjdCBNYW5hZ2VkIHsKICAgIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdNYW5hZ2VyOwoKICAgIGV2ZW50IE1hbmFnZXJVcGRhdGUoYWRkcmVzcyBpbmRleGVkIF9wcmV2TWFuYWdlciwgYWRkcmVzcyBpbmRleGVkIF9uZXdNYW5hZ2VyKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gTWFuYWdlZCgpIHB1YmxpYyB7CiAgICAgICAgbWFuYWdlciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBieSB0aGUgbWFuYWdlciBvbmx5CiAgICBtb2RpZmllciBtYW5hZ2VyT25seSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gbWFuYWdlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGFsbG93cyB0cmFuc2ZlcnJpbmcgdGhlIGNvbnRyYWN0IG1hbmFnZW1lbnQKICAgICAgICB0aGUgbmV3IG1hbmFnZXIgc3RpbGwgbmVlZHMgdG8gYWNjZXB0IHRoZSB0cmFuc2ZlcgogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3QgbWFuYWdlcgoKICAgICAgICBAcGFyYW0gX25ld01hbmFnZXIgICAgbmV3IGNvbnRyYWN0IG1hbmFnZXIKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck1hbmFnZW1lbnQoYWRkcmVzcyBfbmV3TWFuYWdlcikgcHVibGljIG1hbmFnZXJPbmx5IHsKICAgICAgICByZXF1aXJlKF9uZXdNYW5hZ2VyICE9IG1hbmFnZXIpOwogICAgICAgIG5ld01hbmFnZXIgPSBfbmV3TWFuYWdlcjsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVzZWQgYnkgYSBuZXcgbWFuYWdlciB0byBhY2NlcHQgYSBtYW5hZ2VtZW50IHRyYW5zZmVyCiAgICAqLwogICAgZnVuY3Rpb24gYWNjZXB0TWFuYWdlbWVudCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5ld01hbmFnZXIpOwogICAgICAgIE1hbmFnZXJVcGRhdGUobWFuYWdlciwgbmV3TWFuYWdlcik7CiAgICAgICAgbWFuYWdlciA9IG5ld01hbmFnZXI7CiAgICAgICAgbmV3TWFuYWdlciA9IGFkZHJlc3MoMCk7CiAgICB9Cn0KCgpjb250cmFjdCBCYW5jb3JDb252ZXJ0ZXIgaXMgSVRva2VuQ29udmVydGVyLCBTbWFydFRva2VuQ29udHJvbGxlciwgTWFuYWdlZCB7CiAgICB1aW50MzIgcHJpdmF0ZSBjb25zdGFudCBNQVhfV0VJR0hUID0gMTAwMDAwMDsKICAgIHVpbnQzMiBwcml2YXRlIGNvbnN0YW50IE1BWF9DT05WRVJTSU9OX0ZFRSA9IDEwMDAwMDA7CgogICAgc3RydWN0IENvbm5lY3RvciB7CiAgICAgICAgdWludDI1NiB2aXJ0dWFsQmFsYW5jZTsgICAgICAgICAvLyBjb25uZWN0b3IgdmlydHVhbCBiYWxhbmNlCiAgICAgICAgdWludDMyIHdlaWdodDsgICAgICAgICAgICAgICAgICAvLyBjb25uZWN0b3Igd2VpZ2h0LCByZXByZXNlbnRlZCBpbiBwcG0sIDEtMTAwMDAwMAogICAgICAgIGJvb2wgaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQ7ICAgLy8gdHJ1ZSBpZiB2aXJ0dWFsIGJhbGFuY2UgaXMgZW5hYmxlZCwgZmFsc2UgaWYgbm90CiAgICAgICAgYm9vbCBpc1B1cmNoYXNlRW5hYmxlZDsgICAgICAgICAvLyBpcyBwdXJjaGFzZSBvZiB0aGUgc21hcnQgdG9rZW4gZW5hYmxlZCB3aXRoIHRoZSBjb25uZWN0b3IsIGNhbiBiZSBzZXQgYnkgdGhlIG93bmVyCiAgICAgICAgYm9vbCBpc1NldDsgICAgICAgICAgICAgICAgICAgICAvLyB1c2VkIHRvIHRlbGwgaWYgdGhlIG1hcHBpbmcgZWxlbWVudCBpcyBkZWZpbmVkCiAgICB9CgogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJzAuNyc7CiAgICBzdHJpbmcgcHVibGljIGNvbnZlcnRlclR5cGUgPSAnYmFuY29yJzsKCiAgICBJQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyBwdWJsaWMgZXh0ZW5zaW9uczsgICAgICAgLy8gYmFuY29yIGNvbnZlcnRlciBleHRlbnNpb25zIGNvbnRyYWN0CiAgICBJRVJDMjBUb2tlbltdIHB1YmxpYyBjb25uZWN0b3JUb2tlbnM7ICAgICAgICAgICAgICAgLy8gRVJDMjAgc3RhbmRhcmQgdG9rZW4gYWRkcmVzc2VzCiAgICBJRVJDMjBUb2tlbltdIHB1YmxpYyBxdWlja0J1eVBhdGg7ICAgICAgICAgICAgICAgICAgLy8gY29udmVyc2lvbiBwYXRoIHRoYXQncyB1c2VkIGluIG9yZGVyIHRvIGJ1eSB0aGUgdG9rZW4gd2l0aCBFVEgKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ29ubmVjdG9yKSBwdWJsaWMgY29ubmVjdG9yczsgICAvLyBjb25uZWN0b3IgdG9rZW4gYWRkcmVzc2VzIC0+IGNvbm5lY3RvciBkYXRhCiAgICB1aW50MzIgcHJpdmF0ZSB0b3RhbENvbm5lY3RvcldlaWdodCA9IDA7ICAgICAgICAgICAgLy8gdXNlZCB0byBlZmZpY2llbnRseSBwcmV2ZW50IGluY3JlYXNpbmcgdGhlIHRvdGFsIGNvbm5lY3RvciB3ZWlnaHQgYWJvdmUgMTAwJQogICAgdWludDMyIHB1YmxpYyBtYXhDb252ZXJzaW9uRmVlID0gMDsgICAgICAgICAgICAgICAgIC8vIG1heGltdW0gY29udmVyc2lvbiBmZWUgZm9yIHRoZSBsaWZldGltZSBvZiB0aGUgY29udHJhY3QsIHJlcHJlc2VudGVkIGluIHBwbSwgMC4uLjEwMDAwMDAgKDAgPSBubyBmZWUsIDEwMCA9IDAuMDElLCAxMDAwMDAwID0gMTAwJSkKICAgIHVpbnQzMiBwdWJsaWMgY29udmVyc2lvbkZlZSA9IDA7ICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50IGNvbnZlcnNpb24gZmVlLCByZXByZXNlbnRlZCBpbiBwcG0sIDAuLi5tYXhDb252ZXJzaW9uRmVlCiAgICBib29sIHB1YmxpYyBjb252ZXJzaW9uc0VuYWJsZWQgPSB0cnVlOyAgICAgICAgICAgICAgLy8gdHJ1ZSBpZiB0b2tlbiBjb252ZXJzaW9ucyBpcyBlbmFibGVkLCBmYWxzZSBpZiBub3QKCiAgICAvLyB0cmlnZ2VyZWQgd2hlbiBhIGNvbnZlcnNpb24gYmV0d2VlbiB0d28gdG9rZW5zIG9jY3VycyAoVG9rZW5Db252ZXJ0ZXIgZXZlbnQpCiAgICBldmVudCBDb252ZXJzaW9uKGFkZHJlc3MgaW5kZXhlZCBfZnJvbVRva2VuLCBhZGRyZXNzIGluZGV4ZWQgX3RvVG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfdHJhZGVyLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX3JldHVybiwKICAgICAgICAgICAgICAgICAgICAgaW50MjU2IF9jb252ZXJzaW9uRmVlLCB1aW50MjU2IF9jdXJyZW50UHJpY2VOLCB1aW50MjU2IF9jdXJyZW50UHJpY2VEKTsKICAgIC8vIHRyaWdnZXJlZCB3aGVuIHRoZSBjb252ZXJzaW9uIGZlZSBpcyB1cGRhdGVkCiAgICBldmVudCBDb252ZXJzaW9uRmVlVXBkYXRlKHVpbnQzMiBfcHJldkZlZSwgdWludDMyIF9uZXdGZWUpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKCiAgICAgICAgQHBhcmFtICBfdG9rZW4gICAgICAgICAgICAgIHNtYXJ0IHRva2VuIGdvdmVybmVkIGJ5IHRoZSBjb252ZXJ0ZXIKICAgICAgICBAcGFyYW0gIF9leHRlbnNpb25zICAgICAgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBjb252ZXJ0ZXIgZXh0ZW5zaW9ucyBjb250cmFjdAogICAgICAgIEBwYXJhbSAgX21heENvbnZlcnNpb25GZWUgICBtYXhpbXVtIGNvbnZlcnNpb24gZmVlLCByZXByZXNlbnRlZCBpbiBwcG0KICAgICAgICBAcGFyYW0gIF9jb25uZWN0b3JUb2tlbiAgICAgb3B0aW9uYWwsIGluaXRpYWwgY29ubmVjdG9yLCBhbGxvd3MgZGVmaW5pbmcgdGhlIGZpcnN0IGNvbm5lY3RvciBhdCBkZXBsb3ltZW50IHRpbWUKICAgICAgICBAcGFyYW0gIF9jb25uZWN0b3JXZWlnaHQgICAgb3B0aW9uYWwsIHdlaWdodCBmb3IgdGhlIGluaXRpYWwgY29ubmVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gQmFuY29yQ29udmVydGVyKElTbWFydFRva2VuIF90b2tlbiwgSUJhbmNvckNvbnZlcnRlckV4dGVuc2lvbnMgX2V4dGVuc2lvbnMsIHVpbnQzMiBfbWF4Q29udmVyc2lvbkZlZSwgSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MzIgX2Nvbm5lY3RvcldlaWdodCkKICAgICAgICBwdWJsaWMKICAgICAgICBTbWFydFRva2VuQ29udHJvbGxlcihfdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKF9leHRlbnNpb25zKQogICAgICAgIHZhbGlkTWF4Q29udmVyc2lvbkZlZShfbWF4Q29udmVyc2lvbkZlZSkKICAgIHsKICAgICAgICBleHRlbnNpb25zID0gX2V4dGVuc2lvbnM7CiAgICAgICAgbWF4Q29udmVyc2lvbkZlZSA9IF9tYXhDb252ZXJzaW9uRmVlOwoKICAgICAgICBpZiAoX2Nvbm5lY3RvclRva2VuICE9IGFkZHJlc3MoMCkpCiAgICAgICAgICAgIGFkZENvbm5lY3RvcihfY29ubmVjdG9yVG9rZW4sIF9jb25uZWN0b3JXZWlnaHQsIGZhbHNlKTsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSBjb25uZWN0b3IgdG9rZW4gYWRkcmVzcyAtIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgYmVsb25ncyB0byBvbmUgb2YgdGhlIGNvbm5lY3RvciB0b2tlbnMKICAgIG1vZGlmaWVyIHZhbGlkQ29ubmVjdG9yKElFUkMyMFRva2VuIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShjb25uZWN0b3JzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSB0b2tlbiBhZGRyZXNzIC0gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBiZWxvbmdzIHRvIG9uZSBvZiB0aGUgY29udmVydGlibGUgdG9rZW5zCiAgICBtb2RpZmllciB2YWxpZFRva2VuKElFUkMyMFRva2VuIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyA9PSB0b2tlbiB8fCBjb25uZWN0b3JzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2ZXJpZmllcyB0aGF0IHRoZSBnYXMgcHJpY2UgaXMgbG93ZXIgdGhhbiB0aGUgdW5pdmVyc2FsIGxpbWl0CiAgICBtb2RpZmllciB2YWxpZEdhc1ByaWNlKCkgewogICAgICAgIGFzc2VydCh0eC5nYXNwcmljZSA8PSBleHRlbnNpb25zLmdhc1ByaWNlTGltaXQoKS5nYXNQcmljZSgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIHZhbGlkYXRlcyBtYXhpbXVtIGNvbnZlcnNpb24gZmVlCiAgICBtb2RpZmllciB2YWxpZE1heENvbnZlcnNpb25GZWUodWludDMyIF9jb252ZXJzaW9uRmVlKSB7CiAgICAgICAgcmVxdWlyZShfY29udmVyc2lvbkZlZSA+PSAwICYmIF9jb252ZXJzaW9uRmVlIDw9IE1BWF9DT05WRVJTSU9OX0ZFRSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgY29udmVyc2lvbiBmZWUKICAgIG1vZGlmaWVyIHZhbGlkQ29udmVyc2lvbkZlZSh1aW50MzIgX2NvbnZlcnNpb25GZWUpIHsKICAgICAgICByZXF1aXJlKF9jb252ZXJzaW9uRmVlID49IDAgJiYgX2NvbnZlcnNpb25GZWUgPD0gbWF4Q29udmVyc2lvbkZlZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgY29ubmVjdG9yIHdlaWdodCByYW5nZQogICAgbW9kaWZpZXIgdmFsaWRDb25uZWN0b3JXZWlnaHQodWludDMyIF93ZWlnaHQpIHsKICAgICAgICByZXF1aXJlKF93ZWlnaHQgPiAwICYmIF93ZWlnaHQgPD0gTUFYX1dFSUdIVCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSBjb252ZXJzaW9uIHBhdGggLSB2ZXJpZmllcyB0aGF0IHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaXMgb2RkIGFuZCB0aGF0IG1heGltdW0gbnVtYmVyIG9mICdob3BzJyBpcyAxMAogICAgbW9kaWZpZXIgdmFsaWRDb252ZXJzaW9uUGF0aChJRVJDMjBUb2tlbltdIF9wYXRoKSB7CiAgICAgICAgcmVxdWlyZShfcGF0aC5sZW5ndGggPiAyICYmIF9wYXRoLmxlbmd0aCA8PSAoMSArIDIgKiAxMCkgJiYgX3BhdGgubGVuZ3RoICUgMiA9PSAxKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gb25seSB3aGVuIGNvbnZlcnNpb25zIGFyZW4ndCBkaXNhYmxlZAogICAgbW9kaWZpZXIgY29udmVyc2lvbnNBbGxvd2VkIHsKICAgICAgICBhc3NlcnQoY29udmVyc2lvbnNFbmFibGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gb25seSBmb3Igb3duZXIgb3IgbWFuYWdlcgogICAgbW9kaWZpZXIgb3duZXJPck1hbmFnZXJPbmx5IHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSBtYW5hZ2VyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgbnVtYmVyIG9mIGNvbm5lY3RvciB0b2tlbnMgZGVmaW5lZAoKICAgICAgICBAcmV0dXJuIG51bWJlciBvZiBjb25uZWN0b3IgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gY29ubmVjdG9yVG9rZW5Db3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQxNikgewogICAgICAgIHJldHVybiB1aW50MTYoY29ubmVjdG9yVG9rZW5zLmxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBudW1iZXIgb2YgY29udmVydGlibGUgdG9rZW5zIHN1cHBvcnRlZCBieSB0aGUgY29udHJhY3QKICAgICAgICBub3RlIHRoYXQgdGhlIG51bWJlciBvZiBjb252ZXJ0aWJsZSB0b2tlbnMgaXMgdGhlIG51bWJlciBvZiBjb25uZWN0b3IgdG9rZW4sIHBsdXMgMSAodGhhdCByZXByZXNlbnRzIHRoZSBzbWFydCB0b2tlbikKCiAgICAgICAgQHJldHVybiBudW1iZXIgb2YgY29udmVydGlibGUgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydGlibGVUb2tlbkNvdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDE2KSB7CiAgICAgICAgcmV0dXJuIGNvbm5lY3RvclRva2VuQ291bnQoKSArIDE7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBnaXZlbiBhIGNvbnZlcnRpYmxlIHRva2VuIGluZGV4LCByZXR1cm5zIGl0cyBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEBwYXJhbSBfdG9rZW5JbmRleCAgY29udmVydGlibGUgdG9rZW4gaW5kZXgKCiAgICAgICAgQHJldHVybiBjb252ZXJ0aWJsZSB0b2tlbiBhZGRyZXNzCiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydGlibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3Rva2VuSW5kZXggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRva2VuOwogICAgICAgIHJldHVybiBjb25uZWN0b3JUb2tlbnNbX3Rva2VuSW5kZXggLSAxXTsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgYWxsb3dzIHRoZSBvd25lciB0byB1cGRhdGUgdGhlIGV4dGVuc2lvbnMgY29udHJhY3QgYWRkcmVzcwoKICAgICAgICBAcGFyYW0gX2V4dGVuc2lvbnMgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBjb252ZXJ0ZXIgZXh0ZW5zaW9ucyBjb250cmFjdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldEV4dGVuc2lvbnMoSUJhbmNvckNvbnZlcnRlckV4dGVuc2lvbnMgX2V4dGVuc2lvbnMpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF9leHRlbnNpb25zKQogICAgICAgIG5vdFRoaXMoX2V4dGVuc2lvbnMpCiAgICB7CiAgICAgICAgZXh0ZW5zaW9ucyA9IF9leHRlbnNpb25zOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG1hbmFnZXIgdG8gdXBkYXRlIHRoZSBxdWljayBidXkgcGF0aAoKICAgICAgICBAcGFyYW0gX3BhdGggICAgbmV3IHF1aWNrIGJ1eSBwYXRoLCBzZWUgY29udmVyc2lvbiBwYXRoIGZvcm1hdCBpbiB0aGUgQmFuY29yUXVpY2tDb252ZXJ0ZXIgY29udHJhY3QKICAgICovCiAgICBmdW5jdGlvbiBzZXRRdWlja0J1eVBhdGgoSUVSQzIwVG9rZW5bXSBfcGF0aCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZENvbnZlcnNpb25QYXRoKF9wYXRoKQogICAgewogICAgICAgIHF1aWNrQnV5UGF0aCA9IF9wYXRoOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG1hbmFnZXIgdG8gY2xlYXIgdGhlIHF1aWNrIGJ1eSBwYXRoCiAgICAqLwogICAgZnVuY3Rpb24gY2xlYXJRdWlja0J1eVBhdGgoKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICBxdWlja0J1eVBhdGgubGVuZ3RoID0gMDsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGUgcXVpY2sgYnV5IHBhdGggYXJyYXkKCiAgICAgICAgQHJldHVybiBxdWljayBidXkgcGF0aCBsZW5ndGgKICAgICovCiAgICBmdW5jdGlvbiBnZXRRdWlja0J1eVBhdGhMZW5ndGgoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHF1aWNrQnV5UGF0aC5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcyB0aGUgZW50aXJlIGNvbnZlcnNpb24gZnVuY3Rpb25hbGl0eQogICAgICAgIHRoaXMgaXMgYSBzYWZldHkgbWVjaGFuaXNtIGluIGNhc2Ugb2YgYSBlbWVyZ2VuY3kKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG1hbmFnZXIKCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlIHRydWUgdG8gZGlzYWJsZSBjb252ZXJzaW9ucywgZmFsc2UgdG8gcmUtZW5hYmxlIHRoZW0KICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlQ29udmVyc2lvbnMoYm9vbCBfZGlzYWJsZSkgcHVibGljIG93bmVyT3JNYW5hZ2VyT25seSB7CiAgICAgICAgY29udmVyc2lvbnNFbmFibGVkID0gIV9kaXNhYmxlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXBkYXRlcyB0aGUgY3VycmVudCBjb252ZXJzaW9uIGZlZQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgbWFuYWdlcgoKICAgICAgICBAcGFyYW0gX2NvbnZlcnNpb25GZWUgbmV3IGNvbnZlcnNpb24gZmVlLCByZXByZXNlbnRlZCBpbiBwcG0KICAgICovCiAgICBmdW5jdGlvbiBzZXRDb252ZXJzaW9uRmVlKHVpbnQzMiBfY29udmVyc2lvbkZlZSkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9yTWFuYWdlck9ubHkKICAgICAgICB2YWxpZENvbnZlcnNpb25GZWUoX2NvbnZlcnNpb25GZWUpCiAgICB7CiAgICAgICAgQ29udmVyc2lvbkZlZVVwZGF0ZShjb252ZXJzaW9uRmVlLCBfY29udmVyc2lvbkZlZSk7CiAgICAgICAgY29udmVyc2lvbkZlZSA9IF9jb252ZXJzaW9uRmVlOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBjb252ZXJzaW9uIGZlZSBhbW91bnQgZm9yIGEgZ2l2ZW4gcmV0dXJuIGFtb3VudAoKICAgICAgICBAcmV0dXJuIGNvbnZlcnNpb24gZmVlIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGdldENvbnZlcnNpb25GZWVBbW91bnQodWludDI1NiBfYW1vdW50KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHNhZmVNdWwoX2Ftb3VudCwgY29udmVyc2lvbkZlZSkgLyBNQVhfQ09OVkVSU0lPTl9GRUU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkZWZpbmVzIGEgbmV3IGNvbm5lY3RvciBmb3IgdGhlIHRva2VuCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciB3aGlsZSB0aGUgY29udmVydGVyIGlzIGluYWN0aXZlCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICAgICAgICAgICAgICAgICBhZGRyZXNzIG9mIHRoZSBjb25uZWN0b3IgdG9rZW4KICAgICAgICBAcGFyYW0gX3dlaWdodCAgICAgICAgICAgICAgICAgY29uc3RhbnQgY29ubmVjdG9yIHdlaWdodCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgY29ubmVjdG9yLCBmYWxzZSB0byBkaXNhYmxlIGl0CiAgICAqLwogICAgZnVuY3Rpb24gYWRkQ29ubmVjdG9yKElFUkMyMFRva2VuIF90b2tlbiwgdWludDMyIF93ZWlnaHQsIGJvb2wgX2VuYWJsZVZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIGluYWN0aXZlCiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgICAgICBub3RUaGlzKF90b2tlbikKICAgICAgICB2YWxpZENvbm5lY3RvcldlaWdodChfd2VpZ2h0KQogICAgewogICAgICAgIHJlcXVpcmUoX3Rva2VuICE9IHRva2VuICYmICFjb25uZWN0b3JzW190b2tlbl0uaXNTZXQgJiYgdG90YWxDb25uZWN0b3JXZWlnaHQgKyBfd2VpZ2h0IDw9IE1BWF9XRUlHSFQpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICBjb25uZWN0b3JzW190b2tlbl0udmlydHVhbEJhbGFuY2UgPSAwOwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS53ZWlnaHQgPSBfd2VpZ2h0OwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS5pc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZCA9IF9lbmFibGVWaXJ0dWFsQmFsYW5jZTsKICAgICAgICBjb25uZWN0b3JzW190b2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSB0cnVlOwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS5pc1NldCA9IHRydWU7CiAgICAgICAgY29ubmVjdG9yVG9rZW5zLnB1c2goX3Rva2VuKTsKICAgICAgICB0b3RhbENvbm5lY3RvcldlaWdodCArPSBfd2VpZ2h0OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXBkYXRlcyBvbmUgb2YgdGhlIHRva2VuIGNvbm5lY3RvcnMKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gICAgICAgICBhZGRyZXNzIG9mIHRoZSBjb25uZWN0b3IgdG9rZW4KICAgICAgICBAcGFyYW0gX3dlaWdodCAgICAgICAgICAgICAgICAgY29uc3RhbnQgY29ubmVjdG9yIHdlaWdodCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgY29ubmVjdG9yLCBmYWxzZSB0byBkaXNhYmxlIGl0CiAgICAgICAgQHBhcmFtIF92aXJ0dWFsQmFsYW5jZSAgICAgICAgIG5ldyBjb25uZWN0b3IncyB2aXJ0dWFsIGJhbGFuY2UKICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDb25uZWN0b3IoSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MzIgX3dlaWdodCwgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UsIHVpbnQyNTYgX3ZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQ29ubmVjdG9yKF9jb25uZWN0b3JUb2tlbikKICAgICAgICB2YWxpZENvbm5lY3RvcldlaWdodChfd2VpZ2h0KQogICAgewogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICByZXF1aXJlKHRvdGFsQ29ubmVjdG9yV2VpZ2h0IC0gY29ubmVjdG9yLndlaWdodCArIF93ZWlnaHQgPD0gTUFYX1dFSUdIVCk7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIHRvdGFsQ29ubmVjdG9yV2VpZ2h0ID0gdG90YWxDb25uZWN0b3JXZWlnaHQgLSBjb25uZWN0b3Iud2VpZ2h0ICsgX3dlaWdodDsKICAgICAgICBjb25uZWN0b3Iud2VpZ2h0ID0gX3dlaWdodDsKICAgICAgICBjb25uZWN0b3IuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPSBfZW5hYmxlVmlydHVhbEJhbGFuY2U7CiAgICAgICAgY29ubmVjdG9yLnZpcnR1YWxCYWxhbmNlID0gX3ZpcnR1YWxCYWxhbmNlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZGlzYWJsZXMgcHVyY2hhc2luZyB3aXRoIHRoZSBnaXZlbiBjb25uZWN0b3IgdG9rZW4gaW4gY2FzZSB0aGUgY29ubmVjdG9yIHRva2VuIGdvdCBjb21wcm9taXNlZAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKICAgICAgICBub3RlIHRoYXQgc2VsbGluZyBpcyBzdGlsbCBlbmFibGVkIHJlZ2FyZGxlc3Mgb2YgdGhpcyBmbGFnIGFuZCBpdCBjYW5ub3QgYmUgZGlzYWJsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgICAgICAgdHJ1ZSB0byBkaXNhYmxlIHRoZSB0b2tlbiwgZmFsc2UgdG8gcmUtZW5hYmxlIGl0CiAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZUNvbm5lY3RvclB1cmNoYXNlcyhJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIGJvb2wgX2Rpc2FibGUpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRDb25uZWN0b3IoX2Nvbm5lY3RvclRva2VuKQogICAgewogICAgICAgIGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXS5pc1B1cmNoYXNlRW5hYmxlZCA9ICFfZGlzYWJsZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGNvbm5lY3RvcidzIHZpcnR1YWwgYmFsYW5jZSBpZiBvbmUgaXMgZGVmaW5lZCwgb3RoZXJ3aXNlIHJldHVybnMgdGhlIGFjdHVhbCBiYWxhbmNlCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEByZXR1cm4gY29ubmVjdG9yIGJhbGFuY2UKICAgICovCiAgICBmdW5jdGlvbiBnZXRDb25uZWN0b3JCYWxhbmNlKElFUkMyMFRva2VuIF9jb25uZWN0b3JUb2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgdmFsaWRDb25uZWN0b3IoX2Nvbm5lY3RvclRva2VuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQ29ubmVjdG9yIHN0b3JhZ2UgY29ubmVjdG9yID0gY29ubmVjdG9yc1tfY29ubmVjdG9yVG9rZW5dOwogICAgICAgIHJldHVybiBjb25uZWN0b3IuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPyBjb25uZWN0b3IudmlydHVhbEJhbGFuY2UgOiBfY29ubmVjdG9yVG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBjb252ZXJ0aW5nIGEgc3BlY2lmaWMgYW1vdW50IG9mIF9mcm9tVG9rZW4gdG8gX3RvVG9rZW4KCiAgICAgICAgQHBhcmFtIF9mcm9tVG9rZW4gIEVSQzIwIHRva2VuIHRvIGNvbnZlcnQgZnJvbQogICAgICAgIEBwYXJhbSBfdG9Ub2tlbiAgICBFUkMyMCB0b2tlbiB0byBjb252ZXJ0IHRvCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgIGFtb3VudCB0byBjb252ZXJ0LCBpbiBmcm9tVG9rZW4KCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBjb252ZXJzaW9uIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRSZXR1cm4oSUVSQzIwVG9rZW4gX2Zyb21Ub2tlbiwgSUVSQzIwVG9rZW4gX3RvVG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2Zyb21Ub2tlbiAhPSBfdG9Ub2tlbik7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIC8vIGNvbnZlcnNpb24gYmV0d2VlbiB0aGUgdG9rZW4gYW5kIG9uZSBvZiBpdHMgY29ubmVjdG9ycwogICAgICAgIGlmIChfdG9Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIGdldFB1cmNoYXNlUmV0dXJuKF9mcm9tVG9rZW4sIF9hbW91bnQpOwogICAgICAgIGVsc2UgaWYgKF9mcm9tVG9rZW4gPT0gdG9rZW4pCiAgICAgICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF90b1Rva2VuLCBfYW1vdW50KTsKCiAgICAgICAgLy8gY29udmVyc2lvbiBiZXR3ZWVuIDIgY29ubmVjdG9ycwogICAgICAgIHVpbnQyNTYgcHVyY2hhc2VSZXR1cm5BbW91bnQgPSBnZXRQdXJjaGFzZVJldHVybihfZnJvbVRva2VuLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gZ2V0U2FsZVJldHVybihfdG9Ub2tlbiwgcHVyY2hhc2VSZXR1cm5BbW91bnQsIHNhZmVBZGQodG9rZW4udG90YWxTdXBwbHkoKSwgcHVyY2hhc2VSZXR1cm5BbW91bnQpKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGV4cGVjdGVkIHJldHVybiBmb3IgYnV5aW5nIHRoZSB0b2tlbiBmb3IgYSBjb25uZWN0b3IgdG9rZW4KCiAgICAgICAgQHBhcmFtIF9jb25uZWN0b3JUb2tlbiAgY29ubmVjdG9yIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgICBhbW91bnQgdG8gZGVwb3NpdCAoaW4gdGhlIGNvbm5lY3RvciB0b2tlbikKCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBwdXJjaGFzZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UHVyY2hhc2VSZXR1cm4oSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MjU2IF9kZXBvc2l0QW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICBhY3RpdmUKICAgICAgICB2YWxpZENvbm5lY3RvcihfY29ubmVjdG9yVG9rZW4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBDb25uZWN0b3Igc3RvcmFnZSBjb25uZWN0b3IgPSBjb25uZWN0b3JzW19jb25uZWN0b3JUb2tlbl07CiAgICAgICAgcmVxdWlyZShjb25uZWN0b3IuaXNQdXJjaGFzZUVuYWJsZWQpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICB1aW50MjU2IHRva2VuU3VwcGx5ID0gdG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50MjU2IGNvbm5lY3RvckJhbGFuY2UgPSBnZXRDb25uZWN0b3JCYWxhbmNlKF9jb25uZWN0b3JUb2tlbik7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBleHRlbnNpb25zLmZvcm11bGEoKS5jYWxjdWxhdGVQdXJjaGFzZVJldHVybih0b2tlblN1cHBseSwgY29ubmVjdG9yQmFsYW5jZSwgY29ubmVjdG9yLndlaWdodCwgX2RlcG9zaXRBbW91bnQpOwoKICAgICAgICAvLyBkZWR1Y3QgdGhlIGZlZSBmcm9tIHRoZSByZXR1cm4gYW1vdW50CiAgICAgICAgdWludDI1NiBmZWVBbW91bnQgPSBnZXRDb252ZXJzaW9uRmVlQW1vdW50KGFtb3VudCk7CiAgICAgICAgcmV0dXJuIHNhZmVTdWIoYW1vdW50LCBmZWVBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9zZWxsQW1vdW50ICAgICAgYW1vdW50IHRvIHNlbGwgKGluIHRoZSBzbWFydCB0b2tlbikKCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBzYWxlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRTYWxlUmV0dXJuKElFUkMyMFRva2VuIF9jb25uZWN0b3JUb2tlbiwgdWludDI1NiBfc2VsbEFtb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF9jb25uZWN0b3JUb2tlbiwgX3NlbGxBbW91bnQsIHRva2VuLnRvdGFsU3VwcGx5KCkpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgYSBzcGVjaWZpYyBhbW91bnQgb2YgX2Zyb21Ub2tlbiB0byBfdG9Ub2tlbgoKICAgICAgICBAcGFyYW0gX2Zyb21Ub2tlbiAgRVJDMjAgdG9rZW4gdG8gY29udmVydCBmcm9tCiAgICAgICAgQHBhcmFtIF90b1Rva2VuICAgIEVSQzIwIHRva2VuIHRvIGNvbnZlcnQgdG8KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgYW1vdW50IHRvIGNvbnZlcnQsIGluIGZyb21Ub2tlbgogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiBjb252ZXJzaW9uIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0KElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9mcm9tVG9rZW4gIT0gX3RvVG9rZW4pOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICAvLyBjb252ZXJzaW9uIGJldHdlZW4gdGhlIHRva2VuIGFuZCBvbmUgb2YgaXRzIGNvbm5lY3RvcnMKICAgICAgICBpZiAoX3RvVG9rZW4gPT0gdG9rZW4pCiAgICAgICAgICAgIHJldHVybiBidXkoX2Zyb21Ub2tlbiwgX2Ftb3VudCwgX21pblJldHVybik7CiAgICAgICAgZWxzZSBpZiAoX2Zyb21Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIHNlbGwoX3RvVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOwoKICAgICAgICAvLyBjb252ZXJzaW9uIGJldHdlZW4gMiBjb25uZWN0b3JzCiAgICAgICAgdWludDI1NiBwdXJjaGFzZUFtb3VudCA9IGJ1eShfZnJvbVRva2VuLCBfYW1vdW50LCAxKTsKICAgICAgICByZXR1cm4gc2VsbChfdG9Ub2tlbiwgcHVyY2hhc2VBbW91bnQsIF9taW5SZXR1cm4pOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYnV5cyB0aGUgdG9rZW4gYnkgZGVwb3NpdGluZyBvbmUgb2YgaXRzIGNvbm5lY3RvciB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9jb25uZWN0b3JUb2tlbiAgY29ubmVjdG9yIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgICBhbW91bnQgdG8gZGVwb3NpdCAoaW4gdGhlIGNvbm5lY3RvciB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgICAgICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiBidXkgcmV0dXJuIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGJ1eShJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX2RlcG9zaXRBbW91bnQsIHVpbnQyNTYgX21pblJldHVybikKICAgICAgICBwdWJsaWMKICAgICAgICBjb252ZXJzaW9uc0FsbG93ZWQKICAgICAgICB2YWxpZEdhc1ByaWNlCiAgICAgICAgZ3JlYXRlclRoYW5aZXJvKF9taW5SZXR1cm4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGdldFB1cmNoYXNlUmV0dXJuKF9jb25uZWN0b3JUb2tlbiwgX2RlcG9zaXRBbW91bnQpOwogICAgICAgIHJlcXVpcmUoYW1vdW50ICE9IDAgJiYgYW1vdW50ID49IF9taW5SZXR1cm4pOyAvLyBlbnN1cmUgdGhlIHRyYWRlIGdpdmVzIHNvbWV0aGluZyBpbiByZXR1cm4gYW5kIG1lZXRzIHRoZSBtaW5pbXVtIHJlcXVlc3RlZCBhbW91bnQKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICBpZiAoY29ubmVjdG9yLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQogICAgICAgICAgICBjb25uZWN0b3IudmlydHVhbEJhbGFuY2UgPSBzYWZlQWRkKGNvbm5lY3Rvci52aXJ0dWFsQmFsYW5jZSwgX2RlcG9zaXRBbW91bnQpOwoKICAgICAgICAvLyB0cmFuc2ZlciBfZGVwb3NpdEFtb3VudCBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW4gdGhlIGNvbm5lY3RvciB0b2tlbgogICAgICAgIGFzc2VydChfY29ubmVjdG9yVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF9kZXBvc2l0QW1vdW50KSk7CiAgICAgICAgLy8gaXNzdWUgbmV3IGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIHNtYXJ0IHRva2VuCiAgICAgICAgdG9rZW4uaXNzdWUobXNnLnNlbmRlciwgYW1vdW50KTsKCiAgICAgICAgZGlzcGF0Y2hDb252ZXJzaW9uRXZlbnQoX2Nvbm5lY3RvclRva2VuLCBfZGVwb3NpdEFtb3VudCwgYW1vdW50LCB0cnVlKTsKICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgc2VsbHMgdGhlIHRva2VuIGJ5IHdpdGhkcmF3aW5nIGZyb20gb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9zZWxsQW1vdW50ICAgICAgYW1vdW50IHRvIHNlbGwgKGluIHRoZSBzbWFydCB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgICAgICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gc2VsbCByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gc2VsbChJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQsIHVpbnQyNTYgX21pblJldHVybikKICAgICAgICBwdWJsaWMKICAgICAgICBjb252ZXJzaW9uc0FsbG93ZWQKICAgICAgICB2YWxpZEdhc1ByaWNlCiAgICAgICAgZ3JlYXRlclRoYW5aZXJvKF9taW5SZXR1cm4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXF1aXJlKF9zZWxsQW1vdW50IDw9IHRva2VuLmJhbGFuY2VPZihtc2cuc2VuZGVyKSk7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gZ2V0U2FsZVJldHVybihfY29ubmVjdG9yVG9rZW4sIF9zZWxsQW1vdW50KTsKICAgICAgICByZXF1aXJlKGFtb3VudCAhPSAwICYmIGFtb3VudCA+PSBfbWluUmV0dXJuKTsgLy8gZW5zdXJlIHRoZSB0cmFkZSBnaXZlcyBzb21ldGhpbmcgaW4gcmV0dXJuIGFuZCBtZWV0cyB0aGUgbWluaW11bSByZXF1ZXN0ZWQgYW1vdW50CgogICAgICAgIHVpbnQyNTYgdG9rZW5TdXBwbHkgPSB0b2tlbi50b3RhbFN1cHBseSgpOwogICAgICAgIHVpbnQyNTYgY29ubmVjdG9yQmFsYW5jZSA9IGdldENvbm5lY3RvckJhbGFuY2UoX2Nvbm5lY3RvclRva2VuKTsKICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgdHJhZGUgd2lsbCBvbmx5IGRlcGxldGUgdGhlIGNvbm5lY3RvciBpZiB0aGUgdG90YWwgc3VwcGx5IGlzIGRlcGxldGVkIGFzIHdlbGwKICAgICAgICBhc3NlcnQoYW1vdW50IDwgY29ubmVjdG9yQmFsYW5jZSB8fCAoYW1vdW50ID09IGNvbm5lY3RvckJhbGFuY2UgJiYgX3NlbGxBbW91bnQgPT0gdG9rZW5TdXBwbHkpKTsKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICBpZiAoY29ubmVjdG9yLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQogICAgICAgICAgICBjb25uZWN0b3IudmlydHVhbEJhbGFuY2UgPSBzYWZlU3ViKGNvbm5lY3Rvci52aXJ0dWFsQmFsYW5jZSwgYW1vdW50KTsKCiAgICAgICAgLy8gZGVzdHJveSBfc2VsbEFtb3VudCBmcm9tIHRoZSBjYWxsZXIncyBiYWxhbmNlIGluIHRoZSBzbWFydCB0b2tlbgogICAgICAgIHRva2VuLmRlc3Ryb3kobXNnLnNlbmRlciwgX3NlbGxBbW91bnQpOwogICAgICAgIC8vIHRyYW5zZmVyIGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIGNvbm5lY3RvciB0b2tlbgogICAgICAgIC8vIHRoZSB0cmFuc2ZlciBtaWdodCBmYWlsIGlmIHRoZSBhY3R1YWwgY29ubmVjdG9yIGJhbGFuY2UgaXMgc21hbGxlciB0aGFuIHRoZSB2aXJ0dWFsIGJhbGFuY2UKICAgICAgICBhc3NlcnQoX2Nvbm5lY3RvclRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudCkpOwoKICAgICAgICBkaXNwYXRjaENvbnZlcnNpb25FdmVudChfY29ubmVjdG9yVG9rZW4sIF9zZWxsQW1vdW50LCBhbW91bnQsIGZhbHNlKTsKICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgdGhlIHRva2VuIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsgYnkgZm9sbG93aW5nIGEgcHJlZGVmaW5lZCBjb252ZXJzaW9uIHBhdGgKICAgICAgICBub3RlIHRoYXQgd2hlbiBjb252ZXJ0aW5nIGZyb20gYW4gRVJDMjAgdG9rZW4gKGFzIG9wcG9zZWQgdG8gYSBzbWFydCB0b2tlbiksIGFsbG93YW5jZSBtdXN0IGJlIHNldCBiZWZvcmVoYW5kCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICAgICAgY29udmVyc2lvbiBwYXRoLCBzZWUgY29udmVyc2lvbiBwYXRoIGZvcm1hdCBpbiB0aGUgQmFuY29yUXVpY2tDb252ZXJ0ZXIgY29udHJhY3QKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgIGFtb3VudCB0byBjb252ZXJ0IGZyb20gKGluIHRoZSBpbml0aWFsIHNvdXJjZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgIGlmIHRoZSBjb252ZXJzaW9uIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gcXVpY2tDb252ZXJ0KElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICB2YWxpZENvbnZlcnNpb25QYXRoKF9wYXRoKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgSUVSQzIwVG9rZW4gZnJvbVRva2VuID0gX3BhdGhbMF07CiAgICAgICAgSUJhbmNvclF1aWNrQ29udmVydGVyIHF1aWNrQ29udmVydGVyID0gZXh0ZW5zaW9ucy5xdWlja0NvbnZlcnRlcigpOwoKICAgICAgICAvLyB3ZSBuZWVkIHRvIHRyYW5zZmVyIHRoZSBzb3VyY2UgdG9rZW5zIGZyb20gdGhlIGNhbGxlciB0byB0aGUgcXVpY2sgY29udmVydGVyLAogICAgICAgIC8vIHNvIGl0IGNhbiBleGVjdXRlIHRoZSBjb252ZXJzaW9uIG9uIGJlaGFsZiBvZiB0aGUgY2FsbGVyCiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIC8vIG5vdCBFVEgsIHNlbmQgdGhlIHNvdXJjZSB0b2tlbnMgdG8gdGhlIHF1aWNrIGNvbnZlcnRlcgogICAgICAgICAgICAvLyBpZiB0aGUgdG9rZW4gaXMgdGhlIHNtYXJ0IHRva2VuLCBubyBhbGxvd2FuY2UgaXMgcmVxdWlyZWQgLSBkZXN0cm95IHRoZSB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyIGFuZCBpc3N1ZSB0aGVtIHRvIHRoZSBxdWljayBjb252ZXJ0ZXIKICAgICAgICAgICAgaWYgKGZyb21Ub2tlbiA9PSB0b2tlbikgewogICAgICAgICAgICAgICAgdG9rZW4uZGVzdHJveShtc2cuc2VuZGVyLCBfYW1vdW50KTsgLy8gZGVzdHJveSBfYW1vdW50IHRva2VucyBmcm9tIHRoZSBjYWxsZXIncyBiYWxhbmNlIGluIHRoZSBzbWFydCB0b2tlbgogICAgICAgICAgICAgICAgdG9rZW4uaXNzdWUocXVpY2tDb252ZXJ0ZXIsIF9hbW91bnQpOyAvLyBpc3N1ZSBfYW1vdW50IG5ldyB0b2tlbnMgdG8gdGhlIHF1aWNrIGNvbnZlcnRlcgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCB3ZSBhc3N1bWUgd2UgYWxyZWFkeSBoYXZlIGFsbG93YW5jZSwgdHJhbnNmZXIgdGhlIHRva2VucyBkaXJlY3RseSB0byB0aGUgcXVpY2sgY29udmVydGVyCiAgICAgICAgICAgICAgICBhc3NlcnQoZnJvbVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBxdWlja0NvbnZlcnRlciwgX2Ftb3VudCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBleGVjdXRlIHRoZSBjb252ZXJzaW9uIGFuZCBwYXNzIG9uIHRoZSBFVEggd2l0aCB0aGUgY2FsbAogICAgICAgIHJldHVybiBxdWlja0NvbnZlcnRlci5jb252ZXJ0Rm9yLnZhbHVlKG1zZy52YWx1ZSkoX3BhdGgsIF9hbW91bnQsIF9taW5SZXR1cm4sIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIGRlcHJlY2F0ZWQsIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkKICAgIGZ1bmN0aW9uIGNoYW5nZShJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnQoX2Zyb21Ub2tlbiwgX3RvVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXRpbGl0eSwgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zLCBnaXZlbiBhIHRvdGFsIHN1cHBseSBvdmVycmlkZQoKICAgICAgICBAcGFyYW0gX2Nvbm5lY3RvclRva2VuICBjb25uZWN0b3IgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfc2VsbEFtb3VudCAgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCiAgICAgICAgQHBhcmFtIF90b3RhbFN1cHBseSAgICAgdG90YWwgdG9rZW4gc3VwcGx5LCBvdmVycmlkZXMgdGhlIGFjdHVhbCB0b2tlbiB0b3RhbCBzdXBwbHkgd2hlbiBjYWxjdWxhdGluZyB0aGUgcmV0dXJuCgogICAgICAgIEByZXR1cm4gc2FsZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0U2FsZVJldHVybihJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQsIHVpbnQyNTYgX3RvdGFsU3VwcGx5KQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgYWN0aXZlCiAgICAgICAgdmFsaWRDb25uZWN0b3IoX2Nvbm5lY3RvclRva2VuKQogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfdG90YWxTdXBwbHkpCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBDb25uZWN0b3Igc3RvcmFnZSBjb25uZWN0b3IgPSBjb25uZWN0b3JzW19jb25uZWN0b3JUb2tlbl07CiAgICAgICAgdWludDI1NiBjb25uZWN0b3JCYWxhbmNlID0gZ2V0Q29ubmVjdG9yQmFsYW5jZShfY29ubmVjdG9yVG9rZW4pOwogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gZXh0ZW5zaW9ucy5mb3JtdWxhKCkuY2FsY3VsYXRlU2FsZVJldHVybihfdG90YWxTdXBwbHksIGNvbm5lY3RvckJhbGFuY2UsIGNvbm5lY3Rvci53ZWlnaHQsIF9zZWxsQW1vdW50KTsKCiAgICAgICAgLy8gZGVkdWN0IHRoZSBmZWUgZnJvbSB0aGUgcmV0dXJuIGFtb3VudAogICAgICAgIHVpbnQyNTYgZmVlQW1vdW50ID0gZ2V0Q29udmVyc2lvbkZlZUFtb3VudChhbW91bnQpOwogICAgICAgIHJldHVybiBzYWZlU3ViKGFtb3VudCwgZmVlQW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGhlbHBlciwgZGlzcGF0Y2hlcyB0aGUgQ29udmVyc2lvbiBldmVudAogICAgICAgIFRoZSBmdW5jdGlvbiBhbHNvIHRha2VzIHRoZSB0b2tlbnMnIGRlY2ltYWxzIGludG8gYWNjb3VudCB3aGVuIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHByaWNlCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgICAgICAgYW1vdW50IHB1cmNoYXNlZC9zb2xkIChpbiB0aGUgc291cmNlIHRva2VuKQogICAgICAgIEBwYXJhbSBfcmV0dXJuQW1vdW50ICAgIGFtb3VudCByZXR1cm5lZCAoaW4gdGhlIHRhcmdldCB0b2tlbikKICAgICAgICBAcGFyYW0gaXNQdXJjaGFzZSAgICAgICB0cnVlIGlmIGl0J3MgYSBwdXJjaGFzZSwgZmFsc2UgaWYgaXQncyBhIHNhbGUKICAgICovCiAgICBmdW5jdGlvbiBkaXNwYXRjaENvbnZlcnNpb25FdmVudChJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfcmV0dXJuQW1vdW50LCBib29sIGlzUHVyY2hhc2UpIHByaXZhdGUgewogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKCiAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBuZXcgcHJpY2UgdXNpbmcgdGhlIHNpbXBsZSBwcmljZSBmb3JtdWxhCiAgICAgICAgLy8gcHJpY2UgPSBjb25uZWN0b3IgYmFsYW5jZSAvIChzdXBwbHkgKiB3ZWlnaHQpCiAgICAgICAgLy8gd2VpZ2h0IGlzIHJlcHJlc2VudGVkIGluIHBwbSwgc28gbXVsdGlwbHlpbmcgYnkgMTAwMDAwMAogICAgICAgIHVpbnQyNTYgY29ubmVjdG9yQW1vdW50ID0gc2FmZU11bChnZXRDb25uZWN0b3JCYWxhbmNlKF9jb25uZWN0b3JUb2tlbiksIE1BWF9XRUlHSFQpOwogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBzYWZlTXVsKHRva2VuLnRvdGFsU3VwcGx5KCksIGNvbm5lY3Rvci53ZWlnaHQpOwoKICAgICAgICAvLyBub3JtYWxpemUgdmFsdWVzCiAgICAgICAgdWludDggdG9rZW5EZWNpbWFscyA9IHRva2VuLmRlY2ltYWxzKCk7CiAgICAgICAgdWludDggY29ubmVjdG9yVG9rZW5EZWNpbWFscyA9IF9jb25uZWN0b3JUb2tlbi5kZWNpbWFscygpOwogICAgICAgIGlmICh0b2tlbkRlY2ltYWxzICE9IGNvbm5lY3RvclRva2VuRGVjaW1hbHMpIHsKICAgICAgICAgICAgaWYgKHRva2VuRGVjaW1hbHMgPiBjb25uZWN0b3JUb2tlbkRlY2ltYWxzKQogICAgICAgICAgICAgICAgY29ubmVjdG9yQW1vdW50ID0gc2FmZU11bChjb25uZWN0b3JBbW91bnQsIDEwICoqIHVpbnQyNTYodG9rZW5EZWNpbWFscyAtIGNvbm5lY3RvclRva2VuRGVjaW1hbHMpKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgdG9rZW5BbW91bnQgPSBzYWZlTXVsKHRva2VuQW1vdW50LCAxMCAqKiB1aW50MjU2KGNvbm5lY3RvclRva2VuRGVjaW1hbHMgLSB0b2tlbkRlY2ltYWxzKSk7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IGZlZUFtb3VudCA9IGdldENvbnZlcnNpb25GZWVBbW91bnQoX3JldHVybkFtb3VudCk7CiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIGZlZSBpcyBjYXBwZWQgYXQgMjU1IGJpdHMgdG8gcHJldmVudCBvdmVyZmxvdyB3aGVuIGNvbnZlcnRpbmcgaXQgdG8gYSBzaWduZWQgaW50CiAgICAgICAgYXNzZXJ0KGZlZUFtb3VudCA8PSAyICoqIDI1NSk7CgogICAgICAgIGlmIChpc1B1cmNoYXNlKQogICAgICAgICAgICBDb252ZXJzaW9uKF9jb25uZWN0b3JUb2tlbiwgdG9rZW4sIG1zZy5zZW5kZXIsIF9hbW91bnQsIF9yZXR1cm5BbW91bnQsIGludDI1NihmZWVBbW91bnQpLCBjb25uZWN0b3JBbW91bnQsIHRva2VuQW1vdW50KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIENvbnZlcnNpb24odG9rZW4sIF9jb25uZWN0b3JUb2tlbiwgbXNnLnNlbmRlciwgX2Ftb3VudCwgX3JldHVybkFtb3VudCwgaW50MjU2KGZlZUFtb3VudCksIHRva2VuQW1vdW50LCBjb25uZWN0b3JBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZmFsbGJhY2ssIGJ1eXMgdGhlIHNtYXJ0IHRva2VuIHdpdGggRVRICiAgICAgICAgbm90ZSB0aGF0IHRoZSBwdXJjaGFzZSB3aWxsIHVzZSB0aGUgcHJpY2UgYXQgdGhlIHRpbWUgb2YgdGhlIHB1cmNoYXNlCiAgICAqLwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgcXVpY2tDb252ZXJ0KHF1aWNrQnV5UGF0aCwgbXNnLnZhbHVlLCAxKTsKICAgIH0KfQoKY29udHJhY3QgQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyBpcyBJQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucywgVG9rZW5Ib2xkZXIgewogICAgSUJhbmNvckZvcm11bGEgcHVibGljIGZvcm11bGE7ICAvLyBiYW5jb3IgY2FsY3VsYXRpb24gZm9ybXVsYSBjb250cmFjdAogICAgSUJhbmNvckdhc1ByaWNlTGltaXQgcHVibGljIGdhc1ByaWNlTGltaXQ7IC8vIGJhbmNvciB1bml2ZXJzYWwgZ2FzIHByaWNlIGxpbWl0IGNvbnRyYWN0CiAgICBJQmFuY29yUXVpY2tDb252ZXJ0ZXIgcHVibGljIHF1aWNrQ29udmVydGVyOyAvLyBiYW5jb3IgcXVpY2sgY29udmVydGVyIGNvbnRyYWN0CgogICAgLyoqCiAgICAgICAgQGRldiBjb25zdHJ1Y3RvcgoKICAgICAgICBAcGFyYW0gX2Zvcm11bGEgICAgICAgICBhZGRyZXNzIG9mIGEgYmFuY29yIGZvcm11bGEgY29udHJhY3QKICAgICAgICBAcGFyYW0gX2dhc1ByaWNlTGltaXQgICBhZGRyZXNzIG9mIGEgYmFuY29yIGdhcyBwcmljZSBsaW1pdCBjb250cmFjdAogICAgICAgIEBwYXJhbSBfcXVpY2tDb252ZXJ0ZXIgIGFkZHJlc3Mgb2YgYSBiYW5jb3IgcXVpY2sgY29udmVydGVyIGNvbnRyYWN0CiAgICAqLwogICAgZnVuY3Rpb24gQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyhJQmFuY29yRm9ybXVsYSBfZm9ybXVsYSwgSUJhbmNvckdhc1ByaWNlTGltaXQgX2dhc1ByaWNlTGltaXQsIElCYW5jb3JRdWlja0NvbnZlcnRlciBfcXVpY2tDb252ZXJ0ZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgdmFsaWRBZGRyZXNzKF9mb3JtdWxhKQogICAgICAgIHZhbGlkQWRkcmVzcyhfZ2FzUHJpY2VMaW1pdCkKICAgICAgICB2YWxpZEFkZHJlc3MoX3F1aWNrQ29udmVydGVyKQogICAgewogICAgICAgIGZvcm11bGEgPSBfZm9ybXVsYTsKICAgICAgICBnYXNQcmljZUxpbWl0ID0gX2dhc1ByaWNlTGltaXQ7CiAgICAgICAgcXVpY2tDb252ZXJ0ZXIgPSBfcXVpY2tDb252ZXJ0ZXI7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IGFsbG93cyB0aGUgb3duZXIgdG8gdXBkYXRlIHRoZSBmb3JtdWxhIGNvbnRyYWN0IGFkZHJlc3MKCiAgICAgICAgQHBhcmFtIF9mb3JtdWxhICAgIGFkZHJlc3Mgb2YgYSBiYW5jb3IgZm9ybXVsYSBjb250cmFjdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldEZvcm11bGEoSUJhbmNvckZvcm11bGEgX2Zvcm11bGEpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF9mb3JtdWxhKQogICAgICAgIG5vdFRoaXMoX2Zvcm11bGEpCiAgICB7CiAgICAgICAgZm9ybXVsYSA9IF9mb3JtdWxhOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG93bmVyIHRvIHVwZGF0ZSB0aGUgZ2FzIHByaWNlIGxpbWl0IGNvbnRyYWN0IGFkZHJlc3MKCiAgICAgICAgQHBhcmFtIF9nYXNQcmljZUxpbWl0ICAgYWRkcmVzcyBvZiBhIGJhbmNvciBnYXMgcHJpY2UgbGltaXQgY29udHJhY3QKICAgICovCiAgICBmdW5jdGlvbiBzZXRHYXNQcmljZUxpbWl0KElCYW5jb3JHYXNQcmljZUxpbWl0IF9nYXNQcmljZUxpbWl0KQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQWRkcmVzcyhfZ2FzUHJpY2VMaW1pdCkKICAgICAgICBub3RUaGlzKF9nYXNQcmljZUxpbWl0KQogICAgewogICAgICAgIGdhc1ByaWNlTGltaXQgPSBfZ2FzUHJpY2VMaW1pdDsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgYWxsb3dzIHRoZSBvd25lciB0byB1cGRhdGUgdGhlIHF1aWNrIGNvbnZlcnRlciBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEBwYXJhbSBfcXVpY2tDb252ZXJ0ZXIgIGFkZHJlc3Mgb2YgYSBiYW5jb3IgcXVpY2sgY29udmVydGVyIGNvbnRyYWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2V0UXVpY2tDb252ZXJ0ZXIoSUJhbmNvclF1aWNrQ29udmVydGVyIF9xdWlja0NvbnZlcnRlcikKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZEFkZHJlc3MoX3F1aWNrQ29udmVydGVyKQogICAgICAgIG5vdFRoaXMoX3F1aWNrQ29udmVydGVyKQogICAgewogICAgICAgIHF1aWNrQ29udmVydGVyID0gX3F1aWNrQ29udmVydGVyOwogICAgfQp9Cgpjb250cmFjdCBCYW5jb3JGb3JtdWxhIGlzIElCYW5jb3JGb3JtdWxhLCBVdGlscyB7CiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC4zJzsKCiAgICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgT05FID0gMTsKICAgIHVpbnQzMiBwcml2YXRlIGNvbnN0YW50IE1BWF9XRUlHSFQgPSAxMDAwMDAwOwogICAgdWludDggcHJpdmF0ZSBjb25zdGFudCBNSU5fUFJFQ0lTSU9OID0gMzI7CiAgICB1aW50OCBwcml2YXRlIGNvbnN0YW50IE1BWF9QUkVDSVNJT04gPSAxMjc7CgogICAgLyoqCiAgICAgICAgVGhlIHZhbHVlcyBiZWxvdyBkZXBlbmQgb24gTUFYX1BSRUNJU0lPTi4gSWYgeW91IGNob29zZSB0byBjaGFuZ2UgaXQ6CiAgICAgICAgQXBwbHkgdGhlIHNhbWUgY2hhbmdlIGluIGZpbGUgJ1ByaW50SW50U2NhbGluZ0ZhY3RvcnMucHknLCBydW4gaXQgYW5kIHBhc3RlIHRoZSByZXN1bHRzIGJlbG93LgogICAgKi8KICAgIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBGSVhFRF8xID0gMHgwODAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgRklYRURfMiA9IDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IE1BWF9OVU0gPSAweDFmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKCiAgICAvKioKICAgICAgICBUaGUgdmFsdWVzIGJlbG93IGRlcGVuZCBvbiBNQVhfUFJFQ0lTSU9OLiBJZiB5b3UgY2hvb3NlIHRvIGNoYW5nZSBpdDoKICAgICAgICBBcHBseSB0aGUgc2FtZSBjaGFuZ2UgaW4gZmlsZSAnUHJpbnRMbjJTY2FsaW5nRmFjdG9ycy5weScsIHJ1biBpdCBhbmQgcGFzdGUgdGhlIHJlc3VsdHMgYmVsb3cuCiAgICAqLwogICAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IExOMl9OVU1FUkFUT1IgICA9IDB4M2Y4MGZlMDNmODBmZTAzZjgwZmUwM2Y4MGZlMDNmODsKICAgIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBMTjJfREVOT01JTkFUT1IgPSAweDViOWRlMWQxMGJmNDEwM2Q2NDdiMDk1NTg5N2JhODA7CgogICAgLyoqCiAgICAgICAgVGhlIHZhbHVlcyBiZWxvdyBkZXBlbmQgb24gTUlOX1BSRUNJU0lPTiBhbmQgTUFYX1BSRUNJU0lPTi4gSWYgeW91IGNob29zZSB0byBjaGFuZ2UgZWl0aGVyIG9uZSBvZiB0aGVtOgogICAgICAgIEFwcGx5IHRoZSBzYW1lIGNoYW5nZSBpbiBmaWxlICdQcmludEZ1bmN0aW9uQmFuY29yRm9ybXVsYS5weScsIHJ1biBpdCBhbmQgcGFzdGUgdGhlIHJlc3VsdHMgYmVsb3cuCiAgICAqLwogICAgdWludDI1NlsxMjhdIHByaXZhdGUgbWF4RXhwQXJyYXk7CgogICAgZnVuY3Rpb24gQmFuY29yRm9ybXVsYSgpIHB1YmxpYyB7CiAgICAvLyAgbWF4RXhwQXJyYXlbICAwXSA9IDB4NmJmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgIDFdID0gMHg2N2ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAgMl0gPSAweDYzN2ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbICAzXSA9IDB4NWY2ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgIDRdID0gMHg1Yjc3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAgNV0gPSAweDU3YjNmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbICA2XSA9IDB4NTQxOWZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgIDddID0gMHg1MGEyZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAgOF0gPSAweDRkNTE3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbICA5XSA9IDB4NGEyMzNmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgMTBdID0gMHg0NzE2NWZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAxMV0gPSAweDQ0MjlhZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbIDEyXSA9IDB4NDE1YmM3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgMTNdID0gMHgzZWFiNzNmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAxNF0gPSAweDNjMTc3MWZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbIDE1XSA9IDB4Mzk5ZTk2ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgMTZdID0gMHgzNzNmYzQ3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAxN10gPSAweDM0ZjllOGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbIDE4XSA9IDB4MzJjYmZkNWZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgMTldID0gMHgzMGI1MDU3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAyMF0gPSAweDJlYjQwZjlmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbIDIxXSA9IDB4MmNjODM0MGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgMjJdID0gMHgyYWYwOTQ4MWZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAyM10gPSAweDI5MmM1YmRkZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbIDI0XSA9IDB4Mjc3YWJkY2RmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgMjVdID0gMHgyNWRhZjY2NTdmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAyNl0gPSAweDI0NGM0OWM2NWZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbIDI3XSA9IDB4MjJjZTAzY2Q1ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgMjhdID0gMHgyMTVmNzdjMDQ3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgLy8gIG1heEV4cEFycmF5WyAyOV0gPSAweDFmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAvLyAgbWF4RXhwQXJyYXlbIDMwXSA9IDB4MWVhZWZkYmRhYmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgIC8vICBtYXhFeHBBcnJheVsgMzFdID0gMHgxZDZiZDhiMmViZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyAzMl0gPSAweDFjMzVmZWRkMTRmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDMzXSA9IDB4MWIwY2U0M2IzMjNmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgMzRdID0gMHgxOWYwMDI4ZWMxZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyAzNV0gPSAweDE4ZGVkOTFmMGU3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDM2XSA9IDB4MTdkOGVjN2YwNDE3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgMzddID0gMHgxNmRkYzY1NTZjZGJmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyAzOF0gPSAweDE1ZWNmNTI3NzZhMWZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDM5XSA9IDB4MTUwNjBjMjU2Y2IyZmZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNDBdID0gMHgxNDI4YTJmOThkNzJmZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA0MV0gPSAweDEzNTQ1NTk4ZTVjMjNmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDQyXSA9IDB4MTI4OGM0MTYxY2UxZGZmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNDNdID0gMHgxMWM1OTI3NjFjNjY2ZmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA0NF0gPSAweDExMGE2ODg2ODBhNzU3ZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDQ1XSA9IDB4MTA1NmYxYjViZWRmNzdmZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNDZdID0gMHgwZmFhZGNlY2VlZmY4YmZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA0N10gPSAweDBmMDVkYzZiMjdlZGFkZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDQ4XSA9IDB4MGU2N2E1YTI1ZGE0MTA3ZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNDldID0gMHgwZGNmZjExNWIxNGVlZGZmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA1MF0gPSAweDBkM2U3YTM5MjQzMTIzOWZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDUxXSA9IDB4MGNiMmZmNTI5ZWI3MWU0ZmZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNTJdID0gMHgwYzJkNDE1YzNkYjk3NGFmZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA1M10gPSAweDBiYWQwM2U3ZDg4M2Y2OWJmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDU0XSA9IDB4MGIzMjBkMDNiMmMzNDNkNWZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNTVdID0gMHgwYWJjMjUyMDRlMDI4MjhkZmZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA1Nl0gPSAweDBhNGIxNmY3NGVlNGJiMjA3ZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDU3XSA9IDB4MDlkZWFmNzM2YWMxZjU2OWZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNThdID0gMHgwOTc2YmQ5OTUyYzdhYTk1N2ZmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA1OV0gPSAweDA5MTMxMjcxOTIyZWFhNjA2ZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDYwXSA9IDB4MDhiMzgwZjM1NTg2NjhjNDZmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNjFdID0gMHgwODU3ZGRmMDExN2VmYTIxNWJmZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA2Ml0gPSAweDA3ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDYzXSA9IDB4MDdhYmJmNmY2YWJiOWQwODdmZmZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNjRdID0gMHgwNzVhZjYyY2JhYzk1ZjdkZmE3ZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA2NV0gPSAweDA3MGQ3ZmI3NDUyZTE4N2FjMTNmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDY2XSA9IDB4MDZjMzM5MGVjYzhhZjM3OTI5NWZmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNjddID0gMHgwNjdjMDBhM2IwN2ZmYzAxZmQ2ZmZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA2OF0gPSAweDA2MzdiNjQ3YzM5Y2JiOWQzZDI3ZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDY5XSA9IDB4MDVmNjNiMWZjMTA0ZGJkMzk1ODdmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNzBdID0gMHgwNWI3NzE5NTViMzZlMTJmNzIzNWZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA3MV0gPSAweDA1N2IzZDQ5ZGRhODQ1NTZkNmY2ZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDcyXSA9IDB4MDU0MTgzMDk1YjJjOGVjZWNmMzBmZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNzNdID0gMHgwNTBhMjhiZTYzNWNhMmI4ODhmNzdmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA3NF0gPSAweDA0ZDUxNTY2Mzk3MDhjOWRiMzNjM2ZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDc1XSA9IDB4MDRhMjMxMDU4NzM4NzViZDUyZGZkZmZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNzZdID0gMHgwNDcxNjQ5ZDg3MTk5YWE5OTA3NTZmZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA3N10gPSAweDA0NDI5YTIxYTAyOWQ0YzE0NTdjZmJmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDc4XSA9IDB4MDQxNWJjNmQ2ZmI3ZGQ3MWFmMmNiM2ZmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgNzldID0gMHgwM2VhYjczYjNiYmZlMjgyMjQzY2UxZmZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA4MF0gPSAweDAzYzE3NzFhYzlmYjZiNGMxOGUyMjlmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDgxXSA9IDB4MDM5OWU5Njg5NzY5MDQxOGY3ODUyNTdmZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgODJdID0gMHgwMzczZmM0NTZjNTNiYjc3OWJmMGVhOWZmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA4M10gPSAweDAzNGY5ZThlNDkwYzQ4ZTY3ZTZhYjhiZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDg0XSA9IDB4MDMyY2JmZDRhN2FkYzc5MDU2MGIzMzM3ZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgODVdID0gMHgwMzBiNTA1NzBmNmU1ZDJhY2NhOTQ2MTNmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA4Nl0gPSAweDAyZWI0MGY5ZjYyMGZkYTZiNTZjMjg2MWZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDg3XSA9IDB4MDJjYzgzNDBlY2IwZDBmNTIwYTZhZjU4ZmZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgODhdID0gMHgwMmFmMDk0ODEzODBhMGEzNWNmMWJhMDJmZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA4OV0gPSAweDAyOTJjNWJkZDNiOTJlYzgxMDI4N2IxYjNmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDkwXSA9IDB4MDI3N2FiZGNkYWIwN2Q1YTc3YWM2ZDZiOWZmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgOTFdID0gMHgwMjVkYWY2NjU0YjFlYWE1NWZkNjRkZjVlZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA5Ml0gPSAweDAyNDRjNDljNjQ4YmFhOTgxOTJkY2U4OGI3ZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDkzXSA9IDB4MDIyY2UwM2NkNTYxOWEzMTFiMjQ3MTI2OGJmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgOTRdID0gMHgwMjE1Zjc3YzA0NWZiZTg4NTY1NGE0NGEwZmZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA5NV0gPSAweDAxZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDk2XSA9IDB4MDFlYWVmZGJkYWFlZTc0MjFmYzRkM2VkZTVmZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsgOTddID0gMHgwMWQ2YmQ4YjJlYjI1N2RmN2U4Y2E1N2IwOWJmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WyA5OF0gPSAweDAxYzM1ZmVkZDE0Yjg2MWViMDQ0M2Y3ZjEzM2ZmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbIDk5XSA9IDB4MDFiMGNlNDNiMzIyYmNkZTRhNTZlOGFkYTVhZmZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsxMDBdID0gMHgwMTlmMDAyOGVjMWZmZjAwN2Y1YTE5NWEzOWRmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WzEwMV0gPSAweDAxOGRlZDkxZjBlNzJlZTc0ZjQ5YjE1YmE1MjdmZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTAyXSA9IDB4MDE3ZDhlYzdmMDQxMzZmNGU1NjE1ZmQ0MWE2M2ZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsxMDNdID0gMHgwMTZkZGM2NTU2Y2RiODRiZGM4ZDEyZDIyZTZmZmZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WzEwNF0gPSAweDAxNWVjZjUyNzc2YTExNTViNWJkODM5NTgxNGY3ZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTA1XSA9IDB4MDE1MDYwYzI1NmNiMjNiM2IzY2MzNzU0Y2Y0MGZmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsxMDZdID0gMHgwMTQyOGEyZjk4ZDcyOGFlMjIzZGRhYjcxNWJlM2ZmZmZmOwogICAgICAgIG1heEV4cEFycmF5WzEwN10gPSAweDAxMzU0NTU5OGU1YzIzMjc2Y2NmMGVkZTY4MDM0ZmZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTA4XSA9IDB4MDEyODhjNDE2MWNlMWQ2ZjU0YjdmNjEwODExOTRmZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsxMDldID0gMHgwMTFjNTkyNzYxYzY2NmFhNjQxZDVhMDFhNDBmMTdmZmZmOwogICAgICAgIG1heEV4cEFycmF5WzExMF0gPSAweDAxMTBhNjg4NjgwYTc1MzA1MTVmM2U2ZTZjZmRjZGZmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTExXSA9IDB4MDEwNTZmMWI1YmVkZjc1YzZiY2IyY2U4YWVkNDI4ZmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsxMTJdID0gMHgwMGZhYWRjZWNlZWZmOGEwODkwZjM4NzVmMDA4Mjc3ZmZmOwogICAgICAgIG1heEV4cEFycmF5WzExM10gPSAweDAwZjA1ZGM2YjI3ZWRhZDMwNjM4OGE2MDBmNmJhMGJmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTE0XSA9IDB4MDBlNjdhNWEyNWRhNDEwNjNkZTE0OTVkNWIxOGNkYmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsxMTVdID0gMHgwMGRjZmYxMTViMTRlZWRkZTZmYzNhYTUzNTNmMmU0ZmZmOwogICAgICAgIG1heEV4cEFycmF5WzExNl0gPSAweDAwZDNlN2EzOTI0MzEyMzk5ZjlhYWUyZTBmODY4ZjhmZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTE3XSA9IDB4MDBjYjJmZjUyOWViNzFlNDE1ODJjY2NkNWExZWUyNmZmZjsKICAgICAgICBtYXhFeHBBcnJheVsxMThdID0gMHgwMGMyZDQxNWMzZGI5NzRhYjMyYTUxODQwYzBiNjdlZGZmOwogICAgICAgIG1heEV4cEFycmF5WzExOV0gPSAweDAwYmFkMDNlN2Q4ODNmNjlhZDViMGExODYxODRlMDZiZmY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTIwXSA9IDB4MDBiMzIwZDAzYjJjMzQzZDQ4MjlhYmQ2MDc1ZjBjYzVmZjsKICAgICAgICBtYXhFeHBBcnJheVsxMjFdID0gMHgwMGFiYzI1MjA0ZTAyODI4ZDczYzZlODBiY2RiMWE5NWJmOwogICAgICAgIG1heEV4cEFycmF5WzEyMl0gPSAweDAwYTRiMTZmNzRlZTRiYjIwNDBhMWVjNmMxNWZiYmYyZGY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTIzXSA9IDB4MDA5ZGVhZjczNmFjMWY1NjlkZWIxYjVhZTNmMzZjMTMwZjsKICAgICAgICBtYXhFeHBBcnJheVsxMjRdID0gMHgwMDk3NmJkOTk1MmM3YWE5NTdmNTkzN2Q3OTBlZjY1MDM3OwogICAgICAgIG1heEV4cEFycmF5WzEyNV0gPSAweDAwOTEzMTI3MTkyMmVhYTYwNjRiNzNhMjJkMGJkNGYyYmY7CiAgICAgICAgbWF4RXhwQXJyYXlbMTI2XSA9IDB4MDA4YjM4MGYzNTU4NjY4YzQ2YzkxYzQ5YTJmOGU5NjdiOTsKICAgICAgICBtYXhFeHBBcnJheVsxMjddID0gMHgwMDg1N2RkZjAxMTdlZmEyMTU5NTI5MTI4MzlmNjQ3M2U2OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZ2l2ZW4gYSB0b2tlbiBzdXBwbHksIGNvbm5lY3RvciBiYWxhbmNlLCB3ZWlnaHQgYW5kIGEgZGVwb3NpdCBhbW91bnQgKGluIHRoZSBjb25uZWN0b3IgdG9rZW4pLAogICAgICAgIGNhbGN1bGF0ZXMgdGhlIHJldHVybiBmb3IgYSBnaXZlbiBjb252ZXJzaW9uIChpbiB0aGUgbWFpbiB0b2tlbikKCiAgICAgICAgRm9ybXVsYToKICAgICAgICBSZXR1cm4gPSBfc3VwcGx5ICogKCgxICsgX2RlcG9zaXRBbW91bnQgLyBfY29ubmVjdG9yQmFsYW5jZSkgXiAoX2Nvbm5lY3RvcldlaWdodCAvIDEwMDAwMDApIC0gMSkKCiAgICAgICAgQHBhcmFtIF9zdXBwbHkgICAgICAgICAgICAgIHRva2VuIHRvdGFsIHN1cHBseQogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yQmFsYW5jZSAgICB0b3RhbCBjb25uZWN0b3IgYmFsYW5jZQogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yV2VpZ2h0ICAgICBjb25uZWN0b3Igd2VpZ2h0LCByZXByZXNlbnRlZCBpbiBwcG0sIDEtMTAwMDAwMAogICAgICAgIEBwYXJhbSBfZGVwb3NpdEFtb3VudCAgICAgICBkZXBvc2l0IGFtb3VudCwgaW4gY29ubmVjdG9yIHRva2VuCgogICAgICAgIEByZXR1cm4gcHVyY2hhc2UgcmV0dXJuIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVB1cmNoYXNlUmV0dXJuKHVpbnQyNTYgX3N1cHBseSwgdWludDI1NiBfY29ubmVjdG9yQmFsYW5jZSwgdWludDMyIF9jb25uZWN0b3JXZWlnaHQsIHVpbnQyNTYgX2RlcG9zaXRBbW91bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyB2YWxpZGF0ZSBpbnB1dAogICAgICAgIHJlcXVpcmUoX3N1cHBseSA+IDAgJiYgX2Nvbm5lY3RvckJhbGFuY2UgPiAwICYmIF9jb25uZWN0b3JXZWlnaHQgPiAwICYmIF9jb25uZWN0b3JXZWlnaHQgPD0gTUFYX1dFSUdIVCk7CgogICAgICAgIC8vIHNwZWNpYWwgY2FzZSBmb3IgMCBkZXBvc2l0IGFtb3VudAogICAgICAgIGlmIChfZGVwb3NpdEFtb3VudCA9PSAwKQogICAgICAgICAgICByZXR1cm4gMDsKCiAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGlmIHRoZSB3ZWlnaHQgPSAxMDAlCiAgICAgICAgaWYgKF9jb25uZWN0b3JXZWlnaHQgPT0gTUFYX1dFSUdIVCkKICAgICAgICAgICAgcmV0dXJuIHNhZmVNdWwoX3N1cHBseSwgX2RlcG9zaXRBbW91bnQpIC8gX2Nvbm5lY3RvckJhbGFuY2U7CgogICAgICAgIHVpbnQyNTYgcmVzdWx0OwogICAgICAgIHVpbnQ4IHByZWNpc2lvbjsKICAgICAgICB1aW50MjU2IGJhc2VOID0gc2FmZUFkZChfZGVwb3NpdEFtb3VudCwgX2Nvbm5lY3RvckJhbGFuY2UpOwogICAgICAgIChyZXN1bHQsIHByZWNpc2lvbikgPSBwb3dlcihiYXNlTiwgX2Nvbm5lY3RvckJhbGFuY2UsIF9jb25uZWN0b3JXZWlnaHQsIE1BWF9XRUlHSFQpOwogICAgICAgIHVpbnQyNTYgdGVtcCA9IHNhZmVNdWwoX3N1cHBseSwgcmVzdWx0KSA+PiBwcmVjaXNpb247CiAgICAgICAgcmV0dXJuIHRlbXAgLSBfc3VwcGx5OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZ2l2ZW4gYSB0b2tlbiBzdXBwbHksIGNvbm5lY3RvciBiYWxhbmNlLCB3ZWlnaHQgYW5kIGEgc2VsbCBhbW91bnQgKGluIHRoZSBtYWluIHRva2VuKSwKICAgICAgICBjYWxjdWxhdGVzIHRoZSByZXR1cm4gZm9yIGEgZ2l2ZW4gY29udmVyc2lvbiAoaW4gdGhlIGNvbm5lY3RvciB0b2tlbikKCiAgICAgICAgRm9ybXVsYToKICAgICAgICBSZXR1cm4gPSBfY29ubmVjdG9yQmFsYW5jZSAqICgxIC0gKDEgLSBfc2VsbEFtb3VudCAvIF9zdXBwbHkpIF4gKDEgLyAoX2Nvbm5lY3RvcldlaWdodCAvIDEwMDAwMDApKSkKCiAgICAgICAgQHBhcmFtIF9zdXBwbHkgICAgICAgICAgICAgIHRva2VuIHRvdGFsIHN1cHBseQogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yQmFsYW5jZSAgICB0b3RhbCBjb25uZWN0b3IKICAgICAgICBAcGFyYW0gX2Nvbm5lY3RvcldlaWdodCAgICAgY29uc3RhbnQgY29ubmVjdG9yIFdlaWdodCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX3NlbGxBbW91bnQgICAgICAgICAgc2VsbCBhbW91bnQsIGluIHRoZSB0b2tlbiBpdHNlbGYKCiAgICAgICAgQHJldHVybiBzYWxlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVTYWxlUmV0dXJuKHVpbnQyNTYgX3N1cHBseSwgdWludDI1NiBfY29ubmVjdG9yQmFsYW5jZSwgdWludDMyIF9jb25uZWN0b3JXZWlnaHQsIHVpbnQyNTYgX3NlbGxBbW91bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyB2YWxpZGF0ZSBpbnB1dAogICAgICAgIHJlcXVpcmUoX3N1cHBseSA+IDAgJiYgX2Nvbm5lY3RvckJhbGFuY2UgPiAwICYmIF9jb25uZWN0b3JXZWlnaHQgPiAwICYmIF9jb25uZWN0b3JXZWlnaHQgPD0gTUFYX1dFSUdIVCAmJiBfc2VsbEFtb3VudCA8PSBfc3VwcGx5KTsKCiAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGZvciAwIHNlbGwgYW1vdW50CiAgICAgICAgaWYgKF9zZWxsQW1vdW50ID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwoKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgZm9yIHNlbGxpbmcgdGhlIGVudGlyZSBzdXBwbHkKICAgICAgICBpZiAoX3NlbGxBbW91bnQgPT0gX3N1cHBseSkKICAgICAgICAgICAgcmV0dXJuIF9jb25uZWN0b3JCYWxhbmNlOwoKICAgICAgICAvLyBzcGVjaWFsIGNhc2UgaWYgdGhlIHdlaWdodCA9IDEwMCUKICAgICAgICBpZiAoX2Nvbm5lY3RvcldlaWdodCA9PSBNQVhfV0VJR0hUKQogICAgICAgICAgICByZXR1cm4gc2FmZU11bChfY29ubmVjdG9yQmFsYW5jZSwgX3NlbGxBbW91bnQpIC8gX3N1cHBseTsKCiAgICAgICAgdWludDI1NiByZXN1bHQ7CiAgICAgICAgdWludDggcHJlY2lzaW9uOwogICAgICAgIHVpbnQyNTYgYmFzZUQgPSBfc3VwcGx5IC0gX3NlbGxBbW91bnQ7CiAgICAgICAgKHJlc3VsdCwgcHJlY2lzaW9uKSA9IHBvd2VyKF9zdXBwbHksIGJhc2VELCBNQVhfV0VJR0hULCBfY29ubmVjdG9yV2VpZ2h0KTsKICAgICAgICB1aW50MjU2IHRlbXAxID0gc2FmZU11bChfY29ubmVjdG9yQmFsYW5jZSwgcmVzdWx0KTsKICAgICAgICB1aW50MjU2IHRlbXAyID0gX2Nvbm5lY3RvckJhbGFuY2UgPDwgcHJlY2lzaW9uOwogICAgICAgIHJldHVybiAodGVtcDEgLSB0ZW1wMikgLyByZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgICAgR2VuZXJhbCBEZXNjcmlwdGlvbjoKICAgICAgICAgICAgRGV0ZXJtaW5lIGEgdmFsdWUgb2YgcHJlY2lzaW9uLgogICAgICAgICAgICBDYWxjdWxhdGUgYW4gaW50ZWdlciBhcHByb3hpbWF0aW9uIG9mIChfYmFzZU4gLyBfYmFzZUQpIF4gKF9leHBOIC8gX2V4cEQpICogMiBeIHByZWNpc2lvbi4KICAgICAgICAgICAgUmV0dXJuIHRoZSByZXN1bHQgYWxvbmcgd2l0aCB0aGUgcHJlY2lzaW9uIHVzZWQuCgogICAgICAgIERldGFpbGVkIERlc2NyaXB0aW9uOgogICAgICAgICAgICBJbnN0ZWFkIG9mIGNhbGN1bGF0aW5nICJiYXNlIF4gZXhwIiwgd2UgY2FsY3VsYXRlICJlIF4gKGxuKGJhc2UpICogZXhwKSIuCiAgICAgICAgICAgIFRoZSB2YWx1ZSBvZiAibG4oYmFzZSkiIGlzIHJlcHJlc2VudGVkIHdpdGggYW4gaW50ZWdlciBzbGlnaHRseSBzbWFsbGVyIHRoYW4gImxuKGJhc2UpICogMiBeIHByZWNpc2lvbiIuCiAgICAgICAgICAgIFRoZSBsYXJnZXIgInByZWNpc2lvbiIgaXMsIHRoZSBtb3JlIGFjY3VyYXRlbHkgdGhpcyB2YWx1ZSByZXByZXNlbnRzIHRoZSByZWFsIHZhbHVlLgogICAgICAgICAgICBIb3dldmVyLCB0aGUgbGFyZ2VyICJwcmVjaXNpb24iIGlzLCB0aGUgbW9yZSBiaXRzIGFyZSByZXF1aXJlZCBpbiBvcmRlciB0byBzdG9yZSB0aGlzIHZhbHVlLgogICAgICAgICAgICBBbmQgdGhlIGV4cG9uZW50aWF0aW9uIGZ1bmN0aW9uLCB3aGljaCB0YWtlcyAieCIgYW5kIGNhbGN1bGF0ZXMgImUgXiB4IiwgaXMgbGltaXRlZCB0byBhIG1heGltdW0gZXhwb25lbnQgKG1heGltdW0gdmFsdWUgb2YgIngiKS4KICAgICAgICAgICAgVGhpcyBtYXhpbXVtIGV4cG9uZW50IGRlcGVuZHMgb24gdGhlICJwcmVjaXNpb24iIHVzZWQsIGFuZCBpdCBpcyBnaXZlbiBieSAibWF4RXhwQXJyYXlbcHJlY2lzaW9uXSA+PiAoTUFYX1BSRUNJU0lPTiAtIHByZWNpc2lvbikiLgogICAgICAgICAgICBIZW5jZSB3ZSBuZWVkIHRvIGRldGVybWluZSB0aGUgaGlnaGVzdCBwcmVjaXNpb24gd2hpY2ggY2FuIGJlIHVzZWQgZm9yIHRoZSBnaXZlbiBpbnB1dCwgYmVmb3JlIGNhbGxpbmcgdGhlIGV4cG9uZW50aWF0aW9uIGZ1bmN0aW9uLgogICAgICAgICAgICBUaGlzIGFsbG93cyB1cyB0byBjb21wdXRlICJiYXNlIF4gZXhwIiB3aXRoIG1heGltdW0gYWNjdXJhY3kgYW5kIHdpdGhvdXQgZXhjZWVkaW5nIDI1NiBiaXRzIGluIGFueSBvZiB0aGUgaW50ZXJtZWRpYXRlIGNvbXB1dGF0aW9ucy4KICAgICAgICAgICAgVGhpcyBmdW5jdGlvbnMgYXNzdW1lcyB0aGF0ICJfZXhwTiA8ICgxIDw8IDI1NikgLyBsbihNQVhfTlVNLCAxKSIsIG90aGVyd2lzZSB0aGUgbXVsdGlwbGljYXRpb24gc2hvdWxkIGJlIHJlcGxhY2VkIHdpdGggYSAic2FmZU11bCIuCiAgICAqLwogICAgZnVuY3Rpb24gcG93ZXIodWludDI1NiBfYmFzZU4sIHVpbnQyNTYgX2Jhc2VELCB1aW50MzIgX2V4cE4sIHVpbnQzMiBfZXhwRCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2LCB1aW50OCkgewogICAgICAgIHVpbnQyNTYgbG5CYXNlVGltZXNFeHAgPSBsbihfYmFzZU4sIF9iYXNlRCkgKiBfZXhwTiAvIF9leHBEOwogICAgICAgIHVpbnQ4IHByZWNpc2lvbiA9IGZpbmRQb3NpdGlvbkluTWF4RXhwQXJyYXkobG5CYXNlVGltZXNFeHApOwogICAgICAgIHJldHVybiAoZml4ZWRFeHAobG5CYXNlVGltZXNFeHAgPj4gKE1BWF9QUkVDSVNJT04gLSBwcmVjaXNpb24pLCBwcmVjaXNpb24pLCBwcmVjaXNpb24pOwogICAgfQoKICAgIC8qKgogICAgICAgIFJldHVybiBmbG9vcihsbihudW1lcmF0b3IgLyBkZW5vbWluYXRvcikgKiAyIF4gTUFYX1BSRUNJU0lPTiksIHdoZXJlOgogICAgICAgIC0gVGhlIG51bWVyYXRvciAgIGlzIGEgdmFsdWUgYmV0d2VlbiAxIGFuZCAyIF4gKDI1NiAtIE1BWF9QUkVDSVNJT04pIC0gMQogICAgICAgIC0gVGhlIGRlbm9taW5hdG9yIGlzIGEgdmFsdWUgYmV0d2VlbiAxIGFuZCAyIF4gKDI1NiAtIE1BWF9QUkVDSVNJT04pIC0gMQogICAgICAgIC0gVGhlIG91dHB1dCAgICAgIGlzIGEgdmFsdWUgYmV0d2VlbiAwIGFuZCBmbG9vcihsbigyIF4gKDI1NiAtIE1BWF9QUkVDSVNJT04pIC0gMSkgKiAyIF4gTUFYX1BSRUNJU0lPTikKICAgICAgICBUaGlzIGZ1bmN0aW9ucyBhc3N1bWVzIHRoYXQgdGhlIG51bWVyYXRvciBpcyBsYXJnZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgZGVub21pbmF0b3IsIGJlY2F1c2UgdGhlIG91dHB1dCB3b3VsZCBiZSBuZWdhdGl2ZSBvdGhlcndpc2UuCiAgICAqLwogICAgZnVuY3Rpb24gbG4odWludDI1NiBfbnVtZXJhdG9yLCB1aW50MjU2IF9kZW5vbWluYXRvcikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KF9udW1lcmF0b3IgPD0gTUFYX05VTSk7CgogICAgICAgIHVpbnQyNTYgcmVzID0gMDsKICAgICAgICB1aW50MjU2IHggPSBfbnVtZXJhdG9yICogRklYRURfMSAvIF9kZW5vbWluYXRvcjsKCiAgICAgICAgLy8gSWYgeCA+PSAyLCB0aGVuIHdlIGNvbXB1dGUgdGhlIGludGVnZXIgcGFydCBvZiBsb2cyKHgpLCB3aGljaCBpcyBsYXJnZXIgdGhhbiAwLgogICAgICAgIGlmICh4ID49IEZJWEVEXzIpIHsKICAgICAgICAgICAgdWludDggY291bnQgPSBmbG9vckxvZzIoeCAvIEZJWEVEXzEpOwogICAgICAgICAgICB4ID4+PSBjb3VudDsgLy8gbm93IHggPCAyCiAgICAgICAgICAgIHJlcyA9IGNvdW50ICogRklYRURfMTsKICAgICAgICB9CgogICAgICAgIC8vIElmIHggPiAxLCB0aGVuIHdlIGNvbXB1dGUgdGhlIGZyYWN0aW9uIHBhcnQgb2YgbG9nMih4KSwgd2hpY2ggaXMgbGFyZ2VyIHRoYW4gMC4KICAgICAgICBpZiAoeCA+IEZJWEVEXzEpIHsKICAgICAgICAgICAgZm9yICh1aW50OCBpID0gTUFYX1BSRUNJU0lPTjsgaSA+IDA7IC0taSkgewogICAgICAgICAgICAgICAgeCA9ICh4ICogeCkgLyBGSVhFRF8xOyAvLyBub3cgMSA8IHggPCA0CiAgICAgICAgICAgICAgICBpZiAoeCA+PSBGSVhFRF8yKSB7CiAgICAgICAgICAgICAgICAgICAgeCA+Pj0gMTsgLy8gbm93IDEgPCB4IDwgMgogICAgICAgICAgICAgICAgICAgIHJlcyArPSBPTkUgPDwgKGkgLSAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlcyAqIExOMl9OVU1FUkFUT1IgLyBMTjJfREVOT01JTkFUT1I7CiAgICB9CgogICAgLyoqCiAgICAgICAgQ29tcHV0ZSB0aGUgbGFyZ2VzdCBpbnRlZ2VyIHNtYWxsZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgYmluYXJ5IGxvZ2FyaXRobSBvZiB0aGUgaW5wdXQuCiAgICAqLwogICAgZnVuY3Rpb24gZmxvb3JMb2cyKHVpbnQyNTYgX24pIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDgpIHsKICAgICAgICB1aW50OCByZXMgPSAwOwoKICAgICAgICBpZiAoX24gPCAyNTYpIHsKICAgICAgICAgICAgLy8gQXQgbW9zdCA4IGl0ZXJhdGlvbnMKICAgICAgICAgICAgd2hpbGUgKF9uID4gMSkgewogICAgICAgICAgICAgICAgX24gPj49IDE7CiAgICAgICAgICAgICAgICByZXMgKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gRXhhY3RseSA4IGl0ZXJhdGlvbnMKICAgICAgICAgICAgZm9yICh1aW50OCBzID0gMTI4OyBzID4gMDsgcyA+Pj0gMSkgewogICAgICAgICAgICAgICAgaWYgKF9uID49IChPTkUgPDwgcykpIHsKICAgICAgICAgICAgICAgICAgICBfbiA+Pj0gczsKICAgICAgICAgICAgICAgICAgICByZXMgfD0gczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlczsKICAgIH0KCiAgICAvKioKICAgICAgICBUaGUgZ2xvYmFsICJtYXhFeHBBcnJheSIgaXMgc29ydGVkIGluIGRlc2NlbmRpbmcgb3JkZXIsIGFuZCB0aGVyZWZvcmUgdGhlIGZvbGxvd2luZyBzdGF0ZW1lbnRzIGFyZSBlcXVpdmFsZW50OgogICAgICAgIC0gVGhpcyBmdW5jdGlvbiBmaW5kcyB0aGUgcG9zaXRpb24gb2YgW3RoZSBzbWFsbGVzdCB2YWx1ZSBpbiAibWF4RXhwQXJyYXkiIGxhcmdlciB0aGFuIG9yIGVxdWFsIHRvICJ4Il0KICAgICAgICAtIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIGhpZ2hlc3QgcG9zaXRpb24gb2YgW2EgdmFsdWUgaW4gIm1heEV4cEFycmF5IiBsYXJnZXIgdGhhbiBvciBlcXVhbCB0byAieCJdCiAgICAqLwogICAgZnVuY3Rpb24gZmluZFBvc2l0aW9uSW5NYXhFeHBBcnJheSh1aW50MjU2IF94KSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgdWludDggbG8gPSBNSU5fUFJFQ0lTSU9OOwogICAgICAgIHVpbnQ4IGhpID0gTUFYX1BSRUNJU0lPTjsKCiAgICAgICAgd2hpbGUgKGxvICsgMSA8IGhpKSB7CiAgICAgICAgICAgIHVpbnQ4IG1pZCA9IChsbyArIGhpKSAvIDI7CiAgICAgICAgICAgIGlmIChtYXhFeHBBcnJheVttaWRdID49IF94KQogICAgICAgICAgICAgICAgbG8gPSBtaWQ7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGhpID0gbWlkOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1heEV4cEFycmF5W2hpXSA+PSBfeCkKICAgICAgICAgICAgcmV0dXJuIGhpOwogICAgICAgIGlmIChtYXhFeHBBcnJheVtsb10gPj0gX3gpCiAgICAgICAgICAgIHJldHVybiBsbzsKCiAgICAgICAgYXNzZXJ0KGZhbHNlKTsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvKioKICAgICAgICBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBhdXRvLWdlbmVyYXRlZCBieSB0aGUgc2NyaXB0ICdQcmludEZ1bmN0aW9uRml4ZWRFeHAucHknLgogICAgICAgIEl0IGFwcHJveGltYXRlcyAiZSBeIHgiIHZpYSBtYWNsYXVyaW4gc3VtbWF0aW9uOiAiKHheMCkvMCEgKyAoeF4xKS8xISArIC4uLiArICh4Xm4pL24hIi4KICAgICAgICBJdCByZXR1cm5zICJlIF4gKHggLyAyIF4gcHJlY2lzaW9uKSAqIDIgXiBwcmVjaXNpb24iLCB0aGF0IGlzLCB0aGUgcmVzdWx0IGlzIHVwc2hpZnRlZCBmb3IgYWNjdXJhY3kuCiAgICAgICAgVGhlIGdsb2JhbCAibWF4RXhwQXJyYXkiIG1hcHMgZWFjaCAicHJlY2lzaW9uIiB0byAiKChtYXhpbXVtRXhwb25lbnQgKyAxKSA8PCAoTUFYX1BSRUNJU0lPTiAtIHByZWNpc2lvbikpIC0gMSIuCiAgICAgICAgVGhlIG1heGltdW0gcGVybWl0dGVkIHZhbHVlIGZvciAieCIgaXMgdGhlcmVmb3JlIGdpdmVuIGJ5ICJtYXhFeHBBcnJheVtwcmVjaXNpb25dID4+IChNQVhfUFJFQ0lTSU9OIC0gcHJlY2lzaW9uKSIuCiAgICAqLwogICAgZnVuY3Rpb24gZml4ZWRFeHAodWludDI1NiBfeCwgdWludDggX3ByZWNpc2lvbikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiB4aSA9IF94OwogICAgICAgIHVpbnQyNTYgcmVzID0gMDsKCiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gX3ByZWNpc2lvbjsKICAgICAgICByZXMgKz0geGkgKiAweDAzNDQyYzRlNjA3NGE4MmYxNzk3ZjcyYWMwMDAwMDAwOyAvLyBhZGQgeF4yICogKDMzISAvIDIhKQogICAgICAgIHhpID0gKHhpICogX3gpID4+IF9wcmVjaXNpb247CiAgICAgICAgcmVzICs9IHhpICogMHgwMTE2Yjk2Zjc1N2MzODBmYjI4N2ZkMGU0MDAwMDAwMDsgLy8gYWRkIHheMyAqICgzMyEgLyAzISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDA0NWFlNWJkZDVmMGUwM2VjYTFmZjQzOTAwMDAwMDA7IC8vIGFkZCB4XjQgKiAoMzMhIC8gNCEpCiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gX3ByZWNpc2lvbjsKICAgICAgICByZXMgKz0geGkgKiAweDAwMGRlZmFiZjkxMzAyY2Q5NWI5ZmZkYTUwMDAwMDAwOyAvLyBhZGQgeF41ICogKDMzISAvIDUhKQogICAgICAgIHhpID0gKHhpICogX3gpID4+IF9wcmVjaXNpb247CiAgICAgICAgcmVzICs9IHhpICogMHgwMDAyNTI5Y2E5ODMyYjIyNDM5ZWZmZjliODAwMDAwMDsgLy8gYWRkIHheNiAqICgzMyEgLyA2ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDU0ZjFjZjEyYmQwNGU1MTZiNmRhODgwMDAwMDA7IC8vIGFkZCB4XjcgKiAoMzMhIC8gNyEpCiAgICAgICAgeGkgPSAoeGkgKiBfeCkgPj4gX3ByZWNpc2lvbjsKICAgICAgICByZXMgKz0geGkgKiAweDAwMDAwYTllMzllMjU3YTA5Y2EyZDZkYjUxMDAwMDAwOyAvLyBhZGQgeF44ICogKDMzISAvIDghKQogICAgICAgIHhpID0gKHhpICogX3gpID4+IF9wcmVjaXNpb247CiAgICAgICAgcmVzICs9IHhpICogMHgwMDAwMDEyZTA2NmU3YjgzOWZhMDUwYzMwOTAwMDAwMDsgLy8gYWRkIHheOSAqICgzMyEgLyA5ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMWUzM2Q3ZDkyNmMzMjlhMWFkMWE4MDAwMDA7IC8vIGFkZCB4XjEwICogKDMzISAvIDEwISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDJiZWU1MTNiZGI0YTZiMTliNWY4MDAwMDA7IC8vIGFkZCB4XjExICogKDMzISAvIDExISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAzYTkzMTZmYTc5Yjg4ZWNjZjJhMDAwMDA7IC8vIGFkZCB4XjEyICogKDMzISAvIDEyISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwNDgxNzdlYmUxZmE4MTIzNzUyMDAwMDA7IC8vIGFkZCB4XjEzICogKDMzISAvIDEzISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDUyNjNmZTkwMjQyZGNiYWNmMDAwMDA7IC8vIGFkZCB4XjE0ICogKDMzISAvIDE0ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDA1N2UyMjA5OWMwMzBkOTQxMDAwMDA7IC8vIGFkZCB4XjE1ICogKDMzISAvIDE1ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwNTdlMjIwOTljMDMwZDk0MTAwMDA7IC8vIGFkZCB4XjE2ICogKDMzISAvIDE2ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDUyYjZiNTQ1Njk5NzYzMTAwMDA7IC8vIGFkZCB4XjE3ICogKDMzISAvIDE3ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDA0OTg1ZjY3Njk2YmY3NDgwMDA7IC8vIGFkZCB4XjE4ICogKDMzISAvIDE4ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwM2RlYTEyZWE5OWU0OTgwMDA7IC8vIGFkZCB4XjE5ICogKDMzISAvIDE5ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDMxODgwZjIyMTRiNmUwMDA7IC8vIGFkZCB4XjIwICogKDMzISAvIDIwISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAyNWJjZmY1NmViMzYwMDA7IC8vIGFkZCB4XjIxICogKDMzISAvIDIxISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMWI3MjJlMTBhYjEwMDA7IC8vIGFkZCB4XjIyICogKDMzISAvIDIyISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDEzMTdjNzAwNzcwMDA7IC8vIGFkZCB4XjIzICogKDMzISAvIDIzISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwY2JhODRhYWZhMDA7IC8vIGFkZCB4XjI0ICogKDMzISAvIDI0ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDgyNTczYTBhMDA7IC8vIGFkZCB4XjI1ICogKDMzISAvIDI1ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA1MDM1YWQ5MDA7IC8vIGFkZCB4XjI2ICogKDMzISAvIDI2ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMmY4ODFiMDA7IC8vIGFkZCB4XjI3ICogKDMzISAvIDI3ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFiMjkzNDA7IC8vIGFkZCB4XjI4ICogKDMzISAvIDI4ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwZWZjNDA7IC8vIGFkZCB4XjI5ICogKDMzISAvIDI5ISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDdmZTA7IC8vIGFkZCB4XjMwICogKDMzISAvIDMwISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA0MjA7IC8vIGFkZCB4XjMxICogKDMzISAvIDMxISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjE7IC8vIGFkZCB4XjMyICogKDMzISAvIDMyISkKICAgICAgICB4aSA9ICh4aSAqIF94KSA+PiBfcHJlY2lzaW9uOwogICAgICAgIHJlcyArPSB4aSAqIDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDE7IC8vIGFkZCB4XjMzICogKDMzISAvIDMzISkKCiAgICAgICAgcmV0dXJuIHJlcyAvIDB4Njg4NTg5Y2MwZTk1MDVlMmYyZmVlNTU4MDAwMDAwMCArIF94ICsgKE9ORSA8PCBfcHJlY2lzaW9uKTsgLy8gZGl2aWRlIGJ5IDMzISBhbmQgdGhlbiBhZGQgeF4xIC8gMSEgKyB4XjAgLyAwIQogICAgfQp9Cgpjb250cmFjdCBCYW5jb3JHYXNQcmljZUxpbWl0IGlzIElCYW5jb3JHYXNQcmljZUxpbWl0LCBPd25lZCwgVXRpbHMgewogICAgdWludDI1NiBwdWJsaWMgZ2FzUHJpY2UgPSAwIHdlaTsgICAgLy8gbWF4aW11bSBnYXMgcHJpY2UgZm9yIGJhbmNvciB0cmFuc2FjdGlvbnMKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSBfZ2FzUHJpY2UgICAgZ2FzIHByaWNlIGxpbWl0CiAgICAqLwogICAgZnVuY3Rpb24gQmFuY29yR2FzUHJpY2VMaW1pdCh1aW50MjU2IF9nYXNQcmljZSkKICAgICAgICBwdWJsaWMKICAgICAgICBncmVhdGVyVGhhblplcm8oX2dhc1ByaWNlKQogICAgewogICAgICAgIGdhc1ByaWNlID0gX2dhc1ByaWNlOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG93bmVyIHRvIHVwZGF0ZSB0aGUgZ2FzIHByaWNlIGxpbWl0CgogICAgICAgIEBwYXJhbSBfZ2FzUHJpY2UgICAgbmV3IGdhcyBwcmljZSBsaW1pdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldEdhc1ByaWNlKHVpbnQyNTYgX2dhc1ByaWNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfZ2FzUHJpY2UpCiAgICB7CiAgICAgICAgZ2FzUHJpY2UgPSBfZ2FzUHJpY2U7CiAgICB9Cn0KCmNvbnRyYWN0IEJhbmNvclByaWNlRmxvb3IgaXMgT3duZWQsIFRva2VuSG9sZGVyIHsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1BSSUNFX04gPSAxOyAgICAgIC8vIGNyb3dkc2FsZSBwcmljZSBpbiB3ZWkgKG51bWVyYXRvcikKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1BSSUNFX0QgPSAxMDA7ICAgIC8vIGNyb3dkc2FsZSBwcmljZSBpbiB3ZWkgKGRlbm9taW5hdG9yKQoKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICcwLjEnOwogICAgSVNtYXJ0VG9rZW4gcHVibGljIHRva2VuOyAvLyBzbWFydCB0b2tlbiB0aGUgY29udHJhY3QgYWxsb3dzIHNlbGxpbmcKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICBzbWFydCB0b2tlbiB0aGUgY29udHJhY3QgYWxsb3dzIHNlbGxpbmcKICAgICovCiAgICBmdW5jdGlvbiBCYW5jb3JQcmljZUZsb29yKElTbWFydFRva2VuIF90b2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgewogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgc2VsbHMgdGhlIHNtYXJ0IHRva2VuIGZvciBFVEgKICAgICAgICBub3RlIHRoYXQgdGhlIGZ1bmN0aW9uIHdpbGwgc2VsbCB0aGUgZnVsbCBhbGxvd2FuY2UgYW1vdW50CgogICAgICAgIEByZXR1cm4gRVRIIHNlbnQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gc2VsbCgpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2IGFtb3VudCkgewogICAgICAgIHVpbnQyNTYgYWxsb3dhbmNlID0gdG9rZW4uYWxsb3dhbmNlKG1zZy5zZW5kZXIsIHRoaXMpOyAvLyBnZXQgdGhlIGZ1bGwgYWxsb3dhbmNlIGFtb3VudAogICAgICAgIGFzc2VydCh0b2tlbi50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgdGhpcywgYWxsb3dhbmNlKSk7IC8vIHRyYW5zZmVyIGFsbCB0b2tlbnMgZnJvbSB0aGUgc2VuZGVyIHRvIHRoZSBjb250cmFjdAogICAgICAgIHVpbnQyNTYgZXRoZXJWYWx1ZSA9IHNhZmVNdWwoYWxsb3dhbmNlLCBUT0tFTl9QUklDRV9OKSAvIFRPS0VOX1BSSUNFX0Q7IC8vIGNhbGN1bGF0ZSBFVEggdmFsdWUgb2YgdGhlIHRva2VucwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXRoZXJWYWx1ZSk7IC8vIHNlbmQgdGhlIEVUSCBhbW91bnQgdG8gdGhlIHNlbGxlcgogICAgICAgIHJldHVybiBldGhlclZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgd2l0aGRyYXdzIEVUSCBmcm9tIHRoZSBjb250cmFjdAoKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgYW1vdW50IG9mIEVUSCB0byB3aXRoZHJhdwogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihfYW1vdW50KTsgLy8gc2VuZCB0aGUgYW1vdW50CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkZXBvc2l0cyBFVEggaW4gdGhlIGNvbnRyYWN0CiAgICAqLwogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CiAgICB9Cn0KCmNvbnRyYWN0IEJhbmNvclF1aWNrQ29udmVydGVyIGlzIElCYW5jb3JRdWlja0NvbnZlcnRlciwgVG9rZW5Ib2xkZXIgewogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgZXRoZXJUb2tlbnM7ICAgLy8gbGlzdCBvZiBhbGwgc3VwcG9ydGVkIGV0aGVyIHRva2VucwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBCYW5jb3JRdWlja0NvbnZlcnRlcigpIHB1YmxpYyB7CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGEgY29udmVyc2lvbiBwYXRoIC0gdmVyaWZpZXMgdGhhdCB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGlzIG9kZCBhbmQgdGhhdCBtYXhpbXVtIG51bWJlciBvZiAnaG9wcycgaXMgMTAKICAgIG1vZGlmaWVyIHZhbGlkQ29udmVyc2lvblBhdGgoSUVSQzIwVG9rZW5bXSBfcGF0aCkgewogICAgICAgIHJlcXVpcmUoX3BhdGgubGVuZ3RoID4gMiAmJiBfcGF0aC5sZW5ndGggPD0gKDEgKyAyICogMTApICYmIF9wYXRoLmxlbmd0aCAlIDIgPT0gMSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGFsbG93cyB0aGUgb3duZXIgdG8gcmVnaXN0ZXIvdW5yZWdpc3RlciBldGhlciB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF90b2tlbiAgICAgICBldGhlciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9yZWdpc3RlciAgICB0cnVlIHRvIHJlZ2lzdGVyLCBmYWxzZSB0byB1bnJlZ2lzdGVyCiAgICAqLwogICAgZnVuY3Rpb24gcmVnaXN0ZXJFdGhlclRva2VuKElFdGhlclRva2VuIF90b2tlbiwgYm9vbCBfcmVnaXN0ZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgICAgICBub3RUaGlzKF90b2tlbikKICAgIHsKICAgICAgICBldGhlclRva2Vuc1tfdG9rZW5dID0gX3JlZ2lzdGVyOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgdGhlIHRva2VuIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsgYnkgZm9sbG93aW5nCiAgICAgICAgYSBwcmVkZWZpbmVkIGNvbnZlcnNpb24gcGF0aCBhbmQgdHJhbnNmZXJzIHRoZSByZXN1bHQgdG9rZW5zIHRvIGEgdGFyZ2V0IGFjY291bnQKICAgICAgICBub3RlIHRoYXQgdGhlIGNvbnZlcnRlciBzaG91bGQgYWxyZWFkeSBvd24gdGhlIHNvdXJjZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9wYXRoICAgICAgICBjb252ZXJzaW9uIHBhdGgsIHNlZSBjb252ZXJzaW9uIHBhdGggZm9ybWF0IGFib3ZlCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgICBhbW91bnQgdG8gY29udmVydCBmcm9tIChpbiB0aGUgaW5pdGlhbCBzb3VyY2UgdG9rZW4pCiAgICAgICAgQHBhcmFtIF9taW5SZXR1cm4gICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KICAgICAgICBAcGFyYW0gX2ZvciAgICAgICAgIGFjY291bnQgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGNvbnZlcnNpb24gcmVzdWx0CgogICAgICAgIEByZXR1cm4gdG9rZW5zIGlzc3VlZCBpbiByZXR1cm4KICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0Rm9yKElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuLCBhZGRyZXNzIF9mb3IpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIHZhbGlkQ29udmVyc2lvblBhdGgoX3BhdGgpCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBpZiBFVEggaXMgcHJvdmlkZWQsIGVuc3VyZSB0aGF0IHRoZSBhbW91bnQgaXMgaWRlbnRpY2FsIHRvIF9hbW91bnQgYW5kIHZlcmlmeSB0aGF0IHRoZSBzb3VyY2UgdG9rZW4gaXMgYW4gZXRoZXIgdG9rZW4KICAgICAgICBJRVJDMjBUb2tlbiBmcm9tVG9rZW4gPSBfcGF0aFswXTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwIHx8IChfYW1vdW50ID09IG1zZy52YWx1ZSAmJiBldGhlclRva2Vuc1tmcm9tVG9rZW5dKSk7CgogICAgICAgIElTbWFydFRva2VuIHNtYXJ0VG9rZW47CiAgICAgICAgSUVSQzIwVG9rZW4gdG9Ub2tlbjsKICAgICAgICBJVG9rZW5Db252ZXJ0ZXIgY29udmVydGVyOwogICAgICAgIHVpbnQyNTYgcGF0aExlbmd0aCA9IF9wYXRoLmxlbmd0aDsKCiAgICAgICAgLy8gaWYgRVRIIHdhcyBzZW50IHdpdGggdGhlIGNhbGwsIHRoZSBzb3VyY2UgaXMgYW4gZXRoZXIgdG9rZW4gLSBkZXBvc2l0IHRoZSBFVEggaW4gaXQKICAgICAgICAvLyBvdGhlcndpc2UsIHdlIGFzc3VtZSB3ZSBhbHJlYWR5IGhhdmUgdGhlIHRva2VucwogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKQogICAgICAgICAgICBJRXRoZXJUb2tlbihmcm9tVG9rZW4pLmRlcG9zaXQudmFsdWUobXNnLnZhbHVlKSgpOwoKICAgICAgICAvLyBpdGVyYXRlIG92ZXIgdGhlIGNvbnZlcnNpb24gcGF0aAogICAgICAgIGZvciAodWludDI1NiBpID0gMTsgaSA8IHBhdGhMZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICBzbWFydFRva2VuID0gSVNtYXJ0VG9rZW4oX3BhdGhbaV0pOwogICAgICAgICAgICB0b1Rva2VuID0gX3BhdGhbaSArIDFdOwogICAgICAgICAgICBjb252ZXJ0ZXIgPSBJVG9rZW5Db252ZXJ0ZXIoc21hcnRUb2tlbi5vd25lcigpKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBzbWFydCB0b2tlbiBpc24ndCB0aGUgc291cmNlIChmcm9tIHRva2VuKSwgdGhlIGNvbnZlcnRlciBkb2Vzbid0IGhhdmUgY29udHJvbCBvdmVyIGl0IGFuZCB0aHVzIHdlIG5lZWQgdG8gYXBwcm92ZSB0aGUgcmVxdWVzdAogICAgICAgICAgICBpZiAoc21hcnRUb2tlbiAhPSBmcm9tVG9rZW4pCiAgICAgICAgICAgICAgICBlbnN1cmVBbGxvd2FuY2UoZnJvbVRva2VuLCBjb252ZXJ0ZXIsIF9hbW91bnQpOwoKICAgICAgICAgICAgLy8gbWFrZSB0aGUgY29udmVyc2lvbiAtIGlmIGl0J3MgdGhlIGxhc3Qgb25lLCBhbHNvIHByb3ZpZGUgdGhlIG1pbmltdW0gcmV0dXJuIHZhbHVlCiAgICAgICAgICAgIF9hbW91bnQgPSBjb252ZXJ0ZXIuY2hhbmdlKGZyb21Ub2tlbiwgdG9Ub2tlbiwgX2Ftb3VudCwgaSA9PSBwYXRoTGVuZ3RoIC0gMiA/IF9taW5SZXR1cm4gOiAxKTsKICAgICAgICAgICAgZnJvbVRva2VuID0gdG9Ub2tlbjsKICAgICAgICB9CgogICAgICAgIC8vIGZpbmlzaGVkIHRoZSBjb252ZXJzaW9uLCB0cmFuc2ZlciB0aGUgZnVuZHMgdG8gdGhlIHRhcmdldCBhY2NvdW50CiAgICAgICAgLy8gaWYgdGhlIHRhcmdldCB0b2tlbiBpcyBhbiBldGhlciB0b2tlbiwgd2l0aGRyYXcgdGhlIHRva2VucyBhbmQgc2VuZCB0aGVtIGFzIEVUSAogICAgICAgIC8vIG90aGVyd2lzZSwgdHJhbnNmZXIgdGhlIHRva2VucyBhcyBpcwogICAgICAgIGlmIChldGhlclRva2Vuc1t0b1Rva2VuXSkKICAgICAgICAgICAgSUV0aGVyVG9rZW4odG9Ub2tlbikud2l0aGRyYXdUbyhfZm9yLCBfYW1vdW50KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFzc2VydCh0b1Rva2VuLnRyYW5zZmVyKF9mb3IsIF9hbW91bnQpKTsKCiAgICAgICAgcmV0dXJuIF9hbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBjbGFpbXMgdGhlIGNhbGxlcidzIHRva2VucywgY29udmVydHMgdGhlbSB0byBhbnkgb3RoZXIgdG9rZW4gaW4gdGhlIGJhbmNvciBuZXR3b3JrCiAgICAgICAgYnkgZm9sbG93aW5nIGEgcHJlZGVmaW5lZCBjb252ZXJzaW9uIHBhdGggYW5kIHRyYW5zZmVycyB0aGUgcmVzdWx0IHRva2VucyB0byBhIHRhcmdldCBhY2NvdW50CiAgICAgICAgbm90ZSB0aGF0IGFsbG93YW5jZSBtdXN0IGJlIHNldCBiZWZvcmVoYW5kCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICAgICAgY29udmVyc2lvbiBwYXRoLCBzZWUgY29udmVyc2lvbiBwYXRoIGZvcm1hdCBhYm92ZQogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICAgYW1vdW50IHRvIGNvbnZlcnQgZnJvbSAoaW4gdGhlIGluaXRpYWwgc291cmNlIHRva2VuKQogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICAgaWYgdGhlIGNvbnZlcnNpb24gcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCiAgICAgICAgQHBhcmFtIF9mb3IgICAgICAgICBhY2NvdW50IHRoYXQgd2lsbCByZWNlaXZlIHRoZSBjb252ZXJzaW9uIHJlc3VsdAoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BbmRDb252ZXJ0Rm9yKElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuLCBhZGRyZXNzIF9mb3IpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gd2UgbmVlZCB0byB0cmFuc2ZlciB0aGUgdG9rZW5zIGZyb20gdGhlIGNhbGxlciB0byB0aGUgY29udmVydGVyIGJlZm9yZSB3ZSBmb2xsb3cKICAgICAgICAvLyB0aGUgY29udmVyc2lvbiBwYXRoLCB0byBhbGxvdyBpdCB0byBleGVjdXRlIHRoZSBjb252ZXJzaW9uIG9uIGJlaGFsZiBvZiB0aGUgY2FsbGVyCiAgICAgICAgLy8gbm90ZTogd2UgYXNzdW1lIHdlIGFscmVhZHkgaGF2ZSBhbGxvd2FuY2UKICAgICAgICBJRVJDMjBUb2tlbiBmcm9tVG9rZW4gPSBfcGF0aFswXTsKICAgICAgICBhc3NlcnQoZnJvbVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBfYW1vdW50KSk7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRGb3IoX3BhdGgsIF9hbW91bnQsIF9taW5SZXR1cm4sIF9mb3IpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgdGhlIHRva2VuIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsgYnkgZm9sbG93aW5nCiAgICAgICAgYSBwcmVkZWZpbmVkIGNvbnZlcnNpb24gcGF0aCBhbmQgdHJhbnNmZXJzIHRoZSByZXN1bHQgdG9rZW5zIGJhY2sgdG8gdGhlIHNlbmRlcgogICAgICAgIG5vdGUgdGhhdCB0aGUgY29udmVydGVyIHNob3VsZCBhbHJlYWR5IG93biB0aGUgc291cmNlIHRva2VucwoKICAgICAgICBAcGFyYW0gX3BhdGggICAgICAgIGNvbnZlcnNpb24gcGF0aCwgc2VlIGNvbnZlcnNpb24gcGF0aCBmb3JtYXQgYWJvdmUKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgIGFtb3VudCB0byBjb252ZXJ0IGZyb20gKGluIHRoZSBpbml0aWFsIHNvdXJjZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgIGlmIHRoZSBjb252ZXJzaW9uIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydChJRVJDMjBUb2tlbltdIF9wYXRoLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjb252ZXJ0Rm9yKF9wYXRoLCBfYW1vdW50LCBfbWluUmV0dXJuLCBtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGNsYWltcyB0aGUgY2FsbGVyJ3MgdG9rZW5zLCBjb252ZXJ0cyB0aGVtIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsKICAgICAgICBieSBmb2xsb3dpbmcgYSBwcmVkZWZpbmVkIGNvbnZlcnNpb24gcGF0aCBhbmQgdHJhbnNmZXJzIHRoZSByZXN1bHQgdG9rZW5zIGJhY2sgdG8gdGhlIHNlbmRlcgogICAgICAgIG5vdGUgdGhhdCBhbGxvd2FuY2UgbXVzdCBiZSBzZXQgYmVmb3JlaGFuZAoKICAgICAgICBAcGFyYW0gX3BhdGggICAgICAgIGNvbnZlcnNpb24gcGF0aCwgc2VlIGNvbnZlcnNpb24gcGF0aCBmb3JtYXQgYWJvdmUKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgIGFtb3VudCB0byBjb252ZXJ0IGZyb20gKGluIHRoZSBpbml0aWFsIHNvdXJjZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgIGlmIHRoZSBjb252ZXJzaW9uIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BbmRDb252ZXJ0KElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuKSBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjbGFpbUFuZENvbnZlcnRGb3IoX3BhdGgsIF9hbW91bnQsIF9taW5SZXR1cm4sIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXRpbGl0eSwgY2hlY2tzIHdoZXRoZXIgYWxsb3dhbmNlIGZvciB0aGUgZ2l2ZW4gc3BlbmRlciBleGlzdHMgYW5kIGFwcHJvdmVzIG9uZSBpZiBpdCBkb2Vzbid0CgogICAgICAgIEBwYXJhbSBfdG9rZW4gICB0b2tlbiB0byBjaGVjayB0aGUgYWxsb3dhbmNlIGluCiAgICAgICAgQHBhcmFtIF9zcGVuZGVyIGFwcHJvdmVkIGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3ZhbHVlICAgYWxsb3dhbmNlIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGVuc3VyZUFsbG93YW5jZShJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwcml2YXRlIHsKICAgICAgICAvLyBjaGVjayBpZiBhbGxvd2FuY2UgZm9yIHRoZSBnaXZlbiBhbW91bnQgYWxyZWFkeSBleGlzdHMKICAgICAgICBpZiAoX3Rva2VuLmFsbG93YW5jZSh0aGlzLCBfc3BlbmRlcikgPj0gX3ZhbHVlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGlmIHRoZSBhbGxvd2FuY2UgaXMgbm9uemVybywgbXVzdCByZXNldCBpdCB0byAwIGZpcnN0CiAgICAgICAgaWYgKF90b2tlbi5hbGxvd2FuY2UodGhpcywgX3NwZW5kZXIpICE9IDApCiAgICAgICAgICAgIGFzc2VydChfdG9rZW4uYXBwcm92ZShfc3BlbmRlciwgMCkpOwoKICAgICAgICAvLyBhcHByb3ZlIHRoZSBuZXcgYWxsb3dhbmNlCiAgICAgICAgYXNzZXJ0KF90b2tlbi5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpKTsKICAgIH0KfQoKY29udHJhY3QgQ3Jvd2RzYWxlQ29udHJvbGxlciBpcyBTbWFydFRva2VuQ29udHJvbGxlciB7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBEVVJBVElPTiA9IDE0IGRheXM7ICAgICAgICAgICAgICAgICAvLyBjcm93ZHNhbGUgZHVyYXRpb24KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1BSSUNFX04gPSAxOyAgICAgICAgICAgICAgICAgIC8vIGluaXRpYWwgcHJpY2UgaW4gd2VpIChudW1lcmF0b3IpCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9QUklDRV9EID0gMTAwOyAgICAgICAgICAgICAgICAvLyBpbml0aWFsIHByaWNlIGluIHdlaSAoZGVub21pbmF0b3IpCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBCVENTX0VUSEVSX0NBUCA9IDUwMDAwIGV0aGVyOyAgICAgICAvLyBtYXhpbXVtIGJpdGNvaW4gc3Vpc3NlIGV0aGVyIGNvbnRyaWJ1dGlvbgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUFYX0dBU19QUklDRSA9IDUwMDAwMDAwMDAwIHdlaTsgICAgLy8gbWF4aW11bSBnYXMgcHJpY2UgZm9yIGNvbnRyaWJ1dGlvbiB0cmFuc2FjdGlvbnMKCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC4xJzsKCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWUgPSAwOyAgICAgICAgICAgICAgICAgICAvLyBjcm93ZHNhbGUgc3RhcnQgdGltZSAoaW4gc2Vjb25kcykKICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWUgPSAwOyAgICAgICAgICAgICAgICAgICAgIC8vIGNyb3dkc2FsZSBlbmQgdGltZSAoaW4gc2Vjb25kcykKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsRXRoZXJDYXAgPSAxMDAwMDAwIGV0aGVyOyAgIC8vIGN1cnJlbnQgZXRoZXIgY29udHJpYnV0aW9uIGNhcCwgaW5pdGlhbGl6ZWQgd2l0aCBhIHRlbXAgdmFsdWUgYXMgYSBzYWZldHkgbWVjaGFuaXNtIHVudGlsIHRoZSByZWFsIGNhcCBpcyByZXZlYWxlZAogICAgdWludDI1NiBwdWJsaWMgdG90YWxFdGhlckNvbnRyaWJ1dGVkID0gMDsgICAgICAgLy8gZXRoZXIgY29udHJpYnV0ZWQgc28gZmFyCiAgICBieXRlczMyIHB1YmxpYyByZWFsRXRoZXJDYXBIYXNoOyAgICAgICAgICAgICAgICAvLyBlbnN1cmVzIHRoYXQgdGhlIHJlYWwgY2FwIGlzIHByZWRlZmluZWQgb24gZGVwbG95bWVudCBhbmQgY2Fubm90IGJlIGNoYW5nZWQgbGF0ZXIKICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5ID0gYWRkcmVzcygwKTsgICAgICAgIC8vIGFkZHJlc3MgdG8gcmVjZWl2ZSBhbGwgZXRoZXIgY29udHJpYnV0aW9ucwogICAgYWRkcmVzcyBwdWJsaWMgYnRjcyA9IGFkZHJlc3MoMCk7ICAgICAgICAgICAgICAgLy8gYml0Y29pbiBzdWlzc2UgYWRkcmVzcwoKICAgIC8vIHRyaWdnZXJlZCBvbiBlYWNoIGNvbnRyaWJ1dGlvbgogICAgZXZlbnQgQ29udHJpYnV0aW9uKGFkZHJlc3MgaW5kZXhlZCBfY29udHJpYnV0b3IsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfcmV0dXJuKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICAgICAgICAgc21hcnQgdG9rZW4gdGhlIGNyb3dkc2FsZSBpcyBmb3IKICAgICAgICBAcGFyYW0gX3N0YXJ0VGltZSAgICAgIGNyb3dkc2FsZSBzdGFydCB0aW1lCiAgICAgICAgQHBhcmFtIF9iZW5lZmljaWFyeSAgICBhZGRyZXNzIHRvIHJlY2VpdmUgYWxsIGV0aGVyIGNvbnRyaWJ1dGlvbnMKICAgICAgICBAcGFyYW0gX2J0Y3MgICAgICAgICAgIGJpdGNvaW4gc3Vpc3NlIGFkZHJlc3MKICAgICovCiAgICBmdW5jdGlvbiBDcm93ZHNhbGVDb250cm9sbGVyKElTbWFydFRva2VuIF90b2tlbiwgdWludDI1NiBfc3RhcnRUaW1lLCBhZGRyZXNzIF9iZW5lZmljaWFyeSwgYWRkcmVzcyBfYnRjcywgYnl0ZXMzMiBfcmVhbEV0aGVyQ2FwSGFzaCkKICAgICAgICBwdWJsaWMKICAgICAgICBTbWFydFRva2VuQ29udHJvbGxlcihfdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKF9iZW5lZmljaWFyeSkKICAgICAgICB2YWxpZEFkZHJlc3MoX2J0Y3MpCiAgICAgICAgZWFybGllclRoYW4oX3N0YXJ0VGltZSkKICAgICAgICBncmVhdGVyVGhhblplcm8odWludDI1NihfcmVhbEV0aGVyQ2FwSGFzaCkpCiAgICB7CiAgICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgICAgICBlbmRUaW1lID0gc3RhcnRUaW1lICsgRFVSQVRJT047CiAgICAgICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICAgICAgYnRjcyA9IF9idGNzOwogICAgICAgIHJlYWxFdGhlckNhcEhhc2ggPSBfcmVhbEV0aGVyQ2FwSGFzaDsKICAgIH0KCiAgICAvLyB2ZXJpZmllcyB0aGF0IHRoZSBnYXMgcHJpY2UgaXMgbG93ZXIgdGhhbiA1MCBnd2VpCiAgICBtb2RpZmllciB2YWxpZEdhc1ByaWNlKCkgewogICAgICAgIGFzc2VydCh0eC5nYXNwcmljZSA8PSBNQVhfR0FTX1BSSUNFKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIHZlcmlmaWVzIHRoYXQgdGhlIGV0aGVyIGNhcCBpcyB2YWxpZCBiYXNlZCBvbiB0aGUga2V5IHByb3ZpZGVkCiAgICBtb2RpZmllciB2YWxpZEV0aGVyQ2FwKHVpbnQyNTYgX2NhcCwgdWludDI1NiBfa2V5KSB7CiAgICAgICAgcmVxdWlyZShjb21wdXRlUmVhbENhcChfY2FwLCBfa2V5KSA9PSByZWFsRXRoZXJDYXBIYXNoKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGVuc3VyZXMgdGhhdCBpdCdzIGVhcmxpZXIgdGhhbiB0aGUgZ2l2ZW4gdGltZQogICAgbW9kaWZpZXIgZWFybGllclRoYW4odWludDI1NiBfdGltZSkgewogICAgICAgIGFzc2VydChub3cgPCBfdGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBlbnN1cmVzIHRoYXQgdGhlIGN1cnJlbnQgdGltZSBpcyBiZXR3ZWVuIF9zdGFydFRpbWUgKGluY2x1c2l2ZSkgYW5kIF9lbmRUaW1lIChleGNsdXNpdmUpCiAgICBtb2RpZmllciBiZXR3ZWVuKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSkgewogICAgICAgIGFzc2VydChub3cgPj0gX3N0YXJ0VGltZSAmJiBub3cgPCBfZW5kVGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBlbnN1cmVzIHRoYXQgdGhlIHNlbmRlciBpcyBiaXRjb2luIHN1aXNzZQogICAgbW9kaWZpZXIgYnRjc09ubHkoKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gYnRjcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBlbnN1cmVzIHRoYXQgd2UgZGlkbid0IHJlYWNoIHRoZSBldGhlciBjYXAKICAgIG1vZGlmaWVyIGV0aGVyQ2FwTm90UmVhY2hlZCh1aW50MjU2IF9jb250cmlidXRpb24pIHsKICAgICAgICBhc3NlcnQoc2FmZUFkZCh0b3RhbEV0aGVyQ29udHJpYnV0ZWQsIF9jb250cmlidXRpb24pIDw9IHRvdGFsRXRoZXJDYXApOwogICAgICAgIF87CiAgICB9CgogICAgLy8gZW5zdXJlcyB0aGF0IHdlIGRpZG4ndCByZWFjaCB0aGUgYml0Y29pbiBzdWlzc2UgZXRoZXIgY2FwCiAgICBtb2RpZmllciBidGNzRXRoZXJDYXBOb3RSZWFjaGVkKHVpbnQyNTYgX2V0aENvbnRyaWJ1dGlvbikgewogICAgICAgIGFzc2VydChzYWZlQWRkKHRvdGFsRXRoZXJDb250cmlidXRlZCwgX2V0aENvbnRyaWJ1dGlvbikgPD0gQlRDU19FVEhFUl9DQVApOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBjb21wdXRlcyB0aGUgcmVhbCBjYXAgYmFzZWQgb24gdGhlIGdpdmVuIGNhcCAmIGtleQoKICAgICAgICBAcGFyYW0gX2NhcCAgICBjYXAKICAgICAgICBAcGFyYW0gX2tleSAgICBrZXkgdXNlZCB0byBjb21wdXRlIHRoZSBjYXAgaGFzaAoKICAgICAgICBAcmV0dXJuIGNvbXB1dGVkIHJlYWwgY2FwIGhhc2gKICAgICovCiAgICBmdW5jdGlvbiBjb21wdXRlUmVhbENhcCh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2tleSkgcHVibGljIHB1cmUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoX2NhcCwgX2tleSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBlbmFibGVzIHRoZSByZWFsIGNhcCBkZWZpbmVkIG9uIGRlcGxveW1lbnQKCiAgICAgICAgQHBhcmFtIF9jYXAgICAgcHJlZGVmaW5lZCBjYXAKICAgICAgICBAcGFyYW0gX2tleSAgICBrZXkgdXNlZCB0byBjb21wdXRlIHRoZSBjYXAgaGFzaAogICAgKi8KICAgIGZ1bmN0aW9uIGVuYWJsZVJlYWxDYXAodWludDI1NiBfY2FwLCB1aW50MjU2IF9rZXkpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgYWN0aXZlCiAgICAgICAgYmV0d2VlbihzdGFydFRpbWUsIGVuZFRpbWUpCiAgICAgICAgdmFsaWRFdGhlckNhcChfY2FwLCBfa2V5KQogICAgewogICAgICAgIHJlcXVpcmUoX2NhcCA8IHRvdGFsRXRoZXJDYXApOyAvLyB2YWxpZGF0ZSBpbnB1dAogICAgICAgIHRvdGFsRXRoZXJDYXAgPSBfY2FwOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29tcHV0ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgdGhhdCBzaG91bGQgYmUgaXNzdWVkIGZvciBhIGdpdmVuIGNvbnRyaWJ1dGlvbgoKICAgICAgICBAcGFyYW0gX2NvbnRyaWJ1dGlvbiAgICBjb250cmlidXRpb24gYW1vdW50CgogICAgICAgIEByZXR1cm4gY29tcHV0ZWQgbnVtYmVyIG9mIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGNvbXB1dGVSZXR1cm4odWludDI1NiBfY29udHJpYnV0aW9uKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHNhZmVNdWwoX2NvbnRyaWJ1dGlvbiwgVE9LRU5fUFJJQ0VfRCkgLyBUT0tFTl9QUklDRV9OOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgRVRIIGNvbnRyaWJ1dGlvbgogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBkdXJpbmcgdGhlIGNyb3dkc2FsZQoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gY29udHJpYnV0ZUVUSCgpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIGJldHdlZW4oc3RhcnRUaW1lLCBlbmRUaW1lKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIHJldHVybiBwcm9jZXNzQ29udHJpYnV0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBDb250cmlidXRpb24gdGhyb3VnaCBCVENzIChCaXRjb2luIFN1aXNzZSBvbmx5KQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBiZWZvcmUgdGhlIGNyb3dkc2FsZSBzdGFydGVkCgogICAgICAgIEByZXR1cm4gdG9rZW5zIGlzc3VlZCBpbiByZXR1cm4KICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlQlRDcygpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIGJ0Y3NPbmx5CiAgICAgICAgYnRjc0V0aGVyQ2FwTm90UmVhY2hlZChtc2cudmFsdWUpCiAgICAgICAgZWFybGllclRoYW4oc3RhcnRUaW1lKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIHJldHVybiBwcm9jZXNzQ29udHJpYnV0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBoYW5kbGVzIGNvbnRyaWJ1dGlvbiBsb2dpYwogICAgICAgIG5vdGUgdGhhdCB0aGUgQ29udHJpYnV0aW9uIGV2ZW50IGlzIHRyaWdnZXJlZCB1c2luZyB0aGUgc2VuZGVyIGFzIHRoZSBjb250cmlidXRvciwgcmVnYXJkbGVzcyBvZiB0aGUgYWN0dWFsIGNvbnRyaWJ1dG9yCgogICAgICAgIEByZXR1cm4gdG9rZW5zIGlzc3VlZCBpbiByZXR1cm4KICAgICovCiAgICBmdW5jdGlvbiBwcm9jZXNzQ29udHJpYnV0aW9uKCkgcHJpdmF0ZQogICAgICAgIGFjdGl2ZQogICAgICAgIGV0aGVyQ2FwTm90UmVhY2hlZChtc2cudmFsdWUpCiAgICAgICAgdmFsaWRHYXNQcmljZQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBjb21wdXRlUmV0dXJuKG1zZy52YWx1ZSk7CiAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIobXNnLnZhbHVlKTsgLy8gdHJhbnNmZXIgdGhlIGV0aGVyIHRvIHRoZSBiZW5lZmljaWFyeSBhY2NvdW50CiAgICAgICAgdG90YWxFdGhlckNvbnRyaWJ1dGVkID0gc2FmZUFkZCh0b3RhbEV0aGVyQ29udHJpYnV0ZWQsIG1zZy52YWx1ZSk7IC8vIHVwZGF0ZSB0aGUgdG90YWwgY29udHJpYnV0aW9uIGFtb3VudAogICAgICAgIHRva2VuLmlzc3VlKG1zZy5zZW5kZXIsIHRva2VuQW1vdW50KTsgLy8gaXNzdWUgbmV3IGZ1bmRzIHRvIHRoZSBjb250cmlidXRvciBpbiB0aGUgc21hcnQgdG9rZW4KICAgICAgICB0b2tlbi5pc3N1ZShiZW5lZmljaWFyeSwgdG9rZW5BbW91bnQpOyAvLyBpc3N1ZSB0b2tlbnMgdG8gdGhlIGJlbmVmaWNpYXJ5CgogICAgICAgIENvbnRyaWJ1dGlvbihtc2cuc2VuZGVyLCBtc2cudmFsdWUsIHRva2VuQW1vdW50KTsKICAgICAgICByZXR1cm4gdG9rZW5BbW91bnQ7CiAgICB9CgogICAgLy8gZmFsbGJhY2sKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIGNvbnRyaWJ1dGVFVEgoKTsKICAgIH0KfQoKY29udHJhY3QgRVJDMjBUb2tlbiBpcyBJRVJDMjBUb2tlbiwgVXRpbHMgewogICAgc3RyaW5nIHB1YmxpYyBzdGFuZGFyZCA9ICdUb2tlbiAwLjEnOwogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gJyc7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICcnOwogICAgdWludDggcHVibGljIGRlY2ltYWxzID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5ID0gMDsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VPZjsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIGFsbG93YW5jZTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKCiAgICAgICAgQHBhcmFtIF9uYW1lICAgICAgICB0b2tlbiBuYW1lCiAgICAgICAgQHBhcmFtIF9zeW1ib2wgICAgICB0b2tlbiBzeW1ib2wKICAgICAgICBAcGFyYW0gX2RlY2ltYWxzICAgIGRlY2ltYWwgcG9pbnRzLCBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgKi8KICAgIGZ1bmN0aW9uIEVSQzIwVG9rZW4oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCwgdWludDggX2RlY2ltYWxzKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoYnl0ZXMoX25hbWUpLmxlbmd0aCA+IDAgJiYgYnl0ZXMoX3N5bWJvbCkubGVuZ3RoID4gMCk7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBzeW1ib2wgPSBfc3ltYm9sOwogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgc2VuZCBjb2lucwogICAgICAgIHRocm93cyBvbiBhbnkgZXJyb3IgcmF0aGVyIHRoZW4gcmV0dXJuIGEgZmFsc2UgZmxhZyB0byBtaW5pbWl6ZSB1c2VyIGVycm9ycwoKICAgICAgICBAcGFyYW0gX3RvICAgICAgdGFyZ2V0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3ZhbHVlICAgdHJhbnNmZXIgYW1vdW50CgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwsIGZhbHNlIGlmIGl0IHdhc24ndAogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZEFkZHJlc3MoX3RvKQogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VPZlttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlT2ZbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZU9mW190b10sIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYW4gYWNjb3VudC9jb250cmFjdCBhdHRlbXB0cyB0byBnZXQgdGhlIGNvaW5zCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzCgogICAgICAgIEBwYXJhbSBfZnJvbSAgICBzb3VyY2UgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdG8gICAgICB0YXJnZXQgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdmFsdWUgICB0cmFuc2ZlciBhbW91bnQKCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2UgaWYgaXQgd2Fzbid0CiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZEFkZHJlc3MoX2Zyb20pCiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dhbmNlW19mcm9tXVttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlT2ZbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlT2ZbX2Zyb21dLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VPZltfdG9dID0gc2FmZUFkZChiYWxhbmNlT2ZbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYWxsb3cgYW5vdGhlciBhY2NvdW50L2NvbnRyYWN0IHRvIHNwZW5kIHNvbWUgdG9rZW5zIG9uIHlvdXIgYmVoYWxmCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzCgogICAgICAgIGFsc28sIHRvIG1pbmltaXplIHRoZSByaXNrIG9mIHRoZSBhcHByb3ZlL3RyYW5zZmVyRnJvbSBhdHRhY2sgdmVjdG9yCiAgICAgICAgKHNlZSBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFZTFB0UXhadTFVQXZPOWNaMU8yUlBYQmJUMG1vb2g0RFlLakFfanAtUkxNLyksIGFwcHJvdmUgaGFzIHRvIGJlIGNhbGxlZCB0d2ljZQogICAgICAgIGluIDIgc2VwYXJhdGUgdHJhbnNhY3Rpb25zIC0gb25jZSB0byBjaGFuZ2UgdGhlIGFsbG93YW5jZSB0byAwIGFuZCBzZWNvbmRseSB0byBjaGFuZ2UgaXQgdG8gdGhlIG5ldyBhbGxvd2FuY2UgdmFsdWUKCiAgICAgICAgQHBhcmFtIF9zcGVuZGVyIGFwcHJvdmVkIGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3ZhbHVlICAgYWxsb3dhbmNlIGFtb3VudAoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QKICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkQWRkcmVzcyhfc3BlbmRlcikKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgLy8gaWYgdGhlIGFsbG93YW5jZSBpc24ndCAwLCBpdCBjYW4gb25seSBiZSB1cGRhdGVkIHRvIDAgdG8gcHJldmVudCBhbiBhbGxvd2FuY2UgY2hhbmdlIGltbWVkaWF0ZWx5IGFmdGVyIHdpdGhkcmF3YWwKICAgICAgICByZXF1aXJlKF92YWx1ZSA9PSAwIHx8IGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCk7CgogICAgICAgIGFsbG93YW5jZVttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IEV0aGVyVG9rZW4gaXMgSUV0aGVyVG9rZW4sIE93bmVkLCBFUkMyMFRva2VuLCBUb2tlbkhvbGRlciB7CiAgICAvLyB0cmlnZ2VyZWQgd2hlbiB0aGUgdG90YWwgc3VwcGx5IGlzIGluY3JlYXNlZAogICAgZXZlbnQgSXNzdWFuY2UodWludDI1NiBfYW1vdW50KTsKICAgIC8vIHRyaWdnZXJlZCB3aGVuIHRoZSB0b3RhbCBzdXBwbHkgaXMgZGVjcmVhc2VkCiAgICBldmVudCBEZXN0cnVjdGlvbih1aW50MjU2IF9hbW91bnQpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBFdGhlclRva2VuKCkKICAgICAgICBwdWJsaWMKICAgICAgICBFUkMyMFRva2VuKCdFdGhlciBUb2tlbicsICdFVEgnLCAxOCkgewogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZGVwb3NpdCBldGhlciBpbiB0aGUgYWNjb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGRlcG9zaXQoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gc2FmZUFkZChiYWxhbmNlT2ZbbXNnLnNlbmRlcl0sIG1zZy52YWx1ZSk7IC8vIGFkZCB0aGUgdmFsdWUgdG8gdGhlIGFjY291bnQgYmFsYW5jZQogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgbXNnLnZhbHVlKTsgLy8gaW5jcmVhc2UgdGhlIHRvdGFsIHN1cHBseQoKICAgICAgICBJc3N1YW5jZShtc2cudmFsdWUpOwogICAgICAgIFRyYW5zZmVyKHRoaXMsIG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB3aXRoZHJhdyBldGhlciBmcm9tIHRoZSBhY2NvdW50CgogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgb2YgZXRoZXIgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50MjU2IF9hbW91bnQpIHB1YmxpYyB7CiAgICAgICAgd2l0aGRyYXdUbyhtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHdpdGhkcmF3IGV0aGVyIGZyb20gdGhlIGFjY291bnQgdG8gYSB0YXJnZXQgYWNjb3VudAoKICAgICAgICBAcGFyYW0gX3RvICAgICAgYWNjb3VudCB0byByZWNlaXZlIHRoZSBldGhlcgogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgb2YgZXRoZXIgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1RvKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgbm90VGhpcyhfdG8pCiAgICB7CiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlT2ZbbXNnLnNlbmRlcl0sIF9hbW91bnQpOyAvLyBkZWR1Y3QgdGhlIGFtb3VudCBmcm9tIHRoZSBhY2NvdW50IGJhbGFuY2UKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIF9hbW91bnQpOyAvLyBkZWNyZWFzZSB0aGUgdG90YWwgc3VwcGx5CiAgICAgICAgX3RvLnRyYW5zZmVyKF9hbW91bnQpOyAvLyBzZW5kIHRoZSBhbW91bnQgdG8gdGhlIHRhcmdldCBhY2NvdW50CgogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRoaXMsIF9hbW91bnQpOwogICAgICAgIERlc3RydWN0aW9uKF9hbW91bnQpOwogICAgfQoKICAgIC8vIEVSQzIwIHN0YW5kYXJkIG1ldGhvZCBvdmVycmlkZXMgd2l0aCBzb21lIGV4dHJhIHByb3RlY3Rpb24KCiAgICAvKioKICAgICAgICBAZGV2IHNlbmQgY29pbnMKICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMKCiAgICAgICAgQHBhcmFtIF90byAgICAgIHRhcmdldCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF92YWx1ZSAgIHRyYW5zZmVyIGFtb3VudAoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgbm90VGhpcyhfdG8pCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGFzc2VydChzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYW4gYWNjb3VudC9jb250cmFjdCBhdHRlbXB0cyB0byBnZXQgdGhlIGNvaW5zCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzCgogICAgICAgIEBwYXJhbSBfZnJvbSAgICBzb3VyY2UgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdG8gICAgICB0YXJnZXQgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdmFsdWUgICB0cmFuc2ZlciBhbW91bnQKCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2UgaWYgaXQgd2Fzbid0CiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICBub3RUaGlzKF90bykKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgYXNzZXJ0KHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGRlcG9zaXQgZXRoZXIgaW4gdGhlIGFjY291bnQKICAgICovCiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBkZXBvc2l0KCk7CiAgICB9Cn0KCmNvbnRyYWN0IFNtYXJ0VG9rZW4gaXMgSVNtYXJ0VG9rZW4sIE93bmVkLCBFUkMyMFRva2VuLCBUb2tlbkhvbGRlciB7CiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC4zJzsKCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkID0gdHJ1ZTsgICAgLy8gdHJ1ZSBpZiB0cmFuc2Zlci90cmFuc2ZlckZyb20gYXJlIGVuYWJsZWQsIGZhbHNlIGlmIG5vdAoKICAgIC8vIHRyaWdnZXJlZCB3aGVuIGEgc21hcnQgdG9rZW4gaXMgZGVwbG95ZWQgLSB0aGUgX3Rva2VuIGFkZHJlc3MgaXMgZGVmaW5lZCBmb3IgZm9yd2FyZCBjb21wYXRpYmlsaXR5LCBpbiBjYXNlIHdlIHdhbnQgdG8gdHJpZ2dlciB0aGUgZXZlbnQgZnJvbSBhIGZhY3RvcnkKICAgIGV2ZW50IE5ld1NtYXJ0VG9rZW4oYWRkcmVzcyBfdG9rZW4pOwogICAgLy8gdHJpZ2dlcmVkIHdoZW4gdGhlIHRvdGFsIHN1cHBseSBpcyBpbmNyZWFzZWQKICAgIGV2ZW50IElzc3VhbmNlKHVpbnQyNTYgX2Ftb3VudCk7CiAgICAvLyB0cmlnZ2VyZWQgd2hlbiB0aGUgdG90YWwgc3VwcGx5IGlzIGRlY3JlYXNlZAogICAgZXZlbnQgRGVzdHJ1Y3Rpb24odWludDI1NiBfYW1vdW50KTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSBfbmFtZSAgICAgICB0b2tlbiBuYW1lCiAgICAgICAgQHBhcmFtIF9zeW1ib2wgICAgIHRva2VuIHNob3J0IHN5bWJvbCwgbWluaW11bSAxIGNoYXJhY3RlcgogICAgICAgIEBwYXJhbSBfZGVjaW1hbHMgICBmb3IgZGlzcGxheSBwdXJwb3NlcyBvbmx5CiAgICAqLwogICAgZnVuY3Rpb24gU21hcnRUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMpCiAgICAgICAgcHVibGljCiAgICAgICAgRVJDMjBUb2tlbihfbmFtZSwgX3N5bWJvbCwgX2RlY2ltYWxzKQogICAgewogICAgICAgIE5ld1NtYXJ0VG9rZW4oYWRkcmVzcyh0aGlzKSk7CiAgICB9CgogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBvbmx5IHdoZW4gdHJhbnNmZXJzIGFyZW4ndCBkaXNhYmxlZAogICAgbW9kaWZpZXIgdHJhbnNmZXJzQWxsb3dlZCB7CiAgICAgICAgYXNzZXJ0KHRyYW5zZmVyc0VuYWJsZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcy9lbmFibGVzIHRyYW5zZmVycwogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgIHRydWUgdG8gZGlzYWJsZSB0cmFuc2ZlcnMsIGZhbHNlIHRvIGVuYWJsZSB0aGVtCiAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZVRyYW5zZmVycyhib29sIF9kaXNhYmxlKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gIV9kaXNhYmxlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgaW5jcmVhc2VzIHRoZSB0b2tlbiBzdXBwbHkgYW5kIHNlbmRzIHRoZSBuZXcgdG9rZW5zIHRvIGFuIGFjY291bnQKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCgogICAgICAgIEBwYXJhbSBfdG8gICAgICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgYW1vdW50IHRvIGluY3JlYXNlIHRoZSBzdXBwbHkgYnkKICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG8pCiAgICAgICAgbm90VGhpcyhfdG8pCiAgICB7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBfYW1vdW50KTsKICAgICAgICBiYWxhbmNlT2ZbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZU9mW190b10sIF9hbW91bnQpOwoKICAgICAgICBJc3N1YW5jZShfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcih0aGlzLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmVtb3ZlcyB0b2tlbnMgZnJvbSBhbiBhY2NvdW50IGFuZCBkZWNyZWFzZXMgdGhlIHRva2VuIHN1cHBseQogICAgICAgIGNhbiBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyIHRvIGRlc3Ryb3kgdG9rZW5zIGZyb20gYW55IGFjY291bnQgb3IgYnkgYW55IGhvbGRlciB0byBkZXN0cm95IHRva2VucyBmcm9tIGhpcy9oZXIgb3duIGFjY291bnQKCiAgICAgICAgQHBhcmFtIF9mcm9tICAgICAgIGFjY291bnQgdG8gcmVtb3ZlIHRoZSBhbW91bnQgZnJvbQogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gZGVjcmVhc2UgdGhlIHN1cHBseSBieQogICAgKi8KICAgIGZ1bmN0aW9uIGRlc3Ryb3koYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBfZnJvbSB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgYmFsYW5jZU9mW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZU9mW19mcm9tXSwgX2Ftb3VudCk7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCBfYW1vdW50KTsKCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIHRoaXMsIF9hbW91bnQpOwogICAgICAgIERlc3RydWN0aW9uKF9hbW91bnQpOwogICAgfQoKICAgIC8vIEVSQzIwIHN0YW5kYXJkIG1ldGhvZCBvdmVycmlkZXMgd2l0aCBzb21lIGV4dHJhIGZ1bmN0aW9uYWxpdHkKCiAgICAvKioKICAgICAgICBAZGV2IHNlbmQgY29pbnMKICAgICAgICB0aHJvd3Mgb24gYW55IGVycm9yIHJhdGhlciB0aGVuIHJldHVybiBhIGZhbHNlIGZsYWcgdG8gbWluaW1pemUgdXNlciBlcnJvcnMKICAgICAgICBpbiBhZGRpdGlvbiB0byB0aGUgc3RhbmRhcmQgY2hlY2tzLCB0aGUgZnVuY3Rpb24gdGhyb3dzIGlmIHRyYW5zZmVycyBhcmUgZGlzYWJsZWQKCiAgICAgICAgQHBhcmFtIF90byAgICAgIHRhcmdldCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF92YWx1ZSAgIHRyYW5zZmVyIGFtb3VudAoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBpZiBpdCB3YXNuJ3QKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB0cmFuc2ZlcnNBbGxvd2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFzc2VydChzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYW4gYWNjb3VudC9jb250cmFjdCBhdHRlbXB0cyB0byBnZXQgdGhlIGNvaW5zCiAgICAgICAgdGhyb3dzIG9uIGFueSBlcnJvciByYXRoZXIgdGhlbiByZXR1cm4gYSBmYWxzZSBmbGFnIHRvIG1pbmltaXplIHVzZXIgZXJyb3JzCiAgICAgICAgaW4gYWRkaXRpb24gdG8gdGhlIHN0YW5kYXJkIGNoZWNrcywgdGhlIGZ1bmN0aW9uIHRocm93cyBpZiB0cmFuc2ZlcnMgYXJlIGRpc2FibGVkCgogICAgICAgIEBwYXJhbSBfZnJvbSAgICBzb3VyY2UgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdG8gICAgICB0YXJnZXQgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdmFsdWUgICB0cmFuc2ZlciBhbW91bnQKCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2UgaWYgaXQgd2Fzbid0CiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHRyYW5zZmVyc0FsbG93ZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYXNzZXJ0KHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=='.
	

]
