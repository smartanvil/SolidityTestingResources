Class {
	#name : #SRT35fd00d47202b1b2158dba75e7cc8f71b068c256,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT35fd00d47202b1b2158dba75e7cc8f71b068c256 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4gMC40LjE3OwoKCmxpYnJhcnkgU2FmZU1hdGggewoKICAgIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSAgcmV0dXJucyh1aW50KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSAmJiBjID49IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgoKY29udHJhY3QgRVJDMjAgewogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludCk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMoYm9vbCBvayk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMoYm9vbCBvayk7CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wgb2spOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICAKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKICAgIC8qKgogICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgICogYWNjb3VudC4KICAgICovCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKfQoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgICBldmVudCBQYXVzZSgpOwogICAgZXZlbnQgVW5wYXVzZSgpOwoKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUocGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlKCkgcHVibGljIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIFBhdXNlKCk7CiAgICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5T3duZXIgd2hlblBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICAgICAgVW5wYXVzZSgpOwogICAgfQp9CgoKLy8gV2hpdGVsaXN0IHNtYXJ0IGNvbnRyYWN0Ci8vIFRoaXMgc21hcnQgY29udHJhY3Qga2VlcHMgbGlzdCBvZiBhZGRyZXNzZXMgdG8gd2hpdGVsaXN0CmNvbnRyYWN0IFdoaXRlTGlzdCBpcyBPd25hYmxlIHsKICAgIAogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyB3aGl0ZUxpc3Q7CiAgICB1aW50IHB1YmxpYyB0b3RhbFdoaXRlTGlzdGVkOyAvL3doaXRlIGxpc3RlZCB1c2VycyBudW1iZXIKCiAgICBldmVudCBMb2dXaGl0ZUxpc3RlZChhZGRyZXNzIGluZGV4ZWQgdXNlciwgdWludCB3aGl0ZUxpc3RlZE51bSk7CiAgICBldmVudCBMb2dXaGl0ZUxpc3RlZE11bHRpcGxlKHVpbnQgd2hpdGVMaXN0ZWROdW0pOwogICAgZXZlbnQgTG9nUmVtb3ZlV2hpdGVMaXN0ZWQoYWRkcmVzcyBpbmRleGVkIHVzZXIpOwoKICAgIC8vIEBub3RpY2UgaXQgd2lsbCByZXR1cm4gc3RhdHVzIG9mIHdoaXRlIGxpc3RpbmcKICAgIC8vIEByZXR1cm4gdHJ1ZSBpZiB1c2VyIGlzIHdoaXRlIGxpc3RlZCBhbmQgZmFsc2UgaWYgaXMgbm90CiAgICBmdW5jdGlvbiBpc1doaXRlTGlzdGVkKGFkZHJlc3MgX3VzZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICByZXR1cm4gd2hpdGVMaXN0W191c2VyXTsgCiAgICB9CgogICAgLy8gQG5vdGljZSBpdCB3aWxsIHJlbW92ZSB3aGl0ZWxpc3RlZCB1c2VyCiAgICAvLyBAcGFyYW0gX2NvbnRyaWJ1dG9yIHthZGRyZXNzfSBvZiB1c2VyIHRvIHVud2hpdGVsaXN0CiAgICBmdW5jdGlvbiByZW1vdmVGcm9tV2hpdGVMaXN0KGFkZHJlc3MgX3VzZXIpIGV4dGVybmFsIG9ubHlPd25lcigpIHJldHVybnMgKGJvb2wpIHsKICAgICAgIAogICAgICAgIHJlcXVpcmUod2hpdGVMaXN0W191c2VyXSA9PSB0cnVlKTsKICAgICAgICB3aGl0ZUxpc3RbX3VzZXJdID0gZmFsc2U7CiAgICAgICAgdG90YWxXaGl0ZUxpc3RlZC0tOwogICAgICAgIExvZ1JlbW92ZVdoaXRlTGlzdGVkKF91c2VyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIGl0IHdpbGwgd2hpdGUgbGlzdCBvbmUgbWVtYmVyCiAgICAvLyBAcGFyYW0gX3VzZXIge2FkZHJlc3N9IG9mIHVzZXIgdG8gd2hpdGVsaXN0CiAgICAvLyBAcmV0dXJuIHRydWUgaWYgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYWRkVG9XaGl0ZUxpc3QoYWRkcmVzcyBfdXNlcikgZXh0ZXJuYWwgb25seU93bmVyKCkgIHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgaWYgKHdoaXRlTGlzdFtfdXNlcl0gIT0gdHJ1ZSkgewogICAgICAgICAgICB3aGl0ZUxpc3RbX3VzZXJdID0gdHJ1ZTsKICAgICAgICAgICAgdG90YWxXaGl0ZUxpc3RlZCsrOwogICAgICAgICAgICBMb2dXaGl0ZUxpc3RlZChfdXNlciwgdG90YWxXaGl0ZUxpc3RlZCk7ICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEBub3RpY2UgaXQgd2lsbCB3aGl0ZSBsaXN0IG11bHRpcGxlIG1lbWJlcnMKICAgIC8vIEBwYXJhbSBfdXNlciB7YWRkcmVzc1tdfSBvZiB1c2VycyB0byB3aGl0ZWxpc3QKICAgIC8vIEByZXR1cm4gdHJ1ZSBpZiBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhZGRUb1doaXRlTGlzdE11bHRpcGxlKGFkZHJlc3NbXSBfdXNlcnMpIGV4dGVybmFsIG9ubHlPd25lcigpICByZXR1cm5zIChib29sKSB7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF91c2Vycy5sZW5ndGg7ICsraSkgewoKICAgICAgICAgICAgaWYgKHdoaXRlTGlzdFtfdXNlcnNbaV1dICE9IHRydWUpIHsKICAgICAgICAgICAgICAgIHdoaXRlTGlzdFtfdXNlcnNbaV1dID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRvdGFsV2hpdGVMaXN0ZWQrKzsgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9ICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgTG9nV2hpdGVMaXN0ZWRNdWx0aXBsZSh0b3RhbFdoaXRlTGlzdGVkKTsgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCgovLyBAbm90ZSB0aGlzIGNvbnRyYWN0IGNhbiBiZSBpbmhlcml0ZWQgYnkgQ3Jvd2RzYWxlIGFuZCBUZWFtQWxsb2NhdGlvbiBjb250cmFjdHMgYW5kCi8vIGNvbnRyb2wgcmVsZWFzZSBvZiB0b2tlbnMgdGhyb3VnaCBldmVuIHRpbWUgcmVsZWFzZSBiYXNlZCBvbiB0aGUgaW5wdXR0ZWQgZHVyYXRpb24gdGltZSBpbnRlcnZhbApjb250cmFjdCBUb2tlblZlc3RpbmcgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBzdHJ1Y3QgVG9rZW5Ib2xkZXIgewogICAgICAgIHVpbnQgd2VpUmVjZWl2ZWQ7IC8vIGFtb3VudCBvZiBFVEggY29udHJpYnV0ZWQKICAgICAgICB1aW50IHRva2Vuc1RvU2VuZDsgLy8gYW1vdW50IG9mIHRva2VucyAgc2VudCAgCiAgICAgICAgYm9vbCByZWZ1bmRlZDsgLy8gdHJ1ZSBpZiB1c2VyIGhhcyBiZWVuIHJlZnVuZGVkICAgICAgIAogICAgICAgIHVpbnQgcmVsZWFzZWRBbW91bnQ7IC8vIGFtb3VudCByZWxlYXNlZCB0aHJvdWdoIHZlc3Rpbmcgc2NoZWR1bGUKICAgICAgICBib29sIHJldm9rZWQ7IC8vIHRydWUgaWYgcmlnaHQgdG8gY29udGludWUgdmVzdGluZyBpcyByZXZva2VkCiAgICB9CgogICAgZXZlbnQgUmVsZWFzZWQodWludDI1NiBhbW91bnQsIHVpbnQyNTYgdG9rZW5EZWNpbWFscyk7CiAgICBldmVudCBDb250cmFjdFVwZGF0ZWQoYm9vbCBkb25lKTsKCiAgICB1aW50MjU2IHB1YmxpYyBjbGlmZjsgIC8vIHRpbWUgaW4gIHdoZW4gdmVzdGluZyBzaG91bGQgYmVnaW4KICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0Q291bnREb3duOyAgLy8gdGltZSB3aGVuIGNvdW50ZG93biBzdGFydHMKICAgIHVpbnQyNTYgcHVibGljIGR1cmF0aW9uOyAvLyBkdXJhdGlvbiBvZiBwZXJpb2QgaW4gd2hpY2ggdmVzdGluZyB0YWtlcyBwbGFjZSAgIAogICAgVG9rZW4gcHVibGljIHRva2VuOyAgLy8gdG9rZW4gY29udHJhY3QgY29udGFpbmluZyB0b2tlbnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBUb2tlbkhvbGRlcikgcHVibGljIHRva2VuSG9sZGVyczsgLy90b2tlbkhvbGRlciBsaXN0CiAgICBXaGl0ZUxpc3QgcHVibGljIHdoaXRlTGlzdDsgLy8gd2hpdGVsaXN0IGNvbnRyYWN0CiAgICB1aW50MjU2IHB1YmxpYyBwcmVzYWxlQm9udXM7CiAgICAKICAgIC8vIEBub3RlIGNvbnN0cnVjdG9yIAogICAgLyoqCiAgICBmdW5jdGlvbiBUb2tlblZlc3RpbmcodWludDI1NiBfc3RhcnQsIHVpbnQyNTYgX2NsaWZmLCB1aW50MjU2IF9kdXJhdGlvbikgcHVibGljIHsgICAKICAgICAgICAgcmVxdWlyZShfY2xpZmYgPD0gX2R1cmF0aW9uKTsgICAKICAgICAgICBkdXJhdGlvbiA9IF9kdXJhdGlvbjsKICAgICAgICBjbGlmZiA9IF9zdGFydC5hZGQoX2NsaWZmKTsKICAgICAgICBzdGFydENvdW50RG93biA9IF9zdGFydDsgICAgICAgICAKICAgICAgICBDb250cmFjdFVwZGF0ZWQodHJ1ZSk7ICAgICAgICAgICAgICAgICAgICAKICAgIH0KICAgICovCiAgICAvLyBAbm90aWNlIFNwZWNpZnkgYWRkcmVzcyBvZiB0b2tlbiBjb250cmFjdAogICAgLy8gQHBhcmFtIF90b2tlbkFkZHJlc3Mge2FkZHJlc3N9IGFkZHJlc3Mgb2YgdG9rZW4gY29udHJhY3QKICAgIC8vIEByZXR1cm4gcmVzIHtib29sfQogICAgZnVuY3Rpb24gaW5pdGlsaXplVmVzdGluZ0FuZFRva2VuQW5kV2hpdGVMaXN0KFRva2VuIF90b2tlbkFkZHJlc3MsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfc3RhcnQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfY2xpZmYsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9wcmVzYWxlQm9udXMsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2hpdGVMaXN0IF93aGl0ZUxpc3QpIGV4dGVybmFsIG9ubHlPd25lcigpIHJldHVybnMoYm9vbCByZXMpIHsKICAgICAgICByZXF1aXJlKF9jbGlmZiA8PSBfZHVyYXRpb24pOyAgIAogICAgICAgIHJlcXVpcmUoX3Rva2VuQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBkdXJhdGlvbiA9IF9kdXJhdGlvbjsKICAgICAgICBjbGlmZiA9IF9zdGFydC5hZGQoX2NsaWZmKTsKICAgICAgICBzdGFydENvdW50RG93biA9IF9zdGFydDsgIAogICAgICAgIHRva2VuID0gX3Rva2VuQWRkcmVzczsgCiAgICAgICAgd2hpdGVMaXN0ID0gX3doaXRlTGlzdDsKICAgICAgICBwcmVzYWxlQm9udXMgPSBfcHJlc2FsZUJvbnVzOwogICAgICAgIENvbnRyYWN0VXBkYXRlZCh0cnVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsgICAgCiAgICB9CgogICAgLy8gQG5vdGljZSBTcGVjaWZ5IGFkZHJlc3Mgb2YgdG9rZW4gY29udHJhY3QKICAgIC8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIHthZGRyZXNzfSBhZGRyZXNzIG9mIHRva2VuIGNvbnRyYWN0CiAgICAvLyBAcmV0dXJuIHJlcyB7Ym9vbH0KICAgIGZ1bmN0aW9uIGluaXRpbGl6ZVZlc3RpbmdBbmRUb2tlbihUb2tlbiBfdG9rZW5BZGRyZXNzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX3N0YXJ0LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX2NsaWZmLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfcHJlc2FsZUJvbnVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIGV4dGVybmFsIG9ubHlPd25lcigpIHJldHVybnMoYm9vbCByZXMpIHsKICAgICAgICByZXF1aXJlKF9jbGlmZiA8PSBfZHVyYXRpb24pOyAgIAogICAgICAgIHJlcXVpcmUoX3Rva2VuQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBkdXJhdGlvbiA9IF9kdXJhdGlvbjsKICAgICAgICBjbGlmZiA9IF9zdGFydC5hZGQoX2NsaWZmKTsKICAgICAgICBzdGFydENvdW50RG93biA9IF9zdGFydDsgIAogICAgICAgIHRva2VuID0gX3Rva2VuQWRkcmVzczsgICAgICAgIAogICAgICAgIHByZXNhbGVCb251cyA9IF9wcmVzYWxlQm9udXM7CiAgICAgICAgQ29udHJhY3RVcGRhdGVkKHRydWUpOwogICAgICAgIHJldHVybiB0cnVlOyAgICAKICAgIH0KCiAgICBmdW5jdGlvbiByZXR1cm5WZXN0aW5nU2NoZWR1bGUoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQsIHVpbnQsIHVpbnQpIHsKCiAgICAgICAgcmV0dXJuIChkdXJhdGlvbiwgY2xpZmYsIHN0YXJ0Q291bnREb3duKTsKICAgIH0KCiAgICAvLyBAbm90ZSBvd25lciBjYW4gcmV2b2tlIGFjY2VzcyB0byBjb250aW51ZSB2ZXN0aW5nIG9mIHRva2VucwogICAgLy8gQHBhcmFtIF91c2VyIHthZGRyZXNzfSBvZiB1c2VyIHRvIHJldm9rZSB0aGVpciByaWdodCB0byB2ZXN0aW5nCiAgICBmdW5jdGlvbiByZXZva2UoYWRkcmVzcyBfdXNlcikgcHVibGljIG9ubHlPd25lcigpIHsKCiAgICAgICAgVG9rZW5Ib2xkZXIgc3RvcmFnZSB0b2tlbkhvbGRlciA9IHRva2VuSG9sZGVyc1tfdXNlcl07CiAgICAgICAgdG9rZW5Ib2xkZXIucmV2b2tlZCA9IHRydWU7IAogICAgfQoKICAgIGZ1bmN0aW9uIHZlc3RlZEFtb3VudEF2YWlsYWJsZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYW1vdW50LCB1aW50IGRlY2ltYWxzKSB7CgogICAgICAgIFRva2VuSG9sZGVyIHN0b3JhZ2UgdG9rZW5Ib2xkZXIgPSB0b2tlbkhvbGRlcnNbbXNnLnNlbmRlcl07CiAgICAgICAgdWludCB0b2tlbnNUb1JlbGVhc2UgPSB2ZXN0ZWRBbW91bnQodG9rZW5Ib2xkZXIudG9rZW5zVG9TZW5kKTsKCiAgICAgLy8gICBpZiAodG9rZW5Ib2xkZXIucmVsZWFzZWRBbW91bnQgKyB0b2tlbnNUb1JlbGVhc2UgPiB0b2tlbkhvbGRlci50b2tlbnNUb1NlbmQpCiAgICAgIC8vICAgICAgcmV0dXJuICh0b2tlbkhvbGRlci50b2tlbnNUb1NlbmQgLSB0b2tlbkhvbGRlci5yZWxlYXNlZEFtb3VudCwgdG9rZW4uZGVjaW1hbHMoKSk7CiAgICAgLy8gICBlbHNlIAogICAgICAgIHJldHVybiAodG9rZW5zVG9SZWxlYXNlIC0gdG9rZW5Ib2xkZXIucmVsZWFzZWRBbW91bnQsIHRva2VuLmRlY2ltYWxzKCkpOwogICAgfQogICAgCiAgICAvLyBAbm90aWNlIFRyYW5zZmVycyB2ZXN0ZWQgYXZhaWxhYmxlIHRva2VucyB0byBiZW5lZmljaWFyeSAgIAogICAgZnVuY3Rpb24gcmVsZWFzZSgpIHB1YmxpYyB7CgogICAgICAgIFRva2VuSG9sZGVyIHN0b3JhZ2UgdG9rZW5Ib2xkZXIgPSB0b2tlbkhvbGRlcnNbbXNnLnNlbmRlcl07ICAgICAgICAKICAgICAgICAvLyBjaGVjayBpZiByaWdodCB0byB2ZXN0aW5nIGlzIG5vdCByZXZva2VkCiAgICAgICAgcmVxdWlyZSghdG9rZW5Ib2xkZXIucmV2b2tlZCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICB1aW50IHRva2Vuc1RvUmVsZWFzZSA9IHZlc3RlZEFtb3VudCh0b2tlbkhvbGRlci50b2tlbnNUb1NlbmQpOyAgICAgIAogICAgICAgIHVpbnQgY3VycmVudFRva2VuVG9SZWxlYXNlID0gdG9rZW5zVG9SZWxlYXNlIC0gdG9rZW5Ib2xkZXIucmVsZWFzZWRBbW91bnQ7CiAgICAgICAgdG9rZW5Ib2xkZXIucmVsZWFzZWRBbW91bnQgKz0gY3VycmVudFRva2VuVG9SZWxlYXNlOyAgICAgICAgICAgIAogICAgICAgIHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGN1cnJlbnRUb2tlblRvUmVsZWFzZSk7CgogICAgICAgIFJlbGVhc2VkKGN1cnJlbnRUb2tlblRvUmVsZWFzZSwgdG9rZW4uZGVjaW1hbHMoKSk7CiAgICB9CiAgCiAgICAvLyBAbm90aWNlIHRoaXMgZnVuY3Rpb24gd2lsbCBkZXRlcm1pbmUgdmVzdGVkIGFtb3VudAogICAgLy8gQHBhcmFtIF90b3RhbEJhbGFuY2Uge3VpbnR9IHRvdGFsIGJhbGFuY2Ugb2YgdG9rZW5zIGFzc2lnbmVkIHRvIHRoaXMgdXNlcgogICAgLy8gQHJldHVybiB7dWludH0gYW1vdW50IG9mIHRva2VucyBhdmFpbGFibGUgdG8gdHJhbnNmZXIKICAgIGZ1bmN0aW9uIHZlc3RlZEFtb3VudCh1aW50IF90b3RhbEJhbGFuY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgaWYgKG5vdyA8IGNsaWZmKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0gZWxzZSBpZiAobm93ID49IHN0YXJ0Q291bnREb3duLmFkZChkdXJhdGlvbikpIHsKICAgICAgICAgICAgcmV0dXJuIF90b3RhbEJhbGFuY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIF90b3RhbEJhbGFuY2UubXVsKG5vdy5zdWIoc3RhcnRDb3VudERvd24pKSAvIGR1cmF0aW9uOwogICAgICAgIH0KICAgIH0KfQoKCi8vIENyb3dkc2FsZSBTbWFydCBDb250cmFjdAovLyBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvbGxlY3RzIEVUSCBhbmQgaW4gcmV0dXJuIHNlbmRzICB0b2tlbnMgdG8gdGhlIEJhY2tlcnMKY29udHJhY3QgQ3Jvd2RzYWxlIGlzIFBhdXNhYmxlLCBUb2tlblZlc3RpbmcgewoKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIGFkZHJlc3MgcHVibGljIG11bHRpc2lnRVRIOyAvLyBNdWx0aXNpZyBjb250cmFjdCB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgRVRICiAgICBhZGRyZXNzIHB1YmxpYyBjb21taXNzaW9uQWRkcmVzczsgIC8vIGFkZHJlc3MgdG8gZGVwb3NpdCBjb21taXNzaW9ucwogICAgdWludCBwdWJsaWMgdG9rZW5zRm9yVGVhbTsgLy8gdG9rZW5zIGZvciB0aGUgdGVhbQogICAgdWludCBwdWJsaWMgZXRoUmVjZWl2ZWRQcmVzYWxlOyAvLyBOdW1iZXIgb2YgRVRIIHJlY2VpdmVkIGluIHByZXNhbGUKICAgIHVpbnQgcHVibGljIGV0aFJlY2VpdmVkTWFpbjsgLy8gTnVtYmVyIG9mIEVUSCByZWNlaXZlZCBpbiBtYWluIHNhbGUKICAgIHVpbnQgcHVibGljIHRvdGFsVG9rZW5zU2VudDsgLy8gTnVtYmVyIG9mIHRva2VucyBzZW50IHRvIEVUSCBjb250cmlidXRvcnMKICAgIHVpbnQgcHVibGljIHRva2Vuc1NlbnRNYWluOwogICAgdWludCBwdWJsaWMgdG9rZW5zU2VudFByZXNhbGU7ICAgICAgIAogICAgdWludCBwdWJsaWMgdG9rZW5zU2VudERldjsgICAgICAgICAKICAgIHVpbnQgcHVibGljIHN0YXJ0QmxvY2s7IC8vIENyb3dkc2FsZSBzdGFydCBibG9jawogICAgdWludCBwdWJsaWMgZW5kQmxvY2s7IC8vIENyb3dkc2FsZSBlbmQgYmxvY2sKICAgIHVpbnQgcHVibGljIG1heENhcDsgLy8gTWF4aW11bSBudW1iZXIgb2YgdG9rZW4gdG8gc2VsbAogICAgdWludCBwdWJsaWMgbWluQ2FwOyAvLyBNaW5pbXVtIG51bWJlciBvZiBFVEggdG8gcmFpc2UKICAgIHVpbnQgcHVibGljIG1pbkNvbnRyaWJ1dGlvbk1haW5TYWxlOyAvLyBNaW5pbXVtIGFtb3VudCB0byBjb250cmlidXRlIGluIG1haW4gc2FsZQogICAgdWludCBwdWJsaWMgbWluQ29udHJpYnV0aW9uUHJlc2FsZTsgLy8gTWluaW11bSBhbW91bnQgdG8gY29udHJpYnV0IGluIHByZXNhbGUKICAgIHVpbnQgcHVibGljIG1heENvbnRyaWJ1dGlvbjsKICAgIGJvb2wgcHVibGljIGNyb3dkc2FsZUNsb3NlZDsgLy8gSXMgY3Jvd2RzYWxlIHN0aWxsIG9uIGdvaW5nCiAgICB1aW50IHB1YmxpYyB0b2tlblByaWNlV2VpOwogICAgdWludCBwdWJsaWMgcmVmdW5kQ291bnQ7CiAgICB1aW50IHB1YmxpYyB0b3RhbFJlZnVuZGVkOwogICAgdWludCBwdWJsaWMgY2FtcGFpZ25EdXJhdGlvbkRheXM7IC8vIGNhbXBhaWduIGR1cmF0aW9uIGluIGRheXMgCiAgICB1aW50IHB1YmxpYyBmaXJzdFBlcmlvZDsgCiAgICB1aW50IHB1YmxpYyBzZWNvbmRQZXJpb2Q7IAogICAgdWludCBwdWJsaWMgdGhpcmRQZXJpb2Q7IAogICAgdWludCBwdWJsaWMgZmlyc3RCb251czsgCiAgICB1aW50IHB1YmxpYyBzZWNvbmRCb251czsKICAgIHVpbnQgcHVibGljIHRoaXJkQm9udXM7CiAgICB1aW50IHB1YmxpYyBtdWx0aXBsaWVyOwogICAgdWludCBwdWJsaWMgc3RhdHVzOyAgICAKICAgIFN0ZXAgcHVibGljIGN1cnJlbnRTdGVwOyAgLy8gVG8gYWxsb3cgZm9yIGNvbnRyb2xsZWQgc3RlcHMgb2YgdGhlIGNhbXBhaWduIAogICAKICAgIC8vIExvb3BpbmcgdGhyb3VnaCBCYWNrZXIKICAgIC8vbWFwcGluZyhhZGRyZXNzID0+IEJhY2tlcikgcHVibGljIGJhY2tlcnM7IC8vYmFja2VyIGxpc3QKICAgIGFkZHJlc3NbXSBwdWJsaWMgaG9sZGVyc0luZGV4OyAgIC8vIHRvIGJlIGFibGUgdG8gaXRhcmF0ZSB0aHJvdWdoIGJhY2tlcnMgd2hlbiBkaXN0cmlidXRpbmcgdGhlIHRva2VucwogICAgYWRkcmVzc1tdIHB1YmxpYyBkZXZJbmRleDsgICAvLyB0byBiZSBhYmxlIHRvIGl0YXJhdGUgdGhyb3VnaCBiYWNrZXJzIHdoZW4gZGlzdHJpYnV0aW5nIHRoZSB0b2tlbnMKCiAgICAvLyBAbm90aWNlIHRvIHNldCBhbmQgZGV0ZXJtaW5lIHN0ZXBzIG9mIGNyb3dkc2FsZQogICAgZW51bSBTdGVwIHsgICAgICAKICAgICAgICBGdW5kaW5nUHJlU2FsZSwgICAgIC8vIHByZXNhbGUgbW9kZQogICAgICAgIEZ1bmRpbmdNYWluU2FsZSwgIC8vIHB1YmxpYyBtb2RlCiAgICAgICAgUmVmdW5kaW5nICAvLyBpbiBjYXNlIGNhbXBhaWduIGZhaWxlZCBkdXJpbmcgdGhpcyBzdGVwIGNvbnRyaWJ1dG9ycyB3aWxsIGJlIGFibGUgdG8gcmVjZWl2ZSByZWZ1bmRzCiAgICB9CgogICAgLy8gQG5vdGljZSB0byB2ZXJpZnkgaWYgYWN0aW9uIGlzIG5vdCBwZXJmb3JtZWQgb3V0IG9mIHRoZSBjYW1wYWluZyByYW5nZQogICAgbW9kaWZpZXIgcmVzcGVjdFRpbWVGcmFtZSgpIHsKICAgICAgICBpZiAoKGJsb2NrLm51bWJlciA8IHN0YXJ0QmxvY2spIHx8IChibG9jay5udW1iZXIgPiBlbmRCbG9jaykpIAogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG1pbkNhcE5vdFJlYWNoZWQoKSB7CiAgICAgICAgaWYgKHRvdGFsVG9rZW5zU2VudCA+PSBtaW5DYXApIAogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgTG9nUmVjZWl2ZWRFVEgoYWRkcmVzcyBpbmRleGVkIGJhY2tlciwgdWludCBhbW91bnQsIHVpbnQgdG9rZW5BbW91bnQpOwogICAgZXZlbnQgTG9nU3RhcnRlZCh1aW50IHN0YXJ0QmxvY2tMb2csIHVpbnQgZW5kQmxvY2tMb2cpOwogICAgZXZlbnQgTG9nRmluYWxpemVkKGJvb2wgc3VjY2Vzcyk7ICAKICAgIGV2ZW50IExvZ1JlZnVuZEVUSChhZGRyZXNzIGluZGV4ZWQgYmFja2VyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMb2dTdGVwQWR2YW5jZWQoKTsKICAgIGV2ZW50IExvZ0RldlRva2Vuc0FsbG9jYXRlZChhZGRyZXNzIGluZGV4ZWQgZGV2LCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMb2dOb25WZXN0ZWRUb2tlbnNTZW50KGFkZHJlc3MgaW5kZXhlZCB1c2VyLCB1aW50IGFtb3VudCk7CgogICAgLy8gQ3Jvd2RzYWxlICB7Y29uc3RydWN0b3J9CiAgICAvLyBAbm90aWNlIGZpcmVkIHdoZW4gY29udHJhY3QgaXMgY3JhdGVkLiBJbml0aWxpemVzIGFsbCBjb25zdG5hdCB2YXJpYWJsZXMuCiAgICBmdW5jdGlvbiBDcm93ZHNhbGUodWludCBfZGVjaW1hbFBvaW50cywKICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfbXVsdGlzaWdFVEgsCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX3RvZWtlbnNGb3JUZWFtLCAKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfbWluQ29udHJpYnV0aW9uUHJlc2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfbWluQ29udHJpYnV0aW9uTWFpblNhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX21heENvbnRyaWJ1dGlvbiwgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfbWF4Q2FwLCAKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfbWluQ2FwLCAKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfdG9rZW5QcmljZVdlaSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2NhbXBhaWduRHVyYXRpb25EYXlzLAogICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9maXJzdFBlcmlvZCwgCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX3NlY29uZFBlcmlvZCwgCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX3RoaXJkUGVyaW9kLCAKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfZmlyc3RCb251cywgCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX3NlY29uZEJvbnVzLAogICAgICAgICAgICAgICAgICAgICAgICB1aW50IF90aGlyZEJvbnVzKSBwdWJsaWMgewogICAgICAgIG11bHRpcGxpZXIgPSAxMCoqX2RlY2ltYWxQb2ludHM7CiAgICAgICAgbXVsdGlzaWdFVEggPSBfbXVsdGlzaWdFVEg7IAogICAgICAgIHRva2Vuc0ZvclRlYW0gPSBfdG9la2Vuc0ZvclRlYW0gKiBtdWx0aXBsaWVyOyAKICAgICAgICBtaW5Db250cmlidXRpb25QcmVzYWxlID0gX21pbkNvbnRyaWJ1dGlvblByZXNhbGU7IAogICAgICAgIG1pbkNvbnRyaWJ1dGlvbk1haW5TYWxlID0gX21pbkNvbnRyaWJ1dGlvbk1haW5TYWxlOwogICAgICAgIG1heENvbnRyaWJ1dGlvbiA9IF9tYXhDb250cmlidXRpb247ICAgICAgIAogICAgICAgIG1heENhcCA9IF9tYXhDYXAgKiBtdWx0aXBsaWVyOyAgICAgICAKICAgICAgICBtaW5DYXAgPSBfbWluQ2FwICogbXVsdGlwbGllcjsKICAgICAgICB0b2tlblByaWNlV2VpID0gX3Rva2VuUHJpY2VXZWk7CiAgICAgICAgY2FtcGFpZ25EdXJhdGlvbkRheXMgPSBfY2FtcGFpZ25EdXJhdGlvbkRheXM7CiAgICAgICAgZmlyc3RQZXJpb2QgPSBfZmlyc3RQZXJpb2Q7IAogICAgICAgIHNlY29uZFBlcmlvZCA9IF9zZWNvbmRQZXJpb2Q7IAogICAgICAgIHRoaXJkUGVyaW9kID0gX3RoaXJkUGVyaW9kOwogICAgICAgIGZpcnN0Qm9udXMgPSBfZmlyc3RCb251czsKICAgICAgICBzZWNvbmRCb251cyA9IF9zZWNvbmRCb251czsKICAgICAgICB0aGlyZEJvbnVzID0gX3RoaXJkQm9udXM7ICAgICAgIAogICAgICAgIC8vVE9ETyByZXBsYWNlIHRoaXMgYWRkcmVzcyBiZWxvdyB3aXRoIGNvcnJlY3QgYWRkcmVzcy4KICAgICAgICBjb21taXNzaW9uQWRkcmVzcyA9IDB4MzI2QjVFOWI4QjJlYmY0MTVGOWU5MWI0MmM3OTExMjc5ZDI5NmVhMTsKICAgICAgICAvL2NvbW1pc3Npb25BZGRyZXNzID0gMHg4NTNBM0YxNDI0MzA2NThBMzJmNzVBMGRjODkxYjk4QkY0YkRGNWMxOwogICAgICAgIGN1cnJlbnRTdGVwID0gU3RlcC5GdW5kaW5nUHJlU2FsZTsgCiAgICB9CgogICAgLy8gQG5vdGljZSB0byBwb3B1bGF0ZSB3ZWJzaXRlIHdpdGggc3RhdHVzIG9mIHRoZSBzYWxlIAogICAgZnVuY3Rpb24gcmV0dXJuV2Vic2l0ZURhdGEoKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludCwgCiAgICAgICAgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgYm9vbCwgYm9vbCwgdWludCwgU3RlcCkgewogICAgCiAgICAgICAgcmV0dXJuIChzdGFydEJsb2NrLCBlbmRCbG9jaywgbnVtYmVyT2ZCYWNrZXJzKCksIGV0aFJlY2VpdmVkUHJlc2FsZSArIGV0aFJlY2VpdmVkTWFpbiwgbWF4Q2FwLCBtaW5DYXAsIAogICAgICAgICAgICAgICAgdG90YWxUb2tlbnNTZW50LCB0b2tlblByaWNlV2VpLCBtaW5Db250cmlidXRpb25QcmVzYWxlLCBtaW5Db250cmlidXRpb25NYWluU2FsZSwgCiAgICAgICAgICAgICAgICBwYXVzZWQsIGNyb3dkc2FsZUNsb3NlZCwgdG9rZW4uZGVjaW1hbHMoKSwgY3VycmVudFN0ZXApOwogICAgfQogICAgCiAgICAvLyBAbm90aWNlIHRoaXMgZnVuY3Rpb24gd2lsbCBkZXRlcm1pbmUgc3RhdHVzIG9mIGNyb3dkc2FsZQogICAgZnVuY3Rpb24gZGV0ZXJtaW5lU3RhdHVzKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAKICAgICAgICBpZiAoY3Jvd2RzYWxlQ2xvc2VkKSAgICAgICAgICAgIC8vIElDTyBmaW5paHNlZAogICAgICAgICAgICByZXR1cm4gMTsgICAKCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8IGVuZEJsb2NrICYmIHRvdGFsVG9rZW5zU2VudCA8IG1heENhcCAtIDEwMCkgICAvLyBJQ08gaW4gcHJvZ3Jlc3MKICAgICAgICAgICAgcmV0dXJuIDI7ICAgICAgICAgICAgCiAgICAKICAgICAgICBpZiAodG90YWxUb2tlbnNTZW50IDwgbWluQ2FwICYmIGJsb2NrLm51bWJlciA+IGVuZEJsb2NrKSAgICAgIC8vIElDTyBmYWlsZWQgICAgCiAgICAgICAgICAgIHJldHVybiAzOyAgICAgICAgICAgIAogICAgCiAgICAgICAgaWYgKGVuZEJsb2NrID09IDApICAgICAgICAgICAvLyBJQ08gaGFzbid0IGJlZW4gc3RhcnRlZCB5ZXQgCiAgICAgICAgICAgIHJldHVybiA0OyAgICAgICAgICAgIAogICAgCiAgICAgICAgcmV0dXJuIDA7ICAgICAgICAgCiAgICB9IAoKICAgIC8vIHtmYWxsYmFjayBmdW5jdGlvbn0KICAgIC8vIEBub3RpY2UgSXQgd2lsbCBjYWxsIGludGVybmFsIGZ1bmN0aW9uIHdoaWNoIGhhbmRlbHMgYWxsb2NhdGlvbiBvZiBFdGhlciBhbmQgY2FsY3VsYXRlcyB0b2tlbnMuCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7ICAgIAogICAgICAgICAgICAgCiAgICAgICAgY29udHJpYnV0ZShtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvLyBAbm90aWNlIHRvIGFsbG93IGZvciBjb250cmlidXRpb24gZnJvbSBpbnRlcmZhY2UKICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGVQdWJsaWMoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBjb250cmlidXRlKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIEBub3RpY2Ugc2V0IHRoZSBzdGVwIG9mIHRoZSBjYW1wYWlnbiBmcm9tIHByZXNhbGUgdG8gcHVibGljIHNhbGUKICAgIC8vIGNvbnRyYWN0IGlzIGRlcGxveWVkIGluIHByZXNhbGUgbW9kZQogICAgLy8gV0FSTklORzogdGhlcmUgaXMgbm8gd2F5IHRvIGdvIGJhY2sKICAgIGZ1bmN0aW9uIGFkdmFuY2VTdGVwKCkgZXh0ZXJuYWwgb25seU93bmVyKCkgewogICAgICAgIGN1cnJlbnRTdGVwID0gU3RlcC5GdW5kaW5nTWFpblNhbGU7CiAgICAgICAgTG9nU3RlcEFkdmFuY2VkKCk7CiAgICB9CgogICAgLy8gQG5vdGljZSBJdCB3aWxsIGJlIGNhbGxlZCBieSBvd25lciB0byBzdGFydCB0aGUgc2FsZSAgICAKICAgIGZ1bmN0aW9uIHN0YXJ0KCkgZXh0ZXJuYWwgb25seU93bmVyKCkgewogICAgICAgIHN0YXJ0QmxvY2sgPSBibG9jay5udW1iZXI7CiAgICAgICAgZW5kQmxvY2sgPSBzdGFydEJsb2NrICsgKDQqNjAqMjQqY2FtcGFpZ25EdXJhdGlvbkRheXMpOyAvLyBhc3N1bXB0aW9uIGlzIHRoYXQgb25lIGJsb2NrIHRha2VzIDE1IHNlYy4gCiAgICAgICAgY3Jvd2RzYWxlQ2xvc2VkID0gZmFsc2U7CiAgICAgICAgTG9nU3RhcnRlZChzdGFydEJsb2NrLCBlbmRCbG9jayk7CiAgICB9CgogICAgLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIHdpbGwgZmluYWxpemUgdGhlIHNhbGUuCiAgICAvLyBJdCB3aWxsIG9ubHkgZXhlY3V0ZSBpZiBwcmVkZXRlcm1pbmVkIHNhbGUgdGltZSBwYXNzZWQgb3IgYWxsIHRva2VucyBhcmUgc29sZC4KICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgZXh0ZXJuYWwgb25seU93bmVyKCkgewoKICAgICAgICByZXF1aXJlKCFjcm93ZHNhbGVDbG9zZWQpOyAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPj0gZW5kQmxvY2sgfHwgdG90YWxUb2tlbnNTZW50ID4gbWF4Q2FwIC0gMTAwMCk7CiAgICAgICAgICAgICAgICAgICAgLy8gLSAxMDAwIGlzIHVzZWQgdG8gYWxsb3cgY2xvc2luZyBvZiB0aGUgY2FtcGFpbmcgd2hlbiBjb250cmlidXRpb24gaXMgbmVhciAKICAgICAgICAgICAgICAgICAgICAvLyBmaW5pc2hlZCBhcyBleGFjdCBhbW91bnQgb2YgbWF4Q2FwIG1pZ2h0IGJlIG5vdCBmZWFzaWJsZSBlLmcuIHlvdSBjYW4ndCBlYXNpbHkgYnV5IGZldyB0b2tlbnMuIAogICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gbWluIGNvbnRyaWJ1dGlvbiBpcyAwLjEgRXRoLiAgCgogICAgICAgIHJlcXVpcmUodG90YWxUb2tlbnNTZW50ID49IG1pbkNhcCk7CiAgICAgICAgY3Jvd2RzYWxlQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAKICAgICAgICAvLyB0cmFuc2ZlciBjb21taXNzaW9uIHBvcnRpb24gdG8gdGhlIHBsYXRmb3JtCiAgICAgICAgY29tbWlzc2lvbkFkZHJlc3MudHJhbnNmZXIoZGV0ZXJtaW5lQ29tbWlzc2lvbnMoKSk7ICAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gdHJhbnNmZXIgcmVtYW5pbmcgZnVuZHMgdG8gdGhlIGNhbXBhaWduIHdhbGxldAogICAgICAgIG11bHRpc2lnRVRILnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgCiAgICAgICAgLyppZiAoIXRva2VuLnRyYW5zZmVyKG93bmVyLCB0b2tlbi5iYWxhbmNlT2YodGhpcykpKSAKICAgICAgICAgICAgcmV2ZXJ0KCk7IC8vIHRyYW5zZmVyIHRva2VucyB0byBhZG1pbiBhY2NvdW50ICAKICAgICAgICAgICAgCiAgICAgICAgaWYgKCF0b2tlbi5idXJuKHRoaXMsIHRva2VuLmJhbGFuY2VPZih0aGlzKSkpIAogICAgICAgICAgICByZXZlcnQoKTsgIC8vIGJ1cm4gYWxsIHRoZSB0b2tlbnMgcmVtYWluaW5nIGluIHRoZSBjb250cmFjdCAgICovCiAgICAgICAgdG9rZW4udW5sb2NrKCk7ICAgIC8vIHJlbGVhc2UgbG9jayBmcm9tIHRyYW5zZmVyaW5nIHRva2Vucy4gCgogICAgICAgIExvZ0ZpbmFsaXplZCh0cnVlKTsgICAgICAgIAogICAgfQoKICAgIC8vIEBub3RpY2UgaXQgd2lsbCBhbGxvdyBjb250cmlidXRvcnMgdG8gZ2V0IHJlZnVuZCBpbiBjYXNlIGNhbXBhaWduIGZhaWxlZAogICAgLy8gQHJldHVybiB7Ym9vbH0gdHJ1ZSBpZiBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiByZWZ1bmQoKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsgICAgICAKICAgICAgICAKICAgICAgICB1aW50IHRvdGFsRXRoZXJSZWNlaXZlZCA9IGV0aFJlY2VpdmVkUHJlc2FsZSArIGV0aFJlY2VpdmVkTWFpbjsKCiAgICAgICAgcmVxdWlyZSh0b3RhbEV0aGVyUmVjZWl2ZWQgPCBtaW5DYXApOyAgLy8gZW5zdXJlIHRoYXQgY2FtcGFpZ24gZmFpbGVkCiAgICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPiAwKTsgIC8vIGNvbnRyYWN0IHdpbGwgaG9sZCAwIGV0aGVyIGF0IHRoZSBlbmQgb2YgY2FtcGFpZ24uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnRyYWN0IG5lZWRzIHRvIGJlIGZ1bmRlZCB0aHJvdWdoIGZ1bmRDb250cmFjdCgpIAogICAgICAgIFRva2VuSG9sZGVyIHN0b3JhZ2UgYmFja2VyID0gdG9rZW5Ib2xkZXJzW21zZy5zZW5kZXJdOwoKICAgICAgICByZXF1aXJlKGJhY2tlci53ZWlSZWNlaXZlZCA+IDApOyAgLy8gZW5zdXJlIHRoYXQgdXNlciBoYXMgc2VudCBjb250cmlidXRpb24KICAgICAgICByZXF1aXJlKCFiYWNrZXIucmVmdW5kZWQpOyAgICAgICAgLy8gZW5zdXJlIHRoYXQgdXNlciBoYXNuJ3QgYmVlbiByZWZ1bmRlZCB5ZXQKCiAgICAgICAgYmFja2VyLnJlZnVuZGVkID0gdHJ1ZTsgIC8vIHNhdmUgcmVmdW5kIHN0YXR1cyB0byB0cnVlCiAgICAgICAgcmVmdW5kQ291bnQrKzsKICAgICAgICB0b3RhbFJlZnVuZGVkICs9IGJhY2tlci53ZWlSZWNlaXZlZDsKCiAgICAgICAgaWYgKCF0b2tlbi5idXJuKG1zZy5zZW5kZXIsIGJhY2tlci50b2tlbnNUb1NlbmQpKSAvLyBidXJuIHRva2VucwogICAgICAgICAgICByZXZlcnQoKTsgICAgICAgIAogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmFja2VyLndlaVJlY2VpdmVkKTsgIC8vIHNlbmQgYmFjayB0aGUgY29udHJpYnV0aW9uIAogICAgICAgIExvZ1JlZnVuZEVUSChtc2cuc2VuZGVyLCBiYWNrZXIud2VpUmVjZWl2ZWQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEBub3RpY2UgYWxsb2NhdGUgdG9rZW5zIHRvIGRldi90ZWFtL2Fkdmlzb3JzCiAgICAvLyBAcGFyYW0gX2RldiB7YWRkcmVzc30gCiAgICAvLyBAcGFyYW0gX2Ftb3VudCB7dWludH0gYW1vdW50IG9mIHRva2VucwogICAgZnVuY3Rpb24gZGV2QWxsb2NhdGlvbihhZGRyZXNzIF9kZXYsIHVpbnQgX2Ftb3VudCkgZXh0ZXJuYWwgb25seU93bmVyKCkgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICByZXF1aXJlKF9kZXYgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShjcm93ZHNhbGVDbG9zZWQpOyAKICAgICAgICByZXF1aXJlKHRvdGFsVG9rZW5zU2VudC5hZGQoX2Ftb3VudCkgPD0gdG9rZW4udG90YWxTdXBwbHkoKSk7CiAgICAgICAgZGV2SW5kZXgucHVzaChfZGV2KTsKICAgICAgICBUb2tlbkhvbGRlciBzdG9yYWdlIHRva2VuSG9sZGVyID0gdG9rZW5Ib2xkZXJzW19kZXZdOwogICAgICAgIHRva2VuSG9sZGVyLnRva2Vuc1RvU2VuZCA9IF9hbW91bnQ7CiAgICAgICAgdG9rZW5zU2VudERldiArPSBfYW1vdW50OwogICAgICAgIHRvdGFsVG9rZW5zU2VudCArPSBfYW1vdW50OyAgICAgICAgCiAgICAgICAgTG9nRGV2VG9rZW5zQWxsb2NhdGVkKF9kZXYsIF9hbW91bnQpOyAvLyBSZWdpc3RlciBldmVudAogICAgICAgIHJldHVybiB0cnVlOwoKICAgIH0KCiAgICAvLyBAbm90aWNlIEZhaWxzYWZlIGRyYWluCiAgICBmdW5jdGlvbiBkcmFpbih1aW50IF9hbW91bnQpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgICAgICBvd25lci50cmFuc2ZlcihfYW1vdW50KTsgICAgICAgICAgIAogICAgfQoKICAgIC8vIEBub3RpY2UgdHJhbnNmZXIgdG9rZW5zIHdoaWNoIGFyZSBub3Qgc3ViamVjdCB0byB2ZXN0aW5nCiAgICAvLyBAcGFyYW0gX3JlY2lwaWVudCB7YWRkcmVzfQogICAgLy8gQHBhcmFtIF9hbW9udCB7dWludH0gYW1vdW50IHRvIHRyYW5zZmVyCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRva2VucyhhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQgX2Ftb3VudCkgZXh0ZXJuYWwgb25seU93bmVyKCkgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICByZXF1aXJlKF9yZWNpcGllbnQgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgaWYgKCF0b2tlbi50cmFuc2ZlcihfcmVjaXBpZW50LCBfYW1vdW50KSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgTG9nTm9uVmVzdGVkVG9rZW5zU2VudChfcmVjaXBpZW50LCBfYW1vdW50KTsKICAgIH0KCiAgICAvLyBAbm90aWNlIGRldGVybWluZSBhbW91bnQgb2YgY29tbWlzc2lvbnMgZm9yIHRoZSBwbGF0Zm9ybSAgICAKICAgIGZ1bmN0aW9uIGRldGVybWluZUNvbW1pc3Npb25zKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgIAogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPD0gNTAwIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5iYWxhbmNlICogMTApLzEwMDsKICAgICAgICB9ZWxzZSBpZiAodGhpcy5iYWxhbmNlIDw9IDEwMDAgZXRoZXIpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLmJhbGFuY2UgKiA4KS8xMDA7CiAgICAgICAgfWVsc2UgaWYgKHRoaXMuYmFsYW5jZSA8IDEwMDAwIGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5iYWxhbmNlICogNikvMTAwOwogICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLmJhbGFuY2UgKiA2KS8xMDA7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEBub3RpY2UgcmV0dXJuIG51bWJlciBvZiBjb250cmlidXRvcnMKICAgIC8vIEByZXR1cm4gIHt1aW50fSBudW1iZXIgb2YgY29udHJpYnV0b3JzCiAgICBmdW5jdGlvbiBudW1iZXJPZkJhY2tlcnMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGhvbGRlcnNJbmRleC5sZW5ndGg7CiAgICB9CgogICAgLy8gQG5vdGljZSBJdCB3aWxsIGJlIGNhbGxlZCBieSBmYWxsYmFjayBmdW5jdGlvbiB3aGVuZXZlciBldGhlciBpcyBzZW50IHRvIGl0CiAgICAvLyBAcGFyYW0gIF9iYWNrZXIge2FkZHJlc3N9IGFkZHJlc3Mgb2YgYmVuZWZpY2lhcnkKICAgIC8vIEByZXR1cm4gcmVzIHtib29sfSB0cnVlIGlmIHRyYW5zYWN0aW9uIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBjb250cmlidXRlKGFkZHJlc3MgX2JhY2tlcikgaW50ZXJuYWwgd2hlbk5vdFBhdXNlZCByZXNwZWN0VGltZUZyYW1lIHJldHVybnMoYm9vbCByZXMpIHsKCiAgICAgICAgLy9yZXF1aXJlKG1zZy52YWx1ZSA8PSBtYXhDb250cmlidXRpb24pOwoKICAgICAgICBpZiAod2hpdGVMaXN0ICE9IGFkZHJlc3MoMCkpICAvLyBpZiB3aGl0ZWxpc3QgaW5pdGlhbGl6ZWQgdmVyaWZ5IG1lbWJlciB3aGl0ZWxpc3Qgc3RhdHVzCiAgICAgICAgICAgIHJlcXVpcmUod2hpdGVMaXN0LmlzV2hpdGVMaXN0ZWQoX2JhY2tlcikpOyAgLy8gZW5zdXJlIHRoYXQgdXNlciBpcyB3aGl0ZWxpc3RlZAogICAgICAgICAgCiAgICAgICAgdWludCB0b2tlbnNUb1NlbmQgPSBjYWxjdWxhdGVOb09mVG9rZW5zVG9TZW5kKCk7IC8vIGNhbGN1bGF0ZSBudW1iZXIgb2YgdG9rZW5zCgogICAgICAgIC8vIEVuc3VyZSB0aGF0IG1heCBjYXAgaGFzbid0IGJlZW4gcmVhY2hlZAogICAgICAgIHJlcXVpcmUodG90YWxUb2tlbnNTZW50ICsgdG9rZW5zVG9TZW5kIDw9IG1heENhcCk7CiAgICAgICAgCiAgICAgICAgVG9rZW5Ib2xkZXIgc3RvcmFnZSBiYWNrZXIgPSB0b2tlbkhvbGRlcnNbX2JhY2tlcl07CgogICAgICAgIGlmIChiYWNrZXIud2VpUmVjZWl2ZWQgPT0gMCkKICAgICAgICAgICAgaG9sZGVyc0luZGV4LnB1c2goX2JhY2tlcik7CgogICAgICAgIGlmIChTdGVwLkZ1bmRpbmdNYWluU2FsZSA9PSBjdXJyZW50U3RlcCkgeyAvLyBVcGRhdGUgdGhlIHRvdGFsIEV0aGVyIHJlY2VpdmVkIGFuZCB0b2tlbnMgc2VudCBkdXJpbmcgcHVibGljIHNhbGUKICAgICAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gbWluQ29udHJpYnV0aW9uTWFpblNhbGUpOyAvLyBzdG9wIHdoZW4gcmVxdWlyZWQgbWluaW11bSBpcyBub3QgbWV0ICAgIAogICAgICAgICAgICBldGhSZWNlaXZlZE1haW4gPSBldGhSZWNlaXZlZE1haW4uYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIHRva2Vuc1NlbnRNYWluICs9IHRva2Vuc1RvU2VuZDsKICAgICAgICB9ZWxzZSB7ICAKICAgICAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gbWluQ29udHJpYnV0aW9uUHJlc2FsZSk7IC8vIHN0b3Agd2hlbiByZXF1aXJlZCBtaW5pbXVtIGlzIG5vdCBtZXQKICAgICAgICAgICAgZXRoUmVjZWl2ZWRQcmVzYWxlID0gZXRoUmVjZWl2ZWRQcmVzYWxlLmFkZChtc2cudmFsdWUpOyAKICAgICAgICAgICAgdG9rZW5zU2VudFByZXNhbGUgKz0gdG9rZW5zVG9TZW5kOwogICAgICAgIH0gIAogICAgICAgCiAgICAgICAgYmFja2VyLnRva2Vuc1RvU2VuZCArPSB0b2tlbnNUb1NlbmQ7CiAgICAgICAgYmFja2VyLndlaVJlY2VpdmVkID0gYmFja2VyLndlaVJlY2VpdmVkLmFkZChtc2cudmFsdWUpOyAgICAgICAKICAgICAgICB0b3RhbFRva2Vuc1NlbnQgKz0gdG9rZW5zVG9TZW5kOyAgICAgIAogICAgICAgIAogICAgICAgIC8vIHRva2VucyBhcmUgbm90IHRyYW5zZmVycmQgdG8gY29udHJpYnV0b3JzIGR1cmluZyB0aGlzIHBoYXNlCiAgICAgICAgLy8gdG9rZW5zIHdpbGwgYmUgdHJhbnNmZXJyZWQgYmFzZWQgb24gdGhlIHZlc3Rpbmcgc2NoZWR1bGUsIHdoZW4gY29udHJpYnV0b3IKICAgICAgICAvLyBjYWxscyByZWxlYXNlKCkgZnVuY3Rpb24gb2YgdGhpcyBjb250cmFjdAogICAgICAgIExvZ1JlY2VpdmVkRVRIKF9iYWNrZXIsIG1zZy52YWx1ZSwgdG9rZW5zVG9TZW5kKTsgLy8gUmVnaXN0ZXIgZXZlbnQKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIFRoaXMgZnVuY3Rpb24gd2lsbCByZXR1cm4gbnVtYmVyIG9mIHRva2VucyBiYXNlZCBvbiB0aW1lIGludGVydmFscyBpbiB0aGUgY2FtcGFpZ24KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZU5vT2ZUb2tlbnNUb1NlbmQoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgdWludCB0b2tlbkFtb3VudCA9IG1zZy52YWx1ZS5tdWwobXVsdGlwbGllcikgLyB0b2tlblByaWNlV2VpOwoKICAgICAgICBpZiAoU3RlcC5GdW5kaW5nTWFpblNhbGUgPT0gY3VycmVudFN0ZXApIHsKICAgICAgICAKICAgICAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8PSBzdGFydEJsb2NrICsgZmlyc3RQZXJpb2QpIHsgIAogICAgICAgICAgICAgICAgcmV0dXJuICB0b2tlbkFtb3VudCArIHRva2VuQW1vdW50Lm11bChmaXJzdEJvbnVzKSAvIDEwMDsKICAgICAgICAgICAgfWVsc2UgaWYgKGJsb2NrLm51bWJlciA8PSBzdGFydEJsb2NrICsgc2Vjb25kUGVyaW9kKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIHRva2VuQW1vdW50ICsgdG9rZW5BbW91bnQubXVsKHNlY29uZEJvbnVzKSAvIDEwMDsgCiAgICAgICAgICAgIH1lbHNlIGlmIChibG9jay5udW1iZXIgPD0gc3RhcnRCbG9jayArIHRoaXJkUGVyaW9kKSB7IAogICAgICAgICAgICAgICAgcmV0dXJuICB0b2tlbkFtb3VudCArIHRva2VuQW1vdW50Lm11bCh0aGlyZEJvbnVzKSAvIDEwMDsgICAgICAgIAogICAgICAgICAgICB9ZWxzZSB7ICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiAgdG9rZW5BbW91bnQ7IAogICAgICAgICAgICB9CiAgICAgICAgfWVsc2UgCiAgICAgICAgICAgIHJldHVybiAgdG9rZW5BbW91bnQgKyB0b2tlbkFtb3VudC5tdWwocHJlc2FsZUJvbnVzKSAvIDEwMDsKICAgIH0gIAp9CgoKLy8gVGhlICB0b2tlbgpjb250cmFjdCBUb2tlbiBpcyBFUkMyMCwgT3duYWJsZSB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CiAgICAvLyBQdWJsaWMgdmFyaWFibGVzIG9mIHRoZSB0b2tlbgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50IHB1YmxpYyBkZWNpbWFsczsgLy8gSG93IG1hbnkgZGVjaW1hbHMgdG8gc2hvdy4KICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICJ2MC4xIjsKICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogICAgYm9vbCBwdWJsaWMgbG9ja2VkOwogICAgYWRkcmVzcyBwdWJsaWMgY3Jvd2RTYWxlQWRkcmVzczsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJhbGFuY2VzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSkgcHVibGljIGFsbG93ZWQ7CiAgICAKICAgIC8vIExvY2sgdHJhbnNmZXIgZHVyaW5nIHRoZSBJQ08KICAgIG1vZGlmaWVyIG9ubHlVbmxvY2tlZCgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjcm93ZFNhbGVBZGRyZXNzICYmIGxvY2tlZCAmJiBtc2cuc2VuZGVyICE9IG93bmVyKSAKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QXV0aG9yaXplZCgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjcm93ZFNhbGVBZGRyZXNzICYmIG1zZy5zZW5kZXIgIT0gb3duZXIpIAogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIFRoZSBUb2tlbiBjb25zdHJ1Y3RvciAgICAgCiAgICBmdW5jdGlvbiBUb2tlbih1aW50IF9pbml0aWFsU3VwcGx5LAogICAgICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICAgICAgdWludCBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgICAgICBzdHJpbmcgX3ZlcnNpb24sCiAgICAgICAgICAgIGFkZHJlc3MgX2Nyb3dkU2FsZUFkZHJlc3MpIHB1YmxpYyB7ICAgICAgCiAgICAgICAgbG9ja2VkID0gdHJ1ZTsgIC8vIExvY2sgdGhlIHRyYW5zZmVyIG9mIHRva2VucyBkdXJpbmcgdGhlIGNyb3dkc2FsZQogICAgICAgIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHkgKiAoMTAqKl9kZWNpbWFsVW5pdHMpOyAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgLy8gU2V0IHRoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAvLyBTZXQgdGhlIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgLy8gQW1vdW50IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgdmVyc2lvbiA9IF92ZXJzaW9uOwogICAgICAgIGNyb3dkU2FsZUFkZHJlc3MgPSBfY3Jvd2RTYWxlQWRkcmVzczsgICAgICAgICAgICAgIAogICAgICAgIGJhbGFuY2VzW2Nyb3dkU2FsZUFkZHJlc3NdID0gdG90YWxTdXBwbHk7ICAgCiAgICB9CgogICAgZnVuY3Rpb24gdW5sb2NrKCkgcHVibGljIG9ubHlBdXRob3JpemVkIHsKICAgICAgICBsb2NrZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2NrKCkgcHVibGljIG9ubHlBdXRob3JpemVkIHsKICAgICAgICBsb2NrZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1cm4oYWRkcmVzcyBfbWVtYmVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlBdXRob3JpemVkIHJldHVybnMoYm9vbCkgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX21lbWJlcl0gPj0gX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfbWVtYmVyXSAtPSBfdmFsdWU7CiAgICAgICAgdG90YWxTdXBwbHkgLT0gX3ZhbHVlOwogICAgICAgIFRyYW5zZmVyKF9tZW1iZXIsIDB4MCwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgIAogICAgLy8gQG5vdGljZSB0cmFuc2ZlciB0b2tlbnMgdG8gZ2l2ZW4gYWRkcmVzcwogICAgLy8gQHBhcmFtIF90byB7YWRkcmVzc30gYWRkcmVzcyBvciByZWNpcGllbnQKICAgIC8vIEBwYXJhbSBfdmFsdWUge3VpbnR9IGFtb3VudCB0byB0cmFuc2ZlcgogICAgLy8gQHJldHVybiAge2Jvb2x9IHRydWUgaWYgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgb25seVVubG9ja2VkIHJldHVybnMoYm9vbCkgewoKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIHRyYW5zZmVyIHRva2VucyBmcm9tIGdpdmVuIGFkZHJlc3MgdG8gYW5vdGhlciBhZGRyZXNzCiAgICAvLyBAcGFyYW0gX2Zyb20ge2FkZHJlc3N9IGZyb20gd2hvbSB0b2tlbnMgYXJlIHRyYW5zZmVycmVkCiAgICAvLyBAcGFyYW0gX3RvIHthZGRyZXNzfSB0byB3aG9tIHRva2VucyBhcmUgdHJhbnNmZXJyZWQKICAgIC8vIEBwYXJhbSBfdmFsdWUge3VpbnR9IGFtb3VudCBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIC8vIEByZXR1cm4gIHtib29sfSB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5VW5sb2NrZWQgcmV0dXJucyhib29sIHN1Y2Nlc3MpIHsKCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlKTsgLy8gQ2hlY2sgaWYgdGhlIHNlbmRlciBoYXMgZW5vdWdoCiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOyAvLyBDaGVjayBpZiBhbGxvd2VkIGlzIGdyZWF0ZXIgb3IgZXF1YWwKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOyAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsgLy8gQWRkIHRoZSBzYW1lIHRvIHRoZSByZWNpcGllbnQKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7ICAvLyBhZGp1c3QgYWxsb3dlZAogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgICAvLyBAbm90aWNlIHRvIHF1ZXJ5IGJhbGFuY2Ugb2YgYWNjb3VudAogICAgLy8gQHJldHVybiBfb3duZXIge2FkZHJlc3N9IGFkZHJlc3Mgb2YgdXNlciB0byBxdWVyeSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludCBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAgKgogICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEBub3RpY2UgdG8gcXVlcnkgb2YgYWxsb3dhbmNlIG9mIG9uZSB1c2VyIHRvIHRoZSBvdGhlcgogICAgLy8gQHBhcmFtIF9vd25lciB7YWRkcmVzc30gb2YgdGhlIG93bmVyIG9mIHRoZSBhY2NvdW50CiAgICAvLyBAcGFyYW0gX3NwZW5kZXIge2FkZHJlc3N9IG9mIHRoZSBzcGVuZGVyIG9mIHRoZSBhY2NvdW50CiAgICAvLyBAcmV0dXJuIHJlbWFpbmluZyB7dWludH0gYW1vdW50IG9mIHJlbWFpbmluZyBhbGxvd2FuY2UKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8qKgogICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAgKi8KICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICAgICAgfQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgp9'.
	

]
