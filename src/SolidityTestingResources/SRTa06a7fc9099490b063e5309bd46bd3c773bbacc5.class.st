Class {
	#name : #SRTa06a7fc9099490b063e5309bd46bd3c773bbacc5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa06a7fc9099490b063e5309bd46bd3c773bbacc5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLy8gQHRpdGxlIE93bmFibGUKLy8vIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wgZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMKLy8vIGFuZCB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXJDYW5kaWRhdGU7CgogICAgZXZlbnQgT3duZXJzaGlwUmVxdWVzdGVkKGFkZHJlc3MgaW5kZXhlZCBfYnksIGFkZHJlc3MgaW5kZXhlZCBfdG8pOwogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsKCiAgICAvLy8gQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAvLy8gYWNjb3VudC4KICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vLyBAZGV2IFJldmVydHMgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXJDYW5kaWRhdGUoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gbmV3T3duZXJDYW5kaWRhdGUpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IFByb3Bvc2VzIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXJDYW5kaWRhdGUuCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lckNhbmRpZGF0ZSBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgIGZ1bmN0aW9uIHJlcXVlc3RPd25lcnNoaXBUcmFuc2ZlcihhZGRyZXNzIF9uZXdPd25lckNhbmRpZGF0ZSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lckNhbmRpZGF0ZSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgbmV3T3duZXJDYW5kaWRhdGUgPSBfbmV3T3duZXJDYW5kaWRhdGU7CgogICAgICAgIE93bmVyc2hpcFJlcXVlc3RlZChtc2cuc2VuZGVyLCBuZXdPd25lckNhbmRpZGF0ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXB0IG93bmVyc2hpcCB0cmFuc2Zlci4gVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgY2FsbGVkIGJ5IHRoZSBwcmV2aW91c2x5IHByb3Bvc2VkIG93bmVyLgogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgZXh0ZXJuYWwgb25seU93bmVyQ2FuZGlkYXRlIHsKICAgICAgICBhZGRyZXNzIHByZXZpb3VzT3duZXIgPSBvd25lcjsKCiAgICAgICAgb3duZXIgPSBuZXdPd25lckNhbmRpZGF0ZTsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IGFkZHJlc3MoMCk7CgogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKHByZXZpb3VzT3duZXIsIG93bmVyKTsKICAgIH0KfQoKLy8vIEB0aXRsZSBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KfQoKLy8vIEB0aXRsZSBFUkMgVG9rZW4gU3RhbmRhcmQgIzIwIEludGVyZmFjZSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwKQpjb250cmFjdCBFUkMyMCB7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgoKLy8vIEB0aXRsZSBCYXNpYyBFUkMyMCB0b2tlbiBjb250cmFjdCBpbXBsZW1lbnRhdGlvbi4KLy8vIEBkZXYgQmFzZWQgb24gT3BlblplcHBlbGluJ3MgU3RhbmRhcmRUb2tlbi4KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKCiAgICAvLy8gQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIGlmICgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwoKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgIC8vLyBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAvLy8gQHJldHVybiB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCgogICAgLy8vIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAgIC8vLyBAcmV0dXJuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICAvLy8gQGRldiB0cmFuc2ZlciB0b2tlbiB0byBhIHNwZWNpZmllZCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwoKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIuCiAgICAvLy8gQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbS4KICAgIC8vLyBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8uCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwoKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgoKLy8vIEB0aXRsZSBUb2tlbiBob2xkZXIgY29udHJhY3QuCmNvbnRyYWN0IFRva2VuSG9sZGVyIGlzIE93bmFibGUgewogICAgLy8vIEBkZXYgQWxsb3cgdGhlIG93bmVyIHRvIHRyYW5zZmVyIG91dCBhbnkgYWNjaWRlbnRhbGx5IHNlbnQgRVJDMjAgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIEVSQzIwIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfYW1vdW50IHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckFueUVSQzIwVG9rZW4oYWRkcmVzcyBfdG9rZW5BZGRyZXNzLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gRVJDMjAoX3Rva2VuQWRkcmVzcykudHJhbnNmZXIob3duZXIsIF9hbW91bnQpOwogICAgfQp9CgoKLy8vIEB0aXRsZSBLaW4gdG9rZW4gY29udHJhY3QuCmNvbnRyYWN0IEtpblRva2VuIGlzIE93bmFibGUsIEJhc2ljVG9rZW4sIFRva2VuSG9sZGVyIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJLaW4iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiS0lOIjsKCiAgICAvLyBVc2luZyBzYW1lIGRlY2ltYWwgdmFsdWUgYXMgRVRIIChtYWtlcyBFVEgtS0lOIGNvbnZlcnNpb24gbXVjaCBlYXNpZXIpLgogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgLy8gU3RhdGVzIHdoZXRoZXIgY3JlYXRpbmcgbW9yZSB0b2tlbnMgaXMgYWxsb3dlZCBvciBub3QuCiAgICAvLyBVc2VkIGR1cmluZyB0b2tlbiBzYWxlLgogICAgYm9vbCBwdWJsaWMgaXNNaW50aW5nID0gdHJ1ZTsKCiAgICBldmVudCBNaW50aW5nRW5kZWQoKTsKCiAgICBtb2RpZmllciBvbmx5RHVyaW5nTWludGluZygpIHsKICAgICAgICByZXF1aXJlKGlzTWludGluZyk7CgogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFmdGVyTWludGluZygpIHsKICAgICAgICByZXF1aXJlKCFpc01pbnRpbmcpOwoKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IE1pbnQgS2luIHRva2Vucy4KICAgIC8vLyBAcGFyYW0gX3RvIGFkZHJlc3MgQWRkcmVzcyB0byBzZW5kIG1pbnRlZCBLaW4gdG8uCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgdWludDI1NiBBbW91bnQgb2YgS2luIHRva2VucyB0byBtaW50LgogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBleHRlcm5hbCBvbmx5T3duZXIgb25seUR1cmluZ01pbnRpbmcgewogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKCiAgICAgICAgVHJhbnNmZXIoMHgwLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IEVuZCBtaW50aW5nIG1vZGUuCiAgICBmdW5jdGlvbiBlbmRNaW50aW5nKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBpZiAoaXNNaW50aW5nID09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlzTWludGluZyA9IGZhbHNlOwoKICAgICAgICBNaW50aW5nRW5kZWQoKTsKICAgIH0KCiAgICAvLy8gQGRldiBTYW1lIEVSQzIwIGJlaGF2aW9yLCBidXQgcmV2ZXJ0cyBpZiBzdGlsbCBtaW50aW5nLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5QWZ0ZXJNaW50aW5nIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICAgIH0KCiAgICAvLy8gQGRldiBTYW1lIEVSQzIwIGJlaGF2aW9yLCBidXQgcmV2ZXJ0cyBpZiBzdGlsbCBtaW50aW5nLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlBZnRlck1pbnRpbmcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgU2FtZSBFUkMyMCBiZWhhdmlvciwgYnV0IHJldmVydHMgaWYgc3RpbGwgbWludGluZy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seUFmdGVyTWludGluZyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQp9CgoKLy8vIEB0aXRsZSBWZXN0aW5nIHRydXN0ZWUgY29udHJhY3QgZm9yIEtpbiB0b2tlbi4KY29udHJhY3QgVmVzdGluZ1RydXN0ZWUgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLyBLaW4gdG9rZW4gY29udHJhY3QuCiAgICBLaW5Ub2tlbiBwdWJsaWMga2luOwoKICAgIC8vIFZlc3RpbmcgZ3JhbnQgZm9yIGEgc3BlaWNpZmMgaG9sZGVyLgogICAgc3RydWN0IEdyYW50IHsKICAgICAgICB1aW50MjU2IHZhbHVlOwogICAgICAgIHVpbnQyNTYgc3RhcnQ7CiAgICAgICAgdWludDI1NiBjbGlmZjsKICAgICAgICB1aW50MjU2IGVuZDsKICAgICAgICB1aW50MjU2IGluc3RhbGxtZW50TGVuZ3RoOyAvLyBJbiBzZWNvbmRzLgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJyZWQ7CiAgICAgICAgYm9vbCByZXZva2FibGU7CiAgICB9CgogICAgLy8gSG9sZGVyIHRvIGdyYW50IGluZm9ybWF0aW9uIG1hcHBpbmcuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IEdyYW50KSBwdWJsaWMgZ3JhbnRzOwoKICAgIC8vIFRvdGFsIHRva2VucyBhdmFpbGFibGUgZm9yIHZlc3RpbmcuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFZlc3Rpbmc7CgogICAgZXZlbnQgTmV3R3JhbnQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBUb2tlbnNVbmxvY2tlZChhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBHcmFudFJldm9rZWQoYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX3JlZnVuZCk7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgdGhhdCBpbml0aWFsaXplcyB0aGUgYWRkcmVzcyBvZiB0aGUgS2luIHRva2VuIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfa2luIEtpblRva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSBwcmV2aW91c2x5IGRlcGxveWVkIEtpbiB0b2tlbiBjb250cmFjdC4KICAgIGZ1bmN0aW9uIFZlc3RpbmdUcnVzdGVlKEtpblRva2VuIF9raW4pIHsKICAgICAgICByZXF1aXJlKF9raW4gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGtpbiA9IF9raW47CiAgICB9CgogICAgLy8vIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MuIFBsZWFzZSBub3RlLCB0aGF0IHRoZSB0cnVzdGVlIG11c3QgaGF2ZSBlbm91Z2ggdW5ncmFudGVkIHRva2VucyB0bwogICAgLy8vIGFjY29tb2RhdGUgdGhlIG5ldyBncmFudC4gT3RoZXJ3aXNlLCB0aGUgY2FsbCB3aXRoIGZhaWwuCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIFRoZSBob2xkZXIgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0IHVpbnQyNTYgVGhlIGJlZ2lubmluZyBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9jbGlmZiB1aW50MjU2IER1cmF0aW9uIG9mIHRoZSBjbGlmZiBwZXJpb2QgKHdoZW4gdGhlIGZpcnN0IGluc3RhbGxtZW50IGlzIG1hZGUpLgogICAgLy8vIEBwYXJhbSBfZW5kIHVpbnQyNTYgVGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9pbnN0YWxsbWVudExlbmd0aCB1aW50MjU2IFRoZSBsZW5ndGggb2YgZWFjaCB2ZXN0aW5nIGluc3RhbGxtZW50IChpbiBzZWNvbmRzKS4KICAgIC8vLyBAcGFyYW0gX3Jldm9rYWJsZSBib29sIFdoZXRoZXIgdGhlIGdyYW50IGlzIHJldm9rYWJsZSBvciBub3QuCiAgICBmdW5jdGlvbiBncmFudChhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9jbGlmZiwgdWludDI1NiBfZW5kLAogICAgICAgIHVpbnQyNTYgX2luc3RhbGxtZW50TGVuZ3RoLCBib29sIF9yZXZva2FibGUpCiAgICAgICAgZXh0ZXJuYWwgb25seU93bmVyIHsKCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7IC8vIFByb3RlY3QgdGhpcyBjb250cmFjdCBmcm9tIHJlY2VpdmluZyBhIGdyYW50LgogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIC8vIFJlcXVpcmUgdGhhdCBldmVyeSBob2xkZXIgY2FuIGJlIGdyYW50ZWQgdG9rZW5zIG9ubHkgb25jZS4KICAgICAgICByZXF1aXJlKGdyYW50c1tfdG9dLnZhbHVlID09IDApOwoKICAgICAgICAvLyBSZXF1aXJlIGZvciB0aW1lIHJhbmdlcyB0byBiZSBjb25zaXN0ZW50IGFuZCB2YWxpZC4KICAgICAgICByZXF1aXJlKF9zdGFydCA8PSBfY2xpZmYgJiYgX2NsaWZmIDw9IF9lbmQpOwoKICAgICAgICAvLyBSZXF1aXJlIGluc3RhbGxtZW50IGxlbmd0aCB0byBiZSB2YWxpZCBhbmQgbm8gbG9uZ2VyIHRoYW4gKGVuZCAtIHN0YXJ0KS4KICAgICAgICByZXF1aXJlKF9pbnN0YWxsbWVudExlbmd0aCA+IDAgJiYgX2luc3RhbGxtZW50TGVuZ3RoIDw9IF9lbmQuc3ViKF9zdGFydCkpOwoKICAgICAgICAvLyBHcmFudCBtdXN0IG5vdCBleGNlZWQgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgY3VycmVudGx5IGF2YWlsYWJsZSBmb3IgdmVzdGluZy4KICAgICAgICByZXF1aXJlKHRvdGFsVmVzdGluZy5hZGQoX3ZhbHVlKSA8PSBraW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgLy8gQXNzaWduIGEgbmV3IGdyYW50LgogICAgICAgIGdyYW50c1tfdG9dID0gR3JhbnQoewogICAgICAgICAgICB2YWx1ZTogX3ZhbHVlLAogICAgICAgICAgICBzdGFydDogX3N0YXJ0LAogICAgICAgICAgICBjbGlmZjogX2NsaWZmLAogICAgICAgICAgICBlbmQ6IF9lbmQsCiAgICAgICAgICAgIGluc3RhbGxtZW50TGVuZ3RoOiBfaW5zdGFsbG1lbnRMZW5ndGgsCiAgICAgICAgICAgIHRyYW5zZmVycmVkOiAwLAogICAgICAgICAgICByZXZva2FibGU6IF9yZXZva2FibGUKICAgICAgICB9KTsKCiAgICAgICAgLy8gU2luY2UgdG9rZW5zIGhhdmUgYmVlbiBncmFudGVkLCByZWR1Y2UgdGhlIHRvdGFsIGFtb3VudCBhdmFpbGFibGUgZm9yIHZlc3RpbmcuCiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLmFkZChfdmFsdWUpOwoKICAgICAgICBOZXdHcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICBmdW5jdGlvbiByZXZva2UoYWRkcmVzcyBfaG9sZGVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBHcmFudCBtZW1vcnkgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl07CgogICAgICAgIC8vIEdyYW50IG11c3QgYmUgcmV2b2thYmxlLgogICAgICAgIHJlcXVpcmUoZ3JhbnQucmV2b2thYmxlKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIHRoYXQgY2FuIHN0aWxsIGJlIHJldHVybmVkLgogICAgICAgIHVpbnQyNTYgcmVmdW5kID0gZ3JhbnQudmFsdWUuc3ViKGdyYW50LnRyYW5zZmVycmVkKTsKCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBncmFudC4KICAgICAgICBkZWxldGUgZ3JhbnRzW19ob2xkZXJdOwoKICAgICAgICAvLyBVcGRhdGUgdG90YWwgdmVzdGluZyBhbW91bnQgYW5kIHRyYW5zZmVyIHByZXZpb3VzbHkgY2FsY3VsYXRlZCB0b2tlbnMgdG8gb3duZXIuCiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLnN1YihyZWZ1bmQpOwogICAgICAgIGtpbi50cmFuc2Zlcihtc2cuc2VuZGVyLCByZWZ1bmQpOwoKICAgICAgICBHcmFudFJldm9rZWQoX2hvbGRlciwgcmVmdW5kKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgaG9sZGVyIGF0IGEgZ2l2ZW4gdGltZS4KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIuCiAgICAvLy8gQHBhcmFtIF90aW1lIHVpbnQyNTYgVGhlIHNwZWNpZmljIHRpbWUgdG8gY2FsY3VsYXRlIGFnYWluc3QuCiAgICAvLy8gQHJldHVybiBhIHVpbnQyNTYgUmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMuCiAgICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF90aW1lKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgR3JhbnQgbWVtb3J5IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdOwogICAgICAgIGlmIChncmFudC52YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZVZlc3RlZFRva2VucyhncmFudCwgX3RpbWUpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmMgdGltZS4KICAgIC8vLyBAcGFyYW0gX2dyYW50IEdyYW50IFRoZSB2ZXN0aW5nIGdyYW50LgogICAgLy8vIEBwYXJhbSBfdGltZSB1aW50MjU2IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgIC8vLyBAcmV0dXJuIEFuIHVpbnQyNTYgUmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50LgogICAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKEdyYW50IF9ncmFudCwgdWludDI1NiBfdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gSWYgd2UncmUgYmVmb3JlIHRoZSBjbGlmZiwgdGhlbiBub3RoaW5nIGlzIHZlc3RlZC4KICAgICAgICBpZiAoX3RpbWUgPCBfZ3JhbnQuY2xpZmYpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB3ZSdyZSBhZnRlciB0aGUgZW5kIG9mIHRoZSB2ZXN0aW5nIHBlcmlvZCAtIGV2ZXJ5dGhpbmcgaXMgdmVzdGVkOwogICAgICAgIGlmIChfdGltZSA+PSBfZ3JhbnQuZW5kKSB7CiAgICAgICAgICAgIHJldHVybiBfZ3JhbnQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLyBDYWxjdWxhdGUgYW1vdW50IG9mIGluc3RhbGxtZW50cyBwYXN0IHVudGlsIG5vdy4KICAgICAgICAvLwogICAgICAgIC8vIE5PVEUgcmVzdWx0IGdldHMgZmxvb3JlZCBiZWNhdXNlIG9mIGludGVnZXIgZGl2aXNpb24uCiAgICAgICAgdWludDI1NiBpbnN0YWxsbWVudHNQYXN0ID0gX3RpbWUuc3ViKF9ncmFudC5zdGFydCkuZGl2KF9ncmFudC5pbnN0YWxsbWVudExlbmd0aCk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbW91bnQgb2YgZGF5cyBpbiBlbnRpcmUgdmVzdGluZyBwZXJpb2QuCiAgICAgICAgdWludDI1NiB2ZXN0aW5nRGF5cyA9IF9ncmFudC5lbmQuc3ViKF9ncmFudC5zdGFydCk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbmQgcmV0dXJuIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFjY29yZGluZyB0byB2ZXN0aW5nIGRheXMgdGhhdCBoYXZlIHBhc3NlZC4KICAgICAgICByZXR1cm4gX2dyYW50LnZhbHVlLm11bChpbnN0YWxsbWVudHNQYXN0Lm11bChfZ3JhbnQuaW5zdGFsbG1lbnRMZW5ndGgpKS5kaXYodmVzdGluZ0RheXMpOwogICAgfQoKICAgIC8vLyBAZGV2IFVubG9jayB2ZXN0ZWQgdG9rZW5zIGFuZCB0cmFuc2ZlciB0aGVtIHRvIHRoZSBncmFudGVlLgogICAgZnVuY3Rpb24gdW5sb2NrVmVzdGVkVG9rZW5zKCkgZXh0ZXJuYWwgewogICAgICAgIEdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbbXNnLnNlbmRlcl07CgogICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgZ3JhbnQgaGFzIHRva2VucyBhdmFpbGFibGUuCiAgICAgICAgcmVxdWlyZShncmFudC52YWx1ZSAhPSAwKTsKCiAgICAgICAgLy8gR2V0IHRoZSB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2VucywgYWNjY29yZGluZyB0byBncmFudC4KICAgICAgICB1aW50MjU2IHZlc3RlZCA9IGNhbGN1bGF0ZVZlc3RlZFRva2VucyhncmFudCwgbm93KTsKICAgICAgICBpZiAodmVzdGVkID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBob2xkZXIgZG9lc24ndCB0cmFuc2ZlciBtb3JlIHRoYW4gd2hhdCBoZSBhbHJlYWR5IGhhcy4KICAgICAgICB1aW50MjU2IHRyYW5zZmVyYWJsZSA9IHZlc3RlZC5zdWIoZ3JhbnQudHJhbnNmZXJyZWQpOwogICAgICAgIGlmICh0cmFuc2ZlcmFibGUgPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBVcGRhdGUgdHJhbnNmZXJyZWQgYW5kIHRvdGFsIHZlc3RpbmcgYW1vdW50LCB0aGVuIHRyYW5zZmVyIHJlbWFpbmluZyB2ZXN0ZWQgZnVuZHMgdG8gaG9sZGVyLgogICAgICAgIGdyYW50LnRyYW5zZmVycmVkID0gZ3JhbnQudHJhbnNmZXJyZWQuYWRkKHRyYW5zZmVyYWJsZSk7CiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLnN1Yih0cmFuc2ZlcmFibGUpOwogICAgICAgIGtpbi50cmFuc2Zlcihtc2cuc2VuZGVyLCB0cmFuc2ZlcmFibGUpOwoKICAgICAgICBUb2tlbnNVbmxvY2tlZChtc2cuc2VuZGVyLCB0cmFuc2ZlcmFibGUpOwogICAgfQp9CgoKLy8vIEB0aXRsZSBLaW4gdG9rZW4gc2FsZSBjb250cmFjdC4KY29udHJhY3QgS2luVG9rZW5TYWxlIGlzIE93bmFibGUsIFRva2VuSG9sZGVyIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vIEV4dGVybmFsIHBhcnRpZXM6CgogICAgLy8gS0lOIHRva2VuIGNvbnRyYWN0LgogICAgS2luVG9rZW4gcHVibGljIGtpbjsKCiAgICAvLyBWZXN0aW5nIGNvbnRyYWN0IGZvciBwcmUtc2FsZSBwYXJ0aWNpcGFudHMuCiAgICBWZXN0aW5nVHJ1c3RlZSBwdWJsaWMgdHJ1c3RlZTsKCiAgICAvLyBSZWNlaXZlZCBmdW5kcyBhcmUgZm9yd2FyZGVkIHRvIHRoaXMgYWRkcmVzcy4KICAgIGFkZHJlc3MgcHVibGljIGZ1bmRpbmdSZWNpcGllbnQ7CgogICAgLy8gS2luIHRva2VuIHVuaXQuCiAgICAvLyBVc2luZyBzYW1lIGRlY2ltYWwgdmFsdWUgYXMgRVRIIChtYWtlcyBFVEgtS0lOIGNvbnZlcnNpb24gbXVjaCBlYXNpZXIpLgogICAgLy8gVGhpcyBpcyB0aGUgc2FtZSBhcyBpbiBLaW4gdG9rZW4gY29udHJhY3QuCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9VTklUID0gMTAgKiogMTg7CgogICAgLy8gTWF4aW11bSBudW1iZXIgb2YgdG9rZW5zIGluIGNpcmN1bGF0aW9uOiAxMCB0cmlsbGlvbi4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IE1BWF9UT0tFTlMgPSAxMCAqKiAxMyAqIFRPS0VOX1VOSVQ7CgogICAgLy8gTWF4aW11bSB0b2tlbnMgb2ZmZXJlZCBpbiB0aGUgc2FsZS4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IE1BWF9UT0tFTlNfU09MRCA9IDUxMjE5NTEyMTk1MSAqIFRPS0VOX1VOSVQ7CgogICAgLy8gV2VpIHRvIDEgVVNEIHJhdGlvLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgV0VJX1BFUl9VU0QgPSB1aW50MjU2KDEgZXRoZXIpIC8gMjg5OwoKICAgIC8vIEtJTiB0byAxIFVTRCByYXRpbywKICAgIC8vIHN1Y2ggdGhhdCBNQVhfVE9LRU5TX1NPTEQgLyBLSU5fUEVSX1VTRCBpcyB0aGUgJDc1TSBjYXAuCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBLSU5fUEVSX1VTRCA9IDY4MjkgKiBUT0tFTl9VTklUOwoKICAgIC8vIEtJTiB0byAxIHdlaSByYXRpby4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEtJTl9QRVJfV0VJID0gS0lOX1BFUl9VU0QgLyBXRUlfUEVSX1VTRDsKCiAgICAvLyBTYWxlIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcy4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFNBTEVfRFVSQVRJT04gPSAxNCBkYXlzOwogICAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwogICAgdWludDI1NiBwdWJsaWMgZW5kVGltZTsKCiAgICAvLyBBbW91bnQgb2YgdG9rZW5zIHNvbGQgdW50aWwgbm93IGluIHRoZSBzYWxlLgogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogICAgLy8gUGFydGljaXBhdGlvbiBjYXBzLCBhY2NvcmRpbmcgdG8gS1lDIHRpZXJzLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVElFUl8xX0NBUCA9IDEwMDAwMCAqIFdFSV9QRVJfVVNEOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVElFUl8yX0NBUCA9IHVpbnQyNTYoLTEpOyAvLyBNYXhpbXVtIHVpbnQyNTYgdmFsdWUKCiAgICAvLyBBY2N1bXVsYXRlZCBhbW91bnQgZWFjaCBwYXJ0aWNpcGFudCBoYXMgY29udHJpYnV0ZWQgc28gZmFyLgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcGFydGljaXBhdGlvbkhpc3Rvcnk7CgogICAgLy8gTWF4aW11bSBhbW91bnQgdGhhdCBlYWNoIHBhcnRpY2lwYW50IGlzIGFsbG93ZWQgdG8gY29udHJpYnV0ZSAoaW4gV0VJKS4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHBhcnRpY2lwYXRpb25DYXBzOwoKICAgIC8vIE1heGltdW0gYW1vdW50IEFOWUJPRFkgaXMgY3VycmVudGx5IGFsbG93ZWQgdG8gY29udHJpYnV0ZS4KICAgIHVpbnQyNTYgcHVibGljIGhhcmRQYXJ0aWNpcGF0aW9uQ2FwID0gNDM5MyAqIFdFSV9QRVJfVVNEOwoKICAgIC8vIFZlc3RpbmcgaW5mb3JtYXRpb24gZm9yIHNwZWNpYWwgYWRkcmVzc2VzOgogICAgc3RydWN0IFRva2VuR3JhbnQgewogICAgICAgIHVpbnQyNTYgdmFsdWU7CiAgICAgICAgdWludDI1NiBzdGFydE9mZnNldDsKICAgICAgICB1aW50MjU2IGNsaWZmT2Zmc2V0OwogICAgICAgIHVpbnQyNTYgZW5kT2Zmc2V0OwogICAgICAgIHVpbnQyNTYgaW5zdGFsbG1lbnRMZW5ndGg7CiAgICAgICAgdWludDggcGVyY2VudFZlc3RlZDsKICAgIH0KCiAgICBhZGRyZXNzW10gcHVibGljIHRva2VuR3JhbnRlZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFRva2VuR3JhbnQpIHB1YmxpYyB0b2tlbkdyYW50czsKICAgIHVpbnQyNTYgcHVibGljIGxhc3RHcmFudGVkSW5kZXggPSAwOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUFYX1RPS0VOX0dSQU5URUVTID0gMTAwOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR1JBTlRfQkFUQ0hfU0laRSA9IDEwOwoKICAgIC8vIFBvc3QtVERFIG11bHRpc2lnIGFkZHJlc3Nlcy4KICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IEtJTl9GT1VOREFUSU9OX0FERFJFU1MgPSAweDU2YUU3NjU3M0VDNTQ3NTRiQzVCNkE4Y0JGMDRiQmQ3RGM4NmIwQTA7CiAgICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBLSUtfQUREUkVTUyA9IDB4M2JmNEJiRTI1MzE1MzY3OEU5RThFNTQwMzk1QzIyQkZmN2ZDYTg3ZDsKCiAgICBldmVudCBUb2tlbnNJc3N1ZWQoYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5zKTsKCiAgICAvLy8gQGRldiBSZXZlcnRzIGlmIGNhbGxlZCB3aGVuIG5vdCBkdXJpbmcgc2FsZS4KICAgIG1vZGlmaWVyIG9ubHlEdXJpbmdTYWxlKCkgewogICAgICAgIHJlcXVpcmUoIXNhbGVFbmRlZCgpICYmIG5vdyA+PSBzdGFydFRpbWUpOwoKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IFJldmVydHMgaWYgY2FsbGVkIGJlZm9yZSBzYWxlIGVuZHMuCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJTYWxlKCkgewogICAgICAgIHJlcXVpcmUoc2FsZUVuZGVkKCkpOwoKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdGhlIHNhbGUgY29uZGl0aW9ucy4KICAgIC8vLyBAcGFyYW0gX2Z1bmRpbmdSZWNpcGllbnQgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgZnVuZGluZyByZWNpcGllbnQuCiAgICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgdWludDI1NiBUaGUgc3RhcnQgdGltZSBvZiB0aGUgdG9rZW4gc2FsZS4KICAgIGZ1bmN0aW9uIEtpblRva2VuU2FsZShhZGRyZXNzIF9mdW5kaW5nUmVjaXBpZW50LCB1aW50MjU2IF9zdGFydFRpbWUpIHsKICAgICAgICByZXF1aXJlKF9mdW5kaW5nUmVjaXBpZW50ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+IG5vdyk7CgogICAgICAgIC8vIERlcGxveSBuZXcgS2luVG9rZW4gY29udHJhY3QuCiAgICAgICAga2luID0gbmV3IEtpblRva2VuKCk7CgogICAgICAgIC8vIERlcGxveSBuZXcgVmVzdGluZ1RydXN0ZWUgY29udHJhY3QuCiAgICAgICAgdHJ1c3RlZSA9IG5ldyBWZXN0aW5nVHJ1c3RlZShraW4pOwoKICAgICAgICBmdW5kaW5nUmVjaXBpZW50ID0gX2Z1bmRpbmdSZWNpcGllbnQ7CiAgICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgICAgICBlbmRUaW1lID0gc3RhcnRUaW1lICsgU0FMRV9EVVJBVElPTjsKCiAgICAgICAgLy8gSW5pdGlhbGl6ZSBzcGVjaWFsIHZlc3RpbmcgZ3JhbnRzLgogICAgICAgIGluaXRUb2tlbkdyYW50cygpOwogICAgfQoKICAgIC8vLyBAZGV2IEluaXRpYWxpemUgdG9rZW4gZ3JhbnRzLgogICAgZnVuY3Rpb24gaW5pdFRva2VuR3JhbnRzKCkgcHJpdmF0ZSBvbmx5T3duZXIgewogICAgICAgIC8vIElzc3VlIHRoZSByZW1haW5pbmcgNjAlIHRvIEtpbiBGb3VuZGF0aW9uJ3MgbXVsdGlzaWcgd2FsbGV0LiBJbiBhIGZldyBkYXlzLCBhZnRlciB0aGUgdG9rZW4gc2FsZSBpcwogICAgICAgIC8vIGZpbmFsaXplZCwgdGhlc2UgdG9rZW5zIHdpbGwgYmUgbG9hZGVkIGludG8gdGhlIEtpblZlc3RpbmdUcnVzdGVlIHNtYXJ0IGNvbnRyYWN0LCBhY2NvcmRpbmcgdG8gdGhlIHdoaXRlCiAgICAgICAgLy8gcGFwZXIuIFBsZWFzZSBub3RlLCB0aGF0IHRoaXMgaXMgaW1wbGllZCBieSBzZXR0aW5nIGEgMCUgdmVzdGluZyBwZXJjZW50LgogICAgICAgIHRva2VuR3JhbnRlZXMucHVzaChLSU5fRk9VTkRBVElPTl9BRERSRVNTKTsKICAgICAgICB0b2tlbkdyYW50c1tLSU5fRk9VTkRBVElPTl9BRERSRVNTXSA9IFRva2VuR3JhbnQoTUFYX1RPS0VOUy5tdWwoNjApLmRpdigxMDApLCAwLCAwLCAzIHllYXJzLCAxIGRheXMsIDApOwoKICAgICAgICAvLyBLaWssIDMwJQogICAgICAgIHRva2VuR3JhbnRlZXMucHVzaChLSUtfQUREUkVTUyk7CiAgICAgICAgdG9rZW5HcmFudHNbS0lLX0FERFJFU1NdID0gVG9rZW5HcmFudChNQVhfVE9LRU5TLm11bCgzMCkuZGl2KDEwMCksIDAsIDAsIDEyMCB3ZWVrcywgMTIgd2Vla3MsIDEwMCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhIEtpbiB0b2tlbiB2ZXN0aW5nIGdyYW50LgogICAgLy8vIEBwYXJhbSBfZ3JhbnRlZSBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBncmFudGVlLiBDYW4gYmUgZ3JhbnRlZCBvbmx5IG9uY2UuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSB2YWx1ZSBvZiB0aGUgZ3JhbnQuCiAgICBmdW5jdGlvbiBhZGRUb2tlbkdyYW50KGFkZHJlc3MgX2dyYW50ZWUsIHVpbnQyNTYgX3ZhbHVlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX2dyYW50ZWUgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKHRva2VuR3JhbnRlZXMubGVuZ3RoICsgMSA8PSBNQVhfVE9LRU5fR1JBTlRFRVMpOwoKICAgICAgICAvLyBWZXJpZnkgdGhlIGdyYW50IGRvZXNuJ3QgYWxyZWFkeSBleGlzdC4KICAgICAgICByZXF1aXJlKHRva2VuR3JhbnRzW19ncmFudGVlXS52YWx1ZSA9PSAwKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkdyYW50ZWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUodG9rZW5HcmFudGVlc1tpXSAhPSBfZ3JhbnRlZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBBZGQgZ3JhbnQgYW5kIGFkZCB0byBncmFudGVlIGxpc3QuCiAgICAgICAgdG9rZW5HcmFudGVlcy5wdXNoKF9ncmFudGVlKTsKICAgICAgICB0b2tlbkdyYW50c1tfZ3JhbnRlZV0gPSBUb2tlbkdyYW50KF92YWx1ZSwgMCwgMSB5ZWFycywgMSB5ZWFycywgMSBkYXlzLCA1MCk7CiAgICB9CgogICAgLy8vIEBkZXYgRGVsZXRlcyBhIEtpbiB0b2tlbiBncmFudC4KICAgIC8vLyBAcGFyYW0gX2dyYW50ZWUgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gZ3JhbnRlZS4KICAgIGZ1bmN0aW9uIGRlbGV0ZVRva2VuR3JhbnQoYWRkcmVzcyBfZ3JhbnRlZSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9ncmFudGVlICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBEZWxldGUgdGhlIGdyYW50IGZyb20gdGhlIGtleXMgYXJyYXkuCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdG9rZW5HcmFudGVlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodG9rZW5HcmFudGVlc1tpXSA9PSBfZ3JhbnRlZSkgewogICAgICAgICAgICAgICAgZGVsZXRlIHRva2VuR3JhbnRlZXNbaV07CgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIERlbGV0ZSB0aGUgZ3JhbnQgZnJvbSB0aGUgbWFwcGluZy4KICAgICAgICBkZWxldGUgdG9rZW5HcmFudHNbX2dyYW50ZWVdOwogICAgfQoKICAgIC8vLyBAZGV2IEFkZCBhIGxpc3Qgb2YgcGFydGljaXBhbnRzIHRvIGEgY2FwcGVkIHBhcnRpY2lwYXRpb24gdGllci4KICAgIC8vLyBAcGFyYW0gX3BhcnRpY2lwYW50cyBhZGRyZXNzW10gVGhlIGxpc3Qgb2YgcGFydGljaXBhbnQgYWRkcmVzc2VzLgogICAgLy8vIEBwYXJhbSBfY2FwIHVpbnQyNTYgVGhlIGNhcCBhbW91bnQgKGluIEVUSCkuCiAgICBmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0aW9uQ2FwKGFkZHJlc3NbXSBfcGFydGljaXBhbnRzLCB1aW50MjU2IF9jYXApIHByaXZhdGUgb25seU93bmVyIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfcGFydGljaXBhbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHBhcnRpY2lwYXRpb25DYXBzW19wYXJ0aWNpcGFudHNbaV1dID0gX2NhcDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRkIGEgbGlzdCBvZiBwYXJ0aWNpcGFudHMgdG8gY2FwIHRpZXIgIzEuCiAgICAvLy8gQHBhcmFtIF9wYXJ0aWNpcGFudHMgYWRkcmVzc1tdIFRoZSBsaXN0IG9mIHBhcnRpY2lwYW50IGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIHNldFRpZXIxUGFydGljaXBhbnRzKGFkZHJlc3NbXSBfcGFydGljaXBhbnRzKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHNldFBhcnRpY2lwYXRpb25DYXAoX3BhcnRpY2lwYW50cywgVElFUl8xX0NBUCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkIGEgbGlzdCBvZiBwYXJ0aWNpcGFudHMgdG8gdGllciAjMi4KICAgIC8vLyBAcGFyYW0gX3BhcnRpY2lwYW50cyBhZGRyZXNzW10gVGhlIGxpc3Qgb2YgcGFydGljaXBhbnQgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gc2V0VGllcjJQYXJ0aWNpcGFudHMoYWRkcmVzc1tdIF9wYXJ0aWNpcGFudHMpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgc2V0UGFydGljaXBhdGlvbkNhcChfcGFydGljaXBhbnRzLCBUSUVSXzJfQ0FQKTsKICAgIH0KCiAgICAvLy8gQGRldiBTZXQgaGFyZCBwYXJ0aWNpcGF0aW9uIGNhcCBmb3IgYWxsIHBhcnRpY2lwYW50cy4KICAgIC8vLyBAcGFyYW0gX2NhcCB1aW50MjU2IFRoZSBoYXJkIGNhcCBhbW91bnQuCiAgICBmdW5jdGlvbiBzZXRIYXJkUGFydGljaXBhdGlvbkNhcCh1aW50MjU2IF9jYXApIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfY2FwID4gMCk7CgogICAgICAgIGhhcmRQYXJ0aWNpcGF0aW9uQ2FwID0gX2NhcDsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiB0aGF0IHdpbGwgZGVsZWdhdGUgdGhlIHJlcXVlc3QgdG8gY3JlYXRlKCkuCiAgICBmdW5jdGlvbiAoKSBleHRlcm5hbCBwYXlhYmxlIG9ubHlEdXJpbmdTYWxlIHsKICAgICAgICBjcmVhdGUobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlIGFuZCBzZWxsIHRva2VucyB0byB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCByZWNlaXZpbmcgdGhlIHRva2Vucy4KICAgIGZ1bmN0aW9uIGNyZWF0ZShhZGRyZXNzIF9yZWNpcGllbnQpIHB1YmxpYyBwYXlhYmxlIG9ubHlEdXJpbmdTYWxlIHsKICAgICAgICByZXF1aXJlKF9yZWNpcGllbnQgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIEVuZm9yY2UgcGFydGljaXBhdGlvbiBjYXAgKGluIFdlaSByZWNlaXZlZCkuCiAgICAgICAgdWludDI1NiB3ZWlBbHJlYWR5UGFydGljaXBhdGVkID0gcGFydGljaXBhdGlvbkhpc3RvcnlbbXNnLnNlbmRlcl07CiAgICAgICAgdWludDI1NiBwYXJ0aWNpcGF0aW9uQ2FwID0gU2FmZU1hdGgubWluMjU2KHBhcnRpY2lwYXRpb25DYXBzW21zZy5zZW5kZXJdLCBoYXJkUGFydGljaXBhdGlvbkNhcCk7CiAgICAgICAgdWludDI1NiBjYXBwZWRXZWlSZWNlaXZlZCA9IFNhZmVNYXRoLm1pbjI1Nihtc2cudmFsdWUsIHBhcnRpY2lwYXRpb25DYXAuc3ViKHdlaUFscmVhZHlQYXJ0aWNpcGF0ZWQpKTsKICAgICAgICByZXF1aXJlKGNhcHBlZFdlaVJlY2VpdmVkID4gMCk7CgogICAgICAgIC8vIEFjY2VwdCBmdW5kcyBhbmQgdHJhbnNmZXIgdG8gZnVuZGluZyByZWNpcGllbnQuCiAgICAgICAgdWludDI1NiB3ZWlMZWZ0SW5TYWxlID0gTUFYX1RPS0VOU19TT0xELnN1Yih0b2tlbnNTb2xkKS5kaXYoS0lOX1BFUl9XRUkpOwogICAgICAgIHVpbnQyNTYgd2VpVG9QYXJ0aWNpcGF0ZSA9IFNhZmVNYXRoLm1pbjI1NihjYXBwZWRXZWlSZWNlaXZlZCwgd2VpTGVmdEluU2FsZSk7CiAgICAgICAgcGFydGljaXBhdGlvbkhpc3RvcnlbbXNnLnNlbmRlcl0gPSB3ZWlBbHJlYWR5UGFydGljaXBhdGVkLmFkZCh3ZWlUb1BhcnRpY2lwYXRlKTsKICAgICAgICBmdW5kaW5nUmVjaXBpZW50LnRyYW5zZmVyKHdlaVRvUGFydGljaXBhdGUpOwoKICAgICAgICAvLyBJc3N1ZSB0b2tlbnMgYW5kIHRyYW5zZmVyIHRvIHJlY2lwaWVudC4KICAgICAgICB1aW50MjU2IHRva2Vuc0xlZnRJblNhbGUgPSBNQVhfVE9LRU5TX1NPTEQuc3ViKHRva2Vuc1NvbGQpOwogICAgICAgIHVpbnQyNTYgdG9rZW5zVG9Jc3N1ZSA9IHdlaVRvUGFydGljaXBhdGUubXVsKEtJTl9QRVJfV0VJKTsKICAgICAgICBpZiAodG9rZW5zTGVmdEluU2FsZS5zdWIodG9rZW5zVG9Jc3N1ZSkgPCBLSU5fUEVSX1dFSSkgewogICAgICAgICAgICAvLyBJZiBwdXJjaGFzZSB3b3VsZCBjYXVzZSBsZXNzIHRoYW4gS0lOX1BFUl9XRUkgdG9rZW5zIGxlZnQgdGhlbiBub2JvZHkgY291bGQgZXZlciBidXkgdGhlbS4KICAgICAgICAgICAgLy8gU28sIGdpZnQgdGhlbSB0byB0aGUgbGFzdCBidXllci4KICAgICAgICAgICAgdG9rZW5zVG9Jc3N1ZSA9IHRva2Vuc0xlZnRJblNhbGU7CiAgICAgICAgfQogICAgICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLmFkZCh0b2tlbnNUb0lzc3VlKTsKICAgICAgICBpc3N1ZVRva2VucyhfcmVjaXBpZW50LCB0b2tlbnNUb0lzc3VlKTsKCiAgICAgICAgLy8gUGFydGlhbCByZWZ1bmQgaWYgZnVsbCBwYXJ0aWNpcGF0aW9uIG5vdCBwb3NzaWJsZQogICAgICAgIC8vIGUuZy4gZHVlIHRvIGNhcCBiZWluZyByZWFjaGVkLgogICAgICAgIHVpbnQyNTYgcmVmdW5kID0gbXNnLnZhbHVlLnN1Yih3ZWlUb1BhcnRpY2lwYXRlKTsKICAgICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEZpbmFsaXplcyB0aGUgdG9rZW4gc2FsZSBldmVudCwgYnkgc3RvcHBpbmcgdG9rZW4gbWludGluZy4KICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgZXh0ZXJuYWwgb25seUFmdGVyU2FsZSBvbmx5T3duZXIgewogICAgICAgIGlmICgha2luLmlzTWludGluZygpKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShsYXN0R3JhbnRlZEluZGV4ID09IHRva2VuR3JhbnRlZXMubGVuZ3RoKTsKCiAgICAgICAgLy8gRmluaXNoIG1pbnRpbmcuCiAgICAgICAga2luLmVuZE1pbnRpbmcoKTsKICAgIH0KCiAgICAvLy8gQGRldiBHcmFudHMgcHJlLWNvbmZpZ3VyZWQgdG9rZW4gZ3JhbnRzIGluIGJhdGNoZXMuIFdoZW4gdGhlIG1ldGhvZCBpcyBjYWxsZWQsIGl0J2xsIHJlc3VtZSBmcm9tIHRoZSBsYXN0IGdyYW50LAogICAgLy8vIGZyb20gaXRzIHByZXZpb3VzIHJ1biwgYW5kIHdpbGwgZmluaXNoIGVpdGhlciBhZnRlciBncmFudGluZyBHUkFOVF9CQVRDSF9TSVpFIGdyYW50cyBvciBmaW5pc2hpbmcgdGhlIHdob2xlIGxpc3QKICAgIC8vLyBvZiBncmFudHMuCiAgICBmdW5jdGlvbiBncmFudFRva2VucygpIGV4dGVybmFsIG9ubHlBZnRlclNhbGUgb25seU93bmVyIHsKICAgICAgICB1aW50IGVuZEluZGV4ID0gU2FmZU1hdGgubWluMjU2KHRva2VuR3JhbnRlZXMubGVuZ3RoLCBsYXN0R3JhbnRlZEluZGV4ICsgR1JBTlRfQkFUQ0hfU0laRSk7CiAgICAgICAgZm9yICh1aW50IGkgPSBsYXN0R3JhbnRlZEluZGV4OyBpIDwgZW5kSW5kZXg7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIGdyYW50ZWUgPSB0b2tlbkdyYW50ZWVzW2ldOwoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyBoYXZlIGJlZW4gZ3JhbnRlZCwgdmVzdGVkLCBhbmQgaXNzdWVkIHN1Y2ggdGhhdDogZ3JhbnRlZCA9IHZlc3RlZCArIGlzc3VlZC4KICAgICAgICAgICAgVG9rZW5HcmFudCBtZW1vcnkgdG9rZW5HcmFudCA9IHRva2VuR3JhbnRzW2dyYW50ZWVdOwogICAgICAgICAgICB1aW50MjU2IHRva2Vuc0dyYW50ZWQgPSB0b2tlbkdyYW50LnZhbHVlLm11bCh0b2tlbnNTb2xkKS5kaXYoTUFYX1RPS0VOU19TT0xEKTsKICAgICAgICAgICAgdWludDI1NiB0b2tlbnNWZXN0aW5nID0gdG9rZW5zR3JhbnRlZC5tdWwodG9rZW5HcmFudC5wZXJjZW50VmVzdGVkKS5kaXYoMTAwKTsKICAgICAgICAgICAgdWludDI1NiB0b2tlbnNJc3N1ZWQgPSB0b2tlbnNHcmFudGVkLnN1Yih0b2tlbnNWZXN0aW5nKTsKCiAgICAgICAgICAgIC8vIFRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdGhhdCBoYXZlIHlldCB0byBiZSB0cmFuc2ZlcnJlZCB0byBncmFudGVlLgogICAgICAgICAgICBpZiAodG9rZW5zSXNzdWVkID4gMCkgewogICAgICAgICAgICAgICAgaXNzdWVUb2tlbnMoZ3JhbnRlZSwgdG9rZW5zSXNzdWVkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVHJhbnNmZXIgdmVzdGVkIHRva2VucyB0aGF0IGhhdmUgeWV0IHRvIGJlIHRyYW5zZmVycmVkIHRvIHZlc3RpbmcgdHJ1c3RlZSwgYW5kIGluaXRpYWxpemUgZ3JhbnQuCiAgICAgICAgICAgIGlmICh0b2tlbnNWZXN0aW5nID4gMCkgewogICAgICAgICAgICAgICAgaXNzdWVUb2tlbnModHJ1c3RlZSwgdG9rZW5zVmVzdGluZyk7CiAgICAgICAgICAgICAgICB0cnVzdGVlLmdyYW50KGdyYW50ZWUsIHRva2Vuc1Zlc3RpbmcsIG5vdy5hZGQodG9rZW5HcmFudC5zdGFydE9mZnNldCksIG5vdy5hZGQodG9rZW5HcmFudC5jbGlmZk9mZnNldCksCiAgICAgICAgICAgICAgICAgICAgbm93LmFkZCh0b2tlbkdyYW50LmVuZE9mZnNldCksIHRva2VuR3JhbnQuaW5zdGFsbG1lbnRMZW5ndGgsIHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYXN0R3JhbnRlZEluZGV4Kys7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IElzc3VlcyB0b2tlbnMgZm9yIHRoZSByZWNpcGllbnQuCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5zIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaXNzdWUuCiAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQyNTYgX3Rva2VucykgcHJpdmF0ZSB7CiAgICAgICAgLy8gUmVxdWVzdCBLaW4gdG9rZW4gY29udHJhY3QgdG8gbWludCB0aGUgcmVxdWVzdGVkIHRva2VucyBmb3IgdGhlIGJ1eWVyLgogICAgICAgIGtpbi5taW50KF9yZWNpcGllbnQsIF90b2tlbnMpOwoKICAgICAgICBUb2tlbnNJc3N1ZWQoX3JlY2lwaWVudCwgX3Rva2Vucyk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB3aGV0aGVyIHRoZSBzYWxlIGhhcyBlbmRlZC4KICAgIC8vLyBAcmV0dXJuIGJvb2wgV2hldGhlciB0aGUgc2FsZSBoYXMgZW5kZWQgb3Igbm90LgogICAgZnVuY3Rpb24gc2FsZUVuZGVkKCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRva2Vuc1NvbGQgPj0gTUFYX1RPS0VOU19TT0xEIHx8IG5vdyA+PSBlbmRUaW1lOwogICAgfQoKICAgIC8vLyBAZGV2IFJlcXVlc3RzIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIEtpbiB0b2tlbiBjb250cmFjdCB0byBhIG5ldyBvd25lci4KICAgIC8vLyBAcGFyYW0gX25ld093bmVyQ2FuZGlkYXRlIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgLy8vCiAgICAvLy8gTk9URToKICAgIC8vLyAgIDEuIFRoZSBuZXcgb3duZXIgd2lsbCBuZWVkIHRvIGNhbGwgS2luIHRva2VuIGNvbnRyYWN0J3MgYWNjZXB0T3duZXJzaGlwIGRpcmVjdGx5IGluIG9yZGVyIHRvIGFjY2VwdCB0aGUgb3duZXJzaGlwLgogICAgLy8vICAgMi4gQ2FsbGluZyB0aGlzIG1ldGhvZCBkdXJpbmcgdGhlIHRva2VuIHNhbGUgd2lsbCBwcmV2ZW50IHRoZSB0b2tlbiBzYWxlIHRvIGNvbnRpbnVlLCBzaW5jZSBvbmx5IHRoZSBvd25lciBvZgogICAgLy8vICAgICAgdGhlIEtpbiB0b2tlbiBjb250cmFjdCBjYW4gaXNzdWUgbmV3IHRva2Vucy4KICAgIGZ1bmN0aW9uIHJlcXVlc3RLaW5Ub2tlbk93bmVyc2hpcFRyYW5zZmVyKGFkZHJlc3MgX25ld093bmVyQ2FuZGlkYXRlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGtpbi5yZXF1ZXN0T3duZXJzaGlwVHJhbnNmZXIoX25ld093bmVyQ2FuZGlkYXRlKTsKICAgIH0KCiAgICAvLy8gQGRldiBBY2NlcHRzIG5ldyBvd25lcnNoaXAgb24gYmVoYWxmIG9mIHRoZSBLaW4gdG9rZW4gY29udHJhY3QuCiAgICAvLyBUaGlzIGNhbiBiZSB1c2VkIGJ5IHRoZSBzYWxlIGNvbnRyYWN0IGl0c2VsZiB0byBjbGFpbSBiYWNrIG93bmVyc2hpcCBvZiB0aGUgS2luIHRva2VuIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gYWNjZXB0S2luVG9rZW5Pd25lcnNoaXAoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGtpbi5hY2NlcHRPd25lcnNoaXAoKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1ZXN0cyB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBWZXN0aW5nVHJ1c3RlZSBjb250cmFjdCB0byBhIG5ldyBvd25lci4KICAgIC8vLyBAcGFyYW0gX25ld093bmVyQ2FuZGlkYXRlIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgLy8vCiAgICAvLy8gTk9URToKICAgIC8vLyAgIDEuIFRoZSBuZXcgb3duZXIgd2lsbCBuZWVkIHRvIGNhbGwgVmVzdGluZ1RydXN0ZWUncyBhY2NlcHRPd25lcnNoaXAgZGlyZWN0bHkgaW4gb3JkZXIgdG8gYWNjZXB0IHRoZSBvd25lcnNoaXAuCiAgICAvLy8gICAyLiBDYWxsaW5nIHRoaXMgbWV0aG9kIGR1cmluZyB0aGUgdG9rZW4gc2FsZSB3aWxsIHByZXZlbnQgdGhlIHRva2VuIHNhbGUgZnJvbSBmaW5hbGl6YWluZywgc2luY2Ugb25seSB0aGUgb3duZXIKICAgIC8vLyAgICAgIG9mIHRoZSBWZXN0aW5nVHJ1c3RlZSBjb250cmFjdCBjYW4gaXNzdWUgbmV3IHRva2VuIGdyYW50cy4KICAgIGZ1bmN0aW9uIHJlcXVlc3RWZXN0aW5nVHJ1c3RlZU93bmVyc2hpcFRyYW5zZmVyKGFkZHJlc3MgX25ld093bmVyQ2FuZGlkYXRlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHRydXN0ZWUucmVxdWVzdE93bmVyc2hpcFRyYW5zZmVyKF9uZXdPd25lckNhbmRpZGF0ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXB0cyBuZXcgb3duZXJzaGlwIG9uIGJlaGFsZiBvZiB0aGUgVmVzdGluZ1RydXN0ZWUgY29udHJhY3QuCiAgICAvLy8gVGhpcyBjYW4gYmUgdXNlZCBieSB0aGUgdG9rZW4gc2FsZSBjb250cmFjdCBpdHNlbGYgdG8gY2xhaW0gYmFjayBvd25lcnNoaXAgb2YgdGhlIFZlc3RpbmdUcnVzdGVlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gYWNjZXB0VmVzdGluZ1RydXN0ZWVPd25lcnNoaXAoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHRydXN0ZWUuYWNjZXB0T3duZXJzaGlwKCk7CiAgICB9Cn0='.
	

]
