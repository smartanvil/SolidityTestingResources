Class {
	#name : #SRT377dFA7BAb23A798cA1fa0923BCD4D4ef2184d85,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT377dFA7BAb23A798cA1fa0923BCD4D4ef2184d85 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgQWJzdHJhY3RTdGFyYmFzZVRva2VuIGlzIEVSQzIwIHsKICAgIGZ1bmN0aW9uIGlzRnVuZHJhaXNlcihhZGRyZXNzIGZ1bmRyYWlzZXJBZGRyZXNzKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBjb21wYW55KCkgcHVibGljIHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gYWxsb2NhdGVUb0Nyb3dkc2FsZVB1cmNoYXNlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhbGxvY2F0ZVRvTWFya2V0aW5nU3VwcG9ydGVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZSB7CiAgICBmdW5jdGlvbiB3b3Jrc2hvcCgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHt9CiAgICBmdW5jdGlvbiBzdGFydERhdGUoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7fQogICAgZnVuY3Rpb24gZW5kZWRBdCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHt9CiAgICBmdW5jdGlvbiBpc0VuZGVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB0b3RhbFJhaXNlZEFtb3VudEluQ255KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBudW1PZlB1cmNoYXNlZFRva2Vuc09uQ3NCeShhZGRyZXNzIHB1cmNoYXNlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeShhZGRyZXNzIHB1cmNoYXNlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7Cn0KCi8vIEB0aXRsZSBFYXJseVB1cmNoYXNlIGNvbnRyYWN0IC0gS2VlcCB0cmFjayBvZiBwdXJjaGFzZWQgYW1vdW50IGJ5IEVhcmx5IFB1cmNoYXNlcnMKLy8vIEBhdXRob3IgU3RhcmJhc2UgUFRFLiBMVEQuIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0MjJiMmMyNDJkMDIzMTM2MjMzMDIwMjMzMTI3NmMyMTJkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgU3RhcmJhc2VFYXJseVB1cmNoYXNlIHsKICAgIC8qCiAgICAgKiAgQ29uc3RhbnRzCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX1VOSVQgPSAnQ05ZJzsgICAgLy8gQ2hpbmVzZSBZdWFuCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0FNT1VOVF9SQVRFX1JFRkVSRU5DRSA9ICdodHRwOi8vd3d3LnhlLmNvbS9jdXJyZW5jeXRhYmxlcy8nOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX0NBUCA9IDkwMDAwMDA7CgogICAgLyoKICAgICAqICBUeXBlcwogICAgICovCiAgICBzdHJ1Y3QgRWFybHlQdXJjaGFzZSB7CiAgICAgICAgYWRkcmVzcyBwdXJjaGFzZXI7CiAgICAgICAgdWludDI1NiBhbW91bnQ7ICAgICAgICAvLyBDTlkgYmFzZWQgYW1vdW50CiAgICAgICAgdWludDI1NiBwdXJjaGFzZWRBdDsgICAvLyB0aW1lc3RhbXAKICAgIH0KCiAgICAvKgogICAgICogIEV4dGVybmFsIGNvbnRyYWN0cwogICAgICovCiAgICBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHB1YmxpYyBzdGFyYmFzZUNyb3dkc2FsZTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBFYXJseVB1cmNoYXNlW10gcHVibGljIGVhcmx5UHVyY2hhc2VzOwogICAgdWludDI1NiBwdWJsaWMgZWFybHlQdXJjaGFzZUNsb3NlZEF0OwoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG5vRXRoZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVDcm93ZHNhbGUoKSB7CiAgICAgICAgYXNzZXJ0KGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpID09IGFkZHJlc3MoMCkgfHwgc3RhcmJhc2VDcm93ZHNhbGUuc3RhcnREYXRlKCkgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RWFybHlQdXJjaGFzZVRlcm0oKSB7CiAgICAgICAgYXNzZXJ0KGVhcmx5UHVyY2hhc2VDbG9zZWRBdCA8PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgQ29udHJhY3QgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGJ5IHB1cmNoYXNlcidzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gcHVyY2hhc2VkQW1vdW50QnkoYWRkcmVzcyBwdXJjaGFzZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGVhcmx5UHVyY2hhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChlYXJseVB1cmNoYXNlc1tpXS5wdXJjaGFzZXIgPT0gcHVyY2hhc2VyKSB7CiAgICAgICAgICAgICAgICBhbW91bnQgKz0gZWFybHlQdXJjaGFzZXNbaV0uYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIGFtb3VudCBvZiByYWlzZWQgZnVuZHMgYnkgRWFybHkgUHVyY2hhc2VycwogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgdG90YWxBbW91bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBlYXJseVB1cmNoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3RhbEFtb3VudCArPSBlYXJseVB1cmNoYXNlc1tpXS5hbW91bnQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMKICAgICAqLwogICAgZnVuY3Rpb24gbnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBlYXJseVB1cmNoYXNlcy5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFwcGVuZCBhbiBlYXJseSBwdXJjaGFzZSBsb2cKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgICAqIEBwYXJhbSBhbW91bnQgUHVyY2hhc2UgYW1vdW50CiAgICAgKiBAcGFyYW0gcHVyY2hhc2VkQXQgVGltZXN0YW1wIG9mIHB1cmNoYXNlZCBkYXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcGVuZEVhcmx5UHVyY2hhc2UoYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHB1cmNoYXNlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZVRlcm0KICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChhbW91bnQgPT0gMCB8fAogICAgICAgICAgICB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSArIGFtb3VudCA+IFBVUkNIQVNFX0FNT1VOVF9DQVApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnQocHVyY2hhc2VkQXQgIT0gMCB8fCBwdXJjaGFzZWRBdCA8PSBub3cpOwoKICAgICAgICBlYXJseVB1cmNoYXNlcy5wdXNoKEVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENsb3NlIGVhcmx5IHB1cmNoYXNlIHRlcm0KICAgICAqLwogICAgZnVuY3Rpb24gY2xvc2VFYXJseVB1cmNoYXNlKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGVhcmx5UHVyY2hhc2VDbG9zZWRBdCA9IG5vdzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0dXAgZnVuY3Rpb24gc2V0cyBleHRlcm5hbCBjb250cmFjdCdzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MgVG9rZW4gYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcykKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSA9PSAwKSB7CiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlID0gQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZShzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBmdW5jdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UoKSBub0V0aGVyIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9Cn0KCgovLy8gQHRpdGxlIEVhcmx5UHVyY2hhc2VBbWVuZG1lbnQgY29udHJhY3QgLSBBbWVuZCBlYXJseSBwdXJjaGFzZSByZWNvcmRzIG9mIHRoZSBvcmlnaW5hbCBjb250cmFjdAovLy8gQGF1dGhvciBTdGFyYmFzZSBQVEUuIExURC4gLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjhhZjlmZmZhZmFlNWY4ZmVjYWY5ZmVlYmY4ZThlYmY5ZWZhNGU5ZTUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pgpjb250cmFjdCBTdGFyYmFzZUVhcmx5UHVyY2hhc2VBbWVuZG1lbnQgewogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgRWFybHlQdXJjaGFzZUludmFsaWRhdGVkKHVpbnQyNTYgZXBJZHgpOwogICAgZXZlbnQgRWFybHlQdXJjaGFzZUFtZW5kZWQodWludDI1NiBlcElkeCk7CgogICAgLyoKICAgICAqICBFeHRlcm5hbCBjb250cmFjdHMKICAgICAqLwogICAgQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZSBwdWJsaWMgc3RhcmJhc2VDcm93ZHNhbGU7CiAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UgcHVibGljIHN0YXJiYXNlRWFybHlQdXJjaGFzZTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICB1aW50MjU2W10gcHVibGljIGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlczsKICAgIHVpbnQyNTZbXSBwdWJsaWMgYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzOwogICAgbWFwcGluZyAodWludDI1NiA9PiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZSkgcHVibGljIGFtZW5kZWRFYXJseVB1cmNoYXNlczsKCiAgICAvKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBub0V0aGVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QmVmb3JlQ3Jvd2RzYWxlKCkgewogICAgICAgIGFzc2VydChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSA9PSBhZGRyZXNzKDApIHx8IHN0YXJiYXNlQ3Jvd2RzYWxlLnN0YXJ0RGF0ZSgpID09IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkKCkgewogICAgICAgIGFzc2VydChhZGRyZXNzKHN0YXJiYXNlRWFybHlQdXJjaGFzZSkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogIEZ1bmN0aW9ucyBiZWxvdyBhcmUgY29tcGF0aWJsZSB3aXRoIHN0YXJiYXNlRWFybHlQdXJjaGFzZSBjb250cmFjdAogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgYW4gZWFybHkgcHVyY2hhc2UgcmVjb3JkCiAgICAgKiBAcGFyYW0gZWFybHlQdXJjaGFzZUluZGV4IEluZGV4IG51bWJlciBvZiBhbiBlYXJseSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBlYXJseVB1cmNoYXNlcyh1aW50MjU2IGVhcmx5UHVyY2hhc2VJbmRleCkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkCiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHB1cmNoYXNlZEF0KQogICAgewogICAgICAgIHJldHVybiBzdGFyYmFzZUVhcmx5UHVyY2hhc2UuZWFybHlQdXJjaGFzZXMoZWFybHlQdXJjaGFzZUluZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGJ5IHB1cmNoYXNlcidzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gcHVyY2hhc2VkQW1vdW50QnkoYWRkcmVzcyBwdXJjaGFzZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdIG1lbW9yeSBub3JtYWxpemVkRVAgPQogICAgICAgICAgICBub3JtYWxpemVkRWFybHlQdXJjaGFzZXMoKTsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IG5vcm1hbGl6ZWRFUC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAobm9ybWFsaXplZEVQW2ldLnB1cmNoYXNlciA9PSBwdXJjaGFzZXIpIHsKICAgICAgICAgICAgICAgIGFtb3VudCArPSBub3JtYWxpemVkRVBbaV0uYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIGFtb3VudCBvZiByYWlzZWQgZnVuZHMgYnkgRWFybHkgUHVyY2hhc2VycwogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgdG90YWxBbW91bnQpCiAgICB7CiAgICAgICAgU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2VbXSBtZW1vcnkgbm9ybWFsaXplZEVQID0KICAgICAgICAgICAgbm9ybWFsaXplZEVhcmx5UHVyY2hhc2VzKCk7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBub3JtYWxpemVkRVAubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG90YWxBbW91bnQgKz0gbm9ybWFsaXplZEVQW2ldLmFtb3VudDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGVhcmx5IHB1cmNoYXNlcwogICAgICovCiAgICBmdW5jdGlvbiBudW1iZXJPZkVhcmx5UHVyY2hhc2VzKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRFYXJseVB1cmNoYXNlcygpLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0cyB1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIGNvbnRyYWN0J3MgYWRkcmVzcwogICAgICogQHBhcmFtIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcyBUb2tlbiBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwKGFkZHJlc3Mgc3RhcmJhc2VDcm93ZHNhbGVBZGRyZXNzKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpID09IDApIHsKICAgICAgICAgICAgc3RhcmJhc2VDcm93ZHNhbGUgPSBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlKHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcyk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoKICAgICAqICBDb250cmFjdCBmdW5jdGlvbnMgdW5pcXVlIHRvIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudAogICAgICovCgogICAgIC8qKgogICAgICAqIEBkZXYgSW52YWxpZGF0ZSBlYXJseSBwdXJjaGFzZQogICAgICAqIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIHRoZSBwdXJjaGFzZQogICAgICAqLwogICAgZnVuY3Rpb24gaW52YWxpZGF0ZUVhcmx5UHVyY2hhc2UodWludDI1NiBlYXJseVB1cmNoYXNlSW5kZXgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBub0V0aGVyCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkCiAgICAgICAgb25seUJlZm9yZUNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA+IGVhcmx5UHVyY2hhc2VJbmRleCk7IC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uCgogICAgICAgIGZvciAodWludDI1NiBpOyBpIDwgaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFzc2VydChpbnZhbGlkRWFybHlQdXJjaGFzZUluZGV4ZXNbaV0gIT0gZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICB9CgogICAgICAgIGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlcy5wdXNoKGVhcmx5UHVyY2hhc2VJbmRleCk7CiAgICAgICAgRWFybHlQdXJjaGFzZUludmFsaWRhdGVkKGVhcmx5UHVyY2hhc2VJbmRleCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIGVhcmx5IHB1cmNoYXNlIGlzIGludmFsaWQKICAgICAqIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIHRoZSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBpc0ludmFsaWRFYXJseVB1cmNoYXNlKHVpbnQyNTYgZWFybHlQdXJjaGFzZUluZGV4KQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA+IGVhcmx5UHVyY2hhc2VJbmRleCk7IC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uCgoKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzW2ldID09IGVhcmx5UHVyY2hhc2VJbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbWVuZHMgYSBnaXZlbiBlYXJseSBwdXJjaGFzZSB3aXRoIGRhdGEKICAgICAqIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIHRoZSBwdXJjaGFzZQogICAgICogQHBhcmFtIHB1cmNoYXNlciBQdXJjaGFzZXIncyBhZGRyZXNzCiAgICAgKiBAcGFyYW0gYW1vdW50IFZhbHVlIG9mIHB1cmNoYXNlCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VkQXQgUHVyY2hhc2UgdGltZXN0YW1wCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFtZW5kRWFybHlQdXJjaGFzZSh1aW50MjU2IGVhcmx5UHVyY2hhc2VJbmRleCwgYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHB1cmNoYXNlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZAogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFzc2VydChwdXJjaGFzZWRBdCAhPSAwIHx8IHB1cmNoYXNlZEF0IDw9IG5vdyk7CgogICAgICAgIGFzc2VydChudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCkgPiBlYXJseVB1cmNoYXNlSW5kZXgpOwoKICAgICAgICBhc3NlcnQoIWlzSW52YWxpZEVhcmx5UHVyY2hhc2UoZWFybHlQdXJjaGFzZUluZGV4KSk7IC8vIEludmFsaWQgZWFybHkgcHVyY2hhc2UgY2Fubm90IGJlIGFtZW5kZWQKCiAgICAgICAgaWYgKCFpc0FtZW5kZWRFYXJseVB1cmNoYXNlKGVhcmx5UHVyY2hhc2VJbmRleCkpIHsKICAgICAgICAgICAgYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzLnB1c2goZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICB9CgogICAgICAgIGFtZW5kZWRFYXJseVB1cmNoYXNlc1tlYXJseVB1cmNoYXNlSW5kZXhdID0KICAgICAgICAgICAgU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KTsKICAgICAgICBFYXJseVB1cmNoYXNlQW1lbmRlZChlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDaGVja3Mgd2hldGhlciBlYXJseSBwdXJjaGFzZSBpcyBhbWVuZGVkCiAgICAgKiBAcGFyYW0gZWFybHlQdXJjaGFzZUluZGV4IEluZGV4IG51bWJlciBvZiB0aGUgcHVyY2hhc2UKICAgICAqLwogICAgZnVuY3Rpb24gaXNBbWVuZGVkRWFybHlQdXJjaGFzZSh1aW50MjU2IGVhcmx5UHVyY2hhc2VJbmRleCkKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFzc2VydChudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCkgPiBlYXJseVB1cmNoYXNlSW5kZXgpOyAvLyBBcnJheSBJbmRleCBPdXQgb2YgQm91bmRzIEV4Y2VwdGlvbgoKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGFtZW5kZWRFYXJseVB1cmNoYXNlSW5kZXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzW2ldID09IGVhcmx5UHVyY2hhc2VJbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBMb2FkcyBlYXJseSBwdXJjaGFzZXMgZGF0YSB0byBTdGFyYmFzZUVhcmx5UHVyY2hhc2VBbWVuZG1lbnQgY29udHJhY3QKICAgICAqIEBwYXJhbSBzdGFyYmFzZUVhcmx5UHVyY2hhc2VBZGRyZXNzIEFkZHJlc3MgZnJvbSBzdGFyYmFzZSBlYXJseSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBsb2FkU3RhcmJhc2VFYXJseVB1cmNoYXNlcyhhZGRyZXNzIHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBub0V0aGVyCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUJlZm9yZUNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MgIT0gMCB8fAogICAgICAgICAgICBhZGRyZXNzKHN0YXJiYXNlRWFybHlQdXJjaGFzZSkgPT0gMCk7CgogICAgICAgIHN0YXJiYXNlRWFybHlQdXJjaGFzZSA9IFN0YXJiYXNlRWFybHlQdXJjaGFzZShzdGFyYmFzZUVhcmx5UHVyY2hhc2VBZGRyZXNzKTsKICAgICAgICBhc3NlcnQoc3RhcmJhc2VFYXJseVB1cmNoYXNlLmVhcmx5UHVyY2hhc2VDbG9zZWRBdCgpICE9IDApOyAvLyB0aGUgZWFybHkgcHVyY2hhc2UgbXVzdCBiZSBjbG9zZWQKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uLiBJdCBzZXRzIG93bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCgpIG5vRXRoZXIgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IE5vcm1hbGl6ZXMgZWFybHkgcHVyY2hhc2VzIGRhdGEKICAgICAqLwogICAgZnVuY3Rpb24gbm9ybWFsaXplZEVhcmx5UHVyY2hhc2VzKCkKICAgICAgICBjb25zdGFudAogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAoU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2VbXSBub3JtYWxpemVkRVApCiAgICB7CiAgICAgICAgdWludDI1NiByYXdFUENvdW50ID0gbnVtYmVyT2ZSYXdFYXJseVB1cmNoYXNlcygpOwogICAgICAgIG5vcm1hbGl6ZWRFUCA9IG5ldyBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdKAogICAgICAgICAgICByYXdFUENvdW50IC0gaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aCk7CgogICAgICAgIHVpbnQyNTYgbm9ybWFsaXplZElkeDsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IHJhd0VQQ291bnQ7IGkrKykgewogICAgICAgICAgICBpZiAoaXNJbnZhbGlkRWFybHlQdXJjaGFzZShpKSkgewogICAgICAgICAgICAgICAgY29udGludWU7ICAgLy8gaW52YWxpZCBlYXJseSBwdXJjaGFzZSBzaG91bGQgYmUgaWdub3JlZAogICAgICAgICAgICB9CgogICAgICAgICAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZSBtZW1vcnkgZXA7CiAgICAgICAgICAgIGlmIChpc0FtZW5kZWRFYXJseVB1cmNoYXNlKGkpKSB7CiAgICAgICAgICAgICAgICBlcCA9IGFtZW5kZWRFYXJseVB1cmNoYXNlc1tpXTsgIC8vIGFtZW5kZWQgZWFybHkgcHVyY2hhc2Ugc2hvdWxkIHRha2UgYSBwcmlvcml0eQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZXAgPSBnZXRFYXJseVB1cmNoYXNlKGkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBub3JtYWxpemVkRVBbbm9ybWFsaXplZElkeF0gPSBlcDsKICAgICAgICAgICAgbm9ybWFsaXplZElkeCsrOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmV0Y2hlcyBlYXJseSBwdXJjaGFzZXMgZGF0YQogICAgICovCiAgICBmdW5jdGlvbiBnZXRFYXJseVB1cmNoYXNlKHVpbnQyNTYgZWFybHlQdXJjaGFzZUluZGV4KQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQKICAgICAgICByZXR1cm5zIChTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZSkKICAgIHsKICAgICAgICB2YXIgKHB1cmNoYXNlciwgYW1vdW50LCBwdXJjaGFzZWRBdCkgPQogICAgICAgICAgICBzdGFyYmFzZUVhcmx5UHVyY2hhc2UuZWFybHlQdXJjaGFzZXMoZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICByZXR1cm4gU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyByYXcgbnVtYmVyIG9mIGVhcmx5IHB1cmNoYXNlcwogICAgICovCiAgICBmdW5jdGlvbiBudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gc3RhcmJhc2VFYXJseVB1cmNoYXNlLm51bWJlck9mRWFybHlQdXJjaGFzZXMoKTsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgQ3Jvd2RzYWxlIGNvbnRyYWN0IC0gU3RhcmJhc2UgY3Jvd2RzYWxlIHRvIGNyZWF0ZSBTVEFSLgogKiBAYXV0aG9yIFN0YXJiYXNlIFBURS4gTFRELiAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYThjMWM2Y2VjN2U4ZGJkY2M5ZGFjYWM5ZGJjZDg2Y2JjNyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CiAqLwpjb250cmFjdCBTdGFyYmFzZUNyb3dkc2FsZSBpcyBPd25hYmxlIHsKICAgIC8qCiAgICAgKiAgRXZlbnRzCiAgICAgKi8KICAgIGV2ZW50IENyb3dkc2FsZUVuZGVkKHVpbnQyNTYgZW5kZWRBdCk7CiAgICBldmVudCBTdGFyQmFzZVB1cmNoYXNlZFdpdGhFdGgoYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHJhd0Ftb3VudCwgdWludDI1NiBjbnlFdGhSYXRlLCB1aW50MjU2IGJvbnVzVG9rZW5zUGVyY2VudGFnZSk7CiAgICBldmVudCBTdGFyQmFzZVB1cmNoYXNlZE9mZkNoYWluKGFkZHJlc3MgcHVyY2hhc2VyLCB1aW50MjU2IGFtb3VudCwgdWludDI1NiByYXdBbW91bnQsIHVpbnQyNTYgY255QnRjUmF0ZSwgdWludDI1NiBib251c1Rva2Vuc1BlcmNlbnRhZ2UsIHN0cmluZyBkYXRhKTsKICAgIGV2ZW50IENueUV0aFJhdGVVcGRhdGVkKHVpbnQyNTYgY255RXRoUmF0ZSk7CiAgICBldmVudCBDbnlCdGNSYXRlVXBkYXRlZCh1aW50MjU2IGNueUJ0Y1JhdGUpOwogICAgZXZlbnQgUXVhbGlmaWVkUGFydG5lckFkZHJlc3MoYWRkcmVzcyBxdWFsaWZpZWRQYXJ0bmVyKTsKICAgIGV2ZW50IFB1cmNoYXNlSW52YWxpZGF0ZWQodWludDI1NiBwdXJjaGFzZUlkeCk7CiAgICBldmVudCBQdXJjaGFzZUFtZW5kZWQodWludDI1NiBwdXJjaGFzZUlkeCk7CgogICAgLyoqCiAgICAgKiAgRXh0ZXJuYWwgY29udHJhY3RzCiAgICAgKi8KICAgIEFic3RyYWN0U3RhcmJhc2VUb2tlbiBwdWJsaWMgc3RhcmJhc2VUb2tlbjsKICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCBwdWJsaWMgc3RhcmJhc2VFcEFtZW5kbWVudDsKCiAgICAvKioKICAgICAqICBDb25zdGFudHMKICAgICAqLwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgY3Jvd2RzYWxlVG9rZW5BbW91bnQgPSAxMjUwMDAwMDBlMTg7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBlYXJseVB1cmNoYXNlVG9rZW5BbW91bnQgPSA1MDAwMDAwMGUxODsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1JTl9JTlZFU1RNRU5UID0gMTsgLy8gbWluIGlzIDEgV2VpCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBNQVhfQ1JPV0RTQUxFX0NBUCA9IDYwMDAwMDAwOyAvLyBhcHByb3hpbWF0ZWx5IDlNIFVTRCBmb3IgdGhlIGNyb3dkc2FsZShDUykuIDFNIChieSBFUCkgKyA5TSAoYnkgQ1MpID0gMTBNIChUb3RhbCkKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX1VOSVQgPSAnQ05ZJzsgIC8vIENoaW5lc2UgWXVhbgoKICAgIC8qKgogICAgICogVHlwZXMKICAgICAqLwogICAgc3RydWN0IENyb3dkc2FsZVB1cmNoYXNlIHsKICAgICAgICBhZGRyZXNzIHB1cmNoYXNlcjsKICAgICAgICB1aW50MjU2IGFtb3VudDsgICAgICAgIC8vIENOWSBiYXNlZCBhbW91bnQgd2l0aCBib251cwogICAgICAgIHVpbnQyNTYgcmF3QW1vdW50OyAgICAgLy8gQ05ZIGJhc2VkIGFtb3VudCBubyBib251cwogICAgICAgIHVpbnQyNTYgcHVyY2hhc2VkQXQ7ICAgLy8gdGltZXN0YW1wCiAgICAgICAgc3RyaW5nIGRhdGE7ICAgICAgICAgICAvLyBhZGRpdGlvbmFsIGRhdGEgKGUuZy4gVHggSUQgb2YgQml0Y29pbikKICAgICAgICB1aW50MjU2IGJvbnVzOwogICAgfQoKICAgIHN0cnVjdCBRdWFsaWZpZWRQYXJ0bmVycyB7CiAgICAgICAgdWludDI1NiBhbW91bnRDYXA7CiAgICAgICAgdWludDI1NiBhbW91bnRSYWlzZWQ7CiAgICAgICAgYm9vbCAgICBib25hRmlkZTsKICAgICAgICB1aW50MjU2IGNvbW1pc3Npb25GZWVQZXJjZW50YWdlOyAvLyBleGFtcGxlIDUgd2lsbCBjYWxjdWxhdGUgdGhlIHBlcmNlbnRhZ2UgYXMgNSUKICAgIH0KCiAgICAvKioKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIHdvcmtzaG9wOyAvLyBob2xkcyB1bmRlbGl2ZXJlZCBTVEFScwoKICAgIHVpbnQgcHVibGljIG51bU9mRGVsaXZlcmVkQ3Jvd2RzYWxlUHVyY2hhc2VzID0gMDsgIC8vIGluZGV4IHRvIGtlZXAgdGhlIG51bWJlciBvZiBjcm93ZHNhbGUgcHVyY2hhc2VzIGhhdmUgYWxyZWFkeSBiZWVuIHByb2Nlc3NlZCBieSBgZGVsaXZlclB1cmNoYXNlZFRva2Vuc2AKICAgIHVpbnQgcHVibGljIG51bU9mRGVsaXZlcmVkRWFybHlQdXJjaGFzZXMgPSAwOyAgLy8gaW5kZXggdG8ga2VlcCB0aGUgbnVtYmVyIG9mIGVhcmx5IHB1cmNoYXNlcyBoYXZlIGFscmVhZHkgYmVlbiBwcm9jZXNzZWQgYnkgYGRlbGl2ZXJQdXJjaGFzZWRUb2tlbnNgCiAgICB1aW50MjU2IHB1YmxpYyBudW1PZkxvYWRlZEVhcmx5UHVyY2hhc2VzID0gMDsgLy8gaW5kZXggdG8ga2VlcCB0aGUgbnVtYmVyIG9mIGVhcmx5IHB1cmNoYXNlcyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIGxvYWRlZCBieSBgbG9hZEVhcmx5UHVyY2hhc2VzYAoKICAgIGFkZHJlc3NbXSBwdWJsaWMgZWFybHlQdXJjaGFzZXJzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBRdWFsaWZpZWRQYXJ0bmVycykgcHVibGljIHF1YWxpZmllZFBhcnRuZXJzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZWFybHlQdXJjaGFzZWRBbW91bnRCeTsgLy8gZWFybHkgcHVyY2hhc2VkIGFtb3VudCBpbiBDTlkgcGVyIHB1cmNoYXNlcnMnIGFkZHJlc3MKICAgIGJvb2wgcHVibGljIGVhcmx5UHVyY2hhc2VzTG9hZGVkID0gZmFsc2U7ICAvLyByZXR1cm5zIHdoZXRoZXIgYWxsIGVhcmx5IHB1cmNoYXNlcyBhcmUgbG9hZGVkIGludG8gdGhpcyBjb250cmFjdAoKICAgIC8vIGNyb3dkc2FsZQogICAgdWludDI1NiBwdWJsaWMgcHVyY2hhc2VTdGFydEJsb2NrOyAgLy8gY3Jvd2RzYWxlIHB1cmNoYXNlcyBjYW4gYmUgYWNjZXB0ZWQgZnJvbSB0aGlzIGJsb2NrIG51bWJlcgogICAgdWludDI1NiBwdWJsaWMgc3RhcnREYXRlOwogICAgdWludDI1NiBwdWJsaWMgZW5kZWRBdDsKICAgIENyb3dkc2FsZVB1cmNoYXNlW10gcHVibGljIGNyb3dkc2FsZVB1cmNoYXNlczsKICAgIHVpbnQyNTYgcHVibGljIGNueUJ0Y1JhdGU7IC8vIHRoaXMgcmF0ZSB3b24ndCBiZSB1c2VkIGZyb20gYSBzbWFydCBjb250cmFjdCBmdW5jdGlvbiBidXQgZXh0ZXJuYWwgc3lzdGVtCiAgICB1aW50MjU2IHB1YmxpYyBjbnlFdGhSYXRlOwoKICAgIC8vIGJvbnVzIG1pbGVzdG9uZXMKICAgIHVpbnQyNTYgcHVibGljIGZpcnN0Qm9udXNTYWxlc0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRCb251c1NhbGVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIHRoaXJkQm9udXNTYWxlc0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBmb3VydGhCb251c1NhbGVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIGZpZnRoQm9udXNTYWxlc0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBmaXJzdEV4dGVuZGVkQm9udXNTYWxlc0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOwogICAgdWludDI1NiBwdWJsaWMgdGhpcmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOwogICAgdWludDI1NiBwdWJsaWMgZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIGZpZnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIHNpeHRoRXh0ZW5kZWRCb251c1NhbGVzRW5kczsKCiAgICAvLyBhZnRlciB0aGUgY3Jvd2RzYWxlCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gQ3Jvd2RzYWxlUHVyY2hhc2UpIHB1YmxpYyBpbnZhbGlkYXRlZE9yaWdQdXJjaGFzZXM7ICAvLyBPcmlnaW5hbCBwdXJjaGFzZSB3aGljaCB3YXMgaW52YWxpZGF0ZWQgYnkgb3duZXIKICAgIG1hcHBpbmcodWludDI1NiA9PiBDcm93ZHNhbGVQdXJjaGFzZSkgcHVibGljIGFtZW5kZWRPcmlnUHVyY2hhc2VzOyAgICAgIC8vIE9yaWdpbmFsIHB1cmNoYXNlIHdoaWNoIHdhcyBhbWVuZGVkIGJ5IG93bmVyCgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkNzQnk7ICAgIC8vIHRoZSBudW1iZXIgb2YgdG9rZW5zIHB1cmNoYXNlZCBvbiB0aGUgY3Jvd2RzYWxlIGJ5IGEgcHVyY2hhc2VyCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeTsgICAgLy8gdGhlIG51bWJlciBvZiB0b2tlbnMgZWFybHkgcHVyY2hhc2VkIGJ5IGEgcHVyY2hhc2VyCgogICAgLyoqCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG1pbkludmVzdG1lbnQoKSB7CiAgICAgICAgLy8gVXNlciBoYXMgdG8gc2VuZCBhdCBsZWFzdCB0aGUgZXRoZXIgdmFsdWUgb2Ygb25lIHRva2VuLgogICAgICAgIGFzc2VydChtc2cudmFsdWUgPj0gTUlOX0lOVkVTVE1FTlQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgd2hlbkVuZGVkKCkgewogICAgICAgIGFzc2VydChpc0VuZGVkKCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaGFzQmFsYW5jZSgpIHsKICAgICAgICBhc3NlcnQodGhpcy5iYWxhbmNlID4gMCk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIHJhdGVJc1NldCh1aW50MjU2IF9yYXRlKSB7CiAgICAgICAgYXNzZXJ0KF9yYXRlICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgd2hlbk5vdEVuZGVkKCkgewogICAgICAgIGFzc2VydCghaXNFbmRlZCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHRva2Vuc05vdERlbGl2ZXJlZCgpIHsKICAgICAgICBhc3NlcnQobnVtT2ZEZWxpdmVyZWRDcm93ZHNhbGVQdXJjaGFzZXMgPT0gMCk7CiAgICAgICAgYXNzZXJ0KG51bU9mRGVsaXZlcmVkRWFybHlQdXJjaGFzZXMgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RnVuZHJhaXNlcigpIHsKICAgICAgYXNzZXJ0KGFkZHJlc3Moc3RhcmJhc2VUb2tlbikgIT0gMCk7CiAgICAgIGFzc2VydChzdGFyYmFzZVRva2VuLmlzRnVuZHJhaXNlcihtc2cuc2VuZGVyKSk7CiAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBDb250cmFjdCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBmdW5jdGlvbiBzZXRzIG93bmVyIGFuZCBzdGFydCBkYXRlLgogICAgICogQHBhcmFtIHdvcmtzaG9wQWRkciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB1bmRlbGl2ZXJlZCBTdGFyIHRva2VucwogICAgICogQHBhcmFtIHN0YXJiYXNlRXBBZGRyIFRoZSBhZGRyZXNzIHRoYXQgaG9sZHMgdGhlIGVhcmx5IHB1cmNoYXNlcnMgU3RhciB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gU3RhcmJhc2VDcm93ZHNhbGUoYWRkcmVzcyB3b3Jrc2hvcEFkZHIsIGFkZHJlc3Mgc3RhcmJhc2VFcEFkZHIpIHsKICAgICAgICByZXF1aXJlKHdvcmtzaG9wQWRkciAhPSAwICYmIHN0YXJiYXNlRXBBZGRyICE9IDApOwoKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgd29ya3Nob3AgPSB3b3Jrc2hvcEFkZHI7CiAgICAgICAgc3RhcmJhc2VFcEFtZW5kbWVudCA9IFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudChzdGFyYmFzZUVwQWRkcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZhbGxiYWNrIGFjY2VwdHMgcGF5bWVudCBmb3IgU3RhciB0b2tlbnMgd2l0aCBFdGgKICAgICAqLwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICByZWRpcmVjdFRvUHVyY2hhc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IFNldHVwIGZ1bmN0aW9uIHNldHMgZXh0ZXJuYWwgY29udHJhY3RzJyBhZGRyZXNzZXMuCiAgICAgKiBAcGFyYW0gc3RhcmJhc2VUb2tlbkFkZHJlc3MgVG9rZW4gYWRkcmVzcy4KICAgICAqIEBwYXJhbSBfcHVyY2hhc2VTdGFydEJsb2NrIEJsb2NrIG51bWJlciB0byBzdGFydCBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXAoYWRkcmVzcyBzdGFyYmFzZVRva2VuQWRkcmVzcywgdWludDI1NiBfcHVyY2hhc2VTdGFydEJsb2NrKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhc3NlcnQoYWRkcmVzcyhzdGFyYmFzZVRva2VuKSA9PSAwKTsKICAgICAgICBzdGFyYmFzZVRva2VuID0gQWJzdHJhY3RTdGFyYmFzZVRva2VuKHN0YXJiYXNlVG9rZW5BZGRyZXNzKTsKICAgICAgICBwdXJjaGFzZVN0YXJ0QmxvY2sgPSBfcHVyY2hhc2VTdGFydEJsb2NrOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3Mgb3duZXIgdG8gcmVjb3JkIGEgcHVyY2hhc2UgbWFkZSBvdXRzaWRlIG9mIEV0aGVyZXVtIGJsb2NrY2hhaW4KICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgQWRkcmVzcyBvZiBhIHB1cmNoYXNlcgogICAgICogQHBhcmFtIHJhd0Ftb3VudCBQdXJjaGFzZWQgYW1vdW50IGluIENOWQogICAgICogQHBhcmFtIHB1cmNoYXNlZEF0IFRpbWVzdGFtcCBhdCB0aGUgcHVyY2hhc2UgbWFkZQogICAgICogQHBhcmFtIGRhdGEgSWRlbnRpZmllciBhcyBhbiBldmlkZW5jZSBvZiB0aGUgcHVyY2hhc2UgKGUuZy4gYnRjOjF4eXp4eXopCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlY29yZE9mZmNoYWluUHVyY2hhc2UoCiAgICAgICAgYWRkcmVzcyBwdXJjaGFzZXIsCiAgICAgICAgdWludDI1NiByYXdBbW91bnQsCiAgICAgICAgdWludDI1NiBwdXJjaGFzZWRBdCwKICAgICAgICBzdHJpbmcgZGF0YQogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICB3aGVuTm90RW5kZWQKICAgICAgICByYXRlSXNTZXQoY255QnRjUmF0ZSkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUocHVyY2hhc2VTdGFydEJsb2NrID4gMCAmJiBibG9jay5udW1iZXIgPj0gcHVyY2hhc2VTdGFydEJsb2NrKTsKICAgICAgICBpZiAoc3RhcnREYXRlID09IDApIHsKICAgICAgICAgICAgc3RhcnRDcm93ZHNhbGUoYmxvY2sudGltZXN0YW1wKTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgYm9udXNUaWVyID0gZ2V0Qm9udXNUaWVyKCk7CiAgICAgICAgdWludCBhbW91bnQgPSByZWNvcmRQdXJjaGFzZShwdXJjaGFzZXIsIHJhd0Ftb3VudCwgcHVyY2hhc2VkQXQsIGRhdGEsIGJvbnVzVGllcik7CgogICAgICAgIFN0YXJCYXNlUHVyY2hhc2VkT2ZmQ2hhaW4ocHVyY2hhc2VyLCBhbW91bnQsIHJhd0Ftb3VudCwgY255QnRjUmF0ZSwgYm9udXNUaWVyLCBkYXRhKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVHJhbnNmZXJzIHJhaXNlZCBmdW5kcyB0byBjb21wYW55J3Mgd2FsbGV0IGFkZHJlc3MgYXQgYW55IGdpdmVuIHRpbWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3Rm9yQ29tcGFueSgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgIGhhc0JhbGFuY2UKICAgIHsKICAgICAgICBhZGRyZXNzIGNvbXBhbnkgPSBzdGFyYmFzZVRva2VuLmNvbXBhbnkoKTsKICAgICAgICByZXF1aXJlKGNvbXBhbnkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY29tcGFueS50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVcGRhdGUgdGhlIENOWS9FVEggcmF0ZSB0byByZWNvcmQgcHVyY2hhc2VzIGluIENOWQogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDbnlFdGhSYXRlKHVpbnQyNTYgcmF0ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBjbnlFdGhSYXRlID0gcmF0ZTsKICAgICAgICBDbnlFdGhSYXRlVXBkYXRlZChjbnlFdGhSYXRlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIHRoZSBDTlkvQlRDIHJhdGUgdG8gcmVjb3JkIHB1cmNoYXNlcyBpbiBDTlkKICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlQ255QnRjUmF0ZSh1aW50MjU2IHJhdGUpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgY255QnRjUmF0ZSA9IHJhdGU7CiAgICAgICAgQ255QnRjUmF0ZVVwZGF0ZWQoY255QnRjUmF0ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93IGZvciB0aGUgcG9zc2liaWx5dCBmb3IgY29udHJhY3Qgb3duZXIgdG8gc3RhcnQgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyU3RhcnRzQ3Jvd2RzYWxlKHVpbnQyNTYgdGltZXN0YW1wKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgYXNzZXJ0KHN0YXJ0RGF0ZSA9PSAwICYmIGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spOyAgIC8vIG92ZXJ3cml0aW5nIHN0YXJ0RGF0ZSBpcyBub3QgcGVybWl0dGVkIGFuZCBpdCBzaG91bGQgYmUgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBzdGFydCBibG9jawogICAgICAgIHN0YXJ0Q3Jvd2RzYWxlKHRpbWVzdGFtcCk7CgogICAgfQoKICAgIC8qKgogICAgICogQGRldiBFbmRzIGNyb3dkc2FsZQogICAgICogQHBhcmFtIHRpbWVzdGFtcCBUaW1lc3RhbXAgYXQgdGhlIGNyb3dkc2FsZSBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBlbmRDcm93ZHNhbGUodWludDI1NiB0aW1lc3RhbXApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBhc3NlcnQodGltZXN0YW1wID4gMCAmJiB0aW1lc3RhbXAgPD0gbm93KTsKICAgICAgICBhc3NlcnQoZW5kZWRBdCA9PSAwKTsgICAvLyBvdmVyd3JpdGluZyB0aW1lIGlzIG5vdCBwZXJtaXR0ZWQKICAgICAgICBlbmRlZEF0ID0gdGltZXN0YW1wOwogICAgICAgIENyb3dkc2FsZUVuZGVkKGVuZGVkQXQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBJbnZhbGlkYXRlIGEgY3Jvd2RzYWxlIHB1cmNoYXNlIGlmIHNvbWV0aGluZyBpcyB3cm9uZyB3aXRoIGl0CiAgICAgKiBAcGFyYW0gcHVyY2hhc2VJZHggSW5kZXggbnVtYmVyIG9mIHRoZSBjcm93ZHNhbGVQdXJjaGFzZXMgdG8gaW52YWxpZGF0ZQogICAgICovCiAgICBmdW5jdGlvbiBpbnZhbGlkYXRlUHVyY2hhc2UodWludDI1NiBwdXJjaGFzZUlkeCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgICAgIHdoZW5FbmRlZAogICAgICAgIHRva2Vuc05vdERlbGl2ZXJlZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgQ3Jvd2RzYWxlUHVyY2hhc2UgbWVtb3J5IHB1cmNoYXNlID0gY3Jvd2RzYWxlUHVyY2hhc2VzW3B1cmNoYXNlSWR4XTsKICAgICAgICBhc3NlcnQocHVyY2hhc2UucHVyY2hhc2VyICE9IDAgJiYgcHVyY2hhc2UuYW1vdW50ICE9IDApOwoKICAgICAgICBjcm93ZHNhbGVQdXJjaGFzZXNbcHVyY2hhc2VJZHhdLmFtb3VudCA9IDA7CiAgICAgICAgY3Jvd2RzYWxlUHVyY2hhc2VzW3B1cmNoYXNlSWR4XS5yYXdBbW91bnQgPSAwOwogICAgICAgIGludmFsaWRhdGVkT3JpZ1B1cmNoYXNlc1twdXJjaGFzZUlkeF0gPSBwdXJjaGFzZTsKICAgICAgICBQdXJjaGFzZUludmFsaWRhdGVkKHB1cmNoYXNlSWR4KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQW1lbmQgYSBjcm93ZHNhbGUgcHVyY2hhc2UgaWYgc29tZXRoaW5nIGlzIHdyb25nIHdpdGggaXQKICAgICAqIEBwYXJhbSBwdXJjaGFzZUlkeCBJbmRleCBudW1iZXIgb2YgdGhlIGNyb3dkc2FsZVB1cmNoYXNlcyB0byBpbnZhbGlkYXRlCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VyIEFkZHJlc3Mgb2YgdGhlIGJ1eWVyCiAgICAgKiBAcGFyYW0gYW1vdW50IFB1cmNoYXNlZCB0b2tlbnMgYXMgcGVyIHRoZSBDTlkgcmF0ZSB1c2VkCiAgICAgKiBAcGFyYW0gcmF3QW1vdW50IFB1cmNoYXNlZCB0b2tlbnMgYXMgcGVyIHRoZSBDTlkgcmF0ZSB1c2VkIHdpdGhvdXQgdGhlIGJvbnVzCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VkQXQgVGltZXN0YW1wIGF0IHRoZSBwdXJjaGFzZSBtYWRlCiAgICAgKiBAcGFyYW0gZGF0YSBJZGVudGlmaWVyIGFzIGFuIGV2aWRlbmNlIG9mIHRoZSBwdXJjaGFzZSAoZS5nLiBidGM6MXh5enh5eikKICAgICAqIEBwYXJhbSBib251cyBib251cyBtaWxlc3RvbmVzIG9mIHRoZSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBhbWVuZFB1cmNoYXNlKAogICAgICAgIHVpbnQyNTYgcHVyY2hhc2VJZHgsCiAgICAgICAgYWRkcmVzcyBwdXJjaGFzZXIsCiAgICAgICAgdWludDI1NiBhbW91bnQsCiAgICAgICAgdWludDI1NiByYXdBbW91bnQsCiAgICAgICAgdWludDI1NiBwdXJjaGFzZWRBdCwKICAgICAgICBzdHJpbmcgZGF0YSwKICAgICAgICB1aW50MjU2IGJvbnVzCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgICAgICB3aGVuRW5kZWQKICAgICAgICB0b2tlbnNOb3REZWxpdmVyZWQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIENyb3dkc2FsZVB1cmNoYXNlIG1lbW9yeSBwdXJjaGFzZSA9IGNyb3dkc2FsZVB1cmNoYXNlc1twdXJjaGFzZUlkeF07CiAgICAgICAgYXNzZXJ0KHB1cmNoYXNlLnB1cmNoYXNlciAhPSAwICYmIHB1cmNoYXNlLmFtb3VudCAhPSAwKTsKCiAgICAgICAgYW1lbmRlZE9yaWdQdXJjaGFzZXNbcHVyY2hhc2VJZHhdID0gcHVyY2hhc2U7CiAgICAgICAgY3Jvd2RzYWxlUHVyY2hhc2VzW3B1cmNoYXNlSWR4XSA9CiAgICAgICAgICAgIENyb3dkc2FsZVB1cmNoYXNlKHB1cmNoYXNlciwgYW1vdW50LCByYXdBbW91bnQsIHB1cmNoYXNlZEF0LCBkYXRhLCBib251cyk7CiAgICAgICAgUHVyY2hhc2VBbWVuZGVkKHB1cmNoYXNlSWR4KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRGVsaXZlciB0b2tlbnMgdG8gcHVyY2hhc2VycyBhY2NvcmRpbmcgdG8gdGhlaXIgcHVyY2hhc2UgYW1vdW50IGluIENOWQogICAgICovCiAgICBmdW5jdGlvbiBkZWxpdmVyUHVyY2hhc2VkVG9rZW5zKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgICAgIHdoZW5FbmRlZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KGVhcmx5UHVyY2hhc2VzTG9hZGVkKTsKICAgICAgICBhc3NlcnQoYWRkcmVzcyhzdGFyYmFzZVRva2VuKSAhPSAwKTsKCiAgICAgICAgdWludDI1NiB0b3RhbEFtb3VudE9mUHVyY2hhc2VzSW5DbnkgPSB0b3RhbFJhaXNlZEFtb3VudEluQ255KCk7IC8vIHRvdGFsUHJlU2FsZSArIHRvdGFsQ3Jvd2RzYWxlCgogICAgICAgIGZvciAodWludDI1NiBpID0gbnVtT2ZEZWxpdmVyZWRDcm93ZHNhbGVQdXJjaGFzZXM7IGkgPCBjcm93ZHNhbGVQdXJjaGFzZXMubGVuZ3RoICYmIG1zZy5nYXMgPiAyMDAwMDA7IGkrKykgewogICAgICAgICAgICBDcm93ZHNhbGVQdXJjaGFzZSBtZW1vcnkgcHVyY2hhc2UgPSBjcm93ZHNhbGVQdXJjaGFzZXNbaV07CiAgICAgICAgICAgIGlmIChwdXJjaGFzZS5hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICAgY29udGludWU7ICAgLy8gc2tpcCBpbnZhbGlkYXRlZCBwdXJjaGFzZQogICAgICAgICAgICB9CgogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiDigJxWYWx1ZeKAnSByZWZlcnMgdG8gdGhlIGNvbnRyaWJ1dGlvbiBvZiB0aGUgVXNlcjoKICAgICAgICAgICAgICogIHtjcm93ZHNhbGVfcHVyY2hhc2VyX3Rva2VuX2Ftb3VudH0gPQogICAgICAgICAgICAgKiAge2Nyb3dkc2FsZV90b2tlbl9hbW91bnR9ICoge2Nyb3dkc2FsZVB1cmNoYXNlX3ZhbHVlfSAvIHtlYXJseXB1cmNoYXNlX3ZhbHVlfSArIHtjcm93ZHNhbGVfdmFsdWV9LgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBFeGFtcGxlOiBJZiBhIFVzZXIgY29udHJpYnV0ZXMgZHVyaW5nIHRoZSBDb250cmlidXRpb24gUGVyaW9kIDEwMCBDTlkgKGluY2x1ZGluZyBhcHBsaWNhYmxlCiAgICAgICAgICAgICAqIEJvbnVzLCBpZiBhbnkpIGFuZCB0aGUgdG90YWwgYW1vdW50IGVhcmx5IHB1cmNoYXNlcyBhbW91bnRzIHRvIDbigJkwMDDigJkwMDAgQ05ZCiAgICAgICAgICAgICAqIGFuZCB0b3RhbCBhbW91bnQgcmFpc2VkIGR1cmluZyB0aGUgQ29udHJpYnV0aW9uIFBlcmlvZCBpcyAzMOKAmTAwMOKAmTAwMCwgdGhlbiBoZSB3aWxsIGdldAogICAgICAgICAgICAgKiAzNDcuMjIgU1RBUiA9IDEyNeKAmTAwMOKAmTAwMCBTVEFSICogMTAwIENOWSAvIDMw4oCZMDAw4oCZMDAwIENOWSArIDbigJkwMDDigJkwMDAgQ05ZLgogICAgICAgICAgICAqLwoKICAgICAgICAgICAgdWludDI1NiBjcm93ZHNhbGVQdXJjaGFzZVZhbHVlID0gcHVyY2hhc2UuYW1vdW50OwogICAgICAgICAgICB1aW50MjU2IHRva2VuQ291bnQgPSBTYWZlTWF0aC5tdWwoY3Jvd2RzYWxlVG9rZW5BbW91bnQsIGNyb3dkc2FsZVB1cmNoYXNlVmFsdWUpIC8gdG90YWxBbW91bnRPZlB1cmNoYXNlc0luQ255OwoKICAgICAgICAgICAgbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkNzQnlbcHVyY2hhc2UucHVyY2hhc2VyXSA9IFNhZmVNYXRoLmFkZChudW1PZlB1cmNoYXNlZFRva2Vuc09uQ3NCeVtwdXJjaGFzZS5wdXJjaGFzZXJdLCB0b2tlbkNvdW50KTsKICAgICAgICAgICAgc3RhcmJhc2VUb2tlbi5hbGxvY2F0ZVRvQ3Jvd2RzYWxlUHVyY2hhc2VyKHB1cmNoYXNlLnB1cmNoYXNlciwgdG9rZW5Db3VudCk7CiAgICAgICAgICAgIG51bU9mRGVsaXZlcmVkQ3Jvd2RzYWxlUHVyY2hhc2VzID0gU2FmZU1hdGguYWRkKGksIDEpOwogICAgICAgIH0KCiAgICAgICAgZm9yICh1aW50MjU2IGogPSBudW1PZkRlbGl2ZXJlZEVhcmx5UHVyY2hhc2VzOyBqIDwgZWFybHlQdXJjaGFzZXJzLmxlbmd0aCAmJiBtc2cuZ2FzID4gMjAwMDAwOyBqKyspIHsKICAgICAgICAgICAgYWRkcmVzcyBlYXJseVB1cmNoYXNlciA9IGVhcmx5UHVyY2hhc2Vyc1tqXTsKCiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIOKAnFZhbHVl4oCdIHJlZmVycyB0byB0aGUgY29udHJpYnV0aW9uIG9mIHRoZSBVc2VyOgogICAgICAgICAgICAgKiB7ZWFybHlwdXJjaGFzZXJfdG9rZW5fYW1vdW50fSA9CiAgICAgICAgICAgICAqIHtlYXJseXB1cmNoYXNlcl90b2tlbl9hbW91bnR9ICogKHtlYXJseXB1cmNoYXNlX3ZhbHVlfSAvIHt0b3RhbF9lYXJseXB1cmNoYXNlX3ZhbHVlfSkKICAgICAgICAgICAgICogICsge2Nyb3dkc2FsZV90b2tlbl9hbW91bnR9ICogKHtlYXJseXB1cmNoYXNlX3ZhbHVlfSAvIHtlYXJseXB1cmNoYXNlX3ZhbHVlfSArIHtjcm93ZHNhbGVfdmFsdWV9KS4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogRXhhbXBsZTogSWYgYW4gRWFybHkgUHVyY2hhc2VyIGNvbnRyaWJ1dGVzIDEwMCBDTlkgKGluY2x1ZGluZyBCb251cyBvZiAyMCUpIGFuZCB0aGUKICAgICAgICAgICAgICogdG90YWwgYW1vdW50IG9mIGVhcmx5IHB1cmNoYXNlcyBhbW91bnRzIHRvIDbigJkwMDDigJkwMDAgQ05ZIGFuZCB0aGUgdG90YWwgYW1vdW50IHJhaXNlZAogICAgICAgICAgICAgKiBkdXJpbmcgdGhlIENvbnRyaWJ1dGlvbiBQZXJpb2QgaXMgMzDigJkwMDDigJkwMDAgQ05ZLCB0aGVuIGhlIHdpbGwgZ2V0IDExODAuNTUgU1RBUiA9CiAgICAgICAgICAgICAqIDUw4oCZMDAw4oCZMDAwIFNUQVIgKiAxMDAgQ05ZIC8gNuKAmTAwMOKAmTAwMCBDTlkgKyAxMjXigJkwMDDigJkwMDAgU1RBUiAqIDEwMCBDTlkgLwogICAgICAgICAgICAgKiAzMOKAmTAwMOKAmTAwMCBDTlkgKyA24oCZMDAw4oCZMDAwIENOWQogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIHVpbnQyNTYgZWFybHlQdXJjaGFzZXJQdXJjaGFzZVZhbHVlID0gZWFybHlQdXJjaGFzZWRBbW91bnRCeVtlYXJseVB1cmNoYXNlcl07CgogICAgICAgICAgICB1aW50MjU2IGVwVG9rZW5DYWxjdWxhdGlvbkZyb21FUFRva2VuQW1vdW50ID0gU2FmZU1hdGgubXVsKGVhcmx5UHVyY2hhc2VUb2tlbkFtb3VudCwgZWFybHlQdXJjaGFzZXJQdXJjaGFzZVZhbHVlKSAvIHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlcygpOwoKICAgICAgICAgICAgdWludDI1NiBlcFRva2VuQ2FsY3VsYXRpb25Gcm9tQ3Jvd2RzYWxlVG9rZW5BbW91bnQgPSBTYWZlTWF0aC5tdWwoY3Jvd2RzYWxlVG9rZW5BbW91bnQsIGVhcmx5UHVyY2hhc2VyUHVyY2hhc2VWYWx1ZSkgLyB0b3RhbEFtb3VudE9mUHVyY2hhc2VzSW5Dbnk7CgogICAgICAgICAgICB1aW50MjU2IGVwVG9rZW5Db3VudCA9IFNhZmVNYXRoLmFkZChlcFRva2VuQ2FsY3VsYXRpb25Gcm9tRVBUb2tlbkFtb3VudCwgZXBUb2tlbkNhbGN1bGF0aW9uRnJvbUNyb3dkc2FsZVRva2VuQW1vdW50KTsKCiAgICAgICAgICAgIG51bU9mUHVyY2hhc2VkVG9rZW5zT25FcEJ5W2Vhcmx5UHVyY2hhc2VyXSA9IFNhZmVNYXRoLmFkZChudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeVtlYXJseVB1cmNoYXNlcl0sIGVwVG9rZW5Db3VudCk7CiAgICAgICAgICAgIHN0YXJiYXNlVG9rZW4uYWxsb2NhdGVUb0Nyb3dkc2FsZVB1cmNoYXNlcihlYXJseVB1cmNoYXNlciwgZXBUb2tlbkNvdW50KTsKICAgICAgICAgICAgbnVtT2ZEZWxpdmVyZWRFYXJseVB1cmNoYXNlcyA9IFNhZmVNYXRoLmFkZChqLCAxKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBMb2FkIGVhcmx5IHB1cmNoYXNlcyBmcm9tIHRoZSBjb250cmFjdCBrZWVwcyB0cmFjayBvZiB0aGVtCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxvYWRFYXJseVB1cmNoYXNlcygpIGV4dGVybmFsIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGVhcmx5UHVyY2hhc2VzTG9hZGVkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgICAgLy8gYWxsIEVQcyBoYXZlIGFscmVhZHkgYmVlbiBsb2FkZWQKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgbnVtT2ZPcmlnRXAgPSBzdGFyYmFzZUVwQW1lbmRtZW50CiAgICAgICAgICAgIC5zdGFyYmFzZUVhcmx5UHVyY2hhc2UoKQogICAgICAgICAgICAubnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpOwoKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXM7IGkgPCBudW1PZk9yaWdFcCAmJiBtc2cuZ2FzID4gMjAwMDAwOyBpKyspIHsKICAgICAgICAgICAgaWYgKHN0YXJiYXNlRXBBbWVuZG1lbnQuaXNJbnZhbGlkRWFybHlQdXJjaGFzZShpKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIChwdXJjaGFzZXIsIGFtb3VudCwpID0KICAgICAgICAgICAgICAgIHN0YXJiYXNlRXBBbWVuZG1lbnQuaXNBbWVuZGVkRWFybHlQdXJjaGFzZShpKQogICAgICAgICAgICAgICAgPyBzdGFyYmFzZUVwQW1lbmRtZW50LmFtZW5kZWRFYXJseVB1cmNoYXNlcyhpKQogICAgICAgICAgICAgICAgOiBzdGFyYmFzZUVwQW1lbmRtZW50LmVhcmx5UHVyY2hhc2VzKGkpOwogICAgICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgaWYgKGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbcHVyY2hhc2VyXSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZWFybHlQdXJjaGFzZXJzLnB1c2gocHVyY2hhc2VyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGVhY2ggZWFybHkgcHVyY2hhc2VyIHJlY2VpdmVzIDIwJSBib251cwogICAgICAgICAgICAgICAgdWludDI1NiBib251cyA9IFNhZmVNYXRoLm11bChhbW91bnQsIDIwKSAvIDEwMDsKICAgICAgICAgICAgICAgIHVpbnQyNTYgYW1vdW50V2l0aEJvbnVzID0gU2FmZU1hdGguYWRkKGFtb3VudCwgYm9udXMpOwoKICAgICAgICAgICAgICAgIGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbcHVyY2hhc2VyXSArPSBhbW91bnRXaXRoQm9udXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMgKz0gaTsKICAgICAgICBhc3NlcnQobnVtT2ZMb2FkZWRFYXJseVB1cmNoYXNlcyA8PSBudW1PZk9yaWdFcCk7CiAgICAgICAgaWYgKG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMgPT0gbnVtT2ZPcmlnRXApIHsKICAgICAgICAgICAgZWFybHlQdXJjaGFzZXNMb2FkZWQgPSB0cnVlOyAgICAvLyBlbmFibGUgdGhlIGZsYWcKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICogQGRldiBTZXQgcXVhbGlmaWVkIGNyb3dkc2FsZSBwYXJ0bmVyIGkuZS4gQml0Y29pbiBTdWlzc2UgYWRkcmVzcwogICAgICAqIEBwYXJhbSBfcXVhbGlmaWVkUGFydG5lciBBZGRyZXNzIG9mIHRoZSBxdWFsaWZpZWQgcGFydG5lciB0aGF0IGNhbiBwdXJjaGFzZSBkdXJpbmcgY3Jvd2RzYWxlCiAgICAgICogQHBhcmFtIF9hbW91bnRDYXAgRXRoZXIgdmFsdWUgd2hpY2ggcGFydG5lciBpcyBhYmxlIHRvIGNvbnRyaWJ1dGUKICAgICAgKiBAcGFyYW0gX2NvbW1pc3Npb25GZWVQZXJjZW50YWdlIEludGVnZXIgdGhhdCByZXByZXNlbnRzIHRoZSBmZWUgdG8gcGF5IHF1YWxpZmllZCBwYXJ0bmVyIDUgaXMgNSUKICAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFF1YWxpZmllZFBhcnRuZXIoYWRkcmVzcyBfcXVhbGlmaWVkUGFydG5lciwgdWludDI1NiBfYW1vdW50Q2FwLCB1aW50MjU2IF9jb21taXNzaW9uRmVlUGVyY2VudGFnZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGFzc2VydCghcXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYm9uYUZpZGUgPSB0cnVlOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW19xdWFsaWZpZWRQYXJ0bmVyXS5hbW91bnRDYXAgPSBfYW1vdW50Q2FwOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW19xdWFsaWZpZWRQYXJ0bmVyXS5jb21taXNzaW9uRmVlUGVyY2VudGFnZSA9IF9jb21taXNzaW9uRmVlUGVyY2VudGFnZTsKICAgICAgICBRdWFsaWZpZWRQYXJ0bmVyQWRkcmVzcyhfcXVhbGlmaWVkUGFydG5lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZSBhZGRyZXNzIGZyb20gcXVhbGlmaWVkIHBhcnRuZXJzIGxpc3QuCiAgICAgKiBAcGFyYW0gX3F1YWxpZmllZFBhcnRuZXIgQWRkcmVzcyB0byBiZSByZW1vdmVkIGZyb20gdGhlIGxpc3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVubGlzdFF1YWxpZmllZFBhcnRuZXIoYWRkcmVzcyBfcXVhbGlmaWVkUGFydG5lcikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYm9uYUZpZGUgPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIHdoaXRlbGlzdGVkIGFkZHJlc3MgYW1vdW50IGFsbG93ZWQgdG8gcmFpc2UgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICogQHBhcmFtIF9xdWFsaWZpZWRQYXJ0bmVyIFF1YWxpZmllZCBQYXJ0bmVyIGFkZHJlc3MgdG8gYmUgdXBkYXRlZC4KICAgICAqIEBwYXJhbSBfYW1vdW50Q2FwIEFtb3VudCB0aGF0IHRoZSBhZGRyZXNzIGlzIGFibGUgdG8gcmFpc2UgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVRdWFsaWZpZWRQYXJ0bmVyQ2FwQW1vdW50KGFkZHJlc3MgX3F1YWxpZmllZFBhcnRuZXIsIHVpbnQyNTYgX2Ftb3VudENhcCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYW1vdW50Q2FwID0gX2Ftb3VudENhcDsKICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIGJvb2xlYW4gZm9yIHdoZXRoZXIgY3Jvd2RzYWxlIGhhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBpc0VuZGVkKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKGVuZGVkQXQgPiAwICYmIGVuZGVkQXQgPD0gbm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgcHVyY2hhc2VzIHRvIGRhdGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gY3Jvd2RzYWxlUHVyY2hhc2VzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2FsY3VsYXRlcyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZCBpbmNsdWRlcyBib251cyB0b2tlbnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NiBhbW91bnQpIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGNyb3dkc2FsZVB1cmNoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhbW91bnQgPSBTYWZlTWF0aC5hZGQoYW1vdW50LCBjcm93ZHNhbGVQdXJjaGFzZXNbaV0uYW1vdW50KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbGN1bGF0ZXMgdG90YWwgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQgd2l0aG91dCBib251cyBjb252ZXJzaW9uLgogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KSB7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBjcm93ZHNhbGVQdXJjaGFzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYW1vdW50ID0gU2FmZU1hdGguYWRkKGFtb3VudCwgY3Jvd2RzYWxlUHVyY2hhc2VzW2ldLnJhd0Ftb3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIHJhaXNlZCBhbW91bnQgaW4gQ05ZIChpbmNsdWRlcyBFUCkgYW5kIGJvbnVzZXMKICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxSYWlzZWRBbW91bnRJbkNueSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmFkZCh0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSwgdG90YWxBbW91bnRPZkNyb3dkc2FsZVB1cmNoYXNlcygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0b3RhbCBhbW91bnQgb2YgZWFybHkgcHVyY2hhc2VzIGluIENOWQogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICByZXR1cm4gc3RhcmJhc2VFcEFtZW5kbWVudC50b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHF1YWxpZmllZCBjcm93ZHNhbGUgcGFydG5lciB0byBwdXJjaGFzZSBTdGFyIFRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBwdXJjaGFzZUFzUXVhbGlmaWVkUGFydG5lcigpCiAgICAgICAgcGF5YWJsZQogICAgICAgIHB1YmxpYwogICAgICAgIHJhdGVJc1NldChjbnlFdGhSYXRlKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5ib25hRmlkZSk7CiAgICAgICAgcXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYW1vdW50UmFpc2VkID0gU2FmZU1hdGguYWRkKG1zZy52YWx1ZSwgcXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYW1vdW50UmFpc2VkKTsKCiAgICAgICAgYXNzZXJ0KHF1YWxpZmllZFBhcnRuZXJzW21zZy5zZW5kZXJdLmFtb3VudFJhaXNlZCA8PSBxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5hbW91bnRDYXApOwoKICAgICAgICB1aW50MjU2IGJvbnVzVGllciA9IDMwOyAvLyBQcmUgc2FsZSBwdXJjaGFzZXJzIGdldCAzMCBwZXJjZW50IGJvbnVzCiAgICAgICAgdWludDI1NiByYXdBbW91bnQgPSBTYWZlTWF0aC5tdWwobXNnLnZhbHVlLCBjbnlFdGhSYXRlKSAvIDFlMTg7CiAgICAgICAgdWludCBhbW91bnQgPSByZWNvcmRQdXJjaGFzZShtc2cuc2VuZGVyLCByYXdBbW91bnQsIG5vdywgJycsIGJvbnVzVGllcik7CgogICAgICAgIGlmIChxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5jb21taXNzaW9uRmVlUGVyY2VudGFnZSA+IDApIHsKICAgICAgICAgICAgc2VuZFF1YWxpZmllZFBhcnRuZXJDb21taXNzaW9uRmVlKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICBTdGFyQmFzZVB1cmNoYXNlZFdpdGhFdGgobXNnLnNlbmRlciwgYW1vdW50LCByYXdBbW91bnQsIGNueUV0aFJhdGUsIGJvbnVzVGllcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB1c2VyIHRvIHB1cmNoYXNlIFNUQVIgdG9rZW5zIHdpdGggRXRoZXIKICAgICAqLwogICAgZnVuY3Rpb24gcHVyY2hhc2VXaXRoRXRoKCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgcHVibGljCiAgICAgICAgbWluSW52ZXN0bWVudAogICAgICAgIHdoZW5Ob3RFbmRlZAogICAgICAgIHJhdGVJc1NldChjbnlFdGhSYXRlKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShwdXJjaGFzZVN0YXJ0QmxvY2sgPiAwICYmIGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spOwogICAgICAgIGlmIChzdGFydERhdGUgPT0gMCkgewogICAgICAgICAgICBzdGFydENyb3dkc2FsZShibG9jay50aW1lc3RhbXApOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBib251c1RpZXIgPSBnZXRCb251c1RpZXIoKTsKCiAgICAgICAgdWludDI1NiByYXdBbW91bnQgPSBTYWZlTWF0aC5tdWwobXNnLnZhbHVlLCBjbnlFdGhSYXRlKSAvIDFlMTg7CiAgICAgICAgdWludCBhbW91bnQgPSByZWNvcmRQdXJjaGFzZShtc2cuc2VuZGVyLCByYXdBbW91bnQsIG5vdywgJycsIGJvbnVzVGllcik7CgogICAgICAgIFN0YXJCYXNlUHVyY2hhc2VkV2l0aEV0aChtc2cuc2VuZGVyLCBhbW91bnQsIHJhd0Ftb3VudCwgY255RXRoUmF0ZSwgYm9udXNUaWVyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IEluaXRpYWxpemVzIFN0YXJiYXNlIGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBzdGFydENyb3dkc2FsZSh1aW50MjU2IHRpbWVzdGFtcCkgaW50ZXJuYWwgewogICAgICAgIHN0YXJ0RGF0ZSA9IHRpbWVzdGFtcDsKCiAgICAgICAgLy8gc2V0IHRva2VuIGJvbnVzIG1pbGVzdG9uZXMKICAgICAgICBmaXJzdEJvbnVzU2FsZXNFbmRzID0gc3RhcnREYXRlICsgNyBkYXlzOyAgICAgICAgICAgICAvLyAxLiAxc3QgfiA3dGggZGF5CiAgICAgICAgc2Vjb25kQm9udXNTYWxlc0VuZHMgPSBmaXJzdEJvbnVzU2FsZXNFbmRzICsgMTQgZGF5czsgLy8gMi4gOHRoIH4gMjFzdCBkYXkKICAgICAgICB0aGlyZEJvbnVzU2FsZXNFbmRzID0gc2Vjb25kQm9udXNTYWxlc0VuZHMgKyAxNCBkYXlzOyAvLyAzLiAyMm5kIH4gMzV0aCBkYXkKICAgICAgICBmb3VydGhCb251c1NhbGVzRW5kcyA9IHRoaXJkQm9udXNTYWxlc0VuZHMgKyA3IGRheXM7ICAvLyA0LiAzNnRoIH4gNDJuZCBkYXkKICAgICAgICBmaWZ0aEJvbnVzU2FsZXNFbmRzID0gZm91cnRoQm9udXNTYWxlc0VuZHMgKyAzIGRheXM7ICAvLyA1LiA0M3JkIH4gNDV0aCBkYXkKCiAgICAgICAgLy8gZXh0ZW5kZWQgc2FsZXMgYm9udXMgbWlsZXN0b25lcwogICAgICAgIGZpcnN0RXh0ZW5kZWRCb251c1NhbGVzRW5kcyA9IGZpZnRoQm9udXNTYWxlc0VuZHMgKyAzIGRheXM7ICAgICAgICAgLy8gMS4gNDZ0aCB+IDQ4dGggZGF5CiAgICAgICAgc2Vjb25kRXh0ZW5kZWRCb251c1NhbGVzRW5kcyA9IGZpcnN0RXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDMgZGF5czsgLy8gMi4gNDl0aCB+IDUxc3QgZGF5CiAgICAgICAgdGhpcmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzID0gc2Vjb25kRXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDMgZGF5czsgLy8gMy4gNTJuZCB+IDU0dGggZGF5CiAgICAgICAgZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyA9IHRoaXJkRXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDMgZGF5czsgLy8gNC4gNTV0aCB+IDU3dGggZGF5CiAgICAgICAgZmlmdGhFeHRlbmRlZEJvbnVzU2FsZXNFbmRzID0gZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDMgZGF5czsgIC8vIDUuIDU4dGggfiA2MHRoIGRheQogICAgICAgIHNpeHRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyA9IGZpZnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDYwIGRheXM7IC8vIDYuIDYxc3QgfiAxMjB0aCBkYXkKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWJzdHJhY3QgcmVjb3JkIG9mIGEgcHVyY2hhc2UgdG8gVG9rZW5zCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VyIEFkZHJlc3Mgb2YgdGhlIGJ1eWVyCiAgICAgKiBAcGFyYW0gcmF3QW1vdW50IEFtb3VudCBpbiBDTlkgYXMgcGVyIHRoZSBDTlkvRVRIIHJhdGUgdXNlZAogICAgICogQHBhcmFtIHRpbWVzdGFtcCBUaW1lc3RhbXAgYXQgdGhlIHB1cmNoYXNlIG1hZGUKICAgICAqIEBwYXJhbSBkYXRhIElkZW50aWZpZXIgYXMgYW4gZXZpZGVuY2Ugb2YgdGhlIHB1cmNoYXNlIChlLmcuIGJ0YzoxeHl6eHl6KQogICAgICogQHBhcmFtIGJvbnVzVGllciBib251cyBtaWxlc3RvbmVzIG9mIHRoZSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiByZWNvcmRQdXJjaGFzZSgKICAgICAgICBhZGRyZXNzIHB1cmNoYXNlciwKICAgICAgICB1aW50MjU2IHJhd0Ftb3VudCwKICAgICAgICB1aW50MjU2IHRpbWVzdGFtcCwKICAgICAgICBzdHJpbmcgZGF0YSwKICAgICAgICB1aW50MjU2IGJvbnVzVGllcgogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBhbW91bnQgPSByYXdBbW91bnQ7IC8vIGFtb3VudCB0byBjaGVjayByZWFjaCBvZiBtYXggY2FwLiBpdCBkb2VzIG5vdCBjYXJlIGZvciBib251cyB0b2tlbnMgaGVyZQoKICAgICAgICAvLyBwcmVzYWxlIHRyYW5zZmVycyB3aGljaCBvY2N1cnMgYmVmb3JlIHRoZSBjcm93ZHNhbGUgaWdub3JlcyB0aGUgY3Jvd2RzYWxlIGhhcmQgY2FwCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spIHsKCiAgICAgICAgICAgIGFzc2VydCh0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzKCkgPD0gTUFYX0NST1dEU0FMRV9DQVApOwoKICAgICAgICAgICAgdWludDI1NiBjcm93ZHNhbGVUb3RhbEFtb3VudEFmdGVyUHVyY2hhc2UgPSBTYWZlTWF0aC5hZGQodG90YWxBbW91bnRPZkNyb3dkc2FsZVB1cmNoYXNlc1dpdGhvdXRCb251cygpLCBhbW91bnQpOwoKICAgICAgICAgICAgLy8gY2hlY2sgd2hldGhlciBwdXJjaGFzZSBnb2VzIG92ZXIgdGhlIGNhcCBhbmQgc2VuZCB0aGUgZGlmZmVyZW5jZSBiYWNrIHRvIHRoZSBwdXJjaGFzZXIuCiAgICAgICAgICAgIGlmIChjcm93ZHNhbGVUb3RhbEFtb3VudEFmdGVyUHVyY2hhc2UgPiBNQVhfQ1JPV0RTQUxFX0NBUCkgewogICAgICAgICAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZSA9IFNhZmVNYXRoLnN1Yihjcm93ZHNhbGVUb3RhbEFtb3VudEFmdGVyUHVyY2hhc2UsIE1BWF9DUk9XRFNBTEVfQ0FQKTsKICAgICAgICAgICAgICB1aW50MjU2IGV0aFZhbHVlVG9SZXR1cm4gPSBTYWZlTWF0aC5tdWwoZGlmZmVyZW5jZSwgMWUxOCkgLyBjbnlFdGhSYXRlOwogICAgICAgICAgICAgIHB1cmNoYXNlci50cmFuc2ZlcihldGhWYWx1ZVRvUmV0dXJuKTsKICAgICAgICAgICAgICBhbW91bnQgPSBTYWZlTWF0aC5zdWIoYW1vdW50LCBkaWZmZXJlbmNlKTsKICAgICAgICAgICAgICByYXdBbW91bnQgPSBhbW91bnQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IGNvdmVydGVkQW1vdW50d1dpdGhCb251cyA9IFNhZmVNYXRoLm11bChhbW91bnQsIGJvbnVzVGllcikgLyAxMDA7CiAgICAgICAgYW1vdW50ID0gU2FmZU1hdGguYWRkKGFtb3VudCwgY292ZXJ0ZWRBbW91bnR3V2l0aEJvbnVzKTsgLy8gYXQgdGhpcyBwb2ludCBhbW91bnQgYm9udXMgaXMgY2FsY3VsYXRlZAoKICAgICAgICBDcm93ZHNhbGVQdXJjaGFzZSBtZW1vcnkgcHVyY2hhc2UgPSBDcm93ZHNhbGVQdXJjaGFzZShwdXJjaGFzZXIsIGFtb3VudCwgcmF3QW1vdW50LCB0aW1lc3RhbXAsIGRhdGEsIGJvbnVzVGllcik7CiAgICAgICAgY3Jvd2RzYWxlUHVyY2hhc2VzLnB1c2gocHVyY2hhc2UpOwogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZldGNocyBCb251cyB0aWVyIHBlcmNlbnRhZ2UgcGVyIGJvbnVzIG1pbGVzdG9uZXMKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Qm9udXNUaWVyKCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGJvb2wgZmlyc3RCb251c1NhbGVzUGVyaW9kID0gbm93ID49IHN0YXJ0RGF0ZSAmJiBub3cgPD0gZmlyc3RCb251c1NhbGVzRW5kczsgLy8gMXN0IH4gN3RoIGRheSBnZXQgMjAlIGJvbnVzCiAgICAgICAgYm9vbCBzZWNvbmRCb251c1NhbGVzUGVyaW9kID0gbm93ID4gZmlyc3RCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gc2Vjb25kQm9udXNTYWxlc0VuZHM7IC8vIDh0aCB+IDIxc3QgZGF5IGdldCAxNSUgYm9udXMKICAgICAgICBib29sIHRoaXJkQm9udXNTYWxlc1BlcmlvZCA9IG5vdyA+IHNlY29uZEJvbnVzU2FsZXNFbmRzICYmIG5vdyA8PSB0aGlyZEJvbnVzU2FsZXNFbmRzOyAvLyAyMm5kIH4gMzV0aCBkYXkgZ2V0IDEwJSBib251cwogICAgICAgIGJvb2wgZm91cnRoQm9udXNTYWxlc1BlcmlvZCA9IG5vdyA+IHRoaXJkQm9udXNTYWxlc0VuZHMgJiYgbm93IDw9IGZvdXJ0aEJvbnVzU2FsZXNFbmRzOyAvLyAzNnRoIH4gNDJuZCBkYXkgZ2V0IDUlIGJvbnVzCiAgICAgICAgYm9vbCBmaWZ0aEJvbnVzU2FsZXNQZXJpb2QgPSBub3cgPiBmb3VydGhCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gZmlmdGhCb251c1NhbGVzRW5kczsgLy8gNDNyZCBhbmQgNDV0aCBkYXkgZ2V0IDAlIGJvbnVzCgogICAgICAgIC8vIGV4dGVuZGVkIGJvbnVzIHNhbGVzCiAgICAgICAgYm9vbCBmaXJzdEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCA9IG5vdyA+IGZpZnRoQm9udXNTYWxlc0VuZHMgJiYgbm93IDw9IGZpcnN0RXh0ZW5kZWRCb251c1NhbGVzRW5kczsgLy8gZXh0ZW5kZWQgc2FsZXMgNDZ0aCB+IDQ4dGggZGF5IGdldCAyMCUgYm9udXMKICAgICAgICBib29sIHNlY29uZEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCA9IG5vdyA+IGZpcnN0RXh0ZW5kZWRCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gc2Vjb25kRXh0ZW5kZWRCb251c1NhbGVzRW5kczsgLy8gNDl0aCB+IDUxc3QgMTUlIGJvbnVzCiAgICAgICAgYm9vbCB0aGlyZEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCA9IG5vdyA+IHNlY29uZEV4dGVuZGVkQm9udXNTYWxlc0VuZHMgJiYgbm93IDw9IHRoaXJkRXh0ZW5kZWRCb251c1NhbGVzRW5kczsgLy8gNTJuZCB+IDU0dGggZGF5IGdldCAxMCUgYm9udXMKICAgICAgICBib29sIGZvdXJ0aEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCA9IG5vdyA+IHRoaXJkRXh0ZW5kZWRCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kczsgLy8gNTV0aCB+IDU3dGggZGF5IGRheSBnZXQgNSUgYm9udXMKICAgICAgICBib29sIGZpZnRoRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kID0gbm93ID4gZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gZmlmdGhFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOyAvLyA1OHRoIH4gNjB0aCBkYXkgZ2V0IDAlIGJvbnVzCiAgICAgICAgYm9vbCBzaXh0aEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCA9IG5vdyA+IGZpZnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gc2l4dGhFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOyAvLyA2MXN0IH4gMTIwdGggZGF5IGdldCB7bnVtYmVyX29mX2RheXN9IC0gNjAgKiAxJSBib251cwoKICAgICAgICBpZiAoZmlyc3RCb251c1NhbGVzUGVyaW9kIHx8IGZpcnN0RXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kKSByZXR1cm4gMjA7CiAgICAgICAgaWYgKHNlY29uZEJvbnVzU2FsZXNQZXJpb2QgfHwgc2Vjb25kRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kKSByZXR1cm4gMTU7CiAgICAgICAgaWYgKHRoaXJkQm9udXNTYWxlc1BlcmlvZCB8fCB0aGlyZEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCkgcmV0dXJuIDEwOwogICAgICAgIGlmIChmb3VydGhCb251c1NhbGVzUGVyaW9kIHx8IGZvdXJ0aEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCkgcmV0dXJuIDU7CiAgICAgICAgaWYgKGZpZnRoQm9udXNTYWxlc1BlcmlvZCB8fCBmaWZ0aEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCkgcmV0dXJuIDA7CgogICAgICAgIGlmIChzaXh0aEV4dGVuZGVkQm9udXNTYWxlc1BlcmlvZCkgewogICAgICAgICAgdWludDI1NiBEQVlfSU5fU0VDT05EUyA9IDg2NDAwOwogICAgICAgICAgdWludDI1NiBzZWNvbmRzU2luY2VTdGFydERhdGUgPSBTYWZlTWF0aC5zdWIobm93LCBzdGFydERhdGUpOwogICAgICAgICAgdWludDI1NiBudW1iZXJPZkRheXMgPSBzZWNvbmRzU2luY2VTdGFydERhdGUgLyBEQVlfSU5fU0VDT05EUzsKCiAgICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKG51bWJlck9mRGF5cywgNjApOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmV0Y2hzIEJvbnVzIHRpZXIgcGVyY2VudGFnZSBwZXIgYm9udXMgbWlsZXN0b25lcwogICAgICogQGRldiBxdWFsaWZpZWRQYXJ0bmVyIEFkZHJlc3Mgb2YgcGFydG5lcnMgdGhhdCBwYXJ0aWNpcGF0ZWQgaW4gcHJlIHNhbGUKICAgICAqIEBkZXYgYW1vdW50U2VudCBWYWx1ZSBzZW50IGJ5IHF1YWxpZmllZCBwYXJ0bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlbmRRdWFsaWZpZWRQYXJ0bmVyQ29tbWlzc2lvbkZlZShhZGRyZXNzIHF1YWxpZmllZFBhcnRuZXIsIHVpbnQyNTYgYW1vdW50U2VudCkgaW50ZXJuYWwgewogICAgICAgIC8vY2FsY3VsYXRlIHRoZSBjb21taXNzaW9uIGZlZSB0byBzZW5kIHRvIHF1YWxpZmllZCBwYXJ0bmVyCiAgICAgICAgdWludDI1NiBjb21taXNzaW9uRmVlUGVyY2VudGFnZUNhbGN1bGF0aW9uQW1vdW50ID0gU2FmZU1hdGgubXVsKGFtb3VudFNlbnQsIHF1YWxpZmllZFBhcnRuZXJzW3F1YWxpZmllZFBhcnRuZXJdLmNvbW1pc3Npb25GZWVQZXJjZW50YWdlKSAvIDEwMDsKCiAgICAgICAgLy8gc2VuZCBjb21taXNzaW9uIGZlZSBhbW91bnQKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyLnRyYW5zZmVyKGNvbW1pc3Npb25GZWVQZXJjZW50YWdlQ2FsY3VsYXRpb25BbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiByZWRpcmVjdFRvUHVyY2hhc2UgUmVkaXJlY3QgdG8gYWRlcXVhdGUgcHVyY2hhc2UgZnVuY3Rpb24gd2l0aGluIHRoZSBzbWFydCBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiByZWRpcmVjdFRvUHVyY2hhc2UoKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8IHB1cmNoYXNlU3RhcnRCbG9jaykgewogICAgICAgICAgICBwdXJjaGFzZUFzUXVhbGlmaWVkUGFydG5lcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB1cmNoYXNlV2l0aEV0aCgpOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
