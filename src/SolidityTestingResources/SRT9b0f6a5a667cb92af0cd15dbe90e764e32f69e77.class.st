Class {
	#name : #SRT9b0f6a5a667cb92af0cd15dbe90e764e32f69e77,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9b0f6a5a667cb92af0cd15dbe90e764e32f69e77 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCi8qCiAqIFRva2VuIC0gaXMgYSBzbWFydCBjb250cmFjdCBpbnRlcmZhY2UgCiAqIGZvciBtYW5hZ2luZyBjb21tb24gZnVuY3Rpb25hbGl0eSBvZiAKICogYSB0b2tlbi4KICoKICogRVJDLjIwIFRva2VuIHN0YW5kYXJkOiBodHRwczovL2dpdGh1Yi5jb20vZXRoIGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBUb2tlbkludGVyZmFjZSB7CgogICAgICAgIAogICAgLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludCB0b3RhbFN1cHBseVZhcjsKCiAgICAKICAgIC8qKgogICAgICoKICAgICAqIGJhbGFuY2VPZigpIC0gY29uc3RhbnQgZnVuY3Rpb24gY2hlY2sgY29uY3JldGUgdG9rZW5zIGJhbGFuY2UgIAogICAgICoKICAgICAqICBAcGFyYW0gb3duZXIgLSBhY2NvdW50IG93bmVyCiAgICAgKiAgCiAgICAgKiAgQHJldHVybiB0aGUgdmFsdWUgb2YgYmFsYW5jZSAKICAgICAqLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKgogICAgICogYXBwcm92ZSgpIC0gZnVuY3Rpb24gYXBwcm92ZXMgdG8gYSBwZXJzb24gdG8gc3BlbmQgc29tZSB0b2tlbnMgZnJvbSAKICAgICAqICAgICAgICAgICBvd25lciBiYWxhbmNlLiAKICAgICAqCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJzb24gd2hvbSB0aGlzIHJpZ2h0IGJlZW4gZ3JhbnRlZC4KICAgICAqICBAcGFyYW0gdmFsdWUgICAtIHZhbHVlIHRvIHNwZW5kLgogICAgICogCiAgICAgKiAgQHJldHVybiB0cnVlIGluIGNhc2Ugb2Ygc3VjY2VzLCBvdGhlcndpc2UgZmFpbHVyZQogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICoKICAgICAqIGFsbG93YW5jZSgpIC0gY29uc3RhbnQgZnVuY3Rpb24gdG8gY2hlY2sgaG93IG11Y2ggaXMgCiAgICAgKiAgICAgICAgICAgICAgIHBlcm1pdHRlZCB0byBzcGVuZCB0byAzcmQgcGVyc29uIGZyb20gb3duZXIgYmFsYW5jZQogICAgICoKICAgICAqICBAcGFyYW0gb3duZXIgICAtIG93bmVyIG9mIHRoZSBiYWxhbmNlCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJtaXR0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uIAogICAgICogIAogICAgICogIEByZXR1cm4gLSByZW1haW5pbmcgcmlnaHQgdG8gc3BlbmQgCiAgICAgKiAKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogICAgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxTdXBwbHkpewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseVZhcjsgICAgCiAgICB9CgogICAgLy8gZXZlbnRzIG5vdGlmaWNhdGlvbnMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKgogKiBTdGFuZGFyZFRva2VuIC0gaXMgYSBzbWFydCBjb250cmFjdCAgCiAqIGZvciBtYW5hZ2luZyBjb21tb24gZnVuY3Rpb25hbGl0eSBvZiAKICogYSB0b2tlbi4KICoKICogRVJDLjIwIFRva2VuIHN0YW5kYXJkOiAKICogICAgICAgICBodHRwczovL2dpdGh1Yi5jb20vZXRoIGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIFRva2VuSW50ZXJmYWNlIHsKCgogICAgLy8gdG9rZW4gb3duZXJzaGlwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAgIC8vIHNwZW5kaW5nIHBlcm1pc2lvbiBtYW5hZ2VtZW50CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgICAKICAgIAogICAgCiAgICBmdW5jdGlvbiBTdGFuZGFyZFRva2VuKCl7CiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiB0cmFuc2ZlcigpIC0gdHJhbnNmZXIgdG9rZW5zIGZyb20gbXNnLnNlbmRlciBiYWxhbmNlIAogICAgICogICAgICAgICAgICAgIHRvIHJlcXVlc3RlZCBhY2NvdW50CiAgICAgKgogICAgICogIEBwYXJhbSB0byAgICAtIHRhcmdldCBhZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VucwogICAgICogIEBwYXJhbSB2YWx1ZSAtIGFtbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKgogICAgICogIEByZXR1cm4gLSBzdWNjZXNzIC8gZmFpbHVyZSBvZiB0aGUgdHJhbnNhY3Rpb24KICAgICAqLyAgICAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIAogICAgICAgIAogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSB2YWx1ZSAmJiB2YWx1ZSA+IDApIHsKCiAgICAgICAgICAgIC8vIGRvIGFjdHVhbCB0b2tlbnMgdHJhbnNmZXIgICAgICAgCiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IHZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1t0b10gICAgICAgICArPSB2YWx1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHJpc2UgdGhlIFRyYW5zZmVyIGV2ZW50CiAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7IAogICAgICAgIH0KICAgIH0KICAgIAogICAgCgogICAgCiAgICAvKioKICAgICAqIHRyYW5zZmVyRnJvbSgpIC0gdXNlZCB0byBtb3ZlIGFsbG93ZWQgZnVuZHMgZnJvbSBvdGhlciBvd25lcgogICAgICogICAgICAgICAgICAgICAgICBhY2NvdW50IAogICAgICoKICAgICAqICBAcGFyYW0gZnJvbSAgLSBtb3ZlIGZ1bmRzIGZyb20gYWNjb3VudAogICAgICogIEBwYXJhbSB0byAgICAtIG1vdmUgZnVuZHMgdG8gYWNjb3VudAogICAgICogIEBwYXJhbSB2YWx1ZSAtIG1vdmUgdGhlIHZhbHVlIAogICAgICoKICAgICAqICBAcmV0dXJuIC0gcmV0dXJuIHRydWUgb24gc3VjY2VzcyBmYWxzZSBvdGhlcndpc2UgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgCiAgICAgICAgaWYgKCBiYWxhbmNlc1tmcm9tXSA+PSB2YWx1ZSAmJiAKICAgICAgICAgICAgIGFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0gPj0gdmFsdWUgJiYgCiAgICAgICAgICAgICB2YWx1ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAKICAgICAgICAgICAgLy8gZG8gdGhlIGFjdHVhbCB0cmFuc2ZlcgogICAgICAgICAgICBiYWxhbmNlc1tmcm9tXSAtPSB2YWx1ZTsgICAgCiAgICAgICAgICAgIGJhbGFuY2VzW3RvXSAgICs9IHZhbHVlOyAgICAgICAgICAgIAogICAgICAgICAgICAKCiAgICAgICAgICAgIC8vIGFkZGp1c3QgdGhlIHBlcm1pc2lvbiwgYWZ0ZXIgcGFydCBvZiAKICAgICAgICAgICAgLy8gcGVybWl0ZWQgdG8gc3BlbmQgdmFsdWUgd2FzIHVzZWQKICAgICAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSAtPSB2YWx1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHJpc2UgdGhlIFRyYW5zZmVyIGV2ZW50CiAgICAgICAgICAgIFRyYW5zZmVyKGZyb20sIHRvLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAKICAgICAgICB9CiAgICB9CgogICAgCgogICAgCiAgICAvKioKICAgICAqCiAgICAgKiBiYWxhbmNlT2YoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIGNoZWNrIGNvbmNyZXRlIHRva2VucyBiYWxhbmNlICAKICAgICAqCiAgICAgKiAgQHBhcmFtIG93bmVyIC0gYWNjb3VudCBvd25lcgogICAgICogIAogICAgICogIEByZXR1cm4gdGhlIHZhbHVlIG9mIGJhbGFuY2UgCiAgICAgKi8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBvd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW293bmVyXTsKICAgIH0KCiAgICAKICAgIAogICAgLyoqCiAgICAgKgogICAgICogYXBwcm92ZSgpIC0gZnVuY3Rpb24gYXBwcm92ZXMgdG8gYSBwZXJzb24gdG8gc3BlbmQgc29tZSB0b2tlbnMgZnJvbSAKICAgICAqICAgICAgICAgICBvd25lciBiYWxhbmNlLiAKICAgICAqCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJzb24gd2hvbSB0aGlzIHJpZ2h0IGJlZW4gZ3JhbnRlZC4KICAgICAqICBAcGFyYW0gdmFsdWUgICAtIHZhbHVlIHRvIHNwZW5kLgogICAgICogCiAgICAgKiAgQHJldHVybiB0cnVlIGluIGNhc2Ugb2Ygc3VjY2VzLCBvdGhlcndpc2UgZmFpbHVyZQogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBub3cgc3BlbmRlciBjYW4gdXNlIGJhbGFuY2UgaW4gCiAgICAgICAgLy8gYW1tb3VudCBvZiB2YWx1ZSBmcm9tIG93bmVyIGJhbGFuY2UKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdmFsdWU7CiAgICAgICAgCiAgICAgICAgLy8gcmlzZSBldmVudCBhYm91dCB0aGUgdHJhbnNhY3Rpb24KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKCiAgICAvKioKICAgICAqCiAgICAgKiBhbGxvd2FuY2UoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIHRvIGNoZWNrIGhvdyBtb3VjaCBpcyAKICAgICAqICAgICAgICAgICAgICAgcGVybWl0ZWQgdG8gc3BlbmQgdG8gM3JkIHBlcnNvbiBmcm9tIG93bmVyIGJhbGFuY2UKICAgICAqCiAgICAgKiAgQHBhcmFtIG93bmVyICAgLSBvd25lciBvZiB0aGUgYmFsYW5jZQogICAgICogIEBwYXJhbSBzcGVuZGVyIC0gcGVybWl0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uIAogICAgICogIAogICAgICogIEByZXR1cm4gLSByZW1haW5pbmcgcmlnaHQgdG8gc3BlbmQgCiAgICAgKiAKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgcmV0dXJuIGFsbG93ZWRbb3duZXJdW3NwZW5kZXJdOwogICAgfQoKfQoKCi8qKgogKgogKiBAdGl0bGUgSGFja2VyIEdvbGQKICogCiAqIFRoZSBvZmZpY2lhbCB0b2tlbiBwb3dlcmluZyB0aGUgaGFjay5ldGhlci5jYW1wIHZpcnR1YWwgYWNjZWxlcmF0b3IuCiAqIFRoaXMgaXMgdGhlIG9ubHkgd2F5IHRvIGFjcXVpcmUgdG9rZW5zIGZyb20gc3RhcnR1cHMgZHVyaW5nIHRoZSBldmVudC4KICoKICogV2hpdGVwYXBlciBodHRwczovL2hhY2suZXRoZXIuY2FtcC93aGl0ZXBhcGVyCiAqCiAqLwpjb250cmFjdCBIYWNrZXJHb2xkIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIC8vIE5hbWUgb2YgdGhlIHRva2VuICAgIAogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIkhhY2tlckdvbGQiOwoKICAgIC8vIERlY2ltYWwgcGxhY2VzCiAgICB1aW50OCAgcHVibGljIGRlY2ltYWxzID0gMzsKICAgIC8vIFRva2VuIGFiYnJldmlhdGlvbiAgICAgICAgCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJIS0ciOwogICAgCiAgICAvLyAxIGV0aGVyID0gMjAwIGhrZwogICAgdWludCBCQVNFX1BSSUNFID0gMjAwOwogICAgLy8gMSBldGhlciA9IDE1MCBoa2cKICAgIHVpbnQgTUlEX1BSSUNFID0gMTUwOwogICAgLy8gMSBldGhlciA9IDEwMCBoa2cKICAgIHVpbnQgRklOX1BSSUNFID0gMTAwOwogICAgLy8gU2FmZXR5IGNhcAogICAgdWludCBTQUZFVFlfTElNSVQgPSA0MDAwMDAwIGV0aGVyOwogICAgLy8gWmVyb3MgYWZ0ZXIgdGhlIHBvaW50CiAgICB1aW50IERFQ0lNQUxfWkVST1MgPSAxMDAwOwogICAgCiAgICAvLyBUb3RhbCB2YWx1ZSBpbiB3ZWkKICAgIHVpbnQgdG90YWxWYWx1ZTsKICAgIAogICAgLy8gQWRkcmVzcyBvZiBtdWx0aXNpZyB3YWxsZXQgaG9sZGluZyBldGhlciBmcm9tIHNhbGUKICAgIGFkZHJlc3Mgd2FsbGV0OwoKICAgIC8vIFN0cnVjdHVyZSBvZiBzYWxlIGluY3JlYXNlIG1pbGVzdG9uZXMKICAgIHN0cnVjdCBtaWxlc3RvbmVzX3N0cnVjdCB7CiAgICAgIHVpbnQgcDE7CiAgICAgIHVpbnQgcDI7IAogICAgICB1aW50IHAzOwogICAgICB1aW50IHA0OwogICAgICB1aW50IHA1OwogICAgICB1aW50IHA2OwogICAgfQogICAgLy8gTWlsZXN0b25lcyBpbnN0YW5jZQogICAgbWlsZXN0b25lc19zdHJ1Y3QgbWlsZXN0b25lczsKICAgIAogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvciBvZiB0aGUgY29udHJhY3QuCiAgICAgKiAKICAgICAqIFBhc3NlcyBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGhvbGRpbmcgdGhlIHZhbHVlLgogICAgICogSGFja2VyR29sZCBjb250cmFjdCBpdHNlbGYgZG9lcyBub3QgaG9sZCBhbnkgdmFsdWUKICAgICAqIAogICAgICogQHBhcmFtIG11bHRpc2lnIGFkZHJlc3Mgb2YgTXVsdGlTaWcgd2FsbGV0IHdoaWNoIHdpbGwgaG9sZCB0aGUgdmFsdWUKICAgICAqLwogICAgZnVuY3Rpb24gSGFja2VyR29sZChhZGRyZXNzIG11bHRpc2lnKSB7CiAgICAgICAgCiAgICAgICAgd2FsbGV0ID0gbXVsdGlzaWc7CgogICAgICAgIC8vIHNldCB0aW1lIHBlcmlvZHMgZm9yIHNhbGUKICAgICAgICBtaWxlc3RvbmVzID0gbWlsZXN0b25lc19zdHJ1Y3QoCiAgICAgICAgCiAgICAgICAgICAxNDc2OTcyMDAwLCAgLy8gUDE6IEdNVDogMjAtT2N0LTIwMTYgMTQ6MDAgID0+IFRoZSBTYWxlIFN0YXJ0cwogICAgICAgICAgMTQ3ODE4MTYwMCwgIC8vIFAyOiBHTVQ6IDAzLU5vdi0yMDE2IDE0OjAwICA9PiAxc3QgUHJpY2UgTGFkZGVyIAogICAgICAgICAgMTQ3OTM5MTIwMCwgIC8vIFAzOiBHTVQ6IDE3LU5vdi0yMDE2IDE0OjAwICA9PiBQcmljZSBTdGFibGUsIAogICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYWNrYXRob24gU3RhcnRzCiAgICAgICAgICAxNDgwNjAwODAwLCAgLy8gUDQ6IEdNVDogMDEtRGVjLTIwMTYgMTQ6MDAgID0+IDJuZCBQcmljZSBMYWRkZXIKICAgICAgICAgIDE0ODE4MTA0MDAsICAvLyBQNTogR01UOiAxNS1EZWMtMjAxNiAxNDowMCAgPT4gUHJpY2UgU3RhYmxlCiAgICAgICAgICAxNDgyNDE1MjAwICAgLy8gUDY6IEdNVDogMjItRGVjLTIwMTYgMTQ6MDAgID0+IFNhbGUgRW5kcywgSGFja2F0aG9uIEVuZHMKICAgICAgICApOwogICAgICAgIAogICAgICAgIC8vIGFzc2lnbiByZWNvdmVyeSBiYWxhbmNlCiAgICAgICAgdG90YWxTdXBwbHlWYXIgICA9IDE2MTEwODkzMDAwOwogICAgICAgIGJhbGFuY2VzWzB4MzQyZTYyNzMyYjc2ODc1ZGE5MzA1MDgzZWE4YWU2MzEyNWE0ZTY2N10gPSAxNjExMDg5MzAwMDsKICAgICAgICB0b3RhbFZhbHVlICAgID0gODUzNjIgZXRoZXI7ICAgICAgICAKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIEZhbGxiYWNrIGZ1bmN0aW9uOiBjYWxsZWQgb24gZXRoZXIgc2VudC4KICAgICAqIAogICAgICogSXQgY2FsbHMgdG8gY3JlYXRlSEtHIGZ1bmN0aW9uIHdpdGggbXNnLnNlbmRlciAKICAgICAqIGFzIGEgdmFsdWUgZm9yIGhvbGRlciBhcmd1bWVudAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICBjcmVhdGVIS0cobXNnLnNlbmRlcik7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRlcyBIS0cgdG9rZW5zLgogICAgICogCiAgICAgKiBSdW5zIHNhbml0eSBjaGVja3MgaW5jbHVkaW5nIHNhZmV0eSBjYXAKICAgICAqIFRoZW4gY2FsY3VsYXRlcyBjdXJyZW50IHByaWNlIGJ5IGdldFByaWNlKCkgZnVuY3Rpb24sIGNyZWF0ZXMgSEtHIHRva2VucwogICAgICogRmluYWxseSBzZW5kcyBhIHZhbHVlIG9mIHRyYW5zYWN0aW9uIHRvIHRoZSB3YWxsZXQKICAgICAqIAogICAgICogTm90ZTogZHVlIHRvIGxhY2sgb2YgZmxvYXRpbmcgcG9pbnQgdHlwZXMgaW4gU29saWRpdHksCiAgICAgKiBjb250cmFjdCBhc3N1bWVzIHRoYXQgbGFzdCAzIGRpZ2l0cyBpbiB0b2tlbnMgYW1vdW50IGFyZSBzdG9vZCBhZnRlciB0aGUgcG9pbnQuCiAgICAgKiBJdCBtZWFucyB0aGF0IGlmIHN0b3JlZCBIS0cgYmFsYW5jZSBpcyAxMDAwMDAsIHRoZW4gaXRzIHJlYWwgdmFsdWUgaXMgMTAwIEhLRwogICAgICogCiAgICAgKiBAcGFyYW0gaG9sZGVyIHRva2VuIGhvbGRlcgogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVIS0coYWRkcmVzcyBob2xkZXIpIHBheWFibGUgewogICAgICAgIAogICAgICAgIGlmIChub3cgPCBtaWxlc3RvbmVzLnAxKSB0aHJvdzsKICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDYpIHRocm93OwogICAgICAgIGlmIChtc2cudmFsdWUgPT0gMCkgdGhyb3c7CiAgICAKICAgICAgICAvLyBzYWZldHkgY2FwCiAgICAgICAgaWYgKGdldFRvdGFsVmFsdWUoKSArIG1zZy52YWx1ZSA+IFNBRkVUWV9MSU1JVCkgdGhyb3c7IAogICAgCiAgICAgICAgdWludCB0b2tlbnMgPSBtc2cudmFsdWUgKiBnZXRQcmljZSgpICogREVDSU1BTF9aRVJPUyAvIDEgZXRoZXI7CgogICAgICAgIHRvdGFsU3VwcGx5VmFyICs9IHRva2VuczsKICAgICAgICBiYWxhbmNlc1tob2xkZXJdICs9IHRva2VuczsKICAgICAgICB0b3RhbFZhbHVlICs9IG1zZy52YWx1ZTsKICAgICAgICAKICAgICAgICBpZiAoIXdhbGxldC5zZW5kKG1zZy52YWx1ZSkpIHRocm93OwogICAgfQogICAgCiAgICAvKioKICAgICAqIERlbm90ZXMgY29tcGxldGUgcHJpY2Ugc3RydWN0dXJlIGR1cmluZyB0aGUgc2FsZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIEhLRyBhbW91bnQgcGVyIDEgRVRIIGZvciB0aGUgY3VycmVudCBtb21lbnQgaW4gdGltZQogICAgICovCiAgICBmdW5jdGlvbiBnZXRQcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA8IG1pbGVzdG9uZXMucDEpIHJldHVybiAwOwogICAgICAgIAogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wMSAmJiBub3cgPCBtaWxlc3RvbmVzLnAyKSB7CiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBCQVNFX1BSSUNFOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDIgJiYgbm93IDwgbWlsZXN0b25lcy5wMykgewogICAgICAgICAgICAKICAgICAgICAgICAgdWludCBkYXlzX2luID0gMSArIChub3cgLSBtaWxlc3RvbmVzLnAyKSAvIDEgZGF5czsgCiAgICAgICAgICAgIHJldHVybiBCQVNFX1BSSUNFIC0gZGF5c19pbiAqIDI1IC8gNzsgIC8vIGRhaWx5IGRlY3JlYXNlIDMuNQogICAgICAgIH0KCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnAzICYmIG5vdyA8IG1pbGVzdG9uZXMucDQpIHsKICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIE1JRF9QUklDRTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnA0ICYmIG5vdyA8IG1pbGVzdG9uZXMucDUpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIGRheXNfaW4gPSAxICsgKG5vdyAtIG1pbGVzdG9uZXMucDQpIC8gMSBkYXlzOyAKICAgICAgICAgICAgcmV0dXJuIE1JRF9QUklDRSAtIGRheXNfaW4gKiAyNSAvIDc7ICAvLyBkYWlseSBkZWNyZWFzZSAzLjUKICAgICAgICB9CgogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wNSAmJiBub3cgPCBtaWxlc3RvbmVzLnA2KSB7CiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBGSU5fUFJJQ0U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wNil7CgogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRvdGFsIHN0b3JlZCBIS0cgYW1vdW50LgogICAgICogCiAgICAgKiBDb250cmFjdCBhc3N1bWVzIHRoYXQgbGFzdCAzIGRpZ2l0cyBvZiB0aGlzIHZhbHVlIGFyZSBiZWhpbmQgdGhlIGRlY2ltYWwgcGxhY2UuIGkuZS4gMTAwMDEgaXMgMTAuMDAxCiAgICAgKiBUaHVzLCByZXN1bHQgb2YgdGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgZGl2aWRlZCBieSAxMDAwIHRvIGdldCBIS0cgdmFsdWUKICAgICAqIAogICAgICogQHJldHVybiByZXN1bHQgc3RvcmVkIEhLRyBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseVZhcjsKICAgIH0gCgogICAgLyoqCiAgICAgKiBJdCBpcyB1c2VkIGZvciB0ZXN0IHB1cnBvc2VzLgogICAgICogCiAgICAgKiBSZXR1cm5zIHRoZSByZXN1bHQgb2YgJ25vdycgc3RhdGVtZW50IG9mIFNvbGlkaXR5IGxhbmd1YWdlCiAgICAgKiAKICAgICAqIEByZXR1cm4gdW5peCB0aW1lc3RhbXAgZm9yIGN1cnJlbnQgbW9tZW50IGluIHRpbWUKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Tm93KCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0b3RhbCB2YWx1ZSBwYXNzZWQgdGhyb3VnaCB0aGUgY29udHJhY3QKICAgICAqIAogICAgICogQHJldHVybiByZXN1bHQgdG90YWwgdmFsdWUgaW4gd2VpCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRvdGFsVmFsdWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIHJldHVybiB0b3RhbFZhbHVlOyAgCiAgICB9Cn0KCgovKioKICogCiAqIEV2ZW50SW5mbyAtIGltdXRhYmxlIGNsYXNzIHRoYXQgZGVub3RlcwogKiB0aGUgdGltZSBvZiB0aGUgdmlydHVhbCBhY2NlbGVyYXRvciBoYWNrCiAqIGV2ZW50CiAqIAogKi8KY29udHJhY3QgRXZlbnRJbmZvewogICAgCiAgICAKICAgIHVpbnQgY29uc3RhbnQgSEFDS0FUSE9OXzVfV0VFS1MgPSA2MCAqIDYwICogMjQgKiA3ICogNTsKICAgIHVpbnQgY29uc3RhbnQgVF8xX1dFRUsgPSA2MCAqIDYwICogMjQgKiA3OwoKICAgIHVpbnQgZXZlbnRTdGFydCA9IDE0NzkzOTEyMDA7IC8vIFRodSwgMTcgTm92IDIwMTYgMTQ6MDA6MDAgR01UCiAgICB1aW50IGV2ZW50RW5kID0gZXZlbnRTdGFydCArIEhBQ0tBVEhPTl81X1dFRUtTOwogICAgCiAgICAKICAgIC8qKgogICAgICogZ2V0RXZlbnRTdGFydCAtIHJldHVybiB0aGUgc3RhcnQgb2YgdGhlIGV2ZW50IHRpbWUKICAgICAqLyAKICAgIGZ1bmN0aW9uIGdldEV2ZW50U3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICAKICAgICAgIHJldHVybiBldmVudFN0YXJ0OwogICAgfSAKICAgIAogICAgLyoqCiAgICAgKiBnZXRFdmVudEVuZCAtIHJldHVybiB0aGUgZW5kIG9mIHRoZSBldmVudCB0aW1lCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRFdmVudEVuZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsgICAgICAgIAogICAgICAgcmV0dXJuIGV2ZW50RW5kOwogICAgfSAKICAgIAogICAgCiAgICAvKioKICAgICAqIGdldFZvdGluZ1N0YXJ0IC0gdGhlIHZvdGluZyBzdGFydHMgMSB3ZWVrIGFmdGVyIHRoZSAKICAgICAqICAgICAgICAgICAgICAgICAgZXZlbnQgc3RhcnRzCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRWb3RpbmdTdGFydCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gZXZlbnRTdGFydCsgVF8xX1dFRUs7CiAgICB9CgogICAgLyoqCiAgICAgKiBnZXRUcmFkaW5nU3RhcnQgLSB0aGUgRFNUIHRva2VucyB0cmFkaW5nIHN0YXJ0cyAxIHdlZWsgCiAgICAgKiAgICAgICAgICAgICAgICAgICBhZnRlciB0aGUgZXZlbnQgc3RhcnRzCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRUcmFkaW5nU3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGV2ZW50U3RhcnQrIFRfMV9XRUVLOwogICAgfQoKICAgIC8qKgogICAgICogZ2V0Tm93IC0gaGVscGVyIGNsYXNzIHRvIGNoZWNrIHdoYXQgdGltZSB0aGUgY29udHJhY3Qgc2VlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE5vdygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsgICAgICAgIAogICAgICAgcmV0dXJuIG5vdzsKICAgIH0gCiAgICAKfQoKCi8qCiAqIERTVENvbnRyYWN0IC0gRFNUIHN0YW5kcyBmb3IgZGVjZW50cmFsaXplZCBzdGFydHVwIHRlYW0uCiAqICAgICAgICAgICAgICAgdGhlIGNvbnRyYWN0IGVuc3VyZXMgZnVuZGluZyBmb3IgYSBkZWNlbnRyYWxpemVkCiAqICAgICAgICAgICAgICAgdGVhbSBpbiAyIHBoYXNlczogCiAqCiAqICAgICAgICAgICAgICAgICsuIEZ1bmRpbmcgYnkgSEtHIGR1cmluZyB0aGUgaGFja2F0aG9uIGV2ZW50LiAKICogICAgICAgICAgICAgICAgKy4gRnVuZGluZyBieSBFdGhlciBhZnRlciB0aGUgZXZlbnQgaXMgb3Zlci4gCiAqCiAqICAgICAgICAgICAgICAgQWZ0ZXIgdGhlIGZ1bmRzIGJlZW4gY29sbGVjdGVkIHRoZXJlIGlzIGEgZ292ZXJuZW5jZQogKiAgICAgICAgICAgICAgIG1lY2hhbmlzbSBtYW5hZ2VkIGJ5IHByb3Bvc2l0aW9uIHRvIHdpdGhkcmF3IGZ1bmRzCiAqICAgICAgICAgICAgICAgZm9yIGRldmVsb3BtZW50IHVzYWdlLiAKICoKICogICAgICAgICAgICAgICBUaGUgRFNUIGVuc3VyZXMgdGhhdCBiYWNrZXJzIG9mIHRoZSBwcm9qZWN0cyBrZWVwcwogKiAgICAgICAgICAgICAgIHNvbWUgaW5mbHVlbmNlIG9uIHRoZSBwcm9qZWN0IGJ5IGFiaWxpdHkgdG8gcmVqZWN0CiAqICAgICAgICAgICAgICAgcHJvcG9zaXRpb25zIHRoZXkgZmluZCBhcyBub24gZWZmZWN0aXZlLiAKICoKICogICAgICAgICAgICAgICBJbiB2ZXJ5IHJhZGljYWwgb2NjYXNpb25zIHRoZSBiYWNrZXJzIG1heSBsb29zZSAKICogICAgICAgICAgICAgICB0aGUgdHJ1c3QgaW4gdGhlIHRlYW0gY29tcGxldGVsbHksIGluIHRoYXQgY2FzZSAKICogICAgICAgICAgICAgICB0aGVyZSBpcyBhbiBvcHRpb24gdG8gcHJvcG9zZSBpbXBlYWNobWVudCBwcm9jZXNzCiAqICAgICAgICAgICAgICAgY29tcGxldGVsbHkgcmVtb3ZpbmcgdGhlIGV4ZWN1dGUgYW5kIGFzc2lnbmluZyBuZXcKICogICAgICAgICAgICAgICBwZXJzb24gdG8gbWFuYWdlIHRoZSBmdW5kcy4gCiAqCiAqLwpjb250cmFjdCBEU1RDb250cmFjdCBpcyBTdGFuZGFyZFRva2VuewoKICAgIC8vIFplcm9zIGFmdGVyIHRoZSBwb2ludAogICAgdWludCBERUNJTUFMX1pFUk9TID0gMTAwMDsKICAgIC8vIFByb3Bvc2FsIGxpZmV0aW1lCiAgICB1aW50IFBST1BPU0FMX0xJRkVUSU1FID0gMTAgZGF5czsKICAgIC8vIFByb3Bvc2FsIGZ1bmRzIHRocmVzaG9sZCwgaW4gcGVyY2VudHMKICAgIHVpbnQgUFJPUE9TQUxfRlVORFNfVEggPSAyMDsKCiAgICBhZGRyZXNzICAgZXhlY3V0aXZlOyAKICAgICAgICAKICAgIEV2ZW50SW5mbyBldmVudEluZm87CiAgICAKICAgIC8vIEluZGljYXRlZCB3aGVyZSB0aGUgRFNUIGlzIHRyYWRlZAogICAgYWRkcmVzcyB2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzOwogICAgCiAgICBIYWNrZXJHb2xkIGhhY2tlckdvbGQ7CiAgICAgICAgCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHZvdGluZ1JpZ2h0czsKCgogICAgLy8gMSAtIEhLRyA9PiBEU1QgcXR5OyB0b2tlbnMgZm9yIDEgSEtHCiAgICB1aW50IGhrZ1ByaWNlOwogICAgCiAgICAvLyAxIC0gRXRoZXIgPT4gRFNUIHF0eTsgdG9rZW5zIGZvciAxIEV0aGVyCiAgICB1aW50IGV0aGVyUHJpY2U7CiAgICAKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICIuLi4iOyAgICAgICAgICAgICAgICAgICAKICAgIHVpbnQ4ICBwdWJsaWMgZGVjaW1hbHMgPSAzOyAgICAgICAgICAgICAgICAgCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICIuLi4iOwogICAgCiAgICBib29sIGFibGVUb0lzc3VlVG9rZW5zID0gdHJ1ZTsgCiAgICAKICAgIHVpbnQgcHJlZmVyZWRRdHlTb2xkOwoKICAgIHVpbnQgY29sbGVjdGVkSEtHOyAKICAgIHVpbnQgY29sbGVjdGVkRXRoZXI7ICAgIAogICAgCiAgICAvLyBQcm9wb3NhbCBvZiB0aGUgZnVuZHMgc3BlbmRpbmcKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gUHJvcG9zYWwpIHByb3Bvc2FsczsKCiAgICBlbnVtIFByb3Bvc2FsQ3VycmVuY3kgeyBIS0csIEVUSEVSIH0KICAgIFByb3Bvc2FsQ3VycmVuY3kgZW51bURlY2xhcmF0aW9uOwogICAgICAgICAgICAgICAgICAKICAgICAgIAogICAgc3RydWN0IFByb3Bvc2FsewogICAgICAgIAogICAgICAgIGJ5dGVzMzIgaWQ7CiAgICAgICAgdWludCB2YWx1ZTsKCiAgICAgICAgc3RyaW5nIHVybERldGFpbHM7CgogICAgICAgIHVpbnQgdm90aW5kRW5kVFM7CiAgICAgICAgICAgICAgICAKICAgICAgICB1aW50IHZvdGVzT2JqZWN0aW5nOwogICAgICAgIAogICAgICAgIGFkZHJlc3Mgc3VibWl0dGVyOwogICAgICAgIGJvb2wgcmVkZWVtZWQ7CgogICAgICAgIFByb3Bvc2FsQ3VycmVuY3kgcHJvcG9zYWxDdXJyZW5jeTsKICAgICAgICAKICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHZvdGVkOwogICAgfQogICAgdWludCBjb3VudGVyUHJvcG9zYWxzOwogICAgdWludCB0aW1lT2ZMYXN0UHJvcG9zYWw7CiAgICAKICAgIFByb3Bvc2FsW10gbGlzdFByb3Bvc2FsczsKICAgIAoKICAgIC8qKgogICAgICogSW1wZWFjaG1lbnQgcHJvY2VzcyBwcm9wb3NhbHMKICAgICAqLyAgICAKICAgIHN0cnVjdCBJbXBlYWNobWVudFByb3Bvc2FsewogICAgICAgIAogICAgICAgIHN0cmluZyB1cmxEZXRhaWxzOwogICAgICAgIAogICAgICAgIGFkZHJlc3MgbmV3RXhlY3V0aXZlOwoKICAgICAgICB1aW50IHZvdGluZEVuZFRTOyAgICAgICAgCiAgICAgICAgdWludCB2b3Rlc1N1cHBvcnRpbmc7CiAgICAgICAgCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSB2b3RlZDsgICAgICAgIAogICAgfQogICAgSW1wZWFjaG1lbnRQcm9wb3NhbCBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbDsKCiAgICAgICAgCiAgICAvKioKICAgICAqIAogICAgICogIERTVENvbnRyYWN0OiBjdG9yIGZvciBEU1QgdG9rZW4gYW5kIGdvdmVybmVuY2UgY29udHJhY3QKICAgICAqCiAgICAgKiAgQHBhcmFtIGV2ZW50SW5mb0FkZHIgRXZlbnRJbmZvOiBhZGRyZXNzIG9mIG9iamVjdCBkZW5vdGVzIGV2ZW50cyAKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbGVzdG9uZXMgICAgICAKICAgICAqICBAcGFyYW0gaGFja2VyR29sZEFkZHIgSGFja2VyR29sZDogYWRkcmVzcyBvZiBIYWNrZXJHb2xkIHRva2VuCiAgICAgKgogICAgICogIEBwYXJhbSBkc3ROYW1lIHN0cmluZzogZHN0TmFtZTogcmVhbCBuYW1lIG9mIHRoZSB0ZWFtCiAgICAgKgogICAgICogIEBwYXJhbSBkc3RTeW1ib2wgc3RyaW5nOiAzIGxldHRlciBzeW1ib2xkIG9mIHRoZSB0ZWFtCiAgICAgKgogICAgICovIAogICAgZnVuY3Rpb24gRFNUQ29udHJhY3QoRXZlbnRJbmZvIGV2ZW50SW5mb0FkZHIsIEhhY2tlckdvbGQgaGFja2VyR29sZEFkZHIsIHN0cmluZyBkc3ROYW1lLCBzdHJpbmcgZHN0U3ltYm9sKXsKICAgIAogICAgICBleGVjdXRpdmUgICA9IG1zZy5zZW5kZXI7ICAKICAgICAgbmFtZSAgICAgICAgPSBkc3ROYW1lOwogICAgICBzeW1ib2wgICAgICA9IGRzdFN5bWJvbDsKCiAgICAgIGhhY2tlckdvbGQgPSBIYWNrZXJHb2xkKGhhY2tlckdvbGRBZGRyKTsKICAgICAgZXZlbnRJbmZvICA9IEV2ZW50SW5mbyhldmVudEluZm9BZGRyKTsKICAgIH0KICAgIAoKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZQogICAgICAgICAgICAgICBvbmx5QWZ0ZXJFbmQgewogICAgICAgIAogICAgICAgIC8vIHRoZXJlIGlzIHRva2VucyBsZWZ0IGZyb20gaGFja2F0aG9uIAogICAgICAgIGlmIChldGhlclByaWNlID09IDApIHRocm93OwogICAgICAgIAogICAgICAgIHVpbnQgdG9rZW5zID0gbXNnLnZhbHVlICogZXRoZXJQcmljZSAqIERFQ0lNQUxfWkVST1MgLyAoMSBldGhlcik7CiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgaWYgZGVtYW5kIG9mIHRva2VucyBpcyAKICAgICAgICAvLyBvdmVyZmxvdyB0aGUgc3VwcGx5IAogICAgICAgIHVpbnQgcmV0RXRoZXIgPSAwOwogICAgICAgIGlmIChiYWxhbmNlc1t0aGlzXSA8IHRva2VucykgewogICAgICAgICAgICAKICAgICAgICAgICAgdG9rZW5zID0gYmFsYW5jZXNbdGhpc107CiAgICAgICAgICAgIHJldEV0aGVyID0gbXNnLnZhbHVlIC0gdG9rZW5zIC8gZXRoZXJQcmljZSAqICgxIGZpbm5leSk7CiAgICAgICAgCiAgICAgICAgICAgIC8vIHJldHVybiBsZWZ0IGV0aGVyIAogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChyZXRFdGhlcikpIHRocm93OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBkbyB0cmFuc2ZlcgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IHRva2VuczsKICAgICAgICBiYWxhbmNlc1t0aGlzXSAtPSB0b2tlbnM7CiAgICAgICAgCiAgICAgICAgLy8gY291bnQgY29sbGVjdGVkIGV0aGVyIAogICAgICAgIGNvbGxlY3RlZEV0aGVyICs9IG1zZy52YWx1ZSAtIHJldEV0aGVyOyAKICAgICAgICAKICAgICAgICAvLyByaXNlIGV2ZW50CiAgICAgICAgQnV5Rm9yRXRoZXJUcmFuc2FjdGlvbihtc2cuc2VuZGVyLCBjb2xsZWN0ZWRFdGhlciwgdG90YWxTdXBwbHlWYXIsIGV0aGVyUHJpY2UsIHRva2Vucyk7CiAgICAgICAgCiAgICB9CgogICAgCiAgICAKICAgIC8qKgogICAgICogc2V0SEtHUHJpY2UgLSBzZXQgcHJpY2U6IDFIS0cgPT4gRFNUIHRva2VucyBxdHkKICAgICAqCiAgICAgKiAgQHBhcmFtIHF0eUZvck9uZUhLRyB1aW50OiBEU1QgdG9rZW5zIGZvciAxIEhLRwogICAgICogCiAgICAgKi8gICAgCiAgICAgZnVuY3Rpb24gc2V0SEtHUHJpY2UodWludCBxdHlGb3JPbmVIS0cpIG9ubHlFeGVjdXRpdmUgIHsKICAgICAgICAgCiAgICAgICAgIGhrZ1ByaWNlID0gcXR5Rm9yT25lSEtHOwogICAgICAgICBQcmljZUhLR0NoYW5nZShxdHlGb3JPbmVIS0csIHByZWZlcmVkUXR5U29sZCwgdG90YWxTdXBwbHlWYXIpOwogICAgIH0KICAgICAKICAgICAKICAgIAogICAgLyoqCiAgICAgKiAKICAgICAqIGlzc3VlUHJlZmVyZWRUb2tlbnMgLSBwcmVmZXJlZCB0b2tlbnMgaXNzdWVkIG9uIHRoZSBoYWNrYXRob24gZXZlbnQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICBncmFudCBzcGVjaWFsIHJpZ2h0cwogICAgICoKICAgICAqICBAcGFyYW0gcXR5Rm9yT25lSEtHIHVpbnQ6IHByaWNlIERTVCB0b2tlbnMgZm9yIG9uZSAxIEhLRwogICAgICogIEBwYXJhbSBxdHlUb0VtaXQgdWludDogbmV3IHN1cHBseSBvZiB0b2tlbnMgCiAgICAgKiAKICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWVQcmVmZXJlZFRva2Vucyh1aW50IHF0eUZvck9uZUhLRywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgcXR5VG9FbWl0KSBvbmx5RXhlY3V0aXZlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUlmQWJsZVRvSXNzdWVUb2tlbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlCZWZvcmVFbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlBZnRlclRyYWRpbmdTdGFydCB7CiAgICAgICAgICAgICAgICAKICAgICAgICAvLyBubyBpc3N1ZW5jZSBpcyBhbGxvd2VkIGJlZm9yZSBlbmxpc3RlZCBvbiB0aGUKICAgICAgICAvLyBleGNoYW5nZSAKICAgICAgICBpZiAodmlydHVhbEV4Y2hhbmdlQWRkcmVzcyA9PSAweDApIHRocm93OwogICAgICAgICAgICAKICAgICAgICB0b3RhbFN1cHBseVZhciArPSBxdHlUb0VtaXQ7CiAgICAgICAgYmFsYW5jZXNbdGhpc10gKz0gcXR5VG9FbWl0OwogICAgICAgIGhrZ1ByaWNlID0gcXR5Rm9yT25lSEtHOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vIG5vdyBzcGVuZGVyIGNhbiB1c2UgYmFsYW5jZSBpbiAKICAgICAgICAvLyBhbW91bnQgb2YgdmFsdWUgZnJvbSBvd25lciBiYWxhbmNlCiAgICAgICAgYWxsb3dlZFt0aGlzXVt2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzXSArPSBxdHlUb0VtaXQ7CiAgICAgICAgCiAgICAgICAgLy8gcmlzZSBldmVudCBhYm91dCB0aGUgdHJhbnNhY3Rpb24KICAgICAgICBBcHByb3ZhbCh0aGlzLCB2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzLCBxdHlUb0VtaXQpOwogICAgICAgIAogICAgICAgIC8vIHJpc2UgZXZlbnQgCiAgICAgICAgRHN0VG9rZW5zSXNzdWVkKGhrZ1ByaWNlLCBwcmVmZXJlZFF0eVNvbGQsIHRvdGFsU3VwcGx5VmFyLCBxdHlUb0VtaXQpOwogICAgfQoKICAgIAogICAgCiAgICAKICAgIC8qKgogICAgICogCiAgICAgKiBidXlGb3JIYWNrZXJHb2xkIC0gb24gdGhlIGhhY2sgZXZlbnQgdGhpcyBmdW5jdGlvbiBpcyBhdmFpbGFibGUgCiAgICAgKiAgICAgICAgICAgICAgICAgICAgdGhlIGJ1eWVyIGZvciBoYWNrZXIgZ29sZCB3aWxsIGdhaW4gdm90ZXMgdG8gCiAgICAgKiAgICAgICAgICAgICAgICAgICAgaW5mbHVlbmNlIGZ1dHVyZSBwcm9wb3NhbHMgb24gdGhlIERTVAogICAgICogICAgCiAgICAgKiAgQHBhcmFtIGhrZ1ZhbHVlIC0gcXR5IG9mIHRoaXMgRFNUIHRva2VucyBmb3IgMSBIS0cgICAgIAogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1eUZvckhhY2tlckdvbGQodWludCBoa2dWYWx1ZSkgb25seUJlZm9yZUVuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAKICAgICAgLy8gdmFsaWRhdGUgdGhhdCB0aGUgY2FsbGVyIGlzIG9mZmljaWFsIGFjY2VsZXJhdG9yIEhLRyBFeGNoYW5nZQogICAgICBpZiAobXNnLnNlbmRlciAhPSB2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzKSB0aHJvdzsKICAgICAgCiAgICAgIAogICAgICAvLyB0cmFuc2ZlciB0b2tlbiAKICAgICAgYWRkcmVzcyBzZW5kZXIgPSB0eC5vcmlnaW47CiAgICAgIHVpbnQgdG9rZW5zUXR5ID0gaGtnVmFsdWUgKiBoa2dQcmljZTsKCiAgICAgIC8vIGdhaW4gdm90aW5nIHJpZ2h0cwogICAgICB2b3RpbmdSaWdodHNbc2VuZGVyXSArPXRva2Vuc1F0eTsKICAgICAgcHJlZmVyZWRRdHlTb2xkICs9IHRva2Vuc1F0eTsKICAgICAgY29sbGVjdGVkSEtHICs9IGhrZ1ZhbHVlOwoKICAgICAgLy8gZG8gYWN0dWFsIHRyYW5zZmVyCiAgICAgIHRyYW5zZmVyRnJvbSh0aGlzLCAKICAgICAgICAgICAgICAgICAgIHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MsIHRva2Vuc1F0eSk7CiAgICAgIHRyYW5zZmVyKHNlbmRlciwgdG9rZW5zUXR5KTsgICAgICAgIAogICAgICAgICAgICAKICAgICAgLy8gcmlzZSBldmVudCAgICAgICAKICAgICAgQnV5Rm9ySEtHVHJhbnNhY3Rpb24oc2VuZGVyLCBwcmVmZXJlZFF0eVNvbGQsIHRvdGFsU3VwcGx5VmFyLCBoa2dQcmljZSwgdG9rZW5zUXR5KTsKICAgICAgICAKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAgICAgCiAgICAKICAgIC8qKgogICAgICogCiAgICAgKiBpc3N1ZVRva2VucyAtIGZ1bmN0aW9uIHdpbGwgaXNzdWUgdG9rZW5zIGFmdGVyIHRoZSAKICAgICAqICAgICAgICAgICAgICAgZXZlbnQsIGFibGUgdG8gc2VsbCBmb3IgMSBldGhlciAKICAgICAqIAogICAgICogIEBwYXJhbSBxdHlGb3JPbmVFdGhlciB1aW50OiBEU1QgdG9rZW5zIGZvciAxIEVUSAogICAgICogIEBwYXJhbSBxdHlUb0VtaXQgdWludDogbmV3IHRva2VucyBzdXBwbHkKICAgICAqCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzc3VlVG9rZW5zKHVpbnQgcXR5Rm9yT25lRXRoZXIsIAogICAgICAgICAgICAgICAgICAgICAgICAgdWludCBxdHlUb0VtaXQpIG9ubHlBZnRlckVuZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5RXhlY3V0aXZlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUlmQWJsZVRvSXNzdWVUb2tlbnMgewogICAgICAgICAKICAgICAgICAgYmFsYW5jZXNbdGhpc10gKz0gcXR5VG9FbWl0OwogICAgICAgICBldGhlclByaWNlID0gcXR5Rm9yT25lRXRoZXI7CiAgICAgICAgIHRvdGFsU3VwcGx5VmFyICAgICs9IHF0eVRvRW1pdDsKICAgICAgICAgCiAgICAgICAgIC8vIHJpc2UgZXZlbnQgIAogICAgICAgICBEc3RUb2tlbnNJc3N1ZWQocXR5Rm9yT25lRXRoZXIsIHRvdGFsU3VwcGx5VmFyLCB0b3RhbFN1cHBseVZhciwgcXR5VG9FbWl0KTsKICAgIH0KICAgICAKICAgIAogICAgLyoqCiAgICAgKiBzZXRFdGhlclByaWNlIC0gY2hhbmdlIHRoZSB0b2tlbiBwcmljZQogICAgICoKICAgICAqICBAcGFyYW0gcXR5Rm9yT25lRXRoZXIgdWludDogbmV3IHByaWNlIC0gRFNUIHRva2VucyBmb3IgMSBFVEgKICAgICAqLyAgICAgCiAgICBmdW5jdGlvbiBzZXRFdGhlclByaWNlKHVpbnQgcXR5Rm9yT25lRXRoZXIpIG9ubHlBZnRlckVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5RXhlY3V0aXZlIHsKICAgICAgICAgZXRoZXJQcmljZSA9IHF0eUZvck9uZUV0aGVyOyAKCiAgICAgICAgIC8vIHJpc2UgZXZlbnQgZm9yIHRoaXMKICAgICAgICAgTmV3RXRoZXJQcmljZShxdHlGb3JPbmVFdGhlcik7CiAgICB9ICAgIAogICAgCgogICAgLyoqCiAgICAgKiAgZGlzYWJsZVRva2VuSXNzdWFuY2UgLSBmdW5jdGlvbiB3aWxsIGRpc2FibGUgYW55IAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uIGZvciBmdXR1cmUgdG9rZW4gCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBpc3N1ZW5jZQogICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlVG9rZW5Jc3N1YW5jZSgpIG9ubHlFeGVjdXRpdmUgewogICAgICAgIGFibGVUb0lzc3VlVG9rZW5zID0gZmFsc2U7CiAgICAgICAgCiAgICAgICAgRGlzYWJsZVRva2VuSXNzdWFuY2UoKTsKICAgIH0KCiAgICAKICAgIC8qKgogICAgICogIGJ1cm5SZW1haW5Ub2tlbiAtICBlbGltaW5hdGVkIGFsbCBhdmFpbGFibGUgZm9yIHNhbGUKICAgICAqICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLiAKICAgICAqLwogICAgZnVuY3Rpb24gYnVyblJlbWFpblRva2VuKCkgb25seUV4ZWN1dGl2ZSB7CiAgICAKICAgICAgICB0b3RhbFN1cHBseVZhciAtPSBiYWxhbmNlc1t0aGlzXTsKICAgICAgICBiYWxhbmNlc1t0aGlzXSA9IDA7CiAgICAgICAgCiAgICAgICAgLy8gcmlzZSBldmVudCBmb3IgdGhpcwogICAgICAgIEJ1cm5lZEFsbFJlbWFpbmVkVG9rZW5zKCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogIHN1Ym1pdEV0aGVyUHJvcG9zYWw6IHN1Ym1pdCBwcm9wb3NhbCB0byB1c2UgcGFydCBvZiB0aGUgCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGVkIGV0aGVyIGZ1bmRzCiAgICAgKgogICAgICogICBAcGFyYW0gcmVxdWVzdFZhbHVlIHVpbnQ6IHZhbHVlIGluIHdlaSAKICAgICAqICAgQHBhcmFtIHVybCBzdHJpbmc6IGRldGFpbHMgb2YgdGhlIHByb3Bvc2FsIAogICAgICovIAogICAgZnVuY3Rpb24gc3VibWl0RXRoZXJQcm9wb3NhbCh1aW50IHJlcXVlc3RWYWx1ZSwgc3RyaW5nIHVybCkgb25seUFmdGVyRW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUV4ZWN1dGl2ZSByZXR1cm5zIChieXRlczMyIHJlc3VsdElkLCBib29sIHJlc3VsdFN1Y2NlcykgeyAgICAgICAKICAgIAogICAgICAgIC8vIGVuc3VyZSB0aGVyZSBpcyBubyBtb3JlIGlzc3VlbmNlIGF2YWlsYWJsZSAKICAgICAgICBpZiAoYWJsZVRvSXNzdWVUb2tlbnMpIHRocm93OwogICAgICAgICAgICAKICAgICAgICAvLyBlbnN1cmUgdGhlcmUgaXMgbm8gbW9yZSB0b2tlbnMgYXZhaWxhYmxlIAogICAgICAgIGlmIChiYWxhbmNlT2YodGhpcykgPiAwKSB0aHJvdzsKCiAgICAgICAgLy8gUG9zc2libGUgdG8gc3VibWl0IGEgcHJvcG9zYWwgb25jZSAyIHdlZWtzIAogICAgICAgIGlmIChub3cgPCAodGltZU9mTGFzdFByb3Bvc2FsICsgMiB3ZWVrcykpIHRocm93OwogICAgICAgICAgICAKICAgICAgICB1aW50IHBlcmNlbnQgPSBjb2xsZWN0ZWRFdGhlciAvIDEwMDsKICAgICAgICAgICAgCiAgICAgICAgaWYgKHJlcXVlc3RWYWx1ZSA+IFBST1BPU0FMX0ZVTkRTX1RIICogcGVyY2VudCkgdGhyb3c7CgogICAgICAgIC8vIGlmIHJlbWFpbmVkIHZhbHVlIGlzIGxlc3MgdGhhbiByZXF1ZXN0ZWQgZ2FpbiBhbGwuCiAgICAgICAgaWYgKHJlcXVlc3RWYWx1ZSA+IHRoaXMuYmFsYW5jZSkgCiAgICAgICAgICAgIHJlcXVlc3RWYWx1ZSA9IHRoaXMuYmFsYW5jZTsgICAgCiAgICAgICAgICAgIAogICAgICAgIC8vIHNldCBpZCBvZiB0aGUgcHJvcG9zYWwKICAgICAgICAvLyBzdWJtaXQgcHJvcG9zYWwgdG8gdGhlIG1hcAogICAgICAgIGJ5dGVzMzIgaWQgPSBzaGEzKG1zZy5kYXRhLCBub3cpOwogICAgICAgIHVpbnQgdGltZUVuZHMgPSBub3cgKyBQUk9QT1NBTF9MSUZFVElNRTsgCiAgICAgICAgICAgIAogICAgICAgIFByb3Bvc2FsIG1lbW9yeSBuZXdQcm9wb3NhbCA9IFByb3Bvc2FsKGlkLCByZXF1ZXN0VmFsdWUsIHVybCwgdGltZUVuZHMsIDAsIG1zZy5zZW5kZXIsIGZhbHNlLCBQcm9wb3NhbEN1cnJlbmN5LkVUSEVSKTsKICAgICAgICBwcm9wb3NhbHNbaWRdID0gbmV3UHJvcG9zYWw7CiAgICAgICAgbGlzdFByb3Bvc2Fscy5wdXNoKG5ld1Byb3Bvc2FsKTsKICAgICAgICAgICAgCiAgICAgICAgdGltZU9mTGFzdFByb3Bvc2FsID0gbm93OyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIFByb3Bvc2FsUmVxdWVzdFN1Ym1pdHRlZChpZCwgcmVxdWVzdFZhbHVlLCB0aW1lRW5kcywgdXJsLCBtc2cuc2VuZGVyKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKGlkLCB0cnVlKTsKICAgIH0KICAgIAogICAgCiAgICAgCiAgICAvKioKICAgICAqIAogICAgICogc3VibWl0SEtHUHJvcG9zYWwgLSBzdWJtaXQgcHJvcG9zYWwgdG8gcmVxdWVzdCBmb3IgCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHBhcnRpYWwgSEtHIGZ1bmRzIGNvbGxlY3RlZCAKICAgICAqIAogICAgICogIEBwYXJhbSByZXF1ZXN0VmFsdWUgdWludDogdmFsdWUgaW4gSEtHIHRvIHJlcXVlc3QuIAogICAgICogIEBwYXJhbSB1cmwgc3RyaW5nOiB1cmwgd2l0aCBkZXRhaWxzIG9uIHRoZSBwcm9wb3NpdGlvbiAKICAgICAqLwogICAgZnVuY3Rpb24gc3VibWl0SEtHUHJvcG9zYWwodWludCByZXF1ZXN0VmFsdWUsIHN0cmluZyB1cmwpIG9ubHlBZnRlckVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlFeGVjdXRpdmUgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHRJZCwgYm9vbCByZXN1bHRTdWNjZXMpewogICAgICAgIAoKICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyAyIG1vbnRocyBvdmVyIHNpbmNlIHRoZSBsYXN0IGV2ZW50LgogICAgICAgIC8vIFRoZXJlIGlzIG5vIHBvc2libGUgdG8gZ2V0IGFueSBIS0cuIEFmdGVyIDIgbW9udGhzCiAgICAgICAgLy8gYWxsIHRoZSBIS0cgaXMgYXZhaWxhYmxlLiAKICAgICAgICBpZiAobm93IDwgKGV2ZW50SW5mby5nZXRFdmVudEVuZCgpICsgOCB3ZWVrcykpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQoKICAgICAgICAvLyBQb3NzaWJsZSB0byBzdWJtaXQgYSBwcm9wb3NhbCBvbmNlIDIgd2Vla3MgCiAgICAgICAgaWYgKG5vdyA8ICh0aW1lT2ZMYXN0UHJvcG9zYWwgKyAyIHdlZWtzKSkgdGhyb3c7CgogICAgICAgIHVpbnQgcGVyY2VudCA9IHByZWZlcmVkUXR5U29sZCAvIDEwMDsKICAgICAgICAKICAgICAgICAvLyB2YWxpZGF0ZSB0aGUgYW1vdW50IGlzIGxlZ2l0CiAgICAgICAgLy8gZmlyc3QgNSBwcm9wb3NhbHMgc2hvdWxkIGJlIGxlc3MgdGhhbiAyMCUgCiAgICAgICAgaWYgKGNvdW50ZXJQcm9wb3NhbHMgPD0gNSAmJiAKICAgICAgICAgICAgcmVxdWVzdFZhbHVlICAgICA+ICBQUk9QT1NBTF9GVU5EU19USCAqIHBlcmNlbnQpIHRocm93OwogICAgICAgICAgICAgICAgCiAgICAgICAgLy8gaWYgcmVtYWluZWQgdmFsdWUgaXMgbGVzcyB0aGFuIHJlcXVlc3RlZCAKICAgICAgICAvLyBnYWluIGFsbC4KICAgICAgICBpZiAocmVxdWVzdFZhbHVlID4gZ2V0SEtHT3duZWQoKSkgCiAgICAgICAgICAgIHJlcXVlc3RWYWx1ZSA9IGdldEhLR093bmVkKCk7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gc2V0IGlkIG9mIHRoZSBwcm9wb3NhbAogICAgICAgIC8vIHN1Ym1pdCBwcm9wb3NhbCB0byB0aGUgbWFwCiAgICAgICAgYnl0ZXMzMiBpZCA9IHNoYTMobXNnLmRhdGEsIG5vdyk7CiAgICAgICAgdWludCB0aW1lRW5kcyA9IG5vdyArIFBST1BPU0FMX0xJRkVUSU1FOyAKICAgICAgICAKICAgICAgICBQcm9wb3NhbCBtZW1vcnkgbmV3UHJvcG9zYWwgPSBQcm9wb3NhbChpZCwgcmVxdWVzdFZhbHVlLCB1cmwsIHRpbWVFbmRzLCAwLCBtc2cuc2VuZGVyLCBmYWxzZSwgUHJvcG9zYWxDdXJyZW5jeS5IS0cpOwogICAgICAgIHByb3Bvc2Fsc1tpZF0gPSBuZXdQcm9wb3NhbDsKICAgICAgICBsaXN0UHJvcG9zYWxzLnB1c2gobmV3UHJvcG9zYWwpOwogICAgICAgIAogICAgICAgICsrY291bnRlclByb3Bvc2FsczsKICAgICAgICB0aW1lT2ZMYXN0UHJvcG9zYWwgPSBub3c7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgUHJvcG9zYWxSZXF1ZXN0U3VibWl0dGVkKGlkLCByZXF1ZXN0VmFsdWUsIHRpbWVFbmRzLCB1cmwsIG1zZy5zZW5kZXIpOwogICAgICAgIAogICAgICAgIHJldHVybiAoaWQsIHRydWUpOyAgICAgICAgCiAgICB9ICAKICAgIAogICAgCiAgICAKICAgIC8qKgogICAgICogb2JqZWN0UHJvcG9zYWwgLSBvYmplY3QgcHJldmlvdXNseSBzdWJtaXR0ZWQgcHJvcG9zYWwsIAogICAgICogICAgICAgICAgICAgICAgICB0aGUgb2JqZWN0aW9uIHJpZ2h0IGlzIG9idGFpbmVkIGJ5IAogICAgICogICAgICAgICAgICAgICAgICBwdXJjaGFzaW5nIHByZWZlcmVkIHRva2VucyBvbiB0aW1lIG9mIAogICAgICogICAgICAgICAgICAgICAgICB0aGUgaGFja2F0aG9uLgogICAgICogCiAgICAgKiAgQHBhcmFtIGlkIGJ5dGVzMzIgOiB0aGUgaWQgb2YgdGhlIHByb3Bvc2xhIHRvIHJlZGVlbQogICAgICovCiAgICAgZnVuY3Rpb24gb2JqZWN0UHJvcG9zYWwoYnl0ZXMzMiBpZCl7CiAgICAgICAgIAogICAgICAgIFByb3Bvc2FsIG1lbW9yeSBwcm9wb3NhbCA9IHByb3Bvc2Fsc1tpZF07CiAgICAgICAgIAogICAgICAgIC8vIGNoZWNrIHByb3Bvc2FsIGV4aXN0IAogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLmlkID09IDApIHRocm93OwoKICAgICAgICAvLyBjaGVjayBhbHJlYWR5IHJlZGVlbWVkCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0ucmVkZWVtZWQpIHRocm93OwogICAgICAgICAKICAgICAgICAvLyBlbnN1cmUgb2JqZWN0aW9uIHRpbWUKICAgICAgICBpZiAobm93ID49IHByb3Bvc2Fsc1tpZF0udm90aW5kRW5kVFMpIHRocm93OwogICAgICAgICAKICAgICAgICAvLyBlbnN1cmUgbm90IHZvdGVkICAKICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS52b3RlZFttc2cuc2VuZGVyXSkgdGhyb3c7CiAgICAgICAgIAogICAgICAgICAvLyBzdWJtaXQgdm90ZXMKICAgICAgICAgdWludCB2b3RlcyA9IHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXTsKICAgICAgICAgcHJvcG9zYWxzW2lkXS52b3Rlc09iamVjdGluZyArPSB2b3RlczsKICAgICAgICAgCiAgICAgICAgIC8vIG1hcmsgdm90ZWQgCiAgICAgICAgIHByb3Bvc2Fsc1tpZF0udm90ZWRbbXNnLnNlbmRlcl0gPSB0cnVlOyAKICAgICAgICAgCiAgICAgICAgIHVpbnQgaWR4ID0gZ2V0SW5kZXhCeVByb3Bvc2FsSWQoaWQpOwogICAgICAgICBsaXN0UHJvcG9zYWxzW2lkeF0gPSBwcm9wb3NhbHNbaWRdOyAgIAoKICAgICAgICAgT2JqZWN0ZWRWb3RlKGlkLCBtc2cuc2VuZGVyLCB2b3Rlcyk7ICAgICAgICAgCiAgICAgfQogICAgIAogICAgIAogICAgIGZ1bmN0aW9uIGdldEluZGV4QnlQcm9wb3NhbElkKGJ5dGVzMzIgaWQpIHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICAgCiAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxpc3RQcm9wb3NhbHMubGVuZ3RoOyArK2kpewogICAgICAgICAgICAgaWYgKGlkID09IGxpc3RQcm9wb3NhbHNbaV0uaWQpIHJldHVybiBpOwogICAgICAgICB9CiAgICAgfQogICAgCiAgICAKICAgCiAgICAvKioKICAgICAqIHJlZGVlbVByb3Bvc2FsRnVuZHMgLSByZWRlZW0gZnVuZHMgcmVxdWVzdGVkIGJ5IHByaW9yIAogICAgICogICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdHRlZCBwcm9wb3NhbCAgICAgCiAgICAgKiAKICAgICAqIEBwYXJhbSBpZCBieXRlczMyOiB0aGUgaWQgb2YgdGhlIHByb3Bvc2FsIHRvIHJlZGVlbQogICAgICovCiAgICBmdW5jdGlvbiByZWRlZW1Qcm9wb3NhbEZ1bmRzKGJ5dGVzMzIgaWQpIG9ubHlFeGVjdXRpdmUgewoKICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS5pZCA9PSAwKSB0aHJvdzsKICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS5zdWJtaXR0ZXIgIT0gbXNnLnNlbmRlcikgdGhyb3c7CgogICAgICAgIC8vIGVuc3VyZSBvYmplY3Rpb24gdGltZQogICAgICAgIGlmIChub3cgPCBwcm9wb3NhbHNbaWRdLnZvdGluZEVuZFRTKSB0aHJvdzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAKICAgICAgICAgICAgLy8gY2hlY2sgYWxyZWFkeSByZWRlZW1lZAogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnJlZGVlbWVkKSB0aHJvdzsKCiAgICAgICAgLy8gY2hlY2sgdm90ZXMgb2JqZWN0aW9uID0+IDU1JSBvZiB0b3RhbCB2b3RlcwogICAgICAgIHVpbnQgb2JqZWN0aW9uVGhyZXNob2xkID0gcHJlZmVyZWRRdHlTb2xkIC8gMTAwICogNTU7CiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0udm90ZXNPYmplY3RpbmcgID4gb2JqZWN0aW9uVGhyZXNob2xkKSB0aHJvdzsKICAgIAogICAgCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0ucHJvcG9zYWxDdXJyZW5jeSA9PSBQcm9wb3NhbEN1cnJlbmN5LkhLRyl7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBzZW5kIGhhY2tlciBnb2xkIAogICAgICAgICAgICBoYWNrZXJHb2xkLnRyYW5zZmVyKHByb3Bvc2Fsc1tpZF0uc3VibWl0dGVyLCBwcm9wb3NhbHNbaWRdLnZhbHVlKTsgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgLy8gc2VuZCBldGhlciAgICAgICAgICAgICAgCiAgICAgICAgICAgYm9vbCBzdWNjZXNzID0gcHJvcG9zYWxzW2lkXS5zdWJtaXR0ZXIuc2VuZChwcm9wb3NhbHNbaWRdLnZhbHVlKTsgCgogICAgICAgICAgIC8vIHJpc2UgZXZlbnQKICAgICAgICAgICBFdGhlclJlZGVlbUFjY2VwdGVkKHByb3Bvc2Fsc1tpZF0uc3VibWl0dGVyLCBwcm9wb3NhbHNbaWRdLnZhbHVlKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gZXhlY3V0ZSB0aGUgcHJvcG9zYWwgCiAgICAgICAgcHJvcG9zYWxzW2lkXS5yZWRlZW1lZCA9IHRydWU7IAogICAgfQogICAgCiAgICAKICAgIC8qKgogICAgICogIGdldEFsbFRoZUZ1bmRzIC0gdG8gZW5zdXJlIHRoZXJlIGlzIG5vIGRlYWRsb2NrIGNhbiAKICAgICAqICAgICAgICAgICAgICAgICAgIGNhbiBoYXBwZW4sIGFuZCBubyBjYXNlIHRoYXQgdm90aW5nIAogICAgICogICAgICAgICAgICAgICAgICAgc3RydWN0dXJlIHdpbGwgZnJlZXplIHRoZSBmdW5kcyBmb3JldmVyCiAgICAgKiAgICAgICAgICAgICAgICAgICB0aGUgc3RhcnR1cCB3aWxsIGJlIGFibGUgdG8gZ2V0IGFsbCB0aGUKICAgICAqICAgICAgICAgICAgICAgICAgIGZ1bmRzIHdpdGhvdXQgYSBwcm9wb3NhbCByZXF1aXJlZCBhZnRlcgogICAgICogICAgICAgICAgICAgICAgICAgNiBtb250aHMuCiAgICAgKiAKICAgICAqIAogICAgICovICAgICAgICAgICAgIAogICAgZnVuY3Rpb24gZ2V0QWxsVGhlRnVuZHMoKSBvbmx5RXhlY3V0aXZlIHsKICAgICAgICAKICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIGRlYWRsb2NrIGluIHZvdGluZyBwYXJ0aWNpcGF0ZXMKICAgICAgICAvLyB0aGUgZnVuZHMgY2FuIGJlIHJlZGVlbWVkIGNvbXBsZXRlbGx5IGluIDYgbW9udGhzCiAgICAgICAgaWYgKG5vdyA8IChldmVudEluZm8uZ2V0RXZlbnRFbmQoKSArIDI0IHdlZWtzKSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9ICAKICAgICAgICAKICAgICAgICAvLyBhbGwgdGhlIEV0aGVyCiAgICAgICAgYm9vbCBzdWNjZXNzID0gbXNnLnNlbmRlci5zZW5kKHRoaXMuYmFsYW5jZSk7ICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBhbGwgdGhlIEhLRwogICAgICAgIGhhY2tlckdvbGQudHJhbnNmZXIobXNnLnNlbmRlciwgZ2V0SEtHT3duZWQoKSk7ICAgICAgICAgICAgICAKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIHN1Ym1pdEltcGVhY2htZW50UHJvcG9zYWwgLSBzdWJtaXQgcmVxdWVzdCB0byBzd2l0Y2ggCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0aXZlLgogICAgICogCiAgICAgKiAgQHBhcmFtIHVybERldGFpbHMgIC0gZGV0YWlscyBvZiB0aGUgaW1wZWFjaG1lbnQgcHJvcG9zYWwgCiAgICAgKiAgQHBhcmFtIG5ld0V4ZWN1dGl2ZSAtIGFkZHJlc3Mgb2YgdGhlIG5ldyBleGVjdXRpdmUgCiAgICAgKiAKICAgICAqLyAgICAgICAgICAgICAKICAgICBmdW5jdGlvbiBzdWJtaXRJbXBlYWNobWVudFByb3Bvc2FsKHN0cmluZyB1cmxEZXRhaWxzLCBhZGRyZXNzIG5ld0V4ZWN1dGl2ZSl7CiAgICAgICAgIAogICAgICAgIC8vIHRvIG9mZmVyIGltcGVhY2htZW50IHlvdSBzaG91bGQgaGF2ZSAKICAgICAgICAvLyB2b3RpbmcgcmlnaHRzCiAgICAgICAgaWYgKHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXSA9PSAwKSB0aHJvdzsKICAgICAgICAgCiAgICAgICAgLy8gdGhlIHN1Ym1pc3Npb24gb2YgdGhlIGZpcnN0IGltcGVhY2htZW50IAogICAgICAgIC8vIHByb3Bvc2FsIGlzIHBvc3NpYmxlIG9ubHkgYWZ0ZXIgMyBtb250aHMKICAgICAgICAvLyBzaW5jZSB0aGUgaGFja2F0aG9uIGlzIG92ZXIKICAgICAgICBpZiAobm93IDwgKGV2ZW50SW5mby5nZXRFdmVudEVuZCgpICsgMTIgd2Vla3MpKSB0aHJvdzsKICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgIC8vIGNoZWNrIHRoZXJlIGlzIDEgbW9udGhzIG92ZXIgc2luY2UgbGFzdCBvbmUKICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90aW5kRW5kVFMgIT0gMCAmJiAKICAgICAgICAgICAgbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90aW5kRW5kVFMgKyAgMiB3ZWVrcyA+IG5vdykgdGhyb3c7CgoKICAgICAgICAvLyBzdWJtaXQgaW1wZWFjaG1lbnQgcHJvcG9zYWwKICAgICAgICAvLyBhZGQgdGhlIHZvdGVzIG9mIHRoZSBzdWJtaXR0ZXIgCiAgICAgICAgLy8gdG8gdGhlIHByb3Bvc2FsIHJpZ2h0IGF3YXkKICAgICAgICBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbCA9IEltcGVhY2htZW50UHJvcG9zYWwodXJsRGV0YWlscywgbmV3RXhlY3V0aXZlLCBub3cgKyAyIHdlZWtzLCB2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl0pOwogICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVkW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICAgCiAgICAgICAgLy8gcmlzZSBldmVudAogICAgICAgIEltcGVhY2htZW50UHJvcG9zZWQobXNnLnNlbmRlciwgdXJsRGV0YWlscywgbm93ICsgMiB3ZWVrcywgbmV3RXhlY3V0aXZlKTsKICAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBzdXBwb3J0SW1wZWFjaG1lbnQgLSB2b3RlIGZvciBpbXBlYWNobWVudCBwcm9wb3NhbCAKICAgICAqICAgICAgICAgICAgICAgICAgICAgIHRoYXQgaXMgY3VycmVudGx5IGluIHByb2dyZXNzCiAgICAgKgogICAgICovCiAgICBmdW5jdGlvbiBzdXBwb3J0SW1wZWFjaG1lbnQoKXsKCiAgICAgICAgLy8gZW5zdXJlIHRoYXQgc3VwcG9ydCBpcyBmb3IgZXhpc3QgcHJvcG9zYWwgCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLm5ld0V4ZWN1dGl2ZSA9PSAweDApIHRocm93OwogICAgCiAgICAgICAgLy8gdG8gb2ZmZXIgaW1wZWFjaG1lbnQgeW91IHNob3VsZCBoYXZlIAogICAgICAgIC8vIHZvdGluZyByaWdodHMKICAgICAgICBpZiAodm90aW5nUmlnaHRzW21zZy5zZW5kZXJdID09IDApIHRocm93OwogICAgICAgIAogICAgICAgIC8vIGNoZWNrIGlmIG5vdCB2b3RlZCBhbHJlYWR5IAogICAgICAgIGlmIChsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RlZFttc2cuc2VuZGVyXSkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgaWYgbm90IGZpbmlzaGVkIHRoZSAyIHdlZWtzIG9mIHZvdGluZyAKICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90aW5kRW5kVFMgKyAyIHdlZWtzIDw9IG5vdykgdGhyb3c7CiAgICAgICAgICAgICAgICAKICAgICAgICAvLyBzdXBwb3J0IHRoZSBpbXBlYWNobWVudAogICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVkW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3Rlc1N1cHBvcnRpbmcgKz0gdm90aW5nUmlnaHRzW21zZy5zZW5kZXJdOwoKICAgICAgICAvLyByaXNlIGltcGVhY2htZW50IHN1cHBwb3J0aW5nIGV2ZW50CiAgICAgICAgSW1wZWFjaG1lbnRTdXBwb3J0KG1zZy5zZW5kZXIsIHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXSk7CiAgICAgICAgCiAgICAgICAgLy8gaWYgdGhlIHZvdGUgaXMgb3ZlciA3MCUgZXhlY3V0ZSB0aGUgc3dpdGNoIAogICAgICAgIHVpbnQgcGVyY2VudCA9IHByZWZlcmVkUXR5U29sZCAvIDEwMDsgCiAgICAgICAgCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVzU3VwcG9ydGluZyA+PSA3MCAqIHBlcmNlbnQpewogICAgICAgICAgICBleGVjdXRpdmUgPSBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC5uZXdFeGVjdXRpdmU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBpbXBlYWNobWVudCBldmVudAogICAgICAgICAgICBJbXBlYWNobWVudEFjY2VwdGVkKGV4ZWN1dGl2ZSk7CiAgICAgICAgfQogICAgICAgIAogICAgfSAKICAgIAogICAgICAKICAgIAogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAvLwogICAgLy8gKiAgICAgQ29uc3RhbnQgR2V0dGVycyAgICAgKiAvLwogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAvLwogICAgCiAgICBmdW5jdGlvbiB2b3RpbmdSaWdodHNPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZXN1bHQpIHsKICAgICAgICByZXN1bHQgPSB2b3RpbmdSaWdodHNbX293bmVyXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0UHJlZmVyZWRRdHlTb2xkKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpewogICAgICAgIHJldHVybiBwcmVmZXJlZFF0eVNvbGQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldFZpcnR1YWxFeGNoYW5nZShhZGRyZXNzIHZpcnR1YWxFeGNoYW5nZUFkZHIpewogICAgICAgIGlmICh2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzICE9IDB4MCkgdGhyb3c7CiAgICAgICAgdmlydHVhbEV4Y2hhbmdlQWRkcmVzcyA9IHZpcnR1YWxFeGNoYW5nZUFkZHI7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SEtHT3duZWQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGhhY2tlckdvbGQuYmFsYW5jZU9mKHRoaXMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRFdGhlclZhbHVlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpewogICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldEV4ZWN1dGl2ZSgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgcmVzdWx0KXsKICAgICAgICByZXR1cm4gZXhlY3V0aXZlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRIS0dQcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gaGtnUHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXRoZXJQcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gZXRoZXJQcmljZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0RFNUTmFtZSgpIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9ICAgIAogICAgCiAgICBmdW5jdGlvbiBnZXREU1ROYW1lQnl0ZXMoKSBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIgcmVzdWx0KXsKICAgICAgICByZXR1cm4gY29udmVydChuYW1lKTsKICAgIH0gICAgCgogICAgZnVuY3Rpb24gZ2V0RFNUU3ltYm9sKCkgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcgcmVzdWx0KXsKICAgICAgICByZXR1cm4gc3ltYm9sOwogICAgfSAgICAKICAgIAogICAgZnVuY3Rpb24gZ2V0RFNUU3ltYm9sQnl0ZXMoKSBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIgcmVzdWx0KXsKICAgICAgICByZXR1cm4gY29udmVydChzeW1ib2wpOwogICAgfSAgICAKCiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyByZXN1bHQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0VG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseVZhcjsKICAgIH0gCiAgICAgICAgCiAgICBmdW5jdGlvbiBnZXRDb2xsZWN0ZWRFdGhlcigpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0cykgeyAgICAgICAgCiAgICAgICAgcmV0dXJuIGNvbGxlY3RlZEV0aGVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDb3VudGVyUHJvcG9zYWxzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpewogICAgICAgIHJldHVybiBjb3VudGVyUHJvcG9zYWxzOwogICAgfQogICAgICAgIAogICAgZnVuY3Rpb24gZ2V0UHJvcG9zYWxJZEJ5SW5kZXgodWludCBpKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyIHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGxpc3RQcm9wb3NhbHNbaV0uaWQ7CiAgICB9ICAgIAoKICAgIGZ1bmN0aW9uIGdldFByb3Bvc2FsT2JqZWN0aW9uQnlJbmRleCh1aW50IGkpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gbGlzdFByb3Bvc2Fsc1tpXS52b3Rlc09iamVjdGluZzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQcm9wb3NhbFZhbHVlQnlJbmRleCh1aW50IGkpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gbGlzdFByb3Bvc2Fsc1tpXS52YWx1ZTsKICAgIH0gICAgICAgICAgICAgICAgICAKICAgIAogICAgZnVuY3Rpb24gZ2V0Q3VycmVudEltcGVhY2htZW50VXJsRGV0YWlscygpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyByZXN1bHQpewogICAgICAgIHJldHVybiBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC51cmxEZXRhaWxzOwogICAgfQogICAgCiAgICAKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRJbXBlYWNobWVudFZvdGVzU3VwcG9ydGluZygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZXNTdXBwb3J0aW5nOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjb252ZXJ0KHN0cmluZyBrZXkpIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7CiAgICAgICAgICAgIGlmIChieXRlcyhrZXkpLmxlbmd0aCA+IDMyKSB7CiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgfSAgICAgIAoKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgcmV0IDo9IG1sb2FkKGFkZChrZXksIDMyKSkKICAgICAgICAgICAgfQogICAgfSAgICAKICAgIAogICAgLy8gRW1lcmdlbmN5IEZpeCBsaW1pdGVkIGJ5IHRpbWUgZnVuY3Rpb25zCiAgICBmdW5jdGlvbiBzZXRWb3RlUmlnaHQoYWRkcmVzcyB2b3RlciwgdWludCBhbW1vdW50KXsKICAgICAgICAKICAgICAgICAvLyBsaW1pdGVkIGJ5IFsxMiBKYW4gMjAxNyAwMDowMDowMCBHTVRdCiAgICAgICAgaWYgKG5vdyA+IDE0ODQxNzkyMDApIHRocm93OwoKICAgICAgICAvLyBsaW1pdGVkIGJ5IG9uZSBhY2NvdW50IHRvIGZpeCAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSAweDM0MmU2MjczMmI3Njg3NWRhOTMwNTA4M2VhOGFlNjMxMjVhNGU2NjcpIHRocm93OwoKICAgICAgICB2b3RpbmdSaWdodHNbdm90ZXJdID0gYW1tb3VudDsKICAgIH0KICAgIAogICAgLy8gRW1lcmdlbmN5IEZpeCBsaW1pdGVkIGJ5IHRpbWUgZnVuY3Rpb25zCiAgICBmdW5jdGlvbiBzZXRCYWxhbmNlKGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1tb3VudCl7CgogICAgICAgIC8vIGxpbWl0ZWQgYnkgWzEyIEphbiAyMDE3IDAwOjAwOjAwIEdNVF0KICAgICAgICBpZiAobm93ID4gMTQ4NDE3OTIwMCkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gbGltaXRlZCBieSBvbmUgYWNjb3VudCB0byBmaXggCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gMHgzNDJlNjI3MzJiNzY4NzVkYTkzMDUwODNlYThhZTYzMTI1YTRlNjY3KSB0aHJvdzsKICAgICAgICAKICAgICAgICBiYWxhbmNlc1tvd25lcl0gPSBhbW1vdW50OwogICAgfQogICAgCiAgICAvLyBFbWVyZ2VuY3kgRml4IGxpbWl0ZWQgYnkgdGltZSBmdW5jdGlvbnMKICAgIGZ1bmN0aW9uIHNldEludGVybmFsSW5mbyhhZGRyZXNzIGZpeEV4ZWN1dGl2ZSwgdWludCBmaXhUb3RhbFN1cHBseSwgdWludDI1NiBmaXhQcmVmZXJlZFF0eVNvbGQsIAogICAgICAgICAgICB1aW50MjU2IGZpeENvbGxlY3RlZEhLRywgdWludCBmaXhDb2xsZWN0ZWRFdGhlcil7CgogICAgICAgIC8vIGxpbWl0ZWQgYnkgWzEyIEphbiAyMDE3IDAwOjAwOjAwIEdNVF0KICAgICAgICBpZiAobm93ID4gMTQ4NDE3OTIwMCkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gbGltaXRlZCBieSBvbmUgYWNjb3VudCB0byBmaXggCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gMHgzNDJlNjI3MzJiNzY4NzVkYTkzMDUwODNlYThhZTYzMTI1YTRlNjY3KSB0aHJvdzsKICAgICAgICAKICAgICAgICBleGVjdXRpdmUgPSBmaXhFeGVjdXRpdmU7CiAgICAgICAgdG90YWxTdXBwbHlWYXIgPSBmaXhUb3RhbFN1cHBseTsKICAgICAgICBwcmVmZXJlZFF0eVNvbGQgPSBmaXhQcmVmZXJlZFF0eVNvbGQ7CiAgICAgICAgY29sbGVjdGVkSEtHID0gZml4Q29sbGVjdGVkSEtHOwogICAgICAgIGNvbGxlY3RlZEV0aGVyID0gZml4Q29sbGVjdGVkRXRoZXI7CiAgICB9CiAgICAKICAgIAogICAgLy8gKioqKioqKioqKioqKioqKioqKioqIC8vCiAgICAvLyAqICAgICBNb2RpZmllcnMgICAgICogLy8KICAgIC8vICoqKioqKioqKioqKioqKioqKioqKiAvLyAgICAKIAogICAgbW9kaWZpZXIgb25seUJlZm9yZUVuZCgpIHsgaWYgKG5vdyAgPj0gIGV2ZW50SW5mby5nZXRFdmVudEVuZCgpKSB0aHJvdzsgXzsgfQogICAgbW9kaWZpZXIgb25seUFmdGVyRW5kKCkgIHsgaWYgKG5vdyAgPCAgIGV2ZW50SW5mby5nZXRFdmVudEVuZCgpKSB0aHJvdzsgXzsgfQogICAgCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJUcmFkaW5nU3RhcnQoKSAgeyBpZiAobm93ICA8IGV2ZW50SW5mby5nZXRUcmFkaW5nU3RhcnQoKSkgdGhyb3c7IF87IH0KICAgIAogICAgbW9kaWZpZXIgb25seUV4ZWN1dGl2ZSgpICAgICB7IGlmIChtc2cuc2VuZGVyICE9IGV4ZWN1dGl2ZSkgdGhyb3c7IF87IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBtb2RpZmllciBvbmx5SWZBYmxlVG9Jc3N1ZVRva2VucygpICB7IGlmICghYWJsZVRvSXNzdWVUb2tlbnMpIHRocm93OyBfOyB9IAogICAgCgogICAgLy8gKioqKioqKioqKioqKioqKioqIC8vCiAgICAvLyAqICAgICBFdmVudHMgICAgICogLy8KICAgIC8vICoqKioqKioqKioqKioqKioqKiAvLyAgICAgICAgCgogICAgCiAgICBldmVudCBQcmljZUhLR0NoYW5nZSh1aW50IGluZGV4ZWQgcXR5Rm9yT25lSEtHLCB1aW50IGluZGV4ZWQgdG9rZW5zU29sZCwgdWludCBpbmRleGVkIHRvdGFsU3VwcGx5KTsKICAgIGV2ZW50IEJ1eUZvckhLR1RyYW5zYWN0aW9uKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSwgdWludCBxdHlGb3JPbmVIS0csIHVpbnQgdG9rZW5zQW1vdW50KTsKICAgIGV2ZW50IEJ1eUZvckV0aGVyVHJhbnNhY3Rpb24oYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50IGluZGV4ZWQgdG9rZW5zU29sZCwgdWludCBpbmRleGVkIHRvdGFsU3VwcGx5LCB1aW50IHF0eUZvck9uZUV0aGVyLCB1aW50IHRva2Vuc0Ftb3VudCk7CgogICAgZXZlbnQgRHN0VG9rZW5zSXNzdWVkKHVpbnQgaW5kZXhlZCBxdHlGb3JPbmVIS0csIHVpbnQgaW5kZXhlZCB0b2tlbnNTb2xkLCB1aW50IGluZGV4ZWQgdG90YWxTdXBwbHksIHVpbnQgcXR5VG9FbWl0KTsKICAgIAogICAgZXZlbnQgUHJvcG9zYWxSZXF1ZXN0U3VibWl0dGVkKGJ5dGVzMzIgaWQsIHVpbnQgdmFsdWUsIHVpbnQgdGltZUVuZHMsIHN0cmluZyB1cmwsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIAogICAgZXZlbnQgRXRoZXJSZWRlZW1BY2NlcHRlZChhZGRyZXNzIHNlbmRlciwgdWludCB2YWx1ZSk7CiAgICAKICAgIGV2ZW50IE9iamVjdGVkVm90ZShieXRlczMyIGlkLCBhZGRyZXNzIHZvdGVyLCB1aW50IHZvdGVzKTsKICAgIAogICAgZXZlbnQgSW1wZWFjaG1lbnRQcm9wb3NlZChhZGRyZXNzIHN1Ym1pdHRlciwgc3RyaW5nIHVybERldGFpbHMsIHVpbnQgdm90aW5kRW5kVFMsIGFkZHJlc3MgbmV3RXhlY3V0aXZlKTsKICAgIGV2ZW50IEltcGVhY2htZW50U3VwcG9ydChhZGRyZXNzIHN1cHBvcnR0ZXIsIHVpbnQgdm90ZXMpOwogICAgCiAgICBldmVudCBJbXBlYWNobWVudEFjY2VwdGVkKGFkZHJlc3MgbmV3RXhlY3V0aXZlKTsKCiAgICBldmVudCBOZXdFdGhlclByaWNlKHVpbnQgbmV3UXR5Rm9yT25lRXRoZXIpOwogICAgZXZlbnQgRGlzYWJsZVRva2VuSXNzdWFuY2UoKTsKICAgIAogICAgZXZlbnQgQnVybmVkQWxsUmVtYWluZWRUb2tlbnMoKTsKICAgIAp9'.
	

]
