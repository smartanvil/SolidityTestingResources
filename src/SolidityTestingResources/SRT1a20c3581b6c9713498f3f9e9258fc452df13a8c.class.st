Class {
	#name : #SRT1a20c3581b6c9713498f3f9e9258fc452df13a8c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1a20c3581b6c9713498f3f9e9258fc452df13a8c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Ci8qKgogKiBAdGl0bGUgRVJDMjAKICogQGRldiBFUkMyMCBpbnRlcmZhY2UKICovCmNvbnRyYWN0IEVSQzIwIHsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Ci8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KfQpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KICAgIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7CiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgcHVibGljIHsgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQogICAgLy8vIEBub3RpY2UgQ2hhbmdlcyB0aGUgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIG5ldyBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIGNvbnRyb2xsZXIgPSBfbmV3Q29udHJvbGxlcjsKICAgIH0KfQovKioKICogQHRpdGxlIE1pbmlNZSBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyME1pbmlNZSBpcyBFUkMyMCwgQ29udHJvbGxlZCB7CiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLCBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsIHVpbnQgX3NuYXBzaG90QmxvY2ssIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIHB1YmxpYyByZXR1cm5zKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50KSAgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgaW50ZXJuYWwgdmlldyByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYzsKICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOwogICAgZXZlbnQgTmV3Q2xvbmVUb2tlbihhZGRyZXNzIGluZGV4ZWQgX2Nsb25lVG9rZW4sIHVpbnQgX3NuYXBzaG90QmxvY2spOwp9Ci8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUKICogQGRldiBDcm93ZHNhbGUgaXMgYSBiYXNlIGNvbnRyYWN0IGZvciBtYW5hZ2luZyBhIHRva2VuIGNyb3dkc2FsZS4KICogQ3Jvd2RzYWxlcyBoYXZlIGEgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzLCB3aGVyZSBpbnZlc3RvcnMgY2FuIG1ha2UKICogdG9rZW4gcHVyY2hhc2VzIGFuZCB0aGUgY3Jvd2RzYWxlIHdpbGwgYXNzaWduIHRoZW0gdG9rZW5zIGJhc2VkCiAqIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAogKiBhcyB0aGV5IGFycml2ZS4KICovCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKICBFUkMyME1pbmlNZSBwdWJsaWMgdG9rZW47CiAgLy8gc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzIHdoZXJlIGludmVzdG1lbnRzIGFyZSBhbGxvd2VkIChib3RoIGluY2x1c2l2ZSkKICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7CiAgdWludDI1NiBwdWJsaWMgZW5kVGltZTsKICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CiAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdHMgYSBidXllciBnZXRzIHBlciB3ZWkKICB1aW50MjU2IHB1YmxpYyByYXRlOwogIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwogIGZ1bmN0aW9uIENyb3dkc2FsZSh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIHVpbnQyNTYgX3JhdGUsIGFkZHJlc3MgX3dhbGxldCkgewogICAgcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICByZXF1aXJlKF9lbmRUaW1lID49IF9zdGFydFRpbWUpOwogICAgcmVxdWlyZShfcmF0ZSA+IDApOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CiAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgZW5kVGltZSA9IF9lbmRUaW1lOwogICAgcmF0ZSA9IF9yYXRlOwogICAgd2FsbGV0ID0gX3dhbGxldDsKICB9CiAgLy8gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gYnV5IHRva2VucwogIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogIH0KICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgYnV5VG9rZW5zKGJlbmVmaWNpYXJ5LCBtc2cudmFsdWUpOwogIH0KICAvLyBpbXBsZW1lbnRhdGlvbiBvZiBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHsKICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gMHgwKTsKICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSh3ZWlBbW91bnQpKTsKICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwogICAgdHJhbnNmZXJUb2tlbihiZW5lZmljaWFyeSwgd2VpQW1vdW50KTsKICAgIGZvcndhcmRGdW5kcyh3ZWlBbW91bnQpOwogIH0KICAvLyBsb3cgbGV2ZWwgdHJhbnNmZXIgdG9rZW4KICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIHRva2VuIHRyYW5zZmVyIG1lY2hhbmlzbSwgZWcuIHB1bGwgcGF0dGVybgogIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHsKICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgdWludDI1NiB0b2tlbnMgPSB3ZWlBbW91bnQubXVsKHJhdGUpOwogICAgdG9rZW4uZ2VuZXJhdGVUb2tlbnMoYmVuZWZpY2lhcnksIHRva2Vucyk7CiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CiAgfQogIC8vIHNlbmQgZXRoZXIgdG8gdGhlIGZ1bmQgY29sbGVjdGlvbiB3YWxsZXQKICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKHVpbnQyNTYgd2VpQW1vdW50KSBpbnRlcm5hbCB7CiAgICB3YWxsZXQudHJhbnNmZXIod2VpQW1vdW50KTsKICB9CiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UodWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCB3aXRoaW5QZXJpb2QgPSBub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lOwogICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSB3ZWlBbW91bnQgIT0gMDsKICAgIHJldHVybiB3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlOwogIH0KICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgaGFzIHN0YXJ0ZWQKICBmdW5jdGlvbiBoYXNTdGFydGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+PSBzdGFydFRpbWU7CiAgfQp9Ci8qKgogKiBAdGl0bGUgQ2FwcGVkQ3Jvd2RzYWxlCiAqIEBkZXYgRXh0ZW5zaW9uIG9mIENyb3dkc2FsZSB3aXRoIGEgbWF4IGFtb3VudCBvZiBmdW5kcyByYWlzZWQKICovCmNvbnRyYWN0IENhcHBlZENyb3dkc2FsZSBpcyBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIHVpbnQyNTYgcHVibGljIGNhcDsKICBmdW5jdGlvbiBDYXBwZWRDcm93ZHNhbGUodWludDI1NiBfY2FwKSB7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIGNhcCA9IF9jYXA7CiAgfQogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gYWRkIGV4dHJhIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBpbnZlc3RvcnMgY2FuIGJ1eSBhdCB0aGUgbW9tZW50CiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSh1aW50MjU2IHdlaUFtb3VudCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudmFsaWRQdXJjaGFzZSh3ZWlBbW91bnQpICYmICFjYXBSZWFjaGVkKCk7CiAgfQogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI2hhc0VuZGVkIHRvIGFkZCBjYXAgbG9naWMKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLmhhc0VuZGVkKCkgfHwgY2FwUmVhY2hlZCgpOwogIH0KICAvLyBAcmV0dXJuIHRydWUgaWYgY2FwIGhhcyBiZWVuIHJlYWNoZWQKICBmdW5jdGlvbiBjYXBSZWFjaGVkKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgIHJldHVybiB3ZWlSYWlzZWQgPj0gY2FwOwogIH0KICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSNidXlUb2tlbnMgdG8gYWRkIHBhcnRpYWwgcmVmdW5kIGxvZ2ljCiAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHsKICAgICB1aW50MjU2IHdlaVRvQ2FwID0gY2FwLnN1Yih3ZWlSYWlzZWQpOwogICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gd2VpVG9DYXAgPCBtc2cudmFsdWUgPyB3ZWlUb0NhcCA6IG1zZy52YWx1ZTsKICAgICBidXlUb2tlbnMoYmVuZWZpY2lhcnksIHdlaUFtb3VudCk7CiAgICAgdWludDI1NiByZWZ1bmQgPSBtc2cudmFsdWUuc3ViKHdlaUFtb3VudCk7CiAgICAgaWYgKHJlZnVuZCA+IDApIHsKICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmVmdW5kKTsKICAgICB9CiAgIH0KfQovKioKICogQHRpdGxlIEZpbmFsaXphYmxlQ3Jvd2RzYWxlCiAqIEBkZXYgRXh0ZW5zaW9uIG9mIENyb3dkc2FsZSB3aGVyZSBhbiBvd25lciBjYW4gZG8gZXh0cmEgd29yawogKiBhZnRlciBmaW5pc2hpbmcuCiAqLwpjb250cmFjdCBGaW5hbGl6YWJsZUNyb3dkc2FsZSBpcyBDcm93ZHNhbGUsIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CiAgZXZlbnQgRmluYWxpemVkKCk7CiAgLyoqCiAgICogQGRldiBNdXN0IGJlIGNhbGxlZCBhZnRlciBjcm93ZHNhbGUgZW5kcywgdG8gZG8gc29tZSBleHRyYSBmaW5hbGl6YXRpb24KICAgKiB3b3JrLiBDYWxscyB0aGUgY29udHJhY3QncyBmaW5hbGl6YXRpb24gZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoIWlzRmluYWxpemVkKTsKICAgIHJlcXVpcmUoaGFzRW5kZWQoKSk7CiAgICBmaW5hbGl6YXRpb24oKTsKICAgIEZpbmFsaXplZCgpOwogICAgaXNGaW5hbGl6ZWQgPSB0cnVlOwogIH0KICAvKioKICAgKiBAZGV2IENhbiBiZSBvdmVycmlkZGVuIHRvIGFkZCBmaW5hbGl6YXRpb24gbG9naWMuIFRoZSBvdmVycmlkaW5nIGZ1bmN0aW9uCiAgICogc2hvdWxkIGNhbGwgc3VwZXIuZmluYWxpemF0aW9uKCkgdG8gZW5zdXJlIHRoZSBjaGFpbiBvZiBmaW5hbGl6YXRpb24gaXMKICAgKiBleGVjdXRlZCBlbnRpcmVseS4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgfQp9Ci8qKgogKiBAdGl0bGUgY2xhaW0gYWNjaWRlbnRhbGx5IHNlbnQgdG9rZW5zCiAqLwpjb250cmFjdCBIYXNOb1Rva2VucyBpcyBPd25hYmxlIHsKICAgIGV2ZW50IEV4dHJhY3RlZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NsYWltZXIsIHVpbnQgX2Ftb3VudCk7CiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgLy8vIEBwYXJhbSBfY2xhaW1lciBBZGRyZXNzIHRoYXQgdG9rZW5zIHdpbGwgYmUgc2VuZCB0bwogICAgZnVuY3Rpb24gZXh0cmFjdFRva2VucyhhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfY2xhaW1lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgX2NsYWltZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBFUkMyMCB0b2tlbiA9IEVSQzIwKF90b2tlbik7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKF9jbGFpbWVyLCBiYWxhbmNlKTsKICAgICAgICBFeHRyYWN0ZWRUb2tlbnMoX3Rva2VuLCBfY2xhaW1lciwgYmFsYW5jZSk7CiAgICB9Cn0KLyoqCiAqIEB0aXRsZSBSZWZ1bmRWYXVsdAogKiBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCBmb3Igc3RvcmluZyBmdW5kcyB3aGlsZSBhIGNyb3dkc2FsZQogKiBpcyBpbiBwcm9ncmVzcy4gU3VwcG9ydHMgcmVmdW5kaW5nIHRoZSBtb25leSBpZiBjcm93ZHNhbGUgZmFpbHMsCiAqIGFuZCBmb3J3YXJkaW5nIGl0IGlmIGNyb3dkc2FsZSBpcyBzdWNjZXNzZnVsLgogKi8KY29udHJhY3QgUmVmdW5kVmF1bHQgaXMgT3duYWJsZSwgSGFzTm9Ub2tlbnMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIGVudW0gU3RhdGUgeyBBY3RpdmUsIFJlZnVuZGluZywgQ2xvc2VkIH0KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogIFN0YXRlIHB1YmxpYyBzdGF0ZTsKICBldmVudCBDbG9zZWQoKTsKICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwogIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwogIGZ1bmN0aW9uIFJlZnVuZFZhdWx0KGFkZHJlc3MgX3dhbGxldCkgewogICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgfQogIGZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyBpbnZlc3Rvcikgb25seU93bmVyIHB1YmxpYyBwYXlhYmxlIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRbaW52ZXN0b3JdLmFkZChtc2cudmFsdWUpOwogIH0KICBmdW5jdGlvbiBjbG9zZSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7CiAgICBDbG9zZWQoKTsKICAgIHdhbGxldC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogIH0KICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQogIGZ1bmN0aW9uIHJlZnVuZChhZGRyZXNzIGludmVzdG9yKSBwdWJsaWMgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5SZWZ1bmRpbmcpOwogICAgdWludDI1NiBkZXBvc2l0ZWRWYWx1ZSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl07CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gMDsKICAgIGludmVzdG9yLnRyYW5zZmVyKGRlcG9zaXRlZFZhbHVlKTsKICAgIFJlZnVuZGVkKGludmVzdG9yLCBkZXBvc2l0ZWRWYWx1ZSk7CiAgfQp9Ci8qKgogKiBAdGl0bGUgUmVmdW5kYWJsZUNyb3dkc2FsZQogKiBAZGV2IEV4dGVuc2lvbiBvZiBDcm93ZHNhbGUgY29udHJhY3QgdGhhdCBhZGRzIGEgZnVuZGluZyBnb2FsLCBhbmQKICogdGhlIHBvc3NpYmlsaXR5IG9mIHVzZXJzIGdldHRpbmcgYSByZWZ1bmQgaWYgZ29hbCBpcyBub3QgbWV0LgogKiBVc2VzIGEgUmVmdW5kVmF1bHQgYXMgdGhlIGNyb3dkc2FsZSdzIHZhdWx0LgogKi8KY29udHJhY3QgUmVmdW5kYWJsZUNyb3dkc2FsZSBpcyBGaW5hbGl6YWJsZUNyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgLy8gbWluaW11bSBhbW91bnQgb2YgZnVuZHMgdG8gYmUgcmFpc2VkIGluIHdlaXMKICB1aW50MjU2IHB1YmxpYyBnb2FsOwogIC8vIHJlZnVuZCB2YXVsdCB1c2VkIHRvIGhvbGQgZnVuZHMgd2hpbGUgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcKICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CiAgZnVuY3Rpb24gUmVmdW5kYWJsZUNyb3dkc2FsZSh1aW50MjU2IF9nb2FsKSB7CiAgICByZXF1aXJlKF9nb2FsID4gMCk7CiAgICB2YXVsdCA9IG5ldyBSZWZ1bmRWYXVsdCh3YWxsZXQpOwogICAgZ29hbCA9IF9nb2FsOwogIH0KICAvLyBXZSdyZSBvdmVycmlkaW5nIHRoZSBmdW5kIGZvcndhcmRpbmcgZnJvbSBDcm93ZHNhbGUuCiAgLy8gSWYgdGhlIGdvYWwgaXMgcmVhY2hlZCBmb3J3YXJkIHRoZSBmdW5kIHRvIHRoZSB3YWxsZXQsIAogIC8vIG90aGVyd2lzZSBpbiBhZGRpdGlvbiB0byBzZW5kaW5nIHRoZSBmdW5kcywgd2Ugd2FudCB0bwogIC8vIGNhbGwgdGhlIFJlZnVuZFZhdWx0IGRlcG9zaXQgZnVuY3Rpb24KICBmdW5jdGlvbiBmb3J3YXJkRnVuZHModWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHsKICAgIGlmIChnb2FsUmVhY2hlZCgpKQogICAgICB3YWxsZXQudHJhbnNmZXIod2VpQW1vdW50KTsKICAgIGVsc2UKICAgICAgdmF1bHQuZGVwb3NpdC52YWx1ZSh3ZWlBbW91bnQpKG1zZy5zZW5kZXIpOwogIH0KICAvLyBpZiBjcm93ZHNhbGUgaXMgdW5zdWNjZXNzZnVsLCBpbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZHMgaGVyZQogIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgcHVibGljIHsKICAgIHJlcXVpcmUoaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZSghZ29hbFJlYWNoZWQoKSk7CiAgICB2YXVsdC5yZWZ1bmQobXNnLnNlbmRlcik7CiAgfQogIC8vIHZhdWx0IGZpbmFsaXphdGlvbiB0YXNrLCBjYWxsZWQgd2hlbiBvd25lciBjYWxscyBmaW5hbGl6ZSgpCiAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewogICAgaWYgKGdvYWxSZWFjaGVkKCkpIHsKICAgICAgdmF1bHQuY2xvc2UoKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhdWx0LmVuYWJsZVJlZnVuZHMoKTsKICAgIH0KICAgIHN1cGVyLmZpbmFsaXphdGlvbigpOwogIH0KICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gZ29hbDsKICB9Cn0KLy8vIEBkZXYgVGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QgbXVzdCBpbXBsZW1lbnQgdGhlc2UgZnVuY3Rpb25zCmNvbnRyYWN0IFRva2VuQ29udHJvbGxlciB7CiAgICBFUkMyME1pbmlNZSBwdWJsaWMgZXRoZWFsVG9rZW47CiAgICBhZGRyZXNzIHB1YmxpYyBTQUxFOyAvLyBhZGRyZXNzIHdoZXJlIHNhbGUgdG9rZW5zIGFyZSBsb2NhdGVkCiAgICAvLy8gQG5vdGljZSBuZWVkZWQgZm9yIGhvZGxlciBoYW5kbGluZwogICAgZnVuY3Rpb24gYWRkSG9kbGVyU3Rha2UoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX3N0YWtlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBzZXRIb2RsZXJTdGFrZShhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfc3Rha2UpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHNldEhvZGxlclRpbWUodWludDI1NiBfdGltZSkgcHVibGljOwogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMoYm9vbCk7CiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyhib29sKTsKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMoYm9vbCk7Cn0KLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgfQogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9Ci8qKgogKiBAdGl0bGUgRXRoZWFsUHJlU2FsZQogKiBAYXV0aG9yIHRoZXN2ZWQKICogQG5vdGljZSBFdGhlYWwgVG9rZW4gU2FsZSByb3VuZCBvbmUgcHJlc2FsZSBjb250cmFjdCwgd2l0aCBtaW5jYXAgKGdvYWwpLCBzb2Z0Y2FwIGFuZCBoYXJkY2FwIChjYXApCiAqIEBkZXYgVGhpcyBjb250cmFjdCBoYXMgdG8gYmUgZmluYWxpemVkIGJlZm9yZSByZWZ1bmQgb3IgdG9rZW4gY2xhaW1zIGFyZSBlbmFibGVkCiAqLwpjb250cmFjdCBFdGhlYWxQcmVTYWxlIGlzIFBhdXNhYmxlLCBDYXBwZWRDcm93ZHNhbGUsIFJlZnVuZGFibGVDcm93ZHNhbGUgewogICAgLy8gdGhlIHRva2VuIGlzIGhlcmUKICAgIFRva2VuQ29udHJvbGxlciBwdWJsaWMgZXRoZWFsQ29udHJvbGxlcjsKICAgIC8vIGFmdGVyIHJlYWNoaW5nIHt3ZWlSYWlzZWR9ID49IHtzb2Z0Q2FwfSwgdGhlcmUgaXMge3NvZnRDYXBUaW1lfSBzZWNvbmRzIHVudGlsIHRoZSBzYWxlIGNsb3NlcwogICAgLy8ge3NvZnRDYXBDbG9zZX0gY29udGFpbnMgdGhlIGNsb3NpbmcgdGltZQogICAgdWludDI1NiBwdWJsaWMgcmF0ZSA9IDEyNTA7CiAgICB1aW50MjU2IHB1YmxpYyBnb2FsID0gMzMzIGV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgc29mdENhcCA9IDM2MDAgZXRoZXI7CiAgICB1aW50MjU2IHB1YmxpYyBzb2Z0Q2FwVGltZSA9IDEyMCBob3VyczsKICAgIHVpbnQyNTYgcHVibGljIHNvZnRDYXBDbG9zZTsKICAgIHVpbnQyNTYgcHVibGljIGNhcCA9IDcyMDAgZXRoZXI7CiAgICAvLyBob3cgbWFueSB0b2tlbiBpcyBzb2xkIGFuZCBub3QgY2xhaW1lZCwgdXNlZCBmb3IgcmVmdW5kaW5nIHRvIHRva2VuIGNvbnRyb2xsZXIKICAgIHVpbnQyNTYgcHVibGljIHRva2VuQmFsYW5jZTsKICAgIC8vIHRvdGFsIHRva2VuIHNvbGQKICAgIHVpbnQyNTYgcHVibGljIHRva2VuU29sZDsKICAgIC8vIGNvbnRyaWJ1dGluZyBhYm92ZSB7bWF4R2FzUHJpY2V9IHJlc3VsdHMgaW4gCiAgICAvLyBjYWxjdWxhdGluZyBzdGFrZXMgb24ge21heEdhc1ByaWNlUGVuYWx0eX0gLyAxMDAKICAgIC8vIGVnLiA4MCB7bWF4R2FzUHJpY2VQZW5hbHR5fSBtZWFucyA4MCUsIHNlbmRpbmcgNSBFVEggd2l0aCBtb3JlIHRoYW4gMTAwZ3dlaSBnYXMgcHJpY2Ugd2lsbCBiZSBjYWxjdWxhdGVkIGFzIDQgRVRICiAgICB1aW50MjU2IHB1YmxpYyBtYXhHYXNQcmljZSA9IDEwMCAqIDEwKio5OwogICAgdWludDI1NiBwdWJsaWMgbWF4R2FzUHJpY2VQZW5hbHR5ID0gODA7CiAgICAvLyBtaW5pbXVtIGNvbnRyaWJ1dGlvbiwgMC4xRVRICiAgICB1aW50MjU2IHB1YmxpYyBtaW5Db250cmlidXRpb24gPSAwLjEgZXRoZXI7CiAgICAvLyBmaXJzdCB7d2hpdGVsaXN0RGF5Q291bnR9IGRheXMgb2YgdG9rZW4gc2FsZSBpcyBleGNsdXNpdmUgZm9yIHdoaXRlbGlzdGVkIGFkZHJlc3NlcwogICAgLy8ge3doaXRlbGlzdERheU1heFN0YWtlfSBjb250YWlucyB0aGUgbWF4IHN0YWtlIGxpbWl0cyBwZXIgYWRkcmVzcyBmb3IgZWFjaCB3aGl0ZWxpc3Qgc2FsZXMgZGF5CiAgICAvLyB7d2hpdGVsaXN0fSBjb250YWlucyB3aG8gY2FuIGNvbnRyaWJ1dGUgZHVyaW5nIHdoaXRlbGlzdCBwZXJpb2QKICAgIHVpbnQ4IHB1YmxpYyB3aGl0ZWxpc3REYXlDb3VudDsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHdoaXRlbGlzdDsKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IHVpbnQyNTYpIHB1YmxpYyB3aGl0ZWxpc3REYXlNYXhTdGFrZTsKICAgIAogICAgLy8gc3Rha2VzIGNvbnRhaW5zIGNvbnRyaWJ1dGlvbiBzdGFrZSBpbiB3ZWkKICAgIC8vIGNvbnRyaWJ1dGVkIEVUSCBpcyBjYWxjdWxhdGVkIG9uIDgwJSB3aGVuIHNlbmRpbmcgZnVuZHMgd2l0aCBnYXNwcmljZSBhYm92ZSBtYXhHYXNQcmljZQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgc3Rha2VzOwogICAgLy8gYWRkcmVzc2VzIG9mIGNvbnRyaWJ1dG9ycyB0byBoYW5kbGUgZmluYWxpemF0aW9uIGFmdGVyIHRva2VuIHNhbGUgZW5kIChyZWZ1bmRzIG9yIHRva2VuIGNsYWltcykKICAgIGFkZHJlc3NbXSBwdWJsaWMgY29udHJpYnV0b3JzS2V5czsgCiAgICAvLyBldmVudHMgZm9yIHRva2VuIHB1cmNoYXNlIGR1cmluZyBzYWxlIGFuZCBjbGFpbWluZyB0b2tlbnMgYWZ0ZXIgc2FsZQogICAgZXZlbnQgVG9rZW5DbGFpbWVkKGFkZHJlc3MgaW5kZXhlZCBfY2xhaW1lciwgYWRkcmVzcyBpbmRleGVkIF9iZW5lZmljaWFyeSwgdWludDI1NiBfc3Rha2UsIHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBfcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF92YWx1ZSwgdWludDI1NiBfc3Rha2UsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfcGFydGljaXBhbnRzLCB1aW50MjU2IF93ZWlSYWlzZWQpOwogICAgZXZlbnQgVG9rZW5Hb2FsUmVhY2hlZCgpOwogICAgZXZlbnQgVG9rZW5Tb2Z0Q2FwUmVhY2hlZCh1aW50MjU2IF9jbG9zZVRpbWUpOwogICAgLy8gd2hpdGVsaXN0IGV2ZW50cyBmb3IgYWRkaW5nIGRheXMgd2l0aCBtYXhpbXVtIHN0YWtlcyBhbmQgYWRkcmVzc2VzCiAgICBldmVudCBXaGl0ZWxpc3RBZGRyZXNzQWRkZWQoYWRkcmVzcyBpbmRleGVkIF93aGl0ZWxpc3RlciwgYWRkcmVzcyBpbmRleGVkIF9iZW5lZmljaWFyeSk7CiAgICBldmVudCBXaGl0ZWxpc3RBZGRyZXNzUmVtb3ZlZChhZGRyZXNzIGluZGV4ZWQgX3doaXRlbGlzdGVyLCBhZGRyZXNzIGluZGV4ZWQgX2JlbmVmaWNpYXJ5KTsKICAgIGV2ZW50IFdoaXRlbGlzdFNldERheShhZGRyZXNzIGluZGV4ZWQgX3doaXRlbGlzdGVyLCB1aW50OCBfZGF5LCB1aW50MjU2IF9tYXhTdGFrZSk7CiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25zdHJ1Y3RvciBhbmQgaW5oZXJpdGVkIGZ1bmN0aW9uIG92ZXJyaWRlcwogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIFByZVNhbGUgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2V0aGVhbENvbnRyb2xsZXIgQWRkcmVzcyBvZiBldGhlYWxDb250cm9sbGVyCiAgICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgVGhlIHN0YXJ0IHRpbWUgb2YgdG9rZW4gc2FsZSBpbiBzZWNvbmRzLgogICAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaGUgZW5kIHRpbWUgb2YgdG9rZW4gc2FsZSBpbiBzZWNvbmRzLgogICAgLy8vIEBwYXJhbSBfbWluQ29udHJpYnV0aW9uIFRoZSBtaW5pbXVtIGNvbnRyaWJ1dGlvbiBwZXIgdHJhbnNhY3Rpb24gaW4gd2VpICgwLjEgRVRIKQogICAgLy8vIEBwYXJhbSBfcmF0ZSBOdW1iZXIgb2YgSEVBTCB0b2tlbnMgcGVyIDEgRVRICiAgICAvLy8gQHBhcmFtIF9nb2FsIE1pbmltdW0gZnVuZGluZyBpbiB3ZWksIGJlbG93IHRoYXQgRVZFUllPTkUgZ2V0cyBiYWNrIEFMTCB0aGVpcgogICAgLy8vICBjb250cmlidXRpb25zIHJlZ2FyZGxlc3Mgb2YgbWF4R2FzUHJpY2UgcGVuYWx0eS4gCiAgICAvLy8gIEVnLiBzb21lb25lIGNvbnRyaWJ1dGVzIHdpdGggNSBFVEgsIGJ1dCBnZXRzIG9ubHkgNCBFVEggc3Rha2VzIGJlY2F1c2UKICAgIC8vLyAgc2VuZGluZyBmdW5kcyB3aXRoIGdhc3ByaWNlIG92ZXIgMTAwR3dlaSwgaGUgd2lsbCBzdGlsbCBnZXQgYmFjayA+PjUgRVRIPDwKICAgIC8vLyAgaW4gY2FzZSBvZiB1bnN1Y2Nlc3NmdWwgdG9rZW4gc2FsZQogICAgLy8vIEBwYXJhbSBfc29mdENhcCBTb2Z0Y2FwIGluIHdlaSwgcmVhY2hpbmcgaXQgZW5kcyB0aGUgc2FsZSBpbiBfc29mdENhcFRpbWUgc2Vjb25kcwogICAgLy8vIEBwYXJhbSBfc29mdENhcFRpbWUgU2Vjb25kcyB1bnRpbCB0aGUgc2FsZSByZW1haW5zIG9wZW4gYWZ0ZXIgcmVhY2hpbmcgX3NvZnRDYXAKICAgIC8vLyBAcGFyYW0gX2NhcCBNYXhpbXVtIGNhcCBpbiB3ZWksIHdlIGNhbid0IHJhaXNlIG1vcmUgZnVuZHMKICAgIC8vLyBAcGFyYW0gX2dhc1ByaWNlIE1heGltdW0gZ2FzIHByaWNlCiAgICAvLy8gQHBhcmFtIF9nYXNQZW5hbHR5IFBlbmFsdHkgaW4gcGVyY2VudGFnZSBwb2ludHMgZm9yIGNhbGN1bGF0aW5nIHN0YWtlcywgZWcuIDgwIG1lYW5zIGNhbGN1bGF0aW5nIAogICAgLy8vICBzdGFrZXMgb24gODAlIGlmIGdhc3ByaWNlIHdhcyBoaWdoZXIgdGhhbiBfZ2FzUHJpY2UKICAgIC8vLyBAcGFyYW0gX3dhbGxldCBBZGRyZXNzIG9mIG11bHRpc2lnIHdhbGxldCwgd2hpY2ggd2lsbCBnZXQgYWxsIHRoZSBmdW5kcyBhZnRlciBzdWNjZXNzZnVsIHNhbGUKICAgIGZ1bmN0aW9uIEV0aGVhbFByZVNhbGUoCiAgICAgICAgYWRkcmVzcyBfZXRoZWFsQ29udHJvbGxlciwKICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUsIAogICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsIAogICAgICAgIHVpbnQyNTYgX21pbkNvbnRyaWJ1dGlvbiwgCiAgICAgICAgdWludDI1NiBfcmF0ZSwgCiAgICAgICAgdWludDI1NiBfZ29hbCwgCiAgICAgICAgdWludDI1NiBfc29mdENhcCwgCiAgICAgICAgdWludDI1NiBfc29mdENhcFRpbWUsIAogICAgICAgIHVpbnQyNTYgX2NhcCwgCiAgICAgICAgdWludDI1NiBfZ2FzUHJpY2UsIAogICAgICAgIHVpbnQyNTYgX2dhc1BlbmFsdHksIAogICAgICAgIGFkZHJlc3MgX3dhbGxldAogICAgKQogICAgICAgIENhcHBlZENyb3dkc2FsZShfY2FwKQogICAgICAgIEZpbmFsaXphYmxlQ3Jvd2RzYWxlKCkKICAgICAgICBSZWZ1bmRhYmxlQ3Jvd2RzYWxlKF9nb2FsKQogICAgICAgIENyb3dkc2FsZShfc3RhcnRUaW1lLCBfZW5kVGltZSwgX3JhdGUsIF93YWxsZXQpCiAgICB7CiAgICAgICAgLy8gZXRoZWFsQ29udHJvbGxlciBtdXN0IGJlIHZhbGlkCiAgICAgICAgcmVxdWlyZShfZXRoZWFsQ29udHJvbGxlciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBldGhlYWxDb250cm9sbGVyID0gVG9rZW5Db250cm9sbGVyKF9ldGhlYWxDb250cm9sbGVyKTsKICAgICAgICAvLyBjYXBzIGhhdmUgdG8gYmUgY29uc2lzdGVudCB3aXRoIGVhY2ggb3RoZXIKICAgICAgICByZXF1aXJlKF9nb2FsIDw9IF9zb2Z0Q2FwICYmIF9zb2Z0Q2FwIDw9IF9jYXApOwogICAgICAgIHNvZnRDYXAgPSBfc29mdENhcDsKICAgICAgICBzb2Z0Q2FwVGltZSA9IF9zb2Z0Q2FwVGltZTsKICAgICAgICAvLyB0aGlzIGlzIG5lZWRlZCBzaW5jZSBzdXBlciBjb25zdHJ1Y3RvciB3b250IG92ZXJ3aXRlIG92ZXJyaWRlbiB2YXJpYWJsZXMKICAgICAgICBjYXAgPSBfY2FwOwogICAgICAgIGdvYWwgPSBfZ29hbDsKICAgICAgICByYXRlID0gX3JhdGU7CiAgICAgICAgbWF4R2FzUHJpY2UgPSBfZ2FzUHJpY2U7CiAgICAgICAgbWF4R2FzUHJpY2VQZW5hbHR5ID0gX2dhc1BlbmFsdHk7CiAgICAgICAgbWluQ29udHJpYnV0aW9uID0gX21pbkNvbnRyaWJ1dGlvbjsKICAgIH0KICAgIC8vLyBAZGV2IE92ZXJyaWRpbmcgQ3Jvd2RzYWxlI2J1eVRva2VucyB0byBhZGQgcGFydGlhbCByZWZ1bmQgYW5kIHNvZnRjYXAgbG9naWMgCiAgICAvLy8gQHBhcmFtIF9iZW5lZmljaWFyeSBCZW5lZmljaWFyeSBvZiB0aGUgdG9rZW4gcHVyY2hhc2UKICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIF9iZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgdWludDI1NiB3ZWlUb0NhcCA9IGhvd011Y2hDYW5YQ29udHJpYnV0ZU5vdyhfYmVuZWZpY2lhcnkpOwogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gdWludDI1Nk1pbih3ZWlUb0NhcCwgbXNnLnZhbHVlKTsKICAgICAgICAvLyBnb2FsIGlzIHJlYWNoZWQKICAgICAgICBpZiAod2VpUmFpc2VkIDwgZ29hbCAmJiB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCkgPj0gZ29hbCkgewogICAgICAgICAgICBUb2tlbkdvYWxSZWFjaGVkKCk7CiAgICAgICAgfQogICAgICAgIC8vIGNhbGwgdGhlIENyb3dkc2FsZSNidXlUb2tlbnMgaW50ZXJuYWwgZnVuY3Rpb24KICAgICAgICBidXlUb2tlbnMoX2JlbmVmaWNpYXJ5LCB3ZWlBbW91bnQpOwogICAgICAgIC8vIGNsb3NlIHNhbGUgaW4gc29mdENhcFRpbWUgc2Vjb25kcyBhZnRlciByZWFjaGluZyBzb2Z0Q2FwCiAgICAgICAgaWYgKHdlaVJhaXNlZCA+PSBzb2Z0Q2FwICYmIHNvZnRDYXBDbG9zZSA9PSAwKSB7CiAgICAgICAgICAgIHNvZnRDYXBDbG9zZSA9IG5vdy5hZGQoc29mdENhcFRpbWUpOwogICAgICAgICAgICBUb2tlblNvZnRDYXBSZWFjaGVkKHVpbnQyNTZNaW4oc29mdENhcENsb3NlLCBlbmRUaW1lKSk7CiAgICAgICAgfQogICAgICAgIC8vIGhhbmRsZSByZWZ1bmQKICAgICAgICB1aW50MjU2IHJlZnVuZCA9IG1zZy52YWx1ZS5zdWIod2VpQW1vdW50KTsKICAgICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZCk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgT3ZlcnJpZGluZyBDcm93ZHNhbGUjdHJhbnNmZXJUb2tlbiwgd2hpY2gga2VlcHMgdHJhY2sgb2YgY29udHJpYnV0aW9ucyBEVVJJTkcgdG9rZW4gc2FsZQogICAgLy8vIEBwYXJhbSBfYmVuZWZpY2lhcnkgQWRkcmVzcyBvZiB0aGUgcmVjZXBpZW50IG9mIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3dlaUFtb3VudCBDb250cmlidXRpb24gaW4gd2VpCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF93ZWlBbW91bnQpIGludGVybmFsIHsKICAgICAgICByZXF1aXJlKF9iZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgICAgICB1aW50MjU2IHdlaUFtb3VudCA9IF93ZWlBbW91bnQ7CiAgICAgICAgLy8gY2hlY2sgbWF4R2FzUHJpY2VQZW5hbHR5CiAgICAgICAgaWYgKG1heEdhc1ByaWNlID4gMCAmJiB0eC5nYXNwcmljZSA+IG1heEdhc1ByaWNlKSB7CiAgICAgICAgICAgIHdlaUFtb3VudCA9IHdlaUFtb3VudC5tdWwobWF4R2FzUHJpY2VQZW5hbHR5KS5kaXYoMTAwKTsKICAgICAgICB9CiAgICAgICAgLy8gY2FsY3VsYXRlIHRva2Vucywgc28gd2UgY2FuIHJlZnVuZCBleGNlc3MgdG9rZW5zIHRvIEV0aGVhbENvbnRyb2xsZXIgYWZ0ZXIgdG9rZW4gc2FsZQogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlKTsKICAgICAgICB0b2tlbkJhbGFuY2UgPSB0b2tlbkJhbGFuY2UuYWRkKHRva2Vucyk7CiAgICAgICAgaWYgKHN0YWtlc1tfYmVuZWZpY2lhcnldID09IDApIHsKICAgICAgICAgICAgY29udHJpYnV0b3JzS2V5cy5wdXNoKF9iZW5lZmljaWFyeSk7CiAgICAgICAgfQogICAgICAgIHN0YWtlc1tfYmVuZWZpY2lhcnldID0gc3Rha2VzW19iZW5lZmljaWFyeV0uYWRkKHdlaUFtb3VudCk7CiAgICAgICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBfYmVuZWZpY2lhcnksIF93ZWlBbW91bnQsIHdlaUFtb3VudCwgdG9rZW5zLCBjb250cmlidXRvcnNLZXlzLmxlbmd0aCwgd2VpUmFpc2VkKTsKICAgIH0KICAgIC8vLyBAZGV2IE92ZXJyaWRpbmcgQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gYWRkIG1pbiBjb250cmlidXRpb24gbG9naWMKICAgIC8vLyBAcGFyYW0gX3dlaUFtb3VudCBDb250cmlidXRpb24gYW1vdW50IGluIHdlaQogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBjb250cmlidXRpb24gaXMgb2theQogICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSh1aW50MjU2IF93ZWlBbW91bnQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci52YWxpZFB1cmNoYXNlKF93ZWlBbW91bnQpICYmIF93ZWlBbW91bnQgPj0gbWluQ29udHJpYnV0aW9uOwogICAgfQogICAgLy8vIEBkZXYgT3ZlcnJpZGluZyBDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIHNvZnQgY2FwIGxvZ2ljCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBldmVudCBoYXMgZW5kZWQgb3IgYSBzb2Z0Q2FwQ2xvc2UgdGltZSBpcyBzZXQgYW5kIHBhc3NlZAogICAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmhhc0VuZGVkKCkgfHwgc29mdENhcENsb3NlID4gMCAmJiBub3cgPiBzb2Z0Q2FwQ2xvc2U7CiAgICB9CiAgICAvLy8gQGRldiBPdmVycmlkaW5nIFJlZnVuZGFibGVDcm93ZHNhbGUjY2xhaW1SZWZ1bmQgdG8gZW5hYmxlIGFueW9uZSB0byBjYWxsIGZvciBhbnkgYWRkcmVzcwogICAgLy8vICB3aGljaCBlbmFibGVzIHVzIHRvIHJlZnVuZCBhbnlvbmUgYW5kIGFsc28gYW55b25lIGNhbiByZWZ1bmQgdGhlbXNlbHZlcwogICAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoKSBwdWJsaWMgewogICAgICAgIGNsYWltUmVmdW5kRm9yKG1zZy5zZW5kZXIpOwogICAgfQogICAgLy8vIEBkZXYgRXh0ZW5kaW5nIFJlZnVuZGFibGVDcm93ZHNhbGUjZmluYWxpemF0aW9uIHNlbmRpbmcgYmFjayBleGNlc3MgdG9rZW5zIHRvIGV0aGVhbENvbnRyb2xsZXIKICAgIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICAgICAgICB1aW50MjU2IF9iYWxhbmNlID0gZ2V0SGVhbEJhbGFuY2UoKTsKICAgICAgICAvLyBpZiB0b2tlbiBzYWxlIHdhcyBzdWNjZXNzZnVsIHNlbmQgYmFjayBleGNlc3MgZnVuZHMKICAgICAgICBpZiAoZ29hbFJlYWNoZWQoKSkgewogICAgICAgICAgICAvLyBzYXZpbmcgdG9rZW4gYmFsYW5jZSBmb3IgZnV0dXJlIHJlZmVyZW5jZQogICAgICAgICAgICB0b2tlblNvbGQgPSB0b2tlbkJhbGFuY2U7IAogICAgICAgICAgICAvLyBzZW5kIGJhY2sgdGhlIGV4Y2VzcyB0b2tlbiB0byBldGhlYWxDb250cm9sbGVyCiAgICAgICAgICAgIGlmIChfYmFsYW5jZSA+IHRva2VuQmFsYW5jZSkgewogICAgICAgICAgICAgICAgZXRoZWFsQ29udHJvbGxlci5ldGhlYWxUb2tlbigpLnRyYW5zZmVyKGV0aGVhbENvbnRyb2xsZXIuU0FMRSgpLCBfYmFsYW5jZS5zdWIodG9rZW5CYWxhbmNlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCFnb2FsUmVhY2hlZCgpICYmIF9iYWxhbmNlID4gMCkgewogICAgICAgICAgICAvLyBpZiB0b2tlbiBzYWxlIGlzIGZhaWxlZCwgdGhlbiBzZW5kIGJhY2sgYWxsIHRva2VucyB0byBldGhlYWxDb250cm9sbGVyJ3Mgc2FsZSBhZGRyZXNzCiAgICAgICAgICAgIHRva2VuQmFsYW5jZSA9IDA7CiAgICAgICAgICAgIGV0aGVhbENvbnRyb2xsZXIuZXRoZWFsVG9rZW4oKS50cmFuc2ZlcihldGhlYWxDb250cm9sbGVyLlNBTEUoKSwgX2JhbGFuY2UpOwogICAgICAgIH0KICAgICAgICBzdXBlci5maW5hbGl6YXRpb24oKTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEJFRk9SRSB0b2tlbiBzYWxlCiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQG5vdGljZSBNb2RpZmllciBmb3IgYmVmb3JlIHNhbGUgY2FzZXMKICAgIG1vZGlmaWVyIGJlZm9yZVNhbGUoKSB7CiAgICAgICAgcmVxdWlyZSghaGFzU3RhcnRlZCgpKTsKICAgICAgICBfOwogICAgfQogICAgLy8vIEBub3RpY2UgU2V0cyB3aGl0ZWxpc3QKICAgIC8vLyBAZGV2IFRoZSBsZW5ndGggb2YgX3doaXRlbGlzdExpbWl0cyBzYXlzIHRoYXQgdGhlIGZpcnN0IFggZGF5cyBvZiB0b2tlbiBzYWxlIGlzIAogICAgLy8vICBjbG9zZWQsIG1lYW5pbmcgb25seSBmb3Igd2hpdGVsaXN0ZWQgYWRkcmVzc2VzLgogICAgLy8vIEBwYXJhbSBfYWRkIEFycmF5IG9mIGFkZHJlc3NlcyB0byBhZGQgdG8gd2hpdGVsaXN0ZWQgZXRoZXJldW0gYWNjb3VudHMKICAgIC8vLyBAcGFyYW0gX3JlbW92ZSBBcnJheSBvZiBhZGRyZXNzZXMgdG8gcmVtb3ZlIHRvIHdoaXRlbGlzdGVkIGV0aGVyZXVtIGFjY291bnRzCiAgICAvLy8gQHBhcmFtIF93aGl0ZWxpc3RMaW1pdHMgQXJyYXkgb2YgbGltaXRzIGluIHdlaSwgd2hlcmUgX3doaXRlbGlzdExpbWl0c1swXSA9IDEwIEVUSCBtZWFucwogICAgLy8vICB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMgY2FuIGNvbnRyaWJ1dGUgbWF4aW11bSAxMCBFVEggc3Rha2VzIG9uIHRoZSBmaXJzdCBkYXkKICAgIC8vLyAgQWZ0ZXIgX3doaXRlbGlzdExpbWl0cy5sZW5ndGggZGF5cywgdGhlcmUgd2lsbCBiZSBubyBsaW1pdHMgcGVyIGFkZHJlc3MgKGJlc2lkZXMgaGFyZCBjYXApCiAgICBmdW5jdGlvbiBzZXRXaGl0ZWxpc3QoYWRkcmVzc1tdIF9hZGQsIGFkZHJlc3NbXSBfcmVtb3ZlLCB1aW50MjU2W10gX3doaXRlbGlzdExpbWl0cykgcHVibGljIG9ubHlPd25lciBiZWZvcmVTYWxlIHsKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIHVpbnQ4IGogPSAwOyAvLyBhY2Nlc3MgbWF4IGRhaWx5IHN0YWtlcwogICAgICAgIC8vIHdlIG92ZXJyaWRlIHdoaXRlTGlzdExpbWl0cyBvbmx5IGlmIGl0IHdhcyBzdXBwbGllZCBhcyBhbiBhcmd1bWVudAogICAgICAgIGlmIChfd2hpdGVsaXN0TGltaXRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gc2F2aW5nIHdoaXRlbGlzdCBtYXggc3Rha2UgbGltaXRzIGZvciBlYWNoIGRheSAtPiB1aW50MjU2IG1heFN0YWtlTGltaXQKICAgICAgICAgICAgd2hpdGVsaXN0RGF5Q291bnQgPSB1aW50OChfd2hpdGVsaXN0TGltaXRzLmxlbmd0aCk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBfd2hpdGVsaXN0TGltaXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBqID0gdWludDgoaS5hZGQoMSkpOwogICAgICAgICAgICAgICAgaWYgKHdoaXRlbGlzdERheU1heFN0YWtlW2pdICE9IF93aGl0ZWxpc3RMaW1pdHNbaV0pIHsKICAgICAgICAgICAgICAgICAgICB3aGl0ZWxpc3REYXlNYXhTdGFrZVtqXSA9IF93aGl0ZWxpc3RMaW1pdHNbaV07CiAgICAgICAgICAgICAgICAgICAgV2hpdGVsaXN0U2V0RGF5KG1zZy5zZW5kZXIsIGosIF93aGl0ZWxpc3RMaW1pdHNbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIGFkZGluZyB3aGl0ZWxpc3QgYWRkcmVzc2VzCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9hZGQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcmVxdWlyZShfYWRkW2ldICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCF3aGl0ZWxpc3RbX2FkZFtpXV0pIHsKICAgICAgICAgICAgICAgIHdoaXRlbGlzdFtfYWRkW2ldXSA9IHRydWU7CiAgICAgICAgICAgICAgICBXaGl0ZWxpc3RBZGRyZXNzQWRkZWQobXNnLnNlbmRlciwgX2FkZFtpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gcmVtb3Zpbmcgd2hpdGVsaXN0IGFkZHJlc3NlcwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfcmVtb3ZlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUoX3JlbW92ZVtpXSAhPSBhZGRyZXNzKDApKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh3aGl0ZWxpc3RbX3JlbW92ZVtpXV0pIHsKICAgICAgICAgICAgICAgIHdoaXRlbGlzdFtfcmVtb3ZlW2ldXSA9IGZhbHNlOwogICAgICAgICAgICAgICAgV2hpdGVsaXN0QWRkcmVzc1JlbW92ZWQobXNnLnNlbmRlciwgX3JlbW92ZVtpXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAvLy8gQG5vdGljZSBTZXRzIG1heCBnYXMgcHJpY2UgYW5kIHBlbmFsdHkgYmVmb3JlIHNhbGUKICAgIGZ1bmN0aW9uIHNldE1heEdhcyh1aW50MjU2IF9tYXhHYXMsIHVpbnQyNTYgX3BlbmFsdHkpIHB1YmxpYyBvbmx5T3duZXIgYmVmb3JlU2FsZSB7CiAgICAgICAgbWF4R2FzUHJpY2UgPSBfbWF4R2FzOwogICAgICAgIG1heEdhc1ByaWNlUGVuYWx0eSA9IF9wZW5hbHR5OwogICAgfQogICAgLy8vIEBub3RpY2UgU2V0cyBtaW4gY29udHJpYnV0aW9uIGJlZm9yZSBzYWxlCiAgICBmdW5jdGlvbiBzZXRNaW5Db250cmlidXRpb24odWludDI1NiBfbWluQ29udHJpYnV0aW9uKSBwdWJsaWMgb25seU93bmVyIGJlZm9yZVNhbGUgewogICAgICAgIG1pbkNvbnRyaWJ1dGlvbiA9IF9taW5Db250cmlidXRpb247CiAgICB9CiAgICAvLy8gQG5vdGljZSBTZXRzIG1pbmltdW0gZ29hbCwgc29mdCBjYXAgYW5kIG1heCBjYXAKICAgIGZ1bmN0aW9uIHNldENhcHModWludDI1NiBfZ29hbCwgdWludDI1NiBfc29mdENhcCwgdWludDI1NiBfc29mdENhcFRpbWUsIHVpbnQyNTYgX2NhcCkgcHVibGljIG9ubHlPd25lciBiZWZvcmVTYWxlIHsKICAgICAgICByZXF1aXJlKDAgPCBfZ29hbCAmJiBfZ29hbCA8PSBfc29mdENhcCAmJiBfc29mdENhcCA8PSBfY2FwKTsKICAgICAgICBnb2FsID0gX2dvYWw7CiAgICAgICAgc29mdENhcCA9IF9zb2Z0Q2FwOwogICAgICAgIHNvZnRDYXBUaW1lID0gX3NvZnRDYXBUaW1lOwogICAgICAgIGNhcCA9IF9jYXA7CiAgICB9CiAgICAvLy8gQG5vdGljZSBTZXRzIGNyb3dkc2FsZSBzdGFydCBhbmQgZW5kIHRpbWUKICAgIGZ1bmN0aW9uIHNldFRpbWVzKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSkgcHVibGljIG9ubHlPd25lciBiZWZvcmVTYWxlIHsKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPiBub3cgJiYgX3N0YXJ0VGltZSA8IF9lbmRUaW1lKTsKICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIH0KICAgIC8vLyBAbm90aWNlIFNldCByYXRlCiAgICBmdW5jdGlvbiBzZXRSYXRlKHVpbnQyNTYgX3JhdGUpIHB1YmxpYyBvbmx5T3duZXIgYmVmb3JlU2FsZSB7CiAgICAgICAgcmVxdWlyZShfcmF0ZSA+IDApOwogICAgICAgIHJhdGUgPSBfcmF0ZTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEFGVEVSIHRva2VuIHNhbGUKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAbm90aWNlIE1vZGlmaWVyIGZvciBjYXNlcyB3aGVyZSBzYWxlIGlzIGZhaWxlZAogICAgLy8vIEBkZXYgSXQgY2hlY2tzIHdoZXRoZXIgd2UgaGF2ZW4ndCByZWFjaCB0aGUgbWluaW11bSBnb2FsIEFORCB3aGV0aGVyIHRoZSBjb250cmFjdCBpcyBmaW5hbGl6ZWQKICAgIG1vZGlmaWVyIGFmdGVyU2FsZUZhaWwoKSB7CiAgICAgICAgcmVxdWlyZSghZ29hbFJlYWNoZWQoKSAmJiBpc0ZpbmFsaXplZCk7CiAgICAgICAgXzsKICAgIH0KICAgIC8vLyBAbm90aWNlIE1vZGlmaWVyIGZvciBjYXNlcyB3aGVyZSBzYWxlIGlzIGNsb3NlZCBhbmQgd2FzIHN1Y2Nlc3NmdWwuCiAgICAvLy8gQGRldiBJdCBjaGVja3Mgd2hldGhlcgogICAgLy8vICB0aGUgc2FsZSBoYXMgZW5kZWQgCiAgICAvLy8gIGFuZCB3ZSBoYXZlIHJlYWNoZWQgb3VyIGdvYWwKICAgIC8vLyAgQU5EIHdoZXRoZXIgdGhlIGNvbnRyYWN0IGlzIGZpbmFsaXplZAogICAgbW9kaWZpZXIgYWZ0ZXJTYWxlU3VjY2VzcygpIHsKICAgICAgICByZXF1aXJlKGdvYWxSZWFjaGVkKCkgJiYgaXNGaW5hbGl6ZWQpOwogICAgICAgIF87CiAgICB9CiAgICAvLy8gQG5vdGljZSBNb2RpZmllciBmb3IgYWZ0ZXIgc2FsZSBmaW5hbGl6YXRpb24KICAgIG1vZGlmaWVyIGFmdGVyU2FsZSgpIHsKICAgICAgICByZXF1aXJlKGlzRmluYWxpemVkKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZWZ1bmQgYW4gZXRoZXJldW0gYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfYmVuZWZpY2lhcnkgQWRkcmVzcyB3ZSB3YW50IHRvIHJlZnVuZAogICAgZnVuY3Rpb24gY2xhaW1SZWZ1bmRGb3IoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBhZnRlclNhbGVGYWlsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHZhdWx0LnJlZnVuZChfYmVuZWZpY2lhcnkpOwogICAgfQogICAgLy8vIEBub3RpY2UgUmVmdW5kIHNldmVyYWwgYWRkcmVzc2VzIHdpdGggb25lIGNhbGwKICAgIC8vLyBAcGFyYW0gX2JlbmVmaWNpYXJpZXMgQXJyYXkgb2YgYWRkcmVzc2VzIHdlIHdhbnQgdG8gcmVmdW5kCiAgICBmdW5jdGlvbiBjbGFpbVJlZnVuZHNGb3IoYWRkcmVzc1tdIF9iZW5lZmljaWFyaWVzKSBleHRlcm5hbCBhZnRlclNhbGVGYWlsIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfYmVuZWZpY2lhcmllcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjbGFpbVJlZnVuZEZvcihfYmVuZWZpY2lhcmllc1tpXSk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBub3RpY2UgQ2xhaW0gdG9rZW4gZm9yIG1zZy5zZW5kZXIgYWZ0ZXIgdG9rZW4gc2FsZSBiYXNlZCBvbiBzdGFrZS4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW4oKSBwdWJsaWMgYWZ0ZXJTYWxlU3VjY2VzcyB7CiAgICAgICAgY2xhaW1Ub2tlbkZvcihtc2cuc2VuZGVyKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIENsYWltIHRva2VuIGFmdGVyIHRva2VuIHNhbGUgYmFzZWQgb24gc3Rha2UuCiAgICAvLy8gQGRldiBBbnlvbmUgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiBhbmQgZGlzdHJpYnV0ZSB0b2tlbnMgYWZ0ZXIgc3VjY2Vzc2Z1bCB0b2tlbiBzYWxlCiAgICAvLy8gQHBhcmFtIF9iZW5lZmljaWFyeSBBZGRyZXNzIG9mIHRoZSBiZW5lZmljaWFyeSB3aG8gZ2V0cyB0aGUgdG9rZW4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5Gb3IoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBhZnRlclNhbGVTdWNjZXNzIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQyNTYgc3Rha2UgPSBzdGFrZXNbX2JlbmVmaWNpYXJ5XTsKICAgICAgICByZXF1aXJlKHN0YWtlID4gMCk7CiAgICAgICAgLy8gc2V0IHRoZSBzdGFrZSAwIGZvciBiZW5lZmljaWFyeQogICAgICAgIHN0YWtlc1tfYmVuZWZpY2lhcnldID0gMDsKICAgICAgICAvLyBjYWxjdWxhdGUgdG9rZW4gY291bnQKICAgICAgICB1aW50MjU2IHRva2VucyA9IHN0YWtlLm11bChyYXRlKTsKICAgICAgICAvLyBkZWNyZWFzZSB0b2tlbkJhbGFuY2UsIHRvIG1ha2UgaXQgcG9zc2libGUgdG8gd2l0aGRyYXcgZXhjZXNzIEhFQUwgZnVuZHMKICAgICAgICB0b2tlbkJhbGFuY2UgPSB0b2tlbkJhbGFuY2Uuc3ViKHRva2Vucyk7CiAgICAgICAgLy8gZGlzdHJpYnV0ZSBob2RsciBzdGFrZQogICAgICAgIGV0aGVhbENvbnRyb2xsZXIuYWRkSG9kbGVyU3Rha2UoX2JlbmVmaWNpYXJ5LCB0b2tlbnMubXVsKDIpKTsKICAgICAgICAvLyBkaXN0cmlidXRlIHRva2VuCiAgICAgICAgcmVxdWlyZShldGhlYWxDb250cm9sbGVyLmV0aGVhbFRva2VuKCkudHJhbnNmZXIoX2JlbmVmaWNpYXJ5LCB0b2tlbnMpKTsKICAgICAgICBUb2tlbkNsYWltZWQobXNnLnNlbmRlciwgX2JlbmVmaWNpYXJ5LCBzdGFrZSwgdG9rZW5zKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIGNsYWltVG9rZW4oKSBmb3IgbXVsdGlwbGUgYWRkcmVzc2VzCiAgICAvLy8gQGRldiBBbnlvbmUgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiBhbmQgZGlzdHJpYnV0ZSB0b2tlbnMgYWZ0ZXIgc3VjY2Vzc2Z1bCB0b2tlbiBzYWxlCiAgICAvLy8gQHBhcmFtIF9iZW5lZmljaWFyaWVzIEFycmF5IG9mIGFkZHJlc3NlcyBmb3Igd2hpY2ggd2Ugd2FudCB0byBjbGFpbSB0b2tlbnMKICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zRm9yKGFkZHJlc3NbXSBfYmVuZWZpY2lhcmllcykgZXh0ZXJuYWwgYWZ0ZXJTYWxlU3VjY2VzcyB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2JlbmVmaWNpYXJpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xhaW1Ub2tlbkZvcihfYmVuZWZpY2lhcmllc1tpXSk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBub3RpY2UgR2V0IGJhY2sgYWNjaWRlbnRhbGx5IHNlbnQgdG9rZW4gZnJvbSB0aGUgdmF1bHQKICAgIGZ1bmN0aW9uIGV4dHJhY3RWYXVsdFRva2VucyhhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfY2xhaW1lcikgcHVibGljIG9ubHlPd25lciBhZnRlclNhbGUgewogICAgICAgIC8vIGl0IGhhcyB0byBoYXZlIGEgdmFsaWQgY2xhaW1lciwgYW5kIGVpdGhlciB0aGUgZ29hbCBoYXMgdG8gYmUgcmVhY2hlZCBvciB0aGUgdG9rZW4gY2FuIGJlIDAgd2hpY2ggbWVhbnMgd2UgY2FuJ3QgZXh0cmFjdCBldGhlciBpZiB0aGUgZ29hbCBpcyBub3QgcmVhY2hlZAogICAgICAgIHJlcXVpcmUoX2NsYWltZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShnb2FsUmVhY2hlZCgpIHx8IF90b2tlbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICB2YXVsdC5leHRyYWN0VG9rZW5zKF90b2tlbiwgX2NsYWltZXIpOwogICAgfQogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RhbnQsIGhlbHBlciBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAbm90aWNlIEhvdyBtYW55IHdlaSBjYW4gdGhlIG1zZy5zZW5kZXIgY29udHJpYnV0ZSBub3cuCiAgICBmdW5jdGlvbiBob3dNdWNoQ2FuSUNvbnRyaWJ1dGVOb3coKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGhvd011Y2hDYW5YQ29udHJpYnV0ZU5vdyhtc2cuc2VuZGVyKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIEhvdyBtYW55IHdlaSBjYW4gYW4gZXRoZXJldW0gYWRkcmVzcyBjb250cmlidXRlIG5vdy4KICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gY2FuIHJldHVybiAwIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBzdG9wcGVkCiAgICAvLy8gIG9yIHRoZSBhZGRyZXNzIGhhcyBtYXhlZCB0aGUgY3VycmVudCBkYXkncyB3aGl0ZWxpc3QgY2FwLAogICAgLy8vICBpdCBpcyBwb3NzaWJsZSwgdGhhdCBuZXh0IGRheSBoZSBjYW4gY29udHJpYnV0ZQogICAgLy8vIEBwYXJhbSBfYmVuZWZpY2lhcnkgRXRoZXJldW0gYWRkcmVzcwogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIHdlaSB0aGUgX2JlbmVmaWNpYXJ5IGNhbiBjb250cmlidXRlIG5vdy4KICAgIGZ1bmN0aW9uIGhvd011Y2hDYW5YQ29udHJpYnV0ZU5vdyhhZGRyZXNzIF9iZW5lZmljaWFyeSkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGlmICghaGFzU3RhcnRlZCgpIHx8IGhhc0VuZGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIC8vIHdlaSB0byBoYXJkIGNhcAogICAgICAgIHVpbnQyNTYgd2VpVG9DYXAgPSBjYXAuc3ViKHdlaVJhaXNlZCk7CiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHdoaXRlbGlzdCBsaW1pdGVkIHBlcmlvZAogICAgICAgIHVpbnQ4IF9zYWxlRGF5ID0gZ2V0U2FsZURheU5vdygpOwogICAgICAgIGlmIChfc2FsZURheSA8PSB3aGl0ZWxpc3REYXlDb3VudCkgewogICAgICAgICAgICAvLyBhZGRyZXNzIGNhbid0IGNvbnRyaWJ1dGUgaWYKICAgICAgICAgICAgLy8gIGl0IGlzIG5vdCB3aGl0ZWxpc3RlZAogICAgICAgICAgICBpZiAoIXdoaXRlbGlzdFtfYmVuZWZpY2lhcnldKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBwZXJzb25hbCBjYXAgaXMgdGhlIGRhaWx5IHdoaXRlbGlzdCBsaW1pdCBtaW51cyB0aGUgc3Rha2VzIHRoZSBhZGRyZXNzIGFscmVhZHkgaGFzCiAgICAgICAgICAgIHVpbnQyNTYgd2VpVG9QZXJzb25hbENhcCA9IHdoaXRlbGlzdERheU1heFN0YWtlW19zYWxlRGF5XS5zdWIoc3Rha2VzW19iZW5lZmljaWFyeV0pOwogICAgICAgICAgICAvLyBjYWxjdWxhdGUgZm9yIG1heEdhc1ByaWNlIHBlbmFsdHkKICAgICAgICAgICAgaWYgKG1zZy52YWx1ZSA+IDAgJiYgbWF4R2FzUHJpY2UgPiAwICYmIHR4Lmdhc3ByaWNlID4gbWF4R2FzUHJpY2UpIHsKICAgICAgICAgICAgICAgIHdlaVRvUGVyc29uYWxDYXAgPSB3ZWlUb1BlcnNvbmFsQ2FwLm11bCgxMDApLmRpdihtYXhHYXNQcmljZVBlbmFsdHkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdlaVRvQ2FwID0gdWludDI1Nk1pbih3ZWlUb0NhcCwgd2VpVG9QZXJzb25hbENhcCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB3ZWlUb0NhcDsKICAgIH0KICAgIC8vLyBAbm90aWNlIEZvciBhIGdpdmUgZGF0ZSBob3cgbWFueSAyNCBob3VyIGJsb2NrcyBoYXZlIGVsbGFwc2VkIHNpbmNlIHRva2VuIHNhbGUgc3RhcnQKICAgIC8vLyBAZGV2IF90aW1lIGhhcyB0byBiZSBiaWdnZXIgdGhhbiB0aGUgc3RhcnRUaW1lIG9mIHRva2VuIHNhbGUsIG90aGVyd2lzZSBTYWZlTWF0aCdzIGRpdiB3aWxsIHRocm93LgogICAgLy8vICBXaXRoaW4gMjQgaG91cnMgb2YgdG9rZW4gc2FsZSBpdCB3aWxsIHJldHVybiAxLCAKICAgIC8vLyAgYmV0d2VlbiAyNCBhbmQgNDggaG91cnMgaXQgd2lsbCByZXR1cm4gMiwgZXRjLgogICAgLy8vIEBwYXJhbSBfdGltZSBEYXRlIGluIHNlY29uZHMgZm9yIHdoaWNoIHdlIHdhbnQgdG8ga25vdyB3aGljaCBzYWxlIGRheSBpdCBpcwogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIDI0IGhvdXIgYmxvY2tzIGVsbGFwc2luZyBzaW5jZSB0b2tlbiBzYWxlIHN0YXJ0IHN0YXJ0aW5nIGZyb20gMQogICAgZnVuY3Rpb24gZ2V0U2FsZURheSh1aW50MjU2IF90aW1lKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiB1aW50OChfdGltZS5zdWIoc3RhcnRUaW1lKS5kaXYoNjAqNjAqMjQpLmFkZCgxKSk7CiAgICB9CiAgICAvLy8gQG5vdGljZSBIb3cgbWFueSAyNCBob3VyIGJsb2NrcyBoYXZlIGVsbGFwc2VkIHNpbmNlIHRva2VuIHNhbGUgc3RhcnQKICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiAyNCBob3VyIGJsb2NrcyBlbGxhcHNpbmcgc2luY2UgdG9rZW4gc2FsZSBzdGFydCBzdGFydGluZyBmcm9tIDEKICAgIGZ1bmN0aW9uIGdldFNhbGVEYXlOb3coKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiBnZXRTYWxlRGF5KG5vdyk7CiAgICB9CiAgICAvLy8gQG5vdGljZSBNaW5pbXVtIGJldHdlZW4gdHdvIHVpbnQ4IG51bWJlcnMKICAgIGZ1bmN0aW9uIHVpbnQ4TWluKHVpbnQ4IGEsIHVpbnQ4IGIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gYSA+IGIgPyBiIDogYTsKICAgIH0KICAgIC8vLyBAbm90aWNlIE1pbmltdW0gYmV0d2VlbiB0d28gdWludDI1NiBudW1iZXJzCiAgICBmdW5jdGlvbiB1aW50MjU2TWluKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA+IGIgPyBiIDogYTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFRlc3QgYW5kIGNvbnRyaWJ1dGlvbiB3ZWIgYXBwLCBOTyBhdWRpdCBpcyBuZWVkZWQKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAbm90aWNlIFdhcyB0aGlzIHRva2VuIHNhbGUgc3VjY2Vzc2Z1bD8KICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIHNhbGUgaXMgb3ZlciBhbmQgd2UgaGF2ZSByZWFjaGVkIHRoZSBtaW5pbXVtIGdvYWwKICAgIGZ1bmN0aW9uIHdhc1N1Y2Nlc3MoKSB2aWV3IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGhhc0VuZGVkKCkgJiYgZ29hbFJlYWNoZWQoKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIEhvdyBtYW55IGNvbnRyaWJ1dG9ycyB3ZSBoYXZlLgogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIGRpZmZlcmVudCBjb250cmlidXRvciBldGhlcmV1bSBhZGRyZXNzZXMKICAgIGZ1bmN0aW9uIGdldENvbnRyaWJ1dG9yc0NvdW50KCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjb250cmlidXRvcnNLZXlzLmxlbmd0aDsKICAgIH0KICAgIC8vLyBAbm90aWNlIEdldCBjb250cmlidXRvciBhZGRyZXNzZXMgdG8gbWFuYWdlIHJlZnVuZHMgb3IgdG9rZW4gY2xhaW1zLgogICAgLy8vIEBkZXYgSWYgdGhlIHNhbGUgaXMgbm90IHlldCBzdWNjZXNzZnVsLCB0aGVuIGl0IHNlYXJjaGVzIGluIHRoZSBSZWZ1bmRWYXVsdC4KICAgIC8vLyAgSWYgdGhlIHNhbGUgaXMgc3VjY2Vzc2Z1bCwgaXQgc2VhcmNoZXMgaW4gY29udHJpYnV0b3JzLgogICAgLy8vIEBwYXJhbSBfcGVuZGluZyBJZiB0cnVlLCB0aGVuIHJldHVybnMgYWRkcmVzc2VzIHdoaWNoIGRpZG4ndCBnZXQgcmVmdW5kZWQgb3IgdGhlaXIgdG9rZW5zIGRpc3RyaWJ1dGVkIHRvIHRoZW0KICAgIC8vLyBAcGFyYW0gX2NsYWltZWQgSWYgdHJ1ZSwgdGhlbiByZXR1cm5zIGFscmVhZHkgcmVmdW5kZWQgb3IgdG9rZW4gZGlzdHJpYnV0ZWQgYWRkcmVzc2VzCiAgICAvLy8gQHJldHVybiBBcnJheSBvZiBhZGRyZXNzZXMgb2YgY29udHJpYnV0b3JzCiAgICBmdW5jdGlvbiBnZXRDb250cmlidXRvcnMoYm9vbCBfcGVuZGluZywgYm9vbCBfY2xhaW1lZCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzc1tdIGNvbnRyaWJ1dG9ycykgewogICAgICAgIHVpbnQyNTYgaSA9IDA7CiAgICAgICAgdWludDI1NiByZXN1bHRzID0gMDsKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IF9jb250cmlidXRvcnMgPSBuZXcgYWRkcmVzc1tdKGNvbnRyaWJ1dG9yc0tleXMubGVuZ3RoKTsKICAgICAgICAvLyBpZiB3ZSBoYXZlIHJlYWNoZWQgb3VyIGdvYWwsIHRoZW4gc2VhcmNoIGluIGNvbnRyaWJ1dG9ycywgc2luY2UgdGhpcyBpcyB3aGF0IHdlIHdhbnQgdG8gbW9uaXRvcgogICAgICAgIGlmIChnb2FsUmVhY2hlZCgpKSB7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb250cmlidXRvcnNLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoX3BlbmRpbmcgJiYgc3Rha2VzW2NvbnRyaWJ1dG9yc0tleXNbaV1dID4gMCB8fCBfY2xhaW1lZCAmJiBzdGFrZXNbY29udHJpYnV0b3JzS2V5c1tpXV0gPT0gMCkgewogICAgICAgICAgICAgICAgICAgIF9jb250cmlidXRvcnNbcmVzdWx0c10gPSBjb250cmlidXRvcnNLZXlzW2ldOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG90aGVyd2lzZSBzZWFyY2ggaW4gdGhlIHJlZnVuZCB2YXVsdAogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29udHJpYnV0b3JzS2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9wZW5kaW5nICYmIHZhdWx0LmRlcG9zaXRlZChjb250cmlidXRvcnNLZXlzW2ldKSA+IDAgfHwgX2NsYWltZWQgJiYgdmF1bHQuZGVwb3NpdGVkKGNvbnRyaWJ1dG9yc0tleXNbaV0pID09IDApIHsKICAgICAgICAgICAgICAgICAgICBfY29udHJpYnV0b3JzW3Jlc3VsdHNdID0gY29udHJpYnV0b3JzS2V5c1tpXTsKICAgICAgICAgICAgICAgICAgICByZXN1bHRzKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29udHJpYnV0b3JzID0gbmV3IGFkZHJlc3NbXShyZXN1bHRzKTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmVzdWx0czsgaSsrKSB7CiAgICAgICAgICAgIGNvbnRyaWJ1dG9yc1tpXSA9IF9jb250cmlidXRvcnNbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb250cmlidXRvcnM7CiAgICB9CiAgICAvLy8gQG5vdGljZSBIb3cgbWFueSBIRUFMIHRva2VucyBkbyB0aGlzIGNvbnRyYWN0IGhhdmUKICAgIGZ1bmN0aW9uIGdldEhlYWxCYWxhbmNlKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBldGhlYWxDb250cm9sbGVyLmV0aGVhbFRva2VuKCkuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgfQogICAgCiAgICAKICAgIC8vLyBAbm90aWNlIEdldCBjdXJyZW50IGRhdGUgZm9yIHdlYjMKICAgIGZ1bmN0aW9uIGdldE5vdygpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQp9'.
	

]
