Class {
	#name : #SRTf67acb7b9226e482afcf7f08aac9466c50c19d9c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf67acb7b9226e482afcf7f08aac9466c50c19d9c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBHZW5lcmljQ3Jvd2RzYWxlIHsKICAgIGFkZHJlc3MgcHVibGljIGljb0JhY2tlbmQ7CiAgICBhZGRyZXNzIHB1YmxpYyBpY29NYW5hZ2VyOwogICAgYWRkcmVzcyBwdWJsaWMgZW1lcmdlbmN5TWFuYWdlcjsKCiAgICAvLyBwYXVzZWQgc3RhdGUKICAgIGJvb2wgcGF1c2VkID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBAZGV2IENvbmZpcm1zIHRoYXQgdG9rZW4gaXNzdWFuY2UgZm9yIGFuIG9mZi1jaGFpbiBwdXJjaGFzZSB3YXMgcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseS4KICAgICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgVG9rZW4gaG9sZGVyLgogICAgICogQHBhcmFtIF9jb250cmlidXRpb24gTW9uZXkgcmVjZWl2ZWQgKGluIFVTRCBjZW50cykuIENvcGllZCBmcm9tIGlzc3VlVG9rZW5zIGNhbGwgYXJndW1lbnRzLgogICAgICogQHBhcmFtIF90b2tlbnNJc3N1ZWQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB3YXMgYXNzaWduZWQgdG8gdGhlIGhvbGRlciwgbm90IGNvdW50aW5nIGJvbnVzZXMuCiAgICAgKi8KICAgIGV2ZW50IFRva2Vuc0FsbG9jYXRlZChhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfY29udHJpYnV0aW9uLCB1aW50IF90b2tlbnNJc3N1ZWQpOwoKICAgIC8qKgogICAgICogQGRldiBOb3RpZmllcyBhYm91dCBib251cyB0b2tlbiBpc3N1YW5jZS4gSXMgcmFpc2VkIGV2ZW4gaWYgdGhlIGJvbnVzIGlzIDAuCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRva2VuIGhvbGRlci4KICAgICAqIEBwYXJhbSBfYm9udXNUb2tlbnNJc3N1ZWQgVGhlIGFtb3VudCBvZiBib251cyB0b2tlbnMgdGhhdCB3YXMgYXNzaWduZWQgdG8gdGhlIGhvbGRlci4KICAgICAqLwogICAgZXZlbnQgQm9udXNJc3N1ZWQoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX2JvbnVzVG9rZW5zSXNzdWVkKTsKCiAgICAvKioKICAgICAqIEBkZXYgSXNzdWVzIHRva2VucyBmb3IgZm91bmRlcnMgYW5kIHBhcnRuZXJzIGFuZCBjbG9zZXMgdGhlIGN1cnJlbnQgcGhhc2UuCiAgICAgKiBAcGFyYW0gZm91bmRlcnNXYWxsZXQgV2FsbGV0IGFkZHJlc3MgaG9sZGluZyB0aGUgdmVzdGVkIHRva2Vucy4KICAgICAqIEBwYXJhbSB0b2tlbnNGb3JGb3VuZGVycyBUaGUgYW1vdW50IG9mIHRva2VucyB2ZXN0ZWQgZm9yIGZvdW5kZXJzLgogICAgICogQHBhcmFtIHBhcnRuZXJzV2FsbGV0IFdhbGxldCBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBmb3IgZWFybHkgY29udHJpYnV0b3JzLgogICAgICogQHBhcmFtIHRva2Vuc0ZvclBhcnRuZXJzIFRoZSBhbW91bnQgb2YgdG9rZW5zIGlzc3VlZCBmb3IgcmV3YXJkaW5nIGVhcmx5IGNvbnRyaWJ1dG9ycy4KICAgICAqLwogICAgZXZlbnQgRm91bmRlcnNBbmRQYXJ0bmVyc1Rva2Vuc0lzc3VlZChhZGRyZXNzIGZvdW5kZXJzV2FsbGV0LCB1aW50IHRva2Vuc0ZvckZvdW5kZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIHBhcnRuZXJzV2FsbGV0LCB1aW50IHRva2Vuc0ZvclBhcnRuZXJzKTsKCiAgICBldmVudCBQYXVzZWQoKTsKICAgIGV2ZW50IFVucGF1c2VkKCk7CgogICAgLyoqCiAgICAgKiBAZGV2IElzc3VlcyB0b2tlbnMgZm9yIHRoZSBvZmYtY2hhaW4gY29udHJpYnV0b3JzIGJ5IGFjY2VwdGluZyBjYWxscyBmcm9tIHRoZSB0cnVzdGVkIGFkZHJlc3MuCiAgICAgKiAgICAgICAgU3VwcG9zZWQgdG8gYmUgcnVuIGJ5IHRoZSBiYWNrZW5kLgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUb2tlbiBob2xkZXIuCiAgICAgKiBAcGFyYW0gX2NvbnRyaWJ1dGlvbiBUaGUgZXF1aXZhbGVudCAoaW4gVVNEIGNlbnRzKSBvZiB0aGUgY29udHJpYnV0aW9uIHJlY2VpdmVkIG9mZi1jaGFpbi4KICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX2NvbnRyaWJ1dGlvbikgb25seUJhY2tlbmQgb25seVVucGF1c2VkIGV4dGVybmFsOwoKICAgIC8qKgogICAgICogQGRldiBJc3N1ZXMgdG9rZW5zIGZvciB0aGUgb2ZmLWNoYWluIGNvbnRyaWJ1dG9ycyBieSBhY2NlcHRpbmcgY2FsbHMgZnJvbSB0aGUgdHJ1c3RlZCBhZGRyZXNzLgogICAgICogICAgICBTdXBwb3NlZCB0byBiZSBydW4gYnkgdGhlIGJhY2tlbmQuCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRva2VuIGhvbGRlci4KICAgICAqIEBwYXJhbSBfY29udHJpYnV0aW9uIFRoZSBlcXVpdmFsZW50IChpbiBVU0QgY2VudHMpIG9mIHRoZSBjb250cmlidXRpb24gcmVjZWl2ZWQgb2ZmLWNoYWluLgogICAgICogQHBhcmFtIF90b2tlbnMgVG90YWwgVG9rZW5zIHRvIGlzc3VlIGZvciB0aGUgY29udHJpYnV0aW9uLCBtdXN0IGJlID4gMAogICAgICogQHBhcmFtIF9ib251cyBIb3cgbWFueSB0b2tlbnMgYXJlIGJvbnVzZXMsIGxlc3Mgb3IgZXF1YWwgdG8gX3Rva2VucwogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZVRva2Vuc1dpdGhDdXN0b21Cb251cyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfY29udHJpYnV0aW9uLCB1aW50IF90b2tlbnMsIHVpbnQgX2JvbnVzKSBvbmx5QmFja2VuZCBvbmx5VW5wYXVzZWQgZXh0ZXJuYWw7CgogICAgLyoqCiAgICAgKiBAZGV2IFBhdXNlcyB0aGUgdG9rZW4gYWxsb2NhdGlvbiBwcm9jZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIG9ubHlVbnBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBQYXVzZWQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVW5wYXVzZXMgdGhlIHRva2VuIGFsbG9jYXRpb24gcHJvY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gdW5wYXVzZSgpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIG9ubHlQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICAgIFVucGF1c2VkKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgbWFuYWdlciB0byBjaGFuZ2UgYmFja2VuZHMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZWljb0JhY2tlbmQoYWRkcmVzcyBfaWNvQmFja2VuZCkgZXh0ZXJuYWwgb25seU1hbmFnZXIgewogICAgICAgIGljb0JhY2tlbmQgPSBfaWNvQmFja2VuZDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlNYW5hZ2VyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBpY29NYW5hZ2VyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlCYWNrZW5kKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBpY29CYWNrZW5kKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlFbWVyZ2VuY3koKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGVtZXJnZW5jeU1hbmFnZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCA9PSB0cnVlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlVbnBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCA9PSBmYWxzZSk7CiAgICAgICAgXzsKICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CgogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IHJlbWFpbmluZyk7CgogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50IHZhbHVlKTsKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgaWYgKGEgPT0gMCkgewogICAgICAgIHJldHVybiAwOwogICAgICB9CgogICAgICB1aW50IGMgPSBhICogYjsKICAgICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgICByZXR1cm4gYzsKICAgfQoKICAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgIHJldHVybiBhIC0gYjsKICAgfQoKICAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgdWludCBjID0gYSArIGI7CiAgICAgIGFzc2VydChjID49IGEpOwogICAgICByZXR1cm4gYzsKICAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZQogICAgICAgICAgICAmJiBfdmFsdWUgPiAwCiAgICAgICAgICAgICYmIF90byAhPSBtc2cuc2VuZGVyCiAgICAgICAgICAgICYmIF90byAhPSBhZGRyZXNzKDApCiAgICAgICAgICApIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUKICAgICAgICAgICAgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlCiAgICAgICAgICAgICYmIF92YWx1ZSA+IDAKICAgICAgICAgICAgJiYgX2Zyb20gIT0gX3RvCiAgICAgICAgICApIHsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSAgID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfc3BlbmRlciAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBuZWVkcyB0byBiZSBjYWxsZWQgdHdpY2UgLT4gZmlyc3Qgc2V0IHRvIDAsIHRoZW4gaW5jcmVhc2UgdG8gYW5vdGhlciBhbW91bnQKICAgICAgICAvLyB0aGlzIGlzIHRvIGF2b2lkIHJhY2UgY29uZGl0aW9ucwogICAgICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gdXNlbGVzcyBvcGVyYXRpb24KICAgICAgICByZXF1aXJlKF9zcGVuZGVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBwZXJmb3JtIG9wZXJhdGlvbgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIHVzZWxlc3Mgb3BlcmF0aW9uCiAgICAgICAgcmVxdWlyZShfc3BlbmRlciAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBfc2l6ZSkgewogICAgICAgIHJlcXVpcmUobXNnLmRhdGEubGVuZ3RoID49IF9zaXplICsgNCk7CiAgICAgICAgXzsKICAgIH0KfQoKY29udHJhY3QgQ2FwcGFzaXR5IGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIC8vIENvbnN0YW50cwogICAgLy8gPT09PT09PT09CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQ2FwcGFzaXR5IjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkNBUFAiOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMjsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFRPS0VOX0xJTUlUID0gMTAgKiAxZTkgKiAxZTI7IC8vIDEwIGJpbGxpb24gdG9rZW5zLCAyIGRlY2ltYWxzCgogICAgLy8gU3RhdGUgdmFyaWFibGVzCiAgICAvLyA9PT09PT09PT09PT09PT0KICAgIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7CgogICAgLy8gQmxvY2sgdG9rZW4gdHJhbnNmZXJzIHVudGlsIElDTyBpcyBmaW5pc2hlZC4KICAgIGJvb2wgcHVibGljIHRva2Vuc0FyZUZyb3plbiA9IHRydWU7CgogICAgLy8gQWxsb3cvRGlzYWxsb3cgbWludGluZwogICAgYm9vbCBwdWJsaWMgbWludGluZ0lzQWxsb3dlZCA9IHRydWU7CgogICAgLy8gZXZlbnRzIGZvciBtaW50aW5nCiAgICBldmVudCBNaW50aW5nQWxsb3dlZCgpOwogICAgZXZlbnQgTWludGluZ0Rpc2FibGVkKCk7CgogICAgLy8gRnJlZXplL1VuZnJlZXplIGFzc2V0cwogICAgZXZlbnQgVG9rZW5zRnJvemVuKCk7CiAgICBldmVudCBUb2tlbnNVbmZyb3plbigpOwoKICAgIC8vIENvbnN0cnVjdG9yCiAgICAvLyA9PT09PT09PT09PQogICAgZnVuY3Rpb24gQ2FwcGFzaXR5KGFkZHJlc3MgX21hbmFnZXIpIHB1YmxpYyB7CiAgICAgICAgbWFuYWdlciA9IF9tYW5hZ2VyOwogICAgfQoKICAgIC8vIEZhbGxiYWNrIGZ1bmN0aW9uCiAgICAvLyBEbyBub3QgYWxsb3cgdG8gc2VuZCBtb25leSBkaXJlY3RseSB0byB0aGlzIGNvbnRyYWN0CiAgICBmdW5jdGlvbigpIHBheWFibGUgcHVibGljIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KCiAgICAvLyBFUkMyMCBmdW5jdGlvbnMKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKCF0b2tlbnNBcmVGcm96ZW4pOwogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKCF0b2tlbnNBcmVGcm96ZW4pOwogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoIXRva2Vuc0FyZUZyb3plbik7CiAgICAgICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoIXRva2Vuc0FyZUZyb3plbik7CiAgICAgICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKCF0b2tlbnNBcmVGcm96ZW4pOwogICAgICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KCiAgICAvLyBQUklWSUxFR0VEIEZVTkNUSU9OUwogICAgLy8gPT09PT09PT09PT09PT09PT09PT0KICAgIG1vZGlmaWVyIG9ubHlCeU1hbmFnZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG1hbmFnZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gTWludCBzb21lIHRva2VucyBhbmQgYXNzaWduIHRoZW0gdG8gYW4gYWRkcmVzcwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfdmFsdWUpIGV4dGVybmFsIG9ubHlCeU1hbmFnZXIgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlICE9IDApOwogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkuYWRkKF92YWx1ZSkgPD0gVE9LRU5fTElNSVQpOwogICAgICAgIHJlcXVpcmUobWludGluZ0lzQWxsb3dlZCA9PSB0cnVlKTsKCiAgICAgICAgYmFsYW5jZXNbX2JlbmVmaWNpYXJ5XSA9IGJhbGFuY2VzW19iZW5lZmljaWFyeV0uYWRkKF92YWx1ZSk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX3ZhbHVlKTsKICAgIH0KCiAgICAvLyBEaXNhYmxlIG1pbnRpbmcuIENhbiBiZSBlbmFibGVkIGxhdGVyLCBidXQgVG9rZW5BbGxvY2F0aW9uLnNvbCBvbmx5IGRvZXMgdGhhdCBvbmNlLgogICAgZnVuY3Rpb24gZW5kTWludGluZygpIGV4dGVybmFsIG9ubHlCeU1hbmFnZXIgewogICAgICAgIHJlcXVpcmUobWludGluZ0lzQWxsb3dlZCA9PSB0cnVlKTsKICAgICAgICBtaW50aW5nSXNBbGxvd2VkID0gZmFsc2U7CiAgICAgICAgTWludGluZ0Rpc2FibGVkKCk7CiAgICB9CgogICAgLy8gRW5hYmxlIG1pbnRpbmcuIFNlZSBUb2tlbkFsbG9jYXRpb24uc29sCiAgICBmdW5jdGlvbiBzdGFydE1pbnRpbmcoKSBleHRlcm5hbCBvbmx5QnlNYW5hZ2VyIHsKICAgICAgICByZXF1aXJlKG1pbnRpbmdJc0FsbG93ZWQgPT0gZmFsc2UpOwogICAgICAgIG1pbnRpbmdJc0FsbG93ZWQgPSB0cnVlOwogICAgICAgIE1pbnRpbmdBbGxvd2VkKCk7CiAgICB9CgogICAgLy8gRGlzYWJsZSB0b2tlbiB0cmFuc2ZlcgogICAgZnVuY3Rpb24gZnJlZXplKCkgZXh0ZXJuYWwgb25seUJ5TWFuYWdlciB7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNBcmVGcm96ZW4gPT0gZmFsc2UpOwogICAgICAgIHRva2Vuc0FyZUZyb3plbiA9IHRydWU7CiAgICAgICAgVG9rZW5zRnJvemVuKCk7CiAgICB9CgogICAgLy8gQWxsb3cgdG9rZW4gdHJhbnNmZXIKICAgIGZ1bmN0aW9uIHVuZnJlZXplKCkgZXh0ZXJuYWwgb25seUJ5TWFuYWdlciB7CiAgICAgICAgcmVxdWlyZSh0b2tlbnNBcmVGcm96ZW4gPT0gdHJ1ZSk7CiAgICAgICAgdG9rZW5zQXJlRnJvemVuID0gZmFsc2U7CiAgICAgICAgVG9rZW5zVW5mcm96ZW4oKTsKICAgIH0KfQoKLyoqCiAqIEBkZXYgRm9yIHRoZSB0b2tlbnMgaXNzdWVkIGZvciBmb3VuZGVycy4KICovCmNvbnRyYWN0IFZlc3RpbmdXYWxsZXQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgZXZlbnQgVG9rZW5zUmVsZWFzZWQodWludCBfdG9rZW5zUmVsZWFzZWQsIHVpbnQgX3Rva2Vuc1JlbWFpbmluZywgdWludCBfbmV4dFBlcmlvZCk7CgogICAgYWRkcmVzcyBwdWJsaWMgZm91bmRlcnNXYWxsZXQ7CiAgICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGVDb250cmFjdDsKICAgIEVSQzIwIHB1YmxpYyB0b2tlbkNvbnRyYWN0OwoKICAgIC8vIFR3by15ZWFyIHZlc3Rpbmcgd2l0aCAxIG1vbnRoIGNsaWZmLiBSb3VnaGx5LgogICAgYm9vbCBwdWJsaWMgdmVzdGluZ1N0YXJ0ZWQgPSBmYWxzZTsKICAgIHVpbnQgY29uc3RhbnQgY2xpZmZQZXJpb2QgPSAzMCBkYXlzOwogICAgdWludCBjb25zdGFudCB0b3RhbFBlcmlvZHMgPSAyNDsKCiAgICB1aW50IHB1YmxpYyBwZXJpb2RzUGFzc2VkID0gMDsKICAgIHVpbnQgcHVibGljIG5leHRQZXJpb2Q7CiAgICB1aW50IHB1YmxpYyB0b2tlbnNSZW1haW5pbmc7CiAgICB1aW50IHB1YmxpYyB0b2tlbnNQZXJCYXRjaDsKCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgLy8gPT09PT09PT09PT0KICAgIGZ1bmN0aW9uIFZlc3RpbmdXYWxsZXQoYWRkcmVzcyBfZm91bmRlcnNXYWxsZXQsIGFkZHJlc3MgX3Rva2VuQ29udHJhY3QpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfZm91bmRlcnNXYWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG9rZW5Db250cmFjdCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgZm91bmRlcnNXYWxsZXQgICAgPSBfZm91bmRlcnNXYWxsZXQ7CiAgICAgICAgdG9rZW5Db250cmFjdCAgICAgPSBFUkMyMChfdG9rZW5Db250cmFjdCk7CiAgICAgICAgY3Jvd2RzYWxlQ29udHJhY3QgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vIFBSSVZJTEVHRUQgRlVOQ1RJT05TCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PQogICAgZnVuY3Rpb24gcmVsZWFzZUJhdGNoKCkgZXh0ZXJuYWwgb25seUZvdW5kZXJzIHsKICAgICAgICByZXF1aXJlKHRydWUgPT0gdmVzdGluZ1N0YXJ0ZWQpOwogICAgICAgIHJlcXVpcmUobm93ID4gbmV4dFBlcmlvZCk7CiAgICAgICAgcmVxdWlyZShwZXJpb2RzUGFzc2VkIDwgdG90YWxQZXJpb2RzKTsKCiAgICAgICAgdWludCB0b2tlbnNUb1JlbGVhc2UgPSAwOwogICAgICAgIGRvIHsKICAgICAgICAgICAgcGVyaW9kc1Bhc3NlZCAgID0gcGVyaW9kc1Bhc3NlZC5hZGQoMSk7CiAgICAgICAgICAgIG5leHRQZXJpb2QgICAgICA9IG5leHRQZXJpb2QuYWRkKGNsaWZmUGVyaW9kKTsKICAgICAgICAgICAgdG9rZW5zVG9SZWxlYXNlID0gdG9rZW5zVG9SZWxlYXNlLmFkZCh0b2tlbnNQZXJCYXRjaCk7CiAgICAgICAgfSB3aGlsZSAobm93ID4gbmV4dFBlcmlvZCk7CgogICAgICAgIC8vIElmIHZlc3RpbmcgaGFzIGZpbmlzaGVkLCBqdXN0IHRyYW5zZmVyIHRoZSByZW1haW5pbmcgdG9rZW5zLgogICAgICAgIGlmIChwZXJpb2RzUGFzc2VkID49IHRvdGFsUGVyaW9kcykgewogICAgICAgICAgICB0b2tlbnNUb1JlbGVhc2UgPSB0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZih0aGlzKTsKICAgICAgICAgICAgbmV4dFBlcmlvZCA9IDB4MDsKICAgICAgICB9CgogICAgICAgIHRva2Vuc1JlbWFpbmluZyA9IHRva2Vuc1JlbWFpbmluZy5zdWIodG9rZW5zVG9SZWxlYXNlKTsKICAgICAgICB0b2tlbkNvbnRyYWN0LnRyYW5zZmVyKGZvdW5kZXJzV2FsbGV0LCB0b2tlbnNUb1JlbGVhc2UpOwoKICAgICAgICBUb2tlbnNSZWxlYXNlZCh0b2tlbnNUb1JlbGVhc2UsIHRva2Vuc1JlbWFpbmluZywgbmV4dFBlcmlvZCk7CiAgICB9CgogICAgZnVuY3Rpb24gbGF1bmNoVmVzdGluZygpIHB1YmxpYyBvbmx5Q3Jvd2RzYWxlIHsKICAgICAgICByZXF1aXJlKGZhbHNlID09IHZlc3RpbmdTdGFydGVkKTsKCiAgICAgICAgdmVzdGluZ1N0YXJ0ZWQgID0gdHJ1ZTsKICAgICAgICB0b2tlbnNSZW1haW5pbmcgPSB0b2tlbkNvbnRyYWN0LmJhbGFuY2VPZih0aGlzKTsKICAgICAgICBuZXh0UGVyaW9kICAgICAgPSBub3cuYWRkKGNsaWZmUGVyaW9kKTsKICAgICAgICB0b2tlbnNQZXJCYXRjaCAgPSB0b2tlbnNSZW1haW5pbmcgLyB0b3RhbFBlcmlvZHM7CiAgICB9CgogICAgLy8gSU5URVJOQUwgRlVOQ1RJT05TCiAgICAvLyA9PT09PT09PT09PT09PT09PT0KICAgIG1vZGlmaWVyIG9ubHlGb3VuZGVycygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZm91bmRlcnNXYWxsZXQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNyb3dkc2FsZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3Jvd2RzYWxlQ29udHJhY3QpOwogICAgICAgIF87CiAgICB9Cn0KCi8qKgoqIEBkZXYgUHJlcGFpZCB0b2tlbiBhbGxvY2F0aW9uIGZvciBhIGNhcHBlZCBjcm93ZHNhbGUgd2l0aCBib251cyBzdHJ1Y3R1cmUgc2xpZGluZyBvbiBzYWxlcwoqICAgICAgV3JpdHRlbiB3aXRoIE9wZW5aZXBwZWxpbiBzb3VyY2VzIGFzIGEgcm91Z2ggcmVmZXJlbmNlLgoqLwpjb250cmFjdCBUb2tlbkFsbG9jYXRpb24gaXMgR2VuZXJpY0Nyb3dkc2FsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IFRva2Vuc0FsbG9jYXRlZChhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfY29udHJpYnV0aW9uLCB1aW50IF90b2tlbnNJc3N1ZWQpOwogICAgZXZlbnQgQm9udXNJc3N1ZWQoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX2JvbnVzVG9rZW5zSXNzdWVkKTsKICAgIGV2ZW50IEZvdW5kZXJzQW5kUGFydG5lcnNUb2tlbnNJc3N1ZWQoYWRkcmVzcyBfZm91bmRlcnNXYWxsZXQsIHVpbnQgX3Rva2Vuc0ZvckZvdW5kZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9wYXJ0bmVyc1dhbGxldCwgdWludCBfdG9rZW5zRm9yUGFydG5lcnMpOwoKICAgIC8vIFRva2VuIGluZm9ybWF0aW9uCiAgICB1aW50IHB1YmxpYyB0b2tlblJhdGUgPSAxMjU7IC8vIDEgVVNEID0gMTI1IENBUFA7IHNvIDEgY2VudCA9IDEuMjUgQ0FQUCBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzc3VtaW5nIENBUFAgaGFzIDIgZGVjaW1hbHMgKGFzIHNldCBpbiB0b2tlbiBjb250cmFjdCkKICAgIENhcHBhc2l0eSBwdWJsaWMgdG9rZW5Db250cmFjdDsKCiAgICBhZGRyZXNzIHB1YmxpYyBmb3VuZGVyc1dhbGxldDsgLy8gQSB3YWxsZXQgcGVybWl0dGVkIHRvIHJlcXVlc3QgdG9rZW5zIGZyb20gdGhlIHRpbWUgdmF1bHRzLgogICAgYWRkcmVzcyBwdWJsaWMgcGFydG5lcnNXYWxsZXQ7IC8vIEEgd2FsbGV0IHRoYXQgZGlzdHJpYnV0ZXMgdGhlIHRva2VucyB0byBlYXJseSBjb250cmlidXRvcnMuCgogICAgLy8gQ3Jvd2RzYWxlIHByb2dyZXNzCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBoYXJkQ2FwICAgICA9IDUgKiAxZTcgKiAxZTI7IC8vIDUwIDAwMCAwMDAgZG9sbGFycyAqIDEwMCBjZW50cyBwZXIgZG9sbGFyCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBwaGFzZU9uZUNhcCA9IDMgKiAxZTcgKiAxZTI7IC8vIDMwIDAwMCAwMDAgZG9sbGFycyAqIDEwMCBjZW50cyBwZXIgZG9sbGFyCiAgICB1aW50IHB1YmxpYyB0b3RhbENlbnRzR2F0aGVyZWQgPSAwOwoKICAgIC8vIFRvdGFsIHN1bSBnYXRoZXJlZCBpbiBwaGFzZSBvbmUsIG5lZWQgdGhpcyB0byBhZGp1c3QgdGhlIGJvbnVzIHRpZXJzIGluIHBoYXNlIHR3by4KICAgIC8vIFVwZGF0ZWQgb25seSBvbmNlLCB3aGVuIHRoZSBwaGFzZSBvbmUgaXMgY29uY2x1ZGVkLgogICAgdWludCBwdWJsaWMgY2VudHNJblBoYXNlT25lID0gMDsKICAgIHVpbnQgcHVibGljIHRvdGFsVG9rZW5TdXBwbHkgPSAwOyAgICAgLy8gQ291bnRpbmcgdGhlIGJvbnVzZXMsIG5vdCBjb3VudGluZyB0aGUgZm91bmRlcnMnIHNoYXJlLgoKICAgIC8vIFRvdGFsIHRva2VucyBpc3N1ZWQgaW4gcGhhc2Ugb25lLCBpbmNsdWRpbmcgYm9udXNlcy4gTmVlZCB0aGlzIHRvIGNvcnJlY3RseSBjYWxjdWxhdGUgdGhlIGZvdW5kZXJzJyBcCiAgICAvLyBzaGFyZSBhbmQgaXNzdWUgaXQgaW4gcGFydHMsIG9uY2UgYWZ0ZXIgZWFjaCByb3VuZC4gVXBkYXRlZCB3aGVuIGlzc3VpbmcgdG9rZW5zLgogICAgdWludCBwdWJsaWMgdG9rZW5zRHVyaW5nUGhhc2VPbmUgPSAwOwogICAgVmVzdGluZ1dhbGxldCBwdWJsaWMgdmVzdGluZ1dhbGxldDsKCiAgICBlbnVtIENyb3dkc2FsZVBoYXNlIHsgUGhhc2VPbmUsIEJldHdlZW5QaGFzZXMsIFBoYXNlVHdvLCBGaW5pc2hlZCB9CiAgICBlbnVtIEJvbnVzUGhhc2UgeyBUZW5QZXJjZW50LCBGaXZlUGVyY2VudCwgTm9uZSB9CgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgYm9udXNUaWVyU2l6ZSA9IDEgKiAxZTcgKiAxZTI7IC8vIDEwIDAwMCAwMDAgZG9sbGFycyAqIDEwMCBjZW50cyBwZXIgZG9sbGFyCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBiaWdDb250cmlidXRpb25Cb3VuZCAgPSAxICogMWU1ICogMWUyOyAvLyAxMDAgMDAwIGRvbGxhcnMgKiAxMDAgY2VudHMgcGVyIGRvbGxhcgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgaHVnZUNvbnRyaWJ1dGlvbkJvdW5kID0gMyAqIDFlNSAqIDFlMjsgLy8gMzAwIDAwMCBkb2xsYXJzICogMTAwIGNlbnRzIHBlciBkb2xsYXIKICAgIENyb3dkc2FsZVBoYXNlIHB1YmxpYyBjcm93ZHNhbGVQaGFzZSA9IENyb3dkc2FsZVBoYXNlLlBoYXNlT25lOwogICAgQm9udXNQaGFzZSBwdWJsaWMgYm9udXNQaGFzZSA9IEJvbnVzUGhhc2UuVGVuUGVyY2VudDsKCiAgICAvKioKICAgICAqIEBkZXYgQ29uc3RydWN0cyB0aGUgYWxsb2NhdG9yLgogICAgICogQHBhcmFtIF9pY29CYWNrZW5kIFdhbGxldCBhZGRyZXNzIHRoYXQgc2hvdWxkIGJlIG93bmVkIGJ5IHRoZSBvZmYtY2hhaW4gYmFja2VuZCwgZnJvbSB3aGljaCBcCiAgICAgKiAgICAgICAgICBcIGl0IG1pbnRzIHRoZSB0b2tlbnMgZm9yIGNvbnRyaWJ1dGlvbnMgYWNjZXB0ZWQgaW4gb3RoZXIgY3VycmVuY2llcy4KICAgICAqIEBwYXJhbSBfaWNvTWFuYWdlciBBbGxvd2VkIHRvIHN0YXJ0IHBoYXNlIDIuCiAgICAgKiBAcGFyYW0gX2ZvdW5kZXJzV2FsbGV0IFdoZXJlIHRoZSBmb3VuZGVycycgdG9rZW5zIHRvIHRvIGFmdGVyIHZlc3RpbmcuCiAgICAgKiBAcGFyYW0gX3BhcnRuZXJzV2FsbGV0IEEgd2FsbGV0IHRoYXQgZGlzdHJpYnV0ZXMgdG9rZW5zIHRvIGVhcmx5IGNvbnRyaWJ1dG9ycy4KICAgICAqLwogICAgZnVuY3Rpb24gVG9rZW5BbGxvY2F0aW9uKGFkZHJlc3MgX2ljb01hbmFnZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfaWNvQmFja2VuZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9mb3VuZGVyc1dhbGxldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9wYXJ0bmVyc1dhbGxldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9lbWVyZ2VuY3lNYW5hZ2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2ljb01hbmFnZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfaWNvQmFja2VuZCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9mb3VuZGVyc1dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9wYXJ0bmVyc1dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9lbWVyZ2VuY3lNYW5hZ2VyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB0b2tlbkNvbnRyYWN0ID0gbmV3IENhcHBhc2l0eShhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgaWNvTWFuYWdlciAgICAgICA9IF9pY29NYW5hZ2VyOwogICAgICAgIGljb0JhY2tlbmQgICAgICAgPSBfaWNvQmFja2VuZDsKICAgICAgICBmb3VuZGVyc1dhbGxldCAgID0gX2ZvdW5kZXJzV2FsbGV0OwogICAgICAgIHBhcnRuZXJzV2FsbGV0ICAgPSBfcGFydG5lcnNXYWxsZXQ7CiAgICAgICAgZW1lcmdlbmN5TWFuYWdlciA9IF9lbWVyZ2VuY3lNYW5hZ2VyOwogICAgfQoKICAgIC8vIFBSSVZJTEVHRUQgRlVOQ1RJT05TCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PQogICAgLyoqCiAgICAgKiBAZGV2IElzc3VlcyB0b2tlbnMgZm9yIGEgcGFydGljdWxhciBhZGRyZXNzIGFzIGZvciBhIGNvbnRyaWJ1dGlvbiBvZiBzaXplIF9jb250cmlidXRpb24sIFwKICAgICAqICAgICAgICAgIFwgdGhlbiBpc3N1ZXMgYm9udXNlcyBpbiBwcm9wb3J0aW9uLgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBSZWNlaXZlciBvZiB0aGUgdG9rZW5zLgogICAgICogQHBhcmFtIF9jb250cmlidXRpb24gU2l6ZSBvZiB0aGUgY29udHJpYnV0aW9uIChpbiBVU0QgY2VudHMpLgogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfY29udHJpYnV0aW9uKSBleHRlcm5hbCBvbmx5QmFja2VuZCBvbmx5VmFsaWRQaGFzZSBvbmx5VW5wYXVzZWQgewogICAgICAgIC8vIHBoYXNlIDEgY2FwIGxlc3MgdGhhbiBoYXJkIGNhcAogICAgICAgIGlmIChjcm93ZHNhbGVQaGFzZSA9PSBDcm93ZHNhbGVQaGFzZS5QaGFzZU9uZSkgewogICAgICAgICAgICByZXF1aXJlKHRvdGFsQ2VudHNHYXRoZXJlZC5hZGQoX2NvbnRyaWJ1dGlvbikgPD0gcGhhc2VPbmVDYXApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUodG90YWxDZW50c0dhdGhlcmVkLmFkZChfY29udHJpYnV0aW9uKSA8PSBoYXJkQ2FwKTsKICAgICAgICB9CgogICAgICAgIHVpbnQgcmVtYWluaW5nQ29udHJpYnV0aW9uID0gX2NvbnRyaWJ1dGlvbjsKCiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNvbnRyaWJ1dGlvbiBmaWxscyB0aGUgY3VycmVudCBib251cyBwaGFzZS4gSWYgc28sIGJyZWFrIGl0IHVwIGluIHBhcnRzLAogICAgICAgIC8vIG1pbnQgdG9rZW5zIGZvciBlYWNoIHBhcnQgc2VwYXJhdGVseSwgYXNzaWduIGJvbnVzZXMsIHRyaWdnZXIgZXZlbnRzLiBGb3IgdHJhbnNwYXJlbmN5LgogICAgICAgIGRvIHsKICAgICAgICAgICAgLy8gMSAtIGNhbGN1bGF0ZSBjb250cmlidXRpb24gcGFydCBmb3IgY3VycmVudCBib251cyBzdGFnZQogICAgICAgICAgICB1aW50IGNlbnRzTGVmdEluUGhhc2UgPSBjYWxjdWxhdGVDZW50c0xlZnRJblBoYXNlKHJlbWFpbmluZ0NvbnRyaWJ1dGlvbik7CiAgICAgICAgICAgIHVpbnQgY29udHJpYnV0aW9uUGFydCA9IG1pbihyZW1haW5pbmdDb250cmlidXRpb24sIGNlbnRzTGVmdEluUGhhc2UpOwoKICAgICAgICAgICAgLy8gMyAtIG1pbnQgdG9rZW5zCiAgICAgICAgICAgIHVpbnQgdG9rZW5zVG9NaW50ID0gdG9rZW5SYXRlLm11bChjb250cmlidXRpb25QYXJ0KTsKICAgICAgICAgICAgbWludEFuZFVwZGF0ZShfYmVuZWZpY2lhcnksIHRva2Vuc1RvTWludCk7CiAgICAgICAgICAgIFRva2Vuc0FsbG9jYXRlZChfYmVuZWZpY2lhcnksIGNvbnRyaWJ1dGlvblBhcnQsIHRva2Vuc1RvTWludCk7CgogICAgICAgICAgICAvLyA0IC0gbWludCBib251cwogICAgICAgICAgICB1aW50IHRpZXJCb251cyA9IGNhbGN1bGF0ZVRpZXJCb251cyhjb250cmlidXRpb25QYXJ0KTsKICAgICAgICAgICAgaWYgKHRpZXJCb251cyA+IDApIHsKICAgICAgICAgICAgICAgIG1pbnRBbmRVcGRhdGUoX2JlbmVmaWNpYXJ5LCB0aWVyQm9udXMpOwogICAgICAgICAgICAgICAgQm9udXNJc3N1ZWQoX2JlbmVmaWNpYXJ5LCB0aWVyQm9udXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA1IC0gYWR2YW5jZSBib251cyBwaGFzZQogICAgICAgICAgICBpZiAoKGJvbnVzUGhhc2UgIT0gQm9udXNQaGFzZS5Ob25lKSAmJiAoY29udHJpYnV0aW9uUGFydCA9PSBjZW50c0xlZnRJblBoYXNlKSkgewogICAgICAgICAgICAgICAgYWR2YW5jZUJvbnVzUGhhc2UoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gNiAtIGxvZyB0aGUgcHJvY2Vzc2VkIHBhcnQgb2YgdGhlIGNvbnRyaWJ1dGlvbgogICAgICAgICAgICB0b3RhbENlbnRzR2F0aGVyZWQgPSB0b3RhbENlbnRzR2F0aGVyZWQuYWRkKGNvbnRyaWJ1dGlvblBhcnQpOwogICAgICAgICAgICByZW1haW5pbmdDb250cmlidXRpb24gPSByZW1haW5pbmdDb250cmlidXRpb24uc3ViKGNvbnRyaWJ1dGlvblBhcnQpOwoKICAgICAgICAgICAgLy8gNyAtIGNvbnRpbnVlPwogICAgICAgIH0gd2hpbGUgKHJlbWFpbmluZ0NvbnRyaWJ1dGlvbiA+IDApOwoKICAgICAgICAvLyBNaW50IGNvbnRyaWJ1dGlvbiBzaXplIGJvbnVzCiAgICAgICAgdWludCBzaXplQm9udXMgPSBjYWxjdWxhdGVTaXplQm9udXMoX2NvbnRyaWJ1dGlvbik7CiAgICAgICAgaWYgKHNpemVCb251cyA+IDApIHsKICAgICAgICAgICAgbWludEFuZFVwZGF0ZShfYmVuZWZpY2lhcnksIHNpemVCb251cyk7CiAgICAgICAgICAgIEJvbnVzSXNzdWVkKF9iZW5lZmljaWFyeSwgc2l6ZUJvbnVzKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IElzc3VlcyB0b2tlbnMgZm9yIHRoZSBvZmYtY2hhaW4gY29udHJpYnV0b3JzIGJ5IGFjY2VwdGluZyBjYWxscyBmcm9tIHRoZSB0cnVzdGVkIGFkZHJlc3MuCiAgICAgKiAgICAgICAgU3VwcG9zZWQgdG8gYmUgcnVuIGJ5IHRoZSBiYWNrZW5kLiBVc2VkIGZvciBkaXN0cmlidXRpbmcgYm9udXNlcyBmb3IgYWZmaWxpYXRlIHRyYW5zYWN0aW9ucwogICAgICogICAgICAgIGFuZCBzcGVjaWFsIG9mZmVycwogICAgICoKICAgICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgVG9rZW4gaG9sZGVyLgogICAgICogQHBhcmFtIF9jb250cmlidXRpb24gVGhlIGVxdWl2YWxlbnQgKGluIFVTRCBjZW50cykgb2YgdGhlIGNvbnRyaWJ1dGlvbiByZWNlaXZlZCBvZmYtY2hhaW4uCiAgICAgKiBAcGFyYW0gX3Rva2VucyBUb3RhbCB0b2tlbiBhbGxvY2F0aW9uIHNpemUKICAgICAqIEBwYXJhbSBfYm9udXMgQm9udXMgc2l6ZQogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZVRva2Vuc1dpdGhDdXN0b21Cb251cyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfY29udHJpYnV0aW9uLCB1aW50IF90b2tlbnMsIHVpbnQgX2JvbnVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVybmFsIG9ubHlCYWNrZW5kIG9ubHlWYWxpZFBoYXNlIG9ubHlVbnBhdXNlZCB7CgogICAgICAgIC8vIHNhbml0eSBjaGVjaywgZW5zdXJlIHdlIGFsbG9jYXRlIG1vcmUgdGhhbiAwCiAgICAgICAgcmVxdWlyZShfdG9rZW5zID4gMCk7CiAgICAgICAgLy8gYWxsIHRva2VucyBjYW4gYmUgYm9udXNlcywgYnV0IHRoZXkgY2FudCBiZSBsZXNzIHRoYW4gYm9udXNlcwogICAgICAgIHJlcXVpcmUoX3Rva2VucyA+PSBfYm9udXMpOwogICAgICAgIC8vIGNoZWNrIGNhcHBzCiAgICAgICAgaWYgKGNyb3dkc2FsZVBoYXNlID09IENyb3dkc2FsZVBoYXNlLlBoYXNlT25lKSB7CiAgICAgICAgICAgIC8vIGVuc3VyZSB3ZSBhcmUgbm90IG92ZXIgcGhhc2UgMSBjYXAgYWZ0ZXIgdGhpcyBjb250cmlidXRpb24KICAgICAgICAgICAgcmVxdWlyZSh0b3RhbENlbnRzR2F0aGVyZWQuYWRkKF9jb250cmlidXRpb24pIDw9IHBoYXNlT25lQ2FwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBlbnN1cmUgd2UgYXJlIG5vdCBvdmVyIGhhcmQgY2FwIGFmdGVyIHRoaXMgY29udHJpYnV0aW9uCiAgICAgICAgICAgIHJlcXVpcmUodG90YWxDZW50c0dhdGhlcmVkLmFkZChfY29udHJpYnV0aW9uKSA8PSBoYXJkQ2FwKTsKICAgICAgICB9CgogICAgICAgIHVpbnQgcmVtYWluaW5nQ29udHJpYnV0aW9uID0gX2NvbnRyaWJ1dGlvbjsKCiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNvbnRyaWJ1dGlvbiBmaWxscyB0aGUgY3VycmVudCBib251cyBwaGFzZS4gSWYgc28sIGJyZWFrIGl0IHVwIGluIHBhcnRzLAogICAgICAgIC8vIG1pbnQgdG9rZW5zIGZvciBlYWNoIHBhcnQgc2VwYXJhdGVseSwgYXNzaWduIGJvbnVzZXMsIHRyaWdnZXIgZXZlbnRzLiBGb3IgdHJhbnNwYXJlbmN5LgogICAgICAgIGRvIHsKICAgICAgICAgIC8vIDEgLSBjYWxjdWxhdGUgY29udHJpYnV0aW9uIHBhcnQgZm9yIGN1cnJlbnQgYm9udXMgc3RhZ2UKICAgICAgICAgIHVpbnQgY2VudHNMZWZ0SW5QaGFzZSA9IGNhbGN1bGF0ZUNlbnRzTGVmdEluUGhhc2UocmVtYWluaW5nQ29udHJpYnV0aW9uKTsKICAgICAgICAgIHVpbnQgY29udHJpYnV0aW9uUGFydCA9IG1pbihyZW1haW5pbmdDb250cmlidXRpb24sIGNlbnRzTGVmdEluUGhhc2UpOwoKICAgICAgICAgIC8vIDMgLSBsb2cgdGhlIHByb2Nlc3NlZCBwYXJ0IG9mIHRoZSBjb250cmlidXRpb24KICAgICAgICAgIHRvdGFsQ2VudHNHYXRoZXJlZCA9IHRvdGFsQ2VudHNHYXRoZXJlZC5hZGQoY29udHJpYnV0aW9uUGFydCk7CiAgICAgICAgICByZW1haW5pbmdDb250cmlidXRpb24gPSByZW1haW5pbmdDb250cmlidXRpb24uc3ViKGNvbnRyaWJ1dGlvblBhcnQpOwoKICAgICAgICAgIC8vIDQgLSBhZHZhbmNlIGJvbnVzIHBoYXNlCiAgICAgICAgICBpZiAoKHJlbWFpbmluZ0NvbnRyaWJ1dGlvbiA9PSBjZW50c0xlZnRJblBoYXNlKSAmJiAoYm9udXNQaGFzZSAhPSBCb251c1BoYXNlLk5vbmUpKSB7CiAgICAgICAgICAgICAgYWR2YW5jZUJvbnVzUGhhc2UoKTsKICAgICAgICAgIH0KCiAgICAgICAgfSB3aGlsZSAocmVtYWluaW5nQ29udHJpYnV0aW9uID4gMCk7CgogICAgICAgIC8vIGFkZCB0b2tlbnMgdG8gdGhlIGJlbmVmaWNpYXJ5CiAgICAgICAgbWludEFuZFVwZGF0ZShfYmVuZWZpY2lhcnksIF90b2tlbnMpOwoKICAgICAgICAvLyBpZiB0b2tlbnMgYXJlbnQgZXF1YWwgdG8gYm9udXMKICAgICAgICBpZiAoX3Rva2VucyA+IF9ib251cykgewogICAgICAgICAgVG9rZW5zQWxsb2NhdGVkKF9iZW5lZmljaWFyeSwgX2NvbnRyaWJ1dGlvbiwgX3Rva2Vucy5zdWIoX2JvbnVzKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiBib251cyBleGlzdHMKICAgICAgICBpZiAoX2JvbnVzID4gMCkgewogICAgICAgICAgQm9udXNJc3N1ZWQoX2JlbmVmaWNpYXJ5LCBfYm9udXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSXNzdWVzIHRoZSByZXdhcmRzIGZvciBmb3VuZGVycyBhbmQgZWFybHkgY29udHJpYnV0b3JzLiAxOCUgYW5kIDEyJSBvZiB0aGUgdG90YWwgdG9rZW4gc3VwcGx5IGJ5IHRoZSBlbmQKICAgICAqICAgb2YgdGhlIGNyb3dkc2FsZSwgcmVzcGVjdGl2ZWx5LCBpbmNsdWRpbmcgYWxsIHRoZSB0b2tlbiBib251c2VzIG9uIGVhcmx5IGNvbnRyaWJ1dGlvbnMuIENhbiBvbmx5IGJlCiAgICAgKiAgIGNhbGxlZCBhZnRlciB0aGUgZW5kIG9mIHRoZSBjcm93ZHNhbGUgcGhhc2UsIGVuZHMgdGhlIGN1cnJlbnQgcGhhc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJld2FyZEZvdW5kZXJzQW5kUGFydG5lcnMoKSBleHRlcm5hbCBvbmx5TWFuYWdlciBvbmx5VmFsaWRQaGFzZSBvbmx5VW5wYXVzZWQgewogICAgICAgIHVpbnQgdG9rZW5zRHVyaW5nVGhpc1BoYXNlOwogICAgICAgIGlmIChjcm93ZHNhbGVQaGFzZSA9PSBDcm93ZHNhbGVQaGFzZS5QaGFzZU9uZSkgewogICAgICAgICAgICB0b2tlbnNEdXJpbmdUaGlzUGhhc2UgPSB0b3RhbFRva2VuU3VwcGx5OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRva2Vuc0R1cmluZ1RoaXNQaGFzZSA9IHRvdGFsVG9rZW5TdXBwbHkgLSB0b2tlbnNEdXJpbmdQaGFzZU9uZTsKICAgICAgICB9CgogICAgICAgIC8vIFRvdGFsIHRva2VucyBzb2xkIGlzIDcwJSBvZiB0aGUgb3ZlcmFsbCBzdXBwbHksIGZvdW5kZXJzJyBzaGFyZSBpcyAxOCUsIGVhcmx5IGNvbnRyaWJ1dG9ycycgaXMgMTIlCiAgICAgICAgLy8gU28gdG8gb2J0YWluIHRob3NlIGZyb20gdG9rZW5zIHNvbGQsIG11bHRpcGx5IHRoZW0gYnkgMC4xOCAvIDAuNyBhbmQgMC4xMiAvIDAuNyByZXNwZWN0aXZlbHkuCiAgICAgICAgdWludCB0b2tlbnNGb3JGb3VuZGVycyA9IHRva2Vuc0R1cmluZ1RoaXNQaGFzZS5tdWwoMjU3KS5kaXYoMTAwMCk7IC8vIDAuMjU3IG9mIDAuNyBpcyAwLjE4IG9mIDEKICAgICAgICB1aW50IHRva2Vuc0ZvclBhcnRuZXJzID0gdG9rZW5zRHVyaW5nVGhpc1BoYXNlLm11bCgxNzEpLmRpdigxMDAwKTsgLy8gMC4xNzEgb2YgMC43IGlzIDAuMTIgb2YgMQoKICAgICAgICB0b2tlbkNvbnRyYWN0Lm1pbnQocGFydG5lcnNXYWxsZXQsIHRva2Vuc0ZvclBhcnRuZXJzKTsKCiAgICAgICAgaWYgKGNyb3dkc2FsZVBoYXNlID09IENyb3dkc2FsZVBoYXNlLlBoYXNlT25lKSB7CiAgICAgICAgICAgIHZlc3RpbmdXYWxsZXQgPSBuZXcgVmVzdGluZ1dhbGxldChmb3VuZGVyc1dhbGxldCwgYWRkcmVzcyh0b2tlbkNvbnRyYWN0KSk7CiAgICAgICAgICAgIHRva2VuQ29udHJhY3QubWludChhZGRyZXNzKHZlc3RpbmdXYWxsZXQpLCB0b2tlbnNGb3JGb3VuZGVycyk7CiAgICAgICAgICAgIEZvdW5kZXJzQW5kUGFydG5lcnNUb2tlbnNJc3N1ZWQoYWRkcmVzcyh2ZXN0aW5nV2FsbGV0KSwgdG9rZW5zRm9yRm91bmRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydG5lcnNXYWxsZXQsICAgICAgICAgdG9rZW5zRm9yUGFydG5lcnMpOwoKICAgICAgICAgICAgLy8gU3RvcmUgdGhlIHRvdGFsIHN1bSBjb2xsZWN0ZWQgZHVyaW5nIHBoYXNlIG9uZSBmb3IgY2FsY3VsYXRpb25zIGluIHBoYXNlIHR3by4KICAgICAgICAgICAgY2VudHNJblBoYXNlT25lID0gdG90YWxDZW50c0dhdGhlcmVkOwogICAgICAgICAgICB0b2tlbnNEdXJpbmdQaGFzZU9uZSA9IHRvdGFsVG9rZW5TdXBwbHk7CgogICAgICAgICAgICAvLyBFbmFibGUgdG9rZW4gdHJhbnNmZXIuCiAgICAgICAgICAgIHRva2VuQ29udHJhY3QudW5mcmVlemUoKTsKICAgICAgICAgICAgY3Jvd2RzYWxlUGhhc2UgPSBDcm93ZHNhbGVQaGFzZS5CZXR3ZWVuUGhhc2VzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRva2VuQ29udHJhY3QubWludChhZGRyZXNzKHZlc3RpbmdXYWxsZXQpLCB0b2tlbnNGb3JGb3VuZGVycyk7CiAgICAgICAgICAgIHZlc3RpbmdXYWxsZXQubGF1bmNoVmVzdGluZygpOwoKICAgICAgICAgICAgRm91bmRlcnNBbmRQYXJ0bmVyc1Rva2Vuc0lzc3VlZChhZGRyZXNzKHZlc3RpbmdXYWxsZXQpLCB0b2tlbnNGb3JGb3VuZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0bmVyc1dhbGxldCwgICAgICAgICB0b2tlbnNGb3JQYXJ0bmVycyk7CiAgICAgICAgICAgIGNyb3dkc2FsZVBoYXNlID0gQ3Jvd2RzYWxlUGhhc2UuRmluaXNoZWQ7CiAgICAgICAgfQoKICAgICAgICB0b2tlbkNvbnRyYWN0LmVuZE1pbnRpbmcoKTsKICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXQgdGhlIENBUFAgLyBVU0QgcmF0ZSBmb3IgUGhhc2UgdHdvLCBhbmQgdGhlbiBzdGFydCB0aGUgc2Vjb25kIHBoYXNlIG9mIHRva2VuIGFsbG9jYXRpb24uCiAgICAgKiAgICAgICAgQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjcm93ZHNhbGUgbWFuYWdlci4KICAgICAqIF90b2tlblJhdGUgSG93IG1hbnkgQ0FQUCBwZXIgMSBVU0QgY2VudC4gQXMgZG9sbGFycywgQ0FQUCBoYXMgdHdvIGRlY2ltYWxzLgogICAgICogICAgICAgICAgICBGb3IgaW5zdGFuY2U6IHRva2VuUmF0ZSA9IDEyNSBtZWFucyAiMS4yNSBDQVBQIHBlciBVU0QgY2VudCIgPD0+ICIxMjUgQ0FQUCBwZXIgVVNEIi4KICAgICAqLwogICAgZnVuY3Rpb24gYmVnaW5QaGFzZVR3byh1aW50IF90b2tlblJhdGUpIGV4dGVybmFsIG9ubHlNYW5hZ2VyIG9ubHlVbnBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShjcm93ZHNhbGVQaGFzZSA9PSBDcm93ZHNhbGVQaGFzZS5CZXR3ZWVuUGhhc2VzKTsKICAgICAgICByZXF1aXJlKF90b2tlblJhdGUgIT0gMCk7CgogICAgICAgIHRva2VuUmF0ZSA9IF90b2tlblJhdGU7CiAgICAgICAgY3Jvd2RzYWxlUGhhc2UgPSBDcm93ZHNhbGVQaGFzZS5QaGFzZVR3bzsKICAgICAgICBib251c1BoYXNlID0gQm9udXNQaGFzZS5UZW5QZXJjZW50OwogICAgICAgIHRva2VuQ29udHJhY3Quc3RhcnRNaW50aW5nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0byBmcmVlemUgYWxsIHRva2VuIHRyYW5zZmVycyBpbiB0aGUgZnV0dXJlCiAgICAgKiBUaGlzIGlzIGRvbmUgdG8gYWxsb3cgbWlncmF0aW5nIHRvIG5ldyBjb250cmFjdCBpbiB0aGUgZnV0dXJlCiAgICAgKiBJZiBzdWNoIG5lZWQgZXZlciBhcmlzZXMgKGllIE1pZ3JhdGlvbiB0byBFUkMyMywgb3IgYW55dGhpbmcgdGhhdCBjb21tdW5pdHkgZGVjaWRlcyB3b3J0aCBkb2luZykKICAgICAqLwogICAgZnVuY3Rpb24gZnJlZXplKCkgZXh0ZXJuYWwgb25seVVucGF1c2VkIG9ubHlFbWVyZ2VuY3kgewogICAgICAgIHJlcXVpcmUoY3Jvd2RzYWxlUGhhc2UgIT0gQ3Jvd2RzYWxlUGhhc2UuUGhhc2VPbmUpOwogICAgICAgIHRva2VuQ29udHJhY3QuZnJlZXplKCk7CiAgICB9CgogICAgZnVuY3Rpb24gdW5mcmVlemUoKSBleHRlcm5hbCBvbmx5VW5wYXVzZWQgb25seUVtZXJnZW5jeSB7CiAgICAgICAgcmVxdWlyZShjcm93ZHNhbGVQaGFzZSAhPSBDcm93ZHNhbGVQaGFzZS5QaGFzZU9uZSk7CiAgICAgICAgdG9rZW5Db250cmFjdC51bmZyZWV6ZSgpOwogICAgfQoKICAgIC8vIElOVEVSTkFMIEZVTkNUSU9OUwogICAgLy8gPT09PT09PT09PT09PT09PT09PT0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUNlbnRzTGVmdEluUGhhc2UodWludCBfcmVtYWluaW5nQ29udHJpYnV0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIC8vIFRlbiBwZXJjZW50IGJvbnVzZXMgaGFwcGVuIGluIGJvdGggUGhhc2UgT25lIGFuZCBQaGFzZSB0d28sIHRoZXJlZm9yZToKICAgICAgICAvLyBUYWtlIHRoZSBib251cyB0aWVyIHNpemUsIHN1YnRyYWN0IHRoZSB0b3RhbCBtb25leSBnYXRoZXJlZCBpbiB0aGUgY3VycmVudCBwaGFzZQogICAgICAgIGlmIChib251c1BoYXNlID09IEJvbnVzUGhhc2UuVGVuUGVyY2VudCkgewogICAgICAgICAgICByZXR1cm4gYm9udXNUaWVyU2l6ZS5zdWIodG90YWxDZW50c0dhdGhlcmVkLnN1YihjZW50c0luUGhhc2VPbmUpKTsKICAgICAgICB9CgogICAgICAgIGlmIChib251c1BoYXNlID09IEJvbnVzUGhhc2UuRml2ZVBlcmNlbnQpIHsKICAgICAgICAgIC8vIEZpdmUgcGVyY2VudCBib251c2VzIG9ubHkgaGFwcGVuIGluIFBoYXNlIE9uZSwgc28gbm8gbmVlZCB0byBhY2NvdW50CiAgICAgICAgICAvLyBmb3IgdGhlIGZpcnN0IHBoYXNlIHNlcGFyYXRlbHkuCiAgICAgICAgICByZXR1cm4gYm9udXNUaWVyU2l6ZS5tdWwoMikuc3ViKHRvdGFsQ2VudHNHYXRoZXJlZCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX3JlbWFpbmluZ0NvbnRyaWJ1dGlvbjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50QW5kVXBkYXRlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF90b2tlbnNUb01pbnQpIGludGVybmFsIHsKICAgICAgICB0b2tlbkNvbnRyYWN0Lm1pbnQoX2JlbmVmaWNpYXJ5LCBfdG9rZW5zVG9NaW50KTsKICAgICAgICB0b3RhbFRva2VuU3VwcGx5ID0gdG90YWxUb2tlblN1cHBseS5hZGQoX3Rva2Vuc1RvTWludCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY3VsYXRlVGllckJvbnVzKHVpbnQgX2NvbnRyaWJ1dGlvbikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIEFsbCBib251c2VzIGFyZSBhZGRpdGl2ZSBhbmQgbm90IG11bHRpcGxpY2F0aXZlCiAgICAgICAgLy8gQ2FsY3VsYXRlIGJvbnVzIG9uIGNvbnRyaWJ1dGlvbiBzaXplLCB0aGVuIGNvbnZlcnQgaXQgdG8gYm9udXMgdG9rZW5zLgogICAgICAgIHVpbnQgdGllckJvbnVzID0gMDsKCiAgICAgICAgLy8gdGllckJvbnVzIHRpZXIgdGllckJvbnVzZXMuIFdlIG1ha2Ugc3VyZSBpbiBpc3N1ZVRva2VucyB0aGF0IHRoZSBwcm9jZXNzZWQgY29udHJpYnV0aW9uIFwKICAgICAgICAvLyBmYWxscyBlbnRpcmVseSBpbnRvIG9uZSB0aWVyCiAgICAgICAgaWYgKGJvbnVzUGhhc2UgPT0gQm9udXNQaGFzZS5UZW5QZXJjZW50KSB7CiAgICAgICAgICAgIHRpZXJCb251cyA9IF9jb250cmlidXRpb24uZGl2KDEwKTsgLy8gbXVsdGlwbHkgYnkgMC4xCiAgICAgICAgfSBlbHNlIGlmIChib251c1BoYXNlID09IEJvbnVzUGhhc2UuRml2ZVBlcmNlbnQpIHsKICAgICAgICAgICAgdGllckJvbnVzID0gX2NvbnRyaWJ1dGlvbi5kaXYoMjApOyAvLyBtdWx0aXBseSBieSAwLjA1CiAgICAgICAgfQoKICAgICAgICB0aWVyQm9udXMgPSB0aWVyQm9udXMubXVsKHRva2VuUmF0ZSk7CiAgICAgICAgcmV0dXJuIHRpZXJCb251czsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVTaXplQm9udXModWludCBfY29udHJpYnV0aW9uKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBzaXplQm9udXMgPSAwOwogICAgICAgIGlmIChjcm93ZHNhbGVQaGFzZSA9PSBDcm93ZHNhbGVQaGFzZS5QaGFzZU9uZSkgewogICAgICAgICAgICAvLyAxMCUgZm9yIGh1Z2UgY29udHJpYnV0aW9uCiAgICAgICAgICAgIGlmIChfY29udHJpYnV0aW9uID49IGh1Z2VDb250cmlidXRpb25Cb3VuZCkgewogICAgICAgICAgICAgICAgc2l6ZUJvbnVzID0gX2NvbnRyaWJ1dGlvbi5kaXYoMTApOyAvLyBtdWx0aXBseSBieSAwLjEKICAgICAgICAgICAgLy8gNSUgZm9yIGJpZyBvbmUKICAgICAgICAgICAgfSBlbHNlIGlmIChfY29udHJpYnV0aW9uID49IGJpZ0NvbnRyaWJ1dGlvbkJvdW5kKSB7CiAgICAgICAgICAgICAgICBzaXplQm9udXMgPSBfY29udHJpYnV0aW9uLmRpdigyMCk7IC8vIG11bHRpcGx5IGJ5IDAuMDUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2l6ZUJvbnVzID0gc2l6ZUJvbnVzLm11bCh0b2tlblJhdGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2l6ZUJvbnVzOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgQWR2YW5jZSB0aGUgYm9udXMgcGhhc2UgdG8gbmV4dCB0aWVyIHdoZW4gYXBwcm9wcmlhdGUsIGRvIG5vdGhpbmcgb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBhZHZhbmNlQm9udXNQaGFzZSgpIGludGVybmFsIG9ubHlWYWxpZFBoYXNlIHsKICAgICAgICBpZiAoY3Jvd2RzYWxlUGhhc2UgPT0gQ3Jvd2RzYWxlUGhhc2UuUGhhc2VPbmUpIHsKICAgICAgICAgICAgaWYgKGJvbnVzUGhhc2UgPT0gQm9udXNQaGFzZS5UZW5QZXJjZW50KSB7CiAgICAgICAgICAgICAgICBib251c1BoYXNlID0gQm9udXNQaGFzZS5GaXZlUGVyY2VudDsKICAgICAgICAgICAgfSBlbHNlIGlmIChib251c1BoYXNlID09IEJvbnVzUGhhc2UuRml2ZVBlcmNlbnQpIHsKICAgICAgICAgICAgICAgIGJvbnVzUGhhc2UgPSBCb251c1BoYXNlLk5vbmU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGJvbnVzUGhhc2UgPT0gQm9udXNQaGFzZS5UZW5QZXJjZW50KSB7CiAgICAgICAgICAgIGJvbnVzUGhhc2UgPSBCb251c1BoYXNlLk5vbmU7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50IF9hLCB1aW50IF9iKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIF9hIDwgX2IgPyBfYSA6IF9iOwogICAgfQoKICAgIC8qKgogICAgICogTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlWYWxpZFBoYXNlKCkgewogICAgICAgIHJlcXVpcmUoIGNyb3dkc2FsZVBoYXNlID09IENyb3dkc2FsZVBoYXNlLlBoYXNlT25lCiAgICAgICAgICAgICAgICAgfHwgY3Jvd2RzYWxlUGhhc2UgPT0gQ3Jvd2RzYWxlUGhhc2UuUGhhc2VUd28gKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIERvIG5vdCBhbGxvdyB0byBzZW5kIG1vbmV5IGRpcmVjdGx5IHRvIHRoaXMgY29udHJhY3QKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIHJldmVydCgpOwogICAgfQp9'.
	

]
