Class {
	#name : #SRT2424cb26cee4943fa58d05c392273f34b6980960,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2424cb26cee4943fa58d05c392273f34b6980960 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBEZWxlZ2F0ZUVSQzIwIHsKICBmdW5jdGlvbiBkZWxlZ2F0ZVRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gZGVsZWdhdGVCYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGRlbGVnYXRlVHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSwgYWRkcmVzcyBvcmlnU2VuZGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gZGVsZWdhdGVBbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBkZWxlZ2F0ZVRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUsIGFkZHJlc3Mgb3JpZ1NlbmRlcikgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGRlbGVnYXRlQXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUsIGFkZHJlc3Mgb3JpZ1NlbmRlcikgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGRlbGVnYXRlSW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYWRkZWRWYWx1ZSwgYWRkcmVzcyBvcmlnU2VuZGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gZGVsZWdhdGVEZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBzdWJ0cmFjdGVkVmFsdWUsIGFkZHJlc3Mgb3JpZ1NlbmRlcikgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CgpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgLyoqCiAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogIH0KfQoKY29udHJhY3QgQ2FuUmVjbGFpbVRva2VuIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgLyoqCiAgICogQGRldiBSZWNsYWltIGFsbCBFUkMyMEJhc2ljIGNvbXBhdGlibGUgdG9rZW5zCiAgICogQHBhcmFtIHRva2VuIEVSQzIwQmFzaWMgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0CiAgICovCiAgZnVuY3Rpb24gcmVjbGFpbVRva2VuKEVSQzIwQmFzaWMgdG9rZW4pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB0b2tlbi5zYWZlVHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogIH0KCn0KCmNvbnRyYWN0IENsYWltYWJsZSBpcyBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXI7CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBwZW5kaW5nT3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seVBlbmRpbmdPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwZW5kaW5nT3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHNldCB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHBlbmRpbmdPd25lciA9IG5ld093bmVyOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSB0cmFuc2Zlci4KICAgKi8KICBmdW5jdGlvbiBjbGFpbU93bmVyc2hpcCgpIG9ubHlQZW5kaW5nT3duZXIgcHVibGljIHsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBwZW5kaW5nT3duZXIpOwogICAgb3duZXIgPSBwZW5kaW5nT3duZXI7CiAgICBwZW5kaW5nT3duZXIgPSBhZGRyZXNzKDApOwogIH0KfQoKY29udHJhY3QgQWRkcmVzc0xpc3QgaXMgQ2xhaW1hYmxlIHsKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIG9uTGlzdDsKCiAgICBmdW5jdGlvbiBBZGRyZXNzTGlzdChzdHJpbmcgX25hbWUsIGJvb2wgbnVsbFZhbHVlKSBwdWJsaWMgewogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBvbkxpc3RbMHgwXSA9IG51bGxWYWx1ZTsKICAgIH0KICAgIGV2ZW50IENoYW5nZVdoaXRlTGlzdChhZGRyZXNzIGluZGV4ZWQgdG8sIGJvb2wgb25MaXN0KTsKCiAgICAvLyBTZXQgd2hldGhlciBfdG8gaXMgb24gdGhlIGxpc3Qgb3Igbm90LiBXaGV0aGVyIDB4MCBpcyBvbiB0aGUgbGlzdAogICAgLy8gb3Igbm90IGNhbm5vdCBiZSBzZXQgaGVyZSAtIGl0IGlzIHNldCBvbmNlIGFuZCBmb3IgYWxsIGJ5IHRoZSBjb25zdHJ1Y3Rvci4KICAgIGZ1bmN0aW9uIGNoYW5nZUxpc3QoYWRkcmVzcyBfdG8sIGJvb2wgX29uTGlzdCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gMHgwKTsKICAgICAgICBpZiAob25MaXN0W190b10gIT0gX29uTGlzdCkgewogICAgICAgICAgICBvbkxpc3RbX3RvXSA9IF9vbkxpc3Q7CiAgICAgICAgICAgIENoYW5nZVdoaXRlTGlzdChfdG8sIF9vbkxpc3QpOwogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgSGFzTm9Db250cmFjdHMgaXMgT3duYWJsZSB7CgogIC8qKgogICAqIEBkZXYgUmVjbGFpbSBvd25lcnNoaXAgb2YgT3duYWJsZSBjb250cmFjdHMKICAgKiBAcGFyYW0gY29udHJhY3RBZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBPd25hYmxlIHRvIGJlIHJlY2xhaW1lZC4KICAgKi8KICBmdW5jdGlvbiByZWNsYWltQ29udHJhY3QoYWRkcmVzcyBjb250cmFjdEFkZHIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBPd25hYmxlIGNvbnRyYWN0SW5zdCA9IE93bmFibGUoY29udHJhY3RBZGRyKTsKICAgIGNvbnRyYWN0SW5zdC50cmFuc2Zlck93bmVyc2hpcChvd25lcik7CiAgfQp9Cgpjb250cmFjdCBIYXNOb0V0aGVyIGlzIE93bmFibGUgewoKICAvKioKICAqIEBkZXYgQ29uc3RydWN0b3IgdGhhdCByZWplY3RzIGluY29taW5nIEV0aGVyCiAgKiBAZGV2IFRoZSBgcGF5YWJsZWAgZmxhZyBpcyBhZGRlZCBzbyB3ZSBjYW4gYWNjZXNzIGBtc2cudmFsdWVgIHdpdGhvdXQgY29tcGlsZXIgd2FybmluZy4gSWYgd2UKICAqIGxlYXZlIG91dCBwYXlhYmxlLCB0aGVuIFNvbGlkaXR5IHdpbGwgYWxsb3cgaW5oZXJpdGluZyBjb250cmFjdHMgdG8gaW1wbGVtZW50IGEgcGF5YWJsZQogICogY29uc3RydWN0b3IuIEJ5IGRvaW5nIGl0IHRoaXMgd2F5IHdlIHByZXZlbnQgYSBwYXlhYmxlIGNvbnN0cnVjdG9yIGZyb20gd29ya2luZy4gQWx0ZXJuYXRpdmVseQogICogd2UgY291bGQgdXNlIGFzc2VtYmx5IHRvIGFjY2VzcyBtc2cudmFsdWUuCiAgKi8KICBmdW5jdGlvbiBIYXNOb0V0aGVyKCkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CiAgfQoKICAvKioKICAgKiBAZGV2IERpc2FsbG93cyBkaXJlY3Qgc2VuZCBieSBzZXR0aW5ncyBhIGRlZmF1bHQgZnVuY3Rpb24gd2l0aG91dCB0aGUgYHBheWFibGVgIGZsYWcuCiAgICovCiAgZnVuY3Rpb24oKSBleHRlcm5hbCB7CiAgfQoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIGFsbCBFdGhlciBoZWxkIGJ5IHRoZSBjb250cmFjdCB0byB0aGUgb3duZXIuCiAgICovCiAgZnVuY3Rpb24gcmVjbGFpbUV0aGVyKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGFzc2VydChvd25lci5zZW5kKHRoaXMuYmFsYW5jZSkpOwogIH0KfQoKY29udHJhY3QgSGFzTm9Ub2tlbnMgaXMgQ2FuUmVjbGFpbVRva2VuIHsKCiAvKioKICAqIEBkZXYgUmVqZWN0IGFsbCBFUkMyMjMgY29tcGF0aWJsZSB0b2tlbnMKICAqIEBwYXJhbSBmcm9tXyBhZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgaXMgdHJhbnNmZXJyaW5nIHRoZSB0b2tlbnMKICAqIEBwYXJhbSB2YWx1ZV8gdWludDI1NiB0aGUgYW1vdW50IG9mIHRoZSBzcGVjaWZpZWQgdG9rZW4KICAqIEBwYXJhbSBkYXRhXyBCeXRlcyBUaGUgZGF0YSBwYXNzZWQgZnJvbSB0aGUgY2FsbGVyLgogICovCiAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIGZyb21fLCB1aW50MjU2IHZhbHVlXywgYnl0ZXMgZGF0YV8pIGV4dGVybmFsIHsKICAgIGZyb21fOwogICAgdmFsdWVfOwogICAgZGF0YV87CiAgICByZXZlcnQoKTsKICB9Cgp9Cgpjb250cmFjdCBOb093bmVyIGlzIEhhc05vRXRoZXIsIEhhc05vVG9rZW5zLCBIYXNOb0NvbnRyYWN0cyB7Cn0KCmNvbnRyYWN0IEFsbG93YW5jZVNoZWV0IGlzIENsYWltYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBhbGxvd2FuY2VPZjsKCiAgICBmdW5jdGlvbiBhZGRBbGxvd2FuY2UoYWRkcmVzcyB0b2tlbkhvbGRlciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBhbGxvd2FuY2VPZlt0b2tlbkhvbGRlcl1bc3BlbmRlcl0gPSBhbGxvd2FuY2VPZlt0b2tlbkhvbGRlcl1bc3BlbmRlcl0uYWRkKHZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWJBbGxvd2FuY2UoYWRkcmVzcyB0b2tlbkhvbGRlciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBhbGxvd2FuY2VPZlt0b2tlbkhvbGRlcl1bc3BlbmRlcl0gPSBhbGxvd2FuY2VPZlt0b2tlbkhvbGRlcl1bc3BlbmRlcl0uc3ViKHZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBbGxvd2FuY2UoYWRkcmVzcyB0b2tlbkhvbGRlciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBhbGxvd2FuY2VPZlt0b2tlbkhvbGRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgIH0KfQoKY29udHJhY3QgQmFsYW5jZVNoZWV0IGlzIENsYWltYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlT2Y7CgogICAgZnVuY3Rpb24gYWRkQmFsYW5jZShhZGRyZXNzIGFkZHIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGJhbGFuY2VPZlthZGRyXSA9IGJhbGFuY2VPZlthZGRyXS5hZGQodmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1YkJhbGFuY2UoYWRkcmVzcyBhZGRyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBiYWxhbmNlT2ZbYWRkcl0gPSBiYWxhbmNlT2ZbYWRkcl0uc3ViKHZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCYWxhbmNlKGFkZHJlc3MgYWRkciwgdWludDI1NiB2YWx1ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgYmFsYW5jZU9mW2FkZHJdID0gdmFsdWU7CiAgICB9Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYywgQ2xhaW1hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgQmFsYW5jZVNoZWV0IGJhbGFuY2VzOwoKICB1aW50MjU2IHRvdGFsU3VwcGx5XzsKCiAgZnVuY3Rpb24gc2V0QmFsYW5jZVNoZWV0KGFkZHJlc3Mgc2hlZXQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBiYWxhbmNlcyA9IEJhbGFuY2VTaGVldChzaGVldCk7CiAgICBiYWxhbmNlcy5jbGFpbU93bmVyc2hpcCgpOwogIH0KCiAgLyoqCiAgKiBAZGV2IHRvdGFsIG51bWJlciBvZiB0b2tlbnMgaW4gZXhpc3RlbmNlCiAgKi8KICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b3RhbFN1cHBseV87CiAgfQoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0cmFuc2ZlckFsbEFyZ3NOb0FsbG93YW5jZShtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyQWxsQXJnc05vQWxsb3dhbmNlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF9mcm9tICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXMuYmFsYW5jZU9mKF9mcm9tKSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXMuc3ViQmFsYW5jZShfZnJvbSwgX3ZhbHVlKTsKICAgIGJhbGFuY2VzLmFkZEJhbGFuY2UoX3RvLCBfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXMuYmFsYW5jZU9mKF9vd25lcik7CiAgfQp9Cgpjb250cmFjdCBCdXJuYWJsZVRva2VuIGlzIEJhc2ljVG9rZW4gewoKICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBidXJuZXIsIHVpbnQyNTYgdmFsdWUpOwoKICAvKioKICAgKiBAZGV2IEJ1cm5zIGEgc3BlY2lmaWMgYW1vdW50IG9mIHRva2Vucy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgYnVybmVkLgogICAqLwogIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlcy5iYWxhbmNlT2YobXNnLnNlbmRlcikpOwogICAgLy8gbm8gbmVlZCB0byByZXF1aXJlIHZhbHVlIDw9IHRvdGFsU3VwcGx5LCBzaW5jZSB0aGF0IHdvdWxkIGltcGx5IHRoZQogICAgLy8gc2VuZGVyJ3MgYmFsYW5jZSBpcyBncmVhdGVyIHRoYW4gdGhlIHRvdGFsU3VwcGx5LCB3aGljaCAqc2hvdWxkKiBiZSBhbiBhc3NlcnRpb24gZmFpbHVyZQoKICAgIGFkZHJlc3MgYnVybmVyID0gbXNnLnNlbmRlcjsKICAgIGJhbGFuY2VzLnN1YkJhbGFuY2UoYnVybmVyLCBfdmFsdWUpOwogICAgdG90YWxTdXBwbHlfID0gdG90YWxTdXBwbHlfLnN1YihfdmFsdWUpOwogICAgQnVybihidXJuZXIsIF92YWx1ZSk7CiAgICBUcmFuc2ZlcihidXJuZXIsIGFkZHJlc3MoMCksIF92YWx1ZSk7CiAgfQp9Cgpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKbGlicmFyeSBTYWZlRVJDMjAgewogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlcihFUkMyMEJhc2ljIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKEVSQzIwIHRva2VuLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlQXBwcm92ZShFUkMyMCB0b2tlbiwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4uYXBwcm92ZShzcGVuZGVyLCB2YWx1ZSkpOwogIH0KfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIEFsbG93YW5jZVNoZWV0IGFsbG93YW5jZXM7CgogIGZ1bmN0aW9uIHNldEFsbG93YW5jZVNoZWV0KGFkZHJlc3Mgc2hlZXQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBhbGxvd2FuY2VzID0gQWxsb3dhbmNlU2hlZXQoc2hlZXQpOwogICAgYWxsb3dhbmNlcy5jbGFpbU93bmVyc2hpcCgpOwogIH0KCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0cmFuc2ZlckFsbEFyZ3NZZXNBbGxvd2FuY2UoX2Zyb20sIF90bywgX3ZhbHVlLCBtc2cuc2VuZGVyKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJBbGxBcmdzWWVzQWxsb3dhbmNlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBzcGVuZGVyKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2FuY2VzLmFsbG93YW5jZU9mKF9mcm9tLCBzcGVuZGVyKSk7CgogICAgYWxsb3dhbmNlcy5zdWJBbGxvd2FuY2UoX2Zyb20sIHNwZW5kZXIsIF92YWx1ZSk7CiAgICB0cmFuc2ZlckFsbEFyZ3NOb0FsbG93YW5jZShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhcHByb3ZlQWxsQXJncyhfc3BlbmRlciwgX3ZhbHVlLCBtc2cuc2VuZGVyKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZUFsbEFyZ3MoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUsIGFkZHJlc3MgX3Rva2VuSG9sZGVyKSBpbnRlcm5hbCB7CiAgICBhbGxvd2FuY2VzLnNldEFsbG93YW5jZShfdG9rZW5Ib2xkZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgQXBwcm92YWwoX3Rva2VuSG9sZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93YW5jZXMuYWxsb3dhbmNlT2YoX293bmVyLCBfc3BlbmRlcik7CiAgfQoKICAvKioKICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICoKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX2FkZGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaW5jcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBpbmNyZWFzZUFwcHJvdmFsQWxsQXJncyhfc3BlbmRlciwgX2FkZGVkVmFsdWUsIG1zZy5zZW5kZXIpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsQWxsQXJncyhhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlLCBhZGRyZXNzIHRva2VuSG9sZGVyKSBpbnRlcm5hbCB7CiAgICBhbGxvd2FuY2VzLmFkZEFsbG93YW5jZSh0b2tlbkhvbGRlciwgX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKHRva2VuSG9sZGVyLCBfc3BlbmRlciwgYWxsb3dhbmNlcy5hbGxvd2FuY2VPZih0b2tlbkhvbGRlciwgX3NwZW5kZXIpKTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVjcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGRlY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICovCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBkZWNyZWFzZUFwcHJvdmFsQWxsQXJncyhfc3BlbmRlciwgX3N1YnRyYWN0ZWRWYWx1ZSwgbXNnLnNlbmRlcik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWxBbGxBcmdzKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSwgYWRkcmVzcyB0b2tlbkhvbGRlcikgaW50ZXJuYWwgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93YW5jZXMuYWxsb3dhbmNlT2YodG9rZW5Ib2xkZXIsIF9zcGVuZGVyKTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dhbmNlcy5zZXRBbGxvd2FuY2UodG9rZW5Ib2xkZXIsIF9zcGVuZGVyLCAwKTsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93YW5jZXMuc3ViQWxsb3dhbmNlKHRva2VuSG9sZGVyLCBfc3BlbmRlciwgX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbCh0b2tlbkhvbGRlciwgX3NwZW5kZXIsIGFsbG93YW5jZXMuYWxsb3dhbmNlT2YodG9rZW5Ib2xkZXIsIF9zcGVuZGVyKSk7CiAgfQoKfQoKY29udHJhY3QgQ2FuRGVsZWdhdGUgaXMgU3RhbmRhcmRUb2tlbiB7CiAgICAvLyBJZiB0aGlzIGNvbnRyYWN0IG5lZWRzIHRvIGJlIHVwZ3JhZGVkLCB0aGUgbmV3IGNvbnRyYWN0IHdpbGwgYmUgc3RvcmVkCiAgICAvLyBpbiAnZGVsZWdhdGUnIGFuZCBhbnkgRVJDMjAgY2FsbHMgdG8gdGhpcyBjb250cmFjdCB3aWxsIGJlIGRlbGVnYXRlZCB0byB0aGF0IG9uZS4KICAgIERlbGVnYXRlRVJDMjAgcHVibGljIGRlbGVnYXRlOwoKICAgIGV2ZW50IERlbGVnYXRlZFRvKGFkZHJlc3MgaW5kZXhlZCBuZXdDb250cmFjdCk7CgogICAgLy8gQ2FuIHVuZGVsZWdhdGUgYnkgcGFzc2luZyBpbiBuZXdDb250cmFjdCA9IGFkZHJlc3MoMCkKICAgIGZ1bmN0aW9uIGRlbGVnYXRlVG9OZXdDb250cmFjdChEZWxlZ2F0ZUVSQzIwIG5ld0NvbnRyYWN0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBkZWxlZ2F0ZSA9IG5ld0NvbnRyYWN0OwogICAgICAgIERlbGVnYXRlZFRvKGRlbGVnYXRlKTsKICAgIH0KCiAgICAvLyBJZiBhIGRlbGVnYXRlIGhhcyBiZWVuIGRlc2lnbmF0ZWQsIGFsbCBFUkMyMCBjYWxscyBhcmUgZm9yd2FyZGVkIHRvIGl0CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChkZWxlZ2F0ZSA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci50cmFuc2Zlcih0bywgdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBkZWxlZ2F0ZS5kZWxlZ2F0ZVRyYW5zZmVyKHRvLCB2YWx1ZSwgbXNnLnNlbmRlcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGRlbGVnYXRlID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBkZWxlZ2F0ZS5kZWxlZ2F0ZVRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUsIG1zZy5zZW5kZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoZGVsZWdhdGUgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICByZXR1cm4gc3VwZXIuYmFsYW5jZU9mKHdobyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGRlbGVnYXRlLmRlbGVnYXRlQmFsYW5jZU9mKHdobyk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChkZWxlZ2F0ZSA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZGVsZWdhdGUuZGVsZWdhdGVBcHByb3ZlKHNwZW5kZXIsIHZhbHVlLCBtc2cuc2VuZGVyKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoZGVsZWdhdGUgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICByZXR1cm4gc3VwZXIuYWxsb3dhbmNlKF9vd25lciwgc3BlbmRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGRlbGVnYXRlLmRlbGVnYXRlQWxsb3dhbmNlKF9vd25lciwgc3BlbmRlcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChkZWxlZ2F0ZSA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci50b3RhbFN1cHBseSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBkZWxlZ2F0ZS5kZWxlZ2F0ZVRvdGFsU3VwcGx5KCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBzcGVuZGVyLCB1aW50IGFkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGRlbGVnYXRlID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoc3BlbmRlciwgYWRkZWRWYWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGRlbGVnYXRlLmRlbGVnYXRlSW5jcmVhc2VBcHByb3ZhbChzcGVuZGVyLCBhZGRlZFZhbHVlLCBtc2cuc2VuZGVyKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIHNwZW5kZXIsIHVpbnQgc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChkZWxlZ2F0ZSA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKHNwZW5kZXIsIHN1YnRyYWN0ZWRWYWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGRlbGVnYXRlLmRlbGVnYXRlRGVjcmVhc2VBcHByb3ZhbChzcGVuZGVyLCBzdWJ0cmFjdGVkVmFsdWUsIG1zZy5zZW5kZXIpOwogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgU3RhbmRhcmREZWxlZ2F0ZSBpcyBTdGFuZGFyZFRva2VuLCBEZWxlZ2F0ZUVSQzIwIHsKICAgIGFkZHJlc3MgcHVibGljIGRlbGVnYXRlZEZyb207CgogICAgbW9kaWZpZXIgb25seVNlbmRlcihhZGRyZXNzIHNvdXJjZSkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzb3VyY2UpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gc2V0RGVsZWdhdGVkRnJvbShhZGRyZXNzIGFkZHIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGRlbGVnYXRlZEZyb20gPSBhZGRyOwogICAgfQoKICAgIC8vIEFsbCBkZWxlZ2F0ZSBFUkMyMCBmdW5jdGlvbnMgYXJlIGZvcndhcmRlZCB0byBjb3JyZXNwb25kaW5nIG5vcm1hbCBmdW5jdGlvbnMKICAgIGZ1bmN0aW9uIGRlbGVnYXRlVG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5KCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsZWdhdGVCYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZU9mKHdobyk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsZWdhdGVUcmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlLCBhZGRyZXNzIG9yaWdTZW5kZXIpIG9ubHlTZW5kZXIoZGVsZWdhdGVkRnJvbSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB0cmFuc2ZlckFsbEFyZ3NOb0FsbG93YW5jZShvcmlnU2VuZGVyLCB0bywgdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlbGVnYXRlQWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhbGxvd2FuY2Uob3duZXIsIHNwZW5kZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlbGVnYXRlVHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSwgYWRkcmVzcyBvcmlnU2VuZGVyKSBvbmx5U2VuZGVyKGRlbGVnYXRlZEZyb20pIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdHJhbnNmZXJBbGxBcmdzWWVzQWxsb3dhbmNlKGZyb20sIHRvLCB2YWx1ZSwgb3JpZ1NlbmRlcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsZWdhdGVBcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSwgYWRkcmVzcyBvcmlnU2VuZGVyKSBvbmx5U2VuZGVyKGRlbGVnYXRlZEZyb20pIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYXBwcm92ZUFsbEFyZ3Moc3BlbmRlciwgdmFsdWUsIG9yaWdTZW5kZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlbGVnYXRlSW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYWRkZWRWYWx1ZSwgYWRkcmVzcyBvcmlnU2VuZGVyKSBvbmx5U2VuZGVyKGRlbGVnYXRlZEZyb20pIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgaW5jcmVhc2VBcHByb3ZhbEFsbEFyZ3Moc3BlbmRlciwgYWRkZWRWYWx1ZSwgb3JpZ1NlbmRlcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsZWdhdGVEZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBzdWJ0cmFjdGVkVmFsdWUsIGFkZHJlc3Mgb3JpZ1NlbmRlcikgb25seVNlbmRlcihkZWxlZ2F0ZWRGcm9tKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGRlY3JlYXNlQXBwcm92YWxBbGxBcmdzKHNwZW5kZXIsIHN1YnRyYWN0ZWRWYWx1ZSwgb3JpZ1NlbmRlcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IFBhdXNhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgUGF1c2FibGUgewoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXR1cm4gc3VwZXIuaW5jcmVhc2VBcHByb3ZhbChfc3BlbmRlciwgX2FkZGVkVmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLmRlY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwogIH0KfQoKY29udHJhY3QgVHJ1ZVVTRCBpcyBTdGFuZGFyZERlbGVnYXRlLCBQYXVzYWJsZVRva2VuLCBCdXJuYWJsZVRva2VuLCBOb093bmVyLCBDYW5EZWxlZ2F0ZSB7CiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAiVHJ1ZVVTRCI7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJUVVNEIjsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgIEFkZHJlc3NMaXN0IHB1YmxpYyBjYW5SZWNlaXZlTWludFdoaXRlTGlzdDsKICAgIEFkZHJlc3NMaXN0IHB1YmxpYyBjYW5CdXJuV2hpdGVMaXN0OwogICAgQWRkcmVzc0xpc3QgcHVibGljIGJsYWNrTGlzdDsKICAgIEFkZHJlc3NMaXN0IHB1YmxpYyBub0ZlZXNMaXN0OwogICAgdWludDI1NiBwdWJsaWMgYnVybk1pbiA9IDEwMDAwICogMTAqKnVpbnQyNTYoZGVjaW1hbHMpOwogICAgdWludDI1NiBwdWJsaWMgYnVybk1heCA9IDIwMDAwMDAwICogMTAqKnVpbnQyNTYoZGVjaW1hbHMpOwoKICAgIHVpbnQ4MCBwdWJsaWMgdHJhbnNmZXJGZWVOdW1lcmF0b3IgPSA3OwogICAgdWludDgwIHB1YmxpYyB0cmFuc2ZlckZlZURlbm9taW5hdG9yID0gMTAwMDA7CiAgICB1aW50ODAgcHVibGljIG1pbnRGZWVOdW1lcmF0b3IgPSAwOwogICAgdWludDgwIHB1YmxpYyBtaW50RmVlRGVub21pbmF0b3IgPSAxMDAwMDsKICAgIHVpbnQyNTYgcHVibGljIG1pbnRGZWVGbGF0ID0gMDsKICAgIHVpbnQ4MCBwdWJsaWMgYnVybkZlZU51bWVyYXRvciA9IDA7CiAgICB1aW50ODAgcHVibGljIGJ1cm5GZWVEZW5vbWluYXRvciA9IDEwMDAwOwogICAgdWludDI1NiBwdWJsaWMgYnVybkZlZUZsYXQgPSAwOwogICAgYWRkcmVzcyBwdWJsaWMgc3Rha2VyOwoKICAgIGV2ZW50IENoYW5nZUJ1cm5Cb3VuZHNFdmVudCh1aW50MjU2IG5ld01pbiwgdWludDI1NiBuZXdNYXgpOwogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IFdpcGVkQWNjb3VudChhZGRyZXNzIGluZGV4ZWQgYWNjb3VudCwgdWludDI1NiBiYWxhbmNlKTsKCiAgICBmdW5jdGlvbiBUcnVlVVNEKCkgcHVibGljIHsKICAgICAgICB0b3RhbFN1cHBseV8gPSAwOwogICAgICAgIHN0YWtlciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TGlzdHMoQWRkcmVzc0xpc3QgX2NhblJlY2VpdmVNaW50V2hpdGVMaXN0LCBBZGRyZXNzTGlzdCBfY2FuQnVybldoaXRlTGlzdCwgQWRkcmVzc0xpc3QgX2JsYWNrTGlzdCwgQWRkcmVzc0xpc3QgX25vRmVlc0xpc3QpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGNhblJlY2VpdmVNaW50V2hpdGVMaXN0ID0gX2NhblJlY2VpdmVNaW50V2hpdGVMaXN0OwogICAgICAgIGNhbkJ1cm5XaGl0ZUxpc3QgPSBfY2FuQnVybldoaXRlTGlzdDsKICAgICAgICBibGFja0xpc3QgPSBfYmxhY2tMaXN0OwogICAgICAgIG5vRmVlc0xpc3QgPSBfbm9GZWVzTGlzdDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VOYW1lKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBzeW1ib2wgPSBfc3ltYm9sOwogICAgfQoKICAgIC8vQnVybmluZyBmdW5jdGlvbnMgYXMgd2l0aGRyYXdpbmcgbW9uZXkgZnJvbSB0aGUgc3lzdGVtLiBUaGUgcGxhdGZvcm0gd2lsbCBrZWVwIHRyYWNrIG9mIHdobyBidXJucyBjb2lucywKICAgIC8vYW5kIHdpbGwgc2VuZCB0aGVtIGJhY2sgdGhlIGVxdWl2YWxlbnQgYW1vdW50IG9mIG1vbmV5IChyb3VuZGVkIGRvd24gdG8gdGhlIG5lYXJlc3QgY2VudCkuCiAgICBmdW5jdGlvbiBidXJuKHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoY2FuQnVybldoaXRlTGlzdC5vbkxpc3QobXNnLnNlbmRlcikpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlID49IGJ1cm5NaW4pOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJ1cm5NYXgpOwogICAgICAgIHVpbnQyNTYgZmVlID0gcGF5U3Rha2luZ0ZlZShtc2cuc2VuZGVyLCBfdmFsdWUsIGJ1cm5GZWVOdW1lcmF0b3IsIGJ1cm5GZWVEZW5vbWluYXRvciwgYnVybkZlZUZsYXQsIDB4MCk7CiAgICAgICAgdWludDI1NiByZW1haW5pbmcgPSBfdmFsdWUuc3ViKGZlZSk7CiAgICAgICAgc3VwZXIuYnVybihyZW1haW5pbmcpOwogICAgfQoKICAgIC8vQ3JlYXRlIF9hbW91bnQgbmV3IHRva2VucyBhbmQgdHJhbnNmZXIgdGhlbSB0byBfdG8uCiAgICAvL0Jhc2VkIG9uIGNvZGUgYnkgT3BlblplcHBlbGluOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy90b2tlbi9NaW50YWJsZVRva2VuLnNvbAogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKGNhblJlY2VpdmVNaW50V2hpdGVMaXN0Lm9uTGlzdChfdG8pKTsKICAgICAgICB0b3RhbFN1cHBseV8gPSB0b3RhbFN1cHBseV8uYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzLmFkZEJhbGFuY2UoX3RvLCBfYW1vdW50KTsKICAgICAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfYW1vdW50KTsKICAgICAgICBwYXlTdGFraW5nRmVlKF90bywgX2Ftb3VudCwgbWludEZlZU51bWVyYXRvciwgbWludEZlZURlbm9taW5hdG9yLCBtaW50RmVlRmxhdCwgMHgwKTsKICAgIH0KCiAgICAvL0NoYW5nZSB0aGUgbWluaW11bSBhbmQgbWF4aW11bSBhbW91bnQgdGhhdCBjYW4gYmUgYnVybmVkIGF0IG9uY2UuIEJ1cm5pbmcKICAgIC8vbWF5IGJlIGRpc2FibGVkIGJ5IHNldHRpbmcgYm90aCB0byAwICh0aGlzIHdpbGwgbm90IGJlIGRvbmUgdW5kZXIgbm9ybWFsCiAgICAvL29wZXJhdGlvbiwgYnV0IHdlIGNhbid0IGFkZCBjaGVja3MgdG8gZGlzYWxsb3cgaXQgd2l0aG91dCBsb3NpbmcgYSBsb3Qgb2YKICAgIC8vZmxleGliaWxpdHkgc2luY2UgYnVybmluZyBjb3VsZCBhbHNvIGJlIGFzIGdvb2QgYXMgZGlzYWJsZWQKICAgIC8vYnkgc2V0dGluZyB0aGUgbWluaW11bSBleHRyZW1lbHkgaGlnaCwgYW5kIHdlIGRvbid0IHdhbnQgdG8gbG9jawogICAgLy9pbiBhbnkgcGFydGljdWxhciBjYXAgZm9yIHRoZSBtaW5pbXVtKQogICAgZnVuY3Rpb24gY2hhbmdlQnVybkJvdW5kcyh1aW50IG5ld01pbiwgdWludCBuZXdNYXgpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3TWluIDw9IG5ld01heCk7CiAgICAgICAgYnVybk1pbiA9IG5ld01pbjsKICAgICAgICBidXJuTWF4ID0gbmV3TWF4OwogICAgICAgIENoYW5nZUJ1cm5Cb3VuZHNFdmVudChuZXdNaW4sIG5ld01heCk7CiAgICB9CgogICAgLy8gdHJhbnNmZXIgYW5kIHRyYW5zZmVyRnJvbSBhcmUgYm90aCBkaXNwYXRjaGVkIHRvIHRoaXMgZnVuY3Rpb24sIHNvIHdlCiAgICAvLyBjaGVjayBibGFja2xpc3QgYW5kIHBheSBzdGFraW5nIGZlZSBoZXJlLgogICAgZnVuY3Rpb24gdHJhbnNmZXJBbGxBcmdzTm9BbGxvd2FuY2UoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSghYmxhY2tMaXN0Lm9uTGlzdChfZnJvbSkpOwogICAgICAgIHJlcXVpcmUoIWJsYWNrTGlzdC5vbkxpc3QoX3RvKSk7CiAgICAgICAgc3VwZXIudHJhbnNmZXJBbGxBcmdzTm9BbGxvd2FuY2UoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICBwYXlTdGFraW5nRmVlKF90bywgX3ZhbHVlLCB0cmFuc2ZlckZlZU51bWVyYXRvciwgdHJhbnNmZXJGZWVEZW5vbWluYXRvciwgMCwgX2Zyb20pOwogICAgfQoKICAgIGZ1bmN0aW9uIHdpcGVCbGFja2xpc3RlZEFjY291bnQoYWRkcmVzcyBhY2NvdW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKGJsYWNrTGlzdC5vbkxpc3QoYWNjb3VudCkpOwogICAgICAgIHVpbnQyNTYgb2xkVmFsdWUgPSBiYWxhbmNlT2YoYWNjb3VudCk7CiAgICAgICAgYmFsYW5jZXMuc2V0QmFsYW5jZShhY2NvdW50LCAwKTsKICAgICAgICB0b3RhbFN1cHBseV8gPSB0b3RhbFN1cHBseV8uc3ViKG9sZFZhbHVlKTsKICAgICAgICBXaXBlZEFjY291bnQoYWNjb3VudCwgb2xkVmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHBheVN0YWtpbmdGZWUoYWRkcmVzcyBwYXllciwgdWludDI1NiB2YWx1ZSwgdWludDgwIG51bWVyYXRvciwgdWludDgwIGRlbm9taW5hdG9yLCB1aW50MjU2IGZsYXRSYXRlLCBhZGRyZXNzIG90aGVyUGFydGljaXBhbnQpIHByaXZhdGUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChub0ZlZXNMaXN0Lm9uTGlzdChwYXllcikgfHwgbm9GZWVzTGlzdC5vbkxpc3Qob3RoZXJQYXJ0aWNpcGFudCkpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgc3Rha2luZ0ZlZSA9IHZhbHVlLm11bChudW1lcmF0b3IpLmRpdihkZW5vbWluYXRvcikuYWRkKGZsYXRSYXRlKTsKICAgICAgICBpZiAoc3Rha2luZ0ZlZSA+IDApIHsKICAgICAgICAgICAgc3VwZXIudHJhbnNmZXJBbGxBcmdzTm9BbGxvd2FuY2UocGF5ZXIsIHN0YWtlciwgc3Rha2luZ0ZlZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdGFraW5nRmVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVN0YWtpbmdGZWVzKHVpbnQ4MCBfdHJhbnNmZXJGZWVOdW1lcmF0b3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4MCBfdHJhbnNmZXJGZWVEZW5vbWluYXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDgwIF9taW50RmVlTnVtZXJhdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50ODAgX21pbnRGZWVEZW5vbWluYXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfbWludEZlZUZsYXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4MCBfYnVybkZlZU51bWVyYXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDgwIF9idXJuRmVlRGVub21pbmF0b3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX2J1cm5GZWVGbGF0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF90cmFuc2ZlckZlZURlbm9taW5hdG9yICE9IDApOwogICAgICAgIHJlcXVpcmUoX21pbnRGZWVEZW5vbWluYXRvciAhPSAwKTsKICAgICAgICByZXF1aXJlKF9idXJuRmVlRGVub21pbmF0b3IgIT0gMCk7CiAgICAgICAgdHJhbnNmZXJGZWVOdW1lcmF0b3IgPSBfdHJhbnNmZXJGZWVOdW1lcmF0b3I7CiAgICAgICAgdHJhbnNmZXJGZWVEZW5vbWluYXRvciA9IF90cmFuc2ZlckZlZURlbm9taW5hdG9yOwogICAgICAgIG1pbnRGZWVOdW1lcmF0b3IgPSBfbWludEZlZU51bWVyYXRvcjsKICAgICAgICBtaW50RmVlRGVub21pbmF0b3IgPSBfbWludEZlZURlbm9taW5hdG9yOwogICAgICAgIG1pbnRGZWVGbGF0ID0gX21pbnRGZWVGbGF0OwogICAgICAgIGJ1cm5GZWVOdW1lcmF0b3IgPSBfYnVybkZlZU51bWVyYXRvcjsKICAgICAgICBidXJuRmVlRGVub21pbmF0b3IgPSBfYnVybkZlZURlbm9taW5hdG9yOwogICAgICAgIGJ1cm5GZWVGbGF0ID0gX2J1cm5GZWVGbGF0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVN0YWtlcihhZGRyZXNzIG5ld1N0YWtlcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShuZXdTdGFrZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgc3Rha2VyID0gbmV3U3Rha2VyOwogICAgfQp9'.
	

]
