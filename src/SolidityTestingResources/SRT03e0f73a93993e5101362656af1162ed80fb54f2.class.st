Class {
	#name : #SRT03e0f73a93993e5101362656af1162ed80fb54f2,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT03e0f73a93993e5101362656af1162ed80fb54f2 >> base64 [
	^ 'LyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Ci8vLyBAdGl0bGUgVXRpbGl0eSBGdW5jdGlvbnMgZm9yIHVpbnQKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI2ZTBhMGYwMDA3MGIwMjJlMDIwMTAxMWUxYzA3MDAwOTQwMDExYzA5Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KbGlicmFyeSBNYXRoVWludCB7CiAgICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCBjKSB7CiAgICAgICAgYyA9IGEgKiBiOwogICAgICAgIHJlcXVpcmUoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgfQogICAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXF1aXJlKGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQogICAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgYykgewogICAgICAgIGMgPSBhICsgYjsKICAgICAgICByZXF1aXJlKGMgPj0gYSk7CiAgICB9CiAgICBmdW5jdGlvbiB0b2xlcmFudFN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IGMpIHsKICAgICAgICByZXR1cm4gKGEgPj0gYikgPyBhIC0gYiA6IDA7CiAgICB9CiAgICAvLy8gQGRldiBjYWxjdWxhdGUgdGhlIHNxdWFyZSBvZiBDb2VmZmljaWVudCBvZiBWYXJpYXRpb24gKENWKQogICAgLy8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NvZWZmaWNpZW50X29mX3ZhcmlhdGlvbgogICAgZnVuY3Rpb24gY3ZzcXVhcmUoCiAgICAgICAgdWludFtdIGFyciwKICAgICAgICB1aW50IHNjYWxlCiAgICAgICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdWludCBsZW4gPSBhcnIubGVuZ3RoOwogICAgICAgIHJlcXVpcmUobGVuID4gMSk7CiAgICAgICAgcmVxdWlyZShzY2FsZSA+IDApOwogICAgICAgIHVpbnQgYXZnID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBhdmcgKz0gYXJyW2ldOwogICAgICAgIH0KICAgICAgICBhdmcgPSBhdmcgLyBsZW47CiAgICAgICAgaWYgKGF2ZyA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICB1aW50IGN2cyA9IDA7CiAgICAgICAgdWludCBzOwogICAgICAgIHVpbnQgaXRlbTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgaXRlbSA9IGFycltpXTsKICAgICAgICAgICAgcyA9IGl0ZW0gPiBhdmcgPyBpdGVtIC0gYXZnIDogYXZnIC0gaXRlbTsKICAgICAgICAgICAgY3ZzICs9IG11bChzLCBzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICgobXVsKG11bChjdnMsIHNjYWxlKSwgc2NhbGUpIC8gYXZnKSAvIGF2ZykgLyAobGVuIC0gMSk7CiAgICB9Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBFUkMyMCBUb2tlbiBJbnRlcmZhY2UKLy8vIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImFkYzljY2MzYzRjOGMxZWRjMWMyYzJkZGRmYzRjM2NhODNjMmRmY2EiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBFUkMyMCB7CiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKCQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBMb29wcmluZyBUb2tlbiBFeGNoYW5nZSBQcm90b2NvbCBDb250cmFjdCBJbnRlcmZhY2UKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI2MjA2MDMwYzBiMDcwZTIyMGUwZDBkMTIxMDBiMGMwNTRjMGQxMDA1Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iODdlY2U4ZTllMGViZWVlNmU5ZTBjN2ViZThlOGY3ZjVlZWU5ZTBhOWU4ZjVlMCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CmNvbnRyYWN0IExvb3ByaW5nUHJvdG9jb2wgewogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIENvbnN0YW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgdWludDggICBwdWJsaWMgY29uc3RhbnQgRkVFX1NFTEVDVF9MUkMgICAgICAgICAgICAgICA9IDA7CiAgICB1aW50OCAgIHB1YmxpYyBjb25zdGFudCBGRUVfU0VMRUNUX01BUkdJTl9TUExJVCAgICAgID0gMTsKICAgIHVpbnQ4ICAgcHVibGljIGNvbnN0YW50IEZFRV9TRUxFQ1RfTUFYX1ZBTFVFICAgICAgICAgPSAxOwogICAgdWludDggICBwdWJsaWMgY29uc3RhbnQgTUFSR0lOX1NQTElUX1BFUkNFTlRBR0VfQkFTRSA9IDEwMDsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBFdmVudHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAZGV2IEV2ZW50IHRvIGVtaXQgaWYgYSByaW5nIGlzIHN1Y2Nlc3NmdWxseSBtaW5lZC4KICAgIC8vLyBfYW1vdW50c0xpc3QgaXMgYW4gYXJyYXkgb2Y6CiAgICAvLy8gW19hbW91bnRTLCBfYW1vdW50QiwgX2xyY1Jld2FyZCwgX2xyY0ZlZSwgc3BsaXRTLCBzcGxpdEJdLgogICAgZXZlbnQgUmluZ01pbmVkKAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX3JpbmdJbmRleCwKICAgICAgICBieXRlczMyICAgICBpbmRleGVkIF9yaW5naGFzaCwKICAgICAgICBhZGRyZXNzICAgICAgICAgICAgIF9taW5lciwKICAgICAgICBhZGRyZXNzICAgICAgICAgICAgIF9mZWVSZWNpcGllbnQsCiAgICAgICAgYm9vbCAgICAgICAgICAgICAgICBfaXNSaW5naGFzaFJlc2VydmVkLAogICAgICAgIGJ5dGVzMzJbXSAgICAgICAgICAgX29yZGVySGFzaExpc3QsCiAgICAgICAgdWludFs2XVtdICAgICAgICAgICBfYW1vdW50c0xpc3QKICAgICk7CiAgICBldmVudCBPcmRlckNhbmNlbGxlZCgKICAgICAgICBieXRlczMyICAgICBpbmRleGVkIF9vcmRlckhhc2gsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfYW1vdW50Q2FuY2VsbGVkCiAgICApOwogICAgZXZlbnQgQ3V0b2ZmVGltZXN0YW1wQ2hhbmdlZCgKICAgICAgICBhZGRyZXNzICAgICBpbmRleGVkIF9hZGRyZXNzLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgX2N1dG9mZgogICAgKTsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBGdW5jdGlvbnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAZGV2IFN1Ym1pdCBhIG9yZGVyLXJpbmcgZm9yIHZhbGlkYXRpb24gYW5kIHNldHRsZW1lbnQuCiAgICAvLy8gQHBhcmFtIGFkZHJlc3NMaXN0ICBMaXN0IG9mIGVhY2ggb3JkZXIncyBvd25lciBhbmQgdG9rZW5TLiBOb3RlIHRoYXQgbmV4dAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgb3JkZXIncyBgdG9rZW5TYCBlcXVhbHMgdGhpcyBvcmRlcidzIGB0b2tlbkJgLgogICAgLy8vIEBwYXJhbSB1aW50QXJnc0xpc3QgTGlzdCBvZiB1aW50LXR5cGUgYXJndW1lbnRzIGluIHRoaXMgb3JkZXI6CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBhbW91bnRTLCBhbW91bnRCLCB0aW1lc3RhbXAsIHR0bCwgc2FsdCwgbHJjRmVlLAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgcmF0ZUFtb3VudFMuCiAgICAvLy8gQHBhcmFtIHVpbnQ4QXJnc0xpc3QgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgTGlzdCBvZiB1bml0OC10eXBlIGFyZ3VtZW50cywgaW4gdGhpcyBvcmRlcjoKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIG1hcmdpblNwbGl0UGVyY2VudGFnZUxpc3QsIGZlZVNlbGVjdGlvbkxpc3QuCiAgICAvLy8gQHBhcmFtIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBUaGlzIGluZGljYXRlcyB3aGVuIGEgb3JkZXIgc2hvdWxkIGJlIGNvbnNpZGVyZWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGFzICdjb21wbGV0ZWx5IGZpbGxlZCcuCiAgICAvLy8gQHBhcmFtIHZMaXN0ICAgICAgICBMaXN0IG9mIHYgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHYgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSByTGlzdCAgICAgICAgTGlzdCBvZiByIGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICByIHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gc0xpc3QgICAgICAgIExpc3Qgb2YgcyBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgcyB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHJpbmdtaW5lciAgICBUaGUgYWRkcmVzcyB0aGF0IHNpZ25lZCB0aGlzIHR4LgogICAgLy8vIEBwYXJhbSBmZWVSZWNlcGllbnQgVGhlIHJlY2VwaWVudCBhZGRyZXNzIGZvciBmZWUgY29sbGVjdGlvbi4gSWYgdGhpcyBpcwogICAgLy8vICAgICAgICAgICAgICAgICAgICAgJzB4MCcsIGFsbCBmZWVzIHdpbGwgYmUgcGFpZCB0byB0aGUgYWRkcmVzcyB3aG8gaGFkCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBzaWduZWQgdGhpcyB0cmFuc2FjdGlvbiwgbm90IGBtc2cuc2VuZGVyYC4gTm90ZWQgaWYKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIExSQyBuZWVkIHRvIGJlIHBhaWQgYmFjayB0byBvcmRlciBvd25lciBhcyB0aGUgcmVzdWx0CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvZiBmZWUgc2VsZWN0aW9uIG1vZGVsLCBMUkMgd2lsbCBhbHNvIGJlIHNlbnQgZnJvbQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhpcyBhZGRyZXNzLgogICAgZnVuY3Rpb24gc3VibWl0UmluZygKICAgICAgICBhZGRyZXNzWzJdW10gICAgYWRkcmVzc0xpc3QsCiAgICAgICAgdWludFs3XVtdICAgICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICB1aW50OFsyXVtdICAgICAgdWludDhBcmdzTGlzdCwKICAgICAgICBib29sW10gICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgIHVpbnQ4W10gICAgICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHNMaXN0LAogICAgICAgIGFkZHJlc3MgICAgICAgICByaW5nbWluZXIsCiAgICAgICAgYWRkcmVzcyAgICAgICAgIGZlZVJlY2VwaWVudAogICAgICAgICkgcHVibGljOwogICAgLy8vIEBkZXYgQ2FuY2VsIGEgb3JkZXIuIGNhbmNlbCBhbW91bnQoYW1vdW50UyBvciBhbW91bnRCKSBjYW4gYmUgc3BlY2lmaWVkCiAgICAvLy8gICAgICBpbiBvcmRlclZhbHVlcy4KICAgIC8vLyBAcGFyYW0gYWRkcmVzc2VzICAgICAgICAgIG93bmVyLCB0b2tlblMsIHRva2VuQgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyAgICAgICAgYW1vdW50UywgYW1vdW50QiwgdGltZXN0YW1wLCB0dGwsIHNhbHQsIGxyY0ZlZSwKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEFtb3VudFMsIGFuZCBjYW5jZWxBbW91bnRCLgogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50QiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIGluZGljYXRlcyB3aGVuIGEgb3JkZXIgc2hvdWxkIGJlIGNvbnNpZGVyZWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzICdjb21wbGV0ZWx5IGZpbGxlZCcuCiAgICAvLy8gQHBhcmFtIG1hcmdpblNwbGl0UGVyY2VudGFnZSAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBQZXJjZW50YWdlIG9mIG1hcmdpbiBzcGxpdCB0byBzaGFyZSB3aXRoIG1pbmVyLgogICAgLy8vIEBwYXJhbSB2ICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcigKICAgICAgICBhZGRyZXNzWzNdIGFkZHJlc3NlcywKICAgICAgICB1aW50WzddICAgIG9yZGVyVmFsdWVzLAogICAgICAgIGJvb2wgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgdWludDggICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UsCiAgICAgICAgdWludDggICAgICB2LAogICAgICAgIGJ5dGVzMzIgICAgciwKICAgICAgICBieXRlczMyICAgIHMKICAgICAgICApIGV4dGVybmFsOwogICAgLy8vIEBkZXYgICBTZXQgYSBjdXRvZmYgdGltZXN0YW1wIHRvIGludmFsaWRhdGUgYWxsIG9yZGVycyB3aG9zZSB0aW1lc3RhbXAKICAgIC8vLyAgICAgICAgaXMgc21hbGxlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBuZXcgdmFsdWUgb2YgdGhlIGFkZHJlc3MncyBjdXRvZmYKICAgIC8vLyAgICAgICAgdGltZXN0YW1wLgogICAgLy8vIEBwYXJhbSBjdXRvZmYgVGhlIGN1dG9mZiB0aW1lc3RhbXAsIHdpbGwgZGVmYXVsdCB0byBgYmxvY2sudGltZXN0YW1wYAogICAgLy8vICAgICAgICBpZiBpdCBpcyAwLgogICAgZnVuY3Rpb24gc2V0Q3V0b2ZmKHVpbnQgY3V0b2ZmKSBleHRlcm5hbDsKfQovKgogIENvcHlyaWdodCAyMDE3IExvb3ByaW5nIFByb2plY3QgTHRkIChMb29wcmluZyBGb3VuZGF0aW9uKS4KICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwovKgogIENvcHlyaWdodCAyMDE3IExvb3ByaW5nIFByb2plY3QgTHRkIChMb29wcmluZyBGb3VuZGF0aW9uKS4KICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwovLy8gQHRpdGxlIFV0aWxpdHkgRnVuY3Rpb25zIGZvciBieXRlMzIKLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZjY5ZDk5OTg5MTlhOWY5Nzk4OTFiNjlhOTk5OTg2ODQ5Zjk4OTFkODk5ODQ5MSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjM2NTI1NzU4NWY1MzVhNzY1YTU5NTk0NjQ0NWY1ODUxMTg1OTQ0NTEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pi4KbGlicmFyeSBNYXRoQnl0ZXMzMiB7CiAgICBmdW5jdGlvbiB4b3JSZWR1Y2UoCiAgICAgICAgYnl0ZXMzMltdICAgYXJyLAogICAgICAgIHVpbnQgICAgICAgIGxlbgogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zIChieXRlczMyIHJlcykKICAgIHsKICAgICAgICByZXMgPSBhcnJbMF07CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgcmVzIF49IGFycltpXTsKICAgICAgICB9CiAgICB9Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBVdGlsaXR5IEZ1bmN0aW9ucyBmb3IgdWludDgKLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iOGRlNmUyZTNlYWUxZTRlY2UzZWFjZGUxZTJlMmZkZmZlNGUzZWFhM2UyZmZlYSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjdlMWExZjEwMTcxYjEyM2UxMjExMTEwZTBjMTcxMDE5NTAxMTBjMTkiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pi4KbGlicmFyeSBNYXRoVWludDggewogICAgZnVuY3Rpb24geG9yUmVkdWNlKAogICAgICAgIHVpbnQ4W10gYXJyLAogICAgICAgIHVpbnQgICAgbGVuCiAgICAgICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQ4IHJlcykKICAgIHsKICAgICAgICByZXMgPSBhcnJbMF07CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgcmVzIF49IGFycltpXTsKICAgICAgICB9CiAgICB9Cn0KLy8vIEB0aXRsZSBSaW5nIEhhc2ggUmVnaXN0cnkgQ29udHJhY3QKLy8vIEBkZXYgVGhpcyBjb250cmFjdHMgaGVscCByZXNlcnZlIHJpbmdoYXNoZXMgZm9yIG1pbmVycy4KLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iY2ZhNGEwYTFhOGEzYTZhZWExYTg4ZmEzYTBhMGJmYmRhNmExYThlMWEwYmRhOCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjBhNmU2YjY0NjM2ZjY2NGE2NjY1NjU3YTc4NjM2NDZkMjQ2NTc4NmQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pi4KY29udHJhY3QgUmluZ2hhc2hSZWdpc3RyeSB7CiAgICB1c2luZyBNYXRoQnl0ZXMzMiAgIGZvciBieXRlczMyW107CiAgICB1c2luZyBNYXRoVWludDggICAgIGZvciB1aW50OFtdOwogICAgdWludCBwdWJsaWMgYmxvY2tzVG9MaXZlOwogICAgc3RydWN0IFN1Ym1pc3Npb24gewogICAgICAgIGFkZHJlc3MgcmluZ21pbmVyOwogICAgICAgIHVpbnQgYmxvY2s7CiAgICB9CiAgICBtYXBwaW5nIChieXRlczMyID0+IFN1Ym1pc3Npb24pIHN1Ym1pc3Npb25zOwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEV2ZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgUmluZ2hhc2hTdWJtaXR0ZWQoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9yaW5nbWluZXIsCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIF9yaW5naGFzaAogICAgKTsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBDb25zdHJ1Y3RvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIGZ1bmN0aW9uIFJpbmdoYXNoUmVnaXN0cnkodWludCBfYmxvY2tzVG9MaXZlKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoX2Jsb2Nrc1RvTGl2ZSA+IDApOwogICAgICAgIGJsb2Nrc1RvTGl2ZSA9IF9ibG9ja3NUb0xpdmU7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQGRldiBEaXNhYmxlIGRlZmF1bHQgZnVuY3Rpb24uCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICBmdW5jdGlvbiBzdWJtaXRSaW5naGFzaCgKICAgICAgICBhZGRyZXNzICAgICByaW5nbWluZXIsCiAgICAgICAgYnl0ZXMzMiAgICAgcmluZ2hhc2gKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShjYW5TdWJtaXQocmluZ2hhc2gsIHJpbmdtaW5lcikpOyAvLywgIlJpbmdoYXNoIHN1Ym1pdHRlZCIpOwogICAgICAgIHN1Ym1pc3Npb25zW3JpbmdoYXNoXSA9IFN1Ym1pc3Npb24ocmluZ21pbmVyLCBibG9jay5udW1iZXIpOwogICAgICAgIFJpbmdoYXNoU3VibWl0dGVkKHJpbmdtaW5lciwgcmluZ2hhc2gpOwogICAgfQogICAgZnVuY3Rpb24gYmF0Y2hTdWJtaXRSaW5naGFzaCgKICAgICAgICBhZGRyZXNzW10gICAgIHJpbmdtaW5lckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICByaW5naGFzaExpc3QKICAgICAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICB1aW50IHNpemUgPSByaW5nbWluZXJMaXN0Lmxlbmd0aDsKICAgICAgICByZXF1aXJlKHNpemUgPiAwKTsKICAgICAgICByZXF1aXJlKHNpemUgPT0gcmluZ2hhc2hMaXN0Lmxlbmd0aCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHN1Ym1pdFJpbmdoYXNoKHJpbmdtaW5lckxpc3RbaV0sIHJpbmdoYXNoTGlzdFtpXSk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIHRoZSBoYXNoIG9mIGEgcmluZy4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJpbmdoYXNoKAogICAgICAgIHVpbnQgICAgICAgIHJpbmdTaXplLAogICAgICAgIHVpbnQ4W10gICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgIHNMaXN0CiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikKICAgIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICByaW5nU2l6ZSA9PSB2TGlzdC5sZW5ndGggLSAxICYmICgKICAgICAgICAgICAgcmluZ1NpemUgPT0gckxpc3QubGVuZ3RoIC0gMSAmJiAoCiAgICAgICAgICAgIHJpbmdTaXplID09IHNMaXN0Lmxlbmd0aCAtIDEpKQogICAgICAgICk7IC8vLCAiaW52YWxpZCByaW5nIGRhdGEiKTsKICAgICAgICByZXR1cm4ga2VjY2FrMjU2KAogICAgICAgICAgICB2TGlzdC54b3JSZWR1Y2UocmluZ1NpemUpLAogICAgICAgICAgICByTGlzdC54b3JSZWR1Y2UocmluZ1NpemUpLAogICAgICAgICAgICBzTGlzdC54b3JSZWR1Y2UocmluZ1NpemUpCiAgICAgICAgKTsKICAgIH0KICAgICAvLy8gcmV0dXJuIHZhbHVlIGF0dHJpYnV0ZXNbMl0gY29udGFpbnMgdGhlIGZvbGxvd2luZyB2YWx1ZXMgaW4gdGhpcyBvcmRlcjoKICAgICAvLy8gY2FuU3VibWl0LCBpc1Jlc2VydmVkLgogICAgZnVuY3Rpb24gY29tcHV0ZUFuZEdldFJpbmdoYXNoSW5mbygKICAgICAgICB1aW50ICAgICAgICByaW5nU2l6ZSwKICAgICAgICBhZGRyZXNzICAgICByaW5nbWluZXIsCiAgICAgICAgdWludDhbXSAgICAgdkxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgc0xpc3QKICAgICAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMiByaW5naGFzaCwgYm9vbFsyXSBhdHRyaWJ1dGVzKQogICAgewogICAgICAgIHJpbmdoYXNoID0gY2FsY3VsYXRlUmluZ2hhc2goCiAgICAgICAgICAgIHJpbmdTaXplLAogICAgICAgICAgICB2TGlzdCwKICAgICAgICAgICAgckxpc3QsCiAgICAgICAgICAgIHNMaXN0CiAgICAgICAgKTsKICAgICAgICBhdHRyaWJ1dGVzWzBdID0gY2FuU3VibWl0KHJpbmdoYXNoLCByaW5nbWluZXIpOwogICAgICAgIGF0dHJpYnV0ZXNbMV0gPSBpc1Jlc2VydmVkKHJpbmdoYXNoLCByaW5nbWluZXIpOwogICAgfQogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBhIHJpbmcncyBoYXNoIGNhbiBiZSBzdWJtaXR0ZWQ7CiAgICAvLy8gZmFsc2Ugb3RoZXJ3aXNlLgogICAgZnVuY3Rpb24gY2FuU3VibWl0KAogICAgICAgIGJ5dGVzMzIgcmluZ2hhc2gsCiAgICAgICAgYWRkcmVzcyByaW5nbWluZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShyaW5nbWluZXIgIT0gMHgwKTsKICAgICAgICBTdWJtaXNzaW9uIG1lbW9yeSBzdWJtaXNzaW9uID0gc3VibWlzc2lvbnNbcmluZ2hhc2hdOwogICAgICAgIGFkZHJlc3MgbWluZXIgPSBzdWJtaXNzaW9uLnJpbmdtaW5lcjsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBtaW5lciA9PSAweDAgfHwgKAogICAgICAgICAgICBzdWJtaXNzaW9uLmJsb2NrICsgYmxvY2tzVG9MaXZlIDwgYmxvY2subnVtYmVyKSB8fCAoCiAgICAgICAgICAgIG1pbmVyID09IHJpbmdtaW5lcikKICAgICAgICApOwogICAgfQogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBhIHJpbmcncyBoYXNoIHdhcyBzdWJtaXR0ZWQgYW5kIHN0aWxsIHZhbGlkOwogICAgLy8vIGZhbHNlIG90aGVyd2lzZS4KICAgIGZ1bmN0aW9uIGlzUmVzZXJ2ZWQoCiAgICAgICAgYnl0ZXMzMiByaW5naGFzaCwKICAgICAgICBhZGRyZXNzIHJpbmdtaW5lcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBTdWJtaXNzaW9uIG1lbW9yeSBzdWJtaXNzaW9uID0gc3VibWlzc2lvbnNbcmluZ2hhc2hdOwogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIHN1Ym1pc3Npb24uYmxvY2sgKyBibG9ja3NUb0xpdmUgPj0gYmxvY2subnVtYmVyICYmICgKICAgICAgICAgICAgc3VibWlzc2lvbi5yaW5nbWluZXIgPT0gcmluZ21pbmVyKQogICAgICAgICk7CiAgICB9Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBPd25hYmxlCi8vLyBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMKLy8vICAgICAgYXV0aG9yaXphdGlvbiBjb250cm9sIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZgovLy8gICAgICAidXNlciBwZXJtaXNzaW9ucyIuCmNvbnRyYWN0IE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIKICAgICk7CiAgICAvLy8gQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdAogICAgLy8vICAgICAgdG8gdGhlIHNlbmRlci4KICAgIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KICAgIC8vLyBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQogICAgLy8vIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEKICAgIC8vLyAgICAgIG5ld093bmVyLgogICAgLy8vIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKG5ld093bmVyICE9IDB4MCk7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQp9Ci8vLyBAdGl0bGUgQ2xhaW1hYmxlCi8vLyBAZGV2IEV4dGVuc2lvbiBmb3IgdGhlIE93bmFibGUgY29udHJhY3QsIHdoZXJlIHRoZSBvd25lcnNoaXAgbmVlZHMKLy8vICAgICAgdG8gYmUgY2xhaW1lZC4gVGhpcyBhbGxvd3MgdGhlIG5ldyBvd25lciB0byBhY2NlcHQgdGhlIHRyYW5zZmVyLgpjb250cmFjdCBDbGFpbWFibGUgaXMgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXI7CiAgICAvLy8gQGRldiBNb2RpZmllciB0aHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIHBlbmRpbmdPd25lci4KICAgIG1vZGlmaWVyIG9ubHlQZW5kaW5nT3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHBlbmRpbmdPd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIC8vLyBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBzZXQgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKG5ld093bmVyICE9IDB4MCAmJiBuZXdPd25lciAhPSBvd25lcik7CiAgICAgICAgcGVuZGluZ093bmVyID0gbmV3T3duZXI7CiAgICB9CiAgICAvLy8gQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIGNsYWltT3duZXJzaGlwKCkgb25seVBlbmRpbmdPd25lciBwdWJsaWMgewogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBwZW5kaW5nT3duZXIpOwogICAgICAgIG93bmVyID0gcGVuZGluZ093bmVyOwogICAgICAgIHBlbmRpbmdPd25lciA9IDB4MDsKICAgIH0KfQovLy8gQHRpdGxlIFRva2VuIFJlZ2lzdGVyIENvbnRyYWN0Ci8vLyBAZGV2IFRoaXMgY29udHJhY3QgbWFpbnRhaW5zIGEgbGlzdCBvZiB0b2tlbnMgdGhlIFByb3RvY29sIHN1cHBvcnRzLgovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlNThlOGE4YjgyODk4Yzg0OGI4MmE1ODk4YThhOTU5NzhjOGI4MmNiOGE5NzgyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4sCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNzMxNzEyMWQxYTE2MWYzMzFmMWMxYzAzMDExYTFkMTQ1ZDFjMDExNCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Lgpjb250cmFjdCBUb2tlblJlZ2lzdHJ5IGlzIENsYWltYWJsZSB7CiAgICBhZGRyZXNzW10gcHVibGljIGFkZHJlc3NlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5JbmZvKSBhZGRyZXNzTWFwOwogICAgbWFwcGluZyAoc3RyaW5nID0+IGFkZHJlc3MpIHN5bWJvbE1hcDsKICAgIAogICAgdWludDggcHVibGljIGNvbnN0YW50IFRPS0VOX1NUQU5EQVJEX0VSQzIwICAgPSAwOwogICAgdWludDggcHVibGljIGNvbnN0YW50IFRPS0VOX1NUQU5EQVJEX0VSQzIyMyAgPSAxOwogICAgCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gU3RydWN0cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBzdHJ1Y3QgVG9rZW5JbmZvIHsKICAgICAgICB1aW50ICAgcG9zOyAgICAgIC8vIDAgbWVucyB1bnJlZ2lzdGVyZWQ7IGlmID4gMCwgcG9zICsgMSBpcyB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRva2VuJ3MgcG9zaXRpb24gaW4gYGFkZHJlc3Nlc2AuCiAgICAgICAgdWludDggIHN0YW5kYXJkOyAvLyBFUkMyMCBvciBFUkMyMjMKICAgICAgICBzdHJpbmcgc3ltYm9sOyAgIC8vIFN5bWJvbCBvZiB0aGUgdG9rZW4KICAgIH0KICAgIAogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEV2ZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgVG9rZW5SZWdpc3RlcmVkKGFkZHJlc3MgYWRkciwgc3RyaW5nIHN5bWJvbCk7CiAgICBldmVudCBUb2tlblVucmVnaXN0ZXJlZChhZGRyZXNzIGFkZHIsIHN0cmluZyBzeW1ib2wpOwogICAgCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQGRldiBEaXNhYmxlIGRlZmF1bHQgZnVuY3Rpb24uCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICBmdW5jdGlvbiByZWdpc3RlclRva2VuKAogICAgICAgIGFkZHJlc3MgYWRkciwKICAgICAgICBzdHJpbmcgIHN5bWJvbAogICAgICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlZ2lzdGVyU3RhbmRhcmRUb2tlbihhZGRyLCBzeW1ib2wsIFRPS0VOX1NUQU5EQVJEX0VSQzIwKTsgICAgCiAgICB9CiAgICBmdW5jdGlvbiByZWdpc3RlclN0YW5kYXJkVG9rZW4oCiAgICAgICAgYWRkcmVzcyBhZGRyLAogICAgICAgIHN0cmluZyAgc3ltYm9sLAogICAgICAgIHVpbnQ4ICAgc3RhbmRhcmQKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZSgweDAgIT0gYWRkcik7CiAgICAgICAgcmVxdWlyZShieXRlcyhzeW1ib2wpLmxlbmd0aCA+IDApOwogICAgICAgIHJlcXVpcmUoMHgwID09IHN5bWJvbE1hcFtzeW1ib2xdKTsKICAgICAgICByZXF1aXJlKDAgPT0gYWRkcmVzc01hcFthZGRyXS5wb3MpOwogICAgICAgIHJlcXVpcmUoc3RhbmRhcmQgPD0gVE9LRU5fU1RBTkRBUkRfRVJDMjIzKTsKICAgICAgICBhZGRyZXNzZXMucHVzaChhZGRyKTsKICAgICAgICBzeW1ib2xNYXBbc3ltYm9sXSA9IGFkZHI7CiAgICAgICAgYWRkcmVzc01hcFthZGRyXSA9IFRva2VuSW5mbyhhZGRyZXNzZXMubGVuZ3RoLCBzdGFuZGFyZCwgc3ltYm9sKTsKICAgICAgICBUb2tlblJlZ2lzdGVyZWQoYWRkciwgc3ltYm9sKTsgICAgICAKICAgIH0KICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXJUb2tlbigKICAgICAgICBhZGRyZXNzIGFkZHIsCiAgICAgICAgc3RyaW5nICBzeW1ib2wKICAgICAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKGFkZHIgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKHN5bWJvbE1hcFtzeW1ib2xdID09IGFkZHIpOwogICAgICAgIGRlbGV0ZSBzeW1ib2xNYXBbc3ltYm9sXTsKICAgICAgICAKICAgICAgICB1aW50IHBvcyA9IGFkZHJlc3NNYXBbYWRkcl0ucG9zOwogICAgICAgIHJlcXVpcmUocG9zICE9IDApOwogICAgICAgIGRlbGV0ZSBhZGRyZXNzTWFwW2FkZHJdOwogICAgICAgIAogICAgICAgIC8vIFdlIHdpbGwgcmVwbGFjZSB0aGUgdG9rZW4gd2UgbmVlZCB0byB1bnJlZ2lzdGVyIHdpdGggdGhlIGxhc3QgdG9rZW4KICAgICAgICAvLyBPbmx5IHRoZSBwb3Mgb2YgdGhlIGxhc3QgdG9rZW4gd2lsbCBuZWVkIHRvIGJlIHVwZGF0ZWQKICAgICAgICBhZGRyZXNzIGxhc3RUb2tlbiA9IGFkZHJlc3Nlc1thZGRyZXNzZXMubGVuZ3RoIC0gMV07CiAgICAgICAgCiAgICAgICAgLy8gRG9uJ3QgZG8gYW55dGhpbmcgaWYgdGhlIGxhc3QgdG9rZW4gaXMgdGhlIG9uZSB3ZSB3YW50IHRvIGRlbGV0ZQogICAgICAgIGlmIChhZGRyICE9IGxhc3RUb2tlbikgewogICAgICAgICAgICAvLyBTd2FwIHdpdGggdGhlIGxhc3QgdG9rZW4gYW5kIHVwZGF0ZSB0aGUgcG9zCiAgICAgICAgICAgIGFkZHJlc3Nlc1twb3MgLSAxXSA9IGxhc3RUb2tlbjsKICAgICAgICAgICAgYWRkcmVzc01hcFtsYXN0VG9rZW5dLnBvcyA9IHBvczsKICAgICAgICB9CiAgICAgICAgYWRkcmVzc2VzLmxlbmd0aC0tOwogICAgICAgIFRva2VuVW5yZWdpc3RlcmVkKGFkZHIsIHN5bWJvbCk7CiAgICB9CiAgICBmdW5jdGlvbiBpc1Rva2VuUmVnaXN0ZXJlZEJ5U3ltYm9sKHN0cmluZyBzeW1ib2wpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIHN5bWJvbE1hcFtzeW1ib2xdICE9IDB4MDsKICAgIH0KICAgIGZ1bmN0aW9uIGlzVG9rZW5SZWdpc3RlcmVkKGFkZHJlc3MgYWRkcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYWRkcmVzc01hcFthZGRyXS5wb3MgIT0gMDsKICAgIH0KICAgIGZ1bmN0aW9uIGFyZUFsbFRva2Vuc1JlZ2lzdGVyZWQoYWRkcmVzc1tdIGFkZHJlc3NMaXN0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYWRkcmVzc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3NNYXBbYWRkcmVzc0xpc3RbaV1dLnBvcyA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFRva2VuU3RhbmRhcmQoYWRkcmVzcyBhZGRyKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50OCkKICAgIHsKICAgICAgICBUb2tlbkluZm8gbWVtb3J5IGluZm8gPSBhZGRyZXNzTWFwW2FkZHJdOwogICAgICAgIHJlcXVpcmUoaW5mby5wb3MgIT0gMCk7CiAgICAgICAgcmV0dXJuIGluZm8uc3RhbmRhcmQ7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzQnlTeW1ib2woc3RyaW5nIHN5bWJvbCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgIHJldHVybiBzeW1ib2xNYXBbc3ltYm9sXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0VG9rZW5zKAogICAgICAgIHVpbnQgc3RhcnQsCiAgICAgICAgdWludCBjb3VudAogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYWRkcmVzc1tdIGFkZHJlc3NMaXN0KQogICAgewogICAgICAgIHVpbnQgbnVtID0gYWRkcmVzc2VzLmxlbmd0aDsKICAgICAgICAKICAgICAgICBpZiAoc3RhcnQgPj0gbnVtKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludCBlbmQgPSBzdGFydCArIGNvdW50OwogICAgICAgIGlmIChlbmQgPiBudW0pIHsKICAgICAgICAgICAgZW5kID0gbnVtOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnQgPT0gbnVtKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYWRkcmVzc0xpc3QgPSBuZXcgYWRkcmVzc1tdKGVuZCAtIHN0YXJ0KTsKICAgICAgICBmb3IgKHVpbnQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzc0xpc3RbaSAtIHN0YXJ0XSA9IGFkZHJlc3Nlc1tpXTsKICAgICAgICB9CiAgICB9Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBUb2tlblRyYW5zZmVyRGVsZWdhdGUKLy8vIEBkZXYgQWN0cyBhcyBhIG1pZGRsZSBtYW4gdG8gdHJhbnNmZXIgRVJDMjAgdG9rZW5zIG9uIGJlaGFsZiBvZiBkaWZmZXJlbnQKLy8vIHZlcnNpb25zIG9mIExvb3ByaW5nIHByb3RvY29sIHRvIGF2b2lkIEVSQzIwIHJlLWF1dGhvcml6YXRpb24uCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMTA3NDcxN2U3OTc1N2M1MDdjN2Y3ZjYwNjI3OTdlNzczZTdmNjI3NyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Lgpjb250cmFjdCBUb2tlblRyYW5zZmVyRGVsZWdhdGUgaXMgQ2xhaW1hYmxlIHsKICAgIHVzaW5nIE1hdGhVaW50IGZvciB1aW50OwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFZhcmlhYmxlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgbWFwcGluZyhhZGRyZXNzID0+IEFkZHJlc3NJbmZvKSBwcml2YXRlIGFkZHJlc3NJbmZvczsKICAgIGFkZHJlc3MgcHVibGljIGxhdGVzdEFkZHJlc3M7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gU3RydWN0cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBzdHJ1Y3QgQWRkcmVzc0luZm8gewogICAgICAgIGFkZHJlc3MgcHJldmlvdXM7CiAgICAgICAgdWludDMyICBpbmRleDsKICAgICAgICBib29sICAgIGF1dGhvcml6ZWQ7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gTW9kaWZpZXJzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBtb2RpZmllciBvbmx5QXV0aG9yaXplZCgpIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3NJbmZvc1ttc2cuc2VuZGVyXS5hdXRob3JpemVkKTsKICAgICAgICBfOwogICAgfQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEV2ZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgQWRkcmVzc0F1dGhvcml6ZWQoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQzMiBudW1iZXIpOwogICAgZXZlbnQgQWRkcmVzc0RlYXV0aG9yaXplZChhZGRyZXNzIGluZGV4ZWQgYWRkciwgdWludDMyIG51bWJlcik7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQGRldiBEaXNhYmxlIGRlZmF1bHQgZnVuY3Rpb24uCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICAvLy8gQGRldiBBZGQgYSBMb29wcmluZyBwcm90b2NvbCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIEEgbG9vcHJpbmcgcHJvdG9jb2wgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIGF1dGhvcml6ZUFkZHJlc3MoYWRkcmVzcyBhZGRyKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgQWRkcmVzc0luZm8gc3RvcmFnZSBhZGRySW5mbyA9IGFkZHJlc3NJbmZvc1thZGRyXTsKICAgICAgICBpZiAoYWRkckluZm8uaW5kZXggIT0gMCkgeyAvLyBleGlzdGluZwogICAgICAgICAgICBpZiAoYWRkckluZm8uYXV0aG9yaXplZCA9PSBmYWxzZSkgeyAvLyByZS1hdXRob3JpemUKICAgICAgICAgICAgICAgIGFkZHJJbmZvLmF1dGhvcml6ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgQWRkcmVzc0F1dGhvcml6ZWQoYWRkciwgYWRkckluZm8uaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWRkcmVzcyBwcmV2ID0gbGF0ZXN0QWRkcmVzczsKICAgICAgICAgICAgaWYgKHByZXYgPT0gMHgwKSB7CiAgICAgICAgICAgICAgICBhZGRySW5mby5pbmRleCA9IDE7CiAgICAgICAgICAgICAgICBhZGRySW5mby5hdXRob3JpemVkID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFkZHJJbmZvLnByZXZpb3VzID0gcHJldjsKICAgICAgICAgICAgICAgIGFkZHJJbmZvLmluZGV4ID0gYWRkcmVzc0luZm9zW3ByZXZdLmluZGV4ICsgMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRySW5mby5hdXRob3JpemVkID0gdHJ1ZTsKICAgICAgICAgICAgbGF0ZXN0QWRkcmVzcyA9IGFkZHI7CiAgICAgICAgICAgIEFkZHJlc3NBdXRob3JpemVkKGFkZHIsIGFkZHJJbmZvLmluZGV4KTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQGRldiBSZW1vdmUgYSBMb29wcmluZyBwcm90b2NvbCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIEEgbG9vcHJpbmcgcHJvdG9jb2wgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIGRlYXV0aG9yaXplQWRkcmVzcyhhZGRyZXNzIGFkZHIpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICB1aW50MzIgaW5kZXggPSBhZGRyZXNzSW5mb3NbYWRkcl0uaW5kZXg7CiAgICAgICAgaWYgKGluZGV4ICE9IDApIHsKICAgICAgICAgICAgYWRkcmVzc0luZm9zW2FkZHJdLmF1dGhvcml6ZWQgPSBmYWxzZTsKICAgICAgICAgICAgQWRkcmVzc0RlYXV0aG9yaXplZChhZGRyLCBpbmRleCk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaXNBZGRyZXNzQXV0aG9yaXplZChhZGRyZXNzIGFkZHIpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIGFkZHJlc3NJbmZvc1thZGRyXS5hdXRob3JpemVkOwogICAgfQogICAgZnVuY3Rpb24gZ2V0TGF0ZXN0QXV0aG9yaXplZEFkZHJlc3Nlcyh1aW50IG1heCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzW10gYWRkcmVzc2VzKQogICAgewogICAgICAgIGFkZHJlc3NlcyA9IG5ldyBhZGRyZXNzW10obWF4KTsKICAgICAgICBhZGRyZXNzIGFkZHIgPSBsYXRlc3RBZGRyZXNzOwogICAgICAgIEFkZHJlc3NJbmZvIG1lbW9yeSBhZGRySW5mbzsKICAgICAgICB1aW50IGNvdW50ID0gMDsKICAgICAgICB3aGlsZSAoYWRkciAhPSAweDAgJiYgY291bnQgPCBtYXgpIHsKICAgICAgICAgICAgYWRkckluZm8gPSBhZGRyZXNzSW5mb3NbYWRkcl07CiAgICAgICAgICAgIGlmIChhZGRySW5mby5pbmRleCA9PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRyZXNzZXNbY291bnQrK10gPSBhZGRyOwogICAgICAgICAgICBhZGRyID0gYWRkckluZm8ucHJldmlvdXM7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgSW52b2tlIEVSQzIwIHRyYW5zZmVyRnJvbSBtZXRob2QuCiAgICAvLy8gQHBhcmFtIHRva2VuIEFkZHJlc3Mgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGZyb20gQWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbiBmcm9tLgogICAgLy8vIEBwYXJhbSB0byBBZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VuIHRvLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBBbW91bnQgb2YgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuKAogICAgICAgIGFkZHJlc3MgdG9rZW4sCiAgICAgICAgYWRkcmVzcyBmcm9tLAogICAgICAgIGFkZHJlc3MgdG8sCiAgICAgICAgdWludCAgICB2YWx1ZSkKICAgICAgICBvbmx5QXV0aG9yaXplZAogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgaWYgKHZhbHVlID4gMCAmJiBmcm9tICE9IHRvKSB7CiAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICBFUkMyMCh0b2tlbikudHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSkKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBiYXRjaFRyYW5zZmVyVG9rZW4oCiAgICAgICAgYWRkcmVzcyBscmNUb2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBmZWVSZWNpcGllbnQsCiAgICAgICAgYnl0ZXMzMltdIGJhdGNoKQogICAgICAgIG9ubHlBdXRob3JpemVkCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICB1aW50IGxlbiA9IGJhdGNoLmxlbmd0aDsKICAgICAgICByZXF1aXJlKGxlbiAlIDYgPT0gMCk7CiAgICAgICAgRVJDMjAgbHJjID0gRVJDMjAobHJjVG9rZW5BZGRyZXNzKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW47IGkgKz0gNikgewogICAgICAgICAgICBhZGRyZXNzIG93bmVyID0gYWRkcmVzcyhiYXRjaFtpXSk7CiAgICAgICAgICAgIGFkZHJlc3MgcHJldk93bmVyID0gYWRkcmVzcyhiYXRjaFsoaSArIGxlbiAtIDYpICUgbGVuXSk7CiAgICAgICAgICAgIC8vIFBheSB0b2tlbiB0byBwcmV2aW91cyBvcmRlciwgb3IgdG8gbWluZXIgYXMgcHJldmlvdXMgb3JkZXIncwogICAgICAgICAgICAvLyBtYXJnaW4gc3BsaXQgb3IvYW5kIHRoaXMgb3JkZXIncyBtYXJnaW4gc3BsaXQuCiAgICAgICAgICAgIEVSQzIwIHRva2VuID0gRVJDMjAoYWRkcmVzcyhiYXRjaFtpICsgMV0pKTsKICAgICAgICAgICAgLy8gSGVyZSBiYXRjaFtpKzJdIGhhcyBiZWVuIGNoZWNrZWQgbm90IHRvIGJlIDAuCiAgICAgICAgICAgIGlmIChvd25lciAhPSBwcmV2T3duZXIpIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICAgICAgdG9rZW4udHJhbnNmZXJGcm9tKG93bmVyLCBwcmV2T3duZXIsIHVpbnQoYmF0Y2hbaSArIDJdKSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG93bmVyICE9IGZlZVJlY2lwaWVudCkgewogICAgICAgICAgICAgICAgYnl0ZXMzMiBpdGVtID0gYmF0Y2hbaSArIDNdOwogICAgICAgICAgICAgICAgaWYgKGl0ZW0gIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuLnRyYW5zZmVyRnJvbShvd25lciwgZmVlUmVjaXBpZW50LCB1aW50KGl0ZW0pKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpdGVtID0gYmF0Y2hbaSArIDRdOwogICAgICAgICAgICAgICAgaWYgKGl0ZW0gIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICAgICAgICAgIGxyYy50cmFuc2ZlckZyb20oZmVlUmVjaXBpZW50LCBvd25lciwgdWludChpdGVtKSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaXRlbSA9IGJhdGNoW2kgKyA1XTsKICAgICAgICAgICAgICAgIGlmIChpdGVtICE9IDApIHsKICAgICAgICAgICAgICAgICAgICByZXF1aXJlKAogICAgICAgICAgICAgICAgICAgICAgICBscmMudHJhbnNmZXJGcm9tKG93bmVyLCBmZWVSZWNpcGllbnQsIHVpbnQoaXRlbSkpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQovLy8gQHRpdGxlIExvb3ByaW5nIFRva2VuIEV4Y2hhbmdlIFByb3RvY29sIEltcGxlbWVudGF0aW9uIENvbnRyYWN0IHYxCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNzQxMDE1MWExZDExMTgzNDE4MWIxYjA0MDYxZDFhMTM1YTFiMDYxMyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LAovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIwZTY1NjE2MDY5NjI2NzZmNjA2OTRlNjI2MTYxN2U3YzY3NjA2OTIwNjE3YzY5Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8vCi8vLyBSZWNvZ25pemVkIGNvbnRyaWJ1dGluZyBkZXZlbG9wZXJzIGZyb20gdGhlIGNvbW11bml0eToKLy8vICAgICBodHRwczovL2dpdGh1Yi5jb20vQnJlY2h0cGQKLy8vICAgICBodHRwczovL2dpdGh1Yi5jb20vcmFpbnlkaW8KLy8vICAgICBodHRwczovL2dpdGh1Yi5jb20vQmVuamFtaW5QcmljZQovLy8gICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9qb25hc3NoZW4KY29udHJhY3QgTG9vcHJpbmdQcm90b2NvbEltcGwgaXMgTG9vcHJpbmdQcm90b2NvbCB7CiAgICB1c2luZyBNYXRoVWludCBmb3IgdWludDsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBWYXJpYWJsZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIGFkZHJlc3MgcHVibGljICBscmNUb2tlbkFkZHJlc3MgICAgICAgICAgICAgPSAweDA7CiAgICBhZGRyZXNzIHB1YmxpYyAgdG9rZW5SZWdpc3RyeUFkZHJlc3MgICAgICAgID0gMHgwOwogICAgYWRkcmVzcyBwdWJsaWMgIHJpbmdoYXNoUmVnaXN0cnlBZGRyZXNzICAgICA9IDB4MDsKICAgIGFkZHJlc3MgcHVibGljICBkZWxlZ2F0ZUFkZHJlc3MgICAgICAgICAgICAgPSAweDA7CiAgICB1aW50ICAgIHB1YmxpYyAgbWF4UmluZ1NpemUgICAgICAgICAgICAgICAgID0gMDsKICAgIHVpbnQ2NCAgcHVibGljICByaW5nSW5kZXggICAgICAgICAgICAgICAgICAgPSAwOwogICAgLy8gRXhjaGFuZ2UgcmF0ZSAocmF0ZSkgaXMgdGhlIGFtb3VudCB0byBzZWxsIG9yIHNvbGQgZGl2aWRlZCBieSB0aGUgYW1vdW50CiAgICAvLyB0byBidXkgb3IgYm91Z2h0LgogICAgLy8KICAgIC8vIFJhdGUgcmF0aW8gaXMgdGhlIHJhdGlvIGJldHdlZW4gZXhlY3V0ZWQgcmF0ZSBhbmQgYW4gb3JkZXIncyBvcmlnaW5hbAogICAgLy8gcmF0ZS4KICAgIC8vCiAgICAvLyBUbyByZXF1aXJlIGFsbCBvcmRlcnMnIHJhdGUgcmF0aW9zIHRvIGhhdmUgY29lZmZpY2llbnQgb2Z2YXJpYXRpb24gKENWKQogICAgLy8gc21hbGxlciB0aGFuIDIuNSUsIGZvciBhbiBleGFtcGxlICwgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkIHNob3VsZCBiZToKICAgIC8vICAgICBgKDAuMDI1ICogUkFURV9SQVRJT19TQ0FMRSleMmAgb3IgNjI1MDAuCiAgICB1aW50ICAgIHB1YmxpYyAgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkICAgICAgID0gMDsKICAgIHVpbnQgICAgcHVibGljIGNvbnN0YW50IFJBVEVfUkFUSU9fU0NBTEUgICAgPSAxMDAwMDsKICAgIHVpbnQ2NCAgcHVibGljIGNvbnN0YW50IEVOVEVSRURfTUFTSyAgICAgICAgPSAxIDw8IDYzOwogICAgLy8gVGhlIGZvbGxvd2luZyBtYXAgaXMgdXNlZCB0byBrZWVwIHRyYWNlIG9mIG9yZGVyIGZpbGwgYW5kIGNhbmNlbGxhdGlvbgogICAgLy8gaGlzdG9yeS4KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcHVibGljIGNhbmNlbGxlZE9yRmlsbGVkOwogICAgLy8gQSBtYXAgZnJvbSBhZGRyZXNzIHRvIGl0cyBjdXRvZmYgdGltZXN0YW1wLgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgY3V0b2ZmczsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBTdHJ1Y3RzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIHN0cnVjdCBSYXRlIHsKICAgICAgICB1aW50IGFtb3VudFM7CiAgICAgICAgdWludCBhbW91bnRCOwogICAgfQogICAgLy8vIEBwYXJhbSB0b2tlblMgICAgICAgVG9rZW4gdG8gc2VsbC4KICAgIC8vLyBAcGFyYW0gdG9rZW5CICAgICAgIFRva2VuIHRvIGJ1eS4KICAgIC8vLyBAcGFyYW0gYW1vdW50UyAgICAgIE1heGltdW0gYW1vdW50IG9mIHRva2VuUyB0byBzZWxsLgogICAgLy8vIEBwYXJhbSBhbW91bnRCICAgICAgTWluaW11bSBhbW91bnQgb2YgdG9rZW5CIHRvIGJ1eSBpZiBhbGwgYW1vdW50UyBzb2xkLgogICAgLy8vIEBwYXJhbSB0aW1lc3RhbXAgICAgSW5kaWNhdGluZyB3aGVuIHRoaXMgb3JkZXIgaXMgY3JlYXRlZC9zaWduZWQuCiAgICAvLy8gQHBhcmFtIHR0bCAgICAgICAgICBJbmRpY2F0aW5nIGFmdGVyIGhvdyBtYW55IHNlY29uZHMgZnJvbSBgdGltZXN0YW1wYAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhpcyBvcmRlciB3aWxsIGV4cGlyZS4KICAgIC8vLyBAcGFyYW0gc2FsdCAgICAgICAgIEEgcmFuZG9tIG51bWJlciB0byBtYWtlIHRoaXMgb3JkZXIncyBoYXNoIHVuaXF1ZS4KICAgIC8vLyBAcGFyYW0gbHJjRmVlICAgICAgIE1heCBhbW91bnQgb2YgTFJDIHRvIHBheSBmb3IgbWluZXIuIFRoZSByZWFsIGFtb3VudAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdG8gcGF5IGlzIHByb3BvcnRpb25hbCB0byBmaWxsIGFtb3VudC4KICAgIC8vLyBAcGFyYW0gYnV5Tm9Nb3JlVGhhbkFtb3VudEIgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgSWYgdHJ1ZSwgdGhpcyBvcmRlciBkb2VzIG5vdCBhY2NlcHQgYnV5aW5nIG1vcmUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoYW4gYGFtb3VudEJgLgogICAgLy8vIEBwYXJhbSBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgVGhlIHBlcmNlbnRhZ2Ugb2YgbWFyZ2luIHBhaWQgdG8gbWluZXIuCiAgICAvLy8gQHBhcmFtIHYgICAgICAgICAgICBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVyIHYuCiAgICAvLy8gQHBhcmFtIHIgICAgICAgICAgICBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyByLgogICAgLy8vIEBwYXJhbSBzICAgICAgICAgICAgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgcy4KICAgIHN0cnVjdCBPcmRlciB7CiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICBhZGRyZXNzIHRva2VuUzsKICAgICAgICBhZGRyZXNzIHRva2VuQjsKICAgICAgICB1aW50ICAgIGFtb3VudFM7CiAgICAgICAgdWludCAgICBhbW91bnRCOwogICAgICAgIHVpbnQgICAgbHJjRmVlOwogICAgICAgIGJvb2wgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEI7CiAgICAgICAgdWludDggICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2U7CiAgICB9CiAgICAvLy8gQHBhcmFtIG9yZGVyICAgICAgICBUaGUgb3JpZ2luYWwgb3JkZXIKICAgIC8vLyBAcGFyYW0gb3JkZXJIYXNoICAgIFRoZSBvcmRlcidzIGhhc2gKICAgIC8vLyBAcGFyYW0gZmVlU2VsZWN0aW9uIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIEEgbWluZXItc3VwcGxpZWQgdmFsdWUgaW5kaWNhdGluZyBpZiBMUkMgKHZhbHVlID0gMCkKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIG9yIG1hcmdpbiBzcGxpdCBpcyBjaG9vc2VuIGJ5IHRoZSBtaW5lciAodmFsdWUgPSAxKS4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIFdlIG1heSBzdXBwb3J0IG1vcmUgZmVlIG1vZGVsIGluIHRoZSBmdXR1cmUuCiAgICAvLy8gQHBhcmFtIHJhdGUgICAgICAgICBFeGNoYW5nZSByYXRlIHByb3ZpZGVkIGJ5IG1pbmVyLgogICAgLy8vIEBwYXJhbSBmaWxsQW1vdW50UyAgQW1vdW50IG9mIHRva2VuUyB0byBzZWxsLCBjYWxjdWxhdGVkIGJ5IHByb3RvY29sLgogICAgLy8vIEBwYXJhbSBscmNSZXdhcmQgICAgVGhlIGFtb3VudCBvZiBMUkMgcGFpZCBieSBtaW5lciB0byBvcmRlciBvd25lciBpbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgZXhjaGFuZ2UgZm9yIG1hcmdpbiBzcGxpdC4KICAgIC8vLyBAcGFyYW0gbHJjRmVlICAgICAgIFRoZSBhbW91bnQgb2YgTFIgcGFpZCBieSBvcmRlciBvd25lciB0byBtaW5lci4KICAgIC8vLyBAcGFyYW0gc3BsaXRTICAgICAgVG9rZW5TIHBhaWQgdG8gbWluZXIuCiAgICAvLy8gQHBhcmFtIHNwbGl0QiAgICAgIFRva2VuQiBwYWlkIHRvIG1pbmVyLgogICAgc3RydWN0IE9yZGVyU3RhdGUgewogICAgICAgIE9yZGVyICAgb3JkZXI7CiAgICAgICAgYnl0ZXMzMiBvcmRlckhhc2g7CiAgICAgICAgdWludDggICBmZWVTZWxlY3Rpb247CiAgICAgICAgUmF0ZSAgICByYXRlOwogICAgICAgIHVpbnQgICAgZmlsbEFtb3VudFM7CiAgICAgICAgdWludCAgICBscmNSZXdhcmQ7CiAgICAgICAgdWludCAgICBscmNGZWU7CiAgICAgICAgdWludCAgICBzcGxpdFM7CiAgICAgICAgdWludCAgICBzcGxpdEI7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQ29uc3RydWN0b3IgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBmdW5jdGlvbiBMb29wcmluZ1Byb3RvY29sSW1wbCgKICAgICAgICBhZGRyZXNzIF9scmNUb2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfdG9rZW5SZWdpc3RyeUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfcmluZ2hhc2hSZWdpc3RyeUFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfZGVsZWdhdGVBZGRyZXNzLAogICAgICAgIHVpbnQgICAgX21heFJpbmdTaXplLAogICAgICAgIHVpbnQgICAgX3JhdGVSYXRpb0NWU1RocmVzaG9sZAogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKDB4MCAhPSBfbHJjVG9rZW5BZGRyZXNzKTsKICAgICAgICByZXF1aXJlKDB4MCAhPSBfdG9rZW5SZWdpc3RyeUFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoMHgwICE9IF9yaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZSgweDAgIT0gX2RlbGVnYXRlQWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShfbWF4UmluZ1NpemUgPiAxKTsKICAgICAgICByZXF1aXJlKF9yYXRlUmF0aW9DVlNUaHJlc2hvbGQgPiAwKTsKICAgICAgICBscmNUb2tlbkFkZHJlc3MgPSBfbHJjVG9rZW5BZGRyZXNzOwogICAgICAgIHRva2VuUmVnaXN0cnlBZGRyZXNzID0gX3Rva2VuUmVnaXN0cnlBZGRyZXNzOwogICAgICAgIHJpbmdoYXNoUmVnaXN0cnlBZGRyZXNzID0gX3JpbmdoYXNoUmVnaXN0cnlBZGRyZXNzOwogICAgICAgIGRlbGVnYXRlQWRkcmVzcyA9IF9kZWxlZ2F0ZUFkZHJlc3M7CiAgICAgICAgbWF4UmluZ1NpemUgPSBfbWF4UmluZ1NpemU7CiAgICAgICAgcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkID0gX3JhdGVSYXRpb0NWU1RocmVzaG9sZDsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBQdWJsaWMgRnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAZGV2IERpc2FibGUgZGVmYXVsdCBmdW5jdGlvbi4KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgcHVibGljIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIC8vLyBAZGV2IFN1Ym1pdCBhIG9yZGVyLXJpbmcgZm9yIHZhbGlkYXRpb24gYW5kIHNldHRsZW1lbnQuCiAgICAvLy8gQHBhcmFtIGFkZHJlc3NMaXN0ICBMaXN0IG9mIGVhY2ggb3JkZXIncyB0b2tlblMuIE5vdGUgdGhhdCBuZXh0IG9yZGVyJ3MKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGB0b2tlblNgIGVxdWFscyB0aGlzIG9yZGVyJ3MgYHRva2VuQmAuCiAgICAvLy8gQHBhcmFtIHVpbnRBcmdzTGlzdCBMaXN0IG9mIHVpbnQtdHlwZSBhcmd1bWVudHMgaW4gdGhpcyBvcmRlcjoKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGFtb3VudFMsIGFtb3VudEIsIHRpbWVzdGFtcCwgdHRsLCBzYWx0LCBscmNGZWUsCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICByYXRlQW1vdW50Uy4KICAgIC8vLyBAcGFyYW0gdWludDhBcmdzTGlzdCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMaXN0IG9mIHVuaXQ4LXR5cGUgYXJndW1lbnRzLCBpbiB0aGlzIG9yZGVyOgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlTGlzdCxmZWVTZWxlY3Rpb25MaXN0LgogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgVGhpcyBpbmRpY2F0ZXMgd2hlbiBhIG9yZGVyIHNob3VsZCBiZSBjb25zaWRlcmVkCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBhcyAnY29tcGxldGVseSBmaWxsZWQnLgogICAgLy8vIEBwYXJhbSB2TGlzdCAgICAgICAgTGlzdCBvZiB2IGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB2IHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gckxpc3QgICAgICAgIExpc3Qgb2YgciBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgciB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHNMaXN0ICAgICAgICBMaXN0IG9mIHMgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHMgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSByaW5nbWluZXIgICAgVGhlIGFkZHJlc3MgdGhhdCBzaWduZWQgdGhpcyB0eC4KICAgIC8vLyBAcGFyYW0gZmVlUmVjaXBpZW50IFRoZSBSZWNpcGllbnQgYWRkcmVzcyBmb3IgZmVlIGNvbGxlY3Rpb24uIElmIHRoaXMgaXMKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICcweDAnLCBhbGwgZmVlcyB3aWxsIGJlIHBhaWQgdG8gdGhlIGFkZHJlc3Mgd2hvIGhhZAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgc2lnbmVkIHRoaXMgdHJhbnNhY3Rpb24sIG5vdCBgbXNnLnNlbmRlcmAuIE5vdGVkIGlmCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMUkMgbmVlZCB0byBiZSBwYWlkIGJhY2sgdG8gb3JkZXIgb3duZXIgYXMgdGhlIHJlc3VsdAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgb2YgZmVlIHNlbGVjdGlvbiBtb2RlbCwgTFJDIHdpbGwgYWxzbyBiZSBzZW50IGZyb20KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoaXMgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHN1Ym1pdFJpbmcoCiAgICAgICAgYWRkcmVzc1syXVtdICBhZGRyZXNzTGlzdCwKICAgICAgICB1aW50WzddW10gICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICB1aW50OFsyXVtdICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgYm9vbFtdICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgdWludDhbXSAgICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgc0xpc3QsCiAgICAgICAgYWRkcmVzcyAgICAgICByaW5nbWluZXIsCiAgICAgICAgYWRkcmVzcyAgICAgICBmZWVSZWNpcGllbnQKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGhpZ2hlc3QgYml0IG9mIHJpbmdJbmRleCBpcyAnMScuCiAgICAgICAgcmVxdWlyZShyaW5nSW5kZXggJiBFTlRFUkVEX01BU0sgIT0gRU5URVJFRF9NQVNLKTsgLy8gImF0dGVtcHRlZCB0byByZS1lbnQgc3VibWl0UmluZyBmdW5jdGlvbiIpOwogICAgICAgIC8vIFNldCB0aGUgaGlnaGVzdCBiaXQgb2YgcmluZ0luZGV4IHRvICcxJy4KICAgICAgICByaW5nSW5kZXggfD0gRU5URVJFRF9NQVNLOwogICAgICAgIC8vQ2hlY2sgcmluZyBzaXplCiAgICAgICAgdWludCByaW5nU2l6ZSA9IGFkZHJlc3NMaXN0Lmxlbmd0aDsKICAgICAgICByZXF1aXJlKHJpbmdTaXplID4gMSAmJiByaW5nU2l6ZSA8PSBtYXhSaW5nU2l6ZSk7IC8vICJpbnZhbGlkIHJpbmcgc2l6ZSIpOwogICAgICAgIHZlcmlmeUlucHV0RGF0YUludGVncml0eSgKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIGFkZHJlc3NMaXN0LAogICAgICAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CiAgICAgICAgdmVyaWZ5VG9rZW5zUmVnaXN0ZXJlZChyaW5nU2l6ZSwgYWRkcmVzc0xpc3QpOwogICAgICAgIHZhciAocmluZ2hhc2gsIHJpbmdoYXNoQXR0cmlidXRlcykgPSBSaW5naGFzaFJlZ2lzdHJ5KAogICAgICAgICAgICByaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcwogICAgICAgICkuY29tcHV0ZUFuZEdldFJpbmdoYXNoSW5mbygKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIHJpbmdtaW5lciwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CiAgICAgICAgLy9DaGVjayBpZiB3ZSBjYW4gc3VibWl0IHRoaXMgcmluZ2hhc2guCiAgICAgICAgcmVxdWlyZShyaW5naGFzaEF0dHJpYnV0ZXNbMF0pOyAvLyAiUmluZyBjbGFpbWVkIGJ5IG90aGVycyIpOwogICAgICAgIHZlcmlmeVNpZ25hdHVyZSgKICAgICAgICAgICAgcmluZ21pbmVyLAogICAgICAgICAgICByaW5naGFzaCwKICAgICAgICAgICAgdkxpc3RbcmluZ1NpemVdLAogICAgICAgICAgICByTGlzdFtyaW5nU2l6ZV0sCiAgICAgICAgICAgIHNMaXN0W3JpbmdTaXplXQogICAgICAgICk7CiAgICAgICAgLy9Bc3NlbWJsZSBpbnB1dCBkYXRhIGludG8gc3RydWN0cyBzbyB3ZSBjYW4gcGFzcyB0aGVtIHRvIG90aGVyIGZ1bmN0aW9ucy4KICAgICAgICBPcmRlclN0YXRlW10gbWVtb3J5IG9yZGVycyA9IGFzc2VtYmxlT3JkZXJzKAogICAgICAgICAgICBhZGRyZXNzTGlzdCwKICAgICAgICAgICAgdWludEFyZ3NMaXN0LAogICAgICAgICAgICB1aW50OEFyZ3NMaXN0LAogICAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgICAgIHZMaXN0LAogICAgICAgICAgICByTGlzdCwKICAgICAgICAgICAgc0xpc3QKICAgICAgICApOwogICAgICAgIGlmIChmZWVSZWNpcGllbnQgPT0gMHgwKSB7CiAgICAgICAgICAgIGZlZVJlY2lwaWVudCA9IHJpbmdtaW5lcjsKICAgICAgICB9CiAgICAgICAgaGFuZGxlUmluZygKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIHJpbmdoYXNoLAogICAgICAgICAgICBvcmRlcnMsCiAgICAgICAgICAgIHJpbmdtaW5lciwKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICByaW5naGFzaEF0dHJpYnV0ZXNbMV0KICAgICAgICApOwogICAgICAgIHJpbmdJbmRleCA9IChyaW5nSW5kZXggXiBFTlRFUkVEX01BU0spICsgMTsKICAgIH0KICAgIC8vLyBAZGV2IENhbmNlbCBhIG9yZGVyLiBjYW5jZWwgYW1vdW50KGFtb3VudFMgb3IgYW1vdW50QikgY2FuIGJlIHNwZWNpZmllZAogICAgLy8vICAgICAgaW4gb3JkZXJWYWx1ZXMuCiAgICAvLy8gQHBhcmFtIGFkZHJlc3NlcyAgICAgICAgICBvd25lciwgdG9rZW5TLCB0b2tlbkIKICAgIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgICAgICAgIGFtb3VudFMsIGFtb3VudEIsIHRpbWVzdGFtcCwgdHRsLCBzYWx0LCBscmNGZWUsCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxBbW91bnRTLCBhbmQgY2FuY2VsQW1vdW50Qi4KICAgIC8vLyBAcGFyYW0gYnV5Tm9Nb3JlVGhhbkFtb3VudEIgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhpcyBpbmRpY2F0ZXMgd2hlbiBhIG9yZGVyIHNob3VsZCBiZSBjb25zaWRlcmVkCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBhcyAnY29tcGxldGVseSBmaWxsZWQnLgogICAgLy8vIEBwYXJhbSBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgICAgICAgUGVyY2VudGFnZSBvZiBtYXJnaW4gc3BsaXQgdG8gc2hhcmUgd2l0aCBtaW5lci4KICAgIC8vLyBAcGFyYW0gdiAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAgIC8vLyBAcGFyYW0gciAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgICAvLy8gQHBhcmFtIHMgICAgICAgICAgICAgICAgICBPcmRlciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgZnVuY3Rpb24gY2FuY2VsT3JkZXIoCiAgICAgICAgYWRkcmVzc1szXSBhZGRyZXNzZXMsCiAgICAgICAgdWludFs3XSAgICBvcmRlclZhbHVlcywKICAgICAgICBib29sICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCLAogICAgICAgIHVpbnQ4ICAgICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlLAogICAgICAgIHVpbnQ4ICAgICAgdiwKICAgICAgICBieXRlczMyICAgIHIsCiAgICAgICAgYnl0ZXMzMiAgICBzCiAgICAgICAgKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgdWludCBjYW5jZWxBbW91bnQgPSBvcmRlclZhbHVlc1s2XTsKICAgICAgICByZXF1aXJlKGNhbmNlbEFtb3VudCA+IDApOyAvLyAiYW1vdW50IHRvIGNhbmNlbCBpcyB6ZXJvIik7CiAgICAgICAgT3JkZXIgbWVtb3J5IG9yZGVyID0gT3JkZXIoCiAgICAgICAgICAgIGFkZHJlc3Nlc1swXSwKICAgICAgICAgICAgYWRkcmVzc2VzWzFdLAogICAgICAgICAgICBhZGRyZXNzZXNbMl0sCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzBdLAogICAgICAgICAgICBvcmRlclZhbHVlc1sxXSwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbNV0sCiAgICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCLAogICAgICAgICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UKICAgICAgICApOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmRlci5vd25lcik7IC8vICJjYW5jZWxPcmRlciBub3Qgc3VibWl0dGVkIGJ5IG9yZGVyIG93bmVyIik7CiAgICAgICAgYnl0ZXMzMiBvcmRlckhhc2ggPSBjYWxjdWxhdGVPcmRlckhhc2goCiAgICAgICAgICAgIG9yZGVyLAogICAgICAgICAgICBvcmRlclZhbHVlc1syXSwgLy8gdGltZXN0YW1wCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzNdLCAvLyB0dGwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbNF0gIC8vIHNhbHQKICAgICAgICApOwogICAgICAgIHZlcmlmeVNpZ25hdHVyZSgKICAgICAgICAgICAgb3JkZXIub3duZXIsCiAgICAgICAgICAgIG9yZGVySGFzaCwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcwogICAgICAgICk7CiAgICAgICAgY2FuY2VsbGVkT3JGaWxsZWRbb3JkZXJIYXNoXSA9IGNhbmNlbGxlZE9yRmlsbGVkW29yZGVySGFzaF0uYWRkKGNhbmNlbEFtb3VudCk7CiAgICAgICAgT3JkZXJDYW5jZWxsZWQob3JkZXJIYXNoLCBjYW5jZWxBbW91bnQpOwogICAgfQogICAgLy8vIEBkZXYgICBTZXQgYSBjdXRvZmYgdGltZXN0YW1wIHRvIGludmFsaWRhdGUgYWxsIG9yZGVycyB3aG9zZSB0aW1lc3RhbXAKICAgIC8vLyAgICAgICAgaXMgc21hbGxlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBuZXcgdmFsdWUgb2YgdGhlIGFkZHJlc3MncyBjdXRvZmYKICAgIC8vLyAgICAgICAgdGltZXN0YW1wLgogICAgLy8vIEBwYXJhbSBjdXRvZmYgVGhlIGN1dG9mZiB0aW1lc3RhbXAsIHdpbGwgZGVmYXVsdCB0byBgYmxvY2sudGltZXN0YW1wYAogICAgLy8vICAgICAgICBpZiBpdCBpcyAwLgogICAgZnVuY3Rpb24gc2V0Q3V0b2ZmKHVpbnQgY3V0b2ZmKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgdWludCB0ID0gKGN1dG9mZiA9PSAwIHx8IGN1dG9mZiA+PSBibG9jay50aW1lc3RhbXApID8gYmxvY2sudGltZXN0YW1wIDogY3V0b2ZmOwogICAgICAgIHJlcXVpcmUoY3V0b2Zmc1ttc2cuc2VuZGVyXSA8IHQpOyAvLyAiYXR0ZW1wdGVkIHRvIHNldCBjdXRvZmYgdG8gYSBzbWFsbGVyIHZhbHVlIgogICAgICAgIGN1dG9mZnNbbXNnLnNlbmRlcl0gPSB0OwogICAgICAgIEN1dG9mZlRpbWVzdGFtcENoYW5nZWQobXNnLnNlbmRlciwgdCk7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gSW50ZXJuYWwgJiBQcml2YXRlIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQGRldiBWYWxpZGF0ZSBhIHJpbmcuCiAgICBmdW5jdGlvbiB2ZXJpZnlSaW5nSGFzTm9TdWJSaW5nKAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgT3JkZXJTdGF0ZVtdICBvcmRlcnMKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUKICAgIHsKICAgICAgICAvLyBDaGVjayB0aGUgcmluZyBoYXMgbm8gc3ViLXJpbmcuCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemUgLSAxOyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyB0b2tlblMgPSBvcmRlcnNbaV0ub3JkZXIudG9rZW5TOwogICAgICAgICAgICBmb3IgKHVpbnQgaiA9IGkgKyAxOyBqIDwgcmluZ1NpemU7IGorKykgewogICAgICAgICAgICAgICAgcmVxdWlyZSh0b2tlblMgIT0gb3JkZXJzW2pdLm9yZGVyLnRva2VuUyk7IC8vICJmb3VuZCBzdWItcmluZyIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gdmVyaWZ5VG9rZW5zUmVnaXN0ZXJlZCgKICAgICAgICB1aW50ICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIGFkZHJlc3NbMl1bXSAgYWRkcmVzc0xpc3QKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgIHsKICAgICAgICAvLyBFeHRyYWN0IHRoZSB0b2tlbiBhZGRyZXNzZXMKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IHRva2VucyA9IG5ldyBhZGRyZXNzW10ocmluZ1NpemUpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgdG9rZW5zW2ldID0gYWRkcmVzc0xpc3RbaV1bMV07CiAgICAgICAgfQogICAgICAgIC8vIFRlc3QgYWxsIHRva2VuIGFkZHJlc3NlcyBhdCBvbmNlCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgVG9rZW5SZWdpc3RyeSh0b2tlblJlZ2lzdHJ5QWRkcmVzcykuYXJlQWxsVG9rZW5zUmVnaXN0ZXJlZCh0b2tlbnMpCiAgICAgICAgKTsgLy8gInRva2VuIG5vdCByZWdpc3RlcmVkIik7CiAgICB9CiAgICBmdW5jdGlvbiBoYW5kbGVSaW5nKAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgYnl0ZXMzMiAgICAgICByaW5naGFzaCwKICAgICAgICBPcmRlclN0YXRlW10gIG9yZGVycywKICAgICAgICBhZGRyZXNzICAgICAgIG1pbmVyLAogICAgICAgIGFkZHJlc3MgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgIGJvb2wgICAgICAgICAgaXNSaW5naGFzaFJlc2VydmVkCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgIHsKICAgICAgICB1aW50NjQgX3JpbmdJbmRleCA9IHJpbmdJbmRleCBeIEVOVEVSRURfTUFTSzsKICAgICAgICBhZGRyZXNzIF9scmNUb2tlbkFkZHJlc3MgPSBscmNUb2tlbkFkZHJlc3M7CiAgICAgICAgVG9rZW5UcmFuc2ZlckRlbGVnYXRlIGRlbGVnYXRlID0gVG9rZW5UcmFuc2ZlckRlbGVnYXRlKGRlbGVnYXRlQWRkcmVzcyk7CiAgICAgICAgLy8gRG8gdGhlIGhhcmQgd29yay4KICAgICAgICB2ZXJpZnlSaW5nSGFzTm9TdWJSaW5nKHJpbmdTaXplLCBvcmRlcnMpOwogICAgICAgIC8vIEV4Y2hhbmdlIHJhdGVzIGNhbGN1bGF0aW9uIGFyZSBwZXJmb3JtZWQgYnkgcmluZy1taW5lcnMgYXMgc29saWRpdHkKICAgICAgICAvLyBjYW5ub3QgZ2V0IHBvd2VyLW9mLTEvbiBvcGVyYXRpb24sIHRoZXJlZm9yZSB3ZSBoYXZlIHRvIHZlcmlmeQogICAgICAgIC8vIHRoZXNlIHJhdGVzIGFyZSBjb3JyZWN0LgogICAgICAgIHZlcmlmeU1pbmVyU3VwcGxpZWRGaWxsUmF0ZXMocmluZ1NpemUsIG9yZGVycyk7CiAgICAgICAgLy8gU2NhbGUgZG93biBlYWNoIG9yZGVyIGluZGVwZW5kZW50bHkgYnkgc3Vic3RyYWN0aW5nIGFtb3VudC1maWxsZWQgYW5kCiAgICAgICAgLy8gYW1vdW50LWNhbmNlbGxlZC4gT3JkZXIgb3duZXIncyBjdXJyZW50IGJhbGFuY2UgYW5kIGFsbG93YW5jZSBhcmUKICAgICAgICAvLyBub3QgdGFrZW4gaW50byBjb25zaWRlcmF0aW9uIGluIHRoZXNlIG9wZXJhdGlvbnMuCiAgICAgICAgc2NhbGVSaW5nQmFzZWRPbkhpc3RvcmljYWxSZWNvcmRzKGRlbGVnYXRlLCByaW5nU2l6ZSwgb3JkZXJzKTsKICAgICAgICAvLyBCYXNlZCBvbiB0aGUgYWxyZWFkeSB2ZXJpZmllZCBleGNoYW5nZSByYXRlIHByb3ZpZGVkIGJ5IHJpbmctbWluZXJzLAogICAgICAgIC8vIHdlIGNhbiBmdXJ0aHVyIHNjYWxlIGRvd24gb3JkZXJzIGJhc2VkIG9uIHRva2VuIGJhbGFuY2UgYW5kIGFsbG93YW5jZSwKICAgICAgICAvLyB0aGVuIGZpbmQgdGhlIHNtYWxsZXN0IG9yZGVyIG9mIHRoZSByaW5nLCB0aGVuIGNhbGN1bGF0ZSBlYWNoIG9yZGVyJ3MKICAgICAgICAvLyBgZmlsbEFtb3VudFNgLgogICAgICAgIGNhbGN1bGF0ZVJpbmdGaWxsQW1vdW50KHJpbmdTaXplLCBvcmRlcnMpOwogICAgICAgIC8vIENhbGN1bGF0ZSBlYWNoIG9yZGVyJ3MgYGxyY0ZlZWAgYW5kIGBscmNSZXdyYXJkYCBhbmQgc3BsaWN0IGhvdyBtdWNoCiAgICAgICAgLy8gb2YgYGZpbGxBbW91bnRTYCBzaGFsbCBiZSBwYWlkIHRvIG1hdGNoaW5nIG9yZGVyIG9yIG1pbmVyIGFzIG1hcmdpbgogICAgICAgIC8vIHNwbGl0LgogICAgICAgIGNhbGN1bGF0ZVJpbmdGZWVzKAogICAgICAgICAgICBkZWxlZ2F0ZSwKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIG9yZGVycywKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICBfbHJjVG9rZW5BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICAvLy8gTWFrZSB0cmFuc2ZlcnMuCiAgICAgICAgdmFyIChvcmRlckhhc2hMaXN0LCBhbW91bnRzTGlzdCkgPSBzZXR0bGVSaW5nKAogICAgICAgICAgICBkZWxlZ2F0ZSwKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIG9yZGVycywKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICBfbHJjVG9rZW5BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBSaW5nTWluZWQoCiAgICAgICAgICAgIF9yaW5nSW5kZXgsCiAgICAgICAgICAgIHJpbmdoYXNoLAogICAgICAgICAgICBtaW5lciwKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICBpc1JpbmdoYXNoUmVzZXJ2ZWQsCiAgICAgICAgICAgIG9yZGVySGFzaExpc3QsCiAgICAgICAgICAgIGFtb3VudHNMaXN0CiAgICAgICAgKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldHRsZVJpbmcoCiAgICAgICAgVG9rZW5UcmFuc2ZlckRlbGVnYXRlIGRlbGVnYXRlLAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgT3JkZXJTdGF0ZVtdICBvcmRlcnMsCiAgICAgICAgYWRkcmVzcyAgICAgICBmZWVSZWNpcGllbnQsCiAgICAgICAgYWRkcmVzcyAgICAgICBfbHJjVG9rZW5BZGRyZXNzCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICByZXR1cm5zKAogICAgICAgIGJ5dGVzMzJbXSBtZW1vcnkgb3JkZXJIYXNoTGlzdCwKICAgICAgICB1aW50WzZdW10gbWVtb3J5IGFtb3VudHNMaXN0KQogICAgewogICAgICAgIGJ5dGVzMzJbXSBtZW1vcnkgYmF0Y2ggPSBuZXcgYnl0ZXMzMltdKHJpbmdTaXplICogNik7IC8vIHJpbmdTaXplICogKG93bmVyICsgdG9rZW5TICsgNCBhbW91bnRzKQogICAgICAgIG9yZGVySGFzaExpc3QgPSBuZXcgYnl0ZXMzMltdKHJpbmdTaXplKTsKICAgICAgICBhbW91bnRzTGlzdCA9IG5ldyB1aW50WzZdW10ocmluZ1NpemUpOwogICAgICAgIHVpbnQgcCA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICBPcmRlclN0YXRlIG1lbW9yeSBzdGF0ZSA9IG9yZGVyc1tpXTsKICAgICAgICAgICAgT3JkZXIgbWVtb3J5IG9yZGVyID0gc3RhdGUub3JkZXI7CiAgICAgICAgICAgIHVpbnQgcHJldlNwbGl0QiA9IG9yZGVyc1soaSArIHJpbmdTaXplIC0gMSkgJSByaW5nU2l6ZV0uc3BsaXRCOwogICAgICAgICAgICB1aW50IG5leHRGaWxsQW1vdW50UyA9IG9yZGVyc1soaSArIDEpICUgcmluZ1NpemVdLmZpbGxBbW91bnRTOwogICAgICAgICAgICAvLyBTdG9yZSBvd25lciBhbmQgdG9rZW5TIG9mIGV2ZXJ5IG9yZGVyCiAgICAgICAgICAgIGJhdGNoW3BdID0gYnl0ZXMzMihvcmRlci5vd25lcik7CiAgICAgICAgICAgIGJhdGNoW3ArMV0gPSBieXRlczMyKG9yZGVyLnRva2VuUyk7CiAgICAgICAgICAgIC8vIFN0b3JlIGFsbCBhbW91bnRzCiAgICAgICAgICAgIGJhdGNoW3ArMl0gPSBieXRlczMyKHN0YXRlLmZpbGxBbW91bnRTIC0gcHJldlNwbGl0Qik7CiAgICAgICAgICAgIGJhdGNoW3ArM10gPSBieXRlczMyKHByZXZTcGxpdEIgKyBzdGF0ZS5zcGxpdFMpOwogICAgICAgICAgICBiYXRjaFtwKzRdID0gYnl0ZXMzMihzdGF0ZS5scmNSZXdhcmQpOwogICAgICAgICAgICBiYXRjaFtwKzVdID0gYnl0ZXMzMihzdGF0ZS5scmNGZWUpOwogICAgICAgICAgICBwICs9IDY7CiAgICAgICAgICAgIC8vIFVwZGF0ZSBmaWxsIHJlY29yZHMKICAgICAgICAgICAgaWYgKG9yZGVyLmJ1eU5vTW9yZVRoYW5BbW91bnRCKSB7CiAgICAgICAgICAgICAgICBjYW5jZWxsZWRPckZpbGxlZFtzdGF0ZS5vcmRlckhhc2hdICs9IG5leHRGaWxsQW1vdW50UzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNhbmNlbGxlZE9yRmlsbGVkW3N0YXRlLm9yZGVySGFzaF0gKz0gc3RhdGUuZmlsbEFtb3VudFM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3JkZXJIYXNoTGlzdFtpXSA9IHN0YXRlLm9yZGVySGFzaDsKICAgICAgICAgICAgYW1vdW50c0xpc3RbaV1bMF0gPSBzdGF0ZS5maWxsQW1vdW50UyArIHN0YXRlLnNwbGl0UzsKICAgICAgICAgICAgYW1vdW50c0xpc3RbaV1bMV0gPSBuZXh0RmlsbEFtb3VudFMgLSBzdGF0ZS5zcGxpdEI7CiAgICAgICAgICAgIGFtb3VudHNMaXN0W2ldWzJdID0gc3RhdGUubHJjUmV3YXJkOwogICAgICAgICAgICBhbW91bnRzTGlzdFtpXVszXSA9IHN0YXRlLmxyY0ZlZTsKICAgICAgICAgICAgYW1vdW50c0xpc3RbaV1bNF0gPSBzdGF0ZS5zcGxpdFM7CiAgICAgICAgICAgIGFtb3VudHNMaXN0W2ldWzVdID0gc3RhdGUuc3BsaXRCOwogICAgICAgIH0KICAgICAgICAvLyBEbyBhbGwgdHJhbnNhY3Rpb25zCiAgICAgICAgZGVsZWdhdGUuYmF0Y2hUcmFuc2ZlclRva2VuKF9scmNUb2tlbkFkZHJlc3MsIGZlZVJlY2lwaWVudCwgYmF0Y2gpOwogICAgfQogICAgLy8vIEBkZXYgVmVyaWZ5IG1pbmVyIGhhcyBjYWxjdWx0ZSB0aGUgcmF0ZXMgY29ycmVjdGx5LgogICAgZnVuY3Rpb24gdmVyaWZ5TWluZXJTdXBwbGllZEZpbGxSYXRlcygKICAgICAgICB1aW50ICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIE9yZGVyU3RhdGVbXSAgb3JkZXJzCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICB7CiAgICAgICAgdWludFtdIG1lbW9yeSByYXRlUmF0aW9zID0gbmV3IHVpbnRbXShyaW5nU2l6ZSk7CiAgICAgICAgdWludCBfcmF0ZVJhdGlvU2NhbGUgPSBSQVRFX1JBVElPX1NDQUxFOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgdWludCBzMWIwID0gb3JkZXJzW2ldLnJhdGUuYW1vdW50Uy5tdWwob3JkZXJzW2ldLm9yZGVyLmFtb3VudEIpOwogICAgICAgICAgICB1aW50IHMwYjEgPSBvcmRlcnNbaV0ub3JkZXIuYW1vdW50Uy5tdWwob3JkZXJzW2ldLnJhdGUuYW1vdW50Qik7CiAgICAgICAgICAgIHJlcXVpcmUoczFiMCA8PSBzMGIxKTsgLy8gIm1pbmVyIHN1cHBsaWVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXMgaW52YWxpZCBkaXNjb3VudCIpOwogICAgICAgICAgICByYXRlUmF0aW9zW2ldID0gX3JhdGVSYXRpb1NjYWxlLm11bChzMWIwKSAvIHMwYjE7CiAgICAgICAgfQogICAgICAgIHVpbnQgY3ZzID0gTWF0aFVpbnQuY3ZzcXVhcmUocmF0ZVJhdGlvcywgX3JhdGVSYXRpb1NjYWxlKTsKICAgICAgICByZXF1aXJlKGN2cyA8PSByYXRlUmF0aW9DVlNUaHJlc2hvbGQpOyAvLyAibWluZXIgc3VwcGxpZWQgZXhjaGFuZ2UgcmF0ZSBpcyBub3QgZXZlbmx5IGRpc2NvdW50ZWQiKTsKICAgIH0KICAgIC8vLyBAZGV2IENhbGN1bGF0ZSBlYWNoIG9yZGVyJ3MgZmVlIG9yIExSQyByZXdhcmQuCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSaW5nRmVlcygKICAgICAgICBUb2tlblRyYW5zZmVyRGVsZWdhdGUgZGVsZWdhdGUsCiAgICAgICAgdWludCAgICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIE9yZGVyU3RhdGVbXSAgICBvcmRlcnMsCiAgICAgICAgYWRkcmVzcyAgICAgICAgIGZlZVJlY2lwaWVudCwKICAgICAgICBhZGRyZXNzICAgICAgICAgX2xyY1Rva2VuQWRkcmVzcwogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgewogICAgICAgIGJvb2wgY2hlY2tlZE1pbmVyTHJjU3BlbmRhYmxlID0gZmFsc2U7CiAgICAgICAgdWludCBtaW5lckxyY1NwZW5kYWJsZSA9IDA7CiAgICAgICAgdWludDggX21hcmdpblNwbGl0UGVyY2VudGFnZUJhc2UgPSBNQVJHSU5fU1BMSVRfUEVSQ0VOVEFHRV9CQVNFOwogICAgICAgIHVpbnQgbmV4dEZpbGxBbW91bnRTOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgT3JkZXJTdGF0ZSBtZW1vcnkgc3RhdGUgPSBvcmRlcnNbaV07CiAgICAgICAgICAgIHVpbnQgbHJjUmVjZWlhYmxlID0gMDsKICAgICAgICAgICAgaWYgKHN0YXRlLmxyY0ZlZSA9PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBXaGVuIGFuIG9yZGVyJ3MgTFJDIGZlZSBpcyAwIG9yIHNtYWxsZXIgdGhhbiB0aGUgc3BlY2lmaWVkIGZlZSwKICAgICAgICAgICAgICAgIC8vIHdlIGhlbHAgbWluZXIgYXV0b21hdGljYWxseSBzZWxlY3QgbWFyZ2luLXNwbGl0LgogICAgICAgICAgICAgICAgc3RhdGUuZmVlU2VsZWN0aW9uID0gRkVFX1NFTEVDVF9NQVJHSU5fU1BMSVQ7CiAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5tYXJnaW5TcGxpdFBlcmNlbnRhZ2UgPSBfbWFyZ2luU3BsaXRQZXJjZW50YWdlQmFzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVpbnQgbHJjU3BlbmRhYmxlID0gZ2V0U3BlbmRhYmxlKAogICAgICAgICAgICAgICAgICAgIGRlbGVnYXRlLAogICAgICAgICAgICAgICAgICAgIF9scmNUb2tlbkFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIub3duZXIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgb3JkZXIgaXMgc2VsbGluZyBMUkMsIHdlIG5lZWQgdG8gY2FsY3VsYXRlIGhvdyBtdWNoIExSQwogICAgICAgICAgICAgICAgLy8gaXMgbGVmdCB0aGF0IGNhbiBiZSB1c2VkIGFzIGZlZS4KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5vcmRlci50b2tlblMgPT0gX2xyY1Rva2VuQWRkcmVzcykgewogICAgICAgICAgICAgICAgICAgIGxyY1NwZW5kYWJsZSAtPSBzdGF0ZS5maWxsQW1vdW50UzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIElmIHRoZSBvcmRlciBpcyBidXlpZ24gTFJDLCBpdCB3aWxsIGhhcyBtb3JlIHRvIHBheSBhcyBmZWUuCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUub3JkZXIudG9rZW5CID09IF9scmNUb2tlbkFkZHJlc3MpIHsKICAgICAgICAgICAgICAgICAgICBuZXh0RmlsbEFtb3VudFMgPSBvcmRlcnNbKGkgKyAxKSAlIHJpbmdTaXplXS5maWxsQW1vdW50UzsKICAgICAgICAgICAgICAgICAgICBscmNSZWNlaWFibGUgPSBuZXh0RmlsbEFtb3VudFM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1aW50IGxyY1RvdGFsID0gbHJjU3BlbmRhYmxlICsgbHJjUmVjZWlhYmxlOwogICAgICAgICAgICAgICAgLy8gSWYgb3JkZXIgZG9lc24ndCBoYXZlIGVub3VnaCBMUkMsIHNldCBtYXJnaW4gc3BsaXQgdG8gMTAwJS4KICAgICAgICAgICAgICAgIGlmIChscmNUb3RhbCA8IHN0YXRlLmxyY0ZlZSkgewogICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY0ZlZSA9IGxyY1RvdGFsOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZSA9IF9tYXJnaW5TcGxpdFBlcmNlbnRhZ2VCYXNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmxyY0ZlZSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmVlU2VsZWN0aW9uID0gRkVFX1NFTEVDVF9NQVJHSU5fU1BMSVQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmZlZVNlbGVjdGlvbiA9PSBGRUVfU0VMRUNUX0xSQykgewogICAgICAgICAgICAgICAgaWYgKGxyY1JlY2VpYWJsZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAobHJjUmVjZWlhYmxlID49IHN0YXRlLmxyY0ZlZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zcGxpdEIgPSBzdGF0ZS5scmNGZWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY0ZlZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3BsaXRCID0gbHJjUmVjZWlhYmxlOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5scmNGZWUgLT0gbHJjUmVjZWlhYmxlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5mZWVTZWxlY3Rpb24gPT0gRkVFX1NFTEVDVF9NQVJHSU5fU1BMSVQpIHsKICAgICAgICAgICAgICAgIC8vIE9ubHkgY2hlY2sgdGhlIGF2YWlsYWJsZSBtaW5lciBiYWxhbmNlIHdoZW4gYWJzb2x1dGVseSBuZWVkZWQKICAgICAgICAgICAgICAgIGlmICghY2hlY2tlZE1pbmVyTHJjU3BlbmRhYmxlICYmIG1pbmVyTHJjU3BlbmRhYmxlIDwgc3RhdGUubHJjRmVlKSB7CiAgICAgICAgICAgICAgICAgICAgY2hlY2tlZE1pbmVyTHJjU3BlbmRhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBtaW5lckxyY1NwZW5kYWJsZSA9IGdldFNwZW5kYWJsZShkZWxlZ2F0ZSwgX2xyY1Rva2VuQWRkcmVzcywgZmVlUmVjaXBpZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIE9ubHkgY2FsY3VsYXRlIHNwbGl0IHdoZW4gbWluZXIgaGFzIGVub3VnaCBMUkM7CiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgYWxsIHNwbGl0cyBhcmUgMC4KICAgICAgICAgICAgICAgIGlmIChtaW5lckxyY1NwZW5kYWJsZSA+PSBzdGF0ZS5scmNGZWUpIHsKICAgICAgICAgICAgICAgICAgICBuZXh0RmlsbEFtb3VudFMgPSBvcmRlcnNbKGkgKyAxKSAlIHJpbmdTaXplXS5maWxsQW1vdW50UzsKICAgICAgICAgICAgICAgICAgICB1aW50IHNwbGl0OwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5vcmRlci5idXlOb01vcmVUaGFuQW1vdW50QikgewogICAgICAgICAgICAgICAgICAgICAgICBzcGxpdCA9IChuZXh0RmlsbEFtb3VudFMubXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIuYW1vdW50UwogICAgICAgICAgICAgICAgICAgICAgICApIC8gc3RhdGUub3JkZXIuYW1vdW50Qikuc3ViKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzcGxpdCA9IG5leHRGaWxsQW1vdW50Uy5zdWIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50Uy5tdWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIuYW1vdW50QgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSAvIHN0YXRlLm9yZGVyLmFtb3VudFMKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZSAhPSBfbWFyZ2luU3BsaXRQZXJjZW50YWdlQmFzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzcGxpdCA9IHNwbGl0Lm11bCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZQogICAgICAgICAgICAgICAgICAgICAgICApIC8gX21hcmdpblNwbGl0UGVyY2VudGFnZUJhc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5vcmRlci5idXlOb01vcmVUaGFuQW1vdW50QikgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zcGxpdFMgPSBzcGxpdDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zcGxpdEIgPSBzcGxpdDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpbXBsaWNpdHMgb3JkZXIgd2l0aCBzbWFsbGVyIGluZGV4IGluIHRoZSByaW5nIHdpbGwKICAgICAgICAgICAgICAgICAgICAvLyBiZSBwYWlkIExSQyByZXdhcmQgZmlyc3QsIHNvIHRoZSBvcmRlcnMgaW4gdGhlIHJpbmcgZG9lcwogICAgICAgICAgICAgICAgICAgIC8vIG1hdGVyLgogICAgICAgICAgICAgICAgICAgIGlmIChzcGxpdCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWluZXJMcmNTcGVuZGFibGUgLT0gc3RhdGUubHJjRmVlOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5scmNSZXdhcmQgPSBzdGF0ZS5scmNGZWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOyAvLyAidW5zdXBwb3J0ZWQgZmVlIHNlbGVjdGlvbiB2YWx1ZSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIGVhY2ggb3JkZXIncyBmaWxsIGFtb3VudC4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJpbmdGaWxsQW1vdW50KAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgT3JkZXJTdGF0ZVtdICBvcmRlcnMKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUKICAgIHsKICAgICAgICB1aW50IHNtYWxsZXN0SWR4ID0gMDsKICAgICAgICB1aW50IGk7CiAgICAgICAgdWludCBqOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIGogPSAoaSArIDEpICUgcmluZ1NpemU7CiAgICAgICAgICAgIHNtYWxsZXN0SWR4ID0gY2FsY3VsYXRlT3JkZXJGaWxsQW1vdW50KAogICAgICAgICAgICAgICAgb3JkZXJzW2ldLAogICAgICAgICAgICAgICAgb3JkZXJzW2pdLAogICAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICAgIGosCiAgICAgICAgICAgICAgICBzbWFsbGVzdElkeAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc21hbGxlc3RJZHg7IGkrKykgewogICAgICAgICAgICBjYWxjdWxhdGVPcmRlckZpbGxBbW91bnQoCiAgICAgICAgICAgICAgICBvcmRlcnNbaV0sCiAgICAgICAgICAgICAgICBvcmRlcnNbKGkgKyAxKSAlIHJpbmdTaXplXSwKICAgICAgICAgICAgICAgIDAsICAgICAgICAgICAgICAgLy8gTm90IG5lZWRlZAogICAgICAgICAgICAgICAgMCwgICAgICAgICAgICAgICAvLyBOb3QgbmVlZGVkCiAgICAgICAgICAgICAgICAwICAgICAgICAgICAgICAgIC8vIE5vdCBuZWVkZWQKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQHJldHVybiBUaGUgc21hbGxlc3Qgb3JkZXIncyBpbmRleC4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZU9yZGVyRmlsbEFtb3VudCgKICAgICAgICBPcmRlclN0YXRlICAgICAgICBzdGF0ZSwKICAgICAgICBPcmRlclN0YXRlICAgICAgICBuZXh0LAogICAgICAgIHVpbnQgICAgICAgICAgICAgIGksCiAgICAgICAgdWludCAgICAgICAgICAgICAgaiwKICAgICAgICB1aW50ICAgICAgICAgICAgICBzbWFsbGVzdElkeAogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnQgbmV3U21hbGxlc3RJZHgpCiAgICB7CiAgICAgICAgLy8gRGVmYXVsdCB0byB0aGUgc2FtZSBzbWFsbGVzdCBpbmRleAogICAgICAgIG5ld1NtYWxsZXN0SWR4ID0gc21hbGxlc3RJZHg7CiAgICAgICAgdWludCBmaWxsQW1vdW50QiA9IHN0YXRlLmZpbGxBbW91bnRTLm11bCgKICAgICAgICAgICAgc3RhdGUucmF0ZS5hbW91bnRCCiAgICAgICAgKSAvIHN0YXRlLnJhdGUuYW1vdW50UzsKICAgICAgICBpZiAoc3RhdGUub3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgaWYgKGZpbGxBbW91bnRCID4gc3RhdGUub3JkZXIuYW1vdW50QikgewogICAgICAgICAgICAgICAgZmlsbEFtb3VudEIgPSBzdGF0ZS5vcmRlci5hbW91bnRCOwogICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMgPSBmaWxsQW1vdW50Qi5tdWwoCiAgICAgICAgICAgICAgICAgICAgc3RhdGUucmF0ZS5hbW91bnRTCiAgICAgICAgICAgICAgICApIC8gc3RhdGUucmF0ZS5hbW91bnRCOwogICAgICAgICAgICAgICAgbmV3U21hbGxlc3RJZHggPSBpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmxyY0ZlZSA9IHN0YXRlLm9yZGVyLmxyY0ZlZS5tdWwoCiAgICAgICAgICAgICAgICBmaWxsQW1vdW50QgogICAgICAgICAgICApIC8gc3RhdGUub3JkZXIuYW1vdW50QjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0ZS5scmNGZWUgPSBzdGF0ZS5vcmRlci5scmNGZWUubXVsKAogICAgICAgICAgICAgICAgc3RhdGUuZmlsbEFtb3VudFMKICAgICAgICAgICAgKSAvIHN0YXRlLm9yZGVyLmFtb3VudFM7CiAgICAgICAgfQogICAgICAgIGlmIChmaWxsQW1vdW50QiA8PSBuZXh0LmZpbGxBbW91bnRTKSB7CiAgICAgICAgICAgIG5leHQuZmlsbEFtb3VudFMgPSBmaWxsQW1vdW50QjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdTbWFsbGVzdElkeCA9IGo7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgU2NhbGUgZG93biBhbGwgb3JkZXJzIGJhc2VkIG9uIGhpc3RvcmljYWwgZmlsbCBvciBjYW5jZWxsYXRpb24KICAgIC8vLyAgICAgIHN0YXRzIGJ1dCBrZXkgdGhlIG9yZGVyJ3Mgb3JpZ2luYWwgZXhjaGFuZ2UgcmF0ZS4KICAgIGZ1bmN0aW9uIHNjYWxlUmluZ0Jhc2VkT25IaXN0b3JpY2FsUmVjb3JkcygKICAgICAgICBUb2tlblRyYW5zZmVyRGVsZWdhdGUgZGVsZWdhdGUsCiAgICAgICAgdWludCByaW5nU2l6ZSwKICAgICAgICBPcmRlclN0YXRlW10gb3JkZXJzCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICBPcmRlclN0YXRlIG1lbW9yeSBzdGF0ZSA9IG9yZGVyc1tpXTsKICAgICAgICAgICAgT3JkZXIgbWVtb3J5IG9yZGVyID0gc3RhdGUub3JkZXI7CiAgICAgICAgICAgIHVpbnQgYW1vdW50OwogICAgICAgICAgICBpZiAob3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgICAgIGFtb3VudCA9IG9yZGVyLmFtb3VudEIudG9sZXJhbnRTdWIoCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkT3JGaWxsZWRbc3RhdGUub3JkZXJIYXNoXQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudFMgPSBhbW91bnQubXVsKG9yZGVyLmFtb3VudFMpIC8gb3JkZXIuYW1vdW50QjsKICAgICAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSA9IGFtb3VudC5tdWwob3JkZXIubHJjRmVlKSAvIG9yZGVyLmFtb3VudEI7CiAgICAgICAgICAgICAgICBvcmRlci5hbW91bnRCID0gYW1vdW50OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYW1vdW50ID0gb3JkZXIuYW1vdW50Uy50b2xlcmFudFN1YigKICAgICAgICAgICAgICAgICAgICBjYW5jZWxsZWRPckZpbGxlZFtzdGF0ZS5vcmRlckhhc2hdCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50QiA9IGFtb3VudC5tdWwob3JkZXIuYW1vdW50QikgLyBvcmRlci5hbW91bnRTOwogICAgICAgICAgICAgICAgb3JkZXIubHJjRmVlID0gYW1vdW50Lm11bChvcmRlci5scmNGZWUpIC8gb3JkZXIuYW1vdW50UzsKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudFMgPSBhbW91bnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxdWlyZShvcmRlci5hbW91bnRTID4gMCk7IC8vICJhbW91bnRTIGlzIHplcm8iKTsKICAgICAgICAgICAgcmVxdWlyZShvcmRlci5hbW91bnRCID4gMCk7IC8vICJhbW91bnRCIGlzIHplcm8iKTsKICAgICAgICAgICAgdWludCBhdmFpbGFibGVBbW91bnRTID0gZ2V0U3BlbmRhYmxlKGRlbGVnYXRlLCBvcmRlci50b2tlblMsIG9yZGVyLm93bmVyKTsKICAgICAgICAgICAgcmVxdWlyZShhdmFpbGFibGVBbW91bnRTID4gMCk7IC8vICJvcmRlciBzcGVuZGFibGUgYW1vdW50UyBpcyB6ZXJvIik7CiAgICAgICAgICAgIHN0YXRlLmZpbGxBbW91bnRTID0gKAogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50UyA8IGF2YWlsYWJsZUFtb3VudFMgPwogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50UyA6IGF2YWlsYWJsZUFtb3VudFMKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgRVJDMjAgdG9rZW4gdGhhdCBjYW4gYmUgc3BlbnQgYnkgdGhpcyBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGdldFNwZW5kYWJsZSgKICAgICAgICBUb2tlblRyYW5zZmVyRGVsZWdhdGUgZGVsZWdhdGUsCiAgICAgICAgYWRkcmVzcyB0b2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyB0b2tlbk93bmVyCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICBFUkMyMCB0b2tlbiA9IEVSQzIwKHRva2VuQWRkcmVzcyk7CiAgICAgICAgdWludCBhbGxvd2FuY2UgPSB0b2tlbi5hbGxvd2FuY2UoCiAgICAgICAgICAgIHRva2VuT3duZXIsCiAgICAgICAgICAgIGFkZHJlc3MoZGVsZWdhdGUpCiAgICAgICAgKTsKICAgICAgICB1aW50IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodG9rZW5Pd25lcik7CiAgICAgICAgcmV0dXJuIChhbGxvd2FuY2UgPCBiYWxhbmNlID8gYWxsb3dhbmNlIDogYmFsYW5jZSk7CiAgICB9CiAgICAvLy8gQGRldiB2ZXJpZnkgaW5wdXQgZGF0YSdzIGJhc2ljIGludGVncml0eS4KICAgIGZ1bmN0aW9uIHZlcmlmeUlucHV0RGF0YUludGVncml0eSgKICAgICAgICB1aW50ICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIGFkZHJlc3NbMl1bXSAgYWRkcmVzc0xpc3QsCiAgICAgICAgdWludFs3XVtdICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgdWludDhbMl1bXSAgICB1aW50OEFyZ3NMaXN0LAogICAgICAgIGJvb2xbXSAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgIHVpbnQ4W10gICAgICAgdkxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICByTGlzdCwKICAgICAgICBieXRlczMyW10gICAgIHNMaXN0CiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICBwdXJlCiAgICB7CiAgICAgICAgcmVxdWlyZShyaW5nU2l6ZSA9PSBhZGRyZXNzTGlzdC5sZW5ndGgpOyAvLyAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIGFkZHJlc3NMaXN0Iik7CiAgICAgICAgcmVxdWlyZShyaW5nU2l6ZSA9PSB1aW50QXJnc0xpc3QubGVuZ3RoKTsgLy8gInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSB1aW50QXJnc0xpc3QiKTsKICAgICAgICByZXF1aXJlKHJpbmdTaXplID09IHVpbnQ4QXJnc0xpc3QubGVuZ3RoKTsgLy8gInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSB1aW50OEFyZ3NMaXN0Iik7CiAgICAgICAgcmVxdWlyZShyaW5nU2l6ZSA9PSBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QubGVuZ3RoKTsgLy8gInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QiKTsKICAgICAgICByZXF1aXJlKHJpbmdTaXplICsgMSA9PSB2TGlzdC5sZW5ndGgpOyAvLyAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHZMaXN0Iik7CiAgICAgICAgcmVxdWlyZShyaW5nU2l6ZSArIDEgPT0gckxpc3QubGVuZ3RoKTsgLy8gInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSByTGlzdCIpOwogICAgICAgIHJlcXVpcmUocmluZ1NpemUgKyAxID09IHNMaXN0Lmxlbmd0aCk7IC8vICJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gc0xpc3QiKTsKICAgICAgICAvLyBWYWxpZGF0ZSByaW5nLW1pbmluZyByZWxhdGVkIGFyZ3VtZW50cy4KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUodWludEFyZ3NMaXN0W2ldWzZdID4gMCk7IC8vICJvcmRlciByYXRlQW1vdW50UyBpcyB6ZXJvIik7CiAgICAgICAgICAgIHJlcXVpcmUodWludDhBcmdzTGlzdFtpXVsxXSA8PSBGRUVfU0VMRUNUX01BWF9WQUxVRSk7IC8vICJpbnZhbGlkIG9yZGVyIGZlZSBzZWxlY3Rpb24iKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQGRldiAgICAgICAgYXNzbWJsZSBvcmRlciBwYXJhbWV0ZXJzIGludG8gT3JkZXIgc3RydWN0LgogICAgLy8vIEByZXR1cm4gICAgIEEgbGlzdCBvZiBvcmRlcnMuCiAgICBmdW5jdGlvbiBhc3NlbWJsZU9yZGVycygKICAgICAgICBhZGRyZXNzWzJdW10gICAgYWRkcmVzc0xpc3QsCiAgICAgICAgdWludFs3XVtdICAgICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICB1aW50OFsyXVtdICAgICAgdWludDhBcmdzTGlzdCwKICAgICAgICBib29sW10gICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0LAogICAgICAgIHVpbnQ4W10gICAgICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgICAgIHNMaXN0CiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoT3JkZXJTdGF0ZVtdIG1lbW9yeSBvcmRlcnMpCiAgICB7CiAgICAgICAgdWludCByaW5nU2l6ZSA9IGFkZHJlc3NMaXN0Lmxlbmd0aDsKICAgICAgICBvcmRlcnMgPSBuZXcgT3JkZXJTdGF0ZVtdKHJpbmdTaXplKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHVpbnRbN10gbWVtb3J5IHVpbnRBcmdzID0gdWludEFyZ3NMaXN0W2ldOwogICAgICAgICAgICBPcmRlciBtZW1vcnkgb3JkZXIgPSBPcmRlcigKICAgICAgICAgICAgICAgIGFkZHJlc3NMaXN0W2ldWzBdLAogICAgICAgICAgICAgICAgYWRkcmVzc0xpc3RbaV1bMV0sCiAgICAgICAgICAgICAgICBhZGRyZXNzTGlzdFsoaSArIDEpICUgcmluZ1NpemVdWzFdLAogICAgICAgICAgICAgICAgdWludEFyZ3NbMF0sCiAgICAgICAgICAgICAgICB1aW50QXJnc1sxXSwKICAgICAgICAgICAgICAgIHVpbnRBcmdzWzVdLAogICAgICAgICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0W2ldLAogICAgICAgICAgICAgICAgdWludDhBcmdzTGlzdFtpXVswXQogICAgICAgICAgICApOwogICAgICAgICAgICBieXRlczMyIG9yZGVySGFzaCA9IGNhbGN1bGF0ZU9yZGVySGFzaCgKICAgICAgICAgICAgICAgIG9yZGVyLAogICAgICAgICAgICAgICAgdWludEFyZ3NbMl0sIC8vIHRpbWVzdGFtcAogICAgICAgICAgICAgICAgdWludEFyZ3NbM10sIC8vIHR0bAogICAgICAgICAgICAgICAgdWludEFyZ3NbNF0gIC8vIHNhbHQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKAogICAgICAgICAgICAgICAgb3JkZXIub3duZXIsCiAgICAgICAgICAgICAgICBvcmRlckhhc2gsCiAgICAgICAgICAgICAgICB2TGlzdFtpXSwKICAgICAgICAgICAgICAgIHJMaXN0W2ldLAogICAgICAgICAgICAgICAgc0xpc3RbaV0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgdmFsaWRhdGVPcmRlcigKICAgICAgICAgICAgICAgIG9yZGVyLAogICAgICAgICAgICAgICAgdWludEFyZ3NbMl0sIC8vIHRpbWVzdGFtcAogICAgICAgICAgICAgICAgdWludEFyZ3NbM10sIC8vIHR0bAogICAgICAgICAgICAgICAgdWludEFyZ3NbNF0gIC8vIHNhbHQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgb3JkZXJzW2ldID0gT3JkZXJTdGF0ZSgKICAgICAgICAgICAgICAgIG9yZGVyLAogICAgICAgICAgICAgICAgb3JkZXJIYXNoLAogICAgICAgICAgICAgICAgdWludDhBcmdzTGlzdFtpXVsxXSwgIC8vIGZlZVNlbGVjdGlvbgogICAgICAgICAgICAgICAgUmF0ZSh1aW50QXJnc1s2XSwgb3JkZXIuYW1vdW50QiksCiAgICAgICAgICAgICAgICAwLCAgIC8vIGZpbGxBbW91bnRTCiAgICAgICAgICAgICAgICAwLCAgIC8vIGxyY1Jld2FyZAogICAgICAgICAgICAgICAgMCwgICAvLyBscmNGZWUKICAgICAgICAgICAgICAgIDAsICAgLy8gc3BsaXRTCiAgICAgICAgICAgICAgICAwICAgIC8vIHNwbGl0QgogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KICAgIC8vLyBAZGV2IHZhbGlkYXRlIG9yZGVyJ3MgcGFyYW1ldGVycyBhcmUgT0suCiAgICBmdW5jdGlvbiB2YWxpZGF0ZU9yZGVyKAogICAgICAgIE9yZGVyICAgICAgICBvcmRlciwKICAgICAgICB1aW50ICAgICAgICAgdGltZXN0YW1wLAogICAgICAgIHVpbnQgICAgICAgICB0dGwsCiAgICAgICAgdWludCAgICAgICAgIHNhbHQKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgIHsKICAgICAgICByZXF1aXJlKG9yZGVyLm93bmVyICE9IDB4MCk7IC8vICJpbnZhbGlkIG9yZGVyIG93bmVyIik7CiAgICAgICAgcmVxdWlyZShvcmRlci50b2tlblMgIT0gMHgwKTsgLy8gImludmFsaWQgb3JkZXIgdG9rZW5TIik7CiAgICAgICAgcmVxdWlyZShvcmRlci50b2tlbkIgIT0gMHgwKTsgLy8gImludmFsaWQgb3JkZXIgdG9rZW5CIik7CiAgICAgICAgcmVxdWlyZShvcmRlci5hbW91bnRTICE9IDApOyAvLyAiaW52YWxpZCBvcmRlciBhbW91bnRTIik7CiAgICAgICAgcmVxdWlyZShvcmRlci5hbW91bnRCICE9IDApOyAvLyAiaW52YWxpZCBvcmRlciBhbW91bnRCIik7CiAgICAgICAgcmVxdWlyZSh0aW1lc3RhbXAgPD0gYmxvY2sudGltZXN0YW1wKTsgLy8gIm9yZGVyIGlzIHRvbyBlYXJseSB0byBtYXRjaCIpOwogICAgICAgIHJlcXVpcmUodGltZXN0YW1wID4gY3V0b2Zmc1tvcmRlci5vd25lcl0pOyAvLyAib3JkZXIgaXMgY3V0IG9mZiIpOwogICAgICAgIHJlcXVpcmUodHRsICE9IDApOyAvLyAib3JkZXIgdHRsIGlzIDAiKTsKICAgICAgICByZXF1aXJlKHRpbWVzdGFtcCArIHR0bCA+IGJsb2NrLnRpbWVzdGFtcCk7IC8vICJvcmRlciBpcyBleHBpcmVkIik7CiAgICAgICAgcmVxdWlyZShzYWx0ICE9IDApOyAvLyAiaW52YWxpZCBvcmRlciBzYWx0Iik7CiAgICAgICAgcmVxdWlyZShvcmRlci5tYXJnaW5TcGxpdFBlcmNlbnRhZ2UgPD0gTUFSR0lOX1NQTElUX1BFUkNFTlRBR0VfQkFTRSk7IC8vICJpbnZhbGlkIG9yZGVyIG1hcmdpblNwbGl0UGVyY2VudGFnZSIpOwogICAgfQogICAgLy8vIEBkZXYgR2V0IHRoZSBLZWNjYWstMjU2IGhhc2ggb2Ygb3JkZXIgd2l0aCBzcGVjaWZpZWQgcGFyYW1ldGVycy4KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZU9yZGVySGFzaCgKICAgICAgICBPcmRlciAgICAgICAgb3JkZXIsCiAgICAgICAgdWludCAgICAgICAgIHRpbWVzdGFtcCwKICAgICAgICB1aW50ICAgICAgICAgdHRsLAogICAgICAgIHVpbnQgICAgICAgICBzYWx0CiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikKICAgIHsKICAgICAgICByZXR1cm4ga2VjY2FrMjU2KAogICAgICAgICAgICBhZGRyZXNzKHRoaXMpLAogICAgICAgICAgICBvcmRlci5vd25lciwKICAgICAgICAgICAgb3JkZXIudG9rZW5TLAogICAgICAgICAgICBvcmRlci50b2tlbkIsCiAgICAgICAgICAgIG9yZGVyLmFtb3VudFMsCiAgICAgICAgICAgIG9yZGVyLmFtb3VudEIsCiAgICAgICAgICAgIHRpbWVzdGFtcCwKICAgICAgICAgICAgdHRsLAogICAgICAgICAgICBzYWx0LAogICAgICAgICAgICBvcmRlci5scmNGZWUsCiAgICAgICAgICAgIG9yZGVyLmJ1eU5vTW9yZVRoYW5BbW91bnRCLAogICAgICAgICAgICBvcmRlci5tYXJnaW5TcGxpdFBlcmNlbnRhZ2UKICAgICAgICApOwogICAgfQogICAgLy8vIEBkZXYgVmVyaWZ5IHNpZ25lcidzIHNpZ25hdHVyZS4KICAgIGZ1bmN0aW9uIHZlcmlmeVNpZ25hdHVyZSgKICAgICAgICBhZGRyZXNzIHNpZ25lciwKICAgICAgICBieXRlczMyIGhhc2gsCiAgICAgICAgdWludDggICB2LAogICAgICAgIGJ5dGVzMzIgciwKICAgICAgICBieXRlczMyIHMKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUKICAgIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBzaWduZXIgPT0gZWNyZWNvdmVyKAogICAgICAgICAgICAgICAga2VjY2FrMjU2KCJceDE5RXRoZXJldW0gU2lnbmVkIE1lc3NhZ2U6XG4zMiIsIGhhc2gpLAogICAgICAgICAgICAgICAgdiwKICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICBzCiAgICAgICAgICAgICkKICAgICAgICApOyAvLyAiaW52YWxpZCBzaWduYXR1cmUiKTsKICAgIH0KfQ=='.
	

]
