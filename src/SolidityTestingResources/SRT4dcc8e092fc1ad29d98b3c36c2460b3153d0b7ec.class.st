Class {
	#name : #SRT4dcc8e092fc1ad29d98b3c36c2460b3153d0b7ec,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4dcc8e092fc1ad29d98b3c36c2460b3153d0b7ec >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQovKiBUaGUgYXV0aGVudGljYXRpb24gbWFuYWdlciBkZXRhaWxzIHVzZXIgYWNjb3VudHMgdGhhdCBoYXZlIGFjY2VzcyB0byBjZXJ0YWluIHByaXZpbGVkZ2VzIGFuZCBrZWVwcyBhIHBlcm1hbmVudCBsZWRnZXIgb2Ygd2hvIGhhcyBhbmQgaGFzIGhhZCB0aGVzZSByaWdodHMuICovCmNvbnRyYWN0IEF1dGhlbnRpY2F0aW9uTWFuYWdlciB7CiAgICAvKiBNYXAgYWRkcmVzc2VzIHRvIGFkbWlucyAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhZG1pbkFkZHJlc3NlczsKCiAgICAvKiBNYXAgYWRkcmVzc2VzIHRvIGFjY291bnQgcmVhZGVycyAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhY2NvdW50UmVhZGVyQWRkcmVzc2VzOwoKICAgIC8qIERldGFpbHMgb2YgYWxsIGFkbWlucyB0aGF0IGhhdmUgZXZlciBleGlzdGVkICovCiAgICBhZGRyZXNzW10gYWRtaW5BdWRpdDsKCiAgICAvKiBEZXRhaWxzIG9mIGFsbCBhY2NvdW50IHJlYWRlcnMgdGhhdCBoYXZlIGV2ZXIgZXhpc3RlZCAqLwogICAgYWRkcmVzc1tdIGFjY291bnRSZWFkZXJBdWRpdDsKCiAgICAvKiBGaXJlZCB3aGVuZXZlciBhbiBhZG1pbiBpcyBhZGRlZCB0byB0aGUgY29udHJhY3QuICovCiAgICBldmVudCBBZG1pbkFkZGVkKGFkZHJlc3MgYWRkZWRCeSwgYWRkcmVzcyBhZG1pbik7CgogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWRtaW4gaXMgcmVtb3ZlZCBmcm9tIHRoZSBjb250cmFjdC4gKi8KICAgIGV2ZW50IEFkbWluUmVtb3ZlZChhZGRyZXNzIHJlbW92ZWRCeSwgYWRkcmVzcyBhZG1pbik7CgogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWNjb3VudC1yZWFkZXIgY29udHJhY3QgaXMgYWRkZWQuICovCiAgICBldmVudCBBY2NvdW50UmVhZGVyQWRkZWQoYWRkcmVzcyBhZGRlZEJ5LCBhZGRyZXNzIGFjY291bnQpOwoKICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFjY291bnQtcmVhZGVyIGNvbnRyYWN0IGlzIHJlbW92ZWQuICovCiAgICBldmVudCBBY2NvdW50UmVhZGVyUmVtb3ZlZChhZGRyZXNzIHJlbW92ZWRCeSwgYWRkcmVzcyBhY2NvdW50KTsKCiAgICAvKiBXaGVuIHRoaXMgY29udHJhY3QgaXMgZmlyc3Qgc2V0dXAgd2UgdXNlIHRoZSBjcmVhdG9yIGFzIHRoZSBmaXJzdCBhZG1pbiAqLyAgICAKICAgIGZ1bmN0aW9uIEF1dGhlbnRpY2F0aW9uTWFuYWdlcigpIHsKICAgICAgICAvKiBTZXQgdGhlIGZpcnN0IGFkbWluIHRvIGJlIHRoZSBwZXJzb24gY3JlYXRpbmcgdGhlIGNvbnRyYWN0ICovCiAgICAgICAgYWRtaW5BZGRyZXNzZXNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIEFkbWluQWRkZWQoMCwgbXNnLnNlbmRlcik7CiAgICAgICAgYWRtaW5BdWRpdC5sZW5ndGgrKzsKICAgICAgICBhZG1pbkF1ZGl0W2FkbWluQXVkaXQubGVuZ3RoIC0gMV0gPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qIEdldHMgdGhlIGNvbnRyYWN0IHZlcnNpb24gZm9yIHZhbGlkYXRpb24gKi8KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIC8vIEFkbWluIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgMTAwWVlZWU1NRERISE1NCiAgICAgICAgcmV0dXJuIDEwMDIwMTcwNzE3MTUwMzsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBjdXJyZW50bHkgYW4gYWRtaW4gKi8KICAgIGZ1bmN0aW9uIGlzQ3VycmVudEFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdOwogICAgfQoKICAgIC8qIEdldHMgd2hldGhlciBvciBub3QgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBldmVyIGJlZW4gYW4gYWRtaW4gKi8KICAgIGZ1bmN0aW9uIGlzQ3VycmVudE9yUGFzdEFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBhZG1pbkF1ZGl0Lmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoYWRtaW5BdWRpdFtpXSA9PSBfYWRkcmVzcykKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBjdXJyZW50bHkgYW4gYWNjb3VudCByZWFkZXIgKi8KICAgIGZ1bmN0aW9uIGlzQ3VycmVudEFjY291bnRSZWFkZXIoYWRkcmVzcyBfYWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXTsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBoYXMgZXZlciBiZWVuIGFuIGFkbWluICovCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRPclBhc3RBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBhY2NvdW50UmVhZGVyQXVkaXQubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChhY2NvdW50UmVhZGVyQXVkaXRbaV0gPT0gX2FkZHJlc3MpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyogQWRkcyBhIHVzZXIgdG8gb3VyIGxpc3Qgb2YgYWRtaW5zICovCiAgICBmdW5jdGlvbiBhZGRBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgYWRtaW4KICAgICAgICBpZiAoYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdKQogICAgICAgICAgICB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBBZGQgdGhlIHVzZXIKICAgICAgICBhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc10gPSB0cnVlOwogICAgICAgIEFkbWluQWRkZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOwogICAgICAgIGFkbWluQXVkaXQubGVuZ3RoKys7CiAgICAgICAgYWRtaW5BdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gX2FkZHJlc3M7CiAgICB9CgogICAgLyogUmVtb3ZlcyBhIHVzZXIgZnJvbSBvdXIgbGlzdCBvZiBhZG1pbnMgYnV0IGtlZXBzIHRoZW0gaW4gdGhlIGhpc3RvcnkgYXVkaXQgKi8KICAgIGZ1bmN0aW9uIHJlbW92ZUFkbWluKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogRG9uJ3QgYWxsb3cgcmVtb3ZhbCBvZiBzZWxmICovCiAgICAgICAgaWYgKF9hZGRyZXNzID09IG1zZy5zZW5kZXIpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvLyBGYWlsIGlmIHRoaXMgYWNjb3VudCBpcyBhbHJlYWR5IG5vbi1hZG1pbgogICAgICAgIGlmICghYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogUmVtb3ZlIHRoaXMgYWRtaW4gdXNlciAqLwogICAgICAgIGFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSA9IGZhbHNlOwogICAgICAgIEFkbWluUmVtb3ZlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7CiAgICB9CgogICAgLyogQWRkcyBhIHVzZXIvY29udHJhY3QgdG8gb3VyIGxpc3Qgb2YgYWNjb3VudCByZWFkZXJzICovCiAgICBmdW5jdGlvbiBhZGRBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBpbiB0aGUgbGlzdAogICAgICAgIGlmIChhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIHRoZSB1c2VyCiAgICAgICAgYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc10gPSB0cnVlOwogICAgICAgIEFjY291bnRSZWFkZXJBZGRlZChtc2cuc2VuZGVyLCBfYWRkcmVzcyk7CiAgICAgICAgYWNjb3VudFJlYWRlckF1ZGl0Lmxlbmd0aCsrOwogICAgICAgIGFjY291bnRSZWFkZXJBdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gX2FkZHJlc3M7CiAgICB9CgogICAgLyogUmVtb3ZlcyBhIHVzZXIvY29udHJhY3RzIGZyb20gb3VyIGxpc3Qgb2YgYWNjb3VudCByZWFkZXJzIGJ1dCBrZWVwcyB0aGVtIGluIHRoZSBoaXN0b3J5IGF1ZGl0ICovCiAgICBmdW5jdGlvbiByZW1vdmVBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICAvKiBFbnN1cmUgd2UncmUgYW4gYWRtaW4gKi8KICAgICAgICBpZiAoIWlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBub3QgaW4gdGhlIGxpc3QKICAgICAgICBpZiAoIWFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogUmVtb3ZlIHRoaXMgYWRtaW4gdXNlciAqLwogICAgICAgIGFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdID0gZmFsc2U7CiAgICAgICAgQWNjb3VudFJlYWRlclJlbW92ZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOwogICAgfQp9Cgpjb250cmFjdCBJY29QaGFzZU1hbmFnZW1lbnQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAKICAgIC8qIERlZmluZXMgd2hldGhlciBvciBub3Qgd2UgYXJlIGluIHRoZSBJQ08gcGhhc2UgKi8KICAgIGJvb2wgcHVibGljIGljb1BoYXNlID0gdHJ1ZTsKCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHRoZSBJQ08gaGFzIGJlZW4gYWJhbmRvbmVkICovCiAgICBib29sIHB1YmxpYyBpY29BYmFuZG9uZWQgPSBmYWxzZTsKCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHRoZSBTSUZUIGNvbnRyYWN0IGFkZHJlc3MgaGFzIHlldCBiZWVuIHNldC4gICovCiAgICBib29sIHNpZnRDb250cmFjdERlZmluZWQgPSBmYWxzZTsKICAgIAogICAgLyogRGVmaW5lcyB0aGUgc2FsZSBwcmljZSBkdXJpbmcgSUNPICovCiAgICB1aW50MjU2IGNvbnN0YW50IGljb1VuaXRQcmljZSA9IDEwIGZpbm5leTsKCiAgICAvKiBJZiBhbiBJQ08gaXMgYWJhbmRvbmVkIGFuZCBzb21lIHdpdGhkcmF3YWxzIGZhaWwgdGhlbiB0aGlzIG1hcCBhbGxvd3MgcGVvcGxlIHRvIHJlcXVlc3Qgd2l0aGRyYXdhbCBvZiBsb2NrZWQtaW4gZXRoZXIuICovCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFiYW5kb25lZEljb0JhbGFuY2VzOwoKICAgIC8qIERlZmluZXMgb3VyIGludGVyZmFjZSB0byB0aGUgU0lGVCBjb250cmFjdC4gKi8KICAgIFNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbiBzbWFydEludmVzdG1lbnRGdW5kVG9rZW47CgogICAgLyogRGVmaW5lcyB0aGUgYWRtaW4gY29udHJhY3Qgd2UgaW50ZXJmYWNlIHdpdGggZm9yIGNyZWRlbnRhaWxzLiAqLwogICAgQXV0aGVudGljYXRpb25NYW5hZ2VyIGF1dGhlbnRpY2F0aW9uTWFuYWdlcjsKCiAgICAvKiBEZWZpbmVzIHRoZSB0aW1lIHRoYXQgdGhlIElDTyBzdGFydHMuICovCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBpY29TdGFydFRpbWUgPSAxNTAxNTQ1NjAwOyAvLyBBdWd1c3QgMXN0IDIwMTcgYXQgMDA6MDA6MDAgVVRDCgogICAgLyogRGVmaW5lcyB0aGUgdGltZSB0aGF0IHRoZSBJQ08gZW5kcy4gKi8KICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIGljb0VuZFRpbWUgPSAxNTA1NDMzNjAwOyAvLyBTZXB0ZW1iZXIgMTV0aCAyMDE3IGF0IDAwOjAwOjAwIFVUQwoKICAgIC8qIERlZmluZXMgb3VyIGV2ZW50IGZpcmVkIHdoZW4gdGhlIElDTyBpcyBjbG9zZWQgKi8KICAgIGV2ZW50IEljb0Nsb3NlZCgpOwoKICAgIC8qIERlZmluZXMgb3VyIGV2ZW50IGZpcmVkIGlmIHRoZSBJQ08gaXMgYWJhbmRvbmVkICovCiAgICBldmVudCBJY29BYmFuZG9uZWQoc3RyaW5nIGRldGFpbHMpOwogICAgCiAgICAvKiBFbnN1cmVzIHRoYXQgb25jZSB0aGUgSUNPIGlzIG92ZXIgdGhpcyBjb250cmFjdCBjYW5ub3QgYmUgdXNlZCB1bnRpbCB0aGUgcG9pbnQgaXQgaXMgZGVzdHJ1Y3RlZC4gKi8KICAgIG1vZGlmaWVyIG9ubHlEdXJpbmdJY28gewogICAgICAgIGJvb2wgY29udHJhY3RWYWxpZCA9IHNpZnRDb250cmFjdERlZmluZWQgJiYgIXNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5pc0Nsb3NlZCgpOwogICAgICAgIGlmICghY29udHJhY3RWYWxpZCB8fCAoIWljb1BoYXNlICYmICFpY29BYmFuZG9uZWQpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8qIFRoaXMgbW9kaWZpZXIgYWxsb3dzIGEgbWV0aG9kIHRvIG9ubHkgYmUgY2FsbGVkIGJ5IGN1cnJlbnQgYWRtaW5zICovCiAgICBtb2RpZmllciBhZG1pbk9ubHkgewogICAgICAgIGlmICghYXV0aGVudGljYXRpb25NYW5hZ2VyLmlzQ3VycmVudEFkbWluKG1zZy5zZW5kZXIpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIC8qIENyZWF0ZSB0aGUgSUNPIHBoYXNlIG1hbmFnZXJtZW50IGFuZCBkZWZpbmUgdGhlIGFkZHJlc3Mgb2YgdGhlIG1haW4gU0lGVCBjb250cmFjdC4gKi8KICAgIGZ1bmN0aW9uIEljb1BoYXNlTWFuYWdlbWVudChhZGRyZXNzIF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKSB7CiAgICAgICAgLyogQSBiYXNpYyBzYW5pdHkgY2hlY2sgKi8KICAgICAgICBpZiAoaWNvU3RhcnRUaW1lID49IGljb0VuZFRpbWUpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvKiBTZXR1cCBhY2Nlc3MgdG8gb3VyIG90aGVyIGNvbnRyYWN0cyBhbmQgdmFsaWRhdGUgdGhlaXIgdmVyc2lvbnMgKi8KICAgICAgICBhdXRoZW50aWNhdGlvbk1hbmFnZXIgPSBBdXRoZW50aWNhdGlvbk1hbmFnZXIoX2F1dGhlbnRpY2F0aW9uTWFuYWdlckFkZHJlc3MpOwogICAgICAgIGlmIChhdXRoZW50aWNhdGlvbk1hbmFnZXIuY29udHJhY3RWZXJzaW9uKCkgIT0gMTAwMjAxNzA3MTcxNTAzKQogICAgICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvKiBTZXQgdGhlIFNJRlQgY29udHJhY3QgYWRkcmVzcyBhcyBhIG9uZS10aW1lIG9wZXJhdGlvbi4gIFRoaXMgaGFwcGVucyBhZnRlciBhbGwgdGhlIGNvbnRyYWN0cyBhcmUgY3JlYXRlZCBhbmQgbm8KICAgICAgIG90aGVyIGZ1bmN0aW9uYWxpdHkgY2FuIGJlIHVzZWQgdW50aWwgdGhpcyBpcyBzZXQuICovCiAgICBmdW5jdGlvbiBzZXRTaWZ0Q29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX3NpZnRDb250cmFjdEFkZHJlc3MpIGFkbWluT25seSB7CiAgICAgICAgLyogVGhpcyBjYW4gb25seSBoYXBwZW4gb25jZSBpbiB0aGUgbGlmZXRpbWUgb2YgdGhpcyBjb250cmFjdCAqLwogICAgICAgIGlmIChzaWZ0Q29udHJhY3REZWZpbmVkKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovCiAgICAgICAgc21hcnRJbnZlc3RtZW50RnVuZFRva2VuID0gU21hcnRJbnZlc3RtZW50RnVuZFRva2VuKF9zaWZ0Q29udHJhY3RBZGRyZXNzKTsKICAgICAgICBpZiAoc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLmNvbnRyYWN0VmVyc2lvbigpICE9IDUwMDIwMTcwNzE3MTQ0MCkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgc2lmdENvbnRyYWN0RGVmaW5lZCA9IHRydWU7CiAgICB9CgogICAgLyogR2V0cyB0aGUgY29udHJhY3QgdmVyc2lvbiBmb3IgdmFsaWRhdGlvbiAqLwogICAgZnVuY3Rpb24gY29udHJhY3RWZXJzaW9uKCkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgLyogSUNPIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgMzAwWVlZWU1NRERISE1NICovCiAgICAgICAgcmV0dXJuIDMwMDIwMTcwNzE3MTQ0MDsKICAgIH0KCiAgICAvKiBDbG9zZSB0aGUgSUNPIHBoYXNlIGFuZCB0cmFuc2l0aW9uIHRvIGV4ZWN1dGlvbiBwaGFzZSAqLwogICAgZnVuY3Rpb24gY2xvc2UoKSBhZG1pbk9ubHkgb25seUR1cmluZ0ljbyB7CiAgICAgICAgLy8gRm9yYmlkIGNsb3NpbmcgY29udHJhY3QgYmVmb3JlIHRoZSBlbmQgb2YgSUNPCiAgICAgICAgaWYgKG5vdyA8PSBpY29FbmRUaW1lKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gQ2xvc2UgdGhlIElDTwogICAgICAgIGljb1BoYXNlID0gZmFsc2U7CiAgICAgICAgSWNvQ2xvc2VkKCk7CgogICAgICAgIC8vIFdpdGhkcmF3IGZ1bmRzIHRvIHRoZSBjYWxsZXIKICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh0aGlzLmJhbGFuY2UpKQogICAgICAgICAgICB0aHJvdzsKICAgIH0KICAgIAogICAgLyogSGFuZGxlIHJlY2VpdmluZyBldGhlciBpbiBJQ08gcGhhc2UgLSB3ZSB3b3JrIG91dCBob3cgbXVjaCB0aGUgdXNlciBoYXMgYm91Z2h0LCBhbGxvY2F0ZSBhIHN1aXRhYmxlIGJhbGFuY2UgYW5kIHNlbmQgdGhlaXIgY2hhbmdlICovCiAgICBmdW5jdGlvbiAoKSBvbmx5RHVyaW5nSWNvIHBheWFibGUgewogICAgICAgIC8vIEZvcmJpZCBmdW5kaW5nIG91dHNpZGUgb2YgSUNPCiAgICAgICAgaWYgKG5vdyA8IGljb1N0YXJ0VGltZSB8fCBub3cgPiBpY29FbmRUaW1lKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogRGV0ZXJtaW5lIGhvdyBtdWNoIHRoZXkndmUgYWN0dWFsbHkgcHVyaGNhc2VkIGFuZCBhbnkgZXRoZXIgY2hhbmdlICovCiAgICAgICAgdWludDI1NiB0b2tlbnNQdXJjaGFzZWQgPSBtc2cudmFsdWUgLyBpY29Vbml0UHJpY2U7CiAgICAgICAgdWludDI1NiBwdXJjaGFzZVRvdGFsUHJpY2UgPSB0b2tlbnNQdXJjaGFzZWQgKiBpY29Vbml0UHJpY2U7CiAgICAgICAgdWludDI1NiBjaGFuZ2UgPSBtc2cudmFsdWUuc3ViKHB1cmNoYXNlVG90YWxQcmljZSk7CgogICAgICAgIC8qIEluY3JlYXNlIHRoZWlyIG5ldyBiYWxhbmNlIGlmIHRoZXkgYWN0dWFsbHkgcHVyY2hhc2VkIGFueSAqLwogICAgICAgIGlmICh0b2tlbnNQdXJjaGFzZWQgPiAwKQogICAgICAgICAgICBzbWFydEludmVzdG1lbnRGdW5kVG9rZW4ubWludFRva2Vucyhtc2cuc2VuZGVyLCB0b2tlbnNQdXJjaGFzZWQpOwoKICAgICAgICAvKiBTZW5kIGNoYW5nZSBiYWNrIHRvIHJlY2lwaWVudCAqLwogICAgICAgIGlmIChjaGFuZ2UgPiAwICYmICFtc2cuc2VuZGVyLnNlbmQoY2hhbmdlKSkKICAgICAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLyogQWJhbmRvbnMgdGhlIElDTyBhbmQgcmV0dXJucyBmdW5kcyB0byBzaGFyZWhvbGRlcnMuICBBbnkgZmFpbGVkIGZ1bmRzIGNhbiBiZSBzZXBhcmF0ZWx5IHdpdGhkcmF3biBvbmNlIHRoZSBJQ08gaXMgYWJhbmRvbmVkLiAqLwogICAgZnVuY3Rpb24gYWJhbmRvbihzdHJpbmcgZGV0YWlscykgYWRtaW5Pbmx5IG9ubHlEdXJpbmdJY28gewogICAgICAgIC8vIEZvcmJpZCBjbG9zaW5nIGNvbnRyYWN0IGJlZm9yZSB0aGUgZW5kIG9mIElDTwogICAgICAgIGlmIChub3cgPD0gaWNvRW5kVGltZSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIElmIGFscmVhZHkgYWJhbmRvbmVkIHRocm93IGFuIGVycm9yICovCiAgICAgICAgaWYgKGljb0FiYW5kb25lZCkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFdvcmsgb3V0IGEgcmVmdW5kIHBlciBzaGFyZSBwZXIgc2hhcmUgKi8KICAgICAgICB1aW50MjU2IHBheW1lbnRQZXJTaGFyZSA9IHRoaXMuYmFsYW5jZSAvIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi50b3RhbFN1cHBseSgpOwoKICAgICAgICAvKiBFbnVtIGFsbCBhY2NvdW50cyBhbmQgc2VuZCB0aGVtIHJlZnVuZCAqLwogICAgICAgIHVpbnQgbnVtYmVyVG9rZW5Ib2xkZXJzID0gc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLnRva2VuSG9sZGVyQ291bnQoKTsKICAgICAgICB1aW50MjU2IHRvdGFsQWJhbmRvbmVkID0gMDsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBudW1iZXJUb2tlbkhvbGRlcnM7IGkrKykgewogICAgICAgICAgICAvKiBDYWxjdWxhdGUgaG93IG11Y2ggZ29lcyB0byB0aGlzIHNoYXJlaG9sZGVyICovCiAgICAgICAgICAgIGFkZHJlc3MgYWRkciA9IHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi50b2tlbkhvbGRlcihpKTsKICAgICAgICAgICAgdWludDI1NiBldGhlclRvU2VuZCA9IHBheW1lbnRQZXJTaGFyZSAqIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5iYWxhbmNlT2YoYWRkcik7CiAgICAgICAgICAgIGlmIChldGhlclRvU2VuZCA8IDEpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIC8qIEFsbG9jYXRlIGFwcHJvcHJpYXRlIGFtb3VudCBvZiBmdW5kIHRvIHRoZW0gKi8KICAgICAgICAgICAgYWJhbmRvbmVkSWNvQmFsYW5jZXNbYWRkcl0gPSBhYmFuZG9uZWRJY29CYWxhbmNlc1thZGRyXS5hZGQoZXRoZXJUb1NlbmQpOwogICAgICAgICAgICB0b3RhbEFiYW5kb25lZCA9IHRvdGFsQWJhbmRvbmVkLmFkZChldGhlclRvU2VuZCk7CiAgICAgICAgfQoKICAgICAgICAvKiBBdWRpdCB0aGUgYWJhbmRvbm1lbnQgKi8KICAgICAgICBpY29BYmFuZG9uZWQgPSB0cnVlOwogICAgICAgIEljb0FiYW5kb25lZChkZXRhaWxzKTsKCiAgICAgICAgLy8gVGhlcmUgc2hvdWxkIGJlIG5vIG1vbmV5IGxlZnQsIGJ1dCB3aXRoZHJhdyBqdXN0IGluY2FzZSBmb3IgbWFudWFsIHJlc29sdXRpb24KICAgICAgICB1aW50MjU2IHJlbWFpbmRlciA9IHRoaXMuYmFsYW5jZS5zdWIodG90YWxBYmFuZG9uZWQpOwogICAgICAgIGlmIChyZW1haW5kZXIgPiAwKQogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChyZW1haW5kZXIpKQogICAgICAgICAgICAgICAgLy8gQWRkIHRoaXMgdG8gdGhlIGNhbGxlcnMgYmFsYW5jZSBmb3IgZW1lcmdlbmN5IHJlZnVuZHMKICAgICAgICAgICAgICAgIGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID0gYWJhbmRvbmVkSWNvQmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKHJlbWFpbmRlcik7CiAgICB9CgogICAgLyogQWxsb3dzIHBlb3BsZSB0byB3aXRoZHJhdyBmdW5kcyB0aGF0IGZhaWxlZCB0byBzZW5kIGR1cmluZyB0aGUgYWJhbmRvbm1lbnQgb2YgdGhlIElDTyBmb3IgYW55IHJlYXNvbi4gKi8KICAgIGZ1bmN0aW9uIGFiYW5kb25lZEZ1bmRXaXRoZHJhd2FsKCkgewogICAgICAgIC8vIFRoaXMgZnVuY3Rpb25hbGl0eSBvbmx5IGV4aXN0cyBpZiBhbiBJQ08gd2FzIGFiYW5kb25lZAogICAgICAgIGlmICghaWNvQWJhbmRvbmVkIHx8IGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID09IDApCiAgICAgICAgICAgIHRocm93OwogICAgICAgIAogICAgICAgIC8vIEF0dGVtcHQgdG8gc2VuZCB0aGVtIHRvIGZ1bmRzCiAgICAgICAgdWludDI1NiBmdW5kcyA9IGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdID0gMDsKICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChmdW5kcykpCiAgICAgICAgICAgIHRocm93OwogICAgfQp9CgovKiBUaGUgU0lGVCBpdHNlbGYgaXMgYSBzaW1wbGUgZXh0ZW5zaW9uIG9mIHRoZSBFUkMyMCB0aGF0IGFsbG93cyBmb3IgZ3JhbnRpbmcgb3RoZXIgU0lGVCBjb250cmFjdHMgc3BlY2lhbCByaWdodHMgdG8gYWN0IG9uIGJlaGFsZiBvZiBhbGwgdHJhbnNmZXJzLiAqLwpjb250cmFjdCBTbWFydEludmVzdG1lbnRGdW5kVG9rZW4gewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLyogTWFwIGFsbCBvdXIgb3VyIGJhbGFuY2VzIGZvciBpc3N1ZWQgdG9rZW5zICovCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAgIC8qIE1hcCBiZXR3ZWVuIHVzZXJzIGFuZCB0aGVpciBhcHByb3ZhbCBhZGRyZXNzZXMgYW5kIGFtb3VudHMgKi8KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8qIExpc3Qgb2YgYWxsIHRva2VuIGhvbGRlcnMgKi8KICAgIGFkZHJlc3NbXSBhbGxUb2tlbkhvbGRlcnM7CgogICAgLyogVGhlIG5hbWUgb2YgdGhlIGNvbnRyYWN0ICovCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CgogICAgLyogVGhlIHN5bWJvbCBmb3IgdGhlIGNvbnRyYWN0ICovCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKCiAgICAvKiBIb3cgbWFueSBEUHMgYXJlIGluIHVzZSBpbiB0aGlzIGNvbnRyYWN0ICovCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CgogICAgLyogRGVmaW5lcyB0aGUgY3VycmVudCBzdXBwbHkgb2YgdGhlIHRva2VuIGluIGl0cyBvd24gdW5pdHMgKi8KICAgIHVpbnQyNTYgdG90YWxTdXBwbHlBbW91bnQgPSAwOwoKICAgIC8qIERlZmluZXMgdGhlIGFkZHJlc3Mgb2YgdGhlIElDTyBjb250cmFjdCB3aGljaCBpcyB0aGUgb25seSBjb250cmFjdCBwZXJtaXR0ZWQgdG8gbWludCB0b2tlbnMuICovCiAgICBhZGRyZXNzIHB1YmxpYyBpY29Db250cmFjdEFkZHJlc3M7CgogICAgLyogRGVmaW5lcyB3aGV0aGVyIG9yIG5vdCB0aGUgZnVuZCBpcyBjbG9zZWQuICovCiAgICBib29sIHB1YmxpYyBpc0Nsb3NlZDsKCiAgICAvKiBEZWZpbmVzIHRoZSBjb250cmFjdCBoYW5kbGluZyB0aGUgSUNPIHBoYXNlLiAqLwogICAgSWNvUGhhc2VNYW5hZ2VtZW50IGljb1BoYXNlTWFuYWdlbWVudDsKCiAgICAvKiBEZWZpbmVzIHRoZSBhZG1pbiBjb250cmFjdCB3ZSBpbnRlcmZhY2Ugd2l0aCBmb3IgY3JlZGVudGFpbHMuICovCiAgICBBdXRoZW50aWNhdGlvbk1hbmFnZXIgYXV0aGVudGljYXRpb25NYW5hZ2VyOwoKICAgIC8qIEZpcmVkIHdoZW4gdGhlIGZ1bmQgaXMgZXZlbnR1YWxseSBjbG9zZWQuICovCiAgICBldmVudCBGdW5kQ2xvc2VkKCk7CiAgICAKICAgIC8qIE91ciB0cmFuc2ZlciBldmVudCB0byBmaXJlIHdoZW5ldmVyIHdlIHNoaWZ0IFNNUlQgYXJvdW5kICovCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIAogICAgLyogT3VyIGFwcHJvdmFsIGV2ZW50IHdoZW4gb25lIHVzZXIgYXBwcm92ZXMgYW5vdGhlciB0byBjb250cm9sICovCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICAvKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhpcyBmdW5kIHdpdGggbGlua3MgdG8gb3RoZXIgY29udHJhY3RzIHRoYXQgYXJlIHJlcXVpcmVkLiAqLwogICAgZnVuY3Rpb24gU21hcnRJbnZlc3RtZW50RnVuZFRva2VuKGFkZHJlc3MgX2ljb0NvbnRyYWN0QWRkcmVzcywgYWRkcmVzcyBfYXV0aGVudGljYXRpb25NYW5hZ2VyQWRkcmVzcykgewogICAgICAgIC8vIFNldHVwIGRlZmF1bHRzCiAgICAgICAgbmFtZSA9ICJTbWFydCBJbnZlc3RtZW50IEZ1bmQgVG9rZW4iOwogICAgICAgIHN5bWJvbCA9ICJTSUZUIjsKICAgICAgICBkZWNpbWFscyA9IDA7CgogICAgICAgIC8qIFNldHVwIGFjY2VzcyB0byBvdXIgb3RoZXIgY29udHJhY3RzIGFuZCB2YWxpZGF0ZSB0aGVpciB2ZXJzaW9ucyAqLwogICAgICAgIGljb1BoYXNlTWFuYWdlbWVudCA9IEljb1BoYXNlTWFuYWdlbWVudChfaWNvQ29udHJhY3RBZGRyZXNzKTsKICAgICAgICBpZiAoaWNvUGhhc2VNYW5hZ2VtZW50LmNvbnRyYWN0VmVyc2lvbigpICE9IDMwMDIwMTcwNzE3MTQ0MCkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgYXV0aGVudGljYXRpb25NYW5hZ2VyID0gQXV0aGVudGljYXRpb25NYW5hZ2VyKF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKTsKICAgICAgICBpZiAoYXV0aGVudGljYXRpb25NYW5hZ2VyLmNvbnRyYWN0VmVyc2lvbigpICE9IDEwMDIwMTcwNzE3MTUwMykKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLyogU3RvcmUgb3VyIHNwZWNpYWwgYWRkcmVzc2VzICovCiAgICAgICAgaWNvQ29udHJhY3RBZGRyZXNzID0gX2ljb0NvbnRyYWN0QWRkcmVzczsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBudW13b3JkcykgewogICAgICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPT0gbnVtd29yZHMgKiAzMiArIDQpOwogICAgICAgIF87CiAgICB9IAoKICAgIC8qIFRoaXMgbW9kaWZpZXIgYWxsb3dzIGEgbWV0aG9kIHRvIG9ubHkgYmUgY2FsbGVkIGJ5IGFjY291bnQgcmVhZGVycyAqLwogICAgbW9kaWZpZXIgYWNjb3VudFJlYWRlck9ubHkgewogICAgICAgIGlmICghYXV0aGVudGljYXRpb25NYW5hZ2VyLmlzQ3VycmVudEFjY291bnRSZWFkZXIobXNnLnNlbmRlcikpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgZnVuZFNlbmRhYmxlUGhhc2UgewogICAgICAgIC8vIElmIGl0J3MgaW4gSUNPIHBoYXNlLCBmb3JiaWQgaXQKICAgICAgICBpZiAoaWNvUGhhc2VNYW5hZ2VtZW50Lmljb1BoYXNlKCkpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvLyBJZiBpdCdzIGFiYW5kb25lZCwgZm9yYmlkIGl0CiAgICAgICAgaWYgKGljb1BoYXNlTWFuYWdlbWVudC5pY29BYmFuZG9uZWQoKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIFdlJ3JlIGdvb2QsIGZ1bmRzIGNhbiBub3cgYmUgdHJhbnNmZXJyZWQKICAgICAgICBfOwogICAgfQoKICAgIC8qIEdldHMgdGhlIGNvbnRyYWN0IHZlcnNpb24gZm9yIHZhbGlkYXRpb24gKi8KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIC8qIFNJRlQgY29udHJhY3QgaWRlbnRpZmllcyBhcyA1MDBZWVlZTU1EREhITU0gKi8KICAgICAgICByZXR1cm4gNTAwMjAxNzA3MTcxNDQwOwogICAgfQogICAgCiAgICAvKiBUcmFuc2ZlciBmdW5kcyBiZXR3ZWVuIHR3byBhZGRyZXNzZXMgdGhhdCBhcmUgbm90IHRoZSBjdXJyZW50IG1zZy5zZW5kZXIgLSB0aGlzIHJlcXVpcmVzIGFwcHJvdmFsIHRvIGhhdmUgYmVlbiBzZXQgc2VwYXJhdGVseSBhbmQgZm9sbG93cyBzdGFuZGFyZCBFUkMyMCBndWlkZWxpbmVzICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgZnVuZFNlbmRhYmxlUGhhc2Ugb25seVBheWxvYWRTaXplKDMpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF9hbW91bnQgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX2Ftb3VudCAmJiBfYW1vdW50ID4gMCAmJiBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICAgICAgYm9vbCBpc05ldyA9IGJhbGFuY2VzW190b10gPT0gMDsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfYW1vdW50KTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX2Ftb3VudCk7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgICAgICAgICAgaWYgKGlzTmV3KQogICAgICAgICAgICAgICAgdG9rZW5Pd25lckFkZChfdG8pOwogICAgICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID09IDApCiAgICAgICAgICAgICAgICB0b2tlbk93bmVyUmVtb3ZlKF9mcm9tKTsKICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyogUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIGhvbGRlcnMgb2YgdGhpcyBjdXJyZW5jeS4gKi8KICAgIGZ1bmN0aW9uIHRva2VuSG9sZGVyQ291bnQoKSBhY2NvdW50UmVhZGVyT25seSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFsbFRva2VuSG9sZGVycy5sZW5ndGg7CiAgICB9CgogICAgLyogR2V0cyB0aGUgdG9rZW4gaG9sZGVyIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguICovCiAgICBmdW5jdGlvbiB0b2tlbkhvbGRlcih1aW50MjU2IF9pbmRleCkgYWNjb3VudFJlYWRlck9ubHkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBhbGxUb2tlbkhvbGRlcnNbX2luZGV4XTsKICAgIH0KIAogICAgLyogQWRkcyBhbiBhcHByb3ZhbCBmb3IgdGhlIHNwZWNpZmllZCBhY2NvdW50IHRvIHNwZW5kIG1vbmV5IG9mIHRoZSBtZXNzYWdlIHNlbmRlciB1cCB0byB0aGUgZGVmaW5lZCBsaW1pdCAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIGZ1bmRTZW5kYWJsZVBoYXNlIG9ubHlQYXlsb2FkU2l6ZSgyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qIEdldHMgdGhlIGN1cnJlbnQgYWxsb3dhbmNlIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgZm9yIHRoZSBzcGVjaWZpZWQgc3BlbmRlciBvZiB0aGUgb3duZXIgYWRkcmVzcyAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8qIEdldHMgdGhlIHRvdGFsIHN1cHBseSBhdmFpbGFibGUgb2YgdGhpcyB0b2tlbiAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QW1vdW50OwogICAgfQoKICAgIC8qIEdldHMgdGhlIGJhbGFuY2Ugb2YgYSBzcGVjaWZpZWQgYWNjb3VudCAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICAvKiBUcmFuc2ZlciB0aGUgYmFsYW5jZSBmcm9tIG93bmVyJ3MgYWNjb3VudCB0byBhbm90aGVyIGFjY291bnQgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIGZ1bmRTZW5kYWJsZVBoYXNlIG9ubHlQYXlsb2FkU2l6ZSgyKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgLyogQ2hlY2sgaWYgc2VuZGVyIGhhcyBiYWxhbmNlIGFuZCBmb3Igb3ZlcmZsb3dzICovCiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgX2Ftb3VudCB8fCBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KSA8IGJhbGFuY2VzW190b10pCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgLyogRG8gYSBjaGVjayB0byBzZWUgaWYgdGhleSBhcmUgbmV3LCBpZiBzbyB3ZSdsbCB3YW50IHRvIGFkZCBpdCB0byBvdXIgYXJyYXkgKi8KICAgICAgICBib29sIGlzUmVjaXBpZW50TmV3ID0gYmFsYW5jZXNbX3RvXSA8IDE7CgogICAgICAgIC8qIEFkZCBhbmQgc3VidHJhY3QgbmV3IGJhbGFuY2VzICovCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwoKICAgICAgICAvKiBDb25zb2xpZGF0ZSBhcnJheXMgaWYgdGhleSBhcmUgbmV3IG9yIGlmIHNlbmRlciBub3cgaGFzIGVtcHR5IGJhbGFuY2UgKi8KICAgICAgICBpZiAoaXNSZWNpcGllbnROZXcpCiAgICAgICAgICAgIHRva2VuT3duZXJBZGQoX3RvKTsKICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCAxKQogICAgICAgICAgICB0b2tlbk93bmVyUmVtb3ZlKG1zZy5zZW5kZXIpOwoKICAgICAgICAvKiBGaXJlIG5vdGlmaWNhdGlvbiBldmVudCAqLwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyogSWYgdGhlIHNwZWNpZmllZCBhZGRyZXNzIGlzIG5vdCBpbiBvdXIgb3duZXIgbGlzdCwgYWRkIHRoZW0gLSB0aGlzIGNhbiBiZSBjYWxsZWQgYnkgZGVzY2VuZGVudHMgdG8gZW5zdXJlIHRoZSBkYXRhYmFzZSBpcyBrZXB0IHVwIHRvIGRhdGUuICovCiAgICBmdW5jdGlvbiB0b2tlbk93bmVyQWRkKGFkZHJlc3MgX2FkZHIpIGludGVybmFsIHsKICAgICAgICAvKiBGaXJzdCBjaGVjayBpZiB0aGV5IGFscmVhZHkgZXhpc3QgKi8KICAgICAgICB1aW50MjU2IHRva2VuSG9sZGVyQ291bnQgPSBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoOwogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IHRva2VuSG9sZGVyQ291bnQ7IGkrKykKICAgICAgICAgICAgaWYgKGFsbFRva2VuSG9sZGVyc1tpXSA9PSBfYWRkcikKICAgICAgICAgICAgICAgIC8qIEFscmVhZHkgZm91bmQgc28gd2UgY2FuIGFib3J0IG5vdyAqLwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIAogICAgICAgIC8qIFRoZXkgZG9uJ3Qgc2VlbSB0byBleGlzdCwgc28gbGV0J3MgYWRkIHRoZW0gKi8KICAgICAgICBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoKys7CiAgICAgICAgYWxsVG9rZW5Ib2xkZXJzW2FsbFRva2VuSG9sZGVycy5sZW5ndGggLSAxXSA9IF9hZGRyOwogICAgfQoKICAgIC8qIElmIHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBpbiBvdXIgb3duZXIgbGlzdCwgcmVtb3ZlIHRoZW0gLSB0aGlzIGNhbiBiZSBjYWxsZWQgYnkgZGVzY2VuZGVudHMgdG8gZW5zdXJlIHRoZSBkYXRhYmFzZSBpcyBrZXB0IHVwIHRvIGRhdGUuICovCiAgICBmdW5jdGlvbiB0b2tlbk93bmVyUmVtb3ZlKGFkZHJlc3MgX2FkZHIpIGludGVybmFsIHsKICAgICAgICAvKiBGaW5kIG91dCB3aGVyZSBpbiBvdXIgYXJyYXkgdGhleSBhcmUgKi8KICAgICAgICB1aW50MjU2IHRva2VuSG9sZGVyQ291bnQgPSBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoOwogICAgICAgIHVpbnQyNTYgZm91bmRJbmRleCA9IDA7CiAgICAgICAgYm9vbCBmb3VuZCA9IGZhbHNlOwogICAgICAgIHVpbnQyNTYgaTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5Ib2xkZXJDb3VudDsgaSsrKQogICAgICAgICAgICBpZiAoYWxsVG9rZW5Ib2xkZXJzW2ldID09IF9hZGRyKSB7CiAgICAgICAgICAgICAgICBmb3VuZEluZGV4ID0gaTsKICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogSWYgd2UgZGlkbid0IGZpbmQgdGhlbSBqdXN0IHJldHVybiAqLwogICAgICAgIGlmICghZm91bmQpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAKICAgICAgICAvKiBXZSBub3cgbmVlZCB0byBzaHVmZmxlIGRvd24gdGhlIGFycmF5ICovCiAgICAgICAgZm9yIChpID0gZm91bmRJbmRleDsgaSA8IHRva2VuSG9sZGVyQ291bnQgLSAxOyBpKyspCiAgICAgICAgICAgIGFsbFRva2VuSG9sZGVyc1tpXSA9IGFsbFRva2VuSG9sZGVyc1tpICsgMV07CiAgICAgICAgYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aC0tOwogICAgfQoKICAgIC8qIE1pbnQgbmV3IHRva2VucyAtIHRoaXMgY2FuIG9ubHkgYmUgZG9uZSBieSBzcGVjaWFsIGNhbGxlcnMgKGkuZS4gdGhlIElDTyBtYW5hZ2VtZW50KSBkdXJpbmcgdGhlIElDTyBwaGFzZS4gKi8KICAgIGZ1bmN0aW9uIG1pbnRUb2tlbnMoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfYW1vdW50KSBvbmx5UGF5bG9hZFNpemUoMikgewogICAgICAgIC8qIEVuc3VyZSB3ZSBhcmUgdGhlIElDTyBjb250cmFjdCBjYWxsaW5nICovCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gaWNvQ29udHJhY3RBZGRyZXNzIHx8ICFpY29QaGFzZU1hbmFnZW1lbnQuaWNvUGhhc2UoKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIE1pbnQgdGhlIHRva2VucyBmb3IgdGhlIG5ldyBhZGRyZXNzKi8KICAgICAgICBib29sIGlzTmV3ID0gYmFsYW5jZXNbX2FkZHJlc3NdID09IDA7CiAgICAgICAgdG90YWxTdXBwbHlBbW91bnQgPSB0b3RhbFN1cHBseUFtb3VudC5hZGQoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX2FkZHJlc3NdID0gYmFsYW5jZXNbX2FkZHJlc3NdLmFkZChfYW1vdW50KTsKICAgICAgICBpZiAoaXNOZXcpCiAgICAgICAgICAgIHRva2VuT3duZXJBZGQoX2FkZHJlc3MpOwogICAgICAgIFRyYW5zZmVyKDAsIF9hZGRyZXNzLCBfYW1vdW50KTsKICAgIH0KfQoKY29udHJhY3QgVG9rZW5Ib2xkZXJTbmFwc2hvdHRlciB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvKiBNYXAgYWxsIG91ciBvdXIgYmFsYW5jZXMgZm9yIGlzc3VlZCB0b2tlbnMgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgLyogT3VyIGhhbmRsZSB0byB0aGUgU0lGVCBjb250cmFjdC4gKi8KICAgIFNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbiBzaWZ0Q29udHJhY3Q7CgogICAgLyogRGVmaW5lcyB0aGUgYWRtaW4gY29udHJhY3Qgd2UgaW50ZXJmYWNlIHdpdGggZm9yIGNyZWRlbnRhaWxzLiAqLwogICAgQXV0aGVudGljYXRpb25NYW5hZ2VyIGF1dGhlbnRpY2F0aW9uTWFuYWdlcjsKCiAgICAvKiBMaXN0IG9mIGFsbCB0b2tlbiBob2xkZXJzICovCiAgICBhZGRyZXNzW10gYWxsVG9rZW5Ib2xkZXJzOwoKICAgIC8qIEZpcmVkIHdoZW5ldmVyIGEgbmV3IHNuYXBzaG90IGlzIG1hZGUgKi8KICAgIGV2ZW50IFNuYXBzaG90VGFrZW4oKTsKICAgIGV2ZW50IFNuYXBzaG90VXBkYXRlZChhZGRyZXNzIGhvbGRlciwgdWludDI1NiBvbGRCYWxhbmNlLCB1aW50MjU2IG5ld0JhbGFuY2UsIHN0cmluZyBkZXRhaWxzKTsKCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSBjdXJyZW50IGFkbWlucyAqLwogICAgbW9kaWZpZXIgYWRtaW5Pbmx5IHsKICAgICAgICBpZiAoIWF1dGhlbnRpY2F0aW9uTWFuYWdlci5pc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KICAgIC8qIFRoaXMgbW9kaWZpZXIgYWxsb3dzIGEgbWV0aG9kIHRvIG9ubHkgYmUgY2FsbGVkIGJ5IGFjY291bnQgcmVhZGVycyAqLwogICAgbW9kaWZpZXIgYWNjb3VudFJlYWRlck9ubHkgewogICAgICAgIGlmICghYXV0aGVudGljYXRpb25NYW5hZ2VyLmlzQ3VycmVudEFjY291bnRSZWFkZXIobXNnLnNlbmRlcikpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgLyogQ3JlYXRlIG91ciBjb250cmFjdCB3aXRoIHJlZmVyZW5jZXMgdG8gb3RoZXIgY29udHJhY3RzIGFzIHJlcXVpcmVkLiAqLwogICAgZnVuY3Rpb24gVG9rZW5Ib2xkZXJTbmFwc2hvdHRlcihhZGRyZXNzIF9zaWZ0Q29udHJhY3RBZGRyZXNzLCBhZGRyZXNzIF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKSB7CiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovCiAgICAgICAgc2lmdENvbnRyYWN0ID0gU21hcnRJbnZlc3RtZW50RnVuZFRva2VuKF9zaWZ0Q29udHJhY3RBZGRyZXNzKTsKICAgICAgICBpZiAoc2lmdENvbnRyYWN0LmNvbnRyYWN0VmVyc2lvbigpICE9IDUwMDIwMTcwNzE3MTQ0MCkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFNldHVwIGFjY2VzcyB0byBvdXIgb3RoZXIgY29udHJhY3RzIGFuZCB2YWxpZGF0ZSB0aGVpciB2ZXJzaW9ucyAqLwogICAgICAgIGF1dGhlbnRpY2F0aW9uTWFuYWdlciA9IEF1dGhlbnRpY2F0aW9uTWFuYWdlcihfYXV0aGVudGljYXRpb25NYW5hZ2VyQWRkcmVzcyk7CiAgICAgICAgaWYgKGF1dGhlbnRpY2F0aW9uTWFuYWdlci5jb250cmFjdFZlcnNpb24oKSAhPSAxMDAyMDE3MDcxNzE1MDMpCiAgICAgICAgICAgIHRocm93OwogICAgfQoKICAgIC8qIEdldHMgdGhlIGNvbnRyYWN0IHZlcnNpb24gZm9yIHZhbGlkYXRpb24gKi8KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIC8qIERpdmlkZW5kIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgNzAwWVlZWU1NRERISE1NICovCiAgICAgICAgcmV0dXJuIDcwMDIwMTcwOTE5MjExOTsKICAgIH0KCiAgICAvKiBTbmFwc2hvdCB0byBjdXJyZW50IHN0YXRlIG9mIGNvbnRyYWN0Ki8KICAgIGZ1bmN0aW9uIHNuYXBzaG90KCkgYWRtaW5Pbmx5IHsKICAgICAgICAvLyBGaXJzdCBkZWxldGUgZXhpc3RpbmcgaG9sZGVyIGJhbGFuY2VzCiAgICAgICAgdWludDI1NiBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGJhbGFuY2VzW2FsbFRva2VuSG9sZGVyc1tpXV0gPSAwOwoKICAgICAgICAvLyBOb3cgY2xvbmUgb3VyIGNvbnRyYWN0IHRvIG1hdGNoCiAgICAgICAgYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCA9IHNpZnRDb250cmFjdC50b2tlbkhvbGRlckNvdW50KCk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGFsbFRva2VuSG9sZGVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIGFkZHIgPSBzaWZ0Q29udHJhY3QudG9rZW5Ib2xkZXIoaSk7CiAgICAgICAgICAgIGFsbFRva2VuSG9sZGVyc1tpXSA9IGFkZHI7CiAgICAgICAgICAgIGJhbGFuY2VzW2FkZHJdID0gc2lmdENvbnRyYWN0LmJhbGFuY2VPZihhZGRyKTsKICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZQogICAgICAgIFNuYXBzaG90VGFrZW4oKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzbmFwc2hvdFVwZGF0ZShhZGRyZXNzIF9hZGRyLCB1aW50MjU2IF9uZXdCYWxhbmNlLCBzdHJpbmcgX2RldGFpbHMpIGFkbWluT25seSB7CiAgICAgICAgLy8gQXJlIHRoZXkgYWxyZWFkeSBhIGhvbGRlcj8gIElmIG5vdCBhbmQgbm8gbmV3IGJhbGFuY2UgdGhlbiB3ZSdyZSBtYWtpbmcgbm8gY2hhbmdlIHNvIGxlYXZlIG5vdywgb3IgaWYgdGhleSBhcmUgYW5kIGJhbGFuY2UgaXMgdGhlIHNhbWUKICAgICAgICB1aW50MjU2IGV4aXN0aW5nQmFsYW5jZSA9IGJhbGFuY2VzW19hZGRyXTsKICAgICAgICBpZiAoZXhpc3RpbmdCYWxhbmNlID09IF9uZXdCYWxhbmNlKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgCiAgICAgICAgLy8gU28gd2UgZGVmaW5pdGVseSBoYXZlIGEgY2hhbmdlIHRvIG1ha2UuICBJZiB0aGV5IGFyZSBub3QgYSBob2xkZXIgYWRkIHRvIG91ciBsaXN0IGFuZCB1cGRhdGUgYmFsYW5jZS4gIElmIHRoZXkgYXJlIGEgaG9sZGVyIHdobyBtYWludGFpbnMgYmFsYW5jZSB1cGRhdGUgYmFsYW5jZS4gIE90aGVyd2lzZSBzZXQgYmFsYW5jZSB0byAwIGFuZCBkZWxldGUuCiAgICAgICAgaWYgKGV4aXN0aW5nQmFsYW5jZSA9PSAwKSB7CiAgICAgICAgICAgIC8vIE5ldyBob2xkZXIsIGp1c3QgYWRkIHRoZW0KICAgICAgICAgICAgYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCsrOwogICAgICAgICAgICBhbGxUb2tlbkhvbGRlcnNbYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCAtIDFdID0gX2FkZHI7CiAgICAgICAgICAgIGJhbGFuY2VzW19hZGRyXSA9IF9uZXdCYWxhbmNlOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChfbmV3QmFsYW5jZSA+IDApIHsKICAgICAgICAgICAgLy8gRXhpc3RpbmcgaG9sZGVyIHdlJ3JlIHVwZGF0aW5nCiAgICAgICAgICAgIGJhbGFuY2VzW19hZGRyXSA9IF9uZXdCYWxhbmNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEV4aXN0aW5nIGhvbGRlciwgd2UncmUgZGVsZXRpbmcKICAgICAgICAgICAgYmFsYW5jZXNbX2FkZHJdID0gMDsKCiAgICAgICAgICAgIC8qIEZpbmQgb3V0IHdoZXJlIGluIG91ciBhcnJheSB0aGV5IGFyZSAqLwogICAgICAgICAgICB1aW50MjU2IHRva2VuSG9sZGVyQ291bnQgPSBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoOwogICAgICAgICAgICB1aW50MjU2IGZvdW5kSW5kZXggPSAwOwogICAgICAgICAgICBib29sIGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIHVpbnQyNTYgaTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2VuSG9sZGVyQ291bnQ7IGkrKykKICAgICAgICAgICAgICAgIGlmIChhbGxUb2tlbkhvbGRlcnNbaV0gPT0gX2FkZHIpIHsKICAgICAgICAgICAgICAgICAgICBmb3VuZEluZGV4ID0gaTsKICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvKiBXZSBub3cgbmVlZCB0byBzaHVmZmxlIGRvd24gdGhlIGFycmF5ICovCiAgICAgICAgICAgIGlmIChmb3VuZCkgewogICAgICAgICAgICAgICAgZm9yIChpID0gZm91bmRJbmRleDsgaSA8IHRva2VuSG9sZGVyQ291bnQgLSAxOyBpKyspCiAgICAgICAgICAgICAgICAgICAgYWxsVG9rZW5Ib2xkZXJzW2ldID0gYWxsVG9rZW5Ib2xkZXJzW2kgKyAxXTsKICAgICAgICAgICAgICAgIGFsbFRva2VuSG9sZGVycy5sZW5ndGgtLTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQXVkaXQgaXQKICAgICAgICBTbmFwc2hvdFVwZGF0ZWQoX2FkZHIsIGV4aXN0aW5nQmFsYW5jZSwgX25ld0JhbGFuY2UsIF9kZXRhaWxzKTsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSBiYWxhbmNlIG9mIGEgc3BlY2lmaWVkIGFjY291bnQgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIGFkZHIpIGFjY291bnRSZWFkZXJPbmx5IGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbYWRkcl07CiAgICB9CgogICAgLyogUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIGhvbGRlcnMgb2YgdGhpcyBjdXJyZW5jeS4gKi8KICAgIGZ1bmN0aW9uIHRva2VuSG9sZGVyQ291bnQoKSBhY2NvdW50UmVhZGVyT25seSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFsbFRva2VuSG9sZGVycy5sZW5ndGg7CiAgICB9CgogICAgLyogR2V0cyB0aGUgdG9rZW4gaG9sZGVyIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXguICovCiAgICBmdW5jdGlvbiB0b2tlbkhvbGRlcih1aW50MjU2IF9pbmRleCkgYWNjb3VudFJlYWRlck9ubHkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBhbGxUb2tlbkhvbGRlcnNbX2luZGV4XTsKICAgIH0KIAoKfQ=='.
	

]
