Class {
	#name : #SRTe895ca33788c5812119ae5f5c98a78924931f2d5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe895ca33788c5812119ae5f5c98a78924931f2d5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQXV0aG9yZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqIEdpdGh1YiByZXBvc2l0b3J5OiBodHRwczovL2dpdGh1Yi5jb20vQ29pbkZhYnJpay9pY28vdHJlZS93b3JsZC1iaXQKICogU291cmNlIGNvZGUgZmxhdHRlbmVkIHdpdGggYSBub3QgeWV0IHB1YmxpY2FsbHkgYXZhaWxhYmxlIHNjcmlwdC4KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBFbnZpc2lvbmVkIGluIEZpcnN0Qmxvb2QgSUNPIGNvbnRyYWN0LgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbCAKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4gCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKiAKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBpbnRlcm5hbCB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLiAKICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uIAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsKICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogIGV2ZW50IEhhbHRlZChib29sIGhhbHRlZCk7CgogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKCFoYWx0ZWQpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKGhhbHRlZCk7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgICBIYWx0ZWQodHJ1ZSk7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIEhhbHRlZChmYWxzZSk7CiAgfQoKfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludCBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogSW50ZXJmYWNlIGZvciB0aGUgc3RhbmRhcmQgdG9rZW4uCiAqIEJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvbWFzdGVyL0VJUFMvZWlwLTIwLXRva2VuLXN0YW5kYXJkLm1kCiAqLwpjb250cmFjdCBFSVAyMFRva2VuIHsKCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CgogIC8qKgogICoqIE9wdGlvbmFsIGZ1bmN0aW9ucwogICoKICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDggZGVjaW1hbHMpOwogICoKICAqKi8KCn0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLyBJbnRlcmZhY2UgZm9yIGJ1cm5pbmcgdG9rZW5zCmNvbnRyYWN0IEJ1cm5hYmxlIHsKICAvLyBAZGV2IERlc3Ryb3lzIHRva2VucyBmb3IgYW4gYWNjb3VudAogIC8vIEBwYXJhbSBhY2NvdW50IEFjY291bnQgd2hvc2UgdG9rZW5zIGFyZSBkZXN0cm95ZWQKICAvLyBAcGFyYW0gdmFsdWUgQW1vdW50IG9mIHRva2VucyB0byBkZXN0cm95CiAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIGFjY291bnQsIHVpbnQgdmFsdWUpIGludGVybmFsOwogIGV2ZW50IEJ1cm5lZChhZGRyZXNzIGFjY291bnQsIHVpbnQgdmFsdWUpOwp9CnByYWdtYSBzb2xpZGl0eSBeMC40LjE1OwoKLyoqCiAqIEF1dGhvcmVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCgovKioKICogSW50ZXJuYWwgaW50ZXJmYWNlIGZvciB0aGUgbWludGluZyBvZiB0b2tlbnMuCiAqLwpjb250cmFjdCBNaW50YWJsZSB7CgogIC8qKgogICAqIEBkZXYgTWludHMgdG9rZW5zIGZvciBhbiBhY2NvdW50CiAgICogVGhpcyBmdW5jdGlvbiBzaG91bGQgZW1pdCB0aGUgTWludGVkIGV2ZW50LgogICAqLwogIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgaW50ZXJuYWw7CgogIC8qKiBUb2tlbiBzdXBwbHkgZ290IGluY3JlYXNlZCBhbmQgYSBuZXcgb3duZXIgcmVjZWl2ZWQgdGhlc2UgdG9rZW5zICovCiAgZXZlbnQgTWludGVkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCB0b2tlbgogKiBAZGV2IEJhc2ljIGltcGxlbWVudGF0aW9uIG9mIHRoZSBFSVAyMCBzdGFuZGFyZCB0b2tlbiAoYWxzbyBrbm93biBhcyBFUkMyMCB0b2tlbikuCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVJUDIwVG9rZW4sIEJ1cm5hYmxlLCBNaW50YWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIHVpbnQgcHJpdmF0ZSB0b3RhbF9zdXBwbHk7CiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHByaXZhdGUgYmFsYW5jZXM7CiAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIHByaXZhdGUgYWxsb3dlZDsKCgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b3RhbF9zdXBwbHk7CiAgfQoKICAvKioKICAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgICogQHBhcmFtIHRvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICAqIEBwYXJhbSB2YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKHZhbHVlKTsKICAgIGJhbGFuY2VzW3RvXSA9IGJhbGFuY2VzW3RvXS5hZGQodmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgdG8sIHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgKiBAcGFyYW0gYWNjb3VudCBUaGUgYWRkcmVzcyB3aG9zZSBiYWxhbmNlIGlzIHRvIGJlIHF1ZXJpZWQuCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBhY2NvdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbYWNjb3VudF07CiAgfQoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSB2YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgYWxsb3dhbmNlID0gYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKGFsbG93YW5jZSwgdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlKHZhbHVlIDw9IGFsbG93YW5jZSk7CiAgICAvLyBTYWZlTWF0aCB1c2VzIGFzc2VydCBpbnN0ZWFkIG9mIHJlcXVpcmUgdGhvdWdoLCBiZXdhcmUgd2hlbiB1c2luZyBhbiBhbmFseXNpcyB0b29sCgogICAgYmFsYW5jZXNbZnJvbV0gPSBiYWxhbmNlc1tmcm9tXS5zdWIodmFsdWUpOwogICAgYmFsYW5jZXNbdG9dID0gYmFsYW5jZXNbdG9dLmFkZCh2YWx1ZSk7CiAgICBhbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dhbmNlLnN1Yih2YWx1ZSk7CiAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBzcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSB2YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXMnCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShzcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSAodmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID09IDApOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBhY2NvdW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIHNwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgYWNjb3VudCwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW2FjY291bnRdW3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogQXRvbWljIGluY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZwogICAqCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICoKICAgKi8KICBmdW5jdGlvbiBhZGRBcHByb3ZhbChhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXTsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IG9sZFZhbHVlLmFkZChhZGRlZFZhbHVlKTsKICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSk7CiAgICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQXRvbWljIGRlY3JlbWVudCBvZiBhcHByb3ZlZCBzcGVuZGluZy4KICAgKgogICAqIFdvcmtzIGFyb3VuZCBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqLwogIGZ1bmN0aW9uIHN1YkFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBzdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAgIHVpbnQgb2xkVmFsID0gYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXTsKCiAgICAgIGlmIChzdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWwpIHsKICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IG9sZFZhbC5zdWIoc3VidHJhY3RlZFZhbHVlKTsKICAgICAgfQogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdKTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IFByb3ZpZGVzIGFuIGludGVybmFsIGZ1bmN0aW9uIGZvciBkZXN0cm95aW5nIHRva2Vucy4gVXNlZnVsIGZvciB1cGdyYWRlcy4KICAgKi8KICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgYWNjb3VudCwgdWludCB2YWx1ZSkgaW50ZXJuYWwgewogICAgYmFsYW5jZXNbYWNjb3VudF0gPSBiYWxhbmNlc1thY2NvdW50XS5zdWIodmFsdWUpOwogICAgdG90YWxfc3VwcGx5ID0gdG90YWxfc3VwcGx5LnN1Yih2YWx1ZSk7CiAgICBUcmFuc2ZlcihhY2NvdW50LCAwLCB2YWx1ZSk7CiAgICBCdXJuZWQoYWNjb3VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBQcm92aWRlcyBhbiBpbnRlcm5hbCBtaW50aW5nIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgaW50ZXJuYWwgewogICAgdG90YWxfc3VwcGx5ID0gdG90YWxfc3VwcGx5LmFkZChhbW91bnQpOwogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLmFkZChhbW91bnQpOwogICAgTWludGVkKHJlY2VpdmVyLCBhbW91bnQpOwoKICAgIC8vIEJld2FyZTogQWRkcmVzcyB6ZXJvIG1heSBiZSB1c2VkIGZvciBzcGVjaWFsIHRyYW5zYWN0aW9ucyBpbiBhIGZ1dHVyZSBmb3JrLgogICAgLy8gVGhpcyB3aWxsIG1ha2UgdGhlIG1pbnQgdHJhbnNhY3Rpb24gYXBwZWFyIGluIEV0aGVyU2Nhbi5pbwogICAgLy8gV2UgY2FuIHJlbW92ZSB0aGlzIGFmdGVyIHRoZXJlIGlzIGEgc3RhbmRhcmRpemVkIG1pbnRpbmcgZXZlbnQKICAgIFRyYW5zZmVyKDAsIHJlY2VpdmVyLCBhbW91bnQpOwogIH0KICAKfQoKLyoqCiAqIERlZmluZSBpbnRlcmZhY2UgZm9yIHJlbGVhc2luZyB0aGUgdG9rZW4gdHJhbnNmZXIgYWZ0ZXIgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICovCmNvbnRyYWN0IFJlbGVhc2FibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKCiAgLyogVGhlIGZpbmFsaXplciBjb250cmFjdCB0aGF0IGFsbG93cyBsaWZ0aW5nIHRoZSB0cmFuc2ZlciBsaW1pdHMgb24gdGhpcyB0b2tlbiAqLwogIGFkZHJlc3MgcHVibGljIHJlbGVhc2VBZ2VudDsKCiAgLyoqIEEgY3Jvd2RzYWxlIGNvbnRyYWN0IGNhbiByZWxlYXNlIHVzIHRvIHRoZSB3aWxkIGlmIElDTyBzdWNjZXNzLiBJZiBmYWxzZSB3ZSBhcmUgYXJlIGluIHRyYW5zZmVyIGxvY2sgdXAgcGVyaW9kLiovCiAgYm9vbCBwdWJsaWMgcmVsZWFzZWQgPSBmYWxzZTsKCiAgLyoqIE1hcCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byB0cmFuc2ZlciB0b2tlbnMgcmVnYXJkbGVzcyBvZiB0aGUgbG9jayBkb3duIHBlcmlvZC4gVGhlc2UgYXJlIGNyb3dkc2FsZSBjb250cmFjdHMgYW5kIHBvc3NpYmxlIHRoZSB0ZWFtIG11bHRpc2lnIGl0c2VsZi4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyB0cmFuc2ZlckFnZW50czsKCiAgLyoqCiAgICogU2V0IHRoZSBjb250cmFjdCB0aGF0IGNhbiBjYWxsIHJlbGVhc2UgYW5kIG1ha2UgdGhlIHRva2VuIHRyYW5zZmVyYWJsZS4KICAgKgogICAqIFNpbmNlIHRoZSBvd25lciBvZiB0aGlzIGNvbnRyYWN0IGlzIChvciBzaG91bGQgYmUpIHRoZSBjcm93ZHNhbGUsCiAgICogaXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGEgY29ycmVzcG9uZGluZyBleHBvc2VkIEFQSSBpbiB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IGluIGNhc2Ugb2YgaW5wdXQgZXJyb3IuCiAgICovCiAgZnVuY3Rpb24gc2V0UmVsZWFzZUFnZW50KGFkZHJlc3MgYWRkcikgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgLy8gV2UgZG9uJ3QgZG8gaW50ZXJmYWNlIGNoZWNrIGhlcmUgYXMgd2UgbWlnaHQgd2FudCB0byBoYXZlIGEgbm9ybWFsIHdhbGxldCBhZGRyZXNzIHRvIGFjdCBhcyBhIHJlbGVhc2UgYWdlbnQuCiAgICByZWxlYXNlQWdlbnQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChlLmcuIGEgY3Jvd2RzYWxlIGNvbnRyYWN0KSB0byB0cmFuc2ZlciB0b2tlbnMgZGVzcGl0ZSB0aGUgbG9jayB1cCBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBpblJlbGVhc2VTdGF0ZShmYWxzZSkgcHVibGljIHsKICAgIHRyYW5zZmVyQWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgfQoKICAvKioKICAgKiBPbmUgd2F5IGZ1bmN0aW9uIHRvIHJlbGVhc2UgdGhlIHRva2VucyBpbnRvIHRoZSB3aWxkLgogICAqCiAgICogQ2FuIGJlIGNhbGxlZCBvbmx5IGZyb20gdGhlIHJlbGVhc2UgYWdlbnQgdGhhdCBzaG91bGQgdHlwaWNhbGx5IGJlIHRoZSBmaW5hbGl6ZSBhZ2VudCBJQ08gY29udHJhY3QuCiAgICogSW4gdGhlIHNjb3BlIG9mIHRoZSBjcm93ZHNhbGUsIGl0IGlzIG9ubHkgY2FsbGVkIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGJlZW4gYSBzdWNjZXNzIChmaXJzdCBtaWxlc3RvbmUgcmVhY2hlZCkuCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZVRva2VuVHJhbnNmZXIoKSBwdWJsaWMgb25seVJlbGVhc2VBZ2VudCB7CiAgICByZWxlYXNlZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBMaW1pdCB0b2tlbiB0cmFuc2ZlciB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIuCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBzZW5kZXIpIHsKICAgIHJlcXVpcmUocmVsZWFzZWQgfHwgdHJhbnNmZXJBZ2VudHNbc2VuZGVyXSk7CiAgICBfOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VkICovCiAgbW9kaWZpZXIgaW5SZWxlYXNlU3RhdGUoYm9vbCByZWxlYXNlU3RhdGUpIHsKICAgIHJlcXVpcmUocmVsZWFzZVN0YXRlID09IHJlbGVhc2VkKTsKICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBhIHdoaXRlbGlzdGVkIHJlbGVhc2UgYWdlbnQuICovCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSByZWxlYXNlQWdlbnQpOwogICAgXzsKICB9CgogIC8qKiBXZSByZXN0cmljdCB0cmFuc2ZlciBieSBvdmVycmlkaW5nIGl0ICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyKCkKICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKHRvLCB2YWx1ZSk7CiAgfQoKICAvKiogV2UgcmVzdHJpY3QgdHJhbnNmZXJGcm9tIGJ5IG92ZXJyaWRpbmcgaXQgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIoZnJvbSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXJGb3JtKCkKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICB9Cgp9CgoKCnByYWdtYSBzb2xpZGl0eSBeMC40LjE1OwoKLyoqCiAqIEZpcnN0IGVudmlzaW9uZWQgYnkgR29sZW0gYW5kIEx1bnlyIHByb2plY3RzLgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBJbnNwaXJlZCBieSBMdW55ci4KICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICovCgovKioKICogVXBncmFkZSBhZ2VudCB0cmFuc2ZlcnMgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0LgogKiBVcGdyYWRlIGFnZW50IGl0c2VsZiBjYW4gYmUgdGhlIHRva2VuIGNvbnRyYWN0LCBvciBqdXN0IGEgbWlkZGxlIG1hbiBjb250cmFjdCBkb2luZyB0aGUgaGVhdnkgbGlmdGluZy4KICoKICogVGhlIFVwZ3JhZGUgYWdlbnQgaXMgdGhlIGludGVyZmFjZSB1c2VkIHRvIGltcGxlbWVudCBhIHRva2VuCiAqIG1pZ3JhdGlvbiBpbiB0aGUgY2FzZSBvZiBhbiBlbWVyZ2VuY3kuCiAqIFRoZSBmdW5jdGlvbiB1cGdyYWRlRnJvbSBoYXMgdG8gaW1wbGVtZW50IHRoZSBwYXJ0IG9mIHRoZSBjcmVhdGlvbgogKiBvZiBuZXcgdG9rZW5zIG9uIGJlaGFsZiBvZiB0aGUgdXNlciBkb2luZyB0aGUgdXBncmFkZS4KICoKICogVGhlIG5ldyB0b2tlbiBjYW4gaW1wbGVtZW50IHRoaXMgaW50ZXJmYWNlIGRpcmVjdGx5LCBvciB1c2UuCiAqLwpjb250cmFjdCBVcGdyYWRlQWdlbnQgewoKICAvKiogVGhpcyB2YWx1ZSBzaG91bGQgYmUgdGhlIHNhbWUgYXMgdGhlIG9yaWdpbmFsIHRva2VuJ3MgdG90YWwgc3VwcGx5ICovCiAgdWludCBwdWJsaWMgb3JpZ2luYWxTdXBwbHk7CgogIC8qKiBJbnRlcmZhY2UgdG8gZW5zdXJlIHRoZSBjb250cmFjdCBpcyBjb3JyZWN0bHkgY29uZmlndXJlZCAqLwogIGZ1bmN0aW9uIGlzVXBncmFkZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgVXBncmFkZSBhbiBhY2NvdW50CgogIFdoZW4gdGhlIHRva2VuIGNvbnRyYWN0IGlzIGluIHRoZSB1cGdyYWRlIHN0YXR1cyB0aGUgZWFjaCB1c2VyIHdpbGwKICBoYXZlIHRvIGNhbGwgYHVwZ3JhZGUodmFsdWUpYCBmdW5jdGlvbiBmcm9tIFVwZ3JhZGVhYmxlVG9rZW4uCgogIFRoZSB1cGdyYWRlIGZ1bmN0aW9uIGFkanVzdCB0aGUgYmFsYW5jZSBvZiB0aGUgdXNlciBhbmQgdGhlIHN1cHBseQogIG9mIHRoZSBwcmV2aW91cyB0b2tlbiBhbmQgdGhlbiBjYWxsIGB1cGdyYWRlRnJvbSh2YWx1ZSlgLgoKICBUaGUgVXBncmFkZUFnZW50IGlzIHRoZSByZXNwb25zaWJsZSB0byBjcmVhdGUgdGhlIHRva2VucyBmb3IgdGhlIHVzZXIKICBpbiB0aGUgbmV3IGNvbnRyYWN0LgoKICAqIEBwYXJhbSBmcm9tIEFjY291bnQgdG8gdXBncmFkZS4KICAqIEBwYXJhbSB2YWx1ZSBUb2tlbnMgdG8gdXBncmFkZS4KCiAgKi8KICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIGZyb20sIHVpbnQgdmFsdWUpIHB1YmxpYzsKCn0KCgovKioKICogQSB0b2tlbiB1cGdyYWRlIG1lY2hhbmlzbSB3aGVyZSB1c2VycyBjYW4gb3B0LWluIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIG5leHQgc21hcnQgY29udHJhY3QgcmV2aXNpb24uCiAqCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIEVJUDIwVG9rZW4sIEJ1cm5hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyoqIENvbnRyYWN0IC8gcGVyc29uIHdobyBjYW4gc2V0IHRoZSB1cGdyYWRlIHBhdGguIFRoaXMgY2FuIGJlIHRoZSBzYW1lIGFzIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBhcyB3aGF0IGl0IGlzIHdpdGggaXRzIGRlZmF1bHQgdmFsdWUuICovCiAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZU1hc3RlcjsKCiAgLyoqIFRoZSBuZXh0IGNvbnRyYWN0IHdoZXJlIHRoZSB0b2tlbnMgd2lsbCBiZSBtaWdyYXRlZC4gKi8KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsKCiAgLyoqIEhvdyBtYW55IHRva2VucyB3ZSBoYXZlIHVwZ3JhZGVkIGJ5IG5vdy4gKi8KICB1aW50IHB1YmxpYyB0b3RhbFVwZ3JhZGVkID0gMDsKCiAgLyoqCiAgICogVXBncmFkZSBzdGF0ZXMuCiAgICoKICAgKiAtIE5vdEFsbG93ZWQ6IFRoZSBjaGlsZCBjb250cmFjdCBoYXMgbm90IHJlYWNoZWQgYSBjb25kaXRpb24gd2hlcmUgdGhlIHVwZ3JhZGUgY2FuIGJndW4KICAgKiAtIFdhaXRpbmdGb3JBZ2VudDogVG9rZW4gYWxsb3dzIHVwZ3JhZGUsIGJ1dCB3ZSBkb24ndCBoYXZlIGEgbmV3IGFnZW50IHlldAogICAqIC0gUmVhZHlUb1VwZ3JhZGU6IFRoZSBhZ2VudCBpcyBzZXQsIGJ1dCBub3QgYSBzaW5nbGUgdG9rZW4gaGFzIGJlZW4gdXBncmFkZWQgeWV0LiBUaGlzIGFsbG93cyBjaGFuZ2luZyB0aGUgdXBncmFkZSBhZ2VudCB3aGlsZSB0aGVyZSBpcyB0aW1lLgogICAqIC0gVXBncmFkaW5nOiBVcGdyYWRlIGFnZW50IGlzIHNldCBhbmQgdGhlIGJhbGFuY2UgaG9sZGVycyBjYW4gdXBncmFkZSB0aGVpciB0b2tlbnMKICAgKgogICAqLwogIGVudW0gVXBncmFkZVN0YXRlIHtVbmtub3duLCBOb3RBbGxvd2VkLCBXYWl0aW5nRm9yQWdlbnQsIFJlYWR5VG9VcGdyYWRlLCBVcGdyYWRpbmd9CgogIC8qKgogICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuCiAgICovCiAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CgogIC8qKgogICAqIE5ldyB1cGdyYWRlIGFnZW50IGF2YWlsYWJsZS4KICAgKi8KICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7CgogIC8qKgogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuCiAgICovCiAgZnVuY3Rpb24gVXBncmFkZWFibGVUb2tlbihhZGRyZXNzIG1hc3RlcikgaW50ZXJuYWwgewogICAgc2V0VXBncmFkZU1hc3RlcihtYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdGhlIHRva2VuIGhvbGRlciB0byB1cGdyYWRlIHNvbWUgb2YgdGhlaXIgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIHVwZ3JhZGUodWludCB2YWx1ZSkgcHVibGljIHsKICAgIFVwZ3JhZGVTdGF0ZSBzdGF0ZSA9IGdldFVwZ3JhZGVTdGF0ZSgpOwogICAgLy8gRW5zdXJlIGl0J3Mgbm90IGNhbGxlZCBpbiBhIGJhZCBzdGF0ZQogICAgcmVxdWlyZShzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGUgfHwgc3RhdGUgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZyk7CgogICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICByZXF1aXJlKHZhbHVlICE9IDApOwoKICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2VucwogICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIAogICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgIGJ1cm5Ub2tlbnMobXNnLnNlbmRlciwgdmFsdWUpOwogICAgdG90YWxVcGdyYWRlZCA9IHRvdGFsVXBncmFkZWQuYWRkKHZhbHVlKTsKCiAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzIHRoZSB1cGdyYWRlIHByb2Nlc3MKICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgb25seU1hc3RlciBleHRlcm5hbCB7CiAgICAvLyBDaGVjayB3aGV0aGVyIHRoZSB0b2tlbiBpcyBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgb2YgdXBncmFkaW5nCiAgICByZXF1aXJlKGNhblVwZ3JhZGUoKSk7CgogICAgcmVxdWlyZShhZ2VudCAhPSAweDApOwogICAgLy8gVXBncmFkZSBoYXMgYWxyZWFkeSBiZWd1biBmb3IgYW4gYWdlbnQKICAgIHJlcXVpcmUoZ2V0VXBncmFkZVN0YXRlKCkgIT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZyk7CgogICAgdXBncmFkZUFnZW50ID0gVXBncmFkZUFnZW50KGFnZW50KTsKCiAgICAvLyBCYWQgaW50ZXJmYWNlCiAgICByZXF1aXJlKHVwZ3JhZGVBZ2VudC5pc1VwZ3JhZGVBZ2VudCgpKTsKICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICByZXF1aXJlKHVwZ3JhZGVBZ2VudC5vcmlnaW5hbFN1cHBseSgpID09IHRvdGFsU3VwcGx5KCkpOwoKICAgIFVwZ3JhZGVBZ2VudFNldCh1cGdyYWRlQWdlbnQpOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBzdGF0ZSBvZiB0aGUgdG9rZW4gdXBncmFkZS4KICAgKi8KICBmdW5jdGlvbiBnZXRVcGdyYWRlU3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhVcGdyYWRlU3RhdGUpIHsKICAgIGlmICghY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7CiAgICBlbHNlIGlmICh0b3RhbFVwZ3JhZGVkID09IDApIHJldHVybiBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGU7CiAgICBlbHNlIHJldHVybiBVcGdyYWRlU3RhdGUuVXBncmFkaW5nOwogIH0KCiAgLyoqCiAgICogQ2hhbmdlIHRoZSB1cGdyYWRlIG1hc3Rlci4KICAgKgogICAqIFRoaXMgYWxsb3dzIHVzIHRvIHNldCBhIG5ldyBvd25lciBmb3IgdGhlIHVwZ3JhZGUgbWVjaGFuaXNtLgogICAqLwogIGZ1bmN0aW9uIGNoYW5nZVVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBvbmx5TWFzdGVyIHB1YmxpYyB7CiAgICBzZXRVcGdyYWRlTWFzdGVyKG5ld19tYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgdXBncmFkZSBtYXN0ZXIgc2V0dGVyLgogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBwcml2YXRlIHsKICAgIHJlcXVpcmUobmV3X21hc3RlciAhPSAweDApOwogICAgdXBncmFkZU1hc3RlciA9IG5ld19tYXN0ZXI7CiAgfQoKICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gb3ZlcnJpZGUgdG8gcHJvdmlkZSB0aGUgY29uZGl0aW9uIGluIHdoaWNoIHRoZSB1cGdyYWRlIGNhbiBiZWdpbi4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgIHJldHVybiB0cnVlOwogIH0KCgogIG1vZGlmaWVyIG9ubHlNYXN0ZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdXBncmFkZU1hc3Rlcik7CiAgICBfOwogIH0KfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQXV0aG9yZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKCi8vIFRoaXMgY29udHJhY3QgYWltcyB0byBwcm92aWRlIGFuIGluaGVyaXRhYmxlIHdheSB0byByZWNvdmVyIHRva2VucyBmcm9tIGEgY29udHJhY3Qgbm90IG1lYW50IHRvIGhvbGQgdG9rZW5zCi8vIFRvIHVzZSB0aGlzIGNvbnRyYWN0LCBoYXZlIHlvdXIgdG9rZW4taWdub3JpbmcgY29udHJhY3QgaW5oZXJpdCB0aGlzIG9uZSBhbmQgaW1wbGVtZW50IGdldExvc3RBbmRGb3VuZE1hc3RlciB0byBkZWNpZGUgd2hvIGNhbiBtb3ZlIGxvc3QgdG9rZW5zLgovLyBPZiBjb3Vyc2UsIHRoaXMgY29udHJhY3QgaW1wb3NlcyBzdXBwb3J0IGNvc3RzIHVwb24gd2hvZXZlciBpcyB0aGUgbG9zdCBhbmQgZm91bmQgbWFzdGVyLgpjb250cmFjdCBMb3N0QW5kRm91bmRUb2tlbiB7CiAgLyoqCiAgICogQHJldHVybiBBZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgaGFuZGxlcyBtb3ZlbWVudHMuCiAgICovCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyk7CgogIC8qKgogICAqIEBwYXJhbSBhZ2VudCBBZGRyZXNzIHRoYXQgd2lsbCBiZSBhYmxlIHRvIG1vdmUgdG9rZW5zIHdpdGggdHJhbnNmZXJGcm9tCiAgICogQHBhcmFtIHRva2VucyBBbW91bnQgb2YgdG9rZW5zIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAqIEBwYXJhbSB0b2tlbl9jb250cmFjdCBDb250cmFjdCBvZiB0aGUgdG9rZW4KICAgKi8KICBmdW5jdGlvbiBlbmFibGVMb3N0QW5kRm91bmQoYWRkcmVzcyBhZ2VudCwgdWludCB0b2tlbnMsIEVJUDIwVG9rZW4gdG9rZW5fY29udHJhY3QpIHB1YmxpYyB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkpOwogICAgLy8gV2UgdXNlIGFwcHJvdmUgaW5zdGVhZCBvZiB0cmFuc2ZlciB0byBtaW5pbWl6ZSB0aGUgcG9zc2liaWxpdHkgb2YgdGhlIGxvc3QgYW5kIGZvdW5kIG1hc3RlcgogICAgLy8gIGdldHRpbmcgdGhlbSBzdHVjayBpbiBhbm90aGVyIGFkZHJlc3MgYnkgYWNjaWRlbnQuCiAgICB0b2tlbl9jb250cmFjdC5hcHByb3ZlKGFnZW50LCB0b2tlbnMpOwogIH0KfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgoKLyoqCiAqIEEgcHVibGljIGludGVyZmFjZSB0byBpbmNyZWFzZSB0aGUgc3VwcGx5IG9mIGEgdG9rZW4uCiAqCiAqIFRoaXMgYWxsb3dzIHVuY2FwcGVkIGNyb3dkc2FsZSBieSBkeW5hbWljYWxseSBpbmNyZWFzaW5nIHRoZSBzdXBwbHkgd2hlbiBtb25leSBwb3VycyBpbi4KICogT25seSBtaW50IGFnZW50cywgdXN1YWxseSBjb250cmFjdHMgd2hpdGVsaXN0ZWQgYnkgdGhlIG93bmVyLCBjYW4gbWludCBuZXcgdG9rZW5zLgogKgogKi8KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBNaW50YWJsZSwgT3duYWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCiAgLyoqIExpc3Qgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gY3JlYXRlIG5ldyB0b2tlbnMgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtaW50QWdlbnRzOwoKICBldmVudCBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSk7CgoKICBmdW5jdGlvbiBNaW50YWJsZVRva2VuKHVpbnQgaW5pdGlhbFN1cHBseSwgYWRkcmVzcyBtdWx0aXNpZywgYm9vbCBtaW50YWJsZSkgaW50ZXJuYWwgewogICAgcmVxdWlyZShtdWx0aXNpZyAhPSBhZGRyZXNzKDApKTsKICAgIC8vIENhbm5vdCBjcmVhdGUgYSB0b2tlbiB3aXRob3V0IHN1cHBseSBhbmQgbm8gbWludGluZwogICAgcmVxdWlyZShtaW50YWJsZSB8fCBpbml0aWFsU3VwcGx5ICE9IDApOwogICAgLy8gQ3JlYXRlIGluaXRpYWxseSBhbGwgYmFsYW5jZSBvbiB0aGUgdGVhbSBtdWx0aXNpZwogICAgaWYgKGluaXRpYWxTdXBwbHkgPiAwKQogICAgICBtaW50SW50ZXJuYWwobXVsdGlzaWcsIGluaXRpYWxTdXBwbHkpOwogICAgLy8gTm8gbW9yZSBuZXcgc3VwcGx5IGFsbG93ZWQgYWZ0ZXIgdGhlIHRva2VuIGNyZWF0aW9uCiAgICBtaW50aW5nRmluaXNoZWQgPSAhbWludGFibGU7CiAgfQoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLgogICAqCiAgICogT25seSBjYWxsYWJsZSBieSBhIG1pbnQgYWdlbnQgKGUuZy4gY3Jvd2RzYWxlIGNvbnRyYWN0KS4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBvbmx5TWludEFnZW50IGNhbk1pbnQgcHVibGljIHsKICAgIG1pbnRJbnRlcm5hbChyZWNlaXZlciwgYW1vdW50KTsKICB9CgogIC8qKgogICAqIE93bmVyIGNhbiBhbGxvdyBhIGNyb3dkc2FsZSBjb250cmFjdCB0byBtaW50IG5ldyB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gc2V0TWludEFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHsKICAgIG1pbnRBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICAgIE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkciwgc3RhdGUpOwogIH0KCiAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsKICAgIC8vIE9ubHkgbWludCBhZ2VudHMgYXJlIGFsbG93ZWQgdG8gbWludCBuZXcgdG9rZW5zCiAgICByZXF1aXJlKG1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pOwogICAgXzsKICB9CgogIC8qKiBNYWtlIHN1cmUgd2UgYXJlIG5vdCBkb25lIHlldC4gKi8KICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQp9CgovKioKICogQSBjcm93ZHNhbGUgdG9rZW4uCiAqCiAqIEFuIEVSQy0yMCB0b2tlbiBkZXNpZ25lZCBzcGVjaWZpY2FsbHkgZm9yIGNyb3dkc2FsZXMgd2l0aCBpbnZlc3RvciBwcm90ZWN0aW9uIGFuZCBmdXJ0aGVyIGRldmVsb3BtZW50IHBhdGguCiAqCiAqIC0gVGhlIHRva2VuIHRyYW5zZmVyKCkgaXMgZGlzYWJsZWQgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyCiAqIC0gVGhlIHRva2VuIGNvbnRyYWN0IGdpdmVzIGFuIG9wdC1pbiB1cGdyYWRlIHBhdGggdG8gYSBuZXcgY29udHJhY3QKICogLSBUaGUgc2FtZSB0b2tlbiBjYW4gYmUgcGFydCBvZiBzZXZlcmFsIGNyb3dkc2FsZXMgdGhyb3VnaCB0aGUgYXBwcm92ZSgpIG1lY2hhbmlzbQogKiAtIFRoZSB0b2tlbiBjYW4gYmUgY2FwcGVkIChzdXBwbHkgc2V0IGluIHRoZSBjb25zdHJ1Y3Rvcikgb3IgdW5jYXBwZWQgKGNyb3dkc2FsZSBjb250cmFjdCBjYW4gbWludCBuZXcgdG9rZW5zKQogKiAtIEVSQzIwIHRva2VucyB0cmFuc2ZlcnJlZCB0byB0aGlzIGNvbnRyYWN0IGNhbiBiZSByZWNvdmVyZWQgYnkgYSBsb3N0IGFuZCBmb3VuZCBtYXN0ZXIKICoKICovCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIGlzIFJlbGVhc2FibGVUb2tlbiwgTWludGFibGVUb2tlbiwgVXBncmFkZWFibGVUb2tlbiwgTG9zdEFuZEZvdW5kVG9rZW4gewoKICBzdHJpbmcgcHVibGljIG5hbWUgPSAiV29ybGRCaXQgVG9rZW4iOwoKICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJXQlQiOwoKICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CgogIGFkZHJlc3MgcHVibGljIGxvc3RfYW5kX2ZvdW5kX21hc3RlcjsKCiAgLyoqCiAgICogQ29uc3RydWN0IHRoZSB0b2tlbi4KICAgKgogICAqIFRoaXMgdG9rZW4gbXVzdCBiZSBjcmVhdGVkIHRocm91Z2ggYSB0ZWFtIG11bHRpc2lnIHdhbGxldCwgc28gdGhhdCBpdCBpcyBvd25lZCBieSB0aGF0IHdhbGxldC4KICAgKgogICAqIEBwYXJhbSBpbml0aWFsX3N1cHBseSBIb3cgbWFueSB0b2tlbnMgd2Ugc3RhcnQgd2l0aC4KICAgKiBAcGFyYW0gdG9rZW5fZGVjaW1hbHMgTnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzLgogICAqIEBwYXJhbSB0ZWFtX211bHRpc2lnIEFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnIHRoYXQgcmVjZWl2ZXMgdGhlIGluaXRpYWwgc3VwcGx5IGFuZCBpcyBzZXQgYXMgdGhlIHVwZ3JhZGUgbWFzdGVyLgogICAqIEBwYXJhbSBtaW50YWJsZSBBcmUgbmV3IHRva2VucyBjcmVhdGVkIG92ZXIgdGhlIGNyb3dkc2FsZSBvciBkbyB3ZSBkaXN0cmlidXRlIG9ubHkgdGhlIGluaXRpYWwgc3VwcGx5PyBOb3RlIHRoYXQgd2hlbiB0aGUgdG9rZW4gYmVjb21lcyB0cmFuc2ZlcmFibGUgdGhlIG1pbnRpbmcgYWx3YXlzIGVuZHMuCiAgICogQHBhcmFtIHRva2VuX3JldHJpZXZlciBBZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgaGFuZGxlcyBFUkMyMCB0b2tlbnMgdGhhdCB3ZXJlIGFjY2lkZW50YWxseSBzZW50IHRvIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlVG9rZW4odWludCBpbml0aWFsX3N1cHBseSwgdWludDggdG9rZW5fZGVjaW1hbHMsIGFkZHJlc3MgdGVhbV9tdWx0aXNpZywgYm9vbCBtaW50YWJsZSwgYWRkcmVzcyB0b2tlbl9yZXRyaWV2ZXIpIHB1YmxpYwogIFVwZ3JhZGVhYmxlVG9rZW4odGVhbV9tdWx0aXNpZykgTWludGFibGVUb2tlbihpbml0aWFsX3N1cHBseSwgdGVhbV9tdWx0aXNpZywgbWludGFibGUpIHsKICAgIHJlcXVpcmUodG9rZW5fcmV0cmlldmVyICE9IGFkZHJlc3MoMCkpOwogICAgZGVjaW1hbHMgPSB0b2tlbl9kZWNpbWFsczsKICAgIGxvc3RfYW5kX2ZvdW5kX21hc3RlciA9IHRva2VuX3JldHJpZXZlcjsKICB9CgogIC8qKgogICAqIFdoZW4gdG9rZW4gaXMgcmVsZWFzZWQgdG8gYmUgdHJhbnNmZXJhYmxlLCBwcm9oaWJpdCBuZXcgdG9rZW4gY3JlYXRpb24uCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZVRva2VuVHJhbnNmZXIoKSBwdWJsaWMgb25seVJlbGVhc2VBZ2VudCB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgc3VwZXIucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsKICB9CgogIC8qKgogICAqIEFsbG93IHVwZ3JhZGUgYWdlbnQgZnVuY3Rpb25hbGl0eSB0byBraWNrIGluIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSB3YXMgYSBzdWNjZXNzLgogICAqLwogIGZ1bmN0aW9uIGNhblVwZ3JhZGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gcmVsZWFzZWQgJiYgc3VwZXIuY2FuVXBncmFkZSgpOwogIH0KCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKSB7CiAgICByZXR1cm4gbG9zdF9hbmRfZm91bmRfbWFzdGVyOwogIH0KCiAgZnVuY3Rpb24gV29ybGRCaXQoYWRkcmVzcyBvYmplY3QsIGJ5dGVzMiBvcGVyYW5kLCBieXRlczIgY29tbWFuZCwgdWludDI1NiB2YWwxLCB1aW50MjU2IHZhbDIsIHN0cmluZyBsb2NhdGlvbiwgc3RyaW5nIHN0cjEsIHN0cmluZyBzdHIyLCBzdHJpbmcgY29tbWVudCkgcHVibGljIHsKICAgIFdvcmxkQml0RXZlbnQob2JqZWN0LCBvcGVyYW5kLCBjb21tYW5kLCB2YWwxLCB2YWwyLCBsb2NhdGlvbiwgc3RyMSwgc3RyMiwgY29tbWVudCk7CiAgfQoKICBldmVudCBXb3JsZEJpdEV2ZW50KGFkZHJlc3Mgb2JqZWN0LCBieXRlczIgb3BlcmFuZCwgYnl0ZXMyIGNvbW1hbmQsIHVpbnQyNTYgdmFsMSwgdWludDI1NiB2YWwyLCBzdHJpbmcgbG9jYXRpb24sIHN0cmluZyBzdHIxLCBzdHJpbmcgc3RyMiwgc3RyaW5nIGNvbW1lbnQpOwoKfQoKLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGVzCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcwogKiAtIGFjY2VwdGluZyBpbnZlc3RtZW50cwogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZAogKiAtIGRpZmZlcmVudCBpbnZlc3RtZW50IHBvbGljaWVzIChyZXF1aXJlIHNlcnZlciBzaWRlIGN1c3RvbWVyIGlkLCBhbGxvdyBvbmx5IHdoaXRlbGlzdGVkIGFkZHJlc3NlcykKICoKICovCmNvbnRyYWN0IEdlbmVyaWNDcm93ZHNhbGUgaXMgSGFsdGFibGUgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyogVGhlIHRva2VuIHdlIGFyZSBzZWxsaW5nICovCiAgQ3Jvd2RzYWxlVG9rZW4gcHVibGljIHRva2VuOwoKICAvKiBldGhlciB3aWxsIGJlIHRyYW5zZmVycmVkIHRvIHRoaXMgYWRkcmVzcyAqLwogIGFkZHJlc3MgcHVibGljIG11bHRpc2lnV2FsbGV0OwoKICAvKiB0aGUgc3RhcnRpbmcgdGltZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgc3RhcnRzQXQ7CgogIC8qIHRoZSBlbmRpbmcgdGltZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgZW5kc0F0OwoKICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKCiAgLyogSG93IG1hbnkgd2VpIG9mIGZ1bmRpbmcgd2UgaGF2ZSByYWlzZWQgKi8KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOwoKICAvKiBIb3cgbWFueSBkaXN0aW5jdCBhZGRyZXNzZXMgaGF2ZSBpbnZlc3RlZCAqLwogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQgPSBmYWxzZTsKCiAgLyogRG8gd2UgbmVlZCB0byBoYXZlIGEgdW5pcXVlIGNvbnRyaWJ1dG9yIGlkIGZvciBlYWNoIGN1c3RvbWVyICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQgPSBmYWxzZTsKCiAgLyoqCiAgICogRG8gd2UgdmVyaWZ5IHRoYXQgY29udHJpYnV0b3IgaGFzIGJlZW4gY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgKGFjY3JlZGl0ZWQgaW52ZXN0b3JzIG9ubHkpLgogICAqIFRoaXMgbWV0aG9kIHdhcyBmaXJzdCB1c2VkIGluIHRoZSBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYWQgYWNjZXB0ZWQgdGVybXMgb2Ygc2FsZSAob24gdGhlIHdlYikuCiAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gZmFsc2U7CgogIC8qKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICAvKiogSG93IG1hbnkgRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgaW4gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNpYWxseSBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogU3RhdGUgbWFjaGluZQogICAqCiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCByZWFjaGVkIHRoZSBzdGFydGluZyB0aW1lIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogQ3Jvd2RzYWxlIGVuZGVkCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZSBmdW5jdGlvbiBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkCiAgICovCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGaW5hbGl6ZWR9CgoKICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7CgogIC8vIFRoZSBydWxlcyBhYm91dCB3aGF0IGtpbmQgb2YgaW52ZXN0bWVudHMgd2UgYWNjZXB0IHdlcmUgY2hhbmdlZAogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgcmVxdWlyZUNJZCwgYm9vbCByZXF1aXJlU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBzaWduZXIpOwoKICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7CgogIC8vIENyb3dkc2FsZSdzIGZpbmFsaXplIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZAogIGV2ZW50IEZpbmFsaXplZCgpOwoKCiAgLyoqCiAgICogQmFzaWMgY29uc3RydWN0b3IgZm9yIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHRlYW1fbXVsdGlzaWcgQWRkcmVzcyBvZiB0aGUgbXVsdGlzaWduYXR1cmUgd2FsbGV0IG9mIHRoZSB0ZWFtIHRoYXQgd2lsbCByZWNlaXZlIGFsbCB0aGUgZnVuZHMgY29udHJpYnV0ZWQgaW4gdGhlIGNyb3dkc2FsZS4KICAgKiBAcGFyYW0gc3RhcnQgQmxvY2sgbnVtYmVyIHdoZXJlIHRoZSBjcm93ZHNhbGUgd2lsbCBiZSBvZmZpY2lhbGx5IHN0YXJ0ZWQuIEl0IHNob3VsZCBiZSBncmVhdGVyIHRoYW4gdGhlIGJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgY29udHJhY3QgaXMgZGVwbG95ZWQuCiAgICogQHBhcmFtIGVuZCBCbG9jayBudW1iZXIgd2hlcmUgdGhlIGNyb3dkc2FsZSBmaW5pc2hlcy4gTm8gdG9rZW5zIGNhbiBiZSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCBhZnRlciB0aGlzIGJsb2NrLgogICAqLwogIGZ1bmN0aW9uIEdlbmVyaWNDcm93ZHNhbGUoYWRkcmVzcyB0ZWFtX211bHRpc2lnLCB1aW50IHN0YXJ0LCB1aW50IGVuZCkgaW50ZXJuYWwgewogICAgc2V0TXVsdGlzaWcodGVhbV9tdWx0aXNpZyk7CgogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMKICAgIHJlcXVpcmUoc3RhcnQgIT0gMCAmJiBlbmQgIT0gMCk7CiAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0ICYmIHN0YXJ0IDwgZW5kKTsKICAgIHN0YXJ0c0F0ID0gc3RhcnQ7CiAgICBlbmRzQXQgPSBlbmQ7CiAgfQoKICAvKioKICAgKiBEZWZhdWx0IGZhbGxiYWNrIGJlaGF2aW91ciBpcyB0byBjYWxsIGJ1eS4KICAgKiBJZGVhbGx5LCBubyBjb250cmFjdCBjYWxscyB0aGlzIGNyb3dkc2FsZSB3aXRob3V0IHN1cHBvcnRpbmcgRVJDMjAuCiAgICogSG93ZXZlciwgc29tZSBzb3J0IG9mIHJlZnVuZGluZyBmdW5jdGlvbiBtYXkgYmUgZGVzaXJlZCB0byBjb3ZlciBzdWNoIHNpdHVhdGlvbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICBidXkoKTsKICB9CgogIC8qKgogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4KICAgKgogICAqIFRoZSBjcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0LgogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGN1c3RvbWVySWQgKG9wdGlvbmFsKSBVVUlEIHY0IHRvIHRyYWNrIHRoZSBzdWNjZXNzZnVsIHBheW1lbnRzIG9uIHRoZSBzZXJ2ZXIgc2lkZQogICAqCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBzdG9wSW5FbWVyZ2VuY3kgbm90RmluaXNoZWQgcHJpdmF0ZSB7CiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmIChnZXRTdGF0ZSgpID09IFN0YXRlLlByZUZ1bmRpbmcpIHsKICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0CiAgICAgIHJlcXVpcmUoZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0pOwogICAgfQoKICAgIHVpbnQgd2VpQW1vdW50OwogICAgdWludCB0b2tlbkFtb3VudDsKICAgICh3ZWlBbW91bnQsIHRva2VuQW1vdW50KSA9IGNhbGN1bGF0ZVRva2VuQW1vdW50KG1zZy52YWx1ZSwgbXNnLnNlbmRlcik7CiAgICAvLyBTYW5pdHkgY2hlY2sgYWdhaW5zdCBiYWQgaW1wbGVtZW50YXRpb24uCiAgICBhc3NlcnQod2VpQW1vdW50IDw9IG1zZy52YWx1ZSk7CiAgICAKICAgIC8vIER1c3QgdHJhbnNhY3Rpb24gaWYgbm8gdG9rZW5zIGNhbiBiZSBnaXZlbgogICAgcmVxdWlyZSh0b2tlbkFtb3VudCAhPSAwKTsKCiAgICBpZiAoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAvLyBBIG5ldyBpbnZlc3RvcgogICAgICBpbnZlc3RvckNvdW50Kys7CiAgICB9CiAgICB1cGRhdGVJbnZlc3RvckZ1bmRzKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHJlY2VpdmVyLCBjdXN0b21lcklkKTsKCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5CiAgICBtdWx0aXNpZ1dhbGxldC50cmFuc2Zlcih3ZWlBbW91bnQpOwoKICAgIC8vIFJldHVybiBleGNlc3Mgb2YgbW9uZXkKICAgIHJldHVybkV4Y2VkZW50KG1zZy52YWx1ZS5zdWIod2VpQW1vdW50KSwgbXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogTm8gbW9uZXkgaXMgZXhjaGFuZ2VkLCBhcyB0aGUgY3Jvd2RzYWxlIHRlYW0gYWxyZWFkeSBoYXZlIHJlY2VpdmVkIHRoZSBwYXltZW50LgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIEFjY291bnQgdGhhdCByZWNlaXZlcyB0aGUgdG9rZW5zLgogICAqIEBwYXJhbSBmdWxsVG9rZW5zIHRva2VucyBhcyBmdWxsIHRva2VucyAtIGRlY2ltYWwgcGxhY2VzIGFyZSBhZGRlZCBpbnRlcm5hbGx5LgogICAqIEBwYXJhbSB3ZWlQcmljZSBQcmljZSBvZiBhIHNpbmdsZSBpbmRpdmlzaWJsZSB0b2tlbiBpbiB3ZWkuCiAgICoKICAgKi8KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgbm90RmluaXNoZWQgewogICAgcmVxdWlyZShyZWNlaXZlciAhPSBhZGRyZXNzKDApKTsKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBmdWxsVG9rZW5zLm11bCgxMCoqdWludCh0b2tlbi5kZWNpbWFscygpKSk7CiAgICByZXF1aXJlKHRva2VuQW1vdW50ICE9IDApOwogICAgdWludCB3ZWlBbW91bnQgPSB3ZWlQcmljZS5tdWwodG9rZW5BbW91bnQpOyAvLyBUaGlzIGNhbiBhbHNvIGJlIDAsIGluIHdoaWNoIGNhc2Ugd2UgZ2l2ZSBvdXQgdG9rZW5zIGZvciBmcmVlCiAgICB1cGRhdGVJbnZlc3RvckZ1bmRzKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHJlY2VpdmVyICwgMCk7CiAgfQoKICAvKioKICAgKiBQcml2YXRlIGZ1bmN0aW9uIHRvIHVwZGF0ZSBhY2NvdW50aW5nIGluIHRoZSBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gdXBkYXRlSW52ZXN0b3JGdW5kcyh1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaUFtb3VudCwgYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBwcml2YXRlIHsKICAgIC8vIFVwZGF0ZSBpbnZlc3RvcgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5hZGQod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0uYWRkKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5hZGQodG9rZW5BbW91bnQpOwoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogICAgLy8gVGVsbCB1cyB0aGF0IHRoZSBpbnZlc3RtZW50IHdhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5CiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSBwYXllciBhbmQgdmVyaWZpZXMgaGUgaXMgYWxsb3dlZCB0byBpbnZlc3QuCiAgICoKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoU2lnbmVkQWRkcmVzcyh1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB2YWxpZEN1c3RvbWVySWQoY3VzdG9tZXJJZCkgewogICAgYnl0ZXMzMiBoYXNoID0gc2hhMjU2KG1zZy5zZW5kZXIpOwogICAgcmVxdWlyZShlY3JlY292ZXIoaGFzaCwgdiwgciwgcykgPT0gc2lnbmVyQWRkcmVzcyk7CiAgICBpbnZlc3RJbnRlcm5hbChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsKICB9CgoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSBwYXllci4KICAgKiAKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHZhbGlkQ3VzdG9tZXJJZChjdXN0b21lcklkKSB1bnNpZ25lZEJ1eUFsbG93ZWQgewogICAgaW52ZXN0SW50ZXJuYWwobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHVuc2lnbmVkQnV5QWxsb3dlZCB7CiAgICByZXF1aXJlKCFyZXF1aXJlQ3VzdG9tZXJJZCk7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aWNpcGFudHMgZm9yIHRoYW5rIHlvdSBlbWFpbAogICAgaW52ZXN0SW50ZXJuYWwobXNnLnNlbmRlciwgMCk7CiAgfQoKICAvKioKICAgKiBGaW5hbGl6ZSBhIHN1Y2NjZXNmdWwgY3Jvd2RzYWxlLgogICAqCiAgICogVGhlIG93bmVyIGNhbiB0cmlnZ2VyIHBvc3QtY3Jvd2RzYWxlIGFjdGlvbnMsIGxpa2UgcmVsZWFzaW5nIHRoZSB0b2tlbnMuCiAgICogTm90ZSB0aGF0IGJ5IGRlZmF1bHQgdG9rZW5zIGFyZSBub3QgaW4gYSByZWxlYXNlZCBzdGF0ZS4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewogICAgZmluYWxpemVkID0gdHJ1ZTsKICAgIEZpbmFsaXplZCgpOwogIH0KCiAgLyoqCiAgICogU2V0IHBvbGljeSBkbyB3ZSBuZWVkIHRvIGhhdmUgc2VydmVyLXNpZGUgY3VzdG9tZXIgaWRzIGZvciB0aGUgaW52ZXN0bWVudHMuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlQ3VzdG9tZXJJZChib29sIHZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmVDdXN0b21lcklkID0gdmFsdWU7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgaWYgYWxsIGludmVzdG9ycyBtdXN0IGJlIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIGZpcnN0LgogICAqCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3Mgc2lnbmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmVkU2lnbmVkQWRkcmVzcyA9IHZhbHVlOwogICAgc2lnbmVyQWRkcmVzcyA9IHNpZ25lcjsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgYWRkcmVzc2VzIHRvIGRvIGVhcmx5IHBhcnRpY2lwYXRpb24uCiAgICovCiAgZnVuY3Rpb24gc2V0RWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKSBwdWJsaWMgb25seU93bmVyIG5vdEZpbmlzaGVkIHN0b3BJbkVtZXJnZW5jeSB7CiAgICBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOwogICAgV2hpdGVsaXN0ZWQoYWRkciwgc3RhdHVzKTsKICB9CgogIC8qKgogICAqIEludGVybmFsIHNldHRlciBmb3IgdGhlIG11bHRpc2lnIHdhbGxldAogICAqLwogIGZ1bmN0aW9uIHNldE11bHRpc2lnKGFkZHJlc3MgYWRkcikgaW50ZXJuYWwgewogICAgcmVxdWlyZShhZGRyICE9IDApOwogICAgbXVsdGlzaWdXYWxsZXQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4KICAgKgogICAqIFRoaXMgZnVuY3Rpb24gaGFzIHRoZSB0aW1lZCB0cmFuc2l0aW9uIGJ1aWx0aW4uCiAgICogU28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgewogICAgaWYgKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7CiAgfQoKICAvKiogSW50ZXJuYWwgZnVuY3Rpb25zIHRoYXQgZXhpc3QgdG8gcHJvdmlkZSBpbnZlcnNpb24gb2YgY29udHJvbCBzaG91bGQgdGhleSBiZSBvdmVycmlkZW4gKi8KCiAgLyoqIEludGVyZmFjZSBmb3IgdGhlIGNvbmNyZXRlIGluc3RhbmNlIHRvIGludGVyYWN0IHdpdGggdGhlIHRva2VuIGNvbnRyYWN0IGluIGEgY3VzdG9taXphYmxlIHdheSAqLwogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBpbnRlcm5hbDsKCiAgLyoqCiAgICogIERldGVybWluZSBpZiB0aGUgZ29hbCB3YXMgYWxyZWFkeSByZWFjaGVkIGluIHRoZSBjdXJyZW50IGNyb3dkc2FsZQogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZnVsbCk7CgogIC8qKgogICAqIFJldHVybnMgYW55IGV4Y2VzcyB3ZWkgcmVjZWl2ZWQKICAgKiAKICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBvdmVycmlkZW4gdG8gcHJvdmlkZSBhIGRpZmZlcmVudCByZWZ1bmRpbmcgbWV0aG9kLgogICAqLwogIGZ1bmN0aW9uIHJldHVybkV4Y2VkZW50KHVpbnQgZXhjZWRlbnQsIGFkZHJlc3MgYWdlbnQpIGludGVybmFsIHsKICAgIGlmIChleGNlZGVudCA+IDApIHsKICAgICAgYWdlbnQudHJhbnNmZXIoZXhjZWRlbnQpOwogICAgfQogIH0KCiAgLyoqIAogICAqICBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgcmVjZWl2ZWQgYW1vdW50LgogICAqICBUaGUgd2VpIGFtb3VudCBpcyByZXR1cm5lZCB0b28gaW4gY2FzZSBub3QgYWxsIG9mIGl0IGNhbiBiZSBpbnZlc3RlZC4KICAgKgogICAqICBOb3RlOiBXaGVuIHRoZXJlJ3MgYW4gZXhjZWRlbnQgZHVlIHRvIHJvdW5kaW5nIGVycm9yLCBpdCBzaG91bGQgYmUgcmV0dXJuZWQgdG8gYWxsb3cgcmVmdW5kaW5nLgogICAqICBUaGlzIGlzIHdvcmtlZCBhcm91bmQgaW4gdGhlIGN1cnJlbnQgZGVzaWduIHVzaW5nIGFuIGFwcHJvcHJpYXRlIGFtb3VudCBvZiBkZWNpbWFscyBpbiB0aGUgRnJhY3Rpb25hbEVSQzIwIHN0YW5kYXJkLgogICAqICBUaGUgd29ya2Fyb3VuZCBpcyBnb29kIGVub3VnaCBmb3IgbW9zdCB1c2UgY2FzZXMsIGhlbmNlIHRoZSBzaW1wbGlmaWVkIGZ1bmN0aW9uIHNpZ25hdHVyZS4KICAgKiAgQHJldHVybiB3ZWlBbGxvd2VkIFRoZSBhbW91bnQgb2Ygd2VpIGFjY2VwdGVkIGluIHRoaXMgdHJhbnNhY3Rpb24uCiAgICogIEByZXR1cm4gdG9rZW5BbW91bnQgVGhlIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byB0aGUgYWdlbnQgaW4gdGhpcyB0cmFuc2FjdGlvbi4KICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50IHdlaUFtb3VudCwgYWRkcmVzcyBhZ2VudCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCB3ZWlBbGxvd2VkLCB1aW50IHRva2VuQW1vdW50KTsKCiAgLy8KICAvLyBNb2RpZmllcnMKICAvLwoKICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7CiAgICByZXF1aXJlKGdldFN0YXRlKCkgPT0gc3RhdGUpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIHVuc2lnbmVkQnV5QWxsb3dlZCgpIHsKICAgIHJlcXVpcmUoIXJlcXVpcmVkU2lnbmVkQWRkcmVzcyk7CiAgICBfOwogIH0KCiAgLyoqIE1vZGlmaWVyIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLwogIG1vZGlmaWVyIG5vdEZpbmlzaGVkKCkgewogICAgU3RhdGUgY3VycmVudF9zdGF0ZSA9IGdldFN0YXRlKCk7CiAgICByZXF1aXJlKGN1cnJlbnRfc3RhdGUgPT0gU3RhdGUuUHJlRnVuZGluZyB8fCBjdXJyZW50X3N0YXRlID09IFN0YXRlLkZ1bmRpbmcpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIHZhbGlkQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHsKICAgIHJlcXVpcmUoY3VzdG9tZXJJZCAhPSAwKTsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sKICAgIF87CiAgfQoKfQovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICoKICogSGVhdmlseSBtb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCgovLy8gQGRldiBUcmFuY2hlIGJhc2VkIHByaWNpbmcuCi8vLyAgICAgIEltcGxlbWVudGluZyAiZmlyc3QgcHJpY2UiIHRyYW5jaGVzLCBtZWFuaW5nLCB0aGF0IGlmIGEgYnV5ZXIncyBvcmRlciBpcwovLy8gICAgICBjb3ZlcmluZyBtb3JlIHRoYW4gb25lIHRyYW5jaGUsIHRoZSBwcmljZSBvZiB0aGUgbG93ZXN0IHRyYW5jaGUgd2lsbCBhcHBseQovLy8gICAgICB0byB0aGUgd2hvbGUgb3JkZXIuCmNvbnRyYWN0IFRva2VuVHJhbmNoZVByaWNpbmcgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyoqCiAgICogRGVmaW5lIHByaWNpbmcgc2NoZWR1bGUgdXNpbmcgdHJhbmNoZXMuCiAgICovCiAgc3RydWN0IFRyYW5jaGUgewogICAgICAvLyBBbW91bnQgaW4gdG9rZW5zIHdoZW4gdGhpcyB0cmFuY2hlIGJlY29tZXMgaW5hY3RpdmUKICAgICAgdWludCBhbW91bnQ7CiAgICAgIC8vIFRpbWUgaW50ZXJ2YWwgW3N0YXJ0LCBlbmQpCiAgICAgIC8vIFN0YXJ0aW5nIHRpbWVzdGFtcCAoaW5jbHVkZWQgaW4gdGhlIGludGVydmFsKQogICAgICB1aW50IHN0YXJ0OwogICAgICAvLyBFbmRpbmcgdGltZXN0YW1wIChleGNsdWRlZCBmcm9tIHRoZSBpbnRlcnZhbCkKICAgICAgdWludCBlbmQ7CiAgICAgIC8vIEhvdyBtYW55IHRva2VucyBwZXIgd2VpIHlvdSB3aWxsIGdldCB3aGlsZSB0aGlzIHRyYW5jaGUgaXMgYWN0aXZlCiAgICAgIHVpbnQgcHJpY2U7CiAgfQogIC8vIFdlIGRlZmluZSBvZmZzZXRzIGFuZCBzaXplIGZvciB0aGUgZGVzZXJpYWxpemF0aW9uIG9mIG9yZGVyZWQgdHVwbGVzIGluIHJhdyBhcnJheXMKICB1aW50IHByaXZhdGUgY29uc3RhbnQgYW1vdW50X29mZnNldCA9IDA7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHN0YXJ0X29mZnNldCA9IDE7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IGVuZF9vZmZzZXQgPSAyOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBwcmljZV9vZmZzZXQgPSAzOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCB0cmFuY2hlX3NpemUgPSA0OwoKICBUcmFuY2hlW10gcHVibGljIHRyYW5jaGVzOwoKICAvLy8gQGRldiBDb25zdHJ1Y3Rpb24sIGNyZWF0aW5nIGEgbGlzdCBvZiB0cmFuY2hlcwogIC8vLyBAcGFyYW0gaW5pdF90cmFuY2hlcyBSYXcgYXJyYXkgb2Ygb3JkZXJlZCB0dXBsZXM6IChlbmQgYW1vdW50LCBzdGFydCB0aW1lc3RhbXAsIGVuZCB0aW1lc3RhbXAsIHByaWNlKQogIGZ1bmN0aW9uIFRva2VuVHJhbmNoZVByaWNpbmcodWludFtdIGluaXRfdHJhbmNoZXMpIHB1YmxpYyB7CiAgICAvLyBOZWVkIHRvIGhhdmUgdHVwbGVzLCBsZW5ndGggY2hlY2sKICAgIHJlcXVpcmUoaW5pdF90cmFuY2hlcy5sZW5ndGggJSB0cmFuY2hlX3NpemUgPT0gMCk7CiAgICAvLyBBIHRyYW5jaGUgd2l0aCBhbW91bnQgemVybyBjYW4gbmV2ZXIgYmUgc2VsZWN0ZWQgYW5kIGlzIHRoZXJlZm9yZSB1c2VsZXNzLgogICAgLy8gVGhpcyBjaGVjayBhbmQgdGhlIG9uZSBpbnNpZGUgdGhlIGxvb3AgZW5zdXJlIG5vIHRyYW5jaGUgY2FuIGhhdmUgYW4gYW1vdW50IGVxdWFsIHRvIHplcm8uCiAgICByZXF1aXJlKGluaXRfdHJhbmNoZXNbYW1vdW50X29mZnNldF0gPiAwKTsKCiAgICB0cmFuY2hlcy5sZW5ndGggPSBpbml0X3RyYW5jaGVzLmxlbmd0aC5kaXYodHJhbmNoZV9zaXplKTsKICAgIFRyYW5jaGUgbWVtb3J5IGxhc3RfdHJhbmNoZTsKICAgIGZvciAodWludCBpID0gMDsgaSA8IHRyYW5jaGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHVpbnQgdHJhbmNoZV9vZmZzZXQgPSBpLm11bCh0cmFuY2hlX3NpemUpOwogICAgICB1aW50IGFtb3VudCA9IGluaXRfdHJhbmNoZXNbdHJhbmNoZV9vZmZzZXQuYWRkKGFtb3VudF9vZmZzZXQpXTsKICAgICAgdWludCBzdGFydCA9IGluaXRfdHJhbmNoZXNbdHJhbmNoZV9vZmZzZXQuYWRkKHN0YXJ0X29mZnNldCldOwogICAgICB1aW50IGVuZCA9IGluaXRfdHJhbmNoZXNbdHJhbmNoZV9vZmZzZXQuYWRkKGVuZF9vZmZzZXQpXTsKICAgICAgdWludCBwcmljZSA9IGluaXRfdHJhbmNoZXNbdHJhbmNoZV9vZmZzZXQuYWRkKHByaWNlX29mZnNldCldOwogICAgICAvLyBObyBpbnZhbGlkIHN0ZXBzCiAgICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wIDwgc3RhcnQgJiYgc3RhcnQgPCBlbmQpOwogICAgICAvLyBCYWlsIG91dCB3aGVuIGVudGVyaW5nIHVubmVjZXNzYXJ5IHRyYW5jaGVzCiAgICAgIC8vIFRoaXMgaXMgcHJlZmVyYWJseSBjaGVja2VkIGJlZm9yZSBkZXBsb3lpbmcgY29udHJhY3QgaW50byBhbnkgYmxvY2tjaGFpbi4KICAgICAgcmVxdWlyZShpID09IDAgfHwgKGVuZCA+PSBsYXN0X3RyYW5jaGUuZW5kICYmIGFtb3VudCA+IGxhc3RfdHJhbmNoZS5hbW91bnQpIHx8CiAgICAgICAgICAgICAgKGVuZCA+IGxhc3RfdHJhbmNoZS5lbmQgJiYgYW1vdW50ID49IGxhc3RfdHJhbmNoZS5hbW91bnQpKTsKCiAgICAgIGxhc3RfdHJhbmNoZSA9IFRyYW5jaGUoYW1vdW50LCBzdGFydCwgZW5kLCBwcmljZSk7CiAgICAgIHRyYW5jaGVzW2ldID0gbGFzdF90cmFuY2hlOwogICAgfQogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHRyYW5jaGUgb3IgYmFpbCBvdXQgaWYgdGhlcmUgaXMgbm8gdHJhbmNoZSBkZWZpbmVkIGZvciB0aGUgY3VycmVudCBibG9jay4KICAvLy8gQHBhcmFtIHRva2Vuc1NvbGQgdG90YWwgYW1vdW50IG9mIHRva2VucyBzb2xkLCBmb3IgY2FsY3VsYXRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQogIC8vLyBAcmV0dXJuIFJldHVybnMgdGhlIHN0cnVjdCByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQogIGZ1bmN0aW9uIGdldEN1cnJlbnRUcmFuY2hlKHVpbnQgdG9rZW5zU29sZCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChUcmFuY2hlIHN0b3JhZ2UpIHsKICAgIGZvciAodWludCBpID0gMDsgaSA8IHRyYW5jaGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh0cmFuY2hlc1tpXS5zdGFydCA8PSBibG9jay50aW1lc3RhbXAgJiYgYmxvY2sudGltZXN0YW1wIDwgdHJhbmNoZXNbaV0uZW5kICYmIHRva2Vuc1NvbGQgPCB0cmFuY2hlc1tpXS5hbW91bnQpIHsKICAgICAgICByZXR1cm4gdHJhbmNoZXNbaV07CiAgICAgIH0KICAgIH0KICAgIC8vIE5vIHRyYW5jaGUgaXMgY3VycmVudGx5IGFjdGl2ZQogICAgcmV2ZXJ0KCk7CiAgfQoKICAvLy8gQGRldiBHZXQgdGhlIGN1cnJlbnQgcHJpY2UuIE1heSByZXZlcnQgaWYgdGhlcmUgaXMgbm8gdHJhbmNoZSBjdXJyZW50bHkgYWN0aXZlLgogIC8vLyBAcGFyYW0gdG9rZW5zU29sZCB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHNvbGQsIGZvciBjYWxjdWxhdGluZyB0aGUgY3VycmVudCB0cmFuY2hlCiAgLy8vIEByZXR1cm4gVGhlIGN1cnJlbnQgcHJpY2UKICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludCB0b2tlbnNTb2xkKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgcmV0dXJuIGdldEN1cnJlbnRUcmFuY2hlKHRva2Vuc1NvbGQpLnByaWNlOwogIH0KCn0KCi8vIFRoaXMgY29udHJhY3QgaGFzIHRoZSBzb2xlIG9iamVjdGl2ZSBvZiBwcm92aWRpbmcgYSBzYW5lIGNvbmNyZXRlIGluc3RhbmNlIG9mIHRoZSBDcm93ZHNhbGUgY29udHJhY3QuCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBHZW5lcmljQ3Jvd2RzYWxlLCBMb3N0QW5kRm91bmRUb2tlbiwgVG9rZW5UcmFuY2hlUHJpY2luZyB7CiAgLy9pbml0aWFsIHN1cHBseSBpbiA0MDBrLCBzb2xkIHRva2VucyBmcm9tIGluaXRpYWwgbWludGluZwogIHVpbnQ4IHByaXZhdGUgY29uc3RhbnQgdG9rZW5fZGVjaW1hbHMgPSAxODsKICB1aW50IHByaXZhdGUgY29uc3RhbnQgdG9rZW5faW5pdGlhbF9zdXBwbHkgPSAxNTc1ICogKDEwICoqIDUpICogKDEwICoqIHVpbnQodG9rZW5fZGVjaW1hbHMpKTsKICBib29sIHByaXZhdGUgY29uc3RhbnQgdG9rZW5fbWludGFibGUgPSB0cnVlOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBzZWxsYWJsZV90b2tlbnMgPSA1MjUgKiAoMTAgKiogNSkgKiAoMTAgKiogdWludCh0b2tlbl9kZWNpbWFscykpOwoKICAvKioKICAgKiBDb25zdHJ1Y3RvciBmb3IgdGhlIGNyb3dkc2FsZS4KICAgKiBOb3JtYWxseSwgdGhlIHRva2VuIGNvbnRyYWN0IGlzIGNyZWF0ZWQgaGVyZS4gVGhhdCB3YXksIHRoZSBtaW50aW5nLCByZWxlYXNlIGFuZCB0cmFuc2ZlciBhZ2VudHMgY2FuIGJlIHNldCBoZXJlIHRvby4KICAgKgogICAqIEBwYXJhbSB0ZWFtX211bHRpc2lnIEFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnbmF0dXJlIHdhbGxldCBvZiB0aGUgdGVhbSB0aGF0IHdpbGwgcmVjZWl2ZSBhbGwgdGhlIGZ1bmRzIGNvbnRyaWJ1dGVkIGluIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHN0YXJ0IEJsb2NrIG51bWJlciB3aGVyZSB0aGUgY3Jvd2RzYWxlIHdpbGwgYmUgb2ZmaWNpYWxseSBzdGFydGVkLiBJdCBzaG91bGQgYmUgZ3JlYXRlciB0aGFuIHRoZSBibG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIGNvbnRyYWN0IGlzIGRlcGxveWVkLgogICAqIEBwYXJhbSBlbmQgQmxvY2sgbnVtYmVyIHdoZXJlIHRoZSBjcm93ZHNhbGUgZmluaXNoZXMuIE5vIHRva2VucyBjYW4gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QgYWZ0ZXIgdGhpcyBibG9jay4KICAgKiBAcGFyYW0gdG9rZW5fcmV0cmlldmVyIEFkZHJlc3MgdGhhdCB3aWxsIGhhbmRsZSB0b2tlbnMgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhlIHRva2VuIGNvbnRyYWN0LiBTZWUgdGhlIExvc3RBbmRGb3VuZFRva2VuIGFuZCBDcm93ZHNhbGVUb2tlbiBjb250cmFjdHMgZm9yIGZ1cnRoZXIgZGV0YWlscy4KICAgKiBAcGFyYW0gaW5pdF90cmFuY2hlcyBMaXN0IG9mIHNlcmlhbGl6ZWQgdHJhbmNoZXMuIFNlZSBjb25maWcuanMgYW5kIFRva2VuVHJhbmNoZVByaWNpbmcgZm9yIGZ1cnRoZXIgZGV0YWlscy4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGUoYWRkcmVzcyB0ZWFtX211bHRpc2lnLCB1aW50IHN0YXJ0LCB1aW50IGVuZCwgYWRkcmVzcyB0b2tlbl9yZXRyaWV2ZXIsIHVpbnRbXSBpbml0X3RyYW5jaGVzKQogIEdlbmVyaWNDcm93ZHNhbGUodGVhbV9tdWx0aXNpZywgc3RhcnQsIGVuZCkgVG9rZW5UcmFuY2hlUHJpY2luZyhpbml0X3RyYW5jaGVzKSBwdWJsaWMgewogICAgcmVxdWlyZShlbmQgPT0gdHJhbmNoZXNbdHJhbmNoZXMubGVuZ3RoLnN1YigxKV0uZW5kKTsKICAgIC8vIFRlc3RpbmcgdmFsdWVzCiAgICB0b2tlbiA9IG5ldyBDcm93ZHNhbGVUb2tlbih0b2tlbl9pbml0aWFsX3N1cHBseSwgdG9rZW5fZGVjaW1hbHMsIHRlYW1fbXVsdGlzaWcsIHRva2VuX21pbnRhYmxlLCB0b2tlbl9yZXRyaWV2ZXIpOwoKICAgIC8vIFNldCBwZXJtaXNzaW9ucyB0byBtaW50LCB0cmFuc2ZlciBhbmQgcmVsZWFzZQogICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIHRydWUpOwogICAgdG9rZW4uc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIHRva2VuLnNldFJlbGVhc2VBZ2VudChhZGRyZXNzKHRoaXMpKTsKCiAgICAvLyBUb2tlbnMgdG8gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QKICAgIHRva2VuLm1pbnQoYWRkcmVzcyh0aGlzKSwgc2VsbGFibGVfdG9rZW5zKTsKICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gbWludCBhbnltb3JlIGR1cmluZyB0aGUgbGlmZXRpbWUgb2YgdGhlIGNvbnRyYWN0LgogICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIGZhbHNlKTsKICB9CgogIC8vVG9rZW4gYXNzaWduYXRpb24gdGhyb3VnaCB0cmFuc2ZlcgogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBpbnRlcm5hbCB7CiAgICB0b2tlbi50cmFuc2ZlcihyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogIH0KCiAgLy9Ub2tlbiBhbW91bnQgY2FsY3VsYXRpb24KICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50IHdlaUFtb3VudCwgYWRkcmVzcykgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCB3ZWlBbGxvd2VkLCB1aW50IHRva2VuQW1vdW50KSB7CiAgICB1aW50IHRva2Vuc1BlcldlaSA9IGdldEN1cnJlbnRQcmljZSh0b2tlbnNTb2xkKTsKICAgIHVpbnQgbWF4QWxsb3dlZCA9IHNlbGxhYmxlX3Rva2Vucy5zdWIodG9rZW5zU29sZCkuZGl2KHRva2Vuc1BlcldlaSk7CiAgICB3ZWlBbGxvd2VkID0gbWF4QWxsb3dlZC5taW4yNTYod2VpQW1vdW50KTsKCiAgICBpZiAod2VpQW1vdW50IDwgbWF4QWxsb3dlZCkgewogICAgICB0b2tlbkFtb3VudCA9IHRva2Vuc1BlcldlaS5tdWwod2VpQW1vdW50KTsKICAgIH0KICAgIC8vIFdpdGggdGhpcyBjYXNlIHdlIGxldCB0aGUgY3Jvd2RzYWxlIGVuZCBldmVuIHdoZW4gdGhlcmUgYXJlIHJvdW5kaW5nIGVycm9ycyBkdWUgdG8gdGhlIHRva2VucyB0byB3ZWkgcmF0aW8KICAgIGVsc2UgewogICAgICB0b2tlbkFtb3VudCA9IHNlbGxhYmxlX3Rva2Vucy5zdWIodG9rZW5zU29sZCk7CiAgICB9CiAgfQoKICAvLyBJbXBsZW1lbnRzIHRoZSBjcml0ZXJpb24gb2YgdGhlIGZ1bmRpbmcgc3RhdGUKICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdG9rZW5zU29sZCA+PSBzZWxsYWJsZV90b2tlbnM7CiAgfQoKICAvKioKICAgKiBUaGlzIGZ1bmN0aW9uIGRlY2lkZXMgd2hvIGhhbmRsZXMgbG9zdCB0b2tlbnMuCiAgICogRG8gbm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgTk9UIG1lYW50IHRvIGJlIHVzZWQgaW4gYSB0b2tlbiByZWZ1bmQgbWVjaGFuaXNtLgogICAqIEl0cyBzb2xlIHB1cnBvc2UgaXMgZGV0ZXJtaW5pbmcgd2hvIGNhbiBtb3ZlIGFyb3VuZCBFUkMyMCB0b2tlbnMgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gb3duZXI7CiAgfQoKICAvLyBFeHRlbmRlZCB0byB0cmFuc2ZlciB1bnVzZWQgZnVuZHMgdG8gdGVhbSB0ZWFtX211bHRpc2lnIGFuZCByZWxlYXNlIHRoZSB0b2tlbgogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICB0b2tlbi5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogICAgdWludCB1bnNvbGRUb2tlbnMgPSB0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICB0b2tlbi50cmFuc2ZlcihtdWx0aXNpZ1dhbGxldCwgdW5zb2xkVG9rZW5zKTsKICAgIHN1cGVyLmZpbmFsaXplKCk7CiAgfQoKICAvL0NoYW5nZSB0aGUgdGhlIHN0YXJ0aW5nIHRpbWUgaW4gb3JkZXIgdG8gZW5kIHRoZSBwcmVzYWxlIHBlcmlvZCBlYXJseSBpZiBuZWVkZWQuCiAgZnVuY3Rpb24gc2V0U3RhcnRpbmdUaW1lKHVpbnQgc3RhcnRpbmdUaW1lKSBwdWJsaWMgb25seU93bmVyIGluU3RhdGUoU3RhdGUuUHJlRnVuZGluZykgewogICAgcmVxdWlyZShzdGFydGluZ1RpbWUgPiBibG9jay50aW1lc3RhbXAgJiYgc3RhcnRpbmdUaW1lIDwgZW5kc0F0KTsKICAgIHN0YXJ0c0F0ID0gc3RhcnRpbmdUaW1lOwogIH0KCiAgLy9DaGFuZ2UgdGhlIHRoZSBlbmRpbmcgdGltZSBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGZpbmFsaXplIHRoZSBjcm93ZHNhbGUgaWYgbmVlZGVkLgogIGZ1bmN0aW9uIHNldEVuZGluZ1RpbWUodWludCBlbmRpbmdUaW1lKSBwdWJsaWMgb25seU93bmVyIG5vdEZpbmlzaGVkIHsKICAgIHJlcXVpcmUoZW5kaW5nVGltZSA+IGJsb2NrLnRpbWVzdGFtcCAmJiBlbmRpbmdUaW1lID4gc3RhcnRzQXQpOwogICAgZW5kc0F0ID0gZW5kaW5nVGltZTsKICB9CgogIC8qKgogICAqIE92ZXJyaWRlIHRvIHJlamVjdCBjYWxscyB1bmxlc3MgdGhlIGNyb3dkc2FsZSBpcyBmaW5hbGl6ZWQgb3IKICAgKiAgdGhlIHRva2VuIGNvbnRyYWN0IGlzIG5vdCB0aGUgb25lIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBjcm93ZHNhbGUKICAgKi8KICBmdW5jdGlvbiBlbmFibGVMb3N0QW5kRm91bmQoYWRkcmVzcyBhZ2VudCwgdWludCB0b2tlbnMsIEVJUDIwVG9rZW4gdG9rZW5fY29udHJhY3QpIHB1YmxpYyB7CiAgICAvLyBFaXRoZXIgdGhlIHN0YXRlIGlzIGZpbmFsaXplZCBvciB0aGUgdG9rZW5fY29udHJhY3QgaXMgbm90IHRoaXMgY3Jvd2RzYWxlIHRva2VuCiAgICByZXF1aXJlKGFkZHJlc3ModG9rZW5fY29udHJhY3QpICE9IGFkZHJlc3ModG9rZW4pIHx8IGdldFN0YXRlKCkgPT0gU3RhdGUuRmluYWxpemVkKTsKICAgIHN1cGVyLmVuYWJsZUxvc3RBbmRGb3VuZChhZ2VudCwgdG9rZW5zLCB0b2tlbl9jb250cmFjdCk7CiAgfQp9'.
	

]
