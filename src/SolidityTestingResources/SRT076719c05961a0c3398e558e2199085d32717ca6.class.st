Class {
	#name : #SRT076719c05961a0c3398e558e2199085d32717ca6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT076719c05961a0c3398e558e2199085d32717ca6 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKgogIFBvbHltYXRoIGNvbXBsaWFuY2UgcHJvdG9jb2wgaXMgaW50ZW5kZWQgdG8gZW5zdXJlIHJlZ3VsYXRvcnkgY29tcGxpYW5jZQogIGluIHRoZSBqdXJpc2RpY3Rpb25zIHRoYXQgc2VjdXJpdHkgdG9rZW5zIGFyZSBiZWluZyBvZmZlcmVkIGluLiBUaGUgY29tcGxpYW5jZQogIHByb3RvY29sIGFsbG93cyBzZWN1cml0eSB0b2tlbnMgcmVtYWluIGludGVyb3BlcmFibGUgc28gdGhhdCBhbnlvbmUgY2FuCiAgYnVpbGQgb24gdG9wIG9mIHRoZSBQb2x5bWF0aCBwbGF0Zm9ybSBhbmQgZXh0ZW5kIGl0J3MgZnVuY3Rpb25hbGl0eS4KKi8KCmludGVyZmFjZSBJQ29tcGxpYW5jZSB7CgogICAgLyoqCiAgICAgKiBAZGV2IGBzZXRSZWdzaXRyYXJBZGRyZXNzYCBUaGlzIGZ1bmN0aW9uIHNldCB0aGUgU2VjdXJpdHlUb2tlblJlZ2lzdHJhciBjb250cmFjdCBhZGRyZXNzLiAKICAgICAqIEBwYXJhbSBfU1RSZWdpc3RyYXIgSXQgaXMgdGhlIGB0aGlzYCByZWZlcmVuY2Ugb2YgU1RSIGNvbnRyYWN0CiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwoKICAgIGZ1bmN0aW9uIHNldFJlZ3NpdHJhckFkZHJlc3MoYWRkcmVzcyBfU1RSZWdpc3RyYXIpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IGBjcmVhdGVUZW1wbGF0ZWAgaXMgYSBzaW1wbGUgZnVuY3Rpb24gdG8gY3JlYXRlIGEgbmV3IGNvbXBsaWFuY2UgdGVtcGxhdGUKICAgICAqIEBwYXJhbSBfb2ZmZXJpbmdUeXBlIFRoZSBuYW1lIG9mIHRoZSBzZWN1cml0eSBiZWluZyBpc3N1ZWQKICAgICAqIEBwYXJhbSBfaXNzdWVySnVyaXNkaWN0aW9uIFRoZSBqdXJpc2RpY3Rpb24gaWQgb2YgdGhlIGlzc3VlcgogICAgICogQHBhcmFtIF9hY2NyZWRpdGVkIEFjY3JlZGl0YXRpb24gc3RhdHVzIHJlcXVpcmVkIGZvciBpbnZlc3RvcnMKICAgICAqIEBwYXJhbSBfS1lDIEtZQyBwcm92aWRlciB1c2VkIGJ5IHRoZSB0ZW1wbGF0ZQogICAgICogQHBhcmFtIF9kZXRhaWxzIERldGFpbHMgb2YgdGhlIG9mZmVyaW5nIHJlcXVpcmVtZW50cwogICAgICogQHBhcmFtIF9leHBpcmVzIFRpbWVzdGFtcCBvZiB3aGVuIHRoZSB0ZW1wbGF0ZSB3aWxsIGV4cGlyZQogICAgICogQHBhcmFtIF9mZWUgQW1vdW50IG9mIFBPTFkgdG8gdXNlIHRoZSB0ZW1wbGF0ZSAoaGVsZCBpbiBlc2Nyb3cgdW50aWwgaXNzdWFuY2UpCiAgICAgKiBAcGFyYW0gX3F1b3J1bSBNaW5pbXVtIHBlcmNlbnQgb2Ygc2hhcmVob2xkZXJzIHdoaWNoIG5lZWQgdG8gdm90ZSB0byBmcmVlemUKICAgICAqIEBwYXJhbSBfdmVzdGluZ1BlcmlvZCBMZW5ndGggb2YgdGltZSB0byB2ZXN0IGZ1bmRzIAogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVUZW1wbGF0ZSgKICAgICAgICBzdHJpbmcgX29mZmVyaW5nVHlwZSwKICAgICAgICBieXRlczMyIF9pc3N1ZXJKdXJpc2RpY3Rpb24sCiAgICAgICAgYm9vbCBfYWNjcmVkaXRlZCwKICAgICAgICBhZGRyZXNzIF9LWUMsCiAgICAgICAgYnl0ZXMzMiBfZGV0YWlscywKICAgICAgICB1aW50MjU2IF9leHBpcmVzLAogICAgICAgIHVpbnQyNTYgX2ZlZSwKICAgICAgICB1aW50OCBfcXVvcnVtLAogICAgICAgIHVpbnQyNTYgX3Zlc3RpbmdQZXJpb2QKICAgICkgcHVibGljOwoKICAgLyoqCiAgICAgKiBAZGV2IFByb3Bvc2UgYSBiaWQgZm9yIGEgc2VjdXJpdHkgdG9rZW4gaXNzdWFuY2UKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlIFRoZSB1bmlxdWUgdGVtcGxhdGUgYWRkcmVzcwogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3Bvc2VUZW1wbGF0ZSgKICAgICAgICBhZGRyZXNzIF9zZWN1cml0eVRva2VuLAogICAgICAgIGFkZHJlc3MgX3RlbXBsYXRlCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBQcm9wb3NlIGEgU2VjdXJpdHkgVG9rZW4gT2ZmZXJpbmcgQ29udHJhY3QgZm9yIGFuIGlzc3VhbmNlCiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW4gVGhlIHNlY3VyaXR5IHRva2VuIGJlaW5nIGJpZCBvbgogICAgICogQHBhcmFtIF9zdG9Db250cmFjdCBUaGUgc2VjdXJpdHkgdG9rZW4gb2ZmZXJpbmcgY29udHJhY3QgYWRkcmVzcwogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3Bvc2VPZmZlcmluZ0NvbnRyYWN0KAogICAgICAgIGFkZHJlc3MgX3NlY3VyaXR5VG9rZW4sCiAgICAgICAgYWRkcmVzcyBfc3RvQ29udHJhY3QKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IENhbmNlbCBhIFRlbXBsYXRlIHByb3Bvc2FsIGlmIHRoZSBiaWQgaGFzbid0IGJlZW4gYWNjZXB0ZWQKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlUHJvcG9zYWxJbmRleCBUaGUgdGVtcGxhdGUgcHJvcG9zYWwgYXJyYXkgaW5kZXgKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzIAogICAgICovCiAgICBmdW5jdGlvbiBjYW5jZWxUZW1wbGF0ZVByb3Bvc2FsKAogICAgICAgIGFkZHJlc3MgX3NlY3VyaXR5VG9rZW4sCiAgICAgICAgdWludDI1NiBfdGVtcGxhdGVQcm9wb3NhbEluZGV4CiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBTZXQgdGhlIFNUTyBjb250cmFjdCBieSB0aGUgaXNzdWVyLgogICAgICogQHBhcmFtIF9TVE9BZGRyZXNzIGFkZHJlc3Mgb2YgdGhlIFNUTyBjb250cmFjdCBkZXBsb3llZCBvdmVyIHRoZSBuZXR3b3JrLgogICAgICogQHBhcmFtIF9mZWUgZmVlIHRvIGJlIHBhaWQgaW4gcG9seSB0byB1c2UgdGhhdCBjb250cmFjdAogICAgICogQHBhcmFtIF92ZXN0aW5nUGVyaW9kIG5vLiBvZiBkYXlzIGludmVzdG9yIGJpbmRlZCB0byBob2xkIHRoZSBTZWN1cml0eSB0b2tlbgogICAgICogQHBhcmFtIF9xdW9ydW0gTWluaW11bSBwZXJjZW50IG9mIHNoYXJlaG9sZGVycyB3aGljaCBuZWVkIHRvIHZvdGUgdG8gZnJlZXplCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFNUTyAoCiAgICAgICAgYWRkcmVzcyBfU1RPQWRkcmVzcywKICAgICAgICB1aW50MjU2IF9mZWUsCiAgICAgICAgdWludDI1NiBfdmVzdGluZ1BlcmlvZCwKICAgICAgICB1aW50OCBfcXVvcnVtCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBDYW5jZWwgYSBTVE8gY29udHJhY3QgcHJvcG9zYWwgaWYgdGhlIGJpZCBoYXNuJ3QgYmVlbiBhY2NlcHRlZAogICAgICogQHBhcmFtIF9zZWN1cml0eVRva2VuIFRoZSBzZWN1cml0eSB0b2tlbiBiZWluZyBiaWQgb24KICAgICAqIEBwYXJhbSBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4IFRoZSBvZmZlcmluZyBwcm9wb3NhbCBhcnJheSBpbmRleAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbmNlbE9mZmVyaW5nUHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfc2VjdXJpdHlUb2tlbiwKICAgICAgICB1aW50MjU2IF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IGB1cGRhdGVUZW1wbGF0ZVJlcHV0YXRpb25gIGlzIGEgY29uc3RhbnQgZnVuY3Rpb24gdGhhdCB1cGRhdGVzIHRoZQogICAgICAgaGlzdG9yeSBvZiBhIHNlY3VyaXR5IHRva2VuIHRlbXBsYXRlIHVzYWdlIHRvIGtlZXAgdHJhY2sgb2YgcHJldmlvdXMgdXNlcwogICAgICogQHBhcmFtIF90ZW1wbGF0ZSBUaGUgdW5pcXVlIHRlbXBsYXRlIGlkCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlSW5kZXggVGhlIGFycmF5IGluZGV4IG9mIHRoZSB0ZW1wbGF0ZSBwcm9wb3NhbCAKICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlVGVtcGxhdGVSZXB1dGF0aW9uIChhZGRyZXNzIF90ZW1wbGF0ZSwgdWludDggX3RlbXBsYXRlSW5kZXgpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IGB1cGRhdGVPZmZlcmluZ1JlcHV0YXRpb25gIGlzIGEgY29uc3RhbnQgZnVuY3Rpb24gdGhhdCB1cGRhdGVzIHRoZQogICAgICAgaGlzdG9yeSBvZiBhIHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nIGNvbnRyYWN0IHRvIGtlZXAgdHJhY2sgb2YgcHJldmlvdXMgdXNlcwogICAgICogQHBhcmFtIF9zdG9Db250cmFjdCBUaGUgc21hcnQgY29udHJhY3QgYWRkcmVzcyBvZiB0aGUgU1RPIGNvbnRyYWN0CiAgICAgKiBAcGFyYW0gX29mZmVyaW5nUHJvcG9zYWxJbmRleCBUaGUgYXJyYXkgaW5kZXggb2YgdGhlIHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nIHByb3Bvc2FsIAogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVPZmZlcmluZ1JlcHV0YXRpb24gKGFkZHJlc3MgX3N0b0NvbnRyYWN0LCB1aW50OCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBHZXQgdGVtcGxhdGUgZGV0YWlscyBieSB0aGUgcHJvcG9zYWwgaW5kZXgKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbkFkZHJlc3MgVGhlIHNlY3VyaXR5IHRva2VuIGV0aGVyZXVtIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfdGVtcGxhdGVJbmRleCBUaGUgYXJyYXkgaW5kZXggb2YgdGhlIHRlbXBsYXRlIGJlaW5nIGNoZWNrZWQKICAgICAqIEByZXR1cm4gVGVtcGxhdGUgc3RydWN0IAogICAgICovCiAgICBmdW5jdGlvbiBnZXRUZW1wbGF0ZUJ5UHJvcG9zYWwoYWRkcmVzcyBfc2VjdXJpdHlUb2tlbkFkZHJlc3MsIHVpbnQ4IF90ZW1wbGF0ZUluZGV4KSB2aWV3IHB1YmxpYyByZXR1cm5zICgKICAgICAgICBhZGRyZXNzIF90ZW1wbGF0ZQogICAgKTsKCiAgICAvKiogCiAgICAgKiBAZGV2IEdldCBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBzbWFydCBjb250cmFjdCBkZXRhaWxzIGJ5IHRoZSBwcm9wb3NhbCBpbmRleAogICAgICogQHBhcmFtIF9zZWN1cml0eVRva2VuQWRkcmVzcyBUaGUgc2VjdXJpdHkgdG9rZW4gZXRoZXJldW0gYWRkcmVzcwogICAgICogQHBhcmFtIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXggVGhlIGFycmF5IGluZGV4IG9mIHRoZSBTVE8gY29udHJhY3QgYmVpbmcgY2hlY2tlZAogICAgICogQHJldHVybiBDb250cmFjdCBzdHJ1Y3QgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE9mZmVyaW5nQnlQcm9wb3NhbChhZGRyZXNzIF9zZWN1cml0eVRva2VuQWRkcmVzcywgdWludDggX29mZmVyaW5nUHJvcG9zYWxJbmRleCkgdmlldyBwdWJsaWMgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBzdG9Db250cmFjdCwKICAgICAgICBhZGRyZXNzIGF1ZGl0b3IsCiAgICAgICAgdWludDI1NiB2ZXN0aW5nUGVyaW9kLAogICAgICAgIHVpbnQ4IHF1b3J1bSwKICAgICAgICB1aW50MjU2IGZlZQogICAgKTsKfQoKLy8vIEVSQyBUb2tlbiBTdGFuZGFyZCAjMjAgSW50ZXJmYWNlIChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZCkKaW50ZXJmYWNlIElFUkMyMCB7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKaW50ZXJmYWNlIElDdXN0b21lcnMgewoKICAvKioKICAgKiBAZGV2IEFsbG93IG5ldyBwcm92aWRlciBhcHBsaWNhdGlvbnMKICAgKiBAcGFyYW0gX3Byb3ZpZGVyQWRkcmVzcyBUaGUgcHJvdmlkZXIncyBwdWJsaWMga2V5IGFkZHJlc3MKICAgKiBAcGFyYW0gX25hbWUgVGhlIHByb3ZpZGVyJ3MgbmFtZQogICAqIEBwYXJhbSBfZGV0YWlscyBBIFNIQTI1NiBoYXNoIG9mIHRoZSBuZXcgcHJvdmlkZXJzIGRldGFpbHMKICAgKiBAcGFyYW0gX2ZlZSBUaGUgZmVlIGNoYXJnZWQgZm9yIGN1c3RvbWVyIHZlcmlmaWNhdGlvbgogICAqLwogIGZ1bmN0aW9uIG5ld1Byb3ZpZGVyKGFkZHJlc3MgX3Byb3ZpZGVyQWRkcmVzcywgc3RyaW5nIF9uYW1lLCBieXRlczMyIF9kZXRhaWxzLCB1aW50MjU2IF9mZWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAvKioKICAgKiBAZGV2IENoYW5nZSBhIHByb3ZpZGVycyBmZWUKICAgKiBAcGFyYW0gX25ld0ZlZSBUaGUgbmV3IGZlZSBvZiB0aGUgcHJvdmlkZXIKICAgKi8KICBmdW5jdGlvbiBjaGFuZ2VGZWUodWludDI1NiBfbmV3RmVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgLyoqCiAgICogQGRldiBWZXJpZnkgYW4gaW52ZXN0b3IKICAgKiBAcGFyYW0gX2N1c3RvbWVyIFRoZSBjdXN0b21lcidzIHB1YmxpYyBrZXkgYWRkcmVzcwogICAqIEBwYXJhbSBfY291bnRyeUp1cmlzZGljdGlvbiBUaGUgY291bnRyeSB1cmlzZGljdGlvbiBjb2RlIG9mIHRoZSBjdXN0b21lcgogICAqIEBwYXJhbSBfZGl2aXNpb25KdXJpc2RpY3Rpb24gVGhlIHN1YmRpdmlzaW9uIGp1cmlzZGljdGlvbiBjb2RlIG9mIHRoZSBjdXN0b21lcgogICAqIEBwYXJhbSBfcm9sZSBUaGUgdHlwZSBvZiBjdXN0b21lciAtIGludmVzdG9yOjEsIGRlbGVnYXRlOjIsIGlzc3VlcjozLCBtYXJrZXRtYWtlcjo0LCBldGMuCiAgICogQHBhcmFtIF9hY2NyZWRpdGVkIFdoZXRoZXIgdGhlIGN1c3RvbWVyIGlzIGFjY3JlZGl0ZWQgb3Igbm90IChvbmx5IGFwcGxpZWQgdG8gaW52ZXN0b3JzKQogICAqIEBwYXJhbSBfZXhwaXJlcyBUaGUgdGltZSB0aGUgdmVyaWZpY2F0aW9uIGV4cGlyZXMKICAgKi8KICBmdW5jdGlvbiB2ZXJpZnlDdXN0b21lcigKICAgIGFkZHJlc3MgX2N1c3RvbWVyLAogICAgYnl0ZXMzMiBfY291bnRyeUp1cmlzZGljdGlvbiwKICAgIGJ5dGVzMzIgX2RpdmlzaW9uSnVyaXNkaWN0aW9uLAogICAgdWludDggX3JvbGUsCiAgICBib29sIF9hY2NyZWRpdGVkLAogICAgdWludDI1NiBfZXhwaXJlcwogICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAvLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gR0VUIEZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vCgogIC8qKgogICAgKiBAZGV2IEdldCBjdXN0b21lciBhdHRlc3RhdGlvbiBkYXRhIGJ5IEtZQyBwcm92aWRlciBhbmQgY3VzdG9tZXIgZXRoZXJldW0gYWRkcmVzcwogICAgKiBAcGFyYW0gX3Byb3ZpZGVyIEFkZHJlc3Mgb2YgdGhlIEtZQyBwcm92aWRlci4KICAgICogQHBhcmFtIF9jdXN0b21lciBBZGRyZXNzIG9mIHRoZSBjdXN0b21lciBldGhlcmV1bSBhZGRyZXNzCiAgICAqLwogIGZ1bmN0aW9uIGdldEN1c3RvbWVyKGFkZHJlc3MgX3Byb3ZpZGVyLCBhZGRyZXNzIF9jdXN0b21lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKAogICAgYnl0ZXMzMiwKICAgIGJ5dGVzMzIsCiAgICBib29sLAogICAgdWludDgsCiAgICBib29sLAogICAgdWludDI1NgogICk7CgogIC8qKgogICAqIEdldCBwcm92aWRlciBkZXRhaWxzIGFuZCBmZWUgYnkgZXRoZXJldW0gYWRkcmVzcwogICAqIEBwYXJhbSBfcHJvdmlkZXJBZGRyZXNzIEFkZHJlc3Mgb2YgdGhlIEtZQyBwcm92aWRlcgogICAqLwogIGZ1bmN0aW9uIGdldFByb3ZpZGVyKGFkZHJlc3MgX3Byb3ZpZGVyQWRkcmVzcykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKAogICAgc3RyaW5nIG5hbWUsCiAgICB1aW50MjU2IGpvaW5lZCwKICAgIGJ5dGVzMzIgZGV0YWlscywKICAgIHVpbnQyNTYgZmVlCiAgKTsKfQoKLyoKICBQb2x5bWF0aCBjdXN0b21lciByZWdpc3RyeSBpcyB1c2VkIHRvIGVuc3VyZSByZWd1bGF0b3J5IGNvbXBsaWFuY2UKICBvZiB0aGUgaW52ZXN0b3JzLCBwcm92aWRlciwgYW5kIGlzc3VlcnMuIFRoZSBjdXN0b21lcnMgcmVnaXN0cnkgaXMgYSBjZW50cmFsCiAgcGxhY2Ugd2hlcmUgZXRoZXJldW0gYWRkcmVzc2VzIGNhbiBiZSB3aGl0ZWxpc3RlZCB0byBwdXJjaGFzZSBjZXJ0YWluIHNlY3VyaXR5CiAgdG9rZW5zIGJhc2VkIG9uIHRoZWlyIHZlcmlmaWNhdGlvbnMgYnkgcHJvdmlkZXJzLgoqLwoKCgoKLyoqCiAqIEB0aXRsZSBDdXN0b21lcnMKICogQGRldiBDb250cmFjdCB1c2UgdG8gcmVnaXN0ZXIgdGhlIHVzZXIgb24gdGhlIFBsYXRmb3JtIHBsYXRmb3JtCiAqLwoKY29udHJhY3QgQ3VzdG9tZXJzIGlzIElDdXN0b21lcnMgewoKICAgIHN0cmluZyBwdWJsaWMgVkVSU0lPTiA9ICIxIjsKCiAgICBJRVJDMjAgUE9MWTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEluc3RhbmNlIG9mIHRoZSBQT0xZIHRva2VuCgogICAgc3RydWN0IEN1c3RvbWVyIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdHJ1Y3R1cmUgdXNlIHRvIHN0b3JlIHRoZSBkZXRhaWxzIG9mIHRoZSBjdXN0b21lcnMKICAgICAgICBieXRlczMyIGNvdW50cnlKdXJpc2RpY3Rpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3VzdG9tZXJzIGNvdW50cnkganVyaXNkaWN0aW9uIGFzIGV4IC0gSVNPMzE2NgogICAgICAgIGJ5dGVzMzIgZGl2aXNpb25KdXJpc2RpY3Rpb247ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDdXN0b21lcnMgc3ViLWRpdmlzaW9uIGp1cmlzZGljdGlvbiBhcyBleCAtIElTTzMxNjYKICAgICAgICB1aW50MjU2IGpvaW5lZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gY3VzdG9tZXIgcmVnaXN0ZXIKICAgICAgICB1aW50OCByb2xlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcm9sZSBvZiB0aGUgY3VzdG9tZXIKICAgICAgICBib29sIHZlcmlmaWVkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQm9vbGVhbiB2YXJpYWJsZSB0byBjaGVjayB0aGUgc3RhdHVzIG9mIHRoZSBjdXN0b21lciB3aGV0aGVyIGl0IGlzIHZlcmlmaWVkIG9yIG5vdAogICAgICAgIGJvb2wgYWNjcmVkaXRlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBY2NyZWRpYXRpb24gc3RhdHVzIG9mIHRoZSBjdXN0b21lcgogICAgICAgIGJ5dGVzMzIgcHJvb2Y7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9vZiBmb3IgY3VzdG9tZXIKICAgICAgICB1aW50MjU2IGV4cGlyZXM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gY3VzdG9tZXIgdmVyaWZpY2F0aW9uIGV4cGlyZXMKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IEN1c3RvbWVyKSkgcHVibGljIGN1c3RvbWVyczsgIC8vIEN1c3RvbWVycyAoa3ljIHByb3ZpZGVyIGFkZHJlc3MgPT4gY3VzdG9tZXIgYWRkcmVzcykKCiAgICBzdHJ1Y3QgUHJvdmlkZXIgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtZQy9BY2NyZWRpdGF0aW9uIFByb3ZpZGVyCiAgICAgICAgc3RyaW5nIG5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5hbWUgb2YgdGhlIHByb3ZpZGVyCiAgICAgICAgdWludDI1NiBqb2luZWQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRpbWVzdGFtcCB3aGVuIHByb3ZpZGVyIHJlZ2lzdGVyCiAgICAgICAgYnl0ZXMzMiBkZXRhaWxzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERldGFpbHMgb2YgcHJvdmlkZXIKICAgICAgICB1aW50MjU2IGZlZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmVlIGNoYXJnZWQgYnkgdGhlIEtZQyBwcm92aWRlcnMKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gUHJvdmlkZXIpIHB1YmxpYyBwcm92aWRlcnM7ICAgICAgICAgICAgICAgICAgICAgIC8vIEtZQy9BY2NyZWRpdGF0aW9uIFByb3ZpZGVycwoKICAgIC8vIE5vdGlmaWNhdGlvbnMKICAgIGV2ZW50IExvZ05ld1Byb3ZpZGVyKGFkZHJlc3MgcHJvdmlkZXJBZGRyZXNzLCBzdHJpbmcgbmFtZSwgYnl0ZXMzMiBkZXRhaWxzKTsKICAgIGV2ZW50IExvZ0N1c3RvbWVyVmVyaWZpZWQoYWRkcmVzcyBjdXN0b21lciwgYWRkcmVzcyBwcm92aWRlciwgdWludDggcm9sZSk7CgogICAgLy8gTW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlQcm92aWRlcigpIHsKICAgICAgICByZXF1aXJlKHByb3ZpZGVyc1ttc2cuc2VuZGVyXS5kZXRhaWxzICE9IDB4MCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ29uc3RydWN0b3IKICAgICAqLwogICAgZnVuY3Rpb24gQ3VzdG9tZXJzKGFkZHJlc3MgX3BvbHlUb2tlbkFkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgUE9MWSA9IElFUkMyMChfcG9seVRva2VuQWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93IG5ldyBwcm92aWRlciBhcHBsaWNhdGlvbnMKICAgICAqIEBwYXJhbSBfcHJvdmlkZXJBZGRyZXNzIFRoZSBwcm92aWRlcidzIHB1YmxpYyBrZXkgYWRkcmVzcwogICAgICogQHBhcmFtIF9uYW1lIFRoZSBwcm92aWRlcidzIG5hbWUKICAgICAqIEBwYXJhbSBfZGV0YWlscyBBIFNIQTI1NiBoYXNoIG9mIHRoZSBuZXcgcHJvdmlkZXJzIGRldGFpbHMKICAgICAqIEBwYXJhbSBfZmVlIFRoZSBmZWUgY2hhcmdlZCBmb3IgY3VzdG9tZXIgdmVyaWZpY2F0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5ld1Byb3ZpZGVyKGFkZHJlc3MgX3Byb3ZpZGVyQWRkcmVzcywgc3RyaW5nIF9uYW1lLCBieXRlczMyIF9kZXRhaWxzLCB1aW50MjU2IF9mZWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF9wcm92aWRlckFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfZGV0YWlscyAhPSAweDApOwogICAgICAgIHJlcXVpcmUocHJvdmlkZXJzW19wcm92aWRlckFkZHJlc3NdLmRldGFpbHMgPT0gMHgwKTsKICAgICAgICBwcm92aWRlcnNbX3Byb3ZpZGVyQWRkcmVzc10gPSBQcm92aWRlcihfbmFtZSwgbm93LCBfZGV0YWlscywgX2ZlZSk7CiAgICAgICAgTG9nTmV3UHJvdmlkZXIoX3Byb3ZpZGVyQWRkcmVzcywgX25hbWUsIF9kZXRhaWxzKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2hhbmdlIGEgcHJvdmlkZXJzIGZlZQogICAgICogQHBhcmFtIF9uZXdGZWUgVGhlIG5ldyBmZWUgb2YgdGhlIHByb3ZpZGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZUZlZSh1aW50MjU2IF9uZXdGZWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHByb3ZpZGVyc1ttc2cuc2VuZGVyXS5kZXRhaWxzICE9IDB4MCk7CiAgICAgICAgcHJvdmlkZXJzW21zZy5zZW5kZXJdLmZlZSA9IF9uZXdGZWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFZlcmlmeSBhbiBpbnZlc3RvcgogICAgICogQHBhcmFtIF9jdXN0b21lciBUaGUgY3VzdG9tZXIncyBwdWJsaWMga2V5IGFkZHJlc3MKICAgICAqIEBwYXJhbSBfY291bnRyeUp1cmlzZGljdGlvbiBUaGUganVyaXNkaWN0aW9uIGNvdW50cnkgY29kZSBvZiB0aGUgY3VzdG9tZXIKICAgICAqIEBwYXJhbSBfZGl2aXNpb25KdXJpc2RpY3Rpb24gVGhlIGp1cmlzZGljdGlvbiBzdWJkaXZpc2lvbiBjb2RlIG9mIHRoZSBjdXN0b21lcgogICAgICogQHBhcmFtIF9yb2xlIFRoZSB0eXBlIG9mIGN1c3RvbWVyIC0gaW52ZXN0b3I6MSwgZGVsZWdhdGU6MiwgaXNzdWVyOjMsIG1hcmtldG1ha2VyOjQsIGV0Yy4KICAgICAqIEBwYXJhbSBfYWNjcmVkaXRlZCBXaGV0aGVyIHRoZSBjdXN0b21lciBpcyBhY2NyZWRpdGVkIG9yIG5vdCAob25seSBhcHBsaWVkIHRvIGludmVzdG9ycykKICAgICAqIEBwYXJhbSBfZXhwaXJlcyBUaGUgdGltZSB0aGUgdmVyaWZpY2F0aW9uIGV4cGlyZXMKICAgICAqLwogICAgZnVuY3Rpb24gdmVyaWZ5Q3VzdG9tZXIoCiAgICAgICAgYWRkcmVzcyBfY3VzdG9tZXIsCiAgICAgICAgYnl0ZXMzMiBfY291bnRyeUp1cmlzZGljdGlvbiwKICAgICAgICBieXRlczMyIF9kaXZpc2lvbkp1cmlzZGljdGlvbiwKICAgICAgICB1aW50OCBfcm9sZSwKICAgICAgICBib29sIF9hY2NyZWRpdGVkLAogICAgICAgIHVpbnQyNTYgX2V4cGlyZXMKICAgICkgcHVibGljIG9ubHlQcm92aWRlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZShfZXhwaXJlcyA+IG5vdyk7CiAgICAgICAgcmVxdWlyZShQT0xZLnRyYW5zZmVyRnJvbShfY3VzdG9tZXIsIG1zZy5zZW5kZXIsIHByb3ZpZGVyc1ttc2cuc2VuZGVyXS5mZWUpKTsKICAgICAgICBjdXN0b21lcnNbbXNnLnNlbmRlcl1bX2N1c3RvbWVyXS5jb3VudHJ5SnVyaXNkaWN0aW9uID0gX2NvdW50cnlKdXJpc2RpY3Rpb247CiAgICAgICAgY3VzdG9tZXJzW21zZy5zZW5kZXJdW19jdXN0b21lcl0uZGl2aXNpb25KdXJpc2RpY3Rpb24gPSBfZGl2aXNpb25KdXJpc2RpY3Rpb247CiAgICAgICAgY3VzdG9tZXJzW21zZy5zZW5kZXJdW19jdXN0b21lcl0ucm9sZSA9IF9yb2xlOwogICAgICAgIGN1c3RvbWVyc1ttc2cuc2VuZGVyXVtfY3VzdG9tZXJdLmFjY3JlZGl0ZWQgPSBfYWNjcmVkaXRlZDsKICAgICAgICBjdXN0b21lcnNbbXNnLnNlbmRlcl1bX2N1c3RvbWVyXS5leHBpcmVzID0gX2V4cGlyZXM7CiAgICAgICAgY3VzdG9tZXJzW21zZy5zZW5kZXJdW19jdXN0b21lcl0udmVyaWZpZWQgPSB0cnVlOwogICAgICAgIExvZ0N1c3RvbWVyVmVyaWZpZWQoX2N1c3RvbWVyLCBtc2cuc2VuZGVyLCBfcm9sZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEdFVCBGdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8qKgogICAgICogQGRldiBHZXQgY3VzdG9tZXIgYXR0ZXN0YXRpb24gZGF0YSBieSBLWUMgcHJvdmlkZXIgYW5kIGN1c3RvbWVyIGV0aGVyZXVtIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfcHJvdmlkZXIgQWRkcmVzcyBvZiB0aGUgS1lDIHByb3ZpZGVyLgogICAgICogQHBhcmFtIF9jdXN0b21lciBBZGRyZXNzIG9mIHRoZSBjdXN0b21lciBldGhlcmV1bSBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEN1c3RvbWVyKGFkZHJlc3MgX3Byb3ZpZGVyLCBhZGRyZXNzIF9jdXN0b21lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKAogICAgICAgIGJ5dGVzMzIsCiAgICAgICAgYnl0ZXMzMiwKICAgICAgICBib29sLAogICAgICAgIHVpbnQ4LAogICAgICAgIGJvb2wsCiAgICAgICAgdWludDI1NgogICAgKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgY3VzdG9tZXJzW19wcm92aWRlcl1bX2N1c3RvbWVyXS5jb3VudHJ5SnVyaXNkaWN0aW9uLAogICAgICAgIGN1c3RvbWVyc1tfcHJvdmlkZXJdW19jdXN0b21lcl0uZGl2aXNpb25KdXJpc2RpY3Rpb24sCiAgICAgICAgY3VzdG9tZXJzW19wcm92aWRlcl1bX2N1c3RvbWVyXS5hY2NyZWRpdGVkLAogICAgICAgIGN1c3RvbWVyc1tfcHJvdmlkZXJdW19jdXN0b21lcl0ucm9sZSwKICAgICAgICBjdXN0b21lcnNbX3Byb3ZpZGVyXVtfY3VzdG9tZXJdLnZlcmlmaWVkLAogICAgICAgIGN1c3RvbWVyc1tfcHJvdmlkZXJdW19jdXN0b21lcl0uZXhwaXJlcwogICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHByb3ZpZGVyIGRldGFpbHMgYW5kIGZlZSBieSBldGhlcmV1bSBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX3Byb3ZpZGVyQWRkcmVzcyBBZGRyZXNzIG9mIHRoZSBLWUMgcHJvdmlkZXIKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UHJvdmlkZXIoYWRkcmVzcyBfcHJvdmlkZXJBZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgdWludDI1NiBqb2luZWQsCiAgICAgICAgYnl0ZXMzMiBkZXRhaWxzLAogICAgICAgIHVpbnQyNTYgZmVlCiAgICApIHsKICAgICAgcmV0dXJuICgKICAgICAgICBwcm92aWRlcnNbX3Byb3ZpZGVyQWRkcmVzc10ubmFtZSwKICAgICAgICBwcm92aWRlcnNbX3Byb3ZpZGVyQWRkcmVzc10uam9pbmVkLAogICAgICAgIHByb3ZpZGVyc1tfcHJvdmlkZXJBZGRyZXNzXS5kZXRhaWxzLAogICAgICAgIHByb3ZpZGVyc1tfcHJvdmlkZXJBZGRyZXNzXS5mZWUKICAgICAgKTsKICAgIH0KCn0KCmludGVyZmFjZSBJVGVtcGxhdGUgewoKICAvKioKICAgKiBAZGV2IGBhZGRKdXJpc2RpY3Rpb25gIGFsbG93cyB0aGUgYWRkaW5nIG9mIG5ldyBqdXJpc2RpY3Rpb25zIHRvIGEgdGVtcGxhdGUKICAgKiBAcGFyYW0gX2FsbG93ZWRKdXJpc2RpY3Rpb25zIEFuIGFycmF5IG9mIGp1cmlzZGljdGlvbnMKICAgKiBAcGFyYW0gX2FsbG93ZWQgQW4gYXJyYXkgb2Ygd2hldGhlciB0aGUganVyaXNkaWN0aW9uIGlzIGFsbG93ZWQgdG8gcHVyY2hhc2UgdGhlIHNlY3VyaXR5IG9yIG5vdAogICAqLwogIGZ1bmN0aW9uIGFkZEp1cmlzZGljdGlvbihieXRlczMyW10gX2FsbG93ZWRKdXJpc2RpY3Rpb25zLCBib29sW10gX2FsbG93ZWQpIHB1YmxpYzsKCiAgLyoqCiAgICogQGRldiBgYWRkRGl2aXNpb25KdXJpc2RpY3Rpb25gIGFsbG93cyB0aGUgYWRkaW5nIG9mIG5ldyBqdXJpc2RpY3Rpb25zIHRvIGEgdGVtcGxhdGUKICAgKiBAcGFyYW0gX2Jsb2NrZWREaXZpc2lvbkp1cmlzZGljdGlvbnMgQW4gYXJyYXkgb2YganVyaXNkaWN0aW9ucwogICAqIEBwYXJhbSBfYmxvY2tlZCBBbiBhcnJheSBvZiB3aGV0aGVyIHRoZSBqdXJpc2RpY3Rpb24gaXMgYWxsb3dlZCB0byBwdXJjaGFzZSB0aGUgc2VjdXJpdHkgb3Igbm90CiAgICovCiAgZnVuY3Rpb24gYWRkRGl2aXNpb25KdXJpc2RpY3Rpb24oYnl0ZXMzMltdIF9ibG9ja2VkRGl2aXNpb25KdXJpc2RpY3Rpb25zLCBib29sW10gX2Jsb2NrZWQpIHB1YmxpYzsKCiAgLyoqCiAgICogQGRldiBgYWRkUm9sZWAgYWxsb3dzIHRoZSBhZGRpbmcgb2YgbmV3IHJvbGVzIHRvIGJlIGFkZGVkIHRvIHdoaXRlbGlzdAogICAqIEBwYXJhbSBfYWxsb3dlZFJvbGVzIFVzZXIgcm9sZXMgdGhhdCBjYW4gcHVyY2hhc2UgdGhlIHNlY3VyaXR5CiAgICovCiAgZnVuY3Rpb24gYWRkUm9sZXModWludDhbXSBfYWxsb3dlZFJvbGVzKSBwdWJsaWM7CgogIC8qKgogICAqIEBub3RpY2UgYHVwZGF0ZURldGFpbHNgCiAgICogQHBhcmFtIF9kZXRhaWxzIGRldGFpbHMgb2YgdGhlIHRlbXBsYXRlIG5lZWQgdG8gY2hhbmdlCiAgICogQHJldHVybiBhbGxvd2VkIGJvb2xlYW4gdmFyaWFibGUKICAgKi8KICBmdW5jdGlvbiB1cGRhdGVEZXRhaWxzKGJ5dGVzMzIgX2RldGFpbHMpIHB1YmxpYyByZXR1cm5zIChib29sIGFsbG93ZWQpOwoKICAvKioKICAgKiBAZGV2IGBmaW5hbGl6ZVRlbXBsYXRlYCBpcyB1c2VkIHRvIGZpbmFsaXplIHRlbXBsYXRlLmZ1bGwgY29tcGxpYW5jZSBwcm9jZXNzL3JlcXVpcmVtZW50cwogICAqIEByZXR1cm4gc3VjY2VzcwogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplVGVtcGxhdGUoKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgLyoqCiAgICogQGRldiBgY2hlY2tUZW1wbGF0ZVJlcXVpcmVtZW50c2AgaXMgYSBjb25zdGFudCBmdW5jdGlvbiB0aGF0IGNoZWNrcyBpZiB0ZW1wbGF0ZXMgcmVxdWlyZW1lbnRzIGFyZSBtZXQKICAgKiBAcGFyYW0gX2NvdW50cnlKdXJpc2RpY3Rpb24gVGhlIElTTy0zMTY2IGNvZGUgb2YgdGhlIGludmVzdG9ycyBjb3VudHJ5IGp1cmlzZGljdGlvbgogICAqIEBwYXJhbSBfZGl2aXNpb25KdXJpc2RpY3Rpb24gVGhlIElTTy0zMTY2IGNvZGUgb2YgdGhlIGludmVzdG9ycyBzdWJkaXZpc2lvbiBqdXJpc2RpY3Rpb24KICAgKiBAcGFyYW0gX2FjY3JlZGl0ZWQgV2hldGhlciB0aGUgaW52ZXN0b3IgaXMgYWNjcmVkaXRlZCBvciBub3QKICAgKiBAcGFyYW0gX3JvbGUgcm9sZSBvZiB0aGUgdXNlcgogICAqIEByZXR1cm4gYWxsb3dlZCBib29sZWFuIHZhcmlhYmxlCiAgICovCiAgZnVuY3Rpb24gY2hlY2tUZW1wbGF0ZVJlcXVpcmVtZW50cygKICAgICAgYnl0ZXMzMiBfY291bnRyeUp1cmlzZGljdGlvbiwKICAgICAgYnl0ZXMzMiBfZGl2aXNpb25KdXJpc2RpY3Rpb24sCiAgICAgIGJvb2wgX2FjY3JlZGl0ZWQsCiAgICAgIHVpbnQ4IF9yb2xlCiAgKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBhbGxvd2VkKTsKCiAgLyoqCiAgICogQGRldiBnZXRUZW1wbGF0ZURldGFpbHMgaXMgYSBjb25zdGFudCBmdW5jdGlvbiB0aGF0IGdldHMgdGVtcGxhdGUgZGV0YWlscwogICAqIEByZXR1cm4gYnl0ZXMzMiBkZXRhaWxzLCBib29sIGZpbmFsaXplZAogICAqLwogIGZ1bmN0aW9uIGdldFRlbXBsYXRlRGV0YWlscygpIHZpZXcgcHVibGljIHJldHVybnMgKGJ5dGVzMzIsIGJvb2wpOwoKICAvKioKICAgKiBAZGV2IGBnZXRVc2FnZUZlZXNgIGlzIGEgZnVuY3Rpb24gdG8gZ2V0IGFsbCB0aGUgZGV0YWlscyBvbiB0ZW1wbGF0ZSB1c2FnZSBmZWVzCiAgICogQHJldHVybiB1aW50MjU2IGZlZSwgdWludDggcXVvcnVtLCB1aW50MjU2IHZlc3RpbmdQZXJpb2QsIGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgS1lDCiAgICovCiAgZnVuY3Rpb24gZ2V0VXNhZ2VEZXRhaWxzKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiwgdWludDgsIHVpbnQyNTYsIGFkZHJlc3MsIGFkZHJlc3MpOwp9CgovKgogIFBvbHltYXRoIGNvbXBsaWFuY2UgdGVtcGxhdGUgaXMgaW50ZW5kZWQgdG8gZW5zdXJlIHJlZ3VsYXRvcnkgY29tcGxpYW5jZQogIGluIHRoZSBqdXJpc2RpY3Rpb25zIHRoYXQgc2VjdXJpdHkgdG9rZW5zIGFyZSBiZWluZyBvZmZlcmVkIGluLiBUaGUgY29tcGxpYW5jZQogIHRlbXBsYXRlIGFsbG93cyBzZWN1cml0eSB0b2tlbnMgdG8gZW5mb3JjZSBwdXJjaGFzZSByZXN0cmljdGlvbnMgb24gY2hhaW4gYW5kCiAga2VlcCBhIGxvZyBvZiBkb2N1bWVudHMgZm9yIGZ1dHVyZSBhdWRpdGluZyBwdXJwb3Nlcy4KKi8KCgoKLyoqCiAqIEB0aXRsZSBUZW1wbGF0ZQogKiBAZGV2ICBUZW1wbGF0ZSBkZXRhaWxzIHVzZWQgZm9yIHRoZSBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyB0byBlbnN1cmUgdGhlIHJlZ3VsYXRvcnkgY29tcGxpYW5jZQogKi8KCmNvbnRyYWN0IFRlbXBsYXRlIGlzIElUZW1wbGF0ZSB7CgogICAgc3RyaW5nIHB1YmxpYyBWRVJTSU9OID0gIjEiOwoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBvd25lciBvZiB0ZW1wbGF0ZQogICAgc3RyaW5nIHB1YmxpYyBvZmZlcmluZ1R5cGU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5hbWUgb2YgdGhlIHNlY3VyaXR5IGJlaW5nIGlzc3VlZAogICAgYnl0ZXMzMiBwdWJsaWMgaXNzdWVySnVyaXNkaWN0aW9uOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZhcmlhYmxlIGNvbnRhaW5zIHRoZSBqdXJpc2RpY3Rpb24gb2YgdGhlIGlzc3VlciBvZiB0aGUgdGVtcGxhdGUKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBib29sKSBwdWJsaWMgYWxsb3dlZEp1cmlzZGljdGlvbnM7ICAgICAgICAgICAvLyBNYXBwaW5nIHRoYXQgY29udGFpbnMgdGhlIGFsbG93ZWQgc3RhdXMgb2YgSnVyaXNkaWN0aW9ucwogICAgbWFwcGluZyhieXRlczMyID0+IGJvb2wpIHB1YmxpYyBibG9ja2VkRGl2aXNpb25KdXJpc2RpY3Rpb25zOyAgIC8vIE1hcHBpbmcgdGhhdCBjb250YWlucyB0aGUgYWxsb3dlZCBzdGF1cyBvZiBKdXJpc2RpY3Rpb25zCiAgICBtYXBwaW5nKHVpbnQ4ID0+IGJvb2wpIHB1YmxpYyBhbGxvd2VkUm9sZXM7ICAgICAgICAgICAgICAgICAgICAgLy8gTWFwcGluZyB0aGF0IGNvbnRhaW5zIHRoZSBhbGxvd2VkIHN0YXR1cyBvZiBSb2xlcwogICAgYm9vbCBwdWJsaWMgYWNjcmVkaXRlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZhcmlhYmxlIHRoYXQgZGVmaW5lIHRoZSByZXF1aXJlZCBsZXZlbCBvZiBhY2NyZWRpYXRpb24gZm9yIHRoZSBpbnZlc3RvcgogICAgYWRkcmVzcyBwdWJsaWMgS1lDOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIEtZQyBwcm92aWRlcgogICAgYnl0ZXMzMiBkZXRhaWxzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERldGFpbHMgb2YgdGhlIG9mZmVyaW5nIHJlcXVpcmVtZW50cwogICAgYm9vbCBmaW5hbGl6ZWQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZhcmlhYmxlIHRvIGtub3cgdGhlIHN0YXR1cyBvZiB0aGUgdGVtcGxhdGUgKGNvbXBsZXRlIC0gdHJ1ZSwgbm90IGNvbXBsZXRlIC0gZmFsc2UpCiAgICB1aW50MjU2IHB1YmxpYyBleHBpcmVzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gdGVtcGxhdGUgZXhwaXJlcwogICAgdWludDI1NiBmZWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFtb3VudCBvZiBQT0xZIHRvIHVzZSB0aGUgdGVtcGxhdGUgKGhlbGQgaW4gZXNjcm93IHVudGlsIGlzc3VhbmNlKQogICAgdWludDggcXVvcnVtOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1pbmltdW0gcGVyY2VudCBvZiBzaGFyZWhvbGRlcnMgd2hpY2ggbmVlZCB0byB2b3RlIHRvIGZyZWV6ZQogICAgdWludDI1NiB2ZXN0aW5nUGVyaW9kOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIExlbmd0aCBvZiB0aW1lIHRvIHZlc3QgZnVuZHMKCiAgICBldmVudCBEZXRhaWxzVXBkYXRlZChieXRlczMyIF9wcmV2RGV0YWlscywgYnl0ZXMzMiBfbmV3RGV0YWlscywgdWludCBfdXBkYXRlRGF0ZSk7CgogICAgZnVuY3Rpb24gVGVtcGxhdGUgKAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHN0cmluZyBfb2ZmZXJpbmdUeXBlLAogICAgICAgIGJ5dGVzMzIgX2lzc3Vlckp1cmlzZGljdGlvbiwKICAgICAgICBib29sIF9hY2NyZWRpdGVkLAogICAgICAgIGFkZHJlc3MgX0tZQywKICAgICAgICBieXRlczMyIF9kZXRhaWxzLAogICAgICAgIHVpbnQyNTYgX2V4cGlyZXMsCiAgICAgICAgdWludDI1NiBfZmVlLAogICAgICAgIHVpbnQ4IF9xdW9ydW0sCiAgICAgICAgdWludDI1NiBfdmVzdGluZ1BlcmlvZAogICAgKSBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF9LWUMgIT0gYWRkcmVzcygwKSAmJiBfb3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfZmVlID4gMCk7CiAgICAgICAgcmVxdWlyZShfZGV0YWlscy5sZW5ndGggPiAwICYmIF9leHBpcmVzID4gbm93ICYmIF9pc3N1ZXJKdXJpc2RpY3Rpb24ubGVuZ3RoID4gMCk7CiAgICAgICAgcmVxdWlyZShfcXVvcnVtID4gMCAmJiBfcXVvcnVtIDw9IDEwMCk7CiAgICAgICAgcmVxdWlyZShfdmVzdGluZ1BlcmlvZCA+IDApOwogICAgICAgIG93bmVyID0gX293bmVyOwogICAgICAgIG9mZmVyaW5nVHlwZSA9IF9vZmZlcmluZ1R5cGU7CiAgICAgICAgaXNzdWVySnVyaXNkaWN0aW9uID0gX2lzc3Vlckp1cmlzZGljdGlvbjsKICAgICAgICBhY2NyZWRpdGVkID0gX2FjY3JlZGl0ZWQ7CiAgICAgICAgS1lDID0gX0tZQzsKICAgICAgICBkZXRhaWxzID0gX2RldGFpbHM7CiAgICAgICAgZmluYWxpemVkID0gZmFsc2U7CiAgICAgICAgZXhwaXJlcyA9IF9leHBpcmVzOwogICAgICAgIGZlZSA9IF9mZWU7CiAgICAgICAgcXVvcnVtID0gX3F1b3J1bTsKICAgICAgICB2ZXN0aW5nUGVyaW9kID0gX3Zlc3RpbmdQZXJpb2Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGBhZGRKdXJpc2RpY3Rpb25gIGFsbG93cyB0aGUgYWRkaW5nIG9mIG5ldyBqdXJpc2RpY3Rpb25zIHRvIGEgdGVtcGxhdGUKICAgICAqIEBwYXJhbSBfYWxsb3dlZEp1cmlzZGljdGlvbnMgQW4gYXJyYXkgb2YganVyaXNkaWN0aW9ucwogICAgICogQHBhcmFtIF9hbGxvd2VkIEFuIGFycmF5IG9mIHdoZXRoZXIgdGhlIGp1cmlzZGljdGlvbiBpcyBhbGxvd2VkIHRvIHB1cmNoYXNlIHRoZSBzZWN1cml0eSBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gYWRkSnVyaXNkaWN0aW9uKGJ5dGVzMzJbXSBfYWxsb3dlZEp1cmlzZGljdGlvbnMsIGJvb2xbXSBfYWxsb3dlZCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoX2FsbG93ZWRKdXJpc2RpY3Rpb25zLmxlbmd0aCA9PSBfYWxsb3dlZC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoIWZpbmFsaXplZCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2FsbG93ZWRKdXJpc2RpY3Rpb25zLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGFsbG93ZWRKdXJpc2RpY3Rpb25zW19hbGxvd2VkSnVyaXNkaWN0aW9uc1tpXV0gPSBfYWxsb3dlZFtpXTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGBhZGRKdXJpc2RpY3Rpb25gIGFsbG93cyB0aGUgYWRkaW5nIG9mIG5ldyBqdXJpc2RpY3Rpb25zIHRvIGEgdGVtcGxhdGUKICAgICAqIEBwYXJhbSBfYmxvY2tlZERpdmlzaW9uSnVyaXNkaWN0aW9ucyBBbiBhcnJheSBvZiBzdWJkaXZpc2lvbiBqdXJpc2RpY3Rpb25zCiAgICAgKiBAcGFyYW0gX2Jsb2NrZWQgQW4gYXJyYXkgb2Ygd2hldGhlciB0aGUgc3ViZGl2aXNpb24ganVyaXNkaWN0aW9uIGlzIGJsb2NrZWQgdG8gcHVyY2hhc2UgdGhlIHNlY3VyaXR5IG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBhZGREaXZpc2lvbkp1cmlzZGljdGlvbihieXRlczMyW10gX2Jsb2NrZWREaXZpc2lvbkp1cmlzZGljdGlvbnMsIGJvb2xbXSBfYmxvY2tlZCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoX2Jsb2NrZWREaXZpc2lvbkp1cmlzZGljdGlvbnMubGVuZ3RoID09IF9ibG9ja2VkLmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSghZmluYWxpemVkKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmxvY2tlZERpdmlzaW9uSnVyaXNkaWN0aW9ucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBibG9ja2VkRGl2aXNpb25KdXJpc2RpY3Rpb25zW19ibG9ja2VkRGl2aXNpb25KdXJpc2RpY3Rpb25zW2ldXSA9IF9ibG9ja2VkW2ldOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYGFkZFJvbGVgIGFsbG93cyB0aGUgYWRkaW5nIG9mIG5ldyByb2xlcyB0byBiZSBhZGRlZCB0byB3aGl0ZWxpc3QKICAgICAqIEBwYXJhbSBfYWxsb3dlZFJvbGVzIFVzZXIgcm9sZXMgdGhhdCBjYW4gcHVyY2hhc2UgdGhlIHNlY3VyaXR5CiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZFJvbGVzKHVpbnQ4W10gX2FsbG93ZWRSb2xlcykgcHVibGljIHsKICAgICAgICByZXF1aXJlKG93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoIWZpbmFsaXplZCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2FsbG93ZWRSb2xlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBhbGxvd2VkUm9sZXNbX2FsbG93ZWRSb2xlc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBub3RpY2UgYHVwZGF0ZURldGFpbHNgCiAgICAgKiBAcGFyYW0gX2RldGFpbHMgZGV0YWlscyBvZiB0aGUgdGVtcGxhdGUgbmVlZCB0byBjaGFuZ2UKICAgICAqIEByZXR1cm4gYWxsb3dlZCBib29sZWFuIHZhcmlhYmxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZURldGFpbHMoYnl0ZXMzMiBfZGV0YWlscykgcHVibGljIHJldHVybnMgKGJvb2wgYWxsb3dlZCkgewogICAgICAgIHJlcXVpcmUoX2RldGFpbHMgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKG93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIGJ5dGVzMzIgcHJldkRldGFpbHMgPSBkZXRhaWxzOwogICAgICAgIGRldGFpbHMgPSBfZGV0YWlsczsKICAgICAgICBEZXRhaWxzVXBkYXRlZChwcmV2RGV0YWlscywgZGV0YWlscywgbm93KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYGZpbmFsaXplVGVtcGxhdGVgIGlzIHVzZWQgdG8gZmluYWxpemUgdGVtcGxhdGUuZnVsbCBjb21wbGlhbmNlIHByb2Nlc3MvcmVxdWlyZW1lbnRzCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemVUZW1wbGF0ZSgpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKG93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIGZpbmFsaXplZCA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGBjaGVja1RlbXBsYXRlUmVxdWlyZW1lbnRzYCBpcyBhIGNvbnN0YW50IGZ1bmN0aW9uIHRoYXQgY2hlY2tzIGlmIHRlbXBsYXRlcyByZXF1aXJlbWVudHMgYXJlIG1ldAogICAgICogQHBhcmFtIF9jb3VudHJ5SnVyaXNkaWN0aW9uIFRoZSBJU08tMzE2NiBjb2RlIG9mIHRoZSBpbnZlc3RvcnMgY291bnRyeSBqdXJpc2RpY3Rpb24KICAgICAqIEBwYXJhbSBfZGl2aXNpb25KdXJpc2RpY3Rpb24gVGhlIElTTy0zMTY2IGNvZGUgb2YgdGhlIGludmVzdG9ycyBzdWJkaXZpc2lvbiBqdXJpc2RpY3Rpb24KICAgICAqIEBwYXJhbSBfYWNjcmVkaXRlZCBXaGV0aGVyIHRoZSBpbnZlc3RvciBpcyBhY2NyZWRpdGVkIG9yIG5vdAogICAgICogQHBhcmFtIF9yb2xlIHJvbGUgb2YgdGhlIHVzZXIKICAgICAqIEByZXR1cm4gYWxsb3dlZCBib29sZWFuIHZhcmlhYmxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrVGVtcGxhdGVSZXF1aXJlbWVudHMoCiAgICAgICAgYnl0ZXMzMiBfY291bnRyeUp1cmlzZGljdGlvbiwKICAgICAgICBieXRlczMyIF9kaXZpc2lvbkp1cmlzZGljdGlvbiwKICAgICAgICBib29sIF9hY2NyZWRpdGVkLAogICAgICAgIHVpbnQ4IF9yb2xlCiAgICApIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIGFsbG93ZWQpCiAgICB7CiAgICAgICAgcmVxdWlyZShfY291bnRyeUp1cmlzZGljdGlvbiAhPSAweDApOwogICAgICAgIHJlcXVpcmUoYWxsb3dlZEp1cmlzZGljdGlvbnNbX2NvdW50cnlKdXJpc2RpY3Rpb25dIHx8ICFibG9ja2VkRGl2aXNpb25KdXJpc2RpY3Rpb25zW19kaXZpc2lvbkp1cmlzZGljdGlvbl0pOwogICAgICAgIHJlcXVpcmUoYWxsb3dlZFJvbGVzW19yb2xlXSk7CiAgICAgICAgaWYgKGFjY3JlZGl0ZWQpIHsKICAgICAgICAgICAgcmVxdWlyZShfYWNjcmVkaXRlZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBnZXRUZW1wbGF0ZURldGFpbHMgaXMgYSBjb25zdGFudCBmdW5jdGlvbiB0aGF0IGdldHMgdGVtcGxhdGUgZGV0YWlscwogICAgICogQHJldHVybiBieXRlczMyIGRldGFpbHMsIGJvb2wgZmluYWxpemVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRlbXBsYXRlRGV0YWlscygpIHZpZXcgcHVibGljIHJldHVybnMgKGJ5dGVzMzIsIGJvb2wpIHsKICAgICAgICByZXF1aXJlKGV4cGlyZXMgPiBub3cpOwogICAgICAgIHJldHVybiAoZGV0YWlscywgZmluYWxpemVkKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYGdldFVzYWdlRmVlc2AgaXMgYSBmdW5jdGlvbiB0byBnZXQgYWxsIHRoZSBkZXRhaWxzIG9uIHRlbXBsYXRlIHVzYWdlIGZlZXMKICAgICAqIEByZXR1cm4gdWludDI1NiBmZWUsIHVpbnQ4IHF1b3J1bSwgdWludDI1NiB2ZXN0aW5nUGVyaW9kLCBhZGRyZXNzIG93bmVyLCBhZGRyZXNzIEtZQwogICAgICovCiAgICBmdW5jdGlvbiBnZXRVc2FnZURldGFpbHMoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2LCB1aW50OCwgdWludDI1NiwgYWRkcmVzcywgYWRkcmVzcykgewogICAgICAgIHJldHVybiAoZmVlLCBxdW9ydW0sIHZlc3RpbmdQZXJpb2QsIG93bmVyLCBLWUMpOwogICAgfQp9CgppbnRlcmZhY2UgSVNlY3VyaXR5VG9rZW4gewoKICAgIC8qKgogICAgICogQGRldiBTZXQgZGVmYXVsdCBzZWN1cml0eSB0b2tlbiBwYXJhbWV0ZXJzCiAgICAgKiBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICAgICAqIEBwYXJhbSBfdGlja2VyIFRpY2tlciBuYW1lIG9mIHRoZSBzZWN1cml0eQogICAgICogQHBhcmFtIF90b3RhbFN1cHBseSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGJlaW5nIGNyZWF0ZWQKICAgICAqIEBwYXJhbSBfZGVjaW1hbHMgRGVjaW1hbHMgZm9yIHRva2VuCiAgICAgKiBAcGFyYW0gX293bmVyIEV0aGVyZXVtIGFkZHJlc3Mgb2YgdGhlIHNlY3VyaXR5IHRva2VuIG93bmVyCiAgICAgKiBAcGFyYW0gX21heFBvbHkgQW1vdW50IG9mIG1heGltdW0gcG9seSBpc3N1ZXIgd2FudCB0byByYWlzZQogICAgICogQHBhcmFtIF9sb2NrdXBQZXJpb2QgTGVuZ3RoIG9mIHRpbWUgcmFpc2VkIFBPTFkgd2lsbCBiZSBsb2NrZWQgdXAgZm9yIGRpc3B1dGUKICAgICAqIEBwYXJhbSBfcXVvcnVtIFBlcmNlbnQgb2YgaW5pdGlhbCBpbnZlc3RvcnMgcmVxdWlyZWQgdG8gZnJlZXplIFBPTFkgcmFpc2UKICAgICAqIEBwYXJhbSBfcG9seVRva2VuQWRkcmVzcyBFdGhlcmV1bSBhZGRyZXNzIG9mIHRoZSBQT0xZIHRva2VuIGNvbnRyYWN0CiAgICAgKiBAcGFyYW0gX3BvbHlDdXN0b21lcnNBZGRyZXNzIEV0aGVyZXVtIGFkZHJlc3Mgb2YgdGhlIFBvbHlDdXN0b21lcnMgY29udHJhY3QKICAgICAqIEBwYXJhbSBfcG9seUNvbXBsaWFuY2VBZGRyZXNzIEV0aGVyZXVtIGFkZHJlc3Mgb2YgdGhlIFBvbHlDb21wbGlhbmNlIGNvbnRyYWN0CiAgICAgKi8KICAgIGZ1bmN0aW9uIFNlY3VyaXR5VG9rZW4oCiAgICAgICAgc3RyaW5nIF9uYW1lLAogICAgICAgIHN0cmluZyBfdGlja2VyLAogICAgICAgIHVpbnQyNTYgX3RvdGFsU3VwcGx5LAogICAgICAgIHVpbnQ4IF9kZWNpbWFscywKICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICB1aW50MjU2IF9tYXhQb2x5LAogICAgICAgIHVpbnQyNTYgX2xvY2t1cFBlcmlvZCwKICAgICAgICB1aW50OCBfcXVvcnVtLAogICAgICAgIGFkZHJlc3MgX3BvbHlUb2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfcG9seUN1c3RvbWVyc0FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfcG9seUNvbXBsaWFuY2VBZGRyZXNzCiAgICApIHB1YmxpYzsKCiAgIC8qKgogICAgICogQGRldiBgc2VsZWN0VGVtcGxhdGVgIFNlbGVjdCBhIHByb3Bvc2VkIHRlbXBsYXRlIGZvciB0aGUgaXNzdWFuY2UKICAgICAqIEBwYXJhbSBfdGVtcGxhdGVJbmRleCBBcnJheSBpbmRleCBvZiB0aGUgZGVsZWdhdGVzIHByb3Bvc2VkIHRlbXBsYXRlCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBzZWxlY3RUZW1wbGF0ZSh1aW50OCBfdGVtcGxhdGVJbmRleCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZSBjb21wbGlhbmNlIHByb29mIGhhc2ggZm9yIHRoZSBpc3N1YW5jZQogICAgICogQHBhcmFtIF9uZXdNZXJrbGVSb290IE5ldyBtZXJrbGUgcm9vdCBoYXNoIG9mIHRoZSBjb21wbGlhbmNlIFByb29mcwogICAgICogQHBhcmFtIF9jb21wbGlhbmNlUHJvb2YgQ29tcGxpYW5jZSBQcm9vZiBoYXNoCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDb21wbGlhbmNlUHJvb2YoCiAgICAgICAgYnl0ZXMzMiBfbmV3TWVya2xlUm9vdCwKICAgICAgICBieXRlczMyIF9jb21wbGlhbmNlUHJvb2YKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IGBzZWxlY3RPZmZlcmluZ1Byb3Bvc2FsYCBTZWxlY3QgYW4gc2VjdXJpdHkgdG9rZW4gb2ZmZXJpbmcgcHJvcG9zYWwgZm9yIHRoZSBpc3N1YW5jZQogICAgICogQHBhcmFtIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXggQXJyYXkgaW5kZXggb2YgdGhlIFNUTyBwcm9wb3NhbAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gc2VsZWN0T2ZmZXJpbmdQcm9wb3NhbCAoCiAgICAgICAgdWludDggX29mZmVyaW5nUHJvcG9zYWxJbmRleAogICAgKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvKioKICAgICAqIEBkZXYgU3RhcnQgdGhlIG9mZmVyaW5nIGJ5IHNlbmRpbmcgYWxsIHRoZSB0b2tlbnMgdG8gU1RPIGNvbnRyYWN0CiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRPZmZlcmluZygpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IEFkZCBhIHZlcmlmaWVkIGFkZHJlc3MgdG8gdGhlIFNlY3VyaXR5IFRva2VuIHdoaXRlbGlzdAogICAgICogQHBhcmFtIF93aGl0ZWxpc3RBZGRyZXNzIEFkZHJlc3MgYXR0ZW1wdGluZyB0byBqb2luIFNUIHdoaXRlbGlzdAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gYWRkVG9XaGl0ZWxpc3QodWludDggS1lDUHJvdmlkZXJJbmRleCwgYWRkcmVzcyBfd2hpdGVsaXN0QWRkcmVzcykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgIC8qKgogICAgICAqIEBkZXYgQWxsb3cgUE9MWSBhbGxvY2F0aW9ucyB0byBiZSB3aXRoZHJhd24gYnkgb3duZXIsIGRlbGVnYXRlLCBhbmQgdGhlIFNUTyBhdWRpdG9yIGF0IGFwcHJvcHJpYXRlIHRpbWVzCiAgICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MgCiAgICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BvbHkoKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvKioKICAgICAqIEBkZXYgVm90ZSB0byBmcmVlemUgdGhlIGZlZSBvZiBhIGNlcnRhaW4gbmV0d29yayBwYXJ0aWNpcGFudAogICAgICogQHBhcmFtIF9yZWNpcGllbnQgVGhlIGZlZSByZWNpcGllbnQgYmVpbmcgcHJvdGVzdGVkCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiB2b3RlVG9GcmVlemUoYWRkcmVzcyBfcmVjaXBpZW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvKioKICAgICAqIEBkZXYgYGlzc3VlU2VjdXJpdHlUb2tlbnNgIGlzIHVzZWQgYnkgdGhlIFNUTyB0byBrZWVwIHRyYWNrIG9mIFNUTyBpbnZlc3RvcnMKICAgICAqIEBwYXJhbSBfY29udHJpYnV0b3IgVGhlIGFkZHJlc3Mgb2YgdGhlIHBlcnNvbiB3aG9zZSBjb250cmlidXRpbmcKICAgICAqIEBwYXJhbSBfYW1vdW50T2ZTZWN1cml0eVRva2VucyBUaGUgYW1vdW50IG9mIFNUIHRvIHBheSBvdXQuCiAgICAgKiBAcGFyYW0gX3BvbHlDb250cmlidXRlZCBUaGUgYW1vdW50IG9mIFBPTFkgcGFpZCBmb3IgdGhlIHNlY3VyaXR5IHRva2Vucy4KICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWVTZWN1cml0eVRva2VucyhhZGRyZXNzIF9jb250cmlidXRvciwgdWludDI1NiBfYW1vdW50T2ZTZWN1cml0eVRva2VucywgdWludDI1NiBfcG9seUNvbnRyaWJ1dGVkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gR2V0IHRva2VuIGRldGFpbHMKICAgIGZ1bmN0aW9uIGdldFRva2VuRGV0YWlscygpIHZpZXcgcHVibGljIHJldHVybnMgKGFkZHJlc3MsIGFkZHJlc3MsIGJ5dGVzMzIsIGFkZHJlc3MsIGFkZHJlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBUcmFzZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgICAqIEBwYXJhbSBfdG8gRXRoZXJldW0gcHVibGljIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG9rZW5zIHRvCiAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIGNvbnRyYWN0cyB0byB0cmFuc2ZlciB0b2tlbnMgb24gYmVoYWxmIG9mIHRva2VuIGhvbGRlcnMKICAgICAqIEBwYXJhbSBfZnJvbSBBZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VucyBmcm9tCiAgICAgKiBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgICAqIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IGBiYWxhbmNlT2ZgIHVzZWQgdG8gZ2V0IHRoZSBiYWxhbmNlIG9mIHNoYXJlaG9sZGVycwogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAgKiBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLyoqCiAgICAgKiBAZGV2IEFwcHJvdmUgdHJhbnNmZXIgb2YgdG9rZW5zIG1hbnVhbGx5CiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyB0byBhcHByb3ZlIHRyYW5zZmVyIHRvCiAgICAgKiBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdG8gYXBwcm92ZSBmb3IgdHJhbnNmZXIKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICogQGRldiBVc2UgdG8gZ2V0IHRoZSBhbGxvd2FuY2UgcHJvdmlkZWQgdG8gdGhlIHNwZW5kZXIKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgICogQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICB9CgppbnRlcmZhY2UgSVNUUmVnaXN0cmFyIHsKCiAgIC8qKgogICAgKiBAZGV2IENyZWF0ZXMgYSBuZXcgU2VjdXJpdHkgVG9rZW4gYW5kIHNhdmVzIGl0IHRvIHRoZSByZWdpc3RyeQogICAgKiBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICAgICogQHBhcmFtIF90aWNrZXIgVGlja2VyIG5hbWUgb2YgdGhlIHNlY3VyaXR5CiAgICAqIEBwYXJhbSBfdG90YWxTdXBwbHkgVG90YWwgYW1vdW50IG9mIHRva2VucyBiZWluZyBjcmVhdGVkCiAgICAqIEBwYXJhbSBfb3duZXIgRXRoZXJldW0gcHVibGljIGtleSBhZGRyZXNzIG9mIHRoZSBzZWN1cml0eSB0b2tlbiBvd25lcgogICAgKiBAcGFyYW0gX21heFBvbHkgQW1vdW50IG9mIG1heGltdW0gcG9seSBpc3N1ZXIgd2FudCB0byByYWlzZQogICAgKiBAcGFyYW0gX2hvc3QgVGhlIGhvc3Qgb2YgdGhlIHNlY3VyaXR5IHRva2VuIHdpemFyZAogICAgKiBAcGFyYW0gX2ZlZSBGZWUgYmVpbmcgcmVxdWVzdGVkIGJ5IHRoZSB3aXphcmQgaG9zdAogICAgKiBAcGFyYW0gX3R5cGUgVHlwZSBvZiBzZWN1cml0eSBiZWluZyB0b2tlbml6ZWQKICAgICogQHBhcmFtIF9sb2NrdXBQZXJpb2QgTGVuZ3RoIG9mIHRpbWUgcmFpc2VkIFBPTFkgd2lsbCBiZSBsb2NrZWQgdXAgZm9yIGRpc3B1dGUKICAgICogQHBhcmFtIF9xdW9ydW0gUGVyY2VudCBvZiBpbml0aWFsIGludmVzdG9ycyByZXF1aXJlZCB0byBmcmVlemUgUE9MWSByYWlzZQogICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZVNlY3VyaXR5VG9rZW4gKAogICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICBzdHJpbmcgX3RpY2tlciwKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseSwKICAgICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgdWludDI1NiBfbWF4UG9seSwKICAgICAgICBhZGRyZXNzIF9ob3N0LAogICAgICAgIHVpbnQyNTYgX2ZlZSwKICAgICAgICB1aW50OCBfdHlwZSwKICAgICAgICB1aW50MjU2IF9sb2NrdXBQZXJpb2QsCiAgICAgICAgdWludDggX3F1b3J1bQogICAgKSBleHRlcm5hbDsKCn0KCi8qKgogKiAgU2FmZU1hdGggPGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL21hdGgvU2FmZU1hdGguc29sLz4KICogIENvcHlyaWdodCAoYykgMjAxNiBTbWFydCBDb250cmFjdCBTb2x1dGlvbnMsIEluYy4KICogIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoTUlUKQogKi8KCi8vLyBAdGl0bGUgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICAgICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQp9Cgpjb250cmFjdCBTVE8yMCB7CgogICAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwogICAgdWludDI1NiBwdWJsaWMgZW5kVGltZTsKCiAgICAvKiogCiAgICAgKiBAZGV2IEluaXRpYWxpemVzIHRoZSBTVE8gd2l0aCBjZXJ0YWluIHBhcmFtcwogICAgICogQGRldiBfdG9rZW5BZGRyZXNzIEFkZHJlc3Mgb2YgdGhlIHNlY3VyaXR5IHRva2VuCiAgICAgKiBAcGFyYW0gX3N0YXJ0VGltZSBHaXZlbiBpbiBVTklYIHRpbWUgdGhpcyBpcyB0aGUgdGltZSB0aGF0IHRoZSBvZmZlcmluZyB3aWxsIGJlZ2luCiAgICAgKiBAcGFyYW0gX2VuZFRpbWUgR2l2ZW4gaW4gVU5JWCB0aW1lIHRoaXMgaXMgdGhlIHRpbWUgdGhhdCB0aGUgb2ZmZXJpbmcgd2lsbCBlbmQgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlY3VyaXR5VG9rZW5PZmZlcmluZygKICAgICAgICBhZGRyZXNzIF90b2tlbkFkZHJlc3MsCiAgICAgICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgICAgIHVpbnQyNTYgX2VuZFRpbWUKICAgICkgZXh0ZXJuYWwgOwoKfQoKLyoqCiAqIEB0aXRsZSBTZWN1cml0eVRva2VuCiAqIEBkZXYgQ29udHJhY3QgKEEgQmx1ZXByaW50KSB0aGF0IGNvbnRhaW5zIHRoZSBmdW5jdGlvbmFsaXRpZXMgb2YgdGhlIHNlY3VyaXR5IHRva2VuCiAqLwoKY29udHJhY3QgU2VjdXJpdHlUb2tlbiBpcyBJRVJDMjAgewoKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHN0cmluZyBwdWJsaWMgVkVSU0lPTiA9ICIxIjsKCiAgICBJRVJDMjAgcHVibGljIFBPTFk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbnN0YW5jZSBvZiB0aGUgUE9MWSB0b2tlbiBjb250cmFjdAoKICAgIElDb21wbGlhbmNlIHB1YmxpYyBQb2x5Q29tcGxpYW5jZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEluc3RhbmNlIG9mIHRoZSBDb21wbGlhbmNlIGNvbnRyYWN0CgogICAgSVRlbXBsYXRlIHB1YmxpYyBUZW1wbGF0ZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGFuY2Ugb2YgdGhlIFRlbXBsYXRlIGNvbnRyYWN0CgogICAgSUN1c3RvbWVycyBwdWJsaWMgUG9seUN1c3RvbWVyczsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGFuY2Ugb2YgdGhlIEN1c3RvbWVycyBjb250cmFjdAoKICAgIFNUTzIwIHB1YmxpYyBTVE87CgogICAgLy8gRVJDMjAgRmllbGRzCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOYW1lIG9mIHRoZSBzZWN1cml0eSB0b2tlbgogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbHMgZm9yIHRoZSBzZWN1cml0eSB0b2tlbiBpdCBzaG91bGQgYmUgMCBhcyBzdGFuZGFyZAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3ltYm9sIG9mIHRoZSBzZWN1cml0eSB0b2tlbgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzcyBvZiB0aGUgb3duZXIgb2YgdGhlIHNlY3VyaXR5IHRva2VuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUb3RhbCBudW1iZXIgb2Ygc2VjdXJpdHkgdG9rZW4gZ2VuZXJhdGVkCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOyAgICAgICAgICAvLyBNYXBwaW5nIGFzIHNhbWUgYXMgaW4gRVJDMjAgdG9rZW4KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFycmF5IHVzZWQgdG8gc3RvcmUgdGhlIGJhbGFuY2VzIG9mIHRoZSBzZWN1cml0eSB0b2tlbiBob2xkZXJzCgogICAgLy8gVGVtcGxhdGUKICAgIGFkZHJlc3MgcHVibGljIGRlbGVnYXRlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgd2hvIGNyZWF0ZSB0aGUgdGVtcGxhdGUKICAgIGJ5dGVzMzIgcHVibGljIG1lcmtsZVJvb3Q7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vCiAgICBhZGRyZXNzIHB1YmxpYyBLWUM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBLWUMgcHJvdmlkZXIgd2hpY2ggYWxvb3dlZCB0aGUgcm9sZXMgYW5kIGp1cmlzZGljdGlvbnMgaW4gdGhlIHRlbXBsYXRlCgogICAgLy8gU2VjdXJpdHkgdG9rZW4gc2hhcmVob2xkZXJzCiAgICBzdHJ1Y3QgU2hhcmVob2xkZXIgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdHJ1Y3R1cmUgdGhhdCBjb250YWlucyB0aGUgZGF0YSBvZiB0aGUgc2hhcmVob2xkZXJzCiAgICAgICAgYWRkcmVzcyB2ZXJpZmllcjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB2ZXJpZmllciAtIGFkZHJlc3Mgb2YgdGhlIEtZQyBvcmFjbGUKICAgICAgICBib29sIGFsbG93ZWQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFsbG93ZWQgLSB3aGV0aGVyIHRoZSBzaGFyZWhvbGRlciBpcyBhbGxvd2VkIHRvIHRyYW5zZmVyIG9yIHJlY2lldmUgdGhlIHNlY3VyaXR5IHRva2VuCiAgICAgICAgdWludDggcm9sZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByb2xlIC0gcm9sZSBvZiB0aGUgc2hhcmVob2xkZXIgezEsMiwzLDR9CiAgICB9CgogICAgbWFwcGluZyhhZGRyZXNzID0+IFNoYXJlaG9sZGVyKSBwdWJsaWMgc2hhcmVob2xkZXJzOyAgICAgICAgICAgICAgLy8gTWFwcGluZyB0aGF0IGhvbGRzIHRoZSBkYXRhIG9mIHRoZSBzaGFyZWhvbGRlciBjb3JyZXNwb25kaW5nIHRvIGludmVzdG9yIGFkZHJlc3MKCiAgICAvLyBTVE8KICAgIGJvb2wgcHVibGljIGlzU1RPUHJvcG9zZWQgPSBmYWxzZTsKICAgIGJvb2wgcHVibGljIGhhc09mZmVyaW5nU3RhcnRlZCA9IGZhbHNlOwogICAgdWludDI1NiBwdWJsaWMgbWF4UG9seTsKCiAgICAvLyBUaGUgc3RhcnQgYW5kIGVuZCB0aW1lIG9mIHRoZSBTVE8KICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0U1RPOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRpbWVzdGFtcCB3aGVuIFNlY3VyaXR5IFRva2VuIE9mZmVyaW5nIHdpbGwgYmUgc3RhcnQKICAgIHVpbnQyNTYgcHVibGljIGVuZFNUTzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRpbWVzdGFtcCB3aGVuIFNlY3VyaXR5IFRva2VuIE9mZmVyaW5nIGNvbnRyYWN0IHdpbGwgZW5kcwoKICAgIC8vIFBPTFkgYWxsb2NhdGlvbnMKICAgIHN0cnVjdCBBbGxvY2F0aW9uIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0cnVjdHVyZSB0aGF0IGNvbnRhaW5zIHRoZSBhbGxvY2F0aW9uIG9mIHRoZSBQT0xZIGZvciBzdGFrZWhvbGRlcnMKICAgICAgICB1aW50MjU2IGFtb3VudDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YWtlaG9sZGVycyAtIGRlbGVnYXRlLCBpc3N1ZXIob3duZXIpLCBhdWRpdG9yCiAgICAgICAgdWludDI1NiB2ZXN0aW5nUGVyaW9kOwogICAgICAgIHVpbnQ4IHF1b3J1bTsKICAgICAgICB1aW50MjU2IHlheVZvdGVzOwogICAgICAgIHVpbnQyNTYgeWF5UGVyY2VudDsKICAgICAgICBib29sIGZyb3plbjsKICAgIH0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkpIHB1YmxpYyB2b3RlZDsgICAgICAgICAgICAgICAvLyBWb3RpbmcgbWFwcGluZwogICAgbWFwcGluZyhhZGRyZXNzID0+IEFsbG9jYXRpb24pIHB1YmxpYyBhbGxvY2F0aW9uczsgICAgICAgICAgICAgICAgICAgICAgIC8vIE1hcHBpbmcgdGhhdCBjb250YWlucyB0aGUgZGF0YSBvZiBhbGxvY2F0aW9uIGNvcnJlc3BvbmRpbmcgdG8gc3Rha2Vob2xkZXIgYWRkcmVzcwoKCSAgIC8vIFNlY3VyaXR5IFRva2VuIE9mZmVyaW5nIHN0YXRpc3RpY3MKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY29udHJpYnV0ZWRUb1NUTzsgICAgICAgICAgICAgICAgICAgICAvLyBNYXBwaW5nIGZvciB0cmFja2luZyB0aGUgUE9MWSBjb250cmlidXRpb24gYnkgdGhlIGNvbnRyaWJ1dG9yCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlbnNJc3N1ZWRCeVNUTyA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGbGFnIHZhcmlhYmxlIHRvIHRyYWNrIHRoZSBzZWN1cml0eSB0b2tlbiBpc3N1ZWQgYnkgdGhlIG9mZmVyaW5nIGNvbnRyYWN0CgogICAgLy8gTm90aWZpY2F0aW9ucwogICAgZXZlbnQgTG9nVGVtcGxhdGVTZXQoYWRkcmVzcyBpbmRleGVkIF9kZWxlZ2F0ZUFkZHJlc3MsIGFkZHJlc3MgX3RlbXBsYXRlLCBhZGRyZXNzIGluZGV4ZWQgX0tZQyk7CiAgICBldmVudCBMb2dVcGRhdGVkQ29tcGxpYW5jZVByb29mKGJ5dGVzMzIgX21lcmtsZVJvb3QsIGJ5dGVzMzIgX2NvbXBsaWFuY2VQcm9vZkhhc2gpOwogICAgZXZlbnQgTG9nU2V0U1RPQ29udHJhY3QoYWRkcmVzcyBfU1RPLCBhZGRyZXNzIGluZGV4ZWQgX1NUT3RlbXBsYXRlLCBhZGRyZXNzIGluZGV4ZWQgX2F1ZGl0b3IsIHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSk7CiAgICBldmVudCBMb2dOZXdXaGl0ZWxpc3RlZEFkZHJlc3MoYWRkcmVzcyBfS1lDLCBhZGRyZXNzIF9zaGFyZWhvbGRlciwgdWludDggX3JvbGUpOwogICAgZXZlbnQgTG9nTmV3QmxhY2tsaXN0ZWRBZGRyZXNzKGFkZHJlc3MgX0tZQywgYWRkcmVzcyBfc2hhcmVob2xkZXIpOwogICAgZXZlbnQgTG9nVm90ZVRvRnJlZXplKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NiBfeWF5UGVyY2VudCwgdWludDggX3F1b3J1bSwgYm9vbCBfZnJvemVuKTsKICAgIGV2ZW50IExvZ1Rva2VuSXNzdWVkKGFkZHJlc3MgaW5kZXhlZCBfY29udHJpYnV0b3IsIHVpbnQyNTYgX3N0QW1vdW50LCB1aW50MjU2IF9wb2x5Q29udHJpYnV0ZWQsIHVpbnQyNTYgX3RpbWVzdGFtcCk7CgogICAgLy9Nb2RpZmllcnMKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlEZWxlZ2F0ZSgpIHsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IGRlbGVnYXRlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lck9yRGVsZWdhdGUoKSB7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBkZWxlZ2F0ZSB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlTVE8oKSB7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBhZGRyZXNzKFNUTykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVNoYXJlaG9sZGVyKCkgewogICAgICAgIHJlcXVpcmUgKHNoYXJlaG9sZGVyc1ttc2cuc2VuZGVyXS5hbGxvd2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXQgZGVmYXVsdCBzZWN1cml0eSB0b2tlbiBwYXJhbWV0ZXJzCiAgICAgKiBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICAgICAqIEBwYXJhbSBfdGlja2VyIFRpY2tlciBuYW1lIG9mIHRoZSBzZWN1cml0eQogICAgICogQHBhcmFtIF90b3RhbFN1cHBseSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGJlaW5nIGNyZWF0ZWQKICAgICAqIEBwYXJhbSBfb3duZXIgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgc2VjdXJpdHkgdG9rZW4gb3duZXIKICAgICAqIEBwYXJhbSBfbWF4UG9seSBBbW91bnQgb2YgbWF4aW11bSBwb2x5IGlzc3VlciB3YW50IHRvIHJhaXNlCiAgICAgKiBAcGFyYW0gX2xvY2t1cFBlcmlvZCBMZW5ndGggb2YgdGltZSByYWlzZWQgUE9MWSB3aWxsIGJlIGxvY2tlZCB1cCBmb3IgZGlzcHV0ZQogICAgICogQHBhcmFtIF9xdW9ydW0gUGVyY2VudCBvZiBpbml0aWFsIGludmVzdG9ycyByZXF1aXJlZCB0byBmcmVlemUgUE9MWSByYWlzZQogICAgICogQHBhcmFtIF9wb2x5VG9rZW5BZGRyZXNzIEV0aGVyZXVtIGFkZHJlc3Mgb2YgdGhlIFBPTFkgdG9rZW4gY29udHJhY3QKICAgICAqIEBwYXJhbSBfcG9seUN1c3RvbWVyc0FkZHJlc3MgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgUG9seUN1c3RvbWVycyBjb250cmFjdAogICAgICogQHBhcmFtIF9wb2x5Q29tcGxpYW5jZUFkZHJlc3MgRXRoZXJldW0gYWRkcmVzcyBvZiB0aGUgUG9seUNvbXBsaWFuY2UgY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gU2VjdXJpdHlUb2tlbigKICAgICAgICBzdHJpbmcgX25hbWUsCiAgICAgICAgc3RyaW5nIF90aWNrZXIsCiAgICAgICAgdWludDI1NiBfdG90YWxTdXBwbHksCiAgICAgICAgdWludDggX2RlY2ltYWxzLAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQyNTYgX21heFBvbHksCiAgICAgICAgdWludDI1NiBfbG9ja3VwUGVyaW9kLAogICAgICAgIHVpbnQ4IF9xdW9ydW0sCiAgICAgICAgYWRkcmVzcyBfcG9seVRva2VuQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9wb2x5Q3VzdG9tZXJzQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9wb2x5Q29tcGxpYW5jZUFkZHJlc3MKICAgICkgcHVibGljCiAgICB7CiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF90aWNrZXI7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgbWF4UG9seSA9IF9tYXhQb2x5OwogICAgICAgIHRvdGFsU3VwcGx5ID0gX3RvdGFsU3VwcGx5OwogICAgICAgIGJhbGFuY2VzW19vd25lcl0gPSBfdG90YWxTdXBwbHk7CiAgICAgICAgUE9MWSA9IElFUkMyMChfcG9seVRva2VuQWRkcmVzcyk7CiAgICAgICAgUG9seUN1c3RvbWVycyA9IElDdXN0b21lcnMoX3BvbHlDdXN0b21lcnNBZGRyZXNzKTsKICAgICAgICBQb2x5Q29tcGxpYW5jZSA9IElDb21wbGlhbmNlKF9wb2x5Q29tcGxpYW5jZUFkZHJlc3MpOwogICAgICAgIGFsbG9jYXRpb25zW293bmVyXSA9IEFsbG9jYXRpb24oMCwgX2xvY2t1cFBlcmlvZCwgX3F1b3J1bSwgMCwgMCwgZmFsc2UpOwogICAgICAgIFRyYW5zZmVyKDB4MCwgX293bmVyLCBfdG90YWxTdXBwbHkpOwogICAgfQoKICAgIC8qIGZ1bmN0aW9uIGluaXRpYWxpc2VCYWxhbmNlcyh1aW50MjU2KSAqLwoKICAgIC8qKgogICAgICogQGRldiBgc2VsZWN0VGVtcGxhdGVgIFNlbGVjdCBhIHByb3Bvc2VkIHRlbXBsYXRlIGZvciB0aGUgaXNzdWFuY2UKICAgICAqIEBwYXJhbSBfdGVtcGxhdGVJbmRleCBBcnJheSBpbmRleCBvZiB0aGUgZGVsZWdhdGVzIHByb3Bvc2VkIHRlbXBsYXRlCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBzZWxlY3RUZW1wbGF0ZSh1aW50OCBfdGVtcGxhdGVJbmRleCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKCFpc1NUT1Byb3Bvc2VkKTsKICAgICAgICBhZGRyZXNzIF90ZW1wbGF0ZSA9IFBvbHlDb21wbGlhbmNlLmdldFRlbXBsYXRlQnlQcm9wb3NhbCh0aGlzLCBfdGVtcGxhdGVJbmRleCk7CiAgICAgICAgcmVxdWlyZShfdGVtcGxhdGUgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgVGVtcGxhdGUgPSBJVGVtcGxhdGUoX3RlbXBsYXRlKTsKICAgICAgICB2YXIgKF9mZWUsIF9xdW9ydW0sIF92ZXN0aW5nUGVyaW9kLCBfZGVsZWdhdGUsIF9LWUMpID0gVGVtcGxhdGUuZ2V0VXNhZ2VEZXRhaWxzKCk7CiAgICAgICAgcmVxdWlyZShQT0xZLmJhbGFuY2VPZih0aGlzKSA+PSBfZmVlKTsKICAgICAgICBhbGxvY2F0aW9uc1tfZGVsZWdhdGVdID0gQWxsb2NhdGlvbihfZmVlLCBfdmVzdGluZ1BlcmlvZCwgX3F1b3J1bSwgMCwgMCwgZmFsc2UpOwogICAgICAgIGRlbGVnYXRlID0gX2RlbGVnYXRlOwogICAgICAgIEtZQyA9IF9LWUM7CiAgICAgICAgUG9seUNvbXBsaWFuY2UudXBkYXRlVGVtcGxhdGVSZXB1dGF0aW9uKF90ZW1wbGF0ZSwgX3RlbXBsYXRlSW5kZXgpOwogICAgICAgIExvZ1RlbXBsYXRlU2V0KF9kZWxlZ2F0ZSwgX3RlbXBsYXRlLCBfS1lDKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIGNvbXBsaWFuY2UgcHJvb2YgaGFzaCBmb3IgdGhlIGlzc3VhbmNlCiAgICAgKiBAcGFyYW0gX25ld01lcmtsZVJvb3QgTmV3IG1lcmtsZSByb290IGhhc2ggb2YgdGhlIGNvbXBsaWFuY2UgUHJvb2ZzCiAgICAgKiBAcGFyYW0gX21lcmtsZVJvb3QgQ29tcGxpYW5jZSBQcm9vZiBoYXNoCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDb21wbGlhbmNlUHJvb2YoCiAgICAgICAgYnl0ZXMzMiBfbmV3TWVya2xlUm9vdCwKICAgICAgICBieXRlczMyIF9tZXJrbGVSb290CiAgICApIHB1YmxpYyBvbmx5T3duZXJPckRlbGVnYXRlIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBtZXJrbGVSb290ID0gX25ld01lcmtsZVJvb3Q7CiAgICAgICAgTG9nVXBkYXRlZENvbXBsaWFuY2VQcm9vZihtZXJrbGVSb290LCBfbWVya2xlUm9vdCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGBzZWxlY3RPZmZlcmluZ1Byb3Bvc2FsYCBTZWxlY3QgYW4gc2VjdXJpdHkgdG9rZW4gb2ZmZXJpbmcgcHJvcG9zYWwgZm9yIHRoZSBpc3N1YW5jZQogICAgICogQHBhcmFtIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXggQXJyYXkgaW5kZXggb2YgdGhlIFNUTyBwcm9wb3NhbAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gc2VsZWN0T2ZmZXJpbmdQcm9wb3NhbCAodWludDggX29mZmVyaW5nUHJvcG9zYWxJbmRleCkgcHVibGljIG9ubHlEZWxlZ2F0ZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKCFpc1NUT1Byb3Bvc2VkKTsKICAgICAgICB2YXIgKF9zdG9Db250cmFjdCwgX2F1ZGl0b3IsIF92ZXN0aW5nUGVyaW9kLCBfcXVvcnVtLCBfZmVlKSA9IFBvbHlDb21wbGlhbmNlLmdldE9mZmVyaW5nQnlQcm9wb3NhbCh0aGlzLCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KTsKICAgICAgICByZXF1aXJlKF9zdG9Db250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG1lcmtsZVJvb3QgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKGRlbGVnYXRlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoUE9MWS5iYWxhbmNlT2YodGhpcykgPj0gYWxsb2NhdGlvbnNbZGVsZWdhdGVdLmFtb3VudC5hZGQoX2ZlZSkpOwogICAgICAgIFNUTyA9IFNUTzIwKF9zdG9Db250cmFjdCk7CiAgICAgICAgcmVxdWlyZShTVE8uc3RhcnRUaW1lKCkgPiBub3cgJiYgU1RPLmVuZFRpbWUoKSA+IFNUTy5zdGFydFRpbWUoKSk7CiAgICAgICAgYWxsb2NhdGlvbnNbX2F1ZGl0b3JdID0gQWxsb2NhdGlvbihfZmVlLCBfdmVzdGluZ1BlcmlvZCwgX3F1b3J1bSwgMCwgMCwgZmFsc2UpOwogICAgICAgIHNoYXJlaG9sZGVyc1thZGRyZXNzKFNUTyldID0gU2hhcmVob2xkZXIodGhpcywgdHJ1ZSwgNSk7CiAgICAgICAgc3RhcnRTVE8gPSBTVE8uc3RhcnRUaW1lKCk7CiAgICAgICAgZW5kU1RPID0gU1RPLmVuZFRpbWUoKTsKICAgICAgICBpc1NUT1Byb3Bvc2VkID0gIWlzU1RPUHJvcG9zZWQ7CiAgICAgICAgUG9seUNvbXBsaWFuY2UudXBkYXRlT2ZmZXJpbmdSZXB1dGF0aW9uKF9zdG9Db250cmFjdCwgX29mZmVyaW5nUHJvcG9zYWxJbmRleCk7CiAgICAgICAgTG9nU2V0U1RPQ29udHJhY3QoU1RPLCBfc3RvQ29udHJhY3QsIF9hdWRpdG9yLCBzdGFydFNUTywgZW5kU1RPKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU3RhcnQgdGhlIG9mZmVyaW5nIGJ5IHNlbmRpbmcgYWxsIHRoZSB0b2tlbnMgdG8gU1RPIGNvbnRyYWN0CiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRPZmZlcmluZygpIG9ubHlPd25lciBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGlzU1RPUHJvcG9zZWQpOwogICAgICAgIHJlcXVpcmUoIWhhc09mZmVyaW5nU3RhcnRlZCk7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudCA9IHRoaXMuYmFsYW5jZU9mKG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUodG9rZW5BbW91bnQgPT0gdG90YWxTdXBwbHkpOwogICAgICAgIGJhbGFuY2VzW1NUT10gPSBiYWxhbmNlc1tTVE9dLmFkZCh0b2tlbkFtb3VudCk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIodG9rZW5BbW91bnQpOwogICAgICAgIGhhc09mZmVyaW5nU3RhcnRlZCA9IHRydWU7CiAgICAgICAgVHJhbnNmZXIob3duZXIsIFNUTywgdG9rZW5BbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBZGQgYSB2ZXJpZmllZCBhZGRyZXNzIHRvIHRoZSBTZWN1cml0eSBUb2tlbiB3aGl0ZWxpc3QKICAgICAqIFRoZSBJc3N1ZXIgY2FuIGFkZCBhbiBhZGRyZXNzIHRvIHRoZSB3aGl0ZWxpc3QgYnkgdGhlbXNlbHZlcyBieQogICAgICogY3JlYXRpbmcgdGhlaXIgb3duIEtZQyBwcm92aWRlciBhbmQgdXNpbmcgaXQgdG8gdmVyaWZ5IHRoZSBhY2NvdW50cwogICAgICogdGhleSB3YW50IHRvIGFkZCB0byB0aGUgd2hpdGVsaXN0LgogICAgICogQHBhcmFtIF93aGl0ZWxpc3RBZGRyZXNzIEFkZHJlc3MgYXR0ZW1wdGluZyB0byBqb2luIFNUIHdoaXRlbGlzdAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gYWRkVG9XaGl0ZWxpc3QoYWRkcmVzcyBfd2hpdGVsaXN0QWRkcmVzcykgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB2YXIgKGNvdW50cnlKdXJpc2RpY3Rpb24sIGRpdmlzaW9uSnVyaXNkaWN0aW9uLCBhY2NyZWRpdGVkLCByb2xlLCB2ZXJpZmllZCwgZXhwaXJlcykgPSBQb2x5Q3VzdG9tZXJzLmdldEN1c3RvbWVyKEtZQywgX3doaXRlbGlzdEFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUodmVyaWZpZWQgJiYgZXhwaXJlcyA+IG5vdyk7CiAgICAgICAgcmVxdWlyZShUZW1wbGF0ZS5jaGVja1RlbXBsYXRlUmVxdWlyZW1lbnRzKGNvdW50cnlKdXJpc2RpY3Rpb24sIGRpdmlzaW9uSnVyaXNkaWN0aW9uLCBhY2NyZWRpdGVkLCByb2xlKSk7CiAgICAgICAgc2hhcmVob2xkZXJzW193aGl0ZWxpc3RBZGRyZXNzXSA9IFNoYXJlaG9sZGVyKG1zZy5zZW5kZXIsIHRydWUsIHJvbGUpOwogICAgICAgIExvZ05ld1doaXRlbGlzdGVkQWRkcmVzcyhtc2cuc2VuZGVyLCBfd2hpdGVsaXN0QWRkcmVzcywgcm9sZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFkZCBhIHZlcmlmaWVkIGFkZHJlc3MgdG8gdGhlIFNlY3VyaXR5IFRva2VuIGJsYWNrbGlzdAogICAgICogQHBhcmFtIF9ibGFja2xpc3RBZGRyZXNzIEFkZHJlc3MgYmVpbmcgYWRkZWQgdG8gdGhlIGJsYWNrbGlzdAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gYWRkVG9CbGFja2xpc3QoYWRkcmVzcyBfYmxhY2tsaXN0QWRkcmVzcykgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHNoYXJlaG9sZGVyc1tfYmxhY2tsaXN0QWRkcmVzc10uYWxsb3dlZCk7CiAgICAgICAgc2hhcmVob2xkZXJzW19ibGFja2xpc3RBZGRyZXNzXS5hbGxvd2VkID0gZmFsc2U7CiAgICAgICAgTG9nTmV3QmxhY2tsaXN0ZWRBZGRyZXNzKG1zZy5zZW5kZXIsIF9ibGFja2xpc3RBZGRyZXNzKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3cgUE9MWSBhbGxvY2F0aW9ucyB0byBiZSB3aXRoZHJhd24gYnkgb3duZXIsIGRlbGVnYXRlLCBhbmQgdGhlIFNUTyBhdWRpdG9yIGF0IGFwcHJvcHJpYXRlIHRpbWVzCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BvbHkoKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgCSAgICBpZiAoZGVsZWdhdGUgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgcmV0dXJuIFBPTFkudHJhbnNmZXIob3duZXIsIFBPTFkuYmFsYW5jZU9mKHRoaXMpKTsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShub3cgPiBlbmRTVE8gKyBhbGxvY2F0aW9uc1ttc2cuc2VuZGVyXS52ZXN0aW5nUGVyaW9kKTsKICAgICAgICByZXF1aXJlKCFhbGxvY2F0aW9uc1ttc2cuc2VuZGVyXS5mcm96ZW4pOwogICAgICAgIHJlcXVpcmUoYWxsb2NhdGlvbnNbbXNnLnNlbmRlcl0uYW1vdW50ID4gMCk7CiAgICAgICAgcmVxdWlyZShQT0xZLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFsbG9jYXRpb25zW21zZy5zZW5kZXJdLmFtb3VudCkpOwogICAgICAgIGFsbG9jYXRpb25zW21zZy5zZW5kZXJdLmFtb3VudCA9IDA7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFZvdGUgdG8gZnJlZXplIHRoZSBmZWUgb2YgYSBjZXJ0YWluIG5ldHdvcmsgcGFydGljaXBhbnQKICAgICAqIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBmZWUgcmVjaXBpZW50IGJlaW5nIHByb3Rlc3RlZAogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gdm90ZVRvRnJlZXplKGFkZHJlc3MgX3JlY2lwaWVudCkgcHVibGljIG9ubHlTaGFyZWhvbGRlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGRlbGVnYXRlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobm93ID4gZW5kU1RPKTsKICAgICAgICByZXF1aXJlKG5vdyA8IGVuZFNUTy5hZGQoYWxsb2NhdGlvbnNbX3JlY2lwaWVudF0udmVzdGluZ1BlcmlvZCkpOwogICAgICAgIHJlcXVpcmUoIXZvdGVkW21zZy5zZW5kZXJdW19yZWNpcGllbnRdKTsKICAgICAgICB2b3RlZFttc2cuc2VuZGVyXVtfcmVjaXBpZW50XSA9IHRydWU7CiAgICAgICAgYWxsb2NhdGlvbnNbX3JlY2lwaWVudF0ueWF5Vm90ZXMgPSBhbGxvY2F0aW9uc1tfcmVjaXBpZW50XS55YXlWb3Rlcy5hZGQoY29udHJpYnV0ZWRUb1NUT1ttc2cuc2VuZGVyXSk7CiAgICAgICAgYWxsb2NhdGlvbnNbX3JlY2lwaWVudF0ueWF5UGVyY2VudCA9IGFsbG9jYXRpb25zW19yZWNpcGllbnRdLnlheVZvdGVzLm11bCgxMDApLmRpdihhbGxvY2F0aW9uc1tvd25lcl0uYW1vdW50KTsKICAgICAgICBpZiAoYWxsb2NhdGlvbnNbX3JlY2lwaWVudF0ueWF5UGVyY2VudCA+PSBhbGxvY2F0aW9uc1tfcmVjaXBpZW50XS5xdW9ydW0pIHsKICAgICAgICAgIGFsbG9jYXRpb25zW19yZWNpcGllbnRdLmZyb3plbiA9IHRydWU7CiAgICAgICAgfQogICAgICAgIExvZ1ZvdGVUb0ZyZWV6ZShfcmVjaXBpZW50LCBhbGxvY2F0aW9uc1tfcmVjaXBpZW50XS55YXlQZXJjZW50LCBhbGxvY2F0aW9uc1tfcmVjaXBpZW50XS5xdW9ydW0sIGFsbG9jYXRpb25zW19yZWNpcGllbnRdLmZyb3plbik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoJLyoqCiAgICAgKiBAZGV2IGBpc3N1ZVNlY3VyaXR5VG9rZW5zYCBpcyB1c2VkIGJ5IHRoZSBTVE8gdG8ga2VlcCB0cmFjayBvZiBTVE8gaW52ZXN0b3JzCiAgICAgKiBAcGFyYW0gX2NvbnRyaWJ1dG9yIFRoZSBhZGRyZXNzIG9mIHRoZSBwZXJzb24gd2hvc2UgY29udHJpYnV0aW5nCiAgICAgKiBAcGFyYW0gX2Ftb3VudE9mU2VjdXJpdHlUb2tlbnMgVGhlIGFtb3VudCBvZiBTVCB0byBwYXkgb3V0LgogICAgICogQHBhcmFtIF9wb2x5Q29udHJpYnV0ZWQgVGhlIGFtb3VudCBvZiBQT0xZIHBhaWQgZm9yIHRoZSBzZWN1cml0eSB0b2tlbnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzc3VlU2VjdXJpdHlUb2tlbnMoYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQyNTYgX2Ftb3VudE9mU2VjdXJpdHlUb2tlbnMsIHVpbnQyNTYgX3BvbHlDb250cmlidXRlZCkgcHVibGljIG9ubHlTVE8gcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy8gQ2hlY2sgd2hldGhlciB0aGUgb2ZmZXJpbmcgYWN0aXZlIG9yIG5vdAogICAgICAgIHJlcXVpcmUoaGFzT2ZmZXJpbmdTdGFydGVkKTsKICAgICAgICAvLyBUaGUgX2NvbnRyaWJ1dG9yIGJlaW5nIGlzc3VlZCB0b2tlbnMgbXVzdCBiZSBpbiB0aGUgd2hpdGVsaXN0CiAgICAgICAgcmVxdWlyZShzaGFyZWhvbGRlcnNbX2NvbnRyaWJ1dG9yXS5hbGxvd2VkKTsKICAgICAgICAvLyBUb2tlbnMgbWF5IG9ubHkgYmUgaXNzdWVkIHdoaWxlIHRoZSBTVE8gaXMgcnVubmluZwogICAgICAgIHJlcXVpcmUobm93ID49IHN0YXJ0U1RPICYmIG5vdyA8PSBlbmRTVE8pOwogICAgICAgIC8vIEluIG9yZGVyIHRvIGlzc3VlIHRoZSBTVCwgdGhlIF9jb250cmlidXRvciBmaXJzdCBwYXlzIGluIFBPTFkKICAgICAgICByZXF1aXJlKFBPTFkudHJhbnNmZXJGcm9tKF9jb250cmlidXRvciwgdGhpcywgX3BvbHlDb250cmlidXRlZCkpOwogICAgICAgIC8vIFNUIGJlaW5nIGlzc3VlZCBjYW4ndCBiZSBoaWdoZXIgdGhhbiB0aGUgdG90YWxTdXBwbHkKICAgICAgICByZXF1aXJlKHRva2Vuc0lzc3VlZEJ5U1RPLmFkZChfYW1vdW50T2ZTZWN1cml0eVRva2VucykgPD0gdG90YWxTdXBwbHkpOwogICAgICAgIC8vIFBPTFkgY29udHJpYnV0ZWQgY2FuJ3QgYmUgaGlnaGVyIHRoYW4gbWF4UG9seSBzZXQgYnkgU1RPCiAgICAgICAgcmVxdWlyZShtYXhQb2x5ID49IGFsbG9jYXRpb25zW293bmVyXS5hbW91bnQuYWRkKF9wb2x5Q29udHJpYnV0ZWQpKTsKICAgICAgICAvLyBVcGRhdGUgU1QgYmFsYW5jZXMgKHRyYW5zZmVycyBTVCBmcm9tIFNUTyB0byBfY29udHJpYnV0b3IpCiAgICAgICAgYmFsYW5jZXNbU1RPXSA9IGJhbGFuY2VzW1NUT10uc3ViKF9hbW91bnRPZlNlY3VyaXR5VG9rZW5zKTsKICAgICAgICBiYWxhbmNlc1tfY29udHJpYnV0b3JdID0gYmFsYW5jZXNbX2NvbnRyaWJ1dG9yXS5hZGQoX2Ftb3VudE9mU2VjdXJpdHlUb2tlbnMpOwogICAgICAgIC8vIEVSQzIwIFRyYW5zZmVyIGV2ZW50CiAgICAgICAgVHJhbnNmZXIoU1RPLCBfY29udHJpYnV0b3IsIF9hbW91bnRPZlNlY3VyaXR5VG9rZW5zKTsKICAgICAgICAvLyBVcGRhdGUgdGhlIGFtb3VudCBvZiB0b2tlbnMgaXNzdWVkIGJ5IFNUTwogICAgICAgIHRva2Vuc0lzc3VlZEJ5U1RPID0gdG9rZW5zSXNzdWVkQnlTVE8uYWRkKF9hbW91bnRPZlNlY3VyaXR5VG9rZW5zKTsKICAgICAgICAvLyBVcGRhdGUgdGhlIGFtb3VudCBvZiBQT0xZIGEgY29udHJpYnV0b3IgaGFzIGNvbnRyaWJ1dGVkIGFuZCBhbGxvY2F0ZWQgdG8gdGhlIG93bmVyCiAgICAgICAgY29udHJpYnV0ZWRUb1NUT1tfY29udHJpYnV0b3JdID0gY29udHJpYnV0ZWRUb1NUT1tfY29udHJpYnV0b3JdLmFkZChfcG9seUNvbnRyaWJ1dGVkKTsKICAgICAgICBhbGxvY2F0aW9uc1tvd25lcl0uYW1vdW50ID0gYWxsb2NhdGlvbnNbb3duZXJdLmFtb3VudC5hZGQoX3BvbHlDb250cmlidXRlZCk7CiAgICAgICAgTG9nVG9rZW5Jc3N1ZWQoX2NvbnRyaWJ1dG9yLCBfYW1vdW50T2ZTZWN1cml0eVRva2VucywgX3BvbHlDb250cmlidXRlZCwgbm93KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBHZXQgdG9rZW4gZGV0YWlscwogICAgZnVuY3Rpb24gZ2V0VG9rZW5EZXRhaWxzKCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcywgYWRkcmVzcywgYnl0ZXMzMiwgYWRkcmVzcywgYWRkcmVzcykgewogICAgICAgIHJldHVybiAoVGVtcGxhdGUsIGRlbGVnYXRlLCBtZXJrbGVSb290LCBTVE8sIEtZQyk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyBDdXN0b21pemVkIEVSQzIwIEZ1bmN0aW9ucyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIEBkZXYgVHJhc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICAgKiBAcGFyYW0gX3RvIEV0aGVyZXVtIHB1YmxpYyBhZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VucyB0bwogICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRvIHNlbmQKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChzaGFyZWhvbGRlcnNbX3RvXS5hbGxvd2VkICYmIHNoYXJlaG9sZGVyc1ttc2cuc2VuZGVyXS5hbGxvd2VkICYmIGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyBjb250cmFjdHMgdG8gdHJhbnNmZXIgdG9rZW5zIG9uIGJlaGFsZiBvZiB0b2tlbiBob2xkZXJzCiAgICAgKiBAcGFyYW0gX2Zyb20gQWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbnMgZnJvbQogICAgICogQHBhcmFtIF90byBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zIHRvCiAgICAgKiBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoc2hhcmVob2xkZXJzW190b10uYWxsb3dlZCAmJiBzaGFyZWhvbGRlcnNbX2Zyb21dLmFsbG93ZWQgJiYgYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBgYmFsYW5jZU9mYCB1c2VkIHRvIGdldCB0aGUgYmFsYW5jZSBvZiBzaGFyZWhvbGRlcnMKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgYmFsYW5jZQogICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQXBwcm92ZSB0cmFuc2ZlciBvZiB0b2tlbnMgbWFudWFsbHkKICAgICAqIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGFwcHJvdmUgdHJhbnNmZXIgdG8KICAgICAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2VucyB0byBhcHByb3ZlIGZvciB0cmFuc2ZlcgogICAgICogQHJldHVybiBib29sIHN1Y2Nlc3MKICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlICE9IDApOwogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVc2UgdG8gZ2V0IHRoZSBhbGxvd2FuY2UgcHJvdmlkZWQgdG8gdGhlIHNwZW5kZXIKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgICogQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9Cn0KCi8qCiAgVGhlIFBvbHltYXRoIFNlY3VyaXR5IFRva2VuIFJlZ2lzdHJhciBwcm92aWRlcyBhIHdheSB0byBsb29rdXAgc2VjdXJpdHkgdG9rZW4gZGV0YWlscwogIGZyb20gYSBzaW5nbGUgcGxhY2UgYW5kIGFsbG93cyB3aXphcmQgY3JlYXRvcnMgdG8gZWFybiBQT0xZIGZlZXMgYnkgdXBsb2FkaW5nIHRvIHRoZQogIHJlZ2lzdHJhci4KKi8KCgoKCgoKLyoqCiAqIEB0aXRsZSBTZWN1cml0eVRva2VuUmVnaXN0cmFyCiAqIEBkZXYgQ29udHJhY3QgdXNlIHRvIHJlZ2lzdGVyIHRoZSBzZWN1cml0eSB0b2tlbiBvbiBQb2x5bWF0aCBwbGF0Zm9ybQogKi8KCmNvbnRyYWN0IFNlY3VyaXR5VG9rZW5SZWdpc3RyYXIgaXMgSVNUUmVnaXN0cmFyIHsKCiAgICBzdHJpbmcgcHVibGljIFZFUlNJT04gPSAiMSI7CiAgICBTZWN1cml0eVRva2VuIHNlY3VyaXR5VG9rZW47CiAgICBhZGRyZXNzIHB1YmxpYyBwb2x5VG9rZW5BZGRyZXNzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzcyBvZiBQT0xZIHRva2VuCiAgICBhZGRyZXNzIHB1YmxpYyBwb2x5Q3VzdG9tZXJzQWRkcmVzczsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkcmVzcyBvZiB0aGUgcG9seW1hdGgtY29yZSBDdXN0b21lcnMgY29udHJhY3QgYWRkcmVzcwogICAgYWRkcmVzcyBwdWJsaWMgcG9seUNvbXBsaWFuY2VBZGRyZXNzOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHBvbHltYXRoLWNvcmUgQ29tcGxpYW5jZSBjb250cmFjdCBhZGRyZXNzCgogICAgLy8gU2VjdXJpdHkgVG9rZW4KICAgIHN0cnVjdCBTZWN1cml0eVRva2VuRGF0YSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBIHN0cnVjdHVyZSB0aGF0IGNvbnRhaW5zIHRoZSBzcGVjaWZpYyBpbmZvIG9mIGVhY2ggU1QKICAgICAgdWludDI1NiB0b3RhbFN1cHBseTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGVkIGV2ZXIgdXNpbmcgdGhlIFBvbHltYXRoIHBsYXRmb3JtCiAgICAgIGFkZHJlc3Mgb3duZXI7CiAgICAgIHVpbnQ4IGRlY2ltYWxzOwogICAgICBzdHJpbmcgdGlja2VyOwogICAgICB1aW50OCBzZWN1cml0eVR5cGU7CiAgICB9CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gU2VjdXJpdHlUb2tlbkRhdGEpIHNlY3VyaXR5VG9rZW5zOyAgICAgICAgICAgLy8gQXJyYXkgY29udGFpbnMgdGhlIGRldGFpbHMgb2Ygc2VjdXJpdHkgdG9rZW4gY29ycmVzcG9uZHMgdG8gc2VjdXJpdHkgdG9rZW4gYWRkcmVzcwogICAgbWFwcGluZyhzdHJpbmcgPT4gYWRkcmVzcykgdGlja2VyczsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1hcHBpbmcgb2YgdGlja2VyIG5hbWUgdG8gU2VjdXJpdHkgVG9rZW4KCiAgICBldmVudCBMb2dOZXdTZWN1cml0eVRva2VuKHN0cmluZyB0aWNrZXIsIGFkZHJlc3Mgc2VjdXJpdHlUb2tlbkFkZHJlc3MsIGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgaG9zdCwgdWludDI1NiBmZWUsIHVpbnQ4IF90eXBlKTsKICAgIC8qKgogICAgICogQGRldiBDb25zdHJ1Y3RvciB1c2UgdG8gc2V0IHRoZSBlc3NlbnRpYWxzIGFkZHJlc3NlcyB0byBmYWNpbGl0YXRlCiAgICAgKiB0aGUgY3JlYXRpb24gb2YgdGhlIHNlY3VyaXR5IHRva2VuCiAgICAgKi8KICAgIGZ1bmN0aW9uIFNlY3VyaXR5VG9rZW5SZWdpc3RyYXIoCiAgICAgIGFkZHJlc3MgX3BvbHlUb2tlbkFkZHJlc3MsCiAgICAgIGFkZHJlc3MgX3BvbHlDdXN0b21lcnNBZGRyZXNzLAogICAgICBhZGRyZXNzIF9wb2x5Q29tcGxpYW5jZUFkZHJlc3MKICAgICkgcHVibGljCiAgICB7CiAgICAgIHBvbHlUb2tlbkFkZHJlc3MgPSBfcG9seVRva2VuQWRkcmVzczsKICAgICAgcG9seUN1c3RvbWVyc0FkZHJlc3MgPSBfcG9seUN1c3RvbWVyc0FkZHJlc3M7CiAgICAgIHBvbHlDb21wbGlhbmNlQWRkcmVzcyA9IF9wb2x5Q29tcGxpYW5jZUFkZHJlc3M7CiAgICAgIC8vIENyZWF0aW5nIHRoZSBpbnN0YW5jZSBvZiB0aGUgY29tcGxpYW5jZSBjb250cmFjdCBhbmQgYXNzaWduIHRoZSBTVFIgY29udHJhY3QgCiAgICAgIC8vIGFkZHJlc3MgKHRoaXMpIGludG8gdGhlIGNvbXBsaWFuY2UgY29udHJhY3QKICAgICAgQ29tcGxpYW5jZSBQb2x5Q29tcGxpYW5jZSA9IENvbXBsaWFuY2UocG9seUNvbXBsaWFuY2VBZGRyZXNzKTsKICAgICAgcmVxdWlyZShQb2x5Q29tcGxpYW5jZS5zZXRSZWdzaXRyYXJBZGRyZXNzKHRoaXMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlcyBhIG5ldyBTZWN1cml0eSBUb2tlbiBhbmQgc2F2ZXMgaXQgdG8gdGhlIHJlZ2lzdHJ5CiAgICAgKiBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgc2VjdXJpdHkgdG9rZW4KICAgICAqIEBwYXJhbSBfdGlja2VyIFRpY2tlciBuYW1lIG9mIHRoZSBzZWN1cml0eQogICAgICogQHBhcmFtIF90b3RhbFN1cHBseSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGJlaW5nIGNyZWF0ZWQKICAgICAqIEBwYXJhbSBfZGVjaW1hbHMgRGVjaW1hbHMgdmFsdWUgZm9yIHRva2VuCiAgICAgKiBAcGFyYW0gX293bmVyIEV0aGVyZXVtIHB1YmxpYyBrZXkgYWRkcmVzcyBvZiB0aGUgc2VjdXJpdHkgdG9rZW4gb3duZXIKICAgICAqIEBwYXJhbSBfbWF4UG9seSBBbW91bnQgb2YgbWF4aW11bSBwb2x5IGlzc3VlciB3YW50IHRvIHJhaXNlCiAgICAgKiBAcGFyYW0gX2hvc3QgVGhlIGhvc3Qgb2YgdGhlIHNlY3VyaXR5IHRva2VuIHdpemFyZAogICAgICogQHBhcmFtIF9mZWUgRmVlIGJlaW5nIHJlcXVlc3RlZCBieSB0aGUgd2l6YXJkIGhvc3QKICAgICAqIEBwYXJhbSBfdHlwZSBUeXBlIG9mIHNlY3VyaXR5IGJlaW5nIHRva2VuaXplZAogICAgICogQHBhcmFtIF9sb2NrdXBQZXJpb2QgTGVuZ3RoIG9mIHRpbWUgcmFpc2VkIFBPTFkgd2lsbCBiZSBsb2NrZWQgdXAgZm9yIGRpc3B1dGUKICAgICAqIEBwYXJhbSBfcXVvcnVtIFBlcmNlbnQgb2YgaW5pdGlhbCBpbnZlc3RvcnMgcmVxdWlyZWQgdG8gZnJlZXplIFBPTFkgcmFpc2UKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlU2VjdXJpdHlUb2tlbiAoCiAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgc3RyaW5nIF90aWNrZXIsCiAgICAgIHVpbnQyNTYgX3RvdGFsU3VwcGx5LAogICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICB1aW50MjU2IF9tYXhQb2x5LAogICAgICBhZGRyZXNzIF9ob3N0LAogICAgICB1aW50MjU2IF9mZWUsCiAgICAgIHVpbnQ4IF90eXBlLAogICAgICB1aW50MjU2IF9sb2NrdXBQZXJpb2QsCiAgICAgIHVpbnQ4IF9xdW9ydW0KICAgICkgZXh0ZXJuYWwKICAgIHsKICAgICAgcmVxdWlyZShfdG90YWxTdXBwbHkgPiAwICYmIF9tYXhQb2x5ID4gMCAmJiBfZmVlID4gMCk7CiAgICAgIHJlcXVpcmUodGlja2Vyc1tfdGlja2VyXSA9PSAweDApOwogICAgICByZXF1aXJlKF9sb2NrdXBQZXJpb2QgPj0gbm93KTsKICAgICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSAmJiBfaG9zdCAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShieXRlcyhfbmFtZSkubGVuZ3RoID4gMCAmJiBieXRlcyhfdGlja2VyKS5sZW5ndGggPiAwKTsKICAgICAgSUVSQzIwIFBPTFkgPSBJRVJDMjAocG9seVRva2VuQWRkcmVzcyk7CiAgICAgIFBPTFkudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIF9ob3N0LCBfZmVlKTsKICAgICAgYWRkcmVzcyBuZXdTZWN1cml0eVRva2VuQWRkcmVzcyA9IGluaXRpYWxpc2VTZWN1cml0eVRva2VuKF9uYW1lLCBfdGlja2VyLCBfdG90YWxTdXBwbHksIF9kZWNpbWFscywgX293bmVyLCBfbWF4UG9seSwgX3R5cGUsIF9sb2NrdXBQZXJpb2QsIF9xdW9ydW0pOwogICAgICBMb2dOZXdTZWN1cml0eVRva2VuKF90aWNrZXIsIG5ld1NlY3VyaXR5VG9rZW5BZGRyZXNzLCBfb3duZXIsIF9ob3N0LCBfZmVlLCBfdHlwZSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdGlhbGlzZVNlY3VyaXR5VG9rZW4oCiAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgc3RyaW5nIF90aWNrZXIsCiAgICAgIHVpbnQyNTYgX3RvdGFsU3VwcGx5LAogICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICB1aW50MjU2IF9tYXhQb2x5LAogICAgICB1aW50OCBfdHlwZSwKICAgICAgdWludDI1NiBfbG9ja3VwUGVyaW9kLAogICAgICB1aW50OCBfcXVvcnVtCiAgICApIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpCiAgICB7CiAgICAgIGFkZHJlc3MgbmV3U2VjdXJpdHlUb2tlbkFkZHJlc3MgPSBuZXcgU2VjdXJpdHlUb2tlbigKICAgICAgICBfbmFtZSwKICAgICAgICBfdGlja2VyLAogICAgICAgIF90b3RhbFN1cHBseSwKICAgICAgICBfZGVjaW1hbHMsCiAgICAgICAgX293bmVyLAogICAgICAgIF9tYXhQb2x5LAogICAgICAgIF9sb2NrdXBQZXJpb2QsCiAgICAgICAgX3F1b3J1bSwKICAgICAgICBwb2x5VG9rZW5BZGRyZXNzLAogICAgICAgIHBvbHlDdXN0b21lcnNBZGRyZXNzLAogICAgICAgIHBvbHlDb21wbGlhbmNlQWRkcmVzcwogICAgICApOwogICAgICB0aWNrZXJzW190aWNrZXJdID0gbmV3U2VjdXJpdHlUb2tlbkFkZHJlc3M7CiAgICAgIHNlY3VyaXR5VG9rZW5zW25ld1NlY3VyaXR5VG9rZW5BZGRyZXNzXSA9IFNlY3VyaXR5VG9rZW5EYXRhKAogICAgICAgIF90b3RhbFN1cHBseSwKICAgICAgICBfb3duZXIsCiAgICAgICAgX2RlY2ltYWxzLAogICAgICAgIF90aWNrZXIsCiAgICAgICAgX3R5cGUKICAgICAgKTsKICAgICAgcmV0dXJuIG5ld1NlY3VyaXR5VG9rZW5BZGRyZXNzOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vLy8vLy8vIEdldCBGdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLyoqCiAgICAgKiBAZGV2IEdldCBzZWN1cml0eSB0b2tlbiBhZGRyZXNzIGJ5IHRpY2tlciBuYW1lCiAgICAgKiBAcGFyYW0gX3RpY2tlciBTeW1ib2wgb2YgdGhlIFNjdXJpdHkgdG9rZW4KICAgICAqIEByZXR1cm4gYWRkcmVzcyBfdGlja2VyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFNlY3VyaXR5VG9rZW5BZGRyZXNzKHN0cmluZyBfdGlja2VyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICByZXR1cm4gdGlja2Vyc1tfdGlja2VyXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgR2V0IFNlY3VyaXR5IHRva2VuIGRldGFpbHMgYnkgaXRzIGV0aGVyZXVtIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfU1RBZGRyZXNzIFNlY3VyaXR5IHRva2VuIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0U2VjdXJpdHlUb2tlbkRhdGEoYWRkcmVzcyBfU1RBZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgIHVpbnQyNTYgdG90YWxTdXBwbHksCiAgICAgIGFkZHJlc3Mgb3duZXIsCiAgICAgIHVpbnQ4IGRlY2ltYWxzLAogICAgICBzdHJpbmcgdGlja2VyLAogICAgICB1aW50OCBzZWN1cml0eVR5cGUKICAgICkgewogICAgICByZXR1cm4gKAogICAgICAgIHNlY3VyaXR5VG9rZW5zW19TVEFkZHJlc3NdLnRvdGFsU3VwcGx5LAogICAgICAgIHNlY3VyaXR5VG9rZW5zW19TVEFkZHJlc3NdLm93bmVyLAogICAgICAgIHNlY3VyaXR5VG9rZW5zW19TVEFkZHJlc3NdLmRlY2ltYWxzLAogICAgICAgIHNlY3VyaXR5VG9rZW5zW19TVEFkZHJlc3NdLnRpY2tlciwKICAgICAgICBzZWN1cml0eVRva2Vuc1tfU1RBZGRyZXNzXS5zZWN1cml0eVR5cGUKICAgICAgKTsKICAgIH0KCn0KCi8qCiAgUG9seW1hdGggY29tcGxpYW5jZSBwcm90b2NvbCBpcyBpbnRlbmRlZCB0byBlbnN1cmUgcmVndWxhdG9yeSBjb21wbGlhbmNlCiAgaW4gdGhlIGp1cmlzZGljdGlvbnMgdGhhdCBzZWN1cml0eSB0b2tlbnMgYXJlIGJlaW5nIG9mZmVyZWQgaW4uIFRoZSBjb21wbGlhbmNlCiAgcHJvdG9jb2wgYWxsb3dzIHNlY3VyaXR5IHRva2VucyByZW1haW4gaW50ZXJvcGVyYWJsZSBzbyB0aGF0IGFueW9uZSBjYW4KICBidWlsZCBvbiB0b3Agb2YgdGhlIFBvbHltYXRoIHBsYXRmb3JtIGFuZCBleHRlbmQgaXQncyBmdW5jdGlvbmFsaXR5LgoqLwoKCgoKCgoKLyoqCiAqIEB0aXRsZSBDb21waWxhbmNlCiAqIEBkZXYgUmVndWxhdG9yeSBkZXRhaWxzIG9mZmVyZWQgYnkgdGhlIHNlY3VyaXR5IHRva2VuCiAqLwoKY29udHJhY3QgQ29tcGxpYW5jZSBpcyBJQ29tcGxpYW5jZSB7CgogICAgc3RyaW5nIHB1YmxpYyBWRVJTSU9OID0gIjEiOwoKICAgIElUZW1wbGF0ZSB0ZW1wbGF0ZTsKCiAgICBTZWN1cml0eVRva2VuUmVnaXN0cmFyIHB1YmxpYyBTVFJlZ2lzdHJhcjsKCiAgICBzdHJ1Y3QgVGVtcGxhdGVSZXB1dGF0aW9uIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0cnVjdHVyZSBjb250YWlucyB0aGUgY29tcGxpYW5jZSB0ZW1wbGF0ZSBkZXRhaWxzCiAgICAgICAgYWRkcmVzcyBvd25lcjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHRlbXBsYXRlIG93bmVyCiAgICAgICAgdWludDI1NiB0b3RhbFJhaXNlZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRvdGFsIGFtb3VudCByYWlzZWQgYnkgdGhlIGlzc3VlcnMgdGhhdCB1c2VkIHRoZSB0ZW1wbGF0ZQogICAgICAgIHVpbnQyNTYgdGltZXNVc2VkOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIb3cgbWFueSB0aW1lcyB0ZW1wbGF0ZSB3aWxsIGJlIHVzZWQgYXMgdGhlIGNvbXBsaWFuY2UgcmVndWxhdG9yIGZvciBkaWZmZXJlbnQgc2VjdXJpdHkgdG9rZW4KICAgICAgICB1aW50MjU2IGV4cGlyZXM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGltZXN0YW1wIHdoZW4gdGVtcGxhdGUgZ2V0IGV4cGlyZQogICAgICAgIGFkZHJlc3NbXSB1c2VkQnk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcnJheSBvZiBzZWN1cml0eSB0b2tlbiBhZGRyZXNzZXMgdGhhdCB1c2VkIHRoZSBwYXJ0aWN1bGFyIHRlbXBsYXRlCiAgICB9CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gVGVtcGxhdGVSZXB1dGF0aW9uKSBwdWJsaWMgdGVtcGxhdGVzOyAgICAgICAgICAgICAgICAgICAvLyBNYXBwaW5nIHVzZWQgZm9yIHN0b3JpbmcgdGhlIHRlbXBsYXRlIHBhc3QgcmVjb3JkcyBjb3JyZXNwb25kcyB0byB0ZW1wbGF0ZSBhZGRyZXNzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYWRkcmVzc1tdKSBwdWJsaWMgdGVtcGxhdGVQcm9wb3NhbHM7ICAgICAgICAgICAgIC8vIFRlbXBsYXRlIHByb3Bvc2FscyBmb3IgYSBzcGVjaWZpYyBzZWN1cml0eSB0b2tlbgoKICAgIHN0cnVjdCBPZmZlcmluZyB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU21hcnQgY29udHJhY3QgcHJvcG9zYWxzIGZvciBhIHNwZWNpZmljIHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nCiAgICAgICAgYWRkcmVzcyBhdWRpdG9yOwogICAgICAgIHVpbnQyNTYgZmVlOwogICAgICAgIHVpbnQyNTYgdmVzdGluZ1BlcmlvZDsKICAgICAgICB1aW50OCBxdW9ydW07CiAgICAgICAgYWRkcmVzc1tdIHVzZWRCeTsKICAgIH0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBPZmZlcmluZykgb2ZmZXJpbmdzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWFwcGluZyB1c2VkIGZvciBzdG9yaW5nIHRoZSBPZmZlcmluZyBkZXRpYWxzIGNvcnJlc3BvbmRzIHRvIG9mZmVyaW5nIGNvbnRyYWN0IGFkZHJlc3MKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBhZGRyZXNzW10pIHB1YmxpYyBvZmZlcmluZ1Byb3Bvc2FsczsgICAgICAgICAgICAgLy8gU2VjdXJpdHkgdG9rZW4gY29udHJhY3QgcHJvcG9zYWxzIGZvciBhIHNwZWNpZmljIHNlY3VyaXR5IHRva2VuCgogICAgQ3VzdG9tZXJzIHB1YmxpYyBQb2x5Q3VzdG9tZXJzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGFuY2Ugb2YgdGhlIENvbXBsaWFuY2UgY29udHJhY3QKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IE1JTklNVU1fVkVTVElOR19QRVJJT0QgPSA2MCAqIDYwICogMjQgKiAxMDA7IC8vIDEwMCBEYXkgbWluaW11bSB2ZXN0aW5nIHBlcmlvZCBmb3IgUE9MWSBlYXJuZWQKCiAgICAvLyBOb3RpZmljYXRpb25zCiAgICBldmVudCBMb2dUZW1wbGF0ZUNyZWF0ZWQoYWRkcmVzcyBpbmRleGVkIF9jcmVhdG9yLCBhZGRyZXNzIF90ZW1wbGF0ZSwgc3RyaW5nIF9vZmZlcmluZ1R5cGUpOwogICAgZXZlbnQgTG9nTmV3VGVtcGxhdGVQcm9wb3NhbChhZGRyZXNzIGluZGV4ZWQgX3NlY3VyaXR5VG9rZW4sIGFkZHJlc3MgX3RlbXBsYXRlLCBhZGRyZXNzIF9kZWxlZ2F0ZSwgdWludCBfdGVtcGxhdGVQcm9wb3NhbEluZGV4KTsKICAgIGV2ZW50IExvZ0NhbmNlbFRlbXBsYXRlUHJvcG9zYWwoYWRkcmVzcyBpbmRleGVkIF9zZWN1cml0eVRva2VuLCBhZGRyZXNzIF90ZW1wbGF0ZSwgdWludCBfdGVtcGxhdGVQcm9wb3NhbEluZGV4KTsKICAgIGV2ZW50IExvZ05ld0NvbnRyYWN0UHJvcG9zYWwoYWRkcmVzcyBpbmRleGVkIF9zZWN1cml0eVRva2VuLCBhZGRyZXNzIF9vZmZlcmluZ0NvbnRyYWN0LCBhZGRyZXNzIF9kZWxlZ2F0ZSwgdWludCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KTsKICAgIGV2ZW50IExvZ0NhbmNlbENvbnRyYWN0UHJvcG9zYWwoYWRkcmVzcyBpbmRleGVkIF9zZWN1cml0eVRva2VuLCBhZGRyZXNzIF9vZmZlcmluZ0NvbnRyYWN0LCB1aW50IF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgpOwoKICAgIC8qIEBwYXJhbSBfcG9seUN1c3RvbWVyc0FkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIFBvbHltYXRoIEN1c3RvbWVycyBjb250cmFjdCAqLwogICAgZnVuY3Rpb24gQ29tcGxpYW5jZShhZGRyZXNzIF9wb2x5Q3VzdG9tZXJzQWRkcmVzcykgcHVibGljIHsKICAgICAgICBQb2x5Q3VzdG9tZXJzID0gQ3VzdG9tZXJzKF9wb2x5Q3VzdG9tZXJzQWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGBzZXRSZWdzaXRyYXJBZGRyZXNzYCBUaGlzIGZ1bmN0aW9uIHNldCB0aGUgU2VjdXJpdHlUb2tlblJlZ2lzdHJhciBjb250cmFjdCBhZGRyZXNzLgogICAgICogQHBhcmFtIF9TVFJlZ2lzdHJhciBJdCBpcyB0aGUgYHRoaXNgIHJlZmVyZW5jZSBvZiBTVFIgY29udHJhY3QKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCgogICAgZnVuY3Rpb24gc2V0UmVnc2l0cmFyQWRkcmVzcyhhZGRyZXNzIF9TVFJlZ2lzdHJhcikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKFNUUmVnaXN0cmFyID09IGFkZHJlc3MoMCkpOwogICAgICAgIFNUUmVnaXN0cmFyID0gU2VjdXJpdHlUb2tlblJlZ2lzdHJhcihfU1RSZWdpc3RyYXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBgY3JlYXRlVGVtcGxhdGVgIGlzIGEgc2ltcGxlIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBjb21wbGlhbmNlIHRlbXBsYXRlCiAgICAgKiBAcGFyYW0gX29mZmVyaW5nVHlwZSBUaGUgbmFtZSBvZiB0aGUgc2VjdXJpdHkgYmVpbmcgaXNzdWVkCiAgICAgKiBAcGFyYW0gX2lzc3Vlckp1cmlzZGljdGlvbiBUaGUganVyaXNkaWN0aW9uIGlkIG9mIHRoZSBpc3N1ZXIKICAgICAqIEBwYXJhbSBfYWNjcmVkaXRlZCBBY2NyZWRpdGF0aW9uIHN0YXR1cyByZXF1aXJlZCBmb3IgaW52ZXN0b3JzCiAgICAgKiBAcGFyYW0gX0tZQyBLWUMgcHJvdmlkZXIgdXNlZCBieSB0aGUgdGVtcGxhdGUKICAgICAqIEBwYXJhbSBfZGV0YWlscyBEZXRhaWxzIG9mIHRoZSBvZmZlcmluZyByZXF1aXJlbWVudHMKICAgICAqIEBwYXJhbSBfZXhwaXJlcyBUaW1lc3RhbXAgb2Ygd2hlbiB0aGUgdGVtcGxhdGUgd2lsbCBleHBpcmUKICAgICAqIEBwYXJhbSBfZmVlIEFtb3VudCBvZiBQT0xZIHRvIHVzZSB0aGUgdGVtcGxhdGUgKGhlbGQgaW4gZXNjcm93IHVudGlsIGlzc3VhbmNlKQogICAgICogQHBhcmFtIF9xdW9ydW0gTWluaW11bSBwZXJjZW50IG9mIHNoYXJlaG9sZGVycyB3aGljaCBuZWVkIHRvIHZvdGUgdG8gZnJlZXplCiAgICAgKiBAcGFyYW0gX3Zlc3RpbmdQZXJpb2QgTGVuZ3RoIG9mIHRpbWUgdG8gdmVzdCBmdW5kcwogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVUZW1wbGF0ZSgKICAgICAgICBzdHJpbmcgX29mZmVyaW5nVHlwZSwKICAgICAgICBieXRlczMyIF9pc3N1ZXJKdXJpc2RpY3Rpb24sCiAgICAgICAgYm9vbCBfYWNjcmVkaXRlZCwKICAgICAgICBhZGRyZXNzIF9LWUMsCiAgICAgICAgYnl0ZXMzMiBfZGV0YWlscywKICAgICAgICB1aW50MjU2IF9leHBpcmVzLAogICAgICAgIHVpbnQyNTYgX2ZlZSwKICAgICAgICB1aW50OCBfcXVvcnVtLAogICAgICAgIHVpbnQyNTYgX3Zlc3RpbmdQZXJpb2QKICAgICkgcHVibGljCiAgICB7CiAgICAgIHJlcXVpcmUoX0tZQyAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShfdmVzdGluZ1BlcmlvZCA+PSBNSU5JTVVNX1ZFU1RJTkdfUEVSSU9EKTsKICAgICAgYWRkcmVzcyBfdGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUoCiAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgX29mZmVyaW5nVHlwZSwKICAgICAgICAgIF9pc3N1ZXJKdXJpc2RpY3Rpb24sCiAgICAgICAgICBfYWNjcmVkaXRlZCwKICAgICAgICAgIF9LWUMsCiAgICAgICAgICBfZGV0YWlscywKICAgICAgICAgIF9leHBpcmVzLAogICAgICAgICAgX2ZlZSwKICAgICAgICAgIF9xdW9ydW0sCiAgICAgICAgICBfdmVzdGluZ1BlcmlvZAogICAgICApOwogICAgICB0ZW1wbGF0ZXNbX3RlbXBsYXRlXSA9IFRlbXBsYXRlUmVwdXRhdGlvbih7CiAgICAgICAgICBvd25lcjogbXNnLnNlbmRlciwKICAgICAgICAgIHRvdGFsUmFpc2VkOiAwLAogICAgICAgICAgdGltZXNVc2VkOiAwLAogICAgICAgICAgZXhwaXJlczogX2V4cGlyZXMsCiAgICAgICAgICB1c2VkQnk6IG5ldyBhZGRyZXNzW10oMCkKICAgICAgfSk7CiAgICAgIExvZ1RlbXBsYXRlQ3JlYXRlZChtc2cuc2VuZGVyLCBfdGVtcGxhdGUsIF9vZmZlcmluZ1R5cGUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBQcm9wb3NlIGEgYmlkIGZvciBhIHNlY3VyaXR5IHRva2VuIGlzc3VhbmNlCiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW4gVGhlIHNlY3VyaXR5IHRva2VuIGJlaW5nIGJpZCBvbgogICAgICogQHBhcmFtIF90ZW1wbGF0ZSBUaGUgdW5pcXVlIHRlbXBsYXRlIGFkZHJlc3MKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3Bvc2VUZW1wbGF0ZSgKICAgICAgICBhZGRyZXNzIF9zZWN1cml0eVRva2VuLAogICAgICAgIGFkZHJlc3MgX3RlbXBsYXRlCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgLy8gVmVyaWZ5aW5nIHRoYXQgcHJvdmlkZWQgX3NlY3VyaXR5VG9rZW4gaXMgZ2VuZXJhdGVkIGJ5IHNlY3VyaXR5VG9rZW5SZWdpc3RyYXIgb25seQogICAgICAgIHZhciAodG90YWxTdXBwbHksIG93bmVyLCwpID0gU1RSZWdpc3RyYXIuZ2V0U2VjdXJpdHlUb2tlbkRhdGEoX3NlY3VyaXR5VG9rZW4pOwogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkgPiAwICYmIG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIFJlcXVpcmUgdGhhdCB0ZW1wbGF0ZSBoYXMgbm90IGV4cGlyZWQsIHRoYXQgdGhlIGNhbGxlciBpcyB0aGUKICAgICAgICAvLyBvd25lciBvZiB0aGUgdGVtcGxhdGUgYW5kIHRoYXQgdGhlIHRlbXBsYXRlIGhhcyBiZWVuIGZpbmFsaXplZAogICAgICAgIHJlcXVpcmUodGVtcGxhdGVzW190ZW1wbGF0ZV0uZXhwaXJlcyA+IG5vdyk7CiAgICAgICAgcmVxdWlyZSh0ZW1wbGF0ZXNbX3RlbXBsYXRlXS5vd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAvLyBDcmVhdGluZyB0aGUgaW5zdGFuY2Ugb2YgdGVtcGxhdGUgdG8gYXZhaWwgdGhlIGZ1bmN0aW9uIGNhbGxpbmcKICAgICAgICB0ZW1wbGF0ZSA9IFRlbXBsYXRlKF90ZW1wbGF0ZSk7CiAgICAgICAgdmFyICgsZmluYWxpemVkKSA9IHRlbXBsYXRlLmdldFRlbXBsYXRlRGV0YWlscygpOwogICAgICAgIHJlcXVpcmUoZmluYWxpemVkKTsKCiAgICAgICAgLy9HZXQgYSByZWZlcmVuY2Ugb2YgdGhlIHRlbXBsYXRlIGNvbnRyYWN0IGFuZCBhZGQgaXQgdG8gdGhlIHRlbXBsYXRlUHJvcG9zYWxzIGFycmF5CiAgICAgICAgdGVtcGxhdGVQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5dLnB1c2goX3RlbXBsYXRlKTsKICAgICAgICBMb2dOZXdUZW1wbGF0ZVByb3Bvc2FsKF9zZWN1cml0eVRva2VuLCBfdGVtcGxhdGUsIG1zZy5zZW5kZXIsdGVtcGxhdGVQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5dLmxlbmd0aCAtMSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbmNlbCBhIFRlbXBsYXRlIHByb3Bvc2FsIGlmIHRoZSBiaWQgaGFzbid0IGJlZW4gYWNjZXB0ZWQKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlUHJvcG9zYWxJbmRleCBUaGUgdGVtcGxhdGUgcHJvcG9zYWwgYXJyYXkgaW5kZXgKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbmNlbFRlbXBsYXRlUHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfc2VjdXJpdHlUb2tlbiwKICAgICAgICB1aW50MjU2IF90ZW1wbGF0ZVByb3Bvc2FsSW5kZXgKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBhZGRyZXNzIHByb3Bvc2VkVGVtcGxhdGUgPSB0ZW1wbGF0ZVByb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl1bX3RlbXBsYXRlUHJvcG9zYWxJbmRleF07CiAgICAgICAgcmVxdWlyZSh0ZW1wbGF0ZXNbcHJvcG9zZWRUZW1wbGF0ZV0ub3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgdmFyIChjaG9zZW5UZW1wbGF0ZSwsLCwpID0gSVNlY3VyaXR5VG9rZW4oX3NlY3VyaXR5VG9rZW4pLmdldFRva2VuRGV0YWlscygpOwogICAgICAgIHJlcXVpcmUoY2hvc2VuVGVtcGxhdGUgIT0gcHJvcG9zZWRUZW1wbGF0ZSk7CiAgICAgICAgdGVtcGxhdGVQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5dW190ZW1wbGF0ZVByb3Bvc2FsSW5kZXhdID0gYWRkcmVzcygwKTsKICAgICAgICBMb2dDYW5jZWxUZW1wbGF0ZVByb3Bvc2FsKF9zZWN1cml0eVRva2VuLCBwcm9wb3NlZFRlbXBsYXRlLCBfdGVtcGxhdGVQcm9wb3NhbEluZGV4KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCB0aGUgU1RPIGNvbnRyYWN0IGJ5IHRoZSBpc3N1ZXIuCiAgICAgKiBAcGFyYW0gX1NUT0FkZHJlc3MgYWRkcmVzcyBvZiB0aGUgU1RPIGNvbnRyYWN0IGRlcGxveWVkIG92ZXIgdGhlIG5ldHdvcmsuCiAgICAgKiBAcGFyYW0gX2ZlZSBmZWUgdG8gYmUgcGFpZCBpbiBwb2x5IHRvIHVzZSB0aGF0IGNvbnRyYWN0CiAgICAgKiBAcGFyYW0gX3Zlc3RpbmdQZXJpb2Qgbm8uIG9mIGRheXMgaW52ZXN0b3IgYmluZGVkIHRvIGhvbGQgdGhlIFNlY3VyaXR5IHRva2VuCiAgICAgKiBAcGFyYW0gX3F1b3J1bSBNaW5pbXVtIHBlcmNlbnQgb2Ygc2hhcmVob2xkZXJzIHdoaWNoIG5lZWQgdG8gdm90ZSB0byBmcmVlemUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0U1RPICgKICAgICAgICBhZGRyZXNzIF9TVE9BZGRyZXNzLAogICAgICAgIHVpbnQyNTYgX2ZlZSwKICAgICAgICB1aW50MjU2IF92ZXN0aW5nUGVyaW9kLAogICAgICAgIHVpbnQ4IF9xdW9ydW0KICAgICAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgICAgIHJlcXVpcmUob2ZmZXJpbmdzW19TVE9BZGRyZXNzXS5hdWRpdG9yID09IGFkZHJlc3MoMCkpOwogICAgICAgICAgICByZXF1aXJlKF9TVE9BZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICByZXF1aXJlKF9xdW9ydW0gPiAwICYmIF9xdW9ydW0gPD0gMTAwKTsKICAgICAgICAgICAgcmVxdWlyZShfdmVzdGluZ1BlcmlvZCA+PSBNSU5JTVVNX1ZFU1RJTkdfUEVSSU9EKTsKICAgICAgICAgICAgcmVxdWlyZShfZmVlID4gMCk7CiAgICAgICAgICAgIG9mZmVyaW5nc1tfU1RPQWRkcmVzc10uYXVkaXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgIG9mZmVyaW5nc1tfU1RPQWRkcmVzc10uZmVlID0gX2ZlZTsKICAgICAgICAgICAgb2ZmZXJpbmdzW19TVE9BZGRyZXNzXS52ZXN0aW5nUGVyaW9kID0gX3Zlc3RpbmdQZXJpb2Q7CiAgICAgICAgICAgIG9mZmVyaW5nc1tfU1RPQWRkcmVzc10ucXVvcnVtID0gX3F1b3J1bTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFByb3Bvc2UgYSBTZWN1cml0eSBUb2tlbiBPZmZlcmluZyBDb250cmFjdCBmb3IgYW4gaXNzdWFuY2UKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX3N0b0NvbnRyYWN0IFRoZSBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBjb250cmFjdCBhZGRyZXNzCiAgICAgKiBAcmV0dXJuIGJvb2wgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBwcm9wb3NlT2ZmZXJpbmdDb250cmFjdCgKICAgICAgICBhZGRyZXNzIF9zZWN1cml0eVRva2VuLAogICAgICAgIGFkZHJlc3MgX3N0b0NvbnRyYWN0CiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgLy8gVmVyaWZ5aW5nIHRoYXQgcHJvdmlkZWQgX3NlY3VyaXR5VG9rZW4gaXMgZ2VuZXJhdGVkIGJ5IHNlY3VyaXR5VG9rZW5SZWdpc3RyYXIgb25seQogICAgICAgIHZhciAodG90YWxTdXBwbHksIG93bmVyLCwpID0gU1RSZWdpc3RyYXIuZ2V0U2VjdXJpdHlUb2tlbkRhdGEoX3NlY3VyaXR5VG9rZW4pOwogICAgICAgIHJlcXVpcmUodG90YWxTdXBwbHkgPiAwICYmIG93bmVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB2YXIgKCwsLCxLWUMpID0gSVNlY3VyaXR5VG9rZW4oX3NlY3VyaXR5VG9rZW4pLmdldFRva2VuRGV0YWlscygpOwogICAgICAgIHZhciAoLCwsIHZlcmlmaWVkLCBleHBpcmVzKSA9IFBvbHlDdXN0b21lcnMuZ2V0Q3VzdG9tZXIoS1lDLCBvZmZlcmluZ3NbX3N0b0NvbnRyYWN0XS5hdWRpdG9yKTsKICAgICAgICByZXF1aXJlKG9mZmVyaW5nc1tfc3RvQ29udHJhY3RdLmF1ZGl0b3IgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZSh2ZXJpZmllZCk7CiAgICAgICAgcmVxdWlyZShleHBpcmVzID4gbm93KTsKICAgICAgICBvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl0ucHVzaChfc3RvQ29udHJhY3QpOwogICAgICAgIExvZ05ld0NvbnRyYWN0UHJvcG9zYWwoX3NlY3VyaXR5VG9rZW4sIF9zdG9Db250cmFjdCwgbXNnLnNlbmRlcixvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl0ubGVuZ3RoIC0xKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2FuY2VsIGEgU1RPIGNvbnRyYWN0IHByb3Bvc2FsIGlmIHRoZSBiaWQgaGFzbid0IGJlZW4gYWNjZXB0ZWQKICAgICAqIEBwYXJhbSBfc2VjdXJpdHlUb2tlbiBUaGUgc2VjdXJpdHkgdG9rZW4gYmVpbmcgYmlkIG9uCiAgICAgKiBAcGFyYW0gX29mZmVyaW5nUHJvcG9zYWxJbmRleCBUaGUgb2ZmZXJpbmcgcHJvcG9zYWwgYXJyYXkgaW5kZXgKICAgICAqIEByZXR1cm4gYm9vbCBzdWNjZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbmNlbE9mZmVyaW5nUHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfc2VjdXJpdHlUb2tlbiwKICAgICAgICB1aW50MjU2IF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBhZGRyZXNzIHByb3Bvc2VkT2ZmZXJpbmcgPSBvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl1bX29mZmVyaW5nUHJvcG9zYWxJbmRleF07CiAgICAgICAgcmVxdWlyZShvZmZlcmluZ3NbcHJvcG9zZWRPZmZlcmluZ10uYXVkaXRvciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICB2YXIgKCwsLCxjaG9zZW5PZmZlcmluZykgPSBJU2VjdXJpdHlUb2tlbihfc2VjdXJpdHlUb2tlbikuZ2V0VG9rZW5EZXRhaWxzKCk7CiAgICAgICAgcmVxdWlyZShjaG9zZW5PZmZlcmluZyAhPSBwcm9wb3NlZE9mZmVyaW5nKTsKICAgICAgICBvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbl1bX29mZmVyaW5nUHJvcG9zYWxJbmRleF0gPSBhZGRyZXNzKDApOwogICAgICAgIExvZ0NhbmNlbENvbnRyYWN0UHJvcG9zYWwoX3NlY3VyaXR5VG9rZW4sIHByb3Bvc2VkT2ZmZXJpbmcsIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgYHVwZGF0ZVRlbXBsYXRlUmVwdXRhdGlvbmAgaXMgYSBjb25zdGFudCBmdW5jdGlvbiB0aGF0IHVwZGF0ZXMgdGhlCiAgICAgICBoaXN0b3J5IG9mIGEgc2VjdXJpdHkgdG9rZW4gdGVtcGxhdGUgdXNhZ2UgdG8ga2VlcCB0cmFjayBvZiBwcmV2aW91cyB1c2VzCiAgICAgKiBAcGFyYW0gX3RlbXBsYXRlIFRoZSB1bmlxdWUgdGVtcGxhdGUgaWQKICAgICAqIEBwYXJhbSBfdGVtcGxhdGVJbmRleCBUaGUgYXJyYXkgaW5kZXggb2YgdGhlIHRlbXBsYXRlIHByb3Bvc2FsCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZVRlbXBsYXRlUmVwdXRhdGlvbiAoYWRkcmVzcyBfdGVtcGxhdGUsIHVpbnQ4IF90ZW1wbGF0ZUluZGV4KSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHRlbXBsYXRlUHJvcG9zYWxzW21zZy5zZW5kZXJdW190ZW1wbGF0ZUluZGV4XSA9PSBfdGVtcGxhdGUpOwogICAgICAgIHRlbXBsYXRlc1tfdGVtcGxhdGVdLnVzZWRCeS5wdXNoKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBgdXBkYXRlT2ZmZXJpbmdSZXB1dGF0aW9uYCBpcyBhIGNvbnN0YW50IGZ1bmN0aW9uIHRoYXQgdXBkYXRlcyB0aGUKICAgICAgIGhpc3Rvcnkgb2YgYSBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBjb250cmFjdCB0byBrZWVwIHRyYWNrIG9mIHByZXZpb3VzIHVzZXMKICAgICAqIEBwYXJhbSBfc3RvQ29udHJhY3QgVGhlIHNtYXJ0IGNvbnRyYWN0IGFkZHJlc3Mgb2YgdGhlIFNUTyBjb250cmFjdAogICAgICogQHBhcmFtIF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXggVGhlIGFycmF5IGluZGV4IG9mIHRoZSBzZWN1cml0eSB0b2tlbiBvZmZlcmluZyBwcm9wb3NhbAogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVPZmZlcmluZ1JlcHV0YXRpb24gKGFkZHJlc3MgX3N0b0NvbnRyYWN0LCB1aW50OCBfb2ZmZXJpbmdQcm9wb3NhbEluZGV4KSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKG9mZmVyaW5nUHJvcG9zYWxzW21zZy5zZW5kZXJdW19vZmZlcmluZ1Byb3Bvc2FsSW5kZXhdID09IF9zdG9Db250cmFjdCk7CiAgICAgICAgb2ZmZXJpbmdzW19zdG9Db250cmFjdF0udXNlZEJ5LnB1c2gobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEdldCB0ZW1wbGF0ZSBkZXRhaWxzIGJ5IHRoZSBwcm9wb3NhbCBpbmRleAogICAgICogQHBhcmFtIF9zZWN1cml0eVRva2VuQWRkcmVzcyBUaGUgc2VjdXJpdHkgdG9rZW4gZXRoZXJldW0gYWRkcmVzcwogICAgICogQHBhcmFtIF90ZW1wbGF0ZUluZGV4IFRoZSBhcnJheSBpbmRleCBvZiB0aGUgdGVtcGxhdGUgYmVpbmcgY2hlY2tlZAogICAgICogQHJldHVybiBUZW1wbGF0ZSBzdHJ1Y3QKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VGVtcGxhdGVCeVByb3Bvc2FsKGFkZHJlc3MgX3NlY3VyaXR5VG9rZW5BZGRyZXNzLCB1aW50OCBfdGVtcGxhdGVJbmRleCkgdmlldyBwdWJsaWMgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBfdGVtcGxhdGUKICAgICl7CiAgICAgICAgcmV0dXJuIHRlbXBsYXRlUHJvcG9zYWxzW19zZWN1cml0eVRva2VuQWRkcmVzc11bX3RlbXBsYXRlSW5kZXhdOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBHZXQgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgYWRkcmVzcyBvZiBhbGwgdGVtcGxhdGUgcHJvcG9zYWxzIGZvciBhIGdpdmVuIFNUCiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW5BZGRyZXNzIFRoZSBzZWN1cml0eSB0b2tlbiBldGhlcmV1bSBhZGRyZXNzCiAgICAgKiBAcmV0dXJuIFRlbXBsYXRlIHByb3Bvc2FscyBhcnJheQogICAgICovCiAgICBmdW5jdGlvbiBnZXRBbGxUZW1wbGF0ZVByb3Bvc2FscyhhZGRyZXNzIF9zZWN1cml0eVRva2VuQWRkcmVzcykgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzc1tdKXsKICAgICAgICByZXR1cm4gdGVtcGxhdGVQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5BZGRyZXNzXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgR2V0IHNlY3VyaXR5IHRva2VuIG9mZmVyaW5nIHNtYXJ0IGNvbnRyYWN0IGRldGFpbHMgYnkgdGhlIHByb3Bvc2FsIGluZGV4CiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW5BZGRyZXNzIFRoZSBzZWN1cml0eSB0b2tlbiBldGhlcmV1bSBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX29mZmVyaW5nUHJvcG9zYWxJbmRleCBUaGUgYXJyYXkgaW5kZXggb2YgdGhlIFNUTyBjb250cmFjdCBiZWluZyBjaGVja2VkCiAgICAgKiBAcmV0dXJuIENvbnRyYWN0IHN0cnVjdAogICAgICovCiAgICBmdW5jdGlvbiBnZXRPZmZlcmluZ0J5UHJvcG9zYWwoYWRkcmVzcyBfc2VjdXJpdHlUb2tlbkFkZHJlc3MsIHVpbnQ4IF9vZmZlcmluZ1Byb3Bvc2FsSW5kZXgpIHZpZXcgcHVibGljIHJldHVybnMgKAogICAgICAgIGFkZHJlc3Mgc3RvQ29udHJhY3QsCiAgICAgICAgYWRkcmVzcyBhdWRpdG9yLAogICAgICAgIHVpbnQyNTYgdmVzdGluZ1BlcmlvZCwKICAgICAgICB1aW50OCBxdW9ydW0sCiAgICAgICAgdWludDI1NiBmZWUKICAgICl7CiAgICAgICAgYWRkcmVzcyBfc3RvQ29udHJhY3QgPSBvZmZlcmluZ1Byb3Bvc2Fsc1tfc2VjdXJpdHlUb2tlbkFkZHJlc3NdW19vZmZlcmluZ1Byb3Bvc2FsSW5kZXhdOwogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIF9zdG9Db250cmFjdCwKICAgICAgICAgICAgb2ZmZXJpbmdzW19zdG9Db250cmFjdF0uYXVkaXRvciwKICAgICAgICAgICAgb2ZmZXJpbmdzW19zdG9Db250cmFjdF0udmVzdGluZ1BlcmlvZCwKICAgICAgICAgICAgb2ZmZXJpbmdzW19zdG9Db250cmFjdF0ucXVvcnVtLAogICAgICAgICAgICBvZmZlcmluZ3NbX3N0b0NvbnRyYWN0XS5mZWUKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBHZXQgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgYWRkcmVzcyBvZiBhbGwgb2ZmZXJpbmcgcHJvcG9zYWxzIGZvciBhIGdpdmVuIFNUCiAgICAgKiBAcGFyYW0gX3NlY3VyaXR5VG9rZW5BZGRyZXNzIFRoZSBzZWN1cml0eSB0b2tlbiBldGhlcmV1bSBhZGRyZXNzCiAgICAgKiBAcmV0dXJuIE9mZmVyaW5nIHByb3Bvc2FscyBhcnJheQogICAgICovCiAgICBmdW5jdGlvbiBnZXRBbGxPZmZlcmluZ1Byb3Bvc2FscyhhZGRyZXNzIF9zZWN1cml0eVRva2VuQWRkcmVzcykgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzc1tdKXsKICAgICAgICByZXR1cm4gb2ZmZXJpbmdQcm9wb3NhbHNbX3NlY3VyaXR5VG9rZW5BZGRyZXNzXTsKICAgIH0KCn0='.
	

]
