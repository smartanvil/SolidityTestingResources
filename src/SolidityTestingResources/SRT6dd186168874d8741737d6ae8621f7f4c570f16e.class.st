Class {
	#name : #SRT6dd186168874d8741737d6ae8621f7f4c570f16e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6dd186168874d8741737d6ae8621f7f4c570f16e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEJva2t5UG9vQmFoJ3MgVG9rZW4gVGVsZXBvcnRhdGlvbiBTZXJ2aWNlIHYxLjEwCi8vCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ib2treXBvb2JhaC9Cb2treVBvb0JhaHNUb2tlblRlbGVwb3J0YXRpb25TZXJ2aWNlU21hcnRDb250cmFjdAovLwovLyBFbmpveS4gKGMpIEJva2t5UG9vQmFoIC8gQm9rIENvbnN1bHRpbmcgUHR5IEx0ZCAyMDE4LiBUaGUgTUlUIExpY2VuY2UuCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEVSQyBUb2tlbiBTdGFuZGFyZCAjMjAgSW50ZXJmYWNlCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvbWFzdGVyL0VJUFMvZWlwLTIwLXRva2VuLXN0YW5kYXJkLm1kCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29udHJhY3QgRVJDMjBJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHRva2VuT3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB0b2tlbnMpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIHRva2VuT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHRva2Vucyk7Cn0KCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIENvbnRyYWN0cyB0aGF0IGNhbiBoYXZlIHRva2VucyBhcHByb3ZlZCwgYW5kIHRoZW4gYSBmdW5jdGlvbiBleGVjdXRlZAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiB0b2tlbnMsIGFkZHJlc3MgdG9rZW4sIGJ5dGVzIGRhdGEpIHB1YmxpYzsKfQoKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQm9ra3lQb29CYWgncyBUb2tlbiBUZWxlcG9ydGF0aW9uIFNlcnZpY2UgSW50ZXJmYWNlIHYxLjEwCi8vCi8vIEVuam95LiAoYykgQm9ra3lQb29CYWggLyBCb2sgQ29uc3VsdGluZyBQdHkgTHRkIDIwMTguIFRoZSBNSVQgTGljZW5jZS4KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb250cmFjdCBCVFRTVG9rZW5JbnRlcmZhY2UgaXMgRVJDMjBJbnRlcmZhY2UgewogICAgdWludCBwdWJsaWMgY29uc3RhbnQgYnR0c1ZlcnNpb24gPSAxMTA7CgogICAgYnl0ZXMgcHVibGljIGNvbnN0YW50IHNpZ25pbmdQcmVmaXggPSAiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiOwogICAgYnl0ZXM0IHB1YmxpYyBjb25zdGFudCBzaWduZWRUcmFuc2ZlclNpZyA9ICJceDc1XHgzMlx4ZWFceGFjIjsKICAgIGJ5dGVzNCBwdWJsaWMgY29uc3RhbnQgc2lnbmVkQXBwcm92ZVNpZyA9ICJceGU5XHhhZlx4YTdceGExIjsKICAgIGJ5dGVzNCBwdWJsaWMgY29uc3RhbnQgc2lnbmVkVHJhbnNmZXJGcm9tU2lnID0gIlx4MzRceDRiXHhjY1x4N2QiOwogICAgYnl0ZXM0IHB1YmxpYyBjb25zdGFudCBzaWduZWRBcHByb3ZlQW5kQ2FsbFNpZyA9ICJceGYxXHg2Zlx4OWJceDUzIjsKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvKTsKICAgIGV2ZW50IE1pbnRlclVwZGF0ZWQoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvKTsKICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRva2VuT3duZXIsIHVpbnQgdG9rZW5zLCBib29sIGxvY2tBY2NvdW50KTsKICAgIGV2ZW50IE1pbnRpbmdEaXNhYmxlZCgpOwogICAgZXZlbnQgVHJhbnNmZXJzRW5hYmxlZCgpOwogICAgZXZlbnQgQWNjb3VudFVubG9ja2VkKGFkZHJlc3MgaW5kZXhlZCB0b2tlbk93bmVyKTsKCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zLCBieXRlcyBkYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIHNpZ25lZHtYfSBmdW5jdGlvbnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2lnbmVkVHJhbnNmZXJIYXNoKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyIGhhc2gpOwogICAgZnVuY3Rpb24gc2lnbmVkVHJhbnNmZXJDaGVjayhhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zLCB1aW50IGZlZSwgdWludCBub25jZSwgYnl0ZXMgc2lnLCBhZGRyZXNzIGZlZUFjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKENoZWNrUmVzdWx0IHJlc3VsdCk7CiAgICBmdW5jdGlvbiBzaWduZWRUcmFuc2ZlcihhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zLCB1aW50IGZlZSwgdWludCBub25jZSwgYnl0ZXMgc2lnLCBhZGRyZXNzIGZlZUFjY291bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIHNpZ25lZEFwcHJvdmVIYXNoKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIgaGFzaCk7CiAgICBmdW5jdGlvbiBzaWduZWRBcHByb3ZlQ2hlY2soYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zLCB1aW50IGZlZSwgdWludCBub25jZSwgYnl0ZXMgc2lnLCBhZGRyZXNzIGZlZUFjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKENoZWNrUmVzdWx0IHJlc3VsdCk7CiAgICBmdW5jdGlvbiBzaWduZWRBcHByb3ZlKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UsIGJ5dGVzIHNpZywgYWRkcmVzcyBmZWVBY2NvdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBzaWduZWRUcmFuc2ZlckZyb21IYXNoKGFkZHJlc3Mgc3BlbmRlciwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIgaGFzaCk7CiAgICBmdW5jdGlvbiBzaWduZWRUcmFuc2ZlckZyb21DaGVjayhhZGRyZXNzIHNwZW5kZXIsIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAoQ2hlY2tSZXN1bHQgcmVzdWx0KTsKICAgIGZ1bmN0aW9uIHNpZ25lZFRyYW5zZmVyRnJvbShhZGRyZXNzIHNwZW5kZXIsIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gc2lnbmVkQXBwcm92ZUFuZENhbGxIYXNoKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucywgYnl0ZXMgX2RhdGEsIHVpbnQgZmVlLCB1aW50IG5vbmNlKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyIGhhc2gpOwogICAgZnVuY3Rpb24gc2lnbmVkQXBwcm92ZUFuZENhbGxDaGVjayhhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMsIGJ5dGVzIF9kYXRhLCB1aW50IGZlZSwgdWludCBub25jZSwgYnl0ZXMgc2lnLCBhZGRyZXNzIGZlZUFjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKENoZWNrUmVzdWx0IHJlc3VsdCk7CiAgICBmdW5jdGlvbiBzaWduZWRBcHByb3ZlQW5kQ2FsbChhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMsIGJ5dGVzIF9kYXRhLCB1aW50IGZlZSwgdWludCBub25jZSwgYnl0ZXMgc2lnLCBhZGRyZXNzIGZlZUFjY291bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyB0b2tlbk93bmVyLCB1aW50IHRva2VucywgYm9vbCBsb2NrQWNjb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1bmxvY2tBY2NvdW50KGFkZHJlc3MgdG9rZW5Pd25lcikgcHVibGljOwogICAgZnVuY3Rpb24gZGlzYWJsZU1pbnRpbmcoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoKSBwdWJsaWM7CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBzaWduZWR7WH1DaGVjayByZXR1cm4gc3RhdHVzCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGVudW0gQ2hlY2tSZXN1bHQgewogICAgICAgIFN1Y2Nlc3MsICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMCBTdWNjZXNzCiAgICAgICAgTm90VHJhbnNmZXJhYmxlLCAgICAgICAgICAgICAgICAgICAvLyAxIFRva2VucyBub3QgdHJhbnNmZXJhYmxlIHlldAogICAgICAgIEFjY291bnRMb2NrZWQsICAgICAgICAgICAgICAgICAgICAgLy8gMiBBY2NvdW50IGxvY2tlZAogICAgICAgIFNpZ25lck1pc21hdGNoLCAgICAgICAgICAgICAgICAgICAgLy8gMyBNaXNtYXRjaCBpbiBzaWduaW5nIGFjY291bnQKICAgICAgICBJbnZhbGlkTm9uY2UsICAgICAgICAgICAgICAgICAgICAgIC8vIDQgSW52YWxpZCBub25jZQogICAgICAgIEluc3VmZmljaWVudEFwcHJvdmVkVG9rZW5zLCAgICAgICAgLy8gNSBJbnN1ZmZpY2llbnQgYXBwcm92ZWQgdG9rZW5zCiAgICAgICAgSW5zdWZmaWNpZW50QXBwcm92ZWRUb2tlbnNGb3JGZWVzLCAvLyA2IEluc3VmZmljaWVudCBhcHByb3ZlZCB0b2tlbnMgZm9yIGZlZXMKICAgICAgICBJbnN1ZmZpY2llbnRUb2tlbnMsICAgICAgICAgICAgICAgIC8vIDcgSW5zdWZmaWNpZW50IHRva2VucwogICAgICAgIEluc3VmZmljaWVudFRva2Vuc0ZvckZlZXMsICAgICAgICAgLy8gOCBJbnN1ZmZpY2llbnQgdG9rZW5zIGZvciBmZWVzCiAgICAgICAgT3ZlcmZsb3dFcnJvciAgICAgICAgICAgICAgICAgICAgICAvLyA5IE92ZXJmbG93IGVycm9yCiAgICB9Cn0KCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEJva2t5UG9vQmFoJ3MgVG9rZW4gVGVsZXBvcnRhdGlvbiBTZXJ2aWNlIExpYnJhcnkgdjEuMDAKLy8KLy8gRW5qb3kuIChjKSBCb2treVBvb0JhaCAvIEJvayBDb25zdWx0aW5nIFB0eSBMdGQgMjAxOC4gVGhlIE1JVCBMaWNlbmNlLgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxpYnJhcnkgQlRUU0xpYiB7CiAgICBzdHJ1Y3QgRGF0YSB7CiAgICAgICAgYm9vbCBpbml0aWFsaXNlZDsKCiAgICAgICAgLy8gT3duZXJzaGlwCiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICBhZGRyZXNzIG5ld093bmVyOwoKICAgICAgICAvLyBNaW50aW5nIGFuZCBtYW5hZ2VtZW50CiAgICAgICAgYWRkcmVzcyBtaW50ZXI7CiAgICAgICAgYm9vbCBtaW50YWJsZTsKICAgICAgICBib29sIHRyYW5zZmVyYWJsZTsKICAgICAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgYWNjb3VudExvY2tlZDsKCiAgICAgICAgLy8gVG9rZW4KICAgICAgICBzdHJpbmcgc3ltYm9sOwogICAgICAgIHN0cmluZyBuYW1lOwogICAgICAgIHVpbnQ4IGRlY2ltYWxzOwogICAgICAgIHVpbnQgdG90YWxTdXBwbHk7CiAgICAgICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogICAgICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CiAgICAgICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIG5leHROb25jZTsKICAgIH0KCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBDb25zdGFudHMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgYnR0c1ZlcnNpb24gPSAxMTA7CiAgICBieXRlcyBwdWJsaWMgY29uc3RhbnQgc2lnbmluZ1ByZWZpeCA9ICJceDE5RXRoZXJldW0gU2lnbmVkIE1lc3NhZ2U6XG4zMiI7CiAgICBieXRlczQgcHVibGljIGNvbnN0YW50IHNpZ25lZFRyYW5zZmVyU2lnID0gIlx4NzVceDMyXHhlYVx4YWMiOwogICAgYnl0ZXM0IHB1YmxpYyBjb25zdGFudCBzaWduZWRBcHByb3ZlU2lnID0gIlx4ZTlceGFmXHhhN1x4YTEiOwogICAgYnl0ZXM0IHB1YmxpYyBjb25zdGFudCBzaWduZWRUcmFuc2ZlckZyb21TaWcgPSAiXHgzNFx4NGJceGNjXHg3ZCI7CiAgICBieXRlczQgcHVibGljIGNvbnN0YW50IHNpZ25lZEFwcHJvdmVBbmRDYWxsU2lnID0gIlx4ZjFceDZmXHg5Ylx4NTMiOwoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRXZlbnQKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0byk7CiAgICBldmVudCBNaW50ZXJVcGRhdGVkKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0byk7CiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0b2tlbk93bmVyLCB1aW50IHRva2VucywgYm9vbCBsb2NrQWNjb3VudCk7CiAgICBldmVudCBNaW50aW5nRGlzYWJsZWQoKTsKICAgIGV2ZW50IFRyYW5zZmVyc0VuYWJsZWQoKTsKICAgIGV2ZW50IEFjY291bnRVbmxvY2tlZChhZGRyZXNzIGluZGV4ZWQgdG9rZW5Pd25lcik7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHRva2Vucyk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgdG9rZW5Pd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdG9rZW5zKTsKCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBJbml0aWFsaXNhdGlvbgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBpbml0KERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIG93bmVyLCBzdHJpbmcgc3ltYm9sLCBzdHJpbmcgbmFtZSwgdWludDggZGVjaW1hbHMsIHVpbnQgaW5pdGlhbFN1cHBseSwgYm9vbCBtaW50YWJsZSwgYm9vbCB0cmFuc2ZlcmFibGUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSghc2VsZi5pbml0aWFsaXNlZCk7CiAgICAgICAgc2VsZi5pbml0aWFsaXNlZCA9IHRydWU7CiAgICAgICAgc2VsZi5vd25lciA9IG93bmVyOwogICAgICAgIHNlbGYuc3ltYm9sID0gc3ltYm9sOwogICAgICAgIHNlbGYubmFtZSA9IG5hbWU7CiAgICAgICAgc2VsZi5kZWNpbWFscyA9IGRlY2ltYWxzOwogICAgICAgIGlmIChpbml0aWFsU3VwcGx5ID4gMCkgewogICAgICAgICAgICBzZWxmLmJhbGFuY2VzW293bmVyXSA9IGluaXRpYWxTdXBwbHk7CiAgICAgICAgICAgIHNlbGYudG90YWxTdXBwbHkgPSBpbml0aWFsU3VwcGx5OwogICAgICAgICAgICBNaW50KHNlbGYub3duZXIsIGluaXRpYWxTdXBwbHksIGZhbHNlKTsKICAgICAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgc2VsZi5vd25lciwgaW5pdGlhbFN1cHBseSk7CiAgICAgICAgfQogICAgICAgIHNlbGYubWludGFibGUgPSBtaW50YWJsZTsKICAgICAgICBzZWxmLnRyYW5zZmVyYWJsZSA9IHRyYW5zZmVyYWJsZTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIFNhZmUgbWF0aHMsIGluc3BpcmVkIGJ5IE9wZW5aZXBwZWxpbgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgYykgewogICAgICAgIGMgPSBhICsgYjsKICAgICAgICByZXF1aXJlKGMgPj0gYSk7CiAgICB9CiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgYykgewogICAgICAgIHJlcXVpcmUoYiA8PSBhKTsKICAgICAgICBjID0gYSAtIGI7CiAgICB9CiAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgYykgewogICAgICAgIGMgPSBhICogYjsKICAgICAgICByZXF1aXJlKGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCBjKSB7CiAgICAgICAgcmVxdWlyZShiID4gMCk7CiAgICAgICAgYyA9IGEgLyBiOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gT3duZXJzaGlwCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgICAgICBzZWxmLm5ld093bmVyID0gbmV3T3duZXI7CiAgICB9CiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoRGF0YSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYubmV3T3duZXIpOwogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKHNlbGYub3duZXIsIHNlbGYubmV3T3duZXIpOwogICAgICAgIHNlbGYub3duZXIgPSBzZWxmLm5ld093bmVyOwogICAgICAgIHNlbGYubmV3T3duZXIgPSBhZGRyZXNzKDApOwogICAgfQogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXBJbW1lZGlhdGVseShEYXRhIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBuZXdPd25lcikgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQoc2VsZi5vd25lciwgbmV3T3duZXIpOwogICAgICAgIHNlbGYub3duZXIgPSBuZXdPd25lcjsKICAgICAgICBzZWxmLm5ld093bmVyID0gYWRkcmVzcygwKTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIE1pbnRpbmcgYW5kIG1hbmFnZW1lbnQKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2V0TWludGVyKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIG1pbnRlcikgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICAgICAgcmVxdWlyZShzZWxmLm1pbnRhYmxlKTsKICAgICAgICBNaW50ZXJVcGRhdGVkKHNlbGYubWludGVyLCBtaW50ZXIpOwogICAgICAgIHNlbGYubWludGVyID0gbWludGVyOwogICAgfQogICAgZnVuY3Rpb24gbWludChEYXRhIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyB0b2tlbk93bmVyLCB1aW50IHRva2VucywgYm9vbCBsb2NrQWNjb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoc2VsZi5taW50YWJsZSk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYubWludGVyIHx8IG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICAgICAgaWYgKGxvY2tBY2NvdW50KSB7CiAgICAgICAgICAgIHNlbGYuYWNjb3VudExvY2tlZFt0b2tlbk93bmVyXSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHNlbGYuYmFsYW5jZXNbdG9rZW5Pd25lcl0gPSBzYWZlQWRkKHNlbGYuYmFsYW5jZXNbdG9rZW5Pd25lcl0sIHRva2Vucyk7CiAgICAgICAgc2VsZi50b3RhbFN1cHBseSA9IHNhZmVBZGQoc2VsZi50b3RhbFN1cHBseSwgdG9rZW5zKTsKICAgICAgICBNaW50KHRva2VuT3duZXIsIHRva2VucywgbG9ja0FjY291bnQpOwogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIHRva2VuT3duZXIsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiB1bmxvY2tBY2NvdW50KERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHRva2VuT3duZXIpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgICAgIHJlcXVpcmUoc2VsZi5hY2NvdW50TG9ja2VkW3Rva2VuT3duZXJdKTsKICAgICAgICBzZWxmLmFjY291bnRMb2NrZWRbdG9rZW5Pd25lcl0gPSBmYWxzZTsKICAgICAgICBBY2NvdW50VW5sb2NrZWQodG9rZW5Pd25lcik7CiAgICB9CiAgICBmdW5jdGlvbiBkaXNhYmxlTWludGluZyhEYXRhIHN0b3JhZ2Ugc2VsZikgcHVibGljIHsKICAgICAgICByZXF1aXJlKHNlbGYubWludGFibGUpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm1pbnRlciB8fCBtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgICAgIHNlbGYubWludGFibGUgPSBmYWxzZTsKICAgICAgICBpZiAoc2VsZi5taW50ZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBNaW50ZXJVcGRhdGVkKHNlbGYubWludGVyLCBhZGRyZXNzKDApKTsKICAgICAgICAgICAgc2VsZi5taW50ZXIgPSBhZGRyZXNzKDApOwogICAgICAgIH0KICAgICAgICBNaW50aW5nRGlzYWJsZWQoKTsKICAgIH0KICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycyhEYXRhIHN0b3JhZ2Ugc2VsZikgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICAgICAgcmVxdWlyZSghc2VsZi50cmFuc2ZlcmFibGUpOwogICAgICAgIHNlbGYudHJhbnNmZXJhYmxlID0gdHJ1ZTsKICAgICAgICBUcmFuc2ZlcnNFbmFibGVkKCk7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBPdGhlciBmdW5jdGlvbnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gdHJhbnNmZXJBbnlFUkMyMFRva2VuKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHRva2VuQWRkcmVzcywgdWludCB0b2tlbnMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICAgICAgcmV0dXJuIEVSQzIwSW50ZXJmYWNlKHRva2VuQWRkcmVzcykudHJhbnNmZXIoc2VsZi5vd25lciwgdG9rZW5zKTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIGVjcmVjb3ZlciBmcm9tIGEgc2lnbmF0dXJlIHJhdGhlciB0aGFuIHRoZSBzaWduYXR1cmUgaW4gcGFydHMgW3YsIHIsIHNdCiAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSB7Ynl0ZXMzMiByfXtieXRlczMyIHN9e3VpbnQ4IHZ9LgogICAgLy8gQ29tcGFjdCBtZWFucywgdWludDggaXMgbm90IHBhZGRlZCB0byAzMiBieXRlcy4KICAgIC8vCiAgICAvLyBBbiBpbnZhbGlkIHNpZ25hdHVyZSByZXN1bHRzIGluIHRoZSBhZGRyZXNzKDApIGJlaW5nIHJldHVybmVkLCBtYWtlCiAgICAvLyBzdXJlIHRoYXQgdGhlIHJldHVybmVkIHJlc3VsdCBpcyBjaGVja2VkIHRvIGJlIG5vbi16ZXJvIGZvciB2YWxpZGl0eQogICAgLy8KICAgIC8vIFBhcnRzIGZyb20gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vYXhpYy81YjMzOTEyYzZmNjFhZTZmZDk2ZDZjNGE0N2FmZGU2ZAogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBlY3JlY292ZXJGcm9tU2lnKGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBwdWJsaWMgcHVyZSByZXR1cm5zIChhZGRyZXNzIHJlY292ZXJlZEFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CiAgICAgICAgaWYgKHNpZy5sZW5ndGggIT0gNjUpIHJldHVybiBhZGRyZXNzKDApOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQgJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQogICAgICAgIH0KICAgICAgICAvLyBBbGJlaXQgbm9uLXRyYW5zYWN0aW9uYWwgc2lnbmF0dXJlcyBhcmUgbm90IHNwZWNpZmllZCBieSB0aGUgWVAsIG9uZSB3b3VsZCBleHBlY3QgaXQgdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzCiAgICAgICAgaWYgKHYgPCAyNykgewogICAgICAgICAgdiArPSAyNzsKICAgICAgICB9CiAgICAgICAgaWYgKHYgIT0gMjcgJiYgdiAhPSAyOCkgcmV0dXJuIGFkZHJlc3MoMCk7CiAgICAgICAgcmV0dXJuIGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEdldCBDaGVja1Jlc3VsdCBtZXNzYWdlCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIGdldENoZWNrUmVzdWx0TWVzc2FnZShEYXRhIHN0b3JhZ2UgLypzZWxmKi8sIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdCByZXN1bHQpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGlmIChyZXN1bHQgPT0gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0LlN1Y2Nlc3MpIHsKICAgICAgICAgICAgcmV0dXJuICJTdWNjZXNzIjsKICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCA9PSBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuTm90VHJhbnNmZXJhYmxlKSB7CiAgICAgICAgICAgIHJldHVybiAiVG9rZW5zIG5vdCB0cmFuc2ZlcmFibGUgeWV0IjsKICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCA9PSBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuQWNjb3VudExvY2tlZCkgewogICAgICAgICAgICByZXR1cm4gIkFjY291bnQgbG9ja2VkIjsKICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCA9PSBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuU2lnbmVyTWlzbWF0Y2gpIHsKICAgICAgICAgICAgcmV0dXJuICJNaXNtYXRjaCBpbiBzaWduaW5nIGFjY291bnQiOwogICAgICAgIH0gZWxzZSBpZiAocmVzdWx0ID09IEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5JbnZhbGlkTm9uY2UpIHsKICAgICAgICAgICAgcmV0dXJuICJJbnZhbGlkIG5vbmNlIjsKICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCA9PSBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuSW5zdWZmaWNpZW50QXBwcm92ZWRUb2tlbnMpIHsKICAgICAgICAgICAgcmV0dXJuICJJbnN1ZmZpY2llbnQgYXBwcm92ZWQgdG9rZW5zIjsKICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCA9PSBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuSW5zdWZmaWNpZW50QXBwcm92ZWRUb2tlbnNGb3JGZWVzKSB7CiAgICAgICAgICAgIHJldHVybiAiSW5zdWZmaWNpZW50IGFwcHJvdmVkIHRva2VucyBmb3IgZmVlcyI7CiAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgPT0gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0Lkluc3VmZmljaWVudFRva2VucykgewogICAgICAgICAgICByZXR1cm4gIkluc3VmZmljaWVudCB0b2tlbnMiOwogICAgICAgIH0gZWxzZSBpZiAocmVzdWx0ID09IEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5JbnN1ZmZpY2llbnRUb2tlbnNGb3JGZWVzKSB7CiAgICAgICAgICAgIHJldHVybiAiSW5zdWZmaWNpZW50IHRva2VucyBmb3IgZmVlcyI7CiAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgPT0gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0Lk92ZXJmbG93RXJyb3IpIHsKICAgICAgICAgICAgcmV0dXJuICJPdmVyZmxvdyBlcnJvciI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICJVbmtub3duIGVycm9yIjsKICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBUb2tlbiBmdW5jdGlvbnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gdHJhbnNmZXIoRGF0YSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy8gT3duZXIgYW5kIG1pbnRlciBjYW4gbW92ZSB0b2tlbnMgYmVmb3JlIHRoZSB0b2tlbnMgYXJlIHRyYW5zZmVyYWJsZQogICAgICAgIHJlcXVpcmUoc2VsZi50cmFuc2ZlcmFibGUgfHwgKHNlbGYubWludGFibGUgJiYgKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lciAgfHwgbXNnLnNlbmRlciA9PSBzZWxmLm1pbnRlcikpKTsKICAgICAgICByZXF1aXJlKCFzZWxmLmFjY291bnRMb2NrZWRbbXNnLnNlbmRlcl0pOwogICAgICAgIHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0sIHRva2Vucyk7CiAgICAgICAgc2VsZi5iYWxhbmNlc1t0b10gPSBzYWZlQWRkKHNlbGYuYmFsYW5jZXNbdG9dLCB0b2tlbnMpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB0b2tlbnMpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYXBwcm92ZShEYXRhIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoIXNlbGYuYWNjb3VudExvY2tlZFttc2cuc2VuZGVyXSk7CiAgICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdG9rZW5zOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oRGF0YSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHNlbGYudHJhbnNmZXJhYmxlKTsKICAgICAgICByZXF1aXJlKCFzZWxmLmFjY291bnRMb2NrZWRbZnJvbV0pOwogICAgICAgIHNlbGYuYmFsYW5jZXNbZnJvbV0gPSBzYWZlU3ViKHNlbGYuYmFsYW5jZXNbZnJvbV0sIHRva2Vucyk7CiAgICAgICAgc2VsZi5hbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihzZWxmLmFsbG93ZWRbZnJvbV1bbXNnLnNlbmRlcl0sIHRva2Vucyk7CiAgICAgICAgc2VsZi5iYWxhbmNlc1t0b10gPSBzYWZlQWRkKHNlbGYuYmFsYW5jZXNbdG9dLCB0b2tlbnMpOwogICAgICAgIFRyYW5zZmVyKGZyb20sIHRvLCB0b2tlbnMpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoRGF0YSBzdG9yYWdlIHNlbGYsIGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMsIGJ5dGVzIGRhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKCFzZWxmLmFjY291bnRMb2NrZWRbbXNnLnNlbmRlcl0pOwogICAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IHRva2VuczsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB0b2tlbnMpOwogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKG1zZy5zZW5kZXIsIHRva2VucywgYWRkcmVzcyh0aGlzKSwgZGF0YSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBTaWduZWQgZnVuY3Rpb24KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2lnbmVkVHJhbnNmZXJIYXNoKERhdGEgc3RvcmFnZSAvKnNlbGYqLywgYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIgaGFzaCkgewogICAgICAgIGhhc2ggPSBrZWNjYWsyNTYoc2lnbmVkVHJhbnNmZXJTaWcsIGFkZHJlc3ModGhpcyksIHRva2VuT3duZXIsIHRvLCB0b2tlbnMsIGZlZSwgbm9uY2UpOwogICAgfQogICAgZnVuY3Rpb24gc2lnbmVkVHJhbnNmZXJDaGVjayhEYXRhIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UsIGJ5dGVzIHNpZywgYWRkcmVzcyBmZWVBY2NvdW50KSBwdWJsaWMgdmlldyByZXR1cm5zIChCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQgcmVzdWx0KSB7CiAgICAgICAgaWYgKCFzZWxmLnRyYW5zZmVyYWJsZSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5Ob3RUcmFuc2ZlcmFibGU7CiAgICAgICAgYnl0ZXMzMiBoYXNoID0gc2lnbmVkVHJhbnNmZXJIYXNoKHNlbGYsIHRva2VuT3duZXIsIHRvLCB0b2tlbnMsIGZlZSwgbm9uY2UpOwogICAgICAgIGlmICh0b2tlbk93bmVyID09IGFkZHJlc3MoMCkgfHwgdG9rZW5Pd25lciAhPSBlY3JlY292ZXJGcm9tU2lnKGtlY2NhazI1NihzaWduaW5nUHJlZml4LCBoYXNoKSwgc2lnKSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5TaWduZXJNaXNtYXRjaDsKICAgICAgICBpZiAoc2VsZi5hY2NvdW50TG9ja2VkW3Rva2VuT3duZXJdKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0LkFjY291bnRMb2NrZWQ7CiAgICAgICAgaWYgKHNlbGYubmV4dE5vbmNlW3Rva2VuT3duZXJdICE9IG5vbmNlKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0LkludmFsaWROb25jZTsKICAgICAgICB1aW50IHRvdGFsID0gc2FmZUFkZCh0b2tlbnMsIGZlZSk7CiAgICAgICAgaWYgKHNlbGYuYmFsYW5jZXNbdG9rZW5Pd25lcl0gPCB0b2tlbnMpIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuSW5zdWZmaWNpZW50VG9rZW5zOwogICAgICAgIGlmIChzZWxmLmJhbGFuY2VzW3Rva2VuT3duZXJdIDwgdG90YWwpIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuSW5zdWZmaWNpZW50VG9rZW5zRm9yRmVlczsKICAgICAgICBpZiAoc2VsZi5iYWxhbmNlc1t0b10gKyB0b2tlbnMgPCBzZWxmLmJhbGFuY2VzW3RvXSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5PdmVyZmxvd0Vycm9yOwogICAgICAgIGlmIChzZWxmLmJhbGFuY2VzW2ZlZUFjY291bnRdICsgZmVlIDwgc2VsZi5iYWxhbmNlc1tmZWVBY2NvdW50XSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5PdmVyZmxvd0Vycm9yOwogICAgICAgIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuU3VjY2VzczsKICAgIH0KICAgIGZ1bmN0aW9uIHNpZ25lZFRyYW5zZmVyKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zLCB1aW50IGZlZSwgdWludCBub25jZSwgYnl0ZXMgc2lnLCBhZGRyZXNzIGZlZUFjY291bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHNlbGYudHJhbnNmZXJhYmxlKTsKICAgICAgICBieXRlczMyIGhhc2ggPSBzaWduZWRUcmFuc2Zlckhhc2goc2VsZiwgdG9rZW5Pd25lciwgdG8sIHRva2VucywgZmVlLCBub25jZSk7CiAgICAgICAgcmVxdWlyZSh0b2tlbk93bmVyICE9IGFkZHJlc3MoMCkgJiYgdG9rZW5Pd25lciA9PSBlY3JlY292ZXJGcm9tU2lnKGtlY2NhazI1NihzaWduaW5nUHJlZml4LCBoYXNoKSwgc2lnKSk7CiAgICAgICAgcmVxdWlyZSghc2VsZi5hY2NvdW50TG9ja2VkW3Rva2VuT3duZXJdKTsKICAgICAgICByZXF1aXJlKHNlbGYubmV4dE5vbmNlW3Rva2VuT3duZXJdID09IG5vbmNlKTsKICAgICAgICBzZWxmLm5leHROb25jZVt0b2tlbk93bmVyXSA9IG5vbmNlICsgMTsKICAgICAgICBzZWxmLmJhbGFuY2VzW3Rva2VuT3duZXJdID0gc2FmZVN1YihzZWxmLmJhbGFuY2VzW3Rva2VuT3duZXJdLCB0b2tlbnMpOwogICAgICAgIHNlbGYuYmFsYW5jZXNbdG9dID0gc2FmZUFkZChzZWxmLmJhbGFuY2VzW3RvXSwgdG9rZW5zKTsKICAgICAgICBUcmFuc2Zlcih0b2tlbk93bmVyLCB0bywgdG9rZW5zKTsKICAgICAgICBzZWxmLmJhbGFuY2VzW3Rva2VuT3duZXJdID0gc2FmZVN1YihzZWxmLmJhbGFuY2VzW3Rva2VuT3duZXJdLCBmZWUpOwogICAgICAgIHNlbGYuYmFsYW5jZXNbZmVlQWNjb3VudF0gPSBzYWZlQWRkKHNlbGYuYmFsYW5jZXNbZmVlQWNjb3VudF0sIGZlZSk7CiAgICAgICAgVHJhbnNmZXIodG9rZW5Pd25lciwgZmVlQWNjb3VudCwgZmVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNpZ25lZEFwcHJvdmVIYXNoKERhdGEgc3RvcmFnZSAvKnNlbGYqLywgYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zLCB1aW50IGZlZSwgdWludCBub25jZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMiBoYXNoKSB7CiAgICAgICAgaGFzaCA9IGtlY2NhazI1NihzaWduZWRBcHByb3ZlU2lnLCBhZGRyZXNzKHRoaXMpLCB0b2tlbk93bmVyLCBzcGVuZGVyLCB0b2tlbnMsIGZlZSwgbm9uY2UpOwogICAgfQogICAgZnVuY3Rpb24gc2lnbmVkQXBwcm92ZUNoZWNrKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAoQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0IHJlc3VsdCkgewogICAgICAgIGlmICghc2VsZi50cmFuc2ZlcmFibGUpIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuTm90VHJhbnNmZXJhYmxlOwogICAgICAgIGJ5dGVzMzIgaGFzaCA9IHNpZ25lZEFwcHJvdmVIYXNoKHNlbGYsIHRva2VuT3duZXIsIHNwZW5kZXIsIHRva2VucywgZmVlLCBub25jZSk7CiAgICAgICAgaWYgKHRva2VuT3duZXIgPT0gYWRkcmVzcygwKSB8fCB0b2tlbk93bmVyICE9IGVjcmVjb3ZlckZyb21TaWcoa2VjY2FrMjU2KHNpZ25pbmdQcmVmaXgsIGhhc2gpLCBzaWcpKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0LlNpZ25lck1pc21hdGNoOwogICAgICAgIGlmIChzZWxmLmFjY291bnRMb2NrZWRbdG9rZW5Pd25lcl0pIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuQWNjb3VudExvY2tlZDsKICAgICAgICBpZiAoc2VsZi5uZXh0Tm9uY2VbdG9rZW5Pd25lcl0gIT0gbm9uY2UpIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuSW52YWxpZE5vbmNlOwogICAgICAgIGlmIChzZWxmLmJhbGFuY2VzW3Rva2VuT3duZXJdIDwgZmVlKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0Lkluc3VmZmljaWVudFRva2Vuc0ZvckZlZXM7CiAgICAgICAgaWYgKHNlbGYuYmFsYW5jZXNbZmVlQWNjb3VudF0gKyBmZWUgPCBzZWxmLmJhbGFuY2VzW2ZlZUFjY291bnRdKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0Lk92ZXJmbG93RXJyb3I7CiAgICAgICAgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5TdWNjZXNzOwogICAgfQogICAgZnVuY3Rpb24gc2lnbmVkQXBwcm92ZShEYXRhIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zLCB1aW50IGZlZSwgdWludCBub25jZSwgYnl0ZXMgc2lnLCBhZGRyZXNzIGZlZUFjY291bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKHNlbGYudHJhbnNmZXJhYmxlKTsKICAgICAgICBieXRlczMyIGhhc2ggPSBzaWduZWRBcHByb3ZlSGFzaChzZWxmLCB0b2tlbk93bmVyLCBzcGVuZGVyLCB0b2tlbnMsIGZlZSwgbm9uY2UpOwogICAgICAgIHJlcXVpcmUodG9rZW5Pd25lciAhPSBhZGRyZXNzKDApICYmIHRva2VuT3duZXIgPT0gZWNyZWNvdmVyRnJvbVNpZyhrZWNjYWsyNTYoc2lnbmluZ1ByZWZpeCwgaGFzaCksIHNpZykpOwogICAgICAgIHJlcXVpcmUoIXNlbGYuYWNjb3VudExvY2tlZFt0b2tlbk93bmVyXSk7CiAgICAgICAgcmVxdWlyZShzZWxmLm5leHROb25jZVt0b2tlbk93bmVyXSA9PSBub25jZSk7CiAgICAgICAgc2VsZi5uZXh0Tm9uY2VbdG9rZW5Pd25lcl0gPSBub25jZSArIDE7CiAgICAgICAgc2VsZi5hbGxvd2VkW3Rva2VuT3duZXJdW3NwZW5kZXJdID0gdG9rZW5zOwogICAgICAgIEFwcHJvdmFsKHRva2VuT3duZXIsIHNwZW5kZXIsIHRva2Vucyk7CiAgICAgICAgc2VsZi5iYWxhbmNlc1t0b2tlbk93bmVyXSA9IHNhZmVTdWIoc2VsZi5iYWxhbmNlc1t0b2tlbk93bmVyXSwgZmVlKTsKICAgICAgICBzZWxmLmJhbGFuY2VzW2ZlZUFjY291bnRdID0gc2FmZUFkZChzZWxmLmJhbGFuY2VzW2ZlZUFjY291bnRdLCBmZWUpOwogICAgICAgIFRyYW5zZmVyKHRva2VuT3duZXIsIGZlZUFjY291bnQsIGZlZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiBzaWduZWRUcmFuc2ZlckZyb21IYXNoKERhdGEgc3RvcmFnZSAvKnNlbGYqLywgYWRkcmVzcyBzcGVuZGVyLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zLCB1aW50IGZlZSwgdWludCBub25jZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMiBoYXNoKSB7CiAgICAgICAgaGFzaCA9IGtlY2NhazI1NihzaWduZWRUcmFuc2ZlckZyb21TaWcsIGFkZHJlc3ModGhpcyksIHNwZW5kZXIsIGZyb20sIHRvLCB0b2tlbnMsIGZlZSwgbm9uY2UpOwogICAgfQogICAgZnVuY3Rpb24gc2lnbmVkVHJhbnNmZXJGcm9tQ2hlY2soRGF0YSBzdG9yYWdlIHNlbGYsIGFkZHJlc3Mgc3BlbmRlciwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UsIGJ5dGVzIHNpZywgYWRkcmVzcyBmZWVBY2NvdW50KSBwdWJsaWMgdmlldyByZXR1cm5zIChCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQgcmVzdWx0KSB7CiAgICAgICAgaWYgKCFzZWxmLnRyYW5zZmVyYWJsZSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5Ob3RUcmFuc2ZlcmFibGU7CiAgICAgICAgYnl0ZXMzMiBoYXNoID0gc2lnbmVkVHJhbnNmZXJGcm9tSGFzaChzZWxmLCBzcGVuZGVyLCBmcm9tLCB0bywgdG9rZW5zLCBmZWUsIG5vbmNlKTsKICAgICAgICBpZiAoc3BlbmRlciA9PSBhZGRyZXNzKDApIHx8IHNwZW5kZXIgIT0gZWNyZWNvdmVyRnJvbVNpZyhrZWNjYWsyNTYoc2lnbmluZ1ByZWZpeCwgaGFzaCksIHNpZykpIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuU2lnbmVyTWlzbWF0Y2g7CiAgICAgICAgaWYgKHNlbGYuYWNjb3VudExvY2tlZFtmcm9tXSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5BY2NvdW50TG9ja2VkOwogICAgICAgIGlmIChzZWxmLm5leHROb25jZVtzcGVuZGVyXSAhPSBub25jZSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5JbnZhbGlkTm9uY2U7CiAgICAgICAgdWludCB0b3RhbCA9IHNhZmVBZGQodG9rZW5zLCBmZWUpOwogICAgICAgIGlmIChzZWxmLmFsbG93ZWRbZnJvbV1bc3BlbmRlcl0gPCB0b2tlbnMpIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuSW5zdWZmaWNpZW50QXBwcm92ZWRUb2tlbnM7CiAgICAgICAgaWYgKHNlbGYuYWxsb3dlZFtmcm9tXVtzcGVuZGVyXSA8IHRvdGFsKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0Lkluc3VmZmljaWVudEFwcHJvdmVkVG9rZW5zRm9yRmVlczsKICAgICAgICBpZiAoc2VsZi5iYWxhbmNlc1tmcm9tXSA8IHRva2VucykgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5JbnN1ZmZpY2llbnRUb2tlbnM7CiAgICAgICAgaWYgKHNlbGYuYmFsYW5jZXNbZnJvbV0gPCB0b3RhbCkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5JbnN1ZmZpY2llbnRUb2tlbnNGb3JGZWVzOwogICAgICAgIGlmIChzZWxmLmJhbGFuY2VzW3RvXSArIHRva2VucyA8IHNlbGYuYmFsYW5jZXNbdG9dKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0Lk92ZXJmbG93RXJyb3I7CiAgICAgICAgaWYgKHNlbGYuYmFsYW5jZXNbZmVlQWNjb3VudF0gKyBmZWUgPCBzZWxmLmJhbGFuY2VzW2ZlZUFjY291bnRdKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0Lk92ZXJmbG93RXJyb3I7CiAgICAgICAgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5TdWNjZXNzOwogICAgfQogICAgZnVuY3Rpb24gc2lnbmVkVHJhbnNmZXJGcm9tKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHNwZW5kZXIsIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoc2VsZi50cmFuc2ZlcmFibGUpOwogICAgICAgIGJ5dGVzMzIgaGFzaCA9IHNpZ25lZFRyYW5zZmVyRnJvbUhhc2goc2VsZiwgc3BlbmRlciwgZnJvbSwgdG8sIHRva2VucywgZmVlLCBub25jZSk7CiAgICAgICAgcmVxdWlyZShzcGVuZGVyICE9IGFkZHJlc3MoMCkgJiYgc3BlbmRlciA9PSBlY3JlY292ZXJGcm9tU2lnKGtlY2NhazI1NihzaWduaW5nUHJlZml4LCBoYXNoKSwgc2lnKSk7CiAgICAgICAgcmVxdWlyZSghc2VsZi5hY2NvdW50TG9ja2VkW2Zyb21dKTsKICAgICAgICByZXF1aXJlKHNlbGYubmV4dE5vbmNlW3NwZW5kZXJdID09IG5vbmNlKTsKICAgICAgICBzZWxmLm5leHROb25jZVtzcGVuZGVyXSA9IG5vbmNlICsgMTsKICAgICAgICBzZWxmLmJhbGFuY2VzW2Zyb21dID0gc2FmZVN1YihzZWxmLmJhbGFuY2VzW2Zyb21dLCB0b2tlbnMpOwogICAgICAgIHNlbGYuYWxsb3dlZFtmcm9tXVtzcGVuZGVyXSA9IHNhZmVTdWIoc2VsZi5hbGxvd2VkW2Zyb21dW3NwZW5kZXJdLCB0b2tlbnMpOwogICAgICAgIHNlbGYuYmFsYW5jZXNbdG9dID0gc2FmZUFkZChzZWxmLmJhbGFuY2VzW3RvXSwgdG9rZW5zKTsKICAgICAgICBUcmFuc2Zlcihmcm9tLCB0bywgdG9rZW5zKTsKICAgICAgICBzZWxmLmJhbGFuY2VzW2Zyb21dID0gc2FmZVN1YihzZWxmLmJhbGFuY2VzW2Zyb21dLCBmZWUpOwogICAgICAgIHNlbGYuYWxsb3dlZFtmcm9tXVtzcGVuZGVyXSA9IHNhZmVTdWIoc2VsZi5hbGxvd2VkW2Zyb21dW3NwZW5kZXJdLCBmZWUpOwogICAgICAgIHNlbGYuYmFsYW5jZXNbZmVlQWNjb3VudF0gPSBzYWZlQWRkKHNlbGYuYmFsYW5jZXNbZmVlQWNjb3VudF0sIGZlZSk7CiAgICAgICAgVHJhbnNmZXIoZnJvbSwgZmVlQWNjb3VudCwgZmVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNpZ25lZEFwcHJvdmVBbmRDYWxsSGFzaChEYXRhIHN0b3JhZ2UgLypzZWxmKi8sIGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucywgYnl0ZXMgZGF0YSwgdWludCBmZWUsIHVpbnQgbm9uY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIgaGFzaCkgewogICAgICAgIGhhc2ggPSBrZWNjYWsyNTYoc2lnbmVkQXBwcm92ZUFuZENhbGxTaWcsIGFkZHJlc3ModGhpcyksIHRva2VuT3duZXIsIHNwZW5kZXIsIHRva2VucywgZGF0YSwgZmVlLCBub25jZSk7CiAgICB9CiAgICBmdW5jdGlvbiBzaWduZWRBcHByb3ZlQW5kQ2FsbENoZWNrKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMsIGJ5dGVzIGRhdGEsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAoQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0IHJlc3VsdCkgewogICAgICAgIGlmICghc2VsZi50cmFuc2ZlcmFibGUpIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuTm90VHJhbnNmZXJhYmxlOwogICAgICAgIGJ5dGVzMzIgaGFzaCA9IHNpZ25lZEFwcHJvdmVBbmRDYWxsSGFzaChzZWxmLCB0b2tlbk93bmVyLCBzcGVuZGVyLCB0b2tlbnMsIGRhdGEsIGZlZSwgbm9uY2UpOwogICAgICAgIGlmICh0b2tlbk93bmVyID09IGFkZHJlc3MoMCkgfHwgdG9rZW5Pd25lciAhPSBlY3JlY292ZXJGcm9tU2lnKGtlY2NhazI1NihzaWduaW5nUHJlZml4LCBoYXNoKSwgc2lnKSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5TaWduZXJNaXNtYXRjaDsKICAgICAgICBpZiAoc2VsZi5hY2NvdW50TG9ja2VkW3Rva2VuT3duZXJdKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0LkFjY291bnRMb2NrZWQ7CiAgICAgICAgaWYgKHNlbGYubmV4dE5vbmNlW3Rva2VuT3duZXJdICE9IG5vbmNlKSByZXR1cm4gQlRUU1Rva2VuSW50ZXJmYWNlLkNoZWNrUmVzdWx0LkludmFsaWROb25jZTsKICAgICAgICBpZiAoc2VsZi5iYWxhbmNlc1t0b2tlbk93bmVyXSA8IGZlZSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5JbnN1ZmZpY2llbnRUb2tlbnNGb3JGZWVzOwogICAgICAgIGlmIChzZWxmLmJhbGFuY2VzW2ZlZUFjY291bnRdICsgZmVlIDwgc2VsZi5iYWxhbmNlc1tmZWVBY2NvdW50XSkgcmV0dXJuIEJUVFNUb2tlbkludGVyZmFjZS5DaGVja1Jlc3VsdC5PdmVyZmxvd0Vycm9yOwogICAgICAgIHJldHVybiBCVFRTVG9rZW5JbnRlcmZhY2UuQ2hlY2tSZXN1bHQuU3VjY2VzczsKICAgIH0KICAgIGZ1bmN0aW9uIHNpZ25lZEFwcHJvdmVBbmRDYWxsKERhdGEgc3RvcmFnZSBzZWxmLCBhZGRyZXNzIHRva2VuT3duZXIsIGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMsIGJ5dGVzIGRhdGEsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoc2VsZi50cmFuc2ZlcmFibGUpOwogICAgICAgIGJ5dGVzMzIgaGFzaCA9IHNpZ25lZEFwcHJvdmVBbmRDYWxsSGFzaChzZWxmLCB0b2tlbk93bmVyLCBzcGVuZGVyLCB0b2tlbnMsIGRhdGEsIGZlZSwgbm9uY2UpOwogICAgICAgIHJlcXVpcmUodG9rZW5Pd25lciAhPSBhZGRyZXNzKDApICYmIHRva2VuT3duZXIgPT0gZWNyZWNvdmVyRnJvbVNpZyhrZWNjYWsyNTYoc2lnbmluZ1ByZWZpeCwgaGFzaCksIHNpZykpOwogICAgICAgIHJlcXVpcmUoIXNlbGYuYWNjb3VudExvY2tlZFt0b2tlbk93bmVyXSk7CiAgICAgICAgcmVxdWlyZShzZWxmLm5leHROb25jZVt0b2tlbk93bmVyXSA9PSBub25jZSk7CiAgICAgICAgc2VsZi5uZXh0Tm9uY2VbdG9rZW5Pd25lcl0gPSBub25jZSArIDE7CiAgICAgICAgc2VsZi5hbGxvd2VkW3Rva2VuT3duZXJdW3NwZW5kZXJdID0gdG9rZW5zOwogICAgICAgIEFwcHJvdmFsKHRva2VuT3duZXIsIHNwZW5kZXIsIHRva2Vucyk7CiAgICAgICAgc2VsZi5iYWxhbmNlc1t0b2tlbk93bmVyXSA9IHNhZmVTdWIoc2VsZi5iYWxhbmNlc1t0b2tlbk93bmVyXSwgZmVlKTsKICAgICAgICBzZWxmLmJhbGFuY2VzW2ZlZUFjY291bnRdID0gc2FmZUFkZChzZWxmLmJhbGFuY2VzW2ZlZUFjY291bnRdLCBmZWUpOwogICAgICAgIFRyYW5zZmVyKHRva2VuT3duZXIsIGZlZUFjY291bnQsIGZlZSk7CiAgICAgICAgQXBwcm92ZUFuZENhbGxGYWxsQmFjayhzcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwodG9rZW5Pd25lciwgdG9rZW5zLCBhZGRyZXNzKHRoaXMpLCBkYXRhKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQm9ra3lQb29CYWgncyBUb2tlbiBUZWxlcG9ydGF0aW9uIFNlcnZpY2UgVG9rZW4gdjEuMTAKLy8KLy8gRW5qb3kuIChjKSBCb2treVBvb0JhaCAvIEJvayBDb25zdWx0aW5nIFB0eSBMdGQgMjAxOC4gVGhlIE1JVCBMaWNlbmNlLgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEJUVFNUb2tlbiBpcyBCVFRTVG9rZW5JbnRlcmZhY2UgewogICAgdXNpbmcgQlRUU0xpYiBmb3IgQlRUU0xpYi5EYXRhOwoKICAgIEJUVFNMaWIuRGF0YSBkYXRhOwoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gQ29uc3RydWN0b3IKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gQlRUU1Rva2VuKGFkZHJlc3Mgb3duZXIsIHN0cmluZyBzeW1ib2wsIHN0cmluZyBuYW1lLCB1aW50OCBkZWNpbWFscywgdWludCBpbml0aWFsU3VwcGx5LCBib29sIG1pbnRhYmxlLCBib29sIHRyYW5zZmVyYWJsZSkgcHVibGljIHsKICAgICAgICBkYXRhLmluaXQob3duZXIsIHN5bWJvbCwgbmFtZSwgZGVjaW1hbHMsIGluaXRpYWxTdXBwbHksIG1pbnRhYmxlLCB0cmFuc2ZlcmFibGUpOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gT3duZXJzaGlwCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIG93bmVyKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBkYXRhLm93bmVyOwogICAgfQogICAgZnVuY3Rpb24gbmV3T3duZXIoKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEubmV3T3duZXI7CiAgICB9CiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIHsKICAgICAgICBkYXRhLnRyYW5zZmVyT3duZXJzaGlwKF9uZXdPd25lcik7CiAgICB9CiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgewogICAgICAgIGRhdGEuYWNjZXB0T3duZXJzaGlwKCk7CiAgICB9CiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcEltbWVkaWF0ZWx5KGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgewogICAgICAgIGRhdGEudHJhbnNmZXJPd25lcnNoaXBJbW1lZGlhdGVseShfbmV3T3duZXIpOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gVG9rZW4KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuc3ltYm9sOwogICAgfQogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBkYXRhLm5hbWU7CiAgICB9CiAgICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIGRhdGEuZGVjaW1hbHM7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBNaW50aW5nIGFuZCBtYW5hZ2VtZW50CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIG1pbnRlcigpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gZGF0YS5taW50ZXI7CiAgICB9CiAgICBmdW5jdGlvbiBzZXRNaW50ZXIoYWRkcmVzcyBfbWludGVyKSBwdWJsaWMgewogICAgICAgIGRhdGEuc2V0TWludGVyKF9taW50ZXIpOwogICAgfQogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIHRva2VuT3duZXIsIHVpbnQgdG9rZW5zLCBib29sIGxvY2tBY2NvdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEubWludCh0b2tlbk93bmVyLCB0b2tlbnMsIGxvY2tBY2NvdW50KTsKICAgIH0KICAgIGZ1bmN0aW9uIGFjY291bnRMb2NrZWQoYWRkcmVzcyB0b2tlbk93bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuYWNjb3VudExvY2tlZFt0b2tlbk93bmVyXTsKICAgIH0KICAgIGZ1bmN0aW9uIHVubG9ja0FjY291bnQoYWRkcmVzcyB0b2tlbk93bmVyKSBwdWJsaWMgewogICAgICAgIGRhdGEudW5sb2NrQWNjb3VudCh0b2tlbk93bmVyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG1pbnRhYmxlKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBkYXRhLm1pbnRhYmxlOwogICAgfQogICAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBkYXRhLnRyYW5zZmVyYWJsZTsKICAgIH0KICAgIGZ1bmN0aW9uIGRpc2FibGVNaW50aW5nKCkgcHVibGljIHsKICAgICAgICBkYXRhLmRpc2FibGVNaW50aW5nKCk7CiAgICB9CiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoKSBwdWJsaWMgewogICAgICAgIGRhdGEuZW5hYmxlVHJhbnNmZXJzKCk7CiAgICB9CiAgICBmdW5jdGlvbiBuZXh0Tm9uY2UoYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGRhdGEubmV4dE5vbmNlW3NwZW5kZXJdOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gT3RoZXIgZnVuY3Rpb25zCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyQW55RVJDMjBUb2tlbihhZGRyZXNzIHRva2VuQWRkcmVzcywgdWludCB0b2tlbnMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gZGF0YS50cmFuc2ZlckFueUVSQzIwVG9rZW4odG9rZW5BZGRyZXNzLCB0b2tlbnMpOwogICAgfQoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRG9uJ3QgYWNjZXB0IGV0aGVycwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBUb2tlbiBmdW5jdGlvbnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGRhdGEudG90YWxTdXBwbHkgLSBkYXRhLmJhbGFuY2VzW2FkZHJlc3MoMCldOwogICAgfQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgdG9rZW5Pd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuYmFsYW5jZXNbdG9rZW5Pd25lcl07CiAgICB9CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuYWxsb3dlZFt0b2tlbk93bmVyXVtzcGVuZGVyXTsKICAgIH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdG9rZW5zKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEudHJhbnNmZXIodG8sIHRva2Vucyk7CiAgICB9CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gZGF0YS5hcHByb3ZlKHNwZW5kZXIsIHRva2Vucyk7CiAgICB9CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiBkYXRhLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdG9rZW5zKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3Mgc3BlbmRlciwgdWludCB0b2tlbnMsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuYXBwcm92ZUFuZENhbGwoc3BlbmRlciwgdG9rZW5zLCBfZGF0YSk7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBTaWduZWQgZnVuY3Rpb24KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gc2lnbmVkVHJhbnNmZXJIYXNoKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyIGhhc2gpIHsKICAgICAgICByZXR1cm4gZGF0YS5zaWduZWRUcmFuc2Zlckhhc2godG9rZW5Pd25lciwgdG8sIHRva2VucywgZmVlLCBub25jZSk7CiAgICB9CiAgICBmdW5jdGlvbiBzaWduZWRUcmFuc2ZlckNoZWNrKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAoQ2hlY2tSZXN1bHQgcmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIGRhdGEuc2lnbmVkVHJhbnNmZXJDaGVjayh0b2tlbk93bmVyLCB0bywgdG9rZW5zLCBmZWUsIG5vbmNlLCBzaWcsIGZlZUFjY291bnQpOwogICAgfQogICAgZnVuY3Rpb24gc2lnbmVkVHJhbnNmZXIoYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UsIGJ5dGVzIHNpZywgYWRkcmVzcyBmZWVBY2NvdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuc2lnbmVkVHJhbnNmZXIodG9rZW5Pd25lciwgdG8sIHRva2VucywgZmVlLCBub25jZSwgc2lnLCBmZWVBY2NvdW50KTsKICAgIH0KICAgIGZ1bmN0aW9uIHNpZ25lZEFwcHJvdmVIYXNoKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIgaGFzaCkgewogICAgICAgIHJldHVybiBkYXRhLnNpZ25lZEFwcHJvdmVIYXNoKHRva2VuT3duZXIsIHNwZW5kZXIsIHRva2VucywgZmVlLCBub25jZSk7CiAgICB9CiAgICBmdW5jdGlvbiBzaWduZWRBcHByb3ZlQ2hlY2soYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zLCB1aW50IGZlZSwgdWludCBub25jZSwgYnl0ZXMgc2lnLCBhZGRyZXNzIGZlZUFjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKENoZWNrUmVzdWx0IHJlc3VsdCkgewogICAgICAgIHJldHVybiBkYXRhLnNpZ25lZEFwcHJvdmVDaGVjayh0b2tlbk93bmVyLCBzcGVuZGVyLCB0b2tlbnMsIGZlZSwgbm9uY2UsIHNpZywgZmVlQWNjb3VudCk7CiAgICB9CiAgICBmdW5jdGlvbiBzaWduZWRBcHByb3ZlKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UsIGJ5dGVzIHNpZywgYWRkcmVzcyBmZWVBY2NvdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuc2lnbmVkQXBwcm92ZSh0b2tlbk93bmVyLCBzcGVuZGVyLCB0b2tlbnMsIGZlZSwgbm9uY2UsIHNpZywgZmVlQWNjb3VudCk7CiAgICB9CiAgICBmdW5jdGlvbiBzaWduZWRUcmFuc2ZlckZyb21IYXNoKGFkZHJlc3Mgc3BlbmRlciwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHRva2VucywgdWludCBmZWUsIHVpbnQgbm9uY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIgaGFzaCkgewogICAgICAgIHJldHVybiBkYXRhLnNpZ25lZFRyYW5zZmVyRnJvbUhhc2goc3BlbmRlciwgZnJvbSwgdG8sIHRva2VucywgZmVlLCBub25jZSk7CiAgICB9CiAgICBmdW5jdGlvbiBzaWduZWRUcmFuc2ZlckZyb21DaGVjayhhZGRyZXNzIHNwZW5kZXIsIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAoQ2hlY2tSZXN1bHQgcmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIGRhdGEuc2lnbmVkVHJhbnNmZXJGcm9tQ2hlY2soc3BlbmRlciwgZnJvbSwgdG8sIHRva2VucywgZmVlLCBub25jZSwgc2lnLCBmZWVBY2NvdW50KTsKICAgIH0KICAgIGZ1bmN0aW9uIHNpZ25lZFRyYW5zZmVyRnJvbShhZGRyZXNzIHNwZW5kZXIsIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB0b2tlbnMsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiBkYXRhLnNpZ25lZFRyYW5zZmVyRnJvbShzcGVuZGVyLCBmcm9tLCB0bywgdG9rZW5zLCBmZWUsIG5vbmNlLCBzaWcsIGZlZUFjY291bnQpOwogICAgfQogICAgZnVuY3Rpb24gc2lnbmVkQXBwcm92ZUFuZENhbGxIYXNoKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucywgYnl0ZXMgX2RhdGEsIHVpbnQgZmVlLCB1aW50IG5vbmNlKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyIGhhc2gpIHsKICAgICAgICByZXR1cm4gZGF0YS5zaWduZWRBcHByb3ZlQW5kQ2FsbEhhc2godG9rZW5Pd25lciwgc3BlbmRlciwgdG9rZW5zLCBfZGF0YSwgZmVlLCBub25jZSk7CiAgICB9CiAgICBmdW5jdGlvbiBzaWduZWRBcHByb3ZlQW5kQ2FsbENoZWNrKGFkZHJlc3MgdG9rZW5Pd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucywgYnl0ZXMgX2RhdGEsIHVpbnQgZmVlLCB1aW50IG5vbmNlLCBieXRlcyBzaWcsIGFkZHJlc3MgZmVlQWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAoQ2hlY2tSZXN1bHQgcmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIGRhdGEuc2lnbmVkQXBwcm92ZUFuZENhbGxDaGVjayh0b2tlbk93bmVyLCBzcGVuZGVyLCB0b2tlbnMsIF9kYXRhLCBmZWUsIG5vbmNlLCBzaWcsIGZlZUFjY291bnQpOwogICAgfQogICAgZnVuY3Rpb24gc2lnbmVkQXBwcm92ZUFuZENhbGwoYWRkcmVzcyB0b2tlbk93bmVyLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdG9rZW5zLCBieXRlcyBfZGF0YSwgdWludCBmZWUsIHVpbnQgbm9uY2UsIGJ5dGVzIHNpZywgYWRkcmVzcyBmZWVBY2NvdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIGRhdGEuc2lnbmVkQXBwcm92ZUFuZENhbGwodG9rZW5Pd25lciwgc3BlbmRlciwgdG9rZW5zLCBfZGF0YSwgZmVlLCBub25jZSwgc2lnLCBmZWVBY2NvdW50KTsKICAgIH0KfQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBPd25lZCBjb250cmFjdAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IE93bmVkIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXI7CiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8pOwoKICAgIGZ1bmN0aW9uIE93bmVkKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5ld093bmVyKTsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgbmV3T3duZXIgPSBhZGRyZXNzKDApOwogICAgfQogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXBJbW1lZGlhdGVseShhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIF9uZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICAgICAgbmV3T3duZXIgPSBhZGRyZXNzKDApOwogICAgfQp9CgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBCb2treVBvb0JhaCdzIFRva2VuIFRlbGVwb3J0YXRpb24gU2VydmljZSBUb2tlbiBGYWN0b3J5IHYxLjEwCi8vCi8vIEVuam95LiAoYykgQm9ra3lQb29CYWggLyBCb2sgQ29uc3VsdGluZyBQdHkgTHRkIDIwMTguIFRoZSBNSVQgTGljZW5jZS4KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb250cmFjdCBCVFRTVG9rZW5GYWN0b3J5IGlzIE93bmVkIHsKCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIEludGVybmFsIGRhdGEKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIF92ZXJpZnk7CiAgICBhZGRyZXNzW10gcHVibGljIGRlcGxveWVkVG9rZW5zOwoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gRXZlbnQKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZXZlbnQgQlRUU1Rva2VuTGlzdGluZyhhZGRyZXNzIGluZGV4ZWQgb3duZXJBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBidHRzVG9rZW5BZGRyZXNzLAogICAgICAgIHN0cmluZyBzeW1ib2wsIHN0cmluZyBuYW1lLCB1aW50OCBkZWNpbWFscywKICAgICAgICB1aW50IGluaXRpYWxTdXBwbHksIGJvb2wgbWludGFibGUsIGJvb2wgdHJhbnNmZXJhYmxlKTsKCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBBbnlvbmUgY2FuIGNhbGwgdGhpcyBtZXRob2QgdG8gdmVyaWZ5IHdoZXRoZXIgdGhlIGJ0dHNUb2tlbiBjb250cmFjdCBhdAogICAgLy8gdGhlIHNwZWNpZmllZCBhZGRyZXNzIHdhcyBkZXBsb3llZCB1c2luZyB0aGlzIGZhY3RvcnkKICAgIC8vCiAgICAvLyBQYXJhbWV0ZXJzOgogICAgLy8gICB0b2tlbkNvbnRyYWN0ICB0aGUgYnR0c1Rva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgIC8vCiAgICAvLyBSZXR1cm4gdmFsdWVzOgogICAgLy8gICB2YWxpZCAgICAgICAgICBkaWQgdGhpcyBCVFRTVG9rZW5GYWN0b3J5IGNyZWF0ZSB0aGUgQlRUU1Rva2VuIGNvbnRyYWN0PwogICAgLy8gICBkZWNpbWFscyAgICAgICBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMgZm9yIHRoZSB0b2tlbiBjb250cmFjdAogICAgLy8gICBpbml0aWFsU3VwcGx5ICB0aGUgdG9rZW4gaW5pdGlhbCBzdXBwbHkKICAgIC8vICAgbWludGFibGUgICAgICAgaXMgdGhlIHRva2VuIG1pbnRhYmxlIGFmdGVyIGRlcGxveW1lbnQ/CiAgICAvLyAgIHRyYW5zZmVyYWJsZSAgIGFyZSB0aGUgdG9rZW5zIHRyYW5zZmVyYWJsZSBhZnRlciBkZXBsb3ltZW50PwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiB2ZXJpZnkoYWRkcmVzcyB0b2tlbkNvbnRyYWN0KSBwdWJsaWMgdmlldyByZXR1cm5zICgKICAgICAgICBib29sICAgIHZhbGlkLAogICAgICAgIGFkZHJlc3Mgb3duZXIsCiAgICAgICAgdWludCAgICBkZWNpbWFscywKICAgICAgICBib29sICAgIG1pbnRhYmxlLAogICAgICAgIGJvb2wgICAgdHJhbnNmZXJhYmxlCiAgICApIHsKICAgICAgICB2YWxpZCA9IF92ZXJpZnlbdG9rZW5Db250cmFjdF07CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICAgIEJUVFNUb2tlbiB0ID0gQlRUU1Rva2VuKHRva2VuQ29udHJhY3QpOwogICAgICAgICAgICBvd25lciAgICAgICAgPSB0Lm93bmVyKCk7CiAgICAgICAgICAgIGRlY2ltYWxzICAgICA9IHQuZGVjaW1hbHMoKTsKICAgICAgICAgICAgbWludGFibGUgICAgID0gdC5taW50YWJsZSgpOwogICAgICAgICAgICB0cmFuc2ZlcmFibGUgPSB0LnRyYW5zZmVyYWJsZSgpOwogICAgICAgIH0KICAgIH0KCgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBBbnkgYWNjb3VudCBjYW4gY2FsbCB0aGlzIG1ldGhvZCB0byBkZXBsb3kgYSBuZXcgQlRUU1Rva2VuIGNvbnRyYWN0LgogICAgLy8gVGhlIG93bmVyIG9mIHRoZSBCVFRTVG9rZW4gY29udHJhY3Qgd2lsbCBiZSB0aGUgY2FsbGluZyBhY2NvdW50CiAgICAvLwogICAgLy8gUGFyYW1ldGVyczoKICAgIC8vICAgc3ltYm9sICAgICAgICAgc3ltYm9sCiAgICAvLyAgIG5hbWUgICAgICAgICAgIG5hbWUKICAgIC8vICAgZGVjaW1hbHMgICAgICAgbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzIGZvciB0aGUgdG9rZW4gY29udHJhY3QKICAgIC8vICAgaW5pdGlhbFN1cHBseSAgdGhlIHRva2VuIGluaXRpYWwgc3VwcGx5CiAgICAvLyAgIG1pbnRhYmxlICAgICAgIGlzIHRoZSB0b2tlbiBtaW50YWJsZSBhZnRlciBkZXBsb3ltZW50PwogICAgLy8gICB0cmFuc2ZlcmFibGUgICBhcmUgdGhlIHRva2VucyB0cmFuc2ZlcmFibGUgYWZ0ZXIgZGVwbG95bWVudD8KICAgIC8vCiAgICAvLyBGb3IgZXhhbXBsZSwgZGVwbG95aW5nIGEgQlRUU1Rva2VuIGNvbnRyYWN0IHdpdGggYGluaXRpYWxTdXBwbHlgIG9mCiAgICAvLyAxLDAwMC4wMDAwMDAwMDAwMDAwMDAwMDAgdG9rZW5zOgogICAgLy8gICBzeW1ib2wgICAgICAgICAiTUUiCiAgICAvLyAgIG5hbWUgICAgICAgICAgICJNeSBUb2tlbiIKICAgIC8vICAgZGVjaW1hbHMgICAgICAgMTgKICAgIC8vICAgaW5pdGlhbFN1cHBseSAgMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgPSAxLDAwMC4wMDAwMDAwMDAwMDAwMDAwMDAKICAgIC8vICAgICAgICAgICAgICAgICAgdG9rZW5zCiAgICAvLyAgIG1pbnRhYmxlICAgICAgIGNhbiB0b2tlbnMgYmUgbWludGVkIGFmdGVyIGRlcGxveW1lbnQ/CiAgICAvLyAgIHRyYW5zZmVyYWJsZSAgIGFyZSB0aGUgdG9rZW5zIHRyYW5zZmVyYWJsZSBhZnRlciBkZXBsb3ltZW50PwogICAgLy8KICAgIC8vIFRoZSBCVFRTVG9rZW5MaXN0aW5nKCkgZXZlbnQgaXMgbG9nZ2VkIHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzCiAgICAvLyAgIG93bmVyICAgICAgICAgIHRoZSBhY2NvdW50IHRoYXQgZXhlY3V0ZSB0aGlzIHRyYW5zYWN0aW9uCiAgICAvLyAgIHN5bWJvbCAgICAgICAgIHN5bWJvbAogICAgLy8gICBuYW1lICAgICAgICAgICBuYW1lCiAgICAvLyAgIGRlY2ltYWxzICAgICAgIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlcyBmb3IgdGhlIHRva2VuIGNvbnRyYWN0CiAgICAvLyAgIGluaXRpYWxTdXBwbHkgIHRoZSB0b2tlbiBpbml0aWFsIHN1cHBseQogICAgLy8gICBtaW50YWJsZSAgICAgICBjYW4gdG9rZW5zIGJlIG1pbnRlZCBhZnRlciBkZXBsb3ltZW50PwogICAgLy8gICB0cmFuc2ZlcmFibGUgICBhcmUgdGhlIHRva2VucyB0cmFuc2ZlcmFibGUgYWZ0ZXIgZGVwbG95bWVudD8KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gZGVwbG95QlRUU1Rva2VuQ29udHJhY3QoCiAgICAgICAgc3RyaW5nIHN5bWJvbCwKICAgICAgICBzdHJpbmcgbmFtZSwKICAgICAgICB1aW50OCBkZWNpbWFscywKICAgICAgICB1aW50IGluaXRpYWxTdXBwbHksCiAgICAgICAgYm9vbCBtaW50YWJsZSwKICAgICAgICBib29sIHRyYW5zZmVyYWJsZQogICAgKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBidHRzVG9rZW5BZGRyZXNzKSB7CiAgICAgICAgYnR0c1Rva2VuQWRkcmVzcyA9IG5ldyBCVFRTVG9rZW4oCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHN5bWJvbCwKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgZGVjaW1hbHMsCiAgICAgICAgICAgIGluaXRpYWxTdXBwbHksCiAgICAgICAgICAgIG1pbnRhYmxlLAogICAgICAgICAgICB0cmFuc2ZlcmFibGUpOwogICAgICAgIC8vIFJlY29yZCB0aGF0IHRoaXMgZmFjdG9yeSBjcmVhdGVkIHRoZSB0cmFkZXIKICAgICAgICBfdmVyaWZ5W2J0dHNUb2tlbkFkZHJlc3NdID0gdHJ1ZTsKICAgICAgICBkZXBsb3llZFRva2Vucy5wdXNoKGJ0dHNUb2tlbkFkZHJlc3MpOwogICAgICAgIEJUVFNUb2tlbkxpc3RpbmcobXNnLnNlbmRlciwgYnR0c1Rva2VuQWRkcmVzcywgc3ltYm9sLCBuYW1lLCBkZWNpbWFscywKICAgICAgICAgICAgaW5pdGlhbFN1cHBseSwgbWludGFibGUsIHRyYW5zZmVyYWJsZSk7CiAgICB9CgoKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8gTnVtYmVyIG9mIGRlcGxveWVkIHRva2VucwogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBmdW5jdGlvbiBudW1iZXJPZkRlcGxveWVkVG9rZW5zKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBkZXBsb3llZFRva2Vucy5sZW5ndGg7CiAgICB9CgogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyBGYWN0b3J5IG93bmVyIGNhbiB0cmFuc2ZlciBvdXQgYW55IGFjY2lkZW50YWxseSBzZW50IEVSQzIwIHRva2VucwogICAgLy8KICAgIC8vIFBhcmFtZXRlcnM6CiAgICAvLyAgIHRva2VuQWRkcmVzcyAgY29udHJhY3QgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgYmVpbmcgd2l0aGRyYXduCiAgICAvLyAgICAgICAgICAgICAgICAgZnJvbQogICAgLy8gICB0b2tlbnMgICAgICAgIG51bWJlciBvZiB0b2tlbnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gdHJhbnNmZXJBbnlFUkMyMFRva2VuKGFkZHJlc3MgdG9rZW5BZGRyZXNzLCB1aW50IHRva2VucykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gRVJDMjBJbnRlcmZhY2UodG9rZW5BZGRyZXNzKS50cmFuc2Zlcihvd25lciwgdG9rZW5zKTsKICAgIH0KCiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vIERvbid0IGFjY2VwdCBldGhlcnMKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJldmVydCgpOwogICAgfQp9'.
	

]
