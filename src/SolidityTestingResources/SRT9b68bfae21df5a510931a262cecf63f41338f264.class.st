Class {
	#name : #SRT9b68bfae21df5a510931a262cecf63f41338f264,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9b68bfae21df5a510931a262cecf63f41338f264 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8vIGFjY2VwdGVkIGZyb20gemVwcGVsaW4tc29saWRpdHkgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQovKgogKiBFUkMyMCBpbnRlcmZhY2UKICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgewogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCi8vIGFjY2VwdGVkIGZyb20gemVwcGVsaW4tc29saWRpdHkgaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA+IDApOwogICAgICAgIHVpbnQgYyA9IGEgLyBiOwogICAgICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEgJiYgYyA+PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgICAgICBpZiAoIWFzc2VydGlvbikgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9Cgp9CgovLy8gQHRpdGxlIE11bHRpc2lnbmF0dXJlIHdhbGxldCAtIEFsbG93cyBtdWx0aXBsZSBwYXJ0aWVzIHRvIGFncmVlIG9uIHRyYW5zYWN0aW9ucyBiZWZvcmUgZXhlY3V0aW9uLgovLy8gQGF1dGhvciBTdGVmYW4gR2VvcmdlIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYWVkZGRhY2JjOGNmYzA4MGM5Y2JjMWRjYzljYmVlY2RjMWMwZGRjYmMwZGRkN2RkODBjMGNiZGEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBNdWx0aVNpZ1dhbGxldCB7CgogICAgLy8gZmxhZyB0byBkZXRlcm1pbmUgaWYgYWRkcmVzcyBpcyBmb3IgYSByZWFsIGNvbnRyYWN0IG9yIG5vdAogICAgYm9vbCBwdWJsaWMgaXNNdWx0aVNpZ1dhbGxldCA9IGZhbHNlOwoKICAgIHVpbnQgY29uc3RhbnQgcHVibGljIE1BWF9PV05FUl9DT1VOVCA9IDUwOwoKICAgIGV2ZW50IENvbmZpcm1hdGlvbihhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGluZGV4ZWQgdHJhbnNhY3Rpb25JZCk7CiAgICBldmVudCBSZXZvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IFN1Ym1pc3Npb24odWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgRXhlY3V0aW9uKHVpbnQgaW5kZXhlZCB0cmFuc2FjdGlvbklkKTsKICAgIGV2ZW50IEV4ZWN1dGlvbkZhaWx1cmUodWludCBpbmRleGVkIHRyYW5zYWN0aW9uSWQpOwogICAgZXZlbnQgRGVwb3NpdChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IE93bmVyQWRkaXRpb24oYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IE93bmVyUmVtb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2UodWludCByZXF1aXJlZCk7CgogICAgbWFwcGluZyAodWludCA9PiBUcmFuc2FjdGlvbikgcHVibGljIHRyYW5zYWN0aW9uczsKICAgIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSkgcHVibGljIGNvbmZpcm1hdGlvbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc093bmVyOwogICAgYWRkcmVzc1tdIHB1YmxpYyBvd25lcnM7CiAgICB1aW50IHB1YmxpYyByZXF1aXJlZDsKICAgIHVpbnQgcHVibGljIHRyYW5zYWN0aW9uQ291bnQ7CgogICAgc3RydWN0IFRyYW5zYWN0aW9uIHsKICAgIGFkZHJlc3MgZGVzdGluYXRpb247CiAgICB1aW50IHZhbHVlOwogICAgYnl0ZXMgZGF0YTsKICAgIGJvb2wgZXhlY3V0ZWQ7CiAgICB9CgogICAgbW9kaWZpZXIgb25seVdhbGxldCgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICBpZiAoaXNPd25lcltvd25lcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJFeGlzdHMoYWRkcmVzcyBvd25lcikgewogICAgICAgIGlmICghaXNPd25lcltvd25lcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdHJhbnNhY3Rpb25FeGlzdHModWludCB0cmFuc2FjdGlvbklkKSB7CiAgICAgICAgaWYgKHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5kZXN0aW5hdGlvbiA9PSAwKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQsIGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICBpZiAoIWNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJdKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdENvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQsIGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcl0pIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90RXhlY3V0ZWQodWludCB0cmFuc2FjdGlvbklkKSB7CiAgICAgICAgaWYgKHRyYW5zYWN0aW9uc1t0cmFuc2FjdGlvbklkXS5leGVjdXRlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3ROdWxsKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICBpZiAoX2FkZHJlc3MgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB2YWxpZFJlcXVpcmVtZW50KHVpbnQgb3duZXJDb3VudCwgdWludCBfcmVxdWlyZWQpIHsKICAgICAgICBpZiAob3duZXJDb3VudCA+IE1BWF9PV05FUl9DT1VOVCkgdGhyb3c7CiAgICAgICAgaWYgKF9yZXF1aXJlZCA+IG93bmVyQ291bnQpIHRocm93OwogICAgICAgIGlmIChfcmVxdWlyZWQgPT0gMCkgdGhyb3c7CiAgICAgICAgaWYgKG93bmVyQ291bnQgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBhbGxvd3MgdG8gZGVwb3NpdCBldGhlci4KICAgIGZ1bmN0aW9uKCkKICAgIHBheWFibGUKICAgIHsKICAgICAgICBpZiAobXNnLnZhbHVlID4gMCkKICAgICAgICBEZXBvc2l0KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3Igc2V0cyBpbml0aWFsIG93bmVycyBhbmQgcmVxdWlyZWQgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMuCiAgICAvLy8gQHBhcmFtIF9vd25lcnMgTGlzdCBvZiBpbml0aWFsIG93bmVycy4KICAgIC8vLyBAcGFyYW0gX3JlcXVpcmVkIE51bWJlciBvZiByZXF1aXJlZCBjb25maXJtYXRpb25zLgogICAgZnVuY3Rpb24gTXVsdGlTaWdXYWxsZXQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3JlcXVpcmVkKQogICAgcHVibGljCiAgICB2YWxpZFJlcXVpcmVtZW50KF9vd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxfb3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpc093bmVyW19vd25lcnNbaV1dIHx8IF9vd25lcnNbaV0gPT0gMCkgdGhyb3c7CiAgICAgICAgICAgIGlzT3duZXJbX293bmVyc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpc011bHRpU2lnV2FsbGV0ID0gdHJ1ZTsKICAgICAgICBvd25lcnMgPSBfb3duZXJzOwogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byBhZGQgYSBuZXcgb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBuZXcgb3duZXIuCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIG93bmVyKQogICAgcHVibGljCiAgICBvbmx5V2FsbGV0CiAgICBvd25lckRvZXNOb3RFeGlzdChvd25lcikKICAgIG5vdE51bGwob3duZXIpCiAgICB2YWxpZFJlcXVpcmVtZW50KG93bmVycy5sZW5ndGggKyAxLCByZXF1aXJlZCkKICAgIHsKICAgICAgICBpc093bmVyW293bmVyXSA9IHRydWU7CiAgICAgICAgb3duZXJzLnB1c2gob3duZXIpOwogICAgICAgIE93bmVyQWRkaXRpb24ob3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyB0byByZW1vdmUgYW4gb3duZXIuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAgIC8vLyBAcGFyYW0gb3duZXIgQWRkcmVzcyBvZiBvd25lci4KICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3Mgb3duZXIpCiAgICBwdWJsaWMKICAgIG9ubHlXYWxsZXQKICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgewogICAgICAgIGlzT3duZXJbb3duZXJdID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxvd25lcnMubGVuZ3RoIC0gMTsgaSsrKQogICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsKICAgICAgICAgICAgb3duZXJzW2ldID0gb3duZXJzW293bmVycy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIG93bmVycy5sZW5ndGggLT0gMTsKICAgICAgICBpZiAocmVxdWlyZWQgPiBvd25lcnMubGVuZ3RoKQogICAgICAgIGNoYW5nZVJlcXVpcmVtZW50KG93bmVycy5sZW5ndGgpOwogICAgICAgIE93bmVyUmVtb3ZhbChvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHRvIHJlcGxhY2UgYW4gb3duZXIgd2l0aCBhIG5ldyBvd25lci4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG93bmVyIHRvIGJlIHJlcGxhY2VkLgogICAgLy8vIEBwYXJhbSBuZXdPd25lciBBZGRyZXNzIG9mIG5ldyBvd25lci4KICAgIC8vLyBAcGFyYW0gaW5kZXggdGhlIGluZHggb2YgdGhlIG93bmVyIHRvIGJlIHJlcGxhY2VkCiAgICBmdW5jdGlvbiByZXBsYWNlT3duZXJJbmRleGVkKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgbmV3T3duZXIsIHVpbnQgaW5kZXgpCiAgICBwdWJsaWMKICAgIG9ubHlXYWxsZXQKICAgIG93bmVyRXhpc3RzKG93bmVyKQogICAgb3duZXJEb2VzTm90RXhpc3QobmV3T3duZXIpCiAgICB7CiAgICAgICAgaWYgKG93bmVyc1tpbmRleF0gIT0gb3duZXIpIHRocm93OwogICAgICAgIG93bmVyc1tpbmRleF0gPSBuZXdPd25lcjsKICAgICAgICBpc093bmVyW293bmVyXSA9IGZhbHNlOwogICAgICAgIGlzT3duZXJbbmV3T3duZXJdID0gdHJ1ZTsKICAgICAgICBPd25lclJlbW92YWwob3duZXIpOwogICAgICAgIE93bmVyQWRkaXRpb24obmV3T3duZXIpOwogICAgfQoKCiAgICAvLy8gQGRldiBBbGxvd3MgdG8gY2hhbmdlIHRoZSBudW1iZXIgb2YgcmVxdWlyZWQgY29uZmlybWF0aW9ucy4gVHJhbnNhY3Rpb24gaGFzIHRvIGJlIHNlbnQgYnkgd2FsbGV0LgogICAgLy8vIEBwYXJhbSBfcmVxdWlyZWQgTnVtYmVyIG9mIHJlcXVpcmVkIGNvbmZpcm1hdGlvbnMuCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCkKICAgIHB1YmxpYwogICAgb25seVdhbGxldAogICAgdmFsaWRSZXF1aXJlbWVudChvd25lcnMubGVuZ3RoLCBfcmVxdWlyZWQpCiAgICB7CiAgICAgICAgcmVxdWlyZWQgPSBfcmVxdWlyZWQ7CiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2UoX3JlcXVpcmVkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gc3VibWl0IGFuZCBjb25maXJtIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIGRlc3RpbmF0aW9uIFRyYW5zYWN0aW9uIHRhcmdldCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUcmFuc2FjdGlvbiBldGhlciB2YWx1ZS4KICAgIC8vLyBAcGFyYW0gZGF0YSBUcmFuc2FjdGlvbiBkYXRhIHBheWxvYWQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gc3VibWl0VHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkKICAgIHB1YmxpYwogICAgcmV0dXJucyAodWludCB0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIHRyYW5zYWN0aW9uSWQgPSBhZGRUcmFuc2FjdGlvbihkZXN0aW5hdGlvbiwgdmFsdWUsIGRhdGEpOwogICAgICAgIGNvbmZpcm1UcmFuc2FjdGlvbih0cmFuc2FjdGlvbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbGxvd3MgYW4gb3duZXIgdG8gY29uZmlybSBhIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSB0cmFuc2FjdGlvbklkIFRyYW5zYWN0aW9uIElELgogICAgZnVuY3Rpb24gY29uZmlybVRyYW5zYWN0aW9uKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHB1YmxpYwogICAgb3duZXJFeGlzdHMobXNnLnNlbmRlcikKICAgIHRyYW5zYWN0aW9uRXhpc3RzKHRyYW5zYWN0aW9uSWQpCiAgICBub3RDb25maXJtZWQodHJhbnNhY3Rpb25JZCwgbXNnLnNlbmRlcikKICAgIHsKICAgICAgICBjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgdHJhbnNhY3Rpb25JZCk7CiAgICAgICAgZXhlY3V0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbiBvd25lciB0byByZXZva2UgYSBjb25maXJtYXRpb24gZm9yIGEgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICBmdW5jdGlvbiByZXZva2VDb25maXJtYXRpb24odWludCB0cmFuc2FjdGlvbklkKQogICAgcHVibGljCiAgICBvd25lckV4aXN0cyhtc2cuc2VuZGVyKQogICAgY29uZmlybWVkKHRyYW5zYWN0aW9uSWQsIG1zZy5zZW5kZXIpCiAgICBub3RFeGVjdXRlZCh0cmFuc2FjdGlvbklkKQogICAgewogICAgICAgIGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bbXNnLnNlbmRlcl0gPSBmYWxzZTsKICAgICAgICBSZXZvY2F0aW9uKG1zZy5zZW5kZXIsIHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIENvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICBmdW5jdGlvbiBpc0NvbmZpcm1lZCh1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIGZvciAodWludCBpPTA7IGk8b3duZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb25maXJtYXRpb25zW3RyYW5zYWN0aW9uSWRdW293bmVyc1tpXV0pCiAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICAgIGlmIChjb3VudCA9PSByZXF1aXJlZCkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IEFsbG93cyBhbnlvbmUgdG8gZXhlY3V0ZSBhIGNvbmZpcm1lZCB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIGV4ZWN1dGVUcmFuc2FjdGlvbih1aW50IHRyYW5zYWN0aW9uSWQpCiAgICBpbnRlcm5hbAogICAgbm90RXhlY3V0ZWQodHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICBpZiAoaXNDb25maXJtZWQodHJhbnNhY3Rpb25JZCkpIHsKICAgICAgICAgICAgVHJhbnNhY3Rpb24gdHggPSB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF07CiAgICAgICAgICAgIHR4LmV4ZWN1dGVkID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHR4LmRlc3RpbmF0aW9uLmNhbGwudmFsdWUodHgudmFsdWUpKHR4LmRhdGEpKQogICAgICAgICAgICBFeGVjdXRpb24odHJhbnNhY3Rpb25JZCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgRXhlY3V0aW9uRmFpbHVyZSh0cmFuc2FjdGlvbklkKTsKICAgICAgICAgICAgICAgIHR4LmV4ZWN1dGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhIG5ldyB0cmFuc2FjdGlvbiB0byB0aGUgdHJhbnNhY3Rpb24gbWFwcGluZywgaWYgdHJhbnNhY3Rpb24gZG9lcyBub3QgZXhpc3QgeWV0LgogICAgLy8vIEBwYXJhbSBkZXN0aW5hdGlvbiBUcmFuc2FjdGlvbiB0YXJnZXQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdmFsdWUgVHJhbnNhY3Rpb24gZXRoZXIgdmFsdWUuCiAgICAvLy8gQHBhcmFtIGRhdGEgVHJhbnNhY3Rpb24gZGF0YSBwYXlsb2FkLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyB0cmFuc2FjdGlvbiBJRC4KICAgIGZ1bmN0aW9uIGFkZFRyYW5zYWN0aW9uKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpCiAgICBpbnRlcm5hbAogICAgbm90TnVsbChkZXN0aW5hdGlvbikKICAgIHJldHVybnMgKHVpbnQgdHJhbnNhY3Rpb25JZCkKICAgIHsKICAgICAgICB0cmFuc2FjdGlvbklkID0gdHJhbnNhY3Rpb25Db3VudDsKICAgICAgICB0cmFuc2FjdGlvbnNbdHJhbnNhY3Rpb25JZF0gPSBUcmFuc2FjdGlvbih7CiAgICAgICAgZGVzdGluYXRpb246IGRlc3RpbmF0aW9uLAogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgIGV4ZWN1dGVkOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHRyYW5zYWN0aW9uQ291bnQgKz0gMTsKICAgICAgICBTdWJtaXNzaW9uKHRyYW5zYWN0aW9uSWQpOwogICAgfQoKICAgIC8qCiAgICAgKiBXZWIzIGNhbGwgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMgb2YgYSB0cmFuc2FjdGlvbi4KICAgIC8vLyBAcGFyYW0gdHJhbnNhY3Rpb25JZCBUcmFuc2FjdGlvbiBJRC4KICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiBjb25maXJtYXRpb25zLgogICAgZnVuY3Rpb24gZ2V0Q29uZmlybWF0aW9uQ291bnQodWludCB0cmFuc2FjdGlvbklkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludCBjb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPG93bmVycy5sZW5ndGg7IGkrKykKICAgICAgICBpZiAoY29uZmlybWF0aW9uc1t0cmFuc2FjdGlvbklkXVtvd25lcnNbaV1dKQogICAgICAgIGNvdW50ICs9IDE7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0b3RhbCBudW1iZXIgb2YgdHJhbnNhY3Rpb25zIGFmdGVyIGZpbGVycyBhcmUgYXBwbGllZC4KICAgIC8vLyBAcGFyYW0gcGVuZGluZyBJbmNsdWRlIHBlbmRpbmcgdHJhbnNhY3Rpb25zLgogICAgLy8vIEBwYXJhbSBleGVjdXRlZCBJbmNsdWRlIGV4ZWN1dGVkIHRyYW5zYWN0aW9ucy4KICAgIC8vLyBAcmV0dXJuIFRvdGFsIG51bWJlciBvZiB0cmFuc2FjdGlvbnMgYWZ0ZXIgZmlsdGVycyBhcmUgYXBwbGllZC4KICAgIGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uQ291bnQoYm9vbCBwZW5kaW5nLCBib29sIGV4ZWN1dGVkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAodWludCBjb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPHRyYW5zYWN0aW9uQ291bnQ7IGkrKykKICAgICAgICBpZiAoKHBlbmRpbmcgJiYgIXRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkgfHwKICAgICAgICAoZXhlY3V0ZWQgJiYgdHJhbnNhY3Rpb25zW2ldLmV4ZWN1dGVkKSkKICAgICAgICBjb3VudCArPSAxOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiBvd25lcnMuCiAgICAvLy8gQHJldHVybiBMaXN0IG9mIG93bmVyIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIGdldE93bmVycygpCiAgICBwdWJsaWMKICAgIGNvbnN0YW50CiAgICByZXR1cm5zIChhZGRyZXNzW10pCiAgICB7CiAgICAgICAgcmV0dXJuIG93bmVyczsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGFycmF5IHdpdGggb3duZXIgYWRkcmVzc2VzLCB3aGljaCBjb25maXJtZWQgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIHRyYW5zYWN0aW9uSWQgVHJhbnNhY3Rpb24gSUQuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIGFycmF5IG9mIG93bmVyIGFkZHJlc3Nlcy4KICAgIGZ1bmN0aW9uIGdldENvbmZpcm1hdGlvbnModWludCB0cmFuc2FjdGlvbklkKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAoYWRkcmVzc1tdIF9jb25maXJtYXRpb25zKQogICAgewogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgY29uZmlybWF0aW9uc1RlbXAgPSBuZXcgYWRkcmVzc1tdKG93bmVycy5sZW5ndGgpOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGk9MDsgaTxvd25lcnMubGVuZ3RoOyBpKyspCiAgICAgICAgaWYgKGNvbmZpcm1hdGlvbnNbdHJhbnNhY3Rpb25JZF1bb3duZXJzW2ldXSkgewogICAgICAgICAgICBjb25maXJtYXRpb25zVGVtcFtjb3VudF0gPSBvd25lcnNbaV07CiAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgfQogICAgICAgIF9jb25maXJtYXRpb25zID0gbmV3IGFkZHJlc3NbXShjb3VudCk7CiAgICAgICAgZm9yIChpPTA7IGk8Y291bnQ7IGkrKykKICAgICAgICBfY29uZmlybWF0aW9uc1tpXSA9IGNvbmZpcm1hdGlvbnNUZW1wW2ldOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbGlzdCBvZiB0cmFuc2FjdGlvbiBJRHMgaW4gZGVmaW5lZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gZnJvbSBJbmRleCBzdGFydCBwb3NpdGlvbiBvZiB0cmFuc2FjdGlvbiBhcnJheS4KICAgIC8vLyBAcGFyYW0gdG8gSW5kZXggZW5kIHBvc2l0aW9uIG9mIHRyYW5zYWN0aW9uIGFycmF5LgogICAgLy8vIEBwYXJhbSBwZW5kaW5nIEluY2x1ZGUgcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICAvLy8gQHBhcmFtIGV4ZWN1dGVkIEluY2x1ZGUgZXhlY3V0ZWQgdHJhbnNhY3Rpb25zLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBhcnJheSBvZiB0cmFuc2FjdGlvbiBJRHMuCiAgICBmdW5jdGlvbiBnZXRUcmFuc2FjdGlvbklkcyh1aW50IGZyb20sIHVpbnQgdG8sIGJvb2wgcGVuZGluZywgYm9vbCBleGVjdXRlZCkKICAgIHB1YmxpYwogICAgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnRbXSBfdHJhbnNhY3Rpb25JZHMpCiAgICB7CiAgICAgICAgdWludFtdIG1lbW9yeSB0cmFuc2FjdGlvbklkc1RlbXAgPSBuZXcgdWludFtdKHRyYW5zYWN0aW9uQ291bnQpOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICBmb3IgKGk9MDsgaTx0cmFuc2FjdGlvbkNvdW50OyBpKyspCiAgICAgICAgaWYgKChwZW5kaW5nICYmICF0cmFuc2FjdGlvbnNbaV0uZXhlY3V0ZWQpIHx8CiAgICAgICAgKGV4ZWN1dGVkICYmIHRyYW5zYWN0aW9uc1tpXS5leGVjdXRlZCkpCiAgICAgICAgewogICAgICAgICAgICB0cmFuc2FjdGlvbklkc1RlbXBbY291bnRdID0gaTsKICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICB9CiAgICAgICAgX3RyYW5zYWN0aW9uSWRzID0gbmV3IHVpbnRbXSh0byAtIGZyb20pOwogICAgICAgIGZvciAoaT1mcm9tOyBpPHRvOyBpKyspCiAgICAgICAgX3RyYW5zYWN0aW9uSWRzW2kgLSBmcm9tXSA9IHRyYW5zYWN0aW9uSWRzVGVtcFtpXTsKICAgIH0KCn0KCmNvbnRyYWN0IE9sZFRva2VuIGlzIEVSQzIwIHsKICAgIC8vIGZsYWcgdG8gZGV0ZXJtaW5lIGlmIGFkZHJlc3MgaXMgZm9yIGEgcmVhbCBjb250cmFjdCBvciBub3QKICAgIGJvb2wgcHVibGljIGlzRGVjZW50QmV0VG9rZW47CgogICAgYWRkcmVzcyBwdWJsaWMgZGVjZW50QmV0TXVsdGlzaWc7Cn0KCmNvbnRyYWN0IE5leHRVcGdyYWRlQWdlbnQgaXMgU2FmZU1hdGggewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgYm9vbCBwdWJsaWMgaXNVcGdyYWRlQWdlbnQ7CgogICAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBmaW5hbGl6ZVVwZ3JhZGUoKSBwdWJsaWM7CgogICAgZnVuY3Rpb24gc2V0T3JpZ2luYWxTdXBwbHkoKSBwdWJsaWM7Cn0KCi8vLyBAdGl0bGUgVGltZS1sb2NrZWQgdmF1bHQgb2YgdG9rZW5zIGFsbG9jYXRlZCB0byBEZWNlbnRCZXQgYWZ0ZXIgMzY1IGRheXMKY29udHJhY3QgTmV3RGVjZW50QmV0VmF1bHQgaXMgU2FmZU1hdGggewoKICAgIC8vIGZsYWcgdG8gZGV0ZXJtaW5lIGlmIGFkZHJlc3MgaXMgZm9yIGEgcmVhbCBjb250cmFjdCBvciBub3QKICAgIGJvb2wgcHVibGljIGlzRGVjZW50QmV0VmF1bHQgPSBmYWxzZTsKCiAgICBOZXdEZWNlbnRCZXRUb2tlbiBkZWNlbnRCZXRUb2tlbjsKCiAgICBhZGRyZXNzIGRlY2VudEJldE11bHRpc2lnOwoKICAgIHVpbnQyNTYgdW5sb2NrZWRBdFRpbWU7CgogICAgLy8gMSB5ZWFyIGxvY2t1cAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdGltZU9mZnNldCA9IDQ3IHdlZWtzOwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgdGhlIERlY2VudEJldCBNdWx0aXNpZyBhZGRyZXNzIGFuZAogICAgLy8vIHRvdGFsIG51bWJlciBvZiBsb2NrZWQgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBOZXdEZWNlbnRCZXRWYXVsdChhZGRyZXNzIF9kZWNlbnRCZXRNdWx0aXNpZykgLyoqIGludGVybmFsICovIHsKICAgICAgICBpZiAoX2RlY2VudEJldE11bHRpc2lnID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgZGVjZW50QmV0VG9rZW4gPSBOZXdEZWNlbnRCZXRUb2tlbihtc2cuc2VuZGVyKTsKICAgICAgICBkZWNlbnRCZXRNdWx0aXNpZyA9IF9kZWNlbnRCZXRNdWx0aXNpZzsKICAgICAgICBpc0RlY2VudEJldFZhdWx0ID0gdHJ1ZTsKCiAgICAgICAgLy8gMSB5ZWFyIGxhdGVyCiAgICAgICAgdW5sb2NrZWRBdFRpbWUgPSBzYWZlQWRkKGdldFRpbWUoKSwgdGltZU9mZnNldCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgbG9ja2VkIHRva2VucyB0byBEZWNlbnQuYmV0J3MgbXVsdGlzaWcgd2FsbGV0CiAgICBmdW5jdGlvbiB1bmxvY2soKSBleHRlcm5hbCB7CiAgICAgICAgLy8gV2FpdCB5b3VyIHR1cm4hCiAgICAgICAgaWYgKGdldFRpbWUoKSA8IHVubG9ja2VkQXRUaW1lKSByZXZlcnQoKTsKICAgICAgICAvLyBXaWxsIGZhaWwgaWYgYWxsb2NhdGlvbiAoYW5kIHRoZXJlZm9yZSB0b1RyYW5zZmVyKSBpcyAwLgogICAgICAgIGlmICghZGVjZW50QmV0VG9rZW4udHJhbnNmZXIoZGVjZW50QmV0TXVsdGlzaWcsIGRlY2VudEJldFRva2VuLmJhbGFuY2VPZih0aGlzKSkpIHJldmVydCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICAvLyBkaXNhbGxvdyBFVEggcGF5bWVudHMgdG8gVGltZVZhdWx0CiAgICBmdW5jdGlvbigpIHBheWFibGUgewogICAgICAgIHJldmVydCgpOwogICAgfQoKfQoKY29udHJhY3QgTmV3RGVjZW50QmV0VG9rZW4gaXMgRVJDMjAsIFNhZmVNYXRoIHsKCiAgICAvLyBUb2tlbiBpbmZvcm1hdGlvbgogICAgYm9vbCBwdWJsaWMgaXNEZWNlbnRCZXRUb2tlbjsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiRGVjZW50LkJldCBUb2tlbiI7CgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiREJFVCI7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsgIC8vIGRlY2ltYWwgcGxhY2VzCgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgaG91c2VQZXJjZW50T2ZUb3RhbCA9IDEwOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IHZhdWx0UGVyY2VudE9mVG90YWwgPSAxODsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBib3VudHlQZXJjZW50T2ZUb3RhbCA9IDI7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgY3Jvd2RmdW5kUGVyY2VudE9mVG90YWwgPSA3MDsKCiAgICAvLyBmbGFnIHRvIGRldGVybWluZSBpZiBhZGRyZXNzIGlzIGZvciBhIHJlYWwgY29udHJhY3Qgb3Igbm90CiAgICBib29sIHB1YmxpYyBpc05ld1Rva2VuID0gZmFsc2U7CgogICAgLy8gVG9rZW4gaW5mb3JtYXRpb24KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIFVwZ3JhZGUgaW5mb3JtYXRpb24KICAgIE5ld1VwZ3JhZGVBZ2VudCBwdWJsaWMgdXBncmFkZUFnZW50OwoKICAgIE5leHRVcGdyYWRlQWdlbnQgcHVibGljIG5leHRVcGdyYWRlQWdlbnQ7CgogICAgYm9vbCBwdWJsaWMgZmluYWxpemVkTmV4dFVwZ3JhZGUgPSBmYWxzZTsKCiAgICBhZGRyZXNzIHB1YmxpYyBuZXh0VXBncmFkZU1hc3RlcjsKCiAgICBldmVudCBVcGdyYWRlKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwoKICAgIGV2ZW50IFVwZ3JhZGVGaW5hbGl6ZWQoYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3MgbmV4dFVwZ3JhZGVBZ2VudCk7CgogICAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOwoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CgogICAgLy8gT2xkIFRva2VuIEluZm9ybWF0aW9uCiAgICBPbGRUb2tlbiBwdWJsaWMgb2xkVG9rZW47CgogICAgYWRkcmVzcyBwdWJsaWMgZGVjZW50QmV0TXVsdGlzaWc7CgogICAgdWludDI1NiBwdWJsaWMgb2xkVG9rZW5Ub3RhbFN1cHBseTsKCiAgICBOZXdEZWNlbnRCZXRWYXVsdCBwdWJsaWMgdGltZVZhdWx0OwoKICAgIGZ1bmN0aW9uIE5ld0RlY2VudEJldFRva2VuKGFkZHJlc3MgX3VwZ3JhZGVBZ2VudCwKICAgIGFkZHJlc3MgX29sZFRva2VuLCBhZGRyZXNzIF9uZXh0VXBncmFkZU1hc3RlcikgcHVibGljIHsKCiAgICAgICAgaXNOZXdUb2tlbiA9IHRydWU7CgogICAgICAgIGlzRGVjZW50QmV0VG9rZW4gPSB0cnVlOwoKICAgICAgICBpZiAoX3VwZ3JhZGVBZ2VudCA9PSAweDApIHJldmVydCgpOwogICAgICAgIHVwZ3JhZGVBZ2VudCA9IE5ld1VwZ3JhZGVBZ2VudChfdXBncmFkZUFnZW50KTsKCiAgICAgICAgaWYgKF9uZXh0VXBncmFkZU1hc3RlciA9PSAweDApIHJldmVydCgpOwogICAgICAgIG5leHRVcGdyYWRlTWFzdGVyID0gX25leHRVcGdyYWRlTWFzdGVyOwoKICAgICAgICBvbGRUb2tlbiA9IE9sZFRva2VuKF9vbGRUb2tlbik7CiAgICAgICAgaWYgKCFvbGRUb2tlbi5pc0RlY2VudEJldFRva2VuKCkpIHJldmVydCgpOwogICAgICAgIG9sZFRva2VuVG90YWxTdXBwbHkgPSBvbGRUb2tlbi50b3RhbFN1cHBseSgpOwoKICAgICAgICBkZWNlbnRCZXRNdWx0aXNpZyA9IG9sZFRva2VuLmRlY2VudEJldE11bHRpc2lnKCk7CiAgICAgICAgaWYgKCFNdWx0aVNpZ1dhbGxldChkZWNlbnRCZXRNdWx0aXNpZykuaXNNdWx0aVNpZ1dhbGxldCgpKSByZXZlcnQoKTsKCiAgICAgICAgdGltZVZhdWx0ID0gbmV3IE5ld0RlY2VudEJldFZhdWx0KGRlY2VudEJldE11bHRpc2lnKTsKICAgICAgICBpZiAoIXRpbWVWYXVsdC5pc0RlY2VudEJldFZhdWx0KCkpIHJldmVydCgpOwoKICAgICAgICAvLyBGb3VuZGVyJ3Mgc3VwcGx5IDogMTglIG9mIHRvdGFsIGdvZXMgdG8gdmF1bHQsIHRpbWUgbG9ja2VkIGZvciAxIHllYXIKICAgICAgICB1aW50MjU2IHZhdWx0VG9rZW5zID0gc2FmZURpdihzYWZlTXVsKG9sZFRva2VuVG90YWxTdXBwbHksIHZhdWx0UGVyY2VudE9mVG90YWwpLAogICAgICAgIGNyb3dkZnVuZFBlcmNlbnRPZlRvdGFsKTsKICAgICAgICBiYWxhbmNlc1t0aW1lVmF1bHRdID0gc2FmZUFkZChiYWxhbmNlc1t0aW1lVmF1bHRdLCB2YXVsdFRva2Vucyk7CiAgICAgICAgVHJhbnNmZXIoMCwgdGltZVZhdWx0LCB2YXVsdFRva2Vucyk7CgogICAgICAgIC8vIEhvdXNlOiAxMCUgb2YgdG90YWwgZ29lcyB0byBEZWNlbnQuYmV0IGZvciBpbml0aWFsIGhvdXNlIHNldHVwCiAgICAgICAgdWludDI1NiBob3VzZVRva2VucyA9IHNhZmVEaXYoc2FmZU11bChvbGRUb2tlblRvdGFsU3VwcGx5LCBob3VzZVBlcmNlbnRPZlRvdGFsKSwKICAgICAgICBjcm93ZGZ1bmRQZXJjZW50T2ZUb3RhbCk7CiAgICAgICAgYmFsYW5jZXNbZGVjZW50QmV0TXVsdGlzaWddID0gc2FmZUFkZChiYWxhbmNlc1tkZWNlbnRCZXRNdWx0aXNpZ10sIGhvdXNlVG9rZW5zKTsKICAgICAgICBUcmFuc2ZlcigwLCBkZWNlbnRCZXRNdWx0aXNpZywgaG91c2VUb2tlbnMpOwoKICAgICAgICAvLyBCb3VudGllczogMiUgb2YgdG90YWwgZ29lcyB0byBEZWNlbnQgYmV0IGZvciBib3VudGllcwogICAgICAgIHVpbnQyNTYgYm91bnR5VG9rZW5zID0gc2FmZURpdihzYWZlTXVsKG9sZFRva2VuVG90YWxTdXBwbHksIGJvdW50eVBlcmNlbnRPZlRvdGFsKSwKICAgICAgICBjcm93ZGZ1bmRQZXJjZW50T2ZUb3RhbCk7CiAgICAgICAgYmFsYW5jZXNbZGVjZW50QmV0TXVsdGlzaWddID0gc2FmZUFkZChiYWxhbmNlc1tkZWNlbnRCZXRNdWx0aXNpZ10sIGJvdW50eVRva2Vucyk7CiAgICAgICAgVHJhbnNmZXIoMCwgZGVjZW50QmV0TXVsdGlzaWcsIGJvdW50eVRva2Vucyk7CgogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZChzYWZlQWRkKHZhdWx0VG9rZW5zLCBob3VzZVRva2VucyksIGJvdW50eVRva2Vucyk7CiAgICB9CgogICAgLy8gVXBncmFkZS1yZWxhdGVkIG1ldGhvZHMKICAgIGZ1bmN0aW9uIGNyZWF0ZVRva2VuKGFkZHJlc3MgX3RhcmdldCwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGFkZHJlc3ModXBncmFkZUFnZW50KSkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgcmV2ZXJ0KCk7CgogICAgICAgIGJhbGFuY2VzW190YXJnZXRdID0gc2FmZUFkZChiYWxhbmNlc1tfdGFyZ2V0XSwgX2Ftb3VudCk7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcihfdGFyZ2V0LCBfdGFyZ2V0LCBfYW1vdW50KTsKICAgIH0KCiAgICAvLyBFUkMyMCBpbnRlcmZhY2U6IHRyYW5zZmVyIF92YWx1ZSBuZXcgdG9rZW5zIGZyb20gbXNnLnNlbmRlciB0byBfdG8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKF90byA9PSAweDApIHJldmVydCgpOwogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcyh1cGdyYWRlQWdlbnQpKSByZXZlcnQoKTsKICAgICAgICBpZiAoX3RvID09IGFkZHJlc3ModGhpcykpIHJldmVydCgpOwogICAgICAgIC8vaWYgKF90byA9PSBhZGRyZXNzKFVwZ3JhZGVBZ2VudCh1cGdyYWRlQWdlbnQpLm9sZFRva2VuKCkpKSByZXZlcnQoKTsKICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBlbHNlIHtyZXR1cm4gZmFsc2U7fQogICAgfQoKICAgIC8vIEVSQzIwIGludGVyZmFjZTogdHJhbnNmZXIgX3ZhbHVlIG5ldyB0b2tlbnMgZnJvbSBfZnJvbSB0byBfdG8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChfdG8gPT0gMHgwKSByZXZlcnQoKTsKICAgICAgICBpZiAoX3RvID09IGFkZHJlc3ModXBncmFkZUFnZW50KSkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKF90byA9PSBhZGRyZXNzKHRoaXMpKSByZXZlcnQoKTsKICAgICAgICAvL2lmIChfdG8gPT0gYWRkcmVzcyhVcGdyYWRlQWdlbnQodXBncmFkZUFnZW50KS5vbGRUb2tlbigpKSkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBlbHNlIHtyZXR1cm4gZmFsc2U7fQogICAgfQoKICAgIC8vIEVSQzIwIGludGVyZmFjZTogZGVsZWdhdGUgdHJhbnNmZXIgcmlnaHRzIG9mIHVwIHRvIF92YWx1ZSBuZXcgdG9rZW5zIGZyb20KICAgIC8vIG1zZy5zZW5kZXIgdG8gX3NwZW5kZXIKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEVSQzIwIGludGVyZmFjZTogcmV0dXJucyB0aGUgYW1vdW50IG9mIG5ldyB0b2tlbnMgYmVsb25naW5nIHRvIF9vd25lcgogICAgLy8gdGhhdCBfc3BlbmRlciBjYW4gc3BlbmQgdmlhIHRyYW5zZmVyRnJvbQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vIEVSQzIwIGludGVyZmFjZTogcmV0dXJucyB0aGUgd21vdW50IG9mIG5ldyB0b2tlbnMgYmVsb25naW5nIHRvIF9vd25lcgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICAvLyBUb2tlbiB1cGdyYWRlIGZ1bmN0aW9uYWxpdHkKCiAgICAvLy8gQG5vdGljZSBVcGdyYWRlIHRva2VucyB0byB0aGUgbmV3IHRva2VuIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSB2YWx1ZSBUaGUgbnVtYmVyIG9mIHRva2VucyB0byB1cGdyYWRlCiAgICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQyNTYgdmFsdWUpIGV4dGVybmFsIHsKICAgICAgICBpZiAobmV4dFVwZ3JhZGVBZ2VudC5vd25lcigpID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgLy8gbmVlZCBhIHJlYWwgdXBncmFkZUFnZW50IGFkZHJlc3MKICAgICAgICBpZiAoZmluYWxpemVkTmV4dFVwZ3JhZGUpIHJldmVydCgpOwogICAgICAgIC8vIGNhbm5vdCB1cGdyYWRlIGlmIGZpbmFsaXplZAoKICAgICAgICAvLyBWYWxpZGF0ZSBpbnB1dCB2YWx1ZS4KICAgICAgICBpZiAodmFsdWUgPT0gMCkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKHZhbHVlID4gYmFsYW5jZXNbbXNnLnNlbmRlcl0pIHJldmVydCgpOwoKICAgICAgICAvLyB1cGRhdGUgdGhlIGJhbGFuY2VzIGhlcmUgZmlyc3QgYmVmb3JlIGNhbGxpbmcgb3V0IChyZWVudHJhbmN5KQogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgdmFsdWUpOwogICAgICAgIHRvdGFsVXBncmFkZWQgPSBzYWZlQWRkKHRvdGFsVXBncmFkZWQsIHZhbHVlKTsKICAgICAgICBuZXh0VXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIG5leHRVcGdyYWRlQWdlbnQsIHZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgYWRkcmVzcyBvZiBuZXh0IHVwZ3JhZGUgdGFyZ2V0IGNvbnRyYWN0IGFuZCBlbmFibGUgdXBncmFkZQogICAgLy8vIHByb2Nlc3MuCiAgICAvLy8gQHBhcmFtIGFnZW50IFRoZSBhZGRyZXNzIG9mIHRoZSBVcGdyYWRlQWdlbnQgY29udHJhY3QKICAgIGZ1bmN0aW9uIHNldE5leHRVcGdyYWRlQWdlbnQoYWRkcmVzcyBhZ2VudCkgZXh0ZXJuYWwgewogICAgICAgIGlmIChhZ2VudCA9PSAweDApIHJldmVydCgpOwogICAgICAgIC8vIGRvbid0IHNldCBhZ2VudCB0byBub3RoaW5nCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gbmV4dFVwZ3JhZGVNYXN0ZXIpIHJldmVydCgpOwogICAgICAgIC8vIE9ubHkgYSBtYXN0ZXIgY2FuIGRlc2lnbmF0ZSB0aGUgbmV4dCBhZ2VudAogICAgICAgIG5leHRVcGdyYWRlQWdlbnQgPSBOZXh0VXBncmFkZUFnZW50KGFnZW50KTsKICAgICAgICBpZiAoIW5leHRVcGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSkgcmV2ZXJ0KCk7CiAgICAgICAgbmV4dFVwZ3JhZGVBZ2VudC5zZXRPcmlnaW5hbFN1cHBseSgpOwogICAgICAgIFVwZ3JhZGVBZ2VudFNldChuZXh0VXBncmFkZUFnZW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgYWRkcmVzcyBvZiBuZXh0IHVwZ3JhZGUgbWFzdGVyIGFuZCBlbmFibGUgdXBncmFkZQogICAgLy8vIHByb2Nlc3MuCiAgICAvLy8gQHBhcmFtIG1hc3RlciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbWFuYWdlIHVwZ3JhZGVzLCBub3QgdGhlIHVwZ3JhZGVBZ2VudCBjb250cmFjdCBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXROZXh0VXBncmFkZU1hc3RlcihhZGRyZXNzIG1hc3RlcikgZXh0ZXJuYWwgewogICAgICAgIGlmIChtYXN0ZXIgPT0gMHgwKSByZXZlcnQoKTsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBuZXh0VXBncmFkZU1hc3RlcikgcmV2ZXJ0KCk7CiAgICAgICAgLy8gT25seSBhIG1hc3RlciBjYW4gZGVzaWduYXRlIHRoZSBuZXh0IG1hc3RlcgogICAgICAgIG5leHRVcGdyYWRlTWFzdGVyID0gbWFzdGVyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGZpbmFsaXplIHRoZSB1cGdyYWRlCiAgICAvLy8gQGRldiBSZXF1aXJlZCBzdGF0ZTogU3VjY2VzcwogICAgZnVuY3Rpb24gZmluYWxpemVOZXh0VXBncmFkZSgpIGV4dGVybmFsIHsKICAgICAgICBpZiAobmV4dFVwZ3JhZGVBZ2VudC5vd25lcigpID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgLy8gd2UgbmVlZCBhIHZhbGlkIHVwZ3JhZGUgYWdlbnQKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBuZXh0VXBncmFkZU1hc3RlcikgcmV2ZXJ0KCk7CiAgICAgICAgLy8gb25seSB1cGdyYWRlTWFzdGVyIGNhbiBmaW5hbGl6ZQogICAgICAgIGlmIChmaW5hbGl6ZWROZXh0VXBncmFkZSkgcmV2ZXJ0KCk7CiAgICAgICAgLy8gY2FuJ3QgZmluYWxpemUgdHdpY2UKCiAgICAgICAgZmluYWxpemVkTmV4dFVwZ3JhZGUgPSB0cnVlOwogICAgICAgIC8vIHByZXZlbnQgZnV0dXJlIHVwZ3JhZGVzCgogICAgICAgIG5leHRVcGdyYWRlQWdlbnQuZmluYWxpemVVcGdyYWRlKCk7CiAgICAgICAgLy8gY2FsbCBmaW5hbGl6ZSB1cGdyYWRlIG9uIG5ldyBjb250cmFjdAogICAgICAgIFVwZ3JhZGVGaW5hbGl6ZWQobXNnLnNlbmRlciwgbmV4dFVwZ3JhZGVBZ2VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24gdGhyb3dzIHRvIGF2b2lkIGFjY2lkZW50YWxseSBsb3NpbmcgbW9uZXkKICAgIGZ1bmN0aW9uKCkge3JldmVydCgpO30KfQoKCi8vVGVzdCB0aGUgd2hvbGUgcHJvY2VzcyBhZ2FpbnN0IHRoaXM6IGh0dHBzOi8vd3d3LmtpbmdvZnRoZWV0aGVyLmNvbS9jb250cmFjdC1zYWZldHktY2hlY2tsaXN0Lmh0bWwKY29udHJhY3QgTmV3VXBncmFkZUFnZW50IGlzIFNhZmVNYXRoIHsKCiAgICAvLyBmbGFnIHRvIGRldGVybWluZSBpZiBhZGRyZXNzIGlzIGZvciBhIHJlYWwgY29udHJhY3Qgb3Igbm90CiAgICBib29sIHB1YmxpYyBpc1VwZ3JhZGVBZ2VudCA9IGZhbHNlOwoKICAgIC8vIENvbnRyYWN0IGluZm9ybWF0aW9uCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICAvLyBVcGdyYWRlIGluZm9ybWF0aW9uCiAgICBib29sIHB1YmxpYyB1cGdyYWRlSGFzQmVndW4gPSBmYWxzZTsKCiAgICBib29sIHB1YmxpYyBmaW5hbGl6ZWRVcGdyYWRlID0gZmFsc2U7CgogICAgT2xkVG9rZW4gcHVibGljIG9sZFRva2VuOwoKICAgIGFkZHJlc3MgcHVibGljIGRlY2VudEJldE11bHRpc2lnOwoKICAgIE5ld0RlY2VudEJldFRva2VuIHB1YmxpYyBuZXdUb2tlbjsKCiAgICB1aW50MjU2IHB1YmxpYyBvcmlnaW5hbFN1cHBseTsgLy8gdGhlIG9yaWdpbmFsIHRvdGFsIHN1cHBseSBvZiBvbGQgdG9rZW5zCgogICAgdWludDI1NiBwdWJsaWMgY29ycmVjdE9yaWdpbmFsU3VwcGx5OyAvLyBDb3JyZWN0IG9yaWdpbmFsIHN1cHBseSBhY2NvdW50aW5nIGZvciAzMCUgbWludGVkIGF0IGZpbmFsaXplQ3Jvd2RmdW5kaW5nCgogICAgdWludDI1NiBwdWJsaWMgbWludGVkUGVyY2VudE9mVG9rZW5zID0gMzA7IC8vIEFtb3VudCBvZiB0b2tlbnMgdGhhdCdyZSBtaW50ZWQgYXQgZmluYWxpemVDcm93ZGZ1bmRpbmcKCiAgICB1aW50MjU2IHB1YmxpYyBjcm93ZGZ1bmRQZXJjZW50T2ZUb2tlbnMgPSA3MDsKCiAgICB1aW50MjU2IHB1YmxpYyBtaW50ZWRUb2tlbnM7CgogICAgZXZlbnQgTmV3VG9rZW5TZXQoYWRkcmVzcyB0b2tlbik7CgogICAgZXZlbnQgVXBncmFkZUhhc0JlZ3VuKCk7CgogICAgZXZlbnQgSW52YXJpYW50Q2hlY2tGYWlsZWQodWludCBvbGRUb2tlblN1cHBseSwgdWludCBuZXdUb2tlblN1cHBseSwgdWludCBvcmlnaW5hbFN1cHBseSwgdWludCB2YWx1ZSk7CgogICAgZXZlbnQgSW52YXJpYW50Q2hlY2tQYXNzZWQodWludCBvbGRUb2tlblN1cHBseSwgdWludCBuZXdUb2tlblN1cHBseSwgdWludCBvcmlnaW5hbFN1cHBseSwgdWludCB2YWx1ZSk7CgogICAgZnVuY3Rpb24gTmV3VXBncmFkZUFnZW50KGFkZHJlc3MgX29sZFRva2VuKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGlzVXBncmFkZUFnZW50ID0gdHJ1ZTsKICAgICAgICBvbGRUb2tlbiA9IE9sZFRva2VuKF9vbGRUb2tlbik7CiAgICAgICAgaWYgKCFvbGRUb2tlbi5pc0RlY2VudEJldFRva2VuKCkpIHJldmVydCgpOwogICAgICAgIGRlY2VudEJldE11bHRpc2lnID0gb2xkVG9rZW4uZGVjZW50QmV0TXVsdGlzaWcoKTsKICAgICAgICBvcmlnaW5hbFN1cHBseSA9IG9sZFRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgbWludGVkVG9rZW5zID0gc2FmZURpdihzYWZlTXVsKG9yaWdpbmFsU3VwcGx5LCBtaW50ZWRQZXJjZW50T2ZUb2tlbnMpLCBjcm93ZGZ1bmRQZXJjZW50T2ZUb2tlbnMpOwogICAgICAgIGNvcnJlY3RPcmlnaW5hbFN1cHBseSA9IHNhZmVBZGQob3JpZ2luYWxTdXBwbHksIG1pbnRlZFRva2Vucyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIGN1cnJlbnQgc3VtIG9mIG9sZCBhbmQKICAgIC8vLyBuZXcgdmVyc2lvbiB0b2tlbnMgaXMgc3RpbGwgZXF1YWwgdG8gdGhlIG9yaWdpbmFsIG51bWJlciBvZiBvbGQgdmVyc2lvbgogICAgLy8vIHRva2VucwogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG51bWJlciBvZiBEQkVUcyB0byB1cGdyYWRlCiAgICBmdW5jdGlvbiBzYWZldHlJbnZhcmlhbnRDaGVjayh1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKICAgICAgICBpZiAoIW5ld1Rva2VuLmlzTmV3VG9rZW4oKSkgcmV2ZXJ0KCk7CiAgICAgICAgLy8gQWJvcnQgaWYgbmV3IHRva2VuIGNvbnRyYWN0IGhhcyBub3QgYmVlbiBzZXQKICAgICAgICB1aW50IG9sZFN1cHBseSA9IG9sZFRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgdWludCBuZXdTdXBwbHkgPSBuZXdUb2tlbi50b3RhbFN1cHBseSgpOwogICAgICAgIGlmIChzYWZlQWRkKG9sZFN1cHBseSwgbmV3U3VwcGx5KSAhPSBzYWZlU3ViKGNvcnJlY3RPcmlnaW5hbFN1cHBseSwgX3ZhbHVlKSkgewogICAgICAgICAgICBJbnZhcmlhbnRDaGVja0ZhaWxlZChvbGRTdXBwbHksIG5ld1N1cHBseSwgY29ycmVjdE9yaWdpbmFsU3VwcGx5LCBfdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEludmFyaWFudENoZWNrUGFzc2VkKG9sZFN1cHBseSwgbmV3U3VwcGx5LCBjb3JyZWN0T3JpZ2luYWxTdXBwbHksIF92YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldHMgdGhlIG5ldyB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9uZXdUb2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IHRva2VuIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXROZXdUb2tlbihhZGRyZXNzIF9uZXdUb2tlbikgZXh0ZXJuYWwgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSByZXZlcnQoKTsKICAgICAgICBpZiAoX25ld1Rva2VuID09IDB4MCkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKHVwZ3JhZGVIYXNCZWd1bikgcmV2ZXJ0KCk7CiAgICAgICAgLy8gQ2Fubm90IGNoYW5nZSB0b2tlbiBhZnRlciB1cGdyYWRlIGhhcyBiZWd1bgoKICAgICAgICBuZXdUb2tlbiA9IE5ld0RlY2VudEJldFRva2VuKF9uZXdUb2tlbik7CiAgICAgICAgaWYgKCFuZXdUb2tlbi5pc05ld1Rva2VuKCkpIHJldmVydCgpOwogICAgICAgIE5ld1Rva2VuU2V0KG5ld1Rva2VuKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXRzIGZsYWcgdG8gcHJldmVudCBjaGFuZ2luZyBuZXdUb2tlbiBhZnRlciB1cGdyYWRlCiAgICBmdW5jdGlvbiBzZXRVcGdyYWRlSGFzQmVndW4oKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKCF1cGdyYWRlSGFzQmVndW4pIHsKICAgICAgICAgICAgdXBncmFkZUhhc0JlZ3VuID0gdHJ1ZTsKICAgICAgICAgICAgVXBncmFkZUhhc0JlZ3VuKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgbmV3IHZlcnNpb24gdG9rZW5zIGZyb20gdGhlIG5ldyB0b2tlbgogICAgLy8vIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiB1cGdyYWRlcgogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG51bWJlciBvZiB0b2tlbnMgdG8gdXBncmFkZQogICAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgaWYoZmluYWxpemVkVXBncmFkZSkgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyhvbGRUb2tlbikpIHJldmVydCgpOwogICAgICAgIC8vIE11bHRpc2lnIGNhbid0IHVwZ3JhZGUgc2luY2UgdG9rZW5zIGFyZSBtaW50ZWQgZm9yIGl0IGluIG5ldyB0b2tlbiBjb25zdHJ1Y3RvciBhcyBpdCBpc24ndCBwYXJ0CiAgICAgICAgLy8gb2YgdG90YWxTdXBwbHkgb2Ygb2xkVG9rZW4uCiAgICAgICAgaWYgKF9mcm9tID09IGRlY2VudEJldE11bHRpc2lnKSByZXZlcnQoKTsKICAgICAgICAvLyBvbmx5IHVwZ3JhZGUgZnJvbSBvbGRUb2tlbgogICAgICAgIGlmICghbmV3VG9rZW4uaXNOZXdUb2tlbigpKSByZXZlcnQoKTsKICAgICAgICAvLyBuZWVkIGEgcmVhbCBuZXdUb2tlbiEKCiAgICAgICAgc2V0VXBncmFkZUhhc0JlZ3VuKCk7CiAgICAgICAgLy8gUmlnaHQgaGVyZSBvbGRUb2tlbiBoYXMgYWxyZWFkeSBiZWVuIHVwZGF0ZWQsIGJ1dCBjb3JyZXNwb25kaW5nCiAgICAgICAgLy8gREJFVHMgaGF2ZSBub3QgYmVlbiBjcmVhdGVkIGluIHRoZSBuZXdUb2tlbiBjb250cmFjdCB5ZXQKICAgICAgICBzYWZldHlJbnZhcmlhbnRDaGVjayhfdmFsdWUpOwoKICAgICAgICBuZXdUb2tlbi5jcmVhdGVUb2tlbihfZnJvbSwgX3ZhbHVlKTsKCiAgICAgICAgLy9SaWdodCBoZXJlIHRvdGFsU3VwcGx5IGludmFyaWFudCBtdXN0IGhvbGQKICAgICAgICBzYWZldHlJbnZhcmlhbnRDaGVjaygwKTsKICAgIH0KCiAgICAvLyBJbml0aWFsaXplcyBvcmlnaW5hbCBzdXBwbHkgZnJvbSBvbGQgdG9rZW4gdG90YWwgc3VwcGx5CiAgICBmdW5jdGlvbiBzZXRPcmlnaW5hbFN1cHBseSgpIHB1YmxpYyB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyhvbGRUb2tlbikpIHJldmVydCgpOwogICAgICAgIG9yaWdpbmFsU3VwcGx5ID0gb2xkVG9rZW4udG90YWxTdXBwbHkoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5hbGl6ZVVwZ3JhZGUoKSBwdWJsaWMgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGFkZHJlc3Mob2xkVG9rZW4pKSByZXZlcnQoKTsKICAgICAgICBmaW5hbGl6ZWRVcGdyYWRlID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBGYWxsYmFjayBmdW5jdGlvbiBkaXNhbGxvd3MgZGVwb3NpdGluZyBldGhlci4KICAgIGZ1bmN0aW9uKCkge3JldmVydCgpO30KCn0='.
	

]
