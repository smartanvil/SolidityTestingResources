Class {
	#name : #SRT723AAF922709819c25344B81901dd8A9c84c0b89,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT723AAF922709819c25344B81901dd8A9c84c0b89 >> base64 [
	^ 'Y29udHJhY3QgRVNwb3J0c0NvbnN0YW50cyB7CiAgICB1aW50IGNvbnN0YW50IFRPS0VOX0RFQ0lNQUxTID0gMTg7CiAgICB1aW50OCBjb25zdGFudCBUT0tFTl9ERUNJTUFMU19VSU5UOCA9IHVpbnQ4KFRPS0VOX0RFQ0lNQUxTKTsKICAgIHVpbnQgY29uc3RhbnQgVE9LRU5fREVDSU1BTF9NVUxUSVBMSUVSID0gMTAgKiogVE9LRU5fREVDSU1BTFM7CgogICAgdWludCBjb25zdGFudCBSQVRFID0gMjQwOyAvLyA9IDEgRVRICn0KCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgICAqIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEVTcG9ydHNGcmVlemluZ1N0b3JhZ2UgaXMgT3duYWJsZSB7CiAgICAvLyBUaW1lc3RhbXAgd2hlbiB0b2tlbiByZWxlYXNlIGlzIGVuYWJsZWQKICAgIHVpbnQ2NCBwdWJsaWMgcmVsZWFzZVRpbWU7CgogICAgLy8gRVJDMjAgYmFzaWMgdG9rZW4gY29udHJhY3QgYmVpbmcgaGVsZAogICAgLy8gRVJDMjBCYXNpYyB0b2tlbjsKICAgIEVTcG9ydHNUb2tlbiB0b2tlbjsKICAgIAogICAgZnVuY3Rpb24gRVNwb3J0c0ZyZWV6aW5nU3RvcmFnZShFU3BvcnRzVG9rZW4gX3Rva2VuLCB1aW50NjQgX3JlbGVhc2VUaW1lKSB7IC8vRVJDMjBCYXNpYwogICAgICAgIHJlcXVpcmUoX3JlbGVhc2VUaW1lID4gbm93KTsKICAgICAgICAKICAgICAgICByZWxlYXNlVGltZSA9IF9yZWxlYXNlVGltZTsKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgIH0KCiAgICBmdW5jdGlvbiByZWxlYXNlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBvbmx5T3duZXIgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy9yZXF1aXJlKG5vdyA+PSByZWxlYXNlVGltZSk7CiAgICAgICAgaWYgKG5vdyA8IHJlbGVhc2VUaW1lKSByZXR1cm4gMDsKCiAgICAgICAgdWludCBhbW91bnQgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgLy9yZXF1aXJlKGFtb3VudCA+IDApOwogICAgICAgIGlmIChhbW91bnQgPT0gMCkgIHJldHVybiAwOwoKICAgICAgICAvLyB0b2tlbi5zYWZlVHJhbnNmZXIoYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgICAgICAgLy9yZXF1aXJlKHRva2VuLnRyYW5zZmVyKF9iZW5lZmljaWFyeSwgYW1vdW50KSk7CiAgICAgICAgYm9vbCByZXN1bHQgPSB0b2tlbi50cmFuc2ZlcihfYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgICAgICAgaWYgKCFyZXN1bHQpIHJldHVybiAwOwogICAgICAgIAogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgUmVmdW5kVmF1bHQKICogQGRldiBUaGlzIGNvbnRyYWN0IGlzIHVzZWQgZm9yIHN0b3JpbmcgZnVuZHMgd2hpbGUgYSBjcm93ZHNhbGUKICogaXMgaW4gcHJvZ3Jlc3MuIFN1cHBvcnRzIHJlZnVuZGluZyB0aGUgbW9uZXkgaWYgY3Jvd2RzYWxlIGZhaWxzLAogKiBhbmQgZm9yd2FyZGluZyBpdCBpZiBjcm93ZHNhbGUgaXMgc3VjY2Vzc2Z1bC4KICovCmNvbnRyYWN0IFJlZnVuZFZhdWx0IGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgZW51bSBTdGF0ZSB7QWN0aXZlLCBSZWZ1bmRpbmcsIENsb3NlZH0KCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CgogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAgIFN0YXRlIHB1YmxpYyBzdGF0ZTsKCiAgICBldmVudCBDbG9zZWQoKTsKCiAgICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwoKICAgIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwoKICAgIGZ1bmN0aW9uIFJlZnVuZFZhdWx0KGFkZHJlc3MgX3dhbGxldCkgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwogICAgICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVwb3NpdChhZGRyZXNzIGludmVzdG9yKSBvbmx5T3duZXIgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRbaW52ZXN0b3JdLmFkZChtc2cudmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNsb3NlKCkgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7CiAgICAgICAgQ2xvc2VkKCk7CiAgICAgICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kcygpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpUmFpc2VkKSBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUmVmdW5kaW5nKTsKCiAgICAgICAgdWludDI1NiBkZXBvc2l0ZWRWYWx1ZSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl07CiAgICAgICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IDA7CiAgICAgICAgaW52ZXN0b3IudHJhbnNmZXIoZGVwb3NpdGVkVmFsdWUpOwogICAgICAgIAogICAgICAgIFJlZnVuZGVkKGludmVzdG9yLCBkZXBvc2l0ZWRWYWx1ZSk7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgQ3Jvd2RzYWxlIAogKiBAZGV2IENyb3dkc2FsZSBpcyBhIGJhc2UgY29udHJhY3QgZm9yIG1hbmFnaW5nIGEgdG9rZW4gY3Jvd2RzYWxlLgogKgogKiBDcm93ZHNhbGVzIGhhdmUgYSBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMsIHdoZXJlIGludmVzdG9ycyBjYW4gbWFrZQogKiB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKICogb24gYSB0b2tlbiBwZXIgRVRIIHJhdGUuIEZ1bmRzIGNvbGxlY3RlZCBhcmUgZm9yd2FyZGVkIHRvIGEgd2FsbGV0IAogKiBhcyB0aGV5IGFycml2ZS4KICovCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogICAgTWludGFibGVUb2tlbiBwdWJsaWMgdG9rZW47CgogICAgLy8gc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzIHdoZXJlIGludmVzdG1lbnRzIGFyZSBhbGxvd2VkIChib3RoIGluY2x1c2l2ZSkKICAgIHVpbnQzMiBwdWJsaWMgc3RhcnRUaW1lOwogICAgdWludDMyIHB1YmxpYyBlbmRUaW1lOwoKICAgIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAgIC8vIGhvdyBtYW55IHRva2VuIHVuaXRzIGEgYnV5ZXIgZ2V0cyBwZXIgd2VpCiAgICB1aW50IHB1YmxpYyByYXRlOwoKICAgIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQ7CgogICAgLyoqCiAgICAgKiBAZGV2IEFtb3VudCBvZiBhbHJlYWR5IHNvbGQgdG9rZW5zLgogICAgICovCiAgICB1aW50IHB1YmxpYyBzb2xkVG9rZW5zOwoKICAgIC8qKgogICAgICogQGRldiBNYXhpbXVtIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgICAqLwogICAgdWludCBwdWJsaWMgaGFyZENhcDsKCiAgICAvKioKICAgICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIGdvdCB0aGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAgICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAgICovCiAgICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludCB2YWx1ZSwgdWludCBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIENyb3dkc2FsZSh1aW50MzIgX3N0YXJ0VGltZSwgdWludDMyIF9lbmRUaW1lLCB1aW50IF9yYXRlLCB1aW50IF9oYXJkQ2FwLCBhZGRyZXNzIF93YWxsZXQsIGFkZHJlc3MgX3Rva2VuKSB7CiAgICAgICAgcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICAgICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKF9yYXRlID4gMCk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfaGFyZENhcCA+IF9yYXRlKTsKCiAgICAgICAgLy8gdG9rZW4gPSBjcmVhdGVUb2tlbkNvbnRyYWN0KCk7CiAgICAgICAgdG9rZW4gPSBNaW50YWJsZVRva2VuKF90b2tlbik7CgogICAgICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICAgICAgZW5kVGltZSA9IF9lbmRUaW1lOwogICAgICAgIHJhdGUgPSBfcmF0ZTsKICAgICAgICBoYXJkQ2FwID0gX2hhcmRDYXA7CiAgICAgICAgd2FsbGV0ID0gX3dhbGxldDsKICAgIH0KCiAgICAvLyBjcmVhdGVzIHRoZSB0b2tlbiB0byBiZSBzb2xkLgogICAgLy8gb3ZlcnJpZGUgdGhpcyBtZXRob2QgdG8gaGF2ZSBjcm93ZHNhbGUgb2YgYSBzcGVjaWZpYyBtaW50YWJsZSB0b2tlbi4KICAgIC8vIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zIChNaW50YWJsZVRva2VuKSB7CiAgICAvLyAgICAgcmV0dXJuIG5ldyBNaW50YWJsZVRva2VuKCk7CiAgICAvLyB9CgogICAgLyoqCiAgICAgKiBAZGV2IHRoaXMgbWV0aG9kIG1pZ2h0IGJlIG92ZXJyaWRkZW4gZm9yIGltcGxlbWVudGluZyBhbnkgc2FsZSBsb2dpYy4KICAgICAqIEByZXR1cm4gQWN0dWFsIHJhdGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFJhdGUoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJhdGU7CiAgICB9CgogICAgLy8gRmFsbGJhY2sgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gYnV5IHRva2VucwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICBidXlUb2tlbnMobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLyBMb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5LCB1aW50IGFtb3VudFdlaSkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gMHgwKTsKCiAgICAgICAgLy8gVG90YWwgbWludGVkIHRva2VucwogICAgICAgIHVpbnQgdG90YWxTdXBwbHkgPSB0b2tlbi50b3RhbFN1cHBseSgpOwoKICAgICAgICAvLyBBY3R1YWwgdG9rZW4gbWludGluZyByYXRlICh3aXRoIGNvbnNpZGVyaW5nIGJvbnVzZXMgYW5kIGRpc2NvdW50cykKICAgICAgICB1aW50IGFjdHVhbFJhdGUgPSBnZXRSYXRlKCk7CgogICAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZShhbW91bnRXZWksIGFjdHVhbFJhdGUsIHRvdGFsU3VwcGx5KSk7CgogICAgICAgIC8vIENhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgICAgIC8vIHVpbnQgdG9rZW5zID0gcmF0ZS5tdWwobXNnLnZhbHVlKS5kaXYoMSBldGhlcik7CiAgICAgICAgdWludCB0b2tlbnMgPSBhbW91bnRXZWkubXVsKGFjdHVhbFJhdGUpOwoKICAgICAgICBpZiAobXNnLnZhbHVlID09IDApIHsgLy8gaWYgaXQgaXMgYSBidGMgcHVyY2hhc2UgdGhlbiBjaGVjayBleGlzdGVuY2UgYWxsIHRva2VucyAobm8gY2hhbmdlKQogICAgICAgICAgICByZXF1aXJlKHRva2Vucy5hZGQodG90YWxTdXBwbHkpIDw9IGhhcmRDYXApOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2hhbmdlLCBpZiBtaW50ZWQgdG9rZW4gd291bGQgYmUgbGVzcwogICAgICAgIHVpbnQgY2hhbmdlID0gMDsKCiAgICAgICAgLy8gSWYgaGFyZCBjYXAgcmVhY2hlZAogICAgICAgIGlmICh0b2tlbnMuYWRkKHRvdGFsU3VwcGx5KSA+IGhhcmRDYXApIHsKICAgICAgICAgICAgLy8gUmVzdCB0b2tlbnMKICAgICAgICAgICAgdWludCBtYXhUb2tlbnMgPSBoYXJkQ2FwLnN1Yih0b3RhbFN1cHBseSk7CiAgICAgICAgICAgIHVpbnQgcmVhbEFtb3VudCA9IG1heFRva2Vucy5kaXYoYWN0dWFsUmF0ZSk7CgogICAgICAgICAgICAvLyBSZXN0IHRva2VucyByb3VuZGVkIGJ5IGFjdHVhbFJhdGUKICAgICAgICAgICAgdG9rZW5zID0gcmVhbEFtb3VudC5tdWwoYWN0dWFsUmF0ZSk7CiAgICAgICAgICAgIGNoYW5nZSA9IGFtb3VudFdlaS5zdWIocmVhbEFtb3VudCk7CiAgICAgICAgICAgIGFtb3VudFdlaSA9IHJlYWxBbW91bnQ7CiAgICAgICAgfQoKICAgICAgICAvLyBCb251c2VzCiAgICAgICAgcG9zdEJ1eVRva2VucyhiZW5lZmljaWFyeSwgdG9rZW5zKTsKCiAgICAgICAgLy8gVXBkYXRlIHN0YXRlCiAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZChhbW91bnRXZWkpOwogICAgICAgIHNvbGRUb2tlbnMgPSBzb2xkVG9rZW5zLmFkZCh0b2tlbnMpOwoKICAgICAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYmVuZWZpY2lhcnksIGFtb3VudFdlaSwgdG9rZW5zKTsKCiAgICAgICAgaWYgKG1zZy52YWx1ZSAhPSAwKSB7CiAgICAgICAgICAgIGlmIChjaGFuZ2UgIT0gMCkgewogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihjaGFuZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvcndhcmRGdW5kcyhhbW91bnRXZWkpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBTZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgICAvLyBPdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCiAgICBmdW5jdGlvbiBmb3J3YXJkRnVuZHModWludCBhbW91bnRXZWkpIGludGVybmFsIHsKICAgICAgICB3YWxsZXQudHJhbnNmZXIoYW1vdW50V2VpKTsKICAgIH0KCiAgICAvLyBUcmFzZmVyIGJvbnVzZXMgYW5kIGFkZGluZyBkZWxheWVkIGJvbnVzZXMKICAgIGZ1bmN0aW9uIHBvc3RCdXlUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX3Rva2VucykgaW50ZXJuYWwgewogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDaGVjayBpZiB0aGUgc3BlY2lmaWVkIHB1cmNoYXNlIGlzIHZhbGlkLgogICAgICogQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKHVpbnQgX2Ftb3VudFdlaSwgdWludCBfYWN0dWFsUmF0ZSwgdWludCBfdG90YWxTdXBwbHkpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICAgICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBfYW1vdW50V2VpICE9IDA7CiAgICAgICAgYm9vbCBoYXJkQ2FwTm90UmVhY2hlZCA9IF90b3RhbFN1cHBseSA8PSBoYXJkQ2FwLnN1YihfYWN0dWFsUmF0ZSk7CgogICAgICAgIHJldHVybiB3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlICYmIGhhcmRDYXBOb3RSZWFjaGVkOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBCZWNhdXNlIG9mIGRpc2NvdW50IGhhc0VuZGVkIG1pZ2h0IGJlIHRydWUsIGJ1dCB2YWxpZFB1cmNoYXNlIHJldHVybnMgZmFsc2UuCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG5vdyA+IGVuZFRpbWUgfHwgdG9rZW4udG90YWxTdXBwbHkoKSA+IGhhcmRDYXAuc3ViKGdldFJhdGUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBzdGFydGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGhhc1N0YXJ0ZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBub3cgPj0gc3RhcnRUaW1lOwogICAgfQp9CgovKioKICogQHRpdGxlIEZpbmFsaXphYmxlQ3Jvd2RzYWxlCiAqIEBkZXYgRXh0ZW5zaW9uIG9mIENyb3dzZGFsZSB3aGVyZSBhbiBvd25lciBjYW4gZG8gZXh0cmEgd29yawogKiBhZnRlciBmaW5pc2hpbmcuIAogKi8KY29udHJhY3QgRmluYWxpemFibGVDcm93ZHNhbGUgaXMgQ3Jvd2RzYWxlLCBPd25hYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CgogICAgZXZlbnQgRmluYWxpemVkKCk7CgogICAgZnVuY3Rpb24gRmluYWxpemFibGVDcm93ZHNhbGUodWludDMyIF9zdGFydFRpbWUsIHVpbnQzMiBfZW5kVGltZSwgdWludCBfcmF0ZSwgdWludCBfaGFyZENhcCwgYWRkcmVzcyBfd2FsbGV0LCBhZGRyZXNzIF90b2tlbikKICAgICAgICAgICAgQ3Jvd2RzYWxlKF9zdGFydFRpbWUsIF9lbmRUaW1lLCBfcmF0ZSwgX2hhcmRDYXAsIF93YWxsZXQsIF90b2tlbikgewogICAgfQoKICAgIC8qKgogICAgICogQGRldiBNdXN0IGJlIGNhbGxlZCBhZnRlciBjcm93ZHNhbGUgZW5kcywgdG8gZG8gc29tZSBleHRyYSBmaW5hbGl6YXRpb24KICAgICAqIHdvcmsuIENhbGxzIHRoZSBjb250cmFjdCdzIGZpbmFsaXphdGlvbiBmdW5jdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemUoKSBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoIWlzRmluYWxpemVkKTsKICAgICAgICByZXF1aXJlKGhhc0VuZGVkKCkpOwoKICAgICAgICBpc0ZpbmFsaXplZCA9IHRydWU7CgogICAgICAgIGZpbmFsaXphdGlvbigpOwogICAgICAgIEZpbmFsaXplZCgpOyAgICAgICAgCiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbiBiZSBvdmVycmlkZW4gdG8gYWRkIGZpbmFsaXphdGlvbiBsb2dpYy4gVGhlIG92ZXJyaWRpbmcgZnVuY3Rpb24KICAgICAqIHNob3VsZCBjYWxsIHN1cGVyLmZpbmFsaXphdGlvbigpIHRvIGVuc3VyZSB0aGUgY2hhaW4gb2YgZmluYWxpemF0aW9uIGlzCiAgICAgKiBleGVjdXRlZCBlbnRpcmVseS4KICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewogICAgfQp9CgovKioKICogQHRpdGxlIFJlZnVuZGFibGVDcm93ZHNhbGUKICogQGRldiBFeHRlbnNpb24gb2YgQ3Jvd2RzYWxlIGNvbnRyYWN0IHRoYXQgYWRkcyBhIGZ1bmRpbmcgZ29hbCwgYW5kCiAqIHRoZSBwb3NzaWJpbGl0eSBvZiB1c2VycyBnZXR0aW5nIGEgcmVmdW5kIGlmIGdvYWwgaXMgbm90IG1ldC4KICogVXNlcyBhIFJlZnVuZFZhdWx0IGFzIHRoZSBjcm93ZHNhbGUncyB2YXVsdC4KICovCmNvbnRyYWN0IFJlZnVuZGFibGVDcm93ZHNhbGUgaXMgRmluYWxpemFibGVDcm93ZHNhbGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy8gbWluaW11bSBhbW91bnQgb2YgZnVuZHMgdG8gYmUgcmFpc2VkIGluIHdlaXMKICAgIHVpbnQgcHVibGljIGdvYWw7CgogICAgLy8gcmVmdW5kIHZhdWx0IHVzZWQgdG8gaG9sZCBmdW5kcyB3aGlsZSBjcm93ZHNhbGUgaXMgcnVubmluZwogICAgUmVmdW5kVmF1bHQgcHVibGljIHZhdWx0OwoKICAgIGZ1bmN0aW9uIFJlZnVuZGFibGVDcm93ZHNhbGUodWludDMyIF9zdGFydFRpbWUsIHVpbnQzMiBfZW5kVGltZSwgdWludCBfcmF0ZSwgdWludCBfaGFyZENhcCwgYWRkcmVzcyBfd2FsbGV0LCBhZGRyZXNzIF90b2tlbiwgdWludCBfZ29hbCkKICAgICAgICAgICAgRmluYWxpemFibGVDcm93ZHNhbGUoX3N0YXJ0VGltZSwgX2VuZFRpbWUsIF9yYXRlLCBfaGFyZENhcCwgX3dhbGxldCwgX3Rva2VuKSB7CiAgICAgICAgcmVxdWlyZShfZ29hbCA+IDApOwogICAgICAgIHZhdWx0ID0gbmV3IFJlZnVuZFZhdWx0KHdhbGxldCk7CiAgICAgICAgZ29hbCA9IF9nb2FsOwogICAgfQoKICAgIC8vIFdlJ3JlIG92ZXJyaWRpbmcgdGhlIGZ1bmQgZm9yd2FyZGluZyBmcm9tIENyb3dkc2FsZS4KICAgIC8vIEluIGFkZGl0aW9uIHRvIHNlbmRpbmcgdGhlIGZ1bmRzLCB3ZSB3YW50IHRvIGNhbGwKICAgIC8vIHRoZSBSZWZ1bmRWYXVsdCBkZXBvc2l0IGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBmb3J3YXJkRnVuZHModWludCBhbW91bnRXZWkpIGludGVybmFsIHsKICAgICAgICBpZiAoZ29hbFJlYWNoZWQoKSkgewogICAgICAgICAgICB3YWxsZXQudHJhbnNmZXIoYW1vdW50V2VpKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhdWx0LmRlcG9zaXQudmFsdWUoYW1vdW50V2VpKShtc2cuc2VuZGVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gaWYgY3Jvd2RzYWxlIGlzIHVuc3VjY2Vzc2Z1bCwgaW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmRzIGhlcmUKICAgIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGlzRmluYWxpemVkKTsKICAgICAgICByZXF1aXJlKCFnb2FsUmVhY2hlZCgpKTsKCiAgICAgICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIsIHdlaVJhaXNlZCk7CiAgICB9CgogICAgLy8gdmF1bHQgZmluYWxpemF0aW9uIHRhc2ssIGNhbGxlZCB3aGVuIG93bmVyIGNhbGxzIGZpbmFsaXplKCkKICAgIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICAgICAgICBzdXBlci5maW5hbGl6YXRpb24oKTsKCiAgICAgICAgaWYgKGdvYWxSZWFjaGVkKCkpIHsKICAgICAgICAgICAgdmF1bHQuY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhdWx0LmVuYWJsZVJlZnVuZHMoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gZ29hbDsKICAgIH0KfQoKY29udHJhY3QgRVNwb3J0c01haW5Dcm93ZHNhbGUgaXMgRVNwb3J0c0NvbnN0YW50cywgUmVmdW5kYWJsZUNyb3dkc2FsZSB7CiAgICB1aW50IGNvbnN0YW50IE9WRVJBTExfQU1PVU5UX1RPS0VOUyA9IDYwMDAwMDAwICogVE9LRU5fREVDSU1BTF9NVUxUSVBMSUVSOyAvLyBvdmVyYWxsIDEwMC4wMCUKICAgIHVpbnQgY29uc3RhbnQgVEVBTV9CRU5fVE9LRU5TID0gNjAwMDAwMCAqIFRPS0VOX0RFQ0lNQUxfTVVMVElQTElFUjsgLy8gMjAuMDAlIC8vIEZvdW5kZXJzCiAgICB1aW50IGNvbnN0YW50IFRFQU1fUEhJTF9UT0tFTlMgPSA2MDAwMDAwICogVE9LRU5fREVDSU1BTF9NVUxUSVBMSUVSOwogICAgdWludCBjb25zdGFudCBDT01QQU5ZX0NPTERfU1RPUkFHRV9UT0tFTlMgPSAxMjAwMDAwMCAqIFRPS0VOX0RFQ0lNQUxfTVVMVElQTElFUjsgLy8gMjAuMDAlCiAgICB1aW50IGNvbnN0YW50IElOVkVTVE9SX1RPS0VOUyA9IDMwMDAwMDAgKiBUT0tFTl9ERUNJTUFMX01VTFRJUExJRVI7IC8vIDUuMDAlCiAgICB1aW50IGNvbnN0YW50IEJPTlVTX1RPS0VOUyA9IDMwMDAwMDAgKiBUT0tFTl9ERUNJTUFMX01VTFRJUExJRVI7IC8vIDUuMDAlIC8vIFByZS1zYWxlCgl1aW50IGNvbnN0YW50IEJVRkZFUl9UT0tFTlMgPSA2MDAwMDAwICogVE9LRU5fREVDSU1BTF9NVUxUSVBMSUVSOyAvLyAxMC4wMCUKICAgIHVpbnQgY29uc3RhbnQgUFJFX1NBTEVfVE9LRU5TID0gMTIwMDAwMDAgKiBUT0tFTl9ERUNJTUFMX01VTFRJUExJRVI7IC8vIDIwLjAwJQoKICAgIC8vIE1haW5uZXQgYWRkcmVzc2VzCiAgICBhZGRyZXNzIGNvbnN0YW50IFRFQU1fQkVOX0FERFJFU1MgPSAweDJFMzUyRWQxNUM0MzIxZjRkZDdFZEZjMTk0MDI2NjZkRTg3MTNjZDg7CiAgICBhZGRyZXNzIGNvbnN0YW50IFRFQU1fUEhJTF9BRERSRVNTID0gMHg0NDY2ZGUzYThmNGYwYTBmNTQ3MGI1MGZkYzlmOTFmYTA0ZTAwZTM0OwogICAgYWRkcmVzcyBjb25zdGFudCBJTlZFU1RPUl9BRERSRVNTID0gMHgxNGY4ZDBjNDEwOTdjYTZmZGRiNmFhNGZkNmEzMzMyYWYzNzQxODQ3OwogICAgYWRkcmVzcyBjb25zdGFudCBCT05VU19BRERSRVNTID0gMHg1YmFlZTRhOTkzOGQ4ZjU5ZWRiZTRkYzEwOTExOTk4M2RiNGI3YmQ2OwogICAgYWRkcmVzcyBjb25zdGFudCBDT01QQU5ZX0NPTERfU1RPUkFHRV9BRERSRVNTID0gMHg3MDBkNmFlNTNiZTk0NjA4NWJiOTFmOTZlYjFjZjllNDIwMjM2NzYyOwogICAgYWRkcmVzcyBjb25zdGFudCBQUkVfU0FMRV9BRERSRVNTID0gMHhjYjI4MDk5MjZlNjE1MjQ1YjNhZjRlYmNlNWFmOWZiZTFhNmE0MzIxOwogICAgCiAgICBhZGRyZXNzIGJ0Y0J1eWVyID0gMHgxZWVlNGM3ZDg4YWFkZWMyYWI4MmRkMTkxNDkxZDFhOWVkZjIxZTlhOwoKICAgIEVTcG9ydHNCb251c1Byb3ZpZGVyIHB1YmxpYyBib251c1Byb3ZpZGVyOwoKICAgIGJvb2wgcHJpdmF0ZSBpc0luaXQgPSBmYWxzZTsKICAgIAoJLyoqCiAgICAgKiBDb25zdHJ1Y3RvciBmdW5jdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBFU3BvcnRzTWFpbkNyb3dkc2FsZSgKICAgICAgICB1aW50MzIgX3N0YXJ0VGltZSwKICAgICAgICB1aW50MzIgX2VuZFRpbWUsCiAgICAgICAgdWludCBfc29mdENhcFdlaSwgLy8gNDAwMDAwMCBFVVIKICAgICAgICBhZGRyZXNzIF93YWxsZXQsCiAgICAgICAgYWRkcmVzcyBfdG9rZW4KCSkgUmVmdW5kYWJsZUNyb3dkc2FsZSgKICAgICAgICBfc3RhcnRUaW1lLAogICAgICAgIF9lbmRUaW1lLCAKICAgICAgICBSQVRFLAogICAgICAgIE9WRVJBTExfQU1PVU5UX1RPS0VOUywKICAgICAgICBfd2FsbGV0LAogICAgICAgIF90b2tlbiwKICAgICAgICBfc29mdENhcFdlaQoJKSB7Cgl9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbGVhc2UgZGVsYXllZCBib251cyB0b2tlbnMKICAgICAqIEByZXR1cm4gQW1vdW50IG9mIGdvdCBib251cyB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gcmVsZWFzZUJvbnVzKCkgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGJvbnVzUHJvdmlkZXIucmVsZWFzZUJvbnVzKG1zZy5zZW5kZXIsIHNvbGRUb2tlbnMpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUcmFzZmVyIGJvbnVzZXMgYW5kIGFkZGluZyBkZWxheWVkIGJvbnVzZXMKICAgICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgRnV0dXJlIGJvbnVzZXMgaG9sZGVyCiAgICAgKiBAcGFyYW0gX3Rva2VucyBBbW91bnQgb2YgYm9udXMgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBvc3RCdXlUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX3Rva2VucykgaW50ZXJuYWwgewogICAgICAgIHVpbnQgYm9udXNlcyA9IGJvbnVzUHJvdmlkZXIuZ2V0Qm9udXNBbW91bnQoX2JlbmVmaWNpYXJ5LCBzb2xkVG9rZW5zLCBfdG9rZW5zLCBzdGFydFRpbWUpOwogICAgICAgIGJvbnVzUHJvdmlkZXIuYWRkRGVsYXllZEJvbnVzKF9iZW5lZmljaWFyeSwgc29sZFRva2VucywgX3Rva2Vucyk7CgogICAgICAgIGlmIChib251c2VzID4gMCkgewogICAgICAgICAgICBib251c1Byb3ZpZGVyLnNlbmRCb251cyhfYmVuZWZpY2lhcnksIGJvbnVzZXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSW5pdGlhbGl6YXRpb24gb2YgY3Jvd2RzYWxlLiBTdGFydHMgb25jZSBhZnRlciBkZXBsb3ltZW50IHRva2VuIGNvbnRyYWN0CiAgICAgKiAsIGRlcGxveW1lbnQgY3Jvd2RzYWxlIGNvbnRyYWN0IGFuZCBjaGFuZ9GDIHRva2VuIGNvbnRyYWN0J3Mgb3duZXIgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGluaXQoKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgIHJlcXVpcmUoIWlzSW5pdCk7CgogICAgICAgIEVTcG9ydHNUb2tlbiBlcnRUb2tlbiA9IEVTcG9ydHNUb2tlbih0b2tlbik7CiAgICAgICAgaXNJbml0ID0gdHJ1ZTsKCiAgICAgICAgRVNwb3J0c0JvbnVzUHJvdmlkZXIgYlByb3ZpZGVyID0gbmV3IEVTcG9ydHNCb251c1Byb3ZpZGVyKGVydFRva2VuLCBDT01QQU5ZX0NPTERfU1RPUkFHRV9BRERSRVNTKTsKICAgICAgICAvLyBiUHJvdmlkZXIudHJhbnNmZXJPd25lcnNoaXAob3duZXIpOwogICAgICAgIGJvbnVzUHJvdmlkZXIgPSBiUHJvdmlkZXI7CgogICAgICAgIG1pbnRUb0ZvdW5kZXJzKGVydFRva2VuKTsKCiAgICAgICAgcmVxdWlyZSh0b2tlbi5taW50KElOVkVTVE9SX0FERFJFU1MsIElOVkVTVE9SX1RPS0VOUykpOwogICAgICAgIHJlcXVpcmUodG9rZW4ubWludChDT01QQU5ZX0NPTERfU1RPUkFHRV9BRERSRVNTLCBDT01QQU5ZX0NPTERfU1RPUkFHRV9UT0tFTlMpKTsKICAgICAgICByZXF1aXJlKHRva2VuLm1pbnQoUFJFX1NBTEVfQUREUkVTUywgUFJFX1NBTEVfVE9LRU5TKSk7CgogICAgICAgIC8vIGJvbnVzZXMKICAgICAgICByZXF1aXJlKHRva2VuLm1pbnQoQk9OVVNfQUREUkVTUywgQk9OVVNfVE9LRU5TKSk7CiAgICAgICAgcmVxdWlyZSh0b2tlbi5taW50KGJvbnVzUHJvdmlkZXIsIEJVRkZFUl9UT0tFTlMpKTsgLy8gbWludCBib251cyB0b2tlbiB0byBib251cyBwcm92aWRlcgogICAgICAgIAogICAgICAgIGVydFRva2VuLmFkZEV4Y2x1ZGVkKElOVkVTVE9SX0FERFJFU1MpOwogICAgICAgIGVydFRva2VuLmFkZEV4Y2x1ZGVkKEJPTlVTX0FERFJFU1MpOwogICAgICAgIGVydFRva2VuLmFkZEV4Y2x1ZGVkKENPTVBBTllfQ09MRF9TVE9SQUdFX0FERFJFU1MpOwogICAgICAgIGVydFRva2VuLmFkZEV4Y2x1ZGVkKFBSRV9TQUxFX0FERFJFU1MpOwoKICAgICAgICBlcnRUb2tlbi5hZGRFeGNsdWRlZChhZGRyZXNzKGJvbnVzUHJvdmlkZXIpKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1pbnQgb2YgdG9rZW5zIGluIHRoZSBuYW1lIG9mIHRoZSBmb3VuZGVycyBhbmQgZnJlZXplIHBhcnQgb2YgdGhlbQogICAgICovCiAgICBmdW5jdGlvbiBtaW50VG9Gb3VuZGVycyhFU3BvcnRzVG9rZW4gZXJ0VG9rZW4pIGludGVybmFsIHsKICAgICAgICBlcnRUb2tlbi5taW50VGltZWxvY2tlZChURUFNX0JFTl9BRERSRVNTLCBURUFNX0JFTl9UT0tFTlMubXVsKDIwKS5kaXYoMTAwKSwgc3RhcnRUaW1lICsgMSB5ZWFycyk7CiAgICAgICAgZXJ0VG9rZW4ubWludFRpbWVsb2NrZWQoVEVBTV9CRU5fQUREUkVTUywgVEVBTV9CRU5fVE9LRU5TLm11bCgzMCkuZGl2KDEwMCksIHN0YXJ0VGltZSArIDMgeWVhcnMpOwogICAgICAgIGVydFRva2VuLm1pbnRUaW1lbG9ja2VkKFRFQU1fQkVOX0FERFJFU1MsIFRFQU1fQkVOX1RPS0VOUy5tdWwoMzApLmRpdigxMDApLCBzdGFydFRpbWUgKyA1IHllYXJzKTsKICAgICAgICByZXF1aXJlKHRva2VuLm1pbnQoVEVBTV9CRU5fQUREUkVTUywgVEVBTV9CRU5fVE9LRU5TLm11bCgyMCkuZGl2KDEwMCkpKTsKCiAgICAgICAgZXJ0VG9rZW4ubWludFRpbWVsb2NrZWQoVEVBTV9QSElMX0FERFJFU1MsIFRFQU1fUEhJTF9UT0tFTlMubXVsKDIwKS5kaXYoMTAwKSwgc3RhcnRUaW1lICsgMSB5ZWFycyk7CiAgICAgICAgZXJ0VG9rZW4ubWludFRpbWVsb2NrZWQoVEVBTV9QSElMX0FERFJFU1MsIFRFQU1fUEhJTF9UT0tFTlMubXVsKDMwKS5kaXYoMTAwKSwgc3RhcnRUaW1lICsgMyB5ZWFycyk7CiAgICAgICAgZXJ0VG9rZW4ubWludFRpbWVsb2NrZWQoVEVBTV9QSElMX0FERFJFU1MsIFRFQU1fUEhJTF9UT0tFTlMubXVsKDMwKS5kaXYoMTAwKSwgc3RhcnRUaW1lICsgNSB5ZWFycyk7CiAgICAgICAgcmVxdWlyZSh0b2tlbi5taW50KFRFQU1fUEhJTF9BRERSRVNTLCBURUFNX1BISUxfVE9LRU5TLm11bCgyMCkuZGl2KDEwMCkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUHVyY2hhc2UgZm9yIGJpdGNvaW4uIENhbiBzdGFydCBvbmx5IGJ0YyBidXllcgogICAgICovCiAgICBmdW5jdGlvbiBidXlGb3JCaXRjb2luKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9hbW91bnRXZWkpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYnRjQnV5ZXIpOwoKICAgICAgICBidXlUb2tlbnMoX2JlbmVmaWNpYXJ5LCBfYW1vdW50V2VpKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0IG5ldyBhZGRyZXNzIHdobyBjYW4gYnV5IHRva2VucyBmb3IgYml0Y29pbgogICAgICovCiAgICBmdW5jdGlvbiBzZXRCdGNCdXllcihhZGRyZXNzIF9uZXdCdGNCdXllckFkZHJlc3MpIG9ubHlPd25lciByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF9uZXdCdGNCdXllckFkZHJlc3MgIT0gMHgwKTsKCiAgICAgICAgYnRjQnV5ZXIgPSBfbmV3QnRjQnV5ZXJBZGRyZXNzOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmluaXNoIHRoZSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewogICAgICAgIHN1cGVyLmZpbmFsaXphdGlvbigpOwogICAgICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKCiAgICAgICAgYm9udXNQcm92aWRlci5yZWxlYXNlVGhpc0JvbnVzZXMoKTsKCiAgICAgICAgaWYgKGdvYWxSZWFjaGVkKCkpIHsKICAgICAgICAgICAgRVNwb3J0c1Rva2VuKHRva2VuKS5hbGxvd01vdmVUb2tlbnMoKTsKICAgICAgICB9CiAgICAgICAgdG9rZW4udHJhbnNmZXJPd25lcnNoaXAob3duZXIpOyAvLyBjaGFuZ2UgdG9rZW4gb3duZXIKICAgIH0KfQoKY29udHJhY3QgRVNwb3J0c0JvbnVzUHJvdmlkZXIgaXMgRVNwb3J0c0NvbnN0YW50cywgT3duYWJsZSB7CiAgICAvLyAxKSAxMCUgb24geW91ciBpbnZlc3RtZW50IGR1cmluZyBmaXJzdCB3ZWVrCiAgICAvLyAyKSAxMCUgdG8gYWxsIGludmVzdG9ycyBkdXJpbmcgSUNPICggbm90IHByZXNhbGUpIGlmIHdlIHJlYWNoIDUgMDAwIDAwMCBldXJvIGludmVzdG1lbnRzCgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgRVNwb3J0c1Rva2VuIHB1YmxpYyB0b2tlbjsKICAgIGFkZHJlc3MgcHVibGljIHJldHVybkFkZHJlc3NCb251c2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBpbnZlc3RvckJvbnVzZXM7CgogICAgdWludCBjb25zdGFudCBGSVJTVF9XRUVLID0gNyBkYXlzOwogICAgdWludCBjb25zdGFudCBCT05VU19USFJFU0hPTERfRVRSID0gMjAwMDAgKiBSQVRFICogVE9LRU5fREVDSU1BTF9NVUxUSVBMSUVSOyAvLyA1IDAwMCAwMDAgRVVSIC0+IDIwIDAwMCBFVEggLT4gRVRSCgogICAgZnVuY3Rpb24gRVNwb3J0c0JvbnVzUHJvdmlkZXIoRVNwb3J0c1Rva2VuIF90b2tlbiwgYWRkcmVzcyBfcmV0dXJuQWRkcmVzc0JvbnVzZXMpIHsKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgICAgICByZXR1cm5BZGRyZXNzQm9udXNlcyA9IF9yZXR1cm5BZGRyZXNzQm9udXNlczsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCb251c0Ftb3VudCgKICAgICAgICBhZGRyZXNzIF9idXllciwKICAgICAgICB1aW50IF90b3RhbFNvbGQsCiAgICAgICAgdWludCBfYW1vdW50VG9rZW5zLAogICAgICAgIHVpbnQzMiBfc3RhcnRUaW1lCiAgICApIG9ubHlPd25lciBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYm9udXMgPSAwOwogICAgICAgIAogICAgICAgIC8vIEFwcGx5IGJvbnVzIGZvciBhbW91bnQKICAgICAgICBpZiAobm93IDwgX3N0YXJ0VGltZSArIEZJUlNUX1dFRUsgJiYgbm93ID49IF9zdGFydFRpbWUpIHsKICAgICAgICAgICAgYm9udXMgPSBib251cy5hZGQoX2Ftb3VudFRva2Vucy5kaXYoMTApKTsgLy8gMQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJvbnVzOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZERlbGF5ZWRCb251cygKICAgICAgICBhZGRyZXNzIF9idXllciwKICAgICAgICB1aW50IF90b3RhbFNvbGQsCiAgICAgICAgdWludCBfYW1vdW50VG9rZW5zCiAgICApIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYm9udXMgPSAwOwoKICAgICAgICBpZiAoX3RvdGFsU29sZCA8IEJPTlVTX1RIUkVTSE9MRF9FVFIpIHsKICAgICAgICAgICAgdWludCBhbW91bnRUaHJlc2hvbGRCb251cyA9IF9hbW91bnRUb2tlbnMuZGl2KDEwKTsgLy8gMgogICAgICAgICAgICBpbnZlc3RvckJvbnVzZXNbX2J1eWVyXSA9IGludmVzdG9yQm9udXNlc1tfYnV5ZXJdLmFkZChhbW91bnRUaHJlc2hvbGRCb251cyk7IAogICAgICAgICAgICBib251cyA9IGJvbnVzLmFkZChhbW91bnRUaHJlc2hvbGRCb251cyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYm9udXM7CiAgICB9CgogICAgZnVuY3Rpb24gcmVsZWFzZUJvbnVzKGFkZHJlc3MgX2J1eWVyLCB1aW50IF90b3RhbFNvbGQpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoX3RvdGFsU29sZCA+PSBCT05VU19USFJFU0hPTERfRVRSKTsKICAgICAgICByZXF1aXJlKGludmVzdG9yQm9udXNlc1tfYnV5ZXJdID4gMCk7CgogICAgICAgIHVpbnQgYW1vdW50Qm9udXNUb2tlbnMgPSBpbnZlc3RvckJvbnVzZXNbX2J1eWVyXTsKICAgICAgICBpbnZlc3RvckJvbnVzZXNbX2J1eWVyXSA9IDA7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihfYnV5ZXIsIGFtb3VudEJvbnVzVG9rZW5zKSk7CgogICAgICAgIHJldHVybiBhbW91bnRCb251c1Rva2VuczsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXREZWxheWVkQm9udXNBbW91bnQoYWRkcmVzcyBfYnV5ZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW52ZXN0b3JCb251c2VzW19idXllcl07CiAgICB9CgogICAgZnVuY3Rpb24gc2VuZEJvbnVzKGFkZHJlc3MgX2J1eWVyLCB1aW50IF9hbW91bnRCb251c1Rva2Vucykgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihfYnV5ZXIsIF9hbW91bnRCb251c1Rva2VucykpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbGVhc2VUaGlzQm9udXNlcygpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHVpbnQgcmVtYWluQm9udXNUb2tlbnMgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7IC8vIHNlbmQgYWxsIHJlbWFpbmluZyBib251c2VzCiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihyZXR1cm5BZGRyZXNzQm9udXNlcywgcmVtYWluQm9udXNUb2tlbnMpKTsKICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgCWZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIAlmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICAJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIAlldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLiAKICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAgIC8qKgogICAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAgICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAgICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLyoqCiAgICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAgICovCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbgogKiBAZGV2IFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqIEBkZXYgSXNzdWU6ICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9pc3N1ZXMvMTIwCiAqIEJhc2VkIG9uIGNvZGUgYnkgVG9rZW5NYXJrZXROZXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvY29udHJhY3RzL01pbnRhYmxlVG9rZW4uc29sCiAqLwpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKCiAgICBldmVudCBNaW50RmluaXNoZWQoKTsKCiAgICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCiAgICBtb2RpZmllciBjYW5NaW50KCkgewogICAgICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgICAqLwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigweDAsIF90bywgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICAgICAgTWludEZpbmlzaGVkKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IEVTcG9ydHNUb2tlbiBpcyBFU3BvcnRzQ29uc3RhbnRzLCBNaW50YWJsZVRva2VuIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludCB2YWx1ZSk7CiAgICBldmVudCBNaW50VGltZWxvY2tlZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQgYW1vdW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgUGF1c2UgdG9rZW4gdHJhbnNmZXIuIEFmdGVyIHN1Y2Nlc3NmdWxseSBmaW5pc2hlZCBjcm93ZHNhbGUgaXQgYmVjb21lcyBmYWxzZQogICAgICovCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSB0cnVlOwogICAgLyoqCiAgICAgKiBAZGV2IEFjY291bnRzIHdobyBjYW4gdHJhbnNmZXIgdG9rZW4gZXZlbiBpZiBwYXVzZWQuIFdvcmtzIG9ubHkgZHVyaW5nIGNyb3dkc2FsZQogICAgICovCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgZXhjbHVkZWQ7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBFU3BvcnRzRnJlZXppbmdTdG9yYWdlW10pIHB1YmxpYyBmcm96ZW5GdW5kczsKCiAgICBmdW5jdGlvbiBuYW1lKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHN0cmluZyBfbmFtZSkgewogICAgICAgIHJldHVybiAiRVNwb3J0cyBUb2tlbiI7CiAgICB9CgogICAgZnVuY3Rpb24gc3ltYm9sKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHN0cmluZyBfc3ltYm9sKSB7CiAgICAgICAgcmV0dXJuICJFUlQiOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4IF9kZWNpbWFscykgewogICAgICAgIHJldHVybiBUT0tFTl9ERUNJTUFMU19VSU5UODsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWxsb3dNb3ZlVG9rZW5zKCkgb25seU93bmVyIHsKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRFeGNsdWRlZChhZGRyZXNzIF90b0V4Y2x1ZGUpIG9ubHlPd25lciB7CiAgICAgICAgYWRkRXhjbHVkZWRJbnRlcm5hbChfdG9FeGNsdWRlKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkRXhjbHVkZWRJbnRlcm5hbChhZGRyZXNzIF90b0V4Y2x1ZGUpIHByaXZhdGUgewogICAgICAgIGV4Y2x1ZGVkW190b0V4Y2x1ZGVdID0gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgV3JhcHBlciBvZiB0b2tlbi50cmFuc2ZlckZyb20KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCB8fCBleGNsdWRlZFtfZnJvbV0pOwoKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFdyYXBwZXIgb2YgdG9rZW4udHJhbnNmZXIgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCB8fCBleGNsdWRlZFttc2cuc2VuZGVyXSk7CgogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1pbnQgdGltZWxvY2tlZCB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gbWludFRpbWVsb2NrZWQoYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCwgdWludDMyIF9yZWxlYXNlVGltZSkKICAgICAgICAgICAgb25seU93bmVyIGNhbk1pbnQgcmV0dXJucyAoRVNwb3J0c0ZyZWV6aW5nU3RvcmFnZSkgewogICAgICAgIEVTcG9ydHNGcmVlemluZ1N0b3JhZ2UgdGltZWxvY2sgPSBuZXcgRVNwb3J0c0ZyZWV6aW5nU3RvcmFnZSh0aGlzLCBfcmVsZWFzZVRpbWUpOwogICAgICAgIG1pbnQodGltZWxvY2ssIF9hbW91bnQpOwoKICAgICAgICBmcm96ZW5GdW5kc1tfdG9dLnB1c2godGltZWxvY2spOwogICAgICAgIGFkZEV4Y2x1ZGVkSW50ZXJuYWwodGltZWxvY2spOwoKICAgICAgICBNaW50VGltZWxvY2tlZChfdG8sIF9hbW91bnQpOwoKICAgICAgICByZXR1cm4gdGltZWxvY2s7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbGVhc2UgZnJvemVuIHRva2VucwogICAgICogQHJldHVybiBUb3RhbCBhbW91bnQgb2YgcmVsZWFzZWQgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJldHVybkZyb3plbkZyZWVGdW5kcygpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCB0b3RhbCA9IDA7CiAgICAgICAgRVNwb3J0c0ZyZWV6aW5nU3RvcmFnZVtdIHN0b3JhZ2UgZnJvemVuU3RvcmFnZXMgPSBmcm96ZW5GdW5kc1ttc2cuc2VuZGVyXTsKICAgICAgICAvLyBmb3IgKHVpbnQgeCA9IDA7IHggPCBmcm96ZW5TdG9yYWdlcy5sZW5ndGg7IHgrKykgewogICAgICAgIC8vICAgICB1aW50IGFtb3VudCA9IGJhbGFuY2VPZihmcm96ZW5TdG9yYWdlc1t4XSk7CiAgICAgICAgLy8gICAgIGlmIChmcm96ZW5TdG9yYWdlc1t4XS5jYWxsKGJ5dGVzNChzaGEzKCJyZWxlYXNlKGFkZHJlc3MpIikpLCBtc2cuc2VuZGVyKSkKICAgICAgICAvLyAgICAgICAgIHRvdGFsID0gdG90YWwuYWRkKGFtb3VudCk7CiAgICAgICAgLy8gfQogICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGZyb3plblN0b3JhZ2VzLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgIHVpbnQgYW1vdW50ID0gZnJvemVuU3RvcmFnZXNbeF0ucmVsZWFzZShtc2cuc2VuZGVyKTsKICAgICAgICAgICAgdG90YWwgPSB0b3RhbC5hZGQoYW1vdW50KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBCdXJucyBhIHNwZWNpZmljIGFtb3VudCBvZiB0b2tlbnMuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgYnVybmVkLgogICAgICovCiAgICBmdW5jdGlvbiBidXJuKHVpbnQgX3ZhbHVlKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCB8fCBleGNsdWRlZFttc2cuc2VuZGVyXSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIAogICAgICAgIEJ1cm4obXNnLnNlbmRlciwgX3ZhbHVlKTsKICAgIH0KfQ=='.
	

]
