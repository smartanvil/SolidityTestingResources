Class {
	#name : #SRT86fe3c20379ac71ebbf8c0499b41fd2b457e4e9e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT86fe3c20379ac71ebbf8c0499b41fd2b457e4e9e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogVHJhZGVUb2tlbiBDcm93ZHNhbGUgQ29udHJhY3QKICoKICogVGhpcyBpcyB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IGZvciB0aGUgVHJhZGVUb2tlbi4gSXQgdXRpbGl6ZXMgTWFqb29scidzCiAqIENyb3dkc2FsZUxpYiBsaWJyYXJ5IHRvIHJlZHVjZSBjdXN0b20gc291cmNlIGNvZGUgc3VyZmFjZSBhcmVhIGFuZCBpbmNyZWFzZQogKiBvdmVyYWxsIHNlY3VyaXR5Lk1ham9vbHIgcHJvdmlkZXMgc21hcnQgY29udHJhY3Qgc2VydmljZXMgYW5kIHNlY3VyaXR5IHJldmlld3MKICogZm9yIGNvbnRyYWN0IGRlcGxveW1lbnRzIGluIGFkZGl0aW9uIHRvIHdvcmtpbmcgb24gb3BlbiBzb3VyY2UgcHJvamVjdHMgaW4gdGhlCiAqIEV0aGVyZXVtIGNvbW11bml0eS4KICogRm9yIGZ1cnRoZXIgaW5mb3JtYXRpb246IHRyYWRlLmlvLCBtYWpvb2xyLmlvCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpjb250cmFjdCBUSU9Dcm93ZHNhbGUgewogIHVzaW5nIERpcmVjdENyb3dkc2FsZUxpYiBmb3IgRGlyZWN0Q3Jvd2RzYWxlTGliLkRpcmVjdENyb3dkc2FsZVN0b3JhZ2U7CgogIERpcmVjdENyb3dkc2FsZUxpYi5EaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHNhbGU7CiAgYm9vbCBwdWJsaWMgZ3JlZW5zaG9lQWN0aXZlOwogIGZ1bmN0aW9uIFRJT0Nyb3dkc2FsZSgKICAgICAgICAgICAgICAgIGFkZHJlc3Mgb3duZXIsCiAgICAgICAgICAgICAgICB1aW50MjU2W10gc2FsZURhdGEsICAgICAgICAgICAvLyBbMTUxMjYzMzYwMCwgNTAsIDAsIDE1MTMyMzg0MDAsIDU2LCAwLCAxNTEzODQzMjAwLCA2NCwgMCwgMTUxNDQ0ODAwMCwgNzUsIDBdCiAgICAgICAgICAgICAgICB1aW50MjU2IGZhbGxiYWNrRXhjaGFuZ2VSYXRlLCAvLyA0NTAwMAogICAgICAgICAgICAgICAgdWludDI1NiBjYXBBbW91bnRJbkNlbnRzLCAgICAgLy8gMjQ3NTAwMDAwMDAKICAgICAgICAgICAgICAgIHVpbnQyNTYgZW5kVGltZSwgICAgICAgICAgICAgIC8vIDE1MTUwNTI3NDAKICAgICAgICAgICAgICAgIHVpbnQ4IHBlcmNlbnRCdXJuLCAgICAgICAgICAgIC8vIDEwMAogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlVG9rZW4gdG9rZW4pICAgICAgICAgLy8gMHg4MGJjNTUxMjU2MWM3Zjg1YTNhOTUwOGM3ZGY3OTAxYjM3MGZhMWRmCiAgewogIAlzYWxlLmluaXQob3duZXIsIHNhbGVEYXRhLCBmYWxsYmFja0V4Y2hhbmdlUmF0ZSwgY2FwQW1vdW50SW5DZW50cywgZW5kVGltZSwgcGVyY2VudEJ1cm4sIHRva2VuKTsKICB9CgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgIHNlbmRQdXJjaGFzZSgpOwogIH0KCiAgZnVuY3Rpb24gc2VuZFB1cmNoYXNlKCkgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IF90b2tlbnNTb2xkID0gZ2V0VG9rZW5zU29sZCgpOwogICAgaWYoX3Rva2Vuc1NvbGQgPiAyNzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgJiYgKCFncmVlbnNob2VBY3RpdmUpKXsKICAgICAgYm9vbCBzdWNjZXNzID0gYWN0aXZhdGVHcmVlbnNob2UoKTsKICAgICAgYXNzZXJ0KHN1Y2Nlc3MpOwogICAgfQogIAlyZXR1cm4gc2FsZS5yZWNlaXZlUHVyY2hhc2UobXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFjdGl2YXRlR3JlZW5zaG9lKCkgcHJpdmF0ZSByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IF9jdXJyZW50UHJpY2UgPSBzYWxlLmJhc2Uuc2FsZURhdGFbc2FsZS5iYXNlLm1pbGVzdG9uZVRpbWVzW3NhbGUuYmFzZS5jdXJyZW50TWlsZXN0b25lXV1bMF07CiAgICB3aGlsZShzYWxlLmJhc2UubWlsZXN0b25lVGltZXMubGVuZ3RoID4gc2FsZS5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxKQogICAgewogICAgICBzYWxlLmJhc2UuY3VycmVudE1pbGVzdG9uZSArPSAxOwogICAgICBzYWxlLmJhc2Uuc2FsZURhdGFbc2FsZS5iYXNlLm1pbGVzdG9uZVRpbWVzW3NhbGUuYmFzZS5jdXJyZW50TWlsZXN0b25lXV1bMF0gPSBfY3VycmVudFByaWNlOwogICAgfQogICAgZ3JlZW5zaG9lQWN0aXZlID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKSByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBzYWxlLndpdGhkcmF3VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKCkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNhbGUud2l0aGRyYXdMZWZ0b3ZlcldlaSgpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aCgpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLndpdGhkcmF3T3duZXJFdGgoKTsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUFjdGl2ZSgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLmNyb3dkc2FsZUFjdGl2ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlRW5kZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZS5jcm93ZHNhbGVFbmRlZCgpOwogIH0KCiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUodWludDI1NiBfZXhjaGFuZ2VSYXRlKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZS5zZXRUb2tlbkV4Y2hhbmdlUmF0ZShfZXhjaGFuZ2VSYXRlKTsKICB9CgogIGZ1bmN0aW9uIHNldFRva2VucygpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLnNldFRva2VucygpOwogIH0KCiAgZnVuY3Rpb24gZ2V0T3duZXIoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gc2FsZS5iYXNlLm93bmVyOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zUGVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS50b2tlbnNQZXJFdGg7CiAgfQoKICBmdW5jdGlvbiBnZXRFeGNoYW5nZVJhdGUoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2FsZS5iYXNlLmV4Y2hhbmdlUmF0ZTsKICB9CgogIGZ1bmN0aW9uIGdldENhcEFtb3VudCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmKCFncmVlbnNob2VBY3RpdmUpIHsKICAgICAgcmV0dXJuIHNhbGUuYmFzZS5jYXBBbW91bnQgLSAxNjAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gc2FsZS5iYXNlLmNhcEFtb3VudDsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldFN0YXJ0VGltZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uuc3RhcnRUaW1lOwogIH0KCiAgZnVuY3Rpb24gZ2V0RW5kVGltZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2UuZW5kVGltZTsKICB9CgogIGZ1bmN0aW9uIGdldEV0aFJhaXNlZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uub3duZXJCYWxhbmNlOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0aW9uKGFkZHJlc3MgX2J1eWVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgCXJldHVybiBzYWxlLmJhc2UuaGFzQ29udHJpYnV0ZWRbX2J1eWVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2VuUHVyY2hhc2UoYWRkcmVzcyBfYnV5ZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAJcmV0dXJuIHNhbGUuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFtfYnV5ZXJdOwogIH0KCiAgZnVuY3Rpb24gZ2V0TGVmdG92ZXJXZWkoYWRkcmVzcyBfYnV5ZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2UubGVmdG92ZXJXZWlbX2J1eWVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFNhbGVEYXRhKHVpbnQyNTYgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2WzNdKSB7CiAgICByZXR1cm4gc2FsZS5nZXRTYWxlRGF0YSh0aW1lc3RhbXApOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uuc3RhcnRpbmdUb2tlbkJhbGFuY2UgLSBzYWxlLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2FsZS5iYXNlLm93bmVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFBlcmNlbnRCdXJuKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5wZXJjZW50QnVybjsKICB9Cn0KCmxpYnJhcnkgRGlyZWN0Q3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CiAgdXNpbmcgQ3Jvd2RzYWxlTGliIGZvciBDcm93ZHNhbGVMaWIuQ3Jvd2RzYWxlU3RvcmFnZTsKCiAgc3RydWN0IERpcmVjdENyb3dkc2FsZVN0b3JhZ2UgewoKICAJQ3Jvd2RzYWxlTGliLkNyb3dkc2FsZVN0b3JhZ2UgYmFzZTsgLy8gYmFzZSBzdG9yYWdlIGZyb20gQ3Jvd2RzYWxlTGliCgogIH0KCiAgZXZlbnQgTG9nVG9rZW5zQm91Z2h0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IExvZ0FkZHJlc3NDYXBFeGNlZWRlZChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKICBldmVudCBMb2dFcnJvck1zZyh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nVG9rZW5QcmljZUNoYW5nZSh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CgoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIGNlbnRzIGF0IHRoYXQgdGltZSwKICAvLy8gMyBpcyBhZGRyZXNzIHB1cmNoYXNlIGNhcCBhdCB0aGF0IHRpbWUsIDAgaWYgbm8gYWRkcmVzcyBjYXAKICAvLy8gQHBhcmFtIF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSBFeGNoYW5nZSByYXRlIG9mIGNlbnRzL0VUSAogIC8vLyBAcGFyYW0gX2NhcEFtb3VudEluQ2VudHMgVG90YWwgdG8gYmUgcmFpc2VkIGluIGNlbnRzCiAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaW1lc3RhbXAgb2Ygc2FsZSBlbmQgdGltZQogIC8vLyBAcGFyYW0gX3BlcmNlbnRCdXJuIFBlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHBhcmFtIF90b2tlbiBUb2tlbiBiZWluZyBzb2xkCiAgZnVuY3Rpb24gaW5pdChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICB1aW50OCBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICBDcm93ZHNhbGVUb2tlbiBfdG9rZW4pCiAgICAgICAgICAgICAgICBwdWJsaWMKICB7CiAgCXNlbGYuYmFzZS5pbml0KF9vd25lciwKICAgICAgICAgICAgICAgIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgIF9jYXBBbW91bnRJbkNlbnRzLAogICAgICAgICAgICAgICAgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICBfdG9rZW4pOwogIH0KCiAgLy8vIEBkZXYgQ2FsbGVkIHdoZW4gYW4gYWRkcmVzcyB3YW50cyB0byBwdXJjaGFzZSB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBhbW91bnQgb2Ygd2VpIHRoYXQgdGhlIGJ1eWVyIGlzIHNlbmRpbmcKICAvLy8gQHJldHVybiB0cnVlIG9uIHN1Y2Nlc2Z1bCBwdXJjaGFzZQogIGZ1bmN0aW9uIHJlY2VpdmVQdXJjaGFzZShEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfYW1vdW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gc2VsZi5iYXNlLm93bmVyKTsKICAJcmVxdWlyZShzZWxmLmJhc2UudmFsaWRQdXJjaGFzZSgpKTsKCiAgCS8vIGlmIHRoZSB0b2tlbiBwcmljZSBpbmNyZWFzZSBpbnRlcnZhbCBoYXMgcGFzc2VkLCB1cGRhdGUgdGhlIGN1cnJlbnQgZGF5IGFuZCBjaGFuZ2UgdGhlIHRva2VuIHByaWNlCiAgCWlmICgoc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzLmxlbmd0aCA+IHNlbGYuYmFzZS5jdXJyZW50TWlsZXN0b25lICsgMSkgJiYKICAgICAgICAobm93ID4gc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzW3NlbGYuYmFzZS5jdXJyZW50TWlsZXN0b25lICsgMV0pKQogICAgewogICAgICAgIHdoaWxlKChzZWxmLmJhc2UubWlsZXN0b25lVGltZXMubGVuZ3RoID4gc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxKSAmJgogICAgICAgICAgICAgIChub3cgPiBzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxXSkpCiAgICAgICAgewogICAgICAgICAgc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKz0gMTsKICAgICAgICB9CgogICAgICAgIHNlbGYuYmFzZS5jaGFuZ2VUb2tlblByaWNlKHNlbGYuYmFzZS5zYWxlRGF0YVtzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmVdXVswXSk7CiAgICAgICAgTG9nVG9rZW5QcmljZUNoYW5nZShzZWxmLmJhc2UudG9rZW5zUGVyRXRoLCJUb2tlbiBQcmljZSBoYXMgY2hhbmdlZCEiKTsKICAgIH0KCiAgCXVpbnQyNTYgX251bVRva2VuczsgLy9udW1iZXIgb2YgdG9rZW5zIHRoYXQgd2lsbCBiZSBwdXJjaGFzZWQKICAgIHVpbnQyNTYgX25ld0JhbGFuY2U7IC8vdGhlIG5ldyBiYWxhbmNlIG9mIHRoZSBvd25lciBvZiB0aGUgY3Jvd2RzYWxlCiAgICB1aW50MjU2IF93ZWlUb2tlbnM7IC8vdGVtcCBjYWxjIGhvbGRlcgogICAgdWludDI1NiBfbGVmdG92ZXJXZWk7IC8vd2VpIGNoYW5nZSBmb3IgcHVyY2hhc2VyCiAgICB1aW50MjU2IF9yZW1haW5kZXI7IC8vdGVtcCBjYWxjIGhvbGRlcgogICAgYm9vbCBlcnI7CgogICAgaWYoKHNlbGYuYmFzZS5vd25lckJhbGFuY2UgKyBfYW1vdW50KSA+IHNlbGYuYmFzZS5jYXBBbW91bnQpewogICAgICBfbGVmdG92ZXJXZWkgPSAoc2VsZi5iYXNlLm93bmVyQmFsYW5jZSArIF9hbW91bnQpIC0gc2VsZi5iYXNlLmNhcEFtb3VudDsKICAgICAgX2Ftb3VudCA9IF9hbW91bnQgLSBfbGVmdG92ZXJXZWk7CiAgICB9CgogICAgLy8gRmluZCB0aGUgbnVtYmVyIG9mIHRva2VucyBhcyBhIGZ1bmN0aW9uIGluIHdlaQogICAgKGVycixfd2VpVG9rZW5zKSA9IF9hbW91bnQudGltZXMoc2VsZi5iYXNlLnRva2Vuc1BlckV0aCk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIF9udW1Ub2tlbnMgPSBfd2VpVG9rZW5zIC8gMTAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIF9yZW1haW5kZXIgPSBfd2VpVG9rZW5zICUgMTAwMDAwMDAwMDAwMDAwMDAwMDsKICAgIF9yZW1haW5kZXIgPSBfcmVtYWluZGVyIC8gc2VsZi5iYXNlLnRva2Vuc1BlckV0aDsKICAgIF9sZWZ0b3ZlcldlaSA9IF9sZWZ0b3ZlcldlaSArIF9yZW1haW5kZXI7CiAgICBfYW1vdW50ID0gX2Ftb3VudCAtIF9yZW1haW5kZXI7CiAgICBzZWxmLmJhc2UubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gKz0gX2xlZnRvdmVyV2VpOwoKICAgIC8vIGNhbid0IG92ZXJmbG93IGJlY2F1c2UgaXQgaXMgdW5kZXIgdGhlIGNhcAogICAgc2VsZi5iYXNlLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdICs9IF9hbW91bnQ7CgogICAgYXNzZXJ0KF9udW1Ub2tlbnMgPD0gc2VsZi5iYXNlLnRva2VuLmJhbGFuY2VPZih0aGlzKSk7CgogICAgLy8gY2FsY3VsYXRlIHRoZSBhbW91bnQgb2YgZXRoZXIgaW4gdGhlIG93bmVycyBiYWxhbmNlCiAgICAoZXJyLF9uZXdCYWxhbmNlKSA9IHNlbGYuYmFzZS5vd25lckJhbGFuY2UucGx1cyhfYW1vdW50KTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi5iYXNlLm93bmVyQmFsYW5jZSA9IF9uZXdCYWxhbmNlOyAgIC8vICJkZXBvc2l0IiB0aGUgYW1vdW50CgogICAgLy8gY2FuJ3Qgb3ZlcmZsb3cgYmVjYXVzZSBpdCB3aWxsIGJlIHVuZGVyIHRoZSBjYXAKCSAgc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdICs9IF9udW1Ub2tlbnM7CgogICAgLy9zdWJ0cmFjdCB0b2tlbnMgZnJvbSBvd25lcidzIHNoYXJlCiAgICAoZXJyLF9yZW1haW5kZXIpID0gc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW3NlbGYuYmFzZS5vd25lcl0ubWludXMoX251bVRva2Vucyk7CiAgICByZXF1aXJlKCFlcnIpOwogICAgc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW3NlbGYuYmFzZS5vd25lcl0gPSBfcmVtYWluZGVyOwoKCSAgTG9nVG9rZW5zQm91Z2h0KG1zZy5zZW5kZXIsIF9udW1Ub2tlbnMpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLypGdW5jdGlvbnMgImluaGVyaXRlZCIgZnJvbSBDcm93ZHNhbGVMaWIgbGlicmFyeSovCgogIGZ1bmN0aW9uIHNldFRva2VuRXhjaGFuZ2VSYXRlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9leGNoYW5nZVJhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXR1cm4gc2VsZi5iYXNlLnNldFRva2VuRXhjaGFuZ2VSYXRlKF9leGNoYW5nZVJhdGUpOwogIH0KCiAgZnVuY3Rpb24gc2V0VG9rZW5zKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5zZXRUb2tlbnMoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd1Rva2VucygpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdMZWZ0b3ZlcldlaShEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdMZWZ0b3ZlcldlaSgpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdPd25lckV0aCgpOwogIH0KCiAgZnVuY3Rpb24gZ2V0U2FsZURhdGEoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgdGltZXN0YW1wKQogICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgIHZpZXcKICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zICh1aW50MjU2WzNdKQogIHsKICAgIHJldHVybiBzZWxmLmJhc2UuZ2V0U2FsZURhdGEodGltZXN0YW1wKTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2Vuc1NvbGQoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuZ2V0VG9rZW5zU29sZCgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlQWN0aXZlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmNyb3dkc2FsZUFjdGl2ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlRW5kZWQoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuY3Jvd2RzYWxlRW5kZWQoKTsKICB9Cn0KCmxpYnJhcnkgQ3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CgogIHN0cnVjdCBDcm93ZHNhbGVTdG9yYWdlIHsKICAJYWRkcmVzcyBvd25lcjsgICAgIC8vb3duZXIgb2YgdGhlIGNyb3dkc2FsZQoKICAJdWludDI1NiB0b2tlbnNQZXJFdGg7ICAvL251bWJlciBvZiB0b2tlbnMgcmVjZWl2ZWQgcGVyIGV0aGVyCiAgCXVpbnQyNTYgY2FwQW1vdW50OyAvL01heGltdW0gYW1vdW50IHRvIGJlIHJhaXNlZCBpbiB3ZWkKICAJdWludDI1NiBzdGFydFRpbWU7IC8vSUNPIHN0YXJ0IHRpbWUsIHRpbWVzdGFtcAogIAl1aW50MjU2IGVuZFRpbWU7IC8vSUNPIGVuZCB0aW1lLCB0aW1lc3RhbXAgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkCiAgICB1aW50MjU2IGV4Y2hhbmdlUmF0ZTsgLy9jZW50cy9FVEggZXhjaGFuZ2UgcmF0ZSBhdCB0aGUgdGltZSBvZiB0aGUgc2FsZQogICAgdWludDI1NiBvd25lckJhbGFuY2U7IC8vb3duZXIgd2VpIEJhbGFuY2UKICAgIHVpbnQyNTYgc3RhcnRpbmdUb2tlbkJhbGFuY2U7IC8vaW5pdGlhbCBhbW91bnQgb2YgdG9rZW5zIGZvciBzYWxlCiAgICB1aW50MjU2W10gbWlsZXN0b25lVGltZXM7IC8vQXJyYXkgb2YgdGltZXN0YW1wcyB3aGVuIHRva2VuIHByaWNlIGFuZCBhZGRyZXNzIGNhcCBjaGFuZ2VzCiAgICB1aW50OCBjdXJyZW50TWlsZXN0b25lOyAvL1BvaW50ZXIgdG8gdGhlIGN1cnJlbnQgbWlsZXN0b25lCiAgICB1aW50OCB0b2tlbkRlY2ltYWxzOyAvL3N0b3JlZCB0b2tlbiBkZWNpbWFscyBmb3IgY2FsY3VsYXRpb24gbGF0ZXIKICAgIHVpbnQ4IHBlcmNlbnRCdXJuOyAvL3BlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAgIGJvb2wgdG9rZW5zU2V0OyAvL3RydWUgaWYgdG9rZW5zIGhhdmUgYmVlbiBwcmVwYXJlZCBmb3IgY3Jvd2RzYWxlCiAgICBib29sIHJhdGVTZXQ7IC8vdHJ1ZSBpZiBleGNoYW5nZSByYXRlIGhhcyBiZWVuIHNldAoKICAgIC8vTWFwcyB0aW1lc3RhbXAgdG8gdG9rZW4gcHJpY2UgYW5kIGFkZHJlc3MgcHVyY2hhc2UgY2FwIHN0YXJ0aW5nIGF0IHRoYXQgdGltZQogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2WzJdKSBzYWxlRGF0YTsKCiAgICAvL3Nob3dzIGhvdyBtdWNoIHdlaSBhbiBhZGRyZXNzIGhhcyBjb250cmlidXRlZAogIAltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGhhc0NvbnRyaWJ1dGVkOwoKICAgIC8vRm9yIHRva2VuIHdpdGhkcmF3IGZ1bmN0aW9uLCBtYXBzIGEgdXNlciBhZGRyZXNzIHRvIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoZXkgY2FuIHdpdGhkcmF3CiAgCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgd2l0aGRyYXdUb2tlbnNNYXA7CgogICAgLy8gYW55IGxlZnRvdmVyIHdlaSB0aGF0IGJ1eWVycyBjb250cmlidXRlZCB0aGF0IGRpZG4ndCBhZGQgdXAgdG8gYSB3aG9sZSB0b2tlbiBhbW91bnQKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgbGVmdG92ZXJXZWk7CgogIAlDcm93ZHNhbGVUb2tlbiB0b2tlbjsgLy90b2tlbiBiZWluZyBzb2xkCiAgfQoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBhZGRyZXNzIGhhcyB3aXRoZHJhd24gdGhlaXIgc3VwcGx5IG9mIHRva2VucwogIGV2ZW50IExvZ1Rva2Vuc1dpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgX2JpZGRlciwgdWludDI1NiBBbW91bnQpOwoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBhZGRyZXNzIGhhcyB3aXRoZHJhd24gdGhlaXIgc3VwcGx5IG9mIGV4dHJhIHdlaQogIGV2ZW50IExvZ1dlaVdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgX2JpZGRlciwgdWludDI1NiBBbW91bnQpOwoKICAvLyBMb2dzIHdoZW4gb3duZXIgaGFzIHB1bGxlZCBldGgKICBldmVudCBMb2dPd25lckV0aFdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCiAgLy8gR2VuZXJpYyBOb3RpY2UgbWVzc2FnZSB0aGF0IGluY2x1ZGVzIGFuZCBhZGRyZXNzIGFuZCBudW1iZXIKICBldmVudCBMb2dOb3RpY2VNc2coYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgdmFsdWUsIHN0cmluZyBNc2cpOwoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBlcnJvciBoYXMgb2NjdXJyZWQgaW4gdGhlIGV4ZWN1dGlvbiBvZiBhIGZ1bmN0aW9uCiAgZXZlbnQgTG9nRXJyb3JNc2codWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIGNlbnRzIGF0IHRoYXQgdGltZSwKICAvLy8gMyBpcyBhZGRyZXNzIHRva2VuIHB1cmNoYXNlIGNhcCBhdCB0aGF0IHRpbWUsIDAgaWYgbm8gYWRkcmVzcyBjYXAKICAvLy8gQHBhcmFtIF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSBFeGNoYW5nZSByYXRlIG9mIGNlbnRzL0VUSAogIC8vLyBAcGFyYW0gX2NhcEFtb3VudEluQ2VudHMgVG90YWwgdG8gYmUgcmFpc2VkIGluIGNlbnRzCiAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaW1lc3RhbXAgb2Ygc2FsZSBlbmQgdGltZQogIC8vLyBAcGFyYW0gX3BlcmNlbnRCdXJuIFBlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHBhcmFtIF90b2tlbiBUb2tlbiBiZWluZyBzb2xkCiAgZnVuY3Rpb24gaW5pdChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICB1aW50OCBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICBDcm93ZHNhbGVUb2tlbiBfdG9rZW4pCiAgICAgICAgICAgICAgICBwdWJsaWMKICB7CiAgCXJlcXVpcmUoc2VsZi5jYXBBbW91bnQgPT0gMCk7CiAgCXJlcXVpcmUoc2VsZi5vd25lciA9PSAwKTsKICAgIHJlcXVpcmUoX3NhbGVEYXRhLmxlbmd0aCA+IDApOwogICAgcmVxdWlyZSgoX3NhbGVEYXRhLmxlbmd0aCUzKSA9PSAwKTsgLy8gZW5zdXJlIHNhbGVEYXRhIGlzIDMtaXRlbSBzZXRzCiAgICByZXF1aXJlKF9zYWxlRGF0YVswXSA+IChub3cgKyAzIGRheXMpKTsKICAgIHJlcXVpcmUoX2VuZFRpbWUgPiBfc2FsZURhdGFbMF0pOwogICAgcmVxdWlyZShfY2FwQW1vdW50SW5DZW50cyA+IDApOwogICAgcmVxdWlyZShfb3duZXIgPiAwKTsKICAgIHJlcXVpcmUoX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlID4gMCk7CiAgICByZXF1aXJlKF9wZXJjZW50QnVybiA8PSAxMDApOwogICAgc2VsZi5vd25lciA9IF9vd25lcjsKICAgIHNlbGYuY2FwQW1vdW50ID0gKChfY2FwQW1vdW50SW5DZW50cy9fZmFsbGJhY2tFeGNoYW5nZVJhdGUpICsgMSkqKDEwKioxOCk7CiAgICBzZWxmLnN0YXJ0VGltZSA9IF9zYWxlRGF0YVswXTsKICAgIHNlbGYuZW5kVGltZSA9IF9lbmRUaW1lOwogICAgc2VsZi50b2tlbiA9IF90b2tlbjsKICAgIHNlbGYudG9rZW5EZWNpbWFscyA9IF90b2tlbi5kZWNpbWFscygpOwogICAgc2VsZi5wZXJjZW50QnVybiA9IF9wZXJjZW50QnVybjsKICAgIHNlbGYuZXhjaGFuZ2VSYXRlID0gX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlOwoKICAgIHVpbnQyNTYgX3RlbXBUaW1lOwogICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBfc2FsZURhdGEubGVuZ3RoOyBpICs9IDMpewogICAgICByZXF1aXJlKF9zYWxlRGF0YVtpXSA+IF90ZW1wVGltZSk7CiAgICAgIHJlcXVpcmUoX3NhbGVEYXRhW2kgKyAxXSA+IDApOwogICAgICByZXF1aXJlKChfc2FsZURhdGFbaSArIDJdID09IDApIHx8IChfc2FsZURhdGFbaSArIDJdID49IDEwMCkpOwogICAgICBzZWxmLm1pbGVzdG9uZVRpbWVzLnB1c2goX3NhbGVEYXRhW2ldKTsKICAgICAgc2VsZi5zYWxlRGF0YVtfc2FsZURhdGFbaV1dWzBdID0gX3NhbGVEYXRhW2kgKyAxXTsKICAgICAgc2VsZi5zYWxlRGF0YVtfc2FsZURhdGFbaV1dWzFdID0gX3NhbGVEYXRhW2kgKyAyXTsKICAgICAgX3RlbXBUaW1lID0gX3NhbGVEYXRhW2ldOwogICAgfQogICAgY2hhbmdlVG9rZW5QcmljZShzZWxmLCBfc2FsZURhdGFbMV0pOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgYWN0aXZlCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiBzdWNjZXNzCiAgZnVuY3Rpb24gY3Jvd2RzYWxlQWN0aXZlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiAobm93ID49IHNlbGYuc3RhcnRUaW1lICYmIG5vdyA8PSBzZWxmLmVuZFRpbWUpOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHN1Y2Nlc3MKICBmdW5jdGlvbiBjcm93ZHNhbGVFbmRlZChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogIAlyZXR1cm4gbm93ID4gc2VsZi5lbmRUaW1lOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgYSBwdXJjaGFzZSBpcyB2YWxpZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNhY3Rpb24gY2FuIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgaWYgKGNyb3dkc2FsZUFjdGl2ZShzZWxmKSAmJiBub25aZXJvUHVyY2hhc2UpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICBMb2dFcnJvck1zZyhtc2cudmFsdWUsICJJbnZhbGlkIFB1cmNoYXNlISBDaGVjayBzdGFydCB0aW1lIGFuZCBhbW91bnQgb2YgZXRoZXIuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIGNhbGxlZCBieSBwdXJjaGFzZXJzIHRvIHB1bGwgdG9rZW5zCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRva2VucyB3ZXJlIHdpdGhkcmF3bgogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBvazsKCiAgICBpZiAoc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9PSAwKSB7CiAgICAgIExvZ0Vycm9yTXNnKDAsICJTZW5kZXIgaGFzIG5vIHRva2VucyB0byB3aXRoZHJhdyEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmIChtc2cuc2VuZGVyID09IHNlbGYub3duZXIpIHsKICAgICAgaWYoIWNyb3dkc2FsZUVuZGVkKHNlbGYpKXsKICAgICAgICBMb2dFcnJvck1zZygwLCAiT3duZXIgY2Fubm90IHdpdGhkcmF3IGV4dHJhIHRva2VucyB1bnRpbCBhZnRlciB0aGUgc2FsZSEiKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYoc2VsZi5wZXJjZW50QnVybiA+IDApewogICAgICAgICAgdWludDI1NiBfYnVybkFtb3VudCA9IChzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdICogc2VsZi5wZXJjZW50QnVybikvMTAwOwogICAgICAgICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gLSBfYnVybkFtb3VudDsKICAgICAgICAgIG9rID0gc2VsZi50b2tlbi5idXJuVG9rZW4oX2J1cm5BbW91bnQpOwogICAgICAgICAgcmVxdWlyZShvayk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIHRvdGFsID0gc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXTsKICAgIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPSAwOwogICAgb2sgPSBzZWxmLnRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJlcXVpcmUob2spOwogICAgTG9nVG9rZW5zV2l0aGRyYXduKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gY2FsbGVkIGJ5IHB1cmNoYXNlcnMgdG8gcHVsbCBsZWZ0b3ZlciB3ZWkgZnJvbSB0aGVpciBwdXJjaGFzZXMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgd2VpIHdhcyB3aXRoZHJhd24KICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gPT0gMCkgewogICAgICBMb2dFcnJvck1zZygwLCAiU2VuZGVyIGhhcyBubyBleHRyYSB3ZWkgdG8gd2l0aGRyYXchIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB2YXIgdG90YWwgPSBzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdOwogICAgc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSA9IDA7CiAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvdGFsKTsKICAgIExvZ1dlaVdpdGhkcmF3bihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IHNlbmQgZXRoZXIgZnJvbSB0aGUgY29tcGxldGVkIGNyb3dkc2FsZSB0byB0aGUgb3duZXJzIHdhbGxldCBhZGRyZXNzCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIG93bmVyIHdpdGhkcmV3IGV0aAogIGZ1bmN0aW9uIHdpdGhkcmF3T3duZXJFdGgoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBpZiAoKCFjcm93ZHNhbGVFbmRlZChzZWxmKSkgJiYgKHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpPjApKSB7CiAgICAgIExvZ0Vycm9yTXNnKDAsICJDYW5ub3Qgd2l0aGRyYXcgb3duZXIgZXRoZXIgdW50aWwgYWZ0ZXIgdGhlIHNhbGUhIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICByZXF1aXJlKHNlbGYub3duZXJCYWxhbmNlID4gMCk7CgogICAgdWludDI1NiBhbW91bnQgPSBzZWxmLm93bmVyQmFsYW5jZTsKICAgIHNlbGYub3duZXJCYWxhbmNlID0gMDsKICAgIHNlbGYub3duZXIudHJhbnNmZXIoYW1vdW50KTsKICAgIExvZ093bmVyRXRoV2l0aGRyYXduKG1zZy5zZW5kZXIsYW1vdW50LCJDcm93ZHNhbGUgb3duZXIgaGFzIHdpdGhkcmF3biBhbGwgZnVuZHMhIik7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBGdW5jdGlvbiB0byBjaGFuZ2UgdGhlIHByaWNlIG9mIHRoZSB0b2tlbgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfbmV3UHJpY2UgbmV3IHRva2VuIHByaWNlIChhbW91bnQgb2YgdG9rZW5zIHBlciBldGhlcikKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0b2tlbiBwcmljZSBjaGFuZ2VkIHN1Y2Nlc3NmdWxseQogIGZ1bmN0aW9uIGNoYW5nZVRva2VuUHJpY2UoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9uZXdQcmljZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVybmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAJcmVxdWlyZShfbmV3UHJpY2UgPiAwKTsKCiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgcmVzdWx0OwoKICAgIChlcnIsIHJlc3VsdCkgPSBzZWxmLmV4Y2hhbmdlUmF0ZS50aW1lcygxMCoqdWludDI1NihzZWxmLnRva2VuRGVjaW1hbHMpKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi50b2tlbnNQZXJFdGggPSByZXN1bHQgLyBfbmV3UHJpY2U7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB0aHJlZSBkYXlzIGJlZm9yZSB0aGUgc2FsZSB0byBzZXQgdGhlIHRva2VuIGFuZCBwcmljZQogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgQ3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfZXhjaGFuZ2VSYXRlICBFVEggZXhjaGFuZ2UgcmF0ZSBleHByZXNzZWQgaW4gY2VudHMvRVRICiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZXhjaGFuZ2UgcmF0ZSBoYXMgYmVlbiBzZXQKICBmdW5jdGlvbiBzZXRUb2tlbkV4Y2hhbmdlUmF0ZShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfZXhjaGFuZ2VSYXRlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgcmVxdWlyZSgobm93ID4gKHNlbGYuc3RhcnRUaW1lIC0gMyBkYXlzKSkgJiYgKG5vdyA8IChzZWxmLnN0YXJ0VGltZSkpKTsKICAgIHJlcXVpcmUoIXNlbGYucmF0ZVNldCk7ICAgLy8gdGhlIGV4Y2hhbmdlIHJhdGUgY2FuIG9ubHkgYmUgc2V0IG9uY2UhCiAgICByZXF1aXJlKHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpID4gMCk7CiAgICByZXF1aXJlKF9leGNoYW5nZVJhdGUgPiAwKTsKCiAgICB1aW50MjU2IF9jYXBBbW91bnRJbkNlbnRzOwogICAgYm9vbCBlcnI7CgogICAgKGVyciwgX2NhcEFtb3VudEluQ2VudHMpID0gc2VsZi5leGNoYW5nZVJhdGUudGltZXMoc2VsZi5jYXBBbW91bnQpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLmV4Y2hhbmdlUmF0ZSA9IF9leGNoYW5nZVJhdGU7CiAgICBzZWxmLmNhcEFtb3VudCA9IChfY2FwQW1vdW50SW5DZW50cy9fZXhjaGFuZ2VSYXRlKSArIDE7CiAgICBjaGFuZ2VUb2tlblByaWNlKHNlbGYsc2VsZi5zYWxlRGF0YVtzZWxmLm1pbGVzdG9uZVRpbWVzWzBdXVswXSk7CiAgICBzZWxmLnJhdGVTZXQgPSB0cnVlOwoKICAgIGVyciA9ICEoc2V0VG9rZW5zKHNlbGYpKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgTG9nTm90aWNlTXNnKG1zZy5zZW5kZXIsc2VsZi50b2tlbnNQZXJFdGgsIk93bmVyIGhhcyBzZXQgdGhlIGV4Y2hhbmdlIFJhdGUgYW5kIHRva2VucyBib3VnaHQgcGVyIEVUSCEiKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgZmFsbGJhY2sgZnVuY3Rpb24gdG8gc2V0IHRva2VucyBpZiB0aGUgZXhjaGFuZ2UgcmF0ZSBmdW5jdGlvbiB3YXMgbm90IGNhbGxlZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgQ3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0b2tlbnMgc2V0IHN1Y2Nlc3NmdWxseQogIGZ1bmN0aW9uIHNldFRva2VucyhDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcikgfHwgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSkpOwogICAgcmVxdWlyZSghc2VsZi50b2tlbnNTZXQpOwoKICAgIHVpbnQyNTYgX3Rva2VuQmFsYW5jZTsKCiAgICBfdG9rZW5CYWxhbmNlID0gc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYuc3RhcnRpbmdUb2tlbkJhbGFuY2UgPSBfdG9rZW5CYWxhbmNlOwogICAgc2VsZi50b2tlbnNTZXQgPSB0cnVlOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgR2V0cyB0aGUgcHJpY2UgYW5kIGJ1eSBjYXAgZm9yIGluZGl2aWR1YWwgYWRkcmVzc2VzIGF0IHRoZSBnaXZlbiBtaWxlc3RvbmUgaW5kZXgKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gdGltZXN0YW1wIFRpbWUgZHVyaW5nIHNhbGUgZm9yIHdoaWNoIGRhdGEgaXMgcmVxdWVzdGVkCiAgLy8vIEByZXR1cm4gQSAzLWVsZW1lbnQgYXJyYXkgd2l0aCAwIHRoZSB0aW1lc3RhbXAsIDEgdGhlIHByaWNlIGluIGNlbnRzLCAyIHRoZSBhZGRyZXNzIGNhcAogIGZ1bmN0aW9uIGdldFNhbGVEYXRhKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IHRpbWVzdGFtcCkKICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICB2aWV3CiAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAodWludDI1NlszXSkKICB7CiAgICB1aW50MjU2WzNdIG1lbW9yeSBfdGhpc0RhdGE7CiAgICB1aW50MjU2IGluZGV4OwoKICAgIHdoaWxlKChpbmRleCA8IHNlbGYubWlsZXN0b25lVGltZXMubGVuZ3RoKSAmJiAoc2VsZi5taWxlc3RvbmVUaW1lc1tpbmRleF0gPCB0aW1lc3RhbXApKSB7CiAgICAgIGluZGV4Kys7CiAgICB9CiAgICBpZihpbmRleCA9PSAwKQogICAgICBpbmRleCsrOwoKICAgIF90aGlzRGF0YVswXSA9IHNlbGYubWlsZXN0b25lVGltZXNbaW5kZXggLSAxXTsKICAgIF90aGlzRGF0YVsxXSA9IHNlbGYuc2FsZURhdGFbX3RoaXNEYXRhWzBdXVswXTsKICAgIF90aGlzRGF0YVsyXSA9IHNlbGYuc2FsZURhdGFbX3RoaXNEYXRhWzBdXVsxXTsKICAgIHJldHVybiBfdGhpc0RhdGE7CiAgfQoKICAvLy8gQGRldiBHZXRzIHRoZSBudW1iZXIgb2YgdG9rZW5zIHNvbGQgdGh1cyBmYXIKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIE51bWJlciBvZiB0b2tlbnMgc29sZAogIGZ1bmN0aW9uIGdldFRva2Vuc1NvbGQoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlIC0gc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgfQp9CgpsaWJyYXJ5IFRva2VuTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CgogIHN0cnVjdCBUb2tlblN0b3JhZ2UgewogICAgYm9vbCBpbml0aWFsaXplZDsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgc3RyaW5nIG5hbWU7CiAgICBzdHJpbmcgc3ltYm9sOwogICAgdWludDI1NiB0b3RhbFN1cHBseTsKICAgIHVpbnQyNTYgaW5pdGlhbFN1cHBseTsKICAgIGFkZHJlc3Mgb3duZXI7CiAgICB1aW50OCBkZWNpbWFsczsKICAgIGJvb2wgc3RpbGxNaW50aW5nOwogIH0KCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgT3duZXJDaGFuZ2UoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvKTsKICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBidXJuZXIsIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IE1pbnRpbmdDbG9zZWQoYm9vbCBtaW50aW5nQ2xvc2VkKTsKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IHRoZSBTdGFuZGFyZCBUb2tlbiB1cG9uIGNyZWF0aW9uLgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgLy8vIEBwYXJhbSBfc3ltYm9sIFN5bWJvbCBvZiB0aGUgbmV3IHRva2VuCiAgLy8vIEBwYXJhbSBfZGVjaW1hbHMgRGVjaW1hbCBwbGFjZXMgZm9yIHRoZSB0b2tlbiByZXByZXNlbnRlZAogIC8vLyBAcGFyYW0gX2luaXRpYWxfc3VwcGx5IFRoZSBpbml0aWFsIHRva2VuIHN1cHBseQogIC8vLyBAcGFyYW0gX2FsbG93TWludGluZyBUcnVlIGlmIGFkZGl0aW9uYWwgdG9rZW5zIGNhbiBiZSBjcmVhdGVkLCBmYWxzZSBvdGhlcndpc2UKICBmdW5jdGlvbiBpbml0KFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICAgICAgICAgIHN0cmluZyBfc3ltYm9sLAogICAgICAgICAgICAgICAgdWludDggX2RlY2ltYWxzLAogICAgICAgICAgICAgICAgdWludDI1NiBfaW5pdGlhbF9zdXBwbHksCiAgICAgICAgICAgICAgICBib29sIF9hbGxvd01pbnRpbmcpCiAgICAgICAgICAgICAgICBwdWJsaWMKICB7CiAgICByZXF1aXJlKCFzZWxmLmluaXRpYWxpemVkKTsKICAgIHNlbGYuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgc2VsZi5uYW1lID0gX25hbWU7CiAgICBzZWxmLnN5bWJvbCA9IF9zeW1ib2w7CiAgICBzZWxmLnRvdGFsU3VwcGx5ID0gX2luaXRpYWxfc3VwcGx5OwogICAgc2VsZi5pbml0aWFsU3VwcGx5ID0gX2luaXRpYWxfc3VwcGx5OwogICAgc2VsZi5kZWNpbWFscyA9IF9kZWNpbWFsczsKICAgIHNlbGYub3duZXIgPSBfb3duZXI7CiAgICBzZWxmLnN0aWxsTWludGluZyA9IF9hbGxvd01pbnRpbmc7CiAgICBzZWxmLmJhbGFuY2VzW19vd25lcl0gPSBfaW5pdGlhbF9zdXBwbHk7CiAgfQoKICAvLy8gQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBjYWxsZXIncyBhY2NvdW50IHRvIGFub3RoZXIgYWNjb3VudC4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiB0cmFuc2ZlcihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiBiYWxhbmNlOwoKICAgIChlcnIsYmFsYW5jZSkgPSBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwogICAgc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2U7CiAgICAvL0l0J3Mgbm90IHBvc3NpYmxlIHRvIG92ZXJmbG93IHRva2VuIHN1cHBseQogICAgc2VsZi5iYWxhbmNlc1tfdG9dID0gc2VsZi5iYWxhbmNlc1tfdG9dICsgX3ZhbHVlOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemVkIGNhbGxlciB0cmFuc2ZlcnMgdG9rZW5zIGZyb20gb25lIGFjY291bnQgdG8gYW5vdGhlcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Zyb20gQWRkcmVzcyB0byBzZW5kIHRva2VucyBmcm9tCiAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBzZW5kIHRva2VucyB0bwogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF92YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgdmFyIF9hbGxvd2FuY2UgPSBzZWxmLmFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwogICAgYm9vbCBlcnI7CiAgICB1aW50MjU2IGJhbGFuY2VPd25lcjsKICAgIHVpbnQyNTYgYmFsYW5jZVNwZW5kZXI7CgogICAgKGVycixiYWxhbmNlT3duZXIpID0gc2VsZi5iYWxhbmNlc1tfZnJvbV0ubWludXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgKGVycixiYWxhbmNlU3BlbmRlcikgPSBfYWxsb3dhbmNlLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYuYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZU93bmVyOwogICAgc2VsZi5hbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGJhbGFuY2VTcGVuZGVyOwogICAgc2VsZi5iYWxhbmNlc1tfdG9dID0gc2VsZi5iYWxhbmNlc1tfdG9dICsgX3ZhbHVlOwoKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFJldHJpZXZlIHRva2VuIGJhbGFuY2UgZm9yIGFuIGFjY291bnQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIHRvIHJldHJpZXZlIGJhbGFuY2Ugb2YKICAvLy8gQHJldHVybiBiYWxhbmNlIFRoZSBudW1iZXIgb2YgdG9rZW5zIGluIHRoZSBzdWJqZWN0IGFjY291bnQKICBmdW5jdGlvbiBiYWxhbmNlT2YoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIHNlbGYuYmFsYW5jZXNbX293bmVyXTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZSBhbiBhY2NvdW50IHRvIHNlbmQgdG9rZW5zIG9uIGNhbGxlcidzIGJlaGFsZgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyB0byBhdXRob3JpemUKICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIGF1dGhvcml6ZWQgYWNjb3VudCBtYXkgc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gYXBwcm92ZShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIC8vIG11c3Qgc2V0IHRvIHplcm8gYmVmb3JlIGNoYW5naW5nIGFwcHJvdmFsIGFtb3VudCBpbiBhY2NvcmRhbmNlIHdpdGggc3BlYwogICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFJlbWFpbmluZyB0b2tlbnMgdGhpcmQgcGFydHkgc3BlbmRlciBoYXMgdG8gc2VuZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gaG9sZGVyCiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGF1dGhvcml6ZWQgc3BlbmRlcgogIC8vLyBAcmV0dXJuIHJlbWFpbmluZyBOdW1iZXIgb2YgdG9rZW5zIHNwZW5kZXIgaGFzIGxlZnQgaW4gb3duZXIncyBhY2NvdW50CiAgZnVuY3Rpb24gYWxsb3dhbmNlKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgdmlldwogICAgICAgICAgICAgICAgICAgICByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIHNlbGYuYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZSB0aGlyZCBwYXJ0eSB0cmFuc2ZlciBieSBpbmNyZWFzaW5nL2RlY3JlYXNpbmcgYWxsb3dlZCByYXRoZXIgdGhhbiBzZXR0aW5nIGl0CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGF1dGhvcml6ZQogIC8vLyBAcGFyYW0gX3ZhbHVlQ2hhbmdlIEluY3JlYXNlIG9yIGRlY3JlYXNlIGluIG51bWJlciBvZiB0b2tlbnMgYXV0aG9yaXplZCBhY2NvdW50IG1heSBzZW5kCiAgLy8vIEBwYXJhbSBfaW5jcmVhc2UgVHJ1ZSBpZiBpbmNyZWFzaW5nIGFsbG93YW5jZSwgZmFsc2UgaWYgZGVjcmVhc2luZyBhbGxvd2FuY2UKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGFwcHJvdmVDaGFuZ2UgKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlQ2hhbmdlLCBib29sIF9pbmNyZWFzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgcmV0dXJucyAoYm9vbCkKICB7CiAgICB1aW50MjU2IF9uZXdBbGxvd2VkOwogICAgYm9vbCBlcnI7CgogICAgaWYoX2luY3JlYXNlKSB7CiAgICAgIChlcnIsIF9uZXdBbGxvd2VkKSA9IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0ucGx1cyhfdmFsdWVDaGFuZ2UpOwogICAgICByZXF1aXJlKCFlcnIpOwoKICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9uZXdBbGxvd2VkOwogICAgfSBlbHNlIHsKICAgICAgaWYgKF92YWx1ZUNoYW5nZSA+IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pIHsKICAgICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBfbmV3QWxsb3dlZCA9IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gLSBfdmFsdWVDaGFuZ2U7CiAgICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9uZXdBbGxvd2VkOwogICAgICB9CiAgICB9CgogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9uZXdBbGxvd2VkKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgQ2hhbmdlIG93bmluZyBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCwgc3BlY2lmaWNhbGx5IGZvciBtaW50aW5nCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfbmV3T3duZXIgQWRkcmVzcyBmb3IgdGhlIG5ldyBvd25lcgogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gY2hhbmdlT3duZXIoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKChzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpICYmIChfbmV3T3duZXIgPiAwKSk7CgogICAgc2VsZi5vd25lciA9IF9uZXdPd25lcjsKICAgIE93bmVyQ2hhbmdlKG1zZy5zZW5kZXIsIF9uZXdPd25lcik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IE1pbnRzIGFkZGl0aW9uYWwgdG9rZW5zLCBuZXcgdG9rZW5zIGdvIHRvIG93bmVyCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IE51bWJlciBvZiB0b2tlbnMgdG8gbWludAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gbWludFRva2VuKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcikgJiYgc2VsZi5zdGlsbE1pbnRpbmcpOwogICAgdWludDI1NiBfbmV3QW1vdW50OwogICAgYm9vbCBlcnI7CgogICAgKGVyciwgX25ld0Ftb3VudCkgPSBzZWxmLnRvdGFsU3VwcGx5LnBsdXMoX2Ftb3VudCk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYudG90YWxTdXBwbHkgPSAgX25ld0Ftb3VudDsKICAgIHNlbGYuYmFsYW5jZXNbc2VsZi5vd25lcl0gPSBzZWxmLmJhbGFuY2VzW3NlbGYub3duZXJdICsgX2Ftb3VudDsKICAgIFRyYW5zZmVyKDB4MCwgc2VsZi5vd25lciwgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFBlcm1hbmVudCBzdG9wcyBtaW50aW5nCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBjbG9zZU1pbnQoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKTsKCiAgICBzZWxmLnN0aWxsTWludGluZyA9IGZhbHNlOwogICAgTWludGluZ0Nsb3NlZCh0cnVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUGVybWFuZW50bHkgYnVybiB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9hbW91bnQgQW1vdW50IG9mIHRva2VucyB0byBidXJuCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBidXJuVG9rZW4oVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICB1aW50MjU2IF9uZXdCYWxhbmNlOwogICAgICBib29sIGVycjsKCiAgICAgIChlcnIsIF9uZXdCYWxhbmNlKSA9IHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0ubWludXMoX2Ftb3VudCk7CiAgICAgIHJlcXVpcmUoIWVycik7CgogICAgICBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdID0gX25ld0JhbGFuY2U7CiAgICAgIHNlbGYudG90YWxTdXBwbHkgPSBzZWxmLnRvdGFsU3VwcGx5IC0gX2Ftb3VudDsKICAgICAgQnVybihtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBfYW1vdW50KTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQp9CgpsaWJyYXJ5IEJhc2ljTWF0aExpYiB7CiAgLy8vIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciBvdmVyZmxvdyBiZWZvcmUgcmV0dXJuaW5nLgogIC8vLyBEb2VzIG5vdCB0aHJvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHByb2R1Y3Qgb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHRpbWVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBtdWwoYSxiKQogICAgICBzd2l0Y2ggb3IoaXN6ZXJvKGIpLCBlcShkaXYocmVzLGIpLCBhKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IERpdmlkZXMgdHdvIG51bWJlcnMgYnV0IGNoZWNrcyBmb3IgMCBpbiB0aGUgZGl2aXNvciBmaXJzdC4KICAvLy8gRG9lcyBub3QgdGhyb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIGBiYCBpcyAwCiAgLy8vIEByZXR1cm4gcmVzIFRoZSBxdW90aWVudCBvZiBhIGFuZCBiLCBvciAwIGlmIGBiYCBpcyAwCiAgZnVuY3Rpb24gZGl2aWRlZEJ5KHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGVycix1aW50MjU2IGkpIHsKICAgIHVpbnQyNTYgcmVzOwogICAgYXNzZW1ibHl7CiAgICAgIHN3aXRjaCBpc3plcm8oYikKICAgICAgY2FzZSAwIHsKICAgICAgICByZXMgOj0gZGl2KGEsYikKICAgICAgICBsZXQgbG9jIDo9IG1sb2FkKDB4NDApCiAgICAgICAgbXN0b3JlKGFkZChsb2MsMHgyMCkscmVzKQogICAgICAgIGkgOj0gbWxvYWQoYWRkKGxvYywweDIwKSkKICAgICAgfQogICAgICBkZWZhdWx0IHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIGkgOj0gMAogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBBZGRzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIG92ZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgc3VtIG9mIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICBmdW5jdGlvbiBwbHVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGVyciwgdWludDI1NiByZXMpIHsKICAgIGFzc2VtYmx5ewogICAgICByZXMgOj0gYWRkKGEsYikKICAgICAgc3dpdGNoIGFuZChlcShzdWIocmVzLGIpLCBhKSwgb3IoZ3QocmVzLGIpLGVxKHJlcyxiKSkpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBTdWJ0cmFjdHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3IgdW5kZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93IGJ1dCByYXRoZXIgbG9ncyBhbiBFcnIgZXZlbnQgaWYgdGhlcmUgaXMgdW5kZXJmbG93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiB0aGVyZSBpcyB1bmRlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIGZ1bmN0aW9uIG1pbnVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBzdWIoYSxiKQogICAgICBzd2l0Y2ggZXEoYW5kKGVxKGFkZChyZXMsYiksIGEpLCBvcihsdChyZXMsYSksIGVxKHJlcyxhKSkpLCAxKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogIH0KfQoKY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gewogIHVzaW5nIFRva2VuTGliIGZvciBUb2tlbkxpYi5Ub2tlblN0b3JhZ2U7CgogIFRva2VuTGliLlRva2VuU3RvcmFnZSBwdWJsaWMgdG9rZW47CgogIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuKGFkZHJlc3Mgb3duZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OCBkZWNpbWFscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGluaXRpYWxTdXBwbHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBhbGxvd01pbnRpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgewogICAgdG9rZW4uaW5pdChvd25lciwgbmFtZSwgc3ltYm9sLCBkZWNpbWFscywgaW5pdGlhbFN1cHBseSwgYWxsb3dNaW50aW5nKTsKICB9CgogIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiB0b2tlbi5uYW1lOwogIH0KCiAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gdG9rZW4uc3ltYm9sOwogIH0KCiAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCkgewogICAgcmV0dXJuIHRva2VuLmRlY2ltYWxzOwogIH0KCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4udG90YWxTdXBwbHk7CiAgfQoKICBmdW5jdGlvbiBpbml0aWFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLmluaXRpYWxTdXBwbHk7CiAgfQoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2Yod2hvKTsKICB9CgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5hbGxvd2FuY2Uob3duZXIsIHNwZW5kZXIpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZUNoYW5nZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWVDaGFuZ2UsIGJvb2wgaW5jcmVhc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIHRva2VuLmFwcHJvdmVDaGFuZ2Uoc3BlbmRlciwgdmFsdWVDaGFuZ2UsIGluY3JlYXNlKTsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4uY2hhbmdlT3duZXIobmV3T3duZXIpOwogIH0KCiAgZnVuY3Rpb24gYnVyblRva2VuKHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmJ1cm5Ub2tlbihhbW91bnQpOwogIH0KfQ=='.
	

]
