Class {
	#name : #SRTd6b4f27f4d0227e8a8dc96ff29d47a7aa88a47d7,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd6b4f27f4d0227e8a8dc96ff29d47a7aa88a47d7 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgcmVxdWlyZShhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmVxdWlyZShiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIHJlcXVpcmUoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cgp9Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgTGltaXRlZFRyYW5zZmVyVG9rZW4gaXMgRVJDMjAgewoKICAvKioKICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIGl0IGNhbiB0cmFuc2ZlciBvciBvdGhlcndpc2UgdGhyb3dzLgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludDI1NiBfdmFsdWUpIHsKICAgcmVxdWlyZShfdmFsdWUgPD0gdHJhbnNmZXJhYmxlVG9rZW5zKF9zZW5kZXIsIHVpbnQ2NChub3cpKSk7CiAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVmYXVsdCB0cmFuc2ZlcmFibGUgdG9rZW5zIGZ1bmN0aW9uIHJldHVybnMgYWxsIHRva2VucyBmb3IgYSBob2xkZXIgKG5vIGxpbWl0KS4KICAgKiBAZGV2IE92ZXJ3cml0aW5nIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGlzIHRoZSB3YXkgdG8gcHJvdmlkZSB0aGUKICAgKiBzcGVjaWZpYyBsb2dpYyBmb3IgbGltaXRpbmcgdG9rZW4gdHJhbnNmZXJhYmlsaXR5IGZvciBhIGhvbGRlciBvdmVyIHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBiYWxhbmNlT2YoaG9sZGVyKTsKICB9Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBNaW50RmluaXNoZWQoKTsKICBldmVudCBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSAgKTsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsKICAgIC8vIE9ubHkgd2hpdGVsaXN0ZWQgY29udHJhY3RzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsKICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKDB4MCwgX3RvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHIsIHN0YXRlKTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Cgpjb250cmFjdCBWZXN0ZWRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7CgogIHVpbnQyNTYgTUFYX0dSQU5UU19QRVJfQUREUkVTUyA9IDIwOwoKICBzdHJ1Y3QgVG9rZW5HcmFudCB7CiAgYWRkcmVzcyBncmFudGVyOyAgICAgLy8gMjAgYnl0ZXMKICB1aW50MjU2IHZhbHVlOyAgICAgICAvLyAzMiBieXRlcwogIHVpbnQ2NCBjbGlmZjsKICB1aW50NjQgdmVzdGluZzsKICB1aW50NjQgc3RhcnQ7ICAgICAgICAvLyAzICogOCA9IDI0IGJ5dGVzCiAgYm9vbCByZXZva2FibGU7CiAgYm9vbCBidXJuc09uUmV2b2tlOyAgLy8gMiAqIDEgPSAyIGJpdHM/IG9yIDIgYnl0ZXM/CiAgfSAvLyB0b3RhbCA3OCBieXRlcyA9IDMgc3N0b3JlIHBlciBvcGVyYXRpb24gKDMyIHBlciBzc3RvcmUpCgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5HcmFudFtdKSBwdWJsaWMgZ3JhbnRzOwoKICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgZ3JhbnRJZCk7CgogIC8qKgogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGdyYW50ZWQgdG8uCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4KICAgKiBAcGFyYW0gX2NsaWZmIHVpbnQ2NCBUaW1lIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIF92ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgYWRkcmVzcyBfdG8sCiAgdWludDI1NiBfdmFsdWUsCiAgdWludDY0IF9zdGFydCwKICB1aW50NjQgX2NsaWZmLAogIHVpbnQ2NCBfdmVzdGluZywKICBib29sIF9yZXZva2FibGUsCiAgYm9vbCBfYnVybnNPblJldm9rZQogICkgcHVibGljIHsKCiAgICAvLyBDaGVjayBmb3IgZGF0ZSBpbmNvbnNpc3RlbmNpZXMgdGhhdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBiZWhhdmlvcgogICAgcmVxdWlyZShfY2xpZmYgPj0gX3N0YXJ0ICYmIF92ZXN0aW5nID49IF9jbGlmZik7CgogICAgcmVxdWlyZSh0b2tlbkdyYW50c0NvdW50KF90bykgPCBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKTsgICAvLyBUbyBwcmV2ZW50IGEgdXNlciBiZWluZyBzcGFtbWVkIGFuZCBoYXZlIGhpcyBiYWxhbmNlIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4KCiAgICB1aW50MjU2IGNvdW50ID0gZ3JhbnRzW190b10ucHVzaCgKICAgIFRva2VuR3JhbnQoCiAgICBfcmV2b2thYmxlID8gbXNnLnNlbmRlciA6IDAsIC8vIGF2b2lkIHN0b3JpbmcgYW4gZXh0cmEgMjAgYnl0ZXMgd2hlbiBpdCBpcyBub24tcmV2b2thYmxlCiAgICBfdmFsdWUsCiAgICBfY2xpZmYsCiAgICBfdmVzdGluZywKICAgIF9zdGFydCwKICAgIF9yZXZva2FibGUsCiAgICBfYnVybnNPblJldm9rZQogICAgKQogICAgKTsKCiAgICB0cmFuc2ZlcihfdG8sIF92YWx1ZSk7CgogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgY291bnQgLSAxKTsKICB9CgogIC8qKgogICAqIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICovCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX2dyYW50SWQpIHB1YmxpYyB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIHJlcXVpcmUoZ3JhbnQucmV2b2thYmxlKTsKICAgIHJlcXVpcmUoZ3JhbnQuZ3JhbnRlciA9PSBtc2cuc2VuZGVyKTsgLy8gT25seSBncmFudGVyIGNhbiByZXZva2UgaXQKCiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4ZGVhZCA6IG1zZy5zZW5kZXI7CgogICAgdWludDI1NiBub25WZXN0ZWQgPSBub25WZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKCiAgICAvLyByZW1vdmUgZ3JhbnQgZnJvbSBhcnJheQogICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CiAgICBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdID0gZ3JhbnRzW19ob2xkZXJdW2dyYW50c1tfaG9sZGVyXS5sZW5ndGguc3ViKDEpXTsKICAgIGdyYW50c1tfaG9sZGVyXS5sZW5ndGggLT0gMTsKCiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKG5vblZlc3RlZCk7CiAgICBiYWxhbmNlc1tfaG9sZGVyXSA9IGJhbGFuY2VzW19ob2xkZXJdLnN1Yihub25WZXN0ZWQpOwoKICAgIFRyYW5zZmVyKF9ob2xkZXIsIHJlY2VpdmVyLCBub25WZXN0ZWQpOwogIH0KCgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgc3BlY2lmaWMgdGltZS4KICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKCiAgICBpZiAoZ3JhbnRJbmRleCA9PSAwKSByZXR1cm4gc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSk7IC8vIHNob3J0Y3V0IGZvciBob2xkZXIgd2l0aG91dCBncmFudHMKCiAgICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIHRoZSBncmFudHMgdGhlIGhvbGRlciBoYXMsIGFuZCBhZGQgYWxsIG5vbi12ZXN0ZWQgdG9rZW5zCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IDA7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsKICAgICAgbm9uVmVzdGVkID0gU2FmZU1hdGguYWRkKG5vblZlc3RlZCwgbm9uVmVzdGVkVG9rZW5zKGdyYW50c1tob2xkZXJdW2ldLCB0aW1lKSk7CiAgICB9CgogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQogICAgdWludDI1NiB2ZXN0ZWRUcmFuc2ZlcmFibGUgPSBTYWZlTWF0aC5zdWIoYmFsYW5jZU9mKGhvbGRlciksIG5vblZlc3RlZCk7CgogICAgLy8gUmV0dXJuIHRoZSBtaW5pbXVtIG9mIGhvdyBtYW55IHZlc3RlZCBjYW4gdHJhbnNmZXIgYW5kIG90aGVyIHZhbHVlCiAgICAvLyBpbiBjYXNlIHRoZXJlIGFyZSBvdGhlciBsaW1pdGluZyB0cmFuc2ZlcmFiaWxpdHkgZmFjdG9ycyAoZGVmYXVsdCBpcyBiYWxhbmNlT2YpCiAgICByZXR1cm4gU2FmZU1hdGgubWluMjU2KHZlc3RlZFRyYW5zZmVyYWJsZSwgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBob2xkZXIgb2YgdGhlIGdyYW50cy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiBncmFudHMuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudHNDb3VudChhZGRyZXNzIF9ob2xkZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZQogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudGVkCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcGFyYW0gc3RhcnQgdWludDY0IFRoZSB0aW1lIHJlcHJlc2VudGluZyB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudAogICAqIEBwYXJhbSBjbGlmZiB1aW50NjQgIFRoZSBjbGlmZiBwZXJpb2QsIHRoZSBwZXJpb2QgYmVmb3JlIG5vdGhpbmcgY2FuIGJlIHBhaWQgb3V0CiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQKICAgKiAgdHJhbnNmZXJhYmxlVG9rZW5zCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICAgIF8vLS0tLS0tLS0gICB2ZXN0ZWRUb2tlbnMgcmVjdAogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgLwogICAqICAgfCAgICAgICAgICAgICAgLnwKICAgKiAgIHwgICAgICAgICAgICAuICB8CiAgICogICB8ICAgICAgICAgIC4gICAgfAogICAqICAgfCAgICAgICAgLiAgICAgIHwKICAgKiAgIHwgICAgICAuICAgICAgICB8CiAgICogICB8ICAgIC4gICAgICAgICAgfAogICAqICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAqICAgICAgU3RhcnQgICAgICAgQ2xpZmYgICAgVmVzdGluZwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICB1aW50MjU2IHRva2VucywKICB1aW50MjU2IHRpbWUsCiAgdWludDI1NiBzdGFydCwKICB1aW50MjU2IGNsaWZmLAogIHVpbnQyNTYgdmVzdGluZykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgewogICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuCiAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsKICAgIGlmICh0aW1lID49IHZlc3RpbmcpIHJldHVybiB0b2tlbnM7CgogICAgLy8gSW50ZXJwb2xhdGUgYWxsIHZlc3RlZCB0b2tlbnMuCiAgICAvLyBBcyBiZWZvcmUgY2xpZmYgdGhlIHNob3J0Y3V0IHJldHVybnMgMCwgd2UgY2FuIHVzZSBqdXN0IGNhbGN1bGF0ZSBhIHZhbHVlCiAgICAvLyBpbiB0aGUgdmVzdGluZyByZWN0IChhcyBzaG93biBpbiBhYm92ZSdzIGZpZ3VyZSkKCiAgICAvLyB2ZXN0ZWRUb2tlbnMgPSAodG9rZW5zICogKHRpbWUgLSBzdGFydCkpIC8gKHZlc3RpbmcgLSBzdGFydCkKICAgIHVpbnQyNTYgdmVzdGVkVG9rZW5zID0gU2FmZU1hdGguZGl2KAogICAgU2FmZU1hdGgubXVsKAogICAgdG9rZW5zLAogICAgU2FmZU1hdGguc3ViKHRpbWUsIHN0YXJ0KQogICAgKSwKICAgIFNhZmVNYXRoLnN1Yih2ZXN0aW5nLCBzdGFydCkKICAgICk7CgogICAgcmV0dXJuIHZlc3RlZFRva2VuczsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIGdyYW50LgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICogQHJldHVybiBSZXR1cm5zIGFsbCB0aGUgdmFsdWVzIHRoYXQgcmVwcmVzZW50IGEgVG9rZW5HcmFudChhZGRyZXNzLCB2YWx1ZSwgc3RhcnQsIGNsaWZmLAogICAqIHJldm9rYWJpbGl0eSwgYnVybnNPblJldm9rZSwgYW5kIHZlc3RpbmcpIHBsdXMgdGhlIHZlc3RlZCB2YWx1ZSBhdCB0aGUgY3VycmVudCB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF9ncmFudElkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nLCBib29sIHJldm9rYWJsZSwgYm9vbCBidXJuc09uUmV2b2tlKSB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOwogICAgdmFsdWUgPSBncmFudC52YWx1ZTsKICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7CiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOwogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7CiAgICByZXZva2FibGUgPSBncmFudC5yZXZva2FibGU7CiAgICBidXJuc09uUmV2b2tlID0gZ3JhbnQuYnVybnNPblJldm9rZTsKCiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgZ3JhbnQudmFsdWUsCiAgICB1aW50MjU2KHRpbWUpLAogICAgdWludDI1NihncmFudC5zdGFydCksCiAgICB1aW50MjU2KGdyYW50LmNsaWZmKSwKICAgIHVpbnQyNTYoZ3JhbnQudmVzdGluZykKICAgICk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50IG9uIHRoZQogICAqIHBhc3NlZCB0aW1lIGZyYW1lLgogICAqLwogIGZ1bmN0aW9uIG5vblZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gZ3JhbnQudmFsdWUuc3ViKHZlc3RlZFRva2VucyhncmFudCwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGRhdGUgd2hlbiB0aGUgaG9sZGVyIGNhbiB0cmFuc2ZlciBhbGwgaXRzIHRva2VucwogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyCiAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCB0cmFuc2ZlcmFibGUgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGxhc3RUb2tlbklzVHJhbnNmZXJhYmxlRGF0ZShhZGRyZXNzIGhvbGRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCBkYXRlKSB7CiAgICBkYXRlID0gdWludDY0KG5vdyk7CiAgICB1aW50MjU2IGdyYW50SW5kZXggPSBncmFudHNbaG9sZGVyXS5sZW5ndGg7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsKICAgICAgZGF0ZSA9IFNhZmVNYXRoLm1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOwogICAgfQogIH0KfQoKY29udHJhY3QgQWxsb3lUb2tlbiBpcyBNaW50YWJsZVRva2VuLCBWZXN0ZWRUb2tlbiB7CgogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBuYW1lID0gJ0FMTE9ZJzsKICAgIHN0cmluZyBjb25zdGFudCBwdWJsaWMgc3ltYm9sID0gJ0FMTE9ZJzsKICAgIHVpbnQgY29uc3RhbnQgcHVibGljIGRlY2ltYWxzID0gMTg7CgogICAgZnVuY3Rpb24gQWxsb3lUb2tlbigpewoKICAgIH0KCn0='.
	

]
