Class {
	#name : #SRTe4f5e0d5c033f517a943602df942e794a06bc123,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe4f5e0d5c033f517a943602df942e794a06bc123 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKiBBZGFwdGVkIGZyb20gc3RyaW5ncy5zb2wgY3JlYXRlZCBieSBOaWNrIEpvaG5zb24gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iOTVmNGU3ZjRmNmZkZmJmY2YxZDVmYmZhZTFmMWZhZTFiYmZiZjBlMSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CiAqIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkL3NvbGlkaXR5LXN0cmluZ3V0aWxzL2Jsb2IvMmY2Y2E5YWNjYjQ4YWUxNGM2NmYxNDM3ZWM1MGVkMTlhMDYxNmY3OC9zdHJpbmdzLnNvbAogKiBAdGl0bGUgU3RyaW5nICYgc2xpY2UgdXRpbGl0eSBsaWJyYXJ5IGZvciBTb2xpZGl0eSBjb250cmFjdHMuCiAqIEBhdXRob3IgTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjQwMjEzMjIxMjMyODJlMjkyNDAwMmUyZjM0MjQyZjM0NmUyZTI1MzQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgogKi8KbGlicmFyeSBzdHJpbmdzIHsKICAgIAogICAgc3RydWN0IHNsaWNlIHsKICAgICAgICB1aW50IF9sZW47CiAgICAgICAgdWludCBfcHRyOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHN0cmluZyB0byBtYWtlIGEgc2xpY2UgZnJvbS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TbGljZShzdHJpbmcgc2VsZikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmLCAweDIwKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2xpY2UoYnl0ZXMoc2VsZikubGVuZ3RoLCBwdHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1lbWNweSh1aW50IGRlc3QsIHVpbnQgc3JjLCB1aW50IGxlbikgcHJpdmF0ZSBwdXJlIHsKICAgICAgICAvLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQogICAgICAgIGZvcig7IGxlbiA+PSAzMjsgbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShkZXN0LCBtbG9hZChzcmMpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlc3QgKz0gMzI7CiAgICAgICAgICAgIHNyYyArPSAzMjsKICAgICAgICB9CgogICAgICAgIC8vIENvcHkgcmVtYWluaW5nIGJ5dGVzCiAgICAgICAgdWludCBtYXNrID0gMjU2ICoqICgzMiAtIGxlbikgLSAxOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNyY3BhcnQgOj0gYW5kKG1sb2FkKHNyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChkZXN0KSwgbWFzaykKICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG9yKGRlc3RwYXJ0LCBzcmNwYXJ0KSkKICAgICAgICB9CiAgICB9CgogICAgCiAgICBmdW5jdGlvbiBjb25jYXQoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKHNlbGYuX2xlbiArIG90aGVyLl9sZW4pOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CiAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwogICAgICAgIG1lbWNweShyZXRwdHIgKyBzZWxmLl9sZW4sIG90aGVyLl9wdHIsIG90aGVyLl9sZW4pOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgQ291bnRzIHRoZSBudW1iZXIgb2Ygbm9ub3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgZm91bmQgaW4gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBjb3VudChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHVpbnQgY250KSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CiAgICAgICAgd2hpbGUgKHB0ciA8PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgY250Kys7CiAgICAgICAgICAgIHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0ciksIHB0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgZmlyc3QgYnl0ZSBhZnRlciBgc2VsZmAgaWYgbm90IGZvdW5kLgogICAgZnVuY3Rpb24gZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICB1aW50IGlkeDsKCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7CiAgICAgICAgICAgIGlmIChuZWVkbGVsZW4gPD0gMzIpIHsKICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjggZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgICAgICBsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQogICAgICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzZWxmcHRyCiAgICAgICAgICAgICAgICAgICAgbG9vcDoKICAgICAgICAgICAgICAgICAgICBqdW1waShleGl0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCAxKQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGx0KHN1YihwdHIsIDEpLCBlbmQpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc2VsZmxlbikKICAgICAgICAgICAgICAgICAgICBleGl0OgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0cjsKICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDw9IHNlbGZsZW4gLSBuZWVkbGVsZW47IGlkeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsKICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHRlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgICAgICAgICBwdHIgKz0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZnB0ciArIHNlbGZsZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLgogICAgICogQHJldHVybiBgdG9rZW5gLgogICAgICovCiAgICBmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICB0b2tlbi5fcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHRva2VuLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7CiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgLy8gTm90IGZvdW5kCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyID0gcHRyICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b2tlbjsKICAgIH0KCiAgICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgdXAgdG8gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgewogICAgICAgIHNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IENvcGllcyBhIHNsaWNlIHRvIGEgbmV3IHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5LgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyB0aGUgc2xpY2UncyB0ZXh0LgogICAgICovCiAgICBmdW5jdGlvbiB0b1N0cmluZyhzbGljZSBzZWxmKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHZhciByZXQgPSBuZXcgc3RyaW5nKHNlbGYuX2xlbik7CiAgICAgICAgdWludCByZXRwdHI7CiAgICAgICAgYXNzZW1ibHkgeyByZXRwdHIgOj0gYWRkKHJldCwgMzIpIH0KCiAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwogICAgICAgIHJldHVybiByZXQ7CiAgICB9Cgp9CgovKiBIZWxwZXIgU3RyaW5nIEZ1bmN0aW9ucyBmb3IgR2FtZSBNYW5hZ2VyIENvbnRyYWN0CiAqIEB0aXRsZSBTdHJpbmcgSGVhbHBlcnMKICogQGF1dGhvciBGYXpyaSBadWJhaXIgJiBGYXJoYW4gS2h3YWphIChMdWNpZCBTaWdodCwgSW5jLikKICovCmNvbnRyYWN0IFN0cmluZ0hlbHBlcnMgewogICAgdXNpbmcgc3RyaW5ncyBmb3IgKjsKICAgIAogICAgZnVuY3Rpb24gc3RyaW5nVG9CeXRlczMyKHN0cmluZyBtZW1vcnkgc291cmNlKSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIHJlc3VsdCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSB0ZW1wRW1wdHlTdHJpbmdUZXN0ID0gYnl0ZXMoc291cmNlKTsKICAgICAgICBpZiAodGVtcEVtcHR5U3RyaW5nVGVzdC5sZW5ndGggPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMHgwOwogICAgICAgIH0KICAgIAogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmVzdWx0IDo9IG1sb2FkKGFkZChzb3VyY2UsIDMyKSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYnl0ZXMzMlRvU3RyaW5nKGJ5dGVzMzIgeCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJ5dGVzU3RyaW5nID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IGNoYXJDb3VudCA9IDA7CiAgICAgICAgZm9yICh1aW50IGogPSAwOyBqIDwgMzI7IGorKykgewogICAgICAgICAgICBieXRlIGNoYXIgPSBieXRlKGJ5dGVzMzIodWludCh4KSAqIDIgKiogKDggKiBqKSkpOwogICAgICAgICAgICBpZiAoY2hhciAhPSAwKSB7CiAgICAgICAgICAgICAgICBieXRlc1N0cmluZ1tjaGFyQ291bnRdID0gY2hhcjsKICAgICAgICAgICAgICAgIGNoYXJDb3VudCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJ5dGVzIG1lbW9yeSBieXRlc1N0cmluZ1RyaW1tZWQgPSBuZXcgYnl0ZXMoY2hhckNvdW50KTsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgY2hhckNvdW50OyBqKyspIHsKICAgICAgICAgICAgYnl0ZXNTdHJpbmdUcmltbWVkW2pdID0gYnl0ZXNTdHJpbmdbal07CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcoYnl0ZXNTdHJpbmdUcmltbWVkKTsKICAgIH0KfQoKLy8vIEB0aXRsZSBJbnRlcmZhY2UgZm9yIGNvbnRyYWN0cyBjb25mb3JtaW5nIHRvIEVSQy03MjE6IE5vbi1GdW5naWJsZSBUb2tlbnMKLy8vIEBhdXRob3IgRGlldGVyIFNoaXJsZXkgPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMzE1NTU0NDU1NDcxNTA0OTU4NWU1YzRiNTQ1ZjFmNTI1ZSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+IChodHRwczovL2dpdGh1Yi5jb20vZGV0ZSkKY29udHJhY3QgRVJDNzIxIHsKICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfYXNzZXRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfYXNzZXRJZCkgcHVibGljOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hc3NldElkKSBwdWJsaWM7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hc3NldElkKSBwdWJsaWM7CiAgZnVuY3Rpb24gaW1wbGVtZW50c0VSQzcyMSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfYXNzZXRJZCkgcHVibGljOwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CgogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgdG9rZW5JZCk7CgogIC8vIE9wdGlvbmFsCiAgLy8gZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgc3ltYm9sKTsKICAvLyBmdW5jdGlvbiB0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IHRva2VuSWQpOwogIC8vIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpOwoKICAvLyBFUkMtMTY1IENvbXBhdGliaWxpdHkgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpCiAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKLyogQ29udHJvbHMgZ2FtZSBwbGF5IHN0YXRlIGFuZCBhY2Nlc3MgcmlnaHRzIGZvciBnYW1lIGZ1bmN0aW9ucwogKiBAdGl0bGUgT3BlcmF0aW9uYWwgQ29udHJvbAogKiBAYXV0aG9yIEZhenJpIFp1YmFpciAmIEZhcmhhbiBLaHdhamEgKEx1Y2lkIFNpZ2h0LCBJbmMuKQogKiBJbnNwaXJlZCBhbmQgYWRhcHRlZCBmcm9tIGNvbnRyYWN0IGNyZWF0ZWQgYnkgT3BlblplcHBlbGluCiAqIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS8KICovCmNvbnRyYWN0IE9wZXJhdGlvbmFsQ29udHJvbCB7CiAgICAvLyBGYWNpbGl0YXRlcyBhY2Nlc3MgJiBjb250cm9sIGZvciB0aGUgZ2FtZS4KICAgIC8vIFJvbGVzOgogICAgLy8gIC1UaGUgR2FtZSBNYW5hZ2VycyAoUHJpbWFyeS9TZWNvbmRhcnkpOiBIYXMgdW5pdmVyc2FsIGNvbnRyb2wgb2YgYWxsIGdhbWUgZWxlbWVudHMgKE5vIGFiaWxpdHkgdG8gd2l0aGRyYXcpCiAgICAvLyAgLVRoZSBCYW5rZXI6IFRoZSBCYW5rIGNhbiB3aXRoZHJhdyBmdW5kcyBhbmQgYWRqdXN0IGZlZXMgLyBwcmljZXMuCgogICAgLy8vIEBkZXYgRW1pdGVkIHdoZW4gY29udHJhY3QgaXMgdXBncmFkZWQKICAgIGV2ZW50IENvbnRyYWN0VXBncmFkZShhZGRyZXNzIG5ld0NvbnRyYWN0KTsKCiAgICAvLyBUaGUgYWRkcmVzc2VzIG9mIHRoZSBhY2NvdW50cyAob3IgY29udHJhY3RzKSB0aGF0IGNhbiBleGVjdXRlIGFjdGlvbnMgd2l0aGluIGVhY2ggcm9sZXMuCiAgICBhZGRyZXNzIHB1YmxpYyBnYW1lTWFuYWdlclByaW1hcnk7CiAgICBhZGRyZXNzIHB1YmxpYyBnYW1lTWFuYWdlclNlY29uZGFyeTsKICAgIGFkZHJlc3MgcHVibGljIGJhbmtNYW5hZ2VyOwoKICAgIC8vIEBkZXYgS2VlcHMgdHJhY2sgd2hldGhlciB0aGUgY29udHJhY3QgaXMgcGF1c2VkLiBXaGVuIHRoYXQgaXMgdHJ1ZSwgbW9zdCBhY3Rpb25zIGFyZSBibG9ja2VkCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgICAvLyBAZGV2IEtlZXBzIHRyYWNrIHdoZXRoZXIgdGhlIGNvbnRyYWN0IGVycm9yZWRPdXQuIFdoZW4gdGhhdCBpcyB0cnVlLCBtb3N0IGFjdGlvbnMgYXJlIGJsb2NrZWQgJiByZWZ1bmQgY2FuIGJlIGNsYWltZWQKICAgIGJvb2wgcHVibGljIGVycm9yID0gZmFsc2U7CgogICAgLy8vIEBkZXYgT3BlcmF0aW9uIG1vZGlmaWVycyBmb3IgbGltaXRpbmcgYWNjZXNzCiAgICBtb2RpZmllciBvbmx5R2FtZU1hbmFnZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGdhbWVNYW5hZ2VyUHJpbWFyeSB8fCBtc2cuc2VuZGVyID09IGdhbWVNYW5hZ2VyU2Vjb25kYXJ5KTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlCYW5rZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGJhbmtNYW5hZ2VyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGFueU9wZXJhdG9yKCkgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gZ2FtZU1hbmFnZXJQcmltYXJ5IHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gZ2FtZU1hbmFnZXJTZWNvbmRhcnkgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBiYW5rTWFuYWdlcgogICAgICAgICk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBHTS4KICAgIGZ1bmN0aW9uIHNldFByaW1hcnlHYW1lTWFuYWdlcihhZGRyZXNzIF9uZXdHTSkgZXh0ZXJuYWwgb25seUdhbWVNYW5hZ2VyIHsKICAgICAgICByZXF1aXJlKF9uZXdHTSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgZ2FtZU1hbmFnZXJQcmltYXJ5ID0gX25ld0dNOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIEdNLgogICAgZnVuY3Rpb24gc2V0U2Vjb25kYXJ5R2FtZU1hbmFnZXIoYWRkcmVzcyBfbmV3R00pIGV4dGVybmFsIG9ubHlHYW1lTWFuYWdlciB7CiAgICAgICAgcmVxdWlyZShfbmV3R00gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGdhbWVNYW5hZ2VyU2Vjb25kYXJ5ID0gX25ld0dNOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIEJhbmtlci4KICAgIGZ1bmN0aW9uIHNldEJhbmtlcihhZGRyZXNzIF9uZXdCSykgZXh0ZXJuYWwgb25seUdhbWVNYW5hZ2VyIHsKICAgICAgICByZXF1aXJlKF9uZXdCSyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgYmFua01hbmFnZXIgPSBfbmV3Qks7CiAgICB9CgogICAgLyoqKiBQYXVzYWJsZSBmdW5jdGlvbmFsaXR5IGFkYXB0ZWQgZnJvbSBPcGVuWmVwcGVsaW4gKioqLwoKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaGFzIEVycm9yCiAgICBtb2RpZmllciB3aGVuRXJyb3IgewogICAgICAgIHJlcXVpcmUoZXJyb3IpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGFueSBPcGVyYXRvciByb2xlIHRvIHBhdXNlIHRoZSBjb250cmFjdC4KICAgIC8vLyBVc2VkIG9ubHkgaWYgYSBidWcgb3IgZXhwbG9pdCBpcyBkaXNjb3ZlcmVkIChIZXJlIHRvIGxpbWl0IGxvc3NlcyAvIGRhbWFnZSkKICAgIGZ1bmN0aW9uIHBhdXNlKCkgZXh0ZXJuYWwgb25seUdhbWVNYW5hZ2VyIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIEdhbWUgTWFzdGVyCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5IGRlcml2ZWQgY29udHJhY3RzLiAKICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUdhbWVNYW5hZ2VyIHdoZW5QYXVzZWQgewogICAgICAgIC8vIGNhbid0IHVucGF1c2UgaWYgY29udHJhY3Qgd2FzIHVwZ3JhZGVkCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIEdhbWUgTWFzdGVyCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5IGRlcml2ZWQgY29udHJhY3RzLiAKICAgIGZ1bmN0aW9uIGhhc0Vycm9yKCkgcHVibGljIG9ubHlHYW1lTWFuYWdlciB3aGVuUGF1c2VkIHsKICAgICAgICBlcnJvciA9IHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVW5wYXVzZXMgdGhlIHNtYXJ0IGNvbnRyYWN0LiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIEdhbWUgTWFzdGVyCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyBpdCBjYW4gYmUgY2FsbGVkIGJ5IGRlcml2ZWQgY29udHJhY3RzLiAKICAgIGZ1bmN0aW9uIG5vRXJyb3IoKSBwdWJsaWMgb25seUdhbWVNYW5hZ2VyIHdoZW5QYXVzZWQgewogICAgICAgIGVycm9yID0gZmFsc2U7CiAgICB9Cn0KCmNvbnRyYWN0IENTQ0NvbGxlY3RpYmxlQmFzZSBpcyBFUkM3MjEsIE9wZXJhdGlvbmFsQ29udHJvbCwgU3RyaW5nSGVscGVycyB7CgogIC8qKiogRVZFTlRTICoqKi8KICAvLy8gQGRldiBUaGUgQ3JlYXRlZCBldmVudCBpcyBmaXJlZCB3aGVuZXZlciBhIG5ldyBjb2xsZWN0aWJsZSBjb21lcyBpbnRvIGV4aXN0ZW5jZS4KICBldmVudCBDb2xsZWN0aWJsZUNyZWF0ZWQoYWRkcmVzcyBvd25lciwgdWludDI1NiBnbG9iYWxJZCwgdWludDI1NiBjb2xsZWN0aWJsZVR5cGUsIHVpbnQyNTYgY29sbGVjdGlibGVDbGFzcywgdWludDI1NiBzZXF1ZW5jZUlkLCBieXRlczMyIGNvbGxlY3RpYmxlTmFtZSwgYm9vbCBpc1JlZGVlbWVkKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgc2hpcElkKTsKCiAgLyoqKiBDT05TVEFOVFMgKioqLwoKICAvLy8gQG5vdGljZSBOYW1lIGFuZCBzeW1ib2wgb2YgdGhlIG5vbiBmdW5naWJsZSB0b2tlbiwgYXMgZGVmaW5lZCBpbiBFUkM3MjEuCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBOQU1FID0gIkNTQ1ByZVNhbGVTaGlwIjsKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFNZTUJPTCA9ICJDU0MiOwogIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID0gYnl0ZXM0KGtlY2NhazI1Nignc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KScpKTsKICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignbmFtZSgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG90YWxTdXBwbHkoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignYmFsYW5jZU9mKGFkZHJlc3MpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdhcHByb3ZlKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2Vuc09mT3duZXIoYWRkcmVzcyknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpJykpOwoKICAvLy8gQGRldiBDU0MgUHJlIFNhbGUgU3RydWN0LCBoYXZpbmcgZGV0YWlscyBvZiB0aGUgc2hpcAogIHN0cnVjdCBDU0NQcmVTYWxlSXRlbSB7CgogICAgLy8vIEBkZXYgYXNzZXQgSUQgaS4uZSBMb2NhbCBJbmRleAogICAgdWludDI1NiBhc3NldElkOwoKICAgIC8vLyBAZGV2IG5hbWUgb2YgdGhlIGNvbGxlY3RpYmxlIHN0b3JlZCBpbiBieXRlcwogICAgYnl0ZXMzMiBjb2xsZWN0aWJsZU5hbWU7CgogICAgLy8vIEBkZXYgVGltZXN0YW1wIHdoZW4gYm91Z2h0CiAgICB1aW50MjU2IGJvdWdodFRpbWVzdGFtcDsKCiAgICAvLy8gQGRldiBDb2xsZWN0aWJsZSBUeXBlcyAoVm91Y2hlci9TaGlwKQogICAgLy8vIGNhbiBiZSAwIC0gVm91Y2hlciwgMSAtIFNoaXAKICAgIHVpbnQyNTYgY29sbGVjdGlibGVUeXBlOwoKICAgIC8vLyBAZGV2IENvbGxlY3RpYmxlIENsYXNzICgxIC0gUHJvbWV0aGV1cywgMiAtIENyb3NhaXIsIDMgLSBJbnRyZXBpZCkKICAgIHVpbnQyNTYgY29sbGVjdGlibGVDbGFzczsKCiAgICAvLyBAZGV2IG93bmVyIGFkZHJlc3MKICAgIGFkZHJlc3Mgb3duZXI7CgogICAgLy8gQGRldiByZWRlZW1lIGZsYWcgKHRvIGhlbHAgd2hldGhlciBpdCBnb3QgcmVkZWVtZWQgb3Igbm90KQogICAgYm9vbCBpc1JlZGVlbWVkOwogIH0KICAKICAvLyBAZGV2IE1hcHBpbmcgY29udGFpbmluZyB0aGUgcmVmZXJlbmNlIHRvIGFsbCBDU0MgUHJlU2FsZUl0ZW0KICAvL21hcHBpbmcgKHVpbnQyNTYgPT4gQ1NDUHJlU2FsZUl0ZW1bXSkgcHVibGljIGluZGV4VG9QcmVTYWxlSXRlbTsKCiAgLy8gQGRldiBhcnJheSBvZiBDU0NQcmVTYWxlSXRlbSB0eXBlIGhvbGRpbmcgaW5mb3JtYXRpb24gb24gdGhlIFNoaXBzCiAgQ1NDUHJlU2FsZUl0ZW1bXSBhbGxQcmVTYWxlSXRlbXM7CgogIC8vIE1heCBDb3VudCBmb3IgVm91Y2hlcihzKSwgUHJvbWV0aGV1cywgQ3Jvc2FpciAmIEludHJlcGlkIFNoaXBzCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJPTUVUSEVVU19TSElQX0xJTUlUID0gMzAwOwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IElOVFJFUElEX1NISVBfTElNSVQgPSAxNTAwOwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IENST1NBSVJfU0hJUF9MSU1JVCA9IDYwMDsKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQUk9NRVRIRVVTX1ZPVUNIRVJfTElNSVQgPSAxMDA7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSU5UUkVQSURfVk9VQ0hFUl9MSU1JVCA9IDMwMDsKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBDUk9TQUlSX1ZPVUNIRVJfTElNSVQgPSAyMDA7CgogIC8vIFZhcmlhYmxlIHRvIGtlZXAgYSBjb3VudCBvZiBQcm9tZXRoZXVzL0ludHJlcGlkL0Nyb3NhaXIgTWludGVkCiAgdWludDI1NiBwdWJsaWMgcHJvbWV0aGV1c1NoaXBNaW50ZWQ7CiAgdWludDI1NiBwdWJsaWMgaW50cmVwaWRTaGlwTWludGVkOwogIHVpbnQyNTYgcHVibGljIGNyb3NhaXJTaGlwTWludGVkOwogIHVpbnQyNTYgcHVibGljIHByb21ldGhldXNWb3VjaGVyc01pbnRlZDsKICB1aW50MjU2IHB1YmxpYyBpbnRyZXBpZFZvdWNoZXJzTWludGVkOwogIHVpbnQyNTYgcHVibGljIGNyb3NhaXJWb3VjaGVyc01pbnRlZDsKCiAgLy8gQGRldiBtYXBwaW5nIHdoaWNoIGhvbGRzIGFsbCB0aGUgcG9zc2libGUgYWRkcmVzc2VzIHdoaWNoIGFyZSBhbGxvd2VkIHRvIGludGVyYWN0IHdpdGggdGhlIGNvbnRyYWN0CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBhcHByb3ZlZEFkZHJlc3NMaXN0OwoKICAvLyBAZGV2IG1hcHBpbmcgaG9sZHMgdGhlIHByZVNhbGVJdGVtIC0+IG93bmVyIGRldGFpbHMKICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBwcmVTYWxlSXRlbUluZGV4VG9Pd25lcjsKCiAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAvLyAgVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgb3duZXJzaGlwVG9rZW5Db3VudDsKCiAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gcHJlU2FsZUl0ZW0gdG8gYW4gYWRkcmVzcyB0aGF0IGhhcyBiZWVuIGFwcHJvdmVkIHRvIGNhbGwKICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBFYWNoIFNoaXAgY2FuIG9ubHkgaGF2ZSBvbmUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgdHJhbnNmZXIKICAvLy8gIGF0IGFueSB0aW1lLiBBIHplcm8gdmFsdWUgbWVhbnMgbm8gYXBwcm92YWwgaXMgb3V0c3RhbmRpbmcuCiAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgcHJlU2FsZUl0ZW1JbmRleFRvQXBwcm92ZWQ7CgogIC8vLyBAZGV2IEEgbWFwcGluZyBvZiBwcmVTYWxlSXRlbSBUeXBlIHRvIFR5cGUgU2VxdWVuY2UgTnVtYmVyIHRvIENvbGxlY3RpYmxlCiAgLy8vIDAgLSBWb3VjaGVyCiAgLy8vIDEgLSBQcm9tZXRoZXVzCiAgLy8vIDIgLSBDcm9zYWlyCiAgLy8vIDMgLSBJbnRyZXBpZAogIG1hcHBpbmcgKHVpbnQyNTYgPT4gbWFwcGluZyAodWludDI1NiA9PiBtYXBwaW5nICggdWludDI1NiA9PiB1aW50MjU2ICkgKSApIHB1YmxpYyBwcmVTYWxlSXRlbVR5cGVUb1NlcXVlbmNlSWRUb0NvbGxlY3RpYmxlOwoKICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBQcmUgU2FsZSBJdGVtIFR5cGUgSURzIHRvIHRoZSBTZXF1cWVuY2UgTnVtYmVyIC4KICAvLy8gMCAtIFZvdWNoZXIKICAvLy8gMSAtIFByb21ldGhldXMKICAvLy8gMiAtIENyb3NhaXIKICAvLy8gMyAtIEludHJlcGlkCiAgbWFwcGluZyAodWludDI1NiA9PiBtYXBwaW5nICggdWludDI1NiA9PiB1aW50MjU2ICkgKSBwdWJsaWMgcHJlU2FsZUl0ZW1UeXBlVG9Db2xsZWN0aWJsZUNvdW50OwoKICAvLy8gQG5vdGljZSBJbnRyb3NwZWN0aW9uIGludGVyZmFjZSBhcyBwZXIgRVJDLTE2NSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkuCiAgLy8vICBSZXR1cm5zIHRydWUgZm9yIGFueSBzdGFuZGFyZGl6ZWQgaW50ZXJmYWNlcyBpbXBsZW1lbnRlZCBieSB0aGlzIGNvbnRyYWN0LiBXZSBpbXBsZW1lbnQKICAvLy8gIEVSQy0xNjUgKG9idmlvdXNseSEpIGFuZCBFUkMtNzIxLgogIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkKICB7CiAgICAgIC8vIERFQlVHIE9OTFkKICAgICAgLy9yZXF1aXJlKChJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID09IDB4MDFmZmM5YTcpICYmIChJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID09IDB4OWEyMDQ4M2QpKTsKICAgICAgcmV0dXJuICgoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUpIHx8IChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q29sbGVjdGlibGVEZXRhaWxzKHVpbnQyNTYgX2Fzc2V0SWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2IGFzc2V0SWQsIHVpbnQyNTYgc2VxdWVuY2VJZCwgdWludDI1NiBjb2xsZWN0aWJsZVR5cGUsIHVpbnQyNTYgY29sbGVjdGlibGVDbGFzcywgYm9vbCBpc1JlZGVlbWVkLCBhZGRyZXNzIG93bmVyKSB7CiAgICBDU0NQcmVTYWxlSXRlbSBtZW1vcnkgX09iaiA9IGFsbFByZVNhbGVJdGVtc1tfYXNzZXRJZF07CiAgICBhc3NldElkID0gX2Fzc2V0SWQ7CiAgICBzZXF1ZW5jZUlkID0gX09iai5hc3NldElkOwogICAgY29sbGVjdGlibGVUeXBlID0gX09iai5jb2xsZWN0aWJsZVR5cGU7CiAgICBjb2xsZWN0aWJsZUNsYXNzID0gX09iai5jb2xsZWN0aWJsZUNsYXNzOwogICAgb3duZXIgPSBfT2JqLm93bmVyOwogICAgaXNSZWRlZW1lZCA9IF9PYmouaXNSZWRlZW1lZDsKICB9CiAgCiAgLyoqKiBQVUJMSUMgRlVOQ1RJT05TICoqKi8KICAvLy8gQG5vdGljZSBHcmFudCBhbm90aGVyIGFkZHJlc3MgdGhlIHJpZ2h0IHRvIHRyYW5zZmVyIHRva2VuIHZpYSB0YWtlT3duZXJzaGlwKCkgYW5kIHRyYW5zZmVyRnJvbSgpLgogIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGJlIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwuIFBhc3MgYWRkcmVzcygwKSB0bwogIC8vLyAgY2xlYXIgYWxsIGFwcHJvdmFscy4KICAvLy8gQHBhcmFtIF9hc3NldElkIFRoZSBJRCBvZiB0aGUgVG9rZW4gdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfYXNzZXRJZCkgcHVibGljIHsKICAgIC8vIENhbGxlciBtdXN0IG93biB0b2tlbi4KICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2Fzc2V0SWQpKTsKICAgIHByZVNhbGVJdGVtSW5kZXhUb0FwcHJvdmVkW19hc3NldElkXSA9IF90bzsKCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF9hc3NldElkKTsKICB9CgogIC8vLyBGb3IgcXVlcnlpbmcgYmFsYW5jZSBvZiBhIHBhcnRpY3VsYXIgYWNjb3VudAogIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZvciBiYWxhbmNlIHF1ZXJ5CiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICB9CgogIGZ1bmN0aW9uIGltcGxlbWVudHNFUkM3MjEoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBGb3IgcXVlcnlpbmcgb3duZXIgb2YgdG9rZW4KICAvLy8gQHBhcmFtIF9hc3NldElkIFRoZSB0b2tlbklEIGZvciBvd25lciBpbnF1aXJ5CiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX2Fzc2V0SWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpIHsKICAgIG93bmVyID0gcHJlU2FsZUl0ZW1JbmRleFRvT3duZXJbX2Fzc2V0SWRdOwogICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKDApKTsKICB9CgogIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gU1lNQk9MOwogIH0KCiAgLy8vIEBub3RpY2UgQWxsb3cgcHJlLWFwcHJvdmVkIHVzZXIgdG8gdGFrZSBvd25lcnNoaXAgb2YgYSB0b2tlbgogIC8vLyBAcGFyYW0gX2Fzc2V0SWQgVGhlIElEIG9mIHRoZSBUb2tlbiB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX2Fzc2V0SWQpIHB1YmxpYyB7CiAgICBhZGRyZXNzIG5ld093bmVyID0gbXNnLnNlbmRlcjsKICAgIGFkZHJlc3Mgb2xkT3duZXIgPSBwcmVTYWxlSXRlbUluZGV4VG9Pd25lcltfYXNzZXRJZF07CgogICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgcmVxdWlyZShfYWRkcmVzc05vdE51bGwobmV3T3duZXIpKTsKCiAgICAvLyBNYWtpbmcgc3VyZSB0cmFuc2ZlciBpcyBhcHByb3ZlZAogICAgcmVxdWlyZShfYXBwcm92ZWQobmV3T3duZXIsIF9hc3NldElkKSk7CgogICAgX3RyYW5zZmVyKG9sZE93bmVyLCBuZXdPd25lciwgX2Fzc2V0SWQpOwogIH0KCiAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIHdob3NlIHNoaXBzIHRva2VucyB3ZSBhcmUgaW50ZXJlc3RlZCBpbi4KICAvLy8gQGRldiBUaGlzIG1ldGhvZCBNVVNUIE5FVkVSIGJlIGNhbGxlZCBieSBzbWFydCBjb250cmFjdCBjb2RlLiBGaXJzdCwgaXQncyBmYWlybHkKICAvLy8gIGV4cGVuc2l2ZSAoaXQgd2Fsa3MgdGhlIGVudGlyZSBDU0NTaGlwcyBhcnJheSBsb29raW5nIGZvciBlbW9qaXMgYmVsb25naW5nIHRvIG93bmVyKSwKICAvLy8gIGJ1dCBpdCBhbHNvIHJldHVybnMgYSBkeW5hbWljIGFycmF5LCB3aGljaCBpcyBvbmx5IHN1cHBvcnRlZCBmb3Igd2ViMyBjYWxscywgYW5kCiAgLy8vICBub3QgY29udHJhY3QtdG8tY29udHJhY3QgY2FsbHMuCiAgZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBvd25lclRva2VucykgewogICAgdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgogICAgaWYgKHRva2VuQ291bnQgPT0gMCkgewogICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgfSBlbHNlIHsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10odG9rZW5Db3VudCk7CiAgICAgICAgdWludDI1NiB0b3RhbFNoaXBzID0gdG90YWxTdXBwbHkoKSArIDE7CiAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICAgIC8vIFdlIGNvdW50IG9uIHRoZSBmYWN0IHRoYXQgYWxsIENTQyBTaGlwIENvbGxlY3RpYmxlIGhhdmUgSURzIHN0YXJ0aW5nIGF0IDAgYW5kIGluY3JlYXNpbmcKICAgICAgICAvLyBzZXF1ZW50aWFsbHkgdXAgdG8gdGhlIHRvdGFsIGNvdW50LgogICAgICAgIHVpbnQyNTYgX2Fzc2V0SWQ7CgogICAgICAgIGZvciAoX2Fzc2V0SWQgPSAwOyBfYXNzZXRJZCA8IHRvdGFsU2hpcHM7IF9hc3NldElkKyspIHsKICAgICAgICAgICAgaWYgKHByZVNhbGVJdGVtSW5kZXhUb093bmVyW19hc3NldElkXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBfYXNzZXRJZDsKICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgfQoKICAvLy8gRm9yIHF1ZXJ5aW5nIHRvdGFsU3VwcGx5IG9mIHRva2VuCiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpIHsKICAgIHJldHVybiBhbGxQcmVTYWxlSXRlbXMubGVuZ3RoIC0gMTsgLy9SZW1vdmVkIDAgaW5kZXgKICB9CgogIC8vLyBPd25lciBpbml0YXRlcyB0aGUgdHJhbnNmZXIgb2YgdGhlIHRva2VuIHRvIGFub3RoZXIgYWNjb3VudAogIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIGZvciB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQgdG8uCiAgLy8vIEBwYXJhbSBfYXNzZXRJZCBUaGUgSUQgb2YgdGhlIFRva2VuIHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hc3NldElkKSBwdWJsaWMgewogICAgcmVxdWlyZShfYWRkcmVzc05vdE51bGwoX3RvKSk7CiAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9hc3NldElkKSk7CgogICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Fzc2V0SWQpOwogIH0KCiAgLy8vIFRoaXJkLXBhcnR5IGluaXRpYXRlcyB0cmFuc2ZlciBvZiB0b2tlbiBmcm9tIGFkZHJlc3MgX2Zyb20gdG8gYWRkcmVzcyBfdG8KICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGZvciB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQgZnJvbS4KICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBmb3IgdGhlIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkIHRvLgogIC8vLyBAcGFyYW0gX2Fzc2V0SWQgVGhlIElEIG9mIHRoZSBUb2tlbiB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Fzc2V0SWQpIHB1YmxpYyB7CiAgICByZXF1aXJlKF9vd25zKF9mcm9tLCBfYXNzZXRJZCkpOwogICAgcmVxdWlyZShfYXBwcm92ZWQoX3RvLCBfYXNzZXRJZCkpOwogICAgcmVxdWlyZShfYWRkcmVzc05vdE51bGwoX3RvKSk7CgogICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hc3NldElkKTsKICB9CgogIC8qKiogUFJJVkFURSBGVU5DVElPTlMgKioqLwogIC8vLyBAZGV2ICBTYWZldHkgY2hlY2sgb24gX3RvIGFkZHJlc3MgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgZnVuY3Rpb24gX2FkZHJlc3NOb3ROdWxsKGFkZHJlc3MgX3RvKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBfdG8gIT0gYWRkcmVzcygwKTsKICB9CgogIC8vLyBAZGV2ICBGb3IgY2hlY2tpbmcgYXBwcm92YWwgb2YgdHJhbnNmZXIgZm9yIGFkZHJlc3MgX3RvCiAgZnVuY3Rpb24gX2FwcHJvdmVkKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hc3NldElkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBwcmVTYWxlSXRlbUluZGV4VG9BcHByb3ZlZFtfYXNzZXRJZF0gPT0gX3RvOwogIH0KCiAgLy8vIEBkZXYgRm9yIGNyZWF0aW5nIENTQyBDb2xsZWN0aWJsZQogIGZ1bmN0aW9uIF9jcmVhdGVDb2xsZWN0aWJsZShieXRlczMyIF9jb2xsZWN0aWJsZU5hbWUsIHVpbnQyNTYgX2NvbGxlY3RpYmxlVHlwZSwgdWludDI1NiBfY29sbGVjdGlibGVDbGFzcykgaW50ZXJuYWwgcmV0dXJucyh1aW50MjU2KSB7CiAgICB1aW50MjU2IF9zZXF1ZW5jZUlkID0gdWludDI1NihwcmVTYWxlSXRlbVR5cGVUb0NvbGxlY3RpYmxlQ291bnRbX2NvbGxlY3RpYmxlVHlwZV1bX2NvbGxlY3RpYmxlQ2xhc3NdKSArIDE7CgogICAgLy8gVGhlc2UgcmVxdWlyZXMgYXJlIG5vdCBzdHJpY3RseSBuZWNlc3NhcnksIG91ciBjYWxsaW5nIGNvZGUgc2hvdWxkIG1ha2UKICAgIC8vIHN1cmUgdGhhdCB0aGVzZSBjb25kaXRpb25zIGFyZSBuZXZlciBicm9rZW4uCiAgICByZXF1aXJlKF9zZXF1ZW5jZUlkID09IHVpbnQyNTYodWludDMyKF9zZXF1ZW5jZUlkKSkpOwogICAgCiAgICBDU0NQcmVTYWxlSXRlbSBtZW1vcnkgX2NvbGxlY3RpYmxlT2JqID0gQ1NDUHJlU2FsZUl0ZW0oCiAgICAgIF9zZXF1ZW5jZUlkLAogICAgICBfY29sbGVjdGlibGVOYW1lLAogICAgICAwLAogICAgICBfY29sbGVjdGlibGVUeXBlLAogICAgICBfY29sbGVjdGlibGVDbGFzcywKICAgICAgYWRkcmVzcygwKSwKICAgICAgZmFsc2UKICAgICk7CgogICAgdWludDI1NiBuZXdDb2xsZWN0aWJsZUlkID0gYWxsUHJlU2FsZUl0ZW1zLnB1c2goX2NvbGxlY3RpYmxlT2JqKSAtIDE7CiAgICAKICAgIHByZVNhbGVJdGVtVHlwZVRvU2VxdWVuY2VJZFRvQ29sbGVjdGlibGVbX2NvbGxlY3RpYmxlVHlwZV1bX2NvbGxlY3RpYmxlQ2xhc3NdW19zZXF1ZW5jZUlkXSA9IG5ld0NvbGxlY3RpYmxlSWQ7CiAgICBwcmVTYWxlSXRlbVR5cGVUb0NvbGxlY3RpYmxlQ291bnRbX2NvbGxlY3RpYmxlVHlwZV1bX2NvbGxlY3RpYmxlQ2xhc3NdID0gX3NlcXVlbmNlSWQ7CgogICAgLy8gZW1pdCBDcmVhdGVkIGV2ZW50CiAgICAvLyBDb2xsZWN0aWJsZUNyZWF0ZWQoYWRkcmVzcyBvd25lciwgdWludDI1NiBnbG9iYWxJZCwgdWludDI1NiBjb2xsZWN0aWJsZVR5cGUsIHVpbnQyNTYgY29sbGVjdGlibGVDbGFzcywgdWludDI1NiBzZXF1ZW5jZUlkLCBieXRlczMyWzZdIGF0dHJpYnV0ZXMsIGJvb2wgaXNSZWRlZW1lZCk7CiAgICBDb2xsZWN0aWJsZUNyZWF0ZWQoYWRkcmVzcyh0aGlzKSwgbmV3Q29sbGVjdGlibGVJZCwgX2NvbGxlY3RpYmxlVHlwZSwgX2NvbGxlY3RpYmxlQ2xhc3MsIF9zZXF1ZW5jZUlkLCBfY29sbGVjdGlibGVPYmouY29sbGVjdGlibGVOYW1lLCBmYWxzZSk7CiAgICAKICAgIC8vIFRoaXMgd2lsbCBhc3NpZ24gb3duZXJzaGlwLCBhbmQgYWxzbyBlbWl0IHRoZSBUcmFuc2ZlciBldmVudCBhcwogICAgLy8gcGVyIEVSQzcyMSBkcmFmdAogICAgX3RyYW5zZmVyKGFkZHJlc3MoMCksIGFkZHJlc3ModGhpcyksIG5ld0NvbGxlY3RpYmxlSWQpOwogICAgCiAgICByZXR1cm4gbmV3Q29sbGVjdGlibGVJZDsKICB9CgogIC8vLyBDaGVjayBmb3IgdG9rZW4gb3duZXJzaGlwCiAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBjbGFpbWFudCwgdWludDI1NiBfYXNzZXRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gY2xhaW1hbnQgPT0gcHJlU2FsZUl0ZW1JbmRleFRvT3duZXJbX2Fzc2V0SWRdOwogIH0KCiAgLy8vIEBkZXYgQXNzaWducyBvd25lcnNoaXAgb2YgYSBzcGVjaWZpYyBFbW9qaSB0byBhbiBhZGRyZXNzLgogIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYXNzZXRJZCkgaW50ZXJuYWwgewogICAgLy8gVXBkYXRpbmcgdGhlIG93bmVyIGRldGFpbHMgb2YgdGhlIHNoaXAKICAgIENTQ1ByZVNhbGVJdGVtIG1lbW9yeSBfc2hpcE9iaiA9IGFsbFByZVNhbGVJdGVtc1tfYXNzZXRJZF07CiAgICBfc2hpcE9iai5vd25lciA9IF90bzsKICAgIGFsbFByZVNhbGVJdGVtc1tfYXNzZXRJZF0gPSBfc2hpcE9iajsKCiAgICAvLyBTaW5jZSB0aGUgbnVtYmVyIG9mIGVtb2ppcyBpcyBjYXBwZWQgdG8gMl4zMiB3ZSBjYW4ndCBvdmVyZmxvdyB0aGlzCiAgICBvd25lcnNoaXBUb2tlbkNvdW50W190b10rKzsKCiAgICAvL3RyYW5zZmVyIG93bmVyc2hpcAogICAgcHJlU2FsZUl0ZW1JbmRleFRvT3duZXJbX2Fzc2V0SWRdID0gX3RvOwoKICAgIC8vIFdoZW4gY3JlYXRpbmcgbmV3IGVtb2ppcyBfZnJvbSBpcyAweDAsIGJ1dCB3ZSBjYW4ndCBhY2NvdW50IHRoYXQgYWRkcmVzcy4KICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX2Zyb21dLS07CiAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICBkZWxldGUgcHJlU2FsZUl0ZW1JbmRleFRvQXBwcm92ZWRbX2Fzc2V0SWRdOwogICAgfQoKICAgIC8vIEVtaXQgdGhlIHRyYW5zZmVyIGV2ZW50LgogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Fzc2V0SWQpOwogIH0KCiAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBjdXJyZW50bHkgaGFzIHRyYW5zZmVyQXBwcm92YWwgZm9yIGEgcGFydGljdWxhciBDU0NQcmVTYWxlSXRlbS4KICAvLy8gMCBpcyBhIHZhbGlkIHZhbHVlIGFzIGl0IHdpbGwgYmUgdGhlIHN0YXJ0ZXIKICBmdW5jdGlvbiBfYXBwcm92ZWRGb3IoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX2Fzc2V0SWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICByZXR1cm4gcHJlU2FsZUl0ZW1JbmRleFRvQXBwcm92ZWRbX2Fzc2V0SWRdID09IF9jbGFpbWFudDsKICB9CgogIGZ1bmN0aW9uIF9nZXRDb2xsZWN0aWJsZURldGFpbHMgKHVpbnQyNTYgX2Fzc2V0SWQpIGludGVybmFsIHZpZXcgcmV0dXJucyhDU0NQcmVTYWxlSXRlbSkgewogICAgQ1NDUHJlU2FsZUl0ZW0gc3RvcmFnZSBfT2JqID0gYWxsUHJlU2FsZUl0ZW1zW19hc3NldElkXTsKICAgIHJldHVybiBfT2JqOwogIH0KCiAgLy8vIEBkZXYgSGVscHMgaW4gZmV0Y2hpbmcgdGhlIGF0dHJpYnV0ZXMgb2YgdGhlIHNoaXAgZGVwZW5kaW5nIG9uIHRoZSBzaGlwCiAgLy8vIGFzc2V0SWQgOiBUaGUgYWN0dWFsIEVSQzcyMSBBc3NldCBJRAogIC8vLyBzZXF1ZW5jZUlkIDogSW5kZXggdy5yLnQgU2hpcCB0eXBlCiAgZnVuY3Rpb24gZ2V0U2hpcERldGFpbHModWludDI1NiBfc2VxdWVuY2VJZCwgdWludDI1NiBfc2hpcENsYXNzKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgdWludDI1NiBhc3NldElkLAogICAgdWludDI1NiBzZXF1ZW5jZUlkLAogICAgc3RyaW5nIHNoaXBOYW1lLAogICAgdWludDI1NiBjb2xsZWN0aWJsZUNsYXNzLAogICAgdWludDI1NiBib3VnaHRUaW1lc3RhbXAsCiAgICBhZGRyZXNzIG93bmVyCiAgICApIHsgIAogICAgdWludDI1NiBfYXNzZXRJZCA9IHByZVNhbGVJdGVtVHlwZVRvU2VxdWVuY2VJZFRvQ29sbGVjdGlibGVbMV1bX3NoaXBDbGFzc11bX3NlcXVlbmNlSWRdOwoKICAgIENTQ1ByZVNhbGVJdGVtIHN0b3JhZ2UgX2NvbGxlY3RpYmxlT2JqID0gYWxsUHJlU2FsZUl0ZW1zW19hc3NldElkXTsKICAgIHJlcXVpcmUoX2NvbGxlY3RpYmxlT2JqLmNvbGxlY3RpYmxlVHlwZSA9PSAxKTsKCiAgICBhc3NldElkID0gX2Fzc2V0SWQ7CiAgICBzZXF1ZW5jZUlkID0gX3NlcXVlbmNlSWQ7CiAgICBzaGlwTmFtZSA9IGJ5dGVzMzJUb1N0cmluZyhfY29sbGVjdGlibGVPYmouY29sbGVjdGlibGVOYW1lKTsKICAgIGNvbGxlY3RpYmxlQ2xhc3MgPSBfY29sbGVjdGlibGVPYmouY29sbGVjdGlibGVDbGFzczsKICAgIGJvdWdodFRpbWVzdGFtcCA9IF9jb2xsZWN0aWJsZU9iai5ib3VnaHRUaW1lc3RhbXA7CiAgICBvd25lciA9IF9jb2xsZWN0aWJsZU9iai5vd25lcjsKICB9CgogIC8vLyBAZGV2IEhlbHBzIGluIGZldGNoaW5nIGluZm9ybWF0aW9uIHJlZ2FyZGluZyBhIFZvdWNoZXIKICAvLy8gYXNzZXRJZCA6IFRoZSBhY3R1YWwgRVJDNzIxIEFzc2V0IElECiAgLy8vIHNlcXVlbmNlSWQgOiBJbmRleCB3LnIudCBWb3VjaGVyIFR5cGUKICBmdW5jdGlvbiBnZXRWb3VjaGVyRGV0YWlscyh1aW50MjU2IF9zZXF1ZW5jZUlkLCB1aW50MjU2IF92b3VjaGVyQ2xhc3MpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICB1aW50MjU2IGFzc2V0SWQsCiAgICB1aW50MjU2IHNlcXVlbmNlSWQsCiAgICB1aW50MjU2IGJvdWdodFRpbWVzdGFtcCwKICAgIHVpbnQyNTYgdm91Y2hlckNsYXNzLAogICAgYWRkcmVzcyBvd25lcgogICAgKSB7CiAgICB1aW50MjU2IF9hc3NldElkID0gcHJlU2FsZUl0ZW1UeXBlVG9TZXF1ZW5jZUlkVG9Db2xsZWN0aWJsZVswXVtfdm91Y2hlckNsYXNzXVtfc2VxdWVuY2VJZF07CgogICAgQ1NDUHJlU2FsZUl0ZW0gc3RvcmFnZSBfY29sbGVjdGlibGVPYmogPSBhbGxQcmVTYWxlSXRlbXNbX2Fzc2V0SWRdOwogICAgcmVxdWlyZShfY29sbGVjdGlibGVPYmouY29sbGVjdGlibGVUeXBlID09IDApOwoKICAgIGFzc2V0SWQgPSBfYXNzZXRJZDsKICAgIHNlcXVlbmNlSWQgPSBfc2VxdWVuY2VJZDsKICAgIGJvdWdodFRpbWVzdGFtcCA9IF9jb2xsZWN0aWJsZU9iai5ib3VnaHRUaW1lc3RhbXA7CiAgICB2b3VjaGVyQ2xhc3MgPSBfY29sbGVjdGlibGVPYmouY29sbGVjdGlibGVDbGFzczsKICAgIG93bmVyID0gX2NvbGxlY3RpYmxlT2JqLm93bmVyOwogIH0KCiAgZnVuY3Rpb24gX2lzQWN0aXZlKHVpbnQyNTYgX2Fzc2V0SWQpIGludGVybmFsIHJldHVybnMoYm9vbCkgewogICAgQ1NDUHJlU2FsZUl0ZW0gbWVtb3J5IF9PYmogPSBhbGxQcmVTYWxlSXRlbXNbX2Fzc2V0SWRdOwogICAgcmV0dXJuIChfT2JqLmJvdWdodFRpbWVzdGFtcCA9PSAwKTsKICB9Cn0KCi8qIEx1Y2lkIFNpZ2h0LCBJbmMuIEVSQy03MjEgQ1NDIENvbGxlY3RpbGJlIFNhbGUgQ29udHJhY3QuIAogKiBAdGl0bGUgQ1NDQ29sbGVjdGlibGVTYWxlCiAqIEBhdXRob3IgRmF6cmkgWnViYWlyICYgRmFyaGFuIEtod2FqYSAoTHVjaWQgU2lnaHQsIEluYy4pCiAqLwpjb250cmFjdCBDU0NDb2xsZWN0aWJsZVNhbGUgaXMgQ1NDQ29sbGVjdGlibGVCYXNlIHsKICBldmVudCBDb2xsZWN0aWJsZUJvdWdodCAodWludDI1NiBfYXNzZXRJZCwgYWRkcmVzcyBvd25lcik7CiAgZXZlbnQgUHJpY2VVcGRhdGVkICh1aW50MjU2IGNvbGxlY3RpYmxlQ2xhc3MsIHVpbnQyNTYgbmV3UHJpY2UsIHVpbnQyNTYgb2xkUHJpY2UpOwoKICAvLyAgU0hJUCBEQVRBVFlQRVMgJiBDT05TVEFOVFMKICAvLyBAZGV2IHNoaXAgUHJpY2VzICYgcHJpY2UgY2FwCiAgdWludDI1NiBwdWJsaWMgUFJPTUVUSEVVU19TSElQX1BSSUNFID0gMC4yNSBldGhlcjsKICB1aW50MjU2IHB1YmxpYyBJTlRSRVBJRF9TSElQX1BSSUNFID0gMC4wMDUgZXRoZXI7CiAgdWludDI1NiBwdWJsaWMgQ1JPU0FJUl9TSElQX1BSSUNFID0gMC4xIGV0aGVyOwoKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQUk9NRVRIRVVTX01BWF9QUklDRSA9IDAuODUgZXRoZXI7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSU5UUkVQSURfTUFYX1BSSUNFID0gMC4yNSBldGhlcjsKICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBDUk9TQUlSX01BWF9QUklDRSA9IDAuNSBldGhlcjsKCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJPTUVUSEVVU19QUklDRV9JTkNSRU1FTlQgPSAwLjA1IGV0aGVyOwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IElOVFJFUElEX1BSSUNFX0lOQ1JFTUVOVCA9IDAuMDAyIGV0aGVyOwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IENST1NBSVJfUFJJQ0VfSU5DUkVNRU5UID0gMC4wMSBldGhlcjsKCiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJPTUVUSEVVU19QUklDRV9USFJFU0hPTEQgPSAwLjg1IGV0aGVyOwogIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IElOVFJFUElEX1BSSUNFX1RIUkVTSE9MRCA9IDAuMjUgZXRoZXI7CiAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgQ1JPU0FJUl9QUklDRV9USFJFU0hPTEQgPSAwLjUgZXRoZXI7CgogIHVpbnQyNTYgcHVibGljIHByb21ldGhldXNTb2xkQ291bnQ7CiAgdWludDI1NiBwdWJsaWMgaW50cmVwaWRTb2xkQ291bnQ7CiAgdWludDI1NiBwdWJsaWMgY3Jvc2FpclNvbGRDb3VudDsKCiAgLy8gIFZPVUNIRVIgREFUQVRZUEVTICYgQ09OU1RBTlRTCiAgdWludDI1NiBwdWJsaWMgUFJPTUVUSEVVU19WT1VDSEVSX1BSSUNFID0gMC43NSBldGhlcjsKICB1aW50MjU2IHB1YmxpYyBJTlRSRVBJRF9WT1VDSEVSX1BSSUNFID0gMC4yIGV0aGVyOwogIHVpbnQyNTYgcHVibGljIENST1NBSVJfVk9VQ0hFUl9QUklDRSA9IDAuMzUgZXRoZXI7CgogIHVpbnQyNTYgcHVibGljIHByb21ldGhldXNWb3VjaGVyU29sZENvdW50OwogIHVpbnQyNTYgcHVibGljIGNyb3NhaXJWb3VjaGVyU29sZENvdW50OwogIHVpbnQyNTYgcHVibGljIGludHJlcGlkVm91Y2hlclNvbGRDb3VudDsKICAKICAvLy8gQGRldiBNYXBwaW5nIGNyZWF0ZWQgc3RvcmUgdGhlIGFtb3VudCBvZiB2YWx1ZSBhIHdhbGxldCBhZGRyZXNzIHVzZWQgdG8gYnV5IGFzc2V0cwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBhZGRyZXNzVG9WYWx1ZTsKCiAgLy8vIEBkZXYgTWFwcGluZyB0byBob2xkZSB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGkuZS4gYWRkcnMgLT4gY29sbGVjdGlibGVUeXBlIC0+IGNvbGxlY3RpYmxlQ2xhc3MgLT4gYmFsYW5jZQogIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQyNTYgPT4gbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSkpIGFkZHJlc3NUb0NvbGxlY3RpYmxlVHlwZUJhbGFuY2U7CgogIGZ1bmN0aW9uIF9iaWQodWludDI1NiBfYXNzZXRJZCwgdWludDI1NiBfcHJpY2UsdWludDI1NiBfY29sbGVjdGlibGVUeXBlLHVpbnQyNTYgX2NvbGxlY3RpYmxlQ2xhc3MsIGFkZHJlc3MgX2J1eWVyKSBpbnRlcm5hbCB7CiAgICBDU0NQcmVTYWxlSXRlbSBtZW1vcnkgX09iaiA9IGFsbFByZVNhbGVJdGVtc1tfYXNzZXRJZF07CgogICAgaWYoX2NvbGxlY3RpYmxlVHlwZSA9PSAxICYmIF9jb2xsZWN0aWJsZUNsYXNzID09IDEpIHsKICAgICAgcmVxdWlyZShfcHJpY2UgPT0gUFJPTUVUSEVVU19TSElQX1BSSUNFKTsKICAgICAgX09iai5vd25lciA9IF9idXllcjsKICAgICAgX09iai5ib3VnaHRUaW1lc3RhbXAgPSBub3c7CgogICAgICBhZGRyZXNzVG9WYWx1ZVtfYnV5ZXJdICs9IF9wcmljZTsKCiAgICAgIHByb21ldGhldXNTb2xkQ291bnQrKzsKICAgICAgaWYocHJvbWV0aGV1c1NvbGRDb3VudCAlIDEwID09IDApewogICAgICAgIGlmKFBST01FVEhFVVNfU0hJUF9QUklDRSA8IFBST01FVEhFVVNfUFJJQ0VfVEhSRVNIT0xEKXsKICAgICAgICAgIFBST01FVEhFVVNfU0hJUF9QUklDRSArPSAgUFJPTUVUSEVVU19QUklDRV9JTkNSRU1FTlQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYoX2NvbGxlY3RpYmxlVHlwZSA9PSAxICYmIF9jb2xsZWN0aWJsZUNsYXNzID09IDIpIHsKICAgICAgcmVxdWlyZShfcHJpY2UgPT0gQ1JPU0FJUl9TSElQX1BSSUNFKTsKICAgICAgX09iai5vd25lciA9IF9idXllcjsKICAgICAgX09iai5ib3VnaHRUaW1lc3RhbXAgPSBub3c7CgogICAgICBhZGRyZXNzVG9WYWx1ZVtfYnV5ZXJdICs9IF9wcmljZTsKCiAgICAgIGNyb3NhaXJTb2xkQ291bnQrKzsKICAgICAgaWYoY3Jvc2FpclNvbGRDb3VudCAlIDEwID09IDApewogICAgICAgIGlmKENST1NBSVJfU0hJUF9QUklDRSA8IENST1NBSVJfUFJJQ0VfVEhSRVNIT0xEKXsKICAgICAgICAgIENST1NBSVJfU0hJUF9QUklDRSArPSBDUk9TQUlSX1BSSUNFX0lOQ1JFTUVOVDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZihfY29sbGVjdGlibGVUeXBlID09IDEgJiYgX2NvbGxlY3RpYmxlQ2xhc3MgPT0gMykgewogICAgICByZXF1aXJlKF9wcmljZSA9PSBJTlRSRVBJRF9TSElQX1BSSUNFKTsKICAgICAgX09iai5vd25lciA9IF9idXllcjsKICAgICAgX09iai5ib3VnaHRUaW1lc3RhbXAgPSBub3c7CgogICAgICBhZGRyZXNzVG9WYWx1ZVtfYnV5ZXJdICs9IF9wcmljZTsKCiAgICAgIGludHJlcGlkU29sZENvdW50Kys7CiAgICAgIGlmKGludHJlcGlkU29sZENvdW50ICUgMTAgPT0gMCl7CiAgICAgICAgaWYoSU5UUkVQSURfU0hJUF9QUklDRSA8IElOVFJFUElEX1BSSUNFX1RIUkVTSE9MRCl7CiAgICAgICAgICBJTlRSRVBJRF9TSElQX1BSSUNFICs9IElOVFJFUElEX1BSSUNFX0lOQ1JFTUVOVDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZihfY29sbGVjdGlibGVUeXBlID09IDAgJiZfY29sbGVjdGlibGVDbGFzcyA9PSAxKSB7CiAgICAgICAgcmVxdWlyZShfcHJpY2UgPT0gUFJPTUVUSEVVU19WT1VDSEVSX1BSSUNFKTsKICAgICAgICBfT2JqLm93bmVyID0gX2J1eWVyOwogICAgICAgIF9PYmouYm91Z2h0VGltZXN0YW1wID0gbm93OwoKICAgICAgICBhZGRyZXNzVG9WYWx1ZVtfYnV5ZXJdICs9IF9wcmljZTsKCiAgICAgICAgcHJvbWV0aGV1c1ZvdWNoZXJTb2xkQ291bnQrKzsKICAgICAgfQoKICAgICAgaWYoX2NvbGxlY3RpYmxlVHlwZSA9PSAwICYmIF9jb2xsZWN0aWJsZUNsYXNzID09IDIpIHsKICAgICAgICByZXF1aXJlKF9wcmljZSA9PSBDUk9TQUlSX1ZPVUNIRVJfUFJJQ0UpOwogICAgICAgIF9PYmoub3duZXIgPSBfYnV5ZXI7CiAgICAgICAgX09iai5ib3VnaHRUaW1lc3RhbXAgPSBub3c7CgogICAgICAgIGFkZHJlc3NUb1ZhbHVlW19idXllcl0gKz0gX3ByaWNlOwoKICAgICAgICBjcm9zYWlyVm91Y2hlclNvbGRDb3VudCsrOwogICAgICB9CiAgICAgIAogICAgICBpZihfY29sbGVjdGlibGVUeXBlID09IDAgJiYgX2NvbGxlY3RpYmxlQ2xhc3MgPT0gMykgewogICAgICAgIHJlcXVpcmUoX3ByaWNlID09IElOVFJFUElEX1ZPVUNIRVJfUFJJQ0UpOwogICAgICAgIF9PYmoub3duZXIgPSBfYnV5ZXI7CiAgICAgICAgX09iai5ib3VnaHRUaW1lc3RhbXAgPSBub3c7CgogICAgICAgIGFkZHJlc3NUb1ZhbHVlW19idXllcl0gKz0gX3ByaWNlOwoKICAgICAgICBpbnRyZXBpZFZvdWNoZXJTb2xkQ291bnQrKzsKICAgICAgfQoKICAgIGFkZHJlc3NUb0NvbGxlY3RpYmxlVHlwZUJhbGFuY2VbX2J1eWVyXVtfY29sbGVjdGlibGVUeXBlXVtfY29sbGVjdGlibGVDbGFzc10rKzsKCiAgICBDb2xsZWN0aWJsZUJvdWdodChfYXNzZXRJZCwgX2J1eWVyKTsKICB9CgogIGZ1bmN0aW9uIGdldENvbGxlY3RpYmxlVHlwZUJhbGFuY2UoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2NvbGxlY3RpYmxlVHlwZSwgdWludDI1NiBfY29sbGVjdGlibGVDbGFzcykgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgIHJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwogICAgcmV0dXJuIGFkZHJlc3NUb0NvbGxlY3RpYmxlVHlwZUJhbGFuY2VbX293bmVyXVtfY29sbGVjdGlibGVUeXBlXVtfY29sbGVjdGlibGVDbGFzc107CiAgfQoKICBmdW5jdGlvbiBnZXRDb2xsZWN0aWJsZVByaWNlKHVpbnQyNTYgX2NvbGxlY3RpYmxlVHlwZSwgdWludDI1NiBfY29sbGVjdGlibGVDbGFzcykgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYgX3ByaWNlKXsKCiAgICAvLyBGb3IgU2hpcHMKICAgIGlmKF9jb2xsZWN0aWJsZVR5cGUgPT0gMSAmJiBfY29sbGVjdGlibGVDbGFzcyA9PSAxKSB7CiAgICAgIHJldHVybiBQUk9NRVRIRVVTX1NISVBfUFJJQ0U7CiAgICB9CgogICAgaWYoX2NvbGxlY3RpYmxlVHlwZSA9PSAxICYmIF9jb2xsZWN0aWJsZUNsYXNzID09IDIpIHsKICAgICAgcmV0dXJuIENST1NBSVJfU0hJUF9QUklDRTsKICAgIH0KCiAgICBpZihfY29sbGVjdGlibGVUeXBlID09IDEgJiYgX2NvbGxlY3RpYmxlQ2xhc3MgPT0gMykgewogICAgICByZXR1cm4gSU5UUkVQSURfU0hJUF9QUklDRTsKICAgIH0KCiAgICAvLyBGb3IgVm91Y2hlcnMKICAgIGlmKF9jb2xsZWN0aWJsZVR5cGUgPT0gMCAmJiBfY29sbGVjdGlibGVDbGFzcyA9PSAxKSB7CiAgICAgIHJldHVybiBQUk9NRVRIRVVTX1ZPVUNIRVJfUFJJQ0U7CiAgICB9CgogICAgaWYoX2NvbGxlY3RpYmxlVHlwZSA9PSAwICYmIF9jb2xsZWN0aWJsZUNsYXNzID09IDIpIHsKICAgICAgcmV0dXJuIENST1NBSVJfVk9VQ0hFUl9QUklDRTsKICAgIH0KCiAgICBpZihfY29sbGVjdGlibGVUeXBlID09IDAgJiYgX2NvbGxlY3RpYmxlQ2xhc3MgPT0gMykgewogICAgICByZXR1cm4gSU5UUkVQSURfVk9VQ0hFUl9QUklDRTsKICAgIH0KICB9Cn0KCi8qIEx1Y2lkIFNpZ2h0LCBJbmMuIEVSQy03MjEgQ29sbGVjdGlibGVzLiAKICogQHRpdGxlIExTTkZUIC0gTHVjaWQgU2lnaHQsIEluYy4gTm9uLUZ1bmdpYmxlIFRva2VuCiAqIEBhdXRob3IgRmF6cmkgWnViYWlyICYgRmFyaGFuIEtod2FqYSAoTHVjaWQgU2lnaHQsIEluYy4pCiAqLwpjb250cmFjdCBDU0NQcmVTYWxlTWFuYWdlciBpcyBDU0NDb2xsZWN0aWJsZVNhbGUgewogIGV2ZW50IFJlZnVuZENsYWltZWQoYWRkcmVzcyBvd25lciwgdWludDI1NiByZWZ1bmRWYWx1ZSk7CgogIC8vIFNoaXAgTmFtZXMKICBzdHJpbmcgcHJpdmF0ZSBjb25zdGFudCBwcm9tZXRoZXVzU2hpcE5hbWUgPSAiVnVsY2FuIEhhcnZlc3RlciI7CiAgc3RyaW5nIHByaXZhdGUgY29uc3RhbnQgY3Jvc2FpclNoaXBOYW1lID0gIlBob2VuaXggQ3J1aXNlciI7CiAgc3RyaW5nIHByaXZhdGUgY29uc3RhbnQgaW50cmVwaWRTaGlwTmFtZSA9ICJSZWFwZXIgSW50ZXJjZXB0b3IiOwoKICBib29sIENTQ1ByZVNhbGVJbml0ID0gZmFsc2U7CgogIC8vLyBAZGV2IENvbnN0cnVjdG9yIGNyZWF0ZXMgYSByZWZlcmVuY2UgdG8gdGhlIE5GVCAoRVJDNzIxKSBvd25lcnNoaXAgY29udHJhY3QKICBmdW5jdGlvbiBDU0NQcmVTYWxlTWFuYWdlcigpIHB1YmxpYyB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBhZGRyZXNzKDApKTsKICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgZXJyb3IgPSBmYWxzZTsKICAgICAgZ2FtZU1hbmFnZXJQcmltYXJ5ID0gbXNnLnNlbmRlcjsKICB9CgogIGZ1bmN0aW9uIGFkZFRvQXBwcm92ZWRBZGRyZXNzIChhZGRyZXNzIF9uZXdBZGRyKSBvbmx5R2FtZU1hbmFnZXIgewogICAgcmVxdWlyZShfbmV3QWRkciAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoIWFwcHJvdmVkQWRkcmVzc0xpc3RbX25ld0FkZHJdKTsKICAgIGFwcHJvdmVkQWRkcmVzc0xpc3RbX25ld0FkZHJdID0gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZUZyb21BcHByb3ZlZEFkZHJlc3MgKGFkZHJlc3MgX25ld0FkZHIpIG9ubHlHYW1lTWFuYWdlciB7CiAgICByZXF1aXJlKF9uZXdBZGRyICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShhcHByb3ZlZEFkZHJlc3NMaXN0W19uZXdBZGRyXSk7CiAgICBhcHByb3ZlZEFkZHJlc3NMaXN0W19uZXdBZGRyXSA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICB9CgogIC8vLyBAZGV2IEJpZCBGdW5jdGlvbiB3aGljaCBjYWxsIHRoZSBpbnRlcm5jYWwgYmlkIGZ1bmN0aW9uCiAgLy8vIGFmdGVyIGRvaW5nIGFsbCB0aGUgcHJlLWNoZWNrcyByZXF1aXJlZCB0byBpbml0aWF0ZSBhIGJpZAogIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF9jb2xsZWN0aWJsZVR5cGUsIHVpbnQyNTYgX2NvbGxlY3RpYmxlQ2xhc3MpIGV4dGVybmFsIHBheWFibGUgewogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpOwoKICAgIHJlcXVpcmUoX2NvbGxlY3RpYmxlVHlwZSA+PSAwICYmIF9jb2xsZWN0aWJsZVR5cGUgPD0gMSk7CgogICAgcmVxdWlyZShfaXNBY3RpdmUoX2Fzc2V0SWQpKTsKCiAgICBieXRlczMyIGNvbGxlY3RpYmxlTmFtZTsKCiAgICBpZihfY29sbGVjdGlibGVUeXBlID09IDApewogICAgICBjb2xsZWN0aWJsZU5hbWUgPSBieXRlczMyKCJOb05hbWVGb3JWb3VjaGVyIik7CiAgICAgIGlmKF9jb2xsZWN0aWJsZUNsYXNzID09IDEpewogICAgICAgIHJlcXVpcmUocHJvbWV0aGV1c1ZvdWNoZXJzTWludGVkIDwgUFJPTUVUSEVVU19WT1VDSEVSX0xJTUlUKTsKICAgICAgICBjb2xsZWN0aWJsZU5hbWUgPSBzdHJpbmdUb0J5dGVzMzIocHJvbWV0aGV1c1NoaXBOYW1lKTsKICAgICAgICBwcm9tZXRoZXVzVm91Y2hlcnNNaW50ZWQrKzsKICAgICAgfQogICAgICAKICAgICAgaWYoX2NvbGxlY3RpYmxlQ2xhc3MgPT0gMil7CiAgICAgICAgcmVxdWlyZShjcm9zYWlyVm91Y2hlcnNNaW50ZWQgPCBDUk9TQUlSX1ZPVUNIRVJfTElNSVQpOwogICAgICAgIGNyb3NhaXJWb3VjaGVyc01pbnRlZCsrOwogICAgICB9CgogICAgICBpZihfY29sbGVjdGlibGVDbGFzcyA9PSAzKXsKICAgICAgICByZXF1aXJlKGludHJlcGlkVm91Y2hlclNvbGRDb3VudCA8IElOVFJFUElEX1ZPVUNIRVJfTElNSVQpOwogICAgICAgIGludHJlcGlkVm91Y2hlcnNNaW50ZWQrKzsKICAgICAgfQogICAgfQoKICAgIGlmKF9jb2xsZWN0aWJsZVR5cGUgPT0gMSl7CiAgICAgIGlmKF9jb2xsZWN0aWJsZUNsYXNzID09IDEpewogICAgICAgIHJlcXVpcmUocHJvbWV0aGV1c1NoaXBNaW50ZWQgPCBQUk9NRVRIRVVTX1NISVBfTElNSVQpOwogICAgICAgIGNvbGxlY3RpYmxlTmFtZSA9IHN0cmluZ1RvQnl0ZXMzMihwcm9tZXRoZXVzU2hpcE5hbWUpOwogICAgICAgIHByb21ldGhldXNTaGlwTWludGVkKys7CiAgICAgIH0KICAgICAgCiAgICAgIGlmKF9jb2xsZWN0aWJsZUNsYXNzID09IDIpewogICAgICAgIHJlcXVpcmUoY3Jvc2FpclNoaXBNaW50ZWQgPCBDUk9TQUlSX1ZPVUNIRVJfTElNSVQpOwogICAgICAgIGNvbGxlY3RpYmxlTmFtZSA9IHN0cmluZ1RvQnl0ZXMzMihjcm9zYWlyU2hpcE5hbWUpOwogICAgICAgIGNyb3NhaXJTaGlwTWludGVkKys7CiAgICAgIH0KCiAgICAgIGlmKF9jb2xsZWN0aWJsZUNsYXNzID09IDMpewogICAgICAgIHJlcXVpcmUoaW50cmVwaWRTaGlwTWludGVkIDwgSU5UUkVQSURfU0hJUF9MSU1JVCk7CiAgICAgICAgY29sbGVjdGlibGVOYW1lID0gc3RyaW5nVG9CeXRlczMyKGludHJlcGlkU2hpcE5hbWUpOwogICAgICAgIGludHJlcGlkU2hpcE1pbnRlZCsrOwogICAgICB9CiAgICB9CgogICAgdWludDI1NiBfYXNzZXRJZCA9IF9jcmVhdGVDb2xsZWN0aWJsZShjb2xsZWN0aWJsZU5hbWUsIF9jb2xsZWN0aWJsZVR5cGUsIF9jb2xsZWN0aWJsZUNsYXNzKTsgCgogICAgQ1NDUHJlU2FsZUl0ZW0gbWVtb3J5IF9PYmogPSBhbGxQcmVTYWxlSXRlbXNbX2Fzc2V0SWRdOwoKICAgIF9iaWQoX2Fzc2V0SWQsIG1zZy52YWx1ZSwgX09iai5jb2xsZWN0aWJsZVR5cGUsIF9PYmouY29sbGVjdGlibGVDbGFzcywgbXNnLnNlbmRlcik7CiAgICAKICAgIF90cmFuc2ZlcihhZGRyZXNzKHRoaXMpLCBtc2cuc2VuZGVyLCBfYXNzZXRJZCk7CiAgfQoKICAvLy8gQGRldiBCaWQgRnVuY3Rpb24gd2hpY2ggY2FsbCB0aGUgaW50ZXJuY2FsIGJpZCBmdW5jdGlvbgogIC8vLyBhZnRlciBkb2luZyBhbGwgdGhlIHByZS1jaGVja3MgcmVxdWlyZWQgdG8gaW5pdGlhdGUgYSBiaWQKICBmdW5jdGlvbiBjcmVhdGVSZWZlcnJhbEdpdmVBd2F5cyh1aW50MjU2IF9jb2xsZWN0aWJsZVR5cGUsIHVpbnQyNTYgX2NvbGxlY3RpYmxlQ2xhc3MsIGFkZHJlc3MgX3RvQWRkcmVzcykgb25seUdhbWVNYW5hZ2VyIGV4dGVybmFsIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKTsKCiAgICByZXF1aXJlKF9jb2xsZWN0aWJsZVR5cGUgPj0gMCAmJiBfY29sbGVjdGlibGVUeXBlIDw9IDEpOwoKICAgIGJ5dGVzMzIgY29sbGVjdGlibGVOYW1lOwoKICAgIGlmKF9jb2xsZWN0aWJsZVR5cGUgPT0gMCl7CiAgICAgIGNvbGxlY3RpYmxlTmFtZSA9IGJ5dGVzMzIoIlJlZmVycmFsR2l2ZUF3YXlWb3VjaGVyIik7CiAgICAgIGlmKF9jb2xsZWN0aWJsZUNsYXNzID09IDEpewogICAgICAgIGNvbGxlY3RpYmxlTmFtZSA9IHN0cmluZ1RvQnl0ZXMzMihwcm9tZXRoZXVzU2hpcE5hbWUpOwogICAgICB9CiAgICAgIAogICAgICBpZihfY29sbGVjdGlibGVDbGFzcyA9PSAyKXsKICAgICAgICBjcm9zYWlyVm91Y2hlcnNNaW50ZWQrKzsKICAgICAgfQoKICAgICAgaWYoX2NvbGxlY3RpYmxlQ2xhc3MgPT0gMyl7CiAgICAgICAgaW50cmVwaWRWb3VjaGVyc01pbnRlZCsrOwogICAgICB9CiAgICB9CgogICAgaWYoX2NvbGxlY3RpYmxlVHlwZSA9PSAxKXsKICAgICAgaWYoX2NvbGxlY3RpYmxlQ2xhc3MgPT0gMSl7CiAgICAgICAgY29sbGVjdGlibGVOYW1lID0gc3RyaW5nVG9CeXRlczMyKHByb21ldGhldXNTaGlwTmFtZSk7CiAgICAgIH0KICAgICAgCiAgICAgIGlmKF9jb2xsZWN0aWJsZUNsYXNzID09IDIpewogICAgICAgIGNvbGxlY3RpYmxlTmFtZSA9IHN0cmluZ1RvQnl0ZXMzMihjcm9zYWlyU2hpcE5hbWUpOwogICAgICB9CgogICAgICBpZihfY29sbGVjdGlibGVDbGFzcyA9PSAzKXsKICAgICAgICBjb2xsZWN0aWJsZU5hbWUgPSBzdHJpbmdUb0J5dGVzMzIoaW50cmVwaWRTaGlwTmFtZSk7CiAgICAgIH0KICAgIH0KCiAgICB1aW50MjU2IF9hc3NldElkID0gX2NyZWF0ZUNvbGxlY3RpYmxlKGNvbGxlY3RpYmxlTmFtZSwgX2NvbGxlY3RpYmxlVHlwZSwgX2NvbGxlY3RpYmxlQ2xhc3MpOyAKCiAgICBDU0NQcmVTYWxlSXRlbSBtZW1vcnkgX09iaiA9IGFsbFByZVNhbGVJdGVtc1tfYXNzZXRJZF07CiAgICAKICAgIF90cmFuc2ZlcihhZGRyZXNzKHRoaXMpLCBfdG9BZGRyZXNzLCBfYXNzZXRJZCk7CiAgfQoKICAvLy8gQGRldiBPdmVycmlkZSB1bnBhdXNlIHNvIGl0IHJlcXVpcmVzIGFsbCBleHRlcm5hbCBjb250cmFjdCBhZGRyZXNzZXMKICAvLy8gIHRvIGJlIHNldCBiZWZvcmUgY29udHJhY3QgY2FuIGJlIHVucGF1c2VkLiBBbHNvLCB3ZSBjYW4ndCBoYXZlCiAgLy8vICBuZXdDb250cmFjdEFkZHJlc3Mgc2V0IGVpdGhlciwgYmVjYXVzZSB0aGVuIHRoZSBjb250cmFjdCB3YXMgdXBncmFkZWQuCiAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gd2UgY2FuIGNhbGwgc3VwZXIudW5wYXVzZQogIC8vLyAgd2l0aG91dCB1c2luZyBhbiBleHBlbnNpdmUgQ0FMTC4KICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlHYW1lTWFuYWdlciB3aGVuUGF1c2VkIHsKICAgICAgLy8gQWN0dWFsbHkgdW5wYXVzZSB0aGUgY29udHJhY3QuCiAgICAgIHN1cGVyLnVucGF1c2UoKTsKICB9CgogIC8vLyBAZGV2IFJlbW92ZSBhbGwgRXRoZXIgZnJvbSB0aGUgY29udHJhY3QsIHdoaWNoIGlzIHRoZSBvd25lcidzIGN1dHMKICAvLy8gIGFzIHdlbGwgYXMgYW55IEV0aGVyIHNlbnQgZGlyZWN0bHkgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MuCiAgLy8vICBBbHdheXMgdHJhbnNmZXJzIHRvIHRoZSBORlQgKEVSQzcyMSkgY29udHJhY3QsIGJ1dCBjYW4gYmUgY2FsbGVkIGVpdGhlciBieQogIC8vLyAgdGhlIG93bmVyIG9yIHRoZSBORlQgKEVSQzcyMSkgY29udHJhY3QuCiAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgb25seUJhbmtlciB7CiAgICAgIC8vIFdlIGFyZSB1c2luZyB0aGlzIGJvb2xlYW4gbWV0aG9kIHRvIG1ha2Ugc3VyZSB0aGF0IGV2ZW4gaWYgb25lIGZhaWxzIGl0IHdpbGwgc3RpbGwgd29yawogICAgICBiYW5rTWFuYWdlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogIH0KCiAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoYWRkcmVzcyBfb3duZXJBZGRyZXNzKSB3aGVuRXJyb3IgewogICAgdWludDI1NiByZWZ1bmRWYWx1ZSA9IGFkZHJlc3NUb1ZhbHVlW19vd25lckFkZHJlc3NdOwogICAgYWRkcmVzc1RvVmFsdWVbX293bmVyQWRkcmVzc10gPSAwOwoKICAgIF9vd25lckFkZHJlc3MudHJhbnNmZXIocmVmdW5kVmFsdWUpOwogICAgUmVmdW5kQ2xhaW1lZChfb3duZXJBZGRyZXNzLCByZWZ1bmRWYWx1ZSk7CiAgfQogIAogIGZ1bmN0aW9uIHByZVNhbGVJbml0KCkgb25seUdhbWVNYW5hZ2VyIHsKICAgIHJlcXVpcmUoIUNTQ1ByZVNhbGVJbml0KTsKICAgIHJlcXVpcmUoYWxsUHJlU2FsZUl0ZW1zLmxlbmd0aCA9PSAwKTsKICAgICAgCiAgICBDU0NQcmVTYWxlSW5pdCA9IHRydWU7CgogICAgLy9GaWxsIGluIGluZGV4IDAgdG8gbnVsbCByZXF1ZXN0cwogICAgQ1NDUHJlU2FsZUl0ZW0gbWVtb3J5IF9PYmogPSBDU0NQcmVTYWxlSXRlbSgwLCBzdHJpbmdUb0J5dGVzMzIoIkR1bW15QXNzZXQiKSwgMCwgMCwgMCwgYWRkcmVzcyh0aGlzKSwgdHJ1ZSk7CiAgICBhbGxQcmVTYWxlSXRlbXMucHVzaChfT2JqKTsKICB9CgogIGZ1bmN0aW9uIGlzUmVkZWVtZWQodWludDI1NiBfYXNzZXRJZCkgewogICAgcmVxdWlyZShhcHByb3ZlZEFkZHJlc3NMaXN0W21zZy5zZW5kZXJdKTsKCiAgICBDU0NQcmVTYWxlSXRlbSBtZW1vcnkgX09iaiA9IGFsbFByZVNhbGVJdGVtc1tfYXNzZXRJZF07CiAgICBfT2JqLmlzUmVkZWVtZWQgPSB0cnVlOwoKICAgIGFsbFByZVNhbGVJdGVtc1tfYXNzZXRJZF0gPSBfT2JqOwogIH0KfQ=='.
	

]
