Class {
	#name : #SRTe5568ad7f29e67890bfe8f76a0f50b4113a62c77,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe5568ad7f29e67890bfe8f76a0f50b4113a62c77 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyBGaWxlOiBjb250cmFjdHMvQmRwQmFzZURhdGEuc29sCgpjb250cmFjdCBCZHBCYXNlRGF0YSB7CgoJYWRkcmVzcyBwdWJsaWMgb3duZXJBZGRyZXNzOwoKCWFkZHJlc3MgcHVibGljIG1hbmFnZXJBZGRyZXNzOwoKCWFkZHJlc3NbMTZdIHB1YmxpYyBjb250cmFjdHM7CgoJYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoJYm9vbCBwdWJsaWMgc2V0dXBDb21wbGV0ZWQgPSBmYWxzZTsKCglieXRlczggcHVibGljIHZlcnNpb247Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvbGlicmFyaWVzL0JkcENvbnRyYWN0cy5zb2wKCmxpYnJhcnkgQmRwQ29udHJhY3RzIHsKCglmdW5jdGlvbiBnZXRCZHBFbnRyeVBvaW50KGFkZHJlc3NbMTZdIF9jb250cmFjdHMpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBfY29udHJhY3RzWzBdOwoJfQoKCWZ1bmN0aW9uIGdldEJkcENvbnRyb2xsZXIoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIF9jb250cmFjdHNbMV07Cgl9CgoJZnVuY3Rpb24gZ2V0QmRwQ29udHJvbGxlckhlbHBlcihhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1szXTsKCX0KCglmdW5jdGlvbiBnZXRCZHBEYXRhU3RvcmFnZShhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1s0XTsKCX0KCglmdW5jdGlvbiBnZXRCZHBJbWFnZVN0b3JhZ2UoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIF9jb250cmFjdHNbNV07Cgl9CgoJZnVuY3Rpb24gZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1s2XTsKCX0KCglmdW5jdGlvbiBnZXRCZHBQcmljZVN0b3JhZ2UoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIF9jb250cmFjdHNbN107Cgl9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvQmRwQmFzZS5zb2wKCmNvbnRyYWN0IEJkcEJhc2UgaXMgQmRwQmFzZURhdGEgewoKCW1vZGlmaWVyIG9ubHlPd25lcigpIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXJBZGRyZXNzKTsKCQlfOwoJfQoKCW1vZGlmaWVyIG9ubHlBdXRob3JpemVkKCkgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lckFkZHJlc3MgfHwgbXNnLnNlbmRlciA9PSBtYW5hZ2VyQWRkcmVzcyk7CgkJXzsKCX0KCgltb2RpZmllciB3aGlsZUNvbnRyYWN0SXNBY3RpdmUoKSB7CgkJcmVxdWlyZSghcGF1c2VkICYmIHNldHVwQ29tcGxldGVkKTsKCQlfOwoJfQoKCW1vZGlmaWVyIHN0b3JhZ2VBY2Nlc3NDb250cm9sKCkgewoJCXJlcXVpcmUoCgkJCSghIHNldHVwQ29tcGxldGVkICYmIChtc2cuc2VuZGVyID09IG93bmVyQWRkcmVzcyB8fCBtc2cuc2VuZGVyID09IG1hbmFnZXJBZGRyZXNzKSkKCQkJfHwgKHNldHVwQ29tcGxldGVkICYmICFwYXVzZWQgJiYgKG1zZy5zZW5kZXIgPT0gQmRwQ29udHJhY3RzLmdldEJkcEVudHJ5UG9pbnQoY29udHJhY3RzKSkpCgkJKTsKCQlfOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVyKGFkZHJlc3MgX25ld093bmVyKSBleHRlcm5hbCBvbmx5T3duZXIgewoJCXJlcXVpcmUoX25ld093bmVyICE9IGFkZHJlc3MoMCkpOwoJCW93bmVyQWRkcmVzcyA9IF9uZXdPd25lcjsKCX0KCglmdW5jdGlvbiBzZXRNYW5hZ2VyKGFkZHJlc3MgX25ld01hbmFnZXIpIGV4dGVybmFsIG9ubHlPd25lciB7CgkJcmVxdWlyZShfbmV3TWFuYWdlciAhPSBhZGRyZXNzKDApKTsKCQltYW5hZ2VyQWRkcmVzcyA9IF9uZXdNYW5hZ2VyOwoJfQoKCWZ1bmN0aW9uIHNldENvbnRyYWN0cyhhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBleHRlcm5hbCBvbmx5T3duZXIgewoJCWNvbnRyYWN0cyA9IF9jb250cmFjdHM7Cgl9CgoJZnVuY3Rpb24gcGF1c2UoKSBleHRlcm5hbCBvbmx5QXV0aG9yaXplZCB7CgkJcGF1c2VkID0gdHJ1ZTsKCX0KCglmdW5jdGlvbiB1bnBhdXNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKCQlwYXVzZWQgPSBmYWxzZTsKCX0KCglmdW5jdGlvbiBzZXRTZXR1cENvbXBsZXRlZCgpIGV4dGVybmFsIG9ubHlPd25lciB7CgkJc2V0dXBDb21wbGV0ZWQgPSB0cnVlOwoJfQoKCWZ1bmN0aW9uIGtpbGwoKSBwdWJsaWMgb25seU93bmVyIHsKCQlzZWxmZGVzdHJ1Y3Qob3duZXJBZGRyZXNzKTsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9saWJyYXJpZXMvU2FmZU1hdGguc29sCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCgkvKioKCSogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCgkqLwoJZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQlpZiAoYSA9PSAwKSB7CgkJCXJldHVybiAwOwoJCX0KCQl1aW50MjU2IGMgPSBhICogYjsKCQlhc3NlcnQoYyAvIGEgPT0gYik7CgkJcmV0dXJuIGM7Cgl9CgoJLyoqCgkqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCgkqLwoJZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQkvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKCQl1aW50MjU2IGMgPSBhIC8gYjsKCQkvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAoJCXJldHVybiBjOwoJfQoKCS8qKgoJKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KCSovCglmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewoJCWFzc2VydChiIDw9IGEpOwoJCXJldHVybiBhIC0gYjsKCX0KCgkvKioKCSogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCgkqLwoJZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQl1aW50MjU2IGMgPSBhICsgYjsKCQlhc3NlcnQoYyA+PSBhKTsKCQlyZXR1cm4gYzsKCX0KfQoKLy8gRmlsZTogY29udHJhY3RzL3N0b3JhZ2UvQmRwRGF0YVN0b3JhZ2Uuc29sCgpjb250cmFjdCBCZHBEYXRhU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCglzdHJ1Y3QgUmVnaW9uIHsKCQl1aW50MjU2IHgxOwoJCXVpbnQyNTYgeTE7CgkJdWludDI1NiB4MjsKCQl1aW50MjU2IHkyOwoJCXVpbnQyNTYgY3VycmVudEltYWdlSWQ7CgkJdWludDI1NiBuZXh0SW1hZ2VJZDsKCQl1aW50OFsxMjhdIHVybDsKCQl1aW50MjU2IGN1cnJlbnRQaXhlbFByaWNlOwoJCXVpbnQyNTYgYmxvY2tVcGRhdGVkQXQ7CgkJdWludDI1NiB1cGRhdGVkQXQ7CgkJdWludDI1NiBwdXJjaGFzZWRBdDsKCQl1aW50MjU2IHB1cmNoYXNlZFBpeGVsUHJpY2U7Cgl9CgoJdWludDI1NiBwdWJsaWMgbGFzdFJlZ2lvbklkID0gMDsKCgltYXBwaW5nICh1aW50MjU2ID0+IFJlZ2lvbikgcHVibGljIGRhdGE7CgoKCWZ1bmN0aW9uIGdldExhc3RSZWdpb25JZCgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gbGFzdFJlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIGdldE5leHRSZWdpb25JZCgpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCByZXR1cm5zICh1aW50MjU2KSB7CgkJbGFzdFJlZ2lvbklkID0gbGFzdFJlZ2lvbklkLmFkZCgxKTsKCQlyZXR1cm4gbGFzdFJlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIGRlbGV0ZVJlZ2lvbkRhdGEodWludDI1NiBfaWQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGVsZXRlIGRhdGFbX2lkXTsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25Db29yZGluYXRlcyh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NikgewoJCXJldHVybiAoZGF0YVtfaWRdLngxLCBkYXRhW19pZF0ueTEsIGRhdGFbX2lkXS54MiwgZGF0YVtfaWRdLnkyKTsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25Db29yZGluYXRlcyh1aW50MjU2IF9pZCwgdWludDI1NiBfeDEsIHVpbnQyNTYgX3kxLCB1aW50MjU2IF94MiwgdWludDI1NiBfeTIpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLngxID0gX3gxOwoJCWRhdGFbX2lkXS55MSA9IF95MTsKCQlkYXRhW19pZF0ueDIgPSBfeDI7CgkJZGF0YVtfaWRdLnkyID0gX3kyOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbkN1cnJlbnRJbWFnZUlkKHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5jdXJyZW50SW1hZ2VJZDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25DdXJyZW50SW1hZ2VJZCh1aW50MjU2IF9pZCwgdWludDI1NiBfY3VycmVudEltYWdlSWQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLmN1cnJlbnRJbWFnZUlkID0gX2N1cnJlbnRJbWFnZUlkOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbk5leHRJbWFnZUlkKHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5uZXh0SW1hZ2VJZDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25OZXh0SW1hZ2VJZCh1aW50MjU2IF9pZCwgdWludDI1NiBfbmV4dEltYWdlSWQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLm5leHRJbWFnZUlkID0gX25leHRJbWFnZUlkOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblVybCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDhbMTI4XSkgewoJCXJldHVybiBkYXRhW19pZF0udXJsOwoJfQoKCWZ1bmN0aW9uIHNldFJlZ2lvblVybCh1aW50MjU2IF9pZCwgdWludDhbMTI4XSBfdXJsKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS51cmwgPSBfdXJsOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbkN1cnJlbnRQaXhlbFByaWNlKHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5jdXJyZW50UGl4ZWxQcmljZTsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25DdXJyZW50UGl4ZWxQcmljZSh1aW50MjU2IF9pZCwgdWludDI1NiBfY3VycmVudFBpeGVsUHJpY2UpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLmN1cnJlbnRQaXhlbFByaWNlID0gX2N1cnJlbnRQaXhlbFByaWNlOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbkJsb2NrVXBkYXRlZEF0KHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5ibG9ja1VwZGF0ZWRBdDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25CbG9ja1VwZGF0ZWRBdCh1aW50MjU2IF9pZCwgdWludDI1NiBfYmxvY2tVcGRhdGVkQXQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLmJsb2NrVXBkYXRlZEF0ID0gX2Jsb2NrVXBkYXRlZEF0OwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblVwZGF0ZWRBdCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0udXBkYXRlZEF0OwoJfQoKCWZ1bmN0aW9uIHNldFJlZ2lvblVwZGF0ZWRBdCh1aW50MjU2IF9pZCwgdWludDI1NiBfdXBkYXRlZEF0KSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS51cGRhdGVkQXQgPSBfdXBkYXRlZEF0OwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblB1cmNoYXNlZEF0KHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5wdXJjaGFzZWRBdDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25QdXJjaGFzZWRBdCh1aW50MjU2IF9pZCwgdWludDI1NiBfcHVyY2hhc2VkQXQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLnB1cmNoYXNlZEF0ID0gX3B1cmNoYXNlZEF0OwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblVwZGF0ZWRBdFB1cmNoYXNlZEF0KHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2IF91cGRhdGVkQXQsIHVpbnQyNTYgX3B1cmNoYXNlZEF0KSB7CgkJcmV0dXJuIChkYXRhW19pZF0udXBkYXRlZEF0LCBkYXRhW19pZF0ucHVyY2hhc2VkQXQpOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblB1cmNoYXNlUGl4ZWxQcmljZSh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0ucHVyY2hhc2VkUGl4ZWxQcmljZTsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25QdXJjaGFzZWRQaXhlbFByaWNlKHVpbnQyNTYgX2lkLCB1aW50MjU2IF9wdXJjaGFzZWRQaXhlbFByaWNlKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS5wdXJjaGFzZWRQaXhlbFByaWNlID0gX3B1cmNoYXNlZFBpeGVsUHJpY2U7Cgl9CgoJZnVuY3Rpb24gQmRwRGF0YVN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9zdG9yYWdlL0JkcFByaWNlU3RvcmFnZS5zb2wKCmNvbnRyYWN0IEJkcFByaWNlU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1aW50NjRbMTAwMV0gcHVibGljIHByaWNlUG9pbnRzOwoKCXVpbnQyNTYgcHVibGljIHByaWNlUG9pbnRzTGVuZ3RoID0gMDsKCglhZGRyZXNzIHB1YmxpYyBmb3J3YXJkUHVyY2hhc2VGZWVzVG8gPSBhZGRyZXNzKDApOwoKCWFkZHJlc3MgcHVibGljIGZvcndhcmRVcGRhdGVGZWVzVG8gPSBhZGRyZXNzKDApOwoKCglmdW5jdGlvbiBnZXRQcmljZVBvaW50c0xlbmd0aCgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gcHJpY2VQb2ludHNMZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0UHJpY2VQb2ludCh1aW50MjU2IF9pKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIHByaWNlUG9pbnRzW19pXTsKCX0KCglmdW5jdGlvbiBzZXRQcmljZVBvaW50cyh1aW50NjRbXSBfcHJpY2VQb2ludHMpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJcHJpY2VQb2ludHNMZW5ndGggPSAwOwoJCWFwcGVuZFByaWNlUG9pbnRzKF9wcmljZVBvaW50cyk7Cgl9CgoJZnVuY3Rpb24gYXBwZW5kUHJpY2VQb2ludHModWludDY0W10gX3ByaWNlUG9pbnRzKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWZvciAodWludCBpID0gMDsgaSA8IF9wcmljZVBvaW50cy5sZW5ndGg7IGkrKykgewoJCQlwcmljZVBvaW50c1twcmljZVBvaW50c0xlbmd0aCsrXSA9IF9wcmljZVBvaW50c1tpXTsKCQl9Cgl9CgoJZnVuY3Rpb24gZ2V0Rm9yd2FyZFB1cmNoYXNlRmVlc1RvKCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBmb3J3YXJkUHVyY2hhc2VGZWVzVG87Cgl9CgoJZnVuY3Rpb24gc2V0Rm9yd2FyZFB1cmNoYXNlRmVlc1RvKGFkZHJlc3MgX2ZvcndhcmRQdXJjaGFzZUZlZXNUbykgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlmb3J3YXJkUHVyY2hhc2VGZWVzVG8gPSBfZm9yd2FyZFB1cmNoYXNlRmVlc1RvOwoJfQoKCWZ1bmN0aW9uIGdldEZvcndhcmRVcGRhdGVGZWVzVG8oKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIGZvcndhcmRVcGRhdGVGZWVzVG87Cgl9CgoJZnVuY3Rpb24gc2V0Rm9yd2FyZFVwZGF0ZUZlZXNUbyhhZGRyZXNzIF9mb3J3YXJkVXBkYXRlRmVlc1RvKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWZvcndhcmRVcGRhdGVGZWVzVG8gPSBfZm9yd2FyZFVwZGF0ZUZlZXNUbzsKCX0KCglmdW5jdGlvbiBCZHBQcmljZVN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9saWJyYXJpZXMvQmRwQ2FsY3VsYXRvci5zb2wKCmxpYnJhcnkgQmRwQ2FsY3VsYXRvciB7CgoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoJZnVuY3Rpb24gY2FsY3VsYXRlQXJlYShhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiBfYXJlYSwgdWludDI1NiBfd2lkdGgsIHVpbnQyNTYgX2hlaWdodCkgewoJCXZhciAoeDEsIHkxLCB4MiwgeTIpID0gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRSZWdpb25Db29yZGluYXRlcyhfcmVnaW9uSWQpOwoJCV93aWR0aCA9IHgyIC0geDEgKyAxOwoJCV9oZWlnaHQgPSB5MiAtIHkxICsgMTsKCQlfYXJlYSA9IF93aWR0aCAqIF9oZWlnaHQ7Cgl9CgoJZnVuY3Rpb24gY291bnRQdXJjaGFzZWRQaXhlbHMoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiBfY291bnQpIHsKCQl2YXIgbGFzdFJlZ2lvbklkID0gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRMYXN0UmVnaW9uSWQoKTsKCQlmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPD0gbGFzdFJlZ2lvbklkOyBpKyspIHsKCQkJaWYoQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRSZWdpb25QdXJjaGFzZWRBdChpKSA+IDApIHsgLy8gcmVnaW9uIGlzIHB1cmNoYXNlZAoJCQkJdmFyIChhcmVhLCwpID0gY2FsY3VsYXRlQXJlYShfY29udHJhY3RzLCBpKTsKCQkJCV9jb3VudCArPSBhcmVhOwoJCQl9CgkJfQoJfQoKCWZ1bmN0aW9uIGNhbGN1bGF0ZUN1cnJlbnRNYXJrZXRQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMpIHZpZXcgcHVibGljIHJldHVybnModWludCkgewoJCXJldHVybiBjYWxjdWxhdGVNYXJrZXRQaXhlbFByaWNlKF9jb250cmFjdHMsIGNvdW50UHVyY2hhc2VkUGl4ZWxzKF9jb250cmFjdHMpKTsKCX0KCglmdW5jdGlvbiBjYWxjdWxhdGVNYXJrZXRQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQgX3BpeGVsc1NvbGQpIHZpZXcgcHVibGljIHJldHVybnModWludCkgewoJCXZhciBwcmljZVBvaW50c0xlbmd0aCA9IEJkcFByaWNlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwUHJpY2VTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRQcmljZVBvaW50c0xlbmd0aCgpOwoJCXVpbnQgbW9kID0gX3BpeGVsc1NvbGQgJSAoMTAwMDAwMCAvIChwcmljZVBvaW50c0xlbmd0aCAtIDEpKTsKCQl1aW50IGRpdiA9IF9waXhlbHNTb2xkICogKHByaWNlUG9pbnRzTGVuZ3RoIC0gMSkgLyAxMDAwMDAwOwoJCXZhciBkaXZQb2ludCA9IEJkcFByaWNlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwUHJpY2VTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRQcmljZVBvaW50KGRpdik7CgkJaWYobW9kID09IDApIHJldHVybiBkaXZQb2ludDsKCQlyZXR1cm4gZGl2UG9pbnQgKyBtb2QgKiAoQmRwUHJpY2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBQcmljZVN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFByaWNlUG9pbnQoZGl2KzEpIC0gZGl2UG9pbnQpICogKHByaWNlUG9pbnRzTGVuZ3RoIC0gMSkgLyAxMDAwMDAwOwoJfQoKCWZ1bmN0aW9uIGNhbGN1bGF0ZUF2ZXJhZ2VQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQgX2EsIHVpbnQgX2IpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQgX3ByaWNlKSB7CgkJX3ByaWNlID0gKGNhbGN1bGF0ZU1hcmtldFBpeGVsUHJpY2UoX2NvbnRyYWN0cywgX2EpICsgY2FsY3VsYXRlTWFya2V0UGl4ZWxQcmljZShfY29udHJhY3RzLCBfYikpIC8gMjsKCX0KCgkvKiogQ3VycmVudCBtYXJrZXQgcHJpY2UgcGVyIHBpeGVsIGZvciB0aGlzIHJlZ2lvbiBpZiBpdCBpcyB0aGUgZmlyc3Qgc2FsZSBvZiB0aGlzIHJlZ2lvbgoJICAqLwoJZnVuY3Rpb24gY2FsY3VsYXRlUmVnaW9uSW5pdGlhbFNhbGVQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQyNTYgX3JlZ2lvbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmVxdWlyZShCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFJlZ2lvblVwZGF0ZWRBdChfcmVnaW9uSWQpID4gMCk7IC8vIHJlZ2lvbiBleGlzdHMKCQl2YXIgcHVyY2hhc2VkUGl4ZWxzID0gY291bnRQdXJjaGFzZWRQaXhlbHMoX2NvbnRyYWN0cyk7CgkJdmFyIChhcmVhLCwpID0gY2FsY3VsYXRlQXJlYShfY29udHJhY3RzLCBfcmVnaW9uSWQpOwoJCXJldHVybiBjYWxjdWxhdGVBdmVyYWdlUGl4ZWxQcmljZShfY29udHJhY3RzLCBwdXJjaGFzZWRQaXhlbHMsIHB1cmNoYXNlZFBpeGVscyArIGFyZWEpOwoJfQoKCS8qKiBDdXJyZW50IG1hcmtldCBwcmljZSBvciAoQ3VycmVudCBtYXJrZXQgcHJpY2UpKjMgaWYgdGhlIHJlZ2lvbiB3YXMgc29sZAoJICAqLwoJZnVuY3Rpb24gY2FsY3VsYXRlUmVnaW9uU2FsZVBpeGVsUHJpY2UoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfcmVnaW9uSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQl2YXIgcGl4ZWxQcmljZSA9IEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0UmVnaW9uQ3VycmVudFBpeGVsUHJpY2UoX3JlZ2lvbklkKTsKCQlpZihwaXhlbFByaWNlID4gMCkgewoJCQlyZXR1cm4gcGl4ZWxQcmljZSAqIDM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIGNhbGN1bGF0ZVJlZ2lvbkluaXRpYWxTYWxlUGl4ZWxQcmljZShfY29udHJhY3RzLCBfcmVnaW9uSWQpOwoJCX0KCX0KCgkvKiogU2V0dXAgaXMgYWxsb3dlZCBvbmUgd2hpdGhpbiBvbmUgZGF5IGFmdGVyIHB1cmNoYXNlCgkgICovCglmdW5jdGlvbiBjYWxjdWxhdGVTZXR1cEFsbG93ZWRVbnRpbChhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXZhciAodXBkYXRlZEF0LCBwdXJjaGFzZWRBdCkgPSBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFJlZ2lvblVwZGF0ZWRBdFB1cmNoYXNlZEF0KF9yZWdpb25JZCk7CgkJaWYodXBkYXRlZEF0ICE9IHB1cmNoYXNlZEF0KSB7CgkJCXJldHVybiAwOwoJCX0gZWxzZSB7CgkJCXJldHVybiBwdXJjaGFzZWRBdCArIDEgZGF5czsKCQl9Cgl9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvc3RvcmFnZS9CZHBPd25lcnNoaXBTdG9yYWdlLnNvbAoKY29udHJhY3QgQmRwT3duZXJzaGlwU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCgkvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gb3duZXIKCW1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHRva2VuT3duZXI7CgoJLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGFwcHJvdmVkIGFkZHJlc3MKCW1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHRva2VuQXBwcm92YWxzOwoKCS8vIE1hcHBpbmcgZnJvbSBvd25lciB0byB0aGUgc3VtIG9mIG93bmVkIGFyZWEKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG93bmVkQXJlYTsKCgkvLyBNYXBwaW5nIGZyb20gb3duZXIgdG8gbGlzdCBvZiBvd25lZCB0b2tlbiBJRHMKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NltdKSBwdWJsaWMgb3duZWRUb2tlbnM7CgoJLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGluZGV4IG9mIHRoZSBvd25lciB0b2tlbnMgbGlzdAoJbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBvd25lZFRva2Vuc0luZGV4OwoKCS8vIEFsbCB0b2tlbnMgbGlzdCB0b2tlbnMgaWRzCgl1aW50MjU2W10gcHVibGljIHRva2VuSWRzOwoKCS8vIE1hcHBpbmcgZnJvbSB0b2tlbklkIHRvIGluZGV4IG9mIHRoZSB0b2tlbnMgbGlzdAoJbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5JZHNJbmRleDsKCgoJZnVuY3Rpb24gZ2V0VG9rZW5Pd25lcih1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIHRva2VuT3duZXJbX3Rva2VuSWRdOwoJfQoKCWZ1bmN0aW9uIHNldFRva2VuT3duZXIodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJdG9rZW5Pd25lcltfdG9rZW5JZF0gPSBfb3duZXI7Cgl9CgoJZnVuY3Rpb24gZ2V0VG9rZW5BcHByb3ZhbCh1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIHRva2VuQXBwcm92YWxzW190b2tlbklkXTsKCX0KCglmdW5jdGlvbiBzZXRUb2tlbkFwcHJvdmFsKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX3RvKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXRva2VuQXBwcm92YWxzW190b2tlbklkXSA9IF90bzsKCX0KCglmdW5jdGlvbiBnZXRPd25lZEFyZWEoYWRkcmVzcyBfb3duZXIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gc2V0T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkQXJlYVtfb3duZXJdID0gX2FyZWE7Cgl9CgoJZnVuY3Rpb24gaW5jcmVtZW50T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkQXJlYVtfb3duZXJdID0gb3duZWRBcmVhW19vd25lcl0uYWRkKF9hcmVhKTsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gZGVjcmVtZW50T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkQXJlYVtfb3duZXJdID0gb3duZWRBcmVhW19vd25lcl0uc3ViKF9hcmVhKTsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbnNMZW5ndGgoYWRkcmVzcyBfb3duZXIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXS5sZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbihhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXVtfaW5kZXhdOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVkVG9rZW4oYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4LCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkVG9rZW5zW19vd25lcl1bX2luZGV4XSA9IF90b2tlbklkOwoJfQoKCWZ1bmN0aW9uIHB1c2hPd25lZFRva2VuKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkVG9rZW5zW19vd25lcl0ucHVzaChfdG9rZW5JZCk7CgkJcmV0dXJuIG93bmVkVG9rZW5zW19vd25lcl0ubGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGRlY3JlbWVudE93bmVkVG9rZW5zTGVuZ3RoKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkVG9rZW5zW19vd25lcl0ubGVuZ3RoLS07Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbnNJbmRleCh1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIG93bmVkVG9rZW5zSW5kZXhbX3Rva2VuSWRdOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVkVG9rZW5zSW5kZXgodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfdG9rZW5JbmRleCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlvd25lZFRva2Vuc0luZGV4W190b2tlbklkXSA9IF90b2tlbkluZGV4OwoJfQoKCWZ1bmN0aW9uIGdldFRva2VuSWRzTGVuZ3RoKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiB0b2tlbklkcy5sZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0VG9rZW5JZEJ5SW5kZXgodWludDI1NiBfaW5kZXgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gdG9rZW5JZHNbX2luZGV4XTsKCX0KCglmdW5jdGlvbiBzZXRUb2tlbklkQnlJbmRleCh1aW50MjU2IF9pbmRleCwgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQl0b2tlbklkc1tfaW5kZXhdID0gX3Rva2VuSWQ7Cgl9CgoJZnVuY3Rpb24gcHVzaFRva2VuSWQodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHJldHVybnMgKHVpbnQyNTYpIHsKCQl0b2tlbklkcy5wdXNoKF90b2tlbklkKTsKCQlyZXR1cm4gdG9rZW5JZHMubGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGRlY3JlbWVudFRva2VuSWRzTGVuZ3RoKCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQl0b2tlbklkcy5sZW5ndGgtLTsKCX0KCglmdW5jdGlvbiBnZXRUb2tlbklkc0luZGV4KHVpbnQyNTYgX3Rva2VuSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gdG9rZW5JZHNJbmRleFtfdG9rZW5JZF07Cgl9CgoJZnVuY3Rpb24gc2V0VG9rZW5JZHNJbmRleCh1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF90b2tlbklkSW5kZXgpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJdG9rZW5JZHNJbmRleFtfdG9rZW5JZF0gPSBfdG9rZW5JZEluZGV4OwoJfQoKCWZ1bmN0aW9uIEJkcE93bmVyc2hpcFN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9saWJyYXJpZXMvQmRwT3duZXJzaGlwLnNvbAoKbGlicmFyeSBCZHBPd25lcnNoaXAgewoKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCWV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkKTsKCglldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBhcHByb3ZlZCwgdWludDI1NiBpbmRleGVkIHRva2VuSWQpOwoKCWZ1bmN0aW9uIG93bmVyT2YoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewoJCXZhciBvd25lciA9IEJkcE93bmVyc2hpcFN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcE93bmVyc2hpcFN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFRva2VuT3duZXIoX3Rva2VuSWQpOwoJCXJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CgkJcmV0dXJuIG93bmVyOwoJfQoKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCBhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRPd25lZFRva2Vuc0xlbmd0aChfb3duZXIpOwoJfQoKCWZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CgkJdmFyIG93blN0b3JhZ2UgPSBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKTsKCgkJYWRkcmVzcyBvd25lciA9IG93bmVyT2YoX2NvbnRyYWN0cywgX3Rva2VuSWQpOwoJCXJlcXVpcmUoX3RvICE9IG93bmVyKTsKCQlpZiAob3duU3RvcmFnZS5nZXRUb2tlbkFwcHJvdmFsKF90b2tlbklkKSAhPSAwIHx8IF90byAhPSAwKSB7CgkJCW93blN0b3JhZ2Uuc2V0VG9rZW5BcHByb3ZhbChfdG9rZW5JZCwgX3RvKTsKCQkJQXBwcm92YWwob3duZXIsIF90bywgX3Rva2VuSWQpOwoJCX0KCX0KCgkvKioKCSAqIEBkZXYgQ2xlYXIgY3VycmVudCBhcHByb3ZhbCBvZiBhIGdpdmVuIHRva2VuIElECgkgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKCSAqLwoJZnVuY3Rpb24gY2xlYXJBcHByb3ZhbChhZGRyZXNzWzE2XSBfY29udHJhY3RzLCBhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHsKCQl2YXIgb3duU3RvcmFnZSA9IEJkcE93bmVyc2hpcFN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcE93bmVyc2hpcFN0b3JhZ2UoX2NvbnRyYWN0cykpOwoKCQlyZXF1aXJlKG93bmVyT2YoX2NvbnRyYWN0cywgX3Rva2VuSWQpID09IF9vd25lcik7CgkJaWYgKG93blN0b3JhZ2UuZ2V0VG9rZW5BcHByb3ZhbChfdG9rZW5JZCkgIT0gMCkgewoJCQlCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKS5zZXRUb2tlbkFwcHJvdmFsKF90b2tlbklkLCAwKTsKCQkJQXBwcm92YWwoX293bmVyLCAwLCBfdG9rZW5JZCk7CgkJfQoJfQoKCS8qKgoJICogQGRldiBDbGVhciBjdXJyZW50IGFwcHJvdmFsIGFuZCB0cmFuc2ZlciB0aGUgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gdG9rZW4gSUQKCSAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KCSAqIEBwYXJhbSBfdG8gYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0aGUgdG9rZW4gdG8KCSAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAoJICovCglmdW5jdGlvbiBjbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CgkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgkJcmVxdWlyZShfdG8gIT0gb3duZXJPZihfY29udHJhY3RzLCBfdG9rZW5JZCkpOwoJCXJlcXVpcmUob3duZXJPZihfY29udHJhY3RzLCBfdG9rZW5JZCkgPT0gX2Zyb20pOwoKCQljbGVhckFwcHJvdmFsKF9jb250cmFjdHMsIF9mcm9tLCBfdG9rZW5JZCk7CgkJcmVtb3ZlVG9rZW4oX2NvbnRyYWN0cywgX2Zyb20sIF90b2tlbklkKTsKCQlhZGRUb2tlbihfY29udHJhY3RzLCBfdG8sIF90b2tlbklkKTsKCQlUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7Cgl9CgoJLyoqCgkgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGFkZCBhIHRva2VuIElEIHRvIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwoJICogQHBhcmFtIF90byBhZGRyZXNzIHJlcHJlc2VudGluZyB0aGUgbmV3IG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAoJICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIGFkZGVkIHRvIHRoZSB0b2tlbnMgbGlzdCBvZiB0aGUgZ2l2ZW4gYWRkcmVzcwoJICovCglmdW5jdGlvbiBhZGRUb2tlbihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSB7CgkJdmFyIG93blN0b3JhZ2UgPSBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKTsKCgkJcmVxdWlyZShvd25TdG9yYWdlLmdldFRva2VuT3duZXIoX3Rva2VuSWQpID09IGFkZHJlc3MoMCkpOwoKCQkvLyBTZXQgdG9rZW4gb3duZXIKCQlvd25TdG9yYWdlLnNldFRva2VuT3duZXIoX3Rva2VuSWQsIF90byk7CgoJCS8vIEFkZCB0b2tlbiB0byB0b2tlbklkcyBsaXN0CgkJdmFyIHRva2VuSWRzTGVuZ3RoID0gb3duU3RvcmFnZS5wdXNoVG9rZW5JZChfdG9rZW5JZCk7CgkJb3duU3RvcmFnZS5zZXRUb2tlbklkc0luZGV4KF90b2tlbklkLCB0b2tlbklkc0xlbmd0aC5zdWIoMSkpOwoKCQl1aW50MjU2IG93bmVkVG9rZW5zTGVuZ3RoID0gb3duU3RvcmFnZS5nZXRPd25lZFRva2Vuc0xlbmd0aChfdG8pOwoKCQkvLyBBZGQgdG9rZW4gdG8gb3duZWRUb2tlbnMgbGlzdAoJCW93blN0b3JhZ2UucHVzaE93bmVkVG9rZW4oX3RvLCBfdG9rZW5JZCk7CgkJb3duU3RvcmFnZS5zZXRPd25lZFRva2Vuc0luZGV4KF90b2tlbklkLCBvd25lZFRva2Vuc0xlbmd0aCk7CgoJCS8vIEluY3JlbWVudCB0b3RhbCBvd25lZCBhcmVhCgkJdmFyIChhcmVhLCwpID0gQmRwQ2FsY3VsYXRvci5jYWxjdWxhdGVBcmVhKF9jb250cmFjdHMsIF90b2tlbklkKTsKCQlvd25TdG9yYWdlLmluY3JlbWVudE93bmVkQXJlYShfdG8sIGFyZWEpOwoJfQoKCS8qKgoJICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byByZW1vdmUgYSB0b2tlbiBJRCBmcm9tIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwoJICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgcmVwcmVzZW50aW5nIHRoZSBwcmV2aW91cyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKCSAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSByZW1vdmVkIGZyb20gdGhlIHRva2VucyBsaXN0IG9mIHRoZSBnaXZlbiBhZGRyZXNzCgkgKi8KCWZ1bmN0aW9uIHJlbW92ZVRva2VuKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewoJCXZhciBvd25TdG9yYWdlID0gQmRwT3duZXJzaGlwU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShfY29udHJhY3RzKSk7CgoJCXJlcXVpcmUob3duZXJPZihfY29udHJhY3RzLCBfdG9rZW5JZCkgPT0gX2Zyb20pOwoKCQkvLyBDbGVhciB0b2tlbiBvd25lcgoJCW93blN0b3JhZ2Uuc2V0VG9rZW5Pd25lcihfdG9rZW5JZCwgMCk7CgoJCXJlbW92ZUZyb21Ub2tlbklkcyhvd25TdG9yYWdlLCBfdG9rZW5JZCk7CgkJcmVtb3ZlRnJvbU93bmVkVG9rZW4ob3duU3RvcmFnZSwgX2Zyb20sIF90b2tlbklkKTsKCgkJLy8gRGVjcmVtZW50IHRvdGFsIG93bmVkIGFyZWEKCQl2YXIgKGFyZWEsLCkgPSBCZHBDYWxjdWxhdG9yLmNhbGN1bGF0ZUFyZWEoX2NvbnRyYWN0cywgX3Rva2VuSWQpOwoJCW93blN0b3JhZ2UuZGVjcmVtZW50T3duZWRBcmVhKF9mcm9tLCBhcmVhKTsKCX0KCgkvKioKCSAqIEBkZXYgUmVtb3ZlIHRva2VuIGZyb20gb3duZWRUb2tlbnMgbGlzdAoJICogTm90ZSB0aGF0IHRoaXMgd2lsbCBoYW5kbGUgc2luZ2xlLWVsZW1lbnQgYXJyYXlzLiBJbiB0aGF0IGNhc2UsIGJvdGggb3duZWRUb2tlbkluZGV4IGFuZCBsYXN0T3duZWRUb2tlbkluZGV4IGFyZSBnb2luZyB0bwoJICogYmUgemVyby4gVGhlbiB3ZSBjYW4gbWFrZSBzdXJlIHRoYXQgd2Ugd2lsbCByZW1vdmUgX3Rva2VuSWQgZnJvbSB0aGUgb3duZWRUb2tlbnMgbGlzdCBzaW5jZSB3ZSBhcmUgZmlyc3Qgc3dhcHBpbmcKCSAqIHRoZSBsYXN0T3duZWRUb2tlbiB0byB0aGUgZmlyc3QgcG9zaXRpb24sIGFuZCB0aGVuIGRyb3BwaW5nIHRoZSBlbGVtZW50IHBsYWNlZCBpbiB0aGUgbGFzdCBwb3NpdGlvbiBvZiB0aGUgbGlzdAoJICovCglmdW5jdGlvbiByZW1vdmVGcm9tT3duZWRUb2tlbihCZHBPd25lcnNoaXBTdG9yYWdlIF9vd25TdG9yYWdlLCBhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKCQl2YXIgb3duZWRUb2tlbkluZGV4ID0gX293blN0b3JhZ2UuZ2V0T3duZWRUb2tlbnNJbmRleChfdG9rZW5JZCk7CgkJdmFyIGxhc3RPd25lZFRva2VuSW5kZXggPSBfb3duU3RvcmFnZS5nZXRPd25lZFRva2Vuc0xlbmd0aChfZnJvbSkuc3ViKDEpOwoJCXZhciBsYXN0T3duZWRUb2tlbiA9IF9vd25TdG9yYWdlLmdldE93bmVkVG9rZW4oX2Zyb20sIGxhc3RPd25lZFRva2VuSW5kZXgpOwoJCV9vd25TdG9yYWdlLnNldE93bmVkVG9rZW4oX2Zyb20sIG93bmVkVG9rZW5JbmRleCwgbGFzdE93bmVkVG9rZW4pOwoJCV9vd25TdG9yYWdlLnNldE93bmVkVG9rZW4oX2Zyb20sIGxhc3RPd25lZFRva2VuSW5kZXgsIDApOwoJCV9vd25TdG9yYWdlLmRlY3JlbWVudE93bmVkVG9rZW5zTGVuZ3RoKF9mcm9tKTsKCQlfb3duU3RvcmFnZS5zZXRPd25lZFRva2Vuc0luZGV4KF90b2tlbklkLCAwKTsKCQlfb3duU3RvcmFnZS5zZXRPd25lZFRva2Vuc0luZGV4KGxhc3RPd25lZFRva2VuLCBvd25lZFRva2VuSW5kZXgpOwoJfQoKCS8qKgoJICogQGRldiBSZW1vdmUgdG9rZW4gZnJvbSB0b2tlbklkcyBsaXN0CgkgKi8KCWZ1bmN0aW9uIHJlbW92ZUZyb21Ub2tlbklkcyhCZHBPd25lcnNoaXBTdG9yYWdlIF9vd25TdG9yYWdlLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKCQl2YXIgdG9rZW5JbmRleCA9IF9vd25TdG9yYWdlLmdldFRva2VuSWRzSW5kZXgoX3Rva2VuSWQpOwoJCXZhciBsYXN0VG9rZW5JZEluZGV4ID0gX293blN0b3JhZ2UuZ2V0VG9rZW5JZHNMZW5ndGgoKS5zdWIoMSk7CgkJdmFyIGxhc3RUb2tlbklkID0gX293blN0b3JhZ2UuZ2V0VG9rZW5JZEJ5SW5kZXgobGFzdFRva2VuSWRJbmRleCk7CgkJX293blN0b3JhZ2Uuc2V0VG9rZW5JZEJ5SW5kZXgodG9rZW5JbmRleCwgbGFzdFRva2VuSWQpOwoJCV9vd25TdG9yYWdlLnNldFRva2VuSWRCeUluZGV4KGxhc3RUb2tlbklkSW5kZXgsIDApOwoJCV9vd25TdG9yYWdlLmRlY3JlbWVudFRva2VuSWRzTGVuZ3RoKCk7CgkJX293blN0b3JhZ2Uuc2V0VG9rZW5JZHNJbmRleChfdG9rZW5JZCwgMCk7CgkJX293blN0b3JhZ2Uuc2V0VG9rZW5JZHNJbmRleChsYXN0VG9rZW5JZCwgdG9rZW5JbmRleCk7Cgl9CgoJLyoqCgkgKiBAZGV2IE1pbnQgdG9rZW4gZnVuY3Rpb24KCSAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIG93biB0aGUgbWludGVkIHRva2VuCgkgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgbWludGVkIGJ5IHRoZSBtc2cuc2VuZGVyCgkgKi8KCWZ1bmN0aW9uIG1pbnQoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CgkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgkJYWRkVG9rZW4oX2NvbnRyYWN0cywgX3RvLCBfdG9rZW5JZCk7CgkJVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfdG9rZW5JZCk7Cgl9CgoJLyoqCgkgKiBAZGV2IEJ1cm5zIGEgc3BlY2lmaWMgdG9rZW4KCSAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiBiZWluZyBidXJuZWQKCSAqLwoJZnVuY3Rpb24gYnVybihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewoJCWFkZHJlc3Mgb3duZXIgPSBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRUb2tlbk93bmVyKF90b2tlbklkKTsKCQljbGVhckFwcHJvdmFsKF9jb250cmFjdHMsIG93bmVyLCBfdG9rZW5JZCk7CgkJcmVtb3ZlVG9rZW4oX2NvbnRyYWN0cywgb3duZXIsIF90b2tlbklkKTsKCQlUcmFuc2Zlcihvd25lciwgYWRkcmVzcygwKSwgX3Rva2VuSWQpOwoJfQoKfQ=='.
	

]
