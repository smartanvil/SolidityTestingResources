Class {
	#name : #SRT1a815161b3234f507a23b144bb2abbb1460facd1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1a815161b3234f507a23b144bb2abbb1460facd1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KICB9Cn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCgovKioKICogUGF1c2FibGUgdG9rZW4KICoKICogU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggcGF1c2FibGUgdG9rZW4gY3JlYXRpb24KICoqLwpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9Cn0KCgovLy8gQHRpdGxlIFRoZSBQYWxseUNvaW4KLy8vIEBhdXRob3IgTWVydW5hcyBHcmluY2FsYWl0aXMKY29udHJhY3QgUGFsbHlDb2luIGlzIFBhdXNhYmxlVG9rZW4gewogICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICdQYWxseUNvaW4nOwoKICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAnUEFMJzsKCiAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG90YWxTdXBwbHkgPSAxMDBlMjQ7IC8vIDEwME0gdG9rZW5zIHdpdGggMTggZGVjaW1hbHMKCiAgIC8vIFRoZSB0b2tlbnMgYWxyZWFkeSB1c2VkIGZvciB0aGUgcHJlc2FsZSBidXllcnMKICAgdWludDI1NiBwdWJsaWMgdG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlID0gMDsKCiAgIC8vIFRoZSB0b2tlbnMgYWxyZWFkeSB1c2VkIGZvciB0aGUgSUNPIGJ1eWVycwogICB1aW50MjU2IHB1YmxpYyB0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSA9IDA7CgogICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGU7CgogICAvLy8gQG5vdGljZSBPbmx5IGFsbG93cyB0aGUgZXhlY3V0aW9uIG9mIHRoZSBmdW5jdGlvbiBpZiBpdCdzIGNvbW1pbmcgZnJvbSBjcm93ZHNhbGUKICAgbW9kaWZpZXIgb25seUNyb3dkc2FsZSgpIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyb3dkc2FsZSk7CiAgICAgIF87CiAgIH0KCiAgIC8vIFdoZW4gc29tZW9uZSByZWZ1bmRzIHRva2VucwogICBldmVudCBSZWZ1bmRlZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgdXNlciwgdWludDI1NiB0b2tlbnMpOwoKICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdXNlZCB0byBzZXQgdGhlIHBsYXRmb3JtICYgZGV2ZWxvcG1lbnQgdG9rZW5zLiBUaGlzIGlzCiAgIC8vLyBUaGUgMjAlICsgMjAlIG9mIHRoZSAxMDAgTSB0b2tlbnMgdXNlZCBmb3IgcGxhdGZvcm0gYW5kIGRldmVsb3BtZW50IHRlYW0uCiAgIC8vLyBUaGUgb3duZXIsIG1zZy5zZW5kZXIsIGlzIGFibGUgdG8gZG8gYWxsb3dhbmNlIGZvciBvdGhlciBjb250cmFjdHMuIFJlbWVtYmVyCiAgIC8vLyB0byB1c2UgYHRyYW5zZmVyRnJvbSgpYCBpZiB5b3UncmUgYWxsb3dlZAogICBmdW5jdGlvbiBQYWxseUNvaW4oKSB7CiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gNDBlMjQ7IC8vIDQwTSB0b2tlbnMgd2VpCiAgIH0KCiAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNldCB0aGUgY3Jvd2RzYWxlIHNtYXJ0IGNvbnRyYWN0J3MgYWRkcmVzcyBvbmx5IGJ5IHRoZSBvd25lciBvZiB0aGlzIHRva2VuCiAgIC8vLyBAcGFyYW0gX2Nyb3dkc2FsZSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgdXNlZAogICBmdW5jdGlvbiBzZXRDcm93ZHNhbGVBZGRyZXNzKGFkZHJlc3MgX2Nyb3dkc2FsZSkgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgICByZXF1aXJlKF9jcm93ZHNhbGUgIT0gYWRkcmVzcygwKSk7CgogICAgICBjcm93ZHNhbGUgPSBfY3Jvd2RzYWxlOwogICB9CgogICAvLy8gQG5vdGljZSBEaXN0cmlidXRlcyB0aGUgcHJlc2FsZSB0b2tlbnMuIE9ubHkgdGhlIG93bmVyIGNhbiBkbyB0aGlzCiAgIC8vLyBAcGFyYW0gX2J1eWVyIFRoZSBhZGRyZXNzIG9mIHRoZSBidXllcgogICAvLy8gQHBhcmFtIHRva2VucyBUaGUgYW1vdW50IG9mIHRva2VucyBjb3JyZXNwb25kaW5nIHRvIHRoYXQgYnV5ZXIKICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVByZXNhbGVUb2tlbnMoYWRkcmVzcyBfYnV5ZXIsIHVpbnQgdG9rZW5zKSBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDApOwoKICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgbGltaXQgb2YgMTBNIHByZXNhbGUgdG9rZW5zIGhhc24ndCBiZWVuIG1ldCB5ZXQKICAgICAgcmVxdWlyZSh0b2tlbnNEaXN0cmlidXRlZFByZXNhbGUgPCAxMGUyNCk7CgogICAgICB0b2tlbnNEaXN0cmlidXRlZFByZXNhbGUgPSB0b2tlbnNEaXN0cmlidXRlZFByZXNhbGUuYWRkKHRva2Vucyk7CiAgICAgIGJhbGFuY2VzW19idXllcl0gPSBiYWxhbmNlc1tfYnV5ZXJdLmFkZCh0b2tlbnMpOwogICB9CgogICAvLy8gQG5vdGljZSBEaXN0cmlidXRlcyB0aGUgSUNPIHRva2Vucy4gT25seSB0aGUgY3Jvd2RzYWxlIGFkZHJlc3MgY2FuIGV4ZWN1dGUgdGhpcwogICAvLy8gQHBhcmFtIF9idXllciBUaGUgYnV5ZXIgYWRkcmVzcwogICAvLy8gQHBhcmFtIHRva2VucyBUaGUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kIHRvIHRoYXQgYWRkcmVzcwogICBmdW5jdGlvbiBkaXN0cmlidXRlSUNPVG9rZW5zKGFkZHJlc3MgX2J1eWVyLCB1aW50IHRva2VucykgZXh0ZXJuYWwgb25seUNyb3dkc2FsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgcmVxdWlyZShfYnV5ZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUodG9rZW5zID4gMCk7CgogICAgICAvLyBDaGVjayB0aGF0IHRoZSBsaW1pdCBvZiA1ME0gSUNPIHRva2VucyBoYXNuJ3QgYmVlbiBtZXQgeWV0CiAgICAgIHJlcXVpcmUodG9rZW5zRGlzdHJpYnV0ZWRDcm93ZHNhbGUgPCA1MGUyNCk7CgogICAgICB0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSA9IHRva2Vuc0Rpc3RyaWJ1dGVkQ3Jvd2RzYWxlLmFkZCh0b2tlbnMpOwogICAgICBiYWxhbmNlc1tfYnV5ZXJdID0gYmFsYW5jZXNbX2J1eWVyXS5hZGQodG9rZW5zKTsKICAgfQoKICAgLy8vIEBub3RpY2UgRGVsZXRlcyB0aGUgYW1vdW50IG9mIHRva2VucyByZWZ1bmRlZCBmcm9tIHRoYXQgYnV5ZXIgYmFsYW5jZQogICAvLy8gQHBhcmFtIF9idXllciBUaGUgYnV5ZXIgdGhhdCB3YW50cyB0aGUgcmVmdW5kCiAgIC8vLyBAcGFyYW0gdG9rZW5zIFRoZSB0b2tlbnMgdG8gcmV0dXJuCiAgIGZ1bmN0aW9uIHJlZnVuZFRva2VucyhhZGRyZXNzIF9idXllciwgdWludDI1NiB0b2tlbnMpIGV4dGVybmFsIG9ubHlDcm93ZHNhbGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDApOwogICAgICByZXF1aXJlKGJhbGFuY2VzW19idXllcl0gPj0gdG9rZW5zKTsKCiAgICAgIGJhbGFuY2VzW19idXllcl0gPSBiYWxhbmNlc1tfYnV5ZXJdLnN1Yih0b2tlbnMpOwogICAgICBSZWZ1bmRlZFRva2VucyhfYnV5ZXIsIHRva2Vucyk7CiAgIH0KfQoKCi8qKgogKiBAdGl0bGUgUmVmdW5kVmF1bHQKICogQGRldiBUaGlzIGNvbnRyYWN0IGlzIHVzZWQgZm9yIHN0b3JpbmcgZnVuZHMgd2hpbGUgYSBjcm93ZHNhbGUKICogaXMgaW4gcHJvZ3Jlc3MuIFN1cHBvcnRzIHJlZnVuZGluZyB0aGUgbW9uZXkgaWYgY3Jvd2RzYWxlIGZhaWxzLAogKiBhbmQgZm9yd2FyZGluZyBpdCBpZiBjcm93ZHNhbGUgaXMgc3VjY2Vzc2Z1bC4KICovCmNvbnRyYWN0IFJlZnVuZFZhdWx0IGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBlbnVtIFN0YXRlIHsgQWN0aXZlLCBSZWZ1bmRpbmcsIENsb3NlZCB9CgogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKICBhZGRyZXNzIHByaXZhdGUgY3Jvd2RzYWxlOwogIFN0YXRlIHB1YmxpYyBzdGF0ZTsKICB1aW50MjU2IHB1YmxpYyB3ZWlCYWxhbmNlOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CgogIGV2ZW50IFJlZnVuZHNFbmFibGVkKCk7CiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHdlaUFtb3VudCk7CiAgZXZlbnQgTG9nRGVwb3NpdGVkKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IFZhdWx0Q2xvc2VkKCk7CgogIG1vZGlmaWVyIG9ubHlDcm93ZHNhbGUoKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjcm93ZHNhbGUpOwogICAgICBfOwogIH0KCiAgZnVuY3Rpb24gUmVmdW5kVmF1bHQoYWRkcmVzcyBfd2FsbGV0KSB7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKCiAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgY3Jvd2RzYWxlID0gbXNnLnNlbmRlcjsKICAgIHN0YXRlID0gU3RhdGUuQWN0aXZlOwogIH0KCiAgZnVuY3Rpb24gZGVwb3NpdChhZGRyZXNzIGludmVzdG9yKSBleHRlcm5hbCBwYXlhYmxlIG9ubHlDcm93ZHNhbGUgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwoKICAgIHdlaUJhbGFuY2UgPSB3ZWlCYWxhbmNlLmFkZChtc2cudmFsdWUpOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl0uYWRkKG1zZy52YWx1ZSk7CiAgICBMb2dEZXBvc2l0ZWQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGNsb3NlKCkgZXh0ZXJuYWwgb25seUNyb3dkc2FsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CgogICAgc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7CiAgICB3YWxsZXQudHJhbnNmZXIod2VpQmFsYW5jZSk7CiAgICBWYXVsdENsb3NlZCgpOwogIH0KCiAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kcygpIGV4dGVybmFsIG9ubHlDcm93ZHNhbGUgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwoKICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgUmVmdW5kc0VuYWJsZWQoKTsKICB9CgogIGZ1bmN0aW9uIHJlZnVuZChhZGRyZXNzIGludmVzdG9yKSBleHRlcm5hbCBvbmx5Q3Jvd2RzYWxlIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuUmVmdW5kaW5nKTsKCiAgICB1aW50MjU2IGRlcG9zaXRlZFZhbHVlID0gZGVwb3NpdGVkW2ludmVzdG9yXTsKICAgIHdlaUJhbGFuY2UgPSB3ZWlCYWxhbmNlLnN1YihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBkZXBvc2l0ZWRbaW52ZXN0b3JdID0gMDsKICAgIGludmVzdG9yLnRyYW5zZmVyKGRlcG9zaXRlZFZhbHVlKTsKICAgIFJlZnVuZGVkKGludmVzdG9yLCBkZXBvc2l0ZWRWYWx1ZSk7CiAgfQp9CgoKLy8gMS4gRmlyc3QgeW91IHNldCB0aGUgYWRkcmVzcyBvZiB0aGUgd2FsbGV0IGluIHRoZSBSZWZ1bmRWYXVsdCBjb250cmFjdCB0aGF0IHdpbGwgc3RvcmUgdGhlIGRlcG9zaXQgb2YgZXRoZXIKLy8gMi4gSWYgdGhlIGdvYWwgaXMgcmVhY2hlZCwgdGhlIHN0YXRlIG9mIHRoZSB2YXVsdCB3aWxsIGNoYW5nZSBhbmQgdGhlIGV0aGVyIHdpbGwgYmUgc2VudCB0byB0aGUgYWRkcmVzcwovLyAzLiBJZiB0aGUgZ29hbCBpcyBub3QgcmVhY2hlZCBhZnRlciAyOCBkYXlzLCB0aGUgc3RhdGUgb2YgdGhlIHZhdWx0IHdpbGwgY2hhbmdlIHRvIHJlZnVuZGluZyBhbmQgdGhlIHVzZXJzIHdpbGwgYmUgYWJsZSB0byBjYWxsIGNsYWltUmVmdW5kKCkgdG8gZ2V0IHRoZWlyIGV0aGVyCgovLy8gQHRpdGxlIENyb3dkc2FsZSBjb250cmFjdCB0byBjYXJyeSBvdXQgYW4gSUNPIHdpdGggdGhlIFBhbGx5Q29pbgovLy8gQ3Jvd2RzYWxlcyBoYXZlIGEgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzLCB3aGVyZSBpbnZlc3RvcnMgY2FuIG1ha2UKLy8vIHRva2VuIHB1cmNoYXNlcyBhbmQgdGhlIGNyb3dkc2FsZSB3aWxsIGFzc2lnbiB0aGVtIHRva2VucyBiYXNlZAovLy8gb24gYSB0b2tlbiBwZXIgRVRIIHJhdGUuIEZ1bmRzIGNvbGxlY3RlZCBhcmUgZm9yd2FyZGVkIHRvIGEgd2FsbGV0Ci8vLyBhcyB0aGV5IGFycml2ZS4KLy8vIEBhdXRob3IgTWVydW5hcyBHcmluY2FsYWl0aXMgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI2ZjAyMGExZDFhMDEwZTFjMDgxZDA2MDEwYzBlMDMwZTA2MWIwNjFjMmYwODAyMGUwNjAzNDEwYzAwMDIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pgpjb250cmFjdCBDcm93ZHNhbGUgaXMgUGF1c2FibGUgewogICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgIFBhbGx5Q29pbiBwdWJsaWMgdG9rZW47CgogICAvLyBUaGUgdmF1bHQgdGhhdCB3aWxsIHN0b3JlIHRoZSBldGhlciB1bnRpbCB0aGUgZ29hbCBpcyByZWFjaGVkCiAgIFJlZnVuZFZhdWx0IHB1YmxpYyB2YXVsdDsKCiAgIC8vIFRoZSBibG9jayBudW1iZXIgb2Ygd2hlbiB0aGUgY3Jvd2RzYWxlIHN0YXJ0cwogICAvLyAxMC8xNS8yMDE3IEAgMTE6MDBhbSAoVVRDKQogICAvLyAxMC8xNS8yMDE3IEAgMTI6MDBhbSAoR01UICsgMSkKICAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lID0gMTUwODA2NTIwMDsKCiAgIC8vIFRoZSBibG9jayBudW1iZXIgb2Ygd2hlbiB0aGUgY3Jvd2RzYWxlIGVuZHMKICAgLy8gMTEvMTMvMjAxNyBAIDExOjAwYW0gKFVUQykKICAgLy8gMTEvMTMvMjAxNyBAIDEyOjAwcG0gKEdNVCArIDEpCiAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWUgPSAxNTEwNTcwODAwOwoKICAgLy8gVGhlIHdhbGxldCB0aGF0IGhvbGRzIHRoZSBXZWkgcmFpc2VkIG9uIHRoZSBjcm93ZHNhbGUKICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAgLy8gVGhlIHJhdGUgb2YgdG9rZW5zIHBlciBldGhlci4gT25seSBhcHBsaWVkIGZvciB0aGUgZmlyc3QgdGllciwgdGhlIGZpcnN0CiAgIC8vIDEyLjUgbWlsbGlvbiB0b2tlbnMgc29sZAogICB1aW50MjU2IHB1YmxpYyByYXRlOwoKICAgLy8gVGhlIHJhdGUgb2YgdG9rZW5zIHBlciBldGhlci4gT25seSBhcHBsaWVkIGZvciB0aGUgc2Vjb25kIHRpZXIsIGF0IGJldHdlZW4KICAgLy8gMTIuNSBtaWxsaW9uIHRva2VucyBzb2xkIGFuZCAyNSBtaWxsaW9uIHRva2VucyBzb2xkCiAgIHVpbnQyNTYgcHVibGljIHJhdGVUaWVyMjsKCiAgIC8vIFRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIuIE9ubHkgYXBwbGllZCBmb3IgdGhlIHRoaXJkIHRpZXIsIGF0IGJldHdlZW4KICAgLy8gMjUgbWlsbGlvbiB0b2tlbnMgc29sZCBhbmQgMzcuNSBtaWxsaW9uIHRva2VucyBzb2xkCiAgIHVpbnQyNTYgcHVibGljIHJhdGVUaWVyMzsKCiAgIC8vIFRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIuIE9ubHkgYXBwbGllZCBmb3IgdGhlIGZvdXJ0aCB0aWVyLCBhdCBiZXR3ZWVuCiAgIC8vIDM3LjUgbWlsbGlvbiB0b2tlbnMgc29sZCBhbmQgNTAgbWlsbGlvbiB0b2tlbnMgc29sZAogICB1aW50MjU2IHB1YmxpYyByYXRlVGllcjQ7CgogICAvLyBUaGUgYW1vdW50IG9mIHdlaSByYWlzZWQKICAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgIC8vIFRoZSBhbW91bnQgb2YgdG9rZW5zIHJhaXNlZAogICB1aW50MjU2IHB1YmxpYyB0b2tlbnNSYWlzZWQgPSAwOwoKICAgLy8gWW91IGNhbiBvbmx5IGJ1eSB1cCB0byA1MCBNIHRva2VucyBkdXJpbmcgdGhlIElDTwogICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtYXhUb2tlbnNSYWlzZWQgPSA1MGUyNDsKCiAgIC8vIFRoZSBtaW5pbXVtIGFtb3VudCBvZiBXZWkgeW91IG11c3QgcGF5IHRvIHBhcnRpY2lwYXRlIGluIHRoZSBjcm93ZHNhbGUKICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbWluUHVyY2hhc2UgPSAxMDAgZmlubmV5OyAvLyAwLjEgZXRoZXIKCiAgIC8vIFRoZSBtYXggYW1vdW50IG9mIFdlaSB0aGF0IHlvdSBjYW4gcGF5IHRvIHBhcnRpY2lwYXRlIGluIHRoZSBjcm93ZHNhbGUKICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbWF4UHVyY2hhc2UgPSAyMDAwIGV0aGVyOwoKICAgLy8gTWluaW11bSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHJhaXNlZC4gNy41IG1pbGxpb24gdG9rZW5zIHdoaWNoIGlzIHRoZSAxNSUKICAgLy8gb2YgdGhlIHRvdGFsIG9mIDUwIG1pbGxpb24gdG9rZW5zIHNvbGQgaW4gdGhlIGNyb3dkc2FsZQogICAvLyA3LjVlNiArIDFlMTgKICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbWluaW11bUdvYWwgPSA3LjVlMjQ7CgogICAvLyBJZiB0aGUgY3Jvd2RzYWxlIHdhc24ndCBzdWNjZXNzZnVsLCB0aGlzIHdpbGwgYmUgdHJ1ZSBhbmQgdXNlcnMgd2lsbCBiZSBhYmxlCiAgIC8vIHRvIGNsYWltIHRoZSByZWZ1bmQgb2YgdGhlaXIgZXRoZXIKICAgYm9vbCBwdWJsaWMgaXNSZWZ1bmRpbmcgPSBmYWxzZTsKCiAgIC8vIElmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkIG9yIG5vdAogICBib29sIHB1YmxpYyBpc0VuZGVkID0gZmFsc2U7CgogICAvLyBIb3cgbXVjaCBlYWNoIHVzZXIgcGFpZCBmb3IgdGhlIGNyb3dkc2FsZQogICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNyb3dkc2FsZUJhbGFuY2VzOwoKICAgLy8gSG93IG1hbnkgdG9rZW5zIGVhY2ggdXNlciBnb3QgZm9yIHRoZSBjcm93ZHNhbGUKICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbnNCb3VnaHQ7CgogICAvLyBUbyBpbmRpY2F0ZSB3aG8gcHVyY2hhc2VkIHdoYXQgYW1vdW50IG9mIHRva2VucyBhbmQgd2hvIHJlY2VpdmVkIHdoYXQgYW1vdW50IG9mIHdlaQogICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnRPZlRva2Vucyk7CgogICAvLyBJbmRpY2F0ZXMgaWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQKICAgZXZlbnQgRmluYWxpemVkKCk7CgogICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciBvZiB0aGUgY3Jvd3NhbGUgdG8gc2V0IHVwIHRoZSBtYWluIHZhcmlhYmxlcyBhbmQgY3JlYXRlIGEgdG9rZW4KICAgLy8vIEBwYXJhbSBfd2FsbGV0IFRoZSB3YWxsZXQgYWRkcmVzcyB0aGF0IHN0b3JlcyB0aGUgV2VpIHJhaXNlZAogICAvLy8gQHBhcmFtIF90b2tlbkFkZHJlc3MgVGhlIHRva2VuIHVzZWQgZm9yIHRoZSBJQ08KICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKAogICAgICBhZGRyZXNzIF93YWxsZXQsCiAgICAgIGFkZHJlc3MgX3Rva2VuQWRkcmVzcywKICAgICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgICB1aW50MjU2IF9lbmRUaW1lCiAgICkgewogICAgICByZXF1aXJlKF93YWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUoX3Rva2VuQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKCiAgICAgIC8vIElmIHlvdSBzZW5kIHRoZSBzdGFydCBhbmQgZW5kIHRpbWUgb24gdGhlIGNvbnN0cnVjdG9yLCB0aGUgZW5kIG11c3QgYmUgbGFyZ2VyCiAgICAgIGlmKF9zdGFydFRpbWUgPiAwICYmIF9lbmRUaW1lID4gMCkKICAgICAgICAgcmVxdWlyZShfc3RhcnRUaW1lIDwgX2VuZFRpbWUpOwoKICAgICAgd2FsbGV0ID0gX3dhbGxldDsKICAgICAgdG9rZW4gPSBQYWxseUNvaW4oX3Rva2VuQWRkcmVzcyk7CiAgICAgIHZhdWx0ID0gbmV3IFJlZnVuZFZhdWx0KF93YWxsZXQpOwoKICAgICAgaWYoX3N0YXJ0VGltZSA+IDApCiAgICAgICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CgogICAgICBpZihfZW5kVGltZSA+IDApCiAgICAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgfQoKICAgLy8vIEBub3RpY2UgRmFsbGJhY2sgZnVuY3Rpb24gdG8gYnV5IHRva2VucwogICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgYnV5VG9rZW5zKCk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFRvIGJ1eSB0b2tlbnMgZ2l2ZW4gYW4gYWRkcmVzcwogICBmdW5jdGlvbiBidXlUb2tlbnMoKSBwdWJsaWMgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwoKICAgICAgdWludDI1NiB0b2tlbnMgPSAwOwogICAgICB1aW50MjU2IGFtb3VudFBhaWQgPSBjYWxjdWxhdGVFeGNlc3NCYWxhbmNlKCk7CgogICAgICBpZih0b2tlbnNSYWlzZWQgPCAxMi41ZTI0KSB7CgogICAgICAgICAvLyBUaWVyIDEKICAgICAgICAgdG9rZW5zID0gYW1vdW50UGFpZC5tdWwocmF0ZSk7CgogICAgICAgICAvLyBJZiB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IHlvdSB3YW50IHRvIGJ1eSBnZXRzIG91dCBvZiB0aGlzIHRpZXIKICAgICAgICAgaWYodG9rZW5zUmFpc2VkLmFkZCh0b2tlbnMpID4gMTIuNWUyNCkKICAgICAgICAgICAgdG9rZW5zID0gY2FsY3VsYXRlRXhjZXNzVG9rZW5zKGFtb3VudFBhaWQsIDEyLjVlMjQsIDEsIHJhdGUpOwogICAgICB9IGVsc2UgaWYodG9rZW5zUmFpc2VkID49IDEyLjVlMjQgJiYgdG9rZW5zUmFpc2VkIDwgMjVlMjQpIHsKCiAgICAgICAgIC8vIFRpZXIgMgogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlVGllcjIpOwoKICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB5b3Ugd2FudCB0byBidXkgZ2V0cyBvdXQgb2YgdGhpcyB0aWVyCiAgICAgICAgIGlmKHRva2Vuc1JhaXNlZC5hZGQodG9rZW5zKSA+IDI1ZTI0KQogICAgICAgICAgICB0b2tlbnMgPSBjYWxjdWxhdGVFeGNlc3NUb2tlbnMoYW1vdW50UGFpZCwgMjVlMjQsIDIsIHJhdGVUaWVyMik7CiAgICAgIH0gZWxzZSBpZih0b2tlbnNSYWlzZWQgPj0gMjVlMjQgJiYgdG9rZW5zUmFpc2VkIDwgMzcuNWUyNCkgewoKICAgICAgICAgLy8gVGllciAzCiAgICAgICAgIHRva2VucyA9IGFtb3VudFBhaWQubXVsKHJhdGVUaWVyMyk7CgogICAgICAgICAvLyBJZiB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IHlvdSB3YW50IHRvIGJ1eSBnZXRzIG91dCBvZiB0aGlzIHRpZXIKICAgICAgICAgaWYodG9rZW5zUmFpc2VkLmFkZCh0b2tlbnMpID4gMzcuNWUyNCkKICAgICAgICAgICAgdG9rZW5zID0gY2FsY3VsYXRlRXhjZXNzVG9rZW5zKGFtb3VudFBhaWQsIDM3LjVlMjQsIDMsIHJhdGVUaWVyMyk7CiAgICAgIH0gZWxzZSBpZih0b2tlbnNSYWlzZWQgPj0gMzcuNWUyNCkgewoKICAgICAgICAgLy8gVGllciA0CiAgICAgICAgIHRva2VucyA9IGFtb3VudFBhaWQubXVsKHJhdGVUaWVyNCk7CiAgICAgIH0KCiAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQoYW1vdW50UGFpZCk7CiAgICAgIHRva2Vuc1JhaXNlZCA9IHRva2Vuc1JhaXNlZC5hZGQodG9rZW5zKTsKICAgICAgdG9rZW4uZGlzdHJpYnV0ZUlDT1Rva2Vucyhtc2cuc2VuZGVyLCB0b2tlbnMpOwoKICAgICAgLy8gS2VlcCBhIHJlY29yZCBvZiBob3cgbWFueSB0b2tlbnMgZXZlcnlib2R5IGdldHMgaW4gY2FzZSB3ZSBuZWVkIHRvIGRvIHJlZnVuZHMKICAgICAgdG9rZW5zQm91Z2h0W21zZy5zZW5kZXJdID0gdG9rZW5zQm91Z2h0W21zZy5zZW5kZXJdLmFkZCh0b2tlbnMpOwogICAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGFtb3VudFBhaWQsIHRva2Vucyk7CgogICAgICBmb3J3YXJkRnVuZHMoYW1vdW50UGFpZCk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFNlbmRzIHRoZSBmdW5kcyB0byB0aGUgd2FsbGV0IG9yIHRvIHRoZSByZWZ1bmQgdmF1bHQgc21hcnQgY29udHJhY3QKICAgLy8vIGlmIHRoZSBtaW5pbXVtIGdvYWwgb2YgdG9rZW5zIGhhc24ndCBiZWVuIHJlYWNoZWQgeWV0CiAgIC8vLyBAcGFyYW0gYW1vdW50UGFpZCBUaGUgYW1vdW50IG9mIGV0aGVyIHBhaWQKICAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKHVpbnQyNTYgYW1vdW50UGFpZCkgaW50ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgIGlmKGdvYWxSZWFjaGVkKCkpIHsKICAgICAgICAgd2FsbGV0LnRyYW5zZmVyKGFtb3VudFBhaWQpOwogICAgICB9IGVsc2UgewogICAgICAgICB2YXVsdC5kZXBvc2l0LnZhbHVlKGFtb3VudFBhaWQpKG1zZy5zZW5kZXIpOwogICAgICB9CgogICAgICAvLyBJZiB0aGUgbWluaW11bSBnb2FsIG9mIHRoZSBJQ08gaGFzIGJlZW4gcmVhY2gsIGNsb3NlIHRoZSB2YXVsdCB0byBzZW5kCiAgICAgIC8vIHRoZSBldGhlciB0byB0aGUgd2FsbGV0IG9mIHRoZSBjcm93ZHNhbGUKICAgICAgY2hlY2tDb21wbGV0ZWRDcm93ZHNhbGUoKTsKICAgfQoKICAgLy8vIEBub3RpY2UgQ2FsY3VsYXRlcyBob3cgbWFueSBldGhlciB3aWxsIGJlIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIHRva2VucyBpbgogICAvLy8gY2FzZSB0aGUgYnV5ZXIgc2VuZHMgbW9yZSB0aGFuIHRoZSBtYXhpbXVtIGJhbGFuY2UgYnV0IGhhcyBzb21lIGJhbGFuY2UgbGVmdAogICAvLy8gYW5kIHVwZGF0ZXMgdGhlIGJhbGFuY2Ugb2YgdGhhdCBidXllci4KICAgLy8vIEZvciBpbnN0YW5jZSBpZiBoZSdzIDE1MDAgYmFsYW5jZSBhbmQgaGUgc2VuZHMgMTAwMCwgaXQgd2lsbCByZXR1cm4gNTAwCiAgIC8vLyBhbmQgcmVmdW5kIHRoZSBvdGhlciA1MDAgZXRoZXIKICAgZnVuY3Rpb24gY2FsY3VsYXRlRXhjZXNzQmFsYW5jZSgpIGludGVybmFsIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgIHVpbnQyNTYgYW1vdW50UGFpZCA9IG1zZy52YWx1ZTsKICAgICAgdWludDI1NiBkaWZmZXJlbmNlV2VpID0gMDsKICAgICAgdWludDI1NiBleGNlZWRpbmdCYWxhbmNlID0gMDsKCiAgICAgIC8vIElmIHdlJ3JlIGluIHRoZSBsYXN0IHRpZXIsIGNoZWNrIHRoYXQgdGhlIGxpbWl0IGhhc24ndCBiZWVuIHJlYWNoZWQKICAgICAgLy8gYW5kIGlmIHNvLCByZWZ1bmQgdGhlIGRpZmZlcmVuY2UgYW5kIHJldHVybiB3aGF0IHdpbGwgYmUgdXNlZCB0bwogICAgICAvLyBidXkgdGhlIHJlbWFpbmluZyB0b2tlbnMKICAgICAgaWYodG9rZW5zUmFpc2VkID49IDM3LjVlMjQpIHsKICAgICAgICAgdWludDI1NiBhZGRlZFRva2VucyA9IHRva2Vuc1JhaXNlZC5hZGQoYW1vdW50UGFpZC5tdWwocmF0ZVRpZXI0KSk7CgogICAgICAgICAvLyBJZiB0b2tlbnNSYWlzZWQgKyB3aGF0IHlvdSBwYWlkIGNvbnZlcnRlZCB0byB0b2tlbnMgaXMgYmlnZ2VyIHRoYW4gdGhlIG1heAogICAgICAgICBpZihhZGRlZFRva2VucyA+IG1heFRva2Vuc1JhaXNlZCkgewoKICAgICAgICAgICAgLy8gUmVmdW5kIHRoZSBkaWZmZXJlbmNlCiAgICAgICAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZSA9IGFkZGVkVG9rZW5zLnN1YihtYXhUb2tlbnNSYWlzZWQpOwogICAgICAgICAgICBkaWZmZXJlbmNlV2VpID0gZGlmZmVyZW5jZS5kaXYocmF0ZVRpZXI0KTsKCiAgICAgICAgICAgIGFtb3VudFBhaWQgPSBhbW91bnRQYWlkLnN1YihkaWZmZXJlbmNlV2VpKTsKICAgICAgICAgfQogICAgICB9CgogICAgICB1aW50MjU2IGFkZGVkQmFsYW5jZSA9IGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChhbW91bnRQYWlkKTsKCiAgICAgIGlmKGFkZGVkQmFsYW5jZSA8PSBtYXhQdXJjaGFzZSkgewogICAgICAgICBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChhbW91bnRQYWlkKTsKICAgICAgfSBlbHNlIHsKCiAgICAgICAgIC8vIFN1YnN0cmFjdGluZyAyMDAwIGV0aGVyIGluIHdlaQogICAgICAgICBleGNlZWRpbmdCYWxhbmNlID0gYWRkZWRCYWxhbmNlLnN1YihtYXhQdXJjaGFzZSk7CiAgICAgICAgIGFtb3VudFBhaWQgPSBtc2cudmFsdWUuc3ViKGV4Y2VlZGluZ0JhbGFuY2UpOwoKICAgICAgICAgLy8gQWRkIHRoYXQgYmFsYW5jZSB0byB0aGUgYmFsYW5jZXMKICAgICAgICAgY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQoYW1vdW50UGFpZCk7CiAgICAgIH0KCiAgICAgIC8vIE1ha2UgdGhlIHRyYW5zZmVycyBhdCB0aGUgZW5kIG9mIHRoZSBmdW5jdGlvbiBmb3Igc2VjdXJpdHkgcHVycG9zZXMKICAgICAgaWYoZGlmZmVyZW5jZVdlaSA+IDApCiAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZGlmZmVyZW5jZVdlaSk7CgogICAgICBpZihleGNlZWRpbmdCYWxhbmNlID4gMCkgewoKICAgICAgICAgLy8gUmV0dXJuIHRoZSBleGNlZWRpbmcgYmFsYW5jZSB0byB0aGUgYnV5ZXIKICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlZWRpbmdCYWxhbmNlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGFtb3VudFBhaWQ7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFNldCdzIHRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIgZm9yIGVhY2ggdGllci4gVXNlIGl0IGFmdGVyIHRoZQogICAvLy8gc21hcnQgY29udHJhY3QgaXMgZGVwbG95ZWQgdG8gc2V0IHRoZSBwcmljZSBhY2NvcmRpbmcgdG8gdGhlIGV0aGVyIHByaWNlCiAgIC8vLyBhdCB0aGUgc3RhcnQgb2YgdGhlIElDTwogICAvLy8gQHBhcmFtIHRpZXIxIFRoZSBhbW91bnQgb2YgdG9rZW5zIHlvdSBnZXQgaW4gdGhlIHRpZXIgb25lCiAgIC8vLyBAcGFyYW0gdGllcjIgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciB0d28KICAgLy8vIEBwYXJhbSB0aWVyMyBUaGUgYW1vdW50IG9mIHRva2VucyB5b3UgZ2V0IGluIHRoZSB0aWVyIHRocmVlCiAgIC8vLyBAcGFyYW0gdGllcjQgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciBmb3VyCiAgIGZ1bmN0aW9uIHNldFRpZXJSYXRlcyh1aW50MjU2IHRpZXIxLCB1aW50MjU2IHRpZXIyLCB1aW50MjU2IHRpZXIzLCB1aW50MjU2IHRpZXI0KQogICAgICBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZAogICB7CiAgICAgIHJlcXVpcmUodGllcjEgPiAwICYmIHRpZXIyID4gMCAmJiB0aWVyMyA+IDAgJiYgdGllcjQgPiAwKTsKCiAgICAgIHJhdGUgPSB0aWVyMTsKICAgICAgcmF0ZVRpZXIyID0gdGllcjI7CiAgICAgIHJhdGVUaWVyMyA9IHRpZXIzOwogICAgICByYXRlVGllcjQgPSB0aWVyNDsKICAgfQoKICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQgYW5kIGVuYWJsZXMgcmVmdW5kcyBvbmx5IGluIGNhc2UgdGhlCiAgIC8vLyBnb2FsIGhhc24ndCBiZWVuIHJlYWNoZWQKICAgZnVuY3Rpb24gY2hlY2tDb21wbGV0ZWRDcm93ZHNhbGUoKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgIGlmKCFpc0VuZGVkKSB7CiAgICAgICAgIGlmKGhhc0VuZGVkKCkgJiYgIWdvYWxSZWFjaGVkKCkpewogICAgICAgICAgICB2YXVsdC5lbmFibGVSZWZ1bmRzKCk7CgogICAgICAgICAgICBpc1JlZnVuZGluZyA9IHRydWU7CiAgICAgICAgICAgIGlzRW5kZWQgPSB0cnVlOwogICAgICAgICAgICBGaW5hbGl6ZWQoKTsKICAgICAgICAgfSBlbHNlIGlmKGhhc0VuZGVkKCkgJiYgZ29hbFJlYWNoZWQoKSkgewogICAgICAgICAgICB2YXVsdC5jbG9zZSgpOwoKICAgICAgICAgICAgaXNFbmRlZCA9IHRydWU7CiAgICAgICAgICAgIEZpbmFsaXplZCgpOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgLy8vIEBub3RpY2UgSWYgY3Jvd2RzYWxlIGlzIHVuc3VjY2Vzc2Z1bCwgaW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmRzIGhlcmUKICAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgcmVxdWlyZShoYXNFbmRlZCgpICYmICFnb2FsUmVhY2hlZCgpICYmIGlzUmVmdW5kaW5nKTsKCiAgICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogICAgIHRva2VuLnJlZnVuZFRva2Vucyhtc2cuc2VuZGVyLCB0b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl0pOwogICB9CgogICAvLy8gQG5vdGljZSBCdXlzIHRoZSB0b2tlbnMgZm9yIHRoZSBzcGVjaWZpZWQgdGllciBhbmQgZm9yIHRoZSBuZXh0IG9uZQogICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIGV0aGVyIHBhaWQgdG8gYnV5IHRoZSB0b2tlbnMKICAgLy8vIEBwYXJhbSB0b2tlbnNUaGlzVGllciBUaGUgbGltaXQgb2YgdG9rZW5zIG9mIHRoYXQgdGllcgogICAvLy8gQHBhcmFtIHRpZXJTZWxlY3RlZCBUaGUgdGllciBzZWxlY3RlZAogICAvLy8gQHBhcmFtIF9yYXRlIFRoZSByYXRlIHVzZWQgZm9yIHRoYXQgYHRpZXJTZWxlY3RlZGAKICAgLy8vIEByZXR1cm4gdWludCBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBib3VnaHQgY29tYmluaW5nIHRoZSB0aWVyIHByaWNlcwogICBmdW5jdGlvbiBjYWxjdWxhdGVFeGNlc3NUb2tlbnMoCiAgICAgIHVpbnQyNTYgYW1vdW50LAogICAgICB1aW50MjU2IHRva2Vuc1RoaXNUaWVyLAogICAgICB1aW50MjU2IHRpZXJTZWxlY3RlZCwKICAgICAgdWludDI1NiBfcmF0ZQogICApIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgdG90YWxUb2tlbnMpIHsKICAgICAgcmVxdWlyZShhbW91bnQgPiAwICYmIHRva2Vuc1RoaXNUaWVyID4gMCAmJiBfcmF0ZSA+IDApOwogICAgICByZXF1aXJlKHRpZXJTZWxlY3RlZCA+PSAxICYmIHRpZXJTZWxlY3RlZCA8PSA0KTsKCiAgICAgIHVpbnQgd2VpVGhpc1RpZXIgPSB0b2tlbnNUaGlzVGllci5zdWIodG9rZW5zUmFpc2VkKS5kaXYoX3JhdGUpOwogICAgICB1aW50IHdlaU5leHRUaWVyID0gYW1vdW50LnN1Yih3ZWlUaGlzVGllcik7CiAgICAgIHVpbnQgdG9rZW5zTmV4dFRpZXIgPSAwOwoKICAgICAgLy8gSWYgdGhlcmUncyBleGNlc3NpdmUgd2VpIGZvciB0aGUgbGFzdCB0aWVyLCByZWZ1bmQgdGhvc2UKICAgICAgaWYodGllclNlbGVjdGVkICE9IDQpCiAgICAgICAgIHRva2Vuc05leHRUaWVyID0gY2FsY3VsYXRlVG9rZW5zVGllcih3ZWlOZXh0VGllciwgdGllclNlbGVjdGVkLmFkZCgxKSk7CiAgICAgIGVsc2UKICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih3ZWlOZXh0VGllcik7CgogICAgICB0b3RhbFRva2VucyA9IHRva2Vuc1RoaXNUaWVyLnN1Yih0b2tlbnNSYWlzZWQpLmFkZCh0b2tlbnNOZXh0VGllcik7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEJ1eXMgdGhlIHRva2VucyBnaXZlbiB0aGUgcHJpY2Ugb2YgdGhlIHRpZXIgb25lIGFuZCB0aGUgd2VpIHBhaWQKICAgLy8vIEBwYXJhbSB3ZWlQYWlkIFRoZSBhbW91bnQgb2Ygd2VpIHBhaWQgdGhhdCB3aWxsIGJlIHVzZWQgdG8gYnV5IHRva2VucwogICAvLy8gQHBhcmFtIHRpZXJTZWxlY3RlZCBUaGUgdGllciB0aGF0IHlvdSdsbCB1c2UgZm9yIHRoaXIgcHVyY2hhc2UKICAgLy8vIEByZXR1cm4gY2FsY3VsYXRlZFRva2VucyBSZXR1cm5zIGhvdyBtYW55IHRva2VucyB5b3UndmUgYm91Z2h0IGZvciB0aGF0IHdlaSBwYWlkCiAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2Vuc1RpZXIodWludDI1NiB3ZWlQYWlkLCB1aW50MjU2IHRpZXJTZWxlY3RlZCkKICAgICAgICBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgY2FsY3VsYXRlZFRva2VucykKICAgewogICAgICByZXF1aXJlKHdlaVBhaWQgPiAwKTsKICAgICAgcmVxdWlyZSh0aWVyU2VsZWN0ZWQgPj0gMSAmJiB0aWVyU2VsZWN0ZWQgPD0gNCk7CgogICAgICBpZih0aWVyU2VsZWN0ZWQgPT0gMSkKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGUpOwogICAgICBlbHNlIGlmKHRpZXJTZWxlY3RlZCA9PSAyKQogICAgICAgICBjYWxjdWxhdGVkVG9rZW5zID0gd2VpUGFpZC5tdWwocmF0ZVRpZXIyKTsKICAgICAgZWxzZSBpZih0aWVyU2VsZWN0ZWQgPT0gMykKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGVUaWVyMyk7CiAgICAgIGVsc2UKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGVUaWVyNCk7CiAgIH0KCgogICAvLy8gQG5vdGljZSBDaGVja3MgaWYgYSBwdXJjaGFzZSBpcyBjb25zaWRlcmVkIHZhbGlkCiAgIC8vLyBAcmV0dXJuIGJvb2wgSWYgdGhlIHB1cmNoYXNlIGlzIHZhbGlkIG9yIG5vdAogICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgPiAwOwogICAgICBib29sIHdpdGhpblRva2VuTGltaXQgPSB0b2tlbnNSYWlzZWQgPCBtYXhUb2tlbnNSYWlzZWQ7CiAgICAgIGJvb2wgbWluaW11bVB1cmNoYXNlID0gbXNnLnZhbHVlID49IG1pblB1cmNoYXNlOwogICAgICBib29sIGhhc0JhbGFuY2VBdmFpbGFibGUgPSBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXSA8IG1heFB1cmNoYXNlOwoKICAgICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2UgJiYgd2l0aGluVG9rZW5MaW1pdCAmJiBtaW5pbXVtUHVyY2hhc2UgJiYgaGFzQmFsYW5jZUF2YWlsYWJsZTsKICAgfQoKICAgLy8vIEBub3RpY2UgVG8gc2VlIGlmIHRoZSBtaW5pbXVtIGdvYWwgb2YgdG9rZW5zIG9mIHRoZSBJQ08gaGFzIGJlZW4gcmVhY2hlZAogICAvLy8gQHJldHVybiBib29sIFRydWUgaWYgdGhlIHRva2VucyByYWlzZWQgYXJlIGJpZ2dlciB0aGFuIHRoZSBnb2FsIG9yIGZhbHNlIG90aGVyd2lzZQogICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgcmV0dXJuIHRva2Vuc1JhaXNlZCA+PSBtaW5pbXVtR29hbDsKICAgfQoKICAgLy8vIEBub3RpY2UgUHVibGljIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkIG9yIG5vdAogICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgcmV0dXJuIG5vdyA+IGVuZFRpbWUgfHwgdG9rZW5zUmFpc2VkID49IG1heFRva2Vuc1JhaXNlZDsKICAgfQp9'.
	

]
