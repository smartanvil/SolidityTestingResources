Class {
	#name : #SRT122400bfbbf1deac8dbce5aafe0f350927d55a52,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT122400bfbbf1deac8dbce5aafe0f350927d55a52 >> base64 [
	^ 'Y29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKY29udHJhY3QgT3duZWQgCnsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsKCiAgICBmdW5jdGlvbiBPd25lZCgpIAogICAgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIgCiAgICB7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXJPclRva2VuVHJhZGVyV2l0aFNhbWVPd25lciAKICAgIHsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IG93bmVyICYmIFRva2VuVHJhZGVyKG1zZy5zZW5kZXIpLm93bmVyKCkgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIAogICAgewogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KfQoKY29udHJhY3QgeDg4OCBpcyBTdGFuZGFyZFRva2VuLCBPd25lZAp7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJNZXRhIEV4Y2hhbmdlIHg4ODgiOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiWDg4OCI7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSA2OwogICAgCiAgICB1aW50MjU2IHZlcnNpb24gPSAxMDAyMDAxMDAwOTsKICAgIAogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHkgPSA1MTI1Mzg3ODg4ICogKHVpbnQyNTYoMTApICoqIGRlY2ltYWxzKTsKCiAgICB1aW50MjU2IHB1YmxpYyBleGNoRmVlID0gdWludDI1NigxICogKHVpbnQyNTYoMTApICoqIChkZWNpbWFscyAtIDIpKSk7CgogICAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lc3RhbXA7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIGF2Z1JhdGUgPSB1aW50MjU2KHVpbnQyNTYoMTApKiooMTgtZGVjaW1hbHMpKS5kaXYoODg4KTsKCiAgICBhZGRyZXNzIHB1YmxpYyBzdHVmZiA9IDB4MENjQ2I5YkFBZEQ2MUY5ZTBhYjI1YkQ3ODI3NjUwMTM4MTc4MjFiRDsKICAgIGFkZHJlc3MgcHVibGljIHRlYW1hID0gMHgyMGYzNDk5MTdkMjUyMWM0MWY4ZWM5YzBhMWY3ZTBjMzZhZjBiNDZmOwogICAgYWRkcmVzcyBwdWJsaWMgYmFzZW93bmVyOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBfdmVyaWZ5OwogICAgbWFwcGluZyh1aW50MjU2ID0+IGFkZHJlc3MpIF9ta3M7CiAgICB1aW50MjU2IHB1YmxpYyBtYWtlcnNDb3VudDsKCiAgICBldmVudCBMb2dUcmFuc2ZlcihhZGRyZXNzIHNlbmRlciwgYWRkcmVzcyB0bywgdWludCBhbW91bnQpOwogICAgZXZlbnQgQ2xlYXJpbmcoYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpOwoKICAgIGV2ZW50IFRyYWRlTGlzdGluZyhhZGRyZXNzIGluZGV4ZWQgb3duZXJBZGRyZXNzLCBhZGRyZXNzIGluZGV4ZWQgdG9rZW5UcmFkZXJBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBhc3NldCwgdWludDI1NiBidXlQcmljZSwgdWludDI1NiBzZWxsUHJpY2UsIHVpbnQyNTYgdW5pdHMsCiAgICAgICAgYm9vbCBidXlzVG9rZW5zLCBib29sIHNlbGxzVG9rZW5zKTsKICAgIGV2ZW50IE93bmVyV2l0aGRyZXdFUkMyMFRva2VuKGFkZHJlc3MgaW5kZXhlZCB0b2tlbkFkZHJlc3MsIHVpbnQyNTYgdG9rZW5zKTsKCiAgICBmdW5jdGlvbiB4ODg4KCkgCiAgICB7CiAgICAgICAgbWFrZXJzQ291bnQgPSAwOwogICAgICAgIHN0YXJ0VGltZXN0YW1wID0gbm93OwogICAgICAgIGJhc2Vvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgYmFsYW5jZXNbYmFzZW93bmVyXSA9IHRvdGFsU3VwcGx5OwogICAgICAgIFRyYW5zZmVyKDB4MCwgYmFzZW93bmVyLCB0b3RhbFN1cHBseSk7CiAgICB9CgogICAgZnVuY3Rpb24gYnZhKGFkZHJlc3MgcGFydG5lciwgdWludDI1NiB2YWx1ZSwgYWRkcmVzcyBhZHZpc2VyKXBheWFibGUgcHVibGljIAogICAgewogICAgICB1aW50MjU2IHRva2VuQW1vdW50ID0gY2FsY1RvdGFsKHZhbHVlKTsKICAgICAgaWYobXNnLnZhbHVlICE9IDApCiAgICAgIHsKICAgICAgICB0b2tlbkFtb3VudCA9IGNhbGNDb3VudChtc2cudmFsdWUpOwogICAgICB9ZWxzZQogICAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHN0dWZmKTsKICAgICAgfQogICAgICBpZihtc2cudmFsdWUgIT0gMCkKICAgICAgewogICAgICAgIENsZWFyaW5nKHN0dWZmLCBtc2cudmFsdWUubXVsKDQwKS5kaXYoMTAwKSk7CiAgICAgICAgc3R1ZmYudHJhbnNmZXIobXNnLnZhbHVlLm11bCg0MCkuZGl2KDEwMCkpOwogICAgICAgIENsZWFyaW5nKHRlYW1hLCBtc2cudmFsdWUubXVsKDQwKS5kaXYoMTAwKSk7CiAgICAgICAgdGVhbWEudHJhbnNmZXIobXNnLnZhbHVlLm11bCg0MCkuZGl2KDEwMCkpOwogICAgICAgIGlmKHBhcnRuZXIgIT0gYWR2aXNlciAmJiBiYWxhbmNlc1thZHZpc2VyXSE9MCkKICAgICAgICB7CiAgICAgICAgICBDbGVhcmluZyhhZHZpc2VyLCBtc2cudmFsdWUubXVsKDIwKS5kaXYoMTAwKSk7CiAgICAgICAgICBhZHZpc2VyLnRyYW5zZmVyKG1zZy52YWx1ZS5tdWwoMjApLmRpdigxMDApKTsKICAgICAgICB9ZWxzZQogICAgICAgIHsKICAgICAgICAgIENsZWFyaW5nKHN0dWZmLCBtc2cudmFsdWUubXVsKDEwKS5kaXYoMTAwKSk7CiAgICAgICAgICBzdHVmZi50cmFuc2Zlcihtc2cudmFsdWUubXVsKDEwKS5kaXYoMTAwKSk7CiAgICAgICAgICBDbGVhcmluZyh0ZWFtYSwgbXNnLnZhbHVlLm11bCgxMCkuZGl2KDEwMCkpOwogICAgICAgICAgdGVhbWEudHJhbnNmZXIobXNnLnZhbHVlLm11bCgxMCkuZGl2KDEwMCkpOwogICAgICAgIH0gCiAgICAgIH0KICAgICAgYmFsYW5jZXNbYmFzZW93bmVyXSA9IGJhbGFuY2VzW2Jhc2Vvd25lcl0uc3ViKHRva2VuQW1vdW50KTsKICAgICAgYmFsYW5jZXNbcGFydG5lcl0gPSBiYWxhbmNlc1twYXJ0bmVyXS5hZGQodG9rZW5BbW91bnQpOwogICAgICBUcmFuc2ZlcihiYXNlb3duZXIsIHBhcnRuZXIsIHRva2VuQW1vdW50KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYwogICAgewogICAgICBpZihtc2cudmFsdWUgIT0gMCkKICAgICAgewogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBtc2cudmFsdWUuZGl2KGF2Z1JhdGUpOwogICAgICAgIENsZWFyaW5nKHN0dWZmLCBtc2cudmFsdWUubXVsKDUwKS5kaXYoMTAwKSk7CiAgICAgICAgc3R1ZmYudHJhbnNmZXIobXNnLnZhbHVlLm11bCg1MCkuZGl2KDEwMCkpOwogICAgICAgIENsZWFyaW5nKHRlYW1hLCBtc2cudmFsdWUubXVsKDUwKS5kaXYoMTAwKSk7CiAgICAgICAgdGVhbWEudHJhbnNmZXIobXNnLnZhbHVlLm11bCg1MCkuZGl2KDEwMCkpOwogICAgICAgIGlmKG1zZy5zZW5kZXIhPXN0dWZmKQogICAgICAgIHsKICAgICAgICAgIGJhbGFuY2VzW2Jhc2Vvd25lcl0gPSBiYWxhbmNlc1tiYXNlb3duZXJdLnN1Yih0b2tlbkFtb3VudCk7CiAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZCh0b2tlbkFtb3VudCk7CiAgICAgICAgICBUcmFuc2ZlcihiYXNlb3duZXIsIG1zZy5zZW5kZXIsIHRva2VuQW1vdW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjVG90YWwodWludDI1NiBjb3VudCkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSAKICAgIHsKICAgICAgICByZXR1cm4gY291bnQubXVsKGdldERlZmxhdG9yKCkpLmRpdigxMDApOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNDb3VudCh1aW50MjU2IHdlaUFtb3VudCkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSAKICAgIHsKICAgICAgICByZXR1cm4gd2VpQW1vdW50LmRpdihhdmdSYXRlKS5tdWwoZ2V0RGVmbGF0b3IoKSkuZGl2KDEwMCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGVmbGF0b3IoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIGlmIChub3cgPD0gc3RhcnRUaW1lc3RhbXAgKyAyOCBkYXlzKS8vMzglIAogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIDEzODsKICAgICAgICB9ZWxzZSBpZiAobm93IDw9IHN0YXJ0VGltZXN0YW1wICsgNTYgZGF5cykvLzIzJSAKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAxMjM7CiAgICAgICAgfWVsc2UgaWYgKG5vdyA8PSBzdGFydFRpbWVzdGFtcCArIDg0IGRheXMpLy8xNSUgCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gMTE1OwogICAgICAgIH1lbHNlIGlmIChub3cgPD0gc3RhcnRUaW1lc3RhbXAgKyAxMTIgZGF5cykvLzklCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gMTA5OwogICAgICAgIH1lbHNlIGlmIChub3cgPD0gc3RhcnRUaW1lc3RhbXAgKyAxNDAgZGF5cykvLzUlCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gMTA1OwogICAgICAgIH1lbHNlCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gMTAwOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB2ZXJpZnkoYWRkcmVzcyB0cmFkZUNvbnRyYWN0KSBjb25zdGFudCByZXR1cm5zICgKICAgICAgICBib29sICAgIHZhbGlkLAogICAgICAgIGFkZHJlc3Mgb3duZXIsCiAgICAgICAgYWRkcmVzcyBhc3NldCwKICAgICAgICB1aW50MjU2IGJ1eVByaWNlLAogICAgICAgIHVpbnQyNTYgc2VsbFByaWNlLAogICAgICAgIHVpbnQyNTYgdW5pdHMsCiAgICAgICAgYm9vbCAgICBidXlzVG9rZW5zLAogICAgICAgIGJvb2wgICAgc2VsbHNUb2tlbnMKICAgICkgCiAgICB7CiAgICAgICAgdmFsaWQgPSBfdmVyaWZ5W3RyYWRlQ29udHJhY3RdOwogICAgICAgIGlmICh2YWxpZCkgCiAgICAgICAgewogICAgICAgICAgICBUb2tlblRyYWRlciB0ID0gVG9rZW5UcmFkZXIodHJhZGVDb250cmFjdCk7CiAgICAgICAgICAgIG93bmVyICAgICAgICAgPSB0Lm93bmVyKCk7CiAgICAgICAgICAgIGFzc2V0ICAgICAgICAgPSB0LmFzc2V0KCk7CiAgICAgICAgICAgIGJ1eVByaWNlICAgICAgPSB0LmJ1eVByaWNlKCk7CiAgICAgICAgICAgIHNlbGxQcmljZSAgICAgPSB0LnNlbGxQcmljZSgpOwogICAgICAgICAgICB1bml0cyAgICAgICAgID0gdC51bml0cygpOwogICAgICAgICAgICBidXlzVG9rZW5zICAgID0gdC5idXlzVG9rZW5zKCk7CiAgICAgICAgICAgIHNlbGxzVG9rZW5zICAgPSB0LnNlbGxzVG9rZW5zKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRyYWRlcih1aW50MjU2IGlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgICAgYm9vbCAgICB2YWxpZCwKICAgICAgICBhZGRyZXNzIHRyYWRlLAogICAgICAgIGFkZHJlc3Mgb3duZXIsCiAgICAgICAgYWRkcmVzcyBhc3NldCwKICAgICAgICB1aW50MjU2IGJ1eVByaWNlLAogICAgICAgIHVpbnQyNTYgc2VsbFByaWNlLAogICAgICAgIHVpbnQyNTYgdW5pdHMsCiAgICAgICAgYm9vbCAgICBidXlzVG9rZW5zLAogICAgICAgIGJvb2wgICAgc2VsbHNUb2tlbnMKICAgICkgCiAgICB7CiAgICAgIGlmKGlkIDwgbWFrZXJzQ291bnQpCiAgICAgIHsKICAgICAgICB0cmFkZSA9IF9ta3NbaWRdOwogICAgICAgIHZhbGlkID0gX3ZlcmlmeVt0cmFkZV07CiAgICAgICAgaWYgKHZhbGlkKSAKICAgICAgICB7CiAgICAgICAgICAgIFRva2VuVHJhZGVyIHQgPSBUb2tlblRyYWRlcih0cmFkZSk7CiAgICAgICAgICAgIG93bmVyICAgICAgICAgPSB0Lm93bmVyKCk7CiAgICAgICAgICAgIGFzc2V0ICAgICAgICAgPSB0LmFzc2V0KCk7CiAgICAgICAgICAgIGJ1eVByaWNlICAgICAgPSB0LmJ1eVByaWNlKCk7CiAgICAgICAgICAgIHNlbGxQcmljZSAgICAgPSB0LnNlbGxQcmljZSgpOwogICAgICAgICAgICB1bml0cyAgICAgICAgID0gdC51bml0cygpOwogICAgICAgICAgICBidXlzVG9rZW5zICAgID0gdC5idXlzVG9rZW5zKCk7CiAgICAgICAgICAgIHNlbGxzVG9rZW5zICAgPSB0LnNlbGxzVG9rZW5zKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNyZWF0ZVRyYWRlQ29udHJhY3QoCiAgICAgICAgYWRkcmVzcyBhc3NldCwKICAgICAgICB1aW50MjU2IGJ1eVByaWNlLAogICAgICAgIHVpbnQyNTYgc2VsbFByaWNlLAogICAgICAgIHVpbnQyNTYgdW5pdHMsCiAgICAgICAgYm9vbCAgICBidXlzVG9rZW5zLAogICAgICAgIGJvb2wgICAgc2VsbHNUb2tlbnMKICAgICkgcHVibGljIHJldHVybnMgKGFkZHJlc3MgdHJhZGVyKSAKICAgIHsKICAgICAgICByZXF1aXJlIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+IDEwMDAgKiAodWludDI1NigxMCkgKiogZGVjaW1hbHMpKTsKICAgICAgICByZXF1aXJlIChhc3NldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoYnV5UHJpY2UgPiAwICYmIHNlbGxQcmljZSA+IDApOwogICAgICAgIHJlcXVpcmUoYnV5UHJpY2UgPCBzZWxsUHJpY2UpOwogICAgICAgIHJlcXVpcmUodW5pdHMgPiAwKTsKCiAgICAgICAgdHJhZGVyID0gbmV3IFRva2VuVHJhZGVyKAogICAgICAgICAgICBhc3NldCwKICAgICAgICAgICAgZXhjaEZlZSwKICAgICAgICAgICAgYWRkcmVzcyh0aGlzKSwKICAgICAgICAgICAgYnV5UHJpY2UsCiAgICAgICAgICAgIHNlbGxQcmljZSwKICAgICAgICAgICAgdW5pdHMsCiAgICAgICAgICAgIGJ1eXNUb2tlbnMsCiAgICAgICAgICAgIHNlbGxzVG9rZW5zKTsKICAgICAgICBfdmVyaWZ5W3RyYWRlcl0gPSB0cnVlOwogICAgICAgIF9ta3NbbWFrZXJzQ291bnRdID0gdHJhZGVyOwogICAgICAgIG1ha2Vyc0NvdW50ID0gbWFrZXJzQ291bnQuYWRkKDEpOwogICAgICAgIGJhbGFuY2VzW2Jhc2Vvd25lcl0gKz0gMTAwMCAqICh1aW50MjU2KDEwKSAqKiBkZWNpbWFscyk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gMTAwMCAqICh1aW50MjU2KDEwKSAqKiBkZWNpbWFscyk7CiAgICAgICAgVG9rZW5UcmFkZXIodHJhZGVyKS50cmFuc2Zlck93bmVyc2hpcChtc2cuc2VuZGVyKTsKICAgICAgICBUcmFkZUxpc3RpbmcobXNnLnNlbmRlciwgdHJhZGVyLCBhc3NldCwgYnV5UHJpY2UsIHNlbGxQcmljZSwgdW5pdHMsIGJ1eXNUb2tlbnMsIHNlbGxzVG9rZW5zKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbGVhbnVwKCkgCiAgICB7CiAgICAgIHJldmVydCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgCiAgICB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sKSAKICAgIHsKICAgICAgICBpZihfdmVyaWZ5W21zZy5zZW5kZXJdICYmIF9mcm9tPT1tc2cuc2VuZGVyKQogICAgICAgIHsKICAgICAgICAgICBUb2tlblRyYWRlciB0ID0gVG9rZW5UcmFkZXIoX2Zyb20pOwogICAgICAgICAgIGlmKGJhbGFuY2VzW2FkZHJlc3ModC5vd25lcildPl92YWx1ZSkKICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGJhbGFuY2VzW2FkZHJlc3ModC5vd25lcildICs9IF92YWx1ZTsKICAgICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSAtPSBfdmFsdWU7CiAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpCiAgICB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmFsbG93YW5jZShfb3duZXIsIF9zcGVuZGVyKTsKICAgIH0KCn0KCmNvbnRyYWN0IEVSQ1RXIAp7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludCBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50IF92YWx1ZSk7Cn0KCgpjb250cmFjdCBUb2tlblRyYWRlciBpcyBPd25lZCAKewogICAgYWRkcmVzcyBwdWJsaWMgZXhjaGFuZ2U7ICAgIC8vIGFkZHJlc3Mgb2YgZXhjaGFuZ2UKICAgIGFkZHJlc3MgcHVibGljIGFzc2V0OyAgICAgICAvLyBhZGRyZXNzIG9mIHRva2VuCiAgICB1aW50MjU2IHB1YmxpYyBidXlQcmljZTsgICAgLy8gY29udHJhY3QgYnV5cyBsb3RzIG9mIHRva2VuIGF0IHRoaXMgcHJpY2UKICAgIHVpbnQyNTYgcHVibGljIHNlbGxQcmljZTsgICAvLyBjb250cmFjdCBzZWxscyBsb3RzIGF0IHRoaXMgcHJpY2UKICAgIHVpbnQyNTYgcHVibGljIHVuaXRzOyAgICAgICAvLyBsb3Qgc2l6ZSAodG9rZW4td2VpKQogICAgdWludDI1NiBwdWJsaWMgZXhjaEZlZTsgICAgIC8vIGZlZSBzaXplICgwLDAxIHg4ODg4KQoKICAgIGJvb2wgcHVibGljIGJ1eXNUb2tlbnM7ICAgICAvLyBpcyBjb250cmFjdCBidXlpbmcKICAgIGJvb2wgcHVibGljIHNlbGxzVG9rZW5zOyAgICAvLyBpcyBjb250cmFjdCBzZWxsaW5nCgogICAgZXZlbnQgQWN0aXZhdGVkRXZlbnQoYm9vbCBidXlzLCBib29sIHNlbGxzKTsKICAgIGV2ZW50IE1ha2VyRGVwb3NpdGVkRXRoZXIodWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWFrZXJXaXRoZHJld0Fzc2V0KHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IE1ha2VyVHJhbnNmZXJyZWRBc3NldChhZGRyZXNzIHRvVG9rZW5UcmFkZXIsIHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IE1ha2VyV2l0aGRyZXdFUkMyMFRva2VuKGFkZHJlc3MgdG9rZW5BZGRyZXNzLCB1aW50MjU2IHRva2Vucyk7CiAgICBldmVudCBNYWtlcldpdGhkcmV3RXRoZXIodWludDI1NiBldGhlcnMpOwogICAgZXZlbnQgTWFrZXJUcmFuc2ZlcnJlZEV0aGVyKGFkZHJlc3MgdG9Ub2tlblRyYWRlciwgdWludDI1NiBldGhlcnMpOwogICAgZXZlbnQgVGFrZXJCb3VnaHRBc3NldChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgZXRoZXJzU2VudCwKICAgICAgICB1aW50MjU2IGV0aGVyc1JldHVybmVkLCB1aW50MjU2IHRva2Vuc0JvdWdodCk7CiAgICBldmVudCBUYWtlclNvbGRBc3NldChhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50MjU2IGFtb3VudE9mVG9rZW5zVG9TZWxsLAogICAgICAgIHVpbnQyNTYgdG9rZW5zU29sZCwgdWludDI1NiBldGhlclZhbHVlT2ZUb2tlbnNTb2xkKTsKCiAgICAvLyBDb25zdHJ1Y3RvciAtIG9ubHkgdG8gYmUgY2FsbGVkIGJ5IHRoZSBUb2tlblRyYWRlckZhY3RvcnkgY29udHJhY3QKICAgIGZ1bmN0aW9uIFRva2VuVHJhZGVyICgKICAgICAgICBhZGRyZXNzIF9hc3NldCwKICAgICAgICB1aW50MjU2IF9leGNoRmVlLAogICAgICAgIGFkZHJlc3MgX2V4Y2hhbmdlLAogICAgICAgIHVpbnQyNTYgX2J1eVByaWNlLAogICAgICAgIHVpbnQyNTYgX3NlbGxQcmljZSwKICAgICAgICB1aW50MjU2IF91bml0cywKICAgICAgICBib29sICAgIF9idXlzVG9rZW5zLAogICAgICAgIGJvb2wgICAgX3NlbGxzVG9rZW5zCiAgICApIAogICAgewogICAgICAgIGFzc2V0ICAgICAgID0gX2Fzc2V0OwogICAgICAgIGV4Y2hGZWUgICAgID0gX2V4Y2hGZWU7CiAgICAgICAgZXhjaGFuZ2UgICAgPSBfZXhjaGFuZ2U7CiAgICAgICAgYnV5UHJpY2UgICAgPSBfYnV5UHJpY2U7CiAgICAgICAgc2VsbFByaWNlICAgPSBfc2VsbFByaWNlOwogICAgICAgIHVuaXRzICAgICAgID0gX3VuaXRzOwogICAgICAgIGJ1eXNUb2tlbnMgID0gX2J1eXNUb2tlbnM7CiAgICAgICAgc2VsbHNUb2tlbnMgPSBfc2VsbHNUb2tlbnM7CiAgICAgICAgQWN0aXZhdGVkRXZlbnQoYnV5c1Rva2Vucywgc2VsbHNUb2tlbnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFjdGl2YXRlICgKICAgICAgICBhZGRyZXNzIF9hc3NldCwKICAgICAgICB1aW50MjU2IF9leGNoRmVlLAogICAgICAgIGFkZHJlc3MgX2V4Y2hhbmdlLAogICAgICAgIHVpbnQyNTYgX2J1eVByaWNlLAogICAgICAgIHVpbnQyNTYgX3NlbGxQcmljZSwKICAgICAgICB1aW50MjU2IF91bml0cywKICAgICAgICBib29sICAgIF9idXlzVG9rZW5zLAogICAgICAgIGJvb2wgICAgX3NlbGxzVG9rZW5zCiAgICApIG9ubHlPd25lciAKICAgIHsKICAgICAgICByZXF1aXJlKEVSQ1RXKGV4Y2hhbmdlKS50cmFuc2ZlckZyb20ob3duZXIsIGV4Y2hhbmdlLCBleGNoRmVlKSk7CiAgICAgICAgYXNzZXQgICAgICAgPSBfYXNzZXQ7CiAgICAgICAgZXhjaEZlZSAgICAgPSBfZXhjaEZlZTsKICAgICAgICBleGNoYW5nZSAgICA9IF9leGNoYW5nZTsKICAgICAgICBidXlQcmljZSAgICA9IF9idXlQcmljZTsKICAgICAgICBzZWxsUHJpY2UgICA9IF9zZWxsUHJpY2U7CiAgICAgICAgdW5pdHMgICAgICAgPSBfdW5pdHM7CiAgICAgICAgYnV5c1Rva2VucyAgPSBfYnV5c1Rva2VuczsKICAgICAgICBzZWxsc1Rva2VucyA9IF9zZWxsc1Rva2VuczsKICAgICAgICBBY3RpdmF0ZWRFdmVudChidXlzVG9rZW5zLCBzZWxsc1Rva2Vucyk7CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZXJEZXBvc2l0RXRoZXIoKSBwYXlhYmxlIG9ubHlPd25lck9yVG9rZW5UcmFkZXJXaXRoU2FtZU93bmVyIAogICAgewogICAgICAgIHJlcXVpcmUoRVJDVFcoZXhjaGFuZ2UpLnRyYW5zZmVyRnJvbSh0aGlzLCBleGNoYW5nZSwgZXhjaEZlZSkpOwogICAgICAgIE1ha2VyRGVwb3NpdGVkRXRoZXIobXNnLnZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlcldpdGhkcmF3QXNzZXQodWludDI1NiB0b2tlbnMpIG9ubHlPd25lciByZXR1cm5zIChib29sIG9rKSAKICAgIHsKICAgICAgICByZXF1aXJlKEVSQ1RXKGV4Y2hhbmdlKS50cmFuc2ZlckZyb20odGhpcywgZXhjaGFuZ2UsIGV4Y2hGZWUpKTsKICAgICAgICBNYWtlcldpdGhkcmV3QXNzZXQodG9rZW5zKTsKICAgICAgICByZXR1cm4gRVJDVFcoYXNzZXQpLnRyYW5zZmVyKG93bmVyLCB0b2tlbnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VyVHJhbnNmZXJBc3NldCgKICAgICAgICBUb2tlblRyYWRlciB0b1Rva2VuVHJhZGVyLAogICAgICAgIHVpbnQyNTYgdG9rZW5zCiAgICApIG9ubHlPd25lciByZXR1cm5zIChib29sIG9rKSAKICAgIHsKICAgICAgICByZXF1aXJlKEVSQ1RXKGV4Y2hhbmdlKS50cmFuc2ZlckZyb20odGhpcywgZXhjaGFuZ2UsIGV4Y2hGZWUpKTsKICAgICAgICByZXF1aXJlIChvd25lciA9PSB0b1Rva2VuVHJhZGVyLm93bmVyKCkgJiYgYXNzZXQgPT0gdG9Ub2tlblRyYWRlci5hc3NldCgpKTsgCiAgICAgICAgTWFrZXJUcmFuc2ZlcnJlZEFzc2V0KHRvVG9rZW5UcmFkZXIsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIEVSQ1RXKGFzc2V0KS50cmFuc2Zlcih0b1Rva2VuVHJhZGVyLCB0b2tlbnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VyV2l0aGRyYXdFUkMyMFRva2VuKAogICAgICAgIGFkZHJlc3MgdG9rZW5BZGRyZXNzLAogICAgICAgIHVpbnQyNTYgdG9rZW5zCiAgICApIG9ubHlPd25lciByZXR1cm5zIChib29sIG9rKSAKICAgIHsKICAgICAgICByZXF1aXJlKEVSQ1RXKGV4Y2hhbmdlKS50cmFuc2ZlckZyb20odGhpcywgZXhjaGFuZ2UsIGV4Y2hGZWUpKTsKICAgICAgICBNYWtlcldpdGhkcmV3RVJDMjBUb2tlbih0b2tlbkFkZHJlc3MsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIEVSQ1RXKHRva2VuQWRkcmVzcykudHJhbnNmZXIob3duZXIsIHRva2Vucyk7CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZXJXaXRoZHJhd0V0aGVyKHVpbnQyNTYgZXRoZXJzKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCBvaykgCiAgICB7CiAgICAgICAgcmVxdWlyZShFUkNUVyhleGNoYW5nZSkudHJhbnNmZXJGcm9tKHRoaXMsIGV4Y2hhbmdlLCBleGNoRmVlKSk7CiAgICAgICAgaWYgKHRoaXMuYmFsYW5jZSA+PSBldGhlcnMpIAogICAgICAgIHsKICAgICAgICAgICAgTWFrZXJXaXRoZHJld0V0aGVyKGV0aGVycyk7CiAgICAgICAgICAgIHJldHVybiBvd25lci5zZW5kKGV0aGVycyk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VyVHJhbnNmZXJFdGhlcigKICAgICAgICBUb2tlblRyYWRlciB0b1Rva2VuVHJhZGVyLAogICAgICAgIHVpbnQyNTYgZXRoZXJzCiAgICApIG9ubHlPd25lciByZXR1cm5zIChib29sKSAKICAgIHsKICAgICAgICByZXF1aXJlKEVSQ1RXKGV4Y2hhbmdlKS50cmFuc2ZlckZyb20odGhpcywgZXhjaGFuZ2UsIGV4Y2hGZWUpKTsKICAgICAgICByZXF1aXJlIChvd25lciA9PSB0b1Rva2VuVHJhZGVyLm93bmVyKCkgJiYgYXNzZXQgPT0gdG9Ub2tlblRyYWRlci5hc3NldCgpKTsgCiAgICAgICAgaWYgKHRoaXMuYmFsYW5jZSA+PSBldGhlcnMpIAogICAgICAgIHsKICAgICAgICAgICAgTWFrZXJUcmFuc2ZlcnJlZEV0aGVyKHRvVG9rZW5UcmFkZXIsIGV0aGVycyk7CiAgICAgICAgICAgIHRvVG9rZW5UcmFkZXIubWFrZXJEZXBvc2l0RXRoZXIudmFsdWUoZXRoZXJzKSgpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0YWtlckJ1eUFzc2V0KCkgcGF5YWJsZSAKICAgIHsKICAgICAgICByZXF1aXJlKEVSQ1RXKGV4Y2hhbmdlKS50cmFuc2ZlckZyb20odGhpcywgZXhjaGFuZ2UsIGV4Y2hGZWUpKTsKICAgICAgICBpZiAoc2VsbHNUb2tlbnMgfHwgbXNnLnNlbmRlciA9PSBvd25lcikgCiAgICAgICAgewogICAgICAgICAgICB1aW50IG9yZGVyICAgID0gbXNnLnZhbHVlIC8gc2VsbFByaWNlOwogICAgICAgICAgICB1aW50IGNhbl9zZWxsID0gRVJDVFcoYXNzZXQpLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSAvIHVuaXRzOwogICAgICAgICAgICB1aW50MjU2IGNoYW5nZSA9IDA7CiAgICAgICAgICAgIGlmIChtc2cudmFsdWUgPiAoY2FuX3NlbGwgKiBzZWxsUHJpY2UpKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY2hhbmdlICA9IG1zZy52YWx1ZSAtIChjYW5fc2VsbCAqIHNlbGxQcmljZSk7CiAgICAgICAgICAgICAgICBvcmRlciA9IGNhbl9zZWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaGFuZ2UgPiAwKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyLnNlbmQoY2hhbmdlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9yZGVyID4gMCkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUgKEVSQ1RXKGFzc2V0KS50cmFuc2Zlcihtc2cuc2VuZGVyLCBvcmRlciAqIHVuaXRzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGFrZXJCb3VnaHRBc3NldChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGNoYW5nZSwgb3JkZXIgKiB1bml0cyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgcmVxdWlyZSAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRha2VyU2VsbEFzc2V0KHVpbnQyNTYgYW1vdW50T2ZUb2tlbnNUb1NlbGwpIHB1YmxpYyAgCiAgICB7CiAgICAgICAgcmVxdWlyZShFUkNUVyhleGNoYW5nZSkudHJhbnNmZXJGcm9tKHRoaXMsIGV4Y2hhbmdlLCBleGNoRmVlKSk7CiAgICAgICAgaWYgKGJ1eXNUb2tlbnMgfHwgbXNnLnNlbmRlciA9PSBvd25lcikgCiAgICAgICAgewogICAgICAgICAgICB1aW50MjU2IGNhbl9idXkgPSB0aGlzLmJhbGFuY2UgLyBidXlQcmljZTsKICAgICAgICAgICAgdWludDI1NiBvcmRlciA9IGFtb3VudE9mVG9rZW5zVG9TZWxsIC8gdW5pdHM7CiAgICAgICAgICAgIGlmIChvcmRlciA+IGNhbl9idXkpIG9yZGVyID0gY2FuX2J1eTsKICAgICAgICAgICAgaWYgKG9yZGVyID4gMCkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUoRVJDVFcoYXNzZXQpLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBhZGRyZXNzKHRoaXMpLCBvcmRlciAqIHVuaXRzKSk7CiAgICAgICAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIuc2VuZChvcmRlciAqIGJ1eVByaWNlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGFrZXJTb2xkQXNzZXQobXNnLnNlbmRlciwgYW1vdW50T2ZUb2tlbnNUb1NlbGwsIG9yZGVyICogdW5pdHMsIG9yZGVyICogYnV5UHJpY2UpOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgCiAgICB7CiAgICAgICAgdGFrZXJCdXlBc3NldCgpOwogICAgfQp9'.
	

]
