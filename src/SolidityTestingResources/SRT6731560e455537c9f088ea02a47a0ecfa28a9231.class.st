Class {
	#name : #SRT6731560e455537c9f088ea02a47a0ecfa28a9231,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6731560e455537c9f088ea02a47a0ecfa28a9231 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjE7CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXAoqLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlNVLlNRVUFSRVMuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uKgoqLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5CbG9ja2NoYWluLnJlbnRhYmxlLmFkdmVydGlzaW5nLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uKgoqLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uKgoqIEZpcnN0LCBJIGp1c3Qgd2FudCB0byBzYXkgd2UgYXJlIHNvIGV4Y2l0ZWQgYW5kIGh1bWJsZWQgdG8gZ2V0IHRoaXMgZmFyIGFuZCAgKgoqIHRoYXQgeW91J3JlIGV2ZW4gcmVhZGluZyB0aGlzLiBTbyB0aGFuayB5b3UhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgoqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgoqIFRoaXMgZmlsZSBpcyBvcmdhbml6ZWQgaW50byBtdWx0aXBsZSBjb250cmFjdHMgdGhhdCBzZXBhcmF0ZSBmdW5jdGlvbmFsaXR5ICAgKgoqIGludG8gbG9naWNhbCBwYXJ0cy4gVGhlIGRlcGxveWVkIGNvbnRyYWN0LCBTdU1haW4sIGlzIGF0IHRoZSBib3R0b20gYW5kICAgICAgKgoqIGluY2x1ZGVzIHRoZSByZXN0IG9mIHRoZSBmaWxlIHVzaW5nIGluaGVyaXRhbmNlLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgoqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgoqICAtIEVSQzE2NSwgRVJDNzIxOiBUaGVzZSBpbnRlcmZhY2VzIGZvbGxvdyB0aGUgb2ZmaWNpYWwgRUlQcyAgICAgICAgICAgICAgICAgKgoqICAtIEFjY2Vzc0NvbnRyb2w6IEEgcmV1c2FibGUgQ0VPL0NGTy9DT08gYWNjZXNzIG1vZGVsICAgICAgICAgICAgICAgICAgICAgICAgKgoqICAtIFB1Ymxpc2hJbnRlcmZhY2VzOiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBFUkMxNjUgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgoqICAtIFN1TkZUOiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBFUkM3MjEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKgoqICAtIFN1T3BlcmF0aW9uOiBUaGUgYWN0dWFsIHNxdWFyZSBkYXRhIGFuZCB0aGUgcGVyc29uYWxpemUgZnVuY3Rpb24gICAgICAgICAgKgoqICAtIFN1UHJvbW8sIFN1VmVuZGluZzogSG93IHdlIHNlbGwgb3IgZ3JhbnQgc3F1YXJlcyAgICAgICAgICAgICAgICAgICAgICAgICAgKgoqLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uKgoqLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlN1LiYuV2lsbGlhbS5FbnRyaWtlbi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uKgoqLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4oYykgMjAxOC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uKgpcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKLyogQWNjZXNzQ29udHJvbC5zb2wgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCi8vLyBAdGl0bGUgUmV1c2FibGUgdGhyZWUtcm9sZSBhY2Nlc3MgY29udHJvbCBpbnNwaXJlZCBieSBDcnlwdG9LaXR0aWVzCi8vLyBAYXV0aG9yIFdpbGxpYW0gRW50cmlrZW4gKGh0dHBzOi8vcGhvci5uZXQpCi8vLyBAZGV2IEtlZXAgdGhlIENFTyB3YWxsZXQgc3RvcmVkIG9mZmxpbmUsIEkgd2FybmVkIHlvdQpjb250cmFjdCBBY2Nlc3NDb250cm9sIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhY2NvdW50IHRoYXQgY2FuIG9ubHkgcmVhc3NpZ24gZXhlY3V0aXZlIGFjY291bnRzCiAgICBhZGRyZXNzIHB1YmxpYyBleGVjdXRpdmVPZmZpY2VyQWRkcmVzczsKCiAgICAvLy8gQG5vdGljZSBUaGUgYWNjb3VudCB0aGF0IGNhbiBjb2xsZWN0IGZ1bmRzIGZyb20gdGhpcyBjb250cmFjdAogICAgYWRkcmVzcyBwdWJsaWMgZmluYW5jaWFsT2ZmaWNlckFkZHJlc3M7CgogICAgLy8vIEBub3RpY2UgVGhlIGFjY291bnQgd2l0aCBhZG1pbmlzdHJhdGl2ZSBjb250cm9sIG9mIHRoaXMgY29udHJhY3QKICAgIGFkZHJlc3MgcHVibGljIG9wZXJhdGluZ09mZmljZXJBZGRyZXNzOwoKICAgIGZ1bmN0aW9uIEFjY2Vzc0NvbnRyb2woKSBpbnRlcm5hbCB7CiAgICAgICAgZXhlY3V0aXZlT2ZmaWNlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vLyBAZGV2IE9ubHkgYWxsb3dlZCBieSBleGVjdXRpdmUgb2ZmaWNlcgogICAgbW9kaWZpZXIgb25seUV4ZWN1dGl2ZU9mZmljZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGV4ZWN1dGl2ZU9mZmljZXJBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IE9ubHkgYWxsb3dlZCBieSBmaW5hbmNpYWwgb2ZmaWNlcgogICAgbW9kaWZpZXIgb25seUZpbmFuY2lhbE9mZmljZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGZpbmFuY2lhbE9mZmljZXJBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IE9ubHkgYWxsb3dlZCBieSBvcGVyYXRpbmcgb2ZmaWNlcgogICAgbW9kaWZpZXIgb25seU9wZXJhdGluZ09mZmljZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG9wZXJhdGluZ09mZmljZXJBZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJlYXNzaWduIHRoZSBleGVjdXRpdmUgb2ZmaWNlciByb2xlCiAgICAvLy8gQHBhcmFtIF9leGVjdXRpdmVPZmZpY2VyQWRkcmVzcyBuZXcgb2ZmaWNlciBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXRFeGVjdXRpdmVPZmZpY2VyKGFkZHJlc3MgX2V4ZWN1dGl2ZU9mZmljZXJBZGRyZXNzKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUV4ZWN1dGl2ZU9mZmljZXIKICAgIHsKICAgICAgICByZXF1aXJlKF9leGVjdXRpdmVPZmZpY2VyQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBleGVjdXRpdmVPZmZpY2VyQWRkcmVzcyA9IF9leGVjdXRpdmVPZmZpY2VyQWRkcmVzczsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZWFzc2lnbiB0aGUgZmluYW5jaWFsIG9mZmljZXIgcm9sZQogICAgLy8vIEBwYXJhbSBfZmluYW5jaWFsT2ZmaWNlckFkZHJlc3MgbmV3IG9mZmljZXIgYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0RmluYW5jaWFsT2ZmaWNlcihhZGRyZXNzIF9maW5hbmNpYWxPZmZpY2VyQWRkcmVzcykKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlFeGVjdXRpdmVPZmZpY2VyCiAgICB7CiAgICAgICAgcmVxdWlyZShfZmluYW5jaWFsT2ZmaWNlckFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgZmluYW5jaWFsT2ZmaWNlckFkZHJlc3MgPSBfZmluYW5jaWFsT2ZmaWNlckFkZHJlc3M7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmVhc3NpZ24gdGhlIG9wZXJhdGluZyBvZmZpY2VyIHJvbGUKICAgIC8vLyBAcGFyYW0gX29wZXJhdGluZ09mZmljZXJBZGRyZXNzIG5ldyBvZmZpY2VyIGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldE9wZXJhdGluZ09mZmljZXIoYWRkcmVzcyBfb3BlcmF0aW5nT2ZmaWNlckFkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RXhlY3V0aXZlT2ZmaWNlcgogICAgewogICAgICAgIHJlcXVpcmUoX29wZXJhdGluZ09mZmljZXJBZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG9wZXJhdGluZ09mZmljZXJBZGRyZXNzID0gX29wZXJhdGluZ09mZmljZXJBZGRyZXNzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENvbGxlY3QgZnVuZHMgZnJvbSB0aGlzIGNvbnRyYWN0CiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCBvbmx5RmluYW5jaWFsT2ZmaWNlciB7CiAgICAgICAgZmluYW5jaWFsT2ZmaWNlckFkZHJlc3MudHJhbnNmZXIoYWRkcmVzcyh0aGlzKS5iYWxhbmNlKTsKICAgIH0KfQoKLyogRVJDMTY1LnNvbCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCi8vLyBAdGl0bGUgRVJDLTE2NSBTdGFuZGFyZCBJbnRlcmZhY2UgRGV0ZWN0aW9uCi8vLyBAZGV2IFNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0xNjUubWQKaW50ZXJmYWNlIEVSQzE2NSB7CiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KCi8qIEVSQzcyMS5zb2wgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgovLy8gQHRpdGxlIEVSQy03MjEgTm9uLUZ1bmdpYmxlIFRva2VuIFN0YW5kYXJkCi8vLyBAZGV2IFNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC03MjEubWQKY29udHJhY3QgRVJDNzIxIGlzIEVSQzE2NSB7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9hcHByb3ZlZCwgdWludDI1NiBfdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbEZvckFsbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX29wZXJhdG9yLCBib29sIF9hcHByb3ZlZCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkLCBieXRlcyBkYXRhKSBleHRlcm5hbCBwYXlhYmxlOwogICAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgcGF5YWJsZTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgcGF5YWJsZTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfYXBwcm92ZWQsIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHBheWFibGU7CiAgICBmdW5jdGlvbiBzZXRBcHByb3ZhbEZvckFsbChhZGRyZXNzIF9vcGVyYXRvciwgYm9vbCBfYXBwcm92ZWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gZ2V0QXBwcm92ZWQodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGlzQXBwcm92ZWRGb3JBbGwoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX29wZXJhdG9yKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwp9CgovLy8gQHRpdGxlIEVSQy03MjEgTm9uLUZ1bmdpYmxlIFRva2VuIFN0YW5kYXJkCmludGVyZmFjZSBFUkM3MjFUb2tlblJlY2VpdmVyIHsKCWZ1bmN0aW9uIG9uRVJDNzIxUmVjZWl2ZWQoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdG9rZW5JZCwgYnl0ZXMgZGF0YSkgZXh0ZXJuYWwgcmV0dXJucyhieXRlczQpOwp9CgovLy8gQHRpdGxlIEVSQy03MjEgTm9uLUZ1bmdpYmxlIFRva2VuIFN0YW5kYXJkLCBvcHRpb25hbCBtZXRhZGF0YSBleHRlbnNpb24KaW50ZXJmYWNlIEVSQzcyMU1ldGFkYXRhIC8qIGlzIEVSQzcyMSAqLyB7CiAgICBmdW5jdGlvbiBuYW1lKCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcgX25hbWUpOwogICAgZnVuY3Rpb24gc3ltYm9sKCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcgX3N5bWJvbCk7CiAgICBmdW5jdGlvbiB0b2tlblVSSSh1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZyk7Cn0KCi8vLyBAdGl0bGUgRVJDLTcyMSBOb24tRnVuZ2libGUgVG9rZW4gU3RhbmRhcmQsIG9wdGlvbmFsIGVudW1lcmF0aW9uIGV4dGVuc2lvbgppbnRlcmZhY2UgRVJDNzIxRW51bWVyYWJsZSAvKiBpcyBFUkM3MjEgKi8gewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gdG9rZW5CeUluZGV4KHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gdG9rZW5PZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nik7Cn0KCi8qIFB1Ymxpc2hJbnRlcmZhY2VzLnNvbCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgovLy8gQHRpdGxlIEEgcmV1c2FibGUgY29udHJhY3QgdG8gY29tcGx5IHdpdGggRVJDLTE2NQovLy8gQGF1dGhvciBXaWxsaWFtIEVudHJpa2VuIChodHRwczovL3Bob3IubmV0KQpjb250cmFjdCBQdWJsaXNoSW50ZXJmYWNlcyBpcyBFUkMxNjUgewogICAgLy8vIEBkZXYgRXZlcnkgaW50ZXJmYWNlIHRoYXQgd2Ugc3VwcG9ydAogICAgbWFwcGluZyhieXRlczQgPT4gYm9vbCkgaW50ZXJuYWwgc3VwcG9ydGVkSW50ZXJmYWNlczsKCiAgICBmdW5jdGlvbiBQdWJsaXNoSW50ZXJmYWNlcygpIGludGVybmFsIHsKICAgICAgICBzdXBwb3J0ZWRJbnRlcmZhY2VzWzB4MDFmZmM5YTddID0gdHJ1ZTsgLy8gRVJDMTY1CiAgICB9CgogICAgLy8vIEBub3RpY2UgUXVlcnkgaWYgYSBjb250cmFjdCBpbXBsZW1lbnRzIGFuIGludGVyZmFjZQogICAgLy8vIEBwYXJhbSBpbnRlcmZhY2VJRCBUaGUgaW50ZXJmYWNlIGlkZW50aWZpZXIsIGFzIHNwZWNpZmllZCBpbiBFUkMtMTY1CiAgICAvLy8gQGRldiBJbnRlcmZhY2UgaWRlbnRpZmljYXRpb24gaXMgc3BlY2lmaWVkIGluIEVSQy0xNjUuIFRoaXMgZnVuY3Rpb24KICAgIC8vLyAgdXNlcyBsZXNzIHRoYW4gMzAsMDAwIGdhcy4KICAgIC8vLyBAcmV0dXJuIGB0cnVlYCBpZiB0aGUgY29udHJhY3QgaW1wbGVtZW50cyBgaW50ZXJmYWNlSURgIGFuZAogICAgLy8vICBgaW50ZXJmYWNlSURgIGlzIG5vdCAweGZmZmZmZmZmLCBgZmFsc2VgIG90aGVyd2lzZQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IGludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwcG9ydGVkSW50ZXJmYWNlc1tpbnRlcmZhY2VJRF0gJiYgKGludGVyZmFjZUlEICE9IDB4ZmZmZmZmZmYpOwogICAgfQp9CgovKiBTdU5GVC5zb2wgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKLy8vIEB0aXRsZSBDb21wbGlhbmNlIHdpdGggRVJDLTcyMSBmb3IgU3UgU3F1YXJlcwovLy8gQGRldiBUaGlzIGltcGxlbWVudGF0aW9uIGFzc3VtZXM6Ci8vLyAgLSBBIGZpeGVkIHN1cHBseSBvZiBORlRzLCBjYW5ub3QgbWludCBvciBidXJuCi8vLyAgLSBpZHMgYXJlIG51bWJlcmVkIHNlcXVlbnRpYWxseSBzdGFydGluZyBhdCAxLgovLy8gIC0gTkZUcyBhcmUgaW5pdGlhbGx5IGFzc2lnbmVkIHRvIHRoaXMgY29udHJhY3QKLy8vICAtIFRoaXMgY29udHJhY3QgZG9lcyBub3QgZXh0ZXJuYWxseSBjYWxsIGl0cyBvd24gZnVuY3Rpb25zCi8vLyBAYXV0aG9yIFdpbGxpYW0gRW50cmlrZW4gKGh0dHBzOi8vcGhvci5uZXQpCmNvbnRyYWN0IFN1TkZUIGlzIEVSQzE2NSwgRVJDNzIxLCBFUkM3MjFNZXRhZGF0YSwgRVJDNzIxRW51bWVyYWJsZSwgUHVibGlzaEludGVyZmFjZXMgewogICAgLy8vIEBkZXYgVGhlIGF1dGhvcml6ZWQgYWRkcmVzcyBmb3IgZWFjaCBORlQKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaW50ZXJuYWwgdG9rZW5BcHByb3ZhbHM7CgogICAgLy8vIEBkZXYgVGhlIGF1dGhvcml6ZWQgb3BlcmF0b3JzIGZvciBlYWNoIGFkZHJlc3MKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSkgaW50ZXJuYWwgb3BlcmF0b3JBcHByb3ZhbHM7CgogICAgLy8vIEBkZXYgR3VhcmFudGVlcyBtc2cuc2VuZGVyIGlzIHRoZSBvd25lciBvZiBfdG9rZW5JZAogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgdG9rZW4gdG8gdmFsaWRhdGUgYmVsb25ncyB0byBtc2cuc2VuZGVyCiAgICBtb2RpZmllciBvbmx5T3duZXJPZih1aW50MjU2IF90b2tlbklkKSB7CiAgICAgICAgYWRkcmVzcyBvd25lciA9IF90b2tlbk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbX3Rva2VuSWRdOwogICAgICAgIC8vIGFzc2VydChtc2cuc2VuZGVyICE9IGFkZHJlc3ModGhpcykpCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG11c3RCZU93bmVkQnlUaGlzQ29udHJhY3QodWludDI1NiBfdG9rZW5JZCkgewogICAgICAgIHJlcXVpcmUoX3Rva2VuSWQgPj0gMSAmJiBfdG9rZW5JZCA8PSBUT1RBTF9TVVBQTFkpOwogICAgICAgIGFkZHJlc3Mgb3duZXIgPSBfdG9rZW5Pd25lcldpdGhTdWJzdGl0dXRpb25zW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKG93bmVyID09IGFkZHJlc3MoMCkgfHwgb3duZXIgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBjYW5PcGVyYXRlKHVpbnQyNTYgX3Rva2VuSWQpIHsKICAgICAgICAvLyBhc3NlcnQobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKQogICAgICAgIGFkZHJlc3Mgb3duZXIgPSBfdG9rZW5Pd25lcldpdGhTdWJzdGl0dXRpb25zW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgb3BlcmF0b3JBcHByb3ZhbHNbb3duZXJdW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNhblRyYW5zZmVyKHVpbnQyNTYgX3Rva2VuSWQpIHsKICAgICAgICAvLyBhc3NlcnQobXNnLnNlbmRlciAhPSBhZGRyZXNzKHRoaXMpKQogICAgICAgIGFkZHJlc3Mgb3duZXIgPSBfdG9rZW5Pd25lcldpdGhTdWJzdGl0dXRpb25zW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwKICAgICAgICAgIG1zZy5zZW5kZXIgPT0gdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdIHx8CiAgICAgICAgICBvcGVyYXRvckFwcHJvdmFsc1ttc2cuc2VuZGVyXVttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdXN0QmVWYWxpZFRva2VuKHVpbnQyNTYgX3Rva2VuSWQpIHsKICAgICAgICByZXF1aXJlKF90b2tlbklkID49IDEgJiYgX3Rva2VuSWQgPD0gVE9UQUxfU1VQUExZKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZW1pdHMgd2hlbiBvd25lcnNoaXAgb2YgYW55IE5GVCBjaGFuZ2VzIGJ5IGFueSBtZWNoYW5pc20uCiAgICAvLy8gIFRoaXMgZXZlbnQgZW1pdHMgd2hlbiBORlRzIGFyZSBjcmVhdGVkIChgZnJvbWAgPT0gMCkgYW5kIGRlc3Ryb3llZAogICAgLy8vICAoYHRvYCA9PSAwKS4gRXhjZXB0aW9uOiBkdXJpbmcgY29udHJhY3QgY3JlYXRpb24sIGFueSBudW1iZXIgb2YgTkZUcwogICAgLy8vICBtYXkgYmUgY3JlYXRlZCBhbmQgYXNzaWduZWQgd2l0aG91dCBlbWl0dGluZyBUcmFuc2Zlci4gQXQgdGhlIHRpbWUgb2YKICAgIC8vLyAgYW55IHRyYW5zZmVyLCB0aGUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgdGhhdCBORlQgKGlmIGFueSkgaXMgcmVzZXQgdG8gbm9uZS4KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5JZCk7CgogICAgLy8vIEBkZXYgVGhpcyBlbWl0cyB3aGVuIHRoZSBhcHByb3ZlZCBhZGRyZXNzIGZvciBhbiBORlQgaXMgY2hhbmdlZCBvcgogICAgLy8vICByZWFmZmlybWVkLiBUaGUgemVybyBhZGRyZXNzIGluZGljYXRlcyB0aGVyZSBpcyBubyBhcHByb3ZlZCBhZGRyZXNzLgogICAgLy8vICBXaGVuIGEgVHJhbnNmZXIgZXZlbnQgZW1pdHMsIHRoaXMgYWxzbyBpbmRpY2F0ZXMgdGhhdCB0aGUgYXBwcm92ZWQKICAgIC8vLyAgYWRkcmVzcyBmb3IgdGhhdCBORlQgKGlmIGFueSkgaXMgcmVzZXQgdG8gbm9uZS4KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfYXBwcm92ZWQsIHVpbnQyNTYgX3Rva2VuSWQpOwoKICAgIC8vLyBAZGV2IFRoaXMgZW1pdHMgd2hlbiBhbiBvcGVyYXRvciBpcyBlbmFibGVkIG9yIGRpc2FibGVkIGZvciBhbiBvd25lci4KICAgIC8vLyAgVGhlIG9wZXJhdG9yIGNhbiBtYW5hZ2UgYWxsIE5GVHMgb2YgdGhlIG93bmVyLgogICAgZXZlbnQgQXBwcm92YWxGb3JBbGwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9vcGVyYXRvciwgYm9vbCBfYXBwcm92ZWQpOwoKICAgIC8vLyBAbm90aWNlIENvdW50IGFsbCBORlRzIGFzc2lnbmVkIHRvIGFuIG93bmVyCiAgICAvLy8gQGRldiBORlRzIGFzc2lnbmVkIHRvIHRoZSB6ZXJvIGFkZHJlc3MgYXJlIGNvbnNpZGVyZWQgaW52YWxpZCwgYW5kIHRoaXMKICAgIC8vLyAgZnVuY3Rpb24gdGhyb3dzIGZvciBxdWVyaWVzIGFib3V0IHRoZSB6ZXJvIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBbiBhZGRyZXNzIGZvciB3aG9tIHRvIHF1ZXJ5IHRoZSBiYWxhbmNlCiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIE5GVHMgb3duZWQgYnkgYF9vd25lcmAsIHBvc3NpYmx5IHplcm8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmV0dXJuIF90b2tlbnNPZk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbX293bmVyXS5sZW5ndGg7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRmluZCB0aGUgb3duZXIgb2YgYW4gTkZUCiAgICAvLy8gQGRldiBORlRzIGFzc2lnbmVkIHRvIHplcm8gYWRkcmVzcyBhcmUgY29uc2lkZXJlZCBpbnZhbGlkLCBhbmQgcXVlcmllcwogICAgLy8vICBhYm91dCB0aGVtIGRvIHRocm93LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgaWRlbnRpZmllciBmb3IgYW4gTkZUCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIgb2YgdGhlIE5GVAogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIG11c3RCZVZhbGlkVG9rZW4oX3Rva2VuSWQpCiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpCiAgICB7CiAgICAgICAgX293bmVyID0gX3Rva2VuT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tfdG9rZW5JZF07CiAgICAgICAgLy8gSGFuZGxlIHN1YnN0aXR1dGlvbnMKICAgICAgICBpZiAoX293bmVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgX293bmVyID0gYWRkcmVzcyh0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIHRoZSBvd25lcnNoaXAgb2YgYW4gTkZUIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlciBhZGRyZXNzCiAgICAvLy8gQGRldiBUaHJvd3MgdW5sZXNzIGBtc2cuc2VuZGVyYCBpcyB0aGUgY3VycmVudCBvd25lciwgYW4gYXV0aG9yaXplZAogICAgLy8vICBvcGVyYXRvciwgb3IgdGhlIGFwcHJvdmVkIGFkZHJlc3MgZm9yIHRoaXMgTkZULiBUaHJvd3MgaWYgYF9mcm9tYCBpcwogICAgLy8vICBub3QgdGhlIGN1cnJlbnQgb3duZXIuIFRocm93cyBpZiBgX3RvYCBpcyB0aGUgemVybyBhZGRyZXNzLiBUaHJvd3MgaWYKICAgIC8vLyAgYF90b2tlbklkYCBpcyBub3QgYSB2YWxpZCBORlQuIFdoZW4gdHJhbnNmZXIgaXMgY29tcGxldGUsIHRoaXMgZnVuY3Rpb24KICAgIC8vLyAgY2hlY2tzIGlmIGBfdG9gIGlzIGEgc21hcnQgY29udHJhY3QgKGNvZGUgc2l6ZSA+IDApLiBJZiBzbywgaXQgY2FsbHMKICAgIC8vLyAgYG9uRVJDNzIxUmVjZWl2ZWRgIG9uIGBfdG9gIGFuZCB0aHJvd3MgaWYgdGhlIHJldHVybiB2YWx1ZSBpcyBub3QKICAgIC8vLyAgYGJ5dGVzNChrZWNjYWsyNTYoIm9uRVJDNzIxUmVjZWl2ZWQoYWRkcmVzcyx1aW50MjU2LGJ5dGVzKSIpKWAuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSBORlQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBuZXcgb3duZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIE5GVCB0byB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBkYXRhIEFkZGl0aW9uYWwgZGF0YSB3aXRoIG5vIHNwZWNpZmllZCBmb3JtYXQsIHNlbnQgaW4gY2FsbCB0byBgX3RvYAogICAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCwgYnl0ZXMgZGF0YSkgZXh0ZXJuYWwgcGF5YWJsZQogICAgewogICAgICAgIF9zYWZlVHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF90b2tlbklkLCBkYXRhKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlcnMgdGhlIG93bmVyc2hpcCBvZiBhbiBORlQgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyIGFkZHJlc3MKICAgIC8vLyBAZGV2IFRoaXMgd29ya3MgaWRlbnRpY2FsbHkgdG8gdGhlIG90aGVyIGZ1bmN0aW9uIHdpdGggYW4gZXh0cmEgZGF0YSBwYXJhbWV0ZXIsCiAgICAvLy8gIGV4Y2VwdCB0aGlzIGZ1bmN0aW9uIGp1c3Qgc2V0cyBkYXRhIHRvICIiCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSBORlQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBuZXcgb3duZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIE5GVCB0byB0cmFuc2ZlcgogICAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgcGF5YWJsZQogICAgewogICAgICAgIF9zYWZlVHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF90b2tlbklkLCAiIik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgb3duZXJzaGlwIG9mIGFuIE5GVCAtLSBUSEUgQ0FMTEVSIElTIFJFU1BPTlNJQkxFCiAgICAvLy8gIFRPIENPTkZJUk0gVEhBVCBgX3RvYCBJUyBDQVBBQkxFIE9GIFJFQ0VJVklORyBORlRTIE9SIEVMU0UKICAgIC8vLyAgVEhFWSBNQVkgQkUgUEVSTUFORU5UTFkgTE9TVAogICAgLy8vIEBkZXYgVGhyb3dzIHVubGVzcyBgbXNnLnNlbmRlcmAgaXMgdGhlIGN1cnJlbnQgb3duZXIsIGFuIGF1dGhvcml6ZWQKICAgIC8vLyAgb3BlcmF0b3IsIG9yIHRoZSBhcHByb3ZlZCBhZGRyZXNzIGZvciB0aGlzIE5GVC4gVGhyb3dzIGlmIGBfZnJvbWAgaXMKICAgIC8vLyAgbm90IHRoZSBjdXJyZW50IG93bmVyLiBUaHJvd3MgaWYgYF90b2AgaXMgdGhlIHplcm8gYWRkcmVzcy4gVGhyb3dzIGlmCiAgICAvLy8gIGBfdG9rZW5JZGAgaXMgbm90IGEgdmFsaWQgTkZULgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgY3VycmVudCBvd25lciBvZiB0aGUgTkZUCiAgICAvLy8gQHBhcmFtIF90byBUaGUgbmV3IG93bmVyCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBORlQgdG8gdHJhbnNmZXIKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICBtdXN0QmVWYWxpZFRva2VuKF90b2tlbklkKQogICAgICAgIGNhblRyYW5zZmVyKF90b2tlbklkKQogICAgewogICAgICAgIGFkZHJlc3Mgb3duZXIgPSBfdG9rZW5Pd25lcldpdGhTdWJzdGl0dXRpb25zW190b2tlbklkXTsKICAgICAgICAvLyBIYW5kbGUgc3Vic3RpdHV0aW9ucwogICAgICAgIGlmIChvd25lciA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyID0gYWRkcmVzcyh0aGlzKTsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShvd25lciA9PSBfZnJvbSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgX3RyYW5zZmVyKF90b2tlbklkLCBfdG8pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBvciByZWFmZmlybSB0aGUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgYW4gTkZUCiAgICAvLy8gQGRldiBUaGUgemVybyBhZGRyZXNzIGluZGljYXRlcyB0aGVyZSBpcyBubyBhcHByb3ZlZCBhZGRyZXNzLgogICAgLy8vIEBkZXYgVGhyb3dzIHVubGVzcyBgbXNnLnNlbmRlcmAgaXMgdGhlIGN1cnJlbnQgTkZUIG93bmVyLCBvciBhbiBhdXRob3JpemVkCiAgICAvLy8gIG9wZXJhdG9yIG9mIHRoZSBjdXJyZW50IG93bmVyLgogICAgLy8vIEBwYXJhbSBfYXBwcm92ZWQgVGhlIG5ldyBhcHByb3ZlZCBORlQgY29udHJvbGxlcgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgTkZUIHRvIGFwcHJvdmUKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfYXBwcm92ZWQsIHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICAgICAgLy8gYXNzZXJ0KG11c3RCZVZhbGlkVG9rZW4oX3Rva2VuSWQpKQogICAgICAgIGNhbk9wZXJhdGUoX3Rva2VuSWQpCiAgICB7CiAgICAgICAgYWRkcmVzcyBfb3duZXIgPSBfdG9rZW5Pd25lcldpdGhTdWJzdGl0dXRpb25zW190b2tlbklkXTsKICAgICAgICAvLyBIYW5kbGUgc3Vic3RpdHV0aW9ucwogICAgICAgIGlmIChfb3duZXIgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBfb3duZXIgPSBhZGRyZXNzKHRoaXMpOwogICAgICAgIH0KICAgICAgICB0b2tlbkFwcHJvdmFsc1tfdG9rZW5JZF0gPSBfYXBwcm92ZWQ7CiAgICAgICAgZW1pdCBBcHByb3ZhbChfb3duZXIsIF9hcHByb3ZlZCwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEVuYWJsZSBvciBkaXNhYmxlIGFwcHJvdmFsIGZvciBhIHRoaXJkIHBhcnR5ICgib3BlcmF0b3IiKSB0byBtYW5hZ2UKICAgIC8vLyAgYWxsIHlvdXIgYXNzZXQuCiAgICAvLy8gQGRldiBFbWl0cyB0aGUgQXBwcm92YWxGb3JBbGwgZXZlbnQKICAgIC8vLyBAcGFyYW0gX29wZXJhdG9yIEFkZHJlc3MgdG8gYWRkIHRvIHRoZSBzZXQgb2YgYXV0aG9yaXplZCBvcGVyYXRvcnMuCiAgICAvLy8gQHBhcmFtIF9hcHByb3ZlZCBUcnVlIGlmIHRoZSBvcGVyYXRvcnMgaXMgYXBwcm92ZWQsIGZhbHNlIHRvIHJldm9rZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gc2V0QXBwcm92YWxGb3JBbGwoYWRkcmVzcyBfb3BlcmF0b3IsIGJvb2wgX2FwcHJvdmVkKSBleHRlcm5hbCB7CiAgICAgICAgb3BlcmF0b3JBcHByb3ZhbHNbbXNnLnNlbmRlcl1bX29wZXJhdG9yXSA9IF9hcHByb3ZlZDsKICAgICAgICBlbWl0IEFwcHJvdmFsRm9yQWxsKG1zZy5zZW5kZXIsIF9vcGVyYXRvciwgX2FwcHJvdmVkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgdGhlIGFwcHJvdmVkIGFkZHJlc3MgZm9yIGEgc2luZ2xlIE5GVAogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBfdG9rZW5JZGAgaXMgbm90IGEgdmFsaWQgTkZUCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBORlQgdG8gZmluZCB0aGUgYXBwcm92ZWQgYWRkcmVzcyBmb3IKICAgIC8vLyBAcmV0dXJuIFRoZSBhcHByb3ZlZCBhZGRyZXNzIGZvciB0aGlzIE5GVCwgb3IgdGhlIHplcm8gYWRkcmVzcyBpZiB0aGVyZSBpcyBub25lCiAgICBmdW5jdGlvbiBnZXRBcHByb3ZlZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIG11c3RCZVZhbGlkVG9rZW4oX3Rva2VuSWQpCiAgICAgICAgcmV0dXJucyAoYWRkcmVzcykKICAgIHsKICAgICAgICByZXR1cm4gdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFF1ZXJ5IGlmIGFuIGFkZHJlc3MgaXMgYW4gYXV0aG9yaXplZCBvcGVyYXRvciBmb3IgYW5vdGhlciBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlIE5GVHMKICAgIC8vLyBAcGFyYW0gX29wZXJhdG9yIFRoZSBhZGRyZXNzIHRoYXQgYWN0cyBvbiBiZWhhbGYgb2YgdGhlIG93bmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfb3BlcmF0b3JgIGlzIGFuIGFwcHJvdmVkIG9wZXJhdG9yIGZvciBgX293bmVyYCwgZmFsc2Ugb3RoZXJ3aXNlCiAgICBmdW5jdGlvbiBpc0FwcHJvdmVkRm9yQWxsKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9vcGVyYXRvcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG9wZXJhdG9yQXBwcm92YWxzW19vd25lcl1bX29wZXJhdG9yXTsKICAgIH0KCiAgICAvLyBDT01QTElBTkNFIFdJVEggRVJDNzIxTWV0YWRhdGEgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQSBkZXNjcmlwdGl2ZSBuYW1lIGZvciBhIGNvbGxlY3Rpb24gb2YgTkZUcyBpbiB0aGlzIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBuYW1lKCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gIlN1IFNxdWFyZXMiOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFuIGFiYnJldmlhdGVkIG5hbWUgZm9yIE5GVHMgaW4gdGhpcyBjb250cmFjdAogICAgZnVuY3Rpb24gc3ltYm9sKCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gIlNVIjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBIGRpc3RpbmN0IFVuaWZvcm0gUmVzb3VyY2UgSWRlbnRpZmllciAoVVJJKSBmb3IgYSBnaXZlbiBhc3NldC4KICAgIC8vLyBAZGV2IFRocm93cyBpZiBgX3Rva2VuSWRgIGlzIG5vdCBhIHZhbGlkIE5GVC4gVVJJcyBhcmUgZGVmaW5lZCBpbiBSRkMKICAgIC8vLyAgMzk4Ni4gVGhlIFVSSSBtYXkgcG9pbnQgdG8gYSBKU09OIGZpbGUgdGhhdCBjb25mb3JtcyB0byB0aGUgIkVSQzcyMQogICAgLy8vICBNZXRhZGF0YSBKU09OIFNjaGVtYSIuCiAgICBmdW5jdGlvbiB0b2tlblVSSSh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIG11c3RCZVZhbGlkVG9rZW4oX3Rva2VuSWQpCiAgICAgICAgcmV0dXJucyAoc3RyaW5nIF90b2tlblVSSSkKICAgIHsKICAgICAgICBfdG9rZW5VUkkgPSAiaHR0cHM6Ly90ZW50aG91c2FuZHN1LmNvbS9lcmM3MjEvMDAwMDAuanNvbiI7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF90b2tlblVSSUJ5dGVzID0gYnl0ZXMoX3Rva2VuVVJJKTsKICAgICAgICBfdG9rZW5VUklCeXRlc1szM10gPSBieXRlKDQ4KyhfdG9rZW5JZCAvIDEwMDAwKSAlIDEwKTsKICAgICAgICBfdG9rZW5VUklCeXRlc1szNF0gPSBieXRlKDQ4KyhfdG9rZW5JZCAvIDEwMDApICUgMTApOwogICAgICAgIF90b2tlblVSSUJ5dGVzWzM1XSA9IGJ5dGUoNDgrKF90b2tlbklkIC8gMTAwKSAlIDEwKTsKICAgICAgICBfdG9rZW5VUklCeXRlc1szNl0gPSBieXRlKDQ4KyhfdG9rZW5JZCAvIDEwKSAlIDEwKTsKICAgICAgICBfdG9rZW5VUklCeXRlc1szN10gPSBieXRlKDQ4KyhfdG9rZW5JZCAvIDEpICUgMTApOwoKICAgIH0KCiAgICAvLyBDT01QTElBTkNFIFdJVEggRVJDNzIxRW51bWVyYWJsZSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ291bnQgTkZUcyB0cmFja2VkIGJ5IHRoaXMgY29udHJhY3QKICAgIC8vLyBAcmV0dXJuIEEgY291bnQgb2YgdmFsaWQgTkZUcyB0cmFja2VkIGJ5IHRoaXMgY29udHJhY3QsIHdoZXJlIGVhY2ggb25lIG9mCiAgICAvLy8gIHRoZW0gaGFzIGFuIGFzc2lnbmVkIGFuZCBxdWVyeWFibGUgb3duZXIgbm90IGVxdWFsIHRvIHRoZSB6ZXJvIGFkZHJlc3MKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIFRPVEFMX1NVUFBMWTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBFbnVtZXJhdGUgdmFsaWQgTkZUcwogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBfaW5kZXhgID49IGB0b3RhbFN1cHBseSgpYC4KICAgIC8vLyBAcGFyYW0gX2luZGV4IEEgY291bnRlciBsZXNzIHRoYW4gYHRvdGFsU3VwcGx5KClgCiAgICAvLy8gQHJldHVybiBUaGUgdG9rZW4gaWRlbnRpZmllciBmb3IgdGhlIGBfaW5kZXhgdGggTkZULAogICAgLy8vICAoc29ydCBvcmRlciBub3Qgc3BlY2lmaWVkKQogICAgZnVuY3Rpb24gdG9rZW5CeUluZGV4KHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IFRPVEFMX1NVUFBMWSk7CiAgICAgICAgcmV0dXJuIF9pbmRleCArIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRW51bWVyYXRlIE5GVHMgYXNzaWduZWQgdG8gYW4gb3duZXIKICAgIC8vLyBAZGV2IFRocm93cyBpZiBgX2luZGV4YCA+PSBgYmFsYW5jZU9mKF9vd25lcilgIG9yIGlmCiAgICAvLy8gIGBfb3duZXJgIGlzIHRoZSB6ZXJvIGFkZHJlc3MsIHJlcHJlc2VudGluZyBpbnZhbGlkIE5GVHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBbiBhZGRyZXNzIHdoZXJlIHdlIGFyZSBpbnRlcmVzdGVkIGluIE5GVHMgb3duZWQgYnkgdGhlbQogICAgLy8vIEBwYXJhbSBfaW5kZXggQSBjb3VudGVyIGxlc3MgdGhhbiBgYmFsYW5jZU9mKF9vd25lcilgCiAgICAvLy8gQHJldHVybiBUaGUgdG9rZW4gaWRlbnRpZmllciBmb3IgdGhlIGBfaW5kZXhgdGggTkZUIGFzc2lnbmVkIHRvIGBfb3duZXJgLAogICAgLy8vICAgKHNvcnQgb3JkZXIgbm90IHNwZWNpZmllZCkKICAgIGZ1bmN0aW9uIHRva2VuT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgX3Rva2VuSWQpIHsKICAgICAgICByZXF1aXJlKF9vd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IF90b2tlbnNPZk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbX293bmVyXS5sZW5ndGgpOwogICAgICAgIF90b2tlbklkID0gX3Rva2Vuc09mT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tfb3duZXJdW19pbmRleF07CiAgICAgICAgLy8gSGFuZGxlIHN1YnN0aXR1dGlvbnMKICAgICAgICBpZiAoX293bmVyID09IGFkZHJlc3ModGhpcykpIHsKICAgICAgICAgICAgaWYgKF90b2tlbklkID09IDApIHsKICAgICAgICAgICAgICAgIF90b2tlbklkID0gX2luZGV4ICsgMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBJTlRFUk5BTCBJTlRFUkZBQ0UgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgQWN0dWFsbHkgZG8gYSB0cmFuc2ZlciwgZG9lcyBOTyBwcmVjb25kaXRpb24gY2hlY2tpbmcKICAgIGZ1bmN0aW9uIF90cmFuc2Zlcih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF90bykgaW50ZXJuYWwgewogICAgICAgIC8vIEhlcmUgYXJlIHRoZSBwcmVjb25kaXRpb25zIHdlIGFyZSBub3QgY2hlY2tpbmc6CiAgICAgICAgLy8gYXNzZXJ0KGNhblRyYW5zZmVyKF90b2tlbklkKSkKICAgICAgICAvLyBhc3NlcnQobXVzdEJlVmFsaWRUb2tlbihfdG9rZW5JZCkpCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIEZpbmQgdGhlIEZST00gYWRkcmVzcwogICAgICAgIGFkZHJlc3MgZnJvbVdpdGhTdWJzdGl0dXRpb24gPSBfdG9rZW5Pd25lcldpdGhTdWJzdGl0dXRpb25zW190b2tlbklkXTsKICAgICAgICBhZGRyZXNzIGZyb20gPSBmcm9tV2l0aFN1YnN0aXR1dGlvbjsKICAgICAgICBpZiAoZnJvbVdpdGhTdWJzdGl0dXRpb24gPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBmcm9tID0gYWRkcmVzcyh0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8vIFRha2UgYXdheSBmcm9tIHRoZSBGUk9NIGFkZHJlc3MKICAgICAgICAvLyBUaGUgRW50cmlrZW4gYWxnb3JpdGhtIGZvciBkZWxldGluZyBmcm9tIGFuIGluZGV4ZWQsIHVuc29ydGVkIGFycmF5CiAgICAgICAgdWludDI1NiBpbmRleFRvRGVsZXRlV2l0aFN1YnN0aXR1dGlvbiA9IF9vd25lZFRva2Vuc0luZGV4V2l0aFN1YnN0aXR1dGlvbnNbX3Rva2VuSWRdOwogICAgICAgIHVpbnQyNTYgaW5kZXhUb0RlbGV0ZTsKICAgICAgICBpZiAoaW5kZXhUb0RlbGV0ZVdpdGhTdWJzdGl0dXRpb24gPT0gMCkgewogICAgICAgICAgICBpbmRleFRvRGVsZXRlID0gX3Rva2VuSWQgLSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGluZGV4VG9EZWxldGUgPSBpbmRleFRvRGVsZXRlV2l0aFN1YnN0aXR1dGlvbiAtIDE7CiAgICAgICAgfQogICAgICAgIGlmIChpbmRleFRvRGVsZXRlICE9IF90b2tlbnNPZk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbZnJvbV0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgICB1aW50MjU2IGxhc3ROZnRXaXRoU3Vic3RpdHV0aW9uID0gX3Rva2Vuc09mT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tmcm9tXVtfdG9rZW5zT2ZPd25lcldpdGhTdWJzdGl0dXRpb25zW2Zyb21dLmxlbmd0aCAtIDFdOwogICAgICAgICAgICB1aW50MjU2IGxhc3ROZnQgPSBsYXN0TmZ0V2l0aFN1YnN0aXR1dGlvbjsKICAgICAgICAgICAgaWYgKGxhc3ROZnRXaXRoU3Vic3RpdHV0aW9uID09IDApIHsKICAgICAgICAgICAgICAgIC8vIGFzc2VydChmcm9tID09ICBhZGRyZXNzKDApIHx8IGZyb20gPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgICAgICAgICBsYXN0TmZ0ID0gX3Rva2Vuc09mT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tmcm9tXS5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3Rva2Vuc09mT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tmcm9tXVtpbmRleFRvRGVsZXRlXSA9IGxhc3ROZnQ7CiAgICAgICAgICAgIF9vd25lZFRva2Vuc0luZGV4V2l0aFN1YnN0aXR1dGlvbnNbbGFzdE5mdF0gPSBpbmRleFRvRGVsZXRlICsgMTsKICAgICAgICB9CiAgICAgICAgZGVsZXRlIF90b2tlbnNPZk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbZnJvbV1bX3Rva2Vuc09mT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tmcm9tXS5sZW5ndGggLSAxXTsgLy8gZ2V0IGdhcyBiYWNrCiAgICAgICAgX3Rva2Vuc09mT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tmcm9tXS5sZW5ndGgtLTsKICAgICAgICAvLyBSaWdodCBub3cgX293bmVkVG9rZW5zSW5kZXhXaXRoU3Vic3RpdHV0aW9uc1tfdG9rZW5JZF0gaXMgaW52YWxpZCwgc2V0IGl0IGJlbG93IGJhc2VkIG9uIHRoZSBuZXcgb3duZXIKCiAgICAgICAgLy8gR2l2ZSB0byB0aGUgVE8gYWRkcmVzcwogICAgICAgIF90b2tlbnNPZk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbX3RvXS5wdXNoKF90b2tlbklkKTsKICAgICAgICBfb3duZWRUb2tlbnNJbmRleFdpdGhTdWJzdGl0dXRpb25zW190b2tlbklkXSA9IChfdG9rZW5zT2ZPd25lcldpdGhTdWJzdGl0dXRpb25zW190b10ubGVuZ3RoIC0gMSkgKyAxOwoKICAgICAgICAvLyBFeHRlcm5hbCBwcm9jZXNzaW5nCiAgICAgICAgX3Rva2VuT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tfdG9rZW5JZF0gPSBfdG87CiAgICAgICAgdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdID0gYWRkcmVzcygwKTsKICAgICAgICBlbWl0IFRyYW5zZmVyKGZyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vIFBSSVZBVEUgU1RPUkFHRSBBTkQgRlVOQ1RJT05TIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgVE9UQUxfU1VQUExZID0gMTAwMDA7IC8vIFNPTElESVRZIElTU1VFICMzMzU2IG1ha2UgdGhpcyBpbW11dGFibGUKCiAgICBieXRlczQgcHJpdmF0ZSBjb25zdGFudCBFUkM3MjFfUkVDRUlWRUQgPSBieXRlczQoa2VjY2FrMjU2KCJvbkVSQzcyMVJlY2VpdmVkKGFkZHJlc3MsdWludDI1NixieXRlcykiKSk7CgogICAgLy8vIEBkZXYgVGhlIG93bmVyIG9mIGVhY2ggTkZUCiAgICAvLy8gIElmIHZhbHVlID09IGFkZHJlc3MoMCksIE5GVCBpcyBvd25lZCBieSBhZGRyZXNzKHRoaXMpCiAgICAvLy8gIElmIHZhbHVlICE9IGFkZHJlc3MoMCksIE5GVCBpcyBvd25lZCBieSB2YWx1ZQogICAgLy8vICBhc3NlcnQoVGhpcyBjb250cmFjdCBuZXZlciBhc3NpZ25zIGF3bmVyaGlwIHRvIGFkZHJlc3MoMCkgb3IgZGVzdHJveXMgTkZUcykKICAgIC8vLyAgU2VlIGNvbW1lbnRlZCBvdXQgY29kZSBpbiBjb25zdHJ1Y3Rvciwgc2F2ZXMgaGVsbGEgZ2FzCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHByaXZhdGUgX3Rva2VuT3duZXJXaXRoU3Vic3RpdHV0aW9uczsKCiAgICAvLy8gQGRldiBUaGUgbGlzdCBvZiBORlRzIG93bmVkIGJ5IGVhY2ggYWRkcmVzcwogICAgLy8vICBOb21lbmNsYXR1cmU6IHRoaXNba2V5XVtpbmRleF0gPSB2YWx1ZQogICAgLy8vICBJZiBrZXkgIT0gYWRkcmVzcyh0aGlzKSBvciB2YWx1ZSAhPSAwLCB0aGVuIHZhbHVlIHJlcHJlc2VudHMgYW4gTkZUCiAgICAvLy8gIElmIGtleSA9PSBhZGRyZXNzKHRoaXMpIGFuZCB2YWx1ZSA9PSAwLCB0aGVuIGluZGV4ICsgMSBpcyB0aGUgTkZUCiAgICAvLy8gIGFzc2VydCgwIGlzIG5vdCBhIHZhbGlkIE5GVCkKICAgIC8vLyAgU2VlIGNvbW1lbnRlZCBvdXQgY29kZSBpbiBjb25zdHJ1Y3Rvciwgc2F2ZXMgaGVsbGEgZ2FzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTZbXSkgcHJpdmF0ZSBfdG9rZW5zT2ZPd25lcldpdGhTdWJzdGl0dXRpb25zOwoKICAgIC8vLyBAZGV2IChMb2NhdGlvbiArIDEpIG9mIGVhY2ggTkZUIGluIGl0cyBvd25lcidzIGxpc3QKICAgIC8vLyAgTm9tZW5jbGF0dXJlOiB0aGlzW2tleV0gPSB2YWx1ZQogICAgLy8vICBJZiB2YWx1ZSAhPSAwLCBfdG9rZW5zT2ZPd25lcldpdGhTdWJzdGl0dXRpb25zW293bmVyXVt2YWx1ZSAtIDFdID0gbmZ0SWQKICAgIC8vLyAgSWYgdmFsdWUgPT0gMCwgX3Rva2Vuc09mT3duZXJXaXRoU3Vic3RpdHV0aW9uc1tvd25lcl1ba2V5IC0gMV0gPSBuZnRJZAogICAgLy8vICBhc3NlcnQoMioqMjU2LTEgaXMgbm90IGEgdmFsaWQgTkZUKQogICAgLy8vICBTZWUgY29tbWVudGVkIG91dCBjb2RlIGluIGNvbnN0cnVjdG9yLCBzYXZlcyBoZWxsYSBnYXMKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHJpdmF0ZSBfb3duZWRUb2tlbnNJbmRleFdpdGhTdWJzdGl0dXRpb25zOwoKICAgIC8vIER1ZSB0byBpbXBsZW1lbnRhdGlvbiBjaG9pY2VzIChubyBtaW50LCBubyBidXJuLCBjb250aWd1b3VzIE5GVCBpZHMpLCBpdAogICAgLy8gaXMgbm90IG5lY2Vzc2FyeSB0byBrZWVwIGFuIGFycmF5IG9mIE5GVCBpZHMgbm9yIHdoZXJlIGVhY2ggTkZUIGlkIGlzCiAgICAvLyBsb2NhdGVkIGluIHRoYXQgYXJyYXkuCiAgICAvLyBhZGRyZXNzW10gcHJpdmF0ZSBuZnRJZHM7CiAgICAvLyBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIHByaXZhdGUgbmZ0SW5kZXhPZklkOwoKICAgIGZ1bmN0aW9uIFN1TkZUKCkgaW50ZXJuYWwgewogICAgICAgIC8vIFB1Ymxpc2ggaW50ZXJmYWNlcyB3aXRoIEVSQy0xNjUKICAgICAgICBzdXBwb3J0ZWRJbnRlcmZhY2VzWzB4ODBhYzU4Y2RdID0gdHJ1ZTsgLy8gRVJDNzIxCiAgICAgICAgc3VwcG9ydGVkSW50ZXJmYWNlc1sweDViNWUxMzlmXSA9IHRydWU7IC8vIEVSQzcyMU1ldGFkYXRhCiAgICAgICAgc3VwcG9ydGVkSW50ZXJmYWNlc1sweDc4MGU5ZDYzXSA9IHRydWU7IC8vIEVSQzcyMUVudW1lcmFibGUKICAgICAgICBzdXBwb3J0ZWRJbnRlcmZhY2VzWzB4ODE1MzkxNmFdID0gdHJ1ZTsgLy8gRVJDNzIxICsgMTY1IChub3QgbmVlZGVkKQoKICAgICAgICAvLyBUaGUgZWZmZWN0IG9mIHN1YnN0aXR1dGlvbiBtYWtlcyBzdG9yaW5nIGFkZHJlc3ModGhpcyksIGFkZHJlc3ModGhpcykKICAgICAgICAvLyAuLi4sIGFkZHJlc3ModGhpcykgZm9yIGEgdG90YWwgb2YgVE9UQUxfU1VQUExZIHRpbWVzIHVubmVjZXNzYXJ5IGF0CiAgICAgICAgLy8gZGVwbG95bWVudCB0aW1lCiAgICAgICAgLy8gZm9yICh1aW50MjU2IGkgPSAxOyBpIDw9IFRPVEFMX1NVUFBMWTsgaSsrKSB7CiAgICAgICAgLy8gICAgIF90b2tlbk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbaV0gPSBhZGRyZXNzKHRoaXMpOwogICAgICAgIC8vIH0KCiAgICAgICAgLy8gVGhlIGVmZmVjdCBvZiBzdWJzdGl0dXRpb24gbWFrZXMgc3RvcmluZyAxLCAyLCAuLi4sIFRPVEFMX1NVUFBMWQogICAgICAgIC8vIHVubmVjZXNzYXJ5IGF0IGRlcGxveW1lbnQgdGltZQogICAgICAgIF90b2tlbnNPZk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbYWRkcmVzcyh0aGlzKV0ubGVuZ3RoID0gVE9UQUxfU1VQUExZOwogICAgICAgIC8vIGZvciAodWludDI1NiBpID0gMDsgaSA8IFRPVEFMX1NVUFBMWTsgaSsrKSB7CiAgICAgICAgLy8gICAgIF90b2tlbnNPZk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbYWRkcmVzcyh0aGlzKV1baV0gPSBpICsgMTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gZm9yICh1aW50MjU2IGkgPSAxOyBpIDw9IFRPVEFMX1NVUFBMWTsgaSsrKSB7CiAgICAgICAgLy8gICAgIF9vd25lZFRva2Vuc0luZGV4V2l0aFN1YnN0aXR1dGlvbnNbaV0gPSBpIC0gMTsKICAgICAgICAvLyB9CiAgICB9CgogICAgLy8vIEBkZXYgQWN0dWFsbHkgcGVyZm9ybSB0aGUgc2FmZVRyYW5zZmVyRnJvbQogICAgZnVuY3Rpb24gX3NhZmVUcmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQsIGJ5dGVzIGRhdGEpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIG11c3RCZVZhbGlkVG9rZW4oX3Rva2VuSWQpCiAgICAgICAgY2FuVHJhbnNmZXIoX3Rva2VuSWQpCiAgICB7CiAgICAgICAgYWRkcmVzcyBvd25lciA9IF90b2tlbk93bmVyV2l0aFN1YnN0aXR1dGlvbnNbX3Rva2VuSWRdOwogICAgICAgIC8vIEhhbmRsZSBzdWJzdGl0dXRpb25zCiAgICAgICAgaWYgKG93bmVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXIgPSBhZGRyZXNzKHRoaXMpOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKG93bmVyID09IF9mcm9tKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfdHJhbnNmZXIoX3Rva2VuSWQsIF90byk7CgogICAgICAgIC8vIERvIHRoZSBjYWxsYmFjayBhZnRlciBldmVyeXRoaW5nIGlzIGRvbmUgdG8gYXZvaWQgcmVlbnRyYW5jeSBhdHRhY2sKICAgICAgICB1aW50MjU2IGNvZGVTaXplOwogICAgICAgIGFzc2VtYmx5IHsgY29kZVNpemUgOj0gZXh0Y29kZXNpemUoX3RvKSB9CiAgICAgICAgaWYgKGNvZGVTaXplID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBieXRlczQgcmV0dmFsID0gRVJDNzIxVG9rZW5SZWNlaXZlcihfdG8pLm9uRVJDNzIxUmVjZWl2ZWQoX2Zyb20sIF90b2tlbklkLCBkYXRhKTsKICAgICAgICByZXF1aXJlKHJldHZhbCA9PSBFUkM3MjFfUkVDRUlWRUQpOwogICAgfQp9CgovKiBTdU9wZXJhdGlvbi5zb2wgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKLy8vIEB0aXRsZSBUaGUgZmVhdHVyZXMgdGhhdCBzcXVhcmUgb3duZXJzIGNhbiB1c2UKLy8vIEBhdXRob3IgV2lsbGlhbSBFbnRyaWtlbiAoaHR0cHM6Ly9waG9yLm5ldCkKLy8vIEBkZXYgU2VlIFN1TWFpbiBjb250cmFjdCBkb2N1bWVudGF0aW9uIGZvciBkZXRhaWwgb24gaG93IGNvbnRyYWN0cyBpbnRlcmFjdC4KY29udHJhY3QgU3VPcGVyYXRpb24gaXMgU3VORlQgewogICAgLy8vIEBkZXYgVGhlIHBlcnNvbmFsaXphdGlvbiBvZiBhIHNxdWFyZSBoYXMgY2hhbmdlZAogICAgZXZlbnQgUGVyc29uYWxpemVkKHVpbnQyNTYgX25mdElkKTsKCiAgICAvLy8gQGRldiBUaGUgbWFpbiBTdVNxdWFyZSBzdHJ1Y3QuIFRoZSBvd25lciBtYXkgc2V0IHRoZXNlIHByb3BlcnRpZXMsIHN1YmplY3QKICAgIC8vLyAgc3ViamVjdCB0byBjZXJ0YWluIHJ1bGVzLiBUaGUgYWN0dWFsIDEweDEwIGltYWdlIGlzIHJlbmRlcmVkIG9uIG91cgogICAgLy8vICB3ZWJzaXRlIHVzaW5nIHRoaXMgZGF0YS4KICAgIHN0cnVjdCBTdVNxdWFyZSB7CiAgICAgICAgLy8vIEBkZXYgVGhpcyBpbmNyZW1lbnRzIG9uIGVhY2ggdXBkYXRlCiAgICAgICAgdWludDI1NiB2ZXJzaW9uOwoKICAgICAgICAvLy8gQGRldiBBIDEweDEwIHBpeGVsIGltYWdlLCBzdG9yZWQgOC1iaXQgUkdCIHZhbHVlcyBmcm9tIGxlZnQtdG8tcmlnaHQKICAgICAgICAvLy8gIGFuZCB0b3AtdG8tYm90dG9tIG9yZGVyIChub3JtYWwgRW5nbGlzaCByZWFkaW5nIG9yZGVyKS4gU28gaXQgaXMKICAgICAgICAvLy8gIGV4YWN0bHkgMzAwIGJ5dGVzLiBPciBpdCBpcyBhbiBlbXB0eSBhcnJheS4KICAgICAgICAvLy8gIFNvIHRoZSBmaXJzdCBieXRlIGlzIHRoZSByZWQgY2hhbm5lbCBmb3IgdGhlIHRvcC1sZWZ0IHBpeGVsLCB0aGVuCiAgICAgICAgLy8vICB0aGUgYmx1ZSwgdGhlbiB0aGUgZ3JlZW4sIGFuZCB0aGVuIG5leHQgaXMgdGhlIHJlZCBjaGFubmVsIGZvciB0aGUKICAgICAgICAvLy8gIHBpeGVsIHRvIHRoZSByaWdodCBvZiB0aGUgZmlyc3QgcGl4ZWwuCiAgICAgICAgYnl0ZXMgcmdiRGF0YTsKCiAgICAgICAgLy8vIEBkZXYgVGhlIHRpdGxlIG9mIHRoaXMgc3F1YXJlLCBhdCBtb3N0IDY0IGJ5dGVzLAogICAgICAgIHN0cmluZyB0aXRsZTsKCiAgICAgICAgLy8vIEBkZXYgVGhlIFVSTCBvZiB0aGlzIHNxdWFyZSwgYXQgbW9zdCAxMDAgYnl0ZXMsIG9yIGVtcHR5IHN0cmluZwogICAgICAgIHN0cmluZyBocmVmOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbCB0aGUgU3UgU3F1YXJlcyB0aGF0IGV2ZXIgZXhpc3Qgb3Igd2lsbCBleGlzdC4gRWFjaCBTdSBTcXVhcmUKICAgIC8vLyAgcmVwcmVzZW50cyBhIHNxdWFyZSBvbiBvdXIgd2VicGFnZSBpbiBhIDEwMHgxMDAgZ3JpZC4gVGhlIHNxdWFyZXMgYXJlCiAgICAvLy8gIGFycmFuZ2VkIGluIGxlZnQtdG8tcmlnaHQsIHRvcC10by1ib3R0b20gb3JkZXIuIEluIG90aGVyIHdvcmRzLCBub3JtYWwKICAgIC8vLyAgRW5nbGlzaCByZWFkaW5nIG9yZGVyLiBTbyBzdVNxdWFyZXNbMV0gaXMgdGhlIHRvcC1sZWZ0IGxvY2F0aW9uIGFuZAogICAgLy8vICBzdVNxdWFyZXNbMTAwXSBpcyB0aGUgdG9wLXJpZ2h0IGxvY2F0aW9uLiBBbmQgc3VTcXVhcmVzWzEwMV0gaXMKICAgIC8vLyAgZGlyZWN0bHkgYmVsb3cgc3VTcXVhcmVzWzFdLgogICAgLy8vIEBkZXYgVGhlcmUgaXMgbm8gc3VTcXVhcmVzWzBdIC0tIHRoYXQgaXMgYW4gdW51c2VkIGFycmF5IGluZGV4LgogICAgU3VTcXVhcmVbMTAwMDFdIHB1YmxpYyBzdVNxdWFyZXM7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBjb250ZW50cyBvZiB5b3VyIHNxdWFyZSwgdGhlIGZpcnN0IDMgcGVyc29uYWxpemF0aW9ucwogICAgLy8vICBmb3IgYSBzcXVhcmUgYXJlIGZyZWUgdGhlbiBjb3N0IDEwIGZpbm5leSAoMC4wMSBldGhlcikgZWFjaAogICAgLy8vIEBwYXJhbSBfc3F1YXJlSWQgVGhlIHRvcC1sZWZ0IGlzIDEsIHRvIGl0cyByaWdodCBpcyAyLCAuLi4sIHRvcC1yaWdodCBpcwogICAgLy8vICAxMDAgYW5kIHRoZW4gMTAxIGlzIGJlbG93IDEuLi4gdGhlIGxhc3Qgb25lIGF0IGJvdHRvbS1yaWdodCBpcyAxMDAwMAogICAgLy8vIEBwYXJhbSBfc3F1YXJlSWQgQSAxMHgxMCBpbWFnZSBmb3IgeW91ciBzcXVhcmUsIGluIDgtYml0IFJHQiB3b3JkcwogICAgLy8vICBvcmRlcmVkIGxpa2UgdGhlIHNxdWFyZXMgYXJlIG9yZGVyZWQuIFNlZSBJbWFnZW1hZ2ljaydzIGNvbW1hbmQKICAgIC8vLyAgY29udmVydCAtc2l6ZSAxMHgxMCAtZGVwdGggOCBpbi5yZ2Igb3V0LnBuZwogICAgLy8vIEBwYXJhbSBfdGl0bGUgQSBkZXNjcmlwdGlvbiBvZiB5b3VyIHNxdWFyZSAobWF4IDY0IGJ5dGVzIFVURi04KQogICAgLy8vIEBwYXJhbSBfaHJlZiBBIGh5cGVybGluayBmb3IgeW91ciBzcXVhcmUgKG1heCA5NiBieXRlcykKICAgIGZ1bmN0aW9uIHBlcnNvbmFsaXplU3F1YXJlKAogICAgICAgIHVpbnQyNTYgX3NxdWFyZUlkLAogICAgICAgIGJ5dGVzIF9yZ2JEYXRhLAogICAgICAgIHN0cmluZyBfdGl0bGUsCiAgICAgICAgc3RyaW5nIF9ocmVmCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXJPZihfc3F1YXJlSWQpCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIHJlcXVpcmUoYnl0ZXMoX3RpdGxlKS5sZW5ndGggPD0gNjQpOwogICAgICAgIHJlcXVpcmUoYnl0ZXMoX2hyZWYpLmxlbmd0aCA8PSA5Nik7CiAgICAgICAgcmVxdWlyZShfcmdiRGF0YS5sZW5ndGggPT0gMzAwKTsKICAgICAgICBzdVNxdWFyZXNbX3NxdWFyZUlkXS52ZXJzaW9uKys7CiAgICAgICAgc3VTcXVhcmVzW19zcXVhcmVJZF0ucmdiRGF0YSA9IF9yZ2JEYXRhOwogICAgICAgIHN1U3F1YXJlc1tfc3F1YXJlSWRdLnRpdGxlID0gX3RpdGxlOwogICAgICAgIHN1U3F1YXJlc1tfc3F1YXJlSWRdLmhyZWYgPSBfaHJlZjsKICAgICAgICBpZiAoc3VTcXVhcmVzW19zcXVhcmVJZF0udmVyc2lvbiA+IDMpIHsKICAgICAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMTAgZmlubmV5KTsKICAgICAgICB9CiAgICAgICAgZW1pdCBQZXJzb25hbGl6ZWQoX3NxdWFyZUlkKTsKICAgIH0KfQoKLyogU3VQcm9tby5zb2wgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCi8vLyBAdGl0bGUgQSBsaW1pdGVkIHByZS1zYWxlIGFuZCBwcm9tb3Rpb25hbCBnaXZlYXdheS4KLy8vIEBhdXRob3IgV2lsbGlhbSBFbnRyaWtlbiAoaHR0cHM6Ly9waG9yLm5ldCkKLy8vIEBkZXYgU2VlIFN1TWFpbiBjb250cmFjdCBkb2N1bWVudGF0aW9uIGZvciBkZXRhaWwgb24gaG93IGNvbnRyYWN0cyBpbnRlcmFjdC4KY29udHJhY3QgU3VQcm9tbyBpcyBBY2Nlc3NDb250cm9sLCBTdU5GVCB7CiAgICB1aW50MjU2IGNvbnN0YW50IFBST01PX0NSRUFUSU9OX0xJTUlUID0gNTAwMDsKCiAgICAvLy8gQG5vdGljZSBIb3cgbWFueSBwcm9tbyBzcXVhcmVzIHdlcmUgZ3JhbnRlZAogICAgdWludDI1NiBwdWJsaWMgcHJvbW9DcmVhdGVkQ291bnQ7CgogICAgLy8vIEBub3RpY2UgQkVXQVJFLCB0aGlzIGRvZXMgbm90IHVzZSBhIHNhZmUgdHJhbnNmZXIgbWVjaGFuaXNtIQogICAgLy8vICBZb3UgbXVzdCBtYW51YWxseSBjaGVjayB0aGUgcmVjZWl2ZXIgY2FuIGFjY2VwdCBORlRzCiAgICBmdW5jdGlvbiBncmFudFRva2VuKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX25ld093bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU9wZXJhdGluZ09mZmljZXIKICAgICAgICBtdXN0QmVWYWxpZFRva2VuKF90b2tlbklkKQogICAgICAgIG11c3RCZU93bmVkQnlUaGlzQ29udHJhY3QoX3Rva2VuSWQpCiAgICB7CiAgICAgICAgcmVxdWlyZShwcm9tb0NyZWF0ZWRDb3VudCA8IFBST01PX0NSRUFUSU9OX0xJTUlUKTsKICAgICAgICBwcm9tb0NyZWF0ZWRDb3VudCsrOwogICAgICAgIF90cmFuc2ZlcihfdG9rZW5JZCwgX25ld093bmVyKTsKICAgIH0KfQoKLyogU3VWZW5kaW5nLnNvbCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCi8vLyBAdGl0bGUgQSB0b2tlbiB2ZW5kaW5nIG1hY2hpbmUKLy8vIEBhdXRob3IgV2lsbGlhbSBFbnRyaWtlbiAoaHR0cHM6Ly9waG9yLm5ldCkKLy8vIEBkZXYgU2VlIFN1TWFpbiBjb250cmFjdCBkb2N1bWVudGF0aW9uIGZvciBkZXRhaWwgb24gaG93IGNvbnRyYWN0cyBpbnRlcmFjdC4KY29udHJhY3QgU3VWZW5kaW5nIGlzIFN1TkZUIHsKICAgIHVpbnQyNTYgY29uc3RhbnQgU0FMRV9QUklDRSA9IDUwMCBmaW5uZXk7IC8vIDAuNSBldGhlcgoKICAgIC8vLyBAbm90aWNlIFRoZSBwcmljZSBpcyBhbHdheXMgMC41IGV0aGVyLCBhbmQgeW91IGNhbiBidXkgYW55IGF2YWlsYWJsZSBzcXVhcmUKICAgIC8vLyAgQmUgc3VyZSB5b3UgYXJlIGNhbGxpbmcgdGhpcyBmcm9tIGEgcmVndWxhciBhY2NvdW50IChub3QgYSBzbWFydCBjb250cmFjdCkKICAgIC8vLyAgb3IgaWYgeW91IGFyZSBjYWxsaW5nIGZyb20gYSBzbWFydCBjb250cmFjdCwgbWFrZSBzdXJlIGl0IGNhbiB1c2UKICAgIC8vLyAgRVJDLTcyMSBub24tZnVuZ2libGUgdG9rZW5zCiAgICBmdW5jdGlvbiBwdXJjaGFzZSh1aW50MjU2IF9uZnRJZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICBtdXN0QmVWYWxpZFRva2VuKF9uZnRJZCkKICAgICAgICBtdXN0QmVPd25lZEJ5VGhpc0NvbnRyYWN0KF9uZnRJZCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSBTQUxFX1BSSUNFKTsKICAgICAgICBfdHJhbnNmZXIoX25mdElkLCBtc2cuc2VuZGVyKTsKICAgIH0KfQoKLyogU3VNYWluLnNvbCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCi8vLyBAdGl0bGUgVGhlIGZlYXR1cmVzIHRoYXQgZGVlZCBvd25lcnMgY2FuIHVzZQovLy8gQGF1dGhvciBXaWxsaWFtIEVudHJpa2VuIChodHRwczovL3Bob3IubmV0KQovLy8gQGRldiBTZWUgU3VNYWluIGNvbnRyYWN0IGRvY3VtZW50YXRpb24gZm9yIGRldGFpbCBvbiBob3cgY29udHJhY3RzIGludGVyYWN0Lgpjb250cmFjdCBTdU1haW4gaXMgQWNjZXNzQ29udHJvbCwgU3VORlQsIFN1T3BlcmF0aW9uLCBTdVZlbmRpbmcsIFN1UHJvbW8gewogICAgZnVuY3Rpb24gU3VNYWluKCkgcHVibGljIHsKICAgIH0KfQ=='.
	

]
