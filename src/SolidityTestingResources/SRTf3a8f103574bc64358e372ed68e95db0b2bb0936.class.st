Class {
	#name : #SRTf3a8f103574bc64358e372ed68e95db0b2bb0936,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf3a8f103574bc64358e372ed68e95db0b2bb0936 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgovLyBjb3B5cmlnaHQgPHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzNzU0NTg1OTQzNTY1NDQzNzc3MjQzNWY1MjQ1NTI1YTU4NTkxOTU0NTg1YSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4KCmNvbnRyYWN0IFNhZmVNYXRoIHsKCiAgICAvKiBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsgKi8KICAgIC8qICAgaWYgKCFhc3NlcnRpb24pIHsgKi8KICAgIC8qICAgICB0aHJvdzsgKi8KICAgIC8qICAgfSAqLwogICAgLyogfSAgICAgIC8vIGFzc2VydCBubyBsb25nZXIgbmVlZGVkIG9uY2Ugc29saWRpdHkgaXMgb24gMC40LjEwICovCgogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiB6ID0geCArIHk7CiAgICAgIGFzc2VydCgoeiA+PSB4KSAmJiAoeiA+PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWJ0cmFjdCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgYXNzZXJ0KHggPj0geSk7CiAgICAgIHVpbnQyNTYgeiA9IHggLSB5OwogICAgICByZXR1cm4gejsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlTXVsdCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiB6ID0geCAqIHk7CiAgICAgIGFzc2VydCgoeCA9PSAwKXx8KHoveCA9PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKfQoKY29udHJhY3QgQmFzaWNBY2Nlc3NDb250cm9sIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgLy8gYWRkcmVzc1tdIHB1YmxpYyBtb2RlcmF0b3JzOwogICAgdWludDE2IHB1YmxpYyB0b3RhbE1vZGVyYXRvcnMgPSAwOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbW9kZXJhdG9yczsKICAgIGJvb2wgcHVibGljIGlzTWFpbnRhaW5pbmcgPSB0cnVlOwoKICAgIGZ1bmN0aW9uIEJhc2ljQWNjZXNzQ29udHJvbCgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlNb2RlcmF0b3JzKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lciB8fCBtb2RlcmF0b3JzW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNBY3RpdmUgewogICAgICAgIHJlcXVpcmUoIWlzTWFpbnRhaW5pbmcpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gQ2hhbmdlT3duZXIoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGlmIChfbmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lciA9IF9uZXdPd25lcjsKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIEFkZE1vZGVyYXRvcihhZGRyZXNzIF9uZXdNb2RlcmF0b3IpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGlmIChtb2RlcmF0b3JzW19uZXdNb2RlcmF0b3JdID09IGZhbHNlKSB7CiAgICAgICAgICAgIG1vZGVyYXRvcnNbX25ld01vZGVyYXRvcl0gPSB0cnVlOwogICAgICAgICAgICB0b3RhbE1vZGVyYXRvcnMgKz0gMTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFJlbW92ZU1vZGVyYXRvcihhZGRyZXNzIF9vbGRNb2RlcmF0b3IpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGlmIChtb2RlcmF0b3JzW19vbGRNb2RlcmF0b3JdID09IHRydWUpIHsKICAgICAgICAgICAgbW9kZXJhdG9yc1tfb2xkTW9kZXJhdG9yXSA9IGZhbHNlOwogICAgICAgICAgICB0b3RhbE1vZGVyYXRvcnMgLT0gMTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gVXBkYXRlTWFpbnRhaW5pbmcoYm9vbCBfaXNNYWludGFpbmluZykgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgaXNNYWludGFpbmluZyA9IF9pc01haW50YWluaW5nOwogICAgfQp9Cgpjb250cmFjdCBFdGhlcmVtb25FbnVtIHsKCiAgICBlbnVtIFJlc3VsdENvZGUgewogICAgICAgIFNVQ0NFU1MsCiAgICAgICAgRVJST1JfQ0xBU1NfTk9UX0ZPVU5ELAogICAgICAgIEVSUk9SX0xPV19CQUxBTkNFLAogICAgICAgIEVSUk9SX1NFTkRfRkFJTCwKICAgICAgICBFUlJPUl9OT1RfVFJBSU5FUiwKICAgICAgICBFUlJPUl9OT1RfRU5PVUdIX01PTkVZLAogICAgICAgIEVSUk9SX0lOVkFMSURfQU1PVU5ULAogICAgICAgIEVSUk9SX09CSl9OT1RfRk9VTkQsCiAgICAgICAgRVJST1JfT0JKX0lOVkFMSURfT1dORVJTSElQCiAgICB9CiAgICAKICAgIGVudW0gQXJyYXlUeXBlIHsKICAgICAgICBDTEFTU19UWVBFLAogICAgICAgIFNUQVRfU1RFUCwKICAgICAgICBTVEFUX1NUQVJULAogICAgICAgIFNUQVRfQkFTRSwKICAgICAgICBPQkpfU0tJTEwKICAgIH0KICAgIAogICAgZW51bSBQcm9wZXJ0eVR5cGUgewogICAgICAgIEFOQ0VTVE9SLAogICAgICAgIFhGQUNUT1IKICAgIH0KfQoKY29udHJhY3QgRXRoZXJlbW9uRGF0YUJhc2UgaXMgRXRoZXJlbW9uRW51bSwgQmFzaWNBY2Nlc3NDb250cm9sLCBTYWZlTWF0aCB7CiAgICAKICAgIHVpbnQ2NCBwdWJsaWMgdG90YWxNb25zdGVyOwogICAgdWludDMyIHB1YmxpYyB0b3RhbENsYXNzOwogICAgCiAgICAvLyB3cml0ZQogICAgZnVuY3Rpb24gYWRkRWxlbWVudFRvQXJyYXlUeXBlKEFycmF5VHlwZSBfdHlwZSwgdWludDY0IF9pZCwgdWludDggX3ZhbHVlKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIHJlbW92ZUVsZW1lbnRPZkFycmF5VHlwZShBcnJheVR5cGUgX3R5cGUsIHVpbnQ2NCBfaWQsIHVpbnQ4IF92YWx1ZSkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiBzZXRNb25zdGVyQ2xhc3ModWludDMyIF9jbGFzc0lkLCB1aW50MjU2IF9wcmljZSwgdWludDI1NiBfcmV0dXJuUHJpY2UsIGJvb2wgX2NhdGNoYWJsZSkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDMyKTsKICAgIGZ1bmN0aW9uIGFkZE1vbnN0ZXJPYmoodWludDMyIF9jbGFzc0lkLCBhZGRyZXNzIF90cmFpbmVyLCBzdHJpbmcgX25hbWUpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBzZXRNb25zdGVyT2JqKHVpbnQ2NCBfb2JqSWQsIHN0cmluZyBfbmFtZSwgdWludDMyIF9leHAsIHVpbnQzMiBfY3JlYXRlSW5kZXgsIHVpbnQzMiBfbGFzdENsYWltSW5kZXgpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGluY3JlYXNlTW9uc3RlckV4cCh1aW50NjQgX29iaklkLCB1aW50MzIgYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWM7CiAgICBmdW5jdGlvbiBkZWNyZWFzZU1vbnN0ZXJFeHAodWludDY0IF9vYmpJZCwgdWludDMyIGFtb3VudCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgZnVuY3Rpb24gcmVtb3ZlTW9uc3RlcklkTWFwcGluZyhhZGRyZXNzIF90cmFpbmVyLCB1aW50NjQgX21vbnN0ZXJJZCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgZnVuY3Rpb24gYWRkTW9uc3RlcklkTWFwcGluZyhhZGRyZXNzIF90cmFpbmVyLCB1aW50NjQgX21vbnN0ZXJJZCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgZnVuY3Rpb24gY2xlYXJNb25zdGVyUmV0dXJuQmFsYW5jZSh1aW50NjQgX21vbnN0ZXJJZCkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDI1NiBhbW91bnQpOwogICAgZnVuY3Rpb24gY29sbGVjdEFsbFJldHVybkJhbGFuY2UoYWRkcmVzcyBfdHJhaW5lcikgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDI1NiBhbW91bnQpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJNb25zdGVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50NjQgX21vbnN0ZXJJZCkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnMoUmVzdWx0Q29kZSk7CiAgICBmdW5jdGlvbiBhZGRFeHRyYUJhbGFuY2UoYWRkcmVzcyBfdHJhaW5lciwgdWludDI1NiBfYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGRlZHVjdEV4dHJhQmFsYW5jZShhZGRyZXNzIF90cmFpbmVyLCB1aW50MjU2IF9hbW91bnQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gc2V0RXh0cmFCYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIsIHVpbnQyNTYgX2Ftb3VudCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgCiAgICAvLyByZWFkCiAgICBmdW5jdGlvbiBnZXRTaXplQXJyYXlUeXBlKEFycmF5VHlwZSBfdHlwZSwgdWludDY0IF9pZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiBnZXRFbGVtZW50SW5BcnJheVR5cGUoQXJyYXlUeXBlIF90eXBlLCB1aW50NjQgX2lkLCB1aW50IF9pbmRleCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDgpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3RlckNsYXNzKHVpbnQzMiBfY2xhc3NJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDMyIGNsYXNzSWQsIHVpbnQyNTYgcHJpY2UsIHVpbnQyNTYgcmV0dXJuUHJpY2UsIHVpbnQzMiB0b3RhbCwgYm9vbCBjYXRjaGFibGUpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3Rlck9iaih1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50NjQgb2JqSWQsIHVpbnQzMiBjbGFzc0lkLCBhZGRyZXNzIHRyYWluZXIsIHVpbnQzMiBleHAsIHVpbnQzMiBjcmVhdGVJbmRleCwgdWludDMyIGxhc3RDbGFpbUluZGV4LCB1aW50IGNyZWF0ZVRpbWUpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3Rlck5hbWUodWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMoc3RyaW5nIG5hbWUpOwogICAgZnVuY3Rpb24gZ2V0RXh0cmFCYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3RlckRleFNpemUoYWRkcmVzcyBfdHJhaW5lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiBnZXRNb25zdGVyT2JqSWQoYWRkcmVzcyBfdHJhaW5lciwgdWludCBpbmRleCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDY0KTsKICAgIGZ1bmN0aW9uIGdldEV4cGVjdGVkQmFsYW5jZShhZGRyZXNzIF90cmFpbmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJSZXR1cm4odWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDI1NiBjdXJyZW50LCB1aW50MjU2IHRvdGFsKTsKfQoKY29udHJhY3QgRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSB7CiAgICB1aW50NjQgcHVibGljIHRvdGFsRWdnID0gMDsKICAgIGZ1bmN0aW9uIGdldEhhdGNoaW5nRWdnSWQoYWRkcmVzcyBfdHJhaW5lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gZ2V0SGF0Y2hpbmdFZ2dEYXRhKGFkZHJlc3MgX3RyYWluZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludDY0LCB1aW50NjQsIHVpbnQzMiwgYWRkcmVzcywgdWludCwgdWludDY0KTsKICAgIGZ1bmN0aW9uIGdldFRyYW5mb3JtZWRJZCh1aW50NjQgX29iaklkKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBjb3VudEVnZyh1aW50NjQgX29iaklkKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQpOwogICAgCiAgICBmdW5jdGlvbiBzZXRIYXRjaFRpbWUodWludDY0IF9lZ2dJZCwgdWludCBfaGF0Y2hUaW1lKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldEhhdGNoZWRFZ2codWludDY0IF9lZ2dJZCwgdWludDY0IF9uZXdPYmpJZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRFZ2codWludDY0IF9vYmpJZCwgdWludDMyIF9jbGFzc0lkLCBhZGRyZXNzIF90cmFpbmVyLCB1aW50IF9oYXRjaFRpbWUpIGV4dGVybmFsIHJldHVybnModWludDY0KTsKICAgIGZ1bmN0aW9uIHNldFRyYW5mb3JtZWQodWludDY0IF9vYmpJZCwgdWludDY0IF9uZXdPYmpJZCkgZXh0ZXJuYWw7Cn0KCmNvbnRyYWN0IEV0aGVyZW1vbldvcmxkIGlzIEV0aGVyZW1vbkVudW0gewogICAgCiAgICBmdW5jdGlvbiBnZXRHZW4wQ09uZmlnKHVpbnQzMiBfY2xhc3NJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDMyLCB1aW50MjU2LCB1aW50MzIpOwogICAgZnVuY3Rpb24gZ2V0VHJhaW5lckVhcm4oYWRkcmVzcyBfdHJhaW5lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRSZXR1cm5Gcm9tTW9uc3Rlcih1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2IGN1cnJlbnQsIHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gZ2V0Q2xhc3NQcm9wZXJ0eVZhbHVlKHVpbnQzMiBfY2xhc3NJZCwgUHJvcGVydHlUeXBlIF90eXBlLCB1aW50IGluZGV4KSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQzMik7CiAgICBmdW5jdGlvbiBnZXRDbGFzc1Byb3BlcnR5U2l6ZSh1aW50MzIgX2NsYXNzSWQsIFByb3BlcnR5VHlwZSBfdHlwZSkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50KTsKfQoKaW50ZXJmYWNlIEV0aGVyZW1vbkJhdHRsZSB7CiAgICBmdW5jdGlvbiBpc09uQmF0dGxlKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRNb25zdGVyTGV2ZWwodWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDgpOwp9CgppbnRlcmZhY2UgRXRoZXJlbW9uVHJhZGVJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gaXNPblRyYWRpbmcodWludDY0IF9vYmpJZCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyhib29sKTsKfQoKY29udHJhY3QgRXRoZXJlbW9uVHJhbnNmb3JtIGlzIEV0aGVyZW1vbkVudW0sIEJhc2ljQWNjZXNzQ29udHJvbCwgU2FmZU1hdGggewogICAgdWludDggY29uc3RhbnQgcHVibGljIFNUQVRfQ09VTlQgPSA2OwogICAgdWludDggY29uc3RhbnQgcHVibGljIFNUQVRfTUFYID0gMzI7CiAgICB1aW50OCBjb25zdGFudCBwdWJsaWMgR0VOMF9OTyA9IDI0OwogICAgCiAgICBzdHJ1Y3QgTW9uc3RlckNsYXNzQWNjIHsKICAgICAgICB1aW50MzIgY2xhc3NJZDsKICAgICAgICB1aW50MjU2IHByaWNlOwogICAgICAgIHVpbnQyNTYgcmV0dXJuUHJpY2U7CiAgICAgICAgdWludDMyIHRvdGFsOwogICAgICAgIGJvb2wgY2F0Y2hhYmxlOwogICAgfQoKICAgIHN0cnVjdCBNb25zdGVyT2JqQWNjIHsKICAgICAgICB1aW50NjQgbW9uc3RlcklkOwogICAgICAgIHVpbnQzMiBjbGFzc0lkOwogICAgICAgIGFkZHJlc3MgdHJhaW5lcjsKICAgICAgICBzdHJpbmcgbmFtZTsKICAgICAgICB1aW50MzIgZXhwOwogICAgICAgIHVpbnQzMiBjcmVhdGVJbmRleDsKICAgICAgICB1aW50MzIgbGFzdENsYWltSW5kZXg7CiAgICAgICAgdWludCBjcmVhdGVUaW1lOwogICAgfQogICAgCiAgICBzdHJ1Y3QgTW9uc3RlckVnZyB7CiAgICAgICAgdWludDY0IGVnZ0lkOwogICAgICAgIHVpbnQ2NCBvYmpJZDsKICAgICAgICB1aW50MzIgY2xhc3NJZDsKICAgICAgICBhZGRyZXNzIHRyYWluZXI7CiAgICAgICAgdWludCBoYXRjaFRpbWU7CiAgICAgICAgdWludDY0IG5ld09iaklkOwogICAgfQogICAgCiAgICBzdHJ1Y3QgQmFzaWNPYmpJbmZvIHsKICAgICAgICB1aW50MzIgY2xhc3NJZDsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIHVpbnQ4IGxldmVsOwogICAgfQogICAgCiAgICAvLyBHZW4wIGhhcyByZXR1cm4gcHJpY2UgJiBubyBsb25nZXIgY2FuIGJlIGNhdWdodCB3aGVuIHRoaXMgY29udHJhY3QgaXMgZGVwbG95ZWQKICAgIHN0cnVjdCBHZW4wQ29uZmlnIHsKICAgICAgICB1aW50MzIgY2xhc3NJZDsKICAgICAgICB1aW50MjU2IG9yaWdpbmFsUHJpY2U7CiAgICAgICAgdWludDI1NiByZXR1cm5QcmljZTsKICAgICAgICB1aW50MzIgdG90YWw7IC8vIHRvdGFsIGNhdWdodCAobm90IGNvdW50IHRob3NlIGZyb20gZWdncykKICAgIH0KICAgIAogICAgLy8gaGF0Y2hpbmcgcmFuZ2UKICAgIHVpbnQxNiBwdWJsaWMgaGF0Y2hTdGFydFRpbWUgPSAyOyAvLyBob3VyCiAgICB1aW50MTYgcHVibGljIGhhdGNoTWF4VGltZSA9IDQ2OyAvLyBob3VyCiAgICB1aW50IHB1YmxpYyByZW1vdmVIYXRjaGluZ1RpbWVGZWUgPSAwLjA1IGV0aGVyOyAvLyBFVEgKICAgIHVpbnQgcHVibGljIGJ1eUVnZ0ZlZSA9IDAuMDYgZXRoZXI7IC8vIEVUSAogICAgCiAgICB1aW50MzJbXSBwdWJsaWMgcmFuZG9tQ2xhc3NJZHM7CiAgICBtYXBwaW5nKHVpbnQzMiA9PiB1aW50OCkgcHVibGljIGxheWluZ0VnZ0xldmVsczsKICAgIG1hcHBpbmcodWludDMyID0+IHVpbnQ4KSBwdWJsaWMgbGF5aW5nRWdnRGVkdWN0aW9uczsKICAgIG1hcHBpbmcodWludDMyID0+IHVpbnQ4KSBwdWJsaWMgdHJhbnNmb3JtTGV2ZWxzOwogICAgbWFwcGluZyh1aW50MzIgPT4gdWludDMyKSBwdWJsaWMgdHJhbnNmb3JtQ2xhc3NlczsKCiAgICBtYXBwaW5nKHVpbnQ4ID0+IHVpbnQzMikgcHVibGljIGxldmVsRXhwczsKICAgIGFkZHJlc3MgcHJpdmF0ZSBsYXN0SGF0Y2hpbmdBZGRyZXNzOwogICAgCiAgICBtYXBwaW5nKHVpbnQzMiA9PiBHZW4wQ29uZmlnKSBwdWJsaWMgZ2VuMENvbmZpZzsKICAgIAogICAgLy8gbGlua2VkIHNtYXJ0IGNvbnRyYWN0CiAgICBhZGRyZXNzIHB1YmxpYyBkYXRhQ29udHJhY3Q7CiAgICBhZGRyZXNzIHB1YmxpYyB3b3JsZENvbnRyYWN0OwogICAgYWRkcmVzcyBwdWJsaWMgdHJhbnNmb3JtRGF0YUNvbnRyYWN0OwogICAgYWRkcmVzcyBwdWJsaWMgYmF0dGxlQ29udHJhY3Q7CiAgICBhZGRyZXNzIHB1YmxpYyB0cmFkZUNvbnRyYWN0OwogICAgCiAgICAvLyBldmVudHMKICAgIGV2ZW50IEV2ZW50TGF5RWdnKGFkZHJlc3MgaW5kZXhlZCB0cmFpbmVyLCB1aW50NjQgb2JqSWQsIHVpbnQ2NCBlZ2dJZCk7CiAgICBldmVudCBFdmVudEhhdGNoRWdnKGFkZHJlc3MgaW5kZXhlZCB0cmFpbmVyLCB1aW50NjQgZWdnSWQsIHVpbnQ2NCBvYmpJZCk7CiAgICBldmVudCBFdmVudFRyYW5zZm9ybShhZGRyZXNzIGluZGV4ZWQgdHJhaW5lciwgdWludDY0IG9sZE9iaklkLCB1aW50NjQgbmV3T2JqSWQpOwogICAgZXZlbnQgRXZlbnRSZWxlYXNlKGFkZHJlc3MgaW5kZXhlZCB0cmFpbmVyLCB1aW50NjQgb2JqSWQpOwogICAgCiAgICAvLyBtb2RpZmllcgogICAgCiAgICBtb2RpZmllciByZXF1aXJlRGF0YUNvbnRyYWN0IHsKICAgICAgICByZXF1aXJlKGRhdGFDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IHsKICAgICAgICByZXF1aXJlKHRyYW5zZm9ybURhdGFDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciByZXF1aXJlQmF0dGxlQ29udHJhY3QgewogICAgICAgIHJlcXVpcmUoYmF0dGxlQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgcmVxdWlyZVRyYWRlQ29udHJhY3QgewogICAgICAgIHJlcXVpcmUodHJhZGVDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOyAgICAgICAgCiAgICB9CiAgICAKICAgIAogICAgLy8gY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIEV0aGVyZW1vblRyYW5zZm9ybShhZGRyZXNzIF9kYXRhQ29udHJhY3QsIGFkZHJlc3MgX3dvcmxkQ29udHJhY3QsIGFkZHJlc3MgX3RyYW5zZm9ybURhdGFDb250cmFjdCwgYWRkcmVzcyBfYmF0dGxlQ29udHJhY3QsIGFkZHJlc3MgX3RyYWRlQ29udHJhY3QpIHB1YmxpYyB7CiAgICAgICAgZGF0YUNvbnRyYWN0ID0gX2RhdGFDb250cmFjdDsKICAgICAgICB3b3JsZENvbnRyYWN0ID0gX3dvcmxkQ29udHJhY3Q7CiAgICAgICAgdHJhbnNmb3JtRGF0YUNvbnRyYWN0ID0gX3RyYW5zZm9ybURhdGFDb250cmFjdDsKICAgICAgICBiYXR0bGVDb250cmFjdCA9IF9iYXR0bGVDb250cmFjdDsKICAgICAgICB0cmFkZUNvbnRyYWN0ID0gX3RyYWRlQ29udHJhY3Q7CiAgICB9CiAgICAKICAgIC8vIGhlbHBlcgogICAgZnVuY3Rpb24gZ2V0UmFuZG9tKHVpbnQxNiBtYXhSYW4sIHVpbnQ4IGluZGV4LCBhZGRyZXNzIHByaUFkZHJlc3MpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ4KSB7CiAgICAgICAgdWludDI1NiBnZW5OdW0gPSB1aW50MjU2KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSkpICsgdWludDI1NihwcmlBZGRyZXNzKTsKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgaW5kZXggJiYgaSA8IDY7IGkgKyspIHsKICAgICAgICAgICAgZ2VuTnVtIC89IDI1NjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVpbnQ4KGdlbk51bSAlIG1heFJhbik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFkZE5ld09iaihhZGRyZXNzIF90cmFpbmVyLCB1aW50MzIgX2NsYXNzSWQpIHByaXZhdGUgcmV0dXJucyh1aW50NjQpIHsKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICB1aW50NjQgb2JqSWQgPSBkYXRhLmFkZE1vbnN0ZXJPYmooX2NsYXNzSWQsIF90cmFpbmVyLCAiLi5uYW1lIG1lLi4uIik7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaSA8IFNUQVRfQ09VTlQ7IGkrPSAxKSB7CiAgICAgICAgICAgIHVpbnQ4IHZhbHVlID0gZ2V0UmFuZG9tKFNUQVRfTUFYLCB1aW50OChpKSwgbGFzdEhhdGNoaW5nQWRkcmVzcykgKyBkYXRhLmdldEVsZW1lbnRJbkFycmF5VHlwZShBcnJheVR5cGUuU1RBVF9TVEFSVCwgdWludDY0KF9jbGFzc0lkKSwgaSk7CiAgICAgICAgICAgIGRhdGEuYWRkRWxlbWVudFRvQXJyYXlUeXBlKEFycmF5VHlwZS5TVEFUX0JBU0UsIG9iaklkLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvYmpJZDsKICAgIH0KICAgIAogICAgLy8gYWRtaW4gJiBtb2RlcmF0b3JzCiAgICBmdW5jdGlvbiBzZXRDb250cmFjdChhZGRyZXNzIF9kYXRhQ29udHJhY3QsIGFkZHJlc3MgX3dvcmxkQ29udHJhY3QsIGFkZHJlc3MgX3RyYW5zZm9ybURhdGFDb250cmFjdCwgYWRkcmVzcyBfYmF0dGxlQ29udHJhY3QsIGFkZHJlc3MgX3RyYWRlQ29udHJhY3QpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICBkYXRhQ29udHJhY3QgPSBfZGF0YUNvbnRyYWN0OwogICAgICAgIHdvcmxkQ29udHJhY3QgPSBfd29ybGRDb250cmFjdDsKICAgICAgICB0cmFuc2Zvcm1EYXRhQ29udHJhY3QgPSBfdHJhbnNmb3JtRGF0YUNvbnRyYWN0OwogICAgICAgIGJhdHRsZUNvbnRyYWN0ID0gX2JhdHRsZUNvbnRyYWN0OwogICAgICAgIHRyYWRlQ29udHJhY3QgPSBfdHJhZGVDb250cmFjdDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRPcmlnaW5hbFByaWNlR2VuMCgpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICBnZW4wQ29uZmlnWzFdID0gR2VuMENvbmZpZygxLCAwLjMgZXRoZXIsIDAuMDAzIGV0aGVyLCAzNzQpOwogICAgICAgIGdlbjBDb25maWdbMl0gPSBHZW4wQ29uZmlnKDIsIDAuMyBldGhlciwgMC4wMDMgZXRoZXIsIDQwOCk7CiAgICAgICAgZ2VuMENvbmZpZ1szXSA9IEdlbjBDb25maWcoMywgMC4zIGV0aGVyLCAwLjAwMyBldGhlciwgMzczKTsKICAgICAgICBnZW4wQ29uZmlnWzRdID0gR2VuMENvbmZpZyg0LCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCA0MzcpOwogICAgICAgIGdlbjBDb25maWdbNV0gPSBHZW4wQ29uZmlnKDUsIDAuMSBldGhlciwgMC4wMDEgZXRoZXIsIDQ5Nyk7CiAgICAgICAgZ2VuMENvbmZpZ1s2XSA9IEdlbjBDb25maWcoNiwgMC4zIGV0aGVyLCAwLjAwMyBldGhlciwgMzgwKTsgCiAgICAgICAgZ2VuMENvbmZpZ1s3XSA9IEdlbjBDb25maWcoNywgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzQ1KTsKICAgICAgICBnZW4wQ29uZmlnWzhdID0gR2VuMENvbmZpZyg4LCAwLjEgZXRoZXIsIDAuMDAxIGV0aGVyLCA1MTgpOyAKICAgICAgICBnZW4wQ29uZmlnWzldID0gR2VuMENvbmZpZyg5LCAwLjEgZXRoZXIsIDAuMDAxIGV0aGVyLCA0NDcpOwogICAgICAgIGdlbjBDb25maWdbMTBdID0gR2VuMENvbmZpZygxMCwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzgwKTsgCiAgICAgICAgZ2VuMENvbmZpZ1sxMV0gPSBHZW4wQ29uZmlnKDExLCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCAzNTQpOwogICAgICAgIGdlbjBDb25maWdbMTJdID0gR2VuMENvbmZpZygxMiwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzQ2KTsKICAgICAgICBnZW4wQ29uZmlnWzEzXSA9IEdlbjBDb25maWcoMTMsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDM1MSk7IAogICAgICAgIGdlbjBDb25maWdbMTRdID0gR2VuMENvbmZpZygxNCwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzM4KTsKICAgICAgICBnZW4wQ29uZmlnWzE1XSA9IEdlbjBDb25maWcoMTUsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDM0MSk7CiAgICAgICAgZ2VuMENvbmZpZ1sxNl0gPSBHZW4wQ29uZmlnKDE2LCAwLjM1IGV0aGVyLCAwLjAwMzUgZXRoZXIsIDM4NCk7CiAgICAgICAgZ2VuMENvbmZpZ1sxN10gPSBHZW4wQ29uZmlnKDE3LCAxIGV0aGVyLCAwLjAxIGV0aGVyLCAzMDUpOyAKICAgICAgICBnZW4wQ29uZmlnWzE4XSA9IEdlbjBDb25maWcoMTgsIDAuMSBldGhlciwgMC4wMDEgZXRoZXIsIDQyNyk7CiAgICAgICAgZ2VuMENvbmZpZ1sxOV0gPSBHZW4wQ29uZmlnKDE5LCAxIGV0aGVyLCAwLjAxIGV0aGVyLCAzMDQpOwogICAgICAgIGdlbjBDb25maWdbMjBdID0gR2VuMENvbmZpZygyMCwgMC40IGV0aGVyLCAwLjA1IGV0aGVyLCA4Mik7CiAgICAgICAgZ2VuMENvbmZpZ1syMV0gPSBHZW4wQ29uZmlnKDIxLCAxLCAxLCAxMjMpOwogICAgICAgIGdlbjBDb25maWdbMjJdID0gR2VuMENvbmZpZygyMiwgMC4yIGV0aGVyLCAwLjAwMSBldGhlciwgNDY4KTsKICAgICAgICBnZW4wQ29uZmlnWzIzXSA9IEdlbjBDb25maWcoMjMsIDAuNSBldGhlciwgMC4wMDI1IGV0aGVyLCAzMDIpOwogICAgICAgIGdlbjBDb25maWdbMjRdID0gR2VuMENvbmZpZygyNCwgMSBldGhlciwgMC4wMDUgZXRoZXIsIDE5NSk7CiAgICB9ICAgIAoKICAgIGZ1bmN0aW9uIHVwZGF0ZUhhdGNoaW5nUmFuZ2UodWludDE2IF9zdGFydCwgdWludDE2IF9tYXgpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICBoYXRjaFN0YXJ0VGltZSA9IF9zdGFydDsKICAgICAgICBoYXRjaE1heFRpbWUgPSBfbWF4OwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3RXRoZXIoYWRkcmVzcyBfc2VuZFRvLCB1aW50IF9hbW91bnQpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICAvLyBubyB1c2VyIG1vbmV5IGlzIGtlcHQgaW4gdGhpcyBjb250cmFjdCwgb25seSB0cmFzYWN0aW9uIGZlZQogICAgICAgIGlmIChfYW1vdW50ID4gdGhpcy5iYWxhbmNlKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICBfc2VuZFRvLnRyYW5zZmVyKF9hbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENvbmZpZ0NsYXNzKHVpbnQzMiBfY2xhc3NJZCwgdWludDggX2xheWluZ0xldmVsLCB1aW50OCBfbGF5aW5nQ29zdCwgdWludDggX3RyYW5zZm9ybUxldmVsLCB1aW50MzIgX3RyYW5mb3JtQ2xhc3MpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICBsYXlpbmdFZ2dMZXZlbHNbX2NsYXNzSWRdID0gX2xheWluZ0xldmVsOwogICAgICAgIGxheWluZ0VnZ0RlZHVjdGlvbnNbX2NsYXNzSWRdID0gX2xheWluZ0Nvc3Q7CiAgICAgICAgdHJhbnNmb3JtTGV2ZWxzW19jbGFzc0lkXSA9IF90cmFuc2Zvcm1MZXZlbDsKICAgICAgICB0cmFuc2Zvcm1DbGFzc2VzW19jbGFzc0lkXSA9IF90cmFuZm9ybUNsYXNzOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRDb25maWcodWludCBfcmVtb3ZlSGF0Y2hpbmdUaW1lRmVlLCB1aW50IF9idXlFZ2dGZWUpIG9ubHlNb2RlcmF0b3JzIGV4dGVybmFsIHsKICAgICAgICByZW1vdmVIYXRjaGluZ1RpbWVGZWUgPSBfcmVtb3ZlSGF0Y2hpbmdUaW1lRmVlOwogICAgICAgIGJ1eUVnZ0ZlZSA9IF9idXlFZ2dGZWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2VuTGV2ZWxFeHAoKSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgdWludDggbGV2ZWwgPSAxOwogICAgICAgIHVpbnQzMiByZXF1aXJlbWVudCA9IDEwMDsKICAgICAgICB1aW50MzIgc3VtID0gcmVxdWlyZW1lbnQ7CiAgICAgICAgd2hpbGUobGV2ZWwgPD0gMTAwKSB7CiAgICAgICAgICAgIGxldmVsRXhwc1tsZXZlbF0gPSBzdW07CiAgICAgICAgICAgIGxldmVsICs9IDE7CiAgICAgICAgICAgIHJlcXVpcmVtZW50ID0gKHJlcXVpcmVtZW50ICogMTEpIC8gMTAgKyA1OwogICAgICAgICAgICBzdW0gKz0gcmVxdWlyZW1lbnQ7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZGRSYW5kb21DbGFzcyh1aW50MzIgX25ld0NsYXNzSWQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyB7CiAgICAgICAgaWYgKF9uZXdDbGFzc0lkID4gMCkgewogICAgICAgICAgICBmb3IgKHVpbnQgaW5kZXggPSAwOyBpbmRleCA8IHJhbmRvbUNsYXNzSWRzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgaWYgKHJhbmRvbUNsYXNzSWRzW2luZGV4XSA9PSBfbmV3Q2xhc3NJZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByYW5kb21DbGFzc0lkcy5wdXNoKF9uZXdDbGFzc0lkKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJlbW92ZVJhbmRvbUNsYXNzKHVpbnQzMiBfb2xkQ2xhc3NJZCkgb25seU1vZGVyYXRvcnMgcHVibGljIHsKICAgICAgICB1aW50IGZvdW5kSW5kZXggPSAwOwogICAgICAgIGZvciAoOyBmb3VuZEluZGV4IDwgcmFuZG9tQ2xhc3NJZHMubGVuZ3RoOyBmb3VuZEluZGV4KyspIHsKICAgICAgICAgICAgaWYgKHJhbmRvbUNsYXNzSWRzW2ZvdW5kSW5kZXhdID09IF9vbGRDbGFzc0lkKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZm91bmRJbmRleCA8IHJhbmRvbUNsYXNzSWRzLmxlbmd0aCkgewogICAgICAgICAgICByYW5kb21DbGFzc0lkc1tmb3VuZEluZGV4XSA9IHJhbmRvbUNsYXNzSWRzW3JhbmRvbUNsYXNzSWRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgZGVsZXRlIHJhbmRvbUNsYXNzSWRzW3JhbmRvbUNsYXNzSWRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgcmFuZG9tQ2xhc3NJZHMubGVuZ3RoLS07CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmVIYXRjaGluZ1RpbWVXaXRoVG9rZW4oYWRkcmVzcyBfdHJhaW5lcikgaXNBY3RpdmUgb25seU1vZGVyYXRvcnMgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHsKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3RlckVnZyBtZW1vcnkgZWdnOwogICAgICAgIChlZ2cuZWdnSWQsIGVnZy5vYmpJZCwgZWdnLmNsYXNzSWQsIGVnZy50cmFpbmVyLCBlZ2cuaGF0Y2hUaW1lLCBlZ2cubmV3T2JqSWQpID0gdHJhbnNmb3JtRGF0YS5nZXRIYXRjaGluZ0VnZ0RhdGEoX3RyYWluZXIpOwogICAgICAgIC8vIG5vdCBoYXRjaGluZyBhbnkgZWdnCiAgICAgICAgaWYgKGVnZy5lZ2dJZCA9PSAwIHx8IGVnZy50cmFpbmVyICE9IF90cmFpbmVyIHx8IGVnZy5uZXdPYmpJZCA+IDApCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIAogICAgICAgIHRyYW5zZm9ybURhdGEuc2V0SGF0Y2hUaW1lKGVnZy5lZ2dJZCwgMCk7CiAgICB9ICAgIAogICAgCiAgICBmdW5jdGlvbiBidXlFZ2dXaXRoVG9rZW4oYWRkcmVzcyBfdHJhaW5lcikgaXNBY3RpdmUgb25seU1vZGVyYXRvcnMgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHsKICAgICAgICBpZiAocmFuZG9tQ2xhc3NJZHMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICAvLyBtYWtlIHN1cmUgbm8gaGF0Y2hpbmcgZWdnIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICBpZiAodHJhbnNmb3JtRGF0YS5nZXRIYXRjaGluZ0VnZ0lkKF90cmFpbmVyKSA+IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgcmFuZG9tIGVnZwogICAgICAgIHVpbnQ4IGNsYXNzSW5kZXggPSBnZXRSYW5kb20odWludDE2KHJhbmRvbUNsYXNzSWRzLmxlbmd0aCksIDEsIGxhc3RIYXRjaGluZ0FkZHJlc3MpOwogICAgICAgIHVpbnQ2NCBlZ2dJZCA9IHRyYW5zZm9ybURhdGEuYWRkRWdnKDAsIHJhbmRvbUNsYXNzSWRzW2NsYXNzSW5kZXhdLCBfdHJhaW5lciwgYmxvY2sudGltZXN0YW1wICsgKGhhdGNoU3RhcnRUaW1lICsgZ2V0UmFuZG9tKGhhdGNoTWF4VGltZSwgMCwgbGFzdEhhdGNoaW5nQWRkcmVzcykpICogMzYwMCk7CiAgICAgICAgLy8gZGVkdWN0IGV4cAogICAgICAgIEV2ZW50TGF5RWdnKG1zZy5zZW5kZXIsIDAsIGVnZ0lkKTsKICAgIH0KICAgIAogICAgLy8gcHVibGljCgogICAgZnVuY3Rpb24gY2VpbCh1aW50IGEsIHVpbnQgbSkgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiAoKGEgKyBtIC0gMSkgLyBtKSAqIG07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TGV2ZWwodWludDMyIGV4cCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICB1aW50OCBtaW5JbmRleCA9IDE7CiAgICAgICAgdWludDggbWF4SW5kZXggPSAxMDA7CiAgICAgICAgdWludDggY3VycmVudEluZGV4OwogICAgIAogICAgICAgIHdoaWxlIChtaW5JbmRleCA8IG1heEluZGV4KSB7CiAgICAgICAgICAgIGN1cnJlbnRJbmRleCA9IChtaW5JbmRleCArIG1heEluZGV4KSAvIDI7CiAgICAgICAgICAgIGlmIChleHAgPCBsZXZlbEV4cHNbY3VycmVudEluZGV4XSkKICAgICAgICAgICAgICAgIG1heEluZGV4ID0gY3VycmVudEluZGV4OwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBtaW5JbmRleCA9IGN1cnJlbnRJbmRleCArIDE7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWluSW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0R2VuME9iakluZm8odWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDMyLCB1aW50MzIsIHVpbnQyNTYpIHsKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICAKICAgICAgICBNb25zdGVyT2JqQWNjIG1lbW9yeSBvYmo7CiAgICAgICAgKG9iai5tb25zdGVySWQsIG9iai5jbGFzc0lkLCBvYmoudHJhaW5lciwgb2JqLmV4cCwgb2JqLmNyZWF0ZUluZGV4LCBvYmoubGFzdENsYWltSW5kZXgsIG9iai5jcmVhdGVUaW1lKSA9IGRhdGEuZ2V0TW9uc3Rlck9iaihfb2JqSWQpOwogICAgICAgIAogICAgICAgIEdlbjBDb25maWcgbWVtb3J5IGdlbjAgPSBnZW4wQ29uZmlnW29iai5jbGFzc0lkXTsKICAgICAgICBpZiAoZ2VuMC5jbGFzc0lkICE9IG9iai5jbGFzc0lkKSB7CiAgICAgICAgICAgIHJldHVybiAoZ2VuMC5jbGFzc0lkLCBvYmouY3JlYXRlSW5kZXgsIDApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1aW50MzIgdG90YWxHYXAgPSAwOwogICAgICAgIGlmIChvYmouY3JlYXRlSW5kZXggPCBnZW4wLnRvdGFsKQogICAgICAgICAgICB0b3RhbEdhcCA9IGdlbjAudG90YWwgLSBvYmouY3JlYXRlSW5kZXg7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIChvYmouY2xhc3NJZCwgb2JqLmNyZWF0ZUluZGV4LCBzYWZlTXVsdCh0b3RhbEdhcCwgZ2VuMC5yZXR1cm5QcmljZSkpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRPYmpDbGFzc0lkKHVpbnQ2NCBfb2JqSWQpIHJlcXVpcmVEYXRhQ29udHJhY3QgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDMyLCBhZGRyZXNzLCB1aW50OCkgewogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIE1vbnN0ZXJPYmpBY2MgbWVtb3J5IG9iajsKICAgICAgICB1aW50MzIgXyA9IDA7CiAgICAgICAgKG9iai5tb25zdGVySWQsIG9iai5jbGFzc0lkLCBvYmoudHJhaW5lciwgb2JqLmV4cCwgXywgXywgb2JqLmNyZWF0ZVRpbWUpID0gZGF0YS5nZXRNb25zdGVyT2JqKF9vYmpJZCk7CiAgICAgICAgcmV0dXJuIChvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIGdldExldmVsKG9iai5leHApKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0Q2xhc3NDaGVja093bmVyKHVpbnQ2NCBfb2JqSWQsIGFkZHJlc3MgX3RyYWluZXIpIHJlcXVpcmVEYXRhQ29udHJhY3QgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDMyKSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3Rlck9iakFjYyBtZW1vcnkgb2JqOwogICAgICAgIHVpbnQzMiBfID0gMDsKICAgICAgICAob2JqLm1vbnN0ZXJJZCwgb2JqLmNsYXNzSWQsIG9iai50cmFpbmVyLCBvYmouZXhwLCBfLCBfLCBvYmouY3JlYXRlVGltZSkgPSBkYXRhLmdldE1vbnN0ZXJPYmooX29iaklkKTsKICAgICAgICBpZiAoX3RyYWluZXIgIT0gb2JqLnRyYWluZXIpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHJldHVybiBvYmouY2xhc3NJZDsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVNYXhFZ2dHMCh1aW50NjQgX29iaklkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludDMyIGNsYXNzSWQ7CiAgICAgICAgdWludDMyIGNyZWF0ZUluZGV4OyAKICAgICAgICB1aW50MjU2IHRvdGFsRWFybjsKICAgICAgICAoY2xhc3NJZCwgY3JlYXRlSW5kZXgsIHRvdGFsRWFybikgPSBnZXRHZW4wT2JqSW5mbyhfb2JqSWQpOwogICAgICAgIGlmIChjbGFzc0lkID4gR0VOMF9OTyB8fCBjbGFzc0lkID09IDIwIHx8IGNsYXNzSWQgPT0gMjEpCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIAogICAgICAgIEdlbjBDb25maWcgbWVtb3J5IGNvbmZpZyA9IGdlbjBDb25maWdbY2xhc3NJZF07CiAgICAgICAgLy8gdGhlIG9uZSBmcm9tIGVnZyBjYW4gbm90IGxheQogICAgICAgIGlmIChjcmVhdGVJbmRleCA+IGNvbmZpZy50b3RhbCkKICAgICAgICAgICAgcmV0dXJuIDA7CgogICAgICAgIC8vIGNhbGN1bGF0ZSBhZ3YgcHJpY2UKICAgICAgICB1aW50MjU2IGF2Z1ByaWNlID0gY29uZmlnLm9yaWdpbmFsUHJpY2U7CiAgICAgICAgdWludCByYXRlID0gY29uZmlnLm9yaWdpbmFsUHJpY2UvY29uZmlnLnJldHVyblByaWNlOwogICAgICAgIGlmIChjb25maWcudG90YWwgPiByYXRlKSB7CiAgICAgICAgICAgIHVpbnQgayA9IGNvbmZpZy50b3RhbCAtIHJhdGU7CiAgICAgICAgICAgIGF2Z1ByaWNlID0gKGNvbmZpZy50b3RhbCAqIGNvbmZpZy5vcmlnaW5hbFByaWNlICsgY29uZmlnLnJldHVyblByaWNlICogayAqIChrKzEpIC8gMikgLyBjb25maWcudG90YWw7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgY2F0Y2hQcmljZSA9IGNvbmZpZy5vcmlnaW5hbFByaWNlOyAgICAgICAgICAgIAogICAgICAgIGlmIChjcmVhdGVJbmRleCA+IHJhdGUpIHsKICAgICAgICAgICAgY2F0Y2hQcmljZSArPSBjb25maWcucmV0dXJuUHJpY2UgKiBzYWZlU3VidHJhY3QoY3JlYXRlSW5kZXgsIHJhdGUpOwogICAgICAgIH0KICAgICAgICBpZiAodG90YWxFYXJuID49IGNhdGNoUHJpY2UpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjZWlsKChjYXRjaFByaWNlIC0gdG90YWxFYXJuKSoxNSoxMDAwL2F2Z1ByaWNlLCAxMDAwMCkvMTAwMDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNhbkxheUVnZyh1aW50NjQgX29iaklkLCB1aW50MzIgX2NsYXNzSWQsIHVpbnQzMiBfbGV2ZWwpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAoX2NsYXNzSWQgPD0gR0VOMF9OTykgewogICAgICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgICAgIC8vIGxlZ2VuZHMKICAgICAgICAgICAgaWYgKHRyYW5zZm9ybURhdGEuY291bnRFZ2coX29iaklkKSA+PSBjYWxjdWxhdGVNYXhFZ2dHMChfb2JqSWQpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobGF5aW5nRWdnTGV2ZWxzW19jbGFzc0lkXSA9PSAwIHx8IF9sZXZlbCA8IGxheWluZ0VnZ0xldmVsc1tfY2xhc3NJZF0pCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gbGF5RWdnKHVpbnQ2NCBfb2JqSWQpIGlzQWN0aXZlIHJlcXVpcmVEYXRhQ29udHJhY3QgcmVxdWlyZVRyYW5zZm9ybURhdGFDb250cmFjdCBleHRlcm5hbCB7CiAgICAgICAgRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSB0cmFuc2Zvcm1EYXRhID0gRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSh0cmFuc2Zvcm1EYXRhQ29udHJhY3QpOwogICAgICAgIC8vIG1ha2Ugc3VyZSBubyBoYXRjaGluZyBlZ2cgYXQgdGhlIHNhbWUgdGltZQogICAgICAgIGlmICh0cmFuc2Zvcm1EYXRhLmdldEhhdGNoaW5nRWdnSWQobXNnLnNlbmRlcikgPiAwKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjYW4gbm90IGxheSBlZ2cgd2hlbiB0cmFkaW5nCiAgICAgICAgRXRoZXJlbW9uVHJhZGVJbnRlcmZhY2UgdHJhZGUgPSBFdGhlcmVtb25UcmFkZUludGVyZmFjZSh0cmFkZUNvbnRyYWN0KTsKICAgICAgICBpZiAodHJhZGUuaXNPblRyYWRpbmcoX29iaklkKSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgb2JqIAogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIE1vbnN0ZXJPYmpBY2MgbWVtb3J5IG9iajsKICAgICAgICB1aW50MzIgXyA9IDA7CiAgICAgICAgKG9iai5tb25zdGVySWQsIG9iai5jbGFzc0lkLCBvYmoudHJhaW5lciwgb2JqLmV4cCwgXywgXywgb2JqLmNyZWF0ZVRpbWUpID0gZGF0YS5nZXRNb25zdGVyT2JqKF9vYmpJZCk7CiAgICAgICAgaWYgKG9iai5tb25zdGVySWQgIT0gX29iaklkIHx8IG9iai50cmFpbmVyICE9IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGNoZWNrIGxheSBlZ2cgY29uZGl0aW9uCiAgICAgICAgdWludDggY3VycmVudExldmVsID0gZ2V0TGV2ZWwob2JqLmV4cCk7CiAgICAgICAgdWludDggYWZ0ZXJMZXZlbCA9IDA7CiAgICAgICAgaWYgKCFjYW5MYXlFZ2coX29iaklkLCBvYmouY2xhc3NJZCwgY3VycmVudExldmVsKSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKGxheWluZ0VnZ0RlZHVjdGlvbnNbb2JqLmNsYXNzSWRdID49IGN1cnJlbnRMZXZlbCkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgYWZ0ZXJMZXZlbCA9IGN1cnJlbnRMZXZlbCAtIGxheWluZ0VnZ0RlZHVjdGlvbnNbb2JqLmNsYXNzSWRdOwoKICAgICAgICAvLyBhZGQgZWdnIAogICAgICAgIHVpbnQ2NCBlZ2dJZCA9IHRyYW5zZm9ybURhdGEuYWRkRWdnKG9iai5tb25zdGVySWQsIG9iai5jbGFzc0lkLCBtc2cuc2VuZGVyLCBibG9jay50aW1lc3RhbXAgKyAoaGF0Y2hTdGFydFRpbWUgKyBnZXRSYW5kb20oaGF0Y2hNYXhUaW1lLCAwLCBsYXN0SGF0Y2hpbmdBZGRyZXNzKSkgKiAzNjAwKTsKICAgICAgICAKICAgICAgICAvLyBkZWR1Y3QgZXhwIAogICAgICAgIGlmIChhZnRlckxldmVsIDwgY3VycmVudExldmVsKQogICAgICAgICAgICBkYXRhLmRlY3JlYXNlTW9uc3RlckV4cChfb2JqSWQsIG9iai5leHAgLSBsZXZlbEV4cHNbYWZ0ZXJMZXZlbC0xXSk7CiAgICAgICAgRXZlbnRMYXlFZ2cobXNnLnNlbmRlciwgX29iaklkLCBlZ2dJZCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGhhdGNoRWdnKCkgaXNBY3RpdmUgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHsKICAgICAgICAvLyB1c2UgYXMgYSBzZWVkIGZvciByYW5kb20KICAgICAgICBsYXN0SGF0Y2hpbmdBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICAKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgTW9uc3RlckVnZyBtZW1vcnkgZWdnOwogICAgICAgIChlZ2cuZWdnSWQsIGVnZy5vYmpJZCwgZWdnLmNsYXNzSWQsIGVnZy50cmFpbmVyLCBlZ2cuaGF0Y2hUaW1lLCBlZ2cubmV3T2JqSWQpID0gdHJhbnNmb3JtRGF0YS5nZXRIYXRjaGluZ0VnZ0RhdGEobXNnLnNlbmRlcik7CiAgICAgICAgLy8gbm90IGhhdGNoaW5nIGFueSBlZ2cKICAgICAgICBpZiAoZWdnLmVnZ0lkID09IDAgfHwgZWdnLnRyYWluZXIgIT0gbXNnLnNlbmRlcikKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgLy8gbmVlZCBtb3JlIHRpbWUKICAgICAgICBpZiAoZWdnLm5ld09iaklkID4gMCB8fCBlZ2cuaGF0Y2hUaW1lID4gYmxvY2sudGltZXN0YW1wKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1aW50NjQgb2JqSWQgPSBhZGROZXdPYmoobXNnLnNlbmRlciwgZWdnLmNsYXNzSWQpOwogICAgICAgIHRyYW5zZm9ybURhdGEuc2V0SGF0Y2hlZEVnZyhlZ2cuZWdnSWQsIG9iaklkKTsKICAgICAgICBFdmVudEhhdGNoRWdnKG1zZy5zZW5kZXIsIGVnZy5lZ2dJZCwgb2JqSWQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmVIYXRjaGluZ1RpbWUoKSBpc0FjdGl2ZSByZXF1aXJlRGF0YUNvbnRyYWN0IHJlcXVpcmVUcmFuc2Zvcm1EYXRhQ29udHJhY3QgZXh0ZXJuYWwgcGF5YWJsZSAgewogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICBNb25zdGVyRWdnIG1lbW9yeSBlZ2c7CiAgICAgICAgKGVnZy5lZ2dJZCwgZWdnLm9iaklkLCBlZ2cuY2xhc3NJZCwgZWdnLnRyYWluZXIsIGVnZy5oYXRjaFRpbWUsIGVnZy5uZXdPYmpJZCkgPSB0cmFuc2Zvcm1EYXRhLmdldEhhdGNoaW5nRWdnRGF0YShtc2cuc2VuZGVyKTsKICAgICAgICAvLyBub3QgaGF0Y2hpbmcgYW55IGVnZwogICAgICAgIGlmIChlZ2cuZWdnSWQgPT0gMCB8fCBlZ2cudHJhaW5lciAhPSBtc2cuc2VuZGVyIHx8IGVnZy5uZXdPYmpJZCA+IDApCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIAogICAgICAgIGlmIChtc2cudmFsdWUgIT0gcmVtb3ZlSGF0Y2hpbmdUaW1lRmVlKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICB0cmFuc2Zvcm1EYXRhLnNldEhhdGNoVGltZShlZ2cuZWdnSWQsIDApOwogICAgfQoKICAgIAogICAgZnVuY3Rpb24gY2hlY2tBbmNlc3RvcnModWludDMyIF9jbGFzc0lkLCBhZGRyZXNzIF90cmFpbmVyLCB1aW50NjQgX2ExLCB1aW50NjQgX2EyLCB1aW50NjQgX2EzKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgRXRoZXJlbW9uV29ybGQgd29ybGQgPSBFdGhlcmVtb25Xb3JsZCh3b3JsZENvbnRyYWN0KTsKICAgICAgICB1aW50IGluZGV4ID0gMDsKICAgICAgICB1aW50MzIgdGVtcCA9IDA7CiAgICAgICAgLy8gY2hlY2sgYW5jZXN0b3IKICAgICAgICB1aW50MzJbM10gbWVtb3J5IGFuY2VzdG9yczsKICAgICAgICB1aW50MzJbM10gbWVtb3J5IHJlcXVlc3RBbmNlc3RvcnM7CiAgICAgICAgaW5kZXggPSB3b3JsZC5nZXRDbGFzc1Byb3BlcnR5U2l6ZShfY2xhc3NJZCwgUHJvcGVydHlUeXBlLkFOQ0VTVE9SKTsKICAgICAgICB3aGlsZSAoaW5kZXggPiAwKSB7CiAgICAgICAgICAgIGluZGV4IC09IDE7CiAgICAgICAgICAgIGFuY2VzdG9yc1tpbmRleF0gPSB3b3JsZC5nZXRDbGFzc1Byb3BlcnR5VmFsdWUoX2NsYXNzSWQsIFByb3BlcnR5VHlwZS5BTkNFU1RPUiwgaW5kZXgpOwogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgaWYgKF9hMSA+IDApIHsKICAgICAgICAgICAgdGVtcCA9IGdldENsYXNzQ2hlY2tPd25lcihfYTEsIF90cmFpbmVyKTsKICAgICAgICAgICAgaWYgKHRlbXAgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmVxdWVzdEFuY2VzdG9yc1swXSA9IHRlbXA7CiAgICAgICAgfQogICAgICAgIGlmIChfYTIgPiAwKSB7CiAgICAgICAgICAgIHRlbXAgPSBnZXRDbGFzc0NoZWNrT3duZXIoX2EyLCBfdHJhaW5lcik7CiAgICAgICAgICAgIGlmICh0ZW1wID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJlcXVlc3RBbmNlc3RvcnNbMV0gPSB0ZW1wOwogICAgICAgIH0KICAgICAgICBpZiAoX2EzID4gMCkgewogICAgICAgICAgICB0ZW1wID0gZ2V0Q2xhc3NDaGVja093bmVyKF9hMywgX3RyYWluZXIpOwogICAgICAgICAgICBpZiAodGVtcCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXF1ZXN0QW5jZXN0b3JzWzJdID0gdGVtcDsKICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0QW5jZXN0b3JzWzBdID4gMCAmJiAocmVxdWVzdEFuY2VzdG9yc1swXSA9PSByZXF1ZXN0QW5jZXN0b3JzWzFdIHx8IHJlcXVlc3RBbmNlc3RvcnNbMF0gPT0gcmVxdWVzdEFuY2VzdG9yc1syXSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAocmVxdWVzdEFuY2VzdG9yc1sxXSA+IDAgJiYgKHJlcXVlc3RBbmNlc3RvcnNbMV0gPT0gcmVxdWVzdEFuY2VzdG9yc1syXSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIAogICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IGFuY2VzdG9ycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgdGVtcCA9IGFuY2VzdG9yc1tpbmRleF07CiAgICAgICAgICAgIGlmICh0ZW1wID4gMCAmJiB0ZW1wICE9IHJlcXVlc3RBbmNlc3RvcnNbMF0gICYmIHRlbXAgIT0gcmVxdWVzdEFuY2VzdG9yc1sxXSAmJiB0ZW1wICE9IHJlcXVlc3RBbmNlc3RvcnNbMl0pCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0cmFuc2Zvcm0odWludDY0IF9vYmpJZCwgdWludDY0IF9hMSwgdWludDY0IF9hMiwgdWludDY0IF9hMykgaXNBY3RpdmUgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHBheWFibGUgewogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICBpZiAodHJhbnNmb3JtRGF0YS5nZXRUcmFuZm9ybWVkSWQoX29iaklkKSA+IDApCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIAogICAgICAgIEV0aGVyZW1vbkJhdHRsZSBiYXR0bGUgPSBFdGhlcmVtb25CYXR0bGUoYmF0dGxlQ29udHJhY3QpOwogICAgICAgIEV0aGVyZW1vblRyYWRlSW50ZXJmYWNlIHRyYWRlID0gRXRoZXJlbW9uVHJhZGVJbnRlcmZhY2UodHJhZGVDb250cmFjdCk7CiAgICAgICAgaWYgKGJhdHRsZS5pc09uQmF0dGxlKF9vYmpJZCkgfHwgdHJhZGUuaXNPblRyYWRpbmcoX29iaklkKSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgCiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgCiAgICAgICAgQmFzaWNPYmpJbmZvIG1lbW9yeSBvYmpJbmZvOwogICAgICAgIChvYmpJbmZvLmNsYXNzSWQsIG9iakluZm8ub3duZXIsIG9iakluZm8ubGV2ZWwpID0gZ2V0T2JqQ2xhc3NJZChfb2JqSWQpOwogICAgICAgIHVpbnQzMiB0cmFuc2Zvcm1DbGFzcyA9IHRyYW5zZm9ybUNsYXNzZXNbb2JqSW5mby5jbGFzc0lkXTsKICAgICAgICBpZiAob2JqSW5mby5jbGFzc0lkID09IDAgfHwgb2JqSW5mby5vd25lciAhPSBtc2cuc2VuZGVyKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBpZiAodHJhbnNmb3JtTGV2ZWxzW29iakluZm8uY2xhc3NJZF0gPT0gMCB8fCBvYmpJbmZvLmxldmVsIDwgdHJhbnNmb3JtTGV2ZWxzW29iakluZm8uY2xhc3NJZF0pCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIGlmICh0cmFuc2Zvcm1DbGFzcyA9PSAwKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBnZW4wIC0gY2FuIG5vdCB0cmFuc2Zvcm0gaWYgaXQgaGFzIGJvbnVzIGVnZyAKICAgICAgICBpZiAob2JqSW5mby5jbGFzc0lkIDw9IEdFTjBfTk8pIHsKICAgICAgICAgICAgLy8gbGVnZW5kcwogICAgICAgICAgICBpZiAoZ2V0Qm9udXNFZ2coX29iaklkKSA+IDApCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIWNoZWNrQW5jZXN0b3JzKG9iakluZm8uY2xhc3NJZCwgbXNnLnNlbmRlciwgX2ExLCBfYTIsIF9hMykpCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDY0IG5ld09iaklkID0gYWRkTmV3T2JqKG1zZy5zZW5kZXIsIHRyYW5zZm9ybUNsYXNzKTsKICAgICAgICAvLyByZW1vdmUgb2xkIG9uZQogICAgICAgIGRhdGEucmVtb3ZlTW9uc3RlcklkTWFwcGluZyhtc2cuc2VuZGVyLCBfb2JqSWQpOwogICAgICAgIHRyYW5zZm9ybURhdGEuc2V0VHJhbmZvcm1lZChfb2JqSWQsIG5ld09iaklkKTsKICAgICAgICBFdmVudFRyYW5zZm9ybShtc2cuc2VuZGVyLCBfb2JqSWQsIG5ld09iaklkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYnV5RWdnKCkgaXNBY3RpdmUgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHBheWFibGUgewogICAgICAgIGlmIChtc2cudmFsdWUgIT0gYnV5RWdnRmVlKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmFuZG9tQ2xhc3NJZHMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICAvLyBtYWtlIHN1cmUgbm8gaGF0Y2hpbmcgZWdnIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICBpZiAodHJhbnNmb3JtRGF0YS5nZXRIYXRjaGluZ0VnZ0lkKG1zZy5zZW5kZXIpID4gMCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCByYW5kb20gZWdnCiAgICAgICAgdWludDggY2xhc3NJbmRleCA9IGdldFJhbmRvbSh1aW50MTYocmFuZG9tQ2xhc3NJZHMubGVuZ3RoKSwgMSwgbGFzdEhhdGNoaW5nQWRkcmVzcyk7CiAgICAgICAgdWludDY0IGVnZ0lkID0gdHJhbnNmb3JtRGF0YS5hZGRFZ2coMCwgcmFuZG9tQ2xhc3NJZHNbY2xhc3NJbmRleF0sIG1zZy5zZW5kZXIsIGJsb2NrLnRpbWVzdGFtcCArIChoYXRjaFN0YXJ0VGltZSArIGdldFJhbmRvbShoYXRjaE1heFRpbWUsIDAsIGxhc3RIYXRjaGluZ0FkZHJlc3MpKSAqIDM2MDApOwogICAgICAgIC8vIGRlZHVjdCBleHAKICAgICAgICBFdmVudExheUVnZyhtc2cuc2VuZGVyLCAwLCBlZ2dJZCk7CiAgICB9CiAgICAKICAgIC8vIHJlYWQKICAgIGZ1bmN0aW9uIGdldEJvbnVzRWdnKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgdWludCB0b3RhbEJvbnVzRWdnID0gY2FsY3VsYXRlTWF4RWdnRzAoX29iaklkKTsKICAgICAgICBpZiAodG90YWxCb251c0VnZyA+IDApIHsKICAgICAgICAgICAgcmV0dXJuICh0b3RhbEJvbnVzRWdnIC0gdHJhbnNmb3JtRGF0YS5jb3VudEVnZyhfb2JqSWQpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAKfQ=='.
	

]
