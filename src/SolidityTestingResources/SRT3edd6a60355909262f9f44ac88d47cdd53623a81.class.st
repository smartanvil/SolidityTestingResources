Class {
	#name : #SRT3edd6a60355909262f9f44ac88d47cdd53623a81,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3edd6a60355909262f9f44ac88d47cdd53623a81 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIERpcmVjdENyb3dkc2FsZUxpYgogKiBAYXV0aG9yIE1vZHVsYXIgSW5jLCBodHRwczovL21vZHVsYXIubmV0d29yawogKgogKiB2ZXJzaW9uIDIuMS4xCiAqIENvcHlyaWdodCAoYykgMjAxNyBNb2R1bGFyIEluYwogKiBUaGUgTUlUIExpY2Vuc2UgKE1JVCkKICogaHR0cHM6Ly9naXRodWIuY29tL01vZHVsYXItTmV0d29yay9ldGhlcmV1bS1saWJyYXJpZXMvYmxvYi9tYXN0ZXIvTElDRU5TRQogKgogKiBUaGUgRGlyZWN0Q3Jvd2RzYWxlIExpYnJhcnkgcHJvdmlkZXMgZnVuY3Rpb25hbGl0eSB0byBjcmVhdGUgYSBpbml0aWFsIGNvaW4gb2ZmZXJpbmcKICogZm9yIGEgc3RhbmRhcmQgdG9rZW4gc2FsZSB3aXRoIGhpZ2ggc3VwcGx5IHdoZXJlIHRoZXJlIGlzIGEgZGlyZWN0IGV0aGVyIHRvCiAqIHRva2VuIHRyYW5zZmVyLgogKgogKiBNb2R1bGFyIHByb3ZpZGVzIHNtYXJ0IGNvbnRyYWN0IHNlcnZpY2VzIGFuZCBzZWN1cml0eSByZXZpZXdzIGZvciBjb250cmFjdAogKiBkZXBsb3ltZW50cyBpbiBhZGRpdGlvbiB0byB3b3JraW5nIG9uIG9wZW4gc291cmNlIHByb2plY3RzIGluIHRoZSBFdGhlcmV1bQogKiBjb21tdW5pdHkuIE91ciBwdXJwb3NlIGlzIHRvIHRlc3QsIGRvY3VtZW50LCBhbmQgZGVwbG95IHJldXNhYmxlIGNvZGUgb250byB0aGUKICogYmxvY2tjaGFpbiBhbmQgaW1wcm92ZSBib3RoIHNlY3VyaXR5IGFuZCB1c2FiaWxpdHkuIFdlIGFsc28gZWR1Y2F0ZSBub24tcHJvZml0cywKICogc2Nob29scywgYW5kIG90aGVyIGNvbW11bml0eSBtZW1iZXJzIGFib3V0IHRoZSBhcHBsaWNhdGlvbiBvZiBibG9ja2NoYWluCiAqIHRlY2hub2xvZ3kuIEZvciBmdXJ0aGVyIGluZm9ybWF0aW9uOiBtb2R1bGFyLm5ldHdvcmsKICoKICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MKICogT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgogKiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuCiAqIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZCiAqIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsCiAqIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFCiAqIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgogKi8KCmxpYnJhcnkgRGlyZWN0Q3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CiAgdXNpbmcgQ3Jvd2RzYWxlTGliIGZvciBDcm93ZHNhbGVMaWIuQ3Jvd2RzYWxlU3RvcmFnZTsKCiAgc3RydWN0IERpcmVjdENyb3dkc2FsZVN0b3JhZ2UgewoKICAJQ3Jvd2RzYWxlTGliLkNyb3dkc2FsZVN0b3JhZ2UgYmFzZTsgLy8gYmFzZSBzdG9yYWdlIGZyb20gQ3Jvd2RzYWxlTGliCgogIH0KCiAgZXZlbnQgTG9nVG9rZW5zQm91Z2h0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IExvZ1Rva2VuUHJpY2VDaGFuZ2UodWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwogIGV2ZW50IExvZ0Vycm9yTXNnKHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCgogIC8vLyBAZGV2IENhbGxlZCBieSBhIGNyb3dkc2FsZSBjb250cmFjdCB1cG9uIGNyZWF0aW9uLgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiBjcm93ZHNhbGUgb3duZXIKICAvLy8gQHBhcmFtIF9zYWxlRGF0YSBBcnJheSBvZiAzIGl0ZW0gc2V0cyBzdWNoIHRoYXQsIGluIGVhY2ggMyBlbGVtZW50CiAgLy8vIHNldCwgMSBpcyB0aW1lc3RhbXAsIDIgaXMgcHJpY2UgaW4gY2VudHMgYXQgdGhhdCB0aW1lLAogIC8vLyAzIGlzIGFkZHJlc3MgcHVyY2hhc2UgY2FwIGF0IHRoYXQgdGltZSwgMCBpZiBubyBhZGRyZXNzIGNhcAogIC8vLyBAcGFyYW0gX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlIEV4Y2hhbmdlIHJhdGUgb2YgY2VudHMvRVRICiAgLy8vIEBwYXJhbSBfY2FwQW1vdW50SW5DZW50cyBUb3RhbCB0byBiZSByYWlzZWQgaW4gY2VudHMKICAvLy8gQHBhcmFtIF9lbmRUaW1lIFRpbWVzdGFtcCBvZiBzYWxlIGVuZCB0aW1lCiAgLy8vIEBwYXJhbSBfcGVyY2VudEJ1cm4gUGVyY2VudGFnZSBvZiBleHRyYSB0b2tlbnMgdG8gYnVybgogIC8vLyBAcGFyYW0gX3Rva2VuIFRva2VuIGJlaW5nIHNvbGQKICBmdW5jdGlvbiBpbml0KERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgICAgICAgICB1aW50MjU2W10gX3NhbGVEYXRhLAogICAgICAgICAgICAgICAgdWludDI1NiBfZmFsbGJhY2tFeGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9jYXBBbW91bnRJbkNlbnRzLAogICAgICAgICAgICAgICAgdWludDI1NiBfZW5kVGltZSwKICAgICAgICAgICAgICAgIHVpbnQ4IF9wZXJjZW50QnVybiwKICAgICAgICAgICAgICAgIENyb3dkc2FsZVRva2VuIF90b2tlbikKICAgICAgICAgICAgICAgIHB1YmxpYwogIHsKICAJc2VsZi5iYXNlLmluaXQoX293bmVyLAogICAgICAgICAgICAgICAgX3NhbGVEYXRhLAogICAgICAgICAgICAgICAgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgX2NhcEFtb3VudEluQ2VudHMsCiAgICAgICAgICAgICAgICBfZW5kVGltZSwKICAgICAgICAgICAgICAgIF9wZXJjZW50QnVybiwKICAgICAgICAgICAgICAgIF90b2tlbik7CiAgfQoKICAvLy8gQGRldiBDYWxsZWQgd2hlbiBhbiBhZGRyZXNzIHdhbnRzIHRvIHB1cmNoYXNlIHRva2VucwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IGFtb3VudCBvZiB3ZWkgdGhhdCB0aGUgYnV5ZXIgaXMgc2VuZGluZwogIC8vLyBAcmV0dXJuIHRydWUgb24gc3VjY2VzZnVsIHB1cmNoYXNlCiAgZnVuY3Rpb24gcmVjZWl2ZVB1cmNoYXNlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBzZWxmLmJhc2Uub3duZXIpOwogIAlyZXF1aXJlKHNlbGYuYmFzZS52YWxpZFB1cmNoYXNlKCkpOwoKICAJLy8gaWYgdGhlIHRva2VuIHByaWNlIGluY3JlYXNlIGludGVydmFsIGhhcyBwYXNzZWQsIHVwZGF0ZSB0aGUgY3VycmVudCBkYXkgYW5kIGNoYW5nZSB0aGUgdG9rZW4gcHJpY2UKICAJaWYgKChzZWxmLmJhc2UubWlsZXN0b25lVGltZXMubGVuZ3RoID4gc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxKSAmJgogICAgICAgIChub3cgPiBzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxXSkpCiAgICB7CiAgICAgICAgd2hpbGUoKHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lcy5sZW5ndGggPiBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDEpICYmCiAgICAgICAgICAgICAgKG5vdyA+IHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDFdKSkKICAgICAgICB7CiAgICAgICAgICBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5iYXNlLmNoYW5nZVRva2VuUHJpY2Uoc2VsZi5iYXNlLnNhbGVEYXRhW3NlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZV1dWzBdKTsKICAgICAgICBMb2dUb2tlblByaWNlQ2hhbmdlKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgsIlRva2VuIFByaWNlIGhhcyBjaGFuZ2VkISIpOwogICAgfQoKICAJdWludDI1NiBfbnVtVG9rZW5zOyAvL251bWJlciBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHB1cmNoYXNlZAogICAgdWludDI1NiBfbmV3QmFsYW5jZTsgLy90aGUgbmV3IGJhbGFuY2Ugb2YgdGhlIG93bmVyIG9mIHRoZSBjcm93ZHNhbGUKICAgIHVpbnQyNTYgX3dlaVRva2VuczsgLy90ZW1wIGNhbGMgaG9sZGVyCiAgICB1aW50MjU2IF9sZWZ0b3ZlcldlaTsgLy93ZWkgY2hhbmdlIGZvciBwdXJjaGFzZXIKICAgIHVpbnQyNTYgX3JlbWFpbmRlcjsgLy90ZW1wIGNhbGMgaG9sZGVyCiAgICBib29sIGVycjsKCiAgICBpZigoc2VsZi5iYXNlLm93bmVyQmFsYW5jZSArIF9hbW91bnQpID4gc2VsZi5iYXNlLmNhcEFtb3VudCl7CiAgICAgIF9sZWZ0b3ZlcldlaSA9IChzZWxmLmJhc2Uub3duZXJCYWxhbmNlICsgX2Ftb3VudCkgLSBzZWxmLmJhc2UuY2FwQW1vdW50OwogICAgICBfYW1vdW50ID0gX2Ftb3VudCAtIF9sZWZ0b3ZlcldlaTsKICAgIH0KCiAgICAvLyBGaW5kIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFzIGEgZnVuY3Rpb24gaW4gd2VpCiAgICAoZXJyLF93ZWlUb2tlbnMpID0gX2Ftb3VudC50aW1lcyhzZWxmLmJhc2UudG9rZW5zUGVyRXRoKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgX251bVRva2VucyA9IF93ZWlUb2tlbnMgLyAxMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgX3JlbWFpbmRlciA9IF93ZWlUb2tlbnMgJSAxMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgX3JlbWFpbmRlciA9IF9yZW1haW5kZXIgLyBzZWxmLmJhc2UudG9rZW5zUGVyRXRoOwogICAgX2xlZnRvdmVyV2VpID0gX2xlZnRvdmVyV2VpICsgX3JlbWFpbmRlcjsKICAgIF9hbW91bnQgPSBfYW1vdW50IC0gX3JlbWFpbmRlcjsKICAgIHNlbGYuYmFzZS5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSArPSBfbGVmdG92ZXJXZWk7CgogICAgLy8gY2FuJ3Qgb3ZlcmZsb3cgYmVjYXVzZSBpdCBpcyB1bmRlciB0aGUgY2FwCiAgICBzZWxmLmJhc2UuaGFzQ29udHJpYnV0ZWRbbXNnLnNlbmRlcl0gKz0gX2Ftb3VudDsKCiAgICBhc3NlcnQoX251bVRva2VucyA8PSBzZWxmLmJhc2UudG9rZW4uYmFsYW5jZU9mKHRoaXMpKTsKCiAgICAvLyBjYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBldGhlciBpbiB0aGUgb3duZXJzIGJhbGFuY2UKICAgIChlcnIsX25ld0JhbGFuY2UpID0gc2VsZi5iYXNlLm93bmVyQmFsYW5jZS5wbHVzKF9hbW91bnQpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLmJhc2Uub3duZXJCYWxhbmNlID0gX25ld0JhbGFuY2U7ICAgLy8gImRlcG9zaXQiIHRoZSBhbW91bnQKCiAgICAvLyBjYW4ndCBvdmVyZmxvdyBiZWNhdXNlIGl0IHdpbGwgYmUgdW5kZXIgdGhlIGNhcAoJICBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gKz0gX251bVRva2VuczsKCiAgICAvL3N1YnRyYWN0IHRva2VucyBmcm9tIG93bmVyJ3Mgc2hhcmUKICAgIChlcnIsX3JlbWFpbmRlcikgPSBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2VsZi5iYXNlLm93bmVyXS5taW51cyhfbnVtVG9rZW5zKTsKICAgIHJlcXVpcmUoIWVycik7CiAgICBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2VsZi5iYXNlLm93bmVyXSA9IF9yZW1haW5kZXI7CgoJICBMb2dUb2tlbnNCb3VnaHQobXNnLnNlbmRlciwgX251bVRva2Vucyk7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKkZ1bmN0aW9ucyAiaW5oZXJpdGVkIiBmcm9tIENyb3dkc2FsZUxpYiBsaWJyYXJ5Ki8KCiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2V4Y2hhbmdlUmF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJldHVybiBzZWxmLmJhc2Uuc2V0VG9rZW5FeGNoYW5nZVJhdGUoX2V4Y2hhbmdlUmF0ZSk7CiAgfQoKICBmdW5jdGlvbiBzZXRUb2tlbnMoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLnNldFRva2VucygpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd0xlZnRvdmVyV2VpKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd093bmVyRXRoKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd093bmVyRXRoKCk7CiAgfQoKICBmdW5jdGlvbiBnZXRTYWxlRGF0YShEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiB0aW1lc3RhbXApCiAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgdmlldwogICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKHVpbnQyNTZbM10pCiAgewogICAgcmV0dXJuIHNlbGYuYmFzZS5nZXRTYWxlRGF0YSh0aW1lc3RhbXApOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYuYmFzZS5nZXRUb2tlbnNTb2xkKCk7CiAgfQoKICBmdW5jdGlvbiBjcm93ZHNhbGVBY3RpdmUoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuY3Jvd2RzYWxlQWN0aXZlKCk7CiAgfQoKICBmdW5jdGlvbiBjcm93ZHNhbGVFbmRlZChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5jcm93ZHNhbGVFbmRlZCgpOwogIH0KfQoKCmxpYnJhcnkgQ3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CgogIHN0cnVjdCBDcm93ZHNhbGVTdG9yYWdlIHsKICAJYWRkcmVzcyBvd25lcjsgICAgIC8vb3duZXIgb2YgdGhlIGNyb3dkc2FsZQoKICAJdWludDI1NiB0b2tlbnNQZXJFdGg7ICAvL251bWJlciBvZiB0b2tlbnMgcmVjZWl2ZWQgcGVyIGV0aGVyCiAgCXVpbnQyNTYgY2FwQW1vdW50OyAvL01heGltdW0gYW1vdW50IHRvIGJlIHJhaXNlZCBpbiB3ZWkKICAJdWludDI1NiBzdGFydFRpbWU7IC8vSUNPIHN0YXJ0IHRpbWUsIHRpbWVzdGFtcAogIAl1aW50MjU2IGVuZFRpbWU7IC8vSUNPIGVuZCB0aW1lLCB0aW1lc3RhbXAgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkCiAgICB1aW50MjU2IGV4Y2hhbmdlUmF0ZTsgLy9jZW50cy9FVEggZXhjaGFuZ2UgcmF0ZSBhdCB0aGUgdGltZSBvZiB0aGUgc2FsZQogICAgdWludDI1NiBvd25lckJhbGFuY2U7IC8vb3duZXIgd2VpIEJhbGFuY2UKICAgIHVpbnQyNTYgc3RhcnRpbmdUb2tlbkJhbGFuY2U7IC8vaW5pdGlhbCBhbW91bnQgb2YgdG9rZW5zIGZvciBzYWxlCiAgICB1aW50MjU2W10gbWlsZXN0b25lVGltZXM7IC8vQXJyYXkgb2YgdGltZXN0YW1wcyB3aGVuIHRva2VuIHByaWNlIGFuZCBhZGRyZXNzIGNhcCBjaGFuZ2VzCiAgICB1aW50OCBjdXJyZW50TWlsZXN0b25lOyAvL1BvaW50ZXIgdG8gdGhlIGN1cnJlbnQgbWlsZXN0b25lCiAgICB1aW50OCB0b2tlbkRlY2ltYWxzOyAvL3N0b3JlZCB0b2tlbiBkZWNpbWFscyBmb3IgY2FsY3VsYXRpb24gbGF0ZXIKICAgIHVpbnQ4IHBlcmNlbnRCdXJuOyAvL3BlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAgIGJvb2wgdG9rZW5zU2V0OyAvL3RydWUgaWYgdG9rZW5zIGhhdmUgYmVlbiBwcmVwYXJlZCBmb3IgY3Jvd2RzYWxlCiAgICBib29sIHJhdGVTZXQ7IC8vdHJ1ZSBpZiBleGNoYW5nZSByYXRlIGhhcyBiZWVuIHNldAoKICAgIC8vTWFwcyB0aW1lc3RhbXAgdG8gdG9rZW4gcHJpY2UgYW5kIGFkZHJlc3MgcHVyY2hhc2UgY2FwIHN0YXJ0aW5nIGF0IHRoYXQgdGltZQogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2WzJdKSBzYWxlRGF0YTsKCiAgICAvL3Nob3dzIGhvdyBtdWNoIHdlaSBhbiBhZGRyZXNzIGhhcyBjb250cmlidXRlZAogIAltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGhhc0NvbnRyaWJ1dGVkOwoKICAgIC8vRm9yIHRva2VuIHdpdGhkcmF3IGZ1bmN0aW9uLCBtYXBzIGEgdXNlciBhZGRyZXNzIHRvIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoZXkgY2FuIHdpdGhkcmF3CiAgCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgd2l0aGRyYXdUb2tlbnNNYXA7CgogICAgLy8gYW55IGxlZnRvdmVyIHdlaSB0aGF0IGJ1eWVycyBjb250cmlidXRlZCB0aGF0IGRpZG4ndCBhZGQgdXAgdG8gYSB3aG9sZSB0b2tlbiBhbW91bnQKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgbGVmdG92ZXJXZWk7CgogIAlDcm93ZHNhbGVUb2tlbiB0b2tlbjsgLy90b2tlbiBiZWluZyBzb2xkCiAgfQoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBhZGRyZXNzIGhhcyB3aXRoZHJhd24gdGhlaXIgc3VwcGx5IG9mIHRva2VucwogIGV2ZW50IExvZ1Rva2Vuc1dpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgX2JpZGRlciwgdWludDI1NiBBbW91bnQpOwoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBhZGRyZXNzIGhhcyB3aXRoZHJhd24gdGhlaXIgc3VwcGx5IG9mIGV4dHJhIHdlaQogIGV2ZW50IExvZ1dlaVdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgX2JpZGRlciwgdWludDI1NiBBbW91bnQpOwoKICAvLyBMb2dzIHdoZW4gb3duZXIgaGFzIHB1bGxlZCBldGgKICBldmVudCBMb2dPd25lckV0aFdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCiAgLy8gR2VuZXJpYyBOb3RpY2UgbWVzc2FnZSB0aGF0IGluY2x1ZGVzIGFuZCBhZGRyZXNzIGFuZCBudW1iZXIKICBldmVudCBMb2dOb3RpY2VNc2coYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgdmFsdWUsIHN0cmluZyBNc2cpOwoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBlcnJvciBoYXMgb2NjdXJyZWQgaW4gdGhlIGV4ZWN1dGlvbiBvZiBhIGZ1bmN0aW9uCiAgZXZlbnQgTG9nRXJyb3JNc2codWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIGNlbnRzIGF0IHRoYXQgdGltZSwKICAvLy8gMyBpcyBhZGRyZXNzIHRva2VuIHB1cmNoYXNlIGNhcCBhdCB0aGF0IHRpbWUsIDAgaWYgbm8gYWRkcmVzcyBjYXAKICAvLy8gQHBhcmFtIF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSBFeGNoYW5nZSByYXRlIG9mIGNlbnRzL0VUSAogIC8vLyBAcGFyYW0gX2NhcEFtb3VudEluQ2VudHMgVG90YWwgdG8gYmUgcmFpc2VkIGluIGNlbnRzCiAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaW1lc3RhbXAgb2Ygc2FsZSBlbmQgdGltZQogIC8vLyBAcGFyYW0gX3BlcmNlbnRCdXJuIFBlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHBhcmFtIF90b2tlbiBUb2tlbiBiZWluZyBzb2xkCiAgZnVuY3Rpb24gaW5pdChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICB1aW50OCBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICBDcm93ZHNhbGVUb2tlbiBfdG9rZW4pCiAgICAgICAgICAgICAgICBwdWJsaWMKICB7CiAgCXJlcXVpcmUoc2VsZi5jYXBBbW91bnQgPT0gMCk7CiAgCXJlcXVpcmUoc2VsZi5vd25lciA9PSAwKTsKICAgIHJlcXVpcmUoX3NhbGVEYXRhLmxlbmd0aCA+IDApOwogICAgcmVxdWlyZSgoX3NhbGVEYXRhLmxlbmd0aCUzKSA9PSAwKTsgLy8gZW5zdXJlIHNhbGVEYXRhIGlzIDMtaXRlbSBzZXRzCiAgICByZXF1aXJlKF9zYWxlRGF0YVswXSA+IChub3cgKyAyIGhvdXJzKSk7CiAgICByZXF1aXJlKF9lbmRUaW1lID4gX3NhbGVEYXRhWzBdKTsKICAgIHJlcXVpcmUoX2NhcEFtb3VudEluQ2VudHMgPiAwKTsKICAgIHJlcXVpcmUoX293bmVyID4gMCk7CiAgICByZXF1aXJlKF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSA+IDApOwogICAgcmVxdWlyZShfcGVyY2VudEJ1cm4gPD0gMTAwKTsKICAgIHNlbGYub3duZXIgPSBfb3duZXI7CiAgICBzZWxmLmNhcEFtb3VudCA9ICgoX2NhcEFtb3VudEluQ2VudHMvX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlKSArIDEpKigxMCoqMTgpOwogICAgc2VsZi5zdGFydFRpbWUgPSBfc2FsZURhdGFbMF07CiAgICBzZWxmLmVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHNlbGYudG9rZW4gPSBfdG9rZW47CiAgICBzZWxmLnRva2VuRGVjaW1hbHMgPSBfdG9rZW4uZGVjaW1hbHMoKTsKICAgIHNlbGYucGVyY2VudEJ1cm4gPSBfcGVyY2VudEJ1cm47CiAgICBzZWxmLmV4Y2hhbmdlUmF0ZSA9IF9mYWxsYmFja0V4Y2hhbmdlUmF0ZTsKCiAgICB1aW50MjU2IF90ZW1wVGltZTsKICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgX3NhbGVEYXRhLmxlbmd0aDsgaSArPSAzKXsKICAgICAgcmVxdWlyZShfc2FsZURhdGFbaV0gPiBfdGVtcFRpbWUpOwogICAgICByZXF1aXJlKF9zYWxlRGF0YVtpICsgMV0gPiAwKTsKICAgICAgcmVxdWlyZSgoX3NhbGVEYXRhW2kgKyAyXSA9PSAwKSB8fCAoX3NhbGVEYXRhW2kgKyAyXSA+PSAxMDApKTsKICAgICAgc2VsZi5taWxlc3RvbmVUaW1lcy5wdXNoKF9zYWxlRGF0YVtpXSk7CiAgICAgIHNlbGYuc2FsZURhdGFbX3NhbGVEYXRhW2ldXVswXSA9IF9zYWxlRGF0YVtpICsgMV07CiAgICAgIHNlbGYuc2FsZURhdGFbX3NhbGVEYXRhW2ldXVsxXSA9IF9zYWxlRGF0YVtpICsgMl07CiAgICAgIF90ZW1wVGltZSA9IF9zYWxlRGF0YVtpXTsKICAgIH0KICAgIGNoYW5nZVRva2VuUHJpY2Uoc2VsZiwgX3NhbGVEYXRhWzFdKTsKICB9CgogIC8vLyBAZGV2IGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IGFjdGl2ZQogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gc3VjY2VzcwogIGZ1bmN0aW9uIGNyb3dkc2FsZUFjdGl2ZShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogIAlyZXR1cm4gKG5vdyA+PSBzZWxmLnN0YXJ0VGltZSAmJiBub3cgPD0gc2VsZi5lbmRUaW1lKTsKICB9CgogIC8vLyBAZGV2IGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiBzdWNjZXNzCiAgZnVuY3Rpb24gY3Jvd2RzYWxlRW5kZWQoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIG5vdyA+IHNlbGYuZW5kVGltZTsKICB9CgogIC8vLyBAZGV2IGZ1bmN0aW9uIHRvIGNoZWNrIGlmIGEgcHVyY2hhc2UgaXMgdmFsaWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgIGlmIChjcm93ZHNhbGVBY3RpdmUoc2VsZikgJiYgbm9uWmVyb1B1cmNoYXNlKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgTG9nRXJyb3JNc2cobXNnLnZhbHVlLCAiSW52YWxpZCBQdXJjaGFzZSEgQ2hlY2sgc3RhcnQgdGltZSBhbmQgYW1vdW50IG9mIGV0aGVyLiIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICAvLy8gQGRldiBGdW5jdGlvbiBjYWxsZWQgYnkgcHVyY2hhc2VycyB0byBwdWxsIHRva2VucwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0b2tlbnMgd2VyZSB3aXRoZHJhd24KICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgb2s7CgogICAgaWYgKHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPT0gMCkgewogICAgICBMb2dFcnJvck1zZygwLCAiU2VuZGVyIGhhcyBubyB0b2tlbnMgdG8gd2l0aGRyYXchIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKSB7CiAgICAgIGlmKCFjcm93ZHNhbGVFbmRlZChzZWxmKSl7CiAgICAgICAgTG9nRXJyb3JNc2coMCwgIk93bmVyIGNhbm5vdCB3aXRoZHJhdyBleHRyYSB0b2tlbnMgdW50aWwgYWZ0ZXIgdGhlIHNhbGUhIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIGlmKHNlbGYucGVyY2VudEJ1cm4gPiAwKXsKICAgICAgICAgIHVpbnQyNTYgX2J1cm5BbW91bnQgPSAoc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSAqIHNlbGYucGVyY2VudEJ1cm4pLzEwMDsKICAgICAgICAgIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPSBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdIC0gX2J1cm5BbW91bnQ7CiAgICAgICAgICBvayA9IHNlbGYudG9rZW4uYnVyblRva2VuKF9idXJuQW1vdW50KTsKICAgICAgICAgIHJlcXVpcmUob2spOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHZhciB0b3RhbCA9IHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl07CiAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gMDsKICAgIG9rID0gc2VsZi50b2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXF1aXJlKG9rKTsKICAgIExvZ1Rva2Vuc1dpdGhkcmF3bihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIGNhbGxlZCBieSBwdXJjaGFzZXJzIHRvIHB1bGwgbGVmdG92ZXIgd2VpIGZyb20gdGhlaXIgcHVyY2hhc2VzCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHdlaSB3YXMgd2l0aGRyYXduCiAgZnVuY3Rpb24gd2l0aGRyYXdMZWZ0b3ZlcldlaShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGlmIChzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdID09IDApIHsKICAgICAgTG9nRXJyb3JNc2coMCwgIlNlbmRlciBoYXMgbm8gZXh0cmEgd2VpIHRvIHdpdGhkcmF3ISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdmFyIHRvdGFsID0gc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXTsKICAgIHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gPSAwOwogICAgbXNnLnNlbmRlci50cmFuc2Zlcih0b3RhbCk7CiAgICBMb2dXZWlXaXRoZHJhd24obXNnLnNlbmRlciwgdG90YWwpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBzZW5kIGV0aGVyIGZyb20gdGhlIGNvbXBsZXRlZCBjcm93ZHNhbGUgdG8gdGhlIG93bmVycyB3YWxsZXQgYWRkcmVzcwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBvd25lciB3aXRoZHJldyBldGgKICBmdW5jdGlvbiB3aXRoZHJhd093bmVyRXRoKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKCghY3Jvd2RzYWxlRW5kZWQoc2VsZikpICYmIChzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKT4wKSkgewogICAgICBMb2dFcnJvck1zZygwLCAiQ2Fubm90IHdpdGhkcmF3IG93bmVyIGV0aGVyIHVudGlsIGFmdGVyIHRoZSBzYWxlISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgcmVxdWlyZShzZWxmLm93bmVyQmFsYW5jZSA+IDApOwoKICAgIHVpbnQyNTYgYW1vdW50ID0gc2VsZi5vd25lckJhbGFuY2U7CiAgICBzZWxmLm93bmVyQmFsYW5jZSA9IDA7CiAgICBzZWxmLm93bmVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICBMb2dPd25lckV0aFdpdGhkcmF3bihtc2cuc2VuZGVyLGFtb3VudCwiQ3Jvd2RzYWxlIG93bmVyIGhhcyB3aXRoZHJhd24gYWxsIGZ1bmRzISIpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBwcmljZSBvZiB0aGUgdG9rZW4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX25ld1ByaWNlIG5ldyB0b2tlbiBwcmljZSAoYW1vdW50IG9mIHRva2VucyBwZXIgZXRoZXIpCiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdG9rZW4gcHJpY2UgY2hhbmdlZCBzdWNjZXNzZnVsbHkKICBmdW5jdGlvbiBjaGFuZ2VUb2tlblByaWNlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfbmV3UHJpY2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgCXJlcXVpcmUoX25ld1ByaWNlID4gMCk7CgogICAgYm9vbCBlcnI7CiAgICB1aW50MjU2IHJlc3VsdDsKCiAgICAoZXJyLCByZXN1bHQpID0gc2VsZi5leGNoYW5nZVJhdGUudGltZXMoMTAqKnVpbnQyNTYoc2VsZi50b2tlbkRlY2ltYWxzKSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYudG9rZW5zUGVyRXRoID0gcmVzdWx0IC8gX25ld1ByaWNlOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgdGhyZWUgZGF5cyBiZWZvcmUgdGhlIHNhbGUgdG8gc2V0IHRoZSB0b2tlbiBhbmQgcHJpY2UKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX2V4Y2hhbmdlUmF0ZSAgRVRIIGV4Y2hhbmdlIHJhdGUgZXhwcmVzc2VkIGluIGNlbnRzL0VUSAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIGV4Y2hhbmdlIHJhdGUgaGFzIGJlZW4gc2V0CiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2V4Y2hhbmdlUmF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoKG5vdyA+IChzZWxmLnN0YXJ0VGltZSAtIDMgZGF5cykpICYmIChub3cgPCAoc2VsZi5zdGFydFRpbWUpKSk7CiAgICByZXF1aXJlKCFzZWxmLnJhdGVTZXQpOyAgIC8vIHRoZSBleGNoYW5nZSByYXRlIGNhbiBvbmx5IGJlIHNldCBvbmNlIQogICAgcmVxdWlyZShzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKSA+IDApOwogICAgcmVxdWlyZShfZXhjaGFuZ2VSYXRlID4gMCk7CgogICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50czsKICAgIGJvb2wgZXJyOwoKICAgIChlcnIsIF9jYXBBbW91bnRJbkNlbnRzKSA9IHNlbGYuZXhjaGFuZ2VSYXRlLnRpbWVzKHNlbGYuY2FwQW1vdW50KTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi5leGNoYW5nZVJhdGUgPSBfZXhjaGFuZ2VSYXRlOwogICAgc2VsZi5jYXBBbW91bnQgPSAoX2NhcEFtb3VudEluQ2VudHMvX2V4Y2hhbmdlUmF0ZSkgKyAxOwogICAgY2hhbmdlVG9rZW5QcmljZShzZWxmLHNlbGYuc2FsZURhdGFbc2VsZi5taWxlc3RvbmVUaW1lc1swXV1bMF0pOwogICAgc2VsZi5yYXRlU2V0ID0gdHJ1ZTsKCiAgICBlcnIgPSAhKHNldFRva2VucyhzZWxmKSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIExvZ05vdGljZU1zZyhtc2cuc2VuZGVyLHNlbGYudG9rZW5zUGVyRXRoLCJPd25lciBoYXMgc2V0IHRoZSBleGNoYW5nZSBSYXRlIGFuZCB0b2tlbnMgYm91Z2h0IHBlciBFVEghIik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHNldCB0b2tlbnMgaWYgdGhlIGV4Y2hhbmdlIHJhdGUgZnVuY3Rpb24gd2FzIG5vdCBjYWxsZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHNldCBzdWNjZXNzZnVsbHkKICBmdW5jdGlvbiBzZXRUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKChtc2cuc2VuZGVyID09IHNlbGYub3duZXIpIHx8IChtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykpKTsKICAgIHJlcXVpcmUoIXNlbGYudG9rZW5zU2V0KTsKCiAgICB1aW50MjU2IF90b2tlbkJhbGFuY2U7CgogICAgX3Rva2VuQmFsYW5jZSA9IHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IF90b2tlbkJhbGFuY2U7CiAgICBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYudG9rZW5zU2V0ID0gdHJ1ZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEdldHMgdGhlIHByaWNlIGFuZCBidXkgY2FwIGZvciBpbmRpdmlkdWFsIGFkZHJlc3NlcyBhdCB0aGUgZ2l2ZW4gbWlsZXN0b25lIGluZGV4CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIHRpbWVzdGFtcCBUaW1lIGR1cmluZyBzYWxlIGZvciB3aGljaCBkYXRhIGlzIHJlcXVlc3RlZAogIC8vLyBAcmV0dXJuIEEgMy1lbGVtZW50IGFycmF5IHdpdGggMCB0aGUgdGltZXN0YW1wLCAxIHRoZSBwcmljZSBpbiBjZW50cywgMiB0aGUgYWRkcmVzcyBjYXAKICBmdW5jdGlvbiBnZXRTYWxlRGF0YShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiB0aW1lc3RhbXApCiAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgdmlldwogICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKHVpbnQyNTZbM10pCiAgewogICAgdWludDI1NlszXSBtZW1vcnkgX3RoaXNEYXRhOwogICAgdWludDI1NiBpbmRleDsKCiAgICB3aGlsZSgoaW5kZXggPCBzZWxmLm1pbGVzdG9uZVRpbWVzLmxlbmd0aCkgJiYgKHNlbGYubWlsZXN0b25lVGltZXNbaW5kZXhdIDwgdGltZXN0YW1wKSkgewogICAgICBpbmRleCsrOwogICAgfQogICAgaWYoaW5kZXggPT0gMCkKICAgICAgaW5kZXgrKzsKCiAgICBfdGhpc0RhdGFbMF0gPSBzZWxmLm1pbGVzdG9uZVRpbWVzW2luZGV4IC0gMV07CiAgICBfdGhpc0RhdGFbMV0gPSBzZWxmLnNhbGVEYXRhW190aGlzRGF0YVswXV1bMF07CiAgICBfdGhpc0RhdGFbMl0gPSBzZWxmLnNhbGVEYXRhW190aGlzRGF0YVswXV1bMV07CiAgICByZXR1cm4gX3RoaXNEYXRhOwogIH0KCiAgLy8vIEBkZXYgR2V0cyB0aGUgbnVtYmVyIG9mIHRva2VucyBzb2xkIHRodXMgZmFyCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiBOdW1iZXIgb2YgdG9rZW5zIHNvbGQKICBmdW5jdGlvbiBnZXRUb2tlbnNTb2xkKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2VsZi5zdGFydGluZ1Rva2VuQmFsYW5jZSAtIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbc2VsZi5vd25lcl07CiAgfQp9CgpsaWJyYXJ5IFRva2VuTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CgogIHN0cnVjdCBUb2tlblN0b3JhZ2UgewogICAgYm9vbCBpbml0aWFsaXplZDsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgc3RyaW5nIG5hbWU7CiAgICBzdHJpbmcgc3ltYm9sOwogICAgdWludDI1NiB0b3RhbFN1cHBseTsKICAgIHVpbnQyNTYgaW5pdGlhbFN1cHBseTsKICAgIGFkZHJlc3Mgb3duZXI7CiAgICB1aW50OCBkZWNpbWFsczsKICAgIGJvb2wgc3RpbGxNaW50aW5nOwogIH0KCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgT3duZXJDaGFuZ2UoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvKTsKICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBidXJuZXIsIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IE1pbnRpbmdDbG9zZWQoYm9vbCBtaW50aW5nQ2xvc2VkKTsKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IHRoZSBTdGFuZGFyZCBUb2tlbiB1cG9uIGNyZWF0aW9uLgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgLy8vIEBwYXJhbSBfc3ltYm9sIFN5bWJvbCBvZiB0aGUgbmV3IHRva2VuCiAgLy8vIEBwYXJhbSBfZGVjaW1hbHMgRGVjaW1hbCBwbGFjZXMgZm9yIHRoZSB0b2tlbiByZXByZXNlbnRlZAogIC8vLyBAcGFyYW0gX2luaXRpYWxfc3VwcGx5IFRoZSBpbml0aWFsIHRva2VuIHN1cHBseQogIC8vLyBAcGFyYW0gX2FsbG93TWludGluZyBUcnVlIGlmIGFkZGl0aW9uYWwgdG9rZW5zIGNhbiBiZSBjcmVhdGVkLCBmYWxzZSBvdGhlcndpc2UKICBmdW5jdGlvbiBpbml0KFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICAgICAgICAgIHN0cmluZyBfc3ltYm9sLAogICAgICAgICAgICAgICAgdWludDggX2RlY2ltYWxzLAogICAgICAgICAgICAgICAgdWludDI1NiBfaW5pdGlhbF9zdXBwbHksCiAgICAgICAgICAgICAgICBib29sIF9hbGxvd01pbnRpbmcpCiAgICAgICAgICAgICAgICBwdWJsaWMKICB7CiAgICByZXF1aXJlKCFzZWxmLmluaXRpYWxpemVkKTsKICAgIHNlbGYuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgc2VsZi5uYW1lID0gX25hbWU7CiAgICBzZWxmLnN5bWJvbCA9IF9zeW1ib2w7CiAgICBzZWxmLnRvdGFsU3VwcGx5ID0gX2luaXRpYWxfc3VwcGx5OwogICAgc2VsZi5pbml0aWFsU3VwcGx5ID0gX2luaXRpYWxfc3VwcGx5OwogICAgc2VsZi5kZWNpbWFscyA9IF9kZWNpbWFsczsKICAgIHNlbGYub3duZXIgPSBfb3duZXI7CiAgICBzZWxmLnN0aWxsTWludGluZyA9IF9hbGxvd01pbnRpbmc7CiAgICBzZWxmLmJhbGFuY2VzW19vd25lcl0gPSBfaW5pdGlhbF9zdXBwbHk7CiAgfQoKICAvLy8gQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBjYWxsZXIncyBhY2NvdW50IHRvIGFub3RoZXIgYWNjb3VudC4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiB0cmFuc2ZlcihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiBiYWxhbmNlOwoKICAgIChlcnIsYmFsYW5jZSkgPSBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwogICAgc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2U7CiAgICAvL0l0J3Mgbm90IHBvc3NpYmxlIHRvIG92ZXJmbG93IHRva2VuIHN1cHBseQogICAgc2VsZi5iYWxhbmNlc1tfdG9dID0gc2VsZi5iYWxhbmNlc1tfdG9dICsgX3ZhbHVlOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemVkIGNhbGxlciB0cmFuc2ZlcnMgdG9rZW5zIGZyb20gb25lIGFjY291bnQgdG8gYW5vdGhlcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Zyb20gQWRkcmVzcyB0byBzZW5kIHRva2VucyBmcm9tCiAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBzZW5kIHRva2VucyB0bwogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF92YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgdmFyIF9hbGxvd2FuY2UgPSBzZWxmLmFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwogICAgYm9vbCBlcnI7CiAgICB1aW50MjU2IGJhbGFuY2VPd25lcjsKICAgIHVpbnQyNTYgYmFsYW5jZVNwZW5kZXI7CgogICAgKGVycixiYWxhbmNlT3duZXIpID0gc2VsZi5iYWxhbmNlc1tfZnJvbV0ubWludXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgKGVycixiYWxhbmNlU3BlbmRlcikgPSBfYWxsb3dhbmNlLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYuYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZU93bmVyOwogICAgc2VsZi5hbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGJhbGFuY2VTcGVuZGVyOwogICAgc2VsZi5iYWxhbmNlc1tfdG9dID0gc2VsZi5iYWxhbmNlc1tfdG9dICsgX3ZhbHVlOwoKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFJldHJpZXZlIHRva2VuIGJhbGFuY2UgZm9yIGFuIGFjY291bnQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIHRvIHJldHJpZXZlIGJhbGFuY2Ugb2YKICAvLy8gQHJldHVybiBiYWxhbmNlIFRoZSBudW1iZXIgb2YgdG9rZW5zIGluIHRoZSBzdWJqZWN0IGFjY291bnQKICBmdW5jdGlvbiBiYWxhbmNlT2YoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIHNlbGYuYmFsYW5jZXNbX293bmVyXTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZSBhbiBhY2NvdW50IHRvIHNlbmQgdG9rZW5zIG9uIGNhbGxlcidzIGJlaGFsZgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyB0byBhdXRob3JpemUKICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIGF1dGhvcml6ZWQgYWNjb3VudCBtYXkgc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gYXBwcm92ZShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIC8vIG11c3Qgc2V0IHRvIHplcm8gYmVmb3JlIGNoYW5naW5nIGFwcHJvdmFsIGFtb3VudCBpbiBhY2NvcmRhbmNlIHdpdGggc3BlYwogICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFJlbWFpbmluZyB0b2tlbnMgdGhpcmQgcGFydHkgc3BlbmRlciBoYXMgdG8gc2VuZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gaG9sZGVyCiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGF1dGhvcml6ZWQgc3BlbmRlcgogIC8vLyBAcmV0dXJuIHJlbWFpbmluZyBOdW1iZXIgb2YgdG9rZW5zIHNwZW5kZXIgaGFzIGxlZnQgaW4gb3duZXIncyBhY2NvdW50CiAgZnVuY3Rpb24gYWxsb3dhbmNlKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgdmlldwogICAgICAgICAgICAgICAgICAgICByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIHNlbGYuYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZSB0aGlyZCBwYXJ0eSB0cmFuc2ZlciBieSBpbmNyZWFzaW5nL2RlY3JlYXNpbmcgYWxsb3dlZCByYXRoZXIgdGhhbiBzZXR0aW5nIGl0CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGF1dGhvcml6ZQogIC8vLyBAcGFyYW0gX3ZhbHVlQ2hhbmdlIEluY3JlYXNlIG9yIGRlY3JlYXNlIGluIG51bWJlciBvZiB0b2tlbnMgYXV0aG9yaXplZCBhY2NvdW50IG1heSBzZW5kCiAgLy8vIEBwYXJhbSBfaW5jcmVhc2UgVHJ1ZSBpZiBpbmNyZWFzaW5nIGFsbG93YW5jZSwgZmFsc2UgaWYgZGVjcmVhc2luZyBhbGxvd2FuY2UKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGFwcHJvdmVDaGFuZ2UgKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlQ2hhbmdlLCBib29sIF9pbmNyZWFzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgcmV0dXJucyAoYm9vbCkKICB7CiAgICB1aW50MjU2IF9uZXdBbGxvd2VkOwogICAgYm9vbCBlcnI7CgogICAgaWYoX2luY3JlYXNlKSB7CiAgICAgIChlcnIsIF9uZXdBbGxvd2VkKSA9IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0ucGx1cyhfdmFsdWVDaGFuZ2UpOwogICAgICByZXF1aXJlKCFlcnIpOwoKICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9uZXdBbGxvd2VkOwogICAgfSBlbHNlIHsKICAgICAgaWYgKF92YWx1ZUNoYW5nZSA+IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pIHsKICAgICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBfbmV3QWxsb3dlZCA9IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gLSBfdmFsdWVDaGFuZ2U7CiAgICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9uZXdBbGxvd2VkOwogICAgICB9CiAgICB9CgogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9uZXdBbGxvd2VkKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgQ2hhbmdlIG93bmluZyBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCwgc3BlY2lmaWNhbGx5IGZvciBtaW50aW5nCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfbmV3T3duZXIgQWRkcmVzcyBmb3IgdGhlIG5ldyBvd25lcgogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gY2hhbmdlT3duZXIoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKChzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpICYmIChfbmV3T3duZXIgPiAwKSk7CgogICAgc2VsZi5vd25lciA9IF9uZXdPd25lcjsKICAgIE93bmVyQ2hhbmdlKG1zZy5zZW5kZXIsIF9uZXdPd25lcik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IE1pbnRzIGFkZGl0aW9uYWwgdG9rZW5zLCBuZXcgdG9rZW5zIGdvIHRvIG93bmVyCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IE51bWJlciBvZiB0b2tlbnMgdG8gbWludAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gbWludFRva2VuKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcikgJiYgc2VsZi5zdGlsbE1pbnRpbmcpOwogICAgdWludDI1NiBfbmV3QW1vdW50OwogICAgYm9vbCBlcnI7CgogICAgKGVyciwgX25ld0Ftb3VudCkgPSBzZWxmLnRvdGFsU3VwcGx5LnBsdXMoX2Ftb3VudCk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYudG90YWxTdXBwbHkgPSAgX25ld0Ftb3VudDsKICAgIHNlbGYuYmFsYW5jZXNbc2VsZi5vd25lcl0gPSBzZWxmLmJhbGFuY2VzW3NlbGYub3duZXJdICsgX2Ftb3VudDsKICAgIFRyYW5zZmVyKDB4MCwgc2VsZi5vd25lciwgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFBlcm1hbmVudCBzdG9wcyBtaW50aW5nCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBjbG9zZU1pbnQoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKTsKCiAgICBzZWxmLnN0aWxsTWludGluZyA9IGZhbHNlOwogICAgTWludGluZ0Nsb3NlZCh0cnVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUGVybWFuZW50bHkgYnVybiB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9hbW91bnQgQW1vdW50IG9mIHRva2VucyB0byBidXJuCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBidXJuVG9rZW4oVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICB1aW50MjU2IF9uZXdCYWxhbmNlOwogICAgICBib29sIGVycjsKCiAgICAgIChlcnIsIF9uZXdCYWxhbmNlKSA9IHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0ubWludXMoX2Ftb3VudCk7CiAgICAgIHJlcXVpcmUoIWVycik7CgogICAgICBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdID0gX25ld0JhbGFuY2U7CiAgICAgIHNlbGYudG90YWxTdXBwbHkgPSBzZWxmLnRvdGFsU3VwcGx5IC0gX2Ftb3VudDsKICAgICAgQnVybihtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBfYW1vdW50KTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQp9CgpsaWJyYXJ5IEJhc2ljTWF0aExpYiB7CiAgLy8vIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciBvdmVyZmxvdyBiZWZvcmUgcmV0dXJuaW5nLgogIC8vLyBEb2VzIG5vdCB0aHJvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHByb2R1Y3Qgb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHRpbWVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBtdWwoYSxiKQogICAgICBzd2l0Y2ggb3IoaXN6ZXJvKGIpLCBlcShkaXYocmVzLGIpLCBhKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IERpdmlkZXMgdHdvIG51bWJlcnMgYnV0IGNoZWNrcyBmb3IgMCBpbiB0aGUgZGl2aXNvciBmaXJzdC4KICAvLy8gRG9lcyBub3QgdGhyb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIGBiYCBpcyAwCiAgLy8vIEByZXR1cm4gcmVzIFRoZSBxdW90aWVudCBvZiBhIGFuZCBiLCBvciAwIGlmIGBiYCBpcyAwCiAgZnVuY3Rpb24gZGl2aWRlZEJ5KHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGVycix1aW50MjU2IGkpIHsKICAgIHVpbnQyNTYgcmVzOwogICAgYXNzZW1ibHl7CiAgICAgIHN3aXRjaCBpc3plcm8oYikKICAgICAgY2FzZSAwIHsKICAgICAgICByZXMgOj0gZGl2KGEsYikKICAgICAgICBsZXQgbG9jIDo9IG1sb2FkKDB4NDApCiAgICAgICAgbXN0b3JlKGFkZChsb2MsMHgyMCkscmVzKQogICAgICAgIGkgOj0gbWxvYWQoYWRkKGxvYywweDIwKSkKICAgICAgfQogICAgICBkZWZhdWx0IHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIGkgOj0gMAogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBBZGRzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIG92ZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgc3VtIG9mIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICBmdW5jdGlvbiBwbHVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGVyciwgdWludDI1NiByZXMpIHsKICAgIGFzc2VtYmx5ewogICAgICByZXMgOj0gYWRkKGEsYikKICAgICAgc3dpdGNoIGFuZChlcShzdWIocmVzLGIpLCBhKSwgb3IoZ3QocmVzLGIpLGVxKHJlcyxiKSkpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBTdWJ0cmFjdHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3IgdW5kZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93IGJ1dCByYXRoZXIgbG9ncyBhbiBFcnIgZXZlbnQgaWYgdGhlcmUgaXMgdW5kZXJmbG93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiB0aGVyZSBpcyB1bmRlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIGZ1bmN0aW9uIG1pbnVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBzdWIoYSxiKQogICAgICBzd2l0Y2ggZXEoYW5kKGVxKGFkZChyZXMsYiksIGEpLCBvcihsdChyZXMsYSksIGVxKHJlcyxhKSkpLCAxKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogIH0KfQoKY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gewogIHVzaW5nIFRva2VuTGliIGZvciBUb2tlbkxpYi5Ub2tlblN0b3JhZ2U7CgogIFRva2VuTGliLlRva2VuU3RvcmFnZSBwdWJsaWMgdG9rZW47CgogIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuKGFkZHJlc3Mgb3duZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OCBkZWNpbWFscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGluaXRpYWxTdXBwbHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBhbGxvd01pbnRpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgewogICAgdG9rZW4uaW5pdChvd25lciwgbmFtZSwgc3ltYm9sLCBkZWNpbWFscywgaW5pdGlhbFN1cHBseSwgYWxsb3dNaW50aW5nKTsKICB9CgogIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiB0b2tlbi5uYW1lOwogIH0KCiAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gdG9rZW4uc3ltYm9sOwogIH0KCiAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCkgewogICAgcmV0dXJuIHRva2VuLmRlY2ltYWxzOwogIH0KCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4udG90YWxTdXBwbHk7CiAgfQoKICBmdW5jdGlvbiBpbml0aWFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLmluaXRpYWxTdXBwbHk7CiAgfQoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2Yod2hvKTsKICB9CgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5hbGxvd2FuY2Uob3duZXIsIHNwZW5kZXIpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZUNoYW5nZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWVDaGFuZ2UsIGJvb2wgaW5jcmVhc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmV0dXJuIHRva2VuLmFwcHJvdmVDaGFuZ2Uoc3BlbmRlciwgdmFsdWVDaGFuZ2UsIGluY3JlYXNlKTsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4uY2hhbmdlT3duZXIobmV3T3duZXIpOwogIH0KCiAgZnVuY3Rpb24gYnVyblRva2VuKHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmJ1cm5Ub2tlbihhbW91bnQpOwogIH0KfQ=='.
	

]
