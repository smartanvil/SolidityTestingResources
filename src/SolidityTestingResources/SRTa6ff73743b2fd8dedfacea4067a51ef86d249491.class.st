Class {
	#name : #SRTa6ff73743b2fd8dedfacea4067a51ef86d249491,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa6ff73743b2fd8dedfacea4067a51ef86d249491 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgovLyBjb3B5cmlnaHQgPHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0MjIxMmQyYzM2MjMyMTM2MDIwNzM2MmEyNzMwMjcyZjJkMmM2YzIxMmQyZiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4KCmNvbnRyYWN0IFNhZmVNYXRoIHsKCiAgICAvKiBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsgKi8KICAgIC8qICAgaWYgKCFhc3NlcnRpb24pIHsgKi8KICAgIC8qICAgICB0aHJvdzsgKi8KICAgIC8qICAgfSAqLwogICAgLyogfSAgICAgIC8vIGFzc2VydCBubyBsb25nZXIgbmVlZGVkIG9uY2Ugc29saWRpdHkgaXMgb24gMC40LjEwICovCgogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiB6ID0geCArIHk7CiAgICAgIGFzc2VydCgoeiA+PSB4KSAmJiAoeiA+PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWJ0cmFjdCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgYXNzZXJ0KHggPj0geSk7CiAgICAgIHVpbnQyNTYgeiA9IHggLSB5OwogICAgICByZXR1cm4gejsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlTXVsdCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgcHVyZSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiB6ID0geCAqIHk7CiAgICAgIGFzc2VydCgoeCA9PSAwKXx8KHoveCA9PSB5KSk7CiAgICAgIHJldHVybiB6OwogICAgfQoKfQoKY29udHJhY3QgQmFzaWNBY2Nlc3NDb250cm9sIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgLy8gYWRkcmVzc1tdIHB1YmxpYyBtb2RlcmF0b3JzOwogICAgdWludDE2IHB1YmxpYyB0b3RhbE1vZGVyYXRvcnMgPSAwOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbW9kZXJhdG9yczsKICAgIGJvb2wgcHVibGljIGlzTWFpbnRhaW5pbmcgPSBmYWxzZTsKCiAgICBmdW5jdGlvbiBCYXNpY0FjY2Vzc0NvbnRyb2woKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5TW9kZXJhdG9ycygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbW9kZXJhdG9yc1ttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzQWN0aXZlIHsKICAgICAgICByZXF1aXJlKCFpc01haW50YWluaW5nKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIENoYW5nZU93bmVyKGFkZHJlc3MgX25ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBpZiAoX25ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiBBZGRNb2RlcmF0b3IoYWRkcmVzcyBfbmV3TW9kZXJhdG9yKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBpZiAobW9kZXJhdG9yc1tfbmV3TW9kZXJhdG9yXSA9PSBmYWxzZSkgewogICAgICAgICAgICBtb2RlcmF0b3JzW19uZXdNb2RlcmF0b3JdID0gdHJ1ZTsKICAgICAgICAgICAgdG90YWxNb2RlcmF0b3JzICs9IDE7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBSZW1vdmVNb2RlcmF0b3IoYWRkcmVzcyBfb2xkTW9kZXJhdG9yKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBpZiAobW9kZXJhdG9yc1tfb2xkTW9kZXJhdG9yXSA9PSB0cnVlKSB7CiAgICAgICAgICAgIG1vZGVyYXRvcnNbX29sZE1vZGVyYXRvcl0gPSBmYWxzZTsKICAgICAgICAgICAgdG90YWxNb2RlcmF0b3JzIC09IDE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFVwZGF0ZU1haW50YWluaW5nKGJvb2wgX2lzTWFpbnRhaW5pbmcpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGlzTWFpbnRhaW5pbmcgPSBfaXNNYWludGFpbmluZzsKICAgIH0KfQoKY29udHJhY3QgRXRoZXJlbW9uRW51bSB7CgogICAgZW51bSBSZXN1bHRDb2RlIHsKICAgICAgICBTVUNDRVNTLAogICAgICAgIEVSUk9SX0NMQVNTX05PVF9GT1VORCwKICAgICAgICBFUlJPUl9MT1dfQkFMQU5DRSwKICAgICAgICBFUlJPUl9TRU5EX0ZBSUwsCiAgICAgICAgRVJST1JfTk9UX1RSQUlORVIsCiAgICAgICAgRVJST1JfTk9UX0VOT1VHSF9NT05FWSwKICAgICAgICBFUlJPUl9JTlZBTElEX0FNT1VOVCwKICAgICAgICBFUlJPUl9PQkpfTk9UX0ZPVU5ELAogICAgICAgIEVSUk9SX09CSl9JTlZBTElEX09XTkVSU0hJUAogICAgfQogICAgCiAgICBlbnVtIEFycmF5VHlwZSB7CiAgICAgICAgQ0xBU1NfVFlQRSwKICAgICAgICBTVEFUX1NURVAsCiAgICAgICAgU1RBVF9TVEFSVCwKICAgICAgICBTVEFUX0JBU0UsCiAgICAgICAgT0JKX1NLSUxMCiAgICB9CiAgICAKICAgIGVudW0gUHJvcGVydHlUeXBlIHsKICAgICAgICBBTkNFU1RPUiwKICAgICAgICBYRkFDVE9SCiAgICB9Cn0KCmNvbnRyYWN0IEV0aGVyZW1vbkRhdGFCYXNlIGlzIEV0aGVyZW1vbkVudW0sIEJhc2ljQWNjZXNzQ29udHJvbCwgU2FmZU1hdGggewogICAgCiAgICB1aW50NjQgcHVibGljIHRvdGFsTW9uc3RlcjsKICAgIHVpbnQzMiBwdWJsaWMgdG90YWxDbGFzczsKICAgIAogICAgLy8gd3JpdGUKICAgIGZ1bmN0aW9uIGFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUgX3R5cGUsIHVpbnQ2NCBfaWQsIHVpbnQ4IF92YWx1ZSkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludCk7CiAgICBmdW5jdGlvbiByZW1vdmVFbGVtZW50T2ZBcnJheVR5cGUoQXJyYXlUeXBlIF90eXBlLCB1aW50NjQgX2lkLCB1aW50OCBfdmFsdWUpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gc2V0TW9uc3RlckNsYXNzKHVpbnQzMiBfY2xhc3NJZCwgdWludDI1NiBfcHJpY2UsIHVpbnQyNTYgX3JldHVyblByaWNlLCBib29sIF9jYXRjaGFibGUpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQzMik7CiAgICBmdW5jdGlvbiBhZGRNb25zdGVyT2JqKHVpbnQzMiBfY2xhc3NJZCwgYWRkcmVzcyBfdHJhaW5lciwgc3RyaW5nIF9uYW1lKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gc2V0TW9uc3Rlck9iaih1aW50NjQgX29iaklkLCBzdHJpbmcgX25hbWUsIHVpbnQzMiBfZXhwLCB1aW50MzIgX2NyZWF0ZUluZGV4LCB1aW50MzIgX2xhc3RDbGFpbUluZGV4KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWM7CiAgICBmdW5jdGlvbiBpbmNyZWFzZU1vbnN0ZXJFeHAodWludDY0IF9vYmpJZCwgdWludDMyIGFtb3VudCkgb25seU1vZGVyYXRvcnMgcHVibGljOwogICAgZnVuY3Rpb24gZGVjcmVhc2VNb25zdGVyRXhwKHVpbnQ2NCBfb2JqSWQsIHVpbnQzMiBhbW91bnQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHJlbW92ZU1vbnN0ZXJJZE1hcHBpbmcoYWRkcmVzcyBfdHJhaW5lciwgdWludDY0IF9tb25zdGVySWQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGFkZE1vbnN0ZXJJZE1hcHBpbmcoYWRkcmVzcyBfdHJhaW5lciwgdWludDY0IF9tb25zdGVySWQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGNsZWFyTW9uc3RlclJldHVybkJhbGFuY2UodWludDY0IF9tb25zdGVySWQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQyNTYgYW1vdW50KTsKICAgIGZ1bmN0aW9uIGNvbGxlY3RBbGxSZXR1cm5CYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKHVpbnQyNTYgYW1vdW50KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyTW9uc3RlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDY0IF9tb25zdGVySWQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyByZXR1cm5zKFJlc3VsdENvZGUpOwogICAgZnVuY3Rpb24gYWRkRXh0cmFCYWxhbmNlKGFkZHJlc3MgX3RyYWluZXIsIHVpbnQyNTYgX2Ftb3VudCkgb25seU1vZGVyYXRvcnMgcHVibGljIHJldHVybnModWludDI1Nik7CiAgICBmdW5jdGlvbiBkZWR1Y3RFeHRyYUJhbGFuY2UoYWRkcmVzcyBfdHJhaW5lciwgdWludDI1NiBfYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgcmV0dXJucyh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHNldEV4dHJhQmFsYW5jZShhZGRyZXNzIF90cmFpbmVyLCB1aW50MjU2IF9hbW91bnQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYzsKICAgIAogICAgLy8gcmVhZAogICAgZnVuY3Rpb24gZ2V0U2l6ZUFycmF5VHlwZShBcnJheVR5cGUgX3R5cGUsIHVpbnQ2NCBfaWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gZ2V0RWxlbWVudEluQXJyYXlUeXBlKEFycmF5VHlwZSBfdHlwZSwgdWludDY0IF9pZCwgdWludCBfaW5kZXgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJDbGFzcyh1aW50MzIgX2NsYXNzSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQzMiBjbGFzc0lkLCB1aW50MjU2IHByaWNlLCB1aW50MjU2IHJldHVyblByaWNlLCB1aW50MzIgdG90YWwsIGJvb2wgY2F0Y2hhYmxlKTsKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJPYmoodWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDY0IG9iaklkLCB1aW50MzIgY2xhc3NJZCwgYWRkcmVzcyB0cmFpbmVyLCB1aW50MzIgZXhwLCB1aW50MzIgY3JlYXRlSW5kZXgsIHVpbnQzMiBsYXN0Q2xhaW1JbmRleCwgdWludCBjcmVhdGVUaW1lKTsKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJOYW1lKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHN0cmluZyBuYW1lKTsKICAgIGZ1bmN0aW9uIGdldEV4dHJhQmFsYW5jZShhZGRyZXNzIF90cmFpbmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJEZXhTaXplKGFkZHJlc3MgX3RyYWluZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3Rlck9iaklkKGFkZHJlc3MgX3RyYWluZXIsIHVpbnQgaW5kZXgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBnZXRFeHBlY3RlZEJhbGFuY2UoYWRkcmVzcyBfdHJhaW5lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRNb25zdGVyUmV0dXJuKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYgY3VycmVudCwgdWludDI1NiB0b3RhbCk7Cn0KCmNvbnRyYWN0IEV0aGVyZW1vblRyYW5zZm9ybURhdGEgewogICAgdWludDY0IHB1YmxpYyB0b3RhbEVnZyA9IDA7CiAgICBmdW5jdGlvbiBnZXRIYXRjaGluZ0VnZ0lkKGFkZHJlc3MgX3RyYWluZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludDY0KTsKICAgIGZ1bmN0aW9uIGdldEhhdGNoaW5nRWdnRGF0YShhZGRyZXNzIF90cmFpbmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKHVpbnQ2NCwgdWludDY0LCB1aW50MzIsIGFkZHJlc3MsIHVpbnQsIHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBnZXRUcmFuZm9ybWVkSWQodWludDY0IF9vYmpJZCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gY291bnRFZ2codWludDY0IF9vYmpJZCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50KTsKICAgIAogICAgZnVuY3Rpb24gc2V0SGF0Y2hUaW1lKHVpbnQ2NCBfZWdnSWQsIHVpbnQgX2hhdGNoVGltZSkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBzZXRIYXRjaGVkRWdnKHVpbnQ2NCBfZWdnSWQsIHVpbnQ2NCBfbmV3T2JqSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkRWdnKHVpbnQ2NCBfb2JqSWQsIHVpbnQzMiBfY2xhc3NJZCwgYWRkcmVzcyBfdHJhaW5lciwgdWludCBfaGF0Y2hUaW1lKSBleHRlcm5hbCByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBzZXRUcmFuZm9ybWVkKHVpbnQ2NCBfb2JqSWQsIHVpbnQ2NCBfbmV3T2JqSWQpIGV4dGVybmFsOwp9Cgpjb250cmFjdCBFdGhlcmVtb25Xb3JsZCBpcyBFdGhlcmVtb25FbnVtIHsKICAgIAogICAgZnVuY3Rpb24gZ2V0R2VuMENPbmZpZyh1aW50MzIgX2NsYXNzSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQzMiwgdWludDI1NiwgdWludDMyKTsKICAgIGZ1bmN0aW9uIGdldFRyYWluZXJFYXJuKGFkZHJlc3MgX3RyYWluZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0UmV0dXJuRnJvbU1vbnN0ZXIodWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDI1NiBjdXJyZW50LCB1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGdldENsYXNzUHJvcGVydHlWYWx1ZSh1aW50MzIgX2NsYXNzSWQsIFByb3BlcnR5VHlwZSBfdHlwZSwgdWludCBpbmRleCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyh1aW50MzIpOwogICAgZnVuY3Rpb24gZ2V0Q2xhc3NQcm9wZXJ0eVNpemUodWludDMyIF9jbGFzc0lkLCBQcm9wZXJ0eVR5cGUgX3R5cGUpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnModWludCk7Cn0KCmludGVyZmFjZSBFdGhlcmVtb25CYXR0bGUgewogICAgZnVuY3Rpb24gaXNPbkJhdHRsZSh1aW50NjQgX29iaklkKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0TW9uc3RlckxldmVsKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ4KTsKfQoKaW50ZXJmYWNlIEV0aGVyZW1vblRyYWRlSW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGlzT25UcmFkaW5nKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMoYm9vbCk7Cn0KCmNvbnRyYWN0IEV0aGVyZW1vblRyYW5zZm9ybSBpcyBFdGhlcmVtb25FbnVtLCBCYXNpY0FjY2Vzc0NvbnRyb2wsIFNhZmVNYXRoIHsKICAgIHVpbnQ4IGNvbnN0YW50IHB1YmxpYyBTVEFUX0NPVU5UID0gNjsKICAgIHVpbnQ4IGNvbnN0YW50IHB1YmxpYyBTVEFUX01BWCA9IDMyOwogICAgdWludDggY29uc3RhbnQgcHVibGljIEdFTjBfTk8gPSAyNDsKICAgIAogICAgc3RydWN0IE1vbnN0ZXJDbGFzc0FjYyB7CiAgICAgICAgdWludDMyIGNsYXNzSWQ7CiAgICAgICAgdWludDI1NiBwcmljZTsKICAgICAgICB1aW50MjU2IHJldHVyblByaWNlOwogICAgICAgIHVpbnQzMiB0b3RhbDsKICAgICAgICBib29sIGNhdGNoYWJsZTsKICAgIH0KCiAgICBzdHJ1Y3QgTW9uc3Rlck9iakFjYyB7CiAgICAgICAgdWludDY0IG1vbnN0ZXJJZDsKICAgICAgICB1aW50MzIgY2xhc3NJZDsKICAgICAgICBhZGRyZXNzIHRyYWluZXI7CiAgICAgICAgc3RyaW5nIG5hbWU7CiAgICAgICAgdWludDMyIGV4cDsKICAgICAgICB1aW50MzIgY3JlYXRlSW5kZXg7CiAgICAgICAgdWludDMyIGxhc3RDbGFpbUluZGV4OwogICAgICAgIHVpbnQgY3JlYXRlVGltZTsKICAgIH0KICAgIAogICAgc3RydWN0IE1vbnN0ZXJFZ2cgewogICAgICAgIHVpbnQ2NCBlZ2dJZDsKICAgICAgICB1aW50NjQgb2JqSWQ7CiAgICAgICAgdWludDMyIGNsYXNzSWQ7CiAgICAgICAgYWRkcmVzcyB0cmFpbmVyOwogICAgICAgIHVpbnQgaGF0Y2hUaW1lOwogICAgICAgIHVpbnQ2NCBuZXdPYmpJZDsKICAgIH0KICAgIAogICAgc3RydWN0IEJhc2ljT2JqSW5mbyB7CiAgICAgICAgdWludDMyIGNsYXNzSWQ7CiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICB1aW50OCBsZXZlbDsKICAgIH0KICAgIAogICAgLy8gR2VuMCBoYXMgcmV0dXJuIHByaWNlICYgbm8gbG9uZ2VyIGNhbiBiZSBjYXVnaHQgd2hlbiB0aGlzIGNvbnRyYWN0IGlzIGRlcGxveWVkCiAgICBzdHJ1Y3QgR2VuMENvbmZpZyB7CiAgICAgICAgdWludDMyIGNsYXNzSWQ7CiAgICAgICAgdWludDI1NiBvcmlnaW5hbFByaWNlOwogICAgICAgIHVpbnQyNTYgcmV0dXJuUHJpY2U7CiAgICAgICAgdWludDMyIHRvdGFsOyAvLyB0b3RhbCBjYXVnaHQgKG5vdCBjb3VudCB0aG9zZSBmcm9tIGVnZ3MpCiAgICB9CiAgICAKICAgIC8vIGhhdGNoaW5nIHJhbmdlCiAgICB1aW50MTYgcHVibGljIGhhdGNoU3RhcnRUaW1lID0gMjsgLy8gaG91cgogICAgdWludDE2IHB1YmxpYyBoYXRjaE1heFRpbWUgPSA0NjsgLy8gaG91cgogICAgdWludCBwdWJsaWMgcmVtb3ZlSGF0Y2hpbmdUaW1lRmVlID0gMC4wNSBldGhlcjsgLy8gRVRICiAgICB1aW50IHB1YmxpYyBidXlFZ2dGZWUgPSAwLjA2IGV0aGVyOyAvLyBFVEgKICAgIAogICAgdWludDMyW10gcHVibGljIHJhbmRvbUNsYXNzSWRzOwogICAgbWFwcGluZyh1aW50MzIgPT4gdWludDgpIHB1YmxpYyBsYXlpbmdFZ2dMZXZlbHM7CiAgICBtYXBwaW5nKHVpbnQzMiA9PiB1aW50OCkgcHVibGljIGxheWluZ0VnZ0RlZHVjdGlvbnM7CiAgICBtYXBwaW5nKHVpbnQzMiA9PiB1aW50OCkgcHVibGljIHRyYW5zZm9ybUxldmVsczsKICAgIG1hcHBpbmcodWludDMyID0+IHVpbnQzMikgcHVibGljIHRyYW5zZm9ybUNsYXNzZXM7CgogICAgbWFwcGluZyh1aW50OCA9PiB1aW50MzIpIHB1YmxpYyBsZXZlbEV4cHM7CiAgICBhZGRyZXNzIHByaXZhdGUgbGFzdEhhdGNoaW5nQWRkcmVzczsKICAgIAogICAgbWFwcGluZyh1aW50MzIgPT4gR2VuMENvbmZpZykgcHVibGljIGdlbjBDb25maWc7CiAgICAKICAgIC8vIGxpbmtlZCBzbWFydCBjb250cmFjdAogICAgYWRkcmVzcyBwdWJsaWMgZGF0YUNvbnRyYWN0OwogICAgYWRkcmVzcyBwdWJsaWMgd29ybGRDb250cmFjdDsKICAgIGFkZHJlc3MgcHVibGljIHRyYW5zZm9ybURhdGFDb250cmFjdDsKICAgIGFkZHJlc3MgcHVibGljIGJhdHRsZUNvbnRyYWN0OwogICAgYWRkcmVzcyBwdWJsaWMgdHJhZGVDb250cmFjdDsKICAgIAogICAgLy8gZXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpOwogICAgZXZlbnQgRXZlbnRMYXlFZ2coYWRkcmVzcyBpbmRleGVkIHRyYWluZXIsIHVpbnQ2NCBvYmpJZCwgdWludDY0IGVnZ0lkKTsKICAgIAogICAgLy8gbW9kaWZpZXIKICAgIAogICAgbW9kaWZpZXIgcmVxdWlyZURhdGFDb250cmFjdCB7CiAgICAgICAgcmVxdWlyZShkYXRhQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgcmVxdWlyZVRyYW5zZm9ybURhdGFDb250cmFjdCB7CiAgICAgICAgcmVxdWlyZSh0cmFuc2Zvcm1EYXRhQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgcmVxdWlyZUJhdHRsZUNvbnRyYWN0IHsKICAgICAgICByZXF1aXJlKGJhdHRsZUNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIHJlcXVpcmVUcmFkZUNvbnRyYWN0IHsKICAgICAgICByZXF1aXJlKHRyYWRlQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsgICAgICAgIAogICAgfQogICAgCiAgICAKICAgIC8vIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBFdGhlcmVtb25UcmFuc2Zvcm0oYWRkcmVzcyBfZGF0YUNvbnRyYWN0LCBhZGRyZXNzIF93b3JsZENvbnRyYWN0LCBhZGRyZXNzIF90cmFuc2Zvcm1EYXRhQ29udHJhY3QsIGFkZHJlc3MgX2JhdHRsZUNvbnRyYWN0LCBhZGRyZXNzIF90cmFkZUNvbnRyYWN0KSBwdWJsaWMgewogICAgICAgIGRhdGFDb250cmFjdCA9IF9kYXRhQ29udHJhY3Q7CiAgICAgICAgd29ybGRDb250cmFjdCA9IF93b3JsZENvbnRyYWN0OwogICAgICAgIHRyYW5zZm9ybURhdGFDb250cmFjdCA9IF90cmFuc2Zvcm1EYXRhQ29udHJhY3Q7CiAgICAgICAgYmF0dGxlQ29udHJhY3QgPSBfYmF0dGxlQ29udHJhY3Q7CiAgICAgICAgdHJhZGVDb250cmFjdCA9IF90cmFkZUNvbnRyYWN0OwogICAgfQogICAgCiAgICAvLyBoZWxwZXIKICAgIGZ1bmN0aW9uIGdldFJhbmRvbSh1aW50MTYgbWF4UmFuLCB1aW50OCBpbmRleCwgYWRkcmVzcyBwcmlBZGRyZXNzKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50OCkgewogICAgICAgIHVpbnQyNTYgZ2VuTnVtID0gdWludDI1NihibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKSArIHVpbnQyNTYocHJpQWRkcmVzcyk7CiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IGluZGV4ICYmIGkgPCA2OyBpICsrKSB7CiAgICAgICAgICAgIGdlbk51bSAvPSAyNTY7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1aW50OChnZW5OdW0gJSBtYXhSYW4pOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZGROZXdPYmooYWRkcmVzcyBfdHJhaW5lciwgdWludDMyIF9jbGFzc0lkKSBwcml2YXRlIHJldHVybnModWludDY0KSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgdWludDY0IG9iaklkID0gZGF0YS5hZGRNb25zdGVyT2JqKF9jbGFzc0lkLCBfdHJhaW5lciwgIi4ubmFtZSBtZS4uLiIpOwogICAgICAgIGZvciAodWludCBpPTA7IGkgPCBTVEFUX0NPVU5UOyBpKz0gMSkgewogICAgICAgICAgICB1aW50OCB2YWx1ZSA9IGdldFJhbmRvbShTVEFUX01BWCwgdWludDgoaSksIGxhc3RIYXRjaGluZ0FkZHJlc3MpICsgZGF0YS5nZXRFbGVtZW50SW5BcnJheVR5cGUoQXJyYXlUeXBlLlNUQVRfU1RBUlQsIHVpbnQ2NChfY2xhc3NJZCksIGkpOwogICAgICAgICAgICBkYXRhLmFkZEVsZW1lbnRUb0FycmF5VHlwZShBcnJheVR5cGUuU1RBVF9CQVNFLCBvYmpJZCwgdmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb2JqSWQ7CiAgICB9CiAgICAKICAgIC8vIGFkbWluICYgbW9kZXJhdG9ycwogICAgZnVuY3Rpb24gc2V0Q29udHJhY3QoYWRkcmVzcyBfZGF0YUNvbnRyYWN0LCBhZGRyZXNzIF93b3JsZENvbnRyYWN0LCBhZGRyZXNzIF90cmFuc2Zvcm1EYXRhQ29udHJhY3QsIGFkZHJlc3MgX2JhdHRsZUNvbnRyYWN0LCBhZGRyZXNzIF90cmFkZUNvbnRyYWN0KSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgZGF0YUNvbnRyYWN0ID0gX2RhdGFDb250cmFjdDsKICAgICAgICB3b3JsZENvbnRyYWN0ID0gX3dvcmxkQ29udHJhY3Q7CiAgICAgICAgdHJhbnNmb3JtRGF0YUNvbnRyYWN0ID0gX3RyYW5zZm9ybURhdGFDb250cmFjdDsKICAgICAgICBiYXR0bGVDb250cmFjdCA9IF9iYXR0bGVDb250cmFjdDsKICAgICAgICB0cmFkZUNvbnRyYWN0ID0gX3RyYWRlQ29udHJhY3Q7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3JpZ2luYWxQcmljZUdlbjAoKSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgZ2VuMENvbmZpZ1sxXSA9IEdlbjBDb25maWcoMSwgMC4zIGV0aGVyLCAwLjAwMyBldGhlciwgMzc0KTsKICAgICAgICBnZW4wQ29uZmlnWzJdID0gR2VuMENvbmZpZygyLCAwLjMgZXRoZXIsIDAuMDAzIGV0aGVyLCA0MDgpOwogICAgICAgIGdlbjBDb25maWdbM10gPSBHZW4wQ29uZmlnKDMsIDAuMyBldGhlciwgMC4wMDMgZXRoZXIsIDM3Myk7CiAgICAgICAgZ2VuMENvbmZpZ1s0XSA9IEdlbjBDb25maWcoNCwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgNDM3KTsKICAgICAgICBnZW4wQ29uZmlnWzVdID0gR2VuMENvbmZpZyg1LCAwLjEgZXRoZXIsIDAuMDAxIGV0aGVyLCA0OTcpOwogICAgICAgIGdlbjBDb25maWdbNl0gPSBHZW4wQ29uZmlnKDYsIDAuMyBldGhlciwgMC4wMDMgZXRoZXIsIDM4MCk7IAogICAgICAgIGdlbjBDb25maWdbN10gPSBHZW4wQ29uZmlnKDcsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDM0NSk7CiAgICAgICAgZ2VuMENvbmZpZ1s4XSA9IEdlbjBDb25maWcoOCwgMC4xIGV0aGVyLCAwLjAwMSBldGhlciwgNTE4KTsgCiAgICAgICAgZ2VuMENvbmZpZ1s5XSA9IEdlbjBDb25maWcoOSwgMC4xIGV0aGVyLCAwLjAwMSBldGhlciwgNDQ3KTsKICAgICAgICBnZW4wQ29uZmlnWzEwXSA9IEdlbjBDb25maWcoMTAsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDM4MCk7IAogICAgICAgIGdlbjBDb25maWdbMTFdID0gR2VuMENvbmZpZygxMSwgMC4yIGV0aGVyLCAwLjAwMiBldGhlciwgMzU0KTsKICAgICAgICBnZW4wQ29uZmlnWzEyXSA9IEdlbjBDb25maWcoMTIsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDM0Nik7CiAgICAgICAgZ2VuMENvbmZpZ1sxM10gPSBHZW4wQ29uZmlnKDEzLCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCAzNTEpOyAKICAgICAgICBnZW4wQ29uZmlnWzE0XSA9IEdlbjBDb25maWcoMTQsIDAuMiBldGhlciwgMC4wMDIgZXRoZXIsIDMzOCk7CiAgICAgICAgZ2VuMENvbmZpZ1sxNV0gPSBHZW4wQ29uZmlnKDE1LCAwLjIgZXRoZXIsIDAuMDAyIGV0aGVyLCAzNDEpOwogICAgICAgIGdlbjBDb25maWdbMTZdID0gR2VuMENvbmZpZygxNiwgMC4zNSBldGhlciwgMC4wMDM1IGV0aGVyLCAzODQpOwogICAgICAgIGdlbjBDb25maWdbMTddID0gR2VuMENvbmZpZygxNywgMSBldGhlciwgMC4wMSBldGhlciwgMzA1KTsgCiAgICAgICAgZ2VuMENvbmZpZ1sxOF0gPSBHZW4wQ29uZmlnKDE4LCAwLjEgZXRoZXIsIDAuMDAxIGV0aGVyLCA0MjcpOwogICAgICAgIGdlbjBDb25maWdbMTldID0gR2VuMENvbmZpZygxOSwgMSBldGhlciwgMC4wMSBldGhlciwgMzA0KTsKICAgICAgICBnZW4wQ29uZmlnWzIwXSA9IEdlbjBDb25maWcoMjAsIDAuNCBldGhlciwgMC4wNSBldGhlciwgODIpOwogICAgICAgIGdlbjBDb25maWdbMjFdID0gR2VuMENvbmZpZygyMSwgMSwgMSwgMTIzKTsKICAgICAgICBnZW4wQ29uZmlnWzIyXSA9IEdlbjBDb25maWcoMjIsIDAuMiBldGhlciwgMC4wMDEgZXRoZXIsIDQ2OCk7CiAgICAgICAgZ2VuMENvbmZpZ1syM10gPSBHZW4wQ29uZmlnKDIzLCAwLjUgZXRoZXIsIDAuMDAyNSBldGhlciwgMzAyKTsKICAgICAgICBnZW4wQ29uZmlnWzI0XSA9IEdlbjBDb25maWcoMjQsIDEgZXRoZXIsIDAuMDA1IGV0aGVyLCAxOTUpOwogICAgfSAgICAKCiAgICBmdW5jdGlvbiB1cGRhdGVIYXRjaGluZ1JhbmdlKHVpbnQxNiBfc3RhcnQsIHVpbnQxNiBfbWF4KSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgaGF0Y2hTdGFydFRpbWUgPSBfc3RhcnQ7CiAgICAgICAgaGF0Y2hNYXhUaW1lID0gX21heDsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKGFkZHJlc3MgX3NlbmRUbywgdWludCBfYW1vdW50KSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgLy8gbm8gdXNlciBtb25leSBpcyBrZXB0IGluIHRoaXMgY29udHJhY3QsIG9ubHkgdHJhc2FjdGlvbiBmZWUKICAgICAgICBpZiAoX2Ftb3VudCA+IHRoaXMuYmFsYW5jZSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgX3NlbmRUby50cmFuc2ZlcihfYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDb25maWdDbGFzcyh1aW50MzIgX2NsYXNzSWQsIHVpbnQ4IF9sYXlpbmdMZXZlbCwgdWludDggX2xheWluZ0Nvc3QsIHVpbnQ4IF90cmFuc2Zvcm1MZXZlbCwgdWludDMyIF90cmFuZm9ybUNsYXNzKSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgbGF5aW5nRWdnTGV2ZWxzW19jbGFzc0lkXSA9IF9sYXlpbmdMZXZlbDsKICAgICAgICBsYXlpbmdFZ2dEZWR1Y3Rpb25zW19jbGFzc0lkXSA9IF9sYXlpbmdDb3N0OwogICAgICAgIHRyYW5zZm9ybUxldmVsc1tfY2xhc3NJZF0gPSBfdHJhbnNmb3JtTGV2ZWw7CiAgICAgICAgdHJhbnNmb3JtQ2xhc3Nlc1tfY2xhc3NJZF0gPSBfdHJhbmZvcm1DbGFzczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0Q29uZmlnKHVpbnQgX3JlbW92ZUhhdGNoaW5nVGltZUZlZSwgdWludCBfYnV5RWdnRmVlKSBvbmx5TW9kZXJhdG9ycyBleHRlcm5hbCB7CiAgICAgICAgcmVtb3ZlSGF0Y2hpbmdUaW1lRmVlID0gX3JlbW92ZUhhdGNoaW5nVGltZUZlZTsKICAgICAgICBidXlFZ2dGZWUgPSBfYnV5RWdnRmVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdlbkxldmVsRXhwKCkgb25seU1vZGVyYXRvcnMgZXh0ZXJuYWwgewogICAgICAgIHVpbnQ4IGxldmVsID0gMTsKICAgICAgICB1aW50MzIgcmVxdWlyZW1lbnQgPSAxMDA7CiAgICAgICAgdWludDMyIHN1bSA9IHJlcXVpcmVtZW50OwogICAgICAgIHdoaWxlKGxldmVsIDw9IDEwMCkgewogICAgICAgICAgICBsZXZlbEV4cHNbbGV2ZWxdID0gc3VtOwogICAgICAgICAgICBsZXZlbCArPSAxOwogICAgICAgICAgICByZXF1aXJlbWVudCA9IChyZXF1aXJlbWVudCAqIDExKSAvIDEwICsgNTsKICAgICAgICAgICAgc3VtICs9IHJlcXVpcmVtZW50OwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkUmFuZG9tQ2xhc3ModWludDMyIF9uZXdDbGFzc0lkKSBvbmx5TW9kZXJhdG9ycyBwdWJsaWMgewogICAgICAgIGlmIChfbmV3Q2xhc3NJZCA+IDApIHsKICAgICAgICAgICAgZm9yICh1aW50IGluZGV4ID0gMDsgaW5kZXggPCByYW5kb21DbGFzc0lkcy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgIGlmIChyYW5kb21DbGFzc0lkc1tpbmRleF0gPT0gX25ld0NsYXNzSWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmFuZG9tQ2xhc3NJZHMucHVzaChfbmV3Q2xhc3NJZCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmVSYW5kb21DbGFzcyh1aW50MzIgX29sZENsYXNzSWQpIG9ubHlNb2RlcmF0b3JzIHB1YmxpYyB7CiAgICAgICAgdWludCBmb3VuZEluZGV4ID0gMDsKICAgICAgICBmb3IgKDsgZm91bmRJbmRleCA8IHJhbmRvbUNsYXNzSWRzLmxlbmd0aDsgZm91bmRJbmRleCsrKSB7CiAgICAgICAgICAgIGlmIChyYW5kb21DbGFzc0lkc1tmb3VuZEluZGV4XSA9PSBfb2xkQ2xhc3NJZCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGZvdW5kSW5kZXggPCByYW5kb21DbGFzc0lkcy5sZW5ndGgpIHsKICAgICAgICAgICAgcmFuZG9tQ2xhc3NJZHNbZm91bmRJbmRleF0gPSByYW5kb21DbGFzc0lkc1tyYW5kb21DbGFzc0lkcy5sZW5ndGgtMV07CiAgICAgICAgICAgIGRlbGV0ZSByYW5kb21DbGFzc0lkc1tyYW5kb21DbGFzc0lkcy5sZW5ndGgtMV07CiAgICAgICAgICAgIHJhbmRvbUNsYXNzSWRzLmxlbmd0aC0tOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVtb3ZlSGF0Y2hpbmdUaW1lV2l0aFRva2VuKGFkZHJlc3MgX3RyYWluZXIpIGlzQWN0aXZlIG9ubHlNb2RlcmF0b3JzIHJlcXVpcmVEYXRhQ29udHJhY3QgcmVxdWlyZVRyYW5zZm9ybURhdGFDb250cmFjdCBleHRlcm5hbCB7CiAgICAgICAgRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSB0cmFuc2Zvcm1EYXRhID0gRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSh0cmFuc2Zvcm1EYXRhQ29udHJhY3QpOwogICAgICAgIE1vbnN0ZXJFZ2cgbWVtb3J5IGVnZzsKICAgICAgICAoZWdnLmVnZ0lkLCBlZ2cub2JqSWQsIGVnZy5jbGFzc0lkLCBlZ2cudHJhaW5lciwgZWdnLmhhdGNoVGltZSwgZWdnLm5ld09iaklkKSA9IHRyYW5zZm9ybURhdGEuZ2V0SGF0Y2hpbmdFZ2dEYXRhKF90cmFpbmVyKTsKICAgICAgICAvLyBub3QgaGF0Y2hpbmcgYW55IGVnZwogICAgICAgIGlmIChlZ2cuZWdnSWQgPT0gMCB8fCBlZ2cudHJhaW5lciAhPSBfdHJhaW5lciB8fCBlZ2cubmV3T2JqSWQgPiAwKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAKICAgICAgICB0cmFuc2Zvcm1EYXRhLnNldEhhdGNoVGltZShlZ2cuZWdnSWQsIDApOwogICAgfSAgICAKICAgIAogICAgZnVuY3Rpb24gYnV5RWdnV2l0aFRva2VuKGFkZHJlc3MgX3RyYWluZXIpIGlzQWN0aXZlIG9ubHlNb2RlcmF0b3JzIHJlcXVpcmVEYXRhQ29udHJhY3QgcmVxdWlyZVRyYW5zZm9ybURhdGFDb250cmFjdCBleHRlcm5hbCB7CiAgICAgICAgaWYgKHJhbmRvbUNsYXNzSWRzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgLy8gbWFrZSBzdXJlIG5vIGhhdGNoaW5nIGVnZyBhdCB0aGUgc2FtZSB0aW1lCiAgICAgICAgaWYgKHRyYW5zZm9ybURhdGEuZ2V0SGF0Y2hpbmdFZ2dJZChfdHJhaW5lcikgPiAwKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHJhbmRvbSBlZ2cKICAgICAgICB1aW50OCBjbGFzc0luZGV4ID0gZ2V0UmFuZG9tKHVpbnQxNihyYW5kb21DbGFzc0lkcy5sZW5ndGgpLCAxLCBsYXN0SGF0Y2hpbmdBZGRyZXNzKTsKICAgICAgICB1aW50NjQgZWdnSWQgPSB0cmFuc2Zvcm1EYXRhLmFkZEVnZygwLCByYW5kb21DbGFzc0lkc1tjbGFzc0luZGV4XSwgX3RyYWluZXIsIGJsb2NrLnRpbWVzdGFtcCArIChoYXRjaFN0YXJ0VGltZSArIGdldFJhbmRvbShoYXRjaE1heFRpbWUsIDAsIGxhc3RIYXRjaGluZ0FkZHJlc3MpKSAqIDM2MDApOwogICAgICAgIC8vIGRlZHVjdCBleHAKICAgICAgICBFdmVudExheUVnZyhtc2cuc2VuZGVyLCAwLCBlZ2dJZCk7CiAgICB9CiAgICAKICAgIC8vIHB1YmxpYwoKICAgIGZ1bmN0aW9uIGNlaWwodWludCBhLCB1aW50IG0pIHB1cmUgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gKChhICsgbSAtIDEpIC8gbSkgKiBtOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExldmVsKHVpbnQzMiBleHApIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgdWludDggbWluSW5kZXggPSAxOwogICAgICAgIHVpbnQ4IG1heEluZGV4ID0gMTAwOwogICAgICAgIHVpbnQ4IGN1cnJlbnRJbmRleDsKICAgICAKICAgICAgICB3aGlsZSAobWluSW5kZXggPCBtYXhJbmRleCkgewogICAgICAgICAgICBjdXJyZW50SW5kZXggPSAobWluSW5kZXggKyBtYXhJbmRleCkgLyAyOwogICAgICAgICAgICBpZiAoZXhwIDwgbGV2ZWxFeHBzW2N1cnJlbnRJbmRleF0pCiAgICAgICAgICAgICAgICBtYXhJbmRleCA9IGN1cnJlbnRJbmRleDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbWluSW5kZXggPSBjdXJyZW50SW5kZXggKyAxOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1pbkluZGV4OwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEdlbjBPYmpJbmZvKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQzMiwgdWludDMyLCB1aW50MjU2KSB7CiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgCiAgICAgICAgTW9uc3Rlck9iakFjYyBtZW1vcnkgb2JqOwogICAgICAgIChvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIG9iai5leHAsIG9iai5jcmVhdGVJbmRleCwgb2JqLmxhc3RDbGFpbUluZGV4LCBvYmouY3JlYXRlVGltZSkgPSBkYXRhLmdldE1vbnN0ZXJPYmooX29iaklkKTsKICAgICAgICAKICAgICAgICBHZW4wQ29uZmlnIG1lbW9yeSBnZW4wID0gZ2VuMENvbmZpZ1tvYmouY2xhc3NJZF07CiAgICAgICAgaWYgKGdlbjAuY2xhc3NJZCAhPSBvYmouY2xhc3NJZCkgewogICAgICAgICAgICByZXR1cm4gKGdlbjAuY2xhc3NJZCwgb2JqLmNyZWF0ZUluZGV4LCAwKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDMyIHRvdGFsR2FwID0gMDsKICAgICAgICBpZiAob2JqLmNyZWF0ZUluZGV4IDwgZ2VuMC50b3RhbCkKICAgICAgICAgICAgdG90YWxHYXAgPSBnZW4wLnRvdGFsIC0gb2JqLmNyZWF0ZUluZGV4OwogICAgICAgIAogICAgICAgIHJldHVybiAob2JqLmNsYXNzSWQsIG9iai5jcmVhdGVJbmRleCwgc2FmZU11bHQodG90YWxHYXAsIGdlbjAucmV0dXJuUHJpY2UpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0T2JqQ2xhc3NJZCh1aW50NjQgX29iaklkKSByZXF1aXJlRGF0YUNvbnRyYWN0IGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQzMiwgYWRkcmVzcywgdWludDgpIHsKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICBNb25zdGVyT2JqQWNjIG1lbW9yeSBvYmo7CiAgICAgICAgdWludDMyIF8gPSAwOwogICAgICAgIChvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIG9iai5leHAsIF8sIF8sIG9iai5jcmVhdGVUaW1lKSA9IGRhdGEuZ2V0TW9uc3Rlck9iaihfb2JqSWQpOwogICAgICAgIHJldHVybiAob2JqLmNsYXNzSWQsIG9iai50cmFpbmVyLCBnZXRMZXZlbChvYmouZXhwKSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldENsYXNzQ2hlY2tPd25lcih1aW50NjQgX29iaklkLCBhZGRyZXNzIF90cmFpbmVyKSByZXF1aXJlRGF0YUNvbnRyYWN0IGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQzMikgewogICAgICAgIEV0aGVyZW1vbkRhdGFCYXNlIGRhdGEgPSBFdGhlcmVtb25EYXRhQmFzZShkYXRhQ29udHJhY3QpOwogICAgICAgIE1vbnN0ZXJPYmpBY2MgbWVtb3J5IG9iajsKICAgICAgICB1aW50MzIgXyA9IDA7CiAgICAgICAgKG9iai5tb25zdGVySWQsIG9iai5jbGFzc0lkLCBvYmoudHJhaW5lciwgb2JqLmV4cCwgXywgXywgb2JqLmNyZWF0ZVRpbWUpID0gZGF0YS5nZXRNb25zdGVyT2JqKF9vYmpJZCk7CiAgICAgICAgaWYgKF90cmFpbmVyICE9IG9iai50cmFpbmVyKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICByZXR1cm4gb2JqLmNsYXNzSWQ7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY3VsYXRlTWF4RWdnRzAodWludDY0IF9vYmpJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCkgewogICAgICAgIHVpbnQzMiBjbGFzc0lkOwogICAgICAgIHVpbnQzMiBjcmVhdGVJbmRleDsgCiAgICAgICAgdWludDI1NiB0b3RhbEVhcm47CiAgICAgICAgKGNsYXNzSWQsIGNyZWF0ZUluZGV4LCB0b3RhbEVhcm4pID0gZ2V0R2VuME9iakluZm8oX29iaklkKTsKICAgICAgICBpZiAoY2xhc3NJZCA+IEdFTjBfTk8gfHwgY2xhc3NJZCA9PSAyMCB8fCBjbGFzc0lkID09IDIxKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAKICAgICAgICBHZW4wQ29uZmlnIG1lbW9yeSBjb25maWcgPSBnZW4wQ29uZmlnW2NsYXNzSWRdOwogICAgICAgIC8vIHRoZSBvbmUgZnJvbSBlZ2cgY2FuIG5vdCBsYXkKICAgICAgICBpZiAoY3JlYXRlSW5kZXggPiBjb25maWcudG90YWwpCiAgICAgICAgICAgIHJldHVybiAwOwoKICAgICAgICAvLyBjYWxjdWxhdGUgYWd2IHByaWNlCiAgICAgICAgdWludDI1NiBhdmdQcmljZSA9IGNvbmZpZy5vcmlnaW5hbFByaWNlOwogICAgICAgIHVpbnQgcmF0ZSA9IGNvbmZpZy5vcmlnaW5hbFByaWNlL2NvbmZpZy5yZXR1cm5QcmljZTsKICAgICAgICBpZiAoY29uZmlnLnRvdGFsID4gcmF0ZSkgewogICAgICAgICAgICB1aW50IGsgPSBjb25maWcudG90YWwgLSByYXRlOwogICAgICAgICAgICBhdmdQcmljZSA9IChjb25maWcudG90YWwgKiBjb25maWcub3JpZ2luYWxQcmljZSArIGNvbmZpZy5yZXR1cm5QcmljZSAqIGsgKiAoaysxKSAvIDIpIC8gY29uZmlnLnRvdGFsOwogICAgICAgIH0KICAgICAgICB1aW50MjU2IGNhdGNoUHJpY2UgPSBjb25maWcub3JpZ2luYWxQcmljZTsgICAgICAgICAgICAKICAgICAgICBpZiAoY3JlYXRlSW5kZXggPiByYXRlKSB7CiAgICAgICAgICAgIGNhdGNoUHJpY2UgKz0gY29uZmlnLnJldHVyblByaWNlICogc2FmZVN1YnRyYWN0KGNyZWF0ZUluZGV4LCByYXRlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRvdGFsRWFybiA+PSBjYXRjaFByaWNlKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2VpbCgoY2F0Y2hQcmljZSAtIHRvdGFsRWFybikqMTUqMTAwMC9hdmdQcmljZSwgMTAwMDApLzEwMDAwOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjYW5MYXlFZ2codWludDY0IF9vYmpJZCwgdWludDMyIF9jbGFzc0lkLCB1aW50MzIgX2xldmVsKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYgKF9jbGFzc0lkIDw9IEdFTjBfTk8pIHsKICAgICAgICAgICAgRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSB0cmFuc2Zvcm1EYXRhID0gRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSh0cmFuc2Zvcm1EYXRhQ29udHJhY3QpOwogICAgICAgICAgICAvLyBsZWdlbmRzCiAgICAgICAgICAgIGlmICh0cmFuc2Zvcm1EYXRhLmNvdW50RWdnKF9vYmpJZCkgPj0gY2FsY3VsYXRlTWF4RWdnRzAoX29iaklkKSkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGxheWluZ0VnZ0xldmVsc1tfY2xhc3NJZF0gPT0gMCB8fCBfbGV2ZWwgPCBsYXlpbmdFZ2dMZXZlbHNbX2NsYXNzSWRdKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGxheUVnZyh1aW50NjQgX29iaklkKSBpc0FjdGl2ZSByZXF1aXJlRGF0YUNvbnRyYWN0IHJlcXVpcmVUcmFuc2Zvcm1EYXRhQ29udHJhY3QgZXh0ZXJuYWwgewogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICAvLyBtYWtlIHN1cmUgbm8gaGF0Y2hpbmcgZWdnIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICBpZiAodHJhbnNmb3JtRGF0YS5nZXRIYXRjaGluZ0VnZ0lkKG1zZy5zZW5kZXIpID4gMCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gY2FuIG5vdCBsYXkgZWdnIHdoZW4gdHJhZGluZwogICAgICAgIEV0aGVyZW1vblRyYWRlSW50ZXJmYWNlIHRyYWRlID0gRXRoZXJlbW9uVHJhZGVJbnRlcmZhY2UodHJhZGVDb250cmFjdCk7CiAgICAgICAgaWYgKHRyYWRlLmlzT25UcmFkaW5nKF9vYmpJZCkpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIAogICAgICAgIC8vIGNoZWNrIG9iaiAKICAgICAgICBFdGhlcmVtb25EYXRhQmFzZSBkYXRhID0gRXRoZXJlbW9uRGF0YUJhc2UoZGF0YUNvbnRyYWN0KTsKICAgICAgICBNb25zdGVyT2JqQWNjIG1lbW9yeSBvYmo7CiAgICAgICAgdWludDMyIF8gPSAwOwogICAgICAgIChvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgb2JqLnRyYWluZXIsIG9iai5leHAsIF8sIF8sIG9iai5jcmVhdGVUaW1lKSA9IGRhdGEuZ2V0TW9uc3Rlck9iaihfb2JqSWQpOwogICAgICAgIGlmIChvYmoubW9uc3RlcklkICE9IF9vYmpJZCB8fCBvYmoudHJhaW5lciAhPSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBjaGVjayBsYXkgZWdnIGNvbmRpdGlvbgogICAgICAgIHVpbnQ4IGN1cnJlbnRMZXZlbCA9IGdldExldmVsKG9iai5leHApOwogICAgICAgIHVpbnQ4IGFmdGVyTGV2ZWwgPSAwOwogICAgICAgIGlmICghY2FuTGF5RWdnKF9vYmpJZCwgb2JqLmNsYXNzSWQsIGN1cnJlbnRMZXZlbCkpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIGlmIChsYXlpbmdFZ2dEZWR1Y3Rpb25zW29iai5jbGFzc0lkXSA+PSBjdXJyZW50TGV2ZWwpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIGFmdGVyTGV2ZWwgPSBjdXJyZW50TGV2ZWwgLSBsYXlpbmdFZ2dEZWR1Y3Rpb25zW29iai5jbGFzc0lkXTsKCiAgICAgICAgLy8gYWRkIGVnZyAKICAgICAgICB1aW50NjQgZWdnSWQgPSB0cmFuc2Zvcm1EYXRhLmFkZEVnZyhvYmoubW9uc3RlcklkLCBvYmouY2xhc3NJZCwgbXNnLnNlbmRlciwgYmxvY2sudGltZXN0YW1wICsgKGhhdGNoU3RhcnRUaW1lICsgZ2V0UmFuZG9tKGhhdGNoTWF4VGltZSwgMCwgbGFzdEhhdGNoaW5nQWRkcmVzcykpICogMzYwMCk7CiAgICAgICAgCiAgICAgICAgLy8gZGVkdWN0IGV4cCAKICAgICAgICBpZiAoYWZ0ZXJMZXZlbCA8IGN1cnJlbnRMZXZlbCkKICAgICAgICAgICAgZGF0YS5kZWNyZWFzZU1vbnN0ZXJFeHAoX29iaklkLCBvYmouZXhwIC0gbGV2ZWxFeHBzW2FmdGVyTGV2ZWwtMV0pOwogICAgICAgIEV2ZW50TGF5RWdnKG1zZy5zZW5kZXIsIF9vYmpJZCwgZWdnSWQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBoYXRjaEVnZygpIGlzQWN0aXZlIHJlcXVpcmVEYXRhQ29udHJhY3QgcmVxdWlyZVRyYW5zZm9ybURhdGFDb250cmFjdCBleHRlcm5hbCB7CiAgICAgICAgLy8gdXNlIGFzIGEgc2VlZCBmb3IgcmFuZG9tCiAgICAgICAgbGFzdEhhdGNoaW5nQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgCiAgICAgICAgRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSB0cmFuc2Zvcm1EYXRhID0gRXRoZXJlbW9uVHJhbnNmb3JtRGF0YSh0cmFuc2Zvcm1EYXRhQ29udHJhY3QpOwogICAgICAgIE1vbnN0ZXJFZ2cgbWVtb3J5IGVnZzsKICAgICAgICAoZWdnLmVnZ0lkLCBlZ2cub2JqSWQsIGVnZy5jbGFzc0lkLCBlZ2cudHJhaW5lciwgZWdnLmhhdGNoVGltZSwgZWdnLm5ld09iaklkKSA9IHRyYW5zZm9ybURhdGEuZ2V0SGF0Y2hpbmdFZ2dEYXRhKG1zZy5zZW5kZXIpOwogICAgICAgIC8vIG5vdCBoYXRjaGluZyBhbnkgZWdnCiAgICAgICAgaWYgKGVnZy5lZ2dJZCA9PSAwIHx8IGVnZy50cmFpbmVyICE9IG1zZy5zZW5kZXIpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIC8vIG5lZWQgbW9yZSB0aW1lCiAgICAgICAgaWYgKGVnZy5uZXdPYmpJZCA+IDAgfHwgZWdnLmhhdGNoVGltZSA+IGJsb2NrLnRpbWVzdGFtcCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDY0IG9iaklkID0gYWRkTmV3T2JqKG1zZy5zZW5kZXIsIGVnZy5jbGFzc0lkKTsKICAgICAgICB0cmFuc2Zvcm1EYXRhLnNldEhhdGNoZWRFZ2coZWdnLmVnZ0lkLCBvYmpJZCk7CiAgICAgICAgCiAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgbXNnLnNlbmRlciwgb2JqSWQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmVIYXRjaGluZ1RpbWUoKSBpc0FjdGl2ZSByZXF1aXJlRGF0YUNvbnRyYWN0IHJlcXVpcmVUcmFuc2Zvcm1EYXRhQ29udHJhY3QgZXh0ZXJuYWwgcGF5YWJsZSAgewogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICBNb25zdGVyRWdnIG1lbW9yeSBlZ2c7CiAgICAgICAgKGVnZy5lZ2dJZCwgZWdnLm9iaklkLCBlZ2cuY2xhc3NJZCwgZWdnLnRyYWluZXIsIGVnZy5oYXRjaFRpbWUsIGVnZy5uZXdPYmpJZCkgPSB0cmFuc2Zvcm1EYXRhLmdldEhhdGNoaW5nRWdnRGF0YShtc2cuc2VuZGVyKTsKICAgICAgICAvLyBub3QgaGF0Y2hpbmcgYW55IGVnZwogICAgICAgIGlmIChlZ2cuZWdnSWQgPT0gMCB8fCBlZ2cudHJhaW5lciAhPSBtc2cuc2VuZGVyIHx8IGVnZy5uZXdPYmpJZCA+IDApCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIAogICAgICAgIGlmIChtc2cudmFsdWUgIT0gcmVtb3ZlSGF0Y2hpbmdUaW1lRmVlKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICB0cmFuc2Zvcm1EYXRhLnNldEhhdGNoVGltZShlZ2cuZWdnSWQsIDApOwogICAgfQoKICAgIAogICAgZnVuY3Rpb24gY2hlY2tBbmNlc3RvcnModWludDMyIF9jbGFzc0lkLCBhZGRyZXNzIF90cmFpbmVyLCB1aW50NjQgX2ExLCB1aW50NjQgX2EyLCB1aW50NjQgX2EzKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgRXRoZXJlbW9uV29ybGQgd29ybGQgPSBFdGhlcmVtb25Xb3JsZCh3b3JsZENvbnRyYWN0KTsKICAgICAgICB1aW50IGluZGV4ID0gMDsKICAgICAgICB1aW50MzIgdGVtcCA9IDA7CiAgICAgICAgLy8gY2hlY2sgYW5jZXN0b3IKICAgICAgICB1aW50MzJbM10gbWVtb3J5IGFuY2VzdG9yczsKICAgICAgICB1aW50MzJbM10gbWVtb3J5IHJlcXVlc3RBbmNlc3RvcnM7CiAgICAgICAgaW5kZXggPSB3b3JsZC5nZXRDbGFzc1Byb3BlcnR5U2l6ZShfY2xhc3NJZCwgUHJvcGVydHlUeXBlLkFOQ0VTVE9SKTsKICAgICAgICB3aGlsZSAoaW5kZXggPiAwKSB7CiAgICAgICAgICAgIGluZGV4IC09IDE7CiAgICAgICAgICAgIGFuY2VzdG9yc1tpbmRleF0gPSB3b3JsZC5nZXRDbGFzc1Byb3BlcnR5VmFsdWUoX2NsYXNzSWQsIFByb3BlcnR5VHlwZS5BTkNFU1RPUiwgaW5kZXgpOwogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgaWYgKF9hMSA+IDApIHsKICAgICAgICAgICAgdGVtcCA9IGdldENsYXNzQ2hlY2tPd25lcihfYTEsIF90cmFpbmVyKTsKICAgICAgICAgICAgaWYgKHRlbXAgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmVxdWVzdEFuY2VzdG9yc1swXSA9IHRlbXA7CiAgICAgICAgfQogICAgICAgIGlmIChfYTIgPiAwKSB7CiAgICAgICAgICAgIHRlbXAgPSBnZXRDbGFzc0NoZWNrT3duZXIoX2EyLCBfdHJhaW5lcik7CiAgICAgICAgICAgIGlmICh0ZW1wID09IDApCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJlcXVlc3RBbmNlc3RvcnNbMV0gPSB0ZW1wOwogICAgICAgIH0KICAgICAgICBpZiAoX2EzID4gMCkgewogICAgICAgICAgICB0ZW1wID0gZ2V0Q2xhc3NDaGVja093bmVyKF9hMywgX3RyYWluZXIpOwogICAgICAgICAgICBpZiAodGVtcCA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXF1ZXN0QW5jZXN0b3JzWzJdID0gdGVtcDsKICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0QW5jZXN0b3JzWzBdID4gMCAmJiAocmVxdWVzdEFuY2VzdG9yc1swXSA9PSByZXF1ZXN0QW5jZXN0b3JzWzFdIHx8IHJlcXVlc3RBbmNlc3RvcnNbMF0gPT0gcmVxdWVzdEFuY2VzdG9yc1syXSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAocmVxdWVzdEFuY2VzdG9yc1sxXSA+IDAgJiYgKHJlcXVlc3RBbmNlc3RvcnNbMV0gPT0gcmVxdWVzdEFuY2VzdG9yc1syXSkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIAogICAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IGFuY2VzdG9ycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgdGVtcCA9IGFuY2VzdG9yc1tpbmRleF07CiAgICAgICAgICAgIGlmICh0ZW1wID4gMCAmJiB0ZW1wICE9IHJlcXVlc3RBbmNlc3RvcnNbMF0gICYmIHRlbXAgIT0gcmVxdWVzdEFuY2VzdG9yc1sxXSAmJiB0ZW1wICE9IHJlcXVlc3RBbmNlc3RvcnNbMl0pCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0cmFuc2Zvcm0odWludDY0IF9vYmpJZCwgdWludDY0IF9hMSwgdWludDY0IF9hMiwgdWludDY0IF9hMykgaXNBY3RpdmUgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHBheWFibGUgewogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICBpZiAodHJhbnNmb3JtRGF0YS5nZXRUcmFuZm9ybWVkSWQoX29iaklkKSA+IDApCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIAogICAgICAgIEV0aGVyZW1vbkJhdHRsZSBiYXR0bGUgPSBFdGhlcmVtb25CYXR0bGUoYmF0dGxlQ29udHJhY3QpOwogICAgICAgIEV0aGVyZW1vblRyYWRlSW50ZXJmYWNlIHRyYWRlID0gRXRoZXJlbW9uVHJhZGVJbnRlcmZhY2UodHJhZGVDb250cmFjdCk7CiAgICAgICAgaWYgKGJhdHRsZS5pc09uQmF0dGxlKF9vYmpJZCkgfHwgdHJhZGUuaXNPblRyYWRpbmcoX29iaklkKSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgCiAgICAgICAgRXRoZXJlbW9uRGF0YUJhc2UgZGF0YSA9IEV0aGVyZW1vbkRhdGFCYXNlKGRhdGFDb250cmFjdCk7CiAgICAgICAgCiAgICAgICAgQmFzaWNPYmpJbmZvIG1lbW9yeSBvYmpJbmZvOwogICAgICAgIChvYmpJbmZvLmNsYXNzSWQsIG9iakluZm8ub3duZXIsIG9iakluZm8ubGV2ZWwpID0gZ2V0T2JqQ2xhc3NJZChfb2JqSWQpOwogICAgICAgIHVpbnQzMiB0cmFuc2Zvcm1DbGFzcyA9IHRyYW5zZm9ybUNsYXNzZXNbb2JqSW5mby5jbGFzc0lkXTsKICAgICAgICBpZiAob2JqSW5mby5jbGFzc0lkID09IDAgfHwgb2JqSW5mby5vd25lciAhPSBtc2cuc2VuZGVyKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBpZiAodHJhbnNmb3JtTGV2ZWxzW29iakluZm8uY2xhc3NJZF0gPT0gMCB8fCBvYmpJbmZvLmxldmVsIDwgdHJhbnNmb3JtTGV2ZWxzW29iakluZm8uY2xhc3NJZF0pCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIGlmICh0cmFuc2Zvcm1DbGFzcyA9PSAwKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBnZW4wIC0gY2FuIG5vdCB0cmFuc2Zvcm0gaWYgaXQgaGFzIGJvbnVzIGVnZyAKICAgICAgICBpZiAob2JqSW5mby5jbGFzc0lkIDw9IEdFTjBfTk8pIHsKICAgICAgICAgICAgLy8gbGVnZW5kcwogICAgICAgICAgICBpZiAoZ2V0Qm9udXNFZ2coX29iaklkKSA+IDApCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoIWNoZWNrQW5jZXN0b3JzKG9iakluZm8uY2xhc3NJZCwgbXNnLnNlbmRlciwgX2ExLCBfYTIsIF9hMykpCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDY0IG5ld09iaklkID0gYWRkTmV3T2JqKG1zZy5zZW5kZXIsIHRyYW5zZm9ybUNsYXNzKTsKICAgICAgICAvLyByZW1vdmUgb2xkIG9uZQogICAgICAgIGRhdGEucmVtb3ZlTW9uc3RlcklkTWFwcGluZyhtc2cuc2VuZGVyLCBfb2JqSWQpOwogICAgICAgIHRyYW5zZm9ybURhdGEuc2V0VHJhbmZvcm1lZChfb2JqSWQsIG5ld09iaklkKTsKICAgICAgICAKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBhZGRyZXNzKDApLCBfb2JqSWQpOwogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIG1zZy5zZW5kZXIsIG5ld09iaklkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYnV5RWdnKCkgaXNBY3RpdmUgcmVxdWlyZURhdGFDb250cmFjdCByZXF1aXJlVHJhbnNmb3JtRGF0YUNvbnRyYWN0IGV4dGVybmFsIHBheWFibGUgewogICAgICAgIGlmIChtc2cudmFsdWUgIT0gYnV5RWdnRmVlKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmFuZG9tQ2xhc3NJZHMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEV0aGVyZW1vblRyYW5zZm9ybURhdGEgdHJhbnNmb3JtRGF0YSA9IEV0aGVyZW1vblRyYW5zZm9ybURhdGEodHJhbnNmb3JtRGF0YUNvbnRyYWN0KTsKICAgICAgICAvLyBtYWtlIHN1cmUgbm8gaGF0Y2hpbmcgZWdnIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICBpZiAodHJhbnNmb3JtRGF0YS5nZXRIYXRjaGluZ0VnZ0lkKG1zZy5zZW5kZXIpID4gMCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCByYW5kb20gZWdnCiAgICAgICAgdWludDggY2xhc3NJbmRleCA9IGdldFJhbmRvbSh1aW50MTYocmFuZG9tQ2xhc3NJZHMubGVuZ3RoKSwgMSwgbGFzdEhhdGNoaW5nQWRkcmVzcyk7CiAgICAgICAgdWludDY0IGVnZ0lkID0gdHJhbnNmb3JtRGF0YS5hZGRFZ2coMCwgcmFuZG9tQ2xhc3NJZHNbY2xhc3NJbmRleF0sIG1zZy5zZW5kZXIsIGJsb2NrLnRpbWVzdGFtcCArIChoYXRjaFN0YXJ0VGltZSArIGdldFJhbmRvbShoYXRjaE1heFRpbWUsIDAsIGxhc3RIYXRjaGluZ0FkZHJlc3MpKSAqIDM2MDApOwogICAgICAgIC8vIGRlZHVjdCBleHAKICAgICAgICBFdmVudExheUVnZyhtc2cuc2VuZGVyLCAwLCBlZ2dJZCk7CiAgICB9CiAgICAKICAgIC8vIHJlYWQKICAgIGZ1bmN0aW9uIGdldEJvbnVzRWdnKHVpbnQ2NCBfb2JqSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhIHRyYW5zZm9ybURhdGEgPSBFdGhlcmVtb25UcmFuc2Zvcm1EYXRhKHRyYW5zZm9ybURhdGFDb250cmFjdCk7CiAgICAgICAgdWludCB0b3RhbEJvbnVzRWdnID0gY2FsY3VsYXRlTWF4RWdnRzAoX29iaklkKTsKICAgICAgICBpZiAodG90YWxCb251c0VnZyA+IDApIHsKICAgICAgICAgICAgcmV0dXJuICh0b3RhbEJvbnVzRWdnIC0gdHJhbnNmb3JtRGF0YS5jb3VudEVnZyhfb2JqSWQpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICAKfQ=='.
	

]
