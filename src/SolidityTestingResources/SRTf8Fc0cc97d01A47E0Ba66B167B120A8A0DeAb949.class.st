Class {
	#name : #SRTf8Fc0cc97d01A47E0Ba66B167B120A8A0DeAb949,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf8Fc0cc97d01A47E0Ba66B167B120A8A0DeAb949 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyogVGhlIGF1dGhlbnRpY2F0aW9uIG1hbmFnZXIgZGV0YWlscyB1c2VyIGFjY291bnRzIHRoYXQgaGF2ZSBhY2Nlc3MgdG8gY2VydGFpbiBwcml2aWxlZGdlcyBhbmQga2VlcHMgYSBwZXJtYW5lbnQgbGVkZ2VyIG9mIHdobyBoYXMgYW5kIGhhcyBoYWQgdGhlc2UgcmlnaHRzLiAqLwpjb250cmFjdCBBdXRoZW50aWNhdGlvbk1hbmFnZXIgewogICAgLyogTWFwIGFkZHJlc3NlcyB0byBhZG1pbnMgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgYWRtaW5BZGRyZXNzZXM7CgogICAgLyogTWFwIGFkZHJlc3NlcyB0byBhY2NvdW50IHJlYWRlcnMgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgYWNjb3VudFJlYWRlckFkZHJlc3NlczsKCiAgICAvKiBEZXRhaWxzIG9mIGFsbCBhZG1pbnMgdGhhdCBoYXZlIGV2ZXIgZXhpc3RlZCAqLwogICAgYWRkcmVzc1tdIGFkbWluQXVkaXQ7CgogICAgLyogRGV0YWlscyBvZiBhbGwgYWNjb3VudCByZWFkZXJzIHRoYXQgaGF2ZSBldmVyIGV4aXN0ZWQgKi8KICAgIGFkZHJlc3NbXSBhY2NvdW50UmVhZGVyQXVkaXQ7CgogICAgLyogRmlyZWQgd2hlbmV2ZXIgYW4gYWRtaW4gaXMgYWRkZWQgdG8gdGhlIGNvbnRyYWN0LiAqLwogICAgZXZlbnQgQWRtaW5BZGRlZChhZGRyZXNzIGFkZGVkQnksIGFkZHJlc3MgYWRtaW4pOwoKICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFkbWluIGlzIHJlbW92ZWQgZnJvbSB0aGUgY29udHJhY3QuICovCiAgICBldmVudCBBZG1pblJlbW92ZWQoYWRkcmVzcyByZW1vdmVkQnksIGFkZHJlc3MgYWRtaW4pOwoKICAgIC8qIEZpcmVkIHdoZW5ldmVyIGFuIGFjY291bnQtcmVhZGVyIGNvbnRyYWN0IGlzIGFkZGVkLiAqLwogICAgZXZlbnQgQWNjb3VudFJlYWRlckFkZGVkKGFkZHJlc3MgYWRkZWRCeSwgYWRkcmVzcyBhY2NvdW50KTsKCiAgICAvKiBGaXJlZCB3aGVuZXZlciBhbiBhY2NvdW50LXJlYWRlciBjb250cmFjdCBpcyByZW1vdmVkLiAqLwogICAgZXZlbnQgQWNjb3VudFJlYWRlclJlbW92ZWQoYWRkcmVzcyByZW1vdmVkQnksIGFkZHJlc3MgYWNjb3VudCk7CgogICAgLyogV2hlbiB0aGlzIGNvbnRyYWN0IGlzIGZpcnN0IHNldHVwIHdlIHVzZSB0aGUgY3JlYXRvciBhcyB0aGUgZmlyc3QgYWRtaW4gKi8gICAgCiAgICBmdW5jdGlvbiBBdXRoZW50aWNhdGlvbk1hbmFnZXIoKSB7CiAgICAgICAgLyogU2V0IHRoZSBmaXJzdCBhZG1pbiB0byBiZSB0aGUgcGVyc29uIGNyZWF0aW5nIHRoZSBjb250cmFjdCAqLwogICAgICAgIGFkbWluQWRkcmVzc2VzW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBBZG1pbkFkZGVkKDAsIG1zZy5zZW5kZXIpOwogICAgICAgIGFkbWluQXVkaXQubGVuZ3RoKys7CiAgICAgICAgYWRtaW5BdWRpdFthZG1pbkF1ZGl0Lmxlbmd0aCAtIDFdID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSBjb250cmFjdCB2ZXJzaW9uIGZvciB2YWxpZGF0aW9uICovCiAgICBmdW5jdGlvbiBjb250cmFjdFZlcnNpb24oKSBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICAvLyBBZG1pbiBjb250cmFjdCBpZGVudGlmaWVzIGFzIDEwMFlZWVlNTURESEhNTQogICAgICAgIHJldHVybiAxMDAyMDE3MDcxNzE1MDM7CiAgICB9CgogICAgLyogR2V0cyB3aGV0aGVyIG9yIG5vdCB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaXMgY3VycmVudGx5IGFuIGFkbWluICovCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFkbWluQWRkcmVzc2VzW19hZGRyZXNzXTsKICAgIH0KCiAgICAvKiBHZXRzIHdoZXRoZXIgb3Igbm90IHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBoYXMgZXZlciBiZWVuIGFuIGFkbWluICovCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRPclBhc3RBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgYWRtaW5BdWRpdC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKGFkbWluQXVkaXRbaV0gPT0gX2FkZHJlc3MpCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyogR2V0cyB3aGV0aGVyIG9yIG5vdCB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaXMgY3VycmVudGx5IGFuIGFjY291bnQgcmVhZGVyICovCiAgICBmdW5jdGlvbiBpc0N1cnJlbnRBY2NvdW50UmVhZGVyKGFkZHJlc3MgX2FkZHJlc3MpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc107CiAgICB9CgogICAgLyogR2V0cyB3aGV0aGVyIG9yIG5vdCB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaGFzIGV2ZXIgYmVlbiBhbiBhZG1pbiAqLwogICAgZnVuY3Rpb24gaXNDdXJyZW50T3JQYXN0QWNjb3VudFJlYWRlcihhZGRyZXNzIF9hZGRyZXNzKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgYWNjb3VudFJlYWRlckF1ZGl0Lmxlbmd0aDsgaSsrKQogICAgICAgICAgICBpZiAoYWNjb3VudFJlYWRlckF1ZGl0W2ldID09IF9hZGRyZXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qIEFkZHMgYSB1c2VyIHRvIG91ciBsaXN0IG9mIGFkbWlucyAqLwogICAgZnVuY3Rpb24gYWRkQWRtaW4oYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIC8qIEVuc3VyZSB3ZSdyZSBhbiBhZG1pbiAqLwogICAgICAgIGlmICghaXNDdXJyZW50QWRtaW4obXNnLnNlbmRlcikpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvLyBGYWlsIGlmIHRoaXMgYWNjb3VudCBpcyBhbHJlYWR5IGFkbWluCiAgICAgICAgaWYgKGFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIHRoZSB1c2VyCiAgICAgICAgYWRtaW5BZGRyZXNzZXNbX2FkZHJlc3NdID0gdHJ1ZTsKICAgICAgICBBZG1pbkFkZGVkKG1zZy5zZW5kZXIsIF9hZGRyZXNzKTsKICAgICAgICBhZG1pbkF1ZGl0Lmxlbmd0aCsrOwogICAgICAgIGFkbWluQXVkaXRbYWRtaW5BdWRpdC5sZW5ndGggLSAxXSA9IF9hZGRyZXNzOwogICAgfQoKICAgIC8qIFJlbW92ZXMgYSB1c2VyIGZyb20gb3VyIGxpc3Qgb2YgYWRtaW5zIGJ1dCBrZWVwcyB0aGVtIGluIHRoZSBoaXN0b3J5IGF1ZGl0ICovCiAgICBmdW5jdGlvbiByZW1vdmVBZG1pbihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIERvbid0IGFsbG93IHJlbW92YWwgb2Ygc2VsZiAqLwogICAgICAgIGlmIChfYWRkcmVzcyA9PSBtc2cuc2VuZGVyKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gRmFpbCBpZiB0aGlzIGFjY291bnQgaXMgYWxyZWFkeSBub24tYWRtaW4KICAgICAgICBpZiAoIWFkbWluQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFJlbW92ZSB0aGlzIGFkbWluIHVzZXIgKi8KICAgICAgICBhZG1pbkFkZHJlc3Nlc1tfYWRkcmVzc10gPSBmYWxzZTsKICAgICAgICBBZG1pblJlbW92ZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOwogICAgfQoKICAgIC8qIEFkZHMgYSB1c2VyL2NvbnRyYWN0IHRvIG91ciBsaXN0IG9mIGFjY291bnQgcmVhZGVycyAqLwogICAgZnVuY3Rpb24gYWRkQWNjb3VudFJlYWRlcihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgaW4gdGhlIGxpc3QKICAgICAgICBpZiAoYWNjb3VudFJlYWRlckFkZHJlc3Nlc1tfYWRkcmVzc10pCiAgICAgICAgICAgIHRocm93OwogICAgICAgIAogICAgICAgIC8vIEFkZCB0aGUgdXNlcgogICAgICAgIGFjY291bnRSZWFkZXJBZGRyZXNzZXNbX2FkZHJlc3NdID0gdHJ1ZTsKICAgICAgICBBY2NvdW50UmVhZGVyQWRkZWQobXNnLnNlbmRlciwgX2FkZHJlc3MpOwogICAgICAgIGFjY291bnRSZWFkZXJBdWRpdC5sZW5ndGgrKzsKICAgICAgICBhY2NvdW50UmVhZGVyQXVkaXRbYWRtaW5BdWRpdC5sZW5ndGggLSAxXSA9IF9hZGRyZXNzOwogICAgfQoKICAgIC8qIFJlbW92ZXMgYSB1c2VyL2NvbnRyYWN0cyBmcm9tIG91ciBsaXN0IG9mIGFjY291bnQgcmVhZGVycyBidXQga2VlcHMgdGhlbSBpbiB0aGUgaGlzdG9yeSBhdWRpdCAqLwogICAgZnVuY3Rpb24gcmVtb3ZlQWNjb3VudFJlYWRlcihhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgLyogRW5zdXJlIHdlJ3JlIGFuIGFkbWluICovCiAgICAgICAgaWYgKCFpc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIEZhaWwgaWYgdGhpcyBhY2NvdW50IGlzIGFscmVhZHkgbm90IGluIHRoZSBsaXN0CiAgICAgICAgaWYgKCFhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFJlbW92ZSB0aGlzIGFkbWluIHVzZXIgKi8KICAgICAgICBhY2NvdW50UmVhZGVyQWRkcmVzc2VzW19hZGRyZXNzXSA9IGZhbHNlOwogICAgICAgIEFjY291bnRSZWFkZXJSZW1vdmVkKG1zZy5zZW5kZXIsIF9hZGRyZXNzKTsKICAgIH0KfQoKLyogVGhlIFNJRlQgaXRzZWxmIGlzIGEgc2ltcGxlIGV4dGVuc2lvbiBvZiB0aGUgRVJDMjAgdGhhdCBhbGxvd3MgZm9yIGdyYW50aW5nIG90aGVyIFNJRlQgY29udHJhY3RzIHNwZWNpYWwgcmlnaHRzIHRvIGFjdCBvbiBiZWhhbGYgb2YgYWxsIHRyYW5zZmVycy4gKi8KY29udHJhY3QgU21hcnRJbnZlc3RtZW50RnVuZFRva2VuIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8qIE1hcCBhbGwgb3VyIG91ciBiYWxhbmNlcyBmb3IgaXNzdWVkIHRva2VucyAqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICAvKiBNYXAgYmV0d2VlbiB1c2VycyBhbmQgdGhlaXIgYXBwcm92YWwgYWRkcmVzc2VzIGFuZCBhbW91bnRzICovCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvKiBMaXN0IG9mIGFsbCB0b2tlbiBob2xkZXJzICovCiAgICBhZGRyZXNzW10gYWxsVG9rZW5Ib2xkZXJzOwoKICAgIC8qIFRoZSBuYW1lIG9mIHRoZSBjb250cmFjdCAqLwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwoKICAgIC8qIFRoZSBzeW1ib2wgZm9yIHRoZSBjb250cmFjdCAqLwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogICAgLyogSG93IG1hbnkgRFBzIGFyZSBpbiB1c2UgaW4gdGhpcyBjb250cmFjdCAqLwogICAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICAgIC8qIERlZmluZXMgdGhlIGN1cnJlbnQgc3VwcGx5IG9mIHRoZSB0b2tlbiBpbiBpdHMgb3duIHVuaXRzICovCiAgICB1aW50MjU2IHRvdGFsU3VwcGx5QW1vdW50ID0gMDsKCiAgICAvKiBEZWZpbmVzIHRoZSBhZGRyZXNzIG9mIHRoZSBJQ08gY29udHJhY3Qgd2hpY2ggaXMgdGhlIG9ubHkgY29udHJhY3QgcGVybWl0dGVkIHRvIG1pbnQgdG9rZW5zLiAqLwogICAgYWRkcmVzcyBwdWJsaWMgaWNvQ29udHJhY3RBZGRyZXNzOwoKICAgIC8qIERlZmluZXMgd2hldGhlciBvciBub3QgdGhlIGZ1bmQgaXMgY2xvc2VkLiAqLwogICAgYm9vbCBwdWJsaWMgaXNDbG9zZWQ7CgogICAgLyogRGVmaW5lcyB0aGUgY29udHJhY3QgaGFuZGxpbmcgdGhlIElDTyBwaGFzZS4gKi8KICAgIEljb1BoYXNlTWFuYWdlbWVudCBpY29QaGFzZU1hbmFnZW1lbnQ7CgogICAgLyogRGVmaW5lcyB0aGUgYWRtaW4gY29udHJhY3Qgd2UgaW50ZXJmYWNlIHdpdGggZm9yIGNyZWRlbnRhaWxzLiAqLwogICAgQXV0aGVudGljYXRpb25NYW5hZ2VyIGF1dGhlbnRpY2F0aW9uTWFuYWdlcjsKCiAgICAvKiBGaXJlZCB3aGVuIHRoZSBmdW5kIGlzIGV2ZW50dWFsbHkgY2xvc2VkLiAqLwogICAgZXZlbnQgRnVuZENsb3NlZCgpOwogICAgCiAgICAvKiBPdXIgdHJhbnNmZXIgZXZlbnQgdG8gZmlyZSB3aGVuZXZlciB3ZSBzaGlmdCBTTVJUIGFyb3VuZCAqLwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgICAKICAgIC8qIE91ciBhcHByb3ZhbCBldmVudCB3aGVuIG9uZSB1c2VyIGFwcHJvdmVzIGFub3RoZXIgdG8gY29udHJvbCAqLwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLyogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoaXMgZnVuZCB3aXRoIGxpbmtzIHRvIG90aGVyIGNvbnRyYWN0cyB0aGF0IGFyZSByZXF1aXJlZC4gKi8KICAgIGZ1bmN0aW9uIFNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbihhZGRyZXNzIF9pY29Db250cmFjdEFkZHJlc3MsIGFkZHJlc3MgX2F1dGhlbnRpY2F0aW9uTWFuYWdlckFkZHJlc3MpIHsKICAgICAgICAvLyBTZXR1cCBkZWZhdWx0cwogICAgICAgIG5hbWUgPSAiU21hcnQgSW52ZXN0bWVudCBGdW5kIFRva2VuIjsKICAgICAgICBzeW1ib2wgPSAiU0lGVCI7CiAgICAgICAgZGVjaW1hbHMgPSAwOwoKICAgICAgICAvKiBTZXR1cCBhY2Nlc3MgdG8gb3VyIG90aGVyIGNvbnRyYWN0cyBhbmQgdmFsaWRhdGUgdGhlaXIgdmVyc2lvbnMgKi8KICAgICAgICBpY29QaGFzZU1hbmFnZW1lbnQgPSBJY29QaGFzZU1hbmFnZW1lbnQoX2ljb0NvbnRyYWN0QWRkcmVzcyk7CiAgICAgICAgaWYgKGljb1BoYXNlTWFuYWdlbWVudC5jb250cmFjdFZlcnNpb24oKSAhPSAzMDAyMDE3MDcxNzE0NDApCiAgICAgICAgICAgIHRocm93OwogICAgICAgIGF1dGhlbnRpY2F0aW9uTWFuYWdlciA9IEF1dGhlbnRpY2F0aW9uTWFuYWdlcihfYXV0aGVudGljYXRpb25NYW5hZ2VyQWRkcmVzcyk7CiAgICAgICAgaWYgKGF1dGhlbnRpY2F0aW9uTWFuYWdlci5jb250cmFjdFZlcnNpb24oKSAhPSAxMDAyMDE3MDcxNzE1MDMpCiAgICAgICAgICAgIHRocm93OwogICAgICAgIAogICAgICAgIC8qIFN0b3JlIG91ciBzcGVjaWFsIGFkZHJlc3NlcyAqLwogICAgICAgIGljb0NvbnRyYWN0QWRkcmVzcyA9IF9pY29Db250cmFjdEFkZHJlc3M7CiAgICB9CgogICAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgbnVtd29yZHMpIHsKICAgICAgICBhc3NlcnQobXNnLmRhdGEubGVuZ3RoID09IG51bXdvcmRzICogMzIgKyA0KTsKICAgICAgICBfOwogICAgfSAKCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSBhY2NvdW50IHJlYWRlcnMgKi8KICAgIG1vZGlmaWVyIGFjY291bnRSZWFkZXJPbmx5IHsKICAgICAgICBpZiAoIWF1dGhlbnRpY2F0aW9uTWFuYWdlci5pc0N1cnJlbnRBY2NvdW50UmVhZGVyKG1zZy5zZW5kZXIpKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGZ1bmRTZW5kYWJsZVBoYXNlIHsKICAgICAgICAvLyBJZiBpdCdzIGluIElDTyBwaGFzZSwgZm9yYmlkIGl0CiAgICAgICAgaWYgKGljb1BoYXNlTWFuYWdlbWVudC5pY29QaGFzZSgpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gSWYgaXQncyBhYmFuZG9uZWQsIGZvcmJpZCBpdAogICAgICAgIGlmIChpY29QaGFzZU1hbmFnZW1lbnQuaWNvQWJhbmRvbmVkKCkpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvLyBXZSdyZSBnb29kLCBmdW5kcyBjYW4gbm93IGJlIHRyYW5zZmVycmVkCiAgICAgICAgXzsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSBjb250cmFjdCB2ZXJzaW9uIGZvciB2YWxpZGF0aW9uICovCiAgICBmdW5jdGlvbiBjb250cmFjdFZlcnNpb24oKSBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICAvKiBTSUZUIGNvbnRyYWN0IGlkZW50aWZpZXMgYXMgNTAwWVlZWU1NRERISE1NICovCiAgICAgICAgcmV0dXJuIDUwMDIwMTcwNzE3MTQ0MDsKICAgIH0KICAgIAogICAgLyogVHJhbnNmZXIgZnVuZHMgYmV0d2VlbiB0d28gYWRkcmVzc2VzIHRoYXQgYXJlIG5vdCB0aGUgY3VycmVudCBtc2cuc2VuZGVyIC0gdGhpcyByZXF1aXJlcyBhcHByb3ZhbCB0byBoYXZlIGJlZW4gc2V0IHNlcGFyYXRlbHkgYW5kIGZvbGxvd3Mgc3RhbmRhcmQgRVJDMjAgZ3VpZGVsaW5lcyAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIGZ1bmRTZW5kYWJsZVBoYXNlIG9ubHlQYXlsb2FkU2l6ZSgzKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfYW1vdW50ICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF9hbW91bnQgJiYgX2Ftb3VudCA+IDAgJiYgYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCkgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgICAgIGJvb2wgaXNOZXcgPSBiYWxhbmNlc1tfdG9dID09IDA7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX2Ftb3VudCk7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF9hbW91bnQpOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgICAgIGlmIChpc05ldykKICAgICAgICAgICAgICAgIHRva2VuT3duZXJBZGQoX3RvKTsKICAgICAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA9PSAwKQogICAgICAgICAgICAgICAgdG9rZW5Pd25lclJlbW92ZShfZnJvbSk7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBob2xkZXJzIG9mIHRoaXMgY3VycmVuY3kuICovCiAgICBmdW5jdGlvbiB0b2tlbkhvbGRlckNvdW50KCkgYWNjb3VudFJlYWRlck9ubHkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhbGxUb2tlbkhvbGRlcnMubGVuZ3RoOwogICAgfQoKICAgIC8qIEdldHMgdGhlIHRva2VuIGhvbGRlciBhdCB0aGUgc3BlY2lmaWVkIGluZGV4LiAqLwogICAgZnVuY3Rpb24gdG9rZW5Ib2xkZXIodWludDI1NiBfaW5kZXgpIGFjY291bnRSZWFkZXJPbmx5IGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gYWxsVG9rZW5Ib2xkZXJzW19pbmRleF07CiAgICB9CiAKICAgIC8qIEFkZHMgYW4gYXBwcm92YWwgZm9yIHRoZSBzcGVjaWZpZWQgYWNjb3VudCB0byBzcGVuZCBtb25leSBvZiB0aGUgbWVzc2FnZSBzZW5kZXIgdXAgdG8gdGhlIGRlZmluZWQgbGltaXQgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSBmdW5kU2VuZGFibGVQaGFzZSBvbmx5UGF5bG9hZFNpemUoMikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50OwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB0aGF0IGhhcyBiZWVuIGFwcHJvdmVkIGZvciB0aGUgc3BlY2lmaWVkIHNwZW5kZXIgb2YgdGhlIG93bmVyIGFkZHJlc3MgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSB0b3RhbCBzdXBwbHkgYXZhaWxhYmxlIG9mIHRoaXMgdG9rZW4gKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseUFtb3VudDsKICAgIH0KCiAgICAvKiBHZXRzIHRoZSBiYWxhbmNlIG9mIGEgc3BlY2lmaWVkIGFjY291bnQgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLyogVHJhbnNmZXIgdGhlIGJhbGFuY2UgZnJvbSBvd25lcidzIGFjY291bnQgdG8gYW5vdGhlciBhY2NvdW50ICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBmdW5kU2VuZGFibGVQaGFzZSBvbmx5UGF5bG9hZFNpemUoMikgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8qIENoZWNrIGlmIHNlbmRlciBoYXMgYmFsYW5jZSBhbmQgZm9yIG92ZXJmbG93cyAqLwogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA8IF9hbW91bnQgfHwgYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCkgPCBiYWxhbmNlc1tfdG9dKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIC8qIERvIGEgY2hlY2sgdG8gc2VlIGlmIHRoZXkgYXJlIG5ldywgaWYgc28gd2UnbGwgd2FudCB0byBhZGQgaXQgdG8gb3VyIGFycmF5ICovCiAgICAgICAgYm9vbCBpc1JlY2lwaWVudE5ldyA9IGJhbGFuY2VzW190b10gPCAxOwoKICAgICAgICAvKiBBZGQgYW5kIHN1YnRyYWN0IG5ldyBiYWxhbmNlcyAqLwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKCiAgICAgICAgLyogQ29uc29saWRhdGUgYXJyYXlzIGlmIHRoZXkgYXJlIG5ldyBvciBpZiBzZW5kZXIgbm93IGhhcyBlbXB0eSBiYWxhbmNlICovCiAgICAgICAgaWYgKGlzUmVjaXBpZW50TmV3KQogICAgICAgICAgICB0b2tlbk93bmVyQWRkKF90byk7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgMSkKICAgICAgICAgICAgdG9rZW5Pd25lclJlbW92ZShtc2cuc2VuZGVyKTsKCiAgICAgICAgLyogRmlyZSBub3RpZmljYXRpb24gZXZlbnQgKi8KICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qIElmIHRoZSBzcGVjaWZpZWQgYWRkcmVzcyBpcyBub3QgaW4gb3VyIG93bmVyIGxpc3QsIGFkZCB0aGVtIC0gdGhpcyBjYW4gYmUgY2FsbGVkIGJ5IGRlc2NlbmRlbnRzIHRvIGVuc3VyZSB0aGUgZGF0YWJhc2UgaXMga2VwdCB1cCB0byBkYXRlLiAqLwogICAgZnVuY3Rpb24gdG9rZW5Pd25lckFkZChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCB7CiAgICAgICAgLyogRmlyc3QgY2hlY2sgaWYgdGhleSBhbHJlYWR5IGV4aXN0ICovCiAgICAgICAgdWludDI1NiB0b2tlbkhvbGRlckNvdW50ID0gYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCB0b2tlbkhvbGRlckNvdW50OyBpKyspCiAgICAgICAgICAgIGlmIChhbGxUb2tlbkhvbGRlcnNbaV0gPT0gX2FkZHIpCiAgICAgICAgICAgICAgICAvKiBBbHJlYWR5IGZvdW5kIHNvIHdlIGNhbiBhYm9ydCBub3cgKi8KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAKICAgICAgICAvKiBUaGV5IGRvbid0IHNlZW0gdG8gZXhpc3QsIHNvIGxldCdzIGFkZCB0aGVtICovCiAgICAgICAgYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aCsrOwogICAgICAgIGFsbFRva2VuSG9sZGVyc1thbGxUb2tlbkhvbGRlcnMubGVuZ3RoIC0gMV0gPSBfYWRkcjsKICAgIH0KCiAgICAvKiBJZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MgaXMgaW4gb3VyIG93bmVyIGxpc3QsIHJlbW92ZSB0aGVtIC0gdGhpcyBjYW4gYmUgY2FsbGVkIGJ5IGRlc2NlbmRlbnRzIHRvIGVuc3VyZSB0aGUgZGF0YWJhc2UgaXMga2VwdCB1cCB0byBkYXRlLiAqLwogICAgZnVuY3Rpb24gdG9rZW5Pd25lclJlbW92ZShhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCB7CiAgICAgICAgLyogRmluZCBvdXQgd2hlcmUgaW4gb3VyIGFycmF5IHRoZXkgYXJlICovCiAgICAgICAgdWludDI1NiB0b2tlbkhvbGRlckNvdW50ID0gYWxsVG9rZW5Ib2xkZXJzLmxlbmd0aDsKICAgICAgICB1aW50MjU2IGZvdW5kSW5kZXggPSAwOwogICAgICAgIGJvb2wgZm91bmQgPSBmYWxzZTsKICAgICAgICB1aW50MjU2IGk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2VuSG9sZGVyQ291bnQ7IGkrKykKICAgICAgICAgICAgaWYgKGFsbFRva2VuSG9sZGVyc1tpXSA9PSBfYWRkcikgewogICAgICAgICAgICAgICAgZm91bmRJbmRleCA9IGk7CiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIElmIHdlIGRpZG4ndCBmaW5kIHRoZW0ganVzdCByZXR1cm4gKi8KICAgICAgICBpZiAoIWZvdW5kKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgCiAgICAgICAgLyogV2Ugbm93IG5lZWQgdG8gc2h1ZmZsZSBkb3duIHRoZSBhcnJheSAqLwogICAgICAgIGZvciAoaSA9IGZvdW5kSW5kZXg7IGkgPCB0b2tlbkhvbGRlckNvdW50IC0gMTsgaSsrKQogICAgICAgICAgICBhbGxUb2tlbkhvbGRlcnNbaV0gPSBhbGxUb2tlbkhvbGRlcnNbaSArIDFdOwogICAgICAgIGFsbFRva2VuSG9sZGVycy5sZW5ndGgtLTsKICAgIH0KCiAgICAvKiBNaW50IG5ldyB0b2tlbnMgLSB0aGlzIGNhbiBvbmx5IGJlIGRvbmUgYnkgc3BlY2lhbCBjYWxsZXJzIChpLmUuIHRoZSBJQ08gbWFuYWdlbWVudCkgZHVyaW5nIHRoZSBJQ08gcGhhc2UuICovCiAgICBmdW5jdGlvbiBtaW50VG9rZW5zKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQyNTYgX2Ftb3VudCkgb25seVBheWxvYWRTaXplKDIpIHsKICAgICAgICAvKiBFbnN1cmUgd2UgYXJlIHRoZSBJQ08gY29udHJhY3QgY2FsbGluZyAqLwogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGljb0NvbnRyYWN0QWRkcmVzcyB8fCAhaWNvUGhhc2VNYW5hZ2VtZW50Lmljb1BoYXNlKCkpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvKiBNaW50IHRoZSB0b2tlbnMgZm9yIHRoZSBuZXcgYWRkcmVzcyovCiAgICAgICAgYm9vbCBpc05ldyA9IGJhbGFuY2VzW19hZGRyZXNzXSA9PSAwOwogICAgICAgIHRvdGFsU3VwcGx5QW1vdW50ID0gdG90YWxTdXBwbHlBbW91bnQuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW19hZGRyZXNzXSA9IGJhbGFuY2VzW19hZGRyZXNzXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgaWYgKGlzTmV3KQogICAgICAgICAgICB0b2tlbk93bmVyQWRkKF9hZGRyZXNzKTsKICAgICAgICBUcmFuc2ZlcigwLCBfYWRkcmVzcywgX2Ftb3VudCk7CiAgICB9Cn0KCgovKiBUaGUgU0lGVCBpdHNlbGYgaXMgYSBzaW1wbGUgZXh0ZW5zaW9uIG9mIHRoZSBFUkMyMCB0aGF0IGFsbG93cyBmb3IgZ3JhbnRpbmcgb3RoZXIgU0lGVCBjb250cmFjdHMgc3BlY2lhbCByaWdodHMgdG8gYWN0IG9uIGJlaGFsZiBvZiBhbGwgdHJhbnNmZXJzLiAqLwoKY29udHJhY3QgSWNvUGhhc2VNYW5hZ2VtZW50IHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgCiAgICAvKiBEZWZpbmVzIHdoZXRoZXIgb3Igbm90IHdlIGFyZSBpbiB0aGUgSUNPIHBoYXNlICovCiAgICBib29sIHB1YmxpYyBpY29QaGFzZSA9IHRydWU7CgogICAgLyogRGVmaW5lcyB3aGV0aGVyIG9yIG5vdCB0aGUgSUNPIGhhcyBiZWVuIGFiYW5kb25lZCAqLwogICAgYm9vbCBwdWJsaWMgaWNvQWJhbmRvbmVkID0gZmFsc2U7CgogICAgLyogRGVmaW5lcyB3aGV0aGVyIG9yIG5vdCB0aGUgU0lGVCBjb250cmFjdCBhZGRyZXNzIGhhcyB5ZXQgYmVlbiBzZXQuICAqLwogICAgYm9vbCBzaWZ0Q29udHJhY3REZWZpbmVkID0gZmFsc2U7CiAgICAKICAgIC8qIERlZmluZXMgdGhlIHNhbGUgcHJpY2UgZHVyaW5nIElDTyAqLwogICAgdWludDI1NiBjb25zdGFudCBpY29Vbml0UHJpY2UgPSAxMCBmaW5uZXk7CgogICAgLyogSWYgYW4gSUNPIGlzIGFiYW5kb25lZCBhbmQgc29tZSB3aXRoZHJhd2FscyBmYWlsIHRoZW4gdGhpcyBtYXAgYWxsb3dzIHBlb3BsZSB0byByZXF1ZXN0IHdpdGhkcmF3YWwgb2YgbG9ja2VkLWluIGV0aGVyLiAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBhYmFuZG9uZWRJY29CYWxhbmNlczsKCiAgICAvKiBEZWZpbmVzIG91ciBpbnRlcmZhY2UgdG8gdGhlIFNJRlQgY29udHJhY3QuICovCiAgICBTbWFydEludmVzdG1lbnRGdW5kVG9rZW4gc21hcnRJbnZlc3RtZW50RnVuZFRva2VuOwoKICAgIC8qIERlZmluZXMgdGhlIGFkbWluIGNvbnRyYWN0IHdlIGludGVyZmFjZSB3aXRoIGZvciBjcmVkZW50YWlscy4gKi8KICAgIEF1dGhlbnRpY2F0aW9uTWFuYWdlciBhdXRoZW50aWNhdGlvbk1hbmFnZXI7CgogICAgLyogRGVmaW5lcyB0aGUgdGltZSB0aGF0IHRoZSBJQ08gc3RhcnRzLiAqLwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgaWNvU3RhcnRUaW1lID0gMTUwMTU0NTYwMDsgLy8gQXVndXN0IDFzdCAyMDE3IGF0IDAwOjAwOjAwIFVUQwoKICAgIC8qIERlZmluZXMgdGhlIHRpbWUgdGhhdCB0aGUgSUNPIGVuZHMuICovCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBpY29FbmRUaW1lID0gMTUwNTQzMzYwMDsgLy8gU2VwdGVtYmVyIDE1dGggMjAxNyBhdCAwMDowMDowMCBVVEMKCiAgICAvKiBEZWZpbmVzIG91ciBldmVudCBmaXJlZCB3aGVuIHRoZSBJQ08gaXMgY2xvc2VkICovCiAgICBldmVudCBJY29DbG9zZWQoKTsKCiAgICAvKiBEZWZpbmVzIG91ciBldmVudCBmaXJlZCBpZiB0aGUgSUNPIGlzIGFiYW5kb25lZCAqLwogICAgZXZlbnQgSWNvQWJhbmRvbmVkKHN0cmluZyBkZXRhaWxzKTsKICAgIAogICAgLyogRW5zdXJlcyB0aGF0IG9uY2UgdGhlIElDTyBpcyBvdmVyIHRoaXMgY29udHJhY3QgY2Fubm90IGJlIHVzZWQgdW50aWwgdGhlIHBvaW50IGl0IGlzIGRlc3RydWN0ZWQuICovCiAgICBtb2RpZmllciBvbmx5RHVyaW5nSWNvIHsKICAgICAgICBib29sIGNvbnRyYWN0VmFsaWQgPSBzaWZ0Q29udHJhY3REZWZpbmVkICYmICFzbWFydEludmVzdG1lbnRGdW5kVG9rZW4uaXNDbG9zZWQoKTsKICAgICAgICBpZiAoIWNvbnRyYWN0VmFsaWQgfHwgKCFpY29QaGFzZSAmJiAhaWNvQWJhbmRvbmVkKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKiBUaGlzIG1vZGlmaWVyIGFsbG93cyBhIG1ldGhvZCB0byBvbmx5IGJlIGNhbGxlZCBieSBjdXJyZW50IGFkbWlucyAqLwogICAgbW9kaWZpZXIgYWRtaW5Pbmx5IHsKICAgICAgICBpZiAoIWF1dGhlbnRpY2F0aW9uTWFuYWdlci5pc0N1cnJlbnRBZG1pbihtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKiBDcmVhdGUgdGhlIElDTyBwaGFzZSBtYW5hZ2VybWVudCBhbmQgZGVmaW5lIHRoZSBhZGRyZXNzIG9mIHRoZSBtYWluIFNJRlQgY29udHJhY3QuICovCiAgICBmdW5jdGlvbiBJY29QaGFzZU1hbmFnZW1lbnQoYWRkcmVzcyBfYXV0aGVudGljYXRpb25NYW5hZ2VyQWRkcmVzcykgewogICAgICAgIC8qIEEgYmFzaWMgc2FuaXR5IGNoZWNrICovCiAgICAgICAgaWYgKGljb1N0YXJ0VGltZSA+PSBpY29FbmRUaW1lKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLyogU2V0dXAgYWNjZXNzIHRvIG91ciBvdGhlciBjb250cmFjdHMgYW5kIHZhbGlkYXRlIHRoZWlyIHZlcnNpb25zICovCiAgICAgICAgYXV0aGVudGljYXRpb25NYW5hZ2VyID0gQXV0aGVudGljYXRpb25NYW5hZ2VyKF9hdXRoZW50aWNhdGlvbk1hbmFnZXJBZGRyZXNzKTsKICAgICAgICBpZiAoYXV0aGVudGljYXRpb25NYW5hZ2VyLmNvbnRyYWN0VmVyc2lvbigpICE9IDEwMDIwMTcwNzE3MTUwMykKICAgICAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLyogU2V0IHRoZSBTSUZUIGNvbnRyYWN0IGFkZHJlc3MgYXMgYSBvbmUtdGltZSBvcGVyYXRpb24uICBUaGlzIGhhcHBlbnMgYWZ0ZXIgYWxsIHRoZSBjb250cmFjdHMgYXJlIGNyZWF0ZWQgYW5kIG5vCiAgICAgICBvdGhlciBmdW5jdGlvbmFsaXR5IGNhbiBiZSB1c2VkIHVudGlsIHRoaXMgaXMgc2V0LiAqLwogICAgZnVuY3Rpb24gc2V0U2lmdENvbnRyYWN0QWRkcmVzcyhhZGRyZXNzIF9zaWZ0Q29udHJhY3RBZGRyZXNzKSBhZG1pbk9ubHkgewogICAgICAgIC8qIFRoaXMgY2FuIG9ubHkgaGFwcGVuIG9uY2UgaW4gdGhlIGxpZmV0aW1lIG9mIHRoaXMgY29udHJhY3QgKi8KICAgICAgICBpZiAoc2lmdENvbnRyYWN0RGVmaW5lZCkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIFNldHVwIGFjY2VzcyB0byBvdXIgb3RoZXIgY29udHJhY3RzIGFuZCB2YWxpZGF0ZSB0aGVpciB2ZXJzaW9ucyAqLwogICAgICAgIHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbiA9IFNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbihfc2lmdENvbnRyYWN0QWRkcmVzcyk7CiAgICAgICAgaWYgKHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi5jb250cmFjdFZlcnNpb24oKSAhPSA1MDAyMDE3MDcxNzE0NDApCiAgICAgICAgICAgIHRocm93OwogICAgICAgIHNpZnRDb250cmFjdERlZmluZWQgPSB0cnVlOwogICAgfQoKICAgIC8qIEdldHMgdGhlIGNvbnRyYWN0IHZlcnNpb24gZm9yIHZhbGlkYXRpb24gKi8KICAgIGZ1bmN0aW9uIGNvbnRyYWN0VmVyc2lvbigpIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIC8qIElDTyBjb250cmFjdCBpZGVudGlmaWVzIGFzIDMwMFlZWVlNTURESEhNTSAqLwogICAgICAgIHJldHVybiAzMDAyMDE3MDcxNzE0NDA7CiAgICB9CgogICAgLyogQ2xvc2UgdGhlIElDTyBwaGFzZSBhbmQgdHJhbnNpdGlvbiB0byBleGVjdXRpb24gcGhhc2UgKi8KICAgIGZ1bmN0aW9uIGNsb3NlKCkgYWRtaW5Pbmx5IG9ubHlEdXJpbmdJY28gewogICAgICAgIC8vIEZvcmJpZCBjbG9zaW5nIGNvbnRyYWN0IGJlZm9yZSB0aGUgZW5kIG9mIElDTwogICAgICAgIGlmIChub3cgPD0gaWNvRW5kVGltZSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8vIENsb3NlIHRoZSBJQ08KICAgICAgICBpY29QaGFzZSA9IGZhbHNlOwogICAgICAgIEljb0Nsb3NlZCgpOwoKICAgICAgICAvLyBXaXRoZHJhdyBmdW5kcyB0byB0aGUgY2FsbGVyCiAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQodGhpcy5iYWxhbmNlKSkKICAgICAgICAgICAgdGhyb3c7CiAgICB9CiAgICAKICAgIC8qIEhhbmRsZSByZWNlaXZpbmcgZXRoZXIgaW4gSUNPIHBoYXNlIC0gd2Ugd29yayBvdXQgaG93IG11Y2ggdGhlIHVzZXIgaGFzIGJvdWdodCwgYWxsb2NhdGUgYSBzdWl0YWJsZSBiYWxhbmNlIGFuZCBzZW5kIHRoZWlyIGNoYW5nZSAqLwogICAgZnVuY3Rpb24gKCkgb25seUR1cmluZ0ljbyBwYXlhYmxlIHsKICAgICAgICAvLyBGb3JiaWQgZnVuZGluZyBvdXRzaWRlIG9mIElDTwogICAgICAgIGlmIChub3cgPCBpY29TdGFydFRpbWUgfHwgbm93ID4gaWNvRW5kVGltZSkKICAgICAgICAgICAgdGhyb3c7CgogICAgICAgIC8qIERldGVybWluZSBob3cgbXVjaCB0aGV5J3ZlIGFjdHVhbGx5IHB1cmhjYXNlZCBhbmQgYW55IGV0aGVyIGNoYW5nZSAqLwogICAgICAgIHVpbnQyNTYgdG9rZW5zUHVyY2hhc2VkID0gbXNnLnZhbHVlIC8gaWNvVW5pdFByaWNlOwogICAgICAgIHVpbnQyNTYgcHVyY2hhc2VUb3RhbFByaWNlID0gdG9rZW5zUHVyY2hhc2VkICogaWNvVW5pdFByaWNlOwogICAgICAgIHVpbnQyNTYgY2hhbmdlID0gbXNnLnZhbHVlLnN1YihwdXJjaGFzZVRvdGFsUHJpY2UpOwoKICAgICAgICAvKiBJbmNyZWFzZSB0aGVpciBuZXcgYmFsYW5jZSBpZiB0aGV5IGFjdHVhbGx5IHB1cmNoYXNlZCBhbnkgKi8KICAgICAgICBpZiAodG9rZW5zUHVyY2hhc2VkID4gMCkKICAgICAgICAgICAgc21hcnRJbnZlc3RtZW50RnVuZFRva2VuLm1pbnRUb2tlbnMobXNnLnNlbmRlciwgdG9rZW5zUHVyY2hhc2VkKTsKCiAgICAgICAgLyogU2VuZCBjaGFuZ2UgYmFjayB0byByZWNpcGllbnQgKi8KICAgICAgICBpZiAoY2hhbmdlID4gMCAmJiAhbXNnLnNlbmRlci5zZW5kKGNoYW5nZSkpCiAgICAgICAgICAgIHRocm93OwogICAgfQoKICAgIC8qIEFiYW5kb25zIHRoZSBJQ08gYW5kIHJldHVybnMgZnVuZHMgdG8gc2hhcmVob2xkZXJzLiAgQW55IGZhaWxlZCBmdW5kcyBjYW4gYmUgc2VwYXJhdGVseSB3aXRoZHJhd24gb25jZSB0aGUgSUNPIGlzIGFiYW5kb25lZC4gKi8KICAgIGZ1bmN0aW9uIGFiYW5kb24oc3RyaW5nIGRldGFpbHMpIGFkbWluT25seSBvbmx5RHVyaW5nSWNvIHsKICAgICAgICAvLyBGb3JiaWQgY2xvc2luZyBjb250cmFjdCBiZWZvcmUgdGhlIGVuZCBvZiBJQ08KICAgICAgICBpZiAobm93IDw9IGljb0VuZFRpbWUpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvKiBJZiBhbHJlYWR5IGFiYW5kb25lZCB0aHJvdyBhbiBlcnJvciAqLwogICAgICAgIGlmIChpY29BYmFuZG9uZWQpCiAgICAgICAgICAgIHRocm93OwoKICAgICAgICAvKiBXb3JrIG91dCBhIHJlZnVuZCBwZXIgc2hhcmUgcGVyIHNoYXJlICovCiAgICAgICAgdWludDI1NiBwYXltZW50UGVyU2hhcmUgPSB0aGlzLmJhbGFuY2UgLyBzbWFydEludmVzdG1lbnRGdW5kVG9rZW4udG90YWxTdXBwbHkoKTsKCiAgICAgICAgLyogRW51bSBhbGwgYWNjb3VudHMgYW5kIHNlbmQgdGhlbSByZWZ1bmQgKi8KICAgICAgICB1aW50IG51bWJlclRva2VuSG9sZGVycyA9IHNtYXJ0SW52ZXN0bWVudEZ1bmRUb2tlbi50b2tlbkhvbGRlckNvdW50KCk7CiAgICAgICAgdWludDI1NiB0b3RhbEFiYW5kb25lZCA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgbnVtYmVyVG9rZW5Ib2xkZXJzOyBpKyspIHsKICAgICAgICAgICAgLyogQ2FsY3VsYXRlIGhvdyBtdWNoIGdvZXMgdG8gdGhpcyBzaGFyZWhvbGRlciAqLwogICAgICAgICAgICBhZGRyZXNzIGFkZHIgPSBzbWFydEludmVzdG1lbnRGdW5kVG9rZW4udG9rZW5Ib2xkZXIoaSk7CiAgICAgICAgICAgIHVpbnQyNTYgZXRoZXJUb1NlbmQgPSBwYXltZW50UGVyU2hhcmUgKiBzbWFydEludmVzdG1lbnRGdW5kVG9rZW4uYmFsYW5jZU9mKGFkZHIpOwogICAgICAgICAgICBpZiAoZXRoZXJUb1NlbmQgPCAxKQogICAgICAgICAgICAgICAgY29udGludWU7CgogICAgICAgICAgICAvKiBBbGxvY2F0ZSBhcHByb3ByaWF0ZSBhbW91bnQgb2YgZnVuZCB0byB0aGVtICovCiAgICAgICAgICAgIGFiYW5kb25lZEljb0JhbGFuY2VzW2FkZHJdID0gYWJhbmRvbmVkSWNvQmFsYW5jZXNbYWRkcl0uYWRkKGV0aGVyVG9TZW5kKTsKICAgICAgICAgICAgdG90YWxBYmFuZG9uZWQgPSB0b3RhbEFiYW5kb25lZC5hZGQoZXRoZXJUb1NlbmQpOwogICAgICAgIH0KCiAgICAgICAgLyogQXVkaXQgdGhlIGFiYW5kb25tZW50ICovCiAgICAgICAgaWNvQWJhbmRvbmVkID0gdHJ1ZTsKICAgICAgICBJY29BYmFuZG9uZWQoZGV0YWlscyk7CgogICAgICAgIC8vIFRoZXJlIHNob3VsZCBiZSBubyBtb25leSBsZWZ0LCBidXQgd2l0aGRyYXcganVzdCBpbmNhc2UgZm9yIG1hbnVhbCByZXNvbHV0aW9uCiAgICAgICAgdWludDI1NiByZW1haW5kZXIgPSB0aGlzLmJhbGFuY2Uuc3ViKHRvdGFsQWJhbmRvbmVkKTsKICAgICAgICBpZiAocmVtYWluZGVyID4gMCkKICAgICAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQocmVtYWluZGVyKSkKICAgICAgICAgICAgICAgIC8vIEFkZCB0aGlzIHRvIHRoZSBjYWxsZXJzIGJhbGFuY2UgZm9yIGVtZXJnZW5jeSByZWZ1bmRzCiAgICAgICAgICAgICAgICBhYmFuZG9uZWRJY29CYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGFiYW5kb25lZEljb0JhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChyZW1haW5kZXIpOwogICAgfQoKICAgIC8qIEFsbG93cyBwZW9wbGUgdG8gd2l0aGRyYXcgZnVuZHMgdGhhdCBmYWlsZWQgdG8gc2VuZCBkdXJpbmcgdGhlIGFiYW5kb25tZW50IG9mIHRoZSBJQ08gZm9yIGFueSByZWFzb24uICovCiAgICBmdW5jdGlvbiBhYmFuZG9uZWRGdW5kV2l0aGRyYXdhbCgpIHsKICAgICAgICAvLyBUaGlzIGZ1bmN0aW9uYWxpdHkgb25seSBleGlzdHMgaWYgYW4gSUNPIHdhcyBhYmFuZG9uZWQKICAgICAgICBpZiAoIWljb0FiYW5kb25lZCB8fCBhYmFuZG9uZWRJY29CYWxhbmNlc1ttc2cuc2VuZGVyXSA9PSAwKQogICAgICAgICAgICB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBBdHRlbXB0IHRvIHNlbmQgdGhlbSB0byBmdW5kcwogICAgICAgIHVpbnQyNTYgZnVuZHMgPSBhYmFuZG9uZWRJY29CYWxhbmNlc1ttc2cuc2VuZGVyXTsKICAgICAgICBhYmFuZG9uZWRJY29CYWxhbmNlc1ttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoZnVuZHMpKQogICAgICAgICAgICB0aHJvdzsKICAgIH0KfQ=='.
	

]
