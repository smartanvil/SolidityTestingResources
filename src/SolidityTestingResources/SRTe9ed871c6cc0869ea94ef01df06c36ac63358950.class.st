Class {
	#name : #SRTe9ed871c6cc0869ea94ef01df06c36ac63358950,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe9ed871c6cc0869ea94ef01df06c36ac63358950 >> base64 [
	^ 'Ly9GaWxlOiBub2RlX21vZHVsZXMvbGlxdWlkcGxlZGdpbmcvY29udHJhY3RzL0lMaXF1aWRQbGVkZ2luZ1BsdWdpbi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKgogICAgQ29weXJpZ2h0IDIwMTcsIEpvcmRpIEJheWxpbmEKICAgIENvbnRyaWJ1dG9yOiBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjliZmFmZmU5ZjJmYWRiZjhmNGZmZmVmOGY0ZjVlZmZlZTNlZmI1ZjJmNCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKi8KCgovLy8gQGRldiBgSUxpcXVpZFBsZWRnaW5nUGx1Z2luYCBpcyB0aGUgYmFzaWMgaW50ZXJmYWNlIGZvciBhbnkKLy8vICBsaXF1aWQgcGxlZGdpbmcgcGx1Z2luCmNvbnRyYWN0IElMaXF1aWRQbGVkZ2luZ1BsdWdpbiB7CgogICAgLy8vIEBub3RpY2UgUGx1Z2lucyBhcmUgdXNlZCAobXVjaCBsaWtlIHdlYiBob29rcykgdG8gaW5pdGlhdGUgYW4gYWN0aW9uCiAgICAvLy8gIHVwb24gYW55IGRvbmF0aW9uLCBkZWxlZ2F0aW9uLCBvciB0cmFuc2ZlcjsgdGhpcyBpcyBhbiBvcHRpb25hbCBmZWF0dXJlCiAgICAvLy8gIGFuZCBhbGxvd3MgZm9yIGV4dHJlbWUgY3VzdG9taXphdGlvbiBvZiB0aGUgY29udHJhY3QuIFRoaXMgZnVuY3Rpb24KICAgIC8vLyAgaW1wbGVtZW50cyBhbnkgYWN0aW9uIHRoYXQgc2hvdWxkIGJlIGluaXRpYXRlZCBiZWZvcmUgYSB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gcGxlZGdlTWFuYWdlciBUaGUgYWRtaW4gb3IgY3VycmVudCBtYW5hZ2VyIG9mIHRoZSBwbGVkZ2UKICAgIC8vLyBAcGFyYW0gcGxlZGdlRnJvbSBUaGlzIGlzIHRoZSBJZCBmcm9tIHdoaWNoIHZhbHVlIHdpbGwgYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gcGxlZGdlVG8gVGhpcyBpcyB0aGUgSWQgdGhhdCB2YWx1ZSB3aWxsIGJlIHRyYW5zZmVyZWQgdG8uICAgIAogICAgLy8vIEBwYXJhbSBjb250ZXh0IFRoZSBzaXR1YXRpb24gdGhhdCBpcyB0cmlnZ2VyaW5nIHRoZSBwbHVnaW46CiAgICAvLy8gIDAgLT4gUGx1Z2luIGZvciB0aGUgb3duZXIgdHJhbnNmZXJyaW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDEgLT4gUGx1Z2luIGZvciB0aGUgZmlyc3QgZGVsZWdhdGUgdHJhbnNmZXJyaW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDIgLT4gUGx1Z2luIGZvciB0aGUgc2Vjb25kIGRlbGVnYXRlIHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAuLi4KICAgIC8vLyAgMjU1IC0+IFBsdWdpbiBmb3IgdGhlIGludGVuZGVkUHJvamVjdCB0cmFuc2ZlcnJpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLwogICAgLy8vICAyNTYgLT4gUGx1Z2luIGZvciB0aGUgb3duZXIgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDI1NyAtPiBQbHVnaW4gZm9yIHRoZSBmaXJzdCBkZWxlZ2F0ZSByZWNlaXZpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgMjU4IC0+IFBsdWdpbiBmb3IgdGhlIHNlY29uZCBkZWxlZ2F0ZSByZWNlaXZpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgLi4uCiAgICAvLy8gIDUxMSAtPiBQbHVnaW4gZm9yIHRoZSBpbnRlbmRlZFByb2plY3QgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcmVkLgogICAgZnVuY3Rpb24gYmVmb3JlVHJhbnNmZXIoCiAgICAgICAgdWludDY0IHBsZWRnZU1hbmFnZXIsCiAgICAgICAgdWludDY0IHBsZWRnZUZyb20sCiAgICAgICAgdWludDY0IHBsZWRnZVRvLAogICAgICAgIHVpbnQ2NCBjb250ZXh0LAogICAgICAgIHVpbnQgYW1vdW50ICkgcmV0dXJucyAodWludCBtYXhBbGxvd2VkKTsKCiAgICAvLy8gQG5vdGljZSBQbHVnaW5zIGFyZSB1c2VkIChtdWNoIGxpa2Ugd2ViIGhvb2tzKSB0byBpbml0aWF0ZSBhbiBhY3Rpb24KICAgIC8vLyAgdXBvbiBhbnkgZG9uYXRpb24sIGRlbGVnYXRpb24sIG9yIHRyYW5zZmVyOyB0aGlzIGlzIGFuIG9wdGlvbmFsIGZlYXR1cmUKICAgIC8vLyAgYW5kIGFsbG93cyBmb3IgZXh0cmVtZSBjdXN0b21pemF0aW9uIG9mIHRoZSBjb250cmFjdC4gVGhpcyBmdW5jdGlvbgogICAgLy8vICBpbXBsZW1lbnRzIGFueSBhY3Rpb24gdGhhdCBzaG91bGQgYmUgaW5pdGlhdGVkIGFmdGVyIGEgdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIHBsZWRnZU1hbmFnZXIgVGhlIGFkbWluIG9yIGN1cnJlbnQgbWFuYWdlciBvZiB0aGUgcGxlZGdlCiAgICAvLy8gQHBhcmFtIHBsZWRnZUZyb20gVGhpcyBpcyB0aGUgSWQgZnJvbSB3aGljaCB2YWx1ZSB3aWxsIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIHBsZWRnZVRvIFRoaXMgaXMgdGhlIElkIHRoYXQgdmFsdWUgd2lsbCBiZSB0cmFuc2ZlcmVkIHRvLiAgICAKICAgIC8vLyBAcGFyYW0gY29udGV4dCBUaGUgc2l0dWF0aW9uIHRoYXQgaXMgdHJpZ2dlcmluZyB0aGUgcGx1Z2luOgogICAgLy8vICAwIC0+IFBsdWdpbiBmb3IgdGhlIG93bmVyIHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAxIC0+IFBsdWdpbiBmb3IgdGhlIGZpcnN0IGRlbGVnYXRlIHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAyIC0+IFBsdWdpbiBmb3IgdGhlIHNlY29uZCBkZWxlZ2F0ZSB0cmFuc2ZlcnJpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgLi4uCiAgICAvLy8gIDI1NSAtPiBQbHVnaW4gZm9yIHRoZSBpbnRlbmRlZFByb2plY3QgdHJhbnNmZXJyaW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8KICAgIC8vLyAgMjU2IC0+IFBsdWdpbiBmb3IgdGhlIG93bmVyIHJlY2VpdmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAyNTcgLT4gUGx1Z2luIGZvciB0aGUgZmlyc3QgZGVsZWdhdGUgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDI1OCAtPiBQbHVnaW4gZm9yIHRoZSBzZWNvbmQgZGVsZWdhdGUgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIC4uLgogICAgLy8vICA1MTEgLT4gUGx1Z2luIGZvciB0aGUgaW50ZW5kZWRQcm9qZWN0IHJlY2VpdmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdmFsdWUgdGhhdCB3aWxsIGJlIHRyYW5zZmVyZWQuCiAgICBmdW5jdGlvbiBhZnRlclRyYW5zZmVyKAogICAgICAgIHVpbnQ2NCBwbGVkZ2VNYW5hZ2VyLAogICAgICAgIHVpbnQ2NCBwbGVkZ2VGcm9tLAogICAgICAgIHVpbnQ2NCBwbGVkZ2VUbywKICAgICAgICB1aW50NjQgY29udGV4dCwKICAgICAgICB1aW50IGFtb3VudAogICAgKTsKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvZ2l2ZXRoLWNvbW1vbi1jb250cmFjdHMvY29udHJhY3RzL093bmVkLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKCgovLy8gQHRpdGxlIE93bmVkCi8vLyBAYXV0aG9yIEFkcmkmIzIyNDsgTWFzc2FuZXQgPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNjIwMzA2MTAwYjAzMjIwMTBkMDYwNzAxMGQwYzE2MDcxYTE2NGMwYjBkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8vIEBub3RpY2UgVGhlIE93bmVkIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgCi8vLyAgYXV0aG9yaXphdGlvbiBjb250cm9sIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzICYgdGhlIGltcGxlbWVudGF0aW9uIG9mCi8vLyAgdXNlciBwZXJtaXNzaW9uczsgdGhpcyBjb250cmFjdCBoYXMgdGhyZWUgd29yayBmbG93cyBmb3IgYSBjaGFuZ2UgaW4KLy8vICBvd25lcnNoaXAsIHRoZSBmaXJzdCByZXF1aXJlcyB0aGUgbmV3IG93bmVyIHRvIHZhbGlkYXRlIHRoYXQgdGhleSBoYXZlIHRoZQovLy8gIGFiaWxpdHkgdG8gYWNjZXB0IG93bmVyc2hpcCwgdGhlIHNlY29uZCBhbGxvd3MgdGhlIG93bmVyc2hpcCB0byBiZQovLy8gIGRpcmVjdGx5IHRyYW5zZmVyZWQgd2l0aG91dCByZXF1aXJpbmcgYWNjZXB0YW5jZSwgYW5kIHRoZSB0aGlyZCBhbGxvd3MgZm9yCi8vLyAgdGhlIG93bmVyc2hpcCB0byBiZSByZW1vdmVkIHRvIGFsbG93IGZvciBkZWNlbnRyYWxpemF0aW9uIApjb250cmFjdCBPd25lZCB7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lckNhbmRpZGF0ZTsKCiAgICBldmVudCBPd25lcnNoaXBSZXF1ZXN0ZWQoYWRkcmVzcyBpbmRleGVkIGJ5LCBhZGRyZXNzIGluZGV4ZWQgdG8pOwogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0byk7CiAgICBldmVudCBPd25lcnNoaXBSZW1vdmVkKCk7CgogICAgLy8vIEBkZXYgVGhlIGNvbnN0cnVjdG9yIHNldHMgdGhlIGBtc2cuc2VuZGVyYCBhcyB0aGVgb3duZXJgIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gT3duZWQoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLy8gQGRldiBgb3duZXJgIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbCBhIGZ1bmN0aW9uIHdpdGggdGhpcwogICAgLy8vIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgSW4gdGhpcyAxc3Qgb3B0aW9uIGZvciBvd25lcnNoaXAgdHJhbnNmZXIgYHByb3Bvc2VPd25lcnNoaXAoKWAgbXVzdAogICAgLy8vICBiZSBjYWxsZWQgZmlyc3QgYnkgdGhlIGN1cnJlbnQgYG93bmVyYCB0aGVuIGBhY2NlcHRPd25lcnNoaXAoKWAgbXVzdCBiZQogICAgLy8vICBjYWxsZWQgYnkgdGhlIGBuZXdPd25lckNhbmRpZGF0ZWAKICAgIC8vLyBAbm90aWNlIGBvbmx5T3duZXJgIFByb3Bvc2VzIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEKICAgIC8vLyAgbmV3IG93bmVyCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lckNhbmRpZGF0ZSBUaGUgYWRkcmVzcyBiZWluZyBwcm9wb3NlZCBhcyB0aGUgbmV3IG93bmVyCiAgICBmdW5jdGlvbiBwcm9wb3NlT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyQ2FuZGlkYXRlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IF9uZXdPd25lckNhbmRpZGF0ZTsKICAgICAgICBPd25lcnNoaXBSZXF1ZXN0ZWQobXNnLnNlbmRlciwgbmV3T3duZXJDYW5kaWRhdGUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgYG5ld093bmVyQ2FuZGlkYXRlYCwgYWNjZXB0cyB0aGUKICAgIC8vLyAgdHJhbnNmZXIgb2Ygb3duZXJzaGlwCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuZXdPd25lckNhbmRpZGF0ZSk7CgogICAgICAgIGFkZHJlc3Mgb2xkT3duZXIgPSBvd25lcjsKICAgICAgICBvd25lciA9IG5ld093bmVyQ2FuZGlkYXRlOwogICAgICAgIG5ld093bmVyQ2FuZGlkYXRlID0gMHgwOwoKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvbGRPd25lciwgb3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IEluIHRoaXMgMm5kIG9wdGlvbiBmb3Igb3duZXJzaGlwIHRyYW5zZmVyIGBjaGFuZ2VPd25lcnNoaXAoKWAgY2FuCiAgICAvLy8gIGJlIGNhbGxlZCBhbmQgaXQgd2lsbCBpbW1lZGlhdGVseSBhc3NpZ24gb3duZXJzaGlwIHRvIHRoZSBgbmV3T3duZXJgCiAgICAvLy8gQG5vdGljZSBgb3duZXJgIGNhbiBzdGVwIGRvd24gYW5kIGFzc2lnbiBzb21lIG90aGVyIGFkZHJlc3MgdG8gdGhpcyByb2xlCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX25ld093bmVyICE9IDB4MCk7CgogICAgICAgIGFkZHJlc3Mgb2xkT3duZXIgPSBvd25lcjsKICAgICAgICBvd25lciA9IF9uZXdPd25lcjsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IDB4MDsKCiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob2xkT3duZXIsIG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBJbiB0aGlzIDNyZCBvcHRpb24gZm9yIG93bmVyc2hpcCB0cmFuc2ZlciBgcmVtb3ZlT3duZXJzaGlwKClgIGNhbgogICAgLy8vICBiZSBjYWxsZWQgYW5kIGl0IHdpbGwgaW1tZWRpYXRlbHkgYXNzaWduIG93bmVyc2hpcCB0byB0aGUgMHgwIGFkZHJlc3M7CiAgICAvLy8gIGl0IHJlcXVpcmVzIGEgMHhkZWNlIGJlIGlucHV0IGFzIGEgcGFyYW1ldGVyIHRvIHByZXZlbnQgYWNjaWRlbnRhbCB1c2UKICAgIC8vLyBAbm90aWNlIERlY2VudHJhbGl6ZXMgdGhlIGNvbnRyYWN0LCB0aGlzIG9wZXJhdGlvbiBjYW5ub3QgYmUgdW5kb25lIAogICAgLy8vIEBwYXJhbSBfZGFjIGAweGRhY2AgaGFzIHRvIGJlIGVudGVyZWQgZm9yIHRoaXMgZnVuY3Rpb24gdG8gd29yawogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXJzaGlwKGFkZHJlc3MgX2RhYykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfZGFjID09IDB4ZGFjKTsKICAgICAgICBvd25lciA9IDB4MDsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IDB4MDsKICAgICAgICBPd25lcnNoaXBSZW1vdmVkKCk7ICAgICAKICAgIH0KfSAKCi8vRmlsZTogbm9kZV9tb2R1bGVzL2dpdmV0aC1jb21tb24tY29udHJhY3RzL2NvbnRyYWN0cy9FUkMyMC5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLyoqCiAqIEB0aXRsZSBFUkMyMAogKiBAZGV2IEEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciB0b2tlbnMuCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQKICovCmNvbnRyYWN0IEVSQzIwIHsKICAKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIHRvdGFsIHRva2VuIHN1cHBseQogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGFjY291bnQgYmFsYW5jZSBvZiB0aGUgYWNjb3VudCB3aXRoIGFkZHJlc3MgX293bmVyCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyBfdmFsdWUgbnVtYmVyIG9mIHRva2VucyB0byBhZGRyZXNzIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgX3ZhbHVlIG51bWJlciBvZiB0b2tlbnMgZnJvbSBhZGRyZXNzIF9mcm9tIHRvIGFkZHJlc3MgX3RvCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQGRldiBBbGxvd3MgX3NwZW5kZXIgdG8gd2l0aGRyYXcgZnJvbSB0aGUgbXNnLnNlbmRlcidzIGFjY291bnQgdXAgdG8gdGhlIF92YWx1ZSBhbW91bnQKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGFtb3VudCB3aGljaCBfc3BlbmRlciBpcyBzdGlsbCBhbGxvd2VkIHRvIHdpdGhkcmF3IGZyb20gX293bmVyCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL2dpdmV0aC1jb21tb24tY29udHJhY3RzL2NvbnRyYWN0cy9Fc2NhcGFibGUuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE1OwovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKICAgIENvbnRyaWJ1dG9yOiBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImI1ZDRkMWM3ZGNkNGY1ZDZkYWQxZDBkNmRhZGJjMWQwY2RjMTliZGNkYSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+CgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKi8KCgoKCgovLy8gQGRldiBgRXNjYXBhYmxlYCBpcyBhIGJhc2UgbGV2ZWwgY29udHJhY3QgYnVpbHQgb2ZmIG9mIHRoZSBgT3duZWRgCi8vLyAgY29udHJhY3Q7IGl0IGNyZWF0ZXMgYW4gZXNjYXBlIGhhdGNoIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIGNhbGxlZCBpbiBhbgovLy8gIGVtZXJnZW5jeSB0aGF0IHdpbGwgYWxsb3cgZGVzaWduYXRlZCBhZGRyZXNzZXMgdG8gc2VuZCBhbnkgZXRoZXIgb3IgdG9rZW5zCi8vLyAgaGVsZCBpbiB0aGUgY29udHJhY3QgdG8gYW4gYGVzY2FwZUhhdGNoRGVzdGluYXRpb25gIGFzIGxvbmcgYXMgdGhleSB3ZXJlCi8vLyAgbm90IGJsYWNrbGlzdGVkCmNvbnRyYWN0IEVzY2FwYWJsZSBpcyBPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBlc2NhcGVIYXRjaENhbGxlcjsKICAgIGFkZHJlc3MgcHVibGljIGVzY2FwZUhhdGNoRGVzdGluYXRpb247CiAgICBtYXBwaW5nIChhZGRyZXNzPT5ib29sKSBwcml2YXRlIGVzY2FwZUJsYWNrbGlzdDsgLy8gVG9rZW4gY29udHJhY3QgYWRkcmVzc2VzCgogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYCBhbmQgdGhlCiAgICAvLy8gIGBlc2NhcGVIYXRjaENhbGxlcmAKICAgIC8vLyBAcGFyYW0gX2VzY2FwZUhhdGNoQ2FsbGVyIFRoZSBhZGRyZXNzIG9mIGEgdHJ1c3RlZCBhY2NvdW50IG9yIGNvbnRyYWN0CiAgICAvLy8gIHRvIGNhbGwgYGVzY2FwZUhhdGNoKClgIHRvIHNlbmQgdGhlIGV0aGVyIGluIHRoaXMgY29udHJhY3QgdG8gdGhlCiAgICAvLy8gIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYCBpdCB3b3VsZCBiZSBpZGVhbCB0aGF0IGBlc2NhcGVIYXRjaENhbGxlcmAKICAgIC8vLyAgY2Fubm90IG1vdmUgZnVuZHMgb3V0IG9mIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYAogICAgLy8vIEBwYXJhbSBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbiBUaGUgYWRkcmVzcyBvZiBhIHNhZmUgbG9jYXRpb24gKHVzdSBhCiAgICAvLy8gIE11bHRpc2lnKSB0byBzZW5kIHRoZSBldGhlciBoZWxkIGluIHRoaXMgY29udHJhY3Q7IGlmIGEgbmV1dHJhbCBhZGRyZXNzCiAgICAvLy8gIGlzIHJlcXVpcmVkLCB0aGUgV0hHIE11bHRpc2lnIGlzIGFuIG9wdGlvbjoKICAgIC8vLyAgMHg4RmY5MjAwMjBjOEFENjczNjYxYzgxMTdmMjg1NUMzODQ3NThDNTcyIAogICAgZnVuY3Rpb24gRXNjYXBhYmxlKGFkZHJlc3MgX2VzY2FwZUhhdGNoQ2FsbGVyLCBhZGRyZXNzIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uKSBwdWJsaWMgewogICAgICAgIGVzY2FwZUhhdGNoQ2FsbGVyID0gX2VzY2FwZUhhdGNoQ2FsbGVyOwogICAgICAgIGVzY2FwZUhhdGNoRGVzdGluYXRpb24gPSBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbjsKICAgIH0KCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzc2VzIHByZWFzc2lnbmVkIGFzIGBlc2NhcGVIYXRjaENhbGxlcmAgb3IgYG93bmVyYAogICAgLy8vICBhcmUgdGhlIG9ubHkgYWRkcmVzc2VzIHRoYXQgY2FuIGNhbGwgYSBmdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlFc2NhcGVIYXRjaENhbGxlck9yT3duZXIgewogICAgICAgIHJlcXVpcmUgKChtc2cuc2VuZGVyID09IGVzY2FwZUhhdGNoQ2FsbGVyKXx8KG1zZy5zZW5kZXIgPT0gb3duZXIpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgdGhlIGJsYWNrbGlzdCBvZiB0b2tlbnMgdGhhdCBhcmUgbm90IGFibGUgdG8gYmUgdGFrZW4KICAgIC8vLyAgb3V0IG9mIHRoZSBjb250cmFjdDsgY2FuIG9ubHkgYmUgZG9uZSBhdCB0aGUgZGVwbG95bWVudCwgYW5kIHRoZSBsb2dpYwogICAgLy8vICB0byBhZGQgdG8gdGhlIGJsYWNrbGlzdCB3aWxsIGJlIGluIHRoZSBjb25zdHJ1Y3RvciBvZiBhIGNoaWxkIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF90b2tlbiB0aGUgdG9rZW4gY29udHJhY3QgYWRkcmVzcyB0aGF0IGlzIHRvIGJlIGJsYWNrbGlzdGVkIAogICAgZnVuY3Rpb24gYmxhY2tsaXN0RXNjYXBlVG9rZW4oYWRkcmVzcyBfdG9rZW4pIGludGVybmFsIHsKICAgICAgICBlc2NhcGVCbGFja2xpc3RbX3Rva2VuXSA9IHRydWU7CiAgICAgICAgRXNjYXBlSGF0Y2hCbGFja2lzdGVkVG9rZW4oX3Rva2VuKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVja3MgdG8gc2VlIGlmIGBfdG9rZW5gIGlzIGluIHRoZSBibGFja2xpc3Qgb2YgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF90b2tlbiB0aGUgdG9rZW4gYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiBgX3Rva2VuYCBpcyBpbiB0aGUgYmxhY2tsaXN0IGFuZCBjYW4ndCBiZSB0YWtlbiBvdXQgb2YKICAgIC8vLyAgdGhlIGNvbnRyYWN0IHZpYSB0aGUgYGVzY2FwZUhhdGNoKClgCiAgICBmdW5jdGlvbiBpc1Rva2VuRXNjYXBhYmxlKGFkZHJlc3MgX3Rva2VuKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAhZXNjYXBlQmxhY2tsaXN0W190b2tlbl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGBlc2NhcGVIYXRjaCgpYCBzaG91bGQgb25seSBiZSBjYWxsZWQgYXMgYSBsYXN0IHJlc29ydCBpZiBhCiAgICAvLy8gc2VjdXJpdHkgaXNzdWUgaXMgdW5jb3ZlcmVkIG9yIHNvbWV0aGluZyB1bmV4cGVjdGVkIGhhcHBlbmVkCiAgICAvLy8gQHBhcmFtIF90b2tlbiB0byB0cmFuc2ZlciwgdXNlIDB4MCBmb3IgZXRoZXIKICAgIGZ1bmN0aW9uIGVzY2FwZUhhdGNoKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUVzY2FwZUhhdGNoQ2FsbGVyT3JPd25lciB7ICAgCiAgICAgICAgcmVxdWlyZShlc2NhcGVCbGFja2xpc3RbX3Rva2VuXT09ZmFsc2UpOwoKICAgICAgICB1aW50MjU2IGJhbGFuY2U7CgogICAgICAgIC8vLyBAZGV2IExvZ2ljIGZvciBldGhlcgogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAgICAgIGVzY2FwZUhhdGNoRGVzdGluYXRpb24udHJhbnNmZXIoYmFsYW5jZSk7CiAgICAgICAgICAgIEVzY2FwZUhhdGNoQ2FsbGVkKF90b2tlbiwgYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8vIEBkZXYgTG9naWMgZm9yIHRva2VucwogICAgICAgIEVSQzIwIHRva2VuID0gRVJDMjAoX3Rva2VuKTsKICAgICAgICBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbiwgYmFsYW5jZSkpOwogICAgICAgIEVzY2FwZUhhdGNoQ2FsbGVkKF90b2tlbiwgYmFsYW5jZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hhbmdlcyB0aGUgYWRkcmVzcyBhc3NpZ25lZCB0byBjYWxsIGBlc2NhcGVIYXRjaCgpYAogICAgLy8vIEBwYXJhbSBfbmV3RXNjYXBlSGF0Y2hDYWxsZXIgVGhlIGFkZHJlc3Mgb2YgYSB0cnVzdGVkIGFjY291bnQgb3IKICAgIC8vLyAgY29udHJhY3QgdG8gY2FsbCBgZXNjYXBlSGF0Y2goKWAgdG8gc2VuZCB0aGUgdmFsdWUgaW4gdGhpcyBjb250cmFjdCB0bwogICAgLy8vICB0aGUgYGVzY2FwZUhhdGNoRGVzdGluYXRpb25gOyBpdCB3b3VsZCBiZSBpZGVhbCB0aGF0IGBlc2NhcGVIYXRjaENhbGxlcmAKICAgIC8vLyAgY2Fubm90IG1vdmUgZnVuZHMgb3V0IG9mIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYAogICAgZnVuY3Rpb24gY2hhbmdlSGF0Y2hFc2NhcGVDYWxsZXIoYWRkcmVzcyBfbmV3RXNjYXBlSGF0Y2hDYWxsZXIpIHB1YmxpYyBvbmx5RXNjYXBlSGF0Y2hDYWxsZXJPck93bmVyIHsKICAgICAgICBlc2NhcGVIYXRjaENhbGxlciA9IF9uZXdFc2NhcGVIYXRjaENhbGxlcjsKICAgIH0KCiAgICBldmVudCBFc2NhcGVIYXRjaEJsYWNraXN0ZWRUb2tlbihhZGRyZXNzIHRva2VuKTsKICAgIGV2ZW50IEVzY2FwZUhhdGNoQ2FsbGVkKGFkZHJlc3MgdG9rZW4sIHVpbnQgYW1vdW50KTsKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvbGlxdWlkcGxlZGdpbmcvY29udHJhY3RzL0xpcXVpZFBsZWRnaW5nQmFzZS5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Ci8qCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQogICAgQ29udHJpYnV0b3JzOiBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjU0MzUzMDI2M2QzNTE0MzczYjMwMzEzNzNiM2EyMDMxMmMyMDdhM2QzYiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LCBSSiBFd2luZywgR3JpZmYKICAgIEdyZWVuLCBBcnRodXIgTHVubgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgoKCgovLy8gQGRldiBUaGlzIGlzIGFuIGludGVyZmFjZSBmb3IgYExQVmF1bHRgIHdoaWNoIHNlcnZlcyBhcyBhIHNlY3VyZSBzdG9yYWdlIGZvcgovLy8gIHRoZSBFVEggdGhhdCBiYWNrcyB0aGUgUGxlZGdlcywgb25seSBhZnRlciBgTGlxdWlkUGxlZGdpbmdgIGF1dGhvcml6ZXMKLy8vICBwYXltZW50cyBjYW4gUGxlZGdlcyBiZSBjb252ZXJ0ZWQgZm9yIEVUSAppbnRlcmZhY2UgTFBWYXVsdCB7CiAgICBmdW5jdGlvbiBhdXRob3JpemVQYXltZW50KGJ5dGVzMzIgX3JlZiwgYWRkcmVzcyBfZGVzdCwgdWludCBfYW1vdW50KTsKICAgIGZ1bmN0aW9uICgpIHBheWFibGU7Cn0KCi8vLyBAZGV2IGBMaXF1aWRQbGVkZ2luZ0Jhc2VgIGlzIHRoZSBiYXNlIGxldmVsIGNvbnRyYWN0IHVzZWQgdG8gY2Fycnkgb3V0Ci8vLyAgbGlxdWlkUGxlZGdpbmcncyBtb3N0IGJhc2ljIGZ1bmN0aW9ucywgbW9zdGx5IGhhbmRsaW5nIGFuZCBzZWFyY2hpbmcgdGhlCi8vLyAgZGF0YSBzdHJ1Y3R1cmVzCmNvbnRyYWN0IExpcXVpZFBsZWRnaW5nQmFzZSBpcyBFc2NhcGFibGUgewoKICAgIC8vIExpbWl0cyBpbnNlcnRlZCB0byBwcmV2ZW50IGxhcmdlIGxvb3BzIHRoYXQgY291bGQgcHJldmVudCBjYW5jZWxpbmcKICAgIHVpbnQgY29uc3RhbnQgTUFYX0RFTEVHQVRFUyA9IDIwOwogICAgdWludCBjb25zdGFudCBNQVhfU1VCUFJPSkVDVF9MRVZFTCA9IDIwOwogICAgdWludCBjb25zdGFudCBNQVhfSU5URVJQUk9KRUNUX0xFVkVMID0gMjA7CgogICAgZW51bSBQbGVkZ2VBZG1pblR5cGUgeyBHaXZlciwgRGVsZWdhdGUsIFByb2plY3QgfQogICAgZW51bSBQbGVkZ2VTdGF0ZSB7IFBsZWRnZWQsIFBheWluZywgUGFpZCB9CgogICAgLy8vIEBkZXYgVGhpcyBzdHJ1Y3QgZGVmaW5lcyB0aGUgZGV0YWlscyBvZiBhIGBQbGVkZ2VBZG1pbmAgd2hpY2ggYXJlIAogICAgLy8vICBjb21tb25seSByZWZlcmVuY2VkIGJ5IHRoZWlyIGluZGV4IGluIHRoZSBgYWRtaW5zYCBhcnJheQogICAgLy8vICBhbmQgY2FuIG93biBwbGVkZ2VzIGFuZCBhY3QgYXMgZGVsZWdhdGVzCiAgICBzdHJ1Y3QgUGxlZGdlQWRtaW4geyAKICAgICAgICBQbGVkZ2VBZG1pblR5cGUgYWRtaW5UeXBlOyAvLyBHaXZlciwgRGVsZWdhdGUgb3IgUHJvamVjdAogICAgICAgIGFkZHJlc3MgYWRkcjsgLy8gQWNjb3VudCBvciBjb250cmFjdCBhZGRyZXNzIGZvciBhZG1pbgogICAgICAgIHN0cmluZyBuYW1lOwogICAgICAgIHN0cmluZyB1cmw7ICAvLyBDYW4gYmUgSVBGUyBoYXNoCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWU7ICAvLyBJbiBzZWNvbmRzLCB1c2VkIGZvciBHaXZlcnMnICYgRGVsZWdhdGVzJyB2ZXRvcwogICAgICAgIHVpbnQ2NCBwYXJlbnRQcm9qZWN0OyAgLy8gT25seSBmb3IgcHJvamVjdHMKICAgICAgICBib29sIGNhbmNlbGVkOyAgICAgIC8vQWx3YXlzIGZhbHNlIGV4Y2VwdCBmb3IgY2FuY2VsZWQgcHJvamVjdHMKCiAgICAgICAgLy8vIEBkZXYgaWYgdGhlIHBsdWdpbiBpcyAweDAgdGhlbiBub3RoaW5nIGhhcHBlbnMsIGlmIGl0cyBhbiBhZGRyZXNzCiAgICAgICAgLy8gdGhhbiB0aGF0IHNtYXJ0IGNvbnRyYWN0IGlzIGNhbGxlZCB3aGVuIGFwcHJvcHJpYXRlCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbjsgCiAgICB9CgogICAgc3RydWN0IFBsZWRnZSB7CiAgICAgICAgdWludCBhbW91bnQ7CiAgICAgICAgdWludDY0IG93bmVyOyAvLyBQbGVkZ2VBZG1pbgogICAgICAgIHVpbnQ2NFtdIGRlbGVnYXRpb25DaGFpbjsgLy8gTGlzdCBvZiBkZWxlZ2F0ZXMgaW4gb3JkZXIgb2YgYXV0aG9yaXR5CiAgICAgICAgdWludDY0IGludGVuZGVkUHJvamVjdDsgLy8gVXNlZCB3aGVuIGRlbGVnYXRlcyBhcmUgc2VuZGluZyB0byBwcm9qZWN0cwogICAgICAgIHVpbnQ2NCBjb21taXRUaW1lOyAgLy8gV2hlbiB0aGUgaW50ZW5kZWRQcm9qZWN0IHdpbGwgYmVjb21lIHRoZSBvd25lciAgCiAgICAgICAgdWludDY0IG9sZFBsZWRnZTsgLy8gUG9pbnRzIHRvIHRoZSBpZCB0aGF0IHRoaXMgUGxlZGdlIHdhcyBkZXJpdmVkIGZyb20KICAgICAgICBQbGVkZ2VTdGF0ZSBwbGVkZ2VTdGF0ZTsgLy8gIFBsZWRnZWQsIFBheWluZywgUGFpZAogICAgfQoKICAgIFBsZWRnZVtdIHBsZWRnZXM7CiAgICBQbGVkZ2VBZG1pbltdIGFkbWluczsgLy9UaGUgbGlzdCBvZiBwbGVkZ2VBZG1pbnMgMCBtZWFucyB0aGVyZSBpcyBubyBhZG1pbgogICAgTFBWYXVsdCBwdWJsaWMgdmF1bHQ7CgogICAgLy8vIEBkZXYgdGhpcyBtYXBwaW5nIGFsbG93cyB5b3UgdG8gc2VhcmNoIGZvciBhIHNwZWNpZmljIHBsZWRnZSdzIAogICAgLy8vICBpbmRleCBudW1iZXIgYnkgdGhlIGhhc2ggb2YgdGhhdCBwbGVkZ2UKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDY0KSBoUGxlZGdlMmlkeDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYm9vbCkgcGx1Z2luV2hpdGVsaXN0OwogICAgCiAgICBib29sIHB1YmxpYyB1c2VQbHVnaW5XaGl0ZWxpc3QgPSB0cnVlOwoKLy8vLy8vLy8vLy8vLwovLyBNb2RpZmllcnMKLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQGRldiBUaGUgYHZhdWx0YGlzIHRoZSBvbmx5IGFkZHJlc3NlcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5VmF1bHQoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModmF1bHQpKTsKICAgICAgICBfOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGUgQ29uc3RydWN0b3IgY3JlYXRlcyBgTGlxdWlkUGxlZGdpbmdCYXNlYCBvbiB0aGUgYmxvY2tjaGFpbgogICAgLy8vIEBwYXJhbSBfdmF1bHQgVGhlIHZhdWx0IHdoZXJlIHRoZSBFVEggYmFja2luZyB0aGUgcGxlZGdlcyBpcyBzdG9yZWQKICAgIGZ1bmN0aW9uIExpcXVpZFBsZWRnaW5nQmFzZSgKICAgICAgICBhZGRyZXNzIF92YXVsdCwKICAgICAgICBhZGRyZXNzIF9lc2NhcGVIYXRjaENhbGxlciwKICAgICAgICBhZGRyZXNzIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uCiAgICApIEVzY2FwYWJsZShfZXNjYXBlSGF0Y2hDYWxsZXIsIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uKSBwdWJsaWMgewogICAgICAgIGFkbWlucy5sZW5ndGggPSAxOyAvLyB3ZSByZXNlcnZlIHRoZSAwIGFkbWluCiAgICAgICAgcGxlZGdlcy5sZW5ndGggPSAxOyAvLyB3ZSByZXNlcnZlIHRoZSAwIHBsZWRnZQogICAgICAgIHZhdWx0ID0gTFBWYXVsdChfdmF1bHQpOyAvLyBBc3NpZ25zIHRoZSBzcGVjaWZpZWQgdmF1bHQKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFBsZWRnZUFkbWluIGZ1bmN0aW9ucwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIEdpdmVyIEFkbWluIHdpdGggdGhlIGBtc2cuc2VuZGVyYCBhcyB0aGUgQWRtaW4gYWRkcmVzcwogICAgLy8vIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgR2l2ZXIncyBwcm9maWxlIG9mdGVuIGFuIElQRlMgaGFzaAogICAgLy8vIEBwYXJhbSBjb21taXRUaW1lIFRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBHaXZlciBoYXMgdG8KICAgIC8vLyAgIHZldG8gd2hlbiB0aGUgR2l2ZXIncyBkZWxlZ2F0ZXMgUGxlZGdlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgLy8vIEBwYXJhbSBwbHVnaW4gVGhpcyBpcyBHaXZlcidzIGxpcXVpZCBwbGVkZ2UgcGx1Z2luIGFsbG93aW5nIGZvciAKICAgIC8vLyAgZXh0ZW5kZWQgZnVuY3Rpb25hbGl0eQogICAgLy8vIEByZXR1cm4gaWRHaXZlciBUaGUgaWQgbnVtYmVyIHVzZWQgdG8gcmVmZXJlbmNlIHRoaXMgQWRtaW4KICAgIGZ1bmN0aW9uIGFkZEdpdmVyKAogICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgIHN0cmluZyB1cmwsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbgogICAgKSByZXR1cm5zICh1aW50NjQgaWRHaXZlcikgewoKICAgICAgICByZXF1aXJlKGlzVmFsaWRQbHVnaW4ocGx1Z2luKSk7IC8vIFBsdWdpbiBjaGVjawoKICAgICAgICBpZEdpdmVyID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLkdpdmVyLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICB1cmwsCiAgICAgICAgICAgIGNvbW1pdFRpbWUsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICBwbHVnaW4pKTsKCiAgICAgICAgR2l2ZXJBZGRlZChpZEdpdmVyKTsKICAgIH0KCiAgICBldmVudCBHaXZlckFkZGVkKHVpbnQ2NCBpbmRleGVkIGlkR2l2ZXIpOwoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgYSBHaXZlcidzIGluZm8gdG8gY2hhbmdlIHRoZSBhZGRyZXNzLCBuYW1lLCB1cmwsIG9yIAogICAgLy8vICBjb21taXRUaW1lLCBpdCBjYW5ub3QgYmUgdXNlZCB0byBjaGFuZ2UgYSBwbHVnaW4sIGFuZCBpdCBtdXN0IGJlIGNhbGxlZAogICAgLy8vICBieSB0aGUgY3VycmVudCBhZGRyZXNzIG9mIHRoZSBHaXZlcgogICAgLy8vIEBwYXJhbSBpZEdpdmVyIFRoaXMgaXMgdGhlIEFkbWluIGlkIG51bWJlciB1c2VkIHRvIHNwZWNpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld0FkZHIgVGhlIG5ldyBhZGRyZXNzIHRoYXQgcmVwcmVzZW50cyB0aGlzIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld05hbWUgVGhlIG5ldyBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld1VybCBUaGUgbmV3IGxpbmsgdG8gdGhlIEdpdmVyJ3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcGFyYW0gbmV3Q29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBHaXZlciBoYXMgdG8KICAgIC8vLyAgIHZldG8gd2hlbiB0aGUgR2l2ZXIncyBkZWxlZ2F0ZXMgUGxlZGdlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgZnVuY3Rpb24gdXBkYXRlR2l2ZXIoCiAgICAgICAgdWludDY0IGlkR2l2ZXIsCiAgICAgICAgYWRkcmVzcyBuZXdBZGRyLAogICAgICAgIHN0cmluZyBuZXdOYW1lLAogICAgICAgIHN0cmluZyBuZXdVcmwsCiAgICAgICAgdWludDY0IG5ld0NvbW1pdFRpbWUpCiAgICB7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBnaXZlciA9IGZpbmRBZG1pbihpZEdpdmVyKTsKICAgICAgICByZXF1aXJlKGdpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpOyAvLyBNdXN0IGJlIGEgR2l2ZXIKICAgICAgICByZXF1aXJlKGdpdmVyLmFkZHIgPT0gbXNnLnNlbmRlcik7IC8vIEN1cnJlbnQgYWRkciBoYWQgdG8gc2VuZCB0aGlzIHR4CiAgICAgICAgZ2l2ZXIuYWRkciA9IG5ld0FkZHI7CiAgICAgICAgZ2l2ZXIubmFtZSA9IG5ld05hbWU7CiAgICAgICAgZ2l2ZXIudXJsID0gbmV3VXJsOwogICAgICAgIGdpdmVyLmNvbW1pdFRpbWUgPSBuZXdDb21taXRUaW1lOwogICAgICAgIEdpdmVyVXBkYXRlZChpZEdpdmVyKTsKICAgIH0KCiAgICBldmVudCBHaXZlclVwZGF0ZWQodWludDY0IGluZGV4ZWQgaWRHaXZlcik7CgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIERlbGVnYXRlIEFkbWluIHdpdGggdGhlIGBtc2cuc2VuZGVyYCBhcyB0aGUgQWRtaW4gYWRkcgogICAgLy8vIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIERlbGVnYXRlCiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgRGVsZWdhdGUncyBwcm9maWxlIG9mdGVuIGFuIElQRlMgaGFzaAogICAgLy8vIEBwYXJhbSBjb21taXRUaW1lIFNldHMgdGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhhdCB0aGlzIGRlbGVnYXRlCiAgICAvLy8gIGNhbiBiZSB2ZXRvZWQuIFdoZW5ldmVyIHRoaXMgZGVsZWdhdGUgaXMgaW4gYSBkZWxlZ2F0ZSBjaGFpbiB0aGUgdGltZQogICAgLy8vICBhbGxvd2VkIHRvIHZldG8gYW55IGV2ZW50IG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoaXMgdGltZS4KICAgIC8vLyBAcGFyYW0gcGx1Z2luIFRoaXMgaXMgRGVsZWdhdGUncyBsaXF1aWQgcGxlZGdlIHBsdWdpbiBhbGxvd2luZyBmb3IgCiAgICAvLy8gIGV4dGVuZGVkIGZ1bmN0aW9uYWxpdHkKICAgIC8vLyBAcmV0dXJuIGlkeERlbGVnYXRlIFRoZSBpZCBudW1iZXIgdXNlZCB0byByZWZlcmVuY2UgdGhpcyBEZWxlZ2F0ZSB3aXRoaW4KICAgIC8vLyAgdGhlIGFkbWlucyBhcnJheQogICAgZnVuY3Rpb24gYWRkRGVsZWdhdGUoCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICBJTGlxdWlkUGxlZGdpbmdQbHVnaW4gcGx1Z2luCiAgICApIHJldHVybnMgKHVpbnQ2NCBpZERlbGVnYXRlKSB7IAoKICAgICAgICByZXF1aXJlKGlzVmFsaWRQbHVnaW4ocGx1Z2luKSk7IC8vIFBsdWdpbiBjaGVjawoKICAgICAgICBpZERlbGVnYXRlID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLkRlbGVnYXRlLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICB1cmwsCiAgICAgICAgICAgIGNvbW1pdFRpbWUsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICBwbHVnaW4pKTsKCiAgICAgICAgRGVsZWdhdGVBZGRlZChpZERlbGVnYXRlKTsKICAgIH0KCiAgICBldmVudCBEZWxlZ2F0ZUFkZGVkKHVpbnQ2NCBpbmRleGVkIGlkRGVsZWdhdGUpOwoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgYSBEZWxlZ2F0ZSdzIGluZm8gdG8gY2hhbmdlIHRoZSBhZGRyZXNzLCBuYW1lLCB1cmwsIG9yIAogICAgLy8vICBjb21taXRUaW1lLCBpdCBjYW5ub3QgYmUgdXNlZCB0byBjaGFuZ2UgYSBwbHVnaW4sIGFuZCBpdCBtdXN0IGJlIGNhbGxlZAogICAgLy8vICBieSB0aGUgY3VycmVudCBhZGRyZXNzIG9mIHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBpZERlbGVnYXRlIFRoZSBBZG1pbiBpZCBudW1iZXIgdXNlZCB0byBzcGVjaWZ5IHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdBZGRyIFRoZSBuZXcgYWRkcmVzcyB0aGF0IHJlcHJlc2VudHMgdGhpcyBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdOYW1lIFRoZSBuZXcgbmFtZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdVcmwgVGhlIG5ldyBsaW5rIHRvIHRoZSBEZWxlZ2F0ZSdzIHByb2ZpbGUgb2Z0ZW4gYW4gSVBGUyBoYXNoCiAgICAvLy8gQHBhcmFtIG5ld0NvbW1pdFRpbWUgU2V0cyB0aGUgbGVuZ3RoIG9mIHRpbWUgaW4gc2Vjb25kcyB0aGF0IHRoaXMgCiAgICAvLy8gIGRlbGVnYXRlIGNhbiBiZSB2ZXRvZWQuIFdoZW5ldmVyIHRoaXMgZGVsZWdhdGUgaXMgaW4gYSBkZWxlZ2F0ZSBjaGFpbiAKICAgIC8vLyAgdGhlIHRpbWUgYWxsb3dlZCB0byB2ZXRvIGFueSBldmVudCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0bwogICAgLy8vICB0aGlzIHRpbWUuCiAgICBmdW5jdGlvbiB1cGRhdGVEZWxlZ2F0ZSgKICAgICAgICB1aW50NjQgaWREZWxlZ2F0ZSwKICAgICAgICBhZGRyZXNzIG5ld0FkZHIsCiAgICAgICAgc3RyaW5nIG5ld05hbWUsCiAgICAgICAgc3RyaW5nIG5ld1VybCwKICAgICAgICB1aW50NjQgbmV3Q29tbWl0VGltZSkgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgZGVsZWdhdGUgPSBmaW5kQWRtaW4oaWREZWxlZ2F0ZSk7CiAgICAgICAgcmVxdWlyZShkZWxlZ2F0ZS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLkRlbGVnYXRlKTsKICAgICAgICByZXF1aXJlKGRlbGVnYXRlLmFkZHIgPT0gbXNnLnNlbmRlcik7Ly8gQ3VycmVudCBhZGRyIGhhZCB0byBzZW5kIHRoaXMgdHgKICAgICAgICBkZWxlZ2F0ZS5hZGRyID0gbmV3QWRkcjsKICAgICAgICBkZWxlZ2F0ZS5uYW1lID0gbmV3TmFtZTsKICAgICAgICBkZWxlZ2F0ZS51cmwgPSBuZXdVcmw7CiAgICAgICAgZGVsZWdhdGUuY29tbWl0VGltZSA9IG5ld0NvbW1pdFRpbWU7CiAgICAgICAgRGVsZWdhdGVVcGRhdGVkKGlkRGVsZWdhdGUpOwogICAgfQoKICAgIGV2ZW50IERlbGVnYXRlVXBkYXRlZCh1aW50NjQgaW5kZXhlZCBpZERlbGVnYXRlKTsKCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgUHJvamVjdCBBZG1pbiB3aXRoIHRoZSBgbXNnLnNlbmRlcmAgYXMgdGhlIEFkbWluIGFkZHIKICAgIC8vLyBAcGFyYW0gbmFtZSBUaGUgbmFtZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBQcm9qZWN0CiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgUHJvamVjdCdzIHByb2ZpbGUgb2Z0ZW4gYW4gSVBGUyBoYXNoCiAgICAvLy8gQHBhcmFtIHByb2plY3RBZG1pbiBUaGUgYWRkcmVzcyBmb3IgdGhlIHRydXN0ZWQgcHJvamVjdCBtYW5hZ2VyIAogICAgLy8vIEBwYXJhbSBwYXJlbnRQcm9qZWN0IFRoZSBBZG1pbiBpZCBudW1iZXIgZm9yIHRoZSBwYXJlbnQgcHJvamVjdCBvciAwIGlmCiAgICAvLy8gIHRoZXJlIGlzIG5vIHBhcmVudFByb2plY3QKICAgIC8vLyBAcGFyYW0gY29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBQcm9qZWN0IGhhcyB0bwogICAgLy8vICAgdmV0byB3aGVuIHRoZSBQcm9qZWN0IGRlbGVnYXRlcyB0byBhbm90aGVyIERlbGVnYXRlIGFuZCB0aGV5IHBsZWRnZSAKICAgIC8vLyAgIHRob3NlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgLy8vIEBwYXJhbSBwbHVnaW4gVGhpcyBpcyBQcm9qZWN0J3MgbGlxdWlkIHBsZWRnZSBwbHVnaW4gYWxsb3dpbmcgZm9yIAogICAgLy8vICBleHRlbmRlZCBmdW5jdGlvbmFsaXR5CiAgICAvLy8gQHJldHVybiBpZFByb2plY3QgVGhlIGlkIG51bWJlciB1c2VkIHRvIHJlZmVyZW5jZSB0aGlzIEFkbWluCiAgICBmdW5jdGlvbiBhZGRQcm9qZWN0KAogICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgIHN0cmluZyB1cmwsCiAgICAgICAgYWRkcmVzcyBwcm9qZWN0QWRtaW4sCiAgICAgICAgdWludDY0IHBhcmVudFByb2plY3QsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbgogICAgKSByZXR1cm5zICh1aW50NjQgaWRQcm9qZWN0KSB7CiAgICAgICAgcmVxdWlyZShpc1ZhbGlkUGx1Z2luKHBsdWdpbikpOwoKICAgICAgICBpZiAocGFyZW50UHJvamVjdCAhPSAwKSB7CiAgICAgICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcGEgPSBmaW5kQWRtaW4ocGFyZW50UHJvamVjdCk7CiAgICAgICAgICAgIHJlcXVpcmUocGEuYWRtaW5UeXBlID09IFBsZWRnZUFkbWluVHlwZS5Qcm9qZWN0KTsKICAgICAgICAgICAgcmVxdWlyZShnZXRQcm9qZWN0TGV2ZWwocGEpIDwgTUFYX1NVQlBST0pFQ1RfTEVWRUwpOwogICAgICAgIH0KCiAgICAgICAgaWRQcm9qZWN0ID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLlByb2plY3QsCiAgICAgICAgICAgIHByb2plY3RBZG1pbiwKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgdXJsLAogICAgICAgICAgICBjb21taXRUaW1lLAogICAgICAgICAgICBwYXJlbnRQcm9qZWN0LAogICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgcGx1Z2luKSk7CgoKICAgICAgICBQcm9qZWN0QWRkZWQoaWRQcm9qZWN0KTsKICAgIH0KCiAgICBldmVudCBQcm9qZWN0QWRkZWQodWludDY0IGluZGV4ZWQgaWRQcm9qZWN0KTsKCgogICAgLy8vIEBub3RpY2UgVXBkYXRlcyBhIFByb2plY3QncyBpbmZvIHRvIGNoYW5nZSB0aGUgYWRkcmVzcywgbmFtZSwgdXJsLCBvciAKICAgIC8vLyAgY29tbWl0VGltZSwgaXQgY2Fubm90IGJlIHVzZWQgdG8gY2hhbmdlIGEgcGx1Z2luIG9yIGEgcGFyZW50UHJvamVjdCwKICAgIC8vLyAgYW5kIGl0IG11c3QgYmUgY2FsbGVkIGJ5IHRoZSBjdXJyZW50IGFkZHJlc3Mgb2YgdGhlIFByb2plY3QKICAgIC8vLyBAcGFyYW0gaWRQcm9qZWN0IFRoZSBBZG1pbiBpZCBudW1iZXIgdXNlZCB0byBzcGVjaWZ5IHRoZSBQcm9qZWN0CiAgICAvLy8gQHBhcmFtIG5ld0FkZHIgVGhlIG5ldyBhZGRyZXNzIHRoYXQgcmVwcmVzZW50cyB0aGlzIFByb2plY3QKICAgIC8vLyBAcGFyYW0gbmV3TmFtZSBUaGUgbmV3IG5hbWUgdXNlZCB0byBpZGVudGlmeSB0aGUgUHJvamVjdAogICAgLy8vIEBwYXJhbSBuZXdVcmwgVGhlIG5ldyBsaW5rIHRvIHRoZSBQcm9qZWN0J3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcGFyYW0gbmV3Q29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBQcm9qZWN0IGhhcwogICAgLy8vICB0byB2ZXRvIHdoZW4gdGhlIFByb2plY3QgZGVsZWdhdGVzIHRvIGEgRGVsZWdhdGUgYW5kIHRoZXkgcGxlZGdlIHRob3NlCiAgICAvLy8gIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgZnVuY3Rpb24gdXBkYXRlUHJvamVjdCgKICAgICAgICB1aW50NjQgaWRQcm9qZWN0LAogICAgICAgIGFkZHJlc3MgbmV3QWRkciwKICAgICAgICBzdHJpbmcgbmV3TmFtZSwKICAgICAgICBzdHJpbmcgbmV3VXJsLAogICAgICAgIHVpbnQ2NCBuZXdDb21taXRUaW1lKQogICAgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcHJvamVjdCA9IGZpbmRBZG1pbihpZFByb2plY3QpOwogICAgICAgIHJlcXVpcmUocHJvamVjdC5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIHJlcXVpcmUocHJvamVjdC5hZGRyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHByb2plY3QuYWRkciA9IG5ld0FkZHI7CiAgICAgICAgcHJvamVjdC5uYW1lID0gbmV3TmFtZTsKICAgICAgICBwcm9qZWN0LnVybCA9IG5ld1VybDsKICAgICAgICBwcm9qZWN0LmNvbW1pdFRpbWUgPSBuZXdDb21taXRUaW1lOwogICAgICAgIFByb2plY3RVcGRhdGVkKGlkUHJvamVjdCk7CiAgICB9CgogICAgZXZlbnQgUHJvamVjdFVwZGF0ZWQodWludDY0IGluZGV4ZWQgaWRBZG1pbik7CgoKLy8vLy8vLy8vLwovLyBQdWJsaWMgY29uc3RhbnQgZnVuY3Rpb25zCi8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBBIGNvbnN0YW50IGdldHRlciB0aGF0IHJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBwbGVkZ2VzCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIFBsZWRnZXMgaW4gdGhlIHN5c3RlbQogICAgZnVuY3Rpb24gbnVtYmVyT2ZQbGVkZ2VzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwbGVkZ2VzLmxlbmd0aCAtIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdGhhdCByZXR1cm5zIHRoZSBkZXRhaWxzIG9mIHRoZSBzcGVjaWZpZWQgcGxlZGdlCiAgICAvLy8gQHBhcmFtIGlkUGxlZGdlIHRoZSBpZCBudW1iZXIgb2YgdGhlIHBsZWRnZSBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiB0aGUgYW1vdW50LCBvd25lciwgdGhlIG51bWJlciBvZiBkZWxlZ2F0ZXMgKGJ1dCBub3QgdGhlIGFjdHVhbAogICAgLy8vICBkZWxlZ2F0ZXMsIHRoZSBpbnRlbmRlZFByb2plY3QgKGlmIGFueSksIHRoZSBjdXJyZW50IGNvbW1pdCB0aW1lIGFuZAogICAgLy8vICB0aGUgcHJldmlvdXMgcGxlZGdlIHRoaXMgcGxlZGdlIHdhcyBkZXJpdmVkIGZyb20KICAgIGZ1bmN0aW9uIGdldFBsZWRnZSh1aW50NjQgaWRQbGVkZ2UpIGNvbnN0YW50IHJldHVybnMoCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IG93bmVyLAogICAgICAgIHVpbnQ2NCBuRGVsZWdhdGVzLAogICAgICAgIHVpbnQ2NCBpbnRlbmRlZFByb2plY3QsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgdWludDY0IG9sZFBsZWRnZSwKICAgICAgICBQbGVkZ2VTdGF0ZSBwbGVkZ2VTdGF0ZQogICAgKSB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIGFtb3VudCA9IHAuYW1vdW50OwogICAgICAgIG93bmVyID0gcC5vd25lcjsKICAgICAgICBuRGVsZWdhdGVzID0gdWludDY0KHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aCk7CiAgICAgICAgaW50ZW5kZWRQcm9qZWN0ID0gcC5pbnRlbmRlZFByb2plY3Q7CiAgICAgICAgY29tbWl0VGltZSA9IHAuY29tbWl0VGltZTsKICAgICAgICBvbGRQbGVkZ2UgPSBwLm9sZFBsZWRnZTsKICAgICAgICBwbGVkZ2VTdGF0ZSA9IHAucGxlZGdlU3RhdGU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0dGVyIHRvIGZpbmQgRGVsZWdhdGUgdy8gdGhlIFBsZWRnZSBJRCAmIHRoZSBEZWxlZ2F0ZSBpbmRleAogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBUaGUgaWQgbnVtYmVyIHJlcHJlc2VudGluZyB0aGUgcGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gaWR4RGVsZWdhdGUgVGhlIGluZGV4IG51bWJlciBmb3IgdGhlIGRlbGVnYXRlIGluIHRoaXMgUGxlZGdlIAogICAgZnVuY3Rpb24gZ2V0UGxlZGdlRGVsZWdhdGUodWludDY0IGlkUGxlZGdlLCB1aW50IGlkeERlbGVnYXRlKSBjb25zdGFudCByZXR1cm5zKAogICAgICAgIHVpbnQ2NCBpZERlbGVnYXRlLAogICAgICAgIGFkZHJlc3MgYWRkciwKICAgICAgICBzdHJpbmcgbmFtZQogICAgKSB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIGlkRGVsZWdhdGUgPSBwLmRlbGVnYXRpb25DaGFpbltpZHhEZWxlZ2F0ZSAtIDFdOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgZGVsZWdhdGUgPSBmaW5kQWRtaW4oaWREZWxlZ2F0ZSk7CiAgICAgICAgYWRkciA9IGRlbGVnYXRlLmFkZHI7CiAgICAgICAgbmFtZSA9IGRlbGVnYXRlLm5hbWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBjb25zdGFudCBnZXR0ZXIgdXNlZCB0byBjaGVjayBob3cgbWFueSB0b3RhbCBBZG1pbnMgZXhpc3QKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgYWRtaW5zIChHaXZlcnMsIERlbGVnYXRlcyBhbmQgUHJvamVjdHMpIC4KICAgIGZ1bmN0aW9uIG51bWJlck9mUGxlZGdlQWRtaW5zKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFkbWlucy5sZW5ndGggLSAxOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEEgY29uc3RhbnQgZ2V0dGVyIHRvIGNoZWNrIHRoZSBkZXRhaWxzIG9mIGEgc3BlY2lmaWVkIEFkbWluICAKICAgIC8vLyBAcmV0dXJuIGFkZHIgQWNjb3VudCBvciBjb250cmFjdCBhZGRyZXNzIGZvciBhZG1pbgogICAgLy8vIEByZXR1cm4gbmFtZSBOYW1lIG9mIHRoZSBwbGVkZ2VBZG1pbgogICAgLy8vIEByZXR1cm4gdXJsIFRoZSBsaW5rIHRvIHRoZSBQcm9qZWN0J3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcmV0dXJuIGNvbW1pdFRpbWUgVGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhlIEFkbWluIGhhcyB0byB2ZXRvCiAgICAvLy8gICB3aGVuIHRoZSBBZG1pbiBkZWxlZ2F0ZXMgdG8gYSBEZWxlZ2F0ZSBhbmQgdGhhdCBEZWxlZ2F0ZSBwbGVkZ2VzIHRob3NlCiAgICAvLy8gICBmdW5kcyB0byBhIHByb2plY3QKICAgIC8vLyBAcmV0dXJuIHBhcmVudFByb2plY3QgVGhlIEFkbWluIGlkIG51bWJlciBmb3IgdGhlIHBhcmVudCBwcm9qZWN0IG9yIDAKICAgIC8vLyAgaWYgdGhlcmUgaXMgbm8gcGFyZW50UHJvamVjdAogICAgLy8vIEByZXR1cm4gY2FuY2VsZWQgMCBmb3IgRGVsZWdhdGVzICYgR2l2ZXJzLCB0cnVlIGlmIGEgUHJvamVjdCBoYXMgYmVlbiAKICAgIC8vLyAgY2FuY2VsZWQKICAgIC8vLyBAcmV0dXJuIHBsdWdpbiBUaGlzIGlzIFByb2plY3QncyBsaXF1aWRQbGVkZ2luZyBwbHVnaW4gYWxsb3dpbmcgZm9yIAogICAgLy8vICBleHRlbmRlZCBmdW5jdGlvbmFsaXR5CiAgICBmdW5jdGlvbiBnZXRQbGVkZ2VBZG1pbih1aW50NjQgaWRBZG1pbikgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgICAgUGxlZGdlQWRtaW5UeXBlIGFkbWluVHlwZSwKICAgICAgICBhZGRyZXNzIGFkZHIsCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICB1aW50NjQgcGFyZW50UHJvamVjdCwKICAgICAgICBib29sIGNhbmNlbGVkLAogICAgICAgIGFkZHJlc3MgcGx1Z2luKQogICAgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgbSA9IGZpbmRBZG1pbihpZEFkbWluKTsKICAgICAgICBhZG1pblR5cGUgPSBtLmFkbWluVHlwZTsKICAgICAgICBhZGRyID0gbS5hZGRyOwogICAgICAgIG5hbWUgPSBtLm5hbWU7CiAgICAgICAgdXJsID0gbS51cmw7CiAgICAgICAgY29tbWl0VGltZSA9IG0uY29tbWl0VGltZTsKICAgICAgICBwYXJlbnRQcm9qZWN0ID0gbS5wYXJlbnRQcm9qZWN0OwogICAgICAgIGNhbmNlbGVkID0gbS5jYW5jZWxlZDsKICAgICAgICBwbHVnaW4gPSBhZGRyZXNzKG0ucGx1Z2luKTsKICAgIH0KCi8vLy8vLy8vCi8vIFByaXZhdGUgbWV0aG9kcwovLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBjcmVhdGVzIGEgUGxlZGdlIHdpdGggYW4gaW5pdGlhbCBhbW91bnQgb2YgMCBpZiBvbmUgaXMgbm90CiAgICAvLy8gIGNyZWF0ZWQgYWxyZWFkeTsgb3RoZXJ3aXNlIGl0IGZpbmRzIHRoZSBwbGVkZ2Ugd2l0aCB0aGUgc3BlY2lmaWVkCiAgICAvLy8gIGF0dHJpYnV0ZXM7IGFsbCBwbGVkZ2VzIHRlY2huaWNhbGx5IGV4aXN0LCBpZiB0aGUgcGxlZGdlIGhhc24ndCBiZWVuCiAgICAvLy8gIGNyZWF0ZWQgaW4gdGhpcyBzeXN0ZW0geWV0IGl0IHNpbXBseSBpc24ndCBpbiB0aGUgaGFzaCBhcnJheQogICAgLy8vICBoUGxlZGdlMmlkeFtdIHlldAogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgb3duZXIgb2YgdGhlIHBsZWRnZSBiZWluZyBsb29rZWQgdXAKICAgIC8vLyBAcGFyYW0gZGVsZWdhdGlvbkNoYWluIFRoZSBsaXN0IG9mIGRlbGVnYXRlcyBpbiBvcmRlciBvZiBhdXRob3JpdHkKICAgIC8vLyBAcGFyYW0gaW50ZW5kZWRQcm9qZWN0IFRoZSBwcm9qZWN0IHRoaXMgcGxlZGdlIHdpbGwgRnVuZCBhZnRlciB0aGUKICAgIC8vLyAgY29tbWl0VGltZSBoYXMgcGFzc2VkCiAgICAvLy8gQHBhcmFtIGNvbW1pdFRpbWUgVGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhlIEdpdmVyIGhhcyB0bwogICAgLy8vICAgdmV0byB3aGVuIHRoZSBHaXZlcidzIGRlbGVnYXRlcyBQbGVkZ2UgZnVuZHMgdG8gYSBwcm9qZWN0CiAgICAvLy8gQHBhcmFtIG9sZFBsZWRnZSBUaGlzIHZhbHVlIGlzIHVzZWQgdG8gc3RvcmUgdGhlIHBsZWRnZSB0aGUgY3VycmVudAogICAgLy8vICBwbGVkZ2Ugd2FzIGNhbWUgZnJvbSwgYW5kIGluIHRoZSBjYXNlIGEgUHJvamVjdCBpcyBjYW5jZWxlZCwgdGhlIFBsZWRnZQogICAgLy8vICB3aWxsIHJldmVydCBiYWNrIHRvIGl0J3MgcHJldmlvdXMgc3RhdGUKICAgIC8vLyBAcGFyYW0gc3RhdGUgVGhlIHBsZWRnZSBzdGF0ZTogUGxlZGdlZCwgUGF5aW5nLCBvciBzdGF0ZQogICAgLy8vIEByZXR1cm4gVGhlIGhQbGVkZ2UyaWR4IGluZGV4IG51bWJlcgogICAgZnVuY3Rpb24gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgIHVpbnQ2NCBvd25lciwKICAgICAgICB1aW50NjRbXSBkZWxlZ2F0aW9uQ2hhaW4sCiAgICAgICAgdWludDY0IGludGVuZGVkUHJvamVjdCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICB1aW50NjQgb2xkUGxlZGdlLAogICAgICAgIFBsZWRnZVN0YXRlIHN0YXRlCiAgICAgICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50NjQpCiAgICB7CiAgICAgICAgYnl0ZXMzMiBoUGxlZGdlID0gc2hhMygKICAgICAgICAgICAgb3duZXIsIGRlbGVnYXRpb25DaGFpbiwgaW50ZW5kZWRQcm9qZWN0LCBjb21taXRUaW1lLCBvbGRQbGVkZ2UsIHN0YXRlKTsKICAgICAgICB1aW50NjQgaWR4ID0gaFBsZWRnZTJpZHhbaFBsZWRnZV07CiAgICAgICAgaWYgKGlkeCA+IDApIHJldHVybiBpZHg7CiAgICAgICAgaWR4ID0gdWludDY0KHBsZWRnZXMubGVuZ3RoKTsKICAgICAgICBoUGxlZGdlMmlkeFtoUGxlZGdlXSA9IGlkeDsKICAgICAgICBwbGVkZ2VzLnB1c2goUGxlZGdlKAogICAgICAgICAgICAwLCBvd25lciwgZGVsZWdhdGlvbkNoYWluLCBpbnRlbmRlZFByb2plY3QsIGNvbW1pdFRpbWUsIG9sZFBsZWRnZSwgc3RhdGUpKTsKICAgICAgICByZXR1cm4gaWR4OwogICAgfQoKICAgIC8vLyBAbm90aWNlIEEgZ2V0dGVyIHRvIGxvb2sgdXAgYSBBZG1pbidzIGRldGFpbHMKICAgIC8vLyBAcGFyYW0gaWRBZG1pbiBUaGUgaWQgZm9yIHRoZSBBZG1pbiB0byBsb29rdXAKICAgIC8vLyBAcmV0dXJuIFRoZSBQbGVkZ2VBZG1pbiBzdHJ1Y3QgZm9yIHRoZSBzcGVjaWZpZWQgQWRtaW4KICAgIGZ1bmN0aW9uIGZpbmRBZG1pbih1aW50NjQgaWRBZG1pbikgaW50ZXJuYWwgcmV0dXJucyAoUGxlZGdlQWRtaW4gc3RvcmFnZSkgewogICAgICAgIHJlcXVpcmUoaWRBZG1pbiA8IGFkbWlucy5sZW5ndGgpOwogICAgICAgIHJldHVybiBhZG1pbnNbaWRBZG1pbl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gbG9vayB1cCBhIFBsZWRnZSdzIGRldGFpbHMKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhlIGlkIGZvciB0aGUgUGxlZGdlIHRvIGxvb2t1cAogICAgLy8vIEByZXR1cm4gVGhlIFBsZWRnZUEgc3RydWN0IGZvciB0aGUgc3BlY2lmaWVkIFBsZWRnZQogICAgZnVuY3Rpb24gZmluZFBsZWRnZSh1aW50NjQgaWRQbGVkZ2UpIGludGVybmFsIHJldHVybnMgKFBsZWRnZSBzdG9yYWdlKSB7CiAgICAgICAgcmVxdWlyZShpZFBsZWRnZSA8IHBsZWRnZXMubGVuZ3RoKTsKICAgICAgICByZXR1cm4gcGxlZGdlc1tpZFBsZWRnZV07CiAgICB9CgogICAgLy8gYSBjb25zdGFudCBmb3Igd2hlbiBhIGRlbGVnYXRlIGlzIHJlcXVlc3RlZCB0aGF0IGlzIG5vdCBpbiB0aGUgc3lzdGVtCiAgICB1aW50NjQgY29uc3RhbnQgIE5PVEZPVU5EID0gMHhGRkZGRkZGRkZGRkZGRkZGOwoKICAgIC8vLyBAbm90aWNlIEEgZ2V0dGVyIHRoYXQgc2VhcmNoZXMgdGhlIGRlbGVnYXRpb25DaGFpbiBmb3IgdGhlIGxldmVsIG9mCiAgICAvLy8gIGF1dGhvcml0eSBhIHNwZWNpZmljIGRlbGVnYXRlIGhhcyB3aXRoaW4gYSBQbGVkZ2UKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIHRoYXQgd2lsbCBiZSBzZWFyY2hlZAogICAgLy8vIEBwYXJhbSBpZERlbGVnYXRlIFRoZSBzcGVjaWZpZWQgZGVsZWdhdGUgdGhhdCdzIHNlYXJjaGVkIGZvcgogICAgLy8vIEByZXR1cm4gSWYgdGhlIGRlbGVnYXRlIGNoYWluIGNvbnRhaW5zIHRoZSBkZWxlZ2F0ZSB3aXRoIHRoZQogICAgLy8vICBgYWRtaW5zYCBhcnJheSBpbmRleCBgaWREZWxlZ2F0ZWAgdGhpcyByZXR1cm5zIHRoYXQgZGVsZWdhdGVzCiAgICAvLy8gIGNvcnJlc3BvbmRpbmcgaW5kZXggaW4gdGhlIGRlbGVnYXRpb25DaGFpbi4gT3RoZXJ3aXNlIGl0IHJldHVybnMKICAgIC8vLyAgdGhlIE5PVEZPVU5EIGNvbnN0YW50CiAgICBmdW5jdGlvbiBnZXREZWxlZ2F0ZUlkeChQbGVkZ2UgcCwgdWludDY0IGlkRGVsZWdhdGUpIGludGVybmFsIHJldHVybnModWludDY0KSB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaSA8IHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwLmRlbGVnYXRpb25DaGFpbltpXSA9PSBpZERlbGVnYXRlKSByZXR1cm4gdWludDY0KGkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gTk9URk9VTkQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCBob3cgbWFueSBvbGQgInBhcmVudCIgcGxlZGdlcyBhIHNwZWNpZmljIFBsZWRnZQogICAgLy8vICBoYWQgdXNpbmcgYSBzZWxmLXJlZmVyZW50aWFsIGxvb3AKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2xkICJwYXJlbnQiIHBsZWRnZXMgYSBzcGVjaWZpYyBQbGVkZ2UgaGFkCiAgICBmdW5jdGlvbiBnZXRQbGVkZ2VMZXZlbChQbGVkZ2UgcCkgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKHAub2xkUGxlZGdlID09IDApIHJldHVybiAwOwogICAgICAgIFBsZWRnZSBzdG9yYWdlIG9sZE4gPSBmaW5kUGxlZGdlKHAub2xkUGxlZGdlKTsKICAgICAgICByZXR1cm4gZ2V0UGxlZGdlTGV2ZWwob2xkTikgKyAxOyAvLyBhIGxvb3AgbG9va3VwCiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCB0aGUgbG9uZ2VzdCBjb21taXRUaW1lIG91dCBvZiB0aGUgb3duZXIgYW5kIGFsbAogICAgLy8vICB0aGUgZGVsZWdhdGVzIGZvciBhIHNwZWNpZmllZCBwbGVkZ2UKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBtYXhpbXVtIGNvbW1pdFRpbWUgb3V0IG9mIHRoZSBvd25lciBhbmQgYWxsIHRoZSBkZWxlZ2F0ZXMKICAgIGZ1bmN0aW9uIG1heENvbW1pdFRpbWUoUGxlZGdlIHApIGludGVybmFsIHJldHVybnModWludCBjb21taXRUaW1lKSB7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBtID0gZmluZEFkbWluKHAub3duZXIpOwogICAgICAgIGNvbW1pdFRpbWUgPSBtLmNvbW1pdFRpbWU7IC8vIHN0YXJ0IHdpdGggdGhlIG93bmVyJ3MgY29tbWl0VGltZQoKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG0gPSBmaW5kQWRtaW4ocC5kZWxlZ2F0aW9uQ2hhaW5baV0pOwoKICAgICAgICAgICAgLy8gSWYgYSBkZWxlZ2F0ZSdzIGNvbW1pdFRpbWUgaXMgbG9uZ2VyLCBtYWtlIGl0IHRoZSBuZXcgY29tbWl0VGltZQogICAgICAgICAgICBpZiAobS5jb21taXRUaW1lID4gY29tbWl0VGltZSkgY29tbWl0VGltZSA9IG0uY29tbWl0VGltZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCB0aGUgbGV2ZWwgb2YgYXV0aG9yaXR5IGEgc3BlY2lmaWMgUHJvamVjdCBoYXMKICAgIC8vLyAgdXNpbmcgYSBzZWxmLXJlZmVyZW50aWFsIGxvb3AKICAgIC8vLyBAcGFyYW0gbSBUaGUgUHJvamVjdCBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgbGV2ZWwgb2YgYXV0aG9yaXR5IGEgc3BlY2lmaWMgUHJvamVjdCBoYXMKICAgIGZ1bmN0aW9uIGdldFByb2plY3RMZXZlbChQbGVkZ2VBZG1pbiBtKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICBhc3NlcnQobS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIGlmIChtLnBhcmVudFByb2plY3QgPT0gMCkgcmV0dXJuKDEpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcGFyZW50Tk0gPSBmaW5kQWRtaW4obS5wYXJlbnRQcm9qZWN0KTsKICAgICAgICByZXR1cm4gZ2V0UHJvamVjdExldmVsKHBhcmVudE5NKSArIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCBpZiBhIHNwZWNpZmllZCBQcm9qZWN0IGhhcyBiZWVuIGNhbmNlbGVkCiAgICAvLy8gQHBhcmFtIHByb2plY3RJZCBUaGUgQWRtaW4gaWQgbnVtYmVyIHVzZWQgdG8gc3BlY2lmeSB0aGUgUHJvamVjdAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgUHJvamVjdCBoYXMgYmVlbiBjYW5jZWxlZAogICAgZnVuY3Rpb24gaXNQcm9qZWN0Q2FuY2VsZWQodWludDY0IHByb2plY3RJZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgbSA9IGZpbmRBZG1pbihwcm9qZWN0SWQpOwogICAgICAgIGlmIChtLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlcnQobS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIGlmIChtLmNhbmNlbGVkKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAobS5wYXJlbnRQcm9qZWN0ID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gaXNQcm9qZWN0Q2FuY2VsZWQobS5wYXJlbnRQcm9qZWN0KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBIGdldHRlciB0byBmaW5kIHRoZSBvbGRlc3QgcGxlZGdlIHRoYXQgaGFzbid0IGJlZW4gY2FuY2VsZWQKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhlIHN0YXJ0aW5nIHBsYWNlIHRvIGxvb2t1cCB0aGUgcGxlZGdlcyAKICAgIC8vLyBAcmV0dXJuIFRoZSBvbGRlc3QgaWRQbGVkZ2UgdGhhdCBoYXNuJ3QgYmVlbiBjYW5jZWxlZCAoRFVIISkKICAgIGZ1bmN0aW9uIGdldE9sZGVzdFBsZWRnZU5vdENhbmNlbGVkKHVpbnQ2NCBpZFBsZWRnZQogICAgICAgICkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50NjQpIHsKICAgICAgICBpZiAoaWRQbGVkZ2UgPT0gMCkgcmV0dXJuIDA7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgYWRtaW4gPSBmaW5kQWRtaW4ocC5vd25lcik7CiAgICAgICAgaWYgKGFkbWluLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHJldHVybiBpZFBsZWRnZTsKCiAgICAgICAgYXNzZXJ0KGFkbWluLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuUHJvamVjdCk7CgogICAgICAgIGlmICghaXNQcm9qZWN0Q2FuY2VsZWQocC5vd25lcikpIHJldHVybiBpZFBsZWRnZTsKCiAgICAgICAgcmV0dXJuIGdldE9sZGVzdFBsZWRnZU5vdENhbmNlbGVkKHAub2xkUGxlZGdlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBIGNoZWNrIHRvIHNlZSBpZiB0aGUgbXNnLnNlbmRlciBpcyB0aGUgb3duZXIgb3IgdGhlCiAgICAvLy8gIHBsdWdpbiBjb250cmFjdCBmb3IgYSBzcGVjaWZpYyBBZG1pbgogICAgLy8vIEBwYXJhbSBtIFRoZSBBZG1pbiBiZWluZyBjaGVja2VkCiAgICBmdW5jdGlvbiBjaGVja0FkbWluT3duZXIoUGxlZGdlQWRtaW4gbSkgaW50ZXJuYWwgY29uc3RhbnQgewogICAgICAgIHJlcXVpcmUoKG1zZy5zZW5kZXIgPT0gbS5hZGRyKSB8fCAobXNnLnNlbmRlciA9PSBhZGRyZXNzKG0ucGx1Z2luKSkpOwogICAgfQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gUGx1Z2luIFdoaXRlbGlzdCBNZXRob2RzCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIGFkZFZhbGlkUGx1Z2luKGJ5dGVzMzIgY29udHJhY3RIYXNoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHBsdWdpbldoaXRlbGlzdFtjb250cmFjdEhhc2hdID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVWYWxpZFBsdWdpbihieXRlczMyIGNvbnRyYWN0SGFzaCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBwbHVnaW5XaGl0ZWxpc3RbY29udHJhY3RIYXNoXSA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVzZVdoaXRlbGlzdChib29sIHVzZVdoaXRlbGlzdCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICB1c2VQbHVnaW5XaGl0ZWxpc3QgPSB1c2VXaGl0ZWxpc3Q7CiAgICB9CgogICAgZnVuY3Rpb24gaXNWYWxpZFBsdWdpbihhZGRyZXNzIGFkZHIpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAoIXVzZVBsdWdpbldoaXRlbGlzdCB8fCBhZGRyID09IDB4MCkgcmV0dXJuIHRydWU7CgogICAgICAgIGJ5dGVzMzIgY29udHJhY3RIYXNoID0gZ2V0Q29kZUhhc2goYWRkcik7CgogICAgICAgIHJldHVybiBwbHVnaW5XaGl0ZWxpc3RbY29udHJhY3RIYXNoXTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlSGFzaChhZGRyZXNzIGFkZHIpIHB1YmxpYyByZXR1cm5zKGJ5dGVzMzIpIHsKICAgICAgICBieXRlcyBtZW1vcnkgb19jb2RlOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gcmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUsIHRoaXMgbmVlZHMgYXNzZW1ibHkKICAgICAgICAgICAgbGV0IHNpemUgOj0gZXh0Y29kZXNpemUoYWRkcikKICAgICAgICAgICAgLy8gYWxsb2NhdGUgb3V0cHV0IGJ5dGUgYXJyYXkgLSB0aGlzIGNvdWxkIGFsc28gYmUgZG9uZSB3aXRob3V0IGFzc2VtYmx5CiAgICAgICAgICAgIC8vIGJ5IHVzaW5nIG9fY29kZSA9IG5ldyBieXRlcyhzaXplKQogICAgICAgICAgICBvX2NvZGUgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgLy8gbmV3ICJtZW1vcnkgZW5kIiBpbmNsdWRpbmcgcGFkZGluZwogICAgICAgICAgICBtc3RvcmUoMHg0MCwgYWRkKG9fY29kZSwgYW5kKGFkZChhZGQoc2l6ZSwgMHgyMCksIDB4MWYpLCBub3QoMHgxZikpKSkKICAgICAgICAgICAgLy8gc3RvcmUgbGVuZ3RoIGluIG1lbW9yeQogICAgICAgICAgICBtc3RvcmUob19jb2RlLCBzaXplKQogICAgICAgICAgICAvLyBhY3R1YWxseSByZXRyaWV2ZSB0aGUgY29kZSwgdGhpcyBuZWVkcyBhc3NlbWJseQogICAgICAgICAgICBleHRjb2RlY29weShhZGRyLCBhZGQob19jb2RlLCAweDIwKSwgMCwgc2l6ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGtlY2NhazI1NihvX2NvZGUpOwogICAgfQp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy9saXF1aWRwbGVkZ2luZy9jb250cmFjdHMvTGlxdWlkUGxlZGdpbmcuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjExOwoKLyoKICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hCiAgICBDb250cmlidXRvcjogQWRyaSYjMjI0OyBNYXNzYW5ldCA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlZThmOGE5Yzg3OGZhZThkODE4YThiOGQ4MTgwOWE4Yjk2OWFjMDg3ODEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgovLyBDb250cmFjdCBJbXBvcnRzCgoKLy8vIEBkZXYgYExpcXVpZFBsZWRpbmdgIGFsbG93cyBmb3IgbGlxdWlkIHBsZWRnaW5nIHRocm91Z2ggdGhlIHVzZSBvZgovLy8gIGludGVybmFsIGlkIHN0cnVjdHVyZXMgYW5kIGRlbGVnYXRlIGNoYWluaW5nLiBBbGwgYmFzaWMgb3BlcmF0aW9ucyBmb3IKLy8vICBoYW5kbGluZyBsaXF1aWQgcGxlZGdpbmcgYXJlIHN1cHBsaWVkIGFzIHdlbGwgYXMgcGx1Z2luIGZlYXR1cmVzCi8vLyAgdG8gYWxsb3cgZm9yIGV4cGFuZGVkIGZ1bmN0aW9uYWxpdHkuCmNvbnRyYWN0IExpcXVpZFBsZWRnaW5nIGlzIExpcXVpZFBsZWRnaW5nQmFzZSB7CgoKLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEJhc2ljIGNvbnN0cnVjdG9yIGZvciBMaXF1aWRQbGVkaW5nLCBhbHNvIGNhbGxzIHRoZQogICAgLy8vICBMaXF1aWRQbGVkZ2luZ0Jhc2UgY29udHJhY3QKICAgIC8vLyBAZGV2IFRoaXMgY29uc3RydWN0b3IgIGFsc28gY2FsbHMgdGhlIGNvbnN0cnVjdG9yIAogICAgLy8vICBmb3IgYExpcXVpZFBsZWRnaW5nQmFzZWAKICAgIC8vLyBAcGFyYW0gX3ZhdWx0IFRoZSB2YXVsdCB3aGVyZSBFVEggYmFja2luZyB0aGlzIHBsZWRnZSBpcyBzdG9yZWQKICAgIGZ1bmN0aW9uIExpcXVpZFBsZWRnaW5nKAogICAgICAgIGFkZHJlc3MgX3ZhdWx0LAogICAgICAgIGFkZHJlc3MgX2VzY2FwZUhhdGNoQ2FsbGVyLAogICAgICAgIGFkZHJlc3MgX2VzY2FwZUhhdGNoRGVzdGluYXRpb24KICAgICkgTGlxdWlkUGxlZGdpbmdCYXNlKF92YXVsdCwgX2VzY2FwZUhhdGNoQ2FsbGVyLCBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbikgewoKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIGhvdyB2YWx1ZSBlbnRlcnMgaW50byB0aGUgc3lzdGVtIHdoaWNoIGNyZWF0ZXMgcGxlZGdlczsKICAgIC8vLyAgdGhlIHRva2VuIG9mIHZhbHVlIGdvZXMgaW50byB0aGUgdmF1bHQgYW5kIHRoZSBhbW91bnQgaW4gdGhlIHBsZWRnZQogICAgLy8vICByZWxldmFudCB0byB0aGlzIEdpdmVyIHdpdGhvdXQgZGVsZWdhdGVzIGlzIGluY3JlYXNlZCwgYW5kIGEgbm9ybWFsCiAgICAvLy8gIHRyYW5zZmVyIGlzIGRvbmUgdG8gdGhlIGlkUmVjZWl2ZXIKICAgIC8vLyBAcGFyYW0gaWRHaXZlciBJZGVudGlmaWVyIG9mIHRoZSBnaXZlciB0aGF0cyBkb25hdGluZy4KICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBUbyB3aG9tIGl0J3MgdHJhbnNmZXJlZC4gQ2FuIGJlIHRoZSBzYW1lIGdpdmVyLAogICAgLy8vICBhbm90aGVyIGdpdmVyLCBhIGRlbGVnYXRlIG9yIGEgcHJvamVjdC4KICAgIGZ1bmN0aW9uIGRvbmF0ZSh1aW50NjQgaWRHaXZlciwgdWludDY0IGlkUmVjZWl2ZXIpIHBheWFibGUgewogICAgICAgIGlmIChpZEdpdmVyID09IDApIHsKICAgICAgICAgICAgLy8gZGVmYXVsdCB0byAzIGRheSBjb21taXRUaW1lCiAgICAgICAgICAgIGlkR2l2ZXIgPSBhZGRHaXZlcigiIiwgIiIsIDI1OTIwMCwgSUxpcXVpZFBsZWRnaW5nUGx1Z2luKDB4MCkpOwogICAgICAgIH0KCiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBzZW5kZXIgPSBmaW5kQWRtaW4oaWRHaXZlcik7CgogICAgICAgIGNoZWNrQWRtaW5Pd25lcihzZW5kZXIpOwoKICAgICAgICByZXF1aXJlKHNlbmRlci5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLkdpdmVyKTsKCiAgICAgICAgdWludCBhbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIHJlcXVpcmUoYW1vdW50ID4gMCk7CgogICAgICAgIHZhdWx0LnRyYW5zZmVyKGFtb3VudCk7IC8vIHRyYW5zZmVycyB0aGUgYmFzZVRva2VuIHRvIHRoZSBWYXVsdAogICAgICAgIHVpbnQ2NCBpZFBsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgaWRHaXZlciwKICAgICAgICAgICAgbmV3IHVpbnQ2NFtdKDApLCAvL3doYXQgaXMgbmV3PwogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKCgogICAgICAgIFBsZWRnZSBzdG9yYWdlIG5UbyA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIG5Uby5hbW91bnQgKz0gYW1vdW50OwoKICAgICAgICBUcmFuc2ZlcigwLCBpZFBsZWRnZSwgYW1vdW50KTsKCiAgICAgICAgdHJhbnNmZXIoaWRHaXZlciwgaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIE1vdmVzIHZhbHVlIGJldHdlZW4gcGxlZGdlcwogICAgLy8vIEBwYXJhbSBpZFNlbmRlciBJRCBvZiB0aGUgZ2l2ZXIsIGRlbGVnYXRlIG9yIHByb2plY3QgYWRtaW4gdGhhdCBpcyAKICAgIC8vLyAgdHJhbnNmZXJyaW5nIHRoZSBmdW5kcyBmcm9tIFBsZWRnZSB0byBQbGVkZ2U7IHRoaXMgYWRtaW4gbXVzdCBoYXZlIAogICAgLy8vICBwZXJtaXNzaW9ucyB0byBtb3ZlIHRoZSB2YWx1ZQogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQncyBtb3ZpbmcgdGhlIHZhbHVlCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGF0J3MgYmVpbmcgbW92ZWQKICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBEZXN0aW5hdGlvbiBvZiB0aGUgdmFsdWUsIGNhbiBiZSBhIGdpdmVyIHNlbmRpbmcgdG8gCiAgICAvLy8gIGEgZ2l2ZXIgb3IgYSBkZWxlZ2F0ZSwgYSBkZWxlZ2F0ZSB0byBhbm90aGVyIGRlbGVnYXRlIG9yIGEgcHJvamVjdCAKICAgIC8vLyAgdG8gcHJlLWNvbW1pdCBpdCB0byB0aGF0IHByb2plY3QgaWYgY2FsbGVkIGZyb20gYSBkZWxlZ2F0ZSwKICAgIC8vLyAgb3IgdG8gY29tbWl0IGl0IHRvIHRoZSBwcm9qZWN0IGlmIGNhbGxlZCBmcm9tIHRoZSBvd25lci4gCiAgICBmdW5jdGlvbiB0cmFuc2ZlcigKICAgICAgICB1aW50NjQgaWRTZW5kZXIsCiAgICAgICAgdWludDY0IGlkUGxlZGdlLAogICAgICAgIHVpbnQgYW1vdW50LAogICAgICAgIHVpbnQ2NCBpZFJlY2VpdmVyCiAgICApCiAgICB7CgogICAgICAgIGlkUGxlZGdlID0gbm9ybWFsaXplUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcmVjZWl2ZXIgPSBmaW5kQWRtaW4oaWRSZWNlaXZlcik7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBzZW5kZXIgPSBmaW5kQWRtaW4oaWRTZW5kZXIpOwoKICAgICAgICBjaGVja0FkbWluT3duZXIoc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHAucGxlZGdlU3RhdGUgPT0gUGxlZGdlU3RhdGUuUGxlZGdlZCk7CgogICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaXMgdGhlIG93bmVyCiAgICAgICAgaWYgKHAub3duZXIgPT0gaWRTZW5kZXIpIHsKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHsKICAgICAgICAgICAgICAgIHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcihpZFBsZWRnZSwgYW1vdW50LCBpZFJlY2VpdmVyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZWNlaXZlci5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpIHsKICAgICAgICAgICAgICAgIHRyYW5zZmVyT3duZXJzaGlwVG9Qcm9qZWN0KGlkUGxlZGdlLCBhbW91bnQsIGlkUmVjZWl2ZXIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuRGVsZWdhdGUpIHsKICAgICAgICAgICAgICAgIGlkUGxlZGdlID0gdW5kZWxlZ2F0ZSgKICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSwKICAgICAgICAgICAgICAgICAgICBhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgYXBwZW5kRGVsZWdhdGUoaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhc3NlcnQoZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaXMgYSBkZWxlZ2F0ZQogICAgICAgIHVpbnQgc2VuZGVyRElkeCA9IGdldERlbGVnYXRlSWR4KHAsIGlkU2VuZGVyKTsKICAgICAgICBpZiAoc2VuZGVyRElkeCAhPSBOT1RGT1VORCkgewoKICAgICAgICAgICAgLy8gSWYgdGhlIHJlY2VpdmVyIGlzIGFub3RoZXIgZ2l2ZXIKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHsKICAgICAgICAgICAgICAgIC8vIE9ubHkgYWNjZXB0IHRvIGNoYW5nZSB0byB0aGUgb3JpZ2luYWwgZ2l2ZXIgdG8KICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBhbGwgZGVsZWdhdGVzCiAgICAgICAgICAgICAgICBhc3NlcnQocC5vd25lciA9PSBpZFJlY2VpdmVyKTsKICAgICAgICAgICAgICAgIHVuZGVsZWdhdGUoaWRQbGVkZ2UsIGFtb3VudCwgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgdGhlIHJlY2VpdmVyIGlzIGFub3RoZXIgZGVsZWdhdGUKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuRGVsZWdhdGUpIHsKICAgICAgICAgICAgICAgIHVpbnQgcmVjZWl2ZXJESWR4ID0gZ2V0RGVsZWdhdGVJZHgocCwgaWRSZWNlaXZlcik7CgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlY2VpdmVyIGlzIG5vdCBpbiB0aGUgZGVsZWdhdGUgbGlzdAogICAgICAgICAgICAgICAgaWYgKHJlY2VpdmVyRElkeCA9PSBOT1RGT1VORCkgewogICAgICAgICAgICAgICAgICAgIGlkUGxlZGdlID0gdW5kZWxlZ2F0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgaWRQbGVkZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoIC0gc2VuZGVyRElkeCAtIDEKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGFwcGVuZERlbGVnYXRlKGlkUGxlZGdlLCBhbW91bnQsIGlkUmVjZWl2ZXIpOwoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSByZWNlaXZlciBpcyBhbHJlYWR5IHBhcnQgb2YgdGhlIGRlbGVnYXRlIGNoYWluIGFuZCBpcwogICAgICAgICAgICAgICAgLy8gYWZ0ZXIgdGhlIHNlbmRlciwgdGhlbiBhbGwgb2YgdGhlIG90aGVyIGRlbGVnYXRlcyBhZnRlciB0aGUKICAgICAgICAgICAgICAgIC8vIHNlbmRlciBhcmUgcmVtb3ZlZCBhbmQgdGhlIHJlY2VpdmVyIGlzIGFwcGVuZGVkIGF0IHRoZQogICAgICAgICAgICAgICAgLy8gZW5kIG9mIHRoZSBkZWxlZ2F0aW9uIGNoYWluCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlY2VpdmVyRElkeCA+IHNlbmRlckRJZHgpIHsKICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSA9IHVuZGVsZWdhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGlkUGxlZGdlLAogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aCAtIHNlbmRlckRJZHggLSAxCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBhcHBlbmREZWxlZ2F0ZShpZFBsZWRnZSwgYW1vdW50LCBpZFJlY2VpdmVyKTsKCiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcmVjZWl2ZXIgaXMgYWxyZWFkeSBwYXJ0IG9mIHRoZSBkZWxlZ2F0ZSBjaGFpbiBhbmQgaXMKICAgICAgICAgICAgICAgIC8vIGJlZm9yZSB0aGUgc2VuZGVyLCB0aGVuIHRoZSBzZW5kZXIgYW5kIGFsbCBvZiB0aGUgb3RoZXIKICAgICAgICAgICAgICAgIC8vIGRlbGVnYXRlcyBhZnRlciB0aGUgUkVDRUlWRVIgYXJlIHJlbW92ZWQgZnJvbSB0aGUgY2hhaW4sCiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGludGVyZXN0aW5nIGJlY2F1c2UgdGhlIGRlbGVnYXRlIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAgICAgICAgICAgIC8vIGRlbGVnYXRlcyB0aGF0IGRlbGVnYXRlZCB0byB0aGlzIGRlbGVnYXRlLiBBcmUgdGhlcmUgZ2FtZSB0aGVvcnkKICAgICAgICAgICAgICAgIC8vIGlzc3Vlcz8gc2hvdWxkIHRoaXMgYmUgYWxsb3dlZD8KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjZWl2ZXJESWR4IDw9IHNlbmRlckRJZHgpIHsKICAgICAgICAgICAgICAgICAgICB1bmRlbGVnYXRlKAogICAgICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggLSByZWNlaXZlckRJZHggLSAxCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgdGhlIGRlbGVnYXRlIHdhbnRzIHRvIHN1cHBvcnQgYSBwcm9qZWN0LCB0aGV5IHJlbW92ZSBhbGwKICAgICAgICAgICAgLy8gdGhlIGRlbGVnYXRlcyBhZnRlciB0aGVtIGluIHRoZSBjaGFpbiBhbmQgY2hvb3NlIGEgcHJvamVjdAogICAgICAgICAgICBpZiAocmVjZWl2ZXIuYWRtaW5UeXBlID09IFBsZWRnZUFkbWluVHlwZS5Qcm9qZWN0KSB7CiAgICAgICAgICAgICAgICBpZFBsZWRnZSA9IHVuZGVsZWdhdGUoCiAgICAgICAgICAgICAgICAgICAgaWRQbGVkZ2UsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50LAogICAgICAgICAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aCAtIHNlbmRlckRJZHggLSAxCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcHJvcG9zZUFzc2lnblByb2plY3QoaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXNzZXJ0KGZhbHNlKTsgIC8vIEl0IGlzIG5vdCB0aGUgb3duZXIgbm9yIGFueSBkZWxlZ2F0ZS4KICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIHdpdGhkcmF3IHZhbHVlIGZyb20gdGhlIHN5c3RlbS4KICAgIC8vLyAgVGhpcyBjYW4gYmUgdXNlZCBieSB0aGUgZ2l2ZXJzIHdpdGhkcmF3IGFueSB1bi1jb21taXRlZCBkb25hdGlvbnMuCiAgICAvLy8gQHBhcmFtIGlkUGxlZGdlIElkIG9mIHRoZSBwbGVkZ2UgdGhhdCB3YW50cyB0byBiZSB3aXRoZHJhd24uCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiBFdGhlciB0aGF0IHdhbnRzIHRvIGJlIHdpdGhkcmF3bi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQ2NCBpZFBsZWRnZSwgdWludCBhbW91bnQpIHsKCiAgICAgICAgaWRQbGVkZ2UgPSBub3JtYWxpemVQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CgogICAgICAgIHJlcXVpcmUocC5wbGVkZ2VTdGF0ZSA9PSBQbGVkZ2VTdGF0ZS5QbGVkZ2VkKTsKCiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBvd25lciA9IGZpbmRBZG1pbihwLm93bmVyKTsKCiAgICAgICAgY2hlY2tBZG1pbk93bmVyKG93bmVyKTsKCiAgICAgICAgdWludDY0IGlkTmV3UGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBwLm93bmVyLAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBheWluZwogICAgICAgICk7CgogICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIGlkTmV3UGxlZGdlLCBhbW91bnQpOwoKICAgICAgICB2YXVsdC5hdXRob3JpemVQYXltZW50KGJ5dGVzMzIoaWROZXdQbGVkZ2UpLCBvd25lci5hZGRyLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE1ldGhvZCBjYWxsZWQgYnkgdGhlIHZhdWx0IHRvIGNvbmZpcm0gYSBwYXltZW50LgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQgd2FudHMgdG8gYmUgd2l0aGRyYXduLgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgRXRoZXIgdGhhdCB3YW50cyB0byBiZSB3aXRoZHJhd24uCiAgICBmdW5jdGlvbiBjb25maXJtUGF5bWVudCh1aW50NjQgaWRQbGVkZ2UsIHVpbnQgYW1vdW50KSBvbmx5VmF1bHQgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgcmVxdWlyZShwLnBsZWRnZVN0YXRlID09IFBsZWRnZVN0YXRlLlBheWluZyk7CgogICAgICAgIHVpbnQ2NCBpZE5ld1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgcC5vd25lciwKICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4sCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIHAub2xkUGxlZGdlLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QYWlkCiAgICAgICAgKTsKCiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgaWROZXdQbGVkZ2UsIGFtb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTWV0aG9kIGNhbGxlZCBieSB0aGUgdmF1bHQgdG8gY2FuY2VsIGEgcGF5bWVudC4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0IHdhbnRzIHRvIGJlIGNhbmNlbGVkIGZvciB3aXRoZHJhdy4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFF1YW50aXR5IG9mIEV0aGVyIHRoYXQgd2FudHMgdG8gYmUgcm9sbGVkIGJhY2suCiAgICBmdW5jdGlvbiBjYW5jZWxQYXltZW50KHVpbnQ2NCBpZFBsZWRnZSwgdWludCBhbW91bnQpIG9ubHlWYXVsdCB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICByZXF1aXJlKHAucGxlZGdlU3RhdGUgPT0gUGxlZGdlU3RhdGUuUGF5aW5nKTsgLy9UT0RPIGNoYW5nZSB0byByZXZlcnQKCiAgICAgICAgLy8gV2hlbiBhIHBheW1lbnQgaXMgY2FuY2VsZWQsIG5ldmVyIGlzIGFzc2lnbmVkIHRvIGEgcHJvamVjdC4KICAgICAgICB1aW50NjQgb2xkUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBwLm93bmVyLAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBsZWRnZWQKICAgICAgICApOwoKICAgICAgICBvbGRQbGVkZ2UgPSBub3JtYWxpemVQbGVkZ2Uob2xkUGxlZGdlKTsKCiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgb2xkUGxlZGdlLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE1ldGhvZCBjYWxsZWQgdG8gY2FuY2VsIHRoaXMgcHJvamVjdC4KICAgIC8vLyBAcGFyYW0gaWRQcm9qZWN0IElkIG9mIHRoZSBwcm9qY3QgdGhhdCB3YW50cyB0byBiZSBjYW5jZWxlZC4KICAgIGZ1bmN0aW9uIGNhbmNlbFByb2plY3QodWludDY0IGlkUHJvamVjdCkgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcHJvamVjdCA9IGZpbmRBZG1pbihpZFByb2plY3QpOwogICAgICAgIGNoZWNrQWRtaW5Pd25lcihwcm9qZWN0KTsKICAgICAgICBwcm9qZWN0LmNhbmNlbGVkID0gdHJ1ZTsKCiAgICAgICAgQ2FuY2VsUHJvamVjdChpZFByb2plY3QpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE1ldGhvZCBjYWxsZWQgdG8gY2FuY2VsIHNwZWNpZmljIHBsZWRnZS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0IHNob3VsZCBiZSBjYW5jZWxlZC4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFF1YW50aXR5IG9mIEV0aGVyIHRoYXQgd2FudHMgdG8gYmUgcm9sbGVkIGJhY2suCiAgICBmdW5jdGlvbiBjYW5jZWxQbGVkZ2UodWludDY0IGlkUGxlZGdlLCB1aW50IGFtb3VudCkgewogICAgICAgIGlkUGxlZGdlID0gbm9ybWFsaXplUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIHJlcXVpcmUocC5vbGRQbGVkZ2UgIT0gMCk7CgogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgbSA9IGZpbmRBZG1pbihwLm93bmVyKTsKICAgICAgICBjaGVja0FkbWluT3duZXIobSk7CgogICAgICAgIHVpbnQ2NCBvbGRQbGVkZ2UgPSBnZXRPbGRlc3RQbGVkZ2VOb3RDYW5jZWxlZChwLm9sZFBsZWRnZSk7CiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgb2xkUGxlZGdlLCBhbW91bnQpOwogICAgfQoKCi8vLy8vLy8vCi8vIE11bHRpIHBsZWRnZSBtZXRob2RzCi8vLy8vLy8vCgogICAgLy8gQGRldiBUaGlzIHNldCBvZiBmdW5jdGlvbnMgbWFrZXMgbW92aW5nIGEgbG90IG9mIHBsZWRnZXMgYXJvdW5kIG11Y2ggbW9yZQogICAgLy8gZWZmaWNpZW50IChzYXZlcyBnYXMpIHRoYW4gY2FsbGluZyB0aGVzZSBmdW5jdGlvbnMgaW4gc2VyaWVzCiAgICAKICAgIAogICAgLy8vIEJpdCBtYXNrIHVzZWQgZm9yIGRpdmlkaW5nIHBsZWRnZSBhbW91bnRzIGluIE11bHRpIHBsZWRnZSBtZXRob2RzCiAgICB1aW50IGNvbnN0YW50IEQ2NCA9IDB4MTAwMDAwMDAwMDAwMDAwMDA7CgogICAgLy8vIEBub3RpY2UgYG1UcmFuc2ZlcmAgYWxsb3dzIGZvciBtdWx0aXBsZSBwbGVkZ2VzIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gIGVmZmljaWVudGx5CiAgICAvLy8gQHBhcmFtIGlkU2VuZGVyIElEIG9mIHRoZSBnaXZlciwgZGVsZWdhdGUgb3IgcHJvamVjdCBhZG1pbiB0aGF0IGlzCiAgICAvLy8gIHRyYW5zZmVycmluZyB0aGUgZnVuZHMgZnJvbSBQbGVkZ2UgdG8gUGxlZGdlLiBUaGlzIGFkbWluIG11c3QgaGF2ZSAKICAgIC8vLyAgcGVybWlzc2lvbnMgdG8gbW92ZSB0aGUgdmFsdWUKICAgIC8vLyBAcGFyYW0gcGxlZGdlc0Ftb3VudHMgQW4gYXJyYXkgb2YgcGxlZGdlIGFtb3VudHMgYW5kIElEcyB3aGljaCBhcmUgZXh0cmFwb2xhdGVkCiAgICAvLy8gIHVzaW5nIHRoZSBENjQgYml0bWFzawogICAgLy8vIEBwYXJhbSBpZFJlY2VpdmVyIERlc3RpbmF0aW9uIG9mIHRoZSB2YWx1ZSwgY2FuIGJlIGEgZ2l2ZXIgc2VuZGluZwogICAgLy8vICB0byBhIGdpdmVyIG9yIGEgZGVsZWdhdGUgb3IgYSBkZWxlZ2F0ZSB0byBhbm90aGVyIGRlbGVnYXRlIG9yIGEKICAgIC8vLyAgcHJvamVjdCB0byBwcmUtY29tbWl0IGl0IHRvIHRoYXQgcHJvamVjdAogICAgZnVuY3Rpb24gbVRyYW5zZmVyKAogICAgICAgIHVpbnQ2NCBpZFNlbmRlciwKICAgICAgICB1aW50W10gcGxlZGdlc0Ftb3VudHMsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBsZWRnZXNBbW91bnRzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB1aW50NjQgaWRQbGVkZ2UgPSB1aW50NjQoIHBsZWRnZXNBbW91bnRzW2ldICYgKEQ2NC0xKSApOwogICAgICAgICAgICB1aW50IGFtb3VudCA9IHBsZWRnZXNBbW91bnRzW2ldIC8gRDY0OwoKICAgICAgICAgICAgdHJhbnNmZXIoaWRTZW5kZXIsIGlkUGxlZGdlLCBhbW91bnQsIGlkUmVjZWl2ZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbVdpdGhkcmF3YCBhbGxvd3MgZm9yIG11bHRpcGxlIHBsZWRnZXMgdG8gYmUKICAgIC8vLyAgd2l0aGRyYXduIGVmZmljaWVudGx5CiAgICAvLy8gQHBhcmFtIHBsZWRnZXNBbW91bnRzIEFuIGFycmF5IG9mIHBsZWRnZSBhbW91bnRzIGFuZCBJRHMgd2hpY2ggYXJlCiAgICAvLy8gIGV4dHJhcG9sYXRlZCB1c2luZyB0aGUgRDY0IGJpdG1hc2sKICAgIGZ1bmN0aW9uIG1XaXRoZHJhdyh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIHdpdGhkcmF3KGlkUGxlZGdlLCBhbW91bnQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbUNvbmZpcm1QYXltZW50YCBhbGxvd3MgZm9yIG11bHRpcGxlIHBsZWRnZXMgdG8gYmUgY29uZmlybWVkCiAgICAvLy8gIGVmZmljaWVudGx5CiAgICAvLy8gQHBhcmFtIHBsZWRnZXNBbW91bnRzIEFuIGFycmF5IG9mIHBsZWRnZSBhbW91bnRzIGFuZCBJRHMgd2hpY2ggYXJlIGV4dHJhcG9sYXRlZAogICAgLy8vICB1c2luZyB0aGUgRDY0IGJpdG1hc2sKICAgIGZ1bmN0aW9uIG1Db25maXJtUGF5bWVudCh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIGNvbmZpcm1QYXltZW50KGlkUGxlZGdlLCBhbW91bnQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbUNhbmNlbFBheW1lbnRgIGFsbG93cyBmb3IgbXVsdGlwbGUgcGxlZGdlcyB0byBiZSBjYW5jZWxlZAogICAgLy8vICBlZmZpY2llbnRseQogICAgLy8vIEBwYXJhbSBwbGVkZ2VzQW1vdW50cyBBbiBhcnJheSBvZiBwbGVkZ2UgYW1vdW50cyBhbmQgSURzIHdoaWNoIGFyZSBleHRyYXBvbGF0ZWQKICAgIC8vLyAgdXNpbmcgdGhlIEQ2NCBiaXRtYXNrCiAgICBmdW5jdGlvbiBtQ2FuY2VsUGF5bWVudCh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIGNhbmNlbFBheW1lbnQoaWRQbGVkZ2UsIGFtb3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtTm9ybWFsaXplUGxlZGdlYCBhbGxvd3MgZm9yIG11bHRpcGxlIHBsZWRnZXMgdG8gYmUKICAgIC8vLyAgbm9ybWFsaXplZCBlZmZpY2llbnRseQogICAgLy8vIEBwYXJhbSBwbGVkZ2VzIEFuIGFycmF5IG9mIHBsZWRnZSBJRHMKICAgIGZ1bmN0aW9uIG1Ob3JtYWxpemVQbGVkZ2UodWludDY0W10gcGxlZGdlcykgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBsZWRnZXMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgIG5vcm1hbGl6ZVBsZWRnZSggcGxlZGdlc1tpXSApOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vCi8vIFByaXZhdGUgbWV0aG9kcwovLy8vLy8vCgogICAgLy8vIEBub3RpY2UgYHRyYW5zZmVyT3duZXJzaGlwVG9Qcm9qZWN0YCBhbGxvd3MgZm9yIHRoZSB0cmFuc2ZlciBvZgogICAgLy8vICBvd25lcnNoaXAgdG8gdGhlIHByb2plY3QsIGJ1dCBpdCBjYW4gYWxzbyBiZSBjYWxsZWQgYnkgYSBwcm9qZWN0CiAgICAvLy8gIHRvIHVuLWRlbGVnYXRlIGV2ZXJ5b25lIGJ5IHNldHRpbmcgb25lJ3Mgb3duIGlkIGZvciB0aGUgaWRSZWNlaXZlcgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRvIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGF0J3MgYmVpbmcgdHJhbnNmZXJlZAogICAgLy8vIEBwYXJhbSBpZFJlY2VpdmVyIFRoZSBuZXcgb3duZXIgb2YgdGhlIHByb2plY3QgKG9yIHNlbGYgdG8gdW4tZGVsZWdhdGUpCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcFRvUHJvamVjdCgKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgLy8gRW5zdXJlIHRoYXQgdGhlIHBsZWRnZSBpcyBub3QgYWxyZWFkeSBhdCBtYXggcGxlZGdlIGRlcHRoCiAgICAgICAgLy8gYW5kIHRoZSBwcm9qZWN0IGhhcyBub3QgYmVlbiBjYW5jZWxlZAogICAgICAgIHJlcXVpcmUoZ2V0UGxlZGdlTGV2ZWwocCkgPCBNQVhfSU5URVJQUk9KRUNUX0xFVkVMKTsKICAgICAgICByZXF1aXJlKCFpc1Byb2plY3RDYW5jZWxlZChpZFJlY2VpdmVyKSk7CgogICAgICAgIHVpbnQ2NCBvbGRQbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBwLm9sZFBsZWRnZSwKICAgICAgICAgICAgUGxlZGdlU3RhdGUuUGxlZGdlZAogICAgICAgICk7CiAgICAgICAgdWludDY0IHRvUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBpZFJlY2VpdmVyLCAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmV3IG93bmVyCiAgICAgICAgICAgIG5ldyB1aW50NjRbXSgwKSwgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGhlIGRlbGVnYXRpb24gY2hhaW4KICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgb2xkUGxlZGdlLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgYW1vdW50KTsKICAgIH0gICAKCgogICAgLy8vIEBub3RpY2UgYHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcmAgYWxsb3dzIGZvciB0aGUgdHJhbnNmZXIgb2YKICAgIC8vLyAgdmFsdWUgYmFjayB0byB0aGUgR2l2ZXIsIHZhbHVlIGlzIHBsYWNlZCBpbiBhIHBsZWRnZWQgc3RhdGUKICAgIC8vLyAgd2l0aG91dCBiZWluZyBhdHRhY2hlZCB0byBhIHByb2plY3QsIGRlbGVnYXRpb24gY2hhaW4sIG9yIHRpbWUgbGluZS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0byBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgdmFsdWUgdGhhdCdzIGJlaW5nIHRyYW5zZmVyZWQKICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBUaGUgbmV3IG93bmVyIG9mIHRoZSBwbGVkZ2UKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcigKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIHVpbnQ2NCB0b1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgaWRSZWNlaXZlciwKICAgICAgICAgICAgbmV3IHVpbnQ2NFtdKDApLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgYXBwZW5kRGVsZWdhdGVgIGFsbG93cyBmb3IgYSBkZWxlZ2F0ZSB0byBiZSBhZGRlZCBvbnRvIHRoZQogICAgLy8vICBlbmQgb2YgdGhlIGRlbGVnYXRlIGNoYWluIGZvciBhIGdpdmVuIFBsZWRnZS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0cyBkZWxlZ2F0ZSBjaGFpbiB3aWxsIGJlIG1vZGlmaWVkLgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgdmFsdWUgdGhhdCdzIGJlaW5nIGNoYWluZWQuCiAgICAvLy8gQHBhcmFtIGlkUmVjZWl2ZXIgVGhlIGRlbGVnYXRlIHRvIGJlIGFkZGVkIGF0IHRoZSBlbmQgb2YgdGhlIGNoYWluCiAgICBmdW5jdGlvbiBhcHBlbmREZWxlZ2F0ZSgKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgcmVxdWlyZShwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggPCBNQVhfREVMRUdBVEVTKTsKICAgICAgICB1aW50NjRbXSBtZW1vcnkgbmV3RGVsZWdhdGlvbkNoYWluID0gbmV3IHVpbnQ2NFtdKAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggKyAxCiAgICAgICAgKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGk8cC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluW2ldID0gcC5kZWxlZ2F0aW9uQ2hhaW5baV07CiAgICAgICAgfQoKICAgICAgICAvLyBNYWtlIHRoZSBsYXN0IGl0ZW0gaW4gdGhlIGFycmF5IHRoZSBpZFJlY2VpdmVyCiAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluW3AuZGVsZWdhdGlvbkNoYWluLmxlbmd0aF0gPSBpZFJlY2VpdmVyOwoKICAgICAgICB1aW50NjQgdG9QbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIG5ld0RlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBsZWRnZWQKICAgICAgICApOwogICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIHRvUGxlZGdlLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBhcHBlbmREZWxlZ2F0ZWAgYWxsb3dzIGZvciBhIGRlbGVnYXRlIHRvIGJlIGFkZGVkIG9udG8gdGhlCiAgICAvLy8gIGVuZCBvZiB0aGUgZGVsZWdhdGUgY2hhaW4gZm9yIGEgZ2l2ZW4gUGxlZGdlLgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXRzIGRlbGVnYXRlIGNoYWluIHdpbGwgYmUgbW9kaWZpZWQuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGF0J3Mgc2hpZnRlZCBmcm9tIGRlbGVnYXRlcy4KICAgIC8vLyBAcGFyYW0gcSBOdW1iZXIgKG9yIGRlcHRoKSB0byByZW1vdmUgYXMgZGVsZWdhdGVzCiAgICBmdW5jdGlvbiB1bmRlbGVnYXRlKAogICAgICAgIHVpbnQ2NCBpZFBsZWRnZSwKICAgICAgICB1aW50IGFtb3VudCwKICAgICAgICB1aW50IHEKICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludDY0KXsKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CiAgICAgICAgdWludDY0W10gbWVtb3J5IG5ld0RlbGVnYXRpb25DaGFpbiA9IG5ldyB1aW50NjRbXSgKICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoIC0gcQogICAgICAgICk7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggLSBxOyBpKyspIHsKICAgICAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluW2ldID0gcC5kZWxlZ2F0aW9uQ2hhaW5baV07CiAgICAgICAgfQogICAgICAgIHVpbnQ2NCB0b1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgcC5vd25lciwKICAgICAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBwLm9sZFBsZWRnZSwKICAgICAgICAgICAgUGxlZGdlU3RhdGUuUGxlZGdlZAogICAgICAgICk7CiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgdG9QbGVkZ2UsIGFtb3VudCk7CgogICAgICAgIHJldHVybiB0b1BsZWRnZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgcHJvcG9zZUFzc2lnblByb2plY3RgIHByb3Bvc2VzIHRoZSBhc3NpZ25tZW50IG9mIGEgcGxlZGdlCiAgICAvLy8gIHRvIGEgc3BlY2lmaWMgcHJvamVjdC4KICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gc2hvdWxkIHBvdGVudGlhbGx5IGJlIG5hbWVkIG1vcmUgc3BlY2lmaWNhbGx5LgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQgd2lsbCBiZSBhc3NpZ25lZC4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFF1YW50aXR5IG9mIHZhbHVlIHRoaXMgcGxlZGdlIGxlYWRlciB3b3VsZCBiZSBhc3NpZ25lZC4KICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBUaGUgcHJvamVjdCB0aGlzIHBsZWRnZSB3aWxsIHBvdGVudGlhbGx5IAogICAgLy8vICBiZSBhc3NpZ25lZCB0by4KICAgIGZ1bmN0aW9uIHByb3Bvc2VBc3NpZ25Qcm9qZWN0KAogICAgICAgIHVpbnQ2NCBpZFBsZWRnZSwKICAgICAgICB1aW50IGFtb3VudCwKICAgICAgICB1aW50NjQgaWRSZWNlaXZlcgogICAgKSBpbnRlcm5hbCB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICByZXF1aXJlKGdldFBsZWRnZUxldmVsKHApIDwgTUFYX0lOVEVSUFJPSkVDVF9MRVZFTCk7CiAgICAgICAgcmVxdWlyZSghaXNQcm9qZWN0Q2FuY2VsZWQoaWRSZWNlaXZlcikpOwoKICAgICAgICB1aW50NjQgdG9QbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICBpZFJlY2VpdmVyLAogICAgICAgICAgICB1aW50NjQoZ2V0VGltZSgpICsgbWF4Q29tbWl0VGltZShwKSksCiAgICAgICAgICAgIHAub2xkUGxlZGdlLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgZG9UcmFuc2ZlcmAgaXMgZGVzaWduZWQgdG8gYWxsb3cgZm9yIHBsZWRnZSBhbW91bnRzIHRvIGJlIAogICAgLy8vICBzaGlmdGVkIGFyb3VuZCBpbnRlcm5hbGx5LgogICAgLy8vIEBwYXJhbSBmcm9tIFRoaXMgaXMgdGhlIElkIGZyb20gd2hpY2ggdmFsdWUgd2lsbCBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSB0byBUaGlzIGlzIHRoZSBJZCB0aGF0IHZhbHVlIHdpbGwgYmUgdHJhbnNmZXJlZCB0by4KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcmVkLgogICAgZnVuY3Rpb24gZG9UcmFuc2Zlcih1aW50NjQgZnJvbSwgdWludDY0IHRvLCB1aW50IF9hbW91bnQpIGludGVybmFsIHsKICAgICAgICB1aW50IGFtb3VudCA9IGNhbGxQbHVnaW5zKHRydWUsIGZyb20sIHRvLCBfYW1vdW50KTsKICAgICAgICBpZiAoZnJvbSA9PSB0bykgeyAKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoYW1vdW50ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBuRnJvbSA9IGZpbmRQbGVkZ2UoZnJvbSk7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgblRvID0gZmluZFBsZWRnZSh0byk7CiAgICAgICAgcmVxdWlyZShuRnJvbS5hbW91bnQgPj0gYW1vdW50KTsKICAgICAgICBuRnJvbS5hbW91bnQgLT0gYW1vdW50OwogICAgICAgIG5Uby5hbW91bnQgKz0gYW1vdW50OwoKICAgICAgICBUcmFuc2Zlcihmcm9tLCB0bywgYW1vdW50KTsKICAgICAgICBjYWxsUGx1Z2lucyhmYWxzZSwgZnJvbSwgdG8sIGFtb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG5vcm1hbGl6ZVBsZWRnZWAgb25seSBhZmZlY3RzIHBsZWRnZXMgd2l0aCB0aGUgUGxlZGdlZCBQbGVkZ2VTdGF0ZQogICAgLy8vIGFuZCBkb2VzIDIgdGhpbmdzOgogICAgLy8vICAgIzE6IENoZWNrcyBpZiB0aGUgcGxlZGdlIHNob3VsZCBiZSBjb21taXR0ZWQuIFRoaXMgbWVhbnMgdGhhdAogICAgLy8vICAgICAgIGlmIHRoZSBwbGVkZ2UgaGFzIGFuIGludGVuZGVkUHJvamVjdCBhbmQgaXQgaXMgcGFzdCB0aGUKICAgIC8vLyAgICAgICBjb21taXRUaW1lLCBpdCBjaGFuZ2VzIHRoZSBvd25lciB0byBiZSB0aGUgcHJvcG9zZWQgcHJvamVjdAogICAgLy8vICAgICAgIChUaGUgVUkgd2lsbCBoYXZlIHRvIHJlYWQgdGhlIGNvbW1pdCB0aW1lIGFuZCBtYW51YWxseSBkbyB3aGF0CiAgICAvLy8gICAgICAgdGhpcyBmdW5jdGlvbiBkb2VzIHRvIHRoZSBwbGVkZ2UgZm9yIHRoZSBlbmQgdXNlcgogICAgLy8vICAgICAgIGF0IHRoZSBleHBpcmF0aW9uIG9mIHRoZSBjb21taXRUaW1lKQogICAgLy8vCiAgICAvLy8gICAjMjogQ2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGF0IGlmIHRoZXJlIGhhcyBiZWVuIGEgY2FuY2VsbGF0aW9uIGluIHRoZQogICAgLy8vICAgICAgIGNoYWluIG9mIHByb2plY3RzLCB0aGUgcGxlZGdlJ3Mgb3duZXIgaGFzIGJlZW4gY2hhbmdlZAogICAgLy8vICAgICAgIGFwcHJvcHJpYXRlbHkuCiAgICAvLy8KICAgIC8vLyBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgYnkgYW55Ym9keSBhdCBhbnl0aW1lIG9uIGFueSBwbGVkZ2UuCiAgICAvLy8gSW4gZ2VuZXJhbCBpdCBjYW4gYmUgY2FsbGVkIHRvIGZvcmNlIHRoZSBjYWxscyBvZiB0aGUgYWZmZWN0ZWQgCiAgICAvLy8gcGx1Z2lucywgd2hpY2ggYWxzbyBuZWVkIHRvIGJlIHByZWRpY3RlZCBieSB0aGUgVUkKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhpcyBpcyB0aGUgaWQgb2YgdGhlIHBsZWRnZSB0aGF0IHdpbGwgYmUgbm9ybWFsaXplZAogICAgZnVuY3Rpb24gbm9ybWFsaXplUGxlZGdlKHVpbnQ2NCBpZFBsZWRnZSkgcmV0dXJucyh1aW50NjQpIHsKCiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICAvLyBDaGVjayB0byBtYWtlIHN1cmUgdGhpcyBwbGVkZ2UgaGFzbid0IGFscmVhZHkgYmVlbiB1c2VkIAogICAgICAgIC8vIG9yIGlzIGluIHRoZSBwcm9jZXNzIG9mIGJlaW5nIHVzZWQKICAgICAgICBpZiAocC5wbGVkZ2VTdGF0ZSAhPSBQbGVkZ2VTdGF0ZS5QbGVkZ2VkKSB7CiAgICAgICAgICAgIHJldHVybiBpZFBsZWRnZTsKICAgICAgICB9CgogICAgICAgIC8vIEZpcnN0IHNlbmQgdG8gYSBwcm9qZWN0IGlmIGl0J3MgcHJvcG9zZWQgYW5kIGNvbW1pdHRlZAogICAgICAgIGlmICgocC5pbnRlbmRlZFByb2plY3QgPiAwKSAmJiAoIGdldFRpbWUoKSA+IHAuY29tbWl0VGltZSkpIHsKICAgICAgICAgICAgdWludDY0IG9sZFBsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHVpbnQ2NCB0b1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgICAgIHAuaW50ZW5kZWRQcm9qZWN0LAogICAgICAgICAgICAgICAgbmV3IHVpbnQ2NFtdKDApLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICBvbGRQbGVkZ2UsCiAgICAgICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIHRvUGxlZGdlLCBwLmFtb3VudCk7CiAgICAgICAgICAgIGlkUGxlZGdlID0gdG9QbGVkZ2U7CiAgICAgICAgICAgIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKICAgICAgICB9CgogICAgICAgIHRvUGxlZGdlID0gZ2V0T2xkZXN0UGxlZGdlTm90Q2FuY2VsZWQoaWRQbGVkZ2UpOwogICAgICAgIGlmICh0b1BsZWRnZSAhPSBpZFBsZWRnZSkgewogICAgICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgcC5hbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRvUGxlZGdlOwogICAgfQoKLy8vLy8vLy8vLy8vLwovLyBQbHVnaW5zCi8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBgY2FsbFBsdWdpbmAgaXMgdXNlZCB0byB0cmlnZ2VyIHRoZSBnZW5lcmFsIGZ1bmN0aW9ucyBpbiB0aGUKICAgIC8vLyAgcGx1Z2luIGZvciBhbnkgYWN0aW9ucyBuZWVkZWQgYmVmb3JlIGFuZCBhZnRlciBhIHRyYW5zZmVyIGhhcHBlbnMuCiAgICAvLy8gIFNwZWNpZmljYWxseSB3aGF0IHRoaXMgZG9lcyBpbiByZWxhdGlvbiB0byB0aGUgcGx1Z2luIGlzIHNvbWV0aGluZwogICAgLy8vICB0aGF0IGxhcmdlbHkgZGVwZW5kcyBvbiB0aGUgZnVuY3Rpb25zIG9mIHRoYXQgcGx1Z2luLiBUaGlzIGZ1bmN0aW9uCiAgICAvLy8gIGlzIGdlbmVyYWxseSBjYWxsZWQgaW4gcGFpcnMsIG9uY2UgYmVmb3JlLCBhbmQgb25jZSBhZnRlciBhIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBiZWZvcmUgVGhpcyB0b2dnbGUgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwbHVnaW4gY2FsbCBpcyBvY2N1cnJpbmcKICAgIC8vLyAgYmVmb3JlIG9yIGFmdGVyIGEgdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGFkbWluSWQgVGhpcyBzaG91bGQgYmUgdGhlIElkIG9mIHRoZSAqdHJ1c3RlZCogaW5kaXZpZHVhbAogICAgLy8vICB3aG8gaGFzIGNvbnRyb2wgb3ZlciB0aGlzIHBsdWdpbi4KICAgIC8vLyBAcGFyYW0gZnJvbVBsZWRnZSBUaGlzIGlzIHRoZSBJZCBmcm9tIHdoaWNoIHZhbHVlIGlzIGJlaW5nIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIHRvUGxlZGdlIFRoaXMgaXMgdGhlIElkIHRoYXQgdmFsdWUgaXMgYmVpbmcgdHJhbnNmZXJlZCB0by4KICAgIC8vLyBAcGFyYW0gY29udGV4dCBUaGUgc2l0dWF0aW9uIHRoYXQgaXMgdHJpZ2dlcmluZyB0aGUgcGx1Z2luLiBTZWUgcGx1Z2luCiAgICAvLy8gIGZvciBhIGZ1bGwgZGVzY3JpcHRpb24gb2YgY29udGV4dHMuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgaXMgYmVpbmcgdHJhbnNmZXJlZC4KICAgIGZ1bmN0aW9uIGNhbGxQbHVnaW4oCiAgICAgICAgYm9vbCBiZWZvcmUsCiAgICAgICAgdWludDY0IGFkbWluSWQsCiAgICAgICAgdWludDY0IGZyb21QbGVkZ2UsCiAgICAgICAgdWludDY0IHRvUGxlZGdlLAogICAgICAgIHVpbnQ2NCBjb250ZXh0LAogICAgICAgIHVpbnQgYW1vdW50CiAgICApIGludGVybmFsIHJldHVybnMgKHVpbnQgYWxsb3dlZEFtb3VudCkgewoKICAgICAgICB1aW50IG5ld0Ftb3VudDsKICAgICAgICBhbGxvd2VkQW1vdW50ID0gYW1vdW50OwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgYWRtaW4gPSBmaW5kQWRtaW4oYWRtaW5JZCk7CiAgICAgICAgLy8gQ2hlY2tzIGFkbWluIGhhcyBhIHBsdWdpbiBhc3NpZ25lZCBhbmQgYSBub24temVybyBhbW91bnQgaXMgcmVxdWVzdGVkCiAgICAgICAgaWYgKChhZGRyZXNzKGFkbWluLnBsdWdpbikgIT0gMCkgJiYgKGFsbG93ZWRBbW91bnQgPiAwKSkgewogICAgICAgICAgICAvLyBUaGVyZSBhcmUgdHdvIHNlcGVyYXRlIGZ1bmN0aW9ucyBjYWxsZWQgaW4gdGhlIHBsdWdpbi4KICAgICAgICAgICAgLy8gT25lIGlzIGNhbGxlZCBiZWZvcmUgdGhlIHRyYW5zZmVyIGFuZCBvbmUgYWZ0ZXIKICAgICAgICAgICAgaWYgKGJlZm9yZSkgewogICAgICAgICAgICAgICAgbmV3QW1vdW50ID0gYWRtaW4ucGx1Z2luLmJlZm9yZVRyYW5zZmVyKAogICAgICAgICAgICAgICAgICAgIGFkbWluSWQsCiAgICAgICAgICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgIGFtb3VudAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJlcXVpcmUobmV3QW1vdW50IDw9IGFsbG93ZWRBbW91bnQpOwogICAgICAgICAgICAgICAgYWxsb3dlZEFtb3VudCA9IG5ld0Ftb3VudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFkbWluLnBsdWdpbi5hZnRlclRyYW5zZmVyKAogICAgICAgICAgICAgICAgICAgIGFkbWluSWQsCiAgICAgICAgICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgICAgICAgICBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgIGFtb3VudAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgY2FsbFBsdWdpbnNQbGVkZ2VgIGlzIHVzZWQgdG8gYXBwbHkgcGx1Z2luIGNhbGxzIHRvCiAgICAvLy8gIHRoZSBkZWxlZ2F0ZSBjaGFpbiBhbmQgdGhlIGludGVuZGVkIHByb2plY3QgaWYgdGhlcmUgaXMgb25lLgogICAgLy8vICBJdCBkb2VzIHNvIGluIGVpdGhlciBhIHRyYW5zZmVycmluZyBvciByZWNlaXZpbmcgY29udGV4dCBiYXNlZAogICAgLy8vICBvbiB0aGUgYGlkUGxlZGdlYCBhbmQgIGBmcm9tUGxlZGdlYCBwYXJhbWV0ZXJzLgogICAgLy8vIEBwYXJhbSBiZWZvcmUgVGhpcyB0b2dnbGUgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwbHVnaW4gY2FsbCBpcyBvY2N1cmluZwogICAgLy8vICBiZWZvcmUgb3IgYWZ0ZXIgYSB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhpcyBpcyB0aGUgSWQgb2YgdGhlIHBsZWRnZSBvbiB3aGljaCB0aGlzIHBsdWdpbgogICAgLy8vICBpcyBiZWluZyBjYWxsZWQuCiAgICAvLy8gQHBhcmFtIGZyb21QbGVkZ2UgVGhpcyBpcyB0aGUgSWQgZnJvbSB3aGljaCB2YWx1ZSBpcyBiZWluZyB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSB0b1BsZWRnZSBUaGlzIGlzIHRoZSBJZCB0aGF0IHZhbHVlIGlzIGJlaW5nIHRyYW5zZmVyZWQgdG8uCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgaXMgYmVpbmcgdHJhbnNmZXJlZC4KICAgIGZ1bmN0aW9uIGNhbGxQbHVnaW5zUGxlZGdlKAogICAgICAgIGJvb2wgYmVmb3JlLAogICAgICAgIHVpbnQ2NCBpZFBsZWRnZSwKICAgICAgICB1aW50NjQgZnJvbVBsZWRnZSwKICAgICAgICB1aW50NjQgdG9QbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludCBhbGxvd2VkQW1vdW50KSB7CiAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIGNhbGxQbHVnaW4gaXMgYmVpbmcgYXBwbGllZCBpbiBhIHJlY2VpdmluZwogICAgICAgIC8vIG9yIHRyYW5zZmVycmluZyBjb250ZXh0CiAgICAgICAgdWludDY0IG9mZnNldCA9IGlkUGxlZGdlID09IGZyb21QbGVkZ2UgPyAwIDogMjU2OwogICAgICAgIGFsbG93ZWRBbW91bnQgPSBhbW91bnQ7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICAvLyBBbHdheXMgY2FsbCB0aGUgcGx1Z2luIG9uIHRoZSBvd25lcgogICAgICAgIGFsbG93ZWRBbW91bnQgPSBjYWxsUGx1Z2luKAogICAgICAgICAgICBiZWZvcmUsCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIGZyb21QbGVkZ2UsCiAgICAgICAgICAgIHRvUGxlZGdlLAogICAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQKICAgICAgICApOwoKICAgICAgICAvLyBBcHBseSBjYWxsIHBsdWdpbiB0byBhbGwgZGVsZWdhdGVzCiAgICAgICAgZm9yICh1aW50NjQgaT0wOyBpPHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQgPSBjYWxsUGx1Z2luKAogICAgICAgICAgICAgICAgYmVmb3JlLAogICAgICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW5baV0sCiAgICAgICAgICAgICAgICBmcm9tUGxlZGdlLAogICAgICAgICAgICAgICAgdG9QbGVkZ2UsCiAgICAgICAgICAgICAgICBvZmZzZXQgKyBpKzEsCiAgICAgICAgICAgICAgICBhbGxvd2VkQW1vdW50CiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBpbnRlbmRlZCBwcm9qZWN0IGFsc28gY2FsbCB0aGUgcGx1Z2luIGluCiAgICAgICAgLy8gZWl0aGVyIGEgdHJhbnNmZXJyaW5nIG9yIHJlY2VpdmluZyBjb250ZXh0IGJhc2VkIG9uIG9mZnNldAogICAgICAgIC8vIG9uIHRoZSBpbnRlbmRlZCBwcm9qZWN0CiAgICAgICAgaWYgKHAuaW50ZW5kZWRQcm9qZWN0ID4gMCkgewogICAgICAgICAgICBhbGxvd2VkQW1vdW50ID0gY2FsbFBsdWdpbigKICAgICAgICAgICAgICAgIGJlZm9yZSwKICAgICAgICAgICAgICAgIHAuaW50ZW5kZWRQcm9qZWN0LAogICAgICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgICAgIHRvUGxlZGdlLAogICAgICAgICAgICAgICAgb2Zmc2V0ICsgMjU1LAogICAgICAgICAgICAgICAgYWxsb3dlZEFtb3VudAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCgogICAgLy8vIEBub3RpY2UgYGNhbGxQbHVnaW5zYCBjYWxscyBgY2FsbFBsdWdpbnNQbGVkZ2VgIG9uY2UgZm9yIHRoZSB0cmFuc2ZlcgogICAgLy8vICBjb250ZXh0IGFuZCBvbmNlIGZvciB0aGUgcmVjZWl2aW5nIGNvbnRleHQuIFRoZSBhZ2dyZWdhdGVkIAogICAgLy8vICBhbGxvd2VkIGFtb3VudCBpcyB0aGVuIHJldHVybmVkLgogICAgLy8vIEBwYXJhbSBiZWZvcmUgVGhpcyB0b2dnbGUgZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwbHVnaW4gY2FsbCBpcyBvY2N1cnJpbmcKICAgIC8vLyAgYmVmb3JlIG9yIGFmdGVyIGEgdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGZyb21QbGVkZ2UgVGhpcyBpcyB0aGUgSWQgZnJvbSB3aGljaCB2YWx1ZSBpcyBiZWluZyB0cmFuc2ZlcnJlZC4KICAgIC8vLyBAcGFyYW0gdG9QbGVkZ2UgVGhpcyBpcyB0aGUgSWQgdGhhdCB2YWx1ZSBpcyBiZWluZyB0cmFuc2ZlcnJlZCB0by4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdmFsdWUgdGhhdCBpcyBiZWluZyB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIGNhbGxQbHVnaW5zKAogICAgICAgIGJvb2wgYmVmb3JlLAogICAgICAgIHVpbnQ2NCBmcm9tUGxlZGdlLAogICAgICAgIHVpbnQ2NCB0b1BsZWRnZSwKICAgICAgICB1aW50IGFtb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGFsbG93ZWRBbW91bnQpIHsKICAgICAgICBhbGxvd2VkQW1vdW50ID0gYW1vdW50OwoKICAgICAgICAvLyBDYWxsIHRoZSBwbGVkZ2VzIHBsdWdpbnMgaW4gdGhlIHRyYW5zZmVyIGNvbnRleHQKICAgICAgICBhbGxvd2VkQW1vdW50ID0gY2FsbFBsdWdpbnNQbGVkZ2UoCiAgICAgICAgICAgIGJlZm9yZSwKICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgdG9QbGVkZ2UsCiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQKICAgICAgICApOwoKICAgICAgICAvLyBDYWxsIHRoZSBwbGVkZ2VzIHBsdWdpbnMgaW4gdGhlIHJlY2VpdmUgY29udGV4dAogICAgICAgIGFsbG93ZWRBbW91bnQgPSBjYWxsUGx1Z2luc1BsZWRnZSgKICAgICAgICAgICAgYmVmb3JlLAogICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgdG9QbGVkZ2UsCiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQKICAgICAgICApOwogICAgfQoKLy8vLy8vLy8vLy8vLwovLyBUZXN0IGZ1bmN0aW9ucwovLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQmFzaWMgaGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiB0aGUgY3VycmVudCB0aW1lCiAgICBmdW5jdGlvbiBnZXRUaW1lKCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBub3c7CiAgICB9CgogICAgLy8gRXZlbnQgRGVsY2VyYXRpb25zCiAgICBldmVudCBUcmFuc2Zlcih1aW50NjQgaW5kZXhlZCBmcm9tLCB1aW50NjQgaW5kZXhlZCB0bywgdWludCBhbW91bnQpOwogICAgZXZlbnQgQ2FuY2VsUHJvamVjdCh1aW50NjQgaW5kZXhlZCBpZFByb2plY3QpOwoKfQoKLy9GaWxlOiBub2RlX21vZHVsZXMvbWluaW1ldG9rZW4vY29udHJhY3RzL0NvbnRyb2xsZWQuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKY29udHJhY3QgQ29udHJvbGxlZCB7CiAgICAvLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJvbGxlciBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwKICAgIC8vLyAgYSBmdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyb2xsZXIpOyBfOyB9CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgcHVibGljIHsgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQoKICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9uZXdDb250cm9sbGVyIFRoZSBuZXcgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL21pbmltZXRva2VuL2NvbnRyYWN0cy9Ub2tlbkNvbnRyb2xsZXIuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKLy8vIEBkZXYgVGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QgbXVzdCBpbXBsZW1lbnQgdGhlc2UgZnVuY3Rpb25zCmNvbnRyYWN0IFRva2VuQ29udHJvbGxlciB7CiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcHVibGljIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBzcGVuZGVyIGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYwogICAgICAgIHJldHVybnMoYm9vbCk7Cn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL21pbmltZXRva2VuL2NvbnRyYWN0cy9NaW5pTWVUb2tlbi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgogKi8KCi8vLyBAdGl0bGUgTWluaU1lVG9rZW4gQ29udHJhY3QKLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQovLy8gQGRldiBUaGlzIHRva2VuIGNvbnRyYWN0J3MgZ29hbCBpcyB0byBtYWtlIGl0IGVhc3kgZm9yIGFueW9uZSB0byBjbG9uZSB0aGlzCi8vLyAgdG9rZW4gdXNpbmcgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBhdCBhIGdpdmVuIGJsb2NrLCB0aGlzIHdpbGwgYWxsb3cgREFPJ3MKLy8vICBhbmQgREFwcHMgdG8gdXBncmFkZSB0aGVpciBmZWF0dXJlcyBpbiBhIGRlY2VudHJhbGl6ZWQgbWFubmVyIHdpdGhvdXQKLy8vICBhZmZlY3RpbmcgdGhlIG9yaWdpbmFsIHRva2VuCi8vLyBAZGV2IEl0IGlzIEVSQzIwIGNvbXBsaWFudCwgYnV0IHN0aWxsIG5lZWRzIHRvIHVuZGVyIGdvIGZ1cnRoZXIgdGVzdGluZy4KCgoKCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKfQoKLy8vIEBkZXYgVGhlIGFjdHVhbCB0b2tlbiBjb250cmFjdCwgdGhlIGRlZmF1bHQgY29udHJvbGxlciBpcyB0aGUgbXNnLnNlbmRlcgovLy8gIHRoYXQgZGVwbG95cyB0aGUgY29udHJhY3QsIHNvIHVzdWFsbHkgdGhpcyB0b2tlbiB3aWxsIGJlIGRlcGxveWVkIGJ5IGEKLy8vICB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0LCB3aGljaCBHaXZldGggd2lsbCBjYWxsIGEgIkNhbXBhaWduIgpjb250cmFjdCBNaW5pTWVUb2tlbiBpcyBDb250cm9sbGVkIHsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlLmcuIFJFUAogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjInOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQoKCiAgICAvLy8gQGRldiBgQ2hlY2twb2ludGAgaXMgdGhlIHN0cnVjdHVyZSB0aGF0IGF0dGFjaGVzIGEgYmxvY2sgbnVtYmVyIHRvIGEKICAgIC8vLyAgZ2l2ZW4gdmFsdWUsIHRoZSBibG9jayBudW1iZXIgYXR0YWNoZWQgaXMgdGhlIG9uZSB0aGF0IGxhc3QgY2hhbmdlZCB0aGUKICAgIC8vLyAgdmFsdWUKICAgIHN0cnVjdCAgQ2hlY2twb2ludCB7CgogICAgICAgIC8vIGBmcm9tQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgdmFsdWUgd2FzIGdlbmVyYXRlZCBmcm9tCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7CgogICAgICAgIC8vIGB2YWx1ZWAgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBibG9jayBudW1iZXIKICAgICAgICB1aW50MTI4IHZhbHVlOwogICAgfQoKICAgIC8vIGBwYXJlbnRUb2tlbmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsKICAgIC8vICBpdCB3aWxsIGJlIDB4MCBmb3IgYSB0b2tlbiB0aGF0IHdhcyBub3QgY2xvbmVkCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgcGFyZW50VG9rZW47CgogICAgLy8gYHBhcmVudFNuYXBTaG90QmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgZnJvbSB0aGUgUGFyZW50IFRva2VuIHRoYXQgd2FzCiAgICAvLyAgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBDbG9uZSBUb2tlbgogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsKCiAgICAvLyBgY3JlYXRpb25CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBDbG9uZSBUb2tlbiB3YXMgY3JlYXRlZAogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsKCiAgICAvLyBgYmFsYW5jZXNgIGlzIHRoZSBtYXAgdGhhdCB0cmFja3MgdGhlIGJhbGFuY2Ugb2YgZWFjaCBhZGRyZXNzLCBpbiB0aGlzCiAgICAvLyAgY29udHJhY3Qgd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgY2hhbmdlCiAgICAvLyAgb2NjdXJyZWQgaXMgYWxzbyBpbmNsdWRlZCBpbiB0aGUgbWFwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IENoZWNrcG9pbnRbXSkgYmFsYW5jZXM7CgogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyBhbnkgZXh0cmEgdHJhbnNmZXIgcmlnaHRzIGFzIGluIGFsbCBFUkMyMCB0b2tlbnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvLyBUcmFja3MgdGhlIGhpc3Rvcnkgb2YgdGhlIGB0b3RhbFN1cHBseWAgb2YgdGhlIHRva2VuCiAgICBDaGVja3BvaW50W10gdG90YWxTdXBwbHlIaXN0b3J5OwoKICAgIC8vIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIHRoZSB0b2tlbiBpcyB0cmFuc2ZlcmFibGUgb3Igbm90LgogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzRW5hYmxlZDsKCiAgICAvLyBUaGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0ZSBuZXcgY2xvbmUgdG9rZW5zCiAgICBNaW5pTWVUb2tlbkZhY3RvcnkgcHVibGljIHRva2VuRmFjdG9yeTsKCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ29uc3RydWN0b3IKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIE1pbmlNZVRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbkZhY3RvcnkgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pbmlNZVRva2VuRmFjdG9yeSBjb250cmFjdCB0aGF0CiAgICAvLy8gIHdpbGwgY3JlYXRlIHRoZSBDbG9uZSB0b2tlbiBjb250cmFjdHMsIHRoZSB0b2tlbiBmYWN0b3J5IG5lZWRzIHRvIGJlCiAgICAvLy8gIGRlcGxveWVkIGZpcnN0CiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQogICAgLy8vICBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFNuYXBTaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwKICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4sIHNldCB0byAwIGlmIGl0CiAgICAvLy8gIGlzIGEgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbigKICAgICAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnksCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSBwdWJsaWMgewogICAgICAgIHRva2VuRmFjdG9yeSA9IE1pbmlNZVRva2VuRmFjdG9yeShfdG9rZW5GYWN0b3J5KTsKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wKICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7CiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOwogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gRVJDMjAgTWV0aG9kcwovLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAgICAgLy8gVGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gbW92ZSB0b2tlbnMgYXJvdW5kIGF0IHdpbGwsCiAgICAgICAgLy8gIHRoaXMgaXMgaW1wb3J0YW50IHRvIHJlY29nbml6ZSEgQ29uZmlybSB0aGF0IHlvdSB0cnVzdCB0aGUKICAgICAgICAvLyAgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0LCB3aGljaCBpbiBtb3N0IHNpdHVhdGlvbnMgc2hvdWxkIGJlCiAgICAgICAgLy8gIGFub3RoZXIgb3BlbiBzb3VyY2Ugc21hcnQgY29udHJhY3Qgb3IgMHgwCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgewogICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwoKICAgICAgICAgICAgLy8gVGhlIHN0YW5kYXJkIEVSQyAyMCB0cmFuc2ZlckZyb20gZnVuY3Rpb25hbGl0eQogICAgICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfYW1vdW50KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CgogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgfQoKICAgICAgICAgICByZXF1aXJlKHBhcmVudFNuYXBTaG90QmxvY2sgPCBibG9jay5udW1iZXIpOwoKICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYKICAgICAgICAgICByZXF1aXJlKChfdG8gIT0gMCkgJiYgKF90byAhPSBhZGRyZXNzKHRoaXMpKSk7CgogICAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgYmVpbmcgdHJhbnNmZXJlZCBpcyBtb3JlIHRoYW4gdGhlIGJhbGFuY2Ugb2YgdGhlCiAgICAgICAgICAgLy8gIGFjY291bnQgdGhlIHRyYW5zZmVyIHJldHVybnMgZmFsc2UKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgewogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KSk7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19mcm9tXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHJlY2VpdmluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0cmFuc2ZlciBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKCiAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCdzIGJhbGFuY2UgaXMgYmVpbmcgcmVxdWVzdGVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jawogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uCiAgICAvLy8gIHRvIGJlIGEgbGl0dGxlIGJpdCBzYWZlcgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpKTsKCiAgICAgICAgQXBwcm92ZUFuZENhbGxGYWxsQmFjayhfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBfYW1vdW50LAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfZXh0cmFEYXRhCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIGdldCB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgcHVibGljIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mCiAgICAgICAgLy8gIHRoaXMgdG9rZW4KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSB0b3RhbFN1cHBseSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGlzIHRva2VuIGFzIHRoYXQgY29udGFpbnMgdG90YWxTdXBwbHkgb2YgdGhpcwogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBDbG9uZSBUb2tlbiBNZXRob2QKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcKICAgIC8vLyAgdGhpcyB0b2tlbiBhdCBgX3NuYXBzaG90QmxvY2tgCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuTmFtZSBOYW1lIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuU3ltYm9sIFN5bWJvbCBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgd2hlbiB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBwYXJlbnQgdG9rZW4gaXMKICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsKICAgIC8vLyAgaWYgdGhlIGJsb2NrIGlzIHplcm8gdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgKSBwdWJsaWMgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF9vd25lciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBfYW1vdW50YCB0b2tlbnMgZnJvbSBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGxvc2UgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBidXJuZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ID49IF9hbW91bnQpOwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlRnJvbSA+PSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihfb3duZXIsIDAsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBFbmFibGUgdG9rZW5zIHRyYW5zZmVycwovLy8vLy8vLy8vLy8vLy8vCgoKICAgIC8vLyBAbm90aWNlIEVuYWJsZXMgdG9rZW4gaG9sZGVycyB0byB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZnJlZWx5IGlmIHRydWUKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2Ugb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUKICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdAogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNDb250cmFjdChjb250cm9sbGVyKSk7CiAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpOwogICAgfQoKLy8vLy8vLy8vLwovLyBTYWZldHkgTWV0aG9kcwovLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHB1YmxpYyByZXR1cm5zIChNaW5pTWVUb2tlbikgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOwogICAgfQp9CgovL0ZpbGU6IGNvbnRyYWN0cy9MUFBDYW1wYWlnbi5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgoKCgoKLy8vIEB0aXRsZSBMUFBDYW1wYWlnbgovLy8gQGF1dGhvciBwZXJpc3NvbG9neSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzMTQxNTQ0MzU4NDI0MjVlNWQ1ZTU2NDg3MTQxNDM1ZTQ1NWU1ZjVjNTA1ODVkMWY1MjVlNWMiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgovLy8gQG5vdGljZSBUaGUgTFBQQ2FtcGFpZ24gY29udHJhY3QgaXMgYSBwbHVnaW4gY29udHJhY3QgZm9yIGxpcXVpZFBsZWRnaW5nLAovLy8gIGV4dGVuZGluZyB0aGUgZnVuY3Rpb25hbGl0eSBvZiBhIGxpcXVpZFBsZWRnaW5nIHByb2plY3QuIFRoaXMgY29udHJhY3QKLy8vICBwcmV2ZW50cyB3aXRoZHJhd2FscyBmcm9tIGFueSBwbGVkZ2VzIHRoaXMgY29udHJhY3QgaXMgdGhlIG93bmVyIG9mLgovLy8gIFRoaXMgY29udHJhY3QgaGFzIDIgcm9sZXMuIFRoZSBvd25lciBhbmQgYSByZXZpZXdlci4gVGhlIG93bmVyIGNhbiB0cmFuc2ZlciBvciBjYW5jZWwKLy8vICBhbnkgcGxlZGdlcyB0aGlzIGNvbnRyYWN0IG93bnMuIFRoZSByZXZpZXdlciBjYW4gb25seSBjYW5jZWwgdGhlIHBsZWRnZXMuCi8vLyAgSWYgdGhpcyBjb250cmFjdCBpcyBjYW5jZWxlZCwgYWxsIHBsZWRnZXMgd2lsbCBiZSByb2xsZWQgYmFjayB0byB0aGUgcHJldmlvdXMgb3duZXIKLy8vICBhbmQgd2lsbCByZWplY3QgYWxsIGZ1dHVyZSBwbGVkZ2UgdHJhbnNmZXJzIHRvIHRoZSBwbGVkZ2VBZG1pbiByZXByZXNlbnRlZCBieSB0aGlzIGNvbnRyYWN0CmNvbnRyYWN0IExQUENhbXBhaWduIGlzIEVzY2FwYWJsZSwgVG9rZW5Db250cm9sbGVyIHsKICAgIHVpbnQgY29uc3RhbnQgRlJPTV9PV05FUiA9IDA7CiAgICB1aW50IGNvbnN0YW50IEZST01fUFJPUE9TRURQUk9KRUNUID0gMjU1OwogICAgdWludCBjb25zdGFudCBUT19PV05FUiA9IDI1NjsKICAgIHVpbnQgY29uc3RhbnQgVE9fUFJPUE9TRURQUk9KRUNUID0gNTExOwoKICAgIExpcXVpZFBsZWRnaW5nIHB1YmxpYyBsaXF1aWRQbGVkZ2luZzsKICAgIE1pbmlNZVRva2VuIHB1YmxpYyB0b2tlbjsKICAgIGJvb2wgcHVibGljIGluaXRQZW5kaW5nOwogICAgdWludDY0IHB1YmxpYyBpZFByb2plY3Q7CiAgICBhZGRyZXNzIHB1YmxpYyByZXZpZXdlcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld1Jldmlld2VyOwoKICAgIGV2ZW50IEdlbmVyYXRlVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBsaXF1aWRQbGVkZ2luZywgYWRkcmVzcyBhZGRyLCB1aW50IGFtb3VudCk7CgogICAgZnVuY3Rpb24gTFBQQ2FtcGFpZ24oCiAgICAgICAgTGlxdWlkUGxlZGdpbmcgX2xpcXVpZFBsZWRnaW5nLAogICAgICAgIHN0cmluZyB0b2tlbk5hbWUsCiAgICAgICAgc3RyaW5nIHRva2VuU3ltYm9sLAogICAgICAgIGFkZHJlc3MgX2VzY2FwZUhhdGNoQ2FsbGVyLAogICAgICAgIGFkZHJlc3MgX2VzY2FwZUhhdGNoRGVzdGluYXRpb24KICAgICkgRXNjYXBhYmxlKF9lc2NhcGVIYXRjaENhbGxlciwgX2VzY2FwZUhhdGNoRGVzdGluYXRpb24pIHB1YmxpYwogICAgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gdHgub3JpZ2luKTsKICAgICAgbGlxdWlkUGxlZGdpbmcgPSBfbGlxdWlkUGxlZGdpbmc7CiAgICAgIE1pbmlNZVRva2VuRmFjdG9yeSB0b2tlbkZhY3RvcnkgPSBuZXcgTWluaU1lVG9rZW5GYWN0b3J5KCk7CiAgICAgIHRva2VuID0gbmV3IE1pbmlNZVRva2VuKHRva2VuRmFjdG9yeSwgMHgwLCAwLCB0b2tlbk5hbWUsIDE4LCB0b2tlblN5bWJvbCwgZmFsc2UpOwogICAgICBpbml0UGVuZGluZyA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdCgKICAgICAgICBzdHJpbmcgbmFtZSwKICAgICAgICBzdHJpbmcgdXJsLAogICAgICAgIHVpbnQ2NCBwYXJlbnRQcm9qZWN0LAogICAgICAgIGFkZHJlc3MgX3Jldmlld2VyCiAgICApIHsKICAgICAgICByZXF1aXJlKGluaXRQZW5kaW5nKTsKICAgICAgICBpZFByb2plY3QgPSBsaXF1aWRQbGVkZ2luZy5hZGRQcm9qZWN0KG5hbWUsIHVybCwgYWRkcmVzcyh0aGlzKSwgcGFyZW50UHJvamVjdCwgMCwgSUxpcXVpZFBsZWRnaW5nUGx1Z2luKHRoaXMpKTsKICAgICAgICByZXZpZXdlciA9IF9yZXZpZXdlcjsKICAgICAgICBpbml0UGVuZGluZyA9IGZhbHNlOwogICAgfQoKICAgIG1vZGlmaWVyIGluaXRpYWxpemVkKCkgewogICAgICByZXF1aXJlKCFpbml0UGVuZGluZyk7CiAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVJldmlld2VyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSByZXZpZXdlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXJPclJldmlld2VyKCkgewogICAgICAgIHJlcXVpcmUoIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSByZXZpZXdlciApOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlUmV2aWV3ZXIoYWRkcmVzcyBfbmV3UmV2aWV3ZXIpIHB1YmxpYyBpbml0aWFsaXplZCBvbmx5UmV2aWV3ZXIgewogICAgICAgIG5ld1Jldmlld2VyID0gX25ld1Jldmlld2VyOwogICAgfQoKICAgIGZ1bmN0aW9uIGFjY2VwdE5ld1Jldmlld2VyKCkgcHVibGljIGluaXRpYWxpemVkIHsKICAgICAgICByZXF1aXJlKG5ld1Jldmlld2VyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJldmlld2VyID0gbmV3UmV2aWV3ZXI7CiAgICAgICAgbmV3UmV2aWV3ZXIgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGJlZm9yZVRyYW5zZmVyKAogICAgICAgIHVpbnQ2NCBwbGVkZ2VBZG1pbiwKICAgICAgICB1aW50NjQgcGxlZGdlRnJvbSwKICAgICAgICB1aW50NjQgcGxlZGdlVG8sCiAgICAgICAgdWludDY0IGNvbnRleHQsCiAgICAgICAgdWludCBhbW91bnQKICAgICkgZXh0ZXJuYWwgaW5pdGlhbGl6ZWQgcmV0dXJucyAodWludCBtYXhBbGxvd2VkKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MobGlxdWlkUGxlZGdpbmcpKTsKICAgICAgICB2YXIgKCwgLCAsIGZyb21Qcm9wb3NlZFByb2plY3QgLCAsICwgKSA9IGxpcXVpZFBsZWRnaW5nLmdldFBsZWRnZShwbGVkZ2VGcm9tKTsKICAgICAgICB2YXIgKCwgLCAsICwgLCAsIHRvUGxlZGdlU3RhdGUgKSA9IGxpcXVpZFBsZWRnaW5nLmdldFBsZWRnZShwbGVkZ2VUbyk7CgogICAgICAgIC8vIGNhbXBhaWducyBjYW4gbm90IHdpdGhkcmF3IGZ1bmRzCiAgICAgICAgaWYgKCAoY29udGV4dCA9PSBUT19PV05FUikgJiYgKHRvUGxlZGdlU3RhdGUgIT0gTGlxdWlkUGxlZGdpbmdCYXNlLlBsZWRnZVN0YXRlLlBsZWRnZWQpICkgcmV0dXJuIDA7CgogICAgICAgIC8vIElmIHRoaXMgY2FtcGFpZ24gaXMgdGhlIHByb3Bvc2VkIHJlY2lwaWVudCBvZiBkZWxlZ2F0ZWQgZnVuZHMgb3IgZnVuZHMgYXJlIGJlaW5nIGRpcmVjdGx5CiAgICAgICAgLy8gdHJhbnNmZXJyZWQgdG8gbWUsIGVuc3VyZSB0aGF0IHRoZSBjYW1wYWlnbiBoYXMgbm90IGJlZW4gY2FuY2VsZWQKICAgICAgICBpZiAoIChjb250ZXh0ID09IFRPX1BST1BPU0VEUFJPSkVDVCkKICAgICAgICAgICAgfHwgKCAoY29udGV4dCA9PSBUT19PV05FUikgJiYgKGZyb21Qcm9wb3NlZFByb2plY3QgIT0gaWRQcm9qZWN0KSApKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGlzQ2FuY2VsZWQoKSkgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gYWZ0ZXJUcmFuc2ZlcigKICAgICAgICB1aW50NjQgcGxlZGdlQWRtaW4sCiAgICAgICAgdWludDY0IHBsZWRnZUZyb20sCiAgICAgICAgdWludDY0IHBsZWRnZVRvLAogICAgICAgIHVpbnQ2NCBjb250ZXh0LAogICAgICAgIHVpbnQgYW1vdW50CiAgICApIGV4dGVybmFsIGluaXRpYWxpemVkIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MobGlxdWlkUGxlZGdpbmcpKTsKICAgICAgdmFyICgsICwgLCAsICwgLCB0b1BsZWRnZVN0YXRlKSA9IGxpcXVpZFBsZWRnaW5nLmdldFBsZWRnZShwbGVkZ2VUbyk7CiAgICAgIHZhciAoLCBmcm9tT3duZXIsICwgLCAsICwgKSA9IGxpcXVpZFBsZWRnaW5nLmdldFBsZWRnZShwbGVkZ2VGcm9tKTsKCiAgICAgIC8vIG9ubHkgaXNzdWUgdG9rZW5zIHdoZW4gcGxlZGdlIGlzIGNvbW1pdHRlZCB0byB0aGlzIGNhbXBhaWduCiAgICAgIGlmICggKGNvbnRleHQgPT0gVE9fT1dORVIpICYmCiAgICAgICAgICAgICAgKHRvUGxlZGdlU3RhdGUgPT0gTGlxdWlkUGxlZGdpbmdCYXNlLlBsZWRnZVN0YXRlLlBsZWRnZWQpKSB7CiAgICAgICAgdmFyICgsIGZyb21BZGRyICwgLCAsICwgLCAsICkgPSBsaXF1aWRQbGVkZ2luZy5nZXRQbGVkZ2VBZG1pbihmcm9tT3duZXIpOwoKICAgICAgICB0b2tlbi5nZW5lcmF0ZVRva2Vucyhmcm9tQWRkciwgYW1vdW50KTsKICAgICAgICBHZW5lcmF0ZVRva2VucyhsaXF1aWRQbGVkZ2luZywgZnJvbUFkZHIsIGFtb3VudCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYW5jZWxDYW1wYWlnbigpIHB1YmxpYyBpbml0aWFsaXplZCBvbmx5T3duZXJPclJldmlld2VyIHsKICAgICAgICByZXF1aXJlKCAhaXNDYW5jZWxlZCgpICk7CgogICAgICAgIGxpcXVpZFBsZWRnaW5nLmNhbmNlbFByb2plY3QoaWRQcm9qZWN0KTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2Zlcih1aW50NjQgaWRQbGVkZ2UsIHVpbnQgYW1vdW50LCB1aW50NjQgaWRSZWNlaXZlcikgcHVibGljIGluaXRpYWxpemVkIG9ubHlPd25lciB7CiAgICAgIHJlcXVpcmUoICFpc0NhbmNlbGVkKCkgKTsKCiAgICAgIGxpcXVpZFBsZWRnaW5nLnRyYW5zZmVyKGlkUHJvamVjdCwgaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CiAgICB9CgogICAgZnVuY3Rpb24gaXNDYW5jZWxlZCgpIHB1YmxpYyBjb25zdGFudCBpbml0aWFsaXplZCByZXR1cm5zIChib29sKSB7CiAgICAgIHJldHVybiBsaXF1aWRQbGVkZ2luZy5pc1Byb2plY3RDYW5jZWxlZChpZFByb2plY3QpOwogICAgfQoKICAgIC8vIGFsbG93cyB0aGUgb3duZXIgdG8gc2VuZCBhbnkgdHgsIHNpbWlsYXIgdG8gYSBtdWx0aS1zaWcKICAgIC8vIHRoaXMgaXMgbmVjZXNzYXJ5IGIvYyB0aGUgY2FtcGFpZ24gbWF5IHJlY2VpdmUgZGFjL2NhbXBhaWduIHRva2VucwogICAgLy8gaWYgdGhleSB0cmFuc2ZlciBhIHBsZWRnZSB0aGV5IG93biB0byBhbm90aGVyIGRhYy9jYW1wYWlnbi4KICAgIC8vIHRoaXMgYWxsb3dzIHRoZSBvd25lciB0byBwYXJ0aWNpcGF0ZSBpbiBnb3Zlcm5hbmNlIHdpdGggdGhlIHRva2VucwogICAgLy8gaXQgaG9sZHMuCiAgICBmdW5jdGlvbiBzZW5kVHJhbnNhY3Rpb24oYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcHVibGljIGluaXRpYWxpemVkIG9ubHlPd25lciB7CiAgICAgIHJlcXVpcmUoZGVzdGluYXRpb24uY2FsbC52YWx1ZSh2YWx1ZSkoZGF0YSkpOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBUb2tlbkNvbnRyb2xsZXIKLy8vLy8vLy8vLy8vLy8vLwoKICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cwogIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcHVibGljIHBheWFibGUgaW5pdGlhbGl6ZWQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgaW5pdGlhbGl6ZWQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBzcGVuZGVyIGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYyBpbml0aWFsaXplZCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0KCi8vRmlsZTogY29udHJhY3RzL0xQUENhbXBhaWduRmFjdG9yeS5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgoKCmNvbnRyYWN0IExQUENhbXBhaWduRmFjdG9yeSBpcyBFc2NhcGFibGUgewoKICAgIGZ1bmN0aW9uIExQUENhbXBhaWduRmFjdG9yeShhZGRyZXNzIF9lc2NhcGVIYXRjaENhbGxlciwgYWRkcmVzcyBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbikKICAgICAgICBFc2NhcGFibGUoX2VzY2FwZUhhdGNoQ2FsbGVyLCBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbikKICAgIHsKICAgIH0KCiAgICBmdW5jdGlvbiBkZXBsb3koCiAgICAgICAgTGlxdWlkUGxlZGdpbmcgbGlxdWlkUGxlZGdpbmcsCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50NjQgcGFyZW50UHJvamVjdCwKICAgICAgICBhZGRyZXNzIHJldmlld2VyLAogICAgICAgIHN0cmluZyB0b2tlbk5hbWUsCiAgICAgICAgc3RyaW5nIHRva2VuU3ltYm9sLAogICAgICAgIGFkZHJlc3MgZXNjYXBlSGF0Y2hDYWxsZXIsCiAgICAgICAgYWRkcmVzcyBlc2NhcGVIYXRjaERlc3RpbmF0aW9uCiAgKSB7CiAgICAgICAgTFBQQ2FtcGFpZ24gY2FtcGFpZ24gPSBuZXcgTFBQQ2FtcGFpZ24obGlxdWlkUGxlZGdpbmcsIHRva2VuTmFtZSwgdG9rZW5TeW1ib2wsIGVzY2FwZUhhdGNoQ2FsbGVyLCBlc2NhcGVIYXRjaERlc3RpbmF0aW9uKTsKICAgICAgICBjYW1wYWlnbi5pbml0KG5hbWUsIHVybCwgcGFyZW50UHJvamVjdCwgcmV2aWV3ZXIpOwogICAgICAgIGNhbXBhaWduLmNoYW5nZU93bmVyc2hpcChtc2cuc2VuZGVyKTsKICAgIH0KfQ=='.
	

]
