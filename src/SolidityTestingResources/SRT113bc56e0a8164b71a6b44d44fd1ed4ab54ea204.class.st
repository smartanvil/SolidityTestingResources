Class {
	#name : #SRT113bc56e0a8164b71a6b44d44fd1ed4ab54ea204,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT113bc56e0a8164b71a6b44d44fd1ed4ab54ea204 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjE7CgovLyBGaWxlOiBjb250cmFjdHMvRGF0ZVRpbWUuc29sCgpjb250cmFjdCBEYXRlVGltZSB7CiAgICAgICAgLyoKICAgICAgICAgKiAgRGF0ZSBhbmQgVGltZSB1dGlsaXRpZXMgZm9yIGV0aGVyZXVtIGNvbnRyYWN0cwogICAgICAgICAqCiAgICAgICAgICovCiAgICAgICAgc3RydWN0IF9EYXRlVGltZSB7CiAgICAgICAgICAgICAgICB1aW50MTYgeWVhcjsKICAgICAgICAgICAgICAgIHVpbnQ4IG1vbnRoOwogICAgICAgICAgICAgICAgdWludDggZGF5OwogICAgICAgICAgICAgICAgdWludDggaG91cjsKICAgICAgICAgICAgICAgIHVpbnQ4IG1pbnV0ZTsKICAgICAgICAgICAgICAgIHVpbnQ4IHNlY29uZDsKICAgICAgICAgICAgICAgIHVpbnQ4IHdlZWtkYXk7CiAgICAgICAgfQoKICAgICAgICB1aW50IGNvbnN0YW50IERBWV9JTl9TRUNPTkRTID0gODY0MDA7CiAgICAgICAgdWludCBjb25zdGFudCBZRUFSX0lOX1NFQ09ORFMgPSAzMTUzNjAwMDsKICAgICAgICB1aW50IGNvbnN0YW50IExFQVBfWUVBUl9JTl9TRUNPTkRTID0gMzE2MjI0MDA7CgogICAgICAgIHVpbnQgY29uc3RhbnQgSE9VUl9JTl9TRUNPTkRTID0gMzYwMDsKICAgICAgICB1aW50IGNvbnN0YW50IE1JTlVURV9JTl9TRUNPTkRTID0gNjA7CgogICAgICAgIHVpbnQxNiBjb25zdGFudCBPUklHSU5fWUVBUiA9IDE5NzA7CgogICAgICAgIGZ1bmN0aW9uIGlzTGVhcFllYXIodWludDE2IHllYXIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgICAgICAgIGlmICh5ZWFyICUgNCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh5ZWFyICUgMTAwICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoeWVhciAlIDQwMCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbGVhcFllYXJzQmVmb3JlKHVpbnQgeWVhcikgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgICAgICAgICAgeWVhciAtPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIHllYXIgLyA0IC0geWVhciAvIDEwMCArIHllYXIgLyA0MDA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXREYXlzSW5Nb250aCh1aW50OCBtb250aCwgdWludDE2IHllYXIpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICBpZiAobW9udGggPT0gMSB8fCBtb250aCA9PSAzIHx8IG1vbnRoID09IDUgfHwgbW9udGggPT0gNyB8fCBtb250aCA9PSA4IHx8IG1vbnRoID09IDEwIHx8IG1vbnRoID09IDEyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1vbnRoID09IDQgfHwgbW9udGggPT0gNiB8fCBtb250aCA9PSA5IHx8IG1vbnRoID09IDExKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzTGVhcFllYXIoeWVhcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyODsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHBhcnNlVGltZXN0YW1wKHVpbnQgdGltZXN0YW1wKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKF9EYXRlVGltZSBkdCkgewogICAgICAgICAgICAgICAgdWludCBzZWNvbmRzQWNjb3VudGVkRm9yID0gMDsKICAgICAgICAgICAgICAgIHVpbnQgYnVmOwogICAgICAgICAgICAgICAgdWludDggaTsKCiAgICAgICAgICAgICAgICAvLyBZZWFyCiAgICAgICAgICAgICAgICBkdC55ZWFyID0gZ2V0WWVhcih0aW1lc3RhbXApOwogICAgICAgICAgICAgICAgYnVmID0gbGVhcFllYXJzQmVmb3JlKGR0LnllYXIpIC0gbGVhcFllYXJzQmVmb3JlKE9SSUdJTl9ZRUFSKTsKCiAgICAgICAgICAgICAgICBzZWNvbmRzQWNjb3VudGVkRm9yICs9IExFQVBfWUVBUl9JTl9TRUNPTkRTICogYnVmOwogICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBZRUFSX0lOX1NFQ09ORFMgKiAoZHQueWVhciAtIE9SSUdJTl9ZRUFSIC0gYnVmKTsKCiAgICAgICAgICAgICAgICAvLyBNb250aAogICAgICAgICAgICAgICAgdWludCBzZWNvbmRzSW5Nb250aDsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gMTI7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzSW5Nb250aCA9IERBWV9JTl9TRUNPTkRTICogZ2V0RGF5c0luTW9udGgoaSwgZHQueWVhcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRzSW5Nb250aCArIHNlY29uZHNBY2NvdW50ZWRGb3IgPiB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdC5tb250aCA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBzZWNvbmRzSW5Nb250aDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBEYXkKICAgICAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gZ2V0RGF5c0luTW9udGgoZHQubW9udGgsIGR0LnllYXIpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKERBWV9JTl9TRUNPTkRTICsgc2Vjb25kc0FjY291bnRlZEZvciA+IHRpbWVzdGFtcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR0LmRheSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBEQVlfSU5fU0VDT05EUzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBIb3VyCiAgICAgICAgICAgICAgICBkdC5ob3VyID0gZ2V0SG91cih0aW1lc3RhbXApOwoKICAgICAgICAgICAgICAgIC8vIE1pbnV0ZQogICAgICAgICAgICAgICAgZHQubWludXRlID0gZ2V0TWludXRlKHRpbWVzdGFtcCk7CgogICAgICAgICAgICAgICAgLy8gU2Vjb25kCiAgICAgICAgICAgICAgICBkdC5zZWNvbmQgPSBnZXRTZWNvbmQodGltZXN0YW1wKTsKCiAgICAgICAgICAgICAgICAvLyBEYXkgb2Ygd2Vlay4KICAgICAgICAgICAgICAgIGR0LndlZWtkYXkgPSBnZXRXZWVrZGF5KHRpbWVzdGFtcCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRZZWFyKHVpbnQgdGltZXN0YW1wKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MTYpIHsKICAgICAgICAgICAgICAgIHVpbnQgc2Vjb25kc0FjY291bnRlZEZvciA9IDA7CiAgICAgICAgICAgICAgICB1aW50MTYgeWVhcjsKICAgICAgICAgICAgICAgIHVpbnQgbnVtTGVhcFllYXJzOwoKICAgICAgICAgICAgICAgIC8vIFllYXIKICAgICAgICAgICAgICAgIHllYXIgPSB1aW50MTYoT1JJR0lOX1lFQVIgKyB0aW1lc3RhbXAgLyBZRUFSX0lOX1NFQ09ORFMpOwogICAgICAgICAgICAgICAgbnVtTGVhcFllYXJzID0gbGVhcFllYXJzQmVmb3JlKHllYXIpIC0gbGVhcFllYXJzQmVmb3JlKE9SSUdJTl9ZRUFSKTsKCiAgICAgICAgICAgICAgICBzZWNvbmRzQWNjb3VudGVkRm9yICs9IExFQVBfWUVBUl9JTl9TRUNPTkRTICogbnVtTGVhcFllYXJzOwogICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBZRUFSX0lOX1NFQ09ORFMgKiAoeWVhciAtIE9SSUdJTl9ZRUFSIC0gbnVtTGVhcFllYXJzKTsKCiAgICAgICAgICAgICAgICB3aGlsZSAoc2Vjb25kc0FjY291bnRlZEZvciA+IHRpbWVzdGFtcCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNMZWFwWWVhcih1aW50MTYoeWVhciAtIDEpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgLT0gTEVBUF9ZRUFSX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciAtPSBZRUFSX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgeWVhciAtPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHllYXI7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRNb250aCh1aW50IHRpbWVzdGFtcCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZVRpbWVzdGFtcCh0aW1lc3RhbXApLm1vbnRoOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0RGF5KHVpbnQgdGltZXN0YW1wKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlVGltZXN0YW1wKHRpbWVzdGFtcCkuZGF5OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0SG91cih1aW50IHRpbWVzdGFtcCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1aW50OCgodGltZXN0YW1wIC8gNjAgLyA2MCkgJSAyNCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRNaW51dGUodWludCB0aW1lc3RhbXApIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdWludDgoKHRpbWVzdGFtcCAvIDYwKSAlIDYwKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldFNlY29uZCh1aW50IHRpbWVzdGFtcCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1aW50OCh0aW1lc3RhbXAgJSA2MCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRXZWVrZGF5KHVpbnQgdGltZXN0YW1wKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVpbnQ4KCh0aW1lc3RhbXAgLyBEQVlfSU5fU0VDT05EUyArIDQpICUgNyk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b1RpbWVzdGFtcCh1aW50MTYgeWVhciwgdWludDggbW9udGgsIHVpbnQ4IGRheSkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b1RpbWVzdGFtcCh5ZWFyLCBtb250aCwgZGF5LCAwLCAwLCAwKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRvVGltZXN0YW1wKHVpbnQxNiB5ZWFyLCB1aW50OCBtb250aCwgdWludDggZGF5LCB1aW50OCBob3VyKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50IHRpbWVzdGFtcCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRvVGltZXN0YW1wKHllYXIsIG1vbnRoLCBkYXksIGhvdXIsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdG9UaW1lc3RhbXAodWludDE2IHllYXIsIHVpbnQ4IG1vbnRoLCB1aW50OCBkYXksIHVpbnQ4IGhvdXIsIHVpbnQ4IG1pbnV0ZSkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b1RpbWVzdGFtcCh5ZWFyLCBtb250aCwgZGF5LCBob3VyLCBtaW51dGUsIDApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdG9UaW1lc3RhbXAodWludDE2IHllYXIsIHVpbnQ4IG1vbnRoLCB1aW50OCBkYXksIHVpbnQ4IGhvdXIsIHVpbnQ4IG1pbnV0ZSwgdWludDggc2Vjb25kKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50IHRpbWVzdGFtcCkgewogICAgICAgICAgICAgICAgdWludDE2IGk7CgogICAgICAgICAgICAgICAgLy8gWWVhcgogICAgICAgICAgICAgICAgZm9yIChpID0gT1JJR0lOX1lFQVI7IGkgPCB5ZWFyOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGVhcFllYXIoaSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAgKz0gTEVBUF9ZRUFSX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IFlFQVJfSU5fU0VDT05EUzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIE1vbnRoCiAgICAgICAgICAgICAgICB1aW50OFsxMl0gbWVtb3J5IG1vbnRoRGF5Q291bnRzOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbMF0gPSAzMTsKICAgICAgICAgICAgICAgIGlmIChpc0xlYXBZZWFyKHllYXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzFdID0gMjk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbMV0gPSAyODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzJdID0gMzE7CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1szXSA9IDMwOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbNF0gPSAzMTsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzVdID0gMzA7CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1s2XSA9IDMxOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbN10gPSAzMTsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzhdID0gMzA7CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1s5XSA9IDMxOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbMTBdID0gMzA7CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1sxMV0gPSAzMTsKCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgbW9udGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAgKz0gREFZX0lOX1NFQ09ORFMgKiBtb250aERheUNvdW50c1tpIC0gMV07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRGF5CiAgICAgICAgICAgICAgICB0aW1lc3RhbXAgKz0gREFZX0lOX1NFQ09ORFMgKiAoZGF5IC0gMSk7CgogICAgICAgICAgICAgICAgLy8gSG91cgogICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IEhPVVJfSU5fU0VDT05EUyAqIChob3VyKTsKCiAgICAgICAgICAgICAgICAvLyBNaW51dGUKICAgICAgICAgICAgICAgIHRpbWVzdGFtcCArPSBNSU5VVEVfSU5fU0VDT05EUyAqIChtaW51dGUpOwoKICAgICAgICAgICAgICAgIC8vIFNlY29uZAogICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IHNlY29uZDsKCiAgICAgICAgICAgICAgICByZXR1cm4gdGltZXN0YW1wOwogICAgICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0lTaW1wbGVDcm93ZHNhbGUuc29sCgppbnRlcmZhY2UgSVNpbXBsZUNyb3dkc2FsZSB7CiAgICBmdW5jdGlvbiBnZXRTb2Z0Q2FwKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gaXNDb250cmlidXRvckluTGlzdHMoYWRkcmVzcyBjb250cmlidXRvckFkZHJlc3MpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhib29sKTsKICAgIGZ1bmN0aW9uIHByb2Nlc3NSZXNlcnZhdGlvbkZ1bmRDb250cmlidXRpb24oCiAgICAgICAgYWRkcmVzcyBjb250cmlidXRvciwKICAgICAgICB1aW50MjU2IHRva2VuQW1vdW50LAogICAgICAgIHVpbnQyNTYgdG9rZW5Cb251c0Ftb3VudAogICAgKSBleHRlcm5hbCBwYXlhYmxlOwp9CgovLyBGaWxlOiBjb250cmFjdHMvZnVuZC9JQ3Jvd2RzYWxlRnVuZC5zb2wKCi8qKgogKiBAdGl0bGUgSUNyb3dkc2FsZUZ1bmQKICogQGRldiBGdW5kIG1ldGhvZHMgdXNlZCBieSBjcm93ZHNhbGUgY29udHJhY3QKICovCmludGVyZmFjZSBJQ3Jvd2RzYWxlRnVuZCB7CiAgICAvKioKICAgICogQGRldiBGdW5jdGlvbiBhY2NlcHRzIHVzZXJgcyBjb250cmlidXRlZCBldGhlciBhbmQgbG9ncyBjb250cmlidXRpb24KICAgICogQHBhcmFtIGNvbnRyaWJ1dG9yIENvbnRyaWJ1dG9yIHdhbGxldCBhZGRyZXNzLgogICAgKi8KICAgIGZ1bmN0aW9uIHByb2Nlc3NDb250cmlidXRpb24oYWRkcmVzcyBjb250cmlidXRvcikgZXh0ZXJuYWwgcGF5YWJsZTsKICAgIC8qKgogICAgKiBAZGV2IEZ1bmN0aW9uIGlzIGNhbGxlZCBvbiB0aGUgZW5kIG9mIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlCiAgICAqLwogICAgZnVuY3Rpb24gb25Dcm93ZHNhbGVFbmQoKSBleHRlcm5hbDsKICAgIC8qKgogICAgKiBAZGV2IEZ1bmN0aW9uIGlzIGNhbGxlZCBpZiBjcm93ZHNhbGUgZmFpbGVkIHRvIHJlYWNoIHNvZnQgY2FwCiAgICAqLwogICAgZnVuY3Rpb24gZW5hYmxlQ3Jvd2RzYWxlUmVmdW5kKCkgZXh0ZXJuYWw7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9tYXRoL1NhZmVNYXRoLnNvbAoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KY29udHJhY3QgU2FmZU1hdGggewogICAgLyoqCiAgICAqIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBTYWZlTWF0aCgpIHB1YmxpYyB7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYSA+PSBiKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9vd25lcnNoaXAvTXVsdGlPd25hYmxlLnNvbAoKLyoqCiAqIEB0aXRsZSBNdWx0aU93bmFibGUKICogQGRldiBUaGUgTXVsdGlPd25hYmxlIGNvbnRyYWN0IGhhcyBvd25lcnMgYWRkcmVzc2VzIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VycyBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBNdWx0aU93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgbWFuYWdlcjsgLy8gYWRkcmVzcyB1c2VkIHRvIHNldCBvd25lcnMKICAgIGFkZHJlc3NbXSBwdWJsaWMgb3duZXJzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBvd25lckJ5QWRkcmVzczsKCiAgICBldmVudCBTZXRPd25lcnMoYWRkcmVzc1tdIG93bmVycyk7CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUob3duZXJCeUFkZHJlc3NbbXNnLnNlbmRlcl0gPT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTXVsdGlPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG1hbmFnZXIKICAgICAqLwogICAgZnVuY3Rpb24gTXVsdGlPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBtYW5hZ2VyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRnVuY3Rpb24gdG8gc2V0IG93bmVycyBhZGRyZXNzZXMKICAgICAqLwogICAgZnVuY3Rpb24gc2V0T3duZXJzKGFkZHJlc3NbXSBfb3duZXJzKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtYW5hZ2VyKTsKICAgICAgICBfc2V0T3duZXJzKF9vd25lcnMpOwoKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0T3duZXJzKGFkZHJlc3NbXSBfb3duZXJzKSBpbnRlcm5hbCB7CiAgICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBvd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgb3duZXJCeUFkZHJlc3Nbb3duZXJzW2ldXSA9IGZhbHNlOwogICAgICAgIH0KCgogICAgICAgIGZvcih1aW50MjU2IGogPSAwOyBqIDwgX293bmVycy5sZW5ndGg7IGorKykgewogICAgICAgICAgICBvd25lckJ5QWRkcmVzc1tfb3duZXJzW2pdXSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIG93bmVycyA9IF9vd25lcnM7CiAgICAgICAgU2V0T3duZXJzKF9vd25lcnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE93bmVycygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gb3duZXJzOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvdG9rZW4vSUVSQzIwVG9rZW4uc29sCgovKioKICogQHRpdGxlIElFUkMyMFRva2VuIC0gRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgSUVSQzIwVG9rZW4gewogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSAgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSAgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSAgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpICBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy90b2tlbi9FUkMyMFRva2VuLnNvbAoKLyoqCiAqIEB0aXRsZSBFUkMyMFRva2VuIC0gRVJDMjAgYmFzZSBpbXBsZW1lbnRhdGlvbgogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwVG9rZW4gaXMgSUVSQzIwVG9rZW4sIFNhZmVNYXRoIHsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBwdWJsaWMgYWxsb3dlZDsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKCiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvdG9rZW4vSVRva2VuRXZlbnRMaXN0ZW5lci5zb2wKCi8qKgogKiBAdGl0bGUgSVRva2VuRXZlbnRMaXN0ZW5lcgogKiBAZGV2IEludGVyZmFjZSB3aGljaCBzaG91bGQgYmUgaW1wbGVtZW50ZWQgYnkgdG9rZW4gbGlzdGVuZXIKICovCmludGVyZmFjZSBJVG9rZW5FdmVudExpc3RlbmVyIHsKICAgIC8qKgogICAgICogQGRldiBGdW5jdGlvbiBpcyBjYWxsZWQgYWZ0ZXIgdG9rZW4gdHJhbnNmZXIvdHJhbnNmZXJGcm9tCiAgICAgKiBAcGFyYW0gX2Zyb20gU2VuZGVyIGFkZHJlc3MKICAgICAqIEBwYXJhbSBfdG8gUmVjZWl2ZXIgYWRkcmVzcwogICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIG9uVG9rZW5UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYzsKfQoKLy8gRmlsZTogY29udHJhY3RzL3Rva2VuL01hbmFnZWRUb2tlbi5zb2wKCi8qKgogKiBAdGl0bGUgTWFuYWdlZFRva2VuCiAqIEBkZXYgRVJDMjAgY29tcGF0aWJsZSB0b2tlbiB3aXRoIGlzc3VlIGFuZCBkZXN0cm95IGZhY2lsaXRpZXMKICogQGRldiBBbGwgdHJhbnNmZXJzIGNhbiBiZSBtb25pdG9yZWQgYnkgdG9rZW4gZXZlbnQgbGlzdGVuZXIKICovCmNvbnRyYWN0IE1hbmFnZWRUb2tlbiBpcyBFUkMyMFRva2VuLCBNdWx0aU93bmFibGUgewogICAgYm9vbCBwdWJsaWMgYWxsb3dUcmFuc2ZlcnMgPSBmYWxzZTsKICAgIGJvb2wgcHVibGljIGlzc3VhbmNlRmluaXNoZWQgPSBmYWxzZTsKCiAgICBJVG9rZW5FdmVudExpc3RlbmVyIHB1YmxpYyBldmVudExpc3RlbmVyOwoKICAgIGV2ZW50IEFsbG93VHJhbnNmZXJzQ2hhbmdlZChib29sIF9uZXdTdGF0ZSk7CiAgICBldmVudCBJc3N1ZShhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBEZXN0cm95KGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgSXNzdWFuY2VGaW5pc2hlZCgpOwoKICAgIG1vZGlmaWVyIHRyYW5zZmVyc0FsbG93ZWQoKSB7CiAgICAgICAgcmVxdWlyZShhbGxvd1RyYW5zZmVycyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBjYW5Jc3N1ZSgpIHsKICAgICAgICByZXF1aXJlKCFpc3N1YW5jZUZpbmlzaGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBNYW5hZ2VkVG9rZW4gY29uc3RydWN0b3IKICAgICAqIEBwYXJhbSBfbGlzdGVuZXIgVG9rZW4gbGlzdGVuZXIoYWRkcmVzcyBjYW4gYmUgMHgwKQogICAgICogQHBhcmFtIF9vd25lcnMgT3duZXJzIGxpc3QKICAgICAqLwogICAgZnVuY3Rpb24gTWFuYWdlZFRva2VuKGFkZHJlc3MgX2xpc3RlbmVyLCBhZGRyZXNzW10gX293bmVycykgcHVibGljIHsKICAgICAgICBpZihfbGlzdGVuZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBldmVudExpc3RlbmVyID0gSVRva2VuRXZlbnRMaXN0ZW5lcihfbGlzdGVuZXIpOwogICAgICAgIH0KICAgICAgICBfc2V0T3duZXJzKF9vd25lcnMpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBFbmFibGUvZGlzYWJsZSB0b2tlbiB0cmFuc2ZlcnMuIENhbiBiZSBjYWxsZWQgb25seSBieSBvd25lcnMKICAgICAqIEBwYXJhbSBfYWxsb3dUcmFuc2ZlcnMgVHJ1ZSAtIGFsbG93IEZhbHNlIC0gZGlzYWJsZQogICAgICovCiAgICBmdW5jdGlvbiBzZXRBbGxvd1RyYW5zZmVycyhib29sIF9hbGxvd1RyYW5zZmVycykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhbGxvd1RyYW5zZmVycyA9IF9hbGxvd1RyYW5zZmVyczsKICAgICAgICBBbGxvd1RyYW5zZmVyc0NoYW5nZWQoX2FsbG93VHJhbnNmZXJzKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0L3JlbW92ZSB0b2tlbiBldmVudCBsaXN0ZW5lcgogICAgICogQHBhcmFtIF9saXN0ZW5lciBMaXN0ZW5lciBhZGRyZXNzIChDb250cmFjdCBtdXN0IGltcGxlbWVudCBJVG9rZW5FdmVudExpc3RlbmVyIGludGVyZmFjZSkKICAgICAqLwogICAgZnVuY3Rpb24gc2V0TGlzdGVuZXIoYWRkcmVzcyBfbGlzdGVuZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmKF9saXN0ZW5lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGV2ZW50TGlzdGVuZXIgPSBJVG9rZW5FdmVudExpc3RlbmVyKF9saXN0ZW5lcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVsZXRlIGV2ZW50TGlzdGVuZXI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHRyYW5zZmVyc0FsbG93ZWQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc3VjY2VzcyA9IHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgICAgICBpZihoYXNMaXN0ZW5lcigpICYmIHN1Y2Nlc3MpIHsKICAgICAgICAgICAgZXZlbnRMaXN0ZW5lci5vblRva2VuVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VjY2VzczsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgdHJhbnNmZXJzQWxsb3dlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCBzdWNjZXNzID0gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgaWYoaGFzTGlzdGVuZXIoKSAmJiBzdWNjZXNzKSB7CiAgICAgICAgICAgIGV2ZW50TGlzdGVuZXIub25Ub2tlblRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdWNjZXNzOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc0xpc3RlbmVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZihldmVudExpc3RlbmVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSXNzdWUgdG9rZW5zIHRvIHNwZWNpZmllZCB3YWxsZXQKICAgICAqIEBwYXJhbSBfdG8gV2FsbGV0IGFkZHJlc3MKICAgICAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGV4dGVybmFsIG9ubHlPd25lciBjYW5Jc3N1ZSB7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgSXNzdWUoX3RvLCBfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRGVzdHJveSB0b2tlbnMgb24gc3BlY2lmaWVkIGFkZHJlc3MgKENhbGxlZCBieSBvd25lciBvciB0b2tlbiBob2xkZXIpCiAgICAgKiBAZGV2IEZ1bmQgY29udHJhY3QgYWRkcmVzcyBtdXN0IGJlIGluIHRoZSBsaXN0IG9mIG93bmVycyB0byBidXJuIHRva2VuIGR1cmluZyByZWZ1bmQKICAgICAqIEBwYXJhbSBfZnJvbSBXYWxsZXQgYWRkcmVzcwogICAgICogQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRvIGRlc3Ryb3kKICAgICAqLwogICAgZnVuY3Rpb24gZGVzdHJveShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUob3duZXJCeUFkZHJlc3NbbXNnLnNlbmRlcl0gfHwgbXNnLnNlbmRlciA9PSBfZnJvbSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIGFkZHJlc3MoMCksIF92YWx1ZSk7CiAgICAgICAgRGVzdHJveShfZnJvbSwgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSW5jcmVhc2UgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgICAqCiAgICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICAgKiBGcm9tIE9wZW5aZXBwZWxpbiBTdGFuZGFyZFRva2VuLnNvbAogICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IHNhZmVBZGQoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0sIF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgICoKICAgICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGRlY3JlbWVudAogICAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgICAqIEZyb20gT3BlblplcHBlbGluIFN0YW5kYXJkVG9rZW4uc29sCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAgKiBAcGFyYW0gX3N1YnRyYWN0ZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBkZWNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAgICovCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBzYWZlU3ViKG9sZFZhbHVlLCBfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmluaXNoIHRva2VuIGlzc3VhbmNlCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgc3VjY2VzcwogICAgICovCiAgICBmdW5jdGlvbiBmaW5pc2hJc3N1YW5jZSgpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlzc3VhbmNlRmluaXNoZWQgPSB0cnVlOwogICAgICAgIElzc3VhbmNlRmluaXNoZWQoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0Z1bmQuc29sCgpjb250cmFjdCBGdW5kIGlzIElDcm93ZHNhbGVGdW5kLCBTYWZlTWF0aCwgTXVsdGlPd25hYmxlIHsKICAgIGVudW0gRnVuZFN0YXRlIHsKICAgICAgICBDcm93ZHNhbGUsCiAgICAgICAgQ3Jvd2RzYWxlUmVmdW5kLAogICAgICAgIFRlYW1XaXRoZHJhdywKICAgICAgICBSZWZ1bmQKICAgIH0KCiAgICBGdW5kU3RhdGUgcHVibGljIHN0YXRlID0gRnVuZFN0YXRlLkNyb3dkc2FsZTsKICAgIE1hbmFnZWRUb2tlbiBwdWJsaWMgdG9rZW47CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgSU5JVElBTF9UQVAgPSAxOTI5MDEyMzQ1Njc5MDE7IC8vICh3ZWkvc2VjKSA9PSA1MDAgZXRoZXIvbW9udGgKCiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtV2FsbGV0OwogICAgdWludDI1NiBwdWJsaWMgY3Jvd2RzYWxlRW5kRGF0ZTsKCiAgICBhZGRyZXNzIHB1YmxpYyByZWZlcnJhbFRva2VuV2FsbGV0OwogICAgYWRkcmVzcyBwdWJsaWMgZm91bmRhdGlvblRva2VuV2FsbGV0OwogICAgYWRkcmVzcyBwdWJsaWMgcmVzZXJ2ZVRva2VuV2FsbGV0OwogICAgYWRkcmVzcyBwdWJsaWMgYm91bnR5VG9rZW5XYWxsZXQ7CiAgICBhZGRyZXNzIHB1YmxpYyBjb21wYW55VG9rZW5XYWxsZXQ7CiAgICBhZGRyZXNzIHB1YmxpYyBhZHZpc29yVG9rZW5XYWxsZXQ7CgogICAgdWludDI1NiBwdWJsaWMgdGFwOwogICAgdWludDI1NiBwdWJsaWMgbGFzdFdpdGhkcmF3VGltZSA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyBmaXJzdFdpdGhkcmF3QW1vdW50ID0gMDsKCiAgICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGVBZGRyZXNzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjb250cmlidXRpb25zOwoKICAgIGV2ZW50IFJlZnVuZENvbnRyaWJ1dG9yKGFkZHJlc3MgdG9rZW5Ib2xkZXIsIHVpbnQyNTYgYW1vdW50V2VpLCB1aW50MjU2IHRpbWVzdGFtcCk7CiAgICBldmVudCBSZWZ1bmRIb2xkZXIoYWRkcmVzcyB0b2tlbkhvbGRlciwgdWludDI1NiBhbW91bnRXZWksIHVpbnQyNTYgdG9rZW5BbW91bnQsIHVpbnQyNTYgdGltZXN0YW1wKTsKICAgIGV2ZW50IFdpdGhkcmF3KHVpbnQyNTYgYW1vdW50V2VpLCB1aW50MjU2IHRpbWVzdGFtcCk7CiAgICBldmVudCBSZWZ1bmRFbmFibGVkKGFkZHJlc3MgaW5pdGlhdG9yQWRkcmVzcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IEZ1bmQgY29uc3RydWN0b3IKICAgICAqIEBwYXJhbSBfdGVhbVdhbGxldCBXaXRoZHJhdyBmdW5jdGlvbnMgdHJhbnNmZXJzIGV0aGVyIHRvIHRoaXMgYWRkcmVzcwogICAgICogQHBhcmFtIF9yZWZlcnJhbFRva2VuV2FsbGV0IFJlZmVycmFsIHdhbGxldCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX2NvbXBhbnlUb2tlbldhbGxldCBDb21wYW55IHdhbGxldCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX3Jlc2VydmVUb2tlbldhbGxldCBSZXNlcnZlIHdhbGxldCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX2JvdW50eVRva2VuV2FsbGV0IEJvdW50eSB3YWxsZXQgYWRkcmVzcwogICAgICogQHBhcmFtIF9hZHZpc29yVG9rZW5XYWxsZXQgQWR2aXNvciB3YWxsZXQgYWRkcmVzcwogICAgICogQHBhcmFtIF9vd25lcnMgQ29udHJhY3Qgb3duZXJzCiAgICAgKi8KICAgIGZ1bmN0aW9uIEZ1bmQoCiAgICAgICAgYWRkcmVzcyBfdGVhbVdhbGxldCwKICAgICAgICBhZGRyZXNzIF9yZWZlcnJhbFRva2VuV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2ZvdW5kYXRpb25Ub2tlbldhbGxldCwKICAgICAgICBhZGRyZXNzIF9jb21wYW55VG9rZW5XYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfcmVzZXJ2ZVRva2VuV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2JvdW50eVRva2VuV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2Fkdmlzb3JUb2tlbldhbGxldCwKICAgICAgICBhZGRyZXNzW10gX293bmVycwogICAgKSBwdWJsaWMKICAgIHsKICAgICAgICB0ZWFtV2FsbGV0ID0gX3RlYW1XYWxsZXQ7CiAgICAgICAgcmVmZXJyYWxUb2tlbldhbGxldCA9IF9yZWZlcnJhbFRva2VuV2FsbGV0OwogICAgICAgIGZvdW5kYXRpb25Ub2tlbldhbGxldCA9IF9mb3VuZGF0aW9uVG9rZW5XYWxsZXQ7CiAgICAgICAgY29tcGFueVRva2VuV2FsbGV0ID0gX2NvbXBhbnlUb2tlbldhbGxldDsKICAgICAgICByZXNlcnZlVG9rZW5XYWxsZXQgPSBfcmVzZXJ2ZVRva2VuV2FsbGV0OwogICAgICAgIGJvdW50eVRva2VuV2FsbGV0ID0gX2JvdW50eVRva2VuV2FsbGV0OwogICAgICAgIGFkdmlzb3JUb2tlbldhbGxldCA9IF9hZHZpc29yVG9rZW5XYWxsZXQ7CiAgICAgICAgX3NldE93bmVycyhfb3duZXJzKTsKICAgIH0KCiAgICBtb2RpZmllciB3aXRoZHJhd0VuYWJsZWQoKSB7CiAgICAgICAgcmVxdWlyZShjYW5XaXRoZHJhdygpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDcm93ZHNhbGUoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyb3dkc2FsZUFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gY2FuV2l0aGRyYXcoKSBwdWJsaWMgcmV0dXJucyhib29sKTsKCiAgICBmdW5jdGlvbiBzZXRDcm93ZHNhbGVBZGRyZXNzKGFkZHJlc3MgX2Nyb3dkc2FsZUFkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoY3Jvd2RzYWxlQWRkcmVzcyA9PSBhZGRyZXNzKDApKTsKICAgICAgICBjcm93ZHNhbGVBZGRyZXNzID0gX2Nyb3dkc2FsZUFkZHJlc3M7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VG9rZW5BZGRyZXNzKGFkZHJlc3MgX3Rva2VuQWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKHRva2VuKSA9PSBhZGRyZXNzKDApKTsKICAgICAgICB0b2tlbiA9IE1hbmFnZWRUb2tlbihfdG9rZW5BZGRyZXNzKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUHJvY2VzcyBjcm93ZHNhbGUgY29udHJpYnV0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb2Nlc3NDb250cmlidXRpb24oYWRkcmVzcyBjb250cmlidXRvcikgZXh0ZXJuYWwgcGF5YWJsZSBvbmx5Q3Jvd2RzYWxlIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IEZ1bmRTdGF0ZS5Dcm93ZHNhbGUpOwogICAgICAgIHVpbnQyNTYgdG90YWxDb250cmlidXRpb24gPSBzYWZlQWRkKGNvbnRyaWJ1dGlvbnNbY29udHJpYnV0b3JdLCBtc2cudmFsdWUpOwogICAgICAgIGNvbnRyaWJ1dGlvbnNbY29udHJpYnV0b3JdID0gdG90YWxDb250cmlidXRpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbGxiYWNrIGlzIGNhbGxlZCBhZnRlciBjcm93ZHNhbGUgZmluYWxpemF0aW9uIGlmIHNvZnQgY2FwIGlzIHJlYWNoZWQKICAgICAqLwogICAgZnVuY3Rpb24gb25Dcm93ZHNhbGVFbmQoKSBleHRlcm5hbCBvbmx5Q3Jvd2RzYWxlIHsKICAgICAgICBzdGF0ZSA9IEZ1bmRTdGF0ZS5UZWFtV2l0aGRyYXc7CiAgICAgICAgSVNpbXBsZUNyb3dkc2FsZSBjcm93ZHNhbGUgPSBJU2ltcGxlQ3Jvd2RzYWxlKGNyb3dkc2FsZUFkZHJlc3MpOwogICAgICAgIGZpcnN0V2l0aGRyYXdBbW91bnQgPSBzYWZlRGl2KGNyb3dkc2FsZS5nZXRTb2Z0Q2FwKCksIDIpOwogICAgICAgIGxhc3RXaXRoZHJhd1RpbWUgPSBub3c7CiAgICAgICAgdGFwID0gSU5JVElBTF9UQVA7CiAgICAgICAgY3Jvd2RzYWxlRW5kRGF0ZSA9IG5vdzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2FsbGJhY2sgaXMgY2FsbGVkIGFmdGVyIGNyb3dkc2FsZSBmaW5hbGl6YXRpb24gaWYgc29mdCBjYXAgaXMgbm90IHJlYWNoZWQKICAgICAqLwogICAgZnVuY3Rpb24gZW5hYmxlQ3Jvd2RzYWxlUmVmdW5kKCkgZXh0ZXJuYWwgb25seUNyb3dkc2FsZSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBGdW5kU3RhdGUuQ3Jvd2RzYWxlKTsKICAgICAgICBzdGF0ZSA9IEZ1bmRTdGF0ZS5Dcm93ZHNhbGVSZWZ1bmQ7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgRnVuY3Rpb24gaXMgY2FsbGVkIGJ5IGNvbnRyaWJ1dG9yIHRvIHJlZnVuZCBwYXltZW50cyBpZiBjcm93ZHNhbGUgZmFpbGVkIHRvIHJlYWNoIHNvZnQgY2FwCiAgICAqLwogICAgZnVuY3Rpb24gcmVmdW5kQ3Jvd2RzYWxlQ29udHJpYnV0b3IoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBGdW5kU3RhdGUuQ3Jvd2RzYWxlUmVmdW5kKTsKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dGlvbnNbbXNnLnNlbmRlcl0gPiAwKTsKCiAgICAgICAgdWludDI1NiByZWZ1bmRBbW91bnQgPSBjb250cmlidXRpb25zW21zZy5zZW5kZXJdOwogICAgICAgIGNvbnRyaWJ1dGlvbnNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIHRva2VuLmRlc3Ryb3kobXNnLnNlbmRlciwgdG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIpKTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZnVuZEFtb3VudCk7CiAgICAgICAgUmVmdW5kQ29udHJpYnV0b3IobXNnLnNlbmRlciwgcmVmdW5kQW1vdW50LCBub3cpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWNyZWFzZSB0YXAgYW1vdW50CiAgICAgKiBAcGFyYW0gX3RhcCBOZXcgdGFwIHZhbHVlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlY1RhcCh1aW50MjU2IF90YXApIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBGdW5kU3RhdGUuVGVhbVdpdGhkcmF3KTsKICAgICAgICByZXF1aXJlKF90YXAgPCB0YXApOwogICAgICAgIHRhcCA9IF90YXA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFRhcEFtb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICBpZihzdGF0ZSAhPSBGdW5kU3RhdGUuVGVhbVdpdGhkcmF3KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsY1RhcEFtb3VudCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNUYXBBbW91bnQoKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gc2FmZU11bChzYWZlU3ViKG5vdywgbGFzdFdpdGhkcmF3VGltZSksIHRhcCk7CiAgICAgICAgaWYoYWRkcmVzcyh0aGlzKS5iYWxhbmNlIDwgYW1vdW50KSB7CiAgICAgICAgICAgIGFtb3VudCA9IGFkZHJlc3ModGhpcykuYmFsYW5jZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBmaXJzdFdpdGhkcmF3KCkgcHVibGljIG9ubHlPd25lciB3aXRoZHJhd0VuYWJsZWQgewogICAgICAgIHJlcXVpcmUoZmlyc3RXaXRoZHJhd0Ftb3VudCA+IDApOwogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gZmlyc3RXaXRoZHJhd0Ftb3VudDsKICAgICAgICBmaXJzdFdpdGhkcmF3QW1vdW50ID0gMDsKICAgICAgICB0ZWFtV2FsbGV0LnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgV2l0aGRyYXcoYW1vdW50LCBub3cpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBXaXRoZHJhdyB0YXAgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgcHVibGljIG9ubHlPd25lciB3aXRoZHJhd0VuYWJsZWQgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gRnVuZFN0YXRlLlRlYW1XaXRoZHJhdyk7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBjYWxjVGFwQW1vdW50KCk7CiAgICAgICAgbGFzdFdpdGhkcmF3VGltZSA9IG5vdzsKICAgICAgICB0ZWFtV2FsbGV0LnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgV2l0aGRyYXcoYW1vdW50LCBub3cpOwogICAgfQoKICAgIC8vIFJlZnVuZAogICAgLyoqCiAgICAgKiBAZGV2IENhbGxlZCB0byBzdGFydCByZWZ1bmRpbmcKICAgICAqLwogICAgZnVuY3Rpb24gZW5hYmxlUmVmdW5kKCkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gRnVuZFN0YXRlLlRlYW1XaXRoZHJhdyk7CiAgICAgICAgc3RhdGUgPSBGdW5kU3RhdGUuUmVmdW5kOwogICAgICAgIHRva2VuLmRlc3Ryb3koY29tcGFueVRva2VuV2FsbGV0LCB0b2tlbi5iYWxhbmNlT2YoY29tcGFueVRva2VuV2FsbGV0KSk7CiAgICAgICAgdG9rZW4uZGVzdHJveShyZXNlcnZlVG9rZW5XYWxsZXQsIHRva2VuLmJhbGFuY2VPZihyZXNlcnZlVG9rZW5XYWxsZXQpKTsKICAgICAgICB0b2tlbi5kZXN0cm95KGZvdW5kYXRpb25Ub2tlbldhbGxldCwgdG9rZW4uYmFsYW5jZU9mKGZvdW5kYXRpb25Ub2tlbldhbGxldCkpOwogICAgICAgIHRva2VuLmRlc3Ryb3koYm91bnR5VG9rZW5XYWxsZXQsIHRva2VuLmJhbGFuY2VPZihib3VudHlUb2tlbldhbGxldCkpOwogICAgICAgIHRva2VuLmRlc3Ryb3kocmVmZXJyYWxUb2tlbldhbGxldCwgdG9rZW4uYmFsYW5jZU9mKHJlZmVycmFsVG9rZW5XYWxsZXQpKTsKICAgICAgICB0b2tlbi5kZXN0cm95KGFkdmlzb3JUb2tlbldhbGxldCwgdG9rZW4uYmFsYW5jZU9mKGFkdmlzb3JUb2tlbldhbGxldCkpOwogICAgICAgIFJlZnVuZEVuYWJsZWQobXNnLnNlbmRlcik7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgRnVuY3Rpb24gaXMgY2FsbGVkIGJ5IGNvbnRyaWJ1dG9yIHRvIHJlZnVuZAogICAgKiBCdXkgdXNlciB0b2tlbnMgZm9yIHJlZnVuZFRva2VuUHJpY2UgYW5kIGRlc3Ryb3kgdGhlbQogICAgKi8KICAgIGZ1bmN0aW9uIHJlZnVuZFRva2VuSG9sZGVyKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IEZ1bmRTdGF0ZS5SZWZ1bmQpOwoKICAgICAgICB1aW50MjU2IHRva2VuQmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZihtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHRva2VuQmFsYW5jZSA+IDApOwogICAgICAgIHVpbnQyNTYgcmVmdW5kQW1vdW50ID0gc2FmZURpdihzYWZlTXVsKHRva2VuQmFsYW5jZSwgYWRkcmVzcyh0aGlzKS5iYWxhbmNlKSwgdG9rZW4udG90YWxTdXBwbHkoKSk7CiAgICAgICAgcmVxdWlyZShyZWZ1bmRBbW91bnQgPiAwKTsKCiAgICAgICAgdG9rZW4uZGVzdHJveShtc2cuc2VuZGVyLCB0b2tlbkJhbGFuY2UpOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmVmdW5kQW1vdW50KTsKCiAgICAgICAgUmVmdW5kSG9sZGVyKG1zZy5zZW5kZXIsIHJlZnVuZEFtb3VudCwgdG9rZW5CYWxhbmNlLCBub3cpOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvZnVuZC9JUG9sbE1hbmFnZWRGdW5kLnNvbAoKLyoqCiAqIEB0aXRsZSBJUG9sbE1hbmFnZWRGdW5kCiAqIEBkZXYgRnVuZCBjYWxsYmFja3MgdXNlZCBieSBwb2xsaW5nIGNvbnRyYWN0cwogKi8KaW50ZXJmYWNlIElQb2xsTWFuYWdlZEZ1bmQgewogICAgLyoqCiAgICAgKiBAZGV2IFRhcFBvbGwgY2FsbGJhY2sKICAgICAqIEBwYXJhbSBhZ3JlZSBUcnVlIGlmIG5ldyB0YXAgdmFsdWUgaXMgYWNjZXB0ZWQgYnkgbWFqb3JpdHkgb2YgY29udHJpYnV0b3JzCiAgICAgKiBAcGFyYW0gX3RhcCBOZXcgdGFwIHZhbHVlCiAgICAgKi8KICAgIGZ1bmN0aW9uIG9uVGFwUG9sbEZpbmlzaChib29sIGFncmVlLCB1aW50MjU2IF90YXApIGV4dGVybmFsOwoKICAgIC8qKgogICAgICogQGRldiBSZWZ1bmRQb2xsIGNhbGxiYWNrCiAgICAgKiBAcGFyYW0gYWdyZWUgVHJ1ZSBpZiBjb250cmlidXRvcnMgZGVjaWRlZCB0byBhbGxvdyByZWZ1bmRpbmcKICAgICAqLwogICAgZnVuY3Rpb24gb25SZWZ1bmRQb2xsRmluaXNoKGJvb2wgYWdyZWUpIGV4dGVybmFsOwp9CgovLyBGaWxlOiBjb250cmFjdHMvcG9sbC9CYXNlUG9sbC5zb2wKCi8qKgogKiBAdGl0bGUgQmFzZVBvbGwKICogQGRldiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBwb2xsaW5nIGNvbnRyYWN0cwogKi8KY29udHJhY3QgQmFzZVBvbGwgaXMgU2FmZU1hdGggewogICAgc3RydWN0IFZvdGUgewogICAgICAgIHVpbnQyNTYgdGltZTsKICAgICAgICB1aW50MjU2IHdlaWdodDsKICAgICAgICBib29sIGFncmVlOwogICAgfQoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IE1BWF9UT0tFTlNfV0VJR0hUX0RFTk9NID0gMTAwMDsKCiAgICBJRVJDMjBUb2tlbiBwdWJsaWMgdG9rZW47CiAgICBhZGRyZXNzIHB1YmxpYyBmdW5kQWRkcmVzczsKCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7CiAgICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwogICAgYm9vbCBjaGVja1RyYW5zZmVyc0FmdGVyRW5kOwoKICAgIHVpbnQyNTYgcHVibGljIHllc0NvdW50ZXIgPSAwOwogICAgdWludDI1NiBwdWJsaWMgbm9Db3VudGVyID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsVm90ZWQgPSAwOwoKICAgIGJvb2wgcHVibGljIGZpbmFsaXplZDsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBWb3RlKSBwdWJsaWMgdm90ZXNCeUFkZHJlc3M7CgogICAgbW9kaWZpZXIgY2hlY2tUaW1lKCkgewogICAgICAgIHJlcXVpcmUobm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RGaW5hbGl6ZWQoKSB7CiAgICAgICAgcmVxdWlyZSghZmluYWxpemVkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBCYXNlUG9sbCBjb25zdHJ1Y3RvcgogICAgICogQHBhcmFtIF90b2tlbkFkZHJlc3MgRVJDMjAgY29tcGF0aWJsZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX2Z1bmRBZGRyZXNzIEZ1bmQgY29udHJhY3QgYWRkcmVzcwogICAgICogQHBhcmFtIF9zdGFydFRpbWUgUG9sbCBzdGFydCB0aW1lCiAgICAgKiBAcGFyYW0gX2VuZFRpbWUgUG9sbCBlbmQgdGltZQogICAgICovCiAgICBmdW5jdGlvbiBCYXNlUG9sbChhZGRyZXNzIF90b2tlbkFkZHJlc3MsIGFkZHJlc3MgX2Z1bmRBZGRyZXNzLCB1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIGJvb2wgX2NoZWNrVHJhbnNmZXJzQWZ0ZXJFbmQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdG9rZW5BZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cgJiYgX2VuZFRpbWUgPiBfc3RhcnRUaW1lKTsKCiAgICAgICAgdG9rZW4gPSBJRVJDMjBUb2tlbihfdG9rZW5BZGRyZXNzKTsKICAgICAgICBmdW5kQWRkcmVzcyA9IF9mdW5kQWRkcmVzczsKICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgICAgICBmaW5hbGl6ZWQgPSBmYWxzZTsKICAgICAgICBjaGVja1RyYW5zZmVyc0FmdGVyRW5kID0gX2NoZWNrVHJhbnNmZXJzQWZ0ZXJFbmQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFByb2Nlc3MgdXNlcmBzIHZvdGUKICAgICAqIEBwYXJhbSBhZ3JlZSBUcnVlIGlmIHVzZXIgZW5kb3JzZXMgdGhlIHByb3Bvc2FsIGVsc2UgRmFsc2UKICAgICAqLwogICAgZnVuY3Rpb24gdm90ZShib29sIGFncmVlKSBwdWJsaWMgY2hlY2tUaW1lIHsKICAgICAgICByZXF1aXJlKHZvdGVzQnlBZGRyZXNzW21zZy5zZW5kZXJdLnRpbWUgPT0gMCk7CgogICAgICAgIHVpbnQyNTYgdm9pY2VXZWlnaHQgPSB0b2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgdWludDI1NiBtYXhWb2ljZVdlaWdodCA9IHNhZmVEaXYodG9rZW4udG90YWxTdXBwbHkoKSwgTUFYX1RPS0VOU19XRUlHSFRfREVOT00pOwogICAgICAgIHZvaWNlV2VpZ2h0ID0gIHZvaWNlV2VpZ2h0IDw9IG1heFZvaWNlV2VpZ2h0ID8gdm9pY2VXZWlnaHQgOiBtYXhWb2ljZVdlaWdodDsKCiAgICAgICAgaWYoYWdyZWUpIHsKICAgICAgICAgICAgeWVzQ291bnRlciA9IHNhZmVBZGQoeWVzQ291bnRlciwgdm9pY2VXZWlnaHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5vQ291bnRlciA9IHNhZmVBZGQobm9Db3VudGVyLCB2b2ljZVdlaWdodCk7CgogICAgICAgIH0KCiAgICAgICAgdm90ZXNCeUFkZHJlc3NbbXNnLnNlbmRlcl0udGltZSA9IG5vdzsKICAgICAgICB2b3Rlc0J5QWRkcmVzc1ttc2cuc2VuZGVyXS53ZWlnaHQgPSB2b2ljZVdlaWdodDsKICAgICAgICB2b3Rlc0J5QWRkcmVzc1ttc2cuc2VuZGVyXS5hZ3JlZSA9IGFncmVlOwoKICAgICAgICB0b3RhbFZvdGVkID0gc2FmZUFkZCh0b3RhbFZvdGVkLCAxKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV2b2tlIHVzZXJgcyB2b3RlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJldm9rZVZvdGUoKSBwdWJsaWMgY2hlY2tUaW1lIHsKICAgICAgICByZXF1aXJlKHZvdGVzQnlBZGRyZXNzW21zZy5zZW5kZXJdLnRpbWUgPiAwKTsKCiAgICAgICAgdWludDI1NiB2b2ljZVdlaWdodCA9IHZvdGVzQnlBZGRyZXNzW21zZy5zZW5kZXJdLndlaWdodDsKICAgICAgICBib29sIGFncmVlID0gdm90ZXNCeUFkZHJlc3NbbXNnLnNlbmRlcl0uYWdyZWU7CgogICAgICAgIHZvdGVzQnlBZGRyZXNzW21zZy5zZW5kZXJdLnRpbWUgPSAwOwogICAgICAgIHZvdGVzQnlBZGRyZXNzW21zZy5zZW5kZXJdLndlaWdodCA9IDA7CiAgICAgICAgdm90ZXNCeUFkZHJlc3NbbXNnLnNlbmRlcl0uYWdyZWUgPSBmYWxzZTsKCiAgICAgICAgdG90YWxWb3RlZCA9IHNhZmVTdWIodG90YWxWb3RlZCwgMSk7CiAgICAgICAgaWYoYWdyZWUpIHsKICAgICAgICAgICAgeWVzQ291bnRlciA9IHNhZmVTdWIoeWVzQ291bnRlciwgdm9pY2VXZWlnaHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5vQ291bnRlciA9IHNhZmVTdWIobm9Db3VudGVyLCB2b2ljZVdlaWdodCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGdW5jdGlvbiBpcyBjYWxsZWQgYWZ0ZXIgdG9rZW4gdHJhbnNmZXIgZnJvbSB1c2VyYHMgd2FsbGV0IHRvIGNoZWNrIGFuZCBjb3JyZWN0IHVzZXJgcyB2b3RlCiAgICAgKgogICAgICovCiAgICBmdW5jdGlvbiBvblRva2VuVHJhbnNmZXIoYWRkcmVzcyB0b2tlbkhvbGRlciwgdWludDI1NiBhbW91bnQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGZ1bmRBZGRyZXNzKTsKICAgICAgICBpZih2b3Rlc0J5QWRkcmVzc1t0b2tlbkhvbGRlcl0udGltZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYoIWNoZWNrVHJhbnNmZXJzQWZ0ZXJFbmQpIHsKICAgICAgICAgICAgIGlmKGZpbmFsaXplZCB8fCAobm93IDwgc3RhcnRUaW1lIHx8IG5vdyA+IGVuZFRpbWUpKSB7CiAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYodG9rZW4uYmFsYW5jZU9mKHRva2VuSG9sZGVyKSA+PSB2b3Rlc0J5QWRkcmVzc1t0b2tlbkhvbGRlcl0ud2VpZ2h0KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdWludDI1NiB2b2ljZVdlaWdodCA9IGFtb3VudDsKICAgICAgICBpZihhbW91bnQgPiB2b3Rlc0J5QWRkcmVzc1t0b2tlbkhvbGRlcl0ud2VpZ2h0KSB7CiAgICAgICAgICAgIHZvaWNlV2VpZ2h0ID0gdm90ZXNCeUFkZHJlc3NbdG9rZW5Ib2xkZXJdLndlaWdodDsKICAgICAgICB9CgogICAgICAgIGlmKHZvdGVzQnlBZGRyZXNzW3Rva2VuSG9sZGVyXS5hZ3JlZSkgewogICAgICAgICAgICB5ZXNDb3VudGVyID0gc2FmZVN1Yih5ZXNDb3VudGVyLCB2b2ljZVdlaWdodCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbm9Db3VudGVyID0gc2FmZVN1Yihub0NvdW50ZXIsIHZvaWNlV2VpZ2h0KTsKICAgICAgICB9CiAgICAgICAgdm90ZXNCeUFkZHJlc3NbdG9rZW5Ib2xkZXJdLndlaWdodCA9IHNhZmVTdWIodm90ZXNCeUFkZHJlc3NbdG9rZW5Ib2xkZXJdLndlaWdodCwgdm9pY2VXZWlnaHQpOwogICAgfQoKICAgIC8qKgogICAgICogRmluYWxpemUgcG9sbCBhbmQgY2FsbCBvblBvbGxGaW5pc2ggY2FsbGJhY2sgd2l0aCByZXN1bHQKICAgICAqLwogICAgZnVuY3Rpb24gdHJ5VG9GaW5hbGl6ZSgpIHB1YmxpYyBub3RGaW5hbGl6ZWQgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYobm93IDwgZW5kVGltZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGZpbmFsaXplZCA9IHRydWU7CiAgICAgICAgb25Qb2xsRmluaXNoKGlzU3ViamVjdEFwcHJvdmVkKCkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzTm93QXBwcm92ZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gaXNTdWJqZWN0QXBwcm92ZWQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1N1YmplY3RBcHByb3ZlZCgpIGludGVybmFsIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIHllc0NvdW50ZXIgPiBub0NvdW50ZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNhbGxiYWNrIGNhbGxlZCBhZnRlciBwb2xsIGZpbmFsaXphdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBvblBvbGxGaW5pc2goYm9vbCBhZ3JlZSkgaW50ZXJuYWw7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9SZWZ1bmRQb2xsLnNvbAoKLyoqCiAqIEB0aXRsZSBSZWZ1bmRQb2xsCiAqIEBkZXYgRW5hYmxlcyBmdW5kIHJlZnVuZCBtb2RlCiAqLwpjb250cmFjdCBSZWZ1bmRQb2xsIGlzIEJhc2VQb2xsIHsKICAgIHVpbnQyNTYgcHVibGljIGhvbGRFbmRUaW1lID0gMDsKCiAgICAvKioKICAgICAqIFJlZnVuZFBvbGwgY29uc3RydWN0b3IKICAgICAqIEBwYXJhbSBfdG9rZW5BZGRyZXNzIEVSQzIwIGNvbXBhdGlibGUgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICogQHBhcmFtIF9mdW5kQWRkcmVzcyBGdW5kIGNvbnRyYWN0IGFkZHJlc3MKICAgICAqIEBwYXJhbSBfc3RhcnRUaW1lIFBvbGwgc3RhcnQgdGltZQogICAgICogQHBhcmFtIF9lbmRUaW1lIFBvbGwgZW5kIHRpbWUKICAgICAqLwogICAgZnVuY3Rpb24gUmVmdW5kUG9sbCgKICAgICAgICBhZGRyZXNzIF90b2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfZnVuZEFkZHJlc3MsCiAgICAgICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgdWludDI1NiBfaG9sZEVuZFRpbWUsCiAgICAgICAgYm9vbCBfY2hlY2tUcmFuc2ZlcnNBZnRlckVuZAogICAgKSBwdWJsaWMKICAgICAgICBCYXNlUG9sbChfdG9rZW5BZGRyZXNzLCBfZnVuZEFkZHJlc3MsIF9zdGFydFRpbWUsIF9lbmRUaW1lLCBfY2hlY2tUcmFuc2ZlcnNBZnRlckVuZCkKICAgIHsKICAgICAgICBob2xkRW5kVGltZSA9IF9ob2xkRW5kVGltZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cnlUb0ZpbmFsaXplKCkgcHVibGljIHJldHVybnMoYm9vbCkgewogICAgICAgIGlmKGhvbGRFbmRUaW1lID4gMCAmJiBob2xkRW5kVGltZSA+IGVuZFRpbWUpIHsKICAgICAgICAgICAgcmVxdWlyZShub3cgPj0gaG9sZEVuZFRpbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUobm93ID49IGVuZFRpbWUpOwogICAgICAgIH0KCiAgICAgICAgZmluYWxpemVkID0gdHJ1ZTsKICAgICAgICBvblBvbGxGaW5pc2goaXNTdWJqZWN0QXBwcm92ZWQoKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gaXNTdWJqZWN0QXBwcm92ZWQoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiB5ZXNDb3VudGVyID4gbm9Db3VudGVyICYmIHllc0NvdW50ZXIgPj0gc2FmZURpdih0b2tlbi50b3RhbFN1cHBseSgpLCAzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvblBvbGxGaW5pc2goYm9vbCBhZ3JlZSkgaW50ZXJuYWwgewogICAgICAgIElQb2xsTWFuYWdlZEZ1bmQgZnVuZCA9IElQb2xsTWFuYWdlZEZ1bmQoZnVuZEFkZHJlc3MpOwogICAgICAgIGZ1bmQub25SZWZ1bmRQb2xsRmluaXNoKGFncmVlKTsKICAgIH0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9UYXBQb2xsLnNvbAoKLyoqCiAqIEB0aXRsZSBUYXBQb2xsCiAqIEBkZXYgUG9sbCB0byBpbmNyZWFzZSB0YXAgYW1vdW50CiAqLwpjb250cmFjdCBUYXBQb2xsIGlzIEJhc2VQb2xsIHsKICAgIHVpbnQyNTYgcHVibGljIHRhcDsKICAgIHVpbnQyNTYgcHVibGljIG1pblRva2Vuc1BlcmMgPSAwOwoKICAgIC8qKgogICAgICogVGFwUG9sbCBjb25zdHJ1Y3RvcgogICAgICogQHBhcmFtIF90YXAgTmV3IHRhcCB2YWx1ZQogICAgICogQHBhcmFtIF90b2tlbkFkZHJlc3MgRVJDMjAgY29tcGF0aWJsZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gX2Z1bmRBZGRyZXNzIEZ1bmQgY29udHJhY3QgYWRkcmVzcwogICAgICogQHBhcmFtIF9zdGFydFRpbWUgUG9sbCBzdGFydCB0aW1lCiAgICAgKiBAcGFyYW0gX2VuZFRpbWUgUG9sbCBlbmQgdGltZQogICAgICogQHBhcmFtIF9taW5Ub2tlbnNQZXJjIC0gTWluIHBlcmNlbnQgb2YgdG9rZW5zIGZyb20gdG90YWxTdXBwbHkgd2hlcmUgcG9sbCBpcyBjb25zaWRlcmVkIHRvIGJlIGZ1bGZpbGxlZAogICAgICovCiAgICBmdW5jdGlvbiBUYXBQb2xsKAogICAgICAgIHVpbnQyNTYgX3RhcCwKICAgICAgICBhZGRyZXNzIF90b2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfZnVuZEFkZHJlc3MsCiAgICAgICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgdWludDI1NiBfbWluVG9rZW5zUGVyYwogICAgKSBwdWJsaWMKICAgICAgICBCYXNlUG9sbChfdG9rZW5BZGRyZXNzLCBfZnVuZEFkZHJlc3MsIF9zdGFydFRpbWUsIF9lbmRUaW1lLCBmYWxzZSkKICAgIHsKICAgICAgICB0YXAgPSBfdGFwOwogICAgICAgIG1pblRva2Vuc1BlcmMgPSBfbWluVG9rZW5zUGVyYzsKICAgIH0KCiAgICBmdW5jdGlvbiBvblBvbGxGaW5pc2goYm9vbCBhZ3JlZSkgaW50ZXJuYWwgewogICAgICAgIElQb2xsTWFuYWdlZEZ1bmQgZnVuZCA9IElQb2xsTWFuYWdlZEZ1bmQoZnVuZEFkZHJlc3MpOwogICAgICAgIGZ1bmQub25UYXBQb2xsRmluaXNoKGFncmVlLCB0YXApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFZvdGVkVG9rZW5zUGVyYygpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiBzYWZlRGl2KHNhZmVNdWwoc2FmZUFkZCh5ZXNDb3VudGVyLCBub0NvdW50ZXIpLCAxMDApLCB0b2tlbi50b3RhbFN1cHBseSgpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1N1YmplY3RBcHByb3ZlZCgpIGludGVybmFsIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIHllc0NvdW50ZXIgPiBub0NvdW50ZXIgJiYgZ2V0Vm90ZWRUb2tlbnNQZXJjKCkgPj0gbWluVG9rZW5zUGVyYzsKICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL1BvbGxNYW5hZ2VkRnVuZC5zb2wKCi8qKgogKiBAdGl0bGUgUG9sbE1hbmFnZWRGdW5kCiAqIEBkZXYgRnVuZCBjb250cm9sbGVkIGJ5IHVzZXJzCiAqLwpjb250cmFjdCBQb2xsTWFuYWdlZEZ1bmQgaXMgRnVuZCwgRGF0ZVRpbWUsIElUb2tlbkV2ZW50TGlzdGVuZXIgewogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVEFQX1BPTExfRFVSQVRJT04gPSAzIGRheXM7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBSRUZVTkRfUE9MTF9EVVJBVElPTiA9IDcgZGF5czsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IE1BWF9WT1RFRF9UT0tFTl9QRVJDID0gMTA7CgogICAgVGFwUG9sbCBwdWJsaWMgdGFwUG9sbDsKICAgIFJlZnVuZFBvbGwgcHVibGljIHJlZnVuZFBvbGw7CgogICAgdWludDI1NiBwdWJsaWMgbWluVm90ZWRUb2tlbnNQZXJjID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHNlY29uZFJlZnVuZFBvbGxEYXRlID0gMDsKICAgIGJvb2wgcHVibGljIGlzV2l0aGRyYXdFbmFibGVkID0gdHJ1ZTsKCiAgICB1aW50MjU2W10gcHVibGljIHJlZnVuZFBvbGxEYXRlcyA9IFsKICAgICAgICAxNTIyNTQwODAwLCAvLyAwMS4wNC4yMDE4CiAgICAgICAgMTUyMjU0MDgwMCwgLy8gMDEuMDQuMjAxOAogICAgICAgIDE1MjI1NDA4MDAsIC8vIDAxLjA0LjIwMTgKICAgICAgICAxNTIyNTQwODAwLCAvLyAwMS4wNC4yMDE4CiAgICAgICAgMTUyMjU0MDgwMCwgLy8gMDEuMDQuMjAxOAogICAgICAgIDE1MjI1NDA4MDAsIC8vIDAxLjA0LjIwMTgKICAgICAgICAxNTIyNTQwODAwLCAvLyAwMS4wNC4yMDE4CiAgICAgICAgMTUyMjU0MDgwMCAgLy8gMDEuMDQuMjAxOAogICAgXTsKCiAgICBtb2RpZmllciBvbmx5VG9rZW5Ib2xkZXIoKSB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcikgPiAwKTsKICAgICAgICBfOwogICAgfQoKICAgIGV2ZW50IFRhcFBvbGxDcmVhdGVkKCk7CiAgICBldmVudCBUYXBQb2xsRmluaXNoZWQoYm9vbCBhcHByb3ZlZCwgdWludDI1NiBfdGFwKTsKICAgIGV2ZW50IFJlZnVuZFBvbGxDcmVhdGVkKCk7CiAgICBldmVudCBSZWZ1bmRQb2xsRmluaXNoZWQoYm9vbCBhcHByb3ZlZCk7CgogICAgLyoqCiAgICAgKiBAZGV2IFBvbGxNYW5hZ2VkRnVuZCBjb25zdHJ1Y3RvcgogICAgICogcGFyYW1zIC0gc2VlIEZ1bmQgY29uc3RydWN0b3IKICAgICAqLwogICAgZnVuY3Rpb24gUG9sbE1hbmFnZWRGdW5kKAogICAgICAgIGFkZHJlc3MgX3RlYW1XYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfcmVmZXJyYWxUb2tlbldhbGxldCwKICAgICAgICBhZGRyZXNzIF9mb3VuZGF0aW9uVG9rZW5XYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfY29tcGFueVRva2VuV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX3Jlc2VydmVUb2tlbldhbGxldCwKICAgICAgICBhZGRyZXNzIF9ib3VudHlUb2tlbldhbGxldCwKICAgICAgICBhZGRyZXNzIF9hZHZpc29yVG9rZW5XYWxsZXQsCiAgICAgICAgYWRkcmVzc1tdIF9vd25lcnMKICAgICAgICApIHB1YmxpYwogICAgRnVuZChfdGVhbVdhbGxldCwgX3JlZmVycmFsVG9rZW5XYWxsZXQsIF9mb3VuZGF0aW9uVG9rZW5XYWxsZXQsIF9jb21wYW55VG9rZW5XYWxsZXQsIF9yZXNlcnZlVG9rZW5XYWxsZXQsIF9ib3VudHlUb2tlbldhbGxldCwgX2Fkdmlzb3JUb2tlbldhbGxldCwgX293bmVycykKICAgIHsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5XaXRoZHJhdygpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZigKICAgICAgICAgICAgYWRkcmVzcyhyZWZ1bmRQb2xsKSAhPSBhZGRyZXNzKDApICYmCiAgICAgICAgICAgICFyZWZ1bmRQb2xsLmZpbmFsaXplZCgpICYmCiAgICAgICAgICAgIHJlZnVuZFBvbGwuaG9sZEVuZFRpbWUoKSA+IDAgJiYKICAgICAgICAgICAgbm93ID49IHJlZnVuZFBvbGwuaG9sZEVuZFRpbWUoKSAmJgogICAgICAgICAgICByZWZ1bmRQb2xsLmlzTm93QXBwcm92ZWQoKQogICAgICAgICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpc1dpdGhkcmF3RW5hYmxlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSVRva2VuRXZlbnRMaXN0ZW5lciBpbXBsZW1lbnRhdGlvbi4gTm90aWZ5IGFjdGl2ZSBwb2xsIGNvbnRyYWN0cyBhYm91dCB0b2tlbiB0cmFuc2ZlcnMKICAgICAqLwogICAgZnVuY3Rpb24gb25Ub2tlblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgLypfdG8qLywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModG9rZW4pKTsKICAgICAgICBpZihhZGRyZXNzKHRhcFBvbGwpICE9IGFkZHJlc3MoMCkgJiYgIXRhcFBvbGwuZmluYWxpemVkKCkpIHsKICAgICAgICAgICAgdGFwUG9sbC5vblRva2VuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSk7CiAgICAgICAgfQogICAgICAgICBpZihhZGRyZXNzKHJlZnVuZFBvbGwpICE9IGFkZHJlc3MoMCkgJiYgIXJlZnVuZFBvbGwuZmluYWxpemVkKCkpIHsKICAgICAgICAgICAgcmVmdW5kUG9sbC5vblRva2VuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVcGRhdGUgbWluVm90ZWRUb2tlbnNQZXJjIHZhbHVlIGFmdGVyIHRhcCBwb2xsLgogICAgICogU2V0IG5ldyB2YWx1ZSA9PSA1MCUgZnJvbSBjdXJyZW50IHZvdGVkIHRva2VucyBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlTWluVm90ZWRUb2tlbnModWludDI1NiBfbWluVm90ZWRUb2tlbnNQZXJjKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDI1NiBuZXdQZXJjID0gc2FmZURpdihfbWluVm90ZWRUb2tlbnNQZXJjLCAyKTsKICAgICAgICBpZihuZXdQZXJjID4gTUFYX1ZPVEVEX1RPS0VOX1BFUkMpIHsKICAgICAgICAgICAgbWluVm90ZWRUb2tlbnNQZXJjID0gTUFYX1ZPVEVEX1RPS0VOX1BFUkM7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbWluVm90ZWRUb2tlbnNQZXJjID0gbmV3UGVyYzsKICAgIH0KCiAgICAvLyBUYXAgcG9sbAogICAgZnVuY3Rpb24gY3JlYXRlVGFwUG9sbCh1aW50OCB0YXBJbmNQZXJjKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IEZ1bmRTdGF0ZS5UZWFtV2l0aGRyYXcpOwogICAgICAgIHJlcXVpcmUodGFwUG9sbCA9PSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGdldERheShub3cpID09IDEpOwogICAgICAgIHJlcXVpcmUodGFwSW5jUGVyYyA8PSAxMDApOwogICAgICAgIHVpbnQyNTYgX3RhcCA9IHNhZmVBZGQodGFwLCBzYWZlRGl2KHNhZmVNdWwodGFwLCB0YXBJbmNQZXJjKSwgNTApKTsKICAgICAgICB1aW50MjU2IHN0YXJ0VGltZSA9IG5vdzsKICAgICAgICB1aW50MjU2IGVuZFRpbWUgPSBzdGFydFRpbWUgKyBUQVBfUE9MTF9EVVJBVElPTjsKICAgICAgICB0YXBQb2xsID0gbmV3IFRhcFBvbGwoX3RhcCwgdG9rZW4sIHRoaXMsIHN0YXJ0VGltZSwgZW5kVGltZSwgbWluVm90ZWRUb2tlbnNQZXJjKTsKICAgICAgICBUYXBQb2xsQ3JlYXRlZCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uVGFwUG9sbEZpbmlzaChib29sIGFncmVlLCB1aW50MjU2IF90YXApIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0YXBQb2xsKSAmJiB0YXBQb2xsLmZpbmFsaXplZCgpKTsKICAgICAgICBpZihhZ3JlZSkgewogICAgICAgICAgICB0YXAgPSBfdGFwOwogICAgICAgIH0KICAgICAgICB1cGRhdGVNaW5Wb3RlZFRva2Vucyh0YXBQb2xsLmdldFZvdGVkVG9rZW5zUGVyYygpKTsKICAgICAgICBUYXBQb2xsRmluaXNoZWQoYWdyZWUsIF90YXApOwogICAgICAgIGRlbGV0ZSB0YXBQb2xsOwogICAgfQoKICAgIC8vIFJlZnVuZCBwb2xsCiAgICBmdW5jdGlvbiBjaGVja1JlZnVuZFBvbGxEYXRlKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZihzZWNvbmRSZWZ1bmRQb2xsRGF0ZSA+IDAgJiYgbm93ID49IHNlY29uZFJlZnVuZFBvbGxEYXRlICYmIG5vdyA8PSBzYWZlQWRkKHNlY29uZFJlZnVuZFBvbGxEYXRlLCAxIGRheXMpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgZm9yKHVpbnQgaTsgaSA8IHJlZnVuZFBvbGxEYXRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZihub3cgPj0gcmVmdW5kUG9sbERhdGVzW2ldICYmIG5vdyA8PSBzYWZlQWRkKHJlZnVuZFBvbGxEYXRlc1tpXSwgMTIgZGF5cykpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVSZWZ1bmRQb2xsKCkgcHVibGljIG9ubHlUb2tlbkhvbGRlciB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBGdW5kU3RhdGUuVGVhbVdpdGhkcmF3KTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MocmVmdW5kUG9sbCkgPT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShjaGVja1JlZnVuZFBvbGxEYXRlKCkpOwoKICAgICAgICBpZihzZWNvbmRSZWZ1bmRQb2xsRGF0ZSA+IDAgJiYgbm93ID4gc2FmZUFkZChzZWNvbmRSZWZ1bmRQb2xsRGF0ZSwgMTIgZGF5cykpIHsKICAgICAgICAgICAgc2Vjb25kUmVmdW5kUG9sbERhdGUgPSAwOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBzdGFydFRpbWUgPSBub3c7CiAgICAgICAgdWludDI1NiBlbmRUaW1lID0gc3RhcnRUaW1lICsgUkVGVU5EX1BPTExfRFVSQVRJT047CiAgICAgICAgYm9vbCBpc0ZpcnN0UmVmdW5kID0gc2Vjb25kUmVmdW5kUG9sbERhdGUgPT0gMDsKICAgICAgICB1aW50MjU2IGhvbGRFbmRUaW1lID0gMDsKCiAgICAgICAgaWYoaXNGaXJzdFJlZnVuZCkgewogICAgICAgICAgICBob2xkRW5kVGltZSA9IHRvVGltZXN0YW1wKAogICAgICAgICAgICAgICAgZ2V0WWVhcihzdGFydFRpbWUpLAogICAgICAgICAgICAgICAgZ2V0TW9udGgoc3RhcnRUaW1lKSArIDEsCiAgICAgICAgICAgICAgICAxCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJlZnVuZFBvbGwgPSBuZXcgUmVmdW5kUG9sbCh0b2tlbiwgdGhpcywgc3RhcnRUaW1lLCBlbmRUaW1lLCBob2xkRW5kVGltZSwgaXNGaXJzdFJlZnVuZCk7CiAgICAgICAgUmVmdW5kUG9sbENyZWF0ZWQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvblJlZnVuZFBvbGxGaW5pc2goYm9vbCBhZ3JlZSkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHJlZnVuZFBvbGwpICYmIHJlZnVuZFBvbGwuZmluYWxpemVkKCkpOwogICAgICAgIGlmKGFncmVlKSB7CiAgICAgICAgICAgIGlmKHNlY29uZFJlZnVuZFBvbGxEYXRlID4gMCkgewogICAgICAgICAgICAgICAgZW5hYmxlUmVmdW5kKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB1aW50MjU2IHN0YXJ0VGltZSA9IHJlZnVuZFBvbGwuc3RhcnRUaW1lKCk7CiAgICAgICAgICAgICAgICBzZWNvbmRSZWZ1bmRQb2xsRGF0ZSA9IHRvVGltZXN0YW1wKAogICAgICAgICAgICAgICAgICAgIGdldFllYXIoc3RhcnRUaW1lKSwKICAgICAgICAgICAgICAgICAgICBnZXRNb250aChzdGFydFRpbWUpICsgMSwKICAgICAgICAgICAgICAgICAgICAxCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaXNXaXRoZHJhd0VuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlY29uZFJlZnVuZFBvbGxEYXRlID0gMDsKICAgICAgICAgICAgaXNXaXRoZHJhd0VuYWJsZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBSZWZ1bmRQb2xsRmluaXNoZWQoYWdyZWUpOwoKICAgICAgICBkZWxldGUgcmVmdW5kUG9sbDsKICAgIH0KCiAgICBmdW5jdGlvbiBmb3JjZVJlZnVuZCgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGVuYWJsZVJlZnVuZCgpOwogICAgfQp9'.
	

]
