Class {
	#name : #SRTdcab5d235131b02ab93f7e9bf3daed22d464be8a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdcab5d235131b02ab93f7e9bf3daed22d464be8a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCmNvbnRyYWN0IEVSQzIwIHsKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKfQoKCmNvbnRyYWN0IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiID4gMCk7CiAgICB1aW50IGMgPSBhIC8gYjsKICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgIGlmICghYXNzZXJ0aW9uKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KfQpjb250cmFjdCBBcHByb3ZlQW5kQ2FsbFJlY2VpdmVyIHsKICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MgX3Rva2VuLCBieXRlcyBfZGF0YSk7Cn0KCmNvbnRyYWN0IENvbnRyb2xsZWQgewogICAgLy8vIEBub3RpY2UgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsCiAgICAvLy8gIGEgZnVuY3Rpb24gd2l0aCB0aGlzIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlciB7IGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHRocm93OyBfOyB9CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgeyBjb250cm9sbGVyID0gbXNnLnNlbmRlcjt9CgogICAgLy8vIEBub3RpY2UgQ2hhbmdlcyB0aGUgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIG5ldyBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgY29udHJvbGxlciA9IF9uZXdDb250cm9sbGVyOwogICAgfQp9CmNvbnRyYWN0IEFic3RyYWN0U2FsZSB7CiAgZnVuY3Rpb24gc2FsZUZpbmFsaXplZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBTYWxlV2FsbGV0IHsKICAvLyBQdWJsaWMgdmFyaWFibGVzCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWc7CiAgdWludCBwdWJsaWMgZmluYWxCbG9jazsKICBBYnN0cmFjdFNhbGUgcHVibGljIHRva2VuU2FsZTsKCiAgLy8gQGRldiBDb25zdHJ1Y3RvciBpbml0aWFsaXplcyBwdWJsaWMgdmFyaWFibGVzCiAgLy8gQHBhcmFtIF9tdWx0aXNpZyBUaGUgYWRkcmVzcyBvZiB0aGUgbXVsdGlzaWcgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGZ1bmRzCiAgLy8gQHBhcmFtIF9maW5hbEJsb2NrIEJsb2NrIGFmdGVyIHdoaWNoIHRoZSBtdWx0aXNpZyBjYW4gcmVxdWVzdCB0aGUgZnVuZHMKICBmdW5jdGlvbiBTYWxlV2FsbGV0KGFkZHJlc3MgX211bHRpc2lnLCB1aW50IF9maW5hbEJsb2NrLCBhZGRyZXNzIF90b2tlblNhbGUpIHsKICAgIG11bHRpc2lnID0gX211bHRpc2lnOwogICAgZmluYWxCbG9jayA9IF9maW5hbEJsb2NrOwogICAgdG9rZW5TYWxlID0gQWJzdHJhY3RTYWxlKF90b2tlblNhbGUpOwogIH0KCiAgLy8gQGRldiBSZWNlaXZlIGFsbCBzZW50IGZ1bmRzIHdpdGhvdXQgYW55IGZ1cnRoZXIgbG9naWMKICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7fQoKICAvLyBAZGV2IFdpdGhkcmF3IGZ1bmN0aW9uIHNlbmRzIGFsbCB0aGUgZnVuZHMgdG8gdGhlIHdhbGxldCBpZiBjb25kaXRpb25zIGFyZSBjb3JyZWN0CiAgZnVuY3Rpb24gd2l0aGRyYXcoKSBwdWJsaWMgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gbXVsdGlzaWcpIHRocm93OyAgICAgICAgICAgICAgICAgICAgICAgLy8gT25seSB0aGUgbXVsdGlzaWcgY2FuIHJlcXVlc3QgaXQKICAgIGlmIChibG9jay5udW1iZXIgPiBmaW5hbEJsb2NrKSByZXR1cm4gZG9XaXRoZHJhdygpOyAgICAgIC8vIEFsbG93IGFmdGVyIHRoZSBmaW5hbCBibG9jawogICAgaWYgKHRva2VuU2FsZS5zYWxlRmluYWxpemVkKCkpIHJldHVybiBkb1dpdGhkcmF3KCk7ICAgICAgLy8gQWxsb3cgd2hlbiBzYWxlIGlzIGZpbmFsaXplZAogIH0KCiAgZnVuY3Rpb24gZG9XaXRoZHJhdygpIGludGVybmFsIHsKICAgIGlmICghbXVsdGlzaWcuc2VuZCh0aGlzLmJhbGFuY2UpKSB0aHJvdzsKICB9Cn0KCmNvbnRyYWN0IENvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBBTlBsYWNlaG9sZGVyIGlzIENvbnRyb2xsZXIgewogIGFkZHJlc3MgcHVibGljIHNhbGU7CiAgQU5UIHB1YmxpYyB0b2tlbjsKCiAgZnVuY3Rpb24gQU5QbGFjZWhvbGRlcihhZGRyZXNzIF9zYWxlLCBhZGRyZXNzIF9hbnQpIHsKICAgIHNhbGUgPSBfc2FsZTsKICAgIHRva2VuID0gQU5UKF9hbnQpOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIG5ldHdvcmspIHB1YmxpYyB7CiAgICBpZiAobXNnLnNlbmRlciAhPSBzYWxlKSB0aHJvdzsKICAgIHRva2VuLmNoYW5nZUNvbnRyb2xsZXIobmV0d29yayk7CiAgICBzdWljaWRlKG5ldHdvcmspOwogIH0KCiAgLy8gSW4gYmV0d2VlbiB0aGUgc2FsZSBhbmQgdGhlIG5ldHdvcmsuIERlZmF1bHQgc2V0dGluZ3MgZm9yIGFsbG93aW5nIHRva2VuIHRyYW5zZmVycy4KICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHRocm93OwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKCgoKY29udHJhY3QgTWluaU1lVG9rZW4gaXMgRVJDMjAsIENvbnRyb2xsZWQgewogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAvL1RoZSBUb2tlbidzIG5hbWU6IGUuZy4gRGlnaXhEQU8gVG9rZW5zCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVAKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdNTVRfMC4xJzsgLy9BbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUKCgogICAgLy8vIEBkZXYgYENoZWNrcG9pbnRgIGlzIHRoZSBzdHJ1Y3R1cmUgdGhhdCBhdHRhY2hlcyBhIGJsb2NrIG51bWJlciB0byBhCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlCiAgICAvLy8gIHZhbHVlCiAgICBzdHJ1Y3QgIENoZWNrcG9pbnQgewoKICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQogICAgICAgIHVpbnQxMjggZnJvbUJsb2NrOwoKICAgICAgICAvLyBgdmFsdWVgIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYmxvY2sgbnVtYmVyCiAgICAgICAgdWludDEyOCB2YWx1ZTsKICAgIH0KCiAgICAvLyBgcGFyZW50VG9rZW5gIGlzIHRoZSBUb2tlbiBhZGRyZXNzIHRoYXQgd2FzIGNsb25lZCB0byBwcm9kdWNlIHRoaXMgdG9rZW47CiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZAogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOwoKICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4KICAgIHVpbnQgcHVibGljIHBhcmVudFNuYXBTaG90QmxvY2s7CgogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uQmxvY2s7CgogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIGNoYW5nZQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOwoKICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbgogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsKCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7CgogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2VucwogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7CgovLy8vLy8vLy8vLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5GYWN0b3J5IFRoZSBhZGRyZXNzIG9mIHRoZSBNaW5pTWVUb2tlbkZhY3RvcnkgY29udHJhY3QgdGhhdAogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQogICAgLy8vICBkZXBsb3llZCBmaXJzdAogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuLCBzZXQgdG8gMCBpZiBpdAogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gTWluaU1lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgewogICAgICAgIHRva2VuRmFjdG9yeSA9IE1pbmlNZVRva2VuRmFjdG9yeShfdG9rZW5GYWN0b3J5KTsKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wKICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7CiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOwogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gRVJDMjAgTWV0aG9kcwovLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsKICAgICAgICByZXR1cm4gZG9UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdAogICAgLy8vICBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIC8vIFRoZSBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QgY2FuIG1vdmUgdG9rZW5zIGFyb3VuZCBhdCB3aWxsLAogICAgICAgIC8vICB0aGlzIGlzIGltcG9ydGFudCB0byByZWNvZ25pemUhIENvbmZpcm0gdGhhdCB5b3UgdHJ1c3QgdGhlCiAgICAgICAgLy8gIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCwgd2hpY2ggaW4gbW9zdCBzaXR1YXRpb25zIHNob3VsZCBiZQogICAgICAgIC8vICBhbm90aGVyIG9wZW4gc291cmNlIHNtYXJ0IGNvbnRyYWN0IG9yIDB4MAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsKCiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkKICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgdGhyb3c7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CgogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYKICAgICAgICAgICBpZiAoKF90byA9PSAwKSB8fCAoX3RvID09IGFkZHJlc3ModGhpcykpKSB0aHJvdzsKCiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB7CiAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgIH0KCiAgICAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSB0cmFuc2ZlcgogICAgICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgICAgIGlmICghQ29udHJvbGxlcihjb250cm9sbGVyKS5vblRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpKSB0aHJvdzsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHNlbmRpbmcgdGhlIHRva2VucwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CgogICAgICAgICAgIC8vIFRoZW4gdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA8IHByZXZpb3VzQmFsYW5jZVRvKSB0aHJvdzsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0cmFuc2ZlciBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKCiAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCdzIGJhbGFuY2UgaXMgYmVpbmcgcmVxdWVzdGVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jawogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZU9mQXQoX293bmVyLCBibG9jay5udW1iZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZi4gVGhpcyBpcyBhIG1vZGlmaWVkIHZlcnNpb24gb2YgdGhlIEVSQzIwIGFwcHJvdmUgZnVuY3Rpb24KICAgIC8vLyAgdG8gYmUgYSBsaXR0bGUgYml0IHNhZmVyCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoIXRyYW5zZmVyc0VuYWJsZWQpIHRocm93OwoKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzJiMxODA7CiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIGlmICgoX2Ftb3VudCE9MCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9MCkpIHRocm93OwoKICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIGFwcHJvdmUgZnVuY3Rpb24gY2FsbAogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgIGlmICghQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKQogICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byByZWFkIHRoZSBgYWxsb3dlZFtdYCBtYXAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkCiAgICAvLy8gIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIKICAgICkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpOwoKICAgICAgICAvLyBUaGlzIHBvcnRpb24gaXMgY29waWVkIGZyb20gQ29uc2VuU3lzJ3MgU3RhbmRhcmQgVG9rZW4gQ29udHJhY3QuIEl0CiAgICAgICAgLy8gIGNhbGxzIHRoZSByZWNlaXZlQXBwcm92YWwgZnVuY3Rpb24gdGhhdCBpcyBwYXJ0IG9mIHRoZSBjb250cmFjdCB0aGF0CiAgICAgICAgLy8gIGlzIGJlaW5nIGFwcHJvdmVkIChgX3NwZW5kZXJgKS4gVGhlIGZ1bmN0aW9uIHNob3VsZCBsb29rIGxpa2U6CiAgICAgICAgLy8gIGByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzCiAgICAgICAgLy8gIF90b2tlbkNvbnRyYWN0LCBieXRlcyBfZXh0cmFEYXRhKWAgSXQgaXMgYXNzdW1lZCB0aGF0IHRoZSBjYWxsCiAgICAgICAgLy8gICpzaG91bGQqIHN1Y2NlZWQsIG90aGVyd2lzZSB0aGUgcGxhaW4gdmFuaWxsYSBhcHByb3ZlIHdvdWxkIGJlIHVzZWQKICAgICAgICBBcHByb3ZlQW5kQ2FsbFJlY2VpdmVyKF9zcGVuZGVyKS5yZWNlaXZlQXBwcm92YWwoCiAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICBfYW1vdW50LAogICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIGdldCB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseUF0KGJsb2NrLm51bWJlcik7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBRdWVyeSBiYWxhbmNlIGFuZCB0b3RhbFN1cHBseSBpbiBIaXN0b3J5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBRdWVyaWVzIHRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgYmFsYW5jZSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gYmFsYW5jZU9mQXQoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgYmFsYW5jZSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhhdCB0b2tlbiBhcyB0aGlzIGNvbnRhaW5zIGluaXRpYWwgYmFsYW5jZSBvZgogICAgICAgIC8vICB0aGlzIHRva2VuCiAgICAgICAgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAoYmFsYW5jZXNbX293bmVyXVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4uYmFsYW5jZU9mQXQoX293bmVyLCBtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBIYXMgbm8gcGFyZW50CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCBiYWxhbmNlIGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KGJhbGFuY2VzW19vd25lcl0sIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYC4KICAgIC8vLyBAcGFyYW0gX2Jsb2NrTnVtYmVyIFRoZSBibG9jayBudW1iZXIgd2hlbiB0aGUgdG90YWxTdXBwbHkgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXQodWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50IHJldHVybnModWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSB0b3RhbFN1cHBseSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGlzIHRva2VuIGFzIHRoYXQgY29udGFpbnMgdG90YWxTdXBwbHkgb2YgdGhpcwogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ2xvbmUgVG9rZW4gTWV0aG9kCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47CiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyBoaWdoZXIgdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgKSByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3NuYXBzaG90QmxvY2sgPiBibG9jay5udW1iZXIpIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBibG9jay5udW1iZXIpOwogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSArIF9hbW91bnQgPCBjdXJUb3RhbFN1cHBseSkgdGhyb3c7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPCBwcmV2aW91c0JhbGFuY2VUbykgdGhyb3c7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGJ1cm4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7CiAgICAgICAgaWYgKGN1clRvdGFsU3VwcGx5IDwgX2Ftb3VudCkgdGhyb3c7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5IC0gX2Ftb3VudCk7CiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHRocm93OwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEVuYWJsZSB0b2tlbnMgdHJhbnNmZXJzCi8vLy8vLy8vLy8vLy8vLy8KCgogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycyhib29sIF90cmFuc2ZlcnNFbmFibGVkKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb25zIHRvIHF1ZXJ5IGFuZCBzZXQgYSB2YWx1ZSBpbiBhIHNuYXBzaG90IGFycmF5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBgZ2V0VmFsdWVBdGAgcmV0cmlldmVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIGF0IGEgZ2l2ZW4gYmxvY2sgbnVtYmVyCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIHZhbHVlcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdAogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiB0b2tlbnMgYmVpbmcgcXVlcmllZAogICAgZnVuY3Rpb24gZ2V0VmFsdWVBdChDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfYmxvY2sKICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkgcmV0dXJuIDA7CgogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlCiAgICAgICAgaWYgKF9ibG9jayA+PSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0uZnJvbUJsb2NrKQogICAgICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLnZhbHVlOwogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOwoKICAgICAgICAvLyBCaW5hcnkgc2VhcmNoIG9mIHRoZSB2YWx1ZSBpbiB0aGUgYXJyYXkKICAgICAgICB1aW50IG1pbiA9IDA7CiAgICAgICAgdWludCBtYXggPSBjaGVja3BvaW50cy5sZW5ndGgtMTsKICAgICAgICB3aGlsZSAobWF4ID4gbWluKSB7CiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOwogICAgICAgICAgICBpZiAoY2hlY2twb2ludHNbbWlkXS5mcm9tQmxvY2s8PV9ibG9jaykgewogICAgICAgICAgICAgICAgbWluID0gbWlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWF4ID0gbWlkLTE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7CiAgICB9CgogICAgLy8vIEBkZXYgYHVwZGF0ZVZhbHVlQXROb3dgIHVzZWQgdG8gdXBkYXRlIHRoZSBgYmFsYW5jZXNgIG1hcCBhbmQgdGhlCiAgICAvLy8gIGB0b3RhbFN1cHBseUhpc3RvcnlgCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG5ldyBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZUF0Tm93KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF92YWx1ZQogICAgKSBpbnRlcm5hbCAgewogICAgICAgIGlmICgoY2hlY2twb2ludHMubGVuZ3RoID09IDApCiAgICAgICAgfHwgKGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtMV0uZnJvbUJsb2NrIDwgYmxvY2subnVtYmVyKSkgewogICAgICAgICAgICAgICBDaGVja3BvaW50IG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC5mcm9tQmxvY2sgPSAgdWludDEyOChibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uOiBJZiB0aGUgY29udHJhY3QncyBjb250cm9sbGVyIGhhcyBub3QgYmVlbgogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlCiAgICAvLy8gIGV0aGVyIGFuZCBjcmVhdGVzIHRva2VucyBhcyBkZXNjcmliZWQgaW4gdGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QKICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICBpZiAoISBDb250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKQogICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gRXZlbnRzCi8vLy8vLy8vLy8vLy8vLy8KICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gTWluaU1lVG9rZW5GYWN0b3J5Ci8vLy8vLy8vLy8vLy8vLy8KCi8vLyBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCB0byBnZW5lcmF0ZSBjbG9uZSBjb250cmFjdHMgZnJvbSBhIGNvbnRyYWN0LgovLy8gIEluIHNvbGlkaXR5IHRoaXMgaXMgdGhlIHdheSB0byBjcmVhdGUgYSBjb250cmFjdCBmcm9tIGEgY29udHJhY3Qgb2YgdGhlCi8vLyAgc2FtZSBjbGFzcwpjb250cmFjdCBNaW5pTWVUb2tlbkZhY3RvcnkgewoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZSB0aGUgREFwcCBieSBjcmVhdGluZyBhIG5ldyB0b2tlbiB3aXRoIG5ldyBmdW5jdGlvbmFsaXRpZXMKICAgIC8vLyAgdGhlIG1zZy5zZW5kZXIgYmVjb21lcyB0aGUgY29udHJvbGxlciBvZiB0aGlzIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSB0b2tlbiBiZWluZyBjbG9uZWQKICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwKICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdG9rZW4gY29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSByZXR1cm5zIChNaW5pTWVUb2tlbikgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOwogICAgfQp9CgoKLyoKICAgIENvcHlyaWdodCAyMDE3LCBKb3JnZSBJenF1aWVyZG8gKEFyYWdvbiBGb3VuZGF0aW9uKQoKICAgIEJhc2VkIG9uIFZlc3RlZFRva2VuLnNvbCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKCiAgICBTYWZlTWF0aCDigJMgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogICAgTWluaU1lVG9rZW4g4oCTIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hIChHaXZldGgpCiAqLwoKLy8gQGRldiBNaW5pTWVJcnJldm9jYWJsZVZlc3RlZFRva2VuIGlzIGEgZGVyaXZlZCB2ZXJzaW9uIG9mIE1pbmlNZVRva2VuIGFkZGluZyB0aGUKLy8gYWJpbGl0eSB0byBjcmVhdGVUb2tlbkdyYW50cyB3aGljaCBhcmUgYmFzaWNhbGx5IGEgdHJhbnNmZXIgdGhhdCBsaW1pdHMgdGhlCi8vIHJlY2VpdmVyIG9mIHRoZSB0b2tlbnMgaG93IGNhbiBoZSBzcGVuZCB0aGVtIG92ZXIgdGltZS4KCi8vIEZvciBzaW1wbGljaXR5LCB0b2tlbiBncmFudHMgYXJlIG5vdCBzYXZlZCBpbiBNaW5pTWUgdHlwZSBjaGVja3BvaW50cy4KLy8gVmFuaWxsYSBjbG9uaW5nIEFOVCB3aWxsIGNsb25lIGl0IGludG8gYSBNaW5pTWVUb2tlbiB3aXRob3V0IHZlc3RpbmcuCi8vIE1vcmUgY29tcGxleCBjbG9uaW5nIGNvdWxkIGFjY291bnQgZm9yIHBhc3QgdmVzdGluZyBjYWxlbmRhcnMuCgpjb250cmFjdCBNaW5pTWVJcnJldm9jYWJsZVZlc3RlZFRva2VuIGlzIE1pbmlNZVRva2VuLCBTYWZlTWF0aCB7CiAgLy8gS2VlcCB0aGUgc3RydWN0IGF0IDIgc3N0b3JlcyAoMSBzbG90IGZvciB2YWx1ZSArIDY0ICogMyAoZGF0ZXMpICsgMjAgKGFkZHJlc3MpID0gMiBzbG90cyAoMm5kIHNsb3QgaXMgMjEyIGJ5dGVzLCBsb3dlciB0aGFuIDI1NikpCiAgc3RydWN0IFRva2VuR3JhbnQgewogICAgYWRkcmVzcyBncmFudGVyOwogICAgdWludDI1NiB2YWx1ZTsKICAgIHVpbnQ2NCBjbGlmZjsKICAgIHVpbnQ2NCB2ZXN0aW5nOwogICAgdWludDY0IHN0YXJ0OwogIH0KCiAgZXZlbnQgTmV3VG9rZW5HcmFudChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlLCB1aW50NjQgc3RhcnQsIHVpbnQ2NCBjbGlmZiwgdWludDY0IHZlc3RpbmcpOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IFRva2VuR3JhbnRbXSkgcHVibGljIGdyYW50czsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBjYW5DcmVhdGVHcmFudHM7CiAgYWRkcmVzcyB2ZXN0aW5nV2hpdGVsaXN0ZXI7CgogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdmFsdWUpIHsKICAgIGlmIChfdmFsdWUgPiBzcGVuZGFibGVCYWxhbmNlT2YoX3NlbmRlcikpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlWZXN0aW5nV2hpdGVsaXN0ZXIgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gdmVzdGluZ1doaXRlbGlzdGVyKSB0aHJvdzsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBNaW5pTWVJcnJldm9jYWJsZVZlc3RlZFRva2VuICgKICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywKICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICApIE1pbmlNZVRva2VuKF90b2tlbkZhY3RvcnksIF9wYXJlbnRUb2tlbiwgX3BhcmVudFNuYXBTaG90QmxvY2ssIF90b2tlbk5hbWUsIF9kZWNpbWFsVW5pdHMsIF90b2tlblN5bWJvbCwgX3RyYW5zZmVyc0VuYWJsZWQpIHsKICAgIHZlc3RpbmdXaGl0ZWxpc3RlciA9IG1zZy5zZW5kZXI7CiAgICBkb1NldENhbkNyZWF0ZUdyYW50cyh2ZXN0aW5nV2hpdGVsaXN0ZXIsIHRydWUpOwogIH0KCiAgLy8gQGRldiBBZGQgY2FuVHJhbnNmZXIgbW9kaWZpZXIgYmVmb3JlIGFsbG93aW5nIHRyYW5zZmVyIGFuZCB0cmFuc2ZlckZyb20gdG8gZ28gdGhyb3VnaAogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgICAgICAgICBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdmFsdWUpCiAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgICAgICAgICBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKQogICAgICAgICAgIHB1YmxpYwogICAgICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gc3BlbmRhYmxlQmFsYW5jZU9mKGFkZHJlc3MgX2hvbGRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0cmFuc2ZlcmFibGVUb2tlbnMoX2hvbGRlciwgdWludDY0KG5vdykpOwogIH0KCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgdWludDY0IF9zdGFydCwKICAgIHVpbnQ2NCBfY2xpZmYsCiAgICB1aW50NjQgX3Zlc3RpbmcpIHB1YmxpYyB7CgogICAgLy8gQ2hlY2sgc3RhcnQsIGNsaWZmIGFuZCB2ZXN0aW5nIGFyZSBwcm9wZXJseSBvcmRlciB0byBlbnN1cmUgY29ycmVjdCBmdW5jdGlvbmFsaXR5IG9mIHRoZSBmb3JtdWxhLgogICAgaWYgKF9jbGlmZiA8IF9zdGFydCkgdGhyb3c7CiAgICBpZiAoX3Zlc3RpbmcgPCBfc3RhcnQpIHRocm93OwogICAgaWYgKF92ZXN0aW5nIDwgX2NsaWZmKSB0aHJvdzsKCiAgICBpZiAoIWNhbkNyZWF0ZUdyYW50c1ttc2cuc2VuZGVyXSkgdGhyb3c7CiAgICBpZiAodG9rZW5HcmFudHNDb3VudChfdG8pID4gMjApIHRocm93OyAgIC8vIFRvIHByZXZlbnQgYSB1c2VyIGJlaW5nIHNwYW1tZWQgYW5kIGhhdmUgaGlzIGJhbGFuY2UgbG9ja2VkIChvdXQgb2YgZ2FzIGF0dGFjayB3aGVuIGNhbGN1bGF0aW5nIHZlc3RpbmcpLgoKICAgIFRva2VuR3JhbnQgbWVtb3J5IGdyYW50ID0gVG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdmFsdWUsIF9jbGlmZiwgX3Zlc3RpbmcsIF9zdGFydCk7CiAgICBncmFudHNbX3RvXS5wdXNoKGdyYW50KTsKCiAgICBpZiAoIXRyYW5zZmVyKF90bywgX3ZhbHVlKSkgdGhyb3c7CgogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2NsaWZmLCBfdmVzdGluZywgX3N0YXJ0KTsKICB9CgogIGZ1bmN0aW9uIHNldENhbkNyZWF0ZUdyYW50cyhhZGRyZXNzIF9hZGRyLCBib29sIF9hbGxvd2VkKQogICAgICAgICAgIG9ubHlWZXN0aW5nV2hpdGVsaXN0ZXIgcHVibGljIHsKICAgIGRvU2V0Q2FuQ3JlYXRlR3JhbnRzKF9hZGRyLCBfYWxsb3dlZCk7CiAgfQoKICBmdW5jdGlvbiBkb1NldENhbkNyZWF0ZUdyYW50cyhhZGRyZXNzIF9hZGRyLCBib29sIF9hbGxvd2VkKQogICAgICAgICAgIGludGVybmFsIHsKICAgIGNhbkNyZWF0ZUdyYW50c1tfYWRkcl0gPSBfYWxsb3dlZDsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZVZlc3RpbmdXaGl0ZWxpc3RlcihhZGRyZXNzIF9uZXdXaGl0ZWxpc3Rlcikgb25seVZlc3RpbmdXaGl0ZWxpc3RlciBwdWJsaWMgewogICAgZG9TZXRDYW5DcmVhdGVHcmFudHModmVzdGluZ1doaXRlbGlzdGVyLCBmYWxzZSk7CiAgICB2ZXN0aW5nV2hpdGVsaXN0ZXIgPSBfbmV3V2hpdGVsaXN0ZXI7CiAgICBkb1NldENhbkNyZWF0ZUdyYW50cyh2ZXN0aW5nV2hpdGVsaXN0ZXIsIHRydWUpOwogIH0KCiAgLy8gQGRldiBOb3QgYWxsb3cgdG9rZW4gZ3JhbnRzCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIHB1YmxpYyB7CiAgICB0aHJvdzsKICB9CgogIC8vCiAgZnVuY3Rpb24gdG9rZW5HcmFudHNDb3VudChhZGRyZXNzIF9ob2xkZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CgogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nKSB7CiAgICBUb2tlbkdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKCiAgICBncmFudGVyID0gZ3JhbnQuZ3JhbnRlcjsKICAgIHZhbHVlID0gZ3JhbnQudmFsdWU7CiAgICBzdGFydCA9IGdyYW50LnN0YXJ0OwogICAgY2xpZmYgPSBncmFudC5jbGlmZjsKICAgIHZlc3RpbmcgPSBncmFudC52ZXN0aW5nOwoKICAgIHZlc3RlZCA9IHZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOwogIH0KCiAgZnVuY3Rpb24gdmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgICBncmFudC52YWx1ZSwKICAgICAgdWludDI1Nih0aW1lKSwKICAgICAgdWludDI1NihncmFudC5zdGFydCksCiAgICAgIHVpbnQyNTYoZ3JhbnQuY2xpZmYpLAogICAgICB1aW50MjU2KGdyYW50LnZlc3RpbmcpCiAgICApOwogIH0KCiAgLy8gIHRyYW5zZmVyYWJsZVRva2VucwogIC8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgTm9uVmVzdGVkVG9rZW5zCiAgLy8gICB8ICAgICAgICAgICAgICAgICAgICAgICBfLwogIC8vICAgfCAgICAgICAgICAgICAgICAgICAgIF8vCiAgLy8gICB8ICAgICAgICAgICAgICAgICAgIF8vCiAgLy8gICB8ICAgICAgICAgICAgICAgICBfLwogIC8vICAgfCAgICAgICAgICAgICAgICAvCiAgLy8gICB8ICAgICAgICAgICAgICAufAogIC8vICAgfCAgICAgICAgICAgIC4gIHwKICAvLyAgIHwgICAgICAgICAgLiAgICB8CiAgLy8gICB8ICAgICAgICAuICAgICAgfAogIC8vICAgfCAgICAgIC4gICAgICAgIHwKICAvLyAgIHwgICAgLiAgICAgICAgICB8CiAgLy8gICArPT09Kz09PT09PT09PT09Ky0tLS0tLS0tLSstLS0tLS0tLS0tPiB0aW1lCiAgLy8gICAgICBTdGFydCAgICAgICBDbGlmdCAgICBWZXN0aW5nCgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICAgIHVpbnQyNTYgdG9rZW5zLAogICAgdWludDI1NiB0aW1lLAogICAgdWludDI1NiBzdGFydCwKICAgIHVpbnQyNTYgY2xpZmYsCiAgICB1aW50MjU2IHZlc3RpbmcpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgICB7CgogICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuCiAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsKICAgIGlmICh0aW1lID49IHZlc3RpbmcpIHJldHVybiB0b2tlbnM7CgogICAgLy8gSW50ZXJwb2xhdGUgYWxsIHZlc3RlZCB0b2tlbnMuCiAgICAvLyBBcyBiZWZvcmUgY2xpZmYgdGhlIHNob3J0Y3V0IHJldHVybnMgMCwgd2UgY2FuIHVzZSBqdXN0IHRoaXMgZnVuY3Rpb24gdG8KICAgIC8vIGNhbGN1bGF0ZSBpdC4KCiAgICAvLyB2ZXN0ZWRUb2tlbnMgPSB0b2tlbnMgKiAodGltZSAtIHN0YXJ0KSAvICh2ZXN0aW5nIC0gc3RhcnQpCiAgICB1aW50MjU2IHZlc3RlZFRva2VucyA9IHNhZmVEaXYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYWZlTXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVTdWIodGltZSwgc3RhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYWZlU3ViKHZlc3RpbmcsIHN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICByZXR1cm4gdmVzdGVkVG9rZW5zOwogIH0KCiAgZnVuY3Rpb24gbm9uVmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBPZiBhbGwgdGhlIHRva2VucyBvZiB0aGUgZ3JhbnQsIGhvdyBtYW55IG9mIHRoZW0gYXJlIG5vdCB2ZXN0ZWQ/CiAgICAvLyBncmFudFZhbHVlIC0gdmVzdGVkVG9rZW5zCiAgICByZXR1cm4gc2FmZVN1YihncmFudC52YWx1ZSwgdmVzdGVkVG9rZW5zKGdyYW50LCB0aW1lKSk7CiAgfQoKICAvLyBAZGV2IFRoZSBkYXRlIGluIHdoaWNoIGFsbCB0b2tlbnMgYXJlIHRyYW5zZmVyYWJsZSBmb3IgdGhlIGhvbGRlcgogIC8vIFVzZWZ1bCBmb3IgZGlzcGxheWluZyBwdXJwb3NlcyAobm90IHVzZWQgaW4gYW55IGxvZ2ljIGNhbGN1bGF0aW9ucykKICBmdW5jdGlvbiBsYXN0VG9rZW5Jc1RyYW5zZmVyYWJsZURhdGUoYWRkcmVzcyBob2xkZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50NjQgZGF0ZSkgewogICAgZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgdWludDI1NiBncmFudEluZGV4ID0gdG9rZW5HcmFudHNDb3VudChob2xkZXIpOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIGRhdGUgPSBtYXg2NChncmFudHNbaG9sZGVyXVtpXS52ZXN0aW5nLCBkYXRlKTsKICAgIH0KICAgIHJldHVybiBkYXRlOwogIH0KCiAgLy8gQGRldiBIb3cgbWFueSB0b2tlbnMgY2FuIGEgaG9sZGVyIHRyYW5zZmVyIGF0IGEgcG9pbnQgaW4gdGltZQogIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGdyYW50SW5kZXggPSB0b2tlbkdyYW50c0NvdW50KGhvbGRlcik7CgogICAgaWYgKGdyYW50SW5kZXggPT0gMCkgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2VucwogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIG5vblZlc3RlZCA9IHNhZmVBZGQobm9uVmVzdGVkLCBub25WZXN0ZWRUb2tlbnMoZ3JhbnRzW2hvbGRlcl1baV0sIHRpbWUpKTsKICAgIH0KCiAgICAvLyBCYWxhbmNlIC0gdG90YWxOb25WZXN0ZWQgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYSBob2xkZXIgY2FuIHRyYW5zZmVyIGF0IGFueSBnaXZlbiB0aW1lCiAgICByZXR1cm4gc2FmZVN1YihiYWxhbmNlT2YoaG9sZGVyKSwgbm9uVmVzdGVkKTsKICB9Cn0KCi8qCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZ2UgSXpxdWllcmRvIChBcmFnb24gRm91bmRhdGlvbikKKi8KCmNvbnRyYWN0IEFOVCBpcyBNaW5pTWVJcnJldm9jYWJsZVZlc3RlZFRva2VuIHsKICAvLyBAZGV2IEFOVCBjb25zdHJ1Y3RvciBqdXN0IHBhcmFtZXRyaXplcyB0aGUgTWluaU1lSXJyZXZvY2FibGVWZXN0ZWRUb2tlbiBjb25zdHJ1Y3RvcgogIGZ1bmN0aW9uIEFOVCgKICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeQogICkgTWluaU1lSXJyZXZvY2FibGVWZXN0ZWRUb2tlbigKICAgIF90b2tlbkZhY3RvcnksCiAgICAweDAsICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4KICAgIDAsICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgIkFyYWdvbiBOZXR3b3JrIFRva2VuIiwgLy8gVG9rZW4gbmFtZQogICAgMTgsICAgICAgICAgICAgICAgICAgICAgLy8gRGVjaW1hbHMKICAgICJBTlQiLCAgICAgICAgICAgICAgICAgIC8vIFN5bWJvbAogICAgdHJ1ZSAgICAgICAgICAgICAgICAgICAgLy8gRW5hYmxlIHRyYW5zZmVycwogICAgKSB7fQp9CgoKCi8qCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZ2UgSXpxdWllcmRvIChBcmFnb24gRm91bmRhdGlvbikKICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hIChHaXZldGgpCgogICAgQmFzZWQgb24gU2FtcGxlQ2FtcGFpZ24tVG9rZW5Db250cm9sbGVyLnNvbCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9HaXZldGgvbWluaW1lCiAqLwoKY29udHJhY3QgQXJhZ29uVG9rZW5TYWxlIGlzIENvbnRyb2xsZXIsIFNhZmVNYXRoIHsKICAgIHVpbnQgcHVibGljIGluaXRpYWxCbG9jazsgICAgICAgICAgICAgLy8gQmxvY2sgbnVtYmVyIGluIHdoaWNoIHRoZSBzYWxlIHN0YXJ0cy4gSW5jbHVzaXZlLiBzYWxlIHdpbGwgYmUgb3BlbmVkIGF0IGluaXRpYWwgYmxvY2suCiAgICB1aW50IHB1YmxpYyBmaW5hbEJsb2NrOyAgICAgICAgICAgICAgIC8vIEJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgc2FsZSBlbmQuIEV4Y2x1c2l2ZSwgc2FsZSB3aWxsIGJlIGNsb3NlZCBhdCBlbmRzIGJsb2NrLgogICAgdWludCBwdWJsaWMgaW5pdGlhbFByaWNlOyAgICAgICAgICAgICAvLyBOdW1iZXIgb2Ygd2VpLUFOVCB0b2tlbnMgZm9yIDEgd2VpLCBhdCB0aGUgc3RhcnQgb2YgdGhlIHNhbGUgKDE4IGRlY2ltYWxzKQogICAgdWludCBwdWJsaWMgZmluYWxQcmljZTsgICAgICAgICAgICAgICAvLyBOdW1iZXIgb2Ygd2VpLUFOVCB0b2tlbnMgZm9yIDEgd2VpLCBhdCB0aGUgZW5kIG9mIHRoZSBzYWxlCiAgICB1aW50OCBwdWJsaWMgcHJpY2VTdGFnZXM7ICAgICAgICAgICAgIC8vIE51bWJlciBvZiBkaWZmZXJlbnQgcHJpY2Ugc3RhZ2VzIGZvciBpbnRlcnBvbGF0aW5nIGJldHdlZW4gaW5pdGlhbFByaWNlIGFuZCBmaW5hbFByaWNlCiAgICBhZGRyZXNzIHB1YmxpYyBhcmFnb25EZXZNdWx0aXNpZzsgICAgIC8vIFRoZSBhZGRyZXNzIHRvIGhvbGQgdGhlIGZ1bmRzIGRvbmF0ZWQKICAgIGFkZHJlc3MgcHVibGljIGNvbW11bml0eU11bHRpc2lnOyAgICAgLy8gQ29tbXVuaXR5IHRydXN0ZWQgbXVsdGlzaWcgdG8gZGVwbG95IG5ldHdvcmsKICAgIGJ5dGVzMzIgcHVibGljIGNhcENvbW1pdG1lbnQ7CgogICAgdWludCBwdWJsaWMgdG90YWxDb2xsZWN0ZWQgPSAwOyAgICAgICAgICAgICAgIC8vIEluIHdlaQogICAgYm9vbCBwdWJsaWMgc2FsZVN0b3BwZWQgPSBmYWxzZTsgICAgICAgICAgICAgIC8vIEhhcyBBcmFnb24gRGV2IHN0b3BwZWQgdGhlIHNhbGU/CiAgICBib29sIHB1YmxpYyBzYWxlRmluYWxpemVkID0gZmFsc2U7ICAgICAgICAgICAgLy8gSGFzIEFyYWdvbiBEZXYgZmluYWxpemVkIHRoZSBzYWxlPwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGFjdGl2YXRlZDsgICAvLyBBZGRyZXNzIGNvbmZpcm1hdGVzIHRoYXQgd2FudHMgdG8gYWN0aXZhdGUgdGhlIHNhbGUKCiAgICBBTlQgcHVibGljIHRva2VuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHRva2VuCiAgICBBTlBsYWNlaG9sZGVyIHB1YmxpYyBuZXR3b3JrUGxhY2Vob2xkZXI7ICAgICAgLy8gVGhlIG5ldHdvcmsgcGxhY2Vob2xkZXIKICAgIFNhbGVXYWxsZXQgcHVibGljIHNhbGVXYWxsZXQ7ICAgICAgICAgICAgICAgICAgICAvLyBXYWxsZXQgdGhhdCByZWNlaXZlcyBhbGwgc2FsZSBmdW5kcwoKICAgIHVpbnQgY29uc3RhbnQgcHVibGljIGR1c3QgPSAxIGZpbm5leTsgICAgICAgICAvLyBNaW5pbXVtIGludmVzdG1lbnQKICAgIHVpbnQgcHVibGljIGhhcmRDYXAgPSAxMDAwMDAwIGV0aGVyOyAgICAgICAgICAvLyBIYXJkIGNhcCB0byBwcm90ZWN0IHRoZSBFVEggbmV0d29yayBmcm9tIGEgcmVhbGx5IGhpZ2ggcmFpc2UKCiAgICBldmVudCBOZXdQcmVzYWxlQWxsb2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50MjU2IGFudEFtb3VudCk7CiAgICBldmVudCBOZXdCdXllcihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50MjU2IGFudEFtb3VudCwgdWludDI1NiBldGhlckFtb3VudCk7CiAgICBldmVudCBDYXBSZXZlYWxlZCh1aW50IHZhbHVlLCB1aW50IHNlY3JldCwgYWRkcmVzcyByZXZlYWxlcik7Ci8vLyBAZGV2IFRoZXJlIGFyZSBzZXZlcmFsIGNoZWNrcyB0byBtYWtlIHN1cmUgdGhlIHBhcmFtZXRlcnMgYXJlIGFjY2VwdGFibGUKLy8vIEBwYXJhbSBfaW5pdGlhbEJsb2NrIFRoZSBCbG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIHNhbGUgc3RhcnRzCi8vLyBAcGFyYW0gX2ZpbmFsQmxvY2sgVGhlIEJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgc2FsZSBlbmRzCi8vLyBAcGFyYW0gX2FyYWdvbkRldk11bHRpc2lnIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzdG9yZSB0aGUgZG9uYXRlZCBmdW5kcyBhbmQgbWFuYWdlcgovLy8gZm9yIHRoZSBzYWxlCi8vLyBAcGFyYW0gX2luaXRpYWxQcmljZSBUaGUgcHJpY2UgZm9yIHRoZSBmaXJzdCBzdGFnZSBvZiB0aGUgc2FsZS4gUHJpY2UgaW4gd2VpLUFOVCBwZXIgd2VpLgovLy8gQHBhcmFtIF9maW5hbFByaWNlIFRoZSBwcmljZSBmb3IgdGhlIGZpbmFsIHN0YWdlIG9mIHRoZSBzYWxlLiBQcmljZSBpbiB3ZWktQU5UIHBlciB3ZWkuCi8vLyBAcGFyYW0gX3ByaWNlU3RhZ2VzIFRoZSBudW1iZXIgb2YgcHJpY2Ugc3RhZ2VzLiBUaGUgcHJpY2UgZm9yIGV2ZXJ5IG1pZGRsZSBzdGFnZQovLy8gd2lsbCBiZSBsaW5lYXJseSBpbnRlcnBvbGF0ZWQuCi8qCiBwcmljZQogICAgICAgIF4KICAgICAgICB8CkluaXRpYWwgfCAgICAgICBzID0gMApwcmljZSAgIHwgICAgICArLS0tLS0tKwogICAgICAgIHwgICAgICB8ICAgICAgfCBzID0gMQogICAgICAgIHwgICAgICB8ICAgICAgKy0tLS0tLSsKICAgICAgICB8ICAgICAgfCAgICAgICAgICAgICB8IHMgPSAyCiAgICAgICAgfCAgICAgIHwgICAgICAgICAgICAgKy0tLS0tLSsKICAgICAgICB8ICAgICAgfCAgICAgICAgICAgICAgICAgICAgfCBzID0gMwpGaW5hbCAgIHwgICAgICB8ICAgICAgICAgICAgICAgICAgICArLS0tLS0tKwpwcmljZSAgIHwgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgICAgIHwgICAgICB8ICAgIGZvciBwcmljZVN0YWdlcyA9IDQgICAgfAogICAgICAgICstLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tPgogICAgICAgICAgSW5pdGlhbCAgICAgICAgICAgICAgICAgICAgIEZpbmFsICAgICAgIHRpbWUKICAgICAgICAgIGJsb2NrICAgICAgICAgICAgICAgICAgICAgICBibG9jawoKCkV2ZXJ5IHN0YWdlIGlzIHRoZSBzYW1lIHRpbWUgbGVuZ3RoLgpQcmljZSBpbmNyZWFzZXMgYnkgdGhlIHNhbWUgZGVsdGEgaW4gZXZlcnkgc3RhZ2UgY2hhbmdlCgoqLwoKICBmdW5jdGlvbiBBcmFnb25Ub2tlblNhbGUgKAogICAgICB1aW50IF9pbml0aWFsQmxvY2ssCiAgICAgIHVpbnQgX2ZpbmFsQmxvY2ssCiAgICAgIGFkZHJlc3MgX2FyYWdvbkRldk11bHRpc2lnLAogICAgICBhZGRyZXNzIF9jb21tdW5pdHlNdWx0aXNpZywKICAgICAgdWludDI1NiBfaW5pdGlhbFByaWNlLAogICAgICB1aW50MjU2IF9maW5hbFByaWNlLAogICAgICB1aW50OCBfcHJpY2VTdGFnZXMsCiAgICAgIGJ5dGVzMzIgX2NhcENvbW1pdG1lbnQKICApCiAgICAgIG5vbl96ZXJvX2FkZHJlc3MoX2FyYWdvbkRldk11bHRpc2lnKQogICAgICBub25femVyb19hZGRyZXNzKF9jb21tdW5pdHlNdWx0aXNpZykKICB7CiAgICAgIGlmIChfaW5pdGlhbEJsb2NrIDwgZ2V0QmxvY2tOdW1iZXIoKSkgdGhyb3c7CiAgICAgIGlmIChfaW5pdGlhbEJsb2NrID49IF9maW5hbEJsb2NrKSB0aHJvdzsKICAgICAgaWYgKF9pbml0aWFsUHJpY2UgPD0gX2ZpbmFsUHJpY2UpIHRocm93OwogICAgICBpZiAoX3ByaWNlU3RhZ2VzIDwgMikgdGhyb3c7CiAgICAgIGlmIChfcHJpY2VTdGFnZXMgPiBfaW5pdGlhbFByaWNlIC0gX2ZpbmFsUHJpY2UpIHRocm93OwogICAgICBpZiAodWludChfY2FwQ29tbWl0bWVudCkgPT0gMCkgdGhyb3c7CgogICAgICAvLyBTYXZlIGNvbnN0cnVjdG9yIGFyZ3VtZW50cyBhcyBnbG9iYWwgdmFyaWFibGVzCiAgICAgIGluaXRpYWxCbG9jayA9IF9pbml0aWFsQmxvY2s7CiAgICAgIGZpbmFsQmxvY2sgPSBfZmluYWxCbG9jazsKICAgICAgYXJhZ29uRGV2TXVsdGlzaWcgPSBfYXJhZ29uRGV2TXVsdGlzaWc7CiAgICAgIGNvbW11bml0eU11bHRpc2lnID0gX2NvbW11bml0eU11bHRpc2lnOwogICAgICBpbml0aWFsUHJpY2UgPSBfaW5pdGlhbFByaWNlOwogICAgICBmaW5hbFByaWNlID0gX2ZpbmFsUHJpY2U7CiAgICAgIHByaWNlU3RhZ2VzID0gX3ByaWNlU3RhZ2VzOwogICAgICBjYXBDb21taXRtZW50ID0gX2NhcENvbW1pdG1lbnQ7CiAgfQoKICAvLyBAbm90aWNlIERlcGxveSBBTlQgaXMgY2FsbGVkIG9ubHkgb25jZSB0byBzZXR1cCBhbGwgdGhlIG5lZWRlZCBjb250cmFjdHMuCiAgLy8gQHBhcmFtIF90b2tlbjogQWRkcmVzcyBvZiBhbiBpbnN0YW5jZSBvZiB0aGUgQU5UIHRva2VuCiAgLy8gQHBhcmFtIF9uZXR3b3JrUGxhY2Vob2xkZXI6IEFkZHJlc3Mgb2YgYW4gaW5zdGFuY2Ugb2YgQU5QbGFjZWhvbGRlcgogIC8vIEBwYXJhbSBfc2FsZVdhbGxldDogQWRkcmVzcyBvZiB0aGUgd2FsbGV0IHJlY2VpdmluZyB0aGUgZnVuZHMgb2YgdGhlIHNhbGUKCiAgZnVuY3Rpb24gc2V0QU5UKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9uZXR3b3JrUGxhY2Vob2xkZXIsIGFkZHJlc3MgX3NhbGVXYWxsZXQpCiAgICAgICAgICAgbm9uX3plcm9fYWRkcmVzcyhfdG9rZW4pCiAgICAgICAgICAgbm9uX3plcm9fYWRkcmVzcyhfbmV0d29ya1BsYWNlaG9sZGVyKQogICAgICAgICAgIG5vbl96ZXJvX2FkZHJlc3MoX3NhbGVXYWxsZXQpCiAgICAgICAgICAgb25seShhcmFnb25EZXZNdWx0aXNpZykKICAgICAgICAgICBwdWJsaWMgewoKICAgIC8vIEFzc2VydCB0aGF0IHRoZSBmdW5jdGlvbiBoYXNuJ3QgYmVlbiBjYWxsZWQgYmVmb3JlLCBhcyBhY3RpdmF0ZSB3aWxsIGhhcHBlbiBhdCB0aGUgZW5kCiAgICBpZiAoYWN0aXZhdGVkW3RoaXNdKSB0aHJvdzsKCiAgICB0b2tlbiA9IEFOVChfdG9rZW4pOwogICAgbmV0d29ya1BsYWNlaG9sZGVyID0gQU5QbGFjZWhvbGRlcihfbmV0d29ya1BsYWNlaG9sZGVyKTsKICAgIHNhbGVXYWxsZXQgPSBTYWxlV2FsbGV0KF9zYWxlV2FsbGV0KTsKCiAgICBpZiAodG9rZW4uY29udHJvbGxlcigpICE9IGFkZHJlc3ModGhpcykpIHRocm93OyAvLyBzYWxlIGlzIGNvbnRyb2xsZXIKICAgIGlmIChuZXR3b3JrUGxhY2Vob2xkZXIuc2FsZSgpICE9IGFkZHJlc3ModGhpcykpIHRocm93OyAvLyBwbGFjZWhvbGRlciBoYXMgcmVmZXJlbmNlIHRvIFNhbGUKICAgIGlmIChuZXR3b3JrUGxhY2Vob2xkZXIudG9rZW4oKSAhPSBhZGRyZXNzKHRva2VuKSkgdGhyb3c7IC8vIHBsYWNlaG9sZGVyIGhhcyByZWZlcmVuY2UgdG8gQU5UCiAgICBpZiAodG9rZW4udG90YWxTdXBwbHkoKSA+IDApIHRocm93OyAvLyB0b2tlbiBpcyBlbXB0eQogICAgaWYgKHNhbGVXYWxsZXQuZmluYWxCbG9jaygpICE9IGZpbmFsQmxvY2spIHRocm93OyAvLyBmaW5hbCBibG9ja3MgbXVzdCBtYXRjaAogICAgaWYgKHNhbGVXYWxsZXQubXVsdGlzaWcoKSAhPSBhcmFnb25EZXZNdWx0aXNpZykgdGhyb3c7IC8vIHJlY2VpdmluZyB3YWxsZXQgbXVzdCBtYXRjaAogICAgaWYgKHNhbGVXYWxsZXQudG9rZW5TYWxlKCkgIT0gYWRkcmVzcyh0aGlzKSkgdGhyb3c7IC8vIHdhdGNoZWQgdG9rZW4gc2FsZSBtdXN0IGJlIHNlbGYKCiAgICAvLyBDb250cmFjdCBhY3RpdmF0ZXMgc2FsZSBhcyBhbGwgcmVxdWlyZW1lbnRzIGFyZSByZWFkeQogICAgZG9BY3RpdmF0ZVNhbGUodGhpcyk7CiAgfQoKICAvLyBAbm90aWNlIENlcnRhaW4gYWRkcmVzc2VzIG5lZWQgdG8gY2FsbCB0aGUgYWN0aXZhdGUgZnVuY3Rpb24gcHJpb3IgdG8gdGhlIHNhbGUgb3BlbmluZyBibG9jay4KICAvLyBUaGlzIHByb3ZlcyB0aGF0IHRoZXkgaGF2ZSBjaGVja2VkIHRoZSBzYWxlIGNvbnRyYWN0IGlzIGxlZ2l0LCBhcyB3ZWxsIGFzIHByb3ZpbmcKICAvLyB0aGUgY2FwYWJpbGl0eSBmb3IgdGhvc2UgYWRkcmVzc2VzIHRvIGludGVyYWN0IHdpdGggdGhlIGNvbnRyYWN0LgogIGZ1bmN0aW9uIGFjdGl2YXRlU2FsZSgpCiAgICAgICAgICAgcHVibGljIHsKICAgIGRvQWN0aXZhdGVTYWxlKG1zZy5zZW5kZXIpOwogIH0KCiAgZnVuY3Rpb24gZG9BY3RpdmF0ZVNhbGUoYWRkcmVzcyBfZW50aXR5KQogICAgbm9uX3plcm9fYWRkcmVzcyh0b2tlbikgICAgICAgICAgICAgICAvLyBjYW5ub3QgYWN0aXZhdGUgYmVmb3JlIHNldHRpbmcgdG9rZW4KICAgIG9ubHlfYmVmb3JlX3NhbGUKICAgIHByaXZhdGUgewogICAgYWN0aXZhdGVkW19lbnRpdHldID0gdHJ1ZTsKICB9CgogIC8vIEBub3RpY2UgV2hldGhlciB0aGUgbmVlZGVkIGFjY291bnRzIGhhdmUgYWN0aXZhdGVkIHRoZSBzYWxlLgogIC8vIEByZXR1cm4gSXMgc2FsZSBhY3RpdmF0ZWQKICBmdW5jdGlvbiBpc0FjdGl2YXRlZCgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gYWN0aXZhdGVkW3RoaXNdICYmIGFjdGl2YXRlZFthcmFnb25EZXZNdWx0aXNpZ10gJiYgYWN0aXZhdGVkW2NvbW11bml0eU11bHRpc2lnXTsKICB9CgogIC8vIEBub3RpY2UgR2V0IHRoZSBwcmljZSBmb3IgYSBBTlQgdG9rZW4gYXQgYW55IGdpdmVuIGJsb2NrIG51bWJlcgogIC8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgdGhlIGJsb2NrIGZvciB3aGljaCB0aGUgcHJpY2UgaXMgcmVxdWVzdGVkCiAgLy8gQHJldHVybiBOdW1iZXIgb2Ygd2VpLUFOVCBmb3IgMSB3ZWkKICAvLyBJZiBzYWxlIGlzbid0IG9uZ29pbmcgZm9yIHRoYXQgYmxvY2ssIHJldHVybnMgMC4KICBmdW5jdGlvbiBnZXRQcmljZSh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChfYmxvY2tOdW1iZXIgPCBpbml0aWFsQmxvY2sgfHwgX2Jsb2NrTnVtYmVyID49IGZpbmFsQmxvY2spIHJldHVybiAwOwoKICAgIHJldHVybiBwcmljZUZvclN0YWdlKHN0YWdlRm9yQmxvY2soX2Jsb2NrTnVtYmVyKSk7CiAgfQoKICAvLyBAbm90aWNlIEdldCB3aGF0IHRoZSBzdGFnZSBpcyBmb3IgYSBnaXZlbiBibG9ja051bWJlcgogIC8vIEBwYXJhbSBfYmxvY2tOdW1iZXI6IEJsb2NrIG51bWJlcgogIC8vIEByZXR1cm4gVGhlIHNhbGUgc3RhZ2UgZm9yIHRoYXQgYmxvY2suIFN0YWdlIGlzIGJldHdlZW4gMCBhbmQgKHByaWNlU3RhZ2VzIC0gMSkKICBmdW5jdGlvbiBzdGFnZUZvckJsb2NrKHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50OCkgewogICAgdWludCBibG9ja04gPSBzYWZlU3ViKF9ibG9ja051bWJlciwgaW5pdGlhbEJsb2NrKTsKICAgIHVpbnQgdG90YWxCbG9ja3MgPSBzYWZlU3ViKGZpbmFsQmxvY2ssIGluaXRpYWxCbG9jayk7CgogICAgcmV0dXJuIHVpbnQ4KHNhZmVEaXYoc2FmZU11bChwcmljZVN0YWdlcywgYmxvY2tOKSwgdG90YWxCbG9ja3MpKTsKICB9CgogIC8vIEBub3RpY2UgR2V0IHdoYXQgdGhlIHByaWNlIGlzIGZvciBhIGdpdmVuIHN0YWdlCiAgLy8gQHBhcmFtIF9zdGFnZTogU3RhZ2UgbnVtYmVyCiAgLy8gQHJldHVybiBQcmljZSBpbiB3ZWkgZm9yIHRoYXQgc3RhZ2UuCiAgLy8gSWYgc2FsZSBzdGFnZSBkb2Vzbid0IGV4aXN0LCByZXR1cm5zIDAuCiAgZnVuY3Rpb24gcHJpY2VGb3JTdGFnZSh1aW50OCBfc3RhZ2UpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChfc3RhZ2UgPj0gcHJpY2VTdGFnZXMpIHJldHVybiAwOwogICAgdWludCBwcmljZURpZmZlcmVuY2UgPSBzYWZlU3ViKGluaXRpYWxQcmljZSwgZmluYWxQcmljZSk7CiAgICB1aW50IHN0YWdlRGVsdGEgPSBzYWZlRGl2KHByaWNlRGlmZmVyZW5jZSwgdWludChwcmljZVN0YWdlcyAtIDEpKTsKICAgIHJldHVybiBzYWZlU3ViKGluaXRpYWxQcmljZSwgc2FmZU11bCh1aW50MjU2KF9zdGFnZSksIHN0YWdlRGVsdGEpKTsKICB9CgogIC8vIEBub3RpY2UgQXJhZ29uIERldiBuZWVkcyB0byBtYWtlIGluaXRpYWwgdG9rZW4gYWxsb2NhdGlvbnMgZm9yIHByZXNhbGUgcGFydG5lcnMKICAvLyBUaGlzIGFsbG9jYXRpb24gaGFzIHRvIGJlIG1hZGUgYmVmb3JlIHRoZSBzYWxlIGlzIGFjdGl2YXRlZC4gQWN0aXZhdGluZyB0aGUgc2FsZSBtZWFucyBubyBtb3JlCiAgLy8gYXJiaXRyYXJ5IGFsbG9jYXRpb25zIGFyZSBwb3NzaWJsZSBhbmQgZXhwcmVzc2VzIGNvbmZvcm1pdHkuCiAgLy8gQHBhcmFtIF9yZWNlaXZlcjogVGhlIHJlY2VpdmVyIG9mIHRoZSB0b2tlbnMKICAvLyBAcGFyYW0gX2Ftb3VudDogQW1vdW50IG9mIHRva2VucyBhbGxvY2F0ZWQgZm9yIHJlY2VpdmVyLgogIGZ1bmN0aW9uIGFsbG9jYXRlUHJlc2FsZVRva2VucyhhZGRyZXNzIF9yZWNlaXZlciwgdWludCBfYW1vdW50LCB1aW50NjQgY2xpZmZEYXRlLCB1aW50NjQgdmVzdGluZ0RhdGUpCiAgICAgICAgICAgb25seV9iZWZvcmVfc2FsZV9hY3RpdmF0aW9uCiAgICAgICAgICAgb25seV9iZWZvcmVfc2FsZQogICAgICAgICAgIG5vbl96ZXJvX2FkZHJlc3MoX3JlY2VpdmVyKQogICAgICAgICAgIG9ubHkoYXJhZ29uRGV2TXVsdGlzaWcpCiAgICAgICAgICAgcHVibGljIHsKCiAgICBpZiAoX2Ftb3VudCA+IDEwICoqIDI0KSB0aHJvdzsgLy8gMSBtaWxsaW9uIEFOVC4gTm8gcHJlc2FsZSBwYXJ0bmVyIHdpbGwgaGF2ZSBtb3JlIHRoYW4gdGhpcyBhbGxvY2F0ZWQuIFByZXZlbnQgb3ZlcmZsb3dzLgoKICAgIGlmICghdG9rZW4uZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyh0aGlzKSwgX2Ftb3VudCkpIHRocm93OwogICAgdG9rZW4uZ3JhbnRWZXN0ZWRUb2tlbnMoX3JlY2VpdmVyLCBfYW1vdW50LCB1aW50NjQobm93KSwgY2xpZmZEYXRlLCB2ZXN0aW5nRGF0ZSk7CgogICAgTmV3UHJlc2FsZUFsbG9jYXRpb24oX3JlY2VpdmVyLCBfYW1vdW50KTsKICB9CgovLy8gQGRldiBUaGUgZmFsbGJhY2sgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gZXRoZXIgaXMgc2VudCB0byB0aGUgY29udHJhY3QsIGl0Ci8vLyBzaW1wbHkgY2FsbHMgYGRvUGF5bWVudCgpYCB3aXRoIHRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgYXMgdGhlCi8vLyBgX293bmVyYC4gUGF5YWJsZSBpcyBhIHJlcXVpcmVkIHNvbGlkaXR5IG1vZGlmaWVyIGZvciBmdW5jdGlvbnMgdG8gcmVjZWl2ZQovLy8gZXRoZXIsIHdpdGhvdXQgdGhpcyBtb2RpZmllciBmdW5jdGlvbnMgd2lsbCB0aHJvdyBpZiBldGhlciBpcyBzZW50IHRvIHRoZW0KCiAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgcmV0dXJuIGRvUGF5bWVudChtc2cuc2VuZGVyKTsKICB9CgovLy8vLy8vLy8vLy8vLy8vLwovLyBDb250cm9sbGVyIGludGVyZmFjZQovLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBub3RpY2UgYHByb3h5UGF5bWVudCgpYCBhbGxvd3MgdGhlIGNhbGxlciB0byBzZW5kIGV0aGVyIHRvIHRoZSBUb2tlbiBkaXJlY3RseSBhbmQKLy8vIGhhdmUgdGhlIHRva2VucyBjcmVhdGVkIGluIGFuIGFkZHJlc3Mgb2YgdGhlaXIgY2hvb3NpbmcKLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zCgogIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgZG9QYXltZW50KF9vd25lcik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgovLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRyYW5zZmVyLCBmb3IgdGhpcyBzYWxlIGFsbAovLy8gIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBieSBkZWZhdWx0IGFuZCBubyBleHRyYSBub3RpZmljYXRpb25zIGFyZSBuZWVkZWQKLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgovLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCi8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgovLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgLy8gVW50aWwgdGhlIHNhbGUgaXMgZmluYWxpemVkLCBvbmx5IGFsbG93cyB0cmFuc2ZlcnMgb3JpZ2luYXRlZCBieSB0aGUgc2FsZSBjb250cmFjdC4KICAgIC8vIFdoZW4gZmluYWxpemVTYWxlIGlzIGNhbGxlZCwgdGhpcyBmdW5jdGlvbiB3aWxsIHN0b3AgYmVpbmcgY2FsbGVkIGFuZCB3aWxsIGFsd2F5cyBiZSB0cnVlLgogICAgcmV0dXJuIF9mcm9tID09IGFkZHJlc3ModGhpcyk7CiAgfQoKLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwsIGZvciB0aGlzIHNhbGUgYWxsCi8vLyAgYXBwcm92YWxzIGFyZSBhbGxvd2VkIGJ5IGRlZmF1bHQgYW5kIG5vIGV4dHJhIG5vdGlmaWNhdGlvbnMgYXJlIG5lZWRlZAovLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCi8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgLy8gTm8gYXBwcm92ZS90cmFuc2ZlckZyb20gZHVyaW5nIHRoZSBzYWxlCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKLy8vIEBkZXYgYGRvUGF5bWVudCgpYCBpcyBhbiBpbnRlcm5hbCBmdW5jdGlvbiB0aGF0IHNlbmRzIHRoZSBldGhlciB0aGF0IHRoaXMKLy8vICBjb250cmFjdCByZWNlaXZlcyB0byB0aGUgYXJhZ29uRGV2TXVsdGlzaWcgYW5kIGNyZWF0ZXMgdG9rZW5zIGluIHRoZSBhZGRyZXNzIG9mIHRoZQovLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgbmV3bHkgY3JlYXRlZCB0b2tlbnMKCiAgZnVuY3Rpb24gZG9QYXltZW50KGFkZHJlc3MgX293bmVyKQogICAgICAgICAgIG9ubHlfZHVyaW5nX3NhbGVfcGVyaW9kCiAgICAgICAgICAgb25seV9zYWxlX25vdF9zdG9wcGVkCiAgICAgICAgICAgb25seV9zYWxlX2FjdGl2YXRlZAogICAgICAgICAgIG5vbl96ZXJvX2FkZHJlc3MoX293bmVyKQogICAgICAgICAgIG1pbmltdW1fdmFsdWUoZHVzdCkKICAgICAgICAgICBpbnRlcm5hbCB7CgogICAgaWYgKHRvdGFsQ29sbGVjdGVkICsgbXNnLnZhbHVlID4gaGFyZENhcCkgdGhyb3c7IC8vIElmIHBhc3QgaGFyZCBjYXAsIHRocm93CgogICAgdWludDI1NiBib3VnaHRUb2tlbnMgPSBzYWZlTXVsKG1zZy52YWx1ZSwgZ2V0UHJpY2UoZ2V0QmxvY2tOdW1iZXIoKSkpOyAvLyBDYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIGJvdWdodAoKICAgIGlmICghc2FsZVdhbGxldC5zZW5kKG1zZy52YWx1ZSkpIHRocm93OyAvLyBTZW5kIGZ1bmRzIHRvIG11bHRpc2lnCiAgICBpZiAoIXRva2VuLmdlbmVyYXRlVG9rZW5zKF9vd25lciwgYm91Z2h0VG9rZW5zKSkgdGhyb3c7IC8vIEFsbG9jYXRlIHRva2Vucy4gVGhpcyB3aWxsIGZhaWwgYWZ0ZXIgc2FsZSBpcyBmaW5hbGl6ZWQgaW4gY2FzZSBpdCBpcyBoaWRkZW4gY2FwIGZpbmFsaXplZC4KCiAgICB0b3RhbENvbGxlY3RlZCA9IHNhZmVBZGQodG90YWxDb2xsZWN0ZWQsIG1zZy52YWx1ZSk7IC8vIFNhdmUgdG90YWwgY29sbGVjdGVkIGFtb3VudAoKICAgIE5ld0J1eWVyKF9vd25lciwgYm91Z2h0VG9rZW5zLCBtc2cudmFsdWUpOwogIH0KCiAgLy8gQG5vdGljZSBGdW5jdGlvbiB0byBzdG9wIHNhbGUgZm9yIGFuIGVtZXJnZW5jeS4KICAvLyBAZGV2IE9ubHkgQXJhZ29uIERldiBjYW4gZG8gaXQgYWZ0ZXIgaXQgaGFzIGJlZW4gYWN0aXZhdGVkLgogIGZ1bmN0aW9uIGVtZXJnZW5jeVN0b3BTYWxlKCkKICAgICAgICAgICBvbmx5X3NhbGVfYWN0aXZhdGVkCiAgICAgICAgICAgb25seV9zYWxlX25vdF9zdG9wcGVkCiAgICAgICAgICAgb25seShhcmFnb25EZXZNdWx0aXNpZykKICAgICAgICAgICBwdWJsaWMgewoKICAgIHNhbGVTdG9wcGVkID0gdHJ1ZTsKICB9CgogIC8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcmVzdGFydCBzdG9wcGVkIHNhbGUuCiAgLy8gQGRldiBPbmx5IEFyYWdvbiBEZXYgY2FuIGRvIGl0IGFmdGVyIGl0IGhhcyBiZWVuIGRpc2FibGVkIGFuZCBzYWxlIGlzIG9uZ29pbmcuCiAgZnVuY3Rpb24gcmVzdGFydFNhbGUoKQogICAgICAgICAgIG9ubHlfZHVyaW5nX3NhbGVfcGVyaW9kCiAgICAgICAgICAgb25seV9zYWxlX3N0b3BwZWQKICAgICAgICAgICBvbmx5KGFyYWdvbkRldk11bHRpc2lnKQogICAgICAgICAgIHB1YmxpYyB7CgogICAgc2FsZVN0b3BwZWQgPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHJldmVhbENhcCh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpCiAgICAgICAgICAgb25seV9kdXJpbmdfc2FsZV9wZXJpb2QKICAgICAgICAgICBvbmx5X3NhbGVfYWN0aXZhdGVkCiAgICAgICAgICAgdmVyaWZ5X2NhcChfY2FwLCBfY2FwX3NlY3VyZSkKICAgICAgICAgICBwdWJsaWMgewoKICAgIGlmIChfY2FwID4gaGFyZENhcCkgdGhyb3c7CgogICAgaGFyZENhcCA9IF9jYXA7CiAgICBDYXBSZXZlYWxlZChfY2FwLCBfY2FwX3NlY3VyZSwgbXNnLnNlbmRlcik7CgogICAgaWYgKHRvdGFsQ29sbGVjdGVkICsgZHVzdCA+PSBoYXJkQ2FwKSB7CiAgICAgIGRvRmluYWxpemVTYWxlKF9jYXAsIF9jYXBfc2VjdXJlKTsKICAgIH0KICB9CgogIC8vIEBub3RpY2UgRmluYWxpemVzIHNhbGUgZ2VuZXJhdGluZyB0aGUgdG9rZW5zIGZvciBBcmFnb24gRGV2LgogIC8vIEBkZXYgVHJhbnNmZXJzIHRoZSB0b2tlbiBjb250cm9sbGVyIHBvd2VyIHRvIHRoZSBBTlBsYWNlaG9sZGVyLgogIGZ1bmN0aW9uIGZpbmFsaXplU2FsZSh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpCiAgICAgICAgICAgb25seV9hZnRlcl9zYWxlCiAgICAgICAgICAgb25seShhcmFnb25EZXZNdWx0aXNpZykKICAgICAgICAgICBwdWJsaWMgewoKICAgIGRvRmluYWxpemVTYWxlKF9jYXAsIF9jYXBfc2VjdXJlKTsKICB9CgogIGZ1bmN0aW9uIGRvRmluYWxpemVTYWxlKHVpbnQyNTYgX2NhcCwgdWludDI1NiBfY2FwX3NlY3VyZSkKICAgICAgICAgICB2ZXJpZnlfY2FwKF9jYXAsIF9jYXBfc2VjdXJlKQogICAgICAgICAgIGludGVybmFsIHsKICAgIC8vIERvZXNuJ3QgY2hlY2sgaWYgc2FsZVN0b3BwZWQgaXMgZmFsc2UsIGJlY2F1c2Ugc2FsZSBjb3VsZCBlbmQgaW4gYSBlbWVyZ2VuY3kgc3RvcC4KICAgIC8vIFRoaXMgZnVuY3Rpb24gY2Fubm90IGJlIHN1Y2Nlc3NmdWxseSBjYWxsZWQgdHdpY2UsIGJlY2F1c2UgaXQgd2lsbCB0b3AgYmVpbmcgdGhlIGNvbnRyb2xsZXIsCiAgICAvLyBhbmQgdGhlIGdlbmVyYXRlVG9rZW5zIGNhbGwgd2lsbCBmYWlsIGlmIGNhbGxlZCBhZ2Fpbi4KCiAgICAvLyBBcmFnb24gRGV2IG93bnMgMzAlIG9mIHRoZSB0b3RhbCBudW1iZXIgb2YgZW1pdHRlZCB0b2tlbnMgYXQgdGhlIGVuZCBvZiB0aGUgc2FsZS4KICAgIHVpbnQyNTYgYXJhZ29uVG9rZW5zID0gdG9rZW4udG90YWxTdXBwbHkoKSAqIDMgLyA3OwogICAgaWYgKCF0b2tlbi5nZW5lcmF0ZVRva2VucyhhcmFnb25EZXZNdWx0aXNpZywgYXJhZ29uVG9rZW5zKSkgdGhyb3c7CiAgICB0b2tlbi5jaGFuZ2VDb250cm9sbGVyKG5ldHdvcmtQbGFjZWhvbGRlcik7IC8vIFNhbGUgbG9zZXMgdG9rZW4gY29udHJvbGxlciBwb3dlciBpbiBmYXZvciBvZiBuZXR3b3JrIHBsYWNlaG9sZGVyCgogICAgc2FsZUZpbmFsaXplZCA9IHRydWU7ICAvLyBTZXQgc3RvcCBpcyB0cnVlIHdoaWNoIHdpbGwgZW5hYmxlIG5ldHdvcmsgZGVwbG95bWVudAogICAgc2FsZVN0b3BwZWQgPSB0cnVlOwogIH0KCiAgLy8gQG5vdGljZSBEZXBsb3kgQXJhZ29uIE5ldHdvcmsgY29udHJhY3QuCiAgLy8gQHBhcmFtIG5ldHdvcmtBZGRyZXNzOiBUaGUgYWRkcmVzcyB0aGUgbmV0d29yayB3YXMgZGVwbG95ZWQgYXQuCiAgZnVuY3Rpb24gZGVwbG95TmV0d29yayhhZGRyZXNzIG5ldHdvcmtBZGRyZXNzKQogICAgICAgICAgIG9ubHlfZmluYWxpemVkX3NhbGUKICAgICAgICAgICBub25femVyb19hZGRyZXNzKG5ldHdvcmtBZGRyZXNzKQogICAgICAgICAgIG9ubHkoY29tbXVuaXR5TXVsdGlzaWcpCiAgICAgICAgICAgcHVibGljIHsKCiAgICBuZXR3b3JrUGxhY2Vob2xkZXIuY2hhbmdlQ29udHJvbGxlcihuZXR3b3JrQWRkcmVzcyk7CiAgfQoKICBmdW5jdGlvbiBzZXRBcmFnb25EZXZNdWx0aXNpZyhhZGRyZXNzIF9uZXdNdWx0aXNpZykKICAgICAgICAgICBub25femVyb19hZGRyZXNzKF9uZXdNdWx0aXNpZykKICAgICAgICAgICBvbmx5KGFyYWdvbkRldk11bHRpc2lnKQogICAgICAgICAgIHB1YmxpYyB7CgogICAgYXJhZ29uRGV2TXVsdGlzaWcgPSBfbmV3TXVsdGlzaWc7CiAgfQoKICBmdW5jdGlvbiBzZXRDb21tdW5pdHlNdWx0aXNpZyhhZGRyZXNzIF9uZXdNdWx0aXNpZykKICAgICAgICAgICBub25femVyb19hZGRyZXNzKF9uZXdNdWx0aXNpZykKICAgICAgICAgICBvbmx5KGNvbW11bml0eU11bHRpc2lnKQogICAgICAgICAgIHB1YmxpYyB7CgogICAgY29tbXVuaXR5TXVsdGlzaWcgPSBfbmV3TXVsdGlzaWc7CiAgfQoKICBmdW5jdGlvbiBnZXRCbG9ja051bWJlcigpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBibG9jay5udW1iZXI7CiAgfQoKICBmdW5jdGlvbiBjb21wdXRlQ2FwKHVpbnQyNTYgX2NhcCwgdWludDI1NiBfY2FwX3NlY3VyZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgIHJldHVybiBzaGEzKF9jYXAsIF9jYXBfc2VjdXJlKTsKICB9CgogIGZ1bmN0aW9uIGlzVmFsaWRDYXAodWludDI1NiBfY2FwLCB1aW50MjU2IF9jYXBfc2VjdXJlKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGNvbXB1dGVDYXAoX2NhcCwgX2NhcF9zZWN1cmUpID09IGNhcENvbW1pdG1lbnQ7CiAgfQoKICBtb2RpZmllciBvbmx5KGFkZHJlc3MgeCkgewogICAgaWYgKG1zZy5zZW5kZXIgIT0geCkgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdmVyaWZ5X2NhcCh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpIHsKICAgIGlmICghaXNWYWxpZENhcChfY2FwLCBfY2FwX3NlY3VyZSkpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlfYmVmb3JlX3NhbGUgewogICAgaWYgKGdldEJsb2NrTnVtYmVyKCkgPj0gaW5pdGlhbEJsb2NrKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X2R1cmluZ19zYWxlX3BlcmlvZCB7CiAgICBpZiAoZ2V0QmxvY2tOdW1iZXIoKSA8IGluaXRpYWxCbG9jaykgdGhyb3c7CiAgICBpZiAoZ2V0QmxvY2tOdW1iZXIoKSA+PSBmaW5hbEJsb2NrKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X2FmdGVyX3NhbGUgewogICAgaWYgKGdldEJsb2NrTnVtYmVyKCkgPCBmaW5hbEJsb2NrKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X3NhbGVfc3RvcHBlZCB7CiAgICBpZiAoIXNhbGVTdG9wcGVkKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X3NhbGVfbm90X3N0b3BwZWQgewogICAgaWYgKHNhbGVTdG9wcGVkKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X2JlZm9yZV9zYWxlX2FjdGl2YXRpb24gewogICAgaWYgKGlzQWN0aXZhdGVkKCkpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlfc2FsZV9hY3RpdmF0ZWQgewogICAgaWYgKCFpc0FjdGl2YXRlZCgpKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X2ZpbmFsaXplZF9zYWxlIHsKICAgIGlmIChnZXRCbG9ja051bWJlcigpIDwgZmluYWxCbG9jaykgdGhyb3c7CiAgICBpZiAoIXNhbGVGaW5hbGl6ZWQpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG5vbl96ZXJvX2FkZHJlc3MoYWRkcmVzcyB4KSB7CiAgICBpZiAoeCA9PSAwKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBtaW5pbXVtX3ZhbHVlKHVpbnQyNTYgeCkgewogICAgaWYgKG1zZy52YWx1ZSA8IHgpIHRocm93OwogICAgXzsKICB9Cn0='.
	

]
