Class {
	#name : #SRT162e8ff9d5bc3112fb3b2dec0580a4011f3cc622,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT162e8ff9d5bc3112fb3b2dec0580a4011f3cc622 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCgovLy8gbm90ZTogZHVyaW5nIGFueSBvd25lcnNoaXAgY2hhbmdlcyBhbGwgcGVuZGluZyBvcGVyYXRpb25zICh3YWl0aW5nIGZvciBtb3JlIHNpZ25hdHVyZXMpIGFyZSBjYW5jZWxsZWQKLy8gVE9ETyBhY2NlcHRPd25lcnNoaXAKY29udHJhY3QgbXVsdGlvd25lZCB7CgogICAgLy8gVFlQRVMKCiAgICAvLyBzdHJ1Y3QgZm9yIHRoZSBzdGF0dXMgb2YgYSBwZW5kaW5nIG9wZXJhdGlvbi4KICAgIHN0cnVjdCBNdWx0aU93bmVkT3BlcmF0aW9uUGVuZGluZ1N0YXRlIHsKICAgIC8vIGNvdW50IG9mIGNvbmZpcm1hdGlvbnMgbmVlZGVkCiAgICB1aW50IHlldE5lZWRlZDsKCiAgICAvLyBiaXRtYXAgb2YgY29uZmlybWF0aW9ucyB3aGVyZSBvd25lciAjb3duZXJJbmRleCdzIGRlY2lzaW9uIGNvcnJlc3BvbmRzIHRvIDIqKm93bmVySW5kZXggYml0CiAgICB1aW50IG93bmVyc0RvbmU7CgogICAgLy8gcG9zaXRpb24gb2YgdGhpcyBvcGVyYXRpb24ga2V5IGluIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleAogICAgdWludCBpbmRleDsKICAgIH0KCiAgICAvLyBFVkVOVFMKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwogICAgZXZlbnQgUmV2b2tlKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIGV2ZW50IEZpbmFsQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKCiAgICAvLyBzb21lIG90aGVycyBhcmUgaW4gdGhlIGNhc2Ugb2YgYW4gb3duZXIgY2hhbmdpbmcuCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBvbGRPd25lciwgYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3Mgb2xkT3duZXIpOwoKICAgIC8vIHRoZSBsYXN0IG9uZSBpcyBlbWl0dGVkIGlmIHRoZSByZXF1aXJlZCBzaWduYXR1cmVzIGNoYW5nZQogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2VkKHVpbnQgbmV3UmVxdWlyZW1lbnQpOwoKICAgIC8vIE1PRElGSUVSUwoKICAgIC8vIHNpbXBsZSBzaW5nbGUtc2lnIGZ1bmN0aW9uIG1vZGlmaWVyLgogICAgbW9kaWZpZXIgb25seW93bmVyIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CiAgICAvLyBtdWx0aS1zaWcgZnVuY3Rpb24gbW9kaWZpZXI6IHRoZSBvcGVyYXRpb24gbXVzdCBoYXZlIGFuIGludHJpbnNpYyBoYXNoIGluIG9yZGVyCiAgICAvLyB0aGF0IGxhdGVyIGF0dGVtcHRzIGNhbiBiZSByZWFsaXNlZCBhcyB0aGUgc2FtZSB1bmRlcmx5aW5nIG9wZXJhdGlvbiBhbmQKICAgIC8vIHRodXMgY291bnQgYXMgY29uZmlybWF0aW9ucy4KICAgIG1vZGlmaWVyIG9ubHltYW55b3duZXJzKGJ5dGVzMzIgX29wZXJhdGlvbikgewogICAgICAgIGlmIChjb25maXJtQW5kQ2hlY2soX29wZXJhdGlvbikpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICAgICAgLy8gRXZlbiBpZiByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBoYXMndCBiZWVuIGNvbGxlY3RlZCB5ZXQsCiAgICAgICAgLy8gd2UgY2FuJ3QgdGhyb3cgaGVyZSAtIGJlY2F1c2UgY2hhbmdlcyB0byB0aGUgc3RhdGUgaGF2ZSB0byBiZSBwcmVzZXJ2ZWQuCiAgICAgICAgLy8gQnV0LCBjb25maXJtQW5kQ2hlY2sgaXRzZWxmIHdpbGwgdGhyb3cgaW4gY2FzZSBzZW5kZXIgaXMgbm90IGFuIG93bmVyLgogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkTnVtT3duZXJzKHVpbnQgX251bU93bmVycykgewogICAgICAgIHJlcXVpcmUoX251bU93bmVycyA+IDAgJiYgX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCwgdWludCBfbnVtT3duZXJzKSB7CiAgICAgICAgcmVxdWlyZShfcmVxdWlyZWQgPiAwICYmIF9yZXF1aXJlZCA8PSBfbnVtT3duZXJzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRXhpc3RzKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIoX2FkZHJlc3MpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKCFpc093bmVyKF9hZGRyZXNzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSB7CiAgICAgICAgcmVxdWlyZShpc09wZXJhdGlvbkFjdGl2ZShfb3BlcmF0aW9uKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBNRVRIT0RTCgogICAgLy8gY29uc3RydWN0b3IgaXMgZ2l2ZW4gbnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgdG8gZG8gcHJvdGVjdGVkICJvbmx5bWFueW93bmVycyIgdHJhbnNhY3Rpb25zCiAgICAvLyBhcyB3ZWxsIGFzIHRoZSBzZWxlY3Rpb24gb2YgYWRkcmVzc2VzIGNhcGFibGUgb2YgY29uZmlybWluZyB0aGVtIChtc2cuc2VuZGVyIGlzIG5vdCBhZGRlZCB0byB0aGUgb3duZXJzISkuCiAgICBmdW5jdGlvbiBtdWx0aW93bmVkKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgIHZhbGlkTnVtT3duZXJzKF9vd25lcnMubGVuZ3RoKQogICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQoX3JlcXVpcmVkLCBfb3duZXJzLmxlbmd0aCkKICAgIHsKICAgICAgICBhc3NlcnQoY19tYXhPd25lcnMgPD0gMjU1KTsKCiAgICAgICAgbV9udW1Pd25lcnMgPSBfb3duZXJzLmxlbmd0aDsKICAgICAgICBtX211bHRpT3duZWRSZXF1aXJlZCA9IF9yZXF1aXJlZDsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7ICsraSkKICAgICAgICB7CiAgICAgICAgICAgIGFkZHJlc3Mgb3duZXIgPSBfb3duZXJzW2ldOwogICAgICAgICAgICAvLyBpbnZhbGlkIGFuZCBkdXBsaWNhdGUgYWRkcmVzc2VzIGFyZSBub3QgYWxsb3dlZAogICAgICAgICAgICByZXF1aXJlKDAgIT0gb3duZXIgJiYgIWlzT3duZXIob3duZXIpIC8qIG5vdCBpc093bmVyIHlldCEgKi8pOwoKICAgICAgICAgICAgdWludCBjdXJyZW50T3duZXJJbmRleCA9IGNoZWNrT3duZXJJbmRleChpICsgMSAvKiBmaXJzdCBzbG90IGlzIHVudXNlZCAqLyk7CiAgICAgICAgICAgIG1fb3duZXJzW2N1cnJlbnRPd25lckluZGV4XSA9IG93bmVyOwogICAgICAgICAgICBtX293bmVySW5kZXhbb3duZXJdID0gY3VycmVudE93bmVySW5kZXg7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgcmVwbGFjZXMgYW4gb3duZXIgYF9mcm9tYCB3aXRoIGFub3RoZXIgYF90b2AuCiAgICAvLy8gQHBhcmFtIF9mcm9tIGFkZHJlc3Mgb2Ygb3duZXIgdG8gcmVwbGFjZQogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBvZiBuZXcgb3duZXIKICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKQogICAgZXh0ZXJuYWwKICAgIG93bmVyRXhpc3RzKF9mcm9tKQogICAgb3duZXJEb2VzTm90RXhpc3QoX3RvKQogICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgobV9vd25lckluZGV4W19mcm9tXSk7CiAgICAgICAgbV9vd25lcnNbb3duZXJJbmRleF0gPSBfdG87CiAgICAgICAgbV9vd25lckluZGV4W19mcm9tXSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W190b10gPSBvd25lckluZGV4OwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJDaGFuZ2VkKF9mcm9tLCBfdG8pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGFkZHMgYW4gb3duZXIKICAgIC8vLyBAcGFyYW0gX293bmVyIGFkZHJlc3Mgb2YgbmV3IG93bmVyCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIF9vd25lcikKICAgIGV4dGVybmFsCiAgICBvd25lckRvZXNOb3RFeGlzdChfb3duZXIpCiAgICB2YWxpZE51bU93bmVycyhtX251bU93bmVycyArIDEpCiAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIG1fbnVtT3duZXJzKys7CiAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gX293bmVyOwogICAgICAgIG1fb3duZXJJbmRleFtfb3duZXJdID0gY2hlY2tPd25lckluZGV4KG1fbnVtT3duZXJzKTsKCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgICAgIE93bmVyQWRkZWQoX293bmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSByZW1vdmVzIGFuIG93bmVyCiAgICAvLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIG9mIG93bmVyIHRvIHJlbW92ZQogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBfb3duZXIpCiAgICBleHRlcm5hbAogICAgb3duZXJFeGlzdHMoX293bmVyKQogICAgdmFsaWROdW1Pd25lcnMobV9udW1Pd25lcnMgLSAxKQogICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQobV9tdWx0aU93bmVkUmVxdWlyZWQsIG1fbnVtT3duZXJzIC0gMSkKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtfb3duZXJdKTsKICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W19vd25lcl0gPSAwOwogICAgICAgIC8vbWFrZSBzdXJlIG1fbnVtT3duZXJzIGlzIGVxdWFsIHRvIHRoZSBudW1iZXIgb2Ygb3duZXJzIGFuZCBhbHdheXMgcG9pbnRzIHRvIHRoZSBsYXN0IG93bmVyCiAgICAgICAgcmVvcmdhbml6ZU93bmVycygpOwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJSZW1vdmVkKF9vd25lcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgY2hhbmdlcyB0aGUgcmVxdWlyZWQgbnVtYmVyIG9mIG93bmVyIHNpZ25hdHVyZXMKICAgIC8vLyBAcGFyYW0gX25ld1JlcXVpcmVkIG5ldyBudW1iZXIgb2Ygc2lnbmF0dXJlcyByZXF1aXJlZAogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfbmV3UmVxdWlyZWQpCiAgICBleHRlcm5hbAogICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQoX25ld1JlcXVpcmVkLCBtX251bU93bmVycykKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIG1fbXVsdGlPd25lZFJlcXVpcmVkID0gX25ld1JlcXVpcmVkOwogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIFJlcXVpcmVtZW50Q2hhbmdlZChfbmV3UmVxdWlyZWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldHMgYW4gb3duZXIgYnkgMC1pbmRleGVkIHBvc2l0aW9uCiAgICAvLy8gQHBhcmFtIG93bmVySW5kZXggMC1pbmRleGVkIG93bmVyIHBvc2l0aW9uCiAgICBmdW5jdGlvbiBnZXRPd25lcih1aW50IG93bmVySW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIG1fb3duZXJzW293bmVySW5kZXggKyAxXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXRzIG93bmVycwogICAgLy8vIEByZXR1cm4gbWVtb3J5IGFycmF5IG9mIG93bmVycwogICAgZnVuY3Rpb24gZ2V0T3duZXJzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3NbXSkgewogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IGFkZHJlc3NbXShtX251bU93bmVycyk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbV9udW1Pd25lcnM7IGkrKykKICAgICAgICByZXN1bHRbaV0gPSBnZXRPd25lcihpKTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjaGVja3MgaWYgcHJvdmlkZWQgYWRkcmVzcyBpcyBhbiBvd25lciBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9hZGRyIGFkZHJlc3MgdG8gY2hlY2sKICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgaXQncyBhbiBvd25lcgogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtX293bmVySW5kZXhbX2FkZHJdID4gMDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUZXN0cyBvd25lcnNoaXAgb2YgdGhlIGN1cnJlbnQgY2FsbGVyLgogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIGFuIG93bmVyCiAgICAvLyBJdCdzIGFkdmlzYWJsZSB0byBjYWxsIGl0IGJ5IG5ldyBvd25lciB0byBtYWtlIHN1cmUgdGhhdCB0aGUgc2FtZSBlcnJvbmVvdXMgYWRkcmVzcyBpcyBub3QgY29weS1wYXN0ZWQgdG8KICAgIC8vIGFkZE93bmVyL2NoYW5nZU93bmVyIGFuZCB0byBpc093bmVyLgogICAgZnVuY3Rpb24gYW1JT3duZXIoKSBleHRlcm5hbCBjb25zdGFudCBvbmx5b3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldm9rZXMgYSBwcmlvciBjb25maXJtYXRpb24gb2YgdGhlIGdpdmVuIG9wZXJhdGlvbgogICAgLy8vIEBwYXJhbSBfb3BlcmF0aW9uIG9wZXJhdGlvbiB2YWx1ZSwgdHlwaWNhbGx5IHNoYTMobXNnLmRhdGEpCiAgICBmdW5jdGlvbiByZXZva2UoYnl0ZXMzMiBfb3BlcmF0aW9uKQogICAgZXh0ZXJuYWwKICAgIG11bHRpT3duZWRPcGVyYXRpb25Jc0FjdGl2ZShfb3BlcmF0aW9uKQogICAgb25seW93bmVyCiAgICB7CiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gbWFrZU93bmVyQml0bWFwQml0KG1zZy5zZW5kZXIpOwogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICByZXF1aXJlKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPiAwKTsKCiAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwoKICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCsrOwogICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSAtPSBvd25lckluZGV4Qml0OwoKICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgUmV2b2tlKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyBpZiBvd25lciBjb25maXJtZWQgZ2l2ZW4gb3BlcmF0aW9uCiAgICAvLy8gQHBhcmFtIF9vcGVyYXRpb24gb3BlcmF0aW9uIHZhbHVlLCB0eXBpY2FsbHkgc2hhMyhtc2cuZGF0YSkKICAgIC8vLyBAcGFyYW0gX293bmVyIGFuIG93bmVyIGFkZHJlc3MKICAgIGZ1bmN0aW9uIGhhc0NvbmZpcm1lZChieXRlczMyIF9vcGVyYXRpb24sIGFkZHJlc3MgX293bmVyKQogICAgZXh0ZXJuYWwKICAgIGNvbnN0YW50CiAgICBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoX29wZXJhdGlvbikKICAgIG93bmVyRXhpc3RzKF9vd25lcikKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuICEobV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXS5vd25lcnNEb25lICYgbWFrZU93bmVyQml0bWFwQml0KF9vd25lcikgPT0gMCk7CiAgICB9CgogICAgLy8gSU5URVJOQUwgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGNvbmZpcm1BbmRDaGVjayhieXRlczMyIF9vcGVyYXRpb24pCiAgICBwcml2YXRlCiAgICBvbmx5b3duZXIKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKDUxMiA9PSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoKQogICAgICAgIC8vIEluIGNhc2UgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4IGdyb3dzIHRvbyBtdWNoIHdlIGhhdmUgdG8gc2hyaW5rIGl0OiBvdGhlcndpc2UgYXQgc29tZSBwb2ludAogICAgICAgIC8vIHdlIHdvbid0IGJlIGFibGUgdG8gZG8gaXQgYmVjYXVzZSBvZiBibG9jayBnYXMgbGltaXQuCiAgICAgICAgLy8gWWVzLCBwZW5kaW5nIGNvbmZpcm1hdGlvbnMgd2lsbCBiZSBsb3N0LiBEb250IHNlZSBhbnkgc2VjdXJpdHkgb3Igc3RhYmlsaXR5IGltcGxpY2F0aW9ucy4KICAgICAgICAvLyBUT0RPIHVzZSBtb3JlIGdyYWNlZnVsIGFwcHJvYWNoIGxpa2UgY29tcGFjdCBvciByZW1vdmFsIG9mIGNsZWFyUGVuZGluZyBjb21wbGV0ZWx5CiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CgogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKCiAgICAgICAgLy8gaWYgd2UncmUgbm90IHlldCB3b3JraW5nIG9uIHRoaXMgb3BlcmF0aW9uLCBzd2l0Y2ggb3ZlciBhbmQgcmVzZXQgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICAgICAgaWYgKCEgaXNPcGVyYXRpb25BY3RpdmUoX29wZXJhdGlvbikpIHsKICAgICAgICAgICAgLy8gcmVzZXQgY291bnQgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQuCiAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkID0gbV9tdWx0aU93bmVkUmVxdWlyZWQ7CiAgICAgICAgICAgIC8vIHJlc2V0IHdoaWNoIG93bmVycyBoYXZlIGNvbmZpcm1lZCAobm9uZSkgLSBzZXQgb3VyIGJpdG1hcCB0byAwLgogICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgPSAwOwogICAgICAgICAgICBwZW5kaW5nLmluZGV4ID0gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4Lmxlbmd0aCsrOwogICAgICAgICAgICBtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPSBfb3BlcmF0aW9uOwogICAgICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgfQoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gbWFrZU93bmVyQml0bWFwQml0KG1zZy5zZW5kZXIpOwogICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSAodGhlIG1lc3NhZ2Ugc2VuZGVyKSBoYXZlbid0IGNvbmZpcm1lZCB0aGlzIG9wZXJhdGlvbiBwcmV2aW91c2x5LgogICAgICAgIGlmIChwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID09IDApIHsKICAgICAgICAgICAgLy8gb2sgLSBjaGVjayBpZiBjb3VudCBpcyBlbm91Z2ggdG8gZ28gYWhlYWQuCiAgICAgICAgICAgIGFzc2VydChwZW5kaW5nLnlldE5lZWRlZCA+IDApOwogICAgICAgICAgICBpZiAocGVuZGluZy55ZXROZWVkZWQgPT0gMSkgewogICAgICAgICAgICAgICAgLy8gZW5vdWdoIGNvbmZpcm1hdGlvbnM6IHJlc2V0IGFuZCBydW4gaW50ZXJpb3IuCiAgICAgICAgICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W21fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl0uaW5kZXhdOwogICAgICAgICAgICAgICAgZGVsZXRlIG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgICAgICAgICBGaW5hbENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gbm90IGVub3VnaDogcmVjb3JkIHRoYXQgdGhpcyBvd25lciBpbiBwYXJ0aWN1bGFyIGNvbmZpcm1lZC4KICAgICAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkLS07CiAgICAgICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgfD0gb3duZXJJbmRleEJpdDsKICAgICAgICAgICAgICAgIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChfb3BlcmF0aW9uKTsKICAgICAgICAgICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBSZWNsYWltcyBmcmVlIHNsb3RzIGJldHdlZW4gdmFsaWQgb3duZXJzIGluIG1fb3duZXJzLgogICAgLy8gVE9ETyBnaXZlbiB0aGF0IGl0cyBjYWxsZWQgYWZ0ZXIgZWFjaCByZW1vdmFsLCBpdCBjb3VsZCBiZSBzaW1wbGlmaWVkLgogICAgZnVuY3Rpb24gcmVvcmdhbml6ZU93bmVycygpIHByaXZhdGUgewogICAgICAgIHVpbnQgZnJlZSA9IDE7CiAgICAgICAgd2hpbGUgKGZyZWUgPCBtX251bU93bmVycykKICAgICAgICB7CiAgICAgICAgICAgIC8vIGl0ZXJhdGluZyB0byB0aGUgZmlyc3QgZnJlZSBzbG90IGZyb20gdGhlIGJlZ2lubmluZwogICAgICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW2ZyZWVdICE9IDApIGZyZWUrKzsKCiAgICAgICAgICAgIC8vIGl0ZXJhdGluZyB0byB0aGUgZmlyc3Qgb2NjdXBpZWQgc2xvdCBmcm9tIHRoZSBlbmQKICAgICAgICAgICAgd2hpbGUgKG1fbnVtT3duZXJzID4gMSAmJiBtX293bmVyc1ttX251bU93bmVyc10gPT0gMCkgbV9udW1Pd25lcnMtLTsKCiAgICAgICAgICAgIC8vIHN3YXAsIGlmIHBvc3NpYmxlLCBzbyBmcmVlIHNsb3QgaXMgbG9jYXRlZCBhdCB0aGUgZW5kIGFmdGVyIHRoZSBzd2FwCiAgICAgICAgICAgIGlmIChmcmVlIDwgbV9udW1Pd25lcnMgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdICE9IDAgJiYgbV9vd25lcnNbZnJlZV0gPT0gMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gb3duZXJzIGJldHdlZW4gc3dhcHBlZCBzbG90cyBzaG91bGQndCBiZSByZW51bWJlcmVkIC0gdGhhdCBzYXZlcyBhIGxvdCBvZiBnYXMKICAgICAgICAgICAgICAgIG1fb3duZXJzW2ZyZWVdID0gbV9vd25lcnNbbV9udW1Pd25lcnNdOwogICAgICAgICAgICAgICAgbV9vd25lckluZGV4W21fb3duZXJzW2ZyZWVdXSA9IGZyZWU7CiAgICAgICAgICAgICAgICBtX293bmVyc1ttX251bU93bmVyc10gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNsZWFyUGVuZGluZygpIHByaXZhdGUgb25seW93bmVyIHsKICAgICAgICB1aW50IGxlbmd0aCA9IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGg7CiAgICAgICAgLy8gVE9ETyBibG9jayBnYXMgbGltaXQKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAobV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W2ldICE9IDApCiAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nW21fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtpXV07CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tPd25lckluZGV4KHVpbnQgb3duZXJJbmRleCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KDAgIT0gb3duZXJJbmRleCAmJiBvd25lckluZGV4IDw9IGNfbWF4T3duZXJzKTsKICAgICAgICByZXR1cm4gb3duZXJJbmRleDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlT3duZXJCaXRtYXBCaXQoYWRkcmVzcyBvd25lcikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtvd25lcl0pOwogICAgICAgIHJldHVybiAyICoqIG93bmVySW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gaXNPcGVyYXRpb25BY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gMCAhPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLnlldE5lZWRlZDsKICAgIH0KCgogICAgZnVuY3Rpb24gYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpIHByaXZhdGUgY29uc3RhbnQgewogICAgICAgIGFzc2VydChtX251bU93bmVycyA+IDApOwogICAgICAgIGFzc2VydChtX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgYXNzZXJ0KG1fb3duZXJzWzBdID09IDApOwogICAgICAgIGFzc2VydCgwICE9IG1fbXVsdGlPd25lZFJlcXVpcmVkICYmIG1fbXVsdGlPd25lZFJlcXVpcmVkIDw9IG1fbnVtT3duZXJzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgYXNzZXJ0KDAgIT0gcGVuZGluZy55ZXROZWVkZWQpOwogICAgICAgIGFzc2VydChtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPT0gX29wZXJhdGlvbik7CiAgICAgICAgYXNzZXJ0KHBlbmRpbmcueWV0TmVlZGVkIDw9IG1fbXVsdGlPd25lZFJlcXVpcmVkKTsKICAgIH0KCgogICAgLy8gRklFTERTCgogICAgdWludCBjb25zdGFudCBjX21heE93bmVycyA9IDI1MDsKCiAgICAvLyB0aGUgbnVtYmVyIG9mIG93bmVycyB0aGF0IG11c3QgY29uZmlybSB0aGUgc2FtZSBvcGVyYXRpb24gYmVmb3JlIGl0IGlzIHJ1bi4KICAgIHVpbnQgcHVibGljIG1fbXVsdGlPd25lZFJlcXVpcmVkOwoKCiAgICAvLyBwb2ludGVyIHVzZWQgdG8gZmluZCBhIGZyZWUgc2xvdCBpbiBtX293bmVycwogICAgdWludCBwdWJsaWMgbV9udW1Pd25lcnM7CgogICAgLy8gbGlzdCBvZiBvd25lcnMgKGFkZHJlc3NlcyksCiAgICAvLyBzbG90IDAgaXMgdW51c2VkIHNvIHRoZXJlIGFyZSBubyBvd25lciB3aGljaCBpbmRleCBpcyAwLgogICAgLy8gVE9ETyBjb3VsZCB3ZSBzYXZlIHNwYWNlIGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5IGZvciB0aGUgY29tbW9uIGNhc2Ugb2YgPDEwIG93bmVycz8gYW5kIHNob3VsZCB3ZT8KICAgIGFkZHJlc3NbMjU2XSBpbnRlcm5hbCBtX293bmVyczsKCiAgICAvLyBpbmRleCBvbiB0aGUgbGlzdCBvZiBvd25lcnMgdG8gYWxsb3cgcmV2ZXJzZSBsb29rdXA6IG93bmVyIGFkZHJlc3MgPT4gaW5kZXggaW4gbV9vd25lcnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBpbnRlcm5hbCBtX293bmVySW5kZXg7CgoKICAgIC8vIHRoZSBvbmdvaW5nIG9wZXJhdGlvbnMuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gTXVsdGlPd25lZE9wZXJhdGlvblBlbmRpbmdTdGF0ZSkgaW50ZXJuYWwgbV9tdWx0aU93bmVkUGVuZGluZzsKICAgIGJ5dGVzMzJbXSBpbnRlcm5hbCBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7Cn0KCi8qKgogKiBAdGl0bGUgSGVscHMgY29udHJhY3RzIGd1YXJkIGFnYWlucyByZW50cmFuY3kgYXR0YWNrcy4KICogQGF1dGhvciBSZW1jbyBCbG9lbWVuIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMzE0MzU0NWM1MjVlNzEwMyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT7PgC5jb20+CiAqIEBub3RpY2UgSWYgeW91IG1hcmsgYSBmdW5jdGlvbiBgbm9uUmVlbnRyYW50YCwgeW91IHNob3VsZCBhbHNvCiAqIG1hcmsgaXQgYGV4dGVybmFsYC4KICovCmNvbnRyYWN0IFJlZW50cmFuY3lHdWFyZCB7CgogICAgLyoqCiAgICAgKiBAZGV2IFdlIHVzZSBhIHNpbmdsZSBsb2NrIGZvciB0aGUgd2hvbGUgY29udHJhY3QuCiAgICAgKi8KICAgIGJvb2wgcHJpdmF0ZSByZW50cmFuY3lfbG9jayA9IGZhbHNlOwoKICAgIC8qKgogICAgICogQGRldiBQcmV2ZW50cyBhIGNvbnRyYWN0IGZyb20gY2FsbGluZyBpdHNlbGYsIGRpcmVjdGx5IG9yIGluZGlyZWN0bHkuCiAgICAgKiBAbm90aWNlIElmIHlvdSBtYXJrIGEgZnVuY3Rpb24gYG5vblJlZW50cmFudGAsIHlvdSBzaG91bGQgYWxzbwogICAgICogbWFyayBpdCBgZXh0ZXJuYWxgLiBDYWxsaW5nIG9uZSBub25SZWVudHJhbnQgZnVuY3Rpb24gZnJvbQogICAgICogYW5vdGhlciBpcyBub3Qgc3VwcG9ydGVkLiBJbnN0ZWFkLCB5b3UgY2FuIGltcGxlbWVudCBhCiAgICAgKiBgcHJpdmF0ZWAgZnVuY3Rpb24gZG9pbmcgdGhlIGFjdHVhbCB3b3JrLCBhbmQgYSBgZXh0ZXJuYWxgCiAgICAgKiB3cmFwcGVyIG1hcmtlZCBhcyBgbm9uUmVlbnRyYW50YC4KICAgICAqLwogICAgbW9kaWZpZXIgbm9uUmVlbnRyYW50KCkgewogICAgICAgIHJlcXVpcmUoIXJlbnRyYW5jeV9sb2NrKTsKICAgICAgICByZW50cmFuY3lfbG9jayA9IHRydWU7CiAgICAgICAgXzsKICAgICAgICByZW50cmFuY3lfbG9jayA9IGZhbHNlOwogICAgfQoKfQoKCi8qKgogKiBAdGl0bGUgQ29udHJhY3Qgd2hpY2ggaXMgb3duZWQgYnkgb3duZXJzIGFuZCBvcGVyYXRlZCBieSBjb250cm9sbGVyLgogKgogKiBAbm90aWNlIFByb3ZpZGVzIGEgd2F5IHRvIHNldCB1cCBhbiBlbnRpdHkgKHR5cGljYWxseSBvdGhlciBjb250cmFjdCkgZW50aXRsZWQgdG8gY29udHJvbCBhY3Rpb25zIG9mIHRoaXMgY29udHJhY3QuCiAqIENvbnRyb2xsZXIgaXMgc2V0IHVwIGJ5IG93bmVycyBvciBkdXJpbmcgY29uc3RydWN0aW9uLgogKgogKiBAZGV2IGNvbnRyb2xsZXIgY2hlY2sgaXMgcGVyZm9ybWVkIGJ5IG9ubHlDb250cm9sbGVyIG1vZGlmaWVyLgogKi8KY29udHJhY3QgTXVsdGlvd25lZENvbnRyb2xsZWQgaXMgbXVsdGlvd25lZCB7CgogICAgZXZlbnQgQ29udHJvbGxlclNldChhZGRyZXNzIGNvbnRyb2xsZXIpOwogICAgZXZlbnQgQ29udHJvbGxlclJldGlyZWQoYWRkcmVzcyB3YXMpOwoKCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG1fY29udHJvbGxlcik7CiAgICAgICAgXzsKICAgIH0KCgogICAgLy8gUFVCTElDIGludGVyZmFjZQoKICAgIGZ1bmN0aW9uIE11bHRpb3duZWRDb250cm9sbGVkKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9zaWduYXR1cmVzUmVxdWlyZWQsIGFkZHJlc3MgX2NvbnRyb2xsZXIpCiAgICBtdWx0aW93bmVkKF9vd25lcnMsIF9zaWduYXR1cmVzUmVxdWlyZWQpCiAgICB7CiAgICAgICAgbV9jb250cm9sbGVyID0gX2NvbnRyb2xsZXI7CiAgICAgICAgQ29udHJvbGxlclNldChtX2NvbnRyb2xsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IHNldHMgdGhlIGNvbnRyb2xsZXIKICAgIGZ1bmN0aW9uIHNldENvbnRyb2xsZXIoYWRkcmVzcyBfY29udHJvbGxlcikgZXh0ZXJuYWwgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIHsKICAgICAgICBtX2NvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsKICAgICAgICBDb250cm9sbGVyU2V0KG1fY29udHJvbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgYWJpbGl0eSBmb3IgY29udHJvbGxlciB0byBzdGVwIGRvd24KICAgIGZ1bmN0aW9uIGRldGFjaENvbnRyb2xsZXIoKSBleHRlcm5hbCBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgYWRkcmVzcyB3YXMgPSBtX2NvbnRyb2xsZXI7CiAgICAgICAgbV9jb250cm9sbGVyID0gYWRkcmVzcygwKTsKICAgICAgICBDb250cm9sbGVyUmV0aXJlZCh3YXMpOwogICAgfQoKCiAgICAvLyBGSUVMRFMKCiAgICAvLy8gQG5vdGljZSBhZGRyZXNzIG9mIGVudGl0eSBlbnRpdGxlZCB0byBtaW50IG5ldyB0b2tlbnMKICAgIGFkZHJlc3MgcHVibGljIG1fY29udHJvbGxlcjsKfQoKCi8vLyBAdGl0bGUgdXRpbGl0eSBtZXRob2RzIGFuZCBtb2RpZmllcnMgb2YgYXJndW1lbnRzIHZhbGlkYXRpb24KY29udHJhY3QgQXJndW1lbnRzQ2hlY2tlciB7CgogICAgLy8vIEBkZXYgY2hlY2sgd2hpY2ggcHJldmVudHMgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICAgIG1vZGlmaWVyIHBheWxvYWRTaXplSXModWludCBzaXplKSB7CiAgICAgICAgcmVxdWlyZShtc2cuZGF0YS5sZW5ndGggPT0gc2l6ZSArIDQgLyogZnVuY3Rpb24gc2VsZWN0b3IgKi8pOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgY2hlY2sgdGhhdCBhZGRyZXNzIGlzIHZhbGlkCiAgICBtb2RpZmllciB2YWxpZEFkZHJlc3MoYWRkcmVzcyBhZGRyKSB7CiAgICAgICAgcmVxdWlyZShhZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9Cn0KCgovLy8gQHRpdGxlIHJlZ2lzdHJ5IG9mIGZ1bmRzIHNlbnQgYnkgaW52ZXN0b3JzCmNvbnRyYWN0IEZ1bmRzUmVnaXN0cnkgaXMgQXJndW1lbnRzQ2hlY2tlciwgTXVsdGlvd25lZENvbnRyb2xsZWQsIFJlZW50cmFuY3lHdWFyZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBlbnVtIFN0YXRlIHsKICAgIC8vIGdhdGhlcmluZyBmdW5kcwogICAgR0FUSEVSSU5HLAogICAgLy8gcmV0dXJuaW5nIGZ1bmRzIHRvIGludmVzdG9ycwogICAgUkVGVU5ESU5HLAogICAgLy8gZnVuZHMgY2FuIGJlIHB1bGxlZCBieSBvd25lcnMKICAgIFNVQ0NFRURFRAogICAgfQoKICAgIGV2ZW50IFN0YXRlQ2hhbmdlZChTdGF0ZSBfc3RhdGUpOwogICAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBFdGhlclNlbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IFJlZnVuZFNlbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKCgogICAgbW9kaWZpZXIgcmVxdWlyZXNTdGF0ZShTdGF0ZSBfc3RhdGUpIHsKICAgICAgICByZXF1aXJlKG1fc3RhdGUgPT0gX3N0YXRlKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlCgogICAgZnVuY3Rpb24gRnVuZHNSZWdpc3RyeShhZGRyZXNzW10gX293bmVycywgdWludCBfc2lnbmF0dXJlc1JlcXVpcmVkLCBhZGRyZXNzIF9jb250cm9sbGVyKQogICAgTXVsdGlvd25lZENvbnRyb2xsZWQoX293bmVycywgX3NpZ25hdHVyZXNSZXF1aXJlZCwgX2NvbnRyb2xsZXIpCiAgICB7CiAgICB9CgogICAgLy8vIEBkZXYgcGVyZm9ybXMgb25seSBhbGxvd2VkIHN0YXRlIHRyYW5zaXRpb25zCiAgICBmdW5jdGlvbiBjaGFuZ2VTdGF0ZShTdGF0ZSBfbmV3U3RhdGUpCiAgICBleHRlcm5hbAogICAgb25seUNvbnRyb2xsZXIKICAgIHsKICAgICAgICBhc3NlcnQobV9zdGF0ZSAhPSBfbmV3U3RhdGUpOwoKICAgICAgICBpZiAoU3RhdGUuR0FUSEVSSU5HID09IG1fc3RhdGUpIHsgICBhc3NlcnQoU3RhdGUuUkVGVU5ESU5HID09IF9uZXdTdGF0ZSB8fCBTdGF0ZS5TVUNDRUVERUQgPT0gX25ld1N0YXRlKTsgfQogICAgICAgIGVsc2UgYXNzZXJ0KGZhbHNlKTsKCiAgICAgICAgbV9zdGF0ZSA9IF9uZXdTdGF0ZTsKICAgICAgICBTdGF0ZUNoYW5nZWQobV9zdGF0ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgcmVjb3JkcyBhbiBpbnZlc3RtZW50CiAgICBmdW5jdGlvbiBpbnZlc3RlZChhZGRyZXNzIF9pbnZlc3RvcikKICAgIGV4dGVybmFsCiAgICBwYXlhYmxlCiAgICBvbmx5Q29udHJvbGxlcgogICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5HQVRIRVJJTkcpCiAgICB7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgcmVxdWlyZSgwICE9IGFtb3VudCk7CiAgICAgICAgYXNzZXJ0KF9pbnZlc3RvciAhPSBtX2NvbnRyb2xsZXIpOwoKICAgICAgICAvLyByZWdpc3RlciBpbnZlc3RvcgogICAgICAgIGlmICgwID09IG1fd2VpQmFsYW5jZXNbX2ludmVzdG9yXSkKICAgICAgICBtX2ludmVzdG9ycy5wdXNoKF9pbnZlc3Rvcik7CgogICAgICAgIC8vIHJlZ2lzdGVyIHBheW1lbnQKICAgICAgICB0b3RhbEludmVzdGVkID0gdG90YWxJbnZlc3RlZC5hZGQoYW1vdW50KTsKICAgICAgICBtX3dlaUJhbGFuY2VzW19pbnZlc3Rvcl0gPSBtX3dlaUJhbGFuY2VzW19pbnZlc3Rvcl0uYWRkKGFtb3VudCk7CgogICAgICAgIEludmVzdGVkKF9pbnZlc3RvciwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBvd25lcnM6IHNlbmQgYHZhbHVlYCBvZiBldGhlciB0byBhZGRyZXNzIGB0b2AsIGNhbiBiZSBjYWxsZWQgaWYgY3Jvd2RzYWxlIHN1Y2NlZWRlZAogICAgLy8vIEBwYXJhbSB0byB3aGVyZSB0byBzZW5kIGV0aGVyCiAgICAvLy8gQHBhcmFtIHZhbHVlIGFtb3VudCBvZiB3ZWkgdG8gc2VuZAogICAgZnVuY3Rpb24gc2VuZEV0aGVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpCiAgICBleHRlcm5hbAogICAgdmFsaWRBZGRyZXNzKHRvKQogICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICByZXF1aXJlc1N0YXRlKFN0YXRlLlNVQ0NFRURFRCkKICAgIHsKICAgICAgICByZXF1aXJlKHZhbHVlID4gMCAmJiB0aGlzLmJhbGFuY2UgPj0gdmFsdWUpOwogICAgICAgIHRvLnRyYW5zZmVyKHZhbHVlKTsKICAgICAgICBFdGhlclNlbnQodG8sIHZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlLCBjYWxsZWQgYnkgcGF5ZWUgaW4gY2FzZSBjcm93ZHNhbGUgZmFpbGVkCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKGFkZHJlc3MgcGF5ZWUpCiAgICBleHRlcm5hbAogICAgbm9uUmVlbnRyYW50CiAgICBvbmx5Q29udHJvbGxlcgogICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5SRUZVTkRJTkcpCiAgICB7CiAgICAgICAgdWludDI1NiBwYXltZW50ID0gbV93ZWlCYWxhbmNlc1twYXllZV07CgogICAgICAgIHJlcXVpcmUocGF5bWVudCAhPSAwKTsKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+PSBwYXltZW50KTsKCiAgICAgICAgdG90YWxJbnZlc3RlZCA9IHRvdGFsSW52ZXN0ZWQuc3ViKHBheW1lbnQpOwogICAgICAgIG1fd2VpQmFsYW5jZXNbcGF5ZWVdID0gMDsKCiAgICAgICAgcGF5ZWUudHJhbnNmZXIocGF5bWVudCk7CiAgICAgICAgUmVmdW5kU2VudChwYXllZSwgcGF5bWVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SW52ZXN0b3JzQ291bnQoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7IHJldHVybiBtX2ludmVzdG9ycy5sZW5ndGg7IH0KCgogICAgLy8gRklFTERTCgogICAgLy8vIEBub3RpY2UgdG90YWwgYW1vdW50IG9mIGludmVzdG1lbnRzIGluIHdlaQogICAgdWludDI1NiBwdWJsaWMgdG90YWxJbnZlc3RlZDsKCiAgICAvLy8gQG5vdGljZSBzdGF0ZSBvZiB0aGUgcmVnaXN0cnkKICAgIFN0YXRlIHB1YmxpYyBtX3N0YXRlID0gU3RhdGUuR0FUSEVSSU5HOwoKICAgIC8vLyBAZGV2IGJhbGFuY2VzIG9mIGludmVzdG9ycyBpbiB3ZWkKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbV93ZWlCYWxhbmNlczsKCiAgICAvLy8gQGRldiBsaXN0IG9mIHVuaXF1ZSBpbnZlc3RvcnMKICAgIGFkZHJlc3NbXSBwdWJsaWMgbV9pbnZlc3RvcnM7Cn0KCgovLy8xMjMKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICAvKioKICAgICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAgICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAgICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKfQoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgICAqCiAgICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvKioKICAgICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICAgKi8KICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICAgICAgfQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgp9CgoKCi8vLyBAdGl0bGUgU3RhbmRhcmRUb2tlbiB3aGljaCBjYW4gYmUgbWludGVkIGJ5IGFub3RoZXIgY29udHJhY3QuCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gewogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKCiAgICAvLy8gQGRldiBtaW50cyBuZXcgdG9rZW5zCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKfQoKCgovKioKICogTWV0cm9wb2xNaW50YWJsZVRva2VuCiAqLwpjb250cmFjdCBNZXRyb3BvbE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgTWludGFibGVUb2tlbiB7CgogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsvL3RvZG8gcHJvcG9zZSByZXR1cm4gdmFsdWUKCiAgICAvKioKICAgICAqIEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICAgKiBJbnRlcm5hbCBmb3Igbm90IGZvcmdldHRpbmcgdG8gYWRkIGFjY2VzcyBtb2RpZmllcgogICAgICoKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAgICoKICAgICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50PjApOwogICAgICAgIHJlcXVpcmUoX3RvIT1hZGRyZXNzKDApKTsKCiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCi8qKgogKiBDb250cmFjdCB3aGljaCBpcyBvcGVyYXRlZCBieSBjb250cm9sbGVyLgogKgogKiBQcm92aWRlcyBhIHdheSB0byBzZXQgdXAgYW4gZW50aXR5ICh0eXBpY2FsbHkgb3RoZXIgY29udHJhY3QpIGVudGl0bGVkIHRvIGNvbnRyb2wgYWN0aW9ucyBvZiB0aGlzIGNvbnRyYWN0LgogKgogKiBDb250cm9sbGVyIGNoZWNrIGlzIHBlcmZvcm1lZCBieSBvbmx5Q29udHJvbGxlciBtb2RpZmllci4KICovCmNvbnRyYWN0IENvbnRyb2xsZWQgewoKICAgIGFkZHJlc3MgcHVibGljIG1fY29udHJvbGxlcjsKCiAgICBldmVudCBDb250cm9sbGVyU2V0KGFkZHJlc3MgY29udHJvbGxlcik7CiAgICBldmVudCBDb250cm9sbGVyUmV0aXJlZChhZGRyZXNzIHdhcyk7CgoKICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbV9jb250cm9sbGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENvbnRyb2xsZXIoYWRkcmVzcyBfY29udHJvbGxlcikgZXh0ZXJuYWw7CgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBjb250cm9sbGVyLiBJbnRlcm5hbCBmb3Igbm90IGZvcmdldHRpbmcgdG8gYWRkIGFjY2VzcyBtb2RpZmllcgogICAgICovCiAgICBmdW5jdGlvbiBzZXRDb250cm9sbGVySW50ZXJuYWwoYWRkcmVzcyBfY29udHJvbGxlcikgaW50ZXJuYWwgewogICAgICAgIG1fY29udHJvbGxlciA9IF9jb250cm9sbGVyOwogICAgICAgIENvbnRyb2xsZXJTZXQobV9jb250cm9sbGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFiaWxpdHkgZm9yIGNvbnRyb2xsZXIgdG8gc3RlcCBkb3duCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRldGFjaENvbnRyb2xsZXIoKSBleHRlcm5hbCBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgYWRkcmVzcyB3YXMgPSBtX2NvbnRyb2xsZXI7CiAgICAgICAgbV9jb250cm9sbGVyID0gYWRkcmVzcygwKTsKICAgICAgICBDb250cm9sbGVyUmV0aXJlZCh3YXMpOwogICAgfQp9CgoKLyoqCiAqIE1pbnRhYmxlQ29udHJvbGxlZFRva2VuCiAqLwpjb250cmFjdCBNaW50YWJsZUNvbnRyb2xsZWRUb2tlbiBpcyBNZXRyb3BvbE1pbnRhYmxlVG9rZW4sIENvbnRyb2xsZWQgewoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgICAqCiAgICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAgICovCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgc3VwZXIubWludEludGVybmFsKF90bywgX2Ftb3VudCk7CiAgICB9Cgp9CgoKLyoqCiAqIEJ1cm5hYmxlVG9rZW4KICovCmNvbnRyYWN0IEJ1cm5hYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgdWludDI1NiBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIGJ1cm4oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0byBidXJuIHRva2VucwogICAgICogSW50ZXJuYWwgZm9yIG5vdCBmb3JnZXR0aW5nIHRvIGFkZCBhY2Nlc3MgbW9kaWZpZXIKICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdG8gYnVybiB0b2tlbnMgZnJvbS4KICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJ1cm4uCiAgICAgKgogICAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgICAqLwogICAgZnVuY3Rpb24gYnVybkludGVybmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX2Ftb3VudD4wKTsKICAgICAgICByZXF1aXJlKF9hbW91bnQ8PWJhbGFuY2VzW19mcm9tXSk7CgogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX2Ftb3VudCk7CiAgICAgICAgQnVybihfZnJvbSwgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIGFkZHJlc3MoMCksIF9hbW91bnQpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCgovKioKICogQnVybmFibGVDb250cm9sbGVkVG9rZW4KICovCmNvbnRyYWN0IEJ1cm5hYmxlQ29udHJvbGxlZFRva2VuIGlzIEJ1cm5hYmxlVG9rZW4sIENvbnRyb2xsZWQgewoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdG8gYnVybiB0b2tlbnMKICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdG8gYnVybiB0b2tlbnMgZnJvbS4KICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJ1cm4uCiAgICAgKgogICAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgICAqLwogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmJ1cm5JbnRlcm5hbChfZnJvbSwgX2Ftb3VudCk7CiAgICB9Cgp9CgoKCi8qKgogKiBDb250cmFjdCB3aGljaCBpcyBvd25lZCBieSBvd25lcnMgYW5kIG9wZXJhdGVkIGJ5IGNvbnRyb2xsZXIuCiAqCiAqIFByb3ZpZGVzIGEgd2F5IHRvIHNldCB1cCBhbiBlbnRpdHkgKHR5cGljYWxseSBvdGhlciBjb250cmFjdCkgZW50aXRsZWQgdG8gY29udHJvbCBhY3Rpb25zIG9mIHRoaXMgY29udHJhY3QuCiAqIENvbnRyb2xsZXIgaXMgc2V0IHVwIGJ5IG93bmVycyBvciBkdXJpbmcgY29uc3RydWN0aW9uLgogKgogKi8KY29udHJhY3QgTWV0cm9wb2xNdWx0aW93bmVkQ29udHJvbGxlZCBpcyBDb250cm9sbGVkLCBtdWx0aW93bmVkIHsKCgogICAgZnVuY3Rpb24gTWV0cm9wb2xNdWx0aW93bmVkQ29udHJvbGxlZChhZGRyZXNzW10gX293bmVycywgdWludDI1NiBfc2lnbmF0dXJlc1JlcXVpcmVkKQogICAgbXVsdGlvd25lZChfb3duZXJzLCBfc2lnbmF0dXJlc1JlcXVpcmVkKQogICAgcHVibGljCiAgICB7CiAgICAgICAgLy8gbm90aGluZyBoZXJlCiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBjb250cm9sbGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldENvbnRyb2xsZXIoYWRkcmVzcyBfY29udHJvbGxlcikgZXh0ZXJuYWwgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIHsKICAgICAgICBzdXBlci5zZXRDb250cm9sbGVySW50ZXJuYWwoX2NvbnRyb2xsZXIpOwogICAgfQoKfQoKCgovLy8gQHRpdGxlIFN0YW5kYXJkVG9rZW4gd2hpY2ggY2lyY3VsYXRpb24gY2FuIGJlIGRlbGF5ZWQgYW5kIHN0YXJ0ZWQgYnkgYW5vdGhlciBjb250cmFjdC4KLy8vIEBkZXYgVG8gYmUgdXNlZCBhcyBhIG1peGluIGNvbnRyYWN0LgovLy8gVGhlIGNvbnRyYWN0IGlzIGNyZWF0ZWQgaW4gZGlzYWJsZWQgc3RhdGU6IGNpcmN1bGF0aW9uIGlzIGRpc2FibGVkLgpjb250cmFjdCBDaXJjdWxhdGluZ1Rva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIGV2ZW50IENpcmN1bGF0aW9uRW5hYmxlZCgpOwoKICAgIG1vZGlmaWVyIHJlcXVpcmVzQ2lyY3VsYXRpb24gewogICAgICAgIHJlcXVpcmUobV9pc0NpcmN1bGF0aW5nKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlCgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXF1aXJlc0NpcmN1bGF0aW9uIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJlcXVpcmVzQ2lyY3VsYXRpb24gcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXF1aXJlc0NpcmN1bGF0aW9uIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICAgIH0KCgogICAgLy8gSU5URVJOQUwgZnVuY3Rpb25zCgogICAgZnVuY3Rpb24gZW5hYmxlQ2lyY3VsYXRpb24oKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKG1faXNDaXJjdWxhdGluZykKICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIG1faXNDaXJjdWxhdGluZyA9IHRydWU7CiAgICAgICAgQ2lyY3VsYXRpb25FbmFibGVkKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIGFyZSB0aGUgY2lyY3VsYXRpb24gc3RhcnRlZD8KICAgIGJvb2wgcHVibGljIG1faXNDaXJjdWxhdGluZzsKfQoKCgoKLyoqCiAqIENpcmN1bGF0aW5nQ29udHJvbGxlZFRva2VuCiAqLwpjb250cmFjdCBDaXJjdWxhdGluZ0NvbnRyb2xsZWRUb2tlbiBpcyBDaXJjdWxhdGluZ1Rva2VuLCBDb250cm9sbGVkIHsKCiAgICAvKioKICAgICAqIEFsbG93cyB0b2tlbiB0cmFuc2ZlcnMKICAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRDaXJjdWxhdGlvbigpIGV4dGVybmFsIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBhc3NlcnQoZW5hYmxlQ2lyY3VsYXRpb24oKSk7ICAgIC8vIG11c3QgYmUgY2FsbGVkIG9uY2UKICAgIH0KfQoKCgovKioKICogTWV0cm9wb2xUb2tlbgogKi8KY29udHJhY3QgTWV0cm9wb2xUb2tlbiBpcwogICAgU3RhbmRhcmRUb2tlbiwKICAgIENvbnRyb2xsZWQsCiAgICBNaW50YWJsZUNvbnRyb2xsZWRUb2tlbiwKICAgIEJ1cm5hYmxlQ29udHJvbGxlZFRva2VuLAogICAgQ2lyY3VsYXRpbmdDb250cm9sbGVkVG9rZW4sCiAgICBNZXRyb3BvbE11bHRpb3duZWRDb250cm9sbGVkCnsKICAgIHN0cmluZyBpbnRlcm5hbCBtX25hbWUgPSAnJzsKICAgIHN0cmluZyBpbnRlcm5hbCBtX3N5bWJvbCA9ICcnOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgLyoqCiAgICAgKiBNZXRyb3BvbFRva2VuIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGZ1bmN0aW9uIE1ldHJvcG9sVG9rZW4oYWRkcmVzc1tdIF9vd25lcnMpCiAgICAgICAgTWV0cm9wb2xNdWx0aW93bmVkQ29udHJvbGxlZChfb3duZXJzLCAyKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoMyA9PSBfb3duZXJzLmxlbmd0aCk7CiAgICB9CgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gbV9uYW1lOwogICAgfQogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBtX3N5bWJvbDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXROYW1lU3ltYm9sKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wpIGV4dGVybmFsIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSB7CiAgICAgICAgcmVxdWlyZShieXRlcyhtX25hbWUpLmxlbmd0aD09MCk7CiAgICAgICAgcmVxdWlyZShieXRlcyhfbmFtZSkubGVuZ3RoIT0wICYmIGJ5dGVzKF9zeW1ib2wpLmxlbmd0aCE9MCk7CgogICAgICAgIG1fbmFtZSA9IF9uYW1lOwogICAgICAgIG1fc3ltYm9sID0gX3N5bWJvbDsKICAgIH0KCn0KCgovLy8vLy8vLy8xMjMKLyoqCiAqIEB0aXRsZSBCYXNpYyBjcm93ZHNhbGUgc3RhdAogKiBAYXV0aG9yIEVlbmFlCiAqLwpjb250cmFjdCBJQ3Jvd2RzYWxlU3RhdCB7CgogICAgLy8vIEBub3RpY2UgYW1vdW50IG9mIGZ1bmRzIGNvbGxlY3RlZCBpbiB3ZWkKICAgIGZ1bmN0aW9uIGdldFdlaUNvbGxlY3RlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQG5vdGljZSBhbW91bnQgb2YgdG9rZW5zIG1pbnRlZCAoTk9UIGVxdWFsIHRvIHRvdGFsU3VwcGx5KCkgaW4gY2FzZSB0b2tlbiBpcyByZXVzZWQhKQogICAgZnVuY3Rpb24gZ2V0VG9rZW5NaW50ZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7Cn0KCi8qKgogKiBAdGl0bGUgSW50ZXJmYWNlIGZvciBjb2RlIHdoaWNoIHByb2Nlc3NlcyBhbmQgc3RvcmVzIGludmVzdG1lbnRzLgogKiBAYXV0aG9yIEVlbmFlCiAqLwpjb250cmFjdCBJSW52ZXN0bWVudHNXYWxsZXRDb25uZWN0b3IgewogICAgLy8vIEBkZXYgcHJvY2VzcyBhbmQgZm9yd2FyZCBpbnZlc3RtZW50CiAgICBmdW5jdGlvbiBzdG9yZUludmVzdG1lbnQoYWRkcmVzcyBpbnZlc3RvciwgdWludCBwYXltZW50KSBpbnRlcm5hbDsKCiAgICAvLy8gQGRldiB0b3RhbCBpbnZlc3RtZW50cyBhbW91bnQgc3RvcmVkIHVzaW5nIHN0b3JlSW52ZXN0bWVudCgpCiAgICBmdW5jdGlvbiBnZXRUb3RhbEludmVzdG1lbnRzU3RvcmVkKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBkZXYgY2FsbGVkIGluIGNhc2UgY3Jvd2RzYWxlIHN1Y2NlZWRlZAogICAgZnVuY3Rpb24gd2NPbkNyb3dkc2FsZVN1Y2Nlc3MoKSBpbnRlcm5hbDsKCiAgICAvLy8gQGRldiBjYWxsZWQgaW4gY2FzZSBjcm93ZHNhbGUgZmFpbGVkCiAgICBmdW5jdGlvbiB3Y09uQ3Jvd2RzYWxlRmFpbHVyZSgpIGludGVybmFsOwp9CgoKLy8vIEB0aXRsZSBCYXNlIGNvbnRyYWN0IGZvciBzaW1wbGUgY3Jvd2RzYWxlcwpjb250cmFjdCBTaW1wbGVDcm93ZHNhbGVCYXNlIGlzIEFyZ3VtZW50c0NoZWNrZXIsIFJlZW50cmFuY3lHdWFyZCwgSUludmVzdG1lbnRzV2FsbGV0Q29ubmVjdG9yLCBJQ3Jvd2RzYWxlU3RhdCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBldmVudCBGdW5kVHJhbnNmZXIoYWRkcmVzcyBiYWNrZXIsIHVpbnQgYW1vdW50LCBib29sIGlzQ29udHJpYnV0aW9uKTsKCiAgICBmdW5jdGlvbiBTaW1wbGVDcm93ZHNhbGVCYXNlKGFkZHJlc3MgdG9rZW4pCiAgICB2YWxpZEFkZHJlc3ModG9rZW4pCiAgICB7CiAgICAgICAgbV90b2tlbiA9IE1pbnRhYmxlVG9rZW4odG9rZW4pOwogICAgfQoKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlOiBwYXltZW50cwoKICAgIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGFzIGEgc2hvcnRjdXQKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZSgwID09IG1zZy5kYXRhLmxlbmd0aCk7CiAgICAgICAgYnV5KCk7ICAvLyBvbmx5IGludGVybmFsIGNhbGwgaGVyZSEKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjcm93ZHNhbGUgcGFydGljaXBhdGlvbgogICAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgeyAgICAgLy8gZG9udCBtYXJrIGFzIGV4dGVybmFsIQogICAgICAgIGJ1eUludGVybmFsKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgMCk7CiAgICB9CgoKICAgIC8vIElOVEVSTkFMCgogICAgLy8vIEBkZXYgcGF5bWVudCBwcm9jZXNzaW5nCiAgICBmdW5jdGlvbiBidXlJbnRlcm5hbChhZGRyZXNzIGludmVzdG9yLCB1aW50IHBheW1lbnQsIHVpbnQgZXh0cmFCb251c2VzKQogICAgaW50ZXJuYWwKICAgIG5vblJlZW50cmFudAogICAgewogICAgICAgIHJlcXVpcmUocGF5bWVudCA+PSBnZXRNaW5JbnZlc3RtZW50KCkpOwogICAgICAgIHJlcXVpcmUoZ2V0Q3VycmVudFRpbWUoKSA+PSBnZXRTdGFydFRpbWUoKSB8fCAhIG11c3RBcHBseVRpbWVDaGVjayhpbnZlc3RvciwgcGF5bWVudCkgLyogZm9yIGZpbmFsIGNoZWNrICovKTsKICAgICAgICBpZiAoZ2V0Q3VycmVudFRpbWUoKSA+PSBnZXRFbmRUaW1lKCkpIHsKCiAgICAgICAgICAgIGZpbmlzaCgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1fZmluaXNoZWQpIHsKICAgICAgICAgICAgLy8gc2F2aW5nIHByb3ZpZGVkIGdhcwogICAgICAgICAgICBpbnZlc3Rvci50cmFuc2ZlcihwYXltZW50KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdWludCBzdGFydGluZ1dlaUNvbGxlY3RlZCA9IGdldFdlaUNvbGxlY3RlZCgpOwogICAgICAgIHVpbnQgc3RhcnRpbmdJbnZhcmlhbnQgPSB0aGlzLmJhbGFuY2UuYWRkKHN0YXJ0aW5nV2VpQ29sbGVjdGVkKTsKCiAgICAgICAgdWludCBjaGFuZ2U7CiAgICAgICAgaWYgKGhhc0hhcmRDYXAoKSkgewogICAgICAgICAgICAvLyByZXR1cm4gb3IgdXBkYXRlIHBheW1lbnQgaWYgbmVlZGVkCiAgICAgICAgICAgIHVpbnQgcGF5bWVudEFsbG93ZWQgPSBnZXRNYXhpbXVtRnVuZHMoKS5zdWIoZ2V0V2VpQ29sbGVjdGVkKCkpOwogICAgICAgICAgICBhc3NlcnQoMCAhPSBwYXltZW50QWxsb3dlZCk7CgogICAgICAgICAgICBpZiAocGF5bWVudEFsbG93ZWQgPCBwYXltZW50KSB7CiAgICAgICAgICAgICAgICBjaGFuZ2UgPSBwYXltZW50LnN1YihwYXltZW50QWxsb3dlZCk7CiAgICAgICAgICAgICAgICBwYXltZW50ID0gcGF5bWVudEFsbG93ZWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGlzc3VlIHRva2VucwogICAgICAgIHVpbnQgdG9rZW5zID0gY2FsY3VsYXRlVG9rZW5zKGludmVzdG9yLCBwYXltZW50LCBleHRyYUJvbnVzZXMpOwogICAgICAgIG1fdG9rZW4ubWludChpbnZlc3RvciwgdG9rZW5zKTsKICAgICAgICBtX3Rva2Vuc01pbnRlZCArPSB0b2tlbnM7CgogICAgICAgIC8vIHJlY29yZCBwYXltZW50CiAgICAgICAgc3RvcmVJbnZlc3RtZW50KGludmVzdG9yLCBwYXltZW50KTsKICAgICAgICBhc3NlcnQoKCFoYXNIYXJkQ2FwKCkgfHwgZ2V0V2VpQ29sbGVjdGVkKCkgPD0gZ2V0TWF4aW11bUZ1bmRzKCkpICYmIGdldFdlaUNvbGxlY3RlZCgpID4gc3RhcnRpbmdXZWlDb2xsZWN0ZWQpOwogICAgICAgIEZ1bmRUcmFuc2ZlcihpbnZlc3RvciwgcGF5bWVudCwgdHJ1ZSk7CgogICAgICAgIGlmIChoYXNIYXJkQ2FwKCkgJiYgZ2V0V2VpQ29sbGVjdGVkKCkgPT0gZ2V0TWF4aW11bUZ1bmRzKCkpCiAgICAgICAgZmluaXNoKCk7CgogICAgICAgIGlmIChjaGFuZ2UgPiAwKQogICAgICAgIGludmVzdG9yLnRyYW5zZmVyKGNoYW5nZSk7CgogICAgICAgIGFzc2VydChzdGFydGluZ0ludmFyaWFudCA9PSB0aGlzLmJhbGFuY2UuYWRkKGdldFdlaUNvbGxlY3RlZCgpKS5hZGQoY2hhbmdlKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZmluaXNoKCkgaW50ZXJuYWwgewogICAgICAgIGlmIChtX2ZpbmlzaGVkKQogICAgICAgIHJldHVybjsKCiAgICAgICAgaWYgKGdldFdlaUNvbGxlY3RlZCgpID49IGdldE1pbmltdW1GdW5kcygpKQogICAgICAgIHdjT25Dcm93ZHNhbGVTdWNjZXNzKCk7CiAgICAgICAgZWxzZQogICAgICAgIHdjT25Dcm93ZHNhbGVGYWlsdXJlKCk7CgogICAgICAgIG1fZmluaXNoZWQgPSB0cnVlOwogICAgfQoKCiAgICAvLyBPdGhlciBwbHVnZ2FibGVzCgogICAgLy8vIEBkZXYgc2F5cyBpZiBjcm93ZHNhbGUgdGltZSBib3VuZHMgbXVzdCBiZSBjaGVja2VkCiAgICBmdW5jdGlvbiBtdXN0QXBwbHlUaW1lQ2hlY2soYWRkcmVzcyAvKmludmVzdG9yKi8sIHVpbnQgLypwYXltZW50Ki8pIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB3aGV0aGVyIHRvIGFwcGx5IGhhcmQgY2FwIGNoZWNrIGxvZ2ljIHZpYSBnZXRNYXhpbXVtRnVuZHMoKSBtZXRob2QKICAgIGZ1bmN0aW9uIGhhc0hhcmRDYXAoKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGdldE1heGltdW1GdW5kcygpICE9IDA7CiAgICB9CgogICAgLy8vIEBkZXYgdG8gYmUgb3ZlcnJpZGRlbiBpbiB0ZXN0cwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFRpbWUoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBtYXhpbXVtIGludmVzdG1lbnRzIHRvIGJlIGFjY2VwdGVkIGR1cmluZyBwcmUtSUNPCiAgICBmdW5jdGlvbiBnZXRNYXhpbXVtRnVuZHMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQG5vdGljZSBtaW5pbXVtIGFtb3VudCBvZiBmdW5kaW5nIHRvIGNvbnNpZGVyIGNyb3dkc2FsZSBhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBnZXRNaW5pbXVtRnVuZHMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQG5vdGljZSBzdGFydCB0aW1lIG9mIHRoZSBwcmUtSUNPCiAgICBmdW5jdGlvbiBnZXRTdGFydFRpbWUoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQG5vdGljZSBlbmQgdGltZSBvZiB0aGUgcHJlLUlDTwogICAgZnVuY3Rpb24gZ2V0RW5kVGltZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAbm90aWNlIG1pbmltYWwgYW1vdW50IG9mIGludmVzdG1lbnQKICAgIGZ1bmN0aW9uIGdldE1pbkludmVzdG1lbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiAxMCBmaW5uZXk7CiAgICB9CgogICAgLy8vIEBkZXYgY2FsY3VsYXRlcyB0b2tlbiBhbW91bnQgZm9yIGdpdmVuIGludmVzdG1lbnQKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VucyhhZGRyZXNzIGludmVzdG9yLCB1aW50IHBheW1lbnQsIHVpbnQgZXh0cmFCb251c2VzKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCgogICAgLy8gSUNyb3dkc2FsZVN0YXQKCiAgICBmdW5jdGlvbiBnZXRXZWlDb2xsZWN0ZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBnZXRUb3RhbEludmVzdG1lbnRzU3RvcmVkKCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYW1vdW50IG9mIHRva2VucyBtaW50ZWQgKE5PVCBlcXVhbCB0byB0b3RhbFN1cHBseSgpIGluIGNhc2UgdG9rZW4gaXMgcmV1c2VkISkKICAgIGZ1bmN0aW9uIGdldFRva2VuTWludGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbV90b2tlbnNNaW50ZWQ7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAZGV2IGNvbnRyYWN0IHJlc3BvbnNpYmxlIGZvciB0b2tlbiBhY2NvdW50aW5nCiAgICBNaW50YWJsZVRva2VuIHB1YmxpYyBtX3Rva2VuOwoKICAgIHVpbnQgbV90b2tlbnNNaW50ZWQ7CgogICAgYm9vbCBtX2ZpbmlzaGVkID0gZmFsc2U7Cn0KCgovLy8gQHRpdGxlIFN0YXRlZnVsIG1peGluIGFkZCBzdGF0ZSB0byBjb250YWN0IGFuZCBoYW5kbGVycyBmb3IgaXQKY29udHJhY3QgU2ltcGxlU3RhdGVmdWwgewogICAgZW51bSBTdGF0ZSB7IElOSVQsIFJVTk5JTkcsIFBBVVNFRCwgRkFJTEVELCBTVUNDRUVERUQgfQoKICAgIGV2ZW50IFN0YXRlQ2hhbmdlZChTdGF0ZSBfc3RhdGUpOwoKICAgIG1vZGlmaWVyIHJlcXVpcmVzU3RhdGUoU3RhdGUgX3N0YXRlKSB7CiAgICAgICAgcmVxdWlyZShtX3N0YXRlID09IF9zdGF0ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBleGNlcHRTdGF0ZShTdGF0ZSBfc3RhdGUpIHsKICAgICAgICByZXF1aXJlKG1fc3RhdGUgIT0gX3N0YXRlKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVN0YXRlKFN0YXRlIF9uZXdTdGF0ZSkgaW50ZXJuYWwgewogICAgICAgIGFzc2VydChtX3N0YXRlICE9IF9uZXdTdGF0ZSk7CgogICAgICAgIGlmIChTdGF0ZS5JTklUID09IG1fc3RhdGUpIHsKICAgICAgICAgICAgYXNzZXJ0KFN0YXRlLlJVTk5JTkcgPT0gX25ld1N0YXRlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoU3RhdGUuUlVOTklORyA9PSBtX3N0YXRlKSB7CiAgICAgICAgICAgIGFzc2VydChTdGF0ZS5QQVVTRUQgPT0gX25ld1N0YXRlIHx8IFN0YXRlLkZBSUxFRCA9PSBfbmV3U3RhdGUgfHwgU3RhdGUuU1VDQ0VFREVEID09IF9uZXdTdGF0ZSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKFN0YXRlLlBBVVNFRCA9PSBtX3N0YXRlKSB7CiAgICAgICAgICAgIGFzc2VydChTdGF0ZS5SVU5OSU5HID09IF9uZXdTdGF0ZSB8fCBTdGF0ZS5GQUlMRUQgPT0gX25ld1N0YXRlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBhc3NlcnQoZmFsc2UpOwoKICAgICAgICBtX3N0YXRlID0gX25ld1N0YXRlOwogICAgICAgIFN0YXRlQ2hhbmdlZChtX3N0YXRlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50U3RhdGUoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoU3RhdGUpIHsKICAgICAgICByZXR1cm4gbV9zdGF0ZTsKICAgIH0KCiAgICAvLy8gQGRldiBzdGF0ZSBvZiBzYWxlCiAgICBTdGF0ZSBwdWJsaWMgbV9zdGF0ZSA9IFN0YXRlLklOSVQ7Cn0KCgoKLyoqCiAqIFN0b3JlcyBpbnZlc3RtZW50cyBpbiBGdW5kc1JlZ2lzdHJ5LgogKi8KY29udHJhY3QgTWV0cm9wb2xGdW5kc1JlZ2lzdHJ5V2FsbGV0Q29ubmVjdG9yIGlzIElJbnZlc3RtZW50c1dhbGxldENvbm5lY3RvciB7CgogICAgZnVuY3Rpb24gTWV0cm9wb2xGdW5kc1JlZ2lzdHJ5V2FsbGV0Q29ubmVjdG9yKGFkZHJlc3MgX2Z1bmRzQWRkcmVzcykKICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoX2Z1bmRzQWRkcmVzcyE9YWRkcmVzcygwKSk7CiAgICAgICAgbV9mdW5kc0FkZHJlc3MgPSBGdW5kc1JlZ2lzdHJ5KF9mdW5kc0FkZHJlc3MpOwogICAgfQoKICAgIC8vLyBAZGV2IHByb2Nlc3MgYW5kIGZvcndhcmQgaW52ZXN0bWVudAogICAgZnVuY3Rpb24gc3RvcmVJbnZlc3RtZW50KGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgcGF5bWVudCkgaW50ZXJuYWwKICAgIHsKICAgICAgICBtX2Z1bmRzQWRkcmVzcy5pbnZlc3RlZC52YWx1ZShwYXltZW50KShpbnZlc3Rvcik7CiAgICB9CgogICAgLy8vIEBkZXYgdG90YWwgaW52ZXN0bWVudHMgYW1vdW50IHN0b3JlZCB1c2luZyBzdG9yZUludmVzdG1lbnQoKQogICAgZnVuY3Rpb24gZ2V0VG90YWxJbnZlc3RtZW50c1N0b3JlZCgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIG1fZnVuZHNBZGRyZXNzLnRvdGFsSW52ZXN0ZWQoKTsKICAgIH0KCiAgICAvLy8gQGRldiBjYWxsZWQgaW4gY2FzZSBjcm93ZHNhbGUgc3VjY2VlZGVkCiAgICBmdW5jdGlvbiB3Y09uQ3Jvd2RzYWxlU3VjY2VzcygpIGludGVybmFsIHsKICAgICAgICBtX2Z1bmRzQWRkcmVzcy5jaGFuZ2VTdGF0ZShGdW5kc1JlZ2lzdHJ5LlN0YXRlLlNVQ0NFRURFRCk7CiAgICAgICAgbV9mdW5kc0FkZHJlc3MuZGV0YWNoQ29udHJvbGxlcigpOwogICAgfQoKICAgIC8vLyBAZGV2IGNhbGxlZCBpbiBjYXNlIGNyb3dkc2FsZSBmYWlsZWQKICAgIGZ1bmN0aW9uIHdjT25Dcm93ZHNhbGVGYWlsdXJlKCkgaW50ZXJuYWwgewogICAgICAgIG1fZnVuZHNBZGRyZXNzLmNoYW5nZVN0YXRlKEZ1bmRzUmVnaXN0cnkuU3RhdGUuUkVGVU5ESU5HKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBhZGRyZXNzIG9mIHdhbGxldCB3aGljaCBzdG9yZXMgZnVuZHMKICAgIEZ1bmRzUmVnaXN0cnkgcHVibGljIG1fZnVuZHNBZGRyZXNzOwp9CgoKLyoqCiAqIENyb3dkc2FsZSB3aXRoIHN0YXRlCiAqLwpjb250cmFjdCBTdGF0ZWZ1bFJldHVybmFibGVDcm93ZHNhbGUgaXMKU2ltcGxlQ3Jvd2RzYWxlQmFzZSwKU2ltcGxlU3RhdGVmdWwsCm11bHRpb3duZWQsCk1ldHJvcG9sRnVuZHNSZWdpc3RyeVdhbGxldENvbm5lY3Rvcgp7CgogICAgLyoqIExhc3QgcmVjb3JkZWQgZnVuZHMgKi8KICAgIHVpbnQyNTYgcHVibGljIG1fbGFzdEZ1bmRzQW1vdW50OwoKICAgIGV2ZW50IFdpdGhkcmF3KGFkZHJlc3MgcGF5ZWUsIHVpbnQgYW1vdW50KTsKCiAgICAvKioKICAgICAqIEF1dG9tYXRpYyBjaGVjayBmb3IgdW5hY2NvdW50ZWQgd2l0aGRyYXdhbHMKICAgICAqIEBwYXJhbSBfaW52ZXN0b3Igb3B0aW9uYWwgcmVmdW5kIHBhcmFtZXRlcgogICAgICogQHBhcmFtIF9wYXltZW50IG9wdGlvbmFsIHJlZnVuZCBwYXJhbWV0ZXIKICAgICAqLwogICAgbW9kaWZpZXIgZnVuZHNDaGVja2VyKGFkZHJlc3MgX2ludmVzdG9yLCB1aW50IF9wYXltZW50KSB7CiAgICAgICAgdWludCBhdFRoZUJlZ2lubmluZyA9IGdldFRvdGFsSW52ZXN0bWVudHNTdG9yZWQoKTsKICAgICAgICBpZiAoYXRUaGVCZWdpbm5pbmcgPCBtX2xhc3RGdW5kc0Ftb3VudCkgewogICAgICAgICAgICBjaGFuZ2VTdGF0ZShTdGF0ZS5QQVVTRUQpOwogICAgICAgICAgICBpZiAoX3BheW1lbnQgPiAwKSB7CiAgICAgICAgICAgICAgICBfaW52ZXN0b3IudHJhbnNmZXIoX3BheW1lbnQpOyAgICAgLy8gd2UgY2FudCB0aHJvdyAoaGF2ZSB0byBzYXZlIHN0YXRlKSwgc28gcmVmdW5kaW5nIHRoaXMgd2F5CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbm90ZSB0aGF0IGV4ZWN1dGlvbiBvZiBmdXJ0aGVyIChidXQgbm90IHByZWNlZGluZyEpIG1vZGlmaWVycyBhbmQgZnVuY3Rpb25zIGVuZHMgaGVyZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF87CgogICAgICAgICAgICBpZiAoZ2V0VG90YWxJbnZlc3RtZW50c1N0b3JlZCgpIDwgYXRUaGVCZWdpbm5pbmcpIHsKICAgICAgICAgICAgICAgIGNoYW5nZVN0YXRlKFN0YXRlLlBBVVNFRCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtX2xhc3RGdW5kc0Ftb3VudCA9IGdldFRvdGFsSW52ZXN0bWVudHNTdG9yZWQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRyaWdnZXJzIHNvbWUgc3RhdGUgY2hhbmdlcyBiYXNlZCBvbiBjdXJyZW50IHRpbWUKICAgICAqLwogICAgbW9kaWZpZXIgdGltZWRTdGF0ZUNoYW5nZSgpIHsKICAgICAgICBpZiAoZ2V0Q3VycmVudFN0YXRlKCkgPT0gU3RhdGUuSU5JVCAmJiBnZXRDdXJyZW50VGltZSgpID49IGdldFN0YXJ0VGltZSgpKSB7CiAgICAgICAgICAgIGNoYW5nZVN0YXRlKFN0YXRlLlJVTk5JTkcpOwogICAgICAgIH0KCiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICovCiAgICBmdW5jdGlvbiBTdGF0ZWZ1bFJldHVybmFibGVDcm93ZHNhbGUoCiAgICBhZGRyZXNzIF90b2tlbiwKICAgIGFkZHJlc3MgX2Z1bmRzLAogICAgYWRkcmVzc1tdIF9vd25lcnMsCiAgICB1aW50IF9zaWduYXR1cmVzUmVxdWlyZWQKICAgICkKICAgIHB1YmxpYwogICAgU2ltcGxlQ3Jvd2RzYWxlQmFzZShfdG9rZW4pCiAgICBtdWx0aW93bmVkKF9vd25lcnMsIF9zaWduYXR1cmVzUmVxdWlyZWQpCiAgICBNZXRyb3BvbEZ1bmRzUmVnaXN0cnlXYWxsZXRDb25uZWN0b3IoX2Z1bmRzKQogICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgIHZhbGlkQWRkcmVzcyhfZnVuZHMpCiAgICB7CiAgICB9CgogICAgZnVuY3Rpb24gcGF1c2VDcm93ZHNhbGUoKQogICAgcHVibGljCiAgICBvbmx5b3duZXIKICAgIHJlcXVpcmVzU3RhdGUoU3RhdGUuUlVOTklORykKICAgIHsKICAgICAgICBjaGFuZ2VTdGF0ZShTdGF0ZS5QQVVTRUQpOwogICAgfQogICAgZnVuY3Rpb24gY29udGludWVDcm93ZHNhbGUoKQogICAgcHVibGljCiAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgIHJlcXVpcmVzU3RhdGUoU3RhdGUuUEFVU0VEKQogICAgewogICAgICAgIGNoYW5nZVN0YXRlKFN0YXRlLlJVTk5JTkcpOwoKICAgICAgICBpZiAoZ2V0Q3VycmVudFRpbWUoKSA+PSBnZXRFbmRUaW1lKCkpIHsKICAgICAgICAgICAgZmluaXNoKCk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZmFpbENyb3dkc2FsZSgpCiAgICBwdWJsaWMKICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5QQVVTRUQpCiAgICB7CiAgICAgICAgd2NPbkNyb3dkc2FsZUZhaWx1cmUoKTsKICAgICAgICBtX2ZpbmlzaGVkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkKICAgIHB1YmxpYwogICAgbm9uUmVlbnRyYW50CiAgICByZXF1aXJlc1N0YXRlKFN0YXRlLkZBSUxFRCkKICAgIHsKICAgICAgICBXaXRoZHJhdyhtc2cuc2VuZGVyLCBtX2Z1bmRzQWRkcmVzcy5tX3dlaUJhbGFuY2VzKG1zZy5zZW5kZXIpKTsKICAgICAgICBtX2Z1bmRzQWRkcmVzcy53aXRoZHJhd1BheW1lbnRzKG1zZy5zZW5kZXIpOwogICAgfQoKCiAgICAvKioKICAgICAqIEFkZGl0aW9uYWwgY2hlY2sgb2YgY29udHJpYnV0aW5nIHByb2Nlc3Mgc2luY2Ugd2UgaGF2ZSBzdGF0ZQogICAgICovCiAgICBmdW5jdGlvbiBidXlJbnRlcm5hbChhZGRyZXNzIF9pbnZlc3RvciwgdWludCBfcGF5bWVudCwgdWludCBfZXh0cmFCb251c2VzKQogICAgaW50ZXJuYWwKICAgIHRpbWVkU3RhdGVDaGFuZ2UKICAgIGV4Y2VwdFN0YXRlKFN0YXRlLlBBVVNFRCkKICAgIGZ1bmRzQ2hlY2tlcihfaW52ZXN0b3IsIF9wYXltZW50KQogICAgewogICAgICAgIGlmICghbXVzdEFwcGx5VGltZUNoZWNrKF9pbnZlc3RvciwgX3BheW1lbnQpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoU3RhdGUuUlVOTklORyA9PSBtX3N0YXRlIHx8IFN0YXRlLklOSVQgPT0gbV9zdGF0ZSk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmUoU3RhdGUuUlVOTklORyA9PSBtX3N0YXRlKTsKICAgICAgICB9CgogICAgICAgIHN1cGVyLmJ1eUludGVybmFsKF9pbnZlc3RvciwgX3BheW1lbnQsIF9leHRyYUJvbnVzZXMpOwogICAgfQoKCiAgICAvLy8gQGRldiBjYWxsZWQgaW4gY2FzZSBjcm93ZHNhbGUgc3VjY2VlZGVkCiAgICBmdW5jdGlvbiB3Y09uQ3Jvd2RzYWxlU3VjY2VzcygpIGludGVybmFsIHsKICAgICAgICBzdXBlci53Y09uQ3Jvd2RzYWxlU3VjY2VzcygpOwoKICAgICAgICBjaGFuZ2VTdGF0ZShTdGF0ZS5TVUNDRUVERUQpOwogICAgfQoKICAgIC8vLyBAZGV2IGNhbGxlZCBpbiBjYXNlIGNyb3dkc2FsZSBmYWlsZWQKICAgIGZ1bmN0aW9uIHdjT25Dcm93ZHNhbGVGYWlsdXJlKCkgaW50ZXJuYWwgewogICAgICAgIHN1cGVyLndjT25Dcm93ZHNhbGVGYWlsdXJlKCk7CgogICAgICAgIGNoYW5nZVN0YXRlKFN0YXRlLkZBSUxFRCk7CiAgICB9Cgp9CgoKLyoqCiAqIE1ldHJvcG9sQ3Jvd2RzYWxlCiAqLwpjb250cmFjdCBNZXRyb3BvbENyb3dkc2FsZSBpcyBTdGF0ZWZ1bFJldHVybmFibGVDcm93ZHNhbGUgewoKICAgIHVpbnQyNTYgcHVibGljIG1fc3RhcnRUaW1lc3RhbXA7CiAgICB1aW50MjU2IHB1YmxpYyBtX3NvZnRDYXA7CiAgICB1aW50MjU2IHB1YmxpYyBtX2hhcmRDYXA7CiAgICB1aW50MjU2IHB1YmxpYyBtX2V4Y2hhbmdlUmF0ZTsKICAgIGFkZHJlc3MgcHVibGljIG1fZm91bmRlcnNUb2tlbnNTdG9yYWdlOwogICAgYm9vbCBwdWJsaWMgbV9pbml0aWFsU2V0dGluZ3NTZXQgPSBmYWxzZTsKCiAgICBtb2RpZmllciByZXF1aXJlU2V0dGluZ3NTZXQoKSB7CiAgICAgICAgcmVxdWlyZShtX2luaXRpYWxTZXR0aW5nc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBNZXRyb3BvbENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfZnVuZHMsIGFkZHJlc3NbXSBfb3duZXJzKQogICAgICAgIHB1YmxpYwogICAgICAgIFN0YXRlZnVsUmV0dXJuYWJsZUNyb3dkc2FsZShfdG9rZW4sIF9mdW5kcywgX293bmVycywgMikKICAgIHsKICAgICAgICByZXF1aXJlKDMgPT0gX293bmVycy5sZW5ndGgpOwoKICAgICAgICAvLzIwMzAtMDEtMDEsIG5vdCB0byBzdGFydCBjcm93ZHNhbGUKICAgICAgICBtX3N0YXJ0VGltZXN0YW1wID0gMTg5MzQ1NjAwMDsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBleGNoYW5nZSByYXRlIGJlZm9yZSBzdGFydAogICAgICovCiAgICBmdW5jdGlvbiBzZXRJbml0aWFsU2V0dGluZ3MoCiAgICAgICAgICAgIGFkZHJlc3MgX2ZvdW5kZXJzVG9rZW5zU3RvcmFnZSwKICAgICAgICAgICAgdWludDI1NiBfc3RhcnRUaW1lc3RhbXAsCiAgICAgICAgICAgIHVpbnQyNTYgX3NvZnRDYXBJbkV0aGVyLAogICAgICAgICAgICB1aW50MjU2IF9oYXJkQ2FwSW5FdGhlciwKICAgICAgICAgICAgdWludDI1NiBfdG9rZW5zRm9yT25lRXRoZXIKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgdGltZWRTdGF0ZUNoYW5nZQogICAgICAgIHJlcXVpcmVzU3RhdGUoU3RhdGUuSU5JVCkKICAgICAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgICAgICB2YWxpZEFkZHJlc3MoX2ZvdW5kZXJzVG9rZW5zU3RvcmFnZSkKICAgIHsKICAgICAgICAvL25vIGNoZWNrIGZvciBzZXR0aW5ncyBzZXQKICAgICAgICAvL2NhbiBiZSBzZXQgbXVsdGlwbGUgdGltZXMgYmVmb3JlIElDTwoKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWVzdGFtcCE9MCk7CiAgICAgICAgcmVxdWlyZShfc29mdENhcEluRXRoZXIhPTApOwogICAgICAgIHJlcXVpcmUoX2hhcmRDYXBJbkV0aGVyIT0wKTsKICAgICAgICByZXF1aXJlKF90b2tlbnNGb3JPbmVFdGhlciE9MCk7CgogICAgICAgIG1fc3RhcnRUaW1lc3RhbXAgPSBfc3RhcnRUaW1lc3RhbXA7CiAgICAgICAgbV9zb2Z0Q2FwID0gX3NvZnRDYXBJbkV0aGVyICogMSBldGhlcjsKICAgICAgICBtX2hhcmRDYXAgPSBfaGFyZENhcEluRXRoZXIgKiAxIGV0aGVyOwogICAgICAgIG1fZXhjaGFuZ2VSYXRlID0gX3Rva2Vuc0Zvck9uZUV0aGVyOwogICAgICAgIG1fZm91bmRlcnNUb2tlbnNTdG9yYWdlID0gX2ZvdW5kZXJzVG9rZW5zU3RvcmFnZTsKCiAgICAgICAgbV9pbml0aWFsU2V0dGluZ3NTZXQgPSB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGV4Y2hhbmdlIHJhdGUgYmVmb3JlIHN0YXJ0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldEV4Y2hhbmdlUmF0ZSh1aW50MjU2IF90b2tlbnNGb3JPbmVFdGhlcikKICAgICAgICBwdWJsaWMKICAgICAgICB0aW1lZFN0YXRlQ2hhbmdlCiAgICAgICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5JTklUKQogICAgICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIG1fZXhjaGFuZ2VSYXRlID0gX3Rva2Vuc0Zvck9uZUV0aGVyOwogICAgfQoKICAgIC8qKgogICAgICogd2l0aGRyYXcgcGF5bWVudHMgYnkgaW52ZXN0b3Igb24gZmFpbAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkgcHVibGljIHJlcXVpcmVTZXR0aW5nc1NldCB7CiAgICAgICAgZ2V0VG9rZW4oKS5idXJuKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBnZXRUb2tlbigpLmJhbGFuY2VPZihtc2cuc2VuZGVyKQogICAgICAgICk7CgogICAgICAgIHN1cGVyLndpdGhkcmF3UGF5bWVudHMoKTsKICAgIH0KCgogICAgLy8gSU5URVJOQUwKICAgIC8qKgogICAgICogQWRkaXRpb25hbCBjaGVjayBvZiBpbml0aWFsIHNldHRpbmdzIHNldAogICAgICovCiAgICBmdW5jdGlvbiBidXlJbnRlcm5hbChhZGRyZXNzIF9pbnZlc3RvciwgdWludCBfcGF5bWVudCwgdWludCBfZXh0cmFCb251c2VzKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmVxdWlyZVNldHRpbmdzU2V0CiAgICB7CiAgICAgICAgc3VwZXIuYnV5SW50ZXJuYWwoX2ludmVzdG9yLCBfcGF5bWVudCwgX2V4dHJhQm9udXNlcyk7CiAgICB9CgoKICAgIC8qKgogICAgICogQWxsIHVzZXJzIGV4Y2VwdCBkZXBsb3llciBtdXN0IGNoZWNrIHRpbWUgYmVmb3JlIGNvbnRyaWJ1dGluZwogICAgICovCiAgICBmdW5jdGlvbiBtdXN0QXBwbHlUaW1lQ2hlY2soYWRkcmVzcyBpbnZlc3RvciwgdWludCBwYXltZW50KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuICFpc093bmVyKGludmVzdG9yKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvciBtaW4gaW52ZXN0bWVudCBjaGVjawogICAgICovCiAgICBmdW5jdGlvbiBnZXRNaW5JbnZlc3RtZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gMSB3ZWk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgY29sbGVjdGVkIGZ1bmRzIChpbnRlcm5hbGx5IGZyb20gRnVuZHNSZWdpc3RyeSkKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0V2VpQ29sbGVjdGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gZ2V0VG90YWxJbnZlc3RtZW50c1N0b3JlZCgpOwogICAgfQoKICAgIC8qKgogICAgICogTWluaW11bSBhbW91bnQgb2YgZnVuZGluZyB0byBjb25zaWRlciBjcm93ZHNhbGUgYXMgc3VjY2Vzc2Z1bAogICAgICovCiAgICBmdW5jdGlvbiBnZXRNaW5pbXVtRnVuZHMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG1fc29mdENhcDsKICAgIH0KCiAgICAvKioKICAgICAqIE1heGltdW0gaW52ZXN0bWVudHMgdG8gYmUgYWNjZXB0ZWQgZHVyaW5nIGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBnZXRNYXhpbXVtRnVuZHMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG1faGFyZENhcDsKICAgIH0KCiAgICAvKioKICAgICAqIFN0YXJ0IHRpbWUgb2YgdGhlIGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBnZXRTdGFydFRpbWUoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG1fc3RhcnRUaW1lc3RhbXA7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmQgdGltZSBvZiB0aGUgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEVuZFRpbWUoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG1fc3RhcnRUaW1lc3RhbXAgKyA2MCBkYXlzOwogICAgfQoKICAgIC8qKgogICAgICogRm9ybXVsYSBmb3IgY2FsY3VsYXRpbmcgdG9rZW5zIGZyb20gY29udHJpYnV0ZWQgZXRoZXIKICAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlVG9rZW5zKGFkZHJlc3MgLyppbnZlc3RvciovLCB1aW50IHBheW1lbnQsIHVpbnQgLypleHRyYUJvbnVzZXMqLykKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICB1aW50MjU2IHNlY29uZE1vbnRoID0gbV9zdGFydFRpbWVzdGFtcCArIDMwIGRheXM7CiAgICAgICAgaWYgKGdldEN1cnJlbnRUaW1lKCkgPD0gc2Vjb25kTW9udGgpIHsKICAgICAgICAgICAgcmV0dXJuIHBheW1lbnQubXVsKG1fZXhjaGFuZ2VSYXRlKTsKICAgICAgICB9IGVsc2UgaWYgKGdldEN1cnJlbnRUaW1lKCkgPD0gc2Vjb25kTW9udGggKyAxIHdlZWtzKSB7CiAgICAgICAgICAgIHJldHVybiBwYXltZW50Lm11bChtX2V4Y2hhbmdlUmF0ZSkubXVsKDEwMCkuZGl2KDEwNSk7CiAgICAgICAgfSBlbHNlIGlmIChnZXRDdXJyZW50VGltZSgpIDw9IHNlY29uZE1vbnRoICsgMiB3ZWVrcykgewogICAgICAgICAgICByZXR1cm4gcGF5bWVudC5tdWwobV9leGNoYW5nZVJhdGUpLm11bCgxMDApLmRpdigxMTApOwogICAgICAgIH0gZWxzZSBpZiAoZ2V0Q3VycmVudFRpbWUoKSA8PSBzZWNvbmRNb250aCArIDMgd2Vla3MpIHsKICAgICAgICAgICAgcmV0dXJuIHBheW1lbnQubXVsKG1fZXhjaGFuZ2VSYXRlKS5tdWwoMTAwKS5kaXYoMTE1KTsKICAgICAgICB9IGVsc2UgaWYgKGdldEN1cnJlbnRUaW1lKCkgPD0gc2Vjb25kTW9udGggKyA0IHdlZWtzKSB7CiAgICAgICAgICAgIHJldHVybiBwYXltZW50Lm11bChtX2V4Y2hhbmdlUmF0ZSkubXVsKDEwMCkuZGl2KDEyMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHBheW1lbnQubXVsKG1fZXhjaGFuZ2VSYXRlKS5tdWwoMTAwKS5kaXYoMTI1KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGRpdGlvbmFsIG9uLXN1Y2Nlc3MgYWN0aW9ucwogICAgICovCiAgICBmdW5jdGlvbiB3Y09uQ3Jvd2RzYWxlU3VjY2VzcygpIGludGVybmFsIHsKICAgICAgICBzdXBlci53Y09uQ3Jvd2RzYWxlU3VjY2VzcygpOwoKICAgICAgICAvLzIwJSBvZiB0b3RhbCB0b3RhbFN1cHBseSB0byB0ZWFtCiAgICAgICAgbV90b2tlbi5taW50KAogICAgICAgICAgICBtX2ZvdW5kZXJzVG9rZW5zU3RvcmFnZSwKICAgICAgICAgICAgZ2V0VG9rZW4oKS50b3RhbFN1cHBseSgpLm11bCgyMCkuZGl2KDgwKQogICAgICAgICk7CgoKICAgICAgICBnZXRUb2tlbigpLnN0YXJ0Q2lyY3VsYXRpb24oKTsKICAgICAgICBnZXRUb2tlbigpLmRldGFjaENvbnRyb2xsZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXR0YWNoZWQgdG9rZW4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG9rZW4oKSBpbnRlcm5hbCByZXR1cm5zKE1ldHJvcG9sVG9rZW4pIHsKICAgICAgICByZXR1cm4gTWV0cm9wb2xUb2tlbihtX3Rva2VuKTsKICAgIH0KfQ=='.
	

]
