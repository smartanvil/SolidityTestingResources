Class {
	#name : #SRT4B177c969E1E4F5EA6a01E7707e77d0b9d289C4c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4B177c969E1E4F5EA6a01E7707e77d0b9d289C4c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQp9Ly8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKLy8gVGhpcyBhcGkgaXMgY3VycmVudGx5IHRhcmdldGVkIGF0IDAuNC4xOCwgcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIG9yIG9yYWNsaXplQVBJXzAuNCB3aGVyZSBuZWNlc3NhcnkKCmNvbnRyYWN0IE9yYWNsaXplSSB7CiAgICBhZGRyZXNzIHB1YmxpYyBjYkFkZHJlc3M7CiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZywgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMikgcHVibGljIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04pIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHB1YmxpYyByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgcHVibGljIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBzZXRDdXN0b21HYXNQcmljZSh1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiByYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMik7Cn0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTGVkZ2VyID0gMHgzMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOwoKICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsKICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgICAgICBpZigoYWRkcmVzcyhPQVIpPT0wKXx8KGdldENvZGVTaXplKGFkZHJlc3MoT0FSKSk9PTApKQogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKCiAgICAgICAgaWYoYWRkcmVzcyhvcmFjbGl6ZSkgIT0gT0FSLmdldEFkZHJlc3MoKSkKICAgICAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CgogICAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBjb3Vwb24oc3RyaW5nIGNvZGUpewogICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICAgIHJldHVybiBvcmFjbGl6ZV9zZXROZXR3b3JrKCk7CiAgICAgIG5ldHdvcmtJRDsgLy8gc2lsZW5jZSB0aGUgd2FybmluZyBhbmQgcmVtYWluIGJhY2t3YXJkcyBjb21wYXRpYmxlCiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk+MCl7IC8va292YW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9rb3ZhbiIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgcHVibGljIHsKICAgICAgICBfX2NhbGxiYWNrKG15aWQsIHJlc3VsdCwgbmV3IGJ5dGVzKDApKTsKICAgIH0KICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgcHVibGljIHsKICAgICAgcmV0dXJuOwogICAgICBteWlkOyByZXN1bHQ7IHByb29mOyAvLyBTaWxlbmNlIGNvbXBpbGVyIHdhcm5pbmdzCiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRQcm9vZlR5cGUocHJvb2ZQKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q3VzdG9tR2FzUHJpY2UoZ2FzUHJpY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29kZVNpemUoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50IF9zaXplKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VBZGRyKHN0cmluZyBfYSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICBieXRlcyBtZW1vcnkgdG1wID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQxNjAgaWFkZHIgPSAwOwogICAgICAgIHVpbnQxNjAgYjE7CiAgICAgICAgdWludDE2MCBiMjsKICAgICAgICBmb3IgKHVpbnQgaT0yOyBpPDIrMioyMDsgaSs9Mil7CiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsKICAgICAgICAgICAgYjEgPSB1aW50MTYwKHRtcFtpXSk7CiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSsxXSk7CiAgICAgICAgICAgIGlmICgoYjEgPj0gOTcpJiYoYjEgPD0gMTAyKSkgYjEgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA2NSkmJihiMSA8PSA3MCkpIGIxIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpJiYoYjEgPD0gNTcpKSBiMSAtPSA0ODsKICAgICAgICAgICAgaWYgKChiMiA+PSA5NykmJihiMiA8PSAxMDIpKSBiMiAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDY1KSYmKGIyIDw9IDcwKSkgYjIgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkmJihiMiA8PSA1NykpIGIyIC09IDQ4OwogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGggPSBieXRlcyhfaGF5c3RhY2spOwogICAgICAgIGJ5dGVzIG1lbW9yeSBuID0gYnl0ZXMoX25lZWRsZSk7CiAgICAgICAgaWYoaC5sZW5ndGggPCAxIHx8IG4ubGVuZ3RoIDwgMSB8fCAobi5sZW5ndGggPiBoLmxlbmd0aCkpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmKGgubGVuZ3RoID4gKDIqKjEyOCAtMSkpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaC5sZW5ndGg7IGkgKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPSAxOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKHN1YmluZGV4IDwgbi5sZW5ndGggJiYgKGkgKyBzdWJpbmRleCkgPCBoLmxlbmd0aCAmJiBoW2kgKyBzdWJpbmRleF0gPT0gbltzdWJpbmRleF0pCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZihzdWJpbmRleCA9PSBuLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsICIiLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsKICAgIH0KCiAgICAvLyBwYXJzZUludAogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogICAgfQoKICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQgbWludCA9IDA7CiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmICgoYnJlc3VsdFtpXSA+PSA0OCkmJihicmVzdWx0W2ldIDw9IDU3KSl7CiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpewogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGVsc2UgX2ItLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7CiAgICAgICAgICAgICAgICBtaW50ICs9IHVpbnQoYnJlc3VsdFtpXSkgLSA0ODsKICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChfYiA+IDApIG1pbnQgKj0gMTAqKl9iOwogICAgICAgIHJldHVybiBtaW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHVpbnQyc3RyKHVpbnQgaSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpewogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7CiAgICAgICAgdWludCBqID0gaTsKICAgICAgICB1aW50IGxlbjsKICAgICAgICB3aGlsZSAoaiAhPSAwKXsKICAgICAgICAgICAgbGVuKys7CiAgICAgICAgICAgIGogLz0gMTA7CiAgICAgICAgfQogICAgICAgIGJ5dGVzIG1lbW9yeSBic3RyID0gbmV3IGJ5dGVzKGxlbik7CiAgICAgICAgdWludCBrID0gbGVuIC0gMTsKICAgICAgICB3aGlsZSAoaSAhPSAwKXsKICAgICAgICAgICAgYnN0cltrLS1dID0gYnl0ZSg0OCArIGkgJSAxMCk7CiAgICAgICAgICAgIGkgLz0gMTA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHJpbmcoYnN0cik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKICAgIGZ1bmN0aW9uIGJhMmNib3IoYnl0ZXNbXSBhcnIpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCgogICAgc3RyaW5nIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKHN0cmluZyBfbmV0d29ya19uYW1lKSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfbmV0d29ya19uYW1lID0gX25ldHdvcmtfbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KHVpbnQgX2RlbGF5LCB1aW50IF9uYnl0ZXMsIHVpbnQgX2N1c3RvbUdhc0xpbWl0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICByZXF1aXJlKChfbmJ5dGVzID4gMCkgJiYgKF9uYnl0ZXMgPD0gMzIpKTsKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25LZXlIYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlczMyIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIgPSBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbXN0b3JlKHVub25jZSwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkKICAgICAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNlc3Npb25LZXlIYXNoLCAweDIwKSwgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMikKICAgICAgICB9CiAgICAgICAgYnl0ZXNbM10gbWVtb3J5IGFyZ3MgPSBbdW5vbmNlLCBuYnl0ZXMsIHNlc3Npb25LZXlIYXNoXTsKICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeShfZGVsYXksICJyYW5kb20iLCBhcmdzLCBfY3VzdG9tR2FzTGltaXQpOwogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQocXVlcnlJZCwga2VjY2FrMjU2KGJ5dGVzOChfZGVsYXkpLCBhcmdzWzFdLCBzaGEyNTYoYXJnc1swXSksIGFyZ3NbMl0pKTsKICAgICAgICByZXR1cm4gcXVlcnlJZDsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9IGNvbW1pdG1lbnQ7CiAgICB9CgogICAgbWFwcGluZyhieXRlczMyPT5ieXRlczMyKSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzOwogICAgbWFwcGluZyhieXRlczMyPT5ib29sKSBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZDsKCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWcoYnl0ZXMzMiB0b3NpZ25oLCBieXRlcyBkZXJzaWcsIGJ5dGVzIHB1YmtleSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBzaWdvazsKICAgICAgICBhZGRyZXNzIHNpZ25lcjsKCiAgICAgICAgYnl0ZXMzMiBzaWdyOwogICAgICAgIGJ5dGVzMzIgc2lnczsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3JfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IG9mZnNldCA9IDQrKHVpbnQoZGVyc2lnWzNdKSAtIDB4MjApOwogICAgICAgIHNpZ3JfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0LCAzMiwgc2lncl8sIDApOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdzXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgb2Zmc2V0ICs9IDMyICsgMjsKICAgICAgICBzaWdzXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCsodWludChkZXJzaWdbb2Zmc2V0LTFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpZ3IgOj0gbWxvYWQoYWRkKHNpZ3JfLCAzMikpCiAgICAgICAgICAgIHNpZ3MgOj0gbWxvYWQoYWRkKHNpZ3NfLCAzMikpCiAgICAgICAgfQoKCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsKICAgICAgICBpZiAoYWRkcmVzcyhrZWNjYWsyNTYocHVia2V5KSkgPT0gc2lnbmVyKSByZXR1cm4gdHJ1ZTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI4LCBzaWdyLCBzaWdzKTsKICAgICAgICAgICAgcmV0dXJuIChhZGRyZXNzKGtlY2NhazI1NihwdWJrZXkpKSA9PSBzaWduZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KGJ5dGVzIHByb29mLCB1aW50IHNpZzJvZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHNpZ29rOwoKICAgICAgICAvLyBTdGVwIDY6IHZlcmlmeSB0aGUgYXR0ZXN0YXRpb24gc2lnbmF0dXJlLCBBUFBLRVkxIG11c3Qgc2lnbiB0aGUgc2Vzc2lvbktleSBmcm9tIHRoZSBjb3JyZWN0IGxlZGdlciBhcHAgKENPREVIQVNIKQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcyID0gbmV3IGJ5dGVzKHVpbnQocHJvb2Zbc2lnMm9mZnNldCsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LCBzaWcyLmxlbmd0aCwgc2lnMiwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24yID0gbmV3IGJ5dGVzKDErNjUrMzIpOwogICAgICAgIHRvc2lnbjJbMF0gPSBieXRlKDEpOyAvL3JvbGUKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjUsIDY1LCB0b3NpZ24yLCAxKTsKICAgICAgICBieXRlcyBtZW1vcnkgQ09ERUhBU0ggPSBoZXgiZmQ5NGZhNzFiYzBiYTEwZDM5ZDQ2NGQwZDhmNDY1ZWZlZWYwYTI3NjRlMzg4N2ZjYzlkZjQxZGVkMjBmNTA1YyI7CiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSs2NSk7CiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjIpLCBzaWcyLCBhcHBrZXkxX3B1YmtleSk7CgogICAgICAgIGlmIChzaWdvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA3OiB2ZXJpZnkgdGhlIEFQUEtFWTEgcHJvdmVuYW5jZSAobXVzdCBiZSBzaWduZWQgYnkgTGVkZ2VyKQogICAgICAgIGJ5dGVzIG1lbW9yeSBMRURHRVJLRVkgPSBoZXgiN2ZiOTU2NDY5YzVjOWI4OTg0MGQ1NWI0MzUzN2U2NmE5OGRkNDgxMWVhMGEyNzIyNDI3MmMyZTU2MjI5MTFlODUzN2EyZjhlODZhNDZiYWVjODI4NjRlOThkZDAxZTljY2MyZjhiYzVkZmM5Y2JlNWE5MWEyOTA0OThkZDk2ZTQiOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMyA9IG5ldyBieXRlcygxKzY1KTsKICAgICAgICB0b3NpZ24zWzBdID0gMHhGRTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMsIDY1LCB0b3NpZ24zLCAxKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzMgPSBuZXcgYnl0ZXModWludChwcm9vZlszKzY1KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsKCiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjMpLCBzaWczLCBMRURHRVJLRVkpOwoKICAgICAgICByZXR1cm4gc2lnb2s7CiAgICB9CgogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgcmVxdWlyZSgoX3Byb29mWzBdID09ICJMIikgJiYgKF9wcm9vZlsxXSA9PSAiUCIpICYmIChfcHJvb2ZbMl0gPT0gMSkpOwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgcmVxdWlyZShwcm9vZlZlcmlmaWVkKTsKCiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fcmV0dXJuQ29kZShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCl7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHJldHVybiAxOwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHJldHVybiAyOwoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXRjaEJ5dGVzMzJQcmVmaXgoYnl0ZXMzMiBjb250ZW50LCBieXRlcyBwcmVmaXgsIHVpbnQgbl9yYW5kb21fYnl0ZXMpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBtYXRjaF8gPSB0cnVlOwoKCiAgICAgICAgZm9yICh1aW50MjU2IGk9MDsgaTwgbl9yYW5kb21fYnl0ZXM7IGkrKykgewogICAgICAgICAgICBpZiAoY29udGVudFtpXSAhPSBwcmVmaXhbaV0pIG1hdGNoXyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1hdGNoXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihieXRlcyBwcm9vZiwgYnl0ZXMzMiBxdWVyeUlkLCBieXRlcyByZXN1bHQsIHN0cmluZyBjb250ZXh0X25hbWUpIGludGVybmFsIHJldHVybnMgKGJvb2wpewoKICAgICAgICAvLyBTdGVwIDI6IHRoZSB1bmlxdWUga2V5aGFzaCBoYXMgdG8gbWF0Y2ggd2l0aCB0aGUgc2hhMjU2IG9mIChjb250ZXh0IG5hbWUgKyBxdWVyeUlkKQogICAgICAgIHVpbnQgbGVkZ2VyUHJvb2ZMZW5ndGggPSAzKzY1Kyh1aW50KHByb29mWzMrNjUrMV0pKzIpKzMyOwogICAgICAgIGJ5dGVzIG1lbW9yeSBrZXloYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMiwga2V5aGFzaCwgMCk7CiAgICAgICAgaWYgKCEoa2VjY2FrMjU2KGtleWhhc2gpID09IGtlY2NhazI1NihzaGEyNTYoY29udGV4dF9uYW1lLCBxdWVyeUlkKSkpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcxID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbbGVkZ2VyUHJvb2ZMZW5ndGgrKDMyKzgrMSszMikrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrKDMyKzgrMSszMiksIHNpZzEubGVuZ3RoLCBzaWcxLCAwKTsKCiAgICAgICAgLy8gU3RlcCAzOiB3ZSBhc3N1bWUgc2lnMSBpcyB2YWxpZCAoaXQgd2lsbCBiZSB2ZXJpZmllZCBkdXJpbmcgc3RlcCA1KSBhbmQgd2UgdmVyaWZ5IGlmICdyZXN1bHQnIGlzIHRoZSBwcmVmaXggb2Ygc2hhMjU2KHNpZzEpCiAgICAgICAgaWYgKCFtYXRjaEJ5dGVzMzJQcmVmaXgoc2hhMjU2KHNpZzEpLCByZXN1bHQsIHVpbnQocHJvb2ZbbGVkZ2VyUHJvb2ZMZW5ndGgrMzIrOF0pKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBTdGVwIDQ6IGNvbW1pdG1lbnQgbWF0Y2ggdmVyaWZpY2F0aW9uLCBrZWNjYWsyNTYoZGVsYXksIG5ieXRlcywgdW5vbmNlLCBzZXNzaW9uS2V5SGFzaCkgPT0gY29tbWl0bWVudCBpbiBzdG9yYWdlLgogICAgICAgIC8vIFRoaXMgaXMgdG8gdmVyaWZ5IHRoYXQgdGhlIGNvbXB1dGVkIGFyZ3MgbWF0Y2ggd2l0aCB0aGUgb25lcyBzcGVjaWZpZWQgaW4gdGhlIHF1ZXJ5LgogICAgICAgIGJ5dGVzIG1lbW9yeSBjb21taXRtZW50U2xpY2UxID0gbmV3IGJ5dGVzKDgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCszMiwgOCsxKzMyLCBjb21taXRtZW50U2xpY2UxLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIHVpbnQgc2lnMm9mZnNldCA9IGxlZGdlclByb29mTGVuZ3RoKzMyKyg4KzErMzIpK3NpZzEubGVuZ3RoKzY1OwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOwoKICAgICAgICBieXRlczMyIHNlc3Npb25QdWJrZXlIYXNoID0gc2hhMjU2KHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID09IGtlY2NhazI1Nihjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpeyAvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA1OiB2YWxpZGl0eSB2ZXJpZmljYXRpb24gZm9yIHNpZzEgKGtleWhhc2ggYW5kIGFyZ3Mgc2lnbmVkIHdpdGggdGhlIHNlc3Npb25LZXkpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjEgPSBuZXcgYnl0ZXMoMzIrOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMis4KzErMzIsIHRvc2lnbjEsIDApOwogICAgICAgIGlmICghdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gdmVyaWZ5IGlmIHNlc3Npb25QdWJrZXlIYXNoIHdhcyB2ZXJpZmllZCBhbHJlYWR5LCBpZiBub3QuLiBsZXQncyBkbyBpdCEKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID09IGZhbHNlKXsKICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGxlbmd0aCArIHRvT2Zmc2V0OwoKICAgICAgICAvLyBCdWZmZXIgdG9vIHNtYWxsCiAgICAgICAgcmVxdWlyZSh0by5sZW5ndGggPj0gbWluTGVuZ3RoKTsgLy8gU2hvdWxkIGJlIGEgYmV0dGVyIHdheT8KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgdG1wIDo9IG1sb2FkKGFkZChmcm9tLCBpKSkKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgLy8gRHVwbGljYXRlIFNvbGlkaXR5J3MgZWNyZWNvdmVyLCBidXQgY2F0Y2hpbmcgdGhlIENBTEwgcmV0dXJuIHZhbHVlCiAgICBmdW5jdGlvbiBzYWZlcl9lY3JlY292ZXIoYnl0ZXMzMiBoYXNoLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgewogICAgICAgIC8vIFdlIGRvIG91ciBvd24gbWVtb3J5IG1hbmFnZW1lbnQgaGVyZS4gU29saWRpdHkgdXNlcyBtZW1vcnkgb2Zmc2V0CiAgICAgICAgLy8gMHg0MCB0byBzdG9yZSB0aGUgY3VycmVudCBlbmQgb2YgbWVtb3J5LiBXZSB3cml0ZSBwYXN0IGl0IChhcwogICAgICAgIC8vIHdyaXRlcyBhcmUgbWVtb3J5IGV4dGVuc2lvbnMpLCBidXQgZG9uJ3QgdXBkYXRlIHRoZSBvZmZzZXQgc28KICAgICAgICAvLyBTb2xpZGl0eSB3aWxsIHJldXNlIGl0LiBUaGUgbWVtb3J5IHVzZWQgaGVyZSBpcyBvbmx5IG5lZWRlZCBmb3IKICAgICAgICAvLyB0aGlzIGNvbnRleHQuCgogICAgICAgIC8vIEZJWE1FOiBpbmxpbmUgYXNzZW1ibHkgY2FuJ3QgYWNjZXNzIHJldHVybiB2YWx1ZXMKICAgICAgICBib29sIHJldDsKICAgICAgICBhZGRyZXNzIGFkZHI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNpemUgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKHNpemUsIGhhc2gpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgMzIpLCB2KQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDY0KSwgcikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA5NiksIHMpCgogICAgICAgICAgICAvLyBOT1RFOiB3ZSBjYW4gcmV1c2UgdGhlIHJlcXVlc3QgbWVtb3J5IGJlY2F1c2Ugd2UgZGVhbCB3aXRoCiAgICAgICAgICAgIC8vICAgICAgIHRoZSByZXR1cm4gY29kZQogICAgICAgICAgICByZXQgOj0gY2FsbCgzMDAwLCAxLCAwLCBzaXplLCAxMjgsIHNpemUsIDMyKQogICAgICAgICAgICBhZGRyIDo9IG1sb2FkKHNpemUpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CgogICAgICAgIC8vIFRoZSBzaWduYXR1cmUgZm9ybWF0IGlzIGEgY29tcGFjdCBmb3JtIG9mOgogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQogICAgICAgIC8vIENvbXBhY3QgbWVhbnMsIHVpbnQ4IGlzIG5vdCBwYWRkZWQgdG8gMzIgYnl0ZXMuCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCgogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQKICAgICAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQoKICAgICAgICAgICAgLy8gQWx0ZXJuYXRpdmUgc29sdXRpb246CiAgICAgICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cwogICAgICAgICAgICAvLyB1c2UgdGhlIHNlY29uZCBiZXN0IG9wdGlvbiwgJ2FuZCcKICAgICAgICAgICAgLy8gdiA6PSBhbmQobWxvYWQoYWRkKHNpZywgNjUpKSwgMjU1KQogICAgICAgIH0KCiAgICAgICAgLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0CiAgICAgICAgLy8gdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdCiAgICAgICAgLy8KICAgICAgICAvLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzCiAgICAgICAgaWYgKHYgPCAyNykKICAgICAgICAgIHYgKz0gMjc7CgogICAgICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICByZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwogICAgfQoKfQoKY29udHJhY3QgR2FtZSBpcyBPd25hYmxlLCB1c2luZ09yYWNsaXplIHsKICBmdW5jdGlvbiBpbnQyc3RyKGludCB4KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgaWYgKHggPCAwKSB7CiAgICAgIHJldHVybiBzdHJDb25jYXQoIi0iLAogICAgICAgIHVpbnQyc3RyKHVpbnQoeCAqIC0xKSksICIiLCAiIiwgIiIpOwogICAgfQogICAgcmV0dXJuIHVpbnQyc3RyKHVpbnQoeCkpOwogIH0KCiAgZnVuY3Rpb24gY29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQpIHsKICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOwogICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsKICAgIC8vQHRvZG8gdW5yb2xsIHRoZSBsb29wIGludG8gaW5jcmVtZW50cyBvZiAzMiBhbmQgZG8gZnVsbCAzMiBieXRlIGNvbXBhcmlzb25zCiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkgKyspCiAgICAgIGlmIChhW2ldIDwgYltpXSkKICAgICAgICByZXR1cm4gLTE7CiAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgIHJldHVybiAxOwogICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgIHJldHVybiAtMTsKICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpCiAgICAgIHJldHVybiAxOwogICAgZWxzZQogICAgICByZXR1cm4gMDsKICB9CgogIC8vLyBAZGV2IENvbXBhcmVzIHR3byBzdHJpbmdzIGFuZCByZXR1cm5zIHRydWUgaWZmIHRoZXkgYXJlIGVxdWFsLgogIGZ1bmN0aW9uIGVxdWFsKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmV0dXJuIGNvbXBhcmUoX2EsIF9iKSA9PSAwOwogIH0KCiAgZnVuY3Rpb24gKCkgcGF5YWJsZSBwdWJsaWMgeyB9Cn0KCmNvbnRyYWN0IEZpbml0ZVN0YXRlR2FtZSBpcyBHYW1lIHsKICBlbnVtIEdhbWVTdGF0ZSB7CiAgICAgIE5ldywgICAgIC8vIDAgRGVmYXVsdCBnYW1lIHN0YXRlIGZvciBuZXcgZ2FtZSwgYmV0cyBjYW5ub3QgYmUgcGxhY2VkIHNpbmNlIHRoZXJlIGlzIG5vIG1vbmV5bGluZQogICAgICBPcGVuLCAgICAvLyAxIEJldHRpbmcgaXMgb3BlbgogICAgICBDbG9zZWQsICAvLyAyIEJldHRpbmcgaXMgY2xvc2VkIHNpbmNlIHRoZSBldmVudCBpcyBhYm91dCB0byB0YWtlIHBsYWNlCiAgICAgIE92ZXIsICAgIC8vIDMgQ29tcGV0aXRpb24gaXMgb3ZlcgogICAgICBDb21wbGV0ZSAvLyA0IEV2ZXJ5b25lIGlzIHBhaWQKICB9CgogIEdhbWVTdGF0ZSBpbnRlcm5hbCBnYW1lU3RhdGUgPSBHYW1lU3RhdGUuTmV3OwoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IG90aGVyIGFkZHJlc3MgdGhhbiBPcmFjbGl6ZS4KICAgKi8KICBtb2RpZmllciBvbmx5T3JhY2xpemUgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG9yYWNsaXplX2NiQWRkcmVzcygpKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgaW4gYW55IHN0YXRlIG90aGVyIHRoYW4gcmVxdWlyZWRTdGF0ZS4KICAgKi8KICBtb2RpZmllciBvbmx5U3RhdGUoR2FtZVN0YXRlIHJlcXVpcmVkU3RhdGUpIHsKICAgIHJlcXVpcmUgKGdhbWVTdGF0ZSA9PSByZXF1aXJlZFN0YXRlKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgaW4gYW55IHN0YXRlIG90aGVyIHRoYW4gcmVxdWlyZWRTdGF0ZS4KICAgKi8KICBtb2RpZmllciBiZWZvcmVTdGF0ZShHYW1lU3RhdGUgcmVxdWlyZWRTdGF0ZSkgewogICAgcmVxdWlyZSAoZ2FtZVN0YXRlIDwgcmVxdWlyZWRTdGF0ZSk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGluIGFueSBzdGF0ZSBvdGhlciB0aGFuIHJlcXVpcmVkU3RhdGUuCiAgICovCiAgbW9kaWZpZXIgYWZ0ZXJTdGF0ZShHYW1lU3RhdGUgcmVxdWlyZWRTdGF0ZSkgewogICAgcmVxdWlyZSAoZ2FtZVN0YXRlID4gcmVxdWlyZWRTdGF0ZSk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgYWR2YW5jZVN0YXRlKCkgewogICAgXzsKICAgIGFkdmFuY2VHYW1lU3RhdGUoKTsKICB9CgogIGZ1bmN0aW9uIGFkdmFuY2VHYW1lU3RhdGUoKSBpbnRlcm5hbCB7CiAgICBnYW1lU3RhdGUgPSBHYW1lU3RhdGUodWludChnYW1lU3RhdGUpICsgMSk7CiAgfQoKICAvKioKICAgKiBAZGV2IERlc3Ryb3kgY3VycmVudCBnYW1lLgogICAqLwogIGZ1bmN0aW9uIGRlc3Ryb3koKSBvbmx5T3duZXIgb25seVN0YXRlKEdhbWVTdGF0ZS5Db21wbGV0ZSkgcHVibGljIHsKICAgIHNlbGZkZXN0cnVjdChvd25lcik7CiAgfQp9Cgpjb250cmFjdCBUZWFtR2FtZSBpcyBGaW5pdGVTdGF0ZUdhbWUgewogIGV2ZW50IExvZ01vbmV5bGluZSgKICAgIGludCBob21lLAogICAgaW50IGF3YXkKICApOwoKICBldmVudCBMb2dDbG9zZWQoKTsKCiAgZXZlbnQgTG9nR2FtZSgKICAgIHN0cmluZyBob21lLAogICAgc3RyaW5nIGF3YXksCiAgICBzdHJpbmcgZGF0ZSwKICAgIHN0cmluZyBxdWVyeQogICk7CgogIGV2ZW50IExvZ1dpbm5lcigKICAgIHN0cmluZyB3aW5uZXIKICApOwoKICBzdHJ1Y3QgTW9uZXlsaW5lIHsKICAgIGludCBob21lOwogICAgaW50IGF3YXk7CiAgfQoKCiAgc3RydWN0IEJldCB7CiAgICBhZGRyZXNzIHNlbmRlcjsKICAgIHVpbnQgYW1vdW50OwogICAgaW50IG9kZHM7CiAgfQoKICBzdHJpbmcgRGF0ZTsKICBzdHJpbmcgSG9tZTsKICBzdHJpbmcgQXdheTsKICBzdHJpbmcgUXVlcnk7CiAgc3RyaW5nIFJlc3VsdDsKCiAgTW9uZXlsaW5lIEN1cnJlbnRNb25leWxpbmU7CiAgQmV0W10gYmV0c0hvbWU7CiAgQmV0W10gYmV0c0F3YXk7CiAgdWludCBwYXlvdXRIb21lOwogIHVpbnQgcGF5b3V0QXdheTsKCiAgdWludCBtaW5CZXQgPSAxMCBmaW5uZXk7CiAgdWludCBtYXhCZXRGaXhlZCA9IDUgZXRoZXI7CgogIG1vZGlmaWVyIG9ubHlMZXNzT3JFcXVhbE1heGltdW1CZXRIb21lKCkgewogICAgaWYgKG1zZy52YWx1ZSA+IGdldE1heGltdW1CZXRIb21lKCkpIHsKICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seUxlc3NPckVxdWFsTWF4aW11bUJldEF3YXkoKSB7CiAgICBpZiAobXNnLnZhbHVlID4gZ2V0TWF4aW11bUJldEF3YXkoKSkgewogICAgICByZXZlcnQoKTsKICAgIH0KICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5R3JlYXRlck9yRXF1YWxNaW5pbXVtQmV0KCkgewogICAgaWYgKG1zZy52YWx1ZSA8IGdldE1pbmltdW1CZXQoKSkgewogICAgICByZXZlcnQoKTsKICAgIH0KICAgIF87CiAgfQoKICBmdW5jdGlvbiBnZXRNaW5pbXVtQmV0KCkgcHVibGljIHZpZXcgYWZ0ZXJTdGF0ZShHYW1lU3RhdGUuTmV3KSBiZWZvcmVTdGF0ZShHYW1lU3RhdGUuQ2xvc2VkKSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gbWluQmV0OwogIH0KCiAgZnVuY3Rpb24gY2FsY3VsYXRlTWF4QmV0KHVpbnQgcG90LCBpbnQgb2RkcykgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IG1heEJldCA9IDA7CiAgICBpZiAob2RkcyA8IDApIHsKICAgICAgbWF4QmV0ID0gIHBvdCAqIHVpbnQob2RkcyotMSkgLyAxMDA7CiAgICB9IGVsc2UgaWYgKG9kZHMgPiAwKSB7CiAgICAgIG1heEJldCA9IHBvdCAqIDEwMCAvIHVpbnQob2Rkcyk7CiAgICB9CiAgICByZXR1cm4gKG1heEJldEZpeGVkIDwgbWF4QmV0KSA/IG1heEJldEZpeGVkIDogbWF4QmV0OwogIH0KCiAgZnVuY3Rpb24gZ2V0TWF4aW11bUJldEhvbWUoKSBwdWJsaWMgdmlldyBhZnRlclN0YXRlKEdhbWVTdGF0ZS5OZXcpIGJlZm9yZVN0YXRlKEdhbWVTdGF0ZS5DbG9zZWQpIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBjYWxjdWxhdGVNYXhCZXQodGhpcy5iYWxhbmNlIC0gcGF5b3V0SG9tZSwgQ3VycmVudE1vbmV5bGluZS5ob21lKTsKICB9CgogIGZ1bmN0aW9uIGdldE1heGltdW1CZXRBd2F5KCkgcHVibGljIHZpZXcgYWZ0ZXJTdGF0ZShHYW1lU3RhdGUuTmV3KSBiZWZvcmVTdGF0ZShHYW1lU3RhdGUuQ2xvc2VkKSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gY2FsY3VsYXRlTWF4QmV0KHRoaXMuYmFsYW5jZSAtIHBheW91dEF3YXksIEN1cnJlbnRNb25leWxpbmUuYXdheSk7CiAgfQoKICBmdW5jdGlvbiBnZXRNb25leWxpbmUoKSBwdWJsaWMgYWZ0ZXJTdGF0ZShHYW1lU3RhdGUuTmV3KSB2aWV3IHJldHVybnMgKGludCwgaW50KSB7CiAgICByZXR1cm4gKEN1cnJlbnRNb25leWxpbmUuaG9tZSwgQ3VycmVudE1vbmV5bGluZS5hd2F5KTsKICB9CgogIGZ1bmN0aW9uIHNldE1vbmV5bGluZShpbnQgaG9tZSwgaW50IGF3YXkpIHB1YmxpYyBiZWZvcmVTdGF0ZShHYW1lU3RhdGUuQ2xvc2VkKSBvbmx5T3duZXIgewogICAgQ3VycmVudE1vbmV5bGluZSA9IE1vbmV5bGluZSh7CiAgICAgIGhvbWU6IGhvbWUsCiAgICAgIGF3YXk6IGF3YXkKICAgIH0pOwoKICAgIGlmIChnYW1lU3RhdGUgPT0gR2FtZVN0YXRlLk5ldykgewogICAgICBMb2dHYW1lKHsKICAgICAgICBob21lOiBIb21lLAogICAgICAgIGF3YXk6IEF3YXksCiAgICAgICAgZGF0ZTogRGF0ZSwKICAgICAgICBxdWVyeTogUXVlcnkKICAgICAgfSk7CiAgICB9CgogICAgTG9nTW9uZXlsaW5lKHsKICAgICAgaG9tZTogaG9tZSwKICAgICAgYXdheTogYXdheQogICAgfSk7CgogICAgaWYgKGdhbWVTdGF0ZSA9PSBHYW1lU3RhdGUuTmV3KSB7CiAgICAgIGFkdmFuY2VHYW1lU3RhdGUoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXQoc3RyaW5nIGRhdGUsIHN0cmluZyBob21lLCBzdHJpbmcgYXdheSwgc3RyaW5nIHF1ZXJ5KSBwdWJsaWMgb25seU93bmVyIG9ubHlTdGF0ZShHYW1lU3RhdGUuTmV3KSB7CiAgICBEYXRlID0gZGF0ZTsKICAgIEhvbWUgPSBob21lOwogICAgQXdheSA9IGF3YXk7CiAgICBRdWVyeSA9IHF1ZXJ5OwogIH0KCiAgZnVuY3Rpb24gc2V0T0FSKGFkZHJlc3Mgb2FyKSBwdWJsaWMgb25seU93bmVyIG9ubHlTdGF0ZShHYW1lU3RhdGUuTmV3KSB7CiAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkob2FyKTsKICB9CgogIGZ1bmN0aW9uIHBheW91dChCZXRbXSBzdG9yYWdlIGJldHNXaW4pIGludGVybmFsIG9ubHlPd25lciBvbmx5U3RhdGUoR2FtZVN0YXRlLk92ZXIpIHsKICAgIC8vIFNlbmQgd2lubmVycyB0aGVpciB3aW5uaW5ncwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYmV0c1dpbi5sZW5ndGg7IGkrKykgewogICAgICB1aW50IHRoaXNQYXlvdXQgPSBjYWxjdWxhdGVQYXlvdXQoYmV0c1dpbltpXS5hbW91bnQsIGJldHNXaW5baV0ub2Rkcyk7CiAgICAgIGlmICh0aGlzUGF5b3V0ID4gMCkgewogICAgICAgIC8vIEF2b2lkIHJldHJhbmN5IGF0dGFja3MhCiAgICAgICAgYmV0c1dpbltpXS5hbW91bnQgPSAwOwogICAgICAgIGJldHNXaW5baV0uc2VuZGVyLnRyYW5zZmVyKHRoaXNQYXlvdXQpOwogICAgICB9CiAgICB9CiAgICBhZHZhbmNlR2FtZVN0YXRlKCk7CiAgfQoKICBmdW5jdGlvbiBwbGF5QXdheSgpIHBheWFibGUgcHVibGljIG9ubHlTdGF0ZShHYW1lU3RhdGUuT3Blbikgb25seUdyZWF0ZXJPckVxdWFsTWluaW11bUJldCBvbmx5TGVzc09yRXF1YWxNYXhpbXVtQmV0QXdheSB7CiAgICBiZXRzQXdheS5wdXNoKEJldCh7CiAgICAgIHNlbmRlcjogbXNnLnNlbmRlciwKICAgICAgYW1vdW50OiBtc2cudmFsdWUsCiAgICAgIG9kZHM6IEN1cnJlbnRNb25leWxpbmUuYXdheQogICAgfSkpOwoKICAgIHBheW91dEF3YXkgKz0gY2FsY3VsYXRlUGF5b3V0KG1zZy52YWx1ZSwgQ3VycmVudE1vbmV5bGluZS5hd2F5KTsKICB9CgogIGZ1bmN0aW9uIHBsYXlIb21lKCkgcGF5YWJsZSBwdWJsaWMgb25seVN0YXRlKEdhbWVTdGF0ZS5PcGVuKSBvbmx5R3JlYXRlck9yRXF1YWxNaW5pbXVtQmV0IG9ubHlMZXNzT3JFcXVhbE1heGltdW1CZXRIb21lIHsKICAgIGJldHNIb21lLnB1c2goQmV0KHsKICAgICAgc2VuZGVyOiBtc2cuc2VuZGVyLAogICAgICBhbW91bnQ6IG1zZy52YWx1ZSwKICAgICAgb2RkczogQ3VycmVudE1vbmV5bGluZS5ob21lCiAgICB9KSk7CgogICAgcGF5b3V0SG9tZSArPSBjYWxjdWxhdGVQYXlvdXQobXNnLnZhbHVlLCBDdXJyZW50TW9uZXlsaW5lLmhvbWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBSZXR1cm5zIGN1cnJlbnQgZ2FtZSBtZXRyaWNzLgogICAqLwogIGZ1bmN0aW9uIGdldE1ldHJpY3MoKSBwdWJsaWMgdmlldyBvbmx5T3duZXIgcmV0dXJucyAoR2FtZVN0YXRlLCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50KSB7CiAgICB1aW50IGJldEhvbWU7CiAgICB1aW50IGJldEF3YXk7CgogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYmV0c0hvbWUubGVuZ3RoOyBpKyspIHsKICAgICAgYmV0SG9tZSArPSBiZXRzSG9tZVtpXS5hbW91bnQ7CiAgICB9CiAgICBmb3IgKGkgPSAwOyBpIDwgYmV0c0F3YXkubGVuZ3RoOyBpKyspIHsKICAgICAgYmV0QXdheSArPSBiZXRzQXdheVtpXS5hbW91bnQ7CiAgICB9CiAgICByZXR1cm4gKGdhbWVTdGF0ZSwgYmV0c0hvbWUubGVuZ3RoLCBiZXRzQXdheS5sZW5ndGgsIGJldEhvbWUsIGJldEF3YXksIHBheW91dEhvbWUsIHBheW91dEF3YXkpOwogIH0KCiAgZnVuY3Rpb24gY2FsY3VsYXRlUGF5b3V0KHVpbnQgYW1vdW50LCBpbnQgb2RkcykgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgaWYgKGFtb3VudCA+IDAgJiYgb2RkcyA+IDApIHsKICAgICAgcmV0dXJuIChhbW91bnQgKiB1aW50KG9kZHMpKSAvIDEwMCArIGFtb3VudDsKICAgIH0gZWxzZSBpZiAoYW1vdW50ID4gMCAmJiBvZGRzIDwgMCkgewogICAgICByZXR1cm4gKGFtb3VudCAqIDEwMCkgLyB1aW50KG9kZHMqLTEpICsgYW1vdW50OwogICAgfQogICAgcmV0dXJuIDA7CiAgfQoKICBmdW5jdGlvbiBjbG9zZUdhbWUoKSBwdWJsaWMgb25seU93bmVyIG9ubHlTdGF0ZShHYW1lU3RhdGUuT3BlbikgewogICAgTG9nQ2xvc2VkKCk7CgogICAgYWR2YW5jZUdhbWVTdGF0ZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBFbWVyZ2VuY3kgcmVmdW5kIGFsbCBiZXRzIGFuZCByZWZ1bmQgb3duZXIgc2VlZCBhbW91bnQuCiAgICovCiAgZnVuY3Rpb24gZW1lcmdlbmN5UmVmdW5kKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBiZXRzSG9tZS5sZW5ndGg7IGkrKykgewogICAgICBiZXRzSG9tZVtpXS5hbW91bnQgPSAwOwogICAgICBiZXRzSG9tZVtpXS5zZW5kZXIudHJhbnNmZXIoYmV0c0hvbWVbaV0uYW1vdW50KTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBiZXRzQXdheS5sZW5ndGg7IGkrKykgewogICAgICBiZXRzQXdheVtpXS5hbW91bnQgPSAwOwogICAgICBiZXRzQXdheVtpXS5zZW5kZXIudHJhbnNmZXIoYmV0c0F3YXlbaV0uYW1vdW50KTsKICAgIH0KCiAgICBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogIH0KfQoKY29udHJhY3QgRm9vdGJhbGwgaXMgVGVhbUdhbWUgewogIGZ1bmN0aW9uIGdhbWVPdmVyKCkgcHVibGljIG9ubHlPd25lciBvbmx5U3RhdGUoR2FtZVN0YXRlLkNsb3NlZCkgewogICAgb3JhY2xpemVfcXVlcnkoIldvbGZyYW1BbHBoYSIsIFF1ZXJ5KTsKICB9CgogIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiwgc3RyaW5nIHJlc3VsdCkgb25seVN0YXRlKEdhbWVTdGF0ZS5DbG9zZWQpIG9ubHlPcmFjbGl6ZSBwdWJsaWMgewogICAgaWYgKGVxdWFsKEhvbWUsIHJlc3VsdCkgfHwgZXF1YWwoQXdheSwgcmVzdWx0KSkgewogICAgICBSZXN1bHQgPSByZXN1bHQ7CiAgICAgIGFkdmFuY2VHYW1lU3RhdGUoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGZpbmlzaEdhbWUoKSBwdWJsaWMgb25seU93bmVyIG9ubHlTdGF0ZShHYW1lU3RhdGUuT3ZlcikgewogICAgaWYgKGVxdWFsKEhvbWUsIFJlc3VsdCkpIHsKICAgICAgcGF5b3V0KGJldHNIb21lKTsKICAgIH0gZWxzZSB7CiAgICAgIHBheW91dChiZXRzQXdheSk7CiAgICB9CiAgICBMb2dXaW5uZXIoUmVzdWx0KTsKICB9Cn0='.
	

]
