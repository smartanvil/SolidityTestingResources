Class {
	#name : #SRTec8e410316bd8d45cf660fdfd1fbd9eeafe9ed6c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTec8e410316bd8d45cf660fdfd1fbd9eeafe9ed6c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLy8vIEB0aXRsZSBJbnRlcmZhY2UgZm9yIGNvbnRyYWN0cyBjb25mb3JtaW5nIHRvIEVSQy03MjE6IE5vbi1GdW5naWJsZSBUb2tlbnMKLy8vIEBhdXRob3IgRGlldGVyIFNoaXJsZXkgPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMGY2YjZhN2I2YTRmNmU3NzY2NjA2Mjc1NmE2MTIxNmM2MCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+IChodHRwczovL2dpdGh1Yi5jb20vZGV0ZSkKY29udHJhY3QgRVJDNzIxIHsKICAgIC8vIFJlcXVpcmVkIG1ldGhvZHMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSB0b2tlbklkcyk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogICAgLy8gRVJDLTE2NSBDb21wYXRpYmlsaXR5IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgICAqIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgfQogICAgfQoKfQoKCgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICAgIGV2ZW50IFBhdXNlKCk7CiAgICBldmVudCBVbnBhdXNlKCk7CgogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAgICovCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgICovCiAgICBmdW5jdGlvbiBwYXVzZSgpIHB1YmxpYyBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBQYXVzZSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICAgIFVucGF1c2UoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKCgoKCgovLy8gQHRpdGxlIEF1Y3Rpb24gQ29yZQovLy8gQGRldiBDb250YWlucyBtb2RlbHMsIHZhcmlhYmxlcywgYW5kIGludGVybmFsIG1ldGhvZHMgZm9yIHRoZSBhdWN0aW9uLgovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IENsb2NrQXVjdGlvbkJhc2UgewoKICAgIC8vIFJlcHJlc2VudHMgYW4gYXVjdGlvbiBvbiBhbiBORlQKICAgIHN0cnVjdCBBdWN0aW9uIHsKICAgICAgICAvLyBDdXJyZW50IG93bmVyIG9mIE5GVAogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uCiAgICAgICAgdWludDEyOCBzdGFydGluZ1ByaWNlOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uCiAgICAgICAgdWludDEyOCBlbmRpbmdQcmljZTsKICAgICAgICAvLyBEdXJhdGlvbiAoaW4gc2Vjb25kcykgb2YgYXVjdGlvbgogICAgICAgIHVpbnQ2NCBkdXJhdGlvbjsKICAgICAgICAvLyBUaW1lIHdoZW4gYXVjdGlvbiBzdGFydGVkCiAgICAgICAgLy8gTk9URTogMCBpZiB0aGlzIGF1Y3Rpb24gaGFzIGJlZW4gY29uY2x1ZGVkCiAgICAgICAgdWludDY0IHN0YXJ0ZWRBdDsKICAgIH0KCiAgICAvLyBSZWZlcmVuY2UgdG8gY29udHJhY3QgdHJhY2tpbmcgTkZUIG93bmVyc2hpcAogICAgRVJDNzIxIHB1YmxpYyBub25GdW5naWJsZUNvbnRyYWN0OwoKICAgIC8vIEN1dCBvd25lciB0YWtlcyBvbiBlYWNoIGF1Y3Rpb24sIG1lYXN1cmVkIGluIGJhc2lzIHBvaW50cyAoMS8xMDAgb2YgYSBwZXJjZW50KS4KICAgIC8vIFZhbHVlcyAwLTEwLDAwMCBtYXAgdG8gMCUtMTAwJQogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQ7CgogICAgLy8gTWFwIGZyb20gdG9rZW4gSUQgdG8gdGhlaXIgY29ycmVzcG9uZGluZyBhdWN0aW9uLgogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSB0b2tlbklkVG9BdWN0aW9uOwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBzdGFydGluZ1ByaWNlLCB1aW50MjU2IGVuZGluZ1ByaWNlLCB1aW50MjU2IGR1cmF0aW9uKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiB0b3RhbFByaWNlLCBhZGRyZXNzIHdpbm5lcik7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBjbGFpbWFudCBvd25zIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IC0gQWRkcmVzcyBjbGFpbWluZyB0byBvd24gdGhlIHRva2VuLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHdob3NlIG93bmVyc2hpcCB0byB2ZXJpZnkuCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChub25GdW5naWJsZUNvbnRyYWN0Lm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRXNjcm93cyB0aGUgTkZULCBhc3NpZ25pbmcgb3duZXJzaGlwIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gVGhyb3dzIGlmIHRoZSBlc2Nyb3cgZmFpbHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciAtIEN1cnJlbnQgb3duZXIgYWRkcmVzcyBvZiB0b2tlbiB0byBlc2Nyb3cuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gd2hvc2UgYXBwcm92YWwgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0LnRyYW5zZmVyRnJvbShfb3duZXIsIHRoaXMsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgYW4gTkZUIG93bmVkIGJ5IHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciBhZGRyZXNzLgogICAgLy8vIFJldHVybnMgdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgc3VjY2VlZHMuCiAgICAvLy8gQHBhcmFtIF9yZWNlaXZlciAtIEFkZHJlc3MgdG8gdHJhbnNmZXIgTkZUIHRvLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhbiBhdWN0aW9uIHRvIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuIEFsc28gZmlyZXMgdGhlCiAgICAvLy8gIEF1Y3Rpb25DcmVhdGVkIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHB1dCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiBBdWN0aW9uIHRvIGFkZC4KICAgIGZ1bmN0aW9uIF9hZGRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgYWxsIGF1Y3Rpb25zIGhhdmUgYSBkdXJhdGlvbiBvZgogICAgICAgIC8vIGF0IGxlYXN0IG9uZSBtaW51dGUuIChLZWVwcyBvdXIgbWF0aCBmcm9tIGdldHRpbmcgaGFpcnkhKQogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKCiAgICAgICAgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0gPSBfYXVjdGlvbjsKCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQoCiAgICAgICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5kdXJhdGlvbikKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB1bmNvbmRpdGlvbmFsbHkuCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgcHJpY2UgYW5kIHRyYW5zZmVycyB3aW5uaW5ncy4KICAgIC8vLyBEb2VzIE5PVCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgdG9rZW4uCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgIGludGVybmFsCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIEdldCBhIHJlZmVyZW5jZSB0byB0aGUgYXVjdGlvbiBzdHJ1Y3QKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwoKICAgICAgICAvLyBFeHBsaWNpdGx5IGNoZWNrIHRoYXQgdGhpcyBhdWN0aW9uIGlzIGN1cnJlbnRseSBsaXZlLgogICAgICAgIC8vIChCZWNhdXNlIG9mIGhvdyBFdGhlcmV1bSBtYXBwaW5ncyB3b3JrLCB3ZSBjYW4ndCBqdXN0IGNvdW50CiAgICAgICAgLy8gb24gdGhlIGxvb2t1cCBhYm92ZSBmYWlsaW5nLiBBbiBpbnZhbGlkIF90b2tlbklkIHdpbGwganVzdAogICAgICAgIC8vIHJldHVybiBhbiBhdWN0aW9uIG9iamVjdCB0aGF0IGlzIGFsbCB6ZXJvcy4pCiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBiaWQgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoZSBjdXJyZW50IHByaWNlCiAgICAgICAgdWludDI1NiBwcmljZSA9IF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHByaWNlKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgc2VsbGVyIGJlZm9yZSB0aGUgYXVjdGlvbiBzdHJ1Y3QKICAgICAgICAvLyBnZXRzIGRlbGV0ZWQuCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKCiAgICAgICAgLy8gVGhlIGJpZCBpcyBnb29kISBSZW1vdmUgdGhlIGF1Y3Rpb24gYmVmb3JlIHNlbmRpbmcgdGhlIGZlZXMKICAgICAgICAvLyB0byB0aGUgc2VuZGVyIHNvIHdlIGNhbid0IGhhdmUgYSByZWVudHJhbmN5IGF0dGFjay4KICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CgogICAgICAgIC8vIFRyYW5zZmVyIHByb2NlZWRzIHRvIHNlbGxlciAoaWYgdGhlcmUgYXJlIGFueSEpCiAgICAgICAgaWYgKHByaWNlID4gMCkgewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGF1Y3Rpb25lZXIncyBjdXQuCiAgICAgICAgICAgIC8vIChOT1RFOiBfY29tcHV0ZUN1dCgpIGlzIGd1YXJhbnRlZWQgdG8gcmV0dXJuIGEKICAgICAgICAgICAgLy8gdmFsdWUgPD0gcHJpY2UsIHNvIHRoaXMgc3VidHJhY3Rpb24gY2FuJ3QgZ28gbmVnYXRpdmUuKQogICAgICAgICAgICB1aW50MjU2IGF1Y3Rpb25lZXJDdXQgPSBfY29tcHV0ZUN1dChwcmljZSk7CiAgICAgICAgICAgIHVpbnQyNTYgc2VsbGVyUHJvY2VlZHMgPSBwcmljZSAtIGF1Y3Rpb25lZXJDdXQ7CgogICAgICAgICAgICAvLyBOT1RFOiBEb2luZyBhIHRyYW5zZmVyKCkgaW4gdGhlIG1pZGRsZSBvZiBhIGNvbXBsZXgKICAgICAgICAgICAgLy8gbWV0aG9kIGxpa2UgdGhpcyBpcyBnZW5lcmFsbHkgZGlzY291cmFnZWQgYmVjYXVzZSBvZgogICAgICAgICAgICAvLyByZWVudHJhbmN5IGF0dGFja3MgYW5kIERvUyBhdHRhY2tzIGlmIHRoZSBzZWxsZXIgaXMKICAgICAgICAgICAgLy8gYSBjb250cmFjdCB3aXRoIGFuIGludmFsaWQgZmFsbGJhY2sgZnVuY3Rpb24uIFdlIGV4cGxpY2l0bHkKICAgICAgICAgICAgLy8gZ3VhcmQgYWdhaW5zdCByZWVudHJhbmN5IGF0dGFja3MgYnkgcmVtb3ZpbmcgdGhlIGF1Y3Rpb24KICAgICAgICAgICAgLy8gYmVmb3JlIGNhbGxpbmcgdHJhbnNmZXIoKSwgYW5kIHRoZSBvbmx5IHRoaW5nIHRoZSBzZWxsZXIKICAgICAgICAgICAgLy8gY2FuIERvUyBpcyB0aGUgc2FsZSBvZiB0aGVpciBvd24gYXNzZXQhIChBbmQgaWYgaXQncyBhbgogICAgICAgICAgICAvLyBhY2NpZGVudCwgdGhleSBjYW4gY2FsbCBjYW5jZWxBdWN0aW9uKCkuICkKICAgICAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlclByb2NlZWRzKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbnkgZXhjZXNzIGZ1bmRzIGluY2x1ZGVkIHdpdGggdGhlIGJpZC4gSWYgdGhlIGV4Y2VzcwogICAgICAgIC8vIGlzIGFueXRoaW5nIHdvcnRoIHdvcnJ5aW5nIGFib3V0LCB0cmFuc2ZlciBpdCBiYWNrIHRvIGJpZGRlci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIGJpZCBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAgICAgLy8gZXF1YWwgdG8gdGhlIHByaWNlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSBwcmljZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgdHJhbnNmZXIsIHRoaXMgaXMKICAgICAgICAvLyBub3Qgc3VzY2VwdGlibGUgdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSB0aGUgYXVjdGlvbiBpcwogICAgICAgIC8vIHJlbW92ZWQgYmVmb3JlIGFueSB0cmFuc2ZlcnMgb2NjdXIuCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwoKICAgICAgICAvLyBUZWxsIHRoZSB3b3JsZCEKICAgICAgICBBdWN0aW9uU3VjY2Vzc2Z1bChfdG9rZW5JZCwgcHJpY2UsIG1zZy5zZW5kZXIpOwoKICAgICAgICByZXR1cm4gcHJpY2U7CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlcyBhbiBhdWN0aW9uIGZyb20gdGhlIGxpc3Qgb2Ygb3BlbiBhdWN0aW9ucy4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiBORlQgb24gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICBkZWxldGUgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBORlQgaXMgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2F1Y3Rpb24gLSBBdWN0aW9uIHRvIGNoZWNrLgogICAgZnVuY3Rpb24gX2lzT25BdWN0aW9uKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChfYXVjdGlvbi5zdGFydGVkQXQgPiAwKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGN1cnJlbnQgcHJpY2Ugb2YgYW4gTkZUIG9uIGF1Y3Rpb24uIEJyb2tlbiBpbnRvIHR3bwogICAgLy8vICBmdW5jdGlvbnMgKHRoaXMgb25lLCB0aGF0IGNvbXB1dGVzIHRoZSBkdXJhdGlvbiBmcm9tIHRoZSBhdWN0aW9uCiAgICAvLy8gIHN0cnVjdHVyZSwgYW5kIHRoZSBvdGhlciB0aGF0IGRvZXMgdGhlIHByaWNlIGNvbXB1dGF0aW9uKSBzbyB3ZQogICAgLy8vICBjYW4gZWFzaWx5IHRlc3QgdGhhdCB0aGUgcHJpY2UgY29tcHV0YXRpb24gd29ya3MgY29ycmVjdGx5LgogICAgZnVuY3Rpb24gX2N1cnJlbnRQcmljZShBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pCiAgICBpbnRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IHNlY29uZHNQYXNzZWQgPSAwOwoKICAgICAgICAvLyBBIGJpdCBvZiBpbnN1cmFuY2UgYWdhaW5zdCBuZWdhdGl2ZSB2YWx1ZXMgKG9yIHdyYXBhcm91bmQpLgogICAgICAgIC8vIFByb2JhYmx5IG5vdCBuZWNlc3NhcnkgKHNpbmNlIEV0aGVyZXVtIGd1YXJuYXRlZXMgdGhhdCB0aGUKICAgICAgICAvLyBub3cgdmFyaWFibGUgZG9lc24ndCBldmVyIGdvIGJhY2t3YXJkcykuCiAgICAgICAgaWYgKG5vdyA+IF9hdWN0aW9uLnN0YXJ0ZWRBdCkgewogICAgICAgICAgICBzZWNvbmRzUGFzc2VkID0gbm93IC0gX2F1Y3Rpb24uc3RhcnRlZEF0OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF9jb21wdXRlQ3VycmVudFByaWNlKAogICAgICAgICAgICBfYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5lbmRpbmdQcmljZSwKICAgICAgICAgICAgX2F1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgICAgIHNlY29uZHNQYXNzZWQKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBjdXJyZW50IHByaWNlIG9mIGFuIGF1Y3Rpb24uIEZhY3RvcmVkIG91dAogICAgLy8vICBmcm9tIF9jdXJyZW50UHJpY2Ugc28gd2UgY2FuIHJ1biBleHRlbnNpdmUgdW5pdCB0ZXN0cy4KICAgIC8vLyAgV2hlbiB0ZXN0aW5nLCBtYWtlIHRoaXMgZnVuY3Rpb24gcHVibGljIGFuZCB0dXJuIG9uCiAgICAvLy8gIGBDdXJyZW50IHByaWNlIGNvbXB1dGF0aW9uYCB0ZXN0IHN1aXRlLgogICAgZnVuY3Rpb24gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9zZWNvbmRzUGFzc2VkCiAgICApCiAgICBpbnRlcm5hbAogICAgcHVyZQogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIHB1YmxpYyBmdW5jdGlvbnMgY2FyZWZ1bGx5IGNhcCB0aGUgbWF4aW11bSB2YWx1ZXMgZm9yCiAgICAgICAgLy8gIHRpbWUgKGF0IDY0LWJpdHMpIGFuZCBjdXJyZW5jeSAoYXQgMTI4LWJpdHMpLiBfZHVyYXRpb24gaXMKICAgICAgICAvLyAgYWxzbyBrbm93biB0byBiZSBub24temVybyAoc2VlIHRoZSByZXF1aXJlKCkgc3RhdGVtZW50IGluCiAgICAgICAgLy8gIF9hZGRBdWN0aW9uKCkpCiAgICAgICAgaWYgKF9zZWNvbmRzUGFzc2VkID49IF9kdXJhdGlvbikgewogICAgICAgICAgICAvLyBXZSd2ZSByZWFjaGVkIHRoZSBlbmQgb2YgdGhlIGR5bmFtaWMgcHJpY2luZyBwb3J0aW9uCiAgICAgICAgICAgIC8vIG9mIHRoZSBhdWN0aW9uLCBqdXN0IHJldHVybiB0aGUgZW5kIHByaWNlLgogICAgICAgICAgICByZXR1cm4gX2VuZGluZ1ByaWNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0aW5nIHByaWNlIGNhbiBiZSBoaWdoZXIgdGhhbiBlbmRpbmcgcHJpY2UgKGFuZCBvZnRlbiBpcyEpLCBzbwogICAgICAgICAgICAvLyB0aGlzIGRlbHRhIGNhbiBiZSBuZWdhdGl2ZS4KICAgICAgICAgICAgaW50MjU2IHRvdGFsUHJpY2VDaGFuZ2UgPSBpbnQyNTYoX2VuZGluZ1ByaWNlKSAtIGludDI1Nihfc3RhcnRpbmdQcmljZSk7CgogICAgICAgICAgICAvLyBUaGlzIG11bHRpcGxpY2F0aW9uIGNhbid0IG92ZXJmbG93LCBfc2Vjb25kc1Bhc3NlZCB3aWxsIGVhc2lseSBmaXQgd2l0aGluCiAgICAgICAgICAgIC8vIDY0LWJpdHMsIGFuZCB0b3RhbFByaWNlQ2hhbmdlIHdpbGwgZWFzaWx5IGZpdCB3aXRoaW4gMTI4LWJpdHMsIHRoZWlyIHByb2R1Y3QKICAgICAgICAgICAgLy8gd2lsbCBhbHdheXMgZml0IHdpdGhpbiAyNTYtYml0cy4KICAgICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZUNoYW5nZSA9IHRvdGFsUHJpY2VDaGFuZ2UgKiBpbnQyNTYoX3NlY29uZHNQYXNzZWQpIC8gaW50MjU2KF9kdXJhdGlvbik7CgogICAgICAgICAgICAvLyBjdXJyZW50UHJpY2VDaGFuZ2UgY2FuIGJlIG5lZ2F0aXZlLCBidXQgaWYgc28sIHdpbGwgaGF2ZSBhIG1hZ25pdHVkZQogICAgICAgICAgICAvLyBsZXNzIHRoYXQgX3N0YXJ0aW5nUHJpY2UuIFRodXMsIHRoaXMgcmVzdWx0IHdpbGwgYWx3YXlzIGVuZCB1cCBwb3NpdGl2ZS4KICAgICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZSA9IGludDI1Nihfc3RhcnRpbmdQcmljZSkgKyBjdXJyZW50UHJpY2VDaGFuZ2U7CgogICAgICAgICAgICByZXR1cm4gdWludDI1NihjdXJyZW50UHJpY2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyBvd25lcidzIGN1dCBvZiBhIHNhbGUuCiAgICAvLy8gQHBhcmFtIF9wcmljZSAtIFNhbGUgcHJpY2Ugb2YgTkZULgogICAgZnVuY3Rpb24gX2NvbXB1dGVDdXQodWludDI1NiBfcHJpY2UpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgZW50cnkgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICBjdXJyZW5jeSAoYXQgMTI4LWJpdHMpLCBhbmQgb3duZXJDdXQgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gIHN0YXRlbWVudCBpbiB0aGUgQ2xvY2tBdWN0aW9uIGNvbnN0cnVjdG9yKS4gVGhlIHJlc3VsdCBvZiB0aGlzCiAgICAgICAgLy8gIGZ1bmN0aW9uIGlzIGFsd2F5cyBndWFyYW50ZWVkIHRvIGJlIDw9IF9wcmljZS4KICAgICAgICByZXR1cm4gX3ByaWNlICogb3duZXJDdXQgLyAxMDAwMDsKICAgIH0KCn0KCgoKCgovLy8gQHRpdGxlIENsb2NrIGF1Y3Rpb24gZm9yIG5vbi1mdW5naWJsZSB0b2tlbnMuCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgQ2xvY2tBdWN0aW9uIGlzIFBhdXNhYmxlLCBDbG9ja0F1Y3Rpb25CYXNlIHsKCiAgICAvLy8gQGRldiBUaGUgRVJDLTE2NSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkMtNzIxLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUKICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciBjcmVhdGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBORlQgb3duZXJzaGlwIGNvbnRyYWN0CiAgICAvLy8gIGFuZCB2ZXJpZmllcyB0aGUgb3duZXIgY3V0IGlzIGluIHRoZSB2YWxpZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gX25mdEFkZHJlc3MgLSBhZGRyZXNzIG9mIGEgZGVwbG95ZWQgY29udHJhY3QgaW1wbGVtZW50aW5nCiAgICAvLy8gIHRoZSBOb25mdW5naWJsZSBJbnRlcmZhY2UuCiAgICAvLy8gQHBhcmFtIF9jdXQgLSBwZXJjZW50IGN1dCB0aGUgb3duZXIgdGFrZXMgb24gZWFjaCBhdWN0aW9uLCBtdXN0IGJlCiAgICAvLy8gIGJldHdlZW4gMC0xMCwwMDAuCiAgICBmdW5jdGlvbiBDbG9ja0F1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkcmVzcywgdWludDI1NiBfY3V0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2N1dCA8PSAxMDAwMCk7CiAgICAgICAgb3duZXJDdXQgPSBfY3V0OwoKICAgICAgICBFUkM3MjEgY2FuZGlkYXRlQ29udHJhY3QgPSBFUkM3MjEoX25mdEFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3Quc3VwcG9ydHNJbnRlcmZhY2UoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmUgYWxsIEV0aGVyIGZyb20gdGhlIGNvbnRyYWN0LCB3aGljaCBpcyB0aGUgb3duZXIncyBjdXRzCiAgICAvLy8gIGFzIHdlbGwgYXMgYW55IEV0aGVyIHNlbnQgZGlyZWN0bHkgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MuCiAgICAvLy8gIEFsd2F5cyB0cmFuc2ZlcnMgdG8gdGhlIE5GVCBjb250cmFjdCwgYnV0IGNhbiBiZSBjYWxsZWQgZWl0aGVyIGJ5CiAgICAvLy8gIHRoZSBvd25lciBvciB0aGUgTkZUIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIGFkZHJlc3MgbmZ0QWRkcmVzcyA9IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCk7CgogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBuZnRBZGRyZXNzCiAgICAgICAgKTsKICAgICAgICAvLyBXZSBhcmUgdXNpbmcgdGhpcyBib29sZWFuIG1ldGhvZCB0byBtYWtlIHN1cmUgdGhhdCBldmVuIGlmIG9uZSBmYWlscyBpdCB3aWxsIHN0aWxsIHdvcmsKICAgICAgICBuZnRBZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhbmQgYmVnaW5zIGEgbmV3IGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIHRpbWUgdG8gbW92ZSBiZXR3ZWVuIHN0YXJ0aW5nCiAgICAvLy8gIHByaWNlIGFuZCBlbmRpbmcgcHJpY2UgKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICBfZXNjcm93KG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgQmlkcyBvbiBhbiBvcGVuIGF1Y3Rpb24sIGNvbXBsZXRpbmcgdGhlIGF1Y3Rpb24gYW5kIHRyYW5zZmVycmluZwogICAgLy8vICBvd25lcnNoaXAgb2YgdGhlIE5GVCBpZiBlbm91Z2ggRXRoZXIgaXMgc3VwcGxpZWQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYmlkIG9uLgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgcGF5YWJsZQogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIF9iaWQgd2lsbCB0aHJvdyBpZiB0aGUgYmlkIG9yIGZ1bmRzIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB0aGF0IGhhc24ndCBiZWVuIHdvbiB5ZXQuCiAgICAvLy8gIFJldHVybnMgdGhlIE5GVCB0byBvcmlnaW5hbCBvd25lci4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgYSBzdGF0ZS1tb2RpZnlpbmcgZnVuY3Rpb24gdGhhdCBjYW4KICAgIC8vLyAgYmUgY2FsbGVkIHdoaWxlIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gb24gYXVjdGlvbgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxsZXIpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBzZWxsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICAvLy8gIE9ubHkgdGhlIG93bmVyIG1heSBkbyB0aGlzLCBhbmQgTkZUcyBhcmUgcmV0dXJuZWQgdG8KICAgIC8vLyAgdGhlIHNlbGxlci4gVGhpcyBzaG91bGQgb25seSBiZSB1c2VkIGluIGVtZXJnZW5jaWVzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSBORlQgb24gYXVjdGlvbiB0byBjYW5jZWwuCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uV2hlblBhdXNlZCh1aW50MjU2IF90b2tlbklkKQogICAgd2hlblBhdXNlZAogICAgb25seU93bmVyCiAgICBleHRlcm5hbAogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uLnNlbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBhdWN0aW9uIGluZm8gZm9yIGFuIE5GVCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnMKICAgICgKICAgICAgICBhZGRyZXNzIHNlbGxlciwKICAgICAgICB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBlbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGR1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgc3RhcnRlZEF0CiAgICApIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gKAogICAgICAgIGF1Y3Rpb24uc2VsbGVyLAogICAgICAgIGF1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICBhdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgIGF1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgYXVjdGlvbi5zdGFydGVkQXQKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0aGUgdG9rZW4gcHJpY2Ugd2UgYXJlIGNoZWNraW5nLgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgIH0KCn0KCi8vCmNvbnRyYWN0IEdlbmVTY2llbmNlIHsKCiAgICB1aW50NjQgX3NlZWQgPSAwOwoKICAgIC8vLyBAZGV2IHNpbXBseSBhIGJvb2xlYW4gdG8gaW5kaWNhdGUgdGhpcyBpcyB0aGUgY29udHJhY3Qgd2UgZXhwZWN0IHRvIGJlCiAgICAvLy8gcHVyZSBtZWFucyAidGhleSBwcm9taXNlIG5vdCB0byByZWFkIGZyb20gb3IgbW9kaWZ5IHRoZSBzdGF0ZS4iCiAgICBmdW5jdGlvbiBpc0dlbmVTY2llbmNlKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIHJldHVybiBhIHBzZXVkbyByYW5kb20gbnVtYmVyIGJldHdlZW4gbG93ZXIgYW5kIHVwcGVyIGJvdW5kcwogICAgLy8gZ2l2ZW4gdGhlIG51bWJlciBvZiBwcmV2aW91cyBibG9ja3MgaXQgc2hvdWxkIGhhc2guCiAgICBmdW5jdGlvbiByYW5kb20odWludDY0IHVwcGVyKSBpbnRlcm5hbCByZXR1cm5zICh1aW50NjQpIHsKICAgICAgICBfc2VlZCA9IHVpbnQ2NChrZWNjYWsyNTYoa2VjY2FrMjU2KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXIpLCBfc2VlZCksIG5vdykpOwogICAgICAgIHJldHVybiBfc2VlZCAlIHVwcGVyOwogICAgfQoKICAgIGZ1bmN0aW9uIHJhbmRvbUJldHdlZW4odWludDMyIGEsIHVpbnQzMiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MzIpIHsKICAgICAgICB1aW50MzIgbWluOwogICAgICAgIHVpbnQzMiBtYXg7CiAgICAgICAgaWYoYSA8IGIpIHsKICAgICAgICAgICAgbWluID0gYTsKICAgICAgICAgICAgbWF4ID0gYjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtaW4gPSBiOwogICAgICAgICAgICBtYXggPSBhOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1pbiArIHVpbnQzMihyYW5kb20obWF4IC0gbWluICsgMSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJhbmRvbUNvZGUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCkgewogICAgICAgIC8vCiAgICAgICAgdWludDY0IHIgPSByYW5kb20oMTAwMDAwMCk7CgogICAgICAgIGlmIChyIDw9IDE2MykgcmV0dXJuIDE1MTsKICAgICAgICBpZiAociA8PSAzMjcpIHJldHVybiAyNTE7CiAgICAgICAgaWYgKHIgPD0gNDkwKSByZXR1cm4gMTk2OwogICAgICAgIGlmIChyIDw9IDY1NCkgcmV0dXJuIDE5NzsKICAgICAgICBpZiAociA8PSA4MTcpIHJldHVybiAyMzg7CiAgICAgICAgaWYgKHIgPD0gOTgxKSByZXR1cm4gMjQwOwogICAgICAgIGlmIChyIDw9IDExNDQpIHJldHVybiAyMzk7CiAgICAgICAgaWYgKHIgPD0gMTMwOCkgcmV0dXJuIDE3MzsKICAgICAgICBpZiAociA8PSAxNDcxKSByZXR1cm4gMTc1OwogICAgICAgIGlmIChyIDw9IDE2MzUpIHJldHVybiAxNzQ7CiAgICAgICAgaWYgKHIgPD0gMTc5OCkgcmV0dXJuIDIzNjsKICAgICAgICBpZiAociA8PSAxOTYyKSByZXR1cm4gMTcyOwogICAgICAgIGlmIChyIDw9IDIyODkpIHJldHVybiAyNTA7CiAgICAgICAgaWYgKHIgPD0gMjYxNikgcmV0dXJuIDI0OTsKICAgICAgICBpZiAociA8PSAyOTQzKSByZXR1cm4gMjQ0OwogICAgICAgIGlmIChyIDw9IDMyNzApIHJldHVybiAyNDM7CiAgICAgICAgaWYgKHIgPD0gMzU5NykgcmV0dXJuIDI0NTsKICAgICAgICBpZiAociA8PSA0MDg3KSByZXR1cm4gMTQ1OwogICAgICAgIGlmIChyIDw9IDQ1NzcpIHJldHVybiAxNDY7CiAgICAgICAgaWYgKHIgPD0gNTA2OCkgcmV0dXJuIDE0NDsKICAgICAgICBpZiAociA8PSA1ODg1KSByZXR1cm4gMjQ4OwogICAgICAgIGlmIChyIDw9IDY3MDMpIHJldHVybiAxNDk7CiAgICAgICAgaWYgKHIgPD0gNzUyMCkgcmV0dXJuIDE0MzsKICAgICAgICBpZiAociA8PSA4MzM3KSByZXR1cm4gMTEyOwogICAgICAgIGlmIChyIDw9IDkxNTUpIHJldHVybiAyNDI7CiAgICAgICAgaWYgKHIgPD0gOTk3MikgcmV0dXJuIDIxMjsKICAgICAgICBpZiAociA8PSAxMDc5MCkgcmV0dXJuIDE2MDsKICAgICAgICBpZiAociA8PSAxMTYwNykgcmV0dXJuIDY7CiAgICAgICAgaWYgKHIgPD0gMTI0MjQpIHJldHVybiAxNTc7CiAgICAgICAgaWYgKHIgPD0gMTMyNDIpIHJldHVybiAxMzE7CiAgICAgICAgaWYgKHIgPD0gMTQwNTkpIHJldHVybiAzOwogICAgICAgIGlmIChyIDw9IDE0ODc3KSByZXR1cm4gMjMzOwogICAgICAgIGlmIChyIDw9IDE1Njk0KSByZXR1cm4gOTsKICAgICAgICBpZiAociA8PSAxNjUxMSkgcmV0dXJuIDE1NDsKICAgICAgICBpZiAociA8PSAxNzMyOSkgcmV0dXJuIDE4MjsKICAgICAgICBpZiAociA8PSAxODE0NikgcmV0dXJuIDE3NjsKICAgICAgICBpZiAociA8PSAxOTEyNykgcmV0dXJuIDE1MDsKICAgICAgICBpZiAociA8PSAyMDc2MikgcmV0dXJuIDEzMDsKICAgICAgICBpZiAociA8PSAyMjM5NykgcmV0dXJuIDY4OwogICAgICAgIGlmIChyIDw9IDI0MDMxKSByZXR1cm4gNjU7CiAgICAgICAgaWYgKHIgPD0gMjU2NjYpIHJldHVybiA1OTsKICAgICAgICBpZiAociA8PSAyNzMwMSkgcmV0dXJuIDk0OwogICAgICAgIGlmIChyIDw9IDI4OTM2KSByZXR1cm4gMTk5OwogICAgICAgIGlmIChyIDw9IDMwNTcxKSByZXR1cm4gMTY5OwogICAgICAgIGlmIChyIDw9IDMyMjA1KSByZXR1cm4gMjA4OwogICAgICAgIGlmIChyIDw9IDMzODQwKSByZXR1cm4gMjMwOwogICAgICAgIGlmIChyIDw9IDM1NDc1KSByZXR1cm4gMTg2OwogICAgICAgIGlmIChyIDw9IDM3MTEwKSByZXR1cm4gMzY7CiAgICAgICAgaWYgKHIgPD0gMzg3NDQpIHJldHVybiAzODsKICAgICAgICBpZiAociA8PSA0MDM3OSkgcmV0dXJuIDE5MjsKICAgICAgICBpZiAociA8PSA0MjAxNCkgcmV0dXJuIDI2OwogICAgICAgIGlmIChyIDw9IDQzNjQ5KSByZXR1cm4gMjM3OwogICAgICAgIGlmIChyIDw9IDQ1Mjg0KSByZXR1cm4gMTQ4OwogICAgICAgIGlmIChyIDw9IDQ2OTE4KSByZXR1cm4gMjQ3OwogICAgICAgIGlmIChyIDw9IDQ4NTUzKSByZXR1cm4gMjsKICAgICAgICBpZiAociA8PSA1MDE4OCkgcmV0dXJuIDU7CiAgICAgICAgaWYgKHIgPD0gNTE4MjMpIHJldHVybiA4OwogICAgICAgIGlmIChyIDw9IDUzNzg1KSByZXR1cm4gMTM0OwogICAgICAgIGlmIChyIDw9IDU1NzQ2KSByZXR1cm4gMjMyOwogICAgICAgIGlmIChyIDw9IDU3NzA4KSByZXR1cm4gNzY7CiAgICAgICAgaWYgKHIgPD0gNTk2NzApIHJldHVybiAxMzY7CiAgICAgICAgaWYgKHIgPD0gNjE2MzIpIHJldHVybiAxMzU7CiAgICAgICAgaWYgKHIgPD0gNjM1OTMpIHJldHVybiAxODE7CiAgICAgICAgaWYgKHIgPD0gNjU1NTUpIHJldHVybiA2MjsKICAgICAgICBpZiAociA8PSA2NzUxNykgcmV0dXJuIDM0OwogICAgICAgIGlmIChyIDw9IDY5NDc5KSByZXR1cm4gMzE7CiAgICAgICAgaWYgKHIgPD0gNzE0NDApIHJldHVybiAyMjE7CiAgICAgICAgaWYgKHIgPD0gNzM0MDIpIHJldHVybiA3MTsKICAgICAgICBpZiAociA8PSA3NTM2NCkgcmV0dXJuIDE4NTsKICAgICAgICBpZiAociA8PSA3NzMyNSkgcmV0dXJuIDE4OwogICAgICAgIGlmIChyIDw9IDc5Mjg3KSByZXR1cm4gMTU7CiAgICAgICAgaWYgKHIgPD0gODEyNDkpIHJldHVybiAxMjsKICAgICAgICBpZiAociA8PSA4MzIxMSkgcmV0dXJuIDE1OTsKICAgICAgICBpZiAociA8PSA4NTE3MikgcmV0dXJuIDE4OTsKICAgICAgICBpZiAociA8PSA4NzEzNCkgcmV0dXJuIDIxOTsKICAgICAgICBpZiAociA8PSA4OTA5NikgcmV0dXJuIDE1NjsKICAgICAgICBpZiAociA8PSA5MTA1OCkgcmV0dXJuIDE1MzsKICAgICAgICBpZiAociA8PSA5MzUxMCkgcmV0dXJuIDIxNzsKICAgICAgICBpZiAociA8PSA5NTk2MikgcmV0dXJuIDEzOTsKICAgICAgICBpZiAociA8PSA5ODQxNCkgcmV0dXJuIDIyOTsKICAgICAgICBpZiAociA8PSAxMDA4NjYpIHJldHVybiAxNDE7CiAgICAgICAgaWYgKHIgPD0gMTAzMzE5KSByZXR1cm4gMjEwOwogICAgICAgIGlmIChyIDw9IDEwNTc3MSkgcmV0dXJuIDQ1OwogICAgICAgIGlmIChyIDw9IDEwODIyMykgcmV0dXJuIDIwNTsKICAgICAgICBpZiAociA8PSAxMTA2NzUpIHJldHVybiA3ODsKICAgICAgICBpZiAociA8PSAxMTMxMjcpIHJldHVybiAyMjQ7CiAgICAgICAgaWYgKHIgPD0gMTE1NTgwKSByZXR1cm4gMTcxOwogICAgICAgIGlmIChyIDw9IDExODAzMikgcmV0dXJuIDE2NDsKICAgICAgICBpZiAociA8PSAxMjA0ODQpIHJldHVybiAxNzg7CiAgICAgICAgaWYgKHIgPD0gMTIyOTM2KSByZXR1cm4gMTk1OwogICAgICAgIGlmIChyIDw9IDEyNTM4OCkgcmV0dXJuIDEwNTsKICAgICAgICBpZiAociA8PSAxMjc4NDApIHJldHVybiAxNjI7CiAgICAgICAgaWYgKHIgPD0gMTMwMjkzKSByZXR1cm4gMTY4OwogICAgICAgIGlmIChyIDw9IDEzMjc0NSkgcmV0dXJuIDE4NDsKICAgICAgICBpZiAociA8PSAxMzUxOTcpIHJldHVybiAxNjY7CiAgICAgICAgaWYgKHIgPD0gMTM4NDY3KSByZXR1cm4gMTAzOwogICAgICAgIGlmIChyIDw9IDE0MTczNikgcmV0dXJuIDg5OwogICAgICAgIGlmIChyIDw9IDE0NTAwNikgcmV0dXJuIDk5OwogICAgICAgIGlmIChyIDw9IDE0ODI3NSkgcmV0dXJuIDE0MjsKICAgICAgICBpZiAociA8PSAxNTE1NDUpIHJldHVybiA4MDsKICAgICAgICBpZiAociA8PSAxNTQ4MTQpIHJldHVybiA5MTsKICAgICAgICBpZiAociA8PSAxNTgwODQpIHJldHVybiAxMTU7CiAgICAgICAgaWYgKHIgPD0gMTYxMzU0KSByZXR1cm4gMTA2OwogICAgICAgIGlmIChyIDw9IDE2NDYyMykgcmV0dXJuIDczOwogICAgICAgIGlmIChyIDw9IDE2Nzg5MykgcmV0dXJuIDI4OwogICAgICAgIGlmIChyIDw9IDE3MTE2MikgcmV0dXJuIDI0MTsKICAgICAgICBpZiAociA8PSAxNzQ0MzIpIHJldHVybiAxMjE7CiAgICAgICAgaWYgKHIgPD0gMTc3NzAxKSByZXR1cm4gNTU7CiAgICAgICAgaWYgKHIgPD0gMTgwOTcxKSByZXR1cm4gMTI2OwogICAgICAgIGlmIChyIDw9IDE4NDI0MSkgcmV0dXJuIDgyOwogICAgICAgIGlmIChyIDw9IDE4NzUxMCkgcmV0dXJuIDEyNTsKICAgICAgICBpZiAociA8PSAxOTA3ODApIHJldHVybiAxMTA7CiAgICAgICAgaWYgKHIgPD0gMTk0MDQ5KSByZXR1cm4gODU7CiAgICAgICAgaWYgKHIgPD0gMTk3MzE5KSByZXR1cm4gNTc7CiAgICAgICAgaWYgKHIgPD0gMjAwNTg5KSByZXR1cm4gMTA3OwogICAgICAgIGlmIChyIDw9IDIwMzg1OCkgcmV0dXJuIDk3OwogICAgICAgIGlmIChyIDw9IDIwNzEyOCkgcmV0dXJuIDExOTsKICAgICAgICBpZiAociA8PSAyMTAzOTcpIHJldHVybiAyMjc7CiAgICAgICAgaWYgKHIgPD0gMjEzNjY3KSByZXR1cm4gMTE3OwogICAgICAgIGlmIChyIDw9IDIxNjkzNikgcmV0dXJuIDQ5OwogICAgICAgIGlmIChyIDw9IDIyMDIwNikgcmV0dXJuIDQwOwogICAgICAgIGlmIChyIDw9IDIyMzQ3NikgcmV0dXJuIDEwMTsKICAgICAgICBpZiAociA8PSAyMjY3NDUpIHJldHVybiA4NzsKICAgICAgICBpZiAociA8PSAyMzAwMTUpIHJldHVybiAyMTU7CiAgICAgICAgaWYgKHIgPD0gMjMzMjg0KSByZXR1cm4gNDI7CiAgICAgICAgaWYgKHIgPD0gMjM2NTU0KSByZXR1cm4gMjI7CiAgICAgICAgaWYgKHIgPD0gMjM5ODIzKSByZXR1cm4gMjA3OwogICAgICAgIGlmIChyIDw9IDI0MzA5MykgcmV0dXJuIDI0OwogICAgICAgIGlmIChyIDw9IDI0NjM2MykgcmV0dXJuIDkzOwogICAgICAgIGlmIChyIDw9IDI0OTYzMikgcmV0dXJuIDQ3OwogICAgICAgIGlmIChyIDw9IDI1MjkwMikgcmV0dXJuIDIwOwogICAgICAgIGlmIChyIDw9IDI1NjE3MSkgcmV0dXJuIDUzOwogICAgICAgIGlmIChyIDw9IDI1OTQ0MSkgcmV0dXJuIDExMzsKICAgICAgICBpZiAociA8PSAyNjI3MTApIHJldHVybiAxOTg7CiAgICAgICAgaWYgKHIgPD0gMjY1OTgwKSByZXR1cm4gNTE7CiAgICAgICAgaWYgKHIgPD0gMjY5MjUwKSByZXR1cm4gMTA4OwogICAgICAgIGlmIChyIDw9IDI3MjUxOSkgcmV0dXJuIDE5MDsKICAgICAgICBpZiAociA8PSAyNzU3ODkpIHJldHVybiAxNTg7CiAgICAgICAgaWYgKHIgPD0gMjc5MDU4KSByZXR1cm4gOTU7CiAgICAgICAgaWYgKHIgPD0gMjgyMzI4KSByZXR1cm4gMTsKICAgICAgICBpZiAociA8PSAyODU1OTgpIHJldHVybiAyMjU7CiAgICAgICAgaWYgKHIgPD0gMjg4ODY3KSByZXR1cm4gNDsKICAgICAgICBpZiAociA8PSAyOTIxMzcpIHJldHVybiAxNTU7CiAgICAgICAgaWYgKHIgPD0gMjk1NDA2KSByZXR1cm4gNzsKICAgICAgICBpZiAociA8PSAyOTg2NzYpIHJldHVybiAxNTI7CiAgICAgICAgaWYgKHIgPD0gMzAxOTQ1KSByZXR1cm4gMjU7CiAgICAgICAgaWYgKHIgPD0gMzA1MjE1KSByZXR1cm4gMTMyOwogICAgICAgIGlmIChyIDw9IDMwOTMwMikgcmV0dXJuIDY3OwogICAgICAgIGlmIChyIDw9IDMxMzM4OSkgcmV0dXJuIDY0OwogICAgICAgIGlmIChyIDw9IDMxNzQ3NikgcmV0dXJuIDc1OwogICAgICAgIGlmIChyIDw9IDMyMTU2MykgcmV0dXJuIDcwOwogICAgICAgIGlmIChyIDw9IDMyNTY1MCkgcmV0dXJuIDE4MDsKICAgICAgICBpZiAociA8PSAzMjk3MzcpIHJldHVybiA2MTsKICAgICAgICBpZiAociA8PSAzMzM4MjQpIHJldHVybiAzMzsKICAgICAgICBpZiAociA8PSAzMzc5MTEpIHJldHVybiAzMDsKICAgICAgICBpZiAociA8PSAzNDE5OTgpIHJldHVybiAxNzsKICAgICAgICBpZiAociA8PSAzNDYwODUpIHJldHVybiAyMDI7CiAgICAgICAgaWYgKHIgPD0gMzUwMTcyKSByZXR1cm4gMTg4OwogICAgICAgIGlmIChyIDw9IDM1NDI1OSkgcmV0dXJuIDExOwogICAgICAgIGlmIChyIDw9IDM1ODM0NikgcmV0dXJuIDE0OwogICAgICAgIGlmIChyIDw9IDM2MjQzMykgcmV0dXJuIDIzNTsKICAgICAgICBpZiAociA8PSAzNjczMzcpIHJldHVybiAyMTQ7CiAgICAgICAgaWYgKHIgPD0gMzcyMjQxKSByZXR1cm4gMTI3OwogICAgICAgIGlmIChyIDw9IDM3NzE0NikgcmV0dXJuIDEyNDsKICAgICAgICBpZiAociA8PSAzODIwNTApIHJldHVybiAxMjg7CiAgICAgICAgaWYgKHIgPD0gMzg2OTU0KSByZXR1cm4gMTIzOwogICAgICAgIGlmIChyIDw9IDM5MTg1OSkgcmV0dXJuIDIyNjsKICAgICAgICBpZiAociA8PSAzOTY3NjMpIHJldHVybiAyMzQ7CiAgICAgICAgaWYgKHIgPD0gNDAxNjY3KSByZXR1cm4gMTIyOwogICAgICAgIGlmIChyIDw9IDQwNjU3MikgcmV0dXJuIDIxMTsKICAgICAgICBpZiAociA8PSA0MTE0NzYpIHJldHVybiAyMDM7CiAgICAgICAgaWYgKHIgPD0gNDE2MzgxKSByZXR1cm4gMjAwOwogICAgICAgIGlmIChyIDw9IDQyMTI4NSkgcmV0dXJuIDIwNjsKICAgICAgICBpZiAociA8PSA0MjYxODkpIHJldHVybiA0NDsKICAgICAgICBpZiAociA8PSA0MzEwOTQpIHJldHVybiAxOTM7CiAgICAgICAgaWYgKHIgPD0gNDM1OTk4KSByZXR1cm4gMjIyOwogICAgICAgIGlmIChyIDw9IDQ0MDkwMikgcmV0dXJuIDU4OwogICAgICAgIGlmIChyIDw9IDQ0NTgwNykgcmV0dXJuIDgzOwogICAgICAgIGlmIChyIDw9IDQ1MDcxMSkgcmV0dXJuIDM1OwogICAgICAgIGlmIChyIDw9IDQ1NTYxNSkgcmV0dXJuIDIwMTsKICAgICAgICBpZiAociA8PSA0NjA1MjApIHJldHVybiAzNzsKICAgICAgICBpZiAociA8PSA0NjU0MjQpIHJldHVybiAyMTg7CiAgICAgICAgaWYgKHIgPD0gNDcwMzI5KSByZXR1cm4gMjIwOwogICAgICAgIGlmIChyIDw9IDQ3NTIzMykgcmV0dXJuIDIxMzsKICAgICAgICBpZiAociA8PSA0ODE3NzIpIHJldHVybiAxMTQ7CiAgICAgICAgaWYgKHIgPD0gNDg4MzExKSByZXR1cm4gMTM3OwogICAgICAgIGlmIChyIDw9IDQ5NDg1MCkgcmV0dXJuIDc3OwogICAgICAgIGlmIChyIDw9IDUwMTM5MCkgcmV0dXJuIDEzODsKICAgICAgICBpZiAociA8PSA1MDc5MjkpIHJldHVybiAxNDA7CiAgICAgICAgaWYgKHIgPD0gNTE0NDY4KSByZXR1cm4gMjA5OwogICAgICAgIGlmIChyIDw9IDUyMTAwNykgcmV0dXJuIDIyODsKICAgICAgICBpZiAociA8PSA1Mjc1NDYpIHJldHVybiAxNzA7CiAgICAgICAgaWYgKHIgPD0gNTM0MDg1KSByZXR1cm4gMjA0OwogICAgICAgIGlmIChyIDw9IDU0MDYyNCkgcmV0dXJuIDkyOwogICAgICAgIGlmIChyIDw9IDU0NzE2NCkgcmV0dXJuIDEzMzsKICAgICAgICBpZiAociA8PSA1NTM3MDMpIHJldHVybiAxMDQ7CiAgICAgICAgaWYgKHIgPD0gNTYwMjQyKSByZXR1cm4gMTc3OwogICAgICAgIGlmIChyIDw9IDU2Njc4MSkgcmV0dXJuIDI0NjsKICAgICAgICBpZiAociA8PSA1NzMzMjApIHJldHVybiAxNDc7CiAgICAgICAgaWYgKHIgPD0gNTc5ODU5KSByZXR1cm4gNDY7CiAgICAgICAgaWYgKHIgPD0gNTg2Mzk5KSByZXR1cm4gMTk0OwogICAgICAgIGlmIChyIDw9IDU5NDU3MykgcmV0dXJuIDExMTsKICAgICAgICBpZiAociA8PSA2MDI3NDYpIHJldHVybiA5ODsKICAgICAgICBpZiAociA8PSA2MTA5MjApIHJldHVybiA4ODsKICAgICAgICBpZiAociA8PSA2MTkwOTQpIHJldHVybiA3OTsKICAgICAgICBpZiAociA8PSA2MjcyNjgpIHJldHVybiA2NjsKICAgICAgICBpZiAociA8PSA2MzU0NDIpIHJldHVybiAyNzsKICAgICAgICBpZiAociA8PSA2NDM2MTYpIHJldHVybiA3NDsKICAgICAgICBpZiAociA8PSA2NTE3OTApIHJldHVybiAyMTY7CiAgICAgICAgaWYgKHIgPD0gNjU5OTY0KSByZXR1cm4gMjMxOwogICAgICAgIGlmIChyIDw9IDY2ODEzOCkgcmV0dXJuIDYzOwogICAgICAgIGlmIChyIDw9IDY3NjMxMikgcmV0dXJuIDEwMjsKICAgICAgICBpZiAociA8PSA2ODQ0ODYpIHJldHVybiAxMDk7CiAgICAgICAgaWYgKHIgPD0gNjkyNjYwKSByZXR1cm4gODE7CiAgICAgICAgaWYgKHIgPD0gNzAwODM0KSByZXR1cm4gODQ7CiAgICAgICAgaWYgKHIgPD0gNzA5MDA4KSByZXR1cm4gMTE4OwogICAgICAgIGlmIChyIDw9IDcxNzE4MikgcmV0dXJuIDU2OwogICAgICAgIGlmIChyIDw9IDcyNTM1NikgcmV0dXJuIDk2OwogICAgICAgIGlmIChyIDw9IDczMzUzMCkgcmV0dXJuIDU0OwogICAgICAgIGlmIChyIDw9IDc0MTcwMykgcmV0dXJuIDkwOwogICAgICAgIGlmIChyIDw9IDc0OTg3NykgcmV0dXJuIDcyOwogICAgICAgIGlmIChyIDw9IDc1ODA1MSkgcmV0dXJuIDEyMDsKICAgICAgICBpZiAociA8PSA3NjYyMjUpIHJldHVybiAxMTY7CiAgICAgICAgaWYgKHIgPD0gNzc0Mzk5KSByZXR1cm4gNjk7CiAgICAgICAgaWYgKHIgPD0gNzgyNTczKSByZXR1cm4gNDg7CiAgICAgICAgaWYgKHIgPD0gNzkwNzQ3KSByZXR1cm4gODY7CiAgICAgICAgaWYgKHIgPD0gNzk4OTIxKSByZXR1cm4gMTc5OwogICAgICAgIGlmIChyIDw9IDgwNzA5NSkgcmV0dXJuIDEwMDsKICAgICAgICBpZiAociA8PSA4MTUyNjkpIHJldHVybiAyMzsKICAgICAgICBpZiAociA8PSA4MjM0NDMpIHJldHVybiAyMjM7CiAgICAgICAgaWYgKHIgPD0gODMxNjE3KSByZXR1cm4gMzI7CiAgICAgICAgaWYgKHIgPD0gODM5NzkxKSByZXR1cm4gMjk7CiAgICAgICAgaWYgKHIgPD0gODQ3OTY1KSByZXR1cm4gMzk7CiAgICAgICAgaWYgKHIgPD0gODU2MTM5KSByZXR1cm4gNjA7CiAgICAgICAgaWYgKHIgPD0gODY0MzEzKSByZXR1cm4gMTY3OwogICAgICAgIGlmIChyIDw9IDg3MjQ4NykgcmV0dXJuIDIxOwogICAgICAgIGlmIChyIDw9IDg4MDY2MCkgcmV0dXJuIDE2NTsKICAgICAgICBpZiAociA8PSA4ODg4MzQpIHJldHVybiAxNjM7CiAgICAgICAgaWYgKHIgPD0gODk3MDA4KSByZXR1cm4gNTI7CiAgICAgICAgaWYgKHIgPD0gOTA1MTgyKSByZXR1cm4gMTk7CiAgICAgICAgaWYgKHIgPD0gOTEzMzU2KSByZXR1cm4gMTY7CiAgICAgICAgaWYgKHIgPD0gOTIxNTMwKSByZXR1cm4gNDE7CiAgICAgICAgaWYgKHIgPD0gOTI5NzA0KSByZXR1cm4gMTYxOwogICAgICAgIGlmIChyIDw9IDkzNzg3OCkgcmV0dXJuIDE4NzsKICAgICAgICBpZiAociA8PSA5NDYwNTIpIHJldHVybiA1MDsKICAgICAgICBpZiAociA8PSA5NTQyMjYpIHJldHVybiAxODM7CiAgICAgICAgaWYgKHIgPD0gOTYyNDAwKSByZXR1cm4gMTM7CiAgICAgICAgaWYgKHIgPD0gOTcwNTc0KSByZXR1cm4gMTA7CiAgICAgICAgaWYgKHIgPD0gOTc4NzQ4KSByZXR1cm4gMTkxOwogICAgICAgIGlmIChyIDw9IDk4ODU1NikgcmV0dXJuIDQzOwogICAgICAgIGlmIChyIDw9IDEwMDAwMDApIHJldHVybiAxMjk7CgogICAgICAgIHJldHVybiAxMjk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QmFzZVN0YXRzKHVpbnQ4IGlkKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MzIgcmEsIHVpbnQzMiByZCwgdWludDMyIHJzKSB7CiAgICAgICAgaWYgKGlkID09IDE1MSkgcmV0dXJuICgyMTAsIDIxMCwgMjAwKTsKICAgICAgICBpZiAoaWQgPT0gMjUxKSByZXR1cm4gKDIxMCwgMjEwLCAyMDApOwogICAgICAgIGlmIChpZCA9PSAxOTYpIHJldHVybiAoMjYxLCAxOTQsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDE5NykgcmV0dXJuICgxMjYsIDI1MCwgMTkwKTsKICAgICAgICBpZiAoaWQgPT0gMjM4KSByZXR1cm4gKDE1MywgMTE2LCA5MCk7CiAgICAgICAgaWYgKGlkID09IDI0MCkgcmV0dXJuICgxNTEsIDEwOCwgOTApOwogICAgICAgIGlmIChpZCA9PSAyMzkpIHJldHVybiAoMTM1LCAxMTAsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gMTczKSByZXR1cm4gKDc1LCA5MSwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTc1KSByZXR1cm4gKDY3LCAxMTYsIDcwKTsKICAgICAgICBpZiAoaWQgPT0gMTc0KSByZXR1cm4gKDY5LCAzNCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMjM2KSByZXR1cm4gKDY0LCA2NCwgNzApOwogICAgICAgIGlmIChpZCA9PSAxNzIpIHJldHVybiAoNzcsIDYzLCA0MCk7CiAgICAgICAgaWYgKGlkID09IDI1MCkgcmV0dXJuICgyMzksIDI3NCwgMTkzKTsKICAgICAgICBpZiAoaWQgPT0gMjQ5KSByZXR1cm4gKDE5MywgMzIzLCAyMTIpOwogICAgICAgIGlmIChpZCA9PSAyNDQpIHJldHVybiAoMjM1LCAxNzYsIDIzMCk7CiAgICAgICAgaWYgKGlkID09IDI0MykgcmV0dXJuICgyNDEsIDIxMCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMjQ1KSByZXR1cm4gKDE4MCwgMjM1LCAyMDApOwogICAgICAgIGlmIChpZCA9PSAxNDUpIHJldHVybiAoMjUzLCAxODgsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDE0NikgcmV0dXJuICgyNTEsIDE4NCwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMTQ0KSByZXR1cm4gKDE5MiwgMjQ5LCAxODApOwogICAgICAgIGlmIChpZCA9PSAyNDgpIHJldHVybiAoMjUxLCAyMTIsIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDE0OSkgcmV0dXJuICgyNjMsIDIwMSwgMTgyKTsKICAgICAgICBpZiAoaWQgPT0gMTQzKSByZXR1cm4gKDE5MCwgMTkwLCAzMjApOwogICAgICAgIGlmIChpZCA9PSAxMTIpIHJldHVybiAoMjIyLCAyMDYsIDIxMCk7CiAgICAgICAgaWYgKGlkID09IDI0MikgcmV0dXJuICgxMjksIDIyOSwgNTEwKTsKICAgICAgICBpZiAoaWQgPT0gMjEyKSByZXR1cm4gKDIzNiwgMTkxLCAxNDApOwogICAgICAgIGlmIChpZCA9PSAxNjApIHJldHVybiAoMjA1LCAxOTcsIDE3MCk7CiAgICAgICAgaWYgKGlkID09IDYpIHJldHVybiAoMjIzLCAxNzYsIDE1Nik7CiAgICAgICAgaWYgKGlkID09IDE1NykgcmV0dXJuICgyMjMsIDE3NiwgMTU2KTsKICAgICAgICBpZiAoaWQgPT0gMTMxKSByZXR1cm4gKDE2NSwgMTgwLCAyNjApOwogICAgICAgIGlmIChpZCA9PSAzKSByZXR1cm4gKDE5OCwgMTk4LCAxNjApOwogICAgICAgIGlmIChpZCA9PSAyMzMpIHJldHVybiAoMTk4LCAxODMsIDE3MCk7CiAgICAgICAgaWYgKGlkID09IDkpIHJldHVybiAoMTcxLCAyMTAsIDE1OCk7CiAgICAgICAgaWYgKGlkID09IDE1NCkgcmV0dXJuICgxNjgsIDIwMiwgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gMTgyKSByZXR1cm4gKDE2OSwgMTg5LCAxNTApOwogICAgICAgIGlmIChpZCA9PSAxNzYpIHJldHVybiAoMTM5LCAxOTEsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDE1MCkgcmV0dXJuICgzMDAsIDE4MiwgMTkzKTsKICAgICAgICBpZiAoaWQgPT0gMTMwKSByZXR1cm4gKDIzNywgMTk3LCAxOTApOwogICAgICAgIGlmIChpZCA9PSA2OCkgcmV0dXJuICgyMzQsIDE2MiwgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gNjUpIHJldHVybiAoMjcxLCAxOTQsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDU5KSByZXR1cm4gKDIyNywgMTY2LCAxODApOwogICAgICAgIGlmIChpZCA9PSA5NCkgcmV0dXJuICgyNjEsIDE1NiwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMTk5KSByZXR1cm4gKDE3NywgMTk0LCAxOTApOwogICAgICAgIGlmIChpZCA9PSAxNjkpIHJldHVybiAoMTk0LCAxNzgsIDE3MCk7CiAgICAgICAgaWYgKGlkID09IDIwOCkgcmV0dXJuICgxNDgsIDMzMywgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gMjMwKSByZXR1cm4gKDE5NCwgMTk0LCAxNTApOwogICAgICAgIGlmIChpZCA9PSAxODYpIHJldHVybiAoMTc0LCAxOTIsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDM2KSByZXR1cm4gKDE3OCwgMTcxLCAxOTApOwogICAgICAgIGlmIChpZCA9PSAzOCkgcmV0dXJuICgxNjksIDIwNCwgMTQ2KTsKICAgICAgICBpZiAoaWQgPT0gMTkyKSByZXR1cm4gKDE4NSwgMTQ4LCAxNTApOwogICAgICAgIGlmIChpZCA9PSAyNikgcmV0dXJuICgxOTMsIDE2NSwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gMjM3KSByZXR1cm4gKDE3MywgMjE0LCAxMDApOwogICAgICAgIGlmIChpZCA9PSAxNDgpIHJldHVybiAoMTYzLCAxMzgsIDEyMik7CiAgICAgICAgaWYgKGlkID09IDI0NykgcmV0dXJuICgxNTUsIDEzMywgMTQwKTsKICAgICAgICBpZiAoaWQgPT0gMikgcmV0dXJuICgxNTEsIDE1MSwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gNSkgcmV0dXJuICgxNTgsIDEyOSwgMTE2KTsKICAgICAgICBpZiAoaWQgPT0gOCkgcmV0dXJuICgxMjYsIDE1NSwgMTE4KTsKICAgICAgICBpZiAoaWQgPT0gMTM0KSByZXR1cm4gKDIwNSwgMTc3LCAyNjApOwogICAgICAgIGlmIChpZCA9PSAyMzIpIHJldHVybiAoMjE0LCAyMTQsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDc2KSByZXR1cm4gKDIxMSwgMjI5LCAxNjApOwogICAgICAgIGlmIChpZCA9PSAxMzYpIHJldHVybiAoMjQ2LCAyMDQsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDEzNSkgcmV0dXJuICgyMzIsIDIwMSwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTgxKSByZXR1cm4gKDIxMSwgMTcyLCAxODApOwogICAgICAgIGlmIChpZCA9PSA2MikgcmV0dXJuICgxODIsIDE4NywgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gMzQpIHJldHVybiAoMjA0LCAxNTcsIDE2Mik7CiAgICAgICAgaWYgKGlkID09IDMxKSByZXR1cm4gKDE4MCwgMTc0LCAxODApOwogICAgICAgIGlmIChpZCA9PSAyMjEpIHJldHVybiAoMTgxLCAxNDcsIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDcxKSByZXR1cm4gKDIwNywgMTM4LCAxNjApOwogICAgICAgIGlmIChpZCA9PSAxODUpIHJldHVybiAoMTY3LCAxOTgsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDE4KSByZXR1cm4gKDE2NiwgMTU3LCAxNjYpOwogICAgICAgIGlmIChpZCA9PSAxNSkgcmV0dXJuICgxNjksIDE1MCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTIpIHJldHVybiAoMTY3LCAxNTEsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDE1OSkgcmV0dXJuICgxNTAsIDE1MSwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTg5KSByZXR1cm4gKDExOCwgMTk3LCAxNTApOwogICAgICAgIGlmIChpZCA9PSAyMTkpIHJldHVybiAoMTM5LCAyMDksIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDE1NikgcmV0dXJuICgxNTgsIDEyOSwgMTE2KTsKICAgICAgICBpZiAoaWQgPT0gMTUzKSByZXR1cm4gKDEyMiwgMTU1LCAxMjApOwogICAgICAgIGlmIChpZCA9PSAyMTcpIHJldHVybiAoMjM2LCAxNDQsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDEzOSkgcmV0dXJuICgyMDcsIDIyNywgMTQwKTsKICAgICAgICBpZiAoaWQgPT0gMjI5KSByZXR1cm4gKDIyNCwgMTU5LCAxNTApOwogICAgICAgIGlmIChpZCA9PSAxNDEpIHJldHVybiAoMjIwLCAyMDMsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIxMCkgcmV0dXJuICgyMTIsIDEzNywgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gNDUpIHJldHVybiAoMjAyLCAxNzAsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDIwNSkgcmV0dXJuICgxNjEsIDI0MiwgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gNzgpIHJldHVybiAoMjA3LCAxNjcsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDIyNCkgcmV0dXJuICgxOTcsIDE0MSwgMTUwKTsKICAgICAgICBpZiAoaWQgPT0gMTcxKSByZXR1cm4gKDE0NiwgMTQ2LCAyNTApOwogICAgICAgIGlmIChpZCA9PSAxNjQpIHJldHVybiAoMTQ1LCAxNzksIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDE3OCkgcmV0dXJuICgxOTIsIDE0NiwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTk1KSByZXR1cm4gKDE1MiwgMTUyLCAxOTApOwogICAgICAgIGlmIChpZCA9PSAxMDUpIHJldHVybiAoMTQ0LCAyMDAsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDE2MikgcmV0dXJuICgxNDgsIDEzMCwgMTcwKTsKICAgICAgICBpZiAoaWQgPT0gMTY4KSByZXR1cm4gKDE2MSwgMTI4LCAxNDApOwogICAgICAgIGlmIChpZCA9PSAxODQpIHJldHVybiAoMTEyLCAxNTIsIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDE2NikgcmV0dXJuICgxMDcsIDIwOSwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMTAzKSByZXR1cm4gKDIzMywgMTU4LCAxOTApOwogICAgICAgIGlmIChpZCA9PSA4OSkgcmV0dXJuICgxOTAsIDE4NCwgMjEwKTsKICAgICAgICBpZiAoaWQgPT0gOTkpIHJldHVybiAoMjQwLCAyMTQsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDE0MikgcmV0dXJuICgyMjEsIDE2NCwgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gODApIHJldHVybiAoMTc3LCAxOTQsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDkxKSByZXR1cm4gKDE4NiwgMzIzLCAxMDApOwogICAgICAgIGlmIChpZCA9PSAxMTUpIHJldHVybiAoMTgxLCAxNjUsIDIxMCk7CiAgICAgICAgaWYgKGlkID09IDEwNikgcmV0dXJuICgyMjQsIDIxMSwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gNzMpIHJldHVybiAoMTY2LCAyMzcsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDI4KSByZXR1cm4gKDE4MiwgMjAyLCAxNTApOwogICAgICAgIGlmIChpZCA9PSAyNDEpIHJldHVybiAoMTU3LCAyMTEsIDE5MCk7CiAgICAgICAgaWYgKGlkID09IDEyMSkgcmV0dXJuICgyMTAsIDE4NCwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gNTUpIHJldHVybiAoMTkxLCAxNjMsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDEyNikgcmV0dXJuICgyMDYsIDE2OSwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gODIpIHJldHVybiAoMjIzLCAxODIsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDEyNSkgcmV0dXJuICgxOTgsIDE3MywgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTEwKSByZXR1cm4gKDE3NCwgMjIxLCAxMzApOwogICAgICAgIGlmIChpZCA9PSA4NSkgcmV0dXJuICgyMTgsIDE0NSwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gNTcpIHJldHVybiAoMjA3LCAxNDQsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDEwNykgcmV0dXJuICgxOTMsIDIxMiwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gOTcpIHJldHVybiAoMTQ0LCAyMTUsIDE3MCk7CiAgICAgICAgaWYgKGlkID09IDExOSkgcmV0dXJuICgxNzUsIDE1NCwgMTYwKTsKICAgICAgICBpZiAoaWQgPT0gMjI3KSByZXR1cm4gKDE0OCwgMjYwLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMTcpIHJldHVybiAoMTg3LCAxODIsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDQ5KSByZXR1cm4gKDE3OSwgMTUwLCAxNDApOwogICAgICAgIGlmIChpZCA9PSA0MCkgcmV0dXJuICgxNTYsIDkzLCAyODApOwogICAgICAgIGlmIChpZCA9PSAxMDEpIHJldHVybiAoMTczLCAxNzksIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDg3KSByZXR1cm4gKDEzOSwgMTg0LCAxODApOwogICAgICAgIGlmIChpZCA9PSAyMTUpIHJldHVybiAoMTg5LCAxNTcsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDQyKSByZXR1cm4gKDE2MSwgMTUzLCAxNTApOwogICAgICAgIGlmIChpZCA9PSAyMikgcmV0dXJuICgxODIsIDEzNSwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMjA3KSByZXR1cm4gKDE0MywgMjA0LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAyNCkgcmV0dXJuICgxNjcsIDE1OCwgMTIwKTsKICAgICAgICBpZiAoaWQgPT0gOTMpIHJldHVybiAoMjIzLCAxMTIsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gNDcpIHJldHVybiAoMTY1LCAxNDYsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIwKSByZXR1cm4gKDE2MSwgMTQ0LCAxMTApOwogICAgICAgIGlmIChpZCA9PSA1MykgcmV0dXJuICgxNTAsIDEzOSwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTEzKSByZXR1cm4gKDYwLCAxNzYsIDUwMCk7CiAgICAgICAgaWYgKGlkID09IDE5OCkgcmV0dXJuICgxNzUsIDg3LCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1MSkgcmV0dXJuICgxNjcsIDE0NywgNzApOwogICAgICAgIGlmIChpZCA9PSAxMDgpIHJldHVybiAoMTA4LCAxMzcsIDE4MCk7CiAgICAgICAgaWYgKGlkID09IDE5MCkgcmV0dXJuICgxMzYsIDExMiwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gMTU4KSByZXR1cm4gKDExNywgMTE2LCAxMDApOwogICAgICAgIGlmIChpZCA9PSA5NSkgcmV0dXJuICg4NSwgMjg4LCA3MCk7CiAgICAgICAgaWYgKGlkID09IDEpIHJldHVybiAoMTE4LCAxMTgsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gMjI1KSByZXR1cm4gKDEyOCwgOTAsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gNCkgcmV0dXJuICgxMTYsIDk2LCA3OCk7CiAgICAgICAgaWYgKGlkID09IDE1NSkgcmV0dXJuICgxMTYsIDk2LCA3OCk7CiAgICAgICAgaWYgKGlkID09IDcpIHJldHVybiAoOTQsIDEyMiwgODgpOwogICAgICAgIGlmIChpZCA9PSAxNTIpIHJldHVybiAoOTIsIDEyMiwgOTApOwogICAgICAgIGlmIChpZCA9PSAyNSkgcmV0dXJuICgxMTIsIDEwMSwgNzApOwogICAgICAgIGlmIChpZCA9PSAxMzIpIHJldHVybiAoOTEsIDkxLCA5Nik7CiAgICAgICAgaWYgKGlkID09IDY3KSByZXR1cm4gKDE3NywgMTMwLCAxNjApOwogICAgICAgIGlmIChpZCA9PSA2NCkgcmV0dXJuICgyMzIsIDEzOCwgODApOwogICAgICAgIGlmIChpZCA9PSA3NSkgcmV0dXJuICgxNjQsIDE5NiwgMTEwKTsKICAgICAgICBpZiAoaWQgPT0gNzApIHJldHVybiAoMTcyLCA5NSwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTgwKSByZXR1cm4gKDE0NSwgMTEyLCAxNDApOwogICAgICAgIGlmIChpZCA9PSA2MSkgcmV0dXJuICgxMzAsIDEzMCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMzMpIHJldHVybiAoMTM3LCAxMTIsIDEyMik7CiAgICAgICAgaWYgKGlkID09IDMwKSByZXR1cm4gKDExNywgMTI2LCAxNDApOwogICAgICAgIGlmIChpZCA9PSAxNykgcmV0dXJuICgxMTcsIDEwOCwgMTI2KTsKICAgICAgICBpZiAoaWQgPT0gMjAyKSByZXR1cm4gKDYwLCAxMDYsIDM4MCk7CiAgICAgICAgaWYgKGlkID09IDE4OCkgcmV0dXJuICg5MSwgMTI3LCAxMTApOwogICAgICAgIGlmIChpZCA9PSAxMSkgcmV0dXJuICg0NSwgOTQsIDEwMCk7CiAgICAgICAgaWYgKGlkID09IDE0KSByZXR1cm4gKDQ2LCA4NiwgOTApOwogICAgICAgIGlmIChpZCA9PSAyMzUpIHJldHVybiAoNDAsIDg4LCAxMTApOwogICAgICAgIGlmIChpZCA9PSAyMTQpIHJldHVybiAoMjM0LCAxODksIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDEyNykgcmV0dXJuICgyMzgsIDE5NywgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMTI0KSByZXR1cm4gKDIyMywgMTgyLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMjgpIHJldHVybiAoMTk4LCAxOTcsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDEyMykgcmV0dXJuICgyMTgsIDE3MCwgMTQwKTsKICAgICAgICBpZiAoaWQgPT0gMjI2KSByZXR1cm4gKDE0OCwgMjYwLCAxMzApOwogICAgICAgIGlmIChpZCA9PSAyMzQpIHJldHVybiAoMTkyLCAxMzIsIDE0Nik7CiAgICAgICAgaWYgKGlkID09IDEyMikgcmV0dXJuICgxOTIsIDIzMywgODApOwogICAgICAgIGlmIChpZCA9PSAyMTEpIHJldHVybiAoMTg0LCAxNDgsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDIwMykgcmV0dXJuICgxODIsIDEzMywgMTQwKTsKICAgICAgICBpZiAoaWQgPT0gMjAwKSByZXR1cm4gKDE2NywgMTY3LCAxMjApOwogICAgICAgIGlmIChpZCA9PSAyMDYpIHJldHVybiAoMTMxLCAxMzEsIDIwMCk7CiAgICAgICAgaWYgKGlkID09IDQ0KSByZXR1cm4gKDE1MywgMTM5LCAxMjApOwogICAgICAgIGlmIChpZCA9PSAxOTMpIHJldHVybiAoMTU0LCA5NCwgMTMwKTsKICAgICAgICBpZiAoaWQgPT0gMjIyKSByZXR1cm4gKDExOCwgMTU2LCAxMTApOwogICAgICAgIGlmIChpZCA9PSA1OCkgcmV0dXJuICgxMzYsIDk2LCAxMTApOwogICAgICAgIGlmIChpZCA9PSA4MykgcmV0dXJuICgxMjQsIDExOCwgMTA0KTsKICAgICAgICBpZiAoaWQgPT0gMzUpIHJldHVybiAoMTA3LCAxMTYsIDE0MCk7CiAgICAgICAgaWYgKGlkID09IDIwMSkgcmV0dXJuICgxMzYsIDkxLCA5Nik7CiAgICAgICAgaWYgKGlkID09IDM3KSByZXR1cm4gKDk2LCAxMjIsIDc2KTsKICAgICAgICBpZiAoaWQgPT0gMjE4KSByZXR1cm4gKDExOCwgNzEsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMjIwKSByZXR1cm4gKDkwLCA3NCwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMjEzKSByZXR1cm4gKDE3LCAzOTYsIDQwKTsKICAgICAgICBpZiAoaWQgPT0gMTE0KSByZXR1cm4gKDE4MywgMjA1LCAxMzApOwogICAgICAgIGlmIChpZCA9PSAxMzcpIHJldHVybiAoMTUzLCAxMzksIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDc3KSByZXR1cm4gKDE3MCwgMTMyLCAxMDApOwogICAgICAgIGlmIChpZCA9PSAxMzgpIHJldHVybiAoMTU1LCAxNzQsIDcwKTsKICAgICAgICBpZiAoaWQgPT0gMTQwKSByZXR1cm4gKDE0OCwgMTYyLCA2MCk7CiAgICAgICAgaWYgKGlkID09IDIwOSkgcmV0dXJuICgxMzcsIDg5LCAxMjApOwogICAgICAgIGlmIChpZCA9PSAyMjgpIHJldHVybiAoMTUyLCA5MywgOTApOwogICAgICAgIGlmIChpZCA9PSAxNzApIHJldHVybiAoMTA2LCAxMDYsIDE1MCk7CiAgICAgICAgaWYgKGlkID09IDIwNCkgcmV0dXJuICgxMDgsIDE0NiwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gOTIpIHJldHVybiAoMTg2LCA3MCwgNjApOwogICAgICAgIGlmIChpZCA9PSAxMzMpIHJldHVybiAoMTA0LCAxMjEsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDEwNCkgcmV0dXJuICg5MCwgMTY1LCAxMDApOwogICAgICAgIGlmIChpZCA9PSAxNzcpIHJldHVybiAoMTM0LCA4OSwgODApOwogICAgICAgIGlmIChpZCA9PSAyNDYpIHJldHVybiAoMTE1LCA5MywgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gMTQ3KSByZXR1cm4gKDExOSwgOTQsIDgyKTsKICAgICAgICBpZiAoaWQgPT0gNDYpIHJldHVybiAoMTIxLCA5OSwgNzApOwogICAgICAgIGlmIChpZCA9PSAxOTQpIHJldHVybiAoNzUsIDc1LCAxMTApOwogICAgICAgIGlmIChpZCA9PSAxMTEpIHJldHVybiAoMTQwLCAxNTcsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDk4KSByZXR1cm4gKDE4MSwgMTU2LCA2MCk7CiAgICAgICAgaWYgKGlkID09IDg4KSByZXR1cm4gKDEzNSwgOTAsIDE2MCk7CiAgICAgICAgaWYgKGlkID09IDc5KSByZXR1cm4gKDEwOSwgMTA5LCAxODApOwogICAgICAgIGlmIChpZCA9PSA2NikgcmV0dXJuICgxMzcsIDg4LCAxNDApOwogICAgICAgIGlmIChpZCA9PSAyNykgcmV0dXJuICgxMjYsIDE0NSwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gNzQpIHJldHVybiAoMTMyLCAxNjMsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMjE2KSByZXR1cm4gKDE0MiwgOTMsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDIzMSkgcmV0dXJuICgxMDcsIDEwNywgMTgwKTsKICAgICAgICBpZiAoaWQgPT0gNjMpIHJldHVybiAoMTk1LCAxMDMsIDUwKTsKICAgICAgICBpZiAoaWQgPT0gMTAyKSByZXR1cm4gKDEwNywgMTQwLCAxMjApOwogICAgICAgIGlmIChpZCA9PSAxMDkpIHJldHVybiAoMTE5LCAxNjQsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gODEpIHJldHVybiAoMTY1LCAxMjgsIDUwKTsKICAgICAgICBpZiAoaWQgPT0gODQpIHJldHVybiAoMTU4LCA4OCwgNzApOwogICAgICAgIGlmIChpZCA9PSAxMTgpIHJldHVybiAoMTIzLCAxMTUsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gNTYpIHJldHVybiAoMTQ4LCA4NywgODApOwogICAgICAgIGlmIChpZCA9PSA5NikgcmV0dXJuICg4OSwgMTU4LCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1NCkgcmV0dXJuICgxMjIsIDk2LCAxMDApOwogICAgICAgIGlmIChpZCA9PSA5MCkgcmV0dXJuICgxMTYsIDE2OCwgNjApOwogICAgICAgIGlmIChpZCA9PSA3MikgcmV0dXJuICg5NywgMTgyLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDEyMCkgcmV0dXJuICgxMzcsIDExMiwgNjApOwogICAgICAgIGlmIChpZCA9PSAxMTYpIHJldHVybiAoMTI5LCAxMjUsIDYwKTsKICAgICAgICBpZiAoaWQgPT0gNjkpIHJldHVybiAoMTM5LCA2NCwgMTAwKTsKICAgICAgICBpZiAoaWQgPT0gNDgpIHJldHVybiAoMTAwLCAxMDIsIDEyMCk7CiAgICAgICAgaWYgKGlkID09IDg2KSByZXR1cm4gKDg1LCAxMjgsIDEzMCk7CiAgICAgICAgaWYgKGlkID09IDE3OSkgcmV0dXJuICgxMTQsIDgyLCAxMTApOwogICAgICAgIGlmIChpZCA9PSAxMDApIHJldHVybiAoMTA5LCAxMTQsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMjMpIHJldHVybiAoMTEwLCAxMDIsIDcwKTsKICAgICAgICBpZiAoaWQgPT0gMjIzKSByZXR1cm4gKDEyNywgNjksIDcwKTsKICAgICAgICBpZiAoaWQgPT0gMzIpIHJldHVybiAoMTA1LCA3NiwgOTIpOwogICAgICAgIGlmIChpZCA9PSAyOSkgcmV0dXJuICg4NiwgOTQsIDExMCk7CiAgICAgICAgaWYgKGlkID09IDM5KSByZXR1cm4gKDgwLCA0NCwgMjMwKTsKICAgICAgICBpZiAoaWQgPT0gNjApIHJldHVybiAoMTAxLCA4MiwgODApOwogICAgICAgIGlmIChpZCA9PSAxNjcpIHJldHVybiAoMTA1LCA3MywgODApOwogICAgICAgIGlmIChpZCA9PSAyMSkgcmV0dXJuICgxMTIsIDYxLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDE2NSkgcmV0dXJuICg3MiwgMTQyLCA4MCk7CiAgICAgICAgaWYgKGlkID09IDE2MykgcmV0dXJuICg2NywgMTAxLCAxMjApOwogICAgICAgIGlmIChpZCA9PSA1MikgcmV0dXJuICg5MiwgODEsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTkpIHJldHVybiAoMTAzLCA3MCwgNjApOwogICAgICAgIGlmIChpZCA9PSAxNikgcmV0dXJuICg4NSwgNzYsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gNDEpIHJldHVybiAoODMsIDc2LCA4MCk7CiAgICAgICAgaWYgKGlkID09IDE2MSkgcmV0dXJuICg3OSwgNzcsIDcwKTsKICAgICAgICBpZiAoaWQgPT0gMTg3KSByZXR1cm4gKDY3LCAxMDEsIDcwKTsKICAgICAgICBpZiAoaWQgPT0gNTApIHJldHVybiAoMTA5LCA4OCwgMjApOwogICAgICAgIGlmIChpZCA9PSAxODMpIHJldHVybiAoMzcsIDkzLCAxNDApOwogICAgICAgIGlmIChpZCA9PSAxMykgcmV0dXJuICg2MywgNTUsIDgwKTsKICAgICAgICBpZiAoaWQgPT0gMTApIHJldHVybiAoNTUsIDYyLCA5MCk7CiAgICAgICAgaWYgKGlkID09IDE5MSkgcmV0dXJuICg1NSwgNTUsIDYwKTsKICAgICAgICBpZiAoaWQgPT0gNDMpIHJldHVybiAoMTMxLCAxMTYsIDkwKTsKICAgICAgICBpZiAoaWQgPT0gMTI5KSByZXR1cm4gKDI5LCAxMDIsIDQwKTsKICAgICAgICByZXR1cm4gKDAsIDAsIDApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzcXJ0KHVpbnQyNTYgeCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2IHkpIHsKICAgICAgICB1aW50MjU2IHogPSAoeCArIDEpIC8gMjsKICAgICAgICB5ID0geDsKICAgICAgICB3aGlsZSAoeiA8IHkpIHsKICAgICAgICAgICAgeSA9IHo7CiAgICAgICAgICAgIHogPSAoeCAvIHogKyB6KSAvIDI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1heENQKHVpbnQyNTYgZ2VuZXMsIHVpbnQxNiBnZW5lcmF0aW9uKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MzIgbWF4X2NwKSB7CiAgICAgICAgdmFyIGNvZGUgPSB1aW50OChnZW5lcyAmIDB4RkYpOwogICAgICAgIHZhciBhID0gdWludDMyKChnZW5lcyA+PiA4KSAmIDB4RkYpOwogICAgICAgIHZhciBkID0gdWludDMyKChnZW5lcyA+PiAxNikgJiAweEZGKTsKICAgICAgICB2YXIgcyA9IHVpbnQzMigoZ2VuZXMgPj4gMjQpICYgMHhGRik7Ci8vICAgICAgdmFyIGdlbmRlciA9IHVpbnQzMigoZ2VuZXMgPj4gMzIpICYgMHgxKTsKICAgICAgICB2YXIgYmdDb2xvciA9IHVpbnQ4KChnZW5lcyA+PiAzMykgJiAweEZGKTsKICAgICAgICB2YXIgKHJhLCByZCwgcnMpID0gZ2V0QmFzZVN0YXRzKGNvZGUpOwoKCiAgICAgICAgbWF4X2NwID0gdWludDMyKHNxcnQodWludDI1NihyYSArIGEpICogdWludDI1NihyYSArIGEpICogdWludDI1NihyZCArIGQpICogdWludDI1NihycyArIHMpICogMzkwMDkyNzkzODk5MzI4MS8xMDAwMDAwMDAwMDAwMDAwMCAvIDEwMCkpOwogICAgICAgIGlmKG1heF9jcCA8IDEwKQogICAgICAgICAgICBtYXhfY3AgPSAxMDsKCiAgICAgICAgaWYoZ2VuZXJhdGlvbiA8IDEwKQogICAgICAgICAgICBtYXhfY3AgKz0gKDEwIC0gZ2VuZXJhdGlvbikgKiA1MDsKCiAgICAgICAgLy8gYmdDb2xvcgogICAgICAgIGlmKGJnQ29sb3IgPj0gOCkKICAgICAgICAgICAgYmdDb2xvciA9IDA7CgogICAgICAgIG1heF9jcCArPSBiZ0NvbG9yICogMjU7CiAgICAgICAgcmV0dXJuIG1heF9jcDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlKHVpbnQyNTYgZ2VuZXMpIHB1cmUgcHVibGljIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIHVpbnQ4KGdlbmVzICYgMHhGRik7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXR0YWNrKHVpbnQyNTYgZ2VuZXMpIHB1cmUgcHVibGljIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIHVpbnQ4KChnZW5lcyA+PiA4KSAmIDB4RkYpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldERlZmVuc2UodWludDI1NiBnZW5lcykgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gdWludDgoKGdlbmVzID4+IDE2KSAmIDB4RkYpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFN0YW1pbmEodWludDI1NiBnZW5lcykgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gdWludDgoKGdlbmVzID4+IDI0KSAmIDB4RkYpOwogICAgfQoKICAgIC8vLyBAZGV2IGdpdmVuIGdlbmVzIG9mIGtpdHRlbiAxICYgMiwgcmV0dXJuIGEgZ2VuZXRpYyBjb21iaW5hdGlvbiAtIG1heSBoYXZlIGEgcmFuZG9tIGZhY3RvcgogICAgLy8vIEBwYXJhbSBnZW5lczEgZ2VuZXMgb2YgbW9tCiAgICAvLy8gQHBhcmFtIGdlbmVzMiBnZW5lcyBvZiBzaXJlCiAgICAvLy8gQHJldHVybiB0aGUgZ2VuZXMgdGhhdCBhcmUgc3VwcG9zZWQgdG8gYmUgcGFzc2VkIGRvd24gdGhlIGNoaWxkCiAgICBmdW5jdGlvbiBtaXhHZW5lcyh1aW50MjU2IGdlbmVzMSwgdWludDI1NiBnZW5lczIsIHVpbnQyNTYgdGFyZ2V0QmxvY2spIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgogICAgICAgIHVpbnQ4IGNvZGU7CiAgICAgICAgdmFyIHIgPSByYW5kb20oMTApOwoKICAgICAgICAvLyAyMCUgcGVyY2VudCBvZiBwYXJlbnRzIEROQQogICAgICAgIGlmKHIgPT0gMCkKICAgICAgICAgICAgY29kZSA9IGdldENvZGUoZ2VuZXMxKTsKICAgICAgICBlbHNlIGlmKHIgPT0gMSkKICAgICAgICAgICAgY29kZSA9IGdldENvZGUoZ2VuZXMyKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNvZGUgPSByYW5kb21Db2RlKCk7CgogICAgICAgIC8vIDcwJSBwZXJjZW50IG9mIHBhcmVudHMgRE5BCiAgICAgICAgdmFyIGF0dGFjayA9IHJhbmRvbSgzKSA9PSAwID8gdWludDgocmFuZG9tKDMyKSkgOiB1aW50OChyYW5kb21CZXR3ZWVuKGdldEF0dGFjayhnZW5lczEpLCBnZXRBdHRhY2soZ2VuZXMyKSkpOwogICAgICAgIHZhciBkZWZlbnNlID0gcmFuZG9tKDMpID09IDAgPyB1aW50OChyYW5kb20oMzIpKSA6IHVpbnQ4KHJhbmRvbUJldHdlZW4oZ2V0RGVmZW5zZShnZW5lczEpLCBnZXREZWZlbnNlKGdlbmVzMikpKTsKICAgICAgICB2YXIgc3RhbWluYSA9IHJhbmRvbSgzKSA9PSAwID8gdWludDgocmFuZG9tKDMyKSkgOiB1aW50OChyYW5kb21CZXR3ZWVuKGdldFN0YW1pbmEoZ2VuZXMxKSwgZ2V0U3RhbWluYShnZW5lczIpKSk7CiAgICAgICAgdmFyIGdlbmRlciA9IHVpbnQ4KHJhbmRvbSgyKSk7CiAgICAgICAgdmFyIGJnQ29sb3IgPSB1aW50OChyYW5kb20oOCkpOwogICAgICAgIHZhciByYW5kID0gcmFuZG9tKH51aW50NjQoMCkpOwoKICAgICAgICByZXR1cm4gdWludDI1Nihjb2RlKSAvLyA4CiAgICAgICAgfCAodWludDI1NihhdHRhY2spIDw8IDgpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KGRlZmVuc2UpIDw8IDE2KSAvLyA4CiAgICAgICAgfCAodWludDI1NihzdGFtaW5hKSA8PCAyNCkgLy8gOAogICAgICAgIHwgKHVpbnQyNTYoZ2VuZGVyKSA8PCAzMikgLy8gMQogICAgICAgIHwgKHVpbnQyNTYoYmdDb2xvcikgPDwgMzMpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KHJhbmQpIDw8IDQxKSAvLyA2NAogICAgICAgIDsKICAgIH0KCiAgICBmdW5jdGlvbiByYW5kb21HZW5lcygpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdmFyIGNvZGUgPSByYW5kb21Db2RlKCk7CiAgICAgICAgdmFyIGF0dGFjayA9IHVpbnQ4KHJhbmRvbSgzMikpOwogICAgICAgIHZhciBkZWZlbnNlID0gdWludDgocmFuZG9tKDMyKSk7CiAgICAgICAgdmFyIHN0YW1pbmEgPSB1aW50OChyYW5kb20oMzIpKTsKICAgICAgICB2YXIgZ2VuZGVyID0gdWludDgocmFuZG9tKDIpKTsKICAgICAgICB2YXIgYmdDb2xvciA9IHVpbnQ4KHJhbmRvbSg4KSk7CiAgICAgICAgdmFyIHJhbmQgPSByYW5kb20ofnVpbnQ2NCgwKSk7CgogICAgICAgIHJldHVybiB1aW50MjU2KGNvZGUpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KGF0dGFjaykgPDwgOCkgLy8gOAogICAgICAgIHwgKHVpbnQyNTYoZGVmZW5zZSkgPDwgMTYpIC8vIDgKICAgICAgICB8ICh1aW50MjU2KHN0YW1pbmEpIDw8IDI0KSAvLyA4CiAgICAgICAgfCAodWludDI1NihnZW5kZXIpIDw8IDMyKSAvLyAxCiAgICAgICAgfCAodWludDI1NihiZ0NvbG9yKSA8PCAzMykgLy8gOAogICAgICAgIHwgKHVpbnQyNTYocmFuZCkgPDwgNDEpIC8vIDY0CiAgICAgICAgOwogICAgfQp9CgovLy8gQHRpdGxlIENsb2NrIGF1Y3Rpb24gbW9kaWZpZWQgZm9yIHNhbGUgb2YgbW9uc3RlcnMKLy8vIEBub3RpY2UgV2Ugb21pdCBhIGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBzZW5kcyB0byB0aGlzIGNvbnRyYWN0Lgpjb250cmFjdCBTYWxlQ2xvY2tBdWN0aW9uIGlzIENsb2NrQXVjdGlvbiB7CgogICAgLy8gQGRldiBTYW5pdHkgY2hlY2sgdGhhdCBhbGxvd3MgdXMgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIHBvaW50aW5nIHRvIHRoZQogICAgLy8gIHJpZ2h0IGF1Y3Rpb24gaW4gb3VyIHNldFNhbGVBdWN0aW9uQWRkcmVzcygpIGNhbGwuCiAgICBib29sIHB1YmxpYyBpc1NhbGVDbG9ja0F1Y3Rpb24gPSB0cnVlOwoKICAgIC8vIFRyYWNrcyBsYXN0IDUgc2FsZSBwcmljZSBvZiBnZW4wIG1vbnN0ZXIgc2FsZXMKICAgIHVpbnQyNTYgcHVibGljIGdlbjBTYWxlQ291bnQ7CiAgICB1aW50MjU2WzVdIHB1YmxpYyBsYXN0R2VuMFNhbGVQcmljZXM7CgogICAgLy8gRGVsZWdhdGUgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNhbGVDbG9ja0F1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkciwgdWludDI1NiBfY3V0KSBwdWJsaWMKICAgIENsb2NrQXVjdGlvbihfbmZ0QWRkciwgX2N1dCkge30KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgYXVjdGlvbiAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdGhhdCBubyBpbnB1dHMgb3ZlcmZsb3cgaG93IG1hbnkgYml0cyB3ZSd2ZSBhbGxvY2F0ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpOwogICAgICAgIF9lc2Nyb3coX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIGxhc3RTYWxlUHJpY2UgaWYgc2VsbGVyIGlzIHRoZSBuZnQgY29udHJhY3QKICAgIC8vLyBPdGhlcndpc2UsIHdvcmtzIHRoZSBzYW1lIGFzIGRlZmF1bHQgYmlkIG1ldGhvZC4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHsKICAgICAgICAvLyBfYmlkIHZlcmlmaWVzIHRva2VuIElEIHNpemUKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICB1aW50MjU2IHByaWNlID0gX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwoKICAgICAgICAvLyBJZiBub3QgYSBnZW4wIGF1Y3Rpb24sIGV4aXQKICAgICAgICBpZiAoc2VsbGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpIHsKICAgICAgICAgICAgLy8gVHJhY2sgZ2VuMCBzYWxlIHByaWNlcwogICAgICAgICAgICBsYXN0R2VuMFNhbGVQcmljZXNbZ2VuMFNhbGVDb3VudCAlIDVdID0gcHJpY2U7CiAgICAgICAgICAgIGdlbjBTYWxlQ291bnQrKzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXZlcmFnZUdlbjBTYWxlUHJpY2UoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBsYXN0R2VuMFNhbGVQcmljZXNbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdW0gLyA1OwogICAgfQoKfQoKLy8vIEB0aXRsZSBSZXZlcnNlIGF1Y3Rpb24gbW9kaWZpZWQgZm9yIHNpcmluZwovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IFNpcmluZ0Nsb2NrQXVjdGlvbiBpcyBDbG9ja0F1Y3Rpb24gewoKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vICByaWdodCBhdWN0aW9uIGluIG91ciBzZXRTaXJpbmdBdWN0aW9uQWRkcmVzcygpIGNhbGwuCiAgICBib29sIHB1YmxpYyBpc1NpcmluZ0Nsb2NrQXVjdGlvbiA9IHRydWU7CgogICAgLy8gRGVsZWdhdGUgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNpcmluZ0Nsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyLCB1aW50MjU2IF9jdXQpIHB1YmxpYwogICAgQ2xvY2tBdWN0aW9uKF9uZnRBZGRyLCBfY3V0KSB7fQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYW5kIGJlZ2lucyBhIG5ldyBhdWN0aW9uLiBTaW5jZSB0aGlzIGZ1bmN0aW9uIGlzIHdyYXBwZWQsCiAgICAvLy8gcmVxdWlyZSBzZW5kZXIgdG8gYmUgTW9uc3RlckNvcmUgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIGF1Y3Rpb24gKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgUGxhY2VzIGEgYmlkIGZvciBzaXJpbmcuIFJlcXVpcmVzIHRoZSBzZW5kZXIKICAgIC8vLyBpcyB0aGUgTW9uc3RlckNvcmUgY29udHJhY3QgYmVjYXVzZSBhbGwgYmlkIG1ldGhvZHMKICAgIC8vLyBzaG91bGQgYmUgd3JhcHBlZC4gQWxzbyByZXR1cm5zIHRoZSBtb25zdGVyIHRvIHRoZQogICAgLy8vIHNlbGxlciByYXRoZXIgdGhhbiB0aGUgd2lubmVyLgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgcGF5YWJsZQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICAvLyBfYmlkIGNoZWNrcyB0aGF0IHRva2VuIElEIGlzIHZhbGlkIGFuZCB3aWxsIHRocm93IGlmIGJpZCBmYWlscwogICAgICAgIF9iaWQoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgLy8gV2UgdHJhbnNmZXIgdGhlIG1vbnN0ZXIgYmFjayB0byB0aGUgc2VsbGVyLCB0aGUgd2lubmVyIHdpbGwgZ2V0CiAgICAgICAgLy8gdGhlIG9mZnNwcmluZwogICAgICAgIF90cmFuc2ZlcihzZWxsZXIsIF90b2tlbklkKTsKICAgIH0KCn0KCgoKCgoKCi8vLyBAdGl0bGUgQSBmYWNldCBvZiBNb25zdGVyQ29yZSB0aGF0IG1hbmFnZXMgc3BlY2lhbCBhY2Nlc3MgcHJpdmlsZWdlcy4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgU2VlIHRoZSBNb25zdGVyQ29yZSBjb250cmFjdCBkb2N1bWVudGF0aW9uIHRvIHVuZGVyc3RhbmQgaG93IHRoZSB2YXJpb3VzIGNvbnRyYWN0IGZhY2V0cyBhcmUgYXJyYW5nZWQuCmNvbnRyYWN0IE1vbnN0ZXJBY2Nlc3NDb250cm9sIHsKICAgIC8vIFRoaXMgZmFjZXQgY29udHJvbHMgYWNjZXNzIGNvbnRyb2wgZm9yIENyeXB0b01vbnN0ZXJzLiBUaGVyZSBhcmUgZm91ciByb2xlcyBtYW5hZ2VkIGhlcmU6CiAgICAvLwogICAgLy8gICAgIC0gVGhlIENFTzogVGhlIENFTyBjYW4gcmVhc3NpZ24gb3RoZXIgcm9sZXMgYW5kIGNoYW5nZSB0aGUgYWRkcmVzc2VzIG9mIG91ciBkZXBlbmRlbnQgc21hcnQKICAgIC8vICAgICAgICAgY29udHJhY3RzLiBJdCBpcyBhbHNvIHRoZSBvbmx5IHJvbGUgdGhhdCBjYW4gdW5wYXVzZSB0aGUgc21hcnQgY29udHJhY3QuIEl0IGlzIGluaXRpYWxseQogICAgLy8gICAgICAgICBzZXQgdG8gdGhlIGFkZHJlc3MgdGhhdCBjcmVhdGVkIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgTW9uc3RlckNvcmUgY29uc3RydWN0b3IuCiAgICAvLwogICAgLy8gICAgIC0gVGhlIENGTzogVGhlIENGTyBjYW4gd2l0aGRyYXcgZnVuZHMgZnJvbSBNb25zdGVyQ29yZSBhbmQgaXRzIGF1Y3Rpb24gY29udHJhY3RzLgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDT086IFRoZSBDT08gY2FuIHJlbGVhc2UgZ2VuMCBtb25zdGVycyB0byBhdWN0aW9uLCBhbmQgbWludCBwcm9tbyBtb25zdGVycy4KICAgIC8vCiAgICAvLyBJdCBzaG91bGQgYmUgbm90ZWQgdGhhdCB0aGVzZSByb2xlcyBhcmUgZGlzdGluY3Qgd2l0aG91dCBvdmVybGFwIGluIHRoZWlyIGFjY2VzcyBhYmlsaXRpZXMsIHRoZQogICAgLy8gYWJpbGl0aWVzIGxpc3RlZCBmb3IgZWFjaCByb2xlIGFib3ZlIGFyZSBleGhhdXN0aXZlLiBJbiBwYXJ0aWN1bGFyLCB3aGlsZSB0aGUgQ0VPIGNhbiBhc3NpZ24gYW55CiAgICAvLyBhZGRyZXNzIHRvIGFueSByb2xlLCB0aGUgQ0VPIGFkZHJlc3MgaXRzZWxmIGRvZXNuJ3QgaGF2ZSB0aGUgYWJpbGl0eSB0byBhY3QgaW4gdGhvc2Ugcm9sZXMuIFRoaXMKICAgIC8vIHJlc3RyaWN0aW9uIGlzIGludGVudGlvbmFsIHNvIHRoYXQgd2UgYXJlbid0IHRlbXB0ZWQgdG8gdXNlIHRoZSBDRU8gYWRkcmVzcyBmcmVxdWVudGx5IG91dCBvZgogICAgLy8gY29udmVuaWVuY2UuIFRoZSBsZXNzIHdlIHVzZSBhbiBhZGRyZXNzLCB0aGUgbGVzcyBsaWtlbHkgaXQgaXMgdGhhdCB3ZSBzb21laG93IGNvbXByb21pc2UgdGhlCiAgICAvLyBhY2NvdW50LgoKICAgIC8vLyBAZGV2IEVtaXRlZCB3aGVuIGNvbnRyYWN0IGlzIHVwZ3JhZGVkIC0gU2VlIFJFQURNRS5tZCBmb3IgdXBkZ3JhZGUgcGxhbgogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwoKICAgIC8vIFRoZSBhZGRyZXNzZXMgb2YgdGhlIGFjY291bnRzIChvciBjb250cmFjdHMpIHRoYXQgY2FuIGV4ZWN1dGUgYWN0aW9ucyB3aXRoaW4gZWFjaCByb2xlcy4KICAgIGFkZHJlc3MgcHVibGljIGNlb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjZm9BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgY29vQWRkcmVzczsKCiAgICAvLyBAZGV2IEtlZXBzIHRyYWNrIHdoZXRoZXIgdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4gV2hlbiB0aGF0IGlzIHRydWUsIG1vc3QgYWN0aW9ucyBhcmUgYmxvY2tlZAogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDRU8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5Q0VPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0ZPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNGTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2ZvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENPTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDT08oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNMZXZlbCgpIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY2ZvQWRkcmVzcwogICAgICAgICk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDRU8uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENFTy4KICAgIC8vLyBAcGFyYW0gX25ld0NFTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENFTwogICAgZnVuY3Rpb24gc2V0Q0VPKGFkZHJlc3MgX25ld0NFTykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShfbmV3Q0VPICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjZW9BZGRyZXNzID0gX25ld0NFTzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDRk8uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENFTy4KICAgIC8vLyBAcGFyYW0gX25ld0NGTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENGTwogICAgZnVuY3Rpb24gc2V0Q0ZPKGFkZHJlc3MgX25ld0NGTykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShfbmV3Q0ZPICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjZm9BZGRyZXNzID0gX25ld0NGTzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIHRoZSBDT08uIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBjdXJyZW50IENFTy4KICAgIC8vLyBAcGFyYW0gX25ld0NPTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENPTwogICAgZnVuY3Rpb24gc2V0Q09PKGFkZHJlc3MgX25ld0NPTykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgcmVxdWlyZShfbmV3Q09PICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjb29BZGRyZXNzID0gX25ld0NPTzsKICAgIH0KCiAgICAvKioqIFBhdXNhYmxlIGZ1bmN0aW9uYWxpdHkgYWRhcHRlZCBmcm9tIE9wZW5aZXBwZWxpbiAqKiovCgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQKICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgICAgIHJlcXVpcmUocGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGxlZCBieSBhbnkgIkMtbGV2ZWwiIHJvbGUgdG8gcGF1c2UgdGhlIGNvbnRyYWN0LiBVc2VkIG9ubHkgd2hlbgogICAgLy8vICBhIGJ1ZyBvciBleHBsb2l0IGlzIGRldGVjdGVkIGFuZCB3ZSBuZWVkIHRvIGxpbWl0IGRhbWFnZS4KICAgIGZ1bmN0aW9uIHBhdXNlKCkgZXh0ZXJuYWwgb25seUNMZXZlbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFVucGF1c2VzIHRoZSBzbWFydCBjb250cmFjdC4gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBDRU8sIHNpbmNlCiAgICAvLy8gIG9uZSByZWFzb24gd2UgbWF5IHBhdXNlIHRoZSBjb250cmFjdCBpcyB3aGVuIENGTyBvciBDT08gYWNjb3VudHMgYXJlCiAgICAvLy8gIGNvbXByb21pc2VkLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gaXQgY2FuIGJlIGNhbGxlZCBieQogICAgLy8vICBkZXJpdmVkIGNvbnRyYWN0cy4KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICAvLyBjYW4ndCB1bnBhdXNlIGlmIGNvbnRyYWN0IHdhcyB1cGdyYWRlZAogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgfQp9CgoKCgovLy8gQHRpdGxlIEJhc2UgY29udHJhY3QgZm9yIENyeXB0b01vbnN0ZXJzLiBIb2xkcyBhbGwgY29tbW9uIHN0cnVjdHMsIGV2ZW50cyBhbmQgYmFzZSB2YXJpYWJsZXMuCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFNlZSB0aGUgTW9uc3RlckNvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBNb25zdGVyQmFzZSBpcyBNb25zdGVyQWNjZXNzQ29udHJvbCB7CiAgICAvKioqIEVWRU5UUyAqKiovCgogICAgLy8vIEBkZXYgVGhlIEJpcnRoIGV2ZW50IGlzIGZpcmVkIHdoZW5ldmVyIGEgbmV3IG1vbnN0ZXIgY29tZXMgaW50byBleGlzdGVuY2UuIFRoaXMgb2J2aW91c2x5CiAgICAvLy8gIGluY2x1ZGVzIGFueSB0aW1lIGEgbW9uc3RlciBpcyBjcmVhdGVkIHRocm91Z2ggdGhlIGdpdmVCaXJ0aCBtZXRob2QsIGJ1dCBpdCBpcyBhbHNvIGNhbGxlZAogICAgLy8vICB3aGVuIGEgbmV3IGdlbjAgbW9uc3RlciBpcyBjcmVhdGVkLgogICAgZXZlbnQgQmlydGgoYWRkcmVzcyBvd25lciwgdWludDI1NiBtb25zdGVySWQsIHVpbnQyNTYgbWF0cm9uSWQsIHVpbnQyNTYgc2lyZUlkLCB1aW50MjU2IGdlbmVzLCB1aW50MTYgZ2VuZXJhdGlvbik7CgogICAgLy8vIEBkZXYgVHJhbnNmZXIgZXZlbnQgYXMgZGVmaW5lZCBpbiBjdXJyZW50IGRyYWZ0IG9mIEVSQzcyMS4gRW1pdHRlZCBldmVyeSB0aW1lIGEgbW9uc3RlcgogICAgLy8vICBvd25lcnNoaXAgaXMgYXNzaWduZWQsIGluY2x1ZGluZyBiaXJ0aHMuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLyoqKiBEQVRBIFRZUEVTICoqKi8KCiAgICAvLy8gQGRldiBUaGUgbWFpbiBNb25zdGVyIHN0cnVjdC4gRXZlcnkgbW9uc3RlciBpbiBDcnlwdG9Nb25zdGVycyBpcyByZXByZXNlbnRlZCBieSBhIGNvcHkKICAgIC8vLyAgb2YgdGhpcyBzdHJ1Y3R1cmUsIHNvIGdyZWF0IGNhcmUgd2FzIHRha2VuIHRvIGVuc3VyZSB0aGF0IGl0IGZpdHMgbmVhdGx5IGludG8KICAgIC8vLyAgZXhhY3RseSB0d28gMjU2LWJpdCB3b3Jkcy4gTm90ZSB0aGF0IHRoZSBvcmRlciBvZiB0aGUgbWVtYmVycyBpbiB0aGlzIHN0cnVjdHVyZQogICAgLy8vICBpcyBpbXBvcnRhbnQgYmVjYXVzZSBvZiB0aGUgYnl0ZS1wYWNraW5nIHJ1bGVzIHVzZWQgYnkgRXRoZXJldW0uCiAgICAvLy8gIFJlZjogaHR0cDovL3NvbGlkaXR5LnJlYWR0aGVkb2NzLmlvL2VuL2RldmVsb3AvbWlzY2VsbGFuZW91cy5odG1sCiAgICBzdHJ1Y3QgTW9uc3RlciB7CiAgICAgICAgLy8gVGhlIE1vbnN0ZXIncyBnZW5ldGljIGNvZGUgaXMgcGFja2VkIGludG8gdGhlc2UgMjU2LWJpdHMsIHRoZSBmb3JtYXQgaXMKICAgICAgICAvLyBzb29wZXItc2VrcmV0ISBBIG1vbnN0ZXIncyBnZW5lcyBuZXZlciBjaGFuZ2UuCiAgICAgICAgdWludDI1NiBnZW5lczsKCiAgICAgICAgLy8gVGhlIHRpbWVzdGFtcCBmcm9tIHRoZSBibG9jayB3aGVuIHRoaXMgbW9uc3RlciBjYW1lIGludG8gZXhpc3RlbmNlLgogICAgICAgIHVpbnQ2NCBiaXJ0aFRpbWU7CgogICAgICAgIC8vIFRoZSBtaW5pbXVtIHRpbWVzdGFtcCBhZnRlciB3aGljaCB0aGlzIG1vbnN0ZXIgY2FuIGVuZ2FnZSBpbiBicmVlZGluZwogICAgICAgIC8vIGFjdGl2aXRpZXMgYWdhaW4uIFRoaXMgc2FtZSB0aW1lc3RhbXAgaXMgdXNlZCBmb3IgdGhlIHByZWduYW5jeQogICAgICAgIC8vIHRpbWVyIChmb3IgbWF0cm9ucykgYXMgd2VsbCBhcyB0aGUgc2lyaW5nIGNvb2xkb3duLgogICAgICAgIHVpbnQ2NCBjb29sZG93bkVuZEJsb2NrOwoKICAgICAgICAvLyBUaGUgSUQgb2YgdGhlIHBhcmVudHMgb2YgdGhpcyBtb25zdGVyLCBzZXQgdG8gMCBmb3IgZ2VuMCBtb25zdGVycy4KICAgICAgICAvLyBOb3RlIHRoYXQgdXNpbmcgMzItYml0IHVuc2lnbmVkIGludGVnZXJzIGxpbWl0cyB1cyB0byBhICJtZXJlIgogICAgICAgIC8vIDQgYmlsbGlvbiBtb25zdGVycy4gVGhpcyBudW1iZXIgbWlnaHQgc2VlbSBzbWFsbCB1bnRpbCB5b3UgcmVhbGl6ZQogICAgICAgIC8vIHRoYXQgRXRoZXJldW0gY3VycmVudGx5IGhhcyBhIGxpbWl0IG9mIGFib3V0IDUwMCBtaWxsaW9uCiAgICAgICAgLy8gdHJhbnNhY3Rpb25zIHBlciB5ZWFyISBTbywgdGhpcyBkZWZpbml0ZWx5IHdvbid0IGJlIGEgcHJvYmxlbQogICAgICAgIC8vIGZvciBzZXZlcmFsIHllYXJzIChldmVuIGFzIEV0aGVyZXVtIGxlYXJucyB0byBzY2FsZSkuCiAgICAgICAgdWludDMyIG1hdHJvbklkOwogICAgICAgIHVpbnQzMiBzaXJlSWQ7CgogICAgICAgIC8vIFNldCB0byB0aGUgSUQgb2YgdGhlIHNpcmUgbW9uc3RlciBmb3IgbWF0cm9ucyB0aGF0IGFyZSBwcmVnbmFudCwKICAgICAgICAvLyB6ZXJvIG90aGVyd2lzZS4gQSBub24temVybyB2YWx1ZSBoZXJlIGlzIGhvdyB3ZSBrbm93IGEgbW9uc3RlcgogICAgICAgIC8vIGlzIHByZWduYW50LiBVc2VkIHRvIHJldHJpZXZlIHRoZSBnZW5ldGljIG1hdGVyaWFsIGZvciB0aGUgbmV3CiAgICAgICAgLy8gbW9uc3RlciB3aGVuIHRoZSBiaXJ0aCB0cmFuc3BpcmVzLgogICAgICAgIHVpbnQzMiBzaXJpbmdXaXRoSWQ7CgogICAgICAgIC8vIFNldCB0byB0aGUgaW5kZXggaW4gdGhlIGNvb2xkb3duIGFycmF5IChzZWUgYmVsb3cpIHRoYXQgcmVwcmVzZW50cwogICAgICAgIC8vIHRoZSBjdXJyZW50IGNvb2xkb3duIGR1cmF0aW9uIGZvciB0aGlzIE1vbnN0ZXIuIFRoaXMgc3RhcnRzIGF0IHplcm8KICAgICAgICAvLyBmb3IgZ2VuMCBtb25zdGVycywgYW5kIGlzIGluaXRpYWxpemVkIHRvIGZsb29yKGdlbmVyYXRpb24vMikgZm9yIG90aGVycy4KICAgICAgICAvLyBJbmNyZW1lbnRlZCBieSBvbmUgZm9yIGVhY2ggc3VjY2Vzc2Z1bCBicmVlZGluZyBhY3Rpb24sIHJlZ2FyZGxlc3MKICAgICAgICAvLyBvZiB3aGV0aGVyIHRoaXMgbW9uc3RlciBpcyBhY3RpbmcgYXMgbWF0cm9uIG9yIHNpcmUuCiAgICAgICAgdWludDE2IGNvb2xkb3duSW5kZXg7CgogICAgICAgIC8vIFRoZSAiZ2VuZXJhdGlvbiBudW1iZXIiIG9mIHRoaXMgbW9uc3Rlci4gTW9uc3RlcnMgbWludGVkIGJ5IHRoZSBDSyBjb250cmFjdAogICAgICAgIC8vIGZvciBzYWxlIGFyZSBjYWxsZWQgImdlbjAiIGFuZCBoYXZlIGEgZ2VuZXJhdGlvbiBudW1iZXIgb2YgMC4gVGhlCiAgICAgICAgLy8gZ2VuZXJhdGlvbiBudW1iZXIgb2YgYWxsIG90aGVyIG1vbnN0ZXJzIGlzIHRoZSBsYXJnZXIgb2YgdGhlIHR3byBnZW5lcmF0aW9uCiAgICAgICAgLy8gbnVtYmVycyBvZiB0aGVpciBwYXJlbnRzLCBwbHVzIG9uZS4KICAgICAgICAvLyAoaS5lLiBtYXgobWF0cm9uLmdlbmVyYXRpb24sIHNpcmUuZ2VuZXJhdGlvbikgKyAxKQogICAgICAgIHVpbnQxNiBnZW5lcmF0aW9uOwogICAgfQoKICAgIC8qKiogQ09OU1RBTlRTICoqKi8KCiAgICAvLy8gQGRldiBBIGxvb2t1cCB0YWJsZSBpbmRpbW9uc3RlcmluZyB0aGUgY29vbGRvd24gZHVyYXRpb24gYWZ0ZXIgYW55IHN1Y2Nlc3NmdWwKICAgIC8vLyAgYnJlZWRpbmcgYWN0aW9uLCBjYWxsZWQgInByZWduYW5jeSB0aW1lIiBmb3IgbWF0cm9ucyBhbmQgInNpcmluZyBjb29sZG93biIKICAgIC8vLyAgZm9yIHNpcmVzLiBEZXNpZ25lZCBzdWNoIHRoYXQgdGhlIGNvb2xkb3duIHJvdWdobHkgZG91YmxlcyBlYWNoIHRpbWUgYSBtb25zdGVyCiAgICAvLy8gIGlzIGJyZWQsIGVuY291cmFnaW5nIG93bmVycyBub3QgdG8ganVzdCBrZWVwIGJyZWVkaW5nIHRoZSBzYW1lIG1vbnN0ZXIgb3ZlcgogICAgLy8vICBhbmQgb3ZlciBhZ2Fpbi4gQ2FwcyBvdXQgYXQgb25lIHdlZWsgKGEgbW9uc3RlciBjYW4gYnJlZWQgYW4gdW5ib3VuZGVkIG51bWJlcgogICAgLy8vICBvZiB0aW1lcywgYW5kIHRoZSBtYXhpbXVtIGNvb2xkb3duIGlzIGFsd2F5cyBzZXZlbiBkYXlzKS4KICAgIHVpbnQzMlsxNF0gcHVibGljIGNvb2xkb3ducyA9IFsKICAgIHVpbnQzMigxIG1pbnV0ZXMpLAogICAgdWludDMyKDIgbWludXRlcyksCiAgICB1aW50MzIoNSBtaW51dGVzKSwKICAgIHVpbnQzMigxMCBtaW51dGVzKSwKICAgIHVpbnQzMigzMCBtaW51dGVzKSwKICAgIHVpbnQzMigxIGhvdXJzKSwKICAgIHVpbnQzMigyIGhvdXJzKSwKICAgIHVpbnQzMig0IGhvdXJzKSwKICAgIHVpbnQzMig4IGhvdXJzKSwKICAgIHVpbnQzMigxNiBob3VycyksCiAgICB1aW50MzIoMSBkYXlzKSwKICAgIHVpbnQzMigyIGRheXMpLAogICAgdWludDMyKDQgZGF5cyksCiAgICB1aW50MzIoNyBkYXlzKQogICAgXTsKCiAgICAvLyBBbiBhcHByb3hpbWF0aW9uIG9mIGN1cnJlbnRseSBob3cgbWFueSBzZWNvbmRzIGFyZSBpbiBiZXR3ZWVuIGJsb2Nrcy4KICAgIHVpbnQyNTYgcHVibGljIHNlY29uZHNQZXJCbG9jayA9IDE1OwoKICAgIC8qKiogU1RPUkFHRSAqKiovCgogICAgLy8vIEBkZXYgQW4gYXJyYXkgY29udGFpbmluZyB0aGUgTW9uc3RlciBzdHJ1Y3QgZm9yIGFsbCBNb25zdGVycyBpbiBleGlzdGVuY2UuIFRoZSBJRAogICAgLy8vICBvZiBlYWNoIG1vbnN0ZXIgaXMgYWN0dWFsbHkgYW4gaW5kZXggaW50byB0aGlzIGFycmF5LiBOb3RlIHRoYXQgSUQgMCBpcyBhIG5lZ2Ftb25zdGVyLAogICAgLy8vICB0aGUgdW5Nb25zdGVyLCB0aGUgbXl0aGljYWwgYmVhc3QgdGhhdCBpcyB0aGUgcGFyZW50IG9mIGFsbCBnZW4wIG1vbnN0ZXJzLiBBIGJpemFycmUKICAgIC8vLyAgY3JlYXR1cmUgdGhhdCBpcyBib3RoIG1hdHJvbiBhbmQgc2lyZS4uLiB0byBpdHNlbGYhIEhhcyBhbiBpbnZhbGlkIGdlbmV0aWMgY29kZS4KICAgIC8vLyAgSW4gb3RoZXIgd29yZHMsIG1vbnN0ZXIgSUQgMCBpcyBpbnZhbGlkLi4uIDstKQogICAgTW9uc3RlcltdIG1vbnN0ZXJzOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIG1vbnN0ZXIgSURzIHRvIHRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGVtLiBBbGwgbW9uc3RlcnMgaGF2ZQogICAgLy8vICBzb21lIHZhbGlkIG93bmVyIGFkZHJlc3MsIGV2ZW4gZ2VuMCBtb25zdGVycyBhcmUgY3JlYXRlZCB3aXRoIGEgbm9uLXplcm8gb3duZXIuCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIG1vbnN0ZXJJbmRleFRvT3duZXI7CgogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAgIC8vICBVc2VkIGludGVybmFsbHkgaW5zaWRlIGJhbGFuY2VPZigpIHRvIHJlc29sdmUgb3duZXJzaGlwIGNvdW50LgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVyc2hpcFRva2VuQ291bnQ7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gTW9uc3RlcklEcyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gY2FsbAogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gRWFjaCBNb25zdGVyIGNhbiBvbmx5IGhhdmUgb25lIGFwcHJvdmVkIGFkZHJlc3MgZm9yIHRyYW5zZmVyCiAgICAvLy8gIGF0IGFueSB0aW1lLiBBIHplcm8gdmFsdWUgbWVhbnMgbm8gYXBwcm92YWwgaXMgb3V0c3RhbmRpbmcuCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIG1vbnN0ZXJJbmRleFRvQXBwcm92ZWQ7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gTW9uc3RlcklEcyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gdXNlCiAgICAvLy8gIHRoaXMgTW9uc3RlciBmb3Igc2lyaW5nIHZpYSBicmVlZFdpdGgoKS4gRWFjaCBNb25zdGVyIGNhbiBvbmx5IGhhdmUgb25lIGFwcHJvdmVkCiAgICAvLy8gIGFkZHJlc3MgZm9yIHNpcmluZyBhdCBhbnkgdGltZS4gQSB6ZXJvIHZhbHVlIG1lYW5zIG5vIGFwcHJvdmFsIGlzIG91dHN0YW5kaW5nLgogICAgbWFwcGluZyh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBzaXJlQWxsb3dlZFRvQWRkcmVzczsKCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiB0aGUgQ2xvY2tBdWN0aW9uIGNvbnRyYWN0IHRoYXQgaGFuZGxlcyBzYWxlcyBvZiBNb25zdGVycy4gVGhpcwogICAgLy8vICBzYW1lIGNvbnRyYWN0IGhhbmRsZXMgYm90aCBwZWVyLXRvLXBlZXIgc2FsZXMgYXMgd2VsbCBhcyB0aGUgZ2VuMCBzYWxlcyB3aGljaCBhcmUKICAgIC8vLyAgaW5pdGlhdGVkIGV2ZXJ5IDE1IG1pbnV0ZXMuCiAgICBTYWxlQ2xvY2tBdWN0aW9uIHB1YmxpYyBzYWxlQXVjdGlvbjsKCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiBhIGN1c3RvbSBDbG9ja0F1Y3Rpb24gc3ViY2xhc3NlZCBjb250cmFjdCB0aGF0IGhhbmRsZXMgc2lyaW5nCiAgICAvLy8gIGF1Y3Rpb25zLiBOZWVkcyB0byBiZSBzZXBhcmF0ZSBmcm9tIHNhbGVBdWN0aW9uIGJlY2F1c2UgdGhlIGFjdGlvbnMgdGFrZW4gb24gc3VjY2VzcwogICAgLy8vICBhZnRlciBhIHNhbGVzIGFuZCBzaXJpbmcgYXVjdGlvbiBhcmUgcXVpdGUgZGlmZmVyZW50LgogICAgU2lyaW5nQ2xvY2tBdWN0aW9uIHB1YmxpYyBzaXJpbmdBdWN0aW9uOwoKICAgIEdlbmVTY2llbmNlIHB1YmxpYyBnZW5lU2NpZW5jZTsKCiAgICAvLy8gQGRldiBBc3NpZ25zIG93bmVyc2hpcCBvZiBhIHNwZWNpZmljIE1vbnN0ZXIgdG8gYW4gYWRkcmVzcy4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFNpbmNlIHRoZSBudW1iZXIgb2YgbW9uc3RlcnMgaXMgY2FwcGVkIHRvIDJeMzIgd2UgY2FuJ3Qgb3ZlcmZsb3cgdGhpcwogICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX3RvXSsrOwogICAgICAgIC8vIHRyYW5zZmVyIG93bmVyc2hpcAogICAgICAgIG1vbnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdID0gX3RvOwoKICAgICAgICAvLyBXaGVuIGNyZWF0aW5nIG5ldyBtb25zdGVycyBfZnJvbSBpcyAweDAsIGJ1dCB3ZSBjYW4ndCBhY2NvdW50IHRoYXQgYWRkcmVzcy4KICAgICAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W19mcm9tXS0tOwogICAgICAgICAgICAvLyBvbmNlIHRoZSBtb25zdGVyIGlzIHRyYW5zZmVycmVkIGFsc28gY2xlYXIgc2lyZSBhbGxvd2FuY2VzCiAgICAgICAgICAgIGRlbGV0ZSBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfdG9rZW5JZF07CiAgICAgICAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICAgICAgICBkZWxldGUgbW9uc3RlckluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICAgICAgfQogICAgICAgIC8vIEVtaXQgdGhlIHRyYW5zZmVyIGV2ZW50LgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBBbiBpbnRlcm5hbCBtZXRob2QgdGhhdCBjcmVhdGVzIGEgbmV3IG1vbnN0ZXIgYW5kIHN0b3JlcyBpdC4gVGhpcwogICAgLy8vICBtZXRob2QgZG9lc24ndCBkbyBhbnkgY2hlY2tpbmcgYW5kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIHRoZQogICAgLy8vICBpbnB1dCBkYXRhIGlzIGtub3duIHRvIGJlIHZhbGlkLiBXaWxsIGdlbmVyYXRlIGJvdGggYSBCaXJ0aCBldmVudAogICAgLy8vICBhbmQgYSBUcmFuc2ZlciBldmVudC4KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIFRoZSBtb25zdGVyIElEIG9mIHRoZSBtYXRyb24gb2YgdGhpcyBtb25zdGVyICh6ZXJvIGZvciBnZW4wKQogICAgLy8vIEBwYXJhbSBfc2lyZUlkIFRoZSBtb25zdGVyIElEIG9mIHRoZSBzaXJlIG9mIHRoaXMgbW9uc3RlciAoemVybyBmb3IgZ2VuMCkKICAgIC8vLyBAcGFyYW0gX2dlbmVyYXRpb24gVGhlIGdlbmVyYXRpb24gbnVtYmVyIG9mIHRoaXMgbW9uc3RlciwgbXVzdCBiZSBjb21wdXRlZCBieSBjYWxsZXIuCiAgICAvLy8gQHBhcmFtIF9nZW5lcyBUaGUgbW9uc3RlcidzIGdlbmV0aWMgY29kZS4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBpbml0YWwgb3duZXIgb2YgdGhpcyBtb25zdGVyLCBtdXN0IGJlIG5vbi16ZXJvIChleGNlcHQgZm9yIHRoZSB1bk1vbnN0ZXIsIElEIDApCiAgICBmdW5jdGlvbiBfY3JlYXRlTW9uc3RlcigKICAgICAgICB1aW50MjU2IF9tYXRyb25JZCwKICAgICAgICB1aW50MjU2IF9zaXJlSWQsCiAgICAgICAgdWludDI1NiBfZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9nZW5lcywKICAgICAgICBhZGRyZXNzIF9vd25lcgogICAgKQogICAgaW50ZXJuYWwKICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgLy8gVGhlc2UgcmVxdWlyZXMgYXJlIG5vdCBzdHJpY3RseSBuZWNlc3NhcnksIG91ciBjYWxsaW5nIGNvZGUgc2hvdWxkIG1ha2UKICAgICAgICAvLyBzdXJlIHRoYXQgdGhlc2UgY29uZGl0aW9ucyBhcmUgbmV2ZXIgYnJva2VuLiBIb3dldmVyISBfY3JlYXRlTW9uc3RlcigpIGlzIGFscmVhZHkKICAgICAgICAvLyBhbiBleHBlbnNpdmUgY2FsbCAoZm9yIHN0b3JhZ2UpLCBhbmQgaXQgZG9lc24ndCBodXJ0IHRvIGJlIGVzcGVjaWFsbHkgY2FyZWZ1bAogICAgICAgIC8vIHRvIGVuc3VyZSBvdXIgZGF0YSBzdHJ1Y3R1cmVzIGFyZSBhbHdheXMgdmFsaWQuCiAgICAgICAgcmVxdWlyZShfbWF0cm9uSWQgPT0gdWludDI1Nih1aW50MzIoX21hdHJvbklkKSkpOwogICAgICAgIHJlcXVpcmUoX3NpcmVJZCA9PSB1aW50MjU2KHVpbnQzMihfc2lyZUlkKSkpOwogICAgICAgIHJlcXVpcmUoX2dlbmVyYXRpb24gPT0gdWludDI1Nih1aW50MTYoX2dlbmVyYXRpb24pKSk7CgogICAgICAgIC8vIE5ldyBtb25zdGVyIHN0YXJ0cyB3aXRoIHRoZSBzYW1lIGNvb2xkb3duIGFzIHBhcmVudCBnZW4vMgogICAgICAgIHVpbnQxNiBjb29sZG93bkluZGV4ID0gdWludDE2KF9nZW5lcmF0aW9uIC8gMik7CiAgICAgICAgaWYgKGNvb2xkb3duSW5kZXggPiAxMykgewogICAgICAgICAgICBjb29sZG93bkluZGV4ID0gMTM7CiAgICAgICAgfQoKICAgICAgICBNb25zdGVyIG1lbW9yeSBfbW9uc3RlciA9IE1vbnN0ZXIoewogICAgICAgICAgICBnZW5lcyA6IF9nZW5lcywKICAgICAgICAgICAgYmlydGhUaW1lIDogdWludDY0KG5vdyksCiAgICAgICAgICAgIGNvb2xkb3duRW5kQmxvY2sgOiAwLAogICAgICAgICAgICBtYXRyb25JZCA6IHVpbnQzMihfbWF0cm9uSWQpLAogICAgICAgICAgICBzaXJlSWQgOiB1aW50MzIoX3NpcmVJZCksCiAgICAgICAgICAgIHNpcmluZ1dpdGhJZCA6IDAsCiAgICAgICAgICAgIGNvb2xkb3duSW5kZXggOiBjb29sZG93bkluZGV4LAogICAgICAgICAgICBnZW5lcmF0aW9uIDogdWludDE2KF9nZW5lcmF0aW9uKQogICAgICAgICAgICB9KTsKICAgICAgICB1aW50MjU2IG5ld0tpdHRlbklkID0gbW9uc3RlcnMucHVzaChfbW9uc3RlcikgLSAxOwoKICAgICAgICAvLyBJdCdzIHByb2JhYmx5IG5ldmVyIGdvaW5nIHRvIGhhcHBlbiwgNCBiaWxsaW9uIG1vbnN0ZXJzIGlzIEEgTE9ULCBidXQKICAgICAgICAvLyBsZXQncyBqdXN0IGJlIDEwMCUgc3VyZSB3ZSBuZXZlciBsZXQgdGhpcyBoYXBwZW4uCiAgICAgICAgcmVxdWlyZShuZXdLaXR0ZW5JZCA9PSB1aW50MjU2KHVpbnQzMihuZXdLaXR0ZW5JZCkpKTsKCiAgICAgICAgLy8gZW1pdCB0aGUgYmlydGggZXZlbnQKICAgICAgICBCaXJ0aCgKICAgICAgICAgICAgX293bmVyLAogICAgICAgICAgICBuZXdLaXR0ZW5JZCwKICAgICAgICAgICAgdWludDI1NihfbW9uc3Rlci5tYXRyb25JZCksCiAgICAgICAgICAgIHVpbnQyNTYoX21vbnN0ZXIuc2lyZUlkKSwKICAgICAgICAgICAgX21vbnN0ZXIuZ2VuZXMsCiAgICAgICAgICAgIHVpbnQxNihfZ2VuZXJhdGlvbikKICAgICAgICApOwoKICAgICAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcCwgYW5kIGFsc28gZW1pdCB0aGUgVHJhbnNmZXIgZXZlbnQgYXMKICAgICAgICAvLyBwZXIgRVJDNzIxIGRyYWZ0CiAgICAgICAgX3RyYW5zZmVyKDAsIF9vd25lciwgbmV3S2l0dGVuSWQpOwoKICAgICAgICByZXR1cm4gbmV3S2l0dGVuSWQ7CiAgICB9CgogICAgLy8gQW55IEMtbGV2ZWwgY2FuIGZpeCBob3cgbWFueSBzZWNvbmRzIHBlciBibG9ja3MgYXJlIGN1cnJlbnRseSBvYnNlcnZlZC4KICAgIGZ1bmN0aW9uIHNldFNlY29uZHNQZXJCbG9jayh1aW50MjU2IHNlY3MpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIHJlcXVpcmUoc2VjcyA8IGNvb2xkb3duc1swXSk7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gc2VjczsKICAgIH0KfQoKCgoKCi8vLyBAdGl0bGUgVGhlIGV4dGVybmFsIGNvbnRyYWN0IHRoYXQgaXMgcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgbWV0YWRhdGEgZm9yIHRoZSBtb25zdGVycywKLy8vICBpdCBoYXMgb25lIGZ1bmN0aW9uIHRoYXQgd2lsbCByZXR1cm4gdGhlIGRhdGEgYXMgYnl0ZXMuCmNvbnRyYWN0IEVSQzcyMU1ldGFkYXRhIHsKICAgIC8vLyBAZGV2IEdpdmVuIGEgdG9rZW4gSWQsIHJldHVybnMgYSBieXRlIGFycmF5IHRoYXQgaXMgc3VwcG9zZWQgdG8gYmUgY29udmVydGVkIGludG8gc3RyaW5nLgogICAgZnVuY3Rpb24gZ2V0TWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyWzRdIGJ1ZmZlciwgdWludDI1NiBjb3VudCkgewogICAgICAgIGlmIChfdG9rZW5JZCA9PSAxKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJIZWxsbyBXb3JsZCEgOkQiOwogICAgICAgICAgICBjb3VudCA9IDE1OwogICAgICAgIH0gZWxzZSBpZiAoX3Rva2VuSWQgPT0gMikgewogICAgICAgICAgICBidWZmZXJbMF0gPSAiSSB3b3VsZCBkZWZpbml0ZWx5IGNob29zZSBhIG1lZGkiOwogICAgICAgICAgICBidWZmZXJbMV0gPSAidW0gbGVuZ3RoIHN0cmluZy4iOwogICAgICAgICAgICBjb3VudCA9IDQ5OwogICAgICAgIH0gZWxzZSBpZiAoX3Rva2VuSWQgPT0gMykgewogICAgICAgICAgICBidWZmZXJbMF0gPSAiTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIG1pIGUiOwogICAgICAgICAgICBidWZmZXJbMV0gPSAic3QgYWNjdW1zYW4gZGFwaWJ1cyBhdWd1ZSBsb3JlbSwiOwogICAgICAgICAgICBidWZmZXJbMl0gPSAiIHRyaXN0aXF1ZSB2ZXN0aWJ1bHVtIGlkLCBsaWJlcm8iOwogICAgICAgICAgICBidWZmZXJbM10gPSAiIHN1c2NpcGl0IHZhcml1cyBzYXBpZW4gYWxpcXVhbS4iOwogICAgICAgICAgICBjb3VudCA9IDEyODsKICAgICAgICB9CiAgICB9Cn0KCgovLy8gQHRpdGxlIFRoZSBmYWNldCBvZiB0aGUgQ3J5cHRvTW9uc3RlcnMgY29yZSBjb250cmFjdCB0aGF0IG1hbmFnZXMgb3duZXJzaGlwLCBFUkMtNzIxIChkcmFmdCkgY29tcGxpYW50LgovLy8gQGF1dGhvciBBeGlvbSBaZW4gKGh0dHBzOi8vd3d3LmF4aW9temVuLmNvKQovLy8gQGRldiBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEKLy8vICBTZWUgdGhlIE1vbnN0ZXJDb3JlIGNvbnRyYWN0IGRvY3VtZW50YXRpb24gdG8gdW5kZXJzdGFuZCBob3cgdGhlIHZhcmlvdXMgY29udHJhY3QgZmFjZXRzIGFyZSBhcnJhbmdlZC4KY29udHJhY3QgTW9uc3Rlck93bmVyc2hpcCBpcyBNb25zdGVyQmFzZSwgRVJDNzIxIHsKCiAgICAvLy8gQG5vdGljZSBOYW1lIGFuZCBzeW1ib2wgb2YgdGhlIG5vbiBmdW5naWJsZSB0b2tlbiwgYXMgZGVmaW5lZCBpbiBFUkM3MjEuCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiRXRoZXJtb24iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiRU0iOwoKICAgIC8vIFRoZSBjb250cmFjdCB0aGF0IHdpbGwgcmV0dXJuIG1vbnN0ZXIgbWV0YWRhdGEKICAgIEVSQzcyMU1ldGFkYXRhIHB1YmxpYyBlcmM3MjFNZXRhZGF0YTsKCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9CiAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b3RhbFN1cHBseSgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2JhbGFuY2VPZihhZGRyZXNzKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5zT2ZPd25lcihhZGRyZXNzKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbk1ldGFkYXRhKHVpbnQyNTYsc3RyaW5nKScpKTsKCiAgICAvLy8gQG5vdGljZSBJbnRyb3NwZWN0aW9uIGludGVyZmFjZSBhcyBwZXIgRVJDLTE2NSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkuCiAgICAvLy8gIFJldHVybnMgdHJ1ZSBmb3IgYW55IHN0YW5kYXJkaXplZCBpbnRlcmZhY2VzIGltcGxlbWVudGVkIGJ5IHRoaXMgY29udHJhY3QuIFdlIGltcGxlbWVudAogICAgLy8vICBFUkMtMTY1IChvYnZpb3VzbHkhKSBhbmQgRVJDLTcyMS4KICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvLyBERUJVRyBPTkxZCiAgICAgICAgLy9yZXF1aXJlKChJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID09IDB4MDFmZmM5YTcpICYmIChJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID09IDB4OWEyMDQ4M2QpKTsKCiAgICAgICAgcmV0dXJuICgoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUpIHx8IChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgfQoKICAgIC8vLyBAZGV2IFNldCB0aGUgYWRkcmVzcyBvZiB0aGUgc2libGluZyBjb250cmFjdCB0aGF0IHRyYWNrcyBtZXRhZGF0YS4KICAgIC8vLyAgQ0VPIG9ubHkuCiAgICBmdW5jdGlvbiBzZXRNZXRhZGF0YUFkZHJlc3MoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzKSBwdWJsaWMgb25seUNFTyB7CiAgICAgICAgZXJjNzIxTWV0YWRhdGEgPSBFUkM3MjFNZXRhZGF0YShfY29udHJhY3RBZGRyZXNzKTsKICAgIH0KCiAgICAvLyBJbnRlcm5hbCB1dGlsaXR5IGZ1bmN0aW9uczogVGhlc2UgZnVuY3Rpb25zIGFsbCBhc3N1bWUgdGhhdCB0aGVpciBpbnB1dCBhcmd1bWVudHMKICAgIC8vIGFyZSB2YWxpZC4gV2UgbGVhdmUgaXQgdG8gcHVibGljIG1ldGhvZHMgdG8gc2FuaXRpemUgdGhlaXIgaW5wdXRzIGFuZCBmb2xsb3cKICAgIC8vIHRoZSByZXF1aXJlZCBsb2dpYy4KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGlzIHRoZSBjdXJyZW50IG93bmVyIG9mIGEgcGFydGljdWxhciBNb25zdGVyLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIHZhbGlkYXRpbmcgYWdhaW5zdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgbW9uc3RlciBpZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtb25zdGVySW5kZXhUb093bmVyW190b2tlbklkXSA9PSBfY2xhaW1hbnQ7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBjdXJyZW50bHkgaGFzIHRyYW5zZmVyQXBwcm92YWwgZm9yIGEgcGFydGljdWxhciBNb25zdGVyLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIGNvbmZpcm1pbmcgbW9uc3RlciBpcyBhcHByb3ZlZCBmb3IuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIG1vbnN0ZXIgaWQsIG9ubHkgdmFsaWQgd2hlbiA+IDAKICAgIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1vbnN0ZXJJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBNYXJrcyBhbiBhZGRyZXNzIGFzIGJlaW5nIGFwcHJvdmVkIGZvciB0cmFuc2ZlckZyb20oKSwgb3ZlcndyaXRpbmcgYW55IHByZXZpb3VzCiAgICAvLy8gIGFwcHJvdmFsLiBTZXR0aW5nIF9hcHByb3ZlZCB0byBhZGRyZXNzKDApIGNsZWFycyBhbGwgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAvLy8gIE5PVEU6IF9hcHByb3ZlKCkgZG9lcyBOT1Qgc2VuZCB0aGUgQXBwcm92YWwgZXZlbnQuIFRoaXMgaXMgaW50ZW50aW9uYWwgYmVjYXVzZQogICAgLy8vICBfYXBwcm92ZSgpIGFuZCB0cmFuc2ZlckZyb20oKSBhcmUgdXNlZCB0b2dldGhlciBmb3IgcHV0dGluZyBNb25zdGVycyBvbiBhdWN0aW9uLCBhbmQKICAgIC8vLyAgdGhlcmUgaXMgbm8gdmFsdWUgaW4gc3BhbW1pbmcgdGhlIGxvZyB3aXRoIEFwcHJvdmFsIGV2ZW50cyBpbiB0aGF0IGNhc2UuCiAgICBmdW5jdGlvbiBfYXBwcm92ZSh1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9hcHByb3ZlZCkgaW50ZXJuYWwgewogICAgICAgIG1vbnN0ZXJJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID0gX2FwcHJvdmVkOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIG51bWJlciBvZiBNb25zdGVycyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewogICAgICAgIHJldHVybiBvd25lcnNoaXBUb2tlbkNvdW50W19vd25lcl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIGEgTW9uc3RlciB0byBhbm90aGVyIGFkZHJlc3MuIElmIHRyYW5zZmVycmluZyB0byBhIHNtYXJ0CiAgICAvLy8gIGNvbnRyYWN0IGJlIFZFUlkgQ0FSRUZVTCB0byBlbnN1cmUgdGhhdCBpdCBpcyBhd2FyZSBvZiBFUkMtNzIxIChvcgogICAgLy8vICBDcnlwdG9Nb25zdGVycyBzcGVjaWZpY2FsbHkpIG9yIHlvdXIgTW9uc3RlciBtYXkgYmUgbG9zdCBmb3JldmVyLiBTZXJpb3VzbHkuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LCBjYW4gYmUgYSB1c2VyIG9yIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIE1vbnN0ZXIgdG8gdHJhbnNmZXIuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgbW9uc3RlcnMgKGV4Y2VwdCB2ZXJ5IGJyaWVmbHkKICAgICAgICAvLyBhZnRlciBhIGdlbjAgbW9uc3RlciBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhlIGF1Y3Rpb24gY29udHJhY3RzIHRvIHByZXZlbnQgYWNjaWRlbnRhbAogICAgICAgIC8vIG1pc3VzZS4gQXVjdGlvbiBjb250cmFjdHMgc2hvdWxkIG9ubHkgdGFrZSBvd25lcnNoaXAgb2YgbW9uc3RlcnMKICAgICAgICAvLyB0aHJvdWdoIHRoZSBhbGxvdyArIHRyYW5zZmVyRnJvbSBmbG93LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3Moc2FsZUF1Y3Rpb24pKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHNpcmluZ0F1Y3Rpb24pKTsKCiAgICAgICAgLy8gWW91IGNhbiBvbmx5IHNlbmQgeW91ciBvd24gbW9uc3Rlci4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAsIGNsZWFyIHBlbmRpbmcgYXBwcm92YWxzLCBlbWl0IFRyYW5zZmVyIGV2ZW50LgogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHcmFudCBhbm90aGVyIGFkZHJlc3MgdGhlIHJpZ2h0IHRvIHRyYW5zZmVyIGEgc3BlY2lmaWMgTW9uc3RlciB2aWEKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIFRoaXMgaXMgdGhlIHByZWZlcnJlZCBmbG93IGZvciB0cmFuc2ZlcmluZyBORlRzIHRvIGNvbnRyYWN0cy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGJlIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwuIFBhc3MgYWRkcmVzcygwKSB0bwogICAgLy8vICBjbGVhciBhbGwgYXBwcm92YWxzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIE1vbnN0ZXIgdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBPbmx5IGFuIG93bmVyIGNhbiBncmFudCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlZ2lzdGVyIHRoZSBhcHByb3ZhbCAocmVwbGFjaW5nIGFueSBwcmV2aW91cyBhcHByb3ZhbCkuCiAgICAgICAgX2FwcHJvdmUoX3Rva2VuSWQsIF90byk7CgogICAgICAgIC8vIEVtaXQgYXBwcm92YWwgZXZlbnQuCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBNb25zdGVyIG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nIGFkZHJlc3MKICAgIC8vLyAgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSBNb25zdGVyIHRvIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHNob3VsZCB0YWtlIG93bmVyc2hpcCBvZiB0aGUgTW9uc3Rlci4gQ2FuIGJlIGFueSBhZGRyZXNzLAogICAgLy8vICBpbmNsdWRpbmcgdGhlIGNhbGxlci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBNb25zdGVyIHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IG1vbnN0ZXJzIChleGNlcHQgdmVyeSBicmllZmx5CiAgICAgICAgLy8gYWZ0ZXIgYSBnZW4wIG1vbnN0ZXIgaXMgY3JlYXRlZCBhbmQgYmVmb3JlIGl0IGdvZXMgb24gYXVjdGlvbikuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgLy8gQ2hlY2sgZm9yIGFwcHJvdmFsIGFuZCB2YWxpZCBvd25lcnNoaXAKICAgICAgICByZXF1aXJlKF9hcHByb3ZlZEZvcihtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUoX293bnMoX2Zyb20sIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCAoYWxzbyBjbGVhcnMgcGVuZGluZyBhcHByb3ZhbHMgYW5kIGVtaXRzIFRyYW5zZmVyIGV2ZW50KS4KICAgICAgICBfdHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBNb25zdGVycyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBtb25zdGVycy5sZW5ndGggLSAxOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGFkZHJlc3MgY3VycmVudGx5IGFzc2lnbmVkIG93bmVyc2hpcCBvZiBhIGdpdmVuIE1vbnN0ZXIuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKQogICAgZXh0ZXJuYWwKICAgIHZpZXcKICAgIHJldHVybnMgKGFkZHJlc3Mgb3duZXIpCiAgICB7CiAgICAgICAgb3duZXIgPSBtb25zdGVySW5kZXhUb093bmVyW190b2tlbklkXTsKCiAgICAgICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKDApKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGEgbGlzdCBvZiBhbGwgTW9uc3RlciBJRHMgYXNzaWduZWQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciB3aG9zZSBNb25zdGVycyB3ZSBhcmUgaW50ZXJlc3RlZCBpbi4KICAgIC8vLyBAZGV2IFRoaXMgbWV0aG9kIE1VU1QgTkVWRVIgYmUgY2FsbGVkIGJ5IHNtYXJ0IGNvbnRyYWN0IGNvZGUuIEZpcnN0LCBpdCdzIGZhaXJseQogICAgLy8vICBleHBlbnNpdmUgKGl0IHdhbGtzIHRoZSBlbnRpcmUgTW9uc3RlciBhcnJheSBsb29raW5nIGZvciBtb25zdGVycyBiZWxvbmdpbmcgdG8gb3duZXIpLAogICAgLy8vICBidXQgaXQgYWxzbyByZXR1cm5zIGEgZHluYW1pYyBhcnJheSwgd2hpY2ggaXMgb25seSBzdXBwb3J0ZWQgZm9yIHdlYjMgY2FsbHMsIGFuZAogICAgLy8vICBub3QgY29udHJhY3QtdG8tY29udHJhY3QgY2FsbHMuCiAgICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSBvd25lclRva2VucykgewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwoKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10odG9rZW5Db3VudCk7CiAgICAgICAgICAgIHVpbnQyNTYgdG90YWxNb25zdGVycyA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwoKICAgICAgICAgICAgLy8gV2UgY291bnQgb24gdGhlIGZhY3QgdGhhdCBhbGwgbW9uc3RlcnMgaGF2ZSBJRHMgc3RhcnRpbmcgYXQgMSBhbmQgaW5jcmVhc2luZwogICAgICAgICAgICAvLyBzZXF1ZW50aWFsbHkgdXAgdG8gdGhlIHRvdGFsTW9uc3RlciBjb3VudC4KICAgICAgICAgICAgdWludDI1NiBtb25zdGVySWQ7CgogICAgICAgICAgICBmb3IgKG1vbnN0ZXJJZCA9IDE7IG1vbnN0ZXJJZCA8PSB0b3RhbE1vbnN0ZXJzOyBtb25zdGVySWQrKykgewogICAgICAgICAgICAgICAgaWYgKG1vbnN0ZXJJbmRleFRvT3duZXJbbW9uc3RlcklkXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gbW9uc3RlcklkOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEFkYXB0ZWQgZnJvbSBtZW1jcHkoKSBieSBAYXJhY2huaWQgKE5pY2sgSm9obnNvbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0NzI2MzUyNjI0MmYyOTJlMjMwNzI5MjgzMzIzMjgzMzY5MjkyMjMzIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4pCiAgICAvLy8gIFRoaXMgbWV0aG9kIGlzIGxpY2VuY2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vQXJhY2huaWQvc29saWRpdHktc3RyaW5ndXRpbHMvYmxvYi8yZjZjYTlhY2NiNDhhZTE0YzY2ZjE0MzdlYzUwZWQxOWEwNjE2Zjc4L3N0cmluZ3Muc29sCiAgICBmdW5jdGlvbiBfbWVtY3B5KHVpbnQgX2Rlc3QsIHVpbnQgX3NyYywgdWludCBfbGVuKSBwcml2YXRlIHZpZXcgewogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlCiAgICAgICAgZm9yICg7IF9sZW4gPj0gMzI7IF9sZW4gLT0gMzIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbXN0b3JlKF9kZXN0LCBtbG9hZChfc3JjKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfZGVzdCArPSAzMjsKICAgICAgICAgICAgX3NyYyArPSAzMjsKICAgICAgICB9CgogICAgICAgIC8vIENvcHkgcmVtYWluaW5nIGJ5dGVzCiAgICAgICAgdWludDI1NiBtYXNrID0gMjU2ICoqICgzMiAtIF9sZW4pIC0gMTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChfc3JjKSwgbm90KG1hc2spKQogICAgICAgICAgICBsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKF9kZXN0KSwgbWFzaykKICAgICAgICAgICAgbXN0b3JlKF9kZXN0LCBvcihkZXN0cGFydCwgc3JjcGFydCkpCiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEFkYXB0ZWQgZnJvbSB0b1N0cmluZyhzbGljZSkgYnkgQGFyYWNobmlkIChOaWNrIEpvaG5zb24gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iN2MxZDBlMWQxZjE0MTIxNTE4M2MxMjEzMDgxODEzMDg1MjEyMTkwOCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+KQogICAgLy8vICBUaGlzIG1ldGhvZCBpcyBsaWNlbmNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkL3NvbGlkaXR5LXN0cmluZ3V0aWxzL2Jsb2IvMmY2Y2E5YWNjYjQ4YWUxNGM2NmYxNDM3ZWM1MGVkMTlhMDYxNmY3OC9zdHJpbmdzLnNvbAogICAgZnVuY3Rpb24gX3RvU3RyaW5nKGJ5dGVzMzJbNF0gX3Jhd0J5dGVzLCB1aW50MjU2IF9zdHJpbmdMZW5ndGgpIHByaXZhdGUgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgb3V0cHV0U3RyaW5nID0gbmV3IHN0cmluZyhfc3RyaW5nTGVuZ3RoKTsKICAgICAgICB1aW50MjU2IG91dHB1dFB0cjsKICAgICAgICB1aW50MjU2IGJ5dGVzUHRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG91dHB1dFB0ciA6PSBhZGQob3V0cHV0U3RyaW5nLCAzMikKICAgICAgICAgICAgYnl0ZXNQdHIgOj0gX3Jhd0J5dGVzCiAgICAgICAgfQoKICAgICAgICBfbWVtY3B5KG91dHB1dFB0ciwgYnl0ZXNQdHIsIF9zdHJpbmdMZW5ndGgpOwoKICAgICAgICByZXR1cm4gb3V0cHV0U3RyaW5nOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBVUkkgcG9pbnRpbmcgdG8gYSBtZXRhZGF0YSBwYWNrYWdlIGZvciB0aGlzIHRva2VuIGNvbmZvcm1pbmcgdG8KICAgIC8vLyAgRVJDLTcyMSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG51bWJlciBvZiB0aGUgTW9uc3RlciB3aG9zZSBtZXRhZGF0YSBzaG91bGQgYmUgcmV0dXJuZWQuCiAgICBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKSB7CiAgICAgICAgcmVxdWlyZShlcmM3MjFNZXRhZGF0YSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBieXRlczMyWzRdIG1lbW9yeSBidWZmZXI7CiAgICAgICAgdWludDI1NiBjb3VudDsKICAgICAgICAoYnVmZmVyLCBjb3VudCkgPSBlcmM3MjFNZXRhZGF0YS5nZXRNZXRhZGF0YShfdG9rZW5JZCwgX3ByZWZlcnJlZFRyYW5zcG9ydCk7CgogICAgICAgIHJldHVybiBfdG9TdHJpbmcoYnVmZmVyLCBjb3VudCk7CiAgICB9Cn0KCgoKLy8vIEB0aXRsZSBBIGZhY2V0IG9mIE1vbnN0ZXJDb3JlIHRoYXQgbWFuYWdlcyBNb25zdGVyIHNpcmluZywgZ2VzdGF0aW9uLCBhbmQgYmlydGguCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFNlZSB0aGUgTW9uc3RlckNvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBNb25zdGVyQnJlZWRpbmcgaXMgTW9uc3Rlck93bmVyc2hpcCB7CgogICAgLy8vIEBkZXYgVGhlIFByZWduYW50IGV2ZW50IGlzIGZpcmVkIHdoZW4gdHdvIG1vbnN0ZXJzIHN1Y2Nlc3NmdWxseSBicmVlZCBhbmQgdGhlIHByZWduYW5jeQogICAgLy8vICB0aW1lciBiZWdpbnMgZm9yIHRoZSBtYXRyb24uCiAgICBldmVudCBQcmVnbmFudChhZGRyZXNzIG93bmVyLCB1aW50MjU2IG1hdHJvbklkLCB1aW50MjU2IHNpcmVJZCwgdWludDI1NiBjb29sZG93bkVuZEJsb2NrKTsKCiAgICAvLy8gQG5vdGljZSBUaGUgbWluaW11bSBwYXltZW50IHJlcXVpcmVkIHRvIHVzZSBicmVlZFdpdGhBdXRvKCkuIFRoaXMgZmVlIGdvZXMgdG93YXJkcwogICAgLy8vICB0aGUgZ2FzIGNvc3QgcGFpZCBieSB3aGF0ZXZlciBjYWxscyBnaXZlQmlydGgoKSwgYW5kIGNhbiBiZSBkeW5hbWljYWxseSB1cGRhdGVkIGJ5CiAgICAvLy8gIHRoZSBDT08gcm9sZSBhcyB0aGUgZ2FzIHByaWNlIGNoYW5nZXMuCiAgICB1aW50MjU2IHB1YmxpYyBhdXRvQmlydGhGZWUgPSA4IGZpbm5leTsKCiAgICAvLyBLZWVwcyB0cmFjayBvZiBudW1iZXIgb2YgcHJlZ25hbnQgbW9uc3RlcnMuCiAgICB1aW50MjU2IHB1YmxpYyBwcmVnbmFudE1vbnN0ZXJzOwoKICAgIC8vLyBAZGV2IFRoZSBhZGRyZXNzIG9mIHRoZSBzaWJsaW5nIGNvbnRyYWN0IHRoYXQgaXMgdXNlZCB0byBpbXBsZW1lbnQgdGhlIHNvb3Blci1zZWtyZXQKICAgIC8vLyAgZ2VuZXRpYyBjb21iaW5hdGlvbiBhbGdvcml0aG0uCgogICAgLy8vIEBkZXYgVXBkYXRlIHRoZSBhZGRyZXNzIG9mIHRoZSBnZW5ldGljIGNvbnRyYWN0LCBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIENFTy4KICAgIC8vLyBAcGFyYW0gX2FkZHJlc3MgQW4gYWRkcmVzcyBvZiBhIEdlbmVTY2llbmNlIGNvbnRyYWN0IGluc3RhbmNlIHRvIGJlIHVzZWQgZnJvbSB0aGlzIHBvaW50IGZvcndhcmQuCiAgICBmdW5jdGlvbiBzZXRHZW5lU2NpZW5jZUFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgR2VuZVNjaWVuY2UgY2FuZGlkYXRlQ29udHJhY3QgPSBHZW5lU2NpZW5jZShfYWRkcmVzcyk7CgogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNHZW5lU2NpZW5jZSgpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIGdlbmVTY2llbmNlID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIHRoYXQgYSBnaXZlbiBtb25zdGVyIGlzIGFibGUgdG8gYnJlZWQuIFJlcXVpcmVzIHRoYXQgdGhlCiAgICAvLy8gIGN1cnJlbnQgY29vbGRvd24gaXMgZmluaXNoZWQgKGZvciBzaXJlcykgYW5kIGFsc28gY2hlY2tzIHRoYXQgdGhlcmUgaXMKICAgIC8vLyAgbm8gcGVuZGluZyBwcmVnbmFuY3kuCiAgICBmdW5jdGlvbiBfaXNSZWFkeVRvQnJlZWQoTW9uc3RlciBfbW9uc3RlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gSW4gYWRkaXRpb24gdG8gY2hlY2tpbmcgdGhlIGNvb2xkb3duRW5kQmxvY2ssIHdlIGFsc28gbmVlZCB0byBjaGVjayB0byBzZWUgaWYKICAgICAgICAvLyB0aGUgbW9uc3RlciBoYXMgYSBwZW5kaW5nIGJpcnRoOyB0aGVyZSBjYW4gYmUgc29tZSBwZXJpb2Qgb2YgdGltZSBiZXR3ZWVuIHRoZSBlbmQKICAgICAgICAvLyBvZiB0aGUgcHJlZ25hY3kgdGltZXIgYW5kIHRoZSBiaXJ0aCBldmVudC4KICAgICAgICByZXR1cm4gKF9tb25zdGVyLnNpcmluZ1dpdGhJZCA9PSAwKSAmJiAoX21vbnN0ZXIuY29vbGRvd25FbmRCbG9jayA8PSB1aW50NjQoYmxvY2subnVtYmVyKSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2sgaWYgYSBzaXJlIGhhcyBhdXRob3JpemVkIGJyZWVkaW5nIHdpdGggdGhpcyBtYXRyb24uIFRydWUgaWYgYm90aCBzaXJlCiAgICAvLy8gIGFuZCBtYXRyb24gaGF2ZSB0aGUgc2FtZSBvd25lciwgb3IgaWYgdGhlIHNpcmUgaGFzIGdpdmVuIHNpcmluZyBwZXJtaXNzaW9uIHRvCiAgICAvLy8gIHRoZSBtYXRyb24ncyBvd25lciAodmlhIGFwcHJvdmVTaXJpbmcoKSkuCiAgICBmdW5jdGlvbiBfaXNTaXJpbmdQZXJtaXR0ZWQodWludDI1NiBfc2lyZUlkLCB1aW50MjU2IF9tYXRyb25JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWRkcmVzcyBtYXRyb25Pd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX21hdHJvbklkXTsKICAgICAgICBhZGRyZXNzIHNpcmVPd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX3NpcmVJZF07CgogICAgICAgIC8vIFNpcmluZyBpcyBva2F5IGlmIHRoZXkgaGF2ZSBzYW1lIG93bmVyLCBvciBpZiB0aGUgbWF0cm9uJ3Mgb3duZXIgd2FzIGdpdmVuCiAgICAgICAgLy8gcGVybWlzc2lvbiB0byBicmVlZCB3aXRoIHRoaXMgc2lyZS4KICAgICAgICByZXR1cm4gKG1hdHJvbk93bmVyID09IHNpcmVPd25lciB8fCBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfc2lyZUlkXSA9PSBtYXRyb25Pd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0IHRoZSBjb29sZG93bkVuZFRpbWUgZm9yIHRoZSBnaXZlbiBNb25zdGVyLCBiYXNlZCBvbiBpdHMgY3VycmVudCBjb29sZG93bkluZGV4LgogICAgLy8vICBBbHNvIGluY3JlbWVudHMgdGhlIGNvb2xkb3duSW5kZXggKHVubGVzcyBpdCBoYXMgaGl0IHRoZSBjYXApLgogICAgLy8vIEBwYXJhbSBfbW9uc3RlciBBIHJlZmVyZW5jZSB0byB0aGUgTW9uc3RlciBpbiBzdG9yYWdlIHdoaWNoIG5lZWRzIGl0cyB0aW1lciBzdGFydGVkLgogICAgZnVuY3Rpb24gX3RyaWdnZXJDb29sZG93bihNb25zdGVyIHN0b3JhZ2UgX21vbnN0ZXIpIGludGVybmFsIHsKICAgICAgICAvLyBDb21wdXRlIGFuIGVzdGltYXRpb24gb2YgdGhlIGNvb2xkb3duIHRpbWUgaW4gYmxvY2tzIChiYXNlZCBvbiBjdXJyZW50IGNvb2xkb3duSW5kZXgpLgogICAgICAgIF9tb25zdGVyLmNvb2xkb3duRW5kQmxvY2sgPSB1aW50NjQoKGNvb2xkb3duc1tfbW9uc3Rlci5jb29sZG93bkluZGV4XSAvIHNlY29uZHNQZXJCbG9jaykgKyBibG9jay5udW1iZXIpOwoKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGJyZWVkaW5nIGNvdW50LCBjbGFtcGluZyBpdCBhdCAxMywgd2hpY2ggaXMgdGhlIGxlbmd0aCBvZiB0aGUKICAgICAgICAvLyBjb29sZG93bnMgYXJyYXkuIFdlIGNvdWxkIGNoZWNrIHRoZSBhcnJheSBzaXplIGR5bmFtaWNhbGx5LCBidXQgaGFyZC1jb2RpbmcKICAgICAgICAvLyB0aGlzIGFzIGEgY29uc3RhbnQgc2F2ZXMgZ2FzLiBZYXksIFNvbGlkaXR5IQogICAgICAgIGlmIChfbW9uc3Rlci5jb29sZG93bkluZGV4IDwgMTMpIHsKICAgICAgICAgICAgX21vbnN0ZXIuY29vbGRvd25JbmRleCArPSAxOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBHcmFudHMgYXBwcm92YWwgdG8gYW5vdGhlciB1c2VyIHRvIHNpcmUgd2l0aCBvbmUgb2YgeW91ciBNb25zdGVycy4KICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFibGUgdG8gc2lyZSB3aXRoIHlvdXIgTW9uc3Rlci4gU2V0IHRvCiAgICAvLy8gIGFkZHJlc3MoMCkgdG8gY2xlYXIgYWxsIHNpcmluZyBhcHByb3ZhbHMgZm9yIHRoaXMgTW9uc3Rlci4KICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBBIE1vbnN0ZXIgdGhhdCB5b3Ugb3duIHRoYXQgX2FkZHIgd2lsbCBub3cgYmUgYWJsZSB0byBzaXJlIHdpdGguCiAgICAvLy8gS0VSTllTIOyZuOu2gOyXkOyEnCDslYTruaDqsIAg7Zi47Lac7ZWgIOyImCDsnojri6QuIChtZXRhIG1hc2vroZwpCiAgICBmdW5jdGlvbiBhcHByb3ZlU2lyaW5nKGFkZHJlc3MgX2FkZHIsIHVpbnQyNTYgX3NpcmVJZCkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfc2lyZUlkKSk7CiAgICAgICAgc2lyZUFsbG93ZWRUb0FkZHJlc3NbX3NpcmVJZF0gPSBfYWRkcjsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIHRoZSBtaW5pbXVtIHBheW1lbnQgcmVxdWlyZWQgZm9yIGNhbGxpbmcgZ2l2ZUJpcnRoQXV0bygpLiBDYW4gb25seQogICAgLy8vICBiZSBjYWxsZWQgYnkgdGhlIENPTyBhZGRyZXNzLiAoVGhpcyBmZWUgaXMgdXNlZCB0byBvZmZzZXQgdGhlIGdhcyBjb3N0IGluY3VycmVkCiAgICAvLy8gIGJ5IHRoZSBhdXRvYmlydGggZGFlbW9uKS4KICAgIGZ1bmN0aW9uIHNldEF1dG9CaXJ0aEZlZSh1aW50MjU2IHZhbCkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYXV0b0JpcnRoRmVlID0gdmFsOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyB0byBzZWUgaWYgYSBnaXZlbiBNb25zdGVyIGlzIHByZWduYW50IGFuZCAoaWYgc28pIGlmIHRoZSBnZXN0YXRpb24KICAgIC8vLyAgcGVyaW9kIGhhcyBwYXNzZWQuCiAgICBmdW5jdGlvbiBfaXNSZWFkeVRvR2l2ZUJpcnRoKE1vbnN0ZXIgX21hdHJvbikgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9tYXRyb24uc2lyaW5nV2l0aElkICE9IDApICYmIChfbWF0cm9uLmNvb2xkb3duRW5kQmxvY2sgPD0gdWludDY0KGJsb2NrLm51bWJlcikpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyB0aGF0IGEgZ2l2ZW4gbW9uc3RlciBpcyBhYmxlIHRvIGJyZWVkIChpLmUuIGl0IGlzIG5vdCBwcmVnbmFudCBvcgogICAgLy8vICBpbiB0aGUgbWlkZGxlIG9mIGEgc2lyaW5nIGNvb2xkb3duKS4KICAgIC8vLyBAcGFyYW0gX21vbnN0ZXJJZCByZWZlcmVuY2UgdGhlIGlkIG9mIHRoZSBtb25zdGVyLCBhbnkgdXNlciBjYW4gaW5xdWlyZSBhYm91dCBpdAogICAgZnVuY3Rpb24gaXNSZWFkeVRvQnJlZWQodWludDI1NiBfbW9uc3RlcklkKQogICAgcHVibGljCiAgICB2aWV3CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX21vbnN0ZXJJZCA+IDApOwogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBtb25zdGVyID0gbW9uc3RlcnNbX21vbnN0ZXJJZF07CiAgICAgICAgcmV0dXJuIF9pc1JlYWR5VG9CcmVlZChtb25zdGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3Mgd2hldGhlciBhIG1vbnN0ZXIgaXMgY3VycmVudGx5IHByZWduYW50LgogICAgLy8vIEBwYXJhbSBfbW9uc3RlcklkIHJlZmVyZW5jZSB0aGUgaWQgb2YgdGhlIG1vbnN0ZXIsIGFueSB1c2VyIGNhbiBpbnF1aXJlIGFib3V0IGl0CiAgICBmdW5jdGlvbiBpc1ByZWduYW50KHVpbnQyNTYgX21vbnN0ZXJJZCkKICAgIHB1YmxpYwogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9tb25zdGVySWQgPiAwKTsKICAgICAgICAvLyBBIG1vbnN0ZXIgaXMgcHJlZ25hbnQgaWYgYW5kIG9ubHkgaWYgdGhpcyBmaWVsZCBpcyBzZXQKICAgICAgICByZXR1cm4gbW9uc3RlcnNbX21vbnN0ZXJJZF0uc2lyaW5nV2l0aElkICE9IDA7CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgY2hlY2sgdG8gc2VlIGlmIGEgZ2l2ZW4gc2lyZSBhbmQgbWF0cm9uIGFyZSBhIHZhbGlkIG1hdGluZyBwYWlyLiBET0VTIE5PVAogICAgLy8vICBjaGVjayBvd25lcnNoaXAgcGVybWlzc2lvbnMgKHRoYXQgaXMgdXAgdG8gdGhlIGNhbGxlcikuCiAgICAvLy8gQHBhcmFtIF9tYXRyb24gQSByZWZlcmVuY2UgdG8gdGhlIE1vbnN0ZXIgc3RydWN0IG9mIHRoZSBwb3RlbnRpYWwgbWF0cm9uLgogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgVGhlIG1hdHJvbidzIElELgogICAgLy8vIEBwYXJhbSBfc2lyZSBBIHJlZmVyZW5jZSB0byB0aGUgTW9uc3RlciBzdHJ1Y3Qgb2YgdGhlIHBvdGVudGlhbCBzaXJlLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIFRoZSBzaXJlJ3MgSUQKICAgIGZ1bmN0aW9uIF9pc1ZhbGlkTWF0aW5nUGFpcigKICAgICAgICBNb25zdGVyIHN0b3JhZ2UgX21hdHJvbiwKICAgICAgICB1aW50MjU2IF9tYXRyb25JZCwKICAgICAgICBNb25zdGVyIHN0b3JhZ2UgX3NpcmUsCiAgICAgICAgdWludDI1NiBfc2lyZUlkCiAgICApCiAgICBwcml2YXRlCiAgICB2aWV3CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIEEgTW9uc3RlciBjYW4ndCBicmVlZCB3aXRoIGl0c2VsZiEKICAgICAgICBpZiAoX21hdHJvbklkID09IF9zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gTW9uc3RlcnMgY2FuJ3QgYnJlZWQgd2l0aCB0aGVpciBwYXJlbnRzLgogICAgICAgIGlmIChfbWF0cm9uLm1hdHJvbklkID09IF9zaXJlSWQgfHwgX21hdHJvbi5zaXJlSWQgPT0gX3NpcmVJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfc2lyZS5tYXRyb25JZCA9PSBfbWF0cm9uSWQgfHwgX3NpcmUuc2lyZUlkID09IF9tYXRyb25JZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBXZSBjYW4gc2hvcnQgY2lyY3VpdCB0aGUgc2libGluZyBjaGVjayAoYmVsb3cpIGlmIGVpdGhlciBtb25zdGVyIGlzCiAgICAgICAgLy8gZ2VuIHplcm8gKGhhcyBhIG1hdHJvbiBJRCBvZiB6ZXJvKS4KICAgICAgICBpZiAoX3NpcmUubWF0cm9uSWQgPT0gMCB8fCBfbWF0cm9uLm1hdHJvbklkID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBNb25zdGVycyBjYW4ndCBicmVlZCB3aXRoIGZ1bGwgb3IgaGFsZiBzaWJsaW5ncy4KICAgICAgICBpZiAoX3NpcmUubWF0cm9uSWQgPT0gX21hdHJvbi5tYXRyb25JZCB8fCBfc2lyZS5tYXRyb25JZCA9PSBfbWF0cm9uLnNpcmVJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfc2lyZS5zaXJlSWQgPT0gX21hdHJvbi5tYXRyb25JZCB8fCBfc2lyZS5zaXJlSWQgPT0gX21hdHJvbi5zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gRXZlcnl0aGluZyBzZWVtcyBjb29sISBMZXQncyBnZXQgRFRGLgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGNoZWNrIHRvIHNlZSBpZiBhIGdpdmVuIHNpcmUgYW5kIG1hdHJvbiBhcmUgYSB2YWxpZCBtYXRpbmcgcGFpciBmb3IKICAgIC8vLyAgYnJlZWRpbmcgdmlhIGF1Y3Rpb24gKGkuZS4gc2tpcHMgb3duZXJzaGlwIGFuZCBzaXJpbmcgYXBwcm92YWwgY2hlY2tzKS4KICAgIGZ1bmN0aW9uIF9jYW5CcmVlZFdpdGhWaWFBdWN0aW9uKHVpbnQyNTYgX21hdHJvbklkLCB1aW50MjU2IF9zaXJlSWQpCiAgICBpbnRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBNb25zdGVyIHN0b3JhZ2UgbWF0cm9uID0gbW9uc3RlcnNbX21hdHJvbklkXTsKICAgICAgICBNb25zdGVyIHN0b3JhZ2Ugc2lyZSA9IG1vbnN0ZXJzW19zaXJlSWRdOwogICAgICAgIHJldHVybiBfaXNWYWxpZE1hdGluZ1BhaXIobWF0cm9uLCBfbWF0cm9uSWQsIHNpcmUsIF9zaXJlSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyB0byBzZWUgaWYgdHdvIG1vbnN0ZXJzIGNhbiBicmVlZCB0b2dldGhlciwgaW5jbHVkaW5nIGNoZWNrcyBmb3IKICAgIC8vLyAgb3duZXJzaGlwIGFuZCBzaXJpbmcgYXBwcm92YWxzLiBEb2VzIE5PVCBjaGVjayB0aGF0IGJvdGggbW9uc3RlcnMgYXJlIHJlYWR5IGZvcgogICAgLy8vICBicmVlZGluZyAoaS5lLiBicmVlZFdpdGggY291bGQgc3RpbGwgZmFpbCB1bnRpbCB0aGUgY29vbGRvd25zIGFyZSBmaW5pc2hlZCkuCiAgICAvLy8gIFRPRE86IFNob3VsZG4ndCB0aGlzIGNoZWNrIHByZWduYW5jeSBhbmQgY29vbGRvd25zPyE/CiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCBUaGUgSUQgb2YgdGhlIHByb3Bvc2VkIG1hdHJvbi4KICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBUaGUgSUQgb2YgdGhlIHByb3Bvc2VkIHNpcmUuCiAgICBmdW5jdGlvbiBjYW5CcmVlZFdpdGgodWludDI1NiBfbWF0cm9uSWQsIHVpbnQyNTYgX3NpcmVJZCkKICAgIGV4dGVybmFsCiAgICB2aWV3CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX21hdHJvbklkID4gMCk7CiAgICAgICAgcmVxdWlyZShfc2lyZUlkID4gMCk7CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1hdHJvbiA9IG1vbnN0ZXJzW19tYXRyb25JZF07CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIHNpcmUgPSBtb25zdGVyc1tfc2lyZUlkXTsKICAgICAgICByZXR1cm4gX2lzVmFsaWRNYXRpbmdQYWlyKG1hdHJvbiwgX21hdHJvbklkLCBzaXJlLCBfc2lyZUlkKSAmJgogICAgICAgIF9pc1NpcmluZ1Blcm1pdHRlZChfc2lyZUlkLCBfbWF0cm9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIHV0aWxpdHkgZnVuY3Rpb24gdG8gaW5pdGlhdGUgYnJlZWRpbmcsIGFzc3VtZXMgdGhhdCBhbGwgYnJlZWRpbmcKICAgIC8vLyAgcmVxdWlyZW1lbnRzIGhhdmUgYmVlbiBjaGVja2VkLgogICAgZnVuY3Rpb24gX2JyZWVkV2l0aCh1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgTW9uc3RlcnMgZnJvbSBzdG9yYWdlLgogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBzaXJlID0gbW9uc3RlcnNbX3NpcmVJZF07CiAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1hdHJvbiA9IG1vbnN0ZXJzW19tYXRyb25JZF07CgogICAgICAgIC8vIE1hcmsgdGhlIG1hdHJvbiBhcyBwcmVnbmFudCwga2VlcGluZyB0cmFjayBvZiB3aG8gdGhlIHNpcmUgaXMuCiAgICAgICAgbWF0cm9uLnNpcmluZ1dpdGhJZCA9IHVpbnQzMihfc2lyZUlkKTsKCiAgICAgICAgLy8gVHJpZ2dlciB0aGUgY29vbGRvd24gZm9yIGJvdGggcGFyZW50cy4KICAgICAgICBfdHJpZ2dlckNvb2xkb3duKHNpcmUpOwogICAgICAgIF90cmlnZ2VyQ29vbGRvd24obWF0cm9uKTsKCiAgICAgICAgLy8gQ2xlYXIgc2lyaW5nIHBlcm1pc3Npb24gZm9yIGJvdGggcGFyZW50cy4gVGhpcyBtYXkgbm90IGJlIHN0cmljdGx5IG5lY2Vzc2FyeQogICAgICAgIC8vIGJ1dCBpdCdzIGxpa2VseSB0byBhdm9pZCBjb25mdXNpb24hCiAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19tYXRyb25JZF07CiAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19zaXJlSWRdOwoKICAgICAgICAvLyBFdmVyeSB0aW1lIGEgbW9uc3RlciBnZXRzIHByZWduYW50LCBjb3VudGVyIGlzIGluY3JlbWVudGVkLgogICAgICAgIHByZWduYW50TW9uc3RlcnMrKzsKCiAgICAgICAgLy8gRW1pdCB0aGUgcHJlZ25hbmN5IGV2ZW50LgogICAgICAgIFByZWduYW50KG1vbnN0ZXJJbmRleFRvT3duZXJbX21hdHJvbklkXSwgX21hdHJvbklkLCBfc2lyZUlkLCBtYXRyb24uY29vbGRvd25FbmRCbG9jayk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQnJlZWQgYSBNb25zdGVyIHlvdSBvd24gKGFzIG1hdHJvbikgd2l0aCBhIHNpcmUgdGhhdCB5b3Ugb3duLCBvciBmb3Igd2hpY2ggeW91CiAgICAvLy8gIGhhdmUgcHJldmlvdXNseSBiZWVuIGdpdmVuIFNpcmluZyBhcHByb3ZhbC4gV2lsbCBlaXRoZXIgbWFrZSB5b3VyIG1vbnN0ZXIgcHJlZ25hbnQsIG9yIHdpbGwKICAgIC8vLyAgZmFpbCBlbnRpcmVseS4gUmVxdWlyZXMgYSBwcmUtcGF5bWVudCBvZiB0aGUgZmVlIGdpdmVuIG91dCB0byB0aGUgZmlyc3QgY2FsbGVyIG9mIGdpdmVCaXJ0aCgpCiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCBUaGUgSUQgb2YgdGhlIE1vbnN0ZXIgYWN0aW5nIGFzIG1hdHJvbiAod2lsbCBlbmQgdXAgcHJlZ25hbnQgaWYgc3VjY2Vzc2Z1bCkKICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBUaGUgSUQgb2YgdGhlIE1vbnN0ZXIgYWN0aW5nIGFzIHNpcmUgKHdpbGwgYmVnaW4gaXRzIHNpcmluZyBjb29sZG93biBpZiBzdWNjZXNzZnVsKQogICAgZnVuY3Rpb24gYnJlZWRXaXRoQXV0byh1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBDaGVja3MgZm9yIHBheW1lbnQuCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gYXV0b0JpcnRoRmVlKTsKCiAgICAgICAgLy8gQ2FsbGVyIG11c3Qgb3duIHRoZSBtYXRyb24uCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfbWF0cm9uSWQpKTsKCiAgICAgICAgLy8gTmVpdGhlciBzaXJlIG5vciBtYXRyb24gYXJlIGFsbG93ZWQgdG8gYmUgb24gYXVjdGlvbiBkdXJpbmcgYSBub3JtYWwKICAgICAgICAvLyBicmVlZGluZyBvcGVyYXRpb24sIGJ1dCB3ZSBkb24ndCBuZWVkIHRvIGNoZWNrIHRoYXQgZXhwbGljaXRseS4KICAgICAgICAvLyBGb3IgbWF0cm9uOiBUaGUgY2FsbGVyIG9mIHRoaXMgZnVuY3Rpb24gY2FuJ3QgYmUgdGhlIG93bmVyIG9mIHRoZSBtYXRyb24KICAgICAgICAvLyAgIGJlY2F1c2UgdGhlIG93bmVyIG9mIGEgTW9uc3RlciBvbiBhdWN0aW9uIGlzIHRoZSBhdWN0aW9uIGhvdXNlLCBhbmQgdGhlCiAgICAgICAgLy8gICBhdWN0aW9uIGhvdXNlIHdpbGwgbmV2ZXIgY2FsbCBicmVlZFdpdGgoKS4KICAgICAgICAvLyBGb3Igc2lyZTogU2ltaWxhcmx5LCBhIHNpcmUgb24gYXVjdGlvbiB3aWxsIGJlIG93bmVkIGJ5IHRoZSBhdWN0aW9uIGhvdXNlCiAgICAgICAgLy8gICBhbmQgdGhlIGFjdCBvZiB0cmFuc2ZlcnJpbmcgb3duZXJzaGlwIHdpbGwgaGF2ZSBjbGVhcmVkIGFueSBvdXN0YW5kaW5nCiAgICAgICAgLy8gICBzaXJpbmcgYXBwcm92YWwuCiAgICAgICAgLy8gVGh1cyB3ZSBkb24ndCBuZWVkIHRvIHNwZW5kIGdhcyBleHBsaWNpdGx5IGNoZWNraW5nIHRvIHNlZSBpZiBlaXRoZXIgbW9uc3RlcgogICAgICAgIC8vIGlzIG9uIGF1Y3Rpb24uCgogICAgICAgIC8vIENoZWNrIHRoYXQgbWF0cm9uIGFuZCBzaXJlIGFyZSBib3RoIG93bmVkIGJ5IGNhbGxlciwgb3IgdGhhdCB0aGUgc2lyZQogICAgICAgIC8vIGhhcyBnaXZlbiBzaXJpbmcgcGVybWlzc2lvbiB0byBjYWxsZXIgKGkuZS4gbWF0cm9uJ3Mgb3duZXIpLgogICAgICAgIC8vIFdpbGwgZmFpbCBmb3IgX3NpcmVJZCA9IDAKICAgICAgICByZXF1aXJlKF9pc1NpcmluZ1Blcm1pdHRlZChfc2lyZUlkLCBfbWF0cm9uSWQpKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgcG90ZW50aWFsIG1hdHJvbgogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBtYXRyb24gPSBtb25zdGVyc1tfbWF0cm9uSWRdOwoKICAgICAgICAvLyBNYWtlIHN1cmUgbWF0cm9uIGlzbid0IHByZWduYW50LCBvciBpbiB0aGUgbWlkZGxlIG9mIGEgc2lyaW5nIGNvb2xkb3duCiAgICAgICAgcmVxdWlyZShfaXNSZWFkeVRvQnJlZWQobWF0cm9uKSk7CgogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHBvdGVudGlhbCBzaXJlCiAgICAgICAgTW9uc3RlciBzdG9yYWdlIHNpcmUgPSBtb25zdGVyc1tfc2lyZUlkXTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHNpcmUgaXNuJ3QgcHJlZ25hbnQsIG9yIGluIHRoZSBtaWRkbGUgb2YgYSBzaXJpbmcgY29vbGRvd24KICAgICAgICByZXF1aXJlKF9pc1JlYWR5VG9CcmVlZChzaXJlKSk7CgogICAgICAgIC8vIFRlc3QgdGhhdCB0aGVzZSBtb25zdGVycyBhcmUgYSB2YWxpZCBtYXRpbmcgcGFpci4KICAgICAgICByZXF1aXJlKF9pc1ZhbGlkTWF0aW5nUGFpcigKICAgICAgICAgICAgICAgIG1hdHJvbiwKICAgICAgICAgICAgICAgIF9tYXRyb25JZCwKICAgICAgICAgICAgICAgIHNpcmUsCiAgICAgICAgICAgICAgICBfc2lyZUlkCiAgICAgICAgICAgICkpOwoKICAgICAgICAvLyBBbGwgY2hlY2tzIHBhc3NlZCwgbW9uc3RlciBnZXRzIHByZWduYW50IQogICAgICAgIF9icmVlZFdpdGgoX21hdHJvbklkLCBfc2lyZUlkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBIYXZlIGEgcHJlZ25hbnQgTW9uc3RlciBnaXZlIGJpcnRoIQogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgQSBNb25zdGVyIHJlYWR5IHRvIGdpdmUgYmlydGguCiAgICAvLy8gQHJldHVybiBUaGUgTW9uc3RlciBJRCBvZiB0aGUgbmV3IG1vbnN0ZXIuCiAgICAvLy8gQGRldiBMb29rcyBhdCBhIGdpdmVuIE1vbnN0ZXIgYW5kLCBpZiBwcmVnbmFudCBhbmQgaWYgdGhlIGdlc3RhdGlvbiBwZXJpb2QgaGFzIHBhc3NlZCwKICAgIC8vLyAgY29tYmluZXMgdGhlIGdlbmVzIG9mIHRoZSB0d28gcGFyZW50cyB0byBjcmVhdGUgYSBuZXcgbW9uc3Rlci4gVGhlIG5ldyBNb25zdGVyIGlzIGFzc2lnbmVkCiAgICAvLy8gIHRvIHRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSBtYXRyb24uIFVwb24gc3VjY2Vzc2Z1bCBjb21wbGV0aW9uLCBib3RoIHRoZSBtYXRyb24gYW5kIHRoZQogICAgLy8vICBuZXcgbW9uc3RlciB3aWxsIGJlIHJlYWR5IHRvIGJyZWVkIGFnYWluLiBOb3RlIHRoYXQgYW55b25lIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24gKGlmIHRoZXkKICAgIC8vLyAgYXJlIHdpbGxpbmcgdG8gcGF5IHRoZSBnYXMhKSwgYnV0IHRoZSBuZXcgbW9uc3RlciBhbHdheXMgZ29lcyB0byB0aGUgbW90aGVyJ3Mgb3duZXIuCiAgICBmdW5jdGlvbiBnaXZlQmlydGgodWludDI1NiBfbWF0cm9uSWQpCiAgICBleHRlcm5hbAogICAgb25seUNPTwogICAgd2hlbk5vdFBhdXNlZAogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBtYXRyb24gaW4gc3RvcmFnZS4KICAgICAgICBNb25zdGVyIHN0b3JhZ2UgbWF0cm9uID0gbW9uc3RlcnNbX21hdHJvbklkXTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgbWF0cm9uIGlzIGEgdmFsaWQgbW9uc3Rlci4KICAgICAgICByZXF1aXJlKG1hdHJvbi5iaXJ0aFRpbWUgIT0gMCk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIG1hdHJvbiBpcyBwcmVnbmFudCwgYW5kIHRoYXQgaXRzIHRpbWUgaGFzIGNvbWUhCiAgICAgICAgcmVxdWlyZShfaXNSZWFkeVRvR2l2ZUJpcnRoKG1hdHJvbikpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzaXJlIGluIHN0b3JhZ2UuCiAgICAgICAgdWludDI1NiBzaXJlSWQgPSBtYXRyb24uc2lyaW5nV2l0aElkOwogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBzaXJlID0gbW9uc3RlcnNbc2lyZUlkXTsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBoaWdoZXIgZ2VuZXJhdGlvbiBudW1iZXIgb2YgdGhlIHR3byBwYXJlbnRzCiAgICAgICAgdWludDE2IHBhcmVudEdlbiA9IG1hdHJvbi5nZW5lcmF0aW9uOwogICAgICAgIGlmIChzaXJlLmdlbmVyYXRpb24gPiBtYXRyb24uZ2VuZXJhdGlvbikgewogICAgICAgICAgICBwYXJlbnRHZW4gPSBzaXJlLmdlbmVyYXRpb247CiAgICAgICAgfQoKICAgICAgICAvLyBDYWxsIHRoZSBzb29wZXItc2VrcmV0IGdlbmUgbWl4aW5nIG9wZXJhdGlvbi4KICAgICAgICAvLyB0YXJnZXRCbG9jawogICAgICAgIHVpbnQyNTYgY2hpbGRHZW5lcyA9IGdlbmVTY2llbmNlLm1peEdlbmVzKG1hdHJvbi5nZW5lcywgc2lyZS5nZW5lcywgbWF0cm9uLmNvb2xkb3duRW5kQmxvY2sgLSAxKTsKCiAgICAgICAgLy8gTWFrZSB0aGUgbmV3IG1vbnN0ZXIhCiAgICAgICAgYWRkcmVzcyBvd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX21hdHJvbklkXTsKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKF9tYXRyb25JZCwgbWF0cm9uLnNpcmluZ1dpdGhJZCwgcGFyZW50R2VuICsgMSwgY2hpbGRHZW5lcywgb3duZXIpOwoKICAgICAgICAvLyBDbGVhciB0aGUgcmVmZXJlbmNlIHRvIHNpcmUgZnJvbSB0aGUgbWF0cm9uIChSRVFVSVJFRCEgSGF2aW5nIHNpcmluZ1dpdGhJZAogICAgICAgIC8vIHNldCBpcyB3aGF0IG1hcmtzIGEgbWF0cm9uIGFzIGJlaW5nIHByZWduYW50LikKICAgICAgICBkZWxldGUgbWF0cm9uLnNpcmluZ1dpdGhJZDsKCiAgICAgICAgLy8gRXZlcnkgdGltZSBhIG1vbnN0ZXIgZ2l2ZXMgYmlydGggY291bnRlciBpcyBkZWNyZW1lbnRlZC4KICAgICAgICBwcmVnbmFudE1vbnN0ZXJzLS07CgogICAgICAgIC8vIFNlbmQgdGhlIGJhbGFuY2UgZmVlIHRvIHRoZSBwZXJzb24gd2hvIG1hZGUgYmlydGggaGFwcGVuLgogICAgICAgIG1zZy5zZW5kZXIuc2VuZChhdXRvQmlydGhGZWUpOwoKICAgICAgICAvLyByZXR1cm4gdGhlIG5ldyBtb25zdGVyJ3MgSUQKICAgICAgICByZXR1cm4gbW9uc3RlcklkOwogICAgfQp9CgoKCgoKCgoKCgoKCi8vLyBAdGl0bGUgSGFuZGxlcyBjcmVhdGluZyBhdWN0aW9ucyBmb3Igc2FsZSBhbmQgc2lyaW5nIG9mIG1vbnN0ZXJzLgovLy8gIFRoaXMgd3JhcHBlciBvZiBSZXZlcnNlQXVjdGlvbiBleGlzdHMgb25seSBzbyB0aGF0IHVzZXJzIGNhbiBjcmVhdGUKLy8vICBhdWN0aW9ucyB3aXRoIG9ubHkgb25lIHRyYW5zYWN0aW9uLgpjb250cmFjdCBNb25zdGVyQXVjdGlvbiBpcyBNb25zdGVyQnJlZWRpbmcgewoKICAgIC8vIEBub3RpY2UgVGhlIGF1Y3Rpb24gY29udHJhY3QgdmFyaWFibGVzIGFyZSBkZWZpbmVkIGluIE1vbnN0ZXJCYXNlIHRvIGFsbG93CiAgICAvLyAgdXMgdG8gcmVmZXIgdG8gdGhlbSBpbiBNb25zdGVyT3duZXJzaGlwIHRvIHByZXZlbnQgYWNjaWRlbnRhbCB0cmFuc2ZlcnMuCiAgICAvLyBgc2FsZUF1Y3Rpb25gIHJlZmVycyB0byB0aGUgYXVjdGlvbiBmb3IgZ2VuMCBhbmQgcDJwIHNhbGUgb2YgbW9uc3RlcnMuCiAgICAvLyBgc2lyaW5nQXVjdGlvbmAgcmVmZXJzIHRvIHRoZSBhdWN0aW9uIGZvciBzaXJpbmcgcmlnaHRzIG9mIG1vbnN0ZXJzLgoKICAgIC8vLyBAZGV2IFNldHMgdGhlIHJlZmVyZW5jZSB0byB0aGUgc2FsZSBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYWRkcmVzcyAtIEFkZHJlc3Mgb2Ygc2FsZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHNldFNhbGVBdWN0aW9uQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICBTYWxlQ2xvY2tBdWN0aW9uIGNhbmRpZGF0ZUNvbnRyYWN0ID0gU2FsZUNsb2NrQXVjdGlvbihfYWRkcmVzcyk7CgogICAgICAgIC8vIE5PVEU6IHZlcmlmeSB0aGF0IGEgY29udHJhY3QgaXMgd2hhdCB3ZSBleHBlY3QgLSBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iL2NmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzU2FsZUNsb2NrQXVjdGlvbigpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIHNhbGVBdWN0aW9uID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0cyB0aGUgcmVmZXJlbmNlIHRvIHRoZSBzaXJpbmcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2FkZHJlc3MgLSBBZGRyZXNzIG9mIHNpcmluZyBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHNldFNpcmluZ0F1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIFNpcmluZ0Nsb2NrQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IFNpcmluZ0Nsb2NrQXVjdGlvbihfYWRkcmVzcyk7CgogICAgICAgIC8vIE5PVEU6IHZlcmlmeSB0aGF0IGEgY29udHJhY3QgaXMgd2hhdCB3ZSBleHBlY3QgLSBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iL2NmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzU2lyaW5nQ2xvY2tBdWN0aW9uKCkpOwoKICAgICAgICAvLyBTZXQgdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgc2lyaW5nQXVjdGlvbiA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IFB1dCBhIG1vbnN0ZXIgdXAgZm9yIGF1Y3Rpb24uCiAgICAvLy8gIERvZXMgc29tZSBvd25lcnNoaXAgdHJpY2tlcnkgdG8gY3JlYXRlIGF1Y3Rpb25zIGluIG9uZSB0eC4KICAgIGZ1bmN0aW9uIGNyZWF0ZVNhbGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX21vbnN0ZXJJZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIEF1Y3Rpb24gY29udHJhY3QgY2hlY2tzIGlucHV0IHNpemVzCiAgICAgICAgLy8gSWYgbW9uc3RlciBpcyBhbHJlYWR5IG9uIGFueSBhdWN0aW9uLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfbW9uc3RlcklkKSk7CiAgICAgICAgLy8gRW5zdXJlIHRoZSBtb25zdGVyIGlzIG5vdCBwcmVnbmFudCB0byBwcmV2ZW50IHRoZSBhdWN0aW9uCiAgICAgICAgLy8gY29udHJhY3QgYWNjaWRlbnRhbGx5IHJlY2VpdmluZyBvd25lcnNoaXAgb2YgdGhlIGNoaWxkLgogICAgICAgIC8vIE5PVEU6IHRoZSBtb25zdGVyIElTIGFsbG93ZWQgdG8gYmUgaW4gYSBjb29sZG93bi4KICAgICAgICByZXF1aXJlKCFpc1ByZWduYW50KF9tb25zdGVySWQpKTsKICAgICAgICBfYXBwcm92ZShfbW9uc3RlcklkLCBzYWxlQXVjdGlvbik7CiAgICAgICAgLy8gU2FsZSBhdWN0aW9uIHRocm93cyBpZiBpbnB1dHMgYXJlIGludmFsaWQgYW5kIGNsZWFycwogICAgICAgIC8vIHRyYW5zZmVyIGFuZCBzaXJlIGFwcHJvdmFsIGFmdGVyIGVzY3Jvd2luZyB0aGUgbW9uc3Rlci4KICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfbW9uc3RlcklkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IFB1dCBhIG1vbnN0ZXIgdXAgZm9yIGF1Y3Rpb24gdG8gYmUgc2lyZS4KICAgIC8vLyAgUGVyZm9ybXMgY2hlY2tzIHRvIGVuc3VyZSB0aGUgbW9uc3RlciBjYW4gYmUgc2lyZWQsIHRoZW4KICAgIC8vLyAgZGVsZWdhdGVzIHRvIHJldmVyc2UgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZVNpcmluZ0F1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfbW9uc3RlcklkLAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24KICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQXVjdGlvbiBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBtb25zdGVyIGlzIGFscmVhZHkgb24gYW55IGF1Y3Rpb24sIHRoaXMgd2lsbCB0aHJvdwogICAgICAgIC8vIGJlY2F1c2UgaXQgd2lsbCBiZSBvd25lZCBieSB0aGUgYXVjdGlvbiBjb250cmFjdC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9tb25zdGVySWQpKTsKICAgICAgICByZXF1aXJlKGlzUmVhZHlUb0JyZWVkKF9tb25zdGVySWQpKTsKICAgICAgICBfYXBwcm92ZShfbW9uc3RlcklkLCBzaXJpbmdBdWN0aW9uKTsKICAgICAgICAvLyBTaXJpbmcgYXVjdGlvbiB0aHJvd3MgaWYgaW5wdXRzIGFyZSBpbnZhbGlkIGFuZCBjbGVhcnMKICAgICAgICAvLyB0cmFuc2ZlciBhbmQgc2lyZSBhcHByb3ZhbCBhZnRlciBlc2Nyb3dpbmcgdGhlIG1vbnN0ZXIuCiAgICAgICAgc2lyaW5nQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfbW9uc3RlcklkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXBsZXRlcyBhIHNpcmluZyBhdWN0aW9uIGJ5IGJpZGRpbmcuCiAgICAvLy8gIEltbWVkaWF0ZWx5IGJyZWVkcyB0aGUgd2lubmluZyBtYXRyb24gd2l0aCB0aGUgc2lyZSBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIC0gSUQgb2YgdGhlIHNpcmUgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIC0gSUQgb2YgdGhlIG1hdHJvbiBvd25lZCBieSB0aGUgYmlkZGVyLgogICAgZnVuY3Rpb24gYmlkT25TaXJpbmdBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3NpcmVJZCwKICAgICAgICB1aW50MjU2IF9tYXRyb25JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHBheWFibGUKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBBdWN0aW9uIGNvbnRyYWN0IGNoZWNrcyBpbnB1dCBzaXplcwogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX21hdHJvbklkKSk7CiAgICAgICAgcmVxdWlyZShpc1JlYWR5VG9CcmVlZChfbWF0cm9uSWQpKTsKICAgICAgICByZXF1aXJlKF9jYW5CcmVlZFdpdGhWaWFBdWN0aW9uKF9tYXRyb25JZCwgX3NpcmVJZCkpOwoKICAgICAgICAvLyBEZWZpbmUgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgdGhlIGF1Y3Rpb24uCiAgICAgICAgdWludDI1NiBjdXJyZW50UHJpY2UgPSBzaXJpbmdBdWN0aW9uLmdldEN1cnJlbnRQcmljZShfc2lyZUlkKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBjdXJyZW50UHJpY2UgKyBhdXRvQmlydGhGZWUpOwoKICAgICAgICAvLyBTaXJpbmcgYXVjdGlvbiB3aWxsIHRocm93IGlmIHRoZSBiaWQgZmFpbHMuCiAgICAgICAgc2lyaW5nQXVjdGlvbi5iaWQudmFsdWUobXNnLnZhbHVlIC0gYXV0b0JpcnRoRmVlKShfc2lyZUlkKTsKICAgICAgICBfYnJlZWRXaXRoKHVpbnQzMihfbWF0cm9uSWQpLCB1aW50MzIoX3NpcmVJZCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyB0aGUgYmFsYW5jZSBvZiB0aGUgc2FsZSBhdWN0aW9uIGNvbnRyYWN0CiAgICAvLy8gdG8gdGhlIE1vbnN0ZXJDb3JlIGNvbnRyYWN0LiBXZSB1c2UgdHdvLXN0ZXAgd2l0aGRyYXdhbCB0bwogICAgLy8vIHByZXZlbnQgdHdvIHRyYW5zZmVyIGNhbGxzIGluIHRoZSBhdWN0aW9uIGJpZCBmdW5jdGlvbi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QXVjdGlvbkJhbGFuY2VzKCkgZXh0ZXJuYWwgb25seUNMZXZlbCB7CiAgICAgICAgc2FsZUF1Y3Rpb24ud2l0aGRyYXdCYWxhbmNlKCk7CiAgICAgICAgc2lyaW5nQXVjdGlvbi53aXRoZHJhd0JhbGFuY2UoKTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgYWxsIGZ1bmN0aW9ucyByZWxhdGVkIHRvIGNyZWF0aW5nIG1vbnN0ZXJzCmNvbnRyYWN0IE1vbnN0ZXJNaW50aW5nIGlzIE1vbnN0ZXJBdWN0aW9uIHsKCiAgICAvLyBMaW1pdHMgdGhlIG51bWJlciBvZiBtb25zdGVycyB0aGUgY29udHJhY3Qgb3duZXIgY2FuIGV2ZXIgY3JlYXRlLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJPTU9fQ1JFQVRJT05fTElNSVQgPSA1MDAwOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR0VOMF9DUkVBVElPTl9MSU1JVCA9IDQ1MDAwOwoKICAgIC8vIENvbnN0YW50cyBmb3IgZ2VuMCBhdWN0aW9ucy4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEdFTjBfU1RBUlRJTkdfUFJJQ0UgPSAxMCBmaW5uZXk7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX0FVQ1RJT05fRFVSQVRJT04gPSAxIGRheXM7CgogICAgLy8gQ291bnRzIHRoZSBudW1iZXIgb2YgbW9uc3RlcnMgdGhlIGNvbnRyYWN0IG93bmVyIGhhcyBjcmVhdGVkLgogICAgdWludDI1NiBwdWJsaWMgcHJvbW9DcmVhdGVkQ291bnQ7CiAgICB1aW50MjU2IHB1YmxpYyBnZW4wQ3JlYXRlZENvdW50OwoKICAgIC8vLyBAZGV2IHdlIGNhbiBjcmVhdGUgcHJvbW8gbW9uc3RlcnMsIHVwIHRvIGEgbGltaXQuIE9ubHkgY2FsbGFibGUgYnkgQ09PCiAgICAvLy8gQHBhcmFtIF9nZW5lcyB0aGUgZW5jb2RlZCBnZW5lcyBvZiB0aGUgbW9uc3RlciB0byBiZSBjcmVhdGVkLCBhbnkgdmFsdWUgaXMgYWNjZXB0ZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIHRoZSBmdXR1cmUgb3duZXIgb2YgdGhlIGNyZWF0ZWQgbW9uc3RlcnMuIERlZmF1bHQgdG8gY29udHJhY3QgQ09PCiAgICBmdW5jdGlvbiBjcmVhdGVQcm9tb01vbnN0ZXIodWludDI1NiBfZ2VuZXMsIGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICBhZGRyZXNzIG1vbnN0ZXJPd25lciA9IF9vd25lcjsKICAgICAgICBpZiAobW9uc3Rlck93bmVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgbW9uc3Rlck93bmVyID0gY29vQWRkcmVzczsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShwcm9tb0NyZWF0ZWRDb3VudCA8IFBST01PX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgcHJvbW9DcmVhdGVkQ291bnQrKzsKICAgICAgICBfY3JlYXRlTW9uc3RlcigwLCAwLCAwLCBfZ2VuZXMsIG1vbnN0ZXJPd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhIG5ldyBnZW4wIG1vbnN0ZXIgd2l0aCB0aGUgZ2l2ZW4gZ2VuZXMgYW5kCiAgICAvLy8gIGNyZWF0ZXMgYW4gYXVjdGlvbiBmb3IgaXQuCiAgICBmdW5jdGlvbiBjcmVhdGVHZW4wQXVjdGlvbih1aW50MjU2IF9nZW5lcykgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgcmVxdWlyZShnZW4wQ3JlYXRlZENvdW50IDwgR0VOMF9DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIHVpbnQyNTYgZ2VuZXMgPSBfZ2VuZXM7CiAgICAgICAgaWYoZ2VuZXMgPT0gMCkKICAgICAgICAgICAgZ2VuZXMgPSBnZW5lU2NpZW5jZS5yYW5kb21HZW5lcygpOwoKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKDAsIDAsIDAsIGdlbmVzLCBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfYXBwcm92ZShtb25zdGVySWQsIHNhbGVBdWN0aW9uKTsKCiAgICAgICAgc2FsZUF1Y3Rpb24uY3JlYXRlQXVjdGlvbigKICAgICAgICAgICAgbW9uc3RlcklkLAogICAgICAgICAgICBfY29tcHV0ZU5leHRHZW4wUHJpY2UoKSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgR0VOMF9BVUNUSU9OX0RVUkFUSU9OLAogICAgICAgICAgICBhZGRyZXNzKHRoaXMpCiAgICAgICAgKTsKCiAgICAgICAgZ2VuMENyZWF0ZWRDb3VudCsrOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBuZXh0IGdlbjAgYXVjdGlvbiBzdGFydGluZyBwcmljZSwgZ2l2ZW4KICAgIC8vLyAgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHBhc3QgNSBwcmljZXMgKyA1MCUuCiAgICBmdW5jdGlvbiBfY29tcHV0ZU5leHRHZW4wUHJpY2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGF2ZVByaWNlID0gc2FsZUF1Y3Rpb24uYXZlcmFnZUdlbjBTYWxlUHJpY2UoKTsKCiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRvIGVuc3VyZSB3ZSBkb24ndCBvdmVyZmxvdyBhcml0aG1ldGljCiAgICAgICAgcmVxdWlyZShhdmVQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoYXZlUHJpY2UpKSk7CgogICAgICAgIHVpbnQyNTYgbmV4dFByaWNlID0gYXZlUHJpY2UgKyAoYXZlUHJpY2UgLyAyKTsKCiAgICAgICAgLy8gV2UgbmV2ZXIgYXVjdGlvbiBmb3IgbGVzcyB0aGFuIHN0YXJ0aW5nIHByaWNlCiAgICAgICAgaWYgKG5leHRQcmljZSA8IEdFTjBfU1RBUlRJTkdfUFJJQ0UpIHsKICAgICAgICAgICAgbmV4dFByaWNlID0gR0VOMF9TVEFSVElOR19QUklDRTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXh0UHJpY2U7CiAgICB9Cn0KCgovLy8gQHRpdGxlIENyeXB0b01vbnN0ZXJzOiBDb2xsZWN0aWJsZSwgYnJlZWRhYmxlLCBhbmQgb2gtc28tYWRvcmFibGUgbW9uc3RlcnMgb24gdGhlIEV0aGVyZXVtIGJsb2NrY2hhaW4uCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFRoZSBtYWluIENyeXB0b01vbnN0ZXJzIGNvbnRyYWN0LCBrZWVwcyB0cmFjayBvZiBtb25zdGVycyBzbyB0aGV5IGRvbid0IHdhbmRlciBhcm91bmQgYW5kIGdldCBsb3N0Lgpjb250cmFjdCBNb25zdGVyQ29yZSBpcyBNb25zdGVyTWludGluZyB7CgogICAgLy8gVGhpcyBpcyB0aGUgbWFpbiBDcnlwdG9Nb25zdGVycyBjb250cmFjdC4gSW4gb3JkZXIgdG8ga2VlcCBvdXIgY29kZSBzZXBlcmF0ZWQgaW50byBsb2dpY2FsIHNlY3Rpb25zLAogICAgLy8gd2UndmUgYnJva2VuIGl0IHVwIGluIHR3byB3YXlzLiBGaXJzdCwgd2UgaGF2ZSBzZXZlcmFsIHNlcGVyYXRlbHktaW5zdGFudGlhdGVkIHNpYmxpbmcgY29udHJhY3RzCiAgICAvLyB0aGF0IGhhbmRsZSBhdWN0aW9ucyBhbmQgb3VyIHN1cGVyLXRvcC1zZWNyZXQgZ2VuZXRpYyBjb21iaW5hdGlvbiBhbGdvcml0aG0uIFRoZSBhdWN0aW9ucyBhcmUKICAgIC8vIHNlcGVyYXRlIHNpbmNlIHRoZWlyIGxvZ2ljIGlzIHNvbWV3aGF0IGNvbXBsZXggYW5kIHRoZXJlJ3MgYWx3YXlzIGEgcmlzayBvZiBzdWJ0bGUgYnVncy4gQnkga2VlcGluZwogICAgLy8gdGhlbSBpbiB0aGVpciBvd24gY29udHJhY3RzLCB3ZSBjYW4gdXBncmFkZSB0aGVtIHdpdGhvdXQgZGlzcnVwdGluZyB0aGUgbWFpbiBjb250cmFjdCB0aGF0IHRyYWNrcwogICAgLy8gbW9uc3RlciBvd25lcnNoaXAuIFRoZSBnZW5ldGljIGNvbWJpbmF0aW9uIGFsZ29yaXRobSBpcyBrZXB0IHNlcGVyYXRlIHNvIHdlIGNhbiBvcGVuLXNvdXJjZSBhbGwgb2YKICAgIC8vIHRoZSByZXN0IG9mIG91ciBjb2RlIHdpdGhvdXQgbWFraW5nIGl0IF90b29fIGVhc3kgZm9yIGZvbGtzIHRvIGZpZ3VyZSBvdXQgaG93IHRoZSBnZW5ldGljcyB3b3JrLgogICAgLy8gRG9uJ3Qgd29ycnksIEknbSBzdXJlIHNvbWVvbmUgd2lsbCByZXZlcnNlIGVuZ2luZWVyIGl0IHNvb24gZW5vdWdoIQogICAgLy8KICAgIC8vIFNlY29uZGx5LCB3ZSBicmVhayB0aGUgY29yZSBjb250cmFjdCBpbnRvIG11bHRpcGxlIGZpbGVzIHVzaW5nIGluaGVyaXRlbmNlLCBvbmUgZm9yIGVhY2ggbWFqb3IKICAgIC8vIGZhY2V0IG9mIGZ1bmN0aW9uYWxpdHkgb2YgQ0suIFRoaXMgYWxsb3dzIHVzIHRvIGtlZXAgcmVsYXRlZCBjb2RlIGJ1bmRsZWQgdG9nZXRoZXIgd2hpbGUgc3RpbGwKICAgIC8vIGF2b2lkaW5nIGEgc2luZ2xlIGdpYW50IGZpbGUgd2l0aCBldmVyeXRoaW5nIGluIGl0LiBUaGUgYnJlYWtkb3duIGlzIGFzIGZvbGxvd3M6CiAgICAvLwogICAgLy8gICAgICAtIE1vbnN0ZXJCYXNlOiBUaGlzIGlzIHdoZXJlIHdlIGRlZmluZSB0aGUgbW9zdCBmdW5kYW1lbnRhbCBjb2RlIHNoYXJlZCB0aHJvdWdob3V0IHRoZSBjb3JlCiAgICAvLyAgICAgICAgICAgICBmdW5jdGlvbmFsaXR5LiBUaGlzIGluY2x1ZGVzIG91ciBtYWluIGRhdGEgc3RvcmFnZSwgY29uc3RhbnRzIGFuZCBkYXRhIHR5cGVzLCBwbHVzCiAgICAvLyAgICAgICAgICAgICBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIHRoZXNlIGl0ZW1zLgogICAgLy8KICAgIC8vICAgICAgLSBNb25zdGVyQWNjZXNzQ29udHJvbDogVGhpcyBjb250cmFjdCBtYW5hZ2VzIHRoZSB2YXJpb3VzIGFkZHJlc3NlcyBhbmQgY29uc3RyYWludHMgZm9yIG9wZXJhdGlvbnMKICAgIC8vICAgICAgICAgICAgIHRoYXQgY2FuIGJlIGV4ZWN1dGVkIG9ubHkgYnkgc3BlY2lmaWMgcm9sZXMuIE5hbWVseSBDRU8sIENGTyBhbmQgQ09PLgogICAgLy8KICAgIC8vICAgICAgLSBNb25zdGVyT3duZXJzaGlwOiBUaGlzIHByb3ZpZGVzIHRoZSBtZXRob2RzIHJlcXVpcmVkIGZvciBiYXNpYyBub24tZnVuZ2libGUgdG9rZW4KICAgIC8vICAgICAgICAgICAgIHRyYW5zYWN0aW9ucywgZm9sbG93aW5nIHRoZSBkcmFmdCBFUkMtNzIxIHNwZWMgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEpLgogICAgLy8KICAgIC8vICAgICAgLSBNb25zdGVyQnJlZWRpbmc6IFRoaXMgZmlsZSBjb250YWlucyB0aGUgbWV0aG9kcyBuZWNlc3NhcnkgdG8gYnJlZWQgbW9uc3RlcnMgdG9nZXRoZXIsIGluY2x1ZGluZwogICAgLy8gICAgICAgICAgICAga2VlcGluZyB0cmFjayBvZiBzaXJpbmcgb2ZmZXJzLCBhbmQgcmVsaWVzIG9uIGFuIGV4dGVybmFsIGdlbmV0aWMgY29tYmluYXRpb24gY29udHJhY3QuCiAgICAvLwogICAgLy8gICAgICAtIE1vbnN0ZXJBdWN0aW9uczogSGVyZSB3ZSBoYXZlIHRoZSBwdWJsaWMgbWV0aG9kcyBmb3IgYXVjdGlvbmluZyBvciBiaWRkaW5nIG9uIG1vbnN0ZXJzIG9yIHNpcmluZwogICAgLy8gICAgICAgICAgICAgc2VydmljZXMuIFRoZSBhY3R1YWwgYXVjdGlvbiBmdW5jdGlvbmFsaXR5IGlzIGhhbmRsZWQgaW4gdHdvIHNpYmxpbmcgY29udHJhY3RzIChvbmUKICAgIC8vICAgICAgICAgICAgIGZvciBzYWxlcyBhbmQgb25lIGZvciBzaXJpbmcpLCB3aGlsZSBhdWN0aW9uIGNyZWF0aW9uIGFuZCBiaWRkaW5nIGlzIG1vc3RseSBtZWRpYXRlZAogICAgLy8gICAgICAgICAgICAgdGhyb3VnaCB0aGlzIGZhY2V0IG9mIHRoZSBjb3JlIGNvbnRyYWN0LgogICAgLy8KICAgIC8vICAgICAgLSBNb25zdGVyTWludGluZzogVGhpcyBmaW5hbCBmYWNldCBjb250YWlucyB0aGUgZnVuY3Rpb25hbGl0eSB3ZSB1c2UgZm9yIGNyZWF0aW5nIG5ldyBnZW4wIG1vbnN0ZXJzLgogICAgLy8gICAgICAgICAgICAgV2UgY2FuIG1ha2UgdXAgdG8gNTAwMCAicHJvbW8iIG1vbnN0ZXJzIHRoYXQgY2FuIGJlIGdpdmVuIGF3YXkgKGVzcGVjaWFsbHkgaW1wb3J0YW50IHdoZW4KICAgIC8vICAgICAgICAgICAgIHRoZSBjb21tdW5pdHkgaXMgbmV3KSwgYW5kIGFsbCBvdGhlcnMgY2FuIG9ubHkgYmUgY3JlYXRlZCBhbmQgdGhlbiBpbW1lZGlhdGVseSBwdXQgdXAKICAgIC8vICAgICAgICAgICAgIGZvciBhdWN0aW9uIHZpYSBhbiBhbGdvcml0aG1pY2FsbHkgZGV0ZXJtaW5lZCBzdGFydGluZyBwcmljZS4gUmVnYXJkbGVzcyBvZiBob3cgdGhleQogICAgLy8gICAgICAgICAgICAgYXJlIGNyZWF0ZWQsIHRoZXJlIGlzIGEgaGFyZCBsaW1pdCBvZiA1MGsgZ2VuMCBtb25zdGVycy4gQWZ0ZXIgdGhhdCwgaXQncyBhbGwgdXAgdG8gdGhlCiAgICAvLyAgICAgICAgICAgICBjb21tdW5pdHkgdG8gYnJlZWQsIGJyZWVkLCBicmVlZCEKCiAgICAvLyBTZXQgaW4gY2FzZSB0aGUgY29yZSBjb250cmFjdCBpcyBicm9rZW4gYW5kIGFuIHVwZ3JhZGUgaXMgcmVxdWlyZWQKICAgIGFkZHJlc3MgcHVibGljIG5ld0NvbnRyYWN0QWRkcmVzczsKCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIHRoZSBtYWluIENyeXB0b01vbnN0ZXJzIHNtYXJ0IGNvbnRyYWN0IGluc3RhbmNlLgogICAgZnVuY3Rpb24gTW9uc3RlckNvcmUoKSBwdWJsaWMgewogICAgICAgIC8vIFN0YXJ0cyBwYXVzZWQuCiAgICAgICAgcGF1c2VkID0gZmFsc2U7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDRU8KICAgICAgICBjZW9BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIGFsc28gdGhlIGluaXRpYWwgQ09PCiAgICAgICAgY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vCiAgICAgICAgY2ZvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHN0YXJ0IHdpdGggdGhlIG15dGhpY2FsIG1vbnN0ZXIgMCAtIHNvIHdlIGRvbid0IGhhdmUgZ2VuZXJhdGlvbi0wIHBhcmVudCBpc3N1ZXMKICAgICAgICBfY3JlYXRlTW9uc3RlcigwLCAwLCAwLCB1aW50MjU2KC0xKSwgYWRkcmVzcygwKSk7CiAgICB9CgogICAgLy8vIEBkZXYgVXNlZCB0byBtYXJrIHRoZSBzbWFydCBjb250cmFjdCBhcyB1cGdyYWRlZCwgaW4gY2FzZSB0aGVyZSBpcyBhIHNlcmlvdXMKICAgIC8vLyAgYnJlYWtpbmcgYnVnLiBUaGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcgYnV0IGtlZXAgdHJhY2sgb2YgdGhlIG5ldyBjb250cmFjdCBhbmQKICAgIC8vLyAgZW1pdCBhIG1lc3NhZ2UgaW5kaW1vbnN0ZXJpbmcgdGhhdCB0aGUgbmV3IGFkZHJlc3MgaXMgc2V0LiBJdCdzIHVwIHRvIGNsaWVudHMgb2YgdGhpcwogICAgLy8vICBjb250cmFjdCB0byB1cGRhdGUgdG8gdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzIGluIHRoYXQgY2FzZS4gKFRoaXMgY29udHJhY3Qgd2lsbAogICAgLy8vICBiZSBwYXVzZWQgaW5kZWZpbml0ZWx5IGlmIHN1Y2ggYW4gdXBncmFkZSB0YWtlcyBwbGFjZS4pCiAgICAvLy8gQHBhcmFtIF92MkFkZHJlc3MgbmV3IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldE5ld0FkZHJlc3MoYWRkcmVzcyBfdjJBZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgICAgICBuZXdDb250cmFjdEFkZHJlc3MgPSBfdjJBZGRyZXNzOwogICAgICAgIENvbnRyYWN0VXBncmFkZShfdjJBZGRyZXNzKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBObyB0aXBwaW5nIQogICAgLy8vIEBkZXYgUmVqZWN0IGFsbCBFdGhlciBmcm9tIGJlaW5nIHNlbnQgaGVyZSwgdW5sZXNzIGl0J3MgZnJvbSBvbmUgb2YgdGhlCiAgICAvLy8gIHR3byBhdWN0aW9uIGNvbnRyYWN0cy4gKEhvcGVmdWxseSwgd2UgY2FuIHByZXZlbnQgdXNlciBhY2NpZGVudHMuKQogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3Moc2FsZUF1Y3Rpb24pIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzaXJpbmdBdWN0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhbGwgdGhlIHJlbGV2YW50IGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmaWMgbW9uc3Rlci4KICAgIC8vLyBAcGFyYW0gX2lkIFRoZSBJRCBvZiB0aGUgbW9uc3RlciBvZiBpbnRlcmVzdC4KICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXIodWludDI1NiBfaWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoCiAgICAgICAgYm9vbCBpc0dlc3RhdGluZywKICAgICAgICBib29sIGlzUmVhZHksCiAgICAgICAgdWludDI1NiBjb29sZG93bkluZGV4LAogICAgICAgIHVpbnQyNTYgbmV4dEFjdGlvbkF0LAogICAgICAgIHVpbnQyNTYgc2lyaW5nV2l0aElkLAogICAgICAgIHVpbnQyNTYgYmlydGhUaW1lLAogICAgICAgIHVpbnQyNTYgbWF0cm9uSWQsCiAgICAgICAgdWludDI1NiBzaXJlSWQsCiAgICAgICAgdWludDI1NiBnZW5lcmF0aW9uLAogICAgICAgIHVpbnQyNTYgZ2VuZXMKICAgICkgewogICAgICAgIE1vbnN0ZXIgc3RvcmFnZSBtb25zdGVyID0gbW9uc3RlcnNbX2lkXTsKCiAgICAgICAgLy8gaWYgdGhpcyB2YXJpYWJsZSBpcyAwIHRoZW4gaXQncyBub3QgZ2VzdGF0aW5nCiAgICAgICAgaXNHZXN0YXRpbmcgPSAobW9uc3Rlci5zaXJpbmdXaXRoSWQgIT0gMCk7CiAgICAgICAgaXNSZWFkeSA9IChtb25zdGVyLmNvb2xkb3duRW5kQmxvY2sgPD0gYmxvY2subnVtYmVyKTsKICAgICAgICBjb29sZG93bkluZGV4ID0gdWludDI1Nihtb25zdGVyLmNvb2xkb3duSW5kZXgpOwogICAgICAgIG5leHRBY3Rpb25BdCA9IHVpbnQyNTYobW9uc3Rlci5jb29sZG93bkVuZEJsb2NrKTsKICAgICAgICBzaXJpbmdXaXRoSWQgPSB1aW50MjU2KG1vbnN0ZXIuc2lyaW5nV2l0aElkKTsKICAgICAgICBiaXJ0aFRpbWUgPSB1aW50MjU2KG1vbnN0ZXIuYmlydGhUaW1lKTsKICAgICAgICBtYXRyb25JZCA9IHVpbnQyNTYobW9uc3Rlci5tYXRyb25JZCk7CiAgICAgICAgc2lyZUlkID0gdWludDI1Nihtb25zdGVyLnNpcmVJZCk7CiAgICAgICAgZ2VuZXJhdGlvbiA9IHVpbnQyNTYobW9uc3Rlci5nZW5lcmF0aW9uKTsKICAgICAgICBnZW5lcyA9IG1vbnN0ZXIuZ2VuZXM7CiAgICB9CgogICAgLy8vIEBkZXYgT3ZlcnJpZGUgdW5wYXVzZSBzbyBpdCByZXF1aXJlcyBhbGwgZXh0ZXJuYWwgY29udHJhY3QgYWRkcmVzc2VzCiAgICAvLy8gIHRvIGJlIHNldCBiZWZvcmUgY29udHJhY3QgY2FuIGJlIHVucGF1c2VkLiBBbHNvLCB3ZSBjYW4ndCBoYXZlCiAgICAvLy8gIG5ld0NvbnRyYWN0QWRkcmVzcyBzZXQgZWl0aGVyLCBiZWNhdXNlIHRoZW4gdGhlIGNvbnRyYWN0IHdhcyB1cGdyYWRlZC4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgcHVibGljIHJhdGhlciB0aGFuIGV4dGVybmFsIHNvIHdlIGNhbiBjYWxsIHN1cGVyLnVucGF1c2UKICAgIC8vLyAgd2l0aG91dCB1c2luZyBhbiBleHBlbnNpdmUgQ0FMTC4KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHNhbGVBdWN0aW9uICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoc2lyaW5nQXVjdGlvbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGdlbmVTY2llbmNlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobmV3Q29udHJhY3RBZGRyZXNzID09IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBBY3R1YWxseSB1bnBhdXNlIHRoZSBjb250cmFjdC4KICAgICAgICBzdXBlci51bnBhdXNlKCk7CiAgICB9CgogICAgLy8gQGRldiBBbGxvd3MgdGhlIENGTyB0byBjYXB0dXJlIHRoZSBiYWxhbmNlIGF2YWlsYWJsZSB0byB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAgLy8gU3VidHJhY3QgYWxsIHRoZSBjdXJyZW50bHkgcHJlZ25hbnQgbW9uc3RlcnMgd2UgaGF2ZSwgcGx1cyAxIG9mIG1hcmdpbi4KICAgICAgICB1aW50MjU2IHN1YnRyYWN0RmVlcyA9IChwcmVnbmFudE1vbnN0ZXJzICsgMSkgKiBhdXRvQmlydGhGZWU7CgogICAgICAgIGlmIChiYWxhbmNlID4gc3VidHJhY3RGZWVzKSB7CiAgICAgICAgICAgIGNmb0FkZHJlc3Muc2VuZChiYWxhbmNlIC0gc3VidHJhY3RGZWVzKTsKICAgICAgICB9CiAgICB9Cn0='.
	

]
