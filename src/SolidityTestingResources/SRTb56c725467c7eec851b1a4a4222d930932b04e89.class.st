Class {
	#name : #SRTb56c725467c7eec851b1a4a4222d930932b04e89,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb56c725467c7eec851b1a4a4222d930932b04e89 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyB2ZXJzaW9uIChMQVZBLVEpCmNvbnRyYWN0IEU0Um93RXNjcm93IHsKCmV2ZW50IFN0YXRFdmVudChzdHJpbmcgbXNnKTsKZXZlbnQgU3RhdEV2ZW50SShzdHJpbmcgbXNnLCB1aW50IHZhbCk7CmV2ZW50IFN0YXRFdmVudEEoc3RyaW5nIG1zZywgYWRkcmVzcyBhZGRyKTsKCiAgICAgICAgdWludCBjb25zdGFudCBNQVhfUExBWUVSUyA9IDU7CgogICAgICAgIGVudW0gRW5kUmVhc29uICB7ZXJXaW5uZXIsIGVyVGltZU91dCwgZXJDYW5jZWx9CiAgICAgICAgZW51bSBTZXR0aW5nU3RhdGVWYWx1ZSAge2RlYnVnLCByZWxlYXNlLCBsb2NrZWRSZWxlYXNlfQoKICAgICAgICBzdHJ1Y3QgZ2FtZUluc3RhbmNlIHsKICAgICAgICAgICAgICAgIGJvb2wgYWN0aXZlOyAgICAgICAgICAgLy8gYWN0aXZlCiAgICAgICAgICAgICAgICBib29sIGFsbG9jZDsgICAgICAgICAgIC8vIGFsbG9jYXRlZCBhbHJlYWR5LiAKICAgICAgICAgICAgICAgIEVuZFJlYXNvbiByZWFzb25FbmRlZDsgLy8gZW51bSByZWFzb24gb2YgZW5kZWQKICAgICAgICAgICAgICAgIHVpbnQ4IG51bVBsYXllcnM7CiAgICAgICAgICAgICAgICB1aW50MTI4IHRvdGFsUG90OyAgICAgIC8vIHRvdGFsIG9mIGFsbCBiZXRzCiAgICAgICAgICAgICAgICB1aW50MTI4WzVdIHBsYXllclBvdHM7IC8vIGluZGl2aWR1YWwgZGVwb3NpdHMKICAgICAgICAgICAgICAgIGFkZHJlc3NbNV0gcGxheWVyczsgICAgLy8gcGxheWVyIGFkZHJzCiAgICAgICAgICAgICAgICB1aW50IGxhc3RNb3ZlZDsgICAgICAgIC8vIHRpbWUgZ2FtZSBsYXN0IG1vdmVkCiAgICAgICAgfQoKICAgICAgICBzdHJ1Y3QgYXJiaXRlciB7CiAgICAgICAgICAgICAgICBtYXBwaW5nICh1aW50ID0+IHVpbnQpICBnYW1lSW5kZXhlczsgLy8gZ2FtZSBoYW5kbGVzCiAgICAgICAgICAgICAgICBib29sIHJlZ2lzdGVyZWQ7IAogICAgICAgICAgICAgICAgYm9vbCBsb2NrZWQ7CiAgICAgICAgICAgICAgICB1aW50OCBudW1QbGF5ZXJzOwogICAgICAgICAgICAgICAgdWludDE2IGFyYlRva2VuOyAgICAgICAgIC8vIDIgYnl0ZXMKICAgICAgICAgICAgICAgIHVpbnQxNiBlc2NGZWVQY3RYMTA7ICAgICAvLyBlc2Nyb3cgZmVlIC0tIGZyYWMgb2YgMTAwMAogICAgICAgICAgICAgICAgdWludDE2IGFyYkZlZVBjdFgxMDsgICAgIC8vIGFyYml0ZXIgZmVlIC0tIGZyYWMgb2YgMTAwMAogICAgICAgICAgICAgICAgdWludDMyIGdhbWVTbG90czsgICAgICAgIC8vIGEgY291bnRlciBvZiBhbGxvYydkIGdhbWUgc3RydWN0cyAodGhleSBjYW4gYmUgcmV1c2VkKQogICAgICAgICAgICAgICAgdWludDEyOCBmZWVDYXA7ICAgICAgICAgIC8vIG1heCBmZWUgKGVzY3JvdyArIGFyYikgaW4gd2VpCiAgICAgICAgICAgICAgICB1aW50MTI4IGFyYkhvbGRvdmVyOyAgICAgLy8gaG9sZCBhY2N1bXVsYXRlZCBnYXMgY3JlZGl0cyBhbmQgYXJiaXRlciBmZWVzCiAgICAgICAgfQoKCiAgICAgICAgYWRkcmVzcyBwdWJsaWMgIG93bmVyOyAgLy8gb3duZXIgaXMgYWRkcmVzcyB0aGF0IGRlcGxveWVkIGNvbnRyYWN0CiAgICAgICAgYWRkcmVzcyBwdWJsaWMgIHRva2VuUGFydG5lcjsgICAvLyB0aGUgYWRkcmVzcyBvZiBwYXJ0bmVyIHRoYXQgcmVjZWl2ZXMgcmFrZSBmZWVzCiAgICAgICAgdWludCBwdWJsaWMgbnVtQXJiaXRlcnM7ICAgICAgICAvLyBudW1iZXIgb2YgYXJiaXRlcnMKCiAgICAgICAgaW50IG51bUdhbWVzU3RhcnRlZDsgICAgLy8gdG90YWwgc3RhdHMgZnJvbSBhbGwgYXJiaXRlcnMKCiAgICAgICAgdWludCBwdWJsaWMgbnVtR2FtZXNDb21wbGV0ZWQ7IC8vIC4uLgogICAgICAgIHVpbnQgcHVibGljIG51bUdhbWVzQ2FuY2VsZWQ7ICAgLy8gdGllZCBhbmQgY2FuY2VsZWQKICAgICAgICB1aW50IHB1YmxpYyBudW1HYW1lc1RpbWVkT3V0OyAgIC8vIC4uLgogICAgICAgIHVpbnQgcHVibGljIGhvdXNlRmVlSG9sZG92ZXI7ICAgLy8gaG9sZCBmZWUgdGlsbCB0aHJlc2hvbGQKICAgICAgICB1aW50IHB1YmxpYyBsYXN0UGF5b3V0VGltZTsgICAgIC8vIHRpbWVzdGFtcCBvZiBsYXN0IHBheW91dCB0aW1lCgogICAgICAgIC8vIGNvbmZpZ3VyYWJsZXMKICAgICAgICB1aW50IHB1YmxpYyBnYW1lVGltZU91dDsKICAgICAgICB1aW50IHB1YmxpYyByZWdpc3RyYXRpb25GZWU7CiAgICAgICAgdWludCBwdWJsaWMgaG91c2VGZWVUaHJlc2hvbGQ7CiAgICAgICAgdWludCBwdWJsaWMgcGF5b3V0SW50ZXJ2YWw7CgogICAgICAgIHVpbnQgYWNjdENhbGxHYXM7ICAvLyBmb3IgcGF5bWVudHMgdG8gc2ltcGxlIGFjY3RzCiAgICAgICAgdWludCB0b2tDYWxsR2FzOyAgIC8vIGZvciBjYWxsaW5nIHRva2VuIGNvbnRyYWN0LiBlZyBmZWUgcGF5b3V0CiAgICAgICAgdWludCBwdWJsaWMgc3RhcnRHYW1lR2FzOyAvLyBnYXMgY29uc3VtZWQgYnkgc3RhcnRHYW1lCiAgICAgICAgdWludCBwdWJsaWMgd2lubmVyRGVjaWRlZEdhczsgLy8gZ2FzIGNvbnN1bWVkIGJ5IHdpbm5lckRlY2lkZWQKCiAgICAgICAgU2V0dGluZ1N0YXRlVmFsdWUgcHVibGljIHNldHRpbmdzU3RhdGUgPSBTZXR0aW5nU3RhdGVWYWx1ZS5kZWJ1ZzsgCgoKICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IGFyYml0ZXIpICBhcmJpdGVyczsKICAgICAgICBtYXBwaW5nICh1aW50ID0+IGFkZHJlc3MpICBhcmJpdGVyVG9rZW5zOwogICAgICAgIG1hcHBpbmcgKHVpbnQgPT4gYWRkcmVzcykgIGFyYml0ZXJJbmRleGVzOwogICAgICAgIG1hcHBpbmcgKHVpbnQgPT4gZ2FtZUluc3RhbmNlKSAgZ2FtZXM7CgoKICAgICAgICBmdW5jdGlvbiBFNFJvd0VzY3JvdygpIHB1YmxpYwogICAgICAgIHsKICAgICAgICAgICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB9CgoKICAgICAgICBmdW5jdGlvbiBhcHBseVNldHRpbmdzKFNldHRpbmdTdGF0ZVZhbHVlIF9zdGF0ZSwgdWludCBfZmVlLCB1aW50IF90aHJlc2hvbGQsIHVpbnQgX3RpbWVvdXQsIHVpbnQgX2ludGVydmFsLCB1aW50IF9zdGFydEdhbWVHYXMsIHVpbnQgX3dpbm5lckRlY2lkZWRHYXMpCiAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIAogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgICAgICAvLyB0aGVzZSBpdGVtcyBhcmUgdHdlYWthYmxlIGZvciBnYW1lIG9wdGltaXphdGlvbgogICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgICAgaG91c2VGZWVUaHJlc2hvbGQgPSBfdGhyZXNob2xkOwogICAgICAgICAgICAgICAgZ2FtZVRpbWVPdXQgPSBfdGltZW91dDsKICAgICAgICAgICAgICAgIHBheW91dEludGVydmFsID0gX2ludGVydmFsOwoKICAgICAgICAgICAgICAgIGlmIChzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJTZXR0aW5ncyBUd2Vha2VkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzZXR0aW5nc1N0YXRlID0gX3N0YXRlOwogICAgICAgICAgICAgICAgcmVnaXN0cmF0aW9uRmVlID0gX2ZlZTsKCiAgICAgICAgICAgICAgICAvLyBzZXQgZGVmYXVsdCBvcCBnYXMgLSAgYW55IGZ1dGhlciBzZXR0aW5ncyBkb25lIGluIHNldCB1cCBnYXMKICAgICAgICAgICAgICAgIGFjY3RDYWxsR2FzID0gMjEwMDA7IAogICAgICAgICAgICAgICAgdG9rQ2FsbEdhcyA9IDM2MDAwMDsKCiAgICAgICAgICAgICAgICAvLyBzZXQgZ2FzIGNvbnN1bXB0aW9uIC0gdGhlc2Ugc2hvdWxkIG5ldmVyIGNoYW5nZSAoZXhjZXB0IGdhcyBwcmljZSkKICAgICAgICAgICAgICAgIHN0YXJ0R2FtZUdhcyA9IF9zdGFydEdhbWVHYXM7CiAgICAgICAgICAgICAgICB3aW5uZXJEZWNpZGVkR2FzID0gX3dpbm5lckRlY2lkZWRHYXM7CiAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIlNldHRpbmdzIENoYW5nZWQiKTsKCiAgICAgICAgfQoKCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIHJldHVybiBhbiBhcmJpdGVyIHRva2VuIGZyb20gYW4gaEdhbWUKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gQXJiVG9rRnJvbUhHYW1lKHVpbnQgX2hHYW1lKSByZXR1cm5zICh1aW50IF90b2spCiAgICAgICAgeyAKICAgICAgICAgICAgICAgIF90b2sgPSAgKF9oR2FtZSAvICgyICoqIDQ4KSkgJiAweGZmZmY7CiAgICAgICAgfQoKCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIHN1aWNpZGUgdGhlIGNvbnRyYWN0LCBub3QgY2FsbGVkIGZvciByZWxlYXNlCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIEhhcmFLaXJpKCkKICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoKG1zZy5zZW5kZXIgPT0gb3duZXIpICYmIChzZXR0aW5nc1N0YXRlICE9IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpKQogICAgICAgICAgICAgICAgICAgICAgICAgIHN1aWNpZGUodG9rZW5QYXJ0bmVyKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJLaWxsIGF0dGVtcHQgZmFpbGVkIik7CiAgICAgICAgfQoKCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIGRlZmF1bHQgZnVuY3Rpb24KICAgICAgICAvLyB3aG8gYXJlIHdlIHRvIGxvb2sgYSBnaWZ0LWhvcnNlIGluIHRoZSBtb3V0aD8KICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24oKSBwYXlhYmxlICB7CiAgICAgICAgICAgICAgICBTdGF0RXZlbnQoInRoYW5rcyEiKTsKICAgICAgICAgICAgICAgIGhvdXNlRmVlSG9sZG92ZXIgKz0gbXNnLnZhbHVlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBibGFja0hvbGUoKSBwYXlhYmxlICB7CiAgICAgICAgICAgICAgICBTdGF0RXZlbnQoInRoYW5rcyEjMiIpOwogICAgICAgIH0KCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAvLyBjaGVjayBhY3RpdmUgZ2FtZSBhbmQgdmFsaWQgcGxheWVyLCByZXR1cm4gcGxheWVyIGluZGV4CiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gdmFsaWRQbGF5ZXIodWludCBfaEdhbWUsIGFkZHJlc3MgX2FkZHIpICBpbnRlcm5hbCByZXR1cm5zKCBib29sIF92YWxpZCwgdWludCBfcGlkeCkKICAgICAgICB7CiAgICAgICAgICAgICAgICBfdmFsaWQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlR2FtZShfaEdhbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGdhbWVzW19oR2FtZV0ubnVtUGxheWVyczsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWVzW19oR2FtZV0ucGxheWVyc1tpXSA9PSBfYWRkcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3ZhbGlkPXRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcGlkeCA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIGNoZWNrIHRoZSBhcmJpdGVyIGlzIHZhbGlkIGJ5IGNvbXBhcmluZyB0b2tlbgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gdmFsaWRBcmIoYWRkcmVzcyBfYWRkciwgdWludCBfdG9rKSBpbnRlcm5hbCAgcmV0dXJucyggYm9vbCBfdmFsaWQpCiAgICAgICAgewogICAgICAgICAgICAgICAgX3ZhbGlkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKChhcmJpdGVyc1tfYWRkcl0ucmVnaXN0ZXJlZCkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKGFyYml0ZXJzW19hZGRyXS5hcmJUb2tlbiA9PSBfdG9rKSkgCiAgICAgICAgICAgICAgICAgICAgICAgIF92YWxpZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIGNoZWNrIHRoZSBhcmJpdGVyIGlzIHZhbGlkIHdpdGhvdXQgY29tcGFyaW5nIHRva2VuCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICBmdW5jdGlvbiB2YWxpZEFyYjIoYWRkcmVzcyBfYWRkcikgaW50ZXJuYWwgIHJldHVybnMoIGJvb2wgX3ZhbGlkKQogICAgICAgIHsKICAgICAgICAgICAgICAgIF92YWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGFyYml0ZXJzW19hZGRyXS5yZWdpc3RlcmVkKQogICAgICAgICAgICAgICAgICAgICAgICBfdmFsaWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAvLyBjaGVjayBpZiBhcmJpdGVyIGlzIGxvY2tlZCBvdXQKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIGFyYkxvY2tlZChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCAgcmV0dXJucyggYm9vbCBfbG9ja2VkKQogICAgICAgIHsKICAgICAgICAgICAgICAgIF9sb2NrZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICh2YWxpZEFyYjIoX2FkZHIpKSAKICAgICAgICAgICAgICAgICAgICAgICAgX2xvY2tlZCA9IGFyYml0ZXJzW19hZGRyXS5sb2NrZWQ7CiAgICAgICAgfQoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIHJldHVybiBpZiBnYW1lIGlzIGFjdGl2ZQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gYWN0aXZlR2FtZSh1aW50IF9oR2FtZSkgaW50ZXJuYWwgIHJldHVybnMoIGJvb2wgX3ZhbGlkKQogICAgICAgIHsKICAgICAgICAgICAgICAgIF92YWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKChfaEdhbWUgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAoZ2FtZXNbX2hHYW1lXS5hY3RpdmUpKQogICAgICAgICAgICAgICAgICAgICAgICBfdmFsaWQgPSB0cnVlOwogICAgICAgIH0KCgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gcmVnaXN0ZXIgZ2FtZSBhcmJpdGVyLCBtYXggcGxheWVycyBvZiA1LCBwYXNzIGluIGV4YWN0IHJlZ2lzdHJhdGlvbiBmZWUKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQXJiaXRlcih1aW50IF9udW1QbGF5ZXJzLCB1aW50IF9hcmJUb2tlbiwgdWludCBfZXNjRmVlUGN0WDEwLCB1aW50IF9hcmJGZWVQY3RYMTAsIHVpbnQgX2ZlZUNhcCkgcHVibGljIHBheWFibGUgCiAgICAgICAgewoKICAgICAgICAgICAgICAgIGlmIChtc2cudmFsdWUgIT0gcmVnaXN0cmF0aW9uRmVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAgLy9JbnN1ZmZpY2llbnQgRmVlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF9hcmJUb2tlbiA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyBpbnZhbGlkIHRva2VuCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFyYlRva2VuRXhpc3RzKF9hcmJUb2tlbiAmIDB4ZmZmZikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vIFRva2VuIEFscmVhZHkgRXhpc3RzCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFyYml0ZXJzW21zZy5zZW5kZXJdLnJlZ2lzdGVyZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vIEFyYiBBbHJlYWR5IFJlZ2lzdGVyZWQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX251bVBsYXllcnMgPiBNQVhfUExBWUVSUykgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsgLy8gRXhjZWVkcyBNYXggUGxheWVycwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfZXNjRmVlUGN0WDEwIDwgMjApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vIGxlc3MgdGhhbiAyJSBtaW4gZXNjcm93IGZlZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfYXJiRmVlUGN0WDEwID4gMTApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IC8vIG1vcmUgdGhhbiB0aGFuIDElIG1heCBhcmJpdGVyIGZlZQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLmxvY2tlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0ubnVtUGxheWVycyA9IHVpbnQ4KF9udW1QbGF5ZXJzKTsKICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLmVzY0ZlZVBjdFgxMCA9IHVpbnQ4KF9lc2NGZWVQY3RYMTApOwogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0uYXJiRmVlUGN0WDEwID0gdWludDgoX2FyYkZlZVBjdFgxMCk7CiAgICAgICAgICAgICAgICBhcmJpdGVyc1ttc2cuc2VuZGVyXS5hcmJUb2tlbiA9IHVpbnQxNihfYXJiVG9rZW4gJiAweGZmZmYpOwogICAgICAgICAgICAgICAgYXJiaXRlcnNbbXNnLnNlbmRlcl0uZmVlQ2FwID0gdWludDEyOChfZmVlQ2FwKTsKICAgICAgICAgICAgICAgIGFyYml0ZXJzW21zZy5zZW5kZXJdLnJlZ2lzdGVyZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIGFyYml0ZXJUb2tlbnNbKF9hcmJUb2tlbiAmIDB4ZmZmZildID0gbXNnLnNlbmRlcjsKICAgICAgICAgICAgICAgIGFyYml0ZXJJbmRleGVzW251bUFyYml0ZXJzKytdID0gbXNnLnNlbmRlcjsKCiAgICAgICAgICAgICAgICBpZiAodG9rZW5QYXJ0bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0b2tlblBhcnRuZXIuY2FsbC5nYXModG9rQ2FsbEdhcykudmFsdWUobXNnLnZhbHVlKSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TdGF0dmVudCgiU2VuZCBFcnJvciIpOyAvLyBldmVudCBuZXZlciByZWdpc3RlcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciArPSBtc2cudmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBTdGF0RXZlbnRJKCJBcmIgQWRkZWQiLCBfYXJiVG9rZW4pOwogICAgICAgIH0KCgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gc3RhcnQgZ2FtZS4gIHBhc3MgaW4gdmFsaWQgaEdhbWUgY29udGFpbmluZyB0b2tlbiBpbiB0b3AgdHdvIGJ5dGVzCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICBmdW5jdGlvbiBzdGFydEdhbWUodWludCBfaEdhbWUsIGludCBfaGtNYXgsIGFkZHJlc3NbXSBfcGxheWVycykgcHVibGljIAoKICAgICAgICB7CiAgICAgICAgICAgICAgICB1aW50IG50b2sgPSBBcmJUb2tGcm9tSEdhbWUoX2hHYW1lKTsKICAgICAgICAgICAgICAgIGlmICghdmFsaWRBcmIobXNnLnNlbmRlciwgbnRvayApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiSW52YWxpZCBBcmIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICAgICBpZiAoYXJiTG9ja2VkKG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiQXJiIExvY2tlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGFyYml0ZXIgeGFyYiA9IGFyYml0ZXJzW21zZy5zZW5kZXJdOwogICAgICAgICAgICAgICAgaWYgKF9wbGF5ZXJzLmxlbmd0aCAhPSB4YXJiLm51bVBsYXllcnMpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiSW5jb3JyZWN0IG51bSBwbGF5ZXJzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIHhnYW1lID0gZ2FtZXNbX2hHYW1lXTsKICAgICAgICAgICAgICAgIGlmICh4Z2FtZS5hY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ3VhcmQtcmFpbC4ganVzdCBpbiBjYXNlIHRvIHJldHVybiBmdW5kcwogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydEdhbWUoX2hHYW1lLCBFbmRSZWFzb24uZXJDYW5jZWwpOwoKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX2hrTWF4ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBob3VzZUtlZXAoX2hrTWF4LCBudG9rKTsgCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCF4Z2FtZS5hbGxvY2QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeGdhbWUuYWxsb2NkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgeGFyYi5nYW1lSW5kZXhlc1t4YXJiLmdhbWVTbG90cysrXSA9IF9oR2FtZTsKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICBudW1HYW1lc1N0YXJ0ZWQrKzsgLy8gYWx3YXlzIGluYyB0aGlzIG9uZQoKICAgICAgICAgICAgICAgIHhnYW1lLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB4Z2FtZS5sYXN0TW92ZWQgPSBub3c7CiAgICAgICAgICAgICAgICB4Z2FtZS50b3RhbFBvdCA9IDA7CiAgICAgICAgICAgICAgICB4Z2FtZS5udW1QbGF5ZXJzID0geGFyYi5udW1QbGF5ZXJzOwogICAgICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3BsYXllcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgeGdhbWUucGxheWVyc1tpXSA9IF9wbGF5ZXJzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICB4Z2FtZS5wbGF5ZXJQb3RzW2ldID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vU3RhdEV2ZW50SSgiR2FtZSBBZGRlZCIsIF9oR2FtZSk7CiAgICAgICAgfQoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIGNsZWFuIHVwIGdhbWUsIHNldCB0byBpbmFjdGl2ZSwgcmVmdW5kIGFueSBiYWxhbmNlcwogICAgICAgIC8vIGNhbGxlZCBieSBob3VzZWtlZXAgT05MWQogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gYWJvcnRHYW1lKHVpbnQgIF9oR2FtZSwgRW5kUmVhc29uIF9yZWFzb24pIHByaXZhdGUgcmV0dXJucyhib29sIF9zdWNjZXNzKQogICAgICAgIHsKICAgICAgICAgICAgICAgIGdhbWVJbnN0YW5jZSB4Z2FtZSA9IGdhbWVzW19oR2FtZV07CiAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIGZpbmQgZ2FtZSBpbiBnYW1lIGlkLCAKICAgICAgICAgICAgICAgIGlmICh4Z2FtZS5hY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3N1Y2Nlc3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB4Z2FtZS5udW1QbGF5ZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGdhbWUucGxheWVyUG90c1tpXSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgYSA9IHhnYW1lLnBsYXllcnNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IG5zZW5kID0geGdhbWUucGxheWVyUG90c1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhnYW1lLnBsYXllclBvdHNbaV0gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhLmNhbGwuZ2FzKGFjY3RDYWxsR2FzKS52YWx1ZShuc2VuZCkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZUZlZUhvbGRvdmVyICs9IG5zZW5kOyAvLyBjYW5ub3QgcmVmdW5kIGR1ZSB0byBlcnJvciwgZ2l2ZSB0byB0aGUgaG91c2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50QSgiQ2Fubm90IFJlZnVuZCBBZGRyZXNzIiwgYSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHhnYW1lLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB4Z2FtZS5yZWFzb25FbmRlZCA9IF9yZWFzb247CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfcmVhc29uID09IEVuZFJlYXNvbi5lckNhbmNlbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bUdhbWVzQ2FuY2VsZWQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkdhbWUgY2FuY2VsZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfcmVhc29uID09IEVuZFJlYXNvbi5lclRpbWVPdXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1HYW1lc1RpbWVkT3V0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJHYW1lIHRpbWVkIG91dCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJHYW1lIGFib3J0ZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIGNhbGxlZCBieSBhcmJpdGVyIHdoZW4gd2lubmVyIGlzIGRlY2lkZWQKICAgICAgICAvLyAqcGFzcyBpbiBoaWdoIG51bSBmb3Igd2lubmVyYmFsIGZvciB0aWUgZ2FtZXMKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIHdpbm5lckRlY2lkZWQodWludCBfaEdhbWUsIGFkZHJlc3MgX3dpbm5lciwgdWludCBfd2lubmVyQmFsKSBwdWJsaWMKICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkQXJiKG1zZy5zZW5kZXIsIEFyYlRva0Zyb21IR2FtZShfaEdhbWUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIkludmFsaWQgQXJiIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gbm8gdGhyb3cgbm8gY2hhbmdlIG1hZGUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgKHZhbGlkLCBwaWR4KSA9IHZhbGlkUGxheWVyKF9oR2FtZSwgX3dpbm5lcik7CiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiSW52YWxpZCBQbGF5ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGFyYml0ZXIgeGFyYiA9IGFyYml0ZXJzW21zZy5zZW5kZXJdOwogICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIHhnYW1lID0gZ2FtZXNbX2hHYW1lXTsKCiAgICAgICAgICAgICAgICBpZiAoeGdhbWUucGxheWVyUG90c1twaWR4XSA8IF93aW5uZXJCYWwpIHsKICAgICAgICAgICAgICAgICAgICBhYm9ydEdhbWUoX2hHYW1lLCBFbmRSZWFzb24uZXJDYW5jZWwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB4Z2FtZS5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHhnYW1lLnJlYXNvbkVuZGVkID0gRW5kUmVhc29uLmVyV2lubmVyOwogICAgICAgICAgICAgICAgbnVtR2FtZXNDb21wbGV0ZWQrKzsKCiAgICAgICAgICAgICAgICBpZiAoeGdhbWUudG90YWxQb3QgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbGMgcGF5b3V0czogZXNjcm93RmVlLCBhcmJpdGVyRmVlLCBnYXNDb3N0LCB3aW5uZXIgcGF5b3V0CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2VzY3Jvd0ZlZSA9ICh4Z2FtZS50b3RhbFBvdCAqIHhhcmIuZXNjRmVlUGN0WDEwKSAvIDEwMDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2FyYml0ZXJGZWUgPSAoeGdhbWUudG90YWxQb3QgKiB4YXJiLmFyYkZlZVBjdFgxMCkgLyAxMDAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKF9lc2Nyb3dGZWUgKyBfYXJiaXRlckZlZSkgPiB4YXJiLmZlZUNhcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9lc2Nyb3dGZWUgPSB4YXJiLmZlZUNhcCAqIHhhcmIuZXNjRmVlUGN0WDEwIC8gKHhhcmIuZXNjRmVlUGN0WDEwICsgeGFyYi5hcmJGZWVQY3RYMTApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9hcmJpdGVyRmVlID0geGFyYi5mZWVDYXAgKiB4YXJiLmFyYkZlZVBjdFgxMCAvICh4YXJiLmVzY0ZlZVBjdFgxMCArIHhhcmIuYXJiRmVlUGN0WDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9wYXlvdXQgPSB4Z2FtZS50b3RhbFBvdCAtIChfZXNjcm93RmVlICsgX2FyYml0ZXJGZWUpOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNDb3N0ID0gdHguZ2FzcHJpY2UgKiAoc3RhcnRHYW1lR2FzICsgd2lubmVyRGVjaWRlZEdhcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfZ2FzQ29zdCA+IF9wYXlvdXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2dhc0Nvc3QgPSBfcGF5b3V0OwogICAgICAgICAgICAgICAgICAgICAgICBfcGF5b3V0IC09IF9nYXNDb3N0OwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG8gcGF5b3V0cwogICAgICAgICAgICAgICAgICAgICAgICB4YXJiLmFyYkhvbGRvdmVyICs9IHVpbnQxMjgoX2FyYml0ZXJGZWUgKyBfZ2FzQ29zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhvdXNlRmVlSG9sZG92ZXIgKz0gX2VzY3Jvd0ZlZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaG91c2VGZWVIb2xkb3ZlciA+IGhvdXNlRmVlVGhyZXNob2xkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgKG5vdyA+IChsYXN0UGF5b3V0VGltZSArIHBheW91dEludGVydmFsKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IG50bXBobyA9IGhvdXNlRmVlSG9sZG92ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFBheW91dFRpbWUgPSBub3c7IC8vIHJlc2V0IHJlZ2FyZGxlc3Mgb2Ygc3VjY2VlZC9mYWlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0b2tlblBhcnRuZXIuY2FsbC5nYXModG9rQ2FsbEdhcykudmFsdWUobnRtcGhvKSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZUZlZUhvbGRvdmVyID0gbnRtcGhvOyAvLyBwdXQgaXQgYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJIb3VzZS1GZWUgRXJyb3IxIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9wYXlvdXQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfd2lubmVyLmNhbGwuZ2FzKGFjY3RDYWxsR2FzKS52YWx1ZSh1aW50KF9wYXlvdXQpKSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB5b3UgY2FudCBwYXkgdGhlIHdpbm5lciAtIHZlcnkgYmFkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGF0RXZlbnQoIlNlbmQgRXJyb3IiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBmdW5kcyB0byBob3VzZUZlZUhvbGRvdmVyIHRvIGF2b2lkIGFjb3VudGluZyBlcnJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3Rocm93OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciArPSBfcGF5b3V0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50SSgiUGF5b3V0IEVycm9yISIsIF9oR2FtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU3RhdEV2ZW50SSgiV2lubmVyIFBhaWQiLCBfaEdhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gaGFuZGxlIGEgYmV0IG1hZGUgYnkgYSBwbGF5ZXIsIHZhbGlkYXRlIHRoZSBwbGF5ZXIgYW5kIGdhbWUKICAgICAgICAvLyBhZGQgdG8gcGxheWVycyBiYWxhbmNlCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICBmdW5jdGlvbiBoYW5kbGVCZXQodWludCBfaEdhbWUpIHB1YmxpYyBwYXlhYmxlIAogICAgICAgIHsKICAgICAgICAgICAgICAgIGFkZHJlc3MgX2FyYkFkZHIgPSBhcmJpdGVyVG9rZW5zW0FyYlRva0Zyb21IR2FtZShfaEdhbWUpXTsKICAgICAgICAgICAgICAgIGlmIChfYXJiQWRkciA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyAiSW52YWxpZCBoR2FtZSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgKHZhbGlkLCBwaWR4KSA9IHZhbGlkUGxheWVyKF9oR2FtZSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OyAvLyAiSW52YWxpZCBQbGF5ZXIiCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIHhnYW1lID0gZ2FtZXNbX2hHYW1lXTsKICAgICAgICAgICAgICAgIHhnYW1lLnBsYXllclBvdHNbcGlkeF0gKz0gdWludDEyOChtc2cudmFsdWUpOwogICAgICAgICAgICAgICAgeGdhbWUudG90YWxQb3QgKz0gdWludDEyOChtc2cudmFsdWUpOwogICAgICAgICAgICAgICAgLy9TdGF0RXZlbnRJKCJCZXQgQWRkZWQiLCBfaEdhbWUpOwogICAgICAgIH0KCgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gcmV0dXJuIGlmIGFyYiB0b2tlbiBleGlzdHMKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIGFyYlRva2VuRXhpc3RzKHVpbnQgX3RvaykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBfZXhpc3RzKQogICAgICAgIHsKICAgICAgICAgICAgICAgIF9leGlzdHMgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICgoX3RvayA+IDApCiAgICAgICAgICAgICAgICAgICAgICAgICYmIChhcmJpdGVyVG9rZW5zW190b2tdICE9IGFkZHJlc3MoMCkpCiAgICAgICAgICAgICAgICAgICAgICAgICYmIGFyYml0ZXJzW2FyYml0ZXJUb2tlbnNbX3Rva11dLnJlZ2lzdGVyZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIF9leGlzdHMgPSB0cnVlOwoKICAgICAgICB9CgoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIHJldHVybiBhcmJpdGVyIGdhbWUgc3RhdHMKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIGdldEFyYkluZm8odWludCBfdG9rKSBjb25zdGFudCAgcmV0dXJucyAoYWRkcmVzcyBfYWRkciwgdWludCBfZXNjRmVlUGN0WDEwLCB1aW50IF9hcmJGZWVQY3RYMTAsIHVpbnQgX2ZlZUNhcCwgdWludCBfaG9sZE92ZXIpIAogICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIGlmIChhcmJpdGVyVG9rZW5zW190b2tdICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2FkZHIgPSBhcmJpdGVyVG9rZW5zW190b2tdOyAKICAgICAgICAgICAgICAgICAgICAgICAgIGFyYml0ZXIgeGFyYiA9IGFyYml0ZXJzW2FyYml0ZXJUb2tlbnNbX3Rva11dOwogICAgICAgICAgICAgICAgICAgICAgICBfZXNjRmVlUGN0WDEwID0geGFyYi5lc2NGZWVQY3RYMTA7CiAgICAgICAgICAgICAgICAgICAgICAgIF9hcmJGZWVQY3RYMTAgPSB4YXJiLmFyYkZlZVBjdFgxMDsKICAgICAgICAgICAgICAgICAgICAgICAgX2ZlZUNhcCA9IHhhcmIuZmVlQ2FwOwogICAgICAgICAgICAgICAgICAgICAgICBfaG9sZE92ZXIgPSB4YXJiLmFyYkhvbGRvdmVyOyAKICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICB9CgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gc2NhbiBmb3IgYSBnYW1lIDEwIG1pbnV0ZXMgb2xkCiAgICAgICAgLy8gaWYgZm91bmQgYWJvcnQgdGhlIGdhbWUsIGNhdXNpbmcgZnVuZHMgdG8gYmUgcmV0dXJuZWQKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIGhvdXNlS2VlcChpbnQgX21heCwgdWludCBfYXJiVG9rZW4pIHB1YmxpYwogICAgICAgIHsKICAgICAgICAgICAgICAgIHVpbnQgZ2k7CiAgICAgICAgICAgICAgICBhZGRyZXNzIGE7CiAgICAgICAgICAgICAgICBpbnQgYWJvcnRlZCA9IDA7CgogICAgICAgICAgICAgICAgYXJiaXRlciB4YXJiID0gYXJiaXRlcnNbbXNnLnNlbmRlcl07Ly8gaGF2ZSB0byBzZXQgaXQgdG8gc29tZXRoaW5nCiAgICAgICAgICAgICAgICAKICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHVpbnQgYXIgPSAwOyAoYXIgPCBudW1BcmJpdGVycykgJiYgKGFib3J0ZWQgPCBfbWF4KSA7IGFyKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBhcmJpdGVySW5kZXhlc1thcl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4YXJiID0gYXJiaXRlcnNbYV07ICAgIAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGdpID0gMDsgKGdpIDwgeGFyYi5nYW1lU2xvdHMpICYmIChhYm9ydGVkIDwgX21heCk7IGdpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lSW5zdGFuY2UgbmdhbWUwID0gZ2FtZXNbeGFyYi5nYW1lSW5kZXhlc1tnaV1dOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobmdhbWUwLmFjdGl2ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgKChub3cgLSBuZ2FtZTAubGFzdE1vdmVkKSA+IGdhbWVUaW1lT3V0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRHYW1lKHhhcmIuZ2FtZUluZGV4ZXNbZ2ldLCBFbmRSZWFzb24uZXJUaW1lT3V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsrYWJvcnRlZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkQXJiKG1zZy5zZW5kZXIsIF9hcmJUb2tlbikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJIb3VzZWtlZXAgaW52YWxpZCBhcmJpdGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4YXJiID0gYXJiaXRlcnNbYV07ICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChnaSA9IDA7IChnaSA8IHhhcmIuZ2FtZVNsb3RzKSAmJiAoYWJvcnRlZCA8IF9tYXgpOyBnaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIG5nYW1lMSA9IGdhbWVzW3hhcmIuZ2FtZUluZGV4ZXNbZ2ldXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG5nYW1lMS5hY3RpdmUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICgobm93IC0gbmdhbWUxLmxhc3RNb3ZlZCkgPiBnYW1lVGltZU91dCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0R2FtZSh4YXJiLmdhbWVJbmRleGVzW2dpXSwgRW5kUmVhc29uLmVyVGltZU91dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArK2Fib3J0ZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gcmV0dXJuIGdhbWUgaW5mbwogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gZ2V0R2FtZUluZm8odWludCBfaEdhbWUpICBjb25zdGFudCAgcmV0dXJucyAoRW5kUmVhc29uIF9yZWFzb24sIHVpbnQgX3BsYXllcnMsIHVpbnQgX3RvdGFsUG90LCBib29sIF9hY3RpdmUpCiAgICAgICAgewogICAgICAgICAgICAgICAgZ2FtZUluc3RhbmNlIHhnYW1lID0gZ2FtZXNbX2hHYW1lXTsKICAgICAgICAgICAgICAgIF9hY3RpdmUgPSB4Z2FtZS5hY3RpdmU7CiAgICAgICAgICAgICAgICBfcGxheWVycyA9IHhnYW1lLm51bVBsYXllcnM7CiAgICAgICAgICAgICAgICBfdG90YWxQb3QgPSB4Z2FtZS50b3RhbFBvdDsKICAgICAgICAgICAgICAgIF9yZWFzb24gPSB4Z2FtZS5yZWFzb25FbmRlZDsKCiAgICAgICAgfQoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIHJldHVybiBhcmJUb2tlbiBhbmQgbG93IGJ5dGVzIGZyb20gYW4gSEdhbWUKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIGNoZWNrSEdhbWUodWludCBfaEdhbWUpIGNvbnN0YW50IHJldHVybnModWludCBfYXJiVG9rLCB1aW50IF9sb3dXb3JkcykKICAgICAgICB7CiAgICAgICAgICAgICAgICBfYXJiVG9rID0gQXJiVG9rRnJvbUhHYW1lKF9oR2FtZSk7CiAgICAgICAgICAgICAgICBfbG93V29yZHMgPSBfaEdhbWUgJiAweGZmZmZmZmZmZmZmZjsKCiAgICAgICAgfQoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIGdldCBvcGVyYXRpb24gZ2FzIGFtb3VudHMKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIGdldE9wR2FzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCBfYWcsIHVpbnQgX3RnKSAKICAgICAgICB7CiAgICAgICAgICAgICAgICBfYWcgPSBhY2N0Q2FsbEdhczsgLy8gd2lubmVyIHBhaWQKICAgICAgICAgICAgICAgIF90ZyA9IHRva0NhbGxHYXM7ICAgICAvLyB0b2tlbiBjb250cmFjdCBjYWxsIGdhcwogICAgICAgIH0KCgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gc2V0IG9wZXJhdGlvbiBnYXMgYW1vdW50cyBmb3IgZm9yd2FkaW5nIG9wZXJhdGlvbnMKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIHNldE9wR2FzKHVpbnQgX2FnLCB1aW50IF90ZykgCiAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OwoKICAgICAgICAgICAgICAgIGFjY3RDYWxsR2FzID0gX2FnOwogICAgICAgICAgICAgICAgdG9rQ2FsbEdhcyA9IF90ZzsKICAgICAgICB9CgoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIHNldCBhIG1pY2hlaXZvdXMgYXJiaXRlciB0byBsb2NrZWQKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGZ1bmN0aW9uIHNldEFyYml0ZXJMb2NrZWQoYWRkcmVzcyBfYWRkciwgYm9vbCBfbG9jaykgIHB1YmxpYyAKICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAob3duZXIgIT0gbXNnLnNlbmRlcikgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7IAogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdmFsaWRBcmIyKF9hZGRyKSkgewogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoImludmFsaWQgYXJiIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhcmJpdGVyc1tfYWRkcl0ubG9ja2VkID0gX2xvY2s7CiAgICAgICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAvLyBmbHVzaCB0aGUgaG91c2UgZmVlcyB3aGVuZXZlciBjb21tYW5kZWQgdG8uCiAgICAgICAgLy8gaWdub3JlIHRoZSB0aHJlc2hvbGQgYW5kIHRoZSBsYXN0IHBheW91dCB0aW1lCiAgICAgICAgLy8gYnV0IHRoaXMgdGltZSBvbmx5IHJlc2V0IGxhc3RwYXlvdXR0aW1lIHVwb24gc3VjY2VzcwogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gZmx1c2hIb3VzZUZlZXMoKQogICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgib25seSBvd25lciBjYWxscyB0aGlzIGZ1bmN0aW9uIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhvdXNlRmVlSG9sZG92ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbnRtcGhvID0gaG91c2VGZWVIb2xkb3ZlcjsKICAgICAgICAgICAgICAgICAgICAgICAgaG91c2VGZWVIb2xkb3ZlciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdG9rZW5QYXJ0bmVyLmNhbGwuZ2FzKHRva0NhbGxHYXMpLnZhbHVlKG50bXBobykoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvdXNlRmVlSG9sZG92ZXIgPSBudG1waG87IC8vIHB1dCBpdCBiYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RhdEV2ZW50KCJIb3VzZS1GZWUgRXJyb3IyIik7IAogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RQYXlvdXRUaW1lID0gbm93OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiSG91c2UtRmVlIFBhaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCgogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAvLyB3aXRoZHJhdyBleHBlbnNlIGZ1bmRzIHRvIGFyYml0ZXIKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gd2l0aGRyYXdBcmJGdW5kcygpIHB1YmxpYwogICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICghdmFsaWRBcmIyKG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiaW52YWxpZCBhcmJpdGVyIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhcmJpdGVyIHhhcmIgPSBhcmJpdGVyc1ttc2cuc2VuZGVyXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhhcmIuYXJiSG9sZG92ZXIgPT0gMCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIjAgQmFsYW5jZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9hbW91bnQgPSB4YXJiLmFyYkhvbGRvdmVyOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4YXJiLmFyYkhvbGRvdmVyID0gMDsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtc2cuc2VuZGVyLmNhbGwuZ2FzKGFjY3RDYWxsR2FzKS52YWx1ZShfYW1vdW50KSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIHNldCB0aGUgdG9rZW4gcGFydG5lcgogICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gc2V0VG9rZW5QYXJ0bmVyKGFkZHJlc3MgX2FkZHIpIHB1YmxpYwogICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgICAgICAgfSAKCiAgICAgICAgICAgICAgICBpZiAoKHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkgCiAgICAgICAgICAgICAgICAgICAgICAgICYmICh0b2tlblBhcnRuZXIgPT0gYWRkcmVzcygwKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5QYXJ0bmVyID0gX2FkZHI7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRFdmVudCgiVG9rZW4gUGFydG5lciBGaW5hbCEiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2V0dGluZ3NTdGF0ZSAhPSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuUGFydG5lciA9IF9hZGRyOwogICAgICAgICAgICAgICAgICAgICAgICBTdGF0RXZlbnQoIlRva2VuIFBhcnRuZXIgQXNzaWduZWQhIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIC8vIHN3YXAgZXhlY3V0b3IKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfYWRkcikgCiAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIKICAgICAgICAgICAgICAgICAgICAgICAgfHwgc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKQogICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3c7CgogICAgICAgICAgICAgICAgb3duZXIgPSBfYWRkcjsKICAgICAgICB9Cgp9'.
	

]
