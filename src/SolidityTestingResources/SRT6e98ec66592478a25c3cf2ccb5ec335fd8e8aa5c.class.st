Class {
	#name : #SRT6e98ec66592478a25c3cf2ccb5ec335fd8e8aa5c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6e98ec66592478a25c3cf2ccb5ec335fd8e8aa5c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKgoqCiogRG9tYWluIG9uIGRheSAxOiBodHRwczovL2V0aGVyYm9uZHMuaW8vCioKKiBUaGlzIGNvbnRyYWN0IGltcGxlbWVudHMgYm9uZCBjb250cmFjdHMgb24gdGhlIEV0aGVyZXVtIGJsb2NrY2hhaW4KKiAtIFlvdSBjYW4gYnV5IGEgYm9uZCBmb3IgRVRIIChOb21pbmFsUHJpY2UpCiogLSBXaGlsZSBidXlpbmcgeW91IGNhbiBzZXQgYSBkZXNpcmFibGUgTWF0dXJpdHlEYXRlCiogLSBBZnRlciB5b3UgcmVhY2ggdGhlIE1hdHVyaXR5RGF0ZSB5b3UgY2FuIHJlZGVlbSB0aGUgYm9uZCBmb3IgdGhlIE1hdHVyaXR5UHJpY2UKKiAtIE1hdHVyaXR5UHJpY2UgaXMgYWx3YXlzIGdyZWF0ZXIgdGhhbiB0aGUgTm9taW5hbFByaWNlCiogLSBncmVhdGVyIHRoZSBNYXR1cml0eURhdGUgPSBoaWdoZXIgcHJvZml0CiogLSBZb3UgY2FuJ3QgcmVkZWVtIGEgYm9uZCBhZnRlciBNYXhSZWRlZW1UaW1lCiogCiogRm9yIGV4YW1wbGUsIHlvdSBib3VnaHQgYSBib25kIGZvciAxIEVUSCB3aGljaCB3aWxsIG1hdHVyZSBpbiAxIG1vbnRoIGZvciA2MyUgcHJvZml0LgoqIEFmdGVyIHRoZSBtb250aCB5b3UgY2FuIHJlZGVlbSB0aGUgYm9uZCBhbmQgcmVjZWl2ZSB5b3VyIDEuNjMgRVRILgoqCiogSWYgeW91IGRvbid0IHdhbnQgdG8gd2FpdCBmb3IgeW91ciBib25kIG1hdHVyaXR5IHlvdSBjYW4gc2VsbCBpdCB0byBhbm90aGVyIGludmVzdG9yLiAKKiBGb3IgZXhhbXBsZSB5b3UgYm91Z2h0IGEgMSB5ZWFyIGJvbmQsIDYgbW9udGhzIGhhdmUgcGFzc2VkIGFuZCB5b3UgdXJnZW50bHkgbmVlZCBtb25leS4gCiogWW91IGNhbiBzZWxsIHRoZSBib25kIG9uIGEgc2Vjb25kYXJ5IG1hcmtldCB0byBvdGhlciBpbnZlc3RvcnMgYmVmb3JlIHRoZSBtYXR1cml0eSBkYXRlLgoqIFlvdSBjYW4gYWxzbyByZWRlZW0geW91ciBib25kIHByZW1hdHVyZWx5IGJ1dCBvbmx5IGZvciBhIHBhcnQgb2YgdGhlIG5vbWluYWwgcHJpY2UuCioKKiAhISEgVEhJUyBJUyBBIEhJR0ggUklTSyBJTlZFU1RNRU5UIEFTU0VUICEhIQoqICEhISBUSElTIElTIEdBTUJMSU5HICEhIQoqICEhISBUSElTIElTIEEgUE9OWkkgU0NIRU1FICEhIQoqIEFsbCBmdW5kcyBpbnZlc3RlZCBhcmUgZ29pbmcgdG8gcHJldiBpbnZlc3RvcnMgZm9yIHRoZSBleGNlcHRpb24gb2YgRm91bmRlckZlZSBhbmQgQWdlbnRGZWUKKgoqIEJvbmRzIGFyZSBnZW5lcmF0aW5nIHByb2ZpdCBkdWUgdG8gTkVXIGFuZCBORVcgaW52ZXN0b3JzIEJVWUlORyB0aGVtCiogSWYgdGhlIGNvbnRyYWN0IGhhcyBubyBFVEggaW4gaXQgeW91IHdpbGwgRkFJTCB0byByZWRlZW0geW91ciBib25kCiogSG93ZXZlciBhcyBzb29uIGFzIG5ldyBib25kcyB3aWxsIGJlIGlzc3VlZCB0aGUgY29udHJhY3Qgd2lsbCByZWNlaXZlIEVUSCBhbmQKKiB5b3Ugd2lsbCBiZSBhYmxlIHRvIHJlZGVlbSB0aGUgYm9uZC4KKgoqIFlvdSBjYW4gYWxzbyByZWZlciBhIGZyaWVuZCBmb3IgMTAlIG9mIHRoZSBib25kcyBoZSBidXlzLiBZb3VyIGZyaWVuZCB3aWxsIGFsc28gcmVjZWl2ZSBhIHJlZmVycmFsIGJvbnVzIGZvciB0cmFkaW5nIHdpdGggeW91ciBjb2RlIQoqCiovCgovKgoqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoqIE1haW4gZnVuY3Rpb25zIGFyZToKKiBCdXkoKSAtIHRvIGJ1eSBhIG5ldyBpc3N1ZWQgYm9uZAoqIFJlZGVlbSgpIC0gdG8gcmVkZWVtIHlvdXIgYm9uZCBmb3IgcHJvZml0IAoqCiogQnV5T25TZWNvbmRhcnlNYXJrZXQoKSAtIHRvIGJ1eSBhIGJvbmQgZnJvbSBvdGhlciBpbnZlc3RvcnMKKiBQbGFjZVNlbGxPcmRlcigpIC0gdG8gcGxhY2UgeW91ciBib25kIG9uIHRoZSBzZWNvbmRhcnkgbWFya2V0IGZvciBzZWxsaW5nCiogQ2FuY2VsU2VsbE9yZGVyKCkgLSBzdG9wIHNlbGxpbmcgeW91ciBib25kCiogV2l0aGRyYXcoKSAtIHRvIHdpdGhkcmF3IGFnYW50IGNvbW1pc3Npb24gb3IgZnVuZHMgYWZ0ZXIgc2VsbGluZyBhIGJvbmQgb24gdGhlIHNlY29uZGFyeSBtYXJrZXQKKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKi8KCi8qKgovKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiovCmNvbnRyYWN0IFNhZmVNYXRoIAp7CiAgICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgCiAgICB7CiAgICAgICAgdWludCBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgCiAgICB7CiAgICAgICAgYXNzZXJ0KGIgPiAwKTsKICAgICAgICB1aW50IGMgPSBhIC8gYjsKICAgICAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgCiAgICB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSAKICAgIHsKICAgICAgICB1aW50IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHB1cmUKICAgIHsKICAgICAgICBpZiAoIWFzc2VydGlvbikgCiAgICAgICAgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9ICAgCiAgICB9Cn0KCmNvbnRyYWN0IEV0aGVyQm9uZHMgaXMgU2FmZU1hdGgKewogICAgLyogQSBmb3VuZGVyIGNhbiB3cml0ZSBoZXJlIHVzZWZ1bCBpbmZvcm1hdGlvbiAqLwogICAgLyogRm9yIGV4YW1wbGUgY3VycmVudCBkb21haW4gbmFtZSBvciByZXBvcnQgYSBwcm9ibGVtICovCiAgICBzdHJpbmcgcHVibGljIFJFQURNRSA9ICJTVEFUVVNfT0siOwogICAgCiAgICAvKiBZb3UgY2FuIHJlZmVyIGEgZnJpZW5kIGFuZCB5b3Ugd2lsbCBiZSByZWNlaXZpbmcgYSBib251cyBmb3IgRUFDSCBoaXMgZGVhbCAqLwogICAgLyogVGhlIGZyaWVuZCB3aWxsIGFsc28gaGF2ZSBhIGJvbnVzIGJ1dCBvbmx5IG9uY2UgKi8KICAgIC8qIFlvdSBzaG91bGQgaGF2ZSBhdCBsZWFzdCBvbmUgYm9uZCBpbiB5b3VyIGhpc3RvcnkgdG8gYmUgYW4gYWdlbnQgKi8KICAgIC8qIEp1c3QgYXNrIHlvdXIgZnJpZW5kIHRvIHNwZWNpZnkgeW91ciB3YWxsZXQgYWRkcmVzcyB3aXRoIGhpcyBGSVJTVCBkZWFsICovCiAgICB1aW50MzIgQWdlbnRCb251c0luUGVyY2VudCA9IDEwOwogICAgLyogQSB1c2VyIGdldHMgYSBib251cyBmb3IgYWRkaW5nIGFuIGFnZW50IGZvciBoaXMgZmlyc3QgZGVhbCAqLwogICAgdWludDMyIFVzZXJSZWZCb251c0luUGVyY2VudCA9IDM7CiAgICAKICAgIC8qIEhvdyBsb25nIGl0IHRha2VzIGZvciBhIGJvbmQgdG8gbWF0dXJlICAqLwogICAgdWludDMyIE1pbk1hdHVyaXR5VGltZUluRGF5cyA9IDMwOyAvLyBkb24ndCBzZXQgbGVzcyB0aGFuIDE1IGRheXMKICAgIHVpbnQzMiBNYXhNYXR1cml0eVRpbWVJbkRheXMgPSAyNDA7CiAgICAKICAgIC8qIE1pbmltdW0gcHJpY2Ugb2YgYSBib25kICovCiAgICB1aW50IE1pbk5vbWluYWxCb25kUHJpY2UgPSAwLjAwNiBldGhlcjsKICAgIAogICAgLyogSG93IG11Y2ggJSBvZiB5b3VyIGJvbmQgeW91IGNhbiByZWRlZW0gcHJlbWF0dXJlbHkgKi8KICAgIHVpbnQzMiBQcmVtYXR1cmVSZWRlZW1QYXJ0SW5QZXJjZW50ID0gMjU7CiAgICAvKiBIb3cgbXVjaCB0aGlzIG9wdGlvbiBjb3N0cyAqLwogICAgdWludDMyIFByZW1hdHVyZVJlZGVlbUNvc3RJblBlcmNlbnQgPSAyMDsKICAgIAogICAgLyogQmUgY2FyZWZ1bCEgKi8KICAgIC8qIElmIHlvdSBkb24ndCByZWRlZW0geW91ciBib25kIEFGVEVSIGl0cyBtYXR1cml0eSBkYXRlICovCiAgICAvKiB0aGUgYm9uZCB3aWxsIGJlY29tZSBpcnJlZGVlbWFibGUhICovCiAgICB1aW50MzIgUmVkZWVtUmFuZ2VJbkRheXMgPSAxOwogICAgdWludDMyIEV4dHJhUmVkZWVtUmFuZ2VJbkRheXMgPSAzOwogICAgLyogSG93ZXZlciB5b3UgY2FuIHByb2xvbmcgeW91ciByZWRlZW0gcGVyaW9kIGZvciBhIHByaWNlICovCiAgICB1aW50MzIgRXh0cmFSZWRlZW1SYW5nZUNvc3RJblBlcmNlbnQgPSAxMDsKICAgIAogICAgLyogRm91bmRlciB0YWtlcyBhIGZlZSBmb3IgZWFjaCBib25kIHNvbGQgKi8KICAgIC8qIFRoZXJlIGlzIG5vIHdheSBmb3IgYSBmb3VuZGVyIHRvIHRha2UgYWxsIHRoZSBjb250cmFjdCdzIG1vbmV5LCBmb25kZXIgdGFrZXMgb25seSB0aGUgZmVlICovCiAgICBhZGRyZXNzIHB1YmxpYyBGb3VuZGVyOwogICAgdWludDMyIHB1YmxpYyBGb3VuZGVyRmVlSW5QZXJjZW50ID0gNTsKICAgIAogICAgLyogRXZlbnRzICovCiAgICBldmVudCBJc3N1ZWQodWludDMyIGJvbmRJZCwgYWRkcmVzcyBvd25lcik7CiAgICBldmVudCBTb2xkKHVpbnQzMiBib25kSWQsIGFkZHJlc3Mgc2VsbGVyLCBhZGRyZXNzIGJ1eWVyLCB1aW50IHByaWNlKTsKICAgIGV2ZW50IFNlbGxPcmRlclBsYWNlZCh1aW50MzIgYm9uZElkLCBhZGRyZXNzIHNlbGxlcik7CiAgICBldmVudCBTZWxsT3JkZXJDYW5jZWxlZCh1aW50MzIgYm9uZElkLCBhZGRyZXNzIHNlbGxlcik7CiAgICBldmVudCBSZWRlZW1lZCh1aW50MzIgYm9uZElkLCBhZGRyZXNzIG93bmVyKTsKICAgIAogICAgc3RydWN0IEJvbmQgCiAgICB7CiAgICAgICAgLyogVW5pcXVlIElEIG9mIGEgYm9uZCAqLwogICAgICAgIHVpbnQzMiBpZDsKICAgICAgICAKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIAogICAgICAgIHVpbnQzMiBpc3N1ZVRpbWU7CiAgICAgICAgdWludDMyIG1hdHVyaXR5VGltZTsKICAgICAgICB1aW50MzIgcmVkZWVtVGltZTsKICAgICAgICAKICAgICAgICAvKiBBIGJvbmQgY2FuJ3QgYmUgcmVkZWVtZWQgYWZ0ZXIgdGhpcyBkYXRlICovCiAgICAgICAgdWludDMyIG1heFJlZGVlbVRpbWU7CiAgICAgICAgYm9vbCBjYW5CZVJlZGVlbWVkUHJlbWF0dXJlbHk7CiAgICAgICAgCiAgICAgICAgdWludCBub21pbmFsUHJpY2U7CiAgICAgICAgdWludCBtYXR1cml0eVByaWNlOwogICAgICAgIAogICAgICAgIC8qIFlvdSBjYW4gcmVzZWxsIHlvdXIgYm9uZCB0byBhbm90aGVyIHVzZXIgKi8KICAgICAgICB1aW50IHNlbGxpbmdQcmljZTsKICAgIH0KICAgIHVpbnQzMiBOZXh0Qm9uZElEID0gMTsKICAgIG1hcHBpbmcodWludDMyID0+IEJvbmQpIHB1YmxpYyBCb25kczsKICAgIAogICAgc3RydWN0IFVzZXJJbmZvCiAgICB7CiAgICAgICAgLyogVGhpcyBhZGRyZXNzIHdpbGwgcmVjZWl2ZSBjb21taXNzaW9uIGZvciB0aGlzIHVzZXIgdHJhZGluZyAqLwogICAgICAgIGFkZHJlc3MgYWdlbnQ7CiAgICAgICAgCiAgICAgICAgdWludDMyIHRvdGFsQm9uZHM7CiAgICAgICAgbWFwcGluZyh1aW50MzIgPT4gdWludDMyKSBib25kczsKICAgIH0KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBVc2VySW5mbykgcHVibGljIFVzZXJzOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgQmFsYW5jZXM7CgogICAgLyogTUFJTiAqLwogICAgCiAgICBmdW5jdGlvbiBFdGhlckJvbmRzKCkgcHVibGljIAogICAgewogICAgICAgIEZvdW5kZXIgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBDb250cmFjdEluZm8oKSAKICAgICAgICBwdWJsaWMgdmlldyByZXR1cm5zKAogICAgICAgICAgICBzdHJpbmcgcmVhZG1lLAogICAgICAgICAgICB1aW50MzIgYWdlbnRCb251c0luUGVyY2VudCwKICAgICAgICAgICAgdWludDMyIHVzZXJSZWZCb251c0luUGVyY2VudCwKICAgICAgICAgICAgdWludDMyIG1pbk1hdHVyaXR5VGltZUluRGF5cywKICAgICAgICAgICAgdWludDMyIG1heE1hdHVyaXR5VGltZUluRGF5cywKICAgICAgICAgICAgdWludCBtaW5Ob21pbmFsQm9uZFByaWNlLAogICAgICAgICAgICB1aW50MzIgcHJlbWF0dXJlUmVkZWVtUGFydEluUGVyY2VudCwKICAgICAgICAgICAgdWludDMyIHByZW1hdHVyZVJlZGVlbUNvc3RJblBlcmNlbnQsCiAgICAgICAgICAgIHVpbnQzMiByZWRlZW1SYW5nZUluRGF5cywKICAgICAgICAgICAgdWludDMyIGV4dHJhUmVkZWVtUmFuZ2VJbkRheXMsCiAgICAgICAgICAgIHVpbnQzMiBleHRyYVJlZGVlbVJhbmdlQ29zdEluUGVyY2VudCwKICAgICAgICAgICAgdWludDMyIG5leHRCb25kSUQsCiAgICAgICAgICAgIHVpbnQgYmFsYW5jZQogICAgICAgICAgICApCiAgICB7CiAgICAgICAgcmVhZG1lID0gUkVBRE1FOwogICAgICAgIGFnZW50Qm9udXNJblBlcmNlbnQgPSBBZ2VudEJvbnVzSW5QZXJjZW50OwogICAgICAgIHVzZXJSZWZCb251c0luUGVyY2VudCA9IFVzZXJSZWZCb251c0luUGVyY2VudDsKICAgICAgICBtaW5NYXR1cml0eVRpbWVJbkRheXMgPSBNaW5NYXR1cml0eVRpbWVJbkRheXM7CiAgICAgICAgbWF4TWF0dXJpdHlUaW1lSW5EYXlzID0gTWF4TWF0dXJpdHlUaW1lSW5EYXlzOwogICAgICAgIG1pbk5vbWluYWxCb25kUHJpY2UgPSBNaW5Ob21pbmFsQm9uZFByaWNlOwogICAgICAgIHByZW1hdHVyZVJlZGVlbVBhcnRJblBlcmNlbnQgPSBQcmVtYXR1cmVSZWRlZW1QYXJ0SW5QZXJjZW50OwogICAgICAgIHByZW1hdHVyZVJlZGVlbUNvc3RJblBlcmNlbnQgPSBQcmVtYXR1cmVSZWRlZW1Db3N0SW5QZXJjZW50OwogICAgICAgIHJlZGVlbVJhbmdlSW5EYXlzID0gUmVkZWVtUmFuZ2VJbkRheXM7CiAgICAgICAgZXh0cmFSZWRlZW1SYW5nZUluRGF5cyA9IEV4dHJhUmVkZWVtUmFuZ2VJbkRheXM7CiAgICAgICAgZXh0cmFSZWRlZW1SYW5nZUNvc3RJblBlcmNlbnQgPSBFeHRyYVJlZGVlbVJhbmdlQ29zdEluUGVyY2VudDsKICAgICAgICBuZXh0Qm9uZElEID0gTmV4dEJvbmRJRDsKICAgICAgICBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgfQogICAgCiAgICAvKiBUaGlzIGZ1bmN0aW9uIGNhbGNzIGhvdyBtdWNoIHByb2ZpdCB3aWxsIGEgYm9uZCBicmluZyAqLwogICAgZnVuY3Rpb24gTWF0dXJpdHlQcmljZSgKICAgICAgICB1aW50IG5vbWluYWxQcmljZSwgCiAgICAgICAgdWludDMyIG1hdHVyaXR5VGltZUluRGF5cywKICAgICAgICBib29sIGhhc0V4dHJhUmVkZWVtUmFuZ2UsCiAgICAgICAgYm9vbCBjYW5CZVJlZGVlbWVkUHJlbWF0dXJlbHksCiAgICAgICAgYm9vbCBoYXNSZWZCb251cwogICAgICAgICkgCiAgICAgICAgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KQogICAgewogICAgICAgIHVpbnQgbm9taW5hbFByaWNlTW9kaWZpZXJJblBlcmNlbnQgPSAxMDA7CiAgICAgICAgCiAgICAgICAgaWYgKGhhc0V4dHJhUmVkZWVtUmFuZ2UpCiAgICAgICAgewogICAgICAgICAgICBub21pbmFsUHJpY2VNb2RpZmllckluUGVyY2VudCA9IHN1YigKICAgICAgICAgICAgICAgIG5vbWluYWxQcmljZU1vZGlmaWVySW5QZXJjZW50LCAKICAgICAgICAgICAgICAgIEV4dHJhUmVkZWVtUmFuZ2VDb3N0SW5QZXJjZW50CiAgICAgICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoY2FuQmVSZWRlZW1lZFByZW1hdHVyZWx5KQogICAgICAgIHsKICAgICAgICAgICAgbm9taW5hbFByaWNlTW9kaWZpZXJJblBlcmNlbnQgPSBzdWIoCiAgICAgICAgICAgICAgICBub21pbmFsUHJpY2VNb2RpZmllckluUGVyY2VudCwgCiAgICAgICAgICAgICAgICBQcmVtYXR1cmVSZWRlZW1Db3N0SW5QZXJjZW50CiAgICAgICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoaGFzUmVmQm9udXMpCiAgICAgICAgewogICAgICAgICAgICBub21pbmFsUHJpY2VNb2RpZmllckluUGVyY2VudCA9IGFkZCgKICAgICAgICAgICAgICAgIG5vbWluYWxQcmljZU1vZGlmaWVySW5QZXJjZW50LCAKICAgICAgICAgICAgICAgIFVzZXJSZWZCb251c0luUGVyY2VudAogICAgICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbm9taW5hbFByaWNlID0gZGl2KAogICAgICAgICAgICBtdWwobm9taW5hbFByaWNlLCBub21pbmFsUHJpY2VNb2RpZmllckluUGVyY2VudCksIAogICAgICAgICAgICAxMDAKICAgICAgICAgICAgKTsKICAgICAgICAKICAgICAgICAvL3kgPSAxLjE3NzY4MyAtIDAuMDIxMzQ5MjEqeCArIDAuMDAxMTEyMzQ2KnheMiAtIDAuMDAwMDEwMTk0KnheMyArIDAuMDAwMDAwMDUyOTg4NDQqeF40CiAgICAgICAgLyoKICAgICAgICAxNWRheXMgICAgICAgICs3JQogICAgICAgIDMwZGF5cyAgICAgICArMzAlCiAgICAgICAgNjBkYXlzICAgICAgKzEzOCUKICAgICAgICAxMjBkYXlzICAgICArNzAwJQogICAgICAgIDI0MGRheXMgICAgKzk0MDAlIAogICAgICAgICovCiAgICAgICAgCiAgICAgICAgdWludCB4ID0gbWF0dXJpdHlUaW1lSW5EYXlzOwogICAgICAgIAogICAgICAgIC8qIFRoZSBmb3JtdWxhIHdpbGwgYnJlYWsgaWYgeCA8IDE1ICovCiAgICAgICAgcmVxdWlyZSh4ID49IDE1KTsKICAgICAgICAKICAgICAgICB2YXIgYSA9IG11bCgyMTM0OTIxMDAwLCB4KTsKICAgICAgICB2YXIgYiA9IG11bChtdWwoMTExMjM0NjAwLCB4KSwgeCk7CiAgICAgICAgdmFyIGMgPSBtdWwobXVsKG11bCgxMDE5NDAwLCB4KSwgeCksIHgpOwogICAgICAgIHZhciBkID0gbXVsKG11bChtdWwobXVsKDUyOTgsIHgpLCB4KSwgeCksIHgpOwogICAgICAgIAogICAgICAgIHZhciBrID0gc3ViKHN1YihhZGQoYWRkKDExNzE2ODMwMDAwMCwgYiksIGQpLCBhKSwgYyk7CiAgICAgICAgayA9IGRpdihrLCAxMDAwMDAwMCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGRpdihtdWwobm9taW5hbFByaWNlLCBrKSwgMTAwMDApOwogICAgfQogICAgCiAgICAvKiBUaGlzIGZ1bmN0aW9uIGNoZWNrcyBpZiB5b3UgY2FuIGNoYW5nZSB5b3VyIGJvbmQgYmFjayB0byBtb25leSAqLwogICAgZnVuY3Rpb24gQ2FuQmVSZWRlZW1lZChCb25kIGJvbmQpIAogICAgICAgIGludGVybmFsIHZpZXcgcmV0dXJucyhib29sKSAKICAgIHsKICAgICAgICByZXR1cm4gCiAgICAgICAgICAgIGJvbmQuaXNzdWVUaW1lID4gMCAmJiAgICAgICAgICAgICAgICAgICAgICAgLy8gYSBib25kIHNob3VsZCBiZSBpc3N1ZWQKICAgICAgICAgICAgYm9uZC5vd25lciAhPSAwICYmICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCBzaG91bGQgc2hvdWxkIGhhdmUgYW4gb3duZXIKICAgICAgICAgICAgYm9uZC5yZWRlZW1UaW1lID09IDAgJiYgICAgICAgICAgICAgICAgICAgICAvLyBpdCBzaG91bGQgbm90IGJlIGFscmVhZHkgcmVkZWVtZWQKICAgICAgICAgICAgYm9uZC5zZWxsaW5nUHJpY2UgPT0gMCAmJiAgICAgICAgICAgICAgICAgICAvLyBpdCBzaG91bGQgbm90IGJlIHJlc2VydmVkIGZvciBzZWxsaW5nCiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICFJc1ByZW1hdHVyZShib25kLm1hdHVyaXR5VGltZSkgfHwgICAgICAvLyBpdCBzaG91bGQgYmUgbWF0dXJlIC8gYmUgcmVkZWVtYWJsZSBwcmVtYXR1cmVseSAKICAgICAgICAgICAgICAgIGJvbmQuY2FuQmVSZWRlZW1lZFByZW1hdHVyZWx5CiAgICAgICAgICAgICkgJiYgICAgICAgCiAgICAgICAgICAgIGJsb2NrLnRpbWVzdGFtcCA8PSBib25kLm1heFJlZGVlbVRpbWU7ICAgICAgLy8gYmUgY2FyZWZ1bCwgeW91IGNhbid0IHJlZGVlbSB0b28gb2xkIGJvbmRzCiAgICB9CiAgICAKICAgIC8qIEZvciBzb21lIGV4dGVybmFsIGNoZWNraW5ncyB3ZSBnb25uYSB0byB3cmFwIHRoaXMgaW4gYSBmdW5jdGlvbiAqLwogICAgZnVuY3Rpb24gSXNQcmVtYXR1cmUodWludCBtYXR1cml0eVRpbWUpCiAgICAgICAgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSAKICAgIHsKICAgICAgICByZXR1cm4gbWF0dXJpdHlUaW1lID4gYmxvY2sudGltZXN0YW1wOwogICAgfQogICAgCiAgICAvKiBUaGlzIGlzIGhvdyB5b3UgYnV5IGJvbmRzIG9uIHRoZSBwcmltYXJ5IG1hcmtldCAqLwogICAgZnVuY3Rpb24gQnV5KAogICAgICAgIHVpbnQzMiBtYXR1cml0eVRpbWVJbkRheXMsCiAgICAgICAgYm9vbCBoYXNFeHRyYVJlZGVlbVJhbmdlLAogICAgICAgIGJvb2wgY2FuQmVSZWRlZW1lZFByZW1hdHVyZWx5LAogICAgICAgIGFkZHJlc3MgYWdlbnQgLy8geW91IGNhbiBsZWF2ZSBpdCAwCiAgICAgICAgKSAKICAgICAgICBwdWJsaWMgcGF5YWJsZQogICAgewogICAgICAgIC8qIFdlIGRvbid0IGlzc3VlIGJvbmRzIGNoZWFwZXIgdGhhbiBNaW5Ob21pbmFsQm9uZFByaWNlKi8KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBNaW5Ob21pbmFsQm9uZFByaWNlKTsKICAgICAgICAKICAgICAgICAvKiBXZSBkb24ndCBpc3N1ZSBib25kcyBvdXQgb2YgYWxsb3dlZCBtYXR1cml0eSByYW5nZSAqLwogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1hdHVyaXR5VGltZUluRGF5cyA+PSBNaW5NYXR1cml0eVRpbWVJbkRheXMgJiYgCiAgICAgICAgICAgIG1hdHVyaXR5VGltZUluRGF5cyA8PSBNYXhNYXR1cml0eVRpbWVJbkRheXMKICAgICAgICAgICAgKTsKICAgICAgICAgICAgCiAgICAgICAgLyogWW91IGNhbiBoYXZlIGEgYm9udXMgb24geW91ciBmaXJzdCBkZWFsIGlmIHNwZWNpZnkgYW4gYWdlbnQgKi8KICAgICAgICBib29sIGhhc1JlZkJvbnVzID0gZmFsc2U7CiAgICAgICAgICAgIAogICAgICAgIC8qIE9uIHlvdXIgZmlyc3QgZGVhbCAuLi4gICovCiAgICAgICAgaWYgKFVzZXJzW21zZy5zZW5kZXJdLmFnZW50ID09IDAgJiYgVXNlcnNbbXNnLnNlbmRlcl0udG90YWxCb25kcyA9PSAwKQogICAgICAgIHsKICAgICAgICAgICAgLyogLi4uIHlvdSBtYXkgc3BlY2lmeSBhbiBhZ2VudCBhbmQgZ2V0IGEgYm9udXMgZm9yIHRoaXMgLi4uICovCiAgICAgICAgICAgIGlmIChhZ2VudCAhPSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvKiAuLi4gdGhlIGFnZW50IHNob3VsZCBoYXZlIHNvbWUgYm9uZHMgYmVoaW5kIGhpbSAqLwogICAgICAgICAgICAgICAgaWYgKFVzZXJzW2FnZW50XS50b3RhbEJvbmRzID4gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBVc2Vyc1ttc2cuc2VuZGVyXS5hZ2VudCA9IGFnZW50OwogICAgICAgICAgICAgICAgICAgIGhhc1JlZkJvbnVzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBhZ2VudCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLyogT24gYWxsIHlvdXIgbmV4dCBkZWFscyB5b3Ugd2lsbCBoYXZlIHRoZSBzYW1lIGFnZW50IGFzIG9uIHRoZSBmaXJzdCBvbmUgKi8KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBhZ2VudCA9IFVzZXJzW21zZy5zZW5kZXJdLmFnZW50OwogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgLyogSXNzdWluZyBhIG5ldyBib25kICovCiAgICAgICAgQm9uZCBtZW1vcnkgbmV3Qm9uZDsKICAgICAgICBuZXdCb25kLmlkID0gTmV4dEJvbmRJRDsKICAgICAgICBuZXdCb25kLm93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBuZXdCb25kLmlzc3VlVGltZSA9IHVpbnQzMihibG9jay50aW1lc3RhbXApOwogICAgICAgIG5ld0JvbmQuY2FuQmVSZWRlZW1lZFByZW1hdHVyZWx5ID0gY2FuQmVSZWRlZW1lZFByZW1hdHVyZWx5OwogICAgICAgIAogICAgICAgIC8qIFlvdSBjYW50IHJlZGVlbSB5b3VyIGJvbmQgZm9yIHByb2ZpdCB1bnRpbGwgdGhpcyBkYXRlICovCiAgICAgICAgbmV3Qm9uZC5tYXR1cml0eVRpbWUgPSAKICAgICAgICAgICAgbmV3Qm9uZC5pc3N1ZVRpbWUgKyBtYXR1cml0eVRpbWVJbkRheXMqMjQqNjAqNjA7CiAgICAgICAgCiAgICAgICAgLyogWW91ciB0aW1lIHRvIHJlZGVlbSBpcyBsaW1pdGVkICovICAgIAogICAgICAgIG5ld0JvbmQubWF4UmVkZWVtVGltZSA9IAogICAgICAgICAgICBuZXdCb25kLm1hdHVyaXR5VGltZSArIChoYXNFeHRyYVJlZGVlbVJhbmdlP0V4dHJhUmVkZWVtUmFuZ2VJbkRheXM6UmVkZWVtUmFuZ2VJbkRheXMpKjI0KjYwKjYwOwogICAgICAgIAogICAgICAgIG5ld0JvbmQubm9taW5hbFByaWNlID0gbXNnLnZhbHVlOwogICAgICAgIAogICAgICAgIG5ld0JvbmQubWF0dXJpdHlQcmljZSA9IE1hdHVyaXR5UHJpY2UoCiAgICAgICAgICAgIG5ld0JvbmQubm9taW5hbFByaWNlLAogICAgICAgICAgICBtYXR1cml0eVRpbWVJbkRheXMsCiAgICAgICAgICAgIGhhc0V4dHJhUmVkZWVtUmFuZ2UsCiAgICAgICAgICAgIGNhbkJlUmVkZWVtZWRQcmVtYXR1cmVseSwKICAgICAgICAgICAgaGFzUmVmQm9udXMKICAgICAgICAgICAgKTsKICAgICAgICAKICAgICAgICBCb25kc1tuZXdCb25kLmlkXSA9IG5ld0JvbmQ7CiAgICAgICAgTmV4dEJvbmRJRCArPSAxOwogICAgICAgIAogICAgICAgIC8qIExpbmtpbmcgdGhlIGJvbmQgdG8gdGhlIG93bmVyIHNvIGxhdGVyIGhlIGNhbiBlYXNpbHkgZmluZCBpdCAqLwogICAgICAgIHZhciB1c2VyID0gVXNlcnNbbmV3Qm9uZC5vd25lcl07CiAgICAgICAgdXNlci5ib25kc1t1c2VyLnRvdGFsQm9uZHNdID0gbmV3Qm9uZC5pZDsKICAgICAgICB1c2VyLnRvdGFsQm9uZHMgKz0gMTsKICAgICAgICAKICAgICAgICAvKiBOb3RpZnkgYWxsIHVzZXJzIGFib3V0IHRoZSBpc3N1aW5nIGV2ZW50ICovCiAgICAgICAgSXNzdWVkKG5ld0JvbmQuaWQsIG5ld0JvbmQub3duZXIpOwogICAgICAgIAogICAgICAgIC8qIEZvdW5kZXIncyBmZWUgKi8KICAgICAgICB1aW50IG1vbmV5VG9Gb3VuZGVyID0gZGl2KAogICAgICAgICAgICBtdWwobmV3Qm9uZC5ub21pbmFsUHJpY2UsIEZvdW5kZXJGZWVJblBlcmNlbnQpLCAKICAgICAgICAgICAgMTAwCiAgICAgICAgICAgICk7CiAgICAgICAgLyogQWdlbnQgYm9udXMgKi8KICAgICAgICB1aW50IG1vbmV5VG9BZ2VudCA9IGRpdigKICAgICAgICAgICAgbXVsKG5ld0JvbmQubm9taW5hbFByaWNlLCBBZ2VudEJvbnVzSW5QZXJjZW50KSwgCiAgICAgICAgICAgIDEwMAogICAgICAgICAgICApOwogICAgICAgIAogICAgICAgIGlmIChhZ2VudCAhPSAwICYmIG1vbmV5VG9BZ2VudCA+IDApCiAgICAgICAgewogICAgICAgICAgICAvKiBBZ2VudCBjYW4gcG90ZW50aWFsbHkgYmxvY2sgdXNlcidzIHRyYWRpbmcgYXR0ZW1wdHMsIHNvIHdlIGRvbnQgdXNlIGp1c3QgLnRyYW5zZmVyKi8KICAgICAgICAgICAgQmFsYW5jZXNbYWdlbnRdID0gYWRkKEJhbGFuY2VzW2FnZW50XSwgbW9uZXlUb0FnZW50KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLyogRm91bmRlciBhbHdheXMgZ2V0cyBoaXMgZmVlICovCiAgICAgICAgcmVxdWlyZShtb25leVRvRm91bmRlciA+IDApOwogICAgICAgIAogICAgICAgIEZvdW5kZXIudHJhbnNmZXIobW9uZXlUb0ZvdW5kZXIpOwogICAgfQogICAgCiAgICAvKiBZb3UgY2FuIGFsc28gYnV5IGJvbmRzIG9uIHNlY29uZGFyeSBtYXJrZXQgZnJvbSBvdGhlciB1c2VycyAqLwogICAgZnVuY3Rpb24gQnV5T25TZWNvbmRhcnlNYXJrZXQodWludDMyIGJvbmRJZCkgCiAgICAgICAgcHVibGljIHBheWFibGUKICAgIHsKICAgICAgICB2YXIgYm9uZCA9IEJvbmRzW2JvbmRJZF07CiAgICAgICAgCiAgICAgICAgLyogQSBib25kIHlvdSBhcmUgYnV5aW5nIHNob3VsZCBiZSBpc3N1ZWQgKi8KICAgICAgICByZXF1aXJlKGJvbmQuaXNzdWVUaW1lID4gMCk7CiAgICAgICAgLyogQ2hlY2tpbmcsIGlmIHRoZSBib25kIGlzIGEgdmFsdWFibGUgYXNzZXQgKi8KICAgICAgICByZXF1aXJlKGJvbmQucmVkZWVtVGltZSA9PSAwICYmIGJsb2NrLnRpbWVzdGFtcCA8IGJvbmQubWF4UmVkZWVtVGltZSk7CiAgICAgICAgCiAgICAgICAgdmFyIHByaWNlID0gYm9uZC5zZWxsaW5nUHJpY2U7CiAgICAgICAgLyogWW91IGNhbiBvbmx5IGJ1eSBhIGJvbmQgaWYgYW4gb3duZXIgaXMgc2VsbGluZyBpdCAqLwogICAgICAgIHJlcXVpcmUocHJpY2UgPiAwKTsKICAgICAgICAvKiBZb3Ugc2hvdWxkIGhhdmUgZW5vdWdoIG1vbmV5IHRvIHBheSB0aGUgb3duZXIgKi8KICAgICAgICByZXF1aXJlKHByaWNlIDw9IG1zZy52YWx1ZSk7CiAgICAgICAgCiAgICAgICAgLyogSXQncyBvayBpZiB5b3UgYWNjaWRlbnRhbGx5IHRyYW5zZmVyIG1vcmUgbW9uZXksIHdlIHdpbGwgc2VuZCB0aGVtIGJhY2sgKi8KICAgICAgICB2YXIgcmVzaWR1ZSA9IG1zZy52YWx1ZSAtIHByaWNlOwogICAgICAgIAogICAgICAgIC8qIFRyYW5zZmVyaW5nIHRoZSBib25kICovCiAgICAgICAgdmFyIG9sZE93bmVyID0gYm9uZC5vd25lcjsKICAgICAgICB2YXIgbmV3T3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gMCAmJiBuZXdPd25lciAhPSBvbGRPd25lcik7CiAgICAgICAgCiAgICAgICAgYm9uZC5zZWxsaW5nUHJpY2UgPSAwOwogICAgICAgIGJvbmQub3duZXIgPSBuZXdPd25lcjsKICAgICAgICAKICAgICAgICB2YXIgdXNlciA9IFVzZXJzW2JvbmQub3duZXJdOwogICAgICAgIHVzZXIuYm9uZHNbdXNlci50b3RhbEJvbmRzXSA9IGJvbmQuaWQ7CiAgICAgICAgdXNlci50b3RhbEJvbmRzICs9IDE7CiAgICAgICAgCiAgICAgICAgLyogRG91YmxlY2hlY2tpbmcgdGhlIHByaWNlICovCiAgICAgICAgcmVxdWlyZShhZGQocHJpY2UsIHJlc2lkdWUpID09IG1zZy52YWx1ZSk7CiAgICAgICAgCiAgICAgICAgLyogTm90aWZ5IGFsbCB1c2VycyBhYm91dCB0aGUgZXhjaGFuZ2UgZXZlbnQgKi8KICAgICAgICBTb2xkKGJvbmQuaWQsIG9sZE93bmVyLCBuZXdPd25lciwgcHJpY2UpOwogICAgICAgIAogICAgICAgIC8qIE9sZCBvd25lciBjYW4gcG90ZW50aWFsbHkgYmxvY2sgdXNlcidzIHRyYWRpbmcgYXR0ZW1wdHMsIHNvIHdlIGRvbnQgdXNlIGp1c3QgLnRyYW5zZmVyKi8KICAgICAgICBCYWxhbmNlc1tvbGRPd25lcl0gPSBhZGQoQmFsYW5jZXNbb2xkT3duZXJdLCBwcmljZSk7CiAgICAgICAgCiAgICAgICAgaWYgKHJlc2lkdWUgPiAwKQogICAgICAgIHsKICAgICAgICAgICAgLyogSWYgdGhlcmUgaXMgcmVzaWR1ZSB3ZSB3aWxsIHNlbmQgaXQgYmFjayAqLwogICAgICAgICAgICBuZXdPd25lci50cmFuc2ZlcihyZXNpZHVlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qIFlvdSBjYW4gc2VsbCB5b3VyIGJvbmQgb24gdGhlIHNlY29uZGFyeSBtYXJrZXQgKi8KICAgIGZ1bmN0aW9uIFBsYWNlU2VsbE9yZGVyKHVpbnQzMiBib25kSWQsIHVpbnQgc2VsbGluZ1ByaWNlKSAKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvKiBUbyBwcm90ZWN0IGZyb20gYW4gYWNjaWRlbnRhbCBzZWxsaW5nIGJ5IDAgcHJpY2UgKi8KICAgICAgICAvKiBUaGUgc2VsbGluZyBwcmljZSBzaG91bGQgYmUgaW4gV2VpICovCiAgICAgICAgcmVxdWlyZShzZWxsaW5nUHJpY2UgPj0gTWluTm9taW5hbEJvbmRQcmljZSk7CiAgICAgICAgCiAgICAgICAgdmFyIGJvbmQgPSBCb25kc1tib25kSWRdOwogICAgICAgIAogICAgICAgIC8qIEEgYm9uZCB5b3UgYXJlIHNlbGxpbmcgc2hvdWxkIGJlIGlzc3VlZCAqLwogICAgICAgIHJlcXVpcmUoYm9uZC5pc3N1ZVRpbWUgPiAwKTsKICAgICAgICAvKiBZb3UgY2FuJ3QgdXBkYXRlIHNlbGxpbmcgcHJpY2UsIHBsZWFzZSwgY2FsbCBDYW5jZWxTZWxsT3JkZXIgYmVmb3JlaGFuZCAqLwogICAgICAgIHJlcXVpcmUoYm9uZC5zZWxsaW5nUHJpY2UgPT0gMCk7CiAgICAgICAgLyogWW91IGNhbid0IHNlbGwgdXNlbGVzcyBib25kcyAqLwogICAgICAgIHJlcXVpcmUoYm9uZC5yZWRlZW1UaW1lID09IDAgJiYgYmxvY2sudGltZXN0YW1wIDwgYm9uZC5tYXhSZWRlZW1UaW1lKTsKICAgICAgICAvKiBZb3Ugc2hvdWxkIG93biBhIGJvbmQgeW91J3JlIHNlbGxpbmcgKi8KICAgICAgICByZXF1aXJlKGJvbmQub3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgCiAgICAgICAgYm9uZC5zZWxsaW5nUHJpY2UgPSBzZWxsaW5nUHJpY2U7CiAgICAgICAgCiAgICAgICAgLyogTm90aWZ5IGFsbCB1c2VycyBhYm91dCB5b3Ugd2FudGluZyB0byBzZWxsIHRoZSBib25kICovCiAgICAgICAgU2VsbE9yZGVyUGxhY2VkKGJvbmQuaWQsIGJvbmQub3duZXIpOwogICAgfQogICAgCiAgICAvKiBZb3UgY2FuIGNhbmNlbCB5b3VyIHNlbGwgb3JkZXIgKi8KICAgIGZ1bmN0aW9uIENhbmNlbFNlbGxPcmRlcih1aW50MzIgYm9uZElkKSAKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICB2YXIgYm9uZCA9IEJvbmRzW2JvbmRJZF07CiAgICAgICAgCiAgICAgICAgLyogQm9uZCBzaG91bGQgYmUgcmVzZXJ2ZWQgZm9yIHNlbGxpbmcgKi8KICAgICAgICByZXF1aXJlKGJvbmQuc2VsbGluZ1ByaWNlID4gMCk7CiAgICAgICAgCiAgICAgICAgLyogWW91IHNob3VsZCBvd24gYSBib25kIHdoaWNoIHNlbGwgb3JkZXIgeW91J3JlIGNhbmNlbGxpbmcgKi8KICAgICAgICByZXF1aXJlKGJvbmQub3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgCiAgICAgICAgYm9uZC5zZWxsaW5nUHJpY2UgPSAwOwogICAgICAgIAogICAgICAgIC8qIE5vdGlmeSBhbGwgdXNlcnMgYWJvdXQgY2FuY2VsbGluZyB0aGUgc2VsbGluZyBvcmRlciAqLwogICAgICAgIFNlbGxPcmRlckNhbmNlbGVkKGJvbmQuaWQsIGJvbmQub3duZXIpOwogICAgfQogICAgCiAgICAvKiBTb21ldGltZXMgd2UgY2FuJ3QganVzdCB1c2UgLnRyYW5zZmVyIGZvciBhIHNlY3VyaXR5IHJlYXNvbiAqLwogICAgZnVuY3Rpb24gV2l0aGRyYXcoKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoQmFsYW5jZXNbbXNnLnNlbmRlcl0gPiAwKTsKCiAgICAgICAgLyogRG9uJ3QgZm9yZ2V0IGFib3V0IGRvdWJsZSBlbnRlcmluZyBpbiAudHJhbnNmZXIhICovCiAgICAgICAgdmFyIG1vbmV5ID0gQmFsYW5jZXNbbXNnLnNlbmRlcl07CiAgICAgICAgQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1vbmV5KTsKICAgIH0KCiAgICAvKiBZb3UgY2FuIHJlZGVlbSBib25kcyBiYWNrIHRvIHRoZSBjb250cmFjdCBmb3IgcHJvZml0ICovCiAgICAvKiBCdXQgeW91IG5lZWQgdG8gd2FpdCB0aWxsIG1hdHVyaXR5VGltZSAqLwogICAgLyogVGhpcyBpcyB0aGUga2V5IGZ1bmN0aW9uIHdoZXJlIHlvdSBnZXQgcHJvZml0IGZvciBhIGJvbmQgeW91IG93biAqLwogICAgZnVuY3Rpb24gUmVkZWVtKHVpbnQzMiBib25kSWQpIAogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHZhciBib25kID0gQm9uZHNbYm9uZElkXTsKICAgICAgICAKICAgICAgICByZXF1aXJlKENhbkJlUmVkZWVtZWQoYm9uZCkpOwogICAgICAgIAogICAgICAgIC8qIFlvdSBzaG91bGQgb3duIGEgYm9uZCB5b3UgcmVkZWVtICovCiAgICAgICAgcmVxdWlyZShib25kLm93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIAogICAgICAgIC8qIElmIGEgYm9uZCBoYXMgcmVkZWVtVGltZSBpdCBoYXMgYmVlbiByZWRlZW1lZCAqLwogICAgICAgIGJvbmQucmVkZWVtVGltZSA9IHVpbnQzMihibG9jay50aW1lc3RhbXApOwogICAgICAgIAogICAgICAgIC8qIElmIGl0J3MgYSBwcmVtYXR1cmUgcmVkZWVtIHlvdSB3aWxsIG9ubHkgZ2V0IAogICAgICAgIFByZW1hdHVyZVJlZGVlbVBhcnRJblBlcmNlbnQgb2Ygbm9taW5hbFByaWNlIGJhY2sgKi8KICAgICAgICBpZiAoSXNQcmVtYXR1cmUoYm9uZC5tYXR1cml0eVRpbWUpKQogICAgICAgIHsKICAgICAgICAgICAgYm9uZC5tYXR1cml0eVByaWNlID0gZGl2KAogICAgICAgICAgICAgICAgbXVsKGJvbmQubm9taW5hbFByaWNlLCBQcmVtYXR1cmVSZWRlZW1QYXJ0SW5QZXJjZW50KSwgCiAgICAgICAgICAgICAgICAxMDAKICAgICAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIE5vdGlmeSBhbGwgdXNlcnMgYWJvdXQgdGhlIHJlZGVlbSBldmVudCAqLwogICAgICAgIFJlZGVlbWVkKGJvbmQuaWQsIGJvbmQub3duZXIpOwogICAgICAgIAogICAgICAgIC8qIFRyYW5zZmVyIGZ1bmRzIHRvIHRoZSBvd25lciAqLwogICAgICAgIC8qIFRoaXMgaXMgaG93IHlvdSBlYXJuIG1vbmV5ICovCiAgICAgICAgYm9uZC5vd25lci50cmFuc2Zlcihib25kLm1hdHVyaXR5UHJpY2UpOwogICAgfQogICAgCiAgICAvKiBCZSBjYXJlZnVsbCwgdGhpcyBmdW5jdGlvbiBjYW4gcmV0dXJuIGEgYm91bmQgb2YgYSBkaWZmZXJldCBvd25lcgogICAgaWYgdGhlIGJvbmQgd2FzIHNvbGQuIEFsd2F5cyBjaGVjayB0aGUgYm9uZCBvd25lciAqLwogICAgZnVuY3Rpb24gVXNlckJvbmRCeU9mZnNldCh1aW50MzIgb2Zmc2V0KSAKICAgICAgICBwdWJsaWMgdmlldyAKICAgICAgICByZXR1cm5zKAogICAgICAgICAgICB1aW50MzIgYm9uZElkLAogICAgICAgICAgICBib29sIGNhbkJlUmVkZWVtZWQsCiAgICAgICAgICAgIGJvb2wgaXNQcmVtYXR1cmUKICAgICAgICAgICAgKSAKICAgIHsKICAgICAgICB2YXIgYm9uZCA9IEJvbmRzW1VzZXJzW21zZy5zZW5kZXJdLmJvbmRzW29mZnNldF1dOwogICAgICAgIAogICAgICAgIGJvbmRJZCA9IGJvbmQuaWQ7CiAgICAgICAgY2FuQmVSZWRlZW1lZCA9IENhbkJlUmVkZWVtZWQoYm9uZCk7CiAgICAgICAgaXNQcmVtYXR1cmUgPSBJc1ByZW1hdHVyZShib25kLm1hdHVyaXR5VGltZSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEJvbmRJbmZvQnlJZCh1aW50MzIgYm9uZElkKSAKICAgICAgICBwdWJsaWMgdmlldyAKICAgICAgICByZXR1cm5zKAogICAgICAgICAgICBib29sIGNhbkJlUmVkZWVtZWQsCiAgICAgICAgICAgIGJvb2wgaXNQcmVtYXR1cmUKICAgICAgICAgICAgKSAKICAgIHsKICAgICAgICB2YXIgYm9uZCA9IEJvbmRzW2JvbmRJZF07CiAgICAgICAgCiAgICAgICAgY2FuQmVSZWRlZW1lZCA9IENhbkJlUmVkZWVtZWQoYm9uZCk7CiAgICAgICAgaXNQcmVtYXR1cmUgPSBJc1ByZW1hdHVyZShib25kLm1hdHVyaXR5VGltZSk7CiAgICB9CiAgICAKICAgIC8qIEFETUlOICovCiAgICAgCiAgICBmdW5jdGlvbiBBZG1DaGFuZ2VfUkVBRE1FKHN0cmluZyB2YWx1ZSkgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IEZvdW5kZXIpOwogICAgICAgIAogICAgICAgIFJFQURNRSA9IHZhbHVlOwogICAgfQp9'.
	

]
