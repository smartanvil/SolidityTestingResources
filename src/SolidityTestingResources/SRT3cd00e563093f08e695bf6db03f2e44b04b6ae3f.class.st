Class {
	#name : #SRT3cd00e563093f08e695bf6db03f2e44b04b6ae3f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3cd00e563093f08e695bf6db03f2e44b04b6ae3f >> base64 [
	^ 'Ly8gQ3JlYXRlZCB1c2luZyBJQ08gV2l6YXJkIGh0dHBzOi8vZ2l0aHViLmNvbS9vcmFjbGVzb3JnL2ljby13aXphcmQgYnkgT3JhY2xlcyBOZXR3b3JrIApwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCgoKLyoKICogSGFsdGFibGUKICoKICogQWJzdHJhY3QgY29udHJhY3QgdGhhdCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuCiAqIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4gRGlmZmVycyBmcm9tIFBhdXNhYmxlIGJ5IGNhdXNpbmcgYSB0aHJvdyB3aGVuIGluIGhhbHQgbW9kZS4KICoKICoKICogT3JpZ2luYWxseSBlbnZpc2lvbmVkIGluIEZpcnN0Qmxvb2QgSUNPIGNvbnRyYWN0LgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgc3RvcE5vbk93bmVyc0luRW1lcmdlbmN5IHsKICAgIGlmIChoYWx0ZWQgJiYgbXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGlmICghaGFsdGVkKSB0aHJvdzsKICAgIF87CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgaGFsdGVkID0gdHJ1ZTsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGhhbHRlZCA9IGZhbHNlOwogIH0KCn0KCgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCi8qKgogKiBGaW5hbGl6ZSBhZ2VudCBkZWZpbmVzIHdoYXQgaGFwcGVucyBhdCB0aGUgZW5kIG9mIHN1Y2Nlc2VmdWwgY3Jvd2RzYWxlLgogKgogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkKICogLSBNYWtlIHRva2VucyB0cmFuc2ZlcmFibGUKICogLSBldGMuCiAqLwpjb250cmFjdCBGaW5hbGl6ZUFnZW50IHsKCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKiogUmV0dXJuIHRydWUgaWYgd2UgY2FuIHJ1biBmaW5hbGl6ZUNyb3dkc2FsZSgpIHByb3Blcmx5LgogICAqCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luCiAgICogdW5sZXNzIHRoZSBmaW5hbGl6ZXIgaGFzIGJlZW4gc2V0IHVwIHByb3Blcmx5LgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLwogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7Cgp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCgoKCgoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEEgdG9rZW4gdGhhdCBkZWZpbmVzIGZyYWN0aW9uYWwgdW5pdHMgYXMgZGVjaW1hbHMuCiAqLwpjb250cmFjdCBGcmFjdGlvbmFsRVJDMjBFeHQgaXMgRVJDMjAgewoKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKICB1aW50IHB1YmxpYyBtaW5DYXA7Cgp9CgoKCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4KICoKICogSGFuZGxlCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcwogKiAtIGFjY2VwdGluZyBpbnZlc3RtZW50cwogKiAtIG1pbmltdW0gZnVuZGluZyBnb2FsIGFuZCByZWZ1bmQKICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQKICogLSBkaWZmZXJlbnQgcHJpY2luZyBzdHJhdGVnaWVzCiAqIC0gZGlmZmVyZW50IGludmVzdG1lbnQgcG9saWNpZXMgKHJlcXVpcmUgc2VydmVyIHNpZGUgY3VzdG9tZXIgaWQsIGFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzKQogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlRXh0IGlzIEhhbHRhYmxlIHsKCiAgLyogTWF4IGludmVzdG1lbnQgY291bnQgd2hlbiB3ZSBhcmUgc3RpbGwgYWxsb3dlZCB0byBjaGFuZ2UgdGhlIG11bHRpc2lnIGFkZHJlc3MgKi8KICB1aW50IHB1YmxpYyBNQVhfSU5WRVNUTUVOVFNfQkVGT1JFX01VTFRJU0lHX0NIQU5HRSA9IDU7CgogIHVzaW5nIFNhZmVNYXRoTGliRXh0IGZvciB1aW50OwoKICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8KICBGcmFjdGlvbmFsRVJDMjBFeHQgcHVibGljIHRva2VuOwoKICAvKiBIb3cgd2UgYXJlIGdvaW5nIHRvIHByaWNlIG91ciBvZmZlcmluZyAqLwogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5OwoKICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50OwoKICAvKiBuYW1lIG9mIHRoZSBjcm93ZHNhbGUgdGllciAqLwogIHN0cmluZyBwdWJsaWMgbmFtZTsKCiAgLyogdG9rZW5zIHdpbGwgYmUgdHJhbnNmZXJlZCBmcm9tIHRoaXMgYWRkcmVzcyAqLwogIGFkZHJlc3MgcHVibGljIG11bHRpc2lnV2FsbGV0OwoKICAvKiBpZiB0aGUgZnVuZGluZyBnb2FsIGlzIG5vdCByZWFjaGVkLCBpbnZlc3RvcnMgbWF5IHdpdGhkcmF3IHRoZWlyIGZ1bmRzICovCiAgdWludCBwdWJsaWMgbWluaW11bUZ1bmRpbmdHb2FsOwoKICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgc3RhcnQgZGF0ZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgc3RhcnRzQXQ7CgogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBlbmQgZGF0ZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgZW5kc0F0OwoKICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKCiAgLyogSG93IG1hbnkgd2VpIG9mIGZ1bmRpbmcgd2UgaGF2ZSByYWlzZWQgKi8KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOwoKICAvKiBDYWxjdWxhdGUgaW5jb21pbmcgZnVuZHMgZnJvbSBwcmVzYWxlIGNvbnRyYWN0cyBhbmQgYWRkcmVzc2VzICovCiAgdWludCBwdWJsaWMgcHJlc2FsZVdlaVJhaXNlZCA9IDA7CgogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CgogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIHJldHVybmVkIGJhY2sgdG8gdGhlIGNvbnRyYWN0IGFmdGVyIGEgZmFpbGVkIGNyb3dkZnVuZC4gKi8KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOwoKICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSBnaXZlbiBiYWNrIHRvIGludmVzdG9ycy4qLwogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsKCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOwoKICAvKiBEbyB3ZSBuZWVkIHRvIGhhdmUgdW5pcXVlIGNvbnRyaWJ1dG9yIGlkIGZvciBlYWNoIGN1c3RvbWVyICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQ7CgogIGJvb2wgcHVibGljIGlzV2hpdGVMaXN0ZWQ7CgogIGFkZHJlc3NbXSBwdWJsaWMgam9pbmVkQ3Jvd2RzYWxlczsKICB1aW50IHB1YmxpYyBqb2luZWRDcm93ZHNhbGVzTGVuID0gMDsKCiAgYWRkcmVzcyBwdWJsaWMgbGFzdENyb3dkc2FsZTsKCiAgLyoqCiAgICAqIERvIHdlIHZlcmlmeSB0aGF0IGNvbnRyaWJ1dG9yIGhhcyBiZWVuIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIChhY2NyZWRpdGVkIGludmVzdG9ycyBvbmx5KS4KICAgICogVGhpcyBtZXRob2Qgd2FzIGZpcnN0IHVzZWQgaW4gRmlyc3RCbG9vZCBjcm93ZHNhbGUgdG8gZW5zdXJlIGFsbCBjb250cmlidXRvcnMgaGF2ZSBhY2NlcHRlZCB0ZXJtcyBvbiBzYWxlIChvbiB0aGUgd2ViKS4KICAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzOwoKICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgc3RydWN0IFdoaXRlTGlzdERhdGEgewogICAgYm9vbCBzdGF0dXM7CiAgICB1aW50IG1pbkNhcDsKICAgIHVpbnQgbWF4Q2FwOwogIH0KCiAgLy9pcyBjcm93ZHNhbGUgdXBkYXRhYmxlCiAgYm9vbCBwdWJsaWMgaXNVcGRhdGFibGU7CgogIC8qKiBBZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBpbnZlc3QgZXZlbiBiZWZvcmUgSUNPIG9mZmljYWwgb3BlbnMuIEZvciB0ZXN0aW5nLCBmb3IgSUNPIHBhcnRuZXJzLCBldGMuICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBXaGl0ZUxpc3REYXRhKSBwdWJsaWMgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdDsKCiAgLyoqIExpc3Qgb2Ygd2hpdGVsaXN0ZWQgYWRkcmVzc2VzICovCiAgYWRkcmVzc1tdIHB1YmxpYyB3aGl0ZWxpc3RlZFBhcnRpY2lwYW50czsKCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVsIHRlc3RpbmcgZm9yIHRoZSBpbnRlcmFjdGlvbiBmcm9tIG93bmVyIHdhbGxldC4gWW91IGNhbiBzZXQgaXQgdG8gYW55IHZhbHVlIGFuZCBpbnNwZWN0IHRoaXMgaW4gYmxvY2tjaGFpbiBleHBsb3JlciB0byBzZWUgdGhhdCBjcm93ZHNhbGUgaW50ZXJhY3Rpb24gd29ya3MuICovCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7CgogIC8qKiBTdGF0ZSBtYWNoaW5lCiAgICoKICAgKiAtIFByZXBhcmluZzogQWxsIGNvbnRyYWN0IGluaXRpYWxpemF0aW9uIGNhbGxzIGFuZCB2YXJpYWJsZXMgaGF2ZSBub3QgYmVlbiBzZXQgeWV0CiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCBwYXNzZWQgc3RhcnQgdGltZSB5ZXQKICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUKICAgKiAtIFN1Y2Nlc3M6IE1pbmltdW0gZnVuZGluZyBnb2FsIHJlYWNoZWQKICAgKiAtIEZhaWx1cmU6IE1pbmltdW0gZnVuZGluZyBnb2FsIG5vdCByZWFjaGVkIGJlZm9yZSBlbmRpbmcgdGltZQogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemVkIGhhcyBiZWVuIGNhbGxlZCBhbmQgc3VjY2VzZnVsbHkgZXhlY3V0ZWQKICAgKiAtIFJlZnVuZGluZzogUmVmdW5kcyBhcmUgbG9hZGVkIG9uIHRoZSBjb250cmFjdCBmb3IgcmVjbGFpbS4KICAgKi8KICBlbnVtIFN0YXRle1Vua25vd24sIFByZXBhcmluZywgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmFpbHVyZSwgRmluYWxpemVkLCBSZWZ1bmRpbmd9CgogIC8vIEEgbmV3IGludmVzdG1lbnQgd2FzIG1hZGUKICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsKCiAgLy8gUmVmdW5kIHdhcyBwcm9jZXNzZWQgZm9yIGEgY29udHJpYnV0b3IKICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOwoKICAvLyBUaGUgcnVsZXMgd2VyZSBjaGFuZ2VkIHdoYXQga2luZCBvZiBpbnZlc3RtZW50cyB3ZSBhY2NlcHQKICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIG5ld1JlcXVpcmVDdXN0b21lcklkLCBib29sIG5ld1JlcXVpcmVkU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBuZXdTaWduZXJBZGRyZXNzKTsKCiAgLy8gQWRkcmVzcyBlYXJseSBwYXJ0aWNpcGF0aW9uIHdoaXRlbGlzdCBzdGF0dXMgY2hhbmdlZAogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOwoKICAvLyBDcm93ZHNhbGUgc3RhcnQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgU3RhcnRzQXRDaGFuZ2VkKHVpbnQgbmV3U3RhcnRzQXQpOwoKICAvLyBDcm93ZHNhbGUgZW5kIHRpbWUgaGFzIGJlZW4gY2hhbmdlZAogIGV2ZW50IEVuZHNBdENoYW5nZWQodWludCBuZXdFbmRzQXQpOwoKICBmdW5jdGlvbiBDcm93ZHNhbGVFeHQoc3RyaW5nIF9uYW1lLCBhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwsIGJvb2wgX2lzVXBkYXRhYmxlLCBib29sIF9pc1doaXRlTGlzdGVkKSB7CgogICAgb3duZXIgPSBtc2cuc2VuZGVyOwoKICAgIG5hbWUgPSBfbmFtZTsKCiAgICB0b2tlbiA9IEZyYWN0aW9uYWxFUkMyMEV4dChfdG9rZW4pOwoKICAgIHNldFByaWNpbmdTdHJhdGVneShfcHJpY2luZ1N0cmF0ZWd5KTsKCiAgICBtdWx0aXNpZ1dhbGxldCA9IF9tdWx0aXNpZ1dhbGxldDsKICAgIGlmKG11bHRpc2lnV2FsbGV0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBpZihfc3RhcnQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIHN0YXJ0c0F0ID0gX3N0YXJ0OwoKICAgIGlmKF9lbmQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIGVuZHNBdCA9IF9lbmQ7CgogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMKICAgIGlmKHN0YXJ0c0F0ID49IGVuZHNBdCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIC8vIE1pbmltdW0gZnVuZGluZyBnb2FsIGNhbiBiZSB6ZXJvCiAgICBtaW5pbXVtRnVuZGluZ0dvYWwgPSBfbWluaW11bUZ1bmRpbmdHb2FsOwoKICAgIGlzVXBkYXRhYmxlID0gX2lzVXBkYXRhYmxlOwoKICAgIGlzV2hpdGVMaXN0ZWQgPSBfaXNXaGl0ZUxpc3RlZDsKICB9CgogIC8qKgogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHRocm93OwogIH0KCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IHByaXZhdGUgewoKICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudAogICAgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICAgIC8vIEFyZSB3ZSB3aGl0ZWxpc3RlZCBmb3IgZWFybHkgZGVwb3NpdAogICAgICB0aHJvdzsKICAgIH0gZWxzZSBpZihnZXRTdGF0ZSgpID09IFN0YXRlLkZ1bmRpbmcpIHsKICAgICAgLy8gUmV0YWlsIHBhcnRpY2lwYW50cyBjYW4gb25seSBjb21lIGluIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBydW5uaW5nCiAgICAgIC8vIHBhc3MKICAgICAgaWYoaXNXaGl0ZUxpc3RlZCkgewogICAgICAgIGlmKCFlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2VpdmVyXS5zdGF0dXMpIHsKICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gVW53YW50ZWQgc3RhdGUKICAgICAgdGhyb3c7CiAgICB9CgogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgLy8gQWNjb3VudCBwcmVzYWxlIHNhbGVzIHNlcGFyYXRlbHksIHNvIHRoYXQgdGhleSBkbyBub3QgY291bnQgYWdhaW5zdCBwcmljaW5nIHRyYW5jaGVzCiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkIC0gcHJlc2FsZVdlaVJhaXNlZCwgdG9rZW5zU29sZCwgbXNnLnNlbmRlciwgdG9rZW4uZGVjaW1hbHMoKSk7CgogICAgaWYodG9rZW5BbW91bnQgPT0gMCkgewogICAgICAvLyBEdXN0IHRyYW5zYWN0aW9uCiAgICAgIHRocm93OwogICAgfQoKICAgIGlmKGlzV2hpdGVMaXN0ZWQpIHsKICAgICAgaWYodG9rZW5BbW91bnQgPCBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2VpdmVyXS5taW5DYXAgJiYgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgIC8vIHRva2VuQW1vdW50IDwgbWluQ2FwIGZvciBpbnZlc3RvcgogICAgICAgIHRocm93OwogICAgICB9CiAgICAgIGlmKHRva2VuQW1vdW50ID4gZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0ubWF4Q2FwKSB7CiAgICAgICAgLy8gdG9rZW5BbW91bnQgPiBtYXhDYXAgZm9yIGludmVzdG9yCiAgICAgICAgdGhyb3c7CiAgICAgIH0KCiAgICAgIC8vIENoZWNrIHRoYXQgd2UgZGlkIG5vdCBidXN0IHRoZSBpbnZlc3RvcidzIGNhcAogICAgICBpZiAoaXNCcmVha2luZ0ludmVzdG9yQ2FwKHJlY2VpdmVyLCB0b2tlbkFtb3VudCkpIHsKICAgICAgICB0aHJvdzsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYodG9rZW5BbW91bnQgPCB0b2tlbi5taW5DYXAoKSAmJiB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICAgIH0KICAgIH0KCiAgICBpZihpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9PSAwKSB7CiAgICAgICAvLyBBIG5ldyBpbnZlc3RvcgogICAgICAgaW52ZXN0b3JDb3VudCsrOwogICAgfQoKICAgIC8vIFVwZGF0ZSBpbnZlc3RvcgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOwoKICAgIC8vIFVwZGF0ZSB0b3RhbHMKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKHRva2VuQW1vdW50KTsKCiAgICBpZihwcmljaW5nU3RyYXRlZ3kuaXNQcmVzYWxlUHVyY2hhc2UocmVjZWl2ZXIpKSB7CiAgICAgICAgcHJlc2FsZVdlaVJhaXNlZCA9IHByZXNhbGVXZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgfQoKICAgIC8vIENoZWNrIHRoYXQgd2UgZGlkIG5vdCBidXN0IHRoZSBjYXAKICAgIGlmKGlzQnJlYWtpbmdDYXAod2VpQW1vdW50LCB0b2tlbkFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkKSkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5CiAgICBpZighbXVsdGlzaWdXYWxsZXQuc2VuZCh3ZWlBbW91bnQpKSB0aHJvdzsKCiAgICBpZiAoaXNXaGl0ZUxpc3RlZCkgewogICAgICB1aW50IG51bSA9IDA7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMgPT0gam9pbmVkQ3Jvd2RzYWxlc1tpXSkKICAgICAgICAgIG51bSA9IGk7CiAgICAgIH0KCiAgICAgIGlmIChudW0gKyAxIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbikgewogICAgICAgIGZvciAodmFyIGogPSBudW0gKyAxOyBqIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaisrKSB7CiAgICAgICAgICBDcm93ZHNhbGVFeHQgY3Jvd2RzYWxlID0gQ3Jvd2RzYWxlRXh0KGpvaW5lZENyb3dkc2FsZXNbal0pOwogICAgICAgICAgY3Jvd2RzYWxlLnVwZGF0ZUVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QobXNnLnNlbmRlciwgdGhpcywgdG9rZW5BbW91bnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogSW52ZXN0b3IgY291bnQgaXMgbm90IGhhbmRsZWQ7IGl0IGlzIGFzc3VtZWQgdGhpcyBnb2VzIGZvciBtdWx0aXBsZSBpbnZlc3RvcnMKICAgKiBhbmQgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBoYXBwZW5zIG91dHNpZGUgdGhlIHNtYXJ0IGNvbnRyYWN0IGZsb3cuCiAgICoKICAgKiBObyBtb25leSBpcyBleGNoYW5nZWQsIGFzIHRoZSBjcm93ZHNhbGUgdGVhbSBhbHJlYWR5IGhhdmUgcmVjZWl2ZWQgdGhlIHBheW1lbnQuCiAgICoKICAgKiBAcGFyYW0gZnVsbFRva2VucyB0b2tlbnMgYXMgZnVsbCB0b2tlbnMgLSBkZWNpbWFsIHBsYWNlcyBhZGRlZCBpbnRlcm5hbGx5CiAgICogQHBhcmFtIHdlaVByaWNlIFByaWNlIG9mIGEgc2luZ2xlIGZ1bGwgdG9rZW4gaW4gd2VpCiAgICoKICAgKi8KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgewoKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBmdWxsVG9rZW5zICogMTAqKnRva2VuLmRlY2ltYWxzKCk7CiAgICB1aW50IHdlaUFtb3VudCA9IHdlaVByaWNlICogZnVsbFRva2VuczsgLy8gVGhpcyBjYW4gYmUgYWxzbyAwLCB3ZSBnaXZlIG91dCB0b2tlbnMgZm9yIGZyZWUKCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOwoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgMCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYoYWRkcik7CiAgICAgaWYgKGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKSAhPSBzaWduZXJBZGRyZXNzKSB0aHJvdzsKICAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogVHJhY2sgd2hvIGlzIHRoZSBjdXN0b21lciBtYWtpbmcgdGhlIHBheW1lbnQgc28gd2UgY2FuIHNlbmQgdGhhbmsgeW91IGVtYWlsLgogICAqLwogIGZ1bmN0aW9uIGludmVzdFdpdGhDdXN0b21lcklkKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cwogICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sKICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgYW5vbnltb3VzIGNvbnRyaWJ1dGlvbnMgdG8gdGhpcyBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0KGFkZHJlc3MgYWRkcikgcHVibGljIHBheWFibGUgewogICAgaWYocmVxdWlyZUN1c3RvbWVySWQpIHRocm93OyAvLyBDcm93ZHNhbGUgbmVlZHMgdG8gdHJhY2sgcGFydGljaXBhbnRzIGZvciB0aGFuayB5b3UgZW1haWwKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCAwKTsKICB9CgogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIgYW5kIGNsZWFyIGhpcyBhZGRyZXNzLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MobXNnLnNlbmRlciwgY3VzdG9tZXJJZCwgdiwgciwgcyk7CiAgfQoKICAvKioKICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpbnZlc3RXaXRoQ3VzdG9tZXJJZChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNpYyBlbnRyeSBwb2ludCB0byBwYXJ0aWNpcGF0ZSB0aGUgY3Jvd2RzYWxlIHByb2Nlc3MuCiAgICoKICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0KG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewoKICAgIC8vIEFscmVhZHkgZmluYWxpemVkCiAgICBpZihmaW5hbGl6ZWQpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuCiAgICBpZihhZGRyZXNzKGZpbmFsaXplQWdlbnQpICE9IDApIHsKICAgICAgZmluYWxpemVBZ2VudC5maW5hbGl6ZUNyb3dkc2FsZSgpOwogICAgfQoKICAgIGZpbmFsaXplZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50LgogICAqCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHNldHRpbmcgdGhpcywgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0RmluYWxpemVBZ2VudChGaW5hbGl6ZUFnZW50IGFkZHIpIG9ubHlPd25lciB7CiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIG9ubHlPd25lciB7CiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGlmIGFsbCBpbnZlc3RvcnMgbXVzdCBiZSBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSBmaXJzdC4KICAgKgogICAqIFRoaXMgaXMgZS5nLiBmb3IgdGhlIGFjY3JlZGl0ZWQgaW52ZXN0b3IgY2xlYXJpbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlU2lnbmVkQWRkcmVzcyhib29sIHZhbHVlLCBhZGRyZXNzIF9zaWduZXJBZGRyZXNzKSBvbmx5T3duZXIgewogICAgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gdmFsdWU7CiAgICBzaWduZXJBZGRyZXNzID0gX3NpZ25lckFkZHJlc3M7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLgogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cywgdWludCBtaW5DYXAsIHVpbnQgbWF4Q2FwKSBvbmx5T3duZXIgewogICAgaWYgKCFpc1doaXRlTGlzdGVkKSB0aHJvdzsKICAgIGFzc2VydChhZGRyICE9IGFkZHJlc3MoMCkpOwogICAgYXNzZXJ0KG1heENhcCA+IDApOwogICAgYXNzZXJ0KG1pbkNhcCA8PSBtYXhDYXApOwoKICAgIGlmIChlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdLm1heENhcCA9PSAwKSB7CiAgICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBXaGl0ZUxpc3REYXRhKHtzdGF0dXM6c3RhdHVzLCBtaW5DYXA6bWluQ2FwLCBtYXhDYXA6bWF4Q2FwfSk7CiAgICAgIHdoaXRlbGlzdGVkUGFydGljaXBhbnRzLnB1c2goYWRkcik7CiAgICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzZXRFYXJseVBhcnRpY2lwYW50c1doaXRlbGlzdChhZGRyZXNzW10gYWRkcnMsIGJvb2xbXSBzdGF0dXNlcywgdWludFtdIG1pbkNhcHMsIHVpbnRbXSBtYXhDYXBzKSBvbmx5T3duZXIgewogICAgaWYgKCFpc1doaXRlTGlzdGVkKSB0aHJvdzsKICAgIGZvciAodWludCBpdGVyYXRvciA9IDA7IGl0ZXJhdG9yIDwgYWRkcnMubGVuZ3RoOyBpdGVyYXRvcisrKSB7CiAgICAgIHNldEVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QoYWRkcnNbaXRlcmF0b3JdLCBzdGF0dXNlc1tpdGVyYXRvcl0sIG1pbkNhcHNbaXRlcmF0b3JdLCBtYXhDYXBzW2l0ZXJhdG9yXSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYWRkcmVzcyBjb250cmFjdEFkZHIsIHVpbnQgdG9rZW5zQm91Z2h0KSB7CiAgICBpZiAodG9rZW5zQm91Z2h0IDwgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXS5taW5DYXApIHRocm93OwogICAgaWYgKCFpc1doaXRlTGlzdGVkKSB0aHJvdzsKICAgIGlmIChhZGRyICE9IG1zZy5zZW5kZXIgJiYgY29udHJhY3RBZGRyICE9IG1zZy5zZW5kZXIpIHRocm93OwogICAgdWludCBuZXdNYXhDYXAgPSBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdLm1heENhcDsKICAgIG5ld01heENhcCA9IG5ld01heENhcC5taW51cyh0b2tlbnNCb3VnaHQpOwogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IFdoaXRlTGlzdERhdGEoe3N0YXR1czplYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdLnN0YXR1cywgbWluQ2FwOjAsIG1heENhcDpuZXdNYXhDYXB9KTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUpvaW5lZENyb3dkc2FsZXMoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgewogICAgam9pbmVkQ3Jvd2RzYWxlc1tqb2luZWRDcm93ZHNhbGVzTGVuKytdID0gYWRkcjsKICB9CgogIGZ1bmN0aW9uIHNldExhc3RDcm93ZHNhbGUoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgewogICAgbGFzdENyb3dkc2FsZSA9IGFkZHI7CiAgfQoKICBmdW5jdGlvbiBjbGVhckpvaW5lZENyb3dkc2FsZXMoKSBvbmx5T3duZXIgewogICAgam9pbmVkQ3Jvd2RzYWxlc0xlbiA9IDA7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVKb2luZWRDcm93ZHNhbGVzTXVsdGlwbGUoYWRkcmVzc1tdIGFkZHJzKSBvbmx5T3duZXIgewogICAgY2xlYXJKb2luZWRDcm93ZHNhbGVzKCk7CiAgICBmb3IgKHVpbnQgaXRlciA9IDA7IGl0ZXIgPCBhZGRycy5sZW5ndGg7IGl0ZXIrKykgewogICAgICBpZihqb2luZWRDcm93ZHNhbGVzTGVuID09IGpvaW5lZENyb3dkc2FsZXMubGVuZ3RoKSB7CiAgICAgICAgICBqb2luZWRDcm93ZHNhbGVzLmxlbmd0aCArPSAxOwogICAgICB9CiAgICAgIGpvaW5lZENyb3dkc2FsZXNbam9pbmVkQ3Jvd2RzYWxlc0xlbisrXSA9IGFkZHJzW2l0ZXJdOwogICAgICBpZiAoaXRlciA9PSBhZGRycy5sZW5ndGggLSAxKQogICAgICAgIHNldExhc3RDcm93ZHNhbGUoYWRkcnNbaXRlcl0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0U3RhcnRzQXQodWludCB0aW1lKSBvbmx5T3duZXIgewogICAgaWYgKGZpbmFsaXplZCkgdGhyb3c7CgogICAgaWYgKCFpc1VwZGF0YWJsZSkgdGhyb3c7CgogICAgaWYobm93ID4gdGltZSkgewogICAgICB0aHJvdzsgLy8gRG9uJ3QgY2hhbmdlIHBhc3QKICAgIH0KCiAgICBpZih0aW1lID4gZW5kc0F0KSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIENyb3dkc2FsZUV4dCBsYXN0Q3Jvd2RzYWxlQ250cmN0ID0gQ3Jvd2RzYWxlRXh0KGxhc3RDcm93ZHNhbGUpOwogICAgaWYgKGxhc3RDcm93ZHNhbGVDbnRyY3QuZmluYWxpemVkKCkpIHRocm93OwoKICAgIHN0YXJ0c0F0ID0gdGltZTsKICAgIFN0YXJ0c0F0Q2hhbmdlZChzdGFydHNBdCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBjcm93ZHNhbGUgb3duZXIgdG8gY2xvc2UgZWFybHkgb3IgZXh0ZW5kIHRoZSBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGlzIGlzIHVzZWZ1bCBlLmcuIGZvciBhIG1hbnVhbCBzb2Z0IGNhcCBpbXBsZW1lbnRhdGlvbjoKICAgKiAtIGFmdGVyIFggYW1vdW50IGlzIHJlYWNoZWQgZGV0ZXJtaW5lIG1hbnVhbCBjbG9zaW5nCiAgICoKICAgKiBUaGlzIG1heSBwdXQgdGhlIGNyb3dkc2FsZSB0byBhbiBpbnZhbGlkIHN0YXRlLAogICAqIGJ1dCB3ZSB0cnVzdCBvd25lcnMga25vdyB3aGF0IHRoZXkgYXJlIGRvaW5nLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0RW5kc0F0KHVpbnQgdGltZSkgb25seU93bmVyIHsKICAgIGlmIChmaW5hbGl6ZWQpIHRocm93OwoKICAgIGlmICghaXNVcGRhdGFibGUpIHRocm93OwoKICAgIGlmKG5vdyA+IHRpbWUpIHsKICAgICAgdGhyb3c7IC8vIERvbid0IGNoYW5nZSBwYXN0CiAgICB9CgogICAgaWYoc3RhcnRzQXQgPiB0aW1lKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIENyb3dkc2FsZUV4dCBsYXN0Q3Jvd2RzYWxlQ250cmN0ID0gQ3Jvd2RzYWxlRXh0KGxhc3RDcm93ZHNhbGUpOwogICAgaWYgKGxhc3RDcm93ZHNhbGVDbnRyY3QuZmluYWxpemVkKCkpIHRocm93OwoKICAgIHVpbnQgbnVtID0gMDsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaSsrKSB7CiAgICAgIGlmICh0aGlzID09IGpvaW5lZENyb3dkc2FsZXNbaV0pCiAgICAgICAgbnVtID0gaTsKICAgIH0KCiAgICBpZiAobnVtICsgMSA8IGpvaW5lZENyb3dkc2FsZXNMZW4pIHsKICAgICAgZm9yICh2YXIgaiA9IG51bSArIDE7IGogPCBqb2luZWRDcm93ZHNhbGVzTGVuOyBqKyspIHsKICAgICAgICBDcm93ZHNhbGVFeHQgY3Jvd2RzYWxlID0gQ3Jvd2RzYWxlRXh0KGpvaW5lZENyb3dkc2FsZXNbal0pOwogICAgICAgIGlmICh0aW1lID4gY3Jvd2RzYWxlLnN0YXJ0c0F0KCkpIHRocm93OwogICAgICB9CiAgICB9CgogICAgZW5kc0F0ID0gdGltZTsKICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsKICB9CgogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgcHJpY2luZyBzdHJhdGVneS4KICAgKgogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRQcmljaW5nU3RyYXRlZ3koUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3kpIG9ubHlPd25lciB7CiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5OwoKICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50CiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byBjaGFuZ2UgdGhlIHRlYW0gbXVsdGlzaWcgYWRkcmVzcyBpbiB0aGUgY2FzZSBvZiBlbWVyZ2VuY3kuCiAgICoKICAgKiBUaGlzIGFsbG93cyB0byBzYXZlIGEgZGVwbG95ZWQgY3Jvd2RzYWxlIHdhbGxldCBpbiB0aGUgY2FzZSB0aGUgY3Jvd2RzYWxlIGhhcyBub3QgeWV0IGJlZ3VuCiAgICogKHdlIGhhdmUgZG9uZSBvbmx5IGZldyB0ZXN0IHRyYW5zYWN0aW9ucykuIEFmdGVyIHRoZSBjcm93ZHNhbGUgaXMgZ29pbmcKICAgKiB0aGVuIG11bHRpc2lnIGFkZHJlc3Mgc3RheXMgbG9ja2VkIGZvciB0aGUgc2FmZXR5IHJlYXNvbnMuCiAgICovCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsKCiAgICAvLyBDaGFuZ2UKICAgIGlmKGludmVzdG9yQ291bnQgPiBNQVhfSU5WRVNUTUVOVFNfQkVGT1JFX01VTFRJU0lHX0NIQU5HRSkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBBbGxvdyBsb2FkIHJlZnVuZHMgYmFjayBvbiB0aGUgY29udHJhY3QgZm9yIHRoZSByZWZ1bmRpbmcuCiAgICoKICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoZSBtaW5pbXVtIGdvYWwgd2FzIG5vdCByZWFjaGVkLi4KICAgKi8KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7CiAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7CiAgICBsb2FkZWRSZWZ1bmQgPSBsb2FkZWRSZWZ1bmQucGx1cyhtc2cudmFsdWUpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmQuCiAgICoKICAgKiBOb3RlIHRoYXQgYW55IHJlZnVuZHMgZnJvbSBwcm94eSBidXllcnMgc2hvdWxkIGJlIGhhbmRsZWQgc2VwYXJhdGVseSwKICAgKiBhbmQgbm90IHRocm91Z2ggdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5SZWZ1bmRpbmcpIHsKICAgIHVpbnQyNTYgd2VpVmFsdWUgPSBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdOwogICAgaWYgKHdlaVZhbHVlID09IDApIHRocm93OwogICAgaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXSA9IDA7CiAgICB3ZWlSZWZ1bmRlZCA9IHdlaVJlZnVuZGVkLnBsdXMod2VpVmFsdWUpOwogICAgUmVmdW5kKG1zZy5zZW5kZXIsIHdlaVZhbHVlKTsKICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHdlaVZhbHVlKSkgdGhyb3c7CiAgfQoKICAvKioKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4KICAgKi8KICBmdW5jdGlvbiBpc0ZpbmFsaXplclNhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzYW5lKSB7CiAgICByZXR1cm4gZmluYWxpemVBZ2VudC5pc1NhbmUoKTsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4KICAgKi8KICBmdW5jdGlvbiBpc1ByaWNpbmdTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgewogICAgcmV0dXJuIHByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSk7CiAgfQoKICAvKioKICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50LgogICAqCiAgICogV2UgbWFrZSBpdCBhIGZ1bmN0aW9uIGFuZCBkbyBub3QgYXNzaWduIHRoZSByZXN1bHQgdG8gYSB2YXJpYWJsZSwgc28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgewogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOwogICAgZWxzZSBpZiAoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSA9PSAwKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIWZpbmFsaXplQWdlbnQuaXNTYW5lKCkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmICghcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOwogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICB9CgogIC8qKiBUaGlzIGlzIGZvciBtYW51YWwgdGVzdGluZyBvZiBtdWx0aXNpZyB3YWxsZXQgaW50ZXJhY3Rpb24gKi8KICBmdW5jdGlvbiBzZXRPd25lclRlc3RWYWx1ZSh1aW50IHZhbCkgb25seU93bmVyIHsKICAgIG93bmVyVGVzdFZhbHVlID0gdmFsOwogIH0KCiAgLyoqIEludGVyZmFjZSBtYXJrZXIuICovCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLwogIC8vIE1vZGlmaWVycwogIC8vCgogIC8qKiBNb2RpZmllZCBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8KICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7CiAgICBpZihnZXRTdGF0ZSgpICE9IHN0YXRlKSB0aHJvdzsKICAgIF87CiAgfQoKCiAgLy8KICAvLyBBYnN0cmFjdCBmdW5jdGlvbnMKICAvLwoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBpbnZlc3RlZCBicmVha3Mgb3VyIGNhcCBydWxlcy4KICAgKgogICAqCiAgICogVGhlIGNoaWxkIGNvbnRyYWN0IG11c3QgZGVmaW5lIHRoZWlyIG93biBjYXAgc2V0dGluZyBydWxlcy4KICAgKiBXZSBhbGxvdyBhIGxvdCBvZiBmbGV4aWJpbGl0eSB0aHJvdWdoIGRpZmZlcmVudCBjYXBwaW5nIHN0cmF0ZWdpZXMgKEVUSCwgdG9rZW4gY291bnQpCiAgICogQ2FsbGVkIGZyb20gaW52ZXN0KCkuCiAgICoKICAgKiBAcGFyYW0gd2VpQW1vdW50IFRoZSBhbW91bnQgb2Ygd2VpIHRoZSBpbnZlc3RvciB0cmllcyB0byBpbnZlc3QgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gdG9rZW5BbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgd2UgdHJ5IHRvIGdpdmUgdG8gdGhlIGludmVzdG9yIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHdlaVJhaXNlZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHJhaXNlZCBiYWxhbmNlIGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gdG9rZW5zU29sZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHNvbGQgdG9rZW5zIGNvdW50IGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24KICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0YWtpbmcgdGhpcyBpbnZlc3RtZW50IHdvdWxkIGJyZWFrIG91ciBjYXAgcnVsZXMKICAgKi8KICBmdW5jdGlvbiBpc0JyZWFraW5nQ2FwKHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaVJhaXNlZFRvdGFsLCB1aW50IHRva2Vuc1NvbGRUb3RhbCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7CgogIGZ1bmN0aW9uIGlzQnJlYWtpbmdJbnZlc3RvckNhcChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgb3IgdHJhbnNmZXIgaXNzdWVkIHRva2VucyB0byB0aGUgaW52ZXN0b3IgZGVwZW5kaW5nIG9uIHRoZSBjYXAgbW9kZWwuCiAgICovCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIHByaXZhdGU7CgogIGZ1bmN0aW9uIHdoaXRlbGlzdGVkUGFydGljaXBhbnRzTGVuZ3RoKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB3aGl0ZWxpc3RlZFBhcnRpY2lwYW50cy5sZW5ndGg7CiAgfQp9CgoKLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwoKCgovKioKICogSW50ZXJmYWNlIGZvciBkZWZpbmluZyBjcm93ZHNhbGUgcHJpY2luZy4KICovCmNvbnRyYWN0IFByaWNpbmdTdHJhdGVneSB7CgogIC8qKiBJbnRlcmZhY2UgZGVjbGFyYXRpb24uICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU3RyYXRlZ3koKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKiogU2VsZiBjaGVjayBpZiBhbGwgcmVmZXJlbmNlcyBhcmUgY29ycmVjdGx5IHNldC4KICAgKgogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4KICAgKi8KICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBjcm93ZHNhbGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJpY2luZyB0ZWxscyBpZiB0aGlzIGlzIGEgcHJlc2FsZSBwdXJjaGFzZSBvciBub3QuCiAgICAgQHBhcmFtIHB1cmNoYXNlciBBZGRyZXNzIG9mIHRoZSBwdXJjaGFzZXIKICAgICBAcmV0dXJuIEZhbHNlIGJ5IGRlZmF1bHQsIHRydWUgaWYgYSBwcmVzYWxlIHB1cmNoYXNlcgogICAqLwogIGZ1bmN0aW9uIGlzUHJlc2FsZVB1cmNoYXNlKGFkZHJlc3MgcHVyY2hhc2VyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4KICAgKgogICAqCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXIKICAgKiBAcGFyYW0gd2VpUmFpc2VkIC0gaG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHRoaXMgZmFyIGluIHRoZSBtYWluIHRva2VuIHNhbGUgLSB0aGlzIG51bWJlciBleGNsdWRlcyBwcmVzYWxlCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcwogICAqIEByZXR1cm4gQW1vdW50IG9mIHRva2VucyB0aGUgaW52ZXN0b3IgcmVjZWl2ZXMKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOwp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCgoKCi8qKgogKiBTYWZlIHVuc2lnbmVkIHNhZmUgbWF0aC4KICoKICogaHR0cHM6Ly9ibG9nLmFyYWdvbi5vbmUvbGlicmFyeS1kcml2ZW4tZGV2ZWxvcG1lbnQtaW4tc29saWRpdHktMmJlYmNhZjg4NzM2Iy43NTBnd3R3bGkKICoKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9BcmFnb25PbmUvemVwcGVsaW4tc29saWRpdHkvbWFzdGVyL2NvbnRyYWN0cy9TYWZlTWF0aExpYi5zb2wKICoKICogTWFpbnRhaW5lZCBoZXJlIHVudGlsIG1lcmdlZCB0byBtYWlubGluZSB6ZXBwZWxpbi1zb2xpZGl0eS4KICoKICovCmxpYnJhcnkgU2FmZU1hdGhMaWJFeHQgewoKICBmdW5jdGlvbiB0aW1lcyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXZpZGVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA+IDApOwogICAgdWludCBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWludXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gcGx1cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYz49YSk7CiAgICByZXR1cm4gYzsKICB9Cgp9CgoKLyoqCiAqIEZpeGVkIGNyb3dkc2FsZSBwcmljaW5nIC0gZXZlcnlib2R5IGdldHMgdGhlIHNhbWUgcHJpY2UuCiAqLwpjb250cmFjdCBGbGF0UHJpY2luZ0V4dCBpcyBQcmljaW5nU3RyYXRlZ3ksIE93bmFibGUgewoKICB1c2luZyBTYWZlTWF0aExpYkV4dCBmb3IgdWludDsKCiAgLyogSG93IG1hbnkgd2VpcyBvbmUgdG9rZW4gY29zdHMgKi8KICB1aW50IHB1YmxpYyBvbmVUb2tlbkluV2VpOwoKICBib29sIHB1YmxpYyBpc1VwZGF0YWJsZTsKCiAgYWRkcmVzcyBwdWJsaWMgbGFzdENyb3dkc2FsZTsKCiAgLy8gQ3Jvd2RzYWxlIHJhdGUgaGFzIGJlZW4gY2hhbmdlZAogIGV2ZW50IFJhdGVDaGFuZ2VkKHVpbnQgbmV3T25lVG9rZW5JbldlaSk7CgogIGZ1bmN0aW9uIEZsYXRQcmljaW5nRXh0KHVpbnQgX29uZVRva2VuSW5XZWksIGJvb2wgX2lzVXBkYXRhYmxlKSBvbmx5T3duZXIgewogICAgcmVxdWlyZShfb25lVG9rZW5JbldlaSA+IDApOwogICAgb25lVG9rZW5JbldlaSA9IF9vbmVUb2tlbkluV2VpOwoKICAgIGlzVXBkYXRhYmxlID0gX2lzVXBkYXRhYmxlOwogIH0KCiAgZnVuY3Rpb24gc2V0TGFzdENyb3dkc2FsZShhZGRyZXNzIGFkZHIpIG9ubHlPd25lciB7CiAgICBsYXN0Q3Jvd2RzYWxlID0gYWRkcjsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZVJhdGUodWludCBuZXdPbmVUb2tlbkluV2VpKSBvbmx5T3duZXIgewogICAgaWYgKCFpc1VwZGF0YWJsZSkgdGhyb3c7CgogICAgQ3Jvd2RzYWxlRXh0IGxhc3RDcm93ZHNhbGVDbnRyY3QgPSBDcm93ZHNhbGVFeHQobGFzdENyb3dkc2FsZSk7CiAgICBpZiAobGFzdENyb3dkc2FsZUNudHJjdC5maW5hbGl6ZWQoKSkgdGhyb3c7CgogICAgb25lVG9rZW5JbldlaSA9IG5ld09uZVRva2VuSW5XZWk7CiAgICBSYXRlQ2hhbmdlZChuZXdPbmVUb2tlbkluV2VpKTsKICB9CgogIC8qKgogICAqIENhbGN1bGF0ZSB0aGUgY3VycmVudCBwcmljZSBmb3IgYnV5IGluIGFtb3VudC4KICAgKgogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKHVpbnQgdmFsdWUsIHVpbnQgd2VpUmFpc2VkLCB1aW50IHRva2Vuc1NvbGQsIGFkZHJlc3MgbXNnU2VuZGVyLCB1aW50IGRlY2ltYWxzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgdWludCBtdWx0aXBsaWVyID0gMTAgKiogZGVjaW1hbHM7CiAgICByZXR1cm4gdmFsdWUudGltZXMobXVsdGlwbGllcikgLyBvbmVUb2tlbkluV2VpOwogIH0KCn0='.
	

]
