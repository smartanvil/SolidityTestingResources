Class {
	#name : #SRT76a09dc62b5543c359bffb9921e3150aaf3aa566,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT76a09dc62b5543c359bffb9921e3150aaf3aa566 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KICB9Cgp9CgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBEaWV0ZXIgU2hpcmxleSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlODhjOGQ5YzhkYTg4OTkwODE4Nzg1OTI4ZDg2YzY4Yjg3Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4gKGh0dHBzOi8vZ2l0aHViLmNvbS9kZXRlKQpjb250cmFjdCBFUkM3MjEgewogICAgLy8gUmVxdWlyZWQgbWV0aG9kcwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgYXBwcm92ZWQsIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLy8gT3B0aW9uYWwKICAgIC8vIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgbmFtZSk7CiAgICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgc3ltYm9sKTsKICAgIC8vIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIHRva2VuSWRzKTsKICAgIC8vIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nIF9wcmVmZXJyZWRUcmFuc3BvcnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKTsKCiAgICAvLyBFUkMtMTY1IENvbXBhdGliaWxpdHkgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwp9CgoKCgoKCgoKCgoKY29udHJhY3QgTW9uc3RlckFjY2Vzc0NvbnRyb2wgewoKICAgIGV2ZW50IENvbnRyYWN0VXBncmFkZShhZGRyZXNzIG5ld0NvbnRyYWN0KTsKCiAgICAgLy8gVGhlIGFkZHJlc3NlcyBvZiB0aGUgYWNjb3VudHMgKG9yIGNvbnRyYWN0cykgdGhhdCBjYW4gZXhlY3V0ZSBhY3Rpb25zIHdpdGhpbiBlYWNoIHJvbGVzLgogICAgYWRkcmVzcyBwdWJsaWMgYWRtaW5BZGRyZXNzOwogICAgCgogIAoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0VPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUFkbWluKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZG1pbkFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogIAoKICAgIAp9CgovLyBUaGlzIGNvbnRyYWN0IHN0b3JlcyBhbGwgZGF0YSBvbiB0aGUgYmxvY2tjaGFpbgovLyBvbmx5IG91ciBvdGhlciBjb250cmFjdHMgY2FuIGludGVyYWN0IHdpdGggdGhpcwovLyB0aGUgZGF0YSBoZXJlIHdpbGwgYmUgdmFsaWQgZm9yIGFsbCBldGVybml0eSBldmVuIGlmIG90aGVyIGNvbnRyYWN0cyBnZXQgdXBkYXRlZAovLyB0aGlzIHdheSB3ZSBjYW4gbWFrZSBzdXJlIHRoYXQgb3VyIE1vbnN0ZXJzIGhhdmUgYSBoYXJkLWNvZGVkIHZhbHVlIGF0dGFjaGVkIHRvIHRoZW0KLy8gdGhhdCBubyBvbmUgaW5jbHVkaW5nIHVzIGNhbiBjaGFuZ2UoISkKY29udHJhY3QgTW9uc3RlcnNEYXRhIHsKCiAgICBhZGRyZXNzIGNvcmVDb250cmFjdDsgLy8gCiAgICAKCgogICAgc3RydWN0IE1vbnN0ZXIgewogICAgICAgIC8vIHRpbWVzdGFtcCBvZiBibG9jayB3aGVuIHRoaXMgbW9uc3RlciB3YXMgc3Bhd25lZC9jcmVhdGVkCiAgICAgICAgdWludDY0IGJpcnRoVGltZTsKCiAgICAgICAgLy8gZ2VuZXJhdGlvbiBudW1iZXIKICAgICAgICAvLyBnZW4wIGlzIHRoZSB2ZXJ5IGZpcnN0IGdlbmVyYXRpb24gLSB0aGUgbGF0ZXIgbW9uc3RlciBzcGF3biB0aGUgbGVzcyBsaWtlbHkgdGhleSBhcmUgdG8gaGF2ZQogICAgICAgIC8vIHNwZWNpYWwgYXR0cmlidXRlcyBhbmQgc3RhdHMKICAgICAgIC8vIHVpbnQxNiBnZW5lcmF0aW9uOwoKICAgICAgICB1aW50MTYgaHA7IC8vIGhlYWx0aCBwb2ludHMgCiAgICAgICAgdWludDE2IGF0dGFjazsgLy8gYXR0YWNrIHBvaW50cwogICAgICAgIHVpbnQxNiBkZWZlbnNlOyAvLyBkZWZlbnNlIHBvaW50cwogICAgICAgIHVpbnQxNiBzcEF0dGFjazsgLy8gc3BlY2lhbCBhdHRhY2sKICAgICAgICB1aW50MTYgc3BEZWZlbnNlOyAvLyBzcGVjaWFsIGRlZmVuc2UKICAgICAgICB1aW50MTYgc3BlZWQ7IC8vIHNwZWVkIHJlc3BvbnNpYmxlIG9mIHdobyBhdHRhY2tzIGZpcnN0KCEpCiAgICAgICAgCgogICAgICAgIHVpbnQxNiB0eXBlT25lOwogICAgICAgIHVpbnQxNiB0eXBlVHdvOwoKICAgICAgICB1aW50MTYgbUlEOyAvLyB0aGlzIGlkIChmcm9tIDEgdG8gMTUxKSBpcyByZXNwb25zaWJsZSBmb3IgZXZlcnl0aGluZyB2aXN1YWxseSBsaWtlIHNob3dpbmcgdGhlIHJlYWwgZGVhbCEKICAgICAgICBib29sIHRyYWRlYWJsZTsKICAgICAgICAvL3VpbnQxNiB1SUQ7IC8vIHVuaXF1ZSBpZAogICAgICAgIAogICAgICAgIC8vIFRoZXNlIGF0dHJpYnV0ZXMgYXJlIGhhbmRsZWQgYnkgbWFwcGluZ3Mgc2luY2UgdGhleSB3b3VsZCBvdmVyZmxvdyB0aGUgbWF4aW11bSBzdGFjawogICAgICAgIC8vYm9vbCBmZW1hbGUKICAgICAgICAvLyBzdHJpbmcgbmlja25hbWUKICAgICAgICAKCiAgICB9CgogICAgLy8gbHYxIGJhc2Ugc3RhdHMKICAgIHN0cnVjdCBNb25zdGVyQmFzZVN0YXRzIHsKICAgICAgICB1aW50MTYgaHA7CiAgICAgICAgdWludDE2IGF0dGFjazsKICAgICAgICB1aW50MTYgZGVmZW5zZTsKICAgICAgICB1aW50MTYgc3BBdHRhY2s7CiAgICAgICAgdWludDE2IHNwRGVmZW5zZTsKICAgICAgICB1aW50MTYgc3BlZWQ7CiAgICAgICAgCiAgICB9CgogICAgLy8gbG9tb25zdGVyaW9uIHN0cnVjdCB1c2VkIGZvciB0cmF2ZWxsaW5nIGFyb3VuZCB0aGUgIndvcmxkIgogICAgLy8gCiAgICBzdHJ1Y3QgQXJlYSB7CiAgICAgICAgLy8gYXJlYUlEIHVzZWQgaW4tZW5naW5lIHRvIGRldGVybWluZSB3b3JsZCBwb3NpdGlvbgogICAgICAgCiAgICAgICAgICAgICAKICAgICAgICAvLyBtaW5pbXVtIGxldmVsIHRvIGVudGVyIHRoaXMgYXJlYS4uLgogICAgICAgIHVpbnQxNiBtaW5MZXZlbDsKICAgIH0KCiAgICBzdHJ1Y3QgVHJhaW5lciB7CiAgICAgICAgLy8gdGltZXN0YW1wIG9mIGJsb2NrIHdoZW4gdGhpcyBwbGF5ZXIvdHJhaW5lciB3YXMgY3JlYXRlZAogICAgICAgIHVpbnQ2NCBiaXJ0aFRpbWU7CiAgICAgICAgCiAgICAgICAgLy8gYWRkIHVzZXJuYW1lCiAgICAgICAgc3RyaW5nIHVzZXJuYW1lOwogICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gY3VycmVudCBhcmVhIGluIHRoZSAid29ybGQiCiAgICAgICAgdWludDE2IGN1cnJBcmVhOwogICAgICAgIAogICAgICAgIGFkZHJlc3Mgb3duZXI7CiAgICAgICAgCiAgICAgICAKICAgICAgICAKICAgIH0KCgogICAKCgogICAgLy8gdGFrZSB0aW1lc3RhbXAgb2YgYmxvY2sgdGhpcyBnYW1lIHdhcyBjcmVhdGVkIG9uIHRoZSBibG9ja2NoYWluCiAgICB1aW50NjQgY3JlYXRpb25CbG9jayA9IHVpbnQ2NChub3cpOwogICAKICAgCgogICAKICAKICAgIAoKCiAgICAKICAKICAgICAgICAKCgp9CgoKCgpjb250cmFjdCBNb25zdGVyc0Jhc2UgaXMgTW9uc3RlckFjY2Vzc0NvbnRyb2wsIE1vbnN0ZXJzRGF0YSB7CgogICAgLy8vIEBkZXYgVHJhbnNmZXIgZXZlbnQgYXMgZGVmaW5lZCBpbiBjdXJyZW50IGRyYWZ0IG9mIEVSQzcyMS4gRW1pdHRlZCBldmVyeSB0aW1lIGEgbW9uc3RlcgogICAgLy8vICBvd25lcnNoaXAgaXMgYXNzaWduZWQsIGluY2x1ZGluZyBiaXJ0aHMuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgYm9vbCBsb2NrZWRNb25zdGVyQ3JlYXRvciA9IGZhbHNlOwoKICAgIE1vbnN0ZXJBdWN0aW9uIHB1YmxpYyBtb25zdGVyQXVjdGlvbjsKCiAgICBNb25zdGVyQ3JlYXRvckludGVyZmFjZSBwdWJsaWMgbW9uc3RlckNyZWF0b3I7CgoKICAgIGZ1bmN0aW9uIHNldE1vbnN0ZXJDcmVhdG9yQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIC8vIG9ubHkgc2V0IHRoaXMgb25jZSBzbyB3ZSAodGhlIGRldnMpIGNhbid0IGNoZWF0IQogICAgICAgIHJlcXVpcmUoIWxvY2tlZE1vbnN0ZXJDcmVhdG9yKTsKICAgICAgICBNb25zdGVyQ3JlYXRvckludGVyZmFjZSBjYW5kaWRhdGVDb250cmFjdCA9IE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlKF9hZGRyZXNzKTsKCiAgICAgICAKCiAgICAgICAgbW9uc3RlckNyZWF0b3IgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgICAgICBsb2NrZWRNb25zdGVyQ3JlYXRvciA9IHRydWU7CgogICAgfQogICAgCiAgICAvLyBBbiBhcHByb3hpbWF0aW9uIG9mIGN1cnJlbnRseSBob3cgbWFueSBzZWNvbmRzIGFyZSBpbiBiZXR3ZWVuIGJsb2Nrcy4KICAgIHVpbnQyNTYgcHVibGljIHNlY29uZHNQZXJCbG9jayA9IDE1OwogIAoKICAgIC8vIGFycmF5IGNvbnRhaW5pbmcgYWxsIG1vbnN0ZXJzIGluIGV4aXN0ZW5jZQogICAgTW9uc3RlcltdIG1vbnN0ZXJzOwoKICAgIHVpbnQ4W10gYXJlYXM7CgogICAgdWludDggYXJlYUluZGV4ID0gMDsKICAgIAoKCiAgICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBUcmFpbmVyKSBwdWJsaWMgYWRkcmVzc1RvVHJhaW5lcjsKICAgIAoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIG1vbnN0ZXIgSURzIHRvIHRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGVtLiBBbGwgbW9uc3RlciBoYXZlCiAgICAvLy8gIHNvbWUgdmFsaWQgb3duZXIgYWRkcmVzcywgZXZlbiBnZW4wIG1vbnN0ZXIgYXJlIGNyZWF0ZWQgd2l0aCBhIG5vbi16ZXJvIG93bmVyLgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgbW9uc3RlckluZGV4VG9Pd25lcjsKCiAgICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIG93bmVyIGFkZHJlc3MgdG8gY291bnQgb2YgdG9rZW5zIHRoYXQgYWRkcmVzcyBvd25zLgogICAgLy8gIFVzZWQgaW50ZXJuYWxseSBpbnNpZGUgYmFsYW5jZU9mKCkgdG8gcmVzb2x2ZSBvd25lcnNoaXAgY291bnQuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVyc2hpcFRva2VuQ291bnQ7CgoKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIG1vbnN0ZXJJbmRleFRvQXBwcm92ZWQ7CiAgICAKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gc3RyaW5nKSBwdWJsaWMgbW9uc3RlcklkVG9OaWNrbmFtZTsKICAgIAogICAgbWFwcGluZyAodWludDI1NiA9PiBib29sKSBwdWJsaWMgbW9uc3RlcklkVG9UcmFkZWFibGU7CiAgICAKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIG1vbnN0ZXJJZFRvR2VuZXJhdGlvbjsKCgogICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gTW9uc3RlckJhc2VTdGF0cykgcHVibGljIGJhc2VTdGF0czsKCiAgICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50OFs3XSkgcHVibGljIG1vbnN0ZXJJZFRvSVZzOwogICAgCgoKICAgIC8vIGFkZHMgbmV3IGFyZWEgdG8gd29ybGQgCiAgICBmdW5jdGlvbiBfY3JlYXRlQXJlYSgpIGludGVybmFsIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFyZWFJbmRleCsrOwogICAgICAgICAgICBhcmVhcy5wdXNoKGFyZWFJbmRleCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICB9CgogICAgCgoKICAgIGZ1bmN0aW9uIF9jcmVhdGVNb25zdGVyKAogICAgICAgIHVpbnQyNTYgX2dlbmVyYXRpb24sCiAgICAgICAgdWludDI1NiBfaHAsCiAgICAgICAgdWludDI1NiBfYXR0YWNrLAogICAgICAgIHVpbnQyNTYgX2RlZmVuc2UsCiAgICAgICAgdWludDI1NiBfc3BBdHRhY2ssCiAgICAgICAgdWludDI1NiBfc3BEZWZlbnNlLAogICAgICAgIHVpbnQyNTYgX3NwZWVkLAogICAgICAgIHVpbnQyNTYgX3R5cGVPbmUsCiAgICAgICAgdWludDI1NiBfdHlwZVR3bywKICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICB1aW50MjU2IF9tSUQsCiAgICAgICAgYm9vbCB0cmFkZWFibGUKICAgICAgICAKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICAgICAgewogICAgICAgICAgIAoKICAgICAgICAgICAgTW9uc3RlciBtZW1vcnkgX21vbnN0ZXIgPSBNb25zdGVyKHsKICAgICAgICAgICAgICAgIGJpcnRoVGltZTogdWludDY0KG5vdyksCiAgICAgICAgICAgICAgICBocDogdWludDE2KF9ocCksCiAgICAgICAgICAgICAgICBhdHRhY2s6IHVpbnQxNihfYXR0YWNrKSwKICAgICAgICAgICAgICAgIGRlZmVuc2U6IHVpbnQxNihfZGVmZW5zZSksCiAgICAgICAgICAgICAgICBzcEF0dGFjazogdWludDE2KF9zcEF0dGFjayksCiAgICAgICAgICAgICAgICBzcERlZmVuc2U6IHVpbnQxNihfc3BEZWZlbnNlKSwKICAgICAgICAgICAgICAgIHNwZWVkOiB1aW50MTYoX3NwZWVkKSwKICAgICAgICAgICAgICAgIHR5cGVPbmU6IHVpbnQxNihfdHlwZU9uZSksCiAgICAgICAgICAgICAgICB0eXBlVHdvOiB1aW50MTYoX3R5cGVUd28pLAogICAgICAgICAgICAgICAgbUlEOiB1aW50MTYoX21JRCksCiAgICAgICAgICAgICAgICB0cmFkZWFibGU6IHRyYWRlYWJsZQogICAgICAgICAgICAgICAgCgoKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHVpbnQyNTYgbmV3TW9uc3RlcklkID0gbW9uc3RlcnMucHVzaChfbW9uc3RlcikgLSAxOwogICAgICAgICAgICBtb25zdGVySWRUb1RyYWRlYWJsZVtuZXdNb25zdGVySWRdID0gdHJhZGVhYmxlOwogICAgICAgICAgICBtb25zdGVySWRUb0dlbmVyYXRpb25bbmV3TW9uc3RlcklkXSA9IF9nZW5lcmF0aW9uOwogICAgICAgICAgIAoKICAgICAgICAgICAgcmVxdWlyZShuZXdNb25zdGVySWQgPT0gdWludDI1Nih1aW50MzIobmV3TW9uc3RlcklkKSkpOwogICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgIG1vbnN0ZXJJZFRvTmlja25hbWVbbmV3TW9uc3RlcklkXSA9ICIiOwoKICAgICAgICAgICAgX3RyYW5zZmVyKDAsIF9vd25lciwgbmV3TW9uc3RlcklkKTsKCiAgICAgICAgICAgIHJldHVybiBuZXdNb25zdGVySWQ7CgoKICAgICAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9jcmVhdGVUcmFpbmVyKHN0cmluZyBfdXNlcm5hbWUsIHVpbnQxNiBfc3RhcnRlcklkLCBhZGRyZXNzIF9vd25lcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQgbW9uKQogICAgICAgIHsKICAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgIFRyYWluZXIgbWVtb3J5IF90cmFpbmVyID0gVHJhaW5lcih7CiAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYmlydGhUaW1lOiB1aW50NjQobm93KSwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBzdHJpbmcoX3VzZXJuYW1lKSwKICAgICAgICAgICAgICAgIGN1cnJBcmVhOiB1aW50MTYoMSksIC8vIHNldHMgdG8gZmlyc3QgYXJlYSEsCiAgICAgICAgICAgICAgICBvd25lcjogYWRkcmVzcyhfb3duZXIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFkZHJlc3NUb1RyYWluZXJbX293bmVyXSA9IF90cmFpbmVyOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gc3RhcnRlciBzdGF0cyBhcmUgaGFyZGNvZGVkIQogICAgICAgICAgICBpZiAoX3N0YXJ0ZXJJZCA9PSAxKSB7CiAgICAgICAgICAgICAgICB1aW50OFs4XSBtZW1vcnkgU3RhdHMgPSB1aW50OFs4XShtb25zdGVyQ3JlYXRvci5nZXRNb25zdGVyU3RhdHMoMSkpOwogICAgICAgICAgICAgICAgbW9uID0gX2NyZWF0ZU1vbnN0ZXIoMCwgU3RhdHNbMF0sIFN0YXRzWzFdLCBTdGF0c1syXSwgU3RhdHNbM10sIFN0YXRzWzRdLCBTdGF0c1s1XSwgU3RhdHNbNl0sIFN0YXRzWzddLCBfb3duZXIsIDEsIGZhbHNlKTsKICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3N0YXJ0ZXJJZCA9PSAyKSB7CiAgICAgICAgICAgICAgICB1aW50OFs4XSBtZW1vcnkgU3RhdHMyID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKDQpKTsKICAgICAgICAgICAgICAgIG1vbiA9IF9jcmVhdGVNb25zdGVyKDAsIFN0YXRzMlswXSwgU3RhdHMyWzFdLCBTdGF0czJbMl0sIFN0YXRzMlszXSwgU3RhdHMyWzRdLCBTdGF0czJbNV0sIFN0YXRzMls2XSwgU3RhdHMyWzddLCBfb3duZXIsIDQsIGZhbHNlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgaWYgKF9zdGFydGVySWQgPT0gMykgewogICAgICAgICAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzMyA9IHVpbnQ4WzhdKG1vbnN0ZXJDcmVhdG9yLmdldE1vbnN0ZXJTdGF0cyg3KSk7CiAgICAgICAgICAgICAgICBtb24gPSBfY3JlYXRlTW9uc3RlcigwLCBTdGF0czNbMF0sIFN0YXRzM1sxXSwgU3RhdHMzWzJdLCBTdGF0czNbM10sIFN0YXRzM1s0XSwgU3RhdHMzWzVdLCBTdGF0czNbNl0sIFN0YXRzM1s3XSwgX293bmVyLCA3LCBmYWxzZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICB9CgoKICAgIGZ1bmN0aW9uIF9tb3ZlVG9BcmVhKHVpbnQxNiBfbmV3QXJlYSwgYWRkcmVzcyBwbGF5ZXIpIGludGVybmFsIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFkZHJlc3NUb1RyYWluZXJbcGxheWVyXS5jdXJyQXJlYSA9IF9uZXdBcmVhOwogICAgICAgICAgCiAgICAgICAgfSAgIAogICAgICAgIAogICAgCiAgICAgCgogICAgCiAgICAvLyBhc3NpZ25zIG93bmVyc2hpcCBvZiBtb25zdGVyIHRvIGFkZHJlc3MKICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX3RvXSsrOwogICAgICAgIG1vbnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdID0gX3RvOwoKICAgICAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W19mcm9tXS0tOwoKICAgICAgICAgICAgLy8gY2xlYXIgYW55IHByZXZpb3VzbHkgYXBwcm92ZWQgb3duZXJzaGlwIGV4Y2hhbmdlCiAgICAgICAgICAgIGRlbGV0ZSBtb25zdGVySW5kZXhUb0FwcHJvdmVkW190b2tlbklkXTsKICAgICAgICB9CgogICAgICAgIC8vIEVtaXQgVHJhbnNmZXIgZXZlbnQKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgoKICAgIC8vIE9ubHkgYWRtaW4gY2FuIGZpeCBob3cgbWFueSBzZWNvbmRzIHBlciBibG9ja3MgYXJlIGN1cnJlbnRseSBvYnNlcnZlZC4KICAgIGZ1bmN0aW9uIHNldFNlY29uZHNQZXJCbG9jayh1aW50MjU2IHNlY3MpIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgLy9yZXF1aXJlKHNlY3MgPCBjb29sZG93bnNbMF0pOwogICAgICAgIHNlY29uZHNQZXJCbG9jayA9IHNlY3M7CiAgICB9CgoKICAgIAoKCn0KCi8vLyBAdGl0bGUgVGhlIGV4dGVybmFsIGNvbnRyYWN0IHRoYXQgaXMgcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgbWV0YWRhdGEgZm9yIHRoZSBtb25zdGVycywKLy8vICBpdCBoYXMgb25lIGZ1bmN0aW9uIHRoYXQgd2lsbCByZXR1cm4gdGhlIGRhdGEgYXMgYnl0ZXMuCmNvbnRyYWN0IEVSQzcyMU1ldGFkYXRhIHsKICAgIC8vLyBAZGV2IEdpdmVuIGEgdG9rZW4gSWQsIHJldHVybnMgYSBieXRlIGFycmF5IHRoYXQgaXMgc3VwcG9zZWQgdG8gYmUgY29udmVydGVkIGludG8gc3RyaW5nLgogICAgZnVuY3Rpb24gZ2V0TWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyWzRdIGJ1ZmZlciwgdWludDI1NiBjb3VudCkgewogICAgICAgIGlmIChfdG9rZW5JZCA9PSAxKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJIZWxsbyBXb3JsZCEgOkQiOwogICAgICAgICAgICBjb3VudCA9IDE1OwogICAgICAgIH0gZWxzZSBpZiAoX3Rva2VuSWQgPT0gMikgewogICAgICAgICAgICBidWZmZXJbMF0gPSAiSSB3b3VsZCBkZWZpbml0ZWx5IGNob29zZSBhIG1lZGkiOwogICAgICAgICAgICBidWZmZXJbMV0gPSAidW0gbGVuZ3RoIHN0cmluZy4iOwogICAgICAgICAgICBjb3VudCA9IDQ5OwogICAgICAgIH0gZWxzZSBpZiAoX3Rva2VuSWQgPT0gMykgewogICAgICAgICAgICBidWZmZXJbMF0gPSAiTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIG1pIGUiOwogICAgICAgICAgICBidWZmZXJbMV0gPSAic3QgYWNjdW1zYW4gZGFwaWJ1cyBhdWd1ZSBsb3JlbSwiOwogICAgICAgICAgICBidWZmZXJbMl0gPSAiIHRyaXN0aXF1ZSB2ZXN0aWJ1bHVtIGlkLCBsaWJlcm8iOwogICAgICAgICAgICBidWZmZXJbM10gPSAiIHN1c2NpcGl0IHZhcml1cyBzYXBpZW4gYWxpcXVhbS4iOwogICAgICAgICAgICBjb3VudCA9IDEyODsKICAgICAgICB9CiAgICB9Cn0KCgpjb250cmFjdCBNb25zdGVyT3duZXJzaGlwIGlzIE1vbnN0ZXJzQmFzZSwgRVJDNzIxIHsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQ2hhaW5Nb25zdGVycyI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJDSE1PIjsKCgogICAgLy8gVGhlIGNvbnRyYWN0IHRoYXQgd2lsbCByZXR1cm4gbW9uc3RlciBtZXRhZGF0YQogICAgRVJDNzIxTWV0YWRhdGEgcHVibGljIGVyYzcyMU1ldGFkYXRhOwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID0KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKCgoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCduYW1lKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N5bWJvbCgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0b3RhbFN1cHBseSgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdiYWxhbmNlT2YoYWRkcmVzcyknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ293bmVyT2YodWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5zT2ZPd25lcihhZGRyZXNzKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5NZXRhZGF0YSh1aW50MjU2LHN0cmluZyknKSk7CgoKCgogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gREVCVUcgT05MWQogICAgICAgIC8vcmVxdWlyZSgoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9PSAweDAxZmZjOWE3KSAmJiAoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9PSAweDlhMjA0ODNkKSk7CgogICAgICAgIHJldHVybiAoKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1KSB8fCAoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgIH0KCiAgICAvLy8gQGRldiBTZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIHNpYmxpbmcgY29udHJhY3QgdGhhdCB0cmFja3MgbWV0YWRhdGEuCiAgICAvLy8gIENFTyBvbmx5LgogICAgZnVuY3Rpb24gc2V0TWV0YWRhdGFBZGRyZXNzKGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcykgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgZXJjNzIxTWV0YWRhdGEgPSBFUkM3MjFNZXRhZGF0YShfY29udHJhY3RBZGRyZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1vbnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2lzVHJhZGVhYmxlKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtb25zdGVySWRUb1RyYWRlYWJsZVtfdG9rZW5JZF07CiAgICB9CiAgICAKICAgIAogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBjdXJyZW50bHkgaGFzIHRyYW5zZmVyQXBwcm92YWwgZm9yIGEgcGFydGljdWxhciBtb25zdGVyLgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIGNvbmZpcm1pbmcgbW9uc3RlciBpcyBhcHByb3ZlZCBmb3IuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIG1vbnN0ZXIgaWQsIG9ubHkgdmFsaWQgd2hlbiA+IDAKICAgIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1vbnN0ZXJJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBNYXJrcyBhbiBhZGRyZXNzIGFzIGJlaW5nIGFwcHJvdmVkIGZvciB0cmFuc2ZlckZyb20oKSwgb3ZlcndyaXRpbmcgYW55IHByZXZpb3VzCiAgICAvLy8gIGFwcHJvdmFsLiBTZXR0aW5nIF9hcHByb3ZlZCB0byBhZGRyZXNzKDApIGNsZWFycyBhbGwgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAvLy8gIE5PVEU6IF9hcHByb3ZlKCkgZG9lcyBOT1Qgc2VuZCB0aGUgQXBwcm92YWwgZXZlbnQuIFRoaXMgaXMgaW50ZW50aW9uYWwgYmVjYXVzZQogICAgLy8vICBfYXBwcm92ZSgpIGFuZCB0cmFuc2ZlckZyb20oKSBhcmUgdXNlZCB0b2dldGhlciBmb3IgcHV0dGluZyBtb25zdGVycyBvbiBhdWN0aW9uLCBhbmQKICAgIC8vLyAgdGhlcmUgaXMgbm8gdmFsdWUgaW4gc3BhbW1pbmcgdGhlIGxvZyB3aXRoIEFwcHJvdmFsIGV2ZW50cyBpbiB0aGF0IGNhc2UuCiAgICBmdW5jdGlvbiBfYXBwcm92ZSh1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9hcHByb3ZlZCkgaW50ZXJuYWwgewogICAgICAgIG1vbnN0ZXJJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID0gX2FwcHJvdmVkOwogICAgfQogICAgCiAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewogICAgICAgIHJldHVybiBvd25lcnNoaXBUb2tlbkNvdW50W19vd25lcl07CiAgICB9CgoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyIChhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBtb25zdGVycyAoZXhjZXB0IHZlcnkgYnJpZWZseQogICAgICAgIC8vIGFmdGVyIGEgZ2VuMCBtb25zdGVyIGlzIGNyZWF0ZWQgYW5kIGJlZm9yZSBpdCBnb2VzIG9uIGF1Y3Rpb24pLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIAoKICAgICAgICAvLyBZb3UgY2FuIG9ubHkgc2VuZCB5b3VyIG93biBtb25zdGVyLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwLCBjbGVhciBwZW5kaW5nIGFwcHJvdmFscywgZW1pdCBUcmFuc2ZlciBldmVudC4KICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgCiAgICAKCi8vLyBAbm90aWNlIEdyYW50IGFub3RoZXIgYWRkcmVzcyB0aGUgcmlnaHQgdG8gdHJhbnNmZXIgYSBzcGVjaWZpYyBtb25zdGVyIHZpYQogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gVGhpcyBpcyB0aGUgcHJlZmVycmVkIGZsb3cgZm9yIHRyYW5zZmVyaW5nIE5GVHMgdG8gY29udHJhY3RzLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYmUgZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbC4gUGFzcyBhZGRyZXNzKDApIHRvCiAgICAvLy8gIGNsZWFyIGFsbCBhcHByb3ZhbHMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgbW9uc3RlciB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCApIGV4dGVybmFsIHsKICAgICAgICAvLyBPbmx5IGFuIG93bmVyIGNhbiBncmFudCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlZ2lzdGVyIHRoZSBhcHByb3ZhbCAocmVwbGFjaW5nIGFueSBwcmV2aW91cyBhcHByb3ZhbCkuCiAgICAgICAgX2FwcHJvdmUoX3Rva2VuSWQsIF90byk7CgogICAgICAgIC8vIEVtaXQgYXBwcm92YWwgZXZlbnQuCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBtb25zdGVyIG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nIGFkZHJlc3MKICAgIC8vLyAgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSBtb25zdGVyIHRvIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHNob3VsZCB0YWtlIG93bmVyc2hpcCBvZiB0aGUgbW9uc3Rlci4gQ2FuIGJlIGFueSBhZGRyZXNzLAogICAgLy8vICBpbmNsdWRpbmcgdGhlIGNhbGxlci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBtb25zdGVyIHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSAoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQgKSBleHRlcm5hbCB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IG1vbnN0ZXJzIChleGNlcHQgdmVyeSBicmllZmx5CiAgICAgICAgLy8gYWZ0ZXIgYSBnZW4wIG1vbnN0ZXIgaXMgY3JlYXRlZCBhbmQgYmVmb3JlIGl0IGdvZXMgb24gYXVjdGlvbikuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgLy8gQ2hlY2sgZm9yIGFwcHJvdmFsIGFuZCB2YWxpZCBvd25lcnNoaXAKICAgICAgICAvL3JlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG1vbnN0ZXJzLmxlbmd0aDsKICAgIH0KCgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKQogICAgICAgICAgICBleHRlcm5hbAogICAgICAgICAgICB2aWV3CiAgICAgICAgICAgIHJldHVybnMgKGFkZHJlc3Mgb3duZXIpCiAgICAgICAgewogICAgICAgICAgICBvd25lciA9IG1vbnN0ZXJJbmRleFRvT3duZXJbX3Rva2VuSWRdOwoKICAgICAgICAgICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICB9CgogICAgIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10gb3duZXJUb2tlbnMpIHsKICAgICAgICB1aW50MjU2IHRva2VuQ291bnQgPSBiYWxhbmNlT2YoX293bmVyKTsKCiAgICAgICAgaWYgKHRva2VuQ291bnQgPT0gMCkgewogICAgICAgICAgICAvLyBSZXR1cm4gYW4gZW1wdHkgYXJyYXkKICAgICAgICAgICAgcmV0dXJuIG5ldyB1aW50MjU2W10oMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKHRva2VuQ291bnQpOwogICAgICAgICAgICB1aW50MjU2IHRvdGFsTW9uc3RlcnMgPSB0b3RhbFN1cHBseSgpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZDsKCiAgICAgICAgICAgIGZvciAobW9uc3RlcklkID0gMDsgbW9uc3RlcklkIDw9IHRvdGFsTW9uc3RlcnM7IG1vbnN0ZXJJZCsrKSB7CiAgICAgICAgICAgICAgICBpZiAobW9uc3RlckluZGV4VG9Pd25lclttb25zdGVySWRdID09IF9vd25lcikgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBtb25zdGVySWQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CgoKICAgCgogICAgLy8vIEBkZXYgQWRhcHRlZCBmcm9tIG1lbWNweSgpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjZmMGUxZDBlMGMwNzAxMDYwYjJmMDEwMDFiMGIwMDFiNDEwMTBhMWIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF9tZW1jcHkodWludCBfZGVzdCwgdWludCBfc3JjLCB1aW50IF9sZW4pIHByaXZhdGUgdmlldyB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IoOyBfbGVuID49IDMyOyBfbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgbWxvYWQoX3NyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Rlc3QgKz0gMzI7CiAgICAgICAgICAgIF9zcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQyNTYgbWFzayA9IDI1NiAqKiAoMzIgLSBfbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoX3NyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChfZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBZGFwdGVkIGZyb20gdG9TdHJpbmcoc2xpY2UpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImZjOWQ4ZTlkOWY5NDkyOTU5OGJjOTI5Mzg4OTg5Mzg4ZDI5Mjk5ODgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF90b1N0cmluZyhieXRlczMyWzRdIF9yYXdCeXRlcywgdWludDI1NiBfc3RyaW5nTGVuZ3RoKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIG91dHB1dFN0cmluZyA9IG5ldyBzdHJpbmcoX3N0cmluZ0xlbmd0aCk7CiAgICAgICAgdWludDI1NiBvdXRwdXRQdHI7CiAgICAgICAgdWludDI1NiBieXRlc1B0cjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBvdXRwdXRQdHIgOj0gYWRkKG91dHB1dFN0cmluZywgMzIpCiAgICAgICAgICAgIGJ5dGVzUHRyIDo9IF9yYXdCeXRlcwogICAgICAgIH0KCiAgICAgICAgX21lbWNweShvdXRwdXRQdHIsIGJ5dGVzUHRyLCBfc3RyaW5nTGVuZ3RoKTsKCiAgICAgICAgcmV0dXJuIG91dHB1dFN0cmluZzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGEgVVJJIHBvaW50aW5nIHRvIGEgbWV0YWRhdGEgcGFja2FnZSBmb3IgdGhpcyB0b2tlbiBjb25mb3JtaW5nIHRvCiAgICAvLy8gIEVSQy03MjEgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEpCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBudW1iZXIgb2YgdGhlIG1vbnN0ZXIgd2hvc2UgbWV0YWRhdGEgc2hvdWxkIGJlIHJldHVybmVkLgogICAgZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCkgewogICAgICAgIHJlcXVpcmUoZXJjNzIxTWV0YWRhdGEgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYnl0ZXMzMls0XSBtZW1vcnkgYnVmZmVyOwogICAgICAgIHVpbnQyNTYgY291bnQ7CiAgICAgICAgKGJ1ZmZlciwgY291bnQpID0gZXJjNzIxTWV0YWRhdGEuZ2V0TWV0YWRhdGEoX3Rva2VuSWQsIF9wcmVmZXJyZWRUcmFuc3BvcnQpOwoKICAgICAgICByZXR1cm4gX3RvU3RyaW5nKGJ1ZmZlciwgY291bnQpOwogICAgfQoKfQoKY29udHJhY3QgTW9uc3RlckF1Y3Rpb25CYXNlIHsKICAgIAogICAgCiAgICAvLyBSZWZlcmVuY2UgdG8gY29udHJhY3QgdHJhY2tpbmcgTkZUIG93bmVyc2hpcAogICAgRVJDNzIxIHB1YmxpYyBub25GdW5naWJsZUNvbnRyYWN0OwogICAgQ2hhaW5Nb25zdGVyc0NvcmUgcHVibGljIGNvcmU7CiAgICAKICAgIHN0cnVjdCBBdWN0aW9uIHsKCiAgICAgICAgLy8gY3VycmVudCBvd25lcgogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwoKICAgICAgICAvLyBwcmljZSBpbiB3ZWkKICAgICAgICB1aW50MjU2IHByaWNlOwoKICAgICAgICAvLyB0aW1lIHdoZW4gYXVjdGlvbiBzdGFydGVkCiAgICAgICAgdWludDY0IHN0YXJ0ZWRBdDsKCiAgICAgICAgdWludDI1NiBpZDsKICAgIH0KCiAgCgogICAgLy8gQ3V0IG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbWVhc3VyZWQgaW4gYmFzaXMgcG9pbnRzICgxLzEwMCBvZiBhIHBlcmNlbnQpLgogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICB1aW50MjU2IHB1YmxpYyBvd25lckN1dDsKCiAgICAvLyBNYXAgZnJvbSB0b2tlbiBJRCB0byB0aGVpciBjb3JyZXNwb25kaW5nIGF1Y3Rpb24uCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gQXVjdGlvbikgdG9rZW5JZFRvQXVjdGlvbjsKCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGF1Y3Rpb25JZFRvU2VsbGVyOwogICAgCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBvd25lcnNoaXBBdWN0aW9uQ291bnQ7CgoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBwcmljZSwgdWludDI1NiB1SUQsIGFkZHJlc3Mgc2VsbGVyKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBwcmljZSwgYWRkcmVzcyBuZXdPd25lciwgdWludDI1NiB1SUQpOwogICAgZXZlbnQgQXVjdGlvbkNhbmNlbGxlZCh1aW50MjU2IHRva2VuSWQsIHVpbnQyNTYgdUlEKTsKCgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9hZGRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAKICAgICAgICB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXSA9IF9hdWN0aW9uOwoKICAgICAgICBBdWN0aW9uQ3JlYXRlZCgKICAgICAgICAgICAgdWludDI1NihfdG9rZW5JZCksCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24ucHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmlkKSwKICAgICAgICAgICAgYWRkcmVzcyhfYXVjdGlvbi5zZWxsZXIpCiAgICAgICAgKTsKICAgICAgIAogICAgfQoKCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICAKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKCiAgICAgICAgdWludDI1NiB1SUQgPSBfYXVjdGlvbi5pZDsKICAgICAgICAKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgb3duZXJzaGlwQXVjdGlvbkNvdW50W19zZWxsZXJdLS07CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICAKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkLCB1SUQpOwogICAgfQoKCiAgICBmdW5jdGlvbiBfYnV5KHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICAgICAgewogICAgICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIAoKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBhdWN0aW9uLnByaWNlOwogICAgICAgIHJlcXVpcmUoX2JpZEFtb3VudCA+PSBwcmljZSk7CgogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CgogICAgICAgIHVpbnQyNTYgdUlEID0gYXVjdGlvbi5pZDsKICAgICAgICAvLyBBdWN0aW9uIEJpZCBsb29rcyBmaW5lISBzbyByZW1vdmUKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgb3duZXJzaGlwQXVjdGlvbkNvdW50W3NlbGxlcl0tLTsKCiAgICAgICAgaWYgKHByaWNlID4gMCkgewoKICAgICAgICAgICAgdWludDI1NiBhdWN0aW9uZWVyQ3V0ID0gX2NvbXB1dGVDdXQocHJpY2UpOwogICAgICAgICAgICB1aW50MjU2IHNlbGxlclByb2NlZWRzID0gcHJpY2UgLSBhdWN0aW9uZWVyQ3V0OwoKICAgICAgICAgICAgLy8gTk9URTogRG9pbmcgYSB0cmFuc2ZlcigpIGluIHRoZSBtaWRkbGUgb2YgYSBjb21wbGV4CiAgICAgICAgICAgIC8vIG1ldGhvZCBsaWtlIHRoaXMgaXMgZ2VuZXJhbGx5IGRpc2NvdXJhZ2VkIGJlY2F1c2Ugb2YKICAgICAgICAgICAgLy8gcmVlbnRyYW5jeSBhdHRhY2tzIGFuZCBEb1MgYXR0YWNrcyBpZiB0aGUgc2VsbGVyIGlzCiAgICAgICAgICAgIC8vIGEgY29udHJhY3Qgd2l0aCBhbiBpbnZhbGlkIGZhbGxiYWNrIGZ1bmN0aW9uLiBXZSBleHBsaWNpdGx5CiAgICAgICAgICAgIC8vIGd1YXJkIGFnYWluc3QgcmVlbnRyYW5jeSBhdHRhY2tzIGJ5IHJlbW92aW5nIHRoZSBhdWN0aW9uCiAgICAgICAgICAgIC8vIGJlZm9yZSBjYWxsaW5nIHRyYW5zZmVyKCksIGFuZCB0aGUgb25seSB0aGluZyB0aGUgc2VsbGVyCiAgICAgICAgICAgIC8vIGNhbiBEb1MgaXMgdGhlIHNhbGUgb2YgdGhlaXIgb3duIGFzc2V0ISAoQW5kIGlmIGl0J3MgYW4KICAgICAgICAgICAgLy8gYWNjaWRlbnQsIHRoZXkgY2FuIGNhbGwgY2FuY2VsQXVjdGlvbigpLiApCiAgICAgICAgICAgIGlmKHNlbGxlciAhPSBhZGRyZXNzKGNvcmUpKSB7CiAgICAgICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDYWxjdWxhdGUgYW55IGV4Y2VzcyBmdW5kcyBpbmNsdWRlZCB3aXRoIHRoZSBiaWQuIElmIHRoZSBleGNlc3MKICAgICAgICAvLyBpcyBhbnl0aGluZyB3b3J0aCB3b3JyeWluZyBhYm91dCwgdHJhbnNmZXIgaXQgYmFjayB0byBiaWRkZXIuCiAgICAgICAgLy8gTk9URTogV2UgY2hlY2tlZCBhYm92ZSB0aGF0IHRoZSBiaWQgYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiBvcgogICAgICAgIC8vIGVxdWFsIHRvIHRoZSBwcmljZSBzbyB0aGlzIGNhbm5vdCB1bmRlcmZsb3cuCiAgICAgICAgdWludDI1NiBiaWRFeGNlc3MgPSBfYmlkQW1vdW50IC0gcHJpY2U7CgogICAgICAgIC8vIFJldHVybiB0aGUgZnVuZHMuIFNpbWlsYXIgdG8gdGhlIHByZXZpb3VzIHRyYW5zZmVyLCB0aGlzIGlzCiAgICAgICAgLy8gbm90IHN1c2NlcHRpYmxlIHRvIGEgcmUtZW50cnkgYXR0YWNrIGJlY2F1c2UgdGhlIGF1Y3Rpb24gaXMKICAgICAgICAvLyByZW1vdmVkIGJlZm9yZSBhbnkgdHJhbnNmZXJzIG9jY3VyLgogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmlkRXhjZXNzKTsKCiAgICAgICAgLy8gVGVsbCB0aGUgd29ybGQhCiAgICAgICAgQXVjdGlvblN1Y2Nlc3NmdWwoX3Rva2VuSWQsIHByaWNlLCBtc2cuc2VuZGVyLCB1SUQpOwoKICAgICAgICByZXR1cm4gcHJpY2U7CgoKICAgIH0KCiAgICBmdW5jdGlvbiBfcmVtb3ZlQXVjdGlvbih1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgZGVsZXRlIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc09uQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX2F1Y3Rpb24uc3RhcnRlZEF0ID4gMCk7CiAgICB9CgogICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIGVudHJ5IGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgY3VycmVuY3kgKGF0IDEyOC1iaXRzKSwgYW5kIG93bmVyQ3V0IDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vICBzdGF0ZW1lbnQgaW4gdGhlIENsb2NrQXVjdGlvbiBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vICBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfcHJpY2UuCiAgICAgICAgcmV0dXJuIF9wcmljZSAqIG93bmVyQ3V0IC8gMTAwMDA7CiAgICB9CgogICAgCgp9CgoKY29udHJhY3QgTW9uc3RlckF1Y3Rpb24gaXMgIE1vbnN0ZXJBdWN0aW9uQmFzZSwgT3duYWJsZSB7CgoKICAgIGJvb2wgcHVibGljIGlzTW9uc3RlckF1Y3Rpb24gPSB0cnVlOwogICAgIHVpbnQyNTYgcHVibGljIGF1Y3Rpb25JbmRleCA9IDA7CgogICAgLy8vIEBkZXYgVGhlIEVSQy0xNjUgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDLTcyMS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1CiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPSBieXRlczQoMHg5YTIwNDgzZCk7CgogICAgZnVuY3Rpb24gTW9uc3RlckF1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkcmVzcywgdWludDI1NiBfY3V0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2N1dCA8PSAxMDAwMCk7CiAgICAgICAgb3duZXJDdXQgPSBfY3V0OwoKICAgICAgICBFUkM3MjEgY2FuZGlkYXRlQ29udHJhY3QgPSBFUkM3MjEoX25mdEFkZHJlc3MpOwogICAgICAgIAogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgICAgICBDaGFpbk1vbnN0ZXJzQ29yZSBjYW5kaWRhdGVDb3JlQ29udHJhY3QgPSBDaGFpbk1vbnN0ZXJzQ29yZShfbmZ0QWRkcmVzcyk7CiAgICAgICAgY29yZSA9IGNhbmRpZGF0ZUNvcmVDb250cmFjdDsKCiAgICAgICAgCiAgICB9CiAgICAKICAgIC8vIG9ubHkgcG9zc2libGUgdG8gZGVjcmVhc2Ugb3duZXJDdXQhCiAgICBmdW5jdGlvbiBzZXRPd25lckN1dCh1aW50MjU2IF9jdXQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfY3V0IDw9IG93bmVyQ3V0KTsKICAgICAgICBvd25lckN1dCA9IF9jdXQ7CiAgICB9CiAgICAKICAgIAogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAobm9uRnVuZ2libGVDb250cmFjdC5vd25lck9mKF90b2tlbklkKSA9PSBfY2xhaW1hbnQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfZXNjcm93KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXJGcm9tKF9vd25lciwgdGhpcywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgIAogICAgICAgdWludDI1NiBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgICAgCiAgICAgICAKICAgICAgICBvd25lci50cmFuc2ZlcihiYWxhbmNlKTsKCiAgICAgICAgCiAgICAgICAKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIHRva2Vuc0luQXVjdGlvbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdIGF1Y3Rpb25Ub2tlbnMpIHsKICAgICAgICAKICAgICAgICAgICB1aW50MjU2IG51bUF1Y3Rpb25zID0gb3duZXJzaGlwQXVjdGlvbkNvdW50W19vd25lcl07CgogICAgICAgICAgICAKICAgICAgICAKICAgICAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKG51bUF1Y3Rpb25zKTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbEF1Y3Rpb25zID0gY29yZS50b3RhbFN1cHBseSgpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50MjU2IGF1Y3Rpb25JZDsKCiAgICAgICAgICAgIGZvciAoYXVjdGlvbklkID0gMDsgYXVjdGlvbklkIDw9IHRvdGFsQXVjdGlvbnM7IGF1Y3Rpb25JZCsrKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvblthdWN0aW9uSWRdOwogICAgICAgICAgICAgICAgaWYgKGF1Y3Rpb24uc2VsbGVyID09IF9vd25lcikgewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBhdWN0aW9uSWQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAKICAgICAgICAKICAgIH0KCgoKCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX3ByaWNlLCBhZGRyZXNzIF9zZWxsZXIpIGV4dGVybmFsIHsKICAgICAgICAgICAgIHJlcXVpcmUoX3ByaWNlID09IHVpbnQyNTYoX3ByaWNlKSk7CiAgICAgICAgICAgIHJlcXVpcmUoY29yZS5faXNUcmFkZWFibGUoX3Rva2VuSWQpKTsKICAgICAgICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICAgICAgIF9lc2Nyb3cobXNnLnNlbmRlciwgX3Rva2VuSWQpOwoKICAgICAgICAgICAgCgogICAgICAgICAgICAKICAgICAgICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICAgICAgICAgdWludDI1NihfcHJpY2UpLAogICAgICAgICAgICAgICAgIHVpbnQ2NChub3cpLAogICAgICAgICAgICAgICAgIHVpbnQyNTYoYXVjdGlvbkluZGV4KQogICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGF1Y3Rpb25JZFRvU2VsbGVyW2F1Y3Rpb25JbmRleF0gPSBfc2VsbGVyOwogICAgICAgICAgICBvd25lcnNoaXBBdWN0aW9uQ291bnRbX3NlbGxlcl0rKzsKICAgICAgICAgICAgCiAgICAgICAgICAgICBhdWN0aW9uSW5kZXgrKzsKICAgICAgICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgICAgICB9CgogICAgZnVuY3Rpb24gYnV5KHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgICAgICAvL2RlbGV0ZSBhdWN0aW9uSWRUb1NlbGxlcltfdG9rZW5JZF07CiAgICAgICAgICAgIC8vIGJ1eSB3aWxsIHRocm93IGlmIHRoZSBiaWQgb3IgZnVuZHMgdHJhbnNmZXIgZmFpbHMKICAgICAgICAgICAgX2J1eSAoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICB9CgogICAgCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHsKICAgICAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwoKICAgICAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKICAgICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGxlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIHNlbGxlcik7CiAgICAgICAgfQoKICAgIAogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMKICAgICAgICAoCiAgICAgICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgICAgICB1aW50MjU2IHByaWNlLAogICAgICAgICAgICB1aW50MjU2IHN0YXJ0ZWRBdAogICAgICAgICkgewogICAgICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgICAgICAgICBhdWN0aW9uLnByaWNlLAogICAgICAgICAgICAgICAgYXVjdGlvbi5zdGFydGVkQXQKICAgICAgICAgICAgKTsKICAgICAgICB9CgoKICAgIGZ1bmN0aW9uIGdldFByaWNlKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgICAgICB7CiAgICAgICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAgICAgcmV0dXJuIGF1Y3Rpb24ucHJpY2U7CiAgICAgICAgfQp9CgoKY29udHJhY3QgQ2hhaW5Nb25zdGVyc0F1Y3Rpb24gaXMgTW9uc3Rlck93bmVyc2hpcCB7CgogIAoKCiAgICBmdW5jdGlvbiBzZXRNb25zdGVyQXVjdGlvbkFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBNb25zdGVyQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IE1vbnN0ZXJBdWN0aW9uKF9hZGRyZXNzKTsKCiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc01vbnN0ZXJBdWN0aW9uKCkpOwoKICAgICAgICBtb25zdGVyQXVjdGlvbiA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKCgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFJPTU9fQ1JFQVRJT05fTElNSVQgPSA1MDAwOwoKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEdFTjBfQ1JFQVRJT05fTElNSVQgPSA1MDAwOwoKICAgIC8vIENvdW50cyB0aGUgbnVtYmVyIG9mIG1vbnN0ZXIgdGhlIGNvbnRyYWN0IG93bmVyIGhhcyBjcmVhdGVkLgogICAgdWludDI1NiBwdWJsaWMgcHJvbW9DcmVhdGVkQ291bnQ7CiAgICB1aW50MjU2IHB1YmxpYyBnZW4wQ3JlYXRlZENvdW50OwoKCiAgICAKICAgIC8vIGl0cyBzdGF0cyBhcmUgY29tcGxldGVseSBkZXBlbmRlbnQgb24gdGhlIHNwYXduIGFsZ2hvcml0aG0KICAgIGZ1bmN0aW9uIGNyZWF0ZVByb21vTW9uc3Rlcih1aW50MjU2IF9tSWQsIGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgCgogICAgICAgLy8gZHVyaW5nIGdlbmVyYXRpb24gd2UgaGF2ZSB0byBrZWVwIGluIG1pbmQgdGhhdCB3ZSBoYXZlIG9ubHkgMTAsMDAwIHRva2VucyBhdmFpbGFibGUKICAgICAgIC8vIHdoaWNoIGhhdmUgdG8gYmUgZGl2aWRlZCBieSAxNTEgbW9uc3RlcnMsIHNvbWUgcmFyZXIgdGhhbiBvdGhlcnMKICAgICAgIC8vIHNlZSBXaGl0ZVBhcGVyIGZvciBnZW4wL3Byb21vIG1vbnN0ZXIgcGxhbgogICAgICAgIAogICAgICAgIHJlcXVpcmUocHJvbW9DcmVhdGVkQ291bnQgPCBQUk9NT19DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIHByb21vQ3JlYXRlZENvdW50Kys7CiAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKHVpbnQyNTYoX21JZCkpKTsKICAgICAgICB1aW50OFs3XSBtZW1vcnkgSVZzID0gdWludDhbN10obW9uc3RlckNyZWF0b3IuZ2V0R2VuMElWcygpKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKDAsIFN0YXRzWzBdLCBTdGF0c1sxXSwgU3RhdHNbMl0sIFN0YXRzWzNdLCBTdGF0c1s0XSwgU3RhdHNbNV0sIFN0YXRzWzZdLCBTdGF0c1s3XSwgX293bmVyLCBfbUlkLCB0cnVlKTsKICAgICAgICBtb25zdGVySWRUb1RyYWRlYWJsZVttb25zdGVySWRdID0gdHJ1ZTsKCiAgICAgICAgbW9uc3RlcklkVG9JVnNbbW9uc3RlcklkXSA9IElWczsKICAgICAgICAKICAgICAgIAogICAgfQoKICAgCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZUdlbjBBdWN0aW9uKHVpbnQyNTYgX21JZCwgdWludDI1NiBwcmljZSkgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKGdlbjBDcmVhdGVkQ291bnQgPCBHRU4wX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKHVpbnQyNTYoX21JZCkpKTsKICAgICAgICB1aW50OFs3XSBtZW1vcnkgSVZzID0gdWludDhbN10obW9uc3RlckNyZWF0b3IuZ2V0R2VuMElWcygpKTsKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKDAsIFN0YXRzWzBdLCBTdGF0c1sxXSwgU3RhdHNbMl0sIFN0YXRzWzNdLCBTdGF0c1s0XSwgU3RhdHNbNV0sIFN0YXRzWzZdLCBTdGF0c1s3XSwgdGhpcywgX21JZCwgdHJ1ZSk7CiAgICAgICAgbW9uc3RlcklkVG9UcmFkZWFibGVbbW9uc3RlcklkXSA9IHRydWU7CgogICAgICAgIG1vbnN0ZXJJZFRvSVZzW21vbnN0ZXJJZF0gPSBJVnM7CgogICAgICAgIG1vbnN0ZXJBdWN0aW9uLmNyZWF0ZUF1Y3Rpb24obW9uc3RlcklkLCBwcmljZSwgYWRkcmVzcyh0aGlzKSk7CgoKICAgICAgICBnZW4wQ3JlYXRlZENvdW50Kys7CiAgICAgICAgCiAgICB9CgogICAgCn0KCgovLyB1c2VkIGR1cmluZyBsYXVuY2ggZm9yIHdvcmxkIGNoYW1waW9uc2hpcAovLyBjYW4gYW5kIHdpbGwgYmUgdXBncmFkZWQgZHVyaW5nIGRldmVsb3BtZW50IHdpdGggbmV3IGJhdHRsZSBzeXN0ZW0hCi8vIHRoaXMgaXMganVzdCB0byBnaXZlIHBsYXllcnMgc29tZXRoaW5nIHRvIGRvIGFuZCB0ZXN0IHRoZWlyIG1vbnN0ZXJzCi8vIGFsc28gZGVtb25zdHJhdGVzIGhvdyB3ZSBjYW4gYnVpbGQgdXAgbW9yZSBtZWNoYW5pY3Mgb24gdG9wIG9mIG91ciBsb2NrZWQgY29yZSBjb250cmFjdCEKY29udHJhY3QgTW9uc3RlckNoYW1waW9uc2hpcCBpcyBPd25hYmxlIHsKCiAgICBib29sIHB1YmxpYyBpc01vbnN0ZXJDaGFtcGlvbnNoaXAgPSB0cnVlOwogICAgCiAgICBDaGFpbk1vbnN0ZXJzQ29yZSBjb3JlOwogICAgCiAgICAvLyBsaXN0IG9mIHRvcCB0ZW4gCiAgICBhZGRyZXNzWzEwXSB0b3BUZW47CgogICAgLy8gaG9sZHMgdGhlIGFkZHJlc3MgY3VycmVudCAid29ybGQiIGNoYW1waW9uCiAgICBhZGRyZXNzIHB1YmxpYyBjdXJyQ2hhbXBpb247CiAgICAKICAgIAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYWRkcmVzc1RvUG93ZXJsZXZlbDsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHJhbmtUb0FkZHJlc3M7CiAgICAKCiAgIAogICAgCiAgICAKICAgICAvLyB0cnkgdG8gYmVhdCBldmVyeSBvdGhlciBwbGF5ZXIgaW4gdGhlIHRvcDEwIHdpdGggeW91ciBzdHJvbmdlc3QgbW9uc3RlciEKICAgIC8vIGVmZmVjdGl2ZWx5IGxvb3BpbmcgdGhyb3VnaCBhbGwgdG9wMTAgcGxheWVycywgYmVhdGluZyB0aGVtIG9uZSBieSBvbmUgCiAgICAvLyBhbmQgaWYgc3Ryb25nIGVub3VnaCBwbGFjaW5nIHlvdXIgaW4gdGhlIHRvcDEwIGFzIHdlbGwKICAgIGZ1bmN0aW9uIGNvbnRlc3RDaGFtcGlvbih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICAgICAgICAgIHVpbnQgbWF4SW5kZXggPSA5OwogICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBmYWlsIHR4IGlmIHBsYXllciBpcyBhbHJlYWR5IGNoYW1waW9uIQogICAgICAgICAgICAvLyBpbiB0aGVvcnkgcGxheWVycyBjb3VsZCBpbmNyZWFzZSB0aGVpciBwb3dlcmxldmVsIGJ5IGNvbnRlc3RpbmcgdGhlbXNlbHZlcyBidXQKICAgICAgICAgICAgLy8gdGhpcyBjaGVjayBzdG9wcyB0aGF0IGZyb20gaGFwcGVuaW5nIHNvIG90aGVyIHBsYXllcnMgaGF2ZSB0aGUgY2hhbmNlIHRvCiAgICAgICAgICAgIC8vIGJlY29tZSB0aGUgdGVtcG9yYXJ5IGNoYW1waW9uIQogICAgICAgICAgICBpZiAoY3VyckNoYW1waW9uID09IG1zZy5zZW5kZXIpCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICByZXF1aXJlKGNvcmUuaXNUcmFpbmVyKG1zZy5zZW5kZXIpKTsgICAgICAgIAogICAgICAgICAgIHJlcXVpcmUoY29yZS5tb25zdGVySW5kZXhUb093bmVyKF90b2tlbklkKSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgdWludCBteVBvd2VybGV2ZWwgPSBjb3JlLmdldE1vbnN0ZXJQb3dlckxldmVsKF90b2tlbklkKTsKCiAgICAgICAgICAgCiAgICAgICAgICAgLy8gY2hlY2tzIGlmIHRoaXMgdHJhbnNhY3Rpb24gaXMgdXNlbGVzcwogICAgICAgICAgIC8vIHNpbmNlIHdlIGNhbid0IGZpZ2h0IGFnYWluc3Qgb3Vyc2VsZiEKICAgICAgICAgICAvLyBhbHNvIHN0b3BzIHJlZW50cmFuY3kgYXR0YWNrcwogICAgICAgICAgIHJlcXVpcmUobXlQb3dlcmxldmVsID4gYWRkcmVzc1RvUG93ZXJsZXZlbFttc2cuc2VuZGVyXSk7CiAgICAgICAgICAgCiAgICAgICAgICAKICAgICAgICAgICB1aW50IG15UmFuayA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPD1tYXhJbmRleDsgaSsrKSB7CiAgICAgICAgICAgICAgICAvL2lmIChhZGRyZXMpCiAgICAgICAgICAgICAgICBpZiAoIG15UG93ZXJsZXZlbCA+IGFkZHJlc3NUb1Bvd2VybGV2ZWxbdG9wVGVuW2ldXSApIHsKICAgICAgICAgICAgICAgICAgICAvLyB5b3UgaGF2ZSBiZWF0ZW4gdGhpcyBvbmUgc28gaW5jcmVhc2UgdGVtcG9yYXJ5IHJhbmsKICAgICAgICAgICAgICAgICAgICBteVJhbmsgPSBpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChteVJhbmsgPT0gbWF4SW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckNoYW1waW9uID0gbXNnLnNlbmRlcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhZGRyZXNzVG9Qb3dlcmxldmVsW21zZy5zZW5kZXJdID0gbXlQb3dlcmxldmVsOwogICAgICAgICAgICAKICAgICAgICAgICAgYWRkcmVzc1sxMF0gc3RvcmFnZSBuZXdUb3BUZW4gPSB0b3BUZW47CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY3VyckNoYW1waW9uID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgIGZvciAodWludCBqPTA7IGo8bWF4SW5kZXg7IGorKykgewogICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBvdXJzZWx2ZXMgZnJvbSB0aGlzIGxpc3QgaW4gY2FzZSAKICAgICAgICAgICAgICAgICAgICBpZiAobmV3VG9wVGVuW2pdID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3VG9wVGVuW2pdID0gMHgwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKHVpbnQgeD0wOyB4PD1teVJhbms7IHgrKykgewogICAgICAgICAgICAgICAgaWYgKHggPT0gbXlSYW5rKSB7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBuZXdUb3BUZW5beF0gPSBtc2cuc2VuZGVyOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoeCA8IG1heEluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICBuZXdUb3BUZW5beF0gPSB0b3BUZW5beCsxXTsgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgdG9wVGVuID0gbmV3VG9wVGVuOwogICAgICAgICAgICAKICAgICAgICB9CiAgICAKICAgIAogICAgCiAgICBmdW5jdGlvbiBnZXRUb3BQbGF5ZXJzKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICgKICAgICAgICAgICAgYWRkcmVzc1sxMF0gcGxheWVycwogICAgICAgICkgewogICAgICAgICAgICBwbGF5ZXJzID0gdG9wVGVuOwogICAgICAgIH0KICAgIAoKCgogICAgCiAgICAKICAgIAogICAgCiAgICBmdW5jdGlvbiBNb25zdGVyQ2hhbXBpb25zaGlwKGFkZHJlc3MgY29yZUNvbnRyYWN0KSBwdWJsaWMgewogICAgICAgY29yZSA9IENoYWluTW9uc3RlcnNDb3JlKGNvcmVDb250cmFjdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAKICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKGJhbGFuY2UpOwogICAgICAgIAogICAgfQoKCgoKfQoKCi8vIHdoZXJlIHRoZSBub3Qtc28tbXVjaCAiaGlkZGVuIiBtYWdpYyBoYXBwZW5zCmNvbnRyYWN0IE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlIGlzIE93bmFibGUgewoKICAgIHVpbnQ4IHB1YmxpYyBsb2NrZWRNb25zdGVyU3RhdHNDb3VudCA9IDA7CiAgICB1aW50IG5vbmNlID0gMDsKCiAgICBmdW5jdGlvbiByYW5kKHVpbnQ4IG1pbiwgdWludDggbWF4KSBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICBub25jZSsrOwogICAgICAgIHVpbnQ4IHJlc3VsdCA9ICh1aW50OChzaGEzKGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSksIG5vbmNlICkpJW1heCk7CiAgICAgICAgCiAgICAgICAgaWYgKHJlc3VsdCA8IG1pbikKICAgICAgICB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCttaW47CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIAoKCiAgICBmdW5jdGlvbiBzaGlueVJhbmQodWludDE2IG1pbiwgdWludDE2IG1heCkgcHVibGljIHJldHVybnMgKHVpbnQxNikgewogICAgICAgIG5vbmNlKys7CiAgICAgICAgdWludDE2IHJlc3VsdCA9ICh1aW50MTYoc2hhMyhibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpLCBub25jZSApKSVtYXgpOwogICAgICAgIAogICAgICAgIGlmIChyZXN1bHQgPCBtaW4pCiAgICAgICAgewogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQrbWluOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAKICAgIAogICAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQ4WzhdKSBwdWJsaWMgYmFzZVN0YXRzOwoKICAgIGZ1bmN0aW9uIGFkZEJhc2VTdGF0cyh1aW50MjU2IF9tSWQsIHVpbnQ4WzhdIGRhdGEpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgLy8gbG9jayIgdGhlIHN0YXRzIGRvd24gZm9yZXZlcgogICAgICAgIC8vIHNpbmNlIGhwIGlzIG5ldmVyIGdvaW5nIHRvIGJlIDAgdGhpcyBpcyBhIHZhbGlkIGNoZWNrCiAgICAgICAgLy8gc28gd2UgaGF2ZSB0byBiZSBleHRyYSBjYXJlZnVsIHdoZW4gYWRkaW5nIG5ldyBiYXNlU3RhdHMhCiAgICAgICAgcmVxdWlyZShkYXRhWzBdID4gMCk7CiAgICAgICAgcmVxdWlyZShiYXNlU3RhdHNbX21JZF1bMF0gPT0gMCk7CiAgICAgICAgYmFzZVN0YXRzW19tSWRdID0gZGF0YTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2FkZEJhc2VTdGF0cyh1aW50MjU2IF9tSWQsIHVpbnQ4WzhdIGRhdGEpIGludGVybmFsIHsKICAgICAgICAKICAgICAgICAKICAgICAgICBiYXNlU3RhdHNbX21JZF0gPSBkYXRhOwogICAgICAgIGxvY2tlZE1vbnN0ZXJTdGF0c0NvdW50Kys7CiAgICB9CgoKICAgIAoKCiAgICAKICAgIGZ1bmN0aW9uIE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlKCkgcHVibGljIHsKICAgICAgICAKICAgICAgIC8vIHRoZXNlIG1vbnN0ZXJzIGFyZSBhbHJlYWR5IGRvd24gYW5kICJsb2NrZWQiIGRvd24gc3RhdHMvZGVzaWduIHdpc2UKICAgICAgICBfYWRkQmFzZVN0YXRzKDEsIFs0NSwgNDksIDQ5LCA2NSwgNjUsIDQ1LCAxMiwgNF0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoMiwgWzYwLCA2MiwgNjMsIDgwLCA4MCwgNjAsIDEyLCA0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cygzLCBbODAsIDgyLCA4MywgMTAwLCAxMDAsIDgwLCAxMiwgNF0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoNCwgWzM5LCA1MiwgNDMsIDYwLCA1MCwgNjUsIDEwLCA2XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg1LCBbNTgsIDY0LCA1OCwgODAsIDY1LCA4MCwgMTAsIDZdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDYsIFs3OCwgODQsIDc4LCAxMDksIDg1LCAxMDAsIDEwLCA2XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg3LCBbNDQsIDQ4LCA2NSwgNTAsIDY0LCA0MywgMTEsIDE0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg4LCBbNTksIDYzLCA4MCwgNjUsIDgwLCA1OCwgMTEsIDE0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg5LCBbNzksIDgzLCAxMDAsIDg1LCAxMDUsIDc4LCAxMSwgMTRdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDEwLCBbNDAsIDM1LCAzMCwgMjAsIDIwLCA1MCwgNywgNF0pOwogICAgICAgIAogICAgICAgIF9hZGRCYXNlU3RhdHMoMTQ5LCBbNTUsIDUwLCA0NSwgMTM1LCA5NSwgMTIwLCA4LCAxNF0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoMTUwLCBbOTEsIDEzNCwgOTUsIDEwMCwgMTAwLCA4MCwgMiwgNV0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoMTUxLCBbMTAwLCAxMDAsIDEwMCwgMTAwLCAxMDAsIDEwMCwgNSwgMTldKTsKICAgIH0KICAgIAogICAgLy8gdGhpcyBzZXJ2ZXMgYXMgYSBsb29rdXAgZm9yIG5ldyBtb25zdGVycyB0byBiZSBnZW5lcmF0ZWQgc2luY2UgYWxsIG1vbnN0ZXJzIAogICAgLy8gb2YgdGhlIHNhbWUgaWQgc2hhcmUgdGhlIGJhc2Ugc3RhdHMKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJTdGF0cyggdWludDI1NiBfbUlEKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQ4WzhdIHN0YXRzKSB7CiAgICAgICAgICAgc3RhdHNbMF0gPSBiYXNlU3RhdHNbX21JRF1bMF07CiAgICAgICAgICAgc3RhdHNbMV0gPSBiYXNlU3RhdHNbX21JRF1bMV07CiAgICAgICAgICAgc3RhdHNbMl0gPSBiYXNlU3RhdHNbX21JRF1bMl07CiAgICAgICAgICAgc3RhdHNbM10gPSBiYXNlU3RhdHNbX21JRF1bM107CiAgICAgICAgICAgc3RhdHNbNF0gPSBiYXNlU3RhdHNbX21JRF1bNF07CiAgICAgICAgICAgc3RhdHNbNV0gPSBiYXNlU3RhdHNbX21JRF1bNV07CiAgICAgICAgICAgc3RhdHNbNl0gPSBiYXNlU3RhdHNbX21JRF1bNl07CiAgICAgICAgICAgc3RhdHNbN10gPSBiYXNlU3RhdHNbX21JRF1bN107CiAgICAgICAgICAgCiAgICAgICAgICAKCiAgICAgICAgfQoKICAgICAgICAvLyBnZW5lcmF0ZXMgcmFuZG9taXplZCBJVnMgZm9yIGEgbmV3IG1vbnN0ZXIKICAgICAgICBmdW5jdGlvbiBnZXRNb25zdGVySVZzKCkgZXh0ZXJuYWwgcmV0dXJucyh1aW50OFs3XSBpdnMpIHsKCiAgICAgICAgICAgIGJvb2wgc2hpbnkgPSBmYWxzZTsKCiAgICAgICAgICAgIHVpbnQxNiBjaGFuY2UgPSBzaGlueVJhbmQoMSwgODE5Mik7CgogICAgICAgICAgICBpZiAoY2hhbmNlID09IDQyKSB7CiAgICAgICAgICAgICAgICBzaGlueSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIElWcyByYW5nZSBiZXR3ZWVuIDAgYW5kIDMxCiAgICAgICAgICAgIC8vIHN0YXQgcmFuZ2UgbW9kaWZpZWQgZm9yIHNoaW55IG1vbnN0ZXJzIQogICAgICAgICAgICBpZiAoc2hpbnkgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgaXZzWzBdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1sxXSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMl0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzNdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s0XSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNV0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzZdID0gMTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXZzWzBdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzFdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzJdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzNdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzRdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzVdID0gdWludDgocmFuZCgwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzZdID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgCgogICAgICAgIH0KCgogICAgICAgIC8vIGdlbjAgbW9uc3RlcnMgcHJvZml0IGZyb20gc2hpbnkgYm9vc3Qgd2hpbGUgc2hpbnkgZ2VuMHMgaGF2ZSBwb3RlbnRpYWxseSBldmVuIGhpZ2hlciBJVnMhCiAgICAgICAgLy8gZnVydGhlciBpbmNyZWFzaW5nIHRoZSByYXJpdHkgYnkgYWxzbyBkb3VibGluZyB0aGUgc2hpbnkgY2hhbmNlIQogICAgICAgIGZ1bmN0aW9uIGdldEdlbjBJVnMoKSBleHRlcm5hbCByZXR1cm5zICh1aW50OFs3XSBpdnMpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIGJvb2wgc2hpbnkgPSBmYWxzZTsKCiAgICAgICAgICAgIHVpbnQxNiBjaGFuY2UgPSBzaGlueVJhbmQoMSwgNDA5Nik7CgogICAgICAgICAgICBpZiAoY2hhbmNlID09IDQyKSB7CiAgICAgICAgICAgICAgICBzaGlueSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChzaGlueSkgewogICAgICAgICAgICAgICAgIGl2c1swXSA9IHVpbnQ4KHJhbmQoMTUsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMV0gPSB1aW50OChyYW5kKDE1LCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzJdID0gdWludDgocmFuZCgxNSwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1szXSA9IHVpbnQ4KHJhbmQoMTUsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNF0gPSB1aW50OChyYW5kKDE1LCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzVdID0gdWludDgocmFuZCgxNSwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s2XSA9IDE7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGl2c1swXSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMV0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzJdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1szXSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNF0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzVdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s2XSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAKICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKGJhbGFuY2UpOwogICAgICAgIAogICAgfQp9Cgpjb250cmFjdCBHYW1lTG9naWNDb250cmFjdCB7CiAgICAKICAgIGJvb2wgcHVibGljIGlzR2FtZUxvZ2ljQ29udHJhY3QgPSB0cnVlOwogICAgCiAgICBmdW5jdGlvbiBHYW1lTG9naWNDb250cmFjdCgpIHB1YmxpYyB7CiAgICAgICAgCiAgICB9Cn0KCmNvbnRyYWN0IENoYWluTW9uc3RlcnNDb3JlIGlzIENoYWluTW9uc3RlcnNBdWN0aW9uLCBPd25hYmxlIHsKCgogICAvLyB1c2luZyBhIGJvb2wgdG8gZW5hYmxlIHVzIHRvIHByZXBhcmUgdGhlIGdhbWUgCiAgIGJvb2wgaGFzTGF1bmNoZWQgPSBmYWxzZTsKCgogICAgLy8gdGhpcyBhZGRyZXNzIHdpbGwgaG9sZCBmdXR1cmUgZ2FtZWxvZ2ljIGluIHBsYWNlCiAgICBhZGRyZXNzIGdhbWVDb250cmFjdDsKICAgIAoKICAgIGZ1bmN0aW9uIENoYWluTW9uc3RlcnNDb3JlKCkgcHVibGljIHsKCiAgICAgICAgYWRtaW5BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICAKCiAgICAgICAgX2NyZWF0ZUFyZWEoKTsgLy8gYXJlYSAxCiAgICAgICAgX2NyZWF0ZUFyZWEoKTsgLy8gYXJlYSAyCiAgICAgICAgCiAgICAKCiAgICAgICAgCiAgICB9CiAgICAKICAgIC8vIHdlIGRvbid0IGtub3cgdGhlIGV4YWN0IGludGVyZmFjZXMgeWV0IHNvIHVzZSB0aGUgbG9ja2VkTW9uc3RlclN0YXRzIHZhbHVlIHRvIGRldGVybWluZSBpZiB0aGUgZ2FtZSBpcyAicmVhZHkiCiAgICAvLyBzZWUgV2hpdGVQYXBlciBmb3IgZXhwbGFpbmF0aW9uIGZvciBvdXIgdXBncmFkZSBhbmQgZGV2ZWxvcG1lbnQgcm9hZG1hcAogICAgZnVuY3Rpb24gc2V0R2FtZUxvZ2ljQ29udHJhY3QoYWRkcmVzcyBfY2FuZGlkYXRlQ29udHJhY3QpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtb25zdGVyQ3JlYXRvci5sb2NrZWRNb25zdGVyU3RhdHNDb3VudCgpID09IDE1MSk7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShHYW1lTG9naWNDb250cmFjdChfY2FuZGlkYXRlQ29udHJhY3QpLmlzR2FtZUxvZ2ljQ29udHJhY3QoKSk7CiAgICAgICAgZ2FtZUNvbnRyYWN0ID0gX2NhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vIG9ubHkgY2FsbGFibGUgYnkgZ2FtZUNvbnRyYWN0IGFmdGVyIHRoZSBmdWxsIGdhbWUgaXMgbGF1bmNoZWQKICAgIC8vIHNpbmNlIGFsbCBhZGRpdGlvbmFsIG1vbnN0ZXJzIGFmdGVyIHRoZSBwcm9tby9nZW4wIG9uZXMgbmVlZCB0byB1c2UgdGhpcyBjb3JlQ29udHJhY3QKICAgIC8vIGNvbnRyYWN0IGFzIHdlbGwgd2UgaGF2ZSB0byBwcmVwYXJlIHRoaXMgY29yZSBmb3Igb3VyIGZ1dHVyZSB1cGRhdGVzIHdoZXJlCiAgICAvLyBwbGF5ZXJzIGNhbiBmcmVlbHkgcm9hbSB0aGUgd29ybGQgYW5kIGh1bnQgQ2hhaW5Nb25zdGVycyB0aHVzIGdlbmVyYXRpbmcgbW9yZQogICAgZnVuY3Rpb24gc3Bhd25Nb25zdGVyKHVpbnQyNTYgX21JZCwgYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHsKICAgICAgICAgCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGdhbWVDb250cmFjdCk7CiAgICAgICAgCiAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKHVpbnQyNTYoX21JZCkpKTsKICAgICAgICB1aW50OFs3XSBtZW1vcnkgSVZzID0gdWludDhbN10obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlcklWcygpKTsKICAgICAgICAKICAgICAgICAvLyBpbXBvcnRhbnQgdG8gbm90ZSB0aGF0IHRoZSBJViBnZW5lcmF0b3JzIGRvIG5vdCB1c2UgR2VuMCBtZXRob2RzIGFuZCBhcmUgR2VuZXJhdGlvbiAxIAogICAgICAgIC8vIHRoaXMgbWVhbnMgdGhlcmUgd29uJ3QgYmUgbW9yZSB0aGFuIHRoZSAxMCwwMDAgR2VuMCBtb25zdGVycyBzb2xkIGR1cmluZyB0aGUgZGV2ZWxvcG1lbnQgdGhyb3VnaCB0aGUgbWFya2V0cGxhY2UKICAgICAgICB1aW50MjU2IG1vbnN0ZXJJZCA9IF9jcmVhdGVNb25zdGVyKDEsIFN0YXRzWzBdLCBTdGF0c1sxXSwgU3RhdHNbMl0sIFN0YXRzWzNdLCBTdGF0c1s0XSwgU3RhdHNbNV0sIFN0YXRzWzZdLCBTdGF0c1s3XSwgX293bmVyLCBfbUlkLCB0cnVlKTsKICAgICAgICBtb25zdGVySWRUb1RyYWRlYWJsZVttb25zdGVySWRdID0gdHJ1ZTsKCiAgICAgICAgbW9uc3RlcklkVG9JVnNbbW9uc3RlcklkXSA9IElWczsKICAgIH0KICAgIAogICAgCiAgICAvLyB1c2VkIHRvIGFkZCBwbGF5YWJsZSBjb250ZW50IHRvIHRoZSBnYW1lIAogICAgLy8gbW9uc3RlcnMgd2lsbCBvbmx5IHNwYXduIGluIGNlcnRhaW4gYXJlYXMgc28gc29tZSBhcmUgbG9ja2VkIG9uIHJlbGVhc2UKICAgIC8vIGR1ZSB0byB0aGUgZ2FtZSBiZWluZyBpbiBhY3RpdmUgZGV2ZWxvcG1lbnQgb24gImxhdW5jaCIKICAgIC8vIGVhY2ggbW9uc3RlciBoYXMgYSBtYXhpbXVtIG51bWJlciBvZiAzIGFyZWFzIHdoZXJlIGl0IGNhbiBhcHBlYXIKICAgIC8vIAogICAgIGZ1bmN0aW9uIGNyZWF0ZUFyZWEoKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICAgICAgX2NyZWF0ZUFyZWEoKTsKICAgICAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlVHJhaW5lcihzdHJpbmcgX3VzZXJuYW1lLCB1aW50MTYgX3N0YXJ0ZXJJZCkgcHVibGljIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlcXVpcmUoaGFzTGF1bmNoZWQpOwoKICAgICAgICAgICAgLy8gb25seSBvbmUgdHJhaW5lci9hY2NvdW50IHBlciBldGhlcmV1bSBhZGRyZXNzCiAgICAgICAgICAgIHJlcXVpcmUoYWRkcmVzc1RvVHJhaW5lclttc2cuc2VuZGVyXS5vd25lciA9PSAwKTsKICAgICAgICAgICAKICAgICAgICAgICAvLyB2YWxpZCBpbnB1dCBjaGVjawogICAgICAgICAgICByZXF1aXJlKF9zdGFydGVySWQgPT0gMSB8fCBfc3RhcnRlcklkID09IDIgfHwgX3N0YXJ0ZXJJZCA9PSAzICk7CiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50MjU2IG1vbiA9IF9jcmVhdGVUcmFpbmVyKF91c2VybmFtZSwgX3N0YXJ0ZXJJZCwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBkdWUgdG8gc3RhY2sgbGltaXRhdGlvbnMgd2UgaGF2ZSB0byBhc3NpZ24gdGhlIElWcyBoZXJlOgogICAgICAgICAgICB1aW50OFs3XSBtZW1vcnkgSVZzID0gdWludDhbN10obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlcklWcygpKTsKICAgICAgICAgICAgbW9uc3RlcklkVG9JVnNbbW9uXSA9IElWczsKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgZnVuY3Rpb24gY2hhbmdlVXNlcm5hbWUoc3RyaW5nIF9uYW1lKSBwdWJsaWMgewogICAgICAgICAgICByZXF1aXJlKGFkZHJlc3NUb1RyYWluZXJbbXNnLnNlbmRlcl0ub3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgYWRkcmVzc1RvVHJhaW5lclttc2cuc2VuZGVyXS51c2VybmFtZSA9IF9uYW1lOwogICAgICAgIH0KICAgICAgICAKICAgIGZ1bmN0aW9uIGNoYW5nZU1vbnN0ZXJOaWNrbmFtZSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX25hbWUpIHB1YmxpYyB7CiAgICAgICAgICAgIC8vIHVzZXJzIHdvbid0IGJlIGFibGUgdG8gcmVuYW1lIGEgbW9uc3RlciB0aGF0IGlzIHBhcnQgb2YgYW4gYXVjdGlvbgogICAgICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gc29tZSBzdHJpbmcgY2hlY2tzLi4uPwogICAgICAgICAgICBtb25zdGVySWRUb05pY2tuYW1lW190b2tlbklkXSA9IF9uYW1lOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBtb3ZlVG9BcmVhKHVpbnQxNiBfbmV3QXJlYSkgcHVibGljIHsKICAgICAgICAgICAKICAgICAgICAgICAgLy8gbmV2ZXIgYWxsb3cgYW55b25lIHRvIG1vdmUgdG8gYXJlYSAwIG9yIGJlbG93IHNpbmNlIHRoaXMgaXMgdXNlZAogICAgICAgICAgICAvLyB0byBkZXRlcm1pbmUgaWYgYSB0cmFpbmVyIHByb2ZpbGUgZXhpc3RzIGluIGFub3RoZXIgbWV0aG9kIQogICAgICAgICAgICByZXF1aXJlKF9uZXdBcmVhID4gMCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGlzIGFyZWEgZXhpc3RzIHlldCEKICAgICAgICAgICAgcmVxdWlyZShhcmVhcy5sZW5ndGggPj0gX25ld0FyZWEpOwogICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHdoZW4gcGxheWVyIGlzIG5vdCBzdHVjayBkb2luZyBzb21ldGhpbmcgZWxzZSBoZSBjYW4gbW92ZSBmcmVlbHkhCiAgICAgICAgICAgIF9tb3ZlVG9BcmVhKF9uZXdBcmVhLCBtc2cuc2VuZGVyKTsKICAgICAgICB9CgogICAgCiAgICAvLyB0byBiZSBjaGFuZ2VkIHRvIHJldHJpZXZlIGN1cnJlbnQgc3RhdHMhCiAgICBmdW5jdGlvbiBnZXRNb25zdGVyKHVpbnQyNTYgX2lkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIHVpbnQyNTYgYmlydGhUaW1lLAogICAgICAgIHVpbnQyNTYgZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IGhwLAogICAgICAgIHVpbnQyNTYgYXR0YWNrLAogICAgICAgIHVpbnQyNTYgZGVmZW5zZSwKICAgICAgICB1aW50MjU2IHNwQXR0YWNrLAogICAgICAgIHVpbnQyNTYgc3BEZWZlbnNlLAogICAgICAgIHVpbnQyNTYgc3BlZWQsCiAgICAgICAgdWludDI1NiB0eXBlT25lLAogICAgICAgIHVpbnQyNTYgdHlwZVR3bywKICAgICAgICAKICAgICAgICB1aW50MjU2IG1JRCwKICAgICAgICBib29sIHRyYWRlYWJsZSwgCiAgICAgICAgdWludDI1NiB1SUQKICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgKSB7ICAgIAogICAgICAgTW9uc3RlciBzdG9yYWdlIG1vbiA9IG1vbnN0ZXJzW19pZF07CiAgICAgICAgYmlydGhUaW1lID0gdWludDI1Nihtb24uYmlydGhUaW1lKTsKICAgICAgICBnZW5lcmF0aW9uID0gMDsgLy8gaGFyZGNvZGluZyBkdWUgdG8gc3RhY2sgdG9vIGRlZXAgZXJyb3IKICAgICAgICBocCA9IHVpbnQyNTYobW9uLmhwKTsKICAgICAgICBhdHRhY2sgPSB1aW50MjU2KG1vbi5hdHRhY2spOwogICAgICAgIGRlZmVuc2UgPSB1aW50MjU2KG1vbi5kZWZlbnNlKTsKICAgICAgICBzcEF0dGFjayA9IHVpbnQyNTYobW9uLnNwQXR0YWNrKTsKICAgICAgICBzcERlZmVuc2UgPSB1aW50MjU2KG1vbi5zcERlZmVuc2UpOwogICAgICAgIHNwZWVkID0gdWludDI1Nihtb24uc3BlZWQpOwogICAgICAgIHR5cGVPbmUgPSB1aW50MjU2KG1vbi50eXBlT25lKTsKICAgICAgICB0eXBlVHdvID0gdWludDI1Nihtb24udHlwZVR3byk7CiAgICAgICAgbUlEID0gdWludDI1Nihtb24ubUlEKTsKICAgICAgICB0cmFkZWFibGUgPSBib29sKG1vbi50cmFkZWFibGUpOwogICAgICAgIAogICAgICAgIC8vIGhhY2sgdG8gb3ZlcmNvbWUgc29saWRpdHkncyBzdGFjayBsaW1pdGF0aW9uIGluIG1vbnN0ZXIgc3RydWN0Li4uLgogICAgICAgIHVJRCA9IF9pZDsKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIHRoaXMgbWV0aG9kIG9ubHkgcmV0dXJucyB0aGUgImJhc2UiIHBvd2VybGV2ZWwgb2YgYSBtb25zdGVyIHdoaWNoIHdpbGwgYmUgdXNlZAogICAgICAgIC8vIGluIG1vcmUgYWR2YW5jZWQgZmlnaHRpbmcgY2FsY3VsYXRpb25zIGxhdGVyIG9uCiAgICBmdW5jdGlvbiBnZXRNb25zdGVyUG93ZXJMZXZlbCh1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgICAgICB1aW50MjU2IHBvd2VybGV2ZWwKICAgICAgICApIHsKICAgICAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1vbiA9IG1vbnN0ZXJzW190b2tlbklkXTsKICAgICAgICAgICAgdWludDhbN10gc3RvcmFnZSBJVnMgPSBtb25zdGVySWRUb0lWc1tfdG9rZW5JZF07CgogICAgICAgICAgICAKICAgICAgICAgICAgcG93ZXJsZXZlbCA9IG1vbi5ocCArIElWc1swXSArIG1vbi5hdHRhY2sgKyBJVnNbMV0gKyBtb24uZGVmZW5zZSArIElWc1syXSArIG1vbi5zcEF0dGFjayArIElWc1szXSArIG1vbi5zcERlZmVuc2UgKyBJVnNbNF0gKyBtb24uc3BlZWQgKyBJVnNbNV07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIAoKICAgCiAgICAKICAgIGZ1bmN0aW9uIGlzVHJhaW5lcihhZGRyZXNzIF9jaGVjaykKICAgIGV4dGVybmFsIAogICAgdmlldyAKICAgIHJldHVybnMgKAogICAgICAgIGJvb2wgaXNUcmFpbmVyCiAgICApIHsKICAgICAgICBUcmFpbmVyIHN0b3JhZ2UgdHJhaW5lciA9IGFkZHJlc3NUb1RyYWluZXJbX2NoZWNrXTsKCiAgICAgICAgaWYgKHRyYWluZXIuY3VyckFyZWEgPiAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgCgogICAgCiAgIAogICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAKICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKGJhbGFuY2UpOwogICAgICAgIAogICAgfQoKICAgIC8vIGFmdGVyIHdlIGhhdmUgc2V0dXAgZXZlcnl0aGluZyB3ZSBjYW4gdW5sb2NrIHRoZSBnYW1lCiAgICAvLyBmb3IgcHVibGljCiAgICBmdW5jdGlvbiBsYXVuY2hHYW1lKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBoYXNMYXVuY2hlZCA9IHRydWU7CiAgICB9Cn0='.
	

]
