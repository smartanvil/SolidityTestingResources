Class {
	#name : #SRTd4fd252d7d2c9479a8d616f510eac6243b5dddf9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd4fd252d7d2c9479a8d616f510eac6243b5dddf9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTQ7CgovKgoKICBDb3B5cmlnaHQgMjAxNyBaZXJvRXggSW50bC4KCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoKICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgoqLwoKY29udHJhY3QgVG9rZW4gewoKICAgIC8vLyBAcmV0dXJuIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCBzdXBwbHkpIHt9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7fQoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHt9CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7fQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX2FkZHJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2Ygd2VpIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHt9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHt9CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKfQoKLyoKICogT3duYWJsZQogKgogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuCiAqIFByb3ZpZGVzIG9ubHlPd25lciBtb2RpZmllciwgd2hpY2ggcHJldmVudHMgZnVuY3Rpb24gZnJvbSBydW5uaW5nIGlmIGl0IGlzIGNhbGxlZCBieSBhbnlvbmUgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAqLwoKY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICAgICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50IGMgPSBhIC8gYjsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KfQoKLy8vIEB0aXRsZSBUb2tlblRyYW5zZmVyUHJveHkgLSBUcmFuc2ZlcnMgdG9rZW5zIG9uIGJlaGFsZiBvZiBjb250cmFjdHMgdGhhdCBoYXZlIGJlZW4gYXBwcm92ZWQgdmlhIGRlY2VudHJhbGl6ZWQgZ292ZXJuYW5jZS4KLy8vIEBhdXRob3IgQW1pciBCYW5kZWFsaSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjUyMzMzZjNiMjAxMjYyMmEwMjIwM2QzODM3MzEyNjdjMzEzZDNmIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4sIFdpbGwgV2FycmVuIC0gPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNjUxMjBjMDkwOTI1NTUxZDM1MTcwYTBmMDAwNjExNGIwNjBhMDgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+Pgpjb250cmFjdCBUb2tlblRyYW5zZmVyUHJveHkgaXMgT3duYWJsZSB7CgogICAgLy8vIEBkZXYgT25seSBhdXRob3JpemVkIGFkZHJlc3NlcyBjYW4gaW52b2tlIGZ1bmN0aW9ucyB3aXRoIHRoaXMgbW9kaWZpZXIuCiAgICBtb2RpZmllciBvbmx5QXV0aG9yaXplZCB7CiAgICAgICAgcmVxdWlyZShhdXRob3JpemVkW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHRhcmdldEF1dGhvcml6ZWQoYWRkcmVzcyB0YXJnZXQpIHsKICAgICAgICByZXF1aXJlKGF1dGhvcml6ZWRbdGFyZ2V0XSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB0YXJnZXROb3RBdXRob3JpemVkKGFkZHJlc3MgdGFyZ2V0KSB7CiAgICAgICAgcmVxdWlyZSghYXV0aG9yaXplZFt0YXJnZXRdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGF1dGhvcml6ZWQ7CiAgICBhZGRyZXNzW10gcHVibGljIGF1dGhvcml0aWVzOwoKICAgIGV2ZW50IExvZ0F1dGhvcml6ZWRBZGRyZXNzQWRkZWQoYWRkcmVzcyBpbmRleGVkIHRhcmdldCwgYWRkcmVzcyBpbmRleGVkIGNhbGxlcik7CiAgICBldmVudCBMb2dBdXRob3JpemVkQWRkcmVzc1JlbW92ZWQoYWRkcmVzcyBpbmRleGVkIHRhcmdldCwgYWRkcmVzcyBpbmRleGVkIGNhbGxlcik7CgogICAgLyoKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IEF1dGhvcml6ZXMgYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdGFyZ2V0IEFkZHJlc3MgdG8gYXV0aG9yaXplLgogICAgZnVuY3Rpb24gYWRkQXV0aG9yaXplZEFkZHJlc3MoYWRkcmVzcyB0YXJnZXQpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgdGFyZ2V0Tm90QXV0aG9yaXplZCh0YXJnZXQpCiAgICB7CiAgICAgICAgYXV0aG9yaXplZFt0YXJnZXRdID0gdHJ1ZTsKICAgICAgICBhdXRob3JpdGllcy5wdXNoKHRhcmdldCk7CiAgICAgICAgTG9nQXV0aG9yaXplZEFkZHJlc3NBZGRlZCh0YXJnZXQsIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IFJlbW92ZXMgYXV0aG9yaXppb24gb2YgYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdGFyZ2V0IEFkZHJlc3MgdG8gcmVtb3ZlIGF1dGhvcml6YXRpb24gZnJvbS4KICAgIGZ1bmN0aW9uIHJlbW92ZUF1dGhvcml6ZWRBZGRyZXNzKGFkZHJlc3MgdGFyZ2V0KQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgICAgIHRhcmdldEF1dGhvcml6ZWQodGFyZ2V0KQogICAgewogICAgICAgIGRlbGV0ZSBhdXRob3JpemVkW3RhcmdldF07CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXV0aG9yaXRpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGF1dGhvcml0aWVzW2ldID09IHRhcmdldCkgewogICAgICAgICAgICAgICAgYXV0aG9yaXRpZXNbaV0gPSBhdXRob3JpdGllc1thdXRob3JpdGllcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGF1dGhvcml0aWVzLmxlbmd0aCAtPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgTG9nQXV0aG9yaXplZEFkZHJlc3NSZW1vdmVkKHRhcmdldCwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsbHMgaW50byBFUkMyMCBUb2tlbiBjb250cmFjdCwgaW52b2tpbmcgdHJhbnNmZXJGcm9tLgogICAgLy8vIEBwYXJhbSB0b2tlbiBBZGRyZXNzIG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBmcm9tIEFkZHJlc3MgdG8gdHJhbnNmZXIgdG9rZW4gZnJvbS4KICAgIC8vLyBAcGFyYW0gdG8gQWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbiB0by4KICAgIC8vLyBAcGFyYW0gdmFsdWUgQW1vdW50IG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgLy8vIEByZXR1cm4gU3VjY2VzcyBvZiB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIHRva2VuLAogICAgICAgIGFkZHJlc3MgZnJvbSwKICAgICAgICBhZGRyZXNzIHRvLAogICAgICAgIHVpbnQgdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUF1dGhvcml6ZWQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBUb2tlbih0b2tlbikudHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgICB9CgogICAgLyoKICAgICAqIFB1YmxpYyBjb25zdGFudCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8vLyBAZGV2IEdldHMgYWxsIGF1dGhvcml6ZWQgYWRkcmVzc2VzLgogICAgLy8vIEByZXR1cm4gQXJyYXkgb2YgYXV0aG9yaXplZCBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRBdXRob3JpemVkQWRkcmVzc2VzKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSkKICAgIHsKICAgICAgICByZXR1cm4gYXV0aG9yaXRpZXM7CiAgICB9Cn0KCi8vLyBAdGl0bGUgRXhjaGFuZ2UgLSBGYWNpbGl0YXRlcyBleGNoYW5nZSBvZiBFUkMyMCB0b2tlbnMuCi8vLyBAYXV0aG9yIEFtaXIgQmFuZGVhbGkgLSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI0MzIyMmUyYTMxMDM3MzNiMTMzMTJjMjkyNjIwMzc2ZDIwMmMyZSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LCBXaWxsIFdhcnJlbiAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImVhOWQ4Mzg2ODZhYWRhOTJiYTk4ODU4MDhmODk5ZWM0ODk4NTg3Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KY29udHJhY3QgRXhjaGFuZ2UgaXMgU2FmZU1hdGggewoKICAgIC8vIEVycm9yIENvZGVzCiAgICBlbnVtIEVycm9ycyB7CiAgICAgICAgT1JERVJfRVhQSVJFRCwgICAgICAgICAgICAgICAgICAgIC8vIE9yZGVyIGhhcyBhbHJlYWR5IGV4cGlyZWQKICAgICAgICBPUkRFUl9GVUxMWV9GSUxMRURfT1JfQ0FOQ0VMTEVELCAgLy8gT3JkZXIgaGFzIGFscmVhZHkgYmVlbiBmdWxseSBmaWxsZWQgb3IgY2FuY2VsbGVkCiAgICAgICAgUk9VTkRJTkdfRVJST1JfVE9PX0xBUkdFLCAgICAgICAgIC8vIFJvdW5kaW5nIGVycm9yIHRvbyBsYXJnZQogICAgICAgIElOU1VGRklDSUVOVF9CQUxBTkNFX09SX0FMTE9XQU5DRSAvLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSBvciBhbGxvd2FuY2UgZm9yIHRva2VuIHRyYW5zZmVyCiAgICB9CgogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBWRVJTSU9OID0gIjEuMC4wIjsKICAgIHVpbnQxNiBjb25zdGFudCBwdWJsaWMgRVhURVJOQUxfUVVFUllfR0FTX0xJTUlUID0gNDk5OTsgICAgLy8gQ2hhbmdlcyB0byBzdGF0ZSByZXF1aXJlIGF0IGxlYXN0IDUwMDAgZ2FzCgogICAgYWRkcmVzcyBwdWJsaWMgWlJYX1RPS0VOX0NPTlRSQUNUOwogICAgYWRkcmVzcyBwdWJsaWMgVE9LRU5fVFJBTlNGRVJfUFJPWFlfQ09OVFJBQ1Q7CgogICAgLy8gTWFwcGluZ3Mgb2Ygb3JkZXJIYXNoID0+IGFtb3VudHMgb2YgdGFrZXJUb2tlbkFtb3VudCBmaWxsZWQgb3IgY2FuY2VsbGVkLgogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwdWJsaWMgZmlsbGVkOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwdWJsaWMgY2FuY2VsbGVkOwoKICAgIGV2ZW50IExvZ0ZpbGwoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIG1ha2VyLAogICAgICAgIGFkZHJlc3MgdGFrZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIGZlZVJlY2lwaWVudCwKICAgICAgICBhZGRyZXNzIG1ha2VyVG9rZW4sCiAgICAgICAgYWRkcmVzcyB0YWtlclRva2VuLAogICAgICAgIHVpbnQgZmlsbGVkTWFrZXJUb2tlbkFtb3VudCwKICAgICAgICB1aW50IGZpbGxlZFRha2VyVG9rZW5BbW91bnQsCiAgICAgICAgdWludCBwYWlkTWFrZXJGZWUsCiAgICAgICAgdWludCBwYWlkVGFrZXJGZWUsCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIHRva2VucywgLy8ga2VjY2FrMjU2KG1ha2VyVG9rZW4sIHRha2VyVG9rZW4pLCBhbGxvd3Mgc3Vic2NyaWJpbmcgdG8gYSB0b2tlbiBwYWlyCiAgICAgICAgYnl0ZXMzMiBvcmRlckhhc2gKICAgICk7CgogICAgZXZlbnQgTG9nQ2FuY2VsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBtYWtlciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgZmVlUmVjaXBpZW50LAogICAgICAgIGFkZHJlc3MgbWFrZXJUb2tlbiwKICAgICAgICBhZGRyZXNzIHRha2VyVG9rZW4sCiAgICAgICAgdWludCBjYW5jZWxsZWRNYWtlclRva2VuQW1vdW50LAogICAgICAgIHVpbnQgY2FuY2VsbGVkVGFrZXJUb2tlbkFtb3VudCwKICAgICAgICBieXRlczMyIGluZGV4ZWQgdG9rZW5zLAogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoCiAgICApOwoKICAgIGV2ZW50IExvZ0Vycm9yKHVpbnQ4IGluZGV4ZWQgZXJyb3JJZCwgYnl0ZXMzMiBpbmRleGVkIG9yZGVySGFzaCk7CgogICAgc3RydWN0IE9yZGVyIHsKICAgICAgICBhZGRyZXNzIG1ha2VyOwogICAgICAgIGFkZHJlc3MgdGFrZXI7CiAgICAgICAgYWRkcmVzcyBtYWtlclRva2VuOwogICAgICAgIGFkZHJlc3MgdGFrZXJUb2tlbjsKICAgICAgICBhZGRyZXNzIGZlZVJlY2lwaWVudDsKICAgICAgICB1aW50IG1ha2VyVG9rZW5BbW91bnQ7CiAgICAgICAgdWludCB0YWtlclRva2VuQW1vdW50OwogICAgICAgIHVpbnQgbWFrZXJGZWU7CiAgICAgICAgdWludCB0YWtlckZlZTsKICAgICAgICB1aW50IGV4cGlyYXRpb25UaW1lc3RhbXBJblNlYzsKICAgICAgICBieXRlczMyIG9yZGVySGFzaDsKICAgIH0KCiAgICBmdW5jdGlvbiBFeGNoYW5nZShhZGRyZXNzIF96cnhUb2tlbiwgYWRkcmVzcyBfdG9rZW5UcmFuc2ZlclByb3h5KSB7CiAgICAgICAgWlJYX1RPS0VOX0NPTlRSQUNUID0gX3pyeFRva2VuOwogICAgICAgIFRPS0VOX1RSQU5TRkVSX1BST1hZX0NPTlRSQUNUID0gX3Rva2VuVHJhbnNmZXJQcm94eTsKICAgIH0KCiAgICAvKgogICAgKiBDb3JlIGV4Y2hhbmdlIGZ1bmN0aW9ucwogICAgKi8KCiAgICAvLy8gQGRldiBGaWxscyB0aGUgaW5wdXQgb3JkZXIuCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXIsIHRha2VyLCBtYWtlclRva2VuLCB0YWtlclRva2VuLCBhbmQgZmVlUmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyVG9rZW5BbW91bnQsIHRha2VyVG9rZW5BbW91bnQsIG1ha2VyRmVlLCB0YWtlckZlZSwgZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjLCBhbmQgc2FsdC4KICAgIC8vLyBAcGFyYW0gZmlsbFRha2VyVG9rZW5BbW91bnQgRGVzaXJlZCBhbW91bnQgb2YgdGFrZXJUb2tlbiB0byBmaWxsLgogICAgLy8vIEBwYXJhbSBzaG91bGRUaHJvd09uSW5zdWZmaWNpZW50QmFsYW5jZU9yQWxsb3dhbmNlIFRlc3QgaWYgdHJhbnNmZXIgd2lsbCBmYWlsIGJlZm9yZSBhdHRlbXB0aW5nLgogICAgLy8vIEBwYXJhbSB2IEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXIgdi4KICAgIC8vLyBAcGFyYW0gciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyByLgogICAgLy8vIEBwYXJhbSBzIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICAvLy8gQHJldHVybiBUb3RhbCBhbW91bnQgb2YgdGFrZXJUb2tlbiBmaWxsZWQgaW4gdHJhZGUuCiAgICBmdW5jdGlvbiBmaWxsT3JkZXIoCiAgICAgICAgICBhZGRyZXNzWzVdIG9yZGVyQWRkcmVzc2VzLAogICAgICAgICAgdWludFs2XSBvcmRlclZhbHVlcywKICAgICAgICAgIHVpbnQgZmlsbFRha2VyVG9rZW5BbW91bnQsCiAgICAgICAgICBib29sIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UsCiAgICAgICAgICB1aW50OCB2LAogICAgICAgICAgYnl0ZXMzMiByLAogICAgICAgICAgYnl0ZXMzMiBzKQogICAgICAgICAgcHVibGljCiAgICAgICAgICByZXR1cm5zICh1aW50IGZpbGxlZFRha2VyVG9rZW5BbW91bnQpCiAgICB7CiAgICAgICAgT3JkZXIgbWVtb3J5IG9yZGVyID0gT3JkZXIoewogICAgICAgICAgICBtYWtlcjogb3JkZXJBZGRyZXNzZXNbMF0sCiAgICAgICAgICAgIHRha2VyOiBvcmRlckFkZHJlc3Nlc1sxXSwKICAgICAgICAgICAgbWFrZXJUb2tlbjogb3JkZXJBZGRyZXNzZXNbMl0sCiAgICAgICAgICAgIHRha2VyVG9rZW46IG9yZGVyQWRkcmVzc2VzWzNdLAogICAgICAgICAgICBmZWVSZWNpcGllbnQ6IG9yZGVyQWRkcmVzc2VzWzRdLAogICAgICAgICAgICBtYWtlclRva2VuQW1vdW50OiBvcmRlclZhbHVlc1swXSwKICAgICAgICAgICAgdGFrZXJUb2tlbkFtb3VudDogb3JkZXJWYWx1ZXNbMV0sCiAgICAgICAgICAgIG1ha2VyRmVlOiBvcmRlclZhbHVlc1syXSwKICAgICAgICAgICAgdGFrZXJGZWU6IG9yZGVyVmFsdWVzWzNdLAogICAgICAgICAgICBleHBpcmF0aW9uVGltZXN0YW1wSW5TZWM6IG9yZGVyVmFsdWVzWzRdLAogICAgICAgICAgICBvcmRlckhhc2g6IGdldE9yZGVySGFzaChvcmRlckFkZHJlc3Nlcywgb3JkZXJWYWx1ZXMpCiAgICAgICAgfSk7CgogICAgICAgIHJlcXVpcmUob3JkZXIudGFrZXIgPT0gYWRkcmVzcygwKSB8fCBvcmRlci50YWtlciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKG9yZGVyLm1ha2VyVG9rZW5BbW91bnQgPiAwICYmIG9yZGVyLnRha2VyVG9rZW5BbW91bnQgPiAwICYmIGZpbGxUYWtlclRva2VuQW1vdW50ID4gMCk7CiAgICAgICAgcmVxdWlyZShpc1ZhbGlkU2lnbmF0dXJlKAogICAgICAgICAgICBvcmRlci5tYWtlciwKICAgICAgICAgICAgb3JkZXIub3JkZXJIYXNoLAogICAgICAgICAgICB2LAogICAgICAgICAgICByLAogICAgICAgICAgICBzCiAgICAgICAgKSk7CgogICAgICAgIGlmIChibG9jay50aW1lc3RhbXAgPj0gb3JkZXIuZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjKSB7CiAgICAgICAgICAgIExvZ0Vycm9yKHVpbnQ4KEVycm9ycy5PUkRFUl9FWFBJUkVEKSwgb3JkZXIub3JkZXJIYXNoKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB1aW50IHJlbWFpbmluZ1Rha2VyVG9rZW5BbW91bnQgPSBzYWZlU3ViKG9yZGVyLnRha2VyVG9rZW5BbW91bnQsIGdldFVuYXZhaWxhYmxlVGFrZXJUb2tlbkFtb3VudChvcmRlci5vcmRlckhhc2gpKTsKICAgICAgICBmaWxsZWRUYWtlclRva2VuQW1vdW50ID0gbWluMjU2KGZpbGxUYWtlclRva2VuQW1vdW50LCByZW1haW5pbmdUYWtlclRva2VuQW1vdW50KTsKICAgICAgICBpZiAoZmlsbGVkVGFrZXJUb2tlbkFtb3VudCA9PSAwKSB7CiAgICAgICAgICAgIExvZ0Vycm9yKHVpbnQ4KEVycm9ycy5PUkRFUl9GVUxMWV9GSUxMRURfT1JfQ0FOQ0VMTEVEKSwgb3JkZXIub3JkZXJIYXNoKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNSb3VuZGluZ0Vycm9yKGZpbGxlZFRha2VyVG9rZW5BbW91bnQsIG9yZGVyLnRha2VyVG9rZW5BbW91bnQsIG9yZGVyLm1ha2VyVG9rZW5BbW91bnQpKSB7CiAgICAgICAgICAgIExvZ0Vycm9yKHVpbnQ4KEVycm9ycy5ST1VORElOR19FUlJPUl9UT09fTEFSR0UpLCBvcmRlci5vcmRlckhhc2gpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGlmICghc2hvdWxkVGhyb3dPbkluc3VmZmljaWVudEJhbGFuY2VPckFsbG93YW5jZSAmJiAhaXNUcmFuc2ZlcmFibGUob3JkZXIsIGZpbGxlZFRha2VyVG9rZW5BbW91bnQpKSB7CiAgICAgICAgICAgIExvZ0Vycm9yKHVpbnQ4KEVycm9ycy5JTlNVRkZJQ0lFTlRfQkFMQU5DRV9PUl9BTExPV0FOQ0UpLCBvcmRlci5vcmRlckhhc2gpOwogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHVpbnQgZmlsbGVkTWFrZXJUb2tlbkFtb3VudCA9IGdldFBhcnRpYWxBbW91bnQoZmlsbGVkVGFrZXJUb2tlbkFtb3VudCwgb3JkZXIudGFrZXJUb2tlbkFtb3VudCwgb3JkZXIubWFrZXJUb2tlbkFtb3VudCk7CiAgICAgICAgdWludCBwYWlkTWFrZXJGZWU7CiAgICAgICAgdWludCBwYWlkVGFrZXJGZWU7CiAgICAgICAgZmlsbGVkW29yZGVyLm9yZGVySGFzaF0gPSBzYWZlQWRkKGZpbGxlZFtvcmRlci5vcmRlckhhc2hdLCBmaWxsZWRUYWtlclRva2VuQW1vdW50KTsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyVmlhVG9rZW5UcmFuc2ZlclByb3h5KAogICAgICAgICAgICBvcmRlci5tYWtlclRva2VuLAogICAgICAgICAgICBvcmRlci5tYWtlciwKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgZmlsbGVkTWFrZXJUb2tlbkFtb3VudAogICAgICAgICkpOwogICAgICAgIHJlcXVpcmUodHJhbnNmZXJWaWFUb2tlblRyYW5zZmVyUHJveHkoCiAgICAgICAgICAgIG9yZGVyLnRha2VyVG9rZW4sCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIG9yZGVyLm1ha2VyLAogICAgICAgICAgICBmaWxsZWRUYWtlclRva2VuQW1vdW50CiAgICAgICAgKSk7CiAgICAgICAgaWYgKG9yZGVyLmZlZVJlY2lwaWVudCAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGlmIChvcmRlci5tYWtlckZlZSA+IDApIHsKICAgICAgICAgICAgICAgIHBhaWRNYWtlckZlZSA9IGdldFBhcnRpYWxBbW91bnQoZmlsbGVkVGFrZXJUb2tlbkFtb3VudCwgb3JkZXIudGFrZXJUb2tlbkFtb3VudCwgb3JkZXIubWFrZXJGZWUpOwogICAgICAgICAgICAgICAgcmVxdWlyZSh0cmFuc2ZlclZpYVRva2VuVHJhbnNmZXJQcm94eSgKICAgICAgICAgICAgICAgICAgICBaUlhfVE9LRU5fQ09OVFJBQ1QsCiAgICAgICAgICAgICAgICAgICAgb3JkZXIubWFrZXIsCiAgICAgICAgICAgICAgICAgICAgb3JkZXIuZmVlUmVjaXBpZW50LAogICAgICAgICAgICAgICAgICAgIHBhaWRNYWtlckZlZQogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9yZGVyLnRha2VyRmVlID4gMCkgewogICAgICAgICAgICAgICAgcGFpZFRha2VyRmVlID0gZ2V0UGFydGlhbEFtb3VudChmaWxsZWRUYWtlclRva2VuQW1vdW50LCBvcmRlci50YWtlclRva2VuQW1vdW50LCBvcmRlci50YWtlckZlZSk7CiAgICAgICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyVmlhVG9rZW5UcmFuc2ZlclByb3h5KAogICAgICAgICAgICAgICAgICAgIFpSWF9UT0tFTl9DT05UUkFDVCwKICAgICAgICAgICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICAgICAgICAgIG9yZGVyLmZlZVJlY2lwaWVudCwKICAgICAgICAgICAgICAgICAgICBwYWlkVGFrZXJGZWUKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMb2dGaWxsKAogICAgICAgICAgICBvcmRlci5tYWtlciwKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgb3JkZXIuZmVlUmVjaXBpZW50LAogICAgICAgICAgICBvcmRlci5tYWtlclRva2VuLAogICAgICAgICAgICBvcmRlci50YWtlclRva2VuLAogICAgICAgICAgICBmaWxsZWRNYWtlclRva2VuQW1vdW50LAogICAgICAgICAgICBmaWxsZWRUYWtlclRva2VuQW1vdW50LAogICAgICAgICAgICBwYWlkTWFrZXJGZWUsCiAgICAgICAgICAgIHBhaWRUYWtlckZlZSwKICAgICAgICAgICAga2VjY2FrMjU2KG9yZGVyLm1ha2VyVG9rZW4sIG9yZGVyLnRha2VyVG9rZW4pLAogICAgICAgICAgICBvcmRlci5vcmRlckhhc2gKICAgICAgICApOwogICAgICAgIHJldHVybiBmaWxsZWRUYWtlclRva2VuQW1vdW50OwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgdGhlIGlucHV0IG9yZGVyLgogICAgLy8vIEBwYXJhbSBvcmRlckFkZHJlc3NlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyLCB0YWtlciwgbWFrZXJUb2tlbiwgdGFrZXJUb2tlbiwgYW5kIGZlZVJlY2lwaWVudC4KICAgIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgQXJyYXkgb2Ygb3JkZXIncyBtYWtlclRva2VuQW1vdW50LCB0YWtlclRva2VuQW1vdW50LCBtYWtlckZlZSwgdGFrZXJGZWUsIGV4cGlyYXRpb25UaW1lc3RhbXBJblNlYywgYW5kIHNhbHQuCiAgICAvLy8gQHBhcmFtIGNhbmNlbFRha2VyVG9rZW5BbW91bnQgRGVzaXJlZCBhbW91bnQgb2YgdGFrZXJUb2tlbiB0byBjYW5jZWwgaW4gb3JkZXIuCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgdGFrZXJUb2tlbiBjYW5jZWxsZWQuCiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcigKICAgICAgICBhZGRyZXNzWzVdIG9yZGVyQWRkcmVzc2VzLAogICAgICAgIHVpbnRbNl0gb3JkZXJWYWx1ZXMsCiAgICAgICAgdWludCBjYW5jZWxUYWtlclRva2VuQW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgT3JkZXIgbWVtb3J5IG9yZGVyID0gT3JkZXIoewogICAgICAgICAgICBtYWtlcjogb3JkZXJBZGRyZXNzZXNbMF0sCiAgICAgICAgICAgIHRha2VyOiBvcmRlckFkZHJlc3Nlc1sxXSwKICAgICAgICAgICAgbWFrZXJUb2tlbjogb3JkZXJBZGRyZXNzZXNbMl0sCiAgICAgICAgICAgIHRha2VyVG9rZW46IG9yZGVyQWRkcmVzc2VzWzNdLAogICAgICAgICAgICBmZWVSZWNpcGllbnQ6IG9yZGVyQWRkcmVzc2VzWzRdLAogICAgICAgICAgICBtYWtlclRva2VuQW1vdW50OiBvcmRlclZhbHVlc1swXSwKICAgICAgICAgICAgdGFrZXJUb2tlbkFtb3VudDogb3JkZXJWYWx1ZXNbMV0sCiAgICAgICAgICAgIG1ha2VyRmVlOiBvcmRlclZhbHVlc1syXSwKICAgICAgICAgICAgdGFrZXJGZWU6IG9yZGVyVmFsdWVzWzNdLAogICAgICAgICAgICBleHBpcmF0aW9uVGltZXN0YW1wSW5TZWM6IG9yZGVyVmFsdWVzWzRdLAogICAgICAgICAgICBvcmRlckhhc2g6IGdldE9yZGVySGFzaChvcmRlckFkZHJlc3Nlcywgb3JkZXJWYWx1ZXMpCiAgICAgICAgfSk7CgogICAgICAgIHJlcXVpcmUob3JkZXIubWFrZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShvcmRlci5tYWtlclRva2VuQW1vdW50ID4gMCAmJiBvcmRlci50YWtlclRva2VuQW1vdW50ID4gMCAmJiBjYW5jZWxUYWtlclRva2VuQW1vdW50ID4gMCk7CgogICAgICAgIGlmIChibG9jay50aW1lc3RhbXAgPj0gb3JkZXIuZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjKSB7CiAgICAgICAgICAgIExvZ0Vycm9yKHVpbnQ4KEVycm9ycy5PUkRFUl9FWFBJUkVEKSwgb3JkZXIub3JkZXJIYXNoKTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB1aW50IHJlbWFpbmluZ1Rha2VyVG9rZW5BbW91bnQgPSBzYWZlU3ViKG9yZGVyLnRha2VyVG9rZW5BbW91bnQsIGdldFVuYXZhaWxhYmxlVGFrZXJUb2tlbkFtb3VudChvcmRlci5vcmRlckhhc2gpKTsKICAgICAgICB1aW50IGNhbmNlbGxlZFRha2VyVG9rZW5BbW91bnQgPSBtaW4yNTYoY2FuY2VsVGFrZXJUb2tlbkFtb3VudCwgcmVtYWluaW5nVGFrZXJUb2tlbkFtb3VudCk7CiAgICAgICAgaWYgKGNhbmNlbGxlZFRha2VyVG9rZW5BbW91bnQgPT0gMCkgewogICAgICAgICAgICBMb2dFcnJvcih1aW50OChFcnJvcnMuT1JERVJfRlVMTFlfRklMTEVEX09SX0NBTkNFTExFRCksIG9yZGVyLm9yZGVySGFzaCk7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgY2FuY2VsbGVkW29yZGVyLm9yZGVySGFzaF0gPSBzYWZlQWRkKGNhbmNlbGxlZFtvcmRlci5vcmRlckhhc2hdLCBjYW5jZWxsZWRUYWtlclRva2VuQW1vdW50KTsKCiAgICAgICAgTG9nQ2FuY2VsKAogICAgICAgICAgICBvcmRlci5tYWtlciwKICAgICAgICAgICAgb3JkZXIuZmVlUmVjaXBpZW50LAogICAgICAgICAgICBvcmRlci5tYWtlclRva2VuLAogICAgICAgICAgICBvcmRlci50YWtlclRva2VuLAogICAgICAgICAgICBnZXRQYXJ0aWFsQW1vdW50KGNhbmNlbGxlZFRha2VyVG9rZW5BbW91bnQsIG9yZGVyLnRha2VyVG9rZW5BbW91bnQsIG9yZGVyLm1ha2VyVG9rZW5BbW91bnQpLAogICAgICAgICAgICBjYW5jZWxsZWRUYWtlclRva2VuQW1vdW50LAogICAgICAgICAgICBrZWNjYWsyNTYob3JkZXIubWFrZXJUb2tlbiwgb3JkZXIudGFrZXJUb2tlbiksCiAgICAgICAgICAgIG9yZGVyLm9yZGVySGFzaAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGNhbmNlbGxlZFRha2VyVG9rZW5BbW91bnQ7CiAgICB9CgogICAgLyoKICAgICogV3JhcHBlciBmdW5jdGlvbnMKICAgICovCgogICAgLy8vIEBkZXYgRmlsbHMgYW4gb3JkZXIgd2l0aCBzcGVjaWZpZWQgcGFyYW1ldGVycyBhbmQgRUNEU0Egc2lnbmF0dXJlLCB0aHJvd3MgaWYgc3BlY2lmaWVkIGFtb3VudCBub3QgZmlsbGVkIGVudGlyZWx5LgogICAgLy8vIEBwYXJhbSBvcmRlckFkZHJlc3NlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyLCB0YWtlciwgbWFrZXJUb2tlbiwgdGFrZXJUb2tlbiwgYW5kIGZlZVJlY2lwaWVudC4KICAgIC8vLyBAcGFyYW0gb3JkZXJWYWx1ZXMgQXJyYXkgb2Ygb3JkZXIncyBtYWtlclRva2VuQW1vdW50LCB0YWtlclRva2VuQW1vdW50LCBtYWtlckZlZSwgdGFrZXJGZWUsIGV4cGlyYXRpb25UaW1lc3RhbXBJblNlYywgYW5kIHNhbHQuCiAgICAvLy8gQHBhcmFtIGZpbGxUYWtlclRva2VuQW1vdW50IERlc2lyZWQgYW1vdW50IG9mIHRha2VyVG9rZW4gdG8gZmlsbC4KICAgIC8vLyBAcGFyYW0gdiBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVyIHYuCiAgICAvLy8gQHBhcmFtIHIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgZnVuY3Rpb24gZmlsbE9yS2lsbE9yZGVyKAogICAgICAgIGFkZHJlc3NbNV0gb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgdWludFs2XSBvcmRlclZhbHVlcywKICAgICAgICB1aW50IGZpbGxUYWtlclRva2VuQW1vdW50LAogICAgICAgIHVpbnQ4IHYsCiAgICAgICAgYnl0ZXMzMiByLAogICAgICAgIGJ5dGVzMzIgcykKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKGZpbGxPcmRlcigKICAgICAgICAgICAgb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgICAgIG9yZGVyVmFsdWVzLAogICAgICAgICAgICBmaWxsVGFrZXJUb2tlbkFtb3VudCwKICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgIHYsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHMKICAgICAgICApID09IGZpbGxUYWtlclRva2VuQW1vdW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBTeW5jaHJvbm91c2x5IGV4ZWN1dGVzIG11bHRpcGxlIGZpbGwgb3JkZXJzIGluIGEgc2luZ2xlIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSBvcmRlckFkZHJlc3NlcyBBcnJheSBvZiBhZGRyZXNzIGFycmF5cyBjb250YWluaW5nIGluZGl2aWR1YWwgb3JkZXIgYWRkcmVzc2VzLgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiB1aW50IGFycmF5cyBjb250YWluaW5nIGluZGl2aWR1YWwgb3JkZXIgdmFsdWVzLgogICAgLy8vIEBwYXJhbSBmaWxsVGFrZXJUb2tlbkFtb3VudHMgQXJyYXkgb2YgZGVzaXJlZCBhbW91bnRzIG9mIHRha2VyVG9rZW4gdG8gZmlsbCBpbiBvcmRlcnMuCiAgICAvLy8gQHBhcmFtIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UgVGVzdCBpZiB0cmFuc2ZlcnMgd2lsbCBmYWlsIGJlZm9yZSBhdHRlbXB0aW5nLgogICAgLy8vIEBwYXJhbSB2IEFycmF5IEVDRFNBIHNpZ25hdHVyZSB2IHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIHIgQXJyYXkgb2YgRUNEU0Egc2lnbmF0dXJlIHIgcGFyYW1ldGVycy4KICAgIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogICAgZnVuY3Rpb24gYmF0Y2hGaWxsT3JkZXJzKAogICAgICAgIGFkZHJlc3NbNV1bXSBvcmRlckFkZHJlc3NlcywKICAgICAgICB1aW50WzZdW10gb3JkZXJWYWx1ZXMsCiAgICAgICAgdWludFtdIGZpbGxUYWtlclRva2VuQW1vdW50cywKICAgICAgICBib29sIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UsCiAgICAgICAgdWludDhbXSB2LAogICAgICAgIGJ5dGVzMzJbXSByLAogICAgICAgIGJ5dGVzMzJbXSBzKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG9yZGVyQWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZpbGxPcmRlcigKICAgICAgICAgICAgICAgIG9yZGVyQWRkcmVzc2VzW2ldLAogICAgICAgICAgICAgICAgb3JkZXJWYWx1ZXNbaV0sCiAgICAgICAgICAgICAgICBmaWxsVGFrZXJUb2tlbkFtb3VudHNbaV0sCiAgICAgICAgICAgICAgICBzaG91bGRUaHJvd09uSW5zdWZmaWNpZW50QmFsYW5jZU9yQWxsb3dhbmNlLAogICAgICAgICAgICAgICAgdltpXSwKICAgICAgICAgICAgICAgIHJbaV0sCiAgICAgICAgICAgICAgICBzW2ldCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFN5bmNocm9ub3VzbHkgZXhlY3V0ZXMgbXVsdGlwbGUgZmlsbE9yS2lsbCBvcmRlcnMgaW4gYSBzaW5nbGUgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIGFkZHJlc3MgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciBhZGRyZXNzZXMuCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgICAvLy8gQHBhcmFtIGZpbGxUYWtlclRva2VuQW1vdW50cyBBcnJheSBvZiBkZXNpcmVkIGFtb3VudHMgb2YgdGFrZXJUb2tlbiB0byBmaWxsIGluIG9yZGVycy4KICAgIC8vLyBAcGFyYW0gdiBBcnJheSBFQ0RTQSBzaWduYXR1cmUgdiBwYXJhbWV0ZXJzLgogICAgLy8vIEBwYXJhbSByIEFycmF5IG9mIEVDRFNBIHNpZ25hdHVyZSByIHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIHMgQXJyYXkgb2YgRUNEU0Egc2lnbmF0dXJlIHMgcGFyYW1ldGVycy4KICAgIGZ1bmN0aW9uIGJhdGNoRmlsbE9yS2lsbE9yZGVycygKICAgICAgICBhZGRyZXNzWzVdW10gb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgdWludFs2XVtdIG9yZGVyVmFsdWVzLAogICAgICAgIHVpbnRbXSBmaWxsVGFrZXJUb2tlbkFtb3VudHMsCiAgICAgICAgdWludDhbXSB2LAogICAgICAgIGJ5dGVzMzJbXSByLAogICAgICAgIGJ5dGVzMzJbXSBzKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG9yZGVyQWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGZpbGxPcktpbGxPcmRlcigKICAgICAgICAgICAgICAgIG9yZGVyQWRkcmVzc2VzW2ldLAogICAgICAgICAgICAgICAgb3JkZXJWYWx1ZXNbaV0sCiAgICAgICAgICAgICAgICBmaWxsVGFrZXJUb2tlbkFtb3VudHNbaV0sCiAgICAgICAgICAgICAgICB2W2ldLAogICAgICAgICAgICAgICAgcltpXSwKICAgICAgICAgICAgICAgIHNbaV0KICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgU3luY2hyb25vdXNseSBleGVjdXRlcyBtdWx0aXBsZSBmaWxsIG9yZGVycyBpbiBhIHNpbmdsZSB0cmFuc2FjdGlvbiB1bnRpbCB0b3RhbCBmaWxsVGFrZXJUb2tlbkFtb3VudCBmaWxsZWQuCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIGFkZHJlc3MgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciBhZGRyZXNzZXMuCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgICAvLy8gQHBhcmFtIGZpbGxUYWtlclRva2VuQW1vdW50IERlc2lyZWQgdG90YWwgYW1vdW50IG9mIHRha2VyVG9rZW4gdG8gZmlsbCBpbiBvcmRlcnMuCiAgICAvLy8gQHBhcmFtIHNob3VsZFRocm93T25JbnN1ZmZpY2llbnRCYWxhbmNlT3JBbGxvd2FuY2UgVGVzdCBpZiB0cmFuc2ZlcnMgd2lsbCBmYWlsIGJlZm9yZSBhdHRlbXB0aW5nLgogICAgLy8vIEBwYXJhbSB2IEFycmF5IEVDRFNBIHNpZ25hdHVyZSB2IHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIHIgQXJyYXkgb2YgRUNEU0Egc2lnbmF0dXJlIHIgcGFyYW1ldGVycy4KICAgIC8vLyBAcGFyYW0gcyBBcnJheSBvZiBFQ0RTQSBzaWduYXR1cmUgcyBwYXJhbWV0ZXJzLgogICAgLy8vIEByZXR1cm4gVG90YWwgYW1vdW50IG9mIGZpbGxUYWtlclRva2VuQW1vdW50IGZpbGxlZCBpbiBvcmRlcnMuCiAgICBmdW5jdGlvbiBmaWxsT3JkZXJzVXBUbygKICAgICAgICBhZGRyZXNzWzVdW10gb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgdWludFs2XVtdIG9yZGVyVmFsdWVzLAogICAgICAgIHVpbnQgZmlsbFRha2VyVG9rZW5BbW91bnQsCiAgICAgICAgYm9vbCBzaG91bGRUaHJvd09uSW5zdWZmaWNpZW50QmFsYW5jZU9yQWxsb3dhbmNlLAogICAgICAgIHVpbnQ4W10gdiwKICAgICAgICBieXRlczMyW10gciwKICAgICAgICBieXRlczMyW10gcykKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHVpbnQgZmlsbGVkVGFrZXJUb2tlbkFtb3VudCA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3JkZXJBZGRyZXNzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcmVxdWlyZShvcmRlckFkZHJlc3Nlc1tpXVszXSA9PSBvcmRlckFkZHJlc3Nlc1swXVszXSk7IC8vIHRha2VyVG9rZW4gbXVzdCBiZSB0aGUgc2FtZSBmb3IgZWFjaCBvcmRlcgogICAgICAgICAgICBmaWxsZWRUYWtlclRva2VuQW1vdW50ID0gc2FmZUFkZChmaWxsZWRUYWtlclRva2VuQW1vdW50LCBmaWxsT3JkZXIoCiAgICAgICAgICAgICAgICBvcmRlckFkZHJlc3Nlc1tpXSwKICAgICAgICAgICAgICAgIG9yZGVyVmFsdWVzW2ldLAogICAgICAgICAgICAgICAgc2FmZVN1YihmaWxsVGFrZXJUb2tlbkFtb3VudCwgZmlsbGVkVGFrZXJUb2tlbkFtb3VudCksCiAgICAgICAgICAgICAgICBzaG91bGRUaHJvd09uSW5zdWZmaWNpZW50QmFsYW5jZU9yQWxsb3dhbmNlLAogICAgICAgICAgICAgICAgdltpXSwKICAgICAgICAgICAgICAgIHJbaV0sCiAgICAgICAgICAgICAgICBzW2ldCiAgICAgICAgICAgICkpOwogICAgICAgICAgICBpZiAoZmlsbGVkVGFrZXJUb2tlbkFtb3VudCA9PSBmaWxsVGFrZXJUb2tlbkFtb3VudCkgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmaWxsZWRUYWtlclRva2VuQW1vdW50OwogICAgfQoKICAgIC8vLyBAZGV2IFN5bmNocm9ub3VzbHkgY2FuY2VscyBtdWx0aXBsZSBvcmRlcnMgaW4gYSBzaW5nbGUgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIGFkZHJlc3MgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciBhZGRyZXNzZXMuCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzIEFycmF5IG9mIHVpbnQgYXJyYXlzIGNvbnRhaW5pbmcgaW5kaXZpZHVhbCBvcmRlciB2YWx1ZXMuCiAgICAvLy8gQHBhcmFtIGNhbmNlbFRha2VyVG9rZW5BbW91bnRzIEFycmF5IG9mIGRlc2lyZWQgYW1vdW50cyBvZiB0YWtlclRva2VuIHRvIGNhbmNlbCBpbiBvcmRlcnMuCiAgICBmdW5jdGlvbiBiYXRjaENhbmNlbE9yZGVycygKICAgICAgICBhZGRyZXNzWzVdW10gb3JkZXJBZGRyZXNzZXMsCiAgICAgICAgdWludFs2XVtdIG9yZGVyVmFsdWVzLAogICAgICAgIHVpbnRbXSBjYW5jZWxUYWtlclRva2VuQW1vdW50cykKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvcmRlckFkZHJlc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjYW5jZWxPcmRlcigKICAgICAgICAgICAgICAgIG9yZGVyQWRkcmVzc2VzW2ldLAogICAgICAgICAgICAgICAgb3JkZXJWYWx1ZXNbaV0sCiAgICAgICAgICAgICAgICBjYW5jZWxUYWtlclRva2VuQW1vdW50c1tpXQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgKiBDb25zdGFudCBwdWJsaWMgZnVuY3Rpb25zCiAgICAqLwoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgS2VjY2FrLTI1NiBoYXNoIG9mIG9yZGVyIHdpdGggc3BlY2lmaWVkIHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXIsIHRha2VyLCBtYWtlclRva2VuLCB0YWtlclRva2VuLCBhbmQgZmVlUmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyVG9rZW5BbW91bnQsIHRha2VyVG9rZW5BbW91bnQsIG1ha2VyRmVlLCB0YWtlckZlZSwgZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjLCBhbmQgc2FsdC4KICAgIC8vLyBAcmV0dXJuIEtlY2Nhay0yNTYgaGFzaCBvZiBvcmRlci4KICAgIGZ1bmN0aW9uIGdldE9yZGVySGFzaChhZGRyZXNzWzVdIG9yZGVyQWRkcmVzc2VzLCB1aW50WzZdIG9yZGVyVmFsdWVzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikKICAgIHsKICAgICAgICByZXR1cm4ga2VjY2FrMjU2KAogICAgICAgICAgICBhZGRyZXNzKHRoaXMpLAogICAgICAgICAgICBvcmRlckFkZHJlc3Nlc1swXSwgLy8gbWFrZXIKICAgICAgICAgICAgb3JkZXJBZGRyZXNzZXNbMV0sIC8vIHRha2VyCiAgICAgICAgICAgIG9yZGVyQWRkcmVzc2VzWzJdLCAvLyBtYWtlclRva2VuCiAgICAgICAgICAgIG9yZGVyQWRkcmVzc2VzWzNdLCAvLyB0YWtlclRva2VuCiAgICAgICAgICAgIG9yZGVyQWRkcmVzc2VzWzRdLCAvLyBmZWVSZWNpcGllbnQKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbMF0sICAgIC8vIG1ha2VyVG9rZW5BbW91bnQKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbMV0sICAgIC8vIHRha2VyVG9rZW5BbW91bnQKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbMl0sICAgIC8vIG1ha2VyRmVlCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzNdLCAgICAvLyB0YWtlckZlZQogICAgICAgICAgICBvcmRlclZhbHVlc1s0XSwgICAgLy8gZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzVdICAgICAvLyBzYWx0CiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBWZXJpZmllcyB0aGF0IGFuIG9yZGVyIHNpZ25hdHVyZSBpcyB2YWxpZC4KICAgIC8vLyBAcGFyYW0gc2lnbmVyIGFkZHJlc3Mgb2Ygc2lnbmVyLgogICAgLy8vIEBwYXJhbSBoYXNoIFNpZ25lZCBLZWNjYWstMjU2IGhhc2guCiAgICAvLy8gQHBhcmFtIHYgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHIuCiAgICAvLy8gQHBhcmFtIHMgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgcy4KICAgIC8vLyBAcmV0dXJuIFZhbGlkaXR5IG9mIG9yZGVyIHNpZ25hdHVyZS4KICAgIGZ1bmN0aW9uIGlzVmFsaWRTaWduYXR1cmUoCiAgICAgICAgYWRkcmVzcyBzaWduZXIsCiAgICAgICAgYnl0ZXMzMiBoYXNoLAogICAgICAgIHVpbnQ4IHYsCiAgICAgICAgYnl0ZXMzMiByLAogICAgICAgIGJ5dGVzMzIgcykKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIHNpZ25lciA9PSBlY3JlY292ZXIoCiAgICAgICAgICAgIGtlY2NhazI1NigiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiLCBoYXNoKSwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcwogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIHJvdW5kaW5nIGVycm9yID4gMC4xJS4KICAgIC8vLyBAcGFyYW0gbnVtZXJhdG9yIE51bWVyYXRvci4KICAgIC8vLyBAcGFyYW0gZGVub21pbmF0b3IgRGVub21pbmF0b3IuCiAgICAvLy8gQHBhcmFtIHRhcmdldCBWYWx1ZSB0byBtdWx0aXBseSB3aXRoIG51bWVyYXRvci9kZW5vbWluYXRvci4KICAgIC8vLyBAcmV0dXJuIFJvdW5kaW5nIGVycm9yIGlzIHByZXNlbnQuCiAgICBmdW5jdGlvbiBpc1JvdW5kaW5nRXJyb3IodWludCBudW1lcmF0b3IsIHVpbnQgZGVub21pbmF0b3IsIHVpbnQgdGFyZ2V0KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB1aW50IHJlbWFpbmRlciA9IG11bG1vZCh0YXJnZXQsIG51bWVyYXRvciwgZGVub21pbmF0b3IpOwogICAgICAgIGlmIChyZW1haW5kZXIgPT0gMCkgcmV0dXJuIGZhbHNlOyAvLyBObyByb3VuZGluZyBlcnJvci4KCiAgICAgICAgdWludCBlcnJQZXJjZW50YWdlVGltZXMxMDAwMDAwID0gc2FmZURpdigKICAgICAgICAgICAgc2FmZU11bChyZW1haW5kZXIsIDEwMDAwMDApLAogICAgICAgICAgICBzYWZlTXVsKG51bWVyYXRvciwgdGFyZ2V0KQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGVyclBlcmNlbnRhZ2VUaW1lczEwMDAwMDAgPiAxMDAwOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgcGFydGlhbCB2YWx1ZSBnaXZlbiBhIG51bWVyYXRvciBhbmQgZGVub21pbmF0b3IuCiAgICAvLy8gQHBhcmFtIG51bWVyYXRvciBOdW1lcmF0b3IuCiAgICAvLy8gQHBhcmFtIGRlbm9taW5hdG9yIERlbm9taW5hdG9yLgogICAgLy8vIEBwYXJhbSB0YXJnZXQgVmFsdWUgdG8gY2FsY3VsYXRlIHBhcnRpYWwgb2YuCiAgICAvLy8gQHJldHVybiBQYXJ0aWFsIHZhbHVlIG9mIHRhcmdldC4KICAgIGZ1bmN0aW9uIGdldFBhcnRpYWxBbW91bnQodWludCBudW1lcmF0b3IsIHVpbnQgZGVub21pbmF0b3IsIHVpbnQgdGFyZ2V0KQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gc2FmZURpdihzYWZlTXVsKG51bWVyYXRvciwgdGFyZ2V0KSwgZGVub21pbmF0b3IpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgdGhlIHN1bSBvZiB2YWx1ZXMgYWxyZWFkeSBmaWxsZWQgYW5kIGNhbmNlbGxlZCBmb3IgYSBnaXZlbiBvcmRlci4KICAgIC8vLyBAcGFyYW0gb3JkZXJIYXNoIFRoZSBLZWNjYWstMjU2IGhhc2ggb2YgdGhlIGdpdmVuIG9yZGVyLgogICAgLy8vIEByZXR1cm4gU3VtIG9mIHZhbHVlcyBhbHJlYWR5IGZpbGxlZCBhbmQgY2FuY2VsbGVkLgogICAgZnVuY3Rpb24gZ2V0VW5hdmFpbGFibGVUYWtlclRva2VuQW1vdW50KGJ5dGVzMzIgb3JkZXJIYXNoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gc2FmZUFkZChmaWxsZWRbb3JkZXJIYXNoXSwgY2FuY2VsbGVkW29yZGVySGFzaF0pOwogICAgfQoKCiAgICAvKgogICAgKiBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICovCgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIGEgdG9rZW4gdXNpbmcgVG9rZW5UcmFuc2ZlclByb3h5IHRyYW5zZmVyRnJvbSBmdW5jdGlvbi4KICAgIC8vLyBAcGFyYW0gdG9rZW4gQWRkcmVzcyBvZiB0b2tlbiB0byB0cmFuc2ZlckZyb20uCiAgICAvLy8gQHBhcmFtIGZyb20gQWRkcmVzcyB0cmFuc2ZlcmluZyB0b2tlbi4KICAgIC8vLyBAcGFyYW0gdG8gQWRkcmVzcyByZWNlaXZpbmcgdG9rZW4uCiAgICAvLy8gQHBhcmFtIHZhbHVlIEFtb3VudCBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIC8vLyBAcmV0dXJuIFN1Y2Nlc3Mgb2YgdG9rZW4gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiB0cmFuc2ZlclZpYVRva2VuVHJhbnNmZXJQcm94eSgKICAgICAgICBhZGRyZXNzIHRva2VuLAogICAgICAgIGFkZHJlc3MgZnJvbSwKICAgICAgICBhZGRyZXNzIHRvLAogICAgICAgIHVpbnQgdmFsdWUpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBUb2tlblRyYW5zZmVyUHJveHkoVE9LRU5fVFJBTlNGRVJfUFJPWFlfQ09OVFJBQ1QpLnRyYW5zZmVyRnJvbSh0b2tlbiwgZnJvbSwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYW55IG9yZGVyIHRyYW5zZmVycyB3aWxsIGZhaWwuCiAgICAvLy8gQHBhcmFtIG9yZGVyIE9yZGVyIHN0cnVjdCBvZiBwYXJhbXMgdGhhdCB3aWxsIGJlIGNoZWNrZWQuCiAgICAvLy8gQHBhcmFtIGZpbGxUYWtlclRva2VuQW1vdW50IERlc2lyZWQgYW1vdW50IG9mIHRha2VyVG9rZW4gdG8gZmlsbC4KICAgIC8vLyBAcmV0dXJuIFByZWRpY3RlZCByZXN1bHQgb2YgdHJhbnNmZXJzLgogICAgZnVuY3Rpb24gaXNUcmFuc2ZlcmFibGUoT3JkZXIgb3JkZXIsIHVpbnQgZmlsbFRha2VyVG9rZW5BbW91bnQpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudCAgLy8gVGhlIGNhbGxlZCB0b2tlbiBjb250cmFjdHMgbWF5IGF0dGVtcHQgdG8gY2hhbmdlIHN0YXRlLCBidXQgd2lsbCBub3QgYmUgYWJsZSB0byBkdWUgdG8gZ2FzIGxpbWl0cyBvbiBnZXRCYWxhbmNlIGFuZCBnZXRBbGxvd2FuY2UuCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhZGRyZXNzIHRha2VyID0gbXNnLnNlbmRlcjsKICAgICAgICB1aW50IGZpbGxNYWtlclRva2VuQW1vdW50ID0gZ2V0UGFydGlhbEFtb3VudChmaWxsVGFrZXJUb2tlbkFtb3VudCwgb3JkZXIudGFrZXJUb2tlbkFtb3VudCwgb3JkZXIubWFrZXJUb2tlbkFtb3VudCk7CgogICAgICAgIGlmIChvcmRlci5mZWVSZWNpcGllbnQgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBib29sIGlzTWFrZXJUb2tlblpSWCA9IG9yZGVyLm1ha2VyVG9rZW4gPT0gWlJYX1RPS0VOX0NPTlRSQUNUOwogICAgICAgICAgICBib29sIGlzVGFrZXJUb2tlblpSWCA9IG9yZGVyLnRha2VyVG9rZW4gPT0gWlJYX1RPS0VOX0NPTlRSQUNUOwogICAgICAgICAgICB1aW50IHBhaWRNYWtlckZlZSA9IGdldFBhcnRpYWxBbW91bnQoZmlsbFRha2VyVG9rZW5BbW91bnQsIG9yZGVyLnRha2VyVG9rZW5BbW91bnQsIG9yZGVyLm1ha2VyRmVlKTsKICAgICAgICAgICAgdWludCBwYWlkVGFrZXJGZWUgPSBnZXRQYXJ0aWFsQW1vdW50KGZpbGxUYWtlclRva2VuQW1vdW50LCBvcmRlci50YWtlclRva2VuQW1vdW50LCBvcmRlci50YWtlckZlZSk7CiAgICAgICAgICAgIHVpbnQgcmVxdWlyZWRNYWtlclpSWCA9IGlzTWFrZXJUb2tlblpSWCA/IHNhZmVBZGQoZmlsbE1ha2VyVG9rZW5BbW91bnQsIHBhaWRNYWtlckZlZSkgOiBwYWlkTWFrZXJGZWU7CiAgICAgICAgICAgIHVpbnQgcmVxdWlyZWRUYWtlclpSWCA9IGlzVGFrZXJUb2tlblpSWCA/IHNhZmVBZGQoZmlsbFRha2VyVG9rZW5BbW91bnQsIHBhaWRUYWtlckZlZSkgOiBwYWlkVGFrZXJGZWU7CgogICAgICAgICAgICBpZiAoICAgZ2V0QmFsYW5jZShaUlhfVE9LRU5fQ09OVFJBQ1QsIG9yZGVyLm1ha2VyKSA8IHJlcXVpcmVkTWFrZXJaUlgKICAgICAgICAgICAgICAgIHx8IGdldEFsbG93YW5jZShaUlhfVE9LRU5fQ09OVFJBQ1QsIG9yZGVyLm1ha2VyKSA8IHJlcXVpcmVkTWFrZXJaUlgKICAgICAgICAgICAgICAgIHx8IGdldEJhbGFuY2UoWlJYX1RPS0VOX0NPTlRSQUNULCB0YWtlcikgPCByZXF1aXJlZFRha2VyWlJYCiAgICAgICAgICAgICAgICB8fCBnZXRBbGxvd2FuY2UoWlJYX1RPS0VOX0NPTlRSQUNULCB0YWtlcikgPCByZXF1aXJlZFRha2VyWlJYCiAgICAgICAgICAgICkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgaWYgKCFpc01ha2VyVG9rZW5aUlggJiYgKCAgIGdldEJhbGFuY2Uob3JkZXIubWFrZXJUb2tlbiwgb3JkZXIubWFrZXIpIDwgZmlsbE1ha2VyVG9rZW5BbW91bnQgLy8gRG9uJ3QgZG91YmxlIGNoZWNrIG1ha2VyVG9rZW4gaWYgWlJYCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBnZXRBbGxvd2FuY2Uob3JkZXIubWFrZXJUb2tlbiwgb3JkZXIubWFrZXIpIDwgZmlsbE1ha2VyVG9rZW5BbW91bnQpCiAgICAgICAgICAgICkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoIWlzVGFrZXJUb2tlblpSWCAmJiAoICAgZ2V0QmFsYW5jZShvcmRlci50YWtlclRva2VuLCB0YWtlcikgPCBmaWxsVGFrZXJUb2tlbkFtb3VudCAvLyBEb24ndCBkb3VibGUgY2hlY2sgdGFrZXJUb2tlbiBpZiBaUlgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IGdldEFsbG93YW5jZShvcmRlci50YWtlclRva2VuLCB0YWtlcikgPCBmaWxsVGFrZXJUb2tlbkFtb3VudCkKICAgICAgICAgICAgKSByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIGlmICggICBnZXRCYWxhbmNlKG9yZGVyLm1ha2VyVG9rZW4sIG9yZGVyLm1ha2VyKSA8IGZpbGxNYWtlclRva2VuQW1vdW50CiAgICAgICAgICAgICAgICAgICB8fCBnZXRBbGxvd2FuY2Uob3JkZXIubWFrZXJUb2tlbiwgb3JkZXIubWFrZXIpIDwgZmlsbE1ha2VyVG9rZW5BbW91bnQKICAgICAgICAgICAgICAgICAgIHx8IGdldEJhbGFuY2Uob3JkZXIudGFrZXJUb2tlbiwgdGFrZXIpIDwgZmlsbFRha2VyVG9rZW5BbW91bnQKICAgICAgICAgICAgICAgICAgIHx8IGdldEFsbG93YW5jZShvcmRlci50YWtlclRva2VuLCB0YWtlcikgPCBmaWxsVGFrZXJUb2tlbkFtb3VudAogICAgICAgICkgcmV0dXJuIGZhbHNlOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBHZXQgdG9rZW4gYmFsYW5jZSBvZiBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSB0b2tlbiBBZGRyZXNzIG9mIHRva2VuLgogICAgLy8vIEBwYXJhbSBvd25lciBBZGRyZXNzIG9mIG93bmVyLgogICAgLy8vIEByZXR1cm4gVG9rZW4gYmFsYW5jZSBvZiBvd25lci4KICAgIGZ1bmN0aW9uIGdldEJhbGFuY2UoYWRkcmVzcyB0b2tlbiwgYWRkcmVzcyBvd25lcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50ICAvLyBUaGUgY2FsbGVkIHRva2VuIGNvbnRyYWN0IG1heSBhdHRlbXB0IHRvIGNoYW5nZSBzdGF0ZSwgYnV0IHdpbGwgbm90IGJlIGFibGUgdG8gZHVlIHRvIGFuIGFkZGVkIGdhcyBsaW1pdC4KICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBUb2tlbih0b2tlbikuYmFsYW5jZU9mLmdhcyhFWFRFUk5BTF9RVUVSWV9HQVNfTElNSVQpKG93bmVyKTsgLy8gTGltaXQgZ2FzIHRvIHByZXZlbnQgcmVlbnRyYW5jeQogICAgfQoKICAgIC8vLyBAZGV2IEdldCBhbGxvd2FuY2Ugb2YgdG9rZW4gZ2l2ZW4gdG8gVG9rZW5UcmFuc2ZlclByb3h5IGJ5IGFuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIHRva2VuIEFkZHJlc3Mgb2YgdG9rZW4uCiAgICAvLy8gQHBhcmFtIG93bmVyIEFkZHJlc3Mgb2Ygb3duZXIuCiAgICAvLy8gQHJldHVybiBBbGxvd2FuY2Ugb2YgdG9rZW4gZ2l2ZW4gdG8gVG9rZW5UcmFuc2ZlclByb3h5IGJ5IG93bmVyLgogICAgZnVuY3Rpb24gZ2V0QWxsb3dhbmNlKGFkZHJlc3MgdG9rZW4sIGFkZHJlc3Mgb3duZXIpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudCAgLy8gVGhlIGNhbGxlZCB0b2tlbiBjb250cmFjdCBtYXkgYXR0ZW1wdCB0byBjaGFuZ2Ugc3RhdGUsIGJ1dCB3aWxsIG5vdCBiZSBhYmxlIHRvIGR1ZSB0byBhbiBhZGRlZCBnYXMgbGltaXQuCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gVG9rZW4odG9rZW4pLmFsbG93YW5jZS5nYXMoRVhURVJOQUxfUVVFUllfR0FTX0xJTUlUKShvd25lciwgVE9LRU5fVFJBTlNGRVJfUFJPWFlfQ09OVFJBQ1QpOyAvLyBMaW1pdCBnYXMgdG8gcHJldmVudCByZWVudHJhbmN5CiAgICB9Cn0KCgovLy8gQHRpdGxlIFN0YW5kYXJkIHRva2VuIGNvbnRyYWN0IHdpdGggb3ZlcmZsb3cgcHJvdGVjdGlvbiAtIFVzZWQgZm9yIHRva2VucyB3aXRoIGR5bmFtaWMgc3VwcGx5Lgpjb250cmFjdCBTdGFuZGFyZFRva2VuV2l0aE92ZXJmbG93UHJvdGVjdGlvbiBpcyBUb2tlbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGgKewoKICAgIC8qCiAgICAgKiAgRGF0YSBzdHJ1Y3R1cmVzCiAgICAgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgVHJhbnNmZXJzIHNlbmRlcidzIHRva2VucyB0byBhIGdpdmVuIGFkZHJlc3MuIFJldHVybnMgc3VjY2Vzcy4KICAgIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIGFsbG93ZWQgdGhpcmQgcGFydHkgdG8gdHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBBZGRyZXNzIGZyb20gd2hlcmUgdG9rZW5zIGFyZSB3aXRoZHJhd24uCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgc2VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFNldHMgYXBwcm92ZWQgYW1vdW50IG9mIHRva2VucyBmb3Igc3BlbmRlci4gUmV0dXJucyBzdWNjZXNzLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGFsbG93ZWQgYWNjb3VudC4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiBhcHByb3ZlZCB0b2tlbnMuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKgogICAgICogUmVhZCBmdW5jdGlvbnMKICAgICAqLwogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgYWxsb3dlZCB0b2tlbnMgZm9yIGdpdmVuIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIG93bmVyLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIHRva2VuIHNwZW5kZXIuCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHJlbWFpbmluZyBhbGxvd2FuY2UgZm9yIHNwZW5kZXIuCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpCiAgICAgICAgY29uc3RhbnQKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIHRva2VucyBvd25lZCBieSBnaXZlbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYmFsYW5jZSBvZiBvd25lci4KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikKICAgICAgICBjb25zdGFudAogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9Cn0KCi8vLyBAdGl0bGUgVG9rZW4gY29udHJhY3QgLSBUb2tlbiBleGNoYW5naW5nIEV0aGVyIDE6MS4KLy8vIEBhdXRob3IgU3RlZmFuIEdlb3JnZSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImIwYzNjNGQ1ZDZkMWRlOWVkN2Q1ZGZjMmQ3ZDVmMGQzZGZkZWMzZDVkZWMzYzljMzllZGVkNWM0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KLy8vIEBhdXRob3IgTW9kaWZpZWQgYnkgQW1pciBCYW5kZWFsaSAtIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjE1NzQ3ODdjNjc1NTI1NmQ2NTY3N2E3ZjcwNzY2MTNiNzY3YTc4Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4KY29udHJhY3QgRXRoZXJUb2tlbiBpcyBTdGFuZGFyZFRva2VuV2l0aE92ZXJmbG93UHJvdGVjdGlvbiB7CgogICAgLyoKICAgICAqICBDb25zdGFudHMKICAgICAqLwogICAgLy8gVG9rZW4gbWV0YSBkYXRhCiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIG5hbWUgPSAiRXRoZXIgVG9rZW4iOwogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBzeW1ib2wgPSAiV0VUSCI7CiAgICB1aW50OCBjb25zdGFudCBwdWJsaWMgZGVjaW1hbHMgPSAxODsKCiAgICAvKgogICAgICogIFJlYWQgYW5kIHdyaXRlIGZ1bmN0aW9ucwogICAgICovCgogICAgLy8vIEBkZXYgRmFsbGJhY2sgdG8gY2FsbGluZyBkZXBvc2l0IHdoZW4gZXRoZXIgaXMgc2VudCBkaXJlY3RseSB0byBjb250cmFjdC4KICAgIGZ1bmN0aW9uKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgZGVwb3NpdCgpOwogICAgfQoKICAgIC8vLyBAZGV2IEJ1eXMgdG9rZW5zIHdpdGggRXRoZXIsIGV4Y2hhbmdpbmcgdGhlbSAxOjEuCiAgICBmdW5jdGlvbiBkZXBvc2l0KCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlQWRkKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBtc2cudmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLy8gQGRldiBTZWxscyB0b2tlbnMgaW4gZXhjaGFuZ2UgZm9yIEV0aGVyLCBleGNoYW5naW5nIHRoZW0gMToxLgogICAgLy8vIEBwYXJhbSBhbW91bnQgTnVtYmVyIG9mIHRva2VucyB0byBzZWxsLgogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludCBhbW91bnQpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBhbW91bnQpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgYW1vdW50KTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIuc2VuZChhbW91bnQpKTsKICAgIH0KfQoKY29udHJhY3QgVG9rZW5TYWxlIGlzIE93bmFibGUsIFNhZmVNYXRoIHsKCiAgICBldmVudCBTYWxlSW5pdGlhbGl6ZWQodWludCBzdGFydFRpbWVJblNlYyk7CiAgICBldmVudCBTYWxlRmluaXNoZWQodWludCBlbmRUaW1lSW5TZWMpOwoKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFRJTUVfUEVSSU9EX0lOX1NFQyA9IDEgZGF5czsKCiAgICBFeGNoYW5nZSBleGNoYW5nZTsKICAgIFRva2VuIHByb3RvY29sVG9rZW47CiAgICBFdGhlclRva2VuIGV0aFRva2VuOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHJlZ2lzdGVyZWQ7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBjb250cmlidXRlZDsKCiAgICBib29sIHB1YmxpYyBpc1NhbGVJbml0aWFsaXplZDsKICAgIGJvb2wgcHVibGljIGlzU2FsZUZpbmlzaGVkOwogICAgdWludCBwdWJsaWMgYmFzZUV0aENhcFBlckFkZHJlc3M7CiAgICB1aW50IHB1YmxpYyBzdGFydFRpbWVJblNlYzsKICAgIE9yZGVyIG9yZGVyOwoKICAgIHN0cnVjdCBPcmRlciB7CiAgICAgICAgYWRkcmVzcyBtYWtlcjsKICAgICAgICBhZGRyZXNzIHRha2VyOwogICAgICAgIGFkZHJlc3MgbWFrZXJUb2tlbjsKICAgICAgICBhZGRyZXNzIHRha2VyVG9rZW47CiAgICAgICAgYWRkcmVzcyBmZWVSZWNpcGllbnQ7CiAgICAgICAgdWludCBtYWtlclRva2VuQW1vdW50OwogICAgICAgIHVpbnQgdGFrZXJUb2tlbkFtb3VudDsKICAgICAgICB1aW50IG1ha2VyRmVlOwogICAgICAgIHVpbnQgdGFrZXJGZWU7CiAgICAgICAgdWludCBleHBpcmF0aW9uVGltZXN0YW1wSW5TZWM7CiAgICAgICAgdWludCBzYWx0OwogICAgICAgIHVpbnQ4IHY7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICBieXRlczMyIG9yZGVySGFzaDsKICAgIH0KCiAgICBtb2RpZmllciBzYWxlTm90SW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgcmVxdWlyZSghaXNTYWxlSW5pdGlhbGl6ZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgc2FsZVN0YXJ0ZWQoKSB7CiAgICAgICAgcmVxdWlyZShpc1NhbGVJbml0aWFsaXplZCAmJiBibG9jay50aW1lc3RhbXAgPj0gc3RhcnRUaW1lSW5TZWMpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgc2FsZU5vdEZpbmlzaGVkKCkgewogICAgICAgIHJlcXVpcmUoIWlzU2FsZUZpbmlzaGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlSZWdpc3RlcmVkKCkgewogICAgICAgIHJlcXVpcmUocmVnaXN0ZXJlZFttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB2YWxpZFN0YXJ0VGltZSh1aW50IF9zdGFydFRpbWVJblNlYykgewogICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZUluU2VjID49IGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB2YWxpZEJhc2VFdGhDYXBQZXJBZGRyZXNzKHVpbnQgX2V0aENhcFBlckFkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKF9ldGhDYXBQZXJBZGRyZXNzICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gVG9rZW5TYWxlKAogICAgICAgIGFkZHJlc3MgX2V4Y2hhbmdlLAogICAgICAgIGFkZHJlc3MgX3Byb3RvY29sVG9rZW4sCiAgICAgICAgYWRkcmVzcyBfZXRoVG9rZW4pCiAgICB7CiAgICAgICAgZXhjaGFuZ2UgPSBFeGNoYW5nZShfZXhjaGFuZ2UpOwogICAgICAgIHByb3RvY29sVG9rZW4gPSBUb2tlbihfcHJvdG9jb2xUb2tlbik7CiAgICAgICAgZXRoVG9rZW4gPSBFdGhlclRva2VuKF9ldGhUb2tlbik7CiAgICB9CgogICAgLy8vIEBkZXYgQWxsb3dzIHVzZXJzIHRvIGZpbGwgc3RvcmVkIG9yZGVyIGJ5IHNlbmRpbmcgRVRIIHRvIGNvbnRyYWN0LgogICAgZnVuY3Rpb24oKQogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICBmaWxsT3JkZXJXaXRoRXRoKCk7CiAgICB9CgogICAgLy8vIEBkZXYgU3RvcmVzIG9yZGVyIGFuZCBpbml0aWFsaXplcyBzYWxlIHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIG9yZGVyQWRkcmVzc2VzIEFycmF5IG9mIG9yZGVyJ3MgbWFrZXIsIHRha2VyLCBtYWtlclRva2VuLCB0YWtlclRva2VuLCBhbmQgZmVlUmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyBBcnJheSBvZiBvcmRlcidzIG1ha2VyVG9rZW5BbW91bnQsIHRha2VyVG9rZW5BbW91bnQsIG1ha2VyRmVlLCB0YWtlckZlZSwgZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjLCBhbmQgc2FsdC4KICAgIC8vLyBAcGFyYW0gdiBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVyIHYuCiAgICAvLy8gQHBhcmFtIHIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgLy8vIEBwYXJhbSBfc3RhcnRUaW1lSW5TZWMgVGltZSB0aGF0IHRva2VuIHNhbGUgYmVnaW5zIGluIHNlY29uZHMgc2luY2UgZXBvY2guCiAgICAvLy8gQHBhcmFtIF9iYXNlRXRoQ2FwUGVyQWRkcmVzcyBUaGUgRVRIIGNhcCBwZXIgYWRkcmVzcyBmb3IgdGhlIGZpcnN0IHRpbWUgcGVyaW9kLgogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZVNhbGUoCiAgICAgICAgYWRkcmVzc1s1XSBvcmRlckFkZHJlc3NlcywKICAgICAgICB1aW50WzZdIG9yZGVyVmFsdWVzLAogICAgICAgIHVpbnQ4IHYsCiAgICAgICAgYnl0ZXMzMiByLAogICAgICAgIGJ5dGVzMzIgcywKICAgICAgICB1aW50IF9zdGFydFRpbWVJblNlYywKICAgICAgICB1aW50IF9iYXNlRXRoQ2FwUGVyQWRkcmVzcykKICAgICAgICBwdWJsaWMKICAgICAgICBzYWxlTm90SW5pdGlhbGl6ZWQKICAgICAgICBvbmx5T3duZXIKICAgICAgICB2YWxpZFN0YXJ0VGltZShfc3RhcnRUaW1lSW5TZWMpCiAgICAgICAgdmFsaWRCYXNlRXRoQ2FwUGVyQWRkcmVzcyhfYmFzZUV0aENhcFBlckFkZHJlc3MpCiAgICB7CiAgICAgICAgb3JkZXIgPSBPcmRlcih7CiAgICAgICAgICAgIG1ha2VyOiBvcmRlckFkZHJlc3Nlc1swXSwKICAgICAgICAgICAgdGFrZXI6IG9yZGVyQWRkcmVzc2VzWzFdLAogICAgICAgICAgICBtYWtlclRva2VuOiBvcmRlckFkZHJlc3Nlc1syXSwKICAgICAgICAgICAgdGFrZXJUb2tlbjogb3JkZXJBZGRyZXNzZXNbM10sCiAgICAgICAgICAgIGZlZVJlY2lwaWVudDogb3JkZXJBZGRyZXNzZXNbNF0sCiAgICAgICAgICAgIG1ha2VyVG9rZW5BbW91bnQ6IG9yZGVyVmFsdWVzWzBdLAogICAgICAgICAgICB0YWtlclRva2VuQW1vdW50OiBvcmRlclZhbHVlc1sxXSwKICAgICAgICAgICAgbWFrZXJGZWU6IG9yZGVyVmFsdWVzWzJdLAogICAgICAgICAgICB0YWtlckZlZTogb3JkZXJWYWx1ZXNbM10sCiAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lc3RhbXBJblNlYzogb3JkZXJWYWx1ZXNbNF0sCiAgICAgICAgICAgIHNhbHQ6IG9yZGVyVmFsdWVzWzVdLAogICAgICAgICAgICB2OiB2LAogICAgICAgICAgICByOiByLAogICAgICAgICAgICBzOiBzLAogICAgICAgICAgICBvcmRlckhhc2g6IGV4Y2hhbmdlLmdldE9yZGVySGFzaChvcmRlckFkZHJlc3Nlcywgb3JkZXJWYWx1ZXMpCiAgICAgICAgfSk7CgogICAgICAgIHJlcXVpcmUob3JkZXIudGFrZXIgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShvcmRlci5tYWtlclRva2VuID09IGFkZHJlc3MocHJvdG9jb2xUb2tlbikpOwogICAgICAgIHJlcXVpcmUob3JkZXIudGFrZXJUb2tlbiA9PSBhZGRyZXNzKGV0aFRva2VuKSk7CiAgICAgICAgcmVxdWlyZShvcmRlci5mZWVSZWNpcGllbnQgPT0gYWRkcmVzcygwKSk7CgogICAgICAgIHJlcXVpcmUoaXNWYWxpZFNpZ25hdHVyZSgKICAgICAgICAgICAgb3JkZXIubWFrZXIsCiAgICAgICAgICAgIG9yZGVyLm9yZGVySGFzaCwKICAgICAgICAgICAgdiwKICAgICAgICAgICAgciwKICAgICAgICAgICAgcwogICAgICAgICkpOwoKICAgICAgICByZXF1aXJlKGV0aFRva2VuLmFwcHJvdmUoZXhjaGFuZ2UuVE9LRU5fVFJBTlNGRVJfUFJPWFlfQ09OVFJBQ1QoKSwgb3JkZXIudGFrZXJUb2tlbkFtb3VudCkpOwogICAgICAgIGlzU2FsZUluaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgICBzdGFydFRpbWVJblNlYyA9IF9zdGFydFRpbWVJblNlYzsKICAgICAgICBiYXNlRXRoQ2FwUGVyQWRkcmVzcyA9IF9iYXNlRXRoQ2FwUGVyQWRkcmVzczsKCiAgICAgICAgU2FsZUluaXRpYWxpemVkKF9zdGFydFRpbWVJblNlYyk7CiAgICB9CgogICAgLy8vIEBkZXYgRmlsbHMgb3JkZXIgdXNpbmcgbXNnLnZhbHVlLiBTaG91bGQgbm90IGJlIGNhbGxlZCBieSBjb250cmFjdHMgdW5sZXNzIGFibGUgdG8gYWNjZXNzIHRoZSBwcm90b2NvbCB0b2tlbiBhZnRlciBleGVjdXRpb24uCiAgICBmdW5jdGlvbiBmaWxsT3JkZXJXaXRoRXRoKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgc2FsZVN0YXJ0ZWQKICAgICAgICBzYWxlTm90RmluaXNoZWQKICAgICAgICBvbmx5UmVnaXN0ZXJlZAogICAgewogICAgICAgIHVpbnQgcmVtYWluaW5nRXRoID0gc2FmZVN1YihvcmRlci50YWtlclRva2VuQW1vdW50LCBleGNoYW5nZS5nZXRVbmF2YWlsYWJsZVRha2VyVG9rZW5BbW91bnQob3JkZXIub3JkZXJIYXNoKSk7CiAgICAgICAgdWludCBldGhDYXBQZXJBZGRyZXNzID0gZ2V0RXRoQ2FwUGVyQWRkcmVzcygpOwogICAgICAgIHVpbnQgYWxsb3dlZEV0aCA9IHNhZmVTdWIoZXRoQ2FwUGVyQWRkcmVzcywgY29udHJpYnV0ZWRbbXNnLnNlbmRlcl0pOwogICAgICAgIHVpbnQgZXRoVG9GaWxsID0gbWluMjU2KG1pbjI1Nihtc2cudmFsdWUsIHJlbWFpbmluZ0V0aCksIGFsbG93ZWRFdGgpOwogICAgICAgIGV0aFRva2VuLmRlcG9zaXQudmFsdWUoZXRoVG9GaWxsKSgpOwoKICAgICAgICBjb250cmlidXRlZFttc2cuc2VuZGVyXSA9IHNhZmVBZGQoY29udHJpYnV0ZWRbbXNnLnNlbmRlcl0sIGV0aFRvRmlsbCk7CgogICAgICAgIGV4Y2hhbmdlLmZpbGxPcktpbGxPcmRlcigKICAgICAgICAgICAgW29yZGVyLm1ha2VyLCBvcmRlci50YWtlciwgb3JkZXIubWFrZXJUb2tlbiwgb3JkZXIudGFrZXJUb2tlbiwgb3JkZXIuZmVlUmVjaXBpZW50XSwKICAgICAgICAgICAgW29yZGVyLm1ha2VyVG9rZW5BbW91bnQsIG9yZGVyLnRha2VyVG9rZW5BbW91bnQsIG9yZGVyLm1ha2VyRmVlLCBvcmRlci50YWtlckZlZSwgb3JkZXIuZXhwaXJhdGlvblRpbWVzdGFtcEluU2VjLCBvcmRlci5zYWx0XSwKICAgICAgICAgICAgZXRoVG9GaWxsLAogICAgICAgICAgICBvcmRlci52LAogICAgICAgICAgICBvcmRlci5yLAogICAgICAgICAgICBvcmRlci5zCiAgICAgICAgKTsKICAgICAgICB1aW50IGZpbGxlZFByb3RvY29sVG9rZW4gPSBzYWZlRGl2KHNhZmVNdWwob3JkZXIubWFrZXJUb2tlbkFtb3VudCwgZXRoVG9GaWxsKSwgb3JkZXIudGFrZXJUb2tlbkFtb3VudCk7CiAgICAgICAgcmVxdWlyZShwcm90b2NvbFRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGZpbGxlZFByb3RvY29sVG9rZW4pKTsKCiAgICAgICAgaWYgKGV0aFRvRmlsbCA8IG1zZy52YWx1ZSkgewogICAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIuc2VuZChzYWZlU3ViKG1zZy52YWx1ZSwgZXRoVG9GaWxsKSkpOwogICAgICAgIH0KICAgICAgICBpZiAocmVtYWluaW5nRXRoID09IGV0aFRvRmlsbCkgewogICAgICAgICAgICBpc1NhbGVGaW5pc2hlZCA9IHRydWU7CiAgICAgICAgICAgIFNhbGVGaW5pc2hlZChibG9jay50aW1lc3RhbXApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IENoYW5nZXMgcmVnaXN0cmF0aW9uIHN0YXR1cyBvZiBhbiBhZGRyZXNzIGZvciBwYXJ0aWNpcGF0aW9uLgogICAgLy8vIEBwYXJhbSB0YXJnZXQgQWRkcmVzcyB0aGF0IHdpbGwgYmUgcmVnaXN0ZXJlZC9kZXJlZ2lzdGVyZWQuCiAgICAvLy8gQHBhcmFtIGlzUmVnaXN0ZXJlZCBOZXcgcmVnaXN0cmF0aW9uIHN0YXR1cyBvZiBhZGRyZXNzLgogICAgZnVuY3Rpb24gY2hhbmdlUmVnaXN0cmF0aW9uU3RhdHVzKGFkZHJlc3MgdGFyZ2V0LCBib29sIGlzUmVnaXN0ZXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgICAgICBzYWxlTm90SW5pdGlhbGl6ZWQKICAgIHsKICAgICAgICByZWdpc3RlcmVkW3RhcmdldF0gPSBpc1JlZ2lzdGVyZWQ7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hhbmdlcyByZWdpc3RyYXRpb24gc3RhdHVzZXMgb2YgYWRkcmVzc2VzIGZvciBwYXJ0aWNpcGF0aW9uLgogICAgLy8vIEBwYXJhbSB0YXJnZXRzIEFkZHJlc3NlcyB0aGF0IHdpbGwgYmUgcmVnaXN0ZXJlZC9kZXJlZ2lzdGVyZWQuCiAgICAvLy8gQHBhcmFtIGlzUmVnaXN0ZXJlZCBOZXcgcmVnaXN0cmF0aW9uIHN0YXR1cyBvZiBhZGRyZXNzcy4KICAgIGZ1bmN0aW9uIGNoYW5nZVJlZ2lzdHJhdGlvblN0YXR1c2VzKGFkZHJlc3NbXSB0YXJnZXRzLCBib29sIGlzUmVnaXN0ZXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgICAgICBzYWxlTm90SW5pdGlhbGl6ZWQKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNoYW5nZVJlZ2lzdHJhdGlvblN0YXR1cyh0YXJnZXRzW2ldLCBpc1JlZ2lzdGVyZWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBDYWxjdWxhdGVzIHRoZSBFVEggY2FwIHBlciBhZGRyZXNzLiBUaGUgY2FwIGluY3JlYXNlcyBieSBkb3VibGUgdGhlIHByZXZpb3VzIGluY3JlYXNlIGF0IGVhY2ggbmV4dCBwZXJpb2QuIEUuZyAxLCAzLCA3LCAxNQogICAgLy8vIEByZXR1cm4gVGhlIGN1cnJlbnQgRVRIIGNhcCBwZXIgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIGdldEV0aENhcFBlckFkZHJlc3MoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICBpZiAoYmxvY2sudGltZXN0YW1wIDwgc3RhcnRUaW1lSW5TZWMgfHwgc3RhcnRUaW1lSW5TZWMgPT0gMCkgcmV0dXJuIDA7CgogICAgICAgIHVpbnQgdGltZVNpbmNlU3RhcnRJblNlYyA9IHNhZmVTdWIoYmxvY2sudGltZXN0YW1wLCBzdGFydFRpbWVJblNlYyk7CiAgICAgICAgdWludCBjdXJyZW50UGVyaW9kID0gc2FmZUFkZCggICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50UGVyaW9kIGJlZ2lucyBhdCAxCiAgICAgICAgICAgICAgc2FmZURpdih0aW1lU2luY2VTdGFydEluU2VjLCBUSU1FX1BFUklPRF9JTl9TRUMpLCAvLyByb3VuZHMgZG93bgogICAgICAgICAgICAgIDEKICAgICAgICApOwoKICAgICAgICB1aW50IGV0aENhcFBlckFkZHJlc3MgPSBzYWZlTXVsKAogICAgICAgICAgICBiYXNlRXRoQ2FwUGVyQWRkcmVzcywKICAgICAgICAgICAgc2FmZVN1YigKICAgICAgICAgICAgICAgIDIgKiogY3VycmVudFBlcmlvZCwKICAgICAgICAgICAgICAgIDEKICAgICAgICAgICAgKQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGV0aENhcFBlckFkZHJlc3M7CiAgICB9CgogICAgLy8vIEBkZXYgVmVyaWZpZXMgdGhhdCBhbiBvcmRlciBzaWduYXR1cmUgaXMgdmFsaWQuCiAgICAvLy8gQHBhcmFtIHB1YktleSBQdWJsaWMgYWRkcmVzcyBvZiBzaWduZXIuCiAgICAvLy8gQHBhcmFtIGhhc2ggU2lnbmVkIEtlY2Nhay0yNTYgaGFzaC4KICAgIC8vLyBAcGFyYW0gdiBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVyIHYuCiAgICAvLy8gQHBhcmFtIHIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyBzLgogICAgLy8vIEByZXR1cm4gVmFsaWRpdHkgb2Ygb3JkZXIgc2lnbmF0dXJlLgogICAgZnVuY3Rpb24gaXNWYWxpZFNpZ25hdHVyZSgKICAgICAgICBhZGRyZXNzIHB1YktleSwKICAgICAgICBieXRlczMyIGhhc2gsCiAgICAgICAgdWludDggdiwKICAgICAgICBieXRlczMyIHIsCiAgICAgICAgYnl0ZXMzMiBzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gcHViS2V5ID09IGVjcmVjb3ZlcigKICAgICAgICAgICAga2VjY2FrMjU2KCJceDE5RXRoZXJldW0gU2lnbmVkIE1lc3NhZ2U6XG4zMiIsIGhhc2gpLAogICAgICAgICAgICB2LAogICAgICAgICAgICByLAogICAgICAgICAgICBzCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBHZXR0ZXIgZnVuY3Rpb24gZm9yIGluaXRpYWxpemVkIG9yZGVyJ3Mgb3JkZXJIYXNoLgogICAgLy8vIEByZXR1cm4gb3JkZXJIYXNoIG9mIGluaXRpYWxpemVkIG9yZGVyIG9yIG51bGwuCiAgICBmdW5jdGlvbiBnZXRPcmRlckhhc2goKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikKICAgIHsKICAgICAgICByZXR1cm4gb3JkZXIub3JkZXJIYXNoOwogICAgfQoKICAgIC8vLyBAZGV2IEdldHRlciBmdW5jdGlvbiBmb3IgaW5pdGlhbGl6ZWQgb3JkZXIncyBtYWtlclRva2VuQW1vdW50LgogICAgLy8vIEByZXR1cm4gbWFrZXJUb2tlbkFtb3VudCBvZiBpbml0aWFsaXplZCBvcmRlciBvciAwLgogICAgZnVuY3Rpb24gZ2V0T3JkZXJNYWtlclRva2VuQW1vdW50KCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIG9yZGVyLm1ha2VyVG9rZW5BbW91bnQ7CiAgICB9CgogICAgLy8vIEBkZXYgR2V0dGVyIGZ1bmN0aW9uIGZvciBpbml0aWFsaXplZCBvcmRlcidzIHRha2VyVG9rZW5BbW91bnQuCiAgICAvLy8gQHJldHVybiB0YWtlclRva2VuQW1vdW50IG9mIGluaXRpYWxpemVkIG9yZGVyIG9yIDAuCiAgICBmdW5jdGlvbiBnZXRPcmRlclRha2VyVG9rZW5BbW91bnQoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gb3JkZXIudGFrZXJUb2tlbkFtb3VudDsKICAgIH0KfQ=='.
	

]
