Class {
	#name : #SRT1e33c0f122e136152b3c8725bb57af20ea94370b,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1e33c0f122e136152b3c8725bb57af20ea94370b >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewoKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYSAvIGI7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gYXNzZXJ0VHJ1ZShib29sIHZhbCkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHZhbCk7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnRGYWxzZShib29sIHZhbCkgaW50ZXJuYWwgewogICAgYXNzZXJ0KCF2YWwpOwogIH0KfQoKCi8qKgogKiBFUkMyMEJhc2ljCiAqIFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKfQoKCi8qKgogKiBFUkMyMCBpbnRlcmZhY2UKICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgoKLyoqCiAqIEJhc2ljIHRva2VuLgogKiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CgogIC8qKgogICAqIEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLgogICAqLwogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICBpZiAobXNnLmRhdGEubGVuZ3RoIDwgc2l6ZSArIDQpIHsKICAgICAgIHJldmVydCgpOwogICAgIH0KICAgICBfOwogIH0KCiAgLyoqCiAgKiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgKiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cn0KCgovKioKICogU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogSW1wbGVtYW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgQmFzaWNUb2tlbiwgRVJDMjAgewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogIC8qKgogICAqIFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgzICogMzIpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWFobGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7CiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICBpZiAoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0gMCkpIHJldmVydCgpOwogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICB9CgogIC8qKgogICAqIEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYW4gYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cn0KCi8qKgogKiBDb250cm9sbGVyIGludGVyZmFjZS4KICovCmNvbnRyYWN0IENvbnRyb2xsZXIgewoKICAvKioKICAgKiBDYWxsZWQgdG8gZGV0ZXJtaW5lIGlmIHRoZSB0b2tlbiBhbGxvd3MgcHJveHkgcGF5bWVudHMuCiAgICoKICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgc2VudCBldGhlciB0byB0aGUgdG9rZW4gY29udHJhY3QKICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgKi8KICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgLyoqCiAgICogQ2FsbGVkIHRvIGRldGVybWluZSBpZiB0aGUgY29udHJvbGxlciBhcHByb3ZlcyBhIHRva2VuIHRyYW5zZmVyLgogICAqCiAgICogQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgICogQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAgKiBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgKi8KICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCk7CgogIC8qKgogICAqIENhbGxlZCB0byBub3RpZnkgdGhlIGNvbnRyb2xsZXIgb2YgYSB0cmFuc2ZlciBhcHByb3ZhbC4KICAgKgogICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgKiBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgKi8KICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKTsKfQoKCi8qKgogKiBDb250cm9sbGVkLgogKi8KY29udHJhY3QgQ29udHJvbGxlZCB7CgogIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7CgogIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7CiAgICBjb250cm9sbGVyID0gbXNnLnNlbmRlcjsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfY29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgewogICAgY29udHJvbGxlciA9IF9jb250cm9sbGVyOwogIH0KCiAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgcmV2ZXJ0KCk7CiAgICBfOwogIH0KfQoKCi8qKgogKiBBIHRyYWl0IHRoYXQgYWxsb3dzIGFueSB0b2tlbiBvd25lciB0byBkZWNyZWFzZSB0aGUgdG9rZW4gc3VwcGx5LgogKgogKiBXZSBhZGQgYSBCdXJuZWQgZXZlbnQgdG8gZGlmZmVyZW50aWF0ZSBmcm9tIG5vcm1hbCB0cmFuc2ZlcnMuCiAqIEhvd2V2ZXIsIHdlIHN0aWxsIHRyeSB0byBzdXBwb3J0IHNvbWUgbGVnYWN5IEV0aGVyZXVtIGVjb3N5c3RlbSwKICogYXMgRVJDLTIwIGhhcyBub3Qgc3RhbmRhcmRpemVkIG9uIHRoZSBidXJuIGV2ZW50IHlldC4KICovCmNvbnRyYWN0IEJ1cm5hYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IEJVUk5fQUREUkVTUyA9IDA7CgogIGV2ZW50IEJ1cm5lZChhZGRyZXNzIGJ1cm5lciwgdWludCBidXJuZWRBbW91bnQpOwoKICAvKioKICAgKiBCdXJuIGV4dHJhIHRva2VucyBmcm9tIGEgYmFsYW5jZS4KICAgKgogICAqIEtlZXBzIHRva2VuIGJhbGFuY2UgdHJhY2tpbmcgc2VydmljZXMgaGFwcHkgYnkgc2VuZGluZyB0aGUgYnVybmVkCiAgICogYW1vdW50IHRvIEJVUk5fQUREUkVTUywgc28gdGhhdCBpdCB3aWxsIHNob3cgdXAgYXMgYSBFUkMtMjAgdHJhbnNhY3Rpb24KICAgKiBpbiBldGhlcnNjYW4sIGV0Yy4gYXMgdGhlcmUgaXMgbm8gc3RhbmRhcmRpemVkIGJ1cm4gZXZlbnQgeWV0LgogICAqCiAgICogQHBhcmFtIGJ1cm5BbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYnVybgogICAqLwogIGZ1bmN0aW9uIGJ1cm4odWludCBidXJuQW1vdW50KSB7CiAgICBhZGRyZXNzIGJ1cm5lciA9IG1zZy5zZW5kZXI7CiAgICBiYWxhbmNlc1tidXJuZXJdID0gYmFsYW5jZXNbYnVybmVyXS5zdWIoYnVybkFtb3VudCk7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihidXJuQW1vdW50KTsKCiAgICBCdXJuZWQoYnVybmVyLCBidXJuQW1vdW50KTsKICAgIFRyYW5zZmVyKGJ1cm5lciwgQlVSTl9BRERSRVNTLCBidXJuQW1vdW50KTsKICB9Cn0KCgovKioKICogTWludGFibGUgdG9rZW4uCiAqCiAqIFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqLwpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIENvbnRyb2xsZWQgewoKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5ID0gMDsKCiAgLyoqCiAgICogRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIG9ubHlDb250cm9sbGVyIGNhbk1pbnQgcmV0dXJucyAoYm9vbCkgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICBpZiAobWludGluZ0ZpbmlzaGVkKSByZXZlcnQoKTsKICAgIF87CiAgfQp9CgoKLyoqCiAqIExpbWl0ZWRUcmFuc2ZlclRva2VuCiAqCiAqIExpbWl0ZWRUcmFuc2ZlclRva2VuIGRlZmluZXMgdGhlIGdlbmVyaWMgaW50ZXJmYWNlIGFuZCB0aGUgaW1wbGVtZW50YXRpb24gdG8gbGltaXQgdG9rZW4KICogdHJhbnNmZXJhYmlsaXR5IGZvciBkaWZmZXJlbnQgZXZlbnRzLiBJdCBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGFzIGEgYmFzZSBjbGFzcyBmb3Igb3RoZXIgdG9rZW4KICogY29udHJhY3RzLgogKiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBoYXMgYmVlbiBkZXNpZ25lZCB0byBhbGxvdyBmb3IgZGlmZmVyZW50IGxpbWl0aW5nIGZhY3RvcnMsCiAqIHRoaXMgY2FuIGJlIGFjaGlldmVkIGJ5IHJlY3Vyc2l2ZWx5IGNhbGxpbmcgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKCkgdW50aWwgdGhlIGJhc2UgY2xhc3MgaXMKICogaGl0LiBGb3IgZXhhbXBsZToKICogICAgIGZ1bmN0aW9uIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAqICAgICAgIHJldHVybiBtaW4yNTYodW5sb2NrZWRUb2tlbnMsIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpKTsKICogICAgIH0KICogQSB3b3JraW5nIGV4YW1wbGUgaXMgVmVzdGVkVG9rZW4uc29sOgogKi8KY29udHJhY3QgTGltaXRlZFRyYW5zZmVyVG9rZW4gaXMgRVJDMjAgewoKICAvKioKICAgKiBDaGVja3Mgd2hldGhlciBpdCBjYW4gdHJhbnNmZXIgb3Igb3RoZXJ3aXNlIHRocm93cwogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdmFsdWUpIHsKICAgIGlmIChfdmFsdWUgPiB0cmFuc2ZlcmFibGVUb2tlbnMoX3NlbmRlciwgdWludDY0KG5vdykpKSByZXZlcnQoKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuCiAgICoKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdmFsdWUpIHsKICAgIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogLyoqCiAgKiBDaGVja3MgbW9kaWZpZXIgYW5kIGFsbG93cyB0cmFuc2ZlciBpZiB0b2tlbnMgYXJlIG5vdCBsb2NrZWQuCiAgKgogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIHRva2VucwogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgewogICAgc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAgKiBEZWZhdWx0IHRyYW5zZmVyYWJsZSB0b2tlbnMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdG9rZW5zIGZvciBhIGhvbGRlciAobm8gbGltaXQpLgogICAqCiAgICogT3ZlcnJpZGluZyB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBpcyB0aGUgd2F5IHRvIHByb3ZpZGUgdGhlCiAgICogc3BlY2lmaWMgbG9naWMgZm9yIGxpbWl0aW5nIHRva2VuIHRyYW5zZmVyYWJpbGl0eSBmb3IgYSBob2xkZXIgb3ZlciB0aW1lLgogICAqCiAgICogQHBhcmFtIGhvbGRlciBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gaG9sZGVyCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgLyogdGltZSAqLykgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBiYWxhbmNlT2YoaG9sZGVyKTsKICB9Cn0KCgovKioKICogVXBncmFkZSBhZ2VudCBpbnRlcmZhY2UuCiAqCiAqIFVwZ3JhZGUgYWdlbnQgdHJhbnNmZXJzIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4gVGhlIHVwZ3JhZGUgYWdlbnQgaXRzZWxmCiAqIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYW4gaW50ZXJtZWRpYXJ5IGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKCiAgdWludCBwdWJsaWMgb3JpZ2luYWxTdXBwbHk7CgogIGZ1bmN0aW9uIGlzVXBncmFkZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYzsKfQoKCi8qKgogKiBBIHRva2VuIHVwZ3JhZGUgbWVjaGFuaXNtIHdoZXJlIHVzZXJzIGNhbiBvcHQtaW4gYW1vdW50IG9mIHRva2VucwogKiB0byB0aGUgbmV4dCBzbWFydCBjb250cmFjdCByZXZpc2lvbi4KICoKICovCmNvbnRyYWN0IFVwZ3JhZGVhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogIC8qKiBDb250cmFjdC9hY3RvciB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiAqLwogIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVDb250cm9sbGVyOwoKICAvKiogRGVzaWduYXRlZCB1cGdyYWRlIGFnZW50IHJlc3BvbnNpYmxlIGZvciBjb21wbGV0aW5nIHRoZSB1cGdyYWRlLiAqLwogIFVwZ3JhZGVBZ2VudCBwdWJsaWMgdXBncmFkZUFnZW50OwoKICAvKiogTnVtYmVyIG9mIHRva2VucyB1cGdyYWRlZCB0byBkYXRlLiAqLwogIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CgogIC8qKgogICAqIFVwZ3JhZGUgc3RhdGVzOgogICAqCiAgICogLSBOb3RBbGxvd2VkOiB0aGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZWdpbgogICAqIC0gV2FpdGluZ0ZvckFnZW50OiB0b2tlbiBhbGxvd3MgdXBncmFkZSwgYnV0IHdlIGRvbid0IGhhdmUgYSBuZXcgYWdlbnQgeWV0CiAgICogLSBSZWFkeVRvVXBncmFkZTogdGhlIGFnZW50IGlzIHNldCwgYnV0IG5vdCBhIHNpbmdsZSB0b2tlbiBoYXMgYmVlbiB1cGdyYWRlZCB5ZXQKICAgKiAtIFVwZ3JhZGluZzogdXBncmFkZSBhZ2VudCBpcyBzZXQgYW5kIHRoZSBiYWxhbmNlIGhvbGRlcnMgY2FuIHVwZ3JhZGUgdGhlaXIgdG9rZW5zCiAgICoKICAgKi8KICBlbnVtIFVwZ3JhZGVTdGF0ZSB7VW5rbm93biwgTm90QWxsb3dlZCwgV2FpdGluZ0ZvckFnZW50LCBSZWFkeVRvVXBncmFkZSwgVXBncmFkaW5nfQoKICAvKioKICAgKiBFbWl0dGVkIHdoZW4gYSB0b2tlbiBob2xkZXIgdXBncmFkZXMgc29tZSBwb3J0aW9uIG9mIHRva2VuIGhvbGRpbmdzLgogICAqLwogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CgogIC8qKgogICAqIE5ldyB1cGdyYWRlIGFnZW50IGhhcyBiZWVuIHNldC4KICAgKi8KICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7CgogIC8qKgogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIGNvbnRyb2xsZXIuCiAgICovCiAgZnVuY3Rpb24gVXBncmFkZWFibGVUb2tlbihhZGRyZXNzIF91cGdyYWRlQ29udHJvbGxlcikgewogICAgdXBncmFkZUNvbnRyb2xsZXIgPSBfdXBncmFkZUNvbnRyb2xsZXI7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0aGUgdG9rZW4gaG9sZGVyIHRvIHVwZ3JhZGUgc29tZSBvZiB0aGVpciB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gdXBncmFkZSh1aW50MjU2IHZhbHVlKSBwdWJsaWMgewogICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgICAgaWYgKCEoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpKSB7CiAgICAgICAgcmV2ZXJ0KCk7IC8vIGNhbGxlZCBpbiBhbiBpbnZhbGlkIHN0YXRlCiAgICAgIH0KCiAgICAgIGlmICh2YWx1ZSA9PSAwKSByZXZlcnQoKTsgLy8gdmFsaWRhdGUgaW5wdXQgdmFsdWUKCiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKHZhbHVlKTsKCiAgICAgIC8vIFRha2UgdG9rZW5zIG91dCBmcm9tIGNpcmN1bGF0aW9uCiAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKHZhbHVlKTsKICAgICAgdG90YWxVcGdyYWRlZCA9IHRvdGFsVXBncmFkZWQuYWRkKHZhbHVlKTsKCiAgICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2VucwogICAgICB1cGdyYWRlQWdlbnQudXBncmFkZUZyb20obXNnLnNlbmRlciwgdmFsdWUpOwogICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBjYW4gaGFuZGxlLgogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVBZ2VudChhZGRyZXNzIGFnZW50KSBleHRlcm5hbCB7CiAgICAgIGlmICghY2FuVXBncmFkZSgpKSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICAgIH0KCiAgICAgIGlmIChhZ2VudCA9PSAweDApIHJldmVydCgpOwogICAgICBpZiAobXNnLnNlbmRlciAhPSB1cGdyYWRlQ29udHJvbGxlcikgcmV2ZXJ0KCk7IC8vIG9ubHkgdXBncmFkZSBjb250cm9sbGVyIGNhbiBkZXNpZ25hdGUgdGhlIG5leHQgYWdlbnQKICAgICAgaWYgKGdldFVwZ3JhZGVTdGF0ZSgpID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpIHJldmVydCgpOyAvLyB1cGdyYWRlIGhhcyBhbHJlYWR5IHN0YXJ0ZWQgZm9yIGFuIGFnZW50CgogICAgICB1cGdyYWRlQWdlbnQgPSBVcGdyYWRlQWdlbnQoYWdlbnQpOwoKICAgICAgaWYgKCF1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSkgcmV2ZXJ0KCk7IC8vIGJhZCBpbnRlcmZhY2UKICAgICAgaWYgKHVwZ3JhZGVBZ2VudC5vcmlnaW5hbFN1cHBseSgpICE9IHRvdGFsU3VwcGx5KSByZXZlcnQoKTsgLy8gZW5zdXJlIHRoYXQgdG9rZW4gc3VwcGxpZXMgbWF0Y2ggaW4gc291cmNlIGFuZCB0YXJnZXQKCiAgICAgIFVwZ3JhZGVBZ2VudFNldCh1cGdyYWRlQWdlbnQpOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBzdGF0ZSBvZiB0aGUgdG9rZW4gdXBncmFkZS4KICAgKi8KICBmdW5jdGlvbiBnZXRVcGdyYWRlU3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhVcGdyYWRlU3RhdGUpIHsKICAgIGlmICghY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsKICAgIGVsc2UgaWYgKHRvdGFsVXBncmFkZWQgPT0gMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZTsKICAgIGVsc2UgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmc7CiAgfQoKICAvKioKICAgKiBDaGFuZ2UgdGhlIHVwZ3JhZGUgY29udHJvbGxlci4KICAgKgogICAqIFRoaXMgYWxsb3dzIHVzIHRvIHNldCBhIG5ldyBvd25lciBmb3IgdGhlIHVwZ3JhZGUgbWVjaGFuaXNtLgogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVDb250cm9sbGVyKGFkZHJlc3MgY29udHJvbGxlcikgcHVibGljIHsKICAgICAgaWYgKGNvbnRyb2xsZXIgPT0gMHgwKSByZXZlcnQoKTsKICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZUNvbnRyb2xsZXIpIHJldmVydCgpOwogICAgICB1cGdyYWRlQ29udHJvbGxlciA9IGNvbnRyb2xsZXI7CiAgfQoKICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gb3ZlcnJpZGUgdG8gY29uZGl0aW9uIGVuYWJsZSB1cGdyYWRlIHBhdGguCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCgovKioKICogVmVzdGVkIHRva2VuLgogKgogKiBUb2tlbnMgdGhhdCBjYW4gYmUgdmVzdGVkIGZvciBhIGdyb3VwIG9mIGFkZHJlc3Nlcy4KICovCmNvbnRyYWN0IFZlc3RlZFRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIExpbWl0ZWRUcmFuc2ZlclRva2VuIHsKCiAgdWludDI1NiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTID0gMjA7CgogIHN0cnVjdCBUb2tlbkdyYW50IHsKICAgIGFkZHJlc3MgZ3JhbnRlcjsgICAgIC8vIDIwIGJ5dGVzCiAgICB1aW50MjU2IHZhbHVlOyAgICAgICAvLyAzMiBieXRlcwogICAgdWludDY0IGNsaWZmOwogICAgdWludDY0IHZlc3Rpbmc7CiAgICB1aW50NjQgc3RhcnQ7ICAgICAgICAvLyAzICogOCA9IDI0IGJ5dGVzCiAgICBib29sIHJldm9rYWJsZTsKICAgIGJvb2wgYnVybnNPblJldm9rZTsgIC8vIDIgKiAxID0gMiBiaXRzPyBvciAyIGJ5dGVzPwogIH0gLy8gdG90YWwgNzggYnl0ZXMgPSAzIHNzdG9yZSBwZXIgb3BlcmF0aW9uICgzMiBwZXIgc3N0b3JlKQoKICBtYXBwaW5nIChhZGRyZXNzID0+IFRva2VuR3JhbnRbXSkgcHVibGljIGdyYW50czsKCiAgZXZlbnQgTmV3VG9rZW5HcmFudChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGdyYW50SWQpOwoKICAvKioKICAgKiBHcmFudCB0b2tlbnMgdG8gYSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgKgogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB0aGUgdG9rZW5zIHdpbGwgYmUgZ3JhbnRlZCB0by4KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgKiBAcGFyYW0gX3N0YXJ0IHVpbnQ2NCBUaW1lIG9mIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGdyYW50LgogICAqIEBwYXJhbSBfY2xpZmYgdWludDY0IFRpbWUgb2YgdGhlIGNsaWZmIHBlcmlvZC4KICAgKiBAcGFyYW0gX3Zlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgKiBAcGFyYW0gX3Jldm9rYWJsZSBib29sIElmIHRoZSBncmFudCBpcyByZXZva2FibGUuCiAgICogQHBhcmFtIF9idXJuc09uUmV2b2tlIGJvb2wgV2hlbiB0cnVlLCB0aGUgdG9rZW5zIGFyZSBidXJuZWQgaWYgcmV2b2tlZC4KICAgKi8KICBmdW5jdGlvbiBncmFudFZlc3RlZFRva2VucygKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdmFsdWUsCiAgICB1aW50NjQgX3N0YXJ0LAogICAgdWludDY0IF9jbGlmZiwKICAgIHVpbnQ2NCBfdmVzdGluZywKICAgIGJvb2wgX3Jldm9rYWJsZSwKICAgIGJvb2wgX2J1cm5zT25SZXZva2UKICApIHB1YmxpYyB7CgogICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3IKICAgIGlmIChfY2xpZmYgPCBfc3RhcnQgfHwgX3Zlc3RpbmcgPCBfY2xpZmYpIHsKICAgICAgcmV2ZXJ0KCk7CiAgICB9CgogICAgaWYgKHRva2VuR3JhbnRzQ291bnQoX3RvKSA+IE1BWF9HUkFOVFNfUEVSX0FERFJFU1MpIHJldmVydCgpOyAgLy8gVG8gcHJldmVudCBhIHVzZXIgYmVpbmcgc3BhbW1lZCBhbmQgaGF2ZSBoaXMgYmFsYW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9ja2VkIChvdXQgb2YgZ2FzIGF0dGFjayB3aGVuIGNhbGN1bGF0aW5nIHZlc3RpbmcpLgoKICAgIHVpbnQgY291bnQgPSBncmFudHNbX3RvXS5wdXNoKAogICAgICAgICAgICAgICAgVG9rZW5HcmFudCgKICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSA/IG1zZy5zZW5kZXIgOiAwLCAgLy8gYXZvaWQgc3RvcmluZyBhbiBleHRyYSAyMCBieXRlcyB3aGVuIGl0IGlzIG5vbi1yZXZva2FibGUKICAgICAgICAgICAgICAgICAgX3ZhbHVlLAogICAgICAgICAgICAgICAgICBfY2xpZmYsCiAgICAgICAgICAgICAgICAgIF92ZXN0aW5nLAogICAgICAgICAgICAgICAgICBfc3RhcnQsCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUsCiAgICAgICAgICAgICAgICAgIF9idXJuc09uUmV2b2tlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKTsKICAgIHRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIE5ld1Rva2VuR3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIGNvdW50IC0gMSk7CiAgfQoKICAvKioKICAgKiBSZXZva2UgdGhlIGdyYW50IG9mIHRva2VucyBvZiBhIHNwZWNpZmllZCBhZGRyZXNzLgogICAqCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZAogICAqIEBwYXJhbSBfZ3JhbnRJZCBUaGUgaWQgb2YgdGhlIHRva2VuIGdyYW50CiAgICovCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIHB1YmxpYyB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGlmICghZ3JhbnQucmV2b2thYmxlKSB7IC8vIGNoZWNrIGlmIGdyYW50IGlzIHJldm9rYWJsZQogICAgICByZXZlcnQoKTsKICAgIH0KCiAgICBpZiAoZ3JhbnQuZ3JhbnRlciAhPSBtc2cuc2VuZGVyKSB7IC8vIG9ubHkgZ3JhbnRlciB0byByZXZva2UgdGhlIGdyYW50CiAgICAgIHJldmVydCgpOwogICAgfQoKICAgIGFkZHJlc3MgcmVjZWl2ZXIgPSBncmFudC5idXJuc09uUmV2b2tlID8gMHgwIDogbXNnLnNlbmRlcjsKICAgIHVpbnQyNTYgbm9uVmVzdGVkID0gbm9uVmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7CgogICAgLy8gcmVtb3ZlIGdyYW50IGZyb20gYXJyYXkKICAgIGRlbGV0ZSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwogICAgZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXSA9IGdyYW50c1tfaG9sZGVyXVtncmFudHNbX2hvbGRlcl0ubGVuZ3RoLnN1YigxKV07CiAgICBncmFudHNbX2hvbGRlcl0ubGVuZ3RoIC09IDE7CgogICAgYmFsYW5jZXNbcmVjZWl2ZXJdID0gYmFsYW5jZXNbcmVjZWl2ZXJdLmFkZChub25WZXN0ZWQpOwogICAgYmFsYW5jZXNbX2hvbGRlcl0gPSBiYWxhbmNlc1tfaG9sZGVyXS5zdWIobm9uVmVzdGVkKTsKCiAgICBUcmFuc2ZlcihfaG9sZGVyLCByZWNlaXZlciwgbm9uVmVzdGVkKTsKICB9CgogIC8qKgogICAqIENhbGN1bGF0ZSB0aGUgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMgb2YgYSBob2xkZXIgYXQgYSBnaXZlbiB0aW1lLgogICAqCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIKICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHNwZWNpZmljIHRpbWUKICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBncmFudEluZGV4ID0gdG9rZW5HcmFudHNDb3VudChob2xkZXIpOwogICAgaWYgKGdyYW50SW5kZXggPT0gMCkgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2VucwogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIG5vblZlc3RlZCA9IG5vblZlc3RlZC5hZGQobm9uVmVzdGVkVG9rZW5zKGdyYW50c1tob2xkZXJdW2ldLCB0aW1lKSk7CiAgICB9CgogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQogICAgdWludDI1NiB2ZXN0ZWRUcmFuc2ZlcmFibGUgPSBiYWxhbmNlT2YoaG9sZGVyKS5zdWIobm9uVmVzdGVkKTsKCiAgICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gb2YgaG93IG1hbnkgdmVzdGVkIGNhbiB0cmFuc2ZlciBhbmQgb3RoZXIgdmFsdWUKICAgIC8vIGluIGNhc2UgdGhlcmUgYXJlIG90aGVyIGxpbWl0aW5nIHRyYW5zZmVyYWJpbGl0eSBmYWN0b3JzIChkZWZhdWx0IGlzIGJhbGFuY2VPZikKICAgIHJldHVybiBTYWZlTWF0aC5taW4yNTYodmVzdGVkVHJhbnNmZXJhYmxlLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7CiAgfQoKICAvKioKICAgKiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLgogICAqCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGhvbGRlciBvZiB0aGUgZ3JhbnRzCiAgICogQHJldHVybiBBIHVpbnQgcmVwcmVzZW50aW5nIHRoZSB0b3RhbCBhbW91bnQgb2YgZ3JhbnRzCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudHNDb3VudChhZGRyZXNzIF9ob2xkZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgaW5kZXgpIHsKICAgIHJldHVybiBncmFudHNbX2hvbGRlcl0ubGVuZ3RoOwogIH0KCiAgLyoqCiAgICogQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKgogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudGVkCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcGFyYW0gc3RhcnQgdWludDY0IEEgdGltZSByZXByZXNlbnRpbmcgdGhlIGJlZ2lubmluZyBvZiB0aGUgZ3JhbnQKICAgKiBAcGFyYW0gY2xpZmYgdWludDY0IFRoZSBjbGlmZiBwZXJpb2QKICAgKiBAcGFyYW0gdmVzdGluZyB1aW50NjQgVGhlIHZlc3RpbmcgcGVyaW9kCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgZnJvbSBhIHNwZWNpZmljIGdyYW50CiAgICogIHRyYW5zZmVyYWJsZVRva2VucwogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QKICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgIC8KICAgKiAgIHwgICAgICAgICAgICAgIC58CiAgICogICB8ICAgICAgICAgICAgLiAgfAogICAqICAgfCAgICAgICAgICAuICAgIHwKICAgKiAgIHwgICAgICAgIC4gICAgICB8CiAgICogICB8ICAgICAgLiAgICAgICAgfChncmFudHNbX2hvbGRlcl0gPT0gYWRkcmVzcygwKSkgcmV0dXJuIDA7CiAgICogICB8ICAgIC4gICAgICAgICAgfAogICAqICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAqICAgICAgU3RhcnQgICAgICAgQ2xpZnQgICAgVmVzdGluZwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2Vucyh1aW50MjU2IHRva2VucywgdWludDI1NiB0aW1lLCB1aW50MjU2IHN0YXJ0LCB1aW50MjU2IGNsaWZmLCB1aW50MjU2IHZlc3RpbmcpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgLy8gU2hvcnRjdXRzIGZvciBiZWZvcmUgY2xpZmYgYW5kIGFmdGVyIHZlc3RpbmcgY2FzZXMuCiAgICAgIGlmICh0aW1lIDwgY2xpZmYpIHJldHVybiAwOwogICAgICBpZiAodGltZSA+PSB2ZXN0aW5nKSByZXR1cm4gdG9rZW5zOwoKICAgICAgLy8gSW50ZXJwb2xhdGUgYWxsIHZlc3RlZCB0b2tlbnMuCiAgICAgIC8vIEFzIGJlZm9yZSBjbGlmZiB0aGUgc2hvcnRjdXQgcmV0dXJucyAwLCB3ZSBjYW4gdXNlIGp1c3QgY2FsY3VsYXRlIGEgdmFsdWUKICAgICAgLy8gaW4gdGhlIHZlc3RpbmcgcmVjdCAoYXMgc2hvd24gaW4gYWJvdmUncyBmaWd1cmUpCgogICAgICB1aW50IHZlc3RlZFRva2VucyA9IHRva2Vucy5tdWwodGltZS5zdWIoc3RhcnQpKS5kaXYodmVzdGluZy5zdWIoc3RhcnQpKTsKICAgICAgcmV0dXJuIHZlc3RlZFRva2VuczsKICB9CgogIC8qKgogICAqIEdldCBhbGwgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZjIGdyYW50LgogICAqCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4KICAgKiBAcmV0dXJuIFJldHVybnMgYWxsIHRoZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgYSBUb2tlbkdyYW50KGFkZHJlc3MsIHZhbHVlLCBzdGFydCwgY2xpZmYsCiAgICogICAgICAgICByZXZva2FiaWxpdHksIGJ1cm5zT25SZXZva2UsIGFuZCB2ZXN0aW5nKSBwbHVzIHRoZSB2ZXN0ZWQgdmFsdWUgYXQgdGhlIGN1cnJlbnQgdGltZS4KICAgKi8KICBmdW5jdGlvbiB0b2tlbkdyYW50KGFkZHJlc3MgX2hvbGRlciwgdWludCBfZ3JhbnRJZCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nLCBib29sIHJldm9rYWJsZSwgYm9vbCBidXJuc09uUmV2b2tlKSB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOwogICAgdmFsdWUgPSBncmFudC52YWx1ZTsKICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7CiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOwogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7CiAgICByZXZva2FibGUgPSBncmFudC5yZXZva2FibGU7CiAgICBidXJuc09uUmV2b2tlID0gZ3JhbnQuYnVybnNPblJldm9rZTsKCiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgICBncmFudC52YWx1ZSwKICAgICAgdWludDI1Nih0aW1lKSwKICAgICAgdWludDI1NihncmFudC5zdGFydCksCiAgICAgIHVpbnQyNTYoZ3JhbnQuY2xpZmYpLAogICAgICB1aW50MjU2KGdyYW50LnZlc3RpbmcpCiAgICApOwogIH0KCiAgLyoqCiAgICogQ2FsY3VsYXRlIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZjIGdyYW50IG9uIHRoZQogICAqIHBhc3NlZCB0aW1lIGZyYW1lLgogICAqLwogIGZ1bmN0aW9uIG5vblZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gZ3JhbnQudmFsdWUuc3ViKHZlc3RlZFRva2VucyhncmFudCwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQ2FsY3VsYXRlIHRoZSBkYXRlIHdoZW4gdGhlIGhvbGRlciBjYW4gdHJhc2ZlciBhbGwgaXRzIHRva2VucwogICAqCiAgICogQHBhcmFtIGhvbGRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIKICAgKiBAcmV0dXJuIEFuIHVpbnQgcmVwcmVzZW50aW5nIHRoZSBkYXRlIG9mIHRoZSBsYXN0IHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gbGFzdFRva2VuSXNUcmFuc2ZlcmFibGVEYXRlKGFkZHJlc3MgaG9sZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0IGRhdGUpIHsKICAgIGRhdGUgPSB1aW50NjQobm93KTsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IGdyYW50c1tob2xkZXJdLmxlbmd0aDsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGdyYW50SW5kZXg7IGkrKykgewogICAgICBkYXRlID0gU2FmZU1hdGgubWF4NjQoZ3JhbnRzW2hvbGRlcl1baV0udmVzdGluZywgZGF0ZSk7CiAgICB9CiAgfQp9CgoKLyoqCiAqIFByb3ZpZGUgKFBSVkQpIHRva2VuIGNvbnRyYWN0LgogKi8KY29udHJhY3QgUHJvdmlkZVRva2VuIGlzIEJ1cm5hYmxlVG9rZW4sIE1pbnRhYmxlVG9rZW4sIFZlc3RlZFRva2VuLCBVcGdyYWRlYWJsZVRva2VuIHsKCiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gJ1Byb3ZpZGUnOwogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gJ1BSVkQnOwogIHVpbnQgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gODsKCiAgZnVuY3Rpb24gUHJvdmlkZVRva2VuKCkgIFVwZ3JhZGVhYmxlVG9rZW4obXNnLnNlbmRlcikgeyB9CgogIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewogICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgaWYgKCFDb250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKSByZXZlcnQoKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldmVydCgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgIHVpbnQgc2l6ZTsKICAgIGlmIChfYWRkciA9PSBhZGRyZXNzKDApKSByZXR1cm4gZmFsc2U7CiAgICBhc3NlbWJseSB7CiAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICB9CiAgICByZXR1cm4gc2l6ZSA+IDA7CiAgfQp9'.
	

]
