Class {
	#name : #SRTcebbfe09bab5493714a42de8c3a58fd385ce9c03,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcebbfe09bab5493714a42de8c3a58fd385ce9c03 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLy8gQHRpdGxlIFNUQUJMRSBQcm9qZWN0IElDTwovLy8gQGF1dGhvciBLb25yYWQgU3phxYJhcGFrIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMGE2MTY1NjQ3ODZiNmUyNDc5NzA2YjY2NmI3YTZiNjE0YTZkNjc2YjYzNjYyNDY5NjU2NyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CgovKgogKiBPd25hYmxlCiAqCiAqIEJhc2UgY29udHJhY3Qgd2l0aCBhbiBvd25lci4KICogUHJvdmlkZXMgb25seU93bmVyIG1vZGlmaWVyLCB3aGljaCBwcmV2ZW50cyBmdW5jdGlvbiBmcm9tIHJ1bm5pbmcgaWYgaXQgaXMgY2FsbGVkIGJ5IGFueW9uZSBvdGhlciB0aGFuIHRoZSBvd25lci4KICovCmNvbnRyYWN0IE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBfOwogICAgfQp9CiAgCi8qIE5ldyBFUkMyMyBjb250cmFjdCBpbnRlcmZhY2UgKi8KY29udHJhY3QgRVJDMjIzIHsKICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAKICAgIGZ1bmN0aW9uIG5hbWUoKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgX25hbWUpOwogICAgZnVuY3Rpb24gc3ltYm9sKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIF9zeW1ib2wpOwogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50OCBfZGVjaW1hbHMpOwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IF9zdXBwbHkpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlLCBieXRlcyBpbmRleGVkIGRhdGEpOwp9CgovKgoqIENvbnRyYWN0IHRoYXQgaXMgd29ya2luZyB3aXRoIEVSQzIyMyB0b2tlbnMKKi8KY29udHJhY3QgQ29udHJhY3RSZWNlaXZlciB7CiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSk7Cn0KCi8qKgoqIEVSQzIzIHRva2VuIGJ5IERleGFyYW4KKgoqIGh0dHBzOi8vZ2l0aHViLmNvbS9EZXhhcmFuL0VSQzIzLXRva2VucwoqLwogCiAKLyogaHR0cHM6Ly9naXRodWIuY29tL0x5a2tlQ2l0eS9FdGhlcmV1bUFwaURvdE5ldENvcmUvYmxvYi9tYXN0ZXIvc3JjL0NvbnRyYWN0QnVpbGRlci9jb250cmFjdHMvdG9rZW4vU2FmZU1hdGguc29sICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1BWF9VSU5UMjU2ID0KICAgIDB4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjsKCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgeCwgdWludDI1NiB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2IHopIHsKICAgICAgICBpZiAoeCA+IE1BWF9VSU5UMjU2IC0geSkgdGhyb3c7CiAgICAgICAgcmV0dXJuIHggKyB5OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVTdWIodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGlmICh4IDwgeSkgdGhyb3c7CiAgICAgICAgcmV0dXJuIHggLSB5OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVNdWwodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGlmICh5ID09IDApIHJldHVybiAwOwogICAgICAgIGlmICh4ID4gTUFYX1VJTlQyNTYgLyB5KSB0aHJvdzsKICAgICAgICByZXR1cm4geCAqIHk7CiAgICB9Cn0KCi8qKgoqIFN0YWJsZSBBd2FyZW5lc3MgVG9rZW4gLSBTVEEKKi8KY29udHJhY3QgRVJDMjIzVG9rZW5fU1RBIGlzIEVSQzIyMywgU2FmZU1hdGgsIE93bmFibGUgewogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICAgIAogICAgLy8gc3RhYmxlOgogICAgdWludDI1NiBwdWJsaWMgaWNvRW5kQmxvY2s7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGFzdCBibG9jayBudW1iZXIgb2YgSUNPIAogICAgdWludDI1NiBwdWJsaWMgbWF4U3VwcGx5OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWF4aW11bSB0b2tlbiBzdXBwbHkKICAgIHVpbnQyNTYgcHVibGljIG1pbmVkVG9rZW5Db3VudDsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvdW50ZXIgb2YgbWluZWQgdG9rZW5zCiAgICBhZGRyZXNzIHB1YmxpYyBpY29BZGRyZXNzOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGRyZXNzIG9mIElDTyBjb250cmFjdCAgICAKICAgIHVpbnQyNTYgcHJpdmF0ZSBtdWx0aXBsaWVyOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciBtYW5hZ2luZyB0b2tlbiBmcmFjdGlvbmFscwogICAgc3RydWN0IE1pbmVyIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RydWN0IGZvciBtaW5lZCB0b2tlbnMgZGF0YQogICAgICAgIHVpbnQyNTYgYmxvY2s7CiAgICAgICAgYWRkcmVzcyBtaW5lckFkZHJlc3M7CiAgICB9CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IE1pbmVyKSBwdWJsaWMgbWluZWRUb2tlbnM7ICAgICAgICAgICAvLyBtaW5lZCB0b2tlbnMgZGF0YQogICAgZXZlbnQgTWVzc2FnZUNsYWltTWluaW5nUmV3YXJkKGFkZHJlc3MgaW5kZXhlZCBtaW5lciwgdWludDI1NiBibG9jaywgdWludDI1NiBzdGEpOyAgLy8gbm90aWZpZXMgY2xpZW50cyBhYm91dCBzdGEgd2lubmluZyBtaW5lcgogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgdWludDI1NiB2YWx1ZSk7ICAgICAgICAgLy8gbm90aWZpZXMgY2xpZW50cyBhYm91dCB0aGUgYW1vdW50IGJ1cm50CiAgICAKICAgIGZ1bmN0aW9uIEVSQzIyM1Rva2VuX1NUQSgpIHsKICAgICAgICBkZWNpbWFscyA9IDg7CiAgICAgICAgbXVsdGlwbGllciA9IDEwKip1aW50MjU2KGRlY2ltYWxzKTsKICAgICAgICBtYXhTdXBwbHkgPSAxMDAwMDAwMDAwMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1heGltdW0gcG9zc2libGUgc3VwcGx5ID09IDEwMCBTVEEKICAgICAgICBuYW1lID0gIlNUQUJMRSBTVEEgVG9rZW4iOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZSBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIHN5bWJvbCA9ICJTVEEiOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBpY29FbmRCbG9jayA9IDQyMzAxNTA7ICAvLyBJTklUICAgICAgICAgICAgICAgICAgICAgIC8vIGxhc3QgYmxvY2sgbnVtYmVyIGZvciBJQ08KICAgICAgICB0b3RhbFN1cHBseSA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0b3RhbCBzdXBwbHkKICAgICAgICAvLyBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OyAgICAgICAgICAgICAgIC8vIEdpdmUgdGhlIGNyZWF0b3IgYWxsIGluaXRpYWwgdG9rZW5zCiAgICB9CiAKICAgIC8vIHRyaWdnZXIgcmV3YXJkaW5nIGEgbWluZXIgd2l0aCBTVEEgdG9rZW46CiAgICBmdW5jdGlvbiBjbGFpbU1pbmluZ1Jld2FyZCgpIHsgIAogICAgICAgIGlmIChpY29BZGRyZXNzID09IGFkZHJlc3MoMCkpIHRocm93OyAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJQ08gYWRkcmVzcyBtdXN0IGJlIHNldCB1cCBmaXJzdAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGljb0FkZHJlc3MgJiYgbXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7ICAvLyB0cmlnZ2VyaW5nIGVuYWJsZWQgb25seSBmb3IgSUNPIG9yIG93bmVyCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA+IGljb0VuZEJsb2NrKSB0aHJvdzsgICAgICAgICAgICAgICAgICAgICAgIC8vIHJld2FyZGluZyBlbmFibGVkIG9ubHkgYmVmb3JlIHRoZSBlbmQgb2YgSUNPCiAgICAgICAgaWYgKG1pbmVkVG9rZW5Db3VudCAqIG11bHRpcGxpZXIgPj0gbWF4U3VwcGx5KSB0aHJvdzsgCiAgICAgICAgaWYgKG1pbmVkVG9rZW5Db3VudCA+IDApIHsKICAgICAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgbWluZWRUb2tlbkNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChtaW5lZFRva2Vuc1tpXS5ibG9jayA9PSBibG9jay5udW1iZXIpIHRocm93OyAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0b3RhbFN1cHBseSArPSAxICogbXVsdGlwbGllcjsKICAgICAgICBiYWxhbmNlc1tibG9jay5jb2luYmFzZV0gKz0gMSAqIG11bHRpcGxpZXI7ICAgICAgICAgICAgICAgICAgLy8gcmV3YXJkIG1pbmVyIHdpdGggb25lIFNUQSB0b2tlbgogICAgICAgIG1pbmVkVG9rZW5zW21pbmVkVG9rZW5Db3VudF0gPSBNaW5lcihibG9jay5udW1iZXIsIGJsb2NrLmNvaW5iYXNlKTsKICAgICAgICBtaW5lZFRva2VuQ291bnQgKz0gMTsKICAgICAgICBNZXNzYWdlQ2xhaW1NaW5pbmdSZXdhcmQoYmxvY2suY29pbmJhc2UsIGJsb2NrLm51bWJlciwgMSAqIG11bHRpcGxpZXIpOwogICAgfSAKICAgIAogICAgZnVuY3Rpb24gc2VsZkRlc3Ryb3koKSBvbmx5T3duZXIgewogICAgICAgIGlmIChibG9jay5udW1iZXIgPD0gaWNvRW5kQmxvY2srMTQqMzQ1NikgdGhyb3c7ICAgICAgICAgICAvLyBhbGxvdyB0byBzdWljaWRlIFNUQSB0b2tlbiBhZnRlciBhcm91bmQgMiB3ZWVrcyAoMjVzL2Jsb2NrKSBmcm9tIHRoZSBlbmQgb2YgSUNPCiAgICAgICAgc3VpY2lkZSh0aGlzKTsgCiAgICB9CiAgICAvLyAvc3RhYmxlCiAgIAogICAgLy8gRnVuY3Rpb24gdG8gYWNjZXNzIG5hbWUgb2YgdG9rZW4gLgogICAgZnVuY3Rpb24gbmFtZSgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBfbmFtZSkgewogICAgICAgIHJldHVybiBuYW1lOwogICAgfQogICAgLy8gRnVuY3Rpb24gdG8gYWNjZXNzIHN5bWJvbCBvZiB0b2tlbiAuCiAgICBmdW5jdGlvbiBzeW1ib2woKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgX3N5bWJvbCkgewogICAgICAgIHJldHVybiBzeW1ib2w7CiAgICB9CiAgICAvLyBGdW5jdGlvbiB0byBhY2Nlc3MgZGVjaW1hbHMgb2YgdG9rZW4gLgogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50OCBfZGVjaW1hbHMpIHsKICAgICAgICByZXR1cm4gZGVjaW1hbHM7CiAgICB9CiAgICAvLyBGdW5jdGlvbiB0byBhY2Nlc3MgdG90YWwgc3VwcGx5IG9mIHRva2VucyAuCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX3RvdGFsU3VwcGx5KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5OwogICAgfQogICAgZnVuY3Rpb24gbWluZWRUb2tlbkNvdW50KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBfbWluZWRUb2tlbkNvdW50KSB7CiAgICAgICAgcmV0dXJuIG1pbmVkVG9rZW5Db3VudDsKICAgIH0KICAgIGZ1bmN0aW9uIGljb0FkZHJlc3MoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIF9pY29BZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGljb0FkZHJlc3M7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiBhIHVzZXIgb3IgYW5vdGhlciBjb250cmFjdCB3YW50cyB0byB0cmFuc2ZlciBmdW5kcyAuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZihpc0NvbnRyYWN0KF90bykpIHsKICAgICAgICAgICAgdHJhbnNmZXJUb0NvbnRyYWN0KF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0cmFuc2ZlclRvQWRkcmVzcyhfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAKICAgIC8vIFN0YW5kYXJkIGZ1bmN0aW9uIHRyYW5zZmVyIHNpbWlsYXIgdG8gRVJDMjAgdHJhbnNmZXIgd2l0aCBubyBfZGF0YSAuCiAgICAvLyBBZGRlZCBkdWUgdG8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgcmVhc29ucyAuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBlbXB0eTsKICAgICAgICBpZihpc0NvbnRyYWN0KF90bykpIHsKICAgICAgICAgICAgdHJhbnNmZXJUb0NvbnRyYWN0KF90bywgX3ZhbHVlLCBlbXB0eSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0cmFuc2ZlclRvQWRkcmVzcyhfdG8sIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvL2Fzc2VtYmxlIHRoZSBnaXZlbiBhZGRyZXNzIGJ5dGVjb2RlLiBJZiBieXRlY29kZSBleGlzdHMgdGhlbiB0aGUgX2FkZHIgaXMgYSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgcHJpdmF0ZSByZXR1cm5zIChib29sIGlzX2NvbnRyYWN0KSB7CiAgICAgICAgdWludCBsZW5ndGg7CiAgICAgICAgX2FkZHIgPSBfYWRkcjsgIC8vIHdvcmthcm91bmQgZm9yIE1pc3QncyBpbmFiaWxpdHkgdG8gY29tcGlsZQogICAgICAgIGlzX2NvbnRyYWN0ID0gaXNfY29udHJhY3Q7ICAvLyB3b3JrYXJvdW5kIGZvciBNaXN0J3MgaW5hYmlsaXR5IHRvIGNvbXBpbGUKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAvL3JldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBjb2RlIG9uIHRhcmdldCBhZGRyZXNzLCB0aGlzIG5lZWRzIGFzc2VtYmx5CiAgICAgICAgICAgICAgICBsZW5ndGggOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIGlmKGxlbmd0aD4wKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvL2Z1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gdHJhbnNhY3Rpb24gdGFyZ2V0IGlzIGFuIGFkZHJlc3MKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9BZGRyZXNzKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VPZihtc2cuc2VuZGVyKSA8IF92YWx1ZSkgdGhyb3c7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VPZihtc2cuc2VuZGVyKSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlT2YoX3RvKSwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogIAogICAgLy9mdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIHRyYW5zYWN0aW9uIHRhcmdldCBpcyBhIGNvbnRyYWN0CiAgICBmdW5jdGlvbiB0cmFuc2ZlclRvQ29udHJhY3QoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHJpdmF0ZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoYmFsYW5jZU9mKG1zZy5zZW5kZXIpIDwgX3ZhbHVlKSB0aHJvdzsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mKG1zZy5zZW5kZXIpLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZihfdG8pLCBfdmFsdWUpOwogICAgICAgIENvbnRyYWN0UmVjZWl2ZXIgcmVjZWl2ZXIgPSBDb250cmFjdFJlY2VpdmVyKF90byk7CiAgICAgICAgcmVjZWl2ZXIudG9rZW5GYWxsYmFjayhtc2cuc2VuZGVyLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgkKICAgIGZ1bmN0aW9uIGJ1cm4oYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChpY29BZGRyZXNzID09IGFkZHJlc3MoMCkpIHRocm93OwogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyICYmIG1zZy5zZW5kZXIgIT0gaWNvQWRkcmVzcykgdGhyb3c7IC8vIG9ubHkgb3duZXIgYW5kIGljbyBjb250cmFjdCBhcmUgYWxsb3dlZAogICAgICAgIGlmIChiYWxhbmNlc1tfYWRkcmVzc10gPCBfdmFsdWUpIHRocm93OyAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaCB0b2tlbnMKICAgICAgICBiYWxhbmNlc1tfYWRkcmVzc10gLT0gX3ZhbHVlOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKICAgICAgICB0b3RhbFN1cHBseSAtPSBfdmFsdWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIEJ1cm4oX2FkZHJlc3MsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgkKICAgIC8qIHNldHRpbmcgSUNPIGFkZHJlc3MgZm9yIGFsbG93aW5nIGV4ZWN1dGlvbiBmcm9tIHRoZSBJQ08gY29udHJhY3QgKi8KICAgIGZ1bmN0aW9uIHNldEljb0FkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgb25seU93bmVyIHsKICAgICAgICBpZiAoaWNvQWRkcmVzcyA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGljb0FkZHJlc3MgPSBfYWRkcmVzczsKICAgICAgICB9ICAgIAogICAgICAgIGVsc2UgdGhyb3c7CiAgICB9Cn0KCi8qKgoqIFN0YWJsZSBUb2tlbiAtIFNUQgoqLwpjb250cmFjdCBFUkMyMjNUb2tlbl9TVEIgaXMgRVJDMjIzLCBTYWZlTWF0aCwgT3duYWJsZSB7CiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogICAgCiAgICAvLyBzdGFibGU6CiAgICB1aW50MjU2IHB1YmxpYyBtYXhTdXBwbHk7CiAgICB1aW50MjU2IHB1YmxpYyBpY29FbmRCbG9jazsKICAgIGFkZHJlc3MgcHVibGljIGljb0FkZHJlc3M7CgkKICAgIGZ1bmN0aW9uIEVSQzIyM1Rva2VuX1NUQigpIHsKICAgICAgICB0b3RhbFN1cHBseSA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0b3RhbCBzdXBwbHkKICAgICAgICBtYXhTdXBwbHkgPSAxMDAwMDAwMDAwMDAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1heGltdW0gcG9zc2libGUgc3VwcGx5IG9mIFNUQiA9PSAxMDBNIFNUQgogICAgICAgIG5hbWUgPSAiU1RBQkxFIFNUQiBUb2tlbiI7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgZGVjaW1hbHMgPSA0OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbW91bnQgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBzeW1ib2wgPSAiU1RCIjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgaWNvRW5kQmxvY2sgPSA0MjMwMTUwOyAgLy8gSU5JVCAgICAgICAgICAgICAgICAgICAgICAvLyBsYXN0IGJsb2NrIG51bWJlciBvZiBJQ08gIC8vIElOSVQgUEFSQU0gICAgICAgICAgICAgCiAgICAgICAgLy9iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OyAgICAgICAgICAgICAgICAvLyBHaXZlIHRoZSBjcmVhdG9yIGFsbCBpbml0aWFsIHRva2VucyAgICAgICAKICAgIH0KICAgIAogICAgLy8gRnVuY3Rpb24gdG8gYWNjZXNzIG1heCBzdXBwbHkgb2YgdG9rZW5zIC4KICAgIGZ1bmN0aW9uIG1heFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX21heFN1cHBseSkgewogICAgICAgIHJldHVybiBtYXhTdXBwbHk7CiAgICB9CiAgICAvLyAvc3RhYmxlCiAgCiAgICAvLyBGdW5jdGlvbiB0byBhY2Nlc3MgbmFtZSBvZiB0b2tlbiAuCiAgICBmdW5jdGlvbiBuYW1lKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nIF9uYW1lKSB7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CiAgICAvLyBGdW5jdGlvbiB0byBhY2Nlc3Mgc3ltYm9sIG9mIHRva2VuIC4KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBfc3ltYm9sKSB7CiAgICAgICAgcmV0dXJuIHN5bWJvbDsKICAgIH0KICAgIC8vIEZ1bmN0aW9uIHRvIGFjY2VzcyBkZWNpbWFscyBvZiB0b2tlbiAuCiAgICBmdW5jdGlvbiBkZWNpbWFscygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IF9kZWNpbWFscykgewogICAgICAgIHJldHVybiBkZWNpbWFsczsKICAgIH0KICAgIC8vIEZ1bmN0aW9uIHRvIGFjY2VzcyB0b3RhbCBzdXBwbHkgb2YgdG9rZW5zIC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBfdG90YWxTdXBwbHkpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHk7CiAgICB9CiAgICBmdW5jdGlvbiBpY29BZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBfaWNvQWRkcmVzcykgewogICAgICAgIHJldHVybiBpY29BZGRyZXNzOwogICAgfQoKICAgIC8vIEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMgLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYoaXNDb250cmFjdChfdG8pKSB7CiAgICAgICAgICAgIHRyYW5zZmVyVG9Db250cmFjdChfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgCiAgICAvLyBTdGFuZGFyZCBmdW5jdGlvbiB0cmFuc2ZlciBzaW1pbGFyIHRvIEVSQzIwIHRyYW5zZmVyIHdpdGggbm8gX2RhdGEgLgogICAgLy8gQWRkZWQgZHVlIHRvIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHJlYXNvbnMgLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBieXRlcyBtZW1vcnkgZW1wdHk7CiAgICAgICAgaWYoaXNDb250cmFjdChfdG8pKSB7CiAgICAgICAgICAgIHRyYW5zZmVyVG9Db250cmFjdChfdG8sIF92YWx1ZSwgZW1wdHkpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdHJhbnNmZXJUb0FkZHJlc3MoX3RvLCBfdmFsdWUsIGVtcHR5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy9hc3NlbWJsZSB0aGUgZ2l2ZW4gYWRkcmVzcyBieXRlY29kZS4gSWYgYnl0ZWNvZGUgZXhpc3RzIHRoZW4gdGhlIF9hZGRyIGlzIGEgY29udHJhY3QuCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBpc19jb250cmFjdCkgewogICAgICAgIHVpbnQgbGVuZ3RoOwogICAgICAgIF9hZGRyID0gX2FkZHI7ICAvLyB3b3JrYXJvdW5kIGZvciBNaXN0J3MgaW5hYmlsaXR5IHRvIGNvbXBpbGUKICAgICAgICBpc19jb250cmFjdCA9IGlzX2NvbnRyYWN0OyAgLy8gd29ya2Fyb3VuZCBmb3IgTWlzdCdzIGluYWJpbGl0eSB0byBjb21waWxlCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvL3JldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBjb2RlIG9uIHRhcmdldCBhZGRyZXNzLCB0aGlzIG5lZWRzIGFzc2VtYmx5CiAgICAgICAgICAgIGxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgaWYobGVuZ3RoPjApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0cmFuc2FjdGlvbiB0YXJnZXQgaXMgYW4gYWRkcmVzcwogICAgZnVuY3Rpb24gdHJhbnNmZXJUb0FkZHJlc3MoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHJpdmF0ZSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoYmFsYW5jZU9mKG1zZy5zZW5kZXIpIDwgX3ZhbHVlKSB0aHJvdzsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mKG1zZy5zZW5kZXIpLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VPZihfdG8pLCBfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgCiAgICAvL2Z1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gdHJhbnNhY3Rpb24gdGFyZ2V0IGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9Db250cmFjdChhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwcml2YXRlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlT2YobXNnLnNlbmRlcikgPCBfdmFsdWUpIHRocm93OwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlT2YobXNnLnNlbmRlciksIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZU9mKF90byksIF92YWx1ZSk7CiAgICAgICAgQ29udHJhY3RSZWNlaXZlciByZWNlaXZlciA9IENvbnRyYWN0UmVjZWl2ZXIoX3RvKTsKICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICAvKiBzZXR0aW5nIElDTyBhZGRyZXNzIGZvciBhbGxvd2luZyBleGVjdXRpb24gZnJvbSB0aGUgSUNPIGNvbnRyYWN0ICovCiAgICBmdW5jdGlvbiBzZXRJY29BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIG9ubHlPd25lciB7CiAgICAgICAgaWYgKGljb0FkZHJlc3MgPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBpY29BZGRyZXNzID0gX2FkZHJlc3M7CiAgICAgICAgfSAgICAKICAgICAgICBlbHNlIHRocm93OwogICAgfQoKICAgIC8qIG1pbnQgbmV3IHRva2VucyAqLwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF9yZWNlaXZlciwgdWludDI1NiBfYW1vdW50KSB7CiAgICAgICAgaWYgKGljb0FkZHJlc3MgPT0gYWRkcmVzcygwKSkgdGhyb3c7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gaWNvQWRkcmVzcyAmJiBtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsgICAgIC8vIG1pbnQgYWxsb3dlZCBvbmx5IGZvciBJQ08gY29udHJhY3QgYW5kIG93bmVyCiAgICAgICAgLy8gaWYgKGJsb2NrLm51bWJlciA8PSBpY29FbmRCbG9jaykgdGhyb3c7ICAgICAgICAgICAgICAgICAgICAgIC8vIG1pbnQgYWxsb3dlZCBvbmx5IGFmdGVyIElDTwogICAgICAgIGlmIChzYWZlQWRkKHRvdGFsU3VwcGx5LCBfYW1vdW50KSA+IG1heFN1cHBseSkgdGhyb3c7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LCBfYW1vdW50KTsgCiAgICAgICAgYmFsYW5jZXNbX3JlY2VpdmVyXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3JlY2VpdmVyXSwgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX3JlY2VpdmVyLCBfYW1vdW50LCBuZXcgYnl0ZXMoMCkpOyAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2VsZkRlc3Ryb3koKSBvbmx5T3duZXIgeyAvLyBURVNUIE9OTFkKICAgICAgICBzdWljaWRlKHRoaXMpOyAKICAgIH0KfQoKLyogbWFpbiBjb250cmFjdCAtIElDTyAqLwpjb250cmFjdCBTdGFibGVJQ08gaXMgT3duYWJsZSwgU2FmZU1hdGggewogICAgdWludDI1NiBwdWJsaWMgY3Jvd2RmdW5kaW5nVGFyZ2V0OyAgICAgICAgIC8vIElDTyB0YXJnZXQsIGluIHdlaQogICAgRVJDMjIzVG9rZW5fU1RBIHB1YmxpYyBzdGE7ICAgICAgICAgICAgICAgIC8vIGFkZHJlc3Mgb2YgU1RBIHRva2VuCiAgICBFUkMyMjNUb2tlbl9TVEIgcHVibGljIHN0YjsgICAgICAgICAgICAgICAgLy8gYWRkcmVzcyBvZiBTVEIgdG9rZW4KICAgIGFkZHJlc3MgcHVibGljIGJlbmVmaWNpYXJ5OyAgICAgICAgICAgICAgICAvLyB3aGVyZSB0aGUgZG9uYXRpb24gaXMgdHJhbnNmZXJyZWQgYWZ0ZXIgc3VjY2Vzc2Z1bCBJQ08KICAgIHVpbnQyNTYgcHVibGljIGljb1N0YXJ0QmxvY2s7ICAgICAgICAgICAgICAvLyBudW1iZXIgb2Ygc3RhcnQgYmxvY2sgb2YgSUNPCiAgICB1aW50MjU2IHB1YmxpYyBpY29FbmRCbG9jazsgICAgICAgICAgICAgICAgLy8gbnVtYmVyIG9mIGVuZCBibG9jayBvZiBJQ08KICAgIGJvb2wgcHVibGljIGlzSWNvRmluaXNoZWQ7ICAgICAgICAgICAgICAgICAvLyBib29sZWFuIGZvciBJQ08gc3RhdHVzIC0gaXMgSUNPIGZpbmlzaGVkPwogICAgYm9vbCBwdWJsaWMgaXNJY29TdWNjZWVkZWQ7ICAgICAgICAgICAgICAgIC8vIGJvb2xlYW4gZm9yIElDTyBzdGF0dXMgLSBpcyBjcm93ZGZ1bmRpbmcgdGFyZ2V0IHJlYWNoZWQ/CiAgICBib29sIHB1YmxpYyBpc0RvbmF0ZWRFdGhUcmFuc2ZlcnJlZDsgICAgICAgLy8gYm9vbGVhbiBmb3IgSUNPIHN0YXR1cyAtIGlzIGRvbmF0aW9uIHRyYW5zZmVycmVkIHRvIHRoZSBzZWN1cmUgYWNjb3VudD8KICAgIGJvb2wgcHVibGljIGlzU3RiTWludGVkRm9yU3RhRXg7ICAgICAgICAgICAvLyBib29sZWFuIGZvciBJQ08gc3RhdHVzIC0gaXMgZXh0cmEgU1RCIHRva2VucyBtaW50ZWQgZm9yIGNvdmVyaW5nIGV4Y2hhbmdlIG9mIFNUQSB0b2tlbj8KICAgIHVpbnQyNTYgcHVibGljIHJlY2VpdmVkU3RhQW1vdW50OyAgICAgICAgICAvLyBhbW91bnQgb2YgcmVjZWl2ZWQgU1RBIHRva2VucyBmcm9tIHJld2FyZGVkIG1pbmVycwogICAgdWludDI1NiBwdWJsaWMgdG90YWxGdW5kZWQ7ICAgICAgICAgICAgICAgIC8vIGFtb3VudCBvZiBFVEggZG9uYXRpb25zCiAgICB1aW50MjU2IHB1YmxpYyBvd25lcnNFdGg7ICAgICAgICAgICAgICAgICAgLy8gYW1vdW50IG9mIEVUSCB0cmFuc2ZlcnJlZCB0byBJQ08gY29udHJhY3QgYnkgdGhlIG93bmVyCiAgICB1aW50MjU2IHB1YmxpYyBvbmVTdGFJc1N0YjsgICAgICAgICAgICAgICAgLy8gb25lIFNUQSB2YWx1ZSBpbiBTVEIKICAgIAogICAgc3RydWN0IERvbm9yIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJ1Y3QgZm9yIEVUSCBkb25hdGlvbnMKICAgICAgICBhZGRyZXNzIGRvbm9yQWRkcmVzczsKICAgICAgICB1aW50MjU2IGV0aEFtb3VudDsKICAgICAgICB1aW50MjU2IGJsb2NrOwogICAgICAgIGJvb2wgZXhjaGFuZ2VkT3JSZWZ1bmRlZDsKICAgICAgICB1aW50MjU2IHN0YkFtb3VudDsKICAgIH0KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gRG9ub3IpIHB1YmxpYyBkb25hdGlvbnM7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcmFnZSBmb3IgRVRIIGRvbmF0aW9ucwogICAgdWludDI1NiBwdWJsaWMgZG9uYXRpb25OdW07ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb3VudGVyIG9mIEVUSCBkb25hdGlvbnMKCQogICAgc3RydWN0IE1pbmVyIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJ1Y3QgZm9yIHJlY2VpdmVkIFNUQSB0b2tlbnMKICAgICAgICBhZGRyZXNzIG1pbmVyQWRkcmVzczsKICAgICAgICB1aW50MjU2IHN0YUFtb3VudDsKICAgICAgICB1aW50MjU2IGJsb2NrOwogICAgICAgIGJvb2wgZXhjaGFuZ2VkOwogICAgICAgIHVpbnQyNTYgc3RiQW1vdW50OwogICAgfQogICAgbWFwcGluZyAodWludDI1NiA9PiBNaW5lcikgcHVibGljIHJlY2VpdmVkU3RhOyAgICAgICAgICAgICAgICAgICAgICAvLyBzdG9yYWdlIGZvciByZWNlaXZlZCBTVEEgdG9rZW5zCiAgICB1aW50MjU2IHB1YmxpYyBtaW5lck51bTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvdW50ZXIgb2YgU1RBIHJlY2VpdmVzCgogICAgLyogVGhpcyBnZW5lcmF0ZXMgYSBwdWJsaWMgZXZlbnQgb24gdGhlIGJsb2NrY2hhaW4gdGhhdCB3aWxsIG5vdGlmeSBjbGllbnRzICovCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsgCiAgICAKICAgIGV2ZW50IE1lc3NhZ2VFeGNoYW5nZUV0aFN0YihhZGRyZXNzIGZyb20sIHVpbnQyNTYgZXRoLCB1aW50MjU2IHN0Yik7CiAgICBldmVudCBNZXNzYWdlRXhjaGFuZ2VTdGFTdGIoYWRkcmVzcyBmcm9tLCB1aW50MjU2IHN0YSwgdWludDI1NiBzdGIpOwogICAgZXZlbnQgTWVzc2FnZVJlY2VpdmVFdGgoYWRkcmVzcyBmcm9tLCB1aW50MjU2IGV0aCwgdWludDI1NiBibG9jayk7CiAgICBldmVudCBNZXNzYWdlUmVjZWl2ZVN0YShhZGRyZXNzIGZyb20sIHVpbnQyNTYgc3RhLCB1aW50MjU2IGJsb2NrKTsKICAgIGV2ZW50IE1lc3NhZ2VSZWNlaXZlU3RiKGFkZHJlc3MgZnJvbSwgdWludDI1NiBzdGIsIHVpbnQyNTYgYmxvY2ssIGJ5dGVzIGRhdGEpOyAgLy8gaXQgc2hvdWxkIG5ldmVyIGhhcHBlbgogICAgZXZlbnQgTWVzc2FnZVJlZnVuZEV0aChhZGRyZXNzIGRvbm9yX2FkZHJlc3MsIHVpbnQyNTYgZXRoKTsKICAKICAgIC8qIGNvbnN0cnVjdG9yICovCiAgICBmdW5jdGlvbiBTdGFibGVJQ08oKSB7CiAgICAgICAgY3Jvd2RmdW5kaW5nVGFyZ2V0ID0gMjAwMDAwMDAwMDAwMDAwMDAwOyAvLyBJTklUICh0ZXN0OiAwLjIgRVRIKQogICAgICAgIHN0YSA9IEVSQzIyM1Rva2VuX1NUQSgweGUxZThmOWJkNTM1Mzg0YTM0NWMyYTdhMjlhMTVkZjhmYzM0NWFkOWMpOyAgLy8gSU5JVAogICAgICAgIHN0YiA9IEVSQzIyM1Rva2VuX1NUQigweDFlNDZhM2YwNTUyYzVhY2Y4Y2VkNGZlMjFhNzg5YjQxMmYwZTc5MmEpOyAgLy8gSU5JVAogICAgICAgIGJlbmVmaWNpYXJ5ID0gMHgyOWVmOTMyOWJjMTViN2MxMWQwNDcyMTc2MTgxODZiNTJiYjRjOGZmOyAgLy8gSU5JVAogICAgICAgIGljb1N0YXJ0QmxvY2sgPSA0MjMwMDAwOyAgLy8gSU5JVAogICAgICAgIGljb0VuZEJsb2NrID0gNDIzMDE1MDsgIC8vIElOSVQKICAgIH0JCQogICAgCiAgICAvKiB0cmlnZ2VyIHJld2FyZGluZyB0aGUgbWluZXIgd2l0aCBTVEEgdG9rZW4gKi8KICAgIGZ1bmN0aW9uIGNsYWltTWluaW5nUmV3YXJkKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc3RhLmNsYWltTWluaW5nUmV3YXJkKCk7CiAgICB9CgkKICAgIC8qIFJlY2VpdmluZyBTVEEgZnJvbSBtaW5lcnMgLSBkdXJpbmcgYW5kIGFmdGVyIElDTyAqLwogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHsKICAgICAgICBpZiAoYmxvY2subnVtYmVyIDwgaWNvU3RhcnRCbG9jaykgdGhyb3c7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzdGEpKSB7CiAgICAgICAgICAgIGlmIChfdmFsdWUgPCA1MDAwMDAwMCkgdGhyb3c7IC8vIG1pbmltdW0gMC41IFNUQQogICAgICAgICAgICBpZiAoYmxvY2subnVtYmVyIDwgaWNvRW5kQmxvY2srMTQqMzQ1NikgeyAgLy8gYWxsb3cgU1RBIHRva2VucyBleGNoYW5nZSBmb3IgYXJvdW5kIDE0IGRheXMgKDI1cy9ibG9jaykgYWZ0ZXIgSUNPCiAgICAgICAgICAgICAgICByZWNlaXZlZFN0YVttaW5lck51bV0gPSBNaW5lcihfZnJvbSwgX3ZhbHVlLCBibG9jay5udW1iZXIsIGZhbHNlLCAwKTsKICAgICAgICAgICAgICAgIG1pbmVyTnVtICs9IDE7CiAgICAgICAgICAgICAgICByZWNlaXZlZFN0YUFtb3VudCA9IHNhZmVBZGQocmVjZWl2ZWRTdGFBbW91bnQsIF92YWx1ZSk7CiAgICAgICAgICAgICAgICBNZXNzYWdlUmVjZWl2ZVN0YShfZnJvbSwgX3ZhbHVlLCBibG9jay5udW1iZXIpOwogICAgICAgICAgICB9IGVsc2UgdGhyb3c7CQogICAgICAgIH0gZWxzZSBpZihtc2cuc2VuZGVyID09IGFkZHJlc3Moc3RiKSkgewogICAgICAgICAgICBNZXNzYWdlUmVjZWl2ZVN0YihfZnJvbSwgX3ZhbHVlLCBibG9jay5udW1iZXIsIF9kYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdzsgLy8gb3RoZXIgdG9rZW5zCiAgICAgICAgfQogICAgfQoKICAgIC8qIFJlY2VpdmluZyBFVEggKi8KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgewoKICAgICAgICBpZiAobXNnLnZhbHVlIDwgMTAwMDAwMDAwMDAwMDAwMDApIHRocm93OyAgLy8gbWluaW11bSAwLjEgRVRIICBURVNUOiAwLjAxRVRICgkJCiAgICAgICAgLy8gYmVmb3JlIElDTyAocHJlLWljbykKICAgICAgICBpZiAoYmxvY2subnVtYmVyIDwgaWNvU3RhcnRCbG9jaykgewogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgewogICAgICAgICAgICAgICAgb3duZXJzRXRoID0gc2FmZUFkZChvd25lcnNFdGgsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b3RhbEZ1bmRlZCA9IHNhZmVBZGQodG90YWxGdW5kZWQsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgICAgICBkb25hdGlvbnNbZG9uYXRpb25OdW1dID0gRG9ub3IobXNnLnNlbmRlciwgbXNnLnZhbHVlLCBibG9jay5udW1iZXIsIGZhbHNlLCAwKTsKICAgICAgICAgICAgICAgIGRvbmF0aW9uTnVtICs9IDE7CiAgICAgICAgICAgICAgICBNZXNzYWdlUmVjZWl2ZUV0aChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgfSAKICAgICAgICAvLyBkdXJpbmcgSUNPCiAgICAgICAgZWxzZSBpZiAoYmxvY2subnVtYmVyID49IGljb1N0YXJ0QmxvY2sgJiYgYmxvY2subnVtYmVyIDw9IGljb0VuZEJsb2NrKSB7CiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgICAgICAgICAgICB0b3RhbEZ1bmRlZCA9IHNhZmVBZGQodG90YWxGdW5kZWQsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgICAgICBkb25hdGlvbnNbZG9uYXRpb25OdW1dID0gRG9ub3IobXNnLnNlbmRlciwgbXNnLnZhbHVlLCBibG9jay5udW1iZXIsIGZhbHNlLCAwKTsKICAgICAgICAgICAgICAgIGRvbmF0aW9uTnVtICs9IDE7CiAgICAgICAgICAgICAgICBNZXNzYWdlUmVjZWl2ZUV0aChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIH0gZWxzZSBvd25lcnNFdGggPSBzYWZlQWRkKG93bmVyc0V0aCwgbXNnLnZhbHVlKTsKICAgICAgICB9CiAgICAgICAgLy8gYWZ0ZXIgSUNPIC0gZmlyc3QgRVRIIHRyYW5zZmVyIGlzIHJldHVybmVkIHRvIHRoZSBzZW5kZXIKICAgICAgICBlbHNlIGlmIChibG9jay5udW1iZXIgPiBpY29FbmRCbG9jaykgewogICAgICAgICAgICBpZiAoIWlzSWNvRmluaXNoZWQpIHsKICAgICAgICAgICAgICAgIGlzSWNvRmluaXNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOyAgLy8gcmV0dXJuIEVUSCB0byB0aGUgc2VuZGVyCiAgICAgICAgICAgICAgICBpZiAodG90YWxGdW5kZWQgPj0gY3Jvd2RmdW5kaW5nVGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgaXNJY29TdWNjZWVkZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlU3RhU3RiKDAsIG1pbmVyTnVtKTsKICAgICAgICAgICAgICAgICAgICBleGNoYW5nZUV0aFN0YigwLCBkb25hdGlvbk51bSk7CiAgICAgICAgICAgICAgICAgICAgZHJhd2Rvd24oKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVmdW5kKDAsIGRvbmF0aW9uTnVtKTsKICAgICAgICAgICAgICAgIH0JCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7ICAvLyBXQVJOSU5HOiBzZW5kZXJzIEVUSCBtYXkgYmUgbG9zdCAoaWYgdHJhbnNmZXJyZWQgYWZ0ZXIgZmluaXNoZWQgSUNPKQogICAgICAgICAgICAgICAgb3duZXJzRXRoID0gc2FmZUFkZChvd25lcnNFdGgsIG1zZy52YWx1ZSk7CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3c7ICAvLyBXQVJOSU5HOiBzZW5kZXJzIEVUSCBtYXkgYmUgbG9zdCAoaWYgdHJhbnNmZXJyZWQgYWZ0ZXIgZmluaXNoZWQgSUNPKQogICAgICAgIH0KICAgIH0KCiAgICAvKiBzZW5kIFNUQiB0byB0aGUgbWluZXJzIHdobyByZXR1cm5lZCBTVEEgdG9rZW5zIC0gYWZ0ZXIgc3VjY2Vzc2Z1bCBJQ08gKi8KICAgIGZ1bmN0aW9uIGV4Y2hhbmdlU3RhU3RiKHVpbnQyNTYgX2Zyb20sIHVpbnQyNTYgX3RvKSBwcml2YXRlIHsgIAogICAgICAgIGlmICghaXNJY29TdWNjZWVkZWQpIHRocm93OwogICAgICAgIGlmIChfZnJvbSA+PSBfdG8pIHJldHVybjsgIC8vIHNraXAgdGhlIGZ1bmN0aW9uIGlmIHRoZXJlIGlzIGludmFsaWQgcmFuZ2UgZ2l2ZW4gZm9yIGxvb3AKICAgICAgICB1aW50MjU2IF9zdGEyc3RiID0gMTAqKjQ7IAogICAgICAgIHVpbnQyNTYgX3dlaTJzdGIgPSAxMCoqMTQ7IAoKICAgICAgICBpZiAoIWlzU3RiTWludGVkRm9yU3RhRXgpIHsKICAgICAgICAgICAgdWludDI1NiBfbWludEFtb3VudCA9ICgxMCp0b3RhbEZ1bmRlZCkqNS8xMDAwIC8gX3dlaTJzdGI7ICAvLyAwLjUlIGV4dHJhIFNUQiBtaW50aW5nIGZvciBTVEEgY292ZXJpbmcKICAgICAgICAgICAgb25lU3RhSXNTdGIgPSBfbWludEFtb3VudCAvIDEwMDsKICAgICAgICAgICAgc3RiLm1pbnQoYWRkcmVzcyh0aGlzKSwgX21pbnRBbW91bnQpOwogICAgICAgICAgICBpc1N0Yk1pbnRlZEZvclN0YUV4ID0gdHJ1ZTsKICAgICAgICB9CQoJCQkKICAgICAgICAvKiBleGNoYW5nZSAqLwogICAgICAgIHVpbnQyNTYgX3RvQnVybiA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSBfZnJvbTsgaSA8IF90bzsgaSsrKSB7CiAgICAgICAgICAgIGlmIChyZWNlaXZlZFN0YVtpXS5leGNoYW5nZWQpIGNvbnRpbnVlOyAgLy8gc2tpcCBhbHJlYWR5IGV4Y2hhbmdlZCBTVEEKICAgICAgICAgICAgc3RiLnRyYW5zZmVyKHJlY2VpdmVkU3RhW2ldLm1pbmVyQWRkcmVzcywgcmVjZWl2ZWRTdGFbaV0uc3RhQW1vdW50L19zdGEyc3RiICogb25lU3RhSXNTdGIgLyAxMCoqNCk7CiAgICAgICAgICAgIHJlY2VpdmVkU3RhW2ldLmV4Y2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHJlY2VpdmVkU3RhW2ldLnN0YkFtb3VudCA9IHJlY2VpdmVkU3RhW2ldLnN0YUFtb3VudC9fc3RhMnN0YiAqIG9uZVN0YUlzU3RiIC8gMTAqKjQ7CiAgICAgICAgICAgIF90b0J1cm4gKz0gcmVjZWl2ZWRTdGFbaV0uc3RhQW1vdW50OwogICAgICAgICAgICBNZXNzYWdlRXhjaGFuZ2VTdGFTdGIocmVjZWl2ZWRTdGFbaV0ubWluZXJBZGRyZXNzLCByZWNlaXZlZFN0YVtpXS5zdGFBbW91bnQsIAogICAgICAgICAgICAgIHJlY2VpdmVkU3RhW2ldLnN0YUFtb3VudC9fc3RhMnN0YiAqIG9uZVN0YUlzU3RiIC8gMTAqKjQpOwogICAgICAgIH0KICAgICAgICBzdGEuYnVybihhZGRyZXNzKHRoaXMpLCBfdG9CdXJuKTsgIC8vIGJ1cm4gcmVjZWl2ZWQgYW5kIHByb2Nlc3NlZCBTVEEgdG9rZW5zCiAgICB9CgkKICAgIC8qIHNlbmQgU1RCIHRvIHRoZSBkb25vcnMgLSBhZnRlciBzdWNjZXNzZnVsIElDTyAqLwogICAgZnVuY3Rpb24gZXhjaGFuZ2VFdGhTdGIodWludDI1NiBfZnJvbSwgdWludDI1NiBfdG8pIHByaXZhdGUgeyAKICAgICAgICBpZiAoIWlzSWNvU3VjY2VlZGVkKSB0aHJvdzsKICAgICAgICBpZiAoX2Zyb20gPj0gX3RvKSByZXR1cm47ICAvLyBza2lwIHRoZSBmdW5jdGlvbiBpZiB0aGVyZSBpcyBpbnZhbGlkIHJhbmdlIGdpdmVuIGZvciBsb29wCiAgICAgICAgdWludDI1NiBfd2VpMnN0YiA9IDEwKioxNDsgLy8gY2FsY3VsYXRlIGV0aCB0byBzdGIgZXhjaGFuZ2UKICAgICAgICB1aW50IF9wYiA9IChpY29FbmRCbG9jayAtIGljb1N0YXJ0QmxvY2spLzQ7IAogICAgICAgIHVpbnQgX2JvbnVzOwoKICAgICAgICAvKiBtaW50ICovCiAgICAgICAgdWludDI1NiBfbWludEFtb3VudCA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSBfZnJvbTsgaSA8IF90bzsgaSsrKSB7CiAgICAgICAgICAgIGlmIChkb25hdGlvbnNbaV0uZXhjaGFuZ2VkT3JSZWZ1bmRlZCkgY29udGludWU7ICAvLyBza2lwIGFscmVhZHkgbWludGVkIFNUQgogICAgICAgICAgICBpZiAoZG9uYXRpb25zW2ldLmJsb2NrIDwgaWNvU3RhcnRCbG9jayArIF9wYikgX2JvbnVzID0gNjsgIC8vIGZpcnN0IHBlcmlvZDsgYm9udXMgaW4gJQogICAgICAgICAgICBlbHNlIGlmIChkb25hdGlvbnNbaV0uYmxvY2sgPj0gaWNvU3RhcnRCbG9jayArIF9wYiAmJiBkb25hdGlvbnNbaV0uYmxvY2sgPCBpY29TdGFydEJsb2NrICsgMipfcGIpIF9ib251cyA9IDQ7ICAvLyAybmQKICAgICAgICAgICAgZWxzZSBpZiAoZG9uYXRpb25zW2ldLmJsb2NrID49IGljb1N0YXJ0QmxvY2sgKyAyKl9wYiAmJiBkb25hdGlvbnNbaV0uYmxvY2sgPCBpY29TdGFydEJsb2NrICsgMypfcGIpIF9ib251cyA9IDI7ICAvLyAzcmQKICAgICAgICAgICAgZWxzZSBfYm9udXMgPSAwOyAgLy8gNHRoCiAgICAgICAgICAgIF9taW50QW1vdW50ICs9IDEwICogKCAoMTAwICsgX2JvbnVzKSAqIChkb25hdGlvbnNbaV0uZXRoQW1vdW50IC8gX3dlaTJzdGIpIC8gMTAwKTsKICAgICAgICB9CiAgICAgICAgc3RiLm1pbnQoYWRkcmVzcyh0aGlzKSwgX21pbnRBbW91bnQpOwoKICAgICAgICAvKiBleGNoYW5nZSAqLwogICAgICAgIGZvciAoaSA9IF9mcm9tOyBpIDwgX3RvOyBpKyspIHsKICAgICAgICAgICAgaWYgKGRvbmF0aW9uc1tpXS5leGNoYW5nZWRPclJlZnVuZGVkKSBjb250aW51ZTsgIC8vIHNraXAgYWxyZWFkeSBleGNoYW5nZWQgRVRICiAgICAgICAgICAgIGlmIChkb25hdGlvbnNbaV0uYmxvY2sgPCBpY29TdGFydEJsb2NrICsgX3BiKSBfYm9udXMgPSA2OyAgLy8gZmlyc3QgcGVyaW9kOyBib251cyBpbiAlCiAgICAgICAgICAgIGVsc2UgaWYgKGRvbmF0aW9uc1tpXS5ibG9jayA+PSBpY29TdGFydEJsb2NrICsgX3BiICYmIGRvbmF0aW9uc1tpXS5ibG9jayA8IGljb1N0YXJ0QmxvY2sgKyAyKl9wYikgX2JvbnVzID0gNDsgIC8vIDJuZAogICAgICAgICAgICBlbHNlIGlmIChkb25hdGlvbnNbaV0uYmxvY2sgPj0gaWNvU3RhcnRCbG9jayArIDIqX3BiICYmIGRvbmF0aW9uc1tpXS5ibG9jayA8IGljb1N0YXJ0QmxvY2sgKyAzKl9wYikgX2JvbnVzID0gMjsgIC8vIDNyZAogICAgICAgICAgICBlbHNlIF9ib251cyA9IDA7ICAvLyA0dGgKICAgICAgICAgICAgc3RiLnRyYW5zZmVyKGRvbmF0aW9uc1tpXS5kb25vckFkZHJlc3MsIDEwICogKCAoMTAwICsgX2JvbnVzKSAqIChkb25hdGlvbnNbaV0uZXRoQW1vdW50IC8gX3dlaTJzdGIpIC8gMTAwKSApOwogICAgICAgICAgICBkb25hdGlvbnNbaV0uZXhjaGFuZ2VkT3JSZWZ1bmRlZCA9IHRydWU7CiAgICAgICAgICAgIGRvbmF0aW9uc1tpXS5zdGJBbW91bnQgPSAxMCAqICggKDEwMCArIF9ib251cykgKiAoZG9uYXRpb25zW2ldLmV0aEFtb3VudCAvIF93ZWkyc3RiKSAvIDEwMCk7CiAgICAgICAgICAgIE1lc3NhZ2VFeGNoYW5nZUV0aFN0Yihkb25hdGlvbnNbaV0uZG9ub3JBZGRyZXNzLCBkb25hdGlvbnNbaV0uZXRoQW1vdW50LCAKICAgICAgICAgICAgICAxMCAqICggKDEwMCArIF9ib251cykgKiAoZG9uYXRpb25zW2ldLmV0aEFtb3VudCAvIF93ZWkyc3RiKSAvIDEwMCkpOwogICAgICAgIH0KICAgIH0KICAKICAgIC8vIHNlbmQgZnVuZHMgdG8gdGhlIElDTyBiZW5lZmljaWFyeSBhY2NvdW50IC0gYWZ0ZXIgc3VjY2Vzc2Z1bCBJQ08KICAgIGZ1bmN0aW9uIGRyYXdkb3duKCkgcHJpdmF0ZSB7CiAgICAgICAgaWYgKCFpc0ljb1N1Y2NlZWRlZCB8fCBpc0RvbmF0ZWRFdGhUcmFuc2ZlcnJlZCkgdGhyb3c7CiAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIodG90YWxGdW5kZWQpOyAgCiAgICAgICAgaXNEb25hdGVkRXRoVHJhbnNmZXJyZWQgPSB0cnVlOwogICAgfQogIAogICAgLyogcmVmdW5kIEVUSCAtIGFmdGVyIHVuc3VjY2Vzc2Z1bCBJQ08gKi8KICAgIGZ1bmN0aW9uIHJlZnVuZCh1aW50MjU2IF9mcm9tLCB1aW50MjU2IF90bykgcHJpdmF0ZSB7CiAgICAgICAgaWYgKCFpc0ljb0ZpbmlzaGVkIHx8IGlzSWNvU3VjY2VlZGVkKSB0aHJvdzsKICAgICAgICBpZiAoX2Zyb20gPj0gX3RvKSByZXR1cm47CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSBfZnJvbTsgaSA8IF90bzsgaSsrKSB7CiAgICAgICAgICAgIGlmIChkb25hdGlvbnNbaV0uZXhjaGFuZ2VkT3JSZWZ1bmRlZCkgY29udGludWU7CiAgICAgICAgICAgIGRvbmF0aW9uc1tpXS5kb25vckFkZHJlc3MudHJhbnNmZXIoZG9uYXRpb25zW2ldLmV0aEFtb3VudCk7CiAgICAgICAgICAgIGRvbmF0aW9uc1tpXS5leGNoYW5nZWRPclJlZnVuZGVkID0gdHJ1ZTsKICAgICAgICAgICAgTWVzc2FnZVJlZnVuZEV0aChkb25hdGlvbnNbaV0uZG9ub3JBZGRyZXNzLCBkb25hdGlvbnNbaV0uZXRoQW1vdW50KTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIHNlbmQgb3duZXIncyBmdW5kcyB0byB0aGUgSUNPIG93bmVyIC0gYWZ0ZXIgSUNPCiAgICBmdW5jdGlvbiB0cmFuc2ZlckV0aFRvT3duZXIodWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsgCiAgICAgICAgaWYgKCFpc0ljb0ZpbmlzaGVkIHx8IF9hbW91bnQgPD0gMCB8fCBfYW1vdW50ID4gb3duZXJzRXRoKSB0aHJvdzsKICAgICAgICBvd25lci50cmFuc2ZlcihfYW1vdW50KTsgCiAgICAgICAgb3duZXJzRXRoIC09IF9hbW91bnQ7CiAgICB9ICAgIAoKICAgIC8vIHNlbmQgU1RCIHRvIHRoZSBJQ08gb3duZXIgLSBhZnRlciBJQ08KICAgIGZ1bmN0aW9uIHRyYW5zZmVyU3RiVG9Pd25lcih1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgeyAKICAgICAgICBpZiAoIWlzSWNvRmluaXNoZWQgfHwgX2Ftb3VudCA8PSAwKSB0aHJvdzsKICAgICAgICBzdGIudHJhbnNmZXIob3duZXIsIF9hbW91bnQpOyAKICAgIH0gICAgCiAgICAKICAgIAogICAgLyogYmFja3VwIGZ1bmN0aW9ucyB0byBiZSBleGVjdXRlZCAibWFudWFsbHkiIC0gaW4gY2FzZSBvZiBhIGNyaXRpY2FsIGV0aGVyZXVtIHBsYXRmb3JtIGZhaWx1cmUgCiAgICAgIGR1cmluZyBhdXRvbWF0aWMgZnVuY3Rpb24gZXhlY3V0aW9uICovCiAgICBmdW5jdGlvbiBiYWNrdXBfZmluaXNoSWNvVmFycygpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmIChibG9jay5udW1iZXIgPD0gaWNvRW5kQmxvY2sgfHwgaXNJY29GaW5pc2hlZCkgdGhyb3c7CiAgICAgICAgaXNJY29GaW5pc2hlZCA9IHRydWU7CiAgICAgICAgaWYgKHRvdGFsRnVuZGVkID49IGNyb3dkZnVuZGluZ1RhcmdldCkgaXNJY29TdWNjZWVkZWQgPSB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYmFja3VwX2V4Y2hhbmdlU3RhU3RiKHVpbnQyNTYgX2Zyb20sIHVpbnQyNTYgX3RvKSBwdWJsaWMgb25seU93bmVyIHsgCiAgICAgICAgZXhjaGFuZ2VTdGFTdGIoX2Zyb20sIF90byk7CiAgICB9CiAgICBmdW5jdGlvbiBiYWNrdXBfZXhjaGFuZ2VFdGhTdGIodWludDI1NiBfZnJvbSwgdWludDI1NiBfdG8pIHB1YmxpYyBvbmx5T3duZXIgeyAKICAgICAgICBleGNoYW5nZUV0aFN0YihfZnJvbSwgX3RvKTsKICAgIH0KICAgIGZ1bmN0aW9uIGJhY2t1cF9kcmF3ZG93bigpIHB1YmxpYyBvbmx5T3duZXIgeyAKICAgICAgICBkcmF3ZG93bigpOwogICAgfQogICAgZnVuY3Rpb24gYmFja3VwX2RyYXdkb3duX2Ftb3VudCh1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmICghaXNJY29TdWNjZWVkZWQpIHRocm93OwogICAgICAgIGJlbmVmaWNpYXJ5LnRyYW5zZmVyKF9hbW91bnQpOyAgCiAgICB9CiAgICBmdW5jdGlvbiBiYWNrdXBfcmVmdW5kKHVpbnQyNTYgX2Zyb20sIHVpbnQyNTYgX3RvKSBwdWJsaWMgb25seU93bmVyIHsgCiAgICAgICAgcmVmdW5kKF9mcm9tLCBfdG8pOwogICAgfQogICAgLyogL2JhY2t1cCAqLwoKICAgIGZ1bmN0aW9uIHNlbGZEZXN0cm95KCkgb25seU93bmVyIHsgLy8gVEVTVCBPTkxZCiAgICAgICAgc3VpY2lkZSh0aGlzKTsgCiAgICB9Cn0='.
	

]
