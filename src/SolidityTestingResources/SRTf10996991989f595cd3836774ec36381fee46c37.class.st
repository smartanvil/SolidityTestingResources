Class {
	#name : #SRTf10996991989f595cd3836774ec36381fee46c37,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf10996991989f595cd3836774ec36381fee46c37 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjE7CgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBDcnlwdG9Db2xsZWN0b3IKY29udHJhY3QgRVJDNzIxIHsKICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljOwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIGFkZHIpOwogIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfdG9rZW5JZCkgcHVibGljOwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYzsKCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB0b2tlbklkKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgLy8gT3B0aW9uYWwKICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBzeW1ib2wpOwogIC8vIGZ1bmN0aW9uIHRva2VuT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG9rZW5JZCk7CiAgLy8gZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7Cn0KCmNvbnRyYWN0IE93bmFibGUgewogICAgCgkgIC8vIFRoZSBhZGRyZXNzZXMgb2YgdGhlIGFjY291bnRzIChvciBjb250cmFjdHMpIHRoYXQgY2FuIGV4ZWN1dGUgYWN0aW9ucyB3aXRoaW4gZWFjaCByb2xlcy4KCWFkZHJlc3MgcHVibGljIGhvc3RBZGRyZXNzOwoJYWRkcmVzcyBwdWJsaWMgYWRtaW5BZGRyZXNzOwogICAgCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKCQlob3N0QWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJYWRtaW5BZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SG9zdCgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gaG9zdEFkZHJlc3MpOyAKICAgICAgICBfOwogICAgfQoJCiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCQoJLy8vIEFjY2VzcyBtb2RpZmllciBmb3IgY29udHJhY3Qgb3duZXIgb25seSBmdW5jdGlvbmFsaXR5Cgltb2RpZmllciBvbmx5SG9zdE9yQWRtaW4oKSB7CgkJcmVxdWlyZSgKCQkgIG1zZy5zZW5kZXIgPT0gaG9zdEFkZHJlc3MgfHwKCQkgIG1zZy5zZW5kZXIgPT0gYWRtaW5BZGRyZXNzCgkJKTsKCQlfOwoJfQoKCWZ1bmN0aW9uIHNldEhvc3QoYWRkcmVzcyBfbmV3SG9zdCkgcHVibGljIG9ubHlIb3N0IHsKCQlyZXF1aXJlKF9uZXdIb3N0ICE9IGFkZHJlc3MoMCkpOwoKCQlob3N0QWRkcmVzcyA9IF9uZXdIb3N0OwoJfQogICAgCglmdW5jdGlvbiBzZXRBZG1pbihhZGRyZXNzIF9uZXdBZG1pbikgcHVibGljIG9ubHlIb3N0IHsKCQlyZXF1aXJlKF9uZXdBZG1pbiAhPSBhZGRyZXNzKDApKTsKCgkJYWRtaW5BZGRyZXNzID0gX25ld0FkbWluOwoJfQp9CiAKY29udHJhY3QgQ3J5cHRvQ29sbGVjdG9yQ29udHJhY3QgaXMgRVJDNzIxLCBPd25hYmxlIHsKICAgICAgICAKICAgIC8qKiogRVZFTlRTICoqKi8KICAgICAgICAKICAgIC8vLyBAZGV2IFRoZSBOZXdIZXJvIGV2ZW50IGlzIGZpcmVkIHdoZW5ldmVyIGEgbmV3IGNhcmQgY29tZXMgaW50byBleGlzdGVuY2UuCiAgICBldmVudCBOZXdUb2tlbih1aW50MjU2IHRva2VuSWQsIHN0cmluZyBuYW1lLCBhZGRyZXNzIG93bmVyKTsKICAgICAgICAKICAgIC8vLyBAZGV2IFRoZSBOZXdUb2tlbk93bmVyIGV2ZW50IGlzIGZpcmVkIHdoZW5ldmVyIGEgdG9rZW4gaXMgc29sZC4KICAgIGV2ZW50IE5ld1Rva2VuT3duZXIodWludDI1NiBvbGRQcmljZSwgdWludDI1NiBuZXdQcmljZSwgYWRkcmVzcyBwcmV2T3duZXIsIGFkZHJlc3Mgd2lubmVyLCBzdHJpbmcgbmFtZSwgdWludDI1NiB0b2tlbklkKTsKICAgIAogICAgLy8vIEBkZXYgVGhlIE5ld1dpbGRDYXJkIGV2ZW50IGlzIGZpcmVkIHdoZW5ldmVyIGEgd2lsZCBjYXJkIGlzIGNoYW5nZS4KICAgIGV2ZW50IE5ld1dpbGRUb2tlbih1aW50MjU2IHdpbGRjYXJkUGF5bWVudCk7CiAgICAgICAgCiAgICAvLy8gQGRldiBUcmFuc2ZlciBldmVudCBhcyBkZWZpbmVkIGluIGN1cnJlbnQgZHJhZnQgb2YgRVJDNzIxLiBvd25lcnNoaXAgaXMgYXNzaWduZWQsIGluY2x1ZGluZyBiaXJ0aHMuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICAgICAgCiAgICAvKioqIENPTlNUQU5UUyAqKiovCiAgICAgIAogICAgLy8vIEBub3RpY2UgTmFtZSBhbmQgc3ltYm9sIG9mIHRoZSBub24gZnVuZ2libGUgdG9rZW4sIGFzIGRlZmluZWQgaW4gRVJDNzIxLgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBOQU1FID0gIkNyeXB0b0NvbGxlY3RvckNvbnRyYWN0IjsgLy8gc29saGludC1kaXNhYmxlLWxpbmUKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgU1lNQk9MID0gIkNDQyI7IC8vIHNvbGhpbnQtZGlzYWJsZS1saW5lCiAgICAgIAoJdWludDI1NiBwcml2YXRlIGtpbGxlclByaWNlQ29udmVyc2lvbkZlZSA9IDAuMTkgZXRoZXI7IAoJCiAgICB1aW50MjU2IHByaXZhdGUgc3RhcnRpbmdQcmljZSA9IDAuMDAyIGV0aGVyOyAKICAgIHVpbnQyNTYgcHJpdmF0ZSBmaXJzdFN0ZXBMaW1pdCA9ICAwLjA0NSBldGhlcjsgLy81IGl0ZXJhdGlvbgogICAgdWludDI1NiBwcml2YXRlIHNlY29uZFN0ZXBMaW1pdCA9ICAwLjQ1IGV0aGVyOyAvLzggaXRlcmF0aW9uCiAgICB1aW50MjU2IHByaXZhdGUgdGhpcmRTdGVwTGltaXQgPSAxLjAwIGV0aGVyOyAvLzEwIGl0ZXJhdGlvbgogICAgICAgIAogICAgLyoqKiBTVE9SQUdFICoqKi8KICAgICAgICAKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIGNhcmQgSURzIHRvIHRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGVtLiBBbGwgY2FyZHMgaGF2ZQogICAgLy8vICBzb21lIHZhbGlkIG93bmVyIGFkZHJlc3MuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBjYXJkVG9rZW5Ub093bmVyOwogICAgICAgIAogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAgIC8vICBVc2VkIGludGVybmFsbHkgaW5zaWRlIGJhbGFuY2VPZigpIHRvIHJlc29sdmUgb3duZXJzaGlwIGNvdW50LgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwcml2YXRlIG93bmVyc2hpcFRva2VuQ291bnQ7CiAgICAgICAgCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBDYXJkSURzIHRvIGFuIGFkZHJlc3MgdGhhdCBoYXMgYmVlbiBhcHByb3ZlZCB0byBjYWxsCiAgICAvLy8gIHRyYW5zZmVyRnJvbSgpLiBFYWNoIGNhcmQgY2FuIG9ubHkgaGF2ZSBvbmUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgdHJhbnNmZXIKICAgIC8vLyAgYXQgYW55IHRpbWUuIEEgemVybyB2YWx1ZSBtZWFucyBubyBhcHByb3ZhbCBpcyBvdXRzdGFuZGluZy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGNhcmRUb2tlblRvQXBwcm92ZWQ7CiAgICAgICAgCiAgICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIENhcmRJRHMgdG8gdGhlIHByaWNlIG9mIHRoZSB0b2tlbi4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHJpdmF0ZSBjYXJkVG9rZW5Ub1ByaWNlOwogICAgICAgIAogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBDYXJkSURzIHRvIHRoZSBwb3NpdGlvbiBvZiB0aGUgaXRlbSBpbiBhcnJheS4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHJpdmF0ZSBjYXJkVG9rZW5Ub1Bvc2l0aW9uOwogICAgCiAgICAvL0BkZXYgQSBtYXBwaW5nIGZvciB1c2VyIGxpc3QKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHVzZXJBcnJleVBvc2l0aW9uOwogICAgCiAgICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIENhcmRJRHMgdG8gdGhlIHBvc2l0aW9uIG9mIHRoZSBpdGVtIGluIGFycmF5LgogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwcml2YXRlIGNhdGVnb3J5VG9Qb3NpdGlvbjsKICAgICAKICAgIAogICAgLy8gQGRldiB0b2tlbklkIG9mIFdpbGQgQ2FyZC4KICAgIHVpbnQyNTYgcHVibGljIHdpbGRjYXJkVG9rZW5JZDsKICAgIAogICAgLyoqKiBTVE9SQUdFICoqKi8KICAgIAoJLyoqKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICoqKi8KICAgIAogICAgLyoqKiBDQVJEUyAqKiovCiAgICAKCS8qKiogREFUQVRZUEVTICoqKi8KCXN0cnVjdCBDYXJkIHsKCQl1aW50MjU2IHRva2VuOwoJCXN0cmluZyBuYW1lOwoJCXN0cmluZyBpbWFnZXBhdGg7CgkJc3RyaW5nIGNhdGVnb3J5OwoJCXVpbnQyNTYgSXN3aWxkY2FyZDsKCQlhZGRyZXNzIG93bmVyOwoJCQoJfQoKICAgIHN0cnVjdCBDYXJkVXNlciB7CgkJc3RyaW5nIG5hbWU7CgkJc3RyaW5nIGVtYWlsOwoJfQogICAgc3RydWN0IENhdGVnb3J5IHsKICAgICAgICB1aW50MjU2IGlkOwoJCXN0cmluZyBuYW1lOwoJfQoJQ2FyZFtdIHByaXZhdGUgY2FyZHM7CiAgICBDYXJkVXNlcltdIHByaXZhdGUgY2FyZHVzZXJzOwogICAgQ2F0ZWdvcnlbXSBwcml2YXRlIGNhdGVnb3JpZXM7CiAgICAKICAgIAoJLy8vIEBub3RpY2UgUmV0dXJucyBhbGwgdGhlIHJlbGV2YW50IGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmaWMgY2FyZC4KCS8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIHRva2VuSWQgb2YgdGhlIGNhcmQgb2YgaW50ZXJlc3QuCglmdW5jdGlvbiBnZXRDYXJkKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKAoJCXN0cmluZyBuYW1lLAoJCXVpbnQyNTYgdG9rZW4sCgkJdWludDI1NiBwcmljZSwKCQl1aW50MjU2IG5leHRwcmljZSwKCQlzdHJpbmcgaW1hZ2VwYXRoLAoJCXN0cmluZyBjYXRlZ29yeSwKCQl1aW50MjU2IHdpbGRjYXJkLAoJCWFkZHJlc3MgX293bmVyCgkpIHsKCSAgICAKCSAgICAvL2FkZHJlc3Mgb3duZXIgPSBjYXJkVG9rZW5Ub093bmVyW190b2tlbklkXTsKICAgICAgICAvL3JlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CgkgICAgCgkgICAgdWludDI1NiBpbmRleCA9IGNhcmRUb2tlblRvUG9zaXRpb25bX3Rva2VuSWRdOwoJICAgIENhcmQgc3RvcmFnZSBjYXJkID0gY2FyZHNbaW5kZXhdOwoJCW5hbWUgPSBjYXJkLm5hbWU7CgkJdG9rZW4gPSBjYXJkLnRva2VuOwoJCXByaWNlPSBnZXROZXh0UHJpY2UoIGNhcmRUb2tlblRvUHJpY2VbX3Rva2VuSWRdKTsKCQluZXh0cHJpY2U9Z2V0TmV4dFByaWNlKHByaWNlKTsKCQlpbWFnZXBhdGg9Y2FyZC5pbWFnZXBhdGg7CgkJY2F0ZWdvcnk9Y2FyZC5jYXRlZ29yeTsKCQl3aWxkY2FyZD1jYXJkLklzd2lsZGNhcmQ7CgkJX293bmVyPWNhcmQub3duZXI7CgkJCgl9CiAgICAKICAgIC8vLyBAZGV2IENyZWF0ZXMgYSBuZXcgdG9rZW4gd2l0aCB0aGUgZ2l2ZW4gbmFtZS4KCWZ1bmN0aW9uIGNyZWF0ZVRva2VuKHN0cmluZyBfbmFtZSxzdHJpbmcgX2ltYWdlcGF0aCxzdHJpbmcgX2NhdGVnb3J5LCB1aW50MjU2IF9pZCkgcHVibGljIG9ubHlBZG1pbiB7CgkJX2NyZWF0ZVRva2VuKF9uYW1lLF9pbWFnZXBhdGgsX2NhdGVnb3J5LCBfaWQsIGFkZHJlc3ModGhpcyksIHN0YXJ0aW5nUHJpY2UsMCk7Cgl9CgkKCWZ1bmN0aW9uIGdldGtpbGxlclByaWNlQ29udmVyc2lvbkZlZSgpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NiBmZWUpIHsKCQlyZXR1cm4ga2lsbGVyUHJpY2VDb252ZXJzaW9uRmVlOwoJCQoJfQoJCglmdW5jdGlvbiBnZXRBZG1pbigpIHB1YmxpYyB2aWV3IHJldHVybnMoYWRkcmVzcyBfYWRtaW4pIHsKCQlyZXR1cm4gYWRtaW5BZGRyZXNzICA7Cgl9CgkvLy8gQGRldiBzZXQgV2lsZCBjYXJkIHRva2VuLgoJZnVuY3Rpb24gbWFrZVdpbGRDYXJkVG9rZW4odWludDI1NiB0b2tlbklkKSBwdWJsaWMgcGF5YWJsZSB7CgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IGtpbGxlclByaWNlQ29udmVyc2lvbkZlZSk7CQkKCQkvL1N0YXJ0IE5ldyBDb2RlLS1mb3IgbWFraW5nIHdpbGQgY2FyZCBmb3IgZWFjaCBjYXRlZ29yeQoJCXVpbnQyNTYgaW5kZXggPSBjYXJkVG9rZW5Ub1Bvc2l0aW9uW3Rva2VuSWRdOwoJICAgIC8vQ2FyZCBzdG9yYWdlIGNhcmQgPSBjYXJkc1tpbmRleF07CgkgICAgc3RyaW5nIHN0b3JhZ2UgY2FyZENhdGVnb3J5PWNhcmRzW2luZGV4XS5jYXRlZ29yeTsKCSAgICB1aW50MjU2IHRvdGFsQ2FyZHMgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHVpbnQyNTYgaT0wOwogICAgICAgICAgZm9yIChpID0gMDsgaSAgPD0gdG90YWxDYXJkcy0xOyBpKyspIHsKICAgICAgICAgICAgLy9jaGVjayBmb3IgdGhlIHNhbWUgY2F0ZWdvcnkKICAgICAgICAgICAgLy9TdHJpbmdVdGlscwogICAgICAgICAgICBpZiAoa2VjY2FrMjU2KGNhcmRzW2ldLmNhdGVnb3J5KT09a2VjY2FrMjU2KGNhcmRDYXRlZ29yeSkpewogICAgICAgICAgICAgICBjYXJkc1tpXS5Jc3dpbGRjYXJkPTA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCQljYXJkc1tpbmRleF0uSXN3aWxkY2FyZD0xOwoJCS8vRW5kIE5ldyBDb2RlLS0KCQkKCQkvL21zZy5zZW5kZXIudHJhbnNmZXIoa2lsbGVyUHJpY2VDb252ZXJzaW9uRmVlKTsKCQkvL2FkZHJlc3ModGhpcykudHJhbnNmZXIoa2lsbGVyUHJpY2VDb252ZXJzaW9uRmVlKTsKCQkvL2VtaXQgTmV3V2lsZFRva2VuKHdpbGRjYXJkVG9rZW5JZCk7Cgl9CiAgICAvLy8gQGRldiBzZXQgd2lsZCBjYXJkIHRva2VuLgoJZnVuY3Rpb24gc2V0V2lsZENhcmRUb2tlbih1aW50MjU2IHRva2VuSWQpIHB1YmxpYyBvbmx5QWRtaW4gewoKCQkvL1N0YXJ0IE5ldyBDb2RlLS1mb3IgbWFraW5nIHdpbGQgY2FyZCBmb3IgZWFjaCBjYXRlZ29yeQoJCXVpbnQyNTYgaW5kZXggPSBjYXJkVG9rZW5Ub1Bvc2l0aW9uW3Rva2VuSWRdOwoJICAgIC8vQ2FyZCBzdG9yYWdlIGNhcmQgPSBjYXJkc1tpbmRleF07CgkgICAgc3RyaW5nIHN0b3JhZ2UgY2FyZENhdGVnb3J5PWNhcmRzW2luZGV4XS5jYXRlZ29yeTsKCSAgICB1aW50MjU2IHRvdGFsQ2FyZHMgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHVpbnQyNTYgaT0wOwogICAgICAgICAgZm9yIChpID0gMDsgaSAgPD0gdG90YWxDYXJkcy0xOyBpKyspIHsKICAgICAgICAgICAgLy9jaGVjayBmb3IgdGhlIHNhbWUgY2F0ZWdvcnkKICAgICAgICAgICAgLy9TdHJpbmdVdGlscwogICAgICAgICAgICBpZiAoa2VjY2FrMjU2KGNhcmRzW2ldLmNhdGVnb3J5KT09a2VjY2FrMjU2KGNhcmRDYXRlZ29yeSkpewogICAgICAgICAgICAgICBjYXJkc1tpXS5Jc3dpbGRjYXJkPTA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCQljYXJkc1tpbmRleF0uSXN3aWxkY2FyZD0xOwoJCS8vRW5kIE5ldyBDb2RlLS0KCQkKCQl3aWxkY2FyZFRva2VuSWQgPSB0b2tlbklkOwoJCWVtaXQgTmV3V2lsZFRva2VuKHdpbGRjYXJkVG9rZW5JZCk7Cgl9CgkKCWZ1bmN0aW9uIElzV2lsZENhcmRDcmVhdGVkRm9yQ2F0ZWdvcnkoc3RyaW5nIF9jYXRlZ29yeSkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCl7CgkJYm9vbCBpc2NyZWF0ZWQ9ZmFsc2U7CgkJdWludDI1NiB0b3RhbENhcmRzID0gdG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50MjU2IGk9MDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgIDw9IHRvdGFsQ2FyZHMtMTsgaSsrKSB7CiAgICAgICAgICAgIC8vY2hlY2sgZm9yIHRoZSBzYW1lIGNhdGVnb3J5CiAgICAgICAgICAgIGlmICgoa2VjY2FrMjU2KGNhcmRzW2ldLmNhdGVnb3J5KT09a2VjY2FrMjU2KF9jYXRlZ29yeSkpICYmIChjYXJkc1tpXS5Jc3dpbGRjYXJkPT0xKSl7CgkJCSAgIGlzY3JlYXRlZD10cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgkJcmV0dXJuIGlzY3JlYXRlZDsKCX0KCQoJZnVuY3Rpb24gdW5zZXRXaWxkQ2FyZFRva2VuKHVpbnQyNTYgdG9rZW5JZCkgcHVibGljIG9ubHlBZG1pbiB7CgkJCgkJLy9TdGFydCBOZXcgQ29kZS0tZm9yIG1ha2luZyB3aWxkIGNhcmQgZm9yIGVhY2ggY2F0ZWdvcnkKCQl1aW50MjU2IGluZGV4ID0gY2FyZFRva2VuVG9Qb3NpdGlvblt0b2tlbklkXTsKCSAgICAvL0NhcmQgc3RvcmFnZSBjYXJkID0gY2FyZHNbaW5kZXhdOwoJICAgIHN0cmluZyBzdG9yYWdlIGNhcmRDYXRlZ29yeT1jYXJkc1tpbmRleF0uY2F0ZWdvcnk7CgkgICAgdWludDI1NiB0b3RhbENhcmRzID0gdG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50MjU2IGk9MDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgIDw9IHRvdGFsQ2FyZHMtMTsgaSsrKSB7CiAgICAgICAgICAgIC8vY2hlY2sgZm9yIHRoZSBzYW1lIGNhdGVnb3J5CiAgICAgICAgICAgIGlmIChrZWNjYWsyNTYoY2FyZHNbaV0uY2F0ZWdvcnkpPT1rZWNjYWsyNTYoY2FyZENhdGVnb3J5KSl7CiAgICAgICAgICAgICAgIGNhcmRzW2ldLklzd2lsZGNhcmQ9MDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoJCS8vRW5kIE5ldyBDb2RlLS0KCQl3aWxkY2FyZFRva2VuSWQgPSB0b2tlbklkOwoJCWVtaXQgTmV3V2lsZFRva2VuKHdpbGRjYXJkVG9rZW5JZCk7Cgl9CgkKCWZ1bmN0aW9uIGdldFVzZXIoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMoCgkgICAgc3RyaW5nIG5hbWUsCgkgICAgc3RyaW5nIGVtYWlsLAoJICAgIHVpbnQyNTYgcG9zaXRpb24pIAoJICAgIHsKCSAgICB1aW50MjU2IGluZGV4ID0gdXNlckFycmV5UG9zaXRpb25bX293bmVyXTsKCSAgICBDYXJkVXNlciBzdG9yYWdlIHVzZXIgPSBjYXJkdXNlcnNbaW5kZXhdOwoJCW5hbWU9dXNlci5uYW1lOwoJCWVtYWlsPXVzZXIuZW1haWw7CgkJcG9zaXRpb249aW5kZXg7CgkgICAgCgl9IAoJZnVuY3Rpb24gdG90VXNlcnMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpewoJICAgIHJldHVybiBjYXJkdXNlcnMubGVuZ3RoOwoJfQoJZnVuY3Rpb24gYWRkdXNlcihzdHJpbmcgX25hbWUsc3RyaW5nIF9lbWFpbCxhZGRyZXNzIHVzZXJBZGRyZXNzKSBwdWJsaWN7CgkgICAgQ2FyZFVzZXIgbWVtb3J5IF9jYXJkdXNlciA9IENhcmRVc2VyKHsKCQkgIG5hbWU6X25hbWUsCgkJICBlbWFpbDpfZW1haWwKCQl9KTsKCQkKCQl1aW50MjU2IGluZGV4ID0gY2FyZHVzZXJzLnB1c2goX2NhcmR1c2VyKSAtIDE7CgkJdXNlckFycmV5UG9zaXRpb25bdXNlckFkZHJlc3NdID0gaW5kZXg7Cgl9CgoJZnVuY3Rpb24gYWRkQ2F0ZWdvcnkoc3RyaW5nIF9uYW1lLHVpbnQyNTYgX2lkKSBwdWJsaWN7CgkgICAgQ2F0ZWdvcnkgbWVtb3J5IF9jYXRlZ29yeSA9IENhdGVnb3J5KHsKCSAgICAgIGlkOl9pZCwKCQkgIG5hbWU6X25hbWUKCQl9KTsKCQl1aW50MjU2IGluZGV4ID0gY2F0ZWdvcmllcy5wdXNoKF9jYXRlZ29yeSkgLSAxOwoJCWNhdGVnb3J5VG9Qb3NpdGlvbltfaWRdID0gaW5kZXg7Cgl9CgkJZnVuY3Rpb24gZ2V0VG90YWxDYXRlZ29yaWVzKCkgcHVibGljIHZpZXcgcmV0dXJucygKCSAgICB1aW50MjU2KSAKCSAgICB7CgkgICAgICAgIHJldHVybiBjYXRlZ29yaWVzLmxlbmd0aDsKCSAgICAgICAgCgkgICAgfQoJZnVuY3Rpb24gZ2V0Q2F0ZWdvcnkodWludDI1NiBfaWQpIHB1YmxpYyB2aWV3IHJldHVybnMoCgkgICAgc3RyaW5nIG5hbWUpIAoJICAgIHsKCSAgICB1aW50MjU2IGluZGV4ID0gY2F0ZWdvcnlUb1Bvc2l0aW9uW19pZF07CgkgICAgQ2F0ZWdvcnkgc3RvcmFnZSBjYXQgPSBjYXRlZ29yaWVzW2luZGV4XTsKCQluYW1lPWNhdC5uYW1lOwoJfSAKCQkKCWZ1bmN0aW9uIF9jcmVhdGVUb2tlbihzdHJpbmcgX25hbWUsc3RyaW5nIF9pbWFnZXBhdGgsc3RyaW5nIF9jYXRlZ29yeSwgdWludDI1NiBfaWQsIGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9wcmljZSx1aW50MjU2IF9Jc1dpbGRjYXJkKSBwcml2YXRlIHsKCSAgICAKCQlDYXJkIG1lbW9yeSBfY2FyZCA9IENhcmQoewoJCSAgbmFtZTogX25hbWUsCgkJICB0b2tlbjogX2lkLAoJCSAgaW1hZ2VwYXRoOl9pbWFnZXBhdGgsCgkJICBjYXRlZ29yeTpfY2F0ZWdvcnksCgkJICBJc3dpbGRjYXJkOl9Jc1dpbGRjYXJkLAoJCSAgb3duZXI6YWRtaW5BZGRyZXNzCgkJfSk7CgkJCQoJCXVpbnQyNTYgaW5kZXggPSBjYXJkcy5wdXNoKF9jYXJkKSAtIDE7CgkJY2FyZFRva2VuVG9Qb3NpdGlvbltfaWRdID0gaW5kZXg7CgkJLy8gSXQncyBwcm9iYWJseSBuZXZlciBnb2luZyB0byBoYXBwZW4sIDQgYmlsbGlvbiB0b2tlbnMgYXJlIEEgTE9ULCBidXQKCQkvLyBsZXQncyBqdXN0IGJlIDEwMCUgc3VyZSB3ZSBuZXZlciBsZXQgdGhpcyBoYXBwZW4uCgkJcmVxdWlyZShfaWQgPT0gdWludDI1Nih1aW50MzIoX2lkKSkpOwoKCQllbWl0IE5ld1Rva2VuKF9pZCwgX25hbWUsIF9vd25lcik7CgkJY2FyZFRva2VuVG9QcmljZVtfaWRdID0gX3ByaWNlOwoJCS8vIFRoaXMgd2lsbCBhc3NpZ24gb3duZXJzaGlwLCBhbmQgYWxzbyBlbWl0IHRoZSBUcmFuc2ZlciBldmVudCBhcwoJCS8vIHBlciBFUkM3MjEgZHJhZnQKCQlfdHJhbnNmZXIoYWRkcmVzcygwKSwgX293bmVyLCBfaWQpOwoJfQoJLyoqKiBDQVJEUyAqKiovCgkKCS8qKiogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqKiovCgkKCS8qKiogRVJDNzIxIEZVTkNUSU9OUyAqKiovCiAgICAvLy8gQG5vdGljZSBHcmFudCBhbm90aGVyIGFkZHJlc3MgdGhlIHJpZ2h0IHRvIHRyYW5zZmVyIHRva2VuIHZpYSB0YWtlT3duZXJzaGlwKCkgYW5kIHRyYW5zZmVyRnJvbSgpLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYmUgZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbC4gUGFzcyBhZGRyZXNzKDApIHRvCiAgICAvLy8gIGNsZWFyIGFsbCBhcHByb3ZhbHMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgVG9rZW4gdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgICApIHB1YmxpYyB7CiAgICAgICAgLy8gQ2FsbGVyIG11c3Qgb3duIHRva2VuLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgIAogICAgICAgIGNhcmRUb2tlblRvQXBwcm92ZWRbX3Rva2VuSWRdID0gX3RvOwogICAgCiAgICAgICAgZW1pdCBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KICAgIAogICAgLy8vIEZvciBxdWVyeWluZyBiYWxhbmNlIG9mIGEgcGFydGljdWxhciBhY2NvdW50CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmb3IgYmFsYW5jZSBxdWVyeQogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaW1wbGVtZW50c0VSQzcyMSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAoKICAgIC8vLyBGb3IgcXVlcnlpbmcgb3duZXIgb2YgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIHRva2VuSUQgZm9yIG93bmVyIGlucXVpcnkKICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICBvd25lciA9IGNhcmRUb2tlblRvT3duZXJbX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEFsbG93IHByZS1hcHByb3ZlZCB1c2VyIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBUb2tlbiB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgICAgIGFkZHJlc3MgbmV3T3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGFkZHJlc3Mgb2xkT3duZXIgPSBjYXJkVG9rZW5Ub093bmVyW190b2tlbklkXTsKICAgIAogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF9hZGRyZXNzTm90TnVsbChuZXdPd25lcikpOwoKICAgICAgICAvLyBNYWtpbmcgc3VyZSB0cmFuc2ZlciBpcyBhcHByb3ZlZAogICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkKG5ld093bmVyLCBfdG9rZW5JZCkpOwogICAgCiAgICAgICAgX3RyYW5zZmVyKG9sZE93bmVyLCBuZXdPd25lciwgX3Rva2VuSWQpOwogICAgfQogICAgCiAgICAvLy8gRm9yIHF1ZXJ5aW5nIHRvdGFsU3VwcGx5IG9mIHRva2VuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKSB7CiAgICAgICAgcmV0dXJuIGNhcmRzLmxlbmd0aDsKICAgIH0KICAgIAogICAgLy8vIFRoaXJkLXBhcnR5IGluaXRpYXRlcyB0cmFuc2ZlciBvZiB0b2tlbiBmcm9tIGFkZHJlc3MgX2Zyb20gdG8gYWRkcmVzcyBfdG8KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgZm9yIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZCBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgZm9yIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZCB0by4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBUb2tlbiB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX293bnMoX2Zyb20sIF90b2tlbklkKSk7CiAgICAgICAgcmVxdWlyZShfYXBwcm92ZWQoX3RvLCBfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUoX2FkZHJlc3NOb3ROdWxsKF90bykpOwogICAgCiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gT3duZXIgaW5pdGF0ZXMgdGhlIHRyYW5zZmVyIG9mIHRoZSB0b2tlbiB0byBhbm90aGVyIGFjY291bnQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIGZvciB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQgdG8uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgVG9rZW4gdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzTm90TnVsbChfdG8pKTsKICAgIAogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KICAgIAogICAgLy8vIFRyYW5mZXIgdG9rZW4gdG8gYW55IGFkZHJlc3MgaGUgd2FudCB0bwoJLy8vIEBwYXJhbSBfdG8gdGhlIGFkZHJlcyBvZiB0b2tlbiBnb2luZyB0byBhc3NpZ24KCS8vLyBAcGFyYW0gX3Rva2VuSWQgaXMgSWQgb2YgdG9rZW4gd2hpY2ggaXMgZ29pbmcgdG8gdG8gdHJhbnNmZXIKCWZ1bmN0aW9uIHRva2VuVHJhbnNmZXIoYWRkcmVzcyBfdG8sdWludDI1NiBfdG9rZW5JZCkgIHB1YmxpYyBvbmx5QWRtaW57CgkJYWRkcmVzcyBvbGRPd25lciA9IGNhcmRUb2tlblRvT3duZXJbX3Rva2VuSWRdOwoJCWFkZHJlc3MgbmV3T3duZXIgPSBfdG87CgkJdWludDI1NiBpbmRleCA9IGNhcmRUb2tlblRvUG9zaXRpb25bX3Rva2VuSWRdOwoJCWNhcmRzW2luZGV4XS5vd25lcj1uZXdPd25lcjsJCQoJCV90cmFuc2ZlcihvbGRPd25lciwgbmV3T3duZXIsIF90b2tlbklkKTsKCX0KCQoJCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBOQU1FOwogICAgfQogICAgCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIFNZTUJPTDsKICAgIH0KCgkvKioqIEVSQzcyMSBGVU5DVElPTlMgKioqLwoJCgkvKioqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKioqLwoJCgkvKioqIEFETUlOSVNUUkFUT1IgRlVOQ1RJT05TICoqKi8KCQoJLy9zZW5kIGJhbGFuY2Ugb2YgY29udHJhY3Qgb24gd2FsbGV0CglmdW5jdGlvbiBwYXlvdXQoYWRkcmVzcyBfdG8pIHB1YmxpYyBvbmx5SG9zdE9yQWRtaW4gewoJCV9wYXlvdXQoX3RvKTsKCX0KCQoJZnVuY3Rpb24gX3BheW91dChhZGRyZXNzIF90bykgcHJpdmF0ZSB7CgkJaWYgKF90byA9PSBhZGRyZXNzKDApKSB7CgkJCWhvc3RBZGRyZXNzLnRyYW5zZmVyKGFkZHJlc3ModGhpcykuYmFsYW5jZSk7CgkJfSBlbHNlIHsKCQkJX3RvLnRyYW5zZmVyKGFkZHJlc3ModGhpcykuYmFsYW5jZSk7CgkJfQoJfQoJCgkvKioqIEFETUlOSVNUUkFUT1IgRlVOQ1RJT05TICoqKi8KCQoKICAgIC8qKiogUFVCTElDIEZVTkNUSU9OUyAqKiovCgogICAgZnVuY3Rpb24gY29udHJhY3RCYWxhbmNlKCkgcHVibGljICB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBhZGRyZXNzKHRoaXMpLmJhbGFuY2U7CiAgICB9CgoKZnVuY3Rpb24gZ2V0TmV4dFByaWNlKHVpbnQyNTYgc2VsbGluZ1ByaWNlKSBwcml2YXRlIHZpZXcgcmV0dXJucyAodWludDI1Nil7CiAgIAogICAgIC8vIFVwZGF0ZSBwcmljZXMKICAgIGlmIChzZWxsaW5nUHJpY2UgPCBmaXJzdFN0ZXBMaW1pdCkgewogICAgICAvLyBmaXJzdCBzdGFnZQogICAgICBzZWxsaW5nUHJpY2UgPSBIZWxwZXIuZGl2KEhlbHBlci5tdWwoc2VsbGluZ1ByaWNlLCAzMDApLCA5Myk7CiAgICB9IGVsc2UgaWYgKHNlbGxpbmdQcmljZSA8IHNlY29uZFN0ZXBMaW1pdCkgewogICAgICAvLyBzZWNvbmQgc3RhZ2UKICAgICAgc2VsbGluZ1ByaWNlPSBIZWxwZXIuZGl2KEhlbHBlci5tdWwoc2VsbGluZ1ByaWNlLCAyMDApLCA5Myk7CiAgICB9IGVsc2UgaWYgKHNlbGxpbmdQcmljZSA8IHRoaXJkU3RlcExpbWl0KSB7CiAgICAgIC8vIHNlY29uZCBzdGFnZQogICAgICBzZWxsaW5nUHJpY2UgPSBIZWxwZXIuZGl2KEhlbHBlci5tdWwoc2VsbGluZ1ByaWNlLCAxMjApLCA5Myk7CiAgICB9IGVsc2UgewogICAgICAvLyB0aGlyZCBzdGFnZQogICAgICBzZWxsaW5nUHJpY2UgPSBIZWxwZXIuZGl2KEhlbHBlci5tdWwoc2VsbGluZ1ByaWNlLCAxMTUpLCA5Myk7CiAgICB9CiAgICByZXR1cm4gc2VsbGluZ1ByaWNlOwp9IAoKLy9nZXQgdGhlIHNlbGxpbmcgcHJpY2Ugb2YgY2FyZCBiYXNlZCBvbiBzbGFiLgpmdW5jdGlvbiBuZXh0UHJpY2VPZih1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHByaWNlKXsKICAgIHVpbnQyNTYgc2VsbGluZ1ByaWNlPWNhcmRUb2tlblRvUHJpY2VbX3Rva2VuSWRdOwogICAgIC8vIFVwZGF0ZSBwcmljZXMKICAgIGlmIChzZWxsaW5nUHJpY2UgPCBmaXJzdFN0ZXBMaW1pdCkgewogICAgICAvLyBmaXJzdCBzdGFnZQogICAgICBzZWxsaW5nUHJpY2UgPSBIZWxwZXIuZGl2KEhlbHBlci5tdWwoc2VsbGluZ1ByaWNlLCAzMDApLCA5Myk7CiAgICB9IGVsc2UgaWYgKHNlbGxpbmdQcmljZSA8IHNlY29uZFN0ZXBMaW1pdCkgewogICAgICAvLyBzZWNvbmQgc3RhZ2UKICAgICAgc2VsbGluZ1ByaWNlPSBIZWxwZXIuZGl2KEhlbHBlci5tdWwoc2VsbGluZ1ByaWNlLCAyMDApLCA5Myk7CiAgICB9IGVsc2UgaWYgKHNlbGxpbmdQcmljZSA8IHRoaXJkU3RlcExpbWl0KSB7CiAgICAgIC8vIHNlY29uZCBzdGFnZQogICAgICBzZWxsaW5nUHJpY2UgPSBIZWxwZXIuZGl2KEhlbHBlci5tdWwoc2VsbGluZ1ByaWNlLCAxMjApLCA5Myk7CiAgICB9IGVsc2UgewogICAgICAvLyB0aGlyZCBzdGFnZQogICAgICBzZWxsaW5nUHJpY2UgPSBIZWxwZXIuZGl2KEhlbHBlci5tdWwoc2VsbGluZ1ByaWNlLCAxMTUpLCA5Myk7CiAgICB9CiAgICByZXR1cm4gc2VsbGluZ1ByaWNlOwp9IAoKICBmdW5jdGlvbiBjaGFuZ2VQcmljZSh1aW50MjU2IF90b2tlbklkLHVpbnQyNTYgX3ByaWNlKSBwdWJsaWMgb25seUFkbWluCiAgewoJICAgIC8vIFVwZGF0ZSBwcmljZXMKCQljYXJkVG9rZW5Ub1ByaWNlW190b2tlbklkXSA9X3ByaWNlOwoJCiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgb25seUFkbWluIHsKICAgIGFkZHJlc3Mgb2xkT3duZXIgPSBjYXJkVG9rZW5Ub093bmVyW190b2tlbklkXTsKICAgIGFkZHJlc3MgbmV3T3duZXIgPSBfdG87Cgl1aW50MjU2IGluZGV4ID0gY2FyZFRva2VuVG9Qb3NpdGlvbltfdG9rZW5JZF07CgkvL2Fzc2lnbiBuZXcgb3duZXIgaGFzaAoJY2FyZHNbaW5kZXhdLm93bmVyPW5ld093bmVyOwogICAgX3RyYW5zZmVyKG9sZE93bmVyLCBuZXdPd25lciwgX3Rva2VuSWQpOyAKICAgIAogIH0KCiAgLy9uby4gb2YgdG9rZW5zIGlzc3VlZCB0byB0aGUgbWFya2V0CiAgZnVuY3Rpb24gbnVtYmVyT2ZUb2tlbnMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gY2FyZHMubGVuZ3RoOwogIH0KIC8vIEFsbG93cyBzb21lb25lIHRvIHNlbmQgZXRoZXIgYW5kIG9idGFpbiB0aGUgdG9rZW4KIGZ1bmN0aW9uIHB1cmNoYXNlKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGFkZHJlc3Mgb2xkT3duZXIgPSBjYXJkVG9rZW5Ub093bmVyW190b2tlbklkXTsKICAgIGFkZHJlc3MgbmV3T3duZXIgPSBtc2cuc2VuZGVyOwogICAgCgkKCS8vcHJldmVudCByZXB1cmNoYXNlIAogICAgcmVxdWlyZShvbGRPd25lciAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IHNlbGxpbmdQcmljZSA9bXNnLnZhbHVlOy8vZ2V0TmV4dFByaWNlKGNhcmRUb2tlblRvUHJpY2VbX3Rva2VuSWRdKTsKCiAgICAvLyBNYWtpbmcgc3VyZSB0b2tlbiBvd25lciBpcyBub3Qgc2VuZGluZyB0byBzZWxmCiAgICByZXF1aXJlKG9sZE93bmVyICE9IG5ld093bmVyKTsKCiAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICByZXF1aXJlKF9hZGRyZXNzTm90TnVsbChuZXdPd25lcikpOwoKICAgIC8vIE1ha2luZyBzdXJlIHNlbnQgYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgc2VsbGluZ1ByaWNlCiAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBzZWxsaW5nUHJpY2UpOwoKICAgIAogICAgLy8gVXBkYXRlIHByaWNlcwogICAgY2FyZFRva2VuVG9QcmljZVtfdG9rZW5JZF0gPWdldE5leHRQcmljZShzZWxsaW5nUHJpY2UpOwoKICAgIF90cmFuc2ZlcihvbGRPd25lciwgbmV3T3duZXIsIF90b2tlbklkKTsKCgkvL1BheSBXaWxkIGNhcmQgY29tbWlzc2lvbgogICAgYWRkcmVzcyB3aWxkY2FyZE93bmVyID1HZXRXaWxkQ2FyZE93bmVyKF90b2tlbklkKSA7Ly9jYXJkVG9rZW5Ub093bmVyW3dpbGRjYXJkVG9rZW5JZF07Cgl1aW50MjU2IHdpbGRjYXJkUGF5bWVudD11aW50MjU2KEhlbHBlci5kaXYoSGVscGVyLm11bChzZWxsaW5nUHJpY2UsIDQpLCAxMDApKTsgLy8gNCUgZm9yIHdpbGQgY2FyZCBvd25lcgoJdWludDI1NiBwYXltZW50PXVpbnQyNTYoSGVscGVyLmRpdihIZWxwZXIubXVsKHNlbGxpbmdQcmljZSwgOTApLCAxMDApKTsgLy85MCUgZm9yIG9sZCBvd25lcgogICAgaWYgKHdpbGRjYXJkT3duZXIgIT0gYWRkcmVzcygwKSkgewoJCXdpbGRjYXJkT3duZXIudHJhbnNmZXIod2lsZGNhcmRQYXltZW50KTsgIAoJCXNlbGxpbmdQcmljZT1zZWxsaW5nUHJpY2UgLSB3aWxkY2FyZFBheW1lbnQ7ICAKICAgIH0KCQogICAgLy8gUGF5IHByZXZpb3VzIHRva2VuT3duZXIgaWYgb3duZXIgaXMgbm90IGNvbnRyYWN0CgkvL2FkZHJlc3ModGhpcykgPSBDb250cmFjdCBBZGRyZXNzCiAgICBpZiAob2xkT3duZXIgIT0gYWRkcmVzcyh0aGlzKSkgewoJCW9sZE93bmVyLnRyYW5zZmVyKHBheW1lbnQpOyAgCiAgICB9CgkvL0JhbGFuY2UgMTAwJS0gKDQlICsgOTAlKSA9NiUgd2lsbCBhdXRvIHRyYW5zZmVyIHRvIGNvbnRyYWN0IGlmIHdpbGQgY2FyZAogICAgLy9DT05UUkFDVCBFVkVOVCAKCXVpbnQyNTYgaW5kZXggPSBjYXJkVG9rZW5Ub1Bvc2l0aW9uW190b2tlbklkXTsKCS8vYXNzaWduIG5ldyBvd25lciBoYXNoCgljYXJkc1tpbmRleF0ub3duZXI9bmV3T3duZXI7CiAgICBlbWl0IE5ld1Rva2VuT3duZXIoc2VsbGluZ1ByaWNlLCBjYXJkVG9rZW5Ub1ByaWNlW190b2tlbklkXSwgb2xkT3duZXIsIG5ld093bmVyLCBjYXJkc1tpbmRleF0ubmFtZSwgX3Rva2VuSWQpOwoJIAogIH0KICAKCmZ1bmN0aW9uIEdldFdpbGRDYXJkT3duZXIodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfY2FyZG93bmVyKXsKCQl1aW50MjU2IGluZGV4PQljYXJkVG9rZW5Ub1Bvc2l0aW9uW190b2tlbklkXTsKCQlzdHJpbmcgc3RvcmFnZSBjYXJkQ2F0ZWdvcnk9Y2FyZHNbaW5kZXhdLmNhdGVnb3J5OwoJCQoJICAgIHVpbnQyNTYgdG90YWxDYXJkcyA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgdWludDI1NiBpPTA7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpICA8PSB0b3RhbENhcmRzLTE7IGkrKykgewogICAgICAgICAgICAvL2NoZWNrIGZvciB0aGUgc2FtZSBjYXRlZ29yeQogICAgICAgICAgICBpZiAoKGtlY2NhazI1NihjYXJkc1tpXS5jYXRlZ29yeSk9PWtlY2NhazI1NihjYXJkQ2F0ZWdvcnkpKSAmJiBjYXJkc1tpXS5Jc3dpbGRjYXJkPT0xKXsKICAgICAgICAgICAgICAgcmV0dXJuIGNhcmRzW2ldLm93bmVyOwogICAgICAgICAgICB9CiAgICAgICAgICB9Cn0KICBmdW5jdGlvbiBwcmljZU9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcHJpY2UpIHsKICAgIHJldHVybiBjYXJkVG9rZW5Ub1ByaWNlW190b2tlbklkXTsKICB9CgoKCiAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIHdob3NlIGNlbGVicml0eSB0b2tlbnMgd2UgYXJlIGludGVyZXN0ZWQgaW4uCiAgLy8vIEBkZXYgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZS4gRmlyc3QsIGl0J3MgZmFpcmx5CiAgLy8vICBleHBlbnNpdmUgKGl0IHdhbGtzIHRoZSBlbnRpcmUgY2FyZHMgYXJyYXkgbG9va2luZyBmb3IgY2FyZHMgYmVsb25naW5nIHRvIG93bmVyKSwKICAvLy8gIGJ1dCBpdCBhbHNvIHJldHVybnMgYSBkeW5hbWljIGFycmF5LCB3aGljaCBpcyBvbmx5IHN1cHBvcnRlZCBmb3Igd2ViMyBjYWxscywgYW5kCiAgLy8vICBub3QgY29udHJhY3QtdG8tY29udHJhY3QgY2FsbHMuCiAgZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2W10gb3duZXJUb2tlbnMpIHsKICAgIHVpbnQyNTYgdG9rZW5Db3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgaWYgKHRva2VuQ291bnQgPT0gMCkgewogICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICByZXR1cm4gbmV3IHVpbnQyNTZbXSgwKTsKICAgIH0gZWxzZSB7CiAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgdWludDI1NiB0b3RhbENhcmRzID0gdG90YWxTdXBwbHkoKTsKICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICB1aW50MjU2IGluZGV4OwogICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPD0gdG90YWxDYXJkcy0xOyBpbmRleCsrKSB7CiAgICAgICAgaWYgKGNhcmRUb2tlblRvT3duZXJbY2FyZHNbaW5kZXhdLnRva2VuXSA9PSBfb3duZXIpIHsKICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF0gPSBjYXJkc1tpbmRleF0udG9rZW47CiAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH0KCiAgLyoqKiBQUklWQVRFIEZVTkNUSU9OUyAqKiovCiAgLy8vIFNhZmV0eSBjaGVjayBvbiBfdG8gYWRkcmVzcyB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICBmdW5jdGlvbiBfYWRkcmVzc05vdE51bGwoYWRkcmVzcyBfdG8pIHByaXZhdGUgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gX3RvICE9IGFkZHJlc3MoMCk7CiAgfQoKICAvLy8gRm9yIGNoZWNraW5nIGFwcHJvdmFsIG9mIHRyYW5zZmVyIGZvciBhZGRyZXNzIF90bwogIGZ1bmN0aW9uIF9hcHByb3ZlZChhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBjYXJkVG9rZW5Ub0FwcHJvdmVkW190b2tlbklkXSA9PSBfdG87CiAgfQoKICAvLy8gQ2hlY2sgZm9yIHRva2VuIG93bmVyc2hpcAogIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gY2xhaW1hbnQgPT0gY2FyZFRva2VuVG9Pd25lcltfdG9rZW5JZF07CiAgfQoKCiAgLy8vIEBkZXYgQXNzaWducyBvd25lcnNoaXAgb2YgYSBzcGVjaWZpYyBjYXJkIHRvIGFuIGFkZHJlc3MuCiAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKICAgIC8vIFNpbmNlIHRoZSBudW1iZXIgb2YgY2FyZHMgaXMgY2FwcGVkIHRvIDJeMzIgd2UgY2FuJ3Qgb3ZlcmZsb3cgdGhpcwogICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CiAgICAvL3RyYW5zZmVyIG93bmVyc2hpcAogICAgY2FyZFRva2VuVG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CgogICAgLy8gV2hlbiBjcmVhdGluZyBuZXcgY2FyZHMgX2Zyb20gaXMgMHgwLCBidXQgd2UgY2FuJ3QgYWNjb3VudCB0aGF0IGFkZHJlc3MuCiAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lcnNoaXBUb2tlbkNvdW50W19mcm9tXS0tOwogICAgICAvLyBjbGVhciBhbnkgcHJldmlvdXNseSBhcHByb3ZlZCBvd25lcnNoaXAgZXhjaGFuZ2UKICAgICAgZGVsZXRlIGNhcmRUb2tlblRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgfQoKICAgIC8vIEVtaXQgdGhlIHRyYW5zZmVyIGV2ZW50LgogICAgZW1pdCBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgfQogIAoKICAgIGZ1bmN0aW9uIENyeXB0b0NvbGxlY3RvckNvbnRyYWN0KCkgcHVibGljIHsKICAgIH0KICAgIAp9CgpsaWJyYXJ5IEhlbHBlciB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJ0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQ=='.
	

]
