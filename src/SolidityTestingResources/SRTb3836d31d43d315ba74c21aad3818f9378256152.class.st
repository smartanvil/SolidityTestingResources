Class {
	#name : #SRTb3836d31d43d315ba74c21aad3818f9378256152,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb3836d31d43d315ba74c21aad3818f9378256152 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKKiBQb256aSBUcnVzdCBQeXJhbWlkIEdhbWUgU21hcnQgQ29udHJhY3RzIAoqIENvZGUgaXMgcHVibGlzaGVkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9Qb256aVRydXN0L1B5cmFtaWRHYW1lCiogUG9uemkgVHJ1c3QgaHR0cHM6Ly9wb256aXRydXN0LmNvbS8KKi8KCi8vIGNvbnRyYWN0IHRvIHN0b3JlIGFsbCBpbmZvIGFib3V0IHBsYXllcnMgCmNvbnRyYWN0IFBsYXllcnNTdG9yYWdlIHsKICBzdHJ1Y3QgUGxheWVyIHsKICAgIHVpbnQyNTYgaW5wdXQ7IAogICAgdWludDI1NiB0aW1lc3RhbXA7CiAgICBib29sIGV4aXN0OwogIH0KICBtYXBwaW5nIChhZGRyZXNzID0+IFBsYXllcikgcHJpdmF0ZSBtX3BsYXllcnM7CiAgYWRkcmVzcyBwcml2YXRlIG1fb3duZXI7CiAgICAKICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbV9vd25lcik7CiAgICBfOwogIH0KICAKICBmdW5jdGlvbiBQbGF5ZXJzU3RvcmFnZSgpIHB1YmxpYyB7CiAgICBtX293bmVyID0gbXNnLnNlbmRlcjsgIAogIH0KCiAgLy8gaHR0cDovL3NvbGlkaXR5LnJlYWR0aGVkb2NzLmlvL2VuL2RldmVsb3AvY29udHJhY3RzLmh0bWwjZmFsbGJhY2stZnVuY3Rpb24gCiAgLy8gQ29udHJhY3RzIHRoYXQgcmVjZWl2ZSBFdGhlciBkaXJlY3RseSAod2l0aG91dCBhIGZ1bmN0aW9uIGNhbGwsIGkuZS4gdXNpbmcgc2VuZCAKICAvLyBvciB0cmFuc2ZlcikgYnV0IGRvIG5vdCBkZWZpbmUgYSBmYWxsYmFjayBmdW5jdGlvbiB0aHJvdyBhbiBleGNlcHRpb24sIAogIC8vIHNlbmRpbmcgYmFjayB0aGUgRXRoZXIgKHRoaXMgd2FzIGRpZmZlcmVudCBiZWZvcmUgU29saWRpdHkgdjAuNC4wKS4KICAvLyBmdW5jdGlvbigpIHBheWFibGUgeyByZXZlcnQoKTsgfQoKCiAgLyoqCiAgKiBAZGV2IFRyeSBjcmVhdGUgbmV3IHBsYXllciBpbiBzdG9yYWdlLgogICogQHBhcmFtIGFkZHIgQWRycmVzcyBvZiBwbGF5ZXIuCiAgKiBAcGFyYW0gaW5wdXQgSW5wdXQgb2YgcGxheWVyLgogICogQHBhcmFtIHRpbWVzdGFtcCBUaW1lc3RhbXAgb2YgcGxheWVyLgogICovCiAgZnVuY3Rpb24gbmV3UGxheWVyKGFkZHJlc3MgYWRkciwgdWludDI1NiBpbnB1dCwgdWludDI1NiB0aW1lc3RhbXApIAogICAgcHVibGljIAogICAgb25seU93bmVyKCkgCiAgICByZXR1cm5zKGJvb2wpCiAgewogICAgaWYgKG1fcGxheWVyc1thZGRyXS5leGlzdCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBtX3BsYXllcnNbYWRkcl0uaW5wdXQgPSBpbnB1dDsKICAgIG1fcGxheWVyc1thZGRyXS50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CiAgICBtX3BsYXllcnNbYWRkcl0uZXhpc3QgPSB0cnVlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIAogIC8qKgogICogQGRldiBEZWxldCBzcGVjaWZpZWQgcGxheWVyIGZyb20gc3RvcmFnZS4KICAqIEBwYXJhbSBhZGRyIEFkcnJlc3Mgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqLwogIGZ1bmN0aW9uIGRlbGV0ZVBsYXllcihhZGRyZXNzIGFkZHIpIHB1YmxpYyBvbmx5T3duZXIoKSB7CiAgICBkZWxldGUgbV9wbGF5ZXJzW2FkZHJdOwogIH0KICAKICAvKioKICAqIEBkZXYgR2V0IGluZm8gYWJvdXQgc3BlY2lmaWVkIHBsYXllci4KICAqIEBwYXJhbSBhZGRyIEFkcnJlc3Mgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEByZXR1cm4gaW5wdXQgSW5wdXQgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEByZXR1cm4gdGltZXN0YW1wIFRpbWVzdGFtcCBvZiBzcGVjaWZpZWQgcGxheWVyLgogICogQHJldHVybiBleGlzdCBXaGV0aGVyIHNwZWNpZmllZCBwbGF5ZXIgaW4gc3RvcmFnZSBvciBub3QuCiAgKi8KICBmdW5jdGlvbiBwbGF5ZXJJbmZvKGFkZHJlc3MgYWRkcikgCiAgICBwdWJsaWMKICAgIHZpZXcKICAgIG9ubHlPd25lcigpIAogICAgcmV0dXJucyh1aW50MjU2IGlucHV0LCB1aW50MjU2IHRpbWVzdGFtcCwgYm9vbCBleGlzdCkgCiAgewogICAgaW5wdXQgPSBtX3BsYXllcnNbYWRkcl0uaW5wdXQ7CiAgICB0aW1lc3RhbXAgPSBtX3BsYXllcnNbYWRkcl0udGltZXN0YW1wOwogICAgZXhpc3QgPSBtX3BsYXllcnNbYWRkcl0uZXhpc3Q7CiAgfQogIAogIC8qKgogICogQGRldiBHZXQgaW5wdXQgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEBwYXJhbSBhZGRyIEFkcnJlc3Mgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEByZXR1cm4gaW5wdXQgSW5wdXQgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqLwogIGZ1bmN0aW9uIHBsYXllcklucHV0KGFkZHJlc3MgYWRkcikgCiAgICBwdWJsaWMKICAgIHZpZXcKICAgIG9ubHlPd25lcigpIAogICAgcmV0dXJucyh1aW50MjU2IGlucHV0KSAKICB7CiAgICBpbnB1dCA9IG1fcGxheWVyc1thZGRyXS5pbnB1dDsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IEdldCB3aGV0aGVyIHNwZWNpZmllZCBwbGF5ZXIgaW4gc3RvcmFnZSBvciBub3QuCiAgKiBAcGFyYW0gYWRkciBBZHJyZXNzIG9mIHNwZWNpZmllZCBwbGF5ZXIuCiAgKiBAcmV0dXJuIGV4aXN0IFdoZXRoZXIgc3BlY2lmaWVkIHBsYXllciBpbiBzdG9yYWdlIG9yIG5vdC4KICAqLwogIGZ1bmN0aW9uIHBsYXllckV4aXN0KGFkZHJlc3MgYWRkcikgCiAgICBwdWJsaWMKICAgIHZpZXcKICAgIG9ubHlPd25lcigpIAogICAgcmV0dXJucyhib29sIGV4aXN0KSAKICB7CiAgICBleGlzdCA9IG1fcGxheWVyc1thZGRyXS5leGlzdDsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IEdldCBUaW1lc3RhbXAgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEBwYXJhbSBhZGRyIEFkcnJlc3Mgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEByZXR1cm4gdGltZXN0YW1wIFRpbWVzdGFtcCBvZiBzcGVjaWZpZWQgcGxheWVyLgogICovCiAgZnVuY3Rpb24gcGxheWVyVGltZXN0YW1wKGFkZHJlc3MgYWRkcikgCiAgICBwdWJsaWMKICAgIHZpZXcKICAgIG9ubHlPd25lcigpIAogICAgcmV0dXJucyh1aW50MjU2IHRpbWVzdGFtcCkgCiAgewogICAgdGltZXN0YW1wID0gbV9wbGF5ZXJzW2FkZHJdLnRpbWVzdGFtcDsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IFRyeSBzZXQgaW5wdXQgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEBwYXJhbSBhZGRyIEFkcnJlc3Mgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEBwYXJhbSBuZXdJbnB1dCBOZXcgaW5wdXQgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEByZXR1cm4gIFdoZXRoZXIgc3VjY2Vzc2Z1bCBvciBub3QuCiAgKi8KICBmdW5jdGlvbiBwbGF5ZXJTZXRJbnB1dChhZGRyZXNzIGFkZHIsIHVpbnQyNTYgbmV3SW5wdXQpCiAgICBwdWJsaWMKICAgIG9ubHlPd25lcigpCiAgICByZXR1cm5zKGJvb2wpIAogIHsKICAgIGlmICghbV9wbGF5ZXJzW2FkZHJdLmV4aXN0KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIG1fcGxheWVyc1thZGRyXS5pbnB1dCA9IG5ld0lucHV0OwogICAgcmV0dXJuIHRydWU7CiAgfQogIAogIC8qKgogICogQGRldiBEbyBzZWxmZGVzdHJ1Y3QuCiAgKi8KICBmdW5jdGlvbiBraWxsKCkgcHVibGljIG9ubHlPd25lcigpIHsKICAgIHNlbGZkZXN0cnVjdChtX293bmVyKTsKICB9Cn0KCgovLyBzZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkvYmxvYi9tYXN0ZXIvY29udHJhY3RzL21hdGgvU2FmZU1hdGguc29sCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovLyBzZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy82NzcKY29udHJhY3QgRVJDNjc3UmVjaXBpZW50IHsKICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgZnJvbSwgdWludDI1NiBhbW91bnQsIGJ5dGVzIGRhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwp9IAoKCi8vIFBvbnppIFRva2VuIE1pbmltYWwgSW50ZXJmYWNlCmNvbnRyYWN0IFBvbnppVG9rZW5NaW5JbnRlcmZhY2UgewogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCgovKioKKiBAZGV2IFRoZUdhbWUgY29udHJhY3QgaW1wbGVtZW50IEVSQzY2NyBSZWNpcGllbnQgCiogc2VlOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNjc3KSAKKiBhbmQgY2FuIHJlY2VpdmUgdG9rZW4vZXRoZXIgb25seSBmcm9tIFBvbnppIFRva2VuCiogc2VlOiBodHRwczovL2dpdGh1Yi5jb20vUG9uemlUcnVzdC9Ub2tlbikuCiovCmNvbnRyYWN0IFRoZUdhbWUgaXMgRVJDNjc3UmVjaXBpZW50IHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgZW51bSBTdGF0ZSB7CiAgICBOb3RBY3RpdmUsIC8vTm90QWN0aXZlCiAgICBBY3RpdmUgICAgIC8vQWN0aXZlCiAgfQoKICBTdGF0ZSBwcml2YXRlIG1fc3RhdGU7CiAgYWRkcmVzcyBwcml2YXRlIG1fb3duZXI7CiAgdWludDI1NiBwcml2YXRlIG1fbGV2ZWw7CiAgUGxheWVyc1N0b3JhZ2UgcHJpdmF0ZSBtX3BsYXllcnNTdG9yYWdlOwogIFBvbnppVG9rZW5NaW5JbnRlcmZhY2UgcHJpdmF0ZSBtX3BvbnppVG9rZW47CiAgdWludDI1NiBwcml2YXRlIG1faW50ZXJlc3RSYXRlTnVtZXJhdG9yOwogIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBJTlRFUkVTVF9SQVRFX0RFTk9NSU5BVE9SID0gMTAwMDsKICB1aW50MjU2IHByaXZhdGUgbV9jcmVhdGlvblRpbWVzdGFtcDsKICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgRFVSQVRJT05fVE9fQUNDRVNTX0ZPUl9PV05FUiA9IDE0NCBkYXlzOwogIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBDT01QT1VORElOR19GUkVRID0gMSBkYXlzOwogIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBERUxBWV9PTl9FWElUID0gMTAwIGhvdXJzOwogIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBERUxBWV9PTl9ORVdfTEVWRUwgPSA3IGRheXM7CiAgc3RyaW5nIHByaXZhdGUgY29uc3RhbnQgTk9UX0FDVElWRV9TVFIgPSAiTm90QWN0aXZlIjsKICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgUEVSQ0VOVF9UQVhfT05fRVhJVCA9IDEwOwogIHN0cmluZyBwcml2YXRlIGNvbnN0YW50IEFDVElWRV9TVFIgPSAiQWN0aXZlIjsKICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgUEVSQ0VOVF9SRUZFUlJBTF9CT1VOVFkgPSAxOwogIHVpbnQyNTYgcHJpdmF0ZSBtX2xldmVsU3RhcnR1cFRpbWVzdGFtcDsKICB1aW50MjU2IHByaXZhdGUgbV9wb256aVByaWNlSW5XZWk7CiAgYWRkcmVzcyBwcml2YXRlIG1fcHJpY2VTZXR0ZXI7CgovLy8vLy8vLy8vLy8vLy8vCi8vIEVWRU5UUwovLyAKICBldmVudCBOZXdQbGF5ZXIoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQyNTYgaW5wdXQsIHVpbnQyNTYgd2hlbik7CiAgZXZlbnQgRGVsZXRlUGxheWVyKGFkZHJlc3MgaW5kZXhlZCBhZGRyLCB1aW50MjU2IHdoZW4pOwogIGV2ZW50IE5ld0xldmVsKHVpbnQyNTYgd2hlbiwgdWludDI1NiBuZXdMZXZlbCk7CiAgZXZlbnQgU3RhdGVDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCB3aG8sIFN0YXRlIG5ld1N0YXRlKTsKICBldmVudCBQb256aVByaWNlQ2hhbmdlZChhZGRyZXNzIGluZGV4ZWQgd2hvLCB1aW50MjU2IG5ld1ByaWNlKTsKICAKLy8vLy8vLy8vLy8vLy8vLwovLyBNT0RJRklFUlMgLSBSZXN0cmljdGluZyBBY2Nlc3MgYW5kIFN0YXRlIE1hY2hpbmUgcGF0dGVybnMKLy8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbV9vd25lcik7CiAgICBfOwogIH0KICBtb2RpZmllciBvbmx5UG9uemlUb2tlbigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG1fcG9uemlUb2tlbikpOwogICAgXzsKICB9CiAgbW9kaWZpZXIgYXRTdGF0ZShTdGF0ZSBzdGF0ZSkgewogICAgcmVxdWlyZShtX3N0YXRlID09IHN0YXRlKTsKICAgIF87CiAgfQogIAogIG1vZGlmaWVyIGNoZWNrQWNjZXNzKCkgewogICAgcmVxdWlyZShtX3N0YXRlID09IFN0YXRlLk5vdEFjdGl2ZSAgLy8gc29saXVtLWRpc2FibGUtbGluZSBpbmRlbnRhdGlvbiwgb3BlcmF0b3Itd2hpdGVzcGFjZQogICAgICB8fCBub3cuc3ViKG1fY3JlYXRpb25UaW1lc3RhbXApIDw9IERVUkFUSU9OX1RPX0FDQ0VTU19GT1JfT1dORVIpOyAKICAgIF87CiAgfQogIAogIG1vZGlmaWVyIGlzUGxheWVyKGFkZHJlc3MgYWRkcikgewogICAgcmVxdWlyZShtX3BsYXllcnNTdG9yYWdlLnBsYXllckV4aXN0KGFkZHIpKTsKICAgIF87CiAgfQogIAogIG1vZGlmaWVyIGdhbWVJc0F2YWlsYWJsZSgpIHsKICAgIHJlcXVpcmUobm93ID49IG1fbGV2ZWxTdGFydHVwVGltZXN0YW1wLmFkZChERUxBWV9PTl9ORVdfTEVWRUwpKTsKICAgIF87CiAgfQoKLy8vLy8vLy8vLy8vLy8vCi8vIENPTlNUUlVDVE9SCi8vICAKICAvKioKICAqIEBkZXYgQ29uc3RydWN0b3IgUG9uemlUb2tlbi4KICAqLwogIGZ1bmN0aW9uIFRoZUdhbWUoYWRkcmVzcyBwb256aVRva2VuQWRkcikgcHVibGljIHsKICAgIHJlcXVpcmUocG9uemlUb2tlbkFkZHIgIT0gYWRkcmVzcygwKSk7CiAgICBtX3BvbnppVG9rZW4gPSBQb256aVRva2VuTWluSW50ZXJmYWNlKHBvbnppVG9rZW5BZGRyKTsKICAgIG1fb3duZXIgPSBtc2cuc2VuZGVyOwogICAgbV9jcmVhdGlvblRpbWVzdGFtcCA9IG5vdzsKICAgIG1fc3RhdGUgPSBTdGF0ZS5Ob3RBY3RpdmU7CiAgICBtX2xldmVsID0gMTsKICAgIG1faW50ZXJlc3RSYXRlTnVtZXJhdG9yID0gY2FsY0ludGVyZXN0UmF0ZU51bWVyYXRvcihtX2xldmVsKTsKICB9CgogIC8qKgogICogQGRldiBGYWxsYmFjayBmdW5jIGNhbiByZWNpdmUgZXRoIG9ubHkgZnJvbSBQb256aSB0b2tlbgogICovCiAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSBvbmx5UG9uemlUb2tlbigpIHsgIH0KICAKICAKICAvKioKICAqIENvbnRyYWN0IGNhbGMgb3V0cHV0IG9mIHNlbmRlciBhbmQgdHJhbnNmZXIgdG9rZW4vZXRoIGl0IHRvIGhpbS4gCiAgKiBJZiB0b2tlbi9ldGhub3QgZW5vdWdoIG9uIGJhbGFuY2UsIHRoZW4gdHJhbnNmZXIgYWxsIGFuZCBncCB0byBuZXh0IGxldmVsLgogICogCiAgKiBAZGV2IFNlbmRlciBleGl0IGZyb20gdGhlIGdhbWUuIFNlbmRlciBtdXN0IGJlIHBsYXllci4KICAqLwogIGZ1bmN0aW9uIGV4aXQoKSAKICAgIGV4dGVybmFsCiAgICBhdFN0YXRlKFN0YXRlLkFjdGl2ZSkgCiAgICBnYW1lSXNBdmFpbGFibGUoKQogICAgaXNQbGF5ZXIobXNnLnNlbmRlcikgCiAgewogICAgdWludDI1NiBpbnB1dDsKICAgIHVpbnQyNTYgdGltZXN0YW1wOwogICAgdGltZXN0YW1wID0gbV9wbGF5ZXJzU3RvcmFnZS5wbGF5ZXJUaW1lc3RhbXAobXNnLnNlbmRlcik7CiAgICBpbnB1dCA9IG1fcGxheWVyc1N0b3JhZ2UucGxheWVySW5wdXQobXNnLnNlbmRlcik7CiAgICAKICAgIC8vIENoZWNrIHdoZXRoZXIgdGhlIHBsYXllciBpcyBERUxBWV9PTl9FWElUIGhvdXJzIGluIHRoZSBnYW1lCiAgICByZXF1aXJlKG5vdyA+PSB0aW1lc3RhbXAuYWRkKERFTEFZX09OX0VYSVQpKTsKICAgIAogICAgLy8gY2FsYyBvdXRwdXQKICAgIHVpbnQyNTYgb3V0cHV0SW5Qb256aSA9IGNhbGNPdXRwdXQoaW5wdXQsIG5vdy5zdWIodGltZXN0YW1wKS5kaXYoQ09NUE9VTkRJTkdfRlJFUSkpOwogICAgCiAgICBhc3NlcnQob3V0cHV0SW5Qb256aSA+IDApOwogICAgCiAgICAvLyBjb252ZXJ0IHBvbnppIHRvIGV0aAogICAgdWludDI1NiBvdXRwdXRJbldlaSA9IHBvbnppVG9XZWkob3V0cHV0SW5Qb256aSwgbV9wb256aVByaWNlSW5XZWkpOwogICAgCiAgICAvLyBzZXQgemVybyBiZWZvcmUgc2VuZGluZyB0byBwcmV2ZW50IFJlLUVudHJhbmN5IAogICAgbV9wbGF5ZXJzU3RvcmFnZS5kZWxldGVQbGF5ZXIobXNnLnNlbmRlcik7CiAgICAKICAgIGlmIChtX3BvbnppUHJpY2VJbldlaSA+IDAgJiYgYWRkcmVzcyh0aGlzKS5iYWxhbmNlID49IG91dHB1dEluV2VpKSB7CiAgICAgIC8vIGlmIHdlIGhhdmUgZW5vdWdoIGV0aCBvbiBhZGRyZXNzKHRoaXMpLmJhbGFuY2UgCiAgICAgIC8vIHNlbmQgaXQgdG8gc2VuZGVyCiAgICAgIAogICAgICAvLyBXQVJOSU5HCiAgICAgIC8vIHVudHJ1c3RlZCBUcmFuc2ZlciAhISEKICAgICAgdWludDI1NiBvbGRCYWxhbmNlID0gYWRkcmVzcyh0aGlzKS5iYWxhbmNlOwogICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG91dHB1dEluV2VpKTsKICAgICAgYXNzZXJ0KGFkZHJlc3ModGhpcykuYmFsYW5jZS5hZGQob3V0cHV0SW5XZWkpID49IG9sZEJhbGFuY2UpOwogICAgICAKICAgIH0gZWxzZSBpZiAobV9wb256aVRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSA+PSBvdXRwdXRJblBvbnppKSB7CiAgICAgIC8vIGVsc2UgaWYgd2UgaGF2ZSBlbm91Z2ggcG9uemkgb24gYmFsYW5jZQogICAgICAvLyBzZW5kIGl0IHRvIHNlbmRlcgogICAgICAKICAgICAgdWludDI1NiBvbGRQb256aUJhbGFuY2UgPSBtX3BvbnppVG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICBhc3NlcnQobV9wb256aVRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIG91dHB1dEluUG9uemkpKTsKICAgICAgYXNzZXJ0KG1fcG9uemlUb2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSkuYWRkKG91dHB1dEluUG9uemkpID09IG9sZFBvbnppQmFsYW5jZSk7CiAgICB9IGVsc2UgewogICAgICAvLyBpZiB3ZSBkb250IGhhdmUgbm9yIGV0aCwgbm9yIHBvbnppIHRoZW4gdHJhbnNmZXIgYWxsIGF2YWxpYWJsZSBwb256aSB0byAKICAgICAgLy8gbXNnLnNlbmRlciBhbmQgZ28gdG8gbmV4dCBMZXZlbAogICAgICBhc3NlcnQobV9wb256aVRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIG1fcG9uemlUb2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSkpKTsKICAgICAgYXNzZXJ0KG1fcG9uemlUb2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSkgPT0gMCk7CiAgICAgIG5leHRMZXZlbCgpOwogICAgfQogIH0KICAKICAvKioKICAqIEBkZXYgR2V0IGluZm8gYWJvdXQgc3BlY2lmaWVkIHBsYXllci4KICAqIEBwYXJhbSBhZGRyIEFkcnJlc3Mgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEByZXR1cm4gaW5wdXQgSW5wdXQgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEByZXR1cm4gdGltZXN0YW1wIFRpbWVzdGFtcCBvZiBzcGVjaWZpZWQgcGxheWVyLgogICogQHJldHVybiBpbkdhbWUgV2hldGhlciBzcGVjaWZpZWQgcGxheWVyIGluIGdhbWUgb3Igbm90LgogICovCiAgZnVuY3Rpb24gcGxheWVySW5mbyhhZGRyZXNzIGFkZHIpIAogICAgcHVibGljIAogICAgdmlldyAKICAgIGF0U3RhdGUoU3RhdGUuQWN0aXZlKQogICAgZ2FtZUlzQXZhaWxhYmxlKCkKICAgIHJldHVybnModWludDI1NiBpbnB1dCwgdWludDI1NiB0aW1lc3RhbXAsIGJvb2wgaW5HYW1lKSAKICB7CiAgICAoaW5wdXQsIHRpbWVzdGFtcCwgaW5HYW1lKSA9IG1fcGxheWVyc1N0b3JhZ2UucGxheWVySW5mbyhhZGRyKTsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IEdldCBwb3NzaWJsZSBvdXRwdXQgZm9yIHNwZWNpZmllZCBwbGF5ZXIgYXQgbm93LgogICogQHBhcmFtIGFkZHIgQWRycmVzcyBvZiBzcGVjaWZpZWQgcGxheWVyLgogICogQHJldHVybiBpbnB1dCBQb3NzaWJsZSBvdXRwdXQgZm9yIHNwZWNpZmllZCBwbGF5ZXIgYXQgbm93LgogICovCiAgZnVuY3Rpb24gcGxheWVyT3V0cHV0QXROb3coYWRkcmVzcyBhZGRyKSAKICAgIHB1YmxpYyAKICAgIHZpZXcgCiAgICBhdFN0YXRlKFN0YXRlLkFjdGl2ZSkgCiAgICBnYW1lSXNBdmFpbGFibGUoKQogICAgcmV0dXJucyh1aW50MjU2IGFtb3VudCkKICB7CiAgICBpZiAoIW1fcGxheWVyc1N0b3JhZ2UucGxheWVyRXhpc3QoYWRkcikpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGlucHV0ID0gbV9wbGF5ZXJzU3RvcmFnZS5wbGF5ZXJJbnB1dChhZGRyKTsKICAgIHVpbnQyNTYgdGltZXN0YW1wID0gbV9wbGF5ZXJzU3RvcmFnZS5wbGF5ZXJUaW1lc3RhbXAoYWRkcik7CiAgICB1aW50MjU2IG51bWJlck9mUGF5b3V0ID0gbm93LnN1Yih0aW1lc3RhbXApLmRpdihDT01QT1VORElOR19GUkVRKTsKICAgIGFtb3VudCA9IGNhbGNPdXRwdXQoaW5wdXQsIG51bWJlck9mUGF5b3V0KTsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IEdldCBkZWxheSBvbiBvcHBvcnR1bml0eSB0byBleGl0IGZvciBzcGVjaWZpZWQgcGxheWVyIGF0IG5vdy4KICAqIEBwYXJhbSBhZGRyIEFkcnJlc3Mgb2Ygc3BlY2lmaWVkIHBsYXllci4KICAqIEByZXR1cm4gaW5wdXQgRGVsYXkgZm9yIHNwZWNpZmllZCBwbGF5ZXIgYXQgbm93LgogICovCiAgZnVuY3Rpb24gcGxheWVyRGVsYXlPbkV4aXQoYWRkcmVzcyBhZGRyKSAKICAgIHB1YmxpYyAKICAgIHZpZXcgCiAgICBhdFN0YXRlKFN0YXRlLkFjdGl2ZSkgCiAgICBnYW1lSXNBdmFpbGFibGUoKQogICAgcmV0dXJucyh1aW50MjU2IGRlbGF5KSAKICB7CiAgICBpZiAoIW1fcGxheWVyc1N0b3JhZ2UucGxheWVyRXhpc3QoYWRkcikpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IHRpbWVzdGFtcCA9IG1fcGxheWVyc1N0b3JhZ2UucGxheWVyVGltZXN0YW1wKG1zZy5zZW5kZXIpOwogICAgaWYgKG5vdyA+PSB0aW1lc3RhbXAuYWRkKERFTEFZX09OX0VYSVQpKSB7CiAgICAgIGRlbGF5ID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGRlbGF5ID0gdGltZXN0YW1wLmFkZChERUxBWV9PTl9FWElUKS5zdWIobm93KTsKICAgIH0KICB9CiAgCiAgLyoqCiAgKiBTZW5kZXIgdHJ5IGVudGVyIHRvIHRoZSBnYW1lLgogICogCiAgKiBAZGV2IFNlbmRlciBlbnRlciB0byB0aGUgZ2FtZS4gU2VuZGVyIG11c3Qgbm90IGJlIHBsYXllci4KICAqIEBwYXJhbSBpbnB1dCBJbnB1dCBvZiBuZXcgcGxheWVyLgogICogQHBhcmFtIHJlZmVycmFsQWRkcmVzcyBUaGUgcmVmZXJyYWwgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGVudGVyKHVpbnQyNTYgaW5wdXQsIGFkZHJlc3MgcmVmZXJyYWxBZGRyZXNzKSAKICAgIGV4dGVybmFsIAogICAgYXRTdGF0ZShTdGF0ZS5BY3RpdmUpCiAgICBnYW1lSXNBdmFpbGFibGUoKQogIHsKICAgIHJlcXVpcmUobV9wb256aVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBhZGRyZXNzKHRoaXMpLCBpbnB1dCkpOwogICAgcmVxdWlyZShuZXdQbGF5ZXIobXNnLnNlbmRlciwgaW5wdXQsIHJlZmVycmFsQWRkcmVzcykpOwogIH0KICAKICAvKioKICAqIEBkZXYgQWRkcmVzcyBvZiB0aGUgcHJpY2Ugc2V0dGVyLgogICogQHJldHVybiBBZGRyZXNzIG9mIHRoZSBwcmljZSBzZXR0ZXIuCiAgKi8KICBmdW5jdGlvbiBwcmljZVNldHRlcigpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzKSB7CiAgICByZXR1cm4gbV9wcmljZVNldHRlcjsKICB9CiAgCgogIC8qKgogICogQGRldiBQcmljZSBvZiBvbmUgUG9uemkgdG9rZW4gaW4gd2VpLgogICogQHJldHVybiBQcmljZSBvZiBvbmUgUG9uemkgdG9rZW4gaW4gd2VpLgogICovCiAgZnVuY3Rpb24gcG9uemlQcmljZUluV2VpKCkgCiAgICBleHRlcm5hbCAKICAgIHZpZXcgCiAgICBhdFN0YXRlKFN0YXRlLkFjdGl2ZSkgIAogICAgcmV0dXJucyh1aW50MjU2KSAKICB7CiAgICByZXR1cm4gbV9wb256aVByaWNlSW5XZWk7CiAgfQogIAogIC8qKgogICogQGRldiDQoW9tcG91bmRpbmcgZnJlcSBvZiB0aGUgZ2FtZS4gT2x3YXlzIDEgZGF5LgogICogQHJldHVybiBDb21wb3VuZGluZyBmcmVxIG9mIHRoZSBnYW1lLgogICovCiAgZnVuY3Rpb24gY29tcG91bmRpbmdGcmVxKCkgCiAgICBleHRlcm5hbCAKICAgIHZpZXcgCiAgICBhdFN0YXRlKFN0YXRlLkFjdGl2ZSkgCiAgICByZXR1cm5zKHVpbnQyNTYpIAogIHsKICAgIHJldHVybiBDT01QT1VORElOR19GUkVROwogIH0KICAKICAvKioKICAqIEBkZXYgSW50ZXJlc3QgcmF0ZSAgb2YgdGhlIGdhbWUgYXMgbnVtZXJhdG9yL2Rlbm9taW5hdG9yLkZyb20gNSUgdG8gMC4xJS4KICAqIEByZXR1cm4gbnVtZXJhdG9yIEludGVyZXN0IHJhdGUgbnVtZXJhdG9yIG9mIHRoZSBnYW1lLgogICogQHJldHVybiBkZW5vbWluYXRvciBJbnRlcmVzdCByYXRlIGRlbm9taW5hdG9yIG9mIHRoZSBnYW1lLgogICovCiAgZnVuY3Rpb24gaW50ZXJlc3RSYXRlKCkgCiAgICBleHRlcm5hbCAKICAgIHZpZXcKICAgIGF0U3RhdGUoU3RhdGUuQWN0aXZlKQogICAgcmV0dXJucyh1aW50MjU2IG51bWVyYXRvciwgdWludDI1NiBkZW5vbWluYXRvcikgCiAgewogICAgbnVtZXJhdG9yID0gbV9pbnRlcmVzdFJhdGVOdW1lcmF0b3I7CiAgICBkZW5vbWluYXRvciA9IElOVEVSRVNUX1JBVEVfREVOT01JTkFUT1I7CiAgfQogIAogIC8qKgogICogQGRldiBMZXZlbCBvZiB0aGUgZ2FtZS4KICAqIEByZXR1cm4gTGV2ZWwgb2YgdGhlIGdhbWUuCiAgKi8KICBmdW5jdGlvbiBsZXZlbCgpIAogICAgZXh0ZXJuYWwgCiAgICB2aWV3IAogICAgYXRTdGF0ZShTdGF0ZS5BY3RpdmUpCiAgICByZXR1cm5zKHVpbnQyNTYpIAogIHsKICAgIHJldHVybiBtX2xldmVsOwogIH0KICAKICAvKioKICAqIEBkZXYgR2V0IGNvbnRyYWN0IHdvcmsgc3RhdGUuCiAgKiBAcmV0dXJuIENvbnRyYWN0IHdvcmsgc3RhdGUgdmlhIHN0cmluZy4KICAqLwogIGZ1bmN0aW9uIHN0YXRlKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHN0cmluZykgewogICAgaWYgKG1fc3RhdGUgPT0gU3RhdGUuTm90QWN0aXZlKSAKICAgICAgcmV0dXJuIE5PVF9BQ1RJVkVfU1RSOwogICAgZWxzZQogICAgICByZXR1cm4gQUNUSVZFX1NUUjsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IEdldCB0aW1lc3RhbXAgb2YgdGhlIGxldmVsIHN0YXJ0dXAuCiAgKiBAcmV0dXJuIFRpbWVzdGFtcCBvZiB0aGUgbGV2ZWwgc3RhcnR1cC4KICAqLwogIGZ1bmN0aW9uIGxldmVsU3RhcnR1cFRpbWVzdGFtcCgpIAogICAgZXh0ZXJuYWwgCiAgICB2aWV3IAogICAgYXRTdGF0ZShTdGF0ZS5BY3RpdmUpCiAgICByZXR1cm5zKHVpbnQyNTYpIAogIHsKICAgIHJldHVybiBtX2xldmVsU3RhcnR1cFRpbWVzdGFtcDsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IEdldCBhbW91bnQgb2YgUG9uemkgdG9rZW5zIGluIHRoZSBnYW1lLlBvbnppIHRva2VucyBiYWxhbmNlT2YgdGhlIGdhbWUuCiAgKiBAcmV0dXJuIENvbnRyYWN0IHdvcmsgc3RhdGUgdmlhIHN0cmluZy4KICAqLwogIGZ1bmN0aW9uIHRvdGFsUG9uemlJbkdhbWUoKSAKICAgIGV4dGVybmFsIAogICAgdmlldyAKICAgIHJldHVybnModWludDI1NikgCiAgewogICAgcmV0dXJuIG1fcG9uemlUb2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgfQogIAogIC8qKgogICogQGRldiBHZXQgY3VycmVudCBkZWxheSBvbiBuZXcgbGV2ZWwuCiAgKiBAcmV0dXJuIEN1cnJlbnQgZGVsYXkgb24gbmV3IGxldmVsLgogICovCiAgZnVuY3Rpb24gY3VycmVudERlbGF5T25OZXdMZXZlbCgpIAogICAgZXh0ZXJuYWwgCiAgICB2aWV3IAogICAgYXRTdGF0ZShTdGF0ZS5BY3RpdmUpCiAgICByZXR1cm5zKHVpbnQyNTYgZGVsYXkpIAogIHsKICAgIGlmIChub3cgPj0gbV9sZXZlbFN0YXJ0dXBUaW1lc3RhbXAuYWRkKERFTEFZX09OX05FV19MRVZFTCkpIHsKICAgICAgZGVsYXkgPSAwOwogICAgfSBlbHNlIHsKICAgICAgZGVsYXkgPSBtX2xldmVsU3RhcnR1cFRpbWVzdGFtcC5hZGQoREVMQVlfT05fTkVXX0xFVkVMKS5zdWIobm93KTsKICAgIH0gIAogIH0KCi8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gRVJDNjc3IEVSQzY3N1JlY2lwaWVudCBNZXRob2RzCi8vCiAgLyoqCiAgKiBzZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy82NzcKICAqCiAgKiBAZGV2IEVSQzY3NyB0b2tlbiBmYWxsYmFjay4gQ2FsbGVkIHdoZW4gcmVjZWl2ZWQgUG9uemkgdG9rZW4KICAqIGFuZCBzZW5kZXIgdHJ5IGVudGVyIHRvIHRoZSBnYW1lLgogICoKICAqIEBwYXJhbSBmcm9tIFJlY2VpdmVkIHRva2VucyBmcm9tIHRoZSBhZGRyZXNzLgogICogQHBhcmFtIGFtb3VudCBBbW91bnQgb2YgcmVjaXZlZCB0b2tlbnMuCiAgKiBAcGFyYW0gZGF0YSBSZWNlaXZlZCBleHRyYSBkYXRhLgogICogQHJldHVybiBXaGV0aGVyIHN1Y2Nlc3NmdWwgZW50cmFuY2Ugb3Igbm90LgogICovCiAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIGZyb20sIHVpbnQyNTYgYW1vdW50LCBieXRlcyBkYXRhKSAKICAgIHB1YmxpYwogICAgYXRTdGF0ZShTdGF0ZS5BY3RpdmUpCiAgICBnYW1lSXNBdmFpbGFibGUoKQogICAgb25seVBvbnppVG9rZW4oKQogICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICBhZGRyZXNzIHJlZmVycmFsQWRkcmVzcyA9IGJ5dGVzVG9BZGRyZXNzKGRhdGEpOwogICAgcmVxdWlyZShuZXdQbGF5ZXIoZnJvbSwgYW1vdW50LCByZWZlcnJhbEFkZHJlc3MpKTsKICAgIHJldHVybiB0cnVlOwogIH0KICAKICAvKioKICAqIEBkZXYgU2V0IHByaWNlIG9mIG9uZSBQb256aSB0b2tlbiBpbiB3ZWkuCiAgKiBAcGFyYW0gbmV3UHJpY2UgUHJpY2Ugb2Ygb25lIFBvbnppIHRva2VuIGluIHdlaS4KICAqLyAKICBmdW5jdGlvbiBzZXRQb256aVByaWNlaW5XZWkodWludDI1NiBuZXdQcmljZSkgCiAgICBwdWJsaWMKICAgIGF0U3RhdGUoU3RhdGUuQWN0aXZlKSAgIAogIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtX293bmVyIHx8IG1zZy5zZW5kZXIgPT0gbV9wcmljZVNldHRlcik7CiAgICBtX3BvbnppUHJpY2VJbldlaSA9IG5ld1ByaWNlOwogICAgUG9uemlQcmljZUNoYW5nZWQobXNnLnNlbmRlciwgbV9wb256aVByaWNlSW5XZWkpOwogIH0KICAKICAvKioKICAqIEBkZXYgT3duZXIgZG8gZGlzb3duLgogICovIAogIGZ1bmN0aW9uIGRpc293bigpIHB1YmxpYyBvbmx5T3duZXIoKSBhdFN0YXRlKFN0YXRlLkFjdGl2ZSkgewogICAgZGVsZXRlIG1fb3duZXI7CiAgfQogIAogIC8qKgogICogQGRldiBTZXQgc3RhdGUgb2YgY29udHJhY3Qgd29ya2luZy4KICAqIEBwYXJhbSBuZXdTdGF0ZSBTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgbmV3IHN0YXRlLgogICovIAogIGZ1bmN0aW9uIHNldFN0YXRlKHN0cmluZyBuZXdTdGF0ZSkgcHVibGljIG9ubHlPd25lcigpIGNoZWNrQWNjZXNzKCkgewogICAgaWYgKGtlY2NhazI1NihuZXdTdGF0ZSkgPT0ga2VjY2FrMjU2KE5PVF9BQ1RJVkVfU1RSKSkgewogICAgICBtX3N0YXRlID0gU3RhdGUuTm90QWN0aXZlOwogICAgfSBlbHNlIGlmIChrZWNjYWsyNTYobmV3U3RhdGUpID09IGtlY2NhazI1NihBQ1RJVkVfU1RSKSkgewogICAgICBpZiAoYWRkcmVzcyhtX3BsYXllcnNTdG9yYWdlKSA9PSBhZGRyZXNzKDApKSAKICAgICAgICBtX3BsYXllcnNTdG9yYWdlID0gKG5ldyBQbGF5ZXJzU3RvcmFnZSgpKTsKICAgICAgbV9zdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGlmIG5ld1N0YXRlIG5vdCB2YWxpZCBzdHJpbmcKICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICBTdGF0ZUNoYW5nZWQobXNnLnNlbmRlciwgbV9zdGF0ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgU2V0IHRoZSBQcmljZVNldHRlciBhZGRyZXNzLCB3aGljaCBoYXMgYWNjZXNzIHRvIHNldCBvbmUgUG9uemkgCiAgKiB0b2tlbiBwcmljZSBpbiB3ZWkuCiAgKiBAcGFyYW0gbmV3UHJpY2VTZXR0ZXIgVGhlIGFkZHJlc3Mgb2YgbmV3IFByaWNlU2V0dGVyLgogICovCiAgZnVuY3Rpb24gc2V0UHJpY2VTZXR0ZXIoYWRkcmVzcyBuZXdQcmljZVNldHRlcikgCiAgICBwdWJsaWMgCiAgICBvbmx5T3duZXIoKSAKICAgIGNoZWNrQWNjZXNzKCkKICAgIGF0U3RhdGUoU3RhdGUuQWN0aXZlKSAKICB7CiAgICBtX3ByaWNlU2V0dGVyID0gbmV3UHJpY2VTZXR0ZXI7CiAgfQogIAogIC8qKgogICogQGRldiBUcnkgY3JlYXRlIG5ldyBwbGF5ZXIuIAogICogQHBhcmFtIGFkZHIgQWRycmVzcyBvZiBwcmV0ZW5kZXIgcGxheWVyLgogICogQHBhcmFtIGlucHV0QW1vdW50IElucHV0IHRva2VucyBhbW91bnQgb2YgcHJldGVuZGVyIHBsYXllci4KICAqIEBwYXJhbSByZWZlcnJhbEFkZHIgUmVmZXJyYWwgYWRkcmVzcyBvZiBwcmV0ZW5kZXIgcGxheWVyLgogICogQHJldHVybiBXaGV0aGVyIHNwZWNpZmllZCBwbGF5ZXIgaW4gZ2FtZSBvciBub3QuCiAgKi8KICBmdW5jdGlvbiBuZXdQbGF5ZXIoYWRkcmVzcyBhZGRyLCB1aW50MjU2IGlucHV0QW1vdW50LCBhZGRyZXNzIHJlZmVycmFsQWRkcikKICAgIHByaXZhdGUKICAgIHJldHVybnMoYm9vbCkKICB7CiAgICB1aW50MjU2IGlucHV0ID0gaW5wdXRBbW91bnQ7CiAgICAvLyByZXR1cm4gZmFsc2UgaWYgcGxheWVyIGFscmVhZHkgaW4gZ2FtZSBvciBpZiBpbnB1dCA8IDEwMDAsCiAgICAvLyBiZWNhdXNlIGNhbGNPdXRwdXQoKSB1c2UgSU5URVJFU1RfUkFURV9ERU5PTUlOQVRPUiA9IDEwMDAuCiAgICAvLyBhbmQgaW5wdXQgbXVzdCBkaXYgYnkgSU5URVJFU1RfUkFURV9ERU5PTUlOQVRPUiwgaWYgCiAgICAvLyBpbnB1dCA8MTAwMCB0aGVuIGRpdmlkaW5nIGFsd2F5cyBlcXVhbCAwLgogICAgaWYgKG1fcGxheWVyc1N0b3JhZ2UucGxheWVyRXhpc3QoYWRkcikgfHwgaW5wdXQgPCAxMDAwKSAKICAgICAgcmV0dXJuIGZhbHNlOwogICAgCiAgICAvLyBjaGVjayBpZiByZWZlcnJhbEFkZHIgaXMgcGxheWVyCiAgICBpZiAobV9wbGF5ZXJzU3RvcmFnZS5wbGF5ZXJFeGlzdChyZWZlcnJhbEFkZHIpKSB7CiAgICAgIC8vIHRyYW5zZmVyIDElIGlucHV0IGZvcm0gYWRkciB0byByZWZlcnJhbEFkZHIgOgogICAgICAvLyBuZXdQbGF5ZXJJbnB1dCA9IGlucHV0ICogKDEwMC1QRVJDRU5UX1JFRkVSUkFMX0JPVU5UWSkgJTsKICAgICAgLy8gcmVmZXJyYWxJbnB1dCAgPSAoY3VycmVudCByZWZlcnJhbCBpbnB1dCkgKyBpbnB1dCAqIFBFUkNFTlRfUkVGRVJSQUxfQk9VTlRZICUKICAgICAgdWludDI1NiBuZXdQbGF5ZXJJbnB1dCA9IGlucHV0QW1vdW50Lm11bCh1aW50MjU2KDEwMCkuc3ViKFBFUkNFTlRfUkVGRVJSQUxfQk9VTlRZKSkuZGl2KDEwMCk7CiAgICAgIHVpbnQyNTYgcmVmZXJyYWxJbnB1dCA9IG1fcGxheWVyc1N0b3JhZ2UucGxheWVySW5wdXQocmVmZXJyYWxBZGRyKTsKICAgICAgcmVmZXJyYWxJbnB1dCA9IHJlZmVycmFsSW5wdXQuYWRkKGlucHV0QW1vdW50LnN1YihuZXdQbGF5ZXJJbnB1dCkpOwogICAgICAKICAgICAgLy8gdHJ5IHNldCBpbnB1dCBvZiByZWZlcnJhbEFkZHIgcGxheWVyCiAgICAgIGFzc2VydChtX3BsYXllcnNTdG9yYWdlLnBsYXllclNldElucHV0KHJlZmVycmFsQWRkciwgcmVmZXJyYWxJbnB1dCkpOwogICAgICAvLyBpZiBzdWNjZXNzLCBzZXQgaW5wdXQgb2YgbmV3IHBsYXllciA9IG5ld1BsYXllcklucHV0CiAgICAgIGlucHV0ID0gbmV3UGxheWVySW5wdXQ7CiAgICB9CiAgICAvLyB0cnkgY3JlYXRlIG5ldyBwbGF5ZXIKICAgIGFzc2VydChtX3BsYXllcnNTdG9yYWdlLm5ld1BsYXllcihhZGRyLCBpbnB1dCwgbm93KSk7CiAgICBOZXdQbGF5ZXIoYWRkciwgaW5wdXQsIG5vdyk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IENhbGMgcG9zc2libHkgb3V0cHV0IChjb21wb3VuZGluZyBpbnRlcmVzdCkgZm9yIHNwZWNpZmllZCBpbnB1dCBhbmQgbnVtYmVyIG9mIHBheW91dC4KICAqIEBwYXJhbSBpbnB1dCBJbnB1dCBhbW91bnQuCiAgKiBAcGFyYW0gbnVtYmVyT2ZQYXlvdXQgTnVtYmVyIG9mIHBheW91dC4KICAqIEByZXR1cm4gUG9zc2libHkgb3V0cHV0LgogICovCiAgZnVuY3Rpb24gY2FsY091dHB1dCh1aW50MjU2IGlucHV0LCB1aW50MjU2IG51bWJlck9mUGF5b3V0KSAKICAgIHByaXZhdGUKICAgIHZpZXcKICAgIHJldHVybnModWludDI1NiBvdXRwdXQpCiAgewogICAgb3V0cHV0ID0gaW5wdXQ7CiAgICB1aW50MjU2IGNvdW50ZXIgPSBudW1iZXJPZlBheW91dDsKICAgIC8vIGNhbGMgY29tcG91bmQgaW50ZXJlc3QgCiAgICB3aGlsZSAoY291bnRlciA+IDApIHsKICAgICAgb3V0cHV0ID0gb3V0cHV0LmFkZChvdXRwdXQubXVsKG1faW50ZXJlc3RSYXRlTnVtZXJhdG9yKS5kaXYoSU5URVJFU1RfUkFURV9ERU5PTUlOQVRPUikpOwogICAgICBjb3VudGVyID0gY291bnRlci5zdWIoMSk7CiAgICB9CiAgICAvLyBzYXZlIHRheCAlIG9uIGV4aXQ7IG91dHB1dCA9IG91dHB1dCAqICgxMDAtdGF4KSAvIDEwMDsKICAgIG91dHB1dCA9IG91dHB1dC5tdWwodWludDI1NigxMDApLnN1YihQRVJDRU5UX1RBWF9PTl9FWElUKSkuZGl2KDEwMCk7IAogIH0KICAKICAvKioKICAqIEBkZXYgVGhlIGdhbWUgZ28gbm8gbmV4dCBsZXZlbC4gCiAgKi8KICBmdW5jdGlvbiBuZXh0TGV2ZWwoKSBwcml2YXRlIHsKICAgIG1fcGxheWVyc1N0b3JhZ2Uua2lsbCgpOwogICAgbV9wbGF5ZXJzU3RvcmFnZSA9IChuZXcgUGxheWVyc1N0b3JhZ2UoKSk7CiAgICBtX2xldmVsID0gbV9sZXZlbC5hZGQoMSk7CiAgICBtX2ludGVyZXN0UmF0ZU51bWVyYXRvciA9IGNhbGNJbnRlcmVzdFJhdGVOdW1lcmF0b3IobV9sZXZlbCk7CiAgICBtX2xldmVsU3RhcnR1cFRpbWVzdGFtcCA9IG5vdzsKICAgIE5ld0xldmVsKG5vdywgbV9sZXZlbCk7CiAgfQogIAogIC8qKgogICogQGRldiBDYWxjIG51bWVyYXRvciBvZiBpbnRlcmVzdCByYXRlIGZvciBzcGVjaWZpZWQgbGV2ZWwuIAogICogQHBhcmFtIG5ld0xldmVsIFNwZWNpZmllZCBsZXZlbC4KICAqIEByZXR1cm4gUmVzdWx0IG51bWVyYXRvci4KICAqLwogIGZ1bmN0aW9uIGNhbGNJbnRlcmVzdFJhdGVOdW1lcmF0b3IodWludDI1NiBuZXdMZXZlbCkgCiAgICBpbnRlcm5hbCAKICAgIHB1cmUgCiAgICByZXR1cm5zKHVpbnQyNTYgbnVtZXJhdG9yKSAKICB7CiAgICAvLyBjb25zdGFudCBJTlRFUkVTVF9SQVRFX0RFTk9NSU5BVE9SID0gMTAwMAogICAgLy8gbnVtZXJhdG9yIHdlIGNhbGMKICAgIC8vIAogICAgLy8gbGV2ZWwgMSA6IDUlIGludGVyZXN0IHJhdGUgPSA1MCAvIDEwMDAgICAgfAogICAgLy8gbGV2ZWwgMiA6IDQlIGludGVyZXN0IHJhdGUgPSA0MCAvIDEwMDAgICAgfCAgZmlyc3Qgc3RhZ2UKICAgIC8vICAgICAgICAuLi4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKICAgIC8vIGxldmVsIDUgOiAxJSBpbnRlcmVzdCByYXRlID0gMTAgLyAxMDAwICAgIHwKICAgIAogICAgLy8gbGV2ZWwgNiA6IDAuOSUgaW50ZXJlc3QgcmF0ZSA9IDkgLyAxMDAwICAgfCAgc2Vjb25kIHN0YWdlCiAgICAvLyBsZXZlbCA3IDogMC44JSBpbnRlcmVzdCByYXRlID0gOCAvIDEwMDAgICB8CiAgICAvLyAgICAgICAgLi4uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICAvLyBsZXZlbCAxNCA6IDAuMSUgaW50ZXJlc3QgcmF0ZSA9IDEgLyAxMDAwICB8ICAKICAgIAogICAgLy8gbGV2ZWwgPjE0IDogMC4xJSBpbnRlcmVzdCByYXRlID0gMSAvIDEwMDAgfCAgdGhpcmQgc3RhZ2UKCiAgICBpZiAobmV3TGV2ZWwgPD0gNSkgewogICAgICAvLyBmaXJzdCBzdGFnZSBmcm9tIDUlIHRvIDElLiBudW1lcmF0b3IgZnJvbSA1MCB0byAxMAogICAgICBudW1lcmF0b3IgPSB1aW50MjU2KDYpLnN1YihuZXdMZXZlbCkubXVsKDEwKTsKICAgIH0gZWxzZSBpZiAoIG5ld0xldmVsID49IDYgJiYgbmV3TGV2ZWwgPD0gMTQpIHsKICAgICAgLy8gc2Vjb25kIHN0YWdlIGZyb20gMC45JSB0byAwLjElLiBudW1lcmF0b3IgZnJvbSA5IHRvIDEKICAgICAgbnVtZXJhdG9yID0gdWludDI1NigxNSkuc3ViKG5ld0xldmVsKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIHRoaXJkIHN0YWdlIDAuMSUuIG51bWVyYXRvciAxCiAgICAgIG51bWVyYXRvciA9IDE7CiAgICB9CiAgfQogIAogIC8qKgogICogQGRldiBDb252ZXJ0IFBvbnppIHRva2VuIHRvIHdlaS4KICAqIEBwYXJhbSB0b2tlbnNBbW91bnQgQW1vdXQgb2YgdG9rZW5zLgogICogQHBhcmFtIHRva2VuUHJpY2UgT25lIHRva2VuIHByaWNlIGluIHdlaS4KICAqIEByZXR1cm4gd2VpQW1vdW50IFJlc3VsdCBvZiBjb252ZXJ0YXRpb24uIAogICovCiAgZnVuY3Rpb24gcG9uemlUb1dlaSh1aW50MjU2IHRva2Vuc0Ftb3VudCwgdWludDI1NiB0b2tlblByaWNlKSAKICAgIGludGVybmFsCiAgICBwdXJlCiAgICByZXR1cm5zKHVpbnQyNTYgd2VpQW1vdW50KQogIHsKICAgIHdlaUFtb3VudCA9IHRva2Vuc0Ftb3VudC5tdWwodG9rZW5QcmljZSk7IAogIH0gCgogIC8qKgogICogQGRldiBDb252ZXIgYnl0ZXMgZGF0YSB0byBhZGRyZXNzLiAKICAqIEBwYXJhbSBzb3VyY2UgQnl0ZXMgZGF0YS4KICAqIEByZXR1cm4gUmVzdWx0IGFkZHJlc3Mgb2YgY29udmVydGF0aW9uLgogICovCiAgZnVuY3Rpb24gYnl0ZXNUb0FkZHJlc3MoYnl0ZXMgc291cmNlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMoYWRkcmVzcyBwYXJzZWRSZWZlcmVyKSB7CiAgICBhc3NlbWJseSB7CiAgICAgIHBhcnNlZFJlZmVyZXIgOj0gbWxvYWQoYWRkKHNvdXJjZSwweDE0KSkKICAgIH0KICAgIHJldHVybiBwYXJzZWRSZWZlcmVyOwogIH0KfQ=='.
	

]
