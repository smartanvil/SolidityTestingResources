Class {
	#name : #SRTd27bf944e944a91836ab6ac8f736339c4eb3baf6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd27bf944e944a91836ab6ac8f736339c4eb3baf6 >> base64 [
	^ 'LyoqCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuCiAqLwpjb250cmFjdCBQcmljaW5nU3RyYXRlZ3kgewoKICAvKiogSW50ZXJmYWNlIGRlY2xhcmF0aW9uLiAqLwogIGZ1bmN0aW9uIGlzUHJpY2luZ1N0cmF0ZWd5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuCiAgICoKICAgKiBDaGVja3MgdGhhdCBwcmljaW5nIHN0cmF0ZWd5IG1hdGNoZXMgY3Jvd2RzYWxlIHBhcmFtZXRlcnMuCiAgICovCiAgZnVuY3Rpb24gaXNTYW5lKGFkZHJlc3MgY3Jvd2RzYWxlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0LgogICAqCiAgICoKICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkKICAgKiBAcGFyYW0gdG9rZW5zU29sZCAtIGhvdyBtdWNoIHRva2VucyBoYXZlIGJlZW4gc29sZCB0aGlzIGZhcgogICAqIEBwYXJhbSB3ZWlSYWlzZWQgLSBob3cgbXVjaCBtb25leSBoYXMgYmVlbiByYWlzZWQgdGhpcyBmYXIKICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIGRlY2ltYWxzIC0gaG93IG1hbnkgZGVjaW1hbCB1bml0cyB0aGUgdG9rZW4gaGFzCiAgICogQHJldHVybiBBbW91bnQgb2YgdG9rZW5zIHRoZSBpbnZlc3RvciByZWNlaXZlcwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKHVpbnQgdmFsdWUsIHVpbnQgdG9rZW5zU29sZCwgdWludCB3ZWlSYWlzZWQsIGFkZHJlc3MgbXNnU2VuZGVyLCB1aW50IGRlY2ltYWxzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCB0b2tlbkFtb3VudCk7Cn0KCgoKLyoqCiAqIFNhZmUgdW5zaWduZWQgc2FmZSBtYXRoLgogKgogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQogKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbAogKgogKiBNYWludGFpbmVkIGhlcmUgdW50aWwgbWVyZ2VkIHRvIG1haW5saW5lIHplcHBlbGluLXNvbGlkaXR5LgogKgogKi8KbGlicmFyeSBTYWZlTWF0aExpYiB7CgogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgcHJpdmF0ZSB7CiAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7CiAgfQp9CgoKCgovKgogKiBPd25hYmxlCiAqCiAqIEJhc2UgY29udHJhY3Qgd2l0aCBhbiBvd25lci4KICogUHJvdmlkZXMgb25seU93bmVyIG1vZGlmaWVyLCB3aGljaCBwcmV2ZW50cyBmdW5jdGlvbiBmcm9tIHJ1bm5pbmcgaWYgaXQgaXMgY2FsbGVkIGJ5IGFueW9uZSBvdGhlciB0aGFuIHRoZSBvd25lci4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKCi8qCiAqIEhhbHRhYmxlCiAqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqCiAqIE9yaWdpbmFsbHkgZW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4KICovCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgewogIGJvb2wgcHVibGljIGhhbHRlZDsKCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIGlmIChoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBoYWx0ZWQgPSBmYWxzZTsKICB9Cgp9CgoKCi8qKgogKiBGaW5hbGl6ZSBhZ2VudCBkZWZpbmVzIHdoYXQgaGFwcGVucyBhdCB0aGUgZW5kIG9mIHN1Y2Nlc2VmdWwgY3Jvd2RzYWxlLgogKgogKiAtIEFsbG9jYXRlIHRva2VucyBmb3IgZm91bmRlcnMsIGJvdW50aWVzIGFuZCBjb21tdW5pdHkKICogLSBNYWtlIHRva2VucyB0cmFuc2ZlcmFibGUKICogLSBldGMuCiAqLwpjb250cmFjdCBGaW5hbGl6ZUFnZW50IHsKCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKiogUmV0dXJuIHRydWUgaWYgd2UgY2FuIHJ1biBmaW5hbGl6ZUNyb3dkc2FsZSgpIHByb3Blcmx5LgogICAqCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luCiAgICogdW5sZXNzIHRoZSBmaW5hbGl6ZXIgaGFzIGJlZW4gc2V0IHVwIHByb3Blcmx5LgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqIENhbGxlZCBvbmNlIGJ5IGNyb3dkc2FsZSBmaW5hbGl6ZSgpIGlmIHRoZSBzYWxlIHdhcyBzdWNjZXNzLiAqLwogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCk7Cgp9CgoKCgovKgogKiBFUkMyMCBpbnRlcmZhY2UKICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgewogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKfQoKCi8qKgogKiBBIHRva2VuIHRoYXQgZGVmaW5lcyBmcmFjdGlvbmFsIHVuaXRzIGFzIGRlY2ltYWxzLgogKi8KY29udHJhY3QgRnJhY3Rpb25hbEVSQzIwIGlzIEVSQzIwIHsKCiAgdWludCBwdWJsaWMgZGVjaW1hbHM7Cgp9CgoKCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4KICoKICogSGFuZGxlCiAqIC0gc3RhcnQgYW5kIGVuZCBkYXRlcwogKiAtIGFjY2VwdGluZyBpbnZlc3RtZW50cwogKiAtIG1pbmltdW0gZnVuZGluZyBnb2FsIGFuZCByZWZ1bmQKICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQKICogLSBkaWZmZXJlbnQgcHJpY2luZyBzdHJhdGVnaWVzCiAqIC0gZGlmZmVyZW50IGludmVzdG1lbnQgcG9saWNpZXMgKHJlcXVpcmUgc2VydmVyIHNpZGUgY3VzdG9tZXIgaWQsIGFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzKQogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIEZyYWN0aW9uYWxFUkMyMCBwdWJsaWMgdG9rZW47CgogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovCiAgUHJpY2luZ1N0cmF0ZWd5IHB1YmxpYyBwcmljaW5nU3RyYXRlZ3k7CgogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLwogIEZpbmFsaXplQWdlbnQgcHVibGljIGZpbmFsaXplQWdlbnQ7CgogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLwogIHVpbnQgcHVibGljIG1pbmltdW1GdW5kaW5nR29hbDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwoKICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovCiAgdWludCBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50ID0gMDsKCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLwogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7CgogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovCiAgdWludCBwdWJsaWMgd2VpUmVmdW5kZWQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQ7CgogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8KICBib29sIHB1YmxpYyByZXF1aXJlQ3VzdG9tZXJJZDsKCiAgLyoqCiAgICAqIERvIHdlIHZlcmlmeSB0aGF0IGNvbnRyaWJ1dG9yIGhhcyBiZWVuIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIChhY2NyZWRpdGVkIGludmVzdG9ycyBvbmx5KS4KICAgICogVGhpcyBtZXRob2Qgd2FzIGZpcnN0IHVzZWQgaW4gRmlyc3RCbG9vZCBjcm93ZHNhbGUgdG8gZW5zdXJlIGFsbCBjb250cmlidXRvcnMgaGF2ZSBhY2NlcHRlZCB0ZXJtcyBvbiBzYWxlIChvbiB0aGUgd2ViKS4KICAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzOwoKICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogVGhpcyBpcyBmb3IgbWFudWwgdGVzdGluZyBmb3IgdGhlIGludGVyYWN0aW9uIGZyb20gb3duZXIgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBibG9ja2NoYWluIGV4cGxvcmVyIHRvIHNlZSB0aGF0IGNyb3dkc2FsZSBpbnRlcmFjdGlvbiB3b3Jrcy4gKi8KICB1aW50IHB1YmxpYyBvd25lclRlc3RWYWx1ZTsKCiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKgogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQKICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZAogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IGZvciByZWNsYWltLgogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30KCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50MTI4IGN1c3RvbWVySWQpOwoKICAvLyBSZWZ1bmQgd2FzIHByb2Nlc3NlZCBmb3IgYSBjb250cmlidXRvcgogIGV2ZW50IFJlZnVuZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCk7CgogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdAogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgcmVxdWlyZUN1c3RvbWVySWQsIGJvb2wgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBhZGRyZXNzIHNpZ25lckFkZHJlc3MpOwoKICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7CgogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IGVuZHNBdCk7CgogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIHsKCiAgICBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjAoX3Rva2VuKTsKCiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7CgogICAgbXVsdGlzaWdXYWxsZXQgPSBfbXVsdGlzaWdXYWxsZXQ7CiAgICBpZihtdWx0aXNpZ1dhbGxldCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoX3N0YXJ0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBzdGFydHNBdCA9IF9zdGFydDsKCiAgICBpZihfZW5kID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBlbmRzQXQgPSBfZW5kOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBjYW4gYmUgemVybwogICAgbWluaW11bUZ1bmRpbmdHb2FsID0gX21pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHRocm93OwogIH0KCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IHByaXZhdGUgewoKICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudAogICAgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICAgIC8vIEFyZSB3ZSB3aGl0ZWxpc3RlZCBmb3IgZWFybHkgZGVwb3NpdAogICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0pIHsKICAgICAgICB0aHJvdzsKICAgICAgfQogICAgfSBlbHNlIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuRnVuZGluZykgewogICAgICAvLyBSZXRhaWwgcGFydGljaXBhbnRzIGNhbiBvbmx5IGNvbWUgaW4gd2hlbiB0aGUgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcKICAgICAgLy8gcGFzcwogICAgfSBlbHNlIHsKICAgICAgLy8gVW53YW50ZWQgc3RhdGUKICAgICAgdGhyb3c7CiAgICB9CgogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsKCiAgICBpZih0b2tlbkFtb3VudCA9PSAwKSB7CiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24KICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KCiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcAogICAgaWYoaXNCcmVha2luZ0NhcCh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwoKICAgIC8vIFBvY2tldCB0aGUgbW9uZXkKICAgIGlmKCFtdWx0aXNpZ1dhbGxldC5zZW5kKHdlaUFtb3VudCkpIHRocm93OwoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYoYWRkcik7CiAgICAgaWYgKGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKSAhPSBzaWduZXJBZGRyZXNzKSB0aHJvdzsKICAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogVHJhY2sgd2hvIGlzIHRoZSBjdXN0b21lciBtYWtpbmcgdGhlIHBheW1lbnQgc28gd2UgY2FuIHNlbmQgdGhhbmsgeW91IGVtYWlsLgogICAqLwogIGZ1bmN0aW9uIGludmVzdFdpdGhDdXN0b21lcklkKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cwogICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sKICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgYW5vbnltb3VzIGNvbnRyaWJ1dGlvbnMgdG8gdGhpcyBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0KGFkZHJlc3MgYWRkcikgcHVibGljIHBheWFibGUgewogICAgaWYocmVxdWlyZUN1c3RvbWVySWQpIHRocm93OyAvLyBDcm93ZHNhbGUgbmVlZHMgdG8gdHJhY2sgcGFydGlwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cwogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgMCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyIGFuZCBjbGVhciBoaXMgYWRkcmVzcy4KICAgKgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhTaWduZWRBZGRyZXNzKHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQsIHYsIHIsIHMpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0IHRvIHRva2VucywgcmVjb2duaXplIHRoZSBwYXllci4KICAgKgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0V2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdChtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGUgb3duZXIgY2FuIHRyaWdncmUgYSBjYWxsIHRoZSBjb250cmFjdCB0aGF0IHByb3ZpZGVzIHBvc3QtY3Jvd2RzYWxlIGFjdGlvbnMsIGxpa2UgcmVsZWFzaW5nIHRoZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZAogICAgaWYoZmluYWxpemVkKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50LgogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7CiAgICAgIGZpbmFsaXplQWdlbnQuZmluYWxpemVDcm93ZHNhbGUoKTsKICAgIH0KCiAgICBmaW5hbGl6ZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdG8gKHJlKXNldCBmaW5hbGl6ZSBhZ2VudC4KICAgKgogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiBzZXR0aW5nIHRoaXMsIHNvIHRoYXQgd2UgY2FuIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLgogICAqLwogIGZ1bmN0aW9uIHNldEZpbmFsaXplQWdlbnQoRmluYWxpemVBZ2VudCBhZGRyKSBvbmx5T3duZXIgewogICAgZmluYWxpemVBZ2VudCA9IGFkZHI7CgogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQKICAgIGlmKCFmaW5hbGl6ZUFnZW50LmlzRmluYWxpemVBZ2VudCgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KCiAgLyoqCiAgICogU2V0IHBvbGljeSBkbyB3ZSBuZWVkIHRvIGhhdmUgc2VydmVyLXNpZGUgY3VzdG9tZXIgaWRzIGZvciB0aGUgaW52ZXN0bWVudHMuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlQ3VzdG9tZXJJZChib29sIHZhbHVlKSBvbmx5T3duZXIgewogICAgcmVxdWlyZUN1c3RvbWVySWQgPSB2YWx1ZTsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCiAgLyoqCiAgICogU2V0IHBvbGljeSBpZiBhbGwgaW52ZXN0b3JzIG11c3QgYmUgY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgZmlyc3QuCiAgICoKICAgKiBUaGlzIGlzIGUuZy4gZm9yIHRoZSBhY2NyZWRpdGVkIGludmVzdG9yIGNsZWFyaW5nLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZVNpZ25lZEFkZHJlc3MoYm9vbCB2YWx1ZSwgYWRkcmVzcyBfc2lnbmVyQWRkcmVzcykgb25seU93bmVyIHsKICAgIHJlcXVpcmVkU2lnbmVkQWRkcmVzcyA9IHZhbHVlOwogICAgc2lnbmVyQWRkcmVzcyA9IF9zaWduZXJBZGRyZXNzOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKSBvbmx5T3duZXIgewogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IHN0YXR1czsKICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBjcm93ZHNhbGUgb3duZXIgdG8gY2xvc2UgZWFybHkgb3IgZXh0ZW5kIHRoZSBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGlzIGlzIHVzZWZ1bCBlLmcuIGZvciBhIG1hbnVhbCBzb2Z0IGNhcCBpbXBsZW1lbnRhdGlvbjoKICAgKiAtIGFmdGVyIFggYW1vdW50IGlzIHJlYWNoZWQgZGV0ZXJtaW5lIG1hbnVhbCBjbG9zaW5nCiAgICoKICAgKiBUaGlzIG1heSBwdXQgdGhlIGNyb3dkc2FsZSB0byBhbiBpbnZhbGlkIHN0YXRlLAogICAqIGJ1dCB3ZSB0cnVzdCBvd25lcnMga25vdyB3aGF0IHRoZXkgYXJlIGRvaW5nLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0RW5kc0F0KHVpbnQgdGltZSkgb25seU93bmVyIHsKCiAgICBpZihub3cgPiB0aW1lKSB7CiAgICAgIHRocm93OyAvLyBEb24ndCBjaGFuZ2UgcGFzdAogICAgfQoKICAgIGVuZHNBdCA9IHRpbWU7CiAgICBFbmRzQXRDaGFuZ2VkKGVuZHNBdCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gdGhlIHNldCwgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5KSBvbmx5T3duZXIgewogICAgcHJpY2luZ1N0cmF0ZWd5ID0gX3ByaWNpbmdTdHJhdGVneTsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIXByaWNpbmdTdHJhdGVneS5pc1ByaWNpbmdTdHJhdGVneSgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KCiAgLyoqCiAgICogQWxsb3cgbG9hZCByZWZ1bmRzIGJhY2sgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgcmVmdW5kaW5nLgogICAqCiAgICogVGhlIHRlYW0gY2FuIHRyYW5zZmVyIHRoZSBmdW5kcyBiYWNrIG9uIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgY2FzZSB0aGUgbWluaW11bSBnb2FsIHdhcyBub3QgcmVhY2hlZC4uCiAgICovCiAgZnVuY3Rpb24gbG9hZFJlZnVuZCgpIHB1YmxpYyBwYXlhYmxlIGluU3RhdGUoU3RhdGUuRmFpbHVyZSkgewogICAgaWYobXNnLnZhbHVlID09IDApIHRocm93OwogICAgbG9hZGVkUmVmdW5kID0gbG9hZGVkUmVmdW5kLnBsdXMobXNnLnZhbHVlKTsKICB9CgogIC8qKgogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLgogICAqLwogIGZ1bmN0aW9uIHJlZnVuZCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlJlZnVuZGluZykgewogICAgdWludDI1NiB3ZWlWYWx1ZSA9IGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl07CiAgICBpZiAod2VpVmFsdWUgPT0gMCkgdGhyb3c7CiAgICBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdID0gMDsKICAgIHdlaVJlZnVuZGVkID0gd2VpUmVmdW5kZWQucGx1cyh3ZWlWYWx1ZSk7CiAgICBSZWZ1bmQobXNnLnNlbmRlciwgd2VpVmFsdWUpOwogICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQod2VpVmFsdWUpKSB0aHJvdzsKICB9CgogIC8qKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY3Jvd2RzYWxlIGhhcyByYWlzZWQgZW5vdWdoIG1vbmV5IHRvIGJlIGEgc3VjY2VzCiAgICovCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuCiAgICoKICAgKiBXZSBtYWtlIGl0IGEgZnVuY3Rpb24gYW5kIGRvIG5vdCBhc3NpZ24gdGhlIHJlc3VsdCB0byBhIHZhcmlhYmxlLCBzbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLgogICAqLwogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFN0YXRlKSB7CiAgICBpZihmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKGZpbmFsaXplQWdlbnQpID09IDApIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmICghZmluYWxpemVBZ2VudC5pc1NhbmUoKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKCFwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDwgc3RhcnRzQXQpIHJldHVybiBTdGF0ZS5QcmVGdW5kaW5nOwogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDw9IGVuZHNBdCAmJiAhaXNDcm93ZHNhbGVGdWxsKCkpIHJldHVybiBTdGF0ZS5GdW5kaW5nOwogICAgZWxzZSBpZiAoaXNNaW5pbXVtR29hbFJlYWNoZWQoKSkgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7CiAgICBlbHNlIGlmICghaXNNaW5pbXVtR29hbFJlYWNoZWQoKSAmJiB3ZWlSYWlzZWQgPiAwICYmIGxvYWRlZFJlZnVuZCA+PSB3ZWlSYWlzZWQpIHJldHVybiBTdGF0ZS5SZWZ1bmRpbmc7CiAgICBlbHNlIHJldHVybiBTdGF0ZS5GYWlsdXJlOwogIH0KCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVhbCB0ZXN0aW5nIG9mIG11bHRpc2lnIHdhbGxldCBpbnRlcmFjdGlvbiAqLwogIGZ1bmN0aW9uIHNldE93bmVyVGVzdFZhbHVlKHVpbnQgdmFsKSBvbmx5T3duZXIgewogICAgb3duZXJUZXN0VmFsdWUgPSB2YWw7CiAgfQoKICAvLwogIC8vIE1vZGlmaWVycwogIC8vCgogIC8qKiBNb2RpZmllZCBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8KICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7CiAgICBpZihnZXRTdGF0ZSgpICE9IHN0YXRlKSB0aHJvdzsKICAgIF87CiAgfQoKCiAgLy8KICAvLyBBYnN0cmFjdCBmdW5jdGlvbnMKICAvLwoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBpbnZlc3RlZCBicmVha3Mgb3VyIGNhcCBydWxlcy4KICAgKgogICAqCiAgICogVGhlIGNoaWxkIGNvbnRyYWN0IG11c3QgZGVmaW5lIHRoZWlyIG93biBjYXAgc2V0dGluZyBydWxlcy4KICAgKiBXZSBhbGxvdyBhIGxvdCBvZiBmbGV4aWJpbGl0eSB0aHJvdWdoIGRpZmZlcmVudCBjYXBwaW5nIHN0cmF0ZWdpZXMgKEVUSCwgdG9rZW4gY291bnQpCiAgICogQ2FsbGVkIGZyb20gaW52ZXN0KCkuCiAgICoKICAgKiBAcGFyYW0gd2VpQW1vdW50IFRoZSBhbW91bnQgb2Ygd2VpIHRoZSBpbnZlc3RvciB0cmllcyB0byBpbnZlc3QgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gdG9rZW5BbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgd2UgdHJ5IHRvIGdpdmUgdG8gdGhlIGludmVzdG9yIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHdlaVJhaXNlZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHJhaXNlZCBiYWxhbmNlIGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gdG9rZW5zU29sZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHNvbGQgdG9rZW5zIGNvdW50IGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24KICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0YWtpbmcgdGhpcyBpbnZlc3RtZW50IHdvdWxkIGJyZWFrIG91ciBjYXAgcnVsZXMKICAgKi8KICBmdW5jdGlvbiBpc0JyZWFraW5nQ2FwKHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaVJhaXNlZFRvdGFsLCB1aW50IHRva2Vuc1NvbGRUb3RhbCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGNyb3dkc2FsZSBpcyBmdWxsIGFuZCB3ZSBjYW4gbm8gbG9uZ2VyIHNlbGwgYW55IHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CgogIC8qKgogICAqIENyZWF0ZSBuZXcgdG9rZW5zIG9yIHRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGRlcGVuZGluZyBvbiB0aGUgY2FwIG1vZGVsLgogICAqLwogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlOwp9CgoKCgovLy8gQGRldiBUcmFuY2hlIGJhc2VkIHByaWNpbmcgd2l0aCBzcGVjaWFsIHN1cHBvcnQgZm9yIHByZS1pY28gZGVhbHMuCi8vLyAgICAgIEltcGxlbWVudGluZyAiZmlyc3QgcHJpY2UiIHRyYW5jaGVzLCBtZWFuaW5nLCB0aGF0IGlmIGJ5ZXJzIG9yZGVyIGlzCi8vLyAgICAgIGNvdmVyaW5nIG1vcmUgdGhhbiBvbmUgdHJhbmNoZSwgdGhlIHByaWNlIG9mIHRoZSBsb3dlc3QgdHJhbmNoZSB3aWxsIGFwcGx5Ci8vLyAgICAgIHRvIHRoZSB3aG9sZSBvcmRlci4KY29udHJhY3QgRXRoVHJhbmNoZVByaWNpbmcgaXMgUHJpY2luZ1N0cmF0ZWd5LCBPd25hYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIHVpbnQgcHVibGljIGNvbnN0YW50IE1BWF9UUkFOQ0hFUyA9IDEwOwoKICAvLyBUaGlzIGNvbnRhaW5zIGFsbCBwcmUtSUNPIGFkZHJlc3NlcywgYW5kIHRoZWlyIHByaWNlcyAod2VpcyBwZXIgdG9rZW4pCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgcHJlaWNvQWRkcmVzc2VzOwoKICAvKioKICAqIERlZmluZSBwcmljaW5nIHNjaGVkdWxlIHVzaW5nIHRyYW5jaGVzLgogICovCiAgc3RydWN0IFRyYW5jaGUgewoKICAgICAgLy8gQW1vdW50IGluIHdlaXMgd2hlbiB0aGlzIHRyYW5jaGUgYmVjb21lcyBhY3RpdmUKICAgICAgdWludCBhbW91bnQ7CgogICAgICAvLyBIb3cgbWFueSB0b2tlbnMgcGVyIHNhdG9zaGkgeW91IHdpbGwgZ2V0IHdoaWxlIHRoaXMgdHJhbmNoZSBpcyBhY3RpdmUKICAgICAgdWludCBwcmljZTsKICB9CgogIC8vIFN0b3JlIHRyYW5jaGVzIGluIGEgZml4ZWQgYXJyYXksIHNvIHRoYXQgaXQgY2FuIGJlIHNlZW4gaW4gYSBibG9ja2NoYWluIGV4cGxvcmVyCiAgLy8gVHJhbmNoZSAwIGlzIGFsd2F5cyAoMCwgMCkKICAvLyAoVE9ETzogY2hhbmdlIHRoaXMgd2hlbiB3ZSBjb25maXJtIGR5bmFtaWMgYXJyYXlzIGFyZSBleHBsb3JhYmxlKQogIFRyYW5jaGVbMTBdIHB1YmxpYyB0cmFuY2hlczsKCiAgLy8gSG93IG1hbnkgYWN0aXZlIHRyYW5jaGVzIHdlIGhhdmUKICB1aW50IHB1YmxpYyB0cmFuY2hlQ291bnQ7CgogIC8vLyBAZGV2IENvbnRydWN0aW9uLCBjcmVhdGluZyBhIGxpc3Qgb2YgdHJhbmNoZXMKICAvLy8gQHBhcmFtIF90cmFuY2hlcyB1aW50W10gdHJhbmNoZXMgUGFpcnMgb2YgKHN0YXJ0IGFtb3VudCwgcHJpY2UpCiAgZnVuY3Rpb24gRXRoVHJhbmNoZVByaWNpbmcodWludFtdIF90cmFuY2hlcykgewogICAgLy8gTmVlZCB0byBoYXZlIHR1cGxlcywgbGVuZ3RoIGNoZWNrCiAgICBpZihfdHJhbmNoZXMubGVuZ3RoICUgMiA9PSAxIHx8IF90cmFuY2hlcy5sZW5ndGggPj0gTUFYX1RSQU5DSEVTKjIpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgdHJhbmNoZUNvdW50ID0gX3RyYW5jaGVzLmxlbmd0aCAvIDI7CgogICAgdWludCBoaWdoZXN0QW1vdW50ID0gMDsKCiAgICBmb3IodWludCBpPTA7IGk8X3RyYW5jaGVzLmxlbmd0aC8yOyBpKyspIHsKICAgICAgdHJhbmNoZXNbaV0uYW1vdW50ID0gX3RyYW5jaGVzW2kqMl07CiAgICAgIHRyYW5jaGVzW2ldLnByaWNlID0gX3RyYW5jaGVzW2kqMisxXTsKCiAgICAgIC8vIE5vIGludmFsaWQgc3RlcHMKICAgICAgaWYoKGhpZ2hlc3RBbW91bnQgIT0gMCkgJiYgKHRyYW5jaGVzW2ldLmFtb3VudCA8PSBoaWdoZXN0QW1vdW50KSkgewogICAgICAgIHRocm93OwogICAgICB9CgogICAgICBoaWdoZXN0QW1vdW50ID0gdHJhbmNoZXNbaV0uYW1vdW50OwogICAgfQoKICAgIC8vIFdlIG5lZWQgdG8gc3RhcnQgZnJvbSB6ZXJvLCBvdGhlcndpc2Ugd2UgYmxvdyB1cCBvdXIgZGVwbG95bWVudAogICAgaWYodHJhbmNoZXNbMF0uYW1vdW50ICE9IDApIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gTGFzdCB0cmFuY2hlIHByaWNlIG11c3QgYmUgemVybywgdGVybWluYXRpbmcgdGhlIGNyb3dkYWxlCiAgICBpZih0cmFuY2hlc1t0cmFuY2hlQ291bnQtMV0ucHJpY2UgIT0gMCkgewogICAgICB0aHJvdzsKICAgIH0KICB9CgogIC8vLyBAZGV2IFRoaXMgaXMgaW52b2tlZCBvbmNlIGZvciBldmVyeSBwcmUtSUNPIGFkZHJlc3MsIHNldCBwcmljZVBlclRva2VuCiAgLy8vICAgICAgdG8gMCB0byBkaXNhYmxlCiAgLy8vIEBwYXJhbSBwcmVpY29BZGRyZXNzIFByZXNhbGVGdW5kQ29sbGVjdG9yIGFkZHJlc3MKICAvLy8gQHBhcmFtIHByaWNlUGVyVG9rZW4gSG93IG1hbnkgd2VpcyBvbmUgdG9rZW4gY29zdCBmb3IgcHJlLWljbyBpbnZlc3RvcnMKICBmdW5jdGlvbiBzZXRQcmVpY29BZGRyZXNzKGFkZHJlc3MgcHJlaWNvQWRkcmVzcywgdWludCBwcmljZVBlclRva2VuKQogICAgcHVibGljCiAgICBvbmx5T3duZXIKICB7CiAgICBwcmVpY29BZGRyZXNzZXNbcHJlaWNvQWRkcmVzc10gPSBwcmljZVBlclRva2VuOwogIH0KCiAgLy8vIEBkZXYgSXRlcmF0ZSB0aHJvdWdoIHRyYW5jaGVzLiBZb3UgcmVhY2ggZW5kIG9mIHRyYW5jaGVzIHdoZW4gcHJpY2UgPSAwCiAgLy8vIEByZXR1cm4gdHVwbGUgKHRpbWUsIHByaWNlKQogIGZ1bmN0aW9uIGdldFRyYW5jaGUodWludCBuKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCwgdWludCkgewogICAgcmV0dXJuICh0cmFuY2hlc1tuXS5hbW91bnQsIHRyYW5jaGVzW25dLnByaWNlKTsKICB9CgogIGZ1bmN0aW9uIGdldEZpcnN0VHJhbmNoZSgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoVHJhbmNoZSkgewogICAgcmV0dXJuIHRyYW5jaGVzWzBdOwogIH0KCiAgZnVuY3Rpb24gZ2V0TGFzdFRyYW5jaGUoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKFRyYW5jaGUpIHsKICAgIHJldHVybiB0cmFuY2hlc1t0cmFuY2hlQ291bnQtMV07CiAgfQoKICBmdW5jdGlvbiBnZXRQcmljaW5nU3RhcnRzQXQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGdldEZpcnN0VHJhbmNoZSgpLmFtb3VudDsKICB9CgogIGZ1bmN0aW9uIGdldFByaWNpbmdFbmRzQXQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGdldExhc3RUcmFuY2hlKCkuYW1vdW50OwogIH0KCiAgZnVuY3Rpb24gaXNTYW5lKGFkZHJlc3MgX2Nyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgLy8gT3VyIHRyYW5jaGVzIGFyZSBub3QgYm91bmQgYnkgdGltZSwgc28gd2UgY2FuJ3QgcmVhbGx5IGNoZWNrIGFyZSB3ZSBzYW5lCiAgICAvLyBzbyB3ZSBwcmVzdW1lIHdlIGFyZSA7KQogICAgLy8gSW4gdGhlIGZ1dHVyZSB3ZSBjb3VsZCBzYXZlIGFuZCB0cmFjayByYWlzZWQgdG9rZW5zLCBhbmQgY29tcGFyZSBpdCB0bwogICAgLy8gdGhlIENyb3dkc2FsZSBjb250cmFjdC4KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHRyYW5jaGUgb3IgYmFpbCBvdXQgaWYgd2UgYXJlIG5vdCBpbiB0aGUgdHJhbmNoZSBwZXJpb2RzLgogIC8vLyBAcGFyYW0gd2VpUmFpc2VkIHRvdGFsIGFtb3VudCBvZiB3ZWlzIHJhaXNlZCwgZm9yIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUKICAvLy8gQHJldHVybiB7W3R5cGVdfSBbZGVzY3JpcHRpb25dCiAgZnVuY3Rpb24gZ2V0Q3VycmVudFRyYW5jaGUodWludCB3ZWlSYWlzZWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoVHJhbmNoZSkgewogICAgdWludCBpOwoKICAgIGZvcihpPTA7IGkgPCB0cmFuY2hlcy5sZW5ndGg7IGkrKykgewogICAgICBpZih3ZWlSYWlzZWQgPCB0cmFuY2hlc1tpXS5hbW91bnQpIHsKICAgICAgICByZXR1cm4gdHJhbmNoZXNbaS0xXTsKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHByaWNlLgogIC8vLyBAcGFyYW0gd2VpUmFpc2VkIHRvdGFsIGFtb3VudCBvZiB3ZWlzIHJhaXNlZCwgZm9yIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUKICAvLy8gQHJldHVybiBUaGUgY3VycmVudCBwcmljZSBvciAwIGlmIHdlIGFyZSBvdXRzaWRlIHRyYWNoZSByYW5nZXMKICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludCB3ZWlSYWlzZWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgcmV0dXJuIGdldEN1cnJlbnRUcmFuY2hlKHdlaVJhaXNlZCkucHJpY2U7CiAgfQoKICAvLy8gQGRldiBDYWxjdWxhdGUgdGhlIGN1cnJlbnQgcHJpY2UgZm9yIGJ1eSBpbiBhbW91bnQuCiAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludCB2YWx1ZSwgdWludCB0b2tlbnNTb2xkLCB1aW50IHdlaVJhaXNlZCwgYWRkcmVzcyBtc2dTZW5kZXIsIHVpbnQgZGVjaW1hbHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CgogICAgdWludCBtdWx0aXBsaWVyID0gMTAgKiogZGVjaW1hbHM7CgogICAgLy8gVGhpcyBpbnZlc3RvciBpcyBjb21pbmcgdGhyb3VnaCBwcmUtaWNvCiAgICBpZihwcmVpY29BZGRyZXNzZXNbbXNnU2VuZGVyXSA+IDApIHsKICAgICAgcmV0dXJuIHZhbHVlLnRpbWVzKG11bHRpcGxpZXIpIC8gcHJlaWNvQWRkcmVzc2VzW21zZ1NlbmRlcl07CiAgICB9CgogICAgdWludCBwcmljZSA9IGdldEN1cnJlbnRQcmljZSh3ZWlSYWlzZWQpOwogICAgcmV0dXJuIHZhbHVlLnRpbWVzKG11bHRpcGxpZXIpIC8gcHJpY2U7CiAgfQoKICBmdW5jdGlvbigpIHBheWFibGUgewogICAgdGhyb3c7IC8vIE5vIG1vbmV5IG9uIHRoaXMgY29udHJhY3QKICB9Cgp9'.
	

]
