Class {
	#name : #SRT91aa9212c69df5c175891d36f4756eadd709966a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT91aa9212c69df5c175891d36f4756eadd709966a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgppbnRlcmZhY2UgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgZGlnaXRzKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9CgppbnRlcmZhY2UgQ29udmVyc2lvblJhdGVzSW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiByZWNvcmRJbWJhbGFuY2UoCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50IGJ1eUFtb3VudCwKICAgICAgICB1aW50IHJhdGVVcGRhdGVCbG9jaywKICAgICAgICB1aW50IGN1cnJlbnRCbG9jawogICAgKQogICAgICAgIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBnZXRSYXRlKEVSQzIwIHRva2VuLCB1aW50IGN1cnJlbnRCbG9ja051bWJlciwgYm9vbCBidXksIHVpbnQgcXR5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwp9Cgpjb250cmFjdCBVdGlscyB7CgogICAgRVJDMjAgY29uc3RhbnQgaW50ZXJuYWwgRVRIX1RPS0VOX0FERFJFU1MgPSBFUkMyMCgweDAwZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZSk7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBQUkVDSVNJT04gPSAoMTAqKjE4KTsKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9RVFkgICA9ICgxMCoqMjgpOyAvLyAxMEIgdG9rZW5zCiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfUkFURSAgPSAoUFJFQ0lTSU9OICogMTAqKjYpOyAvLyB1cCB0byAxTSB0b2tlbnMgcGVyIEVUSAogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgTUFYX0RFQ0lNQUxTID0gMTg7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBFVEhfREVDSU1BTFMgPSAxODsKICAgIG1hcHBpbmcoYWRkcmVzcz0+dWludCkgaW50ZXJuYWwgZGVjaW1hbHM7CgogICAgZnVuY3Rpb24gc2V0RGVjaW1hbHMoRVJDMjAgdG9rZW4pIGludGVybmFsIHsKICAgICAgICBpZiAodG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpIGRlY2ltYWxzW3Rva2VuXSA9IEVUSF9ERUNJTUFMUzsKICAgICAgICBlbHNlIGRlY2ltYWxzW3Rva2VuXSA9IHRva2VuLmRlY2ltYWxzKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGVjaW1hbHMoRVJDMjAgdG9rZW4pIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKHRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTKSByZXR1cm4gRVRIX0RFQ0lNQUxTOyAvLyBzYXZlIHN0b3JhZ2UgYWNjZXNzCiAgICAgICAgdWludCB0b2tlbkRlY2ltYWxzID0gZGVjaW1hbHNbdG9rZW5dOwogICAgICAgIC8vIHRlY2huaWNhbGx5LCB0aGVyZSBtaWdodCBiZSB0b2tlbiB3aXRoIGRlY2ltYWxzIDAKICAgICAgICAvLyBtb3Jlb3ZlciwgdmVyeSBwb3NzaWJsZSB0aGF0IG9sZCB0b2tlbnMgaGF2ZSBkZWNpbWFscyAwCiAgICAgICAgLy8gdGhlc2UgdG9rZW5zIHdpbGwganVzdCBoYXZlIGhpZ2hlciBnYXMgZmVlcy4KICAgICAgICBpZih0b2tlbkRlY2ltYWxzID09IDApIHJldHVybiB0b2tlbi5kZWNpbWFscygpOwoKICAgICAgICByZXR1cm4gdG9rZW5EZWNpbWFsczsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjRHN0UXR5KHVpbnQgc3JjUXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShzcmNRdHkgPD0gTUFYX1FUWSk7CiAgICAgICAgcmVxdWlyZShyYXRlIDw9IE1BWF9SQVRFKTsKCiAgICAgICAgaWYgKGRzdERlY2ltYWxzID49IHNyY0RlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIHJldHVybiAoc3JjUXR5ICogcmF0ZSAqICgxMCoqKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpKSkgLyBQUkVDSVNJT047CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgcmV0dXJuIChzcmNRdHkgKiByYXRlKSAvIChQUkVDSVNJT04gKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjU3JjUXR5KHVpbnQgZHN0UXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShkc3RRdHkgPD0gTUFYX1FUWSk7CiAgICAgICAgcmVxdWlyZShyYXRlIDw9IE1BWF9SQVRFKTsKCiAgICAgICAgLy9zb3VyY2UgcXVhbnRpdHkgaXMgcm91bmRlZCB1cC4gdG8gYXZvaWQgZGVzdCBxdWFudGl0eSBiZWluZyB0b28gbG93LgogICAgICAgIHVpbnQgbnVtZXJhdG9yOwogICAgICAgIHVpbnQgZGVub21pbmF0b3I7CiAgICAgICAgaWYgKHNyY0RlY2ltYWxzID49IGRzdERlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIG51bWVyYXRvciA9IChQUkVDSVNJT04gKiBkc3RRdHkgKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgICAgICBkZW5vbWluYXRvciA9IHJhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgbnVtZXJhdG9yID0gKFBSRUNJU0lPTiAqIGRzdFF0eSk7CiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gKHJhdGUgKiAoMTAqKihkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKG51bWVyYXRvciArIGRlbm9taW5hdG9yIC0gMSkgLyBkZW5vbWluYXRvcjsgLy9hdm9pZCByb3VuZGluZyBkb3duIGVycm9ycwogICAgfQp9Cgpjb250cmFjdCBQZXJtaXNzaW9uR3JvdXBzIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbjsKICAgIGFkZHJlc3MgcHVibGljIHBlbmRpbmdBZG1pbjsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgaW50ZXJuYWwgb3BlcmF0b3JzOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBhbGVydGVyczsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBvcGVyYXRvcnNHcm91cDsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBhbGVydGVyc0dyb3VwOwoKICAgIGZ1bmN0aW9uIFBlcm1pc3Npb25Hcm91cHMoKSBwdWJsaWMgewogICAgICAgIGFkbWluID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPcGVyYXRvcigpIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWxlcnRlcigpIHsKICAgICAgICByZXF1aXJlKGFsZXJ0ZXJzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9wZXJhdG9ycyAoKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG9wZXJhdG9yc0dyb3VwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFsZXJ0ZXJzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gYWxlcnRlcnNHcm91cDsKICAgIH0KCiAgICBldmVudCBUcmFuc2ZlckFkbWluUGVuZGluZyhhZGRyZXNzIHBlbmRpbmdBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBhZG1pbiB0byBzZXQgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzLgogICAgICogQHBhcmFtIG5ld0FkbWluIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBZG1pbihhZGRyZXNzIG5ld0FkbWluKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG5ld0FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIFRyYW5zZmVyQWRtaW5QZW5kaW5nKHBlbmRpbmdBZG1pbik7CiAgICAgICAgcGVuZGluZ0FkbWluID0gbmV3QWRtaW47CiAgICB9CgogICAgZXZlbnQgQWRtaW5DbGFpbWVkKCBhZGRyZXNzIG5ld0FkbWluLCBhZGRyZXNzIHByZXZpb3VzQWRtaW4pOwoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSBjaGFuZ2UgYWRtaW4gcHJvY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BZG1pbigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShwZW5kaW5nQWRtaW4gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgQWRtaW5DbGFpbWVkKHBlbmRpbmdBZG1pbiwgYWRtaW4pOwogICAgICAgIGFkbWluID0gcGVuZGluZ0FkbWluOwogICAgICAgIHBlbmRpbmdBZG1pbiA9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZXZlbnQgQWxlcnRlckFkZGVkIChhZGRyZXNzIG5ld0FsZXJ0ZXIsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZEFsZXJ0ZXIoYWRkcmVzcyBuZXdBbGVydGVyKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFhbGVydGVyc1tuZXdBbGVydGVyXSk7IC8vIHByZXZlbnQgZHVwbGljYXRlcy4KICAgICAgICBBbGVydGVyQWRkZWQobmV3QWxlcnRlciwgdHJ1ZSk7CiAgICAgICAgYWxlcnRlcnNbbmV3QWxlcnRlcl0gPSB0cnVlOwogICAgICAgIGFsZXJ0ZXJzR3JvdXAucHVzaChuZXdBbGVydGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVBbGVydGVyIChhZGRyZXNzIGFsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbYWxlcnRlcl0pOwogICAgICAgIGFsZXJ0ZXJzW2FsZXJ0ZXJdID0gZmFsc2U7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsZXJ0ZXJzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKGFsZXJ0ZXJzR3JvdXBbaV0gPT0gYWxlcnRlcikgewogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cFtpXSA9IGFsZXJ0ZXJzR3JvdXBbYWxlcnRlcnNHcm91cC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGFsZXJ0ZXJzR3JvdXAubGVuZ3RoLS07CiAgICAgICAgICAgICAgICBBbGVydGVyQWRkZWQoYWxlcnRlciwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZXZlbnQgT3BlcmF0b3JBZGRlZChhZGRyZXNzIG5ld09wZXJhdG9yLCBib29sIGlzQWRkKTsKCiAgICBmdW5jdGlvbiBhZGRPcGVyYXRvcihhZGRyZXNzIG5ld09wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFvcGVyYXRvcnNbbmV3T3BlcmF0b3JdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIE9wZXJhdG9yQWRkZWQobmV3T3BlcmF0b3IsIHRydWUpOwogICAgICAgIG9wZXJhdG9yc1tuZXdPcGVyYXRvcl0gPSB0cnVlOwogICAgICAgIG9wZXJhdG9yc0dyb3VwLnB1c2gobmV3T3BlcmF0b3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU9wZXJhdG9yIChhZGRyZXNzIG9wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1tvcGVyYXRvcl0pOwogICAgICAgIG9wZXJhdG9yc1tvcGVyYXRvcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3BlcmF0b3JzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKG9wZXJhdG9yc0dyb3VwW2ldID09IG9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvcnNHcm91cFtpXSA9IG9wZXJhdG9yc0dyb3VwW29wZXJhdG9yc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgb3BlcmF0b3JzR3JvdXAubGVuZ3RoIC09IDE7CiAgICAgICAgICAgICAgICBPcGVyYXRvckFkZGVkKG9wZXJhdG9yLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgV2l0aGRyYXdhYmxlIGlzIFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGV2ZW50IFRva2VuV2l0aGRyYXcoRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IGFsbCBFUkMyMCBjb21wYXRpYmxlIHRva2VucwogICAgICogQHBhcmFtIHRva2VuIEVSQzIwIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihzZW5kVG8sIGFtb3VudCkpOwogICAgICAgIFRva2VuV2l0aGRyYXcodG9rZW4sIGFtb3VudCwgc2VuZFRvKTsKICAgIH0KCiAgICBldmVudCBFdGhlcldpdGhkcmF3KHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IEV0aGVycwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBzZW5kVG8udHJhbnNmZXIoYW1vdW50KTsKICAgICAgICBFdGhlcldpdGhkcmF3KGFtb3VudCwgc2VuZFRvKTsKICAgIH0KfQoKY29udHJhY3QgVm9sdW1lSW1iYWxhbmNlUmVjb3JkZXIgaXMgV2l0aGRyYXdhYmxlIHsKCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIFNMSURJTkdfV0lORE9XX1NJWkUgPSA1OwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBQT1dfMl82NCA9IDIgKiogNjQ7CgogICAgc3RydWN0IFRva2VuQ29udHJvbEluZm8gewogICAgICAgIHVpbnQgbWluaW1hbFJlY29yZFJlc29sdXRpb247IC8vIGNhbiBiZSByb3VnaGx5IDEgY2VudAogICAgICAgIHVpbnQgbWF4UGVyQmxvY2tJbWJhbGFuY2U7IC8vIGluIHR3ZWkgcmVzb2x1dGlvbgogICAgICAgIHVpbnQgbWF4VG90YWxJbWJhbGFuY2U7IC8vIG1heCB0b3RhbCBpbWJhbGFuY2UgKGJldHdlZW4gcmF0ZSB1cGRhdGVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmVmb3JlIGhhbHRpbmcgdHJhZGUKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gVG9rZW5Db250cm9sSW5mbykgaW50ZXJuYWwgdG9rZW5Db250cm9sSW5mbzsKCiAgICBzdHJ1Y3QgVG9rZW5JbWJhbGFuY2VEYXRhIHsKICAgICAgICBpbnQgIGxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgIHVpbnQgbGFzdEJsb2NrOwoKICAgICAgICBpbnQgIHRvdGFsQnV5VW5pdHNJbWJhbGFuY2U7CiAgICAgICAgdWludCBsYXN0UmF0ZVVwZGF0ZUJsb2NrOwogICAgfQoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQ9PnVpbnQpKSBwdWJsaWMgdG9rZW5JbWJhbGFuY2VEYXRhOwoKICAgIGZ1bmN0aW9uIFZvbHVtZUltYmFsYW5jZVJlY29yZGVyKGFkZHJlc3MgX2FkbWluKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGFkbWluID0gX2FkbWluOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRva2VuQ29udHJvbEluZm8oCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgdWludCBtaW5pbWFsUmVjb3JkUmVzb2x1dGlvbiwKICAgICAgICB1aW50IG1heFBlckJsb2NrSW1iYWxhbmNlLAogICAgICAgIHVpbnQgbWF4VG90YWxJbWJhbGFuY2UKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5QWRtaW4KICAgIHsKICAgICAgICB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXSA9CiAgICAgICAgICAgIFRva2VuQ29udHJvbEluZm8oCiAgICAgICAgICAgICAgICBtaW5pbWFsUmVjb3JkUmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgIG1heFBlckJsb2NrSW1iYWxhbmNlLAogICAgICAgICAgICAgICAgbWF4VG90YWxJbWJhbGFuY2UKICAgICAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlbkNvbnRyb2xJbmZvKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQsIHVpbnQsIHVpbnQpIHsKICAgICAgICByZXR1cm4gKHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgdG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWF4UGVyQmxvY2tJbWJhbGFuY2UsCiAgICAgICAgICAgICAgICB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5tYXhUb3RhbEltYmFsYW5jZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkSW1iYWxhbmNlKAogICAgICAgIEVSQzIwIHRva2VuLAogICAgICAgIGludCBidXlBbW91bnQsCiAgICAgICAgdWludCByYXRlVXBkYXRlQmxvY2ssCiAgICAgICAgdWludCBjdXJyZW50QmxvY2sKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHVpbnQgY3VycmVudEJsb2NrSW5kZXggPSBjdXJyZW50QmxvY2sgJSBTTElESU5HX1dJTkRPV19TSVpFOwogICAgICAgIGludCByZWNvcmRlZEJ1eUFtb3VudCA9IGludChidXlBbW91bnQgLyBpbnQodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24pKTsKCiAgICAgICAgaW50IHByZXZJbWJhbGFuY2UgPSAwOwoKICAgICAgICBUb2tlbkltYmFsYW5jZURhdGEgbWVtb3J5IGN1cnJlbnRCbG9ja0RhdGEgPQogICAgICAgICAgICBkZWNvZGVUb2tlbkltYmFsYW5jZURhdGEodG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVtjdXJyZW50QmxvY2tJbmRleF0pOwoKICAgICAgICAvLyBmaXJzdCBzY2VuYXJpbyAtIHRoaXMgaXMgbm90IHRoZSBmaXJzdCB0eCBpbiB0aGUgY3VycmVudCBibG9jawogICAgICAgIGlmIChjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9jayA9PSBjdXJyZW50QmxvY2spIHsKICAgICAgICAgICAgaWYgKHVpbnQoY3VycmVudEJsb2NrRGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrKSA9PSByYXRlVXBkYXRlQmxvY2spIHsKICAgICAgICAgICAgICAgIC8vIGp1c3QgaW5jcmVhc2UgaW1iYWxhbmNlCiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlICs9IHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlICs9IHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaW1iYWxhbmNlIHdhcyBjaGFuZ2VkIGluIHRoZSBtaWRkbGUgb2YgdGhlIGJsb2NrCiAgICAgICAgICAgICAgICBwcmV2SW1iYWxhbmNlID0gZ2V0SW1iYWxhbmNlSW5SYW5nZSh0b2tlbiwgcmF0ZVVwZGF0ZUJsb2NrLCBjdXJyZW50QmxvY2spOwogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlID0gaW50KHByZXZJbWJhbGFuY2UpICsgcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlICs9IHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrID0gdWludChyYXRlVXBkYXRlQmxvY2spOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gZmlyc3QgdHggaW4gdGhlIGN1cnJlbnQgYmxvY2sKICAgICAgICAgICAgaW50IGN1cnJlbnRCbG9ja0ltYmFsYW5jZTsKICAgICAgICAgICAgKHByZXZJbWJhbGFuY2UsIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSkgPSBnZXRJbWJhbGFuY2VTaW5jZVJhdGVVcGRhdGUodG9rZW4sIHJhdGVVcGRhdGVCbG9jaywgY3VycmVudEJsb2NrKTsKCiAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgPSByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2sgPSB1aW50KGN1cnJlbnRCbG9jayk7CiAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdFJhdGVVcGRhdGVCbG9jayA9IHVpbnQocmF0ZVVwZGF0ZUJsb2NrKTsKICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlID0gaW50KHByZXZJbWJhbGFuY2UpICsgcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgfQoKICAgICAgICB0b2tlbkltYmFsYW5jZURhdGFbdG9rZW5dW2N1cnJlbnRCbG9ja0luZGV4XSA9IGVuY29kZVRva2VuSW1iYWxhbmNlRGF0YShjdXJyZW50QmxvY2tEYXRhKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRHYXJiYWdlVG9Wb2x1bWVSZWNvcmRlcihFUkMyMCB0b2tlbikgaW50ZXJuYWwgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IFNMSURJTkdfV0lORE9XX1NJWkU7IGkrKykgewogICAgICAgICAgICB0b2tlbkltYmFsYW5jZURhdGFbdG9rZW5dW2ldID0gMHgxOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJbWJhbGFuY2VJblJhbmdlKEVSQzIwIHRva2VuLCB1aW50IHN0YXJ0QmxvY2ssIHVpbnQgZW5kQmxvY2spIGludGVybmFsIHZpZXcgcmV0dXJucyhpbnQgYnV5SW1iYWxhbmNlKSB7CiAgICAgICAgLy8gY2hlY2sgdGhlIGltYmFsYW5jZSBpbiB0aGUgc2xpZGluZyB3aW5kb3cKICAgICAgICByZXF1aXJlKHN0YXJ0QmxvY2sgPD0gZW5kQmxvY2spOwoKICAgICAgICBidXlJbWJhbGFuY2UgPSAwOwoKICAgICAgICBmb3IgKHVpbnQgd2luZG93SW5kID0gMDsgd2luZG93SW5kIDwgU0xJRElOR19XSU5ET1dfU0laRTsgd2luZG93SW5kKyspIHsKICAgICAgICAgICAgVG9rZW5JbWJhbGFuY2VEYXRhIG1lbW9yeSBwZXJCbG9ja0RhdGEgPSBkZWNvZGVUb2tlbkltYmFsYW5jZURhdGEodG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVt3aW5kb3dJbmRdKTsKCiAgICAgICAgICAgIGlmIChwZXJCbG9ja0RhdGEubGFzdEJsb2NrIDw9IGVuZEJsb2NrICYmIHBlckJsb2NrRGF0YS5sYXN0QmxvY2sgPj0gc3RhcnRCbG9jaykgewogICAgICAgICAgICAgICAgYnV5SW1iYWxhbmNlICs9IGludChwZXJCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEltYmFsYW5jZVNpbmNlUmF0ZVVwZGF0ZShFUkMyMCB0b2tlbiwgdWludCByYXRlVXBkYXRlQmxvY2ssIHVpbnQgY3VycmVudEJsb2NrKQogICAgICAgIGludGVybmFsIHZpZXcKICAgICAgICByZXR1cm5zKGludCBidXlJbWJhbGFuY2UsIGludCBjdXJyZW50QmxvY2tJbWJhbGFuY2UpCiAgICB7CiAgICAgICAgYnV5SW1iYWxhbmNlID0gMDsKICAgICAgICBjdXJyZW50QmxvY2tJbWJhbGFuY2UgPSAwOwogICAgICAgIHVpbnQgbGF0ZXN0QmxvY2sgPSAwOwogICAgICAgIGludCBpbWJhbGFuY2VJblJhbmdlID0gMDsKICAgICAgICB1aW50IHN0YXJ0QmxvY2sgPSByYXRlVXBkYXRlQmxvY2s7CiAgICAgICAgdWludCBlbmRCbG9jayA9IGN1cnJlbnRCbG9jazsKCiAgICAgICAgZm9yICh1aW50IHdpbmRvd0luZCA9IDA7IHdpbmRvd0luZCA8IFNMSURJTkdfV0lORE9XX1NJWkU7IHdpbmRvd0luZCsrKSB7CiAgICAgICAgICAgIFRva2VuSW1iYWxhbmNlRGF0YSBtZW1vcnkgcGVyQmxvY2tEYXRhID0gZGVjb2RlVG9rZW5JbWJhbGFuY2VEYXRhKHRva2VuSW1iYWxhbmNlRGF0YVt0b2tlbl1bd2luZG93SW5kXSk7CgogICAgICAgICAgICBpZiAocGVyQmxvY2tEYXRhLmxhc3RCbG9jayA8PSBlbmRCbG9jayAmJiBwZXJCbG9ja0RhdGEubGFzdEJsb2NrID49IHN0YXJ0QmxvY2spIHsKICAgICAgICAgICAgICAgIGltYmFsYW5jZUluUmFuZ2UgKz0gcGVyQmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocGVyQmxvY2tEYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgIT0gcmF0ZVVwZGF0ZUJsb2NrKSBjb250aW51ZTsKICAgICAgICAgICAgaWYgKHBlckJsb2NrRGF0YS5sYXN0QmxvY2sgPCBsYXRlc3RCbG9jaykgY29udGludWU7CgogICAgICAgICAgICBsYXRlc3RCbG9jayA9IHBlckJsb2NrRGF0YS5sYXN0QmxvY2s7CiAgICAgICAgICAgIGJ1eUltYmFsYW5jZSA9IHBlckJsb2NrRGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgICAgICBpZiAodWludChwZXJCbG9ja0RhdGEubGFzdEJsb2NrKSA9PSBjdXJyZW50QmxvY2spIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSA9IHBlckJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGJ1eUltYmFsYW5jZSA9PSAwKSB7CiAgICAgICAgICAgIGJ1eUltYmFsYW5jZSA9IGltYmFsYW5jZUluUmFuZ2U7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEltYmFsYW5jZShFUkMyMCB0b2tlbiwgdWludCByYXRlVXBkYXRlQmxvY2ssIHVpbnQgY3VycmVudEJsb2NrKQogICAgICAgIGludGVybmFsIHZpZXcKICAgICAgICByZXR1cm5zKGludCB0b3RhbEltYmFsYW5jZSwgaW50IGN1cnJlbnRCbG9ja0ltYmFsYW5jZSkKICAgIHsKCiAgICAgICAgaW50IHJlc29sdXRpb24gPSBpbnQodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24pOwoKICAgICAgICAodG90YWxJbWJhbGFuY2UsIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSkgPQogICAgICAgICAgICBnZXRJbWJhbGFuY2VTaW5jZVJhdGVVcGRhdGUoCiAgICAgICAgICAgICAgICB0b2tlbiwKICAgICAgICAgICAgICAgIHJhdGVVcGRhdGVCbG9jaywKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9jayk7CgogICAgICAgIHRvdGFsSW1iYWxhbmNlICo9IHJlc29sdXRpb247CiAgICAgICAgY3VycmVudEJsb2NrSW1iYWxhbmNlICo9IHJlc29sdXRpb247CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TWF4UGVyQmxvY2tJbWJhbGFuY2UoRVJDMjAgdG9rZW4pIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1heFBlckJsb2NrSW1iYWxhbmNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE1heFRvdGFsSW1iYWxhbmNlKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5tYXhUb3RhbEltYmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmNvZGVUb2tlbkltYmFsYW5jZURhdGEoVG9rZW5JbWJhbGFuY2VEYXRhIGRhdGEpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gY2hlY2sgZm9yIG92ZXJmbG93cwogICAgICAgIHJlcXVpcmUoZGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSA8IGludChQT1dfMl82NCAvIDIpKTsKICAgICAgICByZXF1aXJlKGRhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgPiBpbnQoLTEgKiBpbnQoUE9XXzJfNjQpIC8gMikpOwogICAgICAgIHJlcXVpcmUoZGF0YS5sYXN0QmxvY2sgPCBQT1dfMl82NCk7CiAgICAgICAgcmVxdWlyZShkYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UgPCBpbnQoUE9XXzJfNjQgLyAyKSk7CiAgICAgICAgcmVxdWlyZShkYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UgPiBpbnQoLTEgKiBpbnQoUE9XXzJfNjQpIC8gMikpOwogICAgICAgIHJlcXVpcmUoZGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrIDwgUE9XXzJfNjQpOwoKICAgICAgICAvLyBkbyBlbmNvZGluZwogICAgICAgIHVpbnQgcmVzdWx0ID0gdWludChkYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlKSAmIChQT1dfMl82NCAtIDEpOwogICAgICAgIHJlc3VsdCB8PSBkYXRhLmxhc3RCbG9jayAqIFBPV18yXzY0OwogICAgICAgIHJlc3VsdCB8PSAodWludChkYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UpICYgKFBPV18yXzY0IC0gMSkpICogUE9XXzJfNjQgKiBQT1dfMl82NDsKICAgICAgICByZXN1bHQgfD0gZGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrICogUE9XXzJfNjQgKiBQT1dfMl82NCAqIFBPV18yXzY0OwoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY29kZVRva2VuSW1iYWxhbmNlRGF0YSh1aW50IGlucHV0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMoVG9rZW5JbWJhbGFuY2VEYXRhKSB7CiAgICAgICAgVG9rZW5JbWJhbGFuY2VEYXRhIG1lbW9yeSBkYXRhOwoKICAgICAgICBkYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlID0gaW50KGludDY0KGlucHV0ICYgKFBPV18yXzY0IC0gMSkpKTsKICAgICAgICBkYXRhLmxhc3RCbG9jayA9IHVpbnQodWludDY0KChpbnB1dCAvIFBPV18yXzY0KSAmIChQT1dfMl82NCAtIDEpKSk7CiAgICAgICAgZGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlID0gaW50KGludDY0KChpbnB1dCAvIChQT1dfMl82NCAqIFBPV18yXzY0KSkgJiAoUE9XXzJfNjQgLSAxKSkpOwogICAgICAgIGRhdGEubGFzdFJhdGVVcGRhdGVCbG9jayA9IHVpbnQodWludDY0KChpbnB1dCAvIChQT1dfMl82NCAqIFBPV18yXzY0ICogUE9XXzJfNjQpKSkpOwoKICAgICAgICByZXR1cm4gZGF0YTsKICAgIH0KfQoKY29udHJhY3QgQ29udmVyc2lvblJhdGVzIGlzIENvbnZlcnNpb25SYXRlc0ludGVyZmFjZSwgVm9sdW1lSW1iYWxhbmNlUmVjb3JkZXIsIFV0aWxzIHsKCiAgICAvLyBicHMgLSBiYXNpYyByYXRlIHN0ZXBzLiBvbmUgc3RlcCBpcyAxIC8gMTAwMDAgb2YgdGhlIHJhdGUuCiAgICBzdHJ1Y3QgU3RlcEZ1bmN0aW9uIHsKICAgICAgICBpbnRbXSB4OyAvLyBxdWFudGl0eSBmb3IgZWFjaCBzdGVwLiBRdWFudGl0eSBvZiBlYWNoIHN0ZXAgaW5jbHVkZXMgcHJldmlvdXMgc3RlcHMuCiAgICAgICAgaW50W10geTsgLy8gcmF0ZSBjaGFuZ2UgcGVyIHF1YW50aXR5IHN0ZXAgIGluIGJwcy4KICAgIH0KCiAgICBzdHJ1Y3QgVG9rZW5EYXRhIHsKICAgICAgICBib29sIGxpc3RlZDsgIC8vIHdhcyBhZGRlZCB0byByZXNlcnZlCiAgICAgICAgYm9vbCBlbmFibGVkOyAvLyB3aGV0aGVyIHRyYWRlIGlzIGVuYWJsZWQKCiAgICAgICAgLy8gcG9zaXRpb24gaW4gdGhlIGNvbXBhY3QgZGF0YQogICAgICAgIHVpbnQgY29tcGFjdERhdGFBcnJheUluZGV4OwogICAgICAgIHVpbnQgY29tcGFjdERhdGFGaWVsZEluZGV4OwoKICAgICAgICAvLyByYXRlIGRhdGEuIGJhc2UgYW5kIGNoYW5nZXMgYWNjb3JkaW5nIHRvIHF1YW50aXR5IGFuZCByZXNlcnZlIGJhbGFuY2UuCiAgICAgICAgLy8gZ2VuZXJhbGx5IHNwZWFraW5nLiBTZWxsIHJhdGUgaXMgMSAvIGJ1eSByYXRlIGkuZS4gdGhlIGJ1eSBpbiB0aGUgb3RoZXIgZGlyZWN0aW9uLgogICAgICAgIHVpbnQgYmFzZUJ1eVJhdGU7ICAvLyBpbiBQUkVDSVNJT04gdW5pdHMuIHNlZSBLeWJlckNvbnN0YW50cwogICAgICAgIHVpbnQgYmFzZVNlbGxSYXRlOyAvLyBQUkVDSVNJT04gdW5pdHMuIHdpdGhvdXQgKHNlbGwgLyBidXkpIHNwcmVhZCBpdCBpcyAxIC8gYmFzZUJ1eVJhdGUKICAgICAgICBTdGVwRnVuY3Rpb24gYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbjsgLy8gaW4gYnBzLiBoaWdoZXIgcXVhbnRpdHkgLSBiaWdnZXIgdGhlIHJhdGUuCiAgICAgICAgU3RlcEZ1bmN0aW9uIHNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uOy8vIGluIGJwcy4gaGlnaGVyIHRoZSBxdWEKICAgICAgICBTdGVwRnVuY3Rpb24gYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbjsgLy8gaW4gQlBTLiBoaWdoZXIgcmVzZXJ2ZSBpbWJhbGFuY2UgLSBiaWdnZXIgdGhlIHJhdGUuCiAgICAgICAgU3RlcEZ1bmN0aW9uIHNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uOwogICAgfQoKICAgIC8qCiAgICB0aGlzIGlzIHRoZSBkYXRhIGZvciB0b2tlblJhdGVzQ29tcGFjdERhdGEKICAgIGJ1dCBzb2xpZGl0eSBjb21waWxlciBvcHRpbWl6ZXIgaXMgc3ViLW9wdGltYWwsIGFuZCBjYW5ub3Qgd3JpdGUgdGhpcyBzdHJ1Y3R1cmUgaW4gYSBzaW5nbGUgc3RvcmFnZSB3cml0ZQogICAgc28gd2UgcmVwcmVzZW50IGl0IGFzIGJ5dGVzMzIgYW5kIGRvIHRoZSBieXRlIHRyaWNrcyBvdXJzZWx2ZXMuCiAgICBzdHJ1Y3QgVG9rZW5SYXRlc0NvbXBhY3REYXRhIHsKICAgICAgICBieXRlczE0IGJ1eTsgIC8vIGNoYW5nZSBidXkgcmF0ZSBvZiB0b2tlbiBmcm9tIGJhc2VCdXlSYXRlIGluIDEwIGJwcwogICAgICAgIGJ5dGVzMTQgc2VsbDsgLy8gY2hhbmdlIHNlbGwgcmF0ZSBvZiB0b2tlbiBmcm9tIGJhc2VTZWxsUmF0ZSBpbiAxMCBicHMKCiAgICAgICAgdWludDMyIGJsb2NrTnVtYmVyOwogICAgfSAqLwogICAgdWludCBwdWJsaWMgdmFsaWRSYXRlRHVyYXRpb25JbkJsb2NrcyA9IDEwOyAvLyByYXRlcyBhcmUgdmFsaWQgZm9yIHRoaXMgYW1vdW50IG9mIGJsb2NrcwogICAgRVJDMjBbXSBpbnRlcm5hbCBsaXN0ZWRUb2tlbnM7CiAgICBtYXBwaW5nKGFkZHJlc3M9PlRva2VuRGF0YSkgaW50ZXJuYWwgdG9rZW5EYXRhOwogICAgYnl0ZXMzMltdIGludGVybmFsIHRva2VuUmF0ZXNDb21wYWN0RGF0YTsKICAgIHVpbnQgcHVibGljIG51bVRva2Vuc0luQ3VycmVudENvbXBhY3REYXRhID0gMDsKICAgIGFkZHJlc3MgcHVibGljIHJlc2VydmVDb250cmFjdDsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTlVNX1RPS0VOU19JTl9DT01QQUNUX0RBVEEgPSAxNDsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgQllURVNfMTRfT0ZGU0VUID0gKDIgKiogKDggKiBOVU1fVE9LRU5TX0lOX0NPTVBBQ1RfREFUQSkpOwoKICAgIGZ1bmN0aW9uIENvbnZlcnNpb25SYXRlcyhhZGRyZXNzIF9hZG1pbikgcHVibGljIFZvbHVtZUltYmFsYW5jZVJlY29yZGVyKF9hZG1pbikKICAgICAgICB7IH0gLy8gc29saGludC1kaXNhYmxlLWxpbmUgbm8tZW1wdHktYmxvY2tzCgogICAgZnVuY3Rpb24gYWRkVG9rZW4oRVJDMjAgdG9rZW4pIHB1YmxpYyBvbmx5QWRtaW4gewoKICAgICAgICByZXF1aXJlKCF0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQgPSB0cnVlOwogICAgICAgIGxpc3RlZFRva2Vucy5wdXNoKHRva2VuKTsKCiAgICAgICAgaWYgKG51bVRva2Vuc0luQ3VycmVudENvbXBhY3REYXRhID09IDApIHsKICAgICAgICAgICAgdG9rZW5SYXRlc0NvbXBhY3REYXRhLmxlbmd0aCsrOyAvLyBhZGQgbmV3IHN0cnVjdHVyZQogICAgICAgIH0KCiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUFycmF5SW5kZXggPSB0b2tlblJhdGVzQ29tcGFjdERhdGEubGVuZ3RoIC0gMTsKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhRmllbGRJbmRleCA9IG51bVRva2Vuc0luQ3VycmVudENvbXBhY3REYXRhOwoKICAgICAgICBudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSA9IChudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSArIDEpICUgTlVNX1RPS0VOU19JTl9DT01QQUNUX0RBVEE7CgogICAgICAgIHNldEdhcmJhZ2VUb1ZvbHVtZVJlY29yZGVyKHRva2VuKTsKCiAgICAgICAgc2V0RGVjaW1hbHModG9rZW4pOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENvbXBhY3REYXRhKGJ5dGVzMTRbXSBidXksIGJ5dGVzMTRbXSBzZWxsLCB1aW50IGJsb2NrTnVtYmVyLCB1aW50W10gaW5kaWNlcykgcHVibGljIG9ubHlPcGVyYXRvciB7CgogICAgICAgIHJlcXVpcmUoYnV5Lmxlbmd0aCA9PSBzZWxsLmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZShpbmRpY2VzLmxlbmd0aCA9PSBidXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGJsb2NrTnVtYmVyIDw9IDB4RkZGRkZGRkYpOwoKICAgICAgICB1aW50IGJ5dGVzMTRPZmZzZXQgPSBCWVRFU18xNF9PRkZTRVQ7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGluZGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgcmVxdWlyZShpbmRpY2VzW2ldIDwgdG9rZW5SYXRlc0NvbXBhY3REYXRhLmxlbmd0aCk7CiAgICAgICAgICAgIHVpbnQgZGF0YSA9IHVpbnQoYnV5W2ldKSB8IHVpbnQoc2VsbFtpXSkgKiBieXRlczE0T2Zmc2V0IHwgKGJsb2NrTnVtYmVyICogKGJ5dGVzMTRPZmZzZXQgKiBieXRlczE0T2Zmc2V0KSk7CiAgICAgICAgICAgIHRva2VuUmF0ZXNDb21wYWN0RGF0YVtpbmRpY2VzW2ldXSA9IGJ5dGVzMzIoZGF0YSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldEJhc2VSYXRlKAogICAgICAgIEVSQzIwW10gdG9rZW5zLAogICAgICAgIHVpbnRbXSBiYXNlQnV5LAogICAgICAgIHVpbnRbXSBiYXNlU2VsbCwKICAgICAgICBieXRlczE0W10gYnV5LAogICAgICAgIGJ5dGVzMTRbXSBzZWxsLAogICAgICAgIHVpbnQgYmxvY2tOdW1iZXIsCiAgICAgICAgdWludFtdIGluZGljZXMKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3BlcmF0b3IKICAgIHsKICAgICAgICByZXF1aXJlKHRva2Vucy5sZW5ndGggPT0gYmFzZUJ1eS5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUodG9rZW5zLmxlbmd0aCA9PSBiYXNlU2VsbC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoc2VsbC5sZW5ndGggPT0gYnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZShzZWxsLmxlbmd0aCA9PSBpbmRpY2VzLmxlbmd0aCk7CgogICAgICAgIGZvciAodWludCBpbmQgPSAwOyBpbmQgPCB0b2tlbnMubGVuZ3RoOyBpbmQrKykgewogICAgICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbnNbaW5kXV0ubGlzdGVkKTsKICAgICAgICAgICAgdG9rZW5EYXRhW3Rva2Vuc1tpbmRdXS5iYXNlQnV5UmF0ZSA9IGJhc2VCdXlbaW5kXTsKICAgICAgICAgICAgdG9rZW5EYXRhW3Rva2Vuc1tpbmRdXS5iYXNlU2VsbFJhdGUgPSBiYXNlU2VsbFtpbmRdOwogICAgICAgIH0KCiAgICAgICAgc2V0Q29tcGFjdERhdGEoYnV5LCBzZWxsLCBibG9ja051bWJlciwgaW5kaWNlcyk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UXR5U3RlcEZ1bmN0aW9uKAogICAgICAgIEVSQzIwIHRva2VuLAogICAgICAgIGludFtdIHhCdXksCiAgICAgICAgaW50W10geUJ1eSwKICAgICAgICBpbnRbXSB4U2VsbCwKICAgICAgICBpbnRbXSB5U2VsbAogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPcGVyYXRvcgogICAgewogICAgICAgIHJlcXVpcmUoeEJ1eS5sZW5ndGggPT0geUJ1eS5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoeFNlbGwubGVuZ3RoID09IHlTZWxsLmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCk7CgogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbiA9IFN0ZXBGdW5jdGlvbih4QnV5LCB5QnV5KTsKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uID0gU3RlcEZ1bmN0aW9uKHhTZWxsLCB5U2VsbCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0SW1iYWxhbmNlU3RlcEZ1bmN0aW9uKAogICAgICAgIEVSQzIwIHRva2VuLAogICAgICAgIGludFtdIHhCdXksCiAgICAgICAgaW50W10geUJ1eSwKICAgICAgICBpbnRbXSB4U2VsbCwKICAgICAgICBpbnRbXSB5U2VsbAogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPcGVyYXRvcgogICAgewogICAgICAgIHJlcXVpcmUoeEJ1eS5sZW5ndGggPT0geUJ1eS5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoeFNlbGwubGVuZ3RoID09IHlTZWxsLmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCk7CgogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbiA9IFN0ZXBGdW5jdGlvbih4QnV5LCB5QnV5KTsKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uID0gU3RlcEZ1bmN0aW9uKHhTZWxsLCB5U2VsbCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsaWRSYXRlRHVyYXRpb25JbkJsb2Nrcyh1aW50IGR1cmF0aW9uKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICB2YWxpZFJhdGVEdXJhdGlvbkluQmxvY2tzID0gZHVyYXRpb247CiAgICB9CgogICAgZnVuY3Rpb24gZW5hYmxlVG9rZW5UcmFkZShFUkMyMCB0b2tlbikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZSh0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5taW5pbWFsUmVjb3JkUmVzb2x1dGlvbiAhPSAwKTsKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmVuYWJsZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpc2FibGVUb2tlblRyYWRlKEVSQzIwIHRva2VuKSBwdWJsaWMgb25seUFsZXJ0ZXIgewogICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uZW5hYmxlZCA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFJlc2VydmVBZGRyZXNzKGFkZHJlc3MgcmVzZXJ2ZSkgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVzZXJ2ZUNvbnRyYWN0ID0gcmVzZXJ2ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWNvcmRJbWJhbGFuY2UoCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50IGJ1eUFtb3VudCwKICAgICAgICB1aW50IHJhdGVVcGRhdGVCbG9jaywKICAgICAgICB1aW50IGN1cnJlbnRCbG9jawogICAgKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSByZXNlcnZlQ29udHJhY3QpOwoKICAgICAgICBpZiAocmF0ZVVwZGF0ZUJsb2NrID09IDApIHJhdGVVcGRhdGVCbG9jayA9IGdldFJhdGVVcGRhdGVCbG9jayh0b2tlbik7CgogICAgICAgIHJldHVybiBhZGRJbWJhbGFuY2UodG9rZW4sIGJ1eUFtb3VudCwgcmF0ZVVwZGF0ZUJsb2NrLCBjdXJyZW50QmxvY2spOwogICAgfQoKICAgIC8qIHNvbGhpbnQtZGlzYWJsZSBmdW5jdGlvbi1tYXgtbGluZXMgKi8KICAgIGZ1bmN0aW9uIGdldFJhdGUoRVJDMjAgdG9rZW4sIHVpbnQgY3VycmVudEJsb2NrTnVtYmVyLCBib29sIGJ1eSwgdWludCBxdHkpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIC8vIGNoZWNrIGlmIHRyYWRlIGlzIGVuYWJsZWQKICAgICAgICBpZiAoIXRva2VuRGF0YVt0b2tlbl0uZW5hYmxlZCkgcmV0dXJuIDA7CiAgICAgICAgaWYgKHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uID09IDApIHJldHVybiAwOyAvLyB0b2tlbiBjb250cm9sIGluZm8gbm90IHNldAoKICAgICAgICAvLyBnZXQgcmF0ZSB1cGRhdGUgYmxvY2sKICAgICAgICBieXRlczMyIGNvbXBhY3REYXRhID0gdG9rZW5SYXRlc0NvbXBhY3REYXRhW3Rva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFBcnJheUluZGV4XTsKCiAgICAgICAgdWludCB1cGRhdGVSYXRlQmxvY2sgPSBnZXRMYXN0NEJ5dGVzKGNvbXBhY3REYXRhKTsKICAgICAgICBpZiAoY3VycmVudEJsb2NrTnVtYmVyID49IHVwZGF0ZVJhdGVCbG9jayArIHZhbGlkUmF0ZUR1cmF0aW9uSW5CbG9ja3MpIHJldHVybiAwOyAvLyByYXRlIGlzIGV4cGlyZWQKICAgICAgICAvLyBjaGVjayBpbWJhbGFuY2UKICAgICAgICBpbnQgdG90YWxJbWJhbGFuY2U7CiAgICAgICAgaW50IGJsb2NrSW1iYWxhbmNlOwogICAgICAgICh0b3RhbEltYmFsYW5jZSwgYmxvY2tJbWJhbGFuY2UpID0gZ2V0SW1iYWxhbmNlKHRva2VuLCB1cGRhdGVSYXRlQmxvY2ssIGN1cnJlbnRCbG9ja051bWJlcik7CgogICAgICAgIC8vIGNhbGN1bGF0ZSBhY3R1YWwgcmF0ZQogICAgICAgIGludCBpbWJhbGFuY2VRdHk7CiAgICAgICAgaW50IGV4dHJhQnBzOwogICAgICAgIGludDggcmF0ZVVwZGF0ZTsKICAgICAgICB1aW50IHJhdGU7CgogICAgICAgIGlmIChidXkpIHsKICAgICAgICAgICAgLy8gc3RhcnQgd2l0aCBiYXNlIHJhdGUKICAgICAgICAgICAgcmF0ZSA9IHRva2VuRGF0YVt0b2tlbl0uYmFzZUJ1eVJhdGU7CgogICAgICAgICAgICAvLyBhZGQgcmF0ZSB1cGRhdGUKICAgICAgICAgICAgcmF0ZVVwZGF0ZSA9IGdldFJhdGVCeXRlRnJvbUNvbXBhY3REYXRhKGNvbXBhY3REYXRhLCB0b2tlbiwgdHJ1ZSk7CiAgICAgICAgICAgIGV4dHJhQnBzID0gaW50KHJhdGVVcGRhdGUpICogMTA7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwoKICAgICAgICAgICAgLy8gY29tcHV0ZSB0b2tlbiBxdHkKICAgICAgICAgICAgcXR5ID0gZ2V0VG9rZW5RdHkodG9rZW4sIHJhdGUsIHF0eSk7CiAgICAgICAgICAgIGltYmFsYW5jZVF0eSA9IGludChxdHkpOwogICAgICAgICAgICB0b3RhbEltYmFsYW5jZSArPSBpbWJhbGFuY2VRdHk7CgogICAgICAgICAgICAvLyBhZGQgcXR5IG92ZXJoZWFkCiAgICAgICAgICAgIGV4dHJhQnBzID0gZXhlY3V0ZVN0ZXBGdW5jdGlvbih0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24sIGludChxdHkpKTsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CgogICAgICAgICAgICAvLyBhZGQgaW1iYWxhbmNlIG92ZXJoZWFkCiAgICAgICAgICAgIGV4dHJhQnBzID0gZXhlY3V0ZVN0ZXBGdW5jdGlvbih0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24sIHRvdGFsSW1iYWxhbmNlKTsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gc3RhcnQgd2l0aCBiYXNlIHJhdGUKICAgICAgICAgICAgcmF0ZSA9IHRva2VuRGF0YVt0b2tlbl0uYmFzZVNlbGxSYXRlOwoKICAgICAgICAgICAgLy8gYWRkIHJhdGUgdXBkYXRlCiAgICAgICAgICAgIHJhdGVVcGRhdGUgPSBnZXRSYXRlQnl0ZUZyb21Db21wYWN0RGF0YShjb21wYWN0RGF0YSwgdG9rZW4sIGZhbHNlKTsKICAgICAgICAgICAgZXh0cmFCcHMgPSBpbnQocmF0ZVVwZGF0ZSkgKiAxMDsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CgogICAgICAgICAgICAvLyBjb21wdXRlIHRva2VuIHF0eQogICAgICAgICAgICBpbWJhbGFuY2VRdHkgPSAtMSAqIGludChxdHkpOwogICAgICAgICAgICB0b3RhbEltYmFsYW5jZSArPSBpbWJhbGFuY2VRdHk7CgogICAgICAgICAgICAvLyBhZGQgcXR5IG92ZXJoZWFkCiAgICAgICAgICAgIGV4dHJhQnBzID0gZXhlY3V0ZVN0ZXBGdW5jdGlvbih0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uLCBpbnQocXR5KSk7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwoKICAgICAgICAgICAgLy8gYWRkIGltYmFsYW5jZSBvdmVyaGVhZAogICAgICAgICAgICBleHRyYUJwcyA9IGV4ZWN1dGVTdGVwRnVuY3Rpb24odG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbiwgdG90YWxJbWJhbGFuY2UpOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKICAgICAgICB9CgogICAgICAgIGlmIChhYnModG90YWxJbWJhbGFuY2UgKyBpbWJhbGFuY2VRdHkpID49IGdldE1heFRvdGFsSW1iYWxhbmNlKHRva2VuKSkgcmV0dXJuIDA7CiAgICAgICAgaWYgKGFicyhibG9ja0ltYmFsYW5jZSArIGltYmFsYW5jZVF0eSkgPj0gZ2V0TWF4UGVyQmxvY2tJbWJhbGFuY2UodG9rZW4pKSByZXR1cm4gMDsKCiAgICAgICAgcmV0dXJuIHJhdGU7CiAgICB9CiAgICAvKiBzb2xoaW50LWVuYWJsZSBmdW5jdGlvbi1tYXgtbGluZXMgKi8KCiAgICBmdW5jdGlvbiBnZXRCYXNpY1JhdGUoRVJDMjAgdG9rZW4sIGJvb2wgYnV5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAoYnV5KQogICAgICAgICAgICByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5iYXNlQnV5UmF0ZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJhc2VTZWxsUmF0ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb21wYWN0RGF0YShFUkMyMCB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50LCB1aW50LCBieXRlLCBieXRlKSB7CiAgICAgICAgcmVxdWlyZSh0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCk7CgogICAgICAgIHVpbnQgYXJyYXlJbmRleCA9IHRva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFBcnJheUluZGV4OwogICAgICAgIHVpbnQgZmllbGRPZmZzZXQgPSB0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhRmllbGRJbmRleDsKCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgYXJyYXlJbmRleCwKICAgICAgICAgICAgZmllbGRPZmZzZXQsCiAgICAgICAgICAgIGJ5dGUoZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEodG9rZW5SYXRlc0NvbXBhY3REYXRhW2FycmF5SW5kZXhdLCB0b2tlbiwgdHJ1ZSkpLAogICAgICAgICAgICBieXRlKGdldFJhdGVCeXRlRnJvbUNvbXBhY3REYXRhKHRva2VuUmF0ZXNDb21wYWN0RGF0YVthcnJheUluZGV4XSwgdG9rZW4sIGZhbHNlKSkKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRva2VuQmFzaWNEYXRhKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wsIGJvb2wpIHsKICAgICAgICByZXR1cm4gKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkLCB0b2tlbkRhdGFbdG9rZW5dLmVuYWJsZWQpOwogICAgfQoKICAgIC8qIHNvbGhpbnQtZGlzYWJsZSBjb2RlLWNvbXBsZXhpdHkgKi8KICAgIGZ1bmN0aW9uIGdldFN0ZXBGdW5jdGlvbkRhdGEoRVJDMjAgdG9rZW4sIHVpbnQgY29tbWFuZCwgdWludCBwYXJhbSkgcHVibGljIHZpZXcgcmV0dXJucyhpbnQpIHsKICAgICAgICBpZiAoY29tbWFuZCA9PSAwKSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbi54Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbi54W3BhcmFtXTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAyKSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbi55Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMykgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbi55W3BhcmFtXTsKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gNCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uLngubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSA1KSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbi54W3BhcmFtXTsKICAgICAgICBpZiAoY29tbWFuZCA9PSA2KSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24ueS5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDcpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uLnlbcGFyYW1dOwoKICAgICAgICBpZiAoY29tbWFuZCA9PSA4KSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi54Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gOSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi54W3BhcmFtXTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueS5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDExKSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnlbcGFyYW1dOwoKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMikgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLngubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMykgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueFtwYXJhbV07CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTQpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi55Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTUpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnlbcGFyYW1dOwoKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIC8qIHNvbGhpbnQtZW5hYmxlIGNvZGUtY29tcGxleGl0eSAqLwoKICAgIGZ1bmN0aW9uIGdldFJhdGVVcGRhdGVCbG9jayhFUkMyMCB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgYnl0ZXMzMiBjb21wYWN0RGF0YSA9IHRva2VuUmF0ZXNDb21wYWN0RGF0YVt0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhQXJyYXlJbmRleF07CiAgICAgICAgcmV0dXJuIGdldExhc3Q0Qnl0ZXMoY29tcGFjdERhdGEpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExpc3RlZFRva2VucygpIHB1YmxpYyB2aWV3IHJldHVybnMoRVJDMjBbXSkgewogICAgICAgIHJldHVybiBsaXN0ZWRUb2tlbnM7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9rZW5RdHkoRVJDMjAgdG9rZW4sIHVpbnQgZXRoUXR5LCB1aW50IHJhdGUpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBkc3REZWNpbWFscyA9IGdldERlY2ltYWxzKHRva2VuKTsKICAgICAgICB1aW50IHNyY0RlY2ltYWxzID0gRVRIX0RFQ0lNQUxTOwoKICAgICAgICByZXR1cm4gY2FsY0RzdFF0eShldGhRdHksIHNyY0RlY2ltYWxzLCBkc3REZWNpbWFscywgcmF0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TGFzdDRCeXRlcyhieXRlczMyIGIpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gY2Fubm90IHRydXN0IGNvbXBpbGVyIHdpdGggbm90IHR1cm5pbmcgYml0IG9wZXJhdGlvbnMgaW50byBFWFAgb3Bjb2RlCiAgICAgICAgcmV0dXJuIHVpbnQoYikgLyAoQllURVNfMTRfT0ZGU0VUICogQllURVNfMTRfT0ZGU0VUKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSYXRlQnl0ZUZyb21Db21wYWN0RGF0YShieXRlczMyIGRhdGEsIEVSQzIwIHRva2VuLCBib29sIGJ1eSkgaW50ZXJuYWwgdmlldyByZXR1cm5zKGludDgpIHsKICAgICAgICB1aW50IGZpZWxkT2Zmc2V0ID0gdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUZpZWxkSW5kZXg7CiAgICAgICAgdWludCBieXRlT2Zmc2V0OwogICAgICAgIGlmIChidXkpCiAgICAgICAgICAgIGJ5dGVPZmZzZXQgPSAzMiAtIE5VTV9UT0tFTlNfSU5fQ09NUEFDVF9EQVRBICsgZmllbGRPZmZzZXQ7CiAgICAgICAgZWxzZQogICAgICAgICAgICBieXRlT2Zmc2V0ID0gNCArIGZpZWxkT2Zmc2V0OwoKICAgICAgICByZXR1cm4gaW50OChkYXRhW2J5dGVPZmZzZXRdKTsKICAgIH0KCiAgICBmdW5jdGlvbiBleGVjdXRlU3RlcEZ1bmN0aW9uKFN0ZXBGdW5jdGlvbiBmLCBpbnQgeCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKGludCkgewogICAgICAgIHVpbnQgbGVuID0gZi55Lmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaW5kID0gMDsgaW5kIDwgbGVuOyBpbmQrKykgewogICAgICAgICAgICBpZiAoeCA8PSBmLnhbaW5kXSkgcmV0dXJuIGYueVtpbmRdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGYueVtsZW4tMV07CiAgICB9CgogICAgZnVuY3Rpb24gYWRkQnBzKHVpbnQgcmF0ZSwgaW50IGJwcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IG1heEJwcyA9IDEwMCAqIDEwMDsKICAgICAgICByZXR1cm4gKHJhdGUgKiB1aW50KGludChtYXhCcHMpICsgYnBzKSkgLyBtYXhCcHM7CiAgICB9CgogICAgZnVuY3Rpb24gYWJzKGludCB4KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIGlmICh4IDwgMCkKICAgICAgICAgICAgcmV0dXJuIHVpbnQoLTEgKiB4KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB1aW50KHgpOwogICAgfQp9'.
	

]
