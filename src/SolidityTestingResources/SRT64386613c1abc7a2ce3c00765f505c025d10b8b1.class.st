Class {
	#name : #SRT64386613c1abc7a2ce3c00765f505c025d10b8b1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT64386613c1abc7a2ce3c00765f505c025d10b8b1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMAogKiBAZGV2IEVSQzIwIGludGVyZmFjZQogKi8KY29udHJhY3QgRVJDMjAgewogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCgoKCgoKY29udHJhY3QgQ29udHJvbGxlZCB7CiAgICAvLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJvbGxlciBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwKICAgIC8vLyAgYSBmdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyb2xsZXIpOyBfOyB9CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgcHVibGljIHsgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQoKICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9uZXdDb250cm9sbGVyIFRoZSBuZXcgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgTWluaU1lIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwTWluaU1lIGlzIEVSQzIwLCBDb250cm9sbGVkIHsKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXQodWludCBfYmxvY2tOdW1iZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbihzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLCB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsIHN0cmluZyBfY2xvbmVUb2tlblN5bWJvbCwgdWludCBfc25hcHNob3RCbG9jaywgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgcHVibGljIHJldHVybnMoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQpICBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgcHVibGljOwogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYzsKICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50IF9hbW91bnQpOwogICAgZXZlbnQgTmV3Q2xvbmVUb2tlbihhZGRyZXNzIGluZGV4ZWQgX2Nsb25lVG9rZW4sIHVpbnQgX3NuYXBzaG90QmxvY2spOwp9CgoKCgoKCgoKLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUKICogQGRldiBDcm93ZHNhbGUgaXMgYSBiYXNlIGNvbnRyYWN0IGZvciBtYW5hZ2luZyBhIHRva2VuIGNyb3dkc2FsZS4KICogQ3Jvd2RzYWxlcyBoYXZlIGEgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzLCB3aGVyZSBpbnZlc3RvcnMgY2FuIG1ha2UKICogdG9rZW4gcHVyY2hhc2VzIGFuZCB0aGUgY3Jvd2RzYWxlIHdpbGwgYXNzaWduIHRoZW0gdG9rZW5zIGJhc2VkCiAqIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAogKiBhcyB0aGV5IGFycml2ZS4KICovCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgRVJDMjBNaW5pTWUgcHVibGljIHRva2VuOwoKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogIC8vIGhvdyBtYW55IHRva2VuIHVuaXRzIGEgYnV5ZXIgZ2V0cyBwZXIgd2VpCiAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfcmF0ZSwgYWRkcmVzcyBfd2FsbGV0KSB7CiAgICByZXF1aXJlKF9zdGFydFRpbWUgPj0gbm93KTsKICAgIHJlcXVpcmUoX2VuZFRpbWUgPj0gX3N0YXJ0VGltZSk7CiAgICByZXF1aXJlKF9yYXRlID4gMCk7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKCiAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgZW5kVGltZSA9IF9lbmRUaW1lOwogICAgcmF0ZSA9IF9yYXRlOwogICAgd2FsbGV0ID0gX3dhbGxldDsKICB9CgoKICAvLyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zCiAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICBidXlUb2tlbnMobXNnLnNlbmRlcik7CiAgfQoKICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgYnV5VG9rZW5zKGJlbmVmaWNpYXJ5LCBtc2cudmFsdWUpOwogIH0KCiAgLy8gaW1wbGVtZW50YXRpb24gb2YgbG93IGxldmVsIHRva2VuIHB1cmNoYXNlIGZ1bmN0aW9uCiAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnksIHVpbnQyNTYgd2VpQW1vdW50KSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IDB4MCk7CiAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2Uod2VpQW1vdW50KSk7CgogICAgdHJhbnNmZXJUb2tlbihiZW5lZmljaWFyeSwgd2VpQW1vdW50KTsKCiAgICAvLyB1cGRhdGUgc3RhdGUKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICBmb3J3YXJkRnVuZHMod2VpQW1vdW50KTsKICB9CgogIC8vIGxvdyBsZXZlbCB0cmFuc2ZlciB0b2tlbgogIC8vIG92ZXJyaWRlIHRvIGNyZWF0ZSBjdXN0b20gdG9rZW4gdHJhbnNmZXIgbWVjaGFuaXNtLCBlZy4gcHVsbCBwYXR0ZXJuCiAgZnVuY3Rpb24gdHJhbnNmZXJUb2tlbihhZGRyZXNzIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHdlaUFtb3VudCkgaW50ZXJuYWwgewogICAgLy8gY2FsY3VsYXRlIHRva2VuIGFtb3VudCB0byBiZSBjcmVhdGVkCiAgICB1aW50MjU2IHRva2VucyA9IHdlaUFtb3VudC5tdWwocmF0ZSk7CgogICAgdG9rZW4uZ2VuZXJhdGVUb2tlbnMoYmVuZWZpY2lhcnksIHRva2Vucyk7CgogICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwogIH0KCiAgLy8gc2VuZCBldGhlciB0byB0aGUgZnVuZCBjb2xsZWN0aW9uIHdhbGxldAogIC8vIG92ZXJyaWRlIHRvIGNyZWF0ZSBjdXN0b20gZnVuZCBmb3J3YXJkaW5nIG1lY2hhbmlzbXMKICBmdW5jdGlvbiBmb3J3YXJkRnVuZHModWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHsKICAgIHdhbGxldC50cmFuc2Zlcih3ZWlBbW91bnQpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UodWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gd2VpQW1vdW50ICE9IDA7CiAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGhhcyBzdGFydGVkCiAgZnVuY3Rpb24gaGFzU3RhcnRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbm93ID49IHN0YXJ0VGltZTsKICB9Cn0KCi8qKgogKiBAdGl0bGUgQ2FwcGVkQ3Jvd2RzYWxlCiAqIEBkZXYgRXh0ZW5zaW9uIG9mIENyb3dkc2FsZSB3aXRoIGEgbWF4IGFtb3VudCBvZiBmdW5kcyByYWlzZWQKICovCmNvbnRyYWN0IENhcHBlZENyb3dkc2FsZSBpcyBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICB1aW50MjU2IHB1YmxpYyBjYXA7CgogIGZ1bmN0aW9uIENhcHBlZENyb3dkc2FsZSh1aW50MjU2IF9jYXApIHsKICAgIHJlcXVpcmUoX2NhcCA+IDApOwogICAgY2FwID0gX2NhcDsKICB9CgogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gYWRkIGV4dHJhIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBpbnZlc3RvcnMgY2FuIGJ1eSBhdCB0aGUgbW9tZW50CiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSh1aW50MjU2IHdlaUFtb3VudCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnZhbGlkUHVyY2hhc2Uod2VpQW1vdW50KSAmJiAhY2FwUmVhY2hlZCgpOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLmhhc0VuZGVkKCkgfHwgY2FwUmVhY2hlZCgpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIGNhcCBoYXMgYmVlbiByZWFjaGVkCiAgZnVuY3Rpb24gY2FwUmVhY2hlZCgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBjYXA7CiAgfQoKICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSNidXlUb2tlbnMgdG8gYWRkIHBhcnRpYWwgcmVmdW5kIGxvZ2ljCiAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHsKICAgICB1aW50MjU2IHdlaVRvQ2FwID0gY2FwLnN1Yih3ZWlSYWlzZWQpOwogICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gd2VpVG9DYXAgPCBtc2cudmFsdWUgPyB3ZWlUb0NhcCA6IG1zZy52YWx1ZTsKCiAgICAgYnV5VG9rZW5zKGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQpOwoKICAgICB1aW50MjU2IHJlZnVuZCA9IG1zZy52YWx1ZS5zdWIod2VpQW1vdW50KTsKICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihyZWZ1bmQpOwogICAgIH0KICAgfQp9CgoKCgovLy8gQGRldiBUaGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCBtdXN0IGltcGxlbWVudCB0aGVzZSBmdW5jdGlvbnMKY29udHJhY3QgVG9rZW5Db250cm9sbGVyIHsKICAgIEVSQzIwTWluaU1lIHB1YmxpYyBldGhlYWxUb2tlbjsKICAgIGFkZHJlc3MgcHVibGljIFNBTEU7IC8vIGFkZHJlc3Mgd2hlcmUgc2FsZSB0b2tlbnMgYXJlIGxvY2F0ZWQKCiAgICAvLy8gQG5vdGljZSBuZWVkZWQgZm9yIGhvZGxlciBoYW5kbGluZwogICAgZnVuY3Rpb24gYWRkSG9kbGVyU3Rha2UoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3N0YWtlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBzZXRIb2RsZXJTdGFrZShhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfc3Rha2UpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHNldEhvZGxlclRpbWUodWludDI1NiBfdGltZSkgcHVibGljOwoKCiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcHVibGljIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBzcGVuZGVyIGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wpOwp9CgoKCgoKCi8qKgogKiBAdGl0bGUgRmluYWxpemFibGVDcm93ZHNhbGUKICogQGRldiBFeHRlbnNpb24gb2YgQ3Jvd2RzYWxlIHdoZXJlIGFuIG93bmVyIGNhbiBkbyBleHRyYSB3b3JrCiAqIGFmdGVyIGZpbmlzaGluZy4KICovCmNvbnRyYWN0IEZpbmFsaXphYmxlQ3Jvd2RzYWxlIGlzIENyb3dkc2FsZSwgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CgogIGV2ZW50IEZpbmFsaXplZCgpOwoKICAvKioKICAgKiBAZGV2IE11c3QgYmUgY2FsbGVkIGFmdGVyIGNyb3dkc2FsZSBlbmRzLCB0byBkbyBzb21lIGV4dHJhIGZpbmFsaXphdGlvbgogICAqIHdvcmsuIENhbGxzIHRoZSBjb250cmFjdCdzIGZpbmFsaXphdGlvbiBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZShoYXNFbmRlZCgpKTsKCiAgICBmaW5hbGl6YXRpb24oKTsKICAgIEZpbmFsaXplZCgpOwoKICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FuIGJlIG92ZXJyaWRkZW4gdG8gYWRkIGZpbmFsaXphdGlvbiBsb2dpYy4gVGhlIG92ZXJyaWRpbmcgZnVuY3Rpb24KICAgKiBzaG91bGQgY2FsbCBzdXBlci5maW5hbGl6YXRpb24oKSB0byBlbnN1cmUgdGhlIGNoYWluIG9mIGZpbmFsaXphdGlvbiBpcwogICAqIGV4ZWN1dGVkIGVudGlyZWx5LgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICB9Cn0KCgoKCgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgoKCgoKCi8qKgogKiBAdGl0bGUgRWxpcHRpYyBjdXJ2ZSBzaWduYXR1cmUgb3BlcmF0aW9ucwogKgogKiBAZGV2IEJhc2VkIG9uIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2F4aWMvNWIzMzkxMmM2ZjYxYWU2ZmQ5NmQ2YzRhNDdhZmRlNmQKICovCgpsaWJyYXJ5IEVDUmVjb3ZlcnkgewoKICAvKioKICAgKiBAZGV2IFJlY292ZXIgc2lnbmVyIGFkZHJlc3MgZnJvbSBhIG1lc3NhZ2UgYnkgdXNpbmcgaGlzIHNpZ25hdHVyZQogICAqIEBwYXJhbSBoYXNoIGJ5dGVzMzIgbWVzc2FnZSwgdGhlIGhhc2ggaXMgdGhlIHNpZ25lZCBtZXNzYWdlLiBXaGF0IGlzIHJlY292ZXJlZCBpcyB0aGUgc2lnbmVyIGFkZHJlc3MuCiAgICogQHBhcmFtIHNpZyBieXRlcyBzaWduYXR1cmUsIHRoZSBzaWduYXR1cmUgaXMgZ2VuZXJhdGVkIHVzaW5nIHdlYjMuZXRoLnNpZ24oKQogICAqLwogIGZ1bmN0aW9uIHJlY292ZXIoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIHB1YmxpYyBwdXJlIHJldHVybnMgKGFkZHJlc3MpIHsKICAgIGJ5dGVzMzIgcjsKICAgIGJ5dGVzMzIgczsKICAgIHVpbnQ4IHY7CgogICAgLy9DaGVjayB0aGUgc2lnbmF0dXJlIGxlbmd0aAogICAgaWYgKHNpZy5sZW5ndGggIT0gNjUpIHsKICAgICAgcmV0dXJuIChhZGRyZXNzKDApKTsKICAgIH0KCiAgICAvLyBEaXZpZGUgdGhlIHNpZ25hdHVyZSBpbiByLCBzIGFuZCB2IHZhcmlhYmxlcwogICAgYXNzZW1ibHkgewogICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCiAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQogICAgfQoKICAgIC8vIFZlcnNpb24gb2Ygc2lnbmF0dXJlIHNob3VsZCBiZSAyNyBvciAyOCwgYnV0IDAgYW5kIDEgYXJlIGFsc28gcG9zc2libGUgdmVyc2lvbnMKICAgIGlmICh2IDwgMjcpIHsKICAgICAgdiArPSAyNzsKICAgIH0KCiAgICAvLyBJZiB0aGUgdmVyc2lvbiBpcyBjb3JyZWN0IHJldHVybiB0aGUgc2lnbmVyIGFkZHJlc3MKICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpIHsKICAgICAgcmV0dXJuIChhZGRyZXNzKDApKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBlY3JlY292ZXIoaGFzaCwgdiwgciwgcyk7CiAgICB9CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFdGhlYWxXaGl0ZWxpc3QKICogQGF1dGhvciB0aGVzdmVkCiAqIEBub3RpY2UgRXRoZWFsV2hpdGVsaXN0IGNvbnRyYWN0IHdoaWNoIGhhbmRsZXMgS1lDCiAqLwpjb250cmFjdCBFdGhlYWxXaGl0ZWxpc3QgaXMgT3duYWJsZSB7CiAgICB1c2luZyBFQ1JlY292ZXJ5IGZvciBieXRlczMyOwoKICAgIC8vIHNpZ25lciBhZGRyZXNzIGZvciBvZmZjaGFpbiB3aGl0ZWxpc3Qgc2lnbmluZwogICAgYWRkcmVzcyBwdWJsaWMgc2lnbmVyOwoKICAgIC8vIHN0b3Jpbmcgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGlzV2hpdGVsaXN0ZWQ7CgogICAgZXZlbnQgV2hpdGVsaXN0U2V0KGFkZHJlc3MgaW5kZXhlZCBfYWRkcmVzcywgYm9vbCBfc3RhdGUpOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbnN0cnVjdG9yCiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICBmdW5jdGlvbiBFdGhlYWxXaGl0ZWxpc3QoYWRkcmVzcyBfc2lnbmVyKSB7CiAgICAgICAgcmVxdWlyZShfc2lnbmVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBzaWduZXIgPSBfc2lnbmVyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHNldCBzaWduaW5nIGFkZHJlc3MgYWZ0ZXIgZGVwbG95bWVudAogICAgZnVuY3Rpb24gc2V0U2lnbmVyKGFkZHJlc3MgX3NpZ25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfc2lnbmVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBzaWduZXIgPSBfc2lnbmVyOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFdoaXRlbGlzdGluZzogb25seSBvd25lcgogICAgLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyYjMTYwO0Bub3RpY2UgU2V0IHdoaXRlbGlzdCBzdGF0ZSBmb3IgYW4gYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHNldFdoaXRlbGlzdChhZGRyZXNzIF9hZGRyLCBib29sIF9zdGF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfYWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBpc1doaXRlbGlzdGVkW19hZGRyXSA9IF9zdGF0ZTsKICAgICAgICBXaGl0ZWxpc3RTZXQoX2FkZHIsIF9zdGF0ZSk7CiAgICB9CgogICAgLy8vJiMxNjA7QG5vdGljZSBTZXQgd2hpdGVsaXN0IHN0YXRlIGZvciBtdWx0aXBsZSBhZGRyZXNzZXMKICAgIGZ1bmN0aW9uIHNldE1hbnlXaGl0ZWxpc3QoYWRkcmVzc1tdIF9hZGRyLCBib29sIF9zdGF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2FkZHIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc2V0V2hpdGVsaXN0KF9hZGRyW2ldLCBfc3RhdGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBvZmZjaGFpbiB3aGl0ZWxpc3QgY2hlY2sKICAgIGZ1bmN0aW9uIGlzT2ZmY2hhaW5XaGl0ZWxpc3RlZChhZGRyZXNzIF9hZGRyLCBieXRlcyBfc2lnKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYnl0ZXMzMiBoYXNoID0ga2VjY2FrMjU2KCJceDE5RXRoZXJldW0gU2lnbmVkIE1lc3NhZ2U6XG4yMCIsX2FkZHIpOwogICAgICAgIHJldHVybiBoYXNoLnJlY292ZXIoX3NpZykgPT0gc2lnbmVyOwogICAgfQp9CgovKioKICogQHRpdGxlIEV0aGVhbE5vcm1hbFNhbGUKICogQGF1dGhvciB0aGVzdmVkCiAqIEBub3RpY2UgRXRoZWFsIFRva2VuIFNhbGUgY29udHJhY3QsIHdpdGggc29mdGNhcCBhbmQgaGFyZGNhcCAoY2FwKQogKiBAZGV2IFRoaXMgY29udHJhY3QgaGFzIHRvIGJlIGZpbmFsaXplZCBiZWZvcmUgdG9rZW4gY2xhaW1zIGFyZSBlbmFibGVkCiAqLwpjb250cmFjdCBFdGhlYWxOb3JtYWxTYWxlIGlzIFBhdXNhYmxlLCBGaW5hbGl6YWJsZUNyb3dkc2FsZSwgQ2FwcGVkQ3Jvd2RzYWxlIHsKICAgIC8vIHRoZSB0b2tlbiBpcyBoZXJlCiAgICBUb2tlbkNvbnRyb2xsZXIgcHVibGljIGV0aGVhbENvbnRyb2xsZXI7CgogICAgLy8gYWZ0ZXIgcmVhY2hpbmcge3dlaVJhaXNlZH0gPj0ge3NvZnRDYXB9LCB0aGVyZSBpcyB7c29mdENhcFRpbWV9IHNlY29uZHMgdW50aWwgdGhlIHNhbGUgY2xvc2VzCiAgICAvLyB7c29mdENhcENsb3NlfSBjb250YWlucyB0aGUgY2xvc2luZyB0aW1lCiAgICB1aW50MjU2IHB1YmxpYyByYXRlID0gNzAwOwogICAgdWludDI1NiBwdWJsaWMgc29mdENhcCA9IDY4MDAgZXRoZXI7CiAgICB1aW50MjU2IHB1YmxpYyBzb2Z0Q2FwVGltZSA9IDEyMCBob3VyczsKICAgIHVpbnQyNTYgcHVibGljIHNvZnRDYXBDbG9zZTsKICAgIHVpbnQyNTYgcHVibGljIGNhcCA9IDE0MzAwIGV0aGVyOwoKICAgIC8vIGhvdyBtYW55IHRva2VuIGlzIHNvbGQgYW5kIG5vdCBjbGFpbWVkLCB1c2VkIGZvciByZWZ1bmRpbmcgdG8gdG9rZW4gY29udHJvbGxlcgogICAgdWludDI1NiBwdWJsaWMgdG9rZW5CYWxhbmNlOwoKICAgIC8vIHRvdGFsIHRva2VuIHNvbGQKICAgIHVpbnQyNTYgcHVibGljIHRva2VuU29sZDsKCiAgICAvLyBtaW5pbXVtIGNvbnRyaWJ1dGlvbiwgMC4xRVRICiAgICB1aW50MjU2IHB1YmxpYyBtaW5Db250cmlidXRpb24gPSAwLjEgZXRoZXI7CgogICAgLy8gd2hpdGVsaXN0OiBhYm92ZSB0aHJlc2hvbGQgdGhlIGNvbnRyYWN0IGhhcyB0byBhcHByb3ZlIGVhY2ggdHJhbnNhY3Rpb24KICAgIEV0aGVhbFdoaXRlbGlzdCBwdWJsaWMgd2hpdGVsaXN0OwogICAgdWludDI1NiBwdWJsaWMgd2hpdGVsaXN0VGhyZXNob2xkID0gMSBldGhlcjsKCiAgICAvLyBkZXBvc2l0IGFkZHJlc3MgZnJvbSB3aGljaCBpdCBjYW4gZ2V0IGZ1bmRzIGJlZm9yZSBzYWxlCiAgICBhZGRyZXNzIHB1YmxpYyBkZXBvc2l0OwogICAgCiAgICAvLyBzdGFrZXMgY29udGFpbnMgdG9rZW4gYm91Z2h0IGFuZCBjb250aXJidXRpb25zIGNvbnRhaW5zIHRoZSB2YWx1ZSBpbiB3ZWkKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHN0YWtlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNvbnRyaWJ1dGlvbnM7CgogICAgLy8gcHJvbW8gdG9rZW4gYm9udXMKICAgIGFkZHJlc3MgcHVibGljIHByb21vVG9rZW5Db250cm9sbGVyOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYm9udXNFeHRyYTsKCiAgICAvLyBhZGRyZXNzZXMgb2YgY29udHJpYnV0b3JzIHRvIGhhbmRsZSBmaW5hbGl6YXRpb24gYWZ0ZXIgdG9rZW4gc2FsZSBlbmQgKHJlZnVuZHMgb3IgdG9rZW4gY2xhaW1zKQogICAgYWRkcmVzc1tdIHB1YmxpYyBjb250cmlidXRvcnNLZXlzOyAKCiAgICAvLyBldmVudHMgZm9yIHRva2VuIHB1cmNoYXNlIGR1cmluZyBzYWxlIGFuZCBjbGFpbWluZyB0b2tlbnMgYWZ0ZXIgc2FsZQogICAgZXZlbnQgTG9nVG9rZW5DbGFpbWVkKGFkZHJlc3MgaW5kZXhlZCBfY2xhaW1lciwgYWRkcmVzcyBpbmRleGVkIF9iZW5lZmljaWFyeSwgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IExvZ1Rva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIF9wdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3ZhbHVlLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX3BhcnRpY2lwYW50cywgdWludDI1NiBfd2VpUmFpc2VkKTsKICAgIGV2ZW50IExvZ1Rva2VuU29mdENhcFJlYWNoZWQodWludDI1NiBfY2xvc2VUaW1lKTsKICAgIGV2ZW50IExvZ1Rva2VuSGFyZENhcFJlYWNoZWQoKTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25zdHJ1Y3RvciBhbmQgaW5oZXJpdGVkIGZ1bmN0aW9uIG92ZXJyaWRlcwogICAgLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBQcmVTYWxlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9ldGhlYWxDb250cm9sbGVyIEFkZHJlc3Mgb2YgZXRoZWFsQ29udHJvbGxlcgogICAgLy8vIEBwYXJhbSBfc3RhcnRUaW1lIFRoZSBzdGFydCB0aW1lIG9mIHRva2VuIHNhbGUgaW4gc2Vjb25kcy4KICAgIC8vLyBAcGFyYW0gX2VuZFRpbWUgVGhlIGVuZCB0aW1lIG9mIHRva2VuIHNhbGUgaW4gc2Vjb25kcy4KICAgIC8vLyBAcGFyYW0gX21pbkNvbnRyaWJ1dGlvbiBUaGUgbWluaW11bSBjb250cmlidXRpb24gcGVyIHRyYW5zYWN0aW9uIGluIHdlaSAoMC4xIEVUSCkKICAgIC8vLyBAcGFyYW0gX3JhdGUgTnVtYmVyIG9mIEhFQUwgdG9rZW5zIHBlciAxIEVUSAogICAgLy8vIEBwYXJhbSBfc29mdENhcCBTb2Z0Y2FwIGluIHdlaSwgcmVhY2hpbmcgaXQgZW5kcyB0aGUgc2FsZSBpbiBfc29mdENhcFRpbWUgc2Vjb25kcwogICAgLy8vIEBwYXJhbSBfc29mdENhcFRpbWUgU2Vjb25kcyB1bnRpbCB0aGUgc2FsZSByZW1haW5zIG9wZW4gYWZ0ZXIgcmVhY2hpbmcgX3NvZnRDYXAKICAgIC8vLyBAcGFyYW0gX2NhcCBNYXhpbXVtIGNhcCBpbiB3ZWksIHdlIGNhbid0IHJhaXNlIG1vcmUgZnVuZHMKICAgIC8vLyBAcGFyYW0gX3dhbGxldCBBZGRyZXNzIG9mIG11bHRpc2lnIHdhbGxldCwgd2hpY2ggd2lsbCBnZXQgYWxsIHRoZSBmdW5kcyBhZnRlciBzdWNjZXNzZnVsIHNhbGUKICAgIGZ1bmN0aW9uIEV0aGVhbE5vcm1hbFNhbGUoCiAgICAgICAgYWRkcmVzcyBfZXRoZWFsQ29udHJvbGxlciwKICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUsIAogICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsIAogICAgICAgIHVpbnQyNTYgX21pbkNvbnRyaWJ1dGlvbiwgCiAgICAgICAgdWludDI1NiBfcmF0ZSwgCiAgICAgICAgdWludDI1NiBfc29mdENhcCwgCiAgICAgICAgdWludDI1NiBfc29mdENhcFRpbWUsIAogICAgICAgIHVpbnQyNTYgX2NhcCwgCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0CiAgICApCiAgICAgICAgQ2FwcGVkQ3Jvd2RzYWxlKF9jYXApCiAgICAgICAgRmluYWxpemFibGVDcm93ZHNhbGUoKQogICAgICAgIENyb3dkc2FsZShfc3RhcnRUaW1lLCBfZW5kVGltZSwgX3JhdGUsIF93YWxsZXQpCiAgICB7CiAgICAgICAgLy8gZXRoZWFsQ29udHJvbGxlciBtdXN0IGJlIHZhbGlkCiAgICAgICAgcmVxdWlyZShfZXRoZWFsQ29udHJvbGxlciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBldGhlYWxDb250cm9sbGVyID0gVG9rZW5Db250cm9sbGVyKF9ldGhlYWxDb250cm9sbGVyKTsKCiAgICAgICAgLy8gY2FwcyBoYXZlIHRvIGJlIGNvbnNpc3RlbnQgd2l0aCBlYWNoIG90aGVyCiAgICAgICAgcmVxdWlyZShfc29mdENhcCA8PSBfY2FwKTsKICAgICAgICBzb2Z0Q2FwID0gX3NvZnRDYXA7CiAgICAgICAgc29mdENhcFRpbWUgPSBfc29mdENhcFRpbWU7CgogICAgICAgIC8vIHRoaXMgaXMgbmVlZGVkIHNpbmNlIHN1cGVyIGNvbnN0cnVjdG9yIHdvbnQgb3ZlcndpdGUgb3ZlcnJpZGVuIHZhcmlhYmxlcwogICAgICAgIGNhcCA9IF9jYXA7CiAgICAgICAgcmF0ZSA9IF9yYXRlOwoKICAgICAgICBtaW5Db250cmlidXRpb24gPSBfbWluQ29udHJpYnV0aW9uOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEFkbWluaXN0ZXIgY29udHJhY3QgZGV0YWlscwogICAgLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNldHMgbWluIGNvbnRyaWJ1dGlvbgogICAgZnVuY3Rpb24gc2V0TWluQ29udHJpYnV0aW9uKHVpbnQyNTYgX21pbkNvbnRyaWJ1dGlvbikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgbWluQ29udHJpYnV0aW9uID0gX21pbkNvbnRyaWJ1dGlvbjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXRzIHNvZnQgY2FwIGFuZCBtYXggY2FwCiAgICBmdW5jdGlvbiBzZXRDYXBzKHVpbnQyNTYgX3NvZnRDYXAsIHVpbnQyNTYgX3NvZnRDYXBUaW1lLCB1aW50MjU2IF9jYXApIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3NvZnRDYXAgPD0gX2NhcCk7CiAgICAgICAgc29mdENhcCA9IF9zb2Z0Q2FwOwogICAgICAgIHNvZnRDYXBUaW1lID0gX3NvZnRDYXBUaW1lOwogICAgICAgIGNhcCA9IF9jYXA7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0cyBjcm93ZHNhbGUgc3RhcnQgYW5kIGVuZCB0aW1lCiAgICBmdW5jdGlvbiBzZXRUaW1lcyh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA8PSBfZW5kVGltZSk7CiAgICAgICAgcmVxdWlyZSghaGFzRW5kZWQoKSk7CiAgICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgICAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0IHJhdGUKICAgIGZ1bmN0aW9uIHNldFJhdGUodWludDI1NiBfcmF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfcmF0ZSA+IDApOwogICAgICAgIHJhdGUgPSBfcmF0ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgYWRkcmVzcyBvZiBwcm9tbyB0b2tlbgogICAgZnVuY3Rpb24gc2V0UHJvbW9Ub2tlbkNvbnRyb2xsZXIoYWRkcmVzcyBfYWRkcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfYWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBwcm9tb1Rva2VuQ29udHJvbGxlciA9IF9hZGRyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCB3aGl0ZWxpc3QgY29udHJhY3QgYWRkcmVzcyBhbmQgbWluaW11bSB0aHJlc2hvbGQKICAgIGZ1bmN0aW9uIHNldFdoaXRlbGlzdChhZGRyZXNzIF93aGl0ZWxpc3QsIHVpbnQyNTYgX3RocmVzaG9sZCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgLy8gaWYgd2hpdGVsaXN0IGNvbnRyYWN0IGFkZHJlc3MgaXMgcHJvdmlkZWQgd2Ugc2V0IGl0CiAgICAgICAgaWYgKF93aGl0ZWxpc3QgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICB3aGl0ZWxpc3QgPSBFdGhlYWxXaGl0ZWxpc3QoX3doaXRlbGlzdCk7CiAgICAgICAgfQogICAgICAgIHdoaXRlbGlzdFRocmVzaG9sZCA9IF90aHJlc2hvbGQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0IGRlcG9zaXQgY29udHJhY3QgYWRkcmVzcyBmcm9tIHdoaWNoIGl0IGNhbiByZWNlaXZlIG1vbmV5IGJlZm9yZSBzYWxlCiAgICBmdW5jdGlvbiBzZXREZXBvc2l0KGFkZHJlc3MgX2RlcG9zaXQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGRlcG9zaXQgPSBfZGVwb3NpdDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBtb3ZlIGV4Y2VzcyB0b2tlbnMsIGVnIHRvIGhvZGxlci9zYWxlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBtb3ZlVG9rZW5zKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA8PSBnZXRIZWFsQmFsYW5jZSgpLnN1Yih0b2tlbkJhbGFuY2UpKTsKICAgICAgICByZXF1aXJlKGV0aGVhbENvbnRyb2xsZXIuZXRoZWFsVG9rZW4oKS50cmFuc2ZlcihfdG8sIF9hbW91bnQpKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdXJjaGFzZSBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBPdmVycmlkaW5nIENyb3dkc2FsZSNidXlUb2tlbnMgdG8gYWRkIHBhcnRpYWwgcmVmdW5kCiAgICAvLy8gQHBhcmFtIF9iZW5lZmljaWFyeSBCZW5lZmljaWFyeSBvZiB0aGUgdG9rZW4gcHVyY2hhc2UKICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIF9iZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgaGFuZGxlUGF5bWVudChfYmVuZWZpY2lhcnksIG1zZy52YWx1ZSwgbm93LCAiIik7CiAgICB9CgogICAgLy8vIEBkZXYgYnV5aW5nIHRva2VucyBmb3Igc29tZW9uZSB3aXRoIG9mZmNoYWluIHdoaXRlbGlzdCBzaWduYXR1cmUKICAgIGZ1bmN0aW9uIGJ1eVRva2Vuc1NpZ25lZChhZGRyZXNzIF9iZW5lZmljaWFyeSwgYnl0ZXMgX3doaXRlbGlzdFNpZ24pIHB1YmxpYyBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIGhhbmRsZVBheW1lbnQoX2JlbmVmaWNpYXJ5LCBtc2cudmFsdWUsIG5vdywgX3doaXRlbGlzdFNpZ24pOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIGZvciBoYW5kbGluZyB0cmFuc2FjdGlvbnMgd2l0aCBldGhlci4KICAgIGZ1bmN0aW9uIGhhbmRsZVBheW1lbnQoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfdGltZSwgYnl0ZXMgbWVtb3J5IF93aGl0ZWxpc3RTaWduKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gaGFuZGxlQ29udHJpYnV0aW9uKF9iZW5lZmljaWFyeSwgX2Ftb3VudCwgX3RpbWUsIF93aGl0ZWxpc3RTaWduKTsgICAgICAKICAgICAgICBmb3J3YXJkRnVuZHMod2VpQW1vdW50KTsgIAoKICAgICAgICAvLyBoYW5kbGUgcmVmdW5kIGV4Y2VzcyB0b2tlbnMKICAgICAgICB1aW50MjU2IHJlZnVuZCA9IF9hbW91bnQuc3ViKHdlaUFtb3VudCk7CiAgICAgICAgaWYgKHJlZnVuZCA+IDApIHsKICAgICAgICAgICAgX2JlbmVmaWNpYXJ5LnRyYW5zZmVyKHJlZnVuZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEhhbmRsaW5nIHRoZSBhbW91bnQgb2YgY29udHJpYnV0aW9uIGFuZCBjYXAgbG9naWMuIEludGVybmFsIGZ1bmN0aW9uLgogICAgLy8vIEByZXR1cm4gV2VpIHN1Y2Nlc3NmdWxseSBjb250cmlidXRlZC4KICAgIGZ1bmN0aW9uIGhhbmRsZUNvbnRyaWJ1dGlvbihhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF90aW1lLCBieXRlcyBtZW1vcnkgX3doaXRlbGlzdFNpZ24pIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9iZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiB3ZWlUb0NhcCA9IGhvd011Y2hDYW5YQ29udHJpYnV0ZU5vdyhfYmVuZWZpY2lhcnkpOwogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gdWludDI1Nk1pbih3ZWlUb0NhcCwgX2Ftb3VudCk7CgogICAgICAgIC8vIGFjY291bnQgdGhlIG5ldyBjb250cmlidXRpb24KICAgICAgICB0cmFuc2ZlclRva2VuKF9iZW5lZmljaWFyeSwgd2VpQW1vdW50LCBfdGltZSwgX3doaXRlbGlzdFNpZ24pOwoKICAgICAgICAvLyBjbG9zZSBzYWxlIGluIHNvZnRDYXBUaW1lIHNlY29uZHMgYWZ0ZXIgcmVhY2hpbmcgc29mdENhcAogICAgICAgIGlmICh3ZWlSYWlzZWQgPj0gc29mdENhcCAmJiBzb2Z0Q2FwQ2xvc2UgPT0gMCkgewogICAgICAgICAgICBzb2Z0Q2FwQ2xvc2UgPSBub3cuYWRkKHNvZnRDYXBUaW1lKTsKICAgICAgICAgICAgTG9nVG9rZW5Tb2Z0Q2FwUmVhY2hlZCh1aW50MjU2TWluKHNvZnRDYXBDbG9zZSwgZW5kVGltZSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gZXZlbnQgZm9yIGhhcmQgY2FwIHJlYWNoZWQKICAgICAgICBpZiAod2VpUmFpc2VkID49IGNhcCkgewogICAgICAgICAgICBMb2dUb2tlbkhhcmRDYXBSZWFjaGVkKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gd2VpQW1vdW50OwogICAgfQoKICAgIC8vLyBAZGV2IEhhbmRsaW5nIHRva2VuIGRpc3RyaWJ1dGlvbiBhbmQgYWNjb3VudGluZy4gT3ZlcnJpZGluZyBDcm93ZHNhbGUjdHJhbnNmZXJUb2tlbi4KICAgIC8vLyBAcGFyYW0gX2JlbmVmaWNpYXJ5IEFkZHJlc3Mgb2YgdGhlIHJlY2VwaWVudCBvZiB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF93ZWlBbW91bnQgQ29udHJpYnV0aW9uIGluIHdlaQogICAgLy8vIEBwYXJhbSBfdGltZSBXaGVuIHRoZSBjb250cmlidXRpb24gd2FzIG1hZGUKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3dlaUFtb3VudCwgdWludDI1NiBfdGltZSwgYnl0ZXMgbWVtb3J5IF93aGl0ZWxpc3RTaWduKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKF93ZWlBbW91bnQpKTsKCiAgICAgICAgLy8gaW5jcmVhc2Ugd2VpIFJhaXNlZAogICAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQoX3dlaUFtb3VudCk7CgogICAgICAgIC8vIHJlcXVpcmUgd2hpdGVsaXN0IGFib3ZlIHRocmVzaG9sZAogICAgICAgIGNvbnRyaWJ1dGlvbnNbX2JlbmVmaWNpYXJ5XSA9IGNvbnRyaWJ1dGlvbnNbX2JlbmVmaWNpYXJ5XS5hZGQoX3dlaUFtb3VudCk7CiAgICAgICAgcmVxdWlyZShjb250cmlidXRpb25zW19iZW5lZmljaWFyeV0gPD0gd2hpdGVsaXN0VGhyZXNob2xkIAogICAgICAgICAgICAgICAgfHwgd2hpdGVsaXN0LmlzV2hpdGVsaXN0ZWQoX2JlbmVmaWNpYXJ5KQogICAgICAgICAgICAgICAgfHwgd2hpdGVsaXN0LmlzT2ZmY2hhaW5XaGl0ZWxpc3RlZChfYmVuZWZpY2lhcnksIF93aGl0ZWxpc3RTaWduKQogICAgICAgICk7CgogICAgICAgIC8vIGNhbGN1bGF0ZSB0b2tlbnMsIHNvIHdlIGNhbiByZWZ1bmQgZXhjZXNzIHRva2VucyB0byBFdGhlYWxDb250cm9sbGVyIGFmdGVyIHRva2VuIHNhbGUKICAgICAgICB1aW50MjU2IF9ib251cyA9IGdldEJvbnVzKF9iZW5lZmljaWFyeSwgX3dlaUFtb3VudCwgX3RpbWUpOwogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gX3dlaUFtb3VudC5tdWwocmF0ZSkubXVsKF9ib251cykuZGl2KDEwMCk7CiAgICAgICAgdG9rZW5CYWxhbmNlID0gdG9rZW5CYWxhbmNlLmFkZCh0b2tlbnMpOwoKICAgICAgICBpZiAoc3Rha2VzW19iZW5lZmljaWFyeV0gPT0gMCkgewogICAgICAgICAgICBjb250cmlidXRvcnNLZXlzLnB1c2goX2JlbmVmaWNpYXJ5KTsKICAgICAgICB9CiAgICAgICAgc3Rha2VzW19iZW5lZmljaWFyeV0gPSBzdGFrZXNbX2JlbmVmaWNpYXJ5XS5hZGQodG9rZW5zKTsKCiAgICAgICAgTG9nVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBfYmVuZWZpY2lhcnksIF93ZWlBbW91bnQsIHRva2VucywgY29udHJpYnV0b3JzS2V5cy5sZW5ndGgsIHdlaVJhaXNlZCk7CiAgICB9CgogICAgLy8vIEBkZXYgR2V0IGV0aCBkZXBvc2l0IGZyb20gRGVwb3NpdCBjb250cmFjdAogICAgZnVuY3Rpb24gZGVwb3NpdEV0aChhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfdGltZSwgYnl0ZXMgX3doaXRlbGlzdFNpZ24pIHB1YmxpYyBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBkZXBvc2l0KTsKCiAgICAgICAgaGFuZGxlUGF5bWVudChfYmVuZWZpY2lhcnksIG1zZy52YWx1ZSwgX3RpbWUsIF93aGl0ZWxpc3RTaWduKTsKICAgIH0KCiAgICAvLy8gQGRldiBEZXBvc2l0IGZyb20gb3RoZXIgY3VycmVuY2llcwogICAgZnVuY3Rpb24gZGVwb3NpdE9mZmNoYWluKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX3RpbWUsIGJ5dGVzIF93aGl0ZWxpc3RTaWduKSBwdWJsaWMgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIGhhbmRsZUNvbnRyaWJ1dGlvbihfYmVuZWZpY2lhcnksIF9hbW91bnQsIF90aW1lLCBfd2hpdGVsaXN0U2lnbik7CiAgICB9CgogICAgLy8vIEBkZXYgT3ZlcnJpZGluZyBDcm93ZHNhbGUjdmFsaWRQdXJjaGFzZSB0byBhZGQgbWluIGNvbnRyaWJ1dGlvbiBsb2dpYwogICAgLy8vIEBwYXJhbSBfd2VpQW1vdW50IENvbnRyaWJ1dGlvbiBhbW91bnQgaW4gd2VpCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGNvbnRyaWJ1dGlvbiBpcyBva2F5CiAgICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKHVpbnQyNTYgX3dlaUFtb3VudCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgbm9uRW5kZWQgPSAhaGFzRW5kZWQoKTsKICAgICAgICBib29sIG5vblplcm8gPSBfd2VpQW1vdW50ICE9IDA7CiAgICAgICAgYm9vbCBlbm91Z2hDb250cmlidXRpb24gPSBfd2VpQW1vdW50ID49IG1pbkNvbnRyaWJ1dGlvbjsKICAgICAgICByZXR1cm4gbm9uRW5kZWQgJiYgbm9uWmVybyAmJiBlbm91Z2hDb250cmlidXRpb247CiAgICB9CgogICAgLy8vIEBkZXYgT3ZlcnJpZGluZyBDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIHNvZnQgY2FwIGxvZ2ljCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBldmVudCBoYXMgZW5kZWQgb3IgYSBzb2Z0Q2FwQ2xvc2UgdGltZSBpcyBzZXQgYW5kIHBhc3NlZAogICAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci5oYXNFbmRlZCgpIHx8IHNvZnRDYXBDbG9zZSA+IDAgJiYgbm93ID4gc29mdENhcENsb3NlOwogICAgfQoKICAgIC8vLyBAZGV2IEV4dGVuZGluZyBSZWZ1bmRhYmxlQ3Jvd2RzYWxlI2ZpbmFsaXphdGlvbiBzZW5kaW5nIGJhY2sgZXhjZXNzIHRva2VucyB0byBldGhlYWxDb250cm9sbGVyCiAgICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDI1NiBfYmFsYW5jZSA9IGdldEhlYWxCYWxhbmNlKCk7CgogICAgICAgIC8vIHNhdmluZyB0b2tlbiBiYWxhbmNlIGZvciBmdXR1cmUgcmVmZXJlbmNlCiAgICAgICAgdG9rZW5Tb2xkID0gdG9rZW5CYWxhbmNlOyAKCiAgICAgICAgLy8gc2VuZCBiYWNrIHRoZSBleGNlc3MgdG9rZW4gdG8gZXRoZWFsQ29udHJvbGxlcgogICAgICAgIGlmIChfYmFsYW5jZSA+IHRva2VuQmFsYW5jZSkgewogICAgICAgICAgICBldGhlYWxDb250cm9sbGVyLmV0aGVhbFRva2VuKCkudHJhbnNmZXIoZXRoZWFsQ29udHJvbGxlci5TQUxFKCksIF9iYWxhbmNlLnN1Yih0b2tlbkJhbGFuY2UpKTsKICAgICAgICB9CgogICAgICAgIC8vIGhvZGxlciBzdGFrZSBjb3VudGluZyBzdGFydHMgMTQgZGF5cyBhZnRlciBjbG9zaW5nIG5vcm1hbCBzYWxlCiAgICAgICAgZXRoZWFsQ29udHJvbGxlci5zZXRIb2RsZXJUaW1lKG5vdyArIDE0IGRheXMpOwoKICAgICAgICBzdXBlci5maW5hbGl6YXRpb24oKTsKICAgIH0KCgogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQUZURVIgdG9rZW4gc2FsZQogICAgLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIE1vZGlmaWVyIGZvciBhZnRlciBzYWxlIGZpbmFsaXphdGlvbgogICAgbW9kaWZpZXIgYWZ0ZXJTYWxlKCkgewogICAgICAgIHJlcXVpcmUoaXNGaW5hbGl6ZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2xhaW0gdG9rZW4gZm9yIG1zZy5zZW5kZXIgYWZ0ZXIgdG9rZW4gc2FsZSBiYXNlZCBvbiBzdGFrZS4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW4oKSBwdWJsaWMgYWZ0ZXJTYWxlIHsKICAgICAgICBjbGFpbVRva2VuRm9yKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENsYWltIHRva2VuIGFmdGVyIHRva2VuIHNhbGUgYmFzZWQgb24gc3Rha2UuCiAgICAvLy8gQGRldiBBbnlvbmUgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiBhbmQgZGlzdHJpYnV0ZSB0b2tlbnMgYWZ0ZXIgc3VjY2Vzc2Z1bCB0b2tlbiBzYWxlCiAgICAvLy8gQHBhcmFtIF9iZW5lZmljaWFyeSBBZGRyZXNzIG9mIHRoZSBiZW5lZmljaWFyeSB3aG8gZ2V0cyB0aGUgdG9rZW4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5Gb3IoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBhZnRlclNhbGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBzdGFrZXNbX2JlbmVmaWNpYXJ5XTsKICAgICAgICByZXF1aXJlKHRva2VucyA+IDApOwoKICAgICAgICAvLyBzZXQgdGhlIHN0YWtlIDAgZm9yIGJlbmVmaWNpYXJ5CiAgICAgICAgc3Rha2VzW19iZW5lZmljaWFyeV0gPSAwOwoKICAgICAgICAvLyBkZWNyZWFzZSB0b2tlbkJhbGFuY2UsIHRvIG1ha2UgaXQgcG9zc2libGUgdG8gd2l0aGRyYXcgZXhjZXNzIEhFQUwgZnVuZHMKICAgICAgICB0b2tlbkJhbGFuY2UgPSB0b2tlbkJhbGFuY2Uuc3ViKHRva2Vucyk7CgogICAgICAgIC8vIGRpc3RyaWJ1dGUgaG9kbHIgc3Rha2UKICAgICAgICBldGhlYWxDb250cm9sbGVyLmFkZEhvZGxlclN0YWtlKF9iZW5lZmljaWFyeSwgdG9rZW5zKTsKCiAgICAgICAgLy8gZGlzdHJpYnV0ZSB0b2tlbgogICAgICAgIHJlcXVpcmUoZXRoZWFsQ29udHJvbGxlci5ldGhlYWxUb2tlbigpLnRyYW5zZmVyKF9iZW5lZmljaWFyeSwgdG9rZW5zKSk7CiAgICAgICAgTG9nVG9rZW5DbGFpbWVkKG1zZy5zZW5kZXIsIF9iZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjbGFpbVRva2VuKCkgZm9yIG11bHRpcGxlIGFkZHJlc3NlcwogICAgLy8vIEBkZXYgQW55b25lIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24gYW5kIGRpc3RyaWJ1dGUgdG9rZW5zIGFmdGVyIHN1Y2Nlc3NmdWwgdG9rZW4gc2FsZQogICAgLy8vIEBwYXJhbSBfYmVuZWZpY2lhcmllcyBBcnJheSBvZiBhZGRyZXNzZXMgZm9yIHdoaWNoIHdlIHdhbnQgdG8gY2xhaW0gdG9rZW5zCiAgICBmdW5jdGlvbiBjbGFpbU1hbnlUb2tlbkZvcihhZGRyZXNzW10gX2JlbmVmaWNpYXJpZXMpIGV4dGVybmFsIGFmdGVyU2FsZSB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2JlbmVmaWNpYXJpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2xhaW1Ub2tlbkZvcihfYmVuZWZpY2lhcmllc1tpXSk7CiAgICAgICAgfQogICAgfQoKCiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBCb251cyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBTZXRzIGV4dHJhIDUlIGJvbnVzIGZvciB0aG9zZSBhZGRyZXNzZXMgd2hvIHNlbmQgYmFjayBhIHByb21vIHRva2VuCiAgICAvLy8gQG5vdGljZSBJdCBjb250YWlucyBhbiBlYXN0ZXIgZWdnLgogICAgLy8vJiMxNjA7QHBhcmFtIF9hZGRyIHRoaXMgYWRkcmVzcyBnZXRzIHRoZSBib251cwogICAgLy8vJiMxNjA7QHBhcmFtIF92YWx1ZSBob3cgbWFueSB0b2tlbnMgYXJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiBzZXRQcm9tb0JvbnVzKGFkZHJlc3MgX2FkZHIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwcm9tb1Rva2VuQ29udHJvbGxlciB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICByZXF1aXJlKF92YWx1ZT4wKTsKCiAgICAgICAgdWludDI1NiBfYm9udXMgPSBrZWNjYWsyNTYoX3ZhbHVlKSA9PSAweGJlY2VkMDk1MjEwNDdkMDViODk2MGI3ZTdiY2MxZDEyOTJjZjNlNGIyYTZiNjNmNDgzMzVjYmRlNWY3NTQ1ZDIgPyA2IDogNTsKCiAgICAgICAgaWYgKGJvbnVzRXh0cmFbIF9hZGRyIF0gPCBfYm9udXMpIHsKICAgICAgICAgICAgYm9udXNFeHRyYVsgX2FkZHIgXSA9IF9ib251czsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgTWFudWFsIHNldCBleHRyYSBib251cyBmb3IgYWRkcmVzc2VzCiAgICBmdW5jdGlvbiBzZXRCb251c0V4dHJhKGFkZHJlc3MgX2FkZHIsIHVpbnQyNTYgX2JvbnVzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9hZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGJvbnVzRXh0cmFbX2FkZHJdID0gX2JvbnVzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE1hc3Mgc2V0IGV4dHJhIGJvbnVzIGZvciBhZGRyZXNzZXMKICAgIGZ1bmN0aW9uIHNldE1hbnlCb251c0V4dHJhKGFkZHJlc3NbXSBfYWRkciwgdWludDI1NiBfYm9udXMpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2FkZHIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc2V0Qm9udXNFeHRyYShfYWRkcltpXSxfYm9udXMpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGJvbnVzIGZvciBub3cKICAgIGZ1bmN0aW9uIGdldEJvbnVzTm93KGFkZHJlc3MgX2FkZHIsIHVpbnQyNTYgX3NpemUpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZ2V0Qm9udXMoX2FkZHIsIF9zaXplLCBub3cpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGJvbnVzIGluIHBlcmNlbnRhZ2UsIGVnIDEzMCBtZWFucyAzMCUgYm9udXMKICAgIGZ1bmN0aW9uIGdldEJvbnVzKGFkZHJlc3MgX2FkZHIsIHVpbnQyNTYgX3NpemUsIHVpbnQyNTYgX3RpbWUpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2JvbnVzKSB7CiAgICAgICAgLy8gZGV0YWlsZWQgYm9udXMgc3RydWN0dXJlOiBodHRwczovL2V0aGVhbC5jb20vI2hlYWwtdG9rZW4KICAgICAgICBfYm9udXMgPSAxMDA7CiAgICAgICAgCiAgICAgICAgLy8gdGltZSBiYXNlZCBib251c2VzCiAgICAgICAgdWludDI1NiBfZGF5ID0gZ2V0U2FsZURheShfdGltZSk7CiAgICAgICAgdWludDI1NiBfaG91ciA9IGdldFNhbGVIb3VyKF90aW1lKTsKICAgICAgICBpZiAoX2RheSA8PSAxKSB7CiAgICAgICAgICAgIGlmIChfaG91ciA8PSAxKSBfYm9udXMgPSAxMzA7CiAgICAgICAgICAgIGVsc2UgaWYgKF9ob3VyIDw9IDUpIF9ib251cyA9IDEyNTsKICAgICAgICAgICAgZWxzZSBpZiAoX2hvdXIgPD0gOCkgX2JvbnVzID0gMTIwOwogICAgICAgICAgICBlbHNlIF9ib251cyA9IDExODsKICAgICAgICB9IAogICAgICAgIGVsc2UgaWYgKF9kYXkgPD0gMikgeyBfYm9udXMgPSAxMTY7IH0KICAgICAgICBlbHNlIGlmIChfZGF5IDw9IDMpIHsgX2JvbnVzID0gMTE1OyB9CiAgICAgICAgZWxzZSBpZiAoX2RheSA8PSA1KSB7IF9ib251cyA9IDExNDsgfQogICAgICAgIGVsc2UgaWYgKF9kYXkgPD0gNykgeyBfYm9udXMgPSAxMTM7IH0KICAgICAgICBlbHNlIGlmIChfZGF5IDw9IDkpIHsgX2JvbnVzID0gMTEyOyB9CiAgICAgICAgZWxzZSBpZiAoX2RheSA8PSAxMSkgeyBfYm9udXMgPSAxMTE7IH0KICAgICAgICBlbHNlIGlmIChfZGF5IDw9IDEzKSB7IF9ib251cyA9IDExMDsgfQogICAgICAgIGVsc2UgaWYgKF9kYXkgPD0gMTUpIHsgX2JvbnVzID0gMTA4OyB9CiAgICAgICAgZWxzZSBpZiAoX2RheSA8PSAxNykgeyBfYm9udXMgPSAxMDc7IH0KICAgICAgICBlbHNlIGlmIChfZGF5IDw9IDE5KSB7IF9ib251cyA9IDEwNjsgfQogICAgICAgIGVsc2UgaWYgKF9kYXkgPD0gMjEpIHsgX2JvbnVzID0gMTA1OyB9CiAgICAgICAgZWxzZSBpZiAoX2RheSA8PSAyMykgeyBfYm9udXMgPSAxMDQ7IH0KICAgICAgICBlbHNlIGlmIChfZGF5IDw9IDI1KSB7IF9ib251cyA9IDEwMzsgfQogICAgICAgIGVsc2UgaWYgKF9kYXkgPD0gMjcpIHsgX2JvbnVzID0gMTAyOyB9CgogICAgICAgIC8vIHNpemUgYmFzZWQgYm9udXNlcwogICAgICAgIGlmIChfc2l6ZSA+PSAxMDAgZXRoZXIpIHsgX2JvbnVzID0gX2JvbnVzICsgNDsgfQogICAgICAgIGVsc2UgaWYgKF9zaXplID49IDEwIGV0aGVyKSB7IF9ib251cyA9IF9ib251cyArIDI7IH0KCiAgICAgICAgLy8gbWFudWFsIGJvbnVzCiAgICAgICAgX2JvbnVzICs9IGJvbnVzRXh0cmFbIF9hZGRyIF07CgogICAgICAgIHJldHVybiBfYm9udXM7CiAgICB9CgoKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbnN0YW50LCBoZWxwZXIgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgSG93IG1hbnkgd2VpIGNhbiB0aGUgbXNnLnNlbmRlciBjb250cmlidXRlIG5vdy4KICAgIGZ1bmN0aW9uIGhvd011Y2hDYW5JQ29udHJpYnV0ZU5vdygpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gaG93TXVjaENhblhDb250cmlidXRlTm93KG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEhvdyBtYW55IHdlaSBjYW4gYW4gZXRoZXJldW0gYWRkcmVzcyBjb250cmlidXRlIG5vdy4KICAgIC8vLyBAcGFyYW0gX2JlbmVmaWNpYXJ5IEV0aGVyZXVtIGFkZHJlc3MKICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiB3ZWkgdGhlIF9iZW5lZmljaWFyeSBjYW4gY29udHJpYnV0ZSBub3cuCiAgICBmdW5jdGlvbiBob3dNdWNoQ2FuWENvbnRyaWJ1dGVOb3coYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9iZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgaWYgKGhhc0VuZGVkKCkgfHwgcGF1c2VkKSAKICAgICAgICAgICAgcmV0dXJuIDA7CgogICAgICAgIC8vIHdlaSB0byBoYXJkIGNhcAogICAgICAgIHVpbnQyNTYgd2VpVG9DYXAgPSBjYXAuc3ViKHdlaVJhaXNlZCk7CgogICAgICAgIHJldHVybiB3ZWlUb0NhcDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBGb3IgYSBnaXZlIGRhdGUgaG93IG1hbnkgMjQgaG91ciBibG9ja3MgaGF2ZSBlbGxhcHNlZCBzaW5jZSB0b2tlbiBzYWxlIHN0YXJ0CiAgICAvLy8gIEJlZm9yZSBzYWxlIHJldHVybiAwLCBmaXJzdCBkYXkgMSwgc2Vjb25kIGRheSAyLCAuLi4KICAgIC8vLyBAcGFyYW0gX3RpbWUgRGF0ZSBpbiBzZWNvbmRzIGZvciB3aGljaCB3ZSB3YW50IHRvIGtub3cgd2hpY2ggc2FsZSBkYXkgaXQgaXMKICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiAyNCBob3VyIGJsb2NrcyBlbGxhcHNpbmcgc2luY2UgdG9rZW4gc2FsZSBzdGFydCBzdGFydGluZyBmcm9tIDEKICAgIGZ1bmN0aW9uIGdldFNhbGVEYXkodWludDI1NiBfdGltZSkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgX2RheSA9IDA7CiAgICAgICAgaWYgKF90aW1lID4gc3RhcnRUaW1lKSB7CiAgICAgICAgICAgIF9kYXkgPSBfdGltZS5zdWIoc3RhcnRUaW1lKS5kaXYoNjAqNjAqMjQpLmFkZCgxKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9kYXk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgSG93IG1hbnkgMjQgaG91ciBibG9ja3MgaGF2ZSBlbGxhcHNlZCBzaW5jZSB0b2tlbiBzYWxlIHN0YXJ0CiAgICAvLy8gQHJldHVybiBOdW1iZXIgb2YgMjQgaG91ciBibG9ja3MgZWxsYXBzaW5nIHNpbmNlIHRva2VuIHNhbGUgc3RhcnQgc3RhcnRpbmcgZnJvbSAxCiAgICBmdW5jdGlvbiBnZXRTYWxlRGF5Tm93KCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBnZXRTYWxlRGF5KG5vdyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBzYWxlIGhvdXI6IDAgYmVmb3JlIHNhbGUsIDEgZm9yIHRoZSBmaXJzdCBob3VyLCAuLi4KICAgIC8vLyBAcGFyYW0gX3RpbWUgRGF0ZSBpbiBzZWNvbmRzIGZvciB3aGljaCB3ZSB3YW50IHRvIGtub3cgd2hpY2ggc2FsZSBob3VyIGl0IGlzCiAgICAvLy8gQHJldHVybiBOdW1iZXIgb2YgMSBob3VyIGJsb2NrcyBlbGxhcHNpbmcgc2luY2UgdG9rZW4gc2FsZSBzdGFydCBzdGFydGluZyBmcm9tIDEKICAgIGZ1bmN0aW9uIGdldFNhbGVIb3VyKHVpbnQyNTYgX3RpbWUpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IF9ob3VyID0gMDsKICAgICAgICBpZiAoX3RpbWUgPiBzdGFydFRpbWUpIHsKICAgICAgICAgICAgX2hvdXIgPSBfdGltZS5zdWIoc3RhcnRUaW1lKS5kaXYoNjAqNjApLmFkZCgxKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9ob3VyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEhvdyBtYW55IDEgaG91ciBibG9ja3MgaGF2ZSBlbGxhcHNlZCBzaW5jZSB0b2tlbiBzYWxlIHN0YXJ0CiAgICAvLy8gQHJldHVybiBOdW1iZXIgb2YgMSBob3VyIGJsb2NrcyBlbGxhcHNpbmcgc2luY2UgdG9rZW4gc2FsZSBzdGFydCBzdGFydGluZyBmcm9tIDEKICAgIGZ1bmN0aW9uIGdldFNhbGVIb3VyTm93KCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBnZXRTYWxlSG91cihub3cpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE1pbmltdW0gYmV0d2VlbiB0d28gdWludDI1NiBudW1iZXJzCiAgICBmdW5jdGlvbiB1aW50MjU2TWluKHVpbnQyNTYgYSwgdWludDI1NiBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA+IGIgPyBiIDogYTsKICAgIH0KCgogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gVGVzdCBhbmQgY29udHJpYnV0aW9uIHdlYiBhcHAsIE5PIGF1ZGl0IGlzIG5lZWRlZAogICAgLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEhvdyBtYW55IGNvbnRyaWJ1dG9ycyB3ZSBoYXZlLgogICAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIGRpZmZlcmVudCBjb250cmlidXRvciBldGhlcmV1bSBhZGRyZXNzZXMKICAgIGZ1bmN0aW9uIGdldENvbnRyaWJ1dG9yc0NvdW50KCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjb250cmlidXRvcnNLZXlzLmxlbmd0aDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXQgY29udHJpYnV0b3IgYWRkcmVzc2VzIHRvIG1hbmFnZSByZWZ1bmRzIG9yIHRva2VuIGNsYWltcy4KICAgIC8vLyBAZGV2IElmIHRoZSBzYWxlIGlzIG5vdCB5ZXQgc3VjY2Vzc2Z1bCwgdGhlbiBpdCBzZWFyY2hlcyBpbiB0aGUgUmVmdW5kVmF1bHQuCiAgICAvLy8gIElmIHRoZSBzYWxlIGlzIHN1Y2Nlc3NmdWwsIGl0IHNlYXJjaGVzIGluIGNvbnRyaWJ1dG9ycy4KICAgIC8vLyBAcGFyYW0gX3BlbmRpbmcgSWYgdHJ1ZSwgdGhlbiByZXR1cm5zIGFkZHJlc3NlcyB3aGljaCBkaWRuJ3QgZ2V0IHRoZWlyIHRva2VucyBkaXN0cmlidXRlZCB0byB0aGVtCiAgICAvLy8gQHBhcmFtIF9jbGFpbWVkIElmIHRydWUsIHRoZW4gcmV0dXJucyBhbHJlYWR5IGRpc3RyaWJ1dGVkIGFkZHJlc3NlcwogICAgLy8vIEByZXR1cm4gQXJyYXkgb2YgYWRkcmVzc2VzIG9mIGNvbnRyaWJ1dG9ycwogICAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0b3JzKGJvb2wgX3BlbmRpbmcsIGJvb2wgX2NsYWltZWQpIHZpZXcgcHVibGljIHJldHVybnMgKGFkZHJlc3NbXSBjb250cmlidXRvcnMpIHsKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIHVpbnQyNTYgcmVzdWx0cyA9IDA7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBfY29udHJpYnV0b3JzID0gbmV3IGFkZHJlc3NbXShjb250cmlidXRvcnNLZXlzLmxlbmd0aCk7CgogICAgICAgIC8vIHNlYXJjaCBpbiBjb250cmlidXRvcnMKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29udHJpYnV0b3JzS2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoX3BlbmRpbmcgJiYgc3Rha2VzW2NvbnRyaWJ1dG9yc0tleXNbaV1dID4gMCB8fCBfY2xhaW1lZCAmJiBzdGFrZXNbY29udHJpYnV0b3JzS2V5c1tpXV0gPT0gMCkgewogICAgICAgICAgICAgICAgX2NvbnRyaWJ1dG9yc1tyZXN1bHRzXSA9IGNvbnRyaWJ1dG9yc0tleXNbaV07CiAgICAgICAgICAgICAgICByZXN1bHRzKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnRyaWJ1dG9ycyA9IG5ldyBhZGRyZXNzW10ocmVzdWx0cyk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJlc3VsdHM7IGkrKykgewogICAgICAgICAgICBjb250cmlidXRvcnNbaV0gPSBfY29udHJpYnV0b3JzW2ldOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9yczsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBIb3cgbWFueSBIRUFMIHRva2VucyBkbyB0aGlzIGNvbnRyYWN0IGhhdmUKICAgIGZ1bmN0aW9uIGdldEhlYWxCYWxhbmNlKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBldGhlYWxDb250cm9sbGVyLmV0aGVhbFRva2VuKCkuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldCBjdXJyZW50IGRhdGUgZm9yIHdlYjMKICAgIGZ1bmN0aW9uIGdldE5vdygpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQp9'.
	

]
