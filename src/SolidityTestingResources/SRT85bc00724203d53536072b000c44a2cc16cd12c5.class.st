Class {
	#name : #SRT85bc00724203d53536072b000c44a2cc16cd12c5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT85bc00724203d53536072b000c44a2cc16cd12c5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8qClRoaXMgZmlsZSBpcyBwYXJ0IG9mIFBhc3MgREFPLgoKUGFzcyBEQU8gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQppdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KClBhc3MgREFPIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgpZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgbGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKYWxvbmcgd2l0aCBQYXNzIERBTy4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KKi8KCi8qClNtYXJ0IGNvbnRyYWN0IGZvciBhIERlY2VudHJhbGl6ZWQgQXV0b25vbW91cyBPcmdhbml6YXRpb24gKERBTykKdG8gYXV0b21hdGUgb3JnYW5pemF0aW9uYWwgZ292ZXJuYW5jZSBhbmQgZGVjaXNpb24tbWFraW5nLgoqLwoKLy8vIEB0aXRsZSBQYXNzIERhbyBzbWFydCBjb250cmFjdApjb250cmFjdCBQYXNzRGFvIHsKICAgIAogICAgc3RydWN0IHJldmlzaW9uIHsKICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBDb21taXR0ZWUgUm9vbSBzbWFydCBjb250cmFjdAogICAgICAgIGFkZHJlc3MgY29tbWl0dGVlUm9vbTsKICAgICAgICAvLyBBZGRyZXNzIG9mIHRoZSBzaGFyZSBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0CiAgICAgICAgYWRkcmVzcyBzaGFyZU1hbmFnZXI7CiAgICAgICAgLy8gQWRkcmVzcyBvZiB0aGUgdG9rZW4gbWFuYWdlciBzbWFydCBjb250cmFjdAogICAgICAgIGFkZHJlc3MgdG9rZW5NYW5hZ2VyOwogICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIHByb2plY3QgY3JlYXRvciBzbWFydCBjb250cmFjdAogICAgICAgIHVpbnQgc3RhcnREYXRlOwogICAgfQogICAgLy8gVGhlIHJldmlzaW9ucyBvZiB0aGUgYXBwbGljYXRpb24gdW50aWwgdG9kYXkKICAgIHJldmlzaW9uW10gcHVibGljIHJldmlzaW9uczsKCiAgICBzdHJ1Y3QgcHJvamVjdCB7CiAgICAgICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIHNtYXJ0IGNvbnRyYWN0CiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3M7CiAgICAgICAgLy8gVGhlIHVuaXggZWZmZWN0aXZlIHN0YXJ0IGRhdGUgb2YgdGhlIGNvbnRyYWN0CiAgICAgICAgdWludCBzdGFydERhdGU7CiAgICB9CiAgICAvLyBUaGUgcHJvamVjdHMgb2YgdGhlIERhbwogICAgcHJvamVjdFtdIHB1YmxpYyBwcm9qZWN0czsKCiAgICAvLyBNYXAgd2l0aCB0aGUgaW5kZXhlcyBvZiB0aGUgcHJvamVjdHMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHJvamVjdElEOwogICAgCiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgbWV0YSBwcm9qZWN0CiAgICBhZGRyZXNzIG1ldGFQcm9qZWN0OwoKICAgIAovLyBFdmVudHMKCiAgICBldmVudCBVcGdyYWRlKHVpbnQgaW5kZXhlZCBSZXZpc2lvbklELCBhZGRyZXNzIENvbW1pdHRlZVJvb20sIGFkZHJlc3MgU2hhcmVNYW5hZ2VyLCBhZGRyZXNzIFRva2VuTWFuYWdlcik7CiAgICBldmVudCBOZXdQcm9qZWN0KGFkZHJlc3MgUHJvamVjdCk7CgovLyBDb25zdGFudCBmdW5jdGlvbnMgIAogICAgCiAgICAvLy8gQHJldHVybiBUaGUgZWZmZWN0aXZlIGNvbW1pdHRlZSByb29tCiAgICBmdW5jdGlvbiBBY3R1YWxDb21taXR0ZWVSb29tKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiByZXZpc2lvbnNbMF0uY29tbWl0dGVlUm9vbTsKICAgIH0KICAgIAogICAgLy8vIEByZXR1cm4gVGhlIG1ldGEgcHJvamVjdAogICAgZnVuY3Rpb24gTWV0YVByb2plY3QoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIG1ldGFQcm9qZWN0OwogICAgfQoKICAgIC8vLyBAcmV0dXJuIFRoZSBlZmZlY3RpdmUgc2hhcmUgbWFuYWdlcgogICAgZnVuY3Rpb24gQWN0dWFsU2hhcmVNYW5hZ2VyKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiByZXZpc2lvbnNbMF0uc2hhcmVNYW5hZ2VyOwogICAgfQoKICAgIC8vLyBAcmV0dXJuIFRoZSBlZmZlY3RpdmUgdG9rZW4gbWFuYWdlcgogICAgZnVuY3Rpb24gQWN0dWFsVG9rZW5NYW5hZ2VyKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiByZXZpc2lvbnNbMF0udG9rZW5NYW5hZ2VyOwogICAgfQoKLy8gbW9kaWZpZXJzCgogICAgbW9kaWZpZXIgb25seVBhc3NDb21taXR0ZWVSb29tIHtpZiAobXNnLnNlbmRlciAhPSByZXZpc2lvbnNbMF0uY29tbWl0dGVlUm9vbSAgCiAgICAgICAgJiYgcmV2aXNpb25zWzBdLmNvbW1pdHRlZVJvb20gIT0gMCkgdGhyb3c7IF87fQogICAgCi8vIENvbnN0cnVjdG9yIGZ1bmN0aW9uCgogICAgZnVuY3Rpb24gUGFzc0RhbygpIHsKICAgICAgICBwcm9qZWN0cy5sZW5ndGggPSAxOwogICAgICAgIHJldmlzaW9ucy5sZW5ndGggPSAxOwogICAgfQogICAgCi8vIFJlZ2lzdGVyIGZ1bmN0aW9ucwoKICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGFsbG93IHRoZSBhY3R1YWwgQ29tbWl0dGVlIFJvb20gdXBncmFkaW5nIHRoZSBhcHBsaWNhdGlvbgogICAgLy8vIEBwYXJhbSBfbmV3Q29tbWl0dGVlUm9vbSBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IGNvbW1pdHRlZSByb29tCiAgICAvLy8gQHBhcmFtIF9uZXdTaGFyZU1hbmFnZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBzaGFyZSBtYW5hZ2VyCiAgICAvLy8gQHBhcmFtIF9uZXdUb2tlbk1hbmFnZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBtYW5hZ2VyCiAgICAvLy8gQHJldHVybiBUaGUgaW5kZXggb2YgdGhlIHJldmlzaW9uCiAgICBmdW5jdGlvbiB1cGdyYWRlKAogICAgICAgIGFkZHJlc3MgX25ld0NvbW1pdHRlZVJvb20sIAogICAgICAgIGFkZHJlc3MgX25ld1NoYXJlTWFuYWdlciwgCiAgICAgICAgYWRkcmVzcyBfbmV3VG9rZW5NYW5hZ2VyKSBvbmx5UGFzc0NvbW1pdHRlZVJvb20gcmV0dXJucyAodWludCkgewogICAgICAgIAogICAgICAgIHVpbnQgX3JldmlzaW9uSUQgPSByZXZpc2lvbnMubGVuZ3RoKys7CiAgICAgICAgcmV2aXNpb24gciA9IHJldmlzaW9uc1tfcmV2aXNpb25JRF07CgogICAgICAgIGlmIChfbmV3Q29tbWl0dGVlUm9vbSAhPSAwKSByLmNvbW1pdHRlZVJvb20gPSBfbmV3Q29tbWl0dGVlUm9vbTsgZWxzZSByLmNvbW1pdHRlZVJvb20gPSByZXZpc2lvbnNbMF0uY29tbWl0dGVlUm9vbTsKICAgICAgICBpZiAoX25ld1NoYXJlTWFuYWdlciAhPSAwKSByLnNoYXJlTWFuYWdlciA9IF9uZXdTaGFyZU1hbmFnZXI7IGVsc2Ugci5zaGFyZU1hbmFnZXIgPSByZXZpc2lvbnNbMF0uc2hhcmVNYW5hZ2VyOwogICAgICAgIGlmIChfbmV3VG9rZW5NYW5hZ2VyICE9IDApIHIudG9rZW5NYW5hZ2VyID0gX25ld1Rva2VuTWFuYWdlcjsgZWxzZSByLnRva2VuTWFuYWdlciA9IHJldmlzaW9uc1swXS50b2tlbk1hbmFnZXI7CgogICAgICAgIHIuc3RhcnREYXRlID0gbm93OwogICAgICAgIAogICAgICAgIHJldmlzaW9uc1swXSA9IHI7CiAgICAgICAgCiAgICAgICAgVXBncmFkZShfcmV2aXNpb25JRCwgX25ld0NvbW1pdHRlZVJvb20sIF9uZXdTaGFyZU1hbmFnZXIsIF9uZXdUb2tlbk1hbmFnZXIpOwogICAgICAgICAgICAKICAgICAgICByZXR1cm4gX3JldmlzaW9uSUQ7CiAgICB9CgogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gc2V0IHRoZSBtZXRhIHByb2plY3QKICAgIC8vLyBAcGFyYW0gX3Byb2plY3RBZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBtZXRhIHByb2plY3QKICAgIGZ1bmN0aW9uIGFkZE1ldGFQcm9qZWN0KGFkZHJlc3MgX3Byb2plY3RBZGRyZXNzKSBvbmx5UGFzc0NvbW1pdHRlZVJvb20gewoKICAgICAgICBtZXRhUHJvamVjdCA9IF9wcm9qZWN0QWRkcmVzczsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gYWxsb3cgdGhlIGNvbW1pdHRlZSByb29tIHRvIGFkZCBhIHByb2plY3Qgd2hlbiBvcmRlcmluZwogICAgLy8vIEBwYXJhbSBfcHJvamVjdEFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHByb2plY3QKICAgIGZ1bmN0aW9uIGFkZFByb2plY3QoYWRkcmVzcyBfcHJvamVjdEFkZHJlc3MpIG9ubHlQYXNzQ29tbWl0dGVlUm9vbSB7CgogICAgICAgIGlmIChwcm9qZWN0SURbX3Byb2plY3RBZGRyZXNzXSA9PSAwKSB7CgogICAgICAgICAgICB1aW50IF9wcm9qZWN0SUQgPSBwcm9qZWN0cy5sZW5ndGgrKzsKICAgICAgICAgICAgcHJvamVjdCBwID0gcHJvamVjdHNbX3Byb2plY3RJRF07CiAgICAgICAgCiAgICAgICAgICAgIHByb2plY3RJRFtfcHJvamVjdEFkZHJlc3NdID0gX3Byb2plY3RJRDsKICAgICAgICAgICAgcC5jb250cmFjdEFkZHJlc3MgPSBfcHJvamVjdEFkZHJlc3M7IAogICAgICAgICAgICBwLnN0YXJ0RGF0ZSA9IG5vdzsKICAgICAgICAgICAgCiAgICAgICAgICAgIE5ld1Byb2plY3QoX3Byb2plY3RBZGRyZXNzKTsKICAgICAgICB9CiAgICB9CiAgICAKfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8qCiAqCiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFBhc3MgREFPLgogKgogKiBUaGUgTWFuYWdlciBzbWFydCBjb250cmFjdCBpcyB1c2VkIGZvciB0aGUgbWFuYWdlbWVudCBvZiBzaGFyZXMgYW5kIHRva2Vucy4KICoKKi8KCi8vLyBAdGl0bGUgVG9rZW4gTWFuYWdlciBzbWFydCBjb250cmFjdCBvZiB0aGUgUGFzcyBEZWNlbnRyYWxpemVkIEF1dG9ub21vdXMgT3JnYW5pc2F0aW9uCmNvbnRyYWN0IFBhc3NUb2tlbk1hbmFnZXJJbnRlcmZhY2UgewoKICAgIC8vIFRoZSBQYXNzIERhbyBzbWFydCBjb250cmFjdAogICAgUGFzc0RhbyBwdWJsaWMgcGFzc0RhbzsKICAgIC8vIFRoZSBhZHJlc3Mgb2YgdGhlIGNyZWF0b3Igb2YgdGhpcyBzbWFydCBjb250cmFjdAogICAgYWRkcmVzcyBjcmVhdG9yOwogICAgCiAgICAvLyBUaGUgdG9rZW4gbmFtZSBmb3IgZGlzcGxheSBwdXJwb3NlCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICAvLyBUaGUgdG9rZW4gc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgLy8gVGhlIHF1YW50aXR5IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgdG90YWxUb2tlblN1cHBseTsKCiAgICAvLyBUcnVlIGlmIHRva2VucywgZmFsc2UgaWYgRGFvIHNoYXJlcwogICAgYm9vbCB0b2tlbjsKICAgIC8vIElmIHRydWUsIHRoZSBzaGFyZXMgb3IgdG9rZW5zIGNhbiBiZSB0cmFuc2ZlcnJlZAogICAgYm9vbCB0cmFuc2ZlcmFibGU7CgogICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGxhc3QgTWFuYWdlciBiZWZvcmUgY2xvbmluZwogICAgYWRkcmVzcyBwdWJsaWMgY2xvbmVkRnJvbTsKICAgIC8vIFRydWUgaWYgdGhlIGluaXRpYWwgdG9rZW4gc3VwcGx5IGlzIG92ZXIKICAgIGJvb2wgaW5pdGlhbFRva2VuU3VwcGx5RG9uZTsKCiAgICAvLyBBcnJheSBvZiB0b2tlbiBvciBzaGFyZSBob2xkZXJzICh1c2VkIGZvciBjbG9uaW5nKQogICAgYWRkcmVzc1tdIGhvbGRlcnM7CiAgICAvLyBNYXAgd2l0aCB0aGUgaW5kZXhlcyBvZiB0aGUgaG9sZGVycyAodXNlZCBmb3IgY2xvbmluZykKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgaG9sZGVySUQ7CiAgICAKICAgIC8vIEFycmF5IHdpdGggYWxsIGJhbGFuY2VzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgLy8gQXJyYXkgd2l0aCBhbGwgYWxsb3dhbmNlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIHN0cnVjdCBmdW5kaW5nIHsKICAgICAgICAvLyBUaGUgYWRkcmVzcyB3aGljaCBzZXRzIHBhcnRuZXJzIGFuZCBtYW5hZ2VzIHRoZSBmdW5kaW5nIChub3QgbWFuZGF0b3J5KQogICAgICAgIGFkZHJlc3MgbW9kZXJhdG9yOwogICAgICAgIC8vIFRoZSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IGFtb3VudFRvRnVuZDsKICAgICAgICAvLyBUaGUgZnVuZGVkIGFtb3VudCAoaW4gd2VpKQogICAgICAgIHVpbnQgZnVuZGVkQW1vdW50OwogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBzdGFydCB0aW1lIG9mIHRoZSBmdW5kaW5nCiAgICAgICAgdWludCBzdGFydFRpbWU7IAogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBjbG9zaW5nIHRpbWUgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IGNsb3NpbmdUaW1lOyAgCiAgICAgICAgLy8gVGhlIHByaWNlIG11bHRpcGxpZXIgZm9yIGEgc2hhcmUgb3IgYSB0b2tlbiB3aXRob3V0IGNvbnNpZGVyaW5nIHRoZSBpbmZsYXRpb24gcmF0ZQogICAgICAgIHVpbnQgaW5pdGlhbFByaWNlTXVsdGlwbGllcjsKICAgICAgICAvLyBSYXRlIHBlciB5ZWFyIGluIHBlcmNlbnRhZ2UgYXBwbGllZCB0byB0aGUgc2hhcmUgb3IgdG9rZW4gcHJpY2UgCiAgICAgICAgdWludCBpbmZsYXRpb25SYXRlOyAKICAgICAgICAvLyBUaGUgdG90YWwgYW1vdW50IG9mIHdlaSBnaXZlbgogICAgICAgIHVpbnQgdG90YWxXZWlHaXZlbjsKICAgIH0gCiAgICAvLyBNYXAgd2l0aCB0aGUgZnVuZGluZ3MgcnVsZXMgZm9yIGVhY2ggRGFvIHByb3Bvc2FsCiAgICBtYXBwaW5nICh1aW50ID0+IGZ1bmRpbmcpIHB1YmxpYyBmdW5kaW5nczsKCiAgICAvLyBUaGUgaW5kZXggb2YgdGhlIGxhc3QgZnVuZGluZyBhbmQgcHJvcG9zYWwKICAgIHVpbnQgbGFzdFByb3Bvc2FsSUQ7CiAgICAvLyBUaGUgaW5kZXggb2YgdGhlIGxhc3QgZnVlbGVkIGZ1bmRpbmcgYW5kIHByb3Bvc2FsCiAgICB1aW50IHB1YmxpYyBsYXN0RnVlbGVkRnVuZGluZ0lEOwogICAgCiAgICBzdHJ1Y3QgYW1vdW50c0dpdmVuIHsKICAgICAgICB1aW50IHdlaUFtb3VudDsKICAgICAgICB1aW50IHRva2VuQW1vdW50OwogICAgfQogICAgLy8gTWFwIHdpdGggdGhlIGFtb3VudHMgZ2l2ZW4gZm9yIGVhY2ggcHJvcG9zYWwgCiAgICBtYXBwaW5nICh1aW50ID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gYW1vdW50c0dpdmVuKSkgcHVibGljIEdpdmVuOwogICAgCiAgICAvLyBNYXAgb2YgYmxvY2tlZCBEYW8gc2hhcmUgYWNjb3VudHMuIFBvaW50cyB0byB0aGUgZGF0ZSB3aGVuIHRoZSBzaGFyZSBob2xkZXIgY2FuIHRyYW5zZmVyIHNoYXJlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgYmxvY2tlZERlYWRMaW5lOyAKCiAgICAvLyBAcmV0dXJuIFRoZSBjbGllbnQgb2YgdGhpcyBtYW5hZ2VyCiAgICBmdW5jdGlvbiBDbGllbnQoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKTsKICAgIAogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIHN1cHBseSBvZiBzaGFyZXMgb3IgdG9rZW5zIAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZQogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRva2VucyBjYW4gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIFRyYW5zZmVyYWJsZSgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gUXVhbnRpdHkgb2YgcmVtYWluaW5nIHRva2VucyBvZiBfb3duZXIgdGhhdCBfc3BlbmRlciBpcyBhbGxvd2VkIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICAgIAogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBJbmRleCBvZiB0aGUgZnVuZGluZyBvciBwcm9wb3NhbAogICAgLy8vIEByZXR1cm4gVGhlIHJlc3VsdCAoaW4gd2VpKSBvZiB0aGUgZnVuZGluZwogICAgZnVuY3Rpb24gRnVuZGVkQW1vdW50KHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGZ1bmRpbmcgb3IgcHJvcG9zYWwKICAgIC8vLyBAcmV0dXJuIFRoZSBhbW91bnQgdG8gZnVuZAogICAgZnVuY3Rpb24gQW1vdW50VG9GdW5kKHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwogICAgCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBmdW5kaW5nIG9yIHByb3Bvc2FsCiAgICAvLy8gQHJldHVybiB0aGUgdG9rZW4gcHJpY2UgbXVsdGlwbGllcgogICAgZnVuY3Rpb24gcHJpY2VNdWx0aXBsaWVyKHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpOwogICAgCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBmdW5kaW5nIG9yIHByb3Bvc2FsCiAgICAvLy8gQHBhcmFtIF9zYWxlRGF0ZSBpbiBjYXNlIG9mIHByZXNhbGUsIHRoZSBkYXRlIG9mIHRoZSBwcmVzYWxlCiAgICAvLy8gQHJldHVybiB0aGUgc2hhcmUgb3IgdG9rZW4gcHJpY2UgZGl2aXNvciBjb25kaWRlcmluZyB0aGUgc2FsZSBkYXRlIGFuZCB0aGUgaW5mbGF0aW9uIHJhdGUKICAgIGZ1bmN0aW9uIHByaWNlRGl2aXNvcigKICAgICAgICB1aW50IF9wcm9wb3NhbElELCAKICAgICAgICB1aW50IF9zYWxlRGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCk7CiAgICAKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGZ1bmRpbmcgb3IgcHJvcG9zYWwKICAgIC8vLyBAcmV0dXJuIHRoZSBhY3R1YWwgcHJpY2UgZGl2aXNvciBvZiBhIHNoYXJlIG9yIHRva2VuCiAgICBmdW5jdGlvbiBhY3R1YWxQcmljZURpdmlzb3IodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIHRoZSBhbW91bnQgaW4gdG9rZW5zIGFjY29yZGluZyB0byBhIHByaWNlICAgIAogICAgLy8vIEBwYXJhbSBfd2VpQW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkKICAgIC8vLyBAcGFyYW0gX3ByaWNlTXVsdGlwbGllciBUaGUgcHJpY2UgbXVsdGlwbGllcgogICAgLy8vIEBwYXJhbSBfcHJpY2VEaXZpc29yIFRoZSBwcmljZSBkaXZpc29yCiAgICAvLy8gQHJldHVybiB0aGUgYW1vdW50IGluIHRva2VucyAKICAgIGZ1bmN0aW9uIFRva2VuQW1vdW50KAogICAgICAgIHVpbnQgX3dlaUFtb3VudCwKICAgICAgICB1aW50IF9wcmljZU11bHRpcGxpZXIsIAogICAgICAgIHVpbnQgX3ByaWNlRGl2aXNvcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIHRoZSBhbW91bnQgaW4gd2VpIGFjY29yZGluZyB0byBhIHByaWNlICAgIAogICAgLy8vIEBwYXJhbSBfdG9rZW5BbW91bnQgVGhlIGFtb3VudCAoaW4gd2VpKQogICAgLy8vIEBwYXJhbSBfcHJpY2VNdWx0aXBsaWVyIFRoZSBwcmljZSBtdWx0aXBsaWVyCiAgICAvLy8gQHBhcmFtIF9wcmljZURpdmlzb3IgVGhlIHByaWNlIGRpdmlzb3IKICAgIC8vLyBAcmV0dXJuIHRoZSBhbW91bnQgaW4gd2VpCiAgICBmdW5jdGlvbiB3ZWlBbW91bnQoCiAgICAgICAgdWludCBfdG9rZW5BbW91bnQsIAogICAgICAgIHVpbnQgX3ByaWNlTXVsdGlwbGllciwgCiAgICAgICAgdWludCBfcHJpY2VEaXZpc29yKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgICAgICAKICAgIC8vLyBAcGFyYW0gX3Rva2VuQW1vdW50IFRoZSBhbW91bnQgaW4gdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwuIDAgaWYgbm90IGxpbmtlZCB0byBhIHByb3Bvc2FsLgogICAgLy8vIEByZXR1cm4gdGhlIGFjdHVhbCB0b2tlbiBwcmljZSBpbiB3ZWkKICAgIGZ1bmN0aW9uIFRva2VuUHJpY2VJbldlaSh1aW50IF90b2tlbkFtb3VudCwgdWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICAKICAgIC8vLyBAcmV0dXJuIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBmdW5kaW5nIGFuZCBjbGllbnQncyBwcm9wb3NhbCAKICAgIGZ1bmN0aW9uIExhc3RQcm9wb3NhbElEKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBzaGFyZSBvciB0b2tlbiBob2xkZXJzICh1c2VkIGZvciBjbG9uaW5nKQogICAgZnVuY3Rpb24gbnVtYmVyT2ZIb2xkZXJzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBwYXJhbSBfaW5kZXggVGhlIGluZGV4IG9mIHRoZSBob2xkZXIKICAgIC8vLyBAcmV0dXJuIHRoZSBhZGRyZXNzIG9mIHRoZSBob2xkZXIKICAgIGZ1bmN0aW9uIEhvbGRlckFkZHJlc3ModWludCBfaW5kZXgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKGFkZHJlc3MpOwogICAKICAgIC8vLyBAZGV2IFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbgogICAgLy8vIEBwYXJhbSBfcGFzc0RhbyBBZGRyZXNzIG9mIHRoZSBwYXNzIERhbyBzbWFydCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfY2xvbmVkRnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgbGFzdCBNYW5hZ2VyIGJlZm9yZSBjbG9uaW5nCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgVGhlIHRva2VuIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVGhlIHRva2VuIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3NlCiAgICAvLy8gQHBhcmFtIF90b2tlbkRlY2ltYWxzIFRoZSBxdWFudGl0eSBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlCiAgICAvLy8gQHBhcmFtICBfdG9rZW4gVHJ1ZSBpZiB0b2tlbnMsIGZhbHNlIGlmIHNoYXJlcwogICAgLy8vIEBwYXJhbSAgX3RyYW5zZmVyYWJsZSBUcnVlIGlmIHRva2VucyBjYW4gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX2luaXRpYWxQcmljZU11bHRpcGxpZXIgUHJpY2UgbXVsdGlwbGllciB3aXRob3V0IGNvbnNpZGVyaW5nIGFueSBpbmZsYXRpb24gcmF0ZQogICAgLy8vIEBwYXJhbSBfaW5mbGF0aW9uUmF0ZSBJZiAwLCB0aGUgdG9rZW4gcHJpY2UgZG9lc24ndCBjaGFuZ2UgZHVyaW5nIHRoZSBmdW5kaW5nCiAgICAvL2Z1bmN0aW9uIFBhc3NUb2tlbk1hbmFnZXIoCiAgICAvLyAgICBhZGRyZXNzIF9wYXNzRGFvLAogICAgLy8gICAgYWRkcmVzcyBfY2xvbmVkRnJvbSwKICAgIC8vICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgLy8gICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgIC8vICAgIHVpbnQ4IF90b2tlbkRlY2ltYWxzLAogICAgLy8gICAgYm9vbCBfdG9rZW4sCiAgICAvLyAgICBib29sIF90cmFuc2ZlcmFibGUsCiAgICAvLyAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLAogICAgLy8gICAgdWludCBfaW5mbGF0aW9uUmF0ZSk7CiAgICAKICAgIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGNyZWF0ZSBpbml0aWFsIHRva2VucyAgICAKICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgYmVuZWZpY2lhcnkgb2YgdGhlIGNyZWF0ZWQgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9xdWFudGl0eSBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGNyZWF0ZSAgICAKICAgIC8vLyBAcGFyYW0gX2xhc3QgVHJ1ZSBpZiB0aGUgaW5pdGlhbCB0b2tlbiBzdXBweSBpcyBvdmVyCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgICAgIAogICAgZnVuY3Rpb24gaW5pdGlhbFRva2VuU3VwcGx5KAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfcXVhbnRpdHksCiAgICAgICAgYm9vbCBfbGFzdCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgICAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGNsb25lIHRva2VucyBiZWZvcmUgdXBncmFkaW5nCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBpbmRleCBvZiB0aGUgZmlyc3QgaG9sZGVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgaW5kZXggb2YgdGhlIGxhc3QgaG9sZGVyCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiBjbG9uZVRva2VucygKICAgICAgICB1aW50IF9mcm9tLAogICAgICAgIHVpbnQgX3RvKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGFkZCBhIG5ldyB0b2tlbiBvciBzaGFyZSBob2xkZXIKICAgIC8vLyBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gb3Igc2hhcmUgaG9sZGVyCiAgICBmdW5jdGlvbiBhZGRIb2xkZXIoYWRkcmVzcyBfaG9sZGVyKSBpbnRlcm5hbDsKICAgIAogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY3JlYXRlIGluaXRpYWwgdG9rZW5zICAgIAogICAgLy8vIEBwYXJhbSBfaG9sZGVyIFRoZSBiZW5lZmljaWFyeSBvZiB0aGUgY3JlYXRlZCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3Rva2VuQW1vdW50IFRoZSBhbW91bnQgaW4gdG9rZW5zIHRvIGNyZWF0ZQogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5zKAogICAgICAgIGFkZHJlc3MgX2hvbGRlciwgCiAgICAgICAgdWludCBfdG9rZW5BbW91bnQpIGludGVybmFsOwogICAgICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY2xpZW50IHRvIHBheSB3aXRoIHNoYXJlcyBvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50IG9mIHNoYXJlcyBvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiBXZWkpIHRvIGNhbGN1bGF0ZSB0aGUgcXVhbnRpdHkgb2Ygc2hhcmVzIG9yIHRva2VucyB0byBjcmVhdGUKICAgIC8vLyBAcmV0dXJuIHRoZSByZXdhcmRlZCBhbW91bnQgaW4gdG9rZW5zIG9yIHNoYXJlcwogICAgZnVuY3Rpb24gcmV3YXJkVG9rZW5zRm9yQ2xpZW50KAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfYW1vdW50KSBleHRlcm5hbCAgcmV0dXJucyAodWludCk7CiAgICAgICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBzZXQgYSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9tb2RlcmF0b3IgVGhlIGFkZHJlc3Mgb2YgdGhlIHNtYXJ0IGNvbnRyYWN0IHRvIG1hbmFnZSBhIHByaXZhdGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfaW5pdGlhbFByaWNlTXVsdGlwbGllciBQcmljZSBtdWx0aXBsaWVyIHdpdGhvdXQgY29uc2lkZXJpbmcgYW55IGluZmxhdGlvbiByYXRlCiAgICAvLy8gQHBhcmFtIF9hbW91bnRUb0Z1bmQgVGhlIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfbWludXRlc0Z1bmRpbmdQZXJpb2QgUGVyaW9kIGluIG1pbnV0ZXMgb2YgdGhlIGZ1bmRpbmcKICAgIC8vLyBAcGFyYW0gX2luZmxhdGlvblJhdGUgSWYgMCwgdGhlIHRva2VuIHByaWNlIGRvZXNuJ3QgY2hhbmdlIGR1cmluZyB0aGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBJbmRleCBvZiB0aGUgY2xpZW50IHByb3Bvc2FsCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nUnVsZXMoCiAgICAgICAgYWRkcmVzcyBfbW9kZXJhdG9yLAogICAgICAgIHVpbnQgX2luaXRpYWxQcmljZU11bHRpcGxpZXIsCiAgICAgICAgdWludCBfYW1vdW50VG9GdW5kLAogICAgICAgIHVpbnQgX21pbnV0ZXNGdW5kaW5nUGVyaW9kLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQpIGV4dGVybmFsOwoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIGZvciB0aGUgc2FsZSBvZiBzaGFyZXMgb3IgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgcmVjaXBpZW50IGFkZHJlc3Mgb2Ygc2hhcmVzIG9yIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBmdW5kZWQgYW1vdW50IChpbiB3ZWkpCiAgICAvLy8gQHBhcmFtIF9zYWxlRGF0ZSBJbiBjYXNlIG9mIHByZXNhbGUsIHRoZSBkYXRlIG9mIHRoZSBwcmVzYWxlCiAgICAvLy8gQHBhcmFtIF9wcmVzYWxlIFRydWUgaWYgcHJlc2FsZQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgY3JlYXRpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBzYWxlKAogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQsCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCAKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfc2FsZURhdGUsCiAgICAgICAgYm9vbCBfcHJlc2FsZQogICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBjbG9zZSB0aGUgYWN0dWFsIGZ1bmRpbmcKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGNsaWVudCBwcm9wb3NhbAogICAgZnVuY3Rpb24gY2xvc2VGdW5kaW5nKHVpbnQgX3Byb3Bvc2FsSUQpIGludGVybmFsOwogICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNlbmQgdG9rZW5zIG9yIHJlZnVuZCBhZnRlciB0aGUgY2xvc2luZyB0aW1lIG9mIHRoZSBmdW5kaW5nIHByb3Bvc2FscwogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgZmlyc3QgcHJvcG9zYWwuIDAgaWYgbm90IGxpbmtlZCB0byBhIHByb3Bvc2FsCiAgICAvLy8gQHBhcmFtIF90byBUaGUgbGFzdCBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGJ1eWVyCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiBzZW5kUGVuZGluZ0Ftb3VudHMoICAgICAgICAKICAgICAgICB1aW50IF9mcm9tLAogICAgICAgIHVpbnQgX3RvLAogICAgICAgIGFkZHJlc3MgX2J1eWVyKSByZXR1cm5zIChib29sKTsKICAgICAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGdldCBmZWVzLCBzaGFyZXMgb3IgcmVmdW5kIGFmdGVyIHRoZSBjbG9zaW5nIHRpbWUgb2YgdGhlIGZ1bmRpbmcgcHJvcG9zYWxzCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHdpdGhkcmF3UGVuZGluZ0Ftb3VudHMoKSByZXR1cm5zIChib29sKTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgbWFpbiBwYXJ0bmVyIHRvIHNldCB0aGUgc3RhcnQgdGltZSBvZiB0aGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBJbmRleCBvZiB0aGUgY2xpZW50IHByb3Bvc2FsCiAgICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgVGhlIHVuaXggc3RhcnQgZGF0ZSBvZiB0aGUgZnVuZGluZyAKICAgIGZ1bmN0aW9uIHNldEZ1bmRpbmdTdGFydFRpbWUoCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwgCiAgICAgICAgdWludCBfc3RhcnRUaW1lKSBleHRlcm5hbDsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgbWFpbiBwYXJ0bmVyIHRvIHNldCB0aGUgZnVuZGluZyBmdWVsZWQKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGNsaWVudCBwcm9wb3NhbAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ0Z1ZWxlZCh1aW50IF9wcm9wb3NhbElEKSBleHRlcm5hbDsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzIG9yIGNvbnRyYWN0b3IgdG9rZW5zCiAgICBmdW5jdGlvbiBhYmxlVHJhbnNmZXIoKTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBkaXNhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzCiAgICBmdW5jdGlvbiBkaXNhYmxlVHJhbnNmZXIoKTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjbGllbnQgdG8gYmxvY2sgdGhlIHRyYW5zZmVyIG9mIHNoYXJlcyBmcm9tIGFuZCB0byBhIHNoYXJlIGhvbGRlcgogICAgLy8vIEBwYXJhbSBfc2hhcmVIb2xkZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHNoYXJlIGhvbGRlcgogICAgLy8vIEBwYXJhbSBfZGVhZExpbmUgV2hlbiB0aGUgYWNjb3VudCB3aWxsIGJlIHVuYmxvY2tlZAogICAgZnVuY3Rpb24gYmxvY2tUcmFuc2ZlcigKICAgICAgICBhZGRyZXNzIF9zaGFyZUhvbGRlciwgCiAgICAgICAgdWludCBfZGVhZExpbmUpIGV4dGVybmFsOwogICAgCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9Gcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgcXVhbnRpdHkgb2Ygc2hhcmVzIG9yIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZnVuY3Rpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90IAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tVG8oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywgCiAgICAgICAgdWludDI1NiBfdmFsdWUKICAgICAgICApIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICAKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgCiAgICAgICAgYWRkcmVzcyBfdG8sIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgICAgICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24gaXRzIGJlaGFsZgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKAogICAgICAgIGFkZHJlc3MgX3NwZW5kZXIsIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgCiAgICBldmVudCBUb2tlbnNDcmVhdGVkKGFkZHJlc3MgaW5kZXhlZCBTZW5kZXIsIGFkZHJlc3MgaW5kZXhlZCBUb2tlbkhvbGRlciwgdWludCBUb2tlbkFtb3VudCk7CiAgICBldmVudCBGdW5kaW5nUnVsZXNTZXQoYWRkcmVzcyBpbmRleGVkIE1vZGVyYXRvciwgdWludCBpbmRleGVkIFByb3Bvc2FsSWQsIHVpbnQgQW1vdW50VG9GdW5kLCB1aW50IGluZGV4ZWQgU3RhcnRUaW1lLCB1aW50IENsb3NpbmdUaW1lKTsKICAgIGV2ZW50IEZ1bmRpbmdGdWVsZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgRnVuZGVkQW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyQWJsZSgpOwogICAgZXZlbnQgVHJhbnNmZXJEaXNhYmxlKCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IFJlZnVuZChhZGRyZXNzIGluZGV4ZWQgQnV5ZXIsIHVpbnQgQW1vdW50KTsKICAgIAp9ICAgIAoKY29udHJhY3QgUGFzc1Rva2VuTWFuYWdlciBpcyBQYXNzVG9rZW5NYW5hZ2VySW50ZXJmYWNlIHsKCi8vIENvbnN0YW50IGZ1bmN0aW9ucwoKICAgIGZ1bmN0aW9uIENsaWVudCgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gcGFzc0Rhby5BY3R1YWxDb21taXR0ZWVSb29tKCk7CiAgICB9CiAgIAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsVG9rZW5TdXBwbHk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CiAgICAgCiAgICBmdW5jdGlvbiBUcmFuc2ZlcmFibGUoKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRyYW5zZmVyYWJsZTsKICAgIH0KIAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKAogICAgICAgIGFkZHJlc3MgX293bmVyLCAKICAgICAgICBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIEZ1bmRlZEFtb3VudCh1aW50IF9wcm9wb3NhbElEKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5mdW5kZWRBbW91bnQ7CiAgICB9CiAgCiAgICBmdW5jdGlvbiBBbW91bnRUb0Z1bmQodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewoKICAgICAgICBpZiAobm93ID4gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lCiAgICAgICAgICAgIHx8IG5vdyA8IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5zdGFydFRpbWUpIHsKICAgICAgICAgICAgcmV0dXJuIDA7ICAgCiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmFtb3VudFRvRnVuZDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcHJpY2VNdWx0aXBsaWVyKHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmluaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHByaWNlRGl2aXNvcih1aW50IF9wcm9wb3NhbElELCB1aW50IF9zYWxlRGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgX2RhdGUgPSBfc2FsZURhdGU7CiAgICAgICAgCiAgICAgICAgaWYgKF9zYWxlRGF0ZSA+IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5jbG9zaW5nVGltZSkgX2RhdGUgPSBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uY2xvc2luZ1RpbWU7CiAgICAgICAgaWYgKF9zYWxlRGF0ZSA8IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5zdGFydFRpbWUpIF9kYXRlID0gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnN0YXJ0VGltZTsKCiAgICAgICAgcmV0dXJuIDEwMCArIDEwMCpmdW5kaW5nc1tfcHJvcG9zYWxJRF0uaW5mbGF0aW9uUmF0ZSooX2RhdGUgLSBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uc3RhcnRUaW1lKS8oMTAwKjM2NSBkYXlzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWN0dWFsUHJpY2VEaXZpc29yKHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcHJpY2VEaXZpc29yKF9wcm9wb3NhbElELCBub3cpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBUb2tlbkFtb3VudCgKICAgICAgICB1aW50IF93ZWlBbW91bnQsIAogICAgICAgIHVpbnQgX3ByaWNlTXVsdGlwbGllciwgCiAgICAgICAgdWludCBfcHJpY2VEaXZpc29yKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgCiAgICAgICAgdWludCBfYSA9IF93ZWlBbW91bnQqX3ByaWNlTXVsdGlwbGllcjsKICAgICAgICB1aW50IF9tdWx0aXBsaWVyID0gMTAwKl9hOwogICAgICAgIHVpbnQgX2Ftb3VudCA9IF9tdWx0aXBsaWVyL19wcmljZURpdmlzb3I7CiAgICAgICAgaWYgKF9hL193ZWlBbW91bnQgIT0gX3ByaWNlTXVsdGlwbGllcgogICAgICAgICAgICB8fCBfbXVsdGlwbGllci8xMDAgIT0gX2EpIHJldHVybiAwOyAKICAgICAgICAKICAgICAgICByZXR1cm4gX2Ftb3VudDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gd2VpQW1vdW50KAogICAgICAgIHVpbnQgX3Rva2VuQW1vdW50LCAKICAgICAgICB1aW50IF9wcmljZU11bHRpcGxpZXIsIAogICAgICAgIHVpbnQgX3ByaWNlRGl2aXNvcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIAogICAgICAgIHVpbnQgX211bHRpcGxpZXIgPSBfdG9rZW5BbW91bnQqX3ByaWNlRGl2aXNvcjsKICAgICAgICB1aW50IF9kaXZpc29yID0gMTAwKl9wcmljZU11bHRpcGxpZXI7CiAgICAgICAgdWludCBfYW1vdW50ID0gX211bHRpcGxpZXIvX2Rpdmlzb3I7CiAgICAgICAgaWYgKF9tdWx0aXBsaWVyL190b2tlbkFtb3VudCAhPSBfcHJpY2VEaXZpc29yCiAgICAgICAgICAgIHx8IF9kaXZpc29yLzEwMCAhPSBfcHJpY2VNdWx0aXBsaWVyKSByZXR1cm4gMDsgCgogICAgICAgIHJldHVybiBfYW1vdW50OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBUb2tlblByaWNlSW5XZWkodWludCBfdG9rZW5BbW91bnQsIHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gd2VpQW1vdW50KF90b2tlbkFtb3VudCwgcHJpY2VNdWx0aXBsaWVyKF9wcm9wb3NhbElEKSwgYWN0dWFsUHJpY2VEaXZpc29yKF9wcm9wb3NhbElEKSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIExhc3RQcm9wb3NhbElEKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBsYXN0UHJvcG9zYWxJRDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbnVtYmVyT2ZIb2xkZXJzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBob2xkZXJzLmxlbmd0aCAtIDE7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEhvbGRlckFkZHJlc3ModWludCBfaW5kZXgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gaG9sZGVyc1tfaW5kZXhdOwogICAgfQoKLy8gTW9kaWZpZXJzCgogICAgLy8gTW9kaWZpZXIgdGhhdCBhbGxvd3Mgb25seSB0aGUgY2xpZW50IC4uCiAgICBtb2RpZmllciBvbmx5Q2xpZW50IHtpZiAobXNnLnNlbmRlciAhPSBDbGllbnQoKSkgdGhyb3c7IF87fQogICAgICAKICAgIC8vIE1vZGlmaWVyIGZvciBzaGFyZSBNYW5hZ2VyIGZ1bmN0aW9ucwogICAgbW9kaWZpZXIgb25seVNoYXJlTWFuYWdlciB7aWYgKHRva2VuKSB0aHJvdzsgXzt9CgogICAgLy8gTW9kaWZpZXIgZm9yIHRva2VuIE1hbmFnZXIgZnVuY3Rpb25zCiAgICBtb2RpZmllciBvbmx5VG9rZW5NYW5hZ2VyIHtpZiAoIXRva2VuKSB0aHJvdzsgXzt9CiAgCi8vIENvbnN0cnVjdG9yIGZ1bmN0aW9uCgogICAgZnVuY3Rpb24gUGFzc1Rva2VuTWFuYWdlcigKICAgICAgICBQYXNzRGFvIF9wYXNzRGFvLAogICAgICAgIGFkZHJlc3MgX2Nsb25lZEZyb20sCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICB1aW50OCBfdG9rZW5EZWNpbWFscywKICAgICAgICBib29sIF90b2tlbiwKICAgICAgICBib29sIF90cmFuc2ZlcmFibGUsCiAgICAgICAgdWludCBfaW5pdGlhbFByaWNlTXVsdGlwbGllciwKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlKSB7CgogICAgICAgIHBhc3NEYW8gPSBfcGFzc0RhbzsKICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKICAgICAgICAKICAgICAgICBjbG9uZWRGcm9tID0gX2Nsb25lZEZyb207ICAgICAgICAgICAgCgogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsKICAgICAgICBkZWNpbWFscyA9IF90b2tlbkRlY2ltYWxzOwoKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgICAgICB0cmFuc2ZlcmFibGUgPSBfdHJhbnNmZXJhYmxlOwoKICAgICAgICBmdW5kaW5nc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gX2luaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgZnVuZGluZ3NbMF0uaW5mbGF0aW9uUmF0ZSA9IF9pbmZsYXRpb25SYXRlOwoKICAgICAgICBob2xkZXJzLmxlbmd0aCA9IDE7CiAgICB9CgovLyBTZXR0aW5nIGZ1bmN0aW9ucwoKICAgIGZ1bmN0aW9uIGluaXRpYWxUb2tlblN1cHBseSgKICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIAogICAgICAgIHVpbnQgX3F1YW50aXR5LAogICAgICAgIGJvb2wgX2xhc3QpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICBpZiAoaW5pdGlhbFRva2VuU3VwcGx5RG9uZSkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgYWRkSG9sZGVyKF9yZWNpcGllbnQpOwogICAgICAgIGlmIChfcmVjaXBpZW50ICE9IDAgJiYgX3F1YW50aXR5ICE9IDApIGNyZWF0ZVRva2VucyhfcmVjaXBpZW50LCBfcXVhbnRpdHkpOwogICAgICAgIAogICAgICAgIGlmIChfbGFzdCkgaW5pdGlhbFRva2VuU3VwcGx5RG9uZSA9IHRydWU7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2xvbmVUb2tlbnMoCiAgICAgICAgdWludCBfZnJvbSwKICAgICAgICB1aW50IF90bykgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgCiAgICAgICAgaW5pdGlhbFRva2VuU3VwcGx5RG9uZSA9IHRydWU7CiAgICAgICAgaWYgKF9mcm9tID09IDApIF9mcm9tID0gMTsKICAgICAgICAKICAgICAgICBQYXNzVG9rZW5NYW5hZ2VyIF9jbG9uZWRGcm9tID0gUGFzc1Rva2VuTWFuYWdlcihjbG9uZWRGcm9tKTsKICAgICAgICB1aW50IF9udW1iZXJPZkhvbGRlcnMgPSBfY2xvbmVkRnJvbS5udW1iZXJPZkhvbGRlcnMoKTsKICAgICAgICBpZiAoX3RvID09IDAgfHwgX3RvID4gX251bWJlck9mSG9sZGVycykgX3RvID0gX251bWJlck9mSG9sZGVyczsKICAgICAgICAKICAgICAgICBhZGRyZXNzIF9ob2xkZXI7CiAgICAgICAgdWludCBfYmFsYW5jZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSBfZnJvbTsgaSA8PSBfdG87IGkrKykgewogICAgICAgICAgICBfaG9sZGVyID0gX2Nsb25lZEZyb20uSG9sZGVyQWRkcmVzcyhpKTsKICAgICAgICAgICAgX2JhbGFuY2UgPSBfY2xvbmVkRnJvbS5iYWxhbmNlT2YoX2hvbGRlcik7CiAgICAgICAgICAgIGlmIChiYWxhbmNlc1tfaG9sZGVyXSA9PSAwICYmIF9iYWxhbmNlICE9IDApIHsKICAgICAgICAgICAgICAgIGFkZEhvbGRlcihfaG9sZGVyKTsKICAgICAgICAgICAgICAgIGNyZWF0ZVRva2VucyhfaG9sZGVyLCBfYmFsYW5jZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAgICAgCi8vIFRva2VuIGNyZWF0aW9uCgogICAgZnVuY3Rpb24gYWRkSG9sZGVyKGFkZHJlc3MgX2hvbGRlcikgaW50ZXJuYWwgewogICAgICAgIAogICAgICAgIGlmIChob2xkZXJJRFtfaG9sZGVyXSA9PSAwKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50IF9ob2xkZXJJRCA9IGhvbGRlcnMubGVuZ3RoKys7CiAgICAgICAgICAgIGhvbGRlcnNbX2hvbGRlcklEXSA9IF9ob2xkZXI7CiAgICAgICAgICAgIGhvbGRlcklEW19ob2xkZXJdID0gX2hvbGRlcklEOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbnMoCiAgICAgICAgYWRkcmVzcyBfaG9sZGVyLCAKICAgICAgICB1aW50IF90b2tlbkFtb3VudCkgaW50ZXJuYWwgewoKICAgICAgICBiYWxhbmNlc1tfaG9sZGVyXSArPSBfdG9rZW5BbW91bnQ7IAogICAgICAgIHRvdGFsVG9rZW5TdXBwbHkgKz0gX3Rva2VuQW1vdW50OwogICAgICAgIFRva2Vuc0NyZWF0ZWQobXNnLnNlbmRlciwgX2hvbGRlciwgX3Rva2VuQW1vdW50KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmV3YXJkVG9rZW5zRm9yQ2xpZW50KAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfYW1vdW50CiAgICAgICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgdWludCBfdG9rZW5BbW91bnQgPSBUb2tlbkFtb3VudChfYW1vdW50LCBwcmljZU11bHRpcGxpZXIoMCksIGFjdHVhbFByaWNlRGl2aXNvcigwKSk7CiAgICAgICAgaWYgKF90b2tlbkFtb3VudCA9PSAwKSB0aHJvdzsKCiAgICAgICAgYWRkSG9sZGVyKF9yZWNpcGllbnQpOwogICAgICAgIGNyZWF0ZVRva2VucyhfcmVjaXBpZW50LCBfdG9rZW5BbW91bnQpOwoKICAgICAgICByZXR1cm4gX3Rva2VuQW1vdW50OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nUnVsZXMoCiAgICAgICAgYWRkcmVzcyBfbW9kZXJhdG9yLAogICAgICAgIHVpbnQgX2luaXRpYWxQcmljZU11bHRpcGxpZXIsCiAgICAgICAgdWludCBfYW1vdW50VG9GdW5kLAogICAgICAgIHVpbnQgX21pbnV0ZXNGdW5kaW5nUGVyaW9kLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQKICAgICkgZXh0ZXJuYWwgb25seUNsaWVudCB7CgogICAgICAgIGlmIChfbW9kZXJhdG9yID09IGFkZHJlc3ModGhpcykKICAgICAgICAgICAgfHwgX21vZGVyYXRvciA9PSBDbGllbnQoKQogICAgICAgICAgICB8fCBfYW1vdW50VG9GdW5kID09IDAKICAgICAgICAgICAgfHwgX21pbnV0ZXNGdW5kaW5nUGVyaW9kID09IDAKICAgICAgICAgICAgfHwgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnRvdGFsV2VpR2l2ZW4gIT0gMAogICAgICAgICAgICApIHRocm93OwogICAgICAgICAgICAKICAgICAgICBmdW5kaW5nc1tfcHJvcG9zYWxJRF0ubW9kZXJhdG9yID0gX21vZGVyYXRvcjsKCiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmFtb3VudFRvRnVuZCA9IF9hbW91bnRUb0Z1bmQ7CiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmZ1bmRlZEFtb3VudCA9IDA7CgogICAgICAgIGlmIChfaW5pdGlhbFByaWNlTXVsdGlwbGllciA9PSAwKSB7CiAgICAgICAgICAgIGlmIChub3cgPCBmdW5kaW5nc1swXS5jbG9zaW5nVGltZSkgewogICAgICAgICAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPSAxMDAqcHJpY2VNdWx0aXBsaWVyKGxhc3RQcm9wb3NhbElEKS9hY3R1YWxQcmljZURpdmlzb3IobGFzdFByb3Bvc2FsSUQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPSAxMDAqcHJpY2VNdWx0aXBsaWVyKGxhc3RGdWVsZWRGdW5kaW5nSUQpL2FjdHVhbFByaWNlRGl2aXNvcihsYXN0RnVlbGVkRnVuZGluZ0lEKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5kaW5nc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmluaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uaW5pdGlhbFByaWNlTXVsdGlwbGllciA9IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyOwogICAgICAgICAgICBmdW5kaW5nc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gX2luaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChfaW5mbGF0aW9uUmF0ZSA9PSAwKSBmdW5kaW5nc1tfcHJvcG9zYWxJRF0uaW5mbGF0aW9uUmF0ZSA9IGZ1bmRpbmdzWzBdLmluZmxhdGlvblJhdGU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5pbmZsYXRpb25SYXRlID0gX2luZmxhdGlvblJhdGU7CiAgICAgICAgICAgIGZ1bmRpbmdzWzBdLmluZmxhdGlvblJhdGUgPSBfaW5mbGF0aW9uUmF0ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnN0YXJ0VGltZSA9IG5vdzsKICAgICAgICBmdW5kaW5nc1swXS5zdGFydFRpbWUgPSBub3c7CiAgICAgICAgCiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lID0gbm93ICsgX21pbnV0ZXNGdW5kaW5nUGVyaW9kICogMSBtaW51dGVzOwogICAgICAgIGZ1bmRpbmdzWzBdLmNsb3NpbmdUaW1lID0gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lOwogICAgICAgIAogICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS50b3RhbFdlaUdpdmVuID0gMDsKICAgICAgICAKICAgICAgICBsYXN0UHJvcG9zYWxJRCA9IF9wcm9wb3NhbElEOwogICAgICAgIAogICAgICAgIEZ1bmRpbmdSdWxlc1NldChfbW9kZXJhdG9yLCBfcHJvcG9zYWxJRCwgIF9hbW91bnRUb0Z1bmQsIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5zdGFydFRpbWUsIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5jbG9zaW5nVGltZSk7CiAgICB9IAogICAgCiAgICBmdW5jdGlvbiBzYWxlKAogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQsCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCAKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfc2FsZURhdGUsCiAgICAgICAgYm9vbCBfcHJlc2FsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIGlmIChfc2FsZURhdGUgPT0gMCkgX3NhbGVEYXRlID0gbm93OwoKICAgICAgICBpZiAoX3NhbGVEYXRlID4gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lCiAgICAgICAgICAgIHx8IF9zYWxlRGF0ZSA8IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5zdGFydFRpbWUKICAgICAgICAgICAgfHwgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnRvdGFsV2VpR2l2ZW4gKyBfYW1vdW50ID4gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmFtb3VudFRvRnVuZCkgcmV0dXJuOwoKICAgICAgICB1aW50IF90b2tlbkFtb3VudCA9IFRva2VuQW1vdW50KF9hbW91bnQsIHByaWNlTXVsdGlwbGllcihfcHJvcG9zYWxJRCksIHByaWNlRGl2aXNvcihfcHJvcG9zYWxJRCwgX3NhbGVEYXRlKSk7CiAgICAgICAgaWYgKF90b2tlbkFtb3VudCA9PSAwKSByZXR1cm47CiAgICAgICAgCiAgICAgICAgYWRkSG9sZGVyKF9yZWNpcGllbnQpOwogICAgICAgIGlmIChfcHJlc2FsZSkgewogICAgICAgICAgICBHaXZlbltfcHJvcG9zYWxJRF1bX3JlY2lwaWVudF0udG9rZW5BbW91bnQgKz0gX3Rva2VuQW1vdW50OwogICAgICAgIH0KICAgICAgICBlbHNlIGNyZWF0ZVRva2VucyhfcmVjaXBpZW50LCBfdG9rZW5BbW91bnQpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZUZ1bmRpbmcodWludCBfcHJvcG9zYWxJRCkgaW50ZXJuYWwgewogICAgICAgIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5mdW5kZWRBbW91bnQgPSBmdW5kaW5nc1tfcHJvcG9zYWxJRF0udG90YWxXZWlHaXZlbjsKICAgICAgICBsYXN0RnVlbGVkRnVuZGluZ0lEID0gX3Byb3Bvc2FsSUQ7CiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lID0gbm93OwogICAgICAgIEZ1bmRpbmdGdWVsZWQoX3Byb3Bvc2FsSUQsIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5mdW5kZWRBbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbmRQZW5kaW5nQW1vdW50cyggICAgICAgIAogICAgICAgIHVpbnQgX2Zyb20sCiAgICAgICAgdWludCBfdG8sCiAgICAgICAgYWRkcmVzcyBfYnV5ZXIpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAKICAgICAgICBpZiAoX2Zyb20gPT0gMCkgX2Zyb20gPSAxOwogICAgICAgIGlmIChfdG8gPT0gMCkgX3RvID0gbGFzdFByb3Bvc2FsSUQ7CiAgICAgICAgaWYgKF9idXllciA9PSAwKSBfYnV5ZXIgPSBtc2cuc2VuZGVyOwoKICAgICAgICB1aW50IF9hbW91bnQ7CiAgICAgICAgdWludCBfdG9rZW5BbW91bnQ7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50IGkgPSBfZnJvbTsgaSA8PSBfdG87IGkrKykgewoKICAgICAgICAgICAgaWYgKG5vdyA+IGZ1bmRpbmdzW2ldLmNsb3NpbmdUaW1lICYmIEdpdmVuW2ldW19idXllcl0ud2VpQW1vdW50ICE9IDApIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGZ1bmRpbmdzW2ldLmZ1bmRlZEFtb3VudCA9PSAwKSBfYW1vdW50ICs9IEdpdmVuW2ldW19idXllcl0ud2VpQW1vdW50OwogICAgICAgICAgICAgICAgZWxzZSBfdG9rZW5BbW91bnQgKz0gR2l2ZW5baV1bX2J1eWVyXS50b2tlbkFtb3VudDsKCiAgICAgICAgICAgICAgICBmdW5kaW5nc1tpXS50b3RhbFdlaUdpdmVuIC09IEdpdmVuW2ldW19idXllcl0ud2VpQW1vdW50OwogICAgICAgICAgICAgICAgR2l2ZW5baV1bX2J1eWVyXS50b2tlbkFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICBHaXZlbltpXVtfYnV5ZXJdLndlaUFtb3VudCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChfdG9rZW5BbW91bnQgPiAwKSB7CiAgICAgICAgICAgIGNyZWF0ZVRva2VucyhfYnV5ZXIsIF90b2tlbkFtb3VudCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoX2Ftb3VudCA+IDApIHsKICAgICAgICAgICAgaWYgKCFfYnV5ZXIuc2VuZChfYW1vdW50KSkgdGhyb3c7CiAgICAgICAgICAgIFJlZnVuZChfYnV5ZXIsIF9hbW91bnQpOwogICAgICAgIH0gZWxzZSByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3UGVuZGluZ0Ftb3VudHMoKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHNlbmRQZW5kaW5nQW1vdW50cygwLCAwLCBtc2cuc2VuZGVyKTsKICAgIH0gICAgICAgIAoKLy8gRnVuZGluZyBNb2RlcmF0b3IgZnVuY3Rpb25zCgogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9wcm9wb3NhbElELCB1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsIHsKICAgICAgICBpZiAoKG1zZy5zZW5kZXIgIT0gIGZ1bmRpbmdzW19wcm9wb3NhbElEXS5tb2RlcmF0b3IpIHx8IG5vdyA+IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5jbG9zaW5nVGltZSkgdGhyb3c7CiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0RnVuZGluZ0Z1ZWxlZCh1aW50IF9wcm9wb3NhbElEKSBleHRlcm5hbCB7CgogICAgICAgIGlmICgobXNnLnNlbmRlciAhPSAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLm1vZGVyYXRvcikgfHwgbm93ID4gZnVuZGluZ3NbX3Byb3Bvc2FsSURdLmNsb3NpbmdUaW1lKSB0aHJvdzsKCiAgICAgICAgY2xvc2VGdW5kaW5nKF9wcm9wb3NhbElEKTsKICAgIH0KICAgIAovLyBUb2tlbnMgdHJhbnNmZXIgbWFuYWdlbWVudCAgICAKICAgIAogICAgZnVuY3Rpb24gYWJsZVRyYW5zZmVyKCkgb25seUNsaWVudCB7CiAgICAgICAgaWYgKCF0cmFuc2ZlcmFibGUpIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgVHJhbnNmZXJBYmxlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcigpIG9ubHlDbGllbnQgewogICAgICAgIGlmICh0cmFuc2ZlcmFibGUpIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIFRyYW5zZmVyRGlzYWJsZSgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmxvY2tUcmFuc2ZlcihhZGRyZXNzIF9zaGFyZUhvbGRlciwgdWludCBfZGVhZExpbmUpIGV4dGVybmFsIG9ubHlDbGllbnQgb25seVNoYXJlTWFuYWdlciB7CiAgICAgICAgaWYgKF9kZWFkTGluZSA+IGJsb2NrZWREZWFkTGluZVtfc2hhcmVIb2xkZXJdKSB7CiAgICAgICAgICAgIGJsb2NrZWREZWFkTGluZVtfc2hhcmVIb2xkZXJdID0gX2RlYWRMaW5lOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tVG8oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywgCiAgICAgICAgdWludDI1NiBfdmFsdWUKICAgICAgICApIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgeyAgCgogICAgICAgIGlmICgodHJhbnNmZXJhYmxlKQogICAgICAgICAgICAmJiBub3cgPiBibG9ja2VkRGVhZExpbmVbX2Zyb21dCiAgICAgICAgICAgICYmIG5vdyA+IGJsb2NrZWREZWFkTGluZVtfdG9dCiAgICAgICAgICAgICYmIF90byAhPSBhZGRyZXNzKHRoaXMpCiAgICAgICAgICAgICYmIGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUKICAgICAgICAgICAgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKCiAgICAgICAgICAgIGFkZEhvbGRlcihfdG8pOwogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7ICAKICAgICAgICBpZiAoIXRyYW5zZmVyRnJvbVRvKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKSkgdGhyb3c7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKAogICAgICAgIGFkZHJlc3MgX2Zyb20sIAogICAgICAgIGFkZHJlc3MgX3RvLCAKICAgICAgICB1aW50MjU2IF92YWx1ZQogICAgICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7IAogICAgICAgIAogICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF92YWx1ZQogICAgICAgICAgICB8fCAhdHJhbnNmZXJGcm9tVG8oX2Zyb20sIF90bywgX3ZhbHVlKSkgdGhyb3c7CiAgICAgICAgICAgIAogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAp9CiAgICAKCgpwcmFnbWEgc29saWRpdHkgXjAuNC44OwoKLyoKICoKICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uCiAqCiAqIFRoZSBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IGlzIHVzZWQgZm9yIHRoZSBtYW5hZ2VtZW50IG9mIHRoZSBEYW8gYWNjb3VudCwgc2hhcmVzIGFuZCB0b2tlbnMuCiAqCiovCgovLy8gQHRpdGxlIE1hbmFnZXIgc21hcnQgY29udHJhY3Qgb2YgdGhlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbgpjb250cmFjdCBQYXNzTWFuYWdlciBpcyBQYXNzVG9rZW5NYW5hZ2VyIHsKICAgIAogICAgc3RydWN0IG9yZGVyIHsKICAgICAgICBhZGRyZXNzIGJ1eWVyOwogICAgICAgIHVpbnQgd2VpR2l2ZW47CiAgICB9CiAgICAvLyBPcmRlcnMgdG8gYnV5IHRva2VucwogICAgb3JkZXJbXSBwdWJsaWMgb3JkZXJzOwogICAgLy8gTnVtYmVyIG9yIG9yZGVycyB0byBidXkgdG9rZW5zCiAgICB1aW50IG51bWJlck9mT3JkZXJzOwoKICAgIC8vIE1hcCB0byBrbm93IGlmIGFuIG9yZGVyIHdhcyBjbG9uZWQgZnJvbSB0aGUgcHJlY2VkZW50IG1hbmFnZXIgYWZ0ZXIgYW4gdXBncmFkZQogICAgbWFwcGluZyAodWludCA9PiBib29sKSBvcmRlckNsb25lZDsKICAgIAogICAgZnVuY3Rpb24gUGFzc01hbmFnZXIoCiAgICAgICAgUGFzc0RhbyBfcGFzc0RhbywKICAgICAgICBhZGRyZXNzIF9jbG9uZWRGcm9tLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgdWludDggX3Rva2VuRGVjaW1hbHMsCiAgICAgICAgYm9vbCBfdG9rZW4sCiAgICAgICAgYm9vbCBfdHJhbnNmZXJhYmxlLAogICAgICAgIHVpbnQgX2luaXRpYWxQcmljZU11bHRpcGxpZXIsCiAgICAgICAgdWludCBfaW5mbGF0aW9uUmF0ZSkgCiAgICAgICAgUGFzc1Rva2VuTWFuYWdlciggX3Bhc3NEYW8sIF9jbG9uZWRGcm9tLCBfdG9rZW5OYW1lLCBfdG9rZW5TeW1ib2wsIF90b2tlbkRlY2ltYWxzLCAKICAgICAgICAgICAgX3Rva2VuLCBfdHJhbnNmZXJhYmxlLCBfaW5pdGlhbFByaWNlTXVsdGlwbGllciwgX2luZmxhdGlvblJhdGUpIHsgfQogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byByZWNlaXZlIHBheW1lbnRzCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIG9ubHlTaGFyZU1hbmFnZXIgeyB9CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIGNsaWVudCB0byBzZW5kIGV0aGVycwogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBhZGRyZXNzIHRvIHNlbmQgdG8KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIHRvIHNlbmQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gc2VuZFRvKAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwKICAgICAgICB1aW50IF9hbW91bnQKICAgICkgZXh0ZXJuYWwgb25seUNsaWVudCByZXR1cm5zIChib29sKSB7CgogICAgICAgIGlmIChfcmVjaXBpZW50LnNlbmQoX2Ftb3VudCkpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGJ1eSB0b2tlbnMgYW5kIHByb21vdGUgYSBwcm9wb3NhbCAKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGJ1eWVyCiAgICAvLy8gQHBhcmFtIF9kYXRlIFRoZSB1bml4IGRhdGUgdG8gY29uc2lkZXIgZm9yIHRoZSBzaGFyZSBvciB0b2tlbiBwcmljZSBjYWxjdWxhdGlvbgogICAgLy8vIEBwYXJhbSBfcHJlc2FsZSBUcnVlIGlmIHByZXNhbGUKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdCAKICAgIGZ1bmN0aW9uIGJ1eVRva2Vuc0ZvcigKICAgICAgICB1aW50IF9wcm9wb3NhbElELAogICAgICAgIGFkZHJlc3MgX2J1eWVyLCAKICAgICAgICB1aW50IF9kYXRlLAogICAgICAgIGJvb2wgX3ByZXNhbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgaWYgKF9wcm9wb3NhbElEID09IDAgfHwgIXNhbGUoX3Byb3Bvc2FsSUQsIF9idXllciwgbXNnLnZhbHVlLCBfZGF0ZSwgX3ByZXNhbGUpKSB0aHJvdzsKCiAgICAgICAgZnVuZGluZ3NbX3Byb3Bvc2FsSURdLnRvdGFsV2VpR2l2ZW4gKz0gbXNnLnZhbHVlOyAgICAgICAgCiAgICAgICAgaWYgKGZ1bmRpbmdzW19wcm9wb3NhbElEXS50b3RhbFdlaUdpdmVuID09IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5hbW91bnRUb0Z1bmQpIGNsb3NlRnVuZGluZyhfcHJvcG9zYWxJRCk7CgogICAgICAgIEdpdmVuW19wcm9wb3NhbElEXVtfYnV5ZXJdLndlaUFtb3VudCArPSBtc2cudmFsdWU7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGJ1eSB0b2tlbnMgYW5kIHByb21vdGUgYSBwcm9wb3NhbCAKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGJ1eWVyIChub3QgbWFuZGF0b3J5LCBtc2cuc2VuZGVyIGlmIDApCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiBidXlUb2tlbnNGb3JQcm9wb3NhbCgKICAgICAgICB1aW50IF9wcm9wb3NhbElELCAKICAgICAgICBhZGRyZXNzIF9idXllcikgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CgogICAgICAgIGlmIChfYnV5ZXIgPT0gMCkgX2J1eWVyID0gbXNnLnNlbmRlcjsKCiAgICAgICAgaWYgKGZ1bmRpbmdzW19wcm9wb3NhbElEXS5tb2RlcmF0b3IgIT0gMCkgdGhyb3c7CgogICAgICAgIHJldHVybiBidXlUb2tlbnNGb3IoX3Byb3Bvc2FsSUQsIF9idXllciwgbm93LCB0cnVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBtb2RlcmF0b3IgdG8gYnV5IHNoYXJlcyBvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgSW5kZXggb2YgdGhlIGNsaWVudCBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCBvZiBzaGFyZXMgb3IgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9kYXRlIFRoZSB1bml4IGRhdGUgdG8gY29uc2lkZXIgZm9yIHRoZSBzaGFyZSBvciB0b2tlbiBwcmljZSBjYWxjdWxhdGlvbgogICAgLy8vIEBwYXJhbSBfcHJlc2FsZSBUcnVlIGlmIHByZXNhbGUKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGZ1bmN0aW9uIHdhcyBzdWNjZXNzZnVsIG9yIG5vdCAKICAgIGZ1bmN0aW9uIGJ1eVRva2VuRnJvbU1vZGVyYXRvcigKICAgICAgICB1aW50IF9wcm9wb3NhbElELAogICAgICAgIGFkZHJlc3MgX2J1eWVyLCAKICAgICAgICB1aW50IF9kYXRlLAogICAgICAgIGJvb2wgX3ByZXNhbGUpIHBheWFibGUgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCl7CgogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGZ1bmRpbmdzW19wcm9wb3NhbElEXS5tb2RlcmF0b3IpIHRocm93OwoKICAgICAgICByZXR1cm4gYnV5VG9rZW5zRm9yKF9wcm9wb3NhbElELCBfYnV5ZXIsIF9kYXRlLCBfcHJlc2FsZSk7CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY3JlYXRlIGEgYnV5IG9yZGVyCiAgICAvLy8gQHBhcmFtIF9idXllciBUaGUgYWRkcmVzcyBvZiB0aGUgYnV5ZXIKICAgIC8vLyBAcGFyYW0gX3dlaUdpdmVuIFRoZSBhbW91bnQgaW4gd2VpIGdpdmVuIGJ5IHRoZSBidXllcgogICAgZnVuY3Rpb24gYWRkT3JkZXIoCiAgICAgICAgYWRkcmVzcyBfYnV5ZXIsIAogICAgICAgIHVpbnQgX3dlaUdpdmVuKSBpbnRlcm5hbCB7CgogICAgICAgIHVpbnQgaTsKICAgICAgICBudW1iZXJPZk9yZGVycyArPSAxOwoKICAgICAgICBpZiAobnVtYmVyT2ZPcmRlcnMgPiBvcmRlcnMubGVuZ3RoKSBpID0gb3JkZXJzLmxlbmd0aCsrOwogICAgICAgIGVsc2UgaSA9IG51bWJlck9mT3JkZXJzIC0gMTsKICAgICAgICAKICAgICAgICBvcmRlcnNbaV0uYnV5ZXIgPSBfYnV5ZXI7CiAgICAgICAgb3JkZXJzW2ldLndlaUdpdmVuID0gX3dlaUdpdmVuOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIHJlbW92ZSBhIGJ1eSBvcmRlcgogICAgLy8vIEBwYXJhbSBfb3JkZXIgVGhlIGluZGV4IG9mIHRoZSBvcmRlciB0byByZW1vdmUKICAgIGZ1bmN0aW9uIHJlbW92ZU9yZGVyKHVpbnQgX29yZGVyKSBpbnRlcm5hbCB7CiAgICAgICAgCiAgICAgICAgaWYgKG51bWJlck9mT3JkZXJzIC0gMSA8IF9vcmRlcikgcmV0dXJuOwoKICAgICAgICBudW1iZXJPZk9yZGVycyAtPSAxOwogICAgICAgIGlmIChudW1iZXJPZk9yZGVycyA+IDApIHsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSBfb3JkZXI7IGkgPD0gbnVtYmVyT2ZPcmRlcnMgLSAxOyBpKyspIHsKICAgICAgICAgICAgICAgIG9yZGVyc1tpXS5idXllciA9IG9yZGVyc1tpKzFdLmJ1eWVyOwogICAgICAgICAgICAgICAgb3JkZXJzW2ldLndlaUdpdmVuID0gb3JkZXJzW2krMV0ud2VpR2l2ZW47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3JkZXJzW251bWJlck9mT3JkZXJzXS5idXllciA9IDA7CiAgICAgICAgb3JkZXJzW251bWJlck9mT3JkZXJzXS53ZWlHaXZlbiA9IDA7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGNyZWF0ZSBvcmRlcnMgdG8gYnV5IHRva2VucwogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgZnVuY3Rpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBidXlUb2tlbnMoKSBwYXlhYmxlIHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgaWYgKCF0cmFuc2ZlcmFibGUgfHwgbXNnLnZhbHVlIDwgMTAwIGZpbm5leSkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgYWRkT3JkZXIobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gc2VsbCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3Rva2VuQW1vdW50IGluIHRva2VucyB0byBzZWxsCiAgICAvLy8gQHBhcmFtIF9mcm9tIEluZGV4IG9mIHRoZSBmaXJzdCBvcmRlcgogICAgLy8vIEBwYXJhbSBfdG8gSW5kZXggb2YgdGhlIGxhc3Qgb3JkZXIKICAgIC8vLyBAcmV0dXJuIHRoZSByZXZlbnVlIGluIHdlaQogICAgZnVuY3Rpb24gc2VsbFRva2VucygKICAgICAgICB1aW50IF90b2tlbkFtb3VudCwKICAgICAgICB1aW50IF9mcm9tLAogICAgICAgIHVpbnQgX3RvKSByZXR1cm5zICh1aW50KSB7CgogICAgICAgIGlmICghdHJhbnNmZXJhYmxlIAogICAgICAgICAgICB8fCB1aW50KGJhbGFuY2VzW21zZy5zZW5kZXJdKSA8IF9hbW91bnQgCiAgICAgICAgICAgIHx8IG51bWJlck9mT3JkZXJzID09IDApIHRocm93OwogICAgICAgIAogICAgICAgIGlmIChfdG8gPT0gMCB8fCBfdG8gPiBudW1iZXJPZk9yZGVycyAtIDEpIF90byA9IG51bWJlck9mT3JkZXJzIC0gMTsKICAgICAgICAKICAgICAgICAKICAgICAgICB1aW50IF90b2tlbkFtb3VudG87CiAgICAgICAgdWludCBfYW1vdW50OwogICAgICAgIHVpbnQgX3RvdGFsQW1vdW50OwogICAgICAgIHVpbnQgbyA9IF9mcm9tOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IF9mcm9tOyBpIDw9IF90bzsgaSsrKSB7CgogICAgICAgICAgICBpZiAoX3Rva2VuQW1vdW50ID4gMCAmJiBvcmRlcnNbb10uYnV5ZXIgIT0gbXNnLnNlbmRlcikgewoKICAgICAgICAgICAgICAgIF90b2tlbkFtb3VudG8gPSBUb2tlbkFtb3VudChvcmRlcnNbb10ud2VpR2l2ZW4sIHByaWNlTXVsdGlwbGllcigwKSwgYWN0dWFsUHJpY2VEaXZpc29yKDApKTsKCiAgICAgICAgICAgICAgICBpZiAoX3Rva2VuQW1vdW50ID49IF90b2tlbkFtb3VudG8gCiAgICAgICAgICAgICAgICAgICAgJiYgdHJhbnNmZXJGcm9tVG8obXNnLnNlbmRlciwgb3JkZXJzW29dLmJ1eWVyLCBfdG9rZW5BbW91bnRvKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgX3Rva2VuQW1vdW50IC09IF90b2tlbkFtb3VudG87CiAgICAgICAgICAgICAgICAgICAgX3RvdGFsQW1vdW50ICs9IG9yZGVyc1tvXS53ZWlHaXZlbjsKICAgICAgICAgICAgICAgICAgICByZW1vdmVPcmRlcihvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKF90b2tlbkFtb3VudCA8IF90b2tlbkFtb3VudG8KICAgICAgICAgICAgICAgICAgICAmJiB0cmFuc2ZlckZyb21Ubyhtc2cuc2VuZGVyLCBvcmRlcnNbb10uYnV5ZXIsIF90b2tlbkFtb3VudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgX2Ftb3VudCA9IHdlaUFtb3VudChfdG9rZW5BbW91bnQsIHByaWNlTXVsdGlwbGllcigwKSwgYWN0dWFsUHJpY2VEaXZpc29yKDApKTsKICAgICAgICAgICAgICAgICAgICBvcmRlcnNbb10ud2VpR2l2ZW4gLT0gX2Ftb3VudDsKICAgICAgICAgICAgICAgICAgICBfdG90YWxBbW91bnQgKz0gX2Ftb3VudDsKICAgICAgICAgICAgICAgICAgICBpID0gX3RvICsgMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgbyArPSAxOwogICAgICAgICAgICB9IAogICAgICAgICAgICBlbHNlIG8gKz0gMTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoX3RvdGFsQW1vdW50KSkgdGhyb3c7CiAgICAgICAgZWxzZSByZXR1cm4gX3RvdGFsQW1vdW50OwogICAgfSAgICAKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byByZW1vdmUgeW91ciBvcmRlcnMgYW5kIHJlZnVuZAogICAgLy8vIEBwYXJhbSBfZnJvbSBJbmRleCBvZiB0aGUgZmlyc3Qgb3JkZXIKICAgIC8vLyBAcGFyYW0gX3RvIEluZGV4IG9mIHRoZSBsYXN0IG9yZGVyCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHJlbW92ZU9yZGVycygKICAgICAgICB1aW50IF9mcm9tLAogICAgICAgIHVpbnQgX3RvKSByZXR1cm5zIChib29sKSB7CgogICAgICAgIGlmIChfdG8gPT0gMCB8fCBfdG8gPiBudW1iZXJPZk9yZGVycykgX3RvID0gbnVtYmVyT2ZPcmRlcnMgLTE7CiAgICAgICAgCiAgICAgICAgdWludCBfdG90YWxBbW91bnQ7CiAgICAgICAgdWludCBvID0gX2Zyb207CgogICAgICAgIGZvciAodWludCBpID0gX2Zyb207IGkgPD0gX3RvOyBpKyspIHsKCiAgICAgICAgICAgIGlmIChvcmRlcnNbb10uYnV5ZXIgPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBfdG90YWxBbW91bnQgKz0gb3JkZXJzW29dLndlaUdpdmVuOwogICAgICAgICAgICAgICAgcmVtb3ZlT3JkZXIobyk7CgogICAgICAgICAgICB9IGVsc2UgbyArPSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFtc2cuc2VuZGVyLnNlbmQoX3RvdGFsQW1vdW50KSkgdGhyb3c7CiAgICAgICAgZWxzZSByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAp9'.
	

]
