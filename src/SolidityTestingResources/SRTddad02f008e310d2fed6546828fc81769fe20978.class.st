Class {
	#name : #SRTddad02f008e310d2fed6546828fc81769fe20978,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTddad02f008e310d2fed6546828fc81769fe20978 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjA7CgovKioKICogQXV0aG9yZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wgCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuIAogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKiogCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgaW50ZXJuYWwgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4gCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLiAKICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8qKgogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLgogKgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBldmVudCBIYWx0ZWQoYm9vbCBoYWx0ZWQpOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZSghaGFsdGVkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZShoYWx0ZWQpOwogICAgXzsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBoYWx0ZWQgPSB0cnVlOwogICAgSGFsdGVkKHRydWUpOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgICBIYWx0ZWQoZmFsc2UpOwogIH0KCn0KLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KCi8qKgogKiBJbnRlcmZhY2UgZm9yIHRoZSBzdGFuZGFyZCB0b2tlbi4KICogQmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQKICovCmludGVyZmFjZSBFSVAyMFRva2VuIHsKCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CgogIC8qKgogICoqIE9wdGlvbmFsIGZ1bmN0aW9ucwogICoKICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBzeW1ib2wpOwogIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDggZGVjaW1hbHMpOwogICoKICAqKi8KCn0KCi8vIEludGVyZmFjZSBmb3IgYnVybmluZyB0b2tlbnMKY29udHJhY3QgQnVybmFibGUgewogIC8vIEBkZXYgRGVzdHJveXMgdG9rZW5zIGZvciBhbiBhY2NvdW50CiAgLy8gQHBhcmFtIGFjY291bnQgQWNjb3VudCB3aG9zZSB0b2tlbnMgYXJlIGRlc3Ryb3llZAogIC8vIEBwYXJhbSB2YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRvIGRlc3Ryb3kKICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgYWNjb3VudCwgdWludCB2YWx1ZSkgaW50ZXJuYWw7CiAgZXZlbnQgQnVybmVkKGFkZHJlc3MgYWNjb3VudCwgdWludCB2YWx1ZSk7Cn0KCi8qKgogKiBJbnRlcm5hbCBpbnRlcmZhY2UgZm9yIHRoZSBtaW50aW5nIG9mIHRva2Vucy4KICovCmNvbnRyYWN0IE1pbnRhYmxlIHsKCiAgLyoqCiAgICogQGRldiBNaW50cyB0b2tlbnMgZm9yIGFuIGFjY291bnQKICAgKiBUaGlzIGZ1bmN0aW9uIHNob3VsZCBlbWl0IHRoZSBNaW50ZWQgZXZlbnQuCiAgICovCiAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBpbnRlcm5hbDsKCiAgLyoqIFRva2VuIHN1cHBseSBnb3QgaW5jcmVhc2VkIGFuZCBhIG5ldyBvd25lciByZWNlaXZlZCB0aGVzZSB0b2tlbnMgKi8KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIHRva2VuCiAqIEBkZXYgQmFzaWMgaW1wbGVtZW50YXRpb24gb2YgdGhlIEVJUDIwIHN0YW5kYXJkIHRva2VuIChhbHNvIGtub3duIGFzIEVSQzIwIHRva2VuKS4KICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRUlQMjBUb2tlbiwgQnVybmFibGUsIE1pbnRhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgdWludCBwcml2YXRlIHRvdGFsX3N1cHBseTsKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHJpdmF0ZSBiYWxhbmNlczsKICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgcHJpdmF0ZSBhbGxvd2VkOwoKCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG90YWxfc3VwcGx5OwogIH0KCiAgLyoqCiAgICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICAqIEBwYXJhbSB0byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgKiBAcGFyYW0gdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1Yih2YWx1ZSk7CiAgICBiYWxhbmNlc1t0b10gPSBiYWxhbmNlc1t0b10uYWRkKHZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICogQHBhcmFtIGFjY291bnQgVGhlIGFkZHJlc3Mgd2hvc2UgYmFsYW5jZSBpcyB0byBiZSBxdWVyaWVkLgogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgYWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbYWNjb3VudF07CiAgfQoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSB2YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgYWxsb3dhbmNlID0gYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKGFsbG93YW5jZSwgdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlKHZhbHVlIDw9IGFsbG93YW5jZSk7CiAgICAvLyBTYWZlTWF0aCB1c2VzIGFzc2VydCBpbnN0ZWFkIG9mIHJlcXVpcmUgdGhvdWdoLCBiZXdhcmUgd2hlbiB1c2luZyBhbiBhbmFseXNpcyB0b29sCgogICAgYmFsYW5jZXNbZnJvbV0gPSBiYWxhbmNlc1tmcm9tXS5zdWIodmFsdWUpOwogICAgYmFsYW5jZXNbdG9dID0gYmFsYW5jZXNbdG9dLmFkZCh2YWx1ZSk7CiAgICBhbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dhbmNlLnN1Yih2YWx1ZSk7CiAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBzcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSB2YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXMnCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShzcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSAodmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID09IDApOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBhY2NvdW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIHNwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgYWNjb3VudCwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbYWNjb3VudF1bc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBBdG9taWMgaW5jcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nCiAgICoKICAgKiBXb3JrcyBhcm91bmQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKgogICAqLwogIGZ1bmN0aW9uIGFkZEFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBhZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdOwogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gb2xkVmFsdWUuYWRkKGFkZGVkVmFsdWUpOwogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdKTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBBdG9taWMgZGVjcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nLgogICAqCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICovCiAgZnVuY3Rpb24gc3ViQXBwcm92YWwoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHN1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgdWludCBvbGRWYWwgPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdOwoKICAgICAgaWYgKHN1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbCkgewogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gb2xkVmFsLnN1YihzdWJ0cmFjdGVkVmFsdWUpOwogICAgICB9CiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0pOwogICAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJvdmlkZXMgYW4gaW50ZXJuYWwgZnVuY3Rpb24gZm9yIGRlc3Ryb3lpbmcgdG9rZW5zLiBVc2VmdWwgZm9yIHVwZ3JhZGVzLgogICAqLwogIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBiYWxhbmNlc1thY2NvdW50XSA9IGJhbGFuY2VzW2FjY291bnRdLnN1Yih2YWx1ZSk7CiAgICB0b3RhbF9zdXBwbHkgPSB0b3RhbF9zdXBwbHkuc3ViKHZhbHVlKTsKICAgIFRyYW5zZmVyKGFjY291bnQsIDAsIHZhbHVlKTsKICAgIEJ1cm5lZChhY2NvdW50LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IFByb3ZpZGVzIGFuIGludGVybmFsIG1pbnRpbmcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7CiAgICB0b3RhbF9zdXBwbHkgPSB0b3RhbF9zdXBwbHkuYWRkKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKGFtb3VudCk7CiAgICBNaW50ZWQocmVjZWl2ZXIsIGFtb3VudCk7CgogICAgLy8gQmV3YXJlOiBBZGRyZXNzIHplcm8gbWF5IGJlIHVzZWQgZm9yIHNwZWNpYWwgdHJhbnNhY3Rpb25zIGluIGEgZnV0dXJlIGZvcmsuCiAgICAvLyBUaGlzIHdpbGwgbWFrZSB0aGUgbWludCB0cmFuc2FjdGlvbiBhcHBlYXIgaW4gRXRoZXJTY2FuLmlvCiAgICAvLyBXZSBjYW4gcmVtb3ZlIHRoaXMgYWZ0ZXIgdGhlcmUgaXMgYSBzdGFuZGFyZGl6ZWQgbWludGluZyBldmVudAogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7CiAgfQogIAp9CgovKioKICogRGVmaW5lIGludGVyZmFjZSBmb3IgcmVsZWFzaW5nIHRoZSB0b2tlbiB0cmFuc2ZlciBhZnRlciBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLgogKi8KY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICAvKiBUaGUgZmluYWxpemVyIGNvbnRyYWN0IHRoYXQgYWxsb3dzIGxpZnRpbmcgdGhlIHRyYW5zZmVyIGxpbWl0cyBvbiB0aGlzIHRva2VuICovCiAgYWRkcmVzcyBwdWJsaWMgcmVsZWFzZUFnZW50OwoKICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOwoKICAvKiogTWFwIG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2VucyByZWdhcmRsZXNzIG9mIHRoZSBsb2NrIGRvd24gcGVyaW9kLiBUaGVzZSBhcmUgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhbmQgcG9zc2libGUgdGhlIHRlYW0gbXVsdGlzaWcgaXRzZWxmLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOwoKICAvKioKICAgKiBTZXQgdGhlIGNvbnRyYWN0IHRoYXQgY2FuIGNhbGwgcmVsZWFzZSBhbmQgbWFrZSB0aGUgdG9rZW4gdHJhbnNmZXJhYmxlLgogICAqCiAgICogU2luY2UgdGhlIG93bmVyIG9mIHRoaXMgY29udHJhY3QgaXMgKG9yIHNob3VsZCBiZSkgdGhlIGNyb3dkc2FsZSwKICAgKiBpdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgYSBjb3JyZXNwb25kaW5nIGV4cG9zZWQgQVBJIGluIHRoZSBjcm93ZHNhbGUgY29udHJhY3QgaW4gY2FzZSBvZiBpbnB1dCBlcnJvci4KICAgKi8KICBmdW5jdGlvbiBzZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICAvLyBXZSBkb24ndCBkbyBpbnRlcmZhY2UgY2hlY2sgaGVyZSBhcyB3ZSBtaWdodCB3YW50IHRvIGhhdmUgYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudC4KICAgIHJlbGVhc2VBZ2VudCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBwYXJ0aWN1bGFyIGFkZHJlc3MgKGUuZy4gYSBjcm93ZHNhbGUgY29udHJhY3QpIHRvIHRyYW5zZmVyIHRva2VucyBkZXNwaXRlIHRoZSBsb2NrIHVwIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgdHJhbnNmZXJBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICB9CgogIC8qKgogICAqIE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIGludG8gdGhlIHdpbGQuCiAgICoKICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IHNob3VsZCB0eXBpY2FsbHkgYmUgdGhlIGZpbmFsaXplIGFnZW50IElDTyBjb250cmFjdC4KICAgKiBJbiB0aGUgc2NvcGUgb2YgdGhlIGNyb3dkc2FsZSwgaXQgaXMgb25seSBjYWxsZWQgaWYgdGhlIGNyb3dkc2FsZSBoYXMgYmVlbiBhIHN1Y2Nlc3MgKGZpcnN0IG1pbGVzdG9uZSByZWFjaGVkKS4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIHJlbGVhc2VkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIExpbWl0IHRva2VuIHRyYW5zZmVyIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIHNlbmRlcikgewogICAgcmVxdWlyZShyZWxlYXNlZCB8fCB0cmFuc2ZlckFnZW50c1tzZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBiZWZvcmUgb3IgYWZ0ZXIgdGhlIHRva2VucyBoYXZlIGJlZW4gcmVsZWFzZWQgKi8KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgewogICAgcmVxdWlyZShyZWxlYXNlU3RhdGUgPT0gcmVsZWFzZWQpOwogICAgXzsKICB9CgogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGEgd2hpdGVsaXN0ZWQgcmVsZWFzZSBhZ2VudC4gKi8KICBtb2RpZmllciBvbmx5UmVsZWFzZUFnZW50KCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHJlbGVhc2VBZ2VudCk7CiAgICBfOwogIH0KCiAgLyoqIFdlIHJlc3RyaWN0IHRyYW5zZmVyIGJ5IG92ZXJyaWRpbmcgaXQgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICB9CgogIC8qKiBXZSByZXN0cmljdCB0cmFuc2ZlckZyb20gYnkgb3ZlcnJpZGluZyBpdCAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2Zlcihmcm9tKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlckZvcm0oKQogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogIH0KCn0KCi8qKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKgogKiBUaGUgVXBncmFkZSBhZ2VudCBpcyB0aGUgaW50ZXJmYWNlIHVzZWQgdG8gaW1wbGVtZW50IGEgdG9rZW4KICogbWlncmF0aW9uIGluIHRoZSBjYXNlIG9mIGFuIGVtZXJnZW5jeS4KICogVGhlIGZ1bmN0aW9uIHVwZ3JhZGVGcm9tIGhhcyB0byBpbXBsZW1lbnQgdGhlIHBhcnQgb2YgdGhlIGNyZWF0aW9uCiAqIG9mIG5ldyB0b2tlbnMgb24gYmVoYWxmIG9mIHRoZSB1c2VyIGRvaW5nIHRoZSB1cGdyYWRlLgogKgogKiBUaGUgbmV3IHRva2VuIGNhbiBpbXBsZW1lbnQgdGhpcyBpbnRlcmZhY2UgZGlyZWN0bHksIG9yIHVzZS4KICovCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCB7CgogIC8qKiBUaGlzIHZhbHVlIHNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgb3JpZ2luYWwgdG9rZW4ncyB0b3RhbCBzdXBwbHkgKi8KICB1aW50IHB1YmxpYyBvcmlnaW5hbFN1cHBseTsKCiAgLyoqIEludGVyZmFjZSB0byBlbnN1cmUgdGhlIGNvbnRyYWN0IGlzIGNvcnJlY3RseSBjb25maWd1cmVkICovCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogIFVwZ3JhZGUgYW4gYWNjb3VudAoKICBXaGVuIHRoZSB0b2tlbiBjb250cmFjdCBpcyBpbiB0aGUgdXBncmFkZSBzdGF0dXMgdGhlIGVhY2ggdXNlciB3aWxsCiAgaGF2ZSB0byBjYWxsIGB1cGdyYWRlKHZhbHVlKWAgZnVuY3Rpb24gZnJvbSBVcGdyYWRlYWJsZVRva2VuLgoKICBUaGUgdXBncmFkZSBmdW5jdGlvbiBhZGp1c3QgdGhlIGJhbGFuY2Ugb2YgdGhlIHVzZXIgYW5kIHRoZSBzdXBwbHkKICBvZiB0aGUgcHJldmlvdXMgdG9rZW4gYW5kIHRoZW4gY2FsbCBgdXBncmFkZUZyb20odmFsdWUpYC4KCiAgVGhlIFVwZ3JhZGVBZ2VudCBpcyB0aGUgcmVzcG9uc2libGUgdG8gY3JlYXRlIHRoZSB0b2tlbnMgZm9yIHRoZSB1c2VyCiAgaW4gdGhlIG5ldyBjb250cmFjdC4KCiAgKiBAcGFyYW0gZnJvbSBBY2NvdW50IHRvIHVwZ3JhZGUuCiAgKiBAcGFyYW0gdmFsdWUgVG9rZW5zIHRvIHVwZ3JhZGUuCgogICovCiAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBmcm9tLCB1aW50IHZhbHVlKSBwdWJsaWM7Cgp9CgoKLyoqCiAqIEEgdG9rZW4gdXBncmFkZSBtZWNoYW5pc20gd2hlcmUgdXNlcnMgY2FuIG9wdC1pbiBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBuZXh0IHNtYXJ0IGNvbnRyYWN0IHJldmlzaW9uLgogKgogKi8KY29udHJhY3QgVXBncmFkZWFibGVUb2tlbiBpcyBFSVAyMFRva2VuLCBCdXJuYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qKiBDb250cmFjdCAvIHBlcnNvbiB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiBUaGlzIGNhbiBiZSB0aGUgc2FtZSBhcyB0ZWFtIG11bHRpc2lnIHdhbGxldCwgYXMgd2hhdCBpdCBpcyB3aXRoIGl0cyBkZWZhdWx0IHZhbHVlLiAqLwogIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXI7CgogIC8qKiBUaGUgbmV4dCBjb250cmFjdCB3aGVyZSB0aGUgdG9rZW5zIHdpbGwgYmUgbWlncmF0ZWQuICovCiAgVXBncmFkZUFnZW50IHB1YmxpYyB1cGdyYWRlQWdlbnQ7CgogIC8qKiBIb3cgbWFueSB0b2tlbnMgd2UgaGF2ZSB1cGdyYWRlZCBieSBub3cuICovCiAgdWludCBwdWJsaWMgdG90YWxVcGdyYWRlZCA9IDA7CgogIC8qKgogICAqIFVwZ3JhZGUgc3RhdGVzLgogICAqCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuCiAgICogLSBXYWl0aW5nRm9yQWdlbnQ6IFRva2VuIGFsbG93cyB1cGdyYWRlLCBidXQgd2UgZG9uJ3QgaGF2ZSBhIG5ldyBhZ2VudCB5ZXQKICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldC4gVGhpcyBhbGxvd3MgY2hhbmdpbmcgdGhlIHVwZ3JhZGUgYWdlbnQgd2hpbGUgdGhlcmUgaXMgdGltZS4KICAgKiAtIFVwZ3JhZGluZzogVXBncmFkZSBhZ2VudCBpcyBzZXQgYW5kIHRoZSBiYWxhbmNlIGhvbGRlcnMgY2FuIHVwZ3JhZGUgdGhlaXIgdG9rZW5zCiAgICoKICAgKi8KICBlbnVtIFVwZ3JhZGVTdGF0ZSB7VW5rbm93biwgTm90QWxsb3dlZCwgV2FpdGluZ0ZvckFnZW50LCBSZWFkeVRvVXBncmFkZSwgVXBncmFkaW5nfQoKICAvKioKICAgKiBTb21lYm9keSBoYXMgdXBncmFkZWQgc29tZSBvZiBoaXMgdG9rZW5zLgogICAqLwogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwoKICAvKioKICAgKiBOZXcgdXBncmFkZSBhZ2VudCBhdmFpbGFibGUuCiAgICovCiAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOwoKICAvKioKICAgKiBEbyBub3QgYWxsb3cgY29uc3RydWN0aW9uIHdpdGhvdXQgdXBncmFkZSBtYXN0ZXIgc2V0LgogICAqLwogIGZ1bmN0aW9uIFVwZ3JhZGVhYmxlVG9rZW4oYWRkcmVzcyBtYXN0ZXIpIGludGVybmFsIHsKICAgIHNldFVwZ3JhZGVNYXN0ZXIobWFzdGVyKTsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQgdmFsdWUpIHB1YmxpYyB7CiAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgIC8vIEVuc3VyZSBpdCdzIG5vdCBjYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgIHJlcXVpcmUoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLgogICAgcmVxdWlyZSh2YWx1ZSAhPSAwKTsKCiAgICAvLyBVcGdyYWRlIGFnZW50IHJlaXNzdWVzIHRoZSB0b2tlbnMKICAgIHVwZ3JhZGVBZ2VudC51cGdyYWRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAKICAgIC8vIFRha2UgdG9rZW5zIG91dCBmcm9tIGNpcmN1bGF0aW9uCiAgICBidXJuVG9rZW5zKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIHRvdGFsVXBncmFkZWQgPSB0b3RhbFVwZ3JhZGVkLmFkZCh2YWx1ZSk7CgogICAgVXBncmFkZShtc2cuc2VuZGVyLCB1cGdyYWRlQWdlbnQsIHZhbHVlKTsKICB9CgogIC8qKgogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcyB0aGUgdXBncmFkZSBwcm9jZXNzCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIG9ubHlNYXN0ZXIgZXh0ZXJuYWwgewogICAgLy8gQ2hlY2sgd2hldGhlciB0aGUgdG9rZW4gaXMgaW4gYSBzdGF0ZSB0aGF0IHdlIGNvdWxkIHRoaW5rIG9mIHVwZ3JhZGluZwogICAgcmVxdWlyZShjYW5VcGdyYWRlKCkpOwoKICAgIHJlcXVpcmUoYWdlbnQgIT0gMHgwKTsKICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50CiAgICByZXF1aXJlKGdldFVwZ3JhZGVTdGF0ZSgpICE9IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7CgogICAgLy8gQmFkIGludGVyZmFjZQogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSk7CiAgICAvLyBNYWtlIHN1cmUgdGhhdCB0b2tlbiBzdXBwbGllcyBtYXRjaCBpbiBzb3VyY2UgYW5kIHRhcmdldAogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSA9PSB0b3RhbFN1cHBseSgpKTsKCiAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhVcGdyYWRlU3RhdGUpIHsKICAgIGlmICghY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7CiAgICBlbHNlIGlmICh0b3RhbFVwZ3JhZGVkID09IDApIHJldHVybiBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGU7CiAgICBlbHNlIHJldHVybiBVcGdyYWRlU3RhdGUuVXBncmFkaW5nOwogIH0KCiAgLyoqCiAgICogQ2hhbmdlIHRoZSB1cGdyYWRlIG1hc3Rlci4KICAgKgogICAqIFRoaXMgYWxsb3dzIHVzIHRvIHNldCBhIG5ldyBvd25lciBmb3IgdGhlIHVwZ3JhZGUgbWVjaGFuaXNtLgogICAqLwogIGZ1bmN0aW9uIGNoYW5nZVVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBvbmx5TWFzdGVyIHB1YmxpYyB7CiAgICBzZXRVcGdyYWRlTWFzdGVyKG5ld19tYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgdXBncmFkZSBtYXN0ZXIgc2V0dGVyLgogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBwcml2YXRlIHsKICAgIHJlcXVpcmUobmV3X21hc3RlciAhPSAweDApOwogICAgdXBncmFkZU1hc3RlciA9IG5ld19tYXN0ZXI7CiAgfQoKICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gb3ZlcnJpZGUgdG8gcHJvdmlkZSB0aGUgY29uZGl0aW9uIGluIHdoaWNoIHRoZSB1cGdyYWRlIGNhbiBiZWdpbi4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgcmV0dXJuIHRydWU7CiAgfQoKCiAgbW9kaWZpZXIgb25seU1hc3RlcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB1cGdyYWRlTWFzdGVyKTsKICAgIF87CiAgfQp9CgovLyBUaGlzIGNvbnRyYWN0IGFpbXMgdG8gcHJvdmlkZSBhbiBpbmhlcml0YWJsZSB3YXkgdG8gcmVjb3ZlciB0b2tlbnMgZnJvbSBhIGNvbnRyYWN0IG5vdCBtZWFudCB0byBob2xkIHRva2VucwovLyBUbyB1c2UgdGhpcyBjb250cmFjdCwgaGF2ZSB5b3VyIHRva2VuLWlnbm9yaW5nIGNvbnRyYWN0IGluaGVyaXQgdGhpcyBvbmUgYW5kIGltcGxlbWVudCBnZXRMb3N0QW5kRm91bmRNYXN0ZXIgdG8gZGVjaWRlIHdobyBjYW4gbW92ZSBsb3N0IHRva2Vucy4KLy8gT2YgY291cnNlLCB0aGlzIGNvbnRyYWN0IGltcG9zZXMgc3VwcG9ydCBjb3N0cyB1cG9uIHdob2V2ZXIgaXMgdGhlIGxvc3QgYW5kIGZvdW5kIG1hc3Rlci4KY29udHJhY3QgTG9zdEFuZEZvdW5kVG9rZW4gewogIC8qKgogICAqIEByZXR1cm4gQWRkcmVzcyBvZiB0aGUgYWNjb3VudCB0aGF0IGhhbmRsZXMgbW92ZW1lbnRzLgogICAqLwogIGZ1bmN0aW9uIGdldExvc3RBbmRGb3VuZE1hc3RlcigpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CgogIC8qKgogICAqIEBwYXJhbSBhZ2VudCBBZGRyZXNzIHRoYXQgd2lsbCBiZSBhYmxlIHRvIG1vdmUgdG9rZW5zIHdpdGggdHJhbnNmZXJGcm9tCiAgICogQHBhcmFtIHRva2VucyBBbW91bnQgb2YgdG9rZW5zIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAqIEBwYXJhbSB0b2tlbl9jb250cmFjdCBDb250cmFjdCBvZiB0aGUgdG9rZW4KICAgKi8KICBmdW5jdGlvbiBlbmFibGVMb3N0QW5kRm91bmQoYWRkcmVzcyBhZ2VudCwgdWludCB0b2tlbnMsIEVJUDIwVG9rZW4gdG9rZW5fY29udHJhY3QpIHB1YmxpYyB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkpOwogICAgLy8gV2UgdXNlIGFwcHJvdmUgaW5zdGVhZCBvZiB0cmFuc2ZlciB0byBtaW5pbWl6ZSB0aGUgcG9zc2liaWxpdHkgb2YgdGhlIGxvc3QgYW5kIGZvdW5kIG1hc3RlcgogICAgLy8gIGdldHRpbmcgdGhlbSBzdHVjayBpbiBhbm90aGVyIGFkZHJlc3MgYnkgYWNjaWRlbnQuCiAgICB0b2tlbl9jb250cmFjdC5hcHByb3ZlKGFnZW50LCB0b2tlbnMpOwogIH0KfQoKLyoqCiAqIEEgcHVibGljIGludGVyZmFjZSB0byBpbmNyZWFzZSB0aGUgc3VwcGx5IG9mIGEgdG9rZW4uCiAqCiAqIFRoaXMgYWxsb3dzIHVuY2FwcGVkIGNyb3dkc2FsZSBieSBkeW5hbWljYWxseSBpbmNyZWFzaW5nIHRoZSBzdXBwbHkgd2hlbiBtb25leSBwb3VycyBpbi4KICogT25seSBtaW50IGFnZW50cywgdXN1YWxseSBjb250cmFjdHMgd2hpdGVsaXN0ZWQgYnkgdGhlIG93bmVyLCBjYW4gbWludCBuZXcgdG9rZW5zLgogKgogKi8KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBNaW50YWJsZSwgT3duYWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCiAgLyoqIExpc3Qgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gY3JlYXRlIG5ldyB0b2tlbnMgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtaW50QWdlbnRzOwoKICBldmVudCBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSk7CgoKICBmdW5jdGlvbiBNaW50YWJsZVRva2VuKHVpbnQgaW5pdGlhbFN1cHBseSwgYWRkcmVzcyBtdWx0aXNpZywgYm9vbCBtaW50YWJsZSkgaW50ZXJuYWwgewogICAgcmVxdWlyZShtdWx0aXNpZyAhPSBhZGRyZXNzKDApKTsKICAgIC8vIENhbm5vdCBjcmVhdGUgYSB0b2tlbiB3aXRob3V0IHN1cHBseSBhbmQgbm8gbWludGluZwogICAgcmVxdWlyZShtaW50YWJsZSB8fCBpbml0aWFsU3VwcGx5ICE9IDApOwogICAgLy8gQ3JlYXRlIGluaXRpYWxseSBhbGwgYmFsYW5jZSBvbiB0aGUgdGVhbSBtdWx0aXNpZwogICAgaWYgKGluaXRpYWxTdXBwbHkgPiAwKQogICAgICBtaW50SW50ZXJuYWwobXVsdGlzaWcsIGluaXRpYWxTdXBwbHkpOwogICAgLy8gTm8gbW9yZSBuZXcgc3VwcGx5IGFsbG93ZWQgYWZ0ZXIgdGhlIHRva2VuIGNyZWF0aW9uCiAgICBtaW50aW5nRmluaXNoZWQgPSAhbWludGFibGU7CiAgfQoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLgogICAqCiAgICogT25seSBjYWxsYWJsZSBieSBhIG1pbnQgYWdlbnQgKGUuZy4gY3Jvd2RzYWxlIGNvbnRyYWN0KS4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBvbmx5TWludEFnZW50IGNhbk1pbnQgcHVibGljIHsKICAgIG1pbnRJbnRlcm5hbChyZWNlaXZlciwgYW1vdW50KTsKICB9CgogIC8qKgogICAqIE93bmVyIGNhbiBhbGxvdyBhIGNyb3dkc2FsZSBjb250cmFjdCB0byBtaW50IG5ldyB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gc2V0TWludEFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHsKICAgIG1pbnRBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICAgIE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkciwgc3RhdGUpOwogIH0KCiAgbW9kaWZpZXIgb25seU1pbnRBZ2VudCgpIHsKICAgIC8vIE9ubHkgbWludCBhZ2VudHMgYXJlIGFsbG93ZWQgdG8gbWludCBuZXcgdG9rZW5zCiAgICByZXF1aXJlKG1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pOwogICAgXzsKICB9CgogIC8qKiBNYWtlIHN1cmUgd2UgYXJlIG5vdCBkb25lIHlldC4gKi8KICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQp9CgovKioKICogQSBjcm93ZHNhbGUgdG9rZW4uCiAqCiAqIEFuIEVSQy0yMCB0b2tlbiBkZXNpZ25lZCBzcGVjaWZpY2FsbHkgZm9yIGNyb3dkc2FsZXMgd2l0aCBpbnZlc3RvciBwcm90ZWN0aW9uIGFuZCBmdXJ0aGVyIGRldmVsb3BtZW50IHBhdGguCiAqCiAqIC0gVGhlIHRva2VuIHRyYW5zZmVyKCkgaXMgZGlzYWJsZWQgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyCiAqIC0gVGhlIHRva2VuIGNvbnRyYWN0IGdpdmVzIGFuIG9wdC1pbiB1cGdyYWRlIHBhdGggdG8gYSBuZXcgY29udHJhY3QKICogLSBUaGUgc2FtZSB0b2tlbiBjYW4gYmUgcGFydCBvZiBzZXZlcmFsIGNyb3dkc2FsZXMgdGhyb3VnaCB0aGUgYXBwcm92ZSgpIG1lY2hhbmlzbQogKiAtIFRoZSB0b2tlbiBjYW4gYmUgY2FwcGVkIChzdXBwbHkgc2V0IGluIHRoZSBjb25zdHJ1Y3Rvcikgb3IgdW5jYXBwZWQgKGNyb3dkc2FsZSBjb250cmFjdCBjYW4gbWludCBuZXcgdG9rZW5zKQogKiAtIEVSQzIwIHRva2VucyB0cmFuc2ZlcnJlZCB0byB0aGlzIGNvbnRyYWN0IGNhbiBiZSByZWNvdmVyZWQgYnkgYSBsb3N0IGFuZCBmb3VuZCBtYXN0ZXIKICoKICovCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIGlzIFJlbGVhc2FibGVUb2tlbiwgTWludGFibGVUb2tlbiwgVXBncmFkZWFibGVUb2tlbiwgTG9zdEFuZEZvdW5kVG9rZW4gewoKICBzdHJpbmcgcHVibGljIG5hbWUgPSAiVWJhbngiOwoKICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJCQU5YIjsKCiAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICBhZGRyZXNzIHB1YmxpYyBsb3N0X2FuZF9mb3VuZF9tYXN0ZXI7CgogIC8qKgogICAqIENvbnN0cnVjdCB0aGUgdG9rZW4uCiAgICoKICAgKiBUaGlzIHRva2VuIG11c3QgYmUgY3JlYXRlZCB0aHJvdWdoIGEgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIHNvIHRoYXQgaXQgaXMgb3duZWQgYnkgdGhhdCB3YWxsZXQuCiAgICoKICAgKiBAcGFyYW0gaW5pdGlhbF9zdXBwbHkgSG93IG1hbnkgdG9rZW5zIHdlIHN0YXJ0IHdpdGguCiAgICogQHBhcmFtIHRva2VuX2RlY2ltYWxzIE51bWJlciBvZiBkZWNpbWFsIHBsYWNlcy4KICAgKiBAcGFyYW0gdGVhbV9tdWx0aXNpZyBBZGRyZXNzIG9mIHRoZSBtdWx0aXNpZyB0aGF0IHJlY2VpdmVzIHRoZSBpbml0aWFsIHN1cHBseSBhbmQgaXMgc2V0IGFzIHRoZSB1cGdyYWRlIG1hc3Rlci4KICAgKiBAcGFyYW0gbWludGFibGUgQXJlIG5ldyB0b2tlbnMgY3JlYXRlZCBvdmVyIHRoZSBjcm93ZHNhbGUgb3IgZG8gd2UgZGlzdHJpYnV0ZSBvbmx5IHRoZSBpbml0aWFsIHN1cHBseT8gTm90ZSB0aGF0IHdoZW4gdGhlIHRva2VuIGJlY29tZXMgdHJhbnNmZXJhYmxlIHRoZSBtaW50aW5nIGFsd2F5cyBlbmRzLgogICAqIEBwYXJhbSB0b2tlbl9yZXRyaWV2ZXIgQWRkcmVzcyBvZiB0aGUgYWNjb3VudCB0aGF0IGhhbmRsZXMgRVJDMjAgdG9rZW5zIHRoYXQgd2VyZSBhY2NpZGVudGFsbHkgc2VudCB0byB0aGlzIGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuKHVpbnQgaW5pdGlhbF9zdXBwbHksIHVpbnQ4IHRva2VuX2RlY2ltYWxzLCBhZGRyZXNzIHRlYW1fbXVsdGlzaWcsIGJvb2wgbWludGFibGUsIGFkZHJlc3MgdG9rZW5fcmV0cmlldmVyKSBwdWJsaWMKICBVcGdyYWRlYWJsZVRva2VuKHRlYW1fbXVsdGlzaWcpIE1pbnRhYmxlVG9rZW4oaW5pdGlhbF9zdXBwbHksIHRlYW1fbXVsdGlzaWcsIG1pbnRhYmxlKSB7CiAgICByZXF1aXJlKHRva2VuX3JldHJpZXZlciAhPSBhZGRyZXNzKDApKTsKICAgIGRlY2ltYWxzID0gdG9rZW5fZGVjaW1hbHM7CiAgICBsb3N0X2FuZF9mb3VuZF9tYXN0ZXIgPSB0b2tlbl9yZXRyaWV2ZXI7CiAgfQoKICAvKioKICAgKiBXaGVuIHRva2VuIGlzIHJlbGVhc2VkIHRvIGJlIHRyYW5zZmVyYWJsZSwgcHJvaGliaXQgbmV3IHRva2VuIGNyZWF0aW9uLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIHN1cGVyLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB1cGdyYWRlIGFnZW50IGZ1bmN0aW9uYWxpdHkgdG8ga2ljayBpbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgd2FzIGEgc3VjY2Vzcy4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gcmVsZWFzZWQgJiYgc3VwZXIuY2FuVXBncmFkZSgpOwogIH0KCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKGFkZHJlc3MpIHsKICAgIHJldHVybiBsb3N0X2FuZF9mb3VuZF9tYXN0ZXI7CiAgfQoKICAvKioKICAgKiBXZSBhbGxvdyBhbnlvbmUgdG8gYnVybiB0aGVpciB0b2tlbnMgaWYgdGhleSB3aXNoIHRvIGRvIHNvLgogICAqIFdlIHdhbnQgdG8gdXNlIHRoaXMgaW4gdGhlIGZpbmFsaXplIGZ1bmN0aW9uIG9mIHRoZSBjcm93ZHNhbGUgaW4gcGFydGljdWxhci4KICAgKi8KICBmdW5jdGlvbiBidXJuKHVpbnQgYW1vdW50KSBwdWJsaWMgewogICAgYnVyblRva2Vucyhtc2cuc2VuZGVyLCBhbW91bnQpOwogIH0KCn0KCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4KICoKICogSGFuZGxlcwogKiAtIHN0YXJ0IGFuZCBlbmQgZGF0ZXMKICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMKICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQKICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpCiAqCiAqLwpjb250cmFjdCBHZW5lcmljQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIENyb3dkc2FsZVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgLyogZXRoZXIgd2lsbCBiZSB0cmFuc2ZlcnJlZCB0byB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKCiAgLyogYSBjb250cmFjdCBtYXkgYmUgZGVwbG95ZWQgdG8gZnVuY3Rpb24gYXMgYSBnYXRld2F5IGZvciBpbnZlc3RtZW50cyAqLwogIGFkZHJlc3MgcHVibGljIGludmVzdG1lbnRHYXRld2F5OwoKICAvKiB0aGUgc3RhcnRpbmcgdGltZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgc3RhcnRzQXQ7CgogIC8qIHRoZSBlbmRpbmcgdGltZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgZW5kc0F0OwoKICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKCiAgLyogSG93IG1hbnkgd2VpIG9mIGZ1bmRpbmcgd2UgaGF2ZSByYWlzZWQgKi8KICB1aW50IHB1YmxpYyB3ZWlSYWlzZWQgPSAwOwoKICAvKiBIb3cgbWFueSBkaXN0aW5jdCBhZGRyZXNzZXMgaGF2ZSBpbnZlc3RlZCAqLwogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQgPSBmYWxzZTsKCiAgLyogRG8gd2UgbmVlZCB0byBoYXZlIGEgdW5pcXVlIGNvbnRyaWJ1dG9yIGlkIGZvciBlYWNoIGN1c3RvbWVyICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQgPSBmYWxzZTsKCiAgLyoqCiAgICogRG8gd2UgdmVyaWZ5IHRoYXQgY29udHJpYnV0b3IgaGFzIGJlZW4gY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgKGFjY3JlZGl0ZWQgaW52ZXN0b3JzIG9ubHkpLgogICAqIFRoaXMgbWV0aG9kIHdhcyBmaXJzdCB1c2VkIGluIHRoZSBGaXJzdEJsb29kIGNyb3dkc2FsZSB0byBlbnN1cmUgYWxsIGNvbnRyaWJ1dG9ycyBoYWQgYWNjZXB0ZWQgdGVybXMgb2Ygc2FsZSAob24gdGhlIHdlYikuCiAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gZmFsc2U7CgogIC8qKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICAvKiogSG93IG1hbnkgRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgaW4gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNpYWxseSBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogU3RhdGUgbWFjaGluZQogICAqCiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCByZWFjaGVkIHRoZSBzdGFydGluZyB0aW1lIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogQ3Jvd2RzYWxlIGVuZGVkCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZSBmdW5jdGlvbiBoYXMgYmVlbiBjYWxsZWQgYW5kIHN1Y2Nlc2Z1bGx5IGV4ZWN1dGVkCiAgICovCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGaW5hbGl6ZWR9CgoKICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7CgogIC8vIFRoZSBydWxlcyBhYm91dCB3aGF0IGtpbmQgb2YgaW52ZXN0bWVudHMgd2UgYWNjZXB0IHdlcmUgY2hhbmdlZAogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgcmVxdWlyZUNJZCwgYm9vbCByZXF1aXJlU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBzaWduZXIpOwoKICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7CgogIC8vIENyb3dkc2FsZSdzIGZpbmFsaXplIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZAogIGV2ZW50IEZpbmFsaXplZCgpOwoKCiAgLyoqCiAgICogQmFzaWMgY29uc3RydWN0b3IgZm9yIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHRlYW1fbXVsdGlzaWcgQWRkcmVzcyBvZiB0aGUgbXVsdGlzaWduYXR1cmUgd2FsbGV0IG9mIHRoZSB0ZWFtIHRoYXQgd2lsbCByZWNlaXZlIGFsbCB0aGUgZnVuZHMgY29udHJpYnV0ZWQgaW4gdGhlIGNyb3dkc2FsZS4KICAgKiBAcGFyYW0gc3RhcnQgQmxvY2sgbnVtYmVyIHdoZXJlIHRoZSBjcm93ZHNhbGUgd2lsbCBiZSBvZmZpY2lhbGx5IHN0YXJ0ZWQuIEl0IHNob3VsZCBiZSBncmVhdGVyIHRoYW4gdGhlIGJsb2NrIG51bWJlciBpbiB3aGljaCB0aGUgY29udHJhY3QgaXMgZGVwbG95ZWQuCiAgICogQHBhcmFtIGVuZCBCbG9jayBudW1iZXIgd2hlcmUgdGhlIGNyb3dkc2FsZSBmaW5pc2hlcy4gTm8gdG9rZW5zIGNhbiBiZSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCBhZnRlciB0aGlzIGJsb2NrLgogICAqLwogIGZ1bmN0aW9uIEdlbmVyaWNDcm93ZHNhbGUoYWRkcmVzcyB0ZWFtX211bHRpc2lnLCB1aW50IHN0YXJ0LCB1aW50IGVuZCkgaW50ZXJuYWwgewogICAgc2V0TXVsdGlzaWcodGVhbV9tdWx0aXNpZyk7CgogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMKICAgIHJlcXVpcmUoc3RhcnQgIT0gMCAmJiBlbmQgIT0gMCk7CiAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0ICYmIHN0YXJ0IDwgZW5kKTsKICAgIHN0YXJ0c0F0ID0gc3RhcnQ7CiAgICBlbmRzQXQgPSBlbmQ7CiAgfQoKICAvKioKICAgKiBEZWZhdWx0IGZhbGxiYWNrIGJlaGF2aW91ciBpcyB0byBjYWxsIGJ1eS4KICAgKiBJZGVhbGx5LCBubyBjb250cmFjdCBjYWxscyB0aGlzIGNyb3dkc2FsZSB3aXRob3V0IHN1cHBvcnRpbmcgRVJDMjAuCiAgICogSG93ZXZlciwgc29tZSBzb3J0IG9mIHJlZnVuZGluZyBmdW5jdGlvbiBtYXkgYmUgZGVzaXJlZCB0byBjb3ZlciBzdWNoIHNpdHVhdGlvbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICBidXkoKTsKICB9CgogIC8qKgogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4KICAgKgogICAqIFRoZSBjcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0LgogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGN1c3RvbWVySWQgKG9wdGlvbmFsKSBVVUlEIHY0IHRvIHRyYWNrIHRoZSBzdWNjZXNzZnVsIHBheW1lbnRzIG9uIHRoZSBzZXJ2ZXIgc2lkZQogICAqCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBzdG9wSW5FbWVyZ2VuY3kgbm90RmluaXNoZWQgcHJpdmF0ZSB7CiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmIChnZXRTdGF0ZSgpID09IFN0YXRlLlByZUZ1bmRpbmcpIHsKICAgICAgLy8gQXJlIHdlIHdoaXRlbGlzdGVkIGZvciBlYXJseSBkZXBvc2l0CiAgICAgIHJlcXVpcmUoZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFttc2cuc2VuZGVyXSk7CiAgICB9CgogICAgdWludCB3ZWlBbW91bnQ7CiAgICB1aW50IHRva2VuQW1vdW50OwogICAgKHdlaUFtb3VudCwgdG9rZW5BbW91bnQpID0gY2FsY3VsYXRlVG9rZW5BbW91bnQobXNnLnZhbHVlLCByZWNlaXZlcik7CiAgICAvLyBTYW5pdHkgY2hlY2sgYWdhaW5zdCBiYWQgaW1wbGVtZW50YXRpb24uCiAgICBhc3NlcnQod2VpQW1vdW50IDw9IG1zZy52YWx1ZSk7CiAgICAKICAgIC8vIER1c3QgdHJhbnNhY3Rpb24gaWYgbm8gdG9rZW5zIGNhbiBiZSBnaXZlbgogICAgcmVxdWlyZSh0b2tlbkFtb3VudCAhPSAwKTsKCiAgICBpZiAoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAvLyBBIG5ldyBpbnZlc3RvcgogICAgICBpbnZlc3RvckNvdW50Kys7CiAgICB9CiAgICB1cGRhdGVJbnZlc3RvckZ1bmRzKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHJlY2VpdmVyLCBjdXN0b21lcklkKTsKCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5CiAgICBtdWx0aXNpZ1dhbGxldC50cmFuc2Zlcih3ZWlBbW91bnQpOwoKICAgIC8vIFJldHVybiBleGNlc3Mgb2YgbW9uZXkKICAgIHJldHVybkV4Y2VkZW50KG1zZy52YWx1ZS5zdWIod2VpQW1vdW50KSwgbXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogTm8gbW9uZXkgaXMgZXhjaGFuZ2VkLCBhcyB0aGUgY3Jvd2RzYWxlIHRlYW0gYWxyZWFkeSBoYXZlIHJlY2VpdmVkIHRoZSBwYXltZW50LgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIEFjY291bnQgdGhhdCByZWNlaXZlcyB0aGUgdG9rZW5zLgogICAqIEBwYXJhbSBmdWxsVG9rZW5zIHRva2VucyBhcyBmdWxsIHRva2VucyAtIGRlY2ltYWwgcGxhY2VzIGFyZSBhZGRlZCBpbnRlcm5hbGx5LgogICAqIEBwYXJhbSB3ZWlQcmljZSBQcmljZSBvZiBhIHNpbmdsZSBpbmRpdmlzaWJsZSB0b2tlbiBpbiB3ZWkuCiAgICoKICAgKi8KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgbm90RmluaXNoZWQgewogICAgcmVxdWlyZShyZWNlaXZlciAhPSBhZGRyZXNzKDApKTsKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBmdWxsVG9rZW5zLm11bCgxMCoqdWludCh0b2tlbi5kZWNpbWFscygpKSk7CiAgICByZXF1aXJlKHRva2VuQW1vdW50ICE9IDApOwogICAgdWludCB3ZWlBbW91bnQgPSB3ZWlQcmljZS5tdWwodG9rZW5BbW91bnQpOyAvLyBUaGlzIGNhbiBhbHNvIGJlIDAsIGluIHdoaWNoIGNhc2Ugd2UgZ2l2ZSBvdXQgdG9rZW5zIGZvciBmcmVlCiAgICB1cGRhdGVJbnZlc3RvckZ1bmRzKHRva2VuQW1vdW50LCB3ZWlBbW91bnQsIHJlY2VpdmVyICwgMCk7CiAgfQoKICAvKioKICAgKiBQcml2YXRlIGZ1bmN0aW9uIHRvIHVwZGF0ZSBhY2NvdW50aW5nIGluIHRoZSBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gdXBkYXRlSW52ZXN0b3JGdW5kcyh1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaUFtb3VudCwgYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBwcml2YXRlIHsKICAgIC8vIFVwZGF0ZSBpbnZlc3RvcgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5hZGQod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0uYWRkKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5hZGQodG9rZW5BbW91bnQpOwoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogICAgLy8gVGVsbCB1cyB0aGF0IHRoZSBpbnZlc3RtZW50IHdhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5CiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSByZWNlaXZlciBhbmQgdmVyaWZpZXMgaGUgaXMgYWxsb3dlZCB0byBpbnZlc3QuCiAgICoKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlPbkJlaGFsZldpdGhTaWduZWRBZGRyZXNzKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHZhbGlkQ3VzdG9tZXJJZChjdXN0b21lcklkKSB7CiAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYocmVjZWl2ZXIpOwogICAgcmVxdWlyZShlY3JlY292ZXIoaGFzaCwgdiwgciwgcykgPT0gc2lnbmVyQWRkcmVzcyk7CiAgICBpbnZlc3RJbnRlcm5hbChyZWNlaXZlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSByZWNlaXZlci4KICAgKiAKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlPbkJlaGFsZldpdGhDdXN0b21lcklkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgdmFsaWRDdXN0b21lcklkKGN1c3RvbWVySWQpIHVuc2lnbmVkQnV5QWxsb3dlZCB7CiAgICBpbnZlc3RJbnRlcm5hbChyZWNlaXZlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBCdXlzIHRva2VucyBvbiBiZWhhbGYgb2YgYW4gYWRkcmVzcy4KICAgKgogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSByZWNlaXZlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eU9uQmVoYWxmKGFkZHJlc3MgcmVjZWl2ZXIpIHB1YmxpYyBwYXlhYmxlIHsKICAgIHJlcXVpcmUoIXJlcXVpcmVkU2lnbmVkQWRkcmVzcyB8fCBtc2cuc2VuZGVyID09IGludmVzdG1lbnRHYXRld2F5KTsKICAgIHJlcXVpcmUoIXJlcXVpcmVDdXN0b21lcklkKTsgLy8gQ3Jvd2RzYWxlIG5lZWRzIHRvIHRyYWNrIHBhcnRpY2lwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsCiAgICBpbnZlc3RJbnRlcm5hbChyZWNlaXZlciwgMCk7CiAgfQoKICBmdW5jdGlvbiBzZXRJbnZlc3RtZW50R2F0ZXdheShhZGRyZXNzIGdhdGV3YXkpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShnYXRld2F5ICE9IGFkZHJlc3MoMCkpOwogICAgaW52ZXN0bWVudEdhdGV3YXkgPSBnYXRld2F5OwogIH0KCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcGF5ZXIgYW5kIHZlcmlmaWVzIGhlIGlzIGFsbG93ZWQgdG8gaW52ZXN0LgogICAqCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgYnV5T25CZWhhbGZXaXRoU2lnbmVkQWRkcmVzcyhtc2cuc2VuZGVyLCBjdXN0b21lcklkLCB2LCByLCBzKTsKICB9CgoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSBwYXllci4KICAgKiAKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eU9uQmVoYWxmV2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eU9uQmVoYWxmKG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dlciBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqIE5vdGUgdGhhdCBieSBkZWZhdWx0IHRva2VucyBhcmUgbm90IGluIGEgcmVsZWFzZWQgc3RhdGUuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIGZpbmFsaXplZCA9IHRydWU7CiAgICBGaW5hbGl6ZWQoKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgZG8gd2UgbmVlZCB0byBoYXZlIHNlcnZlci1zaWRlIGN1c3RvbWVyIGlkcyBmb3IgdGhlIGludmVzdG1lbnRzLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZUN1c3RvbWVySWQoYm9vbCB2YWx1ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGlmIGFsbCBpbnZlc3RvcnMgbXVzdCBiZSBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSBmaXJzdC4KICAgKgogICAqIFRoaXMgaXMgZS5nLiBmb3IgdGhlIGFjY3JlZGl0ZWQgaW52ZXN0b3IgY2xlYXJpbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlU2lnbmVkQWRkcmVzcyhib29sIHZhbHVlLCBhZGRyZXNzIHNpZ25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsKICAgIHNpZ25lckFkZHJlc3MgPSBzaWduZXI7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLgogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3QoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cykgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCBzdG9wSW5FbWVyZ2VuY3kgewogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IHN0YXR1czsKICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgfQoKICAvKioKICAgKiBJbnRlcm5hbCBzZXR0ZXIgZm9yIHRoZSBtdWx0aXNpZyB3YWxsZXQKICAgKi8KICBmdW5jdGlvbiBzZXRNdWx0aXNpZyhhZGRyZXNzIGFkZHIpIGludGVybmFsIHsKICAgIHJlcXVpcmUoYWRkciAhPSAwKTsKICAgIG11bHRpc2lnV2FsbGV0ID0gYWRkcjsKICB9CgogIC8qKgogICAqIENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuCiAgICoKICAgKiBUaGlzIGZ1bmN0aW9uIGhhcyB0aGUgdGltZWQgdHJhbnNpdGlvbiBidWlsdGluLgogICAqIFNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChTdGF0ZSkgewogICAgaWYgKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7CiAgfQoKICAvKiogSW50ZXJuYWwgZnVuY3Rpb25zIHRoYXQgZXhpc3QgdG8gcHJvdmlkZSBpbnZlcnNpb24gb2YgY29udHJvbCBzaG91bGQgdGhleSBiZSBvdmVycmlkZW4gKi8KCiAgLyoqIEludGVyZmFjZSBmb3IgdGhlIGNvbmNyZXRlIGluc3RhbmNlIHRvIGludGVyYWN0IHdpdGggdGhlIHRva2VuIGNvbnRyYWN0IGluIGEgY3VzdG9taXphYmxlIHdheSAqLwogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBpbnRlcm5hbDsKCiAgLyoqCiAgICogIERldGVybWluZSBpZiB0aGUgZ29hbCB3YXMgYWxyZWFkeSByZWFjaGVkIGluIHRoZSBjdXJyZW50IGNyb3dkc2FsZQogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCBmdWxsKTsKCiAgLyoqCiAgICogUmV0dXJucyBhbnkgZXhjZXNzIHdlaSByZWNlaXZlZAogICAqIAogICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIG92ZXJyaWRlbiB0byBwcm92aWRlIGEgZGlmZmVyZW50IHJlZnVuZGluZyBtZXRob2QuCiAgICovCiAgZnVuY3Rpb24gcmV0dXJuRXhjZWRlbnQodWludCBleGNlZGVudCwgYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgewogICAgaWYgKGV4Y2VkZW50ID4gMCkgewogICAgICByZWNlaXZlci50cmFuc2ZlcihleGNlZGVudCk7CiAgICB9CiAgfQoKICAvKiogCiAgICogIENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSByZWNlaXZlZCBhbW91bnQuCiAgICogIFRoZSB3ZWkgYW1vdW50IGlzIHJldHVybmVkIHRvbyBpbiBjYXNlIG5vdCBhbGwgb2YgaXQgY2FuIGJlIGludmVzdGVkLgogICAqCiAgICogIE5vdGU6IFdoZW4gdGhlcmUncyBhbiBleGNlZGVudCBkdWUgdG8gcm91bmRpbmcgZXJyb3IsIGl0IHNob3VsZCBiZSByZXR1cm5lZCB0byBhbGxvdyByZWZ1bmRpbmcuCiAgICogIFRoaXMgaXMgd29ya2VkIGFyb3VuZCBpbiB0aGUgY3VycmVudCBkZXNpZ24gdXNpbmcgYW4gYXBwcm9wcmlhdGUgYW1vdW50IG9mIGRlY2ltYWxzIGluIHRoZSBGcmFjdGlvbmFsRVJDMjAgc3RhbmRhcmQuCiAgICogIFRoZSB3b3JrYXJvdW5kIGlzIGdvb2QgZW5vdWdoIGZvciBtb3N0IHVzZSBjYXNlcywgaGVuY2UgdGhlIHNpbXBsaWZpZWQgZnVuY3Rpb24gc2lnbmF0dXJlLgogICAqICBAcmV0dXJuIHdlaUFsbG93ZWQgVGhlIGFtb3VudCBvZiB3ZWkgYWNjZXB0ZWQgaW4gdGhpcyB0cmFuc2FjdGlvbi4KICAgKiAgQHJldHVybiB0b2tlbkFtb3VudCBUaGUgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIHRoZSByZWNlaXZlciBpbiB0aGlzIHRyYW5zYWN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuQW1vdW50KHVpbnQgd2VpQW1vdW50LCBhZGRyZXNzIHJlY2VpdmVyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgd2VpQWxsb3dlZCwgdWludCB0b2tlbkFtb3VudCk7CgogIC8vCiAgLy8gTW9kaWZpZXJzCiAgLy8KCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgewogICAgcmVxdWlyZShnZXRTdGF0ZSgpID09IHN0YXRlKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB1bnNpZ25lZEJ1eUFsbG93ZWQoKSB7CiAgICByZXF1aXJlKCFyZXF1aXJlZFNpZ25lZEFkZHJlc3MpOwogICAgXzsKICB9CgogIC8qKiBNb2RpZmllciBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8KICBtb2RpZmllciBub3RGaW5pc2hlZCgpIHsKICAgIFN0YXRlIGN1cnJlbnRfc3RhdGUgPSBnZXRTdGF0ZSgpOwogICAgcmVxdWlyZShjdXJyZW50X3N0YXRlID09IFN0YXRlLlByZUZ1bmRpbmcgfHwgY3VycmVudF9zdGF0ZSA9PSBTdGF0ZS5GdW5kaW5nKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB2YWxpZEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSB7CiAgICByZXF1aXJlKGN1c3RvbWVySWQgIT0gMCk7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICBfOwogIH0KCn0KCi8vLyBAZGV2IFRyYW5jaGUgYmFzZWQgcHJpY2luZy4KLy8vICAgICAgSW1wbGVtZW50aW5nICJmaXJzdCBwcmljZSIgdHJhbmNoZXMsIG1lYW5pbmcsIHRoYXQgaWYgYSBidXllcidzIG9yZGVyIGlzCi8vLyAgICAgIGNvdmVyaW5nIG1vcmUgdGhhbiBvbmUgdHJhbmNoZSwgdGhlIHByaWNlIG9mIHRoZSBsb3dlc3QgdHJhbmNoZSB3aWxsIGFwcGx5Ci8vLyAgICAgIHRvIHRoZSB3aG9sZSBvcmRlci4KY29udHJhY3QgVG9rZW5UcmFuY2hlUHJpY2luZyB7CgogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAvKioKICAgKiBEZWZpbmUgcHJpY2luZyBzY2hlZHVsZSB1c2luZyB0cmFuY2hlcy4KICAgKi8KICBzdHJ1Y3QgVHJhbmNoZSB7CiAgICAgIC8vIEFtb3VudCBpbiB0b2tlbnMgd2hlbiB0aGlzIHRyYW5jaGUgYmVjb21lcyBpbmFjdGl2ZQogICAgICB1aW50IGFtb3VudDsKICAgICAgLy8gVGltZSBpbnRlcnZhbCBbc3RhcnQsIGVuZCkKICAgICAgLy8gU3RhcnRpbmcgdGltZXN0YW1wIChpbmNsdWRlZCBpbiB0aGUgaW50ZXJ2YWwpCiAgICAgIHVpbnQgc3RhcnQ7CiAgICAgIC8vIEVuZGluZyB0aW1lc3RhbXAgKGV4Y2x1ZGVkIGZyb20gdGhlIGludGVydmFsKQogICAgICB1aW50IGVuZDsKICAgICAgLy8gSG93IG1hbnkgdG9rZW5zIHBlciBhc3NldCB1bml0IHlvdSB3aWxsIGdldCB3aGlsZSB0aGlzIHRyYW5jaGUgaXMgYWN0aXZlCiAgICAgIHVpbnQgcHJpY2U7CiAgfQogIC8vIFdlIGRlZmluZSBvZmZzZXRzIGFuZCBzaXplIGZvciB0aGUgZGVzZXJpYWxpemF0aW9uIG9mIG9yZGVyZWQgdHVwbGVzIGluIHJhdyBhcnJheXMKICB1aW50IHByaXZhdGUgY29uc3RhbnQgYW1vdW50X29mZnNldCA9IDA7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHN0YXJ0X29mZnNldCA9IDE7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IGVuZF9vZmZzZXQgPSAyOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBwcmljZV9vZmZzZXQgPSAzOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCB0cmFuY2hlX3NpemUgPSA0OwoKICBUcmFuY2hlW10gcHVibGljIHRyYW5jaGVzOwoKICBmdW5jdGlvbiBnZXRUcmFuY2hlc0xlbmd0aCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0cmFuY2hlcy5sZW5ndGg7CiAgfQoKICAvLy8gQGRldiBDb25zdHJ1Y3Rpb24sIGNyZWF0aW5nIGEgbGlzdCBvZiB0cmFuY2hlcwogIC8vLyBAcGFyYW0gaW5pdF90cmFuY2hlcyBSYXcgYXJyYXkgb2Ygb3JkZXJlZCB0dXBsZXM6IChlbmQgYW1vdW50LCBzdGFydCB0aW1lc3RhbXAsIGVuZCB0aW1lc3RhbXAsIHByaWNlKQogIGZ1bmN0aW9uIFRva2VuVHJhbmNoZVByaWNpbmcodWludFtdIGluaXRfdHJhbmNoZXMpIHB1YmxpYyB7CiAgICAvLyBOZWVkIHRvIGhhdmUgdHVwbGVzLCBsZW5ndGggY2hlY2sKICAgIHJlcXVpcmUoaW5pdF90cmFuY2hlcy5sZW5ndGggJSB0cmFuY2hlX3NpemUgPT0gMCk7CiAgICAvLyBBIHRyYW5jaGUgd2l0aCBhbW91bnQgemVybyBjYW4gbmV2ZXIgYmUgc2VsZWN0ZWQgYW5kIGlzIHRoZXJlZm9yZSB1c2VsZXNzLgogICAgLy8gVGhpcyBjaGVjayBhbmQgdGhlIG9uZSBpbnNpZGUgdGhlIGxvb3AgZW5zdXJlIG5vIHRyYW5jaGUgY2FuIGhhdmUgYW4gYW1vdW50IGVxdWFsIHRvIHplcm8uCiAgICByZXF1aXJlKGluaXRfdHJhbmNoZXNbYW1vdW50X29mZnNldF0gPiAwKTsKCiAgICB1aW50IGlucHV0X3RyYW5jaGVzX2xlbmd0aCA9IGluaXRfdHJhbmNoZXMubGVuZ3RoLmRpdih0cmFuY2hlX3NpemUpOwogICAgVHJhbmNoZSBtZW1vcnkgbGFzdF90cmFuY2hlOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaW5wdXRfdHJhbmNoZXNfbGVuZ3RoOyBpKyspIHsKICAgICAgdWludCB0cmFuY2hlX29mZnNldCA9IGkubXVsKHRyYW5jaGVfc2l6ZSk7CiAgICAgIHVpbnQgYW1vdW50ID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoYW1vdW50X29mZnNldCldOwogICAgICB1aW50IHN0YXJ0ID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoc3RhcnRfb2Zmc2V0KV07CiAgICAgIHVpbnQgZW5kID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoZW5kX29mZnNldCldOwogICAgICB1aW50IHByaWNlID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQocHJpY2Vfb2Zmc2V0KV07CiAgICAgIC8vIE5vIGludmFsaWQgc3RlcHMKICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPCBzdGFydCAmJiBzdGFydCA8IGVuZCk7CiAgICAgIC8vIEJhaWwgb3V0IHdoZW4gZW50ZXJpbmcgdW5uZWNlc3NhcnkgdHJhbmNoZXMKICAgICAgLy8gVGhpcyBpcyBwcmVmZXJhYmx5IGNoZWNrZWQgYmVmb3JlIGRlcGxveWluZyBjb250cmFjdCBpbnRvIGFueSBibG9ja2NoYWluLgogICAgICByZXF1aXJlKGkgPT0gMCB8fCAoZW5kID49IGxhc3RfdHJhbmNoZS5lbmQgJiYgYW1vdW50ID4gbGFzdF90cmFuY2hlLmFtb3VudCkgfHwKICAgICAgICAgICAgICAoZW5kID4gbGFzdF90cmFuY2hlLmVuZCAmJiBhbW91bnQgPj0gbGFzdF90cmFuY2hlLmFtb3VudCkpOwoKICAgICAgbGFzdF90cmFuY2hlID0gVHJhbmNoZShhbW91bnQsIHN0YXJ0LCBlbmQsIHByaWNlKTsKICAgICAgdHJhbmNoZXMucHVzaChsYXN0X3RyYW5jaGUpOwogICAgfQogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHRyYW5jaGUgb3IgYmFpbCBvdXQgaWYgdGhlcmUgaXMgbm8gdHJhbmNoZSBkZWZpbmVkIGZvciB0aGUgY3VycmVudCBibG9jay4KICAvLy8gQHBhcmFtIHRva2Vuc1NvbGQgdG90YWwgYW1vdW50IG9mIHRva2VucyBzb2xkLCBmb3IgY2FsY3VsYXRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQogIC8vLyBAcmV0dXJuIFJldHVybnMgdGhlIHN0cnVjdCByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQogIGZ1bmN0aW9uIGdldEN1cnJlbnRUcmFuY2hlKHVpbnQgdG9rZW5zU29sZCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKFRyYW5jaGUgc3RvcmFnZSkgewogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdHJhbmNoZXMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHRyYW5jaGVzW2ldLnN0YXJ0IDw9IGJsb2NrLnRpbWVzdGFtcCAmJiBibG9jay50aW1lc3RhbXAgPCB0cmFuY2hlc1tpXS5lbmQgJiYgdG9rZW5zU29sZCA8IHRyYW5jaGVzW2ldLmFtb3VudCkgewogICAgICAgIHJldHVybiB0cmFuY2hlc1tpXTsKICAgICAgfQogICAgfQogICAgLy8gTm8gdHJhbmNoZSBpcyBjdXJyZW50bHkgYWN0aXZlCiAgICByZXZlcnQoKTsKICB9CgogIC8vLyBAZGV2IEdldCB0aGUgY3VycmVudCBwcmljZS4gTWF5IHJldmVydCBpZiB0aGVyZSBpcyBubyB0cmFuY2hlIGN1cnJlbnRseSBhY3RpdmUuCiAgLy8vIEBwYXJhbSB0b2tlbnNTb2xkIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgc29sZCwgZm9yIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUKICAvLy8gQHJldHVybiBUaGUgY3VycmVudCBwcmljZQogIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50IHRva2Vuc1NvbGQpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgIHJldHVybiBnZXRDdXJyZW50VHJhbmNoZSh0b2tlbnNTb2xkKS5wcmljZTsKICB9Cgp9CgovLyBTaW1wbGUgZGVwbG95bWVudCBpbmZvcm1hdGlvbiBzdG9yZSBpbnNpZGUgY29udHJhY3Qgc3RvcmFnZS4KY29udHJhY3QgRGVwbG95bWVudEluZm8gewogIHVpbnQgcHJpdmF0ZSBkZXBsb3llZF9vbjsKCiAgZnVuY3Rpb24gRGVwbG95bWVudEluZm8oKSBwdWJsaWMgewogICAgZGVwbG95ZWRfb24gPSBibG9jay5udW1iZXI7CiAgfQoKCiAgZnVuY3Rpb24gZ2V0RGVwbG95bWVudEJsb2NrKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGRlcGxveWVkX29uOwogIH0KfQoKCi8vIFRoaXMgY29udHJhY3QgaGFzIHRoZSBzb2xlIG9iamVjdGl2ZSBvZiBwcm92aWRpbmcgYSBzYW5lIGNvbmNyZXRlIGluc3RhbmNlIG9mIHRoZSBDcm93ZHNhbGUgY29udHJhY3QuCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBHZW5lcmljQ3Jvd2RzYWxlLCBMb3N0QW5kRm91bmRUb2tlbiwgVG9rZW5UcmFuY2hlUHJpY2luZywgRGVwbG95bWVudEluZm8gewogIHVpbnQ4IHByaXZhdGUgY29uc3RhbnQgdG9rZW5fZGVjaW1hbHMgPSAxODsKICAvLyBJbml0aWFsIHN1cHBseSBpcyA0MDBrLCB0b2tlbnMgcHV0IHVwIG9uIHNhbGUgYXJlIG9idGFpbmVkIGZyb20gdGhlIGluaXRpYWwgbWludGluZwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCB0b2tlbl9pbml0aWFsX3N1cHBseSA9IDQgKiAoMTAgKiogOCkgKiAoMTAgKiogdWludCh0b2tlbl9kZWNpbWFscykpOwogIGJvb2wgcHJpdmF0ZSBjb25zdGFudCB0b2tlbl9taW50YWJsZSA9IHRydWU7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHNlbGxhYmxlX3Rva2VucyA9IDYgKiAoMTAgKiogOCkgKiAoMTAgKiogdWludCh0b2tlbl9kZWNpbWFscykpOwogIAogIC8vIFNldHMgbWluaW11bSB2YWx1ZSB0aGF0IGNhbiBiZSBib3VnaHQKICB1aW50IHB1YmxpYyBtaW5pbXVtX2J1eV92YWx1ZSA9IDE4ICogMSBldGhlciAvIDEwMDA7CiAgLy8gRXRoIHByaWNlIG11bHRpcGxpZWQgYnkgMTAwMDsKICB1aW50IHB1YmxpYyBtaWxpZXVyc19wZXJfZXRoOwogIC8vIEFkZHJlc3MgYWxsb3dlZCB0byB1cGRhdGUgZXRoIHByaWNlLgogIGFkZHJlc3MgcmF0ZV9hZG1pbjsKCiAgLyoqCiAgICogQ29uc3RydWN0b3IgZm9yIHRoZSBjcm93ZHNhbGUuCiAgICogTm9ybWFsbHksIHRoZSB0b2tlbiBjb250cmFjdCBpcyBjcmVhdGVkIGhlcmUuIFRoYXQgd2F5LCB0aGUgbWludGluZywgcmVsZWFzZSBhbmQgdHJhbnNmZXIgYWdlbnRzIGNhbiBiZSBzZXQgaGVyZSB0b28uCiAgICoKICAgKiBAcGFyYW0gZXRoX3ByaWNlX2luX2V1cnMgRXRoZXIgcHJpY2UgaW4gRVVSLgogICAqIEBwYXJhbSB0ZWFtX211bHRpc2lnIEFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnbmF0dXJlIHdhbGxldCBvZiB0aGUgdGVhbSB0aGF0IHdpbGwgcmVjZWl2ZSBhbGwgdGhlIGZ1bmRzIGNvbnRyaWJ1dGVkIGluIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHN0YXJ0IEJsb2NrIG51bWJlciB3aGVyZSB0aGUgY3Jvd2RzYWxlIHdpbGwgYmUgb2ZmaWNpYWxseSBzdGFydGVkLiBJdCBzaG91bGQgYmUgZ3JlYXRlciB0aGFuIHRoZSBibG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIGNvbnRyYWN0IGlzIGRlcGxveWVkLgogICAqIEBwYXJhbSBlbmQgQmxvY2sgbnVtYmVyIHdoZXJlIHRoZSBjcm93ZHNhbGUgZmluaXNoZXMuIE5vIHRva2VucyBjYW4gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QgYWZ0ZXIgdGhpcyBibG9jay4KICAgKiBAcGFyYW0gdG9rZW5fcmV0cmlldmVyIEFkZHJlc3MgdGhhdCB3aWxsIGhhbmRsZSB0b2tlbnMgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhlIHRva2VuIGNvbnRyYWN0LiBTZWUgdGhlIExvc3RBbmRGb3VuZFRva2VuIGFuZCBDcm93ZHNhbGVUb2tlbiBjb250cmFjdHMgZm9yIGZ1cnRoZXIgZGV0YWlscy4KICAgKiBAcGFyYW0gaW5pdF90cmFuY2hlcyBMaXN0IG9mIHNlcmlhbGl6ZWQgdHJhbmNoZXMuIFNlZSBjb25maWcuanMgYW5kIFRva2VuVHJhbmNoZVByaWNpbmcgZm9yIGZ1cnRoZXIgZGV0YWlscy4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGUodWludCBldGhfcHJpY2VfaW5fZXVycywgYWRkcmVzcyB0ZWFtX211bHRpc2lnLCB1aW50IHN0YXJ0LCB1aW50IGVuZCwgYWRkcmVzcyB0b2tlbl9yZXRyaWV2ZXIsIHVpbnRbXSBpbml0X3RyYW5jaGVzKQogIEdlbmVyaWNDcm93ZHNhbGUodGVhbV9tdWx0aXNpZywgc3RhcnQsIGVuZCkgVG9rZW5UcmFuY2hlUHJpY2luZyhpbml0X3RyYW5jaGVzKSBwdWJsaWMgewogICAgcmVxdWlyZShlbmQgPT0gdHJhbmNoZXNbdHJhbmNoZXMubGVuZ3RoLnN1YigxKV0uZW5kKTsKICAgIC8vIFRlc3RpbmcgdmFsdWVzCiAgICB0b2tlbiA9IG5ldyBDcm93ZHNhbGVUb2tlbih0b2tlbl9pbml0aWFsX3N1cHBseSwgdG9rZW5fZGVjaW1hbHMsIHRlYW1fbXVsdGlzaWcsIHRva2VuX21pbnRhYmxlLCB0b2tlbl9yZXRyaWV2ZXIpOwogICAgCiAgICAvL1NldCBldGggcHJpY2UgaW4gRVVSIChtdWx0aXBsaWVkIGJ5IG9uZSB0aG91c2FuZCkKICAgIHVwZGF0ZUV1cnNQZXJFdGgoZXRoX3ByaWNlX2luX2V1cnMpOwoKICAgIC8vIFNldCBwZXJtaXNzaW9ucyB0byBtaW50LCB0cmFuc2ZlciBhbmQgcmVsZWFzZQogICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIHRydWUpOwogICAgdG9rZW4uc2V0VHJhbnNmZXJBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIHRva2VuLnNldFJlbGVhc2VBZ2VudChhZGRyZXNzKHRoaXMpKTsKCiAgICAvLyBBbGxvdyB0aGUgbXVsdGlzaWcgdG8gdHJhbnNmZXIgdG9rZW5zCiAgICB0b2tlbi5zZXRUcmFuc2ZlckFnZW50KHRlYW1fbXVsdGlzaWcsIHRydWUpOwoKICAgIC8vIFRva2VucyB0byBiZSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdAogICAgdG9rZW4ubWludChhZGRyZXNzKHRoaXMpLCBzZWxsYWJsZV90b2tlbnMpOwogICAgLy8gV2UgZG9uJ3QgbmVlZCB0byBtaW50IGFueW1vcmUgZHVyaW5nIHRoZSBsaWZldGltZSBvZiB0aGUgY29udHJhY3QuCiAgICB0b2tlbi5zZXRNaW50QWdlbnQoYWRkcmVzcyh0aGlzKSwgZmFsc2UpOwogIH0KCiAgLy9Ub2tlbiBhc3NpZ25hdGlvbiB0aHJvdWdoIHRyYW5zZmVyCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIGludGVybmFsIHsKICAgIHRva2VuLnRyYW5zZmVyKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CiAgfQoKICAvL1Rva2VuIGFtb3VudCBjYWxjdWxhdGlvbgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuQW1vdW50KHVpbnQgd2VpQW1vdW50LCBhZGRyZXNzKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgd2VpQWxsb3dlZCwgdWludCB0b2tlbkFtb3VudCkgewogICAgdWludCB0b2tlbnNQZXJFdGggPSBnZXRDdXJyZW50UHJpY2UodG9rZW5zU29sZCkubXVsKG1pbGlldXJzX3Blcl9ldGgpLmRpdigxMDAwKTsKICAgIHVpbnQgbWF4V2VpQWxsb3dlZCA9IHNlbGxhYmxlX3Rva2Vucy5zdWIodG9rZW5zU29sZCkubXVsKDEgZXRoZXIpLmRpdih0b2tlbnNQZXJFdGgpOwogICAgd2VpQWxsb3dlZCA9IG1heFdlaUFsbG93ZWQubWluMjU2KHdlaUFtb3VudCk7CgogICAgaWYgKHdlaUFtb3VudCA8IG1heFdlaUFsbG93ZWQpIHsKICAgICAgLy9EaXZpZGVkIGJ5IDEwMDAgYmVjYXVzZSBldGggZXRoX3ByaWNlX2luX2V1cnMgaXMgbXVsdGlwbGllZCBieSAxMDAwCiAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5zUGVyRXRoLm11bCh3ZWlBbW91bnQpLmRpdigxIGV0aGVyKTsKICAgIH0KICAgIC8vIFdpdGggdGhpcyBjYXNlIHdlIGxldCB0aGUgY3Jvd2RzYWxlIGVuZCBldmVuIHdoZW4gdGhlcmUgYXJlIHJvdW5kaW5nIGVycm9ycyBkdWUgdG8gdGhlIHRva2VucyB0byB3ZWkgcmF0aW8KICAgIGVsc2UgewogICAgICB0b2tlbkFtb3VudCA9IHNlbGxhYmxlX3Rva2Vucy5zdWIodG9rZW5zU29sZCk7CiAgICB9CiAgfQoKICAvLyBJbXBsZW1lbnRzIHRoZSBjcml0ZXJpb24gb2YgdGhlIGZ1bmRpbmcgc3RhdGUKICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0b2tlbnNTb2xkID49IHNlbGxhYmxlX3Rva2VuczsKICB9CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gZGVjaWRlcyB3aG8gaGFuZGxlcyBsb3N0IHRva2Vucy4KICAgKiBEbyBub3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBpcyBOT1QgbWVhbnQgdG8gYmUgdXNlZCBpbiBhIHRva2VuIHJlZnVuZCBtZWNoYW5pc20uCiAgICogSXRzIHNvbGUgcHVycG9zZSBpcyBkZXRlcm1pbmluZyB3aG8gY2FuIG1vdmUgYXJvdW5kIEVSQzIwIHRva2VucyBhY2NpZGVudGFsbHkgc2VudCB0byB0aGlzIGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIGdldExvc3RBbmRGb3VuZE1hc3RlcigpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgcmV0dXJuIG93bmVyOwogIH0KCiAgLyoqCiAgICogQGRldiBTZXRzIG5ldyBtaW5pbXVtIGJ1eSB2YWx1ZSBmb3IgYSB0cmFuc2FjdGlvbi4gT25seSB0aGUgb3duZXIgY2FuIGNhbGwgaXQuCiAgICovCiAgZnVuY3Rpb24gc2V0TWluaW11bUJ1eVZhbHVlKHVpbnQgbmV3VmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgbWluaW11bV9idXlfdmFsdWUgPSBuZXdWYWx1ZTsKICB9CgogIC8qKgogICAqIEludmVzdGluZyBmdW5jdGlvbiB0aGF0IHJlY29nbml6ZXMgdGhlIHBheWVyIGFuZCB2ZXJpZmllcyB0aGF0IGhlIGlzIGFsbG93ZWQgdG8gaW52ZXN0LgogICAqCiAgICogT3ZlcndyaXR0ZW4gdG8gYWRkIGNvbmZpZ3VyYWJsZSBtaW5pbXVtIHZhbHVlCiAgICoKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoU2lnbmVkQWRkcmVzcyh1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSBpbnZlc3RtZW50SXNCaWdFbm91Z2gobXNnLnNlbmRlcikgdmFsaWRDdXN0b21lcklkKGN1c3RvbWVySWQpIHsKICAgIHN1cGVyLmJ1eVdpdGhTaWduZWRBZGRyZXNzKGN1c3RvbWVySWQsIHYsIHIsIHMpOwogIH0KCgogIC8qKgogICAqIEludmVzdGluZyBmdW5jdGlvbiB0aGF0IHJlY29nbml6ZXMgdGhlIHBheWVyLgogICAqIAogICAqIEBwYXJhbSBjdXN0b21lcklkIFVVSUR2NCB0aGF0IGlkZW50aWZpZXMgdGhpcyBjb250cmlidXRvcgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgaW52ZXN0bWVudElzQmlnRW5vdWdoKG1zZy5zZW5kZXIpIHZhbGlkQ3VzdG9tZXJJZChjdXN0b21lcklkKSB1bnNpZ25lZEJ1eUFsbG93ZWQgewogICAgc3VwZXIuYnV5V2l0aEN1c3RvbWVySWQoY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIGludmVzdG1lbnRJc0JpZ0Vub3VnaChtc2cuc2VuZGVyKSB1bnNpZ25lZEJ1eUFsbG93ZWQgewogICAgc3VwZXIuYnV5KCk7CiAgfQoKICAvLyBFeHRlbmRlZCB0byB0cmFuc2ZlciBoYWxmIG9mIHRoZSB1bnVzZWQgZnVuZHMgdG8gdGhlIHRlYW0ncyBtdWx0aXNpZyBhbmQgcmVsZWFzZSB0aGUgdG9rZW4KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewogICAgdG9rZW4ucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsKICAgIHVpbnQgdW5zb2xkVG9rZW5zID0gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgdG9rZW4udHJhbnNmZXIobXVsdGlzaWdXYWxsZXQsIHVuc29sZFRva2Vucyk7CiAgICBzdXBlci5maW5hbGl6ZSgpOwogIH0KCiAgLy9DaGFuZ2UgdGhlIHRoZSBzdGFydGluZyB0aW1lIGluIG9yZGVyIHRvIGVuZCB0aGUgcHJlc2FsZSBwZXJpb2QgZWFybHkgaWYgbmVlZGVkLgogIGZ1bmN0aW9uIHNldFN0YXJ0aW5nVGltZSh1aW50IHN0YXJ0aW5nVGltZSkgcHVibGljIG9ubHlPd25lciBpblN0YXRlKFN0YXRlLlByZUZ1bmRpbmcpIHsKICAgIHJlcXVpcmUoc3RhcnRpbmdUaW1lID4gYmxvY2sudGltZXN0YW1wICYmIHN0YXJ0aW5nVGltZSA8IGVuZHNBdCk7CiAgICBzdGFydHNBdCA9IHN0YXJ0aW5nVGltZTsKICB9CgogIC8vQ2hhbmdlIHRoZSB0aGUgZW5kaW5nIHRpbWUgaW4gb3JkZXIgdG8gYmUgYWJsZSB0byBmaW5hbGl6ZSB0aGUgY3Jvd2RzYWxlIGlmIG5lZWRlZC4KICBmdW5jdGlvbiBzZXRFbmRpbmdUaW1lKHVpbnQgZW5kaW5nVGltZSkgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCB7CiAgICByZXF1aXJlKGVuZGluZ1RpbWUgPiBibG9jay50aW1lc3RhbXAgJiYgZW5kaW5nVGltZSA+IHN0YXJ0c0F0KTsKICAgIGVuZHNBdCA9IGVuZGluZ1RpbWU7CiAgfQoKICAvKioKICAgKiBPdmVycmlkZSB0byByZWplY3QgY2FsbHMgdW5sZXNzIHRoZSBjcm93ZHNhbGUgaXMgZmluYWxpemVkIG9yCiAgICogIHRoZSB0b2tlbiBjb250cmFjdCBpcyBub3QgdGhlIG9uZSBjb3JyZXNwb25kaW5nIHRvIHRoaXMgY3Jvd2RzYWxlCiAgICovCiAgZnVuY3Rpb24gZW5hYmxlTG9zdEFuZEZvdW5kKGFkZHJlc3MgYWdlbnQsIHVpbnQgdG9rZW5zLCBFSVAyMFRva2VuIHRva2VuX2NvbnRyYWN0KSBwdWJsaWMgewogICAgLy8gRWl0aGVyIHRoZSBzdGF0ZSBpcyBmaW5hbGl6ZWQgb3IgdGhlIHRva2VuX2NvbnRyYWN0IGlzIG5vdCB0aGlzIGNyb3dkc2FsZSB0b2tlbgogICAgcmVxdWlyZShhZGRyZXNzKHRva2VuX2NvbnRyYWN0KSAhPSBhZGRyZXNzKHRva2VuKSB8fCBnZXRTdGF0ZSgpID09IFN0YXRlLkZpbmFsaXplZCk7CiAgICBzdXBlci5lbmFibGVMb3N0QW5kRm91bmQoYWdlbnQsIHRva2VucywgdG9rZW5fY29udHJhY3QpOwogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXVyc1BlckV0aCh1aW50IG1pbGlldXJzX2Ftb3VudCkgcHVibGljIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lciB8fCBtc2cuc2VuZGVyID09IHJhdGVfYWRtaW4pOwogICAgcmVxdWlyZShtaWxpZXVyc19hbW91bnQgPj0gMTAwKTsKICAgIG1pbGlldXJzX3Blcl9ldGggPSBtaWxpZXVyc19hbW91bnQ7CiAgfQoKICBmdW5jdGlvbiBzZXRSYXRlQWRtaW4oYWRkcmVzcyBhZG1pbikgcHVibGljIG9ubHlPd25lciB7CiAgICByYXRlX2FkbWluID0gYWRtaW47CiAgfQoKCiAgbW9kaWZpZXIgaW52ZXN0bWVudElzQmlnRW5vdWdoKGFkZHJlc3MgYWdlbnQpIHsKICAgIHJlcXVpcmUobXNnLnZhbHVlLmFkZChpbnZlc3RlZEFtb3VudE9mW2FnZW50XSkgPj0gbWluaW11bV9idXlfdmFsdWUpOwogICAgXzsKICB9Cn0='.
	

]
