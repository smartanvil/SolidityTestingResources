Class {
	#name : #SRTb64e6bef349a0d3e8571ac80b5ec522b417faeb6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb64e6bef349a0d3e8571ac80b5ec522b417faeb6 >> base64 [
	^ 'Ly8gQ3J5cHRvUHVwcGllcyBTb3VyY2UgY29kZQovLyBDb3BpZWQgZnJvbTogaHR0cHM6Ly9ldGhlcnNjYW4uaW8vYWRkcmVzcy8weDA2MDEyYzhjZjk3YmVhZDVkZWFlMjM3MDcwZjk1ODdmOGU3YTI2NmQjY29kZQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KICB9Cgp9CgoKCi8vLyBAdGl0bGUgSW50ZXJmYWNlIGZvciBjb250cmFjdHMgY29uZm9ybWluZyB0byBFUkMtNzIxOiBOb24tRnVuZ2libGUgVG9rZW5zCi8vLyBAYXV0aG9yIERpZXRlciBTaGlybGV5IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImZiOWY5ZThmOWViYjlhODM5Mjk0OTY4MTllOTVkNTk4OTQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiAoaHR0cHM6Ly9naXRodWIuY29tL2RldGUpCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgICAvLyBPcHRpb25hbAogICAgLy8gZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICAgIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBzeW1ib2wpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2W10gdG9rZW5JZHMpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpOwoKICAgIC8vIEVSQy0xNjUgQ29tcGF0aWJpbGl0eSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KCgovLyAvLyBBdWN0aW9uIHdyYXBwZXIgZnVuY3Rpb25zCgoKLy8gQXVjdGlvbiB3cmFwcGVyIGZ1bmN0aW9ucwoKCi8vLyBAdGl0bGUgU0VLUkVUT09PTwpjb250cmFjdCBHZW5lU2NpZW5jZSB7CiAgICAvLy8gQGRldiBzaW1wbHkgYSBib29sZWFuIHRvIGluZGljYXRlIHRoaXMgaXMgdGhlIGNvbnRyYWN0IHdlIGV4cGVjdCB0byBiZQogICAgZnVuY3Rpb24gaXNHZW5lU2NpZW5jZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAZGV2IGdpdmVuIGdlbmVzIG9mIHB1cHBpZXMgMSAmIDIsIHJldHVybiBhIGdlbmV0aWMgY29tYmluYXRpb24gLSBtYXkgaGF2ZSBhIHJhbmRvbSBmYWN0b3IKICAgIC8vLyBAcGFyYW0gZ2VuZXMxIGdlbmVzIG9mIG1vbQogICAgLy8vIEBwYXJhbSBnZW5lczIgZ2VuZXMgb2Ygc2lyZQogICAgLy8vIEByZXR1cm4gdGhlIGdlbmVzIHRoYXQgYXJlIHN1cHBvc2VkIHRvIGJlIHBhc3NlZCBkb3duIHRoZSBjaGlsZAogICAgZnVuY3Rpb24gbWl4R2VuZXModWludDI1NiBnZW5lczEsIHVpbnQyNTYgZ2VuZXMyLCB1aW50MjU2IHRhcmdldEJsb2NrKSBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7Cn0KCi8vLyBAdGl0bGUgUHVwcHkgc3BvcnRzIGNvbnRyYWN0CmNvbnRyYWN0IFB1cHB5U3BvcnRzIHsKICAgIC8vLyBAZGV2IHNpbXBseSBhIGJvb2xlYW4gdG8gaW5kaXB1cHB5ZSB0aGlzIGlzIHRoZSBjb250cmFjdCB3ZSBleHBlY3QgdG8gYmUKICAgIGZ1bmN0aW9uIGlzUHVwcHlTcG9ydHMoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKTsKCiAgICAvLy8gQGRldiBjb250cmFjdCB0aGF0IHByb3ZpZGVzIGdhbWluZyBmdW5jdGlvbmFsaXR5CiAgICAvLy8gQHBhcmFtIHB1cHB5SWQgLSBpZCBvZiB0aGUgcHVwcHkKICAgIC8vLyBAcGFyYW0gZ2FtZUlkIC0gaWQgb2YgdGhlIGdhbWUKICAgIC8vLyBAcGFyYW0gdGFyZ2V0QmxvY2sgLSBwcm9vZiBvZiByYW5kb21uZXNzCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIHB1cHB5IHdvbiB0aGUgZ2FtZSwgZmFsc2Ugb3RoZXJ3aXNlCiAgICBmdW5jdGlvbiBwbGF5R2FtZSh1aW50MjU2IHB1cHB5SWQsIHVpbnQyNTYgZ2FtZUlkLCB1aW50MjU2IHRhcmdldEJsb2NrKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCgovLy8gQHRpdGxlIEEgZmFjZXQgb2YgUHVwcGllc0NvcmUgdGhhdCBtYW5hZ2VzIHNwZWNpYWwgYWNjZXNzIHByaXZpbGVnZXMuCi8vLyBAYXV0aG9yIFNtYXJ0Rm94TGFicwovLy8gQGRldiBTZWUgdGhlIFB1cHBpZXNDb3JlIGNvbnRyYWN0IGRvY3VtZW50YXRpb24gdG8gdW5kZXJzdGFuZCBob3cgdGhlIHZhcmlvdXMgY29udHJhY3QgZmFjZXRzIGFyZSBhcnJhbmdlZC4KY29udHJhY3QgUHVwcHlBY2Nlc3NDb250cm9sIHsKICAgIC8vIFRoaXMgZmFjZXQgY29udHJvbHMgYWNjZXNzIGNvbnRyb2wgZm9yIENyeXB0b1B1cHBpZXMuIFRoZXJlIGFyZSBmb3VyIHJvbGVzIG1hbmFnZWQgaGVyZToKICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0VPOiBUaGUgQ0VPIGNhbiByZWFzc2lnbiBvdGhlciByb2xlcyBhbmQgY2hhbmdlIHRoZSBhZGRyZXNzZXMgb2Ygb3VyIGRlcGVuZGVudCBzbWFydAogICAgLy8gICAgICAgICBjb250cmFjdHMuIEl0IGlzIGFsc28gdGhlIG9ubHkgcm9sZSB0aGF0IGNhbiB1bnBhdXNlIHRoZSBzbWFydCBjb250cmFjdC4gSXQgaXMgaW5pdGlhbGx5CiAgICAvLyAgICAgICAgIHNldCB0byB0aGUgYWRkcmVzcyB0aGF0IGNyZWF0ZWQgdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBQdXBwaWVzQ29yZSBjb25zdHJ1Y3Rvci4KICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0ZPOiBUaGUgQ0ZPIGNhbiB3aXRoZHJhdyBmdW5kcyBmcm9tIFB1cHBpZXNDb3JlIGFuZCBpdHMgYXVjdGlvbiBjb250cmFjdHMuCiAgICAvLwogICAgLy8gICAgIC0gVGhlIENPTzogVGhlIENPTyBjYW4gcmVsZWFzZSBnZW4wIHB1cHBpZXMgdG8gYXVjdGlvbiwgYW5kIG1pbnQgcHJvbW8gcHVwcHlzLgogICAgLy8KICAgIC8vIEl0IHNob3VsZCBiZSBub3RlZCB0aGF0IHRoZXNlIHJvbGVzIGFyZSBkaXN0aW5jdCB3aXRob3V0IG92ZXJsYXAgaW4gdGhlaXIgYWNjZXNzIGFiaWxpdGllcywgdGhlCiAgICAvLyBhYmlsaXRpZXMgbGlzdGVkIGZvciBlYWNoIHJvbGUgYWJvdmUgYXJlIGV4aGF1c3RpdmUuIEluIHBhcnRpY3VsYXIsIHdoaWxlIHRoZSBDRU8gY2FuIGFzc2lnbiBhbnkKICAgIC8vIGFkZHJlc3MgdG8gYW55IHJvbGUsIHRoZSBDRU8gYWRkcmVzcyBpdHNlbGYgZG9lc24ndCBoYXZlIHRoZSBhYmlsaXR5IHRvIGFjdCBpbiB0aG9zZSByb2xlcy4gVGhpcwogICAgLy8gcmVzdHJpY3Rpb24gaXMgaW50ZW50aW9uYWwgc28gdGhhdCB3ZSBhcmVuJ3QgdGVtcHRlZCB0byB1c2UgdGhlIENFTyBhZGRyZXNzIGZyZXF1ZW50bHkgb3V0IG9mCiAgICAvLyBjb252ZW5pZW5jZS4gVGhlIGxlc3Mgd2UgdXNlIGFuIGFkZHJlc3MsIHRoZSBsZXNzIGxpa2VseSBpdCBpcyB0aGF0IHdlIHNvbWVob3cgY29tcHJvbWlzZSB0aGUKICAgIC8vIGFjY291bnQuCgogICAgLy8vIEBkZXYgRW1pdGVkIHdoZW4gY29udHJhY3QgaXMgdXBncmFkZWQgLSBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICBldmVudCBDb250cmFjdFVwZ3JhZGUoYWRkcmVzcyBuZXdDb250cmFjdCk7CgogICAgLy8gVGhlIGFkZHJlc3NlcyBvZiB0aGUgYWNjb3VudHMgKG9yIGNvbnRyYWN0cykgdGhhdCBjYW4gZXhlY3V0ZSBhY3Rpb25zIHdpdGhpbiBlYWNoIHJvbGVzLgogICAgYWRkcmVzcyBwdWJsaWMgY2VvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjb29BZGRyZXNzOwoKICAgIC8vIEBkZXYgS2VlcHMgdHJhY2sgd2hldGhlciB0aGUgY29udHJhY3QgaXMgcGF1c2VkLiBXaGVuIHRoYXQgaXMgdHJ1ZSwgbW9zdCBhY3Rpb25zIGFyZSBibG9ja2VkCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENFTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDRU8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDRk8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ09PLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNPTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q0xldmVsKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb29BZGRyZXNzIHx8IG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyB8fCBtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0VPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRU8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRU8KICAgIGZ1bmN0aW9uIHNldENFTyhhZGRyZXNzIF9uZXdDRU8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2VvQWRkcmVzcyA9IF9uZXdDRU87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0ZPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRk8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRk8KICAgIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NGTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2ZvQWRkcmVzcyA9IF9uZXdDRk87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ09PLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDT08gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDT08KICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIF9uZXdDT08pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NPTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY29vQWRkcmVzcyA9IF9uZXdDT087CiAgICB9CgogICAgLyoqKiBQYXVzYWJsZSBmdW5jdGlvbmFsaXR5IGFkYXB0ZWQgZnJvbSBPcGVuWmVwcGVsaW4gKioqLwoKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxsZWQgYnkgYW55ICJDLWxldmVsIiByb2xlIHRvIHBhdXNlIHRoZSBjb250cmFjdC4gVXNlZCBvbmx5IHdoZW4KICAgIC8vLyAgYSBidWcgb3IgZXhwbG9pdCBpcyBkZXRlY3RlZCBhbmQgd2UgbmVlZCB0byBsaW1pdCBkYW1hZ2UuCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlDTGV2ZWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBVbnBhdXNlcyB0aGUgc21hcnQgY29udHJhY3QuIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgQ0VPLCBzaW5jZQogICAgLy8vICBvbmUgcmVhc29uIHdlIG1heSBwYXVzZSB0aGUgY29udHJhY3QgaXMgd2hlbiBDRk8gb3IgQ09PIGFjY291bnRzIGFyZQogICAgLy8vICBjb21wcm9taXNlZC4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgcHVibGljIHJhdGhlciB0aGFuIGV4dGVybmFsIHNvIGl0IGNhbiBiZSBjYWxsZWQgYnkKICAgIC8vLyAgZGVyaXZlZCBjb250cmFjdHMuCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgLy8gY2FuJ3QgdW5wYXVzZSBpZiBjb250cmFjdCB3YXMgdXBncmFkZWQKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgIH0KfQoKLy8vIEB0aXRsZSBCYXNlIGNvbnRyYWN0IGZvciBDcnlwdG9QdXBwaWVzLiBIb2xkcyBhbGwgY29tbW9uIHN0cnVjdHMsIGV2ZW50cyBhbmQgYmFzZSB2YXJpYWJsZXMuCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFNlZSB0aGUgUHVwcGllc0NvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBQdXBweUJhc2UgaXMgUHVwcHlBY2Nlc3NDb250cm9sIHsKICAgIC8qKiogRVZFTlRTICoqKi8KCiAgICAvLy8gQGRldiBUaGUgQmlydGggZXZlbnQgaXMgZmlyZWQgd2hlbmV2ZXIgYSBuZXcgcHVwcHkgY29tZXMgaW50byBleGlzdGVuY2UuIFRoaXMgb2J2aW91c2x5CiAgICAvLy8gIGluY2x1ZGVzIGFueSB0aW1lIGEgcHVwcHkgaXMgY3JlYXRlZCB0aHJvdWdoIHRoZSBnaXZlQmlydGggbWV0aG9kLCBidXQgaXQgaXMgYWxzbyBjYWxsZWQKICAgIC8vLyAgd2hlbiBhIG5ldyBnZW4wIHB1cHB5IGlzIGNyZWF0ZWQuCiAgICBldmVudCBCaXJ0aChhZGRyZXNzIG93bmVyLCB1aW50MjU2IHB1cHB5SWQsIHVpbnQyNTYgbWF0cm9uSWQsIHVpbnQyNTYgc2lyZUlkLCB1aW50MjU2IGdlbmVzKTsKCiAgICAvLy8gQGRldiBUcmFuc2ZlciBldmVudCBhcyBkZWZpbmVkIGluIGN1cnJlbnQgZHJhZnQgb2YgRVJDNzIxLiBFbWl0dGVkIGV2ZXJ5IHRpbWUgYSBwdXBweQogICAgLy8vICBvd25lcnNoaXAgaXMgYXNzaWduZWQsIGluY2x1ZGluZyBiaXJ0aHMuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLyoqKiBEQVRBIFRZUEVTICoqKi8KCiAgICAvLy8gQGRldiBUaGUgbWFpbiBQdXBweSBzdHJ1Y3QuIEV2ZXJ5IHB1cHB5IGluIENyeXB0b1B1cHBpZXMgaXMgcmVwcmVzZW50ZWQgYnkgYSBjb3B5CiAgICAvLy8gIG9mIHRoaXMgc3RydWN0dXJlLCBzbyBncmVhdCBjYXJlIHdhcyB0YWtlbiB0byBlbnN1cmUgdGhhdCBpdCBmaXRzIG5lYXRseSBpbnRvCiAgICAvLy8gIGV4YWN0bHkgdHdvIDI1Ni1iaXQgd29yZHMuIE5vdGUgdGhhdCB0aGUgb3JkZXIgb2YgdGhlIG1lbWJlcnMgaW4gdGhpcyBzdHJ1Y3R1cmUKICAgIC8vLyAgaXMgaW1wb3J0YW50IGJlY2F1c2Ugb2YgdGhlIGJ5dGUtcGFja2luZyBydWxlcyB1c2VkIGJ5IEV0aGVyZXVtLgogICAgLy8vICBSZWY6IGh0dHA6Ly9zb2xpZGl0eS5yZWFkdGhlZG9jcy5pby9lbi9kZXZlbG9wL21pc2NlbGxhbmVvdXMuaHRtbAogICAgc3RydWN0IFB1cHB5IHsKICAgICAgICAvLyBUaGUgUHVwcHkncyBnZW5ldGljIGNvZGUgaXMgcGFja2VkIGludG8gdGhlc2UgMjU2LWJpdHMsIHRoZSBmb3JtYXQgaXMKICAgICAgICAvLyBzb29wZXItc2VrcmV0ISBBIHB1cHB5J3MgZ2VuZXMgbmV2ZXIgY2hhbmdlLgogICAgICAgIHVpbnQyNTYgZ2VuZXM7CgogICAgICAgIC8vIFRoZSB0aW1lc3RhbXAgZnJvbSB0aGUgYmxvY2sgd2hlbiB0aGlzIHB1cHB5IGNhbWUgaW50byBleGlzdGVuY2UuCiAgICAgICAgdWludDY0IGJpcnRoVGltZTsKCiAgICAgICAgLy8gVGhlIG1pbmltdW0gdGltZXN0YW1wIGFmdGVyIHdoaWNoIHRoaXMgcHVwcHkgY2FuIGVuZ2FnZSBpbiBicmVlZGluZwogICAgICAgIC8vIGFjdGl2aXRpZXMgYWdhaW4uIFRoaXMgc2FtZSB0aW1lc3RhbXAgaXMgdXNlZCBmb3IgdGhlIHByZWduYW5jeQogICAgICAgIC8vIHRpbWVyIChmb3IgbWF0cm9ucykgYXMgd2VsbCBhcyB0aGUgc2lyaW5nIGNvb2xkb3duLgogICAgICAgIHVpbnQ2NCBjb29sZG93bkVuZEJsb2NrOwoKICAgICAgICAvLyBUaGUgSUQgb2YgdGhlIHBhcmVudHMgb2YgdGhpcyBQdXBweSwgc2V0IHRvIDAgZm9yIGdlbjAgcHVwcHlzLgogICAgICAgIC8vIE5vdGUgdGhhdCB1c2luZyAzMi1iaXQgdW5zaWduZWQgaW50ZWdlcnMgbGltaXRzIHVzIHRvIGEgIm1lcmUiCiAgICAgICAgLy8gNCBiaWxsaW9uIHB1cHB5cy4gVGhpcyBudW1iZXIgbWlnaHQgc2VlbSBzbWFsbCB1bnRpbCB5b3UgcmVhbGl6ZQogICAgICAgIC8vIHRoYXQgRXRoZXJldW0gY3VycmVudGx5IGhhcyBhIGxpbWl0IG9mIGFib3V0IDUwMCBtaWxsaW9uCiAgICAgICAgLy8gdHJhbnNhY3Rpb25zIHBlciB5ZWFyISBTbywgdGhpcyBkZWZpbml0ZWx5IHdvbid0IGJlIGEgcHJvYmxlbQogICAgICAgIC8vIGZvciBzZXZlcmFsIHllYXJzIChldmVuIGFzIEV0aGVyZXVtIGxlYXJucyB0byBzY2FsZSkuCiAgICAgICAgdWludDMyIG1hdHJvbklkOwogICAgICAgIHVpbnQzMiBzaXJlSWQ7CgogICAgICAgIC8vIFNldCB0byB0aGUgSUQgb2YgdGhlIHNpcmUgcHVwcHkgZm9yIG1hdHJvbnMgdGhhdCBhcmUgcHJlZ25hbnQsCiAgICAgICAgLy8gemVybyBvdGhlcndpc2UuIEEgbm9uLXplcm8gdmFsdWUgaGVyZSBpcyBob3cgd2Uga25vdyBhIHB1cHB5CiAgICAgICAgLy8gaXMgcHJlZ25hbnQuIFVzZWQgdG8gcmV0cmlldmUgdGhlIGdlbmV0aWMgbWF0ZXJpYWwgZm9yIHRoZSBuZXcKICAgICAgICAvLyBwdXBweSB3aGVuIHRoZSBiaXJ0aCB0cmFuc3BpcmVzLgogICAgICAgIHVpbnQzMiBzaXJpbmdXaXRoSWQ7CgogICAgICAgIC8vIFNldCB0byB0aGUgaW5kZXggaW4gdGhlIGNvb2xkb3duIGFycmF5IChzZWUgYmVsb3cpIHRoYXQgcmVwcmVzZW50cwogICAgICAgIC8vIHRoZSBjdXJyZW50IGNvb2xkb3duIGR1cmF0aW9uIGZvciB0aGlzIFB1cHB5LiBUaGlzIHN0YXJ0cyBhdCB6ZXJvCiAgICAgICAgLy8gZm9yIGdlbjAgcHVwcHlzLCBhbmQgaXMgaW5pdGlhbGl6ZWQgdG8gZmxvb3IoZ2VuZXJhdGlvbi8yKSBmb3Igb3RoZXJzLgogICAgICAgIC8vIEluY3JlbWVudGVkIGJ5IG9uZSBmb3IgZWFjaCBzdWNjZXNzZnVsIGJyZWVkaW5nIGFjdGlvbiwgcmVnYXJkbGVzcwogICAgICAgIC8vIG9mIHdoZXRoZXIgdGhpcyBwdXBweSBpcyBhY3RpbmcgYXMgbWF0cm9uIG9yIHNpcmUuCiAgICAgICAgdWludDE2IGNvb2xkb3duSW5kZXg7CgogICAgICAgIC8vIFRoZSAiZ2VuZXJhdGlvbiBudW1iZXIiIG9mIHRoaXMgcHVwcHkuIHB1cHB5cyBtaW50ZWQgYnkgdGhlIENLIGNvbnRyYWN0CiAgICAgICAgLy8gZm9yIHNhbGUgYXJlIGNhbGxlZCAiZ2VuMCIgYW5kIGhhdmUgYSBnZW5lcmF0aW9uIG51bWJlciBvZiAwLiBUaGUKICAgICAgICAvLyBnZW5lcmF0aW9uIG51bWJlciBvZiBhbGwgb3RoZXIgcHVwcHlzIGlzIHRoZSBsYXJnZXIgb2YgdGhlIHR3byBnZW5lcmF0aW9uCiAgICAgICAgLy8gbnVtYmVycyBvZiB0aGVpciBwYXJlbnRzLCBwbHVzIG9uZS4KICAgICAgICAvLyAoaS5lLiBtYXgobWF0cm9uLmdlbmVyYXRpb24sIHNpcmUuZ2VuZXJhdGlvbikgKyAxKQogICAgICAgIHVpbnQxNiBnZW5lcmF0aW9uOwoKICAgICAgICB1aW50MTYgY2hpbGROdW1iZXI7CgogICAgICAgIHVpbnQxNiBzdHJlbmd0aDsKCiAgICAgICAgdWludDE2IGFnaWxpdHk7CgogICAgICAgIHVpbnQxNiBpbnRlbGxpZ2VuY2U7CgogICAgICAgIHVpbnQxNiBzcGVlZDsKICAgIH0KCiAgICAvKioqIENPTlNUQU5UUyAqKiovCgogICAgLy8vIEBkZXYgQSBsb29rdXAgdGFibGUgaW5kaXB1cHB5aW5nIHRoZSBjb29sZG93biBkdXJhdGlvbiBhZnRlciBhbnkgc3VjY2Vzc2Z1bAogICAgLy8vICBicmVlZGluZyBhY3Rpb24sIGNhbGxlZCAicHJlZ25hbmN5IHRpbWUiIGZvciBtYXRyb25zIGFuZCAic2lyaW5nIGNvb2xkb3duIgogICAgLy8vICBmb3Igc2lyZXMuIERlc2lnbmVkIHN1Y2ggdGhhdCB0aGUgY29vbGRvd24gcm91Z2hseSBkb3VibGVzIGVhY2ggdGltZSBhIHB1cHB5CiAgICAvLy8gIGlzIGJyZWQsIGVuY291cmFnaW5nIG93bmVycyBub3QgdG8ganVzdCBrZWVwIGJyZWVkaW5nIHRoZSBzYW1lIHB1cHB5IG92ZXIKICAgIC8vLyAgYW5kIG92ZXIgYWdhaW4uIENhcHMgb3V0IGF0IG9uZSB3ZWVrIChhIHB1cHB5IGNhbiBicmVlZCBhbiB1bmJvdW5kZWQgbnVtYmVyCiAgICAvLy8gIG9mIHRpbWVzLCBhbmQgdGhlIG1heGltdW0gY29vbGRvd24gaXMgYWx3YXlzIHNldmVuIGRheXMpLgogICAgdWludDMyWzE0XSBwdWJsaWMgY29vbGRvd25zID0gWwogICAgICAgIHVpbnQzMigxIG1pbnV0ZXMpLAogICAgICAgIHVpbnQzMigyIG1pbnV0ZXMpLAogICAgICAgIHVpbnQzMig1IG1pbnV0ZXMpLAogICAgICAgIHVpbnQzMigxMCBtaW51dGVzKSwKICAgICAgICB1aW50MzIoMzAgbWludXRlcyksCiAgICAgICAgdWludDMyKDEgaG91cnMpLAogICAgICAgIHVpbnQzMigyIGhvdXJzKSwKICAgICAgICB1aW50MzIoNCBob3VycyksCiAgICAgICAgdWludDMyKDggaG91cnMpLAogICAgICAgIHVpbnQzMigxNiBob3VycyksCiAgICAgICAgdWludDMyKDEgZGF5cyksCiAgICAgICAgdWludDMyKDIgZGF5cyksCiAgICAgICAgdWludDMyKDQgZGF5cyksCiAgICAgICAgdWludDMyKDcgZGF5cykKICAgIF07CgogICAgLy8gQW4gYXBwcm94aW1hdGlvbiBvZiBjdXJyZW50bHkgaG93IG1hbnkgc2Vjb25kcyBhcmUgaW4gYmV0d2VlbiBibG9ja3MuCiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRzUGVyQmxvY2sgPSAxNTsKCiAgICAvKioqIFNUT1JBR0UgKioqLwoKICAgIC8vLyBAZGV2IEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIFB1cHB5IHN0cnVjdCBmb3IgYWxsIHB1cHBpZXMgaW4gZXhpc3RlbmNlLiBUaGUgSUQKICAgIC8vLyAgb2YgZWFjaCBwdXBweSBpcyBhY3R1YWxseSBhbiBpbmRleCBpbnRvIHRoaXMgYXJyYXkuIE5vdGUgdGhhdCBJRCAwIGlzIGEgbmVnYXB1cHB5LAogICAgLy8vICB0aGUgdW5QdXBweSwgdGhlIG15dGhpY2FsIGJlYXN0IHRoYXQgaXMgdGhlIHBhcmVudCBvZiBhbGwgZ2VuMCBwdXBweXMuIEEgYml6YXJyZQogICAgLy8vICBjcmVhdHVyZSB0aGF0IGlzIGJvdGggbWF0cm9uIGFuZCBzaXJlLi4uIHRvIGl0c2VsZiEgSGFzIGFuIGludmFsaWQgZ2VuZXRpYyBjb2RlLgogICAgLy8vICBJbiBvdGhlciB3b3JkcywgcHVwcHkgSUQgMCBpcyBpbnZhbGlkLi4uIDstKQogICAgUHVwcHlbXSBwdXBwaWVzOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIHB1cHB5IElEcyB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlbS4gQWxsIHB1cHB5cyBoYXZlCiAgICAvLy8gIHNvbWUgdmFsaWQgb3duZXIgYWRkcmVzcywgZXZlbiBnZW4wIHB1cHB5cyBhcmUgY3JlYXRlZCB3aXRoIGEgbm9uLXplcm8gb3duZXIuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBQdXBweUluZGV4VG9Pd25lcjsKCiAgICAvLyBAZGV2IEEgbWFwcGluZyBmcm9tIG93bmVyIGFkZHJlc3MgdG8gY291bnQgb2YgdG9rZW5zIHRoYXQgYWRkcmVzcyBvd25zLgogICAgLy8gIFVzZWQgaW50ZXJuYWxseSBpbnNpZGUgYmFsYW5jZU9mKCkgdG8gcmVzb2x2ZSBvd25lcnNoaXAgY291bnQuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVyc2hpcFRva2VuQ291bnQ7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gcHVwcHlJZHMgdG8gYW4gYWRkcmVzcyB0aGF0IGhhcyBiZWVuIGFwcHJvdmVkIHRvIGNhbGwKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIEVhY2ggUHVwcHkgY2FuIG9ubHkgaGF2ZSBvbmUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgdHJhbnNmZXIKICAgIC8vLyAgYXQgYW55IHRpbWUuIEEgemVybyB2YWx1ZSBtZWFucyBubyBhcHByb3ZhbCBpcyBvdXRzdGFuZGluZy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIFB1cHB5SW5kZXhUb0FwcHJvdmVkOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIHB1cHB5SWRzIHRvIGFuIGFkZHJlc3MgdGhhdCBoYXMgYmVlbiBhcHByb3ZlZCB0byB1c2UKICAgIC8vLyAgdGhpcyBQdXBweSBmb3Igc2lyaW5nIHZpYSBicmVlZFdpdGgoKS4gRWFjaCBQdXBweSBjYW4gb25seSBoYXZlIG9uZSBhcHByb3ZlZAogICAgLy8vICBhZGRyZXNzIGZvciBzaXJpbmcgYXQgYW55IHRpbWUuIEEgemVybyB2YWx1ZSBtZWFucyBubyBhcHByb3ZhbCBpcyBvdXRzdGFuZGluZy4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHNpcmVBbGxvd2VkVG9BZGRyZXNzOwoKICAgIC8vLyBAZGV2IFRoZSBhZGRyZXNzIG9mIHRoZSBDbG9ja0F1Y3Rpb24gY29udHJhY3QgdGhhdCBoYW5kbGVzIHNhbGVzIG9mIHB1cHBpZXMuIFRoaXMKICAgIC8vLyAgc2FtZSBjb250cmFjdCBoYW5kbGVzIGJvdGggcGVlci10by1wZWVyIHNhbGVzIGFzIHdlbGwgYXMgdGhlIGdlbjAgc2FsZXMgd2hpY2ggYXJlCiAgICAvLy8gIGluaXRpYXRlZCBldmVyeSAxNSBtaW51dGVzLgogICAgU2FsZUNsb2NrQXVjdGlvbiBwdWJsaWMgc2FsZUF1Y3Rpb247CgogICAgLy8vIEBkZXYgVGhlIGFkZHJlc3Mgb2YgYSBjdXN0b20gQ2xvY2tBdWN0aW9uIHN1YmNsYXNzZWQgY29udHJhY3QgdGhhdCBoYW5kbGVzIHNpcmluZwogICAgLy8vICBhdWN0aW9ucy4gTmVlZHMgdG8gYmUgc2VwYXJhdGUgZnJvbSBzYWxlQXVjdGlvbiBiZWNhdXNlIHRoZSBhY3Rpb25zIHRha2VuIG9uIHN1Y2Nlc3MKICAgIC8vLyAgYWZ0ZXIgYSBzYWxlcyBhbmQgc2lyaW5nIGF1Y3Rpb24gYXJlIHF1aXRlIGRpZmZlcmVudC4KICAgIFNpcmluZ0Nsb2NrQXVjdGlvbiBwdWJsaWMgc2lyaW5nQXVjdGlvbjsKCiAgICAvLy8gQGRldiBBc3NpZ25zIG93bmVyc2hpcCBvZiBhIHNwZWNpZmljIFB1cHB5IHRvIGFuIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBTaW5jZSB0aGUgbnVtYmVyIG9mIHB1cHB5cyBpcyBjYXBwZWQgdG8gMl4zMiB3ZSBjYW4ndCBvdmVyZmxvdyB0aGlzCiAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CiAgICAgICAgLy8gdHJhbnNmZXIgb3duZXJzaGlwCiAgICAgICAgUHVwcHlJbmRleFRvT3duZXJbX3Rva2VuSWRdID0gX3RvOwogICAgICAgIC8vIFdoZW4gY3JlYXRpbmcgbmV3IHB1cHB5cyBfZnJvbSBpcyAweDAsIGJ1dCB3ZSBjYW4ndCBhY2NvdW50IHRoYXQgYWRkcmVzcy4KICAgICAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W19mcm9tXS0tOwogICAgICAgICAgICAvLyBvbmNlIHRoZSBwdXBweSBpcyB0cmFuc2ZlcnJlZCBhbHNvIGNsZWFyIHNpcmUgYWxsb3dhbmNlcwogICAgICAgICAgICBkZWxldGUgc2lyZUFsbG93ZWRUb0FkZHJlc3NbX3Rva2VuSWRdOwogICAgICAgICAgICAvLyBjbGVhciBhbnkgcHJldmlvdXNseSBhcHByb3ZlZCBvd25lcnNoaXAgZXhjaGFuZ2UKICAgICAgICAgICAgZGVsZXRlIFB1cHB5SW5kZXhUb0FwcHJvdmVkW190b2tlbklkXTsKICAgICAgICB9CiAgICAgICAgLy8gRW1pdCB0aGUgdHJhbnNmZXIgZXZlbnQuCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFuIGludGVybmFsIG1ldGhvZCB0aGF0IGNyZWF0ZXMgYSBuZXcgUHVwcHkgYW5kIHN0b3JlcyBpdC4gVGhpcwogICAgLy8vICBtZXRob2QgZG9lc24ndCBkbyBhbnkgY2hlY2tpbmcgYW5kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIHRoZQogICAgLy8vICBpbnB1dCBkYXRhIGlzIGtub3duIHRvIGJlIHZhbGlkLiBXaWxsIGdlbmVyYXRlIGJvdGggYSBCaXJ0aCBldmVudAogICAgLy8vICBhbmQgYSBUcmFuc2ZlciBldmVudC4KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIFRoZSBQdXBweSBJRCBvZiB0aGUgbWF0cm9uIG9mIHRoaXMgcHVwcHkgKHplcm8gZm9yIGdlbjApCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgVGhlIFB1cHB5IElEIG9mIHRoZSBzaXJlIG9mIHRoaXMgcHVwcHkgKHplcm8gZm9yIGdlbjApCiAgICAvLy8gQHBhcmFtIF9nZW5lcmF0aW9uIFRoZSBnZW5lcmF0aW9uIG51bWJlciBvZiB0aGlzIHB1cHB5LCBtdXN0IGJlIGNvbXB1dGVkIGJ5IGNhbGxlci4KICAgIC8vLyBAcGFyYW0gX2dlbmVzIFRoZSBQdXBweSdzIGdlbmV0aWMgY29kZS4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBpbml0YWwgb3duZXIgb2YgdGhpcyBwdXBweSwgbXVzdCBiZSBub24temVybyAoZXhjZXB0IGZvciB0aGUgdW5QdXBweSwgSUQgMCkKICAgIGZ1bmN0aW9uIF9jcmVhdGVQdXBweSgKICAgICAgICB1aW50MjU2IF9tYXRyb25JZCwKICAgICAgICB1aW50MjU2IF9zaXJlSWQsCiAgICAgICAgdWludDI1NiBfZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9nZW5lcywKICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICB1aW50MTYgX3N0cmVuZ3RoLAogICAgICAgIHVpbnQxNiBfYWdpbGl0eSwKICAgICAgICB1aW50MTYgX2ludGVsbGlnZW5jZSwKICAgICAgICB1aW50MTYgX3NwZWVkCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIC8vIFRoZXNlIHJlcXVpcmVzIGFyZSBub3Qgc3RyaWN0bHkgbmVjZXNzYXJ5LCBvdXIgY2FsbGluZyBjb2RlIHNob3VsZCBtYWtlCiAgICAgICAgLy8gc3VyZSB0aGF0IHRoZXNlIGNvbmRpdGlvbnMgYXJlIG5ldmVyIGJyb2tlbi4gSG93ZXZlciEgX2NyZWF0ZVB1cHB5KCkgaXMgYWxyZWFkeQogICAgICAgIC8vIGFuIGV4cGVuc2l2ZSBjYWxsIChmb3Igc3RvcmFnZSksIGFuZCBpdCBkb2Vzbid0IGh1cnQgdG8gYmUgZXNwZWNpYWxseSBjYXJlZnVsCiAgICAgICAgLy8gdG8gZW5zdXJlIG91ciBkYXRhIHN0cnVjdHVyZXMgYXJlIGFsd2F5cyB2YWxpZC4KICAgICAgICByZXF1aXJlKF9tYXRyb25JZCA9PSB1aW50MjU2KHVpbnQzMihfbWF0cm9uSWQpKSk7CiAgICAgICAgcmVxdWlyZShfc2lyZUlkID09IHVpbnQyNTYodWludDMyKF9zaXJlSWQpKSk7CiAgICAgICAgcmVxdWlyZShfZ2VuZXJhdGlvbiA9PSB1aW50MjU2KHVpbnQxNihfZ2VuZXJhdGlvbikpKTsKCiAgICAgICAgLy8gTmV3IFB1cHB5IHN0YXJ0cyB3aXRoIHRoZSBzYW1lIGNvb2xkb3duIGFzIHBhcmVudCBnZW4vMgogICAgICAgIHVpbnQxNiBjb29sZG93bkluZGV4ID0gdWludDE2KF9nZW5lcmF0aW9uIC8gMik7CiAgICAgICAgaWYgKGNvb2xkb3duSW5kZXggPiAxMykgewogICAgICAgICAgICBjb29sZG93bkluZGV4ID0gMTM7CiAgICAgICAgfQoKICAgICAgICBQdXBweSBtZW1vcnkgX3B1cHB5ID0gUHVwcHkoewogICAgICAgICAgICBnZW5lczogX2dlbmVzLAogICAgICAgICAgICBiaXJ0aFRpbWU6IHVpbnQ2NChub3cpLAogICAgICAgICAgICBjb29sZG93bkVuZEJsb2NrOiAwLAogICAgICAgICAgICBtYXRyb25JZDogdWludDMyKF9tYXRyb25JZCksCiAgICAgICAgICAgIHNpcmVJZDogdWludDMyKF9zaXJlSWQpLAogICAgICAgICAgICBzaXJpbmdXaXRoSWQ6IDAsCiAgICAgICAgICAgIGNvb2xkb3duSW5kZXg6IGNvb2xkb3duSW5kZXgsCiAgICAgICAgICAgIGdlbmVyYXRpb246IHVpbnQxNihfZ2VuZXJhdGlvbiksCiAgICAgICAgICAgIGNoaWxkTnVtYmVyOiAwLAogICAgICAgICAgICBzdHJlbmd0aDogX3N0cmVuZ3RoLAogICAgICAgICAgICBhZ2lsaXR5OiBfYWdpbGl0eSwKICAgICAgICAgICAgaW50ZWxsaWdlbmNlOiBfaW50ZWxsaWdlbmNlLAogICAgICAgICAgICBzcGVlZDogX3NwZWVkCiAgICAgICAgfSk7CgogICAgICAgIHVpbnQyNTYgbmV3cHVwcHlJZCA9IHB1cHBpZXMucHVzaChfcHVwcHkpIC0gMTsKCiAgICAgICAgLy8gSXQncyBwcm9iYWJseSBuZXZlciBnb2luZyB0byBoYXBwZW4sIDQgYmlsbGlvbiBwdXBweXMgaXMgQSBMT1QsIGJ1dAogICAgICAgIC8vIGxldCdzIGp1c3QgYmUgMTAwJSBzdXJlIHdlIG5ldmVyIGxldCB0aGlzIGhhcHBlbi4KICAgICAgICByZXF1aXJlKG5ld3B1cHB5SWQgPT0gdWludDI1Nih1aW50MzIobmV3cHVwcHlJZCkpKTsKCiAgICAgICAgLy8gZW1pdCB0aGUgYmlydGggZXZlbnQKICAgICAgICBCaXJ0aCgKICAgICAgICAgICAgX293bmVyLAogICAgICAgICAgICBuZXdwdXBweUlkLAogICAgICAgICAgICB1aW50MjU2KF9wdXBweS5tYXRyb25JZCksCiAgICAgICAgICAgIHVpbnQyNTYoX3B1cHB5LnNpcmVJZCksCiAgICAgICAgICAgIF9wdXBweS5nZW5lcwogICAgICAgICk7CgogICAgICAgIC8vIFRoaXMgd2lsbCBhc3NpZ24gb3duZXJzaGlwLCBhbmQgYWxzbyBlbWl0IHRoZSBUcmFuc2ZlciBldmVudCBhcwogICAgICAgIC8vIHBlciBFUkM3MjEgZHJhZnQKICAgICAgICBfdHJhbnNmZXIoMCwgX293bmVyLCBuZXdwdXBweUlkKTsKCiAgICAgICAgcmV0dXJuIG5ld3B1cHB5SWQ7CiAgICB9CgogICAgLy8gQW55IEMtbGV2ZWwgY2FuIGZpeCBob3cgbWFueSBzZWNvbmRzIHBlciBibG9ja3MgYXJlIGN1cnJlbnRseSBvYnNlcnZlZC4KICAgIGZ1bmN0aW9uIHNldFNlY29uZHNQZXJCbG9jayh1aW50MjU2IHNlY3MpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIHJlcXVpcmUoc2VjcyA8IGNvb2xkb3duc1swXSk7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gc2VjczsKICAgIH0KfQoKCgoKCi8vLyBAdGl0bGUgVGhlIGV4dGVybmFsIGNvbnRyYWN0IHRoYXQgaXMgcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgbWV0YWRhdGEgZm9yIHRoZSBwdXBwaWVzLAovLy8gIGl0IGhhcyBvbmUgZnVuY3Rpb24gdGhhdCB3aWxsIHJldHVybiB0aGUgZGF0YSBhcyBieXRlcy4KY29udHJhY3QgRVJDNzIxTWV0YWRhdGEgewogICAgLy8vIEBkZXYgR2l2ZW4gYSB0b2tlbiBJZCwgcmV0dXJucyBhIGJ5dGUgYXJyYXkgdGhhdCBpcyBzdXBwb3NlZCB0byBiZSBjb252ZXJ0ZWQgaW50byBzdHJpbmcuCiAgICBmdW5jdGlvbiBnZXRNZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzJbNF0gYnVmZmVyLCB1aW50MjU2IGNvdW50KSB7CiAgICAgICAgaWYgKF90b2tlbklkID09IDEpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkhlbGxvIFdvcmxkISA6RCI7CiAgICAgICAgICAgIGNvdW50ID0gMTU7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAyKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJJIHdvdWxkIGRlZmluaXRlbHkgY2hvb3NlIGEgbWVkaSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJ1bSBsZW5ndGggc3RyaW5nLiI7CiAgICAgICAgICAgIGNvdW50ID0gNDk7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAzKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgbWkgZSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJzdCBhY2N1bXNhbiBkYXBpYnVzIGF1Z3VlIGxvcmVtLCI7CiAgICAgICAgICAgIGJ1ZmZlclsyXSA9ICIgdHJpc3RpcXVlIHZlc3RpYnVsdW0gaWQsIGxpYmVybyI7CiAgICAgICAgICAgIGJ1ZmZlclszXSA9ICIgc3VzY2lwaXQgdmFyaXVzIHNhcGllbiBhbGlxdWFtLiI7CiAgICAgICAgICAgIGNvdW50ID0gMTI4OwogICAgICAgIH0KICAgIH0KfQoKCi8vLyBAdGl0bGUgVGhlIGZhY2V0IG9mIHRoZSBDcnlwdG9QdXBwaWVzIGNvcmUgY29udHJhY3QgdGhhdCBtYW5hZ2VzIG93bmVyc2hpcCwgRVJDLTcyMSAoZHJhZnQpIGNvbXBsaWFudC4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCi8vLyAgU2VlIHRoZSBQdXBwaWVzQ29yZSBjb250cmFjdCBkb2N1bWVudGF0aW9uIHRvIHVuZGVyc3RhbmQgaG93IHRoZSB2YXJpb3VzIGNvbnRyYWN0IGZhY2V0cyBhcmUgYXJyYW5nZWQuCmNvbnRyYWN0IFB1cHB5T3duZXJzaGlwIGlzIFB1cHB5QmFzZSwgRVJDNzIxIHsKCiAgICAvLy8gQG5vdGljZSBOYW1lIGFuZCBzeW1ib2wgb2YgdGhlIG5vbiBmdW5naWJsZSB0b2tlbiwgYXMgZGVmaW5lZCBpbiBFUkM3MjEuCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQ3J5cHRvUHVwcGllcyI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJDUCI7CgogICAgLy8gVGhlIGNvbnRyYWN0IHRoYXQgd2lsbCByZXR1cm4gUHVwcHkgbWV0YWRhdGEKICAgIEVSQzcyMU1ldGFkYXRhIHB1YmxpYyBlcmM3MjFNZXRhZGF0YTsKCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nigic3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KSIpKTsKCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigibmFtZSgpIikpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJzeW1ib2woKSIpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigidG90YWxTdXBwbHkoKSIpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigiYmFsYW5jZU9mKGFkZHJlc3MpIikpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJvd25lck9mKHVpbnQyNTYpIikpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCJhcHByb3ZlKGFkZHJlc3MsdWludDI1NikiKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoInRyYW5zZmVyKGFkZHJlc3MsdWludDI1NikiKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoInRyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NikiKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoInRva2Vuc09mT3duZXIoYWRkcmVzcykiKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoInRva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpIikpOwoKICAgIC8vLyBAbm90aWNlIEludHJvc3BlY3Rpb24gaW50ZXJmYWNlIGFzIHBlciBFUkMtMTY1IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KS4KICAgIC8vLyAgUmV0dXJucyB0cnVlIGZvciBhbnkgc3RhbmRhcmRpemVkIGludGVyZmFjZXMgaW1wbGVtZW50ZWQgYnkgdGhpcyBjb250cmFjdC4gV2UgaW1wbGVtZW50CiAgICAvLy8gIEVSQy0xNjUgKG9idmlvdXNseSEpIGFuZCBFUkMtNzIxLgogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gREVCVUcgT05MWQogICAgICAgIC8vcmVxdWlyZSgoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9PSAweDAxZmZjOWE3KSAmJiAoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9PSAweDlhMjA0ODNkKSk7CgogICAgICAgIHJldHVybiAoKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1KSB8fCAoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgIH0KCiAgICAvLy8gQGRldiBTZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIHNpYmxpbmcgY29udHJhY3QgdGhhdCB0cmFja3MgbWV0YWRhdGEuCiAgICAvLy8gIENFTyBvbmx5LgogICAgZnVuY3Rpb24gc2V0TWV0YWRhdGFBZGRyZXNzKGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcykgcHVibGljIG9ubHlDRU8gewogICAgICAgIGVyYzcyMU1ldGFkYXRhID0gRVJDNzIxTWV0YWRhdGEoX2NvbnRyYWN0QWRkcmVzcyk7CiAgICB9CgogICAgLy8gSW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbnM6IFRoZXNlIGZ1bmN0aW9ucyBhbGwgYXNzdW1lIHRoYXQgdGhlaXIgaW5wdXQgYXJndW1lbnRzCiAgICAvLyBhcmUgdmFsaWQuIFdlIGxlYXZlIGl0IHRvIHB1YmxpYyBtZXRob2RzIHRvIHNhbml0aXplIHRoZWlyIGlucHV0cyBhbmQgZm9sbG93CiAgICAvLyB0aGUgcmVxdWlyZWQgbG9naWMuCgogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBpcyB0aGUgY3VycmVudCBvd25lciBvZiBhIHBhcnRpY3VsYXIgUHVwcHkuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgdmFsaWRhdGluZyBhZ2FpbnN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBwdXBweSBpZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBQdXBweUluZGV4VG9Pd25lcltfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgY3VycmVudGx5IGhhcyB0cmFuc2ZlckFwcHJvdmFsIGZvciBhIHBhcnRpY3VsYXIgUHVwcHkuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgY29uZmlybWluZyBwdXBweSBpcyBhcHByb3ZlZCBmb3IuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIHB1cHB5IGlkLCBvbmx5IHZhbGlkIHdoZW4gPiAwCiAgICBmdW5jdGlvbiBfYXBwcm92ZWRGb3IoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBQdXBweUluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IE1hcmtzIGFuIGFkZHJlc3MgYXMgYmVpbmcgYXBwcm92ZWQgZm9yIHRyYW5zZmVyRnJvbSgpLCBvdmVyd3JpdGluZyBhbnkgcHJldmlvdXMKICAgIC8vLyAgYXBwcm92YWwuIFNldHRpbmcgX2FwcHJvdmVkIHRvIGFkZHJlc3MoMCkgY2xlYXJzIGFsbCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgIC8vLyAgTk9URTogX2FwcHJvdmUoKSBkb2VzIE5PVCBzZW5kIHRoZSBBcHByb3ZhbCBldmVudC4gVGhpcyBpcyBpbnRlbnRpb25hbCBiZWNhdXNlCiAgICAvLy8gIF9hcHByb3ZlKCkgYW5kIHRyYW5zZmVyRnJvbSgpIGFyZSB1c2VkIHRvZ2V0aGVyIGZvciBwdXR0aW5nIHB1cHBpZXMgb24gYXVjdGlvbiwgYW5kCiAgICAvLy8gIHRoZXJlIGlzIG5vIHZhbHVlIGluIHNwYW1taW5nIHRoZSBsb2cgd2l0aCBBcHByb3ZhbCBldmVudHMgaW4gdGhhdCBjYXNlLgogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfYXBwcm92ZWQpIGludGVybmFsIHsKICAgICAgICBQdXBweUluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPSBfYXBwcm92ZWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHB1cHBpZXMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgY291bnQpIHsKICAgICAgICByZXR1cm4gb3duZXJzaGlwVG9rZW5Db3VudFtfb3duZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVycyBhIFB1cHB5IHRvIGFub3RoZXIgYWRkcmVzcy4gSWYgdHJhbnNmZXJyaW5nIHRvIGEgc21hcnQKICAgIC8vLyAgY29udHJhY3QgYmUgVkVSWSBDQVJFRlVMIHRvIGVuc3VyZSB0aGF0IGl0IGlzIGF3YXJlIG9mIEVSQy03MjEgKG9yCiAgICAvLy8gIENyeXB0b1B1cHBpZXMgc3BlY2lmaWNhbGx5KSBvciB5b3VyIFB1cHB5IG1heSBiZSBsb3N0IGZvcmV2ZXIuIFNlcmlvdXNseS4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgUHVwcHkgdG8gdHJhbnNmZXIuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBwdXBwaWVzIChleGNlcHQgdmVyeSBicmllZmx5CiAgICAgICAgLy8gYWZ0ZXIgYSBnZW4wIHB1cHB5IGlzIGNyZWF0ZWQgYW5kIGJlZm9yZSBpdCBnb2VzIG9uIGF1Y3Rpb24pLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGUgYXVjdGlvbiBjb250cmFjdHMgdG8gcHJldmVudCBhY2NpZGVudGFsCiAgICAgICAgLy8gbWlzdXNlLiBBdWN0aW9uIGNvbnRyYWN0cyBzaG91bGQgb25seSB0YWtlIG93bmVyc2hpcCBvZiBwdXBwaWVzCiAgICAgICAgLy8gdGhyb3VnaCB0aGUgYWxsb3cgKyB0cmFuc2ZlckZyb20gZmxvdy4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHNhbGVBdWN0aW9uKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhzaXJpbmdBdWN0aW9uKSk7CgogICAgICAgIC8vIFlvdSBjYW4gb25seSBzZW5kIHlvdXIgb3duIHB1cHB5LgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwLCBjbGVhciBwZW5kaW5nIGFwcHJvdmFscywgZW1pdCBUcmFuc2ZlciBldmVudC4KICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR3JhbnQgYW5vdGhlciBhZGRyZXNzIHRoZSByaWdodCB0byB0cmFuc2ZlciBhIHNwZWNpZmljIFB1cHB5IHZpYQogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gVGhpcyBpcyB0aGUgcHJlZmVycmVkIGZsb3cgZm9yIHRyYW5zZmVyaW5nIE5GVHMgdG8gY29udHJhY3RzLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYmUgZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbC4gUGFzcyBhZGRyZXNzKDApIHRvCiAgICAvLy8gIGNsZWFyIGFsbCBhcHByb3ZhbHMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgUHVwcHkgdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIE9ubHkgYW4gb3duZXIgY2FuIGdyYW50IHRyYW5zZmVyIGFwcHJvdmFsLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIGFwcHJvdmFsIChyZXBsYWNpbmcgYW55IHByZXZpb3VzIGFwcHJvdmFsKS4KICAgICAgICBfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCiAgICAgICAgLy8gRW1pdCBhcHByb3ZhbCBldmVudC4KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIFB1cHB5IG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nIGFkZHJlc3MKICAgIC8vLyAgaGFzIHByZXZpb3VzbHkgYmVlbiBncmFudGVkIHRyYW5zZmVyIGFwcHJvdmFsIGJ5IHRoZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSBQdXBweSB0byBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCBzaG91bGQgdGFrZSBvd25lcnNoaXAgb2YgdGhlIFB1cHB5LiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAvLy8gIGluY2x1ZGluZyB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIFB1cHB5IHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgcHVwcGllcyAoZXhjZXB0IHZlcnkgYnJpZWZseQogICAgICAgIC8vIGFmdGVyIGEgZ2VuMCBwdXBweSBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBDaGVjayBmb3IgYXBwcm92YWwgYW5kIHZhbGlkIG93bmVyc2hpcAogICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIHB1cHBpZXMgY3VycmVudGx5IGluIGV4aXN0ZW5jZS4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcHVwcGllcy5sZW5ndGggLSAxOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGFkZHJlc3MgY3VycmVudGx5IGFzc2lnbmVkIG93bmVyc2hpcCBvZiBhIGdpdmVuIFB1cHB5LgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzIG93bmVyKQogICAgewogICAgICAgIG93bmVyID0gUHVwcHlJbmRleFRvT3duZXJbX3Rva2VuSWRdOwoKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBsaXN0IG9mIGFsbCBQdXBweSBJRHMgYXNzaWduZWQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciB3aG9zZSBwdXBwaWVzIHdlIGFyZSBpbnRlcmVzdGVkIGluLgogICAgLy8vIEBkZXYgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZS4gRmlyc3QsIGl0J3MgZmFpcmx5CiAgICAvLy8gIGV4cGVuc2l2ZSAoaXQgd2Fsa3MgdGhlIGVudGlyZSBQdXBweSBhcnJheSBsb29raW5nIGZvciBwdXBweXMgYmVsb25naW5nIHRvIG93bmVyKSwKICAgIC8vLyAgYnV0IGl0IGFsc28gcmV0dXJucyBhIGR5bmFtaWMgYXJyYXksIHdoaWNoIGlzIG9ubHkgc3VwcG9ydGVkIGZvciB3ZWIzIGNhbGxzLCBhbmQKICAgIC8vLyAgbm90IGNvbnRyYWN0LXRvLWNvbnRyYWN0IGNhbGxzLgogICAgZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBvd25lclRva2VucykgewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwoKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10odG9rZW5Db3VudCk7CiAgICAgICAgICAgIHVpbnQyNTYgdG90YWxwdXBweXMgPSB0b3RhbFN1cHBseSgpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgICAgICAgIC8vIFdlIGNvdW50IG9uIHRoZSBmYWN0IHRoYXQgYWxsIHB1cHB5cyBoYXZlIElEcyBzdGFydGluZyBhdCAxIGFuZCBpbmNyZWFzaW5nCiAgICAgICAgICAgIC8vIHNlcXVlbnRpYWxseSB1cCB0byB0aGUgdG90YWxwdXBweSBjb3VudC4KICAgICAgICAgICAgdWludDI1NiBwdXBweUlkOwoKICAgICAgICAgICAgZm9yIChwdXBweUlkID0gMTsgcHVwcHlJZCA8PSB0b3RhbHB1cHB5czsgcHVwcHlJZCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoUHVwcHlJbmRleFRvT3duZXJbcHVwcHlJZF0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IHB1cHB5SWQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRhcHRlZCBmcm9tIG1lbWNweSgpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjUyMzMyMDMzMzEzYTNjM2IzNjEyM2MzZDI2MzYzZDI2N2MzYzM3MjYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF9tZW1jcHkodWludCBfZGVzdCwgdWludCBfc3JjLCB1aW50IF9sZW4pIHByaXZhdGUgdmlldyB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IoOyBfbGVuID49IDMyOyBfbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgbWxvYWQoX3NyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Rlc3QgKz0gMzI7CiAgICAgICAgICAgIF9zcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQyNTYgbWFzayA9IDI1NiAqKiAoMzIgLSBfbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoX3NyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChfZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBZGFwdGVkIGZyb20gdG9TdHJpbmcoc2xpY2UpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjZjMGQxZTBkMGYwNDAyMDUwODJjMDIwMzE4MDgwMzE4NDIwMjA5MTgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF90b1N0cmluZyhieXRlczMyWzRdIF9yYXdCeXRlcywgdWludDI1NiBfc3RyaW5nTGVuZ3RoKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIG91dHB1dFN0cmluZyA9IG5ldyBzdHJpbmcoX3N0cmluZ0xlbmd0aCk7CiAgICAgICAgdWludDI1NiBvdXRwdXRQdHI7CiAgICAgICAgdWludDI1NiBieXRlc1B0cjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBvdXRwdXRQdHIgOj0gYWRkKG91dHB1dFN0cmluZywgMzIpCiAgICAgICAgICAgIGJ5dGVzUHRyIDo9IF9yYXdCeXRlcwogICAgICAgIH0KCiAgICAgICAgX21lbWNweShvdXRwdXRQdHIsIGJ5dGVzUHRyLCBfc3RyaW5nTGVuZ3RoKTsKCiAgICAgICAgcmV0dXJuIG91dHB1dFN0cmluZzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGEgVVJJIHBvaW50aW5nIHRvIGEgbWV0YWRhdGEgcGFja2FnZSBmb3IgdGhpcyB0b2tlbiBjb25mb3JtaW5nIHRvCiAgICAvLy8gIEVSQy03MjEgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEpCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBudW1iZXIgb2YgdGhlIFB1cHB5IHdob3NlIG1ldGFkYXRhIHNob3VsZCBiZSByZXR1cm5lZC4KICAgIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nIF9wcmVmZXJyZWRUcmFuc3BvcnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpIHsKICAgICAgICByZXF1aXJlKGVyYzcyMU1ldGFkYXRhICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGJ5dGVzMzJbNF0gbWVtb3J5IGJ1ZmZlcjsKICAgICAgICB1aW50MjU2IGNvdW50OwogICAgICAgIChidWZmZXIsIGNvdW50KSA9IGVyYzcyMU1ldGFkYXRhLmdldE1ldGFkYXRhKF90b2tlbklkLCBfcHJlZmVycmVkVHJhbnNwb3J0KTsKCiAgICAgICAgcmV0dXJuIF90b1N0cmluZyhidWZmZXIsIGNvdW50KTsKICAgIH0KfQoKLy8vIEB0aXRsZSBBIGZhY2V0IG9mIFB1cHBpZXNDb3JlIHRoYXQgbWFuYWdlcyBQdXBweSBzaXJpbmcsIGdlc3RhdGlvbiwgYW5kIGJpcnRoLgovLy8gQGF1dGhvciBBeGlvbSBaZW4gKGh0dHBzOi8vd3d3LmF4aW9temVuLmNvKQovLy8gQGRldiBTZWUgdGhlIFB1cHBpZXNDb3JlIGNvbnRyYWN0IGRvY3VtZW50YXRpb24gdG8gdW5kZXJzdGFuZCBob3cgdGhlIHZhcmlvdXMgY29udHJhY3QgZmFjZXRzIGFyZSBhcnJhbmdlZC4KY29udHJhY3QgUHVwcHlCcmVlZGluZyBpcyBQdXBweU93bmVyc2hpcCB7CgogICAgLy8vIEBkZXYgVGhlIFByZWduYW50IGV2ZW50IGlzIGZpcmVkIHdoZW4gdHdvIHB1cHB5cyBzdWNjZXNzZnVsbHkgYnJlZWQgYW5kIHRoZSBwcmVnbmFuY3kKICAgIC8vLyAgdGltZXIgYmVnaW5zIGZvciB0aGUgbWF0cm9uLgogICAgZXZlbnQgUHJlZ25hbnQoYWRkcmVzcyBvd25lciwgdWludDI1NiBtYXRyb25JZCwgdWludDI1NiBzaXJlSWQsIHVpbnQyNTYgY29vbGRvd25FbmRCbG9jayk7CgogICAgLy8vIEBub3RpY2UgVGhlIG1pbmltdW0gcGF5bWVudCByZXF1aXJlZCB0byB1c2UgYnJlZWRXaXRoQXV0bygpLiBUaGlzIGZlZSBnb2VzIHRvd2FyZHMKICAgIC8vLyAgdGhlIGdhcyBjb3N0IHBhaWQgYnkgd2hhdGV2ZXIgY2FsbHMgZ2l2ZUJpcnRoKCksIGFuZCBjYW4gYmUgZHluYW1pY2FsbHkgdXBkYXRlZCBieQogICAgLy8vICB0aGUgQ09PIHJvbGUgYXMgdGhlIGdhcyBwcmljZSBjaGFuZ2VzLgogICAgdWludDI1NiBwdWJsaWMgYXV0b0JpcnRoRmVlID0gOCBmaW5uZXk7CgogICAgLy8gS2VlcHMgdHJhY2sgb2YgbnVtYmVyIG9mIHByZWduYW50IHB1cHBpZXMuCiAgICB1aW50MjU2IHB1YmxpYyBwcmVnbmFudHB1cHBpZXM7CgogICAgdWludDI1NiBwdWJsaWMgbWluQ2hpbGRDb3VudCA9IDI7CgogICAgdWludDI1NiBwdWJsaWMgbWF4Q2hpbGRDb3VudCA9IDE0OwoKICAgIHVpbnQgcmFuZE5vbmNlID0gMDsKCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiB0aGUgc2libGluZyBjb250cmFjdCB0aGF0IGlzIHVzZWQgdG8gaW1wbGVtZW50IHRoZSBzb29wZXItc2VrcmV0CiAgICAvLy8gIGdlbmV0aWMgY29tYmluYXRpb24gYWxnb3JpdGhtLgoKICAgIEdlbmVTY2llbmNlIHB1YmxpYyBnZW5lU2NpZW5jZTsKCiAgICBQdXBweVNwb3J0cyBwdWJsaWMgcHVwcHlTcG9ydHM7CgogICAgZnVuY3Rpb24gc2V0TWluQ2hpbGRDb3VudCh1aW50MjU2IF9taW5DaGlsZENvdW50KSBvbmx5Q09PIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHJlcXVpcmUoX21pbkNoaWxkQ291bnQgPj0gMik7CiAgICAgICAgbWluQ2hpbGRDb3VudCA9IF9taW5DaGlsZENvdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE1heENoaWxkQ291bnQodWludDI1NiBfbWF4Q2hpbGRDb3VudCkgb25seUNPTyB3aGVuTm90UGF1c2VkIHsKICAgICAgICByZXF1aXJlKF9tYXhDaGlsZENvdW50ID4gbWluQ2hpbGRDb3VudCk7CiAgICAgICAgbWF4Q2hpbGRDb3VudCA9IF9tYXhDaGlsZENvdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEdlbmVTY2llbmNlQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICBHZW5lU2NpZW5jZSBjYW5kaWRhdGVDb250cmFjdCA9IEdlbmVTY2llbmNlKF9hZGRyZXNzKTsKCiAgICAgICAgLy8gTk9URTogdmVyaWZ5IHRoYXQgYSBjb250cmFjdCBpcyB3aGF0IHdlIGV4cGVjdCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9MdW55ci9jcm93ZHNhbGUtY29udHJhY3RzL2Jsb2IvY2ZhZGQxNTk4NmMzMDUyMWQ4YmE3ZDViNmY1N2I0ZmVmY2M3YWMzOC9jb250cmFjdHMvTHVueXJUb2tlbi5zb2wjTDExNwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNHZW5lU2NpZW5jZSgpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIGdlbmVTY2llbmNlID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UHVwcHlTcG9ydHMoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgUHVwcHlTcG9ydHMgY2FuZGlkYXRlQ29udHJhY3QgPSBQdXBweVNwb3J0cyhfYWRkcmVzcyk7CgogICAgICAgIC8vIE5PVEU6IHZlcmlmeSB0aGF0IGEgY29udHJhY3QgaXMgd2hhdCB3ZSBleHBlY3QgLSBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iL2NmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzUHVwcHlTcG9ydHMoKSk7CgogICAgICAgIC8vIFNldCB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBwdXBweVNwb3J0cyA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyB0aGF0IGEgZ2l2ZW4gcHVwcHkgaXMgYWJsZSB0byBicmVlZC4gUmVxdWlyZXMgdGhhdCB0aGUKICAgIC8vLyAgY3VycmVudCBjb29sZG93biBpcyBmaW5pc2hlZCAoZm9yIHNpcmVzKSBhbmQgYWxzbyBjaGVja3MgdGhhdCB0aGVyZSBpcwogICAgLy8vICBubyBwZW5kaW5nIHByZWduYW5jeS4KICAgIGZ1bmN0aW9uIF9pc1JlYWR5VG9CcmVlZChQdXBweSBfcHVwKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBJbiBhZGRpdGlvbiB0byBjaGVja2luZyB0aGUgY29vbGRvd25FbmRCbG9jaywgd2UgYWxzbyBuZWVkIHRvIGNoZWNrIHRvIHNlZSBpZgogICAgICAgIC8vIHRoZSBwdXBweSBoYXMgYSBwZW5kaW5nIGJpcnRoOyB0aGVyZSBjYW4gYmUgc29tZSBwZXJpb2Qgb2YgdGltZSBiZXR3ZWVuIHRoZSBlbmQKICAgICAgICAvLyBvZiB0aGUgcHJlZ25hY3kgdGltZXIgYW5kIHRoZSBiaXJ0aCBldmVudC4KICAgICAgICB1aW50MjU2IG51bWJlck9mQWxsb3dlZENoaWxkID0gbWF4Q2hpbGRDb3VudCAtIF9wdXAuZ2VuZXJhdGlvbiAqIDI7CiAgICAgICAgaWYgKG51bWJlck9mQWxsb3dlZENoaWxkIDwgbWluQ2hpbGRDb3VudCkgewogICAgICAgICAgICBudW1iZXJPZkFsbG93ZWRDaGlsZCA9IG1pbkNoaWxkQ291bnQ7CiAgICAgICAgfQoKICAgICAgICBib29sIGlzQ2hpbGRMaW1pdE5vdFJlYWNoZWQgPSBfcHVwLmNoaWxkTnVtYmVyIDwgbnVtYmVyT2ZBbGxvd2VkQ2hpbGQ7CgogICAgICAgIHJldHVybiAoX3B1cC5zaXJpbmdXaXRoSWQgPT0gMCkgJiYgKF9wdXAuY29vbGRvd25FbmRCbG9jayA8PSB1aW50NjQoYmxvY2subnVtYmVyKSkgJiYgaXNDaGlsZExpbWl0Tm90UmVhY2hlZDsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVjayBpZiBhIHNpcmUgaGFzIGF1dGhvcml6ZWQgYnJlZWRpbmcgd2l0aCB0aGlzIG1hdHJvbi4gVHJ1ZSBpZiBib3RoIHNpcmUKICAgIC8vLyAgYW5kIG1hdHJvbiBoYXZlIHRoZSBzYW1lIG93bmVyLCBvciBpZiB0aGUgc2lyZSBoYXMgZ2l2ZW4gc2lyaW5nIHBlcm1pc3Npb24gdG8KICAgIC8vLyAgdGhlIG1hdHJvbidzIG93bmVyICh2aWEgYXBwcm92ZVNpcmluZygpKS4KICAgIGZ1bmN0aW9uIF9pc1NpcmluZ1Blcm1pdHRlZCh1aW50MjU2IF9zaXJlSWQsIHVpbnQyNTYgX21hdHJvbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhZGRyZXNzIG1hdHJvbk93bmVyID0gUHVwcHlJbmRleFRvT3duZXJbX21hdHJvbklkXTsKICAgICAgICBhZGRyZXNzIHNpcmVPd25lciA9IFB1cHB5SW5kZXhUb093bmVyW19zaXJlSWRdOwoKICAgICAgICAvLyBTaXJpbmcgaXMgb2theSBpZiB0aGV5IGhhdmUgc2FtZSBvd25lciwgb3IgaWYgdGhlIG1hdHJvbidzIG93bmVyIHdhcyBnaXZlbgogICAgICAgIC8vIHBlcm1pc3Npb24gdG8gYnJlZWQgd2l0aCB0aGlzIHNpcmUuCiAgICAgICAgcmV0dXJuIChtYXRyb25Pd25lciA9PSBzaXJlT3duZXIgfHwgc2lyZUFsbG93ZWRUb0FkZHJlc3NbX3NpcmVJZF0gPT0gbWF0cm9uT3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IFNldCB0aGUgY29vbGRvd25FbmRUaW1lIGZvciB0aGUgZ2l2ZW4gUHVwcHksIGJhc2VkIG9uIGl0cyBjdXJyZW50IGNvb2xkb3duSW5kZXguCiAgICAvLy8gIEFsc28gaW5jcmVtZW50cyB0aGUgY29vbGRvd25JbmRleCAodW5sZXNzIGl0IGhhcyBoaXQgdGhlIGNhcCkuCiAgICAvLy8gQHBhcmFtIF9wdXBweSBBIHJlZmVyZW5jZSB0byB0aGUgUHVwcHkgaW4gc3RvcmFnZSB3aGljaCBuZWVkcyBpdHMgdGltZXIgc3RhcnRlZC4KICAgIGZ1bmN0aW9uIF90cmlnZ2VyQ29vbGRvd24oUHVwcHkgc3RvcmFnZSBfcHVwcHkpIGludGVybmFsIHsKICAgICAgICAvLyBDb21wdXRlIGFuIGVzdGltYXRpb24gb2YgdGhlIGNvb2xkb3duIHRpbWUgaW4gYmxvY2tzIChiYXNlZCBvbiBjdXJyZW50IGNvb2xkb3duSW5kZXgpLgogICAgICAgIF9wdXBweS5jb29sZG93bkVuZEJsb2NrID0gdWludDY0KChjb29sZG93bnNbX3B1cHB5LmNvb2xkb3duSW5kZXhdL3NlY29uZHNQZXJCbG9jaykgKyBibG9jay5udW1iZXIpOwoKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGJyZWVkaW5nIGNvdW50LCBjbGFtcGluZyBpdCBhdCAxMywgd2hpY2ggaXMgdGhlIGxlbmd0aCBvZiB0aGUKICAgICAgICAvLyBjb29sZG93bnMgYXJyYXkuIFdlIGNvdWxkIGNoZWNrIHRoZSBhcnJheSBzaXplIGR5bmFtaWNhbGx5LCBidXQgaGFyZC1jb2RpbmcKICAgICAgICAvLyB0aGlzIGFzIGEgY29uc3RhbnQgc2F2ZXMgZ2FzLiBZYXksIFNvbGlkaXR5IQogICAgICAgIGlmIChfcHVwcHkuY29vbGRvd25JbmRleCA8IDEzKSB7CiAgICAgICAgICAgIF9wdXBweS5jb29sZG93bkluZGV4ICs9IDE7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFNldCB0aGUgY29vbGRvd25FbmRUaW1lIGZvciB0aGUgZ2l2ZW4gUHVwcHksIGJhc2VkIG9uIGl0cyBjdXJyZW50IGNvb2xkb3duSW5kZXguCiAgICAvLy8gIEFsc28gaW5jcmVtZW50cyB0aGUgY29vbGRvd25JbmRleCAodW5sZXNzIGl0IGhhcyBoaXQgdGhlIGNhcCkuCiAgICAvLy8gQHBhcmFtIF9wdXBweSBBIHJlZmVyZW5jZSB0byB0aGUgUHVwcHkgaW4gc3RvcmFnZSB3aGljaCBuZWVkcyBpdHMgdGltZXIgc3RhcnRlZC4KICAgIGZ1bmN0aW9uIF90cmlnZ2VyQ2hpbGRDb3VudChQdXBweSBzdG9yYWdlIF9wdXBweSkgaW50ZXJuYWwgewogICAgICAgIC8vIEluY3JlbWVudCB0aGUgY2hpbGQgY291bnQKICAgICAgICBfcHVwcHkuY2hpbGROdW1iZXIgKz0gMTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHcmFudHMgYXBwcm92YWwgdG8gYW5vdGhlciB1c2VyIHRvIHNpcmUgd2l0aCBvbmUgb2YgeW91ciBwdXBwaWVzLgogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgYWJsZSB0byBzaXJlIHdpdGggeW91ciBQdXBweS4gU2V0IHRvCiAgICAvLy8gIGFkZHJlc3MoMCkgdG8gY2xlYXIgYWxsIHNpcmluZyBhcHByb3ZhbHMgZm9yIHRoaXMgUHVwcHkuCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgQSBQdXBweSB0aGF0IHlvdSBvd24gdGhhdCBfYWRkciB3aWxsIG5vdyBiZSBhYmxlIHRvIHNpcmUgd2l0aC4KICAgIGZ1bmN0aW9uIGFwcHJvdmVTaXJpbmcoYWRkcmVzcyBfYWRkciwgdWludDI1NiBfc2lyZUlkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3NpcmVJZCkpOwogICAgICAgIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19zaXJlSWRdID0gX2FkZHI7CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlcyB0aGUgbWluaW11bSBwYXltZW50IHJlcXVpcmVkIGZvciBjYWxsaW5nIGdpdmVCaXJ0aEF1dG8oKS4gQ2FuIG9ubHkKICAgIC8vLyAgYmUgY2FsbGVkIGJ5IHRoZSBDT08gYWRkcmVzcy4gKFRoaXMgZmVlIGlzIHVzZWQgdG8gb2Zmc2V0IHRoZSBnYXMgY29zdCBpbmN1cnJlZAogICAgLy8vICBieSB0aGUgYXV0b2JpcnRoIGRhZW1vbikuCiAgICBmdW5jdGlvbiBzZXRBdXRvQmlydGhGZWUodWludDI1NiB2YWwpIGV4dGVybmFsIG9ubHlDT08gewogICAgICAgIGF1dG9CaXJ0aEZlZSA9IHZhbDsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgdG8gc2VlIGlmIGEgZ2l2ZW4gUHVwcHkgaXMgcHJlZ25hbnQgYW5kIChpZiBzbykgaWYgdGhlIGdlc3RhdGlvbgogICAgLy8vICBwZXJpb2QgaGFzIHBhc3NlZC4KICAgIGZ1bmN0aW9uIF9pc1JlYWR5VG9HaXZlQmlydGgoUHVwcHkgX21hdHJvbikgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9tYXRyb24uc2lyaW5nV2l0aElkICE9IDApICYmIChfbWF0cm9uLmNvb2xkb3duRW5kQmxvY2sgPD0gdWludDY0KGJsb2NrLm51bWJlcikpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyB0aGF0IGEgZ2l2ZW4gcHVwcHkgaXMgYWJsZSB0byBicmVlZCAoaS5lLiBpdCBpcyBub3QgcHJlZ25hbnQgb3IKICAgIC8vLyAgaW4gdGhlIG1pZGRsZSBvZiBhIHNpcmluZyBjb29sZG93bikuCiAgICAvLy8gQHBhcmFtIF9wdXBweUlkIHJlZmVyZW5jZSB0aGUgaWQgb2YgdGhlIHB1cHB5LCBhbnkgdXNlciBjYW4gaW5xdWlyZSBhYm91dCBpdAogICAgZnVuY3Rpb24gaXNSZWFkeVRvQnJlZWQodWludDI1NiBfcHVwcHlJZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9wdXBweUlkID4gMCk7CiAgICAgICAgUHVwcHkgc3RvcmFnZSBwdXAgPSBwdXBwaWVzW19wdXBweUlkXTsKICAgICAgICByZXR1cm4gX2lzUmVhZHlUb0JyZWVkKHB1cCk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIHdoZXRoZXIgYSBQdXBweSBpcyBjdXJyZW50bHkgcHJlZ25hbnQuCiAgICAvLy8gQHBhcmFtIF9wdXBweUlkIHJlZmVyZW5jZSB0aGUgaWQgb2YgdGhlIHB1cHB5LCBhbnkgdXNlciBjYW4gaW5xdWlyZSBhYm91dCBpdAogICAgZnVuY3Rpb24gaXNQcmVnbmFudCh1aW50MjU2IF9wdXBweUlkKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX3B1cHB5SWQgPiAwKTsKICAgICAgICAvLyBBIFB1cHB5IGlzIHByZWduYW50IGlmIGFuZCBvbmx5IGlmIHRoaXMgZmllbGQgaXMgc2V0CiAgICAgICAgcmV0dXJuIHB1cHBpZXNbX3B1cHB5SWRdLnNpcmluZ1dpdGhJZCAhPSAwOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGNoZWNrIHRvIHNlZSBpZiBhIGdpdmVuIHNpcmUgYW5kIG1hdHJvbiBhcmUgYSB2YWxpZCBtYXRpbmcgcGFpci4gRE9FUyBOT1QKICAgIC8vLyAgY2hlY2sgb3duZXJzaGlwIHBlcm1pc3Npb25zICh0aGF0IGlzIHVwIHRvIHRoZSBjYWxsZXIpLgogICAgLy8vIEBwYXJhbSBfbWF0cm9uIEEgcmVmZXJlbmNlIHRvIHRoZSBQdXBweSBzdHJ1Y3Qgb2YgdGhlIHBvdGVudGlhbCBtYXRyb24uCiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCBUaGUgbWF0cm9uJ3MgSUQuCiAgICAvLy8gQHBhcmFtIF9zaXJlIEEgcmVmZXJlbmNlIHRvIHRoZSBQdXBweSBzdHJ1Y3Qgb2YgdGhlIHBvdGVudGlhbCBzaXJlLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIFRoZSBzaXJlJ3MgSUQKICAgIGZ1bmN0aW9uIF9pc1ZhbGlkTWF0aW5nUGFpcigKICAgICAgICBQdXBweSBzdG9yYWdlIF9tYXRyb24sCiAgICAgICAgdWludDI1NiBfbWF0cm9uSWQsCiAgICAgICAgUHVwcHkgc3RvcmFnZSBfc2lyZSwKICAgICAgICB1aW50MjU2IF9zaXJlSWQKICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMoYm9vbCkKICAgIHsKICAgICAgICAvLyBBIFB1cHB5IGNhbid0IGJyZWVkIHdpdGggaXRzZWxmIQogICAgICAgIGlmIChfbWF0cm9uSWQgPT0gX3NpcmVJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBwdXBwaWVzIGNhbid0IGJyZWVkIHdpdGggdGhlaXIgcGFyZW50cy4KICAgICAgICBpZiAoX21hdHJvbi5tYXRyb25JZCA9PSBfc2lyZUlkIHx8IF9tYXRyb24uc2lyZUlkID09IF9zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoX3NpcmUubWF0cm9uSWQgPT0gX21hdHJvbklkIHx8IF9zaXJlLnNpcmVJZCA9PSBfbWF0cm9uSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gV2UgY2FuIHNob3J0IGNpcmN1aXQgdGhlIHNpYmxpbmcgY2hlY2sgKGJlbG93KSBpZiBlaXRoZXIgcHVwcHkgaXMKICAgICAgICAvLyBnZW4gemVybyAoaGFzIGEgbWF0cm9uIElEIG9mIHplcm8pLgogICAgICAgIGlmIChfc2lyZS5tYXRyb25JZCA9PSAwIHx8IF9tYXRyb24ubWF0cm9uSWQgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIHB1cHBpZXMgY2FuJ3QgYnJlZWQgd2l0aCBmdWxsIG9yIGhhbGYgc2libGluZ3MuCiAgICAgICAgaWYgKF9zaXJlLm1hdHJvbklkID09IF9tYXRyb24ubWF0cm9uSWQgfHwgX3NpcmUubWF0cm9uSWQgPT0gX21hdHJvbi5zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoX3NpcmUuc2lyZUlkID09IF9tYXRyb24ubWF0cm9uSWQgfHwgX3NpcmUuc2lyZUlkID09IF9tYXRyb24uc2lyZUlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIEV2ZXJ5dGhpbmcgc2VlbXMgY29vbCEgTGV0J3MgZ2V0IERURi4KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBJbnRlcm5hbCBjaGVjayB0byBzZWUgaWYgYSBnaXZlbiBzaXJlIGFuZCBtYXRyb24gYXJlIGEgdmFsaWQgbWF0aW5nIHBhaXIgZm9yCiAgICAvLy8gIGJyZWVkaW5nIHZpYSBhdWN0aW9uIChpLmUuIHNraXBzIG93bmVyc2hpcCBhbmQgc2lyaW5nIGFwcHJvdmFsIGNoZWNrcykuCiAgICBmdW5jdGlvbiBfY2FuQnJlZWRXaXRoVmlhQXVjdGlvbih1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgUHVwcHkgc3RvcmFnZSBtYXRyb24gPSBwdXBwaWVzW19tYXRyb25JZF07CiAgICAgICAgUHVwcHkgc3RvcmFnZSBzaXJlID0gcHVwcGllc1tfc2lyZUlkXTsKICAgICAgICByZXR1cm4gX2lzVmFsaWRNYXRpbmdQYWlyKG1hdHJvbiwgX21hdHJvbklkLCBzaXJlLCBfc2lyZUlkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVja3MgdG8gc2VlIGlmIHR3byBwdXBweXMgY2FuIGJyZWVkIHRvZ2V0aGVyLCBpbmNsdWRpbmcgY2hlY2tzIGZvcgogICAgLy8vICBvd25lcnNoaXAgYW5kIHNpcmluZyBhcHByb3ZhbHMuIERvZXMgTk9UIGNoZWNrIHRoYXQgYm90aCBwdXBweXMgYXJlIHJlYWR5IGZvcgogICAgLy8vICBicmVlZGluZyAoaS5lLiBicmVlZFdpdGggY291bGQgc3RpbGwgZmFpbCB1bnRpbCB0aGUgY29vbGRvd25zIGFyZSBmaW5pc2hlZCkuCiAgICAvLy8gIFRPRE86IFNob3VsZG4ndCB0aGlzIGNoZWNrIHByZWduYW5jeSBhbmQgY29vbGRvd25zPyE/CiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCBUaGUgSUQgb2YgdGhlIHByb3Bvc2VkIG1hdHJvbi4KICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBUaGUgSUQgb2YgdGhlIHByb3Bvc2VkIHNpcmUuCiAgICBmdW5jdGlvbiBjYW5CcmVlZFdpdGgodWludDI1NiBfbWF0cm9uSWQsIHVpbnQyNTYgX3NpcmVJZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfbWF0cm9uSWQgPiAwKTsKICAgICAgICByZXF1aXJlKF9zaXJlSWQgPiAwKTsKICAgICAgICBQdXBweSBzdG9yYWdlIG1hdHJvbiA9IHB1cHBpZXNbX21hdHJvbklkXTsKICAgICAgICBQdXBweSBzdG9yYWdlIHNpcmUgPSBwdXBwaWVzW19zaXJlSWRdOwogICAgICAgIHJldHVybiBfaXNWYWxpZE1hdGluZ1BhaXIobWF0cm9uLCBfbWF0cm9uSWQsIHNpcmUsIF9zaXJlSWQpICYmCiAgICAgICAgICAgIF9pc1NpcmluZ1Blcm1pdHRlZChfc2lyZUlkLCBfbWF0cm9uSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIHV0aWxpdHkgZnVuY3Rpb24gdG8gaW5pdGlhdGUgYnJlZWRpbmcsIGFzc3VtZXMgdGhhdCBhbGwgYnJlZWRpbmcKICAgIC8vLyAgcmVxdWlyZW1lbnRzIGhhdmUgYmVlbiBjaGVja2VkLgogICAgZnVuY3Rpb24gX2JyZWVkV2l0aCh1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgcHVwcGllcyBmcm9tIHN0b3JhZ2UuCiAgICAgICAgUHVwcHkgc3RvcmFnZSBzaXJlID0gcHVwcGllc1tfc2lyZUlkXTsKICAgICAgICBQdXBweSBzdG9yYWdlIG1hdHJvbiA9IHB1cHBpZXNbX21hdHJvbklkXTsKCiAgICAgICAgLy8gTWFyayB0aGUgbWF0cm9uIGFzIHByZWduYW50LCBrZWVwaW5nIHRyYWNrIG9mIHdobyB0aGUgc2lyZSBpcy4KICAgICAgICBtYXRyb24uc2lyaW5nV2l0aElkID0gdWludDMyKF9zaXJlSWQpOwoKICAgICAgICAvLyBUcmlnZ2VyIHRoZSBjb29sZG93biBmb3IgYm90aCBwYXJlbnRzLgogICAgICAgIF90cmlnZ2VyQ29vbGRvd24oc2lyZSk7CiAgICAgICAgX3RyaWdnZXJDb29sZG93bihtYXRyb24pOwogICAgICAgIF90cmlnZ2VyQ2hpbGRDb3VudChzaXJlKTsKICAgICAgICBfdHJpZ2dlckNoaWxkQ291bnQobWF0cm9uKTsKCiAgICAgICAgLy8gQ2xlYXIgc2lyaW5nIHBlcm1pc3Npb24gZm9yIGJvdGggcGFyZW50cy4gVGhpcyBtYXkgbm90IGJlIHN0cmljdGx5IG5lY2Vzc2FyeQogICAgICAgIC8vIGJ1dCBpdCdzIGxpa2VseSB0byBhdm9pZCBjb25mdXNpb24hCiAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19tYXRyb25JZF07CiAgICAgICAgZGVsZXRlIHNpcmVBbGxvd2VkVG9BZGRyZXNzW19zaXJlSWRdOwoKICAgICAgICAvLyBFdmVyeSB0aW1lIGEgUHVwcHkgZ2V0cyBwcmVnbmFudCwgY291bnRlciBpcyBpbmNyZW1lbnRlZC4KICAgICAgICBwcmVnbmFudHB1cHBpZXMrKzsKCiAgICAgICAgLy8gRW1pdCB0aGUgcHJlZ25hbmN5IGV2ZW50LgogICAgICAgIFByZWduYW50KFB1cHB5SW5kZXhUb093bmVyW19tYXRyb25JZF0sIF9tYXRyb25JZCwgX3NpcmVJZCwgbWF0cm9uLmNvb2xkb3duRW5kQmxvY2spOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEJyZWVkIGEgUHVwcHkgeW91IG93biAoYXMgbWF0cm9uKSB3aXRoIGEgc2lyZSB0aGF0IHlvdSBvd24sIG9yIGZvciB3aGljaCB5b3UKICAgIC8vLyAgaGF2ZSBwcmV2aW91c2x5IGJlZW4gZ2l2ZW4gU2lyaW5nIGFwcHJvdmFsLiBXaWxsIGVpdGhlciBtYWtlIHlvdXIgcHVwcHkgcHJlZ25hbnQsIG9yIHdpbGwKICAgIC8vLyAgZmFpbCBlbnRpcmVseS4gUmVxdWlyZXMgYSBwcmUtcGF5bWVudCBvZiB0aGUgZmVlIGdpdmVuIG91dCB0byB0aGUgZmlyc3QgY2FsbGVyIG9mIGdpdmVCaXJ0aCgpCiAgICAvLy8gQHBhcmFtIF9tYXRyb25JZCBUaGUgSUQgb2YgdGhlIFB1cHB5IGFjdGluZyBhcyBtYXRyb24gKHdpbGwgZW5kIHVwIHByZWduYW50IGlmIHN1Y2Nlc3NmdWwpCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgVGhlIElEIG9mIHRoZSBQdXBweSBhY3RpbmcgYXMgc2lyZSAod2lsbCBiZWdpbiBpdHMgc2lyaW5nIGNvb2xkb3duIGlmIHN1Y2Nlc3NmdWwpCiAgICBmdW5jdGlvbiBicmVlZFdpdGhBdXRvKHVpbnQyNTYgX21hdHJvbklkLCB1aW50MjU2IF9zaXJlSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIENoZWNrcyBmb3IgcGF5bWVudC4KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBhdXRvQmlydGhGZWUpOwoKICAgICAgICAvLyBDYWxsZXIgbXVzdCBvd24gdGhlIG1hdHJvbi4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9tYXRyb25JZCkpOwoKICAgICAgICAvLyBOZWl0aGVyIHNpcmUgbm9yIG1hdHJvbiBhcmUgYWxsb3dlZCB0byBiZSBvbiBhdWN0aW9uIGR1cmluZyBhIG5vcm1hbAogICAgICAgIC8vIGJyZWVkaW5nIG9wZXJhdGlvbiwgYnV0IHdlIGRvbid0IG5lZWQgdG8gY2hlY2sgdGhhdCBleHBsaWNpdGx5LgogICAgICAgIC8vIEZvciBtYXRyb246IFRoZSBjYWxsZXIgb2YgdGhpcyBmdW5jdGlvbiBjYW4ndCBiZSB0aGUgb3duZXIgb2YgdGhlIG1hdHJvbgogICAgICAgIC8vICAgYmVjYXVzZSB0aGUgb3duZXIgb2YgYSBQdXBweSBvbiBhdWN0aW9uIGlzIHRoZSBhdWN0aW9uIGhvdXNlLCBhbmQgdGhlCiAgICAgICAgLy8gICBhdWN0aW9uIGhvdXNlIHdpbGwgbmV2ZXIgY2FsbCBicmVlZFdpdGgoKS4KICAgICAgICAvLyBGb3Igc2lyZTogU2ltaWxhcmx5LCBhIHNpcmUgb24gYXVjdGlvbiB3aWxsIGJlIG93bmVkIGJ5IHRoZSBhdWN0aW9uIGhvdXNlCiAgICAgICAgLy8gICBhbmQgdGhlIGFjdCBvZiB0cmFuc2ZlcnJpbmcgb3duZXJzaGlwIHdpbGwgaGF2ZSBjbGVhcmVkIGFueSBvdXN0YW5kaW5nCiAgICAgICAgLy8gICBzaXJpbmcgYXBwcm92YWwuCiAgICAgICAgLy8gVGh1cyB3ZSBkb24ndCBuZWVkIHRvIHNwZW5kIGdhcyBleHBsaWNpdGx5IGNoZWNraW5nIHRvIHNlZSBpZiBlaXRoZXIgcHVwcHkKICAgICAgICAvLyBpcyBvbiBhdWN0aW9uLgoKICAgICAgICAvLyBDaGVjayB0aGF0IG1hdHJvbiBhbmQgc2lyZSBhcmUgYm90aCBvd25lZCBieSBjYWxsZXIsIG9yIHRoYXQgdGhlIHNpcmUKICAgICAgICAvLyBoYXMgZ2l2ZW4gc2lyaW5nIHBlcm1pc3Npb24gdG8gY2FsbGVyIChpLmUuIG1hdHJvbidzIG93bmVyKS4KICAgICAgICAvLyBXaWxsIGZhaWwgZm9yIF9zaXJlSWQgPSAwCiAgICAgICAgcmVxdWlyZShfaXNTaXJpbmdQZXJtaXR0ZWQoX3NpcmVJZCwgX21hdHJvbklkKSk7CgogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHBvdGVudGlhbCBtYXRyb24KICAgICAgICBQdXBweSBzdG9yYWdlIG1hdHJvbiA9IHB1cHBpZXNbX21hdHJvbklkXTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIG1hdHJvbiBpc24ndCBwcmVnbmFudCwgb3IgaW4gdGhlIG1pZGRsZSBvZiBhIHNpcmluZyBjb29sZG93bgogICAgICAgIHJlcXVpcmUoX2lzUmVhZHlUb0JyZWVkKG1hdHJvbikpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBwb3RlbnRpYWwgc2lyZQogICAgICAgIFB1cHB5IHN0b3JhZ2Ugc2lyZSA9IHB1cHBpZXNbX3NpcmVJZF07CgogICAgICAgIC8vIE1ha2Ugc3VyZSBzaXJlIGlzbid0IHByZWduYW50LCBvciBpbiB0aGUgbWlkZGxlIG9mIGEgc2lyaW5nIGNvb2xkb3duCiAgICAgICAgcmVxdWlyZShfaXNSZWFkeVRvQnJlZWQoc2lyZSkpOwoKICAgICAgICAvLyBUZXN0IHRoYXQgdGhlc2UgcHVwcHlzIGFyZSBhIHZhbGlkIG1hdGluZyBwYWlyLgogICAgICAgIHJlcXVpcmUoX2lzVmFsaWRNYXRpbmdQYWlyKAogICAgICAgICAgICBtYXRyb24sCiAgICAgICAgICAgIF9tYXRyb25JZCwKICAgICAgICAgICAgc2lyZSwKICAgICAgICAgICAgX3NpcmVJZAogICAgICAgICkpOwoKICAgICAgICAvLyBBbGwgY2hlY2tzIHBhc3NlZCwgUHVwcHkgZ2V0cyBwcmVnbmFudCEKICAgICAgICBfYnJlZWRXaXRoKF9tYXRyb25JZCwgX3NpcmVJZCk7CiAgICB9CgogICAgZnVuY3Rpb24gcGxheUdhbWUodWludDI1NiBfcHVwcHlJZCwgdWludDI1NiBfZ2FtZUlkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgICAgIHJldHVybnMoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKHB1cHB5U3BvcnRzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3B1cHB5SWQpKTsKCiAgICAgICAgcmV0dXJuIHB1cHB5U3BvcnRzLnBsYXlHYW1lKF9wdXBweUlkLCBfZ2FtZUlkLCBibG9jay5udW1iZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEhhdmUgYSBwcmVnbmFudCBQdXBweSBnaXZlIGJpcnRoIQogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgQSBQdXBweSByZWFkeSB0byBnaXZlIGJpcnRoLgogICAgLy8vIEByZXR1cm4gVGhlIFB1cHB5IElEIG9mIHRoZSBuZXcgcHVwcHkuCiAgICAvLy8gQGRldiBMb29rcyBhdCBhIGdpdmVuIFB1cHB5IGFuZCwgaWYgcHJlZ25hbnQgYW5kIGlmIHRoZSBnZXN0YXRpb24gcGVyaW9kIGhhcyBwYXNzZWQsCiAgICAvLy8gIGNvbWJpbmVzIHRoZSBnZW5lcyBvZiB0aGUgdHdvIHBhcmVudHMgdG8gY3JlYXRlIGEgbmV3IHB1cHB5LiBUaGUgbmV3IFB1cHB5IGlzIGFzc2lnbmVkCiAgICAvLy8gIHRvIHRoZSBjdXJyZW50IG93bmVyIG9mIHRoZSBtYXRyb24uIFVwb24gc3VjY2Vzc2Z1bCBjb21wbGV0aW9uLCBib3RoIHRoZSBtYXRyb24gYW5kIHRoZQogICAgLy8vICBuZXcgcHVwcHkgd2lsbCBiZSByZWFkeSB0byBicmVlZCBhZ2Fpbi4gTm90ZSB0aGF0IGFueW9uZSBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIChpZiB0aGV5CiAgICAvLy8gIGFyZSB3aWxsaW5nIHRvIHBheSB0aGUgZ2FzISksIGJ1dCB0aGUgbmV3IHB1cHB5IGFsd2F5cyBnb2VzIHRvIHRoZSBtb3RoZXIncyBvd25lci4KICAgIGZ1bmN0aW9uIGdpdmVCaXJ0aCh1aW50MjU2IF9tYXRyb25JZCkgcGF5YWJsZQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgICAgIHJldHVybnModWludDI1NikKICAgIHsKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBtYXRyb24gaW4gc3RvcmFnZS4KICAgICAgICBQdXBweSBzdG9yYWdlIG1hdHJvbiA9IHB1cHBpZXNbX21hdHJvbklkXTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgbWF0cm9uIGlzIGEgdmFsaWQgcHVwcHkuCiAgICAgICAgcmVxdWlyZShtYXRyb24uYmlydGhUaW1lICE9IDApOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBtYXRyb24gaXMgcHJlZ25hbnQsIGFuZCB0aGF0IGl0cyB0aW1lIGhhcyBjb21lIQogICAgICAgIHJlcXVpcmUoX2lzUmVhZHlUb0dpdmVCaXJ0aChtYXRyb24pKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgc2lyZSBpbiBzdG9yYWdlLgogICAgICAgIHVpbnQyNTYgc2lyZUlkID0gbWF0cm9uLnNpcmluZ1dpdGhJZDsKICAgICAgICBQdXBweSBzdG9yYWdlIHNpcmUgPSBwdXBwaWVzW3NpcmVJZF07CgogICAgICAgIC8vIERldGVybWluZSB0aGUgaGlnaGVyIGdlbmVyYXRpb24gbnVtYmVyIG9mIHRoZSB0d28gcGFyZW50cwogICAgICAgIHVpbnQxNiBwYXJlbnRHZW4gPSBtYXRyb24uZ2VuZXJhdGlvbjsKICAgICAgICBpZiAoc2lyZS5nZW5lcmF0aW9uID4gbWF0cm9uLmdlbmVyYXRpb24pIHsKICAgICAgICAgICAgcGFyZW50R2VuID0gc2lyZS5nZW5lcmF0aW9uOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsbCB0aGUgc29vcGVyLXNla3JldCBnZW5lIG1peGluZyBvcGVyYXRpb24uCiAgICAgICAgLy91aW50MjU2IGNoaWxkR2VuZXMgPSBfYmFieUdlbmVzOwogICAgICAgIHVpbnQyNTYgY2hpbGRHZW5lcyA9IGdlbmVTY2llbmNlLm1peEdlbmVzKG1hdHJvbi5nZW5lcywgc2lyZS5nZW5lcywgbWF0cm9uLmNvb2xkb3duRW5kQmxvY2sgLSAxKTsKCiAgICAgICAgLy8gTWFrZSB0aGUgbmV3IHB1cHB5IQogICAgICAgIGFkZHJlc3Mgb3duZXIgPSBQdXBweUluZGV4VG9Pd25lcltfbWF0cm9uSWRdOwogICAgICAgIC8vIEFkZCByYW5kb21pemVyIGZvciBhdHRyaWJ1dGVzCiAgICAgICAgdWludDE2IHN0cmVuZ3RoID0gdWludDE2KHJhbmRvbShfbWF0cm9uSWQpKTsKICAgICAgICB1aW50MTYgYWdpbGl0eSA9IHVpbnQxNihyYW5kb20oc3RyZW5ndGgpKTsKICAgICAgICB1aW50MTYgaW50ZWxsaWdlbmNlID0gdWludDE2KHJhbmRvbShhZ2lsaXR5KSk7CiAgICAgICAgdWludDE2IHNwZWVkID0gdWludDE2KHJhbmRvbShpbnRlbGxpZ2VuY2UpKTsKCiAgICAgICAgdWludDI1NiBwdXBweUlkID0gX2NyZWF0ZVB1cHB5KF9tYXRyb25JZCwgbWF0cm9uLnNpcmluZ1dpdGhJZCwgcGFyZW50R2VuICsgMSwgY2hpbGRHZW5lcywgb3duZXIsIHN0cmVuZ3RoLCBhZ2lsaXR5LCBpbnRlbGxpZ2VuY2UsIHNwZWVkKTsKCiAgICAgICAgLy8gQ2xlYXIgdGhlIHJlZmVyZW5jZSB0byBzaXJlIGZyb20gdGhlIG1hdHJvbiAoUkVRVUlSRUQhIEhhdmluZyBzaXJpbmdXaXRoSWQKICAgICAgICAvLyBzZXQgaXMgd2hhdCBtYXJrcyBhIG1hdHJvbiBhcyBiZWluZyBwcmVnbmFudC4pCiAgICAgICAgZGVsZXRlIG1hdHJvbi5zaXJpbmdXaXRoSWQ7CgogICAgICAgIC8vIEV2ZXJ5IHRpbWUgYSBQdXBweSBnaXZlcyBiaXJ0aCBjb3VudGVyIGlzIGRlY3JlbWVudGVkLgogICAgICAgIHByZWduYW50cHVwcGllcy0tOwoKICAgICAgICAvLyBTZW5kIHRoZSBiYWxhbmNlIGZlZSB0byB0aGUgcGVyc29uIHdobyBtYWRlIGJpcnRoIGhhcHBlbi4KICAgICAgICBtc2cuc2VuZGVyLnNlbmQoYXV0b0JpcnRoRmVlKTsKCiAgICAgICAgLy8gcmV0dXJuIHRoZSBuZXcgcHVwcHkncyBJRAogICAgICAgIHJldHVybiBwdXBweUlkOwogICAgfQoKICAgIC8vcmFuZG9tCiAgICBmdW5jdGlvbiByYW5kb20odWludDI1NiBzZWVkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCByYW5kb21OdW1iZXIpIHsKICAgICAgICB1aW50OCBybmQgPSB1aW50OChrZWNjYWsyNTYoCiAgICAgICAgICAgIHNlZWQsCiAgICAgICAgICAgIGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXIgLSAxKSwKICAgICAgICAgICAgYmxvY2suY29pbmJhc2UsCiAgICAgICAgICAgIGJsb2NrLmRpZmZpY3VsdHkKICAgICAgICApKSAlIDEwMCArIHVpbnQ4KDEpOwogICAgICAgIHJldHVybiBybmQgJSAxMDAgKyAxOwogICAgfQp9CgovLy8gQHRpdGxlIEF1Y3Rpb24gQ29yZQovLy8gQGRldiBDb250YWlucyBtb2RlbHMsIHZhcmlhYmxlcywgYW5kIGludGVybmFsIG1ldGhvZHMgZm9yIHRoZSBhdWN0aW9uLgovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IENsb2NrQXVjdGlvbkJhc2UgewoKICAgIC8vIFJlcHJlc2VudHMgYW4gYXVjdGlvbiBvbiBhbiBORlQKICAgIHN0cnVjdCBBdWN0aW9uIHsKICAgICAgICAvLyBDdXJyZW50IG93bmVyIG9mIE5GVAogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uCiAgICAgICAgdWludDEyOCBzdGFydGluZ1ByaWNlOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uCiAgICAgICAgdWludDEyOCBlbmRpbmdQcmljZTsKICAgICAgICAvLyBEdXJhdGlvbiAoaW4gc2Vjb25kcykgb2YgYXVjdGlvbgogICAgICAgIHVpbnQ2NCBkdXJhdGlvbjsKICAgICAgICAvLyBUaW1lIHdoZW4gYXVjdGlvbiBzdGFydGVkCiAgICAgICAgLy8gTk9URTogMCBpZiB0aGlzIGF1Y3Rpb24gaGFzIGJlZW4gY29uY2x1ZGVkCiAgICAgICAgdWludDY0IHN0YXJ0ZWRBdDsKICAgIH0KCiAgICAvLyBSZWZlcmVuY2UgdG8gY29udHJhY3QgdHJhY2tpbmcgTkZUIG93bmVyc2hpcAogICAgRVJDNzIxIHB1YmxpYyBub25GdW5naWJsZUNvbnRyYWN0OwoKICAgIC8vIEN1dCBvd25lciB0YWtlcyBvbiBlYWNoIGF1Y3Rpb24sIG1lYXN1cmVkIGluIGJhc2lzIHBvaW50cyAoMS8xMDAgb2YgYSBwZXJjZW50KS4KICAgIC8vIFZhbHVlcyAwLTEwLDAwMCBtYXAgdG8gMCUtMTAwJQogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQ7CgogICAgLy8gTWFwIGZyb20gdG9rZW4gSUQgdG8gdGhlaXIgY29ycmVzcG9uZGluZyBhdWN0aW9uLgogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSB0b2tlbklkVG9BdWN0aW9uOwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBzdGFydGluZ1ByaWNlLCB1aW50MjU2IGVuZGluZ1ByaWNlLCB1aW50MjU2IGR1cmF0aW9uKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiB0b3RhbFByaWNlLCBhZGRyZXNzIHdpbm5lcik7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBjbGFpbWFudCBvd25zIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IC0gQWRkcmVzcyBjbGFpbWluZyB0byBvd24gdGhlIHRva2VuLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHdob3NlIG93bmVyc2hpcCB0byB2ZXJpZnkuCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChub25GdW5naWJsZUNvbnRyYWN0Lm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRXNjcm93cyB0aGUgTkZULCBhc3NpZ25pbmcgb3duZXJzaGlwIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gVGhyb3dzIGlmIHRoZSBlc2Nyb3cgZmFpbHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciAtIEN1cnJlbnQgb3duZXIgYWRkcmVzcyBvZiB0b2tlbiB0byBlc2Nyb3cuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gd2hvc2UgYXBwcm92YWwgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0LnRyYW5zZmVyRnJvbShfb3duZXIsIHRoaXMsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgYW4gTkZUIG93bmVkIGJ5IHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciBhZGRyZXNzLgogICAgLy8vIFJldHVybnMgdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgc3VjY2VlZHMuCiAgICAvLy8gQHBhcmFtIF9yZWNlaXZlciAtIEFkZHJlc3MgdG8gdHJhbnNmZXIgTkZUIHRvLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhbiBhdWN0aW9uIHRvIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuIEFsc28gZmlyZXMgdGhlCiAgICAvLy8gIEF1Y3Rpb25DcmVhdGVkIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHB1dCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiBBdWN0aW9uIHRvIGFkZC4KICAgIGZ1bmN0aW9uIF9hZGRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgYWxsIGF1Y3Rpb25zIGhhdmUgYSBkdXJhdGlvbiBvZgogICAgICAgIC8vIGF0IGxlYXN0IG9uZSBtaW51dGUuIChLZWVwcyBvdXIgbWF0aCBmcm9tIGdldHRpbmcgaGFpcnkhKQogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKCiAgICAgICAgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0gPSBfYXVjdGlvbjsKCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQoCiAgICAgICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5kdXJhdGlvbikKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB1bmNvbmRpdGlvbmFsbHkuCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgcHJpY2UgYW5kIHRyYW5zZmVycyB3aW5uaW5ncy4KICAgIC8vLyBEb2VzIE5PVCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgdG9rZW4uCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CgogICAgICAgIC8vIEV4cGxpY2l0bHkgY2hlY2sgdGhhdCB0aGlzIGF1Y3Rpb24gaXMgY3VycmVudGx5IGxpdmUuCiAgICAgICAgLy8gKEJlY2F1c2Ugb2YgaG93IEV0aGVyZXVtIG1hcHBpbmdzIHdvcmssIHdlIGNhbid0IGp1c3QgY291bnQKICAgICAgICAvLyBvbiB0aGUgbG9va3VwIGFib3ZlIGZhaWxpbmcuIEFuIGludmFsaWQgX3Rva2VuSWQgd2lsbCBqdXN0CiAgICAgICAgLy8gcmV0dXJuIGFuIGF1Y3Rpb24gb2JqZWN0IHRoYXQgaXMgYWxsIHplcm9zLikKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGJpZCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGN1cnJlbnQgcHJpY2UKICAgICAgICB1aW50MjU2IHByaWNlID0gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgICAgICByZXF1aXJlKF9iaWRBbW91bnQgPj0gcHJpY2UpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzZWxsZXIgYmVmb3JlIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIC8vIGdldHMgZGVsZXRlZC4KICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwoKICAgICAgICAvLyBUaGUgYmlkIGlzIGdvb2QhIFJlbW92ZSB0aGUgYXVjdGlvbiBiZWZvcmUgc2VuZGluZyB0aGUgZmVlcwogICAgICAgIC8vIHRvIHRoZSBzZW5kZXIgc28gd2UgY2FuJ3QgaGF2ZSBhIHJlZW50cmFuY3kgYXR0YWNrLgogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgcHJvY2VlZHMgdG8gc2VsbGVyIChpZiB0aGVyZSBhcmUgYW55ISkKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYXVjdGlvbmVlcidzIGN1dC4KICAgICAgICAgICAgLy8gKE5PVEU6IF9jb21wdXRlQ3V0KCkgaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gYQogICAgICAgICAgICAvLyB2YWx1ZSA8PSBwcmljZSwgc28gdGhpcyBzdWJ0cmFjdGlvbiBjYW4ndCBnbyBuZWdhdGl2ZS4pCiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbmVlckN1dCA9IF9jb21wdXRlQ3V0KHByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gYXVjdGlvbmVlckN1dDsKCiAgICAgICAgICAgIC8vIE5PVEU6IERvaW5nIGEgdHJhbnNmZXIoKSBpbiB0aGUgbWlkZGxlIG9mIGEgY29tcGxleAogICAgICAgICAgICAvLyBtZXRob2QgbGlrZSB0aGlzIGlzIGdlbmVyYWxseSBkaXNjb3VyYWdlZCBiZWNhdXNlIG9mCiAgICAgICAgICAgIC8vIHJlZW50cmFuY3kgYXR0YWNrcyBhbmQgRG9TIGF0dGFja3MgaWYgdGhlIHNlbGxlciBpcwogICAgICAgICAgICAvLyBhIGNvbnRyYWN0IHdpdGggYW4gaW52YWxpZCBmYWxsYmFjayBmdW5jdGlvbi4gV2UgZXhwbGljaXRseQogICAgICAgICAgICAvLyBndWFyZCBhZ2FpbnN0IHJlZW50cmFuY3kgYXR0YWNrcyBieSByZW1vdmluZyB0aGUgYXVjdGlvbgogICAgICAgICAgICAvLyBiZWZvcmUgY2FsbGluZyB0cmFuc2ZlcigpLCBhbmQgdGhlIG9ubHkgdGhpbmcgdGhlIHNlbGxlcgogICAgICAgICAgICAvLyBjYW4gRG9TIGlzIHRoZSBzYWxlIG9mIHRoZWlyIG93biBhc3NldCEgKEFuZCBpZiBpdCdzIGFuCiAgICAgICAgICAgIC8vIGFjY2lkZW50LCB0aGV5IGNhbiBjYWxsIGNhbmNlbEF1Y3Rpb24oKS4gKQogICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgaW5jbHVkZWQgd2l0aCB0aGUgYmlkLiBJZiB0aGUgZXhjZXNzCiAgICAgICAgLy8gaXMgYW55dGhpbmcgd29ydGggd29ycnlpbmcgYWJvdXQsIHRyYW5zZmVyIGl0IGJhY2sgdG8gYmlkZGVyLgogICAgICAgIC8vIE5PVEU6IFdlIGNoZWNrZWQgYWJvdmUgdGhhdCB0aGUgYmlkIGFtb3VudCBpcyBncmVhdGVyIHRoYW4gb3IKICAgICAgICAvLyBlcXVhbCB0byB0aGUgcHJpY2Ugc28gdGhpcyBjYW5ub3QgdW5kZXJmbG93LgogICAgICAgIHVpbnQyNTYgYmlkRXhjZXNzID0gX2JpZEFtb3VudCAtIHByaWNlOwoKICAgICAgICAvLyBSZXR1cm4gdGhlIGZ1bmRzLiBTaW1pbGFyIHRvIHRoZSBwcmV2aW91cyB0cmFuc2ZlciwgdGhpcyBpcwogICAgICAgIC8vIG5vdCBzdXNjZXB0aWJsZSB0byBhIHJlLWVudHJ5IGF0dGFjayBiZWNhdXNlIHRoZSBhdWN0aW9uIGlzCiAgICAgICAgLy8gcmVtb3ZlZCBiZWZvcmUgYW55IHRyYW5zZmVycyBvY2N1ci4KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGJpZEV4Y2Vzcyk7CgogICAgICAgIC8vIFRlbGwgdGhlIHdvcmxkIQogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF90b2tlbklkLCBwcmljZSwgbXNnLnNlbmRlcik7CgogICAgICAgIHJldHVybiBwcmljZTsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmVzIGFuIGF1Y3Rpb24gZnJvbSB0aGUgbGlzdCBvZiBvcGVuIGF1Y3Rpb25zLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gX3JlbW92ZUF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIE5GVCBpcyBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiAtIEF1Y3Rpb24gdG8gY2hlY2suCiAgICBmdW5jdGlvbiBfaXNPbkF1Y3Rpb24oQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9hdWN0aW9uLnN0YXJ0ZWRBdCA+IDApOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgY3VycmVudCBwcmljZSBvZiBhbiBORlQgb24gYXVjdGlvbi4gQnJva2VuIGludG8gdHdvCiAgICAvLy8gIGZ1bmN0aW9ucyAodGhpcyBvbmUsIHRoYXQgY29tcHV0ZXMgdGhlIGR1cmF0aW9uIGZyb20gdGhlIGF1Y3Rpb24KICAgIC8vLyAgc3RydWN0dXJlLCBhbmQgdGhlIG90aGVyIHRoYXQgZG9lcyB0aGUgcHJpY2UgY29tcHV0YXRpb24pIHNvIHdlCiAgICAvLy8gIGNhbiBlYXNpbHkgdGVzdCB0aGF0IHRoZSBwcmljZSBjb21wdXRhdGlvbiB3b3JrcyBjb3JyZWN0bHkuCiAgICBmdW5jdGlvbiBfY3VycmVudFByaWNlKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHVpbnQyNTYgc2Vjb25kc1Bhc3NlZCA9IDA7CgogICAgICAgIC8vIEEgYml0IG9mIGluc3VyYW5jZSBhZ2FpbnN0IG5lZ2F0aXZlIHZhbHVlcyAob3Igd3JhcGFyb3VuZCkuCiAgICAgICAgLy8gUHJvYmFibHkgbm90IG5lY2Vzc2FyeSAoc2luY2UgRXRoZXJldW0gZ3Vhcm5hdGVlcyB0aGF0IHRoZQogICAgICAgIC8vIG5vdyB2YXJpYWJsZSBkb2Vzbid0IGV2ZXIgZ28gYmFja3dhcmRzKS4KICAgICAgICBpZiAobm93ID4gX2F1Y3Rpb24uc3RhcnRlZEF0KSB7CiAgICAgICAgICAgIHNlY29uZHNQYXNzZWQgPSBub3cgLSBfYXVjdGlvbi5zdGFydGVkQXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgICAgIF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4gRmFjdG9yZWQgb3V0CiAgICAvLy8gIGZyb20gX2N1cnJlbnRQcmljZSBzbyB3ZSBjYW4gcnVuIGV4dGVuc2l2ZSB1bml0IHRlc3RzLgogICAgLy8vICBXaGVuIHRlc3RpbmcsIG1ha2UgdGhpcyBmdW5jdGlvbiBwdWJsaWMgYW5kIHR1cm4gb24KICAgIC8vLyAgYEN1cnJlbnQgcHJpY2UgY29tcHV0YXRpb25gIHRlc3Qgc3VpdGUuCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgX3NlY29uZHNQYXNzZWQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgcHVibGljIGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgdGltZSAoYXQgNjQtYml0cykgYW5kIGN1cnJlbmN5IChhdCAxMjgtYml0cykuIF9kdXJhdGlvbiBpcwogICAgICAgIC8vICBhbHNvIGtub3duIHRvIGJlIG5vbi16ZXJvIChzZWUgdGhlIHJlcXVpcmUoKSBzdGF0ZW1lbnQgaW4KICAgICAgICAvLyAgX2FkZEF1Y3Rpb24oKSkKICAgICAgICBpZiAoX3NlY29uZHNQYXNzZWQgPj0gX2R1cmF0aW9uKSB7CiAgICAgICAgICAgIC8vIFdlJ3ZlIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgZHluYW1pYyBwcmljaW5nIHBvcnRpb24KICAgICAgICAgICAgLy8gb2YgdGhlIGF1Y3Rpb24sIGp1c3QgcmV0dXJuIHRoZSBlbmQgcHJpY2UuCiAgICAgICAgICAgIHJldHVybiBfZW5kaW5nUHJpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU3RhcnRpbmcgcHJpY2UgY2FuIGJlIGhpZ2hlciB0aGFuIGVuZGluZyBwcmljZSAoYW5kIG9mdGVuIGlzISksIHNvCiAgICAgICAgICAgIC8vIHRoaXMgZGVsdGEgY2FuIGJlIG5lZ2F0aXZlLgogICAgICAgICAgICBpbnQyNTYgdG90YWxQcmljZUNoYW5nZSA9IGludDI1NihfZW5kaW5nUHJpY2UpIC0gaW50MjU2KF9zdGFydGluZ1ByaWNlKTsKCiAgICAgICAgICAgIC8vIFRoaXMgbXVsdGlwbGlwdXBweWlvbiBjYW4ndCBvdmVyZmxvdywgX3NlY29uZHNQYXNzZWQgd2lsbCBlYXNpbHkgZml0IHdpdGhpbgogICAgICAgICAgICAvLyA2NC1iaXRzLCBhbmQgdG90YWxQcmljZUNoYW5nZSB3aWxsIGVhc2lseSBmaXQgd2l0aGluIDEyOC1iaXRzLCB0aGVpciBwcm9kdWN0CiAgICAgICAgICAgIC8vIHdpbGwgYWx3YXlzIGZpdCB3aXRoaW4gMjU2LWJpdHMuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2VDaGFuZ2UgPSB0b3RhbFByaWNlQ2hhbmdlICogaW50MjU2KF9zZWNvbmRzUGFzc2VkKSAvIGludDI1NihfZHVyYXRpb24pOwoKICAgICAgICAgICAgLy8gY3VycmVudFByaWNlQ2hhbmdlIGNhbiBiZSBuZWdhdGl2ZSwgYnV0IGlmIHNvLCB3aWxsIGhhdmUgYSBtYWduaXR1ZGUKICAgICAgICAgICAgLy8gbGVzcyB0aGF0IF9zdGFydGluZ1ByaWNlLiBUaHVzLCB0aGlzIHJlc3VsdCB3aWxsIGFsd2F5cyBlbmQgdXAgcG9zaXRpdmUuCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2UgPSBpbnQyNTYoX3N0YXJ0aW5nUHJpY2UpICsgY3VycmVudFByaWNlQ2hhbmdlOwoKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgb3duZXIncyBjdXQgb2YgYSBzYWxlLgogICAgLy8vIEBwYXJhbSBfcHJpY2UgLSBTYWxlIHByaWNlIG9mIE5GVC4KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3V0KHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vICBhbGwgb2Ygb3VyIGVudHJ5IGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgY3VycmVuY3kgKGF0IDEyOC1iaXRzKSwgYW5kIG93bmVyQ3V0IDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vICBzdGF0ZW1lbnQgaW4gdGhlIENsb2NrQXVjdGlvbiBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vICBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfcHJpY2UuCiAgICAgICAgcmV0dXJuIF9wcmljZSAqIG93bmVyQ3V0IC8gMTAwMDA7CiAgICB9Cgp9CgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCgovLy8gQHRpdGxlIENsb2NrIGF1Y3Rpb24gZm9yIG5vbi1mdW5naWJsZSB0b2tlbnMuCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgQ2xvY2tBdWN0aW9uIGlzIFBhdXNhYmxlLCBDbG9ja0F1Y3Rpb25CYXNlIHsKCiAgICAvLy8gQGRldiBUaGUgRVJDLTE2NSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkMtNzIxLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUKICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCiAgICAvLy8gQGRldiBDb25zdHJ1Y3RvciBjcmVhdGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBORlQgb3duZXJzaGlwIGNvbnRyYWN0CiAgICAvLy8gIGFuZCB2ZXJpZmllcyB0aGUgb3duZXIgY3V0IGlzIGluIHRoZSB2YWxpZCByYW5nZS4KICAgIC8vLyBAcGFyYW0gX25mdEFkZHJlc3MgLSBhZGRyZXNzIG9mIGEgZGVwbG95ZWQgY29udHJhY3QgaW1wbGVtZW50aW5nCiAgICAvLy8gIHRoZSBOb25mdW5naWJsZSBJbnRlcmZhY2UuCiAgICAvLy8gQHBhcmFtIF9jdXQgLSBwZXJjZW50IGN1dCB0aGUgb3duZXIgdGFrZXMgb24gZWFjaCBhdWN0aW9uLCBtdXN0IGJlCiAgICAvLy8gIGJldHdlZW4gMC0xMCwwMDAuCiAgICBmdW5jdGlvbiBDbG9ja0F1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkcmVzcywgdWludDI1NiBfY3V0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2N1dCA8PSAxMDAwMCk7CiAgICAgICAgb3duZXJDdXQgPSBfY3V0OwoKICAgICAgICBFUkM3MjEgY2FuZGlkYXRlQ29udHJhY3QgPSBFUkM3MjEoX25mdEFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3Quc3VwcG9ydHNJbnRlcmZhY2UoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QgPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmUgYWxsIEV0aGVyIGZyb20gdGhlIGNvbnRyYWN0LCB3aGljaCBpcyB0aGUgb3duZXIncyBjdXRzCiAgICAvLy8gIGFzIHdlbGwgYXMgYW55IEV0aGVyIHNlbnQgZGlyZWN0bHkgdG8gdGhlIGNvbnRyYWN0IGFkZHJlc3MuCiAgICAvLy8gIEFsd2F5cyB0cmFuc2ZlcnMgdG8gdGhlIE5GVCBjb250cmFjdCwgYnV0IGNhbiBiZSBjYWxsZWQgZWl0aGVyIGJ5CiAgICAvLy8gIHRoZSBvd25lciBvciB0aGUgTkZUIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIGFkZHJlc3MgbmZ0QWRkcmVzcyA9IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCk7CgogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBuZnRBZGRyZXNzCiAgICAgICAgKTsKICAgICAgICAvLyBXZSBhcmUgdXNpbmcgdGhpcyBib29sZWFuIG1ldGhvZCB0byBtYWtlIHN1cmUgdGhhdCBldmVuIGlmIG9uZSBmYWlscyBpdCB3aWxsIHN0aWxsIHdvcmsKICAgICAgICBib29sIHJlcyA9IG5mdEFkZHJlc3Muc2VuZCh0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYW5kIGJlZ2lucyBhIG5ldyBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIGF1Y3Rpb24sIHNlbmRlciBtdXN0IGJlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfc3RhcnRpbmdQcmljZSAtIFByaWNlIG9mIGl0ZW0gKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9lbmRpbmdQcmljZSAtIFByaWNlIG9mIGl0ZW0gKGluIHdlaSkgYXQgZW5kIG9mIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9kdXJhdGlvbiAtIExlbmd0aCBvZiB0aW1lIHRvIG1vdmUgYmV0d2VlbiBzdGFydGluZwogICAgLy8vICBwcmljZSBhbmQgZW5kaW5nIHByaWNlIChpbiBzZWNvbmRzKS4KICAgIC8vLyBAcGFyYW0gX3NlbGxlciAtIFNlbGxlciwgaWYgbm90IHRoZSBtZXNzYWdlIHNlbmRlcgogICAgZnVuY3Rpb24gY3JlYXRlQXVjdGlvbigKICAgICAgICB1aW50MjU2IF90b2tlbklkLAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgYWRkcmVzcyBfc2VsbGVyCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb3B1cHB5ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIF9lc2Nyb3cobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBCaWRzIG9uIGFuIG9wZW4gYXVjdGlvbiwgY29tcGxldGluZyB0aGUgYXVjdGlvbiBhbmQgdHJhbnNmZXJyaW5nCiAgICAvLy8gIG93bmVyc2hpcCBvZiB0aGUgTkZUIGlmIGVub3VnaCBFdGhlciBpcyBzdXBwbGllZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBiaWQgb24uCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gX2JpZCB3aWxsIHRocm93IGlmIHRoZSBiaWQgb3IgZnVuZHMgdHJhbnNmZXIgZmFpbHMKICAgICAgICBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHRoYXQgaGFzbid0IGJlZW4gd29uIHlldC4KICAgIC8vLyAgUmV0dXJucyB0aGUgTkZUIHRvIG9yaWdpbmFsIG93bmVyLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBhIHN0YXRlLW1vZGlmeWluZyBmdW5jdGlvbiB0aGF0IGNhbgogICAgLy8vICBiZSBjYWxsZWQgd2hpbGUgdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiBvbiBhdWN0aW9uCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxsZXIpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBzZWxsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICAvLy8gIE9ubHkgdGhlIG93bmVyIG1heSBkbyB0aGlzLCBhbmQgTkZUcyBhcmUgcmV0dXJuZWQgdG8KICAgIC8vLyAgdGhlIHNlbGxlci4gVGhpcyBzaG91bGQgb25seSBiZSB1c2VkIGluIGVtZXJnZW5jaWVzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSBORlQgb24gYXVjdGlvbiB0byBjYW5jZWwuCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uV2hlblBhdXNlZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIHdoZW5QYXVzZWQKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uLnNlbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBhdWN0aW9uIGluZm8gZm9yIGFuIE5GVCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMKICAgICgKICAgICAgICBhZGRyZXNzIHNlbGxlciwKICAgICAgICB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBlbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGR1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgc3RhcnRlZEF0CiAgICApIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSB0b2tlbiBwcmljZSB3ZSBhcmUgY2hlY2tpbmcuCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgfQoKfQoKCi8vLyBAdGl0bGUgUmV2ZXJzZSBhdWN0aW9uIG1vZGlmaWVkIGZvciBzaXJpbmcKLy8vIEBub3RpY2UgV2Ugb21pdCBhIGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBzZW5kcyB0byB0aGlzIGNvbnRyYWN0Lgpjb250cmFjdCBTaXJpbmdDbG9ja0F1Y3Rpb24gaXMgQ2xvY2tBdWN0aW9uIHsKCiAgICAvLyBAZGV2IFNhbml0eSBjaGVjayB0aGF0IGFsbG93cyB1cyB0byBlbnN1cmUgdGhhdCB3ZSBhcmUgcG9pbnRpbmcgdG8gdGhlCiAgICAvLyAgcmlnaHQgYXVjdGlvbiBpbiBvdXIgc2V0U2lyaW5nQXVjdGlvbkFkZHJlc3MoKSBjYWxsLgogICAgYm9vbCBwdWJsaWMgaXNTaXJpbmdDbG9ja0F1Y3Rpb24gPSB0cnVlOwoKICAgIC8vIERlbGVnYXRlIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBTaXJpbmdDbG9ja0F1Y3Rpb24oYWRkcmVzcyBfbmZ0QWRkciwgdWludDI1NiBfY3V0KSBwdWJsaWMKICAgICAgICBDbG9ja0F1Y3Rpb24oX25mdEFkZHIsIF9jdXQpCiAgICB7CgogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYW5kIGJlZ2lucyBhIG5ldyBhdWN0aW9uLiBTaW5jZSB0aGlzIGZ1bmN0aW9uIGlzIHdyYXBwZWQsCiAgICAvLy8gcmVxdWlyZSBzZW5kZXIgdG8gYmUgUHVwcGllc0NvcmUgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIGF1Y3Rpb24gKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIC8vIFNhbml0eSBjaGVjayB0aGF0IG5vIGlucHV0cyBvdmVyZmxvdyBob3cgbWFueSBiaXRzIHdlJ3ZlIGFsbG9wdXBweWVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgUGxhY2VzIGEgYmlkIGZvciBzaXJpbmcuIFJlcXVpcmVzIHRoZSBzZW5kZXIKICAgIC8vLyBpcyB0aGUgUHVwcGllc0NvcmUgY29udHJhY3QgYmVjYXVzZSBhbGwgYmlkIG1ldGhvZHMKICAgIC8vLyBzaG91bGQgYmUgd3JhcHBlZC4gQWxzbyByZXR1cm5zIHRoZSBQdXBweSB0byB0aGUKICAgIC8vLyBzZWxsZXIgcmF0aGVyIHRoYW4gdGhlIHdpbm5lci4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICAvLyBfYmlkIGNoZWNrcyB0aGF0IHRva2VuIElEIGlzIHZhbGlkIGFuZCB3aWxsIHRocm93IGlmIGJpZCBmYWlscwogICAgICAgIF9iaWQoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgLy8gV2UgdHJhbnNmZXIgdGhlIFB1cHB5IGJhY2sgdG8gdGhlIHNlbGxlciwgdGhlIHdpbm5lciB3aWxsIGdldAogICAgICAgIC8vIHRoZSBvZmZzcHJpbmcKICAgICAgICBfdHJhbnNmZXIoc2VsbGVyLCBfdG9rZW5JZCk7CiAgICB9Cgp9CgoKCgoKLy8vIEB0aXRsZSBDbG9jayBhdWN0aW9uIG1vZGlmaWVkIGZvciBzYWxlIG9mIHB1cHBpZXMKLy8vIEBub3RpY2UgV2Ugb21pdCBhIGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHByZXZlbnQgYWNjaWRlbnRhbCBzZW5kcyB0byB0aGlzIGNvbnRyYWN0Lgpjb250cmFjdCBTYWxlQ2xvY2tBdWN0aW9uIGlzIENsb2NrQXVjdGlvbiB7CgogICAgLy8gQGRldiBTYW5pdHkgY2hlY2sgdGhhdCBhbGxvd3MgdXMgdG8gZW5zdXJlIHRoYXQgd2UgYXJlIHBvaW50aW5nIHRvIHRoZQogICAgLy8gIHJpZ2h0IGF1Y3Rpb24gaW4gb3VyIHNldFNhbGVBdWN0aW9uQWRkcmVzcygpIGNhbGwuCiAgICBib29sIHB1YmxpYyBpc1NhbGVDbG9ja0F1Y3Rpb24gPSB0cnVlOwoKICAgIC8vIFRyYWNrcyBsYXN0IDUgc2FsZSBwcmljZSBvZiBnZW4wIFB1cHB5IHNhbGVzCiAgICB1aW50MjU2IHB1YmxpYyBnZW4wU2FsZUNvdW50OwogICAgdWludDI1Nls1XSBwdWJsaWMgbGFzdEdlbjBTYWxlUHJpY2VzOwoKICAgIC8vIERlbGVnYXRlIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBTYWxlQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHIsIHVpbnQyNTYgX2N1dCkgcHVibGljIENsb2NrQXVjdGlvbihfbmZ0QWRkciwgX2N1dCkge30KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgYXVjdGlvbiAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb3B1cHB5ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpOwogICAgICAgIF9lc2Nyb3coX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIGxhc3RTYWxlUHJpY2UgaWYgc2VsbGVyIGlzIHRoZSBuZnQgY29udHJhY3QKICAgIC8vLyBPdGhlcndpc2UsIHdvcmtzIHRoZSBzYW1lIGFzIGRlZmF1bHQgYmlkIG1ldGhvZC4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIC8vIF9iaWQgdmVyaWZpZXMgdG9rZW4gSUQgc2l6ZQogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0uc2VsbGVyOwogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CgogICAgICAgIC8vIElmIG5vdCBhIGdlbjAgYXVjdGlvbiwgZXhpdAogICAgICAgIGlmIChzZWxsZXIgPT0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KSkgewogICAgICAgICAgICAvLyBUcmFjayBnZW4wIHNhbGUgcHJpY2VzCiAgICAgICAgICAgIGxhc3RHZW4wU2FsZVByaWNlc1tnZW4wU2FsZUNvdW50ICUgNV0gPSBwcmljZTsKICAgICAgICAgICAgZ2VuMFNhbGVDb3VudCsrOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhdmVyYWdlR2VuMFNhbGVQcmljZSgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgc3VtID0gMDsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICAgICAgc3VtICs9IGxhc3RHZW4wU2FsZVByaWNlc1tpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1bSAvIDU7CiAgICB9Cgp9CgoKLy8vIEB0aXRsZSBIYW5kbGVzIGNyZWF0aW5nIGF1Y3Rpb25zIGZvciBzYWxlIGFuZCBzaXJpbmcgb2YgcHVwcGllcy4KLy8vICBUaGlzIHdyYXBwZXIgb2YgUmV2ZXJzZUF1Y3Rpb24gZXhpc3RzIG9ubHkgc28gdGhhdCB1c2VycyBjYW4gY3JlYXRlCi8vLyAgYXVjdGlvbnMgd2l0aCBvbmx5IG9uZSB0cmFuc2FjdGlvbi4KY29udHJhY3QgUHVwcGllc0F1Y3Rpb24gaXMgUHVwcHlCcmVlZGluZyB7CgogICAgLy8gQG5vdGljZSBUaGUgYXVjdGlvbiBjb250cmFjdCB2YXJpYWJsZXMgYXJlIGRlZmluZWQgaW4gUHVwcHlCYXNlIHRvIGFsbG93CiAgICAvLyAgdXMgdG8gcmVmZXIgdG8gdGhlbSBpbiBQdXBweU93bmVyc2hpcCB0byBwcmV2ZW50IGFjY2lkZW50YWwgdHJhbnNmZXJzLgogICAgLy8gYHNhbGVBdWN0aW9uYCByZWZlcnMgdG8gdGhlIGF1Y3Rpb24gZm9yIGdlbjAgYW5kIHAycCBzYWxlIG9mIHB1cHBpZXMuCiAgICAvLyBgc2lyaW5nQXVjdGlvbmAgcmVmZXJzIHRvIHRoZSBhdWN0aW9uIGZvciBzaXJpbmcgcmlnaHRzIG9mIHB1cHBpZXMuCgogICAgLy8vIEBkZXYgU2V0cyB0aGUgcmVmZXJlbmNlIHRvIHRoZSBzYWxlIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hZGRyZXNzIC0gQWRkcmVzcyBvZiBzYWxlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gc2V0U2FsZUF1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIFNhbGVDbG9ja0F1Y3Rpb24gY2FuZGlkYXRlQ29udHJhY3QgPSBTYWxlQ2xvY2tBdWN0aW9uKF9hZGRyZXNzKTsKCiAgICAgICAgLy8gTk9URTogdmVyaWZ5IHRoYXQgYSBjb250cmFjdCBpcyB3aGF0IHdlIGV4cGVjdCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9MdW55ci9jcm93ZHNhbGUtY29udHJhY3RzL2Jsb2IvY2ZhZGQxNTk4NmMzMDUyMWQ4YmE3ZDViNmY1N2I0ZmVmY2M3YWMzOC9jb250cmFjdHMvTHVueXJUb2tlbi5zb2wjTDExNwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNTYWxlQ2xvY2tBdWN0aW9uKCkpOwoKICAgICAgICAvLyBTZXQgdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgc2FsZUF1Y3Rpb24gPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KCiAgICAvLy8gQGRldiBTZXRzIHRoZSByZWZlcmVuY2UgdG8gdGhlIHNpcmluZyBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYWRkcmVzcyAtIEFkZHJlc3Mgb2Ygc2lyaW5nIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gc2V0U2lyaW5nQXVjdGlvbkFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgU2lyaW5nQ2xvY2tBdWN0aW9uIGNhbmRpZGF0ZUNvbnRyYWN0ID0gU2lyaW5nQ2xvY2tBdWN0aW9uKF9hZGRyZXNzKTsKCiAgICAgICAgLy8gTk9URTogdmVyaWZ5IHRoYXQgYSBjb250cmFjdCBpcyB3aGF0IHdlIGV4cGVjdCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9MdW55ci9jcm93ZHNhbGUtY29udHJhY3RzL2Jsb2IvY2ZhZGQxNTk4NmMzMDUyMWQ4YmE3ZDViNmY1N2I0ZmVmY2M3YWMzOC9jb250cmFjdHMvTHVueXJUb2tlbi5zb2wjTDExNwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNTaXJpbmdDbG9ja0F1Y3Rpb24oKSk7CgogICAgICAgIC8vIFNldCB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBzaXJpbmdBdWN0aW9uID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgUHV0IGEgUHVwcHkgdXAgZm9yIGF1Y3Rpb24uCiAgICAvLy8gIERvZXMgc29tZSBvd25lcnNoaXAgdHJpY2tlcnkgdG8gY3JlYXRlIGF1Y3Rpb25zIGluIG9uZSB0eC4KICAgIGZ1bmN0aW9uIGNyZWF0ZVB1cHB5U2FsZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfcHVwcHlJZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQXVjdGlvbiBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBQdXBweSBpcyBhbHJlYWR5IG9uIGFueSBhdWN0aW9uLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfcHVwcHlJZCkpOwogICAgICAgIC8vIEVuc3VyZSB0aGUgUHVwcHkgaXMgbm90IHByZWduYW50IHRvIHByZXZlbnQgdGhlIGF1Y3Rpb24KICAgICAgICAvLyBjb250cmFjdCBhY2NpZGVudGFsbHkgcmVjZWl2aW5nIG93bmVyc2hpcCBvZiB0aGUgY2hpbGQuCiAgICAgICAgLy8gTk9URTogdGhlIFB1cHB5IElTIGFsbG93ZWQgdG8gYmUgaW4gYSBjb29sZG93bi4KICAgICAgICByZXF1aXJlKCFpc1ByZWduYW50KF9wdXBweUlkKSk7CiAgICAgICAgX2FwcHJvdmUoX3B1cHB5SWQsIHNhbGVBdWN0aW9uKTsKICAgICAgICAvLyBTYWxlIGF1Y3Rpb24gdGhyb3dzIGlmIGlucHV0cyBhcmUgaW52YWxpZCBhbmQgY2xlYXJzCiAgICAgICAgLy8gdHJhbnNmZXIgYW5kIHNpcmUgYXBwcm92YWwgYWZ0ZXIgZXNjcm93aW5nIHRoZSBQdXBweS4KICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfcHVwcHlJZCwKICAgICAgICAgICAgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9lbmRpbmdQcmljZSwKICAgICAgICAgICAgX2R1cmF0aW9uLAogICAgICAgICAgICBtc2cuc2VuZGVyCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBQdXQgYSBQdXBweSB1cCBmb3IgYXVjdGlvbiB0byBiZSBzaXJlLgogICAgLy8vICBQZXJmb3JtcyBjaGVja3MgdG8gZW5zdXJlIHRoZSBQdXBweSBjYW4gYmUgc2lyZWQsIHRoZW4KICAgIC8vLyAgZGVsZWdhdGVzIHRvIHJldmVyc2UgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZVB1cHB5U2lyaW5nQXVjdGlvbmEoCiAgICAgICAgdWludDI1NiBfcHVwcHlJZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQXVjdGlvbiBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBQdXBweSBpcyBhbHJlYWR5IG9uIGFueSBhdWN0aW9uLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfcHVwcHlJZCkpOwogICAgICAgIHJlcXVpcmUoaXNSZWFkeVRvQnJlZWQoX3B1cHB5SWQpKTsKICAgICAgICBfYXBwcm92ZShfcHVwcHlJZCwgc2lyaW5nQXVjdGlvbik7CiAgICAgICAgLy8gU2lyaW5nIGF1Y3Rpb24gdGhyb3dzIGlmIGlucHV0cyBhcmUgaW52YWxpZCBhbmQgY2xlYXJzCiAgICAgICAgLy8gdHJhbnNmZXIgYW5kIHNpcmUgYXBwcm92YWwgYWZ0ZXIgZXNjcm93aW5nIHRoZSBQdXBweS4KICAgICAgICBzaXJpbmdBdWN0aW9uLmNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgICAgIF9wdXBweUlkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXBsZXRlcyBhIHNpcmluZyBhdWN0aW9uIGJ5IGJpZGRpbmcuCiAgICAvLy8gIEltbWVkaWF0ZWx5IGJyZWVkcyB0aGUgd2lubmluZyBtYXRyb24gd2l0aCB0aGUgc2lyZSBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIC0gSUQgb2YgdGhlIHNpcmUgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIC0gSUQgb2YgdGhlIG1hdHJvbiBvd25lZCBieSB0aGUgYmlkZGVyLgogICAgZnVuY3Rpb24gYmlkT25TaXJpbmdBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3NpcmVJZCwKICAgICAgICB1aW50MjU2IF9tYXRyb25JZAogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBBdWN0aW9uIGNvbnRyYWN0IGNoZWNrcyBpbnB1dCBzaXplcwogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX21hdHJvbklkKSk7CiAgICAgICAgcmVxdWlyZShpc1JlYWR5VG9CcmVlZChfbWF0cm9uSWQpKTsKICAgICAgICByZXF1aXJlKF9jYW5CcmVlZFdpdGhWaWFBdWN0aW9uKF9tYXRyb25JZCwgX3NpcmVJZCkpOwoKICAgICAgICAvLyBEZWZpbmUgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgdGhlIGF1Y3Rpb24uCiAgICAgICAgdWludDI1NiBjdXJyZW50UHJpY2UgPSBzaXJpbmdBdWN0aW9uLmdldEN1cnJlbnRQcmljZShfc2lyZUlkKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBjdXJyZW50UHJpY2UgKyBhdXRvQmlydGhGZWUpOwoKICAgICAgICAvLyBTaXJpbmcgYXVjdGlvbiB3aWxsIHRocm93IGlmIHRoZSBiaWQgZmFpbHMuCiAgICAgICAgc2lyaW5nQXVjdGlvbi5iaWQudmFsdWUobXNnLnZhbHVlIC0gYXV0b0JpcnRoRmVlKShfc2lyZUlkKTsKICAgICAgICBfYnJlZWRXaXRoKHVpbnQzMihfbWF0cm9uSWQpLCB1aW50MzIoX3NpcmVJZCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyB0aGUgYmFsYW5jZSBvZiB0aGUgc2FsZSBhdWN0aW9uIGNvbnRyYWN0CiAgICAvLy8gdG8gdGhlIFB1cHBpZXNDb3JlIGNvbnRyYWN0LiBXZSB1c2UgdHdvLXN0ZXAgd2l0aGRyYXdhbCB0bwogICAgLy8vIHByZXZlbnQgdHdvIHRyYW5zZmVyIGNhbGxzIGluIHRoZSBhdWN0aW9uIGJpZCBmdW5jdGlvbi4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QXVjdGlvbkJhbGFuY2VzKCkgZXh0ZXJuYWwgb25seUNMZXZlbCB7CiAgICAgICAgc2FsZUF1Y3Rpb24ud2l0aGRyYXdCYWxhbmNlKCk7CiAgICAgICAgc2lyaW5nQXVjdGlvbi53aXRoZHJhd0JhbGFuY2UoKTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgYWxsIGZ1bmN0aW9ucyByZWxhdGVkIHRvIGNyZWF0aW5nIHB1cHB5cwpjb250cmFjdCBQdXBwaWVzTWludGluZyBpcyBQdXBwaWVzQXVjdGlvbiB7CgogICAgLy8gTGltaXRzIHRoZSBudW1iZXIgb2YgcHVwcHlzIHRoZSBjb250cmFjdCBvd25lciBjYW4gZXZlciBjcmVhdGUuCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQUk9NT19DUkVBVElPTl9MSU1JVCA9IDUwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX0NSRUFUSU9OX0xJTUlUID0gMTUwMDA7CgogICAgLy8gQ29uc3RhbnRzIGZvciBnZW4wIGF1Y3Rpb25zLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR0VOMF9TVEFSVElOR19QUklDRSA9IDEwMCBmaW5uZXk7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX01JTklNQUxfUFJJQ0UgPSAxMCBmaW5uZXk7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX0FVQ1RJT05fRFVSQVRJT04gPSAyIGRheXM7CgogICAgLy8gQ291bnRzIHRoZSBudW1iZXIgb2YgcHVwcHlzIHRoZSBjb250cmFjdCBvd25lciBoYXMgY3JlYXRlZC4KICAgIHVpbnQyNTYgcHVibGljIHByb21vQ3JlYXRlZENvdW50OwogICAgdWludDI1NiBwdWJsaWMgZ2VuMENyZWF0ZWRDb3VudDsKCiAgICAvLy8gQGRldiB3ZSBjYW4gY3JlYXRlIHByb21vIHB1cHB5cywgdXAgdG8gYSBsaW1pdC4gT25seSBjYWxsYWJsZSBieSBDT08KICAgIC8vLyBAcGFyYW0gX2dlbmVzIHRoZSBlbmNvZGVkIGdlbmVzIG9mIHRoZSBwdXBweSB0byBiZSBjcmVhdGVkLCBhbnkgdmFsdWUgaXMgYWNjZXB0ZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIHRoZSBmdXR1cmUgb3duZXIgb2YgdGhlIGNyZWF0ZWQgcHVwcHlzLiBEZWZhdWx0IHRvIGNvbnRyYWN0IENPTwogICAgZnVuY3Rpb24gY3JlYXRlUHJvbW9QdXBweSh1aW50MjU2IF9nZW5lcywgYWRkcmVzcyBfb3duZXIsIHVpbnQxNiBfc3RyZW5ndGgsIHVpbnQxNiBfYWdpbGl0eSwgdWludDE2IF9pbnRlbGxpZ2VuY2UsIHVpbnQxNiBfc3BlZWQpIGV4dGVybmFsIG9ubHlDT08gewogICAgICAgIGFkZHJlc3MgcHVwcHlPd25lciA9IF9vd25lcjsKICAgICAgICBpZiAocHVwcHlPd25lciA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgICBwdXBweU93bmVyID0gY29vQWRkcmVzczsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShwcm9tb0NyZWF0ZWRDb3VudCA8IFBST01PX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgcHJvbW9DcmVhdGVkQ291bnQrKzsKICAgICAgICBfY3JlYXRlUHVwcHkoMCwgMCwgMCwgX2dlbmVzLCBwdXBweU93bmVyLCBfc3RyZW5ndGgsIF9hZ2lsaXR5LCBfaW50ZWxsaWdlbmNlLCBfc3BlZWQpOwogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYSBuZXcgZ2VuMCBQdXBweSB3aXRoIHRoZSBnaXZlbiBnZW5lcyBhbmQKICAgIC8vLyAgY3JlYXRlcyBhbiBhdWN0aW9uIGZvciBpdC4KICAgIGZ1bmN0aW9uIGNyZWF0ZUdlbjBBdWN0aW9uKHVpbnQyNTYgX2dlbmVzLCB1aW50MTYgX3N0cmVuZ3RoLCB1aW50MTYgX2FnaWxpdHksIHVpbnQxNiBfaW50ZWxsaWdlbmNlLCB1aW50MTYgX3NwZWVkLCB1aW50MTYgX3RhbGVudCkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgcmVxdWlyZShnZW4wQ3JlYXRlZENvdW50IDwgR0VOMF9DUkVBVElPTl9MSU1JVCk7CgogICAgICAgIHVpbnQyNTYgcHVwcHlJZCA9IF9jcmVhdGVQdXBweSgwLCAwLCAwLCBfZ2VuZXMsIGFkZHJlc3ModGhpcyksIF9zdHJlbmd0aCwgX2FnaWxpdHksIF9pbnRlbGxpZ2VuY2UsIF9zcGVlZCk7CiAgICAgICAgX2FwcHJvdmUocHVwcHlJZCwgc2FsZUF1Y3Rpb24pOwoKICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBwdXBweUlkLAogICAgICAgICAgICBfY29tcHV0ZU5leHRHZW4wUHJpY2UoKSwKICAgICAgICAgICAgR0VOMF9NSU5JTUFMX1BSSUNFLAogICAgICAgICAgICBHRU4wX0FVQ1RJT05fRFVSQVRJT04sCiAgICAgICAgICAgIGFkZHJlc3ModGhpcykKICAgICAgICApOwoKICAgICAgICBnZW4wQ3JlYXRlZENvdW50Kys7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIG5leHQgZ2VuMCBhdWN0aW9uIHN0YXJ0aW5nIHByaWNlLCBnaXZlbgogICAgLy8vICB0aGUgYXZlcmFnZSBvZiB0aGUgcGFzdCA1IHByaWNlcyArIDUwJS4KICAgIGZ1bmN0aW9uIF9jb21wdXRlTmV4dEdlbjBQcmljZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYXZlUHJpY2UgPSBzYWxlQXVjdGlvbi5hdmVyYWdlR2VuMFNhbGVQcmljZSgpOwoKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdG8gZW5zdXJlIHdlIGRvbid0IG92ZXJmbG93IGFyaXRobWV0aWMKICAgICAgICByZXF1aXJlKGF2ZVByaWNlID09IHVpbnQyNTYodWludDEyOChhdmVQcmljZSkpKTsKCiAgICAgICAgdWludDI1NiBuZXh0UHJpY2UgPSBhdmVQcmljZSArIChhdmVQcmljZSAvIDIpOwoKICAgICAgICAvLyBXZSBuZXZlciBhdWN0aW9uIGZvciBsZXNzIHRoYW4gc3RhcnRpbmcgcHJpY2UKICAgICAgICBpZiAobmV4dFByaWNlIDwgR0VOMF9TVEFSVElOR19QUklDRSkgewogICAgICAgICAgICBuZXh0UHJpY2UgPSBHRU4wX1NUQVJUSU5HX1BSSUNFOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5leHRQcmljZTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgQ3J5cHRvUHVwcGllczogQ29sbGVjdGlibGUsIGJyZWVkYWJsZSwgYW5kIG9oLXNvLWFkb3JhYmxlIHB1cHB5cyBvbiB0aGUgRXRoZXJldW0gYmxvY2tjaGFpbi4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgVGhlIG1haW4gQ3J5cHRvUHVwcGllcyBjb250cmFjdCwga2VlcHMgdHJhY2sgb2YgcHVwcHlzIHNvIHRoZXkgZG9uJ3Qgd2FuZGVyIGFyb3VuZCBhbmQgZ2V0IGxvc3QuCmNvbnRyYWN0IFB1cHBpZXNDb3JlIGlzIFB1cHBpZXNNaW50aW5nIHsKCiAgICAvLyBUaGlzIGlzIHRoZSBtYWluIENyeXB0b1B1cHBpZXMgY29udHJhY3QuIEluIG9yZGVyIHRvIGtlZXAgb3VyIGNvZGUgc2VwZXJhdGVkIGludG8gbG9naWNhbCBzZWN0aW9ucywKICAgIC8vIHdlJ3ZlIGJyb2tlbiBpdCB1cCBpbiB0d28gd2F5cy4gRmlyc3QsIHdlIGhhdmUgc2V2ZXJhbCBzZXBlcmF0ZWx5LWluc3RhbnRpYXRlZCBzaWJsaW5nIGNvbnRyYWN0cwogICAgLy8gdGhhdCBoYW5kbGUgYXVjdGlvbnMgYW5kIG91ciBzdXBlci10b3Atc2VjcmV0IGdlbmV0aWMgY29tYmluYXRpb24gYWxnb3JpdGhtLiBUaGUgYXVjdGlvbnMgYXJlCiAgICAvLyBzZXBlcmF0ZSBzaW5jZSB0aGVpciBsb2dpYyBpcyBzb21ld2hhdCBjb21wbGV4IGFuZCB0aGVyZSdzIGFsd2F5cyBhIHJpc2sgb2Ygc3VidGxlIGJ1Z3MuIEJ5IGtlZXBpbmcKICAgIC8vIHRoZW0gaW4gdGhlaXIgb3duIGNvbnRyYWN0cywgd2UgY2FuIHVwZ3JhZGUgdGhlbSB3aXRob3V0IGRpc3J1cHRpbmcgdGhlIG1haW4gY29udHJhY3QgdGhhdCB0cmFja3MKICAgIC8vIFB1cHB5IG93bmVyc2hpcC4gVGhlIGdlbmV0aWMgY29tYmluYXRpb24gYWxnb3JpdGhtIGlzIGtlcHQgc2VwZXJhdGUgc28gd2UgY2FuIG9wZW4tc291cmNlIGFsbCBvZgogICAgLy8gdGhlIHJlc3Qgb2Ygb3VyIGNvZGUgd2l0aG91dCBtYWtpbmcgaXQgX3Rvb18gZWFzeSBmb3IgZm9sa3MgdG8gZmlndXJlIG91dCBob3cgdGhlIGdlbmV0aWNzIHdvcmsuCiAgICAvLyBEb24ndCB3b3JyeSwgSSdtIHN1cmUgc29tZW9uZSB3aWxsIHJldmVyc2UgZW5naW5lZXIgaXQgc29vbiBlbm91Z2ghCiAgICAvLwogICAgLy8gU2Vjb25kbHksIHdlIGJyZWFrIHRoZSBjb3JlIGNvbnRyYWN0IGludG8gbXVsdGlwbGUgZmlsZXMgdXNpbmcgaW5oZXJpdGVuY2UsIG9uZSBmb3IgZWFjaCBtYWpvcgogICAgLy8gZmFjZXQgb2YgZnVuY3Rpb25hbGl0eSBvZiBDSy4gVGhpcyBhbGxvd3MgdXMgdG8ga2VlcCByZWxhdGVkIGNvZGUgYnVuZGxlZCB0b2dldGhlciB3aGlsZSBzdGlsbAogICAgLy8gYXZvaWRpbmcgYSBzaW5nbGUgZ2lhbnQgZmlsZSB3aXRoIGV2ZXJ5dGhpbmcgaW4gaXQuIFRoZSBicmVha2Rvd24gaXMgYXMgZm9sbG93czoKICAgIC8vCiAgICAvLyAgICAgIC0gUHVwcHlCYXNlOiBUaGlzIGlzIHdoZXJlIHdlIGRlZmluZSB0aGUgbW9zdCBmdW5kYW1lbnRhbCBjb2RlIHNoYXJlZCB0aHJvdWdob3V0IHRoZSBjb3JlCiAgICAvLyAgICAgICAgICAgICBmdW5jdGlvbmFsaXR5LiBUaGlzIGluY2x1ZGVzIG91ciBtYWluIGRhdGEgc3RvcmFnZSwgY29uc3RhbnRzIGFuZCBkYXRhIHR5cGVzLCBwbHVzCiAgICAvLyAgICAgICAgICAgICBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIG1hbmFnaW5nIHRoZXNlIGl0ZW1zLgogICAgLy8KICAgIC8vICAgICAgLSBQdXBweUFjY2Vzc0NvbnRyb2w6IFRoaXMgY29udHJhY3QgbWFuYWdlcyB0aGUgdmFyaW91cyBhZGRyZXNzZXMgYW5kIGNvbnN0cmFpbnRzIGZvciBvcGVyYXRpb25zCiAgICAvLyAgICAgICAgICAgICB0aGF0IGNhbiBiZSBleGVjdXRlZCBvbmx5IGJ5IHNwZWNpZmljIHJvbGVzLiBOYW1lbHkgQ0VPLCBDRk8gYW5kIENPTy4KICAgIC8vCiAgICAvLyAgICAgIC0gUHVwcHlPd25lcnNoaXA6IFRoaXMgcHJvdmlkZXMgdGhlIG1ldGhvZHMgcmVxdWlyZWQgZm9yIGJhc2ljIG5vbi1mdW5naWJsZSB0b2tlbgogICAgLy8gICAgICAgICAgICAgdHJhbnNhY3Rpb25zLCBmb2xsb3dpbmcgdGhlIGRyYWZ0IEVSQy03MjEgc3BlYyAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkuCiAgICAvLwogICAgLy8gICAgICAtIFB1cHB5QnJlZWRpbmc6IFRoaXMgZmlsZSBjb250YWlucyB0aGUgbWV0aG9kcyBuZWNlc3NhcnkgdG8gYnJlZWQgcHVwcHlzIHRvZ2V0aGVyLCBpbmNsdWRpbmcKICAgIC8vICAgICAgICAgICAgIGtlZXBpbmcgdHJhY2sgb2Ygc2lyaW5nIG9mZmVycywgYW5kIHJlbGllcyBvbiBhbiBleHRlcm5hbCBnZW5ldGljIGNvbWJpbmF0aW9uIGNvbnRyYWN0LgogICAgLy8KICAgIC8vICAgICAgLSBQdXBweUF1Y3Rpb25zOiBIZXJlIHdlIGhhdmUgdGhlIHB1YmxpYyBtZXRob2RzIGZvciBhdWN0aW9uaW5nIG9yIGJpZGRpbmcgb24gcHVwcHlzIG9yIHNpcmluZwogICAgLy8gICAgICAgICAgICAgc2VydmljZXMuIFRoZSBhY3R1YWwgYXVjdGlvbiBmdW5jdGlvbmFsaXR5IGlzIGhhbmRsZWQgaW4gdHdvIHNpYmxpbmcgY29udHJhY3RzIChvbmUKICAgIC8vICAgICAgICAgICAgIGZvciBzYWxlcyBhbmQgb25lIGZvciBzaXJpbmcpLCB3aGlsZSBhdWN0aW9uIGNyZWF0aW9uIGFuZCBiaWRkaW5nIGlzIG1vc3RseSBtZWRpYXRlZAogICAgLy8gICAgICAgICAgICAgdGhyb3VnaCB0aGlzIGZhY2V0IG9mIHRoZSBjb3JlIGNvbnRyYWN0LgogICAgLy8KICAgIC8vICAgICAgLSBQdXBwaWVzTWludGluZzogVGhpcyBmaW5hbCBmYWNldCBjb250YWlucyB0aGUgZnVuY3Rpb25hbGl0eSB3ZSB1c2UgZm9yIGNyZWF0aW5nIG5ldyBnZW4wIHB1cHB5cy4KICAgIC8vICAgICAgICAgICAgIFdlIGNhbiBtYWtlIHVwIHRvIDUwMDAgInByb21vIiBwdXBweXMgdGhhdCBjYW4gYmUgZ2l2ZW4gYXdheSAoZXNwZWNpYWxseSBpbXBvcnRhbnQgd2hlbgogICAgLy8gICAgICAgICAgICAgdGhlIGNvbW11bml0eSBpcyBuZXcpLCBhbmQgYWxsIG90aGVycyBjYW4gb25seSBiZSBjcmVhdGVkIGFuZCB0aGVuIGltbWVkaWF0ZWx5IHB1dCB1cAogICAgLy8gICAgICAgICAgICAgZm9yIGF1Y3Rpb24gdmlhIGFuIGFsZ29yaXRobWljYWxseSBkZXRlcm1pbmVkIHN0YXJ0aW5nIHByaWNlLiBSZWdhcmRsZXNzIG9mIGhvdyB0aGV5CiAgICAvLyAgICAgICAgICAgICBhcmUgY3JlYXRlZCwgdGhlcmUgaXMgYSBoYXJkIGxpbWl0IG9mIDUwayBnZW4wIHB1cHB5cy4gQWZ0ZXIgdGhhdCwgaXQncyBhbGwgdXAgdG8gdGhlCiAgICAvLyAgICAgICAgICAgICBjb21tdW5pdHkgdG8gYnJlZWQsIGJyZWVkLCBicmVlZCEKCiAgICAvLyBTZXQgaW4gY2FzZSB0aGUgY29yZSBjb250cmFjdCBpcyBicm9rZW4gYW5kIGFuIHVwZ3JhZGUgaXMgcmVxdWlyZWQKICAgIGFkZHJlc3MgcHVibGljIG5ld0NvbnRyYWN0QWRkcmVzczsKCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIHRoZSBtYWluIENyeXB0b1B1cHBpZXMgc21hcnQgY29udHJhY3QgaW5zdGFuY2UuCiAgICBmdW5jdGlvbiBQdXBwaWVzQ29yZSgpIHB1YmxpYyB7CiAgICAgICAgLy8gU3RhcnRzIHBhdXNlZC4KICAgICAgICBwYXVzZWQgPSB0cnVlOwoKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0VPCiAgICAgICAgY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyBhbHNvIHRoZSBpbml0aWFsIENPTwogICAgICAgIGNvb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyBzdGFydCB3aXRoIHRoZSBteXRoaWNhbCBwdXBweSAwIC0gc28gd2UgZG9uJ3QgaGF2ZSBnZW5lcmF0aW9uLTAgcGFyZW50IGlzc3VlcwogICAgICAgIF9jcmVhdGVQdXBweSgwLCAwLCAwLCB1aW50MjU2KC0xKSwgYWRkcmVzcygwKSwgMCwgMCwgMCwgMCk7CiAgICB9CgogICAgLy8vIEBkZXYgVXNlZCB0byBtYXJrIHRoZSBzbWFydCBjb250cmFjdCBhcyB1cGdyYWRlZCwgaW4gY2FzZSB0aGVyZSBpcyBhIHNlcmlvdXMKICAgIC8vLyAgYnJlYWtpbmcgYnVnLiBUaGlzIG1ldGhvZCBkb2VzIG5vdGhpbmcgYnV0IGtlZXAgdHJhY2sgb2YgdGhlIG5ldyBjb250cmFjdCBhbmQKICAgIC8vLyAgZW1pdCBhIG1lc3NhZ2UgaW5kaXB1cHB5aW5nIHRoYXQgdGhlIG5ldyBhZGRyZXNzIGlzIHNldC4gSXQncyB1cCB0byBjbGllbnRzIG9mIHRoaXMKICAgIC8vLyAgY29udHJhY3QgdG8gdXBkYXRlIHRvIHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcyBpbiB0aGF0IGNhc2UuIChUaGlzIGNvbnRyYWN0IHdpbGwKICAgIC8vLyAgYmUgcGF1c2VkIGluZGVmaW5pdGVseSBpZiBzdWNoIGFuIHVwZ3JhZGUgdGFrZXMgcGxhY2UuKQogICAgLy8vIEBwYXJhbSBfdjJBZGRyZXNzIG5ldyBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXROZXdBZGRyZXNzKGFkZHJlc3MgX3YyQWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICAvLyBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICAgICAgbmV3Q29udHJhY3RBZGRyZXNzID0gX3YyQWRkcmVzczsKICAgICAgICBDb250cmFjdFVwZ3JhZGUoX3YyQWRkcmVzcyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgTm8gdGlwcGluZyEKICAgIC8vLyBAZGV2IFJlamVjdCBhbGwgRXRoZXIgZnJvbSBiZWluZyBzZW50IGhlcmUsIHVubGVzcyBpdCdzIGZyb20gb25lIG9mIHRoZQogICAgLy8vICB0d28gYXVjdGlvbiBjb250cmFjdHMuIChIb3BlZnVsbHksIHdlIGNhbiBwcmV2ZW50IHVzZXIgYWNjaWRlbnRzLikKICAgIGZ1bmN0aW9uKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBhZGRyZXNzKHNhbGVBdWN0aW9uKSB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3Moc2lyaW5nQXVjdGlvbikKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYWxsIHRoZSByZWxldmFudCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIFB1cHB5LgogICAgLy8vIEBwYXJhbSBfaWQgVGhlIElEIG9mIHRoZSBQdXBweSBvZiBpbnRlcmVzdC4KICAgIGZ1bmN0aW9uIGdldFB1cHB5KHVpbnQyNTYgX2lkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKAogICAgICAgIGJvb2wgaXNHZXN0YXRpbmcsCiAgICAgICAgYm9vbCBpc1JlYWR5LAogICAgICAgIHVpbnQyNTYgY29vbGRvd25JbmRleCwKICAgICAgICB1aW50MjU2IG5leHRBY3Rpb25BdCwKICAgICAgICB1aW50MjU2IHNpcmluZ1dpdGhJZCwKICAgICAgICB1aW50MjU2IGJpcnRoVGltZSwKICAgICAgICB1aW50MjU2IG1hdHJvbklkLAogICAgICAgIHVpbnQyNTYgc2lyZUlkLAogICAgICAgIHVpbnQyNTYgZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IGdlbmVzCiAgICApIHsKICAgICAgICBQdXBweSBzdG9yYWdlIHB1cCA9IHB1cHBpZXNbX2lkXTsKCiAgICAgICAgLy8gaWYgdGhpcyB2YXJpYWJsZSBpcyAwIHRoZW4gaXQncyBub3QgZ2VzdGF0aW5nCiAgICAgICAgaXNHZXN0YXRpbmcgPSAocHVwLnNpcmluZ1dpdGhJZCAhPSAwKTsKICAgICAgICBpc1JlYWR5ID0gKHB1cC5jb29sZG93bkVuZEJsb2NrIDw9IGJsb2NrLm51bWJlcik7CiAgICAgICAgY29vbGRvd25JbmRleCA9IHVpbnQyNTYocHVwLmNvb2xkb3duSW5kZXgpOwogICAgICAgIG5leHRBY3Rpb25BdCA9IHVpbnQyNTYocHVwLmNvb2xkb3duRW5kQmxvY2spOwogICAgICAgIHNpcmluZ1dpdGhJZCA9IHVpbnQyNTYocHVwLnNpcmluZ1dpdGhJZCk7CiAgICAgICAgYmlydGhUaW1lID0gdWludDI1NihwdXAuYmlydGhUaW1lKTsKICAgICAgICBtYXRyb25JZCA9IHVpbnQyNTYocHVwLm1hdHJvbklkKTsKICAgICAgICBzaXJlSWQgPSB1aW50MjU2KHB1cC5zaXJlSWQpOwogICAgICAgIGdlbmVyYXRpb24gPSB1aW50MjU2KHB1cC5nZW5lcmF0aW9uKTsKICAgICAgICBnZW5lcyA9IHB1cC5nZW5lczsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQdXBweUF0dHJpYnV0ZXModWludDI1NiBfaWQpCiAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICgKICAgICAgICB1aW50MTYgY2hpbGROdW1iZXIsCiAgICAgICAgdWludDE2IHN0cmVuZ3RoLAogICAgICAgIHVpbnQxNiBhZ2lsaXR5LAogICAgICAgIHVpbnQxNiBpbnRlbGxpZ2VuY2UsCiAgICAgICAgdWludDE2IHNwZWVkCiAgICApIHsKICAgICAgICBQdXBweSBzdG9yYWdlIHB1cCA9IHB1cHBpZXNbX2lkXTsKCiAgICAgICAgLy8gaWYgdGhpcyB2YXJpYWJsZSBpcyAwIHRoZW4gaXQncyBub3QgZ2VzdGF0aW5nCiAgICAgICAgY2hpbGROdW1iZXIgPSB1aW50MTYocHVwLmNoaWxkTnVtYmVyKTsKICAgICAgICBzdHJlbmd0aCA9IHVpbnQxNihwdXAuc3RyZW5ndGgpOwogICAgICAgIGFnaWxpdHkgPSB1aW50MTYocHVwLmFnaWxpdHkpOwogICAgICAgIGludGVsbGlnZW5jZSA9IHVpbnQxNihwdXAuaW50ZWxsaWdlbmNlKTsKICAgICAgICBzcGVlZCA9IHVpbnQxNihwdXAuc3BlZWQpOwogICAgfQoKICAgIC8vLyBAZGV2IE92ZXJyaWRlIHVucGF1c2Ugc28gaXQgcmVxdWlyZXMgYWxsIGV4dGVybmFsIGNvbnRyYWN0IGFkZHJlc3NlcwogICAgLy8vICB0byBiZSBzZXQgYmVmb3JlIGNvbnRyYWN0IGNhbiBiZSB1bnBhdXNlZC4gQWxzbywgd2UgY2FuJ3QgaGF2ZQogICAgLy8vICBuZXdDb250cmFjdEFkZHJlc3Mgc2V0IGVpdGhlciwgYmVjYXVzZSB0aGVuIHRoZSBjb250cmFjdCB3YXMgdXBncmFkZWQuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyB3ZSBjYW4gY2FsbCBzdXBlci51bnBhdXNlCiAgICAvLy8gIHdpdGhvdXQgdXNpbmcgYW4gZXhwZW5zaXZlIENBTEwuCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShzYWxlQXVjdGlvbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKHNpcmluZ0F1Y3Rpb24gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy9yZXF1aXJlKGdlbmVTY2llbmNlICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vcmVxdWlyZShuZXdDb250cmFjdEFkZHJlc3MgPT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIEFjdHVhbGx5IHVucGF1c2UgdGhlIGNvbnRyYWN0LgogICAgICAgIHN1cGVyLnVucGF1c2UoKTsKICAgIH0KCiAgICAvLyBAZGV2IEFsbG93cyB0aGUgQ0ZPIHRvIGNhcHR1cmUgdGhlIGJhbGFuY2UgYXZhaWxhYmxlIHRvIHRoZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRoaXMuYmFsYW5jZTsKICAgICAgICAvLyBTdWJ0cmFjdCBhbGwgdGhlIGN1cnJlbnRseSBwcmVnbmFudCBwdXBweXMgd2UgaGF2ZSwgcGx1cyAxIG9mIG1hcmdpbi4KICAgICAgICB1aW50MjU2IHN1YnRyYWN0RmVlcyA9IChwcmVnbmFudHB1cHBpZXMgKyAxKSAqIGF1dG9CaXJ0aEZlZTsKCiAgICAgICAgaWYgKGJhbGFuY2UgPiBzdWJ0cmFjdEZlZXMpIHsKICAgICAgICAgICAgY2ZvQWRkcmVzcy5zZW5kKGJhbGFuY2UgLSBzdWJ0cmFjdEZlZXMpOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
