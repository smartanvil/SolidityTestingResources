Class {
	#name : #SRT9b9ea61611a0ae2d90de993053a3be7db55a1226,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9b9ea61611a0ae2d90de993053a3be7db55a1226 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBEU0F1dGhvcml0eSB7CiAgICBmdW5jdGlvbiBjYW5DYWxsKAogICAgICAgIGFkZHJlc3Mgc3JjLCBhZGRyZXNzIGRzdCwgYnl0ZXM0IHNpZwogICAgKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgRFNBdXRoRXZlbnRzIHsKICAgIGV2ZW50IExvZ1NldEF1dGhvcml0eSAoYWRkcmVzcyBpbmRleGVkIGF1dGhvcml0eSk7CiAgICBldmVudCBMb2dTZXRPd25lciAgICAgKGFkZHJlc3MgaW5kZXhlZCBvd25lcik7Cn0KCmNvbnRyYWN0IERTQXV0aCBpcyBEU0F1dGhFdmVudHMgewogICAgRFNBdXRob3JpdHkgIHB1YmxpYyAgYXV0aG9yaXR5OwogICAgYWRkcmVzcyAgICAgIHB1YmxpYyAgb3duZXI7CgogICAgZnVuY3Rpb24gRFNBdXRoKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgTG9nU2V0T3duZXIobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T3duZXIoYWRkcmVzcyBvd25lcl8pCiAgICAgICAgcHVibGljCiAgICAgICAgYXV0aAogICAgewogICAgICAgIG93bmVyID0gb3duZXJfOwogICAgICAgIExvZ1NldE93bmVyKG93bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBdXRob3JpdHkoRFNBdXRob3JpdHkgYXV0aG9yaXR5XykKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICB7CiAgICAgICAgYXV0aG9yaXR5ID0gYXV0aG9yaXR5XzsKICAgICAgICBMb2dTZXRBdXRob3JpdHkoYXV0aG9yaXR5KTsKICAgIH0KCiAgICBtb2RpZmllciBhdXRoIHsKICAgICAgICByZXF1aXJlKGlzQXV0aG9yaXplZChtc2cuc2VuZGVyLCBtc2cuc2lnKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0F1dGhvcml6ZWQoYWRkcmVzcyBzcmMsIGJ5dGVzNCBzaWcpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzcmMgPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHNyYyA9PSBvd25lcikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGF1dGhvcml0eSA9PSBEU0F1dGhvcml0eSgwKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGF1dGhvcml0eS5jYW5DYWxsKHNyYywgdGhpcywgc2lnKTsKICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IERTTWF0aCB7CiAgICBmdW5jdGlvbiBhZGQodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmVxdWlyZSgoeiA9IHggKyB5KSA+PSB4KTsKICAgIH0KICAgIGZ1bmN0aW9uIHN1Yih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXF1aXJlKCh6ID0geCAtIHkpIDw9IHgpOwogICAgfQogICAgZnVuY3Rpb24gbXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJlcXVpcmUoeSA9PSAwIHx8ICh6ID0geCAqIHkpIC8geSA9PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4odWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gbWF4KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIGltaW4oaW50IHgsIGludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaW1heChpbnQgeCwgaW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CgogICAgdWludCBjb25zdGFudCBXQUQgPSAxMCAqKiAxODsKICAgIHVpbnQgY29uc3RhbnQgUkFZID0gMTAgKiogMjc7CgogICAgZnVuY3Rpb24gd211bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCB5KSwgV0FEIC8gMikgLyBXQUQ7CiAgICB9CiAgICBmdW5jdGlvbiBybXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIHkpLCBSQVkgLyAyKSAvIFJBWTsKICAgIH0KICAgIGZ1bmN0aW9uIHdkaXYodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgV0FEKSwgeSAvIDIpIC8geTsKICAgIH0KICAgIGZ1bmN0aW9uIHJkaXYodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgUkFZKSwgeSAvIDIpIC8geTsKICAgIH0KCiAgICAvLyBUaGlzIGZhbW91cyBhbGdvcml0aG0gaXMgY2FsbGVkICJleHBvbmVudGlhdGlvbiBieSBzcXVhcmluZyIKICAgIC8vIGFuZCBjYWxjdWxhdGVzIHhebiB3aXRoIHggYXMgZml4ZWQtcG9pbnQgYW5kIG4gYXMgcmVndWxhciB1bnNpZ25lZC4KICAgIC8vCiAgICAvLyBJdCdzIE8obG9nIG4pLCBpbnN0ZWFkIG9mIE8obikgZm9yIG5haXZlIHJlcGVhdGVkIG11bHRpcGxpY2F0aW9uLgogICAgLy8KICAgIC8vIFRoZXNlIGZhY3RzIGFyZSB3aHkgaXQgd29ya3M6CiAgICAvLwogICAgLy8gIElmIG4gaXMgZXZlbiwgdGhlbiB4Xm4gPSAoeF4yKV4obi8yKS4KICAgIC8vICBJZiBuIGlzIG9kZCwgIHRoZW4geF5uID0geCAqIHheKG4tMSksCiAgICAvLyAgIGFuZCBhcHBseWluZyB0aGUgZXF1YXRpb24gZm9yIGV2ZW4geCBnaXZlcwogICAgLy8gICAgeF5uID0geCAqICh4XjIpXigobi0xKSAvIDIpLgogICAgLy8KICAgIC8vICBBbHNvLCBFVk0gZGl2aXNpb24gaXMgZmxvb3JpbmcgYW5kCiAgICAvLyAgICBmbG9vclsobi0xKSAvIDJdID0gZmxvb3JbbiAvIDJdLgogICAgLy8KICAgIGZ1bmN0aW9uIHJwb3codWludCB4LCB1aW50IG4pIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IG4gJSAyICE9IDAgPyB4IDogUkFZOwoKICAgICAgICBmb3IgKG4gLz0gMjsgbiAhPSAwOyBuIC89IDIpIHsKICAgICAgICAgICAgeCA9IHJtdWwoeCwgeCk7CgogICAgICAgICAgICBpZiAobiAlIDIgIT0gMCkgewogICAgICAgICAgICAgICAgeiA9IHJtdWwoeiwgeCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IEVSQzIwRXZlbnRzIHsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBzcmMsIGFkZHJlc3MgaW5kZXhlZCBndXksIHVpbnQgd2FkKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBzcmMsIGFkZHJlc3MgaW5kZXhlZCBkc3QsIHVpbnQgd2FkKTsKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBFdmVudHMgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIGd1eSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBzcmMsIGFkZHJlc3MgZ3V5KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgZ3V5LCB1aW50IHdhZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBkc3QsIHVpbnQgd2FkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBzcmMsIGFkZHJlc3MgZHN0LCB1aW50IHdhZAogICAgKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IEV2ZW50ZnVsTWFya2V0IHsKICAgIGV2ZW50IExvZ0l0ZW1VcGRhdGUodWludCBpZCk7CiAgICBldmVudCBMb2dUcmFkZSh1aW50IHBheV9hbXQsIGFkZHJlc3MgaW5kZXhlZCBwYXlfZ2VtLAogICAgICAgICAgICAgICAgICAgdWludCBidXlfYW10LCBhZGRyZXNzIGluZGV4ZWQgYnV5X2dlbSk7CgogICAgZXZlbnQgTG9nTWFrZSgKICAgICAgICBieXRlczMyICBpbmRleGVkICBpZCwKICAgICAgICBieXRlczMyICBpbmRleGVkICBwYWlyLAogICAgICAgIGFkZHJlc3MgIGluZGV4ZWQgIG1ha2VyLAogICAgICAgIEVSQzIwICAgICAgICAgICAgIHBheV9nZW0sCiAgICAgICAgRVJDMjAgICAgICAgICAgICAgYnV5X2dlbSwKICAgICAgICB1aW50MTI4ICAgICAgICAgICBwYXlfYW10LAogICAgICAgIHVpbnQxMjggICAgICAgICAgIGJ1eV9hbXQsCiAgICAgICAgdWludDY0ICAgICAgICAgICAgdGltZXN0YW1wCiAgICApOwoKICAgIGV2ZW50IExvZ0J1bXAoCiAgICAgICAgYnl0ZXMzMiAgaW5kZXhlZCAgaWQsCiAgICAgICAgYnl0ZXMzMiAgaW5kZXhlZCAgcGFpciwKICAgICAgICBhZGRyZXNzICBpbmRleGVkICBtYWtlciwKICAgICAgICBFUkMyMCAgICAgICAgICAgICBwYXlfZ2VtLAogICAgICAgIEVSQzIwICAgICAgICAgICAgIGJ1eV9nZW0sCiAgICAgICAgdWludDEyOCAgICAgICAgICAgcGF5X2FtdCwKICAgICAgICB1aW50MTI4ICAgICAgICAgICBidXlfYW10LAogICAgICAgIHVpbnQ2NCAgICAgICAgICAgIHRpbWVzdGFtcAogICAgKTsKCiAgICBldmVudCBMb2dUYWtlKAogICAgICAgIGJ5dGVzMzIgICAgICAgICAgIGlkLAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIHBhaXIsCiAgICAgICAgYWRkcmVzcyAgaW5kZXhlZCAgbWFrZXIsCiAgICAgICAgRVJDMjAgICAgICAgICAgICAgcGF5X2dlbSwKICAgICAgICBFUkMyMCAgICAgICAgICAgICBidXlfZ2VtLAogICAgICAgIGFkZHJlc3MgIGluZGV4ZWQgIHRha2VyLAogICAgICAgIHVpbnQxMjggICAgICAgICAgIHRha2VfYW10LAogICAgICAgIHVpbnQxMjggICAgICAgICAgIGdpdmVfYW10LAogICAgICAgIHVpbnQ2NCAgICAgICAgICAgIHRpbWVzdGFtcAogICAgKTsKCiAgICBldmVudCBMb2dLaWxsKAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIGlkLAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIHBhaXIsCiAgICAgICAgYWRkcmVzcyAgaW5kZXhlZCAgbWFrZXIsCiAgICAgICAgRVJDMjAgICAgICAgICAgICAgcGF5X2dlbSwKICAgICAgICBFUkMyMCAgICAgICAgICAgICBidXlfZ2VtLAogICAgICAgIHVpbnQxMjggICAgICAgICAgIHBheV9hbXQsCiAgICAgICAgdWludDEyOCAgICAgICAgICAgYnV5X2FtdCwKICAgICAgICB1aW50NjQgICAgICAgICAgICB0aW1lc3RhbXAKICAgICk7Cn0KCmNvbnRyYWN0IFNpbXBsZU1hcmtldCBpcyBFdmVudGZ1bE1hcmtldCwgRFNNYXRoIHsKCiAgICB1aW50IHB1YmxpYyBsYXN0X29mZmVyX2lkOwoKICAgIG1hcHBpbmcgKHVpbnQgPT4gT2ZmZXJJbmZvKSBwdWJsaWMgb2ZmZXJzOwoKICAgIGJvb2wgbG9ja2VkOwoKICAgIHN0cnVjdCBPZmZlckluZm8gewogICAgICAgIHVpbnQgICAgIHBheV9hbXQ7CiAgICAgICAgRVJDMjAgICAgcGF5X2dlbTsKICAgICAgICB1aW50ICAgICBidXlfYW10OwogICAgICAgIEVSQzIwICAgIGJ1eV9nZW07CiAgICAgICAgYWRkcmVzcyAgb3duZXI7CiAgICAgICAgdWludDY0ICAgdGltZXN0YW1wOwogICAgfQoKICAgIG1vZGlmaWVyIGNhbl9idXkodWludCBpZCkgewogICAgICAgIHJlcXVpcmUoaXNBY3RpdmUoaWQpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNhbl9jYW5jZWwodWludCBpZCkgewogICAgICAgIHJlcXVpcmUoaXNBY3RpdmUoaWQpKTsKICAgICAgICByZXF1aXJlKGdldE93bmVyKGlkKSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNhbl9vZmZlciB7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBzeW5jaHJvbml6ZWQgewogICAgICAgIHJlcXVpcmUoIWxvY2tlZCk7CiAgICAgICAgbG9ja2VkID0gdHJ1ZTsKICAgICAgICBfOwogICAgICAgIGxvY2tlZCA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQWN0aXZlKHVpbnQgaWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIGFjdGl2ZSkgewogICAgICAgIHJldHVybiBvZmZlcnNbaWRdLnRpbWVzdGFtcCA+IDA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0T3duZXIodWludCBpZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpIHsKICAgICAgICByZXR1cm4gb2ZmZXJzW2lkXS5vd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRPZmZlcih1aW50IGlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCwgRVJDMjAsIHVpbnQsIEVSQzIwKSB7CiAgICAgIHZhciBvZmZlciA9IG9mZmVyc1tpZF07CiAgICAgIHJldHVybiAob2ZmZXIucGF5X2FtdCwgb2ZmZXIucGF5X2dlbSwKICAgICAgICAgICAgICBvZmZlci5idXlfYW10LCBvZmZlci5idXlfZ2VtKTsKICAgIH0KCiAgICAvLyAtLS0tIFB1YmxpYyBlbnRyeXBvaW50cyAtLS0tIC8vCgogICAgZnVuY3Rpb24gYnVtcChieXRlczMyIGlkXykKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5fYnV5KHVpbnQyNTYoaWRfKSkKICAgIHsKICAgICAgICB2YXIgaWQgPSB1aW50MjU2KGlkXyk7CiAgICAgICAgTG9nQnVtcCgKICAgICAgICAgICAgaWRfLAogICAgICAgICAgICBrZWNjYWsyNTYob2ZmZXJzW2lkXS5wYXlfZ2VtLCBvZmZlcnNbaWRdLmJ1eV9nZW0pLAogICAgICAgICAgICBvZmZlcnNbaWRdLm93bmVyLAogICAgICAgICAgICBvZmZlcnNbaWRdLnBheV9nZW0sCiAgICAgICAgICAgIG9mZmVyc1tpZF0uYnV5X2dlbSwKICAgICAgICAgICAgdWludDEyOChvZmZlcnNbaWRdLnBheV9hbXQpLAogICAgICAgICAgICB1aW50MTI4KG9mZmVyc1tpZF0uYnV5X2FtdCksCiAgICAgICAgICAgIG9mZmVyc1tpZF0udGltZXN0YW1wCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBBY2NlcHQgZ2l2ZW4gYHF1YW50aXR5YCBvZiBhbiBvZmZlci4gVHJhbnNmZXJzIGZ1bmRzIGZyb20gY2FsbGVyIHRvCiAgICAvLyBvZmZlciBtYWtlciwgYW5kIGZyb20gbWFya2V0IHRvIGNhbGxlci4KICAgIGZ1bmN0aW9uIGJ1eSh1aW50IGlkLCB1aW50IHF1YW50aXR5KQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbl9idXkoaWQpCiAgICAgICAgc3luY2hyb25pemVkCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBPZmZlckluZm8gbWVtb3J5IG9mZmVyID0gb2ZmZXJzW2lkXTsKICAgICAgICB1aW50IHNwZW5kID0gbXVsKHF1YW50aXR5LCBvZmZlci5idXlfYW10KSAvIG9mZmVyLnBheV9hbXQ7CgogICAgICAgIHJlcXVpcmUodWludDEyOChzcGVuZCkgPT0gc3BlbmQpOwogICAgICAgIHJlcXVpcmUodWludDEyOChxdWFudGl0eSkgPT0gcXVhbnRpdHkpOwoKICAgICAgICAvLyBGb3IgYmFja3dhcmRzIHNlbWFudGljIGNvbXBhdGliaWxpdHkuCiAgICAgICAgaWYgKHF1YW50aXR5ID09IDAgfHwgc3BlbmQgPT0gMCB8fAogICAgICAgICAgICBxdWFudGl0eSA+IG9mZmVyLnBheV9hbXQgfHwgc3BlbmQgPiBvZmZlci5idXlfYW10KQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgb2ZmZXJzW2lkXS5wYXlfYW10ID0gc3ViKG9mZmVyLnBheV9hbXQsIHF1YW50aXR5KTsKICAgICAgICBvZmZlcnNbaWRdLmJ1eV9hbXQgPSBzdWIob2ZmZXIuYnV5X2FtdCwgc3BlbmQpOwogICAgICAgIHJlcXVpcmUoIG9mZmVyLmJ1eV9nZW0udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIG9mZmVyLm93bmVyLCBzcGVuZCkgKTsKICAgICAgICByZXF1aXJlKCBvZmZlci5wYXlfZ2VtLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHF1YW50aXR5KSApOwoKICAgICAgICBMb2dJdGVtVXBkYXRlKGlkKTsKICAgICAgICBMb2dUYWtlKAogICAgICAgICAgICBieXRlczMyKGlkKSwKICAgICAgICAgICAga2VjY2FrMjU2KG9mZmVyLnBheV9nZW0sIG9mZmVyLmJ1eV9nZW0pLAogICAgICAgICAgICBvZmZlci5vd25lciwKICAgICAgICAgICAgb2ZmZXIucGF5X2dlbSwKICAgICAgICAgICAgb2ZmZXIuYnV5X2dlbSwKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgdWludDEyOChxdWFudGl0eSksCiAgICAgICAgICAgIHVpbnQxMjgoc3BlbmQpLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgTG9nVHJhZGUocXVhbnRpdHksIG9mZmVyLnBheV9nZW0sIHNwZW5kLCBvZmZlci5idXlfZ2VtKTsKCiAgICAgICAgaWYgKG9mZmVyc1tpZF0ucGF5X2FtdCA9PSAwKSB7CiAgICAgICAgICBkZWxldGUgb2ZmZXJzW2lkXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIENhbmNlbCBhbiBvZmZlci4gUmVmdW5kcyBvZmZlciBtYWtlci4KICAgIGZ1bmN0aW9uIGNhbmNlbCh1aW50IGlkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbl9jYW5jZWwoaWQpCiAgICAgICAgc3luY2hyb25pemVkCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIC8vIHJlYWQtb25seSBvZmZlci4gTW9kaWZ5IGFuIG9mZmVyIGJ5IGRpcmVjdGx5IGFjY2Vzc2luZyBvZmZlcnNbaWRdCiAgICAgICAgT2ZmZXJJbmZvIG1lbW9yeSBvZmZlciA9IG9mZmVyc1tpZF07CiAgICAgICAgZGVsZXRlIG9mZmVyc1tpZF07CgogICAgICAgIHJlcXVpcmUoIG9mZmVyLnBheV9nZW0udHJhbnNmZXIob2ZmZXIub3duZXIsIG9mZmVyLnBheV9hbXQpICk7CgogICAgICAgIExvZ0l0ZW1VcGRhdGUoaWQpOwogICAgICAgIExvZ0tpbGwoCiAgICAgICAgICAgIGJ5dGVzMzIoaWQpLAogICAgICAgICAgICBrZWNjYWsyNTYob2ZmZXIucGF5X2dlbSwgb2ZmZXIuYnV5X2dlbSksCiAgICAgICAgICAgIG9mZmVyLm93bmVyLAogICAgICAgICAgICBvZmZlci5wYXlfZ2VtLAogICAgICAgICAgICBvZmZlci5idXlfZ2VtLAogICAgICAgICAgICB1aW50MTI4KG9mZmVyLnBheV9hbXQpLAogICAgICAgICAgICB1aW50MTI4KG9mZmVyLmJ1eV9hbXQpLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CgogICAgICAgIHN1Y2Nlc3MgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGtpbGwoYnl0ZXMzMiBpZCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKGNhbmNlbCh1aW50MjU2KGlkKSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2UoCiAgICAgICAgRVJDMjAgICAgcGF5X2dlbSwKICAgICAgICBFUkMyMCAgICBidXlfZ2VtLAogICAgICAgIHVpbnQxMjggIHBheV9hbXQsCiAgICAgICAgdWludDEyOCAgYnV5X2FtdAogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJ5dGVzMzIgaWQpCiAgICB7CiAgICAgICAgcmV0dXJuIGJ5dGVzMzIob2ZmZXIocGF5X2FtdCwgcGF5X2dlbSwgYnV5X2FtdCwgYnV5X2dlbSkpOwogICAgfQoKICAgIC8vIE1ha2UgYSBuZXcgb2ZmZXIuIFRha2VzIGZ1bmRzIGZyb20gdGhlIGNhbGxlciBpbnRvIG1hcmtldCBlc2Nyb3cuCiAgICBmdW5jdGlvbiBvZmZlcih1aW50IHBheV9hbXQsIEVSQzIwIHBheV9nZW0sIHVpbnQgYnV5X2FtdCwgRVJDMjAgYnV5X2dlbSkKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5fb2ZmZXIKICAgICAgICBzeW5jaHJvbml6ZWQKICAgICAgICByZXR1cm5zICh1aW50IGlkKQogICAgewogICAgICAgIHJlcXVpcmUodWludDEyOChwYXlfYW10KSA9PSBwYXlfYW10KTsKICAgICAgICByZXF1aXJlKHVpbnQxMjgoYnV5X2FtdCkgPT0gYnV5X2FtdCk7CiAgICAgICAgcmVxdWlyZShwYXlfYW10ID4gMCk7CiAgICAgICAgcmVxdWlyZShwYXlfZ2VtICE9IEVSQzIwKDB4MCkpOwogICAgICAgIHJlcXVpcmUoYnV5X2FtdCA+IDApOwogICAgICAgIHJlcXVpcmUoYnV5X2dlbSAhPSBFUkMyMCgweDApKTsKICAgICAgICByZXF1aXJlKHBheV9nZW0gIT0gYnV5X2dlbSk7CgogICAgICAgIE9mZmVySW5mbyBtZW1vcnkgaW5mbzsKICAgICAgICBpbmZvLnBheV9hbXQgPSBwYXlfYW10OwogICAgICAgIGluZm8ucGF5X2dlbSA9IHBheV9nZW07CiAgICAgICAgaW5mby5idXlfYW10ID0gYnV5X2FtdDsKICAgICAgICBpbmZvLmJ1eV9nZW0gPSBidXlfZ2VtOwogICAgICAgIGluZm8ub3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGluZm8udGltZXN0YW1wID0gdWludDY0KG5vdyk7CiAgICAgICAgaWQgPSBfbmV4dF9pZCgpOwogICAgICAgIG9mZmVyc1tpZF0gPSBpbmZvOwoKICAgICAgICByZXF1aXJlKCBwYXlfZ2VtLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBwYXlfYW10KSApOwoKICAgICAgICBMb2dJdGVtVXBkYXRlKGlkKTsKICAgICAgICBMb2dNYWtlKAogICAgICAgICAgICBieXRlczMyKGlkKSwKICAgICAgICAgICAga2VjY2FrMjU2KHBheV9nZW0sIGJ1eV9nZW0pLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBwYXlfZ2VtLAogICAgICAgICAgICBidXlfZ2VtLAogICAgICAgICAgICB1aW50MTI4KHBheV9hbXQpLAogICAgICAgICAgICB1aW50MTI4KGJ1eV9hbXQpLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gdGFrZShieXRlczMyIGlkLCB1aW50MTI4IG1heFRha2VBbW91bnQpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShidXkodWludDI1NihpZCksIG1heFRha2VBbW91bnQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfbmV4dF9pZCgpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIGxhc3Rfb2ZmZXJfaWQrKzsgcmV0dXJuIGxhc3Rfb2ZmZXJfaWQ7CiAgICB9Cn0KCi8vIFNpbXBsZSBNYXJrZXQgd2l0aCBhIG1hcmtldCBsaWZldGltZS4gV2hlbiB0aGUgY2xvc2VfdGltZSBoYXMgYmVlbiByZWFjaGVkLAovLyBvZmZlcnMgY2FuIG9ubHkgYmUgY2FuY2VsbGVkIChvZmZlciBhbmQgYnV5IHdpbGwgdGhyb3cpLgoKY29udHJhY3QgRXhwaXJpbmdNYXJrZXQgaXMgRFNBdXRoLCBTaW1wbGVNYXJrZXQgewogICAgdWludDY0IHB1YmxpYyBjbG9zZV90aW1lOwogICAgYm9vbCBwdWJsaWMgc3RvcHBlZDsKCiAgICAvLyBhZnRlciBjbG9zZV90aW1lIGhhcyBiZWVuIHJlYWNoZWQsIG5vIG5ldyBvZmZlcnMgYXJlIGFsbG93ZWQKICAgIG1vZGlmaWVyIGNhbl9vZmZlciB7CiAgICAgICAgcmVxdWlyZSghaXNDbG9zZWQoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBhZnRlciBjbG9zZSwgbm8gbmV3IGJ1eXMgYXJlIGFsbG93ZWQKICAgIG1vZGlmaWVyIGNhbl9idXkodWludCBpZCkgewogICAgICAgIHJlcXVpcmUoaXNBY3RpdmUoaWQpKTsKICAgICAgICByZXF1aXJlKCFpc0Nsb3NlZCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGFmdGVyIGNsb3NlLCBhbnlvbmUgY2FuIGNhbmNlbCBhbiBvZmZlcgogICAgbW9kaWZpZXIgY2FuX2NhbmNlbCh1aW50IGlkKSB7CiAgICAgICAgcmVxdWlyZShpc0FjdGl2ZShpZCkpOwogICAgICAgIHJlcXVpcmUoaXNDbG9zZWQoKSB8fCAobXNnLnNlbmRlciA9PSBnZXRPd25lcihpZCkpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIEV4cGlyaW5nTWFya2V0KHVpbnQ2NCBfY2xvc2VfdGltZSkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBjbG9zZV90aW1lID0gX2Nsb3NlX3RpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gaXNDbG9zZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBjbG9zZWQpIHsKICAgICAgICByZXR1cm4gc3RvcHBlZCB8fCBnZXRUaW1lKCkgPiBjbG9zZV90aW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICAgICAgcmV0dXJuIHVpbnQ2NChub3cpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0b3AoKSBwdWJsaWMgYXV0aCB7CiAgICAgICAgc3RvcHBlZCA9IHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IERTTm90ZSB7CiAgICBldmVudCBMb2dOb3RlKAogICAgICAgIGJ5dGVzNCAgIGluZGV4ZWQgIHNpZywKICAgICAgICBhZGRyZXNzICBpbmRleGVkICBndXksCiAgICAgICAgYnl0ZXMzMiAgaW5kZXhlZCAgZm9vLAogICAgICAgIGJ5dGVzMzIgIGluZGV4ZWQgIGJhciwKICAgICAgICB1aW50ICAgICAgICAgICAgICB3YWQsCiAgICAgICAgYnl0ZXMgICAgICAgICAgICAgZmF4CiAgICApIGFub255bW91czsKCiAgICBtb2RpZmllciBub3RlIHsKICAgICAgICBieXRlczMyIGZvbzsKICAgICAgICBieXRlczMyIGJhcjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBmb28gOj0gY2FsbGRhdGFsb2FkKDQpCiAgICAgICAgICAgIGJhciA6PSBjYWxsZGF0YWxvYWQoMzYpCiAgICAgICAgfQoKICAgICAgICBMb2dOb3RlKG1zZy5zaWcsIG1zZy5zZW5kZXIsIGZvbywgYmFyLCBtc2cudmFsdWUsIG1zZy5kYXRhKTsKCiAgICAgICAgXzsKICAgIH0KfQoKY29udHJhY3QgTWF0Y2hpbmdFdmVudHMgewogICAgZXZlbnQgTG9nQnV5RW5hYmxlZChib29sIGlzRW5hYmxlZCk7CiAgICBldmVudCBMb2dNaW5TZWxsKGFkZHJlc3MgcGF5X2dlbSwgdWludCBtaW5fYW1vdW50KTsKICAgIGV2ZW50IExvZ01hdGNoaW5nRW5hYmxlZChib29sIGlzRW5hYmxlZCk7CiAgICBldmVudCBMb2dVbnNvcnRlZE9mZmVyKHVpbnQgaWQpOwogICAgZXZlbnQgTG9nU29ydGVkT2ZmZXIodWludCBpZCk7CiAgICBldmVudCBMb2dBZGRUb2tlblBhaXJXaGl0ZWxpc3QoRVJDMjAgYmFzZVRva2VuLCBFUkMyMCBxdW90ZVRva2VuKTsKICAgIGV2ZW50IExvZ1JlbVRva2VuUGFpcldoaXRlbGlzdChFUkMyMCBiYXNlVG9rZW4sIEVSQzIwIHF1b3RlVG9rZW4pOwogICAgZXZlbnQgTG9nSW5zZXJ0KGFkZHJlc3Mga2VlcGVyLCB1aW50IGlkKTsKICAgIGV2ZW50IExvZ0RlbGV0ZShhZGRyZXNzIGtlZXBlciwgdWludCBpZCk7Cn0KCmNvbnRyYWN0IE1hdGNoaW5nTWFya2V0IGlzIE1hdGNoaW5nRXZlbnRzLCBFeHBpcmluZ01hcmtldCwgRFNOb3RlIHsKICAgIGJvb2wgcHVibGljIGJ1eUVuYWJsZWQgPSB0cnVlOyAgICAgIC8vYnV5IGVuYWJsZWQKICAgIGJvb2wgcHVibGljIG1hdGNoaW5nRW5hYmxlZCA9IHRydWU7IC8vdHJ1ZTogZW5hYmxlIG1hdGNoaW5nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZmFsc2U6IHJldmVydCB0byBleHBpcmluZyBtYXJrZXQKICAgIHN0cnVjdCBzb3J0SW5mbyB7CiAgICAgICAgdWludCBuZXh0OyAgLy9wb2ludHMgdG8gaWQgb2YgbmV4dCBoaWdoZXIgb2ZmZXIKICAgICAgICB1aW50IHByZXY7ICAvL3BvaW50cyB0byBpZCBvZiBwcmV2aW91cyBsb3dlciBvZmZlcgogICAgICAgIHVpbnQgZGVsYjsgIC8vdGhlIGJsb2NrbnVtYmVyIHdoZXJlIHRoaXMgZW50cnkgd2FzIG1hcmtlZCBmb3IgZGVsZXRlCiAgICB9CiAgICBtYXBwaW5nKHVpbnQgPT4gc29ydEluZm8pIHB1YmxpYyBfcmFuazsgICAgICAgICAgICAgICAgICAgICAvL2RvdWJseSBsaW5rZWQgbGlzdHMgb2Ygc29ydGVkIG9mZmVyIGlkcwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSkgcHVibGljIF9iZXN0OyAgLy9pZCBvZiB0aGUgaGlnaGVzdCBvZmZlciBmb3IgYSB0b2tlbiBwYWlyCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpKSBwdWJsaWMgX3NwYW47ICAvL251bWJlciBvZiBvZmZlcnMgc3RvcmVkIGZvciB0b2tlbiBwYWlyIGluIHNvcnRlZCBvcmRlcmJvb2sKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgX2R1c3Q7ICAgICAgICAgICAgICAgICAgICAgIC8vbWluaW11bSBzZWxsIGFtb3VudCBmb3IgYSB0b2tlbiB0byBhdm9pZCBkdXN0IG9mZmVycwogICAgbWFwcGluZyh1aW50ID0+IHVpbnQpIHB1YmxpYyBfbmVhcjsgICAgICAgICAvL25leHQgdW5zb3J0ZWQgb2ZmZXIgaWQKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBib29sKSBwdWJsaWMgX21lbnU7ICAgICAgLy93aGl0ZWxpc3QgdHJhY2tpbmcgd2hpY2ggdG9rZW4gcGFpcnMgY2FuIGJlIHRyYWRlZAogICAgdWludCBfaGVhZDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ZpcnN0IHVuc29ydGVkIG9mZmVyIGlkCgogICAgLy9jaGVjayBpZiB0b2tlbiBwYWlyIGlzIGVuYWJsZWQKICAgIG1vZGlmaWVyIGlzV2hpdGVsaXN0KEVSQzIwIGJ1eV9nZW0sIEVSQzIwIHBheV9nZW0pIHsKICAgICAgICByZXF1aXJlKF9tZW51W2tlY2NhazI1NihidXlfZ2VtLCBwYXlfZ2VtKV0gfHwgX21lbnVba2VjY2FrMjU2KHBheV9nZW0sIGJ1eV9nZW0pXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBNYXRjaGluZ01hcmtldCh1aW50NjQgY2xvc2VfdGltZSkgRXhwaXJpbmdNYXJrZXQoY2xvc2VfdGltZSkgcHVibGljIHsKICAgIH0KCiAgICAvLyAtLS0tIFB1YmxpYyBlbnRyeXBvaW50cyAtLS0tIC8vCgogICAgZnVuY3Rpb24gbWFrZSgKICAgICAgICBFUkMyMCAgICBwYXlfZ2VtLAogICAgICAgIEVSQzIwICAgIGJ1eV9nZW0sCiAgICAgICAgdWludDEyOCAgcGF5X2FtdCwKICAgICAgICB1aW50MTI4ICBidXlfYW10CiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYnl0ZXMzMikKICAgIHsKICAgICAgICByZXR1cm4gYnl0ZXMzMihvZmZlcihwYXlfYW10LCBwYXlfZ2VtLCBidXlfYW10LCBidXlfZ2VtKSk7CiAgICB9CgogICAgZnVuY3Rpb24gdGFrZShieXRlczMyIGlkLCB1aW50MTI4IG1heFRha2VBbW91bnQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShidXkodWludDI1NihpZCksIG1heFRha2VBbW91bnQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBraWxsKGJ5dGVzMzIgaWQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShjYW5jZWwodWludDI1NihpZCkpKTsKICAgIH0KCiAgICAvLyBNYWtlIGEgbmV3IG9mZmVyLiBUYWtlcyBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW50byBtYXJrZXQgZXNjcm93LgogICAgLy8KICAgIC8vIElmIG1hdGNoaW5nIGlzIGVuYWJsZWQ6CiAgICAvLyAgICAgKiBjcmVhdGVzIG5ldyBvZmZlciB3aXRob3V0IHB1dHRpbmcgaXQgaW4KICAgIC8vICAgICAgIHRoZSBzb3J0ZWQgbGlzdC4KICAgIC8vICAgICAqIGF2YWlsYWJsZSB0byBhdXRob3JpemVkIGNvbnRyYWN0cyBvbmx5IQogICAgLy8gICAgICoga2VlcGVycyBzaG91bGQgY2FsbCBpbnNlcnQoaWQscG9zKQogICAgLy8gICAgICAgdG8gcHV0IG9mZmVyIGluIHRoZSBzb3J0ZWQgbGlzdC4KICAgIC8vCiAgICAvLyBJZiBtYXRjaGluZyBpcyBkaXNhYmxlZDoKICAgIC8vICAgICAqIGNhbGxzIGV4cGlyaW5nIG1hcmtldCdzIG9mZmVyKCkuCiAgICAvLyAgICAgKiBhdmFpbGFibGUgdG8gZXZlcnlvbmUgd2l0aG91dCBhdXRob3JpemF0aW9uLgogICAgLy8gICAgICogbm8gc29ydGluZyBpcyBkb25lLgogICAgLy8KICAgIGZ1bmN0aW9uIG9mZmVyKAogICAgICAgIHVpbnQgcGF5X2FtdCwgICAgLy9tYWtlciAoYXNrKSBzZWxsIGhvdyBtdWNoCiAgICAgICAgRVJDMjAgcGF5X2dlbSwgICAvL21ha2VyIChhc2spIHNlbGwgd2hpY2ggdG9rZW4KICAgICAgICB1aW50IGJ1eV9hbXQsICAgIC8vdGFrZXIgKGFzaykgYnV5IGhvdyBtdWNoCiAgICAgICAgRVJDMjAgYnV5X2dlbSAgICAvL3Rha2VyIChhc2spIGJ1eSB3aGljaCB0b2tlbgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGlzV2hpdGVsaXN0KHBheV9nZW0sIGJ1eV9nZW0pCiAgICAgICAgLyogTk9UIHN5bmNocm9uaXplZCEhISAqLwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdmFyIGZuID0gbWF0Y2hpbmdFbmFibGVkID8gX29mZmVydSA6IHN1cGVyLm9mZmVyOwogICAgICAgIHJldHVybiBmbihwYXlfYW10LCBwYXlfZ2VtLCBidXlfYW10LCBidXlfZ2VtKTsKICAgIH0KCiAgICAvLyBNYWtlIGEgbmV3IG9mZmVyLiBUYWtlcyBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW50byBtYXJrZXQgZXNjcm93LgogICAgZnVuY3Rpb24gb2ZmZXIoCiAgICAgICAgdWludCBwYXlfYW10LCAgICAvL21ha2VyIChhc2spIHNlbGwgaG93IG11Y2gKICAgICAgICBFUkMyMCBwYXlfZ2VtLCAgIC8vbWFrZXIgKGFzaykgc2VsbCB3aGljaCB0b2tlbgogICAgICAgIHVpbnQgYnV5X2FtdCwgICAgLy9tYWtlciAoYXNrKSBidXkgaG93IG11Y2gKICAgICAgICBFUkMyMCBidXlfZ2VtLCAgIC8vbWFrZXIgKGFzaykgYnV5IHdoaWNoIHRva2VuCiAgICAgICAgdWludCBwb3MgICAgICAgICAvL3Bvc2l0aW9uIHRvIGluc2VydCBvZmZlciwgMCBzaG91bGQgYmUgdXNlZCBpZiB1bmtub3duCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgaXNXaGl0ZWxpc3QocGF5X2dlbSwgYnV5X2dlbSkKICAgICAgICAvKk5PVCBzeW5jaHJvbml6ZWQhISEgKi8KICAgICAgICBjYW5fb2ZmZXIKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBvZmZlcihwYXlfYW10LCBwYXlfZ2VtLCBidXlfYW10LCBidXlfZ2VtLCBwb3MsIGZhbHNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvZmZlcigKICAgICAgICB1aW50IHBheV9hbXQsICAgIC8vbWFrZXIgKGFzaykgc2VsbCBob3cgbXVjaAogICAgICAgIEVSQzIwIHBheV9nZW0sICAgLy9tYWtlciAoYXNrKSBzZWxsIHdoaWNoIHRva2VuCiAgICAgICAgdWludCBidXlfYW10LCAgICAvL21ha2VyIChhc2spIGJ1eSBob3cgbXVjaAogICAgICAgIEVSQzIwIGJ1eV9nZW0sICAgLy9tYWtlciAoYXNrKSBidXkgd2hpY2ggdG9rZW4KICAgICAgICB1aW50IHBvcywgICAgICAgIC8vcG9zaXRpb24gdG8gaW5zZXJ0IG9mZmVyLCAwIHNob3VsZCBiZSB1c2VkIGlmIHVua25vd24KICAgICAgICBib29sIHJvdW5kaW5nICAgIC8vbWF0Y2ggImNsb3NlIGVub3VnaCIgb3JkZXJzPwogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGlzV2hpdGVsaXN0KHBheV9nZW0sIGJ1eV9nZW0pCiAgICAgICAgLypOT1Qgc3luY2hyb25pemVkISEhICovCiAgICAgICAgY2FuX29mZmVyCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXF1aXJlKF9kdXN0W3BheV9nZW1dIDw9IHBheV9hbXQpOwoKICAgICAgICBpZiAobWF0Y2hpbmdFbmFibGVkKSB7CiAgICAgICAgICByZXR1cm4gX21hdGNobyhwYXlfYW10LCBwYXlfZ2VtLCBidXlfYW10LCBidXlfZ2VtLCBwb3MsIHJvdW5kaW5nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cGVyLm9mZmVyKHBheV9hbXQsIHBheV9nZW0sIGJ1eV9hbXQsIGJ1eV9nZW0pOwogICAgfQoKICAgIC8vVHJhbnNmZXJzIGZ1bmRzIGZyb20gY2FsbGVyIHRvIG9mZmVyIG1ha2VyLCBhbmQgZnJvbSBtYXJrZXQgdG8gY2FsbGVyLgogICAgZnVuY3Rpb24gYnV5KHVpbnQgaWQsIHVpbnQgYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIC8qTk9UIHN5bmNocm9uaXplZCEhISAqLwogICAgICAgIGNhbl9idXkoaWQpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB2YXIgZm4gPSBtYXRjaGluZ0VuYWJsZWQgPyBfYnV5cyA6IHN1cGVyLmJ1eTsKICAgICAgICByZXR1cm4gZm4oaWQsIGFtb3VudCk7CiAgICB9CgogICAgLy8gQ2FuY2VsIGFuIG9mZmVyLiBSZWZ1bmRzIG9mZmVyIG1ha2VyLgogICAgZnVuY3Rpb24gY2FuY2VsKHVpbnQgaWQpCiAgICAgICAgcHVibGljCiAgICAgICAgLypOT1Qgc3luY2hyb25pemVkISEhICovCiAgICAgICAgY2FuX2NhbmNlbChpZCkKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgaWYgKG1hdGNoaW5nRW5hYmxlZCkgewogICAgICAgICAgICBpZiAoaXNPZmZlclNvcnRlZChpZCkpIHsKICAgICAgICAgICAgICAgIHJlcXVpcmUoX3Vuc29ydChpZCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVxdWlyZShfaGlkZShpZCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdXBlci5jYW5jZWwoaWQpOyAgICAvL2RlbGV0ZSB0aGUgb2ZmZXIuCiAgICB9CgogICAgLy9pbnNlcnQgb2ZmZXIgaW50byB0aGUgc29ydGVkIGxpc3QKICAgIC8va2VlcGVycyBuZWVkIHRvIHVzZSB0aGlzIGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBpbnNlcnQoCiAgICAgICAgdWludCBpZCwgICAvL21ha2VyIChhc2spIGlkCiAgICAgICAgdWludCBwb3MgICAvL3Bvc2l0aW9uIHRvIGluc2VydCBpbnRvCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKCFpc09mZmVyU29ydGVkKGlkKSk7ICAgIC8vbWFrZSBzdXJlIG9mZmVyc1tpZF0gaXMgbm90IHlldCBzb3J0ZWQKICAgICAgICByZXF1aXJlKGlzQWN0aXZlKGlkKSk7ICAgICAgICAgIC8vbWFrZSBzdXJlIG9mZmVyc1tpZF0gaXMgYWN0aXZlCiAgICAgICAgcmVxdWlyZShwb3MgPT0gMCB8fCBpc0FjdGl2ZShwb3MpKTsKCiAgICAgICAgcmVxdWlyZShfaGlkZShpZCkpOyAgICAgICAgICAgICAvL3JlbW92ZSBvZmZlciBmcm9tIHVuc29ydGVkIG9mZmVycyBsaXN0CiAgICAgICAgX3NvcnQoaWQsIHBvcyk7ICAgICAgICAgICAgICAgICAvL3B1dCBvZmZlciBpbnRvIHRoZSBzb3J0ZWQgb2ZmZXJzIGxpc3QKICAgICAgICBMb2dJbnNlcnQobXNnLnNlbmRlciwgaWQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vZGVsZXRlcyBfcmFuayBbaWRdCiAgICAvLyAgRnVuY3Rpb24gc2hvdWxkIGJlIGNhbGxlZCBieSBrZWVwZXJzLgogICAgZnVuY3Rpb24gZGVsX3JhbmsodWludCBpZCkKICAgICAgICBwdWJsaWMKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZSghaXNBY3RpdmUoaWQpICYmIF9yYW5rW2lkXS5kZWxiICE9IDAgJiYgX3JhbmtbaWRdLmRlbGIgPCBibG9jay5udW1iZXIgLSAxMCk7CiAgICAgICAgZGVsZXRlIF9yYW5rW2lkXTsKICAgICAgICBMb2dEZWxldGUobXNnLnNlbmRlciwgaWQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vcmV0dXJucyB0cnVlIGlmIHRva2VuIGlzIHN1Y2Nlc2Z1bGx5IGFkZGVkIHRvIHdoaXRlbGlzdAogICAgLy8gIEZ1bmN0aW9uIGlzIHVzZWQgdG8gYWRkIGEgdG9rZW4gcGFpciB0byB0aGUgd2hpdGVsaXN0CiAgICAvLyAgQWxsIGluY29taW5nIG9mZmVycyBhcmUgY2hlY2tlZCBhZ2FpbnN0IHRoZSB3aGl0ZWxpc3QuCiAgICBmdW5jdGlvbiBhZGRUb2tlblBhaXJXaGl0ZWxpc3QoCiAgICAgICAgRVJDMjAgYmFzZVRva2VuLAogICAgICAgIEVSQzIwIHF1b3RlVG9rZW4KICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBhdXRoCiAgICAgICAgbm90ZQogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKCFpc1Rva2VuUGFpcldoaXRlbGlzdGVkKGJhc2VUb2tlbiwgcXVvdGVUb2tlbikpOwogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhiYXNlVG9rZW4pICE9IDB4MCAmJiBhZGRyZXNzKHF1b3RlVG9rZW4pICE9IDB4MCk7CgogICAgICAgIF9tZW51W2tlY2NhazI1NihiYXNlVG9rZW4sIHF1b3RlVG9rZW4pXSA9IHRydWU7CiAgICAgICAgTG9nQWRkVG9rZW5QYWlyV2hpdGVsaXN0KGJhc2VUb2tlbiwgcXVvdGVUb2tlbik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy9yZXR1cm5zIHRydWUgaWYgdG9rZW4gaXMgc3VjY2Vzc2Z1bGx5IHJlbW92ZWQgZnJvbSB3aGl0ZWxpc3QKICAgIC8vICBGdW5jdGlvbiBpcyB1c2VkIHRvIHJlbW92ZSBhIHRva2VuIHBhaXIgZnJvbSB0aGUgd2hpdGVsaXN0LgogICAgLy8gIEFsbCBpbmNvbWluZyBvZmZlcnMgYXJlIGNoZWNrZWQgYWdhaW5zdCB0aGUgd2hpdGVsaXN0LgogICAgZnVuY3Rpb24gcmVtVG9rZW5QYWlyV2hpdGVsaXN0KAogICAgICAgIEVSQzIwIGJhc2VUb2tlbiwKICAgICAgICBFUkMyMCBxdW90ZVRva2VuCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgYXV0aAogICAgICAgIG5vdGUKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShpc1Rva2VuUGFpcldoaXRlbGlzdGVkKGJhc2VUb2tlbiwgcXVvdGVUb2tlbikpOwoKICAgICAgICBkZWxldGUgX21lbnVba2VjY2FrMjU2KGJhc2VUb2tlbiwgcXVvdGVUb2tlbildOwogICAgICAgIGRlbGV0ZSBfbWVudVtrZWNjYWsyNTYocXVvdGVUb2tlbiwgYmFzZVRva2VuKV07CiAgICAgICAgTG9nUmVtVG9rZW5QYWlyV2hpdGVsaXN0KGJhc2VUb2tlbiwgcXVvdGVUb2tlbik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gaXNUb2tlblBhaXJXaGl0ZWxpc3RlZCgKICAgICAgICBFUkMyMCBiYXNlVG9rZW4sCiAgICAgICAgRVJDMjAgcXVvdGVUb2tlbgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gKF9tZW51W2tlY2NhazI1NihiYXNlVG9rZW4sIHF1b3RlVG9rZW4pXSB8fCBfbWVudVtrZWNjYWsyNTYocXVvdGVUb2tlbiwgYmFzZVRva2VuKV0pOwogICAgfQoKICAgIC8vc2V0IHRoZSBtaW5pbXVtIHNlbGwgYW1vdW50IGZvciBhIHRva2VuCiAgICAvLyAgICBGdW5jdGlvbiBpcyB1c2VkIHRvIGF2b2lkICJkdXN0IG9mZmVycyIgdGhhdCBoYXZlCiAgICAvLyAgICB2ZXJ5IHNtYWxsIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VsbCwgYW5kIGl0IHdvdWxkCiAgICAvLyAgICBjb3N0IG1vcmUgZ2FzIHRvIGFjY2VwdCB0aGUgb2ZmZXIsIHRoYW4gdGhlIHZhbHVlCiAgICAvLyAgICBvZiB0b2tlbnMgcmVjZWl2ZWQuCiAgICBmdW5jdGlvbiBzZXRNaW5TZWxsKAogICAgICAgIEVSQzIwIHBheV9nZW0sICAgICAvL3Rva2VuIHRvIGFzc2lnbiBtaW5pbXVtIHNlbGwgYW1vdW50IHRvCiAgICAgICAgdWludCBkdXN0ICAgICAgICAgIC8vbWFrZXIgKGFzaykgbWluaW11bSBzZWxsIGFtb3VudAogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGF1dGgKICAgICAgICBub3RlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBfZHVzdFtwYXlfZ2VtXSA9IGR1c3Q7CiAgICAgICAgTG9nTWluU2VsbChwYXlfZ2VtLCBkdXN0KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvL3JldHVybnMgdGhlIG1pbmltdW0gc2VsbCBhbW91bnQgZm9yIGFuIG9mZmVyCiAgICBmdW5jdGlvbiBnZXRNaW5TZWxsKAogICAgICAgIEVSQzIwIHBheV9nZW0gICAgICAvL3Rva2VuIGZvciB3aGljaCBtaW5pbXVtIHNlbGwgYW1vdW50IGlzIHF1ZXJpZWQKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIF9kdXN0W3BheV9nZW1dOwogICAgfQoKICAgIC8vc2V0IGJ1eSBmdW5jdGlvbmFsaXR5IGVuYWJsZWQvZGlzYWJsZWQKICAgIGZ1bmN0aW9uIHNldEJ1eUVuYWJsZWQoYm9vbCBidXlFbmFibGVkXykgcHVibGljIGF1dGggcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJ1eUVuYWJsZWQgPSBidXlFbmFibGVkXzsKICAgICAgICBMb2dCdXlFbmFibGVkKGJ1eUVuYWJsZWQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vc2V0IG1hdGNoaW5nIGVuYWJsZWQvZGlzYWJsZWQKICAgIC8vICAgIElmIG1hdGNoaW5nRW5hYmxlZCB0cnVlKGRlZmF1bHQpLCB0aGVuIGluc2VydGVkIG9mZmVycyBhcmUgbWF0Y2hlZC4KICAgIC8vICAgIEV4Y2VwdCB0aGUgb25lcyBpbnNlcnRlZCBieSBjb250cmFjdHMsIGJlY2F1c2UgdGhvc2UgZW5kIHVwCiAgICAvLyAgICBpbiB0aGUgdW5zb3J0ZWQgbGlzdCBvZiBvZmZlcnMsIHRoYXQgbXVzdCBiZSBsYXRlciBzb3J0ZWQgYnkKICAgIC8vICAgIGtlZXBlcnMgdXNpbmcgaW5zZXJ0KCkuCiAgICAvLyAgICBJZiBtYXRjaGluZ0VuYWJsZWQgaXMgZmFsc2UgdGhlbiBNYXRjaGluZ01hcmtldCBpcyByZXZlcnRlZCB0byBFeHBpcmluZ01hcmtldCwKICAgIC8vICAgIGFuZCBtYXRjaGluZyBpcyBub3QgZG9uZSwgYW5kIHNvcnRlZCBsaXN0cyBhcmUgZGlzYWJsZWQuCiAgICBmdW5jdGlvbiBzZXRNYXRjaGluZ0VuYWJsZWQoYm9vbCBtYXRjaGluZ0VuYWJsZWRfKSBwdWJsaWMgYXV0aCByZXR1cm5zIChib29sKSB7CiAgICAgICAgbWF0Y2hpbmdFbmFibGVkID0gbWF0Y2hpbmdFbmFibGVkXzsKICAgICAgICBMb2dNYXRjaGluZ0VuYWJsZWQobWF0Y2hpbmdFbmFibGVkKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvL3JldHVybiB0aGUgYmVzdCBvZmZlciBmb3IgYSB0b2tlbiBwYWlyCiAgICAvLyAgICAgIHRoZSBiZXN0IG9mZmVyIGlzIHRoZSBsb3dlc3Qgb25lIGlmIGl0J3MgYW4gYXNrLAogICAgLy8gICAgICBhbmQgaGlnaGVzdCBvbmUgaWYgaXQncyBhIGJpZCBvZmZlcgogICAgZnVuY3Rpb24gZ2V0QmVzdE9mZmVyKEVSQzIwIHNlbGxfZ2VtLCBFUkMyMCBidXlfZ2VtKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9iZXN0W3NlbGxfZ2VtXVtidXlfZ2VtXTsKICAgIH0KCiAgICAvL3JldHVybiB0aGUgbmV4dCB3b3JzZSBvZmZlciBpbiB0aGUgc29ydGVkIGxpc3QKICAgIC8vICAgICAgdGhlIHdvcnNlIG9mZmVyIGlzIHRoZSBoaWdoZXIgb25lIGlmIGl0cyBhbiBhc2ssCiAgICAvLyAgICAgIGEgbG93ZXIgb25lIGlmIGl0cyBhIGJpZCBvZmZlciwKICAgIC8vICAgICAgYW5kIGluIGJvdGggY2FzZXMgdGhlIG5ld2VyIG9uZSBpZiB0aGV5J3JlIGVxdWFsLgogICAgZnVuY3Rpb24gZ2V0V29yc2VPZmZlcih1aW50IGlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9yYW5rW2lkXS5wcmV2OwogICAgfQoKICAgIC8vcmV0dXJuIHRoZSBuZXh0IGJldHRlciBvZmZlciBpbiB0aGUgc29ydGVkIGxpc3QKICAgIC8vICAgICAgdGhlIGJldHRlciBvZmZlciBpcyBpbiB0aGUgbG93ZXIgcHJpY2VkIG9uZSBpZiBpdHMgYW4gYXNrLAogICAgLy8gICAgICB0aGUgbmV4dCBoaWdoZXIgcHJpY2VkIG9uZSBpZiBpdHMgYSBiaWQgb2ZmZXIKICAgIC8vICAgICAgYW5kIGluIGJvdGggY2FzZXMgdGhlIG9sZGVyIG9uZSBpZiB0aGV5J3JlIGVxdWFsLgogICAgZnVuY3Rpb24gZ2V0QmV0dGVyT2ZmZXIodWludCBpZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewoKICAgICAgICByZXR1cm4gX3JhbmtbaWRdLm5leHQ7CiAgICB9CgogICAgLy9yZXR1cm4gdGhlIGFtb3VudCBvZiBiZXR0ZXIgb2ZmZXJzIGZvciBhIHRva2VuIHBhaXIKICAgIGZ1bmN0aW9uIGdldE9mZmVyQ291bnQoRVJDMjAgc2VsbF9nZW0sIEVSQzIwIGJ1eV9nZW0pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gX3NwYW5bc2VsbF9nZW1dW2J1eV9nZW1dOwogICAgfQoKICAgIC8vZ2V0IHRoZSBmaXJzdCB1bnNvcnRlZCBvZmZlciB0aGF0IHdhcyBpbnNlcnRlZCBieSBhIGNvbnRyYWN0CiAgICAvLyAgICAgIENvbnRyYWN0cyBjYW4ndCBjYWxjdWxhdGUgdGhlIGluc2VydGlvbiBwb3NpdGlvbiBvZiB0aGVpciBvZmZlciBiZWNhdXNlIGl0IGlzIG5vdCBhbiBPKDEpIG9wZXJhdGlvbi4KICAgIC8vICAgICAgVGhlaXIgb2ZmZXJzIGdldCBwdXQgaW4gdGhlIHVuc29ydGVkIGxpc3Qgb2Ygb2ZmZXJzLgogICAgLy8gICAgICBLZWVwZXJzIGNhbiBjYWxjdWxhdGUgdGhlIGluc2VydGlvbiBwb3NpdGlvbiBvZmZjaGFpbiBhbmQgcGFzcyBpdCB0byB0aGUgaW5zZXJ0KCkgZnVuY3Rpb24gdG8gaW5zZXJ0CiAgICAvLyAgICAgIHRoZSB1bnNvcnRlZCBvZmZlciBpbnRvIHRoZSBzb3J0ZWQgbGlzdC4gVW5zb3J0ZWQgb2ZmZXJzIHdpbGwgbm90IGJlIG1hdGNoZWQsIGJ1dCBjYW4gYmUgYm91Z2h0IHdpdGggYnV5KCkuCiAgICBmdW5jdGlvbiBnZXRGaXJzdFVuc29ydGVkT2ZmZXIoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9oZWFkOwogICAgfQoKICAgIC8vZ2V0IHRoZSBuZXh0IHVuc29ydGVkIG9mZmVyCiAgICAvLyAgICAgIENhbiBiZSB1c2VkIHRvIGN5Y2xlIHRocm91Z2ggYWxsIHRoZSB1bnNvcnRlZCBvZmZlcnMuCiAgICBmdW5jdGlvbiBnZXROZXh0VW5zb3J0ZWRPZmZlcih1aW50IGlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9uZWFyW2lkXTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc09mZmVyU29ydGVkKHVpbnQgaWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gX3JhbmtbaWRdLm5leHQgIT0gMAogICAgICAgICAgICAgICB8fCBfcmFua1tpZF0ucHJldiAhPSAwCiAgICAgICAgICAgICAgIHx8IF9iZXN0W29mZmVyc1tpZF0ucGF5X2dlbV1bb2ZmZXJzW2lkXS5idXlfZ2VtXSA9PSBpZDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsQWxsQW1vdW50KEVSQzIwIHBheV9nZW0sIHVpbnQgcGF5X2FtdCwgRVJDMjAgYnV5X2dlbSwgdWludCBtaW5fZmlsbF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludCBmaWxsX2FtdCkKICAgIHsKICAgICAgICB1aW50IG9mZmVySWQ7CiAgICAgICAgd2hpbGUgKHBheV9hbXQgPiAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy93aGlsZSB0aGVyZSBpcyBhbW91bnQgdG8gc2VsbAogICAgICAgICAgICBvZmZlcklkID0gZ2V0QmVzdE9mZmVyKGJ1eV9nZW0sIHBheV9nZW0pOyAgIC8vR2V0IHRoZSBiZXN0IG9mZmVyIGZvciB0aGUgdG9rZW4gcGFpcgogICAgICAgICAgICByZXF1aXJlKG9mZmVySWQgIT0gMCk7ICAgICAgICAgICAgICAgICAgICAgIC8vRmFpbHMgaWYgdGhlcmUgYXJlIG5vdCBtb3JlIG9mZmVycwoKICAgICAgICAgICAgLy8gVGhlcmUgaXMgYSBjaGFuY2UgdGhhdCBwYXlfYW10IGlzIHNtYWxsZXIgdGhhbiAxIHdlaSBvZiB0aGUgb3RoZXIgdG9rZW4KICAgICAgICAgICAgaWYgKHBheV9hbXQgKiAxIGV0aGVyIDwgd2RpdihvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCwgb2ZmZXJzW29mZmVySWRdLnBheV9hbXQpKSB7CiAgICAgICAgICAgICAgICBicmVhazsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9XZSBjb25zaWRlciB0aGF0IGFsbCBhbW91bnQgaXMgc29sZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwYXlfYW10ID49IG9mZmVyc1tvZmZlcklkXS5idXlfYW10KSB7ICAgICAgICAgICAgICAgICAgICAgICAvL0lmIGFtb3VudCB0byBzZWxsIGlzIGhpZ2hlciBvciBlcXVhbCB0aGFuIGN1cnJlbnQgb2ZmZXIgYW1vdW50IHRvIGJ1eQogICAgICAgICAgICAgICAgZmlsbF9hbXQgPSBhZGQoZmlsbF9hbXQsIG9mZmVyc1tvZmZlcklkXS5wYXlfYW10KTsgICAgICAgICAgLy9BZGQgYW1vdW50IGJvdWdodCB0byBhY3VtdWxhdG9yCiAgICAgICAgICAgICAgICBwYXlfYW10ID0gc3ViKHBheV9hbXQsIG9mZmVyc1tvZmZlcklkXS5idXlfYW10KTsgICAgICAgICAgICAvL0RlY3JlYXNlIGFtb3VudCB0byBzZWxsCiAgICAgICAgICAgICAgICB0YWtlKGJ5dGVzMzIob2ZmZXJJZCksIHVpbnQxMjgob2ZmZXJzW29mZmVySWRdLnBheV9hbXQpKTsgICAvL1dlIHRha2UgdGhlIHdob2xlIG9mZmVyCiAgICAgICAgICAgIH0gZWxzZSB7IC8vIGlmIGxvd2VyCiAgICAgICAgICAgICAgICB2YXIgYmF1eCA9IHJtdWwocGF5X2FtdCAqIDEwICoqIDksIHJkaXYob2ZmZXJzW29mZmVySWRdLnBheV9hbXQsIG9mZmVyc1tvZmZlcklkXS5idXlfYW10KSkgLyAxMCAqKiA5OwogICAgICAgICAgICAgICAgZmlsbF9hbXQgPSBhZGQoZmlsbF9hbXQsIGJhdXgpOyAgICAgICAgIC8vQWRkIGFtb3VudCBib3VnaHQgdG8gYWN1bXVsYXRvcgogICAgICAgICAgICAgICAgdGFrZShieXRlczMyKG9mZmVySWQpLCB1aW50MTI4KGJhdXgpKTsgIC8vV2UgdGFrZSB0aGUgcG9ydGlvbiBvZiB0aGUgb2ZmZXIgdGhhdCB3ZSBuZWVkCiAgICAgICAgICAgICAgICBwYXlfYW10ID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BbGwgYW1vdW50IGlzIHNvbGQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXF1aXJlKGZpbGxfYW10ID49IG1pbl9maWxsX2Ftb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5QWxsQW1vdW50KEVSQzIwIGJ1eV9nZW0sIHVpbnQgYnV5X2FtdCwgRVJDMjAgcGF5X2dlbSwgdWludCBtYXhfZmlsbF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludCBmaWxsX2FtdCkKICAgIHsKICAgICAgICB1aW50IG9mZmVySWQ7CiAgICAgICAgd2hpbGUgKGJ1eV9hbXQgPiAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9NZWFud2hpbGUgdGhlcmUgaXMgYW1vdW50IHRvIGJ1eQogICAgICAgICAgICBvZmZlcklkID0gZ2V0QmVzdE9mZmVyKGJ1eV9nZW0sIHBheV9nZW0pOyAgIC8vR2V0IHRoZSBiZXN0IG9mZmVyIGZvciB0aGUgdG9rZW4gcGFpcgogICAgICAgICAgICByZXF1aXJlKG9mZmVySWQgIT0gMCk7CgogICAgICAgICAgICAvLyBUaGVyZSBpcyBhIGNoYW5jZSB0aGF0IGJ1eV9hbXQgaXMgc21hbGxlciB0aGFuIDEgd2VpIG9mIHRoZSBvdGhlciB0b2tlbgogICAgICAgICAgICBpZiAoYnV5X2FtdCAqIDEgZXRoZXIgPCB3ZGl2KG9mZmVyc1tvZmZlcklkXS5wYXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCkpIHsKICAgICAgICAgICAgICAgIGJyZWFrOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1dlIGNvbnNpZGVyIHRoYXQgYWxsIGFtb3VudCBpcyBzb2xkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJ1eV9hbXQgPj0gb2ZmZXJzW29mZmVySWRdLnBheV9hbXQpIHsgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgYW1vdW50IHRvIGJ1eSBpcyBoaWdoZXIgb3IgZXF1YWwgdGhhbiBjdXJyZW50IG9mZmVyIGFtb3VudCB0byBzZWxsCiAgICAgICAgICAgICAgICBmaWxsX2FtdCA9IGFkZChmaWxsX2FtdCwgb2ZmZXJzW29mZmVySWRdLmJ1eV9hbXQpOyAgICAgICAgICAvL0FkZCBhbW91bnQgc29sZCB0byBhY3VtdWxhdG9yCiAgICAgICAgICAgICAgICBidXlfYW10ID0gc3ViKGJ1eV9hbXQsIG9mZmVyc1tvZmZlcklkXS5wYXlfYW10KTsgICAgICAgICAgICAvL0RlY3JlYXNlIGFtb3VudCB0byBidXkKICAgICAgICAgICAgICAgIHRha2UoYnl0ZXMzMihvZmZlcklkKSwgdWludDEyOChvZmZlcnNbb2ZmZXJJZF0ucGF5X2FtdCkpOyAgIC8vV2UgdGFrZSB0aGUgd2hvbGUgb2ZmZXIKICAgICAgICAgICAgfSBlbHNlIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgbG93ZXIKICAgICAgICAgICAgICAgIGZpbGxfYW10ID0gYWRkKGZpbGxfYW10LCBybXVsKGJ1eV9hbXQgKiAxMCAqKiA5LCByZGl2KG9mZmVyc1tvZmZlcklkXS5idXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0ucGF5X2FtdCkpIC8gMTAgKiogOSk7IC8vQWRkIGFtb3VudCBzb2xkIHRvIGFjdW11bGF0b3IKICAgICAgICAgICAgICAgIHRha2UoYnl0ZXMzMihvZmZlcklkKSwgdWludDEyOChidXlfYW10KSk7ICAgICAgICAgICAgICAgICAgIC8vV2UgdGFrZSB0aGUgcG9ydGlvbiBvZiB0aGUgb2ZmZXIgdGhhdCB3ZSBuZWVkCiAgICAgICAgICAgICAgICBidXlfYW10ID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0FsbCBhbW91bnQgaXMgYm91Z2h0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVxdWlyZShmaWxsX2FtdCA8PSBtYXhfZmlsbF9hbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJ1eUFtb3VudChFUkMyMCBidXlfZ2VtLCBFUkMyMCBwYXlfZ2VtLCB1aW50IHBheV9hbXQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGZpbGxfYW10KSB7CiAgICAgICAgdmFyIG9mZmVySWQgPSBnZXRCZXN0T2ZmZXIoYnV5X2dlbSwgcGF5X2dlbSk7ICAgICAgICAgICAvL0dldCBiZXN0IG9mZmVyIGZvciB0aGUgdG9rZW4gcGFpcgogICAgICAgIHdoaWxlIChwYXlfYW10ID4gb2ZmZXJzW29mZmVySWRdLmJ1eV9hbXQpIHsKICAgICAgICAgICAgZmlsbF9hbXQgPSBhZGQoZmlsbF9hbXQsIG9mZmVyc1tvZmZlcklkXS5wYXlfYW10KTsgIC8vQWRkIGFtb3VudCB0byBidXkgYWNjdW11bGF0b3IKICAgICAgICAgICAgcGF5X2FtdCA9IHN1YihwYXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0uYnV5X2FtdCk7ICAgIC8vRGVjcmVhc2UgYW1vdW50IHRvIHBheQogICAgICAgICAgICBpZiAocGF5X2FtdCA+IDApIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB3ZSBzdGlsbCBuZWVkIG1vcmUgb2ZmZXJzCiAgICAgICAgICAgICAgICBvZmZlcklkID0gZ2V0V29yc2VPZmZlcihvZmZlcklkKTsgICAgICAgICAgICAgICAvL1dlIGxvb2sgZm9yIHRoZSBuZXh0IGJlc3Qgb2ZmZXIKICAgICAgICAgICAgICAgIHJlcXVpcmUob2ZmZXJJZCAhPSAwKTsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRmFpbHMgaWYgdGhlcmUgYXJlIG5vdCBlbm91Z2ggb2ZmZXJzIHRvIGNvbXBsZXRlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlsbF9hbXQgPSBhZGQoZmlsbF9hbXQsIHJtdWwocGF5X2FtdCAqIDEwICoqIDksIHJkaXYob2ZmZXJzW29mZmVySWRdLnBheV9hbXQsIG9mZmVyc1tvZmZlcklkXS5idXlfYW10KSkgLyAxMCAqKiA5KTsgLy9BZGQgcHJvcG9ydGlvbmFsIGFtb3VudCBvZiBsYXN0IG9mZmVyIHRvIGJ1eSBhY2N1bXVsYXRvcgogICAgfQoKICAgIGZ1bmN0aW9uIGdldFBheUFtb3VudChFUkMyMCBwYXlfZ2VtLCBFUkMyMCBidXlfZ2VtLCB1aW50IGJ1eV9hbXQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGZpbGxfYW10KSB7CiAgICAgICAgdmFyIG9mZmVySWQgPSBnZXRCZXN0T2ZmZXIoYnV5X2dlbSwgcGF5X2dlbSk7ICAgICAgICAgICAvL0dldCBiZXN0IG9mZmVyIGZvciB0aGUgdG9rZW4gcGFpcgogICAgICAgIHdoaWxlIChidXlfYW10ID4gb2ZmZXJzW29mZmVySWRdLnBheV9hbXQpIHsKICAgICAgICAgICAgZmlsbF9hbXQgPSBhZGQoZmlsbF9hbXQsIG9mZmVyc1tvZmZlcklkXS5idXlfYW10KTsgIC8vQWRkIGFtb3VudCB0byBwYXkgYWNjdW11bGF0b3IKICAgICAgICAgICAgYnV5X2FtdCA9IHN1YihidXlfYW10LCBvZmZlcnNbb2ZmZXJJZF0ucGF5X2FtdCk7ICAgIC8vRGVjcmVhc2UgYW1vdW50IHRvIGJ1eQogICAgICAgICAgICBpZiAoYnV5X2FtdCA+IDApIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9JZiB3ZSBzdGlsbCBuZWVkIG1vcmUgb2ZmZXJzCiAgICAgICAgICAgICAgICBvZmZlcklkID0gZ2V0V29yc2VPZmZlcihvZmZlcklkKTsgICAgICAgICAgICAgICAvL1dlIGxvb2sgZm9yIHRoZSBuZXh0IGJlc3Qgb2ZmZXIKICAgICAgICAgICAgICAgIHJlcXVpcmUob2ZmZXJJZCAhPSAwKTsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRmFpbHMgaWYgdGhlcmUgYXJlIG5vdCBlbm91Z2ggb2ZmZXJzIHRvIGNvbXBsZXRlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlsbF9hbXQgPSBhZGQoZmlsbF9hbXQsIHJtdWwoYnV5X2FtdCAqIDEwICoqIDksIHJkaXYob2ZmZXJzW29mZmVySWRdLmJ1eV9hbXQsIG9mZmVyc1tvZmZlcklkXS5wYXlfYW10KSkgLyAxMCAqKiA5KTsgLy9BZGQgcHJvcG9ydGlvbmFsIGFtb3VudCBvZiBsYXN0IG9mZmVyIHRvIHBheSBhY2N1bXVsYXRvcgogICAgfQoKICAgIC8vIC0tLS0gSW50ZXJuYWwgRnVuY3Rpb25zIC0tLS0gLy8KCiAgICBmdW5jdGlvbiBfYnV5cyh1aW50IGlkLCB1aW50IGFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShidXlFbmFibGVkKTsKCiAgICAgICAgaWYgKGFtb3VudCA9PSBvZmZlcnNbaWRdLnBheV9hbXQgJiYgaXNPZmZlclNvcnRlZChpZCkpIHsKICAgICAgICAgICAgLy9vZmZlcnNbaWRdIG11c3QgYmUgcmVtb3ZlZCBmcm9tIHNvcnRlZCBsaXN0IGJlY2F1c2UgYWxsIG9mIGl0IGlzIGJvdWdodAogICAgICAgICAgICBfdW5zb3J0KGlkKTsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShzdXBlci5idXkoaWQsIGFtb3VudCkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vZmluZCB0aGUgaWQgb2YgdGhlIG5leHQgaGlnaGVyIG9mZmVyIGFmdGVyIG9mZmVyc1tpZF0KICAgIGZ1bmN0aW9uIF9maW5kKHVpbnQgaWQpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXF1aXJlKCBpZCA+IDAgKTsKCiAgICAgICAgYWRkcmVzcyBidXlfZ2VtID0gYWRkcmVzcyhvZmZlcnNbaWRdLmJ1eV9nZW0pOwogICAgICAgIGFkZHJlc3MgcGF5X2dlbSA9IGFkZHJlc3Mob2ZmZXJzW2lkXS5wYXlfZ2VtKTsKICAgICAgICB1aW50IHRvcCA9IF9iZXN0W3BheV9nZW1dW2J1eV9nZW1dOwogICAgICAgIHVpbnQgb2xkX3RvcCA9IDA7CgogICAgICAgIC8vIEZpbmQgdGhlIGxhcmdlci10aGFuLWlkIG9yZGVyIHdob3NlIHN1Y2Nlc3NvciBpcyBsZXNzLXRoYW4taWQuCiAgICAgICAgd2hpbGUgKHRvcCAhPSAwICYmIF9pc1ByaWNlZEx0T3JFcShpZCwgdG9wKSkgewogICAgICAgICAgICBvbGRfdG9wID0gdG9wOwogICAgICAgICAgICB0b3AgPSBfcmFua1t0b3BdLnByZXY7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvbGRfdG9wOwogICAgfQoKICAgIC8vZmluZCB0aGUgaWQgb2YgdGhlIG5leHQgaGlnaGVyIG9mZmVyIGFmdGVyIG9mZmVyc1tpZF0KICAgIGZ1bmN0aW9uIF9maW5kcG9zKHVpbnQgaWQsIHVpbnQgcG9zKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXF1aXJlKGlkID4gMCk7CgogICAgICAgIC8vIExvb2sgZm9yIGFuIGFjdGl2ZSBvcmRlci4KICAgICAgICB3aGlsZSAocG9zICE9IDAgJiYgIWlzQWN0aXZlKHBvcykpIHsKICAgICAgICAgICAgcG9zID0gX3JhbmtbcG9zXS5wcmV2OwogICAgICAgIH0KCiAgICAgICAgaWYgKHBvcyA9PSAwKSB7CiAgICAgICAgICAgIC8vaWYgd2UgZ290IHRvIHRoZSBlbmQgb2YgbGlzdCB3aXRob3V0IGEgc2luZ2xlIGFjdGl2ZSBvZmZlcgogICAgICAgICAgICByZXR1cm4gX2ZpbmQoaWQpOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpZiB3ZSBkaWQgZmluZCBhIG5lYXJieSBhY3RpdmUgb2ZmZXIKICAgICAgICAgICAgLy8gV2FsayB0aGUgb3JkZXIgYm9vayBkb3duIGZyb20gdGhlcmUuLi4KICAgICAgICAgICAgaWYoX2lzUHJpY2VkTHRPckVxKGlkLCBwb3MpKSB7CiAgICAgICAgICAgICAgICB1aW50IG9sZF9wb3M7CgogICAgICAgICAgICAgICAgLy8gR3VhcmFudGVlZCB0byBydW4gYXQgbGVhc3Qgb25jZSBiZWNhdXNlIG9mCiAgICAgICAgICAgICAgICAvLyB0aGUgcHJpb3IgaWYgc3RhdGVtZW50cy4KICAgICAgICAgICAgICAgIHdoaWxlIChwb3MgIT0gMCAmJiBfaXNQcmljZWRMdE9yRXEoaWQsIHBvcykpIHsKICAgICAgICAgICAgICAgICAgICBvbGRfcG9zID0gcG9zOwogICAgICAgICAgICAgICAgICAgIHBvcyA9IF9yYW5rW3Bvc10ucHJldjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBvbGRfcG9zOwoKICAgICAgICAgICAgLy8gLi4ub3Igd2FsayBpdCB1cC4KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHdoaWxlIChwb3MgIT0gMCAmJiAhX2lzUHJpY2VkTHRPckVxKGlkLCBwb3MpKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zID0gX3JhbmtbcG9zXS5uZXh0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHBvczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvL3JldHVybiB0cnVlIGlmIG9mZmVyc1tsb3ddIHByaWNlZCBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gb2ZmZXJzW2hpZ2hdCiAgICBmdW5jdGlvbiBfaXNQcmljZWRMdE9yRXEoCiAgICAgICAgdWludCBsb3csICAgLy9sb3dlciBwcmljZWQgb2ZmZXIncyBpZAogICAgICAgIHVpbnQgaGlnaCAgIC8vaGlnaGVyIHByaWNlZCBvZmZlcidzIGlkCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gbXVsKG9mZmVyc1tsb3ddLmJ1eV9hbXQsIG9mZmVyc1toaWdoXS5wYXlfYW10KQogICAgICAgICAgPj0gbXVsKG9mZmVyc1toaWdoXS5idXlfYW10LCBvZmZlcnNbbG93XS5wYXlfYW10KTsKICAgIH0KCiAgICAvL3RoZXNlIHZhcmlhYmxlcyBhcmUgZ2xvYmFsIG9ubHkgYmVjYXVzZSBvZiBzb2xpZGl0eSBsb2NhbCB2YXJpYWJsZSBsaW1pdAoKICAgIC8vbWF0Y2ggb2ZmZXJzIHdpdGggdGFrZXIgb2ZmZXIsIGFuZCBleGVjdXRlIHRva2VuIHRyYW5zYWN0aW9ucwogICAgZnVuY3Rpb24gX21hdGNobygKICAgICAgICB1aW50IHRfcGF5X2FtdCwgICAgLy90YWtlciBzZWxsIGhvdyBtdWNoCiAgICAgICAgRVJDMjAgdF9wYXlfZ2VtLCAgIC8vdGFrZXIgc2VsbCB3aGljaCB0b2tlbgogICAgICAgIHVpbnQgdF9idXlfYW10LCAgICAvL3Rha2VyIGJ1eSBob3cgbXVjaAogICAgICAgIEVSQzIwIHRfYnV5X2dlbSwgICAvL3Rha2VyIGJ1eSB3aGljaCB0b2tlbgogICAgICAgIHVpbnQgcG9zLCAgICAgICAgICAvL3Bvc2l0aW9uIGlkCiAgICAgICAgYm9vbCByb3VuZGluZyAgICAgIC8vbWF0Y2ggImNsb3NlIGVub3VnaCIgb3JkZXJzPwogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludCBpZCkKICAgIHsKICAgICAgICB1aW50IGJlc3RfbWFrZXJfaWQ7ICAgIC8vaGlnaGVzdCBtYWtlciBpZAogICAgICAgIHVpbnQgdF9idXlfYW10X29sZDsgICAgLy90YWtlciBidXkgaG93IG11Y2ggc2F2ZWQKICAgICAgICB1aW50IG1fYnV5X2FtdDsgICAgICAgIC8vbWFrZXIgb2ZmZXIgd2FudHMgdG8gYnV5IHRoaXMgbXVjaCB0b2tlbgogICAgICAgIHVpbnQgbV9wYXlfYW10OyAgICAgICAgLy9tYWtlciBvZmZlciB3YW50cyB0byBzZWxsIHRoaXMgbXVjaCB0b2tlbgoKICAgICAgICAvLyB0aGVyZSBpcyBhdCBsZWFzdCBvbmUgb2ZmZXIgc3RvcmVkIGZvciB0b2tlbiBwYWlyCiAgICAgICAgd2hpbGUgKF9iZXN0W3RfYnV5X2dlbV1bdF9wYXlfZ2VtXSA+IDApIHsKICAgICAgICAgICAgYmVzdF9tYWtlcl9pZCA9IF9iZXN0W3RfYnV5X2dlbV1bdF9wYXlfZ2VtXTsKICAgICAgICAgICAgbV9idXlfYW10ID0gb2ZmZXJzW2Jlc3RfbWFrZXJfaWRdLmJ1eV9hbXQ7CiAgICAgICAgICAgIG1fcGF5X2FtdCA9IG9mZmVyc1tiZXN0X21ha2VyX2lkXS5wYXlfYW10OwoKICAgICAgICAgICAgLy8gVWdseSBoYWNrIHRvIHdvcmsgYXJvdW5kIHJvdW5kaW5nIGVycm9ycy4gQmFzZWQgb24gdGhlIGlkZWEgdGhhdAogICAgICAgICAgICAvLyB0aGUgZnVydGhlc3QgdGhlIGFtb3VudHMgY2FuIHN0cmF5IGZyb20gdGhlaXIgInRydWUiIHZhbHVlcyBpcyAxLgogICAgICAgICAgICAvLyBFcmdvIHRoZSB3b3JzdCBjYXNlIGhhcyB0X3BheV9hbXQgYW5kIG1fcGF5X2FtdCBhdCArMSBhd2F5IGZyb20KICAgICAgICAgICAgLy8gdGhlaXIgImNvcnJlY3QiIHZhbHVlcyBhbmQgbV9idXlfYW10IGFuZCB0X2J1eV9hbXQgYXQgLTEuCiAgICAgICAgICAgIC8vIFNpbmNlIChjIC0gMSkgKiAoZCAtIDEpID4gKGEgKyAxKSAqIChiICsgMSkgaXMgZXF1aXZhbGVudCB0bwogICAgICAgICAgICAvLyBjICogZCA+IGEgKiBiICsgYSArIGIgKyBjICsgZCwgd2Ugd3JpdGUuLi4KICAgICAgICAgICAgaWYgKG11bChtX2J1eV9hbXQsIHRfYnV5X2FtdCkgPiBtdWwodF9wYXlfYW10LCBtX3BheV9hbXQpICsKICAgICAgICAgICAgICAgIChyb3VuZGluZyA/IG1fYnV5X2FtdCArIHRfYnV5X2FtdCArIHRfcGF5X2FtdCArIG1fcGF5X2FtdCA6IDApKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBeIFRoZSBgcm91bmRpbmdgIHBhcmFtZXRlciBpcyBhIGNvbXByb21pc2UgYm9ybmUgb2YgYSBjb3VwbGUgZGF5cwogICAgICAgICAgICAvLyBvZiBkaXNjdXNzaW9uLgoKICAgICAgICAgICAgYnV5KGJlc3RfbWFrZXJfaWQsIG1pbihtX3BheV9hbXQsIHRfYnV5X2FtdCkpOwogICAgICAgICAgICB0X2J1eV9hbXRfb2xkID0gdF9idXlfYW10OwogICAgICAgICAgICB0X2J1eV9hbXQgPSBzdWIodF9idXlfYW10LCBtaW4obV9wYXlfYW10LCB0X2J1eV9hbXQpKTsKICAgICAgICAgICAgdF9wYXlfYW10ID0gbXVsKHRfYnV5X2FtdCwgdF9wYXlfYW10KSAvIHRfYnV5X2FtdF9vbGQ7CgogICAgICAgICAgICBpZiAodF9wYXlfYW10ID09IDAgfHwgdF9idXlfYW10ID09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodF9idXlfYW10ID4gMCAmJiB0X3BheV9hbXQgPiAwKSB7CiAgICAgICAgICAgIC8vbmV3IG9mZmVyIHNob3VsZCBiZSBjcmVhdGVkCiAgICAgICAgICAgIGlkID0gc3VwZXIub2ZmZXIodF9wYXlfYW10LCB0X3BheV9nZW0sIHRfYnV5X2FtdCwgdF9idXlfZ2VtKTsKICAgICAgICAgICAgLy9pbnNlcnQgb2ZmZXIgaW50byB0aGUgc29ydGVkIGxpc3QKICAgICAgICAgICAgX3NvcnQoaWQsIHBvcyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIE1ha2UgYSBuZXcgb2ZmZXIgd2l0aG91dCBwdXR0aW5nIGl0IGluIHRoZSBzb3J0ZWQgbGlzdC4KICAgIC8vIFRha2VzIGZ1bmRzIGZyb20gdGhlIGNhbGxlciBpbnRvIG1hcmtldCBlc2Nyb3cuCiAgICAvLyAqKioqQXZhaWxhYmxlIHRvIGF1dGhvcml6ZWQgY29udHJhY3RzIG9ubHkhKioqKioqKioqKgogICAgLy8gS2VlcGVycyBzaG91bGQgY2FsbCBpbnNlcnQoaWQscG9zKSB0byBwdXQgb2ZmZXIgaW4gdGhlIHNvcnRlZCBsaXN0LgogICAgZnVuY3Rpb24gX29mZmVydSgKICAgICAgICB1aW50IHBheV9hbXQsICAgICAgLy9tYWtlciAoYXNrKSBzZWxsIGhvdyBtdWNoCiAgICAgICAgRVJDMjAgcGF5X2dlbSwgICAgIC8vbWFrZXIgKGFzaykgc2VsbCB3aGljaCB0b2tlbgogICAgICAgIHVpbnQgYnV5X2FtdCwgICAgICAvL21ha2VyIChhc2spIGJ1eSBob3cgbXVjaAogICAgICAgIEVSQzIwIGJ1eV9nZW0gICAgICAvL21ha2VyIChhc2spIGJ1eSB3aGljaCB0b2tlbgogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgLypOT1Qgc3luY2hyb25pemVkISEhICovCiAgICAgICAgcmV0dXJucyAodWludCBpZCkKICAgIHsKICAgICAgICByZXF1aXJlKF9kdXN0W3BheV9nZW1dIDw9IHBheV9hbXQpOwogICAgICAgIGlkID0gc3VwZXIub2ZmZXIocGF5X2FtdCwgcGF5X2dlbSwgYnV5X2FtdCwgYnV5X2dlbSk7CiAgICAgICAgX25lYXJbaWRdID0gX2hlYWQ7CiAgICAgICAgX2hlYWQgPSBpZDsKICAgICAgICBMb2dVbnNvcnRlZE9mZmVyKGlkKTsKICAgIH0KCiAgICAvL3B1dCBvZmZlciBpbnRvIHRoZSBzb3J0ZWQgbGlzdAogICAgZnVuY3Rpb24gX3NvcnQoCiAgICAgICAgdWludCBpZCwgICAgLy9tYWtlciAoYXNrKSBpZAogICAgICAgIHVpbnQgcG9zICAgIC8vcG9zaXRpb24gdG8gaW5zZXJ0IGludG8KICAgICkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHJlcXVpcmUoaXNBY3RpdmUoaWQpKTsKCiAgICAgICAgYWRkcmVzcyBidXlfZ2VtID0gYWRkcmVzcyhvZmZlcnNbaWRdLmJ1eV9nZW0pOwogICAgICAgIGFkZHJlc3MgcGF5X2dlbSA9IGFkZHJlc3Mob2ZmZXJzW2lkXS5wYXlfZ2VtKTsKICAgICAgICB1aW50IHByZXZfaWQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21ha2VyIChhc2spIGlkCgogICAgICAgIGlmIChwb3MgPT0gMCB8fCAhaXNPZmZlclNvcnRlZChwb3MpKSB7CiAgICAgICAgICAgIHBvcyA9IF9maW5kKGlkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwb3MgPSBfZmluZHBvcyhpZCwgcG9zKTsKCgkJCQkJCS8vaWYgdXNlciBoYXMgZW50ZXJlZCBhIGBwb3NgIHRoYXQgYmVsb25ncyB0byBhbm90aGVyIGN1cnJlbmN5IHBhaXIKCQkJCQkJLy93ZSBzdGFydCBmcm9tIHNjcmF0Y2gKCQkJCQkJaWYocG9zICE9IDAgJiYgKG9mZmVyc1twb3NdLnBheV9nZW0gIT0gb2ZmZXJzW2lkXS5wYXlfZ2VtCgkJCQkJCQkJCQkJfHwgb2ZmZXJzW3Bvc10uYnV5X2dlbSAhPSBvZmZlcnNbaWRdLmJ1eV9nZW0pKQoJCQkJCQl7CgkJCQkJCQkJcG9zID0gMDsKCQkJCQkJCQlwb3M9X2ZpbmQoaWQpOwoJCQkJCQl9CiAgICAgICAgfQoKCiAgICAgICAgLy9yZXF1aXJlbWVudCBiZWxvdyBpcyBzYXRpc2ZpZWQgYnkgc3RhdGVtZW50cyBhYm92ZQoJICAgICAgLy9yZXF1aXJlKHBvcyA9PSAwIHx8IGlzT2ZmZXJTb3J0ZWQocG9zKSk7CgoKICAgICAgICBpZiAocG9zICE9IDApIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL29mZmVyc1tpZF0gaXMgbm90IHRoZSBoaWdoZXN0IG9mZmVyCiAgICAgICAgICAgIC8vcmVxdWlyZW1lbnQgYmVsb3cgaXMgc2F0aXNmaWVkIGJ5IHN0YXRlbWVudHMgYWJvdmUKICAgICAgICAgICAgLy9yZXF1aXJlKF9pc1ByaWNlZEx0T3JFcShpZCwgcG9zKSk7CiAgICAgICAgICAgIHByZXZfaWQgPSBfcmFua1twb3NdLnByZXY7CiAgICAgICAgICAgIF9yYW5rW3Bvc10ucHJldiA9IGlkOwogICAgICAgICAgICBfcmFua1tpZF0ubmV4dCA9IHBvczsKICAgICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL29mZmVyc1tpZF0gaXMgdGhlIGhpZ2hlc3Qgb2ZmZXIKICAgICAgICAgICAgcHJldl9pZCA9IF9iZXN0W3BheV9nZW1dW2J1eV9nZW1dOwogICAgICAgICAgICBfYmVzdFtwYXlfZ2VtXVtidXlfZ2VtXSA9IGlkOwogICAgICAgIH0KCiAgICAgICAgaWYgKHByZXZfaWQgIT0gMCkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2lmIGxvd2VyIG9mZmVyIGRvZXMgZXhpc3QKICAgICAgICAgICAgLy9yZXF1aXJlbWVudCBiZWxvdyBpcyBzYXRpc2ZpZWQgYnkgc3RhdGVtZW50cyBhYm92ZQogICAgICAgICAgICAvL3JlcXVpcmUoIV9pc1ByaWNlZEx0T3JFcShpZCwgcHJldl9pZCkpOwogICAgICAgICAgICBfcmFua1twcmV2X2lkXS5uZXh0ID0gaWQ7CiAgICAgICAgICAgIF9yYW5rW2lkXS5wcmV2ID0gcHJldl9pZDsKICAgICAgICB9CgogICAgICAgIF9zcGFuW3BheV9nZW1dW2J1eV9nZW1dKys7CiAgICAgICAgTG9nU29ydGVkT2ZmZXIoaWQpOwogICAgfQoKICAgIC8vIFJlbW92ZSBvZmZlciBmcm9tIHRoZSBzb3J0ZWQgbGlzdCAoZG9lcyBub3QgY2FuY2VsIG9mZmVyKQogICAgZnVuY3Rpb24gX3Vuc29ydCgKICAgICAgICB1aW50IGlkICAgIC8vaWQgb2YgbWFrZXIgKGFzaykgb2ZmZXIgdG8gcmVtb3ZlIGZyb20gc29ydGVkIGxpc3QKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYWRkcmVzcyBidXlfZ2VtID0gYWRkcmVzcyhvZmZlcnNbaWRdLmJ1eV9nZW0pOwogICAgICAgIGFkZHJlc3MgcGF5X2dlbSA9IGFkZHJlc3Mob2ZmZXJzW2lkXS5wYXlfZ2VtKTsKICAgICAgICByZXF1aXJlKF9zcGFuW3BheV9nZW1dW2J1eV9nZW1dID4gMCk7CgogICAgICAgIHJlcXVpcmUoX3JhbmtbaWRdLmRlbGIgPT0gMCAmJiAgICAgICAgICAgICAgICAgICAgLy9hc3NlcnQgaWQgaXMgaW4gdGhlIHNvcnRlZCBsaXN0CiAgICAgICAgICAgICAgICAgaXNPZmZlclNvcnRlZChpZCkpOwoKICAgICAgICBpZiAoaWQgIT0gX2Jlc3RbcGF5X2dlbV1bYnV5X2dlbV0pIHsgICAgICAgICAgICAgIC8vIG9mZmVyc1tpZF0gaXMgbm90IHRoZSBoaWdoZXN0IG9mZmVyCiAgICAgICAgICAgIHJlcXVpcmUoX3JhbmtbX3JhbmtbaWRdLm5leHRdLnByZXYgPT0gaWQpOwogICAgICAgICAgICBfcmFua1tfcmFua1tpZF0ubmV4dF0ucHJldiA9IF9yYW5rW2lkXS5wcmV2OwogICAgICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9vZmZlcnNbaWRdIGlzIHRoZSBoaWdoZXN0IG9mZmVyCiAgICAgICAgICAgIF9iZXN0W3BheV9nZW1dW2J1eV9nZW1dID0gX3JhbmtbaWRdLnByZXY7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3JhbmtbaWRdLnByZXYgIT0gMCkgeyAgICAgICAgICAgICAgICAgICAgICAgIC8vb2ZmZXJzW2lkXSBpcyBub3QgdGhlIGxvd2VzdCBvZmZlcgogICAgICAgICAgICByZXF1aXJlKF9yYW5rW19yYW5rW2lkXS5wcmV2XS5uZXh0ID09IGlkKTsKICAgICAgICAgICAgX3JhbmtbX3JhbmtbaWRdLnByZXZdLm5leHQgPSBfcmFua1tpZF0ubmV4dDsKICAgICAgICB9CgogICAgICAgIF9zcGFuW3BheV9nZW1dW2J1eV9nZW1dLS07CiAgICAgICAgX3JhbmtbaWRdLmRlbGIgPSBibG9jay5udW1iZXI7ICAgICAgICAgICAgICAgICAgICAvL21hcmsgX3JhbmtbaWRdIGZvciBkZWxldGlvbgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vSGlkZSBvZmZlciBmcm9tIHRoZSB1bnNvcnRlZCBvcmRlciBib29rIChkb2VzIG5vdCBjYW5jZWwgb2ZmZXIpCiAgICBmdW5jdGlvbiBfaGlkZSgKICAgICAgICB1aW50IGlkICAgICAvL2lkIG9mIG1ha2VyIG9mZmVyIHRvIHJlbW92ZSBmcm9tIHVuc29ydGVkIGxpc3QKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdWludCB1aWQgPSBfaGVhZDsgICAgICAgICAgICAgICAvL2lkIG9mIGFuIG9mZmVyIGluIHVuc29ydGVkIG9mZmVycyBsaXN0CiAgICAgICAgdWludCBwcmUgPSB1aWQ7ICAgICAgICAgICAgICAgICAvL2lkIG9mIHByZXZpb3VzIG9mZmVyIGluIHVuc29ydGVkIG9mZmVycyBsaXN0CgogICAgICAgIHJlcXVpcmUoIWlzT2ZmZXJTb3J0ZWQoaWQpKTsgICAgLy9tYWtlIHN1cmUgb2ZmZXIgaWQgaXMgbm90IGluIHNvcnRlZCBvZmZlcnMgbGlzdAoKICAgICAgICBpZiAoX2hlYWQgPT0gaWQpIHsgICAgICAgICAgICAgIC8vY2hlY2sgaWYgb2ZmZXIgaXMgZmlyc3Qgb2ZmZXIgaW4gdW5zb3J0ZWQgb2ZmZXJzIGxpc3QKICAgICAgICAgICAgX2hlYWQgPSBfbmVhcltpZF07ICAgICAgICAgIC8vc2V0IGhlYWQgdG8gbmV3IGZpcnN0IHVuc29ydGVkIG9mZmVyCiAgICAgICAgICAgIF9uZWFyW2lkXSA9IDA7ICAgICAgICAgICAgICAvL2RlbGV0ZSBvcmRlciBmcm9tIHVuc29ydGVkIG9yZGVyIGxpc3QKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHdoaWxlICh1aWQgPiAwICYmIHVpZCAhPSBpZCkgeyAgLy9maW5kIG9mZmVyIGluIHVuc29ydGVkIG9yZGVyIGxpc3QKICAgICAgICAgICAgcHJlID0gdWlkOwogICAgICAgICAgICB1aWQgPSBfbmVhclt1aWRdOwogICAgICAgIH0KICAgICAgICBpZiAodWlkICE9IGlkKSB7ICAgICAgICAgICAgICAgIC8vZGlkIG5vdCBmaW5kIG9mZmVyIGlkIGluIHVuc29ydGVkIG9mZmVycyBsaXN0CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgX25lYXJbcHJlXSA9IF9uZWFyW2lkXTsgICAgICAgICAvL3NldCBwcmV2aW91cyB1bnNvcnRlZCBvZmZlciB0byBwb2ludCB0byBvZmZlciBhZnRlciBvZmZlciBpZAogICAgICAgIF9uZWFyW2lkXSA9IDA7ICAgICAgICAgICAgICAgICAgLy9kZWxldGUgb3JkZXIgZnJvbSB1bnNvcnRlZCBvcmRlciBsaXN0CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0='.
	

]
