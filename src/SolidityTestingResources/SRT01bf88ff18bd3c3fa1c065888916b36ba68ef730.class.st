Class {
	#name : #SRT01bf88ff18bd3c3fa1c065888916b36ba68ef730,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT01bf88ff18bd3c3fa1c065888916b36ba68ef730 >> base64 [
	^ 'LyoqCiAqIFNhZmUgdW5zaWduZWQgc2FmZSBtYXRoLgogKgogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQogKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbAogKgogKiBNYWludGFpbmVkIGhlcmUgdW50aWwgbWVyZ2VkIHRvIG1haW5saW5lIHplcHBlbGluLXNvbGlkaXR5LgogKgogKi8KbGlicmFyeSBTYWZlTWF0aExpYiB7CgogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIHByaXZhdGUgewogICAgaWYgKCFhc3NlcnRpb24pIHRocm93OwogIH0KfQoKCgoKLyoKICogT3duYWJsZQogKgogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuCiAqIFByb3ZpZGVzIG9ubHlPd25lciBtb2RpZmllciwgd2hpY2ggcHJldmVudHMgZnVuY3Rpb24gZnJvbSBydW5uaW5nIGlmIGl0IGlzIGNhbGxlZCBieSBhbnlvbmUgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgIHRocm93OwogICAgfQogICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCgovKgogKiBIYWx0YWJsZQogKgogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLgogKgogKgogKiBPcmlnaW5hbGx5IGVudmlzaW9uZWQgaW4gRmlyc3RCbG9vZCBJQ08gY29udHJhY3QuCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsKICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICBpZiAoaGFsdGVkKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaWYgKCFoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBoYWx0ZWQgPSB0cnVlOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgfQoKfQoKCi8qKgogKiBJbnRlcmZhY2UgZm9yIGRlZmluaW5nIGNyb3dkc2FsZSBwcmljaW5nLgogKi8KY29udHJhY3QgUHJpY2luZ1N0cmF0ZWd5IHsKCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8KICBmdW5jdGlvbiBpc1ByaWNpbmdTdHJhdGVneSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKiBTZWxmIGNoZWNrIGlmIGFsbCByZWZlcmVuY2VzIGFyZSBjb3JyZWN0bHkgc2V0LgogICAqCiAgICogQ2hlY2tzIHRoYXQgcHJpY2luZyBzdHJhdGVneSBtYXRjaGVzIGNyb3dkc2FsZSBwYXJhbWV0ZXJzLgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4KICAgKgogICAqCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXIKICAgKiBAcGFyYW0gd2VpUmFpc2VkIC0gaG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHRoaXMgZmFyCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcwogICAqIEByZXR1cm4gQW1vdW50IG9mIHRva2VucyB0aGUgaW52ZXN0b3IgcmVjZWl2ZXMKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOwp9CgoKLyoqCiAqIEZpbmFsaXplIGFnZW50IGRlZmluZXMgd2hhdCBoYXBwZW5zIGF0IHRoZSBlbmQgb2Ygc3VjY2VzZWZ1bCBjcm93ZHNhbGUuCiAqCiAqIC0gQWxsb2NhdGUgdG9rZW5zIGZvciBmb3VuZGVycywgYm91bnRpZXMgYW5kIGNvbW11bml0eQogKiAtIE1ha2UgdG9rZW5zIHRyYW5zZmVyYWJsZQogKiAtIGV0Yy4KICovCmNvbnRyYWN0IEZpbmFsaXplQWdlbnQgewoKICBmdW5jdGlvbiBpc0ZpbmFsaXplQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBjYW4gcnVuIGZpbmFsaXplQ3Jvd2RzYWxlKCkgcHJvcGVybHkuCiAgICoKICAgKiBUaGlzIGlzIGEgc2FmZXR5IGNoZWNrIGZ1bmN0aW9uIHRoYXQgZG9lc24ndCBhbGxvdyBjcm93ZHNhbGUgdG8gYmVnaW4KICAgKiB1bmxlc3MgdGhlIGZpbmFsaXplciBoYXMgYmVlbiBzZXQgdXAgcHJvcGVybHkuCiAgICovCiAgZnVuY3Rpb24gaXNTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwoKICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoKTsKCn0KCgoKCi8qCiAqIEVSQzIwIGludGVyZmFjZQogKiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgoKLyoqCiAqIEEgdG9rZW4gdGhhdCBkZWZpbmVzIGZyYWN0aW9uYWwgdW5pdHMgYXMgZGVjaW1hbHMuCiAqLwpjb250cmFjdCBGcmFjdGlvbmFsRVJDMjAgaXMgRVJDMjAgewoKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKCn0KCgoKLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGUKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZAogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZAogKiAtIGRpZmZlcmVudCBwcmljaW5nIHN0cmF0ZWdpZXMKICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgaXMgSGFsdGFibGUgewoKICAvKiBNYXggaW52ZXN0bWVudCBjb3VudCB3aGVuIHdlIGFyZSBzdGlsbCBhbGxvd2VkIHRvIGNoYW5nZSB0aGUgbXVsdGlzaWcgYWRkcmVzcyAqLwogIHVpbnQgcHVibGljIE1BWF9JTlZFU1RNRU5UU19CRUZPUkVfTVVMVElTSUdfQ0hBTkdFID0gNTsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIEZyYWN0aW9uYWxFUkMyMCBwdWJsaWMgdG9rZW47CgogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovCiAgUHJpY2luZ1N0cmF0ZWd5IHB1YmxpYyBwcmljaW5nU3RyYXRlZ3k7CgogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLwogIEZpbmFsaXplQWdlbnQgcHVibGljIGZpbmFsaXplQWdlbnQ7CgogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLwogIHVpbnQgcHVibGljIG1pbmltdW1GdW5kaW5nR29hbDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwoKICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovCiAgdWludCBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50ID0gMDsKCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLwogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7CgogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovCiAgdWludCBwdWJsaWMgd2VpUmVmdW5kZWQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQ7CgogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8KICBib29sIHB1YmxpYyByZXF1aXJlQ3VzdG9tZXJJZDsKCiAgLyoqCiAgICAqIERvIHdlIHZlcmlmeSB0aGF0IGNvbnRyaWJ1dG9yIGhhcyBiZWVuIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIChhY2NyZWRpdGVkIGludmVzdG9ycyBvbmx5KS4KICAgICogVGhpcyBtZXRob2Qgd2FzIGZpcnN0IHVzZWQgaW4gRmlyc3RCbG9vZCBjcm93ZHNhbGUgdG8gZW5zdXJlIGFsbCBjb250cmlidXRvcnMgaGF2ZSBhY2NlcHRlZCB0ZXJtcyBvbiBzYWxlIChvbiB0aGUgd2ViKS4KICAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzOwoKICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogVGhpcyBpcyBmb3IgbWFudWwgdGVzdGluZyBmb3IgdGhlIGludGVyYWN0aW9uIGZyb20gb3duZXIgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBibG9ja2NoYWluIGV4cGxvcmVyIHRvIHNlZSB0aGF0IGNyb3dkc2FsZSBpbnRlcmFjdGlvbiB3b3Jrcy4gKi8KICB1aW50IHB1YmxpYyBvd25lclRlc3RWYWx1ZTsKCiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKgogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQKICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZAogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IGZvciByZWNsYWltLgogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30KCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50MTI4IGN1c3RvbWVySWQpOwoKICAvLyBSZWZ1bmQgd2FzIHByb2Nlc3NlZCBmb3IgYSBjb250cmlidXRvcgogIGV2ZW50IFJlZnVuZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCk7CgogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdAogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgcmVxdWlyZUN1c3RvbWVySWQsIGJvb2wgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBhZGRyZXNzIHNpZ25lckFkZHJlc3MpOwoKICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7CgogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IGVuZHNBdCk7CgogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIHsKCiAgICBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjAoX3Rva2VuKTsKCiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7CgogICAgbXVsdGlzaWdXYWxsZXQgPSBfbXVsdGlzaWdXYWxsZXQ7CiAgICBpZihtdWx0aXNpZ1dhbGxldCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoX3N0YXJ0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBzdGFydHNBdCA9IF9zdGFydDsKCiAgICBpZihfZW5kID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBlbmRzQXQgPSBfZW5kOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBjYW4gYmUgemVybwogICAgbWluaW11bUZ1bmRpbmdHb2FsID0gX21pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHRocm93OwogIH0KCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IHByaXZhdGUgewoKICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudAogICAgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICAgIC8vIEFyZSB3ZSB3aGl0ZWxpc3RlZCBmb3IgZWFybHkgZGVwb3NpdAogICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0pIHsKICAgICAgICB0aHJvdzsKICAgICAgfQogICAgfSBlbHNlIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuRnVuZGluZykgewogICAgICAvLyBSZXRhaWwgcGFydGljaXBhbnRzIGNhbiBvbmx5IGNvbWUgaW4gd2hlbiB0aGUgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcKICAgICAgLy8gcGFzcwogICAgfSBlbHNlIHsKICAgICAgLy8gVW53YW50ZWQgc3RhdGUKICAgICAgdGhyb3c7CiAgICB9CgogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsKCiAgICBpZih0b2tlbkFtb3VudCA9PSAwKSB7CiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24KICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KCiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcAogICAgaWYoaXNCcmVha2luZ0NhcCh3ZWlBbW91bnQsIHRva2VuQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwoKICAgIC8vIFBvY2tldCB0aGUgbW9uZXkKICAgIGlmKCFtdWx0aXNpZ1dhbGxldC5zZW5kKHdlaUFtb3VudCkpIHRocm93OwoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogSW52ZXN0b3IgY291bnQgaXMgbm90IGhhbmRsZWQ7IGl0IGlzIGFzc3VtZWQgdGhpcyBnb2VzIGZvciBtdWx0aXBsZSBpbnZlc3RvcnMKICAgKiBhbmQgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBoYXBwZW5zIG91dHNpZGUgdGhlIHNtYXJ0IGNvbnRyYWN0IGZsb3cuCiAgICoKICAgKiBObyBtb25leSBpcyBleGNoYW5nZWQsIGFzIHRoZSBjcm93ZHNhbGUgdGVhbSBhbHJlYWR5IGhhdmUgcmVjZWl2ZWQgdGhlIHBheW1lbnQuCiAgICoKICAgKiBAcGFyYW0gZnVsbFRva2VucyB0b2tlbnMgYXMgZnVsbCB0b2tlbnMgLSBkZWNpbWFsIHBsYWNlcyBhZGRlZCBpbnRlcm5hbGx5CiAgICogQHBhcmFtIHdlaVByaWNlIFByaWNlIG9mIGEgc2luZ2xlIGZ1bGwgdG9rZW4gaW4gd2VpCiAgICoKICAgKi8KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgewoKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBmdWxsVG9rZW5zICogMTAqKnRva2VuLmRlY2ltYWxzKCk7CiAgICB1aW50IHdlaUFtb3VudCA9IHdlaVByaWNlICogZnVsbFRva2VuczsgLy8gVGhpcyBjYW4gYmUgYWxzbyAwLCB3ZSBnaXZlIG91dCB0b2tlbnMgZm9yIGZyZWUKCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOwoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCwgMCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYoYWRkcik7CiAgICAgaWYgKGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKSAhPSBzaWduZXJBZGRyZXNzKSB0aHJvdzsKICAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogVHJhY2sgd2hvIGlzIHRoZSBjdXN0b21lciBtYWtpbmcgdGhlIHBheW1lbnQgc28gd2UgY2FuIHNlbmQgdGhhbmsgeW91IGVtYWlsLgogICAqLwogIGZ1bmN0aW9uIGludmVzdFdpdGhDdXN0b21lcklkKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cwogICAgaWYoY3VzdG9tZXJJZCA9PSAwKSB0aHJvdzsgIC8vIFVVSUR2NCBzYW5pdHkgY2hlY2sKICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgYW5vbnltb3VzIGNvbnRyaWJ1dGlvbnMgdG8gdGhpcyBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0KGFkZHJlc3MgYWRkcikgcHVibGljIHBheWFibGUgewogICAgaWYocmVxdWlyZUN1c3RvbWVySWQpIHRocm93OyAvLyBDcm93ZHNhbGUgbmVlZHMgdG8gdHJhY2sgcGFydGlwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cwogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgMCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyIGFuZCBjbGVhciBoaXMgYWRkcmVzcy4KICAgKgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhTaWduZWRBZGRyZXNzKHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQsIHYsIHIsIHMpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0IHRvIHRva2VucywgcmVjb2duaXplIHRoZSBwYXllci4KICAgKgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0V2l0aEN1c3RvbWVySWQobXNnLnNlbmRlciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdChtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGUgb3duZXIgY2FuIHRyaWdncmUgYSBjYWxsIHRoZSBjb250cmFjdCB0aGF0IHByb3ZpZGVzIHBvc3QtY3Jvd2RzYWxlIGFjdGlvbnMsIGxpa2UgcmVsZWFzaW5nIHRoZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKCiAgICAvLyBBbHJlYWR5IGZpbmFsaXplZAogICAgaWYoZmluYWxpemVkKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50LgogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7CiAgICAgIGZpbmFsaXplQWdlbnQuZmluYWxpemVDcm93ZHNhbGUoKTsKICAgIH0KCiAgICBmaW5hbGl6ZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdG8gKHJlKXNldCBmaW5hbGl6ZSBhZ2VudC4KICAgKgogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiBzZXR0aW5nIHRoaXMsIHNvIHRoYXQgd2UgY2FuIGZpeCBmYXQgZmluZ2VyIG1pc3Rha2VzLgogICAqLwogIGZ1bmN0aW9uIHNldEZpbmFsaXplQWdlbnQoRmluYWxpemVBZ2VudCBhZGRyKSBvbmx5T3duZXIgewogICAgZmluYWxpemVBZ2VudCA9IGFkZHI7CgogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQKICAgIGlmKCFmaW5hbGl6ZUFnZW50LmlzRmluYWxpemVBZ2VudCgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KCiAgLyoqCiAgICogU2V0IHBvbGljeSBkbyB3ZSBuZWVkIHRvIGhhdmUgc2VydmVyLXNpZGUgY3VzdG9tZXIgaWRzIGZvciB0aGUgaW52ZXN0bWVudHMuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlQ3VzdG9tZXJJZChib29sIHZhbHVlKSBvbmx5T3duZXIgewogICAgcmVxdWlyZUN1c3RvbWVySWQgPSB2YWx1ZTsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCiAgLyoqCiAgICogU2V0IHBvbGljeSBpZiBhbGwgaW52ZXN0b3JzIG11c3QgYmUgY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgZmlyc3QuCiAgICoKICAgKiBUaGlzIGlzIGUuZy4gZm9yIHRoZSBhY2NyZWRpdGVkIGludmVzdG9yIGNsZWFyaW5nLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZVNpZ25lZEFkZHJlc3MoYm9vbCB2YWx1ZSwgYWRkcmVzcyBfc2lnbmVyQWRkcmVzcykgb25seU93bmVyIHsKICAgIHJlcXVpcmVkU2lnbmVkQWRkcmVzcyA9IHZhbHVlOwogICAgc2lnbmVyQWRkcmVzcyA9IF9zaWduZXJBZGRyZXNzOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKgogICAqIFRPRE86IEZpeCBzcGVsbGluZyBlcnJvciBpbiB0aGUgbmFtZQogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKSBvbmx5T3duZXIgewogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IHN0YXR1czsKICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBjcm93ZHNhbGUgb3duZXIgdG8gY2xvc2UgZWFybHkgb3IgZXh0ZW5kIHRoZSBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGlzIGlzIHVzZWZ1bCBlLmcuIGZvciBhIG1hbnVhbCBzb2Z0IGNhcCBpbXBsZW1lbnRhdGlvbjoKICAgKiAtIGFmdGVyIFggYW1vdW50IGlzIHJlYWNoZWQgZGV0ZXJtaW5lIG1hbnVhbCBjbG9zaW5nCiAgICoKICAgKiBUaGlzIG1heSBwdXQgdGhlIGNyb3dkc2FsZSB0byBhbiBpbnZhbGlkIHN0YXRlLAogICAqIGJ1dCB3ZSB0cnVzdCBvd25lcnMga25vdyB3aGF0IHRoZXkgYXJlIGRvaW5nLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0RW5kc0F0KHVpbnQgdGltZSkgb25seU93bmVyIHsKCiAgICBpZihub3cgPiB0aW1lKSB7CiAgICAgIHRocm93OyAvLyBEb24ndCBjaGFuZ2UgcGFzdAogICAgfQoKICAgIGVuZHNBdCA9IHRpbWU7CiAgICBFbmRzQXRDaGFuZ2VkKGVuZHNBdCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gdGhlIHNldCwgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5KSBvbmx5T3duZXIgewogICAgcHJpY2luZ1N0cmF0ZWd5ID0gX3ByaWNpbmdTdHJhdGVneTsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIXByaWNpbmdTdHJhdGVneS5pc1ByaWNpbmdTdHJhdGVneSgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KCiAgLyoqCiAgICogQWxsb3cgdG8gY2hhbmdlIHRoZSB0ZWFtIG11bHRpc2lnIGFkZHJlc3MgaW4gdGhlIGNhc2Ugb2YgZW1lcmdlbmN5LgogICAqCiAgICogVGhpcyBhbGxvd3MgdG8gc2F2ZSBhIGRlcGxveWVkIGNyb3dkc2FsZSB3YWxsZXQgaW4gdGhlIGNhc2UgdGhlIGNyb3dkc2FsZSBoYXMgbm90IHlldCBiZWd1bgogICAqICh3ZSBoYXZlIGRvbmUgb25seSBmZXcgdGVzdCB0cmFuc2FjdGlvbnMpLiBBZnRlciB0aGUgY3Jvd2RzYWxlIGlzIGdvaW5nCiAgICogdGhlbiBtdWx0aXNpZyBhZGRyZXNzIHN0YXlzIGxvY2tlZCBmb3IgdGhlIHNhZmV0eSByZWFzb25zLgogICAqLwogIGZ1bmN0aW9uIHNldE11bHRpc2lnKGFkZHJlc3MgYWRkcikgcHVibGljIG9ubHlPd25lciB7CgogICAgLy8gQ2hhbmdlCiAgICBpZihpbnZlc3RvckNvdW50ID4gTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgbXVsdGlzaWdXYWxsZXQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogQWxsb3cgbG9hZCByZWZ1bmRzIGJhY2sgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgcmVmdW5kaW5nLgogICAqCiAgICogVGhlIHRlYW0gY2FuIHRyYW5zZmVyIHRoZSBmdW5kcyBiYWNrIG9uIHRoZSBzbWFydCBjb250cmFjdCBpbiB0aGUgY2FzZSB0aGUgbWluaW11bSBnb2FsIHdhcyBub3QgcmVhY2hlZC4uCiAgICovCiAgZnVuY3Rpb24gbG9hZFJlZnVuZCgpIHB1YmxpYyBwYXlhYmxlIGluU3RhdGUoU3RhdGUuRmFpbHVyZSkgewogICAgaWYobXNnLnZhbHVlID09IDApIHRocm93OwogICAgbG9hZGVkUmVmdW5kID0gbG9hZGVkUmVmdW5kLnBsdXMobXNnLnZhbHVlKTsKICB9CgogIC8qKgogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLgogICAqCiAgICogTm90ZSB0aGF0IGFueSByZWZ1bmRzIGZyb20gcHJveHkgYnV5ZXJzIHNob3VsZCBiZSBoYW5kbGVkIHNlcGFyYXRlbHksCiAgICogYW5kIG5vdCB0aHJvdWdoIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7CiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsKICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsKICAgIGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl0gPSAwOwogICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5wbHVzKHdlaVZhbHVlKTsKICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7CiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlWYWx1ZSkpIHRocm93OwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaGFzIHJhaXNlZCBlbm91Z2ggbW9uZXkgdG8gYmUgYSBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGlzTWluaW11bUdvYWxSZWFjaGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmVhY2hlZCkgewogICAgcmV0dXJuIHdlaVJhaXNlZCA+PSBtaW5pbXVtRnVuZGluZ0dvYWw7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuCiAgICovCiAgZnVuY3Rpb24gaXNGaW5hbGl6ZXJTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgewogICAgcmV0dXJuIGZpbmFsaXplQWdlbnQuaXNTYW5lKCk7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuCiAgICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpOwogIH0KCiAgLyoqCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4KICAgKgogICAqIFdlIG1ha2UgaXQgYSBmdW5jdGlvbiBhbmQgZG8gbm90IGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgdmFyaWFibGUsIHNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpIHsKICAgIGlmKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsKICAgIGVsc2UgaWYgKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgPT0gMCkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKCFmaW5hbGl6ZUFnZW50LmlzU2FuZSgpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIXByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7CiAgICBlbHNlIGlmIChpc01pbmltdW1Hb2FsUmVhY2hlZCgpKSByZXR1cm4gU3RhdGUuU3VjY2VzczsKICAgIGVsc2UgaWYgKCFpc01pbmltdW1Hb2FsUmVhY2hlZCgpICYmIHdlaVJhaXNlZCA+IDAgJiYgbG9hZGVkUmVmdW5kID49IHdlaVJhaXNlZCkgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLkZhaWx1cmU7CiAgfQoKICAvKiogVGhpcyBpcyBmb3IgbWFudWFsIHRlc3Rpbmcgb2YgbXVsdGlzaWcgd2FsbGV0IGludGVyYWN0aW9uICovCiAgZnVuY3Rpb24gc2V0T3duZXJUZXN0VmFsdWUodWludCB2YWwpIG9ubHlPd25lciB7CiAgICBvd25lclRlc3RWYWx1ZSA9IHZhbDsKICB9CgogIC8qKiBJbnRlcmZhY2UgbWFya2VyLiAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8KICAvLyBNb2RpZmllcnMKICAvLwoKICAvKiogTW9kaWZpZWQgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgewogICAgaWYoZ2V0U3RhdGUoKSAhPSBzdGF0ZSkgdGhyb3c7CiAgICBfOwogIH0KCgogIC8vCiAgLy8gQWJzdHJhY3QgZnVuY3Rpb25zCiAgLy8KCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgaW52ZXN0ZWQgYnJlYWtzIG91ciBjYXAgcnVsZXMuCiAgICoKICAgKgogICAqIFRoZSBjaGlsZCBjb250cmFjdCBtdXN0IGRlZmluZSB0aGVpciBvd24gY2FwIHNldHRpbmcgcnVsZXMuCiAgICogV2UgYWxsb3cgYSBsb3Qgb2YgZmxleGliaWxpdHkgdGhyb3VnaCBkaWZmZXJlbnQgY2FwcGluZyBzdHJhdGVnaWVzIChFVEgsIHRva2VuIGNvdW50KQogICAqIENhbGxlZCBmcm9tIGludmVzdCgpLgogICAqCiAgICogQHBhcmFtIHdlaUFtb3VudCBUaGUgYW1vdW50IG9mIHdlaSB0aGUgaW52ZXN0b3IgdHJpZXMgdG8gaW52ZXN0IGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHRva2VuQW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHdlIHRyeSB0byBnaXZlIHRvIHRoZSBpbnZlc3RvciBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB3ZWlSYWlzZWRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCByYWlzZWQgYmFsYW5jZSBhZnRlciB0aGlzIHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHRva2Vuc1NvbGRUb3RhbCBXaGF0IHdvdWxkIGJlIG91ciB0b3RhbCBzb2xkIHRva2VucyBjb3VudCBhZnRlciB0aGlzIHRyYW5zYWN0aW9uCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGFraW5nIHRoaXMgaW52ZXN0bWVudCB3b3VsZCBicmVhayBvdXIgY2FwIHJ1bGVzCiAgICovCiAgZnVuY3Rpb24gaXNCcmVha2luZ0NhcCh1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlSYWlzZWRUb3RhbCwgdWludCB0b2tlbnNTb2xkVG90YWwpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgbGltaXRCcm9rZW4pOwoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBjcm93ZHNhbGUgaXMgZnVsbCBhbmQgd2UgY2FuIG5vIGxvbmdlciBzZWxsIGFueSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4KICAgKi8KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgcHJpdmF0ZTsKfQoKCgoKCgoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmNvbnRyYWN0IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiID4gMCk7CiAgICB1aW50IGMgPSBhIC8gYjsKICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIGludGVybmFsIHsKICAgIGlmICghYXNzZXJ0aW9uKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KfQoKCgovKioKICogU3RhbmRhcmQgRVJDMjAgdG9rZW4gd2l0aCBTaG9ydCBIYW5kIEF0dGFjayBhbmQgYXBwcm92ZSgpIHJhY2UgY29uZGl0aW9uIG1pdGlnYXRpb24uCiAqCiAqIEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDoKICogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCB7CgogIC8qIFRva2VuIHN1cHBseSBnb3QgaW5jcmVhc2VkIGFuZCBhIG5ldyBvd25lciByZWNlaXZlZCB0aGVzZSB0b2tlbnMgKi8KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwoKICAvKiBBY3R1YWwgYmFsYW5jZXMgb2YgdG9rZW4gaG9sZGVycyAqLwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKCiAgLyogYXBwcm92ZSgpIGFsbG93YW5jZXMgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogIC8qIEludGVyZmFjZSBkZWNsYXJhdGlvbiAqLwogIGZ1bmN0aW9uIGlzVG9rZW4oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCB3ZUFyZSkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKgogICAqIEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrCiAgICoKICAgKiBodHRwOi8vdmVzc2VuZXMuY29tL3RoZS1lcmMyMC1zaG9ydC1hZGRyZXNzLWF0dGFjay1leHBsYWluZWQvCiAgICovCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGlmKG1zZy5kYXRhLmxlbmd0aCA8IHNpemUgKyA0KSB7CiAgICAgICB0aHJvdzsKICAgICB9CiAgICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9CgoKCgoKLyoqCiAqIFVwZ3JhZGUgYWdlbnQgaW50ZXJmYWNlIGluc3BpcmVkIGJ5IEx1bnlyLgogKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKCiAgdWludCBwdWJsaWMgb3JpZ2luYWxTdXBwbHk7CgogIC8qKiBJbnRlcmZhY2UgbWFya2VyICovCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwoKfQoKCi8qKgogKiBBIHRva2VuIHVwZ3JhZGUgbWVjaGFuaXNtIHdoZXJlIHVzZXJzIGNhbiBvcHQtaW4gYW1vdW50IG9mIHRva2VucyB0byB0aGUgbmV4dCBzbWFydCBjb250cmFjdCByZXZpc2lvbi4KICoKICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAvKiogQ29udHJhY3QgLyBwZXJzb24gd2hvIGNhbiBzZXQgdGhlIHVwZ3JhZGUgcGF0aC4gVGhpcyBjYW4gYmUgdGhlIHNhbWUgYXMgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIGFzIHdoYXQgaXQgaXMgd2l0aCBpdHMgZGVmYXVsdCB2YWx1ZS4gKi8KICBhZGRyZXNzIHB1YmxpYyB1cGdyYWRlTWFzdGVyOwoKICAvKiogVGhlIG5leHQgY29udHJhY3Qgd2hlcmUgdGhlIHRva2VucyB3aWxsIGJlIG1pZ3JhdGVkLiAqLwogIFVwZ3JhZGVBZ2VudCBwdWJsaWMgdXBncmFkZUFnZW50OwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgdXBncmFkZWQgYnkgbm93LiAqLwogIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CgogIC8qKgogICAqIFVwZ3JhZGUgc3RhdGVzLgogICAqCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuCiAgICogLSBXYWl0aW5nRm9yQWdlbnQ6IFRva2VuIGFsbG93cyB1cGdyYWRlLCBidXQgd2UgZG9uJ3QgaGF2ZSBhIG5ldyBhZ2VudCB5ZXQKICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldAogICAqIC0gVXBncmFkaW5nOiBVcGdyYWRlIGFnZW50IGlzIHNldCBhbmQgdGhlIGJhbGFuY2UgaG9sZGVycyBjYW4gdXBncmFkZSB0aGVpciB0b2tlbnMKICAgKgogICAqLwogIGVudW0gVXBncmFkZVN0YXRlIHtVbmtub3duLCBOb3RBbGxvd2VkLCBXYWl0aW5nRm9yQWdlbnQsIFJlYWR5VG9VcGdyYWRlLCBVcGdyYWRpbmd9CgogIC8qKgogICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuCiAgICovCiAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKCiAgLyoqCiAgICogTmV3IHVwZ3JhZGUgYWdlbnQgYXZhaWxhYmxlLgogICAqLwogIGV2ZW50IFVwZ3JhZGVBZ2VudFNldChhZGRyZXNzIGFnZW50KTsKCiAgLyoqCiAgICogRG8gbm90IGFsbG93IGNvbnN0cnVjdGlvbiB3aXRob3V0IHVwZ3JhZGUgbWFzdGVyIHNldC4KICAgKi8KICBmdW5jdGlvbiBVcGdyYWRlYWJsZVRva2VuKGFkZHJlc3MgX3VwZ3JhZGVNYXN0ZXIpIHsKICAgIHVwZ3JhZGVNYXN0ZXIgPSBfdXBncmFkZU1hc3RlcjsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQyNTYgdmFsdWUpIHB1YmxpYyB7CgogICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgICAgaWYoIShzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGUgfHwgc3RhdGUgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZykpIHsKICAgICAgICAvLyBDYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgICAgICB0aHJvdzsKICAgICAgfQoKICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICAgIGlmICh2YWx1ZSA9PSAwKSB0aHJvdzsKCiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdmFsdWUpOwoKICAgICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCB2YWx1ZSk7CiAgICAgIHRvdGFsVXBncmFkZWQgPSBzYWZlQWRkKHRvdGFsVXBncmFkZWQsIHZhbHVlKTsKCiAgICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2VucwogICAgICB1cGdyYWRlQWdlbnQudXBncmFkZUZyb20obXNnLnNlbmRlciwgdmFsdWUpOwogICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIGV4dGVybmFsIHsKCiAgICAgIGlmKCFjYW5VcGdyYWRlKCkpIHsKICAgICAgICAvLyBUaGUgdG9rZW4gaXMgbm90IHlldCBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgdXBncmFkaW5nCiAgICAgICAgdGhyb3c7CiAgICAgIH0KCiAgICAgIGlmIChhZ2VudCA9PSAweDApIHRocm93OwogICAgICAvLyBPbmx5IGEgbWFzdGVyIGNhbiBkZXNpZ25hdGUgdGhlIG5leHQgYWdlbnQKICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3RlcikgdGhyb3c7CiAgICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50CiAgICAgIGlmIChnZXRVcGdyYWRlU3RhdGUoKSA9PSBVcGdyYWRlU3RhdGUuVXBncmFkaW5nKSB0aHJvdzsKCiAgICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7CgogICAgICAvLyBCYWQgaW50ZXJmYWNlCiAgICAgIGlmKCF1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSkgdGhyb3c7CiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICAgIGlmICh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSkgdGhyb3c7CgogICAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoVXBncmFkZVN0YXRlKSB7CiAgICBpZighY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmKGFkZHJlc3ModXBncmFkZUFnZW50KSA9PSAweDAwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsKICAgIGVsc2UgaWYodG90YWxVcGdyYWRlZCA9PSAwKSByZXR1cm4gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlOwogICAgZWxzZSByZXR1cm4gVXBncmFkZVN0YXRlLlVwZ3JhZGluZzsKICB9CgogIC8qKgogICAqIENoYW5nZSB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICoKICAgKiBUaGlzIGFsbG93cyB1cyB0byBzZXQgYSBuZXcgb3duZXIgZm9yIHRoZSB1cGdyYWRlIG1lY2hhbmlzbS4KICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBwdWJsaWMgewogICAgICBpZiAobWFzdGVyID09IDB4MCkgdGhyb3c7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpIHRocm93OwogICAgICB1cGdyYWRlTWFzdGVyID0gbWFzdGVyOwogIH0KCiAgLyoqCiAgICogQ2hpbGQgY29udHJhY3QgY2FuIGVuYWJsZSB0byBwcm92aWRlIHRoZSBjb25kaXRpb24gd2hlbiB0aGUgdXBncmFkZSBjYW4gYmVndW4uCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgoKCgoKCi8qKgogKiBEZWZpbmUgaW50ZXJmYWNlIGZvciByZWxlYXNpbmcgdGhlIHRva2VuIHRyYW5zZmVyIGFmdGVyIGEgc3VjY2Vzc2Z1bCBjcm93ZHNhbGUuCiAqLwpjb250cmFjdCBSZWxlYXNhYmxlVG9rZW4gaXMgRVJDMjAsIE93bmFibGUgewoKICAvKiBUaGUgZmluYWxpemVyIGNvbnRyYWN0IHRoYXQgYWxsb3dzIHVubGlmdCB0aGUgdHJhbnNmZXIgbGltaXRzIG9uIHRoaXMgdG9rZW4gKi8KICBhZGRyZXNzIHB1YmxpYyByZWxlYXNlQWdlbnQ7CgogIC8qKiBBIGNyb3dkc2FsZSBjb250cmFjdCBjYW4gcmVsZWFzZSB1cyB0byB0aGUgd2lsZCBpZiBJQ08gc3VjY2Vzcy4gSWYgZmFsc2Ugd2UgYXJlIGFyZSBpbiB0cmFuc2ZlciBsb2NrIHVwIHBlcmlvZC4qLwogIGJvb2wgcHVibGljIHJlbGVhc2VkID0gZmFsc2U7CgogIC8qKiBNYXAgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gdHJhbnNmZXIgdG9rZW5zIHJlZ2FyZGxlc3Mgb2YgdGhlIGxvY2sgZG93biBwZXJpb2QuIFRoZXNlIGFyZSBjcm93ZHNhbGUgY29udHJhY3RzIGFuZCBwb3NzaWJsZSB0aGUgdGVhbSBtdWx0aXNpZyBpdHNlbGYuICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgdHJhbnNmZXJBZ2VudHM7CgogIC8qKgogICAqIExpbWl0IHRva2VuIHRyYW5zZmVyIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KICAgKgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlcikgewoKICAgIGlmKCFyZWxlYXNlZCkgewogICAgICAgIGlmKCF0cmFuc2ZlckFnZW50c1tfc2VuZGVyXSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9CgogICAgXzsKICB9CgogIC8qKgogICAqIFNldCB0aGUgY29udHJhY3QgdGhhdCBjYW4gY2FsbCByZWxlYXNlIGFuZCBtYWtlIHRoZSB0b2tlbiB0cmFuc2ZlcmFibGUuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlLiBBbGxvdyByZXNldCB0aGUgcmVsZWFzZSBhZ2VudCB0byBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CgogICAgLy8gV2UgZG9uJ3QgZG8gaW50ZXJmYWNlIGNoZWNrIGhlcmUgYXMgd2UgbWlnaHQgd2FudCB0byBhIG5vcm1hbCB3YWxsZXQgYWRkcmVzcyB0byBhY3QgYXMgYSByZWxlYXNlIGFnZW50CiAgICByZWxlYXNlQWdlbnQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChhIGNyb3dkc2FsZSBjb250cmFjdCkgdG8gdHJhbnNmZXIgdG9rZW5zIGRlc3BpdGUgdGhlIGxvY2sgdXAgcGVyaW9kLgogICAqLwogIGZ1bmN0aW9uIHNldFRyYW5zZmVyQWdlbnQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICB0cmFuc2ZlckFnZW50c1thZGRyXSA9IHN0YXRlOwogIH0KCiAgLyoqCiAgICogT25lIHdheSBmdW5jdGlvbiB0byByZWxlYXNlIHRoZSB0b2tlbnMgdG8gdGhlIHdpbGQuCiAgICoKICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IGlzIHRoZSBmaW5hbCBJQ08gY29udHJhY3QuIEl0IGlzIG9ubHkgY2FsbGVkIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGJlZW4gc3VjY2VzcyAoZmlyc3QgbWlsZXN0b25lIHJlYWNoZWQpLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgcmVsZWFzZWQgPSB0cnVlOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VzZCAqLwogIG1vZGlmaWVyIGluUmVsZWFzZVN0YXRlKGJvb2wgcmVsZWFzZVN0YXRlKSB7CiAgICBpZihyZWxlYXNlU3RhdGUgIT0gcmVsZWFzZWQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBhIHdoaXRlbGlzdGVkIHJlbGVhc2UgYWdlbnQuICovCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgIGlmKG1zZy5zZW5kZXIgIT0gcmVsZWFzZUFnZW50KSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlcigpCiAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXJGb3JtKCkKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9Cgp9CgoKCgoKCgovKioKICogQSB0b2tlbiB0aGF0IGNhbiBpbmNyZWFzZSBpdHMgc3VwcGx5IGJ5IGFub3RoZXIgY29udHJhY3QuCiAqCiAqIFRoaXMgYWxsb3dzIHVuY2FwcGVkIGNyb3dkc2FsZSBieSBkeW5hbWljYWxseSBpbmNyZWFzaW5nIHRoZSBzdXBwbHkgd2hlbiBtb25leSBwb3VycyBpbi4KICogT25seSBtaW50IGFnZW50cywgY29udHJhY3RzIHdoaXRlbGlzdGVkIGJ5IG93bmVyLCBjYW4gbWludCBuZXcgdG9rZW5zLgogKgogKi8KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKICAvKiogTGlzdCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHRva2VucyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIG1pbnRBZ2VudHM7CgogIGV2ZW50IE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlICApOwoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLi4KICAgKgogICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIG9ubHlNaW50QWdlbnQgY2FuTWludCBwdWJsaWMgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5wbHVzKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0ucGx1cyhhbW91bnQpOwoKICAgIC8vIFRoaXMgd2lsbCBtYWtlIHRoZSBtaW50IHRyYW5zYWN0aW9uIGFwcGVyIGluIEV0aGVyU2Nhbi5pbwogICAgLy8gV2UgY2FuIHJlbW92ZSB0aGlzIGFmdGVyIHRoZXJlIGlzIGEgc3RhbmRhcmRpemVkIG1pbnRpbmcgZXZlbnQKICAgIFRyYW5zZmVyKDAsIHJlY2VpdmVyLCBhbW91bnQpOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHRvIG1pbnQgbmV3IHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBzZXRNaW50QWdlbnQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlKSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgewogICAgbWludEFnZW50c1thZGRyXSA9IHN0YXRlOwogICAgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyLCBzdGF0ZSk7CiAgfQoKICBtb2RpZmllciBvbmx5TWludEFnZW50KCkgewogICAgLy8gT25seSBjcm93ZHNhbGUgY29udHJhY3RzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIGlmKG1pbnRpbmdGaW5pc2hlZCkgdGhyb3c7CiAgICBfOwogIH0KfQoKCgovKioKICogQSBjcm93ZHNhbGVkIHRva2VuLgogKgogKiBBbiBFUkMtMjAgdG9rZW4gZGVzaWduZWQgc3BlY2lmaWNhbGx5IGZvciBjcm93ZHNhbGVzIHdpdGggaW52ZXN0b3IgcHJvdGVjdGlvbiBhbmQgZnVydGhlciBkZXZlbG9wbWVudCBwYXRoLgogKgogKiAtIFRoZSB0b2tlbiB0cmFuc2ZlcigpIGlzIGRpc2FibGVkIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3ZlcgogKiAtIFRoZSB0b2tlbiBjb250cmFjdCBnaXZlcyBhbiBvcHQtaW4gdXBncmFkZSBwYXRoIHRvIGEgbmV3IGNvbnRyYWN0CiAqIC0gVGhlIHNhbWUgdG9rZW4gY2FuIGJlIHBhcnQgb2Ygc2V2ZXJhbCBjcm93ZHNhbGVzIHRocm91Z2ggYXBwcm92ZSgpIG1lY2hhbmlzbQogKiAtIFRoZSB0b2tlbiBjYW4gYmUgY2FwcGVkIChzdXBwbHkgc2V0IGluIHRoZSBjb25zdHJ1Y3Rvcikgb3IgdW5jYXBwZWQgKGNyb3dkc2FsZSBjb250cmFjdCBjYW4gbWludCBuZXcgdG9rZW5zKQogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gaXMgUmVsZWFzYWJsZVRva2VuLCBNaW50YWJsZVRva2VuLCBVcGdyYWRlYWJsZVRva2VuIHsKCiAgLyoqIE5hbWUgYW5kIHN5bWJvbCB3ZXJlIHVwZGF0ZWQuICovCiAgZXZlbnQgVXBkYXRlZFRva2VuSW5mb3JtYXRpb24oc3RyaW5nIG5ld05hbWUsIHN0cmluZyBuZXdTeW1ib2wpOwoKICBzdHJpbmcgcHVibGljIG5hbWU7CgogIHN0cmluZyBwdWJsaWMgc3ltYm9sOwoKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKCiAgLyoqCiAgICogQ29uc3RydWN0IHRoZSB0b2tlbi4KICAgKgogICAqIFRoaXMgdG9rZW4gbXVzdCBiZSBjcmVhdGVkIHRocm91Z2ggYSB0ZWFtIG11bHRpc2lnIHdhbGxldCwgc28gdGhhdCBpdCBpcyBvd25lZCBieSB0aGF0IHdhbGxldC4KICAgKgogICAqIEBwYXJhbSBfbmFtZSBUb2tlbiBuYW1lCiAgICogQHBhcmFtIF9zeW1ib2wgVG9rZW4gc3ltYm9sIC0gc2hvdWxkIGJlIGFsbCBjYXBzCiAgICogQHBhcmFtIF9pbml0aWFsU3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoCiAgICogQHBhcmFtIF9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMKICAgKiBAcGFyYW0gX21pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF9pbml0aWFsU3VwcGx5LCB1aW50IF9kZWNpbWFscywgYm9vbCBfbWludGFibGUpCiAgICBVcGdyYWRlYWJsZVRva2VuKG1zZy5zZW5kZXIpIHsKCiAgICAvLyBDcmVhdGUgYW55IGFkZHJlc3MsIGNhbiBiZSB0cmFuc2ZlcnJlZAogICAgLy8gdG8gdGVhbSBtdWx0aXNpZyB2aWEgY2hhbmdlT3duZXIoKSwKICAgIC8vIGFsc28gcmVtZW1iZXIgdG8gY2FsbCBzZXRVcGdyYWRlTWFzdGVyKCkKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICBuYW1lID0gX25hbWU7CiAgICBzeW1ib2wgPSBfc3ltYm9sOwoKICAgIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHk7CgogICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CgogICAgLy8gQ3JlYXRlIGluaXRpYWxseSBhbGwgYmFsYW5jZSBvbiB0aGUgdGVhbSBtdWx0aXNpZwogICAgYmFsYW5jZXNbb3duZXJdID0gdG90YWxTdXBwbHk7CgogICAgaWYodG90YWxTdXBwbHkgPiAwKSB7CiAgICAgIE1pbnRlZChvd25lciwgdG90YWxTdXBwbHkpOwogICAgfQoKICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbgogICAgaWYoIV9taW50YWJsZSkgewogICAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgICBpZih0b3RhbFN1cHBseSA9PSAwKSB7CiAgICAgICAgdGhyb3c7IC8vIENhbm5vdCBjcmVhdGUgYSB0b2tlbiB3aXRob3V0IHN1cHBseSBhbmQgbm8gbWludGluZwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBXaGVuIHRva2VuIGlzIHJlbGVhc2VkIHRvIGJlIHRyYW5zZmVyYWJsZSwgZW5mb3JjZSBubyBuZXcgdG9rZW5zIGNhbiBiZSBjcmVhdGVkLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIHN1cGVyLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB1cGdyYWRlIGFnZW50IGZ1bmN0aW9uYWxpdHkga2ljayBpbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgd2FzIHN1Y2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiByZWxlYXNlZCAmJiBzdXBlci5jYW5VcGdyYWRlKCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gdXBkYXRlIHRva2VuIGluZm9ybWF0aW9uIGhlcmUuCiAgICoKICAgKiBJdCBpcyBvZnRlbiB1c2VmdWwgdG8gY29uY2VhbCB0aGUgYWN0dWFsIHRva2VuIGFzc29jaWF0aW9uLCB1bnRpbAogICAqIHRoZSB0b2tlbiBvcGVyYXRpb25zLCBsaWtlIGNlbnRyYWwgaXNzdWFuY2Ugb3IgcmVpc3N1YW5jZSBoYXZlIGJlZW4gY29tcGxldGVkLgogICAqCiAgICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgdGhlIHRva2VuIG93bmVyIHRvIHJlbmFtZSB0aGUgdG9rZW4gYWZ0ZXIgdGhlIG9wZXJhdGlvbnMKICAgKiBoYXZlIGJlZW4gY29tcGxldGVkIGFuZCB0aGVuIHBvaW50IHRoZSBhdWRpZW5jZSB0byB1c2UgdGhlIHRva2VuIGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIHNldFRva2VuSW5mb3JtYXRpb24oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCkgb25seU93bmVyIHsKICAgIG5hbWUgPSBfbmFtZTsKICAgIHN5bWJvbCA9IF9zeW1ib2w7CgogICAgVXBkYXRlZFRva2VuSW5mb3JtYXRpb24obmFtZSwgc3ltYm9sKTsKICB9Cgp9CgoKCi8qKgogKiBBdCB0aGUgZW5kIG9mIHRoZSBzdWNjZXNzZnVsIGNyb3dkc2FsZSBhbGxvY2F0ZSAlIGJvbnVzIG9mIHRva2VucyB0byB0aGUgdGVhbS4KICoKICogVW5sb2NrIHRva2Vucy4KICoKICogQm9udXNBbGxvY2F0aW9uRmluYWwgbXVzdCBiZSBzZXQgYXMgdGhlIG1pbnRpbmcgYWdlbnQgZm9yIHRoZSBNaW50YWJsZVRva2VuLgogKgogKi8KY29udHJhY3QgQm9udXNGaW5hbGl6ZUFnZW50IGlzIEZpbmFsaXplQWdlbnQgewoKICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsKCiAgQ3Jvd2RzYWxlVG9rZW4gcHVibGljIHRva2VuOwogIENyb3dkc2FsZSBwdWJsaWMgY3Jvd2RzYWxlOwoKICAvKiogVG90YWwgcGVyY2VudCBvZiB0b2tlbnMgbWludGVkIHRvIHRoZSB0ZWFtIGF0IHRoZSBlbmQgb2YgdGhlIHNhbGUgYXMgYmFzZSBwb2ludHMgKDAuMDAwMSkgKi8KICB1aW50IHB1YmxpYyBib251c0Jhc2VQb2ludHM7CgogIC8qKiBXaGVyZSB3ZSBtb3ZlIHRoZSB0b2tlbnMgYXQgdGhlIGVuZCBvZiB0aGUgc2FsZS4gKi8KICBhZGRyZXNzIHB1YmxpYyB0ZWFtTXVsdGlzaWc7CgogIC8qIEhvdyBtdWNoIGJvbnVzIHRva2VucyB3ZSBhbGxvY2F0ZWQgKi8KICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRCb251czsKCiAgZnVuY3Rpb24gQm9udXNGaW5hbGl6ZUFnZW50KENyb3dkc2FsZVRva2VuIF90b2tlbiwgQ3Jvd2RzYWxlIF9jcm93ZHNhbGUsIHVpbnQgX2JvbnVzQmFzZVBvaW50cywgYWRkcmVzcyBfdGVhbU11bHRpc2lnKSB7CiAgICB0b2tlbiA9IF90b2tlbjsKICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7CiAgICBpZihhZGRyZXNzKGNyb3dkc2FsZSkgPT0gMCkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICB0ZWFtTXVsdGlzaWcgPSBfdGVhbU11bHRpc2lnOwogICAgaWYoYWRkcmVzcyh0ZWFtTXVsdGlzaWcpID09IDApIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgYm9udXNCYXNlUG9pbnRzID0gX2JvbnVzQmFzZVBvaW50czsKICB9CgogIC8qIENhbiB3ZSBydW4gZmluYWxpemUgcHJvcGVybHkgKi8KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuICh0b2tlbi5taW50QWdlbnRzKGFkZHJlc3ModGhpcykpID09IHRydWUpICYmICh0b2tlbi5yZWxlYXNlQWdlbnQoKSA9PSBhZGRyZXNzKHRoaXMpKTsKICB9CgogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpIHsKICAgIGlmKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyhjcm93ZHNhbGUpKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEhvdyBtYW55ICUgb2YgdG9rZW5zIHRoZSBmb3VuZGVycyBhbmQgb3RoZXJzIGdldAogICAgdWludCB0b2tlbnNTb2xkID0gY3Jvd2RzYWxlLnRva2Vuc1NvbGQoKTsKICAgIGFsbG9jYXRlZEJvbnVzID0gdG9rZW5zU29sZC50aW1lcyhib251c0Jhc2VQb2ludHMpIC8gMTAwMDA7CgogICAgLy8gbW92ZSB0b2tlbnMgdG8gdGhlIHRlYW0gbXVsdGlzaWcgd2FsbGV0CiAgICB0b2tlbi5taW50KHRlYW1NdWx0aXNpZywgYWxsb2NhdGVkQm9udXMpOwoKICAgIC8vIE1ha2UgdG9rZW4gdHJhbnNmZXJhYmxlCiAgICB0b2tlbi5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCn0='.
	

]
