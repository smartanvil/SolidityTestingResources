Class {
	#name : #SRT99287f6a84d56fc3bb2ad95a4bbe783403f825f0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT99287f6a84d56fc3bb2ad95a4bbe783403f825f0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgdWludDI1NiBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKCi8qKioqKgoqIEB0aXRsZSBUaGUgREFESSBQcmVzYWxlIENvbnRyYWN0CiovCmNvbnRyYWN0IERhZGlQcmVTYWxlIGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgU3RhbmRhcmRUb2tlbiBwdWJsaWMgdG9rZW47ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBEQURJIEVSQzIwIHRva2VuICovCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3NbXSBwdWJsaWMgcHJlU2FsZVdhbGxldHM7CgogICAgc3RydWN0IFdoaXRlbGlzdFVzZXIgewogICAgICB1aW50MjU2IHBsZWRnZWQ7CiAgICAgIHVpbnQgaW5kZXg7CiAgICB9CgogICAgc3RydWN0IEludmVzdG9yIHsKICAgICAgdWludDI1NiB0b2tlbnM7CiAgICAgIHVpbnQyNTYgY29udHJpYnV0aW9uOwogICAgICB1aW50IGluZGV4OwogICAgfQoKICAgIHVpbnQyNTYgcHVibGljIHRva2VuU3VwcGx5OwogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zUHVyY2hhc2VkID0gMDsKICAgIHVpbnQyNTYgcHVibGljIGluZGl2aWR1YWxDYXAgPSAxMDAwMCAqIDEwMDA7ICAgICAgICAvLyBVU0QkMTAsMDAwCiAgICB1aW50MjU2IHB1YmxpYyBwcmVTYWxlVG9rZW5QcmljZSA9IDQwMDsgICAgICAgICAgICAgLy8gVVNEJDAuNDAKICAgIHVpbnQyNTYgcHVibGljIGV0aFJhdGU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFVEggdG8gVVNEIFJhdGUsIHNldCBieSBvd25lcjogMSBFVEggPSBldGhSYXRlIFVTRAogCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gV2hpdGVsaXN0VXNlcikgcHJpdmF0ZSB3aGl0ZWxpc3RlZDsKICAgIGFkZHJlc3NbXSBwcml2YXRlIHdoaXRlbGlzdGVkSW5kZXg7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gSW52ZXN0b3IpIHByaXZhdGUgaW52ZXN0b3JzOwogICAgYWRkcmVzc1tdIHByaXZhdGUgaW52ZXN0b3JJbmRleDsKCiAgICAvKioqKioKICAgICogU3RhdGUgZm9yIFNhbGUgTW9kZXMKICAgICogIDAgLSBQcmVwYXJpbmc6ICAgICAgICAgICAgQWxsIGNvbnRyYWN0IGluaXRpYWxpemF0aW9uIGNhbGxzCiAgICAqICAxIC0gUHJlU2FsZTogICAgICAgICAgICAgIENvbnRyYWN0IGlzIGluIHRoZSBQcmVzYWxlIFBlcmlvZAogICAgKiAgMiAtIFByZVNhbGVGaW5hbGl6ZWQgICAgICBQcmVzYWxlIHBlcmlvZCBpcyBmaW5hbGl6ZWQsIG5vIG1vcmUgcGF5bWVudHMgYXJlIGFsbG93ZWQKICAgICogIDMgLSBTdWNjZXNzOiAgICAgICAgICAgICAgUHJlc2FsZSBTdWNjZXNzZnVsCiAgICAqICA0IC0gVG9rZW5EaXN0cmlidXRpb246ICAgIFByZXNhbGUgZmluaXNoZWQsIHRva2VucyBjYW4gYmUgZGlzdHJpYnV0ZWQKICAgICogIDUgLSBDbG9zZWQ6ICAgICAgICAgICAgICAgUHJlc2FsZSBjbG9zZWQsIG5vIHRva2VucyBtb3JlIGNhbiBiZSBkaXN0cmlidXRlZAogICAgKi8KICAgIGVudW0gU2FsZVN0YXRlIHsgUHJlcGFyaW5nLCBQcmVTYWxlLCBQcmVTYWxlRmluYWxpemVkLCBTdWNjZXNzLCBUb2tlbkRpc3RyaWJ1dGlvbiwgQ2xvc2VkIH0KICAgIFNhbGVTdGF0ZSBwdWJsaWMgc3RhdGUgPSBTYWxlU3RhdGUuUHJlcGFyaW5nOwoKICAgIC8qKioqKgogICAgKiBTdGF0ZSBmb3IgUHVyY2hhc2UgUGVyaW9kcwogICAgKiAgMCAtIFByZXBhcmluZzogICAgICAgICAgICBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMKICAgICogIDEgLSBXaGl0ZWxpc3Q6ICAgICAgICAgICAgT25seSB3aGl0ZWxpc3RlZCB1c2VycyBjYW4gbWFrZSBwYXltZW50cwogICAgKiAgMiAtIFdoaXRlbGlzdEFwcGxpY2FudDogICBPbmx5IHdoaXRlbGlzdGVkIHVzZXJzIGFuZCB3aGl0ZWxpc3QgYXBwbGljYW50cyBjYW4gbWFrZSBwYXltZW50cwogICAgKiAgMyAtIFB1YmxpYzogICAgICAgICAgICAgICBTYWxlIG9wZW4gdG8gYWxsCiAgICAqLwogICAgZW51bSBQdXJjaGFzZVBlcmlvZCB7IFByZXBhcmluZywgV2hpdGVsaXN0LCBXaGl0ZWxpc3RBcHBsaWNhbnQsIFB1YmxpYyB9CiAgICBQdXJjaGFzZVBlcmlvZCBwdWJsaWMgcHVyY2hhc2VQZXJpb2QgPSBQdXJjaGFzZVBlcmlvZC5QcmVwYXJpbmc7CgogICAgLyoqCiAgICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICAqIEBwYXJhbSBwdXJjaGFzZXIgd2hvIHBhaWQgZm9yIHRoZSB0b2tlbnMKICAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IHdobyBnb3QgdGhlIHRva2VucwogICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAgKiBAcGFyYW0gdG9rZW5zIGFtb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICAqLwogICAgZXZlbnQgTG9nVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IExvZ1Rva2VuRGlzdHJpYnV0aW9uKGFkZHJlc3MgcmVjaXBpZW50LCB1aW50MjU2IHRva2Vucyk7CiAgICBldmVudCBMb2dSZWRpc3RyaWJ1dGVUb2tlbnMoYWRkcmVzcyByZWNpcGllbnQsIFNhbGVTdGF0ZSBfc3RhdGUsIHVpbnQyNTYgdG9rZW5zKTsKICAgIGV2ZW50IExvZ0Z1bmRUcmFuc2ZlcihhZGRyZXNzIHdhbGxldCwgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBMb2dSZWZ1bmQoYWRkcmVzcyB3YWxsZXQsIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgTG9nU3RhdGVDaGFuZ2UoU2FsZVN0YXRlIF9zdGF0ZSk7CiAgICBldmVudCBMb2dOZXdXaGl0ZWxpc3RVc2VyKGFkZHJlc3MgaW5kZXhlZCB1c2VyQWRkcmVzcywgdWludCBpbmRleCwgdWludDI1NiB2YWx1ZSk7CgogICAgLyoqKioqCiAgICAqIEBkZXYgTW9kaWZpZXIgdG8gY2hlY2sgdGhhdCBhbW91bnQgdHJhbnNmZXJyZWQgaXMgbm90IDAKICAgICovCiAgICBtb2RpZmllciBub25aZXJvKCkgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIHRvIGluaXRpYWxpemUgdGhlIFByZXNhbGUKICAgICogQHBhcmFtIF90b2tlbiAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzICAgdGhlIGFkZHJlc3Mgb2YgdGhlIEVSQzIwIHRva2VuIGZvciB0aGUgc2FsZQogICAgKiBAcGFyYW0gX3Rva2VuU3VwcGx5ICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgICB0aGUgYW1vdW50IG9mIHRva2VucyBhdmFpbGFibGUKICAgICovCiAgICBmdW5jdGlvbiBEYWRpUHJlU2FsZSAoU3RhbmRhcmRUb2tlbiBfdG9rZW4sdWludDI1NiBfdG9rZW5TdXBwbHkpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG9rZW5TdXBwbHkgIT0gMCk7CgogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICAgICAgdG9rZW4gPSBTdGFuZGFyZFRva2VuKF90b2tlbik7CiAgICAgICAgdG9rZW5TdXBwbHkgPSBfdG9rZW5TdXBwbHkgKiAodWludDI1NigxMCkgKiogMTgpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEZhbGxiYWNrIEZ1bmN0aW9uIHRvIGJ1eSB0aGUgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gKCkgcHVibGljIG5vblplcm8gcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTYWxlU3RhdGUuUHJlU2FsZSk7CiAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQWxsb3dzIHRoZSBjb250cmFjdCBvd25lciB0byBhZGQgYSBuZXcgUHJlU2FsZSB3YWxsZXQsIHVzZWQgdG8gaG9sZCBmdW5kcyBzYWZlbHkKICAgICogQHBhcmFtIF93YWxsZXQgICAgICAgIGFkZHJlc3MgICAgIFRoZSBhZGRyZXNzIG9mIHRoZSB3YWxsZXQKICAgICogQHJldHVybiBzdWNjZXNzICAgICAgIGJvb2wgICAgICAgIFJldHVybnMgdHJ1ZSBpZiBleGVjdXRlZCBzdWNjZXNzZnVsbHkKICAgICovCiAgICBmdW5jdGlvbiBhZGRQcmVTYWxlV2FsbGV0IChhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBwcmVTYWxlV2FsbGV0cy5wdXNoKF93YWxsZXQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEFsbG93cyB0aGUgY29udHJhY3Qgb3duZXIgdG8gYWRkIG11bHRpcGxlIHdoaXRlbGlzdCB1c2VycywgZWFjaCB3aXRoIGEgd2FsbGV0IGFkZHJlc3MgYW5kIGEgcGxlZGdlZCBjb250cmlidXRpb24KICAgICogQHBhcmFtIHVzZXJBZGRyZXNzZXMgICBhZGRyZXNzW10gICAgIFRoZSBhcnJheSBvZiB3aGl0ZWxpc3Qgd2FsbGV0IGFkZHJlc3NlcwogICAgKiBAcGFyYW0gcGxlZGdlcyAgICAgICAgIHVpbnQyNTZbXSAgICAgVGhlIGFycmF5IG9mIHdoaXRlbGlzdCBwbGVkZ2VzCiAgICAqLwogICAgZnVuY3Rpb24gYWRkV2hpdGVsaXN0VXNlcnMoYWRkcmVzc1tdIHVzZXJBZGRyZXNzZXMsIHVpbnQyNTZbXSBwbGVkZ2VzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB1c2VyQWRkcmVzc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFkZFdoaXRlbGlzdFVzZXIodXNlckFkZHJlc3Nlc1tpXSwgcGxlZGdlc1tpXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEFsbG93cyB0aGUgY29udHJhY3Qgb3duZXIgdG8gYSBzaW5nbGUgd2hpdGVsaXN0IHVzZXIKICAgICogQHBhcmFtIHVzZXJBZGRyZXNzICAgICBhZGRyZXNzICAgICAgVGhlIHdhbGxldCBhZGRyZXNzIHRvIHdoaXRlbGlzdAogICAgKiBAcGFyYW0gcGxlZGdlZCAgICAgICAgIHVpbnQyNTYgICAgICBUaGUgYW1vdW50IHBsZWRnZWQgYnkgdGhlIHVzZXIKICAgICovCiAgICBmdW5jdGlvbiBhZGRXaGl0ZWxpc3RVc2VyKGFkZHJlc3MgdXNlckFkZHJlc3MsIHVpbnQyNTYgcGxlZGdlZCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYgKCFpc1doaXRlbGlzdGVkKHVzZXJBZGRyZXNzKSkgewogICAgICAgICAgICB3aGl0ZWxpc3RlZFt1c2VyQWRkcmVzc10ucGxlZGdlZCA9IHBsZWRnZWQgKiAxMDAwOwogICAgICAgICAgICB3aGl0ZWxpc3RlZFt1c2VyQWRkcmVzc10uaW5kZXggPSB3aGl0ZWxpc3RlZEluZGV4LnB1c2godXNlckFkZHJlc3MpIC0gMTsKICAgICAgICAgIAogICAgICAgICAgICBMb2dOZXdXaGl0ZWxpc3RVc2VyKHVzZXJBZGRyZXNzLCB3aGl0ZWxpc3RlZFt1c2VyQWRkcmVzc10uaW5kZXgsIHBsZWRnZWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDYWxjdWxhdGVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRoYXQgY2FuIGJlIGJvdWdodCBmb3IgdGhlIGFtb3VudCBvZiBXZWkgdHJhbnNmZXJyZWQKICAgICogQHBhcmFtIF9hbW91bnQgICAgdWludDI1NiAgICAgVGhlIGFtb3VudCBvZiBtb25leSBpbnZlc3RlZCBieSB0aGUgaW52ZXN0b3IKICAgICogQHJldHVybiB0b2tlbnMgICAgdWludDI1NiAgICAgVGhlIG51bWJlciBvZiB0b2tlbnMgcHVyY2hhc2VkIGZvciB0aGUgYW1vdW50IGludmVzdGVkCiAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlVG9rZW5zICh1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHRva2VucykgewogICAgICAgIHRva2VucyA9IF9hbW91bnQgKiBldGhSYXRlIC8gcHJlU2FsZVRva2VuUHJpY2U7CiAgICAgICAgcmV0dXJuIHRva2VuczsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDYWxsZWQgYnkgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdCB0byBtb2RpZnkgdGhlIHNhbGUgc3RhdGUKICAgICovCiAgICBmdW5jdGlvbiBzZXRTdGF0ZSAodWludDI1NiBfc3RhdGUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHN0YXRlID0gU2FsZVN0YXRlKHVpbnQoX3N0YXRlKSk7CiAgICAgICAgTG9nU3RhdGVDaGFuZ2Uoc3RhdGUpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENhbGxlZCBieSB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IHRvIG9wZW4gdGhlIFdoaXRlbGlzdEFwcGxpY2FudC9QdWJsaWMgcGVyaW9kcwogICAgKi8KICAgIGZ1bmN0aW9uIHNldFB1cmNoYXNlUGVyaW9kICh1aW50MjU2IHBoYXNlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwdXJjaGFzZVBlcmlvZCA9IFB1cmNoYXNlUGVyaW9kKHVpbnQocGhhc2UpKTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDYWxsZWQgYnkgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdCB0byBzdGFydCB0aGUgUHJlc2FsZQogICAgKiBAcGFyYW0gcmF0ZSAgIHVpbnQyNTYgIHRoZSBjdXJyZW50IEVUSCBVU0QgcmF0ZSwgbXVsdGlwbGllZCBieSAxMDAwCiAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRQcmVTYWxlICh1aW50MjU2IHJhdGUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHN0YXRlID0gU2FsZVN0YXRlLlByZVNhbGU7CiAgICAgICAgcHVyY2hhc2VQZXJpb2QgPSBQdXJjaGFzZVBlcmlvZC5XaGl0ZWxpc3Q7CiAgICAgICAgdXBkYXRlRXRoUmF0ZShyYXRlKTsKICAgICAgICBMb2dTdGF0ZUNoYW5nZShzdGF0ZSk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQWxsb3cgdXBkYXRpbmcgdGhlIEVUSCBVU0QgZXhjaGFuZ2UgcmF0ZQogICAgKiBAcGFyYW0gcmF0ZSAgIHVpbnQyNTYgIHRoZSBjdXJyZW50IEVUSCBVU0QgcmF0ZSwgbXVsdGlwbGllZCBieSAxMDAwCiAgICAqIEByZXR1cm4gYm9vbCAgUmV0dXJuIHRydWUgaWYgdGhlIGNvbnRyYWN0IGlzIGluIFBhcnRuZXJTYWxlIFBlcmlvZAogICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUV0aFJhdGUgKHVpbnQyNTYgcmF0ZSkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShyYXRlID49IDEwMDAwMCk7CiAgICAgICAgCiAgICAgICAgZXRoUmF0ZSA9IHJhdGU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQWxsb3dzIHRyYW5zZmVyIG9mIHRva2VucyB0byBhIHJlY2lwaWVudCB3aG8gaGFzIHB1cmNoYXNlZCBvZmZsaW5lLCBkdXJpbmcgdGhlIFByZVNhbGUKICAgICogQHBhcmFtIF9yZWNpcGllbnQgICAgIGFkZHJlc3MgICAgIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQgb2YgdGhlIHRva2VucwogICAgKiBAcGFyYW0gX3Rva2VucyAgICAgICAgdWludDI1NiAgICAgVGhlIG51bWJlciBvZiB0b2tlbnMgcHVyY2hhc2VkIGJ5IHRoZSByZWNpcGllbnQKICAgICogQHJldHVybiBzdWNjZXNzICAgICAgIGJvb2wgICAgICAgIFJldHVybnMgdHJ1ZSBpZiBleGVjdXRlZCBzdWNjZXNzZnVsbHkKICAgICovCiAgICBmdW5jdGlvbiBvZmZsaW5lVHJhbnNhY3Rpb24gKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NiBfdG9rZW5zKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90b2tlbnMgPiAwKTsKCiAgICAgICAgLy8gQ29udmVydCB0byBhIHRva2VuIHdpdGggZGVjaW1hbHMgCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBfdG9rZW5zICogKHVpbnQyNTYoMTApICoqIHVpbnQ4KDE4KSk7CgogICAgICAgIC8vIGlmIHRoZSBudW1iZXIgb2YgdG9rZW5zIGlzIGdyZWF0ZXIgdGhhbiBhdmFpbGFibGUsIHJlamVjdCB0eAogICAgICAgIGlmICh0b2tlbnMgPj0gZ2V0VG9rZW5zQXZhaWxhYmxlKCkpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBhZGRUb0ludmVzdG9yKF9yZWNpcGllbnQsIDAsIHRva2Vucyk7CgogICAgICAgIC8vIEluY3JlYXNlIHRoZSBjb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkIGluIHRoZSBzYWxlCiAgICAgICAgdXBkYXRlU2FsZVBhcmFtZXRlcnModG9rZW5zKTsKCiAgICAgICAgTG9nVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBfcmVjaXBpZW50LCAwLCB0b2tlbnMpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDYWxsZWQgYnkgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdCB0byBmaW5hbGl6ZSB0aGUgSUNPCiAgICAqICAgICAgYW5kIHJlZGlzdHJpYnV0ZSBmdW5kcyAoaWYgYW55KQogICAgKi8KICAgIGZ1bmN0aW9uIGZpbmFsaXplU2FsZSAoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBzdGF0ZSA9IFNhbGVTdGF0ZS5TdWNjZXNzOwogICAgICAgIExvZ1N0YXRlQ2hhbmdlKHN0YXRlKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgYW55IEVUSCB0byBvbmUgb2YgdGhlIFByZXNhbGUgd2FsbGV0cwogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPiAwKSB7CiAgICAgICAgICAgIGZvcndhcmRGdW5kcyh0aGlzLmJhbGFuY2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDYWxsZWQgYnkgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdCB0byBjbG9zZSB0aGUgU2FsZSBhbmQgcmVkaXN0cmlidXRlIGFueSBjcnVtYnMuCiAgICAqIEBwYXJhbSByZWNpcGllbnQgICAgIGFkZHJlc3MgICAgIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQgb2YgdGhlIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlU2FsZSAoYWRkcmVzcyByZWNpcGllbnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHN0YXRlID0gU2FsZVN0YXRlLkNsb3NlZDsKICAgICAgICBMb2dTdGF0ZUNoYW5nZShzdGF0ZSk7CgogICAgICAgIC8vIHJlZGlzdHJpYnV0ZSB1bnNvbGQgdG9rZW5zIHRvIERBREkgZWNvc3lzdGVtCiAgICAgICAgdWludDI1NiByZW1haW5pbmcgPSBnZXRUb2tlbnNBdmFpbGFibGUoKTsKICAgICAgICB1cGRhdGVTYWxlUGFyYW1ldGVycyhyZW1haW5pbmcpOwoKICAgICAgICBpZiAocmVtYWluaW5nID4gMCkgewogICAgICAgICAgICB0b2tlbi50cmFuc2ZlcihyZWNpcGllbnQsIHJlbWFpbmluZyk7CiAgICAgICAgICAgIExvZ1JlZGlzdHJpYnV0ZVRva2VucyhyZWNpcGllbnQsIHN0YXRlLCByZW1haW5pbmcpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDYWxsZWQgYnkgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdCB0byBhbGxvdyB0b2tlbnMgdG8gYmUgZGlzdHJpYnV0ZWQKICAgICovCiAgICBmdW5jdGlvbiBzZXRUb2tlbkRpc3RyaWJ1dGlvbiAoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBzdGF0ZSA9IFNhbGVTdGF0ZS5Ub2tlbkRpc3RyaWJ1dGlvbjsKICAgICAgICBMb2dTdGF0ZUNoYW5nZShzdGF0ZSk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QgdG8gZGlzdHJpYnV0ZSB0b2tlbnMgdG8gaW52ZXN0b3JzCiAgICAqIEBwYXJhbSBfYWRkcmVzcyAgICAgICBhZGRyZXNzICAgICBUaGUgYWRkcmVzcyBvZiB0aGUgaW52ZXN0b3IgZm9yIHdoaWNoIHRvIGRpc3RyaWJ1dGUgdG9rZW5zCiAgICAqIEByZXR1cm4gc3VjY2VzcyAgICAgICBib29sICAgICAgICBSZXR1cm5zIHRydWUgaWYgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5CiAgICAqLwogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVRva2VucyAoYWRkcmVzcyBfYWRkcmVzcykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTYWxlU3RhdGUuVG9rZW5EaXN0cmlidXRpb24pOwogICAgICAgIAogICAgICAgIC8vIGdldCB0aGUgdG9rZW5zIGF2YWlsYWJsZSBmb3IgdGhlIGludmVzdG9yCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBpbnZlc3RvcnNbX2FkZHJlc3NdLnRva2VuczsKICAgICAgICByZXF1aXJlKHRva2VucyA+IDApOwoKICAgICAgICBpbnZlc3RvcnNbX2FkZHJlc3NdLnRva2VucyA9IDA7CiAgICAgICAgaW52ZXN0b3JzW19hZGRyZXNzXS5jb250cmlidXRpb24gPSAwOwoKICAgICAgICB0b2tlbi50cmFuc2ZlcihfYWRkcmVzcywgdG9rZW5zKTsKICAgICAgCiAgICAgICAgTG9nVG9rZW5EaXN0cmlidXRpb24oX2FkZHJlc3MsIHRva2Vucyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QgdG8gZGlzdHJpYnV0ZSB0b2tlbnMgdG8gaW52ZXN0b3JzIHdobyB1c2VkIGEgbm9uLUVSQzIwIHdhbGxldCBhZGRyZXNzCiAgICAqIEBwYXJhbSBfcHVyY2hhc2VBZGRyZXNzICAgICAgICBhZGRyZXNzICAgICBUaGUgYWRkcmVzcyB0aGUgaW52ZXN0b3IgdXNlZCB0byBidXkgdG9rZW5zCiAgICAqIEBwYXJhbSBfdG9rZW5BZGRyZXNzICAgICAgICAgICBhZGRyZXNzICAgICBUaGUgYWRkcmVzcyB0byBzZW5kIHRoZSB0b2tlbnMgdG8KICAgICogQHJldHVybiBzdWNjZXNzICAgICAgICAgICAgICAgIGJvb2wgICAgICAgIFJldHVybnMgdHJ1ZSBpZiBleGVjdXRlZCBzdWNjZXNzZnVsbHkKICAgICovCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlVG9BbHRlcm5hdGVBZGRyZXNzIChhZGRyZXNzIF9wdXJjaGFzZUFkZHJlc3MsIGFkZHJlc3MgX3Rva2VuQWRkcmVzcykgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTYWxlU3RhdGUuVG9rZW5EaXN0cmlidXRpb24pOwogICAgICAgIAogICAgICAgIC8vIGdldCB0aGUgdG9rZW5zIGF2YWlsYWJsZSBmb3IgdGhlIGludmVzdG9yCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBpbnZlc3RvcnNbX3B1cmNoYXNlQWRkcmVzc10udG9rZW5zOwogICAgICAgIHJlcXVpcmUodG9rZW5zID4gMCk7CgogICAgICAgIGludmVzdG9yc1tfcHVyY2hhc2VBZGRyZXNzXS50b2tlbnMgPSAwOwoKICAgICAgICB0b2tlbi50cmFuc2ZlcihfdG9rZW5BZGRyZXNzLCB0b2tlbnMpOwogICAgICAKICAgICAgICBMb2dUb2tlbkRpc3RyaWJ1dGlvbihfdG9rZW5BZGRyZXNzLCB0b2tlbnMpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENhbGxlZCBieSB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IHRvIHJlZGlzdHJpYnV0ZSB0b2tlbnMgaWYgYW4gaW52ZXN0b3IgaGFzIGJlZW4gcmVmdW5kZWQgb2ZmbGluZQogICAgKiBAcGFyYW0gaW52ZXN0b3JBZGRyZXNzICAgICAgICAgYWRkcmVzcyAgICAgVGhlIGFkZHJlc3MgdGhlIGludmVzdG9yIHVzZWQgdG8gYnV5IHRva2VucwogICAgKiBAcGFyYW0gcmVjaXBpZW50ICAgICAgICAgICAgICAgYWRkcmVzcyAgICAgVGhlIGFkZHJlc3MgdG8gc2VuZCB0aGUgdG9rZW5zIHRvCiAgICAqLwogICAgZnVuY3Rpb24gcmVkaXN0cmlidXRlVG9rZW5zIChhZGRyZXNzIGludmVzdG9yQWRkcmVzcywgYWRkcmVzcyByZWNpcGllbnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gaW52ZXN0b3JzW2ludmVzdG9yQWRkcmVzc10udG9rZW5zOwogICAgICAgIHJlcXVpcmUodG9rZW5zID4gMCk7CiAgICAgICAgCiAgICAgICAgLy8gcmVtb3ZlIHRva2Vucywgc28gdGhleSBjYW4ndCBiZSByZWRpc3RyaWJ1dGVkCiAgICAgICAgaW52ZXN0b3JzW2ludmVzdG9yQWRkcmVzc10udG9rZW5zID0gMDsKICAgICAgICB0b2tlbi50cmFuc2ZlcihyZWNpcGllbnQsIHRva2Vucyk7CgogICAgICAgIExvZ1JlZGlzdHJpYnV0ZVRva2VucyhyZWNpcGllbnQsIHN0YXRlLCB0b2tlbnMpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEdldCB0aGUgYW1vdW50IG9mIFByZVNhbGUgdG9rZW5zIGxlZnQgZm9yIHB1cmNoYXNlCiAgICAqIEByZXR1cm4gdWludDI1NiB0aGUgY291bnQgb2YgdG9rZW5zIGF2YWlsYWJsZQogICAgKi8KICAgIGZ1bmN0aW9uIGdldFRva2Vuc0F2YWlsYWJsZSAoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b2tlblN1cHBseSAtIHRva2Vuc1B1cmNoYXNlZDsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBHZXQgdGhlIHRvdGFsIGNvdW50IG9mIHRva2VucyBwdXJjaGFzZWQgaW4gYWxsIHRoZSBTYWxlIHBlcmlvZHMKICAgICogQHJldHVybiB1aW50MjU2IHRoZSBjb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG9rZW5zUHVyY2hhc2VkICgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRva2Vuc1B1cmNoYXNlZDsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBHZXQgdGhlIGJhbGFuY2Ugc2VudCB0byB0aGUgY29udHJhY3QKICAgICogQHJldHVybiB1aW50MjU2IHRoZSBhbW91bnQgc2VudCB0byB0aGlzIGNvbnRyYWN0LCBpbiBXZWkKICAgICovCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlICgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBDb252ZXJ0cyBhbiBhbW91bnQgc2VudCBpbiBXZWkgdG8gdGhlIGVxdWl2YWxlbnQgaW4gVVNECiAgICAqIEBwYXJhbSBfYW1vdW50ICAgICAgdWludDI1NiAgICAgICB0aGUgYW1vdW50IHNlbnQgdG8gdGhlIGNvbnRyYWN0LCBpbiBXZWkKICAgICogQHJldHVybiB1aW50MjU2ICB0aGUgYW1vdW50IHNlbnQgdG8gdGhpcyBjb250cmFjdCwgaW4gVVNECiAgICAqLwogICAgZnVuY3Rpb24gZXRoVG9Vc2QgKHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKF9hbW91bnQgKiBldGhSYXRlKSAvICh1aW50MjU2KDEwKSAqKiAxOCk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgR2V0IHRoZSBvdmVyYWxsIHN1Y2Nlc3Mgc3RhdGUgb2YgdGhlIElDTwogICAgKiBAcmV0dXJuIGJvb2wgd2hldGhlciB0aGUgc3RhdGUgaXMgc3VjY2Vzc2Z1bCwgb3Igbm90CiAgICAqLwogICAgZnVuY3Rpb24gaXNTdWNjZXNzZnVsICgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlID09IFNhbGVTdGF0ZS5TdWNjZXNzOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEdldCBhIHdoaXRlbGlzdGVkIHVzZXIKICAgICogQHBhcmFtIHVzZXJBZGRyZXNzICAgICAgYWRkcmVzcyAgICAgICB0aGUgd2FsbGV0IGFkZHJlc3Mgb2YgdGhlIHVzZXIKICAgICogQHJldHVybiB1aW50MjU2ICB0aGUgYW1vdW50IHBsZWRnZWQgYnkgdGhlIHVzZXIKICAgICogQHJldHVybiB1aW50ICAgICB0aGUgaW5kZXggb2YgdGhlIHVzZXIKICAgICovCiAgICBmdW5jdGlvbiBnZXRXaGl0ZWxpc3RVc2VyIChhZGRyZXNzIHVzZXJBZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBwbGVkZ2VkLCB1aW50IGluZGV4KSB7CiAgICAgICAgcmVxdWlyZShpc1doaXRlbGlzdGVkKHVzZXJBZGRyZXNzKSk7CiAgICAgICAgcmV0dXJuKHdoaXRlbGlzdGVkW3VzZXJBZGRyZXNzXS5wbGVkZ2VkLCB3aGl0ZWxpc3RlZFt1c2VyQWRkcmVzc10uaW5kZXgpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEdldCBjb3VudCBvZiBjb250cmlidXRvcnMKICAgICogQHJldHVybiB1aW50ICAgICB0aGUgbnVtYmVyIG9mIHVuaXF1ZSBjb250cmlidXRvcnMKICAgICovCiAgICBmdW5jdGlvbiBnZXRJbnZlc3RvckNvdW50ICgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIGludmVzdG9ySW5kZXgubGVuZ3RoOwogICAgfQoKCiAgICAvKioqKioKICAgICogQGRldiBHZXQgYW4gaW52ZXN0b3IKICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgYWRkcmVzcyAgICAgICB0aGUgd2FsbGV0IGFkZHJlc3Mgb2YgdGhlIGludmVzdG9yCiAgICAqIEByZXR1cm4gdWludDI1NiAgdGhlIGFtb3VudCBjb250cmlidXRlZCBieSB0aGUgdXNlcgogICAgKiBAcmV0dXJuIHVpbnQyNTYgIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFzc2lnbmVkIHRvIHRoZSB1c2VyCiAgICAqIEByZXR1cm4gdWludCAgICAgdGhlIGluZGV4IG9mIHRoZSB1c2VyCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0SW52ZXN0b3IgKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGNvbnRyaWJ1dGlvbiwgdWludDI1NiB0b2tlbnMsIHVpbnQgaW5kZXgpIHsKICAgICAgICByZXF1aXJlKGlzSW52ZXN0ZWQoX2FkZHJlc3MpKTsKICAgICAgICByZXR1cm4oaW52ZXN0b3JzW19hZGRyZXNzXS5jb250cmlidXRpb24sIGludmVzdG9yc1tfYWRkcmVzc10udG9rZW5zLCBpbnZlc3RvcnNbX2FkZHJlc3NdLmluZGV4KTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBHZXQgYSB1c2VyJ3Mgd2hpdGVsaXN0ZWQgc3RhdGUKICAgICogQHBhcmFtIHVzZXJBZGRyZXNzICAgICAgYWRkcmVzcyAgICAgICB0aGUgd2FsbGV0IGFkZHJlc3Mgb2YgdGhlIHVzZXIKICAgICogQHJldHVybiBib29sICB0cnVlIGlmIHRoZSB1c2VyIGlzIGluIHRoZSB3aGl0ZWxpc3QKICAgICovCiAgICBmdW5jdGlvbiBpc1doaXRlbGlzdGVkIChhZGRyZXNzIHVzZXJBZGRyZXNzKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sIGlzSW5kZWVkKSB7CiAgICAgICAgaWYgKHdoaXRlbGlzdGVkSW5kZXgubGVuZ3RoID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gKHdoaXRlbGlzdGVkSW5kZXhbd2hpdGVsaXN0ZWRbdXNlckFkZHJlc3NdLmluZGV4XSA9PSB1c2VyQWRkcmVzcyk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgR2V0IGEgdXNlcidzIGludmVzdGVkIHN0YXRlCiAgICAqIEBwYXJhbSBfYWRkcmVzcyAgICAgIGFkZHJlc3MgICAgICAgdGhlIHdhbGxldCBhZGRyZXNzIG9mIHRoZSB1c2VyCiAgICAqIEByZXR1cm4gYm9vbCAgdHJ1ZSBpZiB0aGUgdXNlciBoYXMgYWxyZWFkeSBjb250cmlidXRlZAogICAgKi8KICAgIGZ1bmN0aW9uIGlzSW52ZXN0ZWQgKGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wgaXNJbmRlZWQpIHsKICAgICAgICBpZiAoaW52ZXN0b3JJbmRleC5sZW5ndGggPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiAoaW52ZXN0b3JJbmRleFtpbnZlc3RvcnNbX2FkZHJlc3NdLmluZGV4XSA9PSBfYWRkcmVzcyk7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgVXBkYXRlIGEgdXNlcidzIGludmVzdGVkIHN0YXRlCiAgICAqIEBwYXJhbSBfYWRkcmVzcyAgICAgIGFkZHJlc3MgICAgICAgdGhlIHdhbGxldCBhZGRyZXNzIG9mIHRoZSB1c2VyCiAgICAqIEBwYXJhbSBfdmFsdWUgICAgICAgIHVpbnQyNTYgICAgICAgdGhlIGFtb3VudCBjb250cmlidXRlZCBpbiB0aGlzIHRyYW5zYWN0aW9uCiAgICAqIEBwYXJhbSBfdG9rZW5zICAgICAgIHVpbnQyNTYgICAgICAgdGhlIG51bWJlciBvZiB0b2tlbnMgYXNzaWduZWQgaW4gdGhpcyB0cmFuc2FjdGlvbgogICAgKi8KICAgIGZ1bmN0aW9uIGFkZFRvSW52ZXN0b3IoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX3Rva2VucykgaW50ZXJuYWwgewogICAgICAgIC8vIGFkZCB0aGUgdXNlciB0byB0aGUgaW52ZXN0b3JJbmRleCBpZiB0aGlzIGlzIHRoZWlyIGZpcnN0IGNvbnRyaWJ1dGlvbgogICAgICAgIGlmICghaXNJbnZlc3RlZChfYWRkcmVzcykpIHsKICAgICAgICAgICAgaW52ZXN0b3JzW19hZGRyZXNzXS5pbmRleCA9IGludmVzdG9ySW5kZXgucHVzaChfYWRkcmVzcykgLSAxOwogICAgICAgIH0KICAgICAgCiAgICAgICAgaW52ZXN0b3JzW19hZGRyZXNzXS50b2tlbnMgPSBpbnZlc3RvcnNbX2FkZHJlc3NdLnRva2Vucy5hZGQoX3Rva2Vucyk7CiAgICAgICAgaW52ZXN0b3JzW19hZGRyZXNzXS5jb250cmlidXRpb24gPSBpbnZlc3RvcnNbX2FkZHJlc3NdLmNvbnRyaWJ1dGlvbi5hZGQoX3ZhbHVlKTsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBTZW5kIGV0aGVyIHRvIHRoZSBwcmVzYWxlIGNvbGxlY3Rpb24gd2FsbGV0cwogICAgKi8KICAgIGZ1bmN0aW9uIGZvcndhcmRGdW5kcyAodWludDI1NiBfdmFsdWUpIGludGVybmFsIHsKICAgICAgICB1aW50IGFjY291bnROdW1iZXI7CiAgICAgICAgYWRkcmVzcyBhY2NvdW50OwoKICAgICAgICAvLyBtb3ZlIGZ1bmRzIHRvIGEgcmFuZG9tIHByZVNhbGVXYWxsZXQKICAgICAgICBpZiAocHJlU2FsZVdhbGxldHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBhY2NvdW50TnVtYmVyID0gZ2V0UmFuZG9tKHByZVNhbGVXYWxsZXRzLmxlbmd0aCkgLSAxOwogICAgICAgICAgICBhY2NvdW50ID0gcHJlU2FsZVdhbGxldHNbYWNjb3VudE51bWJlcl07CiAgICAgICAgICAgIGFjY291bnQudHJhbnNmZXIoX3ZhbHVlKTsKICAgICAgICAgICAgTG9nRnVuZFRyYW5zZmVyKGFjY291bnQsIF92YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGFzc2lnbiB0b2tlbnMgdG8gdGhlIGNvbnRyaWJ1dG9yCiAgICAqIEBwYXJhbSBfYWRkcmVzcyAgICAgICBhZGRyZXNzICAgICBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJpYnV0aW5nIGludmVzdG9yCiAgICAqIEBwYXJhbSBfdmFsdWUgICAgICAgICB1aW50MjU2ICAgICBUaGUgYW1vdW50IGludmVzdGVkIAogICAgKiBAcmV0dXJuIHN1Y2Nlc3MgICAgICAgYm9vbCAgICAgICAgUmV0dXJucyB0cnVlIGlmIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIGJ1eVRva2VucyAoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfdmFsdWUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGlzQmVsb3dDYXAoX3ZhbHVlKSk7CgogICAgICAgIGlmIChpc1doaXRlbGlzdFBlcmlvZCgpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoaXNXaGl0ZWxpc3RlZChfYWRkcmVzcykpOwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShpc1ZhbGlkQ29udHJpYnV0aW9uKF9hZGRyZXNzLCBfdmFsdWUpKTsKCiAgICAgICAgdWludDI1NiBib3VnaHRUb2tlbnMgPSBjYWxjdWxhdGVUb2tlbnMoX3ZhbHVlKTsKICAgICAgICByZXF1aXJlKGJvdWdodFRva2VucyAhPSAwKTsKCiAgICAgICAgLy8gaWYgdGhlIG51bWJlciBvZiB0b2tlbnMgY2FsY3VsYXRlZCBmb3IgdGhlIGdpdmVuIHZhbHVlIGlzIAogICAgICAgIC8vIGdyZWF0ZXIgdGhhbiB0aGUgdG9rZW5zIGF2YWlsYWJsZSwgcmVqZWN0IHRoZSBwYXltZW50CiAgICAgICAgaWYgKGJvdWdodFRva2VucyA+PSBnZXRUb2tlbnNBdmFpbGFibGUoKSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIC8vIHVwZGF0ZSBpbnZlc3RvciBzdGF0ZQogICAgICAgIGFkZFRvSW52ZXN0b3IoX2FkZHJlc3MsIF92YWx1ZSwgYm91Z2h0VG9rZW5zKTsKCiAgICAgICAgTG9nVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBfYWRkcmVzcywgX3ZhbHVlLCBib3VnaHRUb2tlbnMpOwoKICAgICAgICBmb3J3YXJkRnVuZHMoX3ZhbHVlKTsKCiAgICAgICAgdXBkYXRlU2FsZVBhcmFtZXRlcnMoYm91Z2h0VG9rZW5zKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2hlY2sgdGhhdCB0aGUgYW1vdW50IHNlbnQgaW4gdGhlIHRyYW5zYWN0aW9uIGlzIGJlbG93IHRoZSBpbmRpdmlkdWFsIGNhcCwgb3IgYmVsb3cgdGhlIHBsZWRnZWQKICAgICogYW1vdW50IGlmIHRoZSB1c2VyIGlzIHdoaXRlbGlzdGVkIGFuZCB0aGUgc2FsZSBpcyBpbiB0aGUgd2hpdGVsaXN0IHBlcmlvZC4gRmFjdG9ycyBpbiBwcmV2aW91cwogICAgKiB0cmFuc2FjdGlvbiBieSB0aGUgc2FtZSB1c2VyCiAgICAqIEBwYXJhbSBfYWRkcmVzcyAgICAgICAgIGFkZHJlc3MgICAgIFRoZSBhZGRyZXNzIG9mIHRoZSB1c2VyIG1ha2luZyB0aGUgdHJhbnNhY3Rpb24KICAgICogQHBhcmFtIF9hbW91bnQgICAgICAgICAgdWludDI1NiAgICAgVGhlIGFtb3VudCBzZW50IGluIHRoZSB0cmFuc2FjdGlvbgogICAgKiBAcmV0dXJuICAgICAgICBib29sICAgICAgICBSZXR1cm5zIHRydWUgaWYgdGhlIGFtb3VudCBpcyB2YWxpZAogICAgKi8KICAgIGZ1bmN0aW9uIGlzVmFsaWRDb250cmlidXRpb24gKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQyNTYgX2Ftb3VudCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCB2YWxpZCkgewogICAgICAgIGlmIChpc1doaXRlbGlzdFBlcmlvZCgpICYmIGlzV2hpdGVsaXN0ZWQoX2FkZHJlc3MpKSB7CiAgICAgICAgICAgIHJldHVybiBldGhUb1VzZChfYW1vdW50ICsgaW52ZXN0b3JzW19hZGRyZXNzXS5jb250cmlidXRpb24pIDw9IHdoaXRlbGlzdGVkW19hZGRyZXNzXS5wbGVkZ2VkOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGlzQmVsb3dDYXAoX2Ftb3VudCArIGludmVzdG9yc1tfYWRkcmVzc10uY29udHJpYnV0aW9uKTsgCiAgICB9CgogICAgLyoqKioqCiAgICAqIEBkZXYgQ2hlY2sgdGhhdCB0aGUgYW1vdW50IHNlbnQgaW4gdGhlIHRyYW5zYWN0aW9uIGlzIGJlbG93IHRoZSBpbmRpdmlkdWFsIGNhcAogICAgKiBAcGFyYW0gX2Ftb3VudCAgICAgICAgIHVpbnQyNTYgICAgIFRoZSBhbW91bnQgc2VudCBpbiB0aGUgdHJhbnNhY3Rpb24KICAgICogQHJldHVybiAgICAgICAgYm9vbCAgICAgICAgUmV0dXJucyB0cnVlIGlmIHRoZSBhbW91bnQgaXMgYmVsb3cgdGhlIGluZGl2aWR1YWwgY2FwCiAgICAqLwogICAgZnVuY3Rpb24gaXNCZWxvd0NhcCAodWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGV0aFRvVXNkKF9hbW91bnQpIDwgaW5kaXZpZHVhbENhcDsKICAgIH0KCiAgICAvKioqKioKICAgICogQGRldiBHZW5lcmF0ZXMgYSByYW5kb20gbnVtYmVyIGZyb20gMSB0byBtYXggYmFzZWQgb24gdGhlIGxhc3QgYmxvY2sgaGFzaAogICAgKiBAcGFyYW0gbWF4ICAgICB1aW50ICB0aGUgbWF4aW11bSB2YWx1ZSAKICAgICogQHJldHVybiBhIHJhbmRvbSBudW1iZXIKICAgICovCiAgICBmdW5jdGlvbiBnZXRSYW5kb20odWludCBtYXgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmFuZG9tTnVtYmVyKSB7CiAgICAgICAgcmV0dXJuICh1aW50KGtlY2NhazI1NihibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyIC0gMSkpKSAlIG1heCkgKyAxOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIG1vZGlmeSBwYXJhbWV0ZXJzIGJhc2VkIG9uIHRva2VucyBib3VnaHQKICAgICogQHBhcmFtIF90b2tlbnMgICAgICAgIHVpbnQyNTYgICAgIFRoZSBudW1iZXIgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZVNhbGVQYXJhbWV0ZXJzICh1aW50MjU2IF90b2tlbnMpIGludGVybmFsIHsKICAgICAgICB0b2tlbnNQdXJjaGFzZWQgPSB0b2tlbnNQdXJjaGFzZWQuYWRkKF90b2tlbnMpOwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENoZWNrIHRoZSBzdGF0ZSBvZiB0aGUgY29udHJhY3QKICAgICogQHJldHVybiBib29sICBSZXR1cm4gdHJ1ZSBpZiB0aGUgY29udHJhY3QgaXMgaW4gdGhlIFdoaXRlbGlzdCBwZXJpb2QKICAgICovCiAgICBmdW5jdGlvbiBpc1doaXRlbGlzdFBlcmlvZCAoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcHVyY2hhc2VQZXJpb2QgPT0gUHVyY2hhc2VQZXJpb2QuV2hpdGVsaXN0OwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENoZWNrIHRoZSBzdGF0ZSBvZiB0aGUgY29udHJhY3QKICAgICogQHJldHVybiBib29sICBSZXR1cm4gdHJ1ZSBpZiB0aGUgY29udHJhY3QgaXMgaW4gdGhlIFdoaXRlbGlzdEFwcGxpY2FudCBwZXJpb2QKICAgICovCiAgICBmdW5jdGlvbiBpc1doaXRlbGlzdEFwcGxpY2FudFBlcmlvZCAoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcHVyY2hhc2VQZXJpb2QgPT0gUHVyY2hhc2VQZXJpb2QuV2hpdGVsaXN0QXBwbGljYW50OwogICAgfQoKICAgIC8qKioqKgogICAgKiBAZGV2IENoZWNrIHRoZSBzdGF0ZSBvZiB0aGUgY29udHJhY3QKICAgICogQHJldHVybiBib29sICBSZXR1cm4gdHJ1ZSBpZiB0aGUgY29udHJhY3QgaXMgaW4gdGhlIFB1YmxpYyBwZXJpb2QKICAgICovCiAgICBmdW5jdGlvbiBpc1B1YmxpY1BlcmlvZCAoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcHVyY2hhc2VQZXJpb2QgPT0gUHVyY2hhc2VQZXJpb2QuUHVibGljOwogICAgfQp9'.
	

]
