Class {
	#name : #SRT89b5b861dcb455483f48a87bf430bfa48cc6f385,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT89b5b861dcb455483f48a87bf430bfa48cc6f385 >> base64 [
	^ 'bGlicmFyeSBXYWxsZXRNYWluTGliIHsKICB1c2luZyBBcnJheTI1NkxpYiBmb3IgdWludDI1NltdOwogIHVzaW5nIEJhc2ljTWF0aExpYiBmb3IgdWludDI1NjsKCiAgc3RydWN0IFdhbGxldERhdGEgewogICAgdWludDI1NiBtYXhPd25lcnM7IC8vTWF4aW11bSB3YWxsZXQgb3duZXJzLCBzaG91bGQgYmUgNTAKICAgIGFkZHJlc3NbXSBvd25lcnM7IC8vQXJyYXkgb2YgYWxsIG93bmVycwogICAgdWludDI1NiByZXF1aXJlZEFkbWluOyAvL051bWJlciBvZiBzaWdzIHJlcXVpcmVkIGZvciBhZG1pbmlzdHJhdGl2ZSBjaGFuZ2VzCiAgICB1aW50MjU2IHJlcXVpcmVkTWFqb3I7IC8vTnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgZm9yIG1ham9yIHRyYW5zYWN0aW9ucwogICAgdWludDI1NiByZXF1aXJlZE1pbm9yOyAvL051bWJlciBvZiBzaWdzIHJlcXVpcmVkIGZvciBtaW5vciB0cmFuc2FjdGlvbnMKCiAgICAvLyBUaGUgYW1vdW50IG9mIGEgdG9rZW4gc3BlbnQgcGVyIGRheSwgZXRoZXIgaXMgYXQgYWRkcmVzcyBtYXBwaW5nIDAsCiAgICAvLyBhbGwgb3RoZXIgdG9rZW5zIGRlZmluZWQgYnkgYWRkcmVzcy4gdWludDI1NlswXSBjb3JyZXNwb25kcyB0byB0aGUgY3VycmVudAogICAgLy8gZGF5LCAgdWludDI1NlsxXSBpcyB0aGUgc3BlbmQgYW1vdW50CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTZbMl0pIGN1cnJlbnRTcGVuZDsKICAgIC8vVGhlIGRheSBzcGVuZCB0aHJlc2hvbGQgZm9yIHRyYW5zYWN0aW9ucyB0byBiZSBtYWpvciwgZXRoZXIgYXQgMCwgYWxsIG90aGVycyBieSBhZGRyZXNzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIG1ham9yVGhyZXNob2xkOwogICAgLy9BcnJheSBvZiB0cmFuc2FjdGlvbnMgcGVyIGRheSwgdWludDI1NiBpcyB0aGUgZGF5IHRpbWVzdGFtcCwgYnl0ZXMzMiBpcyB0aGUgdHJhbnNhY3Rpb24gaWQKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYnl0ZXMzMltdKSB0cmFuc2FjdGlvbnM7CiAgICAvL1RyYWNrcyB0aGUgaW5kZXggb2YgZWFjaCBvd25lciBpbiB0aGUgb3duZXJzIEFycmF5CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVySW5kZXg7CiAgICAvL0FycmF5IG9mIFRyYW5zYWN0aW9uJ3MgYnkgaWQsIG5ldyB0eCdzIHdpdGggZXhhY3QgaW5wdXRzIGFzIHByZXZpb3VzIHR4IHdpbGwgYWRkIHRvIGFycmF5CiAgICBtYXBwaW5nIChieXRlczMyID0+IFRyYW5zYWN0aW9uW10pIHRyYW5zYWN0aW9uSW5mbzsKCiAgfQoKICBzdHJ1Y3QgVHJhbnNhY3Rpb24gewogICAgdWludDI1NiBkYXk7IC8vVGltZXN0YW1wIG9mIHRoZSBkYXkgaW5pdGlhbGl6ZWQKICAgIHVpbnQyNTYgdmFsdWU7IC8vQW1vdW50IG9mIGV0aGVyIGJlaW5nIHNlbnQKICAgIGFkZHJlc3MgdG9rZW5BZHJlc3M7IC8vQWRkcmVzcyBvZiB0b2tlbiB0cmFuc2ZlcnJlZAogICAgdWludDI1NiBhbW91bnQ7IC8vQW1vdW50IG9mIHRva2VucyB0cmFuc2ZlcnJlZAogICAgYnl0ZXMgZGF0YTsgLy9UZW1wIGxvY2F0aW9uIGZvciBwZW5kaW5nIHRyYW5zYWN0aW9ucywgZXJhc2VkIGFmdGVyIGZpbmFsIGNvbmZpcm1hdGlvbgogICAgdWludDI1NltdIGNvbmZpcm1lZE93bmVyczsgLy9BcnJheSBvZiBvd25lcnMgY29uZmlybWluZyB0cmFuc2FjdGlvbgogICAgdWludDI1NiBjb25maXJtQ291bnQ7IC8vVHJhY2tzIHRoZSBudW1iZXIgb2YgY29uZmlybXMKICAgIHVpbnQyNTYgY29uZmlybVJlcXVpcmVkOyAvL051bWJlciBvZiBzaWdzIHJlcXVpcmVkIGZvciB0aGlzIHRyYW5zYWN0aW9uCiAgICBib29sIHN1Y2Nlc3M7IC8vVHJ1ZSBhZnRlciBmaW5hbCBjb25maXJtYXRpb24KICB9CgogIC8qRXZlbnRzKi8KICBldmVudCBMb2dSZXZva2VOb3RpY2UoYnl0ZXMzMiB0eGlkLCBhZGRyZXNzIHNlbmRlciwgdWludDI1NiBjb25maXJtc05lZWRlZCk7CiAgZXZlbnQgTG9nVHJhbnNhY3Rpb25GYWlsZWQoYnl0ZXMzMiB0eGlkLCBhZGRyZXNzIHNlbmRlcik7CiAgZXZlbnQgTG9nVHJhbnNhY3Rpb25Db25maXJtZWQoYnl0ZXMzMiB0eGlkLCBhZGRyZXNzIHNlbmRlciwgdWludDI1NiBjb25maXJtc05lZWRlZCk7CiAgZXZlbnQgTG9nVHJhbnNhY3Rpb25Db21wbGV0ZShieXRlczMyIHR4aWQsIGFkZHJlc3MgdGFyZ2V0LCB1aW50MjU2IHZhbHVlLCBieXRlcyBkYXRhKTsKICBldmVudCBMb2dDb250cmFjdENyZWF0ZWQoYWRkcmVzcyBuZXdDb250cmFjdCwgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgTG9nRXJyb3JNc2codWludDI1NiBhbW91bnQsIHN0cmluZyBtc2cpOwoKICAvLy8gQGRldiBDb25zdHJ1Y3RvcgogIC8vLyBAcGFyYW0gc2VsZiBUaGUgd2FsbGV0IGluIGNvbnRyYWN0IHN0b3JhZ2UKICAvLy8gQHBhcmFtIF9vd25lcnMgQXJyYXkgb2YgaW5pdGlhbCBvd25lcnMKICAvLy8gQHBhcmFtIF9yZXF1aXJlZEFkbWluIFNldCBudW1iZXIgb2Ygc2lncyBmb3IgYWRtaW5pc3RyYXRpdmUgdGFza3MKICAvLy8gQHBhcmFtIF9yZXF1aXJlZE1ham9yIFNldCBudW1iZXIgb2Ygc2lncyBmb3IgbWFqb3IgdHgKICAvLy8gQHBhcmFtIF9yZXF1aXJlZE1pbm9yIFNldCBudW1iZXIgb2Ygc2lncyBmb3IgbWlub3IgdHgKICAvLy8gQHBhcmFtIF9tYWpvclRocmVzaG9sZCBTZXQgbWFqb3IgdHggdGhyZXNob2xkIGFtb3VudCBmb3IgZXRoZXIKICAvLy8gQHJldHVybiBXaWxsIHJldHVybiB0cnVlIHdoZW4gY29tcGxldGUKICBmdW5jdGlvbiBpbml0KFdhbGxldERhdGEgc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgYWRkcmVzc1tdIF9vd25lcnMsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9yZXF1aXJlZEFkbWluLAogICAgICAgICAgICAgICAgdWludDI1NiBfcmVxdWlyZWRNYWpvciwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX3JlcXVpcmVkTWlub3IsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9tYWpvclRocmVzaG9sZCkgcHVibGljIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShzZWxmLm93bmVycy5sZW5ndGggPT0gMCk7CiAgICByZXF1aXJlKF9vd25lcnMubGVuZ3RoID49IF9yZXF1aXJlZEFkbWluICYmIF9yZXF1aXJlZEFkbWluID4gMCk7CiAgICByZXF1aXJlKF9vd25lcnMubGVuZ3RoID49IF9yZXF1aXJlZE1ham9yICYmIF9yZXF1aXJlZE1ham9yID4gMCk7CiAgICByZXF1aXJlKF9vd25lcnMubGVuZ3RoID49IF9yZXF1aXJlZE1pbm9yICYmIF9yZXF1aXJlZE1pbm9yID4gMCk7CiAgICBzZWxmLm93bmVycy5wdXNoKDApOyAvL0xlYXZlIGluZGV4LTAgZW1wdHkgZm9yIGVhc2llciBvd25lciBjaGVja3MKCiAgICBmb3IgKHVpbnQyNTYgaT0wOyBpPF9vd25lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVxdWlyZShfb3duZXJzW2ldICE9IDApOwogICAgICBzZWxmLm93bmVycy5wdXNoKF9vd25lcnNbaV0pOwogICAgICBzZWxmLm93bmVySW5kZXhbX293bmVyc1tpXV0gPSBpKzE7CiAgICB9CiAgICBzZWxmLnJlcXVpcmVkQWRtaW4gPSBfcmVxdWlyZWRBZG1pbjsKICAgIHNlbGYucmVxdWlyZWRNYWpvciA9IF9yZXF1aXJlZE1ham9yOwogICAgc2VsZi5yZXF1aXJlZE1pbm9yID0gX3JlcXVpcmVkTWlub3I7CiAgICBzZWxmLm1heE93bmVycyA9IDUwOyAvL0xpbWl0cyB0byA1MCBvd25lcnMsIHNob3VsZCBjcmVhdGUgd2FsbGV0IHBvb2xzIGZvciBtb3JlIG93bmVycwogICAgc2VsZi5tYWpvclRocmVzaG9sZFswXSA9IF9tYWpvclRocmVzaG9sZDsgLy9TZXRzIGV0aGVyIHRocmVzaG9sZCBhdCBhZGRyZXNzIDAKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qQ2hlY2tzKi8KCiAgLy8vIEBkZXYgVmVyaWZpZXMgYSBjb25maXJtaW5nIG93bmVyIGhhcyBub3QgY29uZmlybWVkIGFscmVhZHkKICAvLy8gQHBhcmFtIHNlbGYgQ29udHJhY3Qgd2FsbGV0IGluIHN0b3JhZ2UKICAvLy8gQHBhcmFtIF9pZCBJRCBvZiB0aGUgdHggYmVpbmcgY2hlY2tlZAogIC8vLyBAcGFyYW0gX3R4SW5kZXggSW5kZXggbnVtYmVyIG9mIHRoaXMgdHgKICAvLy8gQHJldHVybiBSZXR1cm5zIHRydWUgaWYgY2hlY2sgcGFzc2VzLCBmYWxzZSBvdGhlcndpc2UKICBmdW5jdGlvbiBjaGVja05vdENvbmZpcm1lZChXYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZiwgYnl0ZXMzMiBfaWQsIHVpbnQyNTYgX3R4SW5kZXgpCiAgICAgICAgICAgcHVibGljIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShzZWxmLm93bmVySW5kZXhbbXNnLnNlbmRlcl0gPiAwKTsKICAgIHVpbnQyNTYgX3R4TGVuID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGg7CgogICAgaWYoX3R4TGVuID09IDAgfHwgX3R4SW5kZXggPj0gX3R4TGVuKXsKICAgICAgTG9nRXJyb3JNc2coX3R4TGVuLCAiVHggbm90IGluaXRpYXRlZCIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uc3VjY2Vzcyl7CiAgICAgIExvZ0Vycm9yTXNnKF90eEluZGV4LCAiVHJhbnNhY3Rpb24gYWxyZWFkeSBjb21wbGV0ZSIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy9GdW5jdGlvbiBmcm9tIE1vZHVsYXIuaW8gYXJyYXkgdXRpbGl0eSBsaWJyYXJ5CiAgICBib29sIGZvdW5kOwogICAgdWludDI1NiBpbmRleDsKICAgIChmb3VuZCwgaW5kZXgpID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybWVkT3duZXJzLmluZGV4T2YodWludDI1Nihtc2cuc2VuZGVyKSwgZmFsc2UpOwogICAgaWYoZm91bmQpewogICAgICBMb2dFcnJvck1zZyhpbmRleCwgIk93bmVyIGFscmVhZHkgY29uZmlybWVkIik7CiAgICAgIExvZ1RyYW5zYWN0aW9uRmFpbGVkKF9pZCwgbXNnLnNlbmRlcik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qVXRpbGl0eSBGdW5jdGlvbnMqLwoKICAvLy8gQGRldiBVc2VkIGxhdGVyIHRvIGNhbGN1bGF0ZSB0aGUgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMgbmVlZGVkIGZvciB0eAogIC8vLyBAcGFyYW0gX3JlcXVpcmVkIE51bWJlciBvZiBzaWdzIHJlcXVpcmVkCiAgLy8vIEBwYXJhbSBfY291bnQgQ3VycmVudCBudW1iZXIgb2Ygc2lncwogIGZ1bmN0aW9uIGNhbGNDb25maXJtc05lZWRlZCh1aW50MjU2IF9yZXF1aXJlZCwgdWludDI1NiBfY291bnQpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQyNTYpewogICAgcmV0dXJuIF9yZXF1aXJlZCAtIF9jb3VudDsKICB9CgogIC8vLyBAZGV2IFVzZWQgdG8gY2hlY2sgaWYgdHggaXMgbW92aW5nIHRva2VucyBhbmQgcGFyc2VzIGFtb3VudAogIC8vLyBAcGFyYW0gX3R4RGF0YSBEYXRhIGZvciBwcm9wb3NlZCB0eAogIC8vLyBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0cmFuc2FjdGlvbiBpcyBtb3ZpbmcgdG9rZW5zCiAgLy8vIEByZXR1cm4gdWludDI1NiBBbW91bnQgb2YgdG9rZW5zIGludm9sdmVkLCAwIGlmIG5vdCBzcGVuZGluZyB0eAogIGZ1bmN0aW9uIGdldEFtb3VudChieXRlcyBfdHhEYXRhKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sLHVpbnQyNTYpIHsKICAgIGJ5dGVzMzIgZ2V0U2lnOwogICAgYnl0ZXM0IHNpZzsKICAgIGJ5dGVzNCB0U2lnID0gMHhhOTA1OWNiYjsgLy90cmFuc2ZlciBmdW5jIHNpZ25hdHVyZQogICAgYnl0ZXM0IGFTaWcgPSAweDA5NWVhN2IzOyAvL2FwcHJvdmUgZnVuYyBzaWduYXR1cmUKICAgIGJ5dGVzNCB0ZlNpZyA9IDB4MjNiODcyZGQ7IC8vdHJhbnNmZXJGcm9tIGZ1bmMgc2lnbmF0dXJlCiAgICBib29sIHRyYW5zZmVyOwogICAgYnl0ZXMzMiBfYW1vdW50RGF0YTsKICAgIHVpbnQyNTYgX2Ftb3VudDsKCiAgICBhc3NlbWJseSB7IGdldFNpZyA6PSBtbG9hZChhZGQoX3R4RGF0YSwweDIwKSkgfQogICAgc2lnID0gYnl0ZXM0KGdldFNpZyk7CiAgICBpZihzaWcgPT0gIHRTaWcgfHwgc2lnID09IGFTaWcpewogICAgICB0cmFuc2ZlciA9IHRydWU7CiAgICAgIGFzc2VtYmx5IHsgX2Ftb3VudERhdGEgOj0gbWxvYWQoYWRkKF90eERhdGEsMHg0NCkpIH0KICAgICAgX2Ftb3VudCA9IHVpbnQyNTYoX2Ftb3VudERhdGEpOwogICAgfSBlbHNlIGlmKHNpZyA9PSB0ZlNpZyl7CiAgICAgIHRyYW5zZmVyID0gdHJ1ZTsKICAgICAgYXNzZW1ibHkgeyBfYW1vdW50RGF0YSA6PSBtbG9hZChhZGQoX3R4RGF0YSwweDY0KSkgfQogICAgICBfYW1vdW50ID0gdWludDI1NihfYW1vdW50RGF0YSk7CiAgICB9CiAgICByZXR1cm4gKHRyYW5zZmVyLF9hbW91bnQpOwogIH0KCiAgLy8vIEBkZXYgUmV0cmlldmVzIHNpZyByZXF1aXJlbWVudCBmb3Igc3BlbmRpbmcgdHgKICAvLy8gQHBhcmFtIHNlbGYgQ29udHJhY3Qgd2FsbGV0IGluIHN0b3JhZ2UKICAvLy8gQHBhcmFtIF90byBUYXJnZXQgYWRkcmVzcyBvZiB0cmFuc2FjdGlvbgogIC8vLyBAcGFyYW0gX3ZhbHVlIEFtb3VudCBvZiBldGhlciBzcGVuZAogIC8vLyBAcGFyYW0gX2lzVHJhbnNmZXIgVHJ1ZSBpZiB0cmFuc2ZlcnJpbmcgb3RoZXIgdG9rZW5zLCBmYWxzZSBvdGhlcndpc2UKICAvLy8gQHBhcmFtIF9hbW91bnQgQW1vdW50IG9mIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZCwgMCBpZiBub3QgYSB0cmFuc2ZlciB0eAogIC8vLyBAcmV0dXJuIHVpbnQyNTYgVGhlIHJlcXVpcmVkIHNpZ3MgZm9yIHR4CiAgZnVuY3Rpb24gZ2V0UmVxdWlyZWQoV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBfaXNUcmFuc2ZlciwKICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHJldHVybnMgKHVpbnQyNTYpCiAgewogICAgYm9vbCBlcnI7CiAgICB1aW50MjU2IHJlczsKICAgIGJvb2wgbWFqb3IgPSB0cnVlOwogICAgLy9SZXNldCBzcGVuZCBpZiB0aGlzIGlzIGZpcnN0IGNoZWNrIG9mIHRoZSBkYXkKICAgIGlmKChub3cgLyAxIGRheXMpID4gc2VsZi5jdXJyZW50U3BlbmRbMF1bMF0pewogICAgICBzZWxmLmN1cnJlbnRTcGVuZFswXVswXSA9IG5vdyAvIDEgZGF5czsKICAgICAgc2VsZi5jdXJyZW50U3BlbmRbMF1bMV0gPSAwOwogICAgfQoKICAgIChlcnIsIHJlcykgPSBzZWxmLmN1cnJlbnRTcGVuZFswXVsxXS5wbHVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIGlmKHJlcyA8IHNlbGYubWFqb3JUaHJlc2hvbGRbMF0pCiAgICAgIG1ham9yID0gZmFsc2U7CgogICAgaWYoX3RvICE9IDAgJiYgX2lzVHJhbnNmZXIpewogICAgICBpZigobm93IC8gMSBkYXlzKSA+IHNlbGYuY3VycmVudFNwZW5kW190b11bMF0pewogICAgICAgIHNlbGYuY3VycmVudFNwZW5kW190b11bMF0gPSBub3cgLyAxIGRheXM7CiAgICAgICAgc2VsZi5jdXJyZW50U3BlbmRbX3RvXVsxXSA9IDA7CiAgICAgIH0KCiAgICAgIChlcnIsIHJlcykgPSBzZWxmLmN1cnJlbnRTcGVuZFtfdG9dWzFdLnBsdXMoX2Ftb3VudCk7CiAgICAgIHJlcXVpcmUoIWVycik7CgogICAgICBpZihyZXMgPj0gc2VsZi5tYWpvclRocmVzaG9sZFtfdG9dKQogICAgICAgIG1ham9yID0gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gbWFqb3IgPyBzZWxmLnJlcXVpcmVkTWFqb3IgOiBzZWxmLnJlcXVpcmVkTWlub3I7CiAgfQoKICAvLy8gQGRldiBGdW5jdGlvbiB0byBjcmVhdGUgbmV3IGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfdHhEYXRhIFRyYW5zYWN0aW9uIGRhdGEKICAvLy8gQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgZXRoIHNlbmRpbmcgdG8gbmV3IGNvbnRyYWN0CiAgZnVuY3Rpb24gY3JlYXRlQ29udHJhY3QoYnl0ZXMgX3R4RGF0YSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICBhZGRyZXNzIF9uZXdDb250cmFjdDsKICAgIGJvb2wgYWxsR29vZDsKCiAgICBhc3NlbWJseSB7CiAgICAgIF9uZXdDb250cmFjdCA6PSBjcmVhdGUoX3ZhbHVlLCBhZGQoX3R4RGF0YSwgMHgyMCksIG1sb2FkKF90eERhdGEpKQogICAgICBhbGxHb29kIDo9IGd0KGV4dGNvZGVzaXplKF9uZXdDb250cmFjdCksMCkKICAgIH0KICAgIHJlcXVpcmUoYWxsR29vZCk7CiAgICBMb2dDb250cmFjdENyZWF0ZWQoX25ld0NvbnRyYWN0LCBfdmFsdWUpOwogIH0KCiAgLypQcmltYXJ5IEZ1bmN0aW9uKi8KCiAgLy8vIEBkZXYgQ3JlYXRlIGFuZCBleGVjdXRlIHRyYW5zYWN0aW9uIGZyb20gd2FsbGV0CiAgLy8vIEBwYXJhbSBzZWxmIFdhbGxldCBpbiBjb250cmFjdCBzdG9yYWdlCiAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyBvZiB0YXJnZXQKICAvLy8gQHBhcmFtIF92YWx1ZSBBbW91bnQgb2YgZXRoZXIgc2VuZGluZwogIC8vLyBAcGFyYW0gX3R4RGF0YSBEYXRhIGZvciBleGVjdXRpbmcgdHJhbnNhY3Rpb24KICAvLy8gQHBhcmFtIF9jb25maXJtIFRydWUgaWYgY29uZmlybWluZywgZmFsc2UgaWYgcmV2b2tpbmcgY29uZmlybWF0aW9uCiAgLy8vIEBwYXJhbSBfZGF0YSBNZXNzYWdlIGRhdGEgcGFzc2VkIGZyb20gd2FsbGV0IGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gYm9vbCBSZXR1cm5zIHRydWUgaWYgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlCiAgLy8vIEByZXR1cm4gYnl0ZXMzMiBSZXR1cm5zIHRoZSB0eCBJRCwgY2FuIGJlIHVzZWQgZm9yIGNvbmZpcm0vcmV2b2tlIGZ1bmN0aW9ucwogIGZ1bmN0aW9uIHNlcnZlVHgoV2FsbGV0RGF0YSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgICAgICAgICAgICAgICAgYnl0ZXMgX3R4RGF0YSwKICAgICAgICAgICAgICAgICAgIGJvb2wgX2NvbmZpcm0sCiAgICAgICAgICAgICAgICAgICBieXRlcyBfZGF0YSkKICAgICAgICAgICAgICAgICAgIHB1YmxpYyByZXR1cm5zIChib29sLGJ5dGVzMzIpCiAgewogICAgYnl0ZXMzMiBfaWQgPSBrZWNjYWsyNTYoInNlcnZlVHgiLF90byxfdmFsdWUsX3R4RGF0YSk7CiAgICB1aW50MjU2IF90eEluZGV4ID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGg7CiAgICB1aW50MjU2IF9yZXF1aXJlZCA9IHNlbGYucmVxdWlyZWRNYWpvcjsKCiAgICAvL1J1biBjaGVja3MgaWYgbm90IGNhbGxlZCBmcm9tIGdlbmVyaWMgY29uZmlybS9yZXZva2UgZnVuY3Rpb24KICAgIGlmKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyh0aGlzKSl7CiAgICAgIGJvb2wgYWxsR29vZDsKICAgICAgdWludDI1NiBfYW1vdW50OwogICAgICAvLyBpZiB0aGUgb3duZXIgaXMgcmV2b2tpbmcgaGlzL2hlciBjb25maXJtYXRpb24gYnV0IGRvZXNuJ3Qga25vdyB0aGUKICAgICAgLy8gc3BlY2lmaWMgdHJhbnNhY3Rpb24gaWQgaGFzaAogICAgICBpZighX2NvbmZpcm0pIHsKICAgICAgICBhbGxHb29kID0gcmV2b2tlQ29uZmlybShzZWxmLCBfaWQpOwogICAgICAgIHJldHVybiAoYWxsR29vZCxfaWQpOwogICAgICB9IGVsc2UgeyAvLyBlbHNlIGNvbmZpcm1pbmcgdGhlIHRyYW5zYWN0aW9uCiAgICAgICAgLy9SZXVzZSBhbGxHb29kIGR1ZSB0byBzdGFjayBsaW1pdAogICAgICAgIGlmKF90byAhPSAwKQogICAgICAgICAgKGFsbEdvb2QsX2Ftb3VudCkgPSBnZXRBbW91bnQoX3R4RGF0YSk7CgogICAgICAgIC8vaWYgdGhpcyBpcyBhIG5ldyB0cmFuc2FjdGlvbiBpZCBvciBpZiBhIHByZXZpb3VzIGlkZW50aWNhbCB0cmFuc2FjdGlvbiBoYWQgYWxyZWFkeSBzdWNjZWVkZWQKICAgICAgICBpZihfdHhJbmRleCA9PSAwIHx8IHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXggLSAxXS5zdWNjZXNzKXsKICAgICAgICAgIHJlcXVpcmUoc2VsZi5vd25lckluZGV4W21zZy5zZW5kZXJdID4gMCk7CgogICAgICAgICAgX3JlcXVpcmVkID0gZ2V0UmVxdWlyZWQoc2VsZiwgX3RvLCBfdmFsdWUsIGFsbEdvb2QsX2Ftb3VudCk7CgogICAgICAgICAgLy8gYWRkIHRoaXMgdHJhbnNhY3Rpb24gdG8gdGhlIHdhbGxldHMgcmVjb3JkIGFuZCBpbml0aWFsaXplIHRoZSBzZXR0aW5ncwogICAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGgrKzsKICAgICAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1SZXF1aXJlZCA9IF9yZXF1aXJlZDsKICAgICAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmRheSA9IG5vdyAvIDEgZGF5czsKICAgICAgICAgIHNlbGYudHJhbnNhY3Rpb25zW25vdyAvIDEgZGF5c10ucHVzaChfaWQpOwogICAgICAgIH0gZWxzZSB7IC8vIGVsc2UgdGhlIHRyYW5zYWN0aW9uIGlzIGFscmVhZHkgcGVuZGluZwogICAgICAgICAgX3R4SW5kZXgtLTsgLy8gc2V0IHRoZSBpbmRleCB0byB0aGUgaW5kZXggb2YgdGhlIGV4aXN0aW5nIHRyYW5zYWN0aW9uCiAgICAgICAgICAvL21ha2Ugc3VyZSB0aGUgc2VuZGVyIGlzbid0IGFscmVhZHkgY29uZmlybWVkCiAgICAgICAgICBhbGxHb29kID0gY2hlY2tOb3RDb25maXJtZWQoc2VsZiwgX2lkLCBfdHhJbmRleCk7CiAgICAgICAgICBpZighYWxsR29vZCkKICAgICAgICAgICAgcmV0dXJuIChmYWxzZSxfaWQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gYWRkIHRoZSBzZW5kZXJzIGNvbmZpcm1hdGlvbiB0byB0aGUgdHJhbnNhY3Rpb24KICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybWVkT3duZXJzLnB1c2godWludDI1Nihtc2cuc2VuZGVyKSk7CiAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudCsrOwogICAgfSBlbHNlIHsKICAgICAgLy8gZWxzZSB3ZXJlIGNhbGxpbmcgZnJvbSBnZW5lcmljIGNvbmZpcm0vcmV2b2tlIGZ1bmN0aW9uLCBzZXQgdGhlCiAgICAgIC8vIF90eEluZGV4IGluZGV4IHRvIHRoZSBpbmRleCBvZiB0aGUgZXhpc3RpbmcgdHJhbnNhY3Rpb24KICAgICAgX3R4SW5kZXgtLTsKICAgIH0KCiAgICAvLyBpZiB0aGVyZSBhcmUgZW5vdWdoIGNvbmZpcm1hdGlvbnMKICAgIGlmKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudCA9PQogICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybVJlcXVpcmVkKQogICAgewogICAgICAvLyBleGVjdXRlIHRoZSB0cmFuc2FjdGlvbgogICAgICBzZWxmLmN1cnJlbnRTcGVuZFswXVsxXSArPSBfdmFsdWU7CiAgICAgIHNlbGYuY3VycmVudFNwZW5kW190b11bMV0gKz0gX2Ftb3VudDsKICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uc3VjY2VzcyA9IHRydWU7CgogICAgICBpZihfdG8gPT0gMCl7CiAgICAgICAgLy9GYWlsdXJlIGlzIHNlbGYgY29udGFpbmVkIGluIG1ldGhvZAogICAgICAgIGNyZWF0ZUNvbnRyYWN0KF90eERhdGEsIF92YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVxdWlyZShfdG8uY2FsbC52YWx1ZShfdmFsdWUpKF90eERhdGEpKTsKICAgICAgfQogICAgICBkZWxldGUgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uZGF0YTsKICAgICAgTG9nVHJhbnNhY3Rpb25Db21wbGV0ZShfaWQsIF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICB9IGVsc2UgewogICAgICBpZihzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5kYXRhLmxlbmd0aCA9PSAwKQogICAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmRhdGEgPSBfZGF0YTsKCiAgICAgIHVpbnQyNTYgY29uZmlybXNOZWVkZWQgPSBjYWxjQ29uZmlybXNOZWVkZWQoc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybVJlcXVpcmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudCk7CiAgICAgIExvZ1RyYW5zYWN0aW9uQ29uZmlybWVkKF9pZCwgbXNnLnNlbmRlciwgY29uZmlybXNOZWVkZWQpOwogICAgfQoKICAgIHJldHVybiAodHJ1ZSxfaWQpOwogIH0KCiAgLyogQ29uZmlybS9SZXZva2UgZnVuY3Rpb25zIHVzaW5nIHR4IElEICovCgogIC8vLyBAZGV2IENvbmZpcm1zIGEgY3VycmVudCBwZW5kaW5nIHR4LCB3aWxsIGV4ZWN1dGUgaWYgZmluYWwgY29uZmlybWF0aW9uCiAgLy8vIEBwYXJhbSBzZWxmIFdhbGxldCBpbiBjb250cmFjdCBzdG9yYWdlCiAgLy8vIEBwYXJhbSBfaWQgSUQgb2YgdGhlIHRyYW5zYWN0aW9uCiAgLy8vIEByZXR1cm4gUmV0dXJucyB0cnVlIGlmIHN1Y2Nlc3NmdWwsIGZhbHNlIG90aGVyd2lzZQogIGZ1bmN0aW9uIGNvbmZpcm1UeChXYWxsZXREYXRhIHN0b3JhZ2Ugc2VsZiwgYnl0ZXMzMiBfaWQpCiAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKHNlbGYub3duZXJJbmRleFttc2cuc2VuZGVyXSA+IDApOwogICAgdWludDI1NiBfdHhJbmRleCA9IHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF0ubGVuZ3RoOwogICAgYm9vbCByZXQ7CgogICAgaWYoX3R4SW5kZXggPT0gMCl7CiAgICAgIExvZ0Vycm9yTXNnKF90eEluZGV4LCAiVHggbm90IGluaXRpYXRlZCIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgX3R4SW5kZXgtLTsKICAgIGJvb2wgYWxsR29vZCA9IGNoZWNrTm90Q29uZmlybWVkKHNlbGYsIF9pZCwgX3R4SW5kZXgpOwogICAgaWYoIWFsbEdvb2QpCiAgICAgIHJldHVybiBmYWxzZTsKCiAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtZWRPd25lcnMucHVzaCh1aW50MjU2KG1zZy5zZW5kZXIpKTsKICAgIHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudCsrOwoKICAgIGlmKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1Db3VudCA9PQogICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybVJlcXVpcmVkKQogICAgewogICAgICBhZGRyZXNzIGEgPSBhZGRyZXNzKHRoaXMpOwogICAgICByZXF1aXJlKGEuY2FsbChzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5kYXRhKSk7CiAgICB9IGVsc2UgewogICAgICB1aW50MjU2IGNvbmZpcm1zTmVlZGVkID0gY2FsY0NvbmZpcm1zTmVlZGVkKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1SZXF1aXJlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtQ291bnQpOwoKICAgICAgTG9nVHJhbnNhY3Rpb25Db25maXJtZWQoX2lkLCBtc2cuc2VuZGVyLCBjb25maXJtc05lZWRlZCk7CiAgICAgIHJldCA9IHRydWU7CiAgICB9CgogICAgcmV0dXJuIHJldDsKICB9CgogIC8vLyBAZGV2IFJldm9rZXMgYSBwcmlvciBjb25maXJtYXRpb24gZnJvbSBzZW5kZXIsIGNhbGwgd2l0aCB0eCBJRAogIC8vLyBAcGFyYW0gc2VsZiBXYWxsZXQgaW4gY29udHJhY3Qgc3RvcmFnZQogIC8vLyBAcGFyYW0gX2lkIElEIG9mIHRoZSB0cmFuc2FjdGlvbgogIC8vLyBAcmV0dXJuIFJldHVybnMgdHJ1ZSBpZiBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2UKICBmdW5jdGlvbiByZXZva2VDb25maXJtKFdhbGxldERhdGEgc3RvcmFnZSBzZWxmLCBieXRlczMyIF9pZCkKICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJlcXVpcmUoc2VsZi5vd25lckluZGV4W21zZy5zZW5kZXJdID4gMCk7CiAgICB1aW50MjU2IF90eEluZGV4ID0gc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGg7CgogICAgaWYoX3R4SW5kZXggPT0gMCl7CiAgICAgIExvZ0Vycm9yTXNnKF90eEluZGV4LCAiVHggbm90IGluaXRpYXRlZCIpOwogICAgICBMb2dUcmFuc2FjdGlvbkZhaWxlZChfaWQsIG1zZy5zZW5kZXIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgX3R4SW5kZXgtLTsKICAgIGlmKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLnN1Y2Nlc3MpewogICAgICBMb2dFcnJvck1zZyhfdHhJbmRleCwgIlRyYW5zYWN0aW9uIGFscmVhZHkgY29tcGxldGUiKTsKICAgICAgTG9nVHJhbnNhY3Rpb25GYWlsZWQoX2lkLCBtc2cuc2VuZGVyKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vRnVuY3Rpb24gZnJvbSBNb2R1bGFyLmlvIGFycmF5IHV0aWxpdHkgbGlicmFyeQogICAgYm9vbCBmb3VuZDsKICAgIHVpbnQyNTYgaW5kZXg7CiAgICAoZm91bmQsIGluZGV4KSA9IHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1lZE93bmVycy5pbmRleE9mKHVpbnQyNTYobXNnLnNlbmRlciksIGZhbHNlKTsKICAgIGlmKCFmb3VuZCl7CiAgICAgIExvZ0Vycm9yTXNnKGluZGV4LCAiT3duZXIgaGFzIG5vdCBjb25maXJtZWQgdHgiKTsKICAgICAgTG9nVHJhbnNhY3Rpb25GYWlsZWQoX2lkLCBtc2cuc2VuZGVyKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybWVkT3duZXJzW2luZGV4XSA9IDA7CiAgICBzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtQ291bnQtLTsKCiAgICB1aW50MjU2IGNvbmZpcm1zTmVlZGVkID0gY2FsY0NvbmZpcm1zTmVlZGVkKHNlbGYudHJhbnNhY3Rpb25JbmZvW19pZF1bX3R4SW5kZXhdLmNvbmZpcm1SZXF1aXJlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXVtfdHhJbmRleF0uY29uZmlybUNvdW50KTsKICAgIC8vVHJhbnNhY3Rpb24gcmVtb3ZlZCBpZiBhbGwgc2lncyByZXZva2VkIGJ1dCBpZCByZW1haW5zIGluIHdhbGxldCB0cmFuc2FjdGlvbiBsaXN0CiAgICBpZihzZWxmLnRyYW5zYWN0aW9uSW5mb1tfaWRdW190eEluZGV4XS5jb25maXJtQ291bnQgPT0gMCkKICAgICAgc2VsZi50cmFuc2FjdGlvbkluZm9bX2lkXS5sZW5ndGgtLTsKCiAgICBMb2dSZXZva2VOb3RpY2UoX2lkLCBtc2cuc2VuZGVyLCBjb25maXJtc05lZWRlZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmxpYnJhcnkgQXJyYXkyNTZMaWIgewoKICAvLy8gQGRldiBTdW0gdmVjdG9yCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JhZ2UgYXJyYXkgY29udGFpbmluZyB1aW50MjU2IHR5cGUgdmFyaWFibGVzCiAgLy8vIEByZXR1cm4gc3VtIFRoZSBzdW0gb2YgYWxsIGVsZW1lbnRzLCBkb2VzIG5vdCBjaGVjayBmb3Igb3ZlcmZsb3cKICBmdW5jdGlvbiBzdW1FbGVtZW50cyh1aW50MjU2W10gc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYgc3VtKSB7CiAgICBhc3NlbWJseSB7CiAgICAgIG1zdG9yZSgweDYwLHNlbGZfc2xvdCkKCiAgICAgIGZvciB7IGxldCBpIDo9IDAgfSBsdChpLCBzbG9hZChzZWxmX3Nsb3QpKSB7IGkgOj0gYWRkKGksIDEpIH0gewogICAgICAgIHN1bSA6PSBhZGQoc2xvYWQoYWRkKHNoYTMoMHg2MCwweDIwKSxpKSksc3VtKQogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBSZXR1cm5zIHRoZSBtYXggdmFsdWUgaW4gYW4gYXJyYXkuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JhZ2UgYXJyYXkgY29udGFpbmluZyB1aW50MjU2IHR5cGUgdmFyaWFibGVzCiAgLy8vIEByZXR1cm4gbWF4VmFsdWUgVGhlIGhpZ2hlc3QgdmFsdWUgaW4gdGhlIGFycmF5CiAgZnVuY3Rpb24gZ2V0TWF4KHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NiBtYXhWYWx1ZSkgewogICAgYXNzZW1ibHkgewogICAgICBtc3RvcmUoMHg2MCxzZWxmX3Nsb3QpCiAgICAgIG1heFZhbHVlIDo9IHNsb2FkKHNoYTMoMHg2MCwweDIwKSkKCiAgICAgIGZvciB7IGxldCBpIDo9IDAgfSBsdChpLCBzbG9hZChzZWxmX3Nsb3QpKSB7IGkgOj0gYWRkKGksIDEpIH0gewogICAgICAgIHN3aXRjaCBndChzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLGkpKSwgbWF4VmFsdWUpCiAgICAgICAgY2FzZSAxIHsKICAgICAgICAgIG1heFZhbHVlIDo9IHNsb2FkKGFkZChzaGEzKDB4NjAsMHgyMCksaSkpCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvLy8gQGRldiBSZXR1cm5zIHRoZSBtaW5pbXVtIHZhbHVlIGluIGFuIGFycmF5LgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yYWdlIGFycmF5IGNvbnRhaW5pbmcgdWludDI1NiB0eXBlIHZhcmlhYmxlcwogIC8vLyBAcmV0dXJuIG1pblZhbHVlIFRoZSBoaWdoZXN0IHZhbHVlIGluIHRoZSBhcnJheQogIGZ1bmN0aW9uIGdldE1pbih1aW50MjU2W10gc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYgbWluVmFsdWUpIHsKICAgIGFzc2VtYmx5IHsKICAgICAgbXN0b3JlKDB4NjAsc2VsZl9zbG90KQogICAgICBtaW5WYWx1ZSA6PSBzbG9hZChzaGEzKDB4NjAsMHgyMCkpCgogICAgICBmb3IgeyBsZXQgaSA6PSAwIH0gbHQoaSwgc2xvYWQoc2VsZl9zbG90KSkgeyBpIDo9IGFkZChpLCAxKSB9IHsKICAgICAgICBzd2l0Y2ggZ3Qoc2xvYWQoYWRkKHNoYTMoMHg2MCwweDIwKSxpKSksIG1pblZhbHVlKQogICAgICAgIGNhc2UgMCB7CiAgICAgICAgICBtaW5WYWx1ZSA6PSBzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLGkpKQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgRmluZHMgdGhlIGluZGV4IG9mIGEgZ2l2ZW4gdmFsdWUgaW4gYW4gYXJyYXkKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmFnZSBhcnJheSBjb250YWluaW5nIHVpbnQyNTYgdHlwZSB2YXJpYWJsZXMKICAvLy8gQHBhcmFtIHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yCiAgLy8vIEBwYXJhbSBpc1NvcnRlZCBUcnVlIGlmIHRoZSBhcnJheSBpcyBzb3J0ZWQsIGZhbHNlIG90aGVyd2lzZQogIC8vLyBAcmV0dXJuIGZvdW5kIFRydWUgaWYgdGhlIHZhbHVlIHdhcyBmb3VuZCwgZmFsc2Ugb3RoZXJ3aXNlCiAgLy8vIEByZXR1cm4gaW5kZXggVGhlIGluZGV4IG9mIHRoZSBnaXZlbiB2YWx1ZSwgcmV0dXJucyAwIGlmIGZvdW5kIGlzIGZhbHNlCiAgZnVuY3Rpb24gaW5kZXhPZih1aW50MjU2W10gc3RvcmFnZSBzZWxmLCB1aW50MjU2IHZhbHVlLCBib29sIGlzU29ydGVkKQogICAgICAgICAgIHB1YmxpYwogICAgICAgICAgIHZpZXcKICAgICAgICAgICByZXR1cm5zKGJvb2wgZm91bmQsIHVpbnQyNTYgaW5kZXgpIHsKICAgIGFzc2VtYmx5ewogICAgICBtc3RvcmUoMHg2MCxzZWxmX3Nsb3QpCiAgICAgIHN3aXRjaCBpc1NvcnRlZAogICAgICBjYXNlIDEgewogICAgICAgIGxldCBoaWdoIDo9IHN1YihzbG9hZChzZWxmX3Nsb3QpLDEpCiAgICAgICAgbGV0IG1pZCA6PSAwCiAgICAgICAgbGV0IGxvdyA6PSAwCiAgICAgICAgZm9yIHsgfSBpc3plcm8oZ3QobG93LCBoaWdoKSkgeyB9IHsKICAgICAgICAgIG1pZCA6PSBkaXYoYWRkKGxvdyxoaWdoKSwyKQoKICAgICAgICAgIHN3aXRjaCBsdChzbG9hZChhZGQoc2hhMygweDYwLDB4MjApLG1pZCkpLHZhbHVlKQogICAgICAgICAgY2FzZSAxIHsKICAgICAgICAgICAgIGxvdyA6PSBhZGQobWlkLDEpCiAgICAgICAgICB9CiAgICAgICAgICBjYXNlIDAgewogICAgICAgICAgICBzd2l0Y2ggZ3Qoc2xvYWQoYWRkKHNoYTMoMHg2MCwweDIwKSxtaWQpKSx2YWx1ZSkKICAgICAgICAgICAgY2FzZSAxIHsKICAgICAgICAgICAgICBoaWdoIDo9IHN1YihtaWQsMSkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDAgewogICAgICAgICAgICAgIGZvdW5kIDo9IDEKICAgICAgICAgICAgICBpbmRleCA6PSBtaWQKICAgICAgICAgICAgICBsb3cgOj0gYWRkKGhpZ2gsMSkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjYXNlIDAgewogICAgICAgIGZvciB7IGxldCBsb3cgOj0gMCB9IGx0KGxvdywgc2xvYWQoc2VsZl9zbG90KSkgeyBsb3cgOj0gYWRkKGxvdywgMSkgfSB7CiAgICAgICAgICBzd2l0Y2ggZXEoc2xvYWQoYWRkKHNoYTMoMHg2MCwweDIwKSxsb3cpKSwgdmFsdWUpCiAgICAgICAgICBjYXNlIDEgewogICAgICAgICAgICBmb3VuZCA6PSAxCiAgICAgICAgICAgIGluZGV4IDo9IGxvdwogICAgICAgICAgICBsb3cgOj0gc2xvYWQoc2VsZl9zbG90KQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgVXRpbGl0eSBmdW5jdGlvbiBmb3IgaGVhcFNvcnQKICAvLy8gQHBhcmFtIGluZGV4IFRoZSBpbmRleCBvZiBjaGlsZCBub2RlCiAgLy8vIEByZXR1cm4gcEkgVGhlIHBhcmVudCBub2RlIGluZGV4CiAgZnVuY3Rpb24gZ2V0UGFyZW50SSh1aW50MjU2IGluZGV4KSBwcml2YXRlIHB1cmUgcmV0dXJucyAodWludDI1NiBwSSkgewogICAgdWludDI1NiBpID0gaW5kZXggLSAxOwogICAgcEkgPSBpLzI7CiAgfQoKICAvLy8gQGRldiBVdGlsaXR5IGZ1bmN0aW9uIGZvciBoZWFwU29ydAogIC8vLyBAcGFyYW0gaW5kZXggVGhlIGluZGV4IG9mIHBhcmVudCBub2RlCiAgLy8vIEByZXR1cm4gbGNJIFRoZSBpbmRleCBvZiBsZWZ0IGNoaWxkCiAgZnVuY3Rpb24gZ2V0TGVmdENoaWxkSSh1aW50MjU2IGluZGV4KSBwcml2YXRlIHB1cmUgcmV0dXJucyAodWludDI1NiBsY0kpIHsKICAgIHVpbnQyNTYgaSA9IGluZGV4ICogMjsKICAgIGxjSSA9IGkgKyAxOwogIH0KCiAgLy8vIEBkZXYgU29ydHMgZ2l2ZW4gYXJyYXkgaW4gcGxhY2UKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmFnZSBhcnJheSBjb250YWluaW5nIHVpbnQyNTYgdHlwZSB2YXJpYWJsZXMKICBmdW5jdGlvbiBoZWFwU29ydCh1aW50MjU2W10gc3RvcmFnZSBzZWxmKSBwdWJsaWMgewogICAgdWludDI1NiBlbmQgPSBzZWxmLmxlbmd0aCAtIDE7CiAgICB1aW50MjU2IHN0YXJ0ID0gZ2V0UGFyZW50SShlbmQpOwogICAgdWludDI1NiByb290ID0gc3RhcnQ7CiAgICB1aW50MjU2IGxDaGlsZDsKICAgIHVpbnQyNTYgckNoaWxkOwogICAgdWludDI1NiBzd2FwOwogICAgdWludDI1NiB0ZW1wOwogICAgd2hpbGUoc3RhcnQgPj0gMCl7CiAgICAgIHJvb3QgPSBzdGFydDsKICAgICAgbENoaWxkID0gZ2V0TGVmdENoaWxkSShzdGFydCk7CiAgICAgIHdoaWxlKGxDaGlsZCA8PSBlbmQpewogICAgICAgIHJDaGlsZCA9IGxDaGlsZCArIDE7CiAgICAgICAgc3dhcCA9IHJvb3Q7CiAgICAgICAgaWYoc2VsZltzd2FwXSA8IHNlbGZbbENoaWxkXSkKICAgICAgICAgIHN3YXAgPSBsQ2hpbGQ7CiAgICAgICAgaWYoKHJDaGlsZCA8PSBlbmQpICYmIChzZWxmW3N3YXBdPHNlbGZbckNoaWxkXSkpCiAgICAgICAgICBzd2FwID0gckNoaWxkOwogICAgICAgIGlmKHN3YXAgPT0gcm9vdCkKICAgICAgICAgIGxDaGlsZCA9IGVuZCsxOwogICAgICAgIGVsc2UgewogICAgICAgICAgdGVtcCA9IHNlbGZbc3dhcF07CiAgICAgICAgICBzZWxmW3N3YXBdID0gc2VsZltyb290XTsKICAgICAgICAgIHNlbGZbcm9vdF0gPSB0ZW1wOwogICAgICAgICAgcm9vdCA9IHN3YXA7CiAgICAgICAgICBsQ2hpbGQgPSBnZXRMZWZ0Q2hpbGRJKHJvb3QpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZihzdGFydCA9PSAwKQogICAgICAgIGJyZWFrOwogICAgICBlbHNlCiAgICAgICAgc3RhcnQgPSBzdGFydCAtIDE7CiAgICB9CiAgICB3aGlsZShlbmQgPiAwKXsKICAgICAgdGVtcCA9IHNlbGZbZW5kXTsKICAgICAgc2VsZltlbmRdID0gc2VsZlswXTsKICAgICAgc2VsZlswXSA9IHRlbXA7CiAgICAgIGVuZCA9IGVuZCAtIDE7CiAgICAgIHJvb3QgPSAwOwogICAgICBsQ2hpbGQgPSBnZXRMZWZ0Q2hpbGRJKDApOwogICAgICB3aGlsZShsQ2hpbGQgPD0gZW5kKXsKICAgICAgICByQ2hpbGQgPSBsQ2hpbGQgKyAxOwogICAgICAgIHN3YXAgPSByb290OwogICAgICAgIGlmKHNlbGZbc3dhcF0gPCBzZWxmW2xDaGlsZF0pCiAgICAgICAgICBzd2FwID0gbENoaWxkOwogICAgICAgIGlmKChyQ2hpbGQgPD0gZW5kKSAmJiAoc2VsZltzd2FwXTxzZWxmW3JDaGlsZF0pKQogICAgICAgICAgc3dhcCA9IHJDaGlsZDsKICAgICAgICBpZihzd2FwID09IHJvb3QpCiAgICAgICAgICBsQ2hpbGQgPSBlbmQgKyAxOwogICAgICAgIGVsc2UgewogICAgICAgICAgdGVtcCA9IHNlbGZbc3dhcF07CiAgICAgICAgICBzZWxmW3N3YXBdID0gc2VsZltyb290XTsKICAgICAgICAgIHNlbGZbcm9vdF0gPSB0ZW1wOwogICAgICAgICAgcm9vdCA9IHN3YXA7CiAgICAgICAgICBsQ2hpbGQgPSBnZXRMZWZ0Q2hpbGRJKHJvb3QpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgUmVtb3ZlcyBkdXBsaWNhdGVzIGZyb20gYSBnaXZlbiBhcnJheS4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmFnZSBhcnJheSBjb250YWluaW5nIHVpbnQyNTYgdHlwZSB2YXJpYWJsZXMKICBmdW5jdGlvbiB1bmlxKHVpbnQyNTZbXSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2IGxlbmd0aCkgewogICAgYm9vbCBjb250YWluczsKICAgIHVpbnQyNTYgaW5kZXg7CgogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgc2VsZi5sZW5ndGg7IGkrKykgewogICAgICAoY29udGFpbnMsIGluZGV4KSA9IGluZGV4T2Yoc2VsZiwgc2VsZltpXSwgZmFsc2UpOwoKICAgICAgaWYgKGkgPiBpbmRleCkgewogICAgICAgIGZvciAodWludDI1NiBqID0gaTsgaiA8IHNlbGYubGVuZ3RoIC0gMTsgaisrKXsKICAgICAgICAgIHNlbGZbal0gPSBzZWxmW2ogKyAxXTsKICAgICAgICB9CgogICAgICAgIGRlbGV0ZSBzZWxmW3NlbGYubGVuZ3RoIC0gMV07CiAgICAgICAgc2VsZi5sZW5ndGgtLTsKICAgICAgICBpLS07CiAgICAgIH0KICAgIH0KCiAgICBsZW5ndGggPSBzZWxmLmxlbmd0aDsKICB9Cn0KCmxpYnJhcnkgQmFzaWNNYXRoTGliIHsKICAvLy8gQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIG92ZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgcHJvZHVjdCBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gdGltZXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IG11bChhLGIpCiAgICAgIHN3aXRjaCBvcihpc3plcm8oYiksIGVxKGRpdihyZXMsYiksIGEpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgRGl2aWRlcyB0d28gbnVtYmVycyBidXQgY2hlY2tzIGZvciAwIGluIHRoZSBkaXZpc29yIGZpcnN0LgogIC8vLyBEb2VzIG5vdCB0aHJvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgYGJgIGlzIDAKICAvLy8gQHJldHVybiByZXMgVGhlIHF1b3RpZW50IG9mIGEgYW5kIGIsIG9yIDAgaWYgYGJgIGlzIDAKICBmdW5jdGlvbiBkaXZpZGVkQnkodWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgaSkgewogICAgdWludDI1NiByZXM7CiAgICBhc3NlbWJseXsKICAgICAgc3dpdGNoIGlzemVybyhiKQogICAgICBjYXNlIDAgewogICAgICAgIHJlcyA6PSBkaXYoYSxiKQogICAgICAgIGxldCBsb2MgOj0gbWxvYWQoMHg0MCkKICAgICAgICBtc3RvcmUoYWRkKGxvYywweDIwKSxyZXMpCiAgICAgICAgaSA6PSBtbG9hZChhZGQobG9jLDB4MjApKQogICAgICB9CiAgICAgIGRlZmF1bHQgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgaSA6PSAwCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IEFkZHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBzdW0gb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHBsdXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wgZXJyLCB1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBhZGQoYSxiKQogICAgICBzd2l0Y2ggYW5kKGVxKHN1YihyZXMsYiksIGEpLCBvcihndChyZXMsYiksZXEocmVzLGIpKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IFN1YnRyYWN0cyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciB1bmRlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgZnVuY3Rpb24gbWludXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IHN1YihhLGIpCiAgICAgIHN3aXRjaCBlcShhbmQoZXEoYWRkKHJlcyxiKSwgYSksIG9yKGx0KHJlcyxhKSwgZXEocmVzLGEpKSksIDEpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgfQp9'.
	

]
