Class {
	#name : #SRT0bB3B818A83cFd8c1c86082a4ce191188EBD8f12,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0bB3B818A83cFd8c1c86082a4ce191188EBD8f12 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovL2luc3BpcmVkIGJ5IG11bHRpcGxlIHRva2Vuc2FsZSBjb250cmFjdHMKCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpjb250cmFjdCBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA+IDApOwogICAgdWludCBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjPj1hICYmIGM+PWIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKGFzc2VydGlvbik7CiAgfQp9CgovLy8gQGRldiBUaGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCBtdXN0IGltcGxlbWVudCB0aGVzZSBmdW5jdGlvbnMKY29udHJhY3QgQ29udHJvbGxlciB7CiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KQogICAgICAgIHJldHVybnMoYm9vbCk7Cn0KCi8vIGluc3BpcmVkIGJ5IFplcHBlbGluJ3MgVmVzdGVkIFRva2VuIGRlcml2aW5nIE1pbmlNZVRva2VuCgovLyBAZGV2IE1pbmlNZUlycmV2b2NhYmxlVmVzdGVkVG9rZW4gaXMgYSBkZXJpdmVkIHZlcnNpb24gb2YgTWluaU1lVG9rZW4gYWRkaW5nIHRoZQovLyBhYmlsaXR5IHRvIGNyZWF0ZVRva2VuR3JhbnRzIHdoaWNoIGFyZSBiYXNpY2FsbHkgYSB0cmFuc2ZlciB0aGF0IGxpbWl0cyB0aGUKLy8gcmVjZWl2ZXIgb2YgdGhlIHRva2Vucy4KCmNvbnRyYWN0IENvbnRyb2xsZWQgewogICAgLy8vIEBub3RpY2UgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsCiAgICAvLy8gIGEgZnVuY3Rpb24gd2l0aCB0aGlzIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlcnsgcmVxdWlyZShtc2cuc2VuZGVyPT1jb250cm9sbGVyKTsgXzsgfQoKCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCgoKY29udHJhY3QgQXBwcm92ZUFuZENhbGxSZWNlaXZlciB7CiAgICBmdW5jdGlvbiByZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9CgovKgogKiBFUkMyMCBpbnRlcmZhY2UKICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgoKY29udHJhY3QgTWluaU1lVG9rZW4gaXMgRVJDMjAsIENvbnRyb2xsZWQgewogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAvL1RoZSBUb2tlbidzIG5hbWU6IGUuZy4gRGlnaXhEQU8gVG9rZW5zCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgIC8vTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZS5nLiBSRVAKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdNTVRfMC4xJzsgLy9BbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUKCgogICAgLy8vIEBkZXYgYENoZWNrcG9pbnRgIGlzIHRoZSBzdHJ1Y3R1cmUgdGhhdCBhdHRhY2hlcyBhIGJsb2NrIG51bWJlciB0byBhCiAgICAvLy8gIGdpdmVuIHZhbHVlLCB0aGUgYmxvY2sgbnVtYmVyIGF0dGFjaGVkIGlzIHRoZSBvbmUgdGhhdCBsYXN0IGNoYW5nZWQgdGhlCiAgICAvLy8gIHZhbHVlCiAgICBzdHJ1Y3QgIENoZWNrcG9pbnQgewoKICAgICAgICAvLyBgZnJvbUJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIHZhbHVlIHdhcyBnZW5lcmF0ZWQgZnJvbQogICAgICAgIHVpbnQxMjggZnJvbUJsb2NrOwoKICAgICAgICAvLyBgdmFsdWVgIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYmxvY2sgbnVtYmVyCiAgICAgICAgdWludDEyOCB2YWx1ZTsKICAgIH0KCiAgICAvLyBgcGFyZW50VG9rZW5gIGlzIHRoZSBUb2tlbiBhZGRyZXNzIHRoYXQgd2FzIGNsb25lZCB0byBwcm9kdWNlIHRoaXMgdG9rZW47CiAgICAvLyAgaXQgd2lsbCBiZSAweDAgZm9yIGEgdG9rZW4gdGhhdCB3YXMgbm90IGNsb25lZAogICAgTWluaU1lVG9rZW4gcHVibGljIHBhcmVudFRva2VuOwoKICAgIC8vIGBwYXJlbnRTbmFwU2hvdEJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgQ2xvbmUgVG9rZW4KICAgIHVpbnQgcHVibGljIHBhcmVudFNuYXBTaG90QmxvY2s7CgogICAgLy8gYGNyZWF0aW9uQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgQ2xvbmUgVG9rZW4gd2FzIGNyZWF0ZWQKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uQmxvY2s7CgogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIGNoYW5nZQogICAgLy8gIG9jY3VycmVkIGlzIGFsc28gaW5jbHVkZWQgaW4gdGhlIG1hcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDaGVja3BvaW50W10pIGJhbGFuY2VzOwoKICAgIC8vIGBhbGxvd2VkYCB0cmFja3MgYW55IGV4dHJhIHRyYW5zZmVyIHJpZ2h0cyBhcyBpbiBhbGwgRVJDMjAgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbgogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsKCiAgICAvLyBGbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aGUgdG9rZW4gaXMgdHJhbnNmZXJhYmxlIG9yIG5vdC4KICAgIGJvb2wgcHVibGljIHRyYW5zZmVyc0VuYWJsZWQ7CgogICAgLy8gVGhlIGZhY3RvcnkgdXNlZCB0byBjcmVhdGUgbmV3IGNsb25lIHRva2VucwogICAgTWluaU1lVG9rZW5GYWN0b3J5IHB1YmxpYyB0b2tlbkZhY3Rvcnk7CgovLy8vLy8vLy8vLy8vLy8vCi8vIENvbnN0cnVjdG9yCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5GYWN0b3J5IFRoZSBhZGRyZXNzIG9mIHRoZSBNaW5pTWVUb2tlbkZhY3RvcnkgY29udHJhY3QgdGhhdAogICAgLy8vICB3aWxsIGNyZWF0ZSB0aGUgQ2xvbmUgdG9rZW4gY29udHJhY3RzLCB0aGUgdG9rZW4gZmFjdG9yeSBuZWVkcyB0byBiZQogICAgLy8vICBkZXBsb3llZCBmaXJzdAogICAgLy8vIEBwYXJhbSBfcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRTbmFwU2hvdEJsb2NrIEJsb2NrIG9mIHRoZSBwYXJlbnQgdG9rZW4gdGhhdCB3aWxsCiAgICAvLy8gIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIGNsb25lIHRva2VuLCBzZXQgdG8gMCBpZiBpdAogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gTWluaU1lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfdG9rZW5GYWN0b3J5LAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgewogICAgICAgIHRva2VuRmFjdG9yeSA9IE1pbmlNZVRva2VuRmFjdG9yeShfdG9rZW5GYWN0b3J5KTsKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wKICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7CiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOwogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gRVJDMjAgTWV0aG9kcwovLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSAodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAvLy8vaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsKICAgICAgICByZXR1cm4gZG9UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdAogICAgLy8vICBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIC8vIFRoZSBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QgY2FuIG1vdmUgdG9rZW5zIGFyb3VuZCBhdCB3aWxsLAogICAgICAgIC8vICB0aGlzIGlzIGltcG9ydGFudCB0byByZWNvZ25pemUhIENvbmZpcm0gdGhhdCB5b3UgdHJ1c3QgdGhlCiAgICAgICAgLy8gIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCwgd2hpY2ggaW4gbW9zdCBzaXR1YXRpb25zIHNob3VsZCBiZQogICAgICAgIC8vICBhbm90aGVyIG9wZW4gc291cmNlIHNtYXJ0IGNvbnRyYWN0IG9yIDB4MAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgcmVxdWlyZSAodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgICAgICAvLy8vaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsKCiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkKICAgICAgICAgICAgYXNzZXJ0IChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXT49X2Ftb3VudCk7CgogICAgICAgICAgICAvLy8vaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgdGhyb3c7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZgogICAgICAgICAgIHJlcXVpcmUoKF90byE9MCkmJihfdG8hPWFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgICAgLy8vLyBpZiAoKF90byA9PSAwKSB8fCAoX3RvID09IGFkZHJlc3ModGhpcykpKSB0aHJvdzsKCiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQoKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIGFzc2VydChwcmV2aW91c0JhbGFuY2VGcm9tID49IF9hbW91bnQpOwoKICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgICAgYXNzZXJ0KENvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSxfdG8sX2Ftb3VudCkpOwoKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHNlbmRpbmcgdGhlIHRva2VucwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CgogICAgICAgICAgIC8vIFRoZW4gdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMKICAgICAgICAgICAKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgYXNzZXJ0KHByZXZpb3VzQmFsYW5jZVRvK19hbW91bnQ+PXByZXZpb3VzQmFsYW5jZVRvKTsgCiAgICAgICAgICAgCiAgICAgICAgICAgLy8vLyBpZiAocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50IDwgcHJldmlvdXNCYWxhbmNlVG8pIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CgogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwoKICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXMmIzE4MDsKICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CgogICAgICAgIHJlcXVpcmUoKF9hbW91bnQ9PTApfHwoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl09PTApKTsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICBhc3NlcnQoQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlcixfc3BlbmRlcixfYW1vdW50KSk7CgogICAgICAgICAgICAvLyAgaWYgKCFDb250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpCiAgICAgICAgICAgIC8vICAgICAgICB0aHJvdzsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcwogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bwogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYXBwcm92ZShfc3BlbmRlciwgX2Ftb3VudCk7CgogICAgICAgIC8vIFRoaXMgcG9ydGlvbiBpcyBjb3BpZWQgZnJvbSBDb25zZW5TeXMncyBTdGFuZGFyZCBUb2tlbiBDb250cmFjdC4gSXQKICAgICAgICAvLyAgY2FsbHMgdGhlIHJlY2VpdmVBcHByb3ZhbCBmdW5jdGlvbiB0aGF0IGlzIHBhcnQgb2YgdGhlIGNvbnRyYWN0IHRoYXQKICAgICAgICAvLyAgaXMgYmVpbmcgYXBwcm92ZWQgKGBfc3BlbmRlcmApLiBUaGUgZnVuY3Rpb24gc2hvdWxkIGxvb2sgbGlrZToKICAgICAgICAvLyAgYHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnQsIGFkZHJlc3MKICAgICAgICAvLyAgX3Rva2VuQ29udHJhY3QsIGJ5dGVzIF9leHRyYURhdGEpYCBJdCBpcyBhc3N1bWVkIHRoYXQgdGhlIGNhbGwKICAgICAgICAvLyAgKnNob3VsZCogc3VjY2VlZCwgb3RoZXJ3aXNlIHRoZSBwbGFpbiB2YW5pbGxhIGFwcHJvdmUgd291bGQgYmUgdXNlZAogICAgICAgIEFwcHJvdmVBbmRDYWxsUmVjZWl2ZXIoX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgIF9hbW91bnQsCiAgICAgICAgICAgdGhpcywKICAgICAgICAgICBfZXh0cmFEYXRhCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXQoYmxvY2subnVtYmVyKTsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFF1ZXJpZXMgdGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mCiAgICAgICAgLy8gIHRoaXMgdG9rZW4KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIHRvdGFsU3VwcGx5IG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoaXMgdG9rZW4gYXMgdGhhdCBjb250YWlucyB0b3RhbFN1cHBseSBvZiB0aGlzCiAgICAgICAgLy8gIHRva2VuIGF0IHRoaXMgYmxvY2sgbnVtYmVyLgogICAgICAgIGlmICgodG90YWxTdXBwbHlIaXN0b3J5Lmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAodG90YWxTdXBwbHlIaXN0b3J5WzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIHRvdGFsU3VwcGx5IGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBDbG9uZSBUb2tlbiBNZXRob2QKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcKICAgIC8vLyAgdGhpcyB0b2tlbiBhdCBgX3NuYXBzaG90QmxvY2tgCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuTmFtZSBOYW1lIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuU3ltYm9sIFN5bWJvbCBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgd2hlbiB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBwYXJlbnQgdG9rZW4gaXMKICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsKICAgIC8vLyAgaWYgdGhlIGJsb2NrIGlzIGhpZ2hlciB0aGFuIHRoZSBhY3R1YWwgYmxvY2ssIHRoZSBjdXJyZW50IGJsb2NrIGlzIHVzZWQKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IE1pbmlNZVRva2VuIENvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICApIHJldHVybnMoYWRkcmVzcykgewogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA+IGJsb2NrLm51bWJlcikgX3NuYXBzaG90QmxvY2sgPSBibG9jay5udW1iZXI7CiAgICAgICAgTWluaU1lVG9rZW4gY2xvbmVUb2tlbiA9IHRva2VuRmFjdG9yeS5jcmVhdGVDbG9uZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgICAgICBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwoKICAgICAgICBjbG9uZVRva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CgogICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRva2VuIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgIE5ld0Nsb25lVG9rZW4oYWRkcmVzcyhjbG9uZVRva2VuKSwgX3NuYXBzaG90QmxvY2spOwogICAgICAgIHJldHVybiBhZGRyZXNzKGNsb25lVG9rZW4pOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBHZW5lcmF0ZSBhbmQgZGVzdHJveSB0b2tlbnMKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEdlbmVyYXRlcyBgX2Ftb3VudGAgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgYXNzaWduZWQgdGhlIG5ldyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIGdlbmVyYXRlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBnZW5lcmF0ZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7CiAgICAgICAgYXNzZXJ0KGN1clRvdGFsU3VwcGx5K19hbW91bnQ+PWN1clRvdGFsU3VwcGx5KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50KTsKICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICBhc3NlcnQocHJldmlvdXNCYWxhbmNlVG8rX2Ftb3VudD49cHJldmlvdXNCYWxhbmNlVG8pOwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGJ1cm4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7CiAgICAgICAgYXNzZXJ0KGN1clRvdGFsU3VwcGx5ID49IF9hbW91bnQpOwogICAgICAgIAogICAgICAgIC8vLy8gaWYgKGN1clRvdGFsU3VwcGx5IDwgX2Ftb3VudCkgdGhyb3c7CgogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgYXNzZXJ0KHByZXZpb3VzQmFsYW5jZUZyb20gPj1fYW1vdW50KTsKCiAgICAgICAgLy8vLyBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHRocm93OwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEVuYWJsZSB0b2tlbnMgdHJhbnNmZXJzCi8vLy8vLy8vLy8vLy8vLy8KCgogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycyhib29sIF90cmFuc2ZlcnNFbmFibGVkKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb25zIHRvIHF1ZXJ5IGFuZCBzZXQgYSB2YWx1ZSBpbiBhIHNuYXBzaG90IGFycmF5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBgZ2V0VmFsdWVBdGAgcmV0cmlldmVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIGF0IGEgZ2l2ZW4gYmxvY2sgbnVtYmVyCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIHZhbHVlcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdAogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiB0b2tlbnMgYmVpbmcgcXVlcmllZAogICAgZnVuY3Rpb24gZ2V0VmFsdWVBdChDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfYmxvY2sKICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkgcmV0dXJuIDA7CgogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlCiAgICAgICAgaWYgKF9ibG9jayA+PSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0uZnJvbUJsb2NrKQogICAgICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLnZhbHVlOwogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOwoKICAgICAgICAvLyBCaW5hcnkgc2VhcmNoIG9mIHRoZSB2YWx1ZSBpbiB0aGUgYXJyYXkKICAgICAgICB1aW50IG1pbiA9IDA7CiAgICAgICAgdWludCBtYXggPSBjaGVja3BvaW50cy5sZW5ndGgtMTsKICAgICAgICB3aGlsZSAobWF4ID4gbWluKSB7CiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOwogICAgICAgICAgICBpZiAoY2hlY2twb2ludHNbbWlkXS5mcm9tQmxvY2s8PV9ibG9jaykgewogICAgICAgICAgICAgICAgbWluID0gbWlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWF4ID0gbWlkLTE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7CiAgICB9CgogICAgLy8vIEBkZXYgYHVwZGF0ZVZhbHVlQXROb3dgIHVzZWQgdG8gdXBkYXRlIHRoZSBgYmFsYW5jZXNgIG1hcCBhbmQgdGhlCiAgICAvLy8gIGB0b3RhbFN1cHBseUhpc3RvcnlgCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG5ldyBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZUF0Tm93KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF92YWx1ZQogICAgKSBpbnRlcm5hbCAgewogICAgICAgIGlmICgoY2hlY2twb2ludHMubGVuZ3RoID09IDApCiAgICAgICAgfHwgKGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtMV0uZnJvbUJsb2NrIDwgYmxvY2subnVtYmVyKSkgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2UgbmV3Q2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzWyBjaGVja3BvaW50cy5sZW5ndGgrKyBdOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LmZyb21CbG9jayA9ICB1aW50MTI4KGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgQ2hlY2twb2ludCBzdG9yYWdlIG9sZENoZWNrUG9pbnQgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV07CiAgICAgICAgICAgICAgIG9sZENoZWNrUG9pbnQudmFsdWUgPSB1aW50MTI4KF92YWx1ZSk7CiAgICAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2l6ZT4wOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoZSBmYWxsYmFjayBmdW5jdGlvbjogSWYgdGhlIGNvbnRyYWN0J3MgY29udHJvbGxlciBoYXMgbm90IGJlZW4KICAgIC8vLyAgc2V0IHRvIDAsIHRoZW4gdGhlIGBwcm94eVBheW1lbnRgIG1ldGhvZCBpcyBjYWxsZWQgd2hpY2ggcmVsYXlzIHRoZQogICAgLy8vICBldGhlciBhbmQgY3JlYXRlcyB0b2tlbnMgYXMgZGVzY3JpYmVkIGluIHRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0CiAgICBmdW5jdGlvbiAoKSAgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKTsKICAgICAgICBhc3NlcnQoQ29udHJvbGxlcihjb250cm9sbGVyKS5wcm94eVBheW1lbnQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKSk7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBFdmVudHMKLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgTmV3Q2xvbmVUb2tlbihhZGRyZXNzIGluZGV4ZWQgX2Nsb25lVG9rZW4sIHVpbnQgX3NuYXBzaG90QmxvY2spOwp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSB7CiAgICAgICAgTWluaU1lVG9rZW4gbmV3VG9rZW4gPSBuZXcgTWluaU1lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9wYXJlbnRUb2tlbiwKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF90b2tlbk5hbWUsCiAgICAgICAgICAgIF9kZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF90b2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgbmV3VG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKICAgICAgICByZXR1cm4gbmV3VG9rZW47CiAgICB9Cn0KCmNvbnRyYWN0IE1pbmlNZUlycmV2b2NhYmxlVmVzdGVkVG9rZW4gaXMgTWluaU1lVG9rZW4sIFNhZmVNYXRoIHsKCiAgdWludDI1NiBNQVhfR1JBTlRTX1BFUl9BRERSRVNTID0gMjA7CgogIC8vIEtlZXAgdGhlIHN0cnVjdCBhdCAzIHNzdG9yZXMgKCB0b3RhbCB2YWx1ZSAgMjArMzIrMjQgPTc2IGJ5dGVzKQogIHN0cnVjdCBUb2tlbkdyYW50IHsKICAgIGFkZHJlc3MgZ3JhbnRlcjsgIC8vIDIwIGJ5dGVzCiAgICB1aW50MjU2IHZhbHVlOyAgICAvLyAzMiBieXRlcwogICAgdWludDY0IGNsaWZmOwogICAgdWludDY0IHZlc3Rpbmc7CiAgICB1aW50NjQgc3RhcnQ7ICAgICAvLyAzKjggPTI0IGJ5dGVzCiAgfQoKICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQ2NCBzdGFydCwgdWludDY0IGNsaWZmLCB1aW50NjQgdmVzdGluZyk7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5HcmFudFtdKSBwdWJsaWMgZ3JhbnRzOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGNhbkNyZWF0ZUdyYW50czsKICBhZGRyZXNzIHZlc3RpbmdXaGl0ZWxpc3RlcjsKCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyLCB1aW50IF92YWx1ZSkgewogICAgcmVxdWlyZShfdmFsdWU8PXNwZW5kYWJsZUJhbGFuY2VPZihfc2VuZGVyKSk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seVZlc3RpbmdXaGl0ZWxpc3RlciB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXI9PXZlc3RpbmdXaGl0ZWxpc3Rlcik7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gTWluaU1lSXJyZXZvY2FibGVWZXN0ZWRUb2tlbiAoCiAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgIHVpbnQgX3BhcmVudFNuYXBTaG90QmxvY2ssCiAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgKSBNaW5pTWVUb2tlbihfdG9rZW5GYWN0b3J5LCBfcGFyZW50VG9rZW4sIF9wYXJlbnRTbmFwU2hvdEJsb2NrLCBfdG9rZW5OYW1lLCBfZGVjaW1hbFVuaXRzLCBfdG9rZW5TeW1ib2wsIF90cmFuc2ZlcnNFbmFibGVkKSB7CiAgICB2ZXN0aW5nV2hpdGVsaXN0ZXIgPSBtc2cuc2VuZGVyOwogICAgZG9TZXRDYW5DcmVhdGVHcmFudHModmVzdGluZ1doaXRlbGlzdGVyLCB0cnVlKTsKICB9CgogIC8vIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgICAgICAgICBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdmFsdWUpCiAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgICAgICAgICBjYW5UcmFuc2ZlcihfZnJvbSwgX3ZhbHVlKQogICAgICAgICAgIHB1YmxpYwogICAgICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gc3BlbmRhYmxlQmFsYW5jZU9mKGFkZHJlc3MgX2hvbGRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0cmFuc2ZlcmFibGVUb2tlbnMoX2hvbGRlciwgdWludDY0KG5vdykpOwogIH0KCiAgLy8gbWFpbiBmdW5jIGZvciB0b2tlbiBncmFudAoKICBmdW5jdGlvbiBncmFudFZlc3RlZFRva2VucygKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdmFsdWUsCiAgICB1aW50NjQgX3N0YXJ0LAogICAgdWludDY0IF9jbGlmZiwKICAgIHVpbnQ2NCBfdmVzdGluZykgcHVibGljIHsKCiAgICAvLyBDaGVjayBzdGFydCwgY2xpZmYgYW5kIHZlc3RpbmcgYXJlIHByb3Blcmx5IG9yZGVyIHRvIGVuc3VyZSBjb3JyZWN0IGZ1bmN0aW9uYWxpdHkgb2YgdGhlIGZvcm11bGEuCgogICAgcmVxdWlyZShfY2xpZmYgPj0gX3N0YXJ0ICYmIF92ZXN0aW5nID49IF9jbGlmZik7CiAgICAKICAgIHJlcXVpcmUodG9rZW5HcmFudHNDb3VudChfdG8pPD1NQVhfR1JBTlRTX1BFUl9BRERSRVNTKTsgLy8vLyBUbyBwcmV2ZW50IGEgdXNlciBiZWluZyBzcGFtbWVkIGFuZCBoYXZlIGhpcyBiYWxhbmNlIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4KCiAgICBhc3NlcnQoY2FuQ3JlYXRlR3JhbnRzW21zZy5zZW5kZXJdKTsKCgogICAgVG9rZW5HcmFudCBtZW1vcnkgZ3JhbnQgPSBUb2tlbkdyYW50KG1zZy5zZW5kZXIsIF92YWx1ZSwgX2NsaWZmLCBfdmVzdGluZywgX3N0YXJ0KTsKICAgIGdyYW50c1tfdG9dLnB1c2goZ3JhbnQpOwoKICAgIGFzc2VydCh0cmFuc2ZlcihfdG8sX3ZhbHVlKSk7CgogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2NsaWZmLCBfdmVzdGluZywgX3N0YXJ0KTsKICB9CgogIGZ1bmN0aW9uIHNldENhbkNyZWF0ZUdyYW50cyhhZGRyZXNzIF9hZGRyLCBib29sIF9hbGxvd2VkKQogICAgICAgICAgIG9ubHlWZXN0aW5nV2hpdGVsaXN0ZXIgcHVibGljIHsKICAgIGRvU2V0Q2FuQ3JlYXRlR3JhbnRzKF9hZGRyLCBfYWxsb3dlZCk7CiAgfQoKICBmdW5jdGlvbiBkb1NldENhbkNyZWF0ZUdyYW50cyhhZGRyZXNzIF9hZGRyLCBib29sIF9hbGxvd2VkKQogICAgICAgICAgIGludGVybmFsIHsKICAgIGNhbkNyZWF0ZUdyYW50c1tfYWRkcl0gPSBfYWxsb3dlZDsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZVZlc3RpbmdXaGl0ZWxpc3RlcihhZGRyZXNzIF9uZXdXaGl0ZWxpc3Rlcikgb25seVZlc3RpbmdXaGl0ZWxpc3RlciBwdWJsaWMgewogICAgZG9TZXRDYW5DcmVhdGVHcmFudHModmVzdGluZ1doaXRlbGlzdGVyLCBmYWxzZSk7CiAgICB2ZXN0aW5nV2hpdGVsaXN0ZXIgPSBfbmV3V2hpdGVsaXN0ZXI7CiAgICBkb1NldENhbkNyZWF0ZUdyYW50cyh2ZXN0aW5nV2hpdGVsaXN0ZXIsIHRydWUpOwogIH0KCiAgZnVuY3Rpb24gdG9rZW5HcmFudHNDb3VudChhZGRyZXNzIF9ob2xkZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CgogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50IF9ncmFudElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nKSB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOwogICAgdmFsdWUgPSBncmFudC52YWx1ZTsKICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7CiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOwogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7CgogICAgdmVzdGVkID0gdmVzdGVkVG9rZW5zKGdyYW50LCB1aW50NjQobm93KSk7CiAgfQoKICBmdW5jdGlvbiB2ZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoCiAgICAgIGdyYW50LnZhbHVlLAogICAgICB1aW50MjU2KHRpbWUpLAogICAgICB1aW50MjU2KGdyYW50LnN0YXJ0KSwKICAgICAgdWludDI1NihncmFudC5jbGlmZiksCiAgICAgIHVpbnQyNTYoZ3JhbnQudmVzdGluZykKICAgICk7CiAgfQoKICAvLyAgdHJhbnNmZXJhYmxlVG9rZW5zCiAgLy8gICB8ICAgICAgICAgICAgICAgICAgICAgICAgIF8vLS0tLS0tLS0gICBOb25WZXN0ZWRUb2tlbnMKICAvLyAgIHwgICAgICAgICAgICAgICAgICAgICAgIF8vCiAgLy8gICB8ICAgICAgICAgICAgICAgICAgICAgXy8KICAvLyAgIHwgICAgICAgICAgICAgICAgICAgXy8KICAvLyAgIHwgICAgICAgICAgICAgICAgIF8vCiAgLy8gICB8ICAgICAgICAgICAgICAgIC8KICAvLyAgIHwgICAgICAgICAgICAgIC58CiAgLy8gICB8ICAgICAgICAgICAgLiAgfAogIC8vICAgfCAgICAgICAgICAuICAgIHwKICAvLyAgIHwgICAgICAgIC4gICAgICB8CiAgLy8gICB8ICAgICAgLiAgICAgICAgfAogIC8vICAgfCAgICAuICAgICAgICAgIHwKICAvLyAgICs9PT0rPT09PT09PT09PT0rLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUKICAvLyAgICAgIFN0YXJ0ICAgICAgIENsaWZmICAgIFZlc3RpbmcKCiAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgdWludDI1NiB0b2tlbnMsCiAgICB1aW50MjU2IHRpbWUsCiAgICB1aW50MjU2IHN0YXJ0LAogICAgdWludDI1NiBjbGlmZiwKICAgIHVpbnQyNTYgdmVzdGluZykgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikKICAgIHsKCiAgICAvLyBTaG9ydGN1dHMgZm9yIGJlZm9yZSBjbGlmZiBhbmQgYWZ0ZXIgdmVzdGluZyBjYXNlcy4KICAgIGlmICh0aW1lIDwgY2xpZmYpIHJldHVybiAwOwogICAgaWYgKHRpbWUgPj0gdmVzdGluZykgcmV0dXJuIHRva2VuczsKCiAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2Vucy4KICAgIC8vIEFzIGJlZm9yZSBjbGlmZiB0aGUgc2hvcnRjdXQgcmV0dXJucyAwLCB3ZSBjYW4gdXNlIGp1c3QgdGhpcyBmdW5jdGlvbiB0bwogICAgLy8gY2FsY3VsYXRlIGl0LgoKICAgIC8vIHZlc3RlZFRva2VucyA9IHRva2VucyAqICh0aW1lIC0gc3RhcnQpIC8gKHZlc3RpbmcgLSBzdGFydCkKICAgIHVpbnQyNTYgdmVzdGVkVG9rZW5zID0gc2FmZURpdigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVNdWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FmZVN1Yih0aW1lLCBzdGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVTdWIodmVzdGluZywgc3RhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgIHJldHVybiB2ZXN0ZWRUb2tlbnM7CiAgfQoKICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWZlU3ViKGdyYW50LnZhbHVlLCB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsKICB9CgogIC8vIEBkZXYgVGhlIGRhdGUgaW4gd2hpY2ggYWxsIHRva2VucyBhcmUgdHJhbnNmZXJhYmxlIGZvciB0aGUgaG9sZGVyCiAgLy8gVXNlZnVsIGZvciBkaXNwbGF5aW5nIHB1cnBvc2VzIChub3QgdXNlZCBpbiBhbnkgbG9naWMgY2FsY3VsYXRpb25zKQogIGZ1bmN0aW9uIGxhc3RUb2tlbklzVHJhbnNmZXJhYmxlRGF0ZShhZGRyZXNzIGhvbGRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ2NCBkYXRlKSB7CiAgICBkYXRlID0gdWludDY0KG5vdyk7CiAgICB1aW50MjU2IGdyYW50SW5kZXggPSB0b2tlbkdyYW50c0NvdW50KGhvbGRlcik7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsKICAgICAgZGF0ZSA9IG1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOwogICAgfQogICAgcmV0dXJuIGRhdGU7CiAgfQoKICAvLyBAZGV2IEhvdyBtYW55IHRva2VucyBjYW4gYSBob2xkZXIgdHJhbnNmZXIgYXQgYSBwb2ludCBpbiB0aW1lCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKCiAgICBpZiAoZ3JhbnRJbmRleCA9PSAwKSByZXR1cm4gYmFsYW5jZU9mKGhvbGRlcik7IC8vIHNob3J0Y3V0IGZvciBob2xkZXIgd2l0aG91dCBncmFudHMKCiAgICAvLyBJdGVyYXRlIHRocm91Z2ggYWxsIHRoZSBncmFudHMgdGhlIGhvbGRlciBoYXMsIGFuZCBhZGQgYWxsIG5vbi12ZXN0ZWQgdG9rZW5zCiAgICB1aW50MjU2IG5vblZlc3RlZCA9IDA7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBncmFudEluZGV4OyBpKyspIHsKICAgICAgbm9uVmVzdGVkID0gc2FmZUFkZChub25WZXN0ZWQsIG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOwogICAgfQoKICAgIC8vIEJhbGFuY2UgLSB0b3RhbE5vblZlc3RlZCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhIGhvbGRlciBjYW4gdHJhbnNmZXIgYXQgYW55IGdpdmVuIHRpbWUKICAgIHJldHVybiBzYWZlU3ViKGJhbGFuY2VPZihob2xkZXIpLCBub25WZXN0ZWQpOwogIH0KfQoKCmNvbnRyYWN0IEdOUiBpcyBNaW5pTWVJcnJldm9jYWJsZVZlc3RlZFRva2VuIHsKICAvLyBAZGV2IEdOUiBjb25zdHJ1Y3RvciBqdXN0IHBhcmFtZXRyaXplcyB0aGUgTWluaU1lSXJyZXZvY2FibGVWZXN0ZWRUb2tlbiBjb25zdHJ1Y3RvcgogIGZ1bmN0aW9uIEdOUigKICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeQogICkgTWluaU1lSXJyZXZvY2FibGVWZXN0ZWRUb2tlbigKICAgIF90b2tlbkZhY3RvcnksCiAgICAweDAsICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJlbnQgdG9rZW4KICAgIDAsICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgIkdlbmFybyBOZXR3b3JrIFRva2VuIiwgLy8gVG9rZW4gbmFtZQogICAgOSwgICAgICAgICAgICAgICAgICAgICAvLyBEZWNpbWFscwogICAgIkdOUiIsICAgICAgICAgICAgICAgICAgLy8gU3ltYm9sCiAgICB0cnVlICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUgdHJhbnNmZXJzCiAgICApIHt9Cn0KCi8qCgpAbm90aWNlIFRoZSBHUlBsYWNlaG9sZGVyIGNvbnRyYWN0IHdpbGwgdGFrZSBjb250cm9sIG92ZXIgdGhlIEdOUiBhZnRlciB0aGUgc2FsZQogICAgICAgIGlzIGZpbmFsaXplZCBhbmQgYmVmb3JlIHRoZSBHZW5hcm8gTmV0d29yayBpcyBkZXBsb3llZC4KCiAgICAgICAgVGhlIGNvbnRyYWN0IGFsbG93cyBmb3IgR05SIHRyYW5zZmVycyBhbmQgdHJhbnNmZXJGcm9tIGFuZCBpbXBsZW1lbnRzIHRoZQogICAgICAgIGxvZ2ljIGZvciB0cmFuc2ZlcmluZyBjb250cm9sIG9mIHRoZSB0b2tlbiB0byB0aGUgbmV0d29yayB3aGVuIHRoZSBzYWxlCiAgICAgICAgYXNrcyBpdCB0byBkbyBzby4KKi8KCmNvbnRyYWN0IEdSUGxhY2Vob2xkZXIgaXMgQ29udHJvbGxlciB7CiAgYWRkcmVzcyBwdWJsaWMgc2FsZTsKICBHTlIgcHVibGljIHRva2VuOwoKICBmdW5jdGlvbiBHUlBsYWNlaG9sZGVyKGFkZHJlc3MgX3NhbGUsIGFkZHJlc3MgX2ducikgewogICAgc2FsZSA9IF9zYWxlOwogICAgdG9rZW4gPSBHTlIoX2ducik7CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgbmV0d29yaykgcHVibGljIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzYWxlKTsKICAgIHRva2VuLmNoYW5nZUNvbnRyb2xsZXIobmV0d29yayk7CiAgICBzdWljaWRlKG5ldHdvcmspOwogIH0KCiAgLy8gSW4gYmV0d2VlbiB0aGUgc2FsZSBhbmQgdGhlIG5ldHdvcmsuIERlZmF1bHQgc2V0dGluZ3MgZm9yIGFsbG93aW5nIHRva2VuIHRyYW5zZmVycy4KICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcykgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzLCBhZGRyZXNzLCB1aW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcywgYWRkcmVzcywgdWludCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKLy8gQGRldiBDb250cmFjdCB0byBob2xkIHNhbGUgcmFpc2VkIGZ1bmRzIGR1cmluZyB0aGUgc2FsZSBwZXJpb2QuCi8vIFByZXZlbnRzIGF0dGFjayBpbiB3aGljaCB0aGUgR2VuYXJvIE11bHRpc2lnIHNlbmRzIHJhaXNlZCBldGhlcgovLyB0byB0aGUgc2FsZSBjb250cmFjdCB0byBtaW50IHRva2VucyB0byBpdHNlbGYsIGFuZCBnZXR0aW5nIHRoZQovLyBmdW5kcyBiYWNrIGltbWVkaWF0ZWx5LgoKY29udHJhY3QgQWJzdHJhY3RTYWxlIHsKICBmdW5jdGlvbiBzYWxlRmluYWxpemVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IFNhbGVXYWxsZXQgewogIC8vIFB1YmxpYyB2YXJpYWJsZXMKICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZzsKICB1aW50IHB1YmxpYyBmaW5hbEJsb2NrOwogIEFic3RyYWN0U2FsZSBwdWJsaWMgdG9rZW5TYWxlOwoKICAvLyBAZGV2IENvbnN0cnVjdG9yIGluaXRpYWxpemVzIHB1YmxpYyB2YXJpYWJsZXMKICAvLyBAcGFyYW0gX211bHRpc2lnIFRoZSBhZGRyZXNzIG9mIHRoZSBtdWx0aXNpZyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgZnVuZHMKICAvLyBAcGFyYW0gX2ZpbmFsQmxvY2sgQmxvY2sgYWZ0ZXIgd2hpY2ggdGhlIG11bHRpc2lnIGNhbiByZXF1ZXN0IHRoZSBmdW5kcwogIGZ1bmN0aW9uIFNhbGVXYWxsZXQoYWRkcmVzcyBfbXVsdGlzaWcsIHVpbnQgX2ZpbmFsQmxvY2ssIGFkZHJlc3MgX3Rva2VuU2FsZSkgewogICAgbXVsdGlzaWcgPSBfbXVsdGlzaWc7CiAgICBmaW5hbEJsb2NrID0gX2ZpbmFsQmxvY2s7CiAgICB0b2tlblNhbGUgPSBBYnN0cmFjdFNhbGUoX3Rva2VuU2FsZSk7CiAgfQoKICAvLyBAZGV2IFJlY2VpdmUgYWxsIHNlbnQgZnVuZHMgd2l0aG91dCBhbnkgZnVydGhlciBsb2dpYwogIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHt9CgogIC8vIEBkZXYgV2l0aGRyYXcgZnVuY3Rpb24gc2VuZHMgYWxsIHRoZSBmdW5kcyB0byB0aGUgd2FsbGV0IGlmIGNvbmRpdGlvbnMgYXJlIGNvcnJlY3QKICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbXVsdGlzaWcpOyAgLy8gT25seSB0aGUgbXVsdGlzaWcgY2FuIHJlcXVlc3QgaXQKICAgIGlmIChibG9jay5udW1iZXIgPiBmaW5hbEJsb2NrKSByZXR1cm4gZG9XaXRoZHJhdygpOyAgICAgIC8vIEFsbG93IGFmdGVyIHRoZSBmaW5hbCBibG9jawogICAgaWYgKHRva2VuU2FsZS5zYWxlRmluYWxpemVkKCkpIHJldHVybiBkb1dpdGhkcmF3KCk7ICAgICAgLy8gQWxsb3cgd2hlbiBzYWxlIGlzIGZpbmFsaXplZAogIH0KCiAgZnVuY3Rpb24gZG9XaXRoZHJhdygpIGludGVybmFsIHsKICAgIHJlcXVpcmUobXVsdGlzaWcuc2VuZCh0aGlzLmJhbGFuY2UpKTsKICB9Cn0KCgpjb250cmFjdCBHZW5hcm9Ub2tlblNhbGUgaXMgQ29udHJvbGxlZCwgQ29udHJvbGxlciwgU2FmZU1hdGggewogICAgdWludCBwdWJsaWMgaW5pdGlhbEJsb2NrOyAgICAgICAgICAgICAvLyBCbG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIHNhbGUgc3RhcnRzLiBJbmNsdXNpdmUuIHNhbGUgd2lsbCBiZSBvcGVuZWQgYXQgaW5pdGlhbCBibG9jay4KICAgIHVpbnQgcHVibGljIGZpbmFsQmxvY2s7ICAgICAgICAgICAgICAgLy8gQmxvY2sgbnVtYmVyIGluIHdoaWNoIHRoZSBzYWxlIGVuZC4gRXhjbHVzaXZlLCBzYWxlIHdpbGwgYmUgY2xvc2VkIGF0IGVuZHMgYmxvY2suCiAgICB1aW50IHB1YmxpYyBwcmljZTsgICAgICAgICAgICAgICAgICAgIC8vIE51bWJlciBvZiB3ZWktR05SIHRva2VucyBmb3IgMSB3ZWksIGF0IHRoZSBzdGFydCBvZiB0aGUgc2FsZSAoOSBkZWNpbWFscykgCgogICAgYWRkcmVzcyBwdWJsaWMgZ2VuYXJvRGV2TXVsdGlzaWc7ICAgICAvLyBUaGUgYWRkcmVzcyB0byBob2xkIHRoZSBmdW5kcyBkb25hdGVkCiAgICBieXRlczMyIHB1YmxpYyBjYXBDb21taXRtZW50OwoKICAgIHVpbnQgcHVibGljIHRvdGFsQ29sbGVjdGVkID0gMDsgICAgICAgICAgICAgICAvLyBJbiB3ZWkKICAgIGJvb2wgcHVibGljIHNhbGVTdG9wcGVkID0gZmFsc2U7ICAgICAgICAgICAgICAvLyBIYXMgR2VuYXJvIERldiBzdG9wcGVkIHRoZSBzYWxlPwogICAgYm9vbCBwdWJsaWMgc2FsZUZpbmFsaXplZCA9IGZhbHNlOyAgICAgICAgICAgIC8vIEhhcyBHZW5hcm8gRGV2IGZpbmFsaXplZCB0aGUgc2FsZT8KCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBhY3RpdmF0ZWQ7ICAgLy8gQWRkcmVzcyBjb25maXJtYXRlcyB0aGF0IHdhbnRzIHRvIGFjdGl2YXRlIHRoZSBzYWxlCgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgd2hpdGVsaXN0OyAgIC8vIEFkZHJlc3MgY29uc2lzdHMgb2Ygd2hpdGVsaXN0IHBheWVyCgogICAgR05SIHB1YmxpYyB0b2tlbjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSB0b2tlbgogICAgR1JQbGFjZWhvbGRlciBwdWJsaWMgbmV0d29ya1BsYWNlaG9sZGVyOyAgICAgIC8vIFRoZSBuZXR3b3JrIHBsYWNlaG9sZGVyCiAgICBTYWxlV2FsbGV0IHB1YmxpYyBzYWxlV2FsbGV0OyAgICAgICAgICAgICAgICAgLy8gV2FsbGV0IHRoYXQgcmVjZWl2ZXMgYWxsIHNhbGUgZnVuZHMKCiAgICB1aW50IGNvbnN0YW50IHB1YmxpYyBkdXN0ID0gMSBldGhlcjsgICAgICAgICAvLyBNaW5pbXVtIGludmVzdG1lbnQKICAgIHVpbnQgY29uc3RhbnQgcHVibGljIG1heFBlclBlcnNpb24gPSAxMDAgZXRoZXI7ICAgLy8gTWF4aW11bSBpbnZlc3RtZW50IHBlciBwZXJzb24KCiAgICB1aW50IHB1YmxpYyBoYXJkQ2FwID0gMjg4OCBldGhlcjsgICAgICAgICAgLy8gSGFyZCBjYXAgZm9yIEdlbmFybyAKCiAgICBldmVudCBOZXdQcmVzYWxlQWxsb2NhdGlvbihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50MjU2IGduckFtb3VudCk7CiAgICBldmVudCBOZXdCdXllcihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyLCB1aW50MjU2IGduckFtb3VudCwgdWludDI1NiBldGhlckFtb3VudCk7CiAgICBldmVudCBDYXBSZXZlYWxlZCh1aW50IHZhbHVlLCB1aW50IHNlY3JldCwgYWRkcmVzcyByZXZlYWxlcik7CgovLy8gQGRldiBUaGVyZSBhcmUgc2V2ZXJhbCBjaGVja3MgdG8gbWFrZSBzdXJlIHRoZSBwYXJhbWV0ZXJzIGFyZSBhY2NlcHRhYmxlCi8vLyBAcGFyYW0gX2luaXRpYWxCbG9jayBUaGUgQmxvY2sgbnVtYmVyIGluIHdoaWNoIHRoZSBzYWxlIHN0YXJ0cwovLy8gQHBhcmFtIF9maW5hbEJsb2NrIFRoZSBCbG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIHNhbGUgZW5kcwovLy8gQHBhcmFtIF9nZW5hcm9EZXZNdWx0aXNpZyBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc3RvcmUgdGhlIGRvbmF0ZWQgZnVuZHMgYW5kIG1hbmFnZXIKLy8vIGZvciB0aGUgc2FsZQovLy8gQHBhcmFtIF9wcmljZSBUaGUgcHJpY2UgZm9yIHRoZSBnZW5hcm8gc2FsZS4gUHJpY2UgaW4gd2VpLUdOUiBwZXIgd2VpLgoKICBmdW5jdGlvbiBHZW5hcm9Ub2tlblNhbGUgKAogICAgICB1aW50IF9pbml0aWFsQmxvY2ssCiAgICAgIHVpbnQgX2ZpbmFsQmxvY2ssCiAgICAgIGFkZHJlc3MgX2dlbmFyb0Rldk11bHRpc2lnLAogICAgICB1aW50MjU2IF9wcmljZSwKICAgICAgYnl0ZXMzMiBfY2FwQ29tbWl0bWVudAogICkKICB7CiAgICAgIHJlcXVpcmUoX2dlbmFyb0Rldk11bHRpc2lnICE9MCk7CiAgICAgIHJlcXVpcmUoX2luaXRpYWxCbG9jayA+PSBnZXRCbG9ja051bWJlcigpKTsKICAgICAgcmVxdWlyZShfaW5pdGlhbEJsb2NrIDwgX2ZpbmFsQmxvY2spOwoKICAgICAgcmVxdWlyZSh1aW50KF9jYXBDb21taXRtZW50KSE9MCk7CiAgICAgIAoKICAgICAgLy8gU2F2ZSBjb25zdHJ1Y3RvciBhcmd1bWVudHMgYXMgZ2xvYmFsIHZhcmlhYmxlcwogICAgICBpbml0aWFsQmxvY2sgPSBfaW5pdGlhbEJsb2NrOwogICAgICBmaW5hbEJsb2NrID0gX2ZpbmFsQmxvY2s7CiAgICAgIGdlbmFyb0Rldk11bHRpc2lnID0gX2dlbmFyb0Rldk11bHRpc2lnOwogICAgICBwcmljZSA9IF9wcmljZTsKICAgICAgY2FwQ29tbWl0bWVudCA9IF9jYXBDb21taXRtZW50OwogIH0KCiAgLy8gQG5vdGljZSBEZXBsb3kgR05SIGlzIGNhbGxlZCBvbmx5IG9uY2UgdG8gc2V0dXAgYWxsIHRoZSBuZWVkZWQgY29udHJhY3RzLgogIC8vIEBwYXJhbSBfdG9rZW46IEFkZHJlc3Mgb2YgYW4gaW5zdGFuY2Ugb2YgdGhlIEdOUiB0b2tlbgogIC8vIEBwYXJhbSBfbmV0d29ya1BsYWNlaG9sZGVyOiBBZGRyZXNzIG9mIGFuIGluc3RhbmNlIG9mIEdOUlBsYWNlaG9sZGVyCiAgLy8gQHBhcmFtIF9zYWxlV2FsbGV0OiBBZGRyZXNzIG9mIHRoZSB3YWxsZXQgcmVjZWl2aW5nIHRoZSBmdW5kcyBvZiB0aGUgc2FsZQoKICBmdW5jdGlvbiBzZXRHTlIoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX25ldHdvcmtQbGFjZWhvbGRlciwgYWRkcmVzcyBfc2FsZVdhbGxldCkKICAgICAgICAgICBvbmx5KGdlbmFyb0Rldk11bHRpc2lnKQogICAgICAgICAgIHB1YmxpYyB7CgogICAgcmVxdWlyZShfdG9rZW4gIT0gMCk7CiAgICByZXF1aXJlKF9uZXR3b3JrUGxhY2Vob2xkZXIgIT0gMCk7CiAgICByZXF1aXJlKF9zYWxlV2FsbGV0ICE9IDApOwoKICAgIC8vIEFzc2VydCB0aGF0IHRoZSBmdW5jdGlvbiBoYXNuJ3QgYmVlbiBjYWxsZWQgYmVmb3JlLCBhcyBhY3RpdmF0ZSB3aWxsIGhhcHBlbiBhdCB0aGUgZW5kCiAgICBhc3NlcnQoIWFjdGl2YXRlZFt0aGlzXSk7CgogICAgdG9rZW4gPSBHTlIoX3Rva2VuKTsKICAgIG5ldHdvcmtQbGFjZWhvbGRlciA9IEdSUGxhY2Vob2xkZXIoX25ldHdvcmtQbGFjZWhvbGRlcik7CiAgICBzYWxlV2FsbGV0ID0gU2FsZVdhbGxldChfc2FsZVdhbGxldCk7CiAgICAKICAgIGFzc2VydCh0b2tlbi5jb250cm9sbGVyKCkgPT0gYWRkcmVzcyh0aGlzKSk7IC8vIHNhbGUgaXMgY29udHJvbGxlcgogICAgYXNzZXJ0KG5ldHdvcmtQbGFjZWhvbGRlci5zYWxlKCkgPT1hZGRyZXNzKHRoaXMpKTsgLy8gcGxhY2Vob2xkZXIgaGFzIHJlZmVyZW5jZSB0byBTYWxlCiAgICBhc3NlcnQobmV0d29ya1BsYWNlaG9sZGVyLnRva2VuKCkgPT0gYWRkcmVzcyh0b2tlbikpOyAvLyBwbGFjZWhvbGRlciBoYXMgcmVmZXJlbmNlIHRvIEdOUgogICAgYXNzZXJ0KHNhbGVXYWxsZXQuZmluYWxCbG9jaygpID09IGZpbmFsQmxvY2spOyAvLyBmaW5hbCBibG9ja3MgbXVzdCBtYXRjaAogICAgYXNzZXJ0KHNhbGVXYWxsZXQubXVsdGlzaWcoKSA9PSBnZW5hcm9EZXZNdWx0aXNpZyk7ICAvLyByZWNlaXZpbmcgd2FsbGV0IG11c3QgbWF0Y2gKICAgIGFzc2VydChzYWxlV2FsbGV0LnRva2VuU2FsZSgpID09IGFkZHJlc3ModGhpcykpOyAgLy8gd2F0Y2hlZCB0b2tlbiBzYWxlIG11c3QgYmUgc2VsZgoKICAgIC8vIENvbnRyYWN0IGFjdGl2YXRlcyBzYWxlIGFzIGFsbCByZXF1aXJlbWVudHMgYXJlIHJlYWR5CiAgICBkb0FjdGl2YXRlU2FsZSh0aGlzKTsKICB9CgogIC8vIEBub3RpY2UgQ2VydGFpbiBhZGRyZXNzZXMgbmVlZCB0byBjYWxsIHRoZSBhY3RpdmF0ZSBmdW5jdGlvbiBwcmlvciB0byB0aGUgc2FsZSBvcGVuaW5nIGJsb2NrLgogIC8vIFRoaXMgcHJvdmVzIHRoYXQgdGhleSBoYXZlIGNoZWNrZWQgdGhlIHNhbGUgY29udHJhY3QgaXMgbGVnaXQsIGFzIHdlbGwgYXMgcHJvdmluZwogIC8vIHRoZSBjYXBhYmlsaXR5IGZvciB0aG9zZSBhZGRyZXNzZXMgdG8gaW50ZXJhY3Qgd2l0aCB0aGUgY29udHJhY3QuCiAgZnVuY3Rpb24gYWN0aXZhdGVTYWxlKCkKICAgICAgICAgICBwdWJsaWMgewogICAgZG9BY3RpdmF0ZVNhbGUobXNnLnNlbmRlcik7CiAgfQoKICBmdW5jdGlvbiBkb0FjdGl2YXRlU2FsZShhZGRyZXNzIF9lbnRpdHkpCiAgICBub25femVyb19hZGRyZXNzKHRva2VuKSAgICAgICAgICAgICAgIC8vIGNhbm5vdCBhY3RpdmF0ZSBiZWZvcmUgc2V0dGluZyB0b2tlbgogICAgb25seV9iZWZvcmVfc2FsZQogICAgcHJpdmF0ZSB7CiAgICBhY3RpdmF0ZWRbX2VudGl0eV0gPSB0cnVlOwogIH0KCiAgLy8gQG5vdGljZSBXaGV0aGVyIHRoZSBuZWVkZWQgYWNjb3VudHMgaGF2ZSBhY3RpdmF0ZWQgdGhlIHNhbGUuCiAgLy8gQHJldHVybiBJcyBzYWxlIGFjdGl2YXRlZAogIGZ1bmN0aW9uIGlzQWN0aXZhdGVkKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBhY3RpdmF0ZWRbdGhpc10gJiYgYWN0aXZhdGVkW2dlbmFyb0Rldk11bHRpc2lnXTsKICB9CgogIC8vIEBub3RpY2UgR2V0IHRoZSBwcmljZSBmb3IgYSBHTlIgdG9rZW4gYXQgYW55IGdpdmVuIGJsb2NrIG51bWJlcgogIC8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgdGhlIGJsb2NrIGZvciB3aGljaCB0aGUgcHJpY2UgaXMgcmVxdWVzdGVkCiAgLy8gQHJldHVybiBOdW1iZXIgb2Ygd2VpLUdOUiBmb3IgMSB3ZWkKICAvLyBJZiBzYWxlIGlzbid0IG9uZ29pbmcgZm9yIHRoYXQgYmxvY2ssIHJldHVybnMgMC4KCiAgZnVuY3Rpb24gZ2V0UHJpY2UoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKF9ibG9ja051bWJlciA8IGluaXRpYWxCbG9jayB8fCBfYmxvY2tOdW1iZXIgPj0gZmluYWxCbG9jaykgcmV0dXJuIDA7CgogICAgcmV0dXJuIChwcmljZSk7CiAgfQoKICAvLyBAbm90aWNlIEdlbmFybyBEZXYgbmVlZHMgdG8gbWFrZSBpbml0aWFsIHRva2VuIGFsbG9jYXRpb25zIGZvciBwcmVzYWxlIHBhcnRuZXJzCiAgLy8gVGhpcyBhbGxvY2F0aW9uIGhhcyB0byBiZSBtYWRlIGJlZm9yZSB0aGUgc2FsZSBpcyBhY3RpdmF0ZWQuIEFjdGl2YXRpbmcgdGhlIHNhbGUgbWVhbnMgbm8gbW9yZQogIC8vIGFyYml0cmFyeSBhbGxvY2F0aW9ucyBhcmUgcG9zc2libGUgYW5kIGV4cHJlc3NlcyBjb25mb3JtaXR5LgogIC8vIEBwYXJhbSBfcmVjZWl2ZXI6IFRoZSByZWNlaXZlciBvZiB0aGUgdG9rZW5zCiAgLy8gQHBhcmFtIF9hbW91bnQ6IEFtb3VudCBvZiB0b2tlbnMgYWxsb2NhdGVkIGZvciByZWNlaXZlci4KCiAgZnVuY3Rpb24gYWxsb2NhdGVQcmVzYWxlVG9rZW5zKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50IF9hbW91bnQsIHVpbnQ2NCBjbGlmZkRhdGUsIHVpbnQ2NCB2ZXN0aW5nRGF0ZSkKICAgICAgICAgICBvbmx5X2JlZm9yZV9zYWxlX2FjdGl2YXRpb24KICAgICAgICAgICBvbmx5X2JlZm9yZV9zYWxlCiAgICAgICAgICAgbm9uX3plcm9fYWRkcmVzcyhfcmVjZWl2ZXIpCiAgICAgICAgICAgb25seShnZW5hcm9EZXZNdWx0aXNpZykKICAgICAgICAgICBwdWJsaWMgewoKICAgIHJlcXVpcmUoX2Ftb3VudDw9Ni4zKigxMCAqKiAxNSkpOyAvLyBwcmVzYWxlIDYzIG1pbGxpb24gR05SLiBObyBwcmVzYWxlIHBhcnRuZXIgd2lsbCBoYXZlIG1vcmUgdGhhbiB0aGlzIGFsbG9jYXRlZC4gUHJldmVudCBvdmVyZmxvd3MuCgogICAgYXNzZXJ0KHRva2VuLmdlbmVyYXRlVG9rZW5zKGFkZHJlc3ModGhpcyksX2Ftb3VudCkpOwogICAgCiAgICAvLyB2ZXN0ZWQgdG9rZW4gYmUgc2VudCBpbiBhcHByb3BpYXRlIHZlc3RpbmcgZGF0ZQogICAgdG9rZW4uZ3JhbnRWZXN0ZWRUb2tlbnMoX3JlY2VpdmVyLCBfYW1vdW50LCB1aW50NjQobm93KSwgY2xpZmZEYXRlLCB2ZXN0aW5nRGF0ZSk7CgogICAgTmV3UHJlc2FsZUFsbG9jYXRpb24oX3JlY2VpdmVyLCBfYW1vdW50KTsKICB9CgovLy8gQGRldiBUaGUgZmFsbGJhY2sgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gZXRoZXIgaXMgc2VudCB0byB0aGUgY29udHJhY3QsIGl0Ci8vLyBzaW1wbHkgY2FsbHMgYGRvUGF5bWVudCgpYCB3aXRoIHRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgYXMgdGhlCi8vLyBgX293bmVyYC4gUGF5YWJsZSBpcyBhIHJlcXVpcmVkIHNvbGlkaXR5IG1vZGlmaWVyIGZvciBmdW5jdGlvbnMgdG8gcmVjZWl2ZQovLy8gZXRoZXIsIHdpdGhvdXQgdGhpcyBtb2RpZmllciBmdW5jdGlvbnMgd2lsbCB0aHJvdyBpZiBldGhlciBpcyBzZW50IHRvIHRoZW0KCiAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgcmV0dXJuIGRvUGF5bWVudChtc2cuc2VuZGVyKTsKICB9CgovLy8vLy8vLy8vLy8vLy8vLwovLyBXaGl0ZWxpc3QgIGNvbnRyb2xsCi8vLy8vLy8vLy8vLy8vLy8vCgogIGZ1bmN0aW9uIGFkZFRvV2hpdGVMaXN0KGFkZHJlc3MgX293bmVyKSAKICAgICAgICAgICBvbmx5KGNvbnRyb2xsZXIpCiAgICAgICAgICAgcHVibGljewogICAgICAgICAgICAgIHdoaXRlbGlzdFtfb3duZXJdPXRydWU7CiAgICAgICAgICAgfQoKICBmdW5jdGlvbiByZW1vdmVGcm9tV2hpdGVMaXN0KGFkZHJlc3MgX293bmVyKQogICAgICAgICAgIG9ubHkoY29udHJvbGxlcikKICAgICAgICAgICBwdWJsaWN7CiAgICAgICAgICAgICAgd2hpdGVsaXN0W19vd25lcl09ZmFsc2U7CiAgICAgICAgICAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgaW52ZXN0b3IgaXMgd2hpdGVsaXN0ZWQKICBmdW5jdGlvbiBpc1doaXRlbGlzdGVkKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHdoaXRlbGlzdFtfb3duZXJdOwogIH0gICAgICAgICAgIAoKLy8vLy8vLy8vLy8vLy8vLy8KLy8gQ29udHJvbGxlciBpbnRlcmZhY2UKLy8vLy8vLy8vLy8vLy8vLy8KCi8vLyBAbm90aWNlIGBwcm94eVBheW1lbnQoKWAgYWxsb3dzIHRoZSBjYWxsZXIgdG8gc2VuZCBldGhlciB0byB0aGUgVG9rZW4gZGlyZWN0bHkgYW5kCi8vLyBoYXZlIHRoZSB0b2tlbnMgY3JlYXRlZCBpbiBhbiBhZGRyZXNzIG9mIHRoZWlyIGNob29zaW5nCi8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBuZXdseSBjcmVhdGVkIHRva2VucwoKICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGRvUGF5bWVudChfb3duZXIpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0cmFuc2ZlciwgZm9yIHRoaXMgc2FsZSBhbGwKLy8vICB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgYnkgZGVmYXVsdCBhbmQgbm8gZXh0cmEgbm90aWZpY2F0aW9ucyBhcmUgbmVlZGVkCi8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgovLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIC8vIFVudGlsIHRoZSBzYWxlIGlzIGZpbmFsaXplZCwgb25seSBhbGxvd3MgdHJhbnNmZXJzIG9yaWdpbmF0ZWQgYnkgdGhlIHNhbGUgY29udHJhY3QuCiAgICAvLyBXaGVuIGZpbmFsaXplU2FsZSBpcyBjYWxsZWQsIHRoaXMgZnVuY3Rpb24gd2lsbCBzdG9wIGJlaW5nIGNhbGxlZCBhbmQgd2lsbCBhbHdheXMgYmUgdHJ1ZS4KICAgIHJldHVybiBfZnJvbSA9PSBhZGRyZXNzKHRoaXMpOwogIH0KCi8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsLCBmb3IgdGhpcyBzYWxlIGFsbAovLy8gIGFwcHJvdmFscyBhcmUgYWxsb3dlZCBieSBkZWZhdWx0IGFuZCBubyBleHRyYSBub3RpZmljYXRpb25zIGFyZSBuZWVkZWQKLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAovLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBzcGVuZGVyIGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCi8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCi8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIC8vIE5vIGFwcHJvdmUvdHJhbnNmZXJGcm9tIGR1cmluZyB0aGUgc2FsZQogICAgcmV0dXJuIGZhbHNlOwogIH0KCi8vLyBAZGV2IGBkb1BheW1lbnQoKWAgaXMgYW4gaW50ZXJuYWwgZnVuY3Rpb24gdGhhdCBzZW5kcyB0aGUgZXRoZXIgdGhhdCB0aGlzCi8vLyAgY29udHJhY3QgcmVjZWl2ZXMgdG8gdGhlIGdlbmFyb0Rldk11bHRpc2lnIGFuZCBjcmVhdGVzIHRva2VucyBpbiB0aGUgYWRkcmVzcyBvZiB0aGUKLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zCgogIGZ1bmN0aW9uIGRvUGF5bWVudChhZGRyZXNzIF9vd25lcikKICAgICAgICAgICBvbmx5X2R1cmluZ19zYWxlX3BlcmlvZAogICAgICAgICAgIG9ubHlfc2FsZV9ub3Rfc3RvcHBlZAogICAgICAgICAgIG9ubHlfc2FsZV9hY3RpdmF0ZWQKICAgICAgICAgICBub25femVyb19hZGRyZXNzKF9vd25lcikKICAgICAgICAgICBtaW5pbXVtX3ZhbHVlKGR1c3QpCiAgICAgICAgICAgbWF4aW11bV92YWx1ZShtYXhQZXJQZXJzaW9uKQogICAgICAgICAgIGludGVybmFsIHsKCiAgICBhc3NlcnQodG90YWxDb2xsZWN0ZWQrbXNnLnZhbHVlIDw9IGhhcmRDYXApOyAvL2lmIHBhc3QgaGFyZCBjYXAsIHRocm93CgogICAgdWludDI1NiBib3VnaHRUb2tlbnMgPSBzYWZlRGl2KHNhZmVNdWwobXNnLnZhbHVlLCBnZXRQcmljZShfb3duZXIsZ2V0QmxvY2tOdW1iZXIoKSkpLDEwKio5KTsgLy8gQ2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyBib3VnaHQKCiAgICBhc3NlcnQoc2FsZVdhbGxldC5zZW5kKG1zZy52YWx1ZSkpOyAgLy9TZW5kIGZ1bmQgdG8gbXVsdGlzaWcKICAgIGFzc2VydCh0b2tlbi5nZW5lcmF0ZVRva2Vucyhfb3duZXIsYm91Z2h0VG9rZW5zKSk7Ly8gQWxsb2NhdGUgdG9rZW5zLiBUaGlzIHdpbGwgZmFpbCBhZnRlciBzYWxlIGlzIGZpbmFsaXplZCBpbiBjYXNlIGl0IGlzIGhpZGRlbiBjYXAgZmluYWxpemVkLgogICAgCiAgICB0b3RhbENvbGxlY3RlZCA9IHNhZmVBZGQodG90YWxDb2xsZWN0ZWQsIG1zZy52YWx1ZSk7IC8vIFNhdmUgdG90YWwgY29sbGVjdGVkIGFtb3VudAoKICAgIE5ld0J1eWVyKF9vd25lciwgYm91Z2h0VG9rZW5zLCBtc2cudmFsdWUpOwogIH0KCiAgLy8gQG5vdGljZSBGdW5jdGlvbiB0byBzdG9wIHNhbGUgZm9yIGFuIGVtZXJnZW5jeS4KICAvLyBAZGV2IE9ubHkgR2VuYXJvIERldiBjYW4gZG8gaXQgYWZ0ZXIgaXQgaGFzIGJlZW4gYWN0aXZhdGVkLgogIGZ1bmN0aW9uIGVtZXJnZW5jeVN0b3BTYWxlKCkKICAgICAgICAgICBvbmx5X3NhbGVfYWN0aXZhdGVkCiAgICAgICAgICAgb25seV9zYWxlX25vdF9zdG9wcGVkCiAgICAgICAgICAgb25seShnZW5hcm9EZXZNdWx0aXNpZykKICAgICAgICAgICBwdWJsaWMgewoKICAgIHNhbGVTdG9wcGVkID0gdHJ1ZTsKICB9CgogIC8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcmVzdGFydCBzdG9wcGVkIHNhbGUuCiAgLy8gQGRldiBPbmx5IEdlbmFybyBEZXYgY2FuIGRvIGl0IGFmdGVyIGl0IGhhcyBiZWVuIGRpc2FibGVkIGFuZCBzYWxlIGlzIG9uZ29pbmcuCiAgZnVuY3Rpb24gcmVzdGFydFNhbGUoKQogICAgICAgICAgIG9ubHlfZHVyaW5nX3NhbGVfcGVyaW9kCiAgICAgICAgICAgb25seV9zYWxlX3N0b3BwZWQKICAgICAgICAgICBvbmx5KGdlbmFyb0Rldk11bHRpc2lnKQogICAgICAgICAgIHB1YmxpYyB7CgogICAgc2FsZVN0b3BwZWQgPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHJldmVhbENhcCh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpCiAgICAgICAgICAgb25seV9kdXJpbmdfc2FsZV9wZXJpb2QKICAgICAgICAgICBvbmx5X3NhbGVfYWN0aXZhdGVkCiAgICAgICAgICAgdmVyaWZ5X2NhcChfY2FwLCBfY2FwX3NlY3VyZSkKICAgICAgICAgICBwdWJsaWMgewoKICAgIHJlcXVpcmUoX2NhcCA8PSBoYXJkQ2FwKTsKCiAgICBoYXJkQ2FwID0gX2NhcDsKICAgIENhcFJldmVhbGVkKF9jYXAsIF9jYXBfc2VjdXJlLCBtc2cuc2VuZGVyKTsKCiAgICBpZiAodG90YWxDb2xsZWN0ZWQgKyBkdXN0ID49IGhhcmRDYXApIHsKICAgICAgZG9GaW5hbGl6ZVNhbGUoKTsKICAgIH0KICB9CgogIC8vIEBub3RpY2UgRmluYWxpemVzIHNhbGUgZ2VuZXJhdGluZyB0aGUgdG9rZW5zIGZvciBHZW5hcm8gRGV2LgogIC8vIEBkZXYgVHJhbnNmZXJzIHRoZSB0b2tlbiBjb250cm9sbGVyIHBvd2VyIHRvIHRoZSBHUlBsYWNlaG9sZGVyLgogIGZ1bmN0aW9uIGZpbmFsaXplU2FsZSgpCiAgICAgICAgICAgb25seShnZW5hcm9EZXZNdWx0aXNpZykKICAgICAgICAgICBwdWJsaWMgewoKICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA+PSBmaW5hbEJsb2NrICB8fCAgdG90YWxDb2xsZWN0ZWQgPj0gaGFyZENhcCk7CiAgICBkb0ZpbmFsaXplU2FsZSgpOwogIH0KCiAgZnVuY3Rpb24gZG9GaW5hbGl6ZVNhbGUoKQogICAgICAgICAgIGludGVybmFsIHsKICAgIC8vIERvZXNuJ3QgY2hlY2sgaWYgc2FsZVN0b3BwZWQgaXMgZmFsc2UsIGJlY2F1c2Ugc2FsZSBjb3VsZCBlbmQgaW4gYSBlbWVyZ2VuY3kgc3RvcC4KICAgIC8vIFRoaXMgZnVuY3Rpb24gY2Fubm90IGJlIHN1Y2Nlc3NmdWxseSBjYWxsZWQgdHdpY2UsIGJlY2F1c2UgaXQgd2lsbCB0b3AgYmVpbmcgdGhlIGNvbnRyb2xsZXIsCiAgICAvLyBhbmQgdGhlIGdlbmVyYXRlVG9rZW5zIGNhbGwgd2lsbCBmYWlsIGlmIGNhbGxlZCBhZ2Fpbi4KCiAgICAvL3Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobmV0d29ya1BsYWNlaG9sZGVyKTsgLy8gU2FsZSBsb3NlcyB0b2tlbiBjb250cm9sbGVyIHBvd2VyIGluIGZhdm9yIG9mIG5ldHdvcmsgcGxhY2Vob2xkZXIKCiAgICB0b2tlbi5jaGFuZ2VDb250cm9sbGVyKGdlbmFyb0Rldk11bHRpc2lnKTsKICAgIHNhbGVGaW5hbGl6ZWQgPSB0cnVlOyAgLy8gU2V0IHN0b3AgaXMgdHJ1ZSB3aGljaCB3aWxsIGVuYWJsZSBuZXR3b3JrIGRlcGxveW1lbnQKICAgIHNhbGVTdG9wcGVkID0gdHJ1ZTsKICB9CgogIC8vIEBub3RpY2UgRGVwbG95IEdlbmFybyBOZXR3b3JrIGNvbnRyYWN0LgogIC8vIEBwYXJhbSBuZXR3b3JrQWRkcmVzczogVGhlIGFkZHJlc3MgdGhlIG5ldHdvcmsgd2FzIGRlcGxveWVkIGF0LgogIGZ1bmN0aW9uIGRlcGxveU5ldHdvcmsoYWRkcmVzcyBuZXR3b3JrQWRkcmVzcykKICAgICAgICAgICBvbmx5X2ZpbmFsaXplZF9zYWxlCiAgICAgICAgICAgbm9uX3plcm9fYWRkcmVzcyhuZXR3b3JrQWRkcmVzcykKICAgICAgICAgICBvbmx5KGdlbmFyb0Rldk11bHRpc2lnKQogICAgICAgICAgIHB1YmxpYyB7CgogICAgbmV0d29ya1BsYWNlaG9sZGVyLmNoYW5nZUNvbnRyb2xsZXIobmV0d29ya0FkZHJlc3MpOwogIH0KCiAgZnVuY3Rpb24gc2V0R2VuYXJvRGV2TXVsdGlzaWcoYWRkcmVzcyBfbmV3TXVsdGlzaWcpCiAgICAgICAgICAgbm9uX3plcm9fYWRkcmVzcyhfbmV3TXVsdGlzaWcpCiAgICAgICAgICAgb25seShnZW5hcm9EZXZNdWx0aXNpZykKICAgICAgICAgICBwdWJsaWMgewoKICAgIGdlbmFyb0Rldk11bHRpc2lnID0gX25ld011bHRpc2lnOwogIH0KCiAgZnVuY3Rpb24gZ2V0QmxvY2tOdW1iZXIoKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYmxvY2subnVtYmVyOwogIH0KCiAgZnVuY3Rpb24gY29tcHV0ZUNhcCh1aW50MjU2IF9jYXAsIHVpbnQyNTYgX2NhcF9zZWN1cmUpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChieXRlczMyKSB7CiAgICByZXR1cm4gc2hhMyhfY2FwLCBfY2FwX3NlY3VyZSk7CiAgfQoKICBmdW5jdGlvbiBpc1ZhbGlkQ2FwKHVpbnQyNTYgX2NhcCwgdWludDI1NiBfY2FwX3NlY3VyZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBjb21wdXRlQ2FwKF9jYXAsIF9jYXBfc2VjdXJlKSA9PSBjYXBDb21taXRtZW50OwogIH0KCiAgbW9kaWZpZXIgb25seShhZGRyZXNzIHgpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB4KTsKICAgIF87CiAgfQoKICBtb2RpZmllciB2ZXJpZnlfY2FwKHVpbnQyNTYgX2NhcCwgdWludDI1NiBfY2FwX3NlY3VyZSkgewogICAgcmVxdWlyZShpc1ZhbGlkQ2FwKF9jYXAsX2NhcF9zZWN1cmUpKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X2JlZm9yZV9zYWxlIHsKICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA8IGluaXRpYWxCbG9jayk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seV9kdXJpbmdfc2FsZV9wZXJpb2QgewogICAgcmVxdWlyZShnZXRCbG9ja051bWJlcigpID49IGluaXRpYWxCbG9jayk7CiAgICByZXF1aXJlKGdldEJsb2NrTnVtYmVyKCkgPCBmaW5hbEJsb2NrKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X2FmdGVyX3NhbGUgewogICAgcmVxdWlyZShnZXRCbG9ja051bWJlcigpID49IGZpbmFsQmxvY2spOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlfc2FsZV9zdG9wcGVkIHsKICAgIHJlcXVpcmUoc2FsZVN0b3BwZWQpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlfc2FsZV9ub3Rfc3RvcHBlZCB7CiAgICByZXF1aXJlKCFzYWxlU3RvcHBlZCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seV9iZWZvcmVfc2FsZV9hY3RpdmF0aW9uIHsKICAgIHJlcXVpcmUoIWlzQWN0aXZhdGVkKCkpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlfc2FsZV9hY3RpdmF0ZWQgewogICAgcmVxdWlyZShpc0FjdGl2YXRlZCgpKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5X2ZpbmFsaXplZF9zYWxlIHsKICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA+PSBmaW5hbEJsb2NrKTsKICAgIHJlcXVpcmUoc2FsZUZpbmFsaXplZCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgbm9uX3plcm9fYWRkcmVzcyhhZGRyZXNzIHgpIHsKICAgIHJlcXVpcmUoeCAhPSAwKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBtYXhpbXVtX3ZhbHVlKHVpbnQyNTYgeCkgewogICAgcmVxdWlyZShtc2cudmFsdWUgPD0geCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgbWluaW11bV92YWx1ZSh1aW50MjU2IHgpIHsKICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHgpOwogICAgXzsKICB9Cn0='.
	

]
