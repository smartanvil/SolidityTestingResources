Class {
	#name : #SRT5678bcea6d6f33f645dca8c8c9b7d8d5caf0a2b1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5678bcea6d6f33f645dca8c8c9b7d8d5caf0a2b1 >> base64 [
	^ 'Y29udHJhY3QgVG9rZW4gewogICAgLyogVGhpcyBpcyBhIHNsaWdodCBjaGFuZ2UgdG8gdGhlIEVSQzIwIGJhc2Ugc3RhbmRhcmQuCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsKICAgIGlzIHJlcGxhY2VkIHdpdGg6CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIFRoaXMgYXV0b21hdGljYWxseSBjcmVhdGVzIGEgZ2V0dGVyIGZ1bmN0aW9uIGZvciB0aGUgdG90YWxTdXBwbHkuCiAgICBUaGlzIGlzIG1vdmVkIHRvIHRoZSBiYXNlIGNvbnRyYWN0IHNpbmNlIHB1YmxpYyBnZXR0ZXIgZnVuY3Rpb25zIGFyZSBub3QKICAgIGN1cnJlbnRseSByZWNvZ25pc2VkIGFzIGFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSBtYXRjaGluZyBhYnN0cmFjdAogICAgZnVuY3Rpb24gYnkgdGhlIGNvbXBpbGVyLgogICAgKi8KICAgIC8vLyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF92YWx1ZWAgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4gewoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy9EZWZhdWx0IGFzc3VtZXMgdG90YWxTdXBwbHkgY2FuJ3QgYmUgb3ZlciBtYXggKDJeMjU2IC0gMSkuCiAgICAgICAgLy9JZiB5b3VyIHRva2VuIGxlYXZlcyBvdXQgdG90YWxTdXBwbHkgYW5kIGNhbiBpc3N1ZSBtb3JlIHRva2VucyBhcyB0aW1lIGdvZXMgb24sIHlvdSBuZWVkIHRvIGNoZWNrIGlmIGl0IGRvZXNuJ3Qgd3JhcC4KICAgICAgICAvL1JlcGxhY2UgdGhlIGlmIHdpdGggdGhpcyBvbmUgaW5zdGVhZC4KICAgICAgICAvL2lmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0KICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL3NhbWUgYXMgYWJvdmUuIFJlcGxhY2UgdGhpcyBsaW5lIHdpdGggdGhlIGZvbGxvd2luZyBpZiB5b3Ugd2FudCB0byBwcm90ZWN0IGFnYWluc3Qgd3JhcHBpbmcgdWludHMuCiAgICAgICAgLy9pZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0KICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKfQoKY29udHJhY3QgSHVtYW5TdGFuZGFyZFRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAvL2lmIGV0aGVyIGlzIHNlbnQgdG8gdGhpcyBhZGRyZXNzLCBzZW5kIGl0IGJhY2suCiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLyogUHVibGljIHZhcmlhYmxlcyBvZiB0aGUgdG9rZW4gKi8KCiAgICAvKgogICAgTk9URToKICAgIFRoZSBmb2xsb3dpbmcgdmFyaWFibGVzIGFyZSBPUFRJT05BTCB2YW5pdGllcy4gT25lIGRvZXMgbm90IGhhdmUgdG8gaW5jbHVkZSB0aGVtLgogICAgVGhleSBhbGxvdyBvbmUgdG8gY3VzdG9taXNlIHRoZSB0b2tlbiBjb250cmFjdCAmIGluIG5vIHdheSBpbmZsdWVuY2VzIHRoZSBjb3JlIGZ1bmN0aW9uYWxpdHkuCiAgICBTb21lIHdhbGxldHMvaW50ZXJmYWNlcyBtaWdodCBub3QgZXZlbiBib3RoZXIgdG8gbG9vayBhdCB0aGlzIGluZm9ybWF0aW9uLgogICAgKi8KICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgICAgLy9mYW5jeSBuYW1lOiBlZyBTaW1vbiBCdWNrcwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAgICAvL0hvdyBtYW55IGRlY2ltYWxzIHRvIHNob3cuIGllLiBUaGVyZSBjb3VsZCAxMDAwIGJhc2UgdW5pdHMgd2l0aCAzIGRlY2ltYWxzLiBNZWFuaW5nIDAuOTgwIFNCWCA9IDk4MCBiYXNlIHVuaXRzLiBJdCdzIGxpa2UgY29tcGFyaW5nIDEgd2VpIHRvIDEgZXRoZXIuCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsgICAgICAgICAgICAgICAgIC8vQW4gaWRlbnRpZmllcjogZWcgU0JYCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnSDAuMSc7ICAgICAgIC8vaHVtYW4gMC4xIHN0YW5kYXJkLiBKdXN0IGFuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZS4KCiAgICBmdW5jdGlvbiBIdW1hblN0YW5kYXJkVG9rZW4oCiAgICAgICAgdWludDI1NiBfaW5pdGlhbEFtb3VudCwKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wKICAgICAgICApIHsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IF9pbml0aWFsQW1vdW50OyAgICAgICAgICAgICAgIC8vIEdpdmUgdGhlIGNyZWF0b3IgYWxsIGluaXRpYWwgdG9rZW5zCiAgICAgICAgdG90YWxTdXBwbHkgPSBfaW5pdGlhbEFtb3VudDsgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdG90YWwgc3VwcGx5CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFtb3VudCBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgIH0KCiAgICAvKiBBcHByb3ZlcyBhbmQgdGhlbiBjYWxscyB0aGUgcmVjZWl2aW5nIGNvbnRyYWN0ICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CgogICAgICAgIC8vY2FsbCB0aGUgcmVjZWl2ZUFwcHJvdmFsIGZ1bmN0aW9uIG9uIHRoZSBjb250cmFjdCB5b3Ugd2FudCB0byBiZSBub3RpZmllZC4gVGhpcyBjcmFmdHMgdGhlIGZ1bmN0aW9uIHNpZ25hdHVyZSBtYW51YWxseSBzbyBvbmUgZG9lc24ndCBoYXZlIHRvIGluY2x1ZGUgYSBjb250cmFjdCBpbiBoZXJlIGp1c3QgZm9yIHRoaXMuCiAgICAgICAgLy9yZWNlaXZlQXBwcm92YWwoYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUsIGFkZHJlc3MgX3Rva2VuQ29udHJhY3QsIGJ5dGVzIF9leHRyYURhdGEpCiAgICAgICAgLy9pdCBpcyBhc3N1bWVkIHRoYXQgd2hlbiBkb2VzIHRoaXMgdGhhdCB0aGUgY2FsbCAqc2hvdWxkKiBzdWNjZWVkLCBvdGhlcndpc2Ugb25lIHdvdWxkIHVzZSB2YW5pbGxhIGFwcHJvdmUgaW5zdGVhZC4KICAgICAgICBpZighX3NwZW5kZXIuY2FsbChieXRlczQoYnl0ZXMzMihzaGEzKCJyZWNlaXZlQXBwcm92YWwoYWRkcmVzcyx1aW50MjU2LGFkZHJlc3MsYnl0ZXMpIikpKSwgbXNnLnNlbmRlciwgX3ZhbHVlLCB0aGlzLCBfZXh0cmFEYXRhKSkgeyB0aHJvdzsgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9Cgpjb250cmFjdCBEaXNidXJzZW1lbnQgewoKICAgIC8qCiAgICAgKiAgU3RvcmFnZQogICAgICovCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIHJlY2VpdmVyOwogICAgdWludCBwdWJsaWMgZGlzYnVyc2VtZW50UGVyaW9kOwogICAgdWludCBwdWJsaWMgc3RhcnREYXRlOwogICAgdWludCBwdWJsaWMgd2l0aGRyYXduVG9rZW5zOwogICAgVG9rZW4gcHVibGljIHRva2VuOwoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIGlzT3duZXIoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpCiAgICAgICAgICAgIC8vIE9ubHkgb3duZXIgaXMgYWxsb3dlZCB0byBwcm9jZWVkCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNSZWNlaXZlcigpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSByZWNlaXZlcikKICAgICAgICAgICAgLy8gT25seSByZWNlaXZlciBpcyBhbGxvd2VkIHRvIHByb2NlZWQKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1NldFVwKCkgewogICAgICAgIGlmIChhZGRyZXNzKHRva2VuKSA9PSAwKQogICAgICAgICAgICAvLyBDb250cmFjdCBpcyBub3Qgc2V0IHVwCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgLyoKICAgICAqICBQdWJsaWMgZnVuY3Rpb25zCiAgICAgKi8KICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIGZ1bmN0aW9uIHNldHMgY29udHJhY3Qgb3duZXIKICAgIC8vLyBAcGFyYW0gX3JlY2VpdmVyIFJlY2VpdmVyIG9mIHZlc3RlZCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Rpc2J1cnNlbWVudFBlcmlvZCBWZXN0aW5nIHBlcmlvZCBpbiBzZWNvbmRzCiAgICAvLy8gQHBhcmFtIF9zdGFydERhdGUgU3RhcnQgZGF0ZSBvZiBkaXNidXJzZW1lbnQgcGVyaW9kIChjbGlmZikKICAgIGZ1bmN0aW9uIERpc2J1cnNlbWVudChhZGRyZXNzIF9yZWNlaXZlciwgdWludCBfZGlzYnVyc2VtZW50UGVyaW9kLCB1aW50IF9zdGFydERhdGUpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgaWYgKF9yZWNlaXZlciA9PSAwIHx8IF9kaXNidXJzZW1lbnRQZXJpb2QgPT0gMCkKICAgICAgICAgICAgLy8gQXJndW1lbnRzIGFyZSBudWxsCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICByZWNlaXZlciA9IF9yZWNlaXZlcjsKICAgICAgICBkaXNidXJzZW1lbnRQZXJpb2QgPSBfZGlzYnVyc2VtZW50UGVyaW9kOwogICAgICAgIHN0YXJ0RGF0ZSA9IF9zdGFydERhdGU7CiAgICAgICAgaWYgKHN0YXJ0RGF0ZSA9PSAwKQogICAgICAgICAgICBzdGFydERhdGUgPSBub3c7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0dXAgZnVuY3Rpb24gc2V0cyBleHRlcm5hbCBjb250cmFjdHMnIGFkZHJlc3NlcwogICAgLy8vIEBwYXJhbSBfdG9rZW4gVG9rZW4gYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0dXAoVG9rZW4gX3Rva2VuKQogICAgICAgIHB1YmxpYwogICAgICAgIGlzT3duZXIKICAgIHsKICAgICAgICBpZiAoYWRkcmVzcyh0b2tlbikgIT0gMCB8fCBhZGRyZXNzKF90b2tlbikgPT0gMCkKICAgICAgICAgICAgLy8gU2V0dXAgd2FzIGV4ZWN1dGVkIGFscmVhZHkgb3IgYWRkcmVzcyBpcyBudWxsCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICBmdW5jdGlvbiB3aXRoZHJhdyhhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgaXNSZWNlaXZlcgogICAgICAgIGlzU2V0VXAKICAgIHsKICAgICAgICB1aW50IG1heFRva2VucyA9IGNhbGNNYXhXaXRoZHJhdygpOwogICAgICAgIGlmIChfdmFsdWUgPiBtYXhUb2tlbnMpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIHdpdGhkcmF3blRva2VucyArPSBfdmFsdWU7CiAgICAgICAgdG9rZW4udHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZXMgdGhlIG1heGltdW0gYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIE51bWJlciBvZiB2ZXN0ZWQgdG9rZW5zIHRvIHdpdGhkcmF3CiAgICBmdW5jdGlvbiBjYWxjTWF4V2l0aGRyYXcoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICB1aW50IG1heFRva2VucyA9ICh0b2tlbi5iYWxhbmNlT2YodGhpcykgKyB3aXRoZHJhd25Ub2tlbnMpICogKG5vdyAtIHN0YXJ0RGF0ZSkgLyBkaXNidXJzZW1lbnRQZXJpb2Q7CiAgICAgICAgaWYgKHdpdGhkcmF3blRva2VucyA+PSBtYXhUb2tlbnMgfHwgc3RhcnREYXRlID4gbm93KQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICByZXR1cm4gbWF4VG9rZW5zIC0gd2l0aGRyYXduVG9rZW5zOwogICAgfQp9Cgpjb250cmFjdCBGaWx0ZXIgewoKICAgIGV2ZW50IFNldHVwQWxsb3dhbmNlKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludCBhbW91bnQpOwoKICAgIERpc2J1cnNlbWVudCBwdWJsaWMgZGlzYnVyc2VyOwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gQmVuZWZpY2lhcnkpIHB1YmxpYyBiZW5lZmljaWFyaWVzOwoKICAgIHN0cnVjdCBCZW5lZmljaWFyeSB7CiAgICAgICAgdWludCBjbGFpbUFtb3VudDsKICAgICAgICBib29sIGNsYWltZWQ7CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gRmlsdGVyKAogICAgICAgIGFkZHJlc3NbXSBfYmVuZWZpY2lhcmllcywKICAgICAgICB1aW50W10gX2JlbmVmaWNpYXJ5VG9rZW5zCiAgICApIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBfYmVuZWZpY2lhcmllcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBiZW5lZmljaWFyaWVzW19iZW5lZmljaWFyaWVzW2ldXSA9IEJlbmVmaWNpYXJ5KHsKICAgICAgICAgICAgICAgIGNsYWltQW1vdW50OiBfYmVuZWZpY2lhcnlUb2tlbnNbaV0sCiAgICAgICAgICAgICAgICBjbGFpbWVkOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgU2V0dXBBbGxvd2FuY2UoX2JlbmVmaWNpYXJpZXNbaV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlbmVmaWNpYXJpZXNbX2JlbmVmaWNpYXJpZXNbaV1dLmNsYWltQW1vdW50KTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0dXAoRGlzYnVyc2VtZW50IF9kaXNidXJzZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKGRpc2J1cnNlcikgPT0gMCAmJiBhZGRyZXNzKF9kaXNidXJzZXIpICE9IDApOwogICAgICAgIGRpc2J1cnNlciA9IF9kaXNidXJzZXI7IAogICAgfQoKICAgIGZ1bmN0aW9uIGNsYWltKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKGJlbmVmaWNpYXJpZXNbbXNnLnNlbmRlcl0uY2xhaW1lZCA9PSBmYWxzZSk7CiAgICAgICAgYmVuZWZpY2lhcmllc1ttc2cuc2VuZGVyXS5jbGFpbWVkID0gdHJ1ZTsKICAgICAgICBkaXNidXJzZXIud2l0aGRyYXcobXNnLnNlbmRlciwgYmVuZWZpY2lhcmllc1ttc2cuc2VuZGVyXS5jbGFpbUFtb3VudCk7CiAgICB9Cn0KCmNvbnRyYWN0IFNhbGUgewoKICAgIC8qCiAgICAgKiBFdmVudHMKICAgICAqLwoKICAgIGV2ZW50IFB1cmNoYXNlZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBUcmFuc2ZlcnJlZFByZUJ1eWVyc1Jld2FyZChhZGRyZXNzIGluZGV4ZWQgcHJlQnV5ZXIsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVycmVkRm91bmRlcnNUb2tlbnMoYWRkcmVzcyB2YXVsdCwgdWludCBhbW91bnQpOwoKICAgIC8qCiAgICAgKiBTdG9yYWdlCiAgICAgKi8KCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKICAgIEh1bWFuU3RhbmRhcmRUb2tlbiBwdWJsaWMgdG9rZW47CiAgICB1aW50IHB1YmxpYyBwcmljZTsKICAgIHVpbnQgcHVibGljIHN0YXJ0QmxvY2s7CiAgICB1aW50IHB1YmxpYyBmcmVlemVCbG9jazsKICAgIGJvb2wgcHVibGljIGVtZXJnZW5jeUZsYWcgPSBmYWxzZTsKICAgIGJvb2wgcHVibGljIHByZVNhbGVUb2tlbnNEaXNidXJzZWQgPSBmYWxzZTsKICAgIGJvb2wgcHVibGljIGZvdW5kZXJzVG9rZW5zRGlzYnVyc2VkID0gZmFsc2U7CiAgICBhZGRyZXNzW10gcHVibGljIGZpbHRlcnM7CgogICAgLyoKICAgICAqIE1vZGlmaWVycwogICAgICovCgogICAgbW9kaWZpZXIgc2FsZVN0YXJ0ZWQgewogICAgICAgIHJlcXVpcmUoYmxvY2subnVtYmVyID49IHN0YXJ0QmxvY2spOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbm90RnJvemVuIHsKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA8IGZyZWV6ZUJsb2NrKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHNldHVwQ29tcGxldGUgewogICAgICAgIGFzc2VydChwcmVTYWxlVG9rZW5zRGlzYnVyc2VkICYmIGZvdW5kZXJzVG9rZW5zRGlzYnVyc2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdEluRW1lcmdlbmN5IHsKICAgICAgICBhc3NlcnQoZW1lcmdlbmN5RmxhZyA9PSBmYWxzZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogUHVibGljIGZ1bmN0aW9ucwogICAgICovCgogICAgLy8vIEBkZXYgU2FsZSgpOiBjb25zdHJ1Y3RvciBmb3IgU2FsZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgdGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgc2FsZSwgY2FuIGFjY2VzcyBvd25lci1vbmx5IGZ1bmN0aW9ucwogICAgLy8vIEBwYXJhbSBfd2FsbGV0IHRoZSBzYWxlJ3MgYmVuZWZpY2lhcnkgYWRkcmVzcyAKICAgIC8vLyBAcGFyYW0gX3Rva2VuU3VwcGx5IHRoZSB0b3RhbCBudW1iZXIgb2YgQWRUb2tlbiB0byBtaW50CiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgQWRUb2tlbidzIGh1bWFuLXJlYWRhYmxlIG5hbWUKICAgIC8vLyBAcGFyYW0gX3Rva2VuRGVjaW1hbHMgdGhlIG51bWJlciBvZiBkaXNwbGF5IGRlY2ltYWxzIGluIEFkVG9rZW4gYmFsYW5jZXMKICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIEFkVG9rZW4ncyBodW1hbi1yZWFkYWJsZSBhc3NldCBzeW1ib2wKICAgIC8vLyBAcGFyYW0gX3ByaWNlIHByaWNlIG9mIHRoZSB0b2tlbiBpbiBXZWkgKEFEVC9XZWkgcGFpciBwcmljZSkKICAgIC8vLyBAcGFyYW0gX3N0YXJ0QmxvY2sgdGhlIGJsb2NrIGF0IHdoaWNoIHRoaXMgY29udHJhY3Qgd2lsbCBiZWdpbiBzZWxsaW5nIGl0cyBBRFQgYmFsYW5jZQogICAgZnVuY3Rpb24gU2FsZSgKICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICBhZGRyZXNzIF93YWxsZXQsCiAgICAgICAgdWludDI1NiBfdG9rZW5TdXBwbHksCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX3Rva2VuRGVjaW1hbHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICB1aW50IF9wcmljZSwKICAgICAgICB1aW50IF9zdGFydEJsb2NrLAogICAgICAgIHVpbnQgX2ZyZWV6ZUJsb2NrCiAgICApIHsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgICAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgICAgIHRva2VuID0gbmV3IEh1bWFuU3RhbmRhcmRUb2tlbihfdG9rZW5TdXBwbHksIF90b2tlbk5hbWUsIF90b2tlbkRlY2ltYWxzLCBfdG9rZW5TeW1ib2wpOwogICAgICAgIHByaWNlID0gX3ByaWNlOwogICAgICAgIHN0YXJ0QmxvY2sgPSBfc3RhcnRCbG9jazsKICAgICAgICBmcmVlemVCbG9jayA9IF9mcmVlemVCbG9jazsKCiAgICAgICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKHRoaXMsIHRva2VuLnRvdGFsU3VwcGx5KCkpKTsKICAgICAgICBhc3NlcnQodG9rZW4uYmFsYW5jZU9mKHRoaXMpID09IHRva2VuLnRvdGFsU3VwcGx5KCkpOwogICAgICAgIGFzc2VydCh0b2tlbi5iYWxhbmNlT2YodGhpcykgPT0gMTAqKjE4KTsKICAgIH0KCiAgICAvLy8gQGRldiBkaXN0cmlidXRlRm91bmRlcnNSZXdhcmRzKCk6IHByaXZhdGUgdXRpbGl0eSBmdW5jdGlvbiBjYWxsZWQgYnkgY29uc3RydWN0b3IKICAgIC8vLyBAcGFyYW0gX3ByZUJ1eWVycyBhbiBhcnJheSBvZiBhZGRyZXNzZXMgdG8gd2hpY2ggYXdhcmRzIHdpbGwgYmUgZGlzdHJpYnV0ZWQKICAgIC8vLyBAcGFyYW0gX3ByZUJ1eWVyc1Rva2VucyBhbiBhcnJheSBvZiBpbnRlZ2VycyBzcGVjaWZ5aW5nIHByZUJ1eWVycyByZXdhcmRzCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlUHJlQnV5ZXJzUmV3YXJkcygKICAgICAgICBhZGRyZXNzW10gX3ByZUJ1eWVycywKICAgICAgICB1aW50W10gX3ByZUJ1eWVyc1Rva2VucwogICAgKSAKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsgCiAgICAgICAgYXNzZXJ0KCFwcmVTYWxlVG9rZW5zRGlzYnVyc2VkKTsKCiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBfcHJlQnV5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoX3ByZUJ1eWVyc1tpXSwgX3ByZUJ1eWVyc1Rva2Vuc1tpXSkpOwogICAgICAgICAgICBUcmFuc2ZlcnJlZFByZUJ1eWVyc1Jld2FyZChfcHJlQnV5ZXJzW2ldLCBfcHJlQnV5ZXJzVG9rZW5zW2ldKTsKICAgICAgICB9CgogICAgICAgIHByZVNhbGVUb2tlbnNEaXNidXJzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IGRpc3RyaWJ1dGVUaW1lbG9ja2VkUmV3YXJkcygpOiBwcml2YXRlIHV0aWxpdHkgZnVuY3Rpb24gY2FsbGVkIGJ5IGNvbnN0cnVjdG9yCiAgICAvLy8gQHBhcmFtIF9mb3VuZGVycyBhbiBhcnJheSBvZiBhZGRyZXNzZXMgc3BlY2lmeWluZyBkaXNidXJzZW1lbnQgYmVuZWZpY2lhcmllcwogICAgLy8vIEBwYXJhbSBfZm91bmRlcnNUb2tlbnMgYW4gYXJyYXkgb2YgaW50ZWdlcnMgc3BlY2lmeWluZyBkaXNidXJzZW1lbnQgYW1vdW50cwogICAgLy8vIEBwYXJhbSBfZm91bmRlclRpbWVsb2NrcyBhbiBhcnJheSBvZiBVTklYIHRpbWVzdGFtcHMgc3BlY2lmeWluZyB2ZXN0aW5nIGRhdGVzCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlRm91bmRlcnNSZXdhcmRzKAogICAgICAgIGFkZHJlc3NbXSBfZm91bmRlcnMsCiAgICAgICAgdWludFtdIF9mb3VuZGVyc1Rva2VucywKICAgICAgICB1aW50W10gX2ZvdW5kZXJUaW1lbG9ja3MKICAgICkgCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7IAogICAgICAgIGFzc2VydChwcmVTYWxlVG9rZW5zRGlzYnVyc2VkKTsKICAgICAgICBhc3NlcnQoIWZvdW5kZXJzVG9rZW5zRGlzYnVyc2VkKTsKCiAgICAgICAgLyogVG90YWwgbnVtYmVyIG9mIHRva2VucyB0byBiZSBkaXNidXJzZWQgZm9yIGEgZ2l2ZW4gdHJhbmNoLiBVc2VkIHdoZW4KICAgICAgICAgICB0b2tlbnMgYXJlIHRyYW5zZmVycmVkIHRvIGRpc2J1cnNlbWVudCBjb250cmFjdHMuICovCiAgICAgICAgdWludCB0b2tlbnNQZXJUcmFuY2ggPSAwOwogICAgICAgIC8vIEFsaWFzIG9mIGZvdW5kZXJUaW1lbG9ja3MubGVuZ3RoIGZvciBsZWdpYmlsaXR5CiAgICAgICAgdWludCB0cmFuY2hlcyA9IF9mb3VuZGVyVGltZWxvY2tzLmxlbmd0aDsKICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIHRva2VucyB3aGljaCBtYXkgYmUgd2l0aGRyYXduIHBlciBmb3VuZGVyIGZvciBlYWNoIHRyYW5jaAogICAgICAgIHVpbnRbXSBtZW1vcnkgZm91bmRlcnNUb2tlbnNQZXJUcmFuY2ggPSBuZXcgdWludFtdKF9mb3VuZGVyc1Rva2Vucy5sZW5ndGgpOwoKICAgICAgICAvLyBDb21wdXRlIGZvdW5kZXJzVG9rZW5zUGVyVHJhbmNoIGFuZCB0b2tlbnNQZXJUcmFuY2gKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IF9mb3VuZGVyc1Rva2Vucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBmb3VuZGVyc1Rva2Vuc1BlclRyYW5jaFtpXSA9IF9mb3VuZGVyc1Rva2Vuc1tpXS90cmFuY2hlczsKICAgICAgICAgICAgdG9rZW5zUGVyVHJhbmNoID0gdG9rZW5zUGVyVHJhbmNoICsgZm91bmRlcnNUb2tlbnNQZXJUcmFuY2hbaV07CiAgICAgICAgfQoKICAgICAgICAvKiBEZXBsb3kgZGlzYnVyc2VtZW50IGFuZCBmaWx0ZXIgY29udHJhY3QgcGFpcnMsIGluaXRpYWxpemUgYm90aCBhbmQgc3RvcmUKICAgICAgICAgICBmaWx0ZXIgYWRkcmVzc2VzIGluIGZpbHRlcnMgYXJyYXkuIEZpbmFsbHksIHRyYW5zZmVyIHRva2Vuc1BlclRyYW5jaCB0bwogICAgICAgICAgIGRpc2J1cnNlbWVudCBjb250cmFjdHMuICovCiAgICAgICAgZm9yKHVpbnQgaiA9IDA7IGogPCB0cmFuY2hlczsgaisrKSB7CiAgICAgICAgICAgIEZpbHRlciBmaWx0ZXIgPSBuZXcgRmlsdGVyKF9mb3VuZGVycywgZm91bmRlcnNUb2tlbnNQZXJUcmFuY2gpOwogICAgICAgICAgICBmaWx0ZXJzLnB1c2goZmlsdGVyKTsKICAgICAgICAgICAgRGlzYnVyc2VtZW50IHZhdWx0ID0gbmV3IERpc2J1cnNlbWVudChmaWx0ZXIsIDEsIF9mb3VuZGVyVGltZWxvY2tzW2pdKTsKICAgICAgICAgICAgLy8gR2l2ZSB0aGUgZGlzYnVyc2VtZW50IGNvbnRyYWN0IHRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBpdCBkaXNidXJzZXMuCiAgICAgICAgICAgIHZhdWx0LnNldHVwKHRva2VuKTsgICAgICAgICAgICAgCiAgICAgICAgICAgIC8qIEdpdmUgdGhlIGZpbHRlciBjb250cmFjdCB0aGUgYWRkcmVzcyBvZiB0aGUgZGlzYnVyc2VtZW50IGNvbnRyYWN0CiAgICAgICAgICAgICAgIGl0IGFjY2VzcyBjb250cm9scyAqLwogICAgICAgICAgICBmaWx0ZXIuc2V0dXAodmF1bHQpOyAgICAgICAgICAgICAKICAgICAgICAgICAgLy8gVHJhbnNmZXIgdG8gdGhlIHZhdWx0IHRoZSB0b2tlbnMgaXQgaXMgdG8gZGlzYnVyc2UKICAgICAgICAgICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKHZhdWx0LCB0b2tlbnNQZXJUcmFuY2gpKTsKICAgICAgICAgICAgVHJhbnNmZXJyZWRGb3VuZGVyc1Rva2Vucyh2YXVsdCwgdG9rZW5zUGVyVHJhbmNoKTsKICAgICAgICB9CgogICAgICAgIGFzc2VydCh0b2tlbi5iYWxhbmNlT2YodGhpcykgPT0gNSAqIDEwKioxNyk7CiAgICAgICAgZm91bmRlcnNUb2tlbnNEaXNidXJzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IHB1cmNoYXNlVG9rZW4oKTogZnVuY3Rpb24gdGhhdCBleGNoYW5nZXMgRVRIIGZvciBBRFQgKG1haW4gc2FsZSBmdW5jdGlvbikKICAgIC8vLyBAbm90aWNlIFlvdSdyZSBhYm91dCB0byBwdXJjaGFzZSB0aGUgZXF1aXZhbGVudCBvZiBgbXNnLnZhbHVlYCBXZWkgaW4gQURUIHRva2VucwogICAgZnVuY3Rpb24gcHVyY2hhc2VUb2tlbnMoKQogICAgICAgIHNhbGVTdGFydGVkCiAgICAgICAgcGF5YWJsZQogICAgICAgIHNldHVwQ29tcGxldGUKICAgICAgICBub3RJbkVtZXJnZW5jeQogICAgewogICAgICAgIC8qIENhbGN1bGF0ZSB3aGV0aGVyIGFueSBvZiB0aGUgbXNnLnZhbHVlIG5lZWRzIHRvIGJlIHJldHVybmVkIHRvCiAgICAgICAgICAgdGhlIHNlbmRlci4gVGhlIHRva2VuUHVyY2hhc2UgaXMgdGhlIGFjdHVhbCBudW1iZXIgb2YgdG9rZW5zIHdoaWNoCiAgICAgICAgICAgd2lsbCBiZSBwdXJjaGFzZWQgb25jZSBhbnkgZXhjZXNzQW1vdW50IGluY2x1ZGVkIGluIHRoZSBtc2cudmFsdWUKICAgICAgICAgICBpcyByZW1vdmVkIGZyb20gdGhlIHB1cmNoYXNlQW1vdW50LiAqLwogICAgICAgIHVpbnQgZXhjZXNzQW1vdW50ID0gbXNnLnZhbHVlICUgcHJpY2U7CiAgICAgICAgdWludCBwdXJjaGFzZUFtb3VudCA9IG1zZy52YWx1ZSAtIGV4Y2Vzc0Ftb3VudDsKICAgICAgICB1aW50IHRva2VuUHVyY2hhc2UgPSBwdXJjaGFzZUFtb3VudCAvIHByaWNlOwoKICAgICAgICAvLyBDYW5ub3QgcHVyY2hhc2UgbW9yZSB0b2tlbnMgdGhhbiB0aGlzIGNvbnRyYWN0IGhhcyBhdmFpbGFibGUgdG8gc2VsbAogICAgICAgIHJlcXVpcmUodG9rZW5QdXJjaGFzZSA8PSB0b2tlbi5iYWxhbmNlT2YodGhpcykpOwoKICAgICAgICAvLyBSZXR1cm4gYW55IGV4Y2VzcyBtc2cudmFsdWUKICAgICAgICBpZiAoZXhjZXNzQW1vdW50ID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV4Y2Vzc0Ftb3VudCk7CiAgICAgICAgfQoKICAgICAgICAvLyBGb3J3YXJkIHJlY2VpdmVkIGV0aGVyIG1pbnVzIGFueSBleGNlc3NBbW91bnQgdG8gdGhlIHdhbGxldAogICAgICAgIHdhbGxldC50cmFuc2ZlcihwdXJjaGFzZUFtb3VudCk7CgogICAgICAgIC8vIFRyYW5zZmVyIHRoZSBzdW0gb2YgdG9rZW5zIHRva2VuUHVyY2hhc2UgdG8gdGhlIG1zZy5zZW5kZXIKICAgICAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgdG9rZW5QdXJjaGFzZSkpOwoKICAgICAgICBQdXJjaGFzZWRUb2tlbnMobXNnLnNlbmRlciwgdG9rZW5QdXJjaGFzZSk7CiAgICB9CgogICAgLyoKICAgICAqIE93bmVyLW9ubHkgZnVuY3Rpb25zCiAgICAgKi8KCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSAwKTsKICAgICAgICBvd25lciA9IF9uZXdPd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VQcmljZSh1aW50IF9uZXdQcmljZSkKICAgICAgICBvbmx5T3duZXIKICAgICAgICBub3RGcm96ZW4KICAgIHsKICAgICAgICByZXF1aXJlKF9uZXdQcmljZSAhPSAwKTsKICAgICAgICBwcmljZSA9IF9uZXdQcmljZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VXYWxsZXQoYWRkcmVzcyBfd2FsbGV0KQogICAgICAgIG9ubHlPd25lcgogICAgICAgIG5vdEZyb3plbgogICAgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSAwKTsKICAgICAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVN0YXJ0QmxvY2sodWludCBfbmV3QmxvY2spCiAgICAgICAgb25seU93bmVyCiAgICAgICAgbm90RnJvemVuCiAgICB7CiAgICAgICAgcmVxdWlyZShfbmV3QmxvY2sgIT0gMCk7CgogICAgICAgIGZyZWV6ZUJsb2NrID0gX25ld0Jsb2NrIC0gKHN0YXJ0QmxvY2sgLSBmcmVlemVCbG9jayk7CiAgICAgICAgc3RhcnRCbG9jayA9IF9uZXdCbG9jazsKICAgIH0KCiAgICBmdW5jdGlvbiBlbWVyZ2VuY3lUb2dnbGUoKQogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGVtZXJnZW5jeUZsYWcgPSAhZW1lcmdlbmN5RmxhZzsKICAgIH0KCn0='.
	

]
