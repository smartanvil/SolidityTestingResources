Class {
	#name : #SRTd56ed0dae33a546d063e60a214dd76538a1ba5ab,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd56ed0dae33a546d063e60a214dd76538a1ba5ab >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKY29udHJhY3QgRG9Ob3RCbG9vZHlEZXBsb3lUaGlzR2V0VGhlUmlnaHRPbmUgewogICAgdWludDI1NiBub3RoaW5nOwoKICAgIGZ1bmN0aW9uIERvTm90Qmxvb2R5RGVwbG95VGhpc0dldFRoZVJpZ2h0T25lKCkgewogICAgICAgIG5vdGhpbmcgPSAyNzsKICAgIH0KfQoKCi8vKioqKioqKioqKioqKioqIE93bmFibGUKCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIAogICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCi8vKioqKioqKioqKipQYXVzaWJsZQoKY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSAoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgcmVxdWlyZSAocGF1c2VkKSA7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9CgovLyoqKioqKioqKioqKipFUkMyMAoKY29udHJhY3QgRVJDMjAgewogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKfQoKLy8qKioqKioqKioqKioqKiogU2FmZU1hdGgKCmNvbnRyYWN0IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVEaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiID4gMCk7CiAgICB1aW50IGMgPSBhIC8gYjsKICAgIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKfQoKLy8qKioqKioqKioqKioqKioqIFN0YW5kYXJkVG9rZW4KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIFNhZmVNYXRoIHsKCiAgLyoqCiAgICogQGRldiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4KICAgKi8KICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBzaXplKSB7CiAgICAgcmVxdWlyZShtc2cuZGF0YS5sZW5ndGggPj0gc2l6ZSArIDQpOwogICAgIF87CiAgfQoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyICogMzIpICByZXR1cm5zIChib29sIHN1Y2Nlc3MpewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzYWZlU3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIGlmIChfdmFsdWUgPiBfYWxsb3dhbmNlKSB0aHJvdzsKCiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9Cgpjb250cmFjdCBHQlQgewogIGZ1bmN0aW9uIHBhcmVudENoYW5nZShhZGRyZXNzLHVpbnQpOwogIGZ1bmN0aW9uIHBhcmVudEZlZXMoYWRkcmVzcyk7CiAgZnVuY3Rpb24gc2V0SEdUKGFkZHJlc3MgX2hndCk7Cn0KCi8vKioqKioqKioqKioqIEhFTExPR09MRFRPS0VOCgpjb250cmFjdCBIZWxsb0dvbGRUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGgsIFBhdXNhYmxlLCBTdGFuZGFyZFRva2VuIHsKCiAgc3RyaW5nIHB1YmxpYyBuYW1lOwogIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogIHVpbnQ4ICBwdWJsaWMgZGVjaW1hbHM7CgogIEdCVCAgZ29sZHRva2VuOwogIAoKICBmdW5jdGlvbiBzZXRHQlQoYWRkcmVzcyBnYnRfKSBvbmx5T3duZXIgewogICAgZ29sZHRva2VuID0gR0JUKGdidF8pOwogIH0KCiAgZnVuY3Rpb24gR0JUQWRkcmVzcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiBhZGRyZXNzKGdvbGR0b2tlbik7CiAgfQoKICBmdW5jdGlvbiBIZWxsb0dvbGRUb2tlbihhZGRyZXNzIF9yZXNlcnZlKSB7CiAgICBuYW1lID0gIkhlbGxvR29sZCBUb2tlbiI7CiAgICBzeW1ib2wgPSAiSEdUIjsKICAgIGRlY2ltYWxzID0gODsKIAogICAgdG90YWxTdXBwbHkgPSAxICogMTAgKiogOSAqIDEwICoqIHVpbnQyNTYoZGVjaW1hbHMpOwogICAgYmFsYW5jZXNbX3Jlc2VydmVdID0gdG90YWxTdXBwbHk7CiAgfQoKCiAgZnVuY3Rpb24gcGFyZW50Q2hhbmdlKGFkZHJlc3MgX3RvKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKGFkZHJlc3MoZ29sZHRva2VuKSAhPSAweDApOwogICAgZ29sZHRva2VuLnBhcmVudENoYW5nZShfdG8sYmFsYW5jZXNbX3RvXSk7CiAgfQogIGZ1bmN0aW9uIHBhcmVudEZlZXMoYWRkcmVzcyBfdG8pIGludGVybmFsIHsKICAgIHJlcXVpcmUoYWRkcmVzcyhnb2xkdG9rZW4pICE9IDB4MCk7CiAgICBnb2xkdG9rZW4ucGFyZW50RmVlcyhfdG8pOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKXsKICAgIHBhcmVudEZlZXMoX2Zyb20pOwogICAgcGFyZW50RmVlcyhfdG8pOwogICAgc3VjY2VzcyA9IHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSxfdG8sX3ZhbHVlKTsKICAgIHBhcmVudENoYW5nZShfZnJvbSk7CiAgICBwYXJlbnRDaGFuZ2UoX3RvKTsKICAgIHJldHVybjsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpICB7CiAgICBwYXJlbnRGZWVzKG1zZy5zZW5kZXIpOwogICAgcGFyZW50RmVlcyhfdG8pOwogICAgc3VjY2VzcyA9IHN1cGVyLnRyYW5zZmVyKF90byxfdmFsdWUpOwogICAgcGFyZW50Q2hhbmdlKG1zZy5zZW5kZXIpOwogICAgcGFyZW50Q2hhbmdlKF90byk7CiAgICByZXR1cm47CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgIHsKICAgIHJldHVybiBzdXBlci5hcHByb3ZlKF9zcGVuZGVyLF92YWx1ZSk7CiAgfQp9CgovLyoqKioqKioqKiBHT0xERkVFUyAqKioqKioqKioqKioqKioqKioqKioqKioKCmNvbnRyYWN0IEdvbGRGZWVzIGlzIFNhZmVNYXRoLE93bmFibGUgewogICAgLy8gZS5nLiBpZiByYXRlID0gMC4wMDU0CiAgICAvL3VpbnQgcmF0ZU4gPSA5OTk5NDUyMDU1OwogICAgdWludCByYXRlTiA9IDk5OTk0NTIwNTQ3OTQ1MjA1NDg7CiAgICB1aW50IHJhdGVEID0gMTk7CiAgICB1aW50IHB1YmxpYyBtYXhEYXlzOwogICAgdWludCBwdWJsaWMgbWF4UmF0ZTsKCiAgICAKICAgIGZ1bmN0aW9uIEdvbGRGZWVzKCkgewogICAgICAgIGNhbGNNYXgoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjTWF4KCkgewogICAgICAgIG1heERheXMgPSAxOwogICAgICAgIG1heFJhdGUgPSByYXRlTjsKICAgICAgICAKICAgICAgICAKICAgICAgICB1aW50IHBvdyA9IDI7CiAgICAgICAgZG8gewogICAgICAgICAgICB1aW50IG5ld04gPSByYXRlTiAqKiBwb3c7CiAgICAgICAgICAgIGlmIChuZXdOIC8gbWF4UmF0ZSAhPSBtYXhSYXRlKSB7CiAgICAgICAgICAgICAgICBtYXhEYXlzID0gcG93IC8gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1heFJhdGUgPSBuZXdOOwogICAgICAgICAgICBwb3cgKj0gMjsKICAgICAgICB9IHdoaWxlIChwb3cgPCAyMDAwKTsKICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVSYXRlKHVpbnQyNTYgX24sIHVpbnQyNTYgX2QpIG9ubHlPd25lcnsKICAgICAgICByYXRlTiA9IF9uOwogICAgICAgIHJhdGVEID0gX2Q7CiAgICAgICAgY2FsY01heCgpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByYXRlRm9yRGF5cyh1aW50MjU2IG51bURheXMpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmF0ZSkgewogICAgICAgIGlmIChudW1EYXlzIDw9IG1heERheXMpIHsKICAgICAgICAgICAgdWludCByID0gcmF0ZU4gKiogbnVtRGF5czsKICAgICAgICAgICAgdWludCBkID0gcmF0ZUQgKiBudW1EYXlzOwogICAgICAgICAgICBpZiAoZCA+IDE4KSB7CiAgICAgICAgICAgICAgICB1aW50IGRpdiA9ICAxMCAqKiAoZC0xOCk7CiAgICAgICAgICAgICAgICByYXRlID0gciAvIGRpdjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRpdiA9IDEwICoqICgxOCAtIGQpOwogICAgICAgICAgICAgICAgcmF0ZSA9IHIgKiBkaXY7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2IG1kMSA9IG51bURheXMgLyAyOwogICAgICAgICAgICB1aW50MjU2IG1kMiA9IG51bURheXMgLSBtZDE7CiAgICAgICAgICAgICB1aW50MjU2IHIyOwoKICAgICAgICAgICAgdWludDI1NiByMSA9IHJhdGVGb3JEYXlzKG1kMSk7CiAgICAgICAgICAgIGlmIChtZDEgPT0gbWQyKSB7CiAgICAgICAgICAgICAgICByMiA9IHIxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcjIgPSByYXRlRm9yRGF5cyhtZDIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgCgogICAgICAgICAgICAvL3VpbnQyNTYgcjEgPSByYXRlRm9yRGF5cyhtYXhEYXlzKTsKICAgICAgICAgICAgLy91aW50MjU2IHIyID0gcmF0ZUZvckRheXMobnVtRGF5cy1tYXhEYXlzKTsKICAgICAgICAgICAgcmF0ZSAgPSBzYWZlTXVsKCByMSAsIHIyKSAgLyAxMCAqKiAxODsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOyAKICAgICAgICAKICAgIH0KCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBVVEMyTVlUID0gMTQ4MzIwMDAwMDsKCiAgICBmdW5jdGlvbiB3b3REYXkodWludDI1NiB0aW1lKSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuICh0aW1lIC0gVVRDMk1ZVCkgLyAoMSBkYXlzKTsKICAgIH0KCiAgICAvLyBtaW5pbXVtIGZlZSBpcyAxIHVubGVzcyBzYW1lIGRheQogICAgZnVuY3Rpb24gY2FsY0ZlZXModWludDI1NiBzdGFydCwgdWludDI1NiBlbmQsIHVpbnQyNTYgc3RhcnRBbW91bnQpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IGZlZSkgewogICAgICAgIGlmIChzdGFydEFtb3VudCA9PSAwKSByZXR1cm47CiAgICAgICAgdWludDI1NiBudW1iZXJPZkRheXMgPSB3b3REYXkoZW5kKSAtIHdvdERheShzdGFydCk7CiAgICAgICAgaWYgKG51bWJlck9mRGF5cyA9PSAwKSB7CiAgICAgICAgICAgIGFtb3VudCA9IHN0YXJ0QW1vdW50OwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGFtb3VudCA9IChyYXRlRm9yRGF5cyhudW1iZXJPZkRheXMpICogc3RhcnRBbW91bnQpIC8gKDEgZXRoZXIpOwogICAgICAgIGlmICgoZmVlID09IDApICYmIChhbW91bnQgIT0gIDApKSBhbW91bnQtLTsKICAgICAgICBmZWUgPSBzYWZlU3ViKHN0YXJ0QW1vdW50LGFtb3VudCk7CiAgICB9Cn0KCi8vKioqKioqKioqKioqKioqKioqKiogR29sZEJhY2tlZFRva2VuCgpjb250cmFjdCBHb2xkQmFja2VkVG9rZW4gaXMgT3duYWJsZSwgU2FmZU1hdGgsIEVSQzIwLCBQYXVzYWJsZSB7CgogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwogIGV2ZW50IERlZHVjdEZlZXMoYWRkcmVzcyBpbmRleGVkIG93bmVyLHVpbnQyNTYgYW1vdW50KTsKCiAgZXZlbnQgVG9rZW5NaW50ZWQoYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IFRva2VuQnVybmVkKGFkZHJlc3Mgc291cmNlLCB1aW50MjU2IGFtb3VudCk7CiAgCglzdHJpbmcgcHVibGljIG5hbWUgPSAiSGVsbG9Hb2xkIEdvbGQgQmFja2VkIFRva2VuIjsKCXN0cmluZyBwdWJsaWMgc3ltYm9sID0gIkdCVCI7Cgl1aW50MjU2IGNvbnN0YW50IHB1YmxpYyAgZGVjaW1hbHMgPSAxODsgIC8vIHNhbWUgYXMgRVRICgl1aW50MjU2IGNvbnN0YW50IHB1YmxpYyAgaGd0RGVjaW1hbHMgPSA4OwoJCQoJdWludDI1NiBjb25zdGFudCBwdWJsaWMgYWxsb2NhdGlvblBvb2wgPSAxICogIDEwKio5ICogMTAqKmhndERlY2ltYWxzOyAgICAgIC8vIHRvdGFsIEhHVCBob2xkaW5ncwoJdWludDI1Ngljb25zdGFudCBwdWJsaWMJbWF4QWxsb2NhdGlvbiAgPSAzOCAqIDEwKio1ICogMTAqKmRlY2ltYWxzOwkJCS8vIG1heCBHQlQgdGhhdCBjYW4gZXZlciBldmVyIGJlIGdpdmVuIG91dAoJdWludDI1NgkgICAgICAgICBwdWJsaWMJdG90QWxsb2NhdGlvbjsJCQkvLyBhbW91bnQgb2YgR0JUIHNvIGZhcgoJCglhZGRyZXNzCQkJIHB1YmxpYyBmZWVDYWxjdWxhdG9yOwoJYWRkcmVzcwkJICAgICBwdWJsaWMgSEdUOwkJCQkJLy8gSEdUIGNvbnRyYWN0IGFkZHJlc3MKCgoKCWZ1bmN0aW9uIHNldEZlZUNhbGN1bGF0b3IoYWRkcmVzcyBuZXdGQykgb25seU93bmVyIHsKCQlmZWVDYWxjdWxhdG9yID0gbmV3RkM7Cgl9CgoKCWZ1bmN0aW9uIGNhbGNGZWVzKHVpbnQyNTYgZnJvbSwgdWludDI1NiB0bywgdWludDI1NiBhbW91bnQpIHJldHVybnMgKHVpbnQyNTYgdmFsLCB1aW50MjU2IGZlZSkgewoJCXJldHVybiBHb2xkRmVlcyhmZWVDYWxjdWxhdG9yKS5jYWxjRmVlcyhmcm9tLHRvLGFtb3VudCk7Cgl9CgoJZnVuY3Rpb24gR29sZEJhY2tlZFRva2VuKGFkZHJlc3MgZmVlQ2FsYykgewoJCWZlZUNhbGN1bGF0b3IgPSBmZWVDYWxjOwoJfQoKICAgIHN0cnVjdCBhbGxvY2F0aW9uIHsgCiAgICAgICAgdWludDI1NiAgICAgYW1vdW50OwogICAgICAgIHVpbnQyNTYgICAgIGRhdGU7CiAgICB9CgkKCWFsbG9jYXRpb25bXSAgIHB1YmxpYyBhbGxvY2F0aW9uc092ZXJUaW1lOwoJYWxsb2NhdGlvbltdICAgcHVibGljIGN1cnJlbnRBbGxvY2F0aW9uczsKCglmdW5jdGlvbiBjdXJyZW50QWxsb2NhdGlvbkxlbmd0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gY3VycmVudEFsbG9jYXRpb25zLmxlbmd0aDsKCX0KCglmdW5jdGlvbiBhb3RMZW5ndGgoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGFsbG9jYXRpb25zT3ZlclRpbWUubGVuZ3RoOwoJfQoKCQogICAgc3RydWN0IEJhbGFuY2UgewogICAgICAgIHVpbnQyNTYgYW1vdW50OyAgICAgICAgICAgICAgICAgLy8gYW1vdW50IHRocm91Z2ggdXBkYXRlIG9yIHRyYW5zZmVyCiAgICAgICAgdWludDI1NiBsYXN0VXBkYXRlZDsgICAgICAgICAgICAvLyBEQVRFIGxhc3QgdXBkYXRlZAogICAgICAgIHVpbnQyNTYgbmV4dEFsbG9jYXRpb25JbmRleDsgICAgLy8gd2hpY2ggYWxsb2NhdGlvbnNPdmVyVGltZSByZWNvcmQgY29udGFpbnMgbmV4dCB1cGRhdGUKICAgICAgICB1aW50MjU2IGFsbG9jYXRpb25TaGFyZTsgICAgICAgIC8vIHRoZSBzaGFyZSBvZiBhbGxvY2F0aW9uUG9vbCB0aGF0IHRoaXMgaG9sZGVyIGdldHMgKG1lYW5zIHRoZXkgaG9sZCBIR1QpCiAgICB9CgoJLypDcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGJhbGFuY2VzKi8KCW1hcHBpbmcgKGFkZHJlc3MgPT4gQmFsYW5jZSkgcHVibGljIGJhbGFuY2VzOwoJbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoJCglmdW5jdGlvbiB1cGRhdGUoYWRkcmVzcyB3aGVyZSkgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgcG9zOwoJCXVpbnQyNTYgZmVlczsKCQl1aW50MjU2IHZhbDsKICAgICAgICAodmFsLGZlZXMscG9zKSA9IHVwZGF0ZWRCYWxhbmNlKHdoZXJlKTsKCSAgICBiYWxhbmNlc1t3aGVyZV0ubmV4dEFsbG9jYXRpb25JbmRleCA9IHBvczsKCSAgICBiYWxhbmNlc1t3aGVyZV0uYW1vdW50ID0gdmFsOwogICAgICAgIGJhbGFuY2VzW3doZXJlXS5sYXN0VXBkYXRlZCA9IG5vdzsKCX0KCQoJZnVuY3Rpb24gdXBkYXRlZEJhbGFuY2UoYWRkcmVzcyB3aGVyZSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgdmFsLCB1aW50IGZlZXMsIHVpbnQgcG9zKSB7CgkJdWludDI1NiBjX3ZhbDsKCQl1aW50MjU2IGNfZmVlczsKCQl1aW50MjU2IGNfYW1vdW50OwoKCQkodmFsLCBmZWVzKSA9IGNhbGNGZWVzKGJhbGFuY2VzW3doZXJlXS5sYXN0VXBkYXRlZCxub3csYmFsYW5jZXNbd2hlcmVdLmFtb3VudCk7CgoJICAgIHBvcyA9IGJhbGFuY2VzW3doZXJlXS5uZXh0QWxsb2NhdGlvbkluZGV4OwoJCWlmICgocG9zIDwgY3VycmVudEFsbG9jYXRpb25zLmxlbmd0aCkgJiYgIChiYWxhbmNlc1t3aGVyZV0uYWxsb2NhdGlvblNoYXJlICE9IDApKSB7CgoJCQljX2Ftb3VudCA9IGN1cnJlbnRBbGxvY2F0aW9uc1tiYWxhbmNlc1t3aGVyZV0ubmV4dEFsbG9jYXRpb25JbmRleF0uYW1vdW50ICogYmFsYW5jZXNbd2hlcmVdLmFsbG9jYXRpb25TaGFyZSAvIGFsbG9jYXRpb25Qb29sOwoKCQkJKGNfdmFsLGNfZmVlcykgICA9IGNhbGNGZWVzKGN1cnJlbnRBbGxvY2F0aW9uc1tiYWxhbmNlc1t3aGVyZV0ubmV4dEFsbG9jYXRpb25JbmRleF0uZGF0ZSxub3csY19hbW91bnQpOwoKCQl9IAoKCSAgICB2YWwgICs9IGNfdmFsOwoJCWZlZXMgKz0gY19mZWVzOwoJCXBvcyAgID0gY3VycmVudEFsbG9jYXRpb25zLmxlbmd0aDsKCX0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aGVyZSkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB2YWwpIHsKICAgICAgICB1aW50MjU2IGZlZXM7CgkJdWludDI1NiBwb3M7CiAgICAgICAgKHZhbCxmZWVzLHBvcykgPSB1cGRhdGVkQmFsYW5jZSh3aGVyZSk7CiAgICAgICAgcmV0dXJuIDsKICAgIH0KCglldmVudCBBbGxvY2F0aW9uKHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IGRhdGUpOwoJZXZlbnQgRmVlT25BbGxvY2F0aW9uKHVpbnQyNTYgZmVlcywgdWludDI1NiBkYXRlKTsKCglldmVudCBQYXJ0Q29tcGxldGUoKTsKCWV2ZW50IFN0aWxsVG9Hbyh1aW50IG51bUxlZnQpOwoJdWludDI1NiBwdWJsaWMgcGFydFBvczsKCXVpbnQyNTYgcHVibGljIHBhcnRGZWVzOwoJdWludDI1NiBwYXJ0TDsKCWFsbG9jYXRpb25bXSAgIHB1YmxpYyBwYXJ0QWxsb2NhdGlvbnM7CgoJZnVuY3Rpb24gcGFydEFsbG9jYXRpb25MZW5ndGgoKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CgkJcmV0dXJuIHBhcnRBbGxvY2F0aW9ucy5sZW5ndGg7Cgl9CgoJZnVuY3Rpb24gYWRkQWxsb2NhdGlvblBhcnRPbmUodWludCBuZXdBbGxvY2F0aW9uLHVpbnQgbnVtU3RlcHMpIG9ubHlPd25lcnsKCQl1aW50MjU2IHRoaXNBbGxvY2F0aW9uID0gbmV3QWxsb2NhdGlvbjsKCgkJcmVxdWlyZSh0b3RBbGxvY2F0aW9uIDwgbWF4QWxsb2NhdGlvbik7CQkvLyBjYW5ub3QgYWxsb2NhdGUgbW9yZSB0aGFuIHRoaXM7CgoJCWlmIChjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoID4gcGFydEFsbG9jYXRpb25zLmxlbmd0aCkgewoJCQlwYXJ0QWxsb2NhdGlvbnMgPSBjdXJyZW50QWxsb2NhdGlvbnM7CgkJfQoKCQlpZiAodG90QWxsb2NhdGlvbiArIHRoaXNBbGxvY2F0aW9uID4gbWF4QWxsb2NhdGlvbikgewoJCQl0aGlzQWxsb2NhdGlvbiA9IG1heEFsbG9jYXRpb24gLSB0b3RBbGxvY2F0aW9uOwoJCQlsb2cwKCJtYXggYWxsb2MgcmVhY2hlZCIpOwoJCX0KCQl0b3RBbGxvY2F0aW9uICs9IHRoaXNBbGxvY2F0aW9uOwoKCQlBbGxvY2F0aW9uKHRoaXNBbGxvY2F0aW9uLG5vdyk7CgogICAgICAgIGFsbG9jYXRpb24gbWVtb3J5IG5ld0RpdjsKICAgICAgICBuZXdEaXYuYW1vdW50ID0gdGhpc0FsbG9jYXRpb247CiAgICAgICAgbmV3RGl2LmRhdGUgPSBub3c7CgkJLy8gc3RvcmUgaW50byBoaXN0b3J5CgkgICAgYWxsb2NhdGlvbnNPdmVyVGltZS5wdXNoKG5ld0Rpdik7CgkJLy8gYWRkIHRoaXMgcmVjb3JkIHRvIHRoZSBlbmQgb2YgY3VycmVudEFsbG9jYXRpb25zCgkJcGFydEwgPSBwYXJ0QWxsb2NhdGlvbnMucHVzaChuZXdEaXYpOwoJCS8vIHVwZGF0ZSBhbGwgb3RoZXIgcmVjb3JkcyB3aXRoIGNhbGNzIGZyb20gbGFzdCByZWNvcmQKCQlpZiAocGFydEFsbG9jYXRpb25zLmxlbmd0aCA8IDIpIHsgLy8gbm8gZmVlcyB0byBjb25zaWRlcgoJCQlQYXJ0Q29tcGxldGUoKTsKCQkJY3VycmVudEFsbG9jYXRpb25zID0gcGFydEFsbG9jYXRpb25zOwoJCQlGZWVPbkFsbG9jYXRpb24oMCxub3cpOwoJCQlyZXR1cm47CgkJfQoJCS8vCgkJLy8gVGhlIG9ubHkgZmVlcyB0aGF0IG5lZWQgdG8gYmUgY29sbGVjdGVkIGFyZSB0aGUgZmVlcyBvbiBsb2NhdGlvbiB6ZXJvLgoJCS8vIFNpbmNlIHRoZXkgYXJlIHRoZSBsYXN0IGNhbGN1bGF0ZWQgPSB0aGV5IGNvbWUgb3V0IHdpdGggdGhlIGJyZWFrCgkJLy8KCQlmb3IgKHBhcnRQb3MgPSBwYXJ0QWxsb2NhdGlvbnMubGVuZ3RoIC0gMjsgcGFydFBvcyA+PSAwOyBwYXJ0UG9zLS0gKXsKCQkJKHBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5hbW91bnQscGFydEZlZXMpID0gY2FsY0ZlZXMocGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmRhdGUsbm93LHBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5hbW91bnQpOwoKCQkJcGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmFtb3VudCArPSBwYXJ0QWxsb2NhdGlvbnNbcGFydEwgLSAxXS5hbW91bnQ7CgkJCXBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5kYXRlICAgID0gbm93OwoJCQlpZiAoKHBhcnRQb3MgPT0gMCkgfHwgKHBhcnRQb3MgPT0gcGFydEFsbG9jYXRpb25zLmxlbmd0aC1udW1TdGVwcykpewoJCQkJYnJlYWs7IAoJCQl9CgkJfQoJCWlmIChwYXJ0UG9zICE9IDApIHsKCQkJU3RpbGxUb0dvKHBhcnRQb3MpOwoJCQlyZXR1cm47IC8vIG5vdCBkb25lIHlldAoJCX0KCQlQYXJ0Q29tcGxldGUoKTsKCQlGZWVPbkFsbG9jYXRpb24ocGFydEZlZXMsbm93KTsKCQljdXJyZW50QWxsb2NhdGlvbnMgPSBwYXJ0QWxsb2NhdGlvbnM7Cgl9CgoJZnVuY3Rpb24gYWRkQWxsb2NhdGlvblBhcnRUd28odWludCBudW1TdGVwcykgb25seU93bmVyIHsKCQlyZXF1aXJlKG51bVN0ZXBzID4gMCk7CgkJcmVxdWlyZShwYXJ0UG9zID4gMCk7CgkJZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtU3RlcHM7IGkrKyApewoJCQlwYXJ0UG9zLS07CgkJCShwYXJ0QWxsb2NhdGlvbnNbcGFydFBvc10uYW1vdW50LHBhcnRGZWVzKSA9IGNhbGNGZWVzKHBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5kYXRlLG5vdyxwYXJ0QWxsb2NhdGlvbnNbcGFydFBvc10uYW1vdW50KTsKCgkJCXBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5hbW91bnQgKz0gcGFydEFsbG9jYXRpb25zW3BhcnRMIC0gMV0uYW1vdW50OwoJCQlwYXJ0QWxsb2NhdGlvbnNbcGFydFBvc10uZGF0ZSAgICA9IG5vdzsKCQkJaWYgKHBhcnRQb3MgPT0gMCkgewoJCQkJYnJlYWs7IAoJCQl9CgkJfQoJCWlmIChwYXJ0UG9zICE9IDApIHsKCQkJU3RpbGxUb0dvKHBhcnRQb3MpOwoJCQlyZXR1cm47IC8vIG5vdCBkb25lIHlldAoJCX0KCQlQYXJ0Q29tcGxldGUoKTsKCQlGZWVPbkFsbG9jYXRpb24ocGFydEZlZXMsbm93KTsKCQljdXJyZW50QWxsb2NhdGlvbnMgPSBwYXJ0QWxsb2NhdGlvbnM7Cgl9CgoKCWZ1bmN0aW9uIHNldEhHVChhZGRyZXNzIF9oZ3QpIG9ubHlPd25lciB7CgkJSEdUID0gX2hndDsKCX0KCglmdW5jdGlvbiBwYXJlbnRGZWVzKGFkZHJlc3Mgd2hlcmUpIHdoZW5Ob3RQYXVzZWQgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBIR1QpOwoJICAgIHVwZGF0ZSh3aGVyZSk7CQkKCX0KCQoJZnVuY3Rpb24gcGFyZW50Q2hhbmdlKGFkZHJlc3Mgd2hlcmUsIHVpbnQgbmV3VmFsdWUpIHdoZW5Ob3RQYXVzZWQgeyAvLyBjYWxsZWQgd2hlbiBIR1QgYmFsYW5jZSBjaGFuZ2VzCgkJcmVxdWlyZShtc2cuc2VuZGVyID09IEhHVCk7CgkgICAgYmFsYW5jZXNbd2hlcmVdLmFsbG9jYXRpb25TaGFyZSA9IG5ld1ZhbHVlOwoJfQoJCgkvKiBzZW5kIEdCVCAqLwoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgb2spIHsKCSAgICB1cGRhdGUobXNnLnNlbmRlcik7ICAgICAgICAgICAgICAvLyBEbyB0aGlzIHRvIGVuc3VyZSBzZW5kZXIgaGFzIGVub3VnaCBmdW5kcy4KCQl1cGRhdGUoX3RvKTsgCgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdLmFtb3VudCA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0uYW1vdW50LCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10uYW1vdW50ID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLmFtb3VudCwgX3ZhbHVlKTsKCgkJVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOyAvL05vdGlmeSBhbnlvbmUgbGlzdGVuaW5nIHRoYXQgdGhpcyB0cmFuc2ZlciB0b29rIHBsYWNlCiAgICAgICAgcmV0dXJuIHRydWU7Cgl9CgoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQl2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKCSAgICB1cGRhdGUoX2Zyb20pOyAgICAgICAgICAgICAgLy8gRG8gdGhpcyB0byBlbnN1cmUgc2VuZGVyIGhhcyBlbm91Z2ggZnVuZHMuCgkJdXBkYXRlKF90byk7IAoKCQliYWxhbmNlc1tfdG9dLmFtb3VudCA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXS5hbW91bnQsIF92YWx1ZSk7CgkJYmFsYW5jZXNbX2Zyb21dLmFtb3VudCA9IHNhZmVTdWIoYmFsYW5jZXNbX2Zyb21dLmFtb3VudCwgX3ZhbHVlKTsKCQlhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsKCQlUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoJCXJldHVybiB0cnVlOwoJfQoKICAJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQlyZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKICAgIAlhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIAlBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIAlyZXR1cm4gdHJ1ZTsKICAJfQoKICAJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgCXJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIAl9CgoJLy8gTWludGluZyBGdW5jdGlvbnMgCglhZGRyZXNzIHB1YmxpYyBhdXRob3Jpc2VkTWludGVyOwoKCWZ1bmN0aW9uIHNldE1pbnRlcihhZGRyZXNzIG1pbnRlcikgb25seU93bmVyIHsKCQlhdXRob3Jpc2VkTWludGVyID0gbWludGVyOwoJfQoJCglmdW5jdGlvbiBtaW50VG9rZW5zKGFkZHJlc3MgZGVzdGluYXRpb24sIHVpbnQyNTYgYW1vdW50KSB7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IGF1dGhvcmlzZWRNaW50ZXIpOwoJCXVwZGF0ZShkZXN0aW5hdGlvbik7CgkJYmFsYW5jZXNbZGVzdGluYXRpb25dLmFtb3VudCA9IHNhZmVBZGQoYmFsYW5jZXNbZGVzdGluYXRpb25dLmFtb3VudCwgYW1vdW50KTsKCQliYWxhbmNlc1tkZXN0aW5hdGlvbl0ubGFzdFVwZGF0ZWQgPSBub3c7CgkJYmFsYW5jZXNbZGVzdGluYXRpb25dLm5leHRBbGxvY2F0aW9uSW5kZXggPSBjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoOwoJCVRva2VuTWludGVkKGRlc3RpbmF0aW9uLGFtb3VudCk7Cgl9CgoJZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIHNvdXJjZSwgdWludDI1NiBhbW91bnQpIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gYXV0aG9yaXNlZE1pbnRlcik7CgkJdXBkYXRlKHNvdXJjZSk7CgkJYmFsYW5jZXNbc291cmNlXS5hbW91bnQgPSBzYWZlU3ViKGJhbGFuY2VzW3NvdXJjZV0uYW1vdW50LGFtb3VudCk7CgkJYmFsYW5jZXNbc291cmNlXS5sYXN0VXBkYXRlZCA9IG5vdzsKCQliYWxhbmNlc1tzb3VyY2VdLm5leHRBbGxvY2F0aW9uSW5kZXggPSBjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoOwoJCVRva2VuQnVybmVkKHNvdXJjZSxhbW91bnQpOwoJfQp9CgovLyoqKioqKioqKioqKioqKiogSGVsbG9Hb2xkU2FsZQoKY29udHJhY3QgSGVsbG9Hb2xkU2FsZSBpcyBQYXVzYWJsZSwgU2FmZU1hdGggewoKICB1aW50MjU2IHB1YmxpYyBkZWNpbWFscyA9IDg7CgogIHVpbnQyNTYgcHVibGljIHN0YXJ0RGF0ZSA9IDE1MDM4OTI4MDA7ICAgICAgLy8gTW9uZGF5LCBBdWd1c3QgMjgsIDIwMTcgMTI6MDA6MDAgUE0gR01UKzA4OjAwCiAgdWludDI1NiBwdWJsaWMgZW5kRGF0ZSAgID0gMTUwNDQ5NzYwMDsgICAgICAvLyBNb25kYXksIFNlcHRlbWJlciA0LCAyMDE3IDEyOjAwOjAwIFBNIEdNVCswODowMAoKICB1aW50MjU2IHRyYW5jaGVQZXJpb2QgPSAxIHdlZWtzOwoKICAvLyBhZGRyZXNzIG9mIEhHVCBUb2tlbi4gSEdUIG11c3QgQXBwcm92ZSB0aGlzIGNvbnRyYWN0IHRvIGRpc2J1cnNlIDMwME0gdG9rZW5zCiAgSGVsbG9Hb2xkVG9rZW4gICAgICAgICAgdG9rZW47CgogIHVpbnQyNTYgY29uc3RhbnQgTWF4Q29pbnNSMSAgICAgID0gMTgwICogMTAqKjYgKiAxMCoqODsgICAvLyAxODBNIEhHVAogIHVpbnQyNTYgcHVibGljIGNvaW5zUmVtYWluaW5nICAgID0gMTgwICogMTAqKjYgKiAxMCoqODsgCiAgdWludDI1NiBjb2luc1BlclRpZXIgICAgICAgICAgICAgPSAgMjAgKiAxMCoqNiAqIDEwKio4OyAgIC8vIDIwTSBIR1QKICB1aW50MjU2IHB1YmxpYyBjb2luc0xlZnRJblRpZXIgICA9ICAyMCAqIDEwKio2ICogMTAqKjg7CgogIHVpbnQyNTYgcHVibGljIG1pbmltdW1DYXAgICAgICAgID0gIDA7ICAgLy8gNDBNIEhHVAoKICB1aW50MjU2IG51bVRpZXJzICAgICAgICAgICAgICAgICAgPSA1OwogIHVpbnQxNiAgcHVibGljIHRpZXJObzsKICB1aW50MjU2IHB1YmxpYyBwcmVhbGxvY0NvaW5zOyAgIC8vIHVzZWQgZm9yIHRlc3RpbmcgYWdhaW5zdCBjYXAgKGluYyBwbGFjZW1lbnQpCiAgdWludDI1NiBwdWJsaWMgcHVyY2hhc2VkQ29pbnM7ICAvLyB1c2VkIGZvciB0ZXN0aW5nIGFnYWluc3QgdGllciBwcmljaW5nCiAgdWludDI1NiBwdWJsaWMgZXRoUmFpc2VkOwogIHVpbnQyNTYgcHVibGljIHBlcnNvbmFsTWF4ICAgICAgICA9IDEwIGV0aGVyOyAgICAgLy8gbWF4IGV0aGVyIHBlciBwZXJzb24gZHVyaW5nIHB1YmxpYyBzYWxlCiAgdWludDI1NiBwdWJsaWMgY29udHJpYnV0b3JzOwoKICBhZGRyZXNzIHB1YmxpYyBjczsKICBhZGRyZXNzIHB1YmxpYyBtdWx0aVNpZzsKICBhZGRyZXNzIHB1YmxpYyBIR1RfUmVzZXJ2ZTsKICAKICBzdHJ1Y3QgY3NBY3Rpb24gewogICAgICBib29sICAgICAgICBwYXNzZWRLWUM7CiAgICAgIGJvb2wgICAgICAgIGJsb2NrZWQ7CiAgfQoKICAvKiBUaGlzIGNyZWF0ZXMgYW4gYXJyYXkgd2l0aCBhbGwgYmFsYW5jZXMgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGNzQWN0aW9uKSBwdWJsaWMgcGVybWlzc2lvbnM7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSAgcHVibGljIGRlcG9zaXRzOwoKICBtb2RpZmllciBNdXN0QmVFbmFibGVkKGFkZHJlc3MgeCkgewogICAgICByZXF1aXJlICghcGVybWlzc2lvbnNbeF0uYmxvY2tlZCkgOwogICAgICByZXF1aXJlIChwZXJtaXNzaW9uc1t4XS5wYXNzZWRLWUMpIDsKICAgICAgCiAgICAgIF87CiAgfQoKICBmdW5jdGlvbiBIZWxsb0dvbGRTYWxlKGFkZHJlc3MgX2NzLCBhZGRyZXNzIF9oZ3QsIGFkZHJlc3MgX211bHRpU2lnLCBhZGRyZXNzIF9yZXNlcnZlKSB7CiAgICBjcyAgICAgICAgICA9IF9jczsKICAgIHRva2VuICAgICAgID0gSGVsbG9Hb2xkVG9rZW4oX2hndCk7CiAgICBtdWx0aVNpZyAgICA9IF9tdWx0aVNpZzsKICAgIEhHVF9SZXNlcnZlID0gX3Jlc2VydmU7CiAgfQoKICAvLyBXZSBvbmx5IGV4cGVjdCB0byB1c2UgdGhpcyB0byBzZXQvcmVzZXQgdGhlIHN0YXJ0IG9mIHRoZSBjb250cmFjdCB1bmRlciBleGNlcHRpb25hbCBjaXJjdW1zdGFuY2VzCiAgZnVuY3Rpb24gc2V0U3RhcnQodWludDI1NiB3aGVuXykgb25seU93bmVyIHsKICAgICAgc3RhcnREYXRlID0gd2hlbl87CiAgICAgIGVuZERhdGUgPSB3aGVuXyArIHRyYW5jaGVQZXJpb2Q7CiAgfQoKICBtb2RpZmllciBNdXN0QmVDcygpIHsKICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBjcykgOwogICAgICAKICAgICAgXzsKICB9CgoKICAvLyAxIGV0aGVyID0gTiBIR1QgdG9rZW5zIAogIHVpbnQyNTZbNV0gcHVibGljIGhndFJhdGVzID0gWzEyNDg5MDAwMDAwMDAsMTE5NjkwMDAwMDAwMCwxMTQ0ODAwMDAwMDAwLDEwOTI4MDAwMDAwMDAsMTA0MDcwMDAwMDAwMF07CiAgICAgICAgICAgICAgICAgICAgICAKCiAgICAvKiBBcHByb3ZlIHRoZSBhY2NvdW50IGZvciBvcGVyYXRpb24gKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyB1c2VyKSBNdXN0QmVDcyB7CiAgICAgICAgcGVybWlzc2lvbnNbdXNlcl0ucGFzc2VkS1lDID0gdHJ1ZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmxvY2soYWRkcmVzcyB1c2VyKSBNdXN0QmVDcyB7CiAgICAgICAgcGVybWlzc2lvbnNbdXNlcl0uYmxvY2tlZCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdW5ibG9jayhhZGRyZXNzIHVzZXIpIE11c3RCZUNzIHsKICAgICAgICAgcGVybWlzc2lvbnNbdXNlcl0uYmxvY2tlZCA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIG5ld0NzKGFkZHJlc3MgbmV3Q3MpIG9ubHlPd25lciB7CiAgICAgICAgY3MgPSBuZXdDczsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRQZXJpb2QodWludDI1NiBwZXJpb2RfKSBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUgKCFmdW5kaW5nKCkpIDsKICAgICAgICB0cmFuY2hlUGVyaW9kID0gcGVyaW9kXzsKICAgICAgICBlbmREYXRlID0gc3RhcnREYXRlICsgdHJhbmNoZVBlcmlvZDsKICAgICAgICBpZiAoZW5kRGF0ZSA8IG5vdyArIHRyYW5jaGVQZXJpb2QpIHsKICAgICAgICAgICAgZW5kRGF0ZSA9IG5vdyArIHRyYW5jaGVQZXJpb2Q7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHdoZW4oKSAgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBub3c7CiAgICB9CgogIGZ1bmN0aW9uIGZ1bmRpbmcoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7ICAgICAKICAgIGlmIChwYXVzZWQpIHJldHVybiBmYWxzZTsgICAgICAgICAgICAgICAvLyBmcm96ZW4KICAgIGlmIChub3cgPCBzdGFydERhdGUpIHJldHVybiBmYWxzZTsgICAgICAvLyB0b28gZWFybHkKICAgIGlmIChub3cgPiBlbmREYXRlKSByZXR1cm4gZmFsc2U7ICAgICAgICAvLyB0b28gbGF0ZQogICAgaWYgKGNvaW5zUmVtYWluaW5nID09IDApIHJldHVybiBmYWxzZTsgIC8vIG5vIG1vcmUgY29pbnMKICAgIGlmICh0aWVyTm8gPj0gbnVtVGllcnMgKSByZXR1cm4gZmFsc2U7ICAvLyBwYXNzZWQgZW5kIG9mIHRvcCB0aWVyLiBUaWVycyBzdGFydCBhdCB6ZXJvCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHN1Y2Nlc3MoKSBjb25zdGFudCByZXR1cm5zIChib29sIHN1Y2NlZWRlZCkgewogICAgaWYgKGNvaW5zUmVtYWluaW5nID09IDApIHJldHVybiB0cnVlOwogICAgYm9vbCBjb21wbGV0ZSA9IChub3cgPiBlbmREYXRlKSA7CiAgICBib29sIGRpZE9LID0gKGNvaW5zUmVtYWluaW5nIDw9IChNYXhDb2luc1IxIC0gbWluaW11bUNhcCkpOyAvLyBub3QgZXZlbiA0ME0gR29uZT8/IEFhcmdoLgogICAgc3VjY2VlZGVkID0gKGNvbXBsZXRlICYmIGRpZE9LKSAgOyAgLy8gKG91dCBvZiBzdGVhbSBidXQgZW5vdWdoIHNvbGQpIAogICAgcmV0dXJuIDsKICB9CgogIGZ1bmN0aW9uIGZhaWxlZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZGlkTm90U3VjY2VlZCkgewogICAgYm9vbCBjb21wbGV0ZSA9IChub3cgPiBlbmREYXRlICApOwogICAgYm9vbCBkaWRCYWQgPSAoY29pbnNSZW1haW5pbmcgPiAoTWF4Q29pbnNSMSAtIG1pbmltdW1DYXApKTsKICAgIGRpZE5vdFN1Y2NlZWQgPSAoY29tcGxldGUgJiYgZGlkQmFkKTsKICAgIHJldHVybjsKICB9CgogIAogIGZ1bmN0aW9uICgpIHBheWFibGUgTXVzdEJlRW5hYmxlZChtc2cuc2VuZGVyKSB3aGVuTm90UGF1c2VkIHsgICAgCiAgICBjcmVhdGVUb2tlbnMobXNnLnNlbmRlcixtc2cudmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gbGlua0NvaW4oYWRkcmVzcyBjb2luKSBvbmx5T3duZXIgewogICAgdG9rZW4gPSBIZWxsb0dvbGRUb2tlbihjb2luKTsKICB9CgogIGZ1bmN0aW9uIGNvaW5BZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICByZXR1cm4gYWRkcmVzcyh0b2tlbik7CiAgfQoKICAvLyBoZ3RSYXRlcyBpbiB3aG9sZSB0b2tlbnMgcGVyIEVUSAogIC8vIG1heCBpbmRpdmlkdWFsIGNvbnRyaWJ1dGlvbiBpbiB3aG9sZSBFVEgKICBmdW5jdGlvbiBzZXRIZ3RSYXRlcyh1aW50MjU2IHAwLHVpbnQyNTYgcDEsdWludDI1NiBwMix1aW50MjU2IHAzLHVpbnQyNTYgcDQsIHVpbnQyNTYgX21heCApIG9ubHlPd25lciB7CiAgICAgICAgICAgICAgcmVxdWlyZSAobm93IDwgc3RhcnREYXRlKSA7CiAgICAgICAgICAgICAgaGd0UmF0ZXNbMF0gICA9IHAwICogMTAqKjg7CiAgICAgICAgICAgICAgaGd0UmF0ZXNbMV0gICA9IHAxICogMTAqKjg7CiAgICAgICAgICAgICAgaGd0UmF0ZXNbMl0gICA9IHAyICogMTAqKjg7CiAgICAgICAgICAgICAgaGd0UmF0ZXNbM10gICA9IHAzICogMTAqKjg7CiAgICAgICAgICAgICAgaGd0UmF0ZXNbNF0gICA9IHA0ICogMTAqKjg7CiAgICAgICAgICAgICAgcGVyc29uYWxNYXggPSBfbWF4ICogMSBldGhlcjsgICAgICAgICAgIC8vIG1heCBFVEggcGVyIHBlcnNvbgogIH0KCiAgCiAgZXZlbnQgUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50MjU2IGxldmVsLHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgdG9rZW5zKTsKICBldmVudCBSZWR1Y3Rpb24oc3RyaW5nIG1zZywgYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50MjU2IHdhbnRlZCwgdWludDI1NiBhbGxvY2F0ZWQpOwogIAogIGZ1bmN0aW9uIGNyZWF0ZVRva2VucyhhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiB2YWx1ZSkgcHJpdmF0ZSB7CiAgICB1aW50MjU2IHRvdGFsVG9rZW5zOwogICAgdWludDI1NiBoZ3RSYXRlOwogICAgcmVxdWlyZSAoZnVuZGluZygpKSA7CiAgICByZXF1aXJlICh2YWx1ZSA+IDEgZmlubmV5KSA7CiAgICByZXF1aXJlIChkZXBvc2l0c1tyZWNpcGllbnRdIDwgcGVyc29uYWxNYXgpOwoKICAgIHVpbnQyNTYgbWF4UmVmdW5kID0gMDsKICAgIGlmICgoZGVwb3NpdHNbbXNnLnNlbmRlcl0gKyB2YWx1ZSkgPiBwZXJzb25hbE1heCkgewogICAgICAgIG1heFJlZnVuZCA9IGRlcG9zaXRzW21zZy5zZW5kZXJdICsgdmFsdWUgLSBwZXJzb25hbE1heDsKICAgICAgICB2YWx1ZSAtPSBtYXhSZWZ1bmQ7CiAgICAgICAgbG9nMCgibWF4aW11bSBmdW5kcyBleGNlZWRlZCIpOwogICAgfSAgCgogICAgdWludDI1NiB2YWwgPSB2YWx1ZTsKCiAgICBldGhSYWlzZWQgPSBzYWZlQWRkKGV0aFJhaXNlZCx2YWx1ZSk7CiAgICBpZiAoZGVwb3NpdHNbcmVjaXBpZW50XSA9PSAwKSBjb250cmlidXRvcnMrKzsKICAgIAogICAgCiAgICBkbyB7CiAgICAgIGhndFJhdGUgPSBoZ3RSYXRlc1t0aWVyTm9dOyAgICAgICAgICAgICAgICAgLy8gaGd0UmF0ZSBtdXN0IGluY2x1ZGUgdGhlIDEwXjgKICAgICAgdWludCB0b2tlbnMgPSBzYWZlTXVsKHZhbCwgaGd0UmF0ZSk7ICAgICAgLy8gKHZhbCBpbiBldGggKiAxMF4xOCkgKiAjdG9rZW5zIHBlciBldGgKICAgICAgdG9rZW5zID0gc2FmZURpdih0b2tlbnMsIDEgZXRoZXIpOyAgICAgIC8vIHZhbCBpcyBpbiBldGhlciwgbXNnLnZhbHVlIGlzIGluIHdlaQogICAKICAgICAgaWYgKHRva2VucyA8PSBjb2luc0xlZnRJblRpZXIpIHsKICAgICAgICB1aW50MjU2IGFjdHVhbFRva2VucyA9IHRva2VuczsKICAgICAgICB1aW50IHJlZnVuZCA9IDA7CiAgICAgICAgaWYgKHRva2VucyA+IGNvaW5zUmVtYWluaW5nKSB7IC8vY2FuJ3Qgc2VsbCBkZXNpcmVkICMgdG9rZW5zCiAgICAgICAgICAgIFJlZHVjdGlvbigiaW4gdGllciIscmVjaXBpZW50LHRva2Vucyxjb2luc1JlbWFpbmluZyk7CiAgICAgICAgICAgIGFjdHVhbFRva2VucyA9IGNvaW5zUmVtYWluaW5nOwogICAgICAgICAgICByZWZ1bmQgPSBzYWZlU3ViKHRva2VucywgY29pbnNSZW1haW5pbmcgKTsgLy8gcmVmdW5kIGFtb3VudCBpbiB0b2tlbnMKICAgICAgICAgICAgcmVmdW5kID0gc2FmZURpdihyZWZ1bmQqMSBldGhlcixoZ3RSYXRlICk7ICAvLyByZWZ1bmQgYW1vdW50IGluIEVUSAogICAgICAgICAgICAvLyBuZWVkIGEgcmVmdW5kIG1lY2hhbmlzbSBoZXJlIHRvbwogICAgICAgICAgICBjb2luc1JlbWFpbmluZyA9IDA7CiAgICAgICAgICAgIHZhbCA9IHNhZmVTdWIoIHZhbCxyZWZ1bmQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvaW5zUmVtYWluaW5nICA9IHNhZmVTdWIoY29pbnNSZW1haW5pbmcsICBhY3R1YWxUb2tlbnMpOwogICAgICAgIH0KICAgICAgICBwdXJjaGFzZWRDb2lucyAgPSBzYWZlQWRkKHB1cmNoYXNlZENvaW5zLCBhY3R1YWxUb2tlbnMpOwoKICAgICAgICB0b3RhbFRva2VucyA9IHNhZmVBZGQodG90YWxUb2tlbnMsYWN0dWFsVG9rZW5zKTsKCiAgICAgICAgcmVxdWlyZSAodG9rZW4udHJhbnNmZXJGcm9tKEhHVF9SZXNlcnZlLCByZWNpcGllbnQsdG90YWxUb2tlbnMpKSA7CgogICAgICAgIFB1cmNoYXNlKHJlY2lwaWVudCx0aWVyTm8sdmFsLGFjdHVhbFRva2Vucyk7IC8vIGV2ZW50CgogICAgICAgIGRlcG9zaXRzW3JlY2lwaWVudF0gPSBzYWZlQWRkKGRlcG9zaXRzW3JlY2lwaWVudF0sdmFsKTsgLy8gaW4gY2FzZSBvZiByZWZ1bmQgLSBjb3VsZCBwdWxsIG9mZiBldGhlcnNjYW4KICAgICAgICByZWZ1bmQgKz0gbWF4UmVmdW5kOwogICAgICAgIGlmIChyZWZ1bmQgPiAwKSB7CiAgICAgICAgICAgIGV0aFJhaXNlZCA9IHNhZmVTdWIoZXRoUmFpc2VkLHJlZnVuZCk7CiAgICAgICAgICAgIHJlY2lwaWVudC50cmFuc2ZlcihyZWZ1bmQpOwogICAgICAgIH0KICAgICAgICBpZiAoY29pbnNSZW1haW5pbmcgPD0gKE1heENvaW5zUjEgLSBtaW5pbXVtQ2FwKSl7IC8vIGhhcyBwYXNzZWQgc3VjY2VzcyBjcml0ZXJpYQogICAgICAgICAgICBpZiAoIW11bHRpU2lnLnNlbmQodGhpcy5iYWxhbmNlKSkgeyAgICAgICAgICAgICAgICAvLyBzZW5kIGZ1bmRzIHRvIEhHRgogICAgICAgICAgICAgICAgbG9nMCgiY2Fubm90IGZvcndhcmQgZnVuZHMgdG8gb3duZXIiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb2luc0xlZnRJblRpZXIgPSBzYWZlU3ViKGNvaW5zTGVmdEluVGllcixhY3R1YWxUb2tlbnMpOwogICAgICAgIGlmICgoY29pbnNMZWZ0SW5UaWVyID09IDApICYmIChjb2luc1JlbWFpbmluZyAhPSAwKSkgeyAvLyBleGFjdCBzZWxsIG91dCBvZiBub24gZmluYWwgdGllcgogICAgICAgICAgICBjb2luc0xlZnRJblRpZXIgPSBjb2luc1BlclRpZXI7CiAgICAgICAgICAgIHRpZXJObysrOwogICAgICAgICAgICBlbmREYXRlID0gbm93ICsgdHJhbmNoZVBlcmlvZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIGNoZWNrIHRoYXQgY29pbnNMZWZ0SW5UaWVyID49IGNvaW5zUmVtYWluaW5nCgogICAgICB1aW50MjU2IGNvaW5zMmJ1eSA9IG1pbjI1Nihjb2luc0xlZnRJblRpZXIgLCBjb2luc1JlbWFpbmluZyk7IAoKICAgICAgZW5kRGF0ZSA9IHNhZmVBZGQoIG5vdywgdHJhbmNoZVBlcmlvZCk7CiAgICAgIC8vIEhhdmUgYnVtcGVkIGxldmVscyAtIG5lZWQgdG8gbW9kaWZ5IGVuZCBkYXRlIGhlcmUKICAgICAgcHVyY2hhc2VkQ29pbnMgPSBzYWZlQWRkKHB1cmNoYXNlZENvaW5zLCBjb2luczJidXkpOyAgLy8gZ2l2ZSBhbGwgY29pbnMgcmVtYWluaW5nIGluIHRoaXMgdGllcgogICAgICB0b3RhbFRva2VucyAgICA9IHNhZmVBZGQodG90YWxUb2tlbnMsY29pbnMyYnV5KTsKICAgICAgY29pbnNSZW1haW5pbmcgPSBzYWZlU3ViKGNvaW5zUmVtYWluaW5nLGNvaW5zMmJ1eSk7CgogICAgICB1aW50IHdlaUNvaW5zTGVmdEluVGhpc1RpZXIgPSBzYWZlTXVsKGNvaW5zMmJ1eSwxIGV0aGVyKTsKICAgICAgdWludCBjb3N0T2ZUaGVzZUNvaW5zID0gc2FmZURpdih3ZWlDb2luc0xlZnRJblRoaXNUaWVyLCBoZ3RSYXRlKTsgIC8vIGhvdyBtdWNoIGRpZCB0aGF0IGNvc3Q/CgogICAgICBQdXJjaGFzZShyZWNpcGllbnQsIHRpZXJObyxjb3N0T2ZUaGVzZUNvaW5zLGNvaW5zMmJ1eSk7IC8vIGV2ZW50CgogICAgICBkZXBvc2l0c1tyZWNpcGllbnRdID0gc2FmZUFkZChkZXBvc2l0c1tyZWNpcGllbnRdLGNvc3RPZlRoZXNlQ29pbnMpOwogICAgICB2YWwgICAgPSBzYWZlU3ViKHZhbCxjb3N0T2ZUaGVzZUNvaW5zKTsKICAgICAgdGllck5vID0gdGllck5vICsgMTsKICAgICAgY29pbnNMZWZ0SW5UaWVyID0gY29pbnNQZXJUaWVyOwogICAgfSB3aGlsZSAoKHZhbCA+IDApICYmIGZ1bmRpbmcoKSk7CgogICAgLy8gZXNjYXBlZCBiZWNhdXNlIHdlIHBhc3NlZCB0aGUgZW5kIG9mIHRoZSB1bml2ZXJzZS4uLi4uCiAgICAvLyBzbyBnaXZlIHRoZW0gdGhlaXIgdG9rZW5zCiAgICByZXF1aXJlICh0b2tlbi50cmFuc2ZlckZyb20oSEdUX1Jlc2VydmUsIHJlY2lwaWVudCx0b3RhbFRva2VucykpIDsKCiAgICBpZiAoKHZhbCA+IDApIHx8IChtYXhSZWZ1bmQgPiAwKSl7CiAgICAgICAgUmVkdWN0aW9uKCJmaW5pc2hlZCBjcm93ZHNhbGUsIHJldHVybmluZyAiLHJlY2lwaWVudCx2YWx1ZSx0b3RhbFRva2Vucyk7CiAgICAgICAgLy8gcmV0dXJuIHRoZSByZW1haW5kZXIgIQogICAgICAgIHJlY2lwaWVudC50cmFuc2Zlcih2YWwrbWF4UmVmdW5kKTsgLy8gaWYgeW91IGNhbid0IHJldHVybiB0aGUgYmFsYW5jZSwgYWJvcnQgd2hvbGUgcHJvY2VzcwogICAgfQogICAgaWYgKCFtdWx0aVNpZy5zZW5kKHRoaXMuYmFsYW5jZSkpIHsKICAgICAgICBldGhSYWlzZWQgPSBzYWZlU3ViKGV0aFJhaXNlZCx0aGlzLmJhbGFuY2UpOwogICAgICAgIGxvZzAoImNhbm5vdCBzZW5kIGF0IHRpZXIganVtcCIpOwogICAgfQogIH0KICAKICBmdW5jdGlvbiBhbGxvY2F0ZWRUb2tlbnMoYWRkcmVzcyBncmFudGVlLCB1aW50MjU2IG51bVRva2Vucykgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKG5vdyA8IHN0YXJ0RGF0ZSkgOwogICAgaWYgKG51bVRva2VucyA8IGNvaW5zUmVtYWluaW5nKSB7CiAgICAgICAgY29pbnNSZW1haW5pbmcgPSBzYWZlU3ViKGNvaW5zUmVtYWluaW5nLCBudW1Ub2tlbnMpOwogICAgICAgCiAgICB9IGVsc2UgewogICAgICAgIG51bVRva2VucyA9IGNvaW5zUmVtYWluaW5nOwogICAgICAgIGNvaW5zUmVtYWluaW5nID0gMDsKICAgIH0KICAgIHByZWFsbG9jQ29pbnMgPSBzYWZlQWRkKHByZWFsbG9jQ29pbnMsbnVtVG9rZW5zKTsKICAgIHJlcXVpcmUgKHRva2VuLnRyYW5zZmVyRnJvbShIR1RfUmVzZXJ2ZSxncmFudGVlLG51bVRva2VucykpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXcoKSB7IC8vIGl0IGZhaWxlZC4gQ29tZSBhbmQgZ2V0IHlvdXIgZXRoZXIuCiAgICAgIGlmIChmYWlsZWQoKSkgewogICAgICAgICAgaWYgKGRlcG9zaXRzW21zZy5zZW5kZXJdID4gMCkgewogICAgICAgICAgICAgIHVpbnQyNTYgdmFsID0gZGVwb3NpdHNbbXNnLnNlbmRlcl07CiAgICAgICAgICAgICAgZGVwb3NpdHNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodmFsKTsKICAgICAgICAgIH0KICAgICAgfQogIH0KCiAgZnVuY3Rpb24gY29tcGxldGUoKSBvbmx5T3duZXIgeyAgLy8gdGhpcyBzaG91bGQgbm90IGhhdmUgdG8gYmUgY2FsbGVkLiBFeHRyZW1lIG1lYXN1cmVzLgogICAgICBpZiAoc3VjY2VzcygpKSB7CiAgICAgICAgICB1aW50MjU2IHZhbCA9IHRoaXMuYmFsYW5jZTsKICAgICAgICAgIGlmICh2YWwgPiAwKSB7CiAgICAgICAgICAgIGlmICghbXVsdGlTaWcuc2VuZCh2YWwpKSB7CiAgICAgICAgICAgICAgICBsb2cwKCJjYW5ub3Qgd2l0aGRyYXciKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxvZzAoImZ1bmRzIHdpdGhkcmF3biIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGxvZzAoIm5vdGhpbmcgdG8gd2l0aGRyYXciKTsKICAgICAgICAgIH0KICAgICAgfQogIH0KCn0='.
	

]
