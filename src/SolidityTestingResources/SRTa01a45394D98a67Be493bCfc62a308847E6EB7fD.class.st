Class {
	#name : #SRTa01a45394D98a67Be493bCfc62a308847E6EB7fD,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa01a45394D98a67Be493bCfc62a308847E6EB7fD >> base64 [
	^ 'LyoqCiAqIEB0aXRsZSBNYXRoCiAqIEBkZXYgQXNzb3J0ZWQgbWF0aCBvcGVyYXRpb25zCiAqLwpsaWJyYXJ5IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KCgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAvLyB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYSAvIGI7CiAgfQoKICAvKioKICAqIEBkZXYgU3VidHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIGVtaXQgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCmNvbnRyYWN0IEV4dGVybmFsSW50ZXJmYWNlIHsKICBmdW5jdGlvbiBnaXZlSXRlbShhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQyNTYgX3RyYWl0cykgZXh0ZXJuYWw7CgogIGZ1bmN0aW9uIGdpdmVNdWx0aXBsZUl0ZW1zKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NltdIF90cmFpdHMpIGV4dGVybmFsOwoKICBmdW5jdGlvbiBnaXZlTXVsdGlwbGVJdGVtc1RvTXVsdGlwbGVSZWNpcGllbnRzKGFkZHJlc3NbXSBfcmVjaXBpZW50cywgdWludDI1NltdIF90cmFpdHMpIGV4dGVybmFsOwoKICBmdW5jdGlvbiBnaXZlTXVsdGlwbGVJdGVtc0FuZERlc3Ryb3lNdWx0aXBsZUl0ZW1zKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NltdIF90cmFpdHMsIHVpbnQyNTZbXSBfdG9rZW5JZHMpIGV4dGVybmFsOwogIAogIGZ1bmN0aW9uIGRlc3Ryb3lJdGVtKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwoKICBmdW5jdGlvbiBkZXN0cm95TXVsdGlwbGVJdGVtcyh1aW50MjU2W10gX3Rva2VuSWRzKSBleHRlcm5hbDsKCiAgZnVuY3Rpb24gdXBkYXRlSXRlbVRyYWl0cyh1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF90cmFpdHMpIGV4dGVybmFsOwp9CgoKCmNvbnRyYWN0IExvb3Rib3hJbnRlcmZhY2UgewogIGV2ZW50IExvb3Rib3hQdXJjaGFzZWQoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3RvcmVBZGRyZXNzLCB1aW50MTYgZGlzcGxheVZhbHVlKTsKICAKICBmdW5jdGlvbiBidXkoYWRkcmVzcyBfYnV5ZXIpIGV4dGVybmFsOwp9CgoKLy8vIEB0aXRsZSBFUkMtMTY1IFN0YW5kYXJkIEludGVyZmFjZSBEZXRlY3Rpb24KLy8vIEBkZXYgU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvbWFzdGVyL0VJUFMvZWlwLTE2NS5tZAppbnRlcmZhY2UgRVJDMTY1IHsKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBpbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKCgovKioKICogQHRpdGxlIEVSQzcyMSBOb24tRnVuZ2libGUgVG9rZW4gU3RhbmRhcmQgYmFzaWMgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvbWFzdGVyL0VJUFMvZWlwLTcyMS5tZAogKi8KY29udHJhY3QgRVJDNzIxQmFzaWMgewogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5JZCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9hcHByb3ZlZCwgdWludDI1NiBfdG9rZW5JZCk7CiAgZXZlbnQgQXBwcm92YWxGb3JBbGwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9vcGVyYXRvciwgYm9vbCBfYXBwcm92ZWQpOwoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2JhbGFuY2UpOwogIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwogIGZ1bmN0aW9uIGV4aXN0cyh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIF9leGlzdHMpOwoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgZnVuY3Rpb24gZ2V0QXBwcm92ZWQodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3BlcmF0b3IpOwoKICBmdW5jdGlvbiBzZXRBcHByb3ZhbEZvckFsbChhZGRyZXNzIF9vcGVyYXRvciwgYm9vbCBfYXBwcm92ZWQpIHB1YmxpYzsKICBmdW5jdGlvbiBpc0FwcHJvdmVkRm9yQWxsKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9vcGVyYXRvcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljOwogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYzsKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKAogICAgYWRkcmVzcyBfZnJvbSwKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdG9rZW5JZCwKICAgIGJ5dGVzIF9kYXRhCiAgKQogICAgcHVibGljOwp9CgoKLyoqCiAqIEB0aXRsZSBFUkMtNzIxIE5vbi1GdW5naWJsZSBUb2tlbiBTdGFuZGFyZCwgb3B0aW9uYWwgZW51bWVyYXRpb24gZXh0ZW5zaW9uCiAqIEBkZXYgU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvbWFzdGVyL0VJUFMvZWlwLTcyMS5tZAogKi8KY29udHJhY3QgRVJDNzIxRW51bWVyYWJsZSBpcyBFUkM3MjFCYXNpYyB7CiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfdG9rZW5JZCk7CiAgZnVuY3Rpb24gdG9rZW5CeUluZGV4KHVpbnQyNTYgX2luZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0b2tlbnNPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NltdKTsKfQoKLyoqCiAqIEB0aXRsZSBFUkMtNzIxIE5vbi1GdW5naWJsZSBUb2tlbiBTdGFuZGFyZCwgZnVsbCBpbXBsZW1lbnRhdGlvbiBpbnRlcmZhY2UKICogQGRldiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtNzIxLm1kCiAqLwpjb250cmFjdCBFUkM3MjEgaXMgRVJDNzIxQmFzaWMsIEVSQzcyMUVudW1lcmFibGUgewp9CgoKCi8qKgogKiBAdGl0bGUgRVJDNzIxIE5vbi1GdW5naWJsZSBUb2tlbiBTdGFuZGFyZCBiYXNpYyBpbXBsZW1lbnRhdGlvbgogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC03MjEubWQKICovCmNvbnRyYWN0IEVSQzcyMUJhc2ljVG9rZW4gaXMgRVJDNzIxQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIHVzaW5nIEFkZHJlc3NVdGlscyBmb3IgYWRkcmVzczsKCiAgLy8gRXF1YWxzIHRvIGBieXRlczQoa2VjY2FrMjU2KCJvbkVSQzcyMVJlY2VpdmVkKGFkZHJlc3MsdWludDI1NixieXRlcykiKSlgCiAgLy8gd2hpY2ggY2FuIGJlIGFsc28gb2J0YWluZWQgYXMgYEVSQzcyMVJlY2VpdmVyKDApLm9uRVJDNzIxUmVjZWl2ZWQuc2VsZWN0b3JgCiAgYnl0ZXM0IGNvbnN0YW50IEVSQzcyMV9SRUNFSVZFRCA9IDB4ZjBiOWU1YmE7CgogIC8vIE1hcHBpbmcgZnJvbSB0b2tlbiBJRCB0byBvd25lcgogIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaW50ZXJuYWwgdG9rZW5Pd25lcjsKCiAgLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGFwcHJvdmVkIGFkZHJlc3MKICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGludGVybmFsIHRva2VuQXBwcm92YWxzOwoKICAvLyBNYXBwaW5nIGZyb20gb3duZXIgdG8gbnVtYmVyIG9mIG93bmVkIHRva2VuCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBpbnRlcm5hbCBvd25lZFRva2Vuc0NvdW50OwoKICAvLyBNYXBwaW5nIGZyb20gb3duZXIgdG8gb3BlcmF0b3IgYXBwcm92YWxzCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpKSBpbnRlcm5hbCBvcGVyYXRvckFwcHJvdmFsczsKCiAgLyoqCiAgKiBAZGV2IEd1YXJhbnRlZXMgbXNnLnNlbmRlciBpcyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4KICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byB2YWxpZGF0ZSBpdHMgb3duZXJzaGlwIGJlbG9uZ3MgdG8gbXNnLnNlbmRlcgogICovCiAgbW9kaWZpZXIgb25seU93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgewogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSA9PSBtc2cuc2VuZGVyKTsKICAgIF87CiAgfQoKICAvKioKICAqIEBkZXYgQ2hlY2tzIG1zZy5zZW5kZXIgY2FuIHRyYW5zZmVyIGEgdG9rZW4sIGJ5IGJlaW5nIG93bmVyLCBhcHByb3ZlZCwgb3Igb3BlcmF0b3IKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byB2YWxpZGF0ZQogICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIodWludDI1NiBfdG9rZW5JZCkgewogICAgcmVxdWlyZShpc0FwcHJvdmVkT3JPd25lcihtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgXzsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF9vd25lciBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSBiYWxhbmNlIG9mCiAgKiBAcmV0dXJuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwogICAgcmV0dXJuIG93bmVkVG9rZW5zQ291bnRbX293bmVyXTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBvd25lciBvZiB0aGUgc3BlY2lmaWVkIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIG93bmVyIG9mCiAgKiBAcmV0dXJuIG93bmVyIGFkZHJlc3MgY3VycmVudGx5IG1hcmtlZCBhcyB0aGUgb3duZXIgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKi8KICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIGFkZHJlc3Mgb3duZXIgPSB0b2tlbk93bmVyW190b2tlbklkXTsKICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICByZXR1cm4gb3duZXI7CiAgfQoKICAvKioKICAqIEBkZXYgUmV0dXJucyB3aGV0aGVyIHRoZSBzcGVjaWZpZWQgdG9rZW4gZXhpc3RzCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gcXVlcnkgdGhlIGV4aXN0YW5jZSBvZgogICogQHJldHVybiB3aGV0aGVyIHRoZSB0b2tlbiBleGlzdHMKICAqLwogIGZ1bmN0aW9uIGV4aXN0cyh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICBhZGRyZXNzIG93bmVyID0gdG9rZW5Pd25lcltfdG9rZW5JZF07CiAgICByZXR1cm4gb3duZXIgIT0gYWRkcmVzcygwKTsKICB9CgogIC8qKgogICogQGRldiBBcHByb3ZlcyBhbm90aGVyIGFkZHJlc3MgdG8gdHJhbnNmZXIgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAZGV2IFRoZSB6ZXJvIGFkZHJlc3MgaW5kaWNhdGVzIHRoZXJlIGlzIG5vIGFwcHJvdmVkIGFkZHJlc3MuCiAgKiBAZGV2IFRoZXJlIGNhbiBvbmx5IGJlIG9uZSBhcHByb3ZlZCBhZGRyZXNzIHBlciB0b2tlbiBhdCBhIGdpdmVuIHRpbWUuCiAgKiBAZGV2IENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgdG9rZW4gb3duZXIgb3IgYW4gYXBwcm92ZWQgb3BlcmF0b3IuCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdG8gYmUgYXBwcm92ZWQgZm9yIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIGFwcHJvdmVkCiAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgYWRkcmVzcyBvd25lciA9IG93bmVyT2YoX3Rva2VuSWQpOwogICAgcmVxdWlyZShfdG8gIT0gb3duZXIpOwogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyIHx8IGlzQXBwcm92ZWRGb3JBbGwob3duZXIsIG1zZy5zZW5kZXIpKTsKCiAgICBpZiAoZ2V0QXBwcm92ZWQoX3Rva2VuSWQpICE9IGFkZHJlc3MoMCkgfHwgX3RvICE9IGFkZHJlc3MoMCkpIHsKICAgICAgdG9rZW5BcHByb3ZhbHNbX3Rva2VuSWRdID0gX3RvOwogICAgICBlbWl0IEFwcHJvdmFsKG93bmVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgR2V0cyB0aGUgYXBwcm92ZWQgYWRkcmVzcyBmb3IgYSB0b2tlbiBJRCwgb3IgemVybyBpZiBubyBhZGRyZXNzIHNldAogICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBxdWVyeSB0aGUgYXBwcm92YWwgb2YKICAgKiBAcmV0dXJuIGFkZHJlc3MgY3VycmVudGx5IGFwcHJvdmVkIGZvciBhIHRoZSBnaXZlbiB0b2tlbiBJRAogICAqLwogIGZ1bmN0aW9uIGdldEFwcHJvdmVkKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiB0b2tlbkFwcHJvdmFsc1tfdG9rZW5JZF07CiAgfQoKICAvKioKICAqIEBkZXYgU2V0cyBvciB1bnNldHMgdGhlIGFwcHJvdmFsIG9mIGEgZ2l2ZW4gb3BlcmF0b3IKICAqIEBkZXYgQW4gb3BlcmF0b3IgaXMgYWxsb3dlZCB0byB0cmFuc2ZlciBhbGwgdG9rZW5zIG9mIHRoZSBzZW5kZXIgb24gdGhlaXIgYmVoYWxmCiAgKiBAcGFyYW0gX3RvIG9wZXJhdG9yIGFkZHJlc3MgdG8gc2V0IHRoZSBhcHByb3ZhbAogICogQHBhcmFtIF9hcHByb3ZlZCByZXByZXNlbnRpbmcgdGhlIHN0YXR1cyBvZiB0aGUgYXBwcm92YWwgdG8gYmUgc2V0CiAgKi8KICBmdW5jdGlvbiBzZXRBcHByb3ZhbEZvckFsbChhZGRyZXNzIF90bywgYm9vbCBfYXBwcm92ZWQpIHB1YmxpYyB7CiAgICByZXF1aXJlKF90byAhPSBtc2cuc2VuZGVyKTsKICAgIG9wZXJhdG9yQXBwcm92YWxzW21zZy5zZW5kZXJdW190b10gPSBfYXBwcm92ZWQ7CiAgICBlbWl0IEFwcHJvdmFsRm9yQWxsKG1zZy5zZW5kZXIsIF90bywgX2FwcHJvdmVkKTsKICB9CgogIC8qKgogICAqIEBkZXYgVGVsbHMgd2hldGhlciBhbiBvcGVyYXRvciBpcyBhcHByb3ZlZCBieSBhIGdpdmVuIG93bmVyCiAgICogQHBhcmFtIF9vd25lciBvd25lciBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHF1ZXJ5IHRoZSBhcHByb3ZhbCBvZgogICAqIEBwYXJhbSBfb3BlcmF0b3Igb3BlcmF0b3IgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBxdWVyeSB0aGUgYXBwcm92YWwgb2YKICAgKiBAcmV0dXJuIGJvb2wgd2hldGhlciB0aGUgZ2l2ZW4gb3BlcmF0b3IgaXMgYXBwcm92ZWQgYnkgdGhlIGdpdmVuIG93bmVyCiAgICovCiAgZnVuY3Rpb24gaXNBcHByb3ZlZEZvckFsbChhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfb3BlcmF0b3IpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBvcGVyYXRvckFwcHJvdmFsc1tfb3duZXJdW19vcGVyYXRvcl07CiAgfQoKICAvKioKICAqIEBkZXYgVHJhbnNmZXJzIHRoZSBvd25lcnNoaXAgb2YgYSBnaXZlbiB0b2tlbiBJRCB0byBhbm90aGVyIGFkZHJlc3MKICAqIEBkZXYgVXNhZ2Ugb2YgdGhpcyBtZXRob2QgaXMgZGlzY291cmFnZWQsIHVzZSBgc2FmZVRyYW5zZmVyRnJvbWAgd2hlbmV2ZXIgcG9zc2libGUKICAqIEBkZXYgUmVxdWlyZXMgdGhlIG1zZyBzZW5kZXIgdG8gYmUgdGhlIG93bmVyLCBhcHByb3ZlZCwgb3Igb3BlcmF0b3IKICAqIEBwYXJhbSBfZnJvbSBjdXJyZW50IG93bmVyIG9mIHRoZSB0b2tlbgogICogQHBhcmFtIF90byBhZGRyZXNzIHRvIHJlY2VpdmUgdGhlIG93bmVyc2hpcCBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgY2FuVHJhbnNmZXIoX3Rva2VuSWQpIHsKICAgIHJlcXVpcmUoX2Zyb20gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICBjbGVhckFwcHJvdmFsKF9mcm9tLCBfdG9rZW5JZCk7CiAgICByZW1vdmVUb2tlbkZyb20oX2Zyb20sIF90b2tlbklkKTsKICAgIGFkZFRva2VuVG8oX3RvLCBfdG9rZW5JZCk7CgogICAgZW1pdCBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgfQoKICAvKioKICAqIEBkZXYgU2FmZWx5IHRyYW5zZmVycyB0aGUgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gdG9rZW4gSUQgdG8gYW5vdGhlciBhZGRyZXNzCiAgKiBAZGV2IElmIHRoZSB0YXJnZXQgYWRkcmVzcyBpcyBhIGNvbnRyYWN0LCBpdCBtdXN0IGltcGxlbWVudCBgb25FUkM3MjFSZWNlaXZlZGAsCiAgKiAgd2hpY2ggaXMgY2FsbGVkIHVwb24gYSBzYWZlIHRyYW5zZmVyLCBhbmQgcmV0dXJuIHRoZSBtYWdpYyB2YWx1ZQogICogIGBieXRlczQoa2VjY2FrMjU2KCJvbkVSQzcyMVJlY2VpdmVkKGFkZHJlc3MsdWludDI1NixieXRlcykiKSlgOyBvdGhlcndpc2UsCiAgKiAgdGhlIHRyYW5zZmVyIGlzIHJldmVydGVkLgogICogQGRldiBSZXF1aXJlcyB0aGUgbXNnIHNlbmRlciB0byBiZSB0aGUgb3duZXIsIGFwcHJvdmVkLCBvciBvcGVyYXRvcgogICogQHBhcmFtIF9mcm9tIGN1cnJlbnQgb3duZXIgb2YgdGhlIHRva2VuCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdG8gcmVjZWl2ZSB0aGUgb3duZXJzaGlwIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgKi8KICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKAogICAgYWRkcmVzcyBfZnJvbSwKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdG9rZW5JZAogICkKICAgIHB1YmxpYwogICAgY2FuVHJhbnNmZXIoX3Rva2VuSWQpCiAgewogICAgc2FmZVRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdG9rZW5JZCwgIiIpOwogIH0KCiAgLyoqCiAgKiBAZGV2IFNhZmVseSB0cmFuc2ZlcnMgdGhlIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuIElEIHRvIGFub3RoZXIgYWRkcmVzcwogICogQGRldiBJZiB0aGUgdGFyZ2V0IGFkZHJlc3MgaXMgYSBjb250cmFjdCwgaXQgbXVzdCBpbXBsZW1lbnQgYG9uRVJDNzIxUmVjZWl2ZWRgLAogICogIHdoaWNoIGlzIGNhbGxlZCB1cG9uIGEgc2FmZSB0cmFuc2ZlciwgYW5kIHJldHVybiB0aGUgbWFnaWMgdmFsdWUKICAqICBgYnl0ZXM0KGtlY2NhazI1Nigib25FUkM3MjFSZWNlaXZlZChhZGRyZXNzLHVpbnQyNTYsYnl0ZXMpIikpYDsgb3RoZXJ3aXNlLAogICogIHRoZSB0cmFuc2ZlciBpcyByZXZlcnRlZC4KICAqIEBkZXYgUmVxdWlyZXMgdGhlIG1zZyBzZW5kZXIgdG8gYmUgdGhlIG93bmVyLCBhcHByb3ZlZCwgb3Igb3BlcmF0b3IKICAqIEBwYXJhbSBfZnJvbSBjdXJyZW50IG93bmVyIG9mIHRoZSB0b2tlbgogICogQHBhcmFtIF90byBhZGRyZXNzIHRvIHJlY2VpdmUgdGhlIG93bmVyc2hpcCBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICogQHBhcmFtIF9kYXRhIGJ5dGVzIGRhdGEgdG8gc2VuZCBhbG9uZyB3aXRoIGEgc2FmZSB0cmFuc2ZlciBjaGVjawogICovCiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbSgKICAgIGFkZHJlc3MgX2Zyb20sCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICBieXRlcyBfZGF0YQogICkKICAgIHB1YmxpYwogICAgY2FuVHJhbnNmZXIoX3Rva2VuSWQpCiAgewogICAgdHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIHJlcXVpcmUoY2hlY2tBbmRDYWxsU2FmZVRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkLCBfZGF0YSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBSZXR1cm5zIHdoZXRoZXIgdGhlIGdpdmVuIHNwZW5kZXIgY2FuIHRyYW5zZmVyIGEgZ2l2ZW4gdG9rZW4gSUQKICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBvZiB0aGUgc3BlbmRlciB0byBxdWVyeQogICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAqIEByZXR1cm4gYm9vbCB3aGV0aGVyIHRoZSBtc2cuc2VuZGVyIGlzIGFwcHJvdmVkIGZvciB0aGUgZ2l2ZW4gdG9rZW4gSUQsCiAgICogIGlzIGFuIG9wZXJhdG9yIG9mIHRoZSBvd25lciwgb3IgaXMgdGhlIG93bmVyIG9mIHRoZSB0b2tlbgogICAqLwogIGZ1bmN0aW9uIGlzQXBwcm92ZWRPck93bmVyKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgYWRkcmVzcyBvd25lciA9IG93bmVyT2YoX3Rva2VuSWQpOwogICAgcmV0dXJuIF9zcGVuZGVyID09IG93bmVyIHx8IGdldEFwcHJvdmVkKF90b2tlbklkKSA9PSBfc3BlbmRlciB8fCBpc0FwcHJvdmVkRm9yQWxsKG93bmVyLCBfc3BlbmRlcik7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gbWludCBhIG5ldyB0b2tlbgogICogQGRldiBSZXZlcnRzIGlmIHRoZSBnaXZlbiB0b2tlbiBJRCBhbHJlYWR5IGV4aXN0cwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgb3duIHRoZSBtaW50ZWQgdG9rZW4KICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSBtaW50ZWQgYnkgdGhlIG1zZy5zZW5kZXIKICAqLwogIGZ1bmN0aW9uIF9taW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIGFkZFRva2VuVG8oX3RvLCBfdG9rZW5JZCk7CiAgICBlbWl0IFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGJ1cm4gYSBzcGVjaWZpYyB0b2tlbgogICogQGRldiBSZXZlcnRzIGlmIHRoZSB0b2tlbiBkb2VzIG5vdCBleGlzdAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIGJlaW5nIGJ1cm5lZCBieSB0aGUgbXNnLnNlbmRlcgogICovCiAgZnVuY3Rpb24gX2J1cm4oYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgIGNsZWFyQXBwcm92YWwoX293bmVyLCBfdG9rZW5JZCk7CiAgICByZW1vdmVUb2tlbkZyb20oX293bmVyLCBfdG9rZW5JZCk7CiAgICBlbWl0IFRyYW5zZmVyKF9vd25lciwgYWRkcmVzcygwKSwgX3Rva2VuSWQpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGNsZWFyIGN1cnJlbnQgYXBwcm92YWwgb2YgYSBnaXZlbiB0b2tlbiBJRAogICogQGRldiBSZXZlcnRzIGlmIHRoZSBnaXZlbiBhZGRyZXNzIGlzIG5vdCBpbmRlZWQgdGhlIG93bmVyIG9mIHRoZSB0b2tlbgogICogQHBhcmFtIF9vd25lciBvd25lciBvZiB0aGUgdG9rZW4KICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICovCiAgZnVuY3Rpb24gY2xlYXJBcHByb3ZhbChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgcmVxdWlyZShvd25lck9mKF90b2tlbklkKSA9PSBfb3duZXIpOwogICAgaWYgKHRva2VuQXBwcm92YWxzW190b2tlbklkXSAhPSBhZGRyZXNzKDApKSB7CiAgICAgIHRva2VuQXBwcm92YWxzW190b2tlbklkXSA9IGFkZHJlc3MoMCk7CiAgICAgIGVtaXQgQXBwcm92YWwoX293bmVyLCBhZGRyZXNzKDApLCBfdG9rZW5JZCk7CiAgICB9CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gYWRkIGEgdG9rZW4gSUQgdG8gdGhlIGxpc3Qgb2YgYSBnaXZlbiBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgcmVwcmVzZW50aW5nIHRoZSBuZXcgb3duZXIgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgYWRkZWQgdG8gdGhlIHRva2VucyBsaXN0IG9mIHRoZSBnaXZlbiBhZGRyZXNzCiAgKi8KICBmdW5jdGlvbiBhZGRUb2tlblRvKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKHRva2VuT3duZXJbX3Rva2VuSWRdID09IGFkZHJlc3MoMCkpOwogICAgdG9rZW5Pd25lcltfdG9rZW5JZF0gPSBfdG87CiAgICBvd25lZFRva2Vuc0NvdW50W190b10gPSBvd25lZFRva2Vuc0NvdW50W190b10uYWRkKDEpOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIHJlbW92ZSBhIHRva2VuIElEIGZyb20gdGhlIGxpc3Qgb2YgYSBnaXZlbiBhZGRyZXNzCiAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyByZXByZXNlbnRpbmcgdGhlIHByZXZpb3VzIG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgdG9rZW5zIGxpc3Qgb2YgdGhlIGdpdmVuIGFkZHJlc3MKICAqLwogIGZ1bmN0aW9uIHJlbW92ZVRva2VuRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IF9mcm9tKTsKICAgIG93bmVkVG9rZW5zQ291bnRbX2Zyb21dID0gb3duZWRUb2tlbnNDb3VudFtfZnJvbV0uc3ViKDEpOwogICAgdG9rZW5Pd25lcltfdG9rZW5JZF0gPSBhZGRyZXNzKDApOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGludm9rZSBgb25FUkM3MjFSZWNlaXZlZGAgb24gYSB0YXJnZXQgYWRkcmVzcwogICogQGRldiBUaGUgY2FsbCBpcyBub3QgZXhlY3V0ZWQgaWYgdGhlIHRhcmdldCBhZGRyZXNzIGlzIG5vdCBhIGNvbnRyYWN0CiAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyByZXByZXNlbnRpbmcgdGhlIHByZXZpb3VzIG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAogICogQHBhcmFtIF90byB0YXJnZXQgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgdG9rZW5zCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAqIEBwYXJhbSBfZGF0YSBieXRlcyBvcHRpb25hbCBkYXRhIHRvIHNlbmQgYWxvbmcgd2l0aCB0aGUgY2FsbAogICogQHJldHVybiB3aGV0aGVyIHRoZSBjYWxsIGNvcnJlY3RseSByZXR1cm5lZCB0aGUgZXhwZWN0ZWQgbWFnaWMgdmFsdWUKICAqLwogIGZ1bmN0aW9uIGNoZWNrQW5kQ2FsbFNhZmVUcmFuc2ZlcigKICAgIGFkZHJlc3MgX2Zyb20sCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICBieXRlcyBfZGF0YQogICkKICAgIGludGVybmFsCiAgICByZXR1cm5zIChib29sKQogIHsKICAgIGlmICghX3RvLmlzQ29udHJhY3QoKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGJ5dGVzNCByZXR2YWwgPSBFUkM3MjFSZWNlaXZlcihfdG8pLm9uRVJDNzIxUmVjZWl2ZWQoX2Zyb20sIF90b2tlbklkLCBfZGF0YSk7CiAgICByZXR1cm4gKHJldHZhbCA9PSBFUkM3MjFfUkVDRUlWRUQpOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDNzIxIHRva2VuIHJlY2VpdmVyIGludGVyZmFjZQogKiBAZGV2IEludGVyZmFjZSBmb3IgYW55IGNvbnRyYWN0IHRoYXQgd2FudHMgdG8gc3VwcG9ydCBzYWZlVHJhbnNmZXJzCiAqICBmcm9tIEVSQzcyMSBhc3NldCBjb250cmFjdHMuCiAqLwpjb250cmFjdCBFUkM3MjFSZWNlaXZlciB7CiAgLyoqCiAgICogQGRldiBNYWdpYyB2YWx1ZSB0byBiZSByZXR1cm5lZCB1cG9uIHN1Y2Nlc3NmdWwgcmVjZXB0aW9uIG9mIGFuIE5GVAogICAqICBFcXVhbHMgdG8gYGJ5dGVzNChrZWNjYWsyNTYoIm9uRVJDNzIxUmVjZWl2ZWQoYWRkcmVzcyx1aW50MjU2LGJ5dGVzKSIpKWAsCiAgICogIHdoaWNoIGNhbiBiZSBhbHNvIG9idGFpbmVkIGFzIGBFUkM3MjFSZWNlaXZlcigwKS5vbkVSQzcyMVJlY2VpdmVkLnNlbGVjdG9yYAogICAqLwogIGJ5dGVzNCBjb25zdGFudCBFUkM3MjFfUkVDRUlWRUQgPSAweGYwYjllNWJhOwoKICAvKioKICAgKiBAbm90aWNlIEhhbmRsZSB0aGUgcmVjZWlwdCBvZiBhbiBORlQKICAgKiBAZGV2IFRoZSBFUkM3MjEgc21hcnQgY29udHJhY3QgY2FsbHMgdGhpcyBmdW5jdGlvbiBvbiB0aGUgcmVjaXBpZW50CiAgICogIGFmdGVyIGEgYHNhZmV0cmFuc2ZlcmAuIFRoaXMgZnVuY3Rpb24gTUFZIHRocm93IHRvIHJldmVydCBhbmQgcmVqZWN0IHRoZQogICAqICB0cmFuc2Zlci4gVGhpcyBmdW5jdGlvbiBNVVNUIHVzZSA1MCwwMDAgZ2FzIG9yIGxlc3MuIFJldHVybiBvZiBvdGhlcgogICAqICB0aGFuIHRoZSBtYWdpYyB2YWx1ZSBNVVNUIHJlc3VsdCBpbiB0aGUgdHJhbnNhY3Rpb24gYmVpbmcgcmV2ZXJ0ZWQuCiAgICogIE5vdGU6IHRoZSBjb250cmFjdCBhZGRyZXNzIGlzIGFsd2F5cyB0aGUgbWVzc2FnZSBzZW5kZXIuCiAgICogQHBhcmFtIF9mcm9tIFRoZSBzZW5kaW5nIGFkZHJlc3MKICAgKiBAcGFyYW0gX3Rva2VuSWQgVGhlIE5GVCBpZGVudGlmaWVyIHdoaWNoIGlzIGJlaW5nIHRyYW5zZmVyZWQKICAgKiBAcGFyYW0gX2RhdGEgQWRkaXRpb25hbCBkYXRhIHdpdGggbm8gc3BlY2lmaWVkIGZvcm1hdAogICAqIEByZXR1cm4gYGJ5dGVzNChrZWNjYWsyNTYoIm9uRVJDNzIxUmVjZWl2ZWQoYWRkcmVzcyx1aW50MjU2LGJ5dGVzKSIpKWAKICAgKi8KICBmdW5jdGlvbiBvbkVSQzcyMVJlY2VpdmVkKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3Rva2VuSWQsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcmV0dXJucyhieXRlczQpOwp9CgoKCi8qKgogKiBAdGl0bGUgRnVsbCBFUkM3MjEgVG9rZW4KICogVGhpcyBpbXBsZW1lbnRhdGlvbiBpbmNsdWRlcyBhbGwgdGhlIHJlcXVpcmVkIGFuZCBzb21lIG9wdGlvbmFsIGZ1bmN0aW9uYWxpdHkgb2YgdGhlIEVSQzcyMSBzdGFuZGFyZAogKiBNb3Jlb3ZlciwgaXQgaW5jbHVkZXMgYXBwcm92ZSBhbGwgZnVuY3Rpb25hbGl0eSB1c2luZyBvcGVyYXRvciB0ZXJtaW5vbG9neQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC03MjEubWQKICovCmNvbnRyYWN0IEVSQzcyMVRva2VuIGlzIEVSQzcyMSwgRVJDNzIxQmFzaWNUb2tlbiwgRVJDMTY1IHsKICAvLyBNYXBwaW5nIGZyb20gb3duZXIgdG8gbGlzdCBvZiBvd25lZCB0b2tlbiBJRHMKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTZbXSkgaW50ZXJuYWwgb3duZWRUb2tlbnM7CgogIC8vIE1hcHBpbmcgZnJvbSB0b2tlbiBJRCB0byBpbmRleCBvZiB0aGUgb3duZXIgdG9rZW5zIGxpc3QKICBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikgaW50ZXJuYWwgb3duZWRUb2tlbnNJbmRleDsKCiAgLy8gQXJyYXkgd2l0aCBhbGwgdG9rZW4gaWRzLCB1c2VkIGZvciBlbnVtZXJhdGlvbgogIHVpbnQyNTZbXSBpbnRlcm5hbCBhbGxUb2tlbnM7CgogIC8vIE1hcHBpbmcgZnJvbSB0b2tlbiBpZCB0byBwb3NpdGlvbiBpbiB0aGUgYWxsVG9rZW5zIGFycmF5CiAgbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIGludGVybmFsIGFsbFRva2Vuc0luZGV4OwoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgdG9rZW4gSUQgYXQgYSBnaXZlbiBpbmRleCBvZiB0aGUgdG9rZW5zIGxpc3Qgb2YgdGhlIHJlcXVlc3RlZCBvd25lcgogICogQHBhcmFtIF9vd25lciBhZGRyZXNzIG93bmluZyB0aGUgdG9rZW5zIGxpc3QgdG8gYmUgYWNjZXNzZWQKICAqIEBwYXJhbSBfaW5kZXggdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGluZGV4IHRvIGJlIGFjY2Vzc2VkIG9mIHRoZSByZXF1ZXN0ZWQgdG9rZW5zIGxpc3QKICAqIEByZXR1cm4gdWludDI1NiB0b2tlbiBJRCBhdCB0aGUgZ2l2ZW4gaW5kZXggb2YgdGhlIHRva2VucyBsaXN0IG93bmVkIGJ5IHRoZSByZXF1ZXN0ZWQgYWRkcmVzcwogICovCiAgZnVuY3Rpb24gdG9rZW5PZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJlcXVpcmUoX2luZGV4IDwgYmFsYW5jZU9mKF9vd25lcikpOwogICAgcmV0dXJuIG93bmVkVG9rZW5zW19vd25lcl1bX2luZGV4XTsKICB9CiAgCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGxpc3Qgb2YgdG9rZW5zIG93bmVkIGJ5IGEgcmVxdWVzdGVkIGFkZHJlc3MKICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyB0byBxdWVyeSB0aGUgdG9rZW5zIG9mCiAgKiBAcmV0dXJuIHVpbnQyNTZbXSByZXByZXNlbnRpbmcgdGhlIGxpc3Qgb2YgdG9rZW5zIG93bmVkIGJ5IHRoZSByZXF1ZXN0ZWQgYWRkcmVzcwogICovCiAgZnVuY3Rpb24gdG9rZW5zT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSkgewogICAgcmV0dXJuIG93bmVkVG9rZW5zW19vd25lcl07CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBzdG9yZWQgYnkgdGhlIGNvbnRyYWN0CiAgKiBAcmV0dXJuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zCiAgKi8KICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhbGxUb2tlbnMubGVuZ3RoOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIHRva2VuIElEIGF0IGEgZ2l2ZW4gaW5kZXggb2YgYWxsIHRoZSB0b2tlbnMgaW4gdGhpcyBjb250cmFjdAogICogQGRldiBSZXZlcnRzIGlmIHRoZSBpbmRleCBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgKiBAcGFyYW0gX2luZGV4IHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBpbmRleCB0byBiZSBhY2Nlc3NlZCBvZiB0aGUgdG9rZW5zIGxpc3QKICAqIEByZXR1cm4gdWludDI1NiB0b2tlbiBJRCBhdCB0aGUgZ2l2ZW4gaW5kZXggb2YgdGhlIHRva2VucyBsaXN0CiAgKi8KICBmdW5jdGlvbiB0b2tlbkJ5SW5kZXgodWludDI1NiBfaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJlcXVpcmUoX2luZGV4IDwgdG90YWxTdXBwbHkoKSk7CiAgICByZXR1cm4gYWxsVG9rZW5zW19pbmRleF07CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gYWRkIGEgdG9rZW4gSUQgdG8gdGhlIGxpc3Qgb2YgYSBnaXZlbiBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgcmVwcmVzZW50aW5nIHRoZSBuZXcgb3duZXIgb2YgdGhlIGdpdmVuIHRva2VuIElECiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgYWRkZWQgdG8gdGhlIHRva2VucyBsaXN0IG9mIHRoZSBnaXZlbiBhZGRyZXNzCiAgKi8KICBmdW5jdGlvbiBhZGRUb2tlblRvKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICBzdXBlci5hZGRUb2tlblRvKF90bywgX3Rva2VuSWQpOwogICAgdWludDI1NiBsZW5ndGggPSBvd25lZFRva2Vuc1tfdG9dLmxlbmd0aDsKICAgIG93bmVkVG9rZW5zW190b10ucHVzaChfdG9rZW5JZCk7CiAgICBvd25lZFRva2Vuc0luZGV4W190b2tlbklkXSA9IGxlbmd0aDsKICB9CgogIC8qKgogICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byByZW1vdmUgYSB0b2tlbiBJRCBmcm9tIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwogICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgcmVwcmVzZW50aW5nIHRoZSBwcmV2aW91cyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKICAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSByZW1vdmVkIGZyb20gdGhlIHRva2VucyBsaXN0IG9mIHRoZSBnaXZlbiBhZGRyZXNzCiAgKi8KICBmdW5jdGlvbiByZW1vdmVUb2tlbkZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgc3VwZXIucmVtb3ZlVG9rZW5Gcm9tKF9mcm9tLCBfdG9rZW5JZCk7CgogICAgdWludDI1NiB0b2tlbkluZGV4ID0gb3duZWRUb2tlbnNJbmRleFtfdG9rZW5JZF07CiAgICB1aW50MjU2IGxhc3RUb2tlbkluZGV4ID0gb3duZWRUb2tlbnNbX2Zyb21dLmxlbmd0aC5zdWIoMSk7CiAgICB1aW50MjU2IGxhc3RUb2tlbiA9IG93bmVkVG9rZW5zW19mcm9tXVtsYXN0VG9rZW5JbmRleF07CgogICAgb3duZWRUb2tlbnNbX2Zyb21dW3Rva2VuSW5kZXhdID0gbGFzdFRva2VuOwogICAgb3duZWRUb2tlbnNbX2Zyb21dW2xhc3RUb2tlbkluZGV4XSA9IDA7CiAgICAvLyBOb3RlIHRoYXQgdGhpcyB3aWxsIGhhbmRsZSBzaW5nbGUtZWxlbWVudCBhcnJheXMuIEluIHRoYXQgY2FzZSwgYm90aCB0b2tlbkluZGV4IGFuZCBsYXN0VG9rZW5JbmRleCBhcmUgZ29pbmcgdG8KICAgIC8vIGJlIHplcm8uIFRoZW4gd2UgY2FuIG1ha2Ugc3VyZSB0aGF0IHdlIHdpbGwgcmVtb3ZlIF90b2tlbklkIGZyb20gdGhlIG93bmVkVG9rZW5zIGxpc3Qgc2luY2Ugd2UgYXJlIGZpcnN0IHN3YXBwaW5nCiAgICAvLyB0aGUgbGFzdFRva2VuIHRvIHRoZSBmaXJzdCBwb3NpdGlvbiwgYW5kIHRoZW4gZHJvcHBpbmcgdGhlIGVsZW1lbnQgcGxhY2VkIGluIHRoZSBsYXN0IHBvc2l0aW9uIG9mIHRoZSBsaXN0CgogICAgb3duZWRUb2tlbnNbX2Zyb21dLmxlbmd0aC0tOwogICAgb3duZWRUb2tlbnNJbmRleFtfdG9rZW5JZF0gPSAwOwogICAgb3duZWRUb2tlbnNJbmRleFtsYXN0VG9rZW5dID0gdG9rZW5JbmRleDsKICB9CgogIC8qKgogICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBtaW50IGEgbmV3IHRva2VuCiAgKiBAZGV2IFJldmVydHMgaWYgdGhlIGdpdmVuIHRva2VuIElEIGFscmVhZHkgZXhpc3RzCiAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdGhlIGJlbmVmaWNpYXJ5IHRoYXQgd2lsbCBvd24gdGhlIG1pbnRlZCB0b2tlbgogICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIG1pbnRlZCBieSB0aGUgbXNnLnNlbmRlcgogICovCiAgZnVuY3Rpb24gX21pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgIHN1cGVyLl9taW50KF90bywgX3Rva2VuSWQpOwoKICAgIGFsbFRva2Vuc0luZGV4W190b2tlbklkXSA9IGFsbFRva2Vucy5sZW5ndGg7CiAgICBhbGxUb2tlbnMucHVzaChfdG9rZW5JZCk7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gYnVybiBhIHNwZWNpZmljIHRva2VuCiAgKiBAZGV2IFJldmVydHMgaWYgdGhlIHRva2VuIGRvZXMgbm90IGV4aXN0CiAgKiBAcGFyYW0gX293bmVyIG93bmVyIG9mIHRoZSB0b2tlbiB0byBidXJuCiAgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gYmVpbmcgYnVybmVkIGJ5IHRoZSBtc2cuc2VuZGVyCiAgKi8KICBmdW5jdGlvbiBfYnVybihhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgc3VwZXIuX2J1cm4oX293bmVyLCBfdG9rZW5JZCk7CgogICAgLy8gUmVvcmcgYWxsIHRva2VucyBhcnJheQogICAgdWludDI1NiB0b2tlbkluZGV4ID0gYWxsVG9rZW5zSW5kZXhbX3Rva2VuSWRdOwogICAgdWludDI1NiBsYXN0VG9rZW5JbmRleCA9IGFsbFRva2Vucy5sZW5ndGguc3ViKDEpOwogICAgdWludDI1NiBsYXN0VG9rZW4gPSBhbGxUb2tlbnNbbGFzdFRva2VuSW5kZXhdOwoKICAgIGFsbFRva2Vuc1t0b2tlbkluZGV4XSA9IGxhc3RUb2tlbjsKICAgIGFsbFRva2Vuc1tsYXN0VG9rZW5JbmRleF0gPSAwOwoKICAgIGFsbFRva2Vucy5sZW5ndGgtLTsKICAgIGFsbFRva2Vuc0luZGV4W190b2tlbklkXSA9IDA7CiAgICBhbGxUb2tlbnNJbmRleFtsYXN0VG9rZW5dID0gdG9rZW5JbmRleDsKICB9CgogIC8qKgogICogQGRldiBRdWVyeSBpZiBhIGNvbnRyYWN0IGltcGxlbWVudHMgYW4gaW50ZXJmYWNlCiAgKiBAcGFyYW0gX2ludGVyZmFjZUlEIGludGVyZmFjZUlEIGJlaW5nIGNoZWNrZWQKICAqIEByZXR1cm4gYm9vbCBpZiB0aGUgY3VycmVudCBjb250cmFjdCBzdXBwb3J0cyB0aGUgcXVlcmllZCBpbnRlcmZhY2UKICAqLwogIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIF9pbnRlcmZhY2VJRCA9PSAweDAxZmZjOWE3IHx8IC8vIEVSQzE2NQogICAgICAgICAgIF9pbnRlcmZhY2VJRCA9PSAweDgwYWM1OGNkIHx8IC8vIEVSQzcyMQogICAgICAgICAgIF9pbnRlcmZhY2VJRCA9PSAweDc4MGU5ZDYzOyAvLyBFUkM3MjFFbnVtZXJhYmxlCiAgfQp9CgoKCgovKioKICogVXRpbGl0eSBsaWJyYXJ5IG9mIGlubGluZSBmdW5jdGlvbnMgb24gYWRkcmVzc2VzCiAqLwpsaWJyYXJ5IEFkZHJlc3NVdGlscyB7CgogIC8qKgogICAqIFJldHVybnMgd2hldGhlciB0aGUgdGFyZ2V0IGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAqIEBkZXYgVGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiBmYWxzZSBpZiBpbnZva2VkIGR1cmluZyB0aGUgY29uc3RydWN0b3Igb2YgYSBjb250cmFjdCwKICAgKiAgYXMgdGhlIGNvZGUgaXMgbm90IGFjdHVhbGx5IGNyZWF0ZWQgdW50aWwgYWZ0ZXIgdGhlIGNvbnN0cnVjdG9yIGZpbmlzaGVzLgogICAqIEBwYXJhbSBhZGRyIGFkZHJlc3MgdG8gY2hlY2sKICAgKiBAcmV0dXJuIHdoZXRoZXIgdGhlIHRhcmdldCBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgKi8KICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgYWRkcikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IHNpemU7CiAgICAvLyBYWFggQ3VycmVudGx5IHRoZXJlIGlzIG5vIGJldHRlciB3YXkgdG8gY2hlY2sgaWYgdGhlcmUgaXMgYSBjb250cmFjdCBpbiBhbiBhZGRyZXNzCiAgICAvLyB0aGFuIHRvIGNoZWNrIHRoZSBzaXplIG9mIHRoZSBjb2RlIGF0IHRoYXQgYWRkcmVzcy4KICAgIC8vIFNlZSBodHRwczovL2V0aGVyZXVtLnN0YWNrZXhjaGFuZ2UuY29tL2EvMTQwMTYvMzY2MDMKICAgIC8vIGZvciBtb3JlIGRldGFpbHMgYWJvdXQgaG93IHRoaXMgd29ya3MuCiAgICAvLyBUT0RPIENoZWNrIHRoaXMgYWdhaW4gYmVmb3JlIHRoZSBTZXJlbml0eSByZWxlYXNlLCBiZWNhdXNlIGFsbCBhZGRyZXNzZXMgd2lsbCBiZQogICAgLy8gY29udHJhY3RzIHRoZW4uCiAgICBhc3NlbWJseSB7IHNpemUgOj0gZXh0Y29kZXNpemUoYWRkcikgfSAgLy8gc29saXVtLWRpc2FibGUtbGluZSBzZWN1cml0eS9uby1pbmxpbmUtYXNzZW1ibHkKICAgIHJldHVybiBzaXplID4gMDsKICB9Cgp9CgoKY29udHJhY3QgQmFzZSBpcyBFUkM3MjFUb2tlbiwgT3duYWJsZSB7CgogIGV2ZW50IE5ld0NSTFRva2VuKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludDI1NiBpbmRleGVkIHRva2VuSWQsIHVpbnQyNTYgdHJhaXRzKTsKICBldmVudCBVcGRhdGVkQ1JMVG9rZW4odWludDI1NiBpbmRleGVkIFVVSUQsIHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkLCB1aW50MjU2IHRyYWl0cyk7CgogIHVpbnQyNTYgVE9LRU5fVVVJRDsKICB1aW50MjU2IFVQR1JBREVfVVVJRDsKCiAgZnVuY3Rpb24gX2NyZWF0ZVRva2VuKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90cmFpdHMpIGludGVybmFsIHsKICAgIC8vIGVtaXQgdGhlIGNyZWF0b24gZXZlbnQKICAgIGVtaXQgTmV3Q1JMVG9rZW4oCiAgICAgIF9vd25lciwKICAgICAgVE9LRU5fVVVJRCwKICAgICAgX3RyYWl0cwogICAgKTsKCiAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcCwgYW5kIGFsc28gZW1pdCB0aGUgVHJhbnNmZXIgZXZlbnQKICAgIF9taW50KF9vd25lciwgVE9LRU5fVVVJRCk7CgogICAgVE9LRU5fVVVJRCsrOwogIH0KCiAgZnVuY3Rpb24gX3VwZGF0ZVRva2VuKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX3RyYWl0cykgaW50ZXJuYWwgewogICAgLy8gZW1pdCB0aGUgdXBncmFkZSBldmVudAogICAgZW1pdCBVcGRhdGVkQ1JMVG9rZW4oCiAgICAgIFVQR1JBREVfVVVJRCwKICAgICAgX3Rva2VuSWQsCiAgICAgIF90cmFpdHMKICAgICk7CgogICAgVVBHUkFERV9VVUlEKys7CiAgfQoKICAvLyBFdGggYmFsYW5jZSBjb250cm9scwoKICAvLyBXZSBjYW4gd2l0aGRyYXcgZXRoIGJhbGFuY2Ugb2YgY29udHJhY3QuCiAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgb25seU93bmVyIGV4dGVybmFsIHsKICAgIHJlcXVpcmUoYWRkcmVzcyh0aGlzKS5iYWxhbmNlID4gMCk7CgogICAgbXNnLnNlbmRlci50cmFuc2ZlcihhZGRyZXNzKHRoaXMpLmJhbGFuY2UpOwogIH0KfQoKCgpjb250cmFjdCBMb290Ym94U3RvcmUgaXMgQmFzZSB7CiAgLy8gbWFwcGluZyBiZXR3ZWVuIHNwZWNpZmljIExvb3Rib3ggY29udHJhY3QgYWRkcmVzcyB0byBwcmljZSBpbiB3ZWkKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgZXRoUHJpY2VkTG9vdGJveGVzOwoKICAvLyBtYXBwaW5nIGJldHdlZW4gc3BlY2lmaWMgTG9vdGJveCBjb250cmFjdCBhZGRyZXNzIHRvIHByaWNlIGluIE5PUyB0b2tlbnMKICBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDI1NikgTk9TUGFja2FnZXM7CgogIHVpbnQyNTYgVVVJRDsKCiAgZXZlbnQgTk9TUHVyY2hhc2VkKHVpbnQyNTYgaW5kZXhlZCBVVUlELCBhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQyNTYgaW5kZXhlZCBOT1NBbXRQdXJjaGFzZWQpOwoKICBmdW5jdGlvbiBhZGRMb290Ym94KGFkZHJlc3MgX2xvb3Rib3hBZGRyZXNzLCB1aW50MjU2IF9wcmljZSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGV0aFByaWNlZExvb3Rib3hlc1tfbG9vdGJveEFkZHJlc3NdID0gX3ByaWNlOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlTG9vdGJveChhZGRyZXNzIF9sb290Ym94QWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGRlbGV0ZSBldGhQcmljZWRMb290Ym94ZXNbX2xvb3Rib3hBZGRyZXNzXTsKICB9CgogIGZ1bmN0aW9uIGJ1eUV0aExvb3Rib3goYWRkcmVzcyBfbG9vdGJveEFkZHJlc3MpIHBheWFibGUgZXh0ZXJuYWwgewogICAgLy8gVmVyaWZ5IHRoZSBnaXZlbiBsb290Ym94IGNvbnRyYWN0IGV4aXN0cyBhbmQgdGhleSd2ZSBwYWlkIGVub3VnaAogICAgcmVxdWlyZShldGhQcmljZWRMb290Ym94ZXNbX2xvb3Rib3hBZGRyZXNzXSAhPSAwKTsKICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGV0aFByaWNlZExvb3Rib3hlc1tfbG9vdGJveEFkZHJlc3NdKTsKCiAgICBMb290Ym94SW50ZXJmYWNlKF9sb290Ym94QWRkcmVzcykuYnV5KG1zZy5zZW5kZXIpOwogIH0KCiAgZnVuY3Rpb24gYWRkTk9TUGFja2FnZSh1aW50MjU2IF9OT1NBbXQsIHVpbnQyNTYgX2V0aFByaWNlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgTk9TUGFja2FnZXNbX05PU0FtdF0gPSBfZXRoUHJpY2U7CiAgfQogIAogIGZ1bmN0aW9uIHJlbW92ZU5PU1BhY2thZ2UodWludDI1NiBfTk9TQW10KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgZGVsZXRlIE5PU1BhY2thZ2VzW19OT1NBbXRdOwogIH0KCiAgZnVuY3Rpb24gYnV5Tk9TKHVpbnQyNTYgX05PU0FtdCkgcGF5YWJsZSBleHRlcm5hbCB7CiAgICByZXF1aXJlKE5PU1BhY2thZ2VzW19OT1NBbXRdICE9IDApOwogICAgcmVxdWlyZShtc2cudmFsdWUgPj0gTk9TUGFja2FnZXNbX05PU0FtdF0pOwogICAgCiAgICBlbWl0IE5PU1B1cmNoYXNlZChVVUlELCBtc2cuc2VuZGVyLCBfTk9TQW10KTsKICAgIFVVSUQrKzsKICB9Cn0KCmNvbnRyYWN0IENvcmUgaXMgTG9vdGJveFN0b3JlLCBFeHRlcm5hbEludGVyZmFjZSB7CiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGF1dGhvcml6ZWRFeHRlcm5hbDsKCiAgZnVuY3Rpb24gYWRkQXV0aG9yaXplZEV4dGVybmFsKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBhdXRob3JpemVkRXh0ZXJuYWxbX2FkZHJlc3NdID0gMTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZUF1dGhvcml6ZWRFeHRlcm5hbChhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgZGVsZXRlIGF1dGhvcml6ZWRFeHRlcm5hbFtfYWRkcmVzc107CiAgfQoKICAvLyBWZXJpZnkgdGhlIGNhbGxlciBvZiB0aGlzIGZ1bmN0aW9uIGlzIGEgTG9vdGJveCBjb250cmFjdCBvciByYWNlLCBvciBjcmFmdGluZywgb3IgdXBncmFkZQogIG1vZGlmaWVyIG9ubHlBdXRob3JpemVkKCkgeyAKICAgIHJlcXVpcmUoZXRoUHJpY2VkTG9vdGJveGVzW21zZy5zZW5kZXJdICE9IDAgfHwKICAgICAgICAgICAgYXV0aG9yaXplZEV4dGVybmFsW21zZy5zZW5kZXJdICE9IDApOwogICAgICBfOyAKICB9CgogIGZ1bmN0aW9uIGdpdmVJdGVtKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NiBfdHJhaXRzKSBvbmx5QXV0aG9yaXplZCBleHRlcm5hbCB7CiAgICBfY3JlYXRlVG9rZW4oX3JlY2lwaWVudCwgX3RyYWl0cyk7CiAgfQoKICBmdW5jdGlvbiBnaXZlTXVsdGlwbGVJdGVtcyhhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQyNTZbXSBfdHJhaXRzKSBvbmx5QXV0aG9yaXplZCBleHRlcm5hbCB7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfdHJhaXRzLmxlbmd0aDsgKytpKSB7CiAgICAgIF9jcmVhdGVUb2tlbihfcmVjaXBpZW50LCBfdHJhaXRzW2ldKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdpdmVNdWx0aXBsZUl0ZW1zVG9NdWx0aXBsZVJlY2lwaWVudHMoYWRkcmVzc1tdIF9yZWNpcGllbnRzLCB1aW50MjU2W10gX3RyYWl0cykgb25seUF1dGhvcml6ZWQgZXh0ZXJuYWwgewogICAgcmVxdWlyZShfcmVjaXBpZW50cy5sZW5ndGggPT0gX3RyYWl0cy5sZW5ndGgpOwoKICAgIGZvciAodWludCBpID0gMDsgaSA8IF90cmFpdHMubGVuZ3RoOyArK2kpIHsKICAgICAgX2NyZWF0ZVRva2VuKF9yZWNpcGllbnRzW2ldLCBfdHJhaXRzW2ldKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdpdmVNdWx0aXBsZUl0ZW1zQW5kRGVzdHJveU11bHRpcGxlSXRlbXMoYWRkcmVzcyBfcmVjaXBpZW50LCB1aW50MjU2W10gX3RyYWl0cywgdWludDI1NltdIF90b2tlbklkcykgb25seUF1dGhvcml6ZWQgZXh0ZXJuYWwgewogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3RyYWl0cy5sZW5ndGg7ICsraSkgewogICAgICBfY3JlYXRlVG9rZW4oX3JlY2lwaWVudCwgX3RyYWl0c1tpXSk7CiAgICB9CgogICAgZm9yIChpID0gMDsgaSA8IF90b2tlbklkcy5sZW5ndGg7ICsraSkgewogICAgICBfYnVybihvd25lck9mKF90b2tlbklkc1tpXSksIF90b2tlbklkc1tpXSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkZXN0cm95SXRlbSh1aW50MjU2IF90b2tlbklkKSBvbmx5QXV0aG9yaXplZCBleHRlcm5hbCB7CiAgICBfYnVybihvd25lck9mKF90b2tlbklkKSwgX3Rva2VuSWQpOwogIH0KCiAgZnVuY3Rpb24gZGVzdHJveU11bHRpcGxlSXRlbXModWludDI1NltdIF90b2tlbklkcykgb25seUF1dGhvcml6ZWQgZXh0ZXJuYWwgewogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3Rva2VuSWRzLmxlbmd0aDsgKytpKSB7CiAgICAgIF9idXJuKG93bmVyT2YoX3Rva2VuSWRzW2ldKSwgX3Rva2VuSWRzW2ldKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUl0ZW1UcmFpdHModWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfdHJhaXRzKSBvbmx5QXV0aG9yaXplZCBleHRlcm5hbCB7CiAgICBfdXBkYXRlVG9rZW4oX3Rva2VuSWQsIF90cmFpdHMpOwogIH0KfQ=='.
	

]
