Class {
	#name : #SRTcf7166e9a81fdd7e12f1f2ecd5da8590ad28185a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcf7166e9a81fdd7e12f1f2ecd5da8590ad28185a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLy8gbWF0aC5zb2wgLS0gbWl4aW4gZm9yIGlubGluZSBudW1lcmljYWwgd2l6YXJkcnkKCi8vIENvcHlyaWdodCAoQykgMjAxNSwgMjAxNiwgMjAxNyAgRGFwcEh1YiwgTExDCgovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKS4KLy8gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoKLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCAoZXhwcmVzcyBvciBpbXBsaWVkKS4KCnByYWdtYSBzb2xpZGl0eSBeMC40LjEwOwoKY29udHJhY3QgRFNNYXRoIHsKICAgIAogICAgLyoKICAgIHN0YW5kYXJkIHVpbnQyNTYgZnVuY3Rpb25zCiAgICAgKi8KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKyB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggLSB5KSA8PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKiB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHogPSB4IC8geTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4odWludDI1NiB4LCB1aW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQyNTYgeikgewogICAgICAgIHJldHVybiB4IDw9IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIG1heCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NiB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKICAgIC8qCiAgICB1aW50MTI4IGZ1bmN0aW9ucyAoaCBpcyBmb3IgaGFsZikKICAgICAqLwoKCiAgICBmdW5jdGlvbiBoYWRkKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICBhc3NlcnQoKHogPSB4ICsgeSkgPj0geCk7CiAgICB9CgogICAgZnVuY3Rpb24gaHN1Yih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgYXNzZXJ0KCh6ID0geCAtIHkpIDw9IHgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhtdWwodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIGFzc2VydCgoeiA9IHggKiB5KSA+PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBoZGl2KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICB6ID0geCAvIHk7CiAgICB9CgogICAgZnVuY3Rpb24gaG1pbih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaG1heCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKCiAgICAvKgogICAgaW50MjU2IGZ1bmN0aW9ucwogICAgICovCgogICAgZnVuY3Rpb24gaW1pbihpbnQyNTYgeCwgaW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGludDI1NiB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaW1heChpbnQyNTYgeCwgaW50MjU2IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGludDI1NiB6KSB7CiAgICAgICAgcmV0dXJuIHggPj0geSA/IHggOiB5OwogICAgfQoKICAgIC8qCiAgICBXQUQgbWF0aAogICAgICovCgogICAgdWludDEyOCBjb25zdGFudCBXQUQgPSAxMCAqKiAxODsKCiAgICBmdW5jdGlvbiB3YWRkKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhhZGQoeCwgeSk7CiAgICB9CgogICAgZnVuY3Rpb24gd3N1Yih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBoc3ViKHgsIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdtdWwodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIHogPSBjYXN0KCh1aW50MjU2KHgpICogeSArIFdBRCAvIDIpIC8gV0FEKTsKICAgIH0KCiAgICBmdW5jdGlvbiB3ZGl2KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICB6ID0gY2FzdCgodWludDI1Nih4KSAqIFdBRCArIHkgLyAyKSAvIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdtaW4odWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaG1pbih4LCB5KTsKICAgIH0KICAgIGZ1bmN0aW9uIHdtYXgodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaG1heCh4LCB5KTsKICAgIH0KCiAgICAvKgogICAgUkFZIG1hdGgKICAgICAqLwoKICAgIHVpbnQxMjggY29uc3RhbnQgUkFZID0gMTAgKiogMjc7CgogICAgZnVuY3Rpb24gcmFkZCh1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBoYWRkKHgsIHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJzdWIodWludDEyOCB4LCB1aW50MTI4IHkpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaHN1Yih4LCB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBybXVsKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4IHopIHsKICAgICAgICB6ID0gY2FzdCgodWludDI1Nih4KSAqIHkgKyBSQVkgLyAyKSAvIFJBWSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmRpdih1aW50MTI4IHgsIHVpbnQxMjggeSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludDEyOCB6KSB7CiAgICAgICAgeiA9IGNhc3QoKHVpbnQyNTYoeCkgKiBSQVkgKyB5IC8gMikgLyB5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBycG93KHVpbnQxMjggeCwgdWludDY0IG4pIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIC8vIFRoaXMgZmFtb3VzIGFsZ29yaXRobSBpcyBjYWxsZWQgImV4cG9uZW50aWF0aW9uIGJ5IHNxdWFyaW5nIgogICAgICAgIC8vIGFuZCBjYWxjdWxhdGVzIHhebiB3aXRoIHggYXMgZml4ZWQtcG9pbnQgYW5kIG4gYXMgcmVndWxhciB1bnNpZ25lZC4KICAgICAgICAvLwogICAgICAgIC8vIEl0J3MgTyhsb2cgbiksIGluc3RlYWQgb2YgTyhuKSBmb3IgbmFpdmUgcmVwZWF0ZWQgbXVsdGlwbGljYXRpb24uCiAgICAgICAgLy8KICAgICAgICAvLyBUaGVzZSBmYWN0cyBhcmUgd2h5IGl0IHdvcmtzOgogICAgICAgIC8vCiAgICAgICAgLy8gIElmIG4gaXMgZXZlbiwgdGhlbiB4Xm4gPSAoeF4yKV4obi8yKS4KICAgICAgICAvLyAgSWYgbiBpcyBvZGQsICB0aGVuIHhebiA9IHggKiB4XihuLTEpLAogICAgICAgIC8vICAgYW5kIGFwcGx5aW5nIHRoZSBlcXVhdGlvbiBmb3IgZXZlbiB4IGdpdmVzCiAgICAgICAgLy8gICAgeF5uID0geCAqICh4XjIpXigobi0xKSAvIDIpLgogICAgICAgIC8vCiAgICAgICAgLy8gIEFsc28sIEVWTSBkaXZpc2lvbiBpcyBmbG9vcmluZyBhbmQKICAgICAgICAvLyAgICBmbG9vclsobi0xKSAvIDJdID0gZmxvb3JbbiAvIDJdLgoKICAgICAgICB6ID0gbiAlIDIgIT0gMCA/IHggOiBSQVk7CgogICAgICAgIGZvciAobiAvPSAyOyBuICE9IDA7IG4gLz0gMikgewogICAgICAgICAgICB4ID0gcm11bCh4LCB4KTsKCiAgICAgICAgICAgIGlmIChuICUgMiAhPSAwKSB7CiAgICAgICAgICAgICAgICB6ID0gcm11bCh6LCB4KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBybWluKHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhtaW4oeCwgeSk7CiAgICB9CiAgICBmdW5jdGlvbiBybWF4KHVpbnQxMjggeCwgdWludDEyOCB5KSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50MTI4KSB7CiAgICAgICAgcmV0dXJuIGhtYXgoeCwgeSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FzdCh1aW50MjU2IHgpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQxMjggeikgewogICAgICAgIGFzc2VydCgoeiA9IHVpbnQxMjgoeCkpID09IHgpOwogICAgfQoKfQoKLy8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKTsKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSByZXR1cm5zKGJ5dGVzMzIpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTGVkZ2VyID0gMHgzMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOwoKICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsKICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgICAgICBpZigoYWRkcmVzcyhPQVIpPT0wKXx8KGdldENvZGVTaXplKGFkZHJlc3MoT0FSKSk9PTApKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk+MCl7IC8va292YW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9rb3ZhbiIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3VzZUNvdXBvbihzdHJpbmcgY29kZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07ICAgICAgIAogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsgICAgICAgCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRQcm9vZihieXRlIHByb29mUCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRQcm9vZlR5cGUocHJvb2ZQKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q3VzdG9tR2FzUHJpY2UoZ2FzUHJpY2UpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q29uZmlnKGJ5dGVzMzIgY29uZmlnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldENvbmZpZyhjb25maWcpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogICAgfQoKICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3RyYTJjYm9yKHN0cmluZ1tdIGFycikgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgc3RyaW5nIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKHN0cmluZyBfbmV0d29ya19uYW1lKSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfbmV0d29ya19uYW1lID0gX25ldHdvcmtfbmFtZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KHVpbnQgX2RlbGF5LCB1aW50IF9uYnl0ZXMsIHVpbnQgX2N1c3RvbUdhc0xpbWl0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICBpZiAoKF9uYnl0ZXMgPT0gMCl8fChfbmJ5dGVzID4gMzIpKSB0aHJvdzsKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZTsKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvbktleUhhc2g7CiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uS2V5SGFzaF9ieXRlczMyID0gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG1zdG9yZSh1bm9uY2UsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQodW5vbmNlLCAweDIwKSwgeG9yKGJsb2NraGFzaChzdWIobnVtYmVyLCAxKSksIHhvcihjb2luYmFzZSwgdGltZXN0YW1wKSkpCiAgICAgICAgICAgIG1zdG9yZShzZXNzaW9uS2V5SGFzaCwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZChzZXNzaW9uS2V5SGFzaCwgMHgyMCksIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIpCiAgICAgICAgfQogICAgICAgIGJ5dGVzWzNdIG1lbW9yeSBhcmdzID0gW3Vub25jZSwgbmJ5dGVzLCBzZXNzaW9uS2V5SGFzaF07IAogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KF9kZWxheSwgInJhbmRvbSIsIGFyZ3MsIF9jdXN0b21HYXNMaW1pdCk7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBzaGEzKGJ5dGVzOChfZGVsYXkpLCBhcmdzWzFdLCBzaGEyNTYoYXJnc1swXSksIGFyZ3NbMl0pKTsKICAgICAgICByZXR1cm4gcXVlcnlJZDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzMzIgY29tbWl0bWVudCkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPSBjb21taXRtZW50OwogICAgfQogICAgCiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJ5dGVzMzIpIG9yYWNsaXplX3JhbmRvbURTX2FyZ3M7CiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJvb2wpIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkOwoKICAgIGZ1bmN0aW9uIHZlcmlmeVNpZyhieXRlczMyIHRvc2lnbmgsIGJ5dGVzIGRlcnNpZywgYnl0ZXMgcHVia2V5KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIHNpZ29rOwogICAgICAgIGFkZHJlc3Mgc2lnbmVyOwogICAgICAgIAogICAgICAgIGJ5dGVzMzIgc2lncjsKICAgICAgICBieXRlczMyIHNpZ3M7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3JfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IG9mZnNldCA9IDQrKHVpbnQoZGVyc2lnWzNdKSAtIDB4MjApOwogICAgICAgIHNpZ3JfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0LCAzMiwgc2lncl8sIDApOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdzXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgb2Zmc2V0ICs9IDMyICsgMjsKICAgICAgICBzaWdzXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCsodWludChkZXJzaWdbb2Zmc2V0LTFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpZ3IgOj0gbWxvYWQoYWRkKHNpZ3JfLCAzMikpCiAgICAgICAgICAgIHNpZ3MgOj0gbWxvYWQoYWRkKHNpZ3NfLCAzMikpCiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyNywgc2lnciwgc2lncyk7CiAgICAgICAgaWYgKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjgsIHNpZ3IsIHNpZ3MpOwogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KGJ5dGVzIHByb29mLCB1aW50IHNpZzJvZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHNpZ29rOwogICAgICAgIAogICAgICAgIC8vIFN0ZXAgNjogdmVyaWZ5IHRoZSBhdHRlc3RhdGlvbiBzaWduYXR1cmUsIEFQUEtFWTEgbXVzdCBzaWduIHRoZSBzZXNzaW9uS2V5IGZyb20gdGhlIGNvcnJlY3QgbGVkZ2VyIGFwcCAoQ09ERUhBU0gpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzIgPSBuZXcgYnl0ZXModWludChwcm9vZltzaWcyb2Zmc2V0KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQsIHNpZzIubGVuZ3RoLCBzaWcyLCAwKTsKICAgICAgICAKICAgICAgICBieXRlcyBtZW1vcnkgYXBwa2V5MV9wdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMysxLCA2NCwgYXBwa2V5MV9wdWJrZXksIDApOwogICAgICAgIAogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24yID0gbmV3IGJ5dGVzKDErNjUrMzIpOwogICAgICAgIHRvc2lnbjJbMF0gPSAxOyAvL3JvbGUKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjUsIDY1LCB0b3NpZ24yLCAxKTsKICAgICAgICBieXRlcyBtZW1vcnkgQ09ERUhBU0ggPSBoZXgiZjU1NTdhYmJmNTQ0YzNkYjc4NGQ4NGU3NzdkM2NhMjg5NDM3MmQ1YWU3NjFjNzRhYTkyNjYyMzEyMjVmMTU2YyI7CiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSs2NSk7CiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjIpLCBzaWcyLCBhcHBrZXkxX3B1YmtleSk7CiAgICAgICAgCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gU3RlcCA3OiB2ZXJpZnkgdGhlIEFQUEtFWTEgcHJvdmVuYW5jZSAobXVzdCBiZSBzaWduZWQgYnkgTGVkZ2VyKQogICAgICAgIGJ5dGVzIG1lbW9yeSBMRURHRVJLRVkgPSBoZXgiN2ZiOTU2NDY5YzVjOWI4OTg0MGQ1NWI0MzUzN2U2NmE5OGRkNDgxMWVhMGEyNzIyNDI3MmMyZTU2MjI5MTFlODUzN2EyZjhlODZhNDZiYWVjODI4NjRlOThkZDAxZTljY2MyZjhiYzVkZmM5Y2JlNWE5MWEyOTA0OThkZDk2ZTQiOwogICAgICAgIAogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDErNjUpOwogICAgICAgIHRvc2lnbjNbMF0gPSAweEZFOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMywgNjUsIHRvc2lnbjMsIDEpOwogICAgICAgIAogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWczID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbMys2NSsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzY1LCBzaWczLmxlbmd0aCwgc2lnMywgMCk7CiAgICAgICAgCiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjMpLCBzaWczLCBMRURHRVJLRVkpOwogICAgICAgIAogICAgICAgIHJldHVybiBzaWdvazsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgaWYgKChfcHJvb2ZbMF0gIT0gIkwiKXx8KF9wcm9vZlsxXSAhPSAiUCIpfHwoX3Byb29mWzJdICE9IDEpKSB0aHJvdzsKICAgICAgICAKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHRocm93OwogICAgICAgIAogICAgICAgIF87CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG1hdGNoQnl0ZXMzMlByZWZpeChieXRlczMyIGNvbnRlbnQsIGJ5dGVzIHByZWZpeCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBtYXRjaF8gPSB0cnVlOwogICAgICAgIAogICAgICAgIGZvciAodmFyIGk9MDsgaTxwcmVmaXgubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoY29udGVudFtpXSAhPSBwcmVmaXhbaV0pIG1hdGNoXyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gbWF0Y2hfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKGJ5dGVzIHByb29mLCBieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzIHJlc3VsdCwgc3RyaW5nIGNvbnRleHRfbmFtZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBjaGVja29rOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vIFN0ZXAgMjogdGhlIHVuaXF1ZSBrZXloYXNoIGhhcyB0byBtYXRjaCB3aXRoIHRoZSBzaGEyNTYgb2YgKGNvbnRleHQgbmFtZSArIHF1ZXJ5SWQpCiAgICAgICAgdWludCBsZWRnZXJQcm9vZkxlbmd0aCA9IDMrNjUrKHVpbnQocHJvb2ZbMys2NSsxXSkrMikrMzI7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGtleWhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgsIDMyLCBrZXloYXNoLCAwKTsKICAgICAgICBjaGVja29rID0gKHNoYTMoa2V5aGFzaCkgPT0gc2hhMyhzaGEyNTYoY29udGV4dF9uYW1lLCBxdWVyeUlkKSkpOwogICAgICAgIGlmIChjaGVja29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzEgPSBuZXcgYnl0ZXModWludChwcm9vZltsZWRnZXJQcm9vZkxlbmd0aCsoMzIrOCsxKzMyKSsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCsoMzIrOCsxKzMyKSwgc2lnMS5sZW5ndGgsIHNpZzEsIDApOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vIFN0ZXAgMzogd2UgYXNzdW1lIHNpZzEgaXMgdmFsaWQgKGl0IHdpbGwgYmUgdmVyaWZpZWQgZHVyaW5nIHN0ZXAgNSkgYW5kIHdlIHZlcmlmeSBpZiAncmVzdWx0JyBpcyB0aGUgcHJlZml4IG9mIHNoYTI1NihzaWcxKQogICAgICAgIGNoZWNrb2sgPSBtYXRjaEJ5dGVzMzJQcmVmaXgoc2hhMjU2KHNpZzEpLCByZXN1bHQpOwogICAgICAgIGlmIChjaGVja29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gU3RlcCA0OiBjb21taXRtZW50IG1hdGNoIHZlcmlmaWNhdGlvbiwgc2hhMyhkZWxheSwgbmJ5dGVzLCB1bm9uY2UsIHNlc3Npb25LZXlIYXNoKSA9PSBjb21taXRtZW50IGluIHN0b3JhZ2UuCiAgICAgICAgLy8gVGhpcyBpcyB0byB2ZXJpZnkgdGhhdCB0aGUgY29tcHV0ZWQgYXJncyBtYXRjaCB3aXRoIHRoZSBvbmVzIHNwZWNpZmllZCBpbiB0aGUgcXVlcnkuCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbW1pdG1lbnRTbGljZTEgPSBuZXcgYnl0ZXMoOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKzMyLCA4KzErMzIsIGNvbW1pdG1lbnRTbGljZTEsIDApOwogICAgICAgIAogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uUHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICB1aW50IHNpZzJvZmZzZXQgPSBsZWRnZXJQcm9vZkxlbmd0aCszMisoOCsxKzMyKStzaWcxLmxlbmd0aCs2NTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjQsIDY0LCBzZXNzaW9uUHVia2V5LCAwKTsKICAgICAgICAKICAgICAgICBieXRlczMyIHNlc3Npb25QdWJrZXlIYXNoID0gc2hhMjU2KHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID09IHNoYTMoY29tbWl0bWVudFNsaWNlMSwgc2Vzc2lvblB1YmtleUhhc2gpKXsgLy91bm9uY2UsIG5ieXRlcyBhbmQgc2Vzc2lvbktleUhhc2ggbWF0Y2gKICAgICAgICAgICAgZGVsZXRlIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF07CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBTdGVwIDU6IHZhbGlkaXR5IHZlcmlmaWNhdGlvbiBmb3Igc2lnMSAoa2V5aGFzaCBhbmQgYXJncyBzaWduZWQgd2l0aCB0aGUgc2Vzc2lvbktleSkKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMSA9IG5ldyBieXRlcygzMis4KzErMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgsIDMyKzgrMSszMiwgdG9zaWduMSwgMCk7CiAgICAgICAgY2hlY2tvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMSksIHNpZzEsIHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChjaGVja29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgLy8gdmVyaWZ5IGlmIHNlc3Npb25QdWJrZXlIYXNoIHdhcyB2ZXJpZmllZCBhbHJlYWR5LCBpZiBub3QuLiBsZXQncyBkbyBpdCEKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID09IGZhbHNlKXsKICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF07CiAgICB9CgogICAgCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gY29weUJ5dGVzKGJ5dGVzIGZyb20sIHVpbnQgZnJvbU9mZnNldCwgdWludCBsZW5ndGgsIGJ5dGVzIHRvLCB1aW50IHRvT2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gbGVuZ3RoICsgdG9PZmZzZXQ7CgogICAgICAgIGlmICh0by5sZW5ndGggPCBtaW5MZW5ndGgpIHsKICAgICAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbAogICAgICAgICAgICB0aHJvdzsgLy8gU2hvdWxkIGJlIGEgYmV0dGVyIHdheT8KICAgICAgICB9CgogICAgICAgIC8vIE5PVEU6IHRoZSBvZmZzZXQgMzIgaXMgYWRkZWQgdG8gc2tpcCB0aGUgYHNpemVgIGZpZWxkIG9mIGJvdGggYnl0ZXMgdmFyaWFibGVzCiAgICAgICAgdWludCBpID0gMzIgKyBmcm9tT2Zmc2V0OwogICAgICAgIHVpbnQgaiA9IDMyICsgdG9PZmZzZXQ7CgogICAgICAgIHdoaWxlIChpIDwgKDMyICsgZnJvbU9mZnNldCArIGxlbmd0aCkpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IHRtcCA6PSBtbG9hZChhZGQoZnJvbSwgaSkpCiAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRvLCBqKSwgdG1wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMzI7CiAgICAgICAgICAgIGogKz0gMzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICB9CiAgICAKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICAvLyBEdXBsaWNhdGUgU29saWRpdHkncyBlY3JlY292ZXIsIGJ1dCBjYXRjaGluZyB0aGUgQ0FMTCByZXR1cm4gdmFsdWUKICAgIGZ1bmN0aW9uIHNhZmVyX2VjcmVjb3ZlcihieXRlczMyIGhhc2gsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgLy8gV2UgZG8gb3VyIG93biBtZW1vcnkgbWFuYWdlbWVudCBoZXJlLiBTb2xpZGl0eSB1c2VzIG1lbW9yeSBvZmZzZXQKICAgICAgICAvLyAweDQwIHRvIHN0b3JlIHRoZSBjdXJyZW50IGVuZCBvZiBtZW1vcnkuIFdlIHdyaXRlIHBhc3QgaXQgKGFzCiAgICAgICAgLy8gd3JpdGVzIGFyZSBtZW1vcnkgZXh0ZW5zaW9ucyksIGJ1dCBkb24ndCB1cGRhdGUgdGhlIG9mZnNldCBzbwogICAgICAgIC8vIFNvbGlkaXR5IHdpbGwgcmV1c2UgaXQuIFRoZSBtZW1vcnkgdXNlZCBoZXJlIGlzIG9ubHkgbmVlZGVkIGZvcgogICAgICAgIC8vIHRoaXMgY29udGV4dC4KCiAgICAgICAgLy8gRklYTUU6IGlubGluZSBhc3NlbWJseSBjYW4ndCBhY2Nlc3MgcmV0dXJuIHZhbHVlcwogICAgICAgIGJvb2wgcmV0OwogICAgICAgIGFkZHJlc3MgYWRkcjsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc2l6ZSA6PSBtbG9hZCgweDQwKQogICAgICAgICAgICBtc3RvcmUoc2l6ZSwgaGFzaCkKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCAzMiksIHYpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgNjQpLCByKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDk2KSwgcykKCiAgICAgICAgICAgIC8vIE5PVEU6IHdlIGNhbiByZXVzZSB0aGUgcmVxdWVzdCBtZW1vcnkgYmVjYXVzZSB3ZSBkZWFsIHdpdGgKICAgICAgICAgICAgLy8gICAgICAgdGhlIHJldHVybiBjb2RlCiAgICAgICAgICAgIHJldCA6PSBjYWxsKDMwMDAsIDEsIDAsIHNpemUsIDEyOCwgc2l6ZSwgMzIpCiAgICAgICAgICAgIGFkZHIgOj0gbWxvYWQoc2l6ZSkKICAgICAgICB9CiAgCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBlY3JlY292ZXJ5KGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkKICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQoKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuCiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vICdtbG9hZDgnIHRvIGRvIHRoaXMsIGJ1dCB0aGF0IHdvdWxkIGJlIG5pY2VyLgogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKCiAgICAgICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOgogICAgICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMKICAgICAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnCiAgICAgICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkKICAgICAgICB9CgogICAgICAgIC8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAogICAgICAgIC8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQogICAgICAgIC8vCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwogICAgICAgIGlmICh2IDwgMjcpCiAgICAgICAgICB2ICs9IDI3OwoKICAgICAgICBpZiAodiAhPSAyNyAmJiB2ICE9IDI4KQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKICAgIH0KICAgICAgICAKfQovLyA8L09SQUNMSVpFX0FQST4KCmNvbnRyYWN0IExlZGdlclByb29mVmVyaWZ5SSB7CiAgICBmdW5jdGlvbiBleHRlcm5hbF9vcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBleHRlcm5hbF9vcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlcyBwcm9vZiwgYnl0ZXMzMiBxdWVyeUlkLCBieXRlcyByZXN1bHQsIHN0cmluZyBjb250ZXh0X25hbWUpICBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IE93bmVkIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgCiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9Cn0KCmNvbnRyYWN0IG9yYWNsaXplU2V0dGluZ3MgaXMgT3duZWQgewoJdWludCBjb25zdGFudCBPUkFDTElaRV9QRVJfU1BJTl9HQVNfTElNSVQgPSA2MTAwOwoJdWludCBjb25zdGFudCBPUkFDTElaRV9CQVNFX0dBU19MSU1JVCA9IDIwMDAwMDsKCXVpbnQgc2FmZUdhcyA9IDkwMDA7CgkKCWV2ZW50IG5ld0dhc0xpbWl0KHVpbnQgX2dhc0xpbWl0KTsKCglmdW5jdGlvbiBzZXRTYWZlR2FzKHVpbnQgX2dhcykgCgkJb25seU93bmVyIAoJewoJICAgIGFzc2VydChPUkFDTElaRV9CQVNFX0dBU19MSU1JVCArIHNhZmVHYXMgPj0gT1JBQ0xJWkVfQkFTRV9HQVNfTElNSVQpOwoJICAgIGFzc2VydChzYWZlR2FzIDw9IDI1MDAwKTsKCQlzYWZlR2FzID0gX2dhczsKCQluZXdHYXNMaW1pdChfZ2FzKTsKCX0JCn0KCmNvbnRyYWN0IEhvdXNlTWFuYWdlZCBpcyBPd25lZCB7CiAgICAKICAgIGFkZHJlc3MgcHVibGljIGhvdXNlQWRkcmVzczsKICAgIGJvb2wgcHVibGljIGlzU3RvcHBlZDsKCiAgICBldmVudCBMT0dfQ29udHJhY3RTdG9wcGVkKCk7CiAgICBldmVudCBMT0dfQ29udHJhY3RSZXN1bWVkKCk7CiAgICBldmVudCBMT0dfT3duZXJBZGRyZXNzQ2hhbmdlZChhZGRyZXNzIG9sZEFkZHIsIGFkZHJlc3MgbmV3T3duZXJBZGRyZXNzKTsKICAgIGV2ZW50IExPR19Ib3VzZUFkZHJlc3NDaGFuZ2VkKGFkZHJlc3Mgb2xkQWRkciwgYWRkcmVzcyBuZXdIb3VzZUFkZHJlc3MpOwogICAgCiAgICBtb2RpZmllciBvbmx5SWZOb3RTdG9wcGVkIHsKICAgICAgICBhc3NlcnQoIWlzU3RvcHBlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZTdG9wcGVkIHsKICAgICAgICBhc3NlcnQoaXNTdG9wcGVkKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBIb3VzZU1hbmFnZWQoKSB7CiAgICAgICAgaG91c2VBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBzdG9wX29yX3Jlc3VtZV9Db250cmFjdChib29sIF9pc1N0b3BwZWQpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgaXNTdG9wcGVkID0gX2lzU3RvcHBlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VIb3VzZV9hbmRfT3duZXJfQWRkcmVzc2VzKGFkZHJlc3MgbmV3SG91c2UsIGFkZHJlc3MgbmV3T3duZXIpCiAgICAgICAgb25seU93bmVyIHsKCiAgICAgICAgYXNzZXJ0KG5ld0hvdXNlICE9IGFkZHJlc3MoMHgwKSk7CiAgICAgICAgYXNzZXJ0KG5ld093bmVyICE9IGFkZHJlc3MoMHgwKSk7CiAgICAgICAgCiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICBMT0dfT3duZXJBZGRyZXNzQ2hhbmdlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIAogICAgICAgIGhvdXNlQWRkcmVzcyA9IG5ld0hvdXNlOwogICAgICAgIExPR19Ib3VzZUFkZHJlc3NDaGFuZ2VkKGhvdXNlQWRkcmVzcywgbmV3SG91c2UpOwogICAgfQoKfQoKY29udHJhY3QgdXNpbmdJbnZlc3RvcnNNb2R1bGUgaXMgSG91c2VNYW5hZ2VkLCBvcmFjbGl6ZVNldHRpbmdzIHsKICAgIAogICAgdWludCBjb25zdGFudCBNQVhfSU5WRVNUT1JTID0gNTsgLy9tYXhpbXVtIG51bWJlciBvZiBpbnZlc3RvcnMKICAgIHVpbnQgY29uc3RhbnQgZGl2ZXN0RmVlID0gNTA7IC8vZGl2ZXN0IGZlZSBwZXJjZW50YWdlICgxMDAwMCA9IDEwMCUpCgogICAgIHN0cnVjdCBJbnZlc3RvciB7CiAgICAgICAgYWRkcmVzcyBpbnZlc3RvckFkZHJlc3M7CiAgICAgICAgdWludCBhbW91bnRJbnZlc3RlZDsKICAgICAgICBib29sIHZvdGVkRm9yRW1lcmdlbmN5V2l0aGRyYXdhbDsKICAgIH0KICAgIAogICAgLy9TdGFydGluZyBhdCAxCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGludmVzdG9ySURzOwogICAgbWFwcGluZyh1aW50ID0+IEludmVzdG9yKSBwdWJsaWMgaW52ZXN0b3JzOwogICAgdWludCBwdWJsaWMgbnVtSW52ZXN0b3JzID0gMDsKCiAgICB1aW50IHB1YmxpYyBpbnZlc3RlZCA9IDA7CiAgICAKICAgIHVpbnQgcHVibGljIGludmVzdG9yc1Byb2ZpdCA9IDA7CiAgICB1aW50IHB1YmxpYyBpbnZlc3RvcnNMb3NzZXMgPSAwOwogICAgYm9vbCBwcm9maXREaXN0cmlidXRlZDsKICAgIAogICAgZXZlbnQgTE9HX0ludmVzdG9yRW50cmFuY2UoYWRkcmVzcyBpbnZlc3RvciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgTE9HX0ludmVzdG9yQ2FwaXRhbFVwZGF0ZShhZGRyZXNzIGludmVzdG9yLCBpbnQgYW1vdW50KTsKICAgIGV2ZW50IExPR19JbnZlc3RvckV4aXQoYWRkcmVzcyBpbnZlc3RvciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeUF1dG9TdG9wKCk7CiAgICAKICAgIGV2ZW50IExPR19aZXJvU2VuZCgpOwogICAgZXZlbnQgTE9HX1ZhbHVlSXNUb29CaWcoKTsKICAgIGV2ZW50IExPR19GYWlsZWRTZW5kKGFkZHJlc3MgYWRkciwgdWludCB2YWx1ZSk7CiAgICBldmVudCBMT0dfU3VjY2Vzc2Z1bFNlbmQoYWRkcmVzcyBhZGRyLCB1aW50IHZhbHVlKTsKICAgIAoKCiAgICBtb2RpZmllciBvbmx5TW9yZVRoYW5NaW5JbnZlc3RtZW50IHsKICAgICAgICBhc3NlcnQobXNnLnZhbHVlID4gZ2V0TWluSW52ZXN0bWVudCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlNb3JlVGhhblplcm8gewogICAgICAgIGFzc2VydChtc2cudmFsdWUgIT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAKICAgIG1vZGlmaWVyIG9ubHlJbnZlc3RvcnMgewogICAgICAgIGFzc2VydChpbnZlc3RvcklEc1ttc2cuc2VuZGVyXSAhPSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlOb3RJbnZlc3RvcnMgewogICAgICAgIGFzc2VydChpbnZlc3RvcklEc1ttc2cuc2VuZGVyXSA9PSAwKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciBpbnZlc3RvcnNJbnZhcmlhbnQgewogICAgICAgIF87CiAgICAgICAgYXNzZXJ0KG51bUludmVzdG9ycyA8PSBNQVhfSU5WRVNUT1JTKTsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb25seUlmUHJvZml0Tm90RGlzdHJpYnV0ZWQgewogICAgICAgIGlmICghcHJvZml0RGlzdHJpYnV0ZWQpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldEJhbmtyb2xsKCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCkgewoKICAgICAgICBpZiAoKGludmVzdGVkIDwgaW52ZXN0b3JzUHJvZml0KSB8fAogICAgICAgICAgICAoaW52ZXN0ZWQgKyBpbnZlc3RvcnNQcm9maXQgPCBpbnZlc3RlZCkgfHwKICAgICAgICAgICAgKGludmVzdGVkICsgaW52ZXN0b3JzUHJvZml0IDwgaW52ZXN0b3JzTG9zc2VzKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBpbnZlc3RlZCArIGludmVzdG9yc1Byb2ZpdCAtIGludmVzdG9yc0xvc3NlczsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TWluSW52ZXN0bWVudCgpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgaWYgKG51bUludmVzdG9ycyA9PSBNQVhfSU5WRVNUT1JTKSB7CiAgICAgICAgICAgIHVpbnQgaW52ZXN0b3JJRCA9IHNlYXJjaFNtYWxsZXN0SW52ZXN0b3IoKTsKICAgICAgICAgICAgcmV0dXJuIGdldEJhbGFuY2UoaW52ZXN0b3JzW2ludmVzdG9ySURdLmludmVzdG9yQWRkcmVzcyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TG9zc2VzU2hhcmUoYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IpCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHJldHVybiBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXV0uYW1vdW50SW52ZXN0ZWQgKiAoaW52ZXN0b3JzTG9zc2VzKSAvIGludmVzdGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFByb2ZpdFNoYXJlKGFkZHJlc3MgY3VycmVudEludmVzdG9yKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICByZXR1cm4gaW52ZXN0b3JzW2ludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl1dLmFtb3VudEludmVzdGVkICogKGludmVzdG9yc1Byb2ZpdCkgLyBpbnZlc3RlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKGFkZHJlc3MgY3VycmVudEludmVzdG9yKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICB1aW50IGludmVzdGVkID0gaW52ZXN0b3JzW2ludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl1dLmFtb3VudEludmVzdGVkOwogICAgICAgIHVpbnQgcHJvZml0ID0gZ2V0UHJvZml0U2hhcmUoY3VycmVudEludmVzdG9yKTsKICAgICAgICB1aW50IGxvc3NlcyA9IGdldExvc3Nlc1NoYXJlKGN1cnJlbnRJbnZlc3Rvcik7CgogICAgICAgIGlmICgoaW52ZXN0ZWQgKyBwcm9maXQgPCBwcm9maXQpIHx8CiAgICAgICAgICAgIChpbnZlc3RlZCArIHByb2ZpdCA8IGludmVzdGVkKSB8fAogICAgICAgICAgICAoaW52ZXN0ZWQgKyBwcm9maXQgPCBsb3NzZXMpKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBpbnZlc3RlZCArIHByb2ZpdCAtIGxvc3NlczsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWFyY2hTbWFsbGVzdEludmVzdG9yKCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnModWludCkgewoKICAgICAgICB1aW50IGludmVzdG9ySUQgPSAxOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8PSBudW1JbnZlc3RvcnM7IGkrKykgewogICAgICAgICAgICBpZiAoZ2V0QmFsYW5jZShpbnZlc3RvcnNbaV0uaW52ZXN0b3JBZGRyZXNzKSA8IGdldEJhbGFuY2UoaW52ZXN0b3JzW2ludmVzdG9ySURdLmludmVzdG9yQWRkcmVzcykpIHsKICAgICAgICAgICAgICAgIGludmVzdG9ySUQgPSBpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaW52ZXN0b3JJRDsKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIGFkZEludmVzdG9yQXRJRCh1aW50IGlkKQogICAgICAgIHByaXZhdGUgewoKICAgICAgICBpbnZlc3RvcklEc1ttc2cuc2VuZGVyXSA9IGlkOwogICAgICAgIGludmVzdG9yc1tpZF0uaW52ZXN0b3JBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICBpbnZlc3RvcnNbaWRdLmFtb3VudEludmVzdGVkID0gbXNnLnZhbHVlOwogICAgICAgIGludmVzdGVkICs9IG1zZy52YWx1ZTsKCiAgICAgICAgTE9HX0ludmVzdG9yRW50cmFuY2UobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcm9maXREaXN0cmlidXRpb24oKQogICAgICAgIHByaXZhdGUKICAgICAgICBvbmx5SWZQcm9maXROb3REaXN0cmlidXRlZCB7CgogICAgICAgIHVpbnQgY29weUludmVzdGVkOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPD0gbnVtSW52ZXN0b3JzOyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyBjdXJyZW50SW52ZXN0b3IgPSBpbnZlc3RvcnNbaV0uaW52ZXN0b3JBZGRyZXNzOwogICAgICAgICAgICB1aW50IHByb2ZpdE9mSW52ZXN0b3IgPSBnZXRQcm9maXRTaGFyZShjdXJyZW50SW52ZXN0b3IpOwogICAgICAgICAgICB1aW50IGxvc3Nlc09mSW52ZXN0b3IgPSBnZXRMb3NzZXNTaGFyZShjdXJyZW50SW52ZXN0b3IpOwogICAgICAgICAgICAvL0NoZWNrIGZvciBvdmVyZmxvdyBhbmQgdW5kZXJmbG93CiAgICAgICAgICAgIGlmICgoaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkICsgcHJvZml0T2ZJbnZlc3RvciA+PSBpbnZlc3RvcnNbaV0uYW1vdW50SW52ZXN0ZWQpICYmCiAgICAgICAgICAgICAgICAoaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkICsgcHJvZml0T2ZJbnZlc3RvciA+PSBsb3NzZXNPZkludmVzdG9yKSkgIHsKICAgICAgICAgICAgICAgIGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZCArPSBwcm9maXRPZkludmVzdG9yIC0gbG9zc2VzT2ZJbnZlc3RvcjsKICAgICAgICAgICAgICAgIExPR19JbnZlc3RvckNhcGl0YWxVcGRhdGUoY3VycmVudEludmVzdG9yLCAoaW50KSAocHJvZml0T2ZJbnZlc3RvciAtIGxvc3Nlc09mSW52ZXN0b3IpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlzU3RvcHBlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBMT0dfRW1lcmdlbmN5QXV0b1N0b3AoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNvcHlJbnZlc3RlZCArIGludmVzdG9yc1tpXS5hbW91bnRJbnZlc3RlZCA+PSBjb3B5SW52ZXN0ZWQpCiAgICAgICAgICAgICAgICBjb3B5SW52ZXN0ZWQgKz0gaW52ZXN0b3JzW2ldLmFtb3VudEludmVzdGVkOwogICAgICAgIH0KCiAgICAgICAgZGVsZXRlIGludmVzdG9yc1Byb2ZpdDsKICAgICAgICBkZWxldGUgaW52ZXN0b3JzTG9zc2VzOwogICAgICAgIGludmVzdGVkID0gY29weUludmVzdGVkOwoKICAgICAgICBwcm9maXREaXN0cmlidXRlZCA9IHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGluY3JlYXNlSW52ZXN0bWVudCgpCiAgICAgICAgcGF5YWJsZQogICAgICAgIG9ubHlJZk5vdFN0b3BwZWQKICAgICAgICBvbmx5TW9yZVRoYW5aZXJvCiAgICAgICAgb25seUludmVzdG9ycyAgewoKICAgICAgICBwcm9maXREaXN0cmlidXRpb24oKTsKICAgICAgICBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbbXNnLnNlbmRlcl1dLmFtb3VudEludmVzdGVkICs9IG1zZy52YWx1ZTsKICAgICAgICBpbnZlc3RlZCArPSBtc2cudmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gbmV3SW52ZXN0b3IoKQogICAgICAgIHBheWFibGUKICAgICAgICBvbmx5SWZOb3RTdG9wcGVkCiAgICAgICAgb25seU1vcmVUaGFuWmVybwogICAgICAgIG9ubHlOb3RJbnZlc3RvcnMKICAgICAgICBvbmx5TW9yZVRoYW5NaW5JbnZlc3RtZW50CiAgICAgICAgaW52ZXN0b3JzSW52YXJpYW50IHsKCiAgICAgICAgcHJvZml0RGlzdHJpYnV0aW9uKCk7CgogICAgICAgIGlmIChudW1JbnZlc3RvcnMgPT0gTUFYX0lOVkVTVE9SUykgewogICAgICAgICAgICB1aW50IHNtYWxsZXN0SW52ZXN0b3JJRCA9IHNlYXJjaFNtYWxsZXN0SW52ZXN0b3IoKTsKICAgICAgICAgICAgZGl2ZXN0KGludmVzdG9yc1tzbWFsbGVzdEludmVzdG9ySURdLmludmVzdG9yQWRkcmVzcyk7CiAgICAgICAgfQoKICAgICAgICBudW1JbnZlc3RvcnMrKzsKICAgICAgICBhZGRJbnZlc3RvckF0SUQobnVtSW52ZXN0b3JzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXZlc3QoKQogICAgICAgIG9ubHlJbnZlc3RvcnMgewoKICAgICAgICBkaXZlc3QobXNnLnNlbmRlcik7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGRpdmVzdChhZGRyZXNzIGN1cnJlbnRJbnZlc3RvcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGludmVzdG9yc0ludmFyaWFudCB7CgogICAgICAgIHByb2ZpdERpc3RyaWJ1dGlvbigpOwogICAgICAgIHVpbnQgY3VycmVudElEID0gaW52ZXN0b3JJRHNbY3VycmVudEludmVzdG9yXTsKICAgICAgICB1aW50IGFtb3VudFRvUmV0dXJuID0gZ2V0QmFsYW5jZShjdXJyZW50SW52ZXN0b3IpOwoKICAgICAgICBpZiAoKGludmVzdGVkID49IGludmVzdG9yc1tjdXJyZW50SURdLmFtb3VudEludmVzdGVkKSkgewogICAgICAgICAgICBpbnZlc3RlZCAtPSBpbnZlc3RvcnNbY3VycmVudElEXS5hbW91bnRJbnZlc3RlZDsKICAgICAgICAgICAgdWludCBkaXZlc3RGZWVBbW91bnQgPSAgKGFtb3VudFRvUmV0dXJuKmRpdmVzdEZlZSkvMTAwMDA7CiAgICAgICAgICAgIGFtb3VudFRvUmV0dXJuIC09IGRpdmVzdEZlZUFtb3VudDsKCiAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNbY3VycmVudElEXTsKICAgICAgICAgICAgZGVsZXRlIGludmVzdG9ySURzW2N1cnJlbnRJbnZlc3Rvcl07CgogICAgICAgICAgICAvL1Jlb3JkZXIgaW52ZXN0b3JzCiAgICAgICAgICAgIGlmIChjdXJyZW50SUQgIT0gbnVtSW52ZXN0b3JzKSB7CiAgICAgICAgICAgICAgICAvLyBHZXQgbGFzdCBpbnZlc3RvcgogICAgICAgICAgICAgICAgSW52ZXN0b3IgbGFzdEludmVzdG9yID0gaW52ZXN0b3JzW251bUludmVzdG9yc107CiAgICAgICAgICAgICAgICAvL1NldCBsYXN0IGludmVzdG9yIElEIHRvIGludmVzdG9ySUQgb2YgZGl2ZXN0aW5nIGFjY291bnQKICAgICAgICAgICAgICAgIGludmVzdG9ySURzW2xhc3RJbnZlc3Rvci5pbnZlc3RvckFkZHJlc3NdID0gY3VycmVudElEOwogICAgICAgICAgICAgICAgLy9Db3B5IGludmVzdG9yIGF0IHRoZSBuZXcgcG9zaXRpb24gaW4gdGhlIG1hcHBpbmcKICAgICAgICAgICAgICAgIGludmVzdG9yc1tjdXJyZW50SURdID0gbGFzdEludmVzdG9yOwogICAgICAgICAgICAgICAgLy9EZWxldGUgb2xkIHBvc2l0aW9uIGluIHRoZSBtYXBwcGluZwogICAgICAgICAgICAgICAgZGVsZXRlIGludmVzdG9yc1tudW1JbnZlc3RvcnNdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBudW1JbnZlc3RvcnMtLTsKICAgICAgICAgICAgc2FmZVNlbmQoY3VycmVudEludmVzdG9yLCBhbW91bnRUb1JldHVybik7CiAgICAgICAgICAgIHNhZmVTZW5kKGhvdXNlQWRkcmVzcywgZGl2ZXN0RmVlQW1vdW50KTsKICAgICAgICAgICAgTE9HX0ludmVzdG9yRXhpdChjdXJyZW50SW52ZXN0b3IsIGFtb3VudFRvUmV0dXJuKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpc1N0b3BwZWQgPSB0cnVlOwogICAgICAgICAgICBMT0dfRW1lcmdlbmN5QXV0b1N0b3AoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGZvcmNlRGl2ZXN0T2ZBbGxJbnZlc3RvcnMoKQogICAgICAgIG9ubHlPd25lciB7CiAgICAgICAgICAgIAogICAgICAgIHVpbnQgY29weU51bUludmVzdG9ycyA9IG51bUludmVzdG9yczsKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPD0gY29weU51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGRpdmVzdChpbnZlc3RvcnNbMV0uaW52ZXN0b3JBZGRyZXNzKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNhZmVTZW5kKGFkZHJlc3MgYWRkciwgdWludCB2YWx1ZSkKICAgICAgICBpbnRlcm5hbCB7CgogICAgICAgIGlmICh2YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIExPR19aZXJvU2VuZCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5iYWxhbmNlIDwgdmFsdWUpIHsKICAgICAgICAgICAgTE9HX1ZhbHVlSXNUb29CaWcoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCEoYWRkci5jYWxsLmdhcyhzYWZlR2FzKS52YWx1ZSh2YWx1ZSkoKSkpIHsKICAgICAgICAgICAgTE9HX0ZhaWxlZFNlbmQoYWRkciwgdmFsdWUpOwogICAgICAgICAgICBpZiAoYWRkciAhPSBob3VzZUFkZHJlc3MpIHsKICAgICAgICAgICAgICAgIC8vRm9yd2FyZCB0byBob3VzZSBhZGRyZXNzIGFsbCBjaGFuZ2UKICAgICAgICAgICAgICAgIGlmICghKGhvdXNlQWRkcmVzcy5jYWxsLmdhcyhzYWZlR2FzKS52YWx1ZSh2YWx1ZSkoKSkpIExPR19GYWlsZWRTZW5kKGhvdXNlQWRkcmVzcywgdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMT0dfU3VjY2Vzc2Z1bFNlbmQoYWRkcix2YWx1ZSk7CiAgICB9Cn0KCmNvbnRyYWN0IEVtZXJnZW5jeVdpdGhkcmF3YWxNb2R1bGUgaXMgdXNpbmdJbnZlc3RvcnNNb2R1bGUgewogICAgdWludCBjb25zdGFudCBFTUVSR0VOQ1lfV0lUSERSQVdBTF9SQVRJTyA9IDgwOyAvL3JhdGlvIHBlcmNlbnRhZ2UgKDEwMCA9IDEwMCUpCiAgICB1aW50IGNvbnN0YW50IEVNRVJHRU5DWV9USU1FT1VUID0gMyBkYXlzOwogICAgCiAgICBzdHJ1Y3QgV2l0aGRyYXdhbFByb3Bvc2FsIHsKICAgICAgICBhZGRyZXNzIHRvQWRkcmVzczsKICAgICAgICB1aW50IGF0VGltZTsKICAgIH0KICAgIAogICAgV2l0aGRyYXdhbFByb3Bvc2FsIHB1YmxpYyBwcm9wb3NlZFdpdGhkcmF3YWw7CiAgICAKICAgIGV2ZW50IExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsUHJvcG9zZWQoKTsKICAgIGV2ZW50IExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsRmFpbGVkKGFkZHJlc3Mgd2l0aGRyYXdhbEFkZHJlc3MpOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxTdWNjZWVkZWQoYWRkcmVzcyB3aXRoZHJhd2FsQWRkcmVzcywgdWludCBhbW91bnRXaXRoZHJhd24pOwogICAgZXZlbnQgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxWb3RlKGFkZHJlc3MgaW52ZXN0b3IsIGJvb2wgdm90ZSk7CiAgICAKICAgIG1vZGlmaWVyIG9ubHlBZnRlclByb3Bvc2VkIHsKICAgICAgICBhc3NlcnQocHJvcG9zZWRXaXRoZHJhd2FsLnRvQWRkcmVzcyAhPSAwKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBtb2RpZmllciBvbmx5SWZFbWVyZ2VuY3lUaW1lT3V0SGFzUGFzc2VkIHsKICAgICAgICBhc3NlcnQocHJvcG9zZWRXaXRoZHJhd2FsLmF0VGltZSArIEVNRVJHRU5DWV9USU1FT1VUIDw9IG5vdyk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdm90ZUVtZXJnZW5jeVdpdGhkcmF3YWwoYm9vbCB2b3RlKQogICAgICAgIG9ubHlJbnZlc3RvcnMKICAgICAgICBvbmx5QWZ0ZXJQcm9wb3NlZAogICAgICAgIG9ubHlJZlN0b3BwZWQgewoKICAgICAgICBpbnZlc3RvcnNbaW52ZXN0b3JJRHNbbXNnLnNlbmRlcl1dLnZvdGVkRm9yRW1lcmdlbmN5V2l0aGRyYXdhbCA9IHZvdGU7CiAgICAgICAgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxWb3RlKG1zZy5zZW5kZXIsIHZvdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb3Bvc2VFbWVyZ2VuY3lXaXRoZHJhd2FsKGFkZHJlc3Mgd2l0aGRyYXdhbEFkZHJlc3MpCiAgICAgICAgb25seUlmU3RvcHBlZAogICAgICAgIG9ubHlPd25lciB7CgogICAgICAgIC8vUmVzZXRzIHByZXZpb3VzIHZvdGVzCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDw9IG51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGRlbGV0ZSBpbnZlc3RvcnNbaV0udm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsOwogICAgICAgIH0KCiAgICAgICAgcHJvcG9zZWRXaXRoZHJhd2FsID0gV2l0aGRyYXdhbFByb3Bvc2FsKHdpdGhkcmF3YWxBZGRyZXNzLCBub3cpOwogICAgICAgIExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsUHJvcG9zZWQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBleGVjdXRlRW1lcmdlbmN5V2l0aGRyYXdhbCgpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUFmdGVyUHJvcG9zZWQKICAgICAgICBvbmx5SWZTdG9wcGVkCiAgICAgICAgb25seUlmRW1lcmdlbmN5VGltZU91dEhhc1Bhc3NlZCB7CgogICAgICAgIHVpbnQgbnVtT2ZWb3Rlc0luRmF2b3VyOwogICAgICAgIHVpbnQgYW1vdW50VG9XaXRoZHJhdyA9IHRoaXMuYmFsYW5jZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDw9IG51bUludmVzdG9yczsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpbnZlc3RvcnNbaV0udm90ZWRGb3JFbWVyZ2VuY3lXaXRoZHJhd2FsID09IHRydWUpIHsKICAgICAgICAgICAgICAgIG51bU9mVm90ZXNJbkZhdm91cisrOwogICAgICAgICAgICAgICAgZGVsZXRlIGludmVzdG9yc1tpXS52b3RlZEZvckVtZXJnZW5jeVdpdGhkcmF3YWw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChudW1PZlZvdGVzSW5GYXZvdXIgPj0gRU1FUkdFTkNZX1dJVEhEUkFXQUxfUkFUSU8gKiBudW1JbnZlc3RvcnMgLyAxMDApIHsKICAgICAgICAgICAgaWYgKCFwcm9wb3NlZFdpdGhkcmF3YWwudG9BZGRyZXNzLnNlbmQoYW1vdW50VG9XaXRoZHJhdykpIHsKICAgICAgICAgICAgICAgIExPR19FbWVyZ2VuY3lXaXRoZHJhd2FsRmFpbGVkKHByb3Bvc2VkV2l0aGRyYXdhbC50b0FkZHJlc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgTE9HX0VtZXJnZW5jeVdpdGhkcmF3YWxTdWNjZWVkZWQocHJvcG9zZWRXaXRoZHJhd2FsLnRvQWRkcmVzcywgYW1vdW50VG9XaXRoZHJhdyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgICAgIC8qCiAgICBUaGUgb3duZXIgY2FuIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGZvcmNlIHRoZSBleGl0IG9mIGFuIGludmVzdG9yIGZyb20gdGhlCiAgICBjb250cmFjdCBkdXJpbmcgYW4gZW1lcmdlbmN5IHdpdGhkcmF3YWwgaW4gdGhlIGZvbGxvd2luZyBzaXR1YXRpb25zOgogICAgICAgIC0gVW5yZXNwb25zaXZlIGludmVzdG9yCiAgICAgICAgLSBJbnZlc3RvciBkZW1hbmRpbmcgdG8gYmUgcGFpZCBpbiBvdGhlciB0byB2b3RlLCB0aGUgZmFjdG8tYmxhY2ttYWlsaW5nCiAgICAgICAgb3RoZXIgaW52ZXN0b3JzCiAgICAqLwogICAgZnVuY3Rpb24gZm9yY2VEaXZlc3RPZk9uZUludmVzdG9yKGFkZHJlc3MgY3VycmVudEludmVzdG9yKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlJZlN0b3BwZWQgewoKICAgICAgICBkaXZlc3QoY3VycmVudEludmVzdG9yKTsKICAgICAgICAvL1Jlc2V0cyBlbWVyZ2VuY3kgd2l0aGRyYXdhbCBwcm9wb3NhbC4gSW52ZXN0b3JzIG11c3Qgdm90ZSBhZ2FpbgogICAgICAgIGRlbGV0ZSBwcm9wb3NlZFdpdGhkcmF3YWw7CiAgICB9Cn0KCmNvbnRyYWN0IFNsb3QgaXMgdXNpbmdPcmFjbGl6ZSwgRW1lcmdlbmN5V2l0aGRyYXdhbE1vZHVsZSwgRFNNYXRoIHsKICAgIAogICAgdWludCBjb25zdGFudCBJTlZFU1RPUlNfRURHRSA9IDIwMDsgCiAgICB1aW50IGNvbnN0YW50IEhPVVNFX0VER0UgPSA1MDsKICAgIHVpbnQgY29uc3RhbnQgQ0FQSVRBTF9SSVNLID0gMjUwOwogICAgdWludCBjb25zdGFudCBNQVhfU1BJTlMgPSAxNjsKICAgIAogICAgdWludCBtaW5CZXQgPSAxIHdlaTsKIAogICAgc3RydWN0IFNwaW5zQ29udGFpbmVyIHsKICAgICAgICBhZGRyZXNzIHBsYXllckFkZHJlc3M7CiAgICAgICAgdWludCBuU3BpbnM7CiAgICAgICAgdWludCBhbW91bnRXYWdlcmVkOwogICAgfQogICAgCiAgICBtYXBwaW5nIChieXRlczMyID0+IFNwaW5zQ29udGFpbmVyKSBzcGluczsKICAgIAogICAgLyogQm90aCBhcnJheXMgYXJlIG9yZGVyZWQ6CiAgICAgLSBwcm9iYWJpbGl0aWVzIGFyZSBvcmRlcmVkIGZyb20gc21hbGxlc3QgdG8gaGlnaGVzdAogICAgIC0gbXVsdGlwbGllcnMgYXJlIG9yZGVyZWQgZnJvbSBoaWdoZXN0IHRvIGxvd2VzdAogICAgIFRoZSBwcm9iYWJpbGl0aWVzIGFyZSBleHByZXNzZWQgYXMgaW50ZWdlciBudW1iZXJzIG92ZXIgYSBzY2FsZSBvZiAxMDAwMDogaS5lCiAgICAgMTAwIGlzIGVxdWl2YWxlbnQgdG8gMSUsIDUwMDAgdG8gNTAlIGFuZCBzbyBvbi4KICAgICovCiAgICB1aW50W10gcHVibGljIHByb2JhYmlsaXRpZXM7CiAgICB1aW50W10gcHVibGljIG11bHRpcGxpZXJzOwogICAgCiAgICB1aW50IHB1YmxpYyB0b3RhbEFtb3VudFdhZ2VyZWQ7IAogICAgCiAgICBldmVudCBMT0dfbmV3U3BpbnNDb250YWluZXIoYnl0ZXMzMiBteWlkLCBhZGRyZXNzIHBsYXllckFkZHJlc3MsIHVpbnQgYW1vdW50V2FnZXJlZCwgdWludCBuU3BpbnMpOwogICAgZXZlbnQgTE9HX1NwaW5FeGVjdXRlZChieXRlczMyIG15aWQsIGFkZHJlc3MgcGxheWVyQWRkcmVzcywgdWludCBzcGluSW5kZXgsIHVpbnQgbnVtYmVyRHJhd24pOwogICAgZXZlbnQgTE9HX1NwaW5zQ29udGFpbmVySW5mbyhieXRlczMyIG15aWQsIGFkZHJlc3MgcGxheWVyQWRkcmVzcywgdWludCBuZXRQYXlvdXQpOwogICAgTGVkZ2VyUHJvb2ZWZXJpZnlJIGV4dGVybmFsQ29udHJhY3Q7CiAgICAKICAgIGZ1bmN0aW9uIFNsb3QoYWRkcmVzcyBfdmVyaWZpZXJBZGRyKSB7CiAgICAgICAgZXh0ZXJuYWxDb250cmFjdCA9IExlZGdlclByb29mVmVyaWZ5SShfdmVyaWZpZXJBZGRyKTsKICAgIH0KICAgIAogICAgLy9TRUNUSU9OIEk6IE1PRElGSUVSUyBBTkQgSEVMUEVSIEZVTkNUSU9OUwogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgZXh0ZXJuYWxDb250cmFjdC5leHRlcm5hbF9vcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KHF1ZXJ5SWQsIGNvbW1pdG1lbnQpOwogICAgfQogICAgCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICAvL2lmICgoX3Byb29mWzBdICE9ICJMIil8fChfcHJvb2ZbMV0gIT0gIlAiKXx8KF9wcm9vZlsyXSAhPSAxKSkgdGhyb3c7CiAgICAgICAgYXNzZXJ0KGV4dGVybmFsQ29udHJhY3QuZXh0ZXJuYWxfb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPcmFjbGl6ZSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gb3JhY2xpemVfY2JBZGRyZXNzKCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmU3BpbnNFeGlzdChieXRlczMyIG15aWQpIHsKICAgICAgICBhc3NlcnQoc3BpbnNbbXlpZF0ucGxheWVyQWRkcmVzcyAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzVmFsaWRTaXplKHVpbnQgX2Ftb3VudFdhZ2VyZWQpIAogICAgICAgIGNvbnN0YW50IAogICAgICAgIHJldHVybnMoYm9vbCkgewogICAgICAgICAgICAKICAgICAgICB1aW50IG5ldFBvdGVudGlhbFBheW91dCA9IChfYW1vdW50V2FnZXJlZCAqICgxMDAwMCAtIElOVkVTVE9SU19FREdFKSAqIG11bHRpcGxpZXJzWzBdKS8gMTAwMDA7IAogICAgICAgIHVpbnQgbWF4QWxsb3dlZFBheW91dCA9IChDQVBJVEFMX1JJU0sgKiBnZXRCYW5rcm9sbCgpKS8xMDAwMDsKICAgICAgICAKICAgICAgICByZXR1cm4gKChuZXRQb3RlbnRpYWxQYXlvdXQgPD0gbWF4QWxsb3dlZFBheW91dCkgJiYgKF9hbW91bnRXYWdlcmVkID49IG1pbkJldCkpOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlJZkVub3VnaEZ1bmRzKGJ5dGVzMzIgbXlpZCkgewogICAgICAgIGlmIChpc1ZhbGlkU2l6ZShzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkKSkgewogICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHNhZmVTZW5kKHNwaW5zW215aWRdLnBsYXllckFkZHJlc3MsIHNwaW5zW215aWRdLmFtb3VudFdhZ2VyZWQpOwogICAgICAgICAgICBkZWxldGUgc3BpbnNbbXlpZF07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CiAgICAKCW1vZGlmaWVyIG9ubHlMZXNzVGhhbk1heFNwaW5zICh1aW50IF9uU3BpbnMpIHsKICAgICAgICBhc3NlcnQoX25TcGlucyA8PSBNQVhfU1BJTlMpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8qCiAgICAgICAgRm9yIHRoZSBnYW1lIHRvIGJlIGZhaXIsIHRoZSB0b3RhbCBncm9zcyBwYXlvdXQgb3ZlciBhIGxhcmdlIG51bWJlciBvZiAKICAgICAgICBpbmRpdmlkdWFsIHNsb3Qgc3BpbnMgc2hvdWxkIGJlIHRoZSB0b3RhbCBhbW91bnQgd2FnZXJlZCBieSB0aGUgcGxheWVyLiAKICAgICAgICAKICAgICAgICBUaGUgZ2FtZSBvd25lciwgY2FsbGVkIGhvdXNlLCBhbmQgdGhlIGludmVzdG9ycyB3aWxsIGdhaW4gYnkgYXBwbHlpbmcgCiAgICAgICAgYSBzbWFsbCBmZWUsIGNhbGxlZCBlZGdlLCB0byB0aGUgYW1vdW50IHdvbiBieSB0aGUgcGxheWVyIGluIHRoZSBjYXNlIG9mCiAgICAgICAgYSBzdWNjZXNzZnVsIHNwaW4uIAogICAgICAgIAogICAgICAgIFRoZSB0b3RhbCBncm9zcyBleHBlY3RlZCBwYXlvdXQgaXMgZXF1YWwgdG8gdGhlIHN1bSBvZiBhbGwgcGF5b3V0LiBFYWNoIAogICAgICAgIGktdGggcGF5b3V0IGlzIGNhbGN1bGF0ZWQ6CiAgICAgICAgICAgICAgICAgICAgYW1vdW50V2FnZXJlZCAqIG11bHRpcGxpZXJzW2ldICogcHJvYmFiaWxpdGllc1tpXSAKICAgICAgICBUaGUgcmVzdWx0aW5nIGVxdWF0aW9uIGlzOgogICAgICAgICAgICAgICAgICAgIHN1bSBvZiBhVyAqIG1baV0gKiBwW2ldID0gYVcKICAgICAgICBBZnRlciBoYXZpbmcgc2ltcGxpZmllZCB0aGUgZXF1YXRpb246CiAgICAgICAgICAgICAgICAgICAgICAgIHN1bSBvZiBtW2ldICogcFtpXSA9IDEKICAgICAgICBTaW5jZSBvdXIgcHJvYmFiaWxpdGllcyBhcmUgZGVmaW5lZCBvdmVyIDEwMDAwLCB0aGUgc3VtIHNob3VsZCBiZSAxMDAwMC4KICAgICAgICAKICAgICAgICBUaGUgY29udHJhY3Qgb3duZXIgY2FuIG1vZGlmeSB0aGUgbXVsdGlwbGllcnMgYW5kIHByb2JhYmlsaXRpZXMgYXJyYXksIAogICAgICAgIGJ1dCB0aGUgIG1vZGlmaWVyIGVuZm9yY2VzIHRoYXQgdGhlIG51bWJlciBjaG9vc2VuIGFsd2F5cyByZXN1bHQgaW4gYSAKICAgICAgICBmYXJlIGdhbWUuCiAgICAqLwogICAgbW9kaWZpZXIgb25seUlmRmFpcih1aW50W10gX3Byb2IsIHVpbnRbXSBfcGF5b3V0cykgewogICAgICAgIGlmIChfcHJvYi5sZW5ndGggIT0gX3BheW91dHMubGVuZ3RoKSByZXZlcnQoKTsKICAgICAgICB1aW50IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDxfcHJvYi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdW0gKz0gX3Byb2JbaV0gKiBfcGF5b3V0c1tpXTsgICAgIAogICAgICAgIH0KICAgICAgICBhc3NlcnQoc3VtID09IDEwMDAwKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uKCkKICAgICAgICBwYXlhYmxlIHsKICAgICAgICBidXlTcGlucygxKTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXlTcGlucyh1aW50IF9uU3BpbnMpIAogICAgICAgIHBheWFibGUgCiAgICAgICAgb25seUxlc3NUaGFuTWF4U3BpbnMoX25TcGlucykgCgkJb25seUlmTm90U3RvcHBlZCB7CiAgICAgICAgICAgIAogICAgICAgIHVpbnQgZ2FzID0gX25TcGlucypPUkFDTElaRV9QRVJfU1BJTl9HQVNfTElNSVQgKyBPUkFDTElaRV9CQVNFX0dBU19MSU1JVCArIHNhZmVHYXM7CiAgICAgICAgdWludCBvcmFjbGl6ZUZlZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKS5nZXRQcmljZSgicmFuZG9tIiwgZ2FzKTsKICAgICAgICAKICAgICAgICAvLyBEaXNhbGxvdyBiZXRzIHRoYXQgZXZlbiB3aGVuIG1heGltYWxseSB3aW5uaW5nIGFyZSBhIGxvc3MgZm9yIHBsYXllciAKICAgICAgICAvLyBkdWUgdG8gb3JhY2xpemVGZWUKICAgICAgICBpZiAob3JhY2xpemVGZWUvbXVsdGlwbGllcnNbMF0gKyBvcmFjbGl6ZUZlZSA+PSBtc2cudmFsdWUpIHJldmVydCgpOwogICAgICAgIAogICAgICAgIHVpbnQgYW1vdW50V2FnZXJlZCA9IG1zZy52YWx1ZSAtIG9yYWNsaXplRmVlOwogICAgICAgIHVpbnQgbWF4TmV0UG90ZW50aWFsUGF5b3V0ID0gKGFtb3VudFdhZ2VyZWQgKiAoMTAwMDAgLSBJTlZFU1RPUlNfRURHRSkgKiBtdWx0aXBsaWVyc1swXSkvMTAwMDA7IAogICAgICAgIHVpbnQgbWF4QWxsb3dlZFBheW91dCA9IChDQVBJVEFMX1JJU0sgKiBnZXRCYW5rcm9sbCgpKS8xMDAwMDsKICAgICAgICAKICAgICAgICBpZiAoKG1heE5ldFBvdGVudGlhbFBheW91dCA8PSBtYXhBbGxvd2VkUGF5b3V0KSAmJiAoYW1vdW50V2FnZXJlZCA+PSBtaW5CZXQpKSB7CiAgICAgICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkoMCwgMipfblNwaW5zLCBnYXMpOwogICAgICAgICAgICAgc3BpbnNbcXVlcnlJZF0gPSAKICAgICAgICAgICAgICAgIFNwaW5zQ29udGFpbmVyKG1zZy5zZW5kZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9uU3BpbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudFdhZ2VyZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAKICAgICAgICAgICAgTE9HX25ld1NwaW5zQ29udGFpbmVyKHF1ZXJ5SWQsIG1zZy5zZW5kZXIsIGFtb3VudFdhZ2VyZWQsIF9uU3BpbnMpOwogICAgICAgICAgICB0b3RhbEFtb3VudFdhZ2VyZWQgKz0gYW1vdW50V2FnZXJlZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGV4ZWN1dGVTcGlucyhieXRlczMyIG15aWQsIGJ5dGVzIHJhbmRvbUJ5dGVzKSAKICAgICAgICBwcml2YXRlIAogICAgICAgIHJldHVybnModWludCkKICAgIHsKICAgICAgICB1aW50IGFtb3VudFdvbiA9IDA7CiAgICAgICAgdWludCBudW1iZXJEcmF3biA9IDA7CiAgICAgICAgdWludCByYW5nZVVwcGVyRW5kID0gMDsKICAgICAgICB1aW50IG5TcGlucyA9IHNwaW5zW215aWRdLm5TcGluczsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCAyKm5TcGluczsgaSArPSAyKSB7CiAgICAgICAgICAgIC8vIEEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMioqMTYsIG5vcm1hbGl6ZWQgb3ZlciAwIC0gMTAwMDAKICAgICAgICAgICAgbnVtYmVyRHJhd24gPSAoKHVpbnQocmFuZG9tQnl0ZXNbaV0pKjI1NiArIHVpbnQocmFuZG9tQnl0ZXNbaSsxXSkpKjEwMDAwKS8yKioxNjsKICAgICAgICAgICAgcmFuZ2VVcHBlckVuZCA9IDA7CiAgICAgICAgICAgIExPR19TcGluRXhlY3V0ZWQobXlpZCwgc3BpbnNbbXlpZF0ucGxheWVyQWRkcmVzcywgaS8yLCBudW1iZXJEcmF3bik7CiAgICAgICAgICAgIGZvciAodWludCBqID0gMDsgaiA8IHByb2JhYmlsaXRpZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIHJhbmdlVXBwZXJFbmQgKz0gcHJvYmFiaWxpdGllc1tqXTsKICAgICAgICAgICAgICAgIGlmIChudW1iZXJEcmF3biA8IHJhbmdlVXBwZXJFbmQpIHsKICAgICAgICAgICAgICAgICAgICBhbW91bnRXb24gKz0gKHNwaW5zW215aWRdLmFtb3VudFdhZ2VyZWQgKiBtdWx0aXBsaWVyc1tqXSkgLyBuU3BpbnM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFtb3VudFdvbjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2VuZFBheW91dChieXRlczMyIG15aWQsIHVpbnQgcGF5b3V0KSBwcml2YXRlIHsKCiAgICAgICAgaWYgKHBheW91dCA+PSBzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkKSB7CiAgICAgICAgICAgIGludmVzdG9yc0xvc3NlcyArPSBzdWIocGF5b3V0LCBzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkKTsKICAgICAgICAgICAgcGF5b3V0ID0gKHBheW91dCooMTAwMDAgLSBJTlZFU1RPUlNfRURHRSkpLzEwMDAwOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdWludCB0ZW1wUHJvZml0ID0gYWRkKGludmVzdG9yc1Byb2ZpdCwgc3ViKHNwaW5zW215aWRdLmFtb3VudFdhZ2VyZWQsIHBheW91dCkpOwogICAgICAgICAgICBpbnZlc3RvcnNQcm9maXQgKz0gKHN1YihzcGluc1tteWlkXS5hbW91bnRXYWdlcmVkLCBwYXlvdXQpKigxMDAwMCAtIEhPVVNFX0VER0UpKS8xMDAwMDsKICAgICAgICAgICAgc2FmZVNlbmQoaG91c2VBZGRyZXNzLCBzdWIodGVtcFByb2ZpdCwgaW52ZXN0b3JzUHJvZml0KSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIExPR19TcGluc0NvbnRhaW5lckluZm8obXlpZCwgc3BpbnNbbXlpZF0ucGxheWVyQWRkcmVzcywgcGF5b3V0KTsKICAgICAgICBzYWZlU2VuZChzcGluc1tteWlkXS5wbGF5ZXJBZGRyZXNzLCBwYXlvdXQpOwogICAgfQogICAgCiAgICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIF9wcm9vZikgCiAgICAgICAgb25seU9yYWNsaXplCiAgICAgICAgb25seUlmU3BpbnNFeGlzdChteWlkKQogICAgICAgIG9ubHlJZkVub3VnaEZ1bmRzKG15aWQpCiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkobXlpZCwgcmVzdWx0LCBfcHJvb2YpCiAgICB7CgkJCiAgICAgICAgdWludCBwYXlvdXQgPSBleGVjdXRlU3BpbnMobXlpZCwgYnl0ZXMocmVzdWx0KSk7CiAgICAgICAgCiAgICAgICAgc2VuZFBheW91dChteWlkLCBwYXlvdXQpOwogICAgICAgIAogICAgICAgIGRlbGV0ZSBwcm9maXREaXN0cmlidXRlZDsKICAgICAgICBkZWxldGUgc3BpbnNbbXlpZF07CiAgICB9CiAgICAKICAgIC8vIFNFVFRFUlMgLSBTRVRUSU5HUyBBQ0NFU1NJQkxFIEJZIE9XTkVSCiAgICAKICAgIC8vIENoZWNrIG9yZGVyaW5nIGFzIHdlbGwsIHNpbmNlIG9yZGVyaW5nIGFzc3VtcHRpb25zIGFyZSBtYWRlIGluIF9jYWxsYmFjayAKICAgIC8vIGFuZCBlbHNld2hlcmUKICAgIGZ1bmN0aW9uIHNldENvbmZpZ3VyYXRpb24odWludFtdIF9wcm9iYWJpbGl0aWVzLCB1aW50W10gX211bHRpcGxpZXJzKSAKICAgICAgICBvbmx5T3duZXIgCiAgICAgICAgb25seUlmRmFpcihfcHJvYmFiaWxpdGllcywgX211bHRpcGxpZXJzKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICBvcmFjbGl6ZV9zZXRQcm9vZihwcm9vZlR5cGVfTGVkZ2VyKTsgLy9UaGlzIGlzIGhlcmUgdG8gcmVkdWNlIGdhcyBjb3N0IGFzIHRoaXMgZnVuY3Rpb24gaGFzIHRvIGJlIGNhbGxlZCBhbnl3YXkgZm9yIGluaXRpYWxpemF0aW9uCiAgICAgICAgCiAgICAgICAgZGVsZXRlIHByb2JhYmlsaXRpZXM7CiAgICAgICAgZGVsZXRlIG11bHRpcGxpZXJzOwogICAgICAgIAogICAgICAgIHVpbnQgbGFzdFByb2JhYmlsaXR5ID0gMDsKICAgICAgICB1aW50IGxhc3RNdWx0aXBsaWVyID0gMioqMjU2IC0gMTsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfcHJvYmFiaWxpdGllcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwcm9iYWJpbGl0aWVzLnB1c2goX3Byb2JhYmlsaXRpZXNbaV0pOwogICAgICAgICAgICBpZiAobGFzdFByb2JhYmlsaXR5ID49IF9wcm9iYWJpbGl0aWVzW2ldKSByZXZlcnQoKTsKICAgICAgICAgICAgbGFzdFByb2JhYmlsaXR5ID0gX3Byb2JhYmlsaXRpZXNbaV07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfbXVsdGlwbGllcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbXVsdGlwbGllcnMucHVzaChfbXVsdGlwbGllcnNbaV0pOwogICAgICAgICAgICBpZiAobGFzdE11bHRpcGxpZXIgPD0gX211bHRpcGxpZXJzW2ldKSByZXZlcnQoKTsKICAgICAgICAgICAgbGFzdE11bHRpcGxpZXIgPSBfbXVsdGlwbGllcnNbaV07CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRNaW5CZXQodWludCBfbWluQmV0KSBvbmx5T3duZXIgewogICAgICAgIG1pbkJldCA9IF9taW5CZXQ7CiAgICB9CiAgICAKICAgIC8vIEdFVFRFUlMgLSBDT05TVEFOVCBNRVRIT0RTCiAgICAKICAgIGZ1bmN0aW9uIGdldFNwaW5zQ29udGFpbmVyKGJ5dGVzMzIgbXlpZCkKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMoYWRkcmVzcywgdWludCkgewogICAgICAgIHJldHVybiAoc3BpbnNbbXlpZF0ucGxheWVyQWRkcmVzcywgc3BpbnNbbXlpZF0uYW1vdW50V2FnZXJlZCk7IAogICAgfQoKICAgIC8vIFJldHVybnMgbWluaW1hbCBhbW91bnQgdG8gd2FnZXIgdG8gcmV0dXJuIGEgcHJvZml0IGluIGNhc2Ugb2YgbWF4IHdpbgogICAgZnVuY3Rpb24gZ2V0TWluQW1vdW50VG9XYWdlcih1aW50IF9uU3BpbnMpCiAgICAgICAgb25seUxlc3NUaGFuTWF4U3BpbnMoX25TcGlucykKICAgICAgICBjb25zdGFudAoJCXJldHVybnModWludCkgewogICAgICAgIHVpbnQgZ2FzID0gX25TcGlucypPUkFDTElaRV9QRVJfU1BJTl9HQVNfTElNSVQgKyBPUkFDTElaRV9CQVNFX0dBU19MSU1JVCArIHNhZmVHYXM7CiAgICAgICAgdWludCBvcmFjbGl6ZUZlZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKS5nZXRQcmljZSgicmFuZG9tIiwgZ2FzKTsKICAgICAgICByZXR1cm4gbWluQmV0ICsgb3JhY2xpemVGZWUvbXVsdGlwbGllcnNbMF0gKyBvcmFjbGl6ZUZlZTsKICAgIH0KICAgCiAgICBmdW5jdGlvbiBnZXRNYXhBbW91bnRUb1dhZ2VyKHVpbnQgX25TcGlucykKICAgICAgICBvbmx5TGVzc1RoYW5NYXhTcGlucyhfblNwaW5zKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50KSB7CgogICAgICAgIHVpbnQgb3JhY2xpemVGZWUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSkuZ2V0UHJpY2UoInJhbmRvbSIsIF9uU3BpbnMqT1JBQ0xJWkVfUEVSX1NQSU5fR0FTX0xJTUlUICsgT1JBQ0xJWkVfQkFTRV9HQVNfTElNSVQgKyBzYWZlR2FzKTsKICAgICAgICB1aW50IG1heFdhZ2UgPSAgKENBUElUQUxfUklTSyAqIGdldEJhbmtyb2xsKCkpKjEwMDAwLygoMTAwMDAgLSBJTlZFU1RPUlNfRURHRSkqMTAwMDAqbXVsdGlwbGllcnNbMF0pOwogICAgICAgIHJldHVybiBtYXhXYWdlICsgb3JhY2xpemVGZWU7CiAgICB9CiAgICAKfQ=='.
	

]
