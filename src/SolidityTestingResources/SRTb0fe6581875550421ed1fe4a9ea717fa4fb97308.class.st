Class {
	#name : #SRTb0fe6581875550421ed1fe4a9ea717fa4fb97308,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb0fe6581875550421ed1fe4a9ea717fa4fb97308 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogIE1pbnRhYmxlVG9rZW4gcHVibGljIHRva2VuOwoKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogIC8vIGhvdyBtYW55IHRva2VuIHVuaXRzIGEgYnV5ZXIgZ2V0cyBwZXIgd2VpCiAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfcmF0ZSwgYWRkcmVzcyBfd2FsbGV0KSBwdWJsaWMgewogICAgcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICByZXF1aXJlKF9lbmRUaW1lID49IF9zdGFydFRpbWUpOwogICAgcmVxdWlyZShfcmF0ZSA+IDApOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOwogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHJhdGUgPSBfcmF0ZTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgfQoKICAvLyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zCiAgZnVuY3Rpb24gKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICBidXlUb2tlbnMobXNnLnNlbmRlcik7CiAgfQoKICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgIHVpbnQyNTYgdG9rZW5zID0gZ2V0VG9rZW5BbW91bnQod2VpQW1vdW50KTsKCiAgICAvLyB1cGRhdGUgc3RhdGUKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwoKICAgIGZvcndhcmRGdW5kcygpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBldmVudCBoYXMgZW5kZWQKICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBub3cgPiBlbmRUaW1lOwogIH0KCiAgLy8gY3JlYXRlcyB0aGUgdG9rZW4gdG8gYmUgc29sZC4KICAvLyBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byBoYXZlIGNyb3dkc2FsZSBvZiBhIHNwZWNpZmljIG1pbnRhYmxlIHRva2VuLgogIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zIChNaW50YWJsZVRva2VuKSB7CiAgICByZXR1cm4gbmV3IE1pbnRhYmxlVG9rZW4oKTsKICB9CgogIC8vIE92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGhhdmUgYSB3YXkgdG8gYWRkIGJ1c2luZXNzIGxvZ2ljIHRvIHlvdXIgY3Jvd2RzYWxlIHdoZW4gYnV5aW5nCiAgZnVuY3Rpb24gZ2V0VG9rZW5BbW91bnQodWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICByZXR1cm4gd2VpQW1vdW50Lm11bChyYXRlKTsKICB9CgogIC8vIHNlbmQgZXRoZXIgdG8gdGhlIGZ1bmQgY29sbGVjdGlvbiB3YWxsZXQKICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewogICAgd2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgfQoKICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCB3aXRoaW5QZXJpb2QgPSBub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lOwogICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgIHJldHVybiB3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlOwogIH0KCn0KCmNvbnRyYWN0IENhcHBlZENyb3dkc2FsZSBpcyBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICB1aW50MjU2IHB1YmxpYyBjYXA7CgogIGZ1bmN0aW9uIENhcHBlZENyb3dkc2FsZSh1aW50MjU2IF9jYXApIHB1YmxpYyB7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIGNhcCA9IF9jYXA7CiAgfQoKICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSNoYXNFbmRlZCB0byBhZGQgY2FwIGxvZ2ljCiAgLy8gQHJldHVybiB0cnVlIGlmIGNyb3dkc2FsZSBldmVudCBoYXMgZW5kZWQKICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgY2FwUmVhY2hlZCA9IHdlaVJhaXNlZCA+PSBjYXA7CiAgICByZXR1cm4gY2FwUmVhY2hlZCB8fCBzdXBlci5oYXNFbmRlZCgpOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjdmFsaWRQdXJjaGFzZSB0byBhZGQgZXh0cmEgY2FwIGxvZ2ljCiAgLy8gQHJldHVybiB0cnVlIGlmIGludmVzdG9ycyBjYW4gYnV5IGF0IHRoZSBtb21lbnQKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpbkNhcCA9IHdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKSA8PSBjYXA7CiAgICByZXR1cm4gd2l0aGluQ2FwICYmIHN1cGVyLnZhbGlkUHVyY2hhc2UoKTsKICB9Cgp9CgpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgLyoqCiAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgRmluYWxpemFibGVDYXBwZWRDcm93ZHNhbGUgaXMgQ2FwcGVkQ3Jvd2RzYWxlLCBPd25hYmxlIHsKCiAgICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgcmVjb25jaWxpYXRpb25EYXRlU2V0ID0gZmFsc2U7CiAgICB1aW50IHB1YmxpYyByZWNvbmNpbGlhdGlvbkRhdGUgPSAwOwoKICAgIGV2ZW50IEZpbmFsaXplZCgpOwoKICAgIC8qKgogICAgKiBAZGV2IE11c3QgYmUgY2FsbGVkIGFmdGVyIGNyb3dkc2FsZSBlbmRzLCB0byBkbyBzb21lIGV4dHJhIGZpbmFsaXphdGlvbgogICAgKiB3b3JrLiBDYWxscyB0aGUgY29udHJhY3QncyBmaW5hbGl6YXRpb24gZnVuY3Rpb24uCiAgICAqLwogICAgZnVuY3Rpb24gZmluYWxpemUoKSBvbmx5T3duZXJPckFmdGVyUmVjb25jaWxpYXRpb24gcHVibGljIHsKICAgICAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CiAgICAgICAgcmVxdWlyZShoYXNFbmRlZCgpKTsKCiAgICAgICAgZmluYWxpemF0aW9uKCk7CiAgICAgICAgRmluYWxpemVkKCk7CiAgICAgICAgaXNGaW5hbGl6ZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFJlY29uY2lsaWF0aW9uRGF0ZSh1aW50IF9yZWNvbmNpbGlhdGlvbkRhdGUpIG9ubHlPd25lciB7CiAgICAgICAgcmVjb25jaWxpYXRpb25EYXRlID0gX3JlY29uY2lsaWF0aW9uRGF0ZTsKICAgICAgICByZWNvbmNpbGlhdGlvbkRhdGVTZXQgPSB0cnVlOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENhbiBiZSBvdmVycmlkZGVuIHRvIGFkZCBmaW5hbGl6YXRpb24gbG9naWMuIFRoZSBvdmVycmlkaW5nIGZ1bmN0aW9uCiAgICAqIHNob3VsZCBjYWxsIHN1cGVyLmZpbmFsaXphdGlvbigpIHRvIGVuc3VyZSB0aGUgY2hhaW4gb2YgZmluYWxpemF0aW9uIGlzCiAgICAqIGV4ZWN1dGVkIGVudGlyZWx5LgogICAgKi8KICAgIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXJPckFmdGVyUmVjb25jaWxpYXRpb24oKXsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgKHJlY29uY2lsaWF0aW9uRGF0ZSA8PSBub3cgJiYgcmVjb25jaWxpYXRpb25EYXRlU2V0KSk7CiAgICAgICAgXzsKICAgIH0KCn0KCmNvbnRyYWN0IFBvb2xTZWdyZWdhdGlvbkNyb3dkc2FsZSBpcyBPd25hYmxlIHsKICAgIC8qKgogICAgKiB3ZSBpbmNsdWRlIHRoZSBjcm93ZHNhbGUgZXZlbnRob3VnaCB0aGlzIGlzIG5vdCB0cmVhdGVkIGluIHRoaXMgY29udHJhY3QgKHplcHBlbGluJ3MgQ2FwcGVkQ3Jvd2RzYWxlICkKICAgICovCiAgICBlbnVtIFBPT0xTIHtQT09MX1NUUkFURUdJQ19JTlZFU1RPUlMsIFBPT0xfQ09NUEFOWV9SRVNFUlZFLCBQT09MX1VTRVJfQURPUFRJT04sIFBPT0xfVEVBTSwgUE9PTF9BRFZJU09SUywgUE9PTF9QUk9NT30KCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBtYXBwaW5nICh1aW50ID0+IFBvb2xJbmZvKSBwb29sTWFwOwoKICAgIHN0cnVjdCBQb29sSW5mbyB7CiAgICAgICAgdWludCBjb250cmlidXRpb247CiAgICAgICAgdWludCBwb29sQ2FwOwogICAgfQoKICAgIGZ1bmN0aW9uIFBvb2xTZWdyZWdhdGlvbkNyb3dkc2FsZSh1aW50IF9jYXApIHsKICAgICAgICBwb29sTWFwW3VpbnQoUE9PTFMuUE9PTF9TVFJBVEVHSUNfSU5WRVNUT1JTKV0gPSBQb29sSW5mbygwLCBfY2FwLm11bCgyODUpLmRpdigxMDAwKSk7CiAgICAgICAgcG9vbE1hcFt1aW50KFBPT0xTLlBPT0xfQ09NUEFOWV9SRVNFUlZFKV0gPSBQb29sSW5mbygwLCBfY2FwLm11bCgxMCkuZGl2KDEwMCkpOwogICAgICAgIHBvb2xNYXBbdWludChQT09MUy5QT09MX1VTRVJfQURPUFRJT04pXSA9IFBvb2xJbmZvKDAsIF9jYXAubXVsKDIwKS5kaXYoMTAwKSk7CiAgICAgICAgcG9vbE1hcFt1aW50KFBPT0xTLlBPT0xfVEVBTSldID0gUG9vbEluZm8oMCwgX2NhcC5tdWwoMykuZGl2KDEwMCkpOwogICAgICAgIHBvb2xNYXBbdWludChQT09MUy5QT09MX0FEVklTT1JTKV0gPSBQb29sSW5mbygwLCBfY2FwLm11bCgzKS5kaXYoMTAwKSk7CiAgICAgICAgcG9vbE1hcFt1aW50KFBPT0xTLlBPT0xfUFJPTU8pXSA9IFBvb2xJbmZvKDAsIF9jYXAubXVsKDMpLmRpdigxMDApKTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5SWZJblBvb2wodWludCBhbW91bnQsIHVpbnQgcG9vbElkKSB7CiAgICAgICAgUG9vbEluZm8gcG9vbEluZm8gPSBwb29sTWFwW3Bvb2xJZF07CiAgICAgICAgcmVxdWlyZShwb29sSW5mby5jb250cmlidXRpb24uYWRkKGFtb3VudCkgPD0gcG9vbEluZm8ucG9vbENhcCk7IAogICAgICAgIF87CiAgICAgICAgcG9vbEluZm8uY29udHJpYnV0aW9uID0gcG9vbEluZm8uY29udHJpYnV0aW9uLmFkZChhbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyUmVtYWluaW5nVG9rZW5zVG9Vc2VyQWRvcHRpb25Qb29sKHVpbnQgZGlmZmVyZW5jZSkgaW50ZXJuYWwgewogICAgICAgIHBvb2xNYXBbdWludChQT09MUy5QT09MX1VTRVJfQURPUFRJT04pXS5wb29sQ2FwID0gcG9vbE1hcFt1aW50KFBPT0xTLlBPT0xfVVNFUl9BRE9QVElPTildLnBvb2xDYXAuYWRkKGRpZmZlcmVuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFBvb2xDYXBTaXplKHVpbnQgcG9vbElkKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gcG9vbE1hcFtwb29sSWRdLnBvb2xDYXA7CiAgICB9Cgp9Cgpjb250cmFjdCBMdWNrQ2FzaENyb3dkc2FsZSBpcyBGaW5hbGl6YWJsZUNhcHBlZENyb3dkc2FsZSwgUG9vbFNlZ3JlZ2F0aW9uQ3Jvd2RzYWxlIHsKCiAgICAvLyB3aGl0ZWxpc3QgcmVnaXN0cnkgY29udHJhY3QKICAgIFdoaXRlTGlzdFJlZ2lzdHJ5IHB1YmxpYyB3aGl0ZWxpc3RSZWdpc3RyeTsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogICAgdWludCBjb25zdGFudCBwdWJsaWMgQ0FQID0gNjAwMDAwMDAwKjFlMTg7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGNvbnRyaWJ1dGlvbnM7CgogICAgLyoqCiAgICogZXZlbnQgZm9yIHRva2VuIHZlc3QgZnVuZCBsYXVuY2gKICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgd2hvIHdpbGwgZ2V0IHRoZSB0b2tlbnMgb25jZSB0aGV5IGFyZSB2ZXN0ZWQKICAgKiBAcGFyYW0gZnVuZCB2ZXN0IGZ1bmQgdGhhdCB3aWxsIHJlY2VpdmVkIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdG9rZW5BbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICAgIGV2ZW50IFZlc3RlZFRva2Vuc0ZvcihhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIGFkZHJlc3MgZnVuZCwgdWludDI1NiB0b2tlbkFtb3VudCk7CiAgICAvKioKICAgICogZXZlbnQgZm9yIGZpbmFsaXplIGZ1bmN0aW9uIGNhbGwgYXQgdGhlIGVuZCBvZiB0aGUgY3Jvd2RzYWxlCiAgICAqLwogICAgZXZlbnQgRmluYWxpemVkKCk7ICAgIAoKICAgIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBtaW50aW5nIGZvciBwcml2YXRlIGludmVzdG9ycwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gd2lsbCBnZXQgdGhlIHRva2VucyBvbmNlIHRoZXkgYXJlIHZlc3RlZAogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAqLwogICAgZXZlbnQgTWludGVkVG9rZW5zRm9yKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB0b2tlbkFtb3VudCk7CgogICAgLyoqCiAgICAgKiBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0gX3N0YXJ0VGltZSBUaGUgdGltZXN0YW1wIG9mIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGNyb3dkc2FsZQogICAgICogQHBhcmFtIF9lbmRUaW1lIFRpbWVzdGFtcCB3aGVuIHRoZSBjcm93ZHNhbGUgd2lsbCBmaW5pc2gKICAgICAqIEBwYXJhbSBfcmF0ZSBUaGUgdG9rZW4gcmF0ZSBwZXIgRVRICiAgICAgKiBQZXJjZW50IHZhbHVlIGlzIHNhdmVkIGluIGNyb3dkc2FsZVBlcmNlbnQuCiAgICAgKiBAcGFyYW0gX3dhbGxldCBNdWx0aXNpZyB3YWxsZXQgdGhhdCB3aWxsIGhvbGQgdGhlIGNyb3dkc2FsZSBmdW5kcy4KICAgICAqIEBwYXJhbSBfd2hpdGVMaXN0UmVnaXN0cnkgQWRkcmVzcyBvZiB0aGUgd2hpdGVsaXN0IHJlZ2lzdHJ5IGNvbnRyYWN0CiAgICAgKi8KICAgIGZ1bmN0aW9uIEx1Y2tDYXNoQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfcmF0ZSwgYWRkcmVzcyBfd2FsbGV0LCBhZGRyZXNzIF93aGl0ZUxpc3RSZWdpc3RyeSkgcHVibGljCiAgICBDYXBwZWRDcm93ZHNhbGUoQ0FQLm11bCgzMjUpLmRpdigxMDAwKSkKICAgIFBvb2xTZWdyZWdhdGlvbkNyb3dkc2FsZShDQVApCiAgICBGaW5hbGl6YWJsZUNhcHBlZENyb3dkc2FsZSgpCiAgICBDcm93ZHNhbGUoX3N0YXJ0VGltZSwgX2VuZFRpbWUsIF9yYXRlLCBfd2FsbGV0KQogICAgewogICAgICAgIHJlcXVpcmUoX3doaXRlTGlzdFJlZ2lzdHJ5ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHdoaXRlbGlzdFJlZ2lzdHJ5ID0gV2hpdGVMaXN0UmVnaXN0cnkoX3doaXRlTGlzdFJlZ2lzdHJ5KTsKICAgICAgICBMdWNrQ2FzaFRva2VuKHRva2VuKS5wYXVzZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDcmVhdGVzIEx1Y2tDYXNoVG9rZW4gY29udHJhY3QuIFRoaXMgaXMgY2FsbGVkIG9uIHRoZSBDcm93ZHNhbGUgY29udHJhY3QgY29uc3RydWN0b3IgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSBpbnRlcm5hbCByZXR1cm5zKE1pbnRhYmxlVG9rZW4pIHsKICAgICAgICByZXR1cm4gbmV3IEx1Y2tDYXNoVG9rZW4oQ0FQKTsgLy8gNjAwIG1pbGxpb24gY2FwCiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1pbnRlcyBmcmVzaCB0b2tlbiBmb3IgYSBwcml2YXRlIGludmVzdG9yLgogICAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IFRoZSBiZW5lZmljaWFyeSBvZiB0aGUgbWludGluZwogICAgICogQHBhcmFtIGFtb3VudCBUaGUgdG90YWwgdG9rZW4gYW1vdW50IHRvIGJlIG1pbnRlZAogICAgICovCiAgICBmdW5jdGlvbiBtaW50VG9rZW5zRm9yKGFkZHJlc3MgYmVuZWZpY2lhcnksIHVpbnQyNTYgYW1vdW50LCB1aW50IHBvb2xJZCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJZkluUG9vbChhbW91bnQsIHBvb2xJZCkgewogICAgICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSAmJiBhbW91bnQgIT0gMCk7CiAgICAgICAgLy8gcmVxdWlyZShub3cgPD0gZW5kVGltZSk7CgogICAgICAgIHRva2VuLm1pbnQoYmVuZWZpY2lhcnksIGFtb3VudCk7CgogICAgICAgIE1pbnRlZFRva2Vuc0ZvcihiZW5lZmljaWFyeSwgYW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlcyBhIG5ldyBjb250cmFjdCBmb3IgYSB2ZXN0aW5nIGZ1bmQgdGhhdCB3aWxsIHJlbGVhc2UgZnVuZHMgZm9yIHRoZSBiZW5lZmljaWFyeSBldmVyeSBxdWFydGVyCiAgICAgKiBAcGFyYW0gYmVuZWZpY2lhcnkgVGhlIGJlbmVmaWNpYXJ5IG9mIHRoZSBmdW5kcwogICAgICogQHBhcmFtIGFtb3VudCBUaGUgdG90YWwgdG9rZW4gYW1vdW50IHRvIGJlIHZlc3RlZAogICAgICogQHBhcmFtIHF1YXJ0ZXJzIFRoZSBudW1iZXIgb2YgcXVhcnRlcnMgb3ZlciB3aGljaCB0aGUgZnVuZHMgd2lsbCB2ZXN0LiBFdmVyeSBxdWFydGVyIGEgc3VtIGVxdWFsIHRvIGFtb3VudC5xdWFydGVycyB3aWxsIGJlIHJlbGVhc2UKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlVmVzdEZ1bmRGb3IoYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgcXVhcnRlcnMsIHVpbnQgcG9vbElkKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUlmSW5Qb29sKGFtb3VudCwgcG9vbElkKSB7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApICYmIGFtb3VudCAhPSAwKTsKICAgICAgICByZXF1aXJlKHF1YXJ0ZXJzID4gMCk7CiAgICAgICAgLy8gcmVxdWlyZShub3cgPD0gZW5kVGltZSk7CgogICAgICAgIFZlc3RpbmdGdW5kIGZ1bmQgPSBuZXcgVmVzdGluZ0Z1bmQoYmVuZWZpY2lhcnksIGVuZFRpbWUsIHF1YXJ0ZXJzLCB0b2tlbik7IC8vIHRoZSB2ZXN0aW5nIHBlcmlvZCBzdGFydHMgd2hlbiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZAogICAgICAgIHRva2VuLm1pbnQoZnVuZCwgYW1vdW50KTsKCiAgICAgICAgVmVzdGVkVG9rZW5zRm9yKGJlbmVmaWNpYXJ5LCBmdW5kLCBhbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBvdmVycmlkZXMgQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gYWRkIHdoaXRlbGlzdCBsb2dpYwogICAgICogQHJldHVybiB0cnVlIGlmIGJ1eWVycyBpcyBhYmxlIHRvIGJ1eSBhdCB0aGUgbW9tZW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci52YWxpZFB1cmNoYXNlKCkgJiYgY2FuQ29udHJpYnV0ZUFtb3VudChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbUNyb3dkc2FsZVRvVXNlckFkb3B0aW9uUG9vbCgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobm93ID4gZW5kVGltZSk7CiAgICAgICAgCiAgICAgICAgc3VwZXIudHJhbnNmZXJSZW1haW5pbmdUb2tlbnNUb1VzZXJBZG9wdGlvblBvb2woc3VwZXIuZ2V0VG9rZW5BbW91bnQoY2FwKSAtIHN1cGVyLmdldFRva2VuQW1vdW50KHdlaVJhaXNlZCkpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgZmluYWxpemVzIGNyb3dkc2FsZQogICAgICovIAogICAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewogICAgICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKICAgICAgICBMdWNrQ2FzaFRva2VuKHRva2VuKS51bnBhdXNlKCk7CgogICAgICAgIHdhbGxldC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwoKICAgICAgICBzdXBlci5maW5hbGl6YXRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgb3ZlcnJpZGVzIENyb3dkc2FsZSNmb3J3YXJkRnVuZHMgdG8gcmVwb3J0IG9mIGZ1bmRzIHRyYW5zZmVyIGFuZCBub3QgdHJhbnNmZXIgaW50byB0aGUgd2FsbGV0IHVudGlsbCB0aGUgZW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgICAgICByZXBvcnRDb250cmlidXRpb24obXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5Db250cmlidXRlQW1vdW50KGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50IF9hbW91bnQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgdG90YWxBbW91bnQgPSBjb250cmlidXRpb25zW19jb250cmlidXRvcl0uYWRkKF9hbW91bnQpOwogICAgICAgIHJldHVybiB3aGl0ZWxpc3RSZWdpc3RyeS5pc0Ftb3VudEFsbG93ZWQoX2NvbnRyaWJ1dG9yLCB0b3RhbEFtb3VudCk7ICAKICAgIH0KCiAgICBmdW5jdGlvbiByZXBvcnRDb250cmlidXRpb24oYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQgX2Ftb3VudCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgY29udHJpYnV0aW9uc1tfY29udHJpYnV0b3JdID0gY29udHJpYnV0aW9uc1tfY29udHJpYnV0b3JdLmFkZChfYW1vdW50KTsKICAgIH0KCn0KCmNvbnRyYWN0IFZlc3RpbmdGdW5kIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgZXZlbnQgUmVsZWFzZWQodWludDI1NiBhbW91bnQpOwoKICAvLyBiZW5lZmljaWFyeSBvZiB0b2tlbnMgYWZ0ZXIgdGhleSBhcmUgcmVsZWFzZWQKICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsKICBFUkMyMEJhc2ljIHB1YmxpYyB0b2tlbjsKCiAgdWludDI1NiBwdWJsaWMgcXVhcnRlcnM7CiAgdWludDI1NiBwdWJsaWMgc3RhcnQ7CgoKICB1aW50MjU2IHB1YmxpYyByZWxlYXNlZDsKCiAgLyoqCiAgICogQGRldiBDcmVhdGVzIGEgdmVzdGluZyBjb250cmFjdCB0aGF0IHZlc3RzIGl0cyBiYWxhbmNlIG9mIGFueSBFUkMyMCB0b2tlbiB0byB0aGUKICAgKiBfYmVuZWZpY2lhcnksIHRva2VucyBhcmUgcmVsZWFzZSBpbiBhbiBpbmNyZW1lbnRhbCBmYXNoaW9uIGFmdGVyIGEgcXVhdGVyIGhhcyBwYXNzZWQgdW50aWwgX3N0YXJ0ICsgX3F1YXJ0ZXJzICogMyAqIG1vbnRocy4gCiAgICogQnkgdGhlbiBhbGwgb2YgdGhlIGJhbGFuY2Ugd2lsbCBoYXZlIHZlc3RlZC4KICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IGFkZHJlc3Mgb2YgdGhlIGJlbmVmaWNpYXJ5IHRvIHdob20gdmVzdGVkIHRva2VucyBhcmUgdHJhbnNmZXJyZWQKICAgKiBAcGFyYW0gX3F1YXJ0ZXJzIG51bWJlciBvZiBxdWFydGVycyB0aGUgdmVzdGluZyB3aWxsIGxhc3QKICAgKiBAcGFyYW0gX3Rva2VuIEVSQzIwIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIFZlc3RpbmdGdW5kKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9zdGFydCwgdWludDI1NiBfcXVhcnRlcnMsIGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgewogICAgCiAgICByZXF1aXJlKF9iZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApICYmIF90b2tlbiAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3F1YXJ0ZXJzID4gMCk7CgogICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICBxdWFydGVycyA9IF9xdWFydGVyczsKICAgIHN0YXJ0ID0gX3N0YXJ0OwogICAgdG9rZW4gPSBFUkMyMEJhc2ljKF90b2tlbik7CiAgfQoKICAvKioKICAgKiBAbm90aWNlIFRyYW5zZmVycyB2ZXN0ZWQgdG9rZW5zIHRvIGJlbmVmaWNpYXJ5LgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2UoKSBwdWJsaWMgewogICAgdWludDI1NiB1bnJlbGVhc2VkID0gcmVsZWFzYWJsZUFtb3VudCgpOwogICAgcmVxdWlyZSh1bnJlbGVhc2VkID4gMCk7CgogICAgcmVsZWFzZWQgPSByZWxlYXNlZC5hZGQodW5yZWxlYXNlZCk7CiAgICB0b2tlbi5zYWZlVHJhbnNmZXIoYmVuZWZpY2lhcnksIHVucmVsZWFzZWQpOwoKICAgIFJlbGVhc2VkKHVucmVsZWFzZWQpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGVzIHRoZSBhbW91bnQgdGhhdCBoYXMgYWxyZWFkeSB2ZXN0ZWQgYnV0IGhhc24ndCBiZWVuIHJlbGVhc2VkIHlldC4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNhYmxlQW1vdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICByZXR1cm4gdmVzdGVkQW1vdW50KCkuc3ViKHJlbGVhc2VkKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlcyB0aGUgYW1vdW50IHRoYXQgaGFzIGFscmVhZHkgdmVzdGVkLgogICAqLwogIGZ1bmN0aW9uIHZlc3RlZEFtb3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NikgewogICAgdWludDI1NiBjdXJyZW50QmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHVpbnQyNTYgdG90YWxCYWxhbmNlID0gY3VycmVudEJhbGFuY2UuYWRkKHJlbGVhc2VkKTsKCiAgICBpZiAobm93IDwgc3RhcnQpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdWludDI1NiBkVCA9IG5vdy5zdWIoc3RhcnQpOyAvLyB0aW1lIHBhc3NlZCBzaW5jZSBzdGFydAogICAgdWludDI1NiBkUXVhcnRlcnMgPSBkVC5kaXYoOTAgZGF5cyk7IC8vIHF1YXJ0ZXJzIHBhc3NlZAoKICAgIGlmIChkUXVhcnRlcnMgPj0gcXVhcnRlcnMpIHsKICAgICAgcmV0dXJuIHRvdGFsQmFsYW5jZTsgLy8gcmV0dXJuIGV2ZXJ5dGhpbmcgaWYgdmVzdGluZyBwZXJpb2QgZW5kZWQKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0b3RhbEJhbGFuY2UubXVsKGRRdWFydGVycykuZGl2KHF1YXJ0ZXJzKTsgLy8gYW1tb3VudCA9IHRvdGFsICogKHF1YXJ0ZXJzIHBhc3NlZCAvIHRvdGFsIHF1YXJ0ZXJzKQogICAgfQogIH0KfQoKY29udHJhY3QgV2hpdGVMaXN0UmVnaXN0cnkgaXMgT3duYWJsZSB7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBXaGl0ZUxpc3RJbmZvKSBwdWJsaWMgd2hpdGVsaXN0OwogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgc3RydWN0IFdoaXRlTGlzdEluZm8gewogICAgICAgIGJvb2wgd2hpdGVMaXN0ZWQ7CiAgICAgICAgdWludCBtaW5DYXA7CiAgICAgICAgdWludCBtYXhDYXA7CiAgICB9CgogICAgZXZlbnQgQWRkZWRUb1doaXRlTGlzdCgKICAgICAgICBhZGRyZXNzIGNvbnRyaWJ1dG9yLAogICAgICAgIHVpbnQgbWluQ2FwLAogICAgICAgIHVpbnQgbWF4Q2FwCiAgICApOwoKICAgIGV2ZW50IFJlbW92ZWRGcm9tV2hpdGVMaXN0KAogICAgICAgIGFkZHJlc3MgX2NvbnRyaWJ1dG9yCiAgICApOwoKICAgIGZ1bmN0aW9uIGFkZFRvV2hpdGVMaXN0KGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50IF9taW5DYXAsIHVpbnQgX21heENhcCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfY29udHJpYnV0b3IgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgd2hpdGVsaXN0W19jb250cmlidXRvcl0gPSBXaGl0ZUxpc3RJbmZvKHRydWUsIF9taW5DYXAsIF9tYXhDYXApOwogICAgICAgIEFkZGVkVG9XaGl0ZUxpc3QoX2NvbnRyaWJ1dG9yLCBfbWluQ2FwLCBfbWF4Q2FwKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVGcm9tV2hpdGVMaXN0KGFkZHJlc3MgX2NvbnRyaWJ1dG9yKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9jb250cmlidXRvciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBkZWxldGUgd2hpdGVsaXN0W19jb250cmlidXRvcl07CiAgICAgICAgUmVtb3ZlZEZyb21XaGl0ZUxpc3QoX2NvbnRyaWJ1dG9yKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1doaXRlTGlzdGVkKGFkZHJlc3MgX2NvbnRyaWJ1dG9yKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gd2hpdGVsaXN0W19jb250cmlidXRvcl0ud2hpdGVMaXN0ZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gaXNBbW91bnRBbGxvd2VkKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50IF9hbW91bnQpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgcmV0dXJuIHdoaXRlbGlzdFtfY29udHJpYnV0b3JdLm1heENhcCA+PSBfYW1vdW50ICYmIHdoaXRlbGlzdFtfY29udHJpYnV0b3JdLm1pbkNhcCA8PSBfYW1vdW50ICYmIGlzV2hpdGVMaXN0ZWQoX2NvbnRyaWJ1dG9yKTsKICAgIH0KCn0KCmNvbnRyYWN0IEZpbmFsaXphYmxlQ3Jvd2RzYWxlIGlzIENyb3dkc2FsZSwgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CgogIGV2ZW50IEZpbmFsaXplZCgpOwoKICAvKioKICAgKiBAZGV2IE11c3QgYmUgY2FsbGVkIGFmdGVyIGNyb3dkc2FsZSBlbmRzLCB0byBkbyBzb21lIGV4dHJhIGZpbmFsaXphdGlvbgogICAqIHdvcmsuIENhbGxzIHRoZSBjb250cmFjdCdzIGZpbmFsaXphdGlvbiBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZShoYXNFbmRlZCgpKTsKCiAgICBmaW5hbGl6YXRpb24oKTsKICAgIEZpbmFsaXplZCgpOwoKICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FuIGJlIG92ZXJyaWRkZW4gdG8gYWRkIGZpbmFsaXphdGlvbiBsb2dpYy4gVGhlIG92ZXJyaWRpbmcgZnVuY3Rpb24KICAgKiBzaG91bGQgY2FsbCBzdXBlci5maW5hbGl6YXRpb24oKSB0byBlbnN1cmUgdGhlIGNoYWluIG9mIGZpbmFsaXphdGlvbiBpcwogICAqIGV4ZWN1dGVkIGVudGlyZWx5LgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICB9Cn0KCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgdWludDI1NiB0b3RhbFN1cHBseV87CgogIC8qKgogICogQGRldiB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIGluIGV4aXN0ZW5jZQogICovCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG90YWxTdXBwbHlfOwogIH0KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmxpYnJhcnkgU2FmZUVSQzIwIHsKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXIoRVJDMjBCYXNpYyB0b2tlbiwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbShFUkMyMCB0b2tlbiwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZUFwcHJvdmUoRVJDMjAgdG9rZW4sIGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpKTsKICB9Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICoKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX2FkZGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaW5jcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IERlY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICoKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBkZWNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3N1YnRyYWN0ZWRWYWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBkZWNyZWFzZSB0aGUgYWxsb3dhbmNlIGJ5LgogICAqLwogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHRvdGFsU3VwcGx5XyA9IHRvdGFsU3VwcGx5Xy5hZGQoX2Ftb3VudCk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Cgpjb250cmFjdCBDYXBwZWRUb2tlbiBpcyBNaW50YWJsZVRva2VuIHsKCiAgdWludDI1NiBwdWJsaWMgY2FwOwoKICBmdW5jdGlvbiBDYXBwZWRUb2tlbih1aW50MjU2IF9jYXApIHB1YmxpYyB7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIGNhcCA9IF9jYXA7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSh0b3RhbFN1cHBseV8uYWRkKF9hbW91bnQpIDw9IGNhcCk7CgogICAgcmV0dXJuIHN1cGVyLm1pbnQoX3RvLCBfYW1vdW50KTsKICB9Cgp9Cgpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmV0dXJuIHN1cGVyLmluY3JlYXNlQXBwcm92YWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICB9Cn0KCmNvbnRyYWN0IEx1Y2tDYXNoVG9rZW4gaXMgUGF1c2FibGVUb2tlbiwgQ2FwcGVkVG9rZW4gewogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkx1Y2tDYXNoIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkxDSyI7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICBmdW5jdGlvbiBMdWNrQ2FzaFRva2VuKHVpbnQgX2NhcCkgcHVibGljIENhcHBlZFRva2VuKF9jYXApIFBhdXNhYmxlVG9rZW4oKSB7CgogICAgfQp9'.
	

]
