Class {
	#name : #SRTd4AF09F41C674141e9F8c1ce2883F08ECAfd6649,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd4AF09F41C674141e9F8c1ce2883F08ECAfd6649 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBVdGlscyB7CgogICAgRVJDMjAgY29uc3RhbnQgaW50ZXJuYWwgRVRIX1RPS0VOX0FERFJFU1MgPSBFUkMyMCgweDAwZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZSk7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBQUkVDSVNJT04gPSAoMTAqKjE4KTsKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9RVFkgICA9ICgxMCoqMjgpOyAvLyAxQiB0b2tlbnMKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9SQVRFICA9IChQUkVDSVNJT04gKiAxMCoqNik7IC8vIHVwIHRvIDFNIHRva2VucyBwZXIgRVRICiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfREVDSU1BTFMgPSAxODsKCiAgICBmdW5jdGlvbiBjYWxjRHN0UXR5KHVpbnQgc3JjUXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKGRzdERlY2ltYWxzID49IHNyY0RlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIHJldHVybiAoc3JjUXR5ICogcmF0ZSAqICgxMCoqKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpKSkgLyBQUkVDSVNJT047CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgcmV0dXJuIChzcmNRdHkgKiByYXRlKSAvIChQUkVDSVNJT04gKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjU3JjUXR5KHVpbnQgZHN0UXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy9zb3VyY2UgcXVhbnRpdHkgaXMgcm91bmRlZCB1cC4gdG8gYXZvaWQgZGVzdCBxdWFudGl0eSBiZWluZyB0b28gbG93LgogICAgICAgIHVpbnQgbnVtZXJhdG9yOwogICAgICAgIHVpbnQgZGVub21pbmF0b3I7CiAgICAgICAgaWYgKHNyY0RlY2ltYWxzID49IGRzdERlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIG51bWVyYXRvciA9IChQUkVDSVNJT04gKiBkc3RRdHkgKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgICAgICBkZW5vbWluYXRvciA9IHJhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgbnVtZXJhdG9yID0gKFBSRUNJU0lPTiAqIGRzdFF0eSk7CiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gKHJhdGUgKiAoMTAqKihkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKG51bWVyYXRvciArIGRlbm9taW5hdG9yIC0gMSkgLyBkZW5vbWluYXRvcjsgLy9hdm9pZCByb3VuZGluZyBkb3duIGVycm9ycwogICAgfQp9CgppbnRlcmZhY2UgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgZGlnaXRzKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9Cgpjb250cmFjdCBQZXJtaXNzaW9uR3JvdXBzIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbjsKICAgIGFkZHJlc3MgcHVibGljIHBlbmRpbmdBZG1pbjsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgaW50ZXJuYWwgb3BlcmF0b3JzOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBhbGVydGVyczsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBvcGVyYXRvcnNHcm91cDsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBhbGVydGVyc0dyb3VwOwoKICAgIGZ1bmN0aW9uIFBlcm1pc3Npb25Hcm91cHMoKSBwdWJsaWMgewogICAgICAgIGFkbWluID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPcGVyYXRvcigpIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWxlcnRlcigpIHsKICAgICAgICByZXF1aXJlKGFsZXJ0ZXJzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9wZXJhdG9ycyAoKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG9wZXJhdG9yc0dyb3VwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFsZXJ0ZXJzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gYWxlcnRlcnNHcm91cDsKICAgIH0KCiAgICBldmVudCBUcmFuc2ZlckFkbWluUGVuZGluZyhhZGRyZXNzIHBlbmRpbmdBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBhZG1pbiB0byBzZXQgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzLgogICAgICogQHBhcmFtIG5ld0FkbWluIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBZG1pbihhZGRyZXNzIG5ld0FkbWluKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG5ld0FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIFRyYW5zZmVyQWRtaW5QZW5kaW5nKHBlbmRpbmdBZG1pbik7CiAgICAgICAgcGVuZGluZ0FkbWluID0gbmV3QWRtaW47CiAgICB9CgogICAgZXZlbnQgQWRtaW5DbGFpbWVkKCBhZGRyZXNzIG5ld0FkbWluLCBhZGRyZXNzIHByZXZpb3VzQWRtaW4pOwoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSBjaGFuZ2UgYWRtaW4gcHJvY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BZG1pbigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShwZW5kaW5nQWRtaW4gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgQWRtaW5DbGFpbWVkKHBlbmRpbmdBZG1pbiwgYWRtaW4pOwogICAgICAgIGFkbWluID0gcGVuZGluZ0FkbWluOwogICAgICAgIHBlbmRpbmdBZG1pbiA9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZXZlbnQgQWxlcnRlckFkZGVkIChhZGRyZXNzIG5ld0FsZXJ0ZXIsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZEFsZXJ0ZXIoYWRkcmVzcyBuZXdBbGVydGVyKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFhbGVydGVyc1tuZXdBbGVydGVyXSk7IC8vIHByZXZlbnQgZHVwbGljYXRlcy4KICAgICAgICBBbGVydGVyQWRkZWQobmV3QWxlcnRlciwgdHJ1ZSk7CiAgICAgICAgYWxlcnRlcnNbbmV3QWxlcnRlcl0gPSB0cnVlOwogICAgICAgIGFsZXJ0ZXJzR3JvdXAucHVzaChuZXdBbGVydGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVBbGVydGVyIChhZGRyZXNzIGFsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbYWxlcnRlcl0pOwogICAgICAgIGFsZXJ0ZXJzW2FsZXJ0ZXJdID0gZmFsc2U7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsZXJ0ZXJzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKGFsZXJ0ZXJzR3JvdXBbaV0gPT0gYWxlcnRlcikgewogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cFtpXSA9IGFsZXJ0ZXJzR3JvdXBbYWxlcnRlcnNHcm91cC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGFsZXJ0ZXJzR3JvdXAubGVuZ3RoLS07CiAgICAgICAgICAgICAgICBBbGVydGVyQWRkZWQoYWxlcnRlciwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZXZlbnQgT3BlcmF0b3JBZGRlZChhZGRyZXNzIG5ld09wZXJhdG9yLCBib29sIGlzQWRkKTsKCiAgICBmdW5jdGlvbiBhZGRPcGVyYXRvcihhZGRyZXNzIG5ld09wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFvcGVyYXRvcnNbbmV3T3BlcmF0b3JdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIE9wZXJhdG9yQWRkZWQobmV3T3BlcmF0b3IsIHRydWUpOwogICAgICAgIG9wZXJhdG9yc1tuZXdPcGVyYXRvcl0gPSB0cnVlOwogICAgICAgIG9wZXJhdG9yc0dyb3VwLnB1c2gobmV3T3BlcmF0b3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU9wZXJhdG9yIChhZGRyZXNzIG9wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1tvcGVyYXRvcl0pOwogICAgICAgIG9wZXJhdG9yc1tvcGVyYXRvcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3BlcmF0b3JzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKG9wZXJhdG9yc0dyb3VwW2ldID09IG9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvcnNHcm91cFtpXSA9IG9wZXJhdG9yc0dyb3VwW29wZXJhdG9yc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgb3BlcmF0b3JzR3JvdXAubGVuZ3RoIC09IDE7CiAgICAgICAgICAgICAgICBPcGVyYXRvckFkZGVkKG9wZXJhdG9yLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgV2l0aGRyYXdhYmxlIGlzIFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGV2ZW50IFRva2VuV2l0aGRyYXcoRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IGFsbCBFUkMyMCBjb21wYXRpYmxlIHRva2VucwogICAgICogQHBhcmFtIHRva2VuIEVSQzIwIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihzZW5kVG8sIGFtb3VudCkpOwogICAgICAgIFRva2VuV2l0aGRyYXcodG9rZW4sIGFtb3VudCwgc2VuZFRvKTsKICAgIH0KCiAgICBldmVudCBFdGhlcldpdGhkcmF3KHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IEV0aGVycwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBzZW5kVG8udHJhbnNmZXIoYW1vdW50KTsKICAgICAgICBFdGhlcldpdGhkcmF3KGFtb3VudCwgc2VuZFRvKTsKICAgIH0KfQoKY29udHJhY3QgVm9sdW1lSW1iYWxhbmNlUmVjb3JkZXIgaXMgV2l0aGRyYXdhYmxlIHsKCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIFNMSURJTkdfV0lORE9XX1NJWkUgPSA1OwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBQT1dfMl82NCA9IDIgKiogNjQ7CgogICAgc3RydWN0IFRva2VuQ29udHJvbEluZm8gewogICAgICAgIHVpbnQgbWluaW1hbFJlY29yZFJlc29sdXRpb247IC8vIGNhbiBiZSByb3VnaGx5IDEgY2VudAogICAgICAgIHVpbnQgbWF4UGVyQmxvY2tJbWJhbGFuY2U7IC8vIGluIHR3ZWkgcmVzb2x1dGlvbgogICAgICAgIHVpbnQgbWF4VG90YWxJbWJhbGFuY2U7IC8vIG1heCB0b3RhbCBpbWJhbGFuY2UgKGJldHdlZW4gcmF0ZSB1cGRhdGVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmVmb3JlIGhhbHRpbmcgdHJhZGUKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gVG9rZW5Db250cm9sSW5mbykgaW50ZXJuYWwgdG9rZW5Db250cm9sSW5mbzsKCiAgICBzdHJ1Y3QgVG9rZW5JbWJhbGFuY2VEYXRhIHsKICAgICAgICBpbnQgIGxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgIHVpbnQgbGFzdEJsb2NrOwoKICAgICAgICBpbnQgIHRvdGFsQnV5VW5pdHNJbWJhbGFuY2U7CiAgICAgICAgdWludCBsYXN0UmF0ZVVwZGF0ZUJsb2NrOwogICAgfQoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKHVpbnQ9PnVpbnQpKSBwdWJsaWMgdG9rZW5JbWJhbGFuY2VEYXRhOwoKICAgIGZ1bmN0aW9uIFZvbHVtZUltYmFsYW5jZVJlY29yZGVyKGFkZHJlc3MgX2FkbWluKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGFkbWluID0gX2FkbWluOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRva2VuQ29udHJvbEluZm8oCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgdWludCBtaW5pbWFsUmVjb3JkUmVzb2x1dGlvbiwKICAgICAgICB1aW50IG1heFBlckJsb2NrSW1iYWxhbmNlLAogICAgICAgIHVpbnQgbWF4VG90YWxJbWJhbGFuY2UKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5QWRtaW4KICAgIHsKICAgICAgICB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXSA9CiAgICAgICAgICAgIFRva2VuQ29udHJvbEluZm8oCiAgICAgICAgICAgICAgICBtaW5pbWFsUmVjb3JkUmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgIG1heFBlckJsb2NrSW1iYWxhbmNlLAogICAgICAgICAgICAgICAgbWF4VG90YWxJbWJhbGFuY2UKICAgICAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlbkNvbnRyb2xJbmZvKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQsIHVpbnQsIHVpbnQpIHsKICAgICAgICByZXR1cm4gKHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgdG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWF4UGVyQmxvY2tJbWJhbGFuY2UsCiAgICAgICAgICAgICAgICB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5tYXhUb3RhbEltYmFsYW5jZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkSW1iYWxhbmNlKAogICAgICAgIEVSQzIwIHRva2VuLAogICAgICAgIGludCBidXlBbW91bnQsCiAgICAgICAgdWludCByYXRlVXBkYXRlQmxvY2ssCiAgICAgICAgdWludCBjdXJyZW50QmxvY2sKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHVpbnQgY3VycmVudEJsb2NrSW5kZXggPSBjdXJyZW50QmxvY2sgJSBTTElESU5HX1dJTkRPV19TSVpFOwogICAgICAgIGludCByZWNvcmRlZEJ1eUFtb3VudCA9IGludChidXlBbW91bnQgLyBpbnQodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24pKTsKCiAgICAgICAgaW50IHByZXZJbWJhbGFuY2UgPSAwOwoKICAgICAgICBUb2tlbkltYmFsYW5jZURhdGEgbWVtb3J5IGN1cnJlbnRCbG9ja0RhdGEgPQogICAgICAgICAgICBkZWNvZGVUb2tlbkltYmFsYW5jZURhdGEodG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVtjdXJyZW50QmxvY2tJbmRleF0pOwoKICAgICAgICAvLyBmaXJzdCBzY2VuYXJpbyAtIHRoaXMgaXMgbm90IHRoZSBmaXJzdCB0eCBpbiB0aGUgY3VycmVudCBibG9jawogICAgICAgIGlmIChjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9jayA9PSBjdXJyZW50QmxvY2spIHsKICAgICAgICAgICAgaWYgKHVpbnQoY3VycmVudEJsb2NrRGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrKSA9PSByYXRlVXBkYXRlQmxvY2spIHsKICAgICAgICAgICAgICAgIC8vIGp1c3QgaW5jcmVhc2UgaW1iYWxhbmNlCiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlICs9IHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlICs9IHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaW1iYWxhbmNlIHdhcyBjaGFuZ2VkIGluIHRoZSBtaWRkbGUgb2YgdGhlIGJsb2NrCiAgICAgICAgICAgICAgICBwcmV2SW1iYWxhbmNlID0gZ2V0SW1iYWxhbmNlSW5SYW5nZSh0b2tlbiwgcmF0ZVVwZGF0ZUJsb2NrLCBjdXJyZW50QmxvY2spOwogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlID0gaW50KHByZXZJbWJhbGFuY2UpICsgcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlICs9IHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrID0gdWludChyYXRlVXBkYXRlQmxvY2spOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gZmlyc3QgdHggaW4gdGhlIGN1cnJlbnQgYmxvY2sKICAgICAgICAgICAgaW50IGN1cnJlbnRCbG9ja0ltYmFsYW5jZTsKICAgICAgICAgICAgKHByZXZJbWJhbGFuY2UsIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSkgPSBnZXRJbWJhbGFuY2VTaW5jZVJhdGVVcGRhdGUodG9rZW4sIHJhdGVVcGRhdGVCbG9jaywgY3VycmVudEJsb2NrKTsKCiAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgPSByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2sgPSB1aW50KGN1cnJlbnRCbG9jayk7CiAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdFJhdGVVcGRhdGVCbG9jayA9IHVpbnQocmF0ZVVwZGF0ZUJsb2NrKTsKICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlID0gaW50KHByZXZJbWJhbGFuY2UpICsgcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgfQoKICAgICAgICB0b2tlbkltYmFsYW5jZURhdGFbdG9rZW5dW2N1cnJlbnRCbG9ja0luZGV4XSA9IGVuY29kZVRva2VuSW1iYWxhbmNlRGF0YShjdXJyZW50QmxvY2tEYXRhKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRHYXJiYWdlVG9Wb2x1bWVSZWNvcmRlcihFUkMyMCB0b2tlbikgaW50ZXJuYWwgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IFNMSURJTkdfV0lORE9XX1NJWkU7IGkrKykgewogICAgICAgICAgICB0b2tlbkltYmFsYW5jZURhdGFbdG9rZW5dW2ldID0gMHgxOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJbWJhbGFuY2VJblJhbmdlKEVSQzIwIHRva2VuLCB1aW50IHN0YXJ0QmxvY2ssIHVpbnQgZW5kQmxvY2spIGludGVybmFsIHZpZXcgcmV0dXJucyhpbnQgYnV5SW1iYWxhbmNlKSB7CiAgICAgICAgLy8gY2hlY2sgdGhlIGltYmFsYW5jZSBpbiB0aGUgc2xpZGluZyB3aW5kb3cKICAgICAgICByZXF1aXJlKHN0YXJ0QmxvY2sgPD0gZW5kQmxvY2spOwoKICAgICAgICBidXlJbWJhbGFuY2UgPSAwOwoKICAgICAgICBmb3IgKHVpbnQgd2luZG93SW5kID0gMDsgd2luZG93SW5kIDwgU0xJRElOR19XSU5ET1dfU0laRTsgd2luZG93SW5kKyspIHsKICAgICAgICAgICAgVG9rZW5JbWJhbGFuY2VEYXRhIG1lbW9yeSBwZXJCbG9ja0RhdGEgPSBkZWNvZGVUb2tlbkltYmFsYW5jZURhdGEodG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVt3aW5kb3dJbmRdKTsKCiAgICAgICAgICAgIGlmIChwZXJCbG9ja0RhdGEubGFzdEJsb2NrIDw9IGVuZEJsb2NrICYmIHBlckJsb2NrRGF0YS5sYXN0QmxvY2sgPj0gc3RhcnRCbG9jaykgewogICAgICAgICAgICAgICAgYnV5SW1iYWxhbmNlICs9IGludChwZXJCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEltYmFsYW5jZVNpbmNlUmF0ZVVwZGF0ZShFUkMyMCB0b2tlbiwgdWludCByYXRlVXBkYXRlQmxvY2ssIHVpbnQgY3VycmVudEJsb2NrKQogICAgICAgIGludGVybmFsIHZpZXcKICAgICAgICByZXR1cm5zKGludCBidXlJbWJhbGFuY2UsIGludCBjdXJyZW50QmxvY2tJbWJhbGFuY2UpCiAgICB7CiAgICAgICAgYnV5SW1iYWxhbmNlID0gMDsKICAgICAgICBjdXJyZW50QmxvY2tJbWJhbGFuY2UgPSAwOwogICAgICAgIHVpbnQgbGF0ZXN0QmxvY2sgPSAwOwogICAgICAgIGludCBpbWJhbGFuY2VJblJhbmdlID0gMDsKICAgICAgICB1aW50IHN0YXJ0QmxvY2sgPSByYXRlVXBkYXRlQmxvY2s7CiAgICAgICAgdWludCBlbmRCbG9jayA9IGN1cnJlbnRCbG9jazsKCiAgICAgICAgZm9yICh1aW50IHdpbmRvd0luZCA9IDA7IHdpbmRvd0luZCA8IFNMSURJTkdfV0lORE9XX1NJWkU7IHdpbmRvd0luZCsrKSB7CiAgICAgICAgICAgIFRva2VuSW1iYWxhbmNlRGF0YSBtZW1vcnkgcGVyQmxvY2tEYXRhID0gZGVjb2RlVG9rZW5JbWJhbGFuY2VEYXRhKHRva2VuSW1iYWxhbmNlRGF0YVt0b2tlbl1bd2luZG93SW5kXSk7CgogICAgICAgICAgICBpZiAocGVyQmxvY2tEYXRhLmxhc3RCbG9jayA8PSBlbmRCbG9jayAmJiBwZXJCbG9ja0RhdGEubGFzdEJsb2NrID49IHN0YXJ0QmxvY2spIHsKICAgICAgICAgICAgICAgIGltYmFsYW5jZUluUmFuZ2UgKz0gcGVyQmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocGVyQmxvY2tEYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgIT0gcmF0ZVVwZGF0ZUJsb2NrKSBjb250aW51ZTsKICAgICAgICAgICAgaWYgKHBlckJsb2NrRGF0YS5sYXN0QmxvY2sgPCBsYXRlc3RCbG9jaykgY29udGludWU7CgogICAgICAgICAgICBsYXRlc3RCbG9jayA9IHBlckJsb2NrRGF0YS5sYXN0QmxvY2s7CiAgICAgICAgICAgIGJ1eUltYmFsYW5jZSA9IHBlckJsb2NrRGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgICAgICBpZiAodWludChwZXJCbG9ja0RhdGEubGFzdEJsb2NrKSA9PSBjdXJyZW50QmxvY2spIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSA9IHBlckJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGJ1eUltYmFsYW5jZSA9PSAwKSB7CiAgICAgICAgICAgIGJ1eUltYmFsYW5jZSA9IGltYmFsYW5jZUluUmFuZ2U7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEltYmFsYW5jZShFUkMyMCB0b2tlbiwgdWludCByYXRlVXBkYXRlQmxvY2ssIHVpbnQgY3VycmVudEJsb2NrKQogICAgICAgIGludGVybmFsIHZpZXcKICAgICAgICByZXR1cm5zKGludCB0b3RhbEltYmFsYW5jZSwgaW50IGN1cnJlbnRCbG9ja0ltYmFsYW5jZSkKICAgIHsKCiAgICAgICAgaW50IHJlc29sdXRpb24gPSBpbnQodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24pOwoKICAgICAgICAodG90YWxJbWJhbGFuY2UsIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSkgPQogICAgICAgICAgICBnZXRJbWJhbGFuY2VTaW5jZVJhdGVVcGRhdGUoCiAgICAgICAgICAgICAgICB0b2tlbiwKICAgICAgICAgICAgICAgIHJhdGVVcGRhdGVCbG9jaywKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9jayk7CgogICAgICAgIHRvdGFsSW1iYWxhbmNlICo9IHJlc29sdXRpb247CiAgICAgICAgY3VycmVudEJsb2NrSW1iYWxhbmNlICo9IHJlc29sdXRpb247CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TWF4UGVyQmxvY2tJbWJhbGFuY2UoRVJDMjAgdG9rZW4pIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1heFBlckJsb2NrSW1iYWxhbmNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE1heFRvdGFsSW1iYWxhbmNlKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5tYXhUb3RhbEltYmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmNvZGVUb2tlbkltYmFsYW5jZURhdGEoVG9rZW5JbWJhbGFuY2VEYXRhIGRhdGEpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gY2hlY2sgZm9yIG92ZXJmbG93cwogICAgICAgIHJlcXVpcmUoZGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSA8IGludChQT1dfMl82NCAvIDIpKTsKICAgICAgICByZXF1aXJlKGRhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgPiBpbnQoLTEgKiBpbnQoUE9XXzJfNjQpIC8gMikpOwogICAgICAgIHJlcXVpcmUoZGF0YS5sYXN0QmxvY2sgPCBQT1dfMl82NCk7CiAgICAgICAgcmVxdWlyZShkYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UgPCBpbnQoUE9XXzJfNjQgLyAyKSk7CiAgICAgICAgcmVxdWlyZShkYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UgPiBpbnQoLTEgKiBpbnQoUE9XXzJfNjQpIC8gMikpOwogICAgICAgIHJlcXVpcmUoZGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrIDwgUE9XXzJfNjQpOwoKICAgICAgICAvLyBkbyBlbmNvZGluZwogICAgICAgIHVpbnQgcmVzdWx0ID0gdWludChkYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlKSAmIChQT1dfMl82NCAtIDEpOwogICAgICAgIHJlc3VsdCB8PSBkYXRhLmxhc3RCbG9jayAqIFBPV18yXzY0OwogICAgICAgIHJlc3VsdCB8PSAodWludChkYXRhLnRvdGFsQnV5VW5pdHNJbWJhbGFuY2UpICYgKFBPV18yXzY0IC0gMSkpICogUE9XXzJfNjQgKiBQT1dfMl82NDsKICAgICAgICByZXN1bHQgfD0gZGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrICogUE9XXzJfNjQgKiBQT1dfMl82NCAqIFBPV18yXzY0OwoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY29kZVRva2VuSW1iYWxhbmNlRGF0YSh1aW50IGlucHV0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMoVG9rZW5JbWJhbGFuY2VEYXRhKSB7CiAgICAgICAgVG9rZW5JbWJhbGFuY2VEYXRhIG1lbW9yeSBkYXRhOwoKICAgICAgICBkYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlID0gaW50KGludDY0KGlucHV0ICYgKFBPV18yXzY0IC0gMSkpKTsKICAgICAgICBkYXRhLmxhc3RCbG9jayA9IHVpbnQodWludDY0KChpbnB1dCAvIFBPV18yXzY0KSAmIChQT1dfMl82NCAtIDEpKSk7CiAgICAgICAgZGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlID0gaW50KGludDY0KChpbnB1dCAvIChQT1dfMl82NCAqIFBPV18yXzY0KSkgJiAoUE9XXzJfNjQgLSAxKSkpOwogICAgICAgIGRhdGEubGFzdFJhdGVVcGRhdGVCbG9jayA9IHVpbnQodWludDY0KChpbnB1dCAvIChQT1dfMl82NCAqIFBPV18yXzY0ICogUE9XXzJfNjQpKSkpOwoKICAgICAgICByZXR1cm4gZGF0YTsKICAgIH0KfQoKY29udHJhY3QgQ29udmVyc2lvblJhdGVzIGlzIFZvbHVtZUltYmFsYW5jZVJlY29yZGVyLCBVdGlscyB7CgogICAgLy8gYnBzIC0gYmFzaWMgcmF0ZSBzdGVwcy4gb25lIHN0ZXAgaXMgMSAvIDEwMDAwIG9mIHRoZSByYXRlLgogICAgc3RydWN0IFN0ZXBGdW5jdGlvbiB7CiAgICAgICAgaW50W10geDsgLy8gcXVhbnRpdHkgZm9yIGVhY2ggc3RlcC4gUXVhbnRpdHkgb2YgZWFjaCBzdGVwIGluY2x1ZGVzIHByZXZpb3VzIHN0ZXBzLgogICAgICAgIGludFtdIHk7IC8vIHJhdGUgY2hhbmdlIHBlciBxdWFudGl0eSBzdGVwICBpbiBicHMuCiAgICB9CgogICAgc3RydWN0IFRva2VuRGF0YSB7CiAgICAgICAgYm9vbCBsaXN0ZWQ7ICAvLyB3YXMgYWRkZWQgdG8gcmVzZXJ2ZQogICAgICAgIGJvb2wgZW5hYmxlZDsgLy8gd2hldGhlciB0cmFkZSBpcyBlbmFibGVkCgogICAgICAgIC8vIHBvc2l0aW9uIGluIHRoZSBjb21wYWN0IGRhdGEKICAgICAgICB1aW50IGNvbXBhY3REYXRhQXJyYXlJbmRleDsKICAgICAgICB1aW50IGNvbXBhY3REYXRhRmllbGRJbmRleDsKCiAgICAgICAgLy8gcmF0ZSBkYXRhLiBiYXNlIGFuZCBjaGFuZ2VzIGFjY29yZGluZyB0byBxdWFudGl0eSBhbmQgcmVzZXJ2ZSBiYWxhbmNlLgogICAgICAgIC8vIGdlbmVyYWxseSBzcGVha2luZy4gU2VsbCByYXRlIGlzIDEgLyBidXkgcmF0ZSBpLmUuIHRoZSBidXkgaW4gdGhlIG90aGVyIGRpcmVjdGlvbi4KICAgICAgICB1aW50IGJhc2VCdXlSYXRlOyAgLy8gaW4gUFJFQ0lTSU9OIHVuaXRzLiBzZWUgS3liZXJDb25zdGFudHMKICAgICAgICB1aW50IGJhc2VTZWxsUmF0ZTsgLy8gUFJFQ0lTSU9OIHVuaXRzLiB3aXRob3V0IChzZWxsIC8gYnV5KSBzcHJlYWQgaXQgaXMgMSAvIGJhc2VCdXlSYXRlCiAgICAgICAgU3RlcEZ1bmN0aW9uIGJ1eVJhdGVRdHlTdGVwRnVuY3Rpb247IC8vIGluIGJwcy4gaGlnaGVyIHF1YW50aXR5IC0gYmlnZ2VyIHRoZSByYXRlLgogICAgICAgIFN0ZXBGdW5jdGlvbiBzZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbjsvLyBpbiBicHMuIGhpZ2hlciB0aGUgcXVhCiAgICAgICAgU3RlcEZ1bmN0aW9uIGJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb247IC8vIGluIEJQUy4gaGlnaGVyIHJlc2VydmUgaW1iYWxhbmNlIC0gYmlnZ2VyIHRoZSByYXRlLgogICAgICAgIFN0ZXBGdW5jdGlvbiBzZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbjsKICAgIH0KCiAgICAvKgogICAgdGhpcyBpcyB0aGUgZGF0YSBmb3IgdG9rZW5SYXRlc0NvbXBhY3REYXRhCiAgICBidXQgc29saWRpdHkgY29tcGlsZXIgb3B0aW1pemVyIGlzIHN1Yi1vcHRpbWFsLCBhbmQgY2Fubm90IHdyaXRlIHRoaXMgc3RydWN0dXJlIGluIGEgc2luZ2xlIHN0b3JhZ2Ugd3JpdGUKICAgIHNvIHdlIHJlcHJlc2VudCBpdCBhcyBieXRlczMyIGFuZCBkbyB0aGUgYnl0ZSB0cmlja3Mgb3Vyc2VsdmVzLgogICAgc3RydWN0IFRva2VuUmF0ZXNDb21wYWN0RGF0YSB7CiAgICAgICAgYnl0ZXMxNCBidXk7ICAvLyBjaGFuZ2UgYnV5IHJhdGUgb2YgdG9rZW4gZnJvbSBiYXNlQnV5UmF0ZSBpbiAxMCBicHMKICAgICAgICBieXRlczE0IHNlbGw7IC8vIGNoYW5nZSBzZWxsIHJhdGUgb2YgdG9rZW4gZnJvbSBiYXNlU2VsbFJhdGUgaW4gMTAgYnBzCgogICAgICAgIHVpbnQzMiBibG9ja051bWJlcjsKICAgIH0gKi8KICAgIHVpbnQgcHVibGljIHZhbGlkUmF0ZUR1cmF0aW9uSW5CbG9ja3MgPSAxMDsgLy8gcmF0ZXMgYXJlIHZhbGlkIGZvciB0aGlzIGFtb3VudCBvZiBibG9ja3MKICAgIEVSQzIwW10gaW50ZXJuYWwgbGlzdGVkVG9rZW5zOwogICAgbWFwcGluZyhhZGRyZXNzPT5Ub2tlbkRhdGEpIGludGVybmFsIHRva2VuRGF0YTsKICAgIGJ5dGVzMzJbXSBpbnRlcm5hbCB0b2tlblJhdGVzQ29tcGFjdERhdGE7CiAgICB1aW50IHB1YmxpYyBudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSA9IDA7CiAgICBhZGRyZXNzIHB1YmxpYyByZXNlcnZlQ29udHJhY3Q7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIE5VTV9UT0tFTlNfSU5fQ09NUEFDVF9EQVRBID0gMTQ7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEJZVEVTXzE0X09GRlNFVCA9ICgyICoqICg4ICogTlVNX1RPS0VOU19JTl9DT01QQUNUX0RBVEEpKTsKCiAgICBmdW5jdGlvbiBDb252ZXJzaW9uUmF0ZXMoYWRkcmVzcyBfYWRtaW4pIHB1YmxpYyBWb2x1bWVJbWJhbGFuY2VSZWNvcmRlcihfYWRtaW4pCiAgICAgICAgeyB9IC8vIHNvbGhpbnQtZGlzYWJsZS1saW5lIG5vLWVtcHR5LWJsb2NrcwoKICAgIGZ1bmN0aW9uIGFkZFRva2VuKEVSQzIwIHRva2VuKSBwdWJsaWMgb25seUFkbWluIHsKCiAgICAgICAgcmVxdWlyZSghdG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkID0gdHJ1ZTsKICAgICAgICBsaXN0ZWRUb2tlbnMucHVzaCh0b2tlbik7CgogICAgICAgIGlmIChudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSA9PSAwKSB7CiAgICAgICAgICAgIHRva2VuUmF0ZXNDb21wYWN0RGF0YS5sZW5ndGgrKzsgLy8gYWRkIG5ldyBzdHJ1Y3R1cmUKICAgICAgICB9CgogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFBcnJheUluZGV4ID0gdG9rZW5SYXRlc0NvbXBhY3REYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUZpZWxkSW5kZXggPSBudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YTsKCiAgICAgICAgbnVtVG9rZW5zSW5DdXJyZW50Q29tcGFjdERhdGEgPSAobnVtVG9rZW5zSW5DdXJyZW50Q29tcGFjdERhdGEgKyAxKSAlIE5VTV9UT0tFTlNfSU5fQ09NUEFDVF9EQVRBOwoKICAgICAgICBzZXRHYXJiYWdlVG9Wb2x1bWVSZWNvcmRlcih0b2tlbik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q29tcGFjdERhdGEoYnl0ZXMxNFtdIGJ1eSwgYnl0ZXMxNFtdIHNlbGwsIHVpbnQgYmxvY2tOdW1iZXIsIHVpbnRbXSBpbmRpY2VzKSBwdWJsaWMgb25seU9wZXJhdG9yIHsKCiAgICAgICAgcmVxdWlyZShidXkubGVuZ3RoID09IHNlbGwubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGluZGljZXMubGVuZ3RoID09IGJ1eS5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoYmxvY2tOdW1iZXIgPD0gMHhGRkZGRkZGRik7CgogICAgICAgIHVpbnQgYnl0ZXMxNE9mZnNldCA9IEJZVEVTXzE0X09GRlNFVDsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaW5kaWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByZXF1aXJlKGluZGljZXNbaV0gPCB0b2tlblJhdGVzQ29tcGFjdERhdGEubGVuZ3RoKTsKICAgICAgICAgICAgdWludCBkYXRhID0gdWludChidXlbaV0pIHwgdWludChzZWxsW2ldKSAqIGJ5dGVzMTRPZmZzZXQgfCAoYmxvY2tOdW1iZXIgKiAoYnl0ZXMxNE9mZnNldCAqIGJ5dGVzMTRPZmZzZXQpKTsKICAgICAgICAgICAgdG9rZW5SYXRlc0NvbXBhY3REYXRhW2luZGljZXNbaV1dID0gYnl0ZXMzMihkYXRhKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QmFzZVJhdGUoCiAgICAgICAgRVJDMjBbXSB0b2tlbnMsCiAgICAgICAgdWludFtdIGJhc2VCdXksCiAgICAgICAgdWludFtdIGJhc2VTZWxsLAogICAgICAgIGJ5dGVzMTRbXSBidXksCiAgICAgICAgYnl0ZXMxNFtdIHNlbGwsCiAgICAgICAgdWludCBibG9ja051bWJlciwKICAgICAgICB1aW50W10gaW5kaWNlcwogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPcGVyYXRvcgogICAgewogICAgICAgIHJlcXVpcmUodG9rZW5zLmxlbmd0aCA9PSBiYXNlQnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbnMubGVuZ3RoID09IGJhc2VTZWxsLmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZShzZWxsLmxlbmd0aCA9PSBidXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHNlbGwubGVuZ3RoID09IGluZGljZXMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh1aW50IGluZCA9IDA7IGluZCA8IHRva2Vucy5sZW5ndGg7IGluZCsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2Vuc1tpbmRdXS5saXN0ZWQpOwogICAgICAgICAgICB0b2tlbkRhdGFbdG9rZW5zW2luZF1dLmJhc2VCdXlSYXRlID0gYmFzZUJ1eVtpbmRdOwogICAgICAgICAgICB0b2tlbkRhdGFbdG9rZW5zW2luZF1dLmJhc2VTZWxsUmF0ZSA9IGJhc2VTZWxsW2luZF07CiAgICAgICAgfQoKICAgICAgICBzZXRDb21wYWN0RGF0YShidXksIHNlbGwsIGJsb2NrTnVtYmVyLCBpbmRpY2VzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRRdHlTdGVwRnVuY3Rpb24oCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50W10geEJ1eSwKICAgICAgICBpbnRbXSB5QnV5LAogICAgICAgIGludFtdIHhTZWxsLAogICAgICAgIGludFtdIHlTZWxsCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU9wZXJhdG9yCiAgICB7CiAgICAgICAgcmVxdWlyZSh4QnV5Lmxlbmd0aCA9PSB5QnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSh4U2VsbC5sZW5ndGggPT0geVNlbGwubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKCiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlUXR5U3RlcEZ1bmN0aW9uID0gU3RlcEZ1bmN0aW9uKHhCdXksIHlCdXkpOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24gPSBTdGVwRnVuY3Rpb24oeFNlbGwsIHlTZWxsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRJbWJhbGFuY2VTdGVwRnVuY3Rpb24oCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50W10geEJ1eSwKICAgICAgICBpbnRbXSB5QnV5LAogICAgICAgIGludFtdIHhTZWxsLAogICAgICAgIGludFtdIHlTZWxsCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU9wZXJhdG9yCiAgICB7CiAgICAgICAgcmVxdWlyZSh4QnV5Lmxlbmd0aCA9PSB5QnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZSh4U2VsbC5sZW5ndGggPT0geVNlbGwubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKCiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uID0gU3RlcEZ1bmN0aW9uKHhCdXksIHlCdXkpOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24gPSBTdGVwRnVuY3Rpb24oeFNlbGwsIHlTZWxsKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWxpZFJhdGVEdXJhdGlvbkluQmxvY2tzKHVpbnQgZHVyYXRpb24pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHZhbGlkUmF0ZUR1cmF0aW9uSW5CbG9ja3MgPSBkdXJhdGlvbjsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmFibGVUb2tlblRyYWRlKEVSQzIwIHRva2VuKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKICAgICAgICByZXF1aXJlKHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uICE9IDApOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uZW5hYmxlZCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGlzYWJsZVRva2VuVHJhZGUoRVJDMjAgdG9rZW4pIHB1YmxpYyBvbmx5QWxlcnRlciB7CiAgICAgICAgcmVxdWlyZSh0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5lbmFibGVkID0gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UmVzZXJ2ZUFkZHJlc3MoYWRkcmVzcyByZXNlcnZlKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXNlcnZlQ29udHJhY3QgPSByZXNlcnZlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlY29yZEltYmFsYW5jZSgKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICBpbnQgYnV5QW1vdW50LAogICAgICAgIHVpbnQgcmF0ZVVwZGF0ZUJsb2NrLAogICAgICAgIHVpbnQgY3VycmVudEJsb2NrCiAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHJlc2VydmVDb250cmFjdCk7CgogICAgICAgIGlmIChyYXRlVXBkYXRlQmxvY2sgPT0gMCkgcmF0ZVVwZGF0ZUJsb2NrID0gZ2V0UmF0ZVVwZGF0ZUJsb2NrKHRva2VuKTsKCiAgICAgICAgcmV0dXJuIGFkZEltYmFsYW5jZSh0b2tlbiwgYnV5QW1vdW50LCByYXRlVXBkYXRlQmxvY2ssIGN1cnJlbnRCbG9jayk7CiAgICB9CgogICAgLyogc29saGludC1kaXNhYmxlIGZ1bmN0aW9uLW1heC1saW5lcyAqLwogICAgZnVuY3Rpb24gZ2V0UmF0ZShFUkMyMCB0b2tlbiwgdWludCBjdXJyZW50QmxvY2tOdW1iZXIsIGJvb2wgYnV5LCB1aW50IHF0eSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgLy8gY2hlY2sgaWYgdHJhZGUgaXMgZW5hYmxlZAogICAgICAgIGlmICghdG9rZW5EYXRhW3Rva2VuXS5lbmFibGVkKSByZXR1cm4gMDsKICAgICAgICBpZiAodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24gPT0gMCkgcmV0dXJuIDA7IC8vIHRva2VuIGNvbnRyb2wgaW5mbyBub3Qgc2V0CgogICAgICAgIC8vIGdldCByYXRlIHVwZGF0ZSBibG9jawogICAgICAgIGJ5dGVzMzIgY29tcGFjdERhdGEgPSB0b2tlblJhdGVzQ29tcGFjdERhdGFbdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUFycmF5SW5kZXhdOwoKICAgICAgICB1aW50IHVwZGF0ZVJhdGVCbG9jayA9IGdldExhc3Q0Qnl0ZXMoY29tcGFjdERhdGEpOwogICAgICAgIGlmIChjdXJyZW50QmxvY2tOdW1iZXIgPj0gdXBkYXRlUmF0ZUJsb2NrICsgdmFsaWRSYXRlRHVyYXRpb25JbkJsb2NrcykgcmV0dXJuIDA7IC8vIHJhdGUgaXMgZXhwaXJlZAogICAgICAgIC8vIGNoZWNrIGltYmFsYW5jZQogICAgICAgIGludCB0b3RhbEltYmFsYW5jZTsKICAgICAgICBpbnQgYmxvY2tJbWJhbGFuY2U7CiAgICAgICAgKHRvdGFsSW1iYWxhbmNlLCBibG9ja0ltYmFsYW5jZSkgPSBnZXRJbWJhbGFuY2UodG9rZW4sIHVwZGF0ZVJhdGVCbG9jaywgY3VycmVudEJsb2NrTnVtYmVyKTsKCiAgICAgICAgLy8gY2FsY3VsYXRlIGFjdHVhbCByYXRlCiAgICAgICAgaW50IGltYmFsYW5jZVF0eTsKICAgICAgICBpbnQgZXh0cmFCcHM7CiAgICAgICAgaW50OCByYXRlVXBkYXRlOwogICAgICAgIHVpbnQgcmF0ZTsKCiAgICAgICAgaWYgKGJ1eSkgewogICAgICAgICAgICAvLyBzdGFydCB3aXRoIGJhc2UgcmF0ZQogICAgICAgICAgICByYXRlID0gdG9rZW5EYXRhW3Rva2VuXS5iYXNlQnV5UmF0ZTsKCiAgICAgICAgICAgIC8vIGFkZCByYXRlIHVwZGF0ZQogICAgICAgICAgICByYXRlVXBkYXRlID0gZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEoY29tcGFjdERhdGEsIHRva2VuLCB0cnVlKTsKICAgICAgICAgICAgZXh0cmFCcHMgPSBpbnQocmF0ZVVwZGF0ZSkgKiAxMDsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CgogICAgICAgICAgICAvLyBjb21wdXRlIHRva2VuIHF0eQogICAgICAgICAgICBxdHkgPSBnZXRUb2tlblF0eSh0b2tlbiwgcmF0ZSwgcXR5KTsKICAgICAgICAgICAgaW1iYWxhbmNlUXR5ID0gaW50KHF0eSk7CiAgICAgICAgICAgIHRvdGFsSW1iYWxhbmNlICs9IGltYmFsYW5jZVF0eTsKCiAgICAgICAgICAgIC8vIGFkZCBxdHkgb3ZlcmhlYWQKICAgICAgICAgICAgZXh0cmFCcHMgPSBleGVjdXRlU3RlcEZ1bmN0aW9uKHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZVF0eVN0ZXBGdW5jdGlvbiwgaW50KHF0eSkpOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKCiAgICAgICAgICAgIC8vIGFkZCBpbWJhbGFuY2Ugb3ZlcmhlYWQKICAgICAgICAgICAgZXh0cmFCcHMgPSBleGVjdXRlU3RlcEZ1bmN0aW9uKHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbiwgdG90YWxJbWJhbGFuY2UpOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBzdGFydCB3aXRoIGJhc2UgcmF0ZQogICAgICAgICAgICByYXRlID0gdG9rZW5EYXRhW3Rva2VuXS5iYXNlU2VsbFJhdGU7CgogICAgICAgICAgICAvLyBhZGQgcmF0ZSB1cGRhdGUKICAgICAgICAgICAgcmF0ZVVwZGF0ZSA9IGdldFJhdGVCeXRlRnJvbUNvbXBhY3REYXRhKGNvbXBhY3REYXRhLCB0b2tlbiwgZmFsc2UpOwogICAgICAgICAgICBleHRyYUJwcyA9IGludChyYXRlVXBkYXRlKSAqIDEwOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKCiAgICAgICAgICAgIC8vIGNvbXB1dGUgdG9rZW4gcXR5CiAgICAgICAgICAgIGltYmFsYW5jZVF0eSA9IC0xICogaW50KHF0eSk7CiAgICAgICAgICAgIHRvdGFsSW1iYWxhbmNlICs9IGltYmFsYW5jZVF0eTsKCiAgICAgICAgICAgIC8vIGFkZCBxdHkgb3ZlcmhlYWQKICAgICAgICAgICAgZXh0cmFCcHMgPSBleGVjdXRlU3RlcEZ1bmN0aW9uKHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24sIGludChxdHkpKTsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CgogICAgICAgICAgICAvLyBhZGQgaW1iYWxhbmNlIG92ZXJoZWFkCiAgICAgICAgICAgIGV4dHJhQnBzID0gZXhlY3V0ZVN0ZXBGdW5jdGlvbih0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLCB0b3RhbEltYmFsYW5jZSk7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFicyh0b3RhbEltYmFsYW5jZSArIGltYmFsYW5jZVF0eSkgPj0gZ2V0TWF4VG90YWxJbWJhbGFuY2UodG9rZW4pKSByZXR1cm4gMDsKICAgICAgICBpZiAoYWJzKGJsb2NrSW1iYWxhbmNlICsgaW1iYWxhbmNlUXR5KSA+PSBnZXRNYXhQZXJCbG9ja0ltYmFsYW5jZSh0b2tlbikpIHJldHVybiAwOwoKICAgICAgICByZXR1cm4gcmF0ZTsKICAgIH0KICAgIC8qIHNvbGhpbnQtZW5hYmxlIGZ1bmN0aW9uLW1heC1saW5lcyAqLwoKICAgIGZ1bmN0aW9uIGdldEJhc2ljUmF0ZShFUkMyMCB0b2tlbiwgYm9vbCBidXkpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIGlmIChidXkpCiAgICAgICAgICAgIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJhc2VCdXlSYXRlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYmFzZVNlbGxSYXRlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvbXBhY3REYXRhKEVSQzIwIHRva2VuKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQsIHVpbnQsIGJ5dGUsIGJ5dGUpIHsKICAgICAgICB1aW50IGFycmF5SW5kZXggPSB0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhQXJyYXlJbmRleDsKICAgICAgICB1aW50IGZpZWxkT2Zmc2V0ID0gdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUZpZWxkSW5kZXg7CgogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGFycmF5SW5kZXgsCiAgICAgICAgICAgIGZpZWxkT2Zmc2V0LAogICAgICAgICAgICBieXRlKGdldFJhdGVCeXRlRnJvbUNvbXBhY3REYXRhKHRva2VuUmF0ZXNDb21wYWN0RGF0YVthcnJheUluZGV4XSwgdG9rZW4sIHRydWUpKSwKICAgICAgICAgICAgYnl0ZShnZXRSYXRlQnl0ZUZyb21Db21wYWN0RGF0YSh0b2tlblJhdGVzQ29tcGFjdERhdGFbYXJyYXlJbmRleF0sIHRva2VuLCBmYWxzZSkpCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlbkJhc2ljRGF0YShFUkMyMCB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyhib29sLCBib29sKSB7CiAgICAgICAgcmV0dXJuICh0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCwgdG9rZW5EYXRhW3Rva2VuXS5lbmFibGVkKTsKICAgIH0KCiAgICAvKiBzb2xoaW50LWRpc2FibGUgY29kZS1jb21wbGV4aXR5ICovCiAgICBmdW5jdGlvbiBnZXRTdGVwRnVuY3Rpb25EYXRhKEVSQzIwIHRva2VuLCB1aW50IGNvbW1hbmQsIHVpbnQgcGFyYW0pIHB1YmxpYyB2aWV3IHJldHVybnMoaW50KSB7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24ueC5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDEpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24ueFtwYXJhbV07CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMikgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24ueS5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDMpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24ueVtwYXJhbV07CgogICAgICAgIGlmIChjb21tYW5kID09IDQpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbi54Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gNSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24ueFtwYXJhbV07CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gNikgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uLnkubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSA3KSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbi55W3BhcmFtXTsKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gOCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueC5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDkpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueFtwYXJhbV07CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTApIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnkubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi55W3BhcmFtXTsKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTIpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi54Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTMpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnhbcGFyYW1dOwogICAgICAgIGlmIChjb21tYW5kID09IDE0KSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueS5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDE1KSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi55W3BhcmFtXTsKCiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICAvKiBzb2xoaW50LWVuYWJsZSBjb2RlLWNvbXBsZXhpdHkgKi8KCiAgICBmdW5jdGlvbiBnZXRSYXRlVXBkYXRlQmxvY2soRVJDMjAgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIGJ5dGVzMzIgY29tcGFjdERhdGEgPSB0b2tlblJhdGVzQ29tcGFjdERhdGFbdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUFycmF5SW5kZXhdOwogICAgICAgIHJldHVybiBnZXRMYXN0NEJ5dGVzKGNvbXBhY3REYXRhKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMaXN0ZWRUb2tlbnMoKSBwdWJsaWMgdmlldyByZXR1cm5zKEVSQzIwW10pIHsKICAgICAgICByZXR1cm4gbGlzdGVkVG9rZW5zOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRva2VuUXR5KEVSQzIwIHRva2VuLCB1aW50IGV0aFF0eSwgdWludCByYXRlKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHVpbnQgZHN0RGVjaW1hbHMgPSB0b2tlbi5kZWNpbWFscygpOwogICAgICAgIHVpbnQgc3JjRGVjaW1hbHMgPSAxODsKCiAgICAgICAgcmV0dXJuIGNhbGNEc3RRdHkoZXRoUXR5LCBzcmNEZWNpbWFscywgZHN0RGVjaW1hbHMsIHJhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExhc3Q0Qnl0ZXMoYnl0ZXMzMiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIC8vIGNhbm5vdCB0cnVzdCBjb21waWxlciB3aXRoIG5vdCB0dXJuaW5nIGJpdCBvcGVyYXRpb25zIGludG8gRVhQIG9wY29kZQogICAgICAgIHJldHVybiB1aW50KGIpIC8gKEJZVEVTXzE0X09GRlNFVCAqIEJZVEVTXzE0X09GRlNFVCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEoYnl0ZXMzMiBkYXRhLCBFUkMyMCB0b2tlbiwgYm9vbCBidXkpIGludGVybmFsIHZpZXcgcmV0dXJucyhpbnQ4KSB7CiAgICAgICAgdWludCBmaWVsZE9mZnNldCA9IHRva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFGaWVsZEluZGV4OwogICAgICAgIHVpbnQgYnl0ZU9mZnNldDsKICAgICAgICBpZiAoYnV5KQogICAgICAgICAgICBieXRlT2Zmc2V0ID0gMzIgLSBOVU1fVE9LRU5TX0lOX0NPTVBBQ1RfREFUQSArIGZpZWxkT2Zmc2V0OwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnl0ZU9mZnNldCA9IDQgKyBmaWVsZE9mZnNldDsKCiAgICAgICAgcmV0dXJuIGludDgoZGF0YVtieXRlT2Zmc2V0XSk7CiAgICB9CgogICAgZnVuY3Rpb24gZXhlY3V0ZVN0ZXBGdW5jdGlvbihTdGVwRnVuY3Rpb24gZiwgaW50IHgpIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQpIHsKICAgICAgICB1aW50IGxlbiA9IGYueS5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGluZCA9IDA7IGluZCA8IGxlbjsgaW5kKyspIHsKICAgICAgICAgICAgaWYgKHggPD0gZi54W2luZF0pIHJldHVybiBmLnlbaW5kXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmLnlbbGVuLTFdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEJwcyh1aW50IHJhdGUsIGludCBicHMpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBtYXhCcHMgPSAxMDAgKiAxMDA7CiAgICAgICAgcmV0dXJuIChyYXRlICogdWludChpbnQobWF4QnBzKSArIGJwcykpIC8gbWF4QnBzOwogICAgfQoKICAgIGZ1bmN0aW9uIGFicyhpbnQgeCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAoeCA8IDApCiAgICAgICAgICAgIHJldHVybiB1aW50KC0xICogeCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdWludCh4KTsKICAgIH0KfQ=='.
	

]
