Class {
	#name : #SRT98fcca7be87672cf529fa8cf868866813bc95a57,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT98fcca7be87672cf529fa8cf868866813bc95a57 >> base64 [
	^ 'LyoqCiAqIFNhZmUgdW5zaWduZWQgc2FmZSBtYXRoLgogKgogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQogKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbAogKgogKiBNYWludGFpbmVkIGhlcmUgdW50aWwgbWVyZ2VkIHRvIG1haW5saW5lIHplcHBlbGluLXNvbGlkaXR5LgogKgogKi8KbGlicmFyeSBTYWZlTWF0aExpYiB7CgogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBhc3NlcnQoYm9vbCBhc3NlcnRpb24pIHByaXZhdGUgewogICAgaWYgKCFhc3NlcnRpb24pIHRocm93OwogIH0KfQoKCgoKLyoKICogT3duYWJsZQogKgogKiBCYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIuCiAqIFByb3ZpZGVzIG9ubHlPd25lciBtb2RpZmllciwgd2hpY2ggcHJldmVudHMgZnVuY3Rpb24gZnJvbSBydW5uaW5nIGlmIGl0IGlzIGNhbGxlZCBieSBhbnlvbmUgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB7CiAgICAgIHRocm93OwogICAgfQogICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCgovKgogKiBIYWx0YWJsZQogKgogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLgogKgogKgogKiBPcmlnaW5hbGx5IGVudmlzaW9uZWQgaW4gRmlyc3RCbG9vZCBJQ08gY29udHJhY3QuCiAqLwpjb250cmFjdCBIYWx0YWJsZSBpcyBPd25hYmxlIHsKICBib29sIHB1YmxpYyBoYWx0ZWQ7CgogIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICBpZiAoaGFsdGVkKSB0aHJvdzsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaWYgKCFoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBoYWx0ZWQgPSB0cnVlOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgfQoKfQoKCi8qKgogKiBJbnRlcmZhY2UgZm9yIGRlZmluaW5nIGNyb3dkc2FsZSBwcmljaW5nLgogKi8KY29udHJhY3QgUHJpY2luZ1N0cmF0ZWd5IHsKCiAgLyoqIEludGVyZmFjZSBkZWNsYXJhdGlvbi4gKi8KICBmdW5jdGlvbiBpc1ByaWNpbmdTdHJhdGVneSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKiBTZWxmIGNoZWNrIGlmIGFsbCByZWZlcmVuY2VzIGFyZSBjb3JyZWN0bHkgc2V0LgogICAqCiAgICogQ2hlY2tzIHRoYXQgcHJpY2luZyBzdHJhdGVneSBtYXRjaGVzIGNyb3dkc2FsZSBwYXJhbWV0ZXJzLgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZShhZGRyZXNzIGNyb3dkc2FsZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogV2hlbiBzb21lYm9keSB0cmllcyB0byBidXkgdG9rZW5zIGZvciBYIGV0aCwgY2FsY3VsYXRlIGhvdyBtYW55IHRva2VucyB0aGV5IGdldC4KICAgKgogICAqCiAgICogQHBhcmFtIHZhbHVlIC0gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhlIHRyYW5zYWN0aW9uIHNlbmQgaW4gYXMgd2VpCiAgICogQHBhcmFtIHRva2Vuc1NvbGQgLSBob3cgbXVjaCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgdGhpcyBmYXIKICAgKiBAcGFyYW0gd2VpUmFpc2VkIC0gaG93IG11Y2ggbW9uZXkgaGFzIGJlZW4gcmFpc2VkIHRoaXMgZmFyCiAgICogQHBhcmFtIG1zZ1NlbmRlciAtIHdobyBpcyB0aGUgaW52ZXN0b3Igb2YgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSBkZWNpbWFscyAtIGhvdyBtYW55IGRlY2ltYWwgdW5pdHMgdGhlIHRva2VuIGhhcwogICAqIEByZXR1cm4gQW1vdW50IG9mIHRva2VucyB0aGUgaW52ZXN0b3IgcmVjZWl2ZXMKICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVQcmljZSh1aW50IHZhbHVlLCB1aW50IHdlaVJhaXNlZCwgdWludCB0b2tlbnNTb2xkLCBhZGRyZXNzIG1zZ1NlbmRlciwgdWludCBkZWNpbWFscykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG9rZW5BbW91bnQpOwp9CgoKLyoqCiAqIEZpbmFsaXplIGFnZW50IGRlZmluZXMgd2hhdCBoYXBwZW5zIGF0IHRoZSBlbmQgb2Ygc3VjY2VzZWZ1bCBjcm93ZHNhbGUuCiAqCiAqIC0gQWxsb2NhdGUgdG9rZW5zIGZvciBmb3VuZGVycywgYm91bnRpZXMgYW5kIGNvbW11bml0eQogKiAtIE1ha2UgdG9rZW5zIHRyYW5zZmVyYWJsZQogKiAtIGV0Yy4KICovCmNvbnRyYWN0IEZpbmFsaXplQWdlbnQgewoKICBmdW5jdGlvbiBpc0ZpbmFsaXplQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKiBSZXR1cm4gdHJ1ZSBpZiB3ZSBjYW4gcnVuIGZpbmFsaXplQ3Jvd2RzYWxlKCkgcHJvcGVybHkuCiAgICoKICAgKiBUaGlzIGlzIGEgc2FmZXR5IGNoZWNrIGZ1bmN0aW9uIHRoYXQgZG9lc24ndCBhbGxvdyBjcm93ZHNhbGUgdG8gYmVnaW4KICAgKiB1bmxlc3MgdGhlIGZpbmFsaXplciBoYXMgYmVlbiBzZXQgdXAgcHJvcGVybHkuCiAgICovCiAgZnVuY3Rpb24gaXNTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwoKICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoKTsKCn0KCgoKCi8qCiAqIEVSQzIwIGludGVyZmFjZQogKiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgoKLyoqCiAqIEEgdG9rZW4gdGhhdCBkZWZpbmVzIGZyYWN0aW9uYWwgdW5pdHMgYXMgZGVjaW1hbHMuCiAqLwpjb250cmFjdCBGcmFjdGlvbmFsRVJDMjAgaXMgRVJDMjAgewoKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKCn0KCgoKLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGUKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZAogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZAogKiAtIGRpZmZlcmVudCBwcmljaW5nIHN0cmF0ZWdpZXMKICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgaXMgSGFsdGFibGUgewoKICAvKiBNYXggaW52ZXN0bWVudCBjb3VudCB3aGVuIHdlIGFyZSBzdGlsbCBhbGxvd2VkIHRvIGNoYW5nZSB0aGUgbXVsdGlzaWcgYWRkcmVzcyAqLwogIHVpbnQgcHVibGljIE1BWF9JTlZFU1RNRU5UU19CRUZPUkVfTVVMVElTSUdfQ0hBTkdFID0gNTsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIEZyYWN0aW9uYWxFUkMyMCBwdWJsaWMgdG9rZW47CgogIC8qIEhvdyB3ZSBhcmUgZ29pbmcgdG8gcHJpY2Ugb3VyIG9mZmVyaW5nICovCiAgUHJpY2luZ1N0cmF0ZWd5IHB1YmxpYyBwcmljaW5nU3RyYXRlZ3k7CgogIC8qIFBvc3Qtc3VjY2VzcyBjYWxsYmFjayAqLwogIEZpbmFsaXplQWdlbnQgcHVibGljIGZpbmFsaXplQWdlbnQ7CgogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKCiAgLyogaWYgdGhlIGZ1bmRpbmcgZ29hbCBpcyBub3QgcmVhY2hlZCwgaW52ZXN0b3JzIG1heSB3aXRoZHJhdyB0aGVpciBmdW5kcyAqLwogIHVpbnQgcHVibGljIG1pbmltdW1GdW5kaW5nR29hbDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwoKICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovCiAgdWludCBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50ID0gMDsKCiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLwogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7CgogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIGdpdmVuIGJhY2sgdG8gaW52ZXN0b3JzLiovCiAgdWludCBwdWJsaWMgd2VpUmVmdW5kZWQgPSAwOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBmaW5hbGl6ZWQgKi8KICBib29sIHB1YmxpYyBmaW5hbGl6ZWQ7CgogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8KICBib29sIHB1YmxpYyByZXF1aXJlQ3VzdG9tZXJJZDsKCiAgLyoqCiAgICAqIERvIHdlIHZlcmlmeSB0aGF0IGNvbnRyaWJ1dG9yIGhhcyBiZWVuIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIChhY2NyZWRpdGVkIGludmVzdG9ycyBvbmx5KS4KICAgICogVGhpcyBtZXRob2Qgd2FzIGZpcnN0IHVzZWQgaW4gRmlyc3RCbG9vZCBjcm93ZHNhbGUgdG8gZW5zdXJlIGFsbCBjb250cmlidXRvcnMgaGF2ZSBhY2NlcHRlZCB0ZXJtcyBvbiBzYWxlIChvbiB0aGUgd2ViKS4KICAgICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZWRTaWduZWRBZGRyZXNzOwoKICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwoKICAvKiogSG93IG11Y2ggRVRIIGVhY2ggYWRkcmVzcyBoYXMgaW52ZXN0ZWQgdG8gdGhpcyBjcm93ZHNhbGUgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbnZlc3RlZEFtb3VudE9mOwoKICAvKiogSG93IG11Y2ggdG9rZW5zIHRoaXMgY3Jvd2RzYWxlIGhhcyBjcmVkaXRlZCBmb3IgZWFjaCBpbnZlc3RvciBhZGRyZXNzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5BbW91bnRPZjsKCiAgLyoqIEFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGludmVzdCBldmVuIGJlZm9yZSBJQ08gb2ZmaWNhbCBvcGVucy4gRm9yIHRlc3RpbmcsIGZvciBJQ08gcGFydG5lcnMsIGV0Yy4gKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0OwoKICAvKiogVGhpcyBpcyBmb3IgbWFudWwgdGVzdGluZyBmb3IgdGhlIGludGVyYWN0aW9uIGZyb20gb3duZXIgd2FsbGV0LiBZb3UgY2FuIHNldCBpdCB0byBhbnkgdmFsdWUgYW5kIGluc3BlY3QgdGhpcyBpbiBibG9ja2NoYWluIGV4cGxvcmVyIHRvIHNlZSB0aGF0IGNyb3dkc2FsZSBpbnRlcmFjdGlvbiB3b3Jrcy4gKi8KICB1aW50IHB1YmxpYyBvd25lclRlc3RWYWx1ZTsKCiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKgogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQKICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZAogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IGZvciByZWNsYWltLgogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30KCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50MTI4IGN1c3RvbWVySWQpOwoKICAvLyBSZWZ1bmQgd2FzIHByb2Nlc3NlZCBmb3IgYSBjb250cmlidXRvcgogIGV2ZW50IFJlZnVuZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCk7CgogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdAogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgcmVxdWlyZUN1c3RvbWVySWQsIGJvb2wgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBhZGRyZXNzIHNpZ25lckFkZHJlc3MpOwoKICAvLyBBZGRyZXNzIGVhcmx5IHBhcnRpY2lwYXRpb24gd2hpdGVsaXN0IHN0YXR1cyBjaGFuZ2VkCiAgZXZlbnQgV2hpdGVsaXN0ZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXR1cyk7CgogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IGVuZHNBdCk7CgogIGZ1bmN0aW9uIENyb3dkc2FsZShhZGRyZXNzIF90b2tlbiwgUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3ksIGFkZHJlc3MgX211bHRpc2lnV2FsbGV0LCB1aW50IF9zdGFydCwgdWludCBfZW5kLCB1aW50IF9taW5pbXVtRnVuZGluZ0dvYWwpIHsKCiAgICBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgdG9rZW4gPSBGcmFjdGlvbmFsRVJDMjAoX3Rva2VuKTsKCiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7CgogICAgbXVsdGlzaWdXYWxsZXQgPSBfbXVsdGlzaWdXYWxsZXQ7CiAgICBpZihtdWx0aXNpZ1dhbGxldCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoX3N0YXJ0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBzdGFydHNBdCA9IF9zdGFydDsKCiAgICBpZihfZW5kID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBlbmRzQXQgPSBfZW5kOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBNaW5pbXVtIGZ1bmRpbmcgZ29hbCBjYW4gYmUgemVybwogICAgbWluaW11bUZ1bmRpbmdHb2FsID0gX21pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHRocm93OwogIH0KCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IHByaXZhdGUgewoKICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudAogICAgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICAgIC8vIEFyZSB3ZSB3aGl0ZWxpc3RlZCBmb3IgZWFybHkgZGVwb3NpdAogICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0pIHsKICAgICAgICB0aHJvdzsKICAgICAgfQogICAgfSBlbHNlIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuRnVuZGluZykgewogICAgICAvLyBSZXRhaWwgcGFydGljaXBhbnRzIGNhbiBvbmx5IGNvbWUgaW4gd2hlbiB0aGUgY3Jvd2RzYWxlIGlzIHJ1bm5pbmcKICAgICAgLy8gcGFzcwogICAgfSBlbHNlIHsKICAgICAgLy8gVW53YW50ZWQgc3RhdGUKICAgICAgdGhyb3c7CiAgICB9CgogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICB1aW50IHRva2VuQW1vdW50ID0gcHJpY2luZ1N0cmF0ZWd5LmNhbGN1bGF0ZVByaWNlKHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsKCiAgICBpZih0b2tlbkFtb3VudCA9PSAwKSB7CiAgICAgIC8vIER1c3QgdHJhbnNhY3Rpb24KICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KCiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0ucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQucGx1cyh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQucGx1cyh0b2tlbkFtb3VudCk7CgoKICAgIC8vIENoZWNrIHRoYXQgd2UgZGlkIG5vdCBidXN0IHRoZSBjYXAKICAgIGlmKGlzQnJlYWtpbmdDYXAod2VpQW1vdW50LCB0b2tlbkFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkKSkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5CiAgICBpZighbXVsdGlzaWdXYWxsZXQuc2VuZCh3ZWlBbW91bnQpKSB0aHJvdzsKCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOwoKICB9CgogIC8qKgogICAqIFByZWFsbG9jYXRlIHRva2VucyBmb3IgdGhlIGVhcmx5IGludmVzdG9ycy4KICAgKgogICAqIFByZWFsbG9jYXRlZCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgYmVmb3JlIHRoZSBhY3R1YWwgY3Jvd2RzYWxlIG9wZW5zLgogICAqIFRoaXMgZnVuY3Rpb24gbWludHMgdGhlIHRva2VucyBhbmQgbW92ZXMgdGhlIGNyb3dkc2FsZSBuZWVkbGUuCiAgICoKICAgKiBJbnZlc3RvciBjb3VudCBpcyBub3QgaGFuZGxlZDsgaXQgaXMgYXNzdW1lZCB0aGlzIGdvZXMgZm9yIG11bHRpcGxlIGludmVzdG9ycwogICAqIGFuZCB0aGUgdG9rZW4gZGlzdHJpYnV0aW9uIGhhcHBlbnMgb3V0c2lkZSB0aGUgc21hcnQgY29udHJhY3QgZmxvdy4KICAgKgogICAqIE5vIG1vbmV5IGlzIGV4Y2hhbmdlZCwgYXMgdGhlIGNyb3dkc2FsZSB0ZWFtIGFscmVhZHkgaGF2ZSByZWNlaXZlZCB0aGUgcGF5bWVudC4KICAgKgogICAqIEBwYXJhbSBmdWxsVG9rZW5zIHRva2VucyBhcyBmdWxsIHRva2VucyAtIGRlY2ltYWwgcGxhY2VzIGFkZGVkIGludGVybmFsbHkKICAgKiBAcGFyYW0gd2VpUHJpY2UgUHJpY2Ugb2YgYSBzaW5nbGUgZnVsbCB0b2tlbiBpbiB3ZWkKICAgKgogICAqLwogIGZ1bmN0aW9uIHByZWFsbG9jYXRlKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgZnVsbFRva2VucywgdWludCB3ZWlQcmljZSkgcHVibGljIG9ubHlPd25lciB7CgogICAgdWludCB0b2tlbkFtb3VudCA9IGZ1bGxUb2tlbnMgKiAxMCoqdG9rZW4uZGVjaW1hbHMoKTsKICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UgKiBmdWxsVG9rZW5zOyAvLyBUaGlzIGNhbiBiZSBhbHNvIDAsIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQoKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKHRva2VuQW1vdW50KTsKCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7CgogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CgogICAgLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MKICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCAwKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTI1NihhZGRyKTsKICAgICBpZiAoZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpICE9IHNpZ25lckFkZHJlc3MpIHRocm93OwogICAgIGlmKGN1c3RvbWVySWQgPT0gMCkgdGhyb3c7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0V2l0aEN1c3RvbWVySWQoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBhZGRyKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpZihyZXF1aXJlQ3VzdG9tZXJJZCkgdGhyb3c7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aXBhbnRzIGZvciB0aGFuayB5b3UgZW1haWwKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCAwKTsKICB9CgogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIgYW5kIGNsZWFyIGhpcyBhZGRyZXNzLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MobXNnLnNlbmRlciwgY3VzdG9tZXJJZCwgdiwgciwgcyk7CiAgfQoKICAvKioKICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpbnZlc3RXaXRoQ3VzdG9tZXJJZChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNpYyBlbnRyeSBwb2ludCB0byBwYXJ0aWNpcGF0ZSB0aGUgY3Jvd2RzYWxlIHByb2Nlc3MuCiAgICoKICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0KG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewoKICAgIC8vIEFscmVhZHkgZmluYWxpemVkCiAgICBpZihmaW5hbGl6ZWQpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuCiAgICBpZihhZGRyZXNzKGZpbmFsaXplQWdlbnQpICE9IDApIHsKICAgICAgZmluYWxpemVBZ2VudC5maW5hbGl6ZUNyb3dkc2FsZSgpOwogICAgfQoKICAgIGZpbmFsaXplZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50LgogICAqCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHNldHRpbmcgdGhpcywgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0RmluYWxpemVBZ2VudChGaW5hbGl6ZUFnZW50IGFkZHIpIG9ubHlPd25lciB7CiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIG9ubHlPd25lciB7CiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGlmIGFsbCBpbnZlc3RvcnMgbXVzdCBiZSBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSBmaXJzdC4KICAgKgogICAqIFRoaXMgaXMgZS5nLiBmb3IgdGhlIGFjY3JlZGl0ZWQgaW52ZXN0b3IgY2xlYXJpbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlU2lnbmVkQWRkcmVzcyhib29sIHZhbHVlLCBhZGRyZXNzIF9zaWduZXJBZGRyZXNzKSBvbmx5T3duZXIgewogICAgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gdmFsdWU7CiAgICBzaWduZXJBZGRyZXNzID0gX3NpZ25lckFkZHJlc3M7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLgogICAqCiAgICogVE9ETzogRml4IHNwZWxsaW5nIGVycm9yIGluIHRoZSBuYW1lCiAgICovCiAgZnVuY3Rpb24gc2V0RWFybHlQYXJpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpIG9ubHlPd25lciB7CiAgICBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOwogICAgV2hpdGVsaXN0ZWQoYWRkciwgc3RhdHVzKTsKICB9CgogIC8qKgogICAqIEFsbG93IGNyb3dkc2FsZSBvd25lciB0byBjbG9zZSBlYXJseSBvciBleHRlbmQgdGhlIGNyb3dkc2FsZS4KICAgKgogICAqIFRoaXMgaXMgdXNlZnVsIGUuZy4gZm9yIGEgbWFudWFsIHNvZnQgY2FwIGltcGxlbWVudGF0aW9uOgogICAqIC0gYWZ0ZXIgWCBhbW91bnQgaXMgcmVhY2hlZCBkZXRlcm1pbmUgbWFudWFsIGNsb3NpbmcKICAgKgogICAqIFRoaXMgbWF5IHB1dCB0aGUgY3Jvd2RzYWxlIHRvIGFuIGludmFsaWQgc3RhdGUsCiAgICogYnV0IHdlIHRydXN0IG93bmVycyBrbm93IHdoYXQgdGhleSBhcmUgZG9pbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRFbmRzQXQodWludCB0aW1lKSBvbmx5T3duZXIgewoKICAgIGlmKG5vdyA+IHRpbWUpIHsKICAgICAgdGhyb3c7IC8vIERvbid0IGNoYW5nZSBwYXN0CiAgICB9CgogICAgZW5kc0F0ID0gdGltZTsKICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsKICB9CgogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgcHJpY2luZyBzdHJhdGVneS4KICAgKgogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRQcmljaW5nU3RyYXRlZ3koUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3kpIG9ubHlPd25lciB7CiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5OwoKICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50CiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byBjaGFuZ2UgdGhlIHRlYW0gbXVsdGlzaWcgYWRkcmVzcyBpbiB0aGUgY2FzZSBvZiBlbWVyZ2VuY3kuCiAgICoKICAgKiBUaGlzIGFsbG93cyB0byBzYXZlIGEgZGVwbG95ZWQgY3Jvd2RzYWxlIHdhbGxldCBpbiB0aGUgY2FzZSB0aGUgY3Jvd2RzYWxlIGhhcyBub3QgeWV0IGJlZ3VuCiAgICogKHdlIGhhdmUgZG9uZSBvbmx5IGZldyB0ZXN0IHRyYW5zYWN0aW9ucykuIEFmdGVyIHRoZSBjcm93ZHNhbGUgaXMgZ29pbmcKICAgKiB0aGVuIG11bHRpc2lnIGFkZHJlc3Mgc3RheXMgbG9ja2VkIGZvciB0aGUgc2FmZXR5IHJlYXNvbnMuCiAgICovCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsKCiAgICAvLyBDaGFuZ2UKICAgIGlmKGludmVzdG9yQ291bnQgPiBNQVhfSU5WRVNUTUVOVFNfQkVGT1JFX01VTFRJU0lHX0NIQU5HRSkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBBbGxvdyBsb2FkIHJlZnVuZHMgYmFjayBvbiB0aGUgY29udHJhY3QgZm9yIHRoZSByZWZ1bmRpbmcuCiAgICoKICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoZSBtaW5pbXVtIGdvYWwgd2FzIG5vdCByZWFjaGVkLi4KICAgKi8KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7CiAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7CiAgICBsb2FkZWRSZWZ1bmQgPSBsb2FkZWRSZWZ1bmQucGx1cyhtc2cudmFsdWUpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmQuCiAgICoKICAgKiBOb3RlIHRoYXQgYW55IHJlZnVuZHMgZnJvbSBwcm94eSBidXllcnMgc2hvdWxkIGJlIGhhbmRsZWQgc2VwYXJhdGVseSwKICAgKiBhbmQgbm90IHRocm91Z2ggdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5SZWZ1bmRpbmcpIHsKICAgIHVpbnQyNTYgd2VpVmFsdWUgPSBpbnZlc3RlZEFtb3VudE9mW21zZy5zZW5kZXJdOwogICAgaWYgKHdlaVZhbHVlID09IDApIHRocm93OwogICAgaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXSA9IDA7CiAgICB3ZWlSZWZ1bmRlZCA9IHdlaVJlZnVuZGVkLnBsdXMod2VpVmFsdWUpOwogICAgUmVmdW5kKG1zZy5zZW5kZXIsIHdlaVZhbHVlKTsKICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHdlaVZhbHVlKSkgdGhyb3c7CiAgfQoKICAvKioKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4KICAgKi8KICBmdW5jdGlvbiBpc0ZpbmFsaXplclNhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzYW5lKSB7CiAgICByZXR1cm4gZmluYWxpemVBZ2VudC5pc1NhbmUoKTsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjb250cmFjdCByZWxhdGlvbnNoaXAgbG9va3MgZ29vZC4KICAgKi8KICBmdW5jdGlvbiBpc1ByaWNpbmdTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wgc2FuZSkgewogICAgcmV0dXJuIHByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSk7CiAgfQoKICAvKioKICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50LgogICAqCiAgICogV2UgbWFrZSBpdCBhIGZ1bmN0aW9uIGFuZCBkbyBub3QgYXNzaWduIHRoZSByZXN1bHQgdG8gYSB2YXJpYWJsZSwgc28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgewogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOwogICAgZWxzZSBpZiAoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSA9PSAwKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIWZpbmFsaXplQWdlbnQuaXNTYW5lKCkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmICghcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOwogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICB9CgogIC8qKiBUaGlzIGlzIGZvciBtYW51YWwgdGVzdGluZyBvZiBtdWx0aXNpZyB3YWxsZXQgaW50ZXJhY3Rpb24gKi8KICBmdW5jdGlvbiBzZXRPd25lclRlc3RWYWx1ZSh1aW50IHZhbCkgb25seU93bmVyIHsKICAgIG93bmVyVGVzdFZhbHVlID0gdmFsOwogIH0KCiAgLyoqIEludGVyZmFjZSBtYXJrZXIuICovCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLwogIC8vIE1vZGlmaWVycwogIC8vCgogIC8qKiBNb2RpZmllZCBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8KICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7CiAgICBpZihnZXRTdGF0ZSgpICE9IHN0YXRlKSB0aHJvdzsKICAgIF87CiAgfQoKCiAgLy8KICAvLyBBYnN0cmFjdCBmdW5jdGlvbnMKICAvLwoKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBpbnZlc3RlZCBicmVha3Mgb3VyIGNhcCBydWxlcy4KICAgKgogICAqCiAgICogVGhlIGNoaWxkIGNvbnRyYWN0IG11c3QgZGVmaW5lIHRoZWlyIG93biBjYXAgc2V0dGluZyBydWxlcy4KICAgKiBXZSBhbGxvdyBhIGxvdCBvZiBmbGV4aWJpbGl0eSB0aHJvdWdoIGRpZmZlcmVudCBjYXBwaW5nIHN0cmF0ZWdpZXMgKEVUSCwgdG9rZW4gY291bnQpCiAgICogQ2FsbGVkIGZyb20gaW52ZXN0KCkuCiAgICoKICAgKiBAcGFyYW0gd2VpQW1vdW50IFRoZSBhbW91bnQgb2Ygd2VpIHRoZSBpbnZlc3RvciB0cmllcyB0byBpbnZlc3QgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gdG9rZW5BbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgd2UgdHJ5IHRvIGdpdmUgdG8gdGhlIGludmVzdG9yIGluIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIHdlaVJhaXNlZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHJhaXNlZCBiYWxhbmNlIGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gdG9rZW5zU29sZFRvdGFsIFdoYXQgd291bGQgYmUgb3VyIHRvdGFsIHNvbGQgdG9rZW5zIGNvdW50IGFmdGVyIHRoaXMgdHJhbnNhY3Rpb24KICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0YWtpbmcgdGhpcyBpbnZlc3RtZW50IHdvdWxkIGJyZWFrIG91ciBjYXAgcnVsZXMKICAgKi8KICBmdW5jdGlvbiBpc0JyZWFraW5nQ2FwKHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50IHdlaVJhaXNlZFRvdGFsLCB1aW50IHRva2Vuc1NvbGRUb3RhbCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGNyb3dkc2FsZSBpcyBmdWxsIGFuZCB3ZSBjYW4gbm8gbG9uZ2VyIHNlbGwgYW55IHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CgogIC8qKgogICAqIENyZWF0ZSBuZXcgdG9rZW5zIG9yIHRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGRlcGVuZGluZyBvbiB0aGUgY2FwIG1vZGVsLgogICAqLwogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlOwp9CgoKCgoKCgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KY29udHJhY3QgU2FmZU1hdGggewogIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc2FmZURpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPiAwKTsKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgaW50ZXJuYWwgewogICAgaWYgKCFhc3NlcnRpb24pIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQp9CgoKCi8qKgogKiBTdGFuZGFyZCBFUkMyMCB0b2tlbiB3aXRoIFNob3J0IEhhbmQgQXR0YWNrIGFuZCBhcHByb3ZlKCkgcmFjZSBjb25kaXRpb24gbWl0aWdhdGlvbi4KICoKICogQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOgogKiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIFNhZmVNYXRoIHsKCiAgLyogVG9rZW4gc3VwcGx5IGdvdCBpbmNyZWFzZWQgYW5kIGEgbmV3IG93bmVyIHJlY2VpdmVkIHRoZXNlIHRva2VucyAqLwogIGV2ZW50IE1pbnRlZChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCk7CgogIC8qIEFjdHVhbCBiYWxhbmNlcyBvZiB0b2tlbiBob2xkZXJzICovCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwoKICAvKiBhcHByb3ZlKCkgYWxsb3dhbmNlcyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKCiAgLyogSW50ZXJmYWNlIGRlY2xhcmF0aW9uICovCiAgZnVuY3Rpb24gaXNUb2tlbigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHdlQXJlKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9CgoKCgoKLyoqCiAqIFVwZ3JhZGUgYWdlbnQgaW50ZXJmYWNlIGluc3BpcmVkIGJ5IEx1bnlyLgogKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKi8KY29udHJhY3QgVXBncmFkZUFnZW50IHsKCiAgdWludCBwdWJsaWMgb3JpZ2luYWxTdXBwbHk7CgogIC8qKiBJbnRlcmZhY2UgbWFya2VyICovCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB1cGdyYWRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwoKfQoKCi8qKgogKiBBIHRva2VuIHVwZ3JhZGUgbWVjaGFuaXNtIHdoZXJlIHVzZXJzIGNhbiBvcHQtaW4gYW1vdW50IG9mIHRva2VucyB0byB0aGUgbmV4dCBzbWFydCBjb250cmFjdCByZXZpc2lvbi4KICoKICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuCiAqLwpjb250cmFjdCBVcGdyYWRlYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAvKiogQ29udHJhY3QgLyBwZXJzb24gd2hvIGNhbiBzZXQgdGhlIHVwZ3JhZGUgcGF0aC4gVGhpcyBjYW4gYmUgdGhlIHNhbWUgYXMgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIGFzIHdoYXQgaXQgaXMgd2l0aCBpdHMgZGVmYXVsdCB2YWx1ZS4gKi8KICBhZGRyZXNzIHB1YmxpYyB1cGdyYWRlTWFzdGVyOwoKICAvKiogVGhlIG5leHQgY29udHJhY3Qgd2hlcmUgdGhlIHRva2VucyB3aWxsIGJlIG1pZ3JhdGVkLiAqLwogIFVwZ3JhZGVBZ2VudCBwdWJsaWMgdXBncmFkZUFnZW50OwoKICAvKiogSG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgdXBncmFkZWQgYnkgbm93LiAqLwogIHVpbnQyNTYgcHVibGljIHRvdGFsVXBncmFkZWQ7CgogIC8qKgogICAqIFVwZ3JhZGUgc3RhdGVzLgogICAqCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuCiAgICogLSBXYWl0aW5nRm9yQWdlbnQ6IFRva2VuIGFsbG93cyB1cGdyYWRlLCBidXQgd2UgZG9uJ3QgaGF2ZSBhIG5ldyBhZ2VudCB5ZXQKICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldAogICAqIC0gVXBncmFkaW5nOiBVcGdyYWRlIGFnZW50IGlzIHNldCBhbmQgdGhlIGJhbGFuY2UgaG9sZGVycyBjYW4gdXBncmFkZSB0aGVpciB0b2tlbnMKICAgKgogICAqLwogIGVudW0gVXBncmFkZVN0YXRlIHtVbmtub3duLCBOb3RBbGxvd2VkLCBXYWl0aW5nRm9yQWdlbnQsIFJlYWR5VG9VcGdyYWRlLCBVcGdyYWRpbmd9CgogIC8qKgogICAqIFNvbWVib2R5IGhhcyB1cGdyYWRlZCBzb21lIG9mIGhpcyB0b2tlbnMuCiAgICovCiAgZXZlbnQgVXBncmFkZShhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKCiAgLyoqCiAgICogTmV3IHVwZ3JhZGUgYWdlbnQgYXZhaWxhYmxlLgogICAqLwogIGV2ZW50IFVwZ3JhZGVBZ2VudFNldChhZGRyZXNzIGFnZW50KTsKCiAgLyoqCiAgICogRG8gbm90IGFsbG93IGNvbnN0cnVjdGlvbiB3aXRob3V0IHVwZ3JhZGUgbWFzdGVyIHNldC4KICAgKi8KICBmdW5jdGlvbiBVcGdyYWRlYWJsZVRva2VuKGFkZHJlc3MgX3VwZ3JhZGVNYXN0ZXIpIHsKICAgIHVwZ3JhZGVNYXN0ZXIgPSBfdXBncmFkZU1hc3RlcjsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQyNTYgdmFsdWUpIHB1YmxpYyB7CgogICAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgICAgaWYoIShzdGF0ZSA9PSBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGUgfHwgc3RhdGUgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZykpIHsKICAgICAgICAvLyBDYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgICAgICB0aHJvdzsKICAgICAgfQoKICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICAgIGlmICh2YWx1ZSA9PSAwKSB0aHJvdzsKCiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgdmFsdWUpOwoKICAgICAgLy8gVGFrZSB0b2tlbnMgb3V0IGZyb20gY2lyY3VsYXRpb24KICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCB2YWx1ZSk7CiAgICAgIHRvdGFsVXBncmFkZWQgPSBzYWZlQWRkKHRvdGFsVXBncmFkZWQsIHZhbHVlKTsKCiAgICAgIC8vIFVwZ3JhZGUgYWdlbnQgcmVpc3N1ZXMgdGhlIHRva2VucwogICAgICB1cGdyYWRlQWdlbnQudXBncmFkZUZyb20obXNnLnNlbmRlciwgdmFsdWUpOwogICAgICBVcGdyYWRlKG1zZy5zZW5kZXIsIHVwZ3JhZGVBZ2VudCwgdmFsdWUpOwogIH0KCiAgLyoqCiAgICogU2V0IGFuIHVwZ3JhZGUgYWdlbnQgdGhhdCBoYW5kbGVzCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIGV4dGVybmFsIHsKCiAgICAgIGlmKCFjYW5VcGdyYWRlKCkpIHsKICAgICAgICAvLyBUaGUgdG9rZW4gaXMgbm90IHlldCBpbiBhIHN0YXRlIHRoYXQgd2UgY291bGQgdGhpbmsgdXBncmFkaW5nCiAgICAgICAgdGhyb3c7CiAgICAgIH0KCiAgICAgIGlmIChhZ2VudCA9PSAweDApIHRocm93OwogICAgICAvLyBPbmx5IGEgbWFzdGVyIGNhbiBkZXNpZ25hdGUgdGhlIG5leHQgYWdlbnQKICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gdXBncmFkZU1hc3RlcikgdGhyb3c7CiAgICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50CiAgICAgIGlmIChnZXRVcGdyYWRlU3RhdGUoKSA9PSBVcGdyYWRlU3RhdGUuVXBncmFkaW5nKSB0aHJvdzsKCiAgICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7CgogICAgICAvLyBCYWQgaW50ZXJmYWNlCiAgICAgIGlmKCF1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSkgdGhyb3c7CiAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRva2VuIHN1cHBsaWVzIG1hdGNoIGluIHNvdXJjZSBhbmQgdGFyZ2V0CiAgICAgIGlmICh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSAhPSB0b3RhbFN1cHBseSkgdGhyb3c7CgogICAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoVXBncmFkZVN0YXRlKSB7CiAgICBpZighY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmKGFkZHJlc3ModXBncmFkZUFnZW50KSA9PSAweDAwKSByZXR1cm4gVXBncmFkZVN0YXRlLldhaXRpbmdGb3JBZ2VudDsKICAgIGVsc2UgaWYodG90YWxVcGdyYWRlZCA9PSAwKSByZXR1cm4gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlOwogICAgZWxzZSByZXR1cm4gVXBncmFkZVN0YXRlLlVwZ3JhZGluZzsKICB9CgogIC8qKgogICAqIENoYW5nZSB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICoKICAgKiBUaGlzIGFsbG93cyB1cyB0byBzZXQgYSBuZXcgb3duZXIgZm9yIHRoZSB1cGdyYWRlIG1lY2hhbmlzbS4KICAgKi8KICBmdW5jdGlvbiBzZXRVcGdyYWRlTWFzdGVyKGFkZHJlc3MgbWFzdGVyKSBwdWJsaWMgewogICAgICBpZiAobWFzdGVyID09IDB4MCkgdGhyb3c7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpIHRocm93OwogICAgICB1cGdyYWRlTWFzdGVyID0gbWFzdGVyOwogIH0KCiAgLyoqCiAgICogQ2hpbGQgY29udHJhY3QgY2FuIGVuYWJsZSB0byBwcm92aWRlIHRoZSBjb25kaXRpb24gd2hlbiB0aGUgdXBncmFkZSBjYW4gYmVndW4uCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgoKCgoKCi8qKgogKiBEZWZpbmUgaW50ZXJmYWNlIGZvciByZWxlYXNpbmcgdGhlIHRva2VuIHRyYW5zZmVyIGFmdGVyIGEgc3VjY2Vzc2Z1bCBjcm93ZHNhbGUuCiAqLwpjb250cmFjdCBSZWxlYXNhYmxlVG9rZW4gaXMgRVJDMjAsIE93bmFibGUgewoKICAvKiBUaGUgZmluYWxpemVyIGNvbnRyYWN0IHRoYXQgYWxsb3dzIHVubGlmdCB0aGUgdHJhbnNmZXIgbGltaXRzIG9uIHRoaXMgdG9rZW4gKi8KICBhZGRyZXNzIHB1YmxpYyByZWxlYXNlQWdlbnQ7CgogIC8qKiBBIGNyb3dkc2FsZSBjb250cmFjdCBjYW4gcmVsZWFzZSB1cyB0byB0aGUgd2lsZCBpZiBJQ08gc3VjY2Vzcy4gSWYgZmFsc2Ugd2UgYXJlIGFyZSBpbiB0cmFuc2ZlciBsb2NrIHVwIHBlcmlvZC4qLwogIGJvb2wgcHVibGljIHJlbGVhc2VkID0gZmFsc2U7CgogIC8qKiBNYXAgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gdHJhbnNmZXIgdG9rZW5zIHJlZ2FyZGxlc3Mgb2YgdGhlIGxvY2sgZG93biBwZXJpb2QuIFRoZXNlIGFyZSBjcm93ZHNhbGUgY29udHJhY3RzIGFuZCBwb3NzaWJsZSB0aGUgdGVhbSBtdWx0aXNpZyBpdHNlbGYuICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgdHJhbnNmZXJBZ2VudHM7CgogIC8qKgogICAqIExpbWl0IHRva2VuIHRyYW5zZmVyIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KICAgKgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKGFkZHJlc3MgX3NlbmRlcikgewoKICAgIGlmKCFyZWxlYXNlZCkgewogICAgICAgIGlmKCF0cmFuc2ZlckFnZW50c1tfc2VuZGVyXSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9CgogICAgXzsKICB9CgogIC8qKgogICAqIFNldCB0aGUgY29udHJhY3QgdGhhdCBjYW4gY2FsbCByZWxlYXNlIGFuZCBtYWtlIHRoZSB0b2tlbiB0cmFuc2ZlcmFibGUuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlLiBBbGxvdyByZXNldCB0aGUgcmVsZWFzZSBhZ2VudCB0byBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CgogICAgLy8gV2UgZG9uJ3QgZG8gaW50ZXJmYWNlIGNoZWNrIGhlcmUgYXMgd2UgbWlnaHQgd2FudCB0byBhIG5vcm1hbCB3YWxsZXQgYWRkcmVzcyB0byBhY3QgYXMgYSByZWxlYXNlIGFnZW50CiAgICByZWxlYXNlQWdlbnQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgcGFydGljdWxhciBhZGRyZXNzIChhIGNyb3dkc2FsZSBjb250cmFjdCkgdG8gdHJhbnNmZXIgdG9rZW5zIGRlc3BpdGUgdGhlIGxvY2sgdXAgcGVyaW9kLgogICAqLwogIGZ1bmN0aW9uIHNldFRyYW5zZmVyQWdlbnQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICB0cmFuc2ZlckFnZW50c1thZGRyXSA9IHN0YXRlOwogIH0KCiAgLyoqCiAgICogT25lIHdheSBmdW5jdGlvbiB0byByZWxlYXNlIHRoZSB0b2tlbnMgdG8gdGhlIHdpbGQuCiAgICoKICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IGlzIHRoZSBmaW5hbCBJQ08gY29udHJhY3QuIEl0IGlzIG9ubHkgY2FsbGVkIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGJlZW4gc3VjY2VzcyAoZmlyc3QgbWlsZXN0b25lIHJlYWNoZWQpLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgcmVsZWFzZWQgPSB0cnVlOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYmVmb3JlIG9yIGFmdGVyIHRoZSB0b2tlbnMgaGF2ZSBiZWVuIHJlbGVhc2VzZCAqLwogIG1vZGlmaWVyIGluUmVsZWFzZVN0YXRlKGJvb2wgcmVsZWFzZVN0YXRlKSB7CiAgICBpZihyZWxlYXNlU3RhdGUgIT0gcmVsZWFzZWQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBhIHdoaXRlbGlzdGVkIHJlbGVhc2UgYWdlbnQuICovCiAgbW9kaWZpZXIgb25seVJlbGVhc2VBZ2VudCgpIHsKICAgIGlmKG1zZy5zZW5kZXIgIT0gcmVsZWFzZUFnZW50KSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlcigpCiAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBjYW5UcmFuc2ZlcihfZnJvbSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXJGb3JtKCkKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9Cgp9CgoKCgoKCgovKioKICogQSB0b2tlbiB0aGF0IGNhbiBpbmNyZWFzZSBpdHMgc3VwcGx5IGJ5IGFub3RoZXIgY29udHJhY3QuCiAqCiAqIFRoaXMgYWxsb3dzIHVuY2FwcGVkIGNyb3dkc2FsZSBieSBkeW5hbWljYWxseSBpbmNyZWFzaW5nIHRoZSBzdXBwbHkgd2hlbiBtb25leSBwb3VycyBpbi4KICogT25seSBtaW50IGFnZW50cywgY29udHJhY3RzIHdoaXRlbGlzdGVkIGJ5IG93bmVyLCBjYW4gbWludCBuZXcgdG9rZW5zLgogKgogKi8KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKICAvKiogTGlzdCBvZiBhZ2VudHMgdGhhdCBhcmUgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHRva2VucyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIG1pbnRBZ2VudHM7CgogIGV2ZW50IE1pbnRpbmdBZ2VudENoYW5nZWQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlICApOwoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLi4KICAgKgogICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIG9ubHlNaW50QWdlbnQgY2FuTWludCBwdWJsaWMgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5wbHVzKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0ucGx1cyhhbW91bnQpOwoKICAgIC8vIFRoaXMgd2lsbCBtYWtlIHRoZSBtaW50IHRyYW5zYWN0aW9uIGFwcGVyIGluIEV0aGVyU2Nhbi5pbwogICAgLy8gV2UgY2FuIHJlbW92ZSB0aGlzIGFmdGVyIHRoZXJlIGlzIGEgc3RhbmRhcmRpemVkIG1pbnRpbmcgZXZlbnQKICAgIFRyYW5zZmVyKDAsIHJlY2VpdmVyLCBhbW91bnQpOwogIH0KCiAgLyoqCiAgICogT3duZXIgY2FuIGFsbG93IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHRvIG1pbnQgbmV3IHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBzZXRNaW50QWdlbnQoYWRkcmVzcyBhZGRyLCBib29sIHN0YXRlKSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgewogICAgbWludEFnZW50c1thZGRyXSA9IHN0YXRlOwogICAgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyLCBzdGF0ZSk7CiAgfQoKICBtb2RpZmllciBvbmx5TWludEFnZW50KCkgewogICAgLy8gT25seSBjcm93ZHNhbGUgY29udHJhY3RzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIGlmKG1pbnRpbmdGaW5pc2hlZCkgdGhyb3c7CiAgICBfOwogIH0KfQoKCgovKioKICogQSBjcm93ZHNhbGVkIHRva2VuLgogKgogKiBBbiBFUkMtMjAgdG9rZW4gZGVzaWduZWQgc3BlY2lmaWNhbGx5IGZvciBjcm93ZHNhbGVzIHdpdGggaW52ZXN0b3IgcHJvdGVjdGlvbiBhbmQgZnVydGhlciBkZXZlbG9wbWVudCBwYXRoLgogKgogKiAtIFRoZSB0b2tlbiB0cmFuc2ZlcigpIGlzIGRpc2FibGVkIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3ZlcgogKiAtIFRoZSB0b2tlbiBjb250cmFjdCBnaXZlcyBhbiBvcHQtaW4gdXBncmFkZSBwYXRoIHRvIGEgbmV3IGNvbnRyYWN0CiAqIC0gVGhlIHNhbWUgdG9rZW4gY2FuIGJlIHBhcnQgb2Ygc2V2ZXJhbCBjcm93ZHNhbGVzIHRocm91Z2ggYXBwcm92ZSgpIG1lY2hhbmlzbQogKiAtIFRoZSB0b2tlbiBjYW4gYmUgY2FwcGVkIChzdXBwbHkgc2V0IGluIHRoZSBjb25zdHJ1Y3Rvcikgb3IgdW5jYXBwZWQgKGNyb3dkc2FsZSBjb250cmFjdCBjYW4gbWludCBuZXcgdG9rZW5zKQogKgogKi8KY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gaXMgUmVsZWFzYWJsZVRva2VuLCBNaW50YWJsZVRva2VuLCBVcGdyYWRlYWJsZVRva2VuIHsKCiAgLyoqIE5hbWUgYW5kIHN5bWJvbCB3ZXJlIHVwZGF0ZWQuICovCiAgZXZlbnQgVXBkYXRlZFRva2VuSW5mb3JtYXRpb24oc3RyaW5nIG5ld05hbWUsIHN0cmluZyBuZXdTeW1ib2wpOwoKICBzdHJpbmcgcHVibGljIG5hbWU7CgogIHN0cmluZyBwdWJsaWMgc3ltYm9sOwoKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKCiAgLyoqCiAgICogQ29uc3RydWN0IHRoZSB0b2tlbi4KICAgKgogICAqIFRoaXMgdG9rZW4gbXVzdCBiZSBjcmVhdGVkIHRocm91Z2ggYSB0ZWFtIG11bHRpc2lnIHdhbGxldCwgc28gdGhhdCBpdCBpcyBvd25lZCBieSB0aGF0IHdhbGxldC4KICAgKgogICAqIEBwYXJhbSBfbmFtZSBUb2tlbiBuYW1lCiAgICogQHBhcmFtIF9zeW1ib2wgVG9rZW4gc3ltYm9sIC0gc2hvdWxkIGJlIGFsbCBjYXBzCiAgICogQHBhcmFtIF9pbml0aWFsU3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoCiAgICogQHBhcmFtIF9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMKICAgKiBAcGFyYW0gX21pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50IF9pbml0aWFsU3VwcGx5LCB1aW50IF9kZWNpbWFscywgYm9vbCBfbWludGFibGUpCiAgICBVcGdyYWRlYWJsZVRva2VuKG1zZy5zZW5kZXIpIHsKCiAgICAvLyBDcmVhdGUgYW55IGFkZHJlc3MsIGNhbiBiZSB0cmFuc2ZlcnJlZAogICAgLy8gdG8gdGVhbSBtdWx0aXNpZyB2aWEgY2hhbmdlT3duZXIoKSwKICAgIC8vIGFsc28gcmVtZW1iZXIgdG8gY2FsbCBzZXRVcGdyYWRlTWFzdGVyKCkKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICBuYW1lID0gX25hbWU7CiAgICBzeW1ib2wgPSBfc3ltYm9sOwoKICAgIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHk7CgogICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CgogICAgLy8gQ3JlYXRlIGluaXRpYWxseSBhbGwgYmFsYW5jZSBvbiB0aGUgdGVhbSBtdWx0aXNpZwogICAgYmFsYW5jZXNbb3duZXJdID0gdG90YWxTdXBwbHk7CgogICAgaWYodG90YWxTdXBwbHkgPiAwKSB7CiAgICAgIE1pbnRlZChvd25lciwgdG90YWxTdXBwbHkpOwogICAgfQoKICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbgogICAgaWYoIV9taW50YWJsZSkgewogICAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgICBpZih0b3RhbFN1cHBseSA9PSAwKSB7CiAgICAgICAgdGhyb3c7IC8vIENhbm5vdCBjcmVhdGUgYSB0b2tlbiB3aXRob3V0IHN1cHBseSBhbmQgbm8gbWludGluZwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBXaGVuIHRva2VuIGlzIHJlbGVhc2VkIHRvIGJlIHRyYW5zZmVyYWJsZSwgZW5mb3JjZSBubyBuZXcgdG9rZW5zIGNhbiBiZSBjcmVhdGVkLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIHN1cGVyLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB1cGdyYWRlIGFnZW50IGZ1bmN0aW9uYWxpdHkga2ljayBpbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgd2FzIHN1Y2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiByZWxlYXNlZCAmJiBzdXBlci5jYW5VcGdyYWRlKCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gdXBkYXRlIHRva2VuIGluZm9ybWF0aW9uIGhlcmUuCiAgICoKICAgKiBJdCBpcyBvZnRlbiB1c2VmdWwgdG8gY29uY2VhbCB0aGUgYWN0dWFsIHRva2VuIGFzc29jaWF0aW9uLCB1bnRpbAogICAqIHRoZSB0b2tlbiBvcGVyYXRpb25zLCBsaWtlIGNlbnRyYWwgaXNzdWFuY2Ugb3IgcmVpc3N1YW5jZSBoYXZlIGJlZW4gY29tcGxldGVkLgogICAqCiAgICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgdGhlIHRva2VuIG93bmVyIHRvIHJlbmFtZSB0aGUgdG9rZW4gYWZ0ZXIgdGhlIG9wZXJhdGlvbnMKICAgKiBoYXZlIGJlZW4gY29tcGxldGVkIGFuZCB0aGVuIHBvaW50IHRoZSBhdWRpZW5jZSB0byB1c2UgdGhlIHRva2VuIGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIHNldFRva2VuSW5mb3JtYXRpb24oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCkgb25seU93bmVyIHsKICAgIG5hbWUgPSBfbmFtZTsKICAgIHN5bWJvbCA9IF9zeW1ib2w7CgogICAgVXBkYXRlZFRva2VuSW5mb3JtYXRpb24obmFtZSwgc3ltYm9sKTsKICB9Cgp9CgoKCi8qKgogKiBBdCB0aGUgZW5kIG9mIHRoZSBzdWNjZXNzZnVsIGNyb3dkc2FsZSBhbGxvY2F0ZSAlIGJvbnVzIG9mIHRva2VucyB0byB0aGUgdGVhbS4KICoKICogVW5sb2NrIHRva2Vucy4KICoKICogQm9udXNBbGxvY2F0aW9uRmluYWwgbXVzdCBiZSBzZXQgYXMgdGhlIG1pbnRpbmcgYWdlbnQgZm9yIHRoZSBNaW50YWJsZVRva2VuLgogKgogKi8KY29udHJhY3QgQm9udXNGaW5hbGl6ZUFnZW50IGlzIEZpbmFsaXplQWdlbnQgewoKICB1c2luZyBTYWZlTWF0aExpYiBmb3IgdWludDsKCiAgQ3Jvd2RzYWxlVG9rZW4gcHVibGljIHRva2VuOwogIENyb3dkc2FsZSBwdWJsaWMgY3Jvd2RzYWxlOwoKICAvKiogVG90YWwgcGVyY2VudCBvZiB0b2tlbnMgbWludGVkIHRvIHRoZSB0ZWFtIGF0IHRoZSBlbmQgb2YgdGhlIHNhbGUgYXMgYmFzZSBwb2ludHMgKDAuMDAwMSkgKi8KICB1aW50IHB1YmxpYyBib251c0Jhc2VQb2ludHM7CgogIC8qKiBXaGVyZSB3ZSBtb3ZlIHRoZSB0b2tlbnMgYXQgdGhlIGVuZCBvZiB0aGUgc2FsZS4gKi8KICBhZGRyZXNzIHB1YmxpYyB0ZWFtTXVsdGlzaWc7CgogIC8qIEhvdyBtdWNoIGJvbnVzIHRva2VucyB3ZSBhbGxvY2F0ZWQgKi8KICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRCb251czsKCiAgZnVuY3Rpb24gQm9udXNGaW5hbGl6ZUFnZW50KENyb3dkc2FsZVRva2VuIF90b2tlbiwgQ3Jvd2RzYWxlIF9jcm93ZHNhbGUsIHVpbnQgX2JvbnVzQmFzZVBvaW50cywgYWRkcmVzcyBfdGVhbU11bHRpc2lnKSB7CiAgICB0b2tlbiA9IF90b2tlbjsKICAgIGNyb3dkc2FsZSA9IF9jcm93ZHNhbGU7CiAgICBpZihhZGRyZXNzKGNyb3dkc2FsZSkgPT0gMCkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICB0ZWFtTXVsdGlzaWcgPSBfdGVhbU11bHRpc2lnOwogICAgaWYoYWRkcmVzcyh0ZWFtTXVsdGlzaWcpID09IDApIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgYm9udXNCYXNlUG9pbnRzID0gX2JvbnVzQmFzZVBvaW50czsKICB9CgogIC8qIENhbiB3ZSBydW4gZmluYWxpemUgcHJvcGVybHkgKi8KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuICh0b2tlbi5taW50QWdlbnRzKGFkZHJlc3ModGhpcykpID09IHRydWUpICYmICh0b2tlbi5yZWxlYXNlQWdlbnQoKSA9PSBhZGRyZXNzKHRoaXMpKTsKICB9CgogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpIHsKICAgIGlmKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyhjcm93ZHNhbGUpKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIC8vIEhvdyBtYW55ICUgb2YgdG9rZW5zIHRoZSBmb3VuZGVycyBhbmQgb3RoZXJzIGdldAogICAgdWludCB0b2tlbnNTb2xkID0gY3Jvd2RzYWxlLnRva2Vuc1NvbGQoKTsKICAgIGFsbG9jYXRlZEJvbnVzID0gdG9rZW5zU29sZC50aW1lcyhib251c0Jhc2VQb2ludHMpIC8gMTAwMDA7CgogICAgLy8gbW92ZSB0b2tlbnMgdG8gdGhlIHRlYW0gbXVsdGlzaWcgd2FsbGV0CiAgICB0b2tlbi5taW50KHRlYW1NdWx0aXNpZywgYWxsb2NhdGVkQm9udXMpOwoKICAgIC8vIE1ha2UgdG9rZW4gdHJhbnNmZXJhYmxlCiAgICB0b2tlbi5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCn0='.
	

]
