Class {
	#name : #SRTba313f80d9a23fa5eeea4beda94f87b35c74cb04,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTba313f80d9a23fa5eeea4beda94f87b35c74cb04 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKY29udHJhY3QgT3duZWQgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgZnVuY3Rpb24gT3duZWQoKSAKICAgIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIAogICAgICAgIG9ubHlPd25lciAKICAgIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmxpYnJhcnkgU2FmZU1hdGgzMiB7CiAgZnVuY3Rpb24gYWRkKHVpbnQzMiBhLCB1aW50MzIgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MzIpIHsKICAgIHVpbnQzMiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgQmFsYW5jZUhvbGRlciB7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlT2Y7CgogICAgZXZlbnQgTG9nV2l0aGRyYXcoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHVzZXIsCiAgICAgICAgdWludDI1NiBhbW91bnQKICAgICk7CgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSAKICAgIHB1YmxpYyB7CiAgICAgICAgdWludDI1NiBiYWwgPSBiYWxhbmNlT2ZbbXNnLnNlbmRlcl07CiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gMDsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGJhbCk7CiAgICAgICAgTG9nV2l0aGRyYXcobXNnLnNlbmRlciwgYmFsKTsKICAgIH0KCn0KCgpjb250cmFjdCBSZWFsaXR5Q2hlY2sgaXMgQmFsYW5jZUhvbGRlciB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICB1c2luZyBTYWZlTWF0aDMyIGZvciB1aW50MzI7CgogICAgYWRkcmVzcyBjb25zdGFudCBOVUxMX0FERFJFU1MgPSBhZGRyZXNzKDApOwoKICAgIC8vIEhpc3RvcnkgaGFzaCB3aGVuIG5vIGhpc3RvcnkgaXMgY3JlYXRlZCwgb3IgaGlzdG9yeSBoYXMgYmVlbiBjbGVhcmVkCiAgICBieXRlczMyIGNvbnN0YW50IE5VTExfSEFTSCA9IGJ5dGVzMzIoMCk7CgogICAgLy8gQW4gdW5pdGluYWxpemVkIGZpbmFsaXplX3RzIGZvciBhIHF1ZXN0aW9uIHdpbGwgaW5kaWNhdGUgYW4gdW5hbnN3ZXJlZCBxdWVzdGlvbi4KICAgIHVpbnQzMiBjb25zdGFudCBVTkFOU1dFUkVEID0gMDsKCiAgICAvLyBBbiB1bmFuc3dlcmVkIHJldmVhbF90cyBmb3IgYSBjb21taXRtZW50IHdpbGwgaW5kaWNhdGUgdGhhdCBpdCBkb2VzIG5vdCBleGlzdC4KICAgIHVpbnQyNTYgY29uc3RhbnQgQ09NTUlUTUVOVF9OT05fRVhJU1RFTlQgPSAwOwoKICAgIC8vIENvbW1pdC0+cmV2ZWFsIHRpbWVvdXQgaXMgMS84IG9mIHRoZSBxdWVzdGlvbiB0aW1lb3V0IChyb3VuZGVkIGRvd24pLgogICAgdWludDMyIGNvbnN0YW50IENPTU1JVE1FTlRfVElNRU9VVF9SQVRJTyA9IDg7CgogICAgZXZlbnQgTG9nU2V0UXVlc3Rpb25GZWUoCiAgICAgICAgYWRkcmVzcyBhcmJpdHJhdG9yLAogICAgICAgIHVpbnQyNTYgYW1vdW50CiAgICApOwoKICAgIGV2ZW50IExvZ05ld1RlbXBsYXRlKAogICAgICAgIHVpbnQyNTYgaW5kZXhlZCB0ZW1wbGF0ZV9pZCwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgdXNlciwgCiAgICAgICAgc3RyaW5nIHF1ZXN0aW9uX3RleHQKICAgICk7CgogICAgZXZlbnQgTG9nTmV3UXVlc3Rpb24oCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIHF1ZXN0aW9uX2lkLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCB1c2VyLCAKICAgICAgICB1aW50MjU2IHRlbXBsYXRlX2lkLAogICAgICAgIHN0cmluZyBxdWVzdGlvbiwKICAgICAgICBieXRlczMyIGluZGV4ZWQgY29udGVudF9oYXNoLAogICAgICAgIGFkZHJlc3MgYXJiaXRyYXRvciwgCiAgICAgICAgdWludDMyIHRpbWVvdXQsCiAgICAgICAgdWludDMyIG9wZW5pbmdfdHMsCiAgICAgICAgdWludDI1NiBub25jZSwKICAgICAgICB1aW50MjU2IGNyZWF0ZWQKICAgICk7CgogICAgZXZlbnQgTG9nRnVuZEFuc3dlckJvdW50eSgKICAgICAgICBieXRlczMyIGluZGV4ZWQgcXVlc3Rpb25faWQsCiAgICAgICAgdWludDI1NiBib3VudHlfYWRkZWQsCiAgICAgICAgdWludDI1NiBib3VudHksCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHVzZXIgCiAgICApOwoKICAgIGV2ZW50IExvZ05ld0Fuc3dlcigKICAgICAgICBieXRlczMyIGFuc3dlciwKICAgICAgICBieXRlczMyIGluZGV4ZWQgcXVlc3Rpb25faWQsCiAgICAgICAgYnl0ZXMzMiBoaXN0b3J5X2hhc2gsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHVzZXIsCiAgICAgICAgdWludDI1NiBib25kLAogICAgICAgIHVpbnQyNTYgdHMsCiAgICAgICAgYm9vbCBpc19jb21taXRtZW50CiAgICApOwoKICAgIGV2ZW50IExvZ0Fuc3dlclJldmVhbCgKICAgICAgICBieXRlczMyIGluZGV4ZWQgcXVlc3Rpb25faWQsIAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCB1c2VyLCAKICAgICAgICBieXRlczMyIGluZGV4ZWQgYW5zd2VyX2hhc2gsIAogICAgICAgIGJ5dGVzMzIgYW5zd2VyLCAKICAgICAgICB1aW50MjU2IG5vbmNlLCAKICAgICAgICB1aW50MjU2IGJvbmQKICAgICk7CgogICAgZXZlbnQgTG9nTm90aWZ5T2ZBcmJpdHJhdGlvblJlcXVlc3QoCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIHF1ZXN0aW9uX2lkLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCB1c2VyIAogICAgKTsKCiAgICBldmVudCBMb2dGaW5hbGl6ZSgKICAgICAgICBieXRlczMyIGluZGV4ZWQgcXVlc3Rpb25faWQsCiAgICAgICAgYnl0ZXMzMiBpbmRleGVkIGFuc3dlcgogICAgKTsKCiAgICBldmVudCBMb2dDbGFpbSgKICAgICAgICBieXRlczMyIGluZGV4ZWQgcXVlc3Rpb25faWQsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHVzZXIsCiAgICAgICAgdWludDI1NiBhbW91bnQKICAgICk7CgogICAgc3RydWN0IFF1ZXN0aW9uIHsKICAgICAgICBieXRlczMyIGNvbnRlbnRfaGFzaDsKICAgICAgICBhZGRyZXNzIGFyYml0cmF0b3I7CiAgICAgICAgdWludDMyIG9wZW5pbmdfdHM7CiAgICAgICAgdWludDMyIHRpbWVvdXQ7CiAgICAgICAgdWludDMyIGZpbmFsaXplX3RzOwogICAgICAgIGJvb2wgaXNfcGVuZGluZ19hcmJpdHJhdGlvbjsKICAgICAgICB1aW50MjU2IGJvdW50eTsKICAgICAgICBieXRlczMyIGJlc3RfYW5zd2VyOwogICAgICAgIGJ5dGVzMzIgaGlzdG9yeV9oYXNoOwogICAgICAgIHVpbnQyNTYgYm9uZDsKICAgIH0KCiAgICAvLyBTdG9yZWQgaW4gYSBtYXBwaW5nIGluZGV4ZWQgYnkgY29tbWl0bWVudF9pZCwgYSBoYXNoIG9mIGNvbW1pdG1lbnQgaGFzaCwgcXVlc3Rpb24sIGJvbmQuIAogICAgc3RydWN0IENvbW1pdG1lbnQgewogICAgICAgIHVpbnQzMiByZXZlYWxfdHM7CiAgICAgICAgYm9vbCBpc19yZXZlYWxlZDsKICAgICAgICBieXRlczMyIHJldmVhbGVkX2Fuc3dlcjsKICAgIH0KCiAgICAvLyBPbmx5IHVzZWQgd2hlbiBjbGFpbWluZyBtb3JlIGJvbmRzIHRoYW4gZml0cyBpbnRvIGEgdHJhbnNhY3Rpb24KICAgIC8vIFN0b3JlZCBpbiBhIG1hcHBpbmcgaW5kZXhlZCBieSBxdWVzdGlvbl9pZC4KICAgIHN0cnVjdCBDbGFpbSB7CiAgICAgICAgYWRkcmVzcyBwYXllZTsKICAgICAgICB1aW50MjU2IGxhc3RfYm9uZDsKICAgICAgICB1aW50MjU2IHF1ZXVlZF9mdW5kczsKICAgIH0KCiAgICB1aW50MjU2IG5leHRUZW1wbGF0ZUlEID0gMDsKICAgIG1hcHBpbmcodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgdGVtcGxhdGVzOwogICAgbWFwcGluZyhieXRlczMyID0+IFF1ZXN0aW9uKSBwdWJsaWMgcXVlc3Rpb25zOwogICAgbWFwcGluZyhieXRlczMyID0+IENsYWltKSBxdWVzdGlvbl9jbGFpbXM7CiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gQ29tbWl0bWVudCkgcHVibGljIGNvbW1pdG1lbnRzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBhcmJpdHJhdG9yX3F1ZXN0aW9uX2ZlZXM7IAoKICAgIG1vZGlmaWVyIG9ubHlBcmJpdHJhdG9yKGJ5dGVzMzIgcXVlc3Rpb25faWQpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5hcmJpdHJhdG9yKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHN0YXRlQW55KCkgewogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgc3RhdGVOb3RDcmVhdGVkKGJ5dGVzMzIgcXVlc3Rpb25faWQpIHsKICAgICAgICByZXF1aXJlKHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0udGltZW91dCA9PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHN0YXRlT3BlbihieXRlczMyIHF1ZXN0aW9uX2lkKSB7CiAgICAgICAgcmVxdWlyZShxdWVzdGlvbnNbcXVlc3Rpb25faWRdLnRpbWVvdXQgPiAwKTsgLy8gQ2hlY2sgZXhpc3RlbmNlCiAgICAgICAgcmVxdWlyZSghcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5pc19wZW5kaW5nX2FyYml0cmF0aW9uKTsKICAgICAgICB1aW50MzIgZmluYWxpemVfdHMgPSBxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmZpbmFsaXplX3RzOwogICAgICAgIHJlcXVpcmUoZmluYWxpemVfdHMgPT0gVU5BTlNXRVJFRCB8fCBmaW5hbGl6ZV90cyA+IHVpbnQzMihub3cpKTsKICAgICAgICB1aW50MzIgb3BlbmluZ190cyA9IHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0ub3BlbmluZ190czsKICAgICAgICByZXF1aXJlKG9wZW5pbmdfdHMgPT0gMCB8fCBvcGVuaW5nX3RzIDw9IHVpbnQzMihub3cpKTsgCiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBzdGF0ZVBlbmRpbmdBcmJpdHJhdGlvbihieXRlczMyIHF1ZXN0aW9uX2lkKSB7CiAgICAgICAgcmVxdWlyZShxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmlzX3BlbmRpbmdfYXJiaXRyYXRpb24pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgc3RhdGVGaW5hbGl6ZWQoYnl0ZXMzMiBxdWVzdGlvbl9pZCkgewogICAgICAgIHJlcXVpcmUoaXNGaW5hbGl6ZWQocXVlc3Rpb25faWQpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGJvbmRNdXN0QmVaZXJvKCkgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgYm9uZE11c3REb3VibGUoYnl0ZXMzMiBxdWVzdGlvbl9pZCkgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7IAogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IChxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmJvbmQubXVsKDIpKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBwcmV2aW91c0JvbmRNdXN0Tm90QmVhdE1heFByZXZpb3VzKGJ5dGVzMzIgcXVlc3Rpb25faWQsIHVpbnQyNTYgbWF4X3ByZXZpb3VzKSB7CiAgICAgICAgaWYgKG1heF9wcmV2aW91cyA+IDApIHsKICAgICAgICAgICAgcmVxdWlyZShxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmJvbmQgPD0gbWF4X3ByZXZpb3VzKTsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3Rvciwgc2V0cyB1cCBzb21lIGluaXRpYWwgdGVtcGxhdGVzCiAgICAvLy8gQGRldiBDcmVhdGVzIHNvbWUgZ2VuZXJhbGl6ZWQgdGVtcGxhdGVzIGZvciBkaWZmZXJlbnQgcXVlc3Rpb24gdHlwZXMgdXNlZCBpbiB0aGUgREFwcC4KICAgIGZ1bmN0aW9uIFJlYWxpdHlDaGVjaygpIAogICAgcHVibGljIHsKICAgICAgICBjcmVhdGVUZW1wbGF0ZSgneyJ0aXRsZSI6ICIlcyIsICJ0eXBlIjogImJvb2wiLCAiY2F0ZWdvcnkiOiAiJXMifScpOwogICAgICAgIGNyZWF0ZVRlbXBsYXRlKCd7InRpdGxlIjogIiVzIiwgInR5cGUiOiAidWludCIsICJkZWNpbWFscyI6IDE4LCAiY2F0ZWdvcnkiOiAiJXMifScpOwogICAgICAgIGNyZWF0ZVRlbXBsYXRlKCd7InRpdGxlIjogIiVzIiwgInR5cGUiOiAiaW50IiwgImRlY2ltYWxzIjogMTgsICJjYXRlZ29yeSI6ICIlcyJ9Jyk7CiAgICAgICAgY3JlYXRlVGVtcGxhdGUoJ3sidGl0bGUiOiAiJXMiLCAidHlwZSI6ICJzaW5nbGUtc2VsZWN0IiwgIm91dGNvbWVzIjogWyVzXSwgImNhdGVnb3J5IjogIiVzIn0nKTsKICAgICAgICBjcmVhdGVUZW1wbGF0ZSgneyJ0aXRsZSI6ICIlcyIsICJ0eXBlIjogIm11bHRpcGxlLXNlbGVjdCIsICJvdXRjb21lcyI6IFslc10sICJjYXRlZ29yeSI6ICIlcyJ9Jyk7CiAgICAgICAgY3JlYXRlVGVtcGxhdGUoJ3sidGl0bGUiOiAiJXMiLCAidHlwZSI6ICJkYXRldGltZSIsICJjYXRlZ29yeSI6ICIlcyJ9Jyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gZm9yIGFyYml0cmF0b3IgdG8gc2V0IGFuIG9wdGlvbmFsIHBlci1xdWVzdGlvbiBmZWUuIAogICAgLy8vIEBkZXYgVGhlIHBlci1xdWVzdGlvbiBmZWUsIGNoYXJnZWQgd2hlbiBhIHF1ZXN0aW9uIGlzIGFza2VkLCBpcyBpbnRlbmRlZCBhcyBhbiBhbnRpLXNwYW0gbWVhc3VyZS4KICAgIC8vLyBAcGFyYW0gZmVlIFRoZSBmZWUgdG8gYmUgY2hhcmdlZCBieSB0aGUgYXJiaXRyYXRvciB3aGVuIGEgcXVlc3Rpb24gaXMgYXNrZWQKICAgIGZ1bmN0aW9uIHNldFF1ZXN0aW9uRmVlKHVpbnQyNTYgZmVlKSAKICAgICAgICBzdGF0ZUFueSgpIAogICAgZXh0ZXJuYWwgewogICAgICAgIGFyYml0cmF0b3JfcXVlc3Rpb25fZmVlc1ttc2cuc2VuZGVyXSA9IGZlZTsKICAgICAgICBMb2dTZXRRdWVzdGlvbkZlZShtc2cuc2VuZGVyLCBmZWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENyZWF0ZSBhIHJldXNhYmxlIHRlbXBsYXRlLCB3aGljaCBzaG91bGQgYmUgYSBKU09OIGRvY3VtZW50LgogICAgLy8vIFBsYWNlaG9sZGVycyBzaG91bGQgdXNlIGdldHRleHQoKSBzeW50YXgsIGVnICVzLgogICAgLy8vIEBkZXYgVGVtcGxhdGUgZGF0YSBpcyBvbmx5IHN0b3JlZCBpbiB0aGUgZXZlbnQgbG9ncywgYnV0IGl0cyBibG9jayBudW1iZXIgaXMga2VwdCBpbiBjb250cmFjdCBzdG9yYWdlLgogICAgLy8vIEBwYXJhbSBjb250ZW50IFRoZSB0ZW1wbGF0ZSBjb250ZW50CiAgICAvLy8gQHJldHVybiBUaGUgSUQgb2YgdGhlIG5ld2x5LWNyZWF0ZWQgdGVtcGxhdGUsIHdoaWNoIGlzIGNyZWF0ZWQgc2VxdWVudGlhbGx5LgogICAgZnVuY3Rpb24gY3JlYXRlVGVtcGxhdGUoc3RyaW5nIGNvbnRlbnQpIAogICAgICAgIHN0YXRlQW55KCkKICAgIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBpZCA9IG5leHRUZW1wbGF0ZUlEOwogICAgICAgIHRlbXBsYXRlc1tpZF0gPSBibG9jay5udW1iZXI7CiAgICAgICAgTG9nTmV3VGVtcGxhdGUoaWQsIG1zZy5zZW5kZXIsIGNvbnRlbnQpOwogICAgICAgIG5leHRUZW1wbGF0ZUlEID0gaWQuYWRkKDEpOwogICAgICAgIHJldHVybiBpZDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBuZXcgcmV1c2FibGUgdGVtcGxhdGUgYW5kIHVzZSBpdCB0byBhc2sgYSBxdWVzdGlvbgogICAgLy8vIEBkZXYgVGVtcGxhdGUgZGF0YSBpcyBvbmx5IHN0b3JlZCBpbiB0aGUgZXZlbnQgbG9ncywgYnV0IGl0cyBibG9jayBudW1iZXIgaXMga2VwdCBpbiBjb250cmFjdCBzdG9yYWdlLgogICAgLy8vIEBwYXJhbSBjb250ZW50IFRoZSB0ZW1wbGF0ZSBjb250ZW50CiAgICAvLy8gQHBhcmFtIHF1ZXN0aW9uIEEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHBhcmFtZXRlcnMgdGhhdCB3aWxsIGJlIHBhc3NlZCBpbnRvIHRoZSB0ZW1wbGF0ZSB0byBtYWtlIHRoZSBxdWVzdGlvbgogICAgLy8vIEBwYXJhbSBhcmJpdHJhdG9yIFRoZSBhcmJpdHJhdGlvbiBjb250cmFjdCB0aGF0IHdpbGwgaGF2ZSB0aGUgZmluYWwgd29yZCBvbiB0aGUgYW5zd2VyIGlmIHRoZXJlIGlzIGEgZGlzcHV0ZQogICAgLy8vIEBwYXJhbSB0aW1lb3V0IEhvdyBsb25nIHRoZSBjb250cmFjdCBzaG91bGQgd2FpdCBhZnRlciB0aGUgYW5zd2VyIGlzIGNoYW5nZWQgYmVmb3JlIGZpbmFsaXppbmcgb24gdGhhdCBhbnN3ZXIKICAgIC8vLyBAcGFyYW0gb3BlbmluZ190cyBJZiBzZXQsIHRoZSBlYXJsaWVzdCB0aW1lIGl0IHNob3VsZCBiZSBwb3NzaWJsZSB0byBhbnN3ZXIgdGhlIHF1ZXN0aW9uLgogICAgLy8vIEBwYXJhbSBub25jZSBBIHVzZXItc3BlY2lmaWVkIG5vbmNlIHVzZWQgaW4gdGhlIHF1ZXN0aW9uIElELiBDaGFuZ2UgaXQgdG8gcmVwZWF0IGEgcXVlc3Rpb24uCiAgICAvLy8gQHJldHVybiBUaGUgSUQgb2YgdGhlIG5ld2x5LWNyZWF0ZWQgdGVtcGxhdGUsIHdoaWNoIGlzIGNyZWF0ZWQgc2VxdWVudGlhbGx5LgogICAgZnVuY3Rpb24gY3JlYXRlVGVtcGxhdGVBbmRBc2tRdWVzdGlvbigKICAgICAgICBzdHJpbmcgY29udGVudCwgCiAgICAgICAgc3RyaW5nIHF1ZXN0aW9uLCBhZGRyZXNzIGFyYml0cmF0b3IsIHVpbnQzMiB0aW1lb3V0LCB1aW50MzIgb3BlbmluZ190cywgdWludDI1NiBub25jZSAKICAgICkgCiAgICAgICAgLy8gc3RhdGVOb3RDcmVhdGVkIGlzIGVuZm9yY2VkIGJ5IHRoZSBpbnRlcm5hbCBfYXNrUXVlc3Rpb24KICAgIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICB1aW50MjU2IHRlbXBsYXRlX2lkID0gY3JlYXRlVGVtcGxhdGUoY29udGVudCk7CiAgICAgICAgcmV0dXJuIGFza1F1ZXN0aW9uKHRlbXBsYXRlX2lkLCBxdWVzdGlvbiwgYXJiaXRyYXRvciwgdGltZW91dCwgb3BlbmluZ190cywgbm9uY2UpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFzayBhIG5ldyBxdWVzdGlvbiBhbmQgcmV0dXJuIHRoZSBJRAogICAgLy8vIEBkZXYgVGVtcGxhdGUgZGF0YSBpcyBvbmx5IHN0b3JlZCBpbiB0aGUgZXZlbnQgbG9ncywgYnV0IGl0cyBibG9jayBudW1iZXIgaXMga2VwdCBpbiBjb250cmFjdCBzdG9yYWdlLgogICAgLy8vIEBwYXJhbSB0ZW1wbGF0ZV9pZCBUaGUgSUQgbnVtYmVyIG9mIHRoZSB0ZW1wbGF0ZSB0aGUgcXVlc3Rpb24gd2lsbCB1c2UKICAgIC8vLyBAcGFyYW0gcXVlc3Rpb24gQSBzdHJpbmcgY29udGFpbmluZyB0aGUgcGFyYW1ldGVycyB0aGF0IHdpbGwgYmUgcGFzc2VkIGludG8gdGhlIHRlbXBsYXRlIHRvIG1ha2UgdGhlIHF1ZXN0aW9uCiAgICAvLy8gQHBhcmFtIGFyYml0cmF0b3IgVGhlIGFyYml0cmF0aW9uIGNvbnRyYWN0IHRoYXQgd2lsbCBoYXZlIHRoZSBmaW5hbCB3b3JkIG9uIHRoZSBhbnN3ZXIgaWYgdGhlcmUgaXMgYSBkaXNwdXRlCiAgICAvLy8gQHBhcmFtIHRpbWVvdXQgSG93IGxvbmcgdGhlIGNvbnRyYWN0IHNob3VsZCB3YWl0IGFmdGVyIHRoZSBhbnN3ZXIgaXMgY2hhbmdlZCBiZWZvcmUgZmluYWxpemluZyBvbiB0aGF0IGFuc3dlcgogICAgLy8vIEBwYXJhbSBvcGVuaW5nX3RzIElmIHNldCwgdGhlIGVhcmxpZXN0IHRpbWUgaXQgc2hvdWxkIGJlIHBvc3NpYmxlIHRvIGFuc3dlciB0aGUgcXVlc3Rpb24uCiAgICAvLy8gQHBhcmFtIG5vbmNlIEEgdXNlci1zcGVjaWZpZWQgbm9uY2UgdXNlZCBpbiB0aGUgcXVlc3Rpb24gSUQuIENoYW5nZSBpdCB0byByZXBlYXQgYSBxdWVzdGlvbi4KICAgIC8vLyBAcmV0dXJuIFRoZSBJRCBvZiB0aGUgbmV3bHktY3JlYXRlZCBxdWVzdGlvbiwgY3JlYXRlZCBkZXRlcm1pbmlzdGljYWxseS4KICAgIGZ1bmN0aW9uIGFza1F1ZXN0aW9uKHVpbnQyNTYgdGVtcGxhdGVfaWQsIHN0cmluZyBxdWVzdGlvbiwgYWRkcmVzcyBhcmJpdHJhdG9yLCB1aW50MzIgdGltZW91dCwgdWludDMyIG9wZW5pbmdfdHMsIHVpbnQyNTYgbm9uY2UpIAogICAgICAgIC8vIHN0YXRlTm90Q3JlYXRlZCBpcyBlbmZvcmNlZCBieSB0aGUgaW50ZXJuYWwgX2Fza1F1ZXN0aW9uCiAgICBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChieXRlczMyKSB7CgogICAgICAgIHJlcXVpcmUodGVtcGxhdGVzW3RlbXBsYXRlX2lkXSA+IDApOyAvLyBUZW1wbGF0ZSBtdXN0IGV4aXN0CgogICAgICAgIGJ5dGVzMzIgY29udGVudF9oYXNoID0ga2VjY2FrMjU2KHRlbXBsYXRlX2lkLCBvcGVuaW5nX3RzLCBxdWVzdGlvbik7CiAgICAgICAgYnl0ZXMzMiBxdWVzdGlvbl9pZCA9IGtlY2NhazI1Nihjb250ZW50X2hhc2gsIGFyYml0cmF0b3IsIHRpbWVvdXQsIG1zZy5zZW5kZXIsIG5vbmNlKTsKCiAgICAgICAgX2Fza1F1ZXN0aW9uKHF1ZXN0aW9uX2lkLCBjb250ZW50X2hhc2gsIGFyYml0cmF0b3IsIHRpbWVvdXQsIG9wZW5pbmdfdHMpOwogICAgICAgIExvZ05ld1F1ZXN0aW9uKHF1ZXN0aW9uX2lkLCBtc2cuc2VuZGVyLCB0ZW1wbGF0ZV9pZCwgcXVlc3Rpb24sIGNvbnRlbnRfaGFzaCwgYXJiaXRyYXRvciwgdGltZW91dCwgb3BlbmluZ190cywgbm9uY2UsIG5vdyk7CgogICAgICAgIHJldHVybiBxdWVzdGlvbl9pZDsKICAgIH0KCiAgICBmdW5jdGlvbiBfYXNrUXVlc3Rpb24oYnl0ZXMzMiBxdWVzdGlvbl9pZCwgYnl0ZXMzMiBjb250ZW50X2hhc2gsIGFkZHJlc3MgYXJiaXRyYXRvciwgdWludDMyIHRpbWVvdXQsIHVpbnQzMiBvcGVuaW5nX3RzKSAKICAgICAgICBzdGF0ZU5vdENyZWF0ZWQocXVlc3Rpb25faWQpCiAgICBpbnRlcm5hbCB7CgogICAgICAgIC8vIEEgdGltZW91dCBvZiAwIG1ha2VzIG5vIHNlbnNlLCBhbmQgd2Ugd2lsbCB1c2UgdGhpcyB0byBjaGVjayBleGlzdGVuY2UKICAgICAgICByZXF1aXJlKHRpbWVvdXQgPiAwKTsgCiAgICAgICAgcmVxdWlyZSh0aW1lb3V0IDwgMzY1IGRheXMpOyAKICAgICAgICByZXF1aXJlKGFyYml0cmF0b3IgIT0gTlVMTF9BRERSRVNTKTsKCiAgICAgICAgdWludDI1NiBib3VudHkgPSBtc2cudmFsdWU7CgogICAgICAgIC8vIFRoZSBhcmJpdHJhdG9yIGNhbiBzZXQgYSBmZWUgZm9yIGFza2luZyBhIHF1ZXN0aW9uLiAKICAgICAgICAvLyBUaGlzIGlzIGludGVuZGVkIGFzIGFuIGFudGktc3BhbSBkZWZlbmNlLgogICAgICAgIC8vIFRoZSBmZWUgaXMgd2FpdmVkIGlmIHRoZSBhcmJpdHJhdG9yIGlzIGFza2luZyB0aGUgcXVlc3Rpb24uCiAgICAgICAgLy8gVGhpcyBhbGxvd3MgdGhlbSB0byBzZXQgYW4gaW1wb3NzaWJseSBoaWdoIGZlZSBhbmQgbWFrZSB1c2VycyBwcm94eSB0aGUgcXVlc3Rpb24gdGhyb3VnaCB0aGVtLgogICAgICAgIC8vIFRoaXMgd291bGQgYWxsb3cgbW9yZSBzb3BoaXN0aWNhdGVkIHByaWNpbmcsIHF1ZXN0aW9uIHdoaXRlbGlzdGluZyBldGMuCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYXJiaXRyYXRvcikgewogICAgICAgICAgICB1aW50MjU2IHF1ZXN0aW9uX2ZlZSA9IGFyYml0cmF0b3JfcXVlc3Rpb25fZmVlc1thcmJpdHJhdG9yXTsKICAgICAgICAgICAgcmVxdWlyZShib3VudHkgPj0gcXVlc3Rpb25fZmVlKTsgCiAgICAgICAgICAgIGJvdW50eSA9IGJvdW50eS5zdWIocXVlc3Rpb25fZmVlKTsKICAgICAgICAgICAgYmFsYW5jZU9mW2FyYml0cmF0b3JdID0gYmFsYW5jZU9mW2FyYml0cmF0b3JdLmFkZChxdWVzdGlvbl9mZWUpOwogICAgICAgIH0KCiAgICAgICAgcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5jb250ZW50X2hhc2ggPSBjb250ZW50X2hhc2g7CiAgICAgICAgcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5hcmJpdHJhdG9yID0gYXJiaXRyYXRvcjsKICAgICAgICBxdWVzdGlvbnNbcXVlc3Rpb25faWRdLm9wZW5pbmdfdHMgPSBvcGVuaW5nX3RzOwogICAgICAgIHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0udGltZW91dCA9IHRpbWVvdXQ7CiAgICAgICAgcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5ib3VudHkgPSBib3VudHk7CgogICAgfQoKICAgIC8vLyBAbm90aWNlIEFkZCBmdW5kcyB0byB0aGUgYm91bnR5IGZvciBhIHF1ZXN0aW9uCiAgICAvLy8gQGRldiBBZGQgYm91bnR5IGZ1bmRzIGFmdGVyIHRoZSBpbml0aWFsIHF1ZXN0aW9uIGNyZWF0aW9uLiBDYW4gYmUgZG9uZSBhbnkgdGltZSB1bnRpbCB0aGUgcXVlc3Rpb24gaXMgZmluYWxpemVkLgogICAgLy8vIEBwYXJhbSBxdWVzdGlvbl9pZCBUaGUgSUQgb2YgdGhlIHF1ZXN0aW9uIHlvdSB3aXNoIHRvIGZ1bmQKICAgIGZ1bmN0aW9uIGZ1bmRBbnN3ZXJCb3VudHkoYnl0ZXMzMiBxdWVzdGlvbl9pZCkgCiAgICAgICAgc3RhdGVPcGVuKHF1ZXN0aW9uX2lkKQogICAgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5ib3VudHkgPSBxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmJvdW50eS5hZGQobXNnLnZhbHVlKTsKICAgICAgICBMb2dGdW5kQW5zd2VyQm91bnR5KHF1ZXN0aW9uX2lkLCBtc2cudmFsdWUsIHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uYm91bnR5LCBtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTdWJtaXQgYW4gYW5zd2VyIGZvciBhIHF1ZXN0aW9uLgogICAgLy8vIEBkZXYgQWRkcyB0aGUgYW5zd2VyIHRvIHRoZSBoaXN0b3J5IGFuZCB1cGRhdGVzIHRoZSBjdXJyZW50ICJiZXN0IiBhbnN3ZXIuCiAgICAvLy8gTWF5IGJlIHN1YmplY3QgdG8gZnJvbnQtcnVubmluZyBhdHRhY2tzOyBTdWJzdGl0dXRlIHN1Ym1pdEFuc3dlckNvbW1pdG1lbnQoKS0+c3VibWl0QW5zd2VyUmV2ZWFsKCkgdG8gcHJldmVudCB0aGVtLgogICAgLy8vIEBwYXJhbSBxdWVzdGlvbl9pZCBUaGUgSUQgb2YgdGhlIHF1ZXN0aW9uCiAgICAvLy8gQHBhcmFtIGFuc3dlciBUaGUgYW5zd2VyLCBlbmNvZGVkIGludG8gYnl0ZXMzMgogICAgLy8vIEBwYXJhbSBtYXhfcHJldmlvdXMgSWYgc3BlY2lmaWVkLCByZXZlcnRzIGlmIGEgYm9uZCBoaWdoZXIgdGhhbiB0aGlzIHdhcyBzdWJtaXR0ZWQgYWZ0ZXIgeW91IHNlbnQgeW91ciB0cmFuc2FjdGlvbi4KICAgIGZ1bmN0aW9uIHN1Ym1pdEFuc3dlcihieXRlczMyIHF1ZXN0aW9uX2lkLCBieXRlczMyIGFuc3dlciwgdWludDI1NiBtYXhfcHJldmlvdXMpIAogICAgICAgIHN0YXRlT3BlbihxdWVzdGlvbl9pZCkKICAgICAgICBib25kTXVzdERvdWJsZShxdWVzdGlvbl9pZCkKICAgICAgICBwcmV2aW91c0JvbmRNdXN0Tm90QmVhdE1heFByZXZpb3VzKHF1ZXN0aW9uX2lkLCBtYXhfcHJldmlvdXMpCiAgICBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBfYWRkQW5zd2VyVG9IaXN0b3J5KHF1ZXN0aW9uX2lkLCBhbnN3ZXIsIG1zZy5zZW5kZXIsIG1zZy52YWx1ZSwgZmFsc2UpOwogICAgICAgIF91cGRhdGVDdXJyZW50QW5zd2VyKHF1ZXN0aW9uX2lkLCBhbnN3ZXIsIHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0udGltZW91dCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU3VibWl0IHRoZSBoYXNoIG9mIGFuIGFuc3dlciwgbGF5aW5nIHlvdXIgY2xhaW0gdG8gdGhhdCBhbnN3ZXIgaWYgeW91IHJldmVhbCBpdCBpbiBhIHN1YnNlcXVlbnQgdHJhbnNhY3Rpb24uCiAgICAvLy8gQGRldiBDcmVhdGVzIGEgaGFzaCwgY29tbWl0bWVudF9pZCwgdW5pcXVlbHkgaWRlbnRpZnlpbmcgdGhpcyBhbnN3ZXIsIHRvIHRoaXMgcXVlc3Rpb24sIHdpdGggdGhpcyBib25kLgogICAgLy8vIFRoZSBjb21taXRtZW50X2lkIGlzIHN0b3JlZCBpbiB0aGUgYW5zd2VyIGhpc3Rvcnkgd2hlcmUgdGhlIGFuc3dlciB3b3VsZCBub3JtYWxseSBnby4KICAgIC8vLyBEb2VzIG5vdCB1cGRhdGUgdGhlIGN1cnJlbnQgYmVzdCBhbnN3ZXIgLSB0aGlzIGlzIGxlZnQgdG8gdGhlIGxhdGVyIHN1Ym1pdEFuc3dlclJldmVhbCgpIHRyYW5zYWN0aW9uLgogICAgLy8vIEBwYXJhbSBxdWVzdGlvbl9pZCBUaGUgSUQgb2YgdGhlIHF1ZXN0aW9uCiAgICAvLy8gQHBhcmFtIGFuc3dlcl9oYXNoIFRoZSBoYXNoIG9mIHlvdXIgYW5zd2VyLCBwbHVzIGEgbm9uY2UgdGhhdCB5b3Ugd2lsbCBsYXRlciByZXZlYWwKICAgIC8vLyBAcGFyYW0gbWF4X3ByZXZpb3VzIElmIHNwZWNpZmllZCwgcmV2ZXJ0cyBpZiBhIGJvbmQgaGlnaGVyIHRoYW4gdGhpcyB3YXMgc3VibWl0dGVkIGFmdGVyIHlvdSBzZW50IHlvdXIgdHJhbnNhY3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hbnN3ZXJlciBJZiBzcGVjaWZpZWQsIHRoZSBhZGRyZXNzIHRvIGJlIGdpdmVuIGFzIHRoZSBxdWVzdGlvbiBhbnN3ZXJlci4gRGVmYXVsdHMgdG8gdGhlIHNlbmRlci4KICAgIC8vLyBAZGV2IFNwZWNpZnlpbmcgdGhlIGFuc3dlcmVyIGlzIHVzZWZ1bCBpZiB5b3Ugd2FudCB0byBkZWxlZ2F0ZSB0aGUgY29tbWl0LWFuZC1yZXZlYWwgdG8gYSB0aGlyZC1wYXJ0eS4KICAgIGZ1bmN0aW9uIHN1Ym1pdEFuc3dlckNvbW1pdG1lbnQoYnl0ZXMzMiBxdWVzdGlvbl9pZCwgYnl0ZXMzMiBhbnN3ZXJfaGFzaCwgdWludDI1NiBtYXhfcHJldmlvdXMsIGFkZHJlc3MgX2Fuc3dlcmVyKSAKICAgICAgICBzdGF0ZU9wZW4ocXVlc3Rpb25faWQpCiAgICAgICAgYm9uZE11c3REb3VibGUocXVlc3Rpb25faWQpCiAgICAgICAgcHJldmlvdXNCb25kTXVzdE5vdEJlYXRNYXhQcmV2aW91cyhxdWVzdGlvbl9pZCwgbWF4X3ByZXZpb3VzKQogICAgZXh0ZXJuYWwgcGF5YWJsZSB7CgogICAgICAgIGJ5dGVzMzIgY29tbWl0bWVudF9pZCA9IGtlY2NhazI1NihxdWVzdGlvbl9pZCwgYW5zd2VyX2hhc2gsIG1zZy52YWx1ZSk7CiAgICAgICAgYWRkcmVzcyBhbnN3ZXJlciA9IChfYW5zd2VyZXIgPT0gTlVMTF9BRERSRVNTKSA/IG1zZy5zZW5kZXIgOiBfYW5zd2VyZXI7CgogICAgICAgIHJlcXVpcmUoY29tbWl0bWVudHNbY29tbWl0bWVudF9pZF0ucmV2ZWFsX3RzID09IENPTU1JVE1FTlRfTk9OX0VYSVNURU5UKTsKCiAgICAgICAgdWludDMyIGNvbW1pdG1lbnRfdGltZW91dCA9IHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0udGltZW91dCAvIENPTU1JVE1FTlRfVElNRU9VVF9SQVRJTzsKICAgICAgICBjb21taXRtZW50c1tjb21taXRtZW50X2lkXS5yZXZlYWxfdHMgPSB1aW50MzIobm93KS5hZGQoY29tbWl0bWVudF90aW1lb3V0KTsKCiAgICAgICAgX2FkZEFuc3dlclRvSGlzdG9yeShxdWVzdGlvbl9pZCwgY29tbWl0bWVudF9pZCwgYW5zd2VyZXIsIG1zZy52YWx1ZSwgdHJ1ZSk7CgogICAgfQoKICAgIC8vLyBAbm90aWNlIFN1Ym1pdCB0aGUgYW5zd2VyIHdob3NlIGhhc2ggeW91IHNlbnQgaW4gYSBwcmV2aW91cyBzdWJtaXRBbnN3ZXJDb21taXRtZW50KCkgdHJhbnNhY3Rpb24KICAgIC8vLyBAZGV2IENoZWNrcyB0aGUgcGFyYW1ldGVycyBzdXBwbGllZCByZWNyZWF0ZSBhbiBleGlzdGluZyBjb21taXRtZW50LCBhbmQgc3RvcmVzIHRoZSByZXZlYWxlZCBhbnN3ZXIKICAgIC8vLyBVcGRhdGVzIHRoZSBjdXJyZW50IGFuc3dlciB1bmxlc3Mgc29tZW9uZSBoYXMgc2luY2Ugc3VwcGxpZWQgYSBuZXcgYW5zd2VyIHdpdGggYSBoaWdoZXIgYm9uZAogICAgLy8vIG1zZy5zZW5kZXIgaXMgaW50ZW50aW9uYWxseSBub3QgcmVzdHJpY3RlZCB0byB0aGUgdXNlciB3aG8gb3JpZ2luYWxseSBzZW50IHRoZSBjb21taXRtZW50OyAKICAgIC8vLyBGb3IgZXhhbXBsZSwgdGhlIHVzZXIgbWF5IHdhbnQgdG8gcHJvdmlkZSB0aGUgYW5zd2VyK25vbmNlIHRvIGEgdGhpcmQtcGFydHkgc2VydmljZSBhbmQgbGV0IHRoZW0gc2VuZCB0aGUgdHgKICAgIC8vLyBAcGFyYW0gcXVlc3Rpb25faWQgVGhlIElEIG9mIHRoZSBxdWVzdGlvbgogICAgLy8vIEBwYXJhbSBhbnN3ZXIgVGhlIGFuc3dlciwgZW5jb2RlZCBhcyBieXRlczMyCiAgICAvLy8gQHBhcmFtIG5vbmNlIFRoZSBub25jZSB0aGF0LCBjb21iaW5lZCB3aXRoIHRoZSBhbnN3ZXIsIHJlY3JlYXRlcyB0aGUgYW5zd2VyX2hhc2ggeW91IGdhdmUgaW4gc3VibWl0QW5zd2VyQ29tbWl0bWVudCgpCiAgICAvLy8gQHBhcmFtIGJvbmQgVGhlIGJvbmQgdGhhdCB5b3UgcGFpZCBpbiB5b3VyIHN1Ym1pdEFuc3dlckNvbW1pdG1lbnQoKSB0cmFuc2FjdGlvbgogICAgZnVuY3Rpb24gc3VibWl0QW5zd2VyUmV2ZWFsKGJ5dGVzMzIgcXVlc3Rpb25faWQsIGJ5dGVzMzIgYW5zd2VyLCB1aW50MjU2IG5vbmNlLCB1aW50MjU2IGJvbmQpIAogICAgICAgIHN0YXRlT3BlbihxdWVzdGlvbl9pZCkKICAgIGV4dGVybmFsIHsKCiAgICAgICAgYnl0ZXMzMiBhbnN3ZXJfaGFzaCA9IGtlY2NhazI1NihhbnN3ZXIsIG5vbmNlKTsKICAgICAgICBieXRlczMyIGNvbW1pdG1lbnRfaWQgPSBrZWNjYWsyNTYocXVlc3Rpb25faWQsIGFuc3dlcl9oYXNoLCBib25kKTsKCiAgICAgICAgcmVxdWlyZSghY29tbWl0bWVudHNbY29tbWl0bWVudF9pZF0uaXNfcmV2ZWFsZWQpOwogICAgICAgIHJlcXVpcmUoY29tbWl0bWVudHNbY29tbWl0bWVudF9pZF0ucmV2ZWFsX3RzID4gdWludDMyKG5vdykpOyAvLyBSZXZlYWwgZGVhZGxpbmUgbXVzdCBub3QgaGF2ZSBwYXNzZWQKCiAgICAgICAgY29tbWl0bWVudHNbY29tbWl0bWVudF9pZF0ucmV2ZWFsZWRfYW5zd2VyID0gYW5zd2VyOwogICAgICAgIGNvbW1pdG1lbnRzW2NvbW1pdG1lbnRfaWRdLmlzX3JldmVhbGVkID0gdHJ1ZTsKCiAgICAgICAgaWYgKGJvbmQgPT0gcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5ib25kKSB7CiAgICAgICAgICAgIF91cGRhdGVDdXJyZW50QW5zd2VyKHF1ZXN0aW9uX2lkLCBhbnN3ZXIsIHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0udGltZW91dCk7CiAgICAgICAgfQoKICAgICAgICBMb2dBbnN3ZXJSZXZlYWwocXVlc3Rpb25faWQsIG1zZy5zZW5kZXIsIGFuc3dlcl9oYXNoLCBhbnN3ZXIsIG5vbmNlLCBib25kKTsKCiAgICB9CgogICAgZnVuY3Rpb24gX2FkZEFuc3dlclRvSGlzdG9yeShieXRlczMyIHF1ZXN0aW9uX2lkLCBieXRlczMyIGFuc3dlcl9vcl9jb21taXRtZW50X2lkLCBhZGRyZXNzIGFuc3dlcmVyLCB1aW50MjU2IGJvbmQsIGJvb2wgaXNfY29tbWl0bWVudCkgCiAgICBpbnRlcm5hbCAKICAgIHsKICAgICAgICBieXRlczMyIG5ld19oaXN0b3J5X2hhc2ggPSBrZWNjYWsyNTYocXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5oaXN0b3J5X2hhc2gsIGFuc3dlcl9vcl9jb21taXRtZW50X2lkLCBib25kLCBhbnN3ZXJlciwgaXNfY29tbWl0bWVudCk7CgogICAgICAgIHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uYm9uZCA9IGJvbmQ7CiAgICAgICAgcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5oaXN0b3J5X2hhc2ggPSBuZXdfaGlzdG9yeV9oYXNoOwoKICAgICAgICBMb2dOZXdBbnN3ZXIoYW5zd2VyX29yX2NvbW1pdG1lbnRfaWQsIHF1ZXN0aW9uX2lkLCBuZXdfaGlzdG9yeV9oYXNoLCBhbnN3ZXJlciwgYm9uZCwgbm93LCBpc19jb21taXRtZW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBfdXBkYXRlQ3VycmVudEFuc3dlcihieXRlczMyIHF1ZXN0aW9uX2lkLCBieXRlczMyIGFuc3dlciwgdWludDMyIHRpbWVvdXRfc2VjcykKICAgIGludGVybmFsIHsKICAgICAgICBxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmJlc3RfYW5zd2VyID0gYW5zd2VyOwogICAgICAgIHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uZmluYWxpemVfdHMgPSB1aW50MzIobm93KS5hZGQodGltZW91dF9zZWNzKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBOb3RpZnkgdGhlIGNvbnRyYWN0IHRoYXQgdGhlIGFyYml0cmF0b3IgaGFzIGJlZW4gcGFpZCBmb3IgYSBxdWVzdGlvbiwgZnJlZXppbmcgaXQgcGVuZGluZyB0aGVpciBkZWNpc2lvbi4KICAgIC8vLyBAZGV2IFRoZSBhcmJpdHJhdG9yIGNvbnRyYWN0IGlzIHRydXN0ZWQgdG8gb25seSBjYWxsIHRoaXMgaWYgdGhleSd2ZSBiZWVuIHBhaWQsIGFuZCB0ZWxsIHVzIHdobyBwYWlkIHRoZW0uCiAgICAvLy8gQHBhcmFtIHF1ZXN0aW9uX2lkIFRoZSBJRCBvZiB0aGUgcXVlc3Rpb24KICAgIC8vLyBAcGFyYW0gcmVxdWVzdGVyIFRoZSBhY2NvdW50IHRoYXQgcmVxdWVzdGVkIGFyYml0cmF0aW9uCiAgICBmdW5jdGlvbiBub3RpZnlPZkFyYml0cmF0aW9uUmVxdWVzdChieXRlczMyIHF1ZXN0aW9uX2lkLCBhZGRyZXNzIHJlcXVlc3RlcikgCiAgICAgICAgb25seUFyYml0cmF0b3IocXVlc3Rpb25faWQpCiAgICAgICAgc3RhdGVPcGVuKHF1ZXN0aW9uX2lkKQogICAgZXh0ZXJuYWwgewogICAgICAgIHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uaXNfcGVuZGluZ19hcmJpdHJhdGlvbiA9IHRydWU7CiAgICAgICAgTG9nTm90aWZ5T2ZBcmJpdHJhdGlvblJlcXVlc3QocXVlc3Rpb25faWQsIHJlcXVlc3Rlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU3VibWl0IHRoZSBhbnN3ZXIgZm9yIGEgcXVlc3Rpb24sIGZvciB1c2UgYnkgdGhlIGFyYml0cmF0b3IuCiAgICAvLy8gQGRldiBEb2Vzbid0IHJlcXVpcmUgKG9yIGFsbG93KSBhIGJvbmQuCiAgICAvLy8gSWYgdGhlIGN1cnJlbnQgZmluYWwgYW5zd2VyIGlzIGNvcnJlY3QsIHRoZSBhY2NvdW50IHNob3VsZCBiZSB3aG9ldmVyIHN1Ym1pdHRlZCBpdC4KICAgIC8vLyBJZiB0aGUgY3VycmVudCBmaW5hbCBhbnN3ZXIgaXMgd3JvbmcsIHRoZSBhY2NvdW50IHNob3VsZCBiZSB3aG9ldmVyIHBhaWQgZm9yIGFyYml0cmF0aW9uLgogICAgLy8vIEhvd2V2ZXIsIHRoZSBhbnN3ZXJlciBzdGlwdWxhdGlvbnMgYXJlIG5vdCBlbmZvcmNlZCBieSB0aGUgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIHF1ZXN0aW9uX2lkIFRoZSBJRCBvZiB0aGUgcXVlc3Rpb24KICAgIC8vLyBAcGFyYW0gYW5zd2VyIFRoZSBhbnN3ZXIsIGVuY29kZWQgaW50byBieXRlczMyCiAgICAvLy8gQHBhcmFtIGFuc3dlcmVyIFRoZSBhY2NvdW50IGNyZWRpdGVkIHdpdGggdGhpcyBhbnN3ZXIgZm9yIHRoZSBwdXJwb3NlIG9mIGJvbmQgY2xhaW1zCiAgICBmdW5jdGlvbiBzdWJtaXRBbnN3ZXJCeUFyYml0cmF0b3IoYnl0ZXMzMiBxdWVzdGlvbl9pZCwgYnl0ZXMzMiBhbnN3ZXIsIGFkZHJlc3MgYW5zd2VyZXIpIAogICAgICAgIG9ubHlBcmJpdHJhdG9yKHF1ZXN0aW9uX2lkKQogICAgICAgIHN0YXRlUGVuZGluZ0FyYml0cmF0aW9uKHF1ZXN0aW9uX2lkKQogICAgICAgIGJvbmRNdXN0QmVaZXJvCiAgICBleHRlcm5hbCB7CgogICAgICAgIHJlcXVpcmUoYW5zd2VyZXIgIT0gTlVMTF9BRERSRVNTKTsKICAgICAgICBMb2dGaW5hbGl6ZShxdWVzdGlvbl9pZCwgYW5zd2VyKTsKCiAgICAgICAgcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5pc19wZW5kaW5nX2FyYml0cmF0aW9uID0gZmFsc2U7CiAgICAgICAgX2FkZEFuc3dlclRvSGlzdG9yeShxdWVzdGlvbl9pZCwgYW5zd2VyLCBhbnN3ZXJlciwgMCwgZmFsc2UpOwogICAgICAgIF91cGRhdGVDdXJyZW50QW5zd2VyKHF1ZXN0aW9uX2lkLCBhbnN3ZXIsIDApOwoKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXBvcnQgd2hldGhlciB0aGUgYW5zd2VyIHRvIHRoZSBzcGVjaWZpZWQgcXVlc3Rpb24gaXMgZmluYWxpemVkCiAgICAvLy8gQHBhcmFtIHF1ZXN0aW9uX2lkIFRoZSBJRCBvZiB0aGUgcXVlc3Rpb24KICAgIC8vLyBAcmV0dXJuIFJldHVybiB0cnVlIGlmIGZpbmFsaXplZAogICAgZnVuY3Rpb24gaXNGaW5hbGl6ZWQoYnl0ZXMzMiBxdWVzdGlvbl9pZCkgCiAgICBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQzMiBmaW5hbGl6ZV90cyA9IHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uZmluYWxpemVfdHM7CiAgICAgICAgcmV0dXJuICggIXF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uaXNfcGVuZGluZ19hcmJpdHJhdGlvbiAmJiAoZmluYWxpemVfdHMgPiBVTkFOU1dFUkVEKSAmJiAoZmluYWxpemVfdHMgPD0gdWludDMyKG5vdykpICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJuIHRoZSBmaW5hbCBhbnN3ZXIgdG8gdGhlIHNwZWNpZmllZCBxdWVzdGlvbiwgb3IgcmV2ZXJ0IGlmIHRoZXJlIGlzbid0IG9uZQogICAgLy8vIEBwYXJhbSBxdWVzdGlvbl9pZCBUaGUgSUQgb2YgdGhlIHF1ZXN0aW9uCiAgICAvLy8gQHJldHVybiBUaGUgYW5zd2VyIGZvcm1hdHRlZCBhcyBhIGJ5dGVzMzIKICAgIGZ1bmN0aW9uIGdldEZpbmFsQW5zd2VyKGJ5dGVzMzIgcXVlc3Rpb25faWQpIAogICAgICAgIHN0YXRlRmluYWxpemVkKHF1ZXN0aW9uX2lkKQogICAgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmJlc3RfYW5zd2VyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybiB0aGUgZmluYWwgYW5zd2VyIHRvIHRoZSBzcGVjaWZpZWQgcXVlc3Rpb24sIHByb3ZpZGVkIGl0IG1hdGNoZXMgdGhlIHNwZWNpZmllZCBjcml0ZXJpYS4KICAgIC8vLyBAZGV2IFJldmVydHMgaWYgdGhlIHF1ZXN0aW9uIGlzIG5vdCBmaW5hbGl6ZWQsIG9yIGlmIGl0IGRvZXMgbm90IG1hdGNoIHRoZSBzcGVjaWZpZWQgY3JpdGVyaWEuCiAgICAvLy8gQHBhcmFtIHF1ZXN0aW9uX2lkIFRoZSBJRCBvZiB0aGUgcXVlc3Rpb24KICAgIC8vLyBAcGFyYW0gY29udGVudF9oYXNoIFRoZSBoYXNoIG9mIHRoZSBxdWVzdGlvbiBjb250ZW50ICh0ZW1wbGF0ZSBJRCArIG9wZW5pbmcgdGltZSArIHF1ZXN0aW9uIHBhcmFtZXRlciBzdHJpbmcpCiAgICAvLy8gQHBhcmFtIGFyYml0cmF0b3IgVGhlIGFyYml0cmF0b3IgY2hvc2VuIGZvciB0aGUgcXVlc3Rpb24gKHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB0aGV5IGFyZSBhc2tlZCB0byBhcmJpdHJhdGUpCiAgICAvLy8gQHBhcmFtIG1pbl90aW1lb3V0IFRoZSB0aW1lb3V0IHNldCBpbiB0aGUgaW5pdGlhbCBxdWVzdGlvbiBzZXR0aW5ncyBtdXN0IGJlIHRoaXMgaGlnaCBvciBoaWdoZXIKICAgIC8vLyBAcGFyYW0gbWluX2JvbmQgVGhlIGJvbmQgc2VudCB3aXRoIHRoZSBmaW5hbCBhbnN3ZXIgbXVzdCBiZSB0aGlzIGhpZ2ggb3IgaGlnaGVyCiAgICAvLy8gQHJldHVybiBUaGUgYW5zd2VyIGZvcm1hdHRlZCBhcyBhIGJ5dGVzMzIKICAgIGZ1bmN0aW9uIGdldEZpbmFsQW5zd2VySWZNYXRjaGVzKAogICAgICAgIGJ5dGVzMzIgcXVlc3Rpb25faWQsIAogICAgICAgIGJ5dGVzMzIgY29udGVudF9oYXNoLCBhZGRyZXNzIGFyYml0cmF0b3IsIHVpbnQzMiBtaW5fdGltZW91dCwgdWludDI1NiBtaW5fYm9uZAogICAgKSAKICAgICAgICBzdGF0ZUZpbmFsaXplZChxdWVzdGlvbl9pZCkKICAgIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICByZXF1aXJlKGNvbnRlbnRfaGFzaCA9PSBxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmNvbnRlbnRfaGFzaCk7CiAgICAgICAgcmVxdWlyZShhcmJpdHJhdG9yID09IHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uYXJiaXRyYXRvcik7CiAgICAgICAgcmVxdWlyZShtaW5fdGltZW91dCA8PSBxdWVzdGlvbnNbcXVlc3Rpb25faWRdLnRpbWVvdXQpOwogICAgICAgIHJlcXVpcmUobWluX2JvbmQgPD0gcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5ib25kKTsKICAgICAgICByZXR1cm4gcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5iZXN0X2Fuc3dlcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBc3NpZ25zIHRoZSB3aW5uaW5ncyAoYm91bnR5IGFuZCBib25kcykgdG8gZXZlcnlvbmUgd2hvIGdhdmUgdGhlIGFjY2VwdGVkIGFuc3dlcgogICAgLy8vIENhbGxlciBtdXN0IHByb3ZpZGUgdGhlIGFuc3dlciBoaXN0b3J5LCBpbiByZXZlcnNlIG9yZGVyCiAgICAvLy8gQGRldiBXb3JrcyB1cCB0aGUgY2hhaW4gYW5kIGFzc2lnbiBib25kcyB0byB0aGUgcGVyc29uIHdobyBnYXZlIHRoZSByaWdodCBhbnN3ZXIKICAgIC8vLyBJZiBzb21lb25lIGdhdmUgdGhlIHdpbm5pbmcgYW5zd2VyIGVhcmxpZXIsIHRoZXkgbXVzdCBnZXQgcGFpZCBmcm9tIHRoZSBoaWdoZXIgYm9uZAogICAgLy8vIFRoYXQgbWVhbnMgd2UgY2FuJ3QgcGF5IG91dCB0aGUgYm9uZCBhZGRlZCBhdCBuIHVudGlsIHdlIGhhdmUgbG9va2VkIGF0IG4tMQogICAgLy8vIFRoZSBmaXJzdCBhbnN3ZXIgaXMgYXV0aGVudGljYXRlZCBieSBjaGVja2luZyBhZ2FpbnN0IHRoZSBzdG9yZWQgaGlzdG9yeV9oYXNoLgogICAgLy8vIE9uZSBvZiB0aGUgaW5wdXRzIHRvIGhpc3RvcnlfaGFzaCBpcyB0aGUgaGlzdG9yeV9oYXNoIGJlZm9yZSBpdCwgc28gd2UgdXNlIHRoYXQgdG8gYXV0aGVudGljYXRlIHRoZSBuZXh0IGVudHJ5LCBldGMKICAgIC8vLyBPbmNlIHdlIGdldCB0byBhIG51bGwgaGFzaCB3ZSdsbCBrbm93IHdlJ3JlIGRvbmUgYW5kIHRoZXJlIGFyZSBubyBtb3JlIGFuc3dlcnMuCiAgICAvLy8gVXN1YWxseSB5b3Ugd291bGQgY2FsbCB0aGUgd2hvbGUgdGhpbmcgaW4gYSBzaW5nbGUgdHJhbnNhY3Rpb24sIGJ1dCBpZiBub3QgdGhlbiB0aGUgZGF0YSBpcyBwZXJzaXN0ZWQgdG8gcGljayB1cCBsYXRlci4KICAgIC8vLyBAcGFyYW0gcXVlc3Rpb25faWQgVGhlIElEIG9mIHRoZSBxdWVzdGlvbgogICAgLy8vIEBwYXJhbSBoaXN0b3J5X2hhc2hlcyBTZWNvbmQtbGFzdC10by1maXJzdCwgdGhlIGhhc2ggb2YgZWFjaCBoaXN0b3J5IGVudHJ5LiAoRmluYWwgb25lIHNob3VsZCBiZSBlbXB0eSkuCiAgICAvLy8gQHBhcmFtIGFkZHJzIExhc3QtdG8tZmlyc3QsIHRoZSBhZGRyZXNzIG9mIGVhY2ggYW5zd2VyZXIgb3IgY29tbWl0bWVudCBzZW5kZXIKICAgIC8vLyBAcGFyYW0gYm9uZHMgTGFzdC10by1maXJzdCwgdGhlIGJvbmQgc3VwcGxpZWQgd2l0aCBlYWNoIGFuc3dlciBvciBjb21taXRtZW50CiAgICAvLy8gQHBhcmFtIGFuc3dlcnMgTGFzdC10by1maXJzdCwgZWFjaCBhbnN3ZXIgc3VwcGxpZWQsIG9yIGNvbW1pdG1lbnQgSUQgaWYgdGhlIGFuc3dlciB3YXMgc3VwcGxpZWQgd2l0aCBjb21taXQtPnJldmVhbAogICAgZnVuY3Rpb24gY2xhaW1XaW5uaW5ncygKICAgICAgICBieXRlczMyIHF1ZXN0aW9uX2lkLCAKICAgICAgICBieXRlczMyW10gaGlzdG9yeV9oYXNoZXMsIGFkZHJlc3NbXSBhZGRycywgdWludDI1NltdIGJvbmRzLCBieXRlczMyW10gYW5zd2VycwogICAgKSAKICAgICAgICBzdGF0ZUZpbmFsaXplZChxdWVzdGlvbl9pZCkKICAgIHB1YmxpYyB7CgogICAgICAgIHJlcXVpcmUoaGlzdG9yeV9oYXNoZXMubGVuZ3RoID4gMCk7CgogICAgICAgIC8vIFRoZXNlIGFyZSBvbmx5IHNldCBpZiB3ZSBzcGxpdCBvdXIgY2xhaW0gb3ZlciBtdWx0aXBsZSB0cmFuc2FjdGlvbnMuCiAgICAgICAgYWRkcmVzcyBwYXllZSA9IHF1ZXN0aW9uX2NsYWltc1txdWVzdGlvbl9pZF0ucGF5ZWU7IAogICAgICAgIHVpbnQyNTYgbGFzdF9ib25kID0gcXVlc3Rpb25fY2xhaW1zW3F1ZXN0aW9uX2lkXS5sYXN0X2JvbmQ7IAogICAgICAgIHVpbnQyNTYgcXVldWVkX2Z1bmRzID0gcXVlc3Rpb25fY2xhaW1zW3F1ZXN0aW9uX2lkXS5xdWV1ZWRfZnVuZHM7IAoKICAgICAgICAvLyBTdGFydHMgYXMgdGhlIGhhc2ggb2YgdGhlIGZpbmFsIGFuc3dlciBzdWJtaXR0ZWQuIEl0J2xsIGJlIGNsZWFyZWQgd2hlbiB3ZSdyZSBkb25lLgogICAgICAgIC8vIElmIHdlJ3JlIHNwbGl0dGluZyB0aGUgY2xhaW0gb3ZlciBtdWx0aXBsZSB0cmFuc2FjdGlvbnMsIGl0J2xsIGJlIHRoZSBoYXNoIHdoZXJlIHdlIGxlZnQgb2ZmIGxhc3QgdGltZQogICAgICAgIGJ5dGVzMzIgbGFzdF9oaXN0b3J5X2hhc2ggPSBxdWVzdGlvbnNbcXVlc3Rpb25faWRdLmhpc3RvcnlfaGFzaDsKCiAgICAgICAgYnl0ZXMzMiBiZXN0X2Fuc3dlciA9IHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uYmVzdF9hbnN3ZXI7CgogICAgICAgIHVpbnQyNTYgaTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaGlzdG9yeV9oYXNoZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAKICAgICAgICAgICAgLy8gQ2hlY2sgaW5wdXQgYWdhaW5zdCB0aGUgaGlzdG9yeSBoYXNoLCBhbmQgc2VlIHdoaWNoIG9mIDIgcG9zc2libGUgdmFsdWVzIG9mIGlzX2NvbW1pdG1lbnQgZml0cy4KICAgICAgICAgICAgYm9vbCBpc19jb21taXRtZW50ID0gX3ZlcmlmeUhpc3RvcnlJbnB1dE9yUmV2ZXJ0KGxhc3RfaGlzdG9yeV9oYXNoLCBoaXN0b3J5X2hhc2hlc1tpXSwgYW5zd2Vyc1tpXSwgYm9uZHNbaV0sIGFkZHJzW2ldKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHF1ZXVlZF9mdW5kcyA9IHF1ZXVlZF9mdW5kcy5hZGQobGFzdF9ib25kKTsgCiAgICAgICAgICAgIChxdWV1ZWRfZnVuZHMsIHBheWVlKSA9IF9wcm9jZXNzSGlzdG9yeUl0ZW0oCiAgICAgICAgICAgICAgICBxdWVzdGlvbl9pZCwgYmVzdF9hbnN3ZXIsIHF1ZXVlZF9mdW5kcywgcGF5ZWUsIAogICAgICAgICAgICAgICAgYWRkcnNbaV0sIGJvbmRzW2ldLCBhbnN3ZXJzW2ldLCBpc19jb21taXRtZW50KTsKIAogICAgICAgICAgICAvLyBMaW5lIHRoZSBib25kIHVwIGZvciBuZXh0IHRpbWUsIHdoZW4gaXQgd2lsbCBiZSBhZGRlZCB0byBzb21lYm9keSdzIHF1ZXVlZF9mdW5kcwogICAgICAgICAgICBsYXN0X2JvbmQgPSBib25kc1tpXTsKICAgICAgICAgICAgbGFzdF9oaXN0b3J5X2hhc2ggPSBoaXN0b3J5X2hhc2hlc1tpXTsKCiAgICAgICAgfQogCiAgICAgICAgaWYgKGxhc3RfaGlzdG9yeV9oYXNoICE9IE5VTExfSEFTSCkgewogICAgICAgICAgICAvLyBXZSBoYXZlbid0IHlldCBnb3QgdG8gdGhlIG51bGwgaGFzaCAoMXN0IGFuc3dlciksIGllIHRoZSBjYWxsZXIgZGlkbid0IHN1cHBseSB0aGUgZnVsbCBhbnN3ZXIgY2hhaW4uCiAgICAgICAgICAgIC8vIFBlcnNpc3QgdGhlIGRldGFpbHMgc28gd2UgY2FuIHBpY2sgdXAgbGF0ZXIgd2hlcmUgd2UgbGVmdCBvZmYgbGF0ZXIuCgogICAgICAgICAgICAvLyBJZiB3ZSBrbm93IHdobyB0byBwYXkgd2UgY2FuIGdvIGFoZWFkIGFuZCBwYXkgdGhlbSBvdXQsIG9ubHkga2VlcGluZyBiYWNrIGxhc3RfYm9uZAogICAgICAgICAgICAvLyAoV2UgYWx3YXlzIGtub3cgd2hvIHRvIHBheSB1bmxlc3MgYWxsIHdlIHNhdyB3ZXJlIHVucmV2ZWFsZWQgY29tbWl0cykKICAgICAgICAgICAgaWYgKHBheWVlICE9IE5VTExfQUREUkVTUykgewogICAgICAgICAgICAgICAgX3BheVBheWVlKHF1ZXN0aW9uX2lkLCBwYXllZSwgcXVldWVkX2Z1bmRzKTsKICAgICAgICAgICAgICAgIHF1ZXVlZF9mdW5kcyA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHF1ZXN0aW9uX2NsYWltc1txdWVzdGlvbl9pZF0ucGF5ZWUgPSBwYXllZTsKICAgICAgICAgICAgcXVlc3Rpb25fY2xhaW1zW3F1ZXN0aW9uX2lkXS5sYXN0X2JvbmQgPSBsYXN0X2JvbmQ7CiAgICAgICAgICAgIHF1ZXN0aW9uX2NsYWltc1txdWVzdGlvbl9pZF0ucXVldWVkX2Z1bmRzID0gcXVldWVkX2Z1bmRzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vdGhpbmcgbGVmdCBiZWxvdyB1cyBzbyB0aGUgcGF5ZWUgY2FuIGtlZXAgd2hhdCByZW1haW5zCiAgICAgICAgICAgIF9wYXlQYXllZShxdWVzdGlvbl9pZCwgcGF5ZWUsIHF1ZXVlZF9mdW5kcy5hZGQobGFzdF9ib25kKSk7CiAgICAgICAgICAgIGRlbGV0ZSBxdWVzdGlvbl9jbGFpbXNbcXVlc3Rpb25faWRdOwogICAgICAgIH0KCiAgICAgICAgcXVlc3Rpb25zW3F1ZXN0aW9uX2lkXS5oaXN0b3J5X2hhc2ggPSBsYXN0X2hpc3RvcnlfaGFzaDsKCiAgICB9CgogICAgZnVuY3Rpb24gX3BheVBheWVlKGJ5dGVzMzIgcXVlc3Rpb25faWQsIGFkZHJlc3MgcGF5ZWUsIHVpbnQyNTYgdmFsdWUpIAogICAgaW50ZXJuYWwgewogICAgICAgIGJhbGFuY2VPZltwYXllZV0gPSBiYWxhbmNlT2ZbcGF5ZWVdLmFkZCh2YWx1ZSk7CiAgICAgICAgTG9nQ2xhaW0ocXVlc3Rpb25faWQsIHBheWVlLCB2YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gX3ZlcmlmeUhpc3RvcnlJbnB1dE9yUmV2ZXJ0KAogICAgICAgIGJ5dGVzMzIgbGFzdF9oaXN0b3J5X2hhc2gsCiAgICAgICAgYnl0ZXMzMiBoaXN0b3J5X2hhc2gsIGJ5dGVzMzIgYW5zd2VyLCB1aW50MjU2IGJvbmQsIGFkZHJlc3MgYWRkcgogICAgKQogICAgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGxhc3RfaGlzdG9yeV9oYXNoID09IGtlY2NhazI1NihoaXN0b3J5X2hhc2gsIGFuc3dlciwgYm9uZCwgYWRkciwgdHJ1ZSkgKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAobGFzdF9oaXN0b3J5X2hhc2ggPT0ga2VjY2FrMjU2KGhpc3RvcnlfaGFzaCwgYW5zd2VyLCBib25kLCBhZGRyLCBmYWxzZSkgKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IAogICAgICAgIHJldmVydCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9wcm9jZXNzSGlzdG9yeUl0ZW0oCiAgICAgICAgYnl0ZXMzMiBxdWVzdGlvbl9pZCwgYnl0ZXMzMiBiZXN0X2Fuc3dlciwgCiAgICAgICAgdWludDI1NiBxdWV1ZWRfZnVuZHMsIGFkZHJlc3MgcGF5ZWUsIAogICAgICAgIGFkZHJlc3MgYWRkciwgdWludDI1NiBib25kLCBieXRlczMyIGFuc3dlciwgYm9vbCBpc19jb21taXRtZW50CiAgICApCiAgICBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2LCBhZGRyZXNzKSB7CgogICAgICAgIC8vIEZvciBjb21taXQtYW5kLXJldmVhbCwgdGhlIGFuc3dlciBoaXN0b3J5IGhvbGRzIHRoZSBjb21taXRtZW50IElEIGluc3RlYWQgb2YgdGhlIGFuc3dlci4KICAgICAgICAvLyBXZSBsb29rIGF0IHRoZSByZWZlcmVuY2VkIGNvbW1pdG1lbnQgSUQgYW5kIHN3aXRjaCBpbiB0aGUgYWN0dWFsIGFuc3dlci4KICAgICAgICBpZiAoaXNfY29tbWl0bWVudCkgewogICAgICAgICAgICBieXRlczMyIGNvbW1pdG1lbnRfaWQgPSBhbnN3ZXI7CiAgICAgICAgICAgIC8vIElmIGl0J3MgYSBjb21taXQgYnV0IGl0IGhhc24ndCBiZWVuIHJldmVhbGVkLCBpdCB3aWxsIGFsd2F5cyBiZSBjb25zaWRlcmVkIHdyb25nLgogICAgICAgICAgICBpZiAoIWNvbW1pdG1lbnRzW2NvbW1pdG1lbnRfaWRdLmlzX3JldmVhbGVkKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgY29tbWl0bWVudHNbY29tbWl0bWVudF9pZF07CiAgICAgICAgICAgICAgICByZXR1cm4gKHF1ZXVlZF9mdW5kcywgcGF5ZWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYW5zd2VyID0gY29tbWl0bWVudHNbY29tbWl0bWVudF9pZF0ucmV2ZWFsZWRfYW5zd2VyOwogICAgICAgICAgICAgICAgZGVsZXRlIGNvbW1pdG1lbnRzW2NvbW1pdG1lbnRfaWRdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYW5zd2VyID09IGJlc3RfYW5zd2VyKSB7CgogICAgICAgICAgICBpZiAocGF5ZWUgPT0gTlVMTF9BRERSRVNTKSB7CgogICAgICAgICAgICAgICAgLy8gVGhlIGVudHJ5IGlzIGZvciB0aGUgZmlyc3QgcGF5ZWUgd2UgY29tZSB0bywgaWUgdGhlIHdpbm5lci4KICAgICAgICAgICAgICAgIC8vIFRoZXkgZ2V0IHRoZSBxdWVzdGlvbiBib3VudHkuCiAgICAgICAgICAgICAgICBwYXllZSA9IGFkZHI7CiAgICAgICAgICAgICAgICBxdWV1ZWRfZnVuZHMgPSBxdWV1ZWRfZnVuZHMuYWRkKHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uYm91bnR5KTsKICAgICAgICAgICAgICAgIHF1ZXN0aW9uc1txdWVzdGlvbl9pZF0uYm91bnR5ID0gMDsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWRkciAhPSBwYXllZSkgewoKICAgICAgICAgICAgICAgIC8vIEFuc3dlcmVyIGhhcyBjaGFuZ2VkLCBpZSB3ZSBmb3VuZCBzb21lb25lIGxvd2VyIGRvd24gd2hvIG5lZWRzIHRvIGJlIHBhaWQKCiAgICAgICAgICAgICAgICAvLyBUaGUgbG93ZXIgYW5zd2VyZXIgd2lsbCB0YWtlIG92ZXIgcmVjZWl2aW5nIGJvbmRzIGZyb20gaGlnaGVyIGFuc3dlcmVyLgogICAgICAgICAgICAgICAgLy8gVGhleSBzaG91bGQgYWxzbyBiZSBwYWlkIHRoZSB0YWtlb3ZlciBmZWUsIHdoaWNoIGlzIHNldCBhdCBhIHJhdGUgZXF1aXZhbGVudCB0byB0aGVpciBib25kLiAKICAgICAgICAgICAgICAgIC8vIChUaGlzIGlzIG91ciBhcmJpdHJhcnkgcnVsZSwgdG8gZ2l2ZSBjb25zaXN0ZW50IHJpZ2h0LWFuc3dlcmVycyBhIGRlZmVuY2UgYWdhaW5zdCBoaWdoLXJvbGxlcnMuKQoKICAgICAgICAgICAgICAgIC8vIFRoZXJlIHNob3VsZCBiZSBlbm91Z2ggZm9yIHRoZSBmZWUsIGJ1dCBpZiBub3QsIHRha2Ugd2hhdCB3ZSBoYXZlLgogICAgICAgICAgICAgICAgLy8gVGhlcmUncyBhbiBlZGdlIGNhc2UgaW52b2x2aW5nIHdlaXJkIGFyYml0cmF0b3IgYmVoYXZpb3VyIHdoZXJlIHdlIG1heSBiZSBzaG9ydC4KICAgICAgICAgICAgICAgIHVpbnQyNTYgYW5zd2VyX3Rha2VvdmVyX2ZlZSA9IChxdWV1ZWRfZnVuZHMgPj0gYm9uZCkgPyBib25kIDogcXVldWVkX2Z1bmRzOwoKICAgICAgICAgICAgICAgIC8vIFNldHRsZSB1cCB3aXRoIHRoZSBvbGQgKGhpZ2hlci1ib25kZWQpIHBheWVlCiAgICAgICAgICAgICAgICBfcGF5UGF5ZWUocXVlc3Rpb25faWQsIHBheWVlLCBxdWV1ZWRfZnVuZHMuc3ViKGFuc3dlcl90YWtlb3Zlcl9mZWUpKTsKCiAgICAgICAgICAgICAgICAvLyBOb3cgc3RhcnQgcXVldWVkX2Z1bmRzIGFnYWluIGZvciB0aGUgbmV3IChsb3dlci1ib25kZWQpIHBheWVlCiAgICAgICAgICAgICAgICBwYXllZSA9IGFkZHI7CiAgICAgICAgICAgICAgICBxdWV1ZWRfZnVuZHMgPSBhbnN3ZXJfdGFrZW92ZXJfZmVlOwoKICAgICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIHJldHVybiAocXVldWVkX2Z1bmRzLCBwYXllZSk7CgogICAgfQoKICAgIC8vLyBAbm90aWNlIENvbnZlbmllbmNlIGZ1bmN0aW9uIHRvIGFzc2lnbiBib3VudGllcy9ib25kcyBmb3IgbXVsdGlwbGUgcXVlc3Rpb25zIGluIG9uZSBnbywgdGhlbiB3aXRoZHJhdyBhbGwgeW91ciBmdW5kcy4KICAgIC8vLyBDYWxsZXIgbXVzdCBwcm92aWRlIHRoZSBhbnN3ZXIgaGlzdG9yeSBmb3IgZWFjaCBxdWVzdGlvbiwgaW4gcmV2ZXJzZSBvcmRlcgogICAgLy8vIEBkZXYgQ2FuIGJlIGNhbGxlZCBieSBhbnlvbmUgdG8gYXNzaWduIGJvbmRzL2JvdW50aWVzLCBidXQgZnVuZHMgYXJlIG9ubHkgd2l0aGRyYXduIGZvciB0aGUgdXNlciBtYWtpbmcgdGhlIGNhbGwuCiAgICAvLy8gQHBhcmFtIHF1ZXN0aW9uX2lkcyBUaGUgSURzIG9mIHRoZSBxdWVzdGlvbnMgeW91IHdhbnQgdG8gY2xhaW0gZm9yCiAgICAvLy8gQHBhcmFtIGxlbmd0aHMgVGhlIG51bWJlciBvZiBoaXN0b3J5IGVudHJpZXMgeW91IHdpbGwgc3VwcGx5IGZvciBlYWNoIHF1ZXN0aW9uIElECiAgICAvLy8gQHBhcmFtIGhpc3RfaGFzaGVzIEluIGEgc2luZ2xlIGxpc3QgZm9yIGFsbCBzdXBwbGllZCBxdWVzdGlvbnMsIHRoZSBoYXNoIG9mIGVhY2ggaGlzdG9yeSBlbnRyeS4KICAgIC8vLyBAcGFyYW0gYWRkcnMgSW4gYSBzaW5nbGUgbGlzdCBmb3IgYWxsIHN1cHBsaWVkIHF1ZXN0aW9ucywgdGhlIGFkZHJlc3Mgb2YgZWFjaCBhbnN3ZXJlciBvciBjb21taXRtZW50IHNlbmRlcgogICAgLy8vIEBwYXJhbSBib25kcyBJbiBhIHNpbmdsZSBsaXN0IGZvciBhbGwgc3VwcGxpZWQgcXVlc3Rpb25zLCB0aGUgYm9uZCBzdXBwbGllZCB3aXRoIGVhY2ggYW5zd2VyIG9yIGNvbW1pdG1lbnQKICAgIC8vLyBAcGFyYW0gYW5zd2VycyBJbiBhIHNpbmdsZSBsaXN0IGZvciBhbGwgc3VwcGxpZWQgcXVlc3Rpb25zLCBlYWNoIGFuc3dlciBzdXBwbGllZCwgb3IgY29tbWl0bWVudCBJRCAKICAgIGZ1bmN0aW9uIGNsYWltTXVsdGlwbGVBbmRXaXRoZHJhd0JhbGFuY2UoCiAgICAgICAgYnl0ZXMzMltdIHF1ZXN0aW9uX2lkcywgdWludDI1NltdIGxlbmd0aHMsIAogICAgICAgIGJ5dGVzMzJbXSBoaXN0X2hhc2hlcywgYWRkcmVzc1tdIGFkZHJzLCB1aW50MjU2W10gYm9uZHMsIGJ5dGVzMzJbXSBhbnN3ZXJzCiAgICApIAogICAgICAgIHN0YXRlQW55KCkgLy8gVGhlIGZpbmFsaXphdGlvbiBjaGVja3MgYXJlIGRvbmUgaW4gdGhlIGNsYWltV2lubmluZ3MgZnVuY3Rpb24KICAgIHB1YmxpYyB7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBxaTsKICAgICAgICB1aW50MjU2IGk7CiAgICAgICAgZm9yIChxaSA9IDA7IHFpIDwgcXVlc3Rpb25faWRzLmxlbmd0aDsgcWkrKykgewogICAgICAgICAgICBieXRlczMyIHFpZCA9IHF1ZXN0aW9uX2lkc1txaV07CiAgICAgICAgICAgIHVpbnQyNTYgbG4gPSBsZW5ndGhzW3FpXTsKICAgICAgICAgICAgYnl0ZXMzMltdIG1lbW9yeSBoaCA9IG5ldyBieXRlczMyW10obG4pOwogICAgICAgICAgICBhZGRyZXNzW10gbWVtb3J5IGFkID0gbmV3IGFkZHJlc3NbXShsbik7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgYm8gPSBuZXcgdWludDI1NltdKGxuKTsKICAgICAgICAgICAgYnl0ZXMzMltdIG1lbW9yeSBhbiA9IG5ldyBieXRlczMyW10obG4pOwogICAgICAgICAgICB1aW50MjU2IGo7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBsbjsgaisrKSB7CiAgICAgICAgICAgICAgICBoaFtqXSA9IGhpc3RfaGFzaGVzW2ldOwogICAgICAgICAgICAgICAgYWRbal0gPSBhZGRyc1tpXTsKICAgICAgICAgICAgICAgIGJvW2pdID0gYm9uZHNbaV07CiAgICAgICAgICAgICAgICBhbltqXSA9IGFuc3dlcnNbaV07CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xhaW1XaW5uaW5ncyhxaWQsIGhoLCBhZCwgYm8sIGFuKTsKICAgICAgICB9CiAgICAgICAgd2l0aGRyYXcoKTsKICAgIH0KfQoKCgoKY29udHJhY3QgQXJiaXRyYXRvciBpcyBPd25lZCB7CgogICAgUmVhbGl0eUNoZWNrIHB1YmxpYyByZWFsaXR5Y2hlY2s7CgogICAgbWFwcGluZyhieXRlczMyID0+IHVpbnQyNTYpIHB1YmxpYyBhcmJpdHJhdGlvbl9ib3VudGllczsKCiAgICB1aW50MjU2IGRpc3B1dGVfZmVlOwogICAgbWFwcGluZyhieXRlczMyID0+IHVpbnQyNTYpIGN1c3RvbV9kaXNwdXRlX2ZlZXM7CgogICAgZXZlbnQgTG9nUmVxdWVzdEFyYml0cmF0aW9uKAogICAgICAgIGJ5dGVzMzIgaW5kZXhlZCBxdWVzdGlvbl9pZCwKICAgICAgICB1aW50MjU2IGZlZV9wYWlkLAogICAgICAgIGFkZHJlc3MgcmVxdWVzdGVyLAogICAgICAgIHVpbnQyNTYgcmVtYWluaW5nCiAgICApOwoKICAgIGV2ZW50IExvZ1NldFJlYWxpdHlDaGVjaygKICAgICAgICBhZGRyZXNzIHJlYWxpdHljaGVjawogICAgKTsKCiAgICBldmVudCBMb2dTZXRRdWVzdGlvbkZlZSgKICAgICAgICB1aW50MjU2IGZlZQogICAgKTsKCgogICAgZXZlbnQgTG9nU2V0RGlzcHV0ZUZlZSgKICAgICAgICB1aW50MjU2IGZlZQogICAgKTsKCiAgICBldmVudCBMb2dTZXRDdXN0b21EaXNwdXRlRmVlKAogICAgICAgIGJ5dGVzMzIgaW5kZXhlZCBxdWVzdGlvbl9pZCwKICAgICAgICB1aW50MjU2IGZlZQogICAgKTsKCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3Rvci4gU2V0cyB0aGUgZGVwbG95aW5nIGFkZHJlc3MgYXMgb3duZXIuCiAgICBmdW5jdGlvbiBBcmJpdHJhdG9yKCkgCiAgICBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgdGhlIFJlYWxpdHkgQ2hlY2sgY29udHJhY3QgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBSZWFsaXR5IENoZWNrIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXRSZWFsaXR5Q2hlY2soYWRkcmVzcyBhZGRyKSAKICAgICAgICBvbmx5T3duZXIgCiAgICBwdWJsaWMgewogICAgICAgIHJlYWxpdHljaGVjayA9IFJlYWxpdHlDaGVjayhhZGRyKTsKICAgICAgICBMb2dTZXRSZWFsaXR5Q2hlY2soYWRkcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0IHRoZSBkZWZhdWx0IGZlZQogICAgLy8vIEBwYXJhbSBmZWUgVGhlIGRlZmF1bHQgZmVlIGFtb3VudAogICAgZnVuY3Rpb24gc2V0RGlzcHV0ZUZlZSh1aW50MjU2IGZlZSkgCiAgICAgICAgb25seU93bmVyIAogICAgcHVibGljIHsKICAgICAgICBkaXNwdXRlX2ZlZSA9IGZlZTsKICAgICAgICBMb2dTZXREaXNwdXRlRmVlKGZlZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0IGEgY3VzdG9tIGZlZSBmb3IgdGhpcyBwYXJ0aWN1bGFyIHF1ZXN0aW9uCiAgICAvLy8gQHBhcmFtIHF1ZXN0aW9uX2lkIFRoZSBxdWVzdGlvbiBpbiBxdWVzdGlvbgogICAgLy8vIEBwYXJhbSBmZWUgVGhlIGZlZSBhbW91bnQKICAgIGZ1bmN0aW9uIHNldEN1c3RvbURpc3B1dGVGZWUoYnl0ZXMzMiBxdWVzdGlvbl9pZCwgdWludDI1NiBmZWUpIAogICAgICAgIG9ubHlPd25lciAKICAgIHB1YmxpYyB7CiAgICAgICAgY3VzdG9tX2Rpc3B1dGVfZmVlc1txdWVzdGlvbl9pZF0gPSBmZWU7CiAgICAgICAgTG9nU2V0Q3VzdG9tRGlzcHV0ZUZlZShxdWVzdGlvbl9pZCwgZmVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm4gdGhlIGRpc3B1dGUgZmVlIGZvciB0aGUgc3BlY2lmaWVkIHF1ZXN0aW9uLiAwIGluZGljYXRlcyB0aGF0IHdlIHdvbid0IGFyYml0cmF0ZSBpdC4KICAgIC8vLyBAcGFyYW0gcXVlc3Rpb25faWQgVGhlIHF1ZXN0aW9uIGluIHF1ZXN0aW9uCiAgICAvLy8gQGRldiBVc2VzIGEgZ2VuZXJhbCBkZWZhdWx0LCBidXQgY2FuIGJlIG92ZXItcmlkZGVuIG9uIGEgcXVlc3Rpb24tYnktcXVlc3Rpb24gYmFzaXMuCiAgICBmdW5jdGlvbiBnZXREaXNwdXRlRmVlKGJ5dGVzMzIgcXVlc3Rpb25faWQpIAogICAgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKGN1c3RvbV9kaXNwdXRlX2ZlZXNbcXVlc3Rpb25faWRdID4gMCkgPyBjdXN0b21fZGlzcHV0ZV9mZWVzW3F1ZXN0aW9uX2lkXSA6IGRpc3B1dGVfZmVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCBhIGZlZSBmb3IgYXNraW5nIGEgcXVlc3Rpb24gd2l0aCB1cyBhcyB0aGUgYXJiaXRyYXRvcgogICAgLy8vIEBwYXJhbSBmZWUgVGhlIGZlZSBhbW91bnQKICAgIC8vLyBAZGV2IERlZmF1bHQgaXMgbm8gZmVlLiBVbmxpa2UgdGhlIGRpc3B1dGUgZmVlLCAwIGlzIGFuIGFjY2VwdGFibGUgc2V0dGluZy4KICAgIC8vLyBZb3UgY291bGQgc2V0IGFuIGltcG9zc2libHkgaGlnaCBmZWUgaWYgeW91IHdhbnQgdG8gcHJldmVudCB1cyBiZWluZyB1c2VkIGFzIGFyYml0cmF0b3IgdW5sZXNzIHdlIHN1Ym1pdCB0aGUgcXVlc3Rpb24uCiAgICAvLy8gKFN1Ym1pdHRpbmcgdGhlIHF1ZXN0aW9uIG91cnNlbHZlcyBpcyBub3QgaW1wbGVtZW50ZWQgaGVyZS4pCiAgICAvLy8gVGhpcyBmZWUgY2FuIGJlIHVzZWQgYXMgYSByZXZlbnVlIHNvdXJjZSwgYW4gYW50aS1zcGFtIG1lYXN1cmUsIG9yIGJvdGguCiAgICBmdW5jdGlvbiBzZXRRdWVzdGlvbkZlZSh1aW50MjU2IGZlZSkgCiAgICAgICAgb25seU93bmVyIAogICAgcHVibGljIHsKICAgICAgICByZWFsaXR5Y2hlY2suc2V0UXVlc3Rpb25GZWUoZmVlKTsKICAgICAgICBMb2dTZXRRdWVzdGlvbkZlZShmZWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFN1Ym1pdCB0aGUgYXJiaXRyYXRvcidzIGFuc3dlciB0byBhIHF1ZXN0aW9uLgogICAgLy8vIEBwYXJhbSBxdWVzdGlvbl9pZCBUaGUgcXVlc3Rpb24gaW4gcXVlc3Rpb24KICAgIC8vLyBAcGFyYW0gYW5zd2VyIFRoZSBhbnN3ZXIKICAgIC8vLyBAcGFyYW0gYW5zd2VyZXIgVGhlIGFuc3dlcmVyLiBJZiBhcmJpdHJhdGlvbiBjaGFuZ2VkIHRoZSBhbnN3ZXIsIGl0IHNob3VsZCBiZSB0aGUgcGF5ZXIuIElmIG5vdCwgdGhlIG9sZCBhbnN3ZXJlci4KICAgIGZ1bmN0aW9uIHN1Ym1pdEFuc3dlckJ5QXJiaXRyYXRvcihieXRlczMyIHF1ZXN0aW9uX2lkLCBieXRlczMyIGFuc3dlciwgYWRkcmVzcyBhbnN3ZXJlcikgCiAgICAgICAgb25seU93bmVyIAogICAgcHVibGljIHsKICAgICAgICBkZWxldGUgYXJiaXRyYXRpb25fYm91bnRpZXNbcXVlc3Rpb25faWRdOwogICAgICAgIHJlYWxpdHljaGVjay5zdWJtaXRBbnN3ZXJCeUFyYml0cmF0b3IocXVlc3Rpb25faWQsIGFuc3dlciwgYW5zd2VyZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJlcXVlc3QgYXJiaXRyYXRpb24sIGZyZWV6aW5nIHRoZSBxdWVzdGlvbiB1bnRpbCB3ZSBzZW5kIHN1Ym1pdEFuc3dlckJ5QXJiaXRyYXRvcgogICAgLy8vIEBkZXYgVGhlIGJvdW50eSBjYW4gYmUgcGFpZCBvbmx5IGluIHBhcnQsIGluIHdoaWNoIGNhc2UgdGhlIGxhc3QgcGVyc29uIHRvIHBheSB3aWxsIGJlIGNvbnNpZGVyZWQgdGhlIHBheWVyCiAgICAvLy8gV2lsbCB0cmlnZ2VyIGFuIGVycm9yIGlmIHRoZSBub3RpZmljYXRpb24gZmFpbHMsIGVnIGJlY2F1c2UgdGhlIHF1ZXN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gZmluYWxpemVkCiAgICAvLy8gQHBhcmFtIHF1ZXN0aW9uX2lkIFRoZSBxdWVzdGlvbiBpbiBxdWVzdGlvbgogICAgZnVuY3Rpb24gcmVxdWVzdEFyYml0cmF0aW9uKGJ5dGVzMzIgcXVlc3Rpb25faWQpIAogICAgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CgogICAgICAgIHVpbnQyNTYgYXJiaXRyYXRpb25fZmVlID0gZ2V0RGlzcHV0ZUZlZShxdWVzdGlvbl9pZCk7CiAgICAgICAgcmVxdWlyZShhcmJpdHJhdGlvbl9mZWUgPiAwKTsKCiAgICAgICAgYXJiaXRyYXRpb25fYm91bnRpZXNbcXVlc3Rpb25faWRdICs9IG1zZy52YWx1ZTsKICAgICAgICB1aW50MjU2IHBhaWQgPSBhcmJpdHJhdGlvbl9ib3VudGllc1txdWVzdGlvbl9pZF07CgogICAgICAgIGlmIChwYWlkID49IGFyYml0cmF0aW9uX2ZlZSkgewogICAgICAgICAgICByZWFsaXR5Y2hlY2subm90aWZ5T2ZBcmJpdHJhdGlvblJlcXVlc3QocXVlc3Rpb25faWQsIG1zZy5zZW5kZXIpOwogICAgICAgICAgICBMb2dSZXF1ZXN0QXJiaXRyYXRpb24ocXVlc3Rpb25faWQsIG1zZy52YWx1ZSwgbXNnLnNlbmRlciwgMCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoIXJlYWxpdHljaGVjay5pc0ZpbmFsaXplZChxdWVzdGlvbl9pZCkpOwogICAgICAgICAgICBMb2dSZXF1ZXN0QXJiaXRyYXRpb24ocXVlc3Rpb25faWQsIG1zZy52YWx1ZSwgbXNnLnNlbmRlciwgYXJiaXRyYXRpb25fZmVlIC0gcGFpZCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgfQoKICAgIC8vLyBAbm90aWNlIFdpdGhkcmF3IGFueSBhY2N1bXVsYXRlZCBmZWVzIHRvIHRoZSBzcGVjaWZpZWQgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBhZGRyZXNzIHRvIHdoaWNoIHRoZSBiYWxhbmNlIHNob3VsZCBiZSBzZW50CiAgICBmdW5jdGlvbiB3aXRoZHJhdyhhZGRyZXNzIGFkZHIpIAogICAgICAgIG9ubHlPd25lciAKICAgIHB1YmxpYyB7CiAgICAgICAgYWRkci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOyAKICAgIH0KCiAgICBmdW5jdGlvbigpIAogICAgcHVibGljIHBheWFibGUgewogICAgfQoKICAgIC8vLyBAbm90aWNlIFdpdGhkcmF3IGFueSBhY2N1bXVsYXRlZCBxdWVzdGlvbiBmZWVzIGZyb20gdGhlIHNwZWNpZmllZCBhZGRyZXNzIGludG8gdGhpcyBjb250cmFjdAogICAgLy8vIEBkZXYgRnVuZHMgY2FuIHRoZW4gYmUgbGliZXJhdGVkIGZyb20gdGhpcyBjb250cmFjdCB3aXRoIG91ciB3aXRoZHJhdygpIGZ1bmN0aW9uCiAgICBmdW5jdGlvbiBjYWxsV2l0aGRyYXcoKSAKICAgICAgICBvbmx5T3duZXIgCiAgICBwdWJsaWMgewogICAgICAgIHJlYWxpdHljaGVjay53aXRoZHJhdygpOyAKICAgIH0KCn0='.
	

]
