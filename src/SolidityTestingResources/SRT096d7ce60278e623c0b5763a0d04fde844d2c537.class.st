Class {
	#name : #SRT096d7ce60278e623c0b5763a0d04fde844d2c537,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT096d7ce60278e623c0b5763a0d04fde844d2c537 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwogCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KIApjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICAgCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpY3sKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKCgoKLyoqCiAqIEludGVyZmFjZSBmb3IgcmVxdWlyZWQgZnVuY3Rpb25hbGl0eSBpbiB0aGUgRVJDNzIxIHN0YW5kYXJkCiAqIGZvciBub24tZnVuZ2libGUgdG9rZW5zLgogKiBCb3Jyb3dlZCBmcm9tIFRva2VuIFN0YW5kYXJkIGRpc2N1c3Npb24gYm9hcmQKICoKICogCiAqLwogCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAvLyBGdW5jdGlvbgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IF90b3RhbFN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgX2JhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIF9vd25lcik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgaW50ZXJuYWw7CiAgICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCBfaW1wbGVtZW50c0VSQzcyMSk7CgogIAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgaW50ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuSWQpIGludGVybmFsOwoKICAgCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX2FwcHJvdmVkLCB1aW50MjU2IF90b2tlbklkKTsKfQoKLyoqCiAqIEludGVyZmFjZSBmb3Igb3B0aW9uYWwgZnVuY3Rpb25hbGl0eSBpbiB0aGUgRVJDNzIxIHN0YW5kYXJkCiAqIGZvciBub24tZnVuZ2libGUgdG9rZW5zLgogKgogKiAgCiAqIEJvcnJvd2VkIGluIHBhcnQgZnJvbSBUb2tlbiBTdGFuZGFyZCBkaXNjdXNzaW9uIGJvYXJkCiAqLwogCmNvbnRyYWN0IERldGFpbGVkRVJDNzIxIGlzIEVSQzcyMSB7CiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIF9uYW1lKTsKICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBfc3ltYm9sKTsKICAgLy8gZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgX2luZm9VcmwpOwogICAgZnVuY3Rpb24gdG9rZW5PZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludCBfaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgX3Rva2VuSWQpOwp9CgovKioKICogQHRpdGxlIE5vbkZ1bmdpYmxlVG9rZW4KICoKICogR2VuZXJpYyBpbXBsZW1lbnRhdGlvbiBmb3IgYm90aCByZXF1aXJlZCBhbmQgb3B0aW9uYWwgZnVuY3Rpb25hbGl0eSBpbgogKiB0aGUgRVJDNzIxIHN0YW5kYXJkIGZvciBub24tZnVuZ2libGUgdG9rZW5zLgogKgogKiBCb3Jyb3dlZCBpbiBwYXJ0IGZyb20gVG9rZW4gU3RhbmRhcmQgZGlzY3Vzc2lvbiBib2FyZAogKi8KIApjb250cmFjdCBOb25GdW5naWJsZVRva2VuIGlzIERldGFpbGVkRVJDNzIxIHsKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwoKICAgIHVpbnQgcHVibGljIG51bVRva2Vuc1RvdGFsOwogICAgdWludCBwdWJsaWMgY3VycmVudFRva2VuSWROdW1iZXI7CgogICAgbWFwcGluZyh1aW50ID0+IGFkZHJlc3MpIGludGVybmFsIHRva2VuSWRUb093bmVyOwogICAgbWFwcGluZyh1aW50ID0+IGFkZHJlc3MpIGludGVybmFsIHRva2VuSWROdW1iZXI7CiAgICBtYXBwaW5nKHVpbnQgPT4gYWRkcmVzcykgaW50ZXJuYWwgdG9rZW5JZFRvQXBwcm92ZWRBZGRyZXNzOwogICAvLyBtYXBwaW5nKHVpbnQgPT4gc3RyaW5nKSBpbnRlcm5hbCB0b2tlbklkVG9NZXRhZGF0YTsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50W10pIGludGVybmFsIG93bmVyVG9Ub2tlbnNPd25lZDsKICAgIG1hcHBpbmcodWludCA9PiB1aW50KSBpbnRlcm5hbCB0b2tlbklkVG9Pd25lckFycmF5SW5kZXg7CgogICAgZXZlbnQgVHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9mcm9tLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKTsKCiAgICBldmVudCBBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfYXBwcm92ZWQsCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKTsKCiAgICBtb2RpZmllciBvbmx5RXh0YW50VG9rZW4odWludCBfdG9rZW5JZCkgewogICAgICAgIHJlcXVpcmUob3duZXJPZihfdG9rZW5JZCkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBuYW1lKCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoc3RyaW5nIF9uYW1lKQogICAgewogICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIHN5bWJvbCgpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHN0cmluZyBfc3ltYm9sKQogICAgewogICAgICAgIHJldHVybiBzeW1ib2w7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2IF90b3RhbFN1cHBseSkKICAgIHsKICAgICAgICByZXR1cm4gbnVtVG9rZW5zVG90YWw7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGN1cnJlbnRJRG51bWJlcigpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgX3Rva2VuSWQpCiAgICB7CiAgICAgICAgcmV0dXJuIGN1cnJlbnRUb2tlbklkTnVtYmVyOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludCBfYmFsYW5jZSkKICAgIHsKICAgICAgICByZXR1cm4gb3duZXJUb1Rva2Vuc093bmVkW19vd25lcl0ubGVuZ3RoOwogICAgfQoKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludCBfdG9rZW5JZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpCiAgICB7CiAgICAgICAgcmV0dXJuIF9vd25lck9mKF90b2tlbklkKTsKICAgIH0KICAgIAogICAvKiAgTk9UIFVTRUQKICAgIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludCBfdG9rZW5JZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoc3RyaW5nIF9pbmZvVXJsKQogICAgewogICAgICAgIHJldHVybiB0b2tlbklkVG9NZXRhZGF0YVtfdG9rZW5JZF07CiAgICB9CiAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIG9ubHlFeHRhbnRUb2tlbihfdG9rZW5JZCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXJPZihfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBfdG8pOwoKICAgICAgICBpZiAoX2dldEFwcHJvdmVkKF90b2tlbklkKSAhPSBhZGRyZXNzKDApIHx8CiAgICAgICAgICAgICAgICBfdG8gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBfYXBwcm92ZShfdG8sIF90b2tlbklkKTsKICAgICAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICAgICAgfQogICAgfQoKICAKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIG9ubHlFeHRhbnRUb2tlbihfdG9rZW5JZCkKICAgIHsKICAgICAgICByZXF1aXJlKGdldEFwcHJvdmVkKF90b2tlbklkKSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKG93bmVyT2YoX3Rva2VuSWQpID09IF9mcm9tKTsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgX2NsZWFyQXBwcm92YWxBbmRUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CgogICAgICAgIEFwcHJvdmFsKF9mcm9tLCAwLCBfdG9rZW5JZCk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGF1Y3Rpb250cmFuc2ZlcihhZGRyZXNzIF9jdXJyZW50b3duZXIsIGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbklkKQogICAgICAgIGludGVybmFsCiAgICAgICAgb25seUV4dGFudFRva2VuKF90b2tlbklkKQogICAgewogICAgICAgIHJlcXVpcmUob3duZXJPZihfdG9rZW5JZCkgPT0gX2N1cnJlbnRvd25lcik7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIF9jbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIoX2N1cnJlbnRvd25lciwgX3RvLCBfdG9rZW5JZCk7CgogICAgICAgIEFwcHJvdmFsKF9jdXJyZW50b3duZXIsIDAsIF90b2tlbklkKTsKICAgICAgICBUcmFuc2ZlcihfY3VycmVudG93bmVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KICAgCgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuSWQpCiAgICAgICAgaW50ZXJuYWwgCiAgICAgICAgb25seUV4dGFudFRva2VuKF90b2tlbklkKQogICAgewogICAgICAgIHJlcXVpcmUob3duZXJPZihfdG9rZW5JZCkgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIF9jbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CgogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIDAsIF90b2tlbklkKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50IF9pbmRleCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludCBfdG9rZW5JZCkKICAgIHsKICAgICAgICByZXR1cm4gX2dldE93bmVyVG9rZW5CeUluZGV4KF9vd25lciwgX2luZGV4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRPd25lclRva2VucyhhZGRyZXNzIF9vd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludFtdIF90b2tlbklkcykKICAgIHsKICAgICAgICByZXR1cm4gX2dldE93bmVyVG9rZW5zKF9vd25lcik7CiAgICB9CgogICAgZnVuY3Rpb24gaW1wbGVtZW50c0VSQzcyMSgpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wgX2ltcGxlbWVudHNFUkM3MjEpCiAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXBwcm92ZWQodWludCBfdG9rZW5JZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBfYXBwcm92ZWQpCiAgICB7CiAgICAgICAgcmV0dXJuIF9nZXRBcHByb3ZlZChfdG9rZW5JZCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2NsZWFyQXBwcm92YWxBbmRUcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIF9jbGVhclRva2VuQXBwcm92YWwoX3Rva2VuSWQpOwogICAgICAgIF9yZW1vdmVUb2tlbkZyb21Pd25lcnNMaXN0KF9mcm9tLCBfdG9rZW5JZCk7CiAgICAgICAgX3NldFRva2VuT3duZXIoX3Rva2VuSWQsIF90byk7CiAgICAgICAgX2FkZFRva2VuVG9Pd25lcnNMaXN0KF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9vd25lck9mKHVpbnQgX3Rva2VuSWQpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpCiAgICB7CiAgICAgICAgcmV0dXJuIHRva2VuSWRUb093bmVyW190b2tlbklkXTsKICAgIH0KCiAgIAogICAgZnVuY3Rpb24gX2FwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuSWQpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICB0b2tlbklkVG9BcHByb3ZlZEFkZHJlc3NbX3Rva2VuSWRdID0gX3RvOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRBcHByb3ZlZCh1aW50IF90b2tlbklkKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGFkZHJlc3MgX2FwcHJvdmVkKQogICAgewogICAgICAgIHJldHVybiB0b2tlbklkVG9BcHByb3ZlZEFkZHJlc3NbX3Rva2VuSWRdOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRPd25lclRva2VucyhhZGRyZXNzIF9vd25lcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50W10gX3Rva2VucykKICAgIHsKICAgICAgICByZXR1cm4gb3duZXJUb1Rva2Vuc093bmVkW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gX2dldE93bmVyVG9rZW5CeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50IF9pbmRleCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IF90b2tlbnMpCiAgICB7CiAgICAgICAgcmV0dXJuIG93bmVyVG9Ub2tlbnNPd25lZFtfb3duZXJdW19pbmRleF07CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9jbGVhclRva2VuQXBwcm92YWwodWludCBfdG9rZW5JZCkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHRva2VuSWRUb0FwcHJvdmVkQWRkcmVzc1tfdG9rZW5JZF0gPSBhZGRyZXNzKDApOwogICAgfQoKCiAgICBmdW5jdGlvbiBfc2V0VG9rZW5Pd25lcih1aW50IF90b2tlbklkLCBhZGRyZXNzIF9vd25lcikKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHRva2VuSWRUb093bmVyW190b2tlbklkXSA9IF9vd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBfYWRkVG9rZW5Ub093bmVyc0xpc3QoYWRkcmVzcyBfb3duZXIsIHVpbnQgX3Rva2VuSWQpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICBvd25lclRvVG9rZW5zT3duZWRbX293bmVyXS5wdXNoKF90b2tlbklkKTsKICAgICAgICB0b2tlbklkVG9Pd25lckFycmF5SW5kZXhbX3Rva2VuSWRdID0KICAgICAgICAgICAgb3duZXJUb1Rva2Vuc093bmVkW19vd25lcl0ubGVuZ3RoIC0gMTsKICAgIH0KCiAgICBmdW5jdGlvbiBfcmVtb3ZlVG9rZW5Gcm9tT3duZXJzTGlzdChhZGRyZXNzIF9vd25lciwgdWludCBfdG9rZW5JZCkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHVpbnQgbGVuZ3RoID0gb3duZXJUb1Rva2Vuc093bmVkW19vd25lcl0ubGVuZ3RoOwogICAgICAgIHVpbnQgaW5kZXggPSB0b2tlbklkVG9Pd25lckFycmF5SW5kZXhbX3Rva2VuSWRdOwogICAgICAgIHVpbnQgc3dhcFRva2VuID0gb3duZXJUb1Rva2Vuc093bmVkW19vd25lcl1bbGVuZ3RoIC0gMV07CgogICAgICAgIG93bmVyVG9Ub2tlbnNPd25lZFtfb3duZXJdW2luZGV4XSA9IHN3YXBUb2tlbjsKICAgICAgICB0b2tlbklkVG9Pd25lckFycmF5SW5kZXhbc3dhcFRva2VuXSA9IGluZGV4OwoKICAgICAgICBkZWxldGUgb3duZXJUb1Rva2Vuc093bmVkW19vd25lcl1bbGVuZ3RoIC0gMV07CiAgICAgICAgb3duZXJUb1Rva2Vuc093bmVkW19vd25lcl0ubGVuZ3RoLS07CiAgICB9CgovKiBOb3QgVXNlZAogICAgZnVuY3Rpb24gX2luc2VydFRva2VuTWV0YWRhdGEodWludCBfdG9rZW5JZCwgc3RyaW5nIF9tZXRhZGF0YSkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIHRva2VuSWRUb01ldGFkYXRhW190b2tlbklkXSA9IF9tZXRhZGF0YTsKICAgIH0KICAgCiAqLyAgCn0KCi8qKgogKiBAdGl0bGUgTWludGFibGVOb25GdW5naWJsZVRva2VuCiAqCiAqIFN1cGVyc2V0IG9mIHRoZSBFUkM3MjEgc3RhbmRhcmQgdGhhdCBhbGxvd3MgZm9yIHRoZSBtaW50aW5nCiAqIG9mIG5vbi1mdW5naWJsZSB0b2tlbnMuCiAqIEJvcnJvd2VkIGZyb20gVG9rZW4gU3RhbmRhcmQgZGlzY3Vzc2lvbiBib2FyZAogKi8KIApjb250cmFjdCBNaW50YWJsZU5vbkZ1bmdpYmxlVG9rZW4gaXMgTm9uRnVuZ2libGVUb2tlbiB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgaW5kZXhlZCBfdG9rZW5JZCk7CgogICAgbW9kaWZpZXIgb25seU5vbmV4aXN0ZW50VG9rZW4odWludCBfdG9rZW5JZCkgewogICAgICAgIHJlcXVpcmUodG9rZW5JZFRvT3duZXJbX3Rva2VuSWRdID09IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIG9ubHlOb25leGlzdGVudFRva2VuKF90b2tlbklkKQogICAgewogICAgICAgIF9zZXRUb2tlbk93bmVyKF90b2tlbklkLCBfb3duZXIpOwogICAgICAgIF9hZGRUb2tlblRvT3duZXJzTGlzdChfb3duZXIsIF90b2tlbklkKTsKICAgICAgICAvL19pbnNlcnRUb2tlbk1ldGFkYXRhKF90b2tlbklkLCBfbWV0YWRhdGEpOwoKICAgICAgICBudW1Ub2tlbnNUb3RhbCA9IG51bVRva2Vuc1RvdGFsLmFkZCgxKTsKCiAgICAgICAgTWludChfb3duZXIsIF90b2tlbklkKTsKICAgIH0KICAgCiAgICAKfQoKLyoqCiAqIEB0aXRsZSBBdWN0aW9uCiAqCiAqIEJpbGxpb25UaXggcHJvcHJpZXRhcnkgQXVjdGlvbiAKICogb2YgQmlsbGlvblRpeAogKiBEZXZlbG9wZWQgRXhjbHVzaXZlbHkgZm9yIGFuZCBieSBCaWxsaW9uVGl4IEphbiAzMSAyMDE4CiAqLwogCmNvbnRyYWN0IEF1Y3Rpb24gaXMgTm9uRnVuZ2libGVUb2tlbiwgT3duYWJsZSB7CiAgICAgICAgICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIAogICAgc3RydWN0IEFjdGl2ZUF1Y3Rpb25zU3RydWN0IHsKICAgIGFkZHJlc3MgYXVjdGlvbk93bmVyOwogICAgdWludCBpc0JlaW5nQXVjdGlvbmVkOyAKICAgIC8vMT1CZWluZyBBdWN0aW9uZWQgMD1Ob3QgQmVpbmcgQXVjdGlvbmVkCiAgICB1aW50IHN0YXJ0aW5nUHJpY2U7CiAgICB1aW50IGJ1eW5vd1ByaWNlOwogICAgdWludCBoaWdoZXN0QmlkOwogICAgdWludCBudW1iZXJvZkJpZHM7CiAgICB1aW50IGF1Y3Rpb25FbmQ7CiAgICB1aW50IGxhc3RTZWxsaW5nUHJpY2U7CiAgICBhZGRyZXNzIHdpbm5pbmdCaWRkZXI7CiAgICAKICB9CiAgCiAgc3RydWN0IEFjdGl2ZUF1Y3Rpb25zQnlBZGRyZXNzU3RydWN0IHsKICAgICAgCiAgICAgIHVpbnQgdGl4TnVtYmVyZm9yU2FsZTsKICAgICAgCiAgfQogIAogCiAgICBtYXBwaW5nKHVpbnQgPT4gQWN0aXZlQXVjdGlvbnNTdHJ1Y3QpIHByaXZhdGUgYWN0aXZlQXVjdGlvbnNTdHJ1Y3RzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnRbXSkgcHJpdmF0ZSBhY3RpdmVBdWN0aW9uc0J5QWRkcmVzc1N0cnVjdHM7CgogICAgZXZlbnQgTGl2ZUF1Y3Rpb25FdmVudCAoYWRkcmVzcyBhdWN0aW9ub3duZXIsIHVpbnQgaW5kZXhlZCB0aXhOdW1iZXJmb3JTYWxlLCB1aW50IGluZGV4ZWQgc3RhcnRpbmdQcmljZSwgdWludCBpbmRleGVkIGJ1eW5vd1ByaWNlLCB1aW50IGF1Y3Rpb25MZW5ndGgpOwogICAgZXZlbnQgUnVubmluZ0F1Y3Rpb25zRXZlbnQgKGFkZHJlc3MgYXVjdGlvbm93bmVyLCB1aW50IGluZGV4ZWQgdGl4TnVtYmVyZm9yU2FsZSwgdWludCBpbmRleGVkIGlzQmVpbmdBdWN0aW9uZWQsIHVpbnQgYXVjdGlvbkxlbmd0aCk7CiAgICBldmVudCBTdWNjZXNzQXVjdGlvbkV2ZW50IChhZGRyZXNzIGF1Y3Rpb25vd25lciwgYWRkcmVzcyBhdWN0aW9ud2lubmVyLCB1aW50IGluZGV4ZWQgdGl4TnVtYmVyZm9yU2FsZSwgdWludCBpbmRleGVkIHdpbm5pbmdQcmljZSk7CiAgICBldmVudCBDYW5jZWxlZEF1Y3Rpb25FdmVudCAoYWRkcmVzcyBhdWN0aW9ub3duZXIsIGFkZHJlc3MgaGlnaGVzdGJpZGRlciwgdWludCBpbmRleGVkIHRpeE51bWJlcmZvclNhbGUsIHVpbnQgaW5kZXhlZCBoaWdoZXN0YmlkKTsKICAgIGV2ZW50IEJ1eU5vd0V2ZW50IChhZGRyZXNzIGF1Y3Rpb25vd25lciwgYWRkcmVzcyB0aWNrZXRidXllciwgdWludCBpbmRleGVkIHRpeE51bWJlcmZvclNhbGUsIHVpbnQgaW5kZXhlZCBwdXJjaGFzZXByaWNlKTsKICAgIGV2ZW50IExvZ0JpZCAoYWRkcmVzcyBhdWN0aW9ub3duZXIsIGFkZHJlc3MgaGlnaGVzdGJpZGRlciwgdWludCBpbmRleGVkIHRpeE51bWJlcmZvclNhbGUsIHVpbnQgaW5kZXhlZCBoaWdoZXN0YmlkLCB1aW50IGluZGV4ZWQgYmlkbnVtYmVyKTsKICAgIGV2ZW50IExvZ1JlZnVuZCAoYWRkcmVzcyBsb3NpbmdiaWRkZXIsIHVpbnQgaW5kZXhlZCB0aXhOdW1iZXJmb3JTYWxlLCB1aW50IGluZGV4ZWQgcmVmdW5kZWRhbW91bnQpOwogICAgZXZlbnQgQ3JlYXRpb25GYWlsZWRFdmVudCAoYWRkcmVzcyBhdWN0aW9ucmVxdWVzdGVkYnksIHVpbnQgaW5kZXhlZCB0aXhOdW1iZXJmb3JTYWxlLCBzdHJpbmcgYXBwcm92YWxzdGF0dXMpOwogICAgZXZlbnQgQmlkRmFpbGVkRXZlbnQgKGFkZHJlc3MgYmlkZGVyLCB1aW50IHRpeE51bWJlcmZvclNhbGUsIHN0cmluZyBiaWRmYWlsdXJlKTsKCiAgICAKICAgIGFkZHJlc3MgdGlja2V0b3dud2VyOwogICAgYWRkcmVzcyBwdWJsaWMgYXVjdGlvbmxlYWRlcjsKCiAgICBzdHJpbmcgcHVibGljIGFwcHJvdmFsID0gIkF1Y3Rpb24gQXBwcm92ZWQiOwogICAgc3RyaW5nIHB1YmxpYyBub3RhcHByb3ZlZCA9ICJZb3UgRG8gTm90IE93biBUaGlzIFRpY2tldCBvciBUaWNrZXQgaXMgQWxyZWFkeSBGb3IgU2FsZSI7CiAgICBzdHJpbmcgcHVibGljIGJpZGZhaWx1cmUgPSJCaWQgRmFpbHVyZSI7CiAgIAogICAgdWludCBwdWJsaWMgdGl4TnVtYmVyZm9yU2FsZTsKICAgIHVpbnQgcHVibGljIGxlYWRpbmdCaWQ7CiAgICB1aW50IHB1YmxpYyBzdGFydGluZ1ByaWNlOwogICAgdWludCBwdWJsaWMgd2lubmluZ1ByaWNlOwogICAgdWludCBwdWJsaWMgYnV5bm93UHJpY2U7CiAgICB1aW50IHB1YmxpYyBhdWN0aW9uTGVuZ3RoOwogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQ7CiAgICB1aW50MjU2IHB1YmxpYyBjYW5jZWxDb3N0OwogICAgCiAgICB1aW50W10gcHVibGljIHJ1bm5pbmdhdWN0aW9uczsKIAogICAgZnVuY3Rpb24gQXVjdGlvbigpIHB1YmxpYyB7CiAgICAgICAgLy9Pbmx5IGNhbGxlZCBvbmNlIHdoZW4gY29udHJhY3QgY3JlYXRlZC4gIFB1dCBpbml0aWFsaXphdGlvbiBjb25zdHJ1Y3RzIGhlcmUgaWYgbmVlZGVkCiAgICB9CiAgICAKCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uICh1aW50IF9zdGFydHByaWNlLCB1aW50IF9idXlub3dwcmljZSwgdWludCBfdGl4Zm9yc2FsZSwgdWludCBfYXVjdGlvbnRpbWUpIHB1YmxpYyAgewogICAgICAgIAogICAgICAgIHJlcXVpcmUgKF9zdGFydHByaWNlID49IDApOwogICAgICAgIHJlcXVpcmUgKF9idXlub3dwcmljZSA+PSAwKTsKICAgICAgICByZXF1aXJlIChfdGl4Zm9yc2FsZSA+IDApOwogICAgICAgIHJlcXVpcmUgKF9hdWN0aW9udGltZSA+IDApOwogICAgICAgIAogICAgICAgIGFkZHJlc3MgYXVjdGlvbm93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB0aXhOdW1iZXJmb3JTYWxlID0gX3RpeGZvcnNhbGU7CiAgICAgICAgdGlja2V0b3dud2VyID0gb3duZXJPZih0aXhOdW1iZXJmb3JTYWxlKTsKICAgICAgICBhdWN0aW9uTGVuZ3RoID0gX2F1Y3Rpb250aW1lOwogICAgICAgICAKICAgICAgICB2YXIgYXVjdGlvbkRldGFpbHMgPSBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbdGl4TnVtYmVyZm9yU2FsZV07CgogICAgICAgIHVpbnQgYXVjdGlvbnN0YXR1cyA9IGF1Y3Rpb25EZXRhaWxzLmlzQmVpbmdBdWN0aW9uZWQ7CgoKICAgICAgICBpZiAoYXVjdGlvbm93bmVyID09IHRpY2tldG93bndlciAmJiBhdWN0aW9uc3RhdHVzICE9IDEpIHsKICAgICAgICAgCiAgICAgICAgIHN0YXJ0aW5nUHJpY2UgPSBfc3RhcnRwcmljZTsKICAgICAgICAgYnV5bm93UHJpY2UgPSBfYnV5bm93cHJpY2U7CiAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmF1Y3Rpb25Pd25lciA9IGF1Y3Rpb25vd25lcjsKICAgICAgICAgYXVjdGlvbkRldGFpbHMuc3RhcnRpbmdQcmljZSA9IHN0YXJ0aW5nUHJpY2U7CiAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmJ1eW5vd1ByaWNlID0gYnV5bm93UHJpY2U7CiAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmhpZ2hlc3RCaWQgPSBzdGFydGluZ1ByaWNlOwogICAgICAgICBhdWN0aW9uRGV0YWlscy5pc0JlaW5nQXVjdGlvbmVkID0gMTsKICAgICAgICAgYXVjdGlvbkRldGFpbHMubnVtYmVyb2ZCaWRzID0gMDsKICAgICAgICAgYXVjdGlvbkRldGFpbHMuYXVjdGlvbkVuZCA9IG5vdyArIGF1Y3Rpb25MZW5ndGg7CiAgICAgICAgIHJ1bm5pbmdhdWN0aW9ucy5wdXNoKHRpeE51bWJlcmZvclNhbGUpOwoKICAgICAKICAgICAgICAgYWN0aXZlQXVjdGlvbnNCeUFkZHJlc3NTdHJ1Y3RzW2F1Y3Rpb25vd25lcl0ucHVzaCh0aXhOdW1iZXJmb3JTYWxlKTsKICAgICAgICAgTGl2ZUF1Y3Rpb25FdmVudChhdWN0aW9ub3duZXIsIHRpeE51bWJlcmZvclNhbGUsIHN0YXJ0aW5nUHJpY2UsIGJ1eW5vd1ByaWNlLCBhdWN0aW9uRGV0YWlscy5hdWN0aW9uRW5kKTsKCiAgICAgICAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAKICAgICAgICBDcmVhdGlvbkZhaWxlZEV2ZW50KG1zZy5zZW5kZXIsIHRpeE51bWJlcmZvclNhbGUsIG5vdGFwcHJvdmVkKTsKICAgICAgICByZXZlcnQoKTsKCiAgICAgICAgfQogICAgCiAgICB9CiAgIAogICAgZnVuY3Rpb24gcGxhY2VCaWQodWludCBfdGl4Zm9yc2FsZSkgcGF5YWJsZSBwdWJsaWN7CiAgICAgICAKCiAgICAgIHZhciBhdWN0aW9uRGV0YWlscyA9IGFjdGl2ZUF1Y3Rpb25zU3RydWN0c1tfdGl4Zm9yc2FsZV07CiAgICAgIHVpbnQgYXVjdGlvbmF2YWlsYWJsZSA9IGF1Y3Rpb25EZXRhaWxzLmlzQmVpbmdBdWN0aW9uZWQ7CiAgICAgIHVpbnQgbGVhZGJpZCA9IGF1Y3Rpb25EZXRhaWxzLmhpZ2hlc3RCaWQ7CiAgICAgIHVpbnQgYmlkdG90YWwgPSBhdWN0aW9uRGV0YWlscy5udW1iZXJvZkJpZHM7CiAgICAgIGFkZHJlc3MgYXVjdGlvbm93bmVyID0gYXVjdGlvbkRldGFpbHMuYXVjdGlvbk93bmVyOwogICAgICBhZGRyZXNzIGxlYWRpbmdiaWRkZXIgPSBhdWN0aW9uRGV0YWlscy53aW5uaW5nQmlkZGVyOwogICAgICB1aW50IGVuZG9mYXVjdGlvbiA9IGF1Y3Rpb25EZXRhaWxzLmF1Y3Rpb25FbmQ7CiAgICAgIAogICAgICByZXF1aXJlIChub3cgPD0gZW5kb2ZhdWN0aW9uKTsKICAgICAgcmVxdWlyZSAoYXVjdGlvbmF2YWlsYWJsZSA9PSAxKTsKICAgICAgcmVxdWlyZSAobXNnLnZhbHVlID4gbGVhZGJpZCk7CiAgICAgIAogICAgICAgIGlmIChtc2cudmFsdWUgPiBsZWFkYmlkKSB7CiAgICAgICAgICAgCiAgICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLndpbm5pbmdCaWRkZXIgPSBtc2cuc2VuZGVyOwogICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5oaWdoZXN0QmlkID0gbXNnLnZhbHVlOwogICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5udW1iZXJvZkJpZHMrKzsKICAgICAgICAgICAgdWludCBiaWRudW1iZXIgPSBhdWN0aW9uRGV0YWlscy5udW1iZXJvZkJpZHM7CiAgICAgICAgICAgIAogICAgICAgICAgICAgaWYgKGJpZHRvdGFsID4gMCkgewogICAgICAgICAgICByZXR1cm5QcmV2QmlkKGxlYWRpbmdiaWRkZXIsIGxlYWRiaWQsIF90aXhmb3JzYWxlKTsKICAgICAgICAgICB9CiAgICAgICAgICAgIExvZ0JpZChhdWN0aW9ub3duZXIsIGF1Y3Rpb25EZXRhaWxzLndpbm5pbmdCaWRkZXIsIF90aXhmb3JzYWxlLCBhdWN0aW9uRGV0YWlscy5oaWdoZXN0QmlkLCBiaWRudW1iZXIpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIEJpZEZhaWxlZEV2ZW50KG1zZy5zZW5kZXIsIF90aXhmb3JzYWxlLCBiaWRmYWlsdXJlKTsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgIAogICAgCiAgICAgICAgCiAgICB9CiAgIAogICAgZnVuY3Rpb24gcmV0dXJuUHJldkJpZChhZGRyZXNzIF9oaWdoZXN0YmlkZGVyLCB1aW50IF9sZWFkYmlkLCB1aW50IF90aXhudW1iZXJmb3JzYWxlKSBpbnRlcm5hbCB7CiAgICAgIAogICAgICAgIGlmIChfaGlnaGVzdGJpZGRlciAhPSAwICYmIF9sZWFkYmlkID4gMCkgewogICAgICAgICAgIAogICAgICAgICAgICBfaGlnaGVzdGJpZGRlci50cmFuc2ZlcihfbGVhZGJpZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBMb2dSZWZ1bmQoX2hpZ2hlc3RiaWRkZXIsIF90aXhudW1iZXJmb3JzYWxlLCBfbGVhZGJpZCk7CiAgICAgICAgCiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRPd25lckN1dCh1aW50MjU2IF9vd25lcmN1dCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAKICAgICAgIG93bmVyQ3V0ID0gX293bmVyY3V0OwogICAgICAgCiAgICAgICAKICAgfQogICAKICAgZnVuY3Rpb24gc2V0Q29zdFRvQ2FuY2VsKHVpbnQyNTYgX2NhbmNlbGNvc3QpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgCiAgICAgICBjYW5jZWxDb3N0ID0gX2NhbmNlbGNvc3Q7CiAgICAgICAKICAgICAgIAogICB9CiAgIAogICAgZnVuY3Rpb24gZ2V0Q29zdFRvQ2FuY2VsKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgCiAgICAgICByZXR1cm4gY2FuY2VsQ29zdDsKICAgICAgIAogICAgICAgCiAgIH0KICAgIAoKICAgIC8vRU5EIEFVQ1RJT04gRlVOQ1RJT04gQ0FOIEJFIENBTExFRCBBRlRFUiBBVUNUSU9OIFRJTUUgSVMgVVAgQlkgRUlUSEVSIFNFTExFUiBPUiBXSU5OSU5HIFBBUlRZCiAgICAKICAgIGZ1bmN0aW9uIGVuZEF1Y3Rpb24odWludCBfdGl4bnVtYmVyZm9yc2FsZSkgcHVibGljIHsKICAgICAgICAKCiAgICAgIHZhciBhdWN0aW9uRGV0YWlscyA9IGFjdGl2ZUF1Y3Rpb25zU3RydWN0c1tfdGl4bnVtYmVyZm9yc2FsZV07CiAgICAgIHVpbnQgYXVjdGlvbkVuZCA9IGF1Y3Rpb25EZXRhaWxzLmF1Y3Rpb25FbmQ7CiAgICAgIGFkZHJlc3MgYXVjdGlvbm93bmVyID0gYXVjdGlvbkRldGFpbHMuYXVjdGlvbk93bmVyOwogICAgICBhZGRyZXNzIGF1Y3Rpb253aW5uZXIgPSBhdWN0aW9uRGV0YWlscy53aW5uaW5nQmlkZGVyOwogICAgICB1aW50MjU2IHdpbm5pbmdCaWQgPSBhdWN0aW9uRGV0YWlscy5oaWdoZXN0QmlkOwogICAgICB1aW50IG51bWJlcm9mQmlkcyA9IGF1Y3Rpb25EZXRhaWxzLm51bWJlcm9mQmlkczsKCiAgICAgICAgcmVxdWlyZSAobm93ID4gYXVjdGlvbkVuZCk7CgogICAgICAgaWYgKChtc2cuc2VuZGVyID09IGF1Y3Rpb25vd25lciB8fCBtc2cuc2VuZGVyID09IGF1Y3Rpb253aW5uZXIpICYmIG51bWJlcm9mQmlkcyA+IDAgJiYgd2lubmluZ0JpZCA+IDApIHsKICAgICAgICAgIAoKICAgICAgICAgICB1aW50MjU2IG93bmVyc0N1dCA9IHdpbm5pbmdCaWQgKiBvd25lckN1dCAvIDEwMDAwOwogICAgICAgIAogICAgICAgICAgIG93bmVyLnRyYW5zZmVyKG93bmVyc0N1dCk7CiAgICAgICAgICAgYXVjdGlvbm93bmVyLnRyYW5zZmVyKGF1Y3Rpb25EZXRhaWxzLmhpZ2hlc3RCaWQgLSBvd25lcnNDdXQpOwogICAgICAgICAgIGF1Y3Rpb250cmFuc2ZlcihhdWN0aW9ub3duZXIsIGF1Y3Rpb253aW5uZXIsIF90aXhudW1iZXJmb3JzYWxlKTsKICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5pc0JlaW5nQXVjdGlvbmVkID0gMDsKICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5hdWN0aW9uRW5kID0gMDsKICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5udW1iZXJvZkJpZHMgPSAwOwogICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmhpZ2hlc3RCaWQgPSAwOwogICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmJ1eW5vd1ByaWNlID0gMDsKICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5zdGFydGluZ1ByaWNlID0gMDsKICAgICAgICAgICByZW1vdmVCeVZhbHVlKF90aXhudW1iZXJmb3JzYWxlKTsKICAgICAgICAgICBTdWNjZXNzQXVjdGlvbkV2ZW50KGF1Y3Rpb25vd25lciwgYXVjdGlvbndpbm5lciwgX3RpeG51bWJlcmZvcnNhbGUsIHdpbm5pbmdCaWQpOwogICAgICAgICAgIAogICAgICAgfQogICAgICAgCiAgICAgICBpZiAobXNnLnNlbmRlciA9PSBhdWN0aW9ub3duZXIgJiYgbnVtYmVyb2ZCaWRzID09IDApIHsKICAgICAgICAgIAoKICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5pc0JlaW5nQXVjdGlvbmVkID0gMDsKICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5hdWN0aW9uRW5kID0gMDsKICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5udW1iZXJvZkJpZHMgPSAwOwogICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmhpZ2hlc3RCaWQgPSAwOwogICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmJ1eW5vd1ByaWNlID0gMDsKICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5zdGFydGluZ1ByaWNlID0gMDsKCiAgICAgICAgICAgcmVtb3ZlQnlWYWx1ZShfdGl4bnVtYmVyZm9yc2FsZSk7CgogICAgICAgICAgIFN1Y2Nlc3NBdWN0aW9uRXZlbnQoYXVjdGlvbm93bmVyLCBhdWN0aW9ud2lubmVyLCBfdGl4bnVtYmVyZm9yc2FsZSwgd2lubmluZ0JpZCk7CiAgICAgICAgICAgCiAgICAgICB9CiAgICAgICAKICAgICAgIAogICAgICAgCiAgICAgICAKICAgfQogICAKICAgCiAgCgogICAvL0NBTkNFTCBBVUNUSU9OIENBTiBPTkxZIEJFIENBTExFRCBCWSBBVUNUSU9OIE9XTkVSIC0gQUxMIE1PTkVZIFJFVFVSTkVEIFRPIEhJR0hFU1QgQklEREVSLiBDT1NUUyBFVEhFUgogICAKICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50IF90aXhudW1iZXJmb3JzYWxlKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgdmFyIGF1Y3Rpb25EZXRhaWxzID0gYWN0aXZlQXVjdGlvbnNTdHJ1Y3RzW190aXhudW1iZXJmb3JzYWxlXTsKICAgICAgICB1aW50IGF1Y3Rpb25FbmQgPSBhdWN0aW9uRGV0YWlscy5hdWN0aW9uRW5kOwogICAgICAgIHVpbnQgbnVtYmVyb2ZCaWRzID0gYXVjdGlvbkRldGFpbHMubnVtYmVyb2ZCaWRzOwoKICAgICAgICByZXF1aXJlIChub3cgPCBhdWN0aW9uRW5kKTsKICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICAgdWludDI1NiBoaWdoZXN0QmlkID0gYXVjdGlvbkRldGFpbHMuaGlnaGVzdEJpZDsKICAgICAgICAgYWRkcmVzcyBhdWN0aW9ud2lubmVyID0gYXVjdGlvbkRldGFpbHMud2lubmluZ0JpZGRlcjsKICAgICAgICAgYWRkcmVzcyBhdWN0aW9ub3duZXIgPSBhdWN0aW9uRGV0YWlscy5hdWN0aW9uT3duZXI7CiAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYXVjdGlvbm93bmVyICYmIG1zZy52YWx1ZSA+PSBjYW5jZWxDb3N0ICYmIG51bWJlcm9mQmlkcyA+IDApIHsKCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGF1Y3Rpb253aW5uZXIudHJhbnNmZXIoaGlnaGVzdEJpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1JlZnVuZChhdWN0aW9ud2lubmVyLCBfdGl4bnVtYmVyZm9yc2FsZSwgaGlnaGVzdEJpZCk7CgogICAgICAgICAgICAgICAgICAgICAgICBvd25lci50cmFuc2ZlcihjYW5jZWxDb3N0KTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmlzQmVpbmdBdWN0aW9uZWQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5hdWN0aW9uRW5kID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYXVjdGlvbkRldGFpbHMubnVtYmVyb2ZCaWRzID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYXVjdGlvbkRldGFpbHMuaGlnaGVzdEJpZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmJ1eW5vd1ByaWNlID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYXVjdGlvbkRldGFpbHMuc3RhcnRpbmdQcmljZSA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVCeVZhbHVlKF90aXhudW1iZXJmb3JzYWxlKTsKCgogICAgICAgICAgICAgIENhbmNlbGVkQXVjdGlvbkV2ZW50KGF1Y3Rpb25vd25lciwgYXVjdGlvbndpbm5lciwgX3RpeG51bWJlcmZvcnNhbGUsIGhpZ2hlc3RCaWQpOwoKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IGF1Y3Rpb25vd25lciAmJiBtc2cudmFsdWUgPj0gY2FuY2VsQ29zdCAmJiBudW1iZXJvZkJpZHMgPT0gMCkgewoKICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIudHJhbnNmZXIoY2FuY2VsQ29zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5pc0JlaW5nQXVjdGlvbmVkID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYXVjdGlvbkRldGFpbHMuYXVjdGlvbkVuZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLm51bWJlcm9mQmlkcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmhpZ2hlc3RCaWQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBhdWN0aW9uRGV0YWlscy5idXlub3dQcmljZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLnN0YXJ0aW5nUHJpY2UgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQnlWYWx1ZShfdGl4bnVtYmVyZm9yc2FsZSk7CgoKICAgICAgICAgICAgICBDYW5jZWxlZEF1Y3Rpb25FdmVudChhdWN0aW9ub3duZXIsIGF1Y3Rpb253aW5uZXIsIF90aXhudW1iZXJmb3JzYWxlLCBoaWdoZXN0QmlkKTsKCiAgICAgICAgICAgICAgICB9CgogICAgICAgCiAgIH0KICAgCgogICAvL0J1eSBOb3cgQ2FuY2VscyBBdWN0aW9uIHdpdGggbm8gUGVuYWx0eSBhbmQgcmV0dXJucyBhbGwgcGxhY2VkIGJpZHMuICBDb250cmFjdCB0YWtlcyBjdXQgb2YgYnV5IG5vdyBwcmljZQoKICAgZnVuY3Rpb24gYnV5Tm93KHVpbnQgX3RpeG51bWJlcmZvcnNhbGUpIHBheWFibGUgcHVibGljIHsKICAgICAgIAoKICAgICB2YXIgYXVjdGlvbkRldGFpbHMgPSBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbX3RpeG51bWJlcmZvcnNhbGVdOwogICAgICB1aW50IGF1Y3Rpb25FbmQgPSBhdWN0aW9uRGV0YWlscy5hdWN0aW9uRW5kOwogICAgICBhZGRyZXNzIGF1Y3Rpb25vd25lciA9IGF1Y3Rpb25EZXRhaWxzLmF1Y3Rpb25Pd25lcjsKICAgICAgYWRkcmVzcyBhdWN0aW9ubGVhZCA9IGF1Y3Rpb25EZXRhaWxzLndpbm5pbmdCaWRkZXI7CiAgICAgIHVpbnQyNTYgaGlnaGVzdEJpZCA9IGF1Y3Rpb25EZXRhaWxzLmhpZ2hlc3RCaWQ7CiAgICAgIHVpbnQyNTYgYnV5bm93cHJpY2UgPSBhdWN0aW9uRGV0YWlscy5idXlub3dQcmljZTsKICAgICAgCiAgICAgIHVpbnQyNTYgYnV5bm93Y3V0ID0gb3duZXJDdXQ7CiAgICAKICAgICAgdWludDI1NiBidXlub3dvd25lcnNDdXQgPSBidXlub3dQcmljZSAqIGJ1eW5vd2N1dCAvIDEwMDAwOwoKCiAgICAgIHJlcXVpcmUoYnV5bm93cHJpY2UgPiAwKTsKICAgICAgcmVxdWlyZShub3cgPCBhdWN0aW9uRW5kKTsKICAgICAgICAKICAgICAgaWYgKG1zZy52YWx1ZSA9PSBidXlub3dQcmljZSkgewogICAgICAgICAgCgogICAgICAgICAgYXVjdGlvbm93bmVyLnRyYW5zZmVyKGJ1eW5vd1ByaWNlIC0gYnV5bm93b3duZXJzQ3V0KTsKICAgICAgICAgIG93bmVyLnRyYW5zZmVyKGJ1eW5vd293bmVyc0N1dCk7CiAgICAgICAgIAogICAgICAgICAKICAgICAgICAgIGF1Y3Rpb250cmFuc2ZlcihhdWN0aW9ub3duZXIsIG1zZy5zZW5kZXIsIF90aXhudW1iZXJmb3JzYWxlKTsKICAgICAgICAgIGF1Y3Rpb25EZXRhaWxzLmlzQmVpbmdBdWN0aW9uZWQgPSAwOwogICAgICAgICAgYXVjdGlvbkRldGFpbHMuYXVjdGlvbkVuZCA9IDA7CiAgICAgICAgICBhdWN0aW9uRGV0YWlscy5udW1iZXJvZkJpZHMgPSAwOwogICAgICAgICAgYXVjdGlvbkRldGFpbHMuaGlnaGVzdEJpZCA9IDA7CiAgICAgICAgICBhdWN0aW9uRGV0YWlscy5idXlub3dQcmljZSA9IDA7CiAgICAgICAgICBhdWN0aW9uRGV0YWlscy5zdGFydGluZ1ByaWNlID0gMDsKCiAgICAgICAgICByZW1vdmVCeVZhbHVlKF90aXhudW1iZXJmb3JzYWxlKTsKCgogICAgICAgICAgQnV5Tm93RXZlbnQoYXVjdGlvbm93bmVyLCBtc2cuc2VuZGVyLCBfdGl4bnVtYmVyZm9yc2FsZSwgbXNnLnZhbHVlKTsKICAgICAgICAgIAogICAgICAgICAgIGlmIChhdWN0aW9uRGV0YWlscy5udW1iZXJvZkJpZHMgPiAwKSB7CiAgICAgICAgIAogICAgICAgICAgcmV0dXJuUHJldkJpZChhdWN0aW9ubGVhZCwgaGlnaGVzdEJpZCwgX3RpeG51bWJlcmZvcnNhbGUpOwoKICAgICAgICAgfQogICAgICAgICAgCiAgICAgICAgICAKICAgICAgfSBlbHNlIHsKICAgICAgICAgIAogICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgIH0KICAgICAgIAogICB9CiAgIAogICAgZnVuY3Rpb24gd2l0aGRyYXcoYWRkcmVzcyBmb3J3YXJkQWRkcmVzcywgdWludCBhbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewoKICAgICAgICBmb3J3YXJkQWRkcmVzcy50cmFuc2ZlcihhbW91bnQpOwoKfQogICAKIAogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbkRldGFpbHModWludCB0aXhudW1iZXJmb3JzYWxlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IF9zdGFydGluZ3ByaWNlLCB1aW50IF9idXlub3dwcmljZSwgdWludCBfbnVtYmVyb2ZCaWRzLCB1aW50IF9oaWdoZXN0QmlkLCB1aW50IF9hdWN0aW9uRW5kLCBhZGRyZXNzIHdpbm5pbmdCaWRkZXIsIGFkZHJlc3MgX2F1Y3Rpb25Pd25lcikKICAgIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbdGl4bnVtYmVyZm9yc2FsZV0uc3RhcnRpbmdQcmljZSwKICAgICAgICAgYWN0aXZlQXVjdGlvbnNTdHJ1Y3RzW3RpeG51bWJlcmZvcnNhbGVdLmJ1eW5vd1ByaWNlLAogICAgICAgICBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbdGl4bnVtYmVyZm9yc2FsZV0ubnVtYmVyb2ZCaWRzLAogICAgICAgICBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbdGl4bnVtYmVyZm9yc2FsZV0uaGlnaGVzdEJpZCwKICAgICAgICAgYWN0aXZlQXVjdGlvbnNTdHJ1Y3RzW3RpeG51bWJlcmZvcnNhbGVdLmF1Y3Rpb25FbmQsCiAgICAgICAgIGFjdGl2ZUF1Y3Rpb25zU3RydWN0c1t0aXhudW1iZXJmb3JzYWxlXS53aW5uaW5nQmlkZGVyLAogICAgICAgICBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbdGl4bnVtYmVyZm9yc2FsZV0uYXVjdGlvbk93bmVyKTsKICAgICAgICAgCgogICAgfQogICAgCiAgICAvL0hhZCB0byBzcGxpdCBkdWUgdG8gc3RhY2sgbGltaXRhdGlvbnMgb2YgU29saWRpdHkgLSBQdWxsIGJhY2sgdG9nZXRoZXIgaW4gVUkKICAgIAogICAgZnVuY3Rpb24gZ2V0TW9yZUF1Y3Rpb25EZXRhaWxzKHVpbnQgdGl4bnVtYmVyZm9yc2FsZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBfYXVjdGlvbnN0YXR1cywgdWludCBfYXVjdGlvbkVuZCwgYWRkcmVzcyBfYXVjdGlvbk93bmVyKSB7CiAgICAgICAgCiAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbdGl4bnVtYmVyZm9yc2FsZV0uaXNCZWluZ0F1Y3Rpb25lZCwKICAgICAgICAgICAgICAgICAgICBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbdGl4bnVtYmVyZm9yc2FsZV0uYXVjdGlvbkVuZCwKICAgICAgICAgICAgICAgICAgICBhY3RpdmVBdWN0aW9uc1N0cnVjdHNbdGl4bnVtYmVyZm9yc2FsZV0uYXVjdGlvbk93bmVyKTsKICAgICAgICAKICAgIH0KICAgCiAgICAKICAgICBmdW5jdGlvbiBnZXRPd25lckF1Y3Rpb25zKGFkZHJlc3MgX2F1Y3Rpb25vd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludFtdIF9hdWN0aW9ucykKICAgIHsKICAgICAgIAogICAgICAgIHJldHVybiBhY3RpdmVBdWN0aW9uc0J5QWRkcmVzc1N0cnVjdHNbX2F1Y3Rpb25vd25lcl07CiAgICB9CiAgCiAgICAKICAvL0ZVTkNUSU9OUyBVU0VEIFRPIEtFRVAgQUNDVVJBVEUgQVJSQVkgT0YgTElWRSBBVUNUSU9OUwogIAogIGZ1bmN0aW9uIGZpbmQodWludCB2YWx1ZSkgdmlldyBwdWJsaWMgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBpID0gMDsKICAgICAgICB3aGlsZSAocnVubmluZ2F1Y3Rpb25zW2ldICE9IHZhbHVlKSB7CiAgICAgICAgICAgIGkrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlQnlWYWx1ZSh1aW50IHZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgdWludCBpID0gZmluZCh2YWx1ZSk7CiAgICAgICAgcmVtb3ZlQnlJbmRleChpKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVCeUluZGV4KHVpbnQgaSkgaW50ZXJuYWwgewogICAgICAgIHdoaWxlIChpPHJ1bm5pbmdhdWN0aW9ucy5sZW5ndGgtMSkgewogICAgICAgICAgICBydW5uaW5nYXVjdGlvbnNbaV0gPSBydW5uaW5nYXVjdGlvbnNbaSsxXTsKICAgICAgICAgICAgaSsrOwogICAgICAgIH0KICAgICAgICBydW5uaW5nYXVjdGlvbnMubGVuZ3RoLS07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UnVubmluZ0F1Y3Rpb25zKCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludFtdKSB7CiAgICAgICAgcmV0dXJuIHJ1bm5pbmdhdWN0aW9uczsKICAgIH0KCgogICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMge30KCiAgIAp9CgoKLyoqCiAqIEB0aXRsZSBCaWxsaW9uVGl4CiAqCiAqIE1haW4gQmlsbGlvblRpeCBDb250cmFjdC4gQ29udHJvbHMgY3JlYXRpb24gb2YgQmlsbGlvblRpeCBhbmQgIAogKiBzZWxlY3RpbmcgYW5kIFBheWluZyBHaXZlYXdheSBXaW5uZXJzCiAqIERldmVsb3BlZCBFeGNsdXNpdmVseSBmb3IgYW5kIGJ5IEJpbGxpb25UaXggSmFuIDMxIDIwMTgKICovCiAKY29udHJhY3QgQmlsbGlvbnRpeCBpcyBNaW50YWJsZU5vbkZ1bmdpYmxlVG9rZW4sIEF1Y3Rpb24gewogICBhZGRyZXNzIG93bmVyOwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICdCaWxsaW9uVGl4JzsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gJ0JUSVgnOwogICAKICAgIHN0cmluZyBpbnRlcm5hbCBUZW5UaW1lc0V0aGVyID0gIjAuMDA1IEV0aGVyIjsKICAgIHN0cmluZyBpbnRlcm5hbCBPbmVIdW5kcmVkVGltZXNFdGhlciA9ICIwLjA1IEV0aGVyIjsKICAgIHN0cmluZyBpbnRlcm5hbCBPbmVUaG91c2FuZFRpbWVzRXRoZXIgPSAiMC41IEV0aGVyIjsKICAgIHN0cmluZyBpbnRlcm5hbCBUZW5UaG91c2FuZFRpbWVzRXRoZXIgPSAiNSBFdGhlciI7CiAgICBzdHJpbmcgaW50ZXJuYWwgT25lSHVuZHJlZFRob3VzYW5kVGltZXNFdGhlciA9ICI1MCBFdGhlciI7CiAgICBzdHJpbmcgaW50ZXJuYWwgT25lTWlsbGlvblRpbWVzRXRoZXIgPSAiNTAwIEV0aGVyIjsKICAgIHN0cmluZyBpbnRlcm5hbCBUZW5NaWxsaW9uVGltZXNFdGhlciA9ICI1LDAwMCBFdGhlciI7CiAgICBzdHJpbmcgaW50ZXJuYWwgT25lSHVuZHJlZE1pbGxpb25UaW1lc0V0aGVyID0gIjUwLDAwMCBFdGhlciI7CiAgICBzdHJpbmcgaW50ZXJuYWwgT25lQmlsbGlvblRpbWVzRXRoZXIgPSAiNTAwLDAwMCBFdGhlciI7CiAgIAogICAKICAgIC8vU0VUIFRIRVNFIFBSSUNFUyBJTiBXRUkKICAgIAogICAgdWludDI1NiBwdWJsaWMgYnV5UHJpY2UgPSAgICAgIDUwMDAwMDAwMDAwMDAwMDsKICAgIHVpbnQyNTYgcHVibGljIGJ1eTVQcmljZSA9ICAgIDI1MDAwMDAwMDAwMDAwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBidXkxMFByaWNlID0gICA1MDAwMDAwMDAwMDAwMDAwOwogICAgdWludDI1NiBwdWJsaWMgYnV5MjBQcmljZSA9ICAxMDAwMDAwMDAwMDAwMDAwMDsKICAgIHVpbnQyNTYgcHVibGljIGJ1eTUwUHJpY2UgPSAgMjUwMDAwMDAwMDAwMDAwMDA7CiAgICB1aW50MjU2IHB1YmxpYyBidXkxMDBQcmljZSA9IDUwMDAwMDAwMDAwMDAwMDAwOwoKICAgIGFkZHJlc3MgcHVibGljIHdpbm5lcjsKICAKICAgLy9UaGVzZSBhcmUgdGhlIHN1cGVydGl4IG51bWJlcnMuIFRoZXkgd2lsbCBOT1QgQ0hBTkdFCiAgIAogICAgdWludFtdIHN1cGVydGl4YXJyYXkgPSBbMTAwMDAsMTAwMDAwLDUwMDAwMCwxMDAwMDAwLDUwMDAwMDAsMTAwMDAwMDAsNTAwMDAwMDAsMTAwMDAwMDAwLDUwMDAwMDAwMCw3NTAwMDAwMDBdOwoKIAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlT2Y7IAogICAgCiAgICBldmVudCBQYXlvdXRFdmVudCAodWludCBpbmRleGVkIFdpbm5pbmdOdW1iZXIsIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQgaW5kZXhlZCB2YWx1ZSk7CiAgICBldmVudCBXaW5uaW5nTnVtYmVyc0V2ZW50ICh1aW50MjU2IGluZGV4ZWQgV2lubmluZ051bWJlciwgc3RyaW5nIEFtb3VudFdvbik7IAogICAgZXZlbnQgV2lubmVyUGFpZEV2ZW50IChhZGRyZXNzIGluZGV4ZWQgV2lubmVyLCBzdHJpbmcgQW1vdW50V29uKTsKICAgIAoKCiAgZnVuY3Rpb24gYnV5ICgpIHBheWFibGUgcHVibGljIAogICBvbmx5Tm9uZXhpc3RlbnRUb2tlbihfdG9rZW5JZCkKICAgIHsKICAgICAgIAogICAgICAgaWYgKChtc2cudmFsdWUpID09IGJ1eVByaWNlKSB7CiAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCA9IG51bVRva2Vuc1RvdGFsICsxOwogICAgICAgIF9zZXRUb2tlbk93bmVyKF90b2tlbklkLCBtc2cuc2VuZGVyKTsKICAgICAgICBfYWRkVG9rZW5Ub093bmVyc0xpc3QobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgLy8gX2luc2VydFRva2VuTWV0YWRhdGEoX3Rva2VuSWQsIF9tZXRhZGF0YSk7CgogICAgICAgbnVtVG9rZW5zVG90YWwgPSBudW1Ub2tlbnNUb3RhbC5hZGQoMSk7CgogICAgICAgIE1pbnQobXNnLnNlbmRlciwgX3Rva2VuSWQpOyAgICAgICAgICAKCiAgICAgICBpZiAobnVtVG9rZW5zVG90YWwgPiAxICYmIG51bVRva2Vuc1RvdGFsIDwgMTAwMDAwMDAwMDIpIHsKICAgICAgIHBsYXlEcmF3KCk7CiAgICAgICBwbGF5RHJhdzIoKTsKICAgICAgIHN1cGVydGl4ZHJhdygpOwogICAgICAgfSBlbHNlIHsgfQoKCiAgICAgICB9CiAgICAgICBlbHNlIHsKICAgICAgICAgIAogICAgICAgfQogICAgICAgCiAgIH0KICAgCiAgIAogICAgIGZ1bmN0aW9uIGJ1eTUgKCkgcGF5YWJsZSBwdWJsaWMgCiAgIG9ubHlOb25leGlzdGVudFRva2VuKF90b2tlbklkKQogICAgewogICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICBpZiAoKG1zZy52YWx1ZSkgPT0gYnV5NVByaWNlKSB7CiAgICAgICAgICAgCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCA9IG51bVRva2Vuc1RvdGFsICsxOwogICAgICAgIF9zZXRUb2tlbk93bmVyKF90b2tlbklkLCBtc2cuc2VuZGVyKTsKICAgICAgICBfYWRkVG9rZW5Ub093bmVyc0xpc3QobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgLy8gX2luc2VydFRva2VuTWV0YWRhdGEoX3Rva2VuSWQsIF9tZXRhZGF0YSk7CgogICAgICAgbnVtVG9rZW5zVG90YWwgPSBudW1Ub2tlbnNUb3RhbC5hZGQoMSk7CgogICAgICAgIE1pbnQobXNnLnNlbmRlciwgX3Rva2VuSWQpOyAgICAgICAgICAKCiAgICAgICBpZiAobnVtVG9rZW5zVG90YWwgPiAxICYmIG51bVRva2Vuc1RvdGFsIDwgMTAwMDAwMDAwMDIpIHsKICAgICAgIHBsYXlEcmF3KCk7CiAgICAgICBwbGF5RHJhdzIoKTsKICAgICAgIHN1cGVydGl4ZHJhdygpOwoKICAgICAgIH0gZWxzZSB7IAogICAgICAgfQogICAgICAgCiAgICAgICB9CiAgICAgICBlbHNlIHsKICAgICAgIH0KICAgICAgIH0KICAgfQoKCiAgZnVuY3Rpb24gYnV5MTAgKCkgcGF5YWJsZSBwdWJsaWMgCiAgIG9ubHlOb25leGlzdGVudFRva2VuKF90b2tlbklkKQogICAgewogICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgaWYgKChtc2cudmFsdWUpID09IGJ1eTEwUHJpY2UpIHsKICAgICAgICAgICAKICAgICAgICB1aW50MjU2IF90b2tlbklkID0gbnVtVG9rZW5zVG90YWwgKzE7CiAgICAgICAgX3NldFRva2VuT3duZXIoX3Rva2VuSWQsIG1zZy5zZW5kZXIpOwogICAgICAgIF9hZGRUb2tlblRvT3duZXJzTGlzdChtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICAgICAvLyBfaW5zZXJ0VG9rZW5NZXRhZGF0YShfdG9rZW5JZCwgX21ldGFkYXRhKTsKCiAgICAgICBudW1Ub2tlbnNUb3RhbCA9IG51bVRva2Vuc1RvdGFsLmFkZCgxKTsKCiAgICAgICAgTWludChtc2cuc2VuZGVyLCBfdG9rZW5JZCk7ICAgICAgICAgIAoKICAgICAgIGlmIChudW1Ub2tlbnNUb3RhbCA+IDEgJiYgbnVtVG9rZW5zVG90YWwgPCAxMDAwMDAwMDAwMikgewogICAgICAgcGxheURyYXcoKTsKICAgICAgIHBsYXlEcmF3MigpOwogICAgICAgc3VwZXJ0aXhkcmF3KCk7CgogICAgICAgfSBlbHNlIHsgfQogICAgICAgfQogICAgICAgZWxzZSB7CiAgICAgICAgICAKICAgICAgIH0KICAgICAgIH0KICAgfQogICAgICAKICAgIGZ1bmN0aW9uIGJ1eTIwICgpIHBheWFibGUgcHVibGljIAogICBvbmx5Tm9uZXhpc3RlbnRUb2tlbihfdG9rZW5JZCkKICAgIHsKICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IDIwOyBpKyspIHsKICAgICAgIGlmICgobXNnLnZhbHVlKSA9PSBidXkyMFByaWNlKSB7CiAgICAgICAgICAgCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCA9IG51bVRva2Vuc1RvdGFsICsxOwogICAgICAgIF9zZXRUb2tlbk93bmVyKF90b2tlbklkLCBtc2cuc2VuZGVyKTsKICAgICAgICBfYWRkVG9rZW5Ub093bmVyc0xpc3QobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgLy8gX2luc2VydFRva2VuTWV0YWRhdGEoX3Rva2VuSWQsIF9tZXRhZGF0YSk7CgogICAgICAgbnVtVG9rZW5zVG90YWwgPSBudW1Ub2tlbnNUb3RhbC5hZGQoMSk7CgogICAgICAgIE1pbnQobXNnLnNlbmRlciwgX3Rva2VuSWQpOyAgICAgICAgICAKCiAgICAgICBpZiAobnVtVG9rZW5zVG90YWwgPiAxICYmIG51bVRva2Vuc1RvdGFsIDwgMTAwMDAwMDAwMDIpIHsKICAgICAgIHBsYXlEcmF3KCk7CiAgICAgICBwbGF5RHJhdzIoKTsKICAgICAgICBzdXBlcnRpeGRyYXcoKTsKICAgICAgICAKICAgICAgfSBlbHNlIHsgfQogICAgICAgfQogICAgICAgZWxzZSB7CiAgICAgICAgICAKICAgICAgIH0KICAgICAgIH0KICAgfQogICAKICAgIGZ1bmN0aW9uIGJ1eTUwICgpIHBheWFibGUgcHVibGljIAogICBvbmx5Tm9uZXhpc3RlbnRUb2tlbihfdG9rZW5JZCkKICAgIHsKICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IDUwOyBpKyspIHsKICAgICAgIGlmICgobXNnLnZhbHVlKSA9PSBidXk1MFByaWNlKSB7CiAgICAgICAgICAgCiAgICAgICAgIHVpbnQyNTYgX3Rva2VuSWQgPSBudW1Ub2tlbnNUb3RhbCArMTsKICAgICAgICBfc2V0VG9rZW5Pd25lcihfdG9rZW5JZCwgbXNnLnNlbmRlcik7CiAgICAgICAgX2FkZFRva2VuVG9Pd25lcnNMaXN0KG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgICAgIC8vIF9pbnNlcnRUb2tlbk1ldGFkYXRhKF90b2tlbklkLCBfbWV0YWRhdGEpOwoKICAgICAgIG51bVRva2Vuc1RvdGFsID0gbnVtVG9rZW5zVG90YWwuYWRkKDEpOwoKICAgICAgICBNaW50KG1zZy5zZW5kZXIsIF90b2tlbklkKTsgICAgICAgICAgCgogICAgICAgaWYgKG51bVRva2Vuc1RvdGFsID4gMSAmJiBudW1Ub2tlbnNUb3RhbCA8IDEwMDAwMDAwMDAyKSB7CiAgICAgICBwbGF5RHJhdygpOwogICAgICAgcGxheURyYXcyKCk7CiAgICAgICAgc3VwZXJ0aXhkcmF3KCk7CiAgIAogICAgICAgfSBlbHNlIHsgfQogICAgICAgfQogICAgICAgZWxzZSB7CiAgICAgICAgICAKICAgICAgIH0KICAgICAgIH0KICAgfQogICAKICAgIGZ1bmN0aW9uIGJ1eTEwMCAoKSBwYXlhYmxlIHB1YmxpYyAKICAgb25seU5vbmV4aXN0ZW50VG9rZW4oX3Rva2VuSWQpCiAgICB7CiAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykgewogICAgICAgaWYgKChtc2cudmFsdWUpID09IGJ1eTEwMFByaWNlKSB7CiAgICAgICAgICAgCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCA9IG51bVRva2Vuc1RvdGFsICsxOwogICAgICAgIF9zZXRUb2tlbk93bmVyKF90b2tlbklkLCBtc2cuc2VuZGVyKTsKICAgICAgICBfYWRkVG9rZW5Ub093bmVyc0xpc3QobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgLy8gX2luc2VydFRva2VuTWV0YWRhdGEoX3Rva2VuSWQsIF9tZXRhZGF0YSk7CgogICAgICAgbnVtVG9rZW5zVG90YWwgPSBudW1Ub2tlbnNUb3RhbC5hZGQoMSk7CgogICAgICAgIE1pbnQobXNnLnNlbmRlciwgX3Rva2VuSWQpOyAgICAgICAgICAKCiAgICAgICBpZiAobnVtVG9rZW5zVG90YWwgPiAxICYmIG51bVRva2Vuc1RvdGFsIDwgMTAwMDAwMDAwMDIpIHsKICAgICAgIHBsYXlEcmF3KCk7CiAgICAgICBwbGF5RHJhdzIoKTsKICAgICAgIHN1cGVydGl4ZHJhdygpOwoKICAgICAgIH0gZWxzZSB7IH0KICAgICAgIH0KICAgICAgIGVsc2UgewogICAgICAgICAgCiAgICAgICB9CiAgICAgICB9CiAgIH0KCiAgIAogZnVuY3Rpb24gcGxheURyYXcoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IHdpbm5pbmdyYW5kb21OdW1iZXIxLCAKIHVpbnQgd2lubmluZ3JhbmRvbU51bWJlcjIsIAogdWludCB3aW5uaW5ncmFuZG9tTnVtYmVyMywgCiB1aW50IHdpbm5pbmdyYW5kb21OdW1iZXI0LCAKIHVpbnQgd2lubmluZ3JhbmRvbU51bWJlcjUpICB7CiAgICAgCgogICAgIHVpbnQgQSA9ICgobnVtVG9rZW5zVG90YWwgLyAxKSAlIDEwKTsKICAgICB1aW50IEIgPSAoKG51bVRva2Vuc1RvdGFsIC8gMTApICUgMTApOwogICAgIHVpbnQgQyA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDApICUgMTApOwogICAgIHVpbnQgRCA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDAwKSAlIDEwKTsKICAgICB1aW50IEUgPSAoKG51bVRva2Vuc1RvdGFsIC8gMTAwMDApICUgMTApOwogICAgIHVpbnQgRiA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDAwMDApICUgMTApOwogICAgIHVpbnQgRyA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDAwMDAwKSAlIDEwKTsKICAgICB1aW50IEggPSAoKG51bVRva2Vuc1RvdGFsIC8gMTAwMDAwMDApICUgMTApOwogICAgIHVpbnQgSSA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDAwMDAwMDApICUgMTApOwogICAgIHVpbnQgSiA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDAwMDAwMDAwKSAlIDEwKTsKCiAgCiAgICAgCiAgICAgICBpZiAoQSA9PSAxICYmIEIgPT0gMCkgewogICAgICAgICAKICAgICAgICAgd2lubmluZ3JhbmRvbU51bWJlcjEgPSAodWludChrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSwgbnVtVG9rZW5zVG90YWwgKyAxKSklMTAwICsgKDEwMDAwMDAwMDAgKiBKKSArICgxMDAwMDAwMDAgKiBJKSArICgxMDAwMDAwMCAqIEgpICsgKDEwMDAwMDAgKiBHKSArICgxMDAwMDAgKiBGKSArICgxMDAwMCAqIEUpICsgKDEwMDAgKiBEKSArICgxMDAgKiAoQyAtIDEpKSk7CiAgICAgICAgCiAgICAgICAgIFdpbm5pbmdOdW1iZXJzRXZlbnQod2lubmluZ3JhbmRvbU51bWJlcjEsIFRlblRpbWVzRXRoZXIpOwogICAgICAgICAKCiAgICAgICAgLy8gUEFZIE9VVCBUSEUgV0lOTkVSIEhFUkUgQUZURVIgTE9HR0lORyBXSU5OSU5HIE5VTUJFUiBJTiBFVkVOVCBQYXlzIDEweCBFdGhlciAtIDAuMDA1CgogICAgICAgICB3aW5uZXIgPSBvd25lck9mKHdpbm5pbmdyYW5kb21OdW1iZXIxKTsKICAgICAgICAgcGF5V2lubmVyKHdpbm5lciwgNTAwMDAwMDAwMDAwMDAwMCk7IAogICAgICAgICAKICAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgVGVuVGltZXNFdGhlcik7CgogICAgICAgIAogICAgIH0gZWxzZSB7CiAgICAgICAgIC8vRG8gc3R1ZmYgaGVyZSB3aXRoIG5vbiB3aW5uaW5nIHRpY2tldCBpZiBuZWVkZWQKICAgICB9CgogaWYgKEEgPT0gMSAmJiBCID09IDAgJiYgQyA9PSAwKSB7CiAgICAgICAgIAogICAgICAgICB3aW5uaW5ncmFuZG9tTnVtYmVyMiA9ICh1aW50KGtlY2NhazI1NihibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpLCBudW1Ub2tlbnNUb3RhbCArIDIpKSUxMDAwICsgKDEwMDAwMDAwMDAgKiBKKSArICgxMDAwMDAwMDAgKiBJKSArICgxMDAwMDAwMCAqIEgpICsgKDEwMDAwMDAgKiBHKSArICgxMDAwMDAgKiBGKSArICgxMDAwMCAqIEUpICsgKDEwMDAgKiAoRCAtIDEpKSk7CiAgICAgICAgICAgICAKICAgICAgICAgV2lubmluZ051bWJlcnNFdmVudCh3aW5uaW5ncmFuZG9tTnVtYmVyMiwgT25lSHVuZHJlZFRpbWVzRXRoZXIpOwoKCiAgICAgICAgLy8gUEFZIE9VVCBUSEUgV0lOTkVSIEhFUkUgQUZURVIgTE9HR0lORyBXSU5OSU5HIE5VTUJFUiBJTiBFVkVOVAogICAgICAgIC8vIFBBWVMgMTAweCBFdGhlcgoKICAgICAgICAgd2lubmVyID0gb3duZXJPZih3aW5uaW5ncmFuZG9tTnVtYmVyMik7CiAgICAgICAgIHBheVdpbm5lcih3aW5uZXIsIDUwMDAwMDAwMDAwMDAwMDAwKTsgCiAgICAgICAgIHBheUJpbGxpb250aXhPd25lcigpOwoKICAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgT25lSHVuZHJlZFRpbWVzRXRoZXIpOwogIAogICAgIAogICAgIH0gZWxzZSB7CiAgICAgICAgIC8vRG8gc3R1ZmYgaGVyZSB3aXRoIG5vbiB3aW5uaW5nIHRpY2tldCBpZiBuZWVkZWQKICAgICB9CiAKIGlmIChBID09IDEgJiYgQiA9PSAwICYmIEMgPT0gMCAmJiBEID09IDApIHsKICAgICAgICAgCiAgICAgICAgICB3aW5uaW5ncmFuZG9tTnVtYmVyMyA9ICh1aW50KGtlY2NhazI1NihibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpLCBudW1Ub2tlbnNUb3RhbCArIDMpKSUxMDAwMCArICgxMDAwMDAwMDAwICogSikgKyAoMTAwMDAwMDAwICogSSkgKyAoMTAwMDAwMDAgKiBIKSArICgxMDAwMDAwICogRykgKyAoMTAwMDAwICogRikgKyAoMTAwMDAgKiAoRSAtIDEpKSk7CiAgICAgICAgICBXaW5uaW5nTnVtYmVyc0V2ZW50KHdpbm5pbmdyYW5kb21OdW1iZXIzLCBPbmVUaG91c2FuZFRpbWVzRXRoZXIpOwoKCiAgICAgIC8vIFBBWSBPVVQgVEhFIFdJTk5FUiBIRVJFIEFGVEVSIExPR0dJTkcgV0lOTklORyBOVU1CRVIgSU4gRVZFTlQKICAgICAgLy8gUEFZUyAxLDAwMHggRXRoZXIgICAKICAgICAgCiAgICAgICAgd2lubmVyID0gb3duZXJPZih3aW5uaW5ncmFuZG9tTnVtYmVyMyk7CiAgICAgICAgcGF5V2lubmVyKHdpbm5lciwgNTAwMDAwMDAwMDAwMDAwMDAwKTsgCiAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgT25lVGhvdXNhbmRUaW1lc0V0aGVyKTsKCgogICAgIH0gZWxzZSB7CiAgICAgICAgIC8vRG8gc3R1ZmYgaGVyZSB3aXRoIG5vbiB3aW5uaW5nIHRpY2tldCBpZiBuZWVkZWQKICAgICB9CgogICAgIGlmIChBID09IDEgJiYgQiA9PSAwICYmIEMgPT0gMCAmJiBEID09IDAgJiYgRSA9PSAwKSB7CiAgICAgICAgIAogICAgICAgICAgd2lubmluZ3JhbmRvbU51bWJlcjQgPSAodWludChrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSwgbnVtVG9rZW5zVG90YWwgKyA0KSklMTAwMDAwICsgKDEwMDAwMDAwMDAgKiBKKSArICgxMDAwMDAwMDAgKiBJKSArICgxMDAwMDAwMCAqIEgpICsgKDEwMDAwMDAgKiBHKSArICgxMDAwMDAgKiAoRiAtIDEpKSk7CiAgICAgICAgICBXaW5uaW5nTnVtYmVyc0V2ZW50KHdpbm5pbmdyYW5kb21OdW1iZXI0LCBUZW5UaG91c2FuZFRpbWVzRXRoZXIpOwoKCiAgICAgIC8vIFBBWSBPVVQgVEhFIFdJTk5FUiBIRVJFIEFGVEVSIExPR0dJTkcgV0lOTklORyBOVU1CRVIgSU4gRVZFTlQKICAgICAgLy8gUEFZUyAxMCwwMDB4IEV0aGVyCiAgICAgICAgIAogICAgICAgICB3aW5uZXIgPSBvd25lck9mKHdpbm5pbmdyYW5kb21OdW1iZXI0KTsKICAgICAgICAgcGF5V2lubmVyKHdpbm5lciwgNTAwMDAwMDAwMDAwMDAwMDAwMCk7IAogICAgICAgICAKICAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgVGVuVGhvdXNhbmRUaW1lc0V0aGVyKTsKCiAgICAgICAgIAogICAgIH0gZWxzZSB7CiAgICAgICAgIC8vRG8gc3R1ZmYgaGVyZSB3aXRoIG5vbiB3aW5uaW5nIHRpY2tldCBpZiBuZWVkZWQKICAgICB9CiAgICAgCiAgaWYgKEEgPT0gMSAmJiBCID09IDAgJiYgQyA9PSAwICYmIEQgPT0gMCAmJiBFID09IDAgJiYgRiA9PSAwKSB7CiAgICAgICAgIAogICAgICAgICAgd2lubmluZ3JhbmRvbU51bWJlcjUgPSAodWludChrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSwgbnVtVG9rZW5zVG90YWwgKyA1KSklMTAwMDAwMCArICgxMDAwMDAwMDAwICogSikgKyAoMTAwMDAwMDAwICogSSkgKyAoMTAwMDAwMDAgKiBIKSArICgxMDAwMDAwICogKEcgLSAxKSkpOwogICAgICAgICAgV2lubmluZ051bWJlcnNFdmVudCh3aW5uaW5ncmFuZG9tTnVtYmVyNSwgT25lSHVuZHJlZFRob3VzYW5kVGltZXNFdGhlcik7CgogICAgICAgIC8vIFBBWSBPVVQgVEhFIFdJTk5FUiBIRVJFIEFGVEVSIExPR0dJTkcgV0lOTklORyBOVU1CRVIgSU4gRVZFTlQKICAgICAgICAvLyBQQVlTIDEwMCwwMDB4IEV0aGVyCgogICAgICAgICB3aW5uZXIgPSBvd25lck9mKHdpbm5pbmdyYW5kb21OdW1iZXI1KTsKICAgICAgICAgcGF5V2lubmVyKHdpbm5lciwgNTAwMDAwMDAwMDAwMDAwMDAwMDApOyAKICAgICAgICAgCiAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgT25lSHVuZHJlZFRob3VzYW5kVGltZXNFdGhlcik7CgogICAgICAgICAKICAgICB9IGVsc2UgewogICAgICAgICAvL0RvIHN0dWZmIGhlcmUgd2l0aCBub24gd2lubmluZyB0aWNrZXQgaWYgbmVlZGVkCiAgICAgfQogIAogICAgIAogfQogCiBmdW5jdGlvbiBwbGF5RHJhdzIoKSBpbnRlcm5hbCByZXR1cm5zICgKIHVpbnQgd2lubmluZ3JhbmRvbU51bWJlcjYsCiB1aW50IHdpbm5pbmdyYW5kb21OdW1iZXI3LAogdWludCB3aW5uaW5ncmFuZG9tTnVtYmVyOCwKIHVpbnQgYmlsbGlvbmRvbGxhcndpbm5pbmdOdW1iZXIpIHsKICAgICAKCiAgICAgdWludCBBID0gKChudW1Ub2tlbnNUb3RhbCAvIDEpICUgMTApOwogICAgIHVpbnQgQiA9ICgobnVtVG9rZW5zVG90YWwgLyAxMCkgJSAxMCk7CiAgICAgdWludCBDID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwMCkgJSAxMCk7CiAgICAgdWludCBEID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwMDApICUgMTApOwogICAgIHVpbnQgRSA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDAwMCkgJSAxMCk7CiAgICAgdWludCBGID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwMDAwMCkgJSAxMCk7CiAgICAgdWludCBHID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwMDAwMDApICUgMTApOwogICAgIHVpbnQgSCA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDAwMDAwMCkgJSAxMCk7CiAgICAgdWludCBJID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwMDAwMDAwMCkgJSAxMCk7CiAgICAgdWludCBKID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwMDAwMDAwMDApICUgMTApOwogICAgIHVpbnQgSyA9ICgobnVtVG9rZW5zVG90YWwgLyAxMDAwMDAwMDAwMCkgJSAxMCk7CgogICAKICAKICBpZiAoQSA9PSAxICYmIEIgPT0gMCAmJiBDID09IDAgJiYgRCA9PSAwICYmIEUgPT0gMCAmJiBGID09IDAgJiYgRyA9PSAwKSB7CiAgICAgICAgIAogICAgICAgICAgd2lubmluZ3JhbmRvbU51bWJlcjYgPSAodWludChrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSwgbnVtVG9rZW5zVG90YWwgKyA2KSklMTAwMDAwMDAgKyAoMTAwMDAwMDAwMCAqIEopICsgKDEwMDAwMDAwMCAqIEkpICsgKDEwMDAwMDAwICogKEggLSAxKSkpOwogICAgICAgICAgV2lubmluZ051bWJlcnNFdmVudCh3aW5uaW5ncmFuZG9tTnVtYmVyNiwgT25lTWlsbGlvblRpbWVzRXRoZXIpOwoKCiAgICAgICAgLy8gUEFZIE9VVCBUSEUgV0lOTkVSIEhFUkUgQUZURVIgTE9HR0lORyBXSU5OSU5HIE5VTUJFUiBJTiBFVkVOVAogICAgICAgIC8vIFBBWVMgMSwwMDAsMDAweCBFdGhlcgoKICAgICAgICAgd2lubmVyID0gb3duZXJPZih3aW5uaW5ncmFuZG9tTnVtYmVyNik7CiAgICAgICAgIHBheVdpbm5lcih3aW5uZXIsIDUwMDAwMDAwMDAwMDAwMDAwMDAwMCk7IAogICAgICAgICAKICAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgT25lTWlsbGlvblRpbWVzRXRoZXIpOwoKCiAgICAgfSBlbHNlIHsKICAgICAgICAgLy9EbyBzdHVmZiBoZXJlIHdpdGggbm9uIHdpbm5pbmcgdGlja2V0IGlmIG5lZWRlZAogICAgIH0KICAgICAKICAgICAgaWYgKEEgPT0gMSAmJiBCID09IDAgJiYgQyA9PSAwICYmIEQgPT0gMCAmJiBFID09IDAgJiYgRiA9PSAwICYmIEcgPT0gMCAmJiBIID09IDApIHsKICAgICAgICAgCiAgICAgICAgIHdpbm5pbmdyYW5kb21OdW1iZXI3ID0gKHVpbnQoa2VjY2FrMjU2KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSksIG51bVRva2Vuc1RvdGFsICsgNykpJTEwMDAwMDAwMCArICgxMDAwMDAwMDAwICogSikgKyAoMTAwMDAwMDAwICogKEkgLSAxKSkpOwogICAgICAgICBXaW5uaW5nTnVtYmVyc0V2ZW50KHdpbm5pbmdyYW5kb21OdW1iZXI3LCBUZW5NaWxsaW9uVGltZXNFdGhlcik7CgoKICAgICAgIC8vIFBBWSBPVVQgVEhFIFdJTk5FUiBIRVJFIEFGVEVSIExPR0dJTkcgV0lOTklORyBOVU1CRVIgSU4gRVZFTlQKICAgICAgIC8vIFBBWVMgMTAsMDAwLDAwMHggRXRoZXIKICAgICAgICAKICAgICAgICAgd2lubmVyID0gb3duZXJPZih3aW5uaW5ncmFuZG9tTnVtYmVyNyk7CiAgICAgICAgIHBheVdpbm5lcih3aW5uZXIsIDUwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgICAKICAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgVGVuTWlsbGlvblRpbWVzRXRoZXIpOwoKCiAgICAgCiAgICAgfSBlbHNlIHsKICAgICAgICAgLy9EbyBzdHVmZiBoZXJlIHdpdGggbm9uIHdpbm5pbmcgdGlja2V0IGlmIG5lZWRlZAogICAgIH0KIAogICAgIGlmIChBID09IDEgJiYgQiA9PSAwICYmIEMgPT0gMCAmJiBEID09IDAgJiYgRSA9PSAwICYmIEYgPT0gMCAmJiBHID09IDAgJiYgSCA9PSAwICYmIEkgPT0gMCkgewogICAgICAgICAKICAgICAgICAgIHdpbm5pbmdyYW5kb21OdW1iZXI4ID0gKHVpbnQoa2VjY2FrMjU2KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSksIG51bVRva2Vuc1RvdGFsICsgOCkpJTEwMDAwMDAwMDAgKyAoMTAwMDAwMDAwMCAqIChKIC0gMSkpKTsKICAgICAgICAgIFdpbm5pbmdOdW1iZXJzRXZlbnQod2lubmluZ3JhbmRvbU51bWJlcjgsIE9uZUh1bmRyZWRNaWxsaW9uVGltZXNFdGhlcik7CgogICAgICAgIC8vIFBBWSBPVVQgVEhFIFdJTk5FUiBIRVJFIEFGVEVSIExPR0dJTkcgV0lOTklORyBOVU1CRVIgSU4gQVJSQVkKICAgICAgICAvLyBQQVlTIDEwMCwwMDAsMDAweCBFdGhlcgogICAgICAgIAogICAgICAgICB3aW5uZXIgPSBvd25lck9mKHdpbm5pbmdyYW5kb21OdW1iZXI4KTsKICAgICAgICAgcGF5V2lubmVyKHdpbm5lciwgNTAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgICAKICAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgT25lSHVuZHJlZE1pbGxpb25UaW1lc0V0aGVyKTsKCiAgICAgICAgCiAgICAgfSBlbHNlIHsKICAgICAgICAgLy9EbyBzdHVmZiBoZXJlIHdpdGggbm9uIHdpbm5pbmcgdGlja2V0IGlmIG5lZWRlZAogICAgIH0KICAgICAKICAgICBpZiAoQSA9PSAxICYmIEIgPT0gMCAmJiBDID09IDAgJiYgRCA9PSAwICYmIEUgPT0gMCAmJiBGID09IDAgJiYgRyA9PSAwICYmIEggPT0gMCAmJiBJID09IDAgJiYgSiA9PSAwICYmIEsgPT0gMSkgewogICAgICAgICAKICAgICAgICAgYmlsbGlvbmRvbGxhcndpbm5pbmdOdW1iZXIgPSAodWludChrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSwgbnVtVG9rZW5zVG90YWwgKyA5KSklMTAwMDAwMDAwMDApOwogICAgICAgICBXaW5uaW5nTnVtYmVyc0V2ZW50KGJpbGxpb25kb2xsYXJ3aW5uaW5nTnVtYmVyLCBPbmVCaWxsaW9uVGltZXNFdGhlcik7CgoKICAgICAgICAvL1BBWSBPVVQgVEhFIFdJTk5FUiBIRVJFIEFGVEVSIExPR0dJTkcgV0lOTklORyBOVU1CRVIgSU4gRVZFTlQKICAgICAgICAvLyBQQVlTIDEsMDAwLDAwMCwwMDB4IEV0aGVyCiAgICAKICAgICAgICAgd2lubmVyID0gb3duZXJPZihiaWxsaW9uZG9sbGFyd2lubmluZ051bWJlcik7CiAgICAgICAgIHBheVdpbm5lcih3aW5uZXIsIDUwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgIAogICAgICAgICBXaW5uZXJQYWlkRXZlbnQod2lubmVyLCBPbmVCaWxsaW9uVGltZXNFdGhlcik7CgoKICAgICB9IGVsc2UgewogICAgICAgICAvL0RvIHN0dWZmIGhlcmUgd2l0aCBub24gd2lubmluZyB0aWNrZXQgaWYgbmVlZGVkCiAgICAgfQoKICAgCiAgICAgCiB9CiAKIGZ1bmN0aW9uIHN1cGVydGl4ZHJhdygpICBpbnRlcm5hbCByZXR1cm5zICh1aW50IHdpbm5pbmdzdXBlcnRpeG51bWJlcikgewoKICAgICB1aW50IEEgPSAoKG51bVRva2Vuc1RvdGFsIC8gMSkgJSAxMCk7CiAgICAgdWludCBCID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwKSAlIDEwKTsKICAgICB1aW50IEMgPSAoKG51bVRva2Vuc1RvdGFsIC8gMTAwKSAlIDEwKTsKICAgICB1aW50IEQgPSAoKG51bVRva2Vuc1RvdGFsIC8gMTAwMCkgJSAxMCk7CiAgICAgdWludCBFID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwMDAwKSAlIDEwKTsKICAgICB1aW50IEYgPSAoKG51bVRva2Vuc1RvdGFsIC8gMTAwMDAwKSAlIDEwKTsKICAgICB1aW50IEcgPSAoKG51bVRva2Vuc1RvdGFsIC8gMTAwMDAwMCkgJSAxMCk7CiAgICAgdWludCBIID0gKChudW1Ub2tlbnNUb3RhbCAvIDEwMDAwMDAwKSAlIDEwKTsKICAgICB1aW50IEkgPSAoKG51bVRva2Vuc1RvdGFsIC8gMTAwMDAwMDAwKSAlIDEwKTsKICAgICB1aW50IEogPSAoKG51bVRva2Vuc1RvdGFsIC8gMTAwMDAwMDAwMCkgJSAxMCk7CiAgICAgCiAgIAogICAgIAogICAgICBpZiAoQSA9PSAxICYmIEIgPT0gMCAmJiBDID09IDAgJiYgRCA9PSAwICYmIEUgPT0gMCAmJiBGID09IDAgJiYgRyA9PSAwICYmIEggPT0gMCAmJiBJID09IDAgJiYgSj09MSkgewogICAgICAgICAgCiAgICAgICAgICAvL0FUIFRJQ0tFVCAxQmlsbGlvbiBhbmQgMSBTb2xkIC0gR2l2ZSBBd2F5IDEwTWlsbGlvbiB0aW1lcyBFdGhlciB0byBTdXBlclRpeCBob2xkZXIKICAgICAgICAgIAogICAgICAgICAgIHVpbnQgcmFuZG9tc3VwZXJ0aXhudW1iZXIgPSAodWludChrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSwgbnVtVG9rZW5zVG90YWwgKyAyKSklMTApOwoKICAgICAgICAgICB3aW5uaW5nc3VwZXJ0aXhudW1iZXIgPSBzdXBlcnRpeGFycmF5W3JhbmRvbXN1cGVydGl4bnVtYmVyXTsKICAgICAgIAogICAgICAgICAgIFdpbm5pbmdOdW1iZXJzRXZlbnQod2lubmluZ3N1cGVydGl4bnVtYmVyLCBUZW5NaWxsaW9uVGltZXNFdGhlcik7CgogICAgICAgICB3aW5uZXIgPSBvd25lck9mKHdpbm5pbmdzdXBlcnRpeG51bWJlcik7CiAgICAgICAgIHBheVdpbm5lcih3aW5uZXIsIDUwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgICAKICAgICAgICAgV2lubmVyUGFpZEV2ZW50KHdpbm5lciwgVGVuTWlsbGlvblRpbWVzRXRoZXIpOwoKICAgICAgICAKICAgICB9IGVsc2UgewogICAgICAgICAvL0RvIHN0dWZmIGhlcmUgd2l0aCBub24gd2lubmluZyB0aWNrZXQgaWYgbmVlZGVkCiAgICAgfQogICAgIAogICAgIAogfQoKIGZ1bmN0aW9uIEJpbGxpb250aXgoKSBwdWJsaWMgewogICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgIH0KICAKIGZ1bmN0aW9uIHRyYW5zZmVyRXRoZXIoYWRkcmVzcyBmb3J3YXJkQWRkcmVzcywgdWludCBhbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewoKICAgICAgICBmb3J3YXJkQWRkcmVzcy50cmFuc2ZlcihhbW91bnQpOwoKfQogCgogIGZ1bmN0aW9uIHBheVdpbm5lcihhZGRyZXNzIHdpbm5lckFkZHJlc3MsIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7CiAgICAgIAogICAgICAgIHdpbm5lckFkZHJlc3MudHJhbnNmZXIoYW1vdW50KTsKCn0KIAogZnVuY3Rpb24gcGF5QmlsbGlvbnRpeE93bmVyICgpIGludGVybmFsIHsKICAgICAKICAgICAvL1RoaXMgaXMgQ2FsbGVkIGF0IEV2ZXJ5IDEwMDAgTGV2ZWwgR2l2ZWF3YXkgdG8gR2l2ZSBCaWxsaW9uVGl4IFRoZWlyIEN1dCBpbiBXZWkKICAgICAKICAgICAgb3duZXIudHJhbnNmZXIoNTAwMDAwMDAwMDAwMDAwMDApOwogICAgIAogfQogCgogICBmdW5jdGlvbiBraWxsKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgIGlmKG1zZy5zZW5kZXIgPT0gb3duZXIpCiAgICAgICAgIHNlbGZkZXN0cnVjdChvd25lcik7CiAgIH0KICAgCiAgICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMge30KICAgICAgCn0='.
	

]
