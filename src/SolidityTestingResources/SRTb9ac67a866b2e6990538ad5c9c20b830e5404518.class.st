Class {
	#name : #SRTb9ac67a866b2e6990538ad5c9c20b830e5404518,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb9ac67a866b2e6990538ad5c9c20b830e5404518 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wgCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuIAogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKiogCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgaW50ZXJuYWwgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4gCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLiAKICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8qKgogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLgogKgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBldmVudCBIYWx0ZWQoYm9vbCBoYWx0ZWQpOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZSghaGFsdGVkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZShoYWx0ZWQpOwogICAgXzsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBoYWx0ZWQgPSB0cnVlOwogICAgSGFsdGVkKHRydWUpOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgICBIYWx0ZWQoZmFsc2UpOwogIH0KCn0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogT3JpZ2luYWxseSBmcm9tICBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogKiBNb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCi8qKgogKiBJbnRlcmZhY2UgZm9yIHRoZSBzdGFuZGFyZCB0b2tlbi4KICogQmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9tYXN0ZXIvRUlQUy9laXAtMjAtdG9rZW4tc3RhbmRhcmQubWQKICovCmNvbnRyYWN0IEVJUDIwVG9rZW4gewoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKCiAgLyoqCiAgKiogT3B0aW9uYWwgZnVuY3Rpb25zCiAgKgogIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgbmFtZSk7CiAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCBkZWNpbWFscyk7CiAgKgogICoqLwoKfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCi8vIEludGVyZmFjZSBmb3IgYnVybmluZyB0b2tlbnMKY29udHJhY3QgQnVybmFibGUgewogIC8vIEBkZXYgRGVzdHJveXMgdG9rZW5zIGZvciBhbiBhY2NvdW50CiAgLy8gQHBhcmFtIGFjY291bnQgQWNjb3VudCB3aG9zZSB0b2tlbnMgYXJlIGRlc3Ryb3llZAogIC8vIEBwYXJhbSB2YWx1ZSBBbW91bnQgb2YgdG9rZW5zIHRvIGRlc3Ryb3kKICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgYWNjb3VudCwgdWludCB2YWx1ZSkgaW50ZXJuYWw7CiAgZXZlbnQgQnVybmVkKGFkZHJlc3MgYWNjb3VudCwgdWludCB2YWx1ZSk7Cn0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQXV0aG9yZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKCi8qKgogKiBJbnRlcm5hbCBpbnRlcmZhY2UgZm9yIHRoZSBtaW50aW5nIG9mIHRva2Vucy4KICovCmNvbnRyYWN0IE1pbnRhYmxlIHsKCiAgLyoqCiAgICogQGRldiBNaW50cyB0b2tlbnMgZm9yIGFuIGFjY291bnQKICAgKiBUaGlzIGZ1bmN0aW9uIHNob3VsZCBlbWl0IHRoZSBNaW50ZWQgZXZlbnQuCiAgICovCiAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBpbnRlcm5hbDsKCiAgLyoqIFRva2VuIHN1cHBseSBnb3QgaW5jcmVhc2VkIGFuZCBhIG5ldyBvd25lciByZWNlaXZlZCB0aGVzZSB0b2tlbnMgKi8KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIHRva2VuCiAqIEBkZXYgQmFzaWMgaW1wbGVtZW50YXRpb24gb2YgdGhlIEVJUDIwIHN0YW5kYXJkIHRva2VuIChhbHNvIGtub3duIGFzIEVSQzIwIHRva2VuKS4KICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRUlQMjBUb2tlbiwgQnVybmFibGUsIE1pbnRhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgdWludCBwcml2YXRlIHRvdGFsX3N1cHBseTsKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHJpdmF0ZSBiYWxhbmNlczsKICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgcHJpdmF0ZSBhbGxvd2VkOwoKCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG90YWxfc3VwcGx5OwogIH0KCiAgLyoqCiAgICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICAqIEBwYXJhbSB0byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgKiBAcGFyYW0gdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1Yih2YWx1ZSk7CiAgICBiYWxhbmNlc1t0b10gPSBiYWxhbmNlc1t0b10uYWRkKHZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICogQHBhcmFtIGFjY291bnQgVGhlIGFkZHJlc3Mgd2hvc2UgYmFsYW5jZSBpcyB0byBiZSBxdWVyaWVkLgogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgYWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbYWNjb3VudF07CiAgfQoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSB2YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgYWxsb3dhbmNlID0gYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKGFsbG93YW5jZSwgdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlKHZhbHVlIDw9IGFsbG93YW5jZSk7CiAgICAvLyBTYWZlTWF0aCB1c2VzIGFzc2VydCBpbnN0ZWFkIG9mIHJlcXVpcmUgdGhvdWdoLCBiZXdhcmUgd2hlbiB1c2luZyBhbiBhbmFseXNpcyB0b29sCgogICAgYmFsYW5jZXNbZnJvbV0gPSBiYWxhbmNlc1tmcm9tXS5zdWIodmFsdWUpOwogICAgYmFsYW5jZXNbdG9dID0gYmFsYW5jZXNbdG9dLmFkZCh2YWx1ZSk7CiAgICBhbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dhbmNlLnN1Yih2YWx1ZSk7CiAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBzcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSB2YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXMnCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShzcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSAodmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID09IDApOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBhY2NvdW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIHNwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgYWNjb3VudCwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbYWNjb3VudF1bc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBBdG9taWMgaW5jcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nCiAgICoKICAgKiBXb3JrcyBhcm91bmQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKgogICAqLwogIGZ1bmN0aW9uIGFkZEFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBhZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdOwogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gb2xkVmFsdWUuYWRkKGFkZGVkVmFsdWUpOwogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdKTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBBdG9taWMgZGVjcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nLgogICAqCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICovCiAgZnVuY3Rpb24gc3ViQXBwcm92YWwoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHN1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgdWludCBvbGRWYWwgPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdOwoKICAgICAgaWYgKHN1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbCkgewogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gb2xkVmFsLnN1YihzdWJ0cmFjdGVkVmFsdWUpOwogICAgICB9CiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0pOwogICAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJvdmlkZXMgYW4gaW50ZXJuYWwgZnVuY3Rpb24gZm9yIGRlc3Ryb3lpbmcgdG9rZW5zLiBVc2VmdWwgZm9yIHVwZ3JhZGVzLgogICAqLwogIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBiYWxhbmNlc1thY2NvdW50XSA9IGJhbGFuY2VzW2FjY291bnRdLnN1Yih2YWx1ZSk7CiAgICB0b3RhbF9zdXBwbHkgPSB0b3RhbF9zdXBwbHkuc3ViKHZhbHVlKTsKICAgIFRyYW5zZmVyKGFjY291bnQsIDAsIHZhbHVlKTsKICAgIEJ1cm5lZChhY2NvdW50LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IFByb3ZpZGVzIGFuIGludGVybmFsIG1pbnRpbmcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7CiAgICB0b3RhbF9zdXBwbHkgPSB0b3RhbF9zdXBwbHkuYWRkKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKGFtb3VudCk7CiAgICBNaW50ZWQocmVjZWl2ZXIsIGFtb3VudCk7CgogICAgLy8gQmV3YXJlOiBBZGRyZXNzIHplcm8gbWF5IGJlIHVzZWQgZm9yIHNwZWNpYWwgdHJhbnNhY3Rpb25zIGluIGEgZnV0dXJlIGZvcmsuCiAgICAvLyBUaGlzIHdpbGwgbWFrZSB0aGUgbWludCB0cmFuc2FjdGlvbiBhcHBlYXIgaW4gRXRoZXJTY2FuLmlvCiAgICAvLyBXZSBjYW4gcmVtb3ZlIHRoaXMgYWZ0ZXIgdGhlcmUgaXMgYSBzdGFuZGFyZGl6ZWQgbWludGluZyBldmVudAogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7CiAgfQogIAp9CgovKioKICogRGVmaW5lIGludGVyZmFjZSBmb3IgcmVsZWFzaW5nIHRoZSB0b2tlbiB0cmFuc2ZlciBhZnRlciBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLgogKi8KY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICAvKiBUaGUgZmluYWxpemVyIGNvbnRyYWN0IHRoYXQgYWxsb3dzIGxpZnRpbmcgdGhlIHRyYW5zZmVyIGxpbWl0cyBvbiB0aGlzIHRva2VuICovCiAgYWRkcmVzcyBwdWJsaWMgcmVsZWFzZUFnZW50OwoKICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOwoKICAvKiogTWFwIG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2VucyByZWdhcmRsZXNzIG9mIHRoZSBsb2NrIGRvd24gcGVyaW9kLiBUaGVzZSBhcmUgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhbmQgcG9zc2libGUgdGhlIHRlYW0gbXVsdGlzaWcgaXRzZWxmLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOwoKICAvKioKICAgKiBTZXQgdGhlIGNvbnRyYWN0IHRoYXQgY2FuIGNhbGwgcmVsZWFzZSBhbmQgbWFrZSB0aGUgdG9rZW4gdHJhbnNmZXJhYmxlLgogICAqCiAgICogU2luY2UgdGhlIG93bmVyIG9mIHRoaXMgY29udHJhY3QgaXMgKG9yIHNob3VsZCBiZSkgdGhlIGNyb3dkc2FsZSwKICAgKiBpdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgYSBjb3JyZXNwb25kaW5nIGV4cG9zZWQgQVBJIGluIHRoZSBjcm93ZHNhbGUgY29udHJhY3QgaW4gY2FzZSBvZiBpbnB1dCBlcnJvci4KICAgKi8KICBmdW5jdGlvbiBzZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICAvLyBXZSBkb24ndCBkbyBpbnRlcmZhY2UgY2hlY2sgaGVyZSBhcyB3ZSBtaWdodCB3YW50IHRvIGhhdmUgYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudC4KICAgIHJlbGVhc2VBZ2VudCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBwYXJ0aWN1bGFyIGFkZHJlc3MgKGUuZy4gYSBjcm93ZHNhbGUgY29udHJhY3QpIHRvIHRyYW5zZmVyIHRva2VucyBkZXNwaXRlIHRoZSBsb2NrIHVwIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgdHJhbnNmZXJBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICB9CgogIC8qKgogICAqIE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIGludG8gdGhlIHdpbGQuCiAgICoKICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IHNob3VsZCB0eXBpY2FsbHkgYmUgdGhlIGZpbmFsaXplIGFnZW50IElDTyBjb250cmFjdC4KICAgKiBJbiB0aGUgc2NvcGUgb2YgdGhlIGNyb3dkc2FsZSwgaXQgaXMgb25seSBjYWxsZWQgaWYgdGhlIGNyb3dkc2FsZSBoYXMgYmVlbiBhIHN1Y2Nlc3MgKGZpcnN0IG1pbGVzdG9uZSByZWFjaGVkKS4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIHJlbGVhc2VkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIExpbWl0IHRva2VuIHRyYW5zZmVyIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIHNlbmRlcikgewogICAgcmVxdWlyZShyZWxlYXNlZCB8fCB0cmFuc2ZlckFnZW50c1tzZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBiZWZvcmUgb3IgYWZ0ZXIgdGhlIHRva2VucyBoYXZlIGJlZW4gcmVsZWFzZWQgKi8KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgewogICAgcmVxdWlyZShyZWxlYXNlU3RhdGUgPT0gcmVsZWFzZWQpOwogICAgXzsKICB9CgogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGEgd2hpdGVsaXN0ZWQgcmVsZWFzZSBhZ2VudC4gKi8KICBtb2RpZmllciBvbmx5UmVsZWFzZUFnZW50KCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHJlbGVhc2VBZ2VudCk7CiAgICBfOwogIH0KCiAgLyoqIFdlIHJlc3RyaWN0IHRyYW5zZmVyIGJ5IG92ZXJyaWRpbmcgaXQgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICB9CgogIC8qKiBXZSByZXN0cmljdCB0cmFuc2ZlckZyb20gYnkgb3ZlcnJpZGluZyBpdCAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2Zlcihmcm9tKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlckZvcm0oKQogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogIH0KCn0KCgoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKLyoqCiAqIEluc3BpcmVkIGJ5IEx1bnlyLgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKi8KCi8qKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKgogKiBUaGUgVXBncmFkZSBhZ2VudCBpcyB0aGUgaW50ZXJmYWNlIHVzZWQgdG8gaW1wbGVtZW50IGEgdG9rZW4KICogbWlncmF0aW9uIGluIHRoZSBjYXNlIG9mIGFuIGVtZXJnZW5jeS4KICogVGhlIGZ1bmN0aW9uIHVwZ3JhZGVGcm9tIGhhcyB0byBpbXBsZW1lbnQgdGhlIHBhcnQgb2YgdGhlIGNyZWF0aW9uCiAqIG9mIG5ldyB0b2tlbnMgb24gYmVoYWxmIG9mIHRoZSB1c2VyIGRvaW5nIHRoZSB1cGdyYWRlLgogKgogKiBUaGUgbmV3IHRva2VuIGNhbiBpbXBsZW1lbnQgdGhpcyBpbnRlcmZhY2UgZGlyZWN0bHksIG9yIHVzZS4KICovCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCB7CgogIC8qKiBUaGlzIHZhbHVlIHNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgb3JpZ2luYWwgdG9rZW4ncyB0b3RhbCBzdXBwbHkgKi8KICB1aW50IHB1YmxpYyBvcmlnaW5hbFN1cHBseTsKCiAgLyoqIEludGVyZmFjZSB0byBlbnN1cmUgdGhlIGNvbnRyYWN0IGlzIGNvcnJlY3RseSBjb25maWd1cmVkICovCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogIFVwZ3JhZGUgYW4gYWNjb3VudAoKICBXaGVuIHRoZSB0b2tlbiBjb250cmFjdCBpcyBpbiB0aGUgdXBncmFkZSBzdGF0dXMgdGhlIGVhY2ggdXNlciB3aWxsCiAgaGF2ZSB0byBjYWxsIGB1cGdyYWRlKHZhbHVlKWAgZnVuY3Rpb24gZnJvbSBVcGdyYWRlYWJsZVRva2VuLgoKICBUaGUgdXBncmFkZSBmdW5jdGlvbiBhZGp1c3QgdGhlIGJhbGFuY2Ugb2YgdGhlIHVzZXIgYW5kIHRoZSBzdXBwbHkKICBvZiB0aGUgcHJldmlvdXMgdG9rZW4gYW5kIHRoZW4gY2FsbCBgdXBncmFkZUZyb20odmFsdWUpYC4KCiAgVGhlIFVwZ3JhZGVBZ2VudCBpcyB0aGUgcmVzcG9uc2libGUgdG8gY3JlYXRlIHRoZSB0b2tlbnMgZm9yIHRoZSB1c2VyCiAgaW4gdGhlIG5ldyBjb250cmFjdC4KCiAgKiBAcGFyYW0gZnJvbSBBY2NvdW50IHRvIHVwZ3JhZGUuCiAgKiBAcGFyYW0gdmFsdWUgVG9rZW5zIHRvIHVwZ3JhZGUuCgogICovCiAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBmcm9tLCB1aW50IHZhbHVlKSBwdWJsaWM7Cgp9CgoKLyoqCiAqIEEgdG9rZW4gdXBncmFkZSBtZWNoYW5pc20gd2hlcmUgdXNlcnMgY2FuIG9wdC1pbiBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBuZXh0IHNtYXJ0IGNvbnRyYWN0IHJldmlzaW9uLgogKgogKi8KY29udHJhY3QgVXBncmFkZWFibGVUb2tlbiBpcyBFSVAyMFRva2VuLCBCdXJuYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qKiBDb250cmFjdCAvIHBlcnNvbiB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiBUaGlzIGNhbiBiZSB0aGUgc2FtZSBhcyB0ZWFtIG11bHRpc2lnIHdhbGxldCwgYXMgd2hhdCBpdCBpcyB3aXRoIGl0cyBkZWZhdWx0IHZhbHVlLiAqLwogIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXI7CgogIC8qKiBUaGUgbmV4dCBjb250cmFjdCB3aGVyZSB0aGUgdG9rZW5zIHdpbGwgYmUgbWlncmF0ZWQuICovCiAgVXBncmFkZUFnZW50IHB1YmxpYyB1cGdyYWRlQWdlbnQ7CgogIC8qKiBIb3cgbWFueSB0b2tlbnMgd2UgaGF2ZSB1cGdyYWRlZCBieSBub3cuICovCiAgdWludCBwdWJsaWMgdG90YWxVcGdyYWRlZCA9IDA7CgogIC8qKgogICAqIFVwZ3JhZGUgc3RhdGVzLgogICAqCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuCiAgICogLSBXYWl0aW5nRm9yQWdlbnQ6IFRva2VuIGFsbG93cyB1cGdyYWRlLCBidXQgd2UgZG9uJ3QgaGF2ZSBhIG5ldyBhZ2VudCB5ZXQKICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldC4gVGhpcyBhbGxvd3MgY2hhbmdpbmcgdGhlIHVwZ3JhZGUgYWdlbnQgd2hpbGUgdGhlcmUgaXMgdGltZS4KICAgKiAtIFVwZ3JhZGluZzogVXBncmFkZSBhZ2VudCBpcyBzZXQgYW5kIHRoZSBiYWxhbmNlIGhvbGRlcnMgY2FuIHVwZ3JhZGUgdGhlaXIgdG9rZW5zCiAgICoKICAgKi8KICBlbnVtIFVwZ3JhZGVTdGF0ZSB7VW5rbm93biwgTm90QWxsb3dlZCwgV2FpdGluZ0ZvckFnZW50LCBSZWFkeVRvVXBncmFkZSwgVXBncmFkaW5nfQoKICAvKioKICAgKiBTb21lYm9keSBoYXMgdXBncmFkZWQgc29tZSBvZiBoaXMgdG9rZW5zLgogICAqLwogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwoKICAvKioKICAgKiBOZXcgdXBncmFkZSBhZ2VudCBhdmFpbGFibGUuCiAgICovCiAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOwoKICAvKioKICAgKiBEbyBub3QgYWxsb3cgY29uc3RydWN0aW9uIHdpdGhvdXQgdXBncmFkZSBtYXN0ZXIgc2V0LgogICAqLwogIGZ1bmN0aW9uIFVwZ3JhZGVhYmxlVG9rZW4oYWRkcmVzcyBtYXN0ZXIpIGludGVybmFsIHsKICAgIHNldFVwZ3JhZGVNYXN0ZXIobWFzdGVyKTsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQgdmFsdWUpIHB1YmxpYyB7CiAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgIC8vIEVuc3VyZSBpdCdzIG5vdCBjYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgIHJlcXVpcmUoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLgogICAgcmVxdWlyZSh2YWx1ZSAhPSAwKTsKCiAgICAvLyBVcGdyYWRlIGFnZW50IHJlaXNzdWVzIHRoZSB0b2tlbnMKICAgIHVwZ3JhZGVBZ2VudC51cGdyYWRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAKICAgIC8vIFRha2UgdG9rZW5zIG91dCBmcm9tIGNpcmN1bGF0aW9uCiAgICBidXJuVG9rZW5zKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIHRvdGFsVXBncmFkZWQgPSB0b3RhbFVwZ3JhZGVkLmFkZCh2YWx1ZSk7CgogICAgVXBncmFkZShtc2cuc2VuZGVyLCB1cGdyYWRlQWdlbnQsIHZhbHVlKTsKICB9CgogIC8qKgogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcyB0aGUgdXBncmFkZSBwcm9jZXNzCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIG9ubHlNYXN0ZXIgZXh0ZXJuYWwgewogICAgLy8gQ2hlY2sgd2hldGhlciB0aGUgdG9rZW4gaXMgaW4gYSBzdGF0ZSB0aGF0IHdlIGNvdWxkIHRoaW5rIG9mIHVwZ3JhZGluZwogICAgcmVxdWlyZShjYW5VcGdyYWRlKCkpOwoKICAgIHJlcXVpcmUoYWdlbnQgIT0gMHgwKTsKICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50CiAgICByZXF1aXJlKGdldFVwZ3JhZGVTdGF0ZSgpICE9IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7CgogICAgLy8gQmFkIGludGVyZmFjZQogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSk7CiAgICAvLyBNYWtlIHN1cmUgdGhhdCB0b2tlbiBzdXBwbGllcyBtYXRjaCBpbiBzb3VyY2UgYW5kIHRhcmdldAogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSA9PSB0b3RhbFN1cHBseSgpKTsKCiAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhVcGdyYWRlU3RhdGUpIHsKICAgIGlmICghY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7CiAgICBlbHNlIGlmICh0b3RhbFVwZ3JhZGVkID09IDApIHJldHVybiBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGU7CiAgICBlbHNlIHJldHVybiBVcGdyYWRlU3RhdGUuVXBncmFkaW5nOwogIH0KCiAgLyoqCiAgICogQ2hhbmdlIHRoZSB1cGdyYWRlIG1hc3Rlci4KICAgKgogICAqIFRoaXMgYWxsb3dzIHVzIHRvIHNldCBhIG5ldyBvd25lciBmb3IgdGhlIHVwZ3JhZGUgbWVjaGFuaXNtLgogICAqLwogIGZ1bmN0aW9uIGNoYW5nZVVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBvbmx5TWFzdGVyIHB1YmxpYyB7CiAgICBzZXRVcGdyYWRlTWFzdGVyKG5ld19tYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgdXBncmFkZSBtYXN0ZXIgc2V0dGVyLgogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBwcml2YXRlIHsKICAgIHJlcXVpcmUobmV3X21hc3RlciAhPSAweDApOwogICAgdXBncmFkZU1hc3RlciA9IG5ld19tYXN0ZXI7CiAgfQoKICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gb3ZlcnJpZGUgdG8gcHJvdmlkZSB0aGUgY29uZGl0aW9uIGluIHdoaWNoIHRoZSB1cGdyYWRlIGNhbiBiZWdpbi4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgcmV0dXJuIHRydWU7CiAgfQoKCiAgbW9kaWZpZXIgb25seU1hc3RlcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB1cGdyYWRlTWFzdGVyKTsKICAgIF87CiAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCi8qKgogKiBBdXRob3JlZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgoKLy8gVGhpcyBjb250cmFjdCBhaW1zIHRvIHByb3ZpZGUgYW4gaW5oZXJpdGFibGUgd2F5IHRvIHJlY292ZXIgdG9rZW5zIGZyb20gYSBjb250cmFjdCBub3QgbWVhbnQgdG8gaG9sZCB0b2tlbnMKLy8gVG8gdXNlIHRoaXMgY29udHJhY3QsIGhhdmUgeW91ciB0b2tlbi1pZ25vcmluZyBjb250cmFjdCBpbmhlcml0IHRoaXMgb25lIGFuZCBpbXBsZW1lbnQgZ2V0TG9zdEFuZEZvdW5kTWFzdGVyIHRvIGRlY2lkZSB3aG8gY2FuIG1vdmUgbG9zdCB0b2tlbnMuCi8vIE9mIGNvdXJzZSwgdGhpcyBjb250cmFjdCBpbXBvc2VzIHN1cHBvcnQgY29zdHMgdXBvbiB3aG9ldmVyIGlzIHRoZSBsb3N0IGFuZCBmb3VuZCBtYXN0ZXIuCmNvbnRyYWN0IExvc3RBbmRGb3VuZFRva2VuIHsKICAvKioKICAgKiBAcmV0dXJuIEFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBoYW5kbGVzIG1vdmVtZW50cy4KICAgKi8KICBmdW5jdGlvbiBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwoKICAvKioKICAgKiBAcGFyYW0gYWdlbnQgQWRkcmVzcyB0aGF0IHdpbGwgYmUgYWJsZSB0byBtb3ZlIHRva2VucyB3aXRoIHRyYW5zZmVyRnJvbQogICAqIEBwYXJhbSB0b2tlbnMgQW1vdW50IG9mIHRva2VucyBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgKiBAcGFyYW0gdG9rZW5fY29udHJhY3QgQ29udHJhY3Qgb2YgdGhlIHRva2VuCiAgICovCiAgZnVuY3Rpb24gZW5hYmxlTG9zdEFuZEZvdW5kKGFkZHJlc3MgYWdlbnQsIHVpbnQgdG9rZW5zLCBFSVAyMFRva2VuIHRva2VuX2NvbnRyYWN0KSBwdWJsaWMgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGdldExvc3RBbmRGb3VuZE1hc3RlcigpKTsKICAgIC8vIFdlIHVzZSBhcHByb3ZlIGluc3RlYWQgb2YgdHJhbnNmZXIgdG8gbWluaW1pemUgdGhlIHBvc3NpYmlsaXR5IG9mIHRoZSBsb3N0IGFuZCBmb3VuZCBtYXN0ZXIKICAgIC8vICBnZXR0aW5nIHRoZW0gc3R1Y2sgaW4gYW5vdGhlciBhZGRyZXNzIGJ5IGFjY2lkZW50LgogICAgdG9rZW5fY29udHJhY3QuYXBwcm92ZShhZ2VudCwgdG9rZW5zKTsKICB9Cn0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKCi8qKgogKiBBIHB1YmxpYyBpbnRlcmZhY2UgdG8gaW5jcmVhc2UgdGhlIHN1cHBseSBvZiBhIHRva2VuLgogKgogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uCiAqIE9ubHkgbWludCBhZ2VudHMsIHVzdWFsbHkgY29udHJhY3RzIHdoaXRlbGlzdGVkIGJ5IHRoZSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4KICoKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgTWludGFibGUsIE93bmFibGUgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgZXZlbnQgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpOwoKCiAgZnVuY3Rpb24gTWludGFibGVUb2tlbih1aW50IGluaXRpYWxTdXBwbHksIGFkZHJlc3MgbXVsdGlzaWcsIGJvb2wgbWludGFibGUpIGludGVybmFsIHsKICAgIHJlcXVpcmUobXVsdGlzaWcgIT0gYWRkcmVzcygwKSk7CiAgICAvLyBDYW5ub3QgY3JlYXRlIGEgdG9rZW4gd2l0aG91dCBzdXBwbHkgYW5kIG5vIG1pbnRpbmcKICAgIHJlcXVpcmUobWludGFibGUgfHwgaW5pdGlhbFN1cHBseSAhPSAwKTsKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGlmIChpbml0aWFsU3VwcGx5ID4gMCkKICAgICAgbWludEludGVybmFsKG11bHRpc2lnLCBpbml0aWFsU3VwcGx5KTsKICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbgogICAgbWludGluZ0ZpbmlzaGVkID0gIW1pbnRhYmxlOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgYW5kIGFsbG9jYXRlIHRoZW0gdG8gYW4gYWRkcmVzcy4KICAgKgogICAqIE9ubHkgY2FsbGFibGUgYnkgYSBtaW50IGFnZW50IChlLmcuIGNyb3dkc2FsZSBjb250cmFjdCkuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50SW50ZXJuYWwocmVjZWl2ZXIsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHIsIHN0YXRlKTsKICB9CgogIG1vZGlmaWVyIG9ubHlNaW50QWdlbnQoKSB7CiAgICAvLyBPbmx5IG1pbnQgYWdlbnRzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgcmVxdWlyZShtaW50QWdlbnRzW21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KfQoKLyoqCiAqIEEgY3Jvd2RzYWxlIHRva2VuLgogKgogKiBBbiBFUkMtMjAgdG9rZW4gZGVzaWduZWQgc3BlY2lmaWNhbGx5IGZvciBjcm93ZHNhbGVzIHdpdGggaW52ZXN0b3IgcHJvdGVjdGlvbiBhbmQgZnVydGhlciBkZXZlbG9wbWVudCBwYXRoLgogKgogKiAtIFRoZSB0b2tlbiB0cmFuc2ZlcigpIGlzIGRpc2FibGVkIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3ZlcgogKiAtIFRoZSB0b2tlbiBjb250cmFjdCBnaXZlcyBhbiBvcHQtaW4gdXBncmFkZSBwYXRoIHRvIGEgbmV3IGNvbnRyYWN0CiAqIC0gVGhlIHNhbWUgdG9rZW4gY2FuIGJlIHBhcnQgb2Ygc2V2ZXJhbCBjcm93ZHNhbGVzIHRocm91Z2ggdGhlIGFwcHJvdmUoKSBtZWNoYW5pc20KICogLSBUaGUgdG9rZW4gY2FuIGJlIGNhcHBlZCAoc3VwcGx5IHNldCBpbiB0aGUgY29uc3RydWN0b3IpIG9yIHVuY2FwcGVkIChjcm93ZHNhbGUgY29udHJhY3QgY2FuIG1pbnQgbmV3IHRva2VucykKICogLSBFUkMyMCB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhpcyBjb250cmFjdCBjYW4gYmUgcmVjb3ZlcmVkIGJ5IGEgbG9zdCBhbmQgZm91bmQgbWFzdGVyCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGVUb2tlbiBpcyBSZWxlYXNhYmxlVG9rZW4sIE1pbnRhYmxlVG9rZW4sIFVwZ3JhZGVhYmxlVG9rZW4sIExvc3RBbmRGb3VuZFRva2VuIHsKCiAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIlViYW54IjsKCiAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiQkFOWCI7CgogIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgYWRkcmVzcyBwdWJsaWMgbG9zdF9hbmRfZm91bmRfbWFzdGVyOwoKICAvKioKICAgKiBDb25zdHJ1Y3QgdGhlIHRva2VuLgogICAqCiAgICogVGhpcyB0b2tlbiBtdXN0IGJlIGNyZWF0ZWQgdGhyb3VnaCBhIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBzbyB0aGF0IGl0IGlzIG93bmVkIGJ5IHRoYXQgd2FsbGV0LgogICAqCiAgICogQHBhcmFtIGluaXRpYWxfc3VwcGx5IEhvdyBtYW55IHRva2VucyB3ZSBzdGFydCB3aXRoLgogICAqIEBwYXJhbSB0b2tlbl9kZWNpbWFscyBOdW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMuCiAgICogQHBhcmFtIHRlYW1fbXVsdGlzaWcgQWRkcmVzcyBvZiB0aGUgbXVsdGlzaWcgdGhhdCByZWNlaXZlcyB0aGUgaW5pdGlhbCBzdXBwbHkgYW5kIGlzIHNldCBhcyB0aGUgdXBncmFkZSBtYXN0ZXIuCiAgICogQHBhcmFtIG1pbnRhYmxlIEFyZSBuZXcgdG9rZW5zIGNyZWF0ZWQgb3ZlciB0aGUgY3Jvd2RzYWxlIG9yIGRvIHdlIGRpc3RyaWJ1dGUgb25seSB0aGUgaW5pdGlhbCBzdXBwbHk/IE5vdGUgdGhhdCB3aGVuIHRoZSB0b2tlbiBiZWNvbWVzIHRyYW5zZmVyYWJsZSB0aGUgbWludGluZyBhbHdheXMgZW5kcy4KICAgKiBAcGFyYW0gdG9rZW5fcmV0cmlldmVyIEFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBoYW5kbGVzIEVSQzIwIHRva2VucyB0aGF0IHdlcmUgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbih1aW50IGluaXRpYWxfc3VwcGx5LCB1aW50OCB0b2tlbl9kZWNpbWFscywgYWRkcmVzcyB0ZWFtX211bHRpc2lnLCBib29sIG1pbnRhYmxlLCBhZGRyZXNzIHRva2VuX3JldHJpZXZlcikgcHVibGljCiAgVXBncmFkZWFibGVUb2tlbih0ZWFtX211bHRpc2lnKSBNaW50YWJsZVRva2VuKGluaXRpYWxfc3VwcGx5LCB0ZWFtX211bHRpc2lnLCBtaW50YWJsZSkgewogICAgcmVxdWlyZSh0b2tlbl9yZXRyaWV2ZXIgIT0gYWRkcmVzcygwKSk7CiAgICBkZWNpbWFscyA9IHRva2VuX2RlY2ltYWxzOwogICAgbG9zdF9hbmRfZm91bmRfbWFzdGVyID0gdG9rZW5fcmV0cmlldmVyOwogIH0KCiAgLyoqCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIHByb2hpYml0IG5ldyB0b2tlbiBjcmVhdGlvbi4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBzdXBlci5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdXBncmFkZSBhZ2VudCBmdW5jdGlvbmFsaXR5IHRvIGtpY2sgaW4gb25seSBpZiB0aGUgY3Jvd2RzYWxlIHdhcyBhIHN1Y2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gY2FuVXBncmFkZSgpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIHJlbGVhc2VkICYmIHN1cGVyLmNhblVwZ3JhZGUoKTsKICB9CgogIGZ1bmN0aW9uIGdldExvc3RBbmRGb3VuZE1hc3RlcigpIGludGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzKSB7CiAgICByZXR1cm4gbG9zdF9hbmRfZm91bmRfbWFzdGVyOwogIH0KCiAgLyoqCiAgICogV2UgYWxsb3cgYW55b25lIHRvIGJ1cm4gdGhlaXIgdG9rZW5zIGlmIHRoZXkgd2lzaCB0byBkbyBzby4KICAgKiBXZSB3YW50IHRvIHVzZSB0aGlzIGluIHRoZSBmaW5hbGl6ZSBmdW5jdGlvbiBvZiB0aGUgY3Jvd2RzYWxlIGluIHBhcnRpY3VsYXIuCiAgICovCiAgZnVuY3Rpb24gYnVybih1aW50IGFtb3VudCkgcHVibGljIHsKICAgIGJ1cm5Ub2tlbnMobXNnLnNlbmRlciwgYW1vdW50KTsKICB9Cgp9CgovKioKICogQWJzdHJhY3QgYmFzZSBjb250cmFjdCBmb3IgdG9rZW4gc2FsZXMuCiAqCiAqIEhhbmRsZXMKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gdmFyaW91cyBzdGF0aXN0aWNzIGR1cmluZyB0aGUgY3Jvd2RmdW5kCiAqIC0gZGlmZmVyZW50IGludmVzdG1lbnQgcG9saWNpZXMgKHJlcXVpcmUgc2VydmVyIHNpZGUgY3VzdG9tZXIgaWQsIGFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgYWRkcmVzc2VzKQogKgogKi8KY29udHJhY3QgR2VuZXJpY0Nyb3dkc2FsZSBpcyBIYWx0YWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8KICBDcm93ZHNhbGVUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8qIGV0aGVyIHdpbGwgYmUgdHJhbnNmZXJyZWQgdG8gdGhpcyBhZGRyZXNzICovCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7CgogIC8qIGEgY29udHJhY3QgbWF5IGJlIGRlcGxveWVkIHRvIGZ1bmN0aW9uIGFzIGEgZ2F0ZXdheSBmb3IgaW52ZXN0bWVudHMgKi8KICBhZGRyZXNzIHB1YmxpYyBpbnZlc3RtZW50R2F0ZXdheTsKCiAgLyogdGhlIHN0YXJ0aW5nIHRpbWUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwoKICAvKiB0aGUgZW5kaW5nIHRpbWUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKCiAgLyogdGhlIG51bWJlciBvZiB0b2tlbnMgYWxyZWFkeSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCovCiAgdWludCBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CgogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgLyogSG93IG1hbnkgZGlzdGluY3QgYWRkcmVzc2VzIGhhdmUgaW52ZXN0ZWQgKi8KICB1aW50IHB1YmxpYyBpbnZlc3RvckNvdW50ID0gMDsKCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkID0gZmFsc2U7CgogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSBhIHVuaXF1ZSBjb250cmlidXRvciBpZCBmb3IgZWFjaCBjdXN0b21lciAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVDdXN0b21lcklkID0gZmFsc2U7CgogIC8qKgogICAqIERvIHdlIHZlcmlmeSB0aGF0IGNvbnRyaWJ1dG9yIGhhcyBiZWVuIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIChhY2NyZWRpdGVkIGludmVzdG9ycyBvbmx5KS4KICAgKiBUaGlzIG1ldGhvZCB3YXMgZmlyc3QgdXNlZCBpbiB0aGUgRmlyc3RCbG9vZCBjcm93ZHNhbGUgdG8gZW5zdXJlIGFsbCBjb250cmlidXRvcnMgaGFkIGFjY2VwdGVkIHRlcm1zIG9mIHNhbGUgKG9uIHRoZSB3ZWIpLgogICAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzcyA9IGZhbHNlOwoKICAvKiogU2VydmVyIHNpZGUgYWRkcmVzcyB0aGF0IHNpZ25lZCBhbGxvd2VkIGNvbnRyaWJ1dG9ycyAoRXRoZXJldW0gYWRkcmVzc2VzKSB0aGF0IGNhbiBwYXJ0aWNpcGF0ZSB0aGUgY3Jvd2RzYWxlICovCiAgYWRkcmVzcyBwdWJsaWMgc2lnbmVyQWRkcmVzczsKCiAgLyoqIEhvdyBtYW55IEVUSCBlYWNoIGFkZHJlc3MgaGFzIGludmVzdGVkIGluIHRoaXMgY3Jvd2RzYWxlICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsKCiAgLyoqIEhvdyBtYW55IHRva2VucyB0aGlzIGNyb3dkc2FsZSBoYXMgY3JlZGl0ZWQgZm9yIGVhY2ggaW52ZXN0b3IgYWRkcmVzcyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHRva2VuQW1vdW50T2Y7CgogIC8qKiBBZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBpbnZlc3QgZXZlbiBiZWZvcmUgSUNPIG9mZmljaWFsbHkgb3BlbnMuIEZvciB0ZXN0aW5nLCBmb3IgSUNPIHBhcnRuZXJzLCBldGMuICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdDsKCiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKgogICAqIC0gUHJlZnVuZGluZzogV2UgaGF2ZSBub3QgcmVhY2hlZCB0aGUgc3RhcnRpbmcgdGltZSB5ZXQKICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUKICAgKiAtIFN1Y2Nlc3M6IENyb3dkc2FsZSBlbmRlZAogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemUgZnVuY3Rpb24gaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmluYWxpemVkfQoKCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50MTI4IGN1c3RvbWVySWQpOwoKICAvLyBUaGUgcnVsZXMgYWJvdXQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdCB3ZXJlIGNoYW5nZWQKICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDSWQsIGJvb2wgcmVxdWlyZVNpZ25lZEFkZHJlc3MsIGFkZHJlc3Mgc2lnbmVyKTsKCiAgLy8gQWRkcmVzcyBlYXJseSBwYXJ0aWNpcGF0aW9uIHdoaXRlbGlzdCBzdGF0dXMgY2hhbmdlZAogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOwoKICAvLyBDcm93ZHNhbGUncyBmaW5hbGl6ZSBmdW5jdGlvbiBoYXMgYmVlbiBjYWxsZWQKICBldmVudCBGaW5hbGl6ZWQoKTsKCgogIC8qKgogICAqIEJhc2ljIGNvbnN0cnVjdG9yIGZvciB0aGUgY3Jvd2RzYWxlLgogICAqIEBwYXJhbSB0ZWFtX211bHRpc2lnIEFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnbmF0dXJlIHdhbGxldCBvZiB0aGUgdGVhbSB0aGF0IHdpbGwgcmVjZWl2ZSBhbGwgdGhlIGZ1bmRzIGNvbnRyaWJ1dGVkIGluIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHN0YXJ0IEJsb2NrIG51bWJlciB3aGVyZSB0aGUgY3Jvd2RzYWxlIHdpbGwgYmUgb2ZmaWNpYWxseSBzdGFydGVkLiBJdCBzaG91bGQgYmUgZ3JlYXRlciB0aGFuIHRoZSBibG9jayBudW1iZXIgaW4gd2hpY2ggdGhlIGNvbnRyYWN0IGlzIGRlcGxveWVkLgogICAqIEBwYXJhbSBlbmQgQmxvY2sgbnVtYmVyIHdoZXJlIHRoZSBjcm93ZHNhbGUgZmluaXNoZXMuIE5vIHRva2VucyBjYW4gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QgYWZ0ZXIgdGhpcyBibG9jay4KICAgKi8KICBmdW5jdGlvbiBHZW5lcmljQ3Jvd2RzYWxlKGFkZHJlc3MgdGVhbV9tdWx0aXNpZywgdWludCBzdGFydCwgdWludCBlbmQpIGludGVybmFsIHsKICAgIHNldE11bHRpc2lnKHRlYW1fbXVsdGlzaWcpOwoKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICByZXF1aXJlKHN0YXJ0ICE9IDAgJiYgZW5kICE9IDApOwogICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPCBzdGFydCAmJiBzdGFydCA8IGVuZCk7CiAgICBzdGFydHNBdCA9IHN0YXJ0OwogICAgZW5kc0F0ID0gZW5kOwogIH0KCiAgLyoqCiAgICogRGVmYXVsdCBmYWxsYmFjayBiZWhhdmlvdXIgaXMgdG8gY2FsbCBidXkuCiAgICogSWRlYWxseSwgbm8gY29udHJhY3QgY2FsbHMgdGhpcyBjcm93ZHNhbGUgd2l0aG91dCBzdXBwb3J0aW5nIEVSQzIwLgogICAqIEhvd2V2ZXIsIHNvbWUgc29ydCBvZiByZWZ1bmRpbmcgZnVuY3Rpb24gbWF5IGJlIGRlc2lyZWQgdG8gY292ZXIgc3VjaCBzaXR1YXRpb25zLgogICAqLwogIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgewogICAgYnV5KCk7CiAgfQoKICAvKioKICAgKiBNYWtlIGFuIGludmVzdG1lbnQuCiAgICoKICAgKiBUaGUgY3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBjdXN0b21lcklkIChvcHRpb25hbCkgVVVJRCB2NCB0byB0cmFjayB0aGUgc3VjY2Vzc2Z1bCBwYXltZW50cyBvbiB0aGUgc2VydmVyIHNpZGUKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgc3RvcEluRW1lcmdlbmN5IG5vdEZpbmlzaGVkIHByaXZhdGUgewogICAgLy8gRGV0ZXJtaW5lIGlmIGl0J3MgYSBnb29kIHRpbWUgdG8gYWNjZXB0IGludmVzdG1lbnQgZnJvbSB0aGlzIHBhcnRpY2lwYW50CiAgICBpZiAoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5QcmVGdW5kaW5nKSB7CiAgICAgIC8vIEFyZSB3ZSB3aGl0ZWxpc3RlZCBmb3IgZWFybHkgZGVwb3NpdAogICAgICByZXF1aXJlKGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbbXNnLnNlbmRlcl0pOwogICAgfQoKICAgIHVpbnQgd2VpQW1vdW50OwogICAgdWludCB0b2tlbkFtb3VudDsKICAgICh3ZWlBbW91bnQsIHRva2VuQW1vdW50KSA9IGNhbGN1bGF0ZVRva2VuQW1vdW50KG1zZy52YWx1ZSwgcmVjZWl2ZXIpOwogICAgLy8gU2FuaXR5IGNoZWNrIGFnYWluc3QgYmFkIGltcGxlbWVudGF0aW9uLgogICAgYXNzZXJ0KHdlaUFtb3VudCA8PSBtc2cudmFsdWUpOwogICAgCiAgICAvLyBEdXN0IHRyYW5zYWN0aW9uIGlmIG5vIHRva2VucyBjYW4gYmUgZ2l2ZW4KICAgIHJlcXVpcmUodG9rZW5BbW91bnQgIT0gMCk7CgogICAgaWYgKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsKICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgaW52ZXN0b3JDb3VudCsrOwogICAgfQogICAgdXBkYXRlSW52ZXN0b3JGdW5kcyh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCByZWNlaXZlciwgY3VzdG9tZXJJZCk7CgogICAgLy8gUG9ja2V0IHRoZSBtb25leQogICAgbXVsdGlzaWdXYWxsZXQudHJhbnNmZXIod2VpQW1vdW50KTsKCiAgICAvLyBSZXR1cm4gZXhjZXNzIG9mIG1vbmV5CiAgICByZXR1cm5FeGNlZGVudChtc2cudmFsdWUuc3ViKHdlaUFtb3VudCksIG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogUHJlYWxsb2NhdGUgdG9rZW5zIGZvciB0aGUgZWFybHkgaW52ZXN0b3JzLgogICAqCiAgICogUHJlYWxsb2NhdGVkIHRva2VucyBoYXZlIGJlZW4gc29sZCBiZWZvcmUgdGhlIGFjdHVhbCBjcm93ZHNhbGUgb3BlbnMuCiAgICogVGhpcyBmdW5jdGlvbiBtaW50cyB0aGUgdG9rZW5zIGFuZCBtb3ZlcyB0aGUgY3Jvd2RzYWxlIG5lZWRsZS4KICAgKgogICAqIE5vIG1vbmV5IGlzIGV4Y2hhbmdlZCwgYXMgdGhlIGNyb3dkc2FsZSB0ZWFtIGFscmVhZHkgaGF2ZSByZWNlaXZlZCB0aGUgcGF5bWVudC4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBBY2NvdW50IHRoYXQgcmVjZWl2ZXMgdGhlIHRva2Vucy4KICAgKiBAcGFyYW0gZnVsbFRva2VucyB0b2tlbnMgYXMgZnVsbCB0b2tlbnMgLSBkZWNpbWFsIHBsYWNlcyBhcmUgYWRkZWQgaW50ZXJuYWxseS4KICAgKiBAcGFyYW0gd2VpUHJpY2UgUHJpY2Ugb2YgYSBzaW5nbGUgaW5kaXZpc2libGUgdG9rZW4gaW4gd2VpLgogICAqCiAgICovCiAgZnVuY3Rpb24gcHJlYWxsb2NhdGUoYWRkcmVzcyByZWNlaXZlciwgdWludCBmdWxsVG9rZW5zLCB1aW50IHdlaVByaWNlKSBwdWJsaWMgb25seU93bmVyIG5vdEZpbmlzaGVkIHsKICAgIHJlcXVpcmUocmVjZWl2ZXIgIT0gYWRkcmVzcygwKSk7CiAgICB1aW50IHRva2VuQW1vdW50ID0gZnVsbFRva2Vucy5tdWwoMTAqKnVpbnQodG9rZW4uZGVjaW1hbHMoKSkpOwogICAgcmVxdWlyZSh0b2tlbkFtb3VudCAhPSAwKTsKICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UubXVsKHRva2VuQW1vdW50KTsgLy8gVGhpcyBjYW4gYWxzbyBiZSAwLCBpbiB3aGljaCBjYXNlIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQogICAgdXBkYXRlSW52ZXN0b3JGdW5kcyh0b2tlbkFtb3VudCwgd2VpQW1vdW50LCByZWNlaXZlciAsIDApOwogIH0KCiAgLyoqCiAgICogUHJpdmF0ZSBmdW5jdGlvbiB0byB1cGRhdGUgYWNjb3VudGluZyBpbiB0aGUgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIHVwZGF0ZUludmVzdG9yRnVuZHModWludCB0b2tlbkFtb3VudCwgdWludCB3ZWlBbW91bnQsIGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQxMjggY3VzdG9tZXJJZCkgcHJpdmF0ZSB7CiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0uYWRkKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLmFkZCh0b2tlbkFtb3VudCk7CgogICAgLy8gVXBkYXRlIHRvdGFscwogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQuYWRkKHRva2VuQW1vdW50KTsKCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKICAgIC8vIFRlbGwgdXMgdGhhdCB0aGUgaW52ZXN0bWVudCB3YXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseQogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcmVjZWl2ZXIgYW5kIHZlcmlmaWVzIGhlIGlzIGFsbG93ZWQgdG8gaW52ZXN0LgogICAqCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5T25CZWhhbGZXaXRoU2lnbmVkQWRkcmVzcyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB2YWxpZEN1c3RvbWVySWQoY3VzdG9tZXJJZCkgewogICAgYnl0ZXMzMiBoYXNoID0gc2hhMjU2KHJlY2VpdmVyKTsKICAgIHJlcXVpcmUoZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpID09IHNpZ25lckFkZHJlc3MpOwogICAgaW52ZXN0SW50ZXJuYWwocmVjZWl2ZXIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcmVjZWl2ZXIuCiAgICogCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5T25CZWhhbGZXaXRoQ3VzdG9tZXJJZChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHZhbGlkQ3VzdG9tZXJJZChjdXN0b21lcklkKSB1bnNpZ25lZEJ1eUFsbG93ZWQgewogICAgaW52ZXN0SW50ZXJuYWwocmVjZWl2ZXIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogQnV5cyB0b2tlbnMgb24gYmVoYWxmIG9mIGFuIGFkZHJlc3MuCiAgICoKICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgcmVjZWl2ZXIgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBidXlPbkJlaGFsZihhZGRyZXNzIHJlY2VpdmVyKSBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKCFyZXF1aXJlZFNpZ25lZEFkZHJlc3MgfHwgbXNnLnNlbmRlciA9PSBpbnZlc3RtZW50R2F0ZXdheSk7CiAgICByZXF1aXJlKCFyZXF1aXJlQ3VzdG9tZXJJZCk7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aWNpcGFudHMgZm9yIHRoYW5rIHlvdSBlbWFpbAogICAgaW52ZXN0SW50ZXJuYWwocmVjZWl2ZXIsIDApOwogIH0KCiAgZnVuY3Rpb24gc2V0SW52ZXN0bWVudEdhdGV3YXkoYWRkcmVzcyBnYXRld2F5KSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoZ2F0ZXdheSAhPSBhZGRyZXNzKDApKTsKICAgIGludmVzdG1lbnRHYXRld2F5ID0gZ2F0ZXdheTsKICB9CgogIC8qKgogICAqIEludmVzdGluZyBmdW5jdGlvbiB0aGF0IHJlY29nbml6ZXMgdGhlIHBheWVyIGFuZCB2ZXJpZmllcyBoZSBpcyBhbGxvd2VkIHRvIGludmVzdC4KICAgKgogICAqIEBwYXJhbSBjdXN0b21lcklkIFVVSUR2NCB0aGF0IGlkZW50aWZpZXMgdGhpcyBjb250cmlidXRvcgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhTaWduZWRBZGRyZXNzKHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGJ1eU9uQmVoYWxmV2l0aFNpZ25lZEFkZHJlc3MobXNnLnNlbmRlciwgY3VzdG9tZXJJZCwgdiwgciwgcyk7CiAgfQoKCiAgLyoqCiAgICogSW52ZXN0aW5nIGZ1bmN0aW9uIHRoYXQgcmVjb2duaXplcyB0aGUgcGF5ZXIuCiAgICogCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBidXlPbkJlaGFsZldpdGhDdXN0b21lcklkKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2ljIGVudHJ5IHBvaW50IHRvIHBhcnRpY2lwYXRlIGluIHRoZSBjcm93ZHNhbGUgcHJvY2Vzcy4KICAgKgogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSBzZW5kZXIgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBidXlPbkJlaGFsZihtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIEZpbmFsaXplIGEgc3VjY2Nlc2Z1bCBjcm93ZHNhbGUuCiAgICoKICAgKiBUaGUgb3duZXIgY2FuIHRyaWdnZXIgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKiBOb3RlIHRoYXQgYnkgZGVmYXVsdCB0b2tlbnMgYXJlIG5vdCBpbiBhIHJlbGVhc2VkIHN0YXRlLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICBmaW5hbGl6ZWQgPSB0cnVlOwogICAgRmluYWxpemVkKCk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZUN1c3RvbWVySWQgPSB2YWx1ZTsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCiAgLyoqCiAgICogU2V0IHBvbGljeSBpZiBhbGwgaW52ZXN0b3JzIG11c3QgYmUgY2xlYXJlZCBvbiB0aGUgc2VydmVyIHNpZGUgZmlyc3QuCiAgICoKICAgKiBUaGlzIGlzIGUuZy4gZm9yIHRoZSBhY2NyZWRpdGVkIGludmVzdG9yIGNsZWFyaW5nLgogICAqCiAgICovCiAgZnVuY3Rpb24gc2V0UmVxdWlyZVNpZ25lZEFkZHJlc3MoYm9vbCB2YWx1ZSwgYWRkcmVzcyBzaWduZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gdmFsdWU7CiAgICBzaWduZXJBZGRyZXNzID0gc2lnbmVyOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKi8KICBmdW5jdGlvbiBzZXRFYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpIHB1YmxpYyBvbmx5T3duZXIgbm90RmluaXNoZWQgc3RvcEluRW1lcmdlbmN5IHsKICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBzdGF0dXM7CiAgICBXaGl0ZWxpc3RlZChhZGRyLCBzdGF0dXMpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgc2V0dGVyIGZvciB0aGUgbXVsdGlzaWcgd2FsbGV0CiAgICovCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKGFkZHIgIT0gMCk7CiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50LgogICAqCiAgICogVGhpcyBmdW5jdGlvbiBoYXMgdGhlIHRpbWVkIHRyYW5zaXRpb24gYnVpbHRpbi4KICAgKiBTbyB0aGVyZSBpcyBubyBjaGFuY2Ugb2YgdGhlIHZhcmlhYmxlIGJlaW5nIHN0YWxlLgogICAqLwogIGZ1bmN0aW9uIGdldFN0YXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyAoU3RhdGUpIHsKICAgIGlmIChmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7CiAgICBlbHNlIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogIH0KCiAgLyoqIEludGVybmFsIGZ1bmN0aW9ucyB0aGF0IGV4aXN0IHRvIHByb3ZpZGUgaW52ZXJzaW9uIG9mIGNvbnRyb2wgc2hvdWxkIHRoZXkgYmUgb3ZlcnJpZGVuICovCgogIC8qKiBJbnRlcmZhY2UgZm9yIHRoZSBjb25jcmV0ZSBpbnN0YW5jZSB0byBpbnRlcmFjdCB3aXRoIHRoZSB0b2tlbiBjb250cmFjdCBpbiBhIGN1c3RvbWl6YWJsZSB3YXkgKi8KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgaW50ZXJuYWw7CgogIC8qKgogICAqICBEZXRlcm1pbmUgaWYgdGhlIGdvYWwgd2FzIGFscmVhZHkgcmVhY2hlZCBpbiB0aGUgY3VycmVudCBjcm93ZHNhbGUKICAgKi8KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgZnVsbCk7CgogIC8qKgogICAqIFJldHVybnMgYW55IGV4Y2VzcyB3ZWkgcmVjZWl2ZWQKICAgKiAKICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBvdmVycmlkZW4gdG8gcHJvdmlkZSBhIGRpZmZlcmVudCByZWZ1bmRpbmcgbWV0aG9kLgogICAqLwogIGZ1bmN0aW9uIHJldHVybkV4Y2VkZW50KHVpbnQgZXhjZWRlbnQsIGFkZHJlc3MgcmVjZWl2ZXIpIGludGVybmFsIHsKICAgIGlmIChleGNlZGVudCA+IDApIHsKICAgICAgcmVjZWl2ZXIudHJhbnNmZXIoZXhjZWRlbnQpOwogICAgfQogIH0KCiAgLyoqIAogICAqICBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgcmVjZWl2ZWQgYW1vdW50LgogICAqICBUaGUgd2VpIGFtb3VudCBpcyByZXR1cm5lZCB0b28gaW4gY2FzZSBub3QgYWxsIG9mIGl0IGNhbiBiZSBpbnZlc3RlZC4KICAgKgogICAqICBOb3RlOiBXaGVuIHRoZXJlJ3MgYW4gZXhjZWRlbnQgZHVlIHRvIHJvdW5kaW5nIGVycm9yLCBpdCBzaG91bGQgYmUgcmV0dXJuZWQgdG8gYWxsb3cgcmVmdW5kaW5nLgogICAqICBUaGlzIGlzIHdvcmtlZCBhcm91bmQgaW4gdGhlIGN1cnJlbnQgZGVzaWduIHVzaW5nIGFuIGFwcHJvcHJpYXRlIGFtb3VudCBvZiBkZWNpbWFscyBpbiB0aGUgRnJhY3Rpb25hbEVSQzIwIHN0YW5kYXJkLgogICAqICBUaGUgd29ya2Fyb3VuZCBpcyBnb29kIGVub3VnaCBmb3IgbW9zdCB1c2UgY2FzZXMsIGhlbmNlIHRoZSBzaW1wbGlmaWVkIGZ1bmN0aW9uIHNpZ25hdHVyZS4KICAgKiAgQHJldHVybiB3ZWlBbGxvd2VkIFRoZSBhbW91bnQgb2Ygd2VpIGFjY2VwdGVkIGluIHRoaXMgdHJhbnNhY3Rpb24uCiAgICogIEByZXR1cm4gdG9rZW5BbW91bnQgVGhlIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byB0aGUgcmVjZWl2ZXIgaW4gdGhpcyB0cmFuc2FjdGlvbi4KICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50IHdlaUFtb3VudCwgYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHdlaUFsbG93ZWQsIHVpbnQgdG9rZW5BbW91bnQpOwoKICAvLwogIC8vIE1vZGlmaWVycwogIC8vCgogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIHJlcXVpcmUoZ2V0U3RhdGUoKSA9PSBzdGF0ZSk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdW5zaWduZWRCdXlBbGxvd2VkKCkgewogICAgcmVxdWlyZSghcmVxdWlyZWRTaWduZWRBZGRyZXNzKTsKICAgIF87CiAgfQoKICAvKiogTW9kaWZpZXIgYWxsb3dpbmcgZXhlY3V0aW9uIG9ubHkgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgcnVubmluZy4gICovCiAgbW9kaWZpZXIgbm90RmluaXNoZWQoKSB7CiAgICBTdGF0ZSBjdXJyZW50X3N0YXRlID0gZ2V0U3RhdGUoKTsKICAgIHJlcXVpcmUoY3VycmVudF9zdGF0ZSA9PSBTdGF0ZS5QcmVGdW5kaW5nIHx8IGN1cnJlbnRfc3RhdGUgPT0gU3RhdGUuRnVuZGluZyk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgdmFsaWRDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgewogICAgcmVxdWlyZShjdXN0b21lcklkICE9IDApOyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgXzsKICB9Cgp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKgogKiBIZWF2aWx5IG1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKCi8vLyBAZGV2IFRyYW5jaGUgYmFzZWQgcHJpY2luZy4KLy8vICAgICAgSW1wbGVtZW50aW5nICJmaXJzdCBwcmljZSIgdHJhbmNoZXMsIG1lYW5pbmcsIHRoYXQgaWYgYSBidXllcidzIG9yZGVyIGlzCi8vLyAgICAgIGNvdmVyaW5nIG1vcmUgdGhhbiBvbmUgdHJhbmNoZSwgdGhlIHByaWNlIG9mIHRoZSBsb3dlc3QgdHJhbmNoZSB3aWxsIGFwcGx5Ci8vLyAgICAgIHRvIHRoZSB3aG9sZSBvcmRlci4KY29udHJhY3QgVG9rZW5UcmFuY2hlUHJpY2luZyB7CgogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAvKioKICAgKiBEZWZpbmUgcHJpY2luZyBzY2hlZHVsZSB1c2luZyB0cmFuY2hlcy4KICAgKi8KICBzdHJ1Y3QgVHJhbmNoZSB7CiAgICAgIC8vIEFtb3VudCBpbiB0b2tlbnMgd2hlbiB0aGlzIHRyYW5jaGUgYmVjb21lcyBpbmFjdGl2ZQogICAgICB1aW50IGFtb3VudDsKICAgICAgLy8gVGltZSBpbnRlcnZhbCBbc3RhcnQsIGVuZCkKICAgICAgLy8gU3RhcnRpbmcgdGltZXN0YW1wIChpbmNsdWRlZCBpbiB0aGUgaW50ZXJ2YWwpCiAgICAgIHVpbnQgc3RhcnQ7CiAgICAgIC8vIEVuZGluZyB0aW1lc3RhbXAgKGV4Y2x1ZGVkIGZyb20gdGhlIGludGVydmFsKQogICAgICB1aW50IGVuZDsKICAgICAgLy8gSG93IG1hbnkgdG9rZW5zIHBlciBhc3NldCB1bml0IHlvdSB3aWxsIGdldCB3aGlsZSB0aGlzIHRyYW5jaGUgaXMgYWN0aXZlCiAgICAgIHVpbnQgcHJpY2U7CiAgfQogIC8vIFdlIGRlZmluZSBvZmZzZXRzIGFuZCBzaXplIGZvciB0aGUgZGVzZXJpYWxpemF0aW9uIG9mIG9yZGVyZWQgdHVwbGVzIGluIHJhdyBhcnJheXMKICB1aW50IHByaXZhdGUgY29uc3RhbnQgYW1vdW50X29mZnNldCA9IDA7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHN0YXJ0X29mZnNldCA9IDE7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IGVuZF9vZmZzZXQgPSAyOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBwcmljZV9vZmZzZXQgPSAzOwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCB0cmFuY2hlX3NpemUgPSA0OwoKICBUcmFuY2hlW10gcHVibGljIHRyYW5jaGVzOwoKICBmdW5jdGlvbiBnZXRUcmFuY2hlc0xlbmd0aCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0cmFuY2hlcy5sZW5ndGg7CiAgfQoKICAvLy8gQGRldiBDb25zdHJ1Y3Rpb24sIGNyZWF0aW5nIGEgbGlzdCBvZiB0cmFuY2hlcwogIC8vLyBAcGFyYW0gaW5pdF90cmFuY2hlcyBSYXcgYXJyYXkgb2Ygb3JkZXJlZCB0dXBsZXM6IChlbmQgYW1vdW50LCBzdGFydCB0aW1lc3RhbXAsIGVuZCB0aW1lc3RhbXAsIHByaWNlKQogIGZ1bmN0aW9uIFRva2VuVHJhbmNoZVByaWNpbmcodWludFtdIGluaXRfdHJhbmNoZXMpIHB1YmxpYyB7CiAgICAvLyBOZWVkIHRvIGhhdmUgdHVwbGVzLCBsZW5ndGggY2hlY2sKICAgIHJlcXVpcmUoaW5pdF90cmFuY2hlcy5sZW5ndGggJSB0cmFuY2hlX3NpemUgPT0gMCk7CiAgICAvLyBBIHRyYW5jaGUgd2l0aCBhbW91bnQgemVybyBjYW4gbmV2ZXIgYmUgc2VsZWN0ZWQgYW5kIGlzIHRoZXJlZm9yZSB1c2VsZXNzLgogICAgLy8gVGhpcyBjaGVjayBhbmQgdGhlIG9uZSBpbnNpZGUgdGhlIGxvb3AgZW5zdXJlIG5vIHRyYW5jaGUgY2FuIGhhdmUgYW4gYW1vdW50IGVxdWFsIHRvIHplcm8uCiAgICByZXF1aXJlKGluaXRfdHJhbmNoZXNbYW1vdW50X29mZnNldF0gPiAwKTsKCiAgICB1aW50IGlucHV0X3RyYW5jaGVzX2xlbmd0aCA9IGluaXRfdHJhbmNoZXMubGVuZ3RoLmRpdih0cmFuY2hlX3NpemUpOwogICAgVHJhbmNoZSBtZW1vcnkgbGFzdF90cmFuY2hlOwogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaW5wdXRfdHJhbmNoZXNfbGVuZ3RoOyBpKyspIHsKICAgICAgdWludCB0cmFuY2hlX29mZnNldCA9IGkubXVsKHRyYW5jaGVfc2l6ZSk7CiAgICAgIHVpbnQgYW1vdW50ID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoYW1vdW50X29mZnNldCldOwogICAgICB1aW50IHN0YXJ0ID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoc3RhcnRfb2Zmc2V0KV07CiAgICAgIHVpbnQgZW5kID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQoZW5kX29mZnNldCldOwogICAgICB1aW50IHByaWNlID0gaW5pdF90cmFuY2hlc1t0cmFuY2hlX29mZnNldC5hZGQocHJpY2Vfb2Zmc2V0KV07CiAgICAgIC8vIE5vIGludmFsaWQgc3RlcHMKICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPCBzdGFydCAmJiBzdGFydCA8IGVuZCk7CiAgICAgIC8vIEJhaWwgb3V0IHdoZW4gZW50ZXJpbmcgdW5uZWNlc3NhcnkgdHJhbmNoZXMKICAgICAgLy8gVGhpcyBpcyBwcmVmZXJhYmx5IGNoZWNrZWQgYmVmb3JlIGRlcGxveWluZyBjb250cmFjdCBpbnRvIGFueSBibG9ja2NoYWluLgogICAgICByZXF1aXJlKGkgPT0gMCB8fCAoZW5kID49IGxhc3RfdHJhbmNoZS5lbmQgJiYgYW1vdW50ID4gbGFzdF90cmFuY2hlLmFtb3VudCkgfHwKICAgICAgICAgICAgICAoZW5kID4gbGFzdF90cmFuY2hlLmVuZCAmJiBhbW91bnQgPj0gbGFzdF90cmFuY2hlLmFtb3VudCkpOwoKICAgICAgbGFzdF90cmFuY2hlID0gVHJhbmNoZShhbW91bnQsIHN0YXJ0LCBlbmQsIHByaWNlKTsKICAgICAgdHJhbmNoZXMucHVzaChsYXN0X3RyYW5jaGUpOwogICAgfQogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHRyYW5jaGUgb3IgYmFpbCBvdXQgaWYgdGhlcmUgaXMgbm8gdHJhbmNoZSBkZWZpbmVkIGZvciB0aGUgY3VycmVudCBibG9jay4KICAvLy8gQHBhcmFtIHRva2Vuc1NvbGQgdG90YWwgYW1vdW50IG9mIHRva2VucyBzb2xkLCBmb3IgY2FsY3VsYXRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQogIC8vLyBAcmV0dXJuIFJldHVybnMgdGhlIHN0cnVjdCByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgdHJhbmNoZQogIGZ1bmN0aW9uIGdldEN1cnJlbnRUcmFuY2hlKHVpbnQgdG9rZW5zU29sZCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKFRyYW5jaGUgc3RvcmFnZSkgewogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgdHJhbmNoZXMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHRyYW5jaGVzW2ldLnN0YXJ0IDw9IGJsb2NrLnRpbWVzdGFtcCAmJiBibG9jay50aW1lc3RhbXAgPCB0cmFuY2hlc1tpXS5lbmQgJiYgdG9rZW5zU29sZCA8IHRyYW5jaGVzW2ldLmFtb3VudCkgewogICAgICAgIHJldHVybiB0cmFuY2hlc1tpXTsKICAgICAgfQogICAgfQogICAgLy8gTm8gdHJhbmNoZSBpcyBjdXJyZW50bHkgYWN0aXZlCiAgICByZXZlcnQoKTsKICB9CgogIC8vLyBAZGV2IEdldCB0aGUgY3VycmVudCBwcmljZS4gTWF5IHJldmVydCBpZiB0aGVyZSBpcyBubyB0cmFuY2hlIGN1cnJlbnRseSBhY3RpdmUuCiAgLy8vIEBwYXJhbSB0b2tlbnNTb2xkIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgc29sZCwgZm9yIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUKICAvLy8gQHJldHVybiBUaGUgY3VycmVudCBwcmljZQogIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50IHRva2Vuc1NvbGQpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgIHJldHVybiBnZXRDdXJyZW50VHJhbmNoZSh0b2tlbnNTb2xkKS5wcmljZTsKICB9Cgp9CnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKLy8gU2ltcGxlIGRlcGxveW1lbnQgaW5mb3JtYXRpb24gc3RvcmUgaW5zaWRlIGNvbnRyYWN0IHN0b3JhZ2UuCmNvbnRyYWN0IERlcGxveW1lbnRJbmZvIHsKICB1aW50IHByaXZhdGUgZGVwbG95ZWRfb247CgogIGZ1bmN0aW9uIERlcGxveW1lbnRJbmZvKCkgcHVibGljIHsKICAgIGRlcGxveWVkX29uID0gYmxvY2subnVtYmVyOwogIH0KCgogIGZ1bmN0aW9uIGdldERlcGxveW1lbnRCbG9jaygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBkZXBsb3llZF9vbjsKICB9Cn0KCgovLyBUaGlzIGNvbnRyYWN0IGhhcyB0aGUgc29sZSBvYmplY3RpdmUgb2YgcHJvdmlkaW5nIGEgc2FuZSBjb25jcmV0ZSBpbnN0YW5jZSBvZiB0aGUgQ3Jvd2RzYWxlIGNvbnRyYWN0Lgpjb250cmFjdCBDcm93ZHNhbGUgaXMgR2VuZXJpY0Nyb3dkc2FsZSwgTG9zdEFuZEZvdW5kVG9rZW4sIFRva2VuVHJhbmNoZVByaWNpbmcsIERlcGxveW1lbnRJbmZvIHsKICAvL2luaXRpYWwgc3VwcGx5IGluIDQwMGssIHNvbGQgdG9rZW5zIGZyb20gaW5pdGlhbCBtaW50aW5nCiAgdWludDggcHJpdmF0ZSBjb25zdGFudCB0b2tlbl9kZWNpbWFscyA9IDE4OwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCB0b2tlbl9pbml0aWFsX3N1cHBseSA9IDQgKiAoMTAgKiogOCkgKiAoMTAgKiogdWludCh0b2tlbl9kZWNpbWFscykpOwogIGJvb2wgcHJpdmF0ZSBjb25zdGFudCB0b2tlbl9taW50YWJsZSA9IHRydWU7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHNlbGxhYmxlX3Rva2VucyA9IDYgKiAoMTAgKiogOCkgKiAoMTAgKiogdWludCh0b2tlbl9kZWNpbWFscykpOwogIAogIC8vU2V0cyBtaW5pbXVtIHZhbHVlIHRoYXQgY2FuIGJlIGJvdWdodAogIHVpbnQgcHVibGljIG1pbmltdW1fYnV5X3ZhbHVlID0gMTggKiAxIGV0aGVyIC8gMTAwMDsKICAvL0V0aCBwcmljZSBtdWx0aXBsaWVkIGJ5IDEwMDA7CiAgdWludCBwdWJsaWMgbWlsaWV1cnNfcGVyX2V0aDsKCgogIC8qKgogICAqIENvbnN0cnVjdG9yIGZvciB0aGUgY3Jvd2RzYWxlLgogICAqIE5vcm1hbGx5LCB0aGUgdG9rZW4gY29udHJhY3QgaXMgY3JlYXRlZCBoZXJlLiBUaGF0IHdheSwgdGhlIG1pbnRpbmcsIHJlbGVhc2UgYW5kIHRyYW5zZmVyIGFnZW50cyBjYW4gYmUgc2V0IGhlcmUgdG9vLgogICAqCiAgICogQHBhcmFtIGV0aF9wcmljZV9pbl9ldXJzIEV0aGVyIHByaWNlIGluIEVVUi4KICAgKiBAcGFyYW0gdGVhbV9tdWx0aXNpZyBBZGRyZXNzIG9mIHRoZSBtdWx0aXNpZ25hdHVyZSB3YWxsZXQgb2YgdGhlIHRlYW0gdGhhdCB3aWxsIHJlY2VpdmUgYWxsIHRoZSBmdW5kcyBjb250cmlidXRlZCBpbiB0aGUgY3Jvd2RzYWxlLgogICAqIEBwYXJhbSBzdGFydCBCbG9jayBudW1iZXIgd2hlcmUgdGhlIGNyb3dkc2FsZSB3aWxsIGJlIG9mZmljaWFsbHkgc3RhcnRlZC4gSXQgc2hvdWxkIGJlIGdyZWF0ZXIgdGhhbiB0aGUgYmxvY2sgbnVtYmVyIGluIHdoaWNoIHRoZSBjb250cmFjdCBpcyBkZXBsb3llZC4KICAgKiBAcGFyYW0gZW5kIEJsb2NrIG51bWJlciB3aGVyZSB0aGUgY3Jvd2RzYWxlIGZpbmlzaGVzLiBObyB0b2tlbnMgY2FuIGJlIHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0IGFmdGVyIHRoaXMgYmxvY2suCiAgICogQHBhcmFtIHRva2VuX3JldHJpZXZlciBBZGRyZXNzIHRoYXQgd2lsbCBoYW5kbGUgdG9rZW5zIGFjY2lkZW50YWxseSBzZW50IHRvIHRoZSB0b2tlbiBjb250cmFjdC4gU2VlIHRoZSBMb3N0QW5kRm91bmRUb2tlbiBhbmQgQ3Jvd2RzYWxlVG9rZW4gY29udHJhY3RzIGZvciBmdXJ0aGVyIGRldGFpbHMuCiAgICogQHBhcmFtIGluaXRfdHJhbmNoZXMgTGlzdCBvZiBzZXJpYWxpemVkIHRyYW5jaGVzLiBTZWUgY29uZmlnLmpzIGFuZCBUb2tlblRyYW5jaGVQcmljaW5nIGZvciBmdXJ0aGVyIGRldGFpbHMuCiAgICovCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQgZXRoX3ByaWNlX2luX2V1cnMsIGFkZHJlc3MgdGVhbV9tdWx0aXNpZywgdWludCBzdGFydCwgdWludCBlbmQsIGFkZHJlc3MgdG9rZW5fcmV0cmlldmVyLCB1aW50W10gaW5pdF90cmFuY2hlcykKICBHZW5lcmljQ3Jvd2RzYWxlKHRlYW1fbXVsdGlzaWcsIHN0YXJ0LCBlbmQpIFRva2VuVHJhbmNoZVByaWNpbmcoaW5pdF90cmFuY2hlcykgcHVibGljIHsKICAgIHJlcXVpcmUoZW5kID09IHRyYW5jaGVzW3RyYW5jaGVzLmxlbmd0aC5zdWIoMSldLmVuZCk7CiAgICAvLyBUZXN0aW5nIHZhbHVlcwogICAgdG9rZW4gPSBuZXcgQ3Jvd2RzYWxlVG9rZW4odG9rZW5faW5pdGlhbF9zdXBwbHksIHRva2VuX2RlY2ltYWxzLCB0ZWFtX211bHRpc2lnLCB0b2tlbl9taW50YWJsZSwgdG9rZW5fcmV0cmlldmVyKTsKICAgIAogICAgLy9TZXQgZXRoIHByaWNlIGluIEVVUiAobXVsdGlwbGllZCBieSBvbmUgdGhvdXNhbmQpCiAgICB1cGRhdGVFdXJzUGVyRXRoKGV0aF9wcmljZV9pbl9ldXJzKTsKCiAgICAvLyBTZXQgcGVybWlzc2lvbnMgdG8gbWludCwgdHJhbnNmZXIgYW5kIHJlbGVhc2UKICAgIHRva2VuLnNldE1pbnRBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIHRva2VuLnNldFRyYW5zZmVyQWdlbnQoYWRkcmVzcyh0aGlzKSwgdHJ1ZSk7CiAgICB0b2tlbi5zZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyh0aGlzKSk7CgogICAgLy8gQWxsb3cgdGhlIG11bHRpc2lnIHRvIHRyYW5zZmVyIHRva2VucwogICAgdG9rZW4uc2V0VHJhbnNmZXJBZ2VudCh0ZWFtX211bHRpc2lnLCB0cnVlKTsKCiAgICAvLyBUb2tlbnMgdG8gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QKICAgIHRva2VuLm1pbnQoYWRkcmVzcyh0aGlzKSwgc2VsbGFibGVfdG9rZW5zKTsKICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gbWludCBhbnltb3JlIGR1cmluZyB0aGUgbGlmZXRpbWUgb2YgdGhlIGNvbnRyYWN0LgogICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIGZhbHNlKTsKICB9CgogIC8vVG9rZW4gYXNzaWduYXRpb24gdGhyb3VnaCB0cmFuc2ZlcgogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBpbnRlcm5hbCB7CiAgICB0b2tlbi50cmFuc2ZlcihyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogIH0KCiAgLy9Ub2tlbiBhbW91bnQgY2FsY3VsYXRpb24KICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50IHdlaUFtb3VudCwgYWRkcmVzcykgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHdlaUFsbG93ZWQsIHVpbnQgdG9rZW5BbW91bnQpIHsKICAgIHVpbnQgdG9rZW5zUGVyRXRoID0gZ2V0Q3VycmVudFByaWNlKHRva2Vuc1NvbGQpLm11bChtaWxpZXVyc19wZXJfZXRoKS5kaXYoMTAwMCk7CiAgICB1aW50IG1heFdlaUFsbG93ZWQgPSBzZWxsYWJsZV90b2tlbnMuc3ViKHRva2Vuc1NvbGQpLm11bCgxIGV0aGVyKS5kaXYodG9rZW5zUGVyRXRoKTsKICAgIHdlaUFsbG93ZWQgPSBtYXhXZWlBbGxvd2VkLm1pbjI1Nih3ZWlBbW91bnQpOwoKICAgIGlmICh3ZWlBbW91bnQgPCBtYXhXZWlBbGxvd2VkKSB7CiAgICAgIC8vRGl2aWRlZCBieSAxMDAwIGJlY2F1c2UgZXRoIGV0aF9wcmljZV9pbl9ldXJzIGlzIG11bHRpcGxpZWQgYnkgMTAwMAogICAgICB0b2tlbkFtb3VudCA9IHRva2Vuc1BlckV0aC5tdWwod2VpQW1vdW50KS5kaXYoMSBldGhlcik7CiAgICB9CiAgICAvLyBXaXRoIHRoaXMgY2FzZSB3ZSBsZXQgdGhlIGNyb3dkc2FsZSBlbmQgZXZlbiB3aGVuIHRoZXJlIGFyZSByb3VuZGluZyBlcnJvcnMgZHVlIHRvIHRoZSB0b2tlbnMgdG8gd2VpIHJhdGlvCiAgICBlbHNlIHsKICAgICAgdG9rZW5BbW91bnQgPSBzZWxsYWJsZV90b2tlbnMuc3ViKHRva2Vuc1NvbGQpOwogICAgfQogIH0KCiAgLy8gSW1wbGVtZW50cyB0aGUgY3JpdGVyaW9uIG9mIHRoZSBmdW5kaW5nIHN0YXRlCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdG9rZW5zU29sZCA+PSBzZWxsYWJsZV90b2tlbnM7CiAgfQoKICAvKioKICAgKiBUaGlzIGZ1bmN0aW9uIGRlY2lkZXMgd2hvIGhhbmRsZXMgbG9zdCB0b2tlbnMuCiAgICogRG8gbm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gaXMgTk9UIG1lYW50IHRvIGJlIHVzZWQgaW4gYSB0b2tlbiByZWZ1bmQgbWVjaGFuaXNtLgogICAqIEl0cyBzb2xlIHB1cnBvc2UgaXMgZGV0ZXJtaW5pbmcgd2hvIGNhbiBtb3ZlIGFyb3VuZCBFUkMyMCB0b2tlbnMgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiBvd25lcjsKICB9CgogIC8qKgogICAqIEBkZXYgU2V0cyBuZXcgbWluaW11bSBidXkgdmFsdWUgZm9yIGEgdHJhbnNhY3Rpb24uIE9ubHkgdGhlIG93bmVyIGNhbiBjYWxsIGl0LgogICAqLwogIGZ1bmN0aW9uIHNldE1pbmltdW1CdXlWYWx1ZSh1aW50IG5ld1ZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgIG1pbmltdW1fYnV5X3ZhbHVlID0gbmV3VmFsdWU7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSBwYXllciBhbmQgdmVyaWZpZXMgdGhhdCBoZSBpcyBhbGxvd2VkIHRvIGludmVzdC4KICAgKgogICAqIE92ZXJ3cml0dGVuIHRvIGFkZCBjb25maWd1cmFibGUgbWluaW11bSB2YWx1ZQogICAqCiAgICogQHBhcmFtIGN1c3RvbWVySWQgVVVJRHY0IHRoYXQgaWRlbnRpZmllcyB0aGlzIGNvbnRyaWJ1dG9yCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgaW52ZXN0bWVudElzQmlnRW5vdWdoKG1zZy5zZW5kZXIpIHZhbGlkQ3VzdG9tZXJJZChjdXN0b21lcklkKSB7CiAgICBzdXBlci5idXlXaXRoU2lnbmVkQWRkcmVzcyhjdXN0b21lcklkLCB2LCByLCBzKTsKICB9CgoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSBwYXllci4KICAgKiAKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIGludmVzdG1lbnRJc0JpZ0Vub3VnaChtc2cuc2VuZGVyKSB2YWxpZEN1c3RvbWVySWQoY3VzdG9tZXJJZCkgdW5zaWduZWRCdXlBbGxvd2VkIHsKICAgIHN1cGVyLmJ1eVdpdGhDdXN0b21lcklkKGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2ljIGVudHJ5IHBvaW50IHRvIHBhcnRpY2lwYXRlIGluIHRoZSBjcm93ZHNhbGUgcHJvY2Vzcy4KICAgKgogICAqIFBheSBmb3IgZnVuZGluZywgZ2V0IGludmVzdGVkIHRva2VucyBiYWNrIGluIHRoZSBzZW5kZXIgYWRkcmVzcy4KICAgKi8KICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSBpbnZlc3RtZW50SXNCaWdFbm91Z2gobXNnLnNlbmRlcikgdW5zaWduZWRCdXlBbGxvd2VkIHsKICAgIHN1cGVyLmJ1eSgpOwogIH0KCiAgLy8gRXh0ZW5kZWQgdG8gdHJhbnNmZXIgaGFsZiBvZiB0aGUgdW51c2VkIGZ1bmRzIHRvIHRoZSB0ZWFtJ3MgbXVsdGlzaWcgYW5kIHJlbGVhc2UgdGhlIHRva2VuCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIHRva2VuLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgICB1aW50IHVuc29sZFRva2VucyA9IHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgIHRva2VuLmJ1cm4odW5zb2xkVG9rZW5zLmRpdigyKSk7CiAgICB0b2tlbi50cmFuc2ZlcihtdWx0aXNpZ1dhbGxldCwgdW5zb2xkVG9rZW5zIC0gdW5zb2xkVG9rZW5zLmRpdigyKSk7CiAgICBzdXBlci5maW5hbGl6ZSgpOwogIH0KCiAgLy9DaGFuZ2UgdGhlIHRoZSBzdGFydGluZyB0aW1lIGluIG9yZGVyIHRvIGVuZCB0aGUgcHJlc2FsZSBwZXJpb2QgZWFybHkgaWYgbmVlZGVkLgogIGZ1bmN0aW9uIHNldFN0YXJ0aW5nVGltZSh1aW50IHN0YXJ0aW5nVGltZSkgcHVibGljIG9ubHlPd25lciBpblN0YXRlKFN0YXRlLlByZUZ1bmRpbmcpIHsKICAgIHJlcXVpcmUoc3RhcnRpbmdUaW1lID4gYmxvY2sudGltZXN0YW1wICYmIHN0YXJ0aW5nVGltZSA8IGVuZHNBdCk7CiAgICBzdGFydHNBdCA9IHN0YXJ0aW5nVGltZTsKICB9CgogIC8vQ2hhbmdlIHRoZSB0aGUgZW5kaW5nIHRpbWUgaW4gb3JkZXIgdG8gYmUgYWJsZSB0byBmaW5hbGl6ZSB0aGUgY3Jvd2RzYWxlIGlmIG5lZWRlZC4KICBmdW5jdGlvbiBzZXRFbmRpbmdUaW1lKHVpbnQgZW5kaW5nVGltZSkgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCB7CiAgICByZXF1aXJlKGVuZGluZ1RpbWUgPiBibG9jay50aW1lc3RhbXAgJiYgZW5kaW5nVGltZSA+IHN0YXJ0c0F0KTsKICAgIGVuZHNBdCA9IGVuZGluZ1RpbWU7CiAgfQoKICAvKioKICAgKiBPdmVycmlkZSB0byByZWplY3QgY2FsbHMgdW5sZXNzIHRoZSBjcm93ZHNhbGUgaXMgZmluYWxpemVkIG9yCiAgICogIHRoZSB0b2tlbiBjb250cmFjdCBpcyBub3QgdGhlIG9uZSBjb3JyZXNwb25kaW5nIHRvIHRoaXMgY3Jvd2RzYWxlCiAgICovCiAgZnVuY3Rpb24gZW5hYmxlTG9zdEFuZEZvdW5kKGFkZHJlc3MgYWdlbnQsIHVpbnQgdG9rZW5zLCBFSVAyMFRva2VuIHRva2VuX2NvbnRyYWN0KSBwdWJsaWMgewogICAgLy8gRWl0aGVyIHRoZSBzdGF0ZSBpcyBmaW5hbGl6ZWQgb3IgdGhlIHRva2VuX2NvbnRyYWN0IGlzIG5vdCB0aGlzIGNyb3dkc2FsZSB0b2tlbgogICAgcmVxdWlyZShhZGRyZXNzKHRva2VuX2NvbnRyYWN0KSAhPSBhZGRyZXNzKHRva2VuKSB8fCBnZXRTdGF0ZSgpID09IFN0YXRlLkZpbmFsaXplZCk7CiAgICBzdXBlci5lbmFibGVMb3N0QW5kRm91bmQoYWdlbnQsIHRva2VucywgdG9rZW5fY29udHJhY3QpOwogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXVyc1BlckV0aCAodWludCBtaWxpZXVyc19hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShtaWxpZXVyc19hbW91bnQgPj0gMTAwKTsKICAgIG1pbGlldXJzX3Blcl9ldGggPSBtaWxpZXVyc19hbW91bnQ7CiAgfQoKCiAgbW9kaWZpZXIgaW52ZXN0bWVudElzQmlnRW5vdWdoKGFkZHJlc3MgYWdlbnQpIHsKICAgIHJlcXVpcmUobXNnLnZhbHVlLmFkZChpbnZlc3RlZEFtb3VudE9mW2FnZW50XSkgPj0gbWluaW11bV9idXlfdmFsdWUpOwogICAgXzsKICB9Cn0='.
	

]
