Class {
	#name : #SRT939da7bce862f79676db57267ebd6856eaead7c1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT939da7bce862f79676db57267ebd6856eaead7c1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCgovKioKICogUGF1c2FibGUgdG9rZW4KICoKICogU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggcGF1c2FibGUgdG9rZW4gY3JlYXRpb24KICoqLwpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9Cn0KCgovKioKICogQHRpdGxlIFJlZnVuZFZhdWx0CiAqIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIGZvciBzdG9yaW5nIGZ1bmRzIHdoaWxlIGEgY3Jvd2RzYWxlCiAqIGlzIGluIHByb2dyZXNzLiBTdXBwb3J0cyByZWZ1bmRpbmcgdGhlIG1vbmV5IGlmIGNyb3dkc2FsZSBmYWlscywKICogYW5kIGZvcndhcmRpbmcgaXQgaWYgY3Jvd2RzYWxlIGlzIHN1Y2Nlc3NmdWwuCiAqLwpjb250cmFjdCBSZWZ1bmRWYXVsdCBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgZW51bSBTdGF0ZSB7IEFjdGl2ZSwgUmVmdW5kaW5nLCBDbG9zZWQgfQoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogIFN0YXRlIHB1YmxpYyBzdGF0ZTsKCiAgZXZlbnQgQ2xvc2VkKCk7CiAgZXZlbnQgUmVmdW5kc0VuYWJsZWQoKTsKICBldmVudCBSZWZ1bmRlZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgd2VpQW1vdW50KTsKCiAgZnVuY3Rpb24gUmVmdW5kVmF1bHQoYWRkcmVzcyBfd2FsbGV0KSB7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICB9CgogIGZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyBpbnZlc3Rvcikgb25seU93bmVyIHBheWFibGUgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl0uYWRkKG1zZy52YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBjbG9zZSgpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgIENsb3NlZCgpOwogICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgUmVmdW5kc0VuYWJsZWQoKTsKICB9CgogIGZ1bmN0aW9uIHJlZnVuZChhZGRyZXNzIGludmVzdG9yKSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CiAgICB1aW50MjU2IGRlcG9zaXRlZFZhbHVlID0gZGVwb3NpdGVkW2ludmVzdG9yXTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSAwOwogICAgaW52ZXN0b3IudHJhbnNmZXIoZGVwb3NpdGVkVmFsdWUpOwogICAgUmVmdW5kZWQoaW52ZXN0b3IsIGRlcG9zaXRlZFZhbHVlKTsKICB9Cn0KCi8vIEB0aXRsZSBUaGUgUGFsbHlDb2luCi8vLyBAYXV0aG9yIE1hbm9qIFBhdGlkYXIKY29udHJhY3QgUGFsbHlDb2luIGlzIFBhdXNhYmxlVG9rZW4gewogICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICdQYWxseUNvaW4nOwoKICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAnUEFMJzsKCiAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgdWludDI1NiBwdWJsaWMgIHRvdGFsU3VwcGx5ID0gMTAwZTI0OyAvLyAxMDBNIHRva2VucyB3aXRoIDE4IGRlY2ltYWxzCgogICBib29sIHB1YmxpYyByZW1haW5pbmdUb2tlbkJ1cm50ID0gZmFsc2U7CgogICAvLyBUaGUgdG9rZW5zIGFscmVhZHkgdXNlZCBmb3IgdGhlIHByZXNhbGUgYnV5ZXJzCiAgIHVpbnQyNTYgcHVibGljIHRva2Vuc0Rpc3RyaWJ1dGVkUHJlc2FsZSA9IDA7CgogICAvLyBUaGUgdG9rZW5zIGFscmVhZHkgdXNlZCBmb3IgdGhlIElDTyBidXllcnMKICAgdWludDI1NiBwdWJsaWMgdG9rZW5zRGlzdHJpYnV0ZWRDcm93ZHNhbGUgPSAwOwoKICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGNyb3dkc2FsZQogICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGU7CgogICAvLyBUaGUgaW5pdGlhbCBzdXBwbHkgdXNlZCBmb3IgcGxhdGZvcm0gYW5kIGRldmVsb3BtZW50IGFzIHNwZWNpZmllZCBpbiB0aGUgd2hpdGVwYXBlcgogICB1aW50MjU2IHB1YmxpYyBpbml0aWFsU3VwcGx5ID0gNDBlMjQ7CgogICAvLyBUaGUgbWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIGZvciB0aGUgcHJlc2FsZSBpbnZlc3RvcnMKICAgdWludDI1NiBwdWJsaWMgbGltaXRQcmVzYWxlID0gMTBlMjQ7CgogICAvLyBUaGUgbWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIHNvbGQgaW4gdGhlIGNyb3dkc2FsZQogICB1aW50MjU2IHB1YmxpYyBsaW1pdENyb3dkc2FsZSA9IDUwZTI0OwoKICAgLy8vIEBub3RpY2UgT25seSBhbGxvd3MgdGhlIGV4ZWN1dGlvbiBvZiB0aGUgZnVuY3Rpb24gaWYgaXQncyBjb21taW5nIGZyb20gY3Jvd2RzYWxlCiAgIG1vZGlmaWVyIG9ubHlDcm93ZHNhbGUoKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjcm93ZHNhbGUpOwogICAgICBfOwogICB9CgogICAvLyBXaGVuIHNvbWVvbmUgcmVmdW5kcyB0b2tlbnMKICAgZXZlbnQgUmVmdW5kZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIHVzZXIsIHVpbnQyNTYgdG9rZW5zKTsKCiAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHVzZWQgdG8gc2V0IHRoZSBwbGF0Zm9ybSAmIGRldmVsb3BtZW50IHRva2Vucy4gVGhpcyBpcwogICAvLy8gVGhlIDIwJSArIDIwJSBvZiB0aGUgMTAwIE0gdG9rZW5zIHVzZWQgZm9yIHBsYXRmb3JtIGFuZCBkZXZlbG9wbWVudCB0ZWFtLgogICAvLy8gVGhlIG93bmVyLCBtc2cuc2VuZGVyLCBpcyBhYmxlIHRvIGRvIGFsbG93YW5jZSBmb3Igb3RoZXIgY29udHJhY3RzLiBSZW1lbWJlcgogICAvLy8gdG8gdXNlIGB0cmFuc2ZlckZyb20oKWAgaWYgeW91J3JlIGFsbG93ZWQKICAgZnVuY3Rpb24gUGFsbHlDb2luKCkgewogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGluaXRpYWxTdXBwbHk7IC8vIDQwTSB0b2tlbnMgd2VpCiAgIH0KCiAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNldCB0aGUgY3Jvd2RzYWxlIHNtYXJ0IGNvbnRyYWN0J3MgYWRkcmVzcyBvbmx5IGJ5IHRoZSBvd25lciBvZiB0aGlzIHRva2VuCiAgIC8vLyBAcGFyYW0gX2Nyb3dkc2FsZSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgdXNlZAogICBmdW5jdGlvbiBzZXRDcm93ZHNhbGVBZGRyZXNzKGFkZHJlc3MgX2Nyb3dkc2FsZSkgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgICByZXF1aXJlKF9jcm93ZHNhbGUgIT0gYWRkcmVzcygwKSk7CgogICAgICBjcm93ZHNhbGUgPSBfY3Jvd2RzYWxlOwogICB9CgogICAvLy8gQG5vdGljZSBEaXN0cmlidXRlcyB0aGUgcHJlc2FsZSB0b2tlbnMuIE9ubHkgdGhlIG93bmVyIGNhbiBkbyB0aGlzCiAgIC8vLyBAcGFyYW0gX2J1eWVyIFRoZSBhZGRyZXNzIG9mIHRoZSBidXllcgogICAvLy8gQHBhcmFtIHRva2VucyBUaGUgYW1vdW50IG9mIHRva2VucyBjb3JyZXNwb25kaW5nIHRvIHRoYXQgYnV5ZXIKICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVByZXNhbGVUb2tlbnMoYWRkcmVzcyBfYnV5ZXIsIHVpbnQgdG9rZW5zKSBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDAgJiYgdG9rZW5zIDw9IGxpbWl0UHJlc2FsZSk7CgogICAgICAvLyBDaGVjayB0aGF0IHRoZSBsaW1pdCBvZiAxME0gcHJlc2FsZSB0b2tlbnMgaGFzbid0IGJlZW4gbWV0IHlldAogICAgICByZXF1aXJlKHRva2Vuc0Rpc3RyaWJ1dGVkUHJlc2FsZSA8IGxpbWl0UHJlc2FsZSk7CiAgICAgIHJlcXVpcmUodG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlLmFkZCh0b2tlbnMpIDwgbGltaXRQcmVzYWxlKTsKCiAgICAgIHRva2Vuc0Rpc3RyaWJ1dGVkUHJlc2FsZSA9IHRva2Vuc0Rpc3RyaWJ1dGVkUHJlc2FsZS5hZGQodG9rZW5zKTsKICAgICAgYmFsYW5jZXNbX2J1eWVyXSA9IGJhbGFuY2VzW19idXllcl0uYWRkKHRva2Vucyk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIERpc3RyaWJ1dGVzIHRoZSBJQ08gdG9rZW5zLiBPbmx5IHRoZSBjcm93ZHNhbGUgYWRkcmVzcyBjYW4gZXhlY3V0ZSB0aGlzCiAgIC8vLyBAcGFyYW0gX2J1eWVyIFRoZSBidXllciBhZGRyZXNzCiAgIC8vLyBAcGFyYW0gdG9rZW5zIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbmQgdG8gdGhhdCBhZGRyZXNzCiAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVJQ09Ub2tlbnMoYWRkcmVzcyBfYnV5ZXIsIHVpbnQgdG9rZW5zKSBleHRlcm5hbCBvbmx5Q3Jvd2RzYWxlIHdoZW5Ob3RQYXVzZWQgewogICAgICByZXF1aXJlKF9idXllciAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZSh0b2tlbnMgPiAwKTsKCiAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGxpbWl0IG9mIDUwTSBJQ08gdG9rZW5zIGhhc24ndCBiZWVuIG1ldCB5ZXQKICAgICAgcmVxdWlyZSh0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSA8IGxpbWl0Q3Jvd2RzYWxlKTsKICAgICAgcmVxdWlyZSh0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZS5hZGQodG9rZW5zKSA8PSBsaW1pdENyb3dkc2FsZSk7CgogICAgICB0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSA9IHRva2Vuc0Rpc3RyaWJ1dGVkQ3Jvd2RzYWxlLmFkZCh0b2tlbnMpOwogICAgICBiYWxhbmNlc1tfYnV5ZXJdID0gYmFsYW5jZXNbX2J1eWVyXS5hZGQodG9rZW5zKTsKICAgfQoKICAgLy8vIEBub3RpY2UgRGVsZXRlcyB0aGUgYW1vdW50IG9mIHRva2VucyByZWZ1bmRlZCBmcm9tIHRoYXQgYnV5ZXIgYmFsYW5jZQogICAvLy8gQHBhcmFtIF9idXllciBUaGUgYnV5ZXIgdGhhdCB3YW50cyB0aGUgcmVmdW5kCiAgIC8vLyBAcGFyYW0gdG9rZW5zIFRoZSB0b2tlbnMgdG8gcmV0dXJuCiAgIGZ1bmN0aW9uIHJlZnVuZFRva2VucyhhZGRyZXNzIF9idXllciwgdWludDI1NiB0b2tlbnMpIGV4dGVybmFsIG9ubHlDcm93ZHNhbGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDApOwogICAgICByZXF1aXJlKGJhbGFuY2VzW19idXllcl0gPj0gdG9rZW5zKTsKCiAgICAgIGJhbGFuY2VzW19idXllcl0gPSBiYWxhbmNlc1tfYnV5ZXJdLnN1Yih0b2tlbnMpOwogICAgICBSZWZ1bmRlZFRva2VucyhfYnV5ZXIsIHRva2Vucyk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEJ1cm4gdGhlIGFtb3VudCBvZiB0b2tlbnMgcmVtYWluaW5nIGFmdGVyIElDTyBlbmRzCiAgIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoKSBleHRlcm5hbCBvbmx5Q3Jvd2RzYWxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAKICAgICAgdWludDI1NiByZW1haW5pbmdJQ09Ub2tlbiA9IGxpbWl0Q3Jvd2RzYWxlLnN1Yih0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSk7CiAgICAgIGlmKHJlbWFpbmluZ0lDT1Rva2VuID4gMCAmJiAhcmVtYWluaW5nVG9rZW5CdXJudCkgewogICAgICByZW1haW5pbmdUb2tlbkJ1cm50ID0gdHJ1ZTsgICAgCiAgICAgIGxpbWl0Q3Jvd2RzYWxlID0gbGltaXRDcm93ZHNhbGUuc3ViKHJlbWFpbmluZ0lDT1Rva2VuKTsgIAogICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihyZW1haW5pbmdJQ09Ub2tlbik7CiAgICAgIH0KICAgfQp9Ci8vLyAxLiBGaXJzdCB5b3Ugc2V0IHRoZSBhZGRyZXNzIG9mIHRoZSB3YWxsZXQgaW4gdGhlIFJlZnVuZFZhdWx0IGNvbnRyYWN0IHRoYXQgd2lsbCBzdG9yZSB0aGUgZGVwb3NpdCBvZiBldGhlcgovLyAyLiBJZiB0aGUgZ29hbCBpcyByZWFjaGVkLCB0aGUgc3RhdGUgb2YgdGhlIHZhdWx0IHdpbGwgY2hhbmdlIGFuZCB0aGUgZXRoZXIgd2lsbCBiZSBzZW50IHRvIHRoZSBhZGRyZXNzCi8vIDMuIElmIHRoZSBnb2FsIGlzIG5vdCByZWFjaGVkICwgdGhlIHN0YXRlIG9mIHRoZSB2YXVsdCB3aWxsIGNoYW5nZSB0byByZWZ1bmRpbmcgYW5kIHRoZSB1c2VycyB3aWxsIGJlIGFibGUgdG8gY2FsbCBjbGFpbVJlZnVuZCgpIHRvIGdldCB0aGVpciBldGhlcgoKLy8vIEB0aXRsZSBDcm93ZHNhbGUgY29udHJhY3QgdG8gY2Fycnkgb3V0IGFuIElDTyB3aXRoIHRoZSBQYWxseUNvaW4KLy8vIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcywgd2hlcmUgaW52ZXN0b3JzIGNhbiBtYWtlCi8vLyB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKLy8vIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAovLy8gYXMgdGhleSBhcnJpdmUuCi8vLyBAYXV0aG9yIE1hbm9qIFBhdGlkYXIgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIxMDYwNzE2NDc5NzQ3MTYyN2Q3MTdlN2Y3YTUwNzc3ZDcxNzk3YzNlNzM3ZjdkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIFBhdXNhYmxlIHsKICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogICBQYWxseUNvaW4gcHVibGljIHRva2VuOwoKICAgLy8gVGhlIHZhdWx0IHRoYXQgd2lsbCBzdG9yZSB0aGUgZXRoZXIgdW50aWwgdGhlIGdvYWwgaXMgcmVhY2hlZAogICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CgogICAvLyBUaGUgYmxvY2sgbnVtYmVyIG9mIHdoZW4gdGhlIGNyb3dkc2FsZSBzdGFydHMKICAgLy8gMTAvMTUvMjAxNyBAIDExOjAwYW0gKFVUQykKICAgLy8gMTAvMTUvMjAxNyBAIDEyOjAwcG0gKEdNVCArIDEpCiAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZSA9IDE1MTEwNjg4Mjk7CgogICAvLyBUaGUgYmxvY2sgbnVtYmVyIG9mIHdoZW4gdGhlIGNyb3dkc2FsZSBlbmRzCiAgIC8vIDExLzEzLzIwMTcgQCAxMTowMGFtIChVVEMpCiAgIC8vIDExLzEzLzIwMTcgQCAxMjowMHBtIChHTVQgKyAxKQogICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lID0gMTUxMjAyMTAyOTsKCiAgIC8vIFRoZSB3YWxsZXQgdGhhdCBob2xkcyB0aGUgV2VpIHJhaXNlZCBvbiB0aGUgY3Jvd2RzYWxlCiAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgIC8vIFRoZSB3YWxsZXQgdGhhdCBob2xkcyB0aGUgV2VpIHJhaXNlZCBvbiB0aGUgY3Jvd2RzYWxlIGFmdGVyIHNvZnQgY2FwIHJlYWNoZWQKICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0QjsKCiAgIC8vIFRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIuIE9ubHkgYXBwbGllZCBmb3IgdGhlIGZpcnN0IHRpZXIsIHRoZSBmaXJzdAogICAvLyAxMi41IG1pbGxpb24gdG9rZW5zIHNvbGQKICAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgIC8vIFRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIuIE9ubHkgYXBwbGllZCBmb3IgdGhlIHNlY29uZCB0aWVyLCBhdCBiZXR3ZWVuCiAgIC8vIDEyLjUgbWlsbGlvbiB0b2tlbnMgc29sZCBhbmQgMjUgbWlsbGlvbiB0b2tlbnMgc29sZAogICB1aW50MjU2IHB1YmxpYyByYXRlVGllcjI7CgogICAvLyBUaGUgcmF0ZSBvZiB0b2tlbnMgcGVyIGV0aGVyLiBPbmx5IGFwcGxpZWQgZm9yIHRoZSB0aGlyZCB0aWVyLCBhdCBiZXR3ZWVuCiAgIC8vIDI1IG1pbGxpb24gdG9rZW5zIHNvbGQgYW5kIDM3LjUgbWlsbGlvbiB0b2tlbnMgc29sZAogICB1aW50MjU2IHB1YmxpYyByYXRlVGllcjM7CgogICAvLyBUaGUgcmF0ZSBvZiB0b2tlbnMgcGVyIGV0aGVyLiBPbmx5IGFwcGxpZWQgZm9yIHRoZSBmb3VydGggdGllciwgYXQgYmV0d2VlbgogICAvLyAzNy41IG1pbGxpb24gdG9rZW5zIHNvbGQgYW5kIDUwIG1pbGxpb24gdG9rZW5zIHNvbGQKICAgdWludDI1NiBwdWJsaWMgcmF0ZVRpZXI0OwoKICAgLy8gVGhlIG1heGltdW0gYW1vdW50IG9mIHdlaSBmb3IgZWFjaCB0aWVyCiAgIHVpbnQyNTYgcHVibGljIGxpbWl0VGllcjEgPSAxMi41ZTI0OwogICB1aW50MjU2IHB1YmxpYyBsaW1pdFRpZXIyID0gMjVlMjQ7CiAgIHVpbnQyNTYgcHVibGljIGxpbWl0VGllcjMgPSAzNy41ZTI0OwoKICAgLy8gVGhlIGFtb3VudCBvZiB3ZWkgcmFpc2VkCiAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogICAvLyBUaGUgYW1vdW50IG9mIHRva2VucyByYWlzZWQKICAgdWludDI1NiBwdWJsaWMgdG9rZW5zUmFpc2VkID0gMDsKCiAgIC8vIFlvdSBjYW4gb25seSBidXkgdXAgdG8gNTAgTSB0b2tlbnMgZHVyaW5nIHRoZSBJQ08KICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbWF4VG9rZW5zUmFpc2VkID0gNTBlMjQ7CgogICAvLyBUaGUgbWluaW11bSBhbW91bnQgb2YgV2VpIHlvdSBtdXN0IHBheSB0byBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlCiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pblB1cmNoYXNlID0gMTAgZmlubmV5OyAvLyAwLjAxIGV0aGVyCgogICAvLyBUaGUgbWF4IGFtb3VudCBvZiBXZWkgdGhhdCB5b3UgY2FuIHBheSB0byBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlCiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1heFB1cmNoYXNlID0gMjAwMCBldGhlcjsKCiAgIC8vIE1pbmltdW0gYW1vdW50IG9mIHRva2VucyB0byBiZSByYWlzZWQuIDcuNSBtaWxsaW9uIHRva2VucyB3aGljaCBpcyB0aGUgMTUlCiAgIC8vIG9mIHRoZSB0b3RhbCBvZiA1MCBtaWxsaW9uIHRva2VucyBzb2xkIGluIHRoZSBjcm93ZHNhbGUKICAgLy8gNy41ZTYgKyAxZTE4CiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pbmltdW1Hb2FsID0gNS4zM2UyNDsKCiAgIC8vIElmIHRoZSBjcm93ZHNhbGUgd2Fzbid0IHN1Y2Nlc3NmdWwsIHRoaXMgd2lsbCBiZSB0cnVlIGFuZCB1c2VycyB3aWxsIGJlIGFibGUKICAgLy8gdG8gY2xhaW0gdGhlIHJlZnVuZCBvZiB0aGVpciBldGhlcgogICBib29sIHB1YmxpYyBpc1JlZnVuZGluZyA9IGZhbHNlOwoKICAgLy8gSWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQgb3Igbm90CiAgIGJvb2wgcHVibGljIGlzRW5kZWQgPSBmYWxzZTsKCiAgIC8vIFRoZSBudW1iZXIgb2YgdHJhbnNhY3Rpb25zCiAgIHVpbnQyNTYgcHVibGljIG51bWJlck9mVHJhbnNhY3Rpb25zOwoKICAgLy8gVGhlIGdhcyBwcmljZSB0byBidXkgdG9rZW5zIG11c3QgYmUgNTAgZ3dlaSBvciBiZWxvdwogICB1aW50MjU2IHB1YmxpYyBsaW1pdEdhc1ByaWNlID0gNTAwMDAwMDAwMDAgd2VpOwoKICAgLy8gSG93IG11Y2ggZWFjaCB1c2VyIHBhaWQgZm9yIHRoZSBjcm93ZHNhbGUKICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjcm93ZHNhbGVCYWxhbmNlczsKCiAgIC8vIEhvdyBtYW55IHRva2VucyBlYWNoIHVzZXIgZ290IGZvciB0aGUgY3Jvd2RzYWxlCiAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5zQm91Z2h0OwoKICAgLy8gVG8gaW5kaWNhdGUgd2hvIHB1cmNoYXNlZCB3aGF0IGFtb3VudCBvZiB0b2tlbnMgYW5kIHdobyByZWNlaXZlZCB3aGF0IGFtb3VudCBvZiB3ZWkKICAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50T2ZUb2tlbnMpOwoKICAgLy8gSW5kaWNhdGVzIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkCiAgIGV2ZW50IEZpbmFsaXplZCgpOwoKICAgLy8gT25seSBhbGxvdyB0aGUgZXhlY3V0aW9uIG9mIHRoZSBmdW5jdGlvbiBiZWZvcmUgdGhlIGNyb3dkc2FsZSBzdGFydHMKICAgbW9kaWZpZXIgYmVmb3JlU3RhcnRpbmcoKSB7CiAgICAgIHJlcXVpcmUobm93IDwgc3RhcnRUaW1lKTsKICAgICAgXzsKICAgfQoKICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3Igb2YgdGhlIGNyb3dzYWxlIHRvIHNldCB1cCB0aGUgbWFpbiB2YXJpYWJsZXMgYW5kIGNyZWF0ZSBhIHRva2VuCiAgIC8vLyBAcGFyYW0gX3dhbGxldCBUaGUgd2FsbGV0IGFkZHJlc3MgdGhhdCBzdG9yZXMgdGhlIFdlaSByYWlzZWQKICAgLy8vIEBwYXJhbSBfd2FsbGV0QiBUaGUgd2FsbGV0IGFkZHJlc3MgdGhhdCBzdG9yZXMgdGhlIFdlaSByYWlzZWQgYWZ0ZXIgc29mdCBjYXAgcmVhY2hlZAogICAvLy8gQHBhcmFtIF90b2tlbkFkZHJlc3MgVGhlIHRva2VuIHVzZWQgZm9yIHRoZSBJQ08KICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKAogICAgICBhZGRyZXNzIF93YWxsZXQsCiAgICAgIGFkZHJlc3MgX3dhbGxldEIsCiAgICAgIGFkZHJlc3MgX3Rva2VuQWRkcmVzcywKICAgICAgdWludDI1NiBfc3RhcnRUaW1lLAogICAgICB1aW50MjU2IF9lbmRUaW1lCiAgICkgcHVibGljIHsKICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKF90b2tlbkFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUoX3dhbGxldEIgIT0gYWRkcmVzcygwKSk7CgogICAgICAvLyBJZiB5b3Ugc2VuZCB0aGUgc3RhcnQgYW5kIGVuZCB0aW1lIG9uIHRoZSBjb25zdHJ1Y3RvciwgdGhlIGVuZCBtdXN0IGJlIGxhcmdlcgogICAgICBpZihfc3RhcnRUaW1lID4gMCAmJiBfZW5kVGltZSA+IDApCiAgICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA8IF9lbmRUaW1lKTsKCiAgICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICAgIHdhbGxldEIgPSBfd2FsbGV0QjsKICAgICAgdG9rZW4gPSBQYWxseUNvaW4oX3Rva2VuQWRkcmVzcyk7CiAgICAgIHZhdWx0ID0gbmV3IFJlZnVuZFZhdWx0KF93YWxsZXQpOwoKICAgICAgaWYoX3N0YXJ0VGltZSA+IDApCiAgICAgICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CgogICAgICBpZihfZW5kVGltZSA+IDApCiAgICAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgfQoKICAgLy8vIEBub3RpY2UgRmFsbGJhY2sgZnVuY3Rpb24gdG8gYnV5IHRva2VucwogICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgYnV5VG9rZW5zKCk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFRvIGJ1eSB0b2tlbnMgZ2l2ZW4gYW4gYWRkcmVzcwogICBmdW5jdGlvbiBidXlUb2tlbnMoKSBwdWJsaWMgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwoKICAgICAgdWludDI1NiB0b2tlbnMgPSAwOwogICAgICAKICAgICAgdWludDI1NiBhbW91bnRQYWlkID0gY2FsY3VsYXRlRXhjZXNzQmFsYW5jZSgpOwoKICAgICAgaWYodG9rZW5zUmFpc2VkIDwgbGltaXRUaWVyMSkgewoKICAgICAgICAgLy8gVGllciAxCiAgICAgICAgIHRva2VucyA9IGFtb3VudFBhaWQubXVsKHJhdGUpOwoKICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB5b3Ugd2FudCB0byBidXkgZ2V0cyBvdXQgb2YgdGhpcyB0aWVyCiAgICAgICAgIGlmKHRva2Vuc1JhaXNlZC5hZGQodG9rZW5zKSA+IGxpbWl0VGllcjEpCiAgICAgICAgICAgIHRva2VucyA9IGNhbGN1bGF0ZUV4Y2Vzc1Rva2VucyhhbW91bnRQYWlkLCBsaW1pdFRpZXIxLCAxLCByYXRlKTsKICAgICAgfSBlbHNlIGlmKHRva2Vuc1JhaXNlZCA+PSBsaW1pdFRpZXIxICYmIHRva2Vuc1JhaXNlZCA8IGxpbWl0VGllcjIpIHsKCiAgICAgICAgIC8vIFRpZXIgMgogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlVGllcjIpOwoKICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB5b3Ugd2FudCB0byBidXkgZ2V0cyBvdXQgb2YgdGhpcyB0aWVyCiAgICAgICAgIGlmKHRva2Vuc1JhaXNlZC5hZGQodG9rZW5zKSA+IGxpbWl0VGllcjIpCiAgICAgICAgICAgIHRva2VucyA9IGNhbGN1bGF0ZUV4Y2Vzc1Rva2VucyhhbW91bnRQYWlkLCBsaW1pdFRpZXIyLCAyLCByYXRlVGllcjIpOwogICAgICB9IGVsc2UgaWYodG9rZW5zUmFpc2VkID49IGxpbWl0VGllcjIgJiYgdG9rZW5zUmFpc2VkIDwgbGltaXRUaWVyMykgewoKICAgICAgICAgLy8gVGllciAzCiAgICAgICAgIHRva2VucyA9IGFtb3VudFBhaWQubXVsKHJhdGVUaWVyMyk7CgogICAgICAgICAvLyBJZiB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IHlvdSB3YW50IHRvIGJ1eSBnZXRzIG91dCBvZiB0aGlzIHRpZXIKICAgICAgICAgaWYodG9rZW5zUmFpc2VkLmFkZCh0b2tlbnMpID4gbGltaXRUaWVyMykKICAgICAgICAgICAgdG9rZW5zID0gY2FsY3VsYXRlRXhjZXNzVG9rZW5zKGFtb3VudFBhaWQsIGxpbWl0VGllcjMsIDMsIHJhdGVUaWVyMyk7CiAgICAgIH0gZWxzZSBpZih0b2tlbnNSYWlzZWQgPj0gbGltaXRUaWVyMykgewoKICAgICAgICAgLy8gVGllciA0CiAgICAgICAgIHRva2VucyA9IGFtb3VudFBhaWQubXVsKHJhdGVUaWVyNCk7CiAgICAgIH0KCiAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQoYW1vdW50UGFpZCk7CiAgICAgIHVpbnQyNTYgdG9rZW5zUmFpc2VkQmVmb3JlVGhpc1RyYW5zYWN0aW9uID0gdG9rZW5zUmFpc2VkOwogICAgICB0b2tlbnNSYWlzZWQgPSB0b2tlbnNSYWlzZWQuYWRkKHRva2Vucyk7CiAgICAgIHRva2VuLmRpc3RyaWJ1dGVJQ09Ub2tlbnMobXNnLnNlbmRlciwgdG9rZW5zKTsKCiAgICAgIC8vIEtlZXAgYSByZWNvcmQgb2YgaG93IG1hbnkgdG9rZW5zIGV2ZXJ5Ym9keSBnZXRzIGluIGNhc2Ugd2UgbmVlZCB0byBkbyByZWZ1bmRzCiAgICAgIHRva2Vuc0JvdWdodFttc2cuc2VuZGVyXSA9IHRva2Vuc0JvdWdodFttc2cuc2VuZGVyXS5hZGQodG9rZW5zKTsKICAgICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBhbW91bnRQYWlkLCB0b2tlbnMpOwogICAgICBudW1iZXJPZlRyYW5zYWN0aW9ucyA9IG51bWJlck9mVHJhbnNhY3Rpb25zLmFkZCgxKTsKCiAgICAgIGlmKHRva2Vuc1JhaXNlZEJlZm9yZVRoaXNUcmFuc2FjdGlvbiA+IG1pbmltdW1Hb2FsKSB7CgogICAgICAgICB3YWxsZXRCLnRyYW5zZmVyKGFtb3VudFBhaWQpOwoKICAgICAgfSBlbHNlIHsKICAgICAgICAgdmF1bHQuZGVwb3NpdC52YWx1ZShhbW91bnRQYWlkKShtc2cuc2VuZGVyKTsKICAgICAgICAgaWYoZ29hbFJlYWNoZWQoKSkgewogICAgICAgICAgdmF1bHQuY2xvc2UoKTsKICAgICAgICAgfQogICAgICAgICAKICAgICAgfQoKICAgICAgLy8gSWYgdGhlIG1pbmltdW0gZ29hbCBvZiB0aGUgSUNPIGhhcyBiZWVuIHJlYWNoLCBjbG9zZSB0aGUgdmF1bHQgdG8gc2VuZAogICAgICAvLyB0aGUgZXRoZXIgdG8gdGhlIHdhbGxldCBvZiB0aGUgY3Jvd2RzYWxlCiAgICAgIGNoZWNrQ29tcGxldGVkQ3Jvd2RzYWxlKCk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIENhbGN1bGF0ZXMgaG93IG1hbnkgZXRoZXIgd2lsbCBiZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSB0b2tlbnMgaW4KICAgLy8vIGNhc2UgdGhlIGJ1eWVyIHNlbmRzIG1vcmUgdGhhbiB0aGUgbWF4aW11bSBiYWxhbmNlIGJ1dCBoYXMgc29tZSBiYWxhbmNlIGxlZnQKICAgLy8vIGFuZCB1cGRhdGVzIHRoZSBiYWxhbmNlIG9mIHRoYXQgYnV5ZXIuCiAgIC8vLyBGb3IgaW5zdGFuY2UgaWYgaGUncyA1MDAgYmFsYW5jZSBhbmQgaGUgc2VuZHMgMTAwMCwgaXQgd2lsbCByZXR1cm4gNTAwCiAgIC8vLyBhbmQgcmVmdW5kIHRoZSBvdGhlciA1MDAgZXRoZXIKICAgZnVuY3Rpb24gY2FsY3VsYXRlRXhjZXNzQmFsYW5jZSgpIGludGVybmFsIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgIHVpbnQyNTYgYW1vdW50UGFpZCA9IG1zZy52YWx1ZTsKICAgICAgdWludDI1NiBkaWZmZXJlbmNlV2VpID0gMDsKICAgICAgdWludDI1NiBleGNlZWRpbmdCYWxhbmNlID0gMDsKCiAgICAgIC8vIElmIHdlJ3JlIGluIHRoZSBsYXN0IHRpZXIsIGNoZWNrIHRoYXQgdGhlIGxpbWl0IGhhc24ndCBiZWVuIHJlYWNoZWQKICAgICAgLy8gYW5kIGlmIHNvLCByZWZ1bmQgdGhlIGRpZmZlcmVuY2UgYW5kIHJldHVybiB3aGF0IHdpbGwgYmUgdXNlZCB0bwogICAgICAvLyBidXkgdGhlIHJlbWFpbmluZyB0b2tlbnMKICAgICAgaWYodG9rZW5zUmFpc2VkID49IGxpbWl0VGllcjMpIHsKICAgICAgICAgdWludDI1NiBhZGRlZFRva2VucyA9IHRva2Vuc1JhaXNlZC5hZGQoYW1vdW50UGFpZC5tdWwocmF0ZVRpZXI0KSk7CgogICAgICAgICAvLyBJZiB0b2tlbnNSYWlzZWQgKyB3aGF0IHlvdSBwYWlkIGNvbnZlcnRlZCB0byB0b2tlbnMgaXMgYmlnZ2VyIHRoYW4gdGhlIG1heAogICAgICAgICBpZihhZGRlZFRva2VucyA+IG1heFRva2Vuc1JhaXNlZCkgewoKICAgICAgICAgICAgLy8gUmVmdW5kIHRoZSBkaWZmZXJlbmNlCiAgICAgICAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZSA9IGFkZGVkVG9rZW5zLnN1YihtYXhUb2tlbnNSYWlzZWQpOwogICAgICAgICAgICBkaWZmZXJlbmNlV2VpID0gZGlmZmVyZW5jZS5kaXYocmF0ZVRpZXI0KTsKICAgICAgICAgICAgYW1vdW50UGFpZCA9IGFtb3VudFBhaWQuc3ViKGRpZmZlcmVuY2VXZWkpOwogICAgICAgICB9CiAgICAgIH0KCiAgICAgIHVpbnQyNTYgYWRkZWRCYWxhbmNlID0gY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKGFtb3VudFBhaWQpOwoKICAgICAgLy8gQ2hlY2tpbmcgdGhhdCB0aGUgaW5kaXZpZHVhbCBsaW1pdCBvZiAxMDAwIEVUSCBwZXIgdXNlciBpcyBub3QgcmVhY2hlZAogICAgICBpZihhZGRlZEJhbGFuY2UgPD0gbWF4UHVyY2hhc2UpIHsKICAgICAgICAgY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQoYW1vdW50UGFpZCk7CiAgICAgIH0gZWxzZSB7CgogICAgICAgICAvLyBTdWJzdHJhY3RpbmcgMTAwMCBldGhlciBpbiB3ZWkKICAgICAgICAgZXhjZWVkaW5nQmFsYW5jZSA9IGFkZGVkQmFsYW5jZS5zdWIobWF4UHVyY2hhc2UpOwogICAgICAgICBhbW91bnRQYWlkID0gYW1vdW50UGFpZC5zdWIoZXhjZWVkaW5nQmFsYW5jZSk7CgogICAgICAgICAvLyBBZGQgdGhhdCBiYWxhbmNlIHRvIHRoZSBiYWxhbmNlcwogICAgICAgICBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChhbW91bnRQYWlkKTsKICAgICAgfQoKICAgICAgLy8gTWFrZSB0aGUgdHJhbnNmZXJzIGF0IHRoZSBlbmQgb2YgdGhlIGZ1bmN0aW9uIGZvciBzZWN1cml0eSBwdXJwb3NlcwogICAgICBpZihkaWZmZXJlbmNlV2VpID4gMCkKICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihkaWZmZXJlbmNlV2VpKTsKCiAgICAgIGlmKGV4Y2VlZGluZ0JhbGFuY2UgPiAwKSB7CgogICAgICAgICAvLyBSZXR1cm4gdGhlIGV4Y2VlZGluZyBiYWxhbmNlIHRvIHRoZSBidXllcgogICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV4Y2VlZGluZ0JhbGFuY2UpOwogICAgICB9CgogICAgICByZXR1cm4gYW1vdW50UGFpZDsKICAgfQoKICAgLy8vIEBub3RpY2UgU2V0J3MgdGhlIHJhdGUgb2YgdG9rZW5zIHBlciBldGhlciBmb3IgZWFjaCB0aWVyLiBVc2UgaXQgYWZ0ZXIgdGhlCiAgIC8vLyBzbWFydCBjb250cmFjdCBpcyBkZXBsb3llZCB0byBzZXQgdGhlIHByaWNlIGFjY29yZGluZyB0byB0aGUgZXRoZXIgcHJpY2UKICAgLy8vIGF0IHRoZSBzdGFydCBvZiB0aGUgSUNPCiAgIC8vLyBAcGFyYW0gdGllcjEgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciBvbmUKICAgLy8vIEBwYXJhbSB0aWVyMiBUaGUgYW1vdW50IG9mIHRva2VucyB5b3UgZ2V0IGluIHRoZSB0aWVyIHR3bwogICAvLy8gQHBhcmFtIHRpZXIzIFRoZSBhbW91bnQgb2YgdG9rZW5zIHlvdSBnZXQgaW4gdGhlIHRpZXIgdGhyZWUKICAgLy8vIEBwYXJhbSB0aWVyNCBUaGUgYW1vdW50IG9mIHRva2VucyB5b3UgZ2V0IGluIHRoZSB0aWVyIGZvdXIKICAgZnVuY3Rpb24gc2V0VGllclJhdGVzKHVpbnQyNTYgdGllcjEsIHVpbnQyNTYgdGllcjIsIHVpbnQyNTYgdGllcjMsIHVpbnQyNTYgdGllcjQpCiAgICAgIGV4dGVybmFsIG9ubHlPd25lciB3aGVuTm90UGF1c2VkCiAgIHsKICAgICAgcmVxdWlyZSh0aWVyMSA+IDAgJiYgdGllcjIgPiAwICYmIHRpZXIzID4gMCAmJiB0aWVyNCA+IDApOwogICAgICByZXF1aXJlKHRpZXIxID4gdGllcjIgJiYgdGllcjIgPiB0aWVyMyAmJiB0aWVyMyA+IHRpZXI0KTsKCiAgICAgIHJhdGUgPSB0aWVyMTsKICAgICAgcmF0ZVRpZXIyID0gdGllcjI7CiAgICAgIHJhdGVUaWVyMyA9IHRpZXIzOwogICAgICByYXRlVGllcjQgPSB0aWVyNDsKICAgfQoKICAgLy8vIEBub3RpY2UgQWxsb3cgdG8gZXh0ZW5kIElDTyBlbmQgZGF0ZQogICAvLy8gQHBhcmFtIF9lbmRUaW1lIEVuZHRpbWUgb2YgSUNPCiAgIGZ1bmN0aW9uIHNldEVuZERhdGUodWludDI1NiBfZW5kVGltZSkKICAgICAgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQKICAgewogICAgICByZXF1aXJlKG5vdyA8PSBfZW5kVGltZSk7CiAgICAgIHJlcXVpcmUoc3RhcnRUaW1lIDwgX2VuZFRpbWUpOwogICAgICAKICAgICAgZW5kVGltZSA9IF9lbmRUaW1lOwogICB9CgoKICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQgYW5kIGVuYWJsZXMgcmVmdW5kcyBvbmx5IGluIGNhc2UgdGhlCiAgIC8vLyBnb2FsIGhhc24ndCBiZWVuIHJlYWNoZWQKICAgZnVuY3Rpb24gY2hlY2tDb21wbGV0ZWRDcm93ZHNhbGUoKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgIGlmKCFpc0VuZGVkKSB7CiAgICAgICAgIGlmKGhhc0VuZGVkKCkgJiYgIWdvYWxSZWFjaGVkKCkpewogICAgICAgICAgICB2YXVsdC5lbmFibGVSZWZ1bmRzKCk7CgogICAgICAgICAgICBpc1JlZnVuZGluZyA9IHRydWU7CiAgICAgICAgICAgIGlzRW5kZWQgPSB0cnVlOwogICAgICAgICAgICBGaW5hbGl6ZWQoKTsKICAgICAgICAgfSBlbHNlIGlmKGhhc0VuZGVkKCkgICYmIGdvYWxSZWFjaGVkKCkpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBpc0VuZGVkID0gdHJ1ZTsgCgoKICAgICAgICAgICAgLy8gQnVybiB0b2tlbiBvbmx5IHdoZW4gbWluaW11bSBnb2FsIHJlYWNoZWQgYW5kIG1heEdvYWwgbm90IHJlYWNoZWQuIAogICAgICAgICAgICBpZih0b2tlbnNSYWlzZWQgPCBtYXhUb2tlbnNSYWlzZWQpIHsKCiAgICAgICAgICAgICAgIHRva2VuLmJ1cm5Ub2tlbnMoKTsKCiAgICAgICAgICAgIH0gCgogICAgICAgICAgICBGaW5hbGl6ZWQoKTsKICAgICAgICAgfSAKICAgICAgICAgCiAgICAgICAgIAogICAgICB9CiAgIH0KCiAgIC8vLyBAbm90aWNlIElmIGNyb3dkc2FsZSBpcyB1bnN1Y2Nlc3NmdWwsIGludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kcyBoZXJlCiAgIGZ1bmN0aW9uIGNsYWltUmVmdW5kKCkgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgIHJlcXVpcmUoaGFzRW5kZWQoKSAmJiAhZ29hbFJlYWNoZWQoKSAmJiBpc1JlZnVuZGluZyk7CgogICAgIHZhdWx0LnJlZnVuZChtc2cuc2VuZGVyKTsKICAgICB0b2tlbi5yZWZ1bmRUb2tlbnMobXNnLnNlbmRlciwgdG9rZW5zQm91Z2h0W21zZy5zZW5kZXJdKTsKICAgfQoKICAgLy8vIEBub3RpY2UgQnV5cyB0aGUgdG9rZW5zIGZvciB0aGUgc3BlY2lmaWVkIHRpZXIgYW5kIGZvciB0aGUgbmV4dCBvbmUKICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiBldGhlciBwYWlkIHRvIGJ1eSB0aGUgdG9rZW5zCiAgIC8vLyBAcGFyYW0gdG9rZW5zVGhpc1RpZXIgVGhlIGxpbWl0IG9mIHRva2VucyBvZiB0aGF0IHRpZXIKICAgLy8vIEBwYXJhbSB0aWVyU2VsZWN0ZWQgVGhlIHRpZXIgc2VsZWN0ZWQKICAgLy8vIEBwYXJhbSBfcmF0ZSBUaGUgcmF0ZSB1c2VkIGZvciB0aGF0IGB0aWVyU2VsZWN0ZWRgCiAgIC8vLyBAcmV0dXJuIHVpbnQgVGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYm91Z2h0IGNvbWJpbmluZyB0aGUgdGllciBwcmljZXMKICAgZnVuY3Rpb24gY2FsY3VsYXRlRXhjZXNzVG9rZW5zKAogICAgICB1aW50MjU2IGFtb3VudCwKICAgICAgdWludDI1NiB0b2tlbnNUaGlzVGllciwKICAgICAgdWludDI1NiB0aWVyU2VsZWN0ZWQsCiAgICAgIHVpbnQyNTYgX3JhdGUKICAgKSBwdWJsaWMgcmV0dXJucyh1aW50MjU2IHRvdGFsVG9rZW5zKSB7CiAgICAgIHJlcXVpcmUoYW1vdW50ID4gMCAmJiB0b2tlbnNUaGlzVGllciA+IDAgJiYgX3JhdGUgPiAwKTsKICAgICAgcmVxdWlyZSh0aWVyU2VsZWN0ZWQgPj0gMSAmJiB0aWVyU2VsZWN0ZWQgPD0gNCk7CgogICAgICB1aW50IHdlaVRoaXNUaWVyID0gdG9rZW5zVGhpc1RpZXIuc3ViKHRva2Vuc1JhaXNlZCkuZGl2KF9yYXRlKTsKICAgICAgdWludCB3ZWlOZXh0VGllciA9IGFtb3VudC5zdWIod2VpVGhpc1RpZXIpOwogICAgICB1aW50IHRva2Vuc05leHRUaWVyID0gMDsKICAgICAgYm9vbCByZXR1cm5Ub2tlbnMgPSBmYWxzZTsKCiAgICAgIC8vIElmIHRoZXJlJ3MgZXhjZXNzaXZlIHdlaSBmb3IgdGhlIGxhc3QgdGllciwgcmVmdW5kIHRob3NlCiAgICAgIGlmKHRpZXJTZWxlY3RlZCAhPSA0KQogICAgICAgICB0b2tlbnNOZXh0VGllciA9IGNhbGN1bGF0ZVRva2Vuc1RpZXIod2VpTmV4dFRpZXIsIHRpZXJTZWxlY3RlZC5hZGQoMSkpOwogICAgICBlbHNlCiAgICAgICAgIHJldHVyblRva2VucyA9IHRydWU7CgogICAgICB0b3RhbFRva2VucyA9IHRva2Vuc1RoaXNUaWVyLnN1Yih0b2tlbnNSYWlzZWQpLmFkZCh0b2tlbnNOZXh0VGllcik7CgogICAgICAvLyBEbyB0aGUgdHJhbnNmZXIgYXQgdGhlIGVuZAogICAgICBpZihyZXR1cm5Ub2tlbnMpIG1zZy5zZW5kZXIudHJhbnNmZXIod2VpTmV4dFRpZXIpOwogICB9CgogICAvLy8gQG5vdGljZSBCdXlzIHRoZSB0b2tlbnMgZ2l2ZW4gdGhlIHByaWNlIG9mIHRoZSB0aWVyIG9uZSBhbmQgdGhlIHdlaSBwYWlkCiAgIC8vLyBAcGFyYW0gd2VpUGFpZCBUaGUgYW1vdW50IG9mIHdlaSBwYWlkIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICAgLy8vIEBwYXJhbSB0aWVyU2VsZWN0ZWQgVGhlIHRpZXIgdGhhdCB5b3UnbGwgdXNlIGZvciB0aGlyIHB1cmNoYXNlCiAgIC8vLyBAcmV0dXJuIGNhbGN1bGF0ZWRUb2tlbnMgUmV0dXJucyBob3cgbWFueSB0b2tlbnMgeW91J3ZlIGJvdWdodCBmb3IgdGhhdCB3ZWkgcGFpZAogICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbnNUaWVyKHVpbnQyNTYgd2VpUGFpZCwgdWludDI1NiB0aWVyU2VsZWN0ZWQpCiAgICAgICAgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IGNhbGN1bGF0ZWRUb2tlbnMpCiAgIHsKICAgICAgcmVxdWlyZSh3ZWlQYWlkID4gMCk7CiAgICAgIHJlcXVpcmUodGllclNlbGVjdGVkID49IDEgJiYgdGllclNlbGVjdGVkIDw9IDQpOwoKICAgICAgaWYodGllclNlbGVjdGVkID09IDEpCiAgICAgICAgIGNhbGN1bGF0ZWRUb2tlbnMgPSB3ZWlQYWlkLm11bChyYXRlKTsKICAgICAgZWxzZSBpZih0aWVyU2VsZWN0ZWQgPT0gMikKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGVUaWVyMik7CiAgICAgIGVsc2UgaWYodGllclNlbGVjdGVkID09IDMpCiAgICAgICAgIGNhbGN1bGF0ZWRUb2tlbnMgPSB3ZWlQYWlkLm11bChyYXRlVGllcjMpOwogICAgICBlbHNlCiAgICAgICAgIGNhbGN1bGF0ZWRUb2tlbnMgPSB3ZWlQYWlkLm11bChyYXRlVGllcjQpOwogICB9CgoKICAgLy8vIEBub3RpY2UgQ2hlY2tzIGlmIGEgcHVyY2hhc2UgaXMgY29uc2lkZXJlZCB2YWxpZAogICAvLy8gQHJldHVybiBib29sIElmIHRoZSBwdXJjaGFzZSBpcyB2YWxpZCBvciBub3QKICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlID4gMDsKICAgICAgYm9vbCB3aXRoaW5Ub2tlbkxpbWl0ID0gdG9rZW5zUmFpc2VkIDwgbWF4VG9rZW5zUmFpc2VkOwogICAgICBib29sIG1pbmltdW1QdXJjaGFzZSA9IG1zZy52YWx1ZSA+PSBtaW5QdXJjaGFzZTsKICAgICAgYm9vbCBoYXNCYWxhbmNlQXZhaWxhYmxlID0gY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0gPCBtYXhQdXJjaGFzZTsKCiAgICAgIC8vIFdlIHdhbnQgdG8gbGltaXQgdGhlIGdhcyB0byBhdm9pZCBnaXZpbmcgcHJpb3JpdHkgdG8gdGhlIGJpZ2dlc3QgcGF5aW5nIGNvbnRyaWJ1dG9ycwogICAgICAvL2Jvb2wgbGltaXRHYXMgPSB0eC5nYXNwcmljZSA8PSBsaW1pdEdhc1ByaWNlOwoKICAgICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2UgJiYgd2l0aGluVG9rZW5MaW1pdCAmJiBtaW5pbXVtUHVyY2hhc2UgJiYgaGFzQmFsYW5jZUF2YWlsYWJsZTsKICAgfQoKICAgLy8vIEBub3RpY2UgVG8gc2VlIGlmIHRoZSBtaW5pbXVtIGdvYWwgb2YgdG9rZW5zIG9mIHRoZSBJQ08gaGFzIGJlZW4gcmVhY2hlZAogICAvLy8gQHJldHVybiBib29sIFRydWUgaWYgdGhlIHRva2VucyByYWlzZWQgYXJlIGJpZ2dlciB0aGFuIHRoZSBnb2FsIG9yIGZhbHNlIG90aGVyd2lzZQogICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgcmV0dXJuIHRva2Vuc1JhaXNlZCA+PSBtaW5pbXVtR29hbDsKICAgfQoKICAgLy8vIEBub3RpY2UgUHVibGljIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkIG9yIG5vdAogICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgcmV0dXJuIG5vdyA+IGVuZFRpbWUgfHwgdG9rZW5zUmFpc2VkID49IG1heFRva2Vuc1JhaXNlZDsKICAgfQp9'.
	

]
