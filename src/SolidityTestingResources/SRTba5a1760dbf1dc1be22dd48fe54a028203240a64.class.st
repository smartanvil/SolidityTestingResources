Class {
	#name : #SRTba5a1760dbf1dc1be22dd48fe54a028203240a64,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTba5a1760dbf1dc1be22dd48fe54a028203240a64 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBFbmdpbmUgewogICAgdWludDI1NiBwdWJsaWMgVkVSU0lPTjsKICAgIHN0cmluZyBwdWJsaWMgVkVSU0lPTl9OQU1FOwoKICAgIGVudW0gU3RhdHVzIHsgaW5pdGlhbCwgbGVudCwgcGFpZCwgZGVzdHJveWVkIH0KICAgIHN0cnVjdCBBcHByb2JhdGlvbiB7CiAgICAgICAgYm9vbCBhcHByb3ZlZDsKICAgICAgICBieXRlcyBkYXRhOwogICAgICAgIGJ5dGVzMzIgY2hlY2tzdW07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG90YWxMb2FucygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0T3JhY2xlKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKE9yYWNsZSk7CiAgICBmdW5jdGlvbiBnZXRCb3Jyb3dlcih1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldENvc2lnbmVyKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2KSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGdldENyZWF0b3IodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRBbW91bnQodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRQYWlkKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gZ2V0RHVlVGltZSh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldEFwcHJvYmF0aW9uKHVpbnQgaW5kZXgsIGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0U3RhdHVzKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKFN0YXR1cyk7CiAgICBmdW5jdGlvbiBpc0FwcHJvdmVkKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UGVuZGluZ0Ftb3VudCh1aW50IGluZGV4KSBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRDdXJyZW5jeSh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyKTsKICAgIGZ1bmN0aW9uIGNvc2lnbih1aW50IGluZGV4LCB1aW50MjU2IGNvc3QpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYXBwcm92ZUxvYW4odWludCBpbmRleCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiBpbmRleCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB3aXRoZHJhd2FsKHVpbnQgaW5kZXgsIGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCi8qKgogICAgQGRldiBEZWZpbmVzIHRoZSBpbnRlcmZhY2Ugb2YgYSBzdGFuZGFyZCBSQ04gY29zaWduZXIuCgogICAgVGhlIGNvc2lnbmVyIGlzIGFuIGFnZW50IHRoYXQgZ2l2ZXMgYW4gaW5zdXJhbmNlIHRvIHRoZSBsZW5kZXIgaW4gdGhlIGV2ZW50IG9mIGEgZGVmYXVsdGVkIGxvYW4sIHRoZSBjb25maXRpb25zCiAgICBvZiB0aGUgaW5zdXJhbmNlIGFuZCB0aGUgY29zdCBvZiB0aGUgZ2l2ZW4gYXJlIGRlZmluZWQgYnkgdGhlIGNvc2lnbmVyLiAKCiAgICBUaGUgbGVuZGVyIHdpbGwgZGVjaWRlIHdoYXQgY29zaWduZXIgdG8gdXNlLCBpZiBhbnk7IHRoZSBhZGRyZXNzIG9mIHRoZSBjb3NpZ25lciBhbmQgdGhlIHZhbGlkIGRhdGEgcHJvdmlkZWQgYnkgdGhlCiAgICBhZ2VudCBzaG91bGQgYmUgcGFzc2VkIGFzIHBhcmFtcyB3aGVuIHRoZSBsZW5kZXIgY2FsbHMgdGhlICJsZW5kIiBtZXRob2Qgb24gdGhlIGVuZ2luZS4KICAgIAogICAgV2hlbiB0aGUgZGVmYXVsdCBjb25kaXRpb25zIGRlZmluZWQgYnkgdGhlIGNvc2lnbmVyIGFsaWducyB3aXRoIHRoZSBzdGF0dXMgb2YgdGhlIGxvYW4sIHRoZSBsZW5kZXIgb2YgdGhlIGVuZ2luZQogICAgc2hvdWxkIGJlIGFibGUgdG8gY2FsbCB0aGUgImNsYWltIiBtZXRob2QgdG8gcmVjZWl2ZSB0aGUgYmVuZWZpdDsgdGhlIGNvc2lnbmVyIGNhbiBkZWZpbmUgYWRpdGlvbmFsIHJlcXVpcmVtZW50cyB0bwogICAgY2FsbCB0aGlzIG1ldGhvZCwgbGlrZSB0aGUgdHJhbnNmZXIgb2YgdGhlIG93bmVyc2hpcCBvZiB0aGUgbG9hbi4KKi8KY29udHJhY3QgQ29zaWduZXIgewogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVkVSU0lPTiA9IDI7CiAgICAKICAgIC8qKgogICAgICAgIEByZXR1cm4gdGhlIHVybCBvZiB0aGUgZW5kcG9pbnQgdGhhdCBleHBvc2VzIHRoZSBpbnN1cmFuY2Ugb2ZmZXJzLgogICAgKi8KICAgIGZ1bmN0aW9uIHVybCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyk7CiAgICAKICAgIC8qKgogICAgICAgIEBkZXYgUmV0cmlldmVzIHRoZSBjb3N0IG9mIGEgZ2l2ZW4gaW5zdXJhbmNlLCB0aGlzIGFtb3VudCBzaG91bGQgYmUgZXhhY3QuCgogICAgICAgIEByZXR1cm4gdGhlIGNvc3Qgb2YgdGhlIGNvc2lnbiwgaW4gUkNOIHdlaQogICAgKi8KICAgIGZ1bmN0aW9uIGNvc3QoYWRkcmVzcyBlbmdpbmUsIHVpbnQyNTYgaW5kZXgsIGJ5dGVzIGRhdGEsIGJ5dGVzIG9yYWNsZURhdGEpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgCiAgICAvKioKICAgICAgICBAZGV2IFRoZSBlbmdpbmUgY2FsbHMgdGhpcyBtZXRob2QgZm9yIGNvbmZpcm1hdGlvbiBvZiB0aGUgY29uZGl0aW9ucywgaWYgdGhlIGNvc2lnbmVyIGFjY2VwdHMgdGhlIGxpYWJpbGl0eSBvZgogICAgICAgIHRoZSBpbnN1cmFuY2UgaXQgbXVzdCBjYWxsIHRoZSBtZXRob2QgImNvc2lnbiIgb2YgdGhlIGVuZ2luZS4gSWYgdGhlIGNvc2lnbmVyIGRvZXMgbm90IGNhbGwgdGhhdCBtZXRob2QsIG9yCiAgICAgICAgZG9lcyBub3QgcmV0dXJuIHRydWUgdG8gdGhpcyBtZXRob2QsIHRoZSBvcGVyYXRpb24gZmFpbHMuCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY29zaWduZXIgYWNjZXB0cyB0aGUgbGlhYmlsaXR5CiAgICAqLwogICAgZnVuY3Rpb24gcmVxdWVzdENvc2lnbihFbmdpbmUgZW5naW5lLCB1aW50MjU2IGluZGV4LCBieXRlcyBkYXRhLCBieXRlcyBvcmFjbGVEYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICAKICAgIC8qKgogICAgICAgIEBkZXYgQ2xhaW1zIHRoZSBiZW5lZml0IG9mIHRoZSBpbnN1cmFuY2UgaWYgdGhlIGxvYW4gaXMgZGVmYXVsdGVkLCB0aGlzIG1ldGhvZCBzaG91bGQgYmUgb25seSBjYWxsZWFibGUgYnkgdGhlCiAgICAgICAgY3VycmVudCBsZW5kZXIgb2YgdGhlIGxvYW4uCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY2xhaW0gd2FzIGRvbmUgY29ycmVjdGx5LgogICAgKi8KICAgIGZ1bmN0aW9uIGNsYWltKGFkZHJlc3MgZW5naW5lLCB1aW50MjU2IGluZGV4LCBieXRlcyBvcmFjbGVEYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7Cn0KCmNvbnRyYWN0IEVSQzcyMSB7CiAgIC8vIEVSQzIwIGNvbXBhdGlibGUgZnVuY3Rpb25zCiAgIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgX25hbWUpOwogICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgX3N5bWJvbCk7CiAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfdG90YWxTdXBwbHkpOwogICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgX2JhbGFuY2UpOwogICAvLyBGdW5jdGlvbnMgdGhhdCBkZWZpbmUgb3duZXJzaGlwCiAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NikgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpOwogICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpOwogICBmdW5jdGlvbiBnZXRBcHByb3ZlZCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgLy8gVG9rZW4gbWV0YWRhdGEKICAgZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mbyk7CiAgIC8vIEV2ZW50cwogICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpOwogICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX2FwcHJvdmVkLCB1aW50MjU2IF90b2tlbklkKTsKfQoKY29udHJhY3QgVG9rZW4gewogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwp9Cgpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOyAKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IFRyYW5zZmVycyB0aGUgb3duZXJzaGlwIG9mIHRoZSBjb250cmFjdC4KCiAgICAgICAgQHBhcmFtIF90byBBZGRyZXNzIG9mIHRoZSBuZXcgb3duZXIKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRvKGFkZHJlc3MgX3RvKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICBvd25lciA9IF90bzsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gCn0gCgovKioKICAgIEBkZXYgRGVmaW5lcyB0aGUgaW50ZXJmYWNlIG9mIGEgc3RhbmRhcmQgUkNOIG9yYWNsZS4KCiAgICBUaGUgb3JhY2xlIGlzIGFuIGFnZW50IGluIHRoZSBSQ04gbmV0d29yayB0aGF0IHN1cHBsaWVzIGEgY29udmVydGlvbiByYXRlIGJldHdlZW4gUkNOIGFuZCBhbnkgb3RoZXIgY3VycmVuY3ksCiAgICBpdCdzIHByaW1hcmlseSB1c2VkIGJ5IHRoZSBleGNoYW5nZSBidXQgY291bGQgYmUgdXNlZCBieSBhbnkgb3RoZXIgYWdlbnQuCiovCmNvbnRyYWN0IE9yYWNsZSBpcyBPd25hYmxlIHsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFZFUlNJT04gPSAzOwoKICAgIGV2ZW50IE5ld1N5bWJvbChieXRlczMyIF9jdXJyZW5jeSwgc3RyaW5nIF90aWNrZXIpOwogICAgCiAgICBzdHJ1Y3QgU3ltYm9sIHsKICAgICAgICBzdHJpbmcgdGlja2VyOwogICAgICAgIGJvb2wgc3VwcG9ydGVkOwogICAgfQoKICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBTeW1ib2wpIHB1YmxpYyBjdXJyZW5jaWVzOwoKICAgIC8qKgogICAgICAgIEBkZXYgUmV0dXJucyB0aGUgdXJsIHdoZXJlIHRoZSBvcmFjbGUgZXhwb3NlcyBhIHZhbGlkICJvcmFjbGVEYXRhIiBpZiBuZWVkZWQKICAgICovCiAgICBmdW5jdGlvbiB1cmwoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpOwoKICAgIC8qKgogICAgICAgIEBkZXYgUmV0dXJucyBhIHZhbGlkIGNvbnZlcnRpb24gcmF0ZSBmcm9tIHRoZSBjdXJyZW5jeSBnaXZlbiB0byBSQ04KCiAgICAgICAgQHBhcmFtIHN5bWJvbCBTeW1ib2wgb2YgdGhlIGN1cnJlbmN5CiAgICAgICAgQHBhcmFtIGRhdGEgR2VuZXJpYyBkYXRhIGZpZWxkLCBjb3VsZCBiZSB1c2VkIGZvciBvZmYtY2hhaW4gc2lnbmluZwogICAgKi8KICAgIGZ1bmN0aW9uIGdldFJhdGUoYnl0ZXMzMiBzeW1ib2wsIGJ5dGVzIGRhdGEpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2IHJhdGUsIHVpbnQyNTYgZGVjaW1hbHMpOwoKICAgIC8qKgogICAgICAgIEBkZXYgQWRkcyBhIGN1cnJlbmN5IHRvIHRoZSBvcmFjbGUsIG9uY2UgYWRkZWQgaXQgY2Fubm90IGJlIHJlbW92ZWQKCiAgICAgICAgQHBhcmFtIHRpY2tlciBTeW1ib2wgb2YgdGhlIGN1cnJlbmN5CgogICAgICAgIEByZXR1cm4gdGhlIGhhc2ggb2YgdGhlIGN1cnJlbmN5LCBjYWxjdWxhdGVkIGtlY2NhazI1Nih0aWNrZXIpCiAgICAqLwogICAgZnVuY3Rpb24gYWRkQ3VycmVuY3koc3RyaW5nIHRpY2tlcikgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgTmV3U3ltYm9sKGN1cnJlbmN5LCB0aWNrZXIpOwogICAgICAgIGJ5dGVzMzIgY3VycmVuY3kgPSBrZWNjYWsyNTYodGlja2VyKTsKICAgICAgICBjdXJyZW5jaWVzW2N1cnJlbmN5XSA9IFN5bWJvbCh0aWNrZXIsIHRydWUpOwogICAgICAgIHJldHVybiBjdXJyZW5jeTsKICAgIH0KCiAgICAvKioKICAgICAgICBAcmV0dXJuIHRydWUgSWYgdGhlIGN1cnJlbmN5IGlzIHN1cHBvcnRlZAogICAgKi8KICAgIGZ1bmN0aW9uIHN1cHBvcnRlZChieXRlczMyIHN5bWJvbCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBjdXJyZW5jaWVzW3N5bWJvbF0uc3VwcG9ydGVkOwogICAgfQp9Cgpjb250cmFjdCBScFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludDI1NiB4LCB1aW50MjU2IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgIHVpbnQyNTYgeiA9IHggKyB5OwogICAgICByZXF1aXJlKCh6ID49IHgpICYmICh6ID49IHkpKTsKICAgICAgcmV0dXJuIHo7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZVN1YnRyYWN0KHVpbnQyNTYgeCwgdWludDI1NiB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NikgewogICAgICByZXF1aXJlKHggPj0geSk7CiAgICAgIHVpbnQyNTYgeiA9IHggLSB5OwogICAgICByZXR1cm4gejsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlTXVsdCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgdWludDI1NiB6ID0geCAqIHk7CiAgICAgIHJlcXVpcmUoKHggPT0gMCl8fCh6L3ggPT0geSkpOwogICAgICByZXR1cm4gejsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4odWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgaWYgKGEgPCBiKSB7IAogICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICByZXR1cm4gYjsgCiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBtYXgodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgaWYgKGEgPiBiKSB7IAogICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICByZXR1cm4gYjsgCiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBUb2tlbkxvY2thYmxlIGlzIFJwU2FmZU1hdGgsIE93bmFibGUgewogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBsb2NrZWRUb2tlbnM7CgogICAgLyoqCiAgICAgICAgQGRldiBMb2NrZWQgdG9rZW5zIGNhbm5vdCBiZSB3aXRoZHJhd24gdXNpbmcgdGhlIHdpdGhkcmF3VG9rZW5zIGZ1bmN0aW9uLgogICAgKi8KICAgIGZ1bmN0aW9uIGxvY2tUb2tlbnMoYWRkcmVzcyB0b2tlbiwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgICAgICBsb2NrZWRUb2tlbnNbdG9rZW5dID0gc2FmZUFkZChsb2NrZWRUb2tlbnNbdG9rZW5dLCBhbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgVW5sb2NrcyBwcmV2aXVzbHkgbG9ja2VkIHRva2Vucy4KICAgICovCiAgICBmdW5jdGlvbiB1bmxvY2tUb2tlbnMoYWRkcmVzcyB0b2tlbiwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgICAgICBsb2NrZWRUb2tlbnNbdG9rZW5dID0gc2FmZVN1YnRyYWN0KGxvY2tlZFRva2Vuc1t0b2tlbl0sIGFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBXaXRoZHJhd3MgdG9rZW5zIGZyb20gdGhlIGNvbnRyYWN0LgoKICAgICAgICBAcGFyYW0gdG9rZW4gVG9rZW4gdG8gd2l0aGRyYXcKICAgICAgICBAcGFyYW0gdG8gRGVzdGluYXRpb24gb2YgdGhlIHRva2VucwogICAgICAgIEBwYXJhbSBhbW91bnQgQW1vdW50IHRvIHdpdGhkcmF3IAogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKFRva2VuIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShzYWZlU3VidHJhY3QodG9rZW4uYmFsYW5jZU9mKHRoaXMpLCBsb2NrZWRUb2tlbnNbdG9rZW5dKSA+PSBhbW91bnQpOwogICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmV0dXJuIHRva2VuLnRyYW5zZmVyKHRvLCBhbW91bnQpOwogICAgfQp9Cgpjb250cmFjdCBOYW5vTG9hbkVuZ2luZSBpcyBFUkM3MjEsIEVuZ2luZSwgT3duYWJsZSwgVG9rZW5Mb2NrYWJsZSB7CiAgICB1aW50MjU2IGNvbnN0YW50IGludGVybmFsIFBSRUNJU0lPTiA9ICgxMCoqMTgpOwogICAgdWludDI1NiBjb25zdGFudCBpbnRlcm5hbCBNQVhfREVDSU1BTFMgPSAxODsKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBWRVJTSU9OID0gMjEwOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBWRVJTSU9OX05BTUUgPSAiQmFzYWx0IjsKCiAgICB1aW50MjU2IHByaXZhdGUgYWN0aXZlTG9hbnMgPSAwOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgbGVuZGVyc0JhbGFuY2U7CgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBfbmFtZSkgewogICAgICAgIF9uYW1lID0gIlJDTiAtIE5hbm8gbG9hbiBlbmdpbmUgLSBCYXNhbHQgMjEwIjsKICAgIH0KCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgX3N5bWJvbCkgewogICAgICAgIF9zeW1ib2wgPSAiUkNOLU5MRS0yMTAiOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgUmV0dXJucyB0aGUgbnVtYmVyIG9mIGFjdGl2ZSBsb2FucyBpbiB0b3RhbCwgYWN0aXZlIGxvYW5zIGFyZSB0aGUgbG9hbnMgd2l0aCAibGVudCIgc3RhdHVzLgogICAgICAgIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZQoKICAgICAgICBAcmV0dXJuIF90b3RhbFN1cHBseSBUb3RhbCBhbW91bnQgb2YgbG9hbnMKICAgICovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgX3RvdGFsU3VwcGx5KSB7CiAgICAgICAgX3RvdGFsU3VwcGx5ID0gYWN0aXZlTG9hbnM7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgYWN0aXZlIGxvYW5zIHRoYXQgYSBsZW5kZXIgcG9zc2VzczsgYWN0aXZlIGxvYW5zIGFyZSB0aGUgbG9hbnMgd2l0aCAibGVudCIgc3RhdHVzLgogICAgICAgIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZQoKICAgICAgICBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzIHRvIHNlYXJjaAogICAgICAgIAogICAgICAgIEByZXR1cm4gX2JhbGFuY2UgQW1vdW50IG9mIGxvYW5zICAKICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgX2JhbGFuY2UpIHsKICAgICAgICBfYmFsYW5jZSA9IGxlbmRlcnNCYWxhbmNlW19vd25lcl07CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBNYXBzIHRoZSBpbmRpY2VzIG9mIGxlbmRlcnMgbG9hbnMgdG8gdG9rZW5zIGlkcwogICAgICAgIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZSwgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZS4KICAgICAgICAgICAgaXQgd2Fsa3MgdGhlIGVudGlyZSBsb2FucyBhcnJheSwgYW5kIHdpbGwgcHJvYmFibHkgY3JlYXRlIGEgdHJhbnNhY3Rpb24gYmlnZ2VyIHRoYW4gdGhlIGdhcyBsaW1pdC4KCiAgICAgICAgQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfaW5kZXggTG9hbiBpbmRleCBmb3IgdGhlIG93bmVyCgogICAgICAgIEByZXR1cm4gdG9rZW5JZCBSZWFsIHRva2VuIGlkCiAgICAqLwogICAgZnVuY3Rpb24gdG9rZW5PZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCB0b2tlbklkKSB7CiAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgogICAgICAgIGlmICh0b2tlbkNvdW50ID09IDAgfHwgX2luZGV4ID49IHRva2VuQ291bnQpIHsKICAgICAgICAgICAgLy8gRmFpbCB0cmFuc2FjdGlvbgogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2IHRvdGFsTG9hbnMgPSB0b3RhbFN1cHBseSgpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKCiAgICAgICAgICAgIHVpbnQyNTYgbG9hbklkOwoKICAgICAgICAgICAgZm9yIChsb2FuSWQgPSAwOyBsb2FuSWQgPD0gdG90YWxMb2FuczsgbG9hbklkKyspIHsKICAgICAgICAgICAgICAgIGlmIChsb2Fuc1tsb2FuSWRdLmxlbmRlciA9PSBfb3duZXIgJiYgbG9hbnNbbG9hbklkXS5zdGF0dXMgPT0gU3RhdHVzLmxlbnQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0SW5kZXggPT0gX2luZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsb2FuSWQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFJldHVybnMgYWxsIHRoZSBsb2FucyB0aGF0IGEgbGVuZGVyIHBvc3Nlc3MKICAgICAgICBAZGV2IFRoaXMgbWV0aG9kIE1VU1QgTkVWRVIgYmUgY2FsbGVkIGJ5IHNtYXJ0IGNvbnRyYWN0IGNvZGU7IAogICAgICAgICAgICBpdCB3YWxrcyB0aGUgZW50aXJlIGxvYW5zIGFycmF5LCBhbmQgd2lsbCBwcm9iYWJseSBjcmVhdGUgYSB0cmFuc2FjdGlvbiBiaWdnZXIgdGhhbiB0aGUgZ2FzIGxpbWl0LgoKICAgICAgICBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzCgogICAgICAgIEByZXR1cm4gb3duZXJUb2tlbnMgTGlzdCBvZiBhbGwgdGhlIGxvYW5zIG9mIHRoZSBfb3duZXIKICAgICovCiAgICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdIG93bmVyVG9rZW5zKSB7CiAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgogICAgICAgIGlmICh0b2tlbkNvdW50ID09IDApIHsKICAgICAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbExvYW5zID0gdG90YWxTdXBwbHkoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICAgICAgICB1aW50MjU2IGxvYW5JZDsKCiAgICAgICAgICAgIGZvciAobG9hbklkID0gMDsgbG9hbklkIDw9IHRvdGFsTG9hbnM7IGxvYW5JZCsrKSB7CiAgICAgICAgICAgICAgICBpZiAobG9hbnNbbG9hbklkXS5sZW5kZXIgPT0gX293bmVyICYmIGxvYW5zW2xvYW5JZF0uc3RhdHVzID09IFN0YXR1cy5sZW50KSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IGxvYW5JZDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFJldHVybnMgdGhlIGxvYW4gbWV0YWRhdGEsIHRoaXMgZmllbGQgY2FuIGJlIHNldCBieSB0aGUgY3JlYXRvciBvZiB0aGUgbG9hbiB3aXRoIGhpcyBvd24gY3JpdGVyaWEuCgogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgoKICAgICAgICBAcmV0dXJuIFRoZSBzdHJpbmcgd2l0aCB0aGUgbWV0YWRhdGEKICAgICovCiAgICBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBsb2Fuc1tpbmRleF0ubWV0YWRhdGE7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBSZXR1cm5zIHRoZSBsb2FuIG1ldGFkYXRhLCBoYXNoZWQgd2l0aCBrZWNjYWsyNTYuCiAgICAgICAgQGRldiBUaGlzIGVtdGhvZCBpcyB1c2VmdWwgdG8gZXZhbHVhdGUgbWV0YWRhdGEgZnJvbSBhIHNtYXJ0IGNvbnRyYWN0LgoKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KCiAgICAgICAgQHJldHVybiBUaGUgbWV0YWRhdGEgaGFzaGVkIHdpdGgga2VjY2FrMjU2CiAgICAqLwogICAgZnVuY3Rpb24gdG9rZW5NZXRhZGF0YUhhc2godWludDI1NiBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYobG9hbnNbaW5kZXhdLm1ldGFkYXRhKTsKICAgIH0KCiAgICBUb2tlbiBwdWJsaWMgcmNuOwogICAgYm9vbCBwdWJsaWMgZGVwcmVjYXRlZDsKCiAgICBldmVudCBDcmVhdGVkTG9hbih1aW50IF9pbmRleCwgYWRkcmVzcyBfYm9ycm93ZXIsIGFkZHJlc3MgX2NyZWF0b3IpOwogICAgZXZlbnQgQXBwcm92ZWRCeSh1aW50IF9pbmRleCwgYWRkcmVzcyBfYWRkcmVzcyk7CiAgICBldmVudCBMZW50KHVpbnQgX2luZGV4LCBhZGRyZXNzIF9sZW5kZXIsIGFkZHJlc3MgX2Nvc2lnbmVyKTsKICAgIGV2ZW50IERlc3Ryb3llZEJ5KHVpbnQgX2luZGV4LCBhZGRyZXNzIF9hZGRyZXNzKTsKICAgIGV2ZW50IFBhcnRpYWxQYXltZW50KHVpbnQgX2luZGV4LCBhZGRyZXNzIF9zZW5kZXIsIGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBUb3RhbFBheW1lbnQodWludCBfaW5kZXgpOwoKICAgIGZ1bmN0aW9uIE5hbm9Mb2FuRW5naW5lKFRva2VuIF9yY24pIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHJjbiA9IF9yY247CiAgICB9CgogICAgc3RydWN0IExvYW4gewogICAgICAgIFN0YXR1cyBzdGF0dXM7CiAgICAgICAgT3JhY2xlIG9yYWNsZTsKCiAgICAgICAgYWRkcmVzcyBib3Jyb3dlcjsKICAgICAgICBhZGRyZXNzIGxlbmRlcjsKICAgICAgICBhZGRyZXNzIGNyZWF0b3I7CiAgICAgICAgYWRkcmVzcyBjb3NpZ25lcjsKICAgICAgICAKICAgICAgICB1aW50MjU2IGFtb3VudDsKICAgICAgICB1aW50MjU2IGludGVyZXN0OwogICAgICAgIHVpbnQyNTYgcHVuaXRvcnlJbnRlcmVzdDsKICAgICAgICB1aW50MjU2IGludGVyZXN0VGltZXN0YW1wOwogICAgICAgIHVpbnQyNTYgcGFpZDsKICAgICAgICB1aW50MjU2IGludGVyZXN0UmF0ZTsKICAgICAgICB1aW50MjU2IGludGVyZXN0UmF0ZVB1bml0b3J5OwogICAgICAgIHVpbnQyNTYgZHVlVGltZTsKICAgICAgICB1aW50MjU2IGR1ZXNJbjsKCiAgICAgICAgYnl0ZXMzMiBjdXJyZW5jeTsKICAgICAgICB1aW50MjU2IGNhbmNlbGFibGVBdDsKICAgICAgICB1aW50MjU2IGxlbmRlckJhbGFuY2U7CgogICAgICAgIGFkZHJlc3MgYXBwcm92ZWRUcmFuc2ZlcjsKICAgICAgICB1aW50MjU2IGV4cGlyYXRpb25SZXF1ZXN0OwoKICAgICAgICBzdHJpbmcgbWV0YWRhdGE7CiAgICAgICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIGFwcHJvYmF0aW9uczsKICAgIH0KCiAgICBMb2FuW10gcHJpdmF0ZSBsb2FuczsKCiAgICAvKioKICAgICAgICBAbm90aWNlIENyZWF0ZXMgYSBsb2FuIHJlcXVlc3QsIHRoZSBsb2FuIGNhbiBiZSBnZW5lcmF0ZWQgd2l0aCBhbnkgYm9ycm93ZXIgYW5kIGNvbmRpdGlvbnM7IGlmIHRoZSBib3Jyb3dlciBhZ3JlZXMKICAgICAgICBpdCBtdXN0IGNhbGwgdGhlICJhcHByb3ZlIiBmdW5jdGlvbi4gSWYgdGhlIGNyZWF0b3Igb2YgdGhlIGxvYW4gaXMgdGhlIGJvcnJvd2VyIHRoZSBhcHByb3ZlIGlzIGRvbmUgYXV0b21hdGljYWxseS4KCiAgICAgICAgQGRldiBUaGUgY3JlYXRvciBvZiB0aGUgbG9hbiBpcyB0aGUgY2FsbGVyIG9mIHRoaXMgZnVuY3Rpb247IHRoaXMgaXMgdXNlZnVsIHRvIHRyYWNrIHdoaWNoIHdhbGxldCBjcmVhdGVkIHRoZSBsb2FuLgoKICAgICAgICBAcGFyYW0gX29yYWNsZUNvbnRyYWN0IEFkZHJlc3Mgb2YgdGhlIE9yYWNsZSBjb250cmFjdCwgaWYgdGhlIGxvYW4gZG9lcyBub3QgdXNlIGFueSBvcmFjbGUsIHRoaXMgZmllbGQgc2hvdWxkIGJlIDB4MC4KICAgICAgICBAcGFyYW0gX2JvcnJvd2VyIEFkZHJlc3Mgb2YgdGhlIGJvcnJvd2VyCiAgICAgICAgQHBhcmFtIF9jdXJyZW5jeSBUaGUgY3VycmVuY3kgdG8gdXNlIHdpdGggdGhlIG9yYWNsZSwgdGhlIGN1cnJlbmN5IGNvZGUgaXMgZ2VuZXJhdGVkIHdpdGggdGhlIGZvbGxvd2luZyBmb3JtdWxhLAogICAgICAgICAgICBrZWNjYWsyNTYodGlja2VyKSwgaXMgYWx3YXlzIHN0b3JlZCBhcyB0aGUgbWluaW11bSBkaXZpc2libGUgYW1vdW50LiAoRWo6IEVUSCBXZWksIFVTRCBDZW50cykKICAgICAgICBAcGFyYW0gX2Ftb3VudCBUaGUgcmVxdWVzdGVkIGFtb3VudDsgY3VycmVuY3kgYW5kIHVuaXQgYXJlIGRlZmluZWQgYnkgdGhlIE9yYWNsZSwgaWYgdGhlcmUgaXMgbm8gT3JhY2xlIHByZXNlbnQKICAgICAgICAgICAgdGhlIGN1cnJlbmN5IGlzIFJDTiwgYW5kIHRoZSB1bml0IGlzIHdlaS4KICAgICAgICBAcGFyYW0gX2ludGVyZXN0UmF0ZSBUaGUgbm9uLXB1bml0b3J5IGludGVyZXN0IHJhdGUgYnkgc2Vjb25kLCBkZWZpbmVkIGFzIGEgZGVub21pbmF0b3Igb2YgMTAgMDAwIDAwMC4KICAgICAgICBAcGFyYW0gX2ludGVyZXN0UmF0ZVB1bml0b3J5IFRoZSBwdW5pdG9yeSBpbnRlcmVzdCByYXRlIGJ5IHNlY29uZCwgZGVmaW5lZCBhcyBhIGRlbm9taW5hdG9yIG9mIDEwIDAwMCAwMDAuCiAgICAgICAgICAgIEVqOiBpbnRlcmVzdFJhdGUgMTExMDg1NzE0Mjg1NzEgPSAyOCUgQW51YWwgaW50ZXJlc3QKICAgICAgICBAcGFyYW0gX2R1ZXNJbiBUaGUgdGltZSBpbiBzZWNvbmRzIHRoYXQgdGhlIGJvcnJvd2VyIGhhcyBpbiBvcmRlciB0byBwYXkgdGhlIGRlYnQgYWZ0ZXIgdGhlIGxlbmRlciBsZW5kcyB0aGUgbW9uZXkuCiAgICAgICAgQHBhcmFtIF9jYW5jZWxhYmxlQXQgRGVsdGEgaW4gc2Vjb25kcyBzcGVjaWZ5aW5nIGhvdyBtdWNoIGludGVyZXN0IHNob3VsZCBiZSBhZGRlZCBpbiBhZHZhbmNlLCBpZiB0aGUgYm9ycm93ZXIgcGF5cyAKICAgICAgICBlbnRpcmVseSBvciBwYXJ0aWFsbHkgdGhlIGxvYW4gYmVmb3JlIHRoaXMgdGVybSwgbm8gZXh0cmEgaW50ZXJlc3Qgd2lsbCBiZSBkZWR1Y3RlZC4KICAgICAgICBAcGFyYW0gX2V4cGlyYXRpb25SZXF1ZXN0IFRpbWVzdGFtcCBvZiB3aGVuIHRoZSBsb2FuIHJlcXVlc3QgZXhwaXJlcywgaWYgdGhlIGxvYW4gaXMgbm90IGZpbGxlZCBiZWZvcmUgdGhpcyBkYXRlLCAKICAgICAgICAgICAgdGhlIHJlcXVlc3QgaXMgbm8gbG9uZ2VyIHZhbGlkLgogICAgICAgIEBwYXJhbSBfbWV0YWRhdGEgU3RyaW5nIHdpdGggbG9hbiBtZXRhZGF0YS4KICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVMb2FuKE9yYWNsZSBfb3JhY2xlQ29udHJhY3QsIGFkZHJlc3MgX2JvcnJvd2VyLCBieXRlczMyIF9jdXJyZW5jeSwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9pbnRlcmVzdFJhdGUsCiAgICAgICAgdWludDI1NiBfaW50ZXJlc3RSYXRlUHVuaXRvcnksIHVpbnQyNTYgX2R1ZXNJbiwgdWludDI1NiBfY2FuY2VsYWJsZUF0LCB1aW50MjU2IF9leHBpcmF0aW9uUmVxdWVzdCwgc3RyaW5nIF9tZXRhZGF0YSkgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCiAgICAgICAgcmVxdWlyZSghZGVwcmVjYXRlZCk7CiAgICAgICAgcmVxdWlyZShfY2FuY2VsYWJsZUF0IDw9IF9kdWVzSW4pOwogICAgICAgIHJlcXVpcmUoX29yYWNsZUNvbnRyYWN0ICE9IGFkZHJlc3MoMCkgfHwgX2N1cnJlbmN5ID09IDB4MCk7CiAgICAgICAgcmVxdWlyZShfYm9ycm93ZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ICE9IDApOwogICAgICAgIHJlcXVpcmUoX2ludGVyZXN0UmF0ZVB1bml0b3J5ICE9IDApOwogICAgICAgIHJlcXVpcmUoX2ludGVyZXN0UmF0ZSAhPSAwKTsKICAgICAgICByZXF1aXJlKF9leHBpcmF0aW9uUmVxdWVzdCA+IGJsb2NrLnRpbWVzdGFtcCk7CgogICAgICAgIHZhciBsb2FuID0gTG9hbihTdGF0dXMuaW5pdGlhbCwgX29yYWNsZUNvbnRyYWN0LCBfYm9ycm93ZXIsIDB4MCwgbXNnLnNlbmRlciwgMHgwLCBfYW1vdW50LCAwLCAwLCAwLCAwLCBfaW50ZXJlc3RSYXRlLAogICAgICAgICAgICBfaW50ZXJlc3RSYXRlUHVuaXRvcnksIDAsIF9kdWVzSW4sIF9jdXJyZW5jeSwgX2NhbmNlbGFibGVBdCwgMCwgMHgwLCBfZXhwaXJhdGlvblJlcXVlc3QsIF9tZXRhZGF0YSk7CiAgICAgICAgdWludCBpbmRleCA9IGxvYW5zLnB1c2gobG9hbikgLSAxOwogICAgICAgIENyZWF0ZWRMb2FuKGluZGV4LCBfYm9ycm93ZXIsIG1zZy5zZW5kZXIpOwoKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBfYm9ycm93ZXIpIHsKICAgICAgICAgICAgYXBwcm92ZUxvYW4oaW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGluZGV4OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpIHsgb3duZXIgPSBsb2Fuc1tpbmRleF0ubGVuZGVyOyB9CiAgICBmdW5jdGlvbiBnZXRUb3RhbExvYW5zKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyByZXR1cm4gbG9hbnMubGVuZ3RoOyB9CiAgICBmdW5jdGlvbiBnZXRPcmFjbGUodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoT3JhY2xlKSB7IHJldHVybiBsb2Fuc1tpbmRleF0ub3JhY2xlOyB9CiAgICBmdW5jdGlvbiBnZXRCb3Jyb3dlcih1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7IHJldHVybiBsb2Fuc1tpbmRleF0uYm9ycm93ZXI7IH0KICAgIGZ1bmN0aW9uIGdldENvc2lnbmVyKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5jb3NpZ25lcjsgfQogICAgZnVuY3Rpb24gZ2V0Q3JlYXRvcih1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7IHJldHVybiBsb2Fuc1tpbmRleF0uY3JlYXRvcjsgfQogICAgZnVuY3Rpb24gZ2V0QW1vdW50KHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5hbW91bnQ7IH0KICAgIGZ1bmN0aW9uIGdldFB1bml0b3J5SW50ZXJlc3QodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgeyByZXR1cm4gbG9hbnNbaW5kZXhdLnB1bml0b3J5SW50ZXJlc3Q7IH0KICAgIGZ1bmN0aW9uIGdldEludGVyZXN0VGltZXN0YW1wKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5pbnRlcmVzdFRpbWVzdGFtcDsgfQogICAgZnVuY3Rpb24gZ2V0UGFpZCh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0ucGFpZDsgfQogICAgZnVuY3Rpb24gZ2V0SW50ZXJlc3RSYXRlKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5pbnRlcmVzdFJhdGU7IH0KICAgIGZ1bmN0aW9uIGdldEludGVyZXN0UmF0ZVB1bml0b3J5KHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5pbnRlcmVzdFJhdGVQdW5pdG9yeTsgfQogICAgZnVuY3Rpb24gZ2V0RHVlVGltZSh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uZHVlVGltZTsgfQogICAgZnVuY3Rpb24gZ2V0RHVlc0luKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5kdWVzSW47IH0KICAgIGZ1bmN0aW9uIGdldENhbmNlbGFibGVBdCh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uY2FuY2VsYWJsZUF0OyB9CiAgICBmdW5jdGlvbiBnZXRBcHByb2JhdGlvbih1aW50IGluZGV4LCBhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7IHJldHVybiBsb2Fuc1tpbmRleF0uYXBwcm9iYXRpb25zW19hZGRyZXNzXTsgfQogICAgZnVuY3Rpb24gZ2V0U3RhdHVzKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKFN0YXR1cykgeyByZXR1cm4gbG9hbnNbaW5kZXhdLnN0YXR1czsgfQogICAgZnVuY3Rpb24gZ2V0TGVuZGVyQmFsYW5jZSh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0ubGVuZGVyQmFsYW5jZTsgfQogICAgZnVuY3Rpb24gZ2V0QXBwcm92ZWQodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykge3JldHVybiBsb2Fuc1tpbmRleF0uYXBwcm92ZWRUcmFuc2ZlcjsgfQogICAgZnVuY3Rpb24gZ2V0Q3VycmVuY3kodWludCBpbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMikgeyByZXR1cm4gbG9hbnNbaW5kZXhdLmN1cnJlbmN5OyB9CiAgICBmdW5jdGlvbiBnZXRFeHBpcmF0aW9uUmVxdWVzdCh1aW50IGluZGV4KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBsb2Fuc1tpbmRleF0uZXhwaXJhdGlvblJlcXVlc3Q7IH0KICAgIGZ1bmN0aW9uIGdldEludGVyZXN0KHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsgcmV0dXJuIGxvYW5zW2luZGV4XS5pbnRlcmVzdDsgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgVXNlZCB0byBrbm93IGlmIGEgbG9hbiBpcyByZWFkeSB0byBsZW5kCgogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIGxvYW4gaGFzIGJlZW4gYXBwcm92ZWQgYnkgdGhlIGJvcnJvd2VyIGFuZCBjb3NpZ25lci4KICAgICovCiAgICBmdW5jdGlvbiBpc0FwcHJvdmVkKHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBMb2FuIHN0b3JhZ2UgbG9hbiA9IGxvYW5zW2luZGV4XTsKICAgICAgICByZXR1cm4gbG9hbi5hcHByb2JhdGlvbnNbbG9hbi5ib3Jyb3dlcl07CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBDYWxsZWQgYnkgdGhlIG1lbWJlcnMgb2YgdGhlIGxvYW4gdG8gc2hvdyB0aGF0IHRoZXkgYWdyZWUgd2l0aCB0aGUgdGVybXMgb2YgdGhlIGxvYW47IHRoZSBib3Jyb3dlcgogICAgICAgIG11c3QgY2FsbCB0aGlzIG1ldGhvZCBiZWZvcmUgYW55IGxlbmRlciBjb3VsZCBjYWxsIHRoZSBtZXRob2QgImxlbmQiLgogICAgICAgICAgICAKICAgICAgICBAZGV2IEFueSBhZGRyZXNzIGNhbiBjYWxsIHRoaXMgbWV0aG9kIHRvIGJlIGFkZGVkIHRvIHRoZSAiYXBwcm9iYXRpb25zIiBtYXBwaW5nLgoKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSBhcHByb3ZlIHdhcyBkb25lIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVMb2FuKHVpbnQgaW5kZXgpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBMb2FuIHN0b3JhZ2UgbG9hbiA9IGxvYW5zW2luZGV4XTsKICAgICAgICByZXF1aXJlKGxvYW4uc3RhdHVzID09IFN0YXR1cy5pbml0aWFsKTsKICAgICAgICBsb2FuLmFwcHJvYmF0aW9uc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICAgICAgQXBwcm92ZWRCeShpbmRleCwgbXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBQZXJmb3JtcyB0aGUgbGVuZCBvZiB0aGUgUkNOIGVxdWl2YWxlbnQgdG8gdGhlIHJlcXVlc3RlZCBhbW91bnQsIGFuZCB0cmFuc2Zvcm1zIHRoZSBtc2cuc2VuZGVyIGluIHRoZSBuZXcgbGVuZGVyLgoKICAgICAgICBAZGV2IFRoZSBsb2FuIG11c3QgYmUgcHJldmlvdXNseSBhcHByb3ZlZCBieSB0aGUgYm9ycm93ZXI7IGJlZm9yZSBjYWxsaW5nIHRoaXMgZnVuY3Rpb24sIHRoZSBsZW5kZXIgY2FuZGlkYXRlIG11c3QgCiAgICAgICAgY2FsbCB0aGUgImFwcHJvdmUiIGZ1bmN0aW9uIG9uIHRoZSBSQ04gVG9rZW4sIHNwZWNpZnlpbmcgYW4gYW1vdW50IHN1ZmZpY2llbnQgZW5vdWdoIHRvIHBheSB0aGUgZXF1aXZhbGVudCBvZgogICAgICAgIHRoZSByZXF1ZXN0ZWQgYW1vdW50LCBhbmQgdGhlIGNvc2lnbmVyIGZlZS4KICAgICAgICAKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KICAgICAgICBAcGFyYW0gb3JhY2xlRGF0YSBEYXRhIHJlcXVpcmVkIGJ5IHRoZSBvcmFjbGUgdG8gcmV0dXJuIHRoZSByYXRlLCB0aGUgY29udGVudCBvZiB0aGlzIGZpZWxkIG11c3QgYmUgcHJvdmlkZWQKICAgICAgICAgICAgYnkgdGhlIHVybCBleHBvc2VkIGluIHRoZSB1cmwoKSBtZXRob2Qgb2YgdGhlIG9yYWNsZS4KICAgICAgICBAcGFyYW0gY29zaWduZXIgQWRkcmVzcyBvZiB0aGUgY29zaWduZXIsIDB4MCBmb3IgbGVuZGluZyB3aXRob3V0IGNvc2lnbmVyLgogICAgICAgIEBwYXJhbSBjb3NpZ25lckRhdGEgRGF0YSByZXF1aXJlZCBieSB0aGUgY29zaWduZXIgdG8gcHJvY2VzcyB0aGUgcmVxdWVzdC4KCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSBsZW5kIHdhcyBkb25lIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIGxlbmQodWludCBpbmRleCwgYnl0ZXMgb3JhY2xlRGF0YSwgQ29zaWduZXIgY29zaWduZXIsIGJ5dGVzIGNvc2lnbmVyRGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBMb2FuIHN0b3JhZ2UgbG9hbiA9IGxvYW5zW2luZGV4XTsKCiAgICAgICAgcmVxdWlyZShsb2FuLnN0YXR1cyA9PSBTdGF0dXMuaW5pdGlhbCk7CiAgICAgICAgcmVxdWlyZShpc0FwcHJvdmVkKGluZGV4KSk7CiAgICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPD0gbG9hbi5leHBpcmF0aW9uUmVxdWVzdCk7CgogICAgICAgIGxvYW4ubGVuZGVyID0gbXNnLnNlbmRlcjsKICAgICAgICBsb2FuLmR1ZVRpbWUgPSBzYWZlQWRkKGJsb2NrLnRpbWVzdGFtcCwgbG9hbi5kdWVzSW4pOwogICAgICAgIGxvYW4uaW50ZXJlc3RUaW1lc3RhbXAgPSBibG9jay50aW1lc3RhbXA7CiAgICAgICAgbG9hbi5zdGF0dXMgPSBTdGF0dXMubGVudDsKCiAgICAgICAgLy8gRVJDNzIxLCBjcmVhdGUgbmV3IGxvYW4gYW5kIHRyYW5zZmVyIGl0IHRvIHRoZSBsZW5kZXIKICAgICAgICBUcmFuc2ZlcigweDAsIGxvYW4ubGVuZGVyLCBpbmRleCk7CiAgICAgICAgYWN0aXZlTG9hbnMgKz0gMTsKICAgICAgICBsZW5kZXJzQmFsYW5jZVtsb2FuLmxlbmRlcl0gKz0gMTsKICAgICAgICAKICAgICAgICBpZiAobG9hbi5jYW5jZWxhYmxlQXQgPiAwKQogICAgICAgICAgICBpbnRlcm5hbEFkZEludGVyZXN0KGxvYW4sIHNhZmVBZGQoYmxvY2sudGltZXN0YW1wLCBsb2FuLmNhbmNlbGFibGVBdCkpOwoKICAgICAgICAvLyBUcmFuc2ZlciB0aGUgbW9uZXkgdG8gdGhlIGJvcnJvd2VyIGJlZm9yZSBoYW5kbGluZyB0aGUgY29zaWduZXIKICAgICAgICAvLyBzbyB0aGUgY29zaWduZXIgY291bGQgcmVxdWlyZSBhIHNwZWNpZmljIHVzYWdlIGZvciB0aGF0IG1vbmV5LgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJWYWx1ZSA9IGNvbnZlcnRSYXRlKGxvYW4ub3JhY2xlLCBsb2FuLmN1cnJlbmN5LCBvcmFjbGVEYXRhLCBsb2FuLmFtb3VudCk7CiAgICAgICAgcmVxdWlyZShyY24udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGxvYW4uYm9ycm93ZXIsIHRyYW5zZmVyVmFsdWUpKTsKICAgICAgICAKICAgICAgICBpZiAoY29zaWduZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAvLyBUaGUgY29zaWduZXIgaXQncyB0ZW1wb3Jhcnkgc2V0IHRvIHRoZSBuZXh0IGFkZHJlc3MgKGNvc2lnbmVyICsgMiksIGl0J3MgZXhwZWN0ZWQgdGhhdCB0aGUgY29zaWduZXIgd2lsbAogICAgICAgICAgICAvLyBjYWxsIHRoZSBtZXRob2QgImNvc2lnbiIgdG8gYWNjZXB0IHRoZSBjb25kaXRpb25zOyB0aGF0IG1ldGhvZCBhbHNvIHNldHMgdGhlIGNvc2lnbmVyIHRvIHRoZSByaWdodAogICAgICAgICAgICAvLyBhZGRyZXNzLiBJZiB0aGF0IGRvZXMgbm90IGhhcHBlbiwgdGhlIHRyYW5zYWN0aW9uIGZhaWxzLgogICAgICAgICAgICBsb2FuLmNvc2lnbmVyID0gYWRkcmVzcyh1aW50MjU2KGNvc2lnbmVyKSArIDIpOwogICAgICAgICAgICByZXF1aXJlKGNvc2lnbmVyLnJlcXVlc3RDb3NpZ24odGhpcywgaW5kZXgsIGNvc2lnbmVyRGF0YSwgb3JhY2xlRGF0YSkpOwogICAgICAgICAgICByZXF1aXJlKGxvYW4uY29zaWduZXIgPT0gYWRkcmVzcyhjb3NpZ25lcikpOwogICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgIExlbnQoaW5kZXgsIGxvYW4ubGVuZGVyLCBjb3NpZ25lcik7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgVGhlIGNvc2lnbmVyIG11c3QgY2FsbCB0aGlzIG1ldGhvZCB0byBhY2NlcHQgdGhlIGNvbmRpdGlvbnMgb2YgYSBsb2FuLCB0aGlzIG1ldGhvZCBwYXlzIHRoZSBjb3NpZ25lciBoaXMgZmVlLgogICAgICAgIAogICAgICAgIEBkZXYgSWYgdGhlIGNvc2lnbmVyIGRvZXMgbm90IGNhbGwgdGhpcyBtZXRob2QgdGhlIHdob2xlICJsZW5kIiBjYWxsIGZhaWxzLgoKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KICAgICAgICBAcGFyYW0gY29zdCBGZWUgc2V0IGJ5IHRoZSBjb3NpZ25lcgoKICAgICAgICBAcmV0dXJuIHRydWUgSWYgdGhlIGNvc2lnbiB3YXMgc3VjY2Vzc2Z1bGwKICAgICovCiAgICBmdW5jdGlvbiBjb3NpZ24odWludCBpbmRleCwgdWludDI1NiBjb3N0KSBleHRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tpbmRleF07CiAgICAgICAgcmVxdWlyZShsb2FuLnN0YXR1cyA9PSBTdGF0dXMubGVudCAmJiAobG9hbi5kdWVUaW1lIC0gbG9hbi5kdWVzSW4pID09IGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgcmVxdWlyZShsb2FuLmNvc2lnbmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobG9hbi5jb3NpZ25lciA9PSBhZGRyZXNzKHVpbnQyNTYobXNnLnNlbmRlcikgKyAyKSk7CiAgICAgICAgbG9hbi5jb3NpZ25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgcmVxdWlyZShyY24udHJhbnNmZXJGcm9tKGxvYW4ubGVuZGVyLCBtc2cuc2VuZGVyLCBjb3N0KSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBEZXN0cm95cyBhIGxvYW4sIHRoZSBib3Jyb3dlciBjb3VsZCBjYWxsIHRoaXMgbWV0aG9kIGlmIHRoZXkgcGVyZm9ybWVkIGFuIGFjY2lkZW50YWwgb3IgcmVncmV0dGVkIAogICAgICAgICJhcHByb3ZlIiBvZiB0aGUgbG9hbiwgdGhpcyBtZXRob2Qgb25seSB3b3JrcyBmb3IgdGhlbSBpZiB0aGUgbG9hbiBpcyBpbiAicGVuZGluZyIgc3RhdHVzLgoKICAgICAgICBUaGUgbGVuZGVyIGNhbiBjYWxsIHRoaXMgbWV0aG9kIGF0IGFueSBtb21lbnQsIGluIGNhc2Ugb2YgYSBsb2FuIHdpdGggc3RhdHVzICJsZW50IiB0aGUgbGVuZGVyIGlzIHBhcmRvbmluZyAKICAgICAgICB0aGUgZGVidC4gCgogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIGRlc3Ryb3kgd2FzIGRvbmUgc3VjY2Vzc2Z1bGx5CiAgICAqLwogICAgZnVuY3Rpb24gZGVzdHJveSh1aW50IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIExvYW4gc3RvcmFnZSBsb2FuID0gbG9hbnNbaW5kZXhdOwogICAgICAgIHJlcXVpcmUobG9hbi5zdGF0dXMgIT0gU3RhdHVzLmRlc3Ryb3llZCk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGxvYW4ubGVuZGVyIHx8IChtc2cuc2VuZGVyID09IGxvYW4uYm9ycm93ZXIgJiYgbG9hbi5zdGF0dXMgPT0gU3RhdHVzLmluaXRpYWwpKTsKICAgICAgICBEZXN0cm95ZWRCeShpbmRleCwgbXNnLnNlbmRlcik7CgogICAgICAgIC8vIEVSQzcyMSwgcmVtb3ZlIGxvYW4gZnJvbSBjaXJjdWxhdGlvbgogICAgICAgIGlmIChsb2FuLnN0YXR1cyAhPSBTdGF0dXMuaW5pdGlhbCkgewogICAgICAgICAgICBsZW5kZXJzQmFsYW5jZVtsb2FuLmxlbmRlcl0gLT0gMTsKICAgICAgICAgICAgYWN0aXZlTG9hbnMgLT0gMTsKICAgICAgICAgICAgVHJhbnNmZXIobG9hbi5sZW5kZXIsIDB4MCwgaW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgbG9hbi5zdGF0dXMgPSBTdGF0dXMuZGVzdHJveWVkOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgVHJhbnNmZXJzIGEgbG9hbiB0byBhIGRpZmZlcmVudCBsZW5kZXIsIHRoZSBjYWxsZXIgbXVzdCBiZSB0aGUgY3VycmVudCBsZW5kZXIgb3IgcHJldmlvdXNseSBiZWluZwogICAgICAgIGFwcHJvdmVkIHdpdGggdGhlIG1ldGhvZCAiYXBwcm92ZVRyYW5zZmVyIjsgb25seSBsb2FucyB3aXRoIHRoZSBTdGF0dXMubGVudCBzdGF0dXMgY2FuIGJlIHRyYW5zZmVyZWQuCgogICAgICAgIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZQoKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KICAgICAgICBAcGFyYW0gdG8gTmV3IGxlbmRlcgoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBkb25lIHN1Y2Nlc3NmdWxseQogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgaW5kZXgpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tpbmRleF07CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShsb2FuLnN0YXR1cyAhPSBTdGF0dXMuZGVzdHJveWVkICYmIGxvYW4uc3RhdHVzICE9IFN0YXR1cy5wYWlkKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbG9hbi5sZW5kZXIgfHwgbXNnLnNlbmRlciA9PSBsb2FuLmFwcHJvdmVkVHJhbnNmZXIpOwogICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgbG9hbi5sZW5kZXIgPSB0bzsKICAgICAgICBsb2FuLmFwcHJvdmVkVHJhbnNmZXIgPSBhZGRyZXNzKDApOwoKICAgICAgICAvLyBFUkM3MjEsIHRyYW5zZmVyIGxvYW4gdG8gYW5vdGhlciBhZGRyZXNzCiAgICAgICAgbGVuZGVyc0JhbGFuY2VbbXNnLnNlbmRlcl0gLT0gMTsKICAgICAgICBsZW5kZXJzQmFsYW5jZVt0b10gKz0gMTsKICAgICAgICBUcmFuc2Zlcihsb2FuLmxlbmRlciwgdG8sIGluZGV4KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBUcmFuc2ZlcnMgdGhlIGxvYW4gdG8gdGhlIG1zZy5zZW5kZXIsIHRoZSBtc2cuc2VuZGVyIG11c3QgYmUgYXBwcm92ZWQgdXNpbmcgdGhlICJhcHByb3ZlIiBtZXRob2QuCgogICAgICAgIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZQoKICAgICAgICBAcGFyYW0gX2luZGV4IEluZGV4IG9mIHRoZSBsb2FuCgogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWxsCiAgICAqLwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF9pbmRleCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXIobXNnLnNlbmRlciwgX2luZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFRyYW5zZmVycyB0aGUgbG9hbiB0byBhbiBhZGRyZXNzLCBvbmx5IGlmIHRoZSBjdXJyZW50IG93bmVyIGlzIHRoZSAiZnJvbSIgYWRkcmVzcwoKICAgICAgICBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKCiAgICAgICAgQHBhcmFtIGZyb20gQ3VycmVudCBvd25lciBvZiB0aGUgbG9hbgogICAgICAgIEBwYXJhbSB0byBOZXcgb3duZXIgb2YgdGhlIGxvYW4KICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bGwKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobG9hbnNbaW5kZXhdLmxlbmRlciA9PSBmcm9tKTsKICAgICAgICByZXR1cm4gdHJhbnNmZXIodG8sIGluZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIEFwcHJvdmVzIHRoZSB0cmFuc2ZlciBvZiBhIGdpdmVuIGxvYW4gaW4gdGhlIG5hbWUgb2YgdGhlIGxlbmRlciwgdGhlIGJlaGF2aW9yIG9mIHRoaXMgZnVuY3Rpb24gaXMgc2ltaWxhciB0bwogICAgICAgICJhcHByb3ZlIiBpbiB0aGUgRVJDMjAgc3RhbmRhcmQsIGJ1dCBvbmx5IG9uZSBhcHByb3ZlZCBhZGRyZXNzIGlzIGFsbG93ZWQgYXQgYSB0aW1lLgoKICAgICAgICBUaGUgc2FtZSBtZXRob2QgY2FuIGJlIGNhbGxlZCBwYXNzaW5nIDB4MCBhcyBwYXJhbWV0ZXIgInRvIiB0byBlcmFzZSBhIHByZXZpb3VzbHkgYXBwcm92ZWQgYWRkcmVzcy4KCiAgICAgICAgQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCgogICAgICAgIEBwYXJhbSB0byBBZGRyZXNzIGFsbG93ZWQgdG8gdHJhbnNmZXIgdGhlIGxvYW4gb3IgMHgwIHRvIGRlbGV0ZQogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgoKICAgICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIGFwcHJvdmUgd2FzIGRvbmUgc3VjY2Vzc2Z1bGx5CiAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHRvLCB1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIExvYW4gc3RvcmFnZSBsb2FuID0gbG9hbnNbaW5kZXhdOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBsb2FuLmxlbmRlcik7CiAgICAgICAgbG9hbi5hcHByb3ZlZFRyYW5zZmVyID0gdG87CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgdG8sIGluZGV4KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIFJldHVybnMgdGhlIHBlbmRpbmcgYW1vdW50IHRvIGNvbXBsZXRlIGRlIHBheW1lbnQgb2YgdGhlIGxvYW4sIGtlZXAgaW4gbWluZCB0aGF0IHRoaXMgbnVtYmVyIGluY3JlYXNlcyAKICAgICAgICBldmVyeSBzZWNvbmQuCgogICAgICAgIEBkZXYgVGhpcyBtZXRob2QgYWxzbyBjb21wdXRlcyB0aGUgaW50ZXJlc3QgYW5kIHVwZGF0ZXMgdGhlIGxvYW4KCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCgogICAgICAgIEByZXR1cm4gQXByb3ggcGVuZGluZyBwYXltZW50IGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGdldFBlbmRpbmdBbW91bnQodWludCBpbmRleCkgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhZGRJbnRlcmVzdChpbmRleCk7CiAgICAgICAgcmV0dXJuIGdldFJhd1BlbmRpbmdBbW91bnQoaW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgUmV0dXJucyB0aGUgcGVuZGluZyBhbW91bnQgdXAgdG8gdGhlIGxhc3QgdGltZSBvZiB0aGUgaW50ZXJlc3QgdXBkYXRlLiBUaGlzIGlzIG5vdCB0aGUgcmVhbCBwZW5kaW5nIGFtb3VudAoKICAgICAgICBAZGV2IFRoaXMgbWV0aG9kIGlzIGV4YWN0IG9ubHkgaWYgImFkZEludGVyZXN0KGxvYW4pIiB3YXMgYmVmb3JlIGFuZCBpbiB0aGUgc2FtZSBibG9jay4KCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCgogICAgICAgIEByZXR1cm4gVGhlIHBhc3QgcGVuZGluZyBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRSYXdQZW5kaW5nQW1vdW50KHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBMb2FuIG1lbW9yeSBsb2FuID0gbG9hbnNbaW5kZXhdOwogICAgICAgIHJldHVybiBzYWZlU3VidHJhY3Qoc2FmZUFkZChzYWZlQWRkKGxvYW4uYW1vdW50LCBsb2FuLmludGVyZXN0KSwgbG9hbi5wdW5pdG9yeUludGVyZXN0KSwgbG9hbi5wYWlkKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIENhbGN1bGF0ZXMgdGhlIGludGVyZXN0IG9mIGEgZ2l2ZW4gYW1vdW50LCBpbnRlcmVzdCByYXRlIGFuZCBkZWx0YSB0aW1lLgoKICAgICAgICBAcGFyYW0gdGltZURlbHRhIEVsYXBzZWQgdGltZQogICAgICAgIEBwYXJhbSBpbnRlcmVzdFJhdGUgSW50ZXJlc3QgcmF0ZSBleHByZXNzZWQgYXMgdGhlIGRlbm9taW5hdG9yIG9mIDEwIDAwMCAwMDAuCiAgICAgICAgQHBhcmFtIGFtb3VudCBBbW91bnQgdG8gYXBwbHkgaW50ZXJlc3QKCiAgICAgICAgQHJldHVybiByZWFsRGVsdGEgVGhlIHJlYWwgdGltZURlbHRhIGFwcGxpZWQKICAgICAgICBAcmV0dXJuIGludGVyZXN0IFRoZSBpbnRlcmVzdCBnYWluZWQgaW4gdGhlIHJlYWxEZWx0YSB0aW1lCiAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlSW50ZXJlc3QodWludDI1NiB0aW1lRGVsdGEsIHVpbnQyNTYgaW50ZXJlc3RSYXRlLCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2IHJlYWxEZWx0YSwgdWludDI1NiBpbnRlcmVzdCkgewogICAgICAgIGlmIChhbW91bnQgPT0gMCkgewogICAgICAgICAgICBpbnRlcmVzdCA9IDA7CiAgICAgICAgICAgIHJlYWxEZWx0YSA9IHRpbWVEZWx0YTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpbnRlcmVzdCA9IHNhZmVNdWx0KHNhZmVNdWx0KDEwMDAwMCwgYW1vdW50KSwgdGltZURlbHRhKSAvIGludGVyZXN0UmF0ZTsKICAgICAgICAgICAgcmVhbERlbHRhID0gc2FmZU11bHQoaW50ZXJlc3QsIGludGVyZXN0UmF0ZSkgLyAoYW1vdW50ICogMTAwMDAwKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBDb21wdXRlcyBsb2FuIGludGVyZXN0CgogICAgICAgIENvbXB1dGVzIHRoZSBwdW5pdG9yeSBhbmQgbm9uLXB1bml0b3J5IGludGVyZXN0IG9mIGEgZ2l2ZW4gbG9hbiBhbmQgb25seSBhcHBsaWVzIHRoZSBjaGFuZ2UuCiAgICAgICAgCiAgICAgICAgQHBhcmFtIGxvYW4gTG9hbiB0byBjb21wdXRlIGludGVyZXN0CiAgICAgICAgQHBhcmFtIHRpbWVzdGFtcCBUYXJnZXQgYWJzb2x1dGUgdW5peCB0aW1lIHRvIGNhbGN1bGF0ZSBpbnRlcmVzdC4KICAgICovCiAgICBmdW5jdGlvbiBpbnRlcm5hbEFkZEludGVyZXN0KExvYW4gc3RvcmFnZSBsb2FuLCB1aW50MjU2IHRpbWVzdGFtcCkgaW50ZXJuYWwgewogICAgICAgIGlmICh0aW1lc3RhbXAgPiBsb2FuLmludGVyZXN0VGltZXN0YW1wKSB7CiAgICAgICAgICAgIHVpbnQyNTYgbmV3SW50ZXJlc3QgPSBsb2FuLmludGVyZXN0OwogICAgICAgICAgICB1aW50MjU2IG5ld1B1bml0b3J5SW50ZXJlc3QgPSBsb2FuLnB1bml0b3J5SW50ZXJlc3Q7CgogICAgICAgICAgICB1aW50MjU2IG5ld1RpbWVzdGFtcDsKICAgICAgICAgICAgdWludDI1NiByZWFsRGVsdGE7CiAgICAgICAgICAgIHVpbnQyNTYgY2FsY3VsYXRlZEludGVyZXN0OwoKICAgICAgICAgICAgdWludDI1NiBkZWx0YVRpbWU7CiAgICAgICAgICAgIHVpbnQyNTYgcGVuZGluZzsKCiAgICAgICAgICAgIHVpbnQyNTYgZW5kTm9uUHVuaXRvcnkgPSBtaW4odGltZXN0YW1wLCBsb2FuLmR1ZVRpbWUpOwogICAgICAgICAgICBpZiAoZW5kTm9uUHVuaXRvcnkgPiBsb2FuLmludGVyZXN0VGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICBkZWx0YVRpbWUgPSBlbmROb25QdW5pdG9yeSAtIGxvYW4uaW50ZXJlc3RUaW1lc3RhbXA7CgogICAgICAgICAgICAgICAgaWYgKGxvYW4ucGFpZCA8IGxvYW4uYW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgcGVuZGluZyA9IGxvYW4uYW1vdW50IC0gbG9hbi5wYWlkOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nID0gMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAocmVhbERlbHRhLCBjYWxjdWxhdGVkSW50ZXJlc3QpID0gY2FsY3VsYXRlSW50ZXJlc3QoZGVsdGFUaW1lLCBsb2FuLmludGVyZXN0UmF0ZSwgcGVuZGluZyk7CiAgICAgICAgICAgICAgICBuZXdJbnRlcmVzdCA9IHNhZmVBZGQoY2FsY3VsYXRlZEludGVyZXN0LCBuZXdJbnRlcmVzdCk7CiAgICAgICAgICAgICAgICBuZXdUaW1lc3RhbXAgPSBsb2FuLmludGVyZXN0VGltZXN0YW1wICsgcmVhbERlbHRhOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGltZXN0YW1wID4gbG9hbi5kdWVUaW1lKSB7CiAgICAgICAgICAgICAgICB1aW50MjU2IHN0YXJ0UHVuaXRvcnkgPSBtYXgobG9hbi5kdWVUaW1lLCBsb2FuLmludGVyZXN0VGltZXN0YW1wKTsKICAgICAgICAgICAgICAgIGRlbHRhVGltZSA9IHRpbWVzdGFtcCAtIHN0YXJ0UHVuaXRvcnk7CgogICAgICAgICAgICAgICAgdWludDI1NiBkZWJ0ID0gc2FmZUFkZChsb2FuLmFtb3VudCwgbmV3SW50ZXJlc3QpOwogICAgICAgICAgICAgICAgcGVuZGluZyA9IG1pbihkZWJ0LCBzYWZlU3VidHJhY3Qoc2FmZUFkZChkZWJ0LCBuZXdQdW5pdG9yeUludGVyZXN0KSwgbG9hbi5wYWlkKSk7CgogICAgICAgICAgICAgICAgKHJlYWxEZWx0YSwgY2FsY3VsYXRlZEludGVyZXN0KSA9IGNhbGN1bGF0ZUludGVyZXN0KGRlbHRhVGltZSwgbG9hbi5pbnRlcmVzdFJhdGVQdW5pdG9yeSwgcGVuZGluZyk7CiAgICAgICAgICAgICAgICBuZXdQdW5pdG9yeUludGVyZXN0ID0gc2FmZUFkZChuZXdQdW5pdG9yeUludGVyZXN0LCBjYWxjdWxhdGVkSW50ZXJlc3QpOwogICAgICAgICAgICAgICAgbmV3VGltZXN0YW1wID0gc3RhcnRQdW5pdG9yeSArIHJlYWxEZWx0YTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKG5ld0ludGVyZXN0ICE9IGxvYW4uaW50ZXJlc3QgfHwgbmV3UHVuaXRvcnlJbnRlcmVzdCAhPSBsb2FuLnB1bml0b3J5SW50ZXJlc3QpIHsKICAgICAgICAgICAgICAgIGxvYW4uaW50ZXJlc3RUaW1lc3RhbXAgPSBuZXdUaW1lc3RhbXA7CiAgICAgICAgICAgICAgICBsb2FuLmludGVyZXN0ID0gbmV3SW50ZXJlc3Q7CiAgICAgICAgICAgICAgICBsb2FuLnB1bml0b3J5SW50ZXJlc3QgPSBuZXdQdW5pdG9yeUludGVyZXN0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgVXBkYXRlcyB0aGUgbG9hbiBhY2N1bXVsYXRlZCBpbnRlcmVzdHMgdXAgdG8gdGhlIGN1cnJlbnQgVW5peCB0aW1lLgogICAgICAgIAogICAgICAgIEBwYXJhbSBpbmRleCBJbmRleCBvZiB0aGUgbG9hbgogICAgCiAgICAgICAgQHJldHVybiB0cnVlIElmIHRoZSBpbnRlcmVzdCB3YXMgdXBkYXRlZAogICAgKi8KICAgIGZ1bmN0aW9uIGFkZEludGVyZXN0KHVpbnQgaW5kZXgpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tpbmRleF07CiAgICAgICAgcmVxdWlyZShsb2FuLnN0YXR1cyA9PSBTdGF0dXMubGVudCk7CiAgICAgICAgaW50ZXJuYWxBZGRJbnRlcmVzdChsb2FuLCBibG9jay50aW1lc3RhbXApOwogICAgfQogICAgCiAgICAvKioKICAgICAgICBAbm90aWNlIFBheSBsb2FuCgogICAgICAgIERvZXMgYSBwYXltZW50IG9mIGEgZ2l2ZW4gTG9hbiwgYmVmb3JlIHBlcmZvcm1pbmcgdGhlIHBheW1lbnQgdGhlIGFjY3VtdWxhdGVkCiAgICAgICAgaW50ZXJlc3QgaXMgY29tcHV0ZWQgYW5kIGFkZGVkIHRvIHRoZSB0b3RhbCBwZW5kaW5nIGFtb3VudC4KCiAgICAgICAgQmVmb3JlIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiwgdGhlIG1zZy5zZW5kZXIgbXVzdCBjYWxsIHRoZSAiYXBwcm92ZSIgZnVuY3Rpb24gb24gdGhlIFJDTiBUb2tlbiwgc3BlY2lmeWluZyBhbiBhbW91bnQKICAgICAgICBzdWZmaWNpZW50IGVub3VnaCB0byBwYXkgdGhlIGVxdWl2YWxlbnQgb2YgdGhlIGRlc2lyZWQgcGF5bWVudCBhbmQgdGhlIG9yYWNsZSBmZWUuCgogICAgICAgIElmIHRoZSBwYWlkIHBlbmRpbmcgYW1vdW50IGVxdWFscyB6ZXJvLCB0aGUgbG9hbiBjaGFuZ2VzIHN0YXR1cyB0byAicGFpZCIgYW5kIGl0IGlzIGNvbnNpZGVyZWQgY2xvc2VkLgoKICAgICAgICBAZGV2IEJlY2F1c2UgaXQgaXMgZGlmZmljdWx0IG9yIGV2ZW4gaW1wb3NzaWJsZSB0byBrbm93IGluIGFkdmFuY2UgaG93IG11Y2ggUkNOIGFyZSBnb2luZyB0byBiZSBzcGVudCBvbiB0aGUKICAgICAgICB0cmFuc2FjdGlvbiosIHdlIHJlY29tbWVuZCBwZXJmb3JtaW5nIHRoZSAiYXBwcm92ZSIgdXNpbmcgYW4gYW1vdW50IDUlIHN1cGVyaW9yIHRvIHRoZSB3YWxsZXQgZXN0aW1hdGVkCiAgICAgICAgc3BlbmRpbmcuIElmIHRoZSBSQ04gc3BlbnQgcmVzdWx0cyB0byBiZSBsZXNzLCB0aGUgZXh0cmEgdG9rZW5zIGFyZSBuZXZlciBkZWJpdGVkIGZyb20gdGhlIG1zZy5zZW5kZXIuCgogICAgICAgICogVGhlIFJDTiByYXRlIGNhbiBmbHVjdHVhdGUgb24gdGhlIHNhbWUgYmxvY2ssIGFuZCBpdCBpcyBpbXBvc3NpYmxlIHRvIGtub3cgaW4gYWR2YW5jZSB0aGUgZXhhY3QgdGltZSBvZiB0aGUKICAgICAgICBjb25maXJtYXRpb24gb2YgdGhlIHRyYW5zYWN0aW9uLiAKCiAgICAgICAgQHBhcmFtIGluZGV4IEluZGV4IG9mIHRoZSBsb2FuCiAgICAgICAgQHBhcmFtIF9hbW91bnQgQW1vdW50IHRvIHBheSwgc3BlY2lmaWVkIGluIHRoZSBsb2FuIGN1cnJlbmN5OyBvciBpbiBSQ04gaWYgdGhlIGxvYW4gaGFzIG5vIG9yYWNsZQogICAgICAgIEBwYXJhbSBfZnJvbSBUaGUgaWRlbnRpdHkgb2YgdGhlIHBheWVyCiAgICAgICAgQHBhcmFtIG9yYWNsZURhdGEgRGF0YSByZXF1aXJlZCBieSB0aGUgb3JhY2xlIHRvIHJldHVybiB0aGUgcmF0ZSwgdGhlIGNvbnRlbnQgb2YgdGhpcyBmaWVsZCBtdXN0IGJlIHByb3ZpZGVkCiAgICAgICAgICAgIGJ5IHRoZSB1cmwgZXhwb3NlZCBpbiB0aGUgdXJsKCkgbWV0aG9kIG9mIHRoZSBvcmFjbGUuCiAgICAgICAgICAgIAogICAgICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgcGF5bWVudCB3YXMgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5CiAgICAqLwogICAgZnVuY3Rpb24gcGF5KHVpbnQgaW5kZXgsIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcyBfZnJvbSwgYnl0ZXMgb3JhY2xlRGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBMb2FuIHN0b3JhZ2UgbG9hbiA9IGxvYW5zW2luZGV4XTsKCiAgICAgICAgcmVxdWlyZShsb2FuLnN0YXR1cyA9PSBTdGF0dXMubGVudCk7CiAgICAgICAgYWRkSW50ZXJlc3QoaW5kZXgpOwogICAgICAgIHVpbnQyNTYgdG9QYXkgPSBtaW4oZ2V0UGVuZGluZ0Ftb3VudChpbmRleCksIF9hbW91bnQpOwogICAgICAgIFBhcnRpYWxQYXltZW50KGluZGV4LCBtc2cuc2VuZGVyLCBfZnJvbSwgdG9QYXkpOwoKICAgICAgICBsb2FuLnBhaWQgPSBzYWZlQWRkKGxvYW4ucGFpZCwgdG9QYXkpOwoKICAgICAgICBpZiAoZ2V0UmF3UGVuZGluZ0Ftb3VudChpbmRleCkgPT0gMCkgewogICAgICAgICAgICBUb3RhbFBheW1lbnQoaW5kZXgpOwogICAgICAgICAgICBsb2FuLnN0YXR1cyA9IFN0YXR1cy5wYWlkOwoKICAgICAgICAgICAgLy8gRVJDNzIxLCByZW1vdmUgbG9hbiBmcm9tIGNpcmN1bGF0aW9uCiAgICAgICAgICAgIGxlbmRlcnNCYWxhbmNlW2xvYW4ubGVuZGVyXSAtPSAxOwogICAgICAgICAgICBhY3RpdmVMb2FucyAtPSAxOwogICAgICAgICAgICBUcmFuc2Zlcihsb2FuLmxlbmRlciwgMHgwLCBpbmRleCk7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IHRyYW5zZmVyVmFsdWUgPSBjb252ZXJ0UmF0ZShsb2FuLm9yYWNsZSwgbG9hbi5jdXJyZW5jeSwgb3JhY2xlRGF0YSwgdG9QYXkpOwogICAgICAgIHJlcXVpcmUodHJhbnNmZXJWYWx1ZSA+IDAgfHwgdG9QYXkgPCBfYW1vdW50KTsKCiAgICAgICAgbG9ja1Rva2VucyhyY24sIHRyYW5zZmVyVmFsdWUpOwogICAgICAgIHJlcXVpcmUocmNuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCB0cmFuc2ZlclZhbHVlKSk7CiAgICAgICAgbG9hbi5sZW5kZXJCYWxhbmNlID0gc2FmZUFkZCh0cmFuc2ZlclZhbHVlLCBsb2FuLmxlbmRlckJhbGFuY2UpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAbm90aWNlIENvbnZlcnRzIGFuIGFtb3VudCB0byBSQ04gdXNpbmcgdGhlIGxvYW4gb3JhY2xlLgogICAgICAgIAogICAgICAgIEBkZXYgSWYgdGhlIGxvYW4gaGFzIG5vIG9yYWNsZSB0aGUgY3VycmVuY3kgbXVzdCBiZSBSQ04gc28gdGhlIHJhdGUgaXMgMQoKICAgICAgICBAcmV0dXJuIFRoZSByZXN1bHQgb2YgdGhlIGNvbnZlcnRpb24KICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0UmF0ZShPcmFjbGUgb3JhY2xlLCBieXRlczMyIGN1cnJlbmN5LCBieXRlcyBkYXRhLCB1aW50MjU2IGFtb3VudCkgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAob3JhY2xlID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2IHJhdGU7CiAgICAgICAgICAgIHVpbnQyNTYgZGVjaW1hbHM7CiAgICAgICAgICAgIAogICAgICAgICAgICAocmF0ZSwgZGVjaW1hbHMpID0gb3JhY2xlLmdldFJhdGUoY3VycmVuY3ksIGRhdGEpOwoKICAgICAgICAgICAgcmVxdWlyZShkZWNpbWFscyA8PSBNQVhfREVDSU1BTFMpOwogICAgICAgICAgICByZXR1cm4gKHNhZmVNdWx0KHNhZmVNdWx0KGFtb3VudCwgcmF0ZSksICgxMCoqZGVjaW1hbHMpKSkgLyBQUkVDSVNJT047CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgV2l0aGRyYXcgbGVuZGVyIGZ1bmRzCgogICAgICAgIFdoZW4gYSBsb2FuIGlzIHBhaWQsIHRoZSBmdW5kcyBhcmUgbm90IHRyYW5zZmVycmVkIGF1dG9tYXRpY2FsbHkgdG8gdGhlIGxlbmRlciwgdGhlIGZ1bmRzIGFyZSBzdG9yZWQgb24gdGhlCiAgICAgICAgZW5naW5lIGNvbnRyYWN0LCBhbmQgdGhlIGxlbmRlciBtdXN0IGNhbGwgdGhpcyBmdW5jdGlvbiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgZGVzaXJlZCB0byB0cmFuc2ZlciBhbmQgdGhlIAogICAgICAgIGRlc3RpbmF0aW9uLgoKICAgICAgICBAZGV2IFRoaXMgYmVoYXZpb3IgaXMgZGVmaW5lZCB0byBhbGxvdyB0aGUgdGVtcG9yYXJ5IHRyYW5zZmVyIG9mIHRoZSBsb2FuIHRvIGEgc21hcnQgY29udHJhY3QsIHdpdGhvdXQgd29ycnlpbmcgdGhhdAogICAgICAgIHRoZSBjb250cmFjdCB3aWxsIHJlY2VpdmUgdG9rZW5zIHRoYXQgYXJlIG5vdCB0cmFjZWFibGU7IGFuZCBpdCBhbGxvd3MgdGhlIGRldmVsb3BtZW50IG9mIGRlY2VudHJhbGl6ZWQgCiAgICAgICAgYXV0b25vbW91cyBvcmdhbml6YXRpb25zLgoKICAgICAgICBAcGFyYW0gaW5kZXggSW5kZXggb2YgdGhlIGxvYW4KICAgICAgICBAcGFyYW0gdG8gRGVzdGluYXRpb24gb2YgdGhlIHdpd3RoZHJhdyBmdW5kcwogICAgICAgIEBwYXJhbSBhbW91bnQgQW1vdW50IHRvIHdpdGhkcmF3LCBpbiBSQ04KCiAgICAgICAgQHJldHVybiB0cnVlIGlmIHRoZSB3aXRoZHJhdyB3YXMgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5CiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdhbCh1aW50IGluZGV4LCBhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBMb2FuIHN0b3JhZ2UgbG9hbiA9IGxvYW5zW2luZGV4XTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbG9hbi5sZW5kZXIpOwogICAgICAgIGxvYW4ubGVuZGVyQmFsYW5jZSA9IHNhZmVTdWJ0cmFjdChsb2FuLmxlbmRlckJhbGFuY2UsIGFtb3VudCk7CiAgICAgICAgcmVxdWlyZShyY24udHJhbnNmZXIodG8sIGFtb3VudCkpOwogICAgICAgIHVubG9ja1Rva2VucyhyY24sIGFtb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQG5vdGljZSBXaXRoZHJhdyBsZW5kZXIgZnVuZHMgaW4gYmF0Y2gsIGl0IHdhbGtzIGJ5IGFsbCB0aGUgbG9hbnMgYmV0d2VlbiB0aGUgdHdvIGluZGV4LCBhbmQgd2l0aGRyYXdzIGFsbAogICAgICAgIHRoZSBmdW5kcyBzdG9yZWQgb24gdGhhdCBsb2Fucy4KCiAgICAgICAgQGRldiBUaGlzIGJhdGNoIHdpdGhkcmF3IG1ldGhvZCBjYW4gYmUgZXhwZW5zaXZlIGluIGdhcywgaXQgbXVzdCBiZSB1c2VkIHdpdGggY2FyZS4KCiAgICAgICAgQHBhcmFtIGZyb21JbmRleCBTdGFydCBpbmRleCBvZiB0aGUgc2VhcmNoCiAgICAgICAgQHBhcmFtIHRvSW5kZXggRW5kIGluZGV4IG9mIHRoZSBzZWFyY2gKICAgICAgICBAcGFyYW0gdG8gRGVzdGluYXRpb24gb2YgdGhlIHRva2VucwoKICAgICAgICBAcmV0dXJuIHRoZSB0b3RhbCB3aXRoZHJhd2VkIAogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3YWxSYW5nZSh1aW50MjU2IGZyb21JbmRleCwgdWludDI1NiB0b0luZGV4LCBhZGRyZXNzIHRvKSBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgbG9hbklkOwogICAgICAgIHVpbnQyNTYgdG90YWxXaXRoZHJhdyA9IDA7CgogICAgICAgIGZvciAobG9hbklkID0gZnJvbUluZGV4OyBsb2FuSWQgPD0gdG9JbmRleDsgbG9hbklkKyspIHsKICAgICAgICAgICAgTG9hbiBzdG9yYWdlIGxvYW4gPSBsb2Fuc1tsb2FuSWRdOwogICAgICAgICAgICBpZiAobG9hbi5sZW5kZXIgPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICAgICAgdG90YWxXaXRoZHJhdyArPSBsb2FuLmxlbmRlckJhbGFuY2U7CiAgICAgICAgICAgICAgICBsb2FuLmxlbmRlckJhbGFuY2UgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKHJjbi50cmFuc2Zlcih0bywgdG90YWxXaXRoZHJhdykpOwogICAgICAgIHVubG9ja1Rva2VucyhyY24sIHRvdGFsV2l0aGRyYXcpOwogICAgICAgIAogICAgICAgIHJldHVybiB0b3RhbFdpdGhkcmF3OwogICAgfQoKICAgIC8qKgogICAgICAgIEBub3RpY2UgV2l0aGRyYXcgbGVuZGVyIGZ1bmRzIGluIGJhdGNoLCBpdCB3YWxrcyBieSBhbGwgdGhlIGxvYW5zIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24gYW5kIHdpdGhkcmF3cyBhbGwKICAgICAgICB0aGUgZnVuZHMgc3RvcmVkIG9uIHRoYXQgbG9hbnMuCgogICAgICAgIEBkZXYgVGhpcyBiYXRjaCB3aXRoZHJhdyBtZXRob2QgY2FuIGJlIGV4cGVuc2l2ZSBpbiBnYXMsIGl0IG11c3QgYmUgdXNlZCB3aXRoIGNhcmUuCgogICAgICAgIEBwYXJhbSBsb2FuSWRzIEFycmF5IG9mIHRoZSBsb2FucyB0byB3aXRoZHJhdwogICAgICAgIEBwYXJhbSB0byBEZXN0aW5hdGlvbiBvZiB0aGUgdG9rZW5zCgogICAgICAgIEByZXR1cm4gdGhlIHRvdGFsIHdpdGhkcmF3ZWQgCiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdhbExpc3QodWludDI1NltdIG1lbW9yeSBsb2FuSWRzLCBhZGRyZXNzIHRvKSBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgaW5wdXRJZDsKICAgICAgICB1aW50MjU2IHRvdGFsV2l0aGRyYXcgPSAwOwoKICAgICAgICBmb3IgKGlucHV0SWQgPSAwOyBpbnB1dElkIDwgbG9hbklkcy5sZW5ndGg7IGlucHV0SWQrKykgewogICAgICAgICAgICBMb2FuIHN0b3JhZ2UgbG9hbiA9IGxvYW5zW2xvYW5JZHNbaW5wdXRJZF1dOwogICAgICAgICAgICBpZiAobG9hbi5sZW5kZXIgPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICAgICAgdG90YWxXaXRoZHJhdyArPSBsb2FuLmxlbmRlckJhbGFuY2U7CiAgICAgICAgICAgICAgICBsb2FuLmxlbmRlckJhbGFuY2UgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKHJjbi50cmFuc2Zlcih0bywgdG90YWxXaXRoZHJhdykpOwogICAgICAgIHVubG9ja1Rva2VucyhyY24sIHRvdGFsV2l0aGRyYXcpOwoKICAgICAgICByZXR1cm4gdG90YWxXaXRoZHJhdzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IERlcHJlY2F0ZXMgdGhlIGVuZ2luZSwgbG9ja3MgdGhlIGNyZWF0aW9uIG9mIG5ldyBsb2Fucy4KICAgICovCiAgICBmdW5jdGlvbiBzZXREZXByZWNhdGVkKGJvb2wgX2RlcHJlY2F0ZWQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGRlcHJlY2F0ZWQgPSBfZGVwcmVjYXRlZDsKICAgIH0KfQ=='.
	

]
