Class {
	#name : #SRTc4a21f9a38b813b2c8e3f2e01c8d7547a99ed2b7,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc4a21f9a38b813b2c8e3f2e01c8d7547a99ed2b7 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgoKY29udHJhY3QgRVJDNzIxIHsKICAgIC8vIFJlcXVpcmVkIG1ldGhvZHMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRCZW5lZmljaWFyeSgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzKTsKfQoKY29udHJhY3QgR2VuZXJhdG9ySW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiBpc0dlbmVyYXRvcigpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAZGV2IGdlbmVyYXRlIG5ldyB3YXJyaW9yIGdlbmVzCiAgICAvLy8gQHBhcmFtIF9oZXJvR2VuZXMgR2VuZXMgb2Ygd2FycmlvciB0aGF0IGhhdmUgY29tcGxldGVkIGR1bmdlb24KICAgIC8vLyBAcGFyYW0gX2hlcm9MZXZlbCBMZXZlbCBvZiB0aGUgd2FycmlvcgogICAgLy8vIEByZXR1cm4gdGhlIGdlbmVzIHRoYXQgYXJlIHN1cHBvc2VkIHRvIGJlIHBhc3NlZCBkb3duIHRvIG5ld2x5IGFyaXNlbiB3YXJyaW9yCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVdhcnJpb3IodWludDI1NiBfaGVyb0dlbmVzLCB1aW50MjU2IF9oZXJvTGV2ZWwsIHVpbnQyNTYgX3RhcmdldEJsb2NrLCB1aW50MjU2IF9wZXJrSWQpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKfQoKY29udHJhY3QgUFZQSW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiBpc1BWUFByb3ZpZGVyKCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKTsKICAgIAogICAgZnVuY3Rpb24gYWRkVG91cm5hbWVudENvbnRlbmRlcihhZGRyZXNzIF9vd25lciwgdWludDI1NltdIF90b3VybmFtZW50RGF0YSkgZXh0ZXJuYWwgcGF5YWJsZTsKICAgIGZ1bmN0aW9uIGdldFRvdXJuYW1lbnRUaHJlc2hvbGRGZWUoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpOwogICAgCiAgICBmdW5jdGlvbiBhZGRQVlBDb250ZW5kZXIoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3BhY2tlZFdhcnJpb3IpIGV4dGVybmFsIHBheWFibGU7CiAgICBmdW5jdGlvbiBnZXRQVlBFbnRyYW5jZUZlZSh1aW50MjU2IF9sZXZlbFBvaW50cykgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpOwp9Cgpjb250cmFjdCBQVlBMaXN0ZW5lckludGVyZmFjZSB7CgogICAgZnVuY3Rpb24gaXNQVlBMaXN0ZW5lcigpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0QmVuZWZpY2lhcnkoKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYWRkcmVzcyk7CiAgICAKICAgIGZ1bmN0aW9uIHB2cEZpbmlzaGVkKHVpbnQyNTZbXSB3YXJyaW9yRGF0YSwgdWludDI1NiBtYXRjaGluZ0NvdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBwdnBDb250ZW5kZXJSZW1vdmVkKHVpbnQzMiBfd2FycmlvcklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiB0b3VybmFtZW50RmluaXNoZWQodWludDI1NltdIHBhY2tlZENvbnRlbmRlcnMpIHB1YmxpYzsKfQoKLy8gLSBUaGUgQWRtaW46IFRoZSBBZG1pbiBwZXJmb3JtcyBhZG1pbmlzdHJhdGl2ZSBmdW5jdGlvbnMsIHN1Y2ggYXMgcGF1c2UsIHVucGF1c2UsIGNoYW5nZSBkZXBlbmRlbnQgY29udHJhY3RzCi8vIGNvbnRyYWN0cy4KLy8KLy8gLSBUaGUgQmFuazogdGhlIGJlbmVmaWNpYXJ5IG9mIGFsbCBjb250cmFjdHMKLy8KLy8gLSBUaGUgSXNzdWVyOiBUaGUgSXNzdWVyIGNhbiByZWxlYXNlIG1pbmVyIHdhcnJpb3JzIHRvIGF1Y3Rpb24uCmNvbnRyYWN0IFBlcm1pc3Npb25Db250cm9sbCB7CgogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwogICAgCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdDb250cmFjdEFkZHJlc3M7CgogICAgYWRkcmVzcyBwdWJsaWMgYWRtaW5BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgYmFua0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBpc3N1ZXJBZGRyZXNzOyAKCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKICAgIAoKICAgIG1vZGlmaWVyIG9ubHlBZG1pbigpewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZG1pbkFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUJhbmsoKXsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYmFua0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlJc3N1ZXIoKXsKICAgIAkJcmVxdWlyZShtc2cuc2VuZGVyID09IGlzc3VlckFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlBdXRob3JpemVkKCl7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGlzc3VlckFkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBhZG1pbkFkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBiYW5rQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCgogICAgZnVuY3Rpb24gc2V0QmFuayhhZGRyZXNzIF9uZXdCYW5rKSBleHRlcm5hbCBvbmx5QmFuayB7CiAgICAgICAgcmVxdWlyZShfbmV3QmFuayAhPSBhZGRyZXNzKDApKTsKICAgICAgICBiYW5rQWRkcmVzcyA9IF9uZXdCYW5rOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEFkbWluKGFkZHJlc3MgX25ld0FkbWluKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluQWRkcmVzcyB8fCBtc2cuc2VuZGVyID09IGJhbmtBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKF9uZXdBZG1pbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICBhZG1pbkFkZHJlc3MgPSBfbmV3QWRtaW47CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldElzc3VlcihhZGRyZXNzIF9uZXdJc3N1ZXIpIGV4dGVybmFsIG9ubHlBZG1pbnsKICAgICAgICByZXF1aXJlKF9uZXdJc3N1ZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgaXNzdWVyQWRkcmVzcyA9IF9uZXdJc3N1ZXI7CiAgICB9CgogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCgogICAgbW9kaWZpZXIgd2hlblBhdXNlZHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlBdXRob3JpemVkIHdoZW5Ob3RQYXVzZWR7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlBZG1pbiB3aGVuUGF1c2VkewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgfQogICAgCgogICAgZnVuY3Rpb24gc2V0TmV3QWRkcmVzcyhhZGRyZXNzIF92MkFkZHJlc3MpIGV4dGVybmFsIG9ubHlBZG1pbiB3aGVuUGF1c2VkIHsKICAgICAgICBuZXdDb250cmFjdEFkZHJlc3MgPSBfdjJBZGRyZXNzOwogICAgICAgIENvbnRyYWN0VXBncmFkZShfdjJBZGRyZXNzKTsKICAgIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgICogYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpY3sKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyewogICAgICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICAgIGV2ZW50IFBhdXNlKCk7CgogICAgZXZlbnQgVW5wYXVzZSgpOwoKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKXsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5QYXVzZWR7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgICAqLwogICAgZnVuY3Rpb24gcGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IHRydWU7CiAgICAgICAgUGF1c2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAgICovCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlPd25lciB3aGVuUGF1c2VkIHsKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgICAgICBVbnBhdXNlKCk7CiAgICB9Cn0KCgpsaWJyYXJ5IERhdGFUeXBlcyB7CgogICAgc3RydWN0IFdhcnJpb3J7CiAgICAgICAgLy8gVGhlIFdhcnJpb3IncyBpZGVudGl0eSBjb2RlIGlzIHBhY2tlZCBpbnRvIHRoZXNlIDI1Ni1iaXRzCiAgICAgICAgdWludDI1NiBpZGVudGl0eTsKICAgICAgICAKICAgICAgICB1aW50NjQgY29vbGRvd25FbmRCbG9jazsKICAgICAgICAvKiogZXZlcnkgd2FycmlvcnMgc3RhcnRzIGZyb20gMSBsdiAoMTAgbGV2ZWwgcG9pbnRzIHBlciBsZXZlbCkgKi8KICAgICAgICB1aW50NjQgbGV2ZWw7CiAgICAgICAgLyoqIFBWUCByYXRpbmcsIGV2ZXJ5IHdhcnJpb3Igc3RhcnRzIHdpdGggMTAwIHJhdGluZyAqLwogICAgICAgIGludDY0IHJhdGluZzsKICAgICAgICAvLyAwIC0gaWRsZQogICAgICAgIHVpbnQzMiBhY3Rpb247CiAgICAgICAgLyoqIFNldCB0byB0aGUgaW5kZXggaW4gdGhlIGxldmVsUmVxdWlyZW1lbnRzIGFycmF5IChzZWUgQ3J5cHRvV2FycmlvckJhc2UubGV2ZWxSZXF1aXJlbWVudHMpIHRoYXQgcmVwcmVzZW50cwogICAgICAgICAqICB0aGUgY3VycmVudCBkdW5nZW9uIGxldmVsIHJlcXVpcmVtZW50IGZvciB3YXJyaW9yLiBUaGlzIHN0YXJ0cyBhdCB6ZXJvLiAqLwogICAgICAgIHVpbnQzMiBkdW5nZW9uSW5kZXg7CiAgICB9Cn0KCmNvbnRyYWN0IENyeXB0b1dhcnJpb3JCYXNlIGlzIFBlcm1pc3Npb25Db250cm9sbCwgUFZQTGlzdGVuZXJJbnRlcmZhY2UgewoKCiAgICAvLy8gQGRldiBUaGUgQXJpc2UgZXZlbnQgaXMgZmlyZWQgd2hlbiBhIG5ldyB3YXJyaW9yIGNyZWF0ZWQuCiAgICBldmVudCBBcmlzZShhZGRyZXNzIG93bmVyLCB1aW50MjU2IHdhcnJpb3JJZCwgdWludDI1NiBpZGVudGl0eSk7CgogICAgLy8vIEBkZXYgRVJDNzIxIFRyYW5zZmVyIGV2ZW50CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLyoqKiBDT05TVEFOVFMgKioqLwogICAgCgl1aW50MjU2IHB1YmxpYyBjb25zdGFudCBJRExFID0gMDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBWRV9CQVRUTEUgPSAxOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFZQX0JBVFRMRSA9IDI7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT1VSTkFNRU5UX0JBVFRMRSA9IDM7CiAgICAKICAgIC8vbWF4IHB2ZSBkdW5nZW9uIGxldmVsCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBNQVhfTEVWRUwgPSAyNTsKICAgIC8vaG93IG1hbnkgcG9pbnRzIGlzIG5lZWRlZCB0byBnZXQgMSBsZXZlbAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUE9JTlRTX1RPX0xFVkVMID0gMTA7CiAgICAKICAgIC8vLyBAZGV2IEFycmF5IGNvbnRhaW5zIFBWRSBkdW5nZW9uIGxldmVsIHJlcXVpcmVtZW50cywgZWFjaCB0aW1lIHdhcnJpb3IKICAgIC8vLyBjb21wbGV0ZXMgZHVuZ2VvbiwgbmV4dCBsZXZlbCByZXF1aXJlbWVudCBpcyBzZXQsIHVudGlsIDI1bHYgKDI1MHBvaW50cykgaXMgcmVhY2hlZC4KICAgIHVpbnQzMls2XSBwdWJsaWMgZHVuZ2VvblJlcXVpcmVtZW50cyA9IFsKICAgICAgICB1aW50MzIoMTApLAogICAgICAgIHVpbnQzMigzMCksCiAgICAgICAgdWludDMyKDYwKSwKICAgICAgICB1aW50MzIoMTAwKSwKICAgICAgICB1aW50MzIoMTUwKSwKICAgICAgICB1aW50MzIoMjUwKQogICAgXTsKCiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRzUGVyQmxvY2sgPSAxNTsKCiAgICAvKioqIFNUT1JBR0UgKioqLwoKICAgIC8vLyBAZGV2IEFuIGFycmF5IG9mIHdhcnJpb3IgdG9rZW5zCiAgICBEYXRhVHlwZXMuV2FycmlvcltdIHdhcnJpb3JzOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBvZiB3YXJyaW9yIGlkIHRvIG93bmVyIGFkZHJlc3MKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHdhcnJpb3JUb093bmVyOwoKICAgIC8vIEBkZXYgQSBtYXBwaW5nIGZyb20gb3duZXIgYWRkcmVzcyB0byB3YXJyaW9ycyBjb3VudAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBvd25lcnNUb2tlbkNvdW50OwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIHdhcnJvciBpZCB0byBhcHByb3ZlZCBhZGRyZXNzLCB0aGF0IGhhdmUgcGVybWlzc2lvbiB0byB0cmFuc2ZlciBzcGVjaWZpZWQgd2FycmlvcgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgd2FycmlvclRvQXBwcm92ZWQ7CgogICAgU2FsZUNsb2NrQXVjdGlvbiBwdWJsaWMgc2FsZUF1Y3Rpb247CiAgICAKICAgIAogICAgLy8vIEBkZXYgQXNzaWducyBvd25lcnNoaXAgb2YgYSBzcGVjaWZpYyB3YXJyaW9yIHRvIGFuIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBTaW5jZSB0aGUgbnVtYmVyIG9mIHdhcnJpb3JzIGlzIGNhcHBlZCB0byAnMSAwMDAgMDAwJyB3ZSBjYW4ndCBvdmVyZmxvdyB0aGlzCiAgICAgICAgb3duZXJzVG9rZW5Db3VudFtfdG9dKys7CiAgICAgICAgLy8gdHJhbnNmZXIgb3duZXJzaGlwCiAgICAgICAgd2FycmlvclRvT3duZXJbX3Rva2VuSWRdID0gX3RvOwogICAgICAgIC8vIFdoZW4gY3JlYXRpbmcgbmV3IHdhcnJpb3JzIF9mcm9tIGlzIDB4MCwgYnV0IHdlIGNhbid0IGFjY291bnQgdGhhdCBhZGRyZXNzLgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyc1Rva2VuQ291bnRbX2Zyb21dLS07CiAgICAgICAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICAgICAgICBkZWxldGUgd2FycmlvclRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgICAgIH0KICAgICAgICAvLyBFbWl0IHRoZSB0cmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBwYXJhbSBfaWRlbnRpdHkgVGhlIHdhcnJpb3IncyBnZW5ldGljIGNvZGUuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgaW5pdGlhbCBvd25lciBvZiB0aGlzIHdhcnJpb3IsIG11c3QgYmUgbm9uLXplcm8KICAgIC8vLyBAcGFyYW0gX2Nvb2xkb3duIHB2ZSBjb29sZG93biBibG9jayBudW1iZXIKICAgIGZ1bmN0aW9uIF9jcmVhdGVXYXJyaW9yKHVpbnQyNTYgX2lkZW50aXR5LCBhZGRyZXNzIF9vd25lciwgdWludDI1NiBfY29vbGRvd24pCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgCSAgICAKICAgICAgICBEYXRhVHlwZXMuV2FycmlvciBtZW1vcnkgX3dhcnJpb3IgPSBEYXRhVHlwZXMuV2Fycmlvcih7CiAgICAgICAgICAgIGlkZW50aXR5IDogX2lkZW50aXR5LAogICAgICAgICAgICBjb29sZG93bkVuZEJsb2NrIDogdWludDY0KF9jb29sZG93biksCiAgICAgICAgICAgIGxldmVsIDogdWludDY0KDEwKSwKICAgICAgICAgICAgcmF0aW5nIDogaW50NjQoMTAwKSwKICAgICAgICAgICAgYWN0aW9uIDogdWludDMyKElETEUpLAogICAgICAgICAgICBkdW5nZW9uSW5kZXggOiB1aW50MzIoMCkKICAgICAgICB9KTsKICAgICAgICB1aW50MjU2IG5ld1dhcnJpb3JJZCA9IHdhcnJpb3JzLnB1c2goX3dhcnJpb3IpIC0gMTsKICAgICAgICAKICAgICAgICByZXF1aXJlKG5ld1dhcnJpb3JJZCA9PSB1aW50MjU2KHVpbnQzMihuZXdXYXJyaW9ySWQpKSk7CiAgICAgICAgCiAgICAgICAgLy8gZW1pdCB0aGUgYXJpc2UgZXZlbnQKICAgICAgICBBcmlzZShfb3duZXIsIG5ld1dhcnJpb3JJZCwgX2lkZW50aXR5KTsKICAgICAgICAKICAgICAgICAvLyBlbWl0IHRoZSBUcmFuc2ZlciBldmVudAogICAgICAgIF90cmFuc2ZlcigwLCBfb3duZXIsIG5ld1dhcnJpb3JJZCk7CgogICAgICAgIHJldHVybiBuZXdXYXJyaW9ySWQ7CiAgICB9CiAgICAKCiAgICBmdW5jdGlvbiBzZXRTZWNvbmRzUGVyQmxvY2sodWludDI1NiBzZWNzKSBleHRlcm5hbCBvbmx5QXV0aG9yaXplZCB7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gc2VjczsKICAgIH0KfQoKY29udHJhY3QgV2FycmlvclRva2VuSW1wbCBpcyBDcnlwdG9XYXJyaW9yQmFzZSwgRVJDNzIxIHsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQ3J5cHRvV2FycmlvcnMiOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiQ1ciOwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID0KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCduYW1lKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N5bWJvbCgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0b3RhbFN1cHBseSgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdiYWxhbmNlT2YoYWRkcmVzcyknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ293bmVyT2YodWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndHJhbnNmZXJGcm9tKGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG9rZW5zT2ZPd25lcihhZGRyZXNzKScpKTsKCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuICgoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUpIHx8IChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gd2FycmlvclRvT3duZXJbX3Rva2VuSWRdID09IF9jbGFpbWFudDsgICAgCiAgICB9CgogICAgZnVuY3Rpb24gX293bmVyQXBwcm92ZWQoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB3YXJyaW9yVG9Pd25lcltfdG9rZW5JZF0gPT0gX2NsYWltYW50ICYmIHdhcnJpb3JUb0FwcHJvdmVkW190b2tlbklkXSA9PSBhZGRyZXNzKDApOyAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBfYXBwcm92ZWRGb3IoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB3YXJyaW9yVG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBpbnRlcm5hbCB7CiAgICAgICAgd2FycmlvclRvQXBwcm92ZWRbX3Rva2VuSWRdID0gX2FwcHJvdmVkOwogICAgfQoJCgkvLy8gQG5vdGljZSBFUkMtNzIxIG1ldGhvZC4KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewogICAgICAgIHJldHVybiBvd25lcnNUb2tlbkNvdW50W19vd25lcl07CiAgICB9CgoJLy8vIEBub3RpY2UgRVJDLTcyMSBtZXRob2QuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy9zYW5pdHkgY2hlY2sKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvL2Nhbid0IHRyYW5zZmVyIHRvIGNvcmUgY29udHJhY3QKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvL2Nhbid0IHRyYW5zZmVyIHRvIGF1Y3Rpb24gY29udHJhY3QKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHNhbGVBdWN0aW9uKSk7CgogICAgICAgIC8vIFlvdSBjYW4gb25seSBzZW5kIHlvdXIgb3duIHdhcnJpb3IuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIC8vIE9ubHkgaWRsZSB3YXJyaW9ycyBhcmUgYWxsb3dlZCAKICAgICAgICByZXF1aXJlKHdhcnJpb3JzW190b2tlbklkXS5hY3Rpb24gPT0gSURMRSk7CgogICAgICAgIC8vIGFjdHVhbGx5IHRyYW5zZmVyIHdhcnJpb3IKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgoJLy8vIEBub3RpY2UgRVJDLTcyMSBtZXRob2QuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBPbmx5IG93bmVyIGNhbiBhcHByb3ZlCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIC8vIE9ubHkgaWRsZSB3YXJyaW9ycyBhcmUgYWxsb3dlZCAKICAgICAgICByZXF1aXJlKHdhcnJpb3JzW190b2tlbklkXS5hY3Rpb24gPT0gSURMRSk7CgogICAgICAgIC8vIGFjdHVhbGx5IGFwcHJvdmUKICAgICAgICBfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCiAgICAgICAgLy8gRW1pdCBldmVudC4KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCgkvLy8gQG5vdGljZSBFUkMtNzIxIG1ldGhvZC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSB3YXJyaW9ycyAoZXhjZXB0IHZlcnkgYnJpZWZseQogICAgICAgIC8vIGFmdGVyIGEgbWluZXIgd2FycmlvciBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBDaGVjayBmb3IgYXBwcm92YWwgYW5kIHZhbGlkIG93bmVyc2hpcAogICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKICAgICAgICAvLyBPbmx5IGlkbGUgd2FycmlvcnMgYXJlIGFsbG93ZWQgCiAgICAgICAgcmVxdWlyZSh3YXJyaW9yc1tfdG9rZW5JZF0uYWN0aW9uID09IElETEUpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAgKGFsc28gY2xlYXJzIHBlbmRpbmcgYXBwcm92YWxzIGFuZCBlbWl0cyBUcmFuc2ZlciBldmVudCkuCiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBFUkMtNzIxIG1ldGhvZC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB3YXJyaW9ycy5sZW5ndGg7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRVJDLTcyMSBtZXRob2QuCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBvd25lcikKICAgIHsKICAgICAgICBvd25lciA9IHdhcnJpb3JUb093bmVyW190b2tlbklkXTsKCiAgICAgICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKDApKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBFUkMtNzIxIG1ldGhvZC4KICAgIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10gb3duZXJUb2tlbnMpIHsKICAgICAgICB1aW50MjU2IHRva2VuQ291bnQgPSBiYWxhbmNlT2YoX293bmVyKTsKCiAgICAgICAgaWYgKHRva2VuQ291bnQgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10odG9rZW5Db3VudCk7CiAgICAgICAgICAgIHVpbnQyNTYgdG90YWxXYXJyaW9ycyA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwoKICAgICAgICAgICAgdWludDI1NiB3YXJyaW9ySWQ7CgogICAgICAgICAgICBmb3IgKHdhcnJpb3JJZCA9IDA7IHdhcnJpb3JJZCA8IHRvdGFsV2FycmlvcnM7IHdhcnJpb3JJZCsrKSB7CiAgICAgICAgICAgICAgICBpZiAod2FycmlvclRvT3duZXJbd2FycmlvcklkXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gd2FycmlvcklkOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQoKfQoKY29udHJhY3QgQ3J5cHRvV2FycmlvclBWRSBpcyBXYXJyaW9yVG9rZW5JbXBsIHsKICAgIAogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBTVU1NT05JTkdfU0lDS0VORVNTID0gMTI7CiAgICAKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUFZFX0NPT0xET1dOID0gMSBob3VyczsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUFZFX0RVUkFUSU9OID0gMTUgbWludXRlczsKICAgIAogICAgCiAgICAvLy8gQG5vdGljZSBUaGUgcGF5bWVudCByZXF1aXJlZCB0byB1c2Ugc3RhcnRQVkVCYXR0bGUoKS4KICAgIHVpbnQyNTYgcHVibGljIHB2ZUJhdHRsZUZlZSA9IDEwIGZpbm5leTsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBWRV9DT01QRU5TQVRJT04gPSAyIGZpbm5leTsKICAgIAoJLy8vIEBkZXYgVGhlIGFkZHJlc3Mgb2YgY29udHJhY3QgdGhhdCBpcyB1c2VkIHRvIGltcGxlbWVudCB3YXJyaW9yIGdlbmVyYXRpb24gYWxnb3JpdGhtLgogICAgR2VuZXJhdG9ySW50ZXJmYWNlIHB1YmxpYyBnZW5lcmF0b3I7CgogICAgLyoqIEBkZXYgUFZFU3RhcnRlZCBldmVudC4gRW1pdHRlZCBldmVyeSB0aW1lIGEgd2FycmlvciBlbnRlcnMgcHZlIGJhdHRsZQogICAgICogIEBwYXJhbSBvd25lciBXYXJyaW9yIG93bmVyCiAgICAgKiAgQHBhcmFtIGR1bmdlb25JbmRleCBTdGFydGVkIGR1bmdlb24gaW5kZXggCiAgICAgKiAgQHBhcmFtIHdhcnJpb3JJZCBXYXJyaW9yIElEIHRoYXQgc3RhcnRlZCBQVkUgZHVuZ2VvbgogICAgICogIEBwYXJhbSBiYXR0bGVFbmRCbG9jayBCbG9jayBudW1iZXIsIHdoZW4gc3RhcnRlZCBQVkUgZHVuZ2VvbiB3aWxsIGJlIGNvbXBsZXRlZAogICAgICovCiAgICBldmVudCBQVkVTdGFydGVkKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgZHVuZ2VvbkluZGV4LCB1aW50MjU2IHdhcnJpb3JJZCwgdWludDI1NiBiYXR0bGVFbmRCbG9jayk7CgogICAgLyoqIEBkZXYgUFZFRmluaXNoZWQgZXZlbnQuIEVtaXR0ZWQgZXZlcnkgdGltZSBhIHdhcnJpb3IgZmluaXNoZXMgcHZlIGJhdHRsZQogICAgICogIEBwYXJhbSBvd25lciBXYXJyaW9yIG93bmVyCiAgICAgKiAgQHBhcmFtIGR1bmdlb25JbmRleCBGaW5pc2hlZCBkdW5nZW9uIGluZGV4CiAgICAgKiAgQHBhcmFtIHdhcnJpb3JJZCBXYXJyaW9yIElEIHRoYXQgY29tcGxldGVkIGR1bmdlb24KICAgICAqICBAcGFyYW0gY29vbGRvd25FbmRCbG9jayBCbG9jayBudW1iZXIsIHdoZW4gY29vbGRvd24gb24gUFZFIGJhdHRsZSBlbnRyYW5jZSB3aWxsIGJlIG92ZXIKICAgICAqICBAcGFyYW0gcmV3YXJkSWQgV2FycmlvciBJRCB3aGljaCB3YXMgZ3JhbnRlZCB0byB0aGUgb3duZXIgYXMgYmF0dGxlIHJld2FyZAogICAgICovCiAgICBldmVudCBQVkVGaW5pc2hlZChhZGRyZXNzIG93bmVyLCB1aW50MjU2IGR1bmdlb25JbmRleCwgdWludDI1NiB3YXJyaW9ySWQsIHVpbnQyNTYgY29vbGRvd25FbmRCbG9jaywgdWludDI1NiByZXdhcmRJZCk7CgoJLy8vIEBkZXYgVXBkYXRlIHRoZSBhZGRyZXNzIG9mIHRoZSBnZW5lcmF0b3IgY29udHJhY3QsIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgQWRtaW4uCiAgICAvLy8gQHBhcmFtIF9hZGRyZXNzIEFuIGFkZHJlc3Mgb2YgYSBHZW5lcmF0b3IgY29udHJhY3QgaW5zdGFuY2UgdG8gYmUgdXNlZCBmcm9tIHRoaXMgcG9pbnQgZm9yd2FyZC4KICAgIGZ1bmN0aW9uIHNldEdlbmVyYXRvckFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBHZW5lcmF0b3JJbnRlcmZhY2UgY2FuZGlkYXRlQ29udHJhY3QgPSBHZW5lcmF0b3JJbnRlcmZhY2UoX2FkZHJlc3MpOwoKICAgICAgICAvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0gaHR0cHM6Ly9naXRodWIuY29tL0x1bnlyL2Nyb3dkc2FsZS1jb250cmFjdHMvYmxvYi9jZmFkZDE1OTg2YzMwNTIxZDhiYTdkNWI2ZjU3YjRmZWZjYzdhYzM4L2NvbnRyYWN0cy9MdW55clRva2VuLnNvbCNMMTE3CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc0dlbmVyYXRvcigpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIGdlbmVyYXRvciA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhcmVVbmlxdWUodWludDMyW10gbWVtb3J5IF93YXJyaW9ySWRzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMoYm9vbCkgewogICAJICAgIHVpbnQyNTYgbGVuZ3RoID0gX3dhcnJpb3JJZHMubGVuZ3RoOwogICAJICAgIHVpbnQyNTYgajsKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CgkgICAgICAgIGZvcihqID0gaSArIDE7IGogPCBsZW5ndGg7IGorKykgewoJICAgICAgICAgICAgaWYgKF93YXJyaW9ySWRzW2ldID09IF93YXJyaW9ySWRzW2pdKSByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7IAogICAJfQoKICAgIC8vLyBAZGV2IFVwZGF0ZXMgdGhlIG1pbmltdW0gcGF5bWVudCByZXF1aXJlZCBmb3IgY2FsbGluZyBzdGFydFBWRSgpLiBDYW4gb25seQogICAgLy8vICBiZSBjYWxsZWQgYnkgdGhlIGFkbWluIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBzZXRQVkVCYXR0bGVGZWUodWludDI1NiBfcHZlQmF0dGxlRmVlKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoX3B2ZUJhdHRsZUZlZSA+IFBWRV9DT01QRU5TQVRJT04pOwogICAgICAgIHB2ZUJhdHRsZUZlZSA9IF9wdmVCYXR0bGVGZWU7CiAgICB9CiAgICAKICAgIC8qKiBAZGV2IFJldHVybnMgUFZFIGNvb2xkb3duLCBhZnRlciBlYWNoIGJhdHRsZSwgdGhlIHdhcnJpb3IgcmVjZWl2ZXMgYSAKICAgICAqICBjb29sZG93biBvbiB0aGUgbmV4dCBlbnRyYW5jZSB0byB0aGUgYmF0dGxlLCBjb29sZG93biBkZXBlbmRzIG9uIGN1cnJlbnQgd2FycmlvciBsZXZlbCwKICAgICAqICB3aGljaCBpcyBtdWx0aXBsaWVkIGJ5IDFoLiBTcGVjaWFsIGNhc2U6IGFmdGVyIHJlY2VpdmluZyAyNSBsdiwgdGhlIGNvb2xkd29uIHdpbGwgYmUgMTQgZGF5cy4KICAgICAqICBAcGFyYW0gX2xldmVsUG9pbnRzIHdhcnJpb3IgbGV2ZWwgKi8KICAgIGZ1bmN0aW9uIGdldFBWRUNvb2xkb3duKHVpbnQyNTYgX2xldmVsUG9pbnRzKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBsZXZlbCA9IENyeXB0b1V0aWxzLl9nZXRMZXZlbChfbGV2ZWxQb2ludHMpOwogICAgICAgIGlmIChsZXZlbCA+PSBNQVhfTEVWRUwpIHJldHVybiAoMTQgKiAyNCAqIFBWRV9DT09MRE9XTik7Ly8xNCBkYXlzCiAgICAgICAgcmV0dXJuIChQVkVfQ09PTERPV04gKiBsZXZlbCk7CiAgICB9CgogICAgLyoqIEBkZXYgUmV0dXJucyBQVkUgZHVyYXRpb24sIGVhY2ggYmF0dGxlIGhhdmUgYSBkdXJhdGlvbiwgd2hpY2ggZGVwZW5kcyBvbiBjdXJyZW50IHdhcnJpb3IgbGV2ZWwsCiAgICAgKiAgd2hpY2ggaXMgbXVsdGlwbGllZCBieSAxNSBtaW4uIEF0IHRoZSBlbmQgb2YgdGhlIGR1cmF0aW9uLCB3YXJyaW9yIGlzIGJlY29taW5nIGVsaWdpYmxlIHRvIHJlY2VpdmUKICAgICAqICBiYXR0bGUgcmV3YXJkIChuZXcgd2FycmlvciBpbiBzaGlueSBhcm1vcikKICAgICAqICBAcGFyYW0gX2xldmVsUG9pbnRzIHdhcnJpb3IgbGV2ZWwgcG9pbnRzIAogICAgICovCiAgICBmdW5jdGlvbiBnZXRQVkVEdXJhdGlvbih1aW50MjU2IF9sZXZlbFBvaW50cykgcHVibGljIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBDcnlwdG9VdGlscy5fZ2V0TGV2ZWwoX2xldmVsUG9pbnRzKSAqIFBWRV9EVVJBVElPTjsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2hlY2tzIHRoYXQgYSBnaXZlbiB3YXJyaW9yIGNhbiBwYXJ0aWNpcGF0ZSBpbiBQVkUgYmF0dGxlLiBSZXF1aXJlcyB0aGF0IHRoZQogICAgLy8vICBjdXJyZW50IGNvb2xkb3duIGlzIGZpbmlzaGVkIGFuZCBhbHNvIGNoZWNrcyB0aGF0IHdhcnJpb3IgaXMgaWRsZSAoZG9lcyBub3QgcGFydGljaXBhdGUgaW4gYW55IGFjdGlvbikKICAgIC8vLyAgYW5kIGR1bmdlb24gbGV2ZWwgcmVxdWlyZW1lbnQgaXMgc2F0aXNmaWVkCiAgICBmdW5jdGlvbiBfaXNSZWFkeVRvUFZFKERhdGFUeXBlcy5XYXJyaW9yIF93YXJyaW9yKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF93YXJyaW9yLmFjdGlvbiA9PSBJRExFKSAmJiAvL2lzIGlkbGUKICAgICAgICAoX3dhcnJpb3IuY29vbGRvd25FbmRCbG9jayA8PSB1aW50NjQoYmxvY2subnVtYmVyKSkgJiYgLy9ubyBjb29sZG93bgogICAgICAgIChfd2Fycmlvci5sZXZlbCA+PSBkdW5nZW9uUmVxdWlyZW1lbnRzW193YXJyaW9yLmR1bmdlb25JbmRleF0pOy8vZHVuZ2VvbiBsZXZlbCByZXF1aXJlbWVudCBpcyBzYXRpc2ZpZWQKICAgIH0KICAgIAogICAgLy8vIEBkZXYgSW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbiB0byBpbml0aWF0ZSBwdmUgYmF0dGxlLCBhc3N1bWVzIHRoYXQgYWxsIGJhdHRsZQogICAgLy8vICByZXF1aXJlbWVudHMgaGF2ZSBiZWVuIGNoZWNrZWQuCiAgICBmdW5jdGlvbiBfdHJpZ2dlclBWRVN0YXJ0KHVpbnQyNTYgX3dhcnJpb3JJZCkgaW50ZXJuYWwgewogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHdhcnJpb3IgZnJvbSBzdG9yYWdlLgogICAgICAgIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2Ugd2FycmlvciA9IHdhcnJpb3JzW193YXJyaW9ySWRdOwogICAgICAgIC8vIFNldCB3YXJyaW9yIGN1cnJlbnQgYWN0aW9uIHRvIHB2ZSBiYXR0bGUKICAgICAgICB3YXJyaW9yLmFjdGlvbiA9IHVpbnQxNihQVkVfQkFUVExFKTsKICAgICAgICAvLyBTZXQgYmF0dGxlIGR1cmF0aW9uCiAgICAgICAgd2Fycmlvci5jb29sZG93bkVuZEJsb2NrID0gdWludDY0KChnZXRQVkVEdXJhdGlvbih3YXJyaW9yLmxldmVsKSAvIHNlY29uZHNQZXJCbG9jaykgKyBibG9jay5udW1iZXIpOwogICAgICAgIC8vIEVtaXQgdGhlIHB2ZSBiYXR0bGUgc3RhcnQgZXZlbnQuCiAgICAgICAgUFZFU3RhcnRlZChtc2cuc2VuZGVyLCB3YXJyaW9yLmR1bmdlb25JbmRleCwgX3dhcnJpb3JJZCwgd2Fycmlvci5jb29sZG93bkVuZEJsb2NrKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgU3RhcnRzIFBWRSBiYXR0bGUgZm9yIHNwZWNpZmllZCB3YXJyaW9yLCAKICAgIC8vLyBhZnRlciBiYXR0bGUsIHdhcnJpb3Igb3duZXIgd2lsbCByZWNlaXZlIHJld2FyZCAoV2FycmlvcikgCiAgICAvLy8gQHBhcmFtIF93YXJyaW9ySWQgQSBXYXJyaW9yIHJlYWR5IHRvIFBWRSBiYXR0bGUuCiAgICBmdW5jdGlvbiBzdGFydFBWRSh1aW50MjU2IF93YXJyaW9ySWQpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CgkJLy8gQ2hlY2tzIGZvciBwYXltZW50LgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHB2ZUJhdHRsZUZlZSk7CgkJCgkJLy8gQ2FsbGVyIG11c3Qgb3duIHRoZSB3YXJyaW9yLgogICAgICAgIHJlcXVpcmUoX293bmVyQXBwcm92ZWQobXNnLnNlbmRlciwgX3dhcnJpb3JJZCkpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSB3YXJyaW9yIGluIHN0b3JhZ2UuCiAgICAgICAgRGF0YVR5cGVzLldhcnJpb3Igc3RvcmFnZSB3YXJyaW9yID0gd2FycmlvcnNbX3dhcnJpb3JJZF07CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHdhcnJpb3IgZXhpc3RzLgogICAgICAgIHJlcXVpcmUod2Fycmlvci5pZGVudGl0eSAhPSAwKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgd2FycmlvciBpcyByZWFkeSB0byBiYXR0bGUKICAgICAgICByZXF1aXJlKF9pc1JlYWR5VG9QVkUod2FycmlvcikpOwogICAgICAgIAogICAgICAgIC8vIEFsbCBjaGVja3MgcGFzc2VkLCBsZXQgdGhlIGJhdHRsZSBiZWdpbiEKICAgICAgICBfdHJpZ2dlclBWRVN0YXJ0KF93YXJyaW9ySWQpOwogICAgICAgIAogICAgICAgIC8vIENhbGN1bGF0ZSBhbnkgZXhjZXNzIGZ1bmRzIGluY2x1ZGVkIGluIG1zZy52YWx1ZS4gSWYgdGhlIGV4Y2VzcwogICAgICAgIC8vIGlzIGFueXRoaW5nIHdvcnRoIHdvcnJ5aW5nIGFib3V0LCB0cmFuc2ZlciBpdCBiYWNrIHRvIG1lc3NhZ2Ugb3duZXIuCiAgICAgICAgLy8gTk9URTogV2UgY2hlY2tlZCBhYm92ZSB0aGF0IHRoZSBtc2cudmFsdWUgaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAgICAgLy8gZXF1YWwgdG8gdGhlIHByaWNlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGZlZUV4Y2VzcyA9IG1zZy52YWx1ZSAtIHB2ZUJhdHRsZUZlZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gVGhpcyBpcyBub3Qgc3VzY2VwdGlibGUgCiAgICAgICAgLy8gdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSBvZiBfaXNSZWFkeVRvUFZFIGNoZWNrCiAgICAgICAgLy8gd2lsbCBmYWlsCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihmZWVFeGNlc3MpOwogICAgICAgIC8vc2VuZCBiYXR0bGUgZmVlIHRvIGJlbmVmaWNpYXJ5CiAgICAgICAgYmFua0FkZHJlc3MudHJhbnNmZXIocHZlQmF0dGxlRmVlIC0gUFZFX0NPTVBFTlNBVElPTik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9hcmlzZVdhcnJpb3IoYWRkcmVzcyBfb3duZXIsIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2UgX3dhcnJpb3IpIGludGVybmFsIHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQyNTYgaWRlbnRpdHkgPSBnZW5lcmF0b3IuZ2VuZXJhdGVXYXJyaW9yKF93YXJyaW9yLmlkZW50aXR5LCBDcnlwdG9VdGlscy5fZ2V0TGV2ZWwoX3dhcnJpb3IubGV2ZWwpLCBfd2Fycmlvci5jb29sZG93bkVuZEJsb2NrIC0gMSwgMCk7CiAgICAgICAgcmV0dXJuIF9jcmVhdGVXYXJyaW9yKGlkZW50aXR5LCBfb3duZXIsIGJsb2NrLm51bWJlciArIChQVkVfQ09PTERPV04gKiBTVU1NT05JTkdfU0lDS0VORVNTIC8gc2Vjb25kc1BlckJsb2NrKSk7CiAgICB9CgoJLy8vIEBkZXYgSW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbiB0byBmaW5pc2ggcHZlIGJhdHRsZSwgYXNzdW1lcyB0aGF0IGFsbCBiYXR0bGUKICAgIC8vLyAgZmluaXNoIHJlcXVpcmVtZW50cyBoYXZlIGJlZW4gY2hlY2tlZC4KICAgIGZ1bmN0aW9uIF90cmlnZ2VyUFZFRmluaXNoKHVpbnQyNTYgX3dhcnJpb3JJZCkgaW50ZXJuYWwgewogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHdhcnJpb3IgaW4gc3RvcmFnZS4KICAgICAgICBEYXRhVHlwZXMuV2FycmlvciBzdG9yYWdlIHdhcnJpb3IgPSB3YXJyaW9yc1tfd2FycmlvcklkXTsKICAgICAgICAKICAgICAgICAvLyBTZXQgd2FycmlvciBjdXJyZW50IGFjdGlvbiB0byBpZGxlCiAgICAgICAgd2Fycmlvci5hY3Rpb24gPSB1aW50MTYoSURMRSk7CiAgICAgICAgCiAgICAgICAgLy8gQ29tcHV0ZSBhbiBlc3RpbWF0aW9uIG9mIHRoZSBjb29sZG93biB0aW1lIGluIGJsb2NrcyAoYmFzZWQgb24gY3VycmVudCBsZXZlbCkuCiAgICAgICAgLy8gYW5kIG1pbmVyIHBlcmMgYWxzbyByZWR1Y2VzIGNvb2xkb3duIHRpbWUgYnkgNCB0aW1lcwogICAgICAgIHdhcnJpb3IuY29vbGRvd25FbmRCbG9jayA9IHVpbnQ2NCgoZ2V0UFZFQ29vbGRvd24od2Fycmlvci5sZXZlbCkgLyAKICAgICAgICAgICAgQ3J5cHRvVXRpbHMuX2dldEJvbnVzKHdhcnJpb3IuaWRlbnRpdHkpIC8gc2Vjb25kc1BlckJsb2NrKSArIGJsb2NrLm51bWJlcik7CiAgICAgICAgCiAgICAgICAgLy8gY2FzaCBjb21wbGV0ZWQgZHVuZ2VvbiBpbmRleCBiZWZvcmUgaW5jcmVtZW50CiAgICAgICAgdWludDMyIGR1bmdlb25JbmRleCA9IHdhcnJpb3IuZHVuZ2VvbkluZGV4OwogICAgICAgIC8vIEluY3JlbWVudCB0aGUgZHVuZ2VvbiBpbmRleCwgY2xhbXBpbmcgaXQgYXQgNiwgd2hpY2ggaXMgdGhlIGxlbmd0aCBvZiB0aGUKICAgICAgICAvLyBkdW5nZW9uUmVxdWlyZW1lbnRzIGFycmF5LiBXZSBjb3VsZCBjaGVjayB0aGUgYXJyYXkgc2l6ZSBkeW5hbWljYWxseSwgYnV0IGhhcmQtY29kaW5nCiAgICAgICAgLy8gdGhpcyBhcyBhIGNvbnN0YW50IHNhdmVzIGdhcy4KICAgICAgICBpZiAoZHVuZ2VvbkluZGV4IDwgNikgewogICAgICAgICAgICB3YXJyaW9yLmR1bmdlb25JbmRleCArPSAxOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhZGRyZXNzIG93bmVyID0gd2FycmlvclRvT3duZXJbX3dhcnJpb3JJZF07CiAgICAgICAgLy8gZ2VuZXJhdGUgcmV3YXJkCiAgICAgICAgdWludDI1NiBhcmlzZW5XYXJyaW9ySWQgPSBfYXJpc2VXYXJyaW9yKG93bmVyLCB3YXJyaW9yKTsKICAgICAgICAvL0VtaXQgZXZlbnQKICAgICAgICBQVkVGaW5pc2hlZChvd25lciwgZHVuZ2VvbkluZGV4LCBfd2FycmlvcklkLCB3YXJyaW9yLmNvb2xkb3duRW5kQmxvY2ssIGFyaXNlbldhcnJpb3JJZCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBmaW5pc2hQVkUgY2FuIGJlIGNhbGxlZCBhZnRlciBiYXR0bGUgdGltZSBpcyBvdmVyLAogICAgICogaWYgY2hlY2tzIGFyZSBwYXNzZWQgdGhlbiBiYXR0bGUgcmVzdWx0IGlzIGNvbXB1dGVkLAogICAgICogYW5kIG5ldyB3YXJyaW9yIGlzIGF3YXJkZWQgdG8gb3duZXIgb2Ygc3BlY2lmaWVkIF93YXJyaW9yZCBJRC4KICAgICAqIE5CIGFueW9uZSBjYW4gY2FsbCB0aGlzIG1ldGhvZCwgaWYgdGhleSB3aWxsaW5nIHRvIHBheSB0aGUgZ2FzIHByaWNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmlzaFBWRSh1aW50MzIgX3dhcnJpb3JJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgd2FycmlvciBpbiBzdG9yYWdlLgogICAgICAgIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2Ugd2FycmlvciA9IHdhcnJpb3JzW193YXJyaW9ySWRdOwogICAgICAgIAogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHdhcnJpb3IgZXhpc3RzLgogICAgICAgIHJlcXVpcmUod2Fycmlvci5pZGVudGl0eSAhPSAwKTsKICAgICAgICAKICAgICAgICAvLyBDaGVjayB0aGF0IHdhcnJpb3IgcGFydGljaXBhdGVkIGluIFBWRSBiYXR0bGUgYWN0aW9uCiAgICAgICAgcmVxdWlyZSh3YXJyaW9yLmFjdGlvbiA9PSBQVkVfQkFUVExFKTsKICAgICAgICAKICAgICAgICAvLyBBbmQgdGhlIGJhdHRsZSB0aW1lIGlzIG92ZXIKICAgICAgICByZXF1aXJlKHdhcnJpb3IuY29vbGRvd25FbmRCbG9jayA8PSB1aW50NjQoYmxvY2subnVtYmVyKSk7CiAgICAgICAgCiAgICAgICAgLy8gV2hlbiB0aGUgYWxsIGNoZWNrcyBkb25lLCBjYWxjdWxhdGUgYWN0dWFsIGJhdHRsZSByZXN1bHQKICAgICAgICBfdHJpZ2dlclBWRUZpbmlzaChfd2FycmlvcklkKTsKICAgICAgICAKICAgICAgICAvL25vdCBzdXNjZXB0aWJsZSB0byByZWV0cmFuY2UgYXR0YWNrIGJlY2F1c2Ugb2YgcmVxdWlyZSh3YXJyaW9yLmFjdGlvbiA9PSBQVkVfQkFUVExFKQogICAgICAgIC8vYW5kIHJlcXVpcmUod2Fycmlvci5jb29sZG93bkVuZEJsb2NrIDw9IHVpbnQ2NChibG9jay5udW1iZXIpKTsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKFBWRV9DT01QRU5TQVRJT04pOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgZmluaXNoUFZFQmF0Y2ggc2FtZSBhcyBmaW5pc2hQVkUgYnV0IGZvciBtdWx0aXBsZSB3YXJyaW9yIGlkcy4KICAgICAqIE5CIGFueW9uZSBjYW4gY2FsbCB0aGlzIG1ldGhvZCwgaWYgdGhleSB3aWxsaW5nIHRvIHBheSB0aGUgZ2FzIHByaWNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmlzaFBWRUJhdGNoKHVpbnQzMltdIF93YXJyaW9ySWRzKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IF93YXJyaW9ySWRzLmxlbmd0aDsKICAgICAgICAvL2NoZWNrIG1heCBudW1iZXIgb2YgYmFjaCBmaW5pc2ggcHZlCiAgICAgICAgcmVxdWlyZShsZW5ndGggPD0gMjApOwogICAgICAgIHVpbnQyNTYgYmxvY2tOdW1iZXIgPSBibG9jay5udW1iZXI7CiAgICAgICAgdWludDI1NiBpbmRleDsKICAgICAgICAvL2FsbCB3YXJyaW9yIGlkcyBtdXN0IGJlIHVuaXF1ZQogICAgICAgIHJlcXVpcmUoYXJlVW5pcXVlKF93YXJyaW9ySWRzKSk7CiAgICAgICAgLy9jaGVjayBwcmVyZXF1aXNpdGVzCiAgICAgICAgZm9yKGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4ICsrKSB7CiAgICAgICAgICAgIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2Ugd2FycmlvciA9IHdhcnJpb3JzW193YXJyaW9ySWRzW2luZGV4XV07CgkJCXJlcXVpcmUoCgkJICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSB3YXJyaW9yIGV4aXN0cy4KCQkJICAgIHdhcnJpb3IuaWRlbnRpdHkgIT0gMCAmJgoJCSAgICAgICAgLy8gQ2hlY2sgdGhhdCB3YXJyaW9yIHBhcnRpY2lwYXRlZCBpbiBQVkUgYmF0dGxlIGFjdGlvbgoJCQkgICAgd2Fycmlvci5hY3Rpb24gPT0gUFZFX0JBVFRMRSAmJgoJCSAgICAgICAgLy8gQW5kIHRoZSBiYXR0bGUgdGltZSBpcyBvdmVyCgkJCSAgICB3YXJyaW9yLmNvb2xkb3duRW5kQmxvY2sgPD0gYmxvY2tOdW1iZXIKCQkJKTsKICAgICAgICB9CiAgICAgICAgLy8gV2hlbiB0aGUgYWxsIGNoZWNrcyBkb25lLCBjYWxjdWxhdGUgYWN0dWFsIGJhdHRsZSByZXN1bHQKICAgICAgICBmb3IoaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXggKyspIHsKICAgICAgICAgICAgX3RyaWdnZXJQVkVGaW5pc2goX3dhcnJpb3JJZHNbaW5kZXhdKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy9ub3Qgc3VzY2VwdGlibGUgdG8gcmVldHJhbmNlIGF0dGFjayBiZWNhdXNlIG9mIHJlcXVpcmUod2Fycmlvci5hY3Rpb24gPT0gUFZFX0JBVFRMRSkKICAgICAgICAvL2FuZCByZXF1aXJlKHdhcnJpb3IuY29vbGRvd25FbmRCbG9jayA8PSB1aW50NjQoYmxvY2subnVtYmVyKSk7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihQVkVfQ09NUEVOU0FUSU9OICogbGVuZ3RoKTsKICAgIH0KfQoKY29udHJhY3QgQ3J5cHRvV2FycmlvclBWUCBpcyBDcnlwdG9XYXJyaW9yUFZFIHsKCQoJUFZQSW50ZXJmYWNlIHB1YmxpYyBiYXR0bGVQcm92aWRlcjsKCQoJLy8vIEBkZXYgU2V0cyB0aGUgcmVmZXJlbmNlIHRvIHRoZSBzYWxlIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hZGRyZXNzIC0gQWRkcmVzcyBvZiBzYWxlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gc2V0QmF0dGxlUHJvdmlkZXJBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgUFZQSW50ZXJmYWNlIGNhbmRpZGF0ZUNvbnRyYWN0ID0gUFZQSW50ZXJmYWNlKF9hZGRyZXNzKTsKCiAgICAgICAgLy8gTk9URTogdmVyaWZ5IHRoYXQgYSBjb250cmFjdCBpcyB3aGF0IHdlIGV4cGVjdCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9MdW55ci9jcm93ZHNhbGUtY29udHJhY3RzL2Jsb2IvY2ZhZGQxNTk4NmMzMDUyMWQ4YmE3ZDViNmY1N2I0ZmVmY2M3YWMzOC9jb250cmFjdHMvTHVueXJUb2tlbi5zb2wjTDExNwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNQVlBQcm92aWRlcigpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIGJhdHRsZVByb3ZpZGVyID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9wYWNrUFZQRGF0YSh1aW50MjU2IF93YXJyaW9ySWQsIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2Ugd2FycmlvcikgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiBDcnlwdG9VdGlscy5fcGFja1dhcnJpb3JQdnBEYXRhKHdhcnJpb3IuaWRlbnRpdHksIHVpbnQyNTYod2Fycmlvci5yYXRpbmcpLCAwLCBfd2FycmlvcklkLCB3YXJyaW9yLmxldmVsKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3RyaWdnZXJQVlBTaWduVXAodWludDMyIF93YXJyaW9ySWQsIHVpbnQyNTYgZmVlKSBpbnRlcm5hbCB7CiAgICAgICAgRGF0YVR5cGVzLldhcnJpb3Igc3RvcmFnZSB3YXJyaW9yID0gd2FycmlvcnNbX3dhcnJpb3JJZF07CiAgICAJCQoJCXVpbnQyNTYgcGFja2VkV2FycmlvciA9IF9wYWNrUFZQRGF0YShfd2FycmlvcklkLCB3YXJyaW9yKTsKICAgICAgICAKICAgICAgICAvLyBhZGRQVlBDb250ZW5kZXIgd2lsbCB0aHJvdyBpZiBmZWUgZmFpbHMuCiAgICAgICAgYmF0dGxlUHJvdmlkZXIuYWRkUFZQQ29udGVuZGVyLnZhbHVlKGZlZSkobXNnLnNlbmRlciwgcGFja2VkV2Fycmlvcik7CiAgICAgICAgCiAgICAgICAgd2Fycmlvci5hY3Rpb24gPSB1aW50MTYoUFZQX0JBVFRMRSk7CiAgICB9CiAgICAKICAgIC8qCiAgICAgKiBAdGl0bGUgc2lnblVwRm9yUFZQIGVucXVldWVzIHNwZWNpZmllZCB3YXJyaW9yIHRvIFBWUAogICAgICogCiAgICAgKiBAZGV2IFdoZW4gdGhlIG93bmVyIGVucXVldWVzIGhpcyB3YXJyaW9yIGZvciBQdlAsIHRoZSB3YXJyaW9yIGVudGVycyB0aGUgd2FpdGluZyByb29tLgogICAgICogT25jZSBldmVyeSAxNSBtaW51dGVzLCB3ZSBjaGVjayB0aGUgd2FycmlvcnMgaW4gdGhlIHJvb20gYW5kIHNlbGVjdCBwYWlycy4gCiAgICAgKiBGb3IgdGhvc2Ugd2FycmlvcnMgdG8gd2hvbSB3ZSBmb3VuZCBjb3VwbGVzLCBmaWdodGluZyBpcyBjb25kdWN0ZWQgYW5kIHRoZSByZXN1bHRzIAogICAgICogYXJlIHJlY29yZGVkIGluIHRoZSBwcm9maWxlIG9mIHRoZSB3YXJyaW9yLiAKICAgICAqLwogICAgZnVuY3Rpb24gc2lnblVwRm9yUFZQKHVpbnQzMiBfd2FycmlvcklkKSBwdWJsaWMgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsvL2RvbmUKCQkvLyBDYWxsZXIgbXVzdCBvd24gdGhlIHdhcnJpb3IuCiAgICAgICAgcmVxdWlyZShfb3duZXJBcHByb3ZlZChtc2cuc2VuZGVyLCBfd2FycmlvcklkKSk7CiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgd2FycmlvciBpbiBzdG9yYWdlLgogICAgICAgIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2Ugd2FycmlvciA9IHdhcnJpb3JzW193YXJyaW9ySWRdOwogICAgICAgIC8vIHNhbml0eSBjaGVjawogICAgICAgIHJlcXVpcmUod2Fycmlvci5pZGVudGl0eSAhPSAwKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgd2FycmlvciBpcyByZWFkeSB0byBiYXR0bGUKICAgICAgICByZXF1aXJlKHdhcnJpb3IuYWN0aW9uID09IElETEUpOwogICAgICAgIAogICAgICAgIC8vIERlZmluZSB0aGUgY3VycmVudCBwcmljZSBvZiB0aGUgYXVjdGlvbi4KICAgICAgICB1aW50MjU2IGZlZSA9IGJhdHRsZVByb3ZpZGVyLmdldFBWUEVudHJhbmNlRmVlKHdhcnJpb3IubGV2ZWwpOwogICAgICAgIAogICAgICAgIC8vIENoZWNrcyBmb3IgcGF5bWVudC4KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBmZWUpOwogICAgICAgIAogICAgICAgIC8vIEFsbCBjaGVja3MgcGFzc2VkLCBwdXQgdGhlIHdhcnJpb3IgdG8gdGhlIHF1ZXVlIQogICAgICAgIF90cmlnZ2VyUFZQU2lnblVwKF93YXJyaW9ySWQsIGZlZSk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgaW5jbHVkZWQgaW4gbXNnLnZhbHVlLiBJZiB0aGUgZXhjZXNzCiAgICAgICAgLy8gaXMgYW55dGhpbmcgd29ydGggd29ycnlpbmcgYWJvdXQsIHRyYW5zZmVyIGl0IGJhY2sgdG8gbWVzc2FnZSBvd25lci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIG1zZy52YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IKICAgICAgICAvLyBlcXVhbCB0byB0aGUgcHJpY2Ugc28gdGhpcyBjYW5ub3QgdW5kZXJmbG93LgogICAgICAgIHVpbnQyNTYgZmVlRXhjZXNzID0gbXNnLnZhbHVlIC0gZmVlOwoKICAgICAgICAvLyBSZXR1cm4gdGhlIGZ1bmRzLiBUaGlzIGlzIG5vdCBzdXNjZXB0aWJsZSAKICAgICAgICAvLyB0byBhIHJlLWVudHJ5IGF0dGFjayBiZWNhdXNlIG9mIHdhcnJpb3IuYWN0aW9uID09IElETEUgY2hlY2sKICAgICAgICAvLyB3aWxsIGZhaWwKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGZlZUV4Y2Vzcyk7CiAgICB9CgogICAgZnVuY3Rpb24gX2dyYW5kUFZQV2lubmVyUmV3YXJkKHVpbnQyNTYgX3dhcnJpb3JJZCkgaW50ZXJuYWwgewogICAgICAgIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2Ugd2FycmlvciA9IHdhcnJpb3JzW193YXJyaW9ySWRdOwogICAgICAgIC8vIHJld2FyZCAxIGxldmVsLCBhZGQgMTAgbGV2ZWwgcG9pbnRzCiAgICAgICAgdWludDI1NiBsZXZlbCA9IHdhcnJpb3IubGV2ZWw7CiAgICAgICAgaWYgKGxldmVsIDwgKE1BWF9MRVZFTCAqIFBPSU5UU19UT19MRVZFTCkpIHsKICAgICAgICAgICAgbGV2ZWwgPSBsZXZlbCArIFBPSU5UU19UT19MRVZFTDsKCQkJd2Fycmlvci5sZXZlbCA9IHVpbnQ2NChsZXZlbCA+IChNQVhfTEVWRUwgKiBQT0lOVFNfVE9fTEVWRUwpID8gKE1BWF9MRVZFTCAqIFBPSU5UU19UT19MRVZFTCkgOiBsZXZlbCk7CiAgICAgICAgfQoJCS8vIGdpdmUgMTAwIHJhdGluZyBmb3IgbGV2ZWxVcCBhbmQgMzAgZm9yIHdpbgoJCXdhcnJpb3IucmF0aW5nICs9IDEzMDsKCQkvLyBtYXJrIHdhcnJpb3IgaWRsZSwgc28gaXQgY2FuIHBhcnRpY2lwYXRlCgkJLy8gaW4gYW5vdGhlciBhY3Rpb25zCgkJd2Fycmlvci5hY3Rpb24gPSB1aW50MTYoSURMRSk7CiAgICB9CgogICAgZnVuY3Rpb24gX2dyYW5kUFZQTG9zZXJSZXdhcmQodWludDI1NiBfd2FycmlvcklkKSBpbnRlcm5hbCB7CiAgICAgICAgRGF0YVR5cGVzLldhcnJpb3Igc3RvcmFnZSB3YXJyaW9yID0gd2FycmlvcnNbX3dhcnJpb3JJZF07CgkJLy8gcmV3YXJkIDAuNSBsZXZlbAoJCXVpbnQyNTYgb2xkTGV2ZWwgPSB3YXJyaW9yLmxldmVsOwoJCXVpbnQyNTYgbGV2ZWwgPSBvbGRMZXZlbDsKCQlpZiAobGV2ZWwgPCAoTUFYX0xFVkVMICogUE9JTlRTX1RPX0xFVkVMKSkgewogICAgICAgICAgICBsZXZlbCArPSAoUE9JTlRTX1RPX0xFVkVMIC8gMik7CgkJCXdhcnJpb3IubGV2ZWwgPSB1aW50NjQobGV2ZWwpOwogICAgICAgIH0KCQkvLyBnaXZlIDEwMCByYXRpbmcgZm9yIGxldmVsVXAgaWYgaGFwcGVucyBhbmQgLTMwIGZvciBsb3NlCgkJaW50MjU2IG5ld1JhdGluZyA9IHdhcnJpb3IucmF0aW5nICsgKENyeXB0b1V0aWxzLl9nZXRMZXZlbChsZXZlbCkgPiBDcnlwdG9VdGlscy5fZ2V0TGV2ZWwob2xkTGV2ZWwpID8gaW50MjU2KDEwMCAtIDMwKSA6IGludDI1NigtMzApKTsKCQkvLyByYXRpbmcgY2FuJ3QgYmUgbGVzcyB0aGFuIDAgYW5kIG1vcmUgdGhhbiAxMDAwMDAwMDAwCgkgICAgd2Fycmlvci5yYXRpbmcgPSBpbnQ2NCgobmV3UmF0aW5nID49IDApID8gKG5ld1JhdGluZyA+IDEwMDAwMDAwMDAgPyAxMDAwMDAwMDAwIDogbmV3UmF0aW5nKSA6IDApOwogICAgICAgIC8vIG1hcmsgd2FycmlvciBpZGxlLCBzbyBpdCBjYW4gcGFydGljaXBhdGUKCQkvLyBpbiBhbm90aGVyIGFjdGlvbnMKCSAgICB3YXJyaW9yLmFjdGlvbiA9IHVpbnQxNihJRExFKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dyYW5kUFZQUmV3YXJkcyh1aW50MjU2W10gbWVtb3J5IHdhcnJpb3JzRGF0YSwgdWludDI1NiBtYXRjaGluZ0NvdW50KSBpbnRlcm5hbCB7CiAgICAgICAgZm9yKHVpbnQyNTYgaWQgPSAwOyBpZCA8IG1hdGNoaW5nQ291bnQ7IGlkICs9IDIpewogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyB3aW5uZXIsIGV2ZW4gaWRzIGFyZSB3aW5uZXJzIQogICAgICAgICAgICBfZ3JhbmRQVlBXaW5uZXJSZXdhcmQoQ3J5cHRvVXRpbHMuX3VucGFja0lkVmFsdWUod2FycmlvcnNEYXRhW2lkXSkpOwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBsb3NlciwgdGhleSBhcmUgb2RkLi4uCiAgICAgICAgICAgIF9ncmFuZFBWUExvc2VyUmV3YXJkKENyeXB0b1V0aWxzLl91bnBhY2tJZFZhbHVlKHdhcnJpb3JzRGF0YVtpZCArIDFdKSk7CiAgICAgICAgfQoJfQoKICAgIC8vIEBkZXYgSW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbiB0byBpbml0aWF0ZSBwdnAgYmF0dGxlLCBhc3N1bWVzIHRoYXQgYWxsIGJhdHRsZQogICAgLy8vICByZXF1aXJlbWVudHMgaGF2ZSBiZWVuIGNoZWNrZWQuCiAgICBmdW5jdGlvbiBwdnBGaW5pc2hlZCh1aW50MjU2W10gd2FycmlvcnNEYXRhLCB1aW50MjU2IG1hdGNoaW5nQ291bnQpIHB1YmxpYyB7CiAgICAgICAgLy90aGlzIG1ldGhvZCBjYW4gYmUgaW52b2tlZCBvbmx5IGJ5IGJhdHRsZVByb3ZpZGVyIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoYmF0dGxlUHJvdmlkZXIpKTsKICAgICAgICAKICAgICAgICBfZ3JhbmRQVlBSZXdhcmRzKHdhcnJpb3JzRGF0YSwgbWF0Y2hpbmdDb3VudCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHB2cENvbnRlbmRlclJlbW92ZWQodWludDMyIF93YXJyaW9ySWQpIHB1YmxpYyB7CiAgICAgICAgLy90aGlzIG1ldGhvZCBjYW4gYmUgaW52b2tlZCBvbmx5IGJ5IGJhdHRsZVByb3ZpZGVyIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoYmF0dGxlUHJvdmlkZXIpKTsKICAgICAgICAvL2dyYWIgd2FycmlvciBzdG9yYWdlIHJlZmVyZW5jZQogICAgICAgIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2Ugd2FycmlvciA9IHdhcnJpb3JzW193YXJyaW9ySWRdOwogICAgICAgIC8vc3BlY2lmaWVkIHdhcnJpb3IgbXVzdCBiZSBpbiBwdnAgc3RhdGUKICAgICAgICByZXF1aXJlKHdhcnJpb3IuYWN0aW9uID09IFBWUF9CQVRUTEUpOwogICAgICAgIC8vYWxsIGNoZWNrcyBkb25lCiAgICAgICAgLy9zZXQgd2FycmlvciBzdGF0ZSB0byBJRExFCiAgICAgICAgd2Fycmlvci5hY3Rpb24gPSB1aW50MTYoSURMRSk7CiAgICB9Cn0KCmNvbnRyYWN0IENyeXB0b1dhcnJpb3JUb3VybmFtZW50IGlzIENyeXB0b1dhcnJpb3JQVlAgewogICAgCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEdST1VQX1NJWkUgPSA1OwogICAgCiAgICBmdW5jdGlvbiBfb3duc0FsbChhZGRyZXNzIF9jbGFpbWFudCwgdWludDMyW10gbWVtb3J5IF93YXJyaW9ySWRzKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IF93YXJyaW9ySWRzLmxlbmd0aDsKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghX293bmVyQXBwcm92ZWQoX2NsYWltYW50LCBfd2Fycmlvcklkc1tpXSkpIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7ICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBfaXNSZWFkeVRvVG91cm5hbWVudChEYXRhVHlwZXMuV2FycmlvciBzdG9yYWdlIF93YXJyaW9yKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCl7CiAgICAgICAgcmV0dXJuIF93YXJyaW9yLmxldmVsID49IDUwICYmIF93YXJyaW9yLmFjdGlvbiA9PSBJRExFOy8vbXVzdCBub3QgcGFydGljaXBhdGUgaW4gYW55IGFjdGlvbgogICAgfQogICAgCiAgICBmdW5jdGlvbiBfcGFja1RvdXJuYW1lbnREYXRhKHVpbnQzMltdIG1lbW9yeSBfd2FycmlvcklkcykgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBtZW1vcnkgdG91cm5hbWVudERhdGEpIHsKICAgICAgICB0b3VybmFtZW50RGF0YSA9IG5ldyB1aW50MjU2W10oR1JPVVBfU0laRSk7CiAgICAgICAgdWludDI1NiB3YXJyaW9ySWQ7CiAgICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBHUk9VUF9TSVpFOyBpKyspIHsKICAgICAgICAgICAgd2FycmlvcklkID0gX3dhcnJpb3JJZHNbaV07CiAgICAgICAgICAgIHRvdXJuYW1lbnREYXRhW2ldID0gX3BhY2tQVlBEYXRhKHdhcnJpb3JJZCwgd2FycmlvcnNbd2FycmlvcklkXSk7ICAgCiAgICAgICAgfQogICAgICAgIHJldHVybiB0b3VybmFtZW50RGF0YTsKICAgIH0KICAgIAogICAgCiAgICAvLyBAZGV2IEludGVybmFsIHV0aWxpdHkgZnVuY3Rpb24gdG8gc2lnbiB1cCB0byB0b3VybmFtZW50LCAKICAgIC8vIGFzc3VtZXMgdGhhdCBhbGwgYmF0dGxlIHJlcXVpcmVtZW50cyBoYXZlIGJlZW4gY2hlY2tlZC4KICAgIGZ1bmN0aW9uIF90cmlnZ2VyVG91cm5hbWVudFNpZ25VcCh1aW50MzJbXSBtZW1vcnkgX3dhcnJpb3JJZHMsIHVpbnQyNTYgZmVlKSBpbnRlcm5hbCB7CiAgICAgICAgLy9wYWNrIHdhcnJpb3IgaWRzIGludG8gaW50byB1aW50MjU2CiAgICAgICAgdWludDI1NltdIG1lbW9yeSB0b3VybmFtZW50RGF0YSA9IF9wYWNrVG91cm5hbWVudERhdGEoX3dhcnJpb3JJZHMpOwogICAgICAgIAogICAgICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgR1JPVVBfU0laRTsgaSsrKSB7CiAgICAgICAgICAgIC8vIFNldCB3YXJyaW9yIGN1cnJlbnQgYWN0aW9uIHRvIHRvdXJuYW1lbnQgYmF0dGxlCiAgICAgICAgICAgIHdhcnJpb3JzW193YXJyaW9ySWRzW2ldXS5hY3Rpb24gPSB1aW50MTYoVE9VUk5BTUVOVF9CQVRUTEUpOwogICAgICAgIH0KCiAgICAgICAgYmF0dGxlUHJvdmlkZXIuYWRkVG91cm5hbWVudENvbnRlbmRlci52YWx1ZShmZWUpKG1zZy5zZW5kZXIsIHRvdXJuYW1lbnREYXRhKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2lnblVwRm9yVG91cm5hbWVudCh1aW50MzJbXSBfd2FycmlvcklkcykgcHVibGljIHBheWFibGUgewogICAgICAgIC8vCiAgICAgICAgLy9jaGVjayB0aGF0IHRoZXJlIGlzIGVub3VnaCBmdW5kcyB0byBwYXkgZW50cmFuY2UgZmVlCiAgICAgICAgdWludDI1NiBmZWUgPSBiYXR0bGVQcm92aWRlci5nZXRUb3VybmFtZW50VGhyZXNob2xkRmVlKCk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gZmVlKTsKICAgICAgICAvLwogICAgICAgIC8vY2hlY2sgdGhhdCB3YXJyaW9ycyBncm91cCBpcyBleGFjdGx5IG9mIGFsbG93ZWQgc2l6ZQogICAgICAgIHJlcXVpcmUoX3dhcnJpb3JJZHMubGVuZ3RoID09IEdST1VQX1NJWkUpOwogICAgICAgIC8vCiAgICAgICAgLy9tZXNzYWdlIHNlbmRlciBtdXN0IG93biBhbGwgdGhlIHNwZWNpZmllZCB3YXJyaW9yIElEcwogICAgICAgIHJlcXVpcmUoX293bnNBbGwobXNnLnNlbmRlciwgX3dhcnJpb3JJZHMpKTsKICAgICAgICAvLwogICAgICAgIC8vY2hlY2sgYWxsIHdhcnJpb3JzIGFyZSB1bmlxdWUKICAgICAgICByZXF1aXJlKGFyZVVuaXF1ZShfd2FycmlvcklkcykpOwogICAgICAgIC8vCiAgICAgICAgLy9jaGVjayB0aGF0IGFsbCB3YXJyaW9ycyBhcmUgMjUgbHYgYW5kIElETEUKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IEdST1VQX1NJWkU7IGkgKyspIHsKICAgICAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgd2FycmlvciBpbiBzdG9yYWdlLgogICAgICAgICAgICByZXF1aXJlKF9pc1JlYWR5VG9Ub3VybmFtZW50KHdhcnJpb3JzW193YXJyaW9ySWRzW2ldXSkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAKICAgICAgICAvL2FsbCBjaGVja3MgcGFzc2VkLCB0cmlnZ2VyIHNpZ24gdXAKICAgICAgICBfdHJpZ2dlclRvdXJuYW1lbnRTaWduVXAoX3dhcnJpb3JJZHMsIGZlZSk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgaW5jbHVkZWQgaW4gbXNnLnZhbHVlLiBJZiB0aGUgZXhjZXNzCiAgICAgICAgLy8gaXMgYW55dGhpbmcgd29ydGggd29ycnlpbmcgYWJvdXQsIHRyYW5zZmVyIGl0IGJhY2sgdG8gbWVzc2FnZSBvd25lci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIG1zZy52YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IKICAgICAgICAvLyBlcXVhbCB0byB0aGUgZmVlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGZlZUV4Y2VzcyA9IG1zZy52YWx1ZSAtIGZlZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gVGhpcyBpcyBub3Qgc3VzY2VwdGlibGUgCiAgICAgICAgLy8gdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSBvZiBfaXNSZWFkeVRvVG91cm5hbWVudCBjaGVjawogICAgICAgIC8vIHdpbGwgZmFpbAogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZmVlRXhjZXNzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3NldElETEUodWludDI1NiB3YXJyaW9ySWRzKSBpbnRlcm5hbCB7CiAgICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBHUk9VUF9TSVpFOyBpICsrKSB7CiAgICAgICAgICAgIHdhcnJpb3JzW0NyeXB0b1V0aWxzLl91bnBhY2tXYXJyaW9ySWQod2FycmlvcklkcywgaSldLmFjdGlvbiA9IHVpbnQxNihJRExFKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9mcmVlV2FycmlvcnModWludDI1NltdIG1lbW9yeSBwYWNrZWRDb250ZW5kZXJzKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDI1NiBsZW5ndGggPSBwYWNrZWRDb250ZW5kZXJzLmxlbmd0aDsKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGxlbmd0aDsgaSArKykgewogICAgICAgICAgICAvL3NldCBwYXJ0aWNpcGFudHMgYWN0aW9uIHRvIElETEUKICAgICAgICAgICAgX3NldElETEUocGFja2VkQ29udGVuZGVyc1tpXSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiB0b3VybmFtZW50RmluaXNoZWQodWludDI1NltdIHBhY2tlZENvbnRlbmRlcnMpIHB1YmxpYyB7CiAgICAgICAgLy90aGlzIG1ldGhvZCBjYW4gYmUgaW52b2tlZCBvbmx5IGJ5IGJhdHRsZVByb3ZpZGVyIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoYmF0dGxlUHJvdmlkZXIpKTsKICAgICAgICAKICAgICAgICAvL2dyYWQgcmV3YXJkcyBhbmQgc2V0IElETEUgYWN0aW9uCiAgICAgICAgX2ZyZWVXYXJyaW9ycyhwYWNrZWRDb250ZW5kZXJzKTsKICAgIH0KICAgIAp9Cgpjb250cmFjdCBDcnlwdG9XYXJyaW9yQXVjdGlvbiBpcyBDcnlwdG9XYXJyaW9yVG91cm5hbWVudCB7CgogICAgZnVuY3Rpb24gc2V0U2FsZUF1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgU2FsZUNsb2NrQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IFNhbGVDbG9ja0F1Y3Rpb24oX2FkZHJlc3MpOwoKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzU2FsZUNsb2NrQXVjdGlvbigpKTsKCiAgICAgICAgc2FsZUF1Y3Rpb24gPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVTYWxlQXVjdGlvbigKICAgICAgICB1aW50MjU2IF93YXJyaW9ySWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIG9ubHkgb3duZWQgYW5kIG5vdCBhcHByb3ZlZCB0byB0cmFuc2ZlciB3YXJyaW9ycyBhbGxvd2VkIAogICAgICAgIHJlcXVpcmUoX293bmVyQXBwcm92ZWQobXNnLnNlbmRlciwgX3dhcnJpb3JJZCkpOwogICAgICAgIC8vIEVuc3VyZSB0aGUgd2FycmlvciBpcyBub3QgYnVzeSB0byBwcmV2ZW50IHRoZSBhdWN0aW9uCiAgICAgICAgLy8gY29udHJhY3QgY3JlYXRpb24gd2hpbGUgd2FycmlvciBpcyBpbiBhbnkga2luZCBvZiBiYXR0bGUgKFBWRSwgUFZQLCBUT1VSTkFNRU5UKS4KICAgICAgICByZXF1aXJlKHdhcnJpb3JzW193YXJyaW9ySWRdLmFjdGlvbiA9PSBJRExFKTsKICAgICAgICBfYXBwcm92ZShfd2FycmlvcklkLCBhZGRyZXNzKHNhbGVBdWN0aW9uKSk7CiAgICAgICAgLy8gQWN0dWFsbHkgY3JlYXRlIGF1Y3Rpb24KICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfd2FycmlvcklkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKfQoKY29udHJhY3QgQ3J5cHRvV2Fycmlvcklzc3VlciBpcyBDcnlwdG9XYXJyaW9yQXVjdGlvbiB7CiAgICAKICAgIC8vIExpbWl0cyB0aGUgbnVtYmVyIG9mIHdhcnJpb3JzIHRoZSBjb250cmFjdCBvd25lciBjYW4gZXZlciBjcmVhdGUKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IE1JTkVSX0NSRUFUSU9OX0xJTUlUID0gMjg4MDsvL2lzc3VlIGV2ZXJ5IDE1bWluIGZvciBvbmUgbW9udGgKCXVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgTUlORVJfUEVSSyA9IDE7CiAgICAvLyBDb25zdGFudHMgZm9yIG1pbmVyIGF1Y3Rpb25zLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUlORVJfU1RBUlRJTkdfUFJJQ0UgPSAxMDAgZmlubmV5OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUlORVJfRU5EX1BSSUNFID0gNTAgZmlubmV5OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUlORVJfQVVDVElPTl9EVVJBVElPTiA9IDEgZGF5czsKCiAgICB1aW50MjU2IHB1YmxpYyBtaW5lckNyZWF0ZWRDb3VudDsKCiAgICAvLy8gQGRldiBHZW5lcmF0ZXMgYSBuZXcgbWluZXIgd2FycmlvciB3aXRoIE1JTkVSIHBlcmsgb2YgQ09NTU9OIHJhcml0eQogICAgLy8vICBjcmVhdGVzIGFuIGF1Y3Rpb24gZm9yIGl0LgogICAgZnVuY3Rpb24gY3JlYXRlTWluZXJBdWN0aW9uKCkgZXh0ZXJuYWwgb25seUlzc3VlciB7CiAgICAgICAgcmVxdWlyZShtaW5lckNyZWF0ZWRDb3VudCA8IE1JTkVSX0NSRUFUSU9OX0xJTUlUKTsKCQkKICAgICAgICBtaW5lckNyZWF0ZWRDb3VudCsrOwoKICAgICAgICB1aW50MjU2IGlkZW50aXR5ID0gZ2VuZXJhdG9yLmdlbmVyYXRlV2FycmlvcihtaW5lckNyZWF0ZWRDb3VudCwgMCwgYmxvY2subnVtYmVyIC0gMSwgTUlORVJfUEVSSyk7CiAgICAgICAgdWludDI1NiB3YXJyaW9ySWQgPSBfY3JlYXRlV2FycmlvcihpZGVudGl0eSwgYmFua0FkZHJlc3MsIDApOwogICAgICAgIF9hcHByb3ZlKHdhcnJpb3JJZCwgYWRkcmVzcyhzYWxlQXVjdGlvbikpOwoKICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICB3YXJyaW9ySWQsCiAgICAgICAgICAgIF9jb21wdXRlTmV4dE1pbmVyUHJpY2UoKSwKICAgICAgICAgICAgTUlORVJfRU5EX1BSSUNFLAogICAgICAgICAgICBNSU5FUl9BVUNUSU9OX0RVUkFUSU9OLAogICAgICAgICAgICBiYW5rQWRkcmVzcwogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gX2NvbXB1dGVOZXh0TWluZXJQcmljZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYXZlUHJpY2UgPSBzYWxlQXVjdGlvbi5hdmVyYWdlTWluZXJTYWxlUHJpY2UoKTsKCiAgICAgICAgcmVxdWlyZShhdmVQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoYXZlUHJpY2UpKSk7CgogICAgICAgIHVpbnQyNTYgbmV4dFByaWNlID0gYXZlUHJpY2UgKiAzIC8gMjsvL2NvbmZpcm1lZAoKICAgICAgICBpZiAobmV4dFByaWNlIDwgTUlORVJfU1RBUlRJTkdfUFJJQ0UpIHsKICAgICAgICAgICAgbmV4dFByaWNlID0gTUlORVJfU1RBUlRJTkdfUFJJQ0U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV4dFByaWNlOwogICAgfQoKfQoKY29udHJhY3QgQ3J5cHRvV2FycmlvckNvcmUgaXMgQ3J5cHRvV2Fycmlvcklzc3VlciB7CgogICAgZnVuY3Rpb24gQ3J5cHRvV2FycmlvckNvcmUoKSBwdWJsaWMgewogICAgICAgIC8vIFN0YXJ0cyBwYXVzZWQuCiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIEFkbWluCiAgICAgICAgYWRtaW5BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIGFsc28gdGhlIGluaXRpYWwgSXNzdWVyCiAgICAgICAgaXNzdWVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIGFsc28gdGhlIGluaXRpYWwgQmFuawogICAgICAgIGJhbmtBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGZhbHNlKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5QWRtaW4gd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKHNhbGVBdWN0aW9uKSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoZ2VuZXJhdG9yKSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoYmF0dGxlUHJvdmlkZXIpICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobmV3Q29udHJhY3RBZGRyZXNzID09IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBBY3R1YWxseSB1bnBhdXNlIHRoZSBjb250cmFjdC4KICAgICAgICBzdXBlci51bnBhdXNlKCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldEJlbmVmaWNpYXJ5KCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gYmFua0FkZHJlc3M7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzUFZQTGlzdGVuZXIoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAgICAKICAgIC8qKgogICAgICpAcGFyYW0gX3dhcnJpb3JJZHMgYXJyYXkgb2Ygd2FycmlvcklkcywgCiAgICAgKiBmb3IgdGhvc2UgSURzIHdhcnJpb3IgZGF0YSB3aWxsIGJlIHBhY2tlZCBpbnRvIHdhcnJpb3JzRGF0YSBhcnJheQogICAgICpAcmV0dXJuIHdhcnJpb3JzRGF0YSBwYWNrZWQgd2FycmlvciBkYXRhCiAgICAgKkByZXR1cm4gc3RlcFNpemUgbnVtYmVyIG9mIGZpZWxkcyBpbiBzaW5nbGUgd2FycmlvciBkYXRhICovCiAgICBmdW5jdGlvbiBnZXRXYXJyaW9ycyh1aW50MzJbXSBfd2FycmlvcklkcykgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2W10gbWVtb3J5IHdhcnJpb3JzRGF0YSwgdWludDMyIHN0ZXBTaXplKSB7CiAgICAgICAgc3RlcFNpemUgPSA2OwogICAgICAgIHdhcnJpb3JzRGF0YSA9IG5ldyB1aW50MjU2W10oX3dhcnJpb3JJZHMubGVuZ3RoICogc3RlcFNpemUpOwogICAgICAgIGZvcih1aW50MzIgaSA9IDA7IGkgPCBfd2Fycmlvcklkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBfc2V0V2FycmlvckRhdGEod2FycmlvcnNEYXRhLCB3YXJyaW9yc1tfd2Fycmlvcklkc1tpXV0sIGkgKiBzdGVwU2l6ZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqQHBhcmFtIGluZGV4RnJvbSBpbmRleCBpbiBnbG9iYWwgd2FycmlvciBzdG9yYWdlIChha2Egd2FycmlvcklkKSwgCiAgICAgKiBmcm9tIHRoaXMgaW5kZXgoaW5jbHVkaW5nKSwgd2FycmlvcnMgZGF0YSB3aWxsIGJlIGdhdGhlcmVkCiAgICAgKkBwYXJhbSBjb3VudCBOdW1iZXIgb2Ygd2FycmlvcnMgdG8gaW5jbHVkZSBpbiBwYWNrZWQgZGF0YQogICAgICpAcmV0dXJuIHdhcnJpb3JzRGF0YSBwYWNrZWQgd2FycmlvciBkYXRhCiAgICAgKkByZXR1cm4gc3RlcFNpemUgbnVtYmVyIG9mIGZpZWxkcyBpbiBzaW5nbGUgd2FycmlvciBkYXRhICovCiAgICBmdW5jdGlvbiBnZXRXYXJyaW9yc0Zyb21JbmRleCh1aW50MzIgaW5kZXhGcm9tLCB1aW50MzIgY291bnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIG1lbW9yeSB3YXJyaW9yc0RhdGEsIHVpbnQzMiBzdGVwU2l6ZSkgewogICAgICAgIHN0ZXBTaXplID0gNjsKICAgICAgICAvL2NoZWNrIGxlbmd0aAogICAgICAgIHVpbnQyNTYgbGVuZ2h0ID0gKHdhcnJpb3JzLmxlbmd0aCAtIGluZGV4RnJvbSA+PSBjb3VudCA/IGNvdW50IDogd2FycmlvcnMubGVuZ3RoIC0gaW5kZXhGcm9tKTsKICAgICAgICAKICAgICAgICB3YXJyaW9yc0RhdGEgPSBuZXcgdWludDI1NltdKGxlbmdodCAqIHN0ZXBTaXplKTsKICAgICAgICBmb3IodWludDMyIGkgPSAwOyBpIDwgbGVuZ2h0OyBpICsrKSB7CiAgICAgICAgICAgIF9zZXRXYXJyaW9yRGF0YSh3YXJyaW9yc0RhdGEsIHdhcnJpb3JzW2luZGV4RnJvbSArIGldLCBpICogc3RlcFNpemUpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0V2Fycmlvck93bmVycyh1aW50MzJbXSBfd2FycmlvcklkcykgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzW10gbWVtb3J5IG93bmVycykgewogICAgICAgIHVpbnQyNTYgbGVuZ2h0ID0gX3dhcnJpb3JJZHMubGVuZ3RoOwogICAgICAgIG93bmVycyA9IG5ldyBhZGRyZXNzW10obGVuZ2h0KTsKICAgICAgICAKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGxlbmdodDsgaSArKykgewogICAgICAgICAgICBvd25lcnNbaV0gPSB3YXJyaW9yVG9Pd25lcltfd2Fycmlvcklkc1tpXV07CiAgICAgICAgfQogICAgfQogICAgCiAgICAKICAgIGZ1bmN0aW9uIF9zZXRXYXJyaW9yRGF0YSh1aW50MjU2W10gbWVtb3J5IHdhcnJpb3JzRGF0YSwgRGF0YVR5cGVzLldhcnJpb3Igc3RvcmFnZSB3YXJyaW9yLCB1aW50MzIgaWQpIGludGVybmFsIHZpZXcgewogICAgICAgIHdhcnJpb3JzRGF0YVtpZF0gPSB1aW50MjU2KHdhcnJpb3IuaWRlbnRpdHkpOy8vMAogICAgICAgIHdhcnJpb3JzRGF0YVtpZCArIDFdID0gdWludDI1Nih3YXJyaW9yLmNvb2xkb3duRW5kQmxvY2spOy8vMQogICAgICAgIHdhcnJpb3JzRGF0YVtpZCArIDJdID0gdWludDI1Nih3YXJyaW9yLmxldmVsKTsvLzIKICAgICAgICB3YXJyaW9yc0RhdGFbaWQgKyAzXSA9IHVpbnQyNTYod2Fycmlvci5yYXRpbmcpOy8vMwogICAgICAgIHdhcnJpb3JzRGF0YVtpZCArIDRdID0gdWludDI1Nih3YXJyaW9yLmFjdGlvbik7Ly80CiAgICAgICAgd2FycmlvcnNEYXRhW2lkICsgNV0gPSB1aW50MjU2KHdhcnJpb3IuZHVuZ2VvbkluZGV4KTsvLzUKICAgIH0KICAgIAoJZnVuY3Rpb24gZ2V0V2Fycmlvcih1aW50MjU2IF9pZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIAogICAgKAogICAgICAgIHVpbnQyNTYgaWRlbnRpdHksIAogICAgICAgIHVpbnQyNTYgY29vbGRvd25FbmRCbG9jaywgCiAgICAgICAgdWludDI1NiBsZXZlbCwKICAgICAgICB1aW50MjU2IHJhdGluZywgCiAgICAgICAgdWludDI1NiBhY3Rpb24sCiAgICAgICAgdWludDI1NiBkdW5nZW9uSW5kZXgKICAgICkgewogICAgICAgIERhdGFUeXBlcy5XYXJyaW9yIHN0b3JhZ2Ugd2FycmlvciA9IHdhcnJpb3JzW19pZF07CgogICAgICAgIGlkZW50aXR5ID0gdWludDI1Nih3YXJyaW9yLmlkZW50aXR5KTsKICAgICAgICBjb29sZG93bkVuZEJsb2NrID0gdWludDI1Nih3YXJyaW9yLmNvb2xkb3duRW5kQmxvY2spOwogICAgICAgIGxldmVsID0gdWludDI1Nih3YXJyaW9yLmxldmVsKTsKCQlyYXRpbmcgPSB1aW50MjU2KHdhcnJpb3IucmF0aW5nKTsKCQlhY3Rpb24gPSB1aW50MjU2KHdhcnJpb3IuYWN0aW9uKTsKCQlkdW5nZW9uSW5kZXggPSB1aW50MjU2KHdhcnJpb3IuZHVuZ2VvbkluZGV4KTsKICAgIH0KICAgIAp9CgoKY29udHJhY3QgUFZQIGlzIFBhdXNhYmxlLCBQVlBJbnRlcmZhY2UgewoJLyogUFZQIEJBVExFICovCgkKICAgIC8qKiBsaXN0IG9mIHBhY2tlZCB3YXJyaW9yIGRhdGEgdGhhdCB3aWxsIHBhcnRpY2lwYXRlIGluIG5leHQgUFZQIHNlc3Npb24uIAogICAgICogIEZpeGVkIHNpemUgYXJyeSwgdG8gZXZhZGUgY29uc3RhbnQgcmVtb3ZlIGFuZCBwdXNoIG9wZXJhdGlvbnMsCiAgICAgKiAgdGhpcyBhcHByb2FjaCByZWR1Y2VzIHRyYW5zYWN0aW9uIGNvc3RzIGludm9sdmluZyBxdWV1ZSBtb2RpZmljYXRpb24uICovCiAgICB1aW50MjU2WzEwMF0gcHVibGljIHB2cFF1ZXVlOwogICAgLy8KICAgIC8vcXVldWUgc2l6ZQogICAgdWludDI1NiBwdWJsaWMgcHZwUXVldWVTaXplID0gMDsKICAgIAogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGJvb3R5IGluIFdFSQogICAgLy8gIGJvb3R5IGlzIGFjcXVpcmVkIGluIFBWUCBhbmQgVG91cm5hbWVudCBiYXR0bGVzIGFuZCBjYW4gYmUKICAgIC8vIHdpdGhkcmF3biB3aXRoIGdyYWJCb290eSBtZXRob2QgYnkgdGhlIG93bmVyIG9mIHRoZSBsb290CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBvd25lclRvQm9vdHk7CiAgICAKICAgIC8vIEBkZXYgQSBtYXBwaW5nIGZyb20gd2FycmlvciBpZCB0byBvd25lcnMgYWRkcmVzcwogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBpbnRlcm5hbCB3YXJyaW9yVG9Pd25lcjsKICAgIAogICAgLy8gQW4gYXBwcm94aW1hdGlvbiBvZiBjdXJyZW50bHkgaG93IG1hbnkgc2Vjb25kcyBhcmUgaW4gYmV0d2VlbiBibG9ja3MuCiAgICB1aW50MjU2IGludGVybmFsIHNlY29uZHNQZXJCbG9jayA9IDE1OwogICAgCiAgICAvLyBDdXQgb3duZXIgdGFrZXMgZnJvbSwgbWVhc3VyZWQgaW4gYmFzaXMgcG9pbnRzICgxLzEwMCBvZiBhIHBlcmNlbnQpLgogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICB1aW50MjU2IHB1YmxpYyBwdnBPd25lckN1dDsKICAgIAogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICAvL3RoaXMgJSBvZiB0aGUgdG90YWwgYmV0cyB3aWxsIGJlIHNlbnQgYXMgCiAgICAvL2EgcmV3YXJkIHRvIGFkZHJlc3MsIHRoYXQgdHJpZ2dlcmVkIGZpbmlzaFBWUCBtZXRob2QKICAgIHVpbnQyNTYgcHVibGljIHB2cE1heEluY2VudGl2ZUN1dDsKICAgIAogICAgLy8vIEBub3RpY2UgVGhlIHBheW1lbnQgYmFzZSByZXF1aXJlZCB0byB1c2Ugc3RhcnRQVlAoKS4KICAgIC8vIHB2cEJhdHRsZUZlZSAqICh3YXJyaW9yLmxldmVsIC8gUE9JTlRTX1RPX0xFVkVMKQogICAgdWludDI1NiBpbnRlcm5hbCBwdnBCYXR0bGVGZWUgPSAyMCBmaW5uZXk7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBWUF9JTlRFUlZBTCA9IDE1IG1pbnV0ZXM7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIG5leHRQVlBCYXRsZUJsb2NrID0gMDsKICAgIC8vbnVtYmVyIG9mIFdFSSBpbiBoYW5kcyBvZiB3YXJyaW9yIG93bmVycwogICAgdWludDI1NiBwdWJsaWMgdG90YWxCb290eSA9IDA7CiAgICAKICAgIC8qIFRPVVJOQU1FTlQgKi8KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEZVTkRfR0FUSEVSSU5HX1RJTUUgPSAyNCBob3VyczsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEFETUlTU0lPTl9USU1FID0gMTIgaG91cnM7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBSQVRJTkdfRVhQQU5EX0lOVEVSVkFMID0gMSBob3VyczsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgU0FGRVRZX0dBUCA9IDU7CiAgICAKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgTUFYX0lOQ0VOVElWRV9SRVdBUkQgPSAyMDAgZmlubmV5OwogICAgCiAgICAvL3RvdXJuYW1lbnRDb250ZW5kZXJzIHNpemUKICAgIHVpbnQyNTYgcHVibGljIHRvdXJuYW1lbnRRdWV1ZVNpemUgPSAwOwogICAgCiAgICAvLyBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUKICAgIHVpbnQyNTYgcHVibGljIHRvdXJuYW1lbnRCYW5rQ3V0OwogICAgCiAgIC8qKiB0b3VybmFtZW50RW5kQmxvY2ssIHRvdXJuYW1lbnQgaXMgZWxpZ2libGUgdG8gYmUgZmluaXNoZWQgb25seQogICAgKiAgYWZ0ZXIgYmxvY2subnVtYmVyID49IHRvdXJuYW1lbnRFbmRCbG9jayAKICAgICogIGl0IGRlcGVuZHMgb24gRlVORF9HQVRIRVJJTkdfVElNRSBhbmQgQURNSVNTSU9OX1RJTUUgKi8KICAgIHVpbnQyNTYgcHVibGljIHRvdXJuYW1lbnRFbmRCbG9jazsKICAgIAogICAgLy9udW1iZXIgb2YgV0VJIGluIHRvdXJuYW1lbnQgYmFuawogICAgdWludDI1NiBwdWJsaWMgY3VycmVudFRvdXJuYW1lbnRCYW5rID0gMDsKICAgIHVpbnQyNTYgcHVibGljIG5leHRUb3VybmFtZW50QmFuayA9IDA7CiAgICAKICAgIFBWUExpc3RlbmVySW50ZXJmYWNlIGludGVybmFsIHB2cExpc3RlbmVyOwogICAgCiAgICAvKiBFVkVOVFMgKi8KICAgIC8qKiBAZGV2IFRvdXJuYW1lbnRTY2hlZHVsZWQgZXZlbnQuIEVtaXR0ZWQgZXZlcnkgdGltZSBhIHRvdXJuYW1lbnQgaXMgc2NoZWR1bGVkIAogICAgICogIEBwYXJhbSB0b3VybmFtZW50RW5kQmxvY2sgd2hlbiBibG9jay5udW1iZXIgPiB0b3VybmFtZW50RW5kQmxvY2ssIHRoZW4gdG91cm5hbWVudCAKICAgICAqICAgICAgICAgaXMgZWxpZ2libGUgdG8gYmUgZmluaXNoZWQgb3IgcmVzY2hlZHVsZWQgKi8KICAgIGV2ZW50IFRvdXJuYW1lbnRTY2hlZHVsZWQodWludDI1NiB0b3VybmFtZW50RW5kQmxvY2spOwogICAgCiAgICAvKiogQGRldiBQVlBTY2hlZHVsZWQgZXZlbnQuIEVtaXR0ZWQgZXZlcnkgdGltZSBhIHRvdXJuYW1lbnQgaXMgc2NoZWR1bGVkIAogICAgICogIEBwYXJhbSBuZXh0UFZQQmF0bGVCbG9jayB3aGVuIGJsb2NrLm51bWJlciA+IG5leHRQVlBCYXRsZUJsb2NrLCB0aGVuIHB2cCBiYXR0bGUgCiAgICAgKiAgICAgICAgIGlzIGVsaWdpYmxlIHRvIGJlIGZpbmlzaGVkIG9yIHJlc2NoZWR1bGVkICovCiAgICBldmVudCBQVlBTY2hlZHVsZWQodWludDI1NiBuZXh0UFZQQmF0bGVCbG9jayk7CiAgICAKICAgIC8qKiBAZGV2IFBWUE5ld0NvbnRlbmRlciBldmVudC4gRW1pdHRlZCBldmVyeSB0aW1lIGEgd2FycmlvciBlbnF1ZXVlcyBwdnAgYmF0dGxlCiAgICAgKiAgQHBhcmFtIG93bmVyIFdhcnJpb3Igb3duZXIKICAgICAqICBAcGFyYW0gd2FycmlvcklkIFdhcnJpb3IgSUQgdGhhdCBlbnRlcmVkIFBWUCBxdWV1ZQogICAgICogIEBwYXJhbSBlbnRyYW5jZUZlZSBmZWUgaW4gV0VJIHdhcnJpb3Igb3duZXIgcGF5ZWQgdG8gZW50ZXIgUFZQCiAgICAgKi8KICAgIGV2ZW50IFBWUE5ld0NvbnRlbmRlcihhZGRyZXNzIG93bmVyLCB1aW50MjU2IHdhcnJpb3JJZCwgdWludDI1NiBlbnRyYW5jZUZlZSk7CgogICAgLyoqIEBkZXYgUFZQRmluaXNoZWQgZXZlbnQuIEVtaXR0ZWQgZXZlcnkgdGltZSBhIHB2cCBiYXR0bGUgaXMgZmluaXNoZWQKICAgICAqICBAcGFyYW0gd2FycmlvcnNEYXRhIGFycmF5IG9mIHBhaXJzIG9mIHB2cCB3YXJyaW9ycyBwYWNrZWQgdG8gdWludDI1NiwgZXZlbiA9PiB3aW5uZXJzLCBvZGQgPT4gbG9zZXJzIAogICAgICogIEBwYXJhbSBvd25lcnMgYXJyYXkgb2Ygd2FycmlvciBvd25lcnMsIDEgdG8gMSB3aXRoIHdhcnJpb3JzRGF0YSwgZXZlbiA9PiB3aW5uZXJzLCBvZGQgPT4gbG9zZXJzIAogICAgICogIEBwYXJhbSBtYXRjaGluZ0NvdW50IHRvdGFsIG51bWJlciBvZiB3YXJyaW9ycyB0aGF0IGZvdWdodCBpbiBjdXJyZW50IHB2cCBzZXNzaW9uIGFuZCBnb3QgcmV3YXJkcywKICAgICAqICBpZiBtYXRjaGluZ0NvdW50IDwgcGFydGljaXBhbnRzLmxlbmd0aCB0aGVuIGFsbCBJRHMgdGhhdCBhcmUgPj0gbWF0Y2hpbmdDb3VudCB3aWxsIAogICAgICogIHJlbWFpbiBpbiB3YWl0aW5nIHJvb20sIHVudGlsIHRoZXkgYXJlIG1hdGNoZWQuCiAgICAgKi8KICAgIGV2ZW50IFBWUEZpbmlzaGVkKHVpbnQyNTZbXSB3YXJyaW9yc0RhdGEsIGFkZHJlc3NbXSBvd25lcnMsIHVpbnQyNTYgbWF0Y2hpbmdDb3VudCk7CiAgICAKICAgIC8qKiBAZGV2IEJvb3R5U2VuZEZhaWxlZCBldmVudC4gRW1pdHRlZCBldmVyeSB0aW1lIGFkZHJlc3Muc2VuZCgpIGZ1bmN0aW9uIGZhaWxlZCB0byB0cmFuc2ZlciBFdGhlciB0byByZWNpcGllbnQKICAgICAqICBpbiB0aGlzIGNhc2UgcmVjaXBpZW50IEV0aGVyIGlzIHJlY29yZGVkIHRvIG93bmVyVG9Cb290eSBtYXBwaW5nLCBzbyByZWNpcGllbnQgY2FuIHdpdGhkcmF3IHRoZWlyIGJvb3R5IG1hbnVhbGx5CiAgICAgKiAgQHBhcmFtIHJlY2lwaWVudCBhZGRyZXNzIGZvciB3aG9tIHNlbmQgZmFpbGVkCiAgICAgKiAgQHBhcmFtIGFtb3VudCBudW1iZXIgb2YgV0VJIHdlIGZhaWxlZCB0byBzZW5kCiAgICAgKi8KICAgIGV2ZW50IEJvb3R5U2VuZEZhaWxlZChhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBhbW91bnQpOwogICAgCiAgICAvKiogQGRldiBCb290eUdyYWJiZWQgZXZlbnQKICAgICAqICBAcGFyYW0gcmVjZWl2ZXIgYWRkcmVzcyB3aG8gZ3JhYmJlZCBoaXMgYm9vdHkKICAgICAqICBAcGFyYW0gYW1vdW50IG51bWJlciBvZiBXRUkKICAgICAqLwogICAgZXZlbnQgQm9vdHlHcmFiYmVkKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQyNTYgYW1vdW50KTsKICAgIAogICAgLyoqIEBkZXYgUFZQQ29udGVuZGVyUmVtb3ZlZCBldmVudC4gRW1pdHRlZCBldmVyeSB0aW1lIHdhcnJpb3IgaXMgcmVtb3ZlZCBmcm9tIHB2cCBxdWV1ZSBieSBpdHMgb3duZXIuCiAgICAgKiAgQHBhcmFtIHdhcnJpb3JJZCBpZCBvZiB0aGUgcmVtb3ZlZCB3YXJyaW9yCiAgICAgKi8KICAgIGV2ZW50IFBWUENvbnRlbmRlclJlbW92ZWQodWludDI1NiB3YXJyaW9ySWQsIGFkZHJlc3Mgb3duZXIpOwogICAgCiAgICBmdW5jdGlvbiBQVlAodWludDI1NiBfcHZwQ3V0LCB1aW50MjU2IF90b3VybmFtZW50QmFua0N1dCwgdWludDI1NiBfcHZwTWF4SW5jZW50aXZlQ3V0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoKF90b3VybmFtZW50QmFua0N1dCArIF9wdnBDdXQgKyBfcHZwTWF4SW5jZW50aXZlQ3V0KSA8PSAxMDAwMCk7CgkJcHZwT3duZXJDdXQgPSBfcHZwQ3V0OwoJCXRvdXJuYW1lbnRCYW5rQ3V0ID0gX3RvdXJuYW1lbnRCYW5rQ3V0OwoJCXB2cE1heEluY2VudGl2ZUN1dCA9IF9wdnBNYXhJbmNlbnRpdmVDdXQ7CiAgICB9CiAgICAKICAgIC8qKiBAZGV2IGdyYWJCb290eSBzZW5kcyB0byBtZXNzYWdlIHNlbmRlciBoaXMgYm9vdHkgaW4gV0VJCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdyYWJCb290eSgpIGV4dGVybmFsIHsKICAgICAgICB1aW50MjU2IGJvb3R5ID0gb3duZXJUb0Jvb3R5W21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUoYm9vdHkgPiAwKTsKICAgICAgICByZXF1aXJlKHRvdGFsQm9vdHkgPj0gYm9vdHkpOwogICAgICAgIAogICAgICAgIG93bmVyVG9Cb290eVttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgdG90YWxCb290eSAtPSBib290eTsKICAgICAgICAKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGJvb3R5KTsKICAgICAgICAvL2VtaXQgZXZlbnQKICAgICAgICBCb290eUdyYWJiZWQobXNnLnNlbmRlciwgYm9vdHkpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzYWZlU2VuZChhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQyNTYgX2FtYXVudCkgaW50ZXJuYWwgewoJCXVpbnQyNTYgZmFpbGVkQm9vdHkgPSBzZW5kQm9vdHkoX3JlY2lwaWVudCwgX2FtYXVudCk7CiAgICAgICAgaWYgKGZhaWxlZEJvb3R5ID4gMCkgewoJCQl0b3RhbEJvb3R5ICs9IGZhaWxlZEJvb3R5OwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2VuZEJvb3R5KGFkZHJlc3MgX3JlY2lwaWVudCwgdWludDI1NiBfYW1hdW50KSBpbnRlcm5hbCByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICBib29sIHN1Y2Nlc3MgPSBfcmVjaXBpZW50LnNlbmQoX2FtYXVudCk7CiAgICAgICAgaWYgKCFzdWNjZXNzICYmIF9hbWF1bnQgPiAwKSB7CiAgICAgICAgICAgIG93bmVyVG9Cb290eVtfcmVjaXBpZW50XSArPSBfYW1hdW50OwogICAgICAgICAgICBCb290eVNlbmRGYWlsZWQoX3JlY2lwaWVudCwgX2FtYXVudCk7CiAgICAgICAgICAgIHJldHVybiBfYW1hdW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KICAgIAogICAgLy9AcmV0dXJucyBibG9jayBudW1iZXIsIGFmdGVyIHRoaXMgYmxvY2sgdG91cm5hbWVudCBpcyBvcGVuZWQgZm9yIGFkbWlzc2lvbgogICAgZnVuY3Rpb24gZ2V0VG91cm5hbWVudEFkbWlzc2lvbkJsb2NrKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBhZG1pc3Npb25JbnRlcnZhbCA9IChBRE1JU1NJT05fVElNRSAvIHNlY29uZHNQZXJCbG9jayk7CiAgICAgICAgcmV0dXJuIHRvdXJuYW1lbnRFbmRCbG9jayA8IGFkbWlzc2lvbkludGVydmFsID8gMCA6IHRvdXJuYW1lbnRFbmRCbG9jayAtIGFkbWlzc2lvbkludGVydmFsOwogICAgfQogICAgCiAgICAKICAgIC8vc2NoZWR1bGVzIG5leHQgdHVybmFtZW50IHRpbWUoYmxvY2spCiAgICBmdW5jdGlvbiBfc2NoZWR1bGVUb3VybmFtZW50KCkgaW50ZXJuYWwgewogICAgICAgIC8vd2UgY2FuIGNoZWR1bGUgb25seSBpZiB0aGVyZSBpcyBub2JvZHkgaW4gdG91cm5hbWVudCBxdWV1ZSBhbmQKICAgICAgICAvL3RpbWUgb2YgdG91cm5hbWVudCBiYXR0bGUgaGF2ZSBwYXNzZWQKCQlpZiAodG91cm5hbWVudFF1ZXVlU2l6ZSA9PSAwICYmIHRvdXJuYW1lbnRFbmRCbG9jayA8PSBibG9jay5udW1iZXIpIHsKCQkgICAgdG91cm5hbWVudEVuZEJsb2NrID0gKChGVU5EX0dBVEhFUklOR19USU1FIC8gMiArIEFETUlTU0lPTl9USU1FKSAvIHNlY29uZHNQZXJCbG9jaykgKyBibG9jay5udW1iZXI7CgkJICAgIFRvdXJuYW1lbnRTY2hlZHVsZWQodG91cm5hbWVudEVuZEJsb2NrKTsKCQl9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFVwZGF0ZXMgdGhlIG1pbmltdW0gcGF5bWVudCByZXF1aXJlZCBmb3IgY2FsbGluZyBzdGFydFBWUCgpLiBDYW4gb25seQogICAgLy8vICBiZSBjYWxsZWQgYnkgdGhlIE93bmVyIGFkZHJlc3MsIGFuZCBvbmx5IGlmIHB2cCBxdWV1ZSBpcyBlbXB0eS4KICAgIGZ1bmN0aW9uIHNldFBWUEVudHJhbmNlRmVlKHVpbnQyNTYgdmFsdWUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShwdnBRdWV1ZVNpemUgPT0gMCk7CiAgICAgICAgcHZwQmF0dGxlRmVlID0gdmFsdWU7CiAgICB9CiAgICAKICAgIC8vQHJldHVybnMgUFZQIGVudHJhbmNlIGZlZSBmb3Igc3BlY2lmaWVkIHdhcnJpb3IgbGV2ZWwgCiAgICAvL0BwYXJhbSBfbGV2ZWxQb2ludHMgTkIhCiAgICBmdW5jdGlvbiBnZXRQVlBFbnRyYW5jZUZlZSh1aW50MjU2IF9sZXZlbFBvaW50cykgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gcHZwQmF0dGxlRmVlICogQ3J5cHRvVXRpbHMuX2dldExldmVsKF9sZXZlbFBvaW50cyk7CiAgICB9CiAgICAKICAgIC8vbGV2ZWwgY2FuIG9ubHkgYmUgPiAwIGFuZCA8PSAyNQogICAgZnVuY3Rpb24gX2dldFBWUEZlZUJ5TGV2ZWwodWludDI1NiBfbGV2ZWwpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHB2cEJhdHRsZUZlZSAqIF9sZXZlbDsKICAgIH0KICAgIAoJLy8gQGRldiBDb21wdXRlcyB3YXJyaW9yIHB2cCByZXdhcmQKICAgIC8vIEBwYXJhbSBfdG90YWxCZXQgLSB0b3RhbCBiZXQgZnJvbSBib3RoIGNvbXBldGl0b3JzLgogICAgZnVuY3Rpb24gX2NvbXB1dGVQVlBSZXdhcmQodWludDI1NiBfdG90YWxCZXQsIHVpbnQyNTYgX2NvbnRlbmRlcnNDdXQpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyBfdG90YWxCZXQgbWF4IHZhbHVlIGlzIDEwMDAgZmlubmV5LCBhbmQgX2NvbnRlbmRlcnNDdXQgYWthCiAgICAgICAgLy8gKDEwMDAwIC0gcHZwT3duZXJDdXQgLSB0b3VybmFtZW50QmFua0N1dCAtIGluY2VudGl2ZVJld2FyZEN1dCkgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gc3RhdGVtZW50IGluIHRoZSBCYXR0bGVQcm92aWRlciBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vIGZ1bmN0aW9uIGlzIGFsd2F5cyBndWFyYW50ZWVkIHRvIGJlIDw9IF90b3RhbEJldC4KICAgICAgICByZXR1cm4gX3RvdGFsQmV0ICogX2NvbnRlbmRlcnNDdXQgLyAxMDAwMDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dldFBWUENvbnRlbmRlcnNDdXQodWludDI1NiBfaW5jZW50aXZlQ3V0KSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vIChwdnBPd25lckN1dCArIHRvdXJuYW1lbnRCYW5rQ3V0ICsgcHZwTWF4SW5jZW50aXZlQ3V0KSA8PSAxMDAwMCAoc2VlIHRoZSByZXF1aXJlKCkKICAgICAgICAvLyBzdGF0ZW1lbnQgaW4gdGhlIEJhdHRsZVByb3ZpZGVyIGNvbnN0cnVjdG9yKS4gCiAgICAgICAgLy8gX2luY2VudGl2ZUN1dCBpcyBndWFyYW50ZWVkIHRvIGJlID49IDEgYW5kIDw9ICBwdnBNYXhJbmNlbnRpdmVDdXQKICAgICAgICByZXR1cm4gKDEwMDAwIC0gcHZwT3duZXJDdXQgLSB0b3VybmFtZW50QmFua0N1dCAtIF9pbmNlbnRpdmVDdXQpOwogICAgfQoJCgkvLyBAZGV2IENvbXB1dGVzIHdhcnJpb3IgcHZwIHJld2FyZAogICAgLy8gQHBhcmFtIF90b3RhbFNlc3Npb25Mb290IC0gdG90YWwgYmV0cyBmcm9tIGFsbCBjb21wZXRpdG9ycy4KICAgIGZ1bmN0aW9uIF9jb21wdXRlSW5jZW50aXZlUmV3YXJkKHVpbnQyNTYgX3RvdGFsU2Vzc2lvbkxvb3QsIHVpbnQyNTYgX2luY2VudGl2ZUN1dCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vIF90b3RhbFNlc3Npb25Mb290IG1heCB2YWx1ZSBpcyAzNzUwMCBmaW5uZXksIGFuZCAKICAgICAgICAvLyAocHZwT3duZXJDdXQgKyB0b3VybmFtZW50QmFua0N1dCArIGluY2VudGl2ZVJld2FyZEN1dCkgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gc3RhdGVtZW50IGluIHRoZSBCYXR0bGVQcm92aWRlciBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vIGZ1bmN0aW9uIGlzIGFsd2F5cyBndWFyYW50ZWVkIHRvIGJlIDw9IF90b3RhbFNlc3Npb25Mb290LgogICAgICAgIHJldHVybiBfdG90YWxTZXNzaW9uTG9vdCAqIF9pbmNlbnRpdmVDdXQgLyAxMDAwMDsKICAgIH0KICAgIAoJLy8vQGRldiBjb21wdXRlcyBpbmNlbnRpdmUgY3V0IGZvciBzcGVjaWZpZWQgbG9vdCwgCgkvLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCgkvLy8gbWF4IGluY2VudGl2ZSByZXdhcmQgY3V0IGlzIDUlLCBpZiBpdCBleGNlZWRzIE1BWF9JTkNFTlRJVkVfUkVXQVJELAoJLy8vIHRoZW4gY3V0IGlzIGxvd2VyZWQgdG8gYmUgZXF1YWwgdG8gTUFYX0lOQ0VOVElWRV9SRVdBUkQuCgkvLy8gbWluaW11bSBjdXQgaXMgMC4wMSUKICAgIC8vLyB0aGlzICUgb2YgdGhlIHRvdGFsIGJldHMgd2lsbCBiZSBzZW50IGFzIAogICAgLy8vIGEgcmV3YXJkIHRvIGFkZHJlc3MsIHRoYXQgdHJpZ2dlcmVkIGZpbmlzaFBWUCBtZXRob2QKICAgIGZ1bmN0aW9uIF9jb21wdXRlSW5jZW50aXZlQ3V0KHVpbnQyNTYgX3RvdGFsU2Vzc2lvbkxvb3QsIHVpbnQyNTYgbWF4SW5jZW50aXZlQ3V0KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIHVpbnQyNTYgcmVzdWx0ID0gX3RvdGFsU2Vzc2lvbkxvb3QgKiBtYXhJbmNlbnRpdmVDdXQgLyAxMDAwMDsKICAgICAgICByZXN1bHQgPSByZXN1bHQgPD0gTUFYX0lOQ0VOVElWRV9SRVdBUkQgPyBtYXhJbmNlbnRpdmVDdXQgOiBNQVhfSU5DRU5USVZFX1JFV0FSRCAqIDEwMDAwIC8gX3RvdGFsU2Vzc2lvbkxvb3Q7CiAgICAgICAgLy9taW4gY3V0IGlzIDAuMDElCiAgICAgICAgcmV0dXJuIHJlc3VsdCA+IDAgPyByZXN1bHQgOiAxOwogICAgfQogICAgCiAgICAvLyBAZGV2IENvbXB1dGVzIHdhcnJpb3IgcHZwIHJld2FyZAogICAgLy8gQHBhcmFtIF90b3RhbFNlc3Npb25Mb290IC0gdG90YWwgYmV0cyBmcm9tIGFsbCBjb21wZXRpdG9ycy4KICAgIGZ1bmN0aW9uIF9jb21wdXRlUFZQQmVuZWZpY2lhcnlGZWUodWludDI1NiBfdG90YWxTZXNzaW9uTG9vdCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgU2FmZU1hdGggKG9yIHNpbWlsYXIpIGluIHRoaXMgZnVuY3Rpb24gYmVjYXVzZQogICAgICAgIC8vIF90b3RhbFNlc3Npb25Mb290IG1heCB2YWx1ZSBpcyAzNzUwMCBmaW5uZXksIGFuZCAKICAgICAgICAvLyAocHZwT3duZXJDdXQgKyB0b3VybmFtZW50QmFua0N1dCArIGluY2VudGl2ZVJld2FyZEN1dCkgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gc3RhdGVtZW50IGluIHRoZSBCYXR0bGVQcm92aWRlciBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vIGZ1bmN0aW9uIGlzIGFsd2F5cyBndWFyYW50ZWVkIHRvIGJlIDw9IF90b3RhbFNlc3Npb25Mb290LgogICAgICAgIHJldHVybiBfdG90YWxTZXNzaW9uTG9vdCAqIHB2cE93bmVyQ3V0IC8gMTAwMDA7CiAgICB9CiAgICAKICAgIC8vIEBkZXYgQ29tcHV0ZXMgdG91cm5hbWVudCBiYW5rIGN1dAogICAgLy8gQHBhcmFtIF90b3RhbFNlc3Npb25Mb290IC0gdG90YWwgc2Vzc2lvbiBsb290LgogICAgZnVuY3Rpb24gX2NvbXB1dGVUb3VybmFtZW50Q3V0KHVpbnQyNTYgX3RvdGFsU2Vzc2lvbkxvb3QpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyBfdG90YWxTZXNzaW9uTG9vdCBtYXggdmFsdWUgaXMgMzc1MDAgZmlubmV5LCBhbmQgCiAgICAgICAgLy8gKHB2cE93bmVyQ3V0ICsgdG91cm5hbWVudEJhbmtDdXQgKyBpbmNlbnRpdmVSZXdhcmRDdXQpIDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vIHN0YXRlbWVudCBpbiB0aGUgQmF0dGxlUHJvdmlkZXIgY29uc3RydWN0b3IpLiBUaGUgcmVzdWx0IG9mIHRoaXMKICAgICAgICAvLyBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfdG90YWxTZXNzaW9uTG9vdC4KICAgICAgICByZXR1cm4gX3RvdGFsU2Vzc2lvbkxvb3QgKiB0b3VybmFtZW50QmFua0N1dCAvIDEwMDAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2YodWludDI1NiBfd2FycmlvcklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoaW50MjU2KSB7CgkgICAgdWludDI1NiBsZW5ndGggPSB1aW50MjU2KHB2cFF1ZXVlU2l6ZSk7CgkgICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKyspIHsKCSAgICAgICAgaWYoQ3J5cHRvVXRpbHMuX3VucGFja0lkVmFsdWUocHZwUXVldWVbaV0pID09IF93YXJyaW9ySWQpIHJldHVybiBpbnQyNTYoaSk7CgkgICAgfQoJICAgIHJldHVybiAtMTsKCX0KICAgIAogICAgZnVuY3Rpb24gZ2V0UFZQSW5jZW50aXZlUmV3YXJkKHVpbnQyNTZbXSBtZW1vcnkgbWF0Y2hpbmdJZHMsIHVpbnQyNTYgbWF0Y2hpbmdDb3VudCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHNlc3Npb25Mb290ID0gX2NvbXB1dGVUb3RhbEJvb3R5KG1hdGNoaW5nSWRzLCBtYXRjaGluZ0NvdW50KTsKICAgICAgICAKICAgICAgICByZXR1cm4gX2NvbXB1dGVJbmNlbnRpdmVSZXdhcmQoc2Vzc2lvbkxvb3QsIF9jb21wdXRlSW5jZW50aXZlQ3V0KHNlc3Npb25Mb290LCBwdnBNYXhJbmNlbnRpdmVDdXQpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbWF4UFZQQ29udGVuZGVycygpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gcHZwUXVldWUubGVuZ3RoOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRQVlBTdGF0ZSgpIGV4dGVybmFsIHZpZXcgcmV0dXJucwogICAgKHVpbnQyNTYgY29udGVuZGVyc0NvdW50LCB1aW50MjU2IG1hdGNoaW5nQ291bnQsIHVpbnQyNTYgZW5kQmxvY2ssIHVpbnQyNTYgaW5jZW50aXZlUmV3YXJkKQogICAgewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcHZwRGF0YSA9IF9wYWNrUFZQRGF0YSgpOwogICAgICAgIAogICAgCWNvbnRlbmRlcnNDb3VudCA9IHB2cFF1ZXVlU2l6ZTsKICAgIAltYXRjaGluZ0NvdW50ID0gQ3J5cHRvVXRpbHMuX2dldE1hdGNoaW5nSWRzKHB2cERhdGEsIFBWUF9JTlRFUlZBTCwgX2NvbXB1dGVDeWNsZVNraXAoKSwgUkFUSU5HX0VYUEFORF9JTlRFUlZBTCk7CiAgICAJZW5kQmxvY2sgPSBuZXh0UFZQQmF0bGVCbG9jazsgICAKICAgIAlpbmNlbnRpdmVSZXdhcmQgPSBnZXRQVlBJbmNlbnRpdmVSZXdhcmQocHZwRGF0YSwgbWF0Y2hpbmdDb3VudCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNhbkZpbmlzaFBWUCgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIG5leHRQVlBCYXRsZUJsb2NrIDw9IGJsb2NrLm51bWJlciAmJgogICAgICAgICBDcnlwdG9VdGlscy5fZ2V0TWF0Y2hpbmdJZHMoX3BhY2tQVlBEYXRhKCksIFBWUF9JTlRFUlZBTCwgX2NvbXB1dGVDeWNsZVNraXAoKSwgUkFUSU5HX0VYUEFORF9JTlRFUlZBTCkgPiAxOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfY2xhcmlmeVBWUFNjaGVkdWxlKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQyNTYgbGVuZ3RoID0gcHZwUXVldWVTaXplOwoJCXVpbnQyNTYgY3VycmVudEJsb2NrID0gYmxvY2subnVtYmVyOwoJCXVpbnQyNTYgbmV4dEJhdHRsZUJsb2NrID0gbmV4dFBWUEJhdGxlQmxvY2s7CgkJLy9pZiBiYXR0bGUgbm90IHNjaGVkdWxlZCwgc2NoZWR1bGUgYmF0dGxlCgkJaWYgKG5leHRCYXR0bGVCbG9jayA8PSBjdXJyZW50QmxvY2spIHsKCQkgICAgLy9pZiBxdWV1ZSBub3QgZW1wdHkgdXBkYXRlIGN5Y2xlcwoJCSAgICBpZiAobGVuZ3RoID4gMCkgewoJCQkJdWludDI1NiBwYWNrZWRXYXJyaW9yOwoJCQkJdWludDI1NiBjeWNsZVNraXAgPSBfY29tcHV0ZUN5Y2xlU2tpcCgpOwoJCSAgICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJCSAgICAgICAgICAgIHBhY2tlZFdhcnJpb3IgPSBwdnBRdWV1ZVtpXTsKCQkgICAgICAgICAgICAvL2luY3JlYXNlIHdhcnJpb3IgaXRlcmF0aW9uIGN5Y2xlCgkJICAgICAgICAgICAgcHZwUXVldWVbaV0gPSBDcnlwdG9VdGlscy5fY2hhbmdlQ3ljbGVWYWx1ZShwYWNrZWRXYXJyaW9yLCBDcnlwdG9VdGlscy5fdW5wYWNrQ3ljbGVWYWx1ZShwYWNrZWRXYXJyaW9yKSArIGN5Y2xlU2tpcCk7CgkJICAgICAgICB9CgkJICAgIH0KCQkgICAgbmV4dEJhdHRsZUJsb2NrID0gKFBWUF9JTlRFUlZBTCAvIHNlY29uZHNQZXJCbG9jaykgKyBjdXJyZW50QmxvY2s7CgkJICAgIG5leHRQVlBCYXRsZUJsb2NrID0gbmV4dEJhdHRsZUJsb2NrOwoJCSAgICBQVlBTY2hlZHVsZWQobmV4dEJhdHRsZUJsb2NrKTsKCQkvL2lmIHB2cCBxdWV1ZSB3aWxsIGJlIGZ1bGwgYW5kIHRoZXJlIGlzIHN0aWxsIHRvbyBtdWNoIHRpbWUgbGVmdCwgdGhlbiBsZXQgdGhlIGJhdHRsZSBiZWdpbiEgCgkJfSBlbHNlIGlmIChsZW5ndGggKyAxID09IHB2cFF1ZXVlLmxlbmd0aCAmJiAoY3VycmVudEJsb2NrICsgU0FGRVRZX0dBUCAqIDIpIDwgbmV4dEJhdHRsZUJsb2NrKSB7CgkJICAgIG5leHRCYXR0bGVCbG9jayA9IGN1cnJlbnRCbG9jayArIFNBRkVUWV9HQVA7CgkJICAgIG5leHRQVlBCYXRsZUJsb2NrID0gbmV4dEJhdHRsZUJsb2NrOwoJCSAgICBQVlBTY2hlZHVsZWQobmV4dEJhdHRsZUJsb2NrKTsKCQl9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEludGVybmFsIHV0aWxpdHkgZnVuY3Rpb24gdG8gaW5pdGlhdGUgcHZwIGJhdHRsZSwgYXNzdW1lcyB0aGF0IGFsbCBiYXR0bGUKICAgIC8vLyAgcmVxdWlyZW1lbnRzIGhhdmUgYmVlbiBjaGVja2VkLgogICAgZnVuY3Rpb24gX3RyaWdnZXJOZXdQVlBDb250ZW5kZXIoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3BhY2tlZFdhcnJpb3IsIHVpbnQyNTYgZmVlKSBpbnRlcm5hbCB7CgoJCV9jbGFyaWZ5UFZQU2NoZWR1bGUoKTsKICAgICAgICAvL251bWJlciBvZiBwdnAgY3ljbGVzIHRoZSB3YXJyaW9yIGlzIHdhaXRpbmcgZm9yIHN1aXRhYmxlIGVuZW15IG1hdGNoCiAgICAgICAgLy9pbmNyZW1lbnQgZXZlcnkgdGltZSB3aGVuIGZpbmlzaFBWUCBpcyBjYWxsZWQgYW5kIG5vIHN1aXRhYmxlIGVuZW15IG1hdGNoIHdhcyBmb3VuZAogICAgICAgIF9wYWNrZWRXYXJyaW9yID0gQ3J5cHRvVXRpbHMuX2NoYW5nZUN5Y2xlVmFsdWUoX3BhY2tlZFdhcnJpb3IsIDApOwoJCQoJCS8vcmVjb3JkIGNvbnRlbmRlciBkYXRhCgkJcHZwUXVldWVbcHZwUXVldWVTaXplKytdID0gX3BhY2tlZFdhcnJpb3I7CgkJd2FycmlvclRvT3duZXJbQ3J5cHRvVXRpbHMuX3VucGFja0lkVmFsdWUoX3BhY2tlZFdhcnJpb3IpXSA9IF9vd25lcjsKCQkKCQkvL0VtaXQgZXZlbnQKCQlQVlBOZXdDb250ZW5kZXIoX293bmVyLCBDcnlwdG9VdGlscy5fdW5wYWNrSWRWYWx1ZShfcGFja2VkV2FycmlvciksIGZlZSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9ub01hdGNoaW5nUGFpcnMoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHVpbnQyNTYgbWF0Y2hpbmdDb3VudCA9IENyeXB0b1V0aWxzLl9nZXRNYXRjaGluZ0lkcyhfcGFja1BWUERhdGEoKSwgdWludDY0KFBWUF9JTlRFUlZBTCksIF9jb21wdXRlQ3ljbGVTa2lwKCksIHVpbnQ2NChSQVRJTkdfRVhQQU5EX0lOVEVSVkFMKSk7CiAgICAgICAgcmV0dXJuIG1hdGNoaW5nQ291bnQgPT0gMDsKICAgIH0KICAgIAogICAgLyoKICAgICAqIEB0aXRsZSBzdGFydFBWUCBlbnF1ZXVlcyBzcGVjaWZpZWQgd2FycmlvciB0byBQVlAKICAgICAqIAogICAgICogQGRldiBXaGVuIHRoZSBvd25lciBlbnF1ZXVlcyBoaXMgd2FycmlvciBmb3IgUHZQLCB0aGUgd2FycmlvciBlbnRlcnMgdGhlIHdhaXRpbmcgcm9vbS4KICAgICAqIE9uY2UgZXZlcnkgMTUgbWludXRlcywgd2UgY2hlY2sgdGhlIHdhcnJpb3JzIGluIHRoZSByb29tIGFuZCBzZWxlY3QgcGFpcnMuIAogICAgICogRm9yIHRob3NlIHdhcnJpb3JzIHRvIHdob20gd2UgZm91bmQgY291cGxlcywgZmlnaHRpbmcgaXMgY29uZHVjdGVkIGFuZCB0aGUgcmVzdWx0cyAKICAgICAqIGFyZSByZWNvcmRlZCBpbiB0aGUgcHJvZmlsZSBvZiB0aGUgd2Fycmlvci4gCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZFBWUENvbnRlbmRlcihhZGRyZXNzIF9vd25lciwgdWludDI1NiBfcGFja2VkV2FycmlvcikgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKCQkvLyBDYWxsZXIgbXVzdCBiZSBwdnBMaXN0ZW5lciBjb250cmFjdAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHB2cExpc3RlbmVyKSk7CgogICAgICAgIHJlcXVpcmUoX293bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vY29udGVuZGVyIGNhbiBiZSBhZGRlZCBvbmx5IHdoaWxlIFBWUCBpcyBzY2hlZHVsZWQgaW4gZnV0dXJlCiAgICAgICAgLy9vciBubyBtYXRjaGluZyB3YXJyaW9yIHBhaXJzIGZvdW5kCiAgICAgICAgcmVxdWlyZShuZXh0UFZQQmF0bGVCbG9jayA+IGJsb2NrLm51bWJlciB8fCBfbm9NYXRjaGluZ1BhaXJzKCkpOwogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHdhcnJpb3IgZXhpc3RzLgogICAgICAgIHJlcXVpcmUoX3BhY2tlZFdhcnJpb3IgIT0gMCk7CiAgICAgICAgLy9vd25lciBtdXN0IHdpdGhkcmF3IGFsbCBsb290IGJlZm9yZSBjb250ZW5kaW5nIHB2cAogICAgICAgIHJlcXVpcmUob3duZXJUb0Jvb3R5W19vd25lcl0gPT0gMCk7CiAgICAgICAgLy9jaGVjayB0aGF0IHRoZXJlIGlzIGVub3VnaCByb29tIGZvciBuZXcgcGFydGljaXBhbnRzCiAgICAgICAgcmVxdWlyZShwdnBRdWV1ZVNpemUgPCBwdnBRdWV1ZS5sZW5ndGgpOwogICAgICAgIC8vIENoZWNrcyBmb3IgcGF5bWVudC4KICAgICAgICB1aW50MjU2IGZlZSA9IF9nZXRQVlBGZWVCeUxldmVsKENyeXB0b1V0aWxzLl91bnBhY2tMZXZlbFZhbHVlKF9wYWNrZWRXYXJyaW9yKSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gZmVlKTsKICAgICAgICAvLwogICAgICAgIC8vIEFsbCBjaGVja3MgcGFzc2VkLCBwdXQgdGhlIHdhcnJpb3IgdG8gdGhlIHF1ZXVlIQogICAgICAgIF90cmlnZ2VyTmV3UFZQQ29udGVuZGVyKF9vd25lciwgX3BhY2tlZFdhcnJpb3IsIGZlZSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9wYWNrUFZQRGF0YSgpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10gbWVtb3J5IG1hdGNoaW5nSWRzKSB7CiAgICAgICAgdWludDI1NiBsZW5ndGggPSBwdnBRdWV1ZVNpemU7CiAgICAgICAgbWF0Y2hpbmdJZHMgPSBuZXcgdWludDI1NltdKGxlbmd0aCk7CiAgICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICBtYXRjaGluZ0lkc1tpXSA9IHB2cFF1ZXVlW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbWF0Y2hpbmdJZHM7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9jb21wdXRlVG90YWxCb290eSh1aW50MjU2W10gbWVtb3J5IF9wYWNrZWRXYXJyaW9ycywgdWludDI1NiBtYXRjaGluZ0NvdW50KSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludDI1NikgewogICAgICAgIC8vY29tcHV0ZSBzZXNzaW9uIGJvb3R5CiAgICAgICAgdWludDI1NiBzZXNzaW9uTG9vdCA9IDA7CiAgICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBtYXRjaGluZ0NvdW50OyBpKyspIHsKICAgICAgICAgICAgc2Vzc2lvbkxvb3QgKz0gX2dldFBWUEZlZUJ5TGV2ZWwoQ3J5cHRvVXRpbHMuX3VucGFja0xldmVsVmFsdWUoX3BhY2tlZFdhcnJpb3JzW2ldKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZXNzaW9uTG9vdDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dyYW5kUFZQUmV3YXJkcyh1aW50MjU2W10gbWVtb3J5IF9wYWNrZWRXYXJyaW9ycywgdWludDI1NiBtYXRjaGluZ0NvdW50KSAKICAgIGludGVybmFsIHJldHVybnModWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IGJvb3R5ID0gMDsKICAgICAgICB1aW50MjU2IHBhY2tlZFdhcnJpb3I7CiAgICAgICAgdWludDI1NiBmYWlsZWRCb290eSA9IDA7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBzZXNzaW9uQm9vdHkgPSBfY29tcHV0ZVRvdGFsQm9vdHkoX3BhY2tlZFdhcnJpb3JzLCBtYXRjaGluZ0NvdW50KTsKICAgICAgICB1aW50MjU2IGluY2VudGl2ZUN1dCA9IF9jb21wdXRlSW5jZW50aXZlQ3V0KHNlc3Npb25Cb290eSwgcHZwTWF4SW5jZW50aXZlQ3V0KTsKICAgICAgICB1aW50MjU2IGNvbnRlbmRlcnNDdXQgPSBfZ2V0UFZQQ29udGVuZGVyc0N1dChpbmNlbnRpdmVDdXQpOwogICAgICAgIAogICAgICAgIGZvcih1aW50MjU2IGlkID0gMDsgaWQgPCBtYXRjaGluZ0NvdW50OyBpZCsrKSB7CiAgICAgICAgICAgIC8vZ2l2ZSByZXdhcmQgdG8gd2FycmlvcnMgdGhhdCBmb3VnaHQgaGFyZAoJCQkvL3dpbm5lciwgZXZlbiBpZHMgYXJlIHdpbm5lcnMhCgkJCXBhY2tlZFdhcnJpb3IgPSBfcGFja2VkV2FycmlvcnNbaWRdOwoJCQkvLwoJCQkvL2dpdmUgd2lubmVyIGRlc2VydmVkIGJvb3R5IDgwJSBmcm9tIGJvdGggYmV0cwoJCQkvL211c3QgYmUgY29tcHV0ZWQgYmVmb3JlIGxldmVsIHJld2FyZCEKCQkJYm9vdHkgPSBfZ2V0UFZQRmVlQnlMZXZlbChDcnlwdG9VdGlscy5fdW5wYWNrTGV2ZWxWYWx1ZShwYWNrZWRXYXJyaW9yKSkgKyAKCQkJCV9nZXRQVlBGZWVCeUxldmVsKENyeXB0b1V0aWxzLl91bnBhY2tMZXZlbFZhbHVlKF9wYWNrZWRXYXJyaW9yc1tpZCArIDFdKSk7CgkJCQoJCQkvLwoJCQkvL3NlbmQgcmV3YXJkIHRvIHdhcnJpb3Igb3duZXIKCQkJZmFpbGVkQm9vdHkgKz0gc2VuZEJvb3R5KHdhcnJpb3JUb093bmVyW0NyeXB0b1V0aWxzLl91bnBhY2tJZFZhbHVlKHBhY2tlZFdhcnJpb3IpXSwgX2NvbXB1dGVQVlBSZXdhcmQoYm9vdHksIGNvbnRlbmRlcnNDdXQpKTsKCQkJLy9sb3NlciwgdGhleSBhcmUgb2RkLi4uCgkJCS8vc2tpcCB0aGVtLCBhcyB0aGV5IGRlc2VydmUgbm9uZSEKCQkJaWQgKys7CiAgICAgICAgfQogICAgICAgIGZhaWxlZEJvb3R5ICs9IHNlbmRCb290eShwdnBMaXN0ZW5lci5nZXRCZW5lZmljaWFyeSgpLCBfY29tcHV0ZVBWUEJlbmVmaWNpYXJ5RmVlKHNlc3Npb25Cb290eSkpOwogICAgICAgIAogICAgICAgIGlmIChmYWlsZWRCb290eSA+IDApIHsKICAgICAgICAgICAgdG90YWxCb290eSArPSBmYWlsZWRCb290eTsKICAgICAgICB9CiAgICAgICAgLy9pZiB0b3VybmFtZW50IGFkbWlzc2lvbiBzdGFydCB0aW1lIG5vdCBwYXNzZWQKICAgICAgICAvL2FkZCB0b3VybmFtZW50IGN1dCB0byBjdXJyZW50IHRvdXJuYW1lbnQgYmFuaywKICAgICAgICAvL290aGVyd2lzZSB0byBuZXh0IHRvdXJuYW1lbnQgYmFuawogICAgICAgIGlmIChnZXRUb3VybmFtZW50QWRtaXNzaW9uQmxvY2soKSA+IGJsb2NrLm51bWJlcikgewogICAgICAgICAgICBjdXJyZW50VG91cm5hbWVudEJhbmsgKz0gX2NvbXB1dGVUb3VybmFtZW50Q3V0KHNlc3Npb25Cb290eSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV4dFRvdXJuYW1lbnRCYW5rICs9IF9jb21wdXRlVG91cm5hbWVudEN1dChzZXNzaW9uQm9vdHkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvL2NvbXB1dGUgaW5jZW50aXZlIHJld2FyZAogICAgICAgIHJldHVybiBfY29tcHV0ZUluY2VudGl2ZVJld2FyZChzZXNzaW9uQm9vdHksIGluY2VudGl2ZUN1dCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9pbmNyZWFzZUN5Y2xlQW5kVHJpbVF1ZXVlKHVpbnQyNTZbXSBtZW1vcnkgbWF0Y2hpbmdJZHMsIHVpbnQyNTYgbWF0Y2hpbmdDb3VudCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQzMiBsZW5ndGggPSB1aW50MzIobWF0Y2hpbmdJZHMubGVuZ3RoIC0gbWF0Y2hpbmdDb3VudCk7ICAKCQl1aW50MjU2IHBhY2tlZFdhcnJpb3I7CgkJdWludDI1NiBza2lwQ3ljbGVzID0gX2NvbXB1dGVDeWNsZVNraXAoKTsKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHBhY2tlZFdhcnJpb3IgPSBtYXRjaGluZ0lkc1ttYXRjaGluZ0NvdW50ICsgaV07CiAgICAgICAgICAgIC8vaW5jcmVhc2Ugd2FycmlvciBpdGVyYXRpb24gY3ljbGUKICAgICAgICAgICAgcHZwUXVldWVbaV0gPSBDcnlwdG9VdGlscy5fY2hhbmdlQ3ljbGVWYWx1ZShwYWNrZWRXYXJyaW9yLCBDcnlwdG9VdGlscy5fdW5wYWNrQ3ljbGVWYWx1ZShwYWNrZWRXYXJyaW9yKSArIHNraXBDeWNsZXMpOwogICAgICAgIH0KICAgICAgICAvL3RyaW0gcXVldWUJCiAgICAgICAgcHZwUXVldWVTaXplID0gbGVuZ3RoOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN5Y2xlU2tpcCgpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBudW1iZXIgPSBibG9jay5udW1iZXI7CiAgICAgICAgcmV0dXJuIG5leHRQVlBCYXRsZUJsb2NrID4gbnVtYmVyID8gMCA6IChudW1iZXIgLSBuZXh0UFZQQmF0bGVCbG9jaykgKiBzZWNvbmRzUGVyQmxvY2sgLyBQVlBfSU5URVJWQUwgKyAxOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfZ2V0V2Fycmlvck93bmVycyh1aW50MjU2W10gbWVtb3J5IHB2cERhdGEpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzc1tdIG1lbW9yeSBvd25lcnMpewogICAgICAgIHVpbnQyNTYgbGVuZ3RoID0gcHZwRGF0YS5sZW5ndGg7CiAgICAgICAgb3duZXJzID0gbmV3IGFkZHJlc3NbXShsZW5ndGgpOwogICAgICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgIG93bmVyc1tpXSA9IHdhcnJpb3JUb093bmVyW0NyeXB0b1V0aWxzLl91bnBhY2tJZFZhbHVlKHB2cERhdGFbaV0pXTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIEBkZXYgSW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbiB0byBpbml0aWF0ZSBwdnAgYmF0dGxlLCBhc3N1bWVzIHRoYXQgYWxsIGJhdHRsZQogICAgLy8vICByZXF1aXJlbWVudHMgaGF2ZSBiZWVuIGNoZWNrZWQuCiAgICBmdW5jdGlvbiBfdHJpZ2dlclBWUEZpbmlzaCh1aW50MjU2W10gbWVtb3J5IHB2cERhdGEsIHVpbnQyNTYgbWF0Y2hpbmdDb3VudCkgaW50ZXJuYWwgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICAvLwoJCS8vY29tcHV0ZSBiYXR0bGUgcmVzdWx0cyAgICAgICAgCiAgICAgICAgQ3J5cHRvVXRpbHMuX2dldFBWUEJhdHRsZVJlc3VsdHMocHZwRGF0YSwgbWF0Y2hpbmdDb3VudCwgbmV4dFBWUEJhdGxlQmxvY2spOwogICAgICAgIC8vCiAgICAgICAgLy9tYXJrIG5vdCBmb3VnaHQgd2FycmlvcnMgYW5kIHRyaW0gcXVldWUgCiAgICAgICAgX2luY3JlYXNlQ3ljbGVBbmRUcmltUXVldWUocHZwRGF0YSwgbWF0Y2hpbmdDb3VudCk7CiAgICAgICAgLy8KICAgICAgICAvL3NjaGVkdWxlIG5leHQgYmF0dGxlIHRpbWUKICAgICAgICBuZXh0UFZQQmF0bGVCbG9jayA9IChQVlBfSU5URVJWQUwgLyBzZWNvbmRzUGVyQmxvY2spICsgYmxvY2subnVtYmVyOwogICAgICAgIAogICAgICAgIC8vCiAgICAgICAgLy9zY2hlZHVsZSB0b3VybmFtZW50CiAgICAgICAgLy9pZiBjb250ZW5kZXJzQ291bnQgaXMgMCBhbmQgdG91cm5hbWVudCBub3Qgc2NoZWR1bGVkLCBzY2hlZHVsZSB0b3VybmFtZW50CiAgICAgICAgLy9OQiBNVVNUIGJlIGJlZm9yZSBfZ3JhbmRQVlBSZXdhcmRzKCkKICAgICAgICBfc2NoZWR1bGVUb3VybmFtZW50KCk7CiAgICAgICAgLy8gY29tcHV0ZSBhbmQgZ3JhbmQgcmV3YXJkcyB0byB3YXJyaW9ycywKICAgICAgICAvLyBwdXQgdG91cm5hbWVudCBjdXQgdG8gYmFuaywgbm90IHN1c2NlcHRpYmxlIHRvIHJlZW50cnkgYXR0YWNrIGJlY2F1c2Ugb2YgcmVxdWlyZShuZXh0UFZQQmF0bGVCbG9jayA8PSBibG9jay5udW1iZXIpOwogICAgICAgIC8vIGFuZCByZXF1aXJlKG51bWJlciBvZiBwYWlycyA+IDEpOwogICAgICAgIHVpbnQyNTYgaW5jZW50aXZlUmV3YXJkID0gX2dyYW5kUFZQUmV3YXJkcyhwdnBEYXRhLCBtYXRjaGluZ0NvdW50KTsKICAgICAgICAvLwogICAgICAgIC8vbm90aWZ5IHB2cCBsaXN0ZW5lciBjb250cmFjdAogICAgICAgIHB2cExpc3RlbmVyLnB2cEZpbmlzaGVkKHB2cERhdGEsIG1hdGNoaW5nQ291bnQpOwogICAgICAgIAogICAgICAgIC8vCiAgICAgICAgLy9maXJlIGV2ZW50CgkJUFZQRmluaXNoZWQocHZwRGF0YSwgX2dldFdhcnJpb3JPd25lcnMocHZwRGF0YSksIG1hdGNoaW5nQ291bnQpOwogICAgICAgIFBWUFNjaGVkdWxlZChuZXh0UFZQQmF0bGVCbG9jayk7CgkJCgkJcmV0dXJuIGluY2VudGl2ZVJld2FyZDsKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIEBkZXYgZmluaXNoUFZQIHRoaXMgbWV0aG9kIGZpbmRzIG1hdGNoZXMgb2Ygd2FycmlvciBwYWlycwogICAgICogaW4gd2FpdGluZyByb29tIGFuZCBjb21wdXRlcyByZXN1bHQgb2YgdGhlaXIgZmlnaHRzLgogICAgICogCiAgICAgKiBUaGUgd2lubmVyIGdldHMgKzEgbGV2ZWwsIHRoZSBsb3NlciBnZXRzICswLjUgbGV2ZWwKICAgICAqIFRoZSB3aW5uaW5nIHBsYXllciBnZXRzICsxMzAgcmF0aW5nCgkgKiBUaGUgbG9zaW5nIHBsYXllciBnZXRzIC0zMCBvciA3MCByYXRpbmcgKGlmIHdhcnJpb3IgbGV2ZWxVcHMgYWZ0ZXIgYmF0dGxlKSAuCiAgICAgKiBjYW4gYmUgY2FsbGVkIG9uY2UgaW4gMTVtaW4uCiAgICAgKiBOQiBJZiB0aGUgd2FycmlvciBpcyBub3QgcGlja2VkIHVwIGluIGFuIGhvdXIsIHRoZW4gd2UgZXhwYW5kIHRoZSByYW5nZSAKICAgICAqIG9mIHNlbGVjdGlvbiBieSAyNSByYXRpbmcgZWFjaCBob3VyLgogICAgICovCiAgICBmdW5jdGlvbiBmaW5pc2hQVlAoKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gYmF0dGxlIGludGVydmFsIGlzIG92ZXIKICAgICAgICByZXF1aXJlKG5leHRQVlBCYXRsZUJsb2NrIDw9IGJsb2NrLm51bWJlcik7CiAgICAgICAgLy8KCSAgICAvL21hdGNoIHdhcnJpb3JzCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBwdnBEYXRhID0gX3BhY2tQVlBEYXRhKCk7CiAgICAgICAgLy9tYXRjaCBpZHMgYW5kIHNvcnQgdGhlbSBhY2NvcmRpbmcgdG8gbWF0Y2hpbmcKICAgICAgICB1aW50MjU2IG1hdGNoaW5nQ291bnQgPSBDcnlwdG9VdGlscy5fZ2V0TWF0Y2hpbmdJZHMocHZwRGF0YSwgdWludDY0KFBWUF9JTlRFUlZBTCksIF9jb21wdXRlQ3ljbGVTa2lwKCksIHVpbnQ2NChSQVRJTkdfRVhQQU5EX0lOVEVSVkFMKSk7CgkJLy8gd2UgaGF2ZSBhdCBsZWFzdCAxIG1hdGNoaW5nIGJhdHRsZSBwYWlyCiAgICAgICAgcmVxdWlyZShtYXRjaGluZ0NvdW50ID4gMSk7CiAgICAgICAgCiAgICAgICAgLy8gV2hlbiB0aGUgYWxsIGNoZWNrcyBkb25lLCBjYWxjdWxhdGUgYWN0dWFsIGJhdHRsZSByZXN1bHQKICAgICAgICB1aW50MjU2IGluY2VudGl2ZVJld2FyZCA9IF90cmlnZ2VyUFZQRmluaXNoKHB2cERhdGEsIG1hdGNoaW5nQ291bnQpOwogICAgICAgIAogICAgICAgIC8vZ2l2ZSByZXdhcmQgZm9yIGluY2VudGl2ZQogICAgICAgIHNhZmVTZW5kKG1zZy5zZW5kZXIsIGluY2VudGl2ZVJld2FyZCk7CiAgICB9CgogICAgLy8gQGRldiBSZW1vdmVzIHNwZWNpZmllZCB3YXJyaW9yIGZyb20gUFZQIHF1ZXVlCiAgICAvLyAgc2V0cyB3YXJyaW9yIGZyZWUgKElETEUpIGFuZCByZXR1cm5zIHB2cCBlbnRyYW5jZSBmZWUgdG8gb3duZXIKICAgIC8vIEBub3RpY2UgVGhpcyBpcyBhIHN0YXRlLW1vZGlmeWluZyBmdW5jdGlvbiB0aGF0IGNhbgogICAgLy8gIGJlIGNhbGxlZCB3aGlsZSB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgLy8gQHBhcmFtIF93YXJyaW9ySWQgLSBJRCBvZiB3YXJyaW9yIGluIFBWUCBxdWV1ZQogICAgZnVuY3Rpb24gcmVtb3ZlUFZQQ29udGVuZGVyKHVpbnQzMiBfd2FycmlvcklkKSBleHRlcm5hbHsKICAgICAgICB1aW50MjU2IHF1ZXVlU2l6ZSA9IHB2cFF1ZXVlU2l6ZTsKICAgICAgICByZXF1aXJlKHF1ZXVlU2l6ZSA+IDApOwogICAgICAgIC8vIENhbGxlciBtdXN0IGJlIG93bmVyIG9mIHRoZSBzcGVjaWZpZWQgd2FycmlvcgogICAgICAgIHJlcXVpcmUod2FycmlvclRvT3duZXJbX3dhcnJpb3JJZF0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgLy93YXJyaW9yIG11c3QgYmUgaW4gcHZwIHF1ZXVlCiAgICAgICAgaW50MjU2IHdhcnJpb3JJbmRleCA9IGluZGV4T2YoX3dhcnJpb3JJZCk7CiAgICAgICAgcmVxdWlyZSh3YXJyaW9ySW5kZXggPj0gMCk7CiAgICAgICAgLy9ncmFiIHdhcnJpb3IgZGF0YQogICAgICAgIHVpbnQyNTYgd2FycmlvckRhdGEgPSBwdnBRdWV1ZVt1aW50MzIod2FycmlvckluZGV4KV07CiAgICAgICAgLy93YXJyaW9yIGN5Y2xlIG11c3QgYmUgPj0gNCAoPiB0aGFuIDEgaG91cikKICAgICAgICByZXF1aXJlKChDcnlwdG9VdGlscy5fdW5wYWNrQ3ljbGVWYWx1ZSh3YXJyaW9yRGF0YSkgKyBfY29tcHV0ZUN5Y2xlU2tpcCgpKSA+PSA0KTsKICAgICAgICAKICAgICAgICAvL3JlbW92ZSBmcm9tIHF1ZXVlCiAgICAgICAgaWYgKHVpbnQyNTYod2FycmlvckluZGV4KSA8IHF1ZXVlU2l6ZSAtIDEpIHsKCSAgICAgICAgcHZwUXVldWVbdWludDMyKHdhcnJpb3JJbmRleCldID0gcHZwUXVldWVbcHZwUXVldWVTaXplIC0gMV07CiAgICAgICAgfQogICAgICAgIHB2cFF1ZXVlU2l6ZSAtLTsKICAgICAgICAvL25vdGlmeSBiYXR0bGUgbGlzdGVuZXIKICAgICAgICBwdnBMaXN0ZW5lci5wdnBDb250ZW5kZXJSZW1vdmVkKF93YXJyaW9ySWQpOwogICAgICAgIC8vcmV0dXJuIHB2cCBiZXQKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKF9nZXRQVlBGZWVCeUxldmVsKENyeXB0b1V0aWxzLl91bnBhY2tMZXZlbFZhbHVlKHdhcnJpb3JEYXRhKSkpOwogICAgICAgIC8vRW1pdCBldmVudAogICAgICAgIFBWUENvbnRlbmRlclJlbW92ZWQoX3dhcnJpb3JJZCwgbXNnLnNlbmRlcik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFBWUEN5Y2xlcyh1aW50MzJbXSB3YXJyaW9ySWRzKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDMyW10pewogICAgICAgIHVpbnQyNTYgbGVuZ3RoID0gd2Fycmlvcklkcy5sZW5ndGg7CiAgICAgICAgdWludDMyW10gbWVtb3J5IGN5Y2xlcyA9IG5ldyB1aW50MzJbXShsZW5ndGgpOwogICAgICAgIGludDI1NiBpbmRleDsKICAgICAgICB1aW50MjU2IHNraXBDeWNsZXMgPSBfY29tcHV0ZUN5Y2xlU2tpcCgpOwoJICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrKSB7CgkgICAgICAgIGluZGV4ID0gaW5kZXhPZih3YXJyaW9ySWRzW2ldKTsKCSAgICAgICAgY3ljbGVzW2ldID0gaW5kZXggPj0gMCA/IHVpbnQzMihDcnlwdG9VdGlscy5fdW5wYWNrQ3ljbGVWYWx1ZShwdnBRdWV1ZVt1aW50MzIoaW5kZXgpXSkgKyBza2lwQ3ljbGVzKSA6IDA7CgkgICAgfQoJICAgIHJldHVybiBjeWNsZXM7CiAgICB9CiAgICAKICAgIC8vIEBkZXYgUmVtb3ZlIGFsbCBQVlAgY29udGVuZGVycyBmcm9tIFBWUCBxdWV1ZSAKICAgIC8vICBhbmQgcmV0dXJuIGFsbCBiZXRzIHRvIHdhcnJpb3Igb3duZXJzLgogICAgLy8gIE5COiB0aGlzIGlzIGVtZXJnZW5jeSBtZXRob2QsIHVzZWQgb25seSBpbiBmJSNeQHVwIHNpdHVhdGlvbgogICAgZnVuY3Rpb24gcmVtb3ZlQWxsUFZQQ29udGVuZGVycygpIGV4dGVybmFsIG9ubHlPd25lciB3aGVuUGF1c2VkIHsKICAgICAgICAvL3JlbW92ZSBhbGwgcHZwIGNvbnRlbmRlcnMKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IHB2cFF1ZXVlU2l6ZTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHdhcnJpb3JEYXRhOwogICAgICAgIHVpbnQyNTYgd2FycmlvcklkOwogICAgICAgIHVpbnQyNTYgZmFpbGVkQm9vdHk7CiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICAKICAgICAgICBwdnBRdWV1ZVNpemUgPSAwOwogICAgICAgIAogICAgICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKCSAgICAgICAgLy9ncmFiIHdhcnJpb3IgZGF0YQoJICAgICAgICB3YXJyaW9yRGF0YSA9IHB2cFF1ZXVlW2ldOwoJICAgICAgICB3YXJyaW9ySWQgPSBDcnlwdG9VdGlscy5fdW5wYWNrSWRWYWx1ZSh3YXJyaW9yRGF0YSk7CgkgICAgICAgIC8vbm90aWZ5IGJhdHRsZSBsaXN0ZW5lcgoJICAgICAgICBwdnBMaXN0ZW5lci5wdnBDb250ZW5kZXJSZW1vdmVkKHVpbnQzMih3YXJyaW9ySWQpKTsKCSAgICAgICAgCgkgICAgICAgIG93bmVyID0gd2FycmlvclRvT3duZXJbd2FycmlvcklkXTsKCSAgICAgICAgLy9yZXR1cm4gcHZwIGJldAoJICAgICAgICBmYWlsZWRCb290eSArPSBzZW5kQm9vdHkob3duZXIsIF9nZXRQVlBGZWVCeUxldmVsKENyeXB0b1V0aWxzLl91bnBhY2tMZXZlbFZhbHVlKHdhcnJpb3JEYXRhKSkpOwogICAgICAgIH0KICAgICAgICB0b3RhbEJvb3R5ICs9IGZhaWxlZEJvb3R5OwogICAgfQp9Cgpjb250cmFjdCBUb3VybmFtZW50IGlzIFBWUCB7CgogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBHUk9VUF9TSVpFID0gNTsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgREFUQV9TSVpFID0gMjsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgVEhSRVNIT0xEID0gMzAwOwogICAgCiAgLyoqIGxpc3Qgb2Ygd2FycmlvciBJRHMgdGhhdCB3aWxsIHBhcnRpY2lwYXRlIGluIG5leHQgdG91cm5hbWVudC4gCiAgICAqICBGaXhlZCBzaXplIGFycnksIHRvIGV2YWRlIGNvbnN0YW50IHJlbW92ZSBhbmQgcHVzaCBvcGVyYXRpb25zLAogICAgKiAgdGhpcyBhcHByb2FjaCByZWR1Y2VzIHRyYW5zYWN0aW9uIGNvc3RzIGludm9sdmluZyBhcnJheSBtb2RpZmljYXRpb24uICovCiAgICB1aW50MjU2WzE2MF0gcHVibGljIHRvdXJuYW1lbnRRdWV1ZTsKICAgIAogICAgLyoqVGhlIGNvc3Qgb2YgcGFydGljaXBhdGlvbiBpbiB0aGUgdG91cm5hbWVudCBpcyAxJSBvZiBpdHMgY3VycmVudCBwcml6ZSBmdW5kLCAKICAgICAqIG1vbmV5IGlzIGFkZGVkIHRvIHRoZSBwcml6ZSBmdW5kLiBtZWFzdXJlZCBpbiBiYXNpcyBwb2ludHMgKDEvMTAwIG9mIGEgcGVyY2VudCkuCiAgICAgKiBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgdG91cm5hbWVudEVudHJhbmNlRmVlQ3V0ID0gMTAwOwogICAgCiAgICAvLyBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUgPT4gMjAlCiAgICB1aW50MjU2IHB1YmxpYyB0b3VybmFtZW50T3duZXJzQ3V0OwogICAgdWludDI1NiBwdWJsaWMgdG91cm5hbWVudEluY2VudGl2ZUN1dDsKICAgIAogICAgIC8qKiBAZGV2IFRvdXJuYW1lbnROZXdDb250ZW5kZXIgZXZlbnQuIEVtaXR0ZWQgZXZlcnkgdGltZSBhIHdhcnJpb3IgZW50ZXJzIHRvdXJuYW1lbnQKICAgICAqICBAcGFyYW0gb3duZXIgV2FycmlvciBvd25lcgogICAgICogIEBwYXJhbSB3YXJyaW9ySWRzIDUgV2FycmlvciBJRHMgdGhhdCBlbnRlcmVkIHRvdXJuYW1lbnQsIHBhY2tlZCBpbnRvIG9uZSB1aW50MjU2CiAgICAgKiAgc2VlIENyeXB0b1V0aWxzLl9wYWNrV2FycmlvcklkcwogICAgICovCiAgICBldmVudCBUb3VybmFtZW50TmV3Q29udGVuZGVyKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgd2FycmlvcklkcywgdWludDI1NiBlbnRyYW5jZUZlZSk7CiAgICAKICAgIC8qKiBAZGV2IFRvdXJuYW1lbnRGaW5pc2hlZCBldmVudC4gRW1pdHRlZCBldmVyeSB0aW1lIGEgdG91cm5hbWVudCBpcyBmaW5pc2hlZAogICAgICogIEBwYXJhbSBvd25lcnMgYXJyYXkgb2Ygd2FycmlvciBncm91cCBvd25lcnMgcGFja2VkIHRvIHVpbnQyNTYKICAgICAqICBAcGFyYW0gcmVzdWx0cyBudW1iZXIgb2Ygd2lucyBmb3IgZWFjaCBncm91cAogICAgICogIEBwYXJhbSB0b3VybmFtZW50QmFuayBjdXJyZW50IHRvdXJuYW1lbnQgYmFuawogICAgICogIHNlZSBDcnlwdG9VdGlscy5fcGFja1dhcnJpb3JJZHMKICAgICAqLwogICAgZXZlbnQgVG91cm5hbWVudEZpbmlzaGVkKHVpbnQyNTZbXSBvd25lcnMsIHVpbnQzMltdIHJlc3VsdHMsIHVpbnQyNTYgdG91cm5hbWVudEJhbmspOwogICAgCiAgICBmdW5jdGlvbiBUb3VybmFtZW50KHVpbnQyNTYgX3B2cEN1dCwgdWludDI1NiBfdG91cm5hbWVudEJhbmtDdXQsIAogICAgdWludDI1NiBfcHZwTWF4SW5jZW50aXZlQ3V0LCB1aW50MjU2IF90b3VybmFtZW50T3duZXJzQ3V0LCB1aW50MjU2IF90b3VybmFtZW50SW5jZW50aXZlQ3V0KSBwdWJsaWMKICAgIFBWUChfcHZwQ3V0LCBfdG91cm5hbWVudEJhbmtDdXQsIF9wdnBNYXhJbmNlbnRpdmVDdXQpIAogICAgewogICAgICAgIHJlcXVpcmUoKF90b3VybmFtZW50T3duZXJzQ3V0ICsgX3RvdXJuYW1lbnRJbmNlbnRpdmVDdXQpIDw9IDEwMDAwKTsKCQkKCQl0b3VybmFtZW50T3duZXJzQ3V0ID0gX3RvdXJuYW1lbnRPd25lcnNDdXQ7CgkJdG91cm5hbWVudEluY2VudGl2ZUN1dCA9IF90b3VybmFtZW50SW5jZW50aXZlQ3V0OwogICAgfQogICAgCiAgICAKICAgIAogICAgLy8gQGRldiBDb21wdXRlcyBpbmNlbnRpdmUgcmV3YXJkIGZvciBsYXVuY2hpbmcgdG91cm5hbWVudCBmaW5pc2hUb3VybmFtZW50KCkKICAgIC8vIEBwYXJhbSBfdG91cm5hbWVudEJhbmsKICAgIGZ1bmN0aW9uIF9jb21wdXRlVG91cm5hbWVudEluY2VudGl2ZVJld2FyZCh1aW50MjU2IF9jdXJyZW50QmFuaywgdWludDI1NiBfaW5jZW50aXZlQ3V0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlIF9jdXJyZW50QmFuayBtYXggaXMgZXF1YWwgfiAyMDAwMDAwMCBmaW5uZXksCiAgICAgICAgLy8gYW5kICh0b3VybmFtZW50T3duZXJzQ3V0ICsgdG91cm5hbWVudEluY2VudGl2ZUN1dCkgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gc3RhdGVtZW50IGluIHRoZSBUb3VybmFtZW50IGNvbnN0cnVjdG9yKS4gVGhlIHJlc3VsdCBvZiB0aGlzCiAgICAgICAgLy8gZnVuY3Rpb24gaXMgYWx3YXlzIGd1YXJhbnRlZWQgdG8gYmUgPD0gX2N1cnJlbnRCYW5rLgogICAgICAgIHJldHVybiBfY3VycmVudEJhbmsgKiBfaW5jZW50aXZlQ3V0IC8gMTAwMDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9jb21wdXRlVG91cm5hbWVudENvbnRlbmRlckN1dCh1aW50MjU2IF9pbmNlbnRpdmVDdXQpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIE5PVEU6ICh0b3VybmFtZW50T3duZXJzQ3V0ICsgdG91cm5hbWVudEluY2VudGl2ZUN1dCkgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gc3RhdGVtZW50IGluIHRoZSBUb3VybmFtZW50IGNvbnN0cnVjdG9yKS4gVGhlIHJlc3VsdCBvZiB0aGlzCiAgICAgICAgLy8gZnVuY3Rpb24gaXMgYWx3YXlzIGd1YXJhbnRlZWQgdG8gYmUgPD0gX3Jld2FyZC4KICAgICAgICByZXR1cm4gMTAwMDAgLSB0b3VybmFtZW50T3duZXJzQ3V0IC0gX2luY2VudGl2ZUN1dDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2NvbXB1dGVUb3VybmFtZW50QmVuZWZpY2lhcnlGZWUodWludDI1NiBfY3VycmVudEJhbmspIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UgX2N1cnJlbnRCYW5rIG1heCBpcyBlcXVhbCB+IDIwMDAwMDAwIGZpbm5leSwKICAgICAgICAvLyBhbmQgKHRvdXJuYW1lbnRPd25lcnNDdXQgKyB0b3VybmFtZW50SW5jZW50aXZlQ3V0KSA8PSAxMDAwMCAoc2VlIHRoZSByZXF1aXJlKCkKICAgICAgICAvLyBzdGF0ZW1lbnQgaW4gdGhlIFRvdXJuYW1lbnQgY29uc3RydWN0b3IpLiBUaGUgcmVzdWx0IG9mIHRoaXMKICAgICAgICAvLyBmdW5jdGlvbiBpcyBhbHdheXMgZ3VhcmFudGVlZCB0byBiZSA8PSBfY3VycmVudEJhbmsuCiAgICAgICAgcmV0dXJuIF9jdXJyZW50QmFuayAqIHRvdXJuYW1lbnRPd25lcnNDdXQgLyAxMDAwMDsKICAgIH0KICAgIAogICAgLy8gQGRldiBzZXQgdG91cm5hbWVudCBlbnRyYW5jZSBmZWUgY3V0LCBjYW4gYmUgc2V0IG9ubHkgaWYKICAgIC8vIHRvdXJuYW1lbnQgcXVldWUgaXMgZW1wdHkKICAgIC8vIEBwYXJhbSBfY3V0IHJhbmdlIGZyb20gMCAtIDEwMDAwLCBtYXBwZWQgdG8gMC0xMDAlCiAgICBmdW5jdGlvbiBzZXRUb3VybmFtZW50RW50cmFuY2VGZWVDdXQodWludDI1NiBfY3V0KSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIC8vY3V0IG11c3QgYmUgbGVzcyBvciBlcXVhbCAxMDAmCiAgICAgICAgcmVxdWlyZShfY3V0IDw9IDEwMDAwKTsKICAgICAgICAvL3RvdXJuYW1lbnQgcXVldWUgbXVzdCBiZSBlbXB0eQogICAgICAgIHJlcXVpcmUodG91cm5hbWVudFF1ZXVlU2l6ZSA9PSAwKTsKICAgICAgICAvL2NoZWNrcyBwYXNzZWQsIHNldCBjdXQKCQl0b3VybmFtZW50RW50cmFuY2VGZWVDdXQgPSBfY3V0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRUb3VybmFtZW50RW50cmFuY2VGZWUoKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiBjdXJyZW50VG91cm5hbWVudEJhbmsgKiB0b3VybmFtZW50RW50cmFuY2VGZWVDdXQgLyAxMDAwMDsKICAgIH0KICAgIAogICAgLy9AZGV2IHJldHVybnMgdG91cm5hbWVudCBlbnRyYW5jZSBmZWUgLSAzJSB0aHJlc2hvbGQKICAgIGZ1bmN0aW9uIGdldFRvdXJuYW1lbnRUaHJlc2hvbGRGZWUoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gY3VycmVudFRvdXJuYW1lbnRCYW5rICogdG91cm5hbWVudEVudHJhbmNlRmVlQ3V0ICogKDEwMDAwIC0gVEhSRVNIT0xEKSAvIDEwMDAwIC8gMTAwMDA7CiAgICB9CiAgICAKICAgIC8vQGRldiByZXR1cm5zIG1heCBhbGxvd2VkIHRvdXJuYW1lbnQgY29udGVuZGVycywgcHVibGljIGJlY2F1c2Ugb2YgaW50ZXJuYWwgdXNlCiAgICBmdW5jdGlvbiBtYXhUb3VybmFtZW50Q29udGVuZGVycygpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIHRvdXJuYW1lbnRRdWV1ZS5sZW5ndGggLyBEQVRBX1NJWkU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNhbkZpbmlzaFRvdXJuYW1lbnQoKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiB0b3VybmFtZW50RW5kQmxvY2sgPD0gYmxvY2subnVtYmVyICYmIHRvdXJuYW1lbnRRdWV1ZVNpemUgPiAwOwogICAgfQogICAgCiAgICAvLyBAZGV2IEludGVybmFsIHV0aWxpdHkgZnVuY3Rpb24gdG8gc2lnaW4gdXAgdG8gdG91cm5hbWVudCwgCiAgICAvLyBhc3N1bWVzIHRoYXQgYWxsIGJhdHRsZSByZXF1aXJlbWVudHMgaGF2ZSBiZWVuIGNoZWNrZWQuCiAgICBmdW5jdGlvbiBfdHJpZ2dlck5ld1RvdXJuYW1lbnRDb250ZW5kZXIoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTZbXSBtZW1vcnkgX3RvdXJuYW1lbnREYXRhLCB1aW50MjU2IF9mZWUpIGludGVybmFsIHsKICAgICAgICAvL3BhY2sgd2FycmlvciBpZHMgaW50byB1aW50MjU2CiAgICAgICAgCiAgICAgICAgY3VycmVudFRvdXJuYW1lbnRCYW5rICs9IF9mZWU7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBwYWNrZWRXYXJyaW9ySWRzID0gQ3J5cHRvVXRpbHMuX3BhY2tXYXJyaW9ySWRzKF90b3VybmFtZW50RGF0YSk7CiAgICAgICAgLy9tYWtlIGNvbXBvc2l0ZSB3YXJyaW9yIG91dCBvZiA1IHdhcnJpb3JzIAogICAgICAgIHVpbnQyNTYgY29tYmluZWRXYXJyaW9yID0gQ3J5cHRvVXRpbHMuX2NvbWJpbmVXYXJyaW9ycyhfdG91cm5hbWVudERhdGEpOwogICAgICAgIAogICAgICAgIC8vYWRkIHRvIHF1ZXVlCiAgICAgICAgLy9pY3JlbWVudCB0b3VybmFtZW50IHF1ZXVlCiAgICAgICAgdWludDI1NiBzaXplID0gdG91cm5hbWVudFF1ZXVlU2l6ZSsrICogREFUQV9TSVpFOwogICAgICAgIC8vcmVjb3JkIHRvdXJuYW1lbnQgZGF0YQoJCXRvdXJuYW1lbnRRdWV1ZVtzaXplKytdID0gcGFja2VkV2FycmlvcklkczsKCQl0b3VybmFtZW50UXVldWVbc2l6ZSsrXSA9IGNvbWJpbmVkV2FycmlvcjsKCQl3YXJyaW9yVG9Pd25lcltDcnlwdG9VdGlscy5fdW5wYWNrV2FycmlvcklkKHBhY2tlZFdhcnJpb3JJZHMsIDApXSA9IF9vd25lcjsKCQkvLwoJCS8vRW1pdCBldmVudAoJCVRvdXJuYW1lbnROZXdDb250ZW5kZXIoX293bmVyLCBwYWNrZWRXYXJyaW9ySWRzLCBfZmVlKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkVG91cm5hbWVudENvbnRlbmRlcihhZGRyZXNzIF9vd25lciwgdWludDI1NltdIF90b3VybmFtZW50RGF0YSkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkewogICAgICAgIC8vIENhbGxlciBtdXN0IGJlIHB2cExpc3RlbmVyIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MocHZwTGlzdGVuZXIpKTsKICAgICAgICAKICAgICAgICByZXF1aXJlKF9vd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLwogICAgICAgIC8vY2hlY2sgY3VycmVudCB0b3VybmFtZW50IGJhbmsgPiAwCiAgICAgICAgcmVxdWlyZShwdnBCYXR0bGVGZWUgPT0gMCB8fCBjdXJyZW50VG91cm5hbWVudEJhbmsgPiAwKTsKICAgICAgICAvLwogICAgICAgIC8vY2hlY2sgdGhhdCB0aGVyZSBpcyBlbm91Z2ggZnVuZHMgdG8gcGF5IGVudHJhbmNlIGZlZQogICAgICAgIHVpbnQyNTYgZmVlID0gZ2V0VG91cm5hbWVudFRocmVzaG9sZEZlZSgpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGZlZSk7CiAgICAgICAgLy9vd25lciBtdXN0IHdpdGhkcmF3IGFsbCBib290eSBiZWZvcmUgY29udGVuZGluZyBwdnAKICAgICAgICByZXF1aXJlKG93bmVyVG9Cb290eVtfb3duZXJdID09IDApOwogICAgICAgIC8vCiAgICAgICAgLy9jaGVjayB0aGF0IHdhcnJpb3JzIGdyb3VwIGlzIGV4YWN0bHkgb2YgYWxsb3dlZCBzaXplCiAgICAgICAgcmVxdWlyZShfdG91cm5hbWVudERhdGEubGVuZ3RoID09IEdST1VQX1NJWkUpOwogICAgICAgIC8vCiAgICAgICAgLy9jaGVjayB0aGF0IHRoZXJlIGlzIGVub3VnaCByb29tIGZvciBuZXcgcGFydGljaXBhbnRzCiAgICAgICAgcmVxdWlyZSh0b3VybmFtZW50UXVldWVTaXplIDwgbWF4VG91cm5hbWVudENvbnRlbmRlcnMoKSk7CiAgICAgICAgLy8KICAgICAgICAvL2NoZWNrIHRoYXQgYWRtaXNzaW9uIHN0YXJ0ZWQKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+PSBnZXRUb3VybmFtZW50QWRtaXNzaW9uQmxvY2soKSk7CiAgICAgICAgLy9jaGVjayB0aGF0IGFkbWlzc2lvbiBub3QgZW5kZWQKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA8PSB0b3VybmFtZW50RW5kQmxvY2spOwogICAgICAgIAogICAgICAgIC8vYWxsIGNoZWNrcyBwYXNzZWQsIHRyaWdnZXIgc2lnbiB1cAogICAgICAgIF90cmlnZ2VyTmV3VG91cm5hbWVudENvbnRlbmRlcihfb3duZXIsIF90b3VybmFtZW50RGF0YSwgZmVlKTsKICAgIH0KICAgIAogICAgLy9AZGV2IGNvbGxlY3QgYWxsIGNvbWJpbmVkIHdhcnJpb3JzIGRhdGEKICAgIGZ1bmN0aW9uIGdldENvbWJpbmVkV2FycmlvcnMoKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdIG1lbW9yeSB3YXJyaW9yc0RhdGEpIHsKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IHRvdXJuYW1lbnRRdWV1ZVNpemU7CiAgICAgICAgd2FycmlvcnNEYXRhID0gbmV3IHVpbnQyNTZbXShsZW5ndGgpOwogICAgICAgIAogICAgICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgIC8vIEdyYWIgdGhlIGNvbWJpbmVkIHdhcnJpb3IgZGF0YSBpbiBzdG9yYWdlLgogICAgICAgICAgICB3YXJyaW9yc0RhdGFbaV0gPSB0b3VybmFtZW50UXVldWVbaSAqIERBVEFfU0laRSArIDFdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gd2FycmlvcnNEYXRhOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRUb3VybmFtZW50U3RhdGUoKSBleHRlcm5hbCB2aWV3IHJldHVybnMKICAgICh1aW50MjU2IGNvbnRlbmRlcnNDb3VudCwgdWludDI1NiBiYW5rLCB1aW50MjU2IGFkbWlzc2lvblN0YXJ0QmxvY2ssIHVpbnQyNTYgZW5kQmxvY2ssIHVpbnQyNTYgaW5jZW50aXZlUmV3YXJkKQogICAgewogICAgCWNvbnRlbmRlcnNDb3VudCA9IHRvdXJuYW1lbnRRdWV1ZVNpemU7CiAgICAJYmFuayA9IGN1cnJlbnRUb3VybmFtZW50QmFuazsKICAgIAlhZG1pc3Npb25TdGFydEJsb2NrID0gZ2V0VG91cm5hbWVudEFkbWlzc2lvbkJsb2NrKCk7ICAgCiAgICAJZW5kQmxvY2sgPSB0b3VybmFtZW50RW5kQmxvY2s7CiAgICAJaW5jZW50aXZlUmV3YXJkID0gX2NvbXB1dGVUb3VybmFtZW50SW5jZW50aXZlUmV3YXJkKGJhbmssIF9jb21wdXRlSW5jZW50aXZlQ3V0KGJhbmssIHRvdXJuYW1lbnRJbmNlbnRpdmVDdXQpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3JlcGFja1RvQ29tYmluZWRJZHModWludDI1NltdIG1lbW9yeSBfd2FycmlvcnNEYXRhKSBpbnRlcm5hbCB2aWV3IHsKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IF93YXJyaW9yc0RhdGEubGVuZ3RoOwogICAgICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgIF93YXJyaW9yc0RhdGFbaV0gPSB0b3VybmFtZW50UXVldWVbaSAqIERBVEFfU0laRV07CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBAZGV2IENvbXB1dGVzIHdhcnJpb3IgcHZwIHJld2FyZAogICAgLy8gQHBhcmFtIF90b3RhbEJldCAtIHRvdGFsIGJldCBmcm9tIGJvdGggY29tcGV0aXRvcnMuCiAgICBmdW5jdGlvbiBfY29tcHV0ZVRvdXJuYW1lbnRCb290eSh1aW50MjU2IF9jdXJyZW50QmFuaywgdWludDI1NiBfY29udGVuZGVyUmVzdWx0LCB1aW50MjU2IF90b3RhbEJhdHRsZXMpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UgX2N1cnJlbnRCYW5rIG1heCBpcyBlcXVhbCB+IDIwMDAwMDAwIGZpbm5leSwKICAgICAgICAvLyBfdG90YWxCYXR0bGVzIGlzIGd1YXJhbnRlZWQgdG8gYmUgPiAwIGFuZCA8PSA0MDAsIGFuZCAodG91cm5hbWVudE93bmVyc0N1dCArIHRvdXJuYW1lbnRJbmNlbnRpdmVDdXQpIDw9IDEwMDAwIChzZWUgdGhlIHJlcXVpcmUoKQogICAgICAgIC8vIHN0YXRlbWVudCBpbiB0aGUgVG91cm5hbWVudCBjb25zdHJ1Y3RvcikuIFRoZSByZXN1bHQgb2YgdGhpcwogICAgICAgIC8vIGZ1bmN0aW9uIGlzIGFsd2F5cyBndWFyYW50ZWVkIHRvIGJlIDw9IF9yZXdhcmQuCiAgICAgICAgLy8gcmV0dXJuIF9jdXJyZW50QmFuayAqICgxMDAwMCAtIHRvdXJuYW1lbnRPd25lcnNDdXQgLSBfaW5jZW50aXZlQ3V0KSAqIF9yZXN1bHQgLyAxMDAwMCAvIF90b3RhbEJhdHRsZXM7CiAgICAgICAgcmV0dXJuIF9jdXJyZW50QmFuayAqIF9jb250ZW5kZXJSZXN1bHQgLyBfdG90YWxCYXR0bGVzOwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBfZ3JhbmRUb3VybmFtZW50Qm9vdHkodWludDI1NiBfd2FycmlvcklkcywgdWludDI1NiBfY3VycmVudEJhbmssIHVpbnQyNTYgX2NvbnRlbmRlclJlc3VsdCwgdWludDI1NiBfdG90YWxCYXR0bGVzKQogICAgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IHdhcnJpb3JJZCA9IENyeXB0b1V0aWxzLl91bnBhY2tXYXJyaW9ySWQoX3dhcnJpb3JJZHMsIDApOwogICAgICAgIGFkZHJlc3Mgb3duZXIgPSB3YXJyaW9yVG9Pd25lclt3YXJyaW9ySWRdOwogICAgICAgIHVpbnQyNTYgYm9vdHkgPSBfY29tcHV0ZVRvdXJuYW1lbnRCb290eShfY3VycmVudEJhbmssIF9jb250ZW5kZXJSZXN1bHQsIF90b3RhbEJhdHRsZXMpOwogICAgICAgIHJldHVybiBzZW5kQm9vdHkob3duZXIsIGJvb3R5KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dyYW5kVG91cm5hbWVudFJld2FyZHModWludDI1NiBfY3VycmVudEJhbmssIHVpbnQyNTZbXSBtZW1vcnkgX3dhcnJpb3JzRGF0YSwgdWludDMyW10gbWVtb3J5IF9yZXN1bHRzKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IF93YXJyaW9yc0RhdGEubGVuZ3RoOwogICAgICAgIHVpbnQyNTYgdG90YWxCYXR0bGVzID0gQ3J5cHRvVXRpbHMuX2dldFRvdXJuYW1lbnRCYXR0bGVzKGxlbmd0aCkgKiAxMDAwMDsvLyoxMDAwMCByZXF1aXJlZCBmb3IgYm9vdHkgY29tcHV0YXRpb24KICAgICAgICB1aW50MjU2IGluY2VudGl2ZUN1dCA9IF9jb21wdXRlSW5jZW50aXZlQ3V0KF9jdXJyZW50QmFuaywgdG91cm5hbWVudEluY2VudGl2ZUN1dCk7CiAgICAgICAgdWludDI1NiBjb250ZW5kZXJDdXQgPSBfY29tcHV0ZVRvdXJuYW1lbnRDb250ZW5kZXJDdXQoaW5jZW50aXZlQ3V0KTsKICAgICAgICAKICAgICAgICB1aW50MjU2IGZhaWxlZEJvb3R5ID0gMDsKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGxlbmd0aDsgaSArKykgewogICAgICAgICAgICAvL2dyYW5kIHJld2FyZHMKICAgICAgICAgICAgZmFpbGVkQm9vdHkgKz0gX2dyYW5kVG91cm5hbWVudEJvb3R5KF93YXJyaW9yc0RhdGFbaV0sIF9jdXJyZW50QmFuaywgX3Jlc3VsdHNbaV0gKiBjb250ZW5kZXJDdXQsIHRvdGFsQmF0dGxlcyk7CiAgICAgICAgfQogICAgICAgIC8vc2VuZCBiZW5lZmljaWFyeSBmZWUKICAgICAgICBmYWlsZWRCb290eSArPSBzZW5kQm9vdHkocHZwTGlzdGVuZXIuZ2V0QmVuZWZpY2lhcnkoKSwgX2NvbXB1dGVUb3VybmFtZW50QmVuZWZpY2lhcnlGZWUoX2N1cnJlbnRCYW5rKSk7CiAgICAgICAgaWYgKGZhaWxlZEJvb3R5ID4gMCkgewogICAgICAgICAgICB0b3RhbEJvb3R5ICs9IGZhaWxlZEJvb3R5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2NvbXB1dGVUb3VybmFtZW50SW5jZW50aXZlUmV3YXJkKF9jdXJyZW50QmFuaywgaW5jZW50aXZlQ3V0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3JlcGFja1RvV2Fycmlvck93bmVycyh1aW50MjU2W10gbWVtb3J5IHdhcnJpb3JzRGF0YSkgaW50ZXJuYWwgdmlldyB7CiAgICAgICAgdWludDI1NiBsZW5ndGggPSB3YXJyaW9yc0RhdGEubGVuZ3RoOwogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGxlbmd0aDsgaSArKykgewogICAgICAgICAgICB3YXJyaW9yc0RhdGFbaV0gPSB1aW50MjU2KHdhcnJpb3JUb093bmVyW0NyeXB0b1V0aWxzLl91bnBhY2tXYXJyaW9ySWQod2FycmlvcnNEYXRhW2ldLCAwKV0pOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3RyaWdnZXJGaW5pc2hUb3VybmFtZW50KCkgaW50ZXJuYWwgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICAvL2hvbGQgMTAgcmFuZG9tIGJhdHRsZXMgZm9yIGVhY2ggY29tcG9zaXRlIHdhcnJpb3IKICAgICAgICB1aW50MjU2W10gbWVtb3J5IHdhcnJpb3JzRGF0YSA9IGdldENvbWJpbmVkV2FycmlvcnMoKTsKICAgICAgICB1aW50MzJbXSBtZW1vcnkgcmVzdWx0cyA9IENyeXB0b1V0aWxzLmdldFRvdXJuYW1lbnRCYXR0bGVSZXN1bHRzKHdhcnJpb3JzRGF0YSwgdG91cm5hbWVudEVuZEJsb2NrIC0gMSk7CiAgICAgICAgLy9yZXBhY2sgY29tYmluZWQgd2FycmlvcnMgaWQKICAgICAgICBfcmVwYWNrVG9Db21iaW5lZElkcyh3YXJyaW9yc0RhdGEpOwogICAgICAgIC8vbm90aWZ5IHB2cCBsaXN0ZW5lcgogICAgICAgIHB2cExpc3RlbmVyLnRvdXJuYW1lbnRGaW5pc2hlZCh3YXJyaW9yc0RhdGEpOwogICAgICAgIC8vcmVzY2hlZHVsZQogICAgICAgIC8vY2xlYXIgdG91cm5hbWVudAogICAgICAgIHRvdXJuYW1lbnRRdWV1ZVNpemUgPSAwOwogICAgICAgIC8vc2NoZWR1bGUgbmV3IHRvdXJuYW1lbnQKICAgICAgICBfc2NoZWR1bGVUb3VybmFtZW50KCk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBjdXJyZW50QmFuayA9IGN1cnJlbnRUb3VybmFtZW50QmFuazsKICAgICAgICBjdXJyZW50VG91cm5hbWVudEJhbmsgPSAwOy8vbnVsbGlmeSBiZWZvcmUgc2VuZGluZyB0byB1c2VycwogICAgICAgIC8vZ3JhbmQgcmV3YXJkcywgbm90IHN1c2NlcHRpYmxlIHRvIHJlZW50cnkgYXR0YWNrCiAgICAgICAgLy9iZWNhdXNlIG9mIHJlcXVpcmUodG91cm5hbWVudEVuZEJsb2NrIDw9IGJsb2NrLm51bWJlcikKICAgICAgICAvL2FuZCByZXF1aXJlKHRvdXJuYW1lbnRRdWV1ZVNpemUgPiAwKSBhbmQgY3VycmVudFRvdXJuYW1lbnRCYW5rID09IDAKICAgICAgICB1aW50MjU2IGluY2VudGl2ZVJld2FyZCA9IF9ncmFuZFRvdXJuYW1lbnRSZXdhcmRzKGN1cnJlbnRCYW5rLCB3YXJyaW9yc0RhdGEsIHJlc3VsdHMpOwogICAgICAgIAogICAgICAgIGN1cnJlbnRUb3VybmFtZW50QmFuayA9IG5leHRUb3VybmFtZW50QmFuazsKICAgICAgICBuZXh0VG91cm5hbWVudEJhbmsgPSAwOwogICAgICAgIAogICAgICAgIF9yZXBhY2tUb1dhcnJpb3JPd25lcnMod2FycmlvcnNEYXRhKTsKICAgICAgICAKICAgICAgICAvL2VtaXQgZXZlbnQKICAgICAgICBUb3VybmFtZW50RmluaXNoZWQod2FycmlvcnNEYXRhLCByZXN1bHRzLCBjdXJyZW50QmFuayk7CgogICAgICAgIHJldHVybiBpbmNlbnRpdmVSZXdhcmQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGZpbmlzaFRvdXJuYW1lbnQoKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvL21ha2UgYWxsIHRoZSBjaGVja3MKICAgICAgICAvLyB0b3VybmFtZW50IGlzIHJlYWR5IHRvIGJlIGV4ZWN1dGVkCiAgICAgICAgcmVxdWlyZSh0b3VybmFtZW50RW5kQmxvY2sgPD0gYmxvY2subnVtYmVyKTsKICAgICAgICAvLyB3ZSBoYXZlIHBhcnRpY2lwYW50cwogICAgICAgIHJlcXVpcmUodG91cm5hbWVudFF1ZXVlU2l6ZSA+IDApOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgaW5jZW50aXZlUmV3YXJkID0gX3RyaWdnZXJGaW5pc2hUb3VybmFtZW50KCk7CiAgICAgICAgCiAgICAgICAgLy9naXZlIHJld2FyZCBmb3IgaW5jZW50aXZlCiAgICAgICAgc2FmZVNlbmQobXNnLnNlbmRlciwgaW5jZW50aXZlUmV3YXJkKTsKICAgIH0KICAgIAogICAgCiAgICAvLyBAZGV2IFJlbW92ZSBhbGwgUFZQIGNvbnRlbmRlcnMgZnJvbSBQVlAgcXVldWUgCiAgICAvLyAgYW5kIHJldHVybiBhbGwgZW50cmFuY2UgZmVlcyB0byB3YXJyaW9yIG93bmVycy4KICAgIC8vICBOQjogdGhpcyBpcyBlbWVyZ2VuY3kgbWV0aG9kLCB1c2VkIG9ubHkgaW4gZiUjXkB1cCBzaXR1YXRpb24KICAgIGZ1bmN0aW9uIHJlbW92ZUFsbFRvdXJuYW1lbnRDb250ZW5kZXJzKCkgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5QYXVzZWQgewogICAgICAgIC8vcmVtb3ZlIGFsbCBwdnAgY29udGVuZGVycwogICAgICAgIHVpbnQyNTYgbGVuZ3RoID0gdG91cm5hbWVudFF1ZXVlU2l6ZTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHdhcnJpb3JJZDsKICAgICAgICB1aW50MjU2IGZhaWxlZEJvb3R5OwogICAgICAgIHVpbnQyNTYgaTsKCiAgICAgICAgdWludDI1NiBmZWU7CiAgICAgICAgdWludDI1NiBiYW5rID0gY3VycmVudFRvdXJuYW1lbnRCYW5rOwogICAgICAgIAogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgd2FycmlvcnNEYXRhID0gbmV3IHVpbnQyNTZbXShsZW5ndGgpOwogICAgICAgIC8vZ2V0IHRvdXJuYW1lbnQgd2FycmlvcnMKICAgICAgICBmb3IoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKyspIHsKICAgICAgICAgICAgd2FycmlvcnNEYXRhW2ldID0gdG91cm5hbWVudFF1ZXVlW2kgKiBEQVRBX1NJWkVdOwogICAgICAgIH0KICAgICAgICAvL25vdGlmeSBwdnAgbGlzdGVuZXIKICAgICAgICBwdnBMaXN0ZW5lci50b3VybmFtZW50RmluaXNoZWQod2FycmlvcnNEYXRhKTsKICAgICAgICAvL3JldHVybiBlbnRyYW5jZSBmZWUgdG8gd2FycmlvciBvd25lcnMKICAgICAJY3VycmVudFRvdXJuYW1lbnRCYW5rID0gMDsKICAgICAgICB0b3VybmFtZW50UXVldWVTaXplID0gMDsKCiAgICAgICAgZm9yKGkgPSBsZW5ndGggLSAxOyBpID49IDA7IGkgLS0pIHsKICAgICAgICAgICAgLy9yZXR1cm4gZW50cmFuY2UgZmVlCiAgICAgICAgICAgIHdhcnJpb3JJZCA9IENyeXB0b1V0aWxzLl91bnBhY2tXYXJyaW9ySWQod2FycmlvcnNEYXRhW2ldLCAwKTsKICAgICAgICAgICAgLy9jb21wdXRlIGNvbnRlbmRlciBlbnRyYW5jZSBmZWUKCQkJZmVlID0gYmFuayAtIChiYW5rICogMTAwMDAgLyAodG91cm5hbWVudEVudHJhbmNlRmVlQ3V0ICogKDEwMDAwIC0gVEhSRVNIT0xEKSAvIDEwMDAwICsgMTAwMDApKTsKCQkJLy9yZXR1cm4gZW50cmFuY2UgZmVlIHRvIG93bmVyCgkgICAgICAgIGZhaWxlZEJvb3R5ICs9IHNlbmRCb290eSh3YXJyaW9yVG9Pd25lclt3YXJyaW9ySWRdLCBmZWUpOwoJICAgICAgICAvL3N1YnRyYWN0IGZlZSBmcm9tIGJhbmssIGZvciBuZXh0IHVzZQoJICAgICAgICBiYW5rIC09IGZlZTsKICAgICAgICB9CiAgICAgICAgY3VycmVudFRvdXJuYW1lbnRCYW5rID0gYmFuazsKICAgICAgICB0b3RhbEJvb3R5ICs9IGZhaWxlZEJvb3R5OwogICAgfQp9Cgpjb250cmFjdCBCYXR0bGVQcm92aWRlciBpcyBUb3VybmFtZW50IHsKICAgIAogICAgZnVuY3Rpb24gQmF0dGxlUHJvdmlkZXIoYWRkcmVzcyBfcHZwTGlzdGVuZXIsIHVpbnQyNTYgX3B2cEN1dCwgdWludDI1NiBfdG91cm5hbWVudEN1dCwgdWludDI1NiBfaW5jZW50aXZlQ3V0LCAKICAgIHVpbnQyNTYgX3RvdXJuYW1lbnRPd25lcnNDdXQsIHVpbnQyNTYgX3RvdXJuYW1lbnRJbmNlbnRpdmVDdXQpIHB1YmxpYyAKICAgIFRvdXJuYW1lbnQoX3B2cEN1dCwgX3RvdXJuYW1lbnRDdXQsIF9pbmNlbnRpdmVDdXQsIF90b3VybmFtZW50T3duZXJzQ3V0LCBfdG91cm5hbWVudEluY2VudGl2ZUN1dCkgCiAgICB7CiAgICAgICAgUFZQTGlzdGVuZXJJbnRlcmZhY2UgY2FuZGlkYXRlQ29udHJhY3QgPSBQVlBMaXN0ZW5lckludGVyZmFjZShfcHZwTGlzdGVuZXIpOwogICAgICAgIC8vIE5PVEU6IHZlcmlmeSB0aGF0IGEgY29udHJhY3QgaXMgd2hhdCB3ZSBleHBlY3QgLSBodHRwczovL2dpdGh1Yi5jb20vTHVueXIvY3Jvd2RzYWxlLWNvbnRyYWN0cy9ibG9iL2NmYWRkMTU5ODZjMzA1MjFkOGJhN2Q1YjZmNTdiNGZlZmNjN2FjMzgvY29udHJhY3RzL0x1bnlyVG9rZW4uc29sI0wxMTcKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzUFZQTGlzdGVuZXIoKSk7CiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIHB2cExpc3RlbmVyID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICAgICAgCiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIG93bmVyCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICAKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vIHJpZ2h0IEJhdHRsZVByb3ZpZGVyIGluIG91ciBzZXRCYXR0bGVQcm92aWRlckFkZHJlc3MoKSBjYWxsLgogICAgZnVuY3Rpb24gaXNQVlBQcm92aWRlcigpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvLy8gQGRldiBPdmVycmlkZSB1bnBhdXNlIHNvIGl0IHJlcXVpcmVzIGFsbCBleHRlcm5hbCBjb250cmFjdCBhZGRyZXNzZXMKICAgIC8vLyAgdG8gYmUgc2V0IGJlZm9yZSBjb250cmFjdCBjYW4gYmUgdW5wYXVzZWQuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyB3ZSBjYW4gY2FsbCBzdXBlci51bnBhdXNlCiAgICAvLy8gIHdpdGhvdXQgdXNpbmcgYW4gZXhwZW5zaXZlIENBTEwuCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlPd25lciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3MocHZwTGlzdGVuZXIpICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBBY3R1YWxseSB1bnBhdXNlIHRoZSBjb250cmFjdC4KICAgICAgICBzdXBlci51bnBhdXNlKCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldFNlY29uZHNQZXJCbG9jayh1aW50MjU2IHNlY3MpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gc2VjczsKICAgIH0KfQoKbGlicmFyeSBDcnlwdG9VdGlscyB7CiAgIAogICAgLyogQ0xBU1NFUyAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBXQVJSSU9SID0gMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQVJDSEVSID0gMTsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgTUFHRSA9IDI7CiAgICAvKiBSQVJJVElFUyAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBDT01NT04gPSAxOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBVTkNPTU1PTiA9IDI7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFJBUkUgPSAzOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBNWVRISUMgPSA0OwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBMRUdFTkRBUlkgPSA1OwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBVTklRVUUgPSA2OwogICAgLyogTElNSVRTICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IENMQVNTX01FQ0hBTklDU19NQVggPSAzOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBSQVJJVFlfTUFYID0gNjsKICAgIC8qQGRldiByYW5nZSB1c2VkIGZvciByYXJpdHkgY2hhbmNlIGNvbXB1dGF0aW9uICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFJBUklUWV9DSEFOQ0VfUkFOR0UgPSAxMDAwMDAwMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUE9JTlRTX1RPX0xFVkVMID0gMTA7CiAgICAvKiBBVFRSSUJVVEUgTUFTS1MgKi8KICAgIC8qQGRldiByYW5nZSAwLTk5OTkgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgVU5JUVVFX01BU0tfMCA9IDE7CiAgICAvKkBkZXYgcmFuZ2UgMC05ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFJBUklUWV9NQVNLXzEgPSBVTklRVUVfTUFTS18wICogMTAwMDA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OTkgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQ0xBU1NfVklFV19NQVNLXzIgPSBSQVJJVFlfTUFTS18xICogMTA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OTkgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9EWV9DT0xPUl9NQVNLXzMgPSBDTEFTU19WSUVXX01BU0tfMiAqIDEwMDA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OTkgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgRVlFU19NQVNLXzQgPSBCT0RZX0NPTE9SX01BU0tfMyAqIDEwMDA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OTkgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgTU9VVEhfTUFTS181ID0gRVlFU19NQVNLXzQgKiAxMDAwOwogICAgLypAZGV2IHJhbmdlIDAtOTk5ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEhFSVJfTUFTS182ID0gTU9VVEhfTUFTS181ICogMTAwMDsKICAgIC8qQGRldiByYW5nZSAwLTk5OSAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBIRUlSX0NPTE9SX01BU0tfNyA9IEhFSVJfTUFTS182ICogMTAwMDsKICAgIC8qQGRldiByYW5nZSAwLTk5OSAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBBUk1PUl9NQVNLXzggPSBIRUlSX0NPTE9SX01BU0tfNyAqIDEwMDA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OTkgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgV0VBUE9OX01BU0tfOSA9IEFSTU9SX01BU0tfOCAqIDEwMDA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OTkgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgSEFUX01BU0tfMTAgPSBXRUFQT05fTUFTS185ICogMTAwMDsKICAgIC8qQGRldiByYW5nZSAwLTk5ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFJVTkVTX01BU0tfMTEgPSBIQVRfTUFTS18xMCAqIDEwMDA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OSAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBXSU5HU19NQVNLXzEyID0gUlVORVNfTUFTS18xMSAqIDEwMDsKICAgIC8qQGRldiByYW5nZSAwLTk5ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFBFVF9NQVNLXzEzID0gV0lOR1NfTUFTS18xMiAqIDEwMDsKICAgIC8qQGRldiByYW5nZSAwLTk5ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEJPUkRFUl9NQVNLXzE0ID0gUEVUX01BU0tfMTMgKiAxMDA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OSAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBCQUNLR1JPVU5EX01BU0tfMTUgPSBCT1JERVJfTUFTS18xNCAqIDEwMDsKICAgIC8qQGRldiByYW5nZSAwLTk5ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IElOVEVMTElHRU5DRV9NQVNLXzE2ID0gQkFDS0dST1VORF9NQVNLXzE1ICogMTAwOwogICAgLypAZGV2IHJhbmdlIDAtOTkgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQUdJTElUWV9NQVNLXzE3ID0gSU5URUxMSUdFTkNFX01BU0tfMTYgKiAxMDA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OSAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBTVFJFTkdUSF9NQVNLXzE4ID0gQUdJTElUWV9NQVNLXzE3ICogMTAwOwogICAgLypAZGV2IHJhbmdlIDAtOSAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBDTEFTU19NRUNIX01BU0tfMTkgPSBTVFJFTkdUSF9NQVNLXzE4ICogMTAwOwogICAgLypAZGV2IHJhbmdlIDAtOTk5ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFJBUklUWV9CT05VU19NQVNLXzIwID0gQ0xBU1NfTUVDSF9NQVNLXzE5ICogMTA7CiAgICAvKkBkZXYgcmFuZ2UgMC05ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFNQRUNJQUxJVFlfTUFTS18yMSA9IFJBUklUWV9CT05VU19NQVNLXzIwICogMTAwMDsKICAgIC8qQGRldiByYW5nZSAwLTk5ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IERBTUFHRV9NQVNLXzIyID0gU1BFQ0lBTElUWV9NQVNLXzIxICogMTA7CiAgICAvKkBkZXYgcmFuZ2UgMC05OSAqLwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBBVVJBX01BU0tfMjMgPSBEQU1BR0VfTUFTS18yMiAqIDEwMDsKICAgIC8qQGRldiAyMCBkZWNpbWFscyBsZWZ0ICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEJBU0VfTUFTS18yNCA9IEFVUkFfTUFTS18yMyAqIDEwMDsKICAgIAogICAgCiAgICAvKiBTUEVDSUFMIFBFUktTICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IE1JTkVSX1BFUksgPSAxOwogICAgCiAgICAKICAgIC8qIFBBUkFNIElOREVYRVMgKi8KICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9EWV9DT0xPUl9NQVhfSU5ERVhfMCA9IDA7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEVZRVNfTUFYX0lOREVYXzEgPSAxOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBNT1VUSF9NQVhfMiA9IDI7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEhBSVJfTUFYXzMgPSAzOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBIRUlSX0NPTE9SX01BWF80ID0gNDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQVJNT1JfTUFYXzUgPSA1OwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBXRUFQT05fTUFYXzYgPSA2OwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBIQVRfTUFYXzcgPSA3OwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBSVU5FU19NQVhfOCA9IDg7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFdJTkdTX01BWF85ID0gOTsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUEVUX01BWF8xMCA9IDEwOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBCT1JERVJfTUFYXzExID0gMTE7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEJBQ0tHUk9VTkRfTUFYXzEyID0gMTI7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFVOSVFVRV9JTkRFWF8xMyA9IDEzOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBMRUdFTkRBUllfSU5ERVhfMTQgPSAxNDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgTVlUSElDX0lOREVYXzE1ID0gMTU7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFJBUkVfSU5ERVhfMTYgPSAxNjsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgVU5DT01NT05fSU5ERVhfMTcgPSAxNzsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgVU5JUVVFX1RPVEFMX0lOREVYXzE4ID0gMTg7CiAgICAKICAgICAvKiBQQUNLIFBWUCBEQVRBIExPR0lDICovCiAgICAvL3B2cCBkYXRhCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IENMQVNTX1BBQ0tfMCA9IDE7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFJBUklUWV9CT05VU19QQUNLXzEgPSBDTEFTU19QQUNLXzAgKiAxMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUkFSSVRZX1BBQ0tfMiA9IFJBUklUWV9CT05VU19QQUNLXzEgKiAxMDAwOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBFWFBFUklFTkNFX1BBQ0tfMyA9IFJBUklUWV9QQUNLXzIgKiAxMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgSU5URUxMSUdFTkNFX1BBQ0tfNCA9IEVYUEVSSUVOQ0VfUEFDS18zICogMTAwMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQUdJTElUWV9QQUNLXzUgPSBJTlRFTExJR0VOQ0VfUEFDS180ICogMTAwOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBTVFJFTkdUSF9QQUNLXzYgPSBBR0lMSVRZX1BBQ0tfNSAqIDEwMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQkFTRV9EQU1BR0VfUEFDS183ID0gU1RSRU5HVEhfUEFDS182ICogMTAwOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBQRVRfUEFDS184ID0gQkFTRV9EQU1BR0VfUEFDS183ICogMTAwOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBBVVJBX1BBQ0tfOSA9IFBFVF9QQUNLXzggKiAxMDA7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFdBUlJJT1JfSURfUEFDS18xMCA9IEFVUkFfUEFDS185ICogMTAwOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBQVlBfQ1lDTEVfUEFDS18xMSA9IFdBUlJJT1JfSURfUEFDS18xMCAqIDEwKioxMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUkFUSU5HX1BBQ0tfMTIgPSBQVlBfQ1lDTEVfUEFDS18xMSAqIDEwKioxMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUFZQX0JBU0VfUEFDS18xMyA9IFJBVElOR19QQUNLXzEyICogMTAqKjEwOy8vTkIgcmF0aW5nIG11c3QgYmUgYXQgdGhlIEVORCEKICAgIAogICAgLy90b3VybmFtZW50IGRhdGEKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgSFBfUEFDS18wID0gMTsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgREFNQUdFX1BBQ0tfMSA9IEhQX1BBQ0tfMCAqIDEwKioxMjsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQVJNT1JfUEFDS18yID0gREFNQUdFX1BBQ0tfMSAqIDEwKioxMjsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgRE9ER0VfUEFDS18zID0gQVJNT1JfUEFDS18yICogMTAqKjEyOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBQRU5FVFJBVElPTl9QQUNLXzQgPSBET0RHRV9QQUNLXzMgKiAxMCoqMTI7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IENPTUJJTkVfQkFTRV9QQUNLXzUgPSBQRU5FVFJBVElPTl9QQUNLXzQgKiAxMCoqMTI7CiAgICAKICAgIC8qIE1JU0MgQ09OU1RBTlRTICovCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IE1BWF9JRF9TSVpFID0gMTAwMDAwMDAwMDA7CiAgICBpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUFJFQ0lTSU9OID0gMTAwMDAwMDsKICAgIAogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBCQVRUTEVTX1BFUl9DT05URU5ERVIgPSAxMDsvLzEweDEwMAogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBCQVRUTEVTX1BFUl9DT05URU5ERVJfU1VNID0gQkFUVExFU19QRVJfQ09OVEVOREVSICogMTAwOy8vMTB4MTAwCiAgICAKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgTEVWRUxfQk9OVVNFUyA9IDk4ODk4MTc0Njc2MTU1NTA0NTQxMzczNDMxMjgyNTIzMjExOTE3MTUxNDEzMTIxMTEwOwogICAgCiAgICAvL3Vjb21tb24gYm9udXNlcwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBCT05VU19OT05FID0gMDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9OVVNfSFAgPSAxOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBCT05VU19BUk1PUiA9IDI7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEJPTlVTX0NSSVRfQ0hBTkNFID0gMzsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9OVVNfQ1JJVF9NVUxUID0gNDsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9OVVNfUEVORVRSQVRJT04gPSA1OwogICAgLy9yYXJlIGJvbnVzZXMKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9OVVNfU1RSID0gNjsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9OVVNfQUdJID0gNzsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9OVVNfSU5UID0gODsKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgQk9OVVNfREFNQUdFID0gOTsKICAgIAogICAgLy9ib251cyB2YWx1ZSBkYXRhYmFzZSwgCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IEJPTlVTX0RBVEEgPSAxNjA2MDYwNjE0MDEwNzE1MjAwMDsKICAgIC8vcGV0cyBkYXRhYmFzZQogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBQRVRTX0RBVEEgPSAyODcxNjQyMzU1NzM3MjgzMjU4NDI0NTk5ODE2OTIwMDA7CiAgICAKICAgIHVpbnQyNTYgaW50ZXJuYWwgY29uc3RhbnQgUEVUX0FVUkEgPSAyOwogICAgdWludDI1NiBpbnRlcm5hbCBjb25zdGFudCBQRVRfUEFSQU1fMSA9IDE7CiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IFBFVF9QQVJBTV8yID0gMDsKCiAgICAvKiBHRVRURVJTICovCglmdW5jdGlvbiBnZXRVbmlxdWVWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CgkJcmV0dXJuIGlkZW50aXR5ICUgUkFSSVRZX01BU0tfMTsKCX0KCiAgICBmdW5jdGlvbiBnZXRSYXJpdHlWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChpZGVudGl0eSAlIENMQVNTX1ZJRVdfTUFTS18yKSAvIFJBUklUWV9NQVNLXzE7CiAgICB9CgoJZnVuY3Rpb24gZ2V0Q2xhc3NWaWV3VmFsdWUodWludDI1NiBpZGVudGl0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewoJCXJldHVybiAoaWRlbnRpdHkgJSBCT0RZX0NPTE9SX01BU0tfMykgLyBDTEFTU19WSUVXX01BU0tfMjsKCX0KCglmdW5jdGlvbiBnZXRCb2R5Q29sb3JWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChpZGVudGl0eSAlIEVZRVNfTUFTS180KSAvIEJPRFlfQ09MT1JfTUFTS18zOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV5ZXNWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChpZGVudGl0eSAlIE1PVVRIX01BU0tfNSkgLyBFWUVTX01BU0tfNDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNb3V0aFZhbHVlKHVpbnQyNTYgaWRlbnRpdHkpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKGlkZW50aXR5ICUgSEVJUl9NQVNLXzYpIC8gTU9VVEhfTUFTS181OwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEhhaXJWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChpZGVudGl0eSAlIEhFSVJfQ09MT1JfTUFTS183KSAvIEhFSVJfTUFTS182OwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEhhaXJDb2xvclZhbHVlKHVpbnQyNTYgaWRlbnRpdHkpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKGlkZW50aXR5ICUgQVJNT1JfTUFTS184KSAvIEhFSVJfQ09MT1JfTUFTS183OwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFybW9yVmFsdWUodWludDI1NiBpZGVudGl0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiAoaWRlbnRpdHkgJSBXRUFQT05fTUFTS185KSAvIEFSTU9SX01BU0tfODsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRXZWFwb25WYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChpZGVudGl0eSAlIEhBVF9NQVNLXzEwKSAvIFdFQVBPTl9NQVNLXzk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SGF0VmFsdWUodWludDI1NiBpZGVudGl0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiAoaWRlbnRpdHkgJSBSVU5FU19NQVNLXzExKSAvIEhBVF9NQVNLXzEwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJ1bmVzVmFsdWUodWludDI1NiBpZGVudGl0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiAoaWRlbnRpdHkgJSBXSU5HU19NQVNLXzEyKSAvIFJVTkVTX01BU0tfMTE7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0V2luZ3NWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChpZGVudGl0eSAlIFBFVF9NQVNLXzEzKSAvIFdJTkdTX01BU0tfMTI7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UGV0VmFsdWUodWludDI1NiBpZGVudGl0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiAoaWRlbnRpdHkgJSBCT1JERVJfTUFTS18xNCkgLyBQRVRfTUFTS18xMzsKICAgIH0KCglmdW5jdGlvbiBnZXRCb3JkZXJWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CgkJcmV0dXJuIChpZGVudGl0eSAlIEJBQ0tHUk9VTkRfTUFTS18xNSkgLyBCT1JERVJfTUFTS18xNDsKCX0KCglmdW5jdGlvbiBnZXRCYWNrZ3JvdW5kVmFsdWUodWludDI1NiBpZGVudGl0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewoJCXJldHVybiAoaWRlbnRpdHkgJSBJTlRFTExJR0VOQ0VfTUFTS18xNikgLyBCQUNLR1JPVU5EX01BU0tfMTU7Cgl9CgogICAgZnVuY3Rpb24gZ2V0SW50ZWxsaWdlbmNlVmFsdWUodWludDI1NiBpZGVudGl0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiAoaWRlbnRpdHkgJSBBR0lMSVRZX01BU0tfMTcpIC8gSU5URUxMSUdFTkNFX01BU0tfMTY7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWdpbGl0eVZhbHVlKHVpbnQyNTYgaWRlbnRpdHkpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKChpZGVudGl0eSAlIFNUUkVOR1RIX01BU0tfMTgpIC8gQUdJTElUWV9NQVNLXzE3KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRTdHJlbmd0aFZhbHVlKHVpbnQyNTYgaWRlbnRpdHkpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKChpZGVudGl0eSAlIENMQVNTX01FQ0hfTUFTS18xOSkgLyBTVFJFTkdUSF9NQVNLXzE4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDbGFzc01lY2hWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChpZGVudGl0eSAlIFJBUklUWV9CT05VU19NQVNLXzIwKSAvIENMQVNTX01FQ0hfTUFTS18xOTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSYXJpdHlCb251c1ZhbHVlKHVpbnQyNTYgaWRlbnRpdHkpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKGlkZW50aXR5ICUgU1BFQ0lBTElUWV9NQVNLXzIxKSAvIFJBUklUWV9CT05VU19NQVNLXzIwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFNwZWNpYWxpdHlWYWx1ZSh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChpZGVudGl0eSAlIERBTUFHRV9NQVNLXzIyKSAvIFNQRUNJQUxJVFlfTUFTS18yMTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0RGFtYWdlVmFsdWUodWludDI1NiBpZGVudGl0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiAoaWRlbnRpdHkgJSBBVVJBX01BU0tfMjMpIC8gREFNQUdFX01BU0tfMjI7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXVyYVZhbHVlKHVpbnQyNTYgaWRlbnRpdHkpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKChpZGVudGl0eSAlIEJBU0VfTUFTS18yNCkgLyBBVVJBX01BU0tfMjMpOwogICAgfQoKICAgIC8qIFNFVFRFUlMgKi8KICAgIGZ1bmN0aW9uIF9zZXRVbmlxdWVWYWx1ZTAodWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJlcXVpcmUodmFsdWUgPCBSQVJJVFlfTUFTS18xKTsKICAgICAgICByZXR1cm4gdmFsdWUgKiBVTklRVUVfTUFTS18wOwogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXRSYXJpdHlWYWx1ZTEodWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJlcXVpcmUodmFsdWUgPCAoQ0xBU1NfVklFV19NQVNLXzIgLyBSQVJJVFlfTUFTS18xKSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogUkFSSVRZX01BU0tfMTsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0Q2xhc3NWaWV3VmFsdWUyKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKEJPRFlfQ09MT1JfTUFTS18zIC8gQ0xBU1NfVklFV19NQVNLXzIpKTsKICAgICAgICByZXR1cm4gdmFsdWUgKiBDTEFTU19WSUVXX01BU0tfMjsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0Qm9keUNvbG9yVmFsdWUzKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKEVZRVNfTUFTS180IC8gQk9EWV9DT0xPUl9NQVNLXzMpKTsKICAgICAgICByZXR1cm4gdmFsdWUgKiBCT0RZX0NPTE9SX01BU0tfMzsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0RXllc1ZhbHVlNCh1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8IChNT1VUSF9NQVNLXzUgLyBFWUVTX01BU0tfNCkpOwogICAgICAgIHJldHVybiB2YWx1ZSAqIEVZRVNfTUFTS180OwogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXRNb3V0aFZhbHVlNSh1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8IChIRUlSX01BU0tfNiAvIE1PVVRIX01BU0tfNSkpOwogICAgICAgIHJldHVybiB2YWx1ZSAqIE1PVVRIX01BU0tfNTsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0SGFpclZhbHVlNih1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8IChIRUlSX0NPTE9SX01BU0tfNyAvIEhFSVJfTUFTS182KSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogSEVJUl9NQVNLXzY7CiAgICB9CgogICAgZnVuY3Rpb24gX3NldEhhaXJDb2xvclZhbHVlNyh1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8IChBUk1PUl9NQVNLXzggLyBIRUlSX0NPTE9SX01BU0tfNykpOwogICAgICAgIHJldHVybiB2YWx1ZSAqIEhFSVJfQ09MT1JfTUFTS183OwogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXRBcm1vclZhbHVlOCh1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8IChXRUFQT05fTUFTS185IC8gQVJNT1JfTUFTS184KSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogQVJNT1JfTUFTS184OwogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXRXZWFwb25WYWx1ZTkodWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJlcXVpcmUodmFsdWUgPCAoSEFUX01BU0tfMTAgLyBXRUFQT05fTUFTS185KSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogV0VBUE9OX01BU0tfOTsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0SGF0VmFsdWUxMCh1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8IChSVU5FU19NQVNLXzExIC8gSEFUX01BU0tfMTApKTsKICAgICAgICByZXR1cm4gdmFsdWUgKiBIQVRfTUFTS18xMDsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0UnVuZXNWYWx1ZTExKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKFdJTkdTX01BU0tfMTIgLyBSVU5FU19NQVNLXzExKSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogUlVORVNfTUFTS18xMTsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0V2luZ3NWYWx1ZTEyKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKFBFVF9NQVNLXzEzIC8gV0lOR1NfTUFTS18xMikpOwogICAgICAgIHJldHVybiB2YWx1ZSAqIFdJTkdTX01BU0tfMTI7CiAgICB9CgogICAgZnVuY3Rpb24gX3NldFBldFZhbHVlMTModWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJlcXVpcmUodmFsdWUgPCAoQk9SREVSX01BU0tfMTQgLyBQRVRfTUFTS18xMykpOwogICAgICAgIHJldHVybiB2YWx1ZSAqIFBFVF9NQVNLXzEzOwogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXRCb3JkZXJWYWx1ZTE0KHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKEJBQ0tHUk9VTkRfTUFTS18xNSAvIEJPUkRFUl9NQVNLXzE0KSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogQk9SREVSX01BU0tfMTQ7CiAgICB9CgogICAgZnVuY3Rpb24gX3NldEJhY2tncm91bmRWYWx1ZTE1KHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKElOVEVMTElHRU5DRV9NQVNLXzE2IC8gQkFDS0dST1VORF9NQVNLXzE1KSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogQkFDS0dST1VORF9NQVNLXzE1OwogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXRJbnRlbGxpZ2VuY2VWYWx1ZTE2KHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKEFHSUxJVFlfTUFTS18xNyAvIElOVEVMTElHRU5DRV9NQVNLXzE2KSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogSU5URUxMSUdFTkNFX01BU0tfMTY7CiAgICB9CgogICAgZnVuY3Rpb24gX3NldEFnaWxpdHlWYWx1ZTE3KHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKFNUUkVOR1RIX01BU0tfMTggLyBBR0lMSVRZX01BU0tfMTcpKTsKICAgICAgICByZXR1cm4gdmFsdWUgKiBBR0lMSVRZX01BU0tfMTc7CiAgICB9CgogICAgZnVuY3Rpb24gX3NldFN0cmVuZ3RoVmFsdWUxOCh1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8IChDTEFTU19NRUNIX01BU0tfMTkgLyBTVFJFTkdUSF9NQVNLXzE4KSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogU1RSRU5HVEhfTUFTS18xODsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0Q2xhc3NNZWNoVmFsdWUxOSh1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmVxdWlyZSh2YWx1ZSA8IChSQVJJVFlfQk9OVVNfTUFTS18yMCAvIENMQVNTX01FQ0hfTUFTS18xOSkpOwogICAgICAgIHJldHVybiB2YWx1ZSAqIENMQVNTX01FQ0hfTUFTS18xOTsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0UmFyaXR5Qm9udXNWYWx1ZTIwKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKFNQRUNJQUxJVFlfTUFTS18yMSAvIFJBUklUWV9CT05VU19NQVNLXzIwKSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogUkFSSVRZX0JPTlVTX01BU0tfMjA7CiAgICB9CgogICAgZnVuY3Rpb24gX3NldFNwZWNpYWxpdHlWYWx1ZTIxKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKERBTUFHRV9NQVNLXzIyIC8gU1BFQ0lBTElUWV9NQVNLXzIxKSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogU1BFQ0lBTElUWV9NQVNLXzIxOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfc2V0RGFtZ2VWYWx1ZTIyKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKEFVUkFfTUFTS18yMyAvIERBTUFHRV9NQVNLXzIyKSk7CiAgICAgICAgcmV0dXJuIHZhbHVlICogREFNQUdFX01BU0tfMjI7CiAgICB9CgogICAgZnVuY3Rpb24gX3NldEF1cmFWYWx1ZTIzKHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXF1aXJlKHZhbHVlIDwgKEJBU0VfTUFTS18yNCAvIEFVUkFfTUFTS18yMykpOwogICAgICAgIHJldHVybiB2YWx1ZSAqIEFVUkFfTUFTS18yMzsKICAgIH0KICAgIAogICAgLyogV0FSUklPUiBJREVOVElUWSBHRU5FUkFUSU9OICovCiAgICBmdW5jdGlvbiBfY29tcHV0ZVJ1bmVzKHVpbnQyNTYgX3Jhcml0eSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICByZXR1cm4gX3Jhcml0eSA+IFVOQ09NTU9OID8gX3Jhcml0eSAtIFVOQ09NTU9OIDogMDsvLyAxICsgX3JhbmRvbSgwLCBtYXgsIGhhc2gsIFdJTkdTX01BU0tfMTIsIFJVTkVTX01BU0tfMTEpIDogMDsKICAgIH0KCiAgICBmdW5jdGlvbiBfY29tcHV0ZVdpbmdzKHVpbnQyNTYgX3Jhcml0eSwgdWludDI1NiBtYXgsIHVpbnQyNTYgaGFzaCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICByZXR1cm4gX3Jhcml0eSA+IFJBUkUgPyAgMSArIF9yYW5kb20oMCwgbWF4LCBoYXNoLCBQRVRfTUFTS18xMywgV0lOR1NfTUFTS18xMikgOiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIF9jb21wdXRlUGV0KHVpbnQyNTYgX3Jhcml0eSwgdWludDI1NiBtYXgsIHVpbnQyNTYgaGFzaCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICByZXR1cm4gX3Jhcml0eSA+IE1ZVEhJQyA/IDEgKyBfcmFuZG9tKDAsIG1heCwgaGFzaCwgQk9SREVSX01BU0tfMTQsIFBFVF9NQVNLXzEzKSA6IDA7CiAgICB9CgogICAgZnVuY3Rpb24gX2NvbXB1dGVCb3JkZXIodWludDI1NiBfcmFyaXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIHJldHVybiBfcmFyaXR5ID49IENPTU1PTiA/IF9yYXJpdHkgLSAxIDogMDsKICAgIH0KCiAgICBmdW5jdGlvbiBfY29tcHV0ZUJhY2tncm91bmQodWludDI1NiBfcmFyaXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIHJldHVybiBfcmFyaXR5OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfdW5wYWNrUGV0RGF0YSh1aW50MjU2IGluZGV4KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChQRVRTX0RBVEEgJSAoMTAwMCAqKiAoaW5kZXggKyAxKSkgLyAoMTAwMCAqKiBpbmRleCkpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfZ2V0UGV0Qm9udXMxKHVpbnQyNTYgX3BldCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKF9wZXQgJSAoMTAgKiogKFBFVF9QQVJBTV8xICsgMSkpIC8gKDEwICoqIFBFVF9QQVJBTV8xKSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9nZXRQZXRCb251czIodWludDI1NiBfcGV0KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiAoX3BldCAlICgxMCAqKiAoUEVUX1BBUkFNXzIgKyAxKSkgLyAoMTAgKiogUEVUX1BBUkFNXzIpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dldFBldEF1cmEodWludDI1NiBfcGV0KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiAoX3BldCAlICgxMCAqKiAoUEVUX0FVUkEgKyAxKSkgLyAoMTAgKiogUEVUX0FVUkEpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dldEJhdHRsZUJvbnVzKHVpbnQyNTYgX3NldEJvbnVzSW5kZXgsIHVpbnQyNTYgX2N1cnJlbnRCb251c0luZGV4LCB1aW50MjU2IF9wZXREYXRhLCB1aW50MjU2IF93YXJyaW9yQXVyYXMsIHVpbnQyNTYgX3BldEF1cmFzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMoaW50MjU2KSB7CiAgICAgICAgaW50MjU2IGJvbnVzID0gMDsKICAgICAgICBpZiAoX3NldEJvbnVzSW5kZXggPT0gX2N1cnJlbnRCb251c0luZGV4KSB7CiAgICAgICAgICAgIGJvbnVzICs9IGludDI1NihCT05VU19EQVRBICUgKDEwMCAqKiAoX3NldEJvbnVzSW5kZXggKyAxKSkgLyAoMTAwICoqIF9zZXRCb251c0luZGV4KSkgKiBQUkVDSVNJT047CiAgICAgICAgfQogICAgICAgIC8vYWRkIHBldCBib251c2VzCiAgICAgICAgaWYgKF9zZXRCb251c0luZGV4ID09IF9nZXRQZXRCb251czEoX3BldERhdGEpKSB7CiAgICAgICAgICAgIGJvbnVzICs9IGludDI1NihCT05VU19EQVRBICUgKDEwMCAqKiAoX3NldEJvbnVzSW5kZXggKyAxKSkgLyAoMTAwICoqIF9zZXRCb251c0luZGV4KSkgKiBQUkVDSVNJT04gLyAyOwogICAgICAgIH0KICAgICAgICBpZiAoX3NldEJvbnVzSW5kZXggPT0gX2dldFBldEJvbnVzMihfcGV0RGF0YSkpIHsKICAgICAgICAgICAgYm9udXMgKz0gaW50MjU2KEJPTlVTX0RBVEEgJSAoMTAwICoqIChfc2V0Qm9udXNJbmRleCArIDEpKSAvICgxMDAgKiogX3NldEJvbnVzSW5kZXgpKSAqIFBSRUNJU0lPTiAvIDI7CiAgICAgICAgfQogICAgICAgIC8vYWRkIHdhcnJpb3IgYXVyYSBib251c2VzCiAgICAgICAgaWYgKGlzQXVyYVNldChfd2FycmlvckF1cmFzLCB1aW50OChfc2V0Qm9udXNJbmRleCkpKSB7Ly93YXJyaW9ycyByZWNlaXZlIGhhbGYgYm9udXNlcyBmcm9tIGF1cmFzCiAgICAgICAgICAgIGJvbnVzICs9IGludDI1NihCT05VU19EQVRBICUgKDEwMCAqKiAoX3NldEJvbnVzSW5kZXggKyAxKSkgLyAoMTAwICoqIF9zZXRCb251c0luZGV4KSkgKiBQUkVDSVNJT04gLyAyOwogICAgICAgIH0KICAgICAgICAvL2FkZCBwZXQgYXVyYSBib251c2VzCiAgICAgICAgaWYgKGlzQXVyYVNldChfcGV0QXVyYXMsIHVpbnQ4KF9zZXRCb251c0luZGV4KSkpIHsvL3BldHMgcmVjZWl2ZSBmdWxsIGJvbnVlcyBmcm9tIGF1cmFzCiAgICAgICAgICAgIGJvbnVzICs9IGludDI1NihCT05VU19EQVRBICUgKDEwMCAqKiAoX3NldEJvbnVzSW5kZXggKyAxKSkgLyAoMTAwICoqIF9zZXRCb251c0luZGV4KSkgKiBQUkVDSVNJT047CiAgICAgICAgfQogICAgICAgIHJldHVybiBib251czsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2NvbXB1dGVSYXJpdHlCb251cyh1aW50MjU2IF9yYXJpdHksIHVpbnQyNTYgaGFzaCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICBpZiAoX3Jhcml0eSA9PSBVTkNPTU1PTikgewogICAgICAgICAgICByZXR1cm4gMSArIF9yYW5kb20oMCwgQk9OVVNfUEVORVRSQVRJT04sIGhhc2gsIFNQRUNJQUxJVFlfTUFTS18yMSwgUkFSSVRZX0JPTlVTX01BU0tfMjApOwogICAgICAgIH0KICAgICAgICBpZiAoX3Jhcml0eSA9PSBSQVJFKSB7CiAgICAgICAgICAgIHJldHVybiAxICsgX3JhbmRvbShCT05VU19QRU5FVFJBVElPTiwgQk9OVVNfREFNQUdFLCBoYXNoLCBTUEVDSUFMSVRZX01BU0tfMjEsIFJBUklUWV9CT05VU19NQVNLXzIwKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9yYXJpdHkgPj0gTVlUSElDKSB7CiAgICAgICAgICAgIHJldHVybiAxICsgX3JhbmRvbSgwLCBCT05VU19EQU1BR0UsIGhhc2gsIFNQRUNJQUxJVFlfTUFTS18yMSwgUkFSSVRZX0JPTlVTX01BU0tfMjApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQk9OVVNfTk9ORTsKICAgIH0KCiAgICBmdW5jdGlvbiBfY29tcHV0ZUF1cmEodWludDI1NiBfcmFyaXR5LCB1aW50MjU2IGhhc2gpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgaWYgKF9yYXJpdHkgPj0gTVlUSElDKSB7CiAgICAgICAgICAgIHJldHVybiAxICsgX3JhbmRvbSgwLCBCT05VU19EQU1BR0UsIGhhc2gsIEJBU0VfTUFTS18yNCwgQVVSQV9NQVNLXzIzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIEJPTlVTX05PTkU7CiAgICB9CiAgICAKCWZ1bmN0aW9uIF9jb21wdXRlUmFyaXR5KHVpbnQyNTYgX3Jld2FyZCwgdWludDI1NiBfdW5pcXVlLCB1aW50MjU2IF9sZWdlbmRhcnksIAoJICAgIHVpbnQyNTYgX215dGhpYywgdWludDI1NiBfcmFyZSwgdWludDI1NiBfdW5jb21tb24pIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKCSAgICAgICAgCiAgICAgICAgdWludDI1NiByYW5nZSA9IF91bmlxdWUgKyBfbGVnZW5kYXJ5ICsgX215dGhpYyArIF9yYXJlICsgX3VuY29tbW9uOwogICAgICAgIGlmIChfcmV3YXJkID49IHJhbmdlKSByZXR1cm4gQ09NTU9OOyAvLyBjb21tb24KICAgICAgICBpZiAoX3Jld2FyZCA+PSAocmFuZ2UgPSAocmFuZ2UgLSBfdW5jb21tb24pKSkgcmV0dXJuIFVOQ09NTU9OOwogICAgICAgIGlmIChfcmV3YXJkID49IChyYW5nZSA9IChyYW5nZSAtIF9yYXJlKSkpIHJldHVybiBSQVJFOwogICAgICAgIGlmIChfcmV3YXJkID49IChyYW5nZSA9IChyYW5nZSAtIF9teXRoaWMpKSkgcmV0dXJuIE1ZVEhJQzsKICAgICAgICBpZiAoX3Jld2FyZCA+PSAocmFuZ2UgPSAocmFuZ2UgLSBfbGVnZW5kYXJ5KSkpIHJldHVybiBMRUdFTkRBUlk7CiAgICAgICAgaWYgKF9yZXdhcmQgPCByYW5nZSkgcmV0dXJuIFVOSVFVRTsKICAgICAgICByZXR1cm4gQ09NTU9OOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfY29tcHV0ZVVuaXF1ZW5lc3ModWludDI1NiBfcmFyaXR5LCB1aW50MjU2IG5leHRVbmlxdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgcmV0dXJuIF9yYXJpdHkgPT0gVU5JUVVFID8gbmV4dFVuaXF1ZSA6IDA7CiAgICB9CiAgICAKICAgIC8qIGlkZW50aXR5IHBhY2tpbmcgKi8KICAgIC8qIEByZXR1cm5zIGJvbnVzIHZhbHVlIHdoaWNoIGRlcGVuZHMgb24gc3BlY2lhbGl0eSB2YWx1ZSwKICAgICAqIGlmIHNwZWNpYWxpdHkgPT0gMSAobWluZXIpLCB0aGVuIGJvbnVzIHZhbHVlIHdpbGwgYmUgZXF1YWwgNCwKICAgICAqIG90aGVyd2lzZSAxCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9nZXRCb251cyh1aW50MjU2IGlkZW50aXR5KSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIGdldFNwZWNpYWxpdHlWYWx1ZShpZGVudGl0eSkgPT0gTUlORVJfUEVSSyA/IDQgOiAxOwogICAgfQogICAgCgogICAgZnVuY3Rpb24gX2NvbXB1dGVBbmRTZXRCYXNlUGFyYW1ldGVyczE2XzE4XzIyKHVpbnQyNTYgX2hhc2gpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NiwgdWludDI1Nil7CiAgICAgICAgdWludDI1NiBpZGVudGl0eSA9IDA7CgogICAgICAgIHVpbnQyNTYgZGFtYWdlID0gMzUgKyBfcmFuZG9tKDAsIDIxLCBfaGFzaCwgQVVSQV9NQVNLXzIzLCBEQU1BR0VfTUFTS18yMik7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBzdHJlbmd0aCA9IDQ1ICsgX3JhbmRvbSgwLCAyNiwgX2hhc2gsIENMQVNTX01FQ0hfTUFTS18xOSwgU1RSRU5HVEhfTUFTS18xOCk7CiAgICAgICAgdWludDI1NiBhZ2lsaXR5ID0gMTUgKyAoMTI1IC0gZGFtYWdlIC0gc3RyZW5ndGgpOwogICAgICAgIHVpbnQyNTYgaW50ZWxsaWdlbmNlID0gMTU1IC0gc3RyZW5ndGggLSBhZ2lsaXR5IC0gZGFtYWdlOwogICAgICAgIChzdHJlbmd0aCwgYWdpbGl0eSwgaW50ZWxsaWdlbmNlKSA9IF9zaHVmZmxlUGFyYW1zKHN0cmVuZ3RoLCBhZ2lsaXR5LCBpbnRlbGxpZ2VuY2UsIF9oYXNoKTsKICAgICAgICAKICAgICAgICBpZGVudGl0eSArPSBfc2V0U3RyZW5ndGhWYWx1ZTE4KHN0cmVuZ3RoKTsKICAgICAgICBpZGVudGl0eSArPSBfc2V0QWdpbGl0eVZhbHVlMTcoYWdpbGl0eSk7CgkJaWRlbnRpdHkgKz0gX3NldEludGVsbGlnZW5jZVZhbHVlMTYoaW50ZWxsaWdlbmNlKTsKCQlpZGVudGl0eSArPSBfc2V0RGFtZ2VWYWx1ZTIyKGRhbWFnZSk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBjbGFzc01lY2ggPSBzdHJlbmd0aCA+IGFnaWxpdHkgPyAoc3RyZW5ndGggPiBpbnRlbGxpZ2VuY2UgPyBXQVJSSU9SIDogTUFHRSkgOiAoYWdpbGl0eSA+IGludGVsbGlnZW5jZSA/IEFSQ0hFUiA6IE1BR0UpOwogICAgICAgIHJldHVybiAoaWRlbnRpdHksIGNsYXNzTWVjaCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9zaHVmZmxlUGFyYW1zKHVpbnQyNTYgcGFyYW0xLCB1aW50MjU2IHBhcmFtMiwgdWludDI1NiBwYXJhbTMsIHVpbnQyNTYgX2hhc2gpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiB0ZW1wID0gcGFyYW0xOwogICAgICAgIGlmIChfaGFzaCAlIDIgPT0gMCkgewogICAgICAgICAgICB0ZW1wID0gcGFyYW0xOwogICAgICAgICAgICBwYXJhbTEgPSBwYXJhbTI7CiAgICAgICAgICAgIHBhcmFtMiA9IHRlbXA7CiAgICAgICAgfQogICAgICAgIGlmICgoX2hhc2ggLyAxMCAlIDIpID09IDApIHsKICAgICAgICAgICAgdGVtcCA9IHBhcmFtMjsKICAgICAgICAgICAgcGFyYW0yID0gcGFyYW0zOwogICAgICAgICAgICBwYXJhbTMgPSB0ZW1wOwogICAgICAgIH0KICAgICAgICBpZiAoKF9oYXNoIC8gMTAwICUgMikgPT0gMCkgewogICAgICAgICAgICB0ZW1wID0gcGFyYW0xOwogICAgICAgICAgICBwYXJhbTEgPSBwYXJhbTI7CiAgICAgICAgICAgIHBhcmFtMiA9IHRlbXA7CiAgICAgICAgfQogICAgICAgIHJldHVybiAocGFyYW0xLCBwYXJhbTIsIHBhcmFtMyk7CiAgICB9CiAgICAKICAgIAogICAgLyogUkFORE9NICovCiAgICBmdW5jdGlvbiBfcmFuZG9tKHVpbnQyNTYgX21pbiwgdWludDI1NiBfbWF4LCB1aW50MjU2IF9oYXNoLCB1aW50MjU2IF9yZW1pbmRlciwgdWludDI1NiBfZGV2aWRlcikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKChfaGFzaCAlIF9yZW1pbmRlcikgLyBfZGV2aWRlcikgJSAoX21heCAtIF9taW4pICsgX21pbjsKICAgIH0KCiAgICBmdW5jdGlvbiBfcmFuZG9tKHVpbnQyNTYgX21pbiwgdWludDI1NiBfbWF4LCB1aW50MjU2IF9oYXNoKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIHJldHVybiBfaGFzaCAlIChfbWF4IC0gX21pbikgKyBfbWluOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRUYXJnZXRCbG9jayh1aW50MjU2IF90YXJnZXRCbG9jaykgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHVpbnQyNTYgY3VycmVudEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIHVpbnQyNTYgdGFyZ2V0ID0gY3VycmVudEJsb2NrIC0gKGN1cnJlbnRCbG9jayAlIDI1NikgKyAoX3RhcmdldEJsb2NrICUgMjU2KTsKICAgICAgICBpZiAodGFyZ2V0ID49IGN1cnJlbnRCbG9jaykgewogICAgICAgICAgICByZXR1cm4gKHRhcmdldCAtIDI1Nik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9nZXRNYXhSYXJpdHlDaGFuY2UoKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIFJBUklUWV9DSEFOQ0VfUkFOR0U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdlbmVyYXRlV2Fycmlvcih1aW50MjU2IF9oZXJvSWRlbnRpdHksIHVpbnQyNTYgX2hlcm9MZXZlbCwgdWludDI1NiBfdGFyZ2V0QmxvY2ssIHVpbnQyNTYgc3BlY2lhbFBlcmMsIHVpbnQzMlsxOV0gbWVtb3J5IHBhcmFtcykgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgX3RhcmdldEJsb2NrID0gX2dldFRhcmdldEJsb2NrKF90YXJnZXRCbG9jayk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBpZGVudGl0eTsKICAgICAgICB1aW50MjU2IGhhc2ggPSB1aW50MjU2KGtlY2NhazI1NihibG9jay5ibG9ja2hhc2goX3RhcmdldEJsb2NrKSwgX2hlcm9JZGVudGl0eSwgYmxvY2suY29pbmJhc2UsIGJsb2NrLmRpZmZpY3VsdHkpKTsKICAgICAgICAvLzAgX2hlcm9MZXZlbCBwcm9kdWNlcyB3YXJyaW9ycyBvZiBDT01NT04gcmFyaXR5CiAgICAgICAgdWludDI1NiByYXJpdHlDaGFuY2UgPSBfaGVyb0xldmVsID09IDAgPyBSQVJJVFlfQ0hBTkNFX1JBTkdFIDogCiAgICAgICAgCV9yYW5kb20oMCwgUkFSSVRZX0NIQU5DRV9SQU5HRSwgaGFzaCkgLyAoX2hlcm9MZXZlbCAqIF9nZXRCb251cyhfaGVyb0lkZW50aXR5KSk7IC8vIDAgLSAxMCAwMDAgMDAwCiAgICAgICAgdWludDI1NiByYXJpdHkgPSBfY29tcHV0ZVJhcml0eShyYXJpdHlDaGFuY2UsIAogICAgICAgICAgICBwYXJhbXNbVU5JUVVFX0lOREVYXzEzXSxwYXJhbXNbTEVHRU5EQVJZX0lOREVYXzE0XSwgcGFyYW1zW01ZVEhJQ19JTkRFWF8xNV0sIHBhcmFtc1tSQVJFX0lOREVYXzE2XSwgcGFyYW1zW1VOQ09NTU9OX0lOREVYXzE3XSk7CiAgICAgICAgICAgIAogICAgICAgIHVpbnQyNTYgY2xhc3NNZWNoOwogICAgICAgIAogICAgICAgIC8vIHN0YXJ0CiAgICAgICAgKGlkZW50aXR5LCBjbGFzc01lY2gpID0gX2NvbXB1dGVBbmRTZXRCYXNlUGFyYW1ldGVyczE2XzE4XzIyKGhhc2gpOwogICAgICAgIAogICAgICAgIGlkZW50aXR5ICs9IF9zZXRVbmlxdWVWYWx1ZTAoX2NvbXB1dGVVbmlxdWVuZXNzKHJhcml0eSwgcGFyYW1zW1VOSVFVRV9UT1RBTF9JTkRFWF8xOF0gKyAxKSk7CiAgICAgICAgaWRlbnRpdHkgKz0gX3NldFJhcml0eVZhbHVlMShyYXJpdHkpOwogICAgICAgIGlkZW50aXR5ICs9IF9zZXRDbGFzc1ZpZXdWYWx1ZTIoY2xhc3NNZWNoKTsgLy8gMSB0byAxIHdpdGggY2xhc3NNZWNoCiAgICAgICAgCiAgICAgICAgaWRlbnRpdHkgKz0gX3NldEJvZHlDb2xvclZhbHVlMygxICsgX3JhbmRvbSgwLCBwYXJhbXNbQk9EWV9DT0xPUl9NQVhfSU5ERVhfMF0sIGhhc2gsIEVZRVNfTUFTS180LCBCT0RZX0NPTE9SX01BU0tfMykpOwogICAgICAgIGlkZW50aXR5ICs9IF9zZXRFeWVzVmFsdWU0KDEgKyBfcmFuZG9tKDAsIHBhcmFtc1tFWUVTX01BWF9JTkRFWF8xXSwgaGFzaCwgTU9VVEhfTUFTS181LCBFWUVTX01BU0tfNCkpOwogICAgICAgIGlkZW50aXR5ICs9IF9zZXRNb3V0aFZhbHVlNSgxICsgX3JhbmRvbSgwLCBwYXJhbXNbTU9VVEhfTUFYXzJdLCBoYXNoLCBIRUlSX01BU0tfNiwgTU9VVEhfTUFTS181KSk7CiAgICAgICAgaWRlbnRpdHkgKz0gX3NldEhhaXJWYWx1ZTYoMSArIF9yYW5kb20oMCwgcGFyYW1zW0hBSVJfTUFYXzNdLCBoYXNoLCBIRUlSX0NPTE9SX01BU0tfNywgSEVJUl9NQVNLXzYpKTsKICAgICAgICBpZGVudGl0eSArPSBfc2V0SGFpckNvbG9yVmFsdWU3KDEgKyBfcmFuZG9tKDAsIHBhcmFtc1tIRUlSX0NPTE9SX01BWF80XSwgaGFzaCwgQVJNT1JfTUFTS184LCBIRUlSX0NPTE9SX01BU0tfNykpOwogICAgICAgIGlkZW50aXR5ICs9IF9zZXRBcm1vclZhbHVlOCgxICsgX3JhbmRvbSgwLCBwYXJhbXNbQVJNT1JfTUFYXzVdLCBoYXNoLCBXRUFQT05fTUFTS185LCBBUk1PUl9NQVNLXzgpKTsKICAgICAgICBpZGVudGl0eSArPSBfc2V0V2VhcG9uVmFsdWU5KDEgKyBfcmFuZG9tKDAsIHBhcmFtc1tXRUFQT05fTUFYXzZdLCBoYXNoLCBIQVRfTUFTS18xMCwgV0VBUE9OX01BU0tfOSkpOwogICAgICAgIGlkZW50aXR5ICs9IF9zZXRIYXRWYWx1ZTEwKF9yYW5kb20oMCwgcGFyYW1zW0hBVF9NQVhfN10sIGhhc2gsIFJVTkVTX01BU0tfMTEsIEhBVF9NQVNLXzEwKSk7Ly9yZW1vdmVkICsxCiAgICAgICAgCiAgICAgICAgaWRlbnRpdHkgKz0gX3NldFJ1bmVzVmFsdWUxMShfY29tcHV0ZVJ1bmVzKHJhcml0eSkpOwogICAgICAgIGlkZW50aXR5ICs9IF9zZXRXaW5nc1ZhbHVlMTIoX2NvbXB1dGVXaW5ncyhyYXJpdHksIHBhcmFtc1tXSU5HU19NQVhfOV0sIGhhc2gpKTsKICAgICAgICBpZGVudGl0eSArPSBfc2V0UGV0VmFsdWUxMyhfY29tcHV0ZVBldChyYXJpdHksIHBhcmFtc1tQRVRfTUFYXzEwXSwgaGFzaCkpOwogICAgICAgIGlkZW50aXR5ICs9IF9zZXRCb3JkZXJWYWx1ZTE0KF9jb21wdXRlQm9yZGVyKHJhcml0eSkpOyAvLyAxIHRvIDEgd2l0aCByYXJpdHkKICAgICAgICBpZGVudGl0eSArPSBfc2V0QmFja2dyb3VuZFZhbHVlMTUoX2NvbXB1dGVCYWNrZ3JvdW5kKHJhcml0eSkpOyAvLyAxIHRvIDEgd2l0aCByYXJpdHkKICAgICAgICAKICAgICAgICBpZGVudGl0eSArPSBfc2V0Q2xhc3NNZWNoVmFsdWUxOShjbGFzc01lY2gpOwoKICAgICAgICBpZGVudGl0eSArPSBfc2V0UmFyaXR5Qm9udXNWYWx1ZTIwKF9jb21wdXRlUmFyaXR5Qm9udXMocmFyaXR5LCBoYXNoKSk7CiAgICAgICAgaWRlbnRpdHkgKz0gX3NldFNwZWNpYWxpdHlWYWx1ZTIxKHNwZWNpYWxQZXJjKTsgLy8gY3VycmVudGx5IG9ubHkgbWluZXIgKDEpCiAgICAgICAgCiAgICAgICAgaWRlbnRpdHkgKz0gX3NldEF1cmFWYWx1ZTIzKF9jb21wdXRlQXVyYShyYXJpdHksIGhhc2gpKTsKICAgICAgICAvLyBlbmQKICAgICAgICByZXR1cm4gaWRlbnRpdHk7CiAgICB9CiAgICAKCWZ1bmN0aW9uIF9jaGFuZ2VQYXJhbWV0ZXIodWludDI1NiBfcGFyYW1JbmRleCwgdWludDMyIF92YWx1ZSwgdWludDMyWzE5XSBzdG9yYWdlIHBhcmFtZXRlcnMpIGludGVybmFsIHsKCQkvL3dlIGNhbiBjaGFuZ2Ugb25seSB2aWV3IHBhcmFtZXRlcnMsIGFuZCB1bmlxdWUgY291bnQgaW4gbWF4IHJhbmdlIDw9IDEwMAoJCXJlcXVpcmUoX3BhcmFtSW5kZXggPj0gQk9EWV9DT0xPUl9NQVhfSU5ERVhfMCAmJiBfcGFyYW1JbmRleCA8PSBVTklRVUVfSU5ERVhfMTMpOwoJCS8vd2UgY2FuIE5PVCBzZXQgcGV0LCBib3JkZXIgYW5kIGJhY2tncm91bmQgdmFsdWVzLAoJCS8vdGhvc2UgdmFsdWVzIGhhdmUgc3BlY2lhbCBsb2dpYyBiZWhpbmQgdGhlbQoJCXJlcXVpcmUoCgkJICAgIF9wYXJhbUluZGV4ICE9IFJVTkVTX01BWF84ICYmIAoJCSAgICBfcGFyYW1JbmRleCAhPSBQRVRfTUFYXzEwICYmIAoJCSAgICBfcGFyYW1JbmRleCAhPSBCT1JERVJfTUFYXzExICYmIAoJCSAgICBfcGFyYW1JbmRleCAhPSBCQUNLR1JPVU5EX01BWF8xMgoJCSk7CgkJLy92YWx1ZSBvZiBib2R5Q29sb3IsIGV5ZXMsIG1vdXRoLCBoYWlyLCBoYWlyQ29sb3IsIGFybW9yLCB3ZWFwb24sIGhhdCBtdXN0IGJlIDwgMTAwMAoJCXJlcXVpcmUoX3BhcmFtSW5kZXggPiBIQVRfTUFYXzcgfHwgX3ZhbHVlIDwgMTAwMCk7CgkJLy92YWx1ZSBvZiB3aW5ncywgIG11c3QgYmUgPCAxMDAKCQlyZXF1aXJlKF9wYXJhbUluZGV4ID4gQkFDS0dST1VORF9NQVhfMTIgfHwgX3ZhbHVlIDwgMTAwKTsKCQkvL2NoZWNrIHRoYXQgbWF4IHRvdGFsIG51bWJlciBvZiBVTklRVUUgd2FycmlvcnMgdGhhdCB3ZSBjYW4gZW1pdCBpcyBub3QgPiAxMDAKCQlyZXF1aXJlKF9wYXJhbUluZGV4ICE9IFVOSVFVRV9JTkRFWF8xMyB8fCAoX3ZhbHVlICsgcGFyYW1ldGVyc1tVTklRVUVfVE9UQUxfSU5ERVhfMThdKSA8PSAxMDApOwoJCQoJCXBhcmFtZXRlcnNbX3BhcmFtSW5kZXhdID0gX3ZhbHVlOwogICAgfQogICAgCglmdW5jdGlvbiBfcmVjb3JkV2FycmlvckRhdGEodWludDI1NiBpZGVudGl0eSwgdWludDMyWzE5XSBzdG9yYWdlIHBhcmFtZXRlcnMpIGludGVybmFsIHsKICAgICAgICB1aW50MjU2IHJhcml0eSA9IGdldFJhcml0eVZhbHVlKGlkZW50aXR5KTsKICAgICAgICBpZiAocmFyaXR5ID09IFVOQ09NTU9OKSB7IC8vIHVuY29tbW9uCiAgICAgICAgICAgIHBhcmFtZXRlcnNbVU5DT01NT05fSU5ERVhfMTddLS07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHJhcml0eSA9PSBSQVJFKSB7IC8vIHJhcmUKICAgICAgICAgICAgcGFyYW1ldGVyc1tSQVJFX0lOREVYXzE2XS0tOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChyYXJpdHkgPT0gTVlUSElDKSB7IC8vIG15dGhpYwogICAgICAgICAgICBwYXJhbWV0ZXJzW01ZVEhJQ19JTkRFWF8xNV0tLTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAocmFyaXR5ID09IExFR0VOREFSWSkgeyAvLyBsZWdlbmRhcnkKICAgICAgICAgICAgcGFyYW1ldGVyc1tMRUdFTkRBUllfSU5ERVhfMTRdLS07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHJhcml0eSA9PSBVTklRVUUpIHsgLy8gdW5pcXVlCiAgICAgICAgICAgIHBhcmFtZXRlcnNbVU5JUVVFX0lOREVYXzEzXS0tOwogICAgICAgICAgICBwYXJhbWV0ZXJzW1VOSVFVRV9UT1RBTF9JTkRFWF8xOF0gKys7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF92YWxpZGF0ZUlkZW50aXR5KHVpbnQyNTYgX2lkZW50aXR5LCB1aW50MzJbMTldIG1lbW9yeSBwYXJhbXMpIGludGVybmFsIHB1cmUgcmV0dXJucyhib29sKXsKICAgICAgICB1aW50MjU2IHJhcml0eSA9IGdldFJhcml0eVZhbHVlKF9pZGVudGl0eSk7CiAgICAgICAgcmVxdWlyZShyYXJpdHkgPD0gVU5JUVVFKTsKICAgICAgICAKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICByYXJpdHkgPD0gQ09NTU9OIHx8Ly9jb21tb24gCiAgICAgICAgICAgIChyYXJpdHkgPT0gVU5DT01NT04gJiYgcGFyYW1zW1VOQ09NTU9OX0lOREVYXzE3XSA+IDApIHx8Ly91bmNvbW1vbgogICAgICAgICAgICAocmFyaXR5ID09IFJBUkUgJiYgcGFyYW1zW1JBUkVfSU5ERVhfMTZdID4gMCkgfHwvL3JhcmUKICAgICAgICAgICAgKHJhcml0eSA9PSBNWVRISUMgJiYgcGFyYW1zW01ZVEhJQ19JTkRFWF8xNV0gPiAwKSB8fC8vbXl0aGljCiAgICAgICAgICAgIChyYXJpdHkgPT0gTEVHRU5EQVJZICYmIHBhcmFtc1tMRUdFTkRBUllfSU5ERVhfMTRdID4gMCkgfHwvL2xlZ2VuZGFyeQogICAgICAgICAgICAocmFyaXR5ID09IFVOSVFVRSAmJiBwYXJhbXNbVU5JUVVFX0lOREVYXzEzXSA+IDApLy91bmlxdWUKICAgICAgICApOwogICAgICAgIHJlcXVpcmUocmFyaXR5ICE9IFVOSVFVRSB8fCBnZXRVbmlxdWVWYWx1ZShfaWRlbnRpdHkpID4gcGFyYW1zW1VOSVFVRV9UT1RBTF9JTkRFWF8xOF0pOwogICAgICAgIAogICAgICAgIC8vY2hlY2sgYmF0dGxlIHBhcmFtZXRlcnMKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBnZXRTdHJlbmd0aFZhbHVlKF9pZGVudGl0eSkgPCAxMDAgJiYKICAgICAgICAgICAgZ2V0QWdpbGl0eVZhbHVlKF9pZGVudGl0eSkgPCAxMDAgJiYKICAgICAgICAgICAgZ2V0SW50ZWxsaWdlbmNlVmFsdWUoX2lkZW50aXR5KSA8IDEwMCAmJgogICAgICAgICAgICBnZXREYW1hZ2VWYWx1ZShfaWRlbnRpdHkpIDw9IDU1CiAgICAgICAgKTsKICAgICAgICByZXF1aXJlKGdldENsYXNzTWVjaFZhbHVlKF9pZGVudGl0eSkgPD0gTUFHRSk7CiAgICAgICAgcmVxdWlyZShnZXRDbGFzc01lY2hWYWx1ZShfaWRlbnRpdHkpID09IGdldENsYXNzVmlld1ZhbHVlKF9pZGVudGl0eSkpOwogICAgICAgIHJlcXVpcmUoZ2V0U3BlY2lhbGl0eVZhbHVlKF9pZGVudGl0eSkgPD0gTUlORVJfUEVSSyk7CiAgICAgICAgcmVxdWlyZShnZXRSYXJpdHlCb251c1ZhbHVlKF9pZGVudGl0eSkgPD0gQk9OVVNfREFNQUdFKTsKICAgICAgICByZXF1aXJlKGdldEF1cmFWYWx1ZShfaWRlbnRpdHkpIDw9IEJPTlVTX0RBTUFHRSk7CiAgICAgICAgCiAgICAgICAgLy9jaGVjayB2aWV3CiAgICAgICAgcmVxdWlyZShnZXRCb2R5Q29sb3JWYWx1ZShfaWRlbnRpdHkpIDw9IHBhcmFtc1tCT0RZX0NPTE9SX01BWF9JTkRFWF8wXSk7CiAgICAgICAgcmVxdWlyZShnZXRFeWVzVmFsdWUoX2lkZW50aXR5KSA8PSBwYXJhbXNbRVlFU19NQVhfSU5ERVhfMV0pOwogICAgICAgIHJlcXVpcmUoZ2V0TW91dGhWYWx1ZShfaWRlbnRpdHkpIDw9IHBhcmFtc1tNT1VUSF9NQVhfMl0pOwogICAgICAgIHJlcXVpcmUoZ2V0SGFpclZhbHVlKF9pZGVudGl0eSkgPD0gcGFyYW1zW0hBSVJfTUFYXzNdKTsKICAgICAgICByZXF1aXJlKGdldEhhaXJDb2xvclZhbHVlKF9pZGVudGl0eSkgPD0gcGFyYW1zW0hFSVJfQ09MT1JfTUFYXzRdKTsKICAgICAgICByZXF1aXJlKGdldEFybW9yVmFsdWUoX2lkZW50aXR5KSA8PSBwYXJhbXNbQVJNT1JfTUFYXzVdKTsKICAgICAgICByZXF1aXJlKGdldFdlYXBvblZhbHVlKF9pZGVudGl0eSkgPD0gcGFyYW1zW1dFQVBPTl9NQVhfNl0pOwogICAgICAgIHJlcXVpcmUoZ2V0SGF0VmFsdWUoX2lkZW50aXR5KSA8PSBwYXJhbXNbSEFUX01BWF83XSk7CiAgICAgICAgcmVxdWlyZShnZXRSdW5lc1ZhbHVlKF9pZGVudGl0eSkgPD0gcGFyYW1zW1JVTkVTX01BWF84XSk7CiAgICAgICAgcmVxdWlyZShnZXRXaW5nc1ZhbHVlKF9pZGVudGl0eSkgPD0gcGFyYW1zW1dJTkdTX01BWF85XSk7CiAgICAgICAgcmVxdWlyZShnZXRQZXRWYWx1ZShfaWRlbnRpdHkpIDw9IHBhcmFtc1tQRVRfTUFYXzEwXSk7CiAgICAgICAgcmVxdWlyZShnZXRCb3JkZXJWYWx1ZShfaWRlbnRpdHkpIDw9IHBhcmFtc1tCT1JERVJfTUFYXzExXSk7CiAgICAgICAgcmVxdWlyZShnZXRCYWNrZ3JvdW5kVmFsdWUoX2lkZW50aXR5KSA8PSBwYXJhbXNbQkFDS0dST1VORF9NQVhfMTJdKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgLyogVU5QQUNLIE1FVEhPRFMgKi8KICAgIC8vY29tbW9uCiAgICBmdW5jdGlvbiBfdW5wYWNrQ2xhc3NWYWx1ZSh1aW50MjU2IHBhY2tlZFZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChwYWNrZWRWYWx1ZSAlIFJBUklUWV9QQUNLXzIgLyBDTEFTU19QQUNLXzApOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfdW5wYWNrUmFyaXR5Qm9udXNWYWx1ZSh1aW50MjU2IHBhY2tlZFZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChwYWNrZWRWYWx1ZSAlIFJBUklUWV9QQUNLXzIgLyBSQVJJVFlfQk9OVVNfUEFDS18xKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3VucGFja1Jhcml0eVZhbHVlKHVpbnQyNTYgcGFja2VkVmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKHBhY2tlZFZhbHVlICUgRVhQRVJJRU5DRV9QQUNLXzMgLyBSQVJJVFlfUEFDS18yKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3VucGFja0V4cFZhbHVlKHVpbnQyNTYgcGFja2VkVmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKHBhY2tlZFZhbHVlICUgSU5URUxMSUdFTkNFX1BBQ0tfNCAvIEVYUEVSSUVOQ0VfUEFDS18zKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfdW5wYWNrTGV2ZWxWYWx1ZSh1aW50MjU2IHBhY2tlZFZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChwYWNrZWRWYWx1ZSAlIElOVEVMTElHRU5DRV9QQUNLXzQpIC8gKEVYUEVSSUVOQ0VfUEFDS18zICogUE9JTlRTX1RPX0xFVkVMKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3VucGFja0ludGVsbGlnZW5jZVZhbHVlKHVpbnQyNTYgcGFja2VkVmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQyNTYpewogICAgICAgIHJldHVybiBpbnQyNTYocGFja2VkVmFsdWUgJSBBR0lMSVRZX1BBQ0tfNSAvIElOVEVMTElHRU5DRV9QQUNLXzQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfdW5wYWNrQWdpbGl0eVZhbHVlKHVpbnQyNTYgcGFja2VkVmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQyNTYpewogICAgICAgIHJldHVybiBpbnQyNTYocGFja2VkVmFsdWUgJSBTVFJFTkdUSF9QQUNLXzYgLyBBR0lMSVRZX1BBQ0tfNSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF91bnBhY2tTdHJlbmd0aFZhbHVlKHVpbnQyNTYgcGFja2VkVmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQyNTYpewogICAgICAgIHJldHVybiBpbnQyNTYocGFja2VkVmFsdWUgJSBCQVNFX0RBTUFHRV9QQUNLXzcgLyBTVFJFTkdUSF9QQUNLXzYpOwogICAgfQoKICAgIGZ1bmN0aW9uIF91bnBhY2tCYXNlRGFtYWdlVmFsdWUodWludDI1NiBwYWNrZWRWYWx1ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKGludDI1Nil7CiAgICAgICAgcmV0dXJuIGludDI1NihwYWNrZWRWYWx1ZSAlIFBFVF9QQUNLXzggLyBCQVNFX0RBTUFHRV9QQUNLXzcpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfdW5wYWNrUGV0VmFsdWUodWludDI1NiBwYWNrZWRWYWx1ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiAocGFja2VkVmFsdWUgJSBBVVJBX1BBQ0tfOSAvIFBFVF9QQUNLXzgpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfdW5wYWNrQXVyYVZhbHVlKHVpbnQyNTYgcGFja2VkVmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKHBhY2tlZFZhbHVlICUgV0FSUklPUl9JRF9QQUNLXzEwIC8gQVVSQV9QQUNLXzkpOwogICAgfQogICAgLy8KICAgIC8vcHZwIHVucGFjawogICAgZnVuY3Rpb24gX3VucGFja0lkVmFsdWUodWludDI1NiBwYWNrZWRWYWx1ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiAocGFja2VkVmFsdWUgJSBQVlBfQ1lDTEVfUEFDS18xMSAvIFdBUlJJT1JfSURfUEFDS18xMCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF91bnBhY2tDeWNsZVZhbHVlKHVpbnQyNTYgcGFja2VkVmFsdWUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKHBhY2tlZFZhbHVlICUgUkFUSU5HX1BBQ0tfMTIgLyBQVlBfQ1lDTEVfUEFDS18xMSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF91bnBhY2tSYXRpbmdWYWx1ZSh1aW50MjU2IHBhY2tlZFZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIChwYWNrZWRWYWx1ZSAlIFBWUF9CQVNFX1BBQ0tfMTMgLyBSQVRJTkdfUEFDS18xMik7CiAgICB9CiAgICAKICAgIC8vbWF4IGN5Y2xlIHNraXAgdmFsdWUgY2FudCBiZSBtb3JlIHRoYW4gMTAwMDAwMDAwMAogICAgZnVuY3Rpb24gX2NoYW5nZUN5Y2xlVmFsdWUodWludDI1NiBwYWNrZWRWYWx1ZSwgdWludDI1NiBuZXdWYWx1ZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUgPiAxMDAwMDAwMDAwID8gMTAwMDAwMDAwMCA6IG5ld1ZhbHVlOwogICAgICAgIHJldHVybiBwYWNrZWRWYWx1ZSAtIChfdW5wYWNrQ3ljbGVWYWx1ZShwYWNrZWRWYWx1ZSkgKiBQVlBfQ1lDTEVfUEFDS18xMSkgKyBuZXdWYWx1ZSAqIFBWUF9DWUNMRV9QQUNLXzExOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfcGFja1dhcnJpb3JDb21tb25EYXRhKHVpbnQyNTYgX2lkZW50aXR5LCB1aW50MjU2IF9leHBlcmllbmNlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1Nil7CiAgICAgICAgdWludDI1NiBwYWNrZWREYXRhID0gMDsKICAgICAgICBwYWNrZWREYXRhICs9IGdldENsYXNzTWVjaFZhbHVlKF9pZGVudGl0eSkgKiBDTEFTU19QQUNLXzA7CiAgICAgICAgcGFja2VkRGF0YSArPSBnZXRSYXJpdHlCb251c1ZhbHVlKF9pZGVudGl0eSkgKiBSQVJJVFlfQk9OVVNfUEFDS18xOwogICAgICAgIHBhY2tlZERhdGEgKz0gZ2V0UmFyaXR5VmFsdWUoX2lkZW50aXR5KSAqIFJBUklUWV9QQUNLXzI7CiAgICAgICAgcGFja2VkRGF0YSArPSBfZXhwZXJpZW5jZSAqIEVYUEVSSUVOQ0VfUEFDS18zOwogICAgICAgIHBhY2tlZERhdGEgKz0gZ2V0SW50ZWxsaWdlbmNlVmFsdWUoX2lkZW50aXR5KSAqIElOVEVMTElHRU5DRV9QQUNLXzQ7CiAgICAgICAgcGFja2VkRGF0YSArPSBnZXRBZ2lsaXR5VmFsdWUoX2lkZW50aXR5KSAqIEFHSUxJVFlfUEFDS181OwogICAgICAgIHBhY2tlZERhdGEgKz0gZ2V0U3RyZW5ndGhWYWx1ZShfaWRlbnRpdHkpICogU1RSRU5HVEhfUEFDS182OwogICAgICAgIHBhY2tlZERhdGEgKz0gZ2V0RGFtYWdlVmFsdWUoX2lkZW50aXR5KSAqIEJBU0VfREFNQUdFX1BBQ0tfNzsKICAgICAgICBwYWNrZWREYXRhICs9IGdldFBldFZhbHVlKF9pZGVudGl0eSkgKiBQRVRfUEFDS184OwogICAgICAgIAogICAgICAgIHJldHVybiBwYWNrZWREYXRhOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfcGFja1dhcnJpb3JQdnBEYXRhKHVpbnQyNTYgX2lkZW50aXR5LCB1aW50MjU2IF9yYXRpbmcsIHVpbnQyNTYgX3B2cEN5Y2xlLCB1aW50MjU2IF93YXJyaW9ySWQsIHVpbnQyNTYgX2V4cGVyaWVuY2UpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICB1aW50MjU2IHBhY2tlZERhdGEgPSBfcGFja1dhcnJpb3JDb21tb25EYXRhKF9pZGVudGl0eSwgX2V4cGVyaWVuY2UpOwogICAgICAgIHBhY2tlZERhdGEgKz0gX3dhcnJpb3JJZCAqIFdBUlJJT1JfSURfUEFDS18xMDsKICAgICAgICBwYWNrZWREYXRhICs9IF9wdnBDeWNsZSAqIFBWUF9DWUNMRV9QQUNLXzExOwogICAgICAgIC8vcmF0aW5nIE1VU1QgaGF2ZSBtb3N0IHNpZ25pZmljYW50IHZhbHVlIQogICAgICAgIHBhY2tlZERhdGEgKz0gX3JhdGluZyAqIFJBVElOR19QQUNLXzEyOwogICAgICAgIHJldHVybiBwYWNrZWREYXRhOwogICAgfQogICAgCiAgICAvKiBUT1VSTkFNRU5UIEJBVFRMRVMgKi8KICAgIAogICAgCiAgICBmdW5jdGlvbiBfcGFja1dhcnJpb3JJZHModWludDI1NltdIG1lbW9yeSBwYWNrZWRXYXJyaW9ycykgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHVpbnQyNTYgcGFja2VkSWRzID0gMDsKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IHBhY2tlZFdhcnJpb3JzLmxlbmd0aDsKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGxlbmd0aDsgaSArKykgewogICAgICAgICAgICBwYWNrZWRJZHMgKz0gKE1BWF9JRF9TSVpFICoqIGkpICogX3VucGFja0lkVmFsdWUocGFja2VkV2FycmlvcnNbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcGFja2VkSWRzOwogICAgfQoKICAgIGZ1bmN0aW9uIF91bnBhY2tXYXJyaW9ySWQodWludDI1NiBwYWNrZWRJZHMsIHVpbnQyNTYgaW5kZXgpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KXsKICAgICAgICByZXR1cm4gKHBhY2tlZElkcyAlIChNQVhfSURfU0laRSAqKiAoaW5kZXggKyAxKSkgLyAoTUFYX0lEX1NJWkUgKiogaW5kZXgpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3BhY2tDb21iaW5lZFBhcmFtcyhpbnQyNTYgaHAsIGludDI1NiBkYW1hZ2UsIGludDI1NiBhcm1vciwgaW50MjU2IGRvZGdlLCBpbnQyNTYgcGVuZXRyYXRpb24pIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjb21iaW5lZFdhcnJpb3IgPSAwOwogICAgICAgIGNvbWJpbmVkV2FycmlvciArPSB1aW50MjU2KGhwKSAqIEhQX1BBQ0tfMDsKICAgICAgICBjb21iaW5lZFdhcnJpb3IgKz0gdWludDI1NihkYW1hZ2UpICogREFNQUdFX1BBQ0tfMTsKICAgICAgICBjb21iaW5lZFdhcnJpb3IgKz0gdWludDI1Nihhcm1vcikgKiBBUk1PUl9QQUNLXzI7CiAgICAgICAgY29tYmluZWRXYXJyaW9yICs9IHVpbnQyNTYoZG9kZ2UpICogRE9ER0VfUEFDS18zOwogICAgICAgIGNvbWJpbmVkV2FycmlvciArPSB1aW50MjU2KHBlbmV0cmF0aW9uKSAqIFBFTkVUUkFUSU9OX1BBQ0tfNDsKICAgICAgICByZXR1cm4gY29tYmluZWRXYXJyaW9yOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfdW5wYWNrUHJvdGVjdGlvblBhcmFtcyh1aW50MjU2IGNvbWJpbmVkV2FycmlvcikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIAogICAgKGludDI1NiBocCwgaW50MjU2IGFybW9yLCBpbnQyNTYgZG9kZ2UpewogICAgICAgIGhwID0gaW50MjU2KGNvbWJpbmVkV2FycmlvciAlIERBTUFHRV9QQUNLXzEgLyBIUF9QQUNLXzApOwogICAgICAgIGFybW9yID0gaW50MjU2KGNvbWJpbmVkV2FycmlvciAlIERPREdFX1BBQ0tfMyAvIEFSTU9SX1BBQ0tfMik7CiAgICAgICAgZG9kZ2UgPSBpbnQyNTYoY29tYmluZWRXYXJyaW9yICUgUEVORVRSQVRJT05fUEFDS180IC8gRE9ER0VfUEFDS18zKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3VucGFja0F0dGFja1BhcmFtcyh1aW50MjU2IGNvbWJpbmVkV2FycmlvcikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKGludDI1NiBkYW1hZ2UsIGludDI1NiBwZW5ldHJhdGlvbikgewogICAgICAgIGRhbWFnZSA9IGludDI1Nihjb21iaW5lZFdhcnJpb3IgJSBBUk1PUl9QQUNLXzIgLyBEQU1BR0VfUEFDS18xKTsKICAgICAgICBwZW5ldHJhdGlvbiA9IGludDI1Nihjb21iaW5lZFdhcnJpb3IgJSBDT01CSU5FX0JBU0VfUEFDS181IC8gUEVORVRSQVRJT05fUEFDS180KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2NvbWJpbmVXYXJyaW9ycyh1aW50MjU2W10gbWVtb3J5IHBhY2tlZFdhcnJpb3JzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpbnQyNTYgaHA7CiAgICAgICAgaW50MjU2IGRhbWFnZTsKCQlpbnQyNTYgYXJtb3I7CgkJaW50MjU2IGRvZGdlOwoJCWludDI1NiBwZW5ldHJhdGlvbjsKCQkKCQkoaHAsIGRhbWFnZSwgYXJtb3IsIGRvZGdlLCBwZW5ldHJhdGlvbikgPSBfY29tcHV0ZUNvbWJpbmVkUGFyYW1zKHBhY2tlZFdhcnJpb3JzKTsKICAgICAgICByZXR1cm4gX3BhY2tDb21iaW5lZFBhcmFtcyhocCwgZGFtYWdlLCBhcm1vciwgZG9kZ2UsIHBlbmV0cmF0aW9uKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2NvbXB1dGVDb21iaW5lZFBhcmFtcyh1aW50MjU2W10gbWVtb3J5IHBhY2tlZFdhcnJpb3JzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgCiAgICAoaW50MjU2IHRvdGFsSHAsIGludDI1NiB0b3RhbERhbWFnZSwgaW50MjU2IG1heEFybW9yLCBpbnQyNTYgbWF4RG9kZ2UsIGludDI1NiBtYXhQZW5ldHJhdGlvbil7CiAgICAgICAgdWludDI1NiBsZW5ndGggPSBwYWNrZWRXYXJyaW9ycy5sZW5ndGg7CiAgICAgICAgCiAgICAgICAgaW50MjU2IGhwOwoJCWludDI1NiBhcm1vcjsKCQlpbnQyNTYgZG9kZ2U7CgkJaW50MjU2IHBlbmV0cmF0aW9uOwoJCQoJCXVpbnQyNTYgd2FycmlvckF1cmFzOwoJCXVpbnQyNTYgcGV0QXVyYXM7CgkJKHdhcnJpb3JBdXJhcywgcGV0QXVyYXMpID0gX2dldEF1cmFzRGF0YShwYWNrZWRXYXJyaW9ycyk7CgkJCgkJdWludDI1NiBwYWNrZWRXYXJyaW9yOwogICAgICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgIHBhY2tlZFdhcnJpb3IgPSBwYWNrZWRXYXJyaW9yc1tpXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRvdGFsRGFtYWdlICs9IGdldERhbWFnZShwYWNrZWRXYXJyaW9yLCB3YXJyaW9yQXVyYXMsIHBldEF1cmFzKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHBlbmV0cmF0aW9uID0gZ2V0UGVuZXRyYXRpb24ocGFja2VkV2Fycmlvciwgd2FycmlvckF1cmFzLCBwZXRBdXJhcyk7CiAgICAgICAgICAgIG1heFBlbmV0cmF0aW9uID0gbWF4UGVuZXRyYXRpb24gPiBwZW5ldHJhdGlvbiA/IG1heFBlbmV0cmF0aW9uIDogcGVuZXRyYXRpb247CgkJCShocCwgYXJtb3IsIGRvZGdlKSA9IF9nZXRQcm90ZWN0aW9uUGFyYW1zKHBhY2tlZFdhcnJpb3IsIHdhcnJpb3JBdXJhcywgcGV0QXVyYXMpOwogICAgICAgICAgICB0b3RhbEhwICs9IGhwOwogICAgICAgICAgICBtYXhBcm1vciA9IG1heEFybW9yID4gYXJtb3IgPyBtYXhBcm1vciA6IGFybW9yOwogICAgICAgICAgICBtYXhEb2RnZSA9IG1heERvZGdlID4gZG9kZ2UgPyBtYXhEb2RnZSA6IGRvZGdlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dldEF1cmFzRGF0YSh1aW50MjU2W10gbWVtb3J5IHBhY2tlZFdhcnJpb3JzKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NiB3YXJyaW9yQXVyYXMsIHVpbnQyNTYgcGV0QXVyYXMpIHsKICAgICAgICB1aW50MjU2IGxlbmd0aCA9IHBhY2tlZFdhcnJpb3JzLmxlbmd0aDsKICAgICAgICAKICAgICAgICB3YXJyaW9yQXVyYXMgPSAwOwogICAgICAgIHBldEF1cmFzID0gMDsKICAgICAgICAKICAgICAgICB1aW50MjU2IHBhY2tlZFdhcnJpb3I7CiAgICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKyspIHsKICAgICAgICAgICAgcGFja2VkV2FycmlvciA9IHBhY2tlZFdhcnJpb3JzW2ldOwogICAgICAgICAgICB3YXJyaW9yQXVyYXMgPSBlbmFibGVBdXJhKHdhcnJpb3JBdXJhcywgKF91bnBhY2tBdXJhVmFsdWUocGFja2VkV2FycmlvcikpKTsKICAgICAgICAgICAgcGV0QXVyYXMgPSBlbmFibGVBdXJhKHBldEF1cmFzLCAoX2dldFBldEF1cmEoX3VucGFja1BldERhdGEoX3VucGFja1BldFZhbHVlKHBhY2tlZFdhcnJpb3IpKSkpKTsKICAgICAgICB9CiAgICAgICAgd2FycmlvckF1cmFzID0gZmlsdGVyV2FycmlvckF1cmFzKHdhcnJpb3JBdXJhcywgcGV0QXVyYXMpOwogICAgICAgIHJldHVybiAod2FycmlvckF1cmFzLCBwZXRBdXJhcyk7CiAgICB9CiAgICAKICAgIC8vIEdldCBiaXQgdmFsdWUgYXQgcG9zaXRpb24KICAgIGZ1bmN0aW9uIGlzQXVyYVNldCh1aW50MjU2IGF1cmEsIHVpbnQyNTYgYXVyYUluZGV4KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXVyYSAmICh1aW50MjU2KDB4MDEpIDw8IGF1cmFJbmRleCkgIT0gMDsKICAgIH0KICAgIAogICAgLy8gU2V0IGJpdCB2YWx1ZSBhdCBwb3NpdGlvbgogICAgZnVuY3Rpb24gZW5hYmxlQXVyYSh1aW50MjU2IGEsIHVpbnQyNTYgbikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGEgfCAodWludDI1NigweDAxKSA8PCBuKTsKICAgIH0KICAgIAogICAgLy9zd2l0Y2ggb2ZmIHdhcnJpb3IgYXVyYXMgdGhhdCBhcmUgZW5hYmxlZCBpbiBwZXRzIGF1cmFzLCBwZXQgYXVyYSBoYXZlIHByaW9yaXR5CiAgICBmdW5jdGlvbiBmaWx0ZXJXYXJyaW9yQXVyYXModWludDI1NiBfd2FycmlvckF1cmFzLCB1aW50MjU2IF9wZXRBdXJhcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKF93YXJyaW9yQXVyYXMgJiBfcGV0QXVyYXMpIF4gX3dhcnJpb3JBdXJhczsKICAgIH0KICAKICAgIGZ1bmN0aW9uIF9nZXRUb3VybmFtZW50QmF0dGxlcyh1aW50MjU2IF9udW1iZXJPZkNvbnRlbmRlcnMpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIChfbnVtYmVyT2ZDb250ZW5kZXJzICogQkFUVExFU19QRVJfQ09OVEVOREVSIC8gMik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFRvdXJuYW1lbnRCYXR0bGVSZXN1bHRzKHVpbnQyNTZbXSBtZW1vcnkgY29tYmluZWRXYXJyaW9ycywgdWludDI1NiBfdGFyZ2V0QmxvY2spIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDMyW10gbWVtb3J5IHJlc3VsdHMpewogICAgICAgIHVpbnQyNTYgbGVuZ3RoID0gY29tYmluZWRXYXJyaW9ycy5sZW5ndGg7CiAgICAgICAgcmVzdWx0cyA9IG5ldyB1aW50MzJbXShsZW5ndGgpOwoJCQoJCWludDI1NiBkYW1hZ2UxOwoJCWludDI1NiBwZW5ldHJhdGlvbjE7CgkJCgkJdWludDI1NiBoYXNoOwoJCQoJCXVpbnQyNTYgcmFuZG9tSW5kZXg7CgkJdWludDI1NiBleHAgPSAwOwoJCXVpbnQyNTYgaTsKCQl1aW50MjU2IHJlc3VsdDsKICAgICAgICBmb3IoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKyspIHsKICAgICAgICAgICAgKGRhbWFnZTEsIHBlbmV0cmF0aW9uMSkgPSBfdW5wYWNrQXR0YWNrUGFyYW1zKGNvbWJpbmVkV2FycmlvcnNbaV0pOwogICAgICAgICAgICB3aGlsZShyZXN1bHRzW2ldIDwgQkFUVExFU19QRVJfQ09OVEVOREVSX1NVTSkgewogICAgICAgICAgICAgICAgLy9pZiB3ZSBqdXN0IHN0YXJ0ZWQgZ2VuZXJhdGUgbmV3IHJhbmRvbSBzb3VyY2UKICAgICAgICAgICAgICAgIC8vb3IgcmVnZW5lcmF0ZSBpZiB3ZSB1c2VkIGFsbCBkYXRhIGZyb20gaXQKICAgICAgICAgICAgICAgIGlmIChleHAgPT0gMCB8fCBleHAgPiA3MykgewogICAgICAgICAgICAgICAgICAgIGhhc2ggPSB1aW50MjU2KGtlY2NhazI1NihibG9jay5ibG9ja2hhc2goX2dldFRhcmdldEJsb2NrKF90YXJnZXRCbG9jayAtIGkpKSwgdWludDI1NihkYW1hZ2UxKSArIG5vdykpOwogICAgICAgICAgICAgICAgICAgIGV4cCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL3dlIGRvIG5vdCBmaWdodCB3aXRoIHNlbGYgaWYgdGhlcmUgYXJlIG90aGVyIHdhcnJpb3JzCiAgICAgICAgICAgICAgICByYW5kb21JbmRleCA9IChfcmFuZG9tKGkgKyAxIDwgbGVuZ3RoID8gaSArIDEgOiBpLCBsZW5ndGgsIGhhc2gsIDEwMDAgKiAxMCoqZXhwLCAxMCoqZXhwKSk7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBnZXRUb3VybmFtZW50QmF0dGxlUmVzdWx0KGRhbWFnZTEsIHBlbmV0cmF0aW9uMSwgY29tYmluZWRXYXJyaW9yc1tpXSwKICAgICAgICAgICAgICAgICAgICBjb21iaW5lZFdhcnJpb3JzW3JhbmRvbUluZGV4XSwgaGFzaCAlICgxMDAwICogMTAqKmV4cCkgLyAxMCoqZXhwKTsKICAgICAgICAgICAgICAgIHJlc3VsdHNbcmVzdWx0ID09IDEgPyBpIDogcmFuZG9tSW5kZXhdICs9IDEwMTsvL2ljcmVtZW50IGJhdHRsZSBjb3VudCAxMDAgYW5kICsxIHdpbgogICAgICAgICAgICAgICAgcmVzdWx0c1tyZXN1bHQgPT0gMSA/IHJhbmRvbUluZGV4IDogaV0gKz0gMTAwOy8vaW5jcmVtZW50IG9ubHkgYmF0dGxlIGNvdW50IDEwMCBmb3IgbG9zZXIKICAgICAgICAgICAgICAgIGlmIChyZXN1bHRzW3JhbmRvbUluZGV4XSA+PSBCQVRUTEVTX1BFUl9DT05URU5ERVJfU1VNKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmRvbUluZGV4IDwgbGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBfc3dhcFZhbHVlcyhjb21iaW5lZFdhcnJpb3JzLCByZXN1bHRzLCByYW5kb21JbmRleCwgbGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxlbmd0aCAtLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGV4cCsrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vZmlsdGVyIGJhdHRsZSBjb3VudCBmcm9tIHJlc3VsdHMKICAgICAgICBsZW5ndGggPSBjb21iaW5lZFdhcnJpb3JzLmxlbmd0aDsKICAgICAgICBmb3IoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKyspIHsKICAgICAgICAgICAgcmVzdWx0c1tpXSA9IHJlc3VsdHNbaV0gJSAxMDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfc3dhcFZhbHVlcyh1aW50MjU2W10gbWVtb3J5IGNvbWJpbmVkV2FycmlvcnMsIHVpbnQzMltdIG1lbW9yeSByZXN1bHRzLCB1aW50MjU2IGlkMSwgdWludDI1NiBpZDIpIGludGVybmFsIHB1cmUgewogICAgICAgIHVpbnQyNTYgdGVtcCA9IGNvbWJpbmVkV2FycmlvcnNbaWQxXTsKICAgICAgICBjb21iaW5lZFdhcnJpb3JzW2lkMV0gPSBjb21iaW5lZFdhcnJpb3JzW2lkMl07CiAgICAgICAgY29tYmluZWRXYXJyaW9yc1tpZDJdID0gdGVtcDsKICAgICAgICB0ZW1wID0gcmVzdWx0c1tpZDFdOwogICAgICAgIHJlc3VsdHNbaWQxXSA9IHJlc3VsdHNbaWQyXTsKICAgICAgICByZXN1bHRzW2lkMl0gPSB1aW50MzIodGVtcCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG91cm5hbWVudEJhdHRsZVJlc3VsdChpbnQyNTYgZGFtYWdlMSwgaW50MjU2IHBlbmV0cmF0aW9uMSwgdWludDI1NiBjb21iaW5lZFdhcnJpb3IxLCAKICAgICAgICB1aW50MjU2IGNvbWJpbmVkV2FycmlvcjIsIHVpbnQyNTYgcmFuZG9tU291cmNlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgaW50MjU2IGRhbWFnZTI7CgkJaW50MjU2IHBlbmV0cmF0aW9uMjsKICAgICAgICAKCQkoZGFtYWdlMiwgcGVuZXRyYXRpb24yKSA9IF91bnBhY2tBdHRhY2tQYXJhbXMoY29tYmluZWRXYXJyaW9yMSk7CgoJCWludDI1NiB0b3RhbEhwMSA9IGdldENvbWJpbmVkVG90YWxIUChjb21iaW5lZFdhcnJpb3IxLCBwZW5ldHJhdGlvbjIpOwoJCWludDI1NiB0b3RhbEhwMiA9IGdldENvbWJpbmVkVG90YWxIUChjb21iaW5lZFdhcnJpb3IyLCBwZW5ldHJhdGlvbjEpOwogICAgICAgIAogICAgICAgIHJldHVybiBfZ2V0QmF0dGxlUmVzdWx0KGRhbWFnZTEgKiBnZXRCYXR0bGVSYW5kb20ocmFuZG9tU291cmNlLCAxKSAvIDEwMCwgZGFtYWdlMiAqIGdldEJhdHRsZVJhbmRvbShyYW5kb21Tb3VyY2UsIDEwKSAvIDEwMCwgdG90YWxIcDEsIHRvdGFsSHAyLCByYW5kb21Tb3VyY2UpOwogICAgfQogICAgLyogQ09NTU9OIEJBVFRMRSAqLwogICAgCiAgICBmdW5jdGlvbiBfZ2V0QmF0dGxlUmVzdWx0KGludDI1NiBkYW1hZ2UxLCBpbnQyNTYgZGFtYWdlMiwgaW50MjU2IHRvdGFsSHAxLCBpbnQyNTYgdG90YWxIcDIsIHVpbnQyNTYgcmFuZG9tU291cmNlKSAgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KXsKCQl0b3RhbEhwMSA9ICh0b3RhbEhwMSAqIChQUkVDSVNJT04gKiBQUkVDSVNJT04pIC8gZGFtYWdlMik7CgkJdG90YWxIcDIgPSAodG90YWxIcDIgKiAoUFJFQ0lTSU9OICogUFJFQ0lTSU9OKSAvIGRhbWFnZTEpOwoJCS8vaWYgZHJhdywgbGV0IHRoZSBjb2luIGRlY2lkZSB3aG8gd2lucwoJCWlmICh0b3RhbEhwMSA9PSB0b3RhbEhwMikgcmV0dXJuIHJhbmRvbVNvdXJjZSAlIDIgKyAxOwoJCXJldHVybiB0b3RhbEhwMSA+IHRvdGFsSHAyID8gMSA6IDI7ICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDb21iaW5lZFRvdGFsSFAodWludDI1NiBjb21iaW5lZERhdGEsIGludDI1NiBlbmVteVBlbmV0cmF0aW9uKSBpbnRlcm5hbCBwdXJlIHJldHVybnMoaW50MjU2KSB7CiAgICAgICAgaW50MjU2IGhwOwoJCWludDI1NiBhcm1vcjsKCQlpbnQyNTYgZG9kZ2U7CgkJKGhwLCBhcm1vciwgZG9kZ2UpID0gX3VucGFja1Byb3RlY3Rpb25QYXJhbXMoY29tYmluZWREYXRhKTsKICAgICAgICAKICAgICAgICByZXR1cm4gX2dldFRvdGFsSHAoaHAsIGFybW9yLCBkb2RnZSwgZW5lbXlQZW5ldHJhdGlvbik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldFRvdGFsSFAodWludDI1NiBwYWNrZWREYXRhLCB1aW50MjU2IHdhcnJpb3JBdXJhcywgdWludDI1NiBwZXRBdXJhcywgaW50MjU2IGVuZW15UGVuZXRyYXRpb24pIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQyNTYpIHsKICAgICAgICBpbnQyNTYgaHA7CgkJaW50MjU2IGFybW9yOwoJCWludDI1NiBkb2RnZTsKCQkoaHAsIGFybW9yLCBkb2RnZSkgPSBfZ2V0UHJvdGVjdGlvblBhcmFtcyhwYWNrZWREYXRhLCB3YXJyaW9yQXVyYXMsIHBldEF1cmFzKTsKICAgICAgICAKICAgICAgICByZXR1cm4gX2dldFRvdGFsSHAoaHAsIGFybW9yLCBkb2RnZSwgZW5lbXlQZW5ldHJhdGlvbik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9nZXRUb3RhbEhwKGludDI1NiBocCwgaW50MjU2IGFybW9yLCBpbnQyNTYgZG9kZ2UsIGludDI1NiBlbmVteVBlbmV0cmF0aW9uKSBpbnRlcm5hbCBwdXJlIHJldHVybnMoaW50MjU2KSB7CiAgICAgICAgaW50MjU2IHBpZXJjaW5nUmVzdWx0ID0gKGFybW9yIC0gZW5lbXlQZW5ldHJhdGlvbikgPCAtKDc1ICogUFJFQ0lTSU9OKSA/IC0oNzUgKiBQUkVDSVNJT04pIDogKGFybW9yIC0gZW5lbXlQZW5ldHJhdGlvbik7CiAgICAgICAgaW50MjU2IG1pdGlnYXRpb24gPSAoUFJFQ0lTSU9OIC0gcGllcmNpbmdSZXN1bHQgKiBQUkVDSVNJT04gLyAoUFJFQ0lTSU9OICsgcGllcmNpbmdSZXN1bHQgLyAxMDApIC8gMTAwKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKGhwICogUFJFQ0lTSU9OIC8gbWl0aWdhdGlvbiArIChocCAqIGRvZGdlIC8gKDEwMCAqIFBSRUNJU0lPTikpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2FwcGx5TGV2ZWxCb251cyhpbnQyNTYgX3ZhbHVlLCB1aW50MjU2IF9sZXZlbCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKGludDI1NikgewogICAgICAgIF9sZXZlbCAtPSAxOwogICAgICAgIHJldHVybiBpbnQyNTYodWludDI1NihfdmFsdWUpICogKExFVkVMX0JPTlVTRVMgJSAoMTAwICoqIChfbGV2ZWwgKyAxKSkgLyAoMTAwICoqIF9sZXZlbCkpIC8gMTApOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfZ2V0UHJvdGVjdGlvblBhcmFtcyh1aW50MjU2IHBhY2tlZERhdGEsIHVpbnQyNTYgd2FycmlvckF1cmFzLCB1aW50MjU2IHBldEF1cmFzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMoaW50MjU2IGhwLCBpbnQyNTYgYXJtb3IsIGludDI1NiBkb2RnZSkgewogICAgICAgIHVpbnQyNTYgcmFyaXR5Qm9udXMgPSBfdW5wYWNrUmFyaXR5Qm9udXNWYWx1ZShwYWNrZWREYXRhKTsKICAgICAgICB1aW50MjU2IHBldERhdGEgPSBfdW5wYWNrUGV0RGF0YShfdW5wYWNrUGV0VmFsdWUocGFja2VkRGF0YSkpOwogICAgICAgIGludDI1NiBzdHJlbmd0aCA9IF91bnBhY2tTdHJlbmd0aFZhbHVlKHBhY2tlZERhdGEpICogUFJFQ0lTSU9OICsgX2dldEJhdHRsZUJvbnVzKEJPTlVTX1NUUiwgcmFyaXR5Qm9udXMsIHBldERhdGEsIHdhcnJpb3JBdXJhcywgcGV0QXVyYXMpOwogICAgICAgIGludDI1NiBhZ2lsaXR5ID0gX3VucGFja0FnaWxpdHlWYWx1ZShwYWNrZWREYXRhKSAqIFBSRUNJU0lPTiArIF9nZXRCYXR0bGVCb251cyhCT05VU19BR0ksIHJhcml0eUJvbnVzLCBwZXREYXRhLCB3YXJyaW9yQXVyYXMsIHBldEF1cmFzKTsKICAgICAgICAKICAgICAgICBocCA9IDEwMCAqIFBSRUNJU0lPTiArIHN0cmVuZ3RoICsgNyAqIHN0cmVuZ3RoIC8gMTAgKyBfZ2V0QmF0dGxlQm9udXMoQk9OVVNfSFAsIHJhcml0eUJvbnVzLCBwZXREYXRhLCB3YXJyaW9yQXVyYXMsIHBldEF1cmFzKTsvL2FkZCBib251cyBocAogICAgICAgIGhwID0gX2FwcGx5TGV2ZWxCb251cyhocCwgX3VucGFja0xldmVsVmFsdWUocGFja2VkRGF0YSkpOwoJCWFybW9yID0gKHN0cmVuZ3RoICsgOCAqIHN0cmVuZ3RoIC8gMTAgKyBhZ2lsaXR5ICsgX2dldEJhdHRsZUJvbnVzKEJPTlVTX0FSTU9SLCByYXJpdHlCb251cywgcGV0RGF0YSwgd2FycmlvckF1cmFzLCBwZXRBdXJhcykpOy8vYWRkIGJvbnVzIGFybW9yCgkJZG9kZ2UgPSAoMiAqIGFnaWxpdHkgLyAzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0RGFtYWdlKHVpbnQyNTYgcGFja2VkV2FycmlvciwgdWludDI1NiB3YXJyaW9yQXVyYXMsIHVpbnQyNTYgcGV0QXVyYXMpIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHJhcml0eUJvbnVzID0gX3VucGFja1Jhcml0eUJvbnVzVmFsdWUocGFja2VkV2Fycmlvcik7CiAgICAgICAgdWludDI1NiBwZXREYXRhID0gX3VucGFja1BldERhdGEoX3VucGFja1BldFZhbHVlKHBhY2tlZFdhcnJpb3IpKTsKICAgICAgICBpbnQyNTYgYWdpbGl0eSA9IF91bnBhY2tBZ2lsaXR5VmFsdWUocGFja2VkV2FycmlvcikgKiBQUkVDSVNJT04gKyBfZ2V0QmF0dGxlQm9udXMoQk9OVVNfQUdJLCByYXJpdHlCb251cywgcGV0RGF0YSwgd2FycmlvckF1cmFzLCBwZXRBdXJhcyk7CiAgICAgICAgaW50MjU2IGludGVsbGlnZW5jZSA9IF91bnBhY2tJbnRlbGxpZ2VuY2VWYWx1ZShwYWNrZWRXYXJyaW9yKSAqIFBSRUNJU0lPTiArIF9nZXRCYXR0bGVCb251cyhCT05VU19JTlQsIHJhcml0eUJvbnVzLCBwZXREYXRhLCB3YXJyaW9yQXVyYXMsIHBldEF1cmFzKTsKCQkKCQlpbnQyNTYgY3JpdCA9IChhZ2lsaXR5IC8gNSArIGludGVsbGlnZW5jZSAvIDQpICsgX2dldEJhdHRsZUJvbnVzKEJPTlVTX0NSSVRfQ0hBTkNFLCByYXJpdHlCb251cywgcGV0RGF0YSwgd2FycmlvckF1cmFzLCBwZXRBdXJhcyk7CgkJaW50MjU2IGNyaXRNdWx0aXBsaWVyID0gKFBSRUNJU0lPTiArIGludGVsbGlnZW5jZSAvIDI1KSArIF9nZXRCYXR0bGVCb251cyhCT05VU19DUklUX01VTFQsIHJhcml0eUJvbnVzLCBwZXREYXRhLCB3YXJyaW9yQXVyYXMsIHBldEF1cmFzKTsKICAgICAgICAKICAgICAgICBpbnQyNTYgZGFtYWdlID0gaW50MjU2KF91bnBhY2tCYXNlRGFtYWdlVmFsdWUocGFja2VkV2FycmlvcikgKiAzICogUFJFQ0lTSU9OIC8gMikgKyBfZ2V0QmF0dGxlQm9udXMoQk9OVVNfREFNQUdFLCByYXJpdHlCb251cywgcGV0RGF0YSwgd2FycmlvckF1cmFzLCBwZXRBdXJhcyk7CiAgICAgICAgCgkJcmV0dXJuIChfYXBwbHlMZXZlbEJvbnVzKGRhbWFnZSwgX3VucGFja0xldmVsVmFsdWUocGFja2VkV2FycmlvcikpICogKFBSRUNJU0lPTiArIGNyaXQgKiBjcml0TXVsdGlwbGllciAvICgxMDAgKiBQUkVDSVNJT04pKSkgLyBQUkVDSVNJT047CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UGVuZXRyYXRpb24odWludDI1NiBwYWNrZWRXYXJyaW9yLCB1aW50MjU2IHdhcnJpb3JBdXJhcywgdWludDI1NiBwZXRBdXJhcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zKGludDI1NikgewogICAgICAgIHVpbnQyNTYgcmFyaXR5Qm9udXMgPSBfdW5wYWNrUmFyaXR5Qm9udXNWYWx1ZShwYWNrZWRXYXJyaW9yKTsKICAgICAgICB1aW50MjU2IHBldERhdGEgPSBfdW5wYWNrUGV0RGF0YShfdW5wYWNrUGV0VmFsdWUocGFja2VkV2FycmlvcikpOwogICAgICAgIGludDI1NiBhZ2lsaXR5ID0gX3VucGFja0FnaWxpdHlWYWx1ZShwYWNrZWRXYXJyaW9yKSAqIFBSRUNJU0lPTiArIF9nZXRCYXR0bGVCb251cyhCT05VU19BR0ksIHJhcml0eUJvbnVzLCBwZXREYXRhLCB3YXJyaW9yQXVyYXMsIHBldEF1cmFzKTsKICAgICAgICBpbnQyNTYgaW50ZWxsaWdlbmNlID0gX3VucGFja0ludGVsbGlnZW5jZVZhbHVlKHBhY2tlZFdhcnJpb3IpICogUFJFQ0lTSU9OICsgX2dldEJhdHRsZUJvbnVzKEJPTlVTX0lOVCwgcmFyaXR5Qm9udXMsIHBldERhdGEsIHdhcnJpb3JBdXJhcywgcGV0QXVyYXMpOwoJCQoJCXJldHVybiAoaW50ZWxsaWdlbmNlICogMiArIGFnaWxpdHkgKyBfZ2V0QmF0dGxlQm9udXMoQk9OVVNfUEVORVRSQVRJT04sIHJhcml0eUJvbnVzLCBwZXREYXRhLCB3YXJyaW9yQXVyYXMsIHBldEF1cmFzKSk7CiAgICB9CiAgICAKICAgIC8qIEJBVFRMRSBQVlAgKi8KICAgIAogICAgLy9AcGFyYW0gcmFuZG9tU291cmNlIG11c3QgYmUgPj0gMTAwMAogICAgZnVuY3Rpb24gZ2V0QmF0dGxlUmFuZG9tKHVpbnQyNTYgcmFuZG1Tb3VyY2UsIHVpbnQyNTYgX3N0ZXApIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQyNTYpewogICAgICAgIHJldHVybiBpbnQyNTYoMTAwICsgX3JhbmRvbSgwLCAxMSwgcmFuZG1Tb3VyY2UsIDEwMCAqIF9zdGVwLCBfc3RlcCkpOwogICAgfQogICAgCiAgICB1aW50MjU2IGludGVybmFsIGNvbnN0YW50IE5PX0FVUkEgPSAwOwogICAgCiAgICBmdW5jdGlvbiBnZXRQVlBCYXR0bGVSZXN1bHQodWludDI1NiBwYWNrZWREYXRhMSwgdWludDI1NiBwYWNrZWREYXRhMiwgdWludDI1NiByYW5kbVNvdXJjZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICB1aW50MjU2IHBldEF1cmExID0gX2NvbXB1dGVQVlBQZXRBdXJhKHBhY2tlZERhdGExKTsKICAgICAgICB1aW50MjU2IHBldEF1cmEyID0gX2NvbXB1dGVQVlBQZXRBdXJhKHBhY2tlZERhdGEyKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IHdhcnJpb3JBdXJhMSA9IF9jb21wdXRlUFZQV2FycmlvckF1cmEocGFja2VkRGF0YTEsIHBldEF1cmExKTsKICAgICAgICB1aW50MjU2IHdhcnJpb3JBdXJhMiA9IF9jb21wdXRlUFZQV2FycmlvckF1cmEocGFja2VkRGF0YTIsIHBldEF1cmEyKTsKICAgICAgICAKCQlpbnQyNTYgZGFtYWdlMSA9IGdldERhbWFnZShwYWNrZWREYXRhMSwgd2FycmlvckF1cmExLCBwZXRBdXJhMSkgKiBnZXRCYXR0bGVSYW5kb20ocmFuZG1Tb3VyY2UsIDEpIC8gMTAwOwogICAgICAgIGludDI1NiBkYW1hZ2UyID0gZ2V0RGFtYWdlKHBhY2tlZERhdGEyLCB3YXJyaW9yQXVyYTIsIHBldEF1cmEyKSAqIGdldEJhdHRsZVJhbmRvbShyYW5kbVNvdXJjZSwgMTApIC8gMTAwOwoKCQlpbnQyNTYgdG90YWxIcDE7CgkJaW50MjU2IHRvdGFsSHAyOwoJCSh0b3RhbEhwMSwgdG90YWxIcDIpID0gX2NvbXB1dGVDb250ZW5kZXJzVG90YWxIcChwYWNrZWREYXRhMSwgd2FycmlvckF1cmExLCBwZXRBdXJhMSwgcGFja2VkRGF0YTIsIHdhcnJpb3JBdXJhMSwgcGV0QXVyYTEpOwogICAgICAgIAogICAgICAgIHJldHVybiBfZ2V0QmF0dGxlUmVzdWx0KGRhbWFnZTEsIGRhbWFnZTIsIHRvdGFsSHAxLCB0b3RhbEhwMiwgcmFuZG1Tb3VyY2UpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfY29tcHV0ZVBWUFBldEF1cmEodWludDI1NiBwYWNrZWREYXRhKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiBlbmFibGVBdXJhKE5PX0FVUkEsIF9nZXRQZXRBdXJhKF91bnBhY2tQZXREYXRhKF91bnBhY2tQZXRWYWx1ZShwYWNrZWREYXRhKSkpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2NvbXB1dGVQVlBXYXJyaW9yQXVyYSh1aW50MjU2IHBhY2tlZERhdGEsIHVpbnQyNTYgcGV0QXVyYXMpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGZpbHRlcldhcnJpb3JBdXJhcyhlbmFibGVBdXJhKE5PX0FVUkEsIF91bnBhY2tBdXJhVmFsdWUocGFja2VkRGF0YSkpLCBwZXRBdXJhcyk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9jb21wdXRlQ29udGVuZGVyc1RvdGFsSHAodWludDI1NiBwYWNrZWREYXRhMSwgdWludDI1NiB3YXJyaW9yQXVyYTEsIHVpbnQyNTYgcGV0QXVyYTEsIHVpbnQyNTYgcGFja2VkRGF0YTIsIHVpbnQyNTYgd2FycmlvckF1cmEyLCB1aW50MjU2IHBldEF1cmEyKSAKICAgIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQyNTYgdG90YWxIcDEsIGludDI1NiB0b3RhbEhwMikgewoJCWludDI1NiBlbmVteVBlbmV0cmF0aW9uID0gZ2V0UGVuZXRyYXRpb24ocGFja2VkRGF0YTIsIHdhcnJpb3JBdXJhMiwgcGV0QXVyYTIpOwoJCXRvdGFsSHAxID0gZ2V0VG90YWxIUChwYWNrZWREYXRhMSwgd2FycmlvckF1cmExLCBwZXRBdXJhMSwgZW5lbXlQZW5ldHJhdGlvbik7CgkJZW5lbXlQZW5ldHJhdGlvbiA9IGdldFBlbmV0cmF0aW9uKHBhY2tlZERhdGExLCB3YXJyaW9yQXVyYTEsIHBldEF1cmExKTsKCQl0b3RhbEhwMiA9IGdldFRvdGFsSFAocGFja2VkRGF0YTIsIHdhcnJpb3JBdXJhMSwgcGV0QXVyYTEsIGVuZW15UGVuZXRyYXRpb24pOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRSYXRpbmdSYW5nZSh1aW50MjU2IF9wdnBDeWNsZSwgdWludDI1NiBfcHZwSW50ZXJ2YWwsIHVpbnQyNTYgX2V4cGFuZEludGVydmFsKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIHJldHVybiA1MCArIChfcHZwQ3ljbGUgKiBfcHZwSW50ZXJ2YWwgLyBfZXhwYW5kSW50ZXJ2YWwgKiAyNSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzTWF0Y2hpbmcoaW50MjU2IGV2ZW5SYXRpbmcsIGludDI1NiBvZGRSYXRpbmcsIGludDI1NiByYXRpbmdHYXApIGludGVybmFsIHB1cmUgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGV2ZW5SYXRpbmcgPD0gKG9kZFJhdGluZyArIHJhdGluZ0dhcCkgJiYgZXZlblJhdGluZyA+PSAob2RkUmF0aW5nIC0gcmF0aW5nR2FwKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc29ydCh1aW50MjU2W10gbWVtb3J5IGRhdGEpIGludGVybmFsIHB1cmUgewogICAgICAgcXVpY2tTb3J0KGRhdGEsIGludCgwKSwgaW50KGRhdGEubGVuZ3RoIC0gMSkpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBxdWlja1NvcnQodWludDI1NltdIG1lbW9yeSBhcnIsIGludDI1NiBsZWZ0LCBpbnQyNTYgcmlnaHQpIGludGVybmFsIHB1cmUgewogICAgICAgIGludDI1NiBpID0gbGVmdDsKICAgICAgICBpbnQyNTYgaiA9IHJpZ2h0OwogICAgICAgIGlmKGk9PWopIHJldHVybjsKICAgICAgICB1aW50MjU2IHBpdm90ID0gYXJyW3VpbnQyNTYobGVmdCArIChyaWdodCAtIGxlZnQpIC8gMildOwogICAgICAgIHdoaWxlIChpIDw9IGopIHsKICAgICAgICAgICAgd2hpbGUgKGFyclt1aW50MjU2KGkpXSA8IHBpdm90KSBpKys7CiAgICAgICAgICAgIHdoaWxlIChwaXZvdCA8IGFyclt1aW50MjU2KGopXSkgai0tOwogICAgICAgICAgICBpZiAoaSA8PSBqKSB7CiAgICAgICAgICAgICAgICAoYXJyW3VpbnQyNTYoaSldLCBhcnJbdWludDI1NihqKV0pID0gKGFyclt1aW50MjU2KGopXSwgYXJyW3VpbnQyNTYoaSldKTsKICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIGotLTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAobGVmdCA8IGopCiAgICAgICAgICAgIHF1aWNrU29ydChhcnIsIGxlZnQsIGopOwogICAgICAgIGlmIChpIDwgcmlnaHQpCiAgICAgICAgICAgIHF1aWNrU29ydChhcnIsIGksIHJpZ2h0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX3N3YXBQYWlyKHVpbnQyNTZbXSBtZW1vcnkgbWF0Y2hpbmdJZHMsIHVpbnQyNTYgaWQxLCB1aW50MjU2IGlkMiwgdWludDI1NiBpZDMsIHVpbnQyNTYgaWQ0KSBpbnRlcm5hbCBwdXJlIHsKICAgICAgICB1aW50MjU2IHRlbXAgPSBtYXRjaGluZ0lkc1tpZDFdOwogICAgICAgIG1hdGNoaW5nSWRzW2lkMV0gPSBtYXRjaGluZ0lkc1tpZDJdOwogICAgICAgIG1hdGNoaW5nSWRzW2lkMl0gPSB0ZW1wOwogICAgICAgIAogICAgICAgIHRlbXAgPSBtYXRjaGluZ0lkc1tpZDNdOwogICAgICAgIG1hdGNoaW5nSWRzW2lkM10gPSBtYXRjaGluZ0lkc1tpZDRdOwogICAgICAgIG1hdGNoaW5nSWRzW2lkNF0gPSB0ZW1wOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfc3dhcFZhbHVlcyh1aW50MjU2W10gbWVtb3J5IG1hdGNoaW5nSWRzLCB1aW50MjU2IGlkMSwgdWludDI1NiBpZDIpIGludGVybmFsIHB1cmUgewogICAgICAgIHVpbnQyNTYgdGVtcCA9IG1hdGNoaW5nSWRzW2lkMV07CiAgICAgICAgbWF0Y2hpbmdJZHNbaWQxXSA9IG1hdGNoaW5nSWRzW2lkMl07CiAgICAgICAgbWF0Y2hpbmdJZHNbaWQyXSA9IHRlbXA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9nZXRNYXRjaGluZ0lkcyh1aW50MjU2W10gbWVtb3J5IG1hdGNoaW5nSWRzLCB1aW50MjU2IF9wdnBJbnRlcnZhbCwgdWludDI1NiBfc2tpcEN5Y2xlcywgdWludDI1NiBfZXhwYW5kSW50ZXJ2YWwpIAogICAgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQyNTYgbWF0Y2hpbmdDb3VudCkgCiAgICB7CiAgICAgICAgbWF0Y2hpbmdDb3VudCA9IG1hdGNoaW5nSWRzLmxlbmd0aDsKICAgICAgICBpZiAobWF0Y2hpbmdDb3VudCA9PSAwKSByZXR1cm4gMDsKICAgICAgICAKICAgICAgICB1aW50MjU2IHdhcnJpb3JJZDsKICAgICAgICB1aW50MjU2IGluZGV4OwogICAgICAgIC8vc29ydCBtYXRjaGluZyBpZHMKICAgICAgICBxdWlja1NvcnQobWF0Y2hpbmdJZHMsIGludDI1NigwKSwgaW50MjU2KG1hdGNoaW5nQ291bnQgLSAxKSk7CiAgICAgICAgLy9maW5kIHBhaXJzCiAgICAgICAgaW50MjU2IHJhdGluZzE7CiAgICAgICAgdWludDI1NiBwYWlySW5kZXggPSAwOwogICAgICAgIGludDI1NiByYXRpbmdSYW5nZTsKICAgICAgICBmb3IoaW5kZXggPSAwOyBpbmRleCA8IG1hdGNoaW5nQ291bnQ7IGluZGV4KyspIHsKICAgICAgICAgICAgLy9nZXQgcGFja2VkIHZhbHVlCiAgICAgICAgICAgIHdhcnJpb3JJZCA9IG1hdGNoaW5nSWRzW2luZGV4XTsKICAgICAgICAgICAgLy91bnBhY2sgcmF0aW5nIDEKICAgICAgICAgICAgcmF0aW5nMSA9IGludDI1NihfdW5wYWNrUmF0aW5nVmFsdWUod2FycmlvcklkKSk7CiAgICAgICAgICAgIHJhdGluZ1JhbmdlID0gaW50MjU2KGdldFJhdGluZ1JhbmdlKF91bnBhY2tDeWNsZVZhbHVlKHdhcnJpb3JJZCkgKyBfc2tpcEN5Y2xlcywgX3B2cEludGVydmFsLCBfZXhwYW5kSW50ZXJ2YWwpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChpbmRleCA+IHBhaXJJbmRleCAmJiAvL2NoZWNrIGxlZnQgbmVpZ2hib3IKICAgICAgICAgICAgaXNNYXRjaGluZyhyYXRpbmcxLCBpbnQyNTYoX3VucGFja1JhdGluZ1ZhbHVlKG1hdGNoaW5nSWRzW2luZGV4IC0gMV0pKSwgcmF0aW5nUmFuZ2UpKSB7CiAgICAgICAgICAgICAgICAvL21vdmUgbWF0Y2hlZCBwYWlycyB0byB0aGUgbGVmdAogICAgICAgICAgICAgICAgLy9zd2FwIHBhaXJzCiAgICAgICAgICAgICAgICBfc3dhcFBhaXIobWF0Y2hpbmdJZHMsIHBhaXJJbmRleCwgaW5kZXggLSAxLCBwYWlySW5kZXggKyAxLCBpbmRleCk7CiAgICAgICAgICAgICAgICAvL21hcmsgbGFzdCBwYWlyIHBvc2l0aW9uCiAgICAgICAgICAgICAgICBwYWlySW5kZXggKz0gMjsKICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRleCArIDEgPCBtYXRjaGluZ0NvdW50ICYmIC8vY2hlY2sgcmlnaHQgbmVpZ2hib3IKICAgICAgICAgICAgaXNNYXRjaGluZyhyYXRpbmcxLCBpbnQyNTYoX3VucGFja1JhdGluZ1ZhbHVlKG1hdGNoaW5nSWRzW2luZGV4ICsgMV0pKSwgcmF0aW5nUmFuZ2UpKSB7CiAgICAgICAgICAgICAgICAvL21vdmUgbWF0Y2hlZCBwYWlycyB0byB0aGUgbGVmdAogICAgICAgICAgICAgICAgLy9zd2FwIHBhaXJzCiAgICAgICAgICAgICAgICBfc3dhcFBhaXIobWF0Y2hpbmdJZHMsIHBhaXJJbmRleCwgaW5kZXgsIHBhaXJJbmRleCArIDEsIGluZGV4ICsgMSk7CiAgICAgICAgICAgICAgICAvL21hcmsgbGFzdCBwYWlyIHBvc2l0aW9uCiAgICAgICAgICAgICAgICBwYWlySW5kZXggKz0gMjsKICAgICAgICAgICAgICAgIC8vc2tpcCBuZXh0IGl0ZXJhdGlvbgogICAgICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBtYXRjaGluZ0NvdW50ID0gcGFpckluZGV4OwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRQVlBCYXR0bGVSZXN1bHRzKHVpbnQyNTZbXSBtZW1vcnkgbWF0Y2hpbmdJZHMsIHVpbnQyNTYgbWF0Y2hpbmdDb3VudCwgdWludDI1NiBfdGFyZ2V0QmxvY2spIGludGVybmFsIHZpZXcgewogICAgICAgIHVpbnQyNTYgZXhwID0gMDsKICAgICAgICB1aW50MjU2IGhhc2ggPSAwOwogICAgICAgIHVpbnQyNTYgcmVzdWx0ID0gMDsKICAgICAgICBmb3IgKHVpbnQyNTYgZXZlbiA9IDA7IGV2ZW4gPCBtYXRjaGluZ0NvdW50OyBldmVuICs9IDIpIHsKICAgICAgICAgICAgaWYgKGV4cCA9PSAwIHx8IGV4cCA+IDczKSB7CiAgICAgICAgICAgICAgICBoYXNoID0gdWludDI1NihrZWNjYWsyNTYoYmxvY2suYmxvY2toYXNoKF9nZXRUYXJnZXRCbG9jayhfdGFyZ2V0QmxvY2spKSwgaGFzaCkpOwogICAgICAgICAgICAgICAgZXhwID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIC8vY29tcHV0ZSBiYXR0bGUgcmVzdWx0IDEgPSBldmVuKGxlZnQpIGlkIHdvbiwgMiAtIG9kZChyaWdodCkgaWQgd29uCiAgICAgICAgICAgIHJlc3VsdCA9IGdldFBWUEJhdHRsZVJlc3VsdChtYXRjaGluZ0lkc1tldmVuXSwgbWF0Y2hpbmdJZHNbZXZlbiArIDFdLCBoYXNoICUgKDEwMDAgKiAxMCoqZXhwKSAvIDEwKipleHApOwogICAgICAgICAgICByZXF1aXJlKHJlc3VsdCA+IDAgJiYgcmVzdWx0IDwgMyk7CiAgICAgICAgICAgIGV4cCsrOwogICAgICAgICAgICAvL2lmIG9kZCB3YXJyaW9yIHdvbiwgc3dhcCBoaXMgaWQgd2l0aCBldmVuIHdhcnJpb3IsCiAgICAgICAgICAgIC8vb3RoZXJ3aXNlIGRvIG5vdGhpbmcsCiAgICAgICAgICAgIC8vZXZlbiBpZHMgYXJlIHdpbm5pbmcgaWRzISBvZGRzIHN1Y2shCiAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gMikgewogICAgICAgICAgICAgICAgX3N3YXBWYWx1ZXMobWF0Y2hpbmdJZHMsIGV2ZW4sIGV2ZW4gKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dldExldmVsKHVpbnQyNTYgX2xldmVsUG9pbnRzKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiBfbGV2ZWxQb2ludHMgLyBQT0lOVFNfVE9fTEVWRUw7CiAgICB9CiAgICAKfQoKY29udHJhY3QgV2FycmlvckdlbmVyYXRvciBpcyBPd25hYmxlLCBHZW5lcmF0b3JJbnRlcmZhY2UgewogICAgCiAgICBhZGRyZXNzIGNvcmVDb250cmFjdDsKICAgIAogICAgLyogTElNSVRTICovCiAgICB1aW50MzJbMTldIHB1YmxpYyBwYXJhbWV0ZXJzOy8qICA9IFsKICAgICAgICB1aW50MzIoMTApLC8vMF9ib2R5Q29sb3JNYXgzCiAgICAgICAgdWludDMyKDEwKSwvLzFfZXllc2hNYXg0CiAgICAgICAgdWludDMyKDEwKSwvLzJfbW91dGhNYXg1CiAgICAgICAgdWludDMyKDIwKSwvLzNfaGVpck1heDYKICAgICAgICB1aW50MzIoMTApLC8vNF9oZWlyQ29sb3JNYXg3CiAgICAgICAgdWludDMyKDMpLC8vNV9hcm1vck1heDgKICAgICAgICB1aW50MzIoMyksLy82X3dlYXBvbk1heDkKICAgICAgICB1aW50MzIoMyksLy83X2hhdE1heDEwCiAgICAgICAgdWludDMyKDQpLC8vOF9ydW5lc01heDExCiAgICAgICAgdWludDMyKDEpLC8vOV93aW5nc01heDEyCiAgICAgICAgdWludDMyKDEwKSwvLzEwX3BldE1heDEzCiAgICAgICAgdWludDMyKDYpLC8vMTFfYm9yZGVyTWF4MTQKICAgICAgICB1aW50MzIoNiksLy8xMl9iYWNrZ3JvdW5kTWF4MTUKICAgICAgICB1aW50MzIoMTApLC8vMTNfdW5pcXVlCiAgICAgICAgdWludDMyKDkwMCksLy8xNF9sZWdlbmRhcnkKICAgICAgICB1aW50MzIoOTAwMCksLy8xNV9teXRoaWMKICAgICAgICB1aW50MzIoOTAwMDApLC8vMTZfcmFyZQogICAgICAgIHVpbnQzMig5MDAwMDApLC8vMTdfdW5jb21tb24KICAgICAgICB1aW50MzIoMCkvLzE4X3VuaXF1ZVRvdGFsCiAgICBdOyovCiAgICAKICAgIGZ1bmN0aW9uIFdhcnJpb3JHZW5lcmF0b3IoYWRkcmVzcyBfY29yZUNvbnRyYWN0LCB1aW50MzJbXSBfc2V0dGluZ3MpIHB1YmxpYyB7CiAgICAgICAgdWludDI1NiBsZW5ndGggPSBfc2V0dGluZ3MubGVuZ3RoOwogICAgICAgIHJlcXVpcmUobGVuZ3RoID09IDE4KTsKICAgICAgICByZXF1aXJlKF9zZXR0aW5nc1s4XSA9PSA0KTsvL2NoZWNrIHJ1bmVzIG1heAogICAgICAgIHJlcXVpcmUoX3NldHRpbmdzWzEwXSA9PSAxMCk7Ly9jaGVjayBwZXRzIG1heAogICAgICAgIHJlcXVpcmUoX3NldHRpbmdzWzExXSA9PSA1KTsvL2NoZWNrIGJvcmRlciBtYXgKICAgICAgICByZXF1aXJlKF9zZXR0aW5nc1sxMl0gPT0gNik7Ly9jaGVjayBiYWNrZ3JvdW5kIG1heAogICAgICAgIC8vc2V0dXAgcGFyYW1ldGVycwogICAgICAgIGZvcih1aW50MjU2IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgIHBhcmFtZXRlcnNbaV0gPSBfc2V0dGluZ3NbaV07CiAgICAgICAgfQkKICAgICAgICAKICAgICAgICBjb3JlQ29udHJhY3QgPSBfY29yZUNvbnRyYWN0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjaGFuZ2VQYXJhbWV0ZXIodWludDMyIF9wYXJhbUluZGV4LCB1aW50MzIgX3ZhbHVlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIENyeXB0b1V0aWxzLl9jaGFuZ2VQYXJhbWV0ZXIoX3BhcmFtSW5kZXgsIF92YWx1ZSwgcGFyYW1ldGVycyk7CiAgICB9CgogICAgLy8gLyBAZGV2IHNpbXBseSBhIGJvb2xlYW4gdG8gaW5kaWNhdGUgdGhpcyBpcyB0aGUgY29udHJhY3Qgd2UgZXhwZWN0IHRvIGJlCiAgICBmdW5jdGlvbiBpc0dlbmVyYXRvcigpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIC8gQGRldiBnZW5lcmF0ZSBuZXcgd2FycmlvciBpZGVudGl0eQogICAgLy8gLyBAcGFyYW0gX2hlcm9JZGVudGl0eSBHZW5lcyBvZiB3YXJyaW9yIHRoYXQgaW52b2tlZCByZXN1cnJlY3Rpb24sIGlmIDAgPT4gRGVtaWdvZCBnZW5lIHRoYXQgc2lnbmFscyB0byBnZW5lcmF0ZSB1bmlxdWUgd2FycmlvcgogICAgLy8gLyBAcGFyYW0gX2hlcm9MZXZlbCBMZXZlbCBvZiB0aGUgd2FycmlvcgogICAgLy8gLyBAX3RhcmdldEJsb2NrIGJsb2NrIG51bWJlciBmcm9tIHdoaWNoIGhhc2ggd2lsbCBiZSB0YWtlbgogICAgLy8gLyBAX3BlcmtJZCBzcGVjaWFsIHBlcmsgaWQsIGxpa2UgTUlORVIoMSkKICAgIC8vIC8gQHJldHVybiB0aGUgaWRlbnRpdHkgdGhhdCBhcmUgc3VwcG9zZWQgdG8gYmUgcGFzc2VkIGRvd24gdG8gbmV3bHkgYXJpc2VuIHdhcnJpb3IKICAgIGZ1bmN0aW9uIGdlbmVyYXRlV2Fycmlvcih1aW50MjU2IF9oZXJvSWRlbnRpdHksIHVpbnQyNTYgX2hlcm9MZXZlbCwgdWludDI1NiBfdGFyZ2V0QmxvY2ssIHVpbnQyNTYgX3BlcmtJZCkgCiAgICBwdWJsaWMgcmV0dXJucyAodWludDI1NikgCiAgICB7CiAgICAgICAgLy9vbmx5IGNvcmUgY29udHJhY3QgY2FuIGNhbGwgdGhpcyBtZXRob2QKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29yZUNvbnRyYWN0KTsKICAgICAgICAvL2dldCBtZW1vcnkgY29weSwgdG8gcmVkdWNlIHN0b3JhZ2UgcmVhZCByZXF1ZXN0cwogICAgICAgIHVpbnQzMlsxOV0gbWVtb3J5IG1lbW9yeVBhcmFtcyA9IHBhcmFtZXRlcnM7CiAgICAgICAgLy9nZW5lcmF0ZSB3YXJyaW9yIGlkZW50aXR5CiAgICAgICAgdWludDI1NiBpZGVudGl0eSA9IENyeXB0b1V0aWxzLmdlbmVyYXRlV2FycmlvcihfaGVyb0lkZW50aXR5LCBfaGVyb0xldmVsLCBfdGFyZ2V0QmxvY2ssIF9wZXJrSWQsIG1lbW9yeVBhcmFtcyk7CiAgICAgICAgCiAgICAgICAgLy92YWxpZGF0ZSBiZWZvcmUgcHVzaGluZyBjaGFuZ2VzIHRvIHN0b3JhZ2UKICAgICAgICBDcnlwdG9VdGlscy5fdmFsaWRhdGVJZGVudGl0eShpZGVudGl0eSwgbWVtb3J5UGFyYW1zKTsKICAgICAgICAvL3B1c2ggY2hhbmdlcyB0byBzdG9yYWdlCiAgICAgICAgQ3J5cHRvVXRpbHMuX3JlY29yZFdhcnJpb3JEYXRhKGlkZW50aXR5LCBwYXJhbWV0ZXJzKTsKICAgICAgICAKICAgICAgICByZXR1cm4gaWRlbnRpdHk7CiAgICB9Cn0KCmNvbnRyYWN0IEF1Y3Rpb25CYXNlIHsKCXVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBSSUNFX0NIQU5HRV9USU1FX1NURVAgPSAxNSBtaW51dGVzOwoJCiAgICBzdHJ1Y3QgQXVjdGlvbnsKICAgICAgICBhZGRyZXNzIHNlbGxlcjsKICAgICAgICB1aW50MTI4IHN0YXJ0aW5nUHJpY2U7CiAgICAgICAgdWludDEyOCBlbmRpbmdQcmljZTsKICAgICAgICB1aW50NjQgZHVyYXRpb247CiAgICAgICAgdWludDY0IHN0YXJ0ZWRBdDsKICAgIH0KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gQXVjdGlvbikgaW50ZXJuYWwgdG9rZW5JZFRvQXVjdGlvbjsKICAgIAogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQ7CiAgICAKICAgIEVSQzcyMSBwdWJsaWMgbm9uRnVuZ2libGVDb250cmFjdDsKCiAgICBldmVudCBBdWN0aW9uQ3JlYXRlZCh1aW50MjU2IHRva2VuSWQsIGFkZHJlc3Mgc2VsbGVyLCB1aW50MjU2IHN0YXJ0aW5nUHJpY2UpOwoKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiB0b3RhbFByaWNlLCBhZGRyZXNzIHdpbm5lciwgYWRkcmVzcyBzZWxsZXIpOwoKICAgIGV2ZW50IEF1Y3Rpb25DYW5jZWxsZWQodWludDI1NiB0b2tlbklkLCBhZGRyZXNzIHNlbGxlcik7CgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgcmV0dXJuIChub25GdW5naWJsZUNvbnRyYWN0Lm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWx7CiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2ZlckZyb20oX293bmVyLCB0aGlzLCBfdG9rZW5JZCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9yZWNlaXZlciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWx7CiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2ZlcihfcmVjZWl2ZXIsIF90b2tlbklkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2FkZEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCwgQXVjdGlvbiBfYXVjdGlvbikgaW50ZXJuYWx7CiAgICAgICAgcmVxdWlyZShfYXVjdGlvbi5kdXJhdGlvbiA+PSAxIG1pbnV0ZXMpOwogICAgICAgIAogICAgICAgIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdID0gX2F1Y3Rpb247CiAgICAgICAgCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQodWludDI1NihfdG9rZW5JZCksIF9hdWN0aW9uLnNlbGxlciwgX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSk7CiAgICB9CgogICAgLy8gQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gdW5jb25kaXRpb25hbGx5LgogICAgZnVuY3Rpb24gX2NhbmNlbEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfc2VsbGVyKSBpbnRlcm5hbHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgCiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICAKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkLCBfc2VsbGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgCiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICAKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBwcmljZSA9IF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHByaWNlKTsKICAgICAgICAKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIAogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKICAgICAgICAKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbmVlckN1dCA9IF9jb21wdXRlQ3V0KHByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gYXVjdGlvbmVlckN1dDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGxlci50cmFuc2ZlcihzZWxsZXJQcm9jZWVkcyk7CiAgICAgICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QuZ2V0QmVuZWZpY2lhcnkoKS50cmFuc2ZlcihhdWN0aW9uZWVyQ3V0KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDI1NiBiaWRFeGNlc3MgPSBfYmlkQW1vdW50IC0gcHJpY2U7CiAgICAgICAgCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwogICAgICAgIAogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF90b2tlbklkLCBwcmljZSwgbXNnLnNlbmRlciwgc2VsbGVyKTsKICAgICAgICAKICAgICAgICByZXR1cm4gcHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gX3JlbW92ZUF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWx7CiAgICAgICAgZGVsZXRlIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc09uQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgcmV0dXJuIChfYXVjdGlvbi5zdGFydGVkQXQgPiAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfY3VycmVudFByaWNlKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICB1aW50MjU2IHNlY29uZHNQYXNzZWQgPSAwOwogICAgICAgIAogICAgICAgIGlmIChub3cgPiBfYXVjdGlvbi5zdGFydGVkQXQpIHsKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIF9jb21wdXRlQ3VycmVudFByaWNlKF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3VycmVudFByaWNlKHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBfc2Vjb25kc1Bhc3NlZCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICAKICAgICAgICBpZiAoX3NlY29uZHNQYXNzZWQgPj0gX2R1cmF0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiBfZW5kaW5nUHJpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW50MjU2IHRvdGFsUHJpY2VDaGFuZ2UgPSBpbnQyNTYoX2VuZGluZ1ByaWNlKSAtIGludDI1Nihfc3RhcnRpbmdQcmljZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlQ2hhbmdlID0gdG90YWxQcmljZUNoYW5nZSAqIGludDI1Nihfc2Vjb25kc1Bhc3NlZCAvIFBSSUNFX0NIQU5HRV9USU1FX1NURVAgKiBQUklDRV9DSEFOR0VfVElNRV9TVEVQKSAvIGludDI1NihfZHVyYXRpb24pOwogICAgICAgICAgICAKICAgICAgICAgICAgaW50MjU2IGN1cnJlbnRQcmljZSA9IGludDI1Nihfc3RhcnRpbmdQcmljZSkgKyBjdXJyZW50UHJpY2VDaGFuZ2U7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdWludDI1NihjdXJyZW50UHJpY2UpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1dCh1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICAKICAgICAgICByZXR1cm4gX3ByaWNlICogb3duZXJDdXQgLyAxMDAwMDsKICAgIH0KfQoKCmNvbnRyYWN0IFNhbGVDbG9ja0F1Y3Rpb24gaXMgUGF1c2FibGUsIEF1Y3Rpb25CYXNlIHsKICAgIAogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPSBieXRlczQoMHg5ZjQwYjc3OSk7CiAgICAKICAgIGJvb2wgcHVibGljIGlzU2FsZUNsb2NrQXVjdGlvbiA9IHRydWU7CiAgICB1aW50MjU2IHB1YmxpYyBtaW5lclNhbGVDb3VudDsKICAgIHVpbnQyNTZbNV0gcHVibGljIGxhc3RNaW5lclNhbGVQcmljZXM7CgogICAgZnVuY3Rpb24gU2FsZUNsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyZXNzLCB1aW50MjU2IF9jdXQpIHB1YmxpY3sKICAgICAgICByZXF1aXJlKF9jdXQgPD0gMTAwMDApOwogICAgICAgIG93bmVyQ3V0ID0gX2N1dDsKICAgICAgICBFUkM3MjEgY2FuZGlkYXRlQ29udHJhY3QgPSBFUkM3MjEoX25mdEFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3Quc3VwcG9ydHNJbnRlcmZhY2UoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuZ2V0QmVuZWZpY2lhcnkoKSAhPSBhZGRyZXNzKDApKTsKICAgICAgICAKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0ID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsewogICAgICAgIAogICAgICAgIEF1Y3Rpb25CYXNlLkF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIAogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGxlcik7CiAgICAgICAgCiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIHNlbGxlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbldoZW5QYXVzZWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICB3aGVuUGF1c2VkCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZXh0ZXJuYWx7CiAgICAgICAgQXVjdGlvbkJhc2UuQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24uc2VsbGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICAKICAgICAgICBBdWN0aW9uQmFzZS5BdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIAogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAKICAgICAgICByZXR1cm4gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY3JlYXRlQXVjdGlvbih1aW50MjU2IF90b2tlbklkLAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgYWRkcmVzcyBfc2VsbGVyKQogICAgICAgIGV4dGVybmFsewogICAgICAgIHJlcXVpcmUoX3N0YXJ0aW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9zdGFydGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2VuZGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kaW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZHVyYXRpb24gPT0gdWludDI1Nih1aW50NjQoX2R1cmF0aW9uKSkpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICAKICAgICAgICBBdWN0aW9uQmFzZS5BdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbihfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykpOwogICAgICAgIAogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlewogICAgICAgIAogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0uc2VsbGVyOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgICAgIAogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICAgICAgCiAgICAgICAgaWYgKHNlbGxlciA9PSBub25GdW5naWJsZUNvbnRyYWN0LmdldEJlbmVmaWNpYXJ5KCkpIHsKICAgICAgICAgICAgbGFzdE1pbmVyU2FsZVByaWNlc1ttaW5lclNhbGVDb3VudCAlIDVdID0gcHJpY2U7CiAgICAgICAgICAgIG1pbmVyU2FsZUNvdW50Kys7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGF2ZXJhZ2VNaW5lclNhbGVQcmljZSgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgdWludDI1NiBzdW0gPSAwOwogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IDU7IGkrKyl7CiAgICAgICAgICAgIHN1bSArPSBsYXN0TWluZXJTYWxlUHJpY2VzW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VtIC8gNTsKICAgIH0KICAgIAogICAgLyoqZ2V0QXVjdGlvbnNCeUlkIHJldHVybnMgcGFja2VkIGFjdGlvbnMgZGF0YQogICAgICogQHBhcmFtIHRva2VuSWRzIGlkcyBvZiB0b2tlbnMsIHdob3NlIGF1Y3Rpb24ncyBtdXN0IGJlIGFjdGl2ZSAKICAgICAqIEByZXR1cm4gYXVjdGlvbkRhdGEgYXMgdWludDI1NiBhcnJheQogICAgICogQHJldHVybiBzdGVwU2l6ZSBudW1iZXIgb2YgZmllbGRzIGRlc2NyaWJpbmcgYXVjdGlvbiAKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbnNCeUlkKHVpbnQzMltdIHRva2VuSWRzKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdIG1lbW9yeSBhdWN0aW9uRGF0YSwgdWludDMyIHN0ZXBTaXplKSB7CiAgICAgICAgc3RlcFNpemUgPSA2OwogICAgICAgIGF1Y3Rpb25EYXRhID0gbmV3IHVpbnQyNTZbXSh0b2tlbklkcy5sZW5ndGggKiBzdGVwU2l6ZSk7CiAgICAgICAgCiAgICAgICAgdWludDMyIHRva2VuSWQ7CiAgICAgICAgZm9yKHVpbnQzMiBpID0gMDsgaSA8IHRva2VuSWRzLmxlbmd0aDsgaSArKykgewogICAgICAgICAgICB0b2tlbklkID0gdG9rZW5JZHNbaV07CiAgICAgICAgICAgIEF1Y3Rpb25CYXNlLkF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvblt0b2tlbklkXTsKICAgICAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgICAgICBfc2V0VG9rZW5EYXRhKGF1Y3Rpb25EYXRhLCBhdWN0aW9uLCB0b2tlbklkLCBpICogc3RlcFNpemUpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqZ2V0QXVjdGlvbnMgcmV0dXJucyBwYWNrZWQgYWN0aW9ucyBkYXRhCiAgICAgKiBAcGFyYW0gZnJvbUluZGV4IHdhcnJpb3IgaW5kZXggZnJvbSBnbG9iYWwgd2FycmlvciBzdG9yYWdlIChha2Egd2FycmlvcklkKQogICAgICogQHBhcmFtIGNvdW50IE51bWJlciBvZiBhdWN0aW9uJ3MgdG8gZmluZCwgaWYgY291bnQgPT0gMCwgdGhlbiBleGFjdCB3YXJyaW9ySWQoZnJvbUluZGV4KSB3aWxsIGJlIHNlYXJjaGVkCiAgICAgKiBAcmV0dXJuIGF1Y3Rpb25EYXRhIGFzIHVpbnQyNTYgYXJyYXkKICAgICAqIEByZXR1cm4gc3RlcFNpemUgbnVtYmVyIG9mIGZpZWxkcyBkZXNjcmliaW5nIGF1Y3Rpb24gCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEF1Y3Rpb25zKHVpbnQzMiBmcm9tSW5kZXgsIHVpbnQzMiBjb3VudCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBtZW1vcnkgYXVjdGlvbkRhdGEsIHVpbnQzMiBzdGVwU2l6ZSkgewogICAgICAgIHN0ZXBTaXplID0gNjsKICAgICAgICBpZiAoY291bnQgPT0gMCkgewogICAgICAgICAgICBBdWN0aW9uQmFzZS5BdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bZnJvbUluZGV4XTsKCSAgICAgICAgCXJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKCSAgICAgICAgCWF1Y3Rpb25EYXRhID0gbmV3IHVpbnQyNTZbXSgxICogc3RlcFNpemUpOwoJICAgICAgICAJX3NldFRva2VuRGF0YShhdWN0aW9uRGF0YSwgYXVjdGlvbiwgZnJvbUluZGV4LCBjb3VudCk7CgkgICAgICAgIAlyZXR1cm4gKGF1Y3Rpb25EYXRhLCBzdGVwU2l6ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NiB0b3RhbFdhcnJpb3JzID0gbm9uRnVuZ2libGVDb250cmFjdC50b3RhbFN1cHBseSgpOwoJICAgICAgICBpZiAodG90YWxXYXJyaW9ycyA9PSAwKSB7CgkgICAgICAgICAgICAvLyBSZXR1cm4gYW4gZW1wdHkgYXJyYXkKCSAgICAgICAgICAgIHJldHVybiAobmV3IHVpbnQyNTZbXSgwKSwgc3RlcFNpemUpOwoJICAgICAgICB9IGVsc2UgewoJCgkgICAgICAgICAgICB1aW50MzIgdG90YWxTaXplID0gMDsKCSAgICAgICAgICAgIHVpbnQzMiB0b2tlbklkOwoJICAgICAgICAgICAgdWludDMyIHNpemUgPSAwOwoJCQkJYXVjdGlvbkRhdGEgPSBuZXcgdWludDI1NltdKGNvdW50ICogc3RlcFNpemUpOwoJICAgICAgICAgICAgZm9yICh0b2tlbklkID0gMDsgdG9rZW5JZCA8IHRvdGFsV2FycmlvcnMgJiYgc2l6ZSA8IGNvdW50OyB0b2tlbklkKyspIHsKCSAgICAgICAgICAgICAgICBBdWN0aW9uQmFzZS5BdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbjEgPSB0b2tlbklkVG9BdWN0aW9uW3Rva2VuSWRdOwoJICAgICAgICAKCQkgICAgICAgIAkJaWYgKF9pc09uQXVjdGlvbihhdWN0aW9uMSkpIHsKCQkgICAgICAgIAkJICAgIHRvdGFsU2l6ZSArKzsKCQkgICAgICAgIAkJICAgIGlmICh0b3RhbFNpemUgPiBmcm9tSW5kZXgpIHsKCQkgICAgICAgIAkJICAgICAgICBfc2V0VG9rZW5EYXRhKGF1Y3Rpb25EYXRhLCBhdWN0aW9uMSwgdG9rZW5JZCwgc2l6ZSsrICogc3RlcFNpemUpOy8vd2FycmlvcklkOwoJCSAgICAgICAgCQkgICAgfQoJCSAgICAgICAgCQl9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAKCSAgICAgICAgICAgIGlmIChzaXplIDwgY291bnQpIHsKCSAgICAgICAgICAgICAgICBzaXplICo9IHN0ZXBTaXplOwoJICAgICAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVwYWNrID0gbmV3IHVpbnQyNTZbXShzaXplKTsKCSAgICAgICAgICAgICAgICBmb3IodG9rZW5JZCA9IDA7IHRva2VuSWQgPCBzaXplOyB0b2tlbklkKyspIHsKCSAgICAgICAgICAgICAgICAgICAgcmVwYWNrW3Rva2VuSWRdID0gYXVjdGlvbkRhdGFbdG9rZW5JZF07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHJldHVybiAocmVwYWNrLCBzdGVwU2l6ZSk7CgkgICAgICAgICAgICB9CgkKCSAgICAgICAgICAgIHJldHVybiAoYXVjdGlvbkRhdGEsIHN0ZXBTaXplKTsKCSAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gQGRldiBSZXR1cm5zIGF1Y3Rpb24gaW5mbyBmb3IgYW4gTkZUIG9uIGF1Y3Rpb24uCiAgICAvLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiBORlQgb24gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGdldEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKAogICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGVuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBzdGFydGVkQXQKICAgICAgICApewogICAgICAgIAogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIAogICAgICAgIHJldHVybiAoYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgICAgIGF1Y3Rpb24uc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgYXVjdGlvbi5lbmRpbmdQcmljZSwKICAgICAgICAgICAgYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydGVkQXQpOwogICAgfQogICAgCiAgICAvL3BhY2sgTkZUIGRhdGEgaW50byBzcGVjaWZpZWQgYXJyYXkKICAgIGZ1bmN0aW9uIF9zZXRUb2tlbkRhdGEodWludDI1NltdIG1lbW9yeSBhdWN0aW9uRGF0YSwgCiAgICAgICAgQXVjdGlvbkJhc2UuQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24sIHVpbnQzMiB0b2tlbklkLCB1aW50MzIgaW5kZXgKICAgICkgaW50ZXJuYWwgdmlldyB7CiAgICAgICAgYXVjdGlvbkRhdGFbaW5kZXhdID0gdWludDI1Nih0b2tlbklkKTsvLzAKICAgICAgICBhdWN0aW9uRGF0YVtpbmRleCArIDFdID0gdWludDI1NihhdWN0aW9uLnNlbGxlcik7Ly8xCiAgICAgICAgYXVjdGlvbkRhdGFbaW5kZXggKyAyXSA9IHVpbnQyNTYoYXVjdGlvbi5zdGFydGluZ1ByaWNlKTsvLzIKICAgICAgICBhdWN0aW9uRGF0YVtpbmRleCArIDNdID0gdWludDI1NihhdWN0aW9uLmVuZGluZ1ByaWNlKTsvLzMKICAgICAgICBhdWN0aW9uRGF0YVtpbmRleCArIDRdID0gdWludDI1NihhdWN0aW9uLmR1cmF0aW9uKTsvLzQKICAgICAgICBhdWN0aW9uRGF0YVtpbmRleCArIDVdID0gdWludDI1NihhdWN0aW9uLnN0YXJ0ZWRBdCk7Ly81CiAgICB9CiAgICAKfQ=='.
	

]
