Class {
	#name : #SRT2c4d1853a193573876ccfce414e3d9f1687ec917,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2c4d1853a193573876ccfce414e3d9f1687ec917 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLiAKICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9Cgp9CgoKY29udHJhY3QgQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZSB7CiAgICBmdW5jdGlvbiB3b3Jrc2hvcCgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHt9CiAgICBmdW5jdGlvbiBzdGFydERhdGUoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7fQogICAgZnVuY3Rpb24gZW5kZWRBdCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHt9CiAgICBmdW5jdGlvbiBpc0VuZGVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB0b3RhbFJhaXNlZEFtb3VudEluQ255KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBudW1PZlB1cmNoYXNlZFRva2Vuc09uQ3NCeShhZGRyZXNzIHB1cmNoYXNlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeShhZGRyZXNzIHB1cmNoYXNlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7Cn0KCmNvbnRyYWN0IEFic3RyYWN0U3RhcmJhc2VNYXJrZXRpbmdDYW1wYWlnbiB7CiAgICBmdW5jdGlvbiB3b3Jrc2hvcCgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHt9Cn0KCi8vLyBAdGl0bGUgVG9rZW4gY29udHJhY3QgLSBFUkMyMCBjb21wYXRpYmxlIFN0YXJiYXNlIHRva2VuIGNvbnRyYWN0LgovLy8gQGF1dGhvciBTdGFyYmFzZSBQVEUuIExURC4gLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9Ijg3ZWVlOWUxZThjN2Y0ZjNlNmY1ZTVlNmY0ZTJhOWU0ZTgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pgpjb250cmFjdCBTdGFyYmFzZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgUHVibGljT2ZmZXJpbmdQbGFuRGVjbGFyZWQodWludDI1NiB0b2tlbkNvdW50LCB1aW50MjU2IHVubG9ja0NvbXBhbnlzVG9rZW5zQXQpOwogICAgZXZlbnQgTXZwTGF1bmNoZWQodWludDI1NiBsYXVuY2hlZEF0KTsKICAgIGV2ZW50IExvZ05ld0Z1bmRyYWlzZXIgKGFkZHJlc3MgaW5kZXhlZCBmdW5kcmFpc2VyQWRkcmVzcywgYm9vbCBpc0JvbmFGaWRlKTsKICAgIGV2ZW50IExvZ1VwZGF0ZUZ1bmRyYWlzZXIoYWRkcmVzcyBpbmRleGVkIGZ1bmRyYWlzZXJBZGRyZXNzLCBib29sIGlzQm9uYUZpZGUpOwoKICAgIC8qCiAgICAgKiAgVHlwZXMKICAgICAqLwogICAgc3RydWN0IFB1YmxpY09mZmVyaW5nUGxhbiB7CiAgICAgICAgdWludDI1NiB0b2tlbkNvdW50OwogICAgICAgIHVpbnQyNTYgdW5sb2NrQ29tcGFueXNUb2tlbnNBdDsKICAgICAgICB1aW50MjU2IGRlY2xhcmVkQXQ7CiAgICB9CgogICAgLyoKICAgICAqICBFeHRlcm5hbCBjb250cmFjdHMKICAgICAqLwogICAgQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZSBwdWJsaWMgc3RhcmJhc2VDcm93ZHNhbGU7CiAgICBBYnN0cmFjdFN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24gcHVibGljIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ247CgogICAgLyoKICAgICAqICBTdG9yYWdlCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIGNvbXBhbnk7CiAgICBQdWJsaWNPZmZlcmluZ1BsYW5bXSBwdWJsaWMgcHVibGljT2ZmZXJpbmdQbGFuczsgIC8vIGZ1cnRoZXIgY3Jvd2RzYWxlcwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBpbml0aWFsRWNUb2tlbkFsbG9jYXRpb247ICAgIC8vIEluaXRpYWwgdG9rZW4gYWxsb2NhdGlvbnMgZm9yIEVhcmx5IENvbnRyaWJ1dG9ycwogICAgdWludDI1NiBwdWJsaWMgbXZwTGF1bmNoZWRBdDsgIC8vIDAgdW50aWwgYSBNVlAgb2YgU3RhcmJhc2UgUGxhdGZvcm0gbGF1bmNoZXMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwcml2YXRlIGZ1bmRyYWlzZXJzOyAvLyBGdW5kcmFpc2VycyBhcmUgdmV0dGVkIGFkZHJlc3NlcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGV4ZWN1dGUgZnVuY3Rpb25zIHdpdGhpbiB0aGUgY29udHJhY3QKCiAgICAvKgogICAgICogIENvbnN0YW50cyAvIFRva2VuIG1ldGEgZGF0YQogICAgICovCiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIG5hbWUgPSAiU3RhcmJhc2UiOyAgLy8gVG9rZW4gbmFtZQogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyBzeW1ib2wgPSAiU1RBUiI7ICAvLyBUb2tlbiBzeW1ib2wKICAgIHVpbnQ4IGNvbnN0YW50IHB1YmxpYyBkZWNpbWFscyA9IDE4OwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgaW5pdGlhbFN1cHBseSA9IDEwMDAwMDAwMDBlMTg7IC8vIDFCIFNUQVIgdG9rZW5zCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBpbml0aWFsQ29tcGFueXNUb2tlbkFsbG9jYXRpb24gPSA3NTAwMDAwMDBlMTg7ICAvLyA3NTBNCgoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlDcm93ZHNhbGVDb250cmFjdCgpIHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5TWFya2V0aW5nQ2FtcGFpZ25Db250cmFjdCgpIHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBhZGRyZXNzKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24pKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlGdW5kcmFpc2VyKCkgewogICAgICAgIC8vIE9ubHkgcmlnaHRmdWwgZnVuZHJhaXNlciBpcyBwZXJtaXR0ZWQuCiAgICAgICAgYXNzZXJ0KGlzRnVuZHJhaXNlcihtc2cuc2VuZGVyKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogIENvbnRyYWN0IGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0gc3RhcmJhc2VDb21wYW55QWRkciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZHMgdW50cmFuc2ZlcnJhYmxlIHRva2VucwogICAgICogQHBhcmFtIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkciBBZGRyZXNzIG9mIHRoZSBjcm93ZHNhbGUgY29udHJhY3QKICAgICAqIEBwYXJhbSBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduQWRkciBUaGUgYWRkcmVzcyBvZiB0aGUgbWFya2V0aW5nIGNhbXBhaWduIGNvbnRyYWN0CiAgICAgKi8KCiAgICBmdW5jdGlvbiBTdGFyYmFzZVRva2VuKAogICAgICAgIGFkZHJlc3Mgc3RhcmJhc2VDb21wYW55QWRkciwKICAgICAgICBhZGRyZXNzIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkciwKICAgICAgICBhZGRyZXNzIHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ25BZGRyCiAgICApIHsKICAgICAgICBhc3NlcnQoCiAgICAgICAgICAgIHN0YXJiYXNlQ29tcGFueUFkZHIgIT0gMCAmJgogICAgICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZUFkZHIgIT0gMCAmJgogICAgICAgICAgICBzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduQWRkciAhPSAwKTsKCiAgICAgICAgc3RhcmJhc2VDcm93ZHNhbGUgPSBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlKHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcik7CiAgICAgICAgc3RhcmJhc2VNYXJrZXRpbmdDYW1wYWlnbiA9IEFic3RyYWN0U3RhcmJhc2VNYXJrZXRpbmdDYW1wYWlnbihzdGFyYmFzZU1hcmtldGluZ0NhbXBhaWduQWRkcik7CiAgICAgICAgY29tcGFueSA9IHN0YXJiYXNlQ29tcGFueUFkZHI7CgogICAgICAgIC8vIG1zZy5zZW5kZXIgYmVjb21lcyBmaXJzdCBmdW5kcmFpc2VyCiAgICAgICAgZnVuZHJhaXNlcnNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIExvZ05ld0Z1bmRyYWlzZXIobXNnLnNlbmRlciwgdHJ1ZSk7CgogICAgICAgIC8vIFRva2VucyBmb3IgY3Jvd2RzYWxlIGFuZCBlYXJseSBwdXJjaGFzZXJzCiAgICAgICAgYmFsYW5jZXNbc3RhcmJhc2VDcm93ZHNhbGUud29ya3Nob3AoKV0gPSAxNzUwMDAwMDBlMTg7IC8vIENTKDEyNU0pK0VQKDUwTSkKCiAgICAgICAgLy8gVG9rZW5zIGZvciBtYXJrZXRpbmcgY2FtcGFpZ24gc3VwcG9ydGVycwogICAgICAgIGJhbGFuY2VzW3N0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24ud29ya3Nob3AoKV0gPSAxMjUwMDAwMGUxODsgLy8gMTIuNU0KCiAgICAgICAgLy8gVG9rZW5zIGZvciBlYXJseSBjb250cmlidXRvcnMsIHNob3VsZCBiZSBhbGxvY2F0ZWQgYnkgZnVuY3Rpb24KICAgICAgICBiYWxhbmNlc1swXSA9IDYyNTAwMDAwZTE4OyAvLyA2Mi41TQoKICAgICAgICAvLyBTdGFyYmFzZSBjb21wYW55IGhvbGRzIHVudHJhbnNmZXJyYWJsZSB0b2tlbnMgaW5pdGlhbGx5CiAgICAgICAgYmFsYW5jZXNbc3RhcmJhc2VDb21wYW55QWRkcl0gPSBpbml0aWFsQ29tcGFueXNUb2tlbkFsbG9jYXRpb247IC8vIDc1ME0KCiAgICAgICAgdG90YWxTdXBwbHkgPSBpbml0aWFsU3VwcGx5OyAgICAvLyAxQgogICAgfQoKICAgIC8qCiAgICAgKiAgRXh0ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgZGVjbGFyZWQgcHVibGljIG9mZmVyaW5nIHBsYW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIG51bU9mRGVjbGFyZWRQdWJsaWNPZmZlcmluZ1BsYW5zKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gcHVibGljT2ZmZXJpbmdQbGFucy5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IERlY2xhcmVzIGEgcHVibGljIG9mZmVyaW5nIHBsYW4gdG8gbWFrZSBjb21wYW55J3MgdG9rZW5zIHRyYW5zZmVyYWJsZQogICAgICogQHBhcmFtIHRva2VuQ291bnQgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSB1bmxvY2tDb21wYW55c1Rva2Vuc0F0IFRpbWUgb2YgdGhlIHRva2VucyB3aWxsIGJlIHVubG9ja2VkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlY2xhcmVQdWxpY09mZmVyaW5nUGxhbih1aW50MjU2IHRva2VuQ291bnQsIHVpbnQyNTYgdW5sb2NrQ29tcGFueXNUb2tlbnNBdCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyKCkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFzc2VydCh0b2tlbkNvdW50IDw9IDEwMDAwMDAwMGUxOCk7ICAgIC8vIHNoYWxsIG5vdCBleGNlZWQgMTAwTSB0b2tlbnMKICAgICAgICBhc3NlcnQoU2FmZU1hdGguc3ViKG5vdywgc3RhcmJhc2VDcm93ZHNhbGUuZW5kZWRBdCgpKSA+PSAxODAgZGF5cyk7ICAgLy8gc2hhbGwgbm90IGJlIGRlY2xhcmVkIGZvciA2IG1vbnRocyBhZnRlciB0aGUgY3Jvd2RzYWxlIGVuZGVkCiAgICAgICAgYXNzZXJ0KFNhZmVNYXRoLnN1Yih1bmxvY2tDb21wYW55c1Rva2Vuc0F0LCBub3cpID49IDYwIGRheXMpOyAgIC8vIHRva2VucyBtdXN0IGJlIHVudHJhbnNmZXJhYmxlIGF0IGxlYXN0IGZvciAyIG1vbnRocwoKICAgICAgICAvLyBjaGVjayBpZiBsYXN0IGRlY2xhcmF0aW9uIHdhcyBtb3JlIHRoYW4gNiBtb250aHMgYWdvCiAgICAgICAgaWYgKHB1YmxpY09mZmVyaW5nUGxhbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB1aW50MjU2IGxhc3REZWNsYXJlZEF0ID0KICAgICAgICAgICAgICAgIHB1YmxpY09mZmVyaW5nUGxhbnNbcHVibGljT2ZmZXJpbmdQbGFucy5sZW5ndGggLSAxXS5kZWNsYXJlZEF0OwogICAgICAgICAgICBhc3NlcnQoU2FmZU1hdGguc3ViKG5vdywgbGFzdERlY2xhcmVkQXQpID49IDE4MCBkYXlzKTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdG90YWxEZWNsYXJlZFRva2VuQ291bnQgPSB0b2tlbkNvdW50OwogICAgICAgIGZvciAodWludDggaTsgaSA8IHB1YmxpY09mZmVyaW5nUGxhbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG90YWxEZWNsYXJlZFRva2VuQ291bnQgKz0gcHVibGljT2ZmZXJpbmdQbGFuc1tpXS50b2tlbkNvdW50OwogICAgICAgIH0KICAgICAgICBhc3NlcnQodG90YWxEZWNsYXJlZFRva2VuQ291bnQgPD0gaW5pdGlhbENvbXBhbnlzVG9rZW5BbGxvY2F0aW9uKTsgICAvLyBzaGFsbCBub3QgZXhjZWVkIHRoZSBpbml0aWFsIHRva2VuIGFsbG9jYXRpb24KCiAgICAgICAgcHVibGljT2ZmZXJpbmdQbGFucy5wdXNoKAogICAgICAgICAgICBQdWJsaWNPZmZlcmluZ1BsYW4odG9rZW5Db3VudCwgdW5sb2NrQ29tcGFueXNUb2tlbnNBdCwgbm93KSk7CgogICAgICAgIFB1YmxpY09mZmVyaW5nUGxhbkRlY2xhcmVkKHRva2VuQ291bnQsIHVubG9ja0NvbXBhbnlzVG9rZW5zQXQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvY2F0ZSB0b2tlbnMgdG8gYSBtYXJrZXRpbmcgc3VwcG9ydGVyIGZyb20gdGhlIG1hcmtldGluZyBjYW1wYWlnbiBzaGFyZQogICAgICogQHBhcmFtIHRvIEFkZHJlc3MgdG8gd2hlcmUgdG9rZW5zIGFyZSBhbGxvY2F0ZWQKICAgICAqIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9NYXJrZXRpbmdTdXBwb3J0ZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlNYXJrZXRpbmdDYW1wYWlnbkNvbnRyYWN0CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYWxsb2NhdGVGcm9tKHN0YXJiYXNlTWFya2V0aW5nQ2FtcGFpZ24ud29ya3Nob3AoKSwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb2NhdGUgdG9rZW5zIHRvIGFuIGVhcmx5IGNvbnRyaWJ1dG9yIGZyb20gdGhlIGVhcmx5IGNvbnRyaWJ1dG9yIHNoYXJlCiAgICAgKiBAcGFyYW0gdG8gQWRkcmVzcyB0byB3aGVyZSB0b2tlbnMgYXJlIGFsbG9jYXRlZAogICAgICogQHBhcmFtIHZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb2NhdGVUb0Vhcmx5Q29udHJpYnV0b3IoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyKCkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGluaXRpYWxFY1Rva2VuQWxsb2NhdGlvblt0b10gPQogICAgICAgICAgICBTYWZlTWF0aC5hZGQoaW5pdGlhbEVjVG9rZW5BbGxvY2F0aW9uW3RvXSwgdmFsdWUpOwogICAgICAgIHJldHVybiBhbGxvY2F0ZUZyb20oMCwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSXNzdWUgbmV3IHRva2VucyBhY2NvcmRpbmcgdG8gdGhlIFNUQVIgdG9rZW4gaW5mbGF0aW9uIGxpbWl0cwogICAgICogQHBhcmFtIF9mb3IgQWRkcmVzcyB0byB3aGVyZSB0b2tlbnMgYXJlIGFsbG9jYXRlZAogICAgICogQHBhcmFtIHZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gaXNzdWUKICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWVUb2tlbnMoYWRkcmVzcyBfZm9yLCB1aW50MjU2IHZhbHVlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIoKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHZhbHVlIHVuZGVyIHRoZSBsaW1pdHMKICAgICAgICBhc3NlcnQodmFsdWUgPD0gbnVtT2ZJbmZsYXRhYmxlVG9rZW5zKCkpOwoKICAgICAgICB0b3RhbFN1cHBseSA9IFNhZmVNYXRoLmFkZCh0b3RhbFN1cHBseSwgdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW19mb3JdICs9IHZhbHVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWNsYXJlcyBTdGFyYmFzZSBNVlAgaGFzIGJlZW4gbGF1bmNoZWQKICAgICAqIEBwYXJhbSBsYXVuY2hlZEF0IFdoZW4gdGhlIE1WUCBsYXVuY2hlZCAodGltZXN0YW1wKQogICAgICovCiAgICBmdW5jdGlvbiBkZWNsYXJlTXZwTGF1bmNoZWQodWludDI1NiBsYXVuY2hlZEF0KSBleHRlcm5hbCBvbmx5RnVuZHJhaXNlcigpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKG12cExhdW5jaGVkQXQgPT0gMCk7IC8vIG92ZXJ3cml0aW5nIHRoZSBsYXVuY2ggZGF0ZSBpcyBub3QgcGVybWl0dGVkCiAgICAgICAgcmVxdWlyZShsYXVuY2hlZEF0IDw9IG5vdyk7CiAgICAgICAgcmVxdWlyZShzdGFyYmFzZUNyb3dkc2FsZS5pc0VuZGVkKCkpOwoKICAgICAgICBtdnBMYXVuY2hlZEF0ID0gbGF1bmNoZWRBdDsKICAgICAgICBNdnBMYXVuY2hlZChsYXVuY2hlZEF0KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb2NhdGUgdG9rZW5zIHRvIGEgY3Jvd2RzYWxlIG9yIGVhcmx5IHB1cmNoYXNlciBmcm9tIHRoZSBjcm93ZHNhbGUgc2hhcmUKICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgYWxsb2NhdGVkCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvY2F0ZVRvQ3Jvd2RzYWxlUHVyY2hhc2VyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5Q3Jvd2RzYWxlQ29udHJhY3QKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBhbGxvY2F0ZUZyb20oc3RhcmJhc2VDcm93ZHNhbGUud29ya3Nob3AoKSwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKgogICAgICogIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlcnMgc2VuZGVyJ3MgdG9rZW5zIHRvIGEgZ2l2ZW4gYWRkcmVzcy4gUmV0dXJucyBzdWNjZXNzLgogICAgICogQHBhcmFtIHRvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIuCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2Zlci4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhc3NlcnQoaXNUcmFuc2ZlcmFibGUobXNnLnNlbmRlciwgdmFsdWUpKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoaXJkIHBhcnR5IHRvIHRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIuIFJldHVybnMgc3VjY2Vzcy4KICAgICAqIEBwYXJhbSBmcm9tIEFkZHJlc3MgZnJvbSB3aGVyZSB0b2tlbnMgYXJlIHdpdGhkcmF3bi4KICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgc2VudC4KICAgICAqIEBwYXJhbSB2YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFzc2VydChpc1RyYW5zZmVyYWJsZShmcm9tLCB2YWx1ZSkpOwogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWRkcyBmdW5kcmFpc2VyLiBPbmx5IGNhbGxlZCBieSBhbm90aGVyIGZ1bmRyYWlzZXIuCiAgICAgKiBAcGFyYW0gZnVuZHJhaXNlckFkZHJlc3MgVGhlIGFkZHJlc3MgaW4gY2hlY2sKICAgICAqLwogICAgZnVuY3Rpb24gYWRkRnVuZHJhaXNlcihhZGRyZXNzIGZ1bmRyYWlzZXJBZGRyZXNzKSBwdWJsaWMgb25seUZ1bmRyYWlzZXIgewogICAgICAgIGFzc2VydCghaXNGdW5kcmFpc2VyKGZ1bmRyYWlzZXJBZGRyZXNzKSk7CgogICAgICAgIGZ1bmRyYWlzZXJzW2Z1bmRyYWlzZXJBZGRyZXNzXSA9IHRydWU7CiAgICAgICAgTG9nTmV3RnVuZHJhaXNlcihmdW5kcmFpc2VyQWRkcmVzcywgdHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZSBmdW5kcmFpc2VyIGFkZHJlc3MgcmlnaHRzLgogICAgICogQHBhcmFtIGZ1bmRyYWlzZXJBZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHVwZGF0ZQogICAgICogQHBhcmFtIGlzQm9uYUZpZGUgQm9vbGVhbiB0aGF0IGRlbm90ZXMgd2hldGhlciBmdW5kcmFpc2VyIGlzIGFjdGl2ZSBvciBub3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUZ1bmRyYWlzZXIoYWRkcmVzcyBmdW5kcmFpc2VyQWRkcmVzcywgYm9vbCBpc0JvbmFGaWRlKQogICAgICAgcHVibGljCiAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIGFzc2VydChpc0Z1bmRyYWlzZXIoZnVuZHJhaXNlckFkZHJlc3MpKTsKCiAgICAgICAgZnVuZHJhaXNlcnNbZnVuZHJhaXNlckFkZHJlc3NdID0gaXNCb25hRmlkZTsKICAgICAgICBMb2dVcGRhdGVGdW5kcmFpc2VyKGZ1bmRyYWlzZXJBZGRyZXNzLCBpc0JvbmFGaWRlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB3aGV0aGVyIGZ1bmRyYWlzZXIgYWRkcmVzcyBoYXMgcmlnaHRzLgogICAgICogQHBhcmFtIGZ1bmRyYWlzZXJBZGRyZXNzIFRoZSBhZGRyZXNzIGluIGNoZWNrCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzRnVuZHJhaXNlcihhZGRyZXNzIGZ1bmRyYWlzZXJBZGRyZXNzKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGZ1bmRyYWlzZXJzW2Z1bmRyYWlzZXJBZGRyZXNzXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB3aGV0aGVyIHRoZSB0cmFuc2ZlcnJpbmcgb2YgdG9rZW5zIGlzIGF2YWlsYWJsZSBmdW5kcmFpc2VyLgogICAgICogQHBhcmFtIGZyb20gQWRkcmVzcyBvZiB0b2tlbiBzZW5kZXIKICAgICAqIEBwYXJhbSB0b2tlbkNvdW50IE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzVHJhbnNmZXJhYmxlKGFkZHJlc3MgZnJvbSwgdWludDI1NiB0b2tlbkNvdW50KQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwIHx8IGJhbGFuY2VzW2Zyb21dIDwgdG9rZW5Db3VudCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBjb21wYW55J3MgdG9rZW5zIG1heSBiZSBsb2NrZWQgdXAKICAgICAgICBpZiAoZnJvbSA9PSBjb21wYW55KSB7CiAgICAgICAgICAgIGlmICh0b2tlbkNvdW50ID4gbnVtT2ZUcmFuc2ZlcmFibGVDb21wYW55c1Rva2VucygpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50ID0gMDsKCiAgICAgICAgLy8gZWFybHkgY29udHJpYnV0b3IncyB0b2tlbnMgbWF5IGJlIGxvY2tlZCB1cAogICAgICAgIGlmIChpbml0aWFsRWNUb2tlbkFsbG9jYXRpb25bZnJvbV0gPiAwKSB7CiAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCA9IFNhZmVNYXRoLmFkZCgKICAgICAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCwKICAgICAgICAgICAgICAgIG51bU9mVW50cmFuc2ZlcmFibGVFY1Rva2Vucyhmcm9tKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBFUCBhbmQgQ1MgcHVyY2hhc2VycycgdG9rZW5zIHNob3VsZCBiZSB1bnRyYW5zZmVyYWJsZSBpbml0aWFsbHkKICAgICAgICBpZiAoc3RhcmJhc2VDcm93ZHNhbGUuaXNFbmRlZCgpKSB7CiAgICAgICAgICAgIHVpbnQyNTYgcGFzc2VkRGF5cyA9CiAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIobm93LCBzdGFyYmFzZUNyb3dkc2FsZS5lbmRlZEF0KCkpIC8gODY0MDA7IC8vIDFkID0gODY0MDBzCiAgICAgICAgICAgIGlmIChwYXNzZWREYXlzIDwgNykgeyAgLy8gd2l0aGluIGEgd2VlawogICAgICAgICAgICAgICAgLy8gY3Jvd2RzYWxlIHB1cmNoYXNlcnMgY2Fubm90IHRyYW5zZmVyIHRoZWlyIHRva2VucyBmb3IgYSB3ZWVrCiAgICAgICAgICAgICAgICB1bnRyYW5zZmVyYWJsZVRva2VuQ291bnQgPSBTYWZlTWF0aC5hZGQoCiAgICAgICAgICAgICAgICAgICAgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50LAogICAgICAgICAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlLm51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5KGZyb20pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocGFzc2VkRGF5cyA8IDE0KSB7ICAvLyB3aXRoaW4gdHdvIHdlZWtzCiAgICAgICAgICAgICAgICAvLyBlYXJseSBwdXJjaGFzZXJzIGNhbm5vdCB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZm9yIHR3byB3ZWVrcwogICAgICAgICAgICAgICAgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50ID0gU2FmZU1hdGguYWRkKAogICAgICAgICAgICAgICAgICAgIHVudHJhbnNmZXJhYmxlVG9rZW5Db3VudCwKICAgICAgICAgICAgICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZS5udW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeShmcm9tKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJhYmxlVG9rZW5Db3VudCA9CiAgICAgICAgICAgIFNhZmVNYXRoLnN1YihiYWxhbmNlc1tmcm9tXSwgdW50cmFuc2ZlcmFibGVUb2tlbkNvdW50KTsKCiAgICAgICAgaWYgKHRyYW5zZmVyYWJsZVRva2VuQ291bnQgPCB0b2tlbkNvdW50KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG51bWJlciBvZiB0cmFuc2ZlcmFibGUgY29tcGFueSdzIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBudW1PZlRyYW5zZmVyYWJsZUNvbXBhbnlzVG9rZW5zKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHVubG9ja2VkVG9rZW5zID0gMDsKICAgICAgICBmb3IgKHVpbnQ4IGk7IGkgPCBwdWJsaWNPZmZlcmluZ1BsYW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFB1YmxpY09mZmVyaW5nUGxhbiBtZW1vcnkgcGxhbiA9IHB1YmxpY09mZmVyaW5nUGxhbnNbaV07CiAgICAgICAgICAgIGlmIChwbGFuLnVubG9ja0NvbXBhbnlzVG9rZW5zQXQgPD0gbm93KSB7CiAgICAgICAgICAgICAgICB1bmxvY2tlZFRva2VucyArPSBwbGFuLnRva2VuQ291bnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNhZmVNYXRoLnN1YigKICAgICAgICAgICAgYmFsYW5jZXNbY29tcGFueV0sCiAgICAgICAgICAgIGluaXRpYWxDb21wYW55c1Rva2VuQWxsb2NhdGlvbiAtIHVubG9ja2VkVG9rZW5zKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHVudHJhbnNmZXJhYmxlIHRva2VucyBvZiB0aGUgZWFybHkgY29udHJpYnV0b3IKICAgICAqIEBwYXJhbSBfZm9yIEFkZHJlc3Mgb2YgZWFybHkgY29udHJpYnV0b3IgdG8gY2hlY2sKICAgICAqLwogICAgZnVuY3Rpb24gbnVtT2ZVbnRyYW5zZmVyYWJsZUVjVG9rZW5zKGFkZHJlc3MgX2ZvcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGluaXRpYWxDb3VudCA9IGluaXRpYWxFY1Rva2VuQWxsb2NhdGlvbltfZm9yXTsKICAgICAgICBpZiAobXZwTGF1bmNoZWRBdCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBpbml0aWFsQ291bnQ7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IHBhc3NlZFdlZWtzID0gU2FmZU1hdGguc3ViKG5vdywgbXZwTGF1bmNoZWRBdCkgLyA3IGRheXM7CiAgICAgICAgaWYgKHBhc3NlZFdlZWtzIDw9IDUyKSB7ICAgIC8vIGEgeWVhciDiiYggNTIgd2Vla3MKICAgICAgICAgICAgLy8gYWxsIHRva2VucyBzaG91bGQgYmUgbG9ja2VkIHVwIGZvciBhIHllYXIKICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxDb3VudDsKICAgICAgICB9CgogICAgICAgIC8vIHVubG9jayAxLzUyIHRva2VucyBldmVyeSB3ZWVrcyBhZnRlciBhIHllYXIKICAgICAgICB1aW50MjU2IHRyYW5zZmVyYWJsZVRva2VuQ291bnQgPSBpbml0aWFsQ291bnQgLyA1MiAqIChwYXNzZWRXZWVrcyAtIDUyKTsKICAgICAgICBpZiAodHJhbnNmZXJhYmxlVG9rZW5Db3VudCA+PSBpbml0aWFsQ291bnQpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFNhZmVNYXRoLnN1Yihpbml0aWFsQ291bnQsIHRyYW5zZmVyYWJsZVRva2VuQ291bnQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgdG9rZW5zIHdoaWNoIGNhbiBiZSBpc3N1ZWQgYWNjb3JkaW5nIHRvIHRoZSBpbmZsYXRpb24gcnVsZXMKICAgICAqLwogICAgZnVuY3Rpb24gbnVtT2ZJbmZsYXRhYmxlVG9rZW5zKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoc3RhcmJhc2VDcm93ZHNhbGUuZW5kZWRBdCgpID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgcGFzc2VkRGF5cyA9IFNhZmVNYXRoLnN1Yihub3csIHN0YXJiYXNlQ3Jvd2RzYWxlLmVuZGVkQXQoKSkgLyA4NjQwMDsgIC8vIDFkID0gNjBzICogNjBtICogMjRoID0gODY0MDBzCiAgICAgICAgdWludDI1NiBwYXNzZWRZZWFycyA9IHBhc3NlZERheXMgKiAxMDAgLyAzNjUyNTsgICAgLy8gYWJvdXQgMzY1LjI1IGRheXMgaW4gYSB5ZWFyCiAgICAgICAgdWludDI1NiBpbmZsYXRlZFN1cHBseSA9IGluaXRpYWxTdXBwbHk7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBwYXNzZWRZZWFyczsgaSsrKSB7CiAgICAgICAgICAgIGluZmxhdGVkU3VwcGx5ICs9IFNhZmVNYXRoLm11bChpbmZsYXRlZFN1cHBseSwgMjUpIC8gMTAwMDsgLy8gMi41JS95ID0gMC4wMjUveQogICAgICAgIH0KCiAgICAgICAgdWludDI1NiByZW1haW5kZXJlZERheXMgPSBwYXNzZWREYXlzICogMTAwICUgMzY1MjUgLyAxMDA7CiAgICAgICAgaWYgKHJlbWFpbmRlcmVkRGF5cyA+IDApIHsKICAgICAgICAgICAgdWludDI1NiBpbmZsYXRhYmxlVG9rZW5zT2ZOZXh0WWVhciA9CiAgICAgICAgICAgICAgICBTYWZlTWF0aC5tdWwoaW5mbGF0ZWRTdXBwbHksIDI1KSAvIDEwMDA7CiAgICAgICAgICAgIGluZmxhdGVkU3VwcGx5ICs9IFNhZmVNYXRoLm11bCgKICAgICAgICAgICAgICAgIGluZmxhdGFibGVUb2tlbnNPZk5leHRZZWFyLCByZW1haW5kZXJlZERheXMgKiAxMDApIC8gMzY1MjU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gU2FmZU1hdGguc3ViKGluZmxhdGVkU3VwcGx5LCB0b3RhbFN1cHBseSk7CiAgICB9CgogICAgLyoKICAgICAqICBJbnRlcm5hbCBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBBbGxvY2F0ZSB0b2tlbnMgdmFsdWUgZnJvbSBhbiBhZGRyZXNzIHRvIGFub3RoZXIgb25lLiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgY2FsbGVkIGludGVybmFsbHkuCiAgICAgKiBAcGFyYW0gZnJvbSBBZGRyZXNzIGZyb20gd2hlcmUgdG9rZW5zIGNvbWUKICAgICAqIEBwYXJhbSB0byBBZGRyZXNzIHRvIHdoZXJlIHRva2VucyBhcmUgYWxsb2NhdGVkCiAgICAgKiBAcGFyYW0gdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICovCiAgICBmdW5jdGlvbiBhbGxvY2F0ZUZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYXNzZXJ0KHZhbHVlID4gMCAmJiBiYWxhbmNlc1tmcm9tXSA+PSB2YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbZnJvbV0gLT0gdmFsdWU7CiAgICAgICAgYmFsYW5jZXNbdG9dICs9IHZhbHVlOwogICAgICAgIFRyYW5zZmVyKGZyb20sIHRvLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0='.
	

]
