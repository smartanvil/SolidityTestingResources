Class {
	#name : #SRTe2a0cf522c405e9c313a947397ea19ce017ec94e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe2a0cf522c405e9c313a947397ea19ce017ec94e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogSm91bGUgc291cmNlIGNvZGVzIGFyZSBhdmFpbGFibGUgYXQgaHR0cHM6Ly9naXRodWIuY29tL015V2lzaFBsYXRmb3JtL2pvdWxlCiAqIEpvdWxlIFVJIGlzIGF2YWlsYWJsZSBhdCBodHRwczovL2pvdWxlLm15d2lzaC5pbwogKiBKb3VsZSB3YXMgbWFkZSBieSBNeVdpc2ggdGVhbSwgcGxlYXNlIHdlbGNvbWUgdG8gb3VyIHNpdGUgaHR0cHM6Ly9teXdpc2guaW8KICovCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgSm91bGVBUEkgewogICAgZXZlbnQgSW52b2tlZChhZGRyZXNzIGluZGV4ZWQgX2ludm9rZXIsIGFkZHJlc3MgaW5kZXhlZCBfYWRkcmVzcywgYm9vbCBfc3RhdHVzLCB1aW50IF91c2VkR2FzKTsKICAgIGV2ZW50IFJlZ2lzdGVyZWQoYWRkcmVzcyBpbmRleGVkIF9yZWdpc3RyYW50LCBhZGRyZXNzIGluZGV4ZWQgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKTsKICAgIGV2ZW50IFVucmVnaXN0ZXJlZChhZGRyZXNzIGluZGV4ZWQgX3JlZ2lzdHJhbnQsIGFkZHJlc3MgaW5kZXhlZCBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UsIHVpbnQgX2Ftb3VudCk7CgogICAgLyoqCiAgICAgKiBAZGV2IFJlZ2lzdGVycyB0aGUgc3BlY2lmaWVkIGNvbnRyYWN0IHRvIGludm9rZSBhdCB0aGUgc3BlY2lmaWVkIHRpbWUgd2l0aCB0aGUgc3BlY2lmaWVkIGdhcyBhbmQgcHJpY2UuCiAgICAgKiBAbm90aWNlIFJlZ2lzdHJhdGlvbiByZXF1aXJlcyB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiBFVEggaW4gdmFsdWUsIHRvIGNvdmVyIGludm9rZSBib251cy4gU2VlIGdldFByaWNlIG1ldGhvZC4KICAgICAqCiAgICAgKiBAcGFyYW0gX2FkZHJlc3MgICAgICBDb250cmFjdCdzIGFkZHJlc3MuIENvbnRyYWN0IE1VU1QgaW1wbGVtZW50cyBDaGVja2FibGUgaW50ZXJmYWNlLgogICAgICogQHBhcmFtIF90aW1lc3RhbXAgICAgVGltZXN0YW1wIGF0IHdoYXQgbW9tZW50IGNvbnRyYWN0IHNob3VsZCBiZSBjYWxsZWQuIEl0IE1VU1QgYmUgaW4gZnV0dXJlLgogICAgICogQHBhcmFtIF9nYXNMaW1pdCAgICAgR2FzIHdoaWNoIHdpbGwgYmUgcG9zdGVkIHRvIGNhbGwuCiAgICAgKiBAcGFyYW0gX2dhc1ByaWNlICAgICBHYXMgcHJpY2Ugd2hpY2ggaXMgcmVjb21tZW5kZWQgdG8gdXNlIGZvciB0aGlzIGludm9jYXRpb24uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBvZiBjaGFuZ2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKHVpbnQpOwoKICAgIC8qKgogICAgICogQGRldiBSZWdpc3RlcnMgdGhlIHNwZWNpZmllZCBjb250cmFjdCB0byBpbnZva2UgYXQgdGhlIHNwZWNpZmllZCB0aW1lIHdpdGggdGhlIHNwZWNpZmllZCBnYXMgYW5kIHByaWNlLgogICAgICogQG5vdGljZSBSZWdpc3RyYXRpb24gcmVxdWlyZXMgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgRVRIIGluIHZhbHVlLCB0byBjb3ZlciBpbnZva2UgYm9udXMuIFNlZSBnZXRQcmljZSBtZXRob2QuCiAgICAgKiBAbm90aWNlIElmIHZhbHVlIHdvdWxkIGJlIG1vcmUgdGhlbiByZXF1aXJlZCAoc2VlIGdldFByaWNlKSBjaGFuZ2Ugd2lsbCBiZSByZXR1cm5lZCB0byBtc2cuc2VuZGVyIChub3QgdG8gX3JlZ2lzdHJhbnQhKS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3JlZ2lzdHJhbnQgICBBbnkgYWRkcmVzcyB3aGljaCB3aWxsIGJlIG93bmVycyBmb3IgdGhpcyByZWdpc3RyYXRpb24uIE9ubHkgaGUgY2FuIHVucmVnaXN0ZXIuIFVzZWZ1bCBmb3IgY2FsbGluZyBmcm9tIGNvbnRyYWN0LgogICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgQ29udHJhY3QncyBhZGRyZXNzLiBDb250cmFjdCBNVVNUIGltcGxlbWVudHMgQ2hlY2thYmxlIGludGVyZmFjZS4KICAgICAqIEBwYXJhbSBfdGltZXN0YW1wICAgIFRpbWVzdGFtcCBhdCB3aGF0IG1vbWVudCBjb250cmFjdCBzaG91bGQgYmUgY2FsbGVkLiBJdCBNVVNUIGJlIGluIGZ1dHVyZS4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgICAgIEdhcyB3aGljaCB3aWxsIGJlIHBvc3RlZCB0byBjYWxsLgogICAgICogQHBhcmFtIF9nYXNQcmljZSAgICAgR2FzIHByaWNlIHdoaWNoIGlzIHJlY29tbWVuZGVkIHRvIHVzZSBmb3IgdGhpcyBpbnZvY2F0aW9uLgogICAgICogQHJldHVybiBBbW91bnQgb2YgY2hhbmdlLgogICAgICovCiAgICBmdW5jdGlvbiByZWdpc3RlckZvcihhZGRyZXNzIF9yZWdpc3RyYW50LCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZSByZWdpc3RyYXRpb24gb2YgdGhlIHNwZWNpZmllZCBjb250cmFjdCAod2l0aCBleGFjdCBwYXJhbWV0ZXJzKSBieSB0aGUgc3BlY2lmaWVkIGtleS4gU2VlIGZpbmRLZXkgbWV0aG9kIGZvciBsb29raW5nIGZvciBrZXkuCiAgICAgKiBAbm90aWNlIEl0IHJldHVybnMgbm90IGZ1bGwgYW1vdW50IG9mIEVUSC4KICAgICAqIEBub3RpY2UgT25seSByZWdpc3RyYW50IGNhbiByZW1vdmUgdGhlaXIgcmVnaXN0cmF0aW9uLgogICAgICogQG5vdGljZSBPbmx5IHJlZ2lzdHJhdGlvbnMgaW4gZnV0dXJlIGNhbiBiZSByZW1vdmVkLgogICAgICoKICAgICAqIEBwYXJhbSBfa2V5ICAgICAgICAgIENvbnRyYWN0IGtleSwgdG8gZmFzdCBmaW5kaW5nIGR1cmluZyB1bnJlZ2lzdGVyLiBTZWUgZmluZEtleSBtZXRob2QgZm9yIGdldHRpbmcga2V5LgogICAgICogQHBhcmFtIF9hZGRyZXNzICAgICAgQ29udHJhY3QncyBhZGRyZXNzLiBDb250cmFjdCBNVVNUIGltcGxlbWVudHMgQ2hlY2thYmxlIGludGVyZmFjZS4KICAgICAqIEBwYXJhbSBfdGltZXN0YW1wICAgIFRpbWVzdGFtcCBhdCB3aGF0IG1vbWVudCBjb250cmFjdCBzaG91bGQgYmUgY2FsbGVkLiBJdCBNVVNUIGJlIGluIGZ1dHVyZS4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgICAgIEdhcyB3aGljaCB3aWxsIGJlIHBvc3RlZCB0byBjYWxsLgogICAgICogQHBhcmFtIF9nYXNQcmljZSAgICAgR2FzIHByaWNlIHdoaWNoIGlzIHJlY29tbWVuZGVkIHRvIHVzZSBmb3IgdGhpcyBpbnZvY2F0aW9uLgogICAgICogQHJldHVybiBBbW91bnQgb2YgcmVmdW5kLgogICAgICovCiAgICBmdW5jdGlvbiB1bnJlZ2lzdGVyKGJ5dGVzMzIgX2tleSwgYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIC8qKgogICAgICogQGRldiBJbnZva2VzIG5leHQgY29udHJhY3RzIGluIHRoZSBxdWV1ZS4KICAgICAqIEBub3RpY2UgRXRoIGFtb3VudCB0byBjb3ZlciBnYXMgd2lsbCBiZSByZXR1cm5lZCBpZiBnYXMgcHJpY2UgaXMgZXF1YWwgb3IgbGVzcyB0aGVuIHNwZWNpZmllZCBmb3IgY29udHJhY3QuIENoZWNrIGdldFRvcCBmb3IgcmlnaHQgZ2FzIHByaWNlLgogICAgICogQHJldHVybiBSZXdhcmQgYW1vdW50LgogICAgICovCiAgICBmdW5jdGlvbiBpbnZva2UoKSBwdWJsaWMgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IEludm9rZXMgbmV4dCBjb250cmFjdHMgaW4gdGhlIHF1ZXVlLgogICAgICogQG5vdGljZSBFdGggYW1vdW50IHRvIGNvdmVyIGdhcyB3aWxsIGJlIHJldHVybmVkIGlmIGdhcyBwcmljZSBpcyBlcXVhbCBvciBsZXNzIHRoZW4gc3BlY2lmaWVkIGZvciBjb250cmFjdC4gQ2hlY2sgZ2V0VG9wIGZvciByaWdodCBnYXMgcHJpY2UuCiAgICAgKiBAcGFyYW0gX2ludm9rZXIgQW55IGFkZHJlc3MgZnJvbSB3aGljaCBldmVudCB3aWxsIGJlIHRocmV3LiBVc2VmdWwgZm9yIGNhbGxpbmcgZnJvbSBjb250cmFjdC4KICAgICAqIEByZXR1cm4gUmV3YXJkIGFtb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gaW52b2tlRm9yKGFkZHJlc3MgX2ludm9rZXIpIHB1YmxpYyByZXR1cm5zICh1aW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgSW52b2tlcyB0aGUgdG9wIGNvbnRyYWN0IGluIHRoZSBxdWV1ZS4KICAgICAqIEBub3RpY2UgRXRoIGFtb3VudCB0byBjb3ZlciBnYXMgd2lsbCBiZSByZXR1cm5lZCBpZiBnYXMgcHJpY2UgaXMgZXF1YWwgb3IgbGVzcyB0aGVuIHNwZWNpZmllZCBmb3IgY29udHJhY3QuIENoZWNrIGdldFRvcCBmb3IgcmlnaHQgZ2FzIHByaWNlLgogICAgICogQHJldHVybiBSZXdhcmQgYW1vdW50LgogICAgICovCiAgICBmdW5jdGlvbiBpbnZva2VPbmNlKCkgcHVibGljIHJldHVybnMgKHVpbnQpOwoKICAgIC8qKgogICAgICogQGRldiBJbnZva2VzIHRoZSB0b3AgY29udHJhY3QgaW4gdGhlIHF1ZXVlLgogICAgICogQG5vdGljZSBFdGggYW1vdW50IHRvIGNvdmVyIGdhcyB3aWxsIGJlIHJldHVybmVkIGlmIGdhcyBwcmljZSBpcyBlcXVhbCBvciBsZXNzIHRoZW4gc3BlY2lmaWVkIGZvciBjb250cmFjdC4gQ2hlY2sgZ2V0VG9wIGZvciByaWdodCBnYXMgcHJpY2UuCiAgICAgKiBAcGFyYW0gX2ludm9rZXIgQW55IGFkZHJlc3MgZnJvbSB3aGljaCBldmVudCB3aWxsIGJlIHRocmV3LiBVc2VmdWwgZm9yIGNhbGxpbmcgZnJvbSBjb250cmFjdC4KICAgICAqIEByZXR1cm4gUmV3YXJkIGFtb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gaW52b2tlT25jZUZvcihhZGRyZXNzIF9pbnZva2VyKSBwdWJsaWMgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IENhbGN1bGF0ZXMgcmVxdWlyZWQgdG8gcmVnaXN0ZXIgYW1vdW50IG9mIFdFSS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2dhc0xpbWl0IEdhcyB3aGljaCB3aWxsIGJlIHBvc3RlZCB0byBjYWxsLgogICAgICogQHBhcmFtIF9nYXNQcmljZSBHYXMgcHJpY2Ugd2hpY2ggaXMgcmVjb21tZW5kZWQgdG8gdXNlIGZvciB0aGlzIGludm9jYXRpb24uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBpbiB3ZWkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFByaWNlKHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyBob3cgbWFueSBjb250cmFjdHMgYXJlIHJlZ2lzdGVyZWQgKGFuZCBub3QgaW52b2tlZCkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldENvdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IEdldHMgdG9wIGNvbnRyYWN0ICh0aGUgbmV4dCB0byBpbnZva2UpLgogICAgICoKICAgICAqIEByZXR1cm4gY29udHJhY3RBZGRyZXNzICBUaGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEByZXR1cm4gdGltZXN0YW1wICAgICAgICBUaGUgaW52b2NhdGlvbiB0aW1lc3RhbXAuCiAgICAgKiBAcmV0dXJuIGdhc0xpbWl0ICAgICAgICAgVGhlIGNvbnRyYWN0IGdhcy4KICAgICAqIEByZXR1cm4gZ2FzUHJpY2UgICAgICAgICBUaGUgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZS4KICAgICAqIEByZXR1cm4gaW52b2tlR2FzICAgICAgICBUaGUgbWluaW1hbCBhbW91bnQgb2YgZ2FzIHRvIGludm9rZSAoaW5jbHVkaW5nIGdhcyBmb3Igam91bGUpLgogICAgICogQHJldHVybiByZXdhcmRBbW91bnQgICAgIFRoZSBhbW91bnQgb2YgcmV3YXJkIGZvciBpbnZvY2F0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRUb3BPbmNlKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICBhZGRyZXNzIGNvbnRyYWN0QWRkcmVzcywKICAgICAgICB1aW50IHRpbWVzdGFtcCwKICAgICAgICB1aW50IGdhc0xpbWl0LAogICAgICAgIHVpbnQgZ2FzUHJpY2UsCiAgICAgICAgdWludCBpbnZva2VHYXMsCiAgICAgICAgdWludCByZXdhcmRBbW91bnQKICAgICk7CgogICAgLyoqCiAgICAgKiBAZGV2IEdldHMgb25lIG5leHQgY29udHJhY3QgYnkgdGhlIHNwZWNpZmllZCBwcmV2aW91cyBpbiBvcmRlciB0byBpbnZva2UuCiAgICAgKgogICAgICogQHBhcmFtIF9jb250cmFjdEFkZHJlc3MgIFRoZSBwcmV2aW91cyBjb250cmFjdCBhZGRyZXNzLgogICAgICogQHBhcmFtIF90aW1lc3RhbXAgICAgICAgIFRoZSBwcmV2aW91cyBpbnZvY2F0aW9uIHRpbWVzdGFtcC4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgICAgICAgICBUaGUgcHJldmlvdXMgaW52b2NhdGlvbiBtYXhpbXVtIGdhcy4KICAgICAqIEBwYXJhbSBfZ2FzUHJpY2UgICAgICAgICBUaGUgcHJldmlvdXMgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZS4KICAgICAqIEByZXR1cm4gY29udHJhY3RBZGRyZXNzICBUaGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEByZXR1cm4gZ2FzTGltaXQgICAgICAgICBUaGUgY29udHJhY3QgZ2FzLgogICAgICogQHJldHVybiBnYXNQcmljZSAgICAgICAgIFRoZSBpbnZvY2F0aW9uIGV4cGVjdGVkIHByaWNlLgogICAgICogQHJldHVybiBpbnZva2VHYXMgICAgICAgIFRoZSBtaW5pbWFsIGFtb3VudCBvZiBnYXMgdG8gaW52b2tlIChpbmNsdWRpbmcgZ2FzIGZvciBqb3VsZSkuCiAgICAgKiBAcmV0dXJuIHJld2FyZEFtb3VudCAgICAgVGhlIGFtb3VudCBvZiByZXdhcmQgZm9yIGludm9jYXRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE5leHRPbmNlKGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgdWludCBfdGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNMaW1pdCwKICAgICAgICAgICAgICAgICAgICAgdWludCBfZ2FzUHJpY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3MgY29udHJhY3RBZGRyZXNzLAogICAgICAgIHVpbnQgdGltZXN0YW1wLAogICAgICAgIHVpbnQgZ2FzTGltaXQsCiAgICAgICAgdWludCBnYXNQcmljZSwKICAgICAgICB1aW50IGludm9rZUdhcywKICAgICAgICB1aW50IHJld2FyZEFtb3VudAogICAgKTsKCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyBfY291bnQgbmV4dCBjb250cmFjdHMgYnkgdGhlIHNwZWNpZmllZCBwcmV2aW91cyBpbiBvcmRlciB0byBpbnZva2UuCiAgICAgKiBAbm90aWNlIFVubGlrZSBnZXRUb3AgdGhpcyBtZXRob2QgcmV0dXJuIGV4YWN0IF9jb3VudCB2YWx1ZXMuCiAgICAgKgogICAgICogQHBhcmFtIF9jb3VudCAgICAgICAgICAgIFRoZSBjb3VudCBvZiByZXN1bHQgY29udHJhY3RzLgogICAgICogQHBhcmFtIF9jb250cmFjdEFkZHJlc3MgIFRoZSBwcmV2aW91cyBjb250cmFjdCBhZGRyZXNzLgogICAgICogQHBhcmFtIF90aW1lc3RhbXAgICAgICAgIFRoZSBwcmV2aW91cyBpbnZvY2F0aW9uIHRpbWVzdGFtcC4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgICAgICAgICBUaGUgcHJldmlvdXMgaW52b2NhdGlvbiBtYXhpbXVtIGdhcy4KICAgICAqIEBwYXJhbSBfZ2FzUHJpY2UgICAgICAgICBUaGUgcHJldmlvdXMgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZS4KICAgICAqIEByZXR1cm4gY29udHJhY3RBZGRyZXNzICBUaGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEByZXR1cm4gZ2FzTGltaXQgICAgICAgICBUaGUgY29udHJhY3QgZ2FzLgogICAgICogQHJldHVybiBnYXNQcmljZSAgICAgICAgIFRoZSBpbnZvY2F0aW9uIGV4cGVjdGVkIHByaWNlLgogICAgICogQHJldHVybiBpbnZva2VHYXMgICAgICAgIFRoZSBtaW5pbWFsIGFtb3VudCBvZiBnYXMgdG8gaW52b2tlIChpbmNsdWRpbmcgZ2FzIGZvciBqb3VsZSkuCiAgICAgKiBAcmV0dXJuIHJld2FyZEFtb3VudCAgICAgVGhlIGFtb3VudCBvZiByZXdhcmQgZm9yIGludm9jYXRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE5leHQodWludCBfY291bnQsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9jb250cmFjdEFkZHJlc3MsCiAgICAgICAgICAgICAgICB1aW50IF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgICB1aW50IF9nYXNMaW1pdCwKICAgICAgICAgICAgICAgIHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3NbXSBhZGRyZXNzZXMsCiAgICAgICAgdWludFtdIHRpbWVzdGFtcHMsCiAgICAgICAgdWludFtdIGdhc0xpbWl0cywKICAgICAgICB1aW50W10gZ2FzUHJpY2VzLAogICAgICAgIHVpbnRbXSBpbnZva2VHYXNlcywKICAgICAgICB1aW50W10gcmV3YXJkQW1vdW50cwogICAgKTsKCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyB0b3AgX2NvdW50IGNvbnRyYWN0cyAoaW4gb3JkZXIgdG8gaW52b2tlKS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2NvdW50ICAgICAgICAgICAgSG93IG1hbnkgcmVjb3JkcyB3aWxsIGJlIHJldHVybmVkLgogICAgICogQHJldHVybiBhZGRyZXNzZXMgICAgICAgIFRoZSBjb250cmFjdHMgYWRkcmVzc2VzLgogICAgICogQHJldHVybiB0aW1lc3RhbXBzICAgICAgIFRoZSBpbnZvY2F0aW9uIHRpbWVzdGFtcHMuCiAgICAgKiBAcmV0dXJuIGdhc0xpbWl0cyAgICAgICAgVGhlIGNvbnRyYWN0IGdhcy4KICAgICAqIEByZXR1cm4gZ2FzUHJpY2VzICAgICAgICBUaGUgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZS4KICAgICAqIEByZXR1cm4gaW52b2tlR2FzZXMgICAgICBUaGUgbWluaW1hbCBhbW91bnQgb2YgZ2FzIHRvIGludm9rZSAoaW5jbHVkaW5nIGdhcyBmb3Igam91bGUpLgogICAgICogQHJldHVybiByZXdhcmRBbW91bnRzICAgIFRoZSBhbW91bnQgb2YgcmV3YXJkIGZvciBpbnZvY2F0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRUb3AodWludCBfY291bnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzc1tdIGFkZHJlc3NlcywKICAgICAgICB1aW50W10gdGltZXN0YW1wcywKICAgICAgICB1aW50W10gZ2FzTGltaXRzLAogICAgICAgIHVpbnRbXSBnYXNQcmljZXMsCiAgICAgICAgdWludFtdIGludm9rZUdhc2VzLAogICAgICAgIHVpbnRbXSByZXdhcmRBbW91bnRzCiAgICApOwoKICAgIC8qKgogICAgICogQGRldiBGaW5kcyBrZXkgZm9yIHRoZSByZWdpc3RyYXRpb24gd2l0aCBleGFjdCBwYXJhbWV0ZXJzLiBCZSBjYXJlZnVsLCBrZXkgbWlnaHQgYmUgY2hhbmdlZCBiZWNhdXNlIG9mIG90aGVyIHJlZ2lzdHJhdGlvbnMuCiAgICAgKiBAcGFyYW0gX2FkZHJlc3MgICAgICBDb250cmFjdCdzIGFkZHJlc3MuIENvbnRyYWN0IE1VU1QgaW1wbGVtZW50cyBDaGVja2FibGUgaW50ZXJmYWNlLgogICAgICogQHBhcmFtIF90aW1lc3RhbXAgICAgVGltZXN0YW1wIGF0IHdoYXQgbW9tZW50IGNvbnRyYWN0IHNob3VsZCBiZSBjYWxsZWQuIEl0IE1VU1QgYmUgaW4gZnV0dXJlLgogICAgICogQHBhcmFtIF9nYXNMaW1pdCAgICAgR2FzIHdoaWNoIHdpbGwgYmUgcG9zdGVkIHRvIGNhbGwuCiAgICAgKiBAcGFyYW0gX2dhc1ByaWNlICAgICBHYXMgcHJpY2Ugd2hpY2ggaXMgcmVjb21tZW5kZWQgdG8gdXNlIGZvciB0aGlzIGludm9jYXRpb24uCiAgICAgKiBAcmV0dXJuIF9rZXkgICAgICAgICBLZXkgb2YgdGhlIHNwZWNpZmllZCByZWdpc3RyYXRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmRLZXkoYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIpOwoKICAgIC8qKgogICAgICogQGRldiBHZXRzIGFjdHVhbCBjb2RlIHZlcnNpb24uCiAgICAgKiBAcmV0dXJuIENvZGUgdmVyc2lvbi4gTWFzazogMHhmZi4weGZmLjB4ZmZmZi0weGZmZmZmZmZmIChtYWpvci5taW5vci5idWlsZC1oYXNoKQogICAgICovCiAgICBmdW5jdGlvbiBnZXRWZXJzaW9uKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczgpOwoKICAgIC8qKgogICAgICogQGRldiBHZXRzIG1pbmltYWwgZ2FzIHByaWNlLCBzcGVjaWZpZWQgYnkgbWFpbnRhaW5lci4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0TWluR2FzUHJpY2UoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KY29udHJhY3QgVHJhbnNmZXJUb2tlbiBpcyBPd25hYmxlIHsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oRVJDMjBCYXNpYyBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgX3Rva2VuLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KfQpjb250cmFjdCBKb3VsZVByb3h5QVBJIHsKICAgIC8qKgogICAgICogRnVuY3Rpb24gaGFzaCBpczogMHg3MzAyN2Y2ZAogICAgICovCiAgICBmdW5jdGlvbiBjYWxsYmFjayhhZGRyZXNzIF9pbnZva2VyLCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CmNvbnRyYWN0IENoZWNrYWJsZUNvbnRyYWN0IHsKICAgIGV2ZW50IENoZWNrZWQoKTsKICAgIC8qCiAgICAgKiBGdW5jdGlvbiBoYXNoIGlzIDB4OTE5ODQwYWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoZWNrKCkgcHVibGljOwp9Cgpjb250cmFjdCB1c2luZ0NvbnN0cyB7CiAgICB1aW50IGNvbnN0YW50IEdXRUkgPSAwLjAwMSBzemFibzsKCiAgICAvLyB0aGlzIHZhbHVlcyBpbmZsdWVuY2UgdG8gdGhlIHJld2FyZCBwcmljZSEgZG8gbm90IGNoYW5nZSBmb3IgYWxyZWFkeSByZWdpc3RlcmVkIGNvbnRyYWN0cyEKICAgIHVpbnQgY29uc3RhbnQgVFJBTlNBQ1RJT05fR0FTID0gMjIwMDA7CiAgICAvLyByZW1haW5pbmcgZ2FzIC0gYW1vdW50IG9mIGdhcyB0byBmaW5pc2ggdHJhbnNhY3Rpb24gYWZ0ZXIgaW52b2tlCiAgICB1aW50IGNvbnN0YW50IFJFTUFJTklOR19HQVMgPSAzMDAwMDsKICAgIC8vIGpvdWxlIGdhcyAtIGdhcyB0byBqb3VsZSAoaW5jbHVkaW5nIHByb3h5IGFuZCBvdGhlcnMpIGludm9jYXRpb24sIGV4Y2x1ZGluZyBjb250cmFjdCBnYXMKICAgIHVpbnQgY29uc3RhbnQgSk9VTEVfR0FTID0gVFJBTlNBQ1RJT05fR0FTICsgUkVNQUlOSU5HX0dBUyArIDgwMDA7CiAgICAvLyBnYXMgcmVxdWlyZWQgdG8gaW52b2tlLCBidXQgYWxsIGdhcyB3b3VsZCBiZSByZXR1cm5lZCBvciBub3QgdXNlZCwgc28gaXQgaXMgcmV3YXJkZWQKICAgIHVpbnQgY29uc3RhbnQgSk9VTEVfSU5WT0tFX0dBUyA9IDEwMDAwOwogICAgLy8gdGhlcmUgaXMgY29ycmVsYXRpb24gYmV0d2VlbiBhbW91bnQgb2YgcmVnaXN0ZXJlZCBnYXMgYW5kIHJlcXVpcmVkIGdhcyB0byBpbnZva2UgLSA1JQogICAgdWludCBjb25zdGFudCBKT1VMRV9JTlZPS0VfR0FTX1BFUkNFTlQgPSA1OwoKICAgIC8vIG1pbmltYWwgZGVmYXVsdCBnYXMgcHJpY2UgKGJlY2F1c2Ugb2YgbmV0d29yayBsb2FkKQogICAgdWludDMyIGNvbnN0YW50IERFRkFVTFRfTUlOX0dBU19QUklDRV9HV0VJID0gMjA7CiAgICAvLyBtaW4gZ2FzIHByaWNlCiAgICB1aW50IGNvbnN0YW50IE1JTl9HQVNfUFJJQ0UgPSBHV0VJOwogICAgLy8gbWF4IGdhcyBwcmljZQogICAgdWludCBjb25zdGFudCBNQVhfR0FTX1BSSUNFID0gMHhmZmZmZmZmZiAqIEdXRUk7CiAgICAvLyBub3QsIGl0IG1pc3QgYmUgbGVzcyB0aGVuIDB4MDBmZmZmZmYsIGJlY2F1c2UgaGlnaCBieXRlcyBtaWdodCBiZSB1c2VkIGZvciBzdG9yaW5nIGZsYWdzCiAgICB1aW50IGNvbnN0YW50IE1BWF9HQVMgPSA0MDAwMDAwOwogICAgLy8gQ29kZSB2ZXJzaW9uCiAgICBieXRlczggY29uc3RhbnQgVkVSU0lPTiA9IDB4MDEwODAwYjEwMjY2ZTc3MzsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICBeXiAtIG1ham9yCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBeXiAtIG1pbm9yCiAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl4gLSBidWlsZAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXl5eXl5eXl4gLSBnaXQgaGFzaAp9CgoKCmxpYnJhcnkgS2V5c1V0aWxzIHsKICAgIC8vIFN1Y2ggb3JkZXIgaXMgaW1wb3J0YW50IHRvIGxvYWQgZnJvbSBzdGF0ZQogICAgc3RydWN0IE9iamVjdCB7CiAgICAgICAgdWludDMyIGdhc1ByaWNlR3dlaTsKICAgICAgICB1aW50MzIgZ2FzTGltaXQ7CiAgICAgICAgdWludDMyIHRpbWVzdGFtcDsKICAgICAgICBhZGRyZXNzIGNvbnRyYWN0QWRkcmVzczsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0tleShPYmplY3QgX29iaikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgcmV0dXJuIHRvS2V5KF9vYmouY29udHJhY3RBZGRyZXNzLCBfb2JqLnRpbWVzdGFtcCwgX29iai5nYXNMaW1pdCwgX29iai5nYXNQcmljZUd3ZWkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvS2V5RnJvbVN0b3JhZ2UoT2JqZWN0IHN0b3JhZ2UgX29iaikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczMyIF9rZXkpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9rZXkgOj0gc2xvYWQoX29ial9zbG90KQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0b0tleShhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczMyIHJlc3VsdCkgewogICAgICAgIHJlc3VsdCA9IDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsKICAgICAgICAvLyAgICAgICAgIF5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl4gLSBhZGRyZXNzICgyMCBieXRlcykKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBeXl5eXl5eXiAtIHRpbWVzdGFtcCAoNCBieXRlcykKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl5eXl5eIC0gZ2FzIGxpbWl0ICg0IGJ5dGVzKQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBeXl5eXl5eXiAtIGdhcyBwcmljZSAoNCBieXRlcykKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihyZXN1bHQsIG11bChfYWRkcmVzcywgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICAgICAgcmVzdWx0IDo9IG9yKHJlc3VsdCwgbXVsKGFuZChfdGltZXN0YW1wLCAweGZmZmZmZmZmKSwgMHgxMDAwMDAwMDAwMDAwMDAwMCkpCiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihyZXN1bHQsIG11bChhbmQoX2dhc0xpbWl0LCAweGZmZmZmZmZmKSwgMHgxMDAwMDAwMDApKQogICAgICAgICAgICByZXN1bHQgOj0gb3IocmVzdWx0LCBhbmQoX2dhc1ByaWNlLCAweGZmZmZmZmZmKSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdG9NZW1vcnlPYmplY3QoYnl0ZXMzMiBfa2V5LCBPYmplY3QgbWVtb3J5IF9kZXN0KSBpbnRlcm5hbCBwdXJlIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgYW5kKF9rZXksIDB4ZmZmZmZmZmYpKQogICAgICAgICAgICBtc3RvcmUoYWRkKF9kZXN0LCAweDIwKSwgYW5kKGRpdihfa2V5LCAweDEwMDAwMDAwMCksIDB4ZmZmZmZmZmYpKQogICAgICAgICAgICBtc3RvcmUoYWRkKF9kZXN0LCAweDQwKSwgYW5kKGRpdihfa2V5LCAweDEwMDAwMDAwMDAwMDAwMDAwKSwgMHhmZmZmZmZmZikpCiAgICAgICAgICAgIG1zdG9yZShhZGQoX2Rlc3QsIDB4NjApLCBkaXYoX2tleSwgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdG9PYmplY3QoYnl0ZXMzMiBfa2V5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKE9iamVjdCBtZW1vcnkgX2Rlc3QpIHsKICAgICAgICB0b01lbW9yeU9iamVjdChfa2V5LCBfZGVzdCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9TdGF0ZU9iamVjdChieXRlczMyIF9rZXksIE9iamVjdCBzdG9yYWdlIF9kZXN0KSBpbnRlcm5hbCB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzc3RvcmUoX2Rlc3Rfc2xvdCwgX2tleSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZXN0YW1wKGJ5dGVzMzIgX2tleSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmVzdWx0IDo9IGFuZChkaXYoX2tleSwgMHgxMDAwMDAwMDAwMDAwMDAwMCksIDB4ZmZmZmZmZmYpCiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBSZXN0cmljdGlvbiB7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGludGVybmFsIGFjY2Vzc2VzOwoKICAgIGZ1bmN0aW9uIFJlc3RyaWN0aW9uKCkgcHVibGljIHsKICAgICAgICBhY2Nlc3Nlc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2l2ZUFjY2VzcyhhZGRyZXNzIF9hZGRyKSBwdWJsaWMgcmVzdHJpY3RlZCB7CiAgICAgICAgYWNjZXNzZXNbX2FkZHJdID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVBY2Nlc3MoYWRkcmVzcyBfYWRkcikgcHVibGljIHJlc3RyaWN0ZWQgewogICAgICAgIGRlbGV0ZSBhY2Nlc3Nlc1tfYWRkcl07CiAgICB9CgogICAgZnVuY3Rpb24gaGFzQWNjZXNzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYWNjZXNzZXNbbXNnLnNlbmRlcl07CiAgICB9CgogICAgbW9kaWZpZXIgcmVzdHJpY3RlZCgpIHsKICAgICAgICByZXF1aXJlKGhhc0FjY2VzcygpKTsKICAgICAgICBfOwogICAgfQp9Cgpjb250cmFjdCBKb3VsZVN0b3JhZ2UgaXMgUmVzdHJpY3Rpb24gewogICAgbWFwcGluZyhieXRlczMyID0+IGJ5dGVzMzIpIG1hcDsKCiAgICBmdW5jdGlvbiBnZXQoYnl0ZXMzMiBfa2V5KSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyIF92YWx1ZSkgewogICAgICAgIHJldHVybiBtYXBbX2tleV07CiAgICB9CgogICAgZnVuY3Rpb24gc2V0KGJ5dGVzMzIgX2tleSwgYnl0ZXMzMiBfdmFsdWUpIHB1YmxpYyByZXN0cmljdGVkIHsKICAgICAgICBtYXBbX2tleV0gPSBfdmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsKGJ5dGVzMzIgX2tleSkgcHVibGljIHJlc3RyaWN0ZWQgewogICAgICAgIGRlbGV0ZSBtYXBbX2tleV07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QW5kRGVsKGJ5dGVzMzIgX2tleSkgcHVibGljIHJlc3RyaWN0ZWQgcmV0dXJucyAoYnl0ZXMzMiBfdmFsdWUpIHsKICAgICAgICBfdmFsdWUgPSBtYXBbX2tleV07CiAgICAgICAgZGVsZXRlIG1hcFtfa2V5XTsKICAgIH0KCiAgICBmdW5jdGlvbiBzd2FwKGJ5dGVzMzIgX2Zyb20sIGJ5dGVzMzIgX3RvKSBwdWJsaWMgcmVzdHJpY3RlZCByZXR1cm5zIChieXRlczMyIF92YWx1ZSkgewogICAgICAgIF92YWx1ZSA9IG1hcFtfdG9dOwogICAgICAgIG1hcFtfdG9dID0gbWFwW19mcm9tXTsKICAgICAgICBkZWxldGUgbWFwW19mcm9tXTsKICAgIH0KfQoKY29udHJhY3QgSm91bGVJbmRleENvcmUgewogICAgdXNpbmcgS2V5c1V0aWxzIGZvciBieXRlczMyOwogICAgdWludCBjb25zdGFudCBZRUFSID0gMHgxREZFMjAwOwogICAgYnl0ZXMzMiBjb25zdGFudCBIRUFEID0gMHgwOwoKICAgIC8vIFlFQVIgLT4gd2VlayAtPiBob3VyIC0+IG1pbnV0ZQogICAgSm91bGVTdG9yYWdlIHB1YmxpYyBzdGF0ZTsKCiAgICBmdW5jdGlvbiBKb3VsZUluZGV4Q29yZShKb3VsZVN0b3JhZ2UgX3N0b3JhZ2UpIHB1YmxpYyB7CiAgICAgICAgc3RhdGUgPSBfc3RvcmFnZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnNlcnRJbmRleChieXRlczMyIF9rZXkpIGludGVybmFsIHsKICAgICAgICB1aW50IHRpbWVzdGFtcCA9IF9rZXkuZ2V0VGltZXN0YW1wKCk7CiAgICAgICAgYnl0ZXMzMiB5ZWFyID0gdG9LZXkodGltZXN0YW1wLCBZRUFSKTsKICAgICAgICBieXRlczMyIGhlYWRMb3c7CiAgICAgICAgYnl0ZXMzMiBoZWFkSGlnaDsKICAgICAgICAoaGVhZExvdywgaGVhZEhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChIRUFEKSk7CiAgICAgICAgaWYgKHllYXIgPCBoZWFkTG93IHx8IGhlYWRMb3cgPT0gMCB8fCB5ZWFyID4gaGVhZEhpZ2gpIHsKICAgICAgICAgICAgaWYgKHllYXIgPCBoZWFkTG93IHx8IGhlYWRMb3cgPT0gMCkgewogICAgICAgICAgICAgICAgaGVhZExvdyA9IHllYXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHllYXIgPiBoZWFkSGlnaCkgewogICAgICAgICAgICAgICAgaGVhZEhpZ2ggPSB5ZWFyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLnNldChIRUFELCB0b1ZhbHVlKGhlYWRMb3csIGhlYWRIaWdoKSk7CiAgICAgICAgfQoKICAgICAgICBieXRlczMyIHdlZWsgPSB0b0tleSh0aW1lc3RhbXAsIDEgd2Vla3MpOwogICAgICAgIGJ5dGVzMzIgbG93OwogICAgICAgIGJ5dGVzMzIgaGlnaDsKICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQoeWVhcikpOwogICAgICAgIGlmICh3ZWVrIDwgbG93IHx8IHdlZWsgPiBoaWdoKSB7CiAgICAgICAgICAgIGlmICh3ZWVrIDwgbG93IHx8IGxvdyA9PSAwKSB7CiAgICAgICAgICAgICAgICBsb3cgPSB3ZWVrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh3ZWVrID4gaGlnaCkgewogICAgICAgICAgICAgICAgaGlnaCA9IHdlZWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuc2V0KHllYXIsIHRvVmFsdWUobG93LCBoaWdoKSk7CiAgICAgICAgfQoKICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQod2VlaykpOwogICAgICAgIGJ5dGVzMzIgaG91ciA9IHRvS2V5KHRpbWVzdGFtcCwgMSBob3Vycyk7CiAgICAgICAgaWYgKGhvdXIgPCBsb3cgfHwgaG91ciA+IGhpZ2gpIHsKICAgICAgICAgICAgaWYgKGhvdXIgPCBsb3cgfHwgbG93ID09IDApIHsKICAgICAgICAgICAgICAgIGxvdyA9IGhvdXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhvdXIgPiBoaWdoKSB7CiAgICAgICAgICAgICAgICBoaWdoID0gaG91cjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5zZXQod2VlaywgdG9WYWx1ZShsb3csIGhpZ2gpKTsKICAgICAgICB9CgogICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChob3VyKSk7CiAgICAgICAgYnl0ZXMzMiBtaW51dGUgPSB0b0tleSh0aW1lc3RhbXAsIDEgbWludXRlcyk7CiAgICAgICAgaWYgKG1pbnV0ZSA8IGxvdyB8fCBtaW51dGUgPiBoaWdoKSB7CiAgICAgICAgICAgIGlmIChtaW51dGUgPCBsb3cgfHwgbG93ID09IDApIHsKICAgICAgICAgICAgICAgIGxvdyA9IG1pbnV0ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobWludXRlID4gaGlnaCkgewogICAgICAgICAgICAgICAgaGlnaCA9IG1pbnV0ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5zZXQoaG91ciwgdG9WYWx1ZShsb3csIGhpZ2gpKTsKICAgICAgICB9CgogICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChtaW51dGUpKTsKICAgICAgICBieXRlczMyIHRzS2V5ID0gdG9LZXkodGltZXN0YW1wKTsKICAgICAgICBpZiAodHNLZXkgPCBsb3cgfHwgdHNLZXkgPiBoaWdoKSB7CiAgICAgICAgICAgIGlmICh0c0tleSA8IGxvdyB8fCBsb3cgPT0gMCkgewogICAgICAgICAgICAgICAgbG93ID0gdHNLZXk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRzS2V5ID4gaGlnaCkgewogICAgICAgICAgICAgICAgaGlnaCA9IHRzS2V5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLnNldChtaW51dGUsIHRvVmFsdWUobG93LCBoaWdoKSk7CiAgICAgICAgfQoKICAgICAgICBzdGF0ZS5zZXQodHNLZXksIF9rZXkpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVcGRhdGUga2V5IHZhbHVlIGZyb20gdGhlIHByZXZpb3VzIHN0YXRlIHRvIG5ldy4gVGltZXN0YW1wIE1VU1QgYmUgdGhlIHNhbWUgb24gYm90aCBrZXlzLgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVJbmRleChieXRlczMyIF9wcmV2LCBieXRlczMyIF9rZXkpIGludGVybmFsIHsKICAgICAgICB1aW50IHRpbWVzdGFtcCA9IF9rZXkuZ2V0VGltZXN0YW1wKCk7CiAgICAgICAgYnl0ZXMzMiB0c0tleSA9IHRvS2V5KHRpbWVzdGFtcCk7CiAgICAgICAgYnl0ZXMzMiBwcmV2S2V5ID0gc3RhdGUuZ2V0KHRzS2V5KTsKICAgICAgICAvLyBvbiB0aGUgc2FtZSB0aW1lc3RhbXAgbWlnaHQgYmUgb3RoZXIga2V5LCBpbiB0aGF0IGNhc2Ugd2UgZG8gbm90IG5lZWQgdG8gdXBkYXRlIGl0CiAgICAgICAgaWYgKHByZXZLZXkgIT0gX3ByZXYpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5zZXQodHNLZXksIF9rZXkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRGbG9vcktleVllYXIodWludCBfdGltZXN0YW1wLCBieXRlczMyIF9sb3csIGJ5dGVzMzIgX2hpZ2gpIHZpZXcgcHJpdmF0ZSByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiB5ZWFyID0gdG9LZXkoX3RpbWVzdGFtcCwgWUVBUik7CiAgICAgICAgaWYgKHllYXIgPCBfbG93KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBpZiAoeWVhciA+IF9oaWdoKSB7CiAgICAgICAgICAgIC8vIHdlZWsKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KF9oaWdoKSk7CiAgICAgICAgICAgIC8vIGhvdXIKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KGhpZ2gpKTsKICAgICAgICAgICAgLy8gbWludXRlCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChoaWdoKSk7CiAgICAgICAgICAgIC8vIHRzCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKHN0YXRlLmdldChoaWdoKSk7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5nZXQoaGlnaCk7CiAgICAgICAgfQoKICAgICAgICBieXRlczMyIGxvdzsKICAgICAgICBieXRlczMyIGhpZ2g7CgogICAgICAgIHdoaWxlICh5ZWFyID49IF9sb3cpIHsKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KHllYXIpKTsKICAgICAgICAgICAgaWYgKGxvdyAhPSAwKSB7CiAgICAgICAgICAgICAgICBieXRlczMyIGtleSA9IGZpbmRGbG9vcktleVdlZWsoX3RpbWVzdGFtcCwgbG93LCBoaWdoKTsKICAgICAgICAgICAgICAgIGlmIChrZXkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gMHgxREZFMjAwID0gNTIgd2Vla3MgPSAzMTQ0OTYwMAogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICB5ZWFyIDo9IHN1Yih5ZWFyLCAweDFERkUyMDApCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRGbG9vcktleVdlZWsodWludCBfdGltZXN0YW1wLCBieXRlczMyIF9sb3csIGJ5dGVzMzIgX2hpZ2gpIHZpZXcgcHJpdmF0ZSByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiB3ZWVrID0gdG9LZXkoX3RpbWVzdGFtcCwgMSB3ZWVrcyk7CiAgICAgICAgaWYgKHdlZWsgPCBfbG93KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBsb3c7CiAgICAgICAgYnl0ZXMzMiBoaWdoOwoKICAgICAgICBpZiAod2VlayA+IF9oaWdoKSB7CiAgICAgICAgICAgIC8vIGhvdXIKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KF9oaWdoKSk7CiAgICAgICAgICAgIC8vIG1pbnV0ZQogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQoaGlnaCkpOwogICAgICAgICAgICAvLyB0cwogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQoaGlnaCkpOwogICAgICAgICAgICByZXR1cm4gc3RhdGUuZ2V0KGhpZ2gpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHdlZWsgPj0gX2xvdykgewogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQod2VlaykpOwogICAgICAgICAgICBpZiAobG93ICE9IDApIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIga2V5ID0gZmluZEZsb29yS2V5SG91cihfdGltZXN0YW1wLCBsb3csIGhpZ2gpOwogICAgICAgICAgICAgICAgaWYgKGtleSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMSB3ZWVrcyA9IDYwNDgwMAogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICB3ZWVrIDo9IHN1Yih3ZWVrLCA2MDQ4MDApCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGZpbmRGbG9vcktleUhvdXIodWludCBfdGltZXN0YW1wLCBieXRlczMyIF9sb3csIGJ5dGVzMzIgX2hpZ2gpIHZpZXcgcHJpdmF0ZSByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiBob3VyID0gdG9LZXkoX3RpbWVzdGFtcCwgMSBob3Vycyk7CiAgICAgICAgaWYgKGhvdXIgPCBfbG93KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBsb3c7CiAgICAgICAgYnl0ZXMzMiBoaWdoOwoKICAgICAgICBpZiAoaG91ciA+IF9oaWdoKSB7CiAgICAgICAgICAgIC8vIG1pbnV0ZQogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShzdGF0ZS5nZXQoX2hpZ2gpKTsKICAgICAgICAgICAgLy8gdHMKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KGhpZ2gpKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmdldChoaWdoKTsKICAgICAgICB9CgogICAgICAgIHdoaWxlIChob3VyID49IF9sb3cpIHsKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KGhvdXIpKTsKICAgICAgICAgICAgaWYgKGxvdyAhPSAwKSB7CiAgICAgICAgICAgICAgICBieXRlczMyIGtleSA9IGZpbmRGbG9vcktleU1pbnV0ZShfdGltZXN0YW1wLCBsb3csIGhpZ2gpOwogICAgICAgICAgICAgICAgaWYgKGtleSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMSBob3VycyA9IDM2MDAKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgaG91ciA6PSBzdWIoaG91ciwgMzYwMCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kRmxvb3JLZXlNaW51dGUodWludCBfdGltZXN0YW1wLCBieXRlczMyIF9sb3csIGJ5dGVzMzIgX2hpZ2gpIHZpZXcgcHJpdmF0ZSByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiBtaW51dGUgPSB0b0tleShfdGltZXN0YW1wLCAxIG1pbnV0ZXMpOwogICAgICAgIGlmIChtaW51dGUgPCBfbG93KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBsb3c7CiAgICAgICAgYnl0ZXMzMiBoaWdoOwoKICAgICAgICBpZiAobWludXRlID4gX2hpZ2gpIHsKICAgICAgICAgICAgLy8gdHMKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KF9oaWdoKSk7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5nZXQoaGlnaCk7CiAgICAgICAgfQoKICAgICAgICB3aGlsZSAobWludXRlID49IF9sb3cpIHsKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KG1pbnV0ZSkpOwogICAgICAgICAgICBpZiAobG93ICE9IDApIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIga2V5ID0gZmluZEZsb29yS2V5VGltZXN0YW1wKF90aW1lc3RhbXAsIGxvdywgaGlnaCk7CiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxIG1pbnV0ZXMgPSA2MAogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBtaW51dGUgOj0gc3ViKG1pbnV0ZSwgNjApCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRGbG9vcktleVRpbWVzdGFtcCh1aW50IF90aW1lc3RhbXAsIGJ5dGVzMzIgX2xvdywgYnl0ZXMzMiBfaGlnaCkgdmlldyBwcml2YXRlIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICBieXRlczMyIHRzS2V5ID0gdG9LZXkoX3RpbWVzdGFtcCk7CiAgICAgICAgaWYgKHRzS2V5IDwgX2xvdykgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHRzS2V5ID4gX2hpZ2gpIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmdldChfaGlnaCk7CiAgICAgICAgfQoKICAgICAgICB3aGlsZSAodHNLZXkgPj0gX2xvdykgewogICAgICAgICAgICBieXRlczMyIGtleSA9IHN0YXRlLmdldCh0c0tleSk7CiAgICAgICAgICAgIGlmIChrZXkgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICB0c0tleSA6PSBzdWIodHNLZXksIDEpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEZsb29yS2V5SW5kZXgodWludCBfdGltZXN0YW1wKSB2aWV3IGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpIHsKLy8gICAgICAgIHJlcXVpcmUoX3RpbWVzdGFtcCA+IDB4ZmZmZmZmZmYpOwovLyAgICAgICAgaWYgKF90aW1lc3RhbXAgPCAxNTE1NjEyNDE1KSB7Ci8vICAgICAgICAgICAgcmV0dXJuIDA7Ci8vICAgICAgICB9CgogICAgICAgIGJ5dGVzMzIgeWVhckxvdzsKICAgICAgICBieXRlczMyIHllYXJIaWdoOwogICAgICAgICh5ZWFyTG93LCB5ZWFySGlnaCkgPSBmcm9tVmFsdWUoc3RhdGUuZ2V0KEhFQUQpKTsKCiAgICAgICAgcmV0dXJuIGZpbmRGbG9vcktleVllYXIoX3RpbWVzdGFtcCwgeWVhckxvdywgeWVhckhpZ2gpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvS2V5KHVpbnQgX3RpbWVzdGFtcCwgdWludCByb3VuZGVyKSBwdXJlIHByaXZhdGUgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpIHsKICAgICAgICAvLyAweDAuLi4wMDAwMDAwMDAwMDAwMDAwMAogICAgICAgIC8vICAgICAgICBeXl5eXl5eXiAtIHJvdW5kZXIgbWFya2VyIChlZywgdG8gYXZvaWQgY3Jvc3NpbmcgZmlyc3QgZGF5IG9mIHllYXIgd2l0aCB5ZWFyKQogICAgICAgIC8vICAgICAgICAgICAgICAgIF5eXl5eXl5eIC0gcm91bmRlZCBtb21lbnQgKHllYXIsIHdlZWssIGV0YykKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihtdWwocm91bmRlciwgMHgxMDAwMDAwMDApLCBtdWwoZGl2KF90aW1lc3RhbXAsIHJvdW5kZXIpLCByb3VuZGVyKSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdG9WYWx1ZShieXRlczMyIF9sb3dLZXksIGJ5dGVzMzIgX2hpZ2hLZXkpIHB1cmUgcHJpdmF0ZSByZXR1cm5zIChieXRlczMyIHJlc3VsdCkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmVzdWx0IDo9IG9yKG11bChfbG93S2V5LCAweDEwMDAwMDAwMDAwMDAwMDAwKSwgX2hpZ2hLZXkpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGZyb21WYWx1ZShieXRlczMyIF92YWx1ZSkgcHVyZSBwcml2YXRlIHJldHVybnMgKGJ5dGVzMzIgX2xvd0tleSwgYnl0ZXMzMiBfaGlnaEtleSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX2xvd0tleSA6PSBhbmQoZGl2KF92YWx1ZSwgMHgxMDAwMDAwMDAwMDAwMDAwMCksIDB4ZmZmZmZmZmZmZmZmZmZmZikKICAgICAgICAgICAgX2hpZ2hLZXkgOj0gYW5kKF92YWx1ZSwgMHhmZmZmZmZmZmZmZmZmZmZmKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0b0tleSh1aW50IHRpbWVzdGFtcCkgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgcmV0dXJuIGJ5dGVzMzIodGltZXN0YW1wKTsKICAgIH0KfQoKCmNvbnRyYWN0IEpvdWxlQ29udHJhY3RIb2xkZXIgaXMgSm91bGVJbmRleENvcmUsIHVzaW5nQ29uc3RzIHsKICAgIHVzaW5nIEtleXNVdGlscyBmb3IgYnl0ZXMzMjsKICAgIHVpbnQgaW50ZXJuYWwgbGVuZ3RoOwogICAgYnl0ZXMzMiBwdWJsaWMgaGVhZDsKCiAgICBmdW5jdGlvbiBKb3VsZUNvbnRyYWN0SG9sZGVyKGJ5dGVzMzIgX2hlYWQsIHVpbnQgX2xlbmd0aCwgSm91bGVTdG9yYWdlIF9zdG9yYWdlKSBwdWJsaWMKICAgICAgICAgICAgSm91bGVJbmRleENvcmUoX3N0b3JhZ2UpIHsKICAgICAgICBoZWFkID0gX2hlYWQ7CiAgICAgICAgbGVuZ3RoID0gX2xlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnNlcnQoYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGludGVybmFsIHsKICAgICAgICBsZW5ndGggKys7CiAgICAgICAgYnl0ZXMzMiBpZCA9IEtleXNVdGlscy50b0tleShfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgICAgIGlmIChoZWFkID09IDApIHsKICAgICAgICAgICAgaGVhZCA9IGlkOwogICAgICAgICAgICBpbnNlcnRJbmRleChpZCk7Ci8vICAgICAgICAgICAgRm91bmQoMHhmZmZmZmZmZik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYnl0ZXMzMiBwcmV2aW91cyA9IGZpbmRGbG9vcktleUluZGV4KF90aW1lc3RhbXApOwoKICAgICAgICAvLyByZWplY3QgZHVwbGljYXRlIGtleSBvbiB0aGUgZW5kCiAgICAgICAgcmVxdWlyZShwcmV2aW91cyAhPSBpZCk7CiAgICAgICAgLy8gcmVqZWN0IGR1cGxpY2F0ZSBpbiB0aGUgbWlkZGxlCiAgICAgICAgcmVxdWlyZShzdGF0ZS5nZXQoaWQpID09IDApOwoKICAgICAgICB1aW50IHByZXZUaW1lc3RhbXAgPSBwcmV2aW91cy5nZXRUaW1lc3RhbXAoKTsKLy8gICAgICAgIEZvdW5kKHByZXZUaW1lc3RhbXApOwogICAgICAgIHVpbnQgaGVhZFRpbWVzdGFtcCA9IGhlYWQuZ2V0VGltZXN0YW1wKCk7CiAgICAgICAgLy8gYWRkIGFzIGhlYWQsIHByZXZUaW1lc3RhbXAgPT0gMCBvciBpbiB0aGUgcGFzdAogICAgICAgIGlmIChwcmV2VGltZXN0YW1wIDwgaGVhZFRpbWVzdGFtcCkgewogICAgICAgICAgICBzdGF0ZS5zZXQoaWQsIGhlYWQpOwogICAgICAgICAgICBoZWFkID0gaWQ7CiAgICAgICAgfQogICAgICAgIC8vIGFkZCBhZnRlciB0aGUgcHJldmlvdXMKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3RhdGUuc2V0KGlkLCBzdGF0ZS5nZXQocHJldmlvdXMpKTsKICAgICAgICAgICAgc3RhdGUuc2V0KHByZXZpb3VzLCBpZCk7CiAgICAgICAgfQogICAgICAgIGluc2VydEluZGV4KGlkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVHYXMoYnl0ZXMzMiBfa2V5LCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSwgdWludCBfbmV3R2FzTGltaXQpIGludGVybmFsIHsKICAgICAgICBieXRlczMyIGlkID0gS2V5c1V0aWxzLnRvS2V5KF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICAgICAgYnl0ZXMzMiBuZXdJZCA9IEtleXNVdGlscy50b0tleShfYWRkcmVzcywgX3RpbWVzdGFtcCwgX25ld0dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgICAgIGlmIChpZCA9PSBoZWFkKSB7CiAgICAgICAgICAgIGhlYWQgPSBuZXdJZDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoc3RhdGUuZ2V0KF9rZXkpID09IGlkKTsKICAgICAgICAgICAgc3RhdGUuc2V0KF9rZXksIG5ld0lkKTsKICAgICAgICB9CiAgICAgICAgc3RhdGUuc3dhcChpZCwgbmV3SWQpOwogICAgICAgIHVwZGF0ZUluZGV4KGlkLCBuZXdJZCk7CiAgICB9CgogICAgZnVuY3Rpb24gbmV4dCgpIGludGVybmFsIHsKICAgICAgICBoZWFkID0gc3RhdGUuZ2V0QW5kRGVsKGhlYWQpOwogICAgICAgIGxlbmd0aC0tOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBsZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmVjb3JkKGJ5dGVzMzIgX3BhcmVudCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczMyIF9yZWNvcmQpIHsKICAgICAgICBpZiAoX3BhcmVudCA9PSAwKSB7CiAgICAgICAgICAgIF9yZWNvcmQgPSBoZWFkOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgX3JlY29yZCA9IHN0YXRlLmdldChfcGFyZW50KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZpbmQgcHJldmlvdXMga2V5IGZvciBleGlzdGluZyB2YWx1ZS4KICAgICAqLwogICAgZnVuY3Rpb24gZmluZFByZXZpb3VzKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICBieXRlczMyIHRhcmdldCA9IEtleXNVdGlscy50b0tleShfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgICAgIGJ5dGVzMzIgcHJldmlvdXMgPSBoZWFkOwogICAgICAgIGlmICh0YXJnZXQgPT0gcHJldmlvdXMpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIC8vIGlmIGl0IGlzIG5vdCBoZWFkIHRpbWUKICAgICAgICBpZiAoX3RpbWVzdGFtcCAhPSBwcmV2aW91cy5nZXRUaW1lc3RhbXAoKSkgewogICAgICAgICAgICBwcmV2aW91cyA9IGZpbmRGbG9vcktleUluZGV4KF90aW1lc3RhbXAgLSAxKTsKICAgICAgICB9CiAgICAgICAgYnl0ZXMzMiBjdXJyZW50ID0gc3RhdGUuZ2V0KHByZXZpb3VzKTsKICAgICAgICB3aGlsZSAoY3VycmVudCAhPSB0YXJnZXQpIHsKICAgICAgICAgICAgcHJldmlvdXMgPSBjdXJyZW50OwogICAgICAgICAgICBjdXJyZW50ID0gc3RhdGUuZ2V0KHByZXZpb3VzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByZXZpb3VzOwogICAgfQp9Cgpjb250cmFjdCBKb3VsZVZhdWx0IGlzIE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgam91bGU7CgogICAgZnVuY3Rpb24gc2V0Sm91bGUoYWRkcmVzcyBfam91bGUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGpvdWxlID0gX2pvdWxlOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlKb3VsZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhqb3VsZSkpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXcoYWRkcmVzcyBfcmVjZWl2ZXIsIHVpbnQgX2Ftb3VudCkgcHVibGljIG9ubHlKb3VsZSB7CiAgICAgICAgX3JlY2VpdmVyLnRyYW5zZmVyKF9hbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKCiAgICB9Cn0KCmNvbnRyYWN0IEpvdWxlQ29yZSBpcyBKb3VsZUNvbnRyYWN0SG9sZGVyIHsKICAgIGV2ZW50IEdhcyh1aW50KTsKICAgIEpvdWxlVmF1bHQgcHVibGljIHZhdWx0OwogICAgdWludDMyIHB1YmxpYyBtaW5HYXNQcmljZUd3ZWkgPSBERUZBVUxUX01JTl9HQVNfUFJJQ0VfR1dFSTsKICAgIHVzaW5nIEtleXNVdGlscyBmb3IgYnl0ZXMzMjsKCiAgICBmdW5jdGlvbiBKb3VsZUNvcmUoSm91bGVWYXVsdCBfdmF1bHQsIGJ5dGVzMzIgX2hlYWQsIHVpbnQgX2xlbmd0aCwgSm91bGVTdG9yYWdlIF9zdG9yYWdlKSBwdWJsaWMKICAgICAgICBKb3VsZUNvbnRyYWN0SG9sZGVyKF9oZWFkLCBfbGVuZ3RoLCBfc3RvcmFnZSkgewogICAgICAgIHZhdWx0ID0gX3ZhdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGlubmVyUmVnaXN0ZXIoYWRkcmVzcyBfcmVnaXN0cmFudCwgYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHByaWNlID0gZ2V0UHJpY2VJbm5lcihfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcHJpY2UpOwogICAgICAgIHZhdWx0LnRyYW5zZmVyKHByaWNlKTsKCiAgICAgICAgLy8gdGhpcyByZXN0cmljdGlvbiB0byBhdm9pZCBhdHRhY2sgdG8gYnJha2UgaW5kZXggdHJlZSAoY3Jvc3Npbmcga2V5KQogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gMCk7CiAgICAgICAgcmVxdWlyZShfdGltZXN0YW1wID4gbm93KTsKICAgICAgICByZXF1aXJlKF90aW1lc3RhbXAgPCAweDEwMDAwMDAwMCk7CiAgICAgICAgcmVxdWlyZShfZ2FzTGltaXQgPD0gTUFYX0dBUyk7CiAgICAgICAgcmVxdWlyZShfZ2FzTGltaXQgIT0gMCk7CiAgICAgICAgLy8gZnJvbSAxIGd3ZWkgdG8gMHgxMDAwMDAwMDAgZ3dlaQogICAgICAgIHJlcXVpcmUoX2dhc1ByaWNlID49IG1pbkdhc1ByaWNlR3dlaSAqIEdXRUkpOwogICAgICAgIHJlcXVpcmUoX2dhc1ByaWNlIDwgTUFYX0dBU19QUklDRSk7CiAgICAgICAgLy8gMCBtZWFucyBub3QgeWV0IHJlZ2lzdGVyZWQKICAgICAgICByZXF1aXJlKF9yZWdpc3RyYW50ICE9IDB4MCk7CgogICAgICAgIHVpbnQgaW5uZXJHYXNQcmljZSA9IF9nYXNQcmljZSAvIEdXRUk7CiAgICAgICAgaW5zZXJ0KF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIGlubmVyR2FzUHJpY2UpOwogICAgICAgIHNhdmVSZWdpc3RyYW50KF9yZWdpc3RyYW50LCBfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBpbm5lckdhc1ByaWNlKTsKCiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IHByaWNlKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlIC0gcHJpY2UpOwogICAgICAgICAgICByZXR1cm4gbXNnLnZhbHVlIC0gcHJpY2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhdmVSZWdpc3RyYW50KGFkZHJlc3MgX3JlZ2lzdHJhbnQsIGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCwgdWludCkgaW50ZXJuYWwgewogICAgICAgIGJ5dGVzMzIgaWQgPSBLZXlzVXRpbHMudG9LZXkoX2FkZHJlc3MsIF90aW1lc3RhbXAsIDAsIDApOwogICAgICAgIHJlcXVpcmUoc3RhdGUuZ2V0KGlkKSA9PSAwKTsKICAgICAgICBzdGF0ZS5zZXQoaWQsIGJ5dGVzMzIoX3JlZ2lzdHJhbnQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSZWdpc3RyYW50KGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCwgdWludCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiBpZCA9IEtleXNVdGlscy50b0tleShfYWRkcmVzcywgX3RpbWVzdGFtcCwgMCwgMCk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3Moc3RhdGUuZ2V0KGlkKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVsUmVnaXN0cmFudChLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBjdXJyZW50KSBpbnRlcm5hbCB7CiAgICAgICAgYnl0ZXMzMiBpZCA9IEtleXNVdGlscy50b0tleShjdXJyZW50LmNvbnRyYWN0QWRkcmVzcywgY3VycmVudC50aW1lc3RhbXAsIDAsIDApOwogICAgICAgIHN0YXRlLmRlbChpZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEtleShhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gMCk7CiAgICAgICAgcmVxdWlyZShfdGltZXN0YW1wID4gbm93KTsKICAgICAgICByZXF1aXJlKF90aW1lc3RhbXAgPCAweDEwMDAwMDAwMCk7CiAgICAgICAgcmVxdWlyZShfZ2FzTGltaXQgPD0gTUFYX0dBUyk7CiAgICAgICAgcmVxdWlyZShfZ2FzUHJpY2UgPiBHV0VJKTsKICAgICAgICByZXF1aXJlKF9nYXNQcmljZSA8IDB4MTAwMDAwMDAwICogR1dFSSk7CiAgICAgICAgcmV0dXJuIGZpbmRQcmV2aW91cyhfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UgLyBHV0VJKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbm5lclVucmVnaXN0ZXIoYWRkcmVzcyBfcmVnaXN0cmFudCwgYnl0ZXMzMiBfa2V5LCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIG9ubHkgZnV0dXJlIHJlZ2lzdHJhdGlvbnMgbWlnaHQgYmUgdXBkYXRlZCwgdG8gYXZvaWQgcmFjZSBjb25kaXRpb24gaW4gYmxvY2sgKHdpdGggaW52b2tlKQogICAgICAgIHJlcXVpcmUoX3RpbWVzdGFtcCA+IG5vdyk7CiAgICAgICAgLy8gdG8gYXZvaWQgcmVtb3ZpbmcgYWxyZWFkeSByZW1vdmVkIGtleXMKICAgICAgICByZXF1aXJlKF9nYXNMaW1pdCAhPSAwKTsKICAgICAgICB1aW50IGlubmVyR2FzUHJpY2UgPSBfZ2FzUHJpY2UgLyBHV0VJOwogICAgICAgIC8vIGNoZWNrIHJlZ2lzdHJhbnQKICAgICAgICBhZGRyZXNzIHJlZ2lzdHJhbnQgPSBnZXRSZWdpc3RyYW50KF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIGlubmVyR2FzUHJpY2UpOwogICAgICAgIHJlcXVpcmUocmVnaXN0cmFudCA9PSBfcmVnaXN0cmFudCk7CgogICAgICAgIHVwZGF0ZUdhcyhfa2V5LCBfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBpbm5lckdhc1ByaWNlLCAwKTsKICAgICAgICB1aW50IGFtb3VudCA9IF9nYXNMaW1pdCAqIF9nYXNQcmljZTsKICAgICAgICBpZiAoYW1vdW50ICE9IDApIHsKICAgICAgICAgICAgdmF1bHQud2l0aGRyYXcocmVnaXN0cmFudCwgYW1vdW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQcmljZSh1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoX2dhc0xpbWl0IDw9IE1BWF9HQVMpOwogICAgICAgIHJlcXVpcmUoX2dhc1ByaWNlID4gR1dFSSk7CiAgICAgICAgcmVxdWlyZShfZ2FzUHJpY2UgPCAweDEwMDAwMDAwMCAqIEdXRUkpOwoKICAgICAgICByZXR1cm4gZ2V0UHJpY2VJbm5lcihfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UHJpY2VJbm5lcih1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIGlmIHRoaXMgbG9naWMgd2lsbCBiZSBjaGFuZ2VkLCBsb29rIGFsc28gdG8gdGhlIGlubmVyVW5yZWdpc3RlciBtZXRob2QKICAgICAgICByZXR1cm4gKF9nYXNMaW1pdCArIEpPVUxFX0dBUykgKiBfZ2FzUHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VmVyc2lvbigpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYnl0ZXM4KSB7CiAgICAgICAgcmV0dXJuIFZFUlNJT047CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9wKHVpbnQgX2NvdW50KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3NbXSBfYWRkcmVzc2VzLAogICAgICAgIHVpbnRbXSBfdGltZXN0YW1wcywKICAgICAgICB1aW50W10gX2dhc0xpbWl0cywKICAgICAgICB1aW50W10gX2dhc1ByaWNlcywKICAgICAgICB1aW50W10gX2ludm9rZUdhc2VzLAogICAgICAgIHVpbnRbXSBfcmV3YXJkQW1vdW50cwogICAgKSB7CiAgICAgICAgdWludCBhbW91bnQgPSBfY291bnQgPD0gbGVuZ3RoID8gX2NvdW50IDogbGVuZ3RoOwoKICAgICAgICBfYWRkcmVzc2VzID0gbmV3IGFkZHJlc3NbXShhbW91bnQpOwogICAgICAgIF90aW1lc3RhbXBzID0gbmV3IHVpbnRbXShhbW91bnQpOwogICAgICAgIF9nYXNMaW1pdHMgPSBuZXcgdWludFtdKGFtb3VudCk7CiAgICAgICAgX2dhc1ByaWNlcyA9IG5ldyB1aW50W10oYW1vdW50KTsKICAgICAgICBfaW52b2tlR2FzZXMgPSBuZXcgdWludFtdKGFtb3VudCk7CiAgICAgICAgX3Jld2FyZEFtb3VudHMgPSBuZXcgdWludFtdKGFtb3VudCk7CgogICAgICAgIGJ5dGVzMzIgY3VycmVudCA9IGdldFJlY29yZCgwKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhbW91bnQ7IGkgKyspIHsKICAgICAgICAgICAgS2V5c1V0aWxzLk9iamVjdCBtZW1vcnkgb2JqID0gY3VycmVudC50b09iamVjdCgpOwogICAgICAgICAgICBfYWRkcmVzc2VzW2ldID0gb2JqLmNvbnRyYWN0QWRkcmVzczsKICAgICAgICAgICAgX3RpbWVzdGFtcHNbaV0gPSBvYmoudGltZXN0YW1wOwogICAgICAgICAgICBfZ2FzTGltaXRzW2ldID0gb2JqLmdhc0xpbWl0OwogICAgICAgICAgICBfZ2FzUHJpY2VzW2ldID0gb2JqLmdhc1ByaWNlR3dlaSAqIEdXRUk7CiAgICAgICAgICAgIF9pbnZva2VHYXNlc1tpXSA9IGNhbGNJbnZva2VHYXMob2JqLmdhc0xpbWl0KTsKICAgICAgICAgICAgX3Jld2FyZEFtb3VudHNbaV0gPSBjYWxjUmV3YXJkKG9iai5nYXNMaW1pdCwgb2JqLmdhc1ByaWNlR3dlaSk7CiAgICAgICAgICAgIGN1cnJlbnQgPSBnZXRSZWNvcmQoY3VycmVudCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRvcE9uY2UoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3MgY29udHJhY3RBZGRyZXNzLAogICAgICAgIHVpbnQgdGltZXN0YW1wLAogICAgICAgIHVpbnQgZ2FzTGltaXQsCiAgICAgICAgdWludCBnYXNQcmljZSwKICAgICAgICB1aW50IGludm9rZUdhcywKICAgICAgICB1aW50IHJld2FyZEFtb3VudAogICAgKSB7CiAgICAgICAgS2V5c1V0aWxzLk9iamVjdCBtZW1vcnkgb2JqID0gZ2V0UmVjb3JkKDApLnRvT2JqZWN0KCk7CgogICAgICAgIGNvbnRyYWN0QWRkcmVzcyA9IG9iai5jb250cmFjdEFkZHJlc3M7CiAgICAgICAgdGltZXN0YW1wID0gb2JqLnRpbWVzdGFtcDsKICAgICAgICBnYXNMaW1pdCA9IG9iai5nYXNMaW1pdDsKICAgICAgICBnYXNQcmljZSA9IG9iai5nYXNQcmljZUd3ZWkgKiBHV0VJOwogICAgICAgIGludm9rZUdhcyA9IGNhbGNJbnZva2VHYXMob2JqLmdhc0xpbWl0KTsKICAgICAgICByZXdhcmRBbW91bnQgPSBjYWxjUmV3YXJkKG9iai5nYXNMaW1pdCwgb2JqLmdhc1ByaWNlR3dlaSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TmV4dE9uY2UoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICB1aW50IF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc0xpbWl0LAogICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgdWludCB0aW1lc3RhbXAsCiAgICAgICAgdWludCBnYXNMaW1pdCwKICAgICAgICB1aW50IGdhc1ByaWNlLAogICAgICAgIHVpbnQgaW52b2tlR2FzLAogICAgICAgIHVpbnQgcmV3YXJkQW1vdW50CiAgICApIHsKICAgICAgICBpZiAoX3RpbWVzdGFtcCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRvcE9uY2UoKTsKICAgICAgICB9CgogICAgICAgIGJ5dGVzMzIgcHJldiA9IEtleXNVdGlscy50b0tleShfY29udHJhY3RBZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSAvIEdXRUkpOwogICAgICAgIGJ5dGVzMzIgY3VycmVudCA9IGdldFJlY29yZChwcmV2KTsKICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBvYmogPSBjdXJyZW50LnRvT2JqZWN0KCk7CgogICAgICAgIGNvbnRyYWN0QWRkcmVzcyA9IG9iai5jb250cmFjdEFkZHJlc3M7CiAgICAgICAgdGltZXN0YW1wID0gb2JqLnRpbWVzdGFtcDsKICAgICAgICBnYXNMaW1pdCA9IG9iai5nYXNMaW1pdDsKICAgICAgICBnYXNQcmljZSA9IG9iai5nYXNQcmljZUd3ZWkgKiBHV0VJOwogICAgICAgIGludm9rZUdhcyA9IGNhbGNJbnZva2VHYXMob2JqLmdhc0xpbWl0KTsKICAgICAgICByZXdhcmRBbW91bnQgPSBjYWxjUmV3YXJkKG9iai5nYXNMaW1pdCwgb2JqLmdhc1ByaWNlR3dlaSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TmV4dCh1aW50IF9jb3VudCwKICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9jb250cmFjdEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgdWludCBfdGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc0xpbWl0LAogICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3NbXSBfYWRkcmVzc2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBfdGltZXN0YW1wcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gX2dhc0xpbWl0cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gX2dhc1ByaWNlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gX2ludm9rZUdhc2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBfcmV3YXJkQW1vdW50cykgewogICAgICAgIF9hZGRyZXNzZXMgPSBuZXcgYWRkcmVzc1tdKF9jb3VudCk7CiAgICAgICAgX3RpbWVzdGFtcHMgPSBuZXcgdWludFtdKF9jb3VudCk7CiAgICAgICAgX2dhc0xpbWl0cyA9IG5ldyB1aW50W10oX2NvdW50KTsKICAgICAgICBfZ2FzUHJpY2VzID0gbmV3IHVpbnRbXShfY291bnQpOwogICAgICAgIF9pbnZva2VHYXNlcyA9IG5ldyB1aW50W10oX2NvdW50KTsKICAgICAgICBfcmV3YXJkQW1vdW50cyA9IG5ldyB1aW50W10oX2NvdW50KTsKCiAgICAgICAgYnl0ZXMzMiBwcmV2OwogICAgICAgIGlmIChfdGltZXN0YW1wICE9IDApIHsKICAgICAgICAgICAgcHJldiA9IEtleXNVdGlscy50b0tleShfY29udHJhY3RBZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSAvIEdXRUkpOwogICAgICAgIH0KCiAgICAgICAgdWludCBpbmRleCA9IDA7CiAgICAgICAgd2hpbGUgKGluZGV4IDwgX2NvdW50KSB7CiAgICAgICAgICAgIGJ5dGVzMzIgY3VycmVudCA9IGdldFJlY29yZChwcmV2KTsKICAgICAgICAgICAgaWYgKGN1cnJlbnQgPT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgS2V5c1V0aWxzLk9iamVjdCBtZW1vcnkgb2JqID0gY3VycmVudC50b09iamVjdCgpOwoKICAgICAgICAgICAgX2FkZHJlc3Nlc1tpbmRleF0gPSBvYmouY29udHJhY3RBZGRyZXNzOwogICAgICAgICAgICBfdGltZXN0YW1wc1tpbmRleF0gPSBvYmoudGltZXN0YW1wOwogICAgICAgICAgICBfZ2FzTGltaXRzW2luZGV4XSA9IG9iai5nYXNMaW1pdDsKICAgICAgICAgICAgX2dhc1ByaWNlc1tpbmRleF0gPSBvYmouZ2FzUHJpY2VHd2VpICogR1dFSTsKICAgICAgICAgICAgX2ludm9rZUdhc2VzW2luZGV4XSA9IGNhbGNJbnZva2VHYXMob2JqLmdhc0xpbWl0KTsKICAgICAgICAgICAgX3Jld2FyZEFtb3VudHNbaW5kZXhdID0gY2FsY1Jld2FyZChvYmouZ2FzTGltaXQsIG9iai5nYXNQcmljZUd3ZWkpOwoKICAgICAgICAgICAgcHJldiA9IGN1cnJlbnQ7CiAgICAgICAgICAgIGluZGV4ICsrOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBuZXh0KEtleXNVdGlscy5PYmplY3QgbWVtb3J5IGN1cnJlbnQpIGludGVybmFsIHsKICAgICAgICBkZWxSZWdpc3RyYW50KGN1cnJlbnQpOwogICAgICAgIG5leHQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbm5lckludm9rZShhZGRyZXNzIF9pbnZva2VyKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9hbW91bnQpIHsKICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBjdXJyZW50ID0gaGVhZC50b09iamVjdCgpOwogICAgICAgIHVpbnQgYW1vdW50OwogICAgICAgIHdoaWxlIChjdXJyZW50LnRpbWVzdGFtcCAhPSAwICYmIGN1cnJlbnQudGltZXN0YW1wIDwgbm93ICYmIG1zZy5nYXMgPj0gKGN1cnJlbnQuZ2FzTGltaXQgKyBSRU1BSU5JTkdfR0FTKSkgewogICAgICAgICAgICBpZiAoY3VycmVudC5nYXNMaW1pdCAhPSAwKSB7CiAgICAgICAgICAgICAgICBpbnZva2VDYWxsYmFjayhfaW52b2tlciwgY3VycmVudCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFtb3VudCArPSBnZXRQcmljZUlubmVyKGN1cnJlbnQuZ2FzTGltaXQsIGN1cnJlbnQuZ2FzUHJpY2VHd2VpICogR1dFSSk7CiAgICAgICAgICAgIG5leHQoY3VycmVudCk7CiAgICAgICAgICAgIGN1cnJlbnQgPSBoZWFkLnRvT2JqZWN0KCk7CiAgICAgICAgfQogICAgICAgIGlmIChhbW91bnQgIT0gMCkgewogICAgICAgICAgICB2YXVsdC53aXRoZHJhdyhtc2cuc2VuZGVyLCBhbW91bnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIGlubmVySW52b2tlT25jZShhZGRyZXNzIF9pbnZva2VyKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9hbW91bnQpIHsKICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBjdXJyZW50ID0gaGVhZC50b09iamVjdCgpOwogICAgICAgIG5leHQoY3VycmVudCk7CiAgICAgICAgaWYgKGN1cnJlbnQuZ2FzTGltaXQgIT0gMCkgewogICAgICAgICAgICBpbnZva2VDYWxsYmFjayhfaW52b2tlciwgY3VycmVudCk7CiAgICAgICAgfQoKICAgICAgICB1aW50IGFtb3VudCA9IGdldFByaWNlSW5uZXIoY3VycmVudC5nYXNMaW1pdCwgY3VycmVudC5nYXNQcmljZUd3ZWkgKiBHV0VJKTsKCiAgICAgICAgaWYgKGFtb3VudCA+IDApIHsKICAgICAgICAgICAgdmF1bHQud2l0aGRyYXcobXNnLnNlbmRlciwgYW1vdW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCgogICAgZnVuY3Rpb24gaW52b2tlQ2FsbGJhY2soYWRkcmVzcywgS2V5c1V0aWxzLk9iamVjdCBtZW1vcnkgX3JlY29yZCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobXNnLmdhcyA+PSBfcmVjb3JkLmdhc0xpbWl0KTsKICAgICAgICByZXR1cm4gX3JlY29yZC5jb250cmFjdEFkZHJlc3MuY2FsbC5nYXMoX3JlY29yZC5nYXNMaW1pdCkoMHg5MTk4NDBhZCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY0ludm9rZUdhcyh1aW50IF9jb250cmFjdEdhc0xpbWl0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gX2NvbnRyYWN0R2FzTGltaXQgKyBKT1VMRV9HQVMgKyBKT1VMRV9JTlZPS0VfR0FTICsgX2NvbnRyYWN0R2FzTGltaXQgKiBKT1VMRV9JTlZPS0VfR0FTX1BFUkNFTlQgLyAxMDA7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY1Jld2FyZCh1aW50IF9jb250cmFjdEdhc0xpbWl0LCB1aW50IF9nYXNQcmljZUd3ZWkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiAoX2NvbnRyYWN0R2FzTGltaXQgKyBKT1VMRV9HQVMpICogX2dhc1ByaWNlR3dlaSAqIEdXRUk7CiAgICB9Cgp9CgoKY29udHJhY3QgSm91bGVCZWhpbmRQcm94eSBpcyBKb3VsZUNvcmUsIE93bmFibGUsIFRyYW5zZmVyVG9rZW4gewogICAgSm91bGVQcm94eUFQSSBwdWJsaWMgcHJveHk7CgogICAgZnVuY3Rpb24gSm91bGVCZWhpbmRQcm94eShKb3VsZVZhdWx0IF92YXVsdCwgYnl0ZXMzMiBfaGVhZCwgdWludCBfbGVuZ3RoLCBKb3VsZVN0b3JhZ2UgX3N0b3JhZ2UpIHB1YmxpYwogICAgICAgIEpvdWxlQ29yZShfdmF1bHQsIF9oZWFkLCBfbGVuZ3RoLCBfc3RvcmFnZSkgewogICAgfQoKICAgIGZ1bmN0aW9uIHNldFByb3h5KEpvdWxlUHJveHlBUEkgX3Byb3h5KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwcm94eSA9IF9wcm94eTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5UHJveHkoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MocHJveHkpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE1pbkdhc1ByaWNlKHVpbnQgX21pbkdhc1ByaWNlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9taW5HYXNQcmljZSA+PSBNSU5fR0FTX1BSSUNFKTsKICAgICAgICByZXF1aXJlKF9taW5HYXNQcmljZSA8PSBNQVhfR0FTX1BSSUNFKTsKICAgICAgICBtaW5HYXNQcmljZUd3ZWkgPSB1aW50MzIoX21pbkdhc1ByaWNlIC8gR1dFSSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVnaXN0ZXJGb3IoYWRkcmVzcyBfcmVnaXN0cmFudCwgYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIHB1YmxpYyBwYXlhYmxlIG9ubHlQcm94eSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGlubmVyUmVnaXN0ZXIoX3JlZ2lzdHJhbnQsIF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdW5yZWdpc3RlckZvcihhZGRyZXNzIF9yZWdpc3RyYW50LCBieXRlczMyIF9rZXksIGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBwdWJsaWMgb25seVByb3h5IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW5uZXJVbnJlZ2lzdGVyKF9yZWdpc3RyYW50LCBfa2V5LCBfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZUZvcihhZGRyZXNzIF9pbnZva2VyKSBwdWJsaWMgb25seVByb3h5IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW5uZXJJbnZva2UoX2ludm9rZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZU9uY2VGb3IoYWRkcmVzcyBfaW52b2tlcikgcHVibGljIG9ubHlQcm94eSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGlubmVySW52b2tlT25jZShfaW52b2tlcik7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlQ2FsbGJhY2soYWRkcmVzcyBfaW52b2tlciwgS2V5c1V0aWxzLk9iamVjdCBtZW1vcnkgX3JlY29yZCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBwcm94eS5jYWxsYmFjayhfaW52b2tlciwgX3JlY29yZC5jb250cmFjdEFkZHJlc3MsIF9yZWNvcmQudGltZXN0YW1wLCBfcmVjb3JkLmdhc0xpbWl0LCBfcmVjb3JkLmdhc1ByaWNlR3dlaSAqIEdXRUkpOwogICAgfQp9Cgpjb250cmFjdCBKb3VsZVByb3h5IGlzIEpvdWxlUHJveHlBUEksIEpvdWxlQVBJLCBPd25hYmxlLCBUcmFuc2ZlclRva2VuLCB1c2luZ0NvbnN0cyB7CiAgICBKb3VsZUJlaGluZFByb3h5IHB1YmxpYyBqb3VsZTsKCiAgICBmdW5jdGlvbiBzZXRKb3VsZShKb3VsZUJlaGluZFByb3h5IF9qb3VsZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgam91bGUgPSBfam91bGU7CiAgICB9CgogICAgbW9kaWZpZXIgb25seUpvdWxlKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKGpvdWxlKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q291bnQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGpvdWxlLmdldENvdW50KCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVnaXN0ZXIoYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiByZWdpc3RlckZvcihtc2cuc2VuZGVyLCBfYWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyRm9yKGFkZHJlc3MgX3JlZ2lzdHJhbnQsIGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgUmVnaXN0ZXJlZChfcmVnaXN0cmFudCwgX2FkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgICAgICB1aW50IGNoYW5nZSA9IGpvdWxlLnJlZ2lzdGVyRm9yLnZhbHVlKG1zZy52YWx1ZSkoX3JlZ2lzdHJhbnQsIF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICAgICAgaWYgKGNoYW5nZSA+IDApIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihjaGFuZ2UpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hhbmdlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVucmVnaXN0ZXIoYnl0ZXMzMiBfa2V5LCBhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIHVucmVnaXN0ZXIgd2lsbCByZXR1cm4gZnVuZHMgdG8gcmVnaXN0cmFudCwgbm90IHRvIG1zZy5zZW5kZXIgKHVubGlrZSByZWdpc3RlcikKICAgICAgICB1aW50IGFtb3VudCA9IGpvdWxlLnVucmVnaXN0ZXJGb3IobXNnLnNlbmRlciwgX2tleSwgX2FkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgICAgICBVbnJlZ2lzdGVyZWQobXNnLnNlbmRlciwgX2FkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlLCBhbW91bnQpOwogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEtleShhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBqb3VsZS5maW5kS2V5KF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlKCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW52b2tlRm9yKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZUZvcihhZGRyZXNzIF9pbnZva2VyKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYW1vdW50ID0gam91bGUuaW52b2tlRm9yKF9pbnZva2VyKTsKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlT25jZSgpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGludm9rZU9uY2VGb3IobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlT25jZUZvcihhZGRyZXNzIF9pbnZva2VyKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYW1vdW50ID0gam91bGUuaW52b2tlT25jZUZvcihfaW52b2tlcik7CiAgICAgICAgaWYgKGFtb3VudCA+IDApIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihhbW91bnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKCiAgICBmdW5jdGlvbiBnZXRQcmljZSh1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBqb3VsZS5nZXRQcmljZShfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9wT25jZSgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgdWludCB0aW1lc3RhbXAsCiAgICAgICAgdWludCBnYXNMaW1pdCwKICAgICAgICB1aW50IGdhc1ByaWNlLAogICAgICAgIHVpbnQgaW52b2tlR2FzLAogICAgICAgIHVpbnQgcmV3YXJkQW1vdW50CiAgICApIHsKICAgICAgICAoY29udHJhY3RBZGRyZXNzLCB0aW1lc3RhbXAsIGdhc0xpbWl0LCBnYXNQcmljZSwgaW52b2tlR2FzLCByZXdhcmRBbW91bnQpID0gam91bGUuZ2V0VG9wT25jZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE5leHRPbmNlKGFkZHJlc3MgX2NvbnRyYWN0QWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgdWludCBfdGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNMaW1pdCwKICAgICAgICAgICAgICAgICAgICAgdWludCBfZ2FzUHJpY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3MgY29udHJhY3RBZGRyZXNzLAogICAgICAgIHVpbnQgdGltZXN0YW1wLAogICAgICAgIHVpbnQgZ2FzTGltaXQsCiAgICAgICAgdWludCBnYXNQcmljZSwKICAgICAgICB1aW50IGludm9rZUdhcywKICAgICAgICB1aW50IHJld2FyZEFtb3VudAogICAgKSB7CiAgICAgICAgKGNvbnRyYWN0QWRkcmVzcywgdGltZXN0YW1wLCBnYXNMaW1pdCwgZ2FzUHJpY2UsIGludm9rZUdhcywgcmV3YXJkQW1vdW50KSA9IGpvdWxlLmdldE5leHRPbmNlKF9jb250cmFjdEFkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgIH0KCgogICAgZnVuY3Rpb24gZ2V0TmV4dCh1aW50IF9jb3VudCwKICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9jb250cmFjdEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgdWludCBfdGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc0xpbWl0LAogICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3NbXSBfYWRkcmVzc2VzLAogICAgICAgIHVpbnRbXSBfdGltZXN0YW1wcywKICAgICAgICB1aW50W10gX2dhc0xpbWl0cywKICAgICAgICB1aW50W10gX2dhc1ByaWNlcywKICAgICAgICB1aW50W10gX2ludm9rZUdhc2VzLAogICAgICAgIHVpbnRbXSBfcmV3YXJkQW1vdW50cwogICAgKSB7CiAgICAgICAgX2FkZHJlc3NlcyA9IG5ldyBhZGRyZXNzW10oX2NvdW50KTsKICAgICAgICBfdGltZXN0YW1wcyA9IG5ldyB1aW50W10oX2NvdW50KTsKICAgICAgICBfZ2FzTGltaXRzID0gbmV3IHVpbnRbXShfY291bnQpOwogICAgICAgIF9nYXNQcmljZXMgPSBuZXcgdWludFtdKF9jb3VudCk7CiAgICAgICAgX2ludm9rZUdhc2VzID0gbmV3IHVpbnRbXShfY291bnQpOwogICAgICAgIF9yZXdhcmRBbW91bnRzID0gbmV3IHVpbnRbXShfY291bnQpOwoKICAgICAgICB1aW50IGkgPSAwOwoKICAgICAgICAoX2FkZHJlc3Nlc1tpXSwgX3RpbWVzdGFtcHNbaV0sIF9nYXNMaW1pdHNbaV0sIF9nYXNQcmljZXNbaV0sIF9pbnZva2VHYXNlc1tpXSwgX3Jld2FyZEFtb3VudHNbaV0pID0gam91bGUuZ2V0TmV4dE9uY2UoX2NvbnRyYWN0QWRkcmVzcywgX3RpbWVzdGFtcCwgX2dhc0xpbWl0LCBfZ2FzUHJpY2UpOwoKICAgICAgICBmb3IgKGkgKz0gMTsgaSA8IF9jb3VudDsgaSArKykgewogICAgICAgICAgICBpZiAoX3RpbWVzdGFtcHNbaSAtIDFdID09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIChfYWRkcmVzc2VzW2ldLCBfdGltZXN0YW1wc1tpXSwgX2dhc0xpbWl0c1tpXSwgX2dhc1ByaWNlc1tpXSwgX2ludm9rZUdhc2VzW2ldLCBfcmV3YXJkQW1vdW50c1tpXSkgPSBqb3VsZS5nZXROZXh0T25jZShfYWRkcmVzc2VzW2kgLSAxXSwgX3RpbWVzdGFtcHNbaSAtIDFdLCBfZ2FzTGltaXRzW2kgLSAxXSwgX2dhc1ByaWNlc1tpIC0gMV0pOwogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gZ2V0VG9wKHVpbnQgX2NvdW50KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3NbXSBfYWRkcmVzc2VzLAogICAgICAgIHVpbnRbXSBfdGltZXN0YW1wcywKICAgICAgICB1aW50W10gX2dhc0xpbWl0cywKICAgICAgICB1aW50W10gX2dhc1ByaWNlcywKICAgICAgICB1aW50W10gX2ludm9rZUdhc2VzLAogICAgICAgIHVpbnRbXSBfcmV3YXJkQW1vdW50cwogICAgKSB7CiAgICAgICAgdWludCBsZW5ndGggPSBqb3VsZS5nZXRDb3VudCgpOwogICAgICAgIHVpbnQgYW1vdW50ID0gX2NvdW50IDw9IGxlbmd0aCA/IF9jb3VudCA6IGxlbmd0aDsKCiAgICAgICAgX2FkZHJlc3NlcyA9IG5ldyBhZGRyZXNzW10oYW1vdW50KTsKICAgICAgICBfdGltZXN0YW1wcyA9IG5ldyB1aW50W10oYW1vdW50KTsKICAgICAgICBfZ2FzTGltaXRzID0gbmV3IHVpbnRbXShhbW91bnQpOwogICAgICAgIF9nYXNQcmljZXMgPSBuZXcgdWludFtdKGFtb3VudCk7CiAgICAgICAgX2ludm9rZUdhc2VzID0gbmV3IHVpbnRbXShhbW91bnQpOwogICAgICAgIF9yZXdhcmRBbW91bnRzID0gbmV3IHVpbnRbXShhbW91bnQpOwoKICAgICAgICB1aW50IGkgPSAwOwoKICAgICAgICAoX2FkZHJlc3Nlc1tpXSwgX3RpbWVzdGFtcHNbaV0sIF9nYXNMaW1pdHNbaV0sIF9nYXNQcmljZXNbaV0sIF9pbnZva2VHYXNlc1tpXSwgX3Jld2FyZEFtb3VudHNbaV0pID0gam91bGUuZ2V0VG9wT25jZSgpOwoKICAgICAgICBmb3IgKGkgKz0gMTsgaSA8IGFtb3VudDsgaSArKykgewogICAgICAgICAgICAoX2FkZHJlc3Nlc1tpXSwgX3RpbWVzdGFtcHNbaV0sIF9nYXNMaW1pdHNbaV0sIF9nYXNQcmljZXNbaV0sIF9pbnZva2VHYXNlc1tpXSwgX3Jld2FyZEFtb3VudHNbaV0pID0gam91bGUuZ2V0TmV4dE9uY2UoX2FkZHJlc3Nlc1tpIC0gMV0sIF90aW1lc3RhbXBzW2kgLSAxXSwgX2dhc0xpbWl0c1tpIC0gMV0sIF9nYXNQcmljZXNbaSAtIDFdKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VmVyc2lvbigpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYnl0ZXM4KSB7CiAgICAgICAgcmV0dXJuIGpvdWxlLmdldFZlcnNpb24oKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNaW5HYXNQcmljZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gam91bGUubWluR2FzUHJpY2VHd2VpKCkgKiBHV0VJOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxiYWNrKGFkZHJlc3MgX2ludm9rZXIsIGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQsIHVpbnQgX2dhc0xpbWl0LCB1aW50KSBwdWJsaWMgb25seUpvdWxlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKG1zZy5nYXMgPj0gX2dhc0xpbWl0KTsKICAgICAgICB1aW50IGdhcyA9IG1zZy5nYXM7CiAgICAgICAgYm9vbCBzdGF0dXMgPSBfYWRkcmVzcy5jYWxsLmdhcyhfZ2FzTGltaXQpKDB4OTE5ODQwYWQpOwogICAgICAgIEludm9rZWQoX2ludm9rZXIsIF9hZGRyZXNzLCBzdGF0dXMsIGdhcyAtIG1zZy5nYXMpOwogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9Cn0='.
	

]
