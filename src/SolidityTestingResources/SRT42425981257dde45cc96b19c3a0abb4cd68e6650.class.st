Class {
	#name : #SRT42425981257dde45cc96b19c3a0abb4cd68e6650,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT42425981257dde45cc96b19c3a0abb4cd68e6650 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQHRpdGxlIEVSQzIwIEJhc2ljIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNGUyMzJmMjAzYjJiMjIyZjNjMmYyMTM0MGUyOTIzMmYyNzIyNjAyZDIxMjMiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgTGVuZ3RoVmFsaWRhdG9yIHNtYXJ0IGNvbnRyYWN0IC0gZml4IEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrCiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE4IE1jRmx5LmFlcm8KICogQGF1dGhvciBEbWl0cml5IEtoaXpoaW5za2l5CiAqIEBhdXRob3IgIk1JVCIKICovCmNvbnRyYWN0IExlbmd0aFZhbGlkYXRvciB7CiAgICBtb2RpZmllciB2YWxpZF9zaG9ydCh1aW50IF9jbnRBcmdzKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5kYXRhLmxlbmd0aCA9PSAoX2NudEFyZ3MgKiAzMiArIDQpKTsKICAgICAgICBfOwogICAgfQp9CgovKioKICogQHRpdGxlIE93bmFibGUgc21hcnQgY29udHJhY3QKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTYgU21hcnQgQ29udHJhY3QgU29sdXRpb25zLCBJbmMuCiAqIEBhdXRob3IgIk1hbnVlbCBBcmFveiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJmYTk3OWI5NDhmOWY5NjliODg5Yjk1ODBiYTlkOTc5YjkzOTZkNDk5OTU5NyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+IgogKiBAZGV2IGxpY2Vuc2U6ICJNSVQiLCBzb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogQGF1dGhvciBtb2RpZmljYXRpb246IERtaXRyaXkgS2hpemhpbnNraXkgQE1jRmx5LmFlcm8KICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIGNhbmRpZGF0ZTsKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCiAgICAvKioKICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAqIGFjY291bnQuCiAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBfcmVxdWVzdF8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICovCiAgICBmdW5jdGlvbiByZXF1ZXN0T3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY2FuZGlkYXRlID0gbmV3T3duZXI7CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEFsbG93cyB0aGUgX05FV18gY2FuZGlkYXRlIHRvIGNvbXBsZXRlIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGhpbS4KICAgICovCiAgICBmdW5jdGlvbiBjb25maXJtT3duZXJzaGlwKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBvd25lciA9IGNhbmRpZGF0ZTsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgY2FuZGlkYXRlKTsgICAgICAgIAogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBNdWx0aU93bmVycyBzbWFydCBjb250cmFjdAogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxOCBNY0ZseS5hZXJvCiAqIEBhdXRob3IgRG1pdHJpeSBLaGl6aGluc2tpeQogKiBAYXV0aG9yICJNSVQiCiAqLwpjb250cmFjdCBNdWx0aU93bmVycyB7CgogICAgZXZlbnQgQWNjZXNzR3JhbnQoYWRkcmVzcyBpbmRleGVkIG93bmVyKTsKICAgIGV2ZW50IEFjY2Vzc1Jldm9rZShhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwogICAgCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgb3duZXJzOwogICAgYWRkcmVzcyBwdWJsaWMgcHVibGlzaGVyOwoKCiAgICBmdW5jdGlvbiBNdWx0aU93bmVycygpIHB1YmxpYyB7CiAgICAgICAgb3duZXJzW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICBwdWJsaXNoZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7IAogICAgICAgIHJlcXVpcmUob3duZXJzW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87IAogICAgfQoKCiAgICBmdW5jdGlvbiBpc093bmVyKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gb3duZXJzW21zZy5zZW5kZXJdID8gdHJ1ZSA6IGZhbHNlOwogICAgfQoKCiAgICBmdW5jdGlvbiBjaGVja093bmVyKGFkZHJlc3MgbWF5YmVfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG93bmVyc1ttYXliZV9vd25lcl0gPyB0cnVlIDogZmFsc2U7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGdyYW50KGFkZHJlc3MgX293bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBvd25lcnNbX293bmVyXSA9IHRydWU7CiAgICAgICAgQWNjZXNzR3JhbnQoX293bmVyKTsKICAgIH0KCgogICAgZnVuY3Rpb24gcmV2b2tlKGFkZHJlc3MgX293bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9vd25lciAhPSBwdWJsaXNoZXIpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBfb3duZXIpOwoKICAgICAgICBvd25lcnNbX293bmVyXSA9IGZhbHNlOwogICAgICAgIEFjY2Vzc1Jldm9rZShfb3duZXIpOwogICAgfQp9CgoKCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMmI0NjRhNDU1ZTRlNDc0YTU5NGE0NDUxNmI0YzQ2NGE0MjQ3MDU0ODQ0NDYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIC8qKgogICAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCgogICAgLyoqCiAgICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgICAqLwogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgICAqLwogICAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgoKCgoKCgoKCgoKLyoqCiAqIEB0aXRsZSBCYXNpY1Rva2VuIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNzQxOTE1MWEwMTExMTgxNTA2MTUxYjBlMzQxMzE5MTUxZDE4NWExNzFiMTkiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqLwoKCgoKCgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMsIExlbmd0aFZhbGlkYXRvciB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgdWludDI1NiB0b3RhbFN1cHBseV87CgogICAgLyoqCiAgICAqIEBkZXYgdG90YWwgbnVtYmVyIG9mIHRva2VucyBpbiBleGlzdGVuY2UKICAgICovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlfOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB2YWxpZF9zaG9ydCgyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAgICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCn0KCgovKioKICogQHRpdGxlIEVSQzIwIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iZjY5Yjk3OTg4MzkzOWE5Nzg0OTc5OThjYjY5MTliOTc5ZjlhZDg5NTk5OWIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqLwoKCgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE2IFNtYXJ0IENvbnRyYWN0IFNvbHV0aW9ucywgSW5jLgogKiBAYXV0aG9yICJNYW51ZWwgQXJhb3ogPDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iODVlOGU0ZWJmMGUwZTllNGY3ZTRlYWZmYzVlMmU4ZTRlY2U5YWJlNmVhZTgiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiIKICogQGRldiBsaWNlbnNlOiAiTUlUIiwgc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIEBhdXRob3IgbW9kaWZpY2F0aW9uOiBEbWl0cml5IEtoaXpoaW5za2l5IEBNY0ZseS5hZXJvCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CiAgCiAgICAvKiogCiAgICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB2YWxpZF9zaG9ydCgzKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICAqCiAgICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSB2YWxpZF9zaG9ydCgyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICAqCiAgICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgICogQHBhcmFtIF9hZGRlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGluY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgKgogICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBkZWNyZW1lbnQKICAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICAqIEBwYXJhbSBfc3VidHJhY3RlZFZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlY3JlYXNlIHRoZSBhbGxvd2FuY2UgYnkuCiAgICAqLwogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgICAgIH0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbiBzbWFydCBjb250cmFjdAogKiBAYXV0aG9yIENvcHlyaWdodCAoYykgMjAxNiBTbWFydCBDb250cmFjdCBTb2x1dGlvbnMsIEluYy4KICogQGF1dGhvciAiTWFudWVsIEFyYW96IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjZhMDcwYjA0MWYwZjA2MGIxODBiMDUxMDJhMGQwNzBiMDMwNjQ0MDkwNTA3Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4iCiAqIEBkZXYgbGljZW5zZTogIk1JVCIsIHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eQogKiBAYXV0aG9yIG1vZGlmaWNhdGlvbjogRG1pdHJpeSBLaGl6aGluc2tpeSBATWNGbHkuYWVybwogKiBAZGV2IFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqIEBkZXYgSXNzdWU6ICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9pc3N1ZXMvMTIwCiAqIEJhc2VkIG9uIGNvZGUgYnkgVG9rZW5NYXJrZXROZXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvY29udHJhY3RzL01pbnRhYmxlVG9rZW4uc29sCiAqLwpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICAgIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKICAgIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICAgICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvKioKICAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAgKi8KICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIGNhbk1pbnQgdmFsaWRfc2hvcnQoMikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB0b3RhbFN1cHBseV8gPSB0b3RhbFN1cHBseV8uYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgICAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLyoqCiAgICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAgKi8KICAgIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICAgICAgTWludEZpbmlzaGVkKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCgovKioKICogQHRpdGxlIE1jRmx5IHRva2VuIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE4IE1jRmx5LmFlcm8KICogQGF1dGhvciBEbWl0cml5IEtoaXpoaW5za2l5CiAqIEBhdXRob3IgIk1JVCIKICovCmNvbnRyYWN0IE1jRmx5VG9rZW4gaXMgTWludGFibGVUb2tlbiB7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiTWNGbHlUb2tlbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJNY0ZseSI7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICAvLy8gQGRldiBtYXBwaW5nIGZvciB3aGl0ZWxpc3QKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgd2hpdGVsaXN0OwoKICAgIC8vLyBAZGV2IGV2ZW50IHRocm93IHdoZW4gYWxsb3dlZCB0byB0cmFuc2ZlciBhZGRyZXNzIGFkZGVkIHRvIHdoaXRlbGlzdAogICAgLy8vIEBwYXJhbSBmcm9tIGFkZHJlc3MKICAgIGV2ZW50IEFsbG93VHJhbnNmZXIoYWRkcmVzcyBmcm9tKTsKCiAgICAvLy8gQGRldiBjaGVjayBmb3IgYWxsb3dlbmNlIG9mIHRyYW5zZmVyCiAgICBtb2RpZmllciBjYW5UcmFuc2ZlcigpIHsKICAgICAgICByZXF1aXJlKG1pbnRpbmdGaW5pc2hlZCB8fCB3aGl0ZWxpc3RbbXNnLnNlbmRlcl0pOwogICAgICAgIF87ICAgICAgICAKICAgIH0KCiAgICAvLy8gQGRldiBhZGQgYWRkcmVzcyB0byB3aGl0ZWxpc3QKICAgIC8vLyBAcGFyYW0gZnJvbSBhZGRyZXNzIHRvIGFkZAogICAgZnVuY3Rpb24gYWxsb3dUcmFuc2ZlcihhZGRyZXNzIGZyb20pIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHdoaXRlbGlzdFtmcm9tXSA9IHRydWU7CiAgICAgICAgQWxsb3dUcmFuc2Zlcihmcm9tKTsKICAgIH0KCiAgICAvLy8gQGRldiBEbyB0aGUgdHJhbnNmZXIgZnJvbSBhZGRyZXNzIHRvIGFkZHJlc3MgdmFsdWUKICAgIC8vLyBAcGFyYW0gZnJvbSBhZGRyZXNzIGZyb20KICAgIC8vLyBAcGFyYW0gdG8gYWRkcmVzcyB0bwogICAgLy8vIEBwYXJhbSB2YWx1ZSB1aW50MjU2CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBjYW5UcmFuc2ZlciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICAgIH0KCiAgICAvLy8gQGRldiBEbyB0aGUgdHJhbnNmZXIgZnJvbSB0b2tlbiBhZGRyZXNzIHRvICJ0byIgYWRkcmVzcyB2YWx1ZQogICAgLy8vIEBwYXJhbSB0byBhZGRyZXNzIHRvCiAgICAvLy8gQHBhcmFtIHZhbHVlIHVpbnQyNTYgdmFsdWUKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGNhblRyYW5zZmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKHRvLCB2YWx1ZSk7CiAgICB9Cn0KCgoKCgoKCi8qKgogKiBAdGl0bGUgSGFsdGFibGUgc21hcnQgY29udHJhY3QgLSBjb250cm9scyBvd25lciBhY2Nlc3MKICogQGF1dGhvciBDb3B5cmlnaHQgKGMpIDIwMTggTWNGbHkuYWVybwogKiBAYXV0aG9yIERtaXRyaXkgS2hpemhpbnNraXkKICogQGF1dGhvciAiTUlUIgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgTXVsdGlPd25lcnMgewogICAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICAgIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICAgICAgcmVxdWlyZSghaGFsdGVkKTsKICAgICAgICBfOwogICAgfQoKCiAgICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgewogICAgICAgIHJlcXVpcmUoaGFsdGVkKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLy8gQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgaGFsdGVkID0gdHJ1ZTsKICAgIH0KCgogICAgLy8vIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICAgICAgaGFsdGVkID0gZmFsc2U7CiAgICB9Cgp9CgoKCi8qKgogKiBAdGl0bGUgTWNGbHkgY3Jvd2RzYWxlIHNtYXJ0IGNvbnRyYWN0CiAqIEBhdXRob3IgQ29weXJpZ2h0IChjKSAyMDE4IE1jRmx5LmFlcm8KICogQGF1dGhvciBEbWl0cml5IEtoaXpoaW5za2l5CiAqIEBhdXRob3IgIk1JVCIKICogQGRldiBpbmhlcml0ZWQgZnJvbSBNdWx0aU93bmVycyAmIEhhbHRhYmxlCiAqLwpjb250cmFjdCBNY0ZseUNyb3dkIGlzIE11bHRpT3duZXJzLCBIYWx0YWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLy8gQGRldiBUb3RhbCBFVEggcmVjZWl2ZWQgZHVyaW5nIFdBVkVTLCBUTFAxLjIgJiB3aW5kb3dbMS01XQogICAgdWludDI1NiBwdWJsaWMgY291bnRlcl9pbjsgLy8gdGxwMgogICAgCiAgICAvLy8gQGRldiBtaW5pbXVtIEVUSCB0byBwYXJ0aXNpcGF0ZSBpbiB3aW5kb3cgMS01CiAgICB1aW50MjU2IHB1YmxpYyBtaW5FVEhpbiA9IDFlMTg7IC8vIDEgRVRICgogICAgLy8vIEBkZXYgVG9rZW4KICAgIE1jRmx5VG9rZW4gcHVibGljIHRva2VuOwoKICAgIC8vLyBAZGV2IFdpdGhkcmF3IHdhbGxldAogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAgIC8vLyBAZGV2IHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wIGZvciBUTFAgMS4yLCBvdGhlciB2YWx1ZXMgY2FsbGN1bGF0ZWQKICAgIHVpbnQyNTYgcHVibGljIHNUMjsgLy8gc3RhcnRUaW1lVExQMgogICAgdWludDI1NiBjb25zdGFudCBkVExQMiA9IDExOCBkYXlzOyAvLyBkYXlzIG9mIFRMUDIKICAgIHVpbnQyNTYgY29uc3RhbnQgZEJ0ID0gNjAgZGF5czsgLy8gZGF5cyBiZXR3ZWVuIFdpbmRvd3MKICAgIHVpbnQyNTYgY29uc3RhbnQgZFcgPSAxMiBkYXlzOyAvLyAxMiBkYXlzIGZvciAzLDQsNSw2LDcgd2luZG93czsKCiAgICAvLy8gQGRldiBDYXAgbWF4aW11bSBwb3NzaWJsZSB0b2tlbnMgZm9yIG1pbnRpbmcKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IGhhcmRDYXBJblRva2VucyA9IDE4MDBlMjQ7IC8vIDEsODAwLDAwMCwwMDAgTUZMCgogICAgLy8vIEBkZXYgbWF4aW11bSBwb3NzaWJsZSB0b2tlbnMgZm9yIHNlbGwgCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBtaW50Q2FwSW5Ub2tlbnMgPSAxMjYwZTI0OyAvLyAxLDI2MCwwMDAsMDAwIE1GTAoKICAgIC8vLyBAZGV2IHRva2VucyBjcm93ZCB3aXRoaW4gVExQMgogICAgdWludDI1NiBwdWJsaWMgY3Jvd2RUb2tlbnNUTFAyOwoKICAgIC8vLyBAZGV2IHRva2VucyBjcm93ZCBiZWZvcmUgdGhpcyBjb250cmFjdCAoTUZMIHRva2VucykKICAgIHVpbnQyNTYgcHJlTWNGbHlUb3RhbFN1cHBseTsKCiAgICAvLy8gQGRldiBtYXhpbXVtIHBvc3NpYmxlIHRva2VucyBmb3IgZnVuZCBtaW50aW5nCiAgICB1aW50MjU2IGNvbnN0YW50IGZ1bmRUb2tlbnMgPSAyNzBlMjQ7IC8vIDI3MCwwMDAsMDAwIE1GTAogICAgdWludDI1NiBwdWJsaWMgZnVuZFRvdGFsU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgZnVuZE1pbnRpbmdBZ2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgLy8vIEBkZXYgbWF4aW11bSBwb3NzaWJsZSB0b2tlbnMgdG8gY29udmVydCBmcm9tIFdBVkVTCiAgICB1aW50MjU2IHdhdmVzVG9rZW5zID0gMTAwZTI0OyAvLyAxMDAsMDAwLDAwMCBNRkwKICAgIGFkZHJlc3MgcHVibGljIHdhdmVzQWdlbnQ7CiAgICBhZGRyZXNzIHB1YmxpYyB3YXZlc0dXOwoKICAgIC8vLyBAZGV2IFZlc3RpbmcgcGFyYW0gZm9yIHRlYW0sIGFkdmlzb3J5LCByZXNlcnZlLgogICAgdWludDI1NiBWZXN0aW5nUGVyaW9kSW5TZWNvbmRzID0gMzAgZGF5czsgLy8gMjQgbW9udGgKICAgIHVpbnQyNTYgVmVzdGluZ1BlcmlvZHNDb3VudCA9IDI0OwoKICAgIC8vLyBAZGV2IFRlYW0gMTAlCiAgICB1aW50MjU2IF90ZWFtVG9rZW5zOwogICAgdWludDI1NiBwdWJsaWMgdGVhbVRvdGFsU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgdGVhbVdhbGxldDsKCiAgICAvLy8gQGRldiBCb3VudHkgNSUgKDIlICsgMyUpCiAgICAvLy8gQGRldiBCb3VudHkgb25saW5lIDIlCiAgICB1aW50MjU2IF9ib3VudHlPbmxpbmVUb2tlbnM7CiAgICBhZGRyZXNzIHB1YmxpYyBib3VudHlPbmxpbmVXYWxsZXQ7CiAgICBhZGRyZXNzIHB1YmxpYyBib3VudHlPbmxpbmVHVzsKCiAgICAvLy8gQGRldiBCb3VudHkgb2ZmbGluZSAzJQogICAgdWludDI1NiBfYm91bnR5T2ZmbGluZVRva2VuczsKICAgIGFkZHJlc3MgcHVibGljIGJvdW50eU9mZmxpbmVXYWxsZXQ7CgogICAgLy8vIEBkZXYgQWR2aXNvcnkgNSUKICAgIHVpbnQyNTYgX2Fkdmlzb3J5VG9rZW5zOwogICAgdWludDI1NiBwdWJsaWMgYWR2aXNvcnlUb3RhbFN1cHBseTsKICAgIGFkZHJlc3MgcHVibGljIGFkdmlzb3J5V2FsbGV0OwoKICAgIC8vLyBAZGV2IFJlc2VydmVkIGZvciBmdXR1cmUgOSUKICAgIHVpbnQyNTYgX3Jlc2VydmVkVG9rZW5zOwogICAgdWludDI1NiBwdWJsaWMgcmVzZXJ2ZWRUb3RhbFN1cHBseTsKICAgIGFkZHJlc3MgcHVibGljIHJlc2VydmVkV2FsbGV0OwoKICAgIC8vLyBAZGV2IEFpckRyb3AgMSUKICAgIHVpbnQyNTYgX2FpcmRyb3BUb2tlbnM7CiAgICBhZGRyZXNzIHB1YmxpYyBhaXJkcm9wV2FsbGV0OwogICAgYWRkcmVzcyBwdWJsaWMgYWlyZHJvcEdXOwoKICAgIC8vLyBAZGV2IFByZU1jRmx5IHdhbGxldCAoTUZMKQogICAgdWludDI1NiBfcHJlTWNGbHlUb2tlbnM7CiAgICBhZGRyZXNzIHB1YmxpYyBwcmVNY0ZseVdhbGxldDsKCiAgICAvLy8gQGRldiBQcGwgc3RydWN0dXJlIGZvciBXaW4xLTUKICAgIHN0cnVjdCBQcGwgewogICAgICAgIGFkZHJlc3MgYWRkcjsKICAgICAgICB1aW50MjU2IGFtb3VudDsKICAgIH0KICAgIG1hcHBpbmcgKHVpbnQzMiA9PiBQcGwpIHB1YmxpYyBwcGxzOwoKICAgIC8vLyBAZGV2IFdpbmRvdyBzdHJ1Y3R1cmUgZm9yIFdpbjEtNQogICAgc3RydWN0IFdpbmRvdyB7CiAgICAgICAgYm9vbCBhY3RpdmU7CiAgICAgICAgdWludDI1NiB0b3RhbEV0aEluV2luZG93OwogICAgICAgIHVpbnQzMiB0b3RhbFRyYW5zQ250OwogICAgICAgIHVpbnQzMiByZWZ1bmRJbmRleDsKICAgICAgICB1aW50MjU2IHRva2VuUGVyV2luZG93OwogICAgfSAKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IFdpbmRvdykgcHVibGljIHd3OwoKCiAgICAvLy8gQGRldiBFdmVudHMKICAgIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBUb2tlblB1cmNoYXNlSW5XaW5kb3coYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50OCB3aW5udW0sIHVpbnQzMiB0b3RhbGNudCwgdWludDI1NiB0b3RhbGV0aDEpOwogICAgZXZlbnQgVHJhbnNmZXJPZGRFdGhlcihhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgRnVuZE1pbnRpbmcoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IFdpdGhkcmF3VmVzdGluZyhhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgcGVyaW9kLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZhbHVlVG90YWwpOwogICAgZXZlbnQgVG9rZW5XaXRoZHJhd0F0V2luZG93KGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBTZXRGdW5kTWludGluZ0FnZW50KGFkZHJlc3MgbmV3QWdlbnQpOwogICAgZXZlbnQgU2V0VGVhbVdhbGxldChhZGRyZXNzIG5ld1RlYW1XYWxsZXQpOwogICAgZXZlbnQgU2V0QWR2aXNvcnlXYWxsZXQoYWRkcmVzcyBuZXdBZHZpc29yeVdhbGxldCk7CiAgICBldmVudCBTZXRSZXNlcnZlZFdhbGxldChhZGRyZXNzIG5ld1Jlc2VydmVkV2FsbGV0KTsKICAgIGV2ZW50IFNldFN0YXJ0VGltZVRMUDIodWludDI1NiBuZXdTdGFydFRpbWVUTFAyKTsKICAgIGV2ZW50IFNldE1pbkVUSGluY29tZSh1aW50MjU2IG5ld01pbkVUSGluKTsKICAgIGV2ZW50IE5ld1dpbmRvdyh1aW50OCB3aW5OdW0sIHVpbnQyNTYgYW1vdW50VG9rZW5zUGVyV2luKTsKICAgIGV2ZW50IFRva2VuRVRIKHVpbnQyNTYgdG90YWxFdGgsIHVpbnQzMiB0b3RhbENudCk7CgoKICAgIC8vLyBAZGV2IGNoZWNrIGZvciBOb24gemVybyB2YWx1ZQogICAgbW9kaWZpZXIgdmFsaWRQdXJjaGFzZSgpIHsKICAgICAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgICAgIHJlcXVpcmUobm9uWmVyb1B1cmNoYXNlKTsKICAgICAgICBfOyAgICAgICAgCiAgICB9CgogICAgLy8gY29tbWVudCB0aGlzIGZ1bmN0aW9ucyBhZnRlciB0ZXN0IHBhc3NlZCAhIQogICAgLypmdW5jdGlvbiBnZXRQcGxzKHVpbnQzMiBpbmRleCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKHBwbHNbaW5kZXhdLmFtb3VudCk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRQcGxzQWRkcih1aW50MzIgaW5kZXgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIChwcGxzW2luZGV4XS5hZGRyKTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFd0b3RhbEV0aCh1aW50OCB3aW5OdW0pIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuICh3d1t3aW5OdW1dLnRvdGFsRXRoSW5XaW5kb3cpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0V3Rva2VuKHVpbnQ4IHdpbk51bSkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKHd3W3dpbk51bV0udG9rZW5QZXJXaW5kb3cpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0V2FjdGl2ZSh1aW50OCB3aW5OdW0pIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuICh3d1t3aW5OdW1dLmFjdGl2ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRXdG90YWxUcmFuc0NudCh1aW50OCB3aW5OdW0pIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MzIpIHsKICAgICAgICByZXR1cm4gKHd3W3dpbk51bV0udG90YWxUcmFuc0NudCk7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRXcmVmdW5kSW5kZXgodWludDggd2luTnVtKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDMyKSB7CiAgICAgICAgcmV0dXJuICh3d1t3aW5OdW1dLnJlZnVuZEluZGV4KTsKICAgIH0qLwogICAgLy8gRU5EIGNvbW1lbnQgdGhpcyBmdW5jdGlvbnMgYWZ0ZXIgdGVzdCBwYXNzZWQgISEKCgogICAgLyoqCiAgICAgKiBAZGV2IGNvbmN0cnVjdG9yIG9mIGNvbnRyYWN0LCBzZXQgbWFpbiBwYXJhbXMsIGNyZWF0ZSBuZXcgdG9rZW4sIGRvIG1pbnRpbmcgZm9yIHNvbWUgd2FsbGV0cwogICAgICogQHBhcmFtIF9zdGFydFRpbWVUTFAyIC0gc2V0IGRhdGUgdGltZSBvZiBzdGFydGluZyBvZiBUTFAyIChtYWluIGRhdGUhKQogICAgICogQHBhcmFtIF9wcmVNY0ZseVRvdGFsU3VwcGx5IC0gc2V0IGFtb3VudCBpbiB3ZWkgdG90YWwgc3VwcGx5IG9mIHByZXZpb3VzZSBjb250cmFjdCAoTUZMKQogICAgICogQHBhcmFtIF93YWxsZXQgLSB3YWxsZXQgZm9yIHRyYW5zZmVyIEVUSCB0byBpdAogICAgICogQHBhcmFtIF93YXZlc0FnZW50IC0gd2FsbGV0IGZvciBXQVZFUyBndwogICAgICogQHBhcmFtIF93YXZlc0dXICAgIC0gd2FsbGV0IGZvciBXQVZFUyBndwogICAgICogQHBhcmFtIF9mdW5kTWludGluZ0FnZW50IC0gd2FsbGV0IHdobyBhbGxvd2VkIHRvIG1pbnQgYmVmb3JlIFRMUDIKICAgICAqIEBwYXJhbSBfdGVhbVdhbGxldCAtIHdhbGxldCBmb3IgdGVhbSB2ZXN0aW5nCiAgICAgKiBAcGFyYW0gX2JvdW50eU9ubGluZVdhbGxldCAtIHdhbGxldCBmb3Igb25saW5lIGJvdW50eQogICAgICogQHBhcmFtIF9ib3VudHlPbmxpbmVHVyAtIHdhbGxldCBmb3Igb25saW5lIGJvdW50eSBHVwogICAgICogQHBhcmFtIF9ib3VudHlPZmZsaW5lV2FsbGV0IC0gd2FsbGV0IGZvciBvZmZsaW5lIGJvdW50eQogICAgICogQHBhcmFtIF9hZHZpc29yeVdhbGxldCAtIHdhbGxldCBmb3IgYWR2aXNvcnkgdmVzdGluZwogICAgICogQHBhcmFtIF9yZXNlcnZlZFdhbGxldCAtIHdhbGxldCBmb3IgcmVzZXJ2ZWQgdmVzdGluZwogICAgICogQHBhcmFtIF9haXJkcm9wV2FsbGV0IC0gd2FsbGV0IGZvciBhaXJkcm9wCiAgICAgKiBAcGFyYW0gX2FpcmRyb3BHVyAtIHdhbGxldCBmb3IgYWlyZHJvcCBHVwogICAgICogQHBhcmFtIF9wcmVNY0ZseVdhbGxldCAtIHdhbGxldCBmb3IgdHJhbnNmZXIgb2xkIE1GTC0+TWNGbHkgKG9uY2UpCiAgICAgKi8KICAgIGZ1bmN0aW9uIE1jRmx5Q3Jvd2QoCiAgICAgICAgdWludDI1NiBfc3RhcnRUaW1lVExQMiwKICAgICAgICB1aW50MjU2IF9wcmVNY0ZseVRvdGFsU3VwcGx5LAogICAgICAgIGFkZHJlc3MgX3dhbGxldCwKICAgICAgICBhZGRyZXNzIF93YXZlc0FnZW50LAogICAgICAgIGFkZHJlc3MgX3dhdmVzR1csCiAgICAgICAgYWRkcmVzcyBfZnVuZE1pbnRpbmdBZ2VudCwKICAgICAgICBhZGRyZXNzIF90ZWFtV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2JvdW50eU9ubGluZVdhbGxldCwKICAgICAgICBhZGRyZXNzIF9ib3VudHlPbmxpbmVHVywKICAgICAgICBhZGRyZXNzIF9ib3VudHlPZmZsaW5lV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2Fkdmlzb3J5V2FsbGV0LAogICAgICAgIGFkZHJlc3MgX3Jlc2VydmVkV2FsbGV0LAogICAgICAgIGFkZHJlc3MgX2FpcmRyb3BXYWxsZXQsCiAgICAgICAgYWRkcmVzcyBfYWlyZHJvcEdXLAogICAgICAgIGFkZHJlc3MgX3ByZU1jRmx5V2FsbGV0CiAgICApIHB1YmxpYyAKICAgIHsgICAKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWVUTFAyID49IGJsb2NrLnRpbWVzdGFtcCk7CiAgICAgICAgcmVxdWlyZShfcHJlTWNGbHlUb3RhbFN1cHBseSA+IDApOwogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3dhdmVzQWdlbnQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF93YXZlc0dXICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfZnVuZE1pbnRpbmdBZ2VudCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3RlYW1XYWxsZXQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9ib3VudHlPbmxpbmVXYWxsZXQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9ib3VudHlPbmxpbmVHVyAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX2JvdW50eU9mZmxpbmVXYWxsZXQgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9hZHZpc29yeVdhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3Jlc2VydmVkV2FsbGV0ICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfYWlyZHJvcFdhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX2FpcmRyb3BHVyAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3ByZU1jRmx5V2FsbGV0ICE9IDB4MCk7CgogICAgICAgIHRva2VuID0gbmV3IE1jRmx5VG9rZW4oKTsKCiAgICAgICAgd2FsbGV0ID0gX3dhbGxldDsKCiAgICAgICAgc1QyID0gX3N0YXJ0VGltZVRMUDI7CiAgICAgICAgc2V0U3RhcnRFbmRUaW1lVExQKF9zdGFydFRpbWVUTFAyKTsKCiAgICAgICAgd2F2ZXNBZ2VudCA9IF93YXZlc0FnZW50OwogICAgICAgIHdhdmVzR1cgPSBfd2F2ZXNHVzsKCiAgICAgICAgZnVuZE1pbnRpbmdBZ2VudCA9IF9mdW5kTWludGluZ0FnZW50OwoKICAgICAgICB0ZWFtV2FsbGV0ID0gX3RlYW1XYWxsZXQ7CiAgICAgICAgYm91bnR5T25saW5lV2FsbGV0ID0gX2JvdW50eU9ubGluZVdhbGxldDsKICAgICAgICBib3VudHlPbmxpbmVHVyA9IF9ib3VudHlPbmxpbmVHVzsKICAgICAgICBib3VudHlPZmZsaW5lV2FsbGV0ID0gX2JvdW50eU9mZmxpbmVXYWxsZXQ7CiAgICAgICAgYWR2aXNvcnlXYWxsZXQgPSBfYWR2aXNvcnlXYWxsZXQ7CiAgICAgICAgcmVzZXJ2ZWRXYWxsZXQgPSBfcmVzZXJ2ZWRXYWxsZXQ7CiAgICAgICAgYWlyZHJvcFdhbGxldCA9IF9haXJkcm9wV2FsbGV0OwogICAgICAgIGFpcmRyb3BHVyA9IF9haXJkcm9wR1c7CiAgICAgICAgcHJlTWNGbHlXYWxsZXQgPSBfcHJlTWNGbHlXYWxsZXQ7CgogICAgICAgIC8vLyBAZGV2IE1pbnQgYWxsIHRva2VucyBhbmQgdGhhbiBjb250cm9sIGl0IGJ5IHZlc3RpbmcKICAgICAgICBfcHJlTWNGbHlUb2tlbnMgPSBfcHJlTWNGbHlUb3RhbFN1cHBseTsgLy8gTWNGbHkgZm9yIHRoYW5zZmVyIHRvIG9sZCBNRkwgb3duZXJzCiAgICAgICAgdG9rZW4ubWludChwcmVNY0ZseVdhbGxldCwgX3ByZU1jRmx5VG9rZW5zKTsKICAgICAgICB0b2tlbi5hbGxvd1RyYW5zZmVyKHByZU1jRmx5V2FsbGV0KTsKICAgICAgICBjcm93ZFRva2Vuc1RMUDIgPSBjcm93ZFRva2Vuc1RMUDIuYWRkKF9wcmVNY0ZseVRva2Vucyk7CgogICAgICAgIHRva2VuLm1pbnQod2F2ZXNBZ2VudCwgd2F2ZXNUb2tlbnMpOyAvLyAxMDAsMDAwLDAwMCBNRkwKICAgICAgICB0b2tlbi5hbGxvd1RyYW5zZmVyKHdhdmVzQWdlbnQpOwogICAgICAgIHRva2VuLmFsbG93VHJhbnNmZXIod2F2ZXNHVyk7CiAgICAgICAgY3Jvd2RUb2tlbnNUTFAyID0gY3Jvd2RUb2tlbnNUTFAyLmFkZCh3YXZlc1Rva2Vucyk7CgogICAgICAgIF90ZWFtVG9rZW5zID0gMTgwZTI0OyAvLyAxODAsMDAwLDAwMCBNRkwKICAgICAgICB0b2tlbi5taW50KHRoaXMsIF90ZWFtVG9rZW5zKTsgLy8gbWludCB0byBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIF9ib3VudHlPbmxpbmVUb2tlbnMgPSAzNmUyNDsgLy8gMzYsMDAwLDAwMCBNRkwKICAgICAgICB0b2tlbi5taW50KGJvdW50eU9ubGluZVdhbGxldCwgX2JvdW50eU9ubGluZVRva2Vucyk7CiAgICAgICAgdG9rZW4uYWxsb3dUcmFuc2Zlcihib3VudHlPbmxpbmVXYWxsZXQpOwogICAgICAgIHRva2VuLmFsbG93VHJhbnNmZXIoYm91bnR5T25saW5lR1cpOwoKICAgICAgICBfYm91bnR5T2ZmbGluZVRva2VucyA9IDU0ZTI0OyAvLyA1NCwwMDAsMDAwIE1GTAogICAgICAgIHRva2VuLm1pbnQoYm91bnR5T2ZmbGluZVdhbGxldCwgX2JvdW50eU9mZmxpbmVUb2tlbnMpOwogICAgICAgIHRva2VuLmFsbG93VHJhbnNmZXIoYm91bnR5T2ZmbGluZVdhbGxldCk7CgogICAgICAgIF9hZHZpc29yeVRva2VucyA9IDkwZTI0OyAvLyA5MCwwMDAsMDAwIE1GTAogICAgICAgIHRva2VuLm1pbnQodGhpcywgX2Fkdmlzb3J5VG9rZW5zKTsKCiAgICAgICAgX3Jlc2VydmVkVG9rZW5zID0gMTYyZTI0OyAvLyAxNjIsMDAwLDAwMCBNRkwKICAgICAgICB0b2tlbi5taW50KHRoaXMsIF9yZXNlcnZlZFRva2Vucyk7CgogICAgICAgIF9haXJkcm9wVG9rZW5zID0gMThlMjQ7IC8vIDE4LDAwMCwwMDAgTUZMCiAgICAgICAgdG9rZW4ubWludChhaXJkcm9wV2FsbGV0LCBfYWlyZHJvcFRva2Vucyk7CiAgICAgICAgdG9rZW4uYWxsb3dUcmFuc2ZlcihhaXJkcm9wV2FsbGV0KTsKICAgICAgICB0b2tlbi5hbGxvd1RyYW5zZmVyKGFpcmRyb3BHVyk7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBjaGVjayBpcyBUTFAyIGlzIGFjdGl2ZT8KICAgICAqIEByZXR1cm4gZmFsc2UgaWYgY3Jvd2QgVExQMiBldmVudCB3YXMgZW5kZWQKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGluUGVyaW9kKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHdpdGhpblBlcmlvZFRMUDIgPSAobm93ID49IHNUMiAmJiBub3cgPD0gKHNUMitkVExQMikpOwogICAgICAgIHJldHVybiB3aXRoaW5QZXJpb2RUTFAyOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgY2hlY2sgaXMgVExQMiBpcyBhY3RpdmUgYW5kIG1pbnRpbmcgTm90IGZpbmlzaGVkCiAgICAgKiBAcmV0dXJuIGZhbHNlIGlmIGNyb3dkIGV2ZW50IHdhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBydW5uaW5nKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gd2l0aGluUGVyaW9kKCkgJiYgIXRva2VuLm1pbnRpbmdGaW5pc2hlZCgpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgY2hlY2sgY3VycmVudCBzdGFnZSBuYW1lCiAgICAgKiBAcmV0dXJuIHVpbnQ4IHN0YWdlIG51bWJlcgogICAgICovCiAgICBmdW5jdGlvbiBzdGFnZU5hbWUoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDgpIHsKICAgICAgICB1aW50MjU2IGVUMiA9IHNUMitkVExQMjsKCiAgICAgICAgaWYgKG5vdyA8IHNUMikge3JldHVybiAxMDE7fSAvLyBub3Qgc3RhcnRlZAogICAgICAgIGlmIChub3cgPj0gc1QyICYmIG5vdyA8PSBlVDIpIHtyZXR1cm4gKDEwMik7fSAvLyBUTFAxLjIKCiAgICAgICAgaWYgKG5vdyA+IGVUMiAmJiBub3cgPCBlVDIrZEJ0KSB7cmV0dXJuICgxMDMpO30gLy8gcHJlVExQMS4zCiAgICAgICAgaWYgKG5vdyA+PSAoZVQyK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXKSkge3JldHVybiAoMCk7fSAvLyBUTFAxLjMKICAgICAgICBpZiAobm93ID4gKGVUMitkQnQrZFcpICYmIG5vdyA8IChlVDIrZEJ0K2RXK2RCdCkpIHtyZXR1cm4gKDEwNCk7fSAvLyBwcmVUTFAxLjQKICAgICAgICBpZiAobm93ID49IChlVDIrZEJ0K2RXK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXK2RCdCtkVykpIHtyZXR1cm4gKDEpO30gLy8gVExQMS40CiAgICAgICAgaWYgKG5vdyA+IChlVDIrZEJ0K2RXK2RCdCtkVykgJiYgbm93IDwgKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCkpIHtyZXR1cm4gKDEwNSk7fSAvLyBwcmVUTFAxLjUKICAgICAgICBpZiAobm93ID49IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQpICYmIG5vdyA8PSAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXKSkge3JldHVybiAoMik7fSAvLyBUTFAxLjUKICAgICAgICBpZiAobm93ID4gKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVykgJiYgbm93IDwgKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQpKSB7cmV0dXJuICgxMDYpO30gLy8gcHJlVExQMS42CiAgICAgICAgaWYgKG5vdyA+PSAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXKSkge3JldHVybiAoMyk7fSAvLyBUTFAxLjYKICAgICAgICBpZiAobm93ID4gKGVUMitkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQrZFcpICYmIG5vdyA8IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCkpIHtyZXR1cm4gKDEwNyk7fSAvLyBwcmVUTFAxLjcKICAgICAgICBpZiAobm93ID49IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCkgJiYgbm93IDw9IChlVDIrZEJ0K2RXK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCtkVykpIHtyZXR1cm4gKDQpO30gLy8gVExQMS43IgogICAgICAgIGlmIChub3cgPiAoZVQyK2RCdCtkVytkQnQrZFcrZEJ0K2RXK2RCdCtkVytkQnQrZFcpKSB7cmV0dXJuICgyMDApO30gLy8gRmluaXNoZWQKICAgICAgICByZXR1cm4gKDIwMSk7IC8vIHVua25vd24KICAgIH0KCgogICAgLyoqIAogICAgICogQGRldiBjaGFuZ2UgYWdlbnQgZm9yIG1pbnRpbmcKICAgICAqIEBwYXJhbSBhZ2VudCAtIG5ldyBhZ2VudCBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldEZ1bmRNaW50aW5nQWdlbnQoYWRkcmVzcyBhZ2VudCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgZnVuZE1pbnRpbmdBZ2VudCA9IGFnZW50OwogICAgICAgIFNldEZ1bmRNaW50aW5nQWdlbnQoYWdlbnQpOwogICAgfQoKCiAgICAvKiogCiAgICAgKiBAZGV2IGNoYW5nZSB3YWxsZXQgZm9yIHRlYW0gdmVzdGluZyAodGhpcyBtYWtlIHBvc3NpYmxlIHRvIHNldCBzbWFydC1jb250cmFjdCBhZGRyZXNzIGxhdGVyKQogICAgICogQHBhcmFtIF9uZXdUZWFtV2FsbGV0IC0gbmV3IHdhbGxldCBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFRlYW1XYWxsZXQoYWRkcmVzcyBfbmV3VGVhbVdhbGxldCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgdGVhbVdhbGxldCA9IF9uZXdUZWFtV2FsbGV0OwogICAgICAgIFNldFRlYW1XYWxsZXQoX25ld1RlYW1XYWxsZXQpOwogICAgfQoKCiAgICAvKiogCiAgICAgKiBAZGV2IGNoYW5nZSB3YWxsZXQgZm9yIGFkdmlzb3J5IHZlc3RpbmcgKHRoaXMgbWFrZSBwb3NzaWJsZSB0byBzZXQgc21hcnQtY29udHJhY3QgYWRkcmVzcyBsYXRlcikKICAgICAqIEBwYXJhbSBfbmV3QWR2aXNvcnlXYWxsZXQgLSBuZXcgd2FsbGV0IGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gc2V0QWR2aXNvcnlXYWxsZXQoYWRkcmVzcyBfbmV3QWR2aXNvcnlXYWxsZXQpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIGFkdmlzb3J5V2FsbGV0ID0gX25ld0Fkdmlzb3J5V2FsbGV0OwogICAgICAgIFNldEFkdmlzb3J5V2FsbGV0KF9uZXdBZHZpc29yeVdhbGxldCk7CiAgICB9CgoKICAgIC8qKiAKICAgICAqIEBkZXYgY2hhbmdlIHdhbGxldCBmb3IgcmVzZXJ2ZWQgdmVzdGluZyAodGhpcyBtYWtlIHBvc3NpYmxlIHRvIHNldCBzbWFydC1jb250cmFjdCBhZGRyZXNzIGxhdGVyKQogICAgICogQHBhcmFtIF9uZXdSZXNlcnZlZFdhbGxldCAtIG5ldyB3YWxsZXQgYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBzZXRSZXNlcnZlZFdhbGxldChhZGRyZXNzIF9uZXdSZXNlcnZlZFdhbGxldCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVzZXJ2ZWRXYWxsZXQgPSBfbmV3UmVzZXJ2ZWRXYWxsZXQ7CiAgICAgICAgU2V0UmVzZXJ2ZWRXYWxsZXQoX25ld1Jlc2VydmVkV2FsbGV0KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNoYW5nZSBtaW4gRVRIIGluY29tZSBkdXJpbmcgV2luZG93MS01CiAgICAgKiBAcGFyYW0gX21pbkVUSGluIC0gbmV3IGxpbWl0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldE1pbkVUSGluKHVpbnQyNTYgX21pbkVUSGluKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBtaW5FVEhpbiA9IF9taW5FVEhpbjsKICAgICAgICBTZXRNaW5FVEhpbmNvbWUoX21pbkVUSGluKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHNldCBUTFAxLlggKDItNykgc3RhcnQgJiBlbmQgZGF0ZXMKICAgICAqIEBwYXJhbSBfYXQgLSBuZXcgb3Igb2xkIHN0YXJ0IGRhdGUKICAgICAqLwogICAgZnVuY3Rpb24gc2V0U3RhcnRFbmRUaW1lVExQKHVpbnQyNTYgX2F0KSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IHNUMik7IC8vIGZvcmJpZCBjaGFuZ2UgdGltZSB3aGVuIFRMUDEuMiBpcyBhY3RpdmUKICAgICAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IF9hdCk7IC8vIHNob3VsZCBiZSBncmVhdCB0aGFuIGN1cnJlbnQgYmxvY2sgdGltZXN0YW1wCgogICAgICAgIHNUMiA9IF9hdDsKICAgICAgICBTZXRTdGFydFRpbWVUTFAyKF9hdCk7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBMYXJnZSBUb2tlbiBIb2xkZXIgbWludGluZyAKICAgICAqIEBwYXJhbSB0byAtIG1pbnQgdG8gYWRkcmVzcwogICAgICogQHBhcmFtIGFtb3VudCAtIGhvdyBtdWNoIG1pbnQKICAgICAqLwogICAgZnVuY3Rpb24gZnVuZE1pbnRpbmcoYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpIHN0b3BJbkVtZXJnZW5jeSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBmdW5kTWludGluZ0FnZW50IHx8IGlzT3duZXIoKSk7CiAgICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPCBzVDIpOwogICAgICAgIHJlcXVpcmUoZnVuZFRvdGFsU3VwcGx5ICsgYW1vdW50IDw9IGZ1bmRUb2tlbnMpOwogICAgICAgIHJlcXVpcmUodG9rZW4udG90YWxTdXBwbHkoKSArIGFtb3VudCA8PSBoYXJkQ2FwSW5Ub2tlbnMpOwoKICAgICAgICBmdW5kVG90YWxTdXBwbHkgPSBmdW5kVG90YWxTdXBwbHkuYWRkKGFtb3VudCk7CiAgICAgICAgdG9rZW4ubWludCh0bywgYW1vdW50KTsKICAgICAgICBGdW5kTWludGluZyh0bywgYW1vdW50KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGNhbGN1bGF0ZSBhbW91bnQKICAgICAqIEBwYXJhbSAgYW1vdW50IC0gZXRoZXIgdG8gYmUgY29udmVydGVkIHRvIHRva2VucwogICAgICogQHBhcmFtICBhdCAtIGN1cnJlbnQgdGltZQogICAgICogQHBhcmFtICBfdG90YWxTdXBwbHkgLSB0b3RhbCBzdXBwbGllZCB0b2tlbnMKICAgICAqIEByZXR1cm4gdG9rZW5zIGFtb3VudCB0aGF0IHdlIHNob3VsZCBzZW5kIHRvIG91ciBkZWFyIHBwbAogICAgICogQHJldHVybiBvZGQgZXRoZXJzIGFtb3VudCwgd2hpY2ggY29udHJhY3Qgc2hvdWxkIHNlbmQgYmFjawogICAgICovCiAgICBmdW5jdGlvbiBjYWxjQW1vdW50QXQoCiAgICAgICAgdWludDI1NiBhbW91bnQsCiAgICAgICAgdWludDI1NiBhdCwKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseQogICAgKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiwgdWludDI1NikgCiAgICB7CiAgICAgICAgdWludDI1NiBlc3RpbWF0ZTsKICAgICAgICB1aW50MjU2IHByaWNlOwogICAgICAgIAogICAgICAgIGlmIChhdCA+PSBzVDIgJiYgYXQgPD0gKHNUMitkVExQMikpIHsKICAgICAgICAgICAgaWYgKGF0IDw9IHNUMiArIDE1IGRheXMpIHtwcmljZSA9IDEyZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgMzAgZGF5cykgewogICAgICAgICAgICAgICAgcHJpY2UgPSAxNGUxMzt9IGVsc2UgaWYgKGF0IDw9IHNUMiArIDQ1IGRheXMpIHsKICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDE2ZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgNjAgZGF5cykgewogICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDE4ZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgNzUgZGF5cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2UgPSAyMGUxMzt9IGVsc2UgaWYgKGF0IDw9IHNUMiArIDkwIGRheXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDIyZTEzO30gZWxzZSBpZiAoYXQgPD0gc1QyICsgMTA1IGRheXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2UgPSAyNGUxMzt9IGVsc2UgaWYgKGF0IDw9IHNUMiArIDExOCBkYXlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZSA9IDI2ZTEzO30gZWxzZSB7cmV2ZXJ0KCk7fQogICAgICAgIH0gZWxzZSB7cmV2ZXJ0KCk7fQoKICAgICAgICBlc3RpbWF0ZSA9IF90b3RhbFN1cHBseS5hZGQoYW1vdW50Lm11bCgxZTE4KS5kaXYocHJpY2UpKTsKCiAgICAgICAgaWYgKGVzdGltYXRlID4gaGFyZENhcEluVG9rZW5zKSB7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBoYXJkQ2FwSW5Ub2tlbnMuc3ViKF90b3RhbFN1cHBseSksCiAgICAgICAgICAgICAgICBlc3RpbWF0ZS5zdWIoaGFyZENhcEluVG9rZW5zKS5tdWwocHJpY2UpLmRpdigxZTE4KQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGVzdGltYXRlLnN1YihfdG90YWxTdXBwbHkpLCAwKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IGZhbGxiYWNrIGZvciBwcm9jZXNzaW5nIGV0aGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIHJldHVybiBnZXRUb2tlbnMobXNnLnNlbmRlcik7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBzZWxsIHRva2VuIGFuZCBzZW5kIHRvIGNvbnRyaWJ1dG9yIGFkZHJlc3MKICAgICAqIEBwYXJhbSBjb250cmlidXRvciBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRva2VucyhhZGRyZXNzIGNvbnRyaWJ1dG9yKSBwYXlhYmxlIHN0b3BJbkVtZXJnZW5jeSB2YWxpZFB1cmNoYXNlIHB1YmxpYyB7CiAgICAgICAgdWludDI1NiBhbW91bnQ7CiAgICAgICAgdWludDI1NiBvZGRFdGhlcnM7CiAgICAgICAgdWludDI1NiBldGhlcnM7CiAgICAgICAgdWludDI1NiBfYXQ7CiAgICAgICAgdWludDggX3dpbk51bTsKCiAgICAgICAgX2F0ID0gYmxvY2sudGltZXN0YW1wOwoKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dG9yICE9IDB4MCk7CiAgICAgICAKICAgICAgICBpZiAod2l0aGluUGVyaW9kKCkpIHsKICAgICAgICAKICAgICAgICAgICAgKGFtb3VudCwgb2RkRXRoZXJzKSA9IGNhbGNBbW91bnRBdChtc2cudmFsdWUsIF9hdCwgdG9rZW4udG90YWxTdXBwbHkoKSk7ICAvLyByZWNoZWNrISEhCiAgCiAgICAgICAgICAgIHJlcXVpcmUoYW1vdW50ICsgdG9rZW4udG90YWxTdXBwbHkoKSA8PSBoYXJkQ2FwSW5Ub2tlbnMpOwoKICAgICAgICAgICAgZXRoZXJzID0gbXNnLnZhbHVlLnN1YihvZGRFdGhlcnMpOwoKICAgICAgICAgICAgdG9rZW4ubWludChjb250cmlidXRvciwgYW1vdW50KTsgLy8gZmFpbCBpZiBtaW50aW5nIGlzIGZpbmlzaGVkCiAgICAgICAgICAgIFRva2VuUHVyY2hhc2UoY29udHJpYnV0b3IsIGV0aGVycywgYW1vdW50KTsKICAgICAgICAgICAgY291bnRlcl9pbiA9IGNvdW50ZXJfaW4uYWRkKGV0aGVycyk7CiAgICAgICAgICAgIGNyb3dkVG9rZW5zVExQMiA9IGNyb3dkVG9rZW5zVExQMi5hZGQoYW1vdW50KTsKCiAgICAgICAgICAgIGlmIChvZGRFdGhlcnMgPiAwKSB7CiAgICAgICAgICAgICAgICByZXF1aXJlKG9kZEV0aGVycyA8IG1zZy52YWx1ZSk7CiAgICAgICAgICAgICAgICBjb250cmlidXRvci50cmFuc2ZlcihvZGRFdGhlcnMpOwogICAgICAgICAgICAgICAgVHJhbnNmZXJPZGRFdGhlcihjb250cmlidXRvciwgb2RkRXRoZXJzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2FsbGV0LnRyYW5zZmVyKGV0aGVycyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gbWluRVRIaW4pOyAvLyBjaGVja3MgbWluIEVUSCBpbmNvbWUKICAgICAgICAgICAgX3dpbk51bSA9IHN0YWdlTmFtZSgpOwogICAgICAgICAgICByZXF1aXJlKF93aW5OdW0gPj0gMCAmJiBfd2luTnVtIDwgNSk7CiAgICAgICAgICAgIFdpbmRvdyBzdG9yYWdlIHcgPSB3d1tfd2luTnVtXTsKCiAgICAgICAgICAgIHJlcXVpcmUody50b2tlblBlcldpbmRvdyA+IDApOyAvLyBjaGVjayB0aGF0IHdlIGhhdmUgdG9rZW5zIQoKICAgICAgICAgICAgdy50b3RhbEV0aEluV2luZG93ID0gdy50b3RhbEV0aEluV2luZG93LmFkZChtc2cudmFsdWUpOwogICAgICAgICAgICBwcGxzW3cudG90YWxUcmFuc0NudF0uYWRkciA9IGNvbnRyaWJ1dG9yOwogICAgICAgICAgICBwcGxzW3cudG90YWxUcmFuc0NudF0uYW1vdW50ID0gbXNnLnZhbHVlOwogICAgICAgICAgICB3LnRvdGFsVHJhbnNDbnQrKzsKICAgICAgICAgICAgVG9rZW5QdXJjaGFzZUluV2luZG93KGNvbnRyaWJ1dG9yLCBtc2cudmFsdWUsIF93aW5OdW0sIHcudG90YWxUcmFuc0NudCwgdy50b3RhbEV0aEluV2luZG93KTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBjbG9zZSBXaW5kb3cgYW5kIHRyYW5zZmVyIEV0aCB0byB3YWxsZXQgYWRkcmVzcwogICAgICogQHBhcmFtIF93aW5OdW0gLSBudW1iZXIgb2Ygd2luZG93IDAtNCB0byBjbG9zZQogICAgICovCiAgICBmdW5jdGlvbiBjbG9zZVdpbmRvdyh1aW50OCBfd2luTnVtKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSh3d1tfd2luTnVtXS5hY3RpdmUpOwogICAgICAgIHd3W193aW5OdW1dLmFjdGl2ZSA9IGZhbHNlOwoKICAgICAgICB3YWxsZXQudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHRyYW5zZmVyIHRva2VucyB0byBwcGwgYWNjdHMgKHdpbmRvdzEtNSkKICAgICAqIEBwYXJhbSBfd2luTnVtIC0gbnVtYmVyIG9mIHdpbmRvdyAwLTQgdG8gY2xvc2UKICAgICAqLwogICAgZnVuY3Rpb24gc2VuZFRva2Vuc1dpbmRvdyh1aW50OCBfd2luTnVtKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHB1YmxpYyB7CiAgICAgICAgdWludDI1NiBfdG9rZW5QZXJFVEg7CiAgICAgICAgdWludDI1NiBfdG9rZW5Ub1NlbmQgPSAwOwogICAgICAgIGFkZHJlc3MgX3RlbXBBZGRyOwogICAgICAgIHVpbnQzMiBpbmRleCA9IHd3W193aW5OdW1dLnJlZnVuZEluZGV4OwoKICAgICAgICBUb2tlbkVUSCh3d1tfd2luTnVtXS50b3RhbEV0aEluV2luZG93LCB3d1tfd2luTnVtXS50b3RhbFRyYW5zQ250KTsKCiAgICAgICAgcmVxdWlyZSh3d1tfd2luTnVtXS5hY3RpdmUpOwogICAgICAgIHJlcXVpcmUod3dbX3dpbk51bV0udG90YWxFdGhJbldpbmRvdyA+IDApOwogICAgICAgIHJlcXVpcmUod3dbX3dpbk51bV0udG90YWxUcmFuc0NudCA+IDApOwoKICAgICAgICBfdG9rZW5QZXJFVEggPSB3d1tfd2luTnVtXS50b2tlblBlcldpbmRvdy5kaXYod3dbX3dpbk51bV0udG90YWxFdGhJbldpbmRvdyk7IC8vIG1heCBNY0ZseSBpbiB3aW5kb3cgLyBldGhJbldpbmRvdwoKICAgICAgICB3aGlsZSAoaW5kZXggPCB3d1tfd2luTnVtXS50b3RhbFRyYW5zQ250ICYmIG1zZy5nYXMgPiAxMDAwMDApIHsKICAgICAgICAgICAgX3Rva2VuVG9TZW5kID0gX3Rva2VuUGVyRVRILm11bChwcGxzW2luZGV4XS5hbW91bnQpOwogICAgICAgICAgICBwcGxzW2luZGV4XS5hbW91bnQgPSAwOwogICAgICAgICAgICBfdGVtcEFkZHIgPSBwcGxzW2luZGV4XS5hZGRyOwogICAgICAgICAgICBwcGxzW2luZGV4XS5hZGRyID0gMDsKICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgdG9rZW4udHJhbnNmZXIoX3RlbXBBZGRyLCBfdG9rZW5Ub1NlbmQpOwogICAgICAgICAgICBUb2tlbldpdGhkcmF3QXRXaW5kb3coX3RlbXBBZGRyLCBfdG9rZW5Ub1NlbmQpOwogICAgICAgIH0KICAgICAgICB3d1tfd2luTnVtXS5yZWZ1bmRJbmRleCA9IGluZGV4OwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgb3BlbiBuZXcgd2luZG93IDAtNSBhbmQgd3JpdGUgdG90bCB0b2tlbiBwZXIgd2luZG93IGluIHN0cnVjdHVyZQogICAgICogQHBhcmFtIF93aW5OdW0gLSBudW1iZXIgb2Ygd2luZG93IDAtNCB0byBjbG9zZQogICAgICogQHBhcmFtIF90b2tlblBlcldpbmRvdyAtIHRvdGFsIHRva2VuIGZvciB3aW5kb3cgMC00CiAgICAgKi8KICAgIGZ1bmN0aW9uIG5ld1dpbmRvdyh1aW50OCBfd2luTnVtLCB1aW50MjU2IF90b2tlblBlcldpbmRvdykgcHJpdmF0ZSB7CiAgICAgICAgd3dbX3dpbk51bV0gPSBXaW5kb3codHJ1ZSwgMCwgMCwgMCwgX3Rva2VuUGVyV2luZG93KTsKICAgICAgICBOZXdXaW5kb3coX3dpbk51bSwgX3Rva2VuUGVyV2luZG93KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IEZpbmlzaCBjcm93ZHNhbGUgVExQMS4yIHBlcmlvZCBhbmQgb3BlbiB3aW5kb3cxLTUgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmlzaENyb3dkKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgdWludDI1NiBfdG9rZW5QZXJXaW5kb3c7CiAgICAgICAgcmVxdWlyZShub3cgPiAoc1QyLmFkZChkVExQMikpIHx8IGhhcmRDYXBJblRva2VucyA9PSB0b2tlbi50b3RhbFN1cHBseSgpKTsKICAgICAgICByZXF1aXJlKCF0b2tlbi5taW50aW5nRmluaXNoZWQoKSk7CgogICAgICAgIF90b2tlblBlcldpbmRvdyA9IChtaW50Q2FwSW5Ub2tlbnMuc3ViKGNyb3dkVG9rZW5zVExQMikuc3ViKGZ1bmRUb3RhbFN1cHBseSkpLmRpdig1KTsKICAgICAgICB0b2tlbi5taW50KHRoaXMsIF90b2tlblBlcldpbmRvdy5tdWwoNSkpOyAvLyBtaW50IHRvIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICAvLyBzaG91ZCBiZSBNQVggdG9rZW5zIG1pbnRlZCEhISAxLDgwMCwwMDAsMDAwCiAgICAgICAgZm9yICh1aW50OCB5ID0gMDsgeSA8IDU7IHkrKykgewogICAgICAgICAgICBuZXdXaW5kb3coeSwgX3Rva2VuUGVyV2luZG93KTsKICAgICAgICB9CgogICAgICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHdpdGhkcmF3IHRva2VucyBhbW91bnQgd2l0aGluIHZlc3RpbmcgcnVsZXMgZm9yIHRlYW0sIGFkdmlzb3J5IGFuZCByZXNlcnZlZAogICAgICogQHBhcmFtIHdpdGhkcmF3V2FsbGV0IC0gd2FsbGV0IHRvIHRyYW5zZmVyIHRva2VucwogICAgICogQHBhcmFtIHdpdGhkcmF3VG9rZW5zIC0gYW1vdW50IG9mIHRva2VucyB0byB0cmFuc2ZlciB0bwogICAgICogQHBhcmFtIHdpdGhkcmF3VG90YWxTdXBwbHkgLSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHRyYW5zZmVyZWQgdG8gYWNjb3VudAogICAgICogQHJldHVybiB1bml0MjU2IHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgYWZ0ZXIgdHJhbnNmZXIKICAgICAqLwogICAgZnVuY3Rpb24gdmVzdGluZ1dpdGhkcmF3KGFkZHJlc3Mgd2l0aGRyYXdXYWxsZXQsIHVpbnQyNTYgd2l0aGRyYXdUb2tlbnMsIHVpbnQyNTYgd2l0aGRyYXdUb3RhbFN1cHBseSkgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi5taW50aW5nRmluaXNoZWQoKSk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHdpdGhkcmF3V2FsbGV0IHx8IGlzT3duZXIoKSk7CgogICAgICAgIHVpbnQyNTYgY3VycmVudFBlcmlvZCA9IChibG9jay50aW1lc3RhbXAuc3ViKHNUMi5hZGQoZFRMUDIpKSkuZGl2KFZlc3RpbmdQZXJpb2RJblNlY29uZHMpOwogICAgICAgIGlmIChjdXJyZW50UGVyaW9kID4gVmVzdGluZ1BlcmlvZHNDb3VudCkgewogICAgICAgICAgICBjdXJyZW50UGVyaW9kID0gVmVzdGluZ1BlcmlvZHNDb3VudDsKICAgICAgICB9CiAgICAgICAgdWludDI1NiB0b2tlbkF2YWlsYWJsZSA9IHdpdGhkcmF3VG9rZW5zLm11bChjdXJyZW50UGVyaW9kKS5kaXYoVmVzdGluZ1BlcmlvZHNDb3VudCkuc3ViKHdpdGhkcmF3VG90YWxTdXBwbHkpOyAgLy8gUkVDSEVDSyEhISEhCgogICAgICAgIHJlcXVpcmUod2l0aGRyYXdUb3RhbFN1cHBseSArIHRva2VuQXZhaWxhYmxlIDw9IHdpdGhkcmF3VG9rZW5zKTsKCiAgICAgICAgdWludDI1NiBfd2l0aGRyYXdUb3RhbFN1cHBseSA9IHdpdGhkcmF3VG90YWxTdXBwbHkgKyB0b2tlbkF2YWlsYWJsZTsKCiAgICAgICAgdG9rZW4udHJhbnNmZXIod2l0aGRyYXdXYWxsZXQsIHRva2VuQXZhaWxhYmxlKTsKICAgICAgICBXaXRoZHJhd1Zlc3Rpbmcod2l0aGRyYXdXYWxsZXQsIGN1cnJlbnRQZXJpb2QsIHRva2VuQXZhaWxhYmxlLCBfd2l0aGRyYXdUb3RhbFN1cHBseSk7CgogICAgICAgIHJldHVybiBfd2l0aGRyYXdUb3RhbFN1cHBseTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBAZGV2IHdpdGhkcmF3IHRva2VucyBhbW91bnQgd2l0aGluIHZlc3RpbmcgcnVsZXMgZm9yIHRlYW0KICAgICAqLwogICAgZnVuY3Rpb24gdGVhbVdpdGhkcmF3KCkgcHVibGljIHsKICAgICAgICB0ZWFtVG90YWxTdXBwbHkgPSB2ZXN0aW5nV2l0aGRyYXcodGVhbVdhbGxldCwgX3RlYW1Ub2tlbnMsIHRlYW1Ub3RhbFN1cHBseSk7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiB3aXRoZHJhdyB0b2tlbnMgYW1vdW50IHdpdGhpbiB2ZXN0aW5nIHJ1bGVzIGZvciBhZHZpc29yeQogICAgICovCiAgICBmdW5jdGlvbiBhZHZpc29yeVdpdGhkcmF3KCkgcHVibGljIHsKICAgICAgICBhZHZpc29yeVRvdGFsU3VwcGx5ID0gdmVzdGluZ1dpdGhkcmF3KGFkdmlzb3J5V2FsbGV0LCBfYWR2aXNvcnlUb2tlbnMsIGFkdmlzb3J5VG90YWxTdXBwbHkpOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgd2l0aGRyYXcgdG9rZW5zIGFtb3VudCB3aXRoaW4gdmVzdGluZyBydWxlcyBmb3IgcmVzZXJ2ZWQgd2FsbGV0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlc2VydmVkV2l0aGRyYXcoKSBwdWJsaWMgewogICAgICAgIHJlc2VydmVkVG90YWxTdXBwbHkgPSB2ZXN0aW5nV2l0aGRyYXcocmVzZXJ2ZWRXYWxsZXQsIF9yZXNlcnZlZFRva2VucywgcmVzZXJ2ZWRUb3RhbFN1cHBseSk7CiAgICB9Cn0='.
	

]
