Class {
	#name : #SRT729d11fd8ee835a165a6824362bebac8a7831aea,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT729d11fd8ee835a165a6824362bebac8a7831aea >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Cgpjb250cmFjdCBDb250cm9sbGVyIHsKCiAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgdG8gY3JlYXRlIHRva2VucwogIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9CgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludCBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7CiAgICBpZiAoIWFzc2VydGlvbikgewogICAgICB0aHJvdzsKICAgIH0KICB9Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKCiAgLyoqCiAgICogQGRldiBGaXggZm9yIHRoZSBFUkMyMCBzaG9ydCBhZGRyZXNzIGF0dGFjay4KICAgKi8KICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBzaXplKSB7CiAgICAgaWYobXNnLmRhdGEubGVuZ3RoIDwgc2l6ZSArIDQpIHsKICAgICAgIHRocm93OwogICAgIH0KICAgICBfOwogIH0KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWFudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFydCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBCYXNpY1Rva2VuLCBFUkMyMCB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludCB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMyAqIDMyKSB7CiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWFobGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB7CiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICBpZiAoKF92YWx1ZSAhPSAwKSAmJiAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gIT0gMCkpIHRocm93OwogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhbiBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KfQoKY29udHJhY3QgQ29udHJvbGxlZCB7CgogIGFkZHJlc3MgcHVibGljIGNvbnRyb2xsZXI7CgogIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7CiAgICBjb250cm9sbGVyID0gbXNnLnNlbmRlcjsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfY29udHJvbGxlcikgb25seUNvbnRyb2xsZXIgewogICAgY29udHJvbGxlciA9IF9jb250cm9sbGVyOwogIH0KCiAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7CiAgICBfOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgTWludGFibGUgdG9rZW4KICogQGRldiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBtaW50YWJsZSB0b2tlbiBjcmVhdGlvbgogKi8KY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBDb250cm9sbGVkIHsKCiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseSA9IDA7CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIG9ubHlDb250cm9sbGVyIGNhbk1pbnQgcmV0dXJucyAoYm9vbCkgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIGlmIChtaW50aW5nRmluaXNoZWQpIHRocm93OwogICAgXzsKICB9Cn0KCi8qKgogKiBAdGl0bGUgTGltaXRlZFRyYW5zZmVyVG9rZW4KICogQGRldiBMaW1pdGVkVHJhbnNmZXJUb2tlbiBkZWZpbmVzIHRoZSBnZW5lcmljIGludGVyZmFjZSBhbmQgdGhlIGltcGxlbWVudGF0aW9uIHRvIGxpbWl0IHRva2VuCiAqIHRyYW5zZmVyYWJpbGl0eSBmb3IgZGlmZmVyZW50IGV2ZW50cy4gSXQgaXMgaW50ZW5kZWQgdG8gYmUgdXNlZCBhcyBhIGJhc2UgY2xhc3MgZm9yIG90aGVyIHRva2VuCiAqIGNvbnRyYWN0cy4KICogTGltaXRlZFRyYW5zZmVyVG9rZW4gaGFzIGJlZW4gZGVzaWduZWQgdG8gYWxsb3cgZm9yIGRpZmZlcmVudCBsaW1pdGluZyBmYWN0b3JzLAogKiB0aGlzIGNhbiBiZSBhY2hpZXZlZCBieSByZWN1cnNpdmVseSBjYWxsaW5nIHN1cGVyLnRyYW5zZmVyYWJsZVRva2VucygpIHVudGlsIHRoZSBiYXNlIGNsYXNzIGlzCiAqIGhpdC4gRm9yIGV4YW1wbGU6CiAqICAgICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogKiAgICAgICByZXR1cm4gbWluMjU2KHVubG9ja2VkVG9rZW5zLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7CiAqICAgICB9CiAqIEEgd29ya2luZyBleGFtcGxlIGlzIFZlc3RlZFRva2VuLnNvbDoKICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9ibG9iL21hc3Rlci9jb250cmFjdHMvdG9rZW4vVmVzdGVkVG9rZW4uc29sCiAqLwpjb250cmFjdCBMaW1pdGVkVHJhbnNmZXJUb2tlbiBpcyBFUkMyMCB7CgogIC8qKgogICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgaXQgY2FuIHRyYW5zZmVyIG9yIG90aGVyd2lzZSB0aHJvd3MuCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyLCB1aW50IF92YWx1ZSkgewogICBpZiAoX3ZhbHVlID4gdHJhbnNmZXJhYmxlVG9rZW5zKF9zZW5kZXIsIHVpbnQ2NChub3cpKSkgdGhyb3c7CiAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNpZXZlIHRoZSB0b2tlbnMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF92YWx1ZSkgewogICAgc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc2VuZCB0aGUgdG9rZW5zLgogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjaWV2ZSB0aGUgdG9rZW5zLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGNhblRyYW5zZmVyKF9mcm9tLCBfdmFsdWUpIHsKICAgIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLyoqCiAgICogQGRldiBEZWZhdWx0IHRyYW5zZmVyYWJsZSB0b2tlbnMgZnVuY3Rpb24gcmV0dXJucyBhbGwgdG9rZW5zIGZvciBhIGhvbGRlciAobm8gbGltaXQpLgogICAqIEBkZXYgT3ZlcndyaXRpbmcgdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgaXMgdGhlIHdheSB0byBwcm92aWRlIHRoZQogICAqIHNwZWNpZmljIGxvZ2ljIGZvciBsaW1pdGluZyB0b2tlbiB0cmFuc2ZlcmFiaWxpdHkgZm9yIGEgaG9sZGVyIG92ZXIgdGltZS4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgVmVzdGVkIHRva2VuCiAqIEBkZXYgVG9rZW5zIHRoYXQgY2FuIGJlIHZlc3RlZCBmb3IgYSBncm91cCBvZiBhZGRyZXNzZXMuCiAqLwpjb250cmFjdCBWZXN0ZWRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBMaW1pdGVkVHJhbnNmZXJUb2tlbiB7CgogIHVpbnQyNTYgTUFYX0dSQU5UU19QRVJfQUREUkVTUyA9IDIwOwoKICBzdHJ1Y3QgVG9rZW5HcmFudCB7CiAgICBhZGRyZXNzIGdyYW50ZXI7ICAgICAvLyAyMCBieXRlcwogICAgdWludDI1NiB2YWx1ZTsgICAgICAgLy8gMzIgYnl0ZXMKICAgIHVpbnQ2NCBjbGlmZjsKICAgIHVpbnQ2NCB2ZXN0aW5nOwogICAgdWludDY0IHN0YXJ0OyAgICAgICAgLy8gMyAqIDggPSAyNCBieXRlcwogICAgYm9vbCByZXZva2FibGU7CiAgICBib29sIGJ1cm5zT25SZXZva2U7ICAvLyAyICogMSA9IDIgYml0cz8gb3IgMiBieXRlcz8KICB9IC8vIHRvdGFsIDc4IGJ5dGVzID0gMyBzc3RvcmUgcGVyIG9wZXJhdGlvbiAoMzIgcGVyIHNzdG9yZSkKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBUb2tlbkdyYW50W10pIHB1YmxpYyBncmFudHM7CgogIGV2ZW50IE5ld1Rva2VuR3JhbnQoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSwgdWludDI1NiBncmFudElkKTsKCiAgLyoqCiAgICogQGRldiBHcmFudCB0b2tlbnMgdG8gYSBzcGVjaWZpZWQgYWRkcmVzcwogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB0aGUgdG9rZW5zIHdpbGwgYmUgZ3JhbnRlZCB0by4KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgKiBAcGFyYW0gX3N0YXJ0IHVpbnQ2NCBUaW1lIG9mIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGdyYW50LgogICAqIEBwYXJhbSBfY2xpZmYgdWludDY0IFRpbWUgb2YgdGhlIGNsaWZmIHBlcmlvZC4KICAgKiBAcGFyYW0gX3Zlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgKiBAcGFyYW0gX3Jldm9rYWJsZSBib29sIElmIHRoZSBncmFudCBpcyByZXZva2FibGUuCiAgICogQHBhcmFtIF9idXJuc09uUmV2b2tlIGJvb2wgV2hlbiB0cnVlLCB0aGUgdG9rZW5zIGFyZSBidXJuZWQgaWYgcmV2b2tlZC4KICAgKi8KICBmdW5jdGlvbiBncmFudFZlc3RlZFRva2VucygKICAgIGFkZHJlc3MgX3RvLAogICAgdWludDI1NiBfdmFsdWUsCiAgICB1aW50NjQgX3N0YXJ0LAogICAgdWludDY0IF9jbGlmZiwKICAgIHVpbnQ2NCBfdmVzdGluZywKICAgIGJvb2wgX3Jldm9rYWJsZSwKICAgIGJvb2wgX2J1cm5zT25SZXZva2UKICApIHB1YmxpYyB7CgogICAgLy8gQ2hlY2sgZm9yIGRhdGUgaW5jb25zaXN0ZW5jaWVzIHRoYXQgbWF5IGNhdXNlIHVuZXhwZWN0ZWQgYmVoYXZpb3IKICAgIGlmIChfY2xpZmYgPCBfc3RhcnQgfHwgX3Zlc3RpbmcgPCBfY2xpZmYpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgaWYgKHRva2VuR3JhbnRzQ291bnQoX3RvKSA+IE1BWF9HUkFOVFNfUEVSX0FERFJFU1MpIHRocm93OyAgLy8gVG8gcHJldmVudCBhIHVzZXIgYmVpbmcgc3BhbW1lZCBhbmQgaGF2ZSBoaXMgYmFsYW5jZSBsb2NrZWQgKG91dCBvZiBnYXMgYXR0YWNrIHdoZW4gY2FsY3VsYXRpbmcgdmVzdGluZykuCgogICAgdWludCBjb3VudCA9IGdyYW50c1tfdG9dLnB1c2goCiAgICAgICAgICAgICAgICBUb2tlbkdyYW50KAogICAgICAgICAgICAgICAgICBfcmV2b2thYmxlID8gbXNnLnNlbmRlciA6IDAsICAvLyBhdm9pZCBzdG9yaW5nIGFuIGV4dHJhIDIwIGJ5dGVzIHdoZW4gaXQgaXMgbm9uLXJldm9rYWJsZQogICAgICAgICAgICAgICAgICBfdmFsdWUsCiAgICAgICAgICAgICAgICAgIF9jbGlmZiwKICAgICAgICAgICAgICAgICAgX3Zlc3RpbmcsCiAgICAgICAgICAgICAgICAgIF9zdGFydCwKICAgICAgICAgICAgICAgICAgX3Jldm9rYWJsZSwKICAgICAgICAgICAgICAgICAgX2J1cm5zT25SZXZva2UKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICApOwogICAgdHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgY291bnQgLSAxKTsKICB9CgogIC8qKgogICAqIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICovCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIHB1YmxpYyB7CiAgICBUb2tlbkdyYW50IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdW19ncmFudElkXTsKCiAgICBpZiAoIWdyYW50LnJldm9rYWJsZSkgeyAvLyBDaGVjayBpZiBncmFudCB3YXMgcmV2b2thYmxlCiAgICAgIHRocm93OwogICAgfQoKICAgIGlmIChncmFudC5ncmFudGVyICE9IG1zZy5zZW5kZXIpIHsgLy8gT25seSBncmFudGVyIGNhbiByZXZva2UgaXQKICAgICAgdGhyb3c7CiAgICB9CgogICAgYWRkcmVzcyByZWNlaXZlciA9IGdyYW50LmJ1cm5zT25SZXZva2UgPyAweGRlYWQgOiBtc2cuc2VuZGVyOwogICAgdWludDI1NiBub25WZXN0ZWQgPSBub25WZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKCiAgICAvLyByZW1vdmUgZ3JhbnQgZnJvbSBhcnJheQogICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CiAgICBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdID0gZ3JhbnRzW19ob2xkZXJdW2dyYW50c1tfaG9sZGVyXS5sZW5ndGguc3ViKDEpXTsKICAgIGdyYW50c1tfaG9sZGVyXS5sZW5ndGggLT0gMTsKCiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKG5vblZlc3RlZCk7CiAgICBiYWxhbmNlc1tfaG9sZGVyXSA9IGJhbGFuY2VzW19ob2xkZXJdLnN1Yihub25WZXN0ZWQpOwoKICAgIFRyYW5zZmVyKF9ob2xkZXIsIHJlY2VpdmVyLCBub25WZXN0ZWQpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIHRvdGFsIGFtb3VudCBvZiB0cmFuc2ZlcmFibGUgdG9rZW5zIG9mIGEgaG9sZGVyIGF0IGEgZ2l2ZW4gdGltZQogICAqIEBwYXJhbSBob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSBzcGVjaWZpYyB0aW1lLgogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgYSBob2xkZXIncyB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcmFibGVUb2tlbnMoYWRkcmVzcyBob2xkZXIsIHVpbnQ2NCB0aW1lKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBncmFudEluZGV4ID0gdG9rZW5HcmFudHNDb3VudChob2xkZXIpOwogICAgaWYgKGdyYW50SW5kZXggPT0gMCkgcmV0dXJuIGJhbGFuY2VPZihob2xkZXIpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2VucwogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIG5vblZlc3RlZCA9IG5vblZlc3RlZC5hZGQobm9uVmVzdGVkVG9rZW5zKGdyYW50c1tob2xkZXJdW2ldLCB0aW1lKSk7CiAgICB9CgogICAgLy8gQmFsYW5jZSAtIHRvdGFsTm9uVmVzdGVkIGlzIHRoZSBhbW91bnQgb2YgdG9rZW5zIGEgaG9sZGVyIGNhbiB0cmFuc2ZlciBhdCBhbnkgZ2l2ZW4gdGltZQogICAgdWludDI1NiB2ZXN0ZWRUcmFuc2ZlcmFibGUgPSBiYWxhbmNlT2YoaG9sZGVyKS5zdWIobm9uVmVzdGVkKTsKCiAgICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gb2YgaG93IG1hbnkgdmVzdGVkIGNhbiB0cmFuc2ZlciBhbmQgb3RoZXIgdmFsdWUKICAgIC8vIGluIGNhc2UgdGhlcmUgYXJlIG90aGVyIGxpbWl0aW5nIHRyYW5zZmVyYWJpbGl0eSBmYWN0b3JzIChkZWZhdWx0IGlzIGJhbGFuY2VPZikKICAgIHJldHVybiBTYWZlTWF0aC5taW4yNTYodmVzdGVkVHJhbnNmZXJhYmxlLCBzdXBlci50cmFuc2ZlcmFibGVUb2tlbnMoaG9sZGVyLCB0aW1lKSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENoZWNrIHRoZSBhbW91bnQgb2YgZ3JhbnRzIHRoYXQgYW4gYWRkcmVzcyBoYXMuCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGhvbGRlciBvZiB0aGUgZ3JhbnRzLgogICAqIEByZXR1cm4gQSB1aW50IHJlcHJlc2VudGluZyB0aGUgdG90YWwgYW1vdW50IG9mIGdyYW50cy4KICAgKi8KICBmdW5jdGlvbiB0b2tlbkdyYW50c0NvdW50KGFkZHJlc3MgX2hvbGRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCBpbmRleCkgewogICAgcmV0dXJuIGdyYW50c1tfaG9sZGVyXS5sZW5ndGg7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmMgdGltZS4KICAgKiBAcGFyYW0gdG9rZW5zIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgZ3JhbnR0ZWQuCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcGFyYW0gc3RhcnQgdWludDY0IEEgdGltZSByZXByZXNlbnRpbmcgdGhlIGJlZ2luaW5nIG9mIHRoZSBncmFudAogICAqIEBwYXJhbSBjbGlmZiB1aW50NjQgVGhlIGNsaWZmIHBlcmlvZC4KICAgKiBAcGFyYW0gdmVzdGluZyB1aW50NjQgVGhlIHZlc3RpbmcgcGVyaW9kLgogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zb2YgYSBzcGVjaWYgZ3JhbnQuCiAgICogIHRyYW5zZmVyYWJsZVRva2VucwogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QKICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgIF8vCiAgICogICB8ICAgICAgICAgICAgICAgIC8KICAgKiAgIHwgICAgICAgICAgICAgIC58CiAgICogICB8ICAgICAgICAgICAgLiAgfAogICAqICAgfCAgICAgICAgICAuICAgIHwKICAgKiAgIHwgICAgICAgIC4gICAgICB8CiAgICogICB8ICAgICAgLiAgICAgICAgfChncmFudHNbX2hvbGRlcl0gPT0gYWRkcmVzcygwKSkgcmV0dXJuIDA7CiAgICogICB8ICAgIC4gICAgICAgICAgfAogICAqICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAqICAgICAgU3RhcnQgICAgICAgQ2xpZnQgICAgVmVzdGluZwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICAgIHVpbnQyNTYgdG9rZW5zLAogICAgdWludDI1NiB0aW1lLAogICAgdWludDI1NiBzdGFydCwKICAgIHVpbnQyNTYgY2xpZmYsCiAgICB1aW50MjU2IHZlc3RpbmcpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgIC8vIFNob3J0Y3V0cyBmb3IgYmVmb3JlIGNsaWZmIGFuZCBhZnRlciB2ZXN0aW5nIGNhc2VzLgogICAgICBpZiAodGltZSA8IGNsaWZmKSByZXR1cm4gMDsKICAgICAgaWYgKHRpbWUgPj0gdmVzdGluZykgcmV0dXJuIHRva2VuczsKCiAgICAgIC8vIEludGVycG9sYXRlIGFsbCB2ZXN0ZWQgdG9rZW5zLgogICAgICAvLyBBcyBiZWZvcmUgY2xpZmYgdGhlIHNob3J0Y3V0IHJldHVybnMgMCwgd2UgY2FuIHVzZSBqdXN0IGNhbGN1bGF0ZSBhIHZhbHVlCiAgICAgIC8vIGluIHRoZSB2ZXN0aW5nIHJlY3QgKGFzIHNob3duIGluIGFib3ZlJ3MgZmlndXJlKQoKICAgICAgLy8gdmVzdGVkVG9rZW5zID0gdG9rZW5zICogKHRpbWUgLSBzdGFydCkgLyAodmVzdGluZyAtIHN0YXJ0KQogICAgICB1aW50MjU2IHZlc3RlZFRva2VucyA9IHRva2Vucy5tdWwodGltZS5zdWIoc3RhcnQpKS5kaXYodmVzdGluZy5zdWIoc3RhcnQpKTsKICAgICAgcmV0dXJuIHZlc3RlZFRva2VuczsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmMgZ3JhbnQuCiAgICogQHBhcmFtIF9ob2xkZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBoYXZlIGl0cyB0b2tlbnMgcmV2b2tlZC4KICAgKiBAcGFyYW0gX2dyYW50SWQgVGhlIGlkIG9mIHRoZSB0b2tlbiBncmFudC4KICAgKiBAcmV0dXJuIFJldHVybnMgYWxsIHRoZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgYSBUb2tlbkdyYW50KGFkZHJlc3MsIHZhbHVlLCBzdGFydCwgY2xpZmYsCiAgICogcmV2b2thYmlsaXR5LCBidXJuc09uUmV2b2tlLCBhbmQgdmVzdGluZykgcGx1cyB0aGUgdmVzdGVkIHZhbHVlIGF0IHRoZSBjdXJyZW50IHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQgX2dyYW50SWQpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgZ3JhbnRlciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiB2ZXN0ZWQsIHVpbnQ2NCBzdGFydCwgdWludDY0IGNsaWZmLCB1aW50NjQgdmVzdGluZywgYm9vbCByZXZva2FibGUsIGJvb2wgYnVybnNPblJldm9rZSkgewogICAgVG9rZW5HcmFudCBncmFudCA9IGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CgogICAgZ3JhbnRlciA9IGdyYW50LmdyYW50ZXI7CiAgICB2YWx1ZSA9IGdyYW50LnZhbHVlOwogICAgc3RhcnQgPSBncmFudC5zdGFydDsKICAgIGNsaWZmID0gZ3JhbnQuY2xpZmY7CiAgICB2ZXN0aW5nID0gZ3JhbnQudmVzdGluZzsKICAgIHJldm9rYWJsZSA9IGdyYW50LnJldm9rYWJsZTsKICAgIGJ1cm5zT25SZXZva2UgPSBncmFudC5idXJuc09uUmV2b2tlOwoKICAgIHZlc3RlZCA9IHZlc3RlZFRva2VucyhncmFudCwgdWludDY0KG5vdykpOwogIH0KCiAgLyoqCiAgICogQGRldiBHZXQgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4KICAgKiBAcGFyYW0gdGltZSBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICogQHJldHVybiBBbiB1aW50IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZpYyBncmFudCBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoCiAgICAgIGdyYW50LnZhbHVlLAogICAgICB1aW50MjU2KHRpbWUpLAogICAgICB1aW50MjU2KGdyYW50LnN0YXJ0KSwKICAgICAgdWludDI1NihncmFudC5jbGlmZiksCiAgICAgIHVpbnQyNTYoZ3JhbnQudmVzdGluZykKICAgICk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIG5vbiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZS4KICAgKiBAcGFyYW0gZ3JhbnQgVG9rZW5HcmFudCBUaGUgZ3JhbnQgdG8gYmUgY2hlY2tlZC4KICAgKiBAcGFyYW0gdGltZSB1aW50NjQgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmMgZ3JhbnQgb24gdGhlCiAgICogcGFzc2VkIHRpbWUgZnJhbWUuCiAgICovCiAgZnVuY3Rpb24gbm9uVmVzdGVkVG9rZW5zKFRva2VuR3JhbnQgZ3JhbnQsIHVpbnQ2NCB0aW1lKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBncmFudC52YWx1ZS5zdWIodmVzdGVkVG9rZW5zKGdyYW50LCB0aW1lKSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgZGF0ZSB3aGVuIHRoZSBob2xkZXIgY2FuIHRyYXNmZXIgYWxsIGl0cyB0b2tlbnMKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGRhdGUgb2YgdGhlIGxhc3QgdHJhbnNmZXJhYmxlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBsYXN0VG9rZW5Jc1RyYW5zZmVyYWJsZURhdGUoYWRkcmVzcyBob2xkZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50NjQgZGF0ZSkgewogICAgZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgdWludDI1NiBncmFudEluZGV4ID0gZ3JhbnRzW2hvbGRlcl0ubGVuZ3RoOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIGRhdGUgPSBTYWZlTWF0aC5tYXg2NChncmFudHNbaG9sZGVyXVtpXS52ZXN0aW5nLCBkYXRlKTsKICAgIH0KICB9Cn0KCgovLy8gQHRpdGxlIEFydGNvaW4gKEFSVCkgLSBkZW1vY3JhdGl6aW5nIGN1bHR1cmUuCmNvbnRyYWN0IEFydGNvaW4gaXMgTWludGFibGVUb2tlbiwgVmVzdGVkVG9rZW4gewoKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAnQXJ0Y29pbic7CiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAnQVJUJzsKICB1aW50IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgIGlmICghQ29udHJvbGxlcihjb250cm9sbGVyKS5wcm94eVBheW1lbnQudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKSkgdGhyb3c7CiAgICB9IGVsc2UgewogICAgICB0aHJvdzsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICB1aW50IHNpemU7CiAgICBpZiAoX2FkZHIgPT0gYWRkcmVzcygwKSkgcmV0dXJuIGZhbHNlOwogICAgYXNzZW1ibHkgewogICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgfQogICAgcmV0dXJuIHNpemUgPiAwOwogIH0KfQ=='.
	

]
