Class {
	#name : #SRT2E3090C13a545D37f3D8c1158040E6b6dc229e58,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2E3090C13a545D37f3D8c1158040E6b6dc229e58 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBQZXJtaXNzaW9uR3JvdXBzIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbjsKICAgIGFkZHJlc3MgcHVibGljIHBlbmRpbmdBZG1pbjsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgaW50ZXJuYWwgb3BlcmF0b3JzOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBhbGVydGVyczsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBvcGVyYXRvcnNHcm91cDsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBhbGVydGVyc0dyb3VwOwoKICAgIGZ1bmN0aW9uIFBlcm1pc3Npb25Hcm91cHMoKSBwdWJsaWMgewogICAgICAgIGFkbWluID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPcGVyYXRvcigpIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWxlcnRlcigpIHsKICAgICAgICByZXF1aXJlKGFsZXJ0ZXJzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9wZXJhdG9ycyAoKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG9wZXJhdG9yc0dyb3VwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFsZXJ0ZXJzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gYWxlcnRlcnNHcm91cDsKICAgIH0KCiAgICBldmVudCBUcmFuc2ZlckFkbWluUGVuZGluZyhhZGRyZXNzIHBlbmRpbmdBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBhZG1pbiB0byBzZXQgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzLgogICAgICogQHBhcmFtIG5ld0FkbWluIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBZG1pbihhZGRyZXNzIG5ld0FkbWluKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG5ld0FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIFRyYW5zZmVyQWRtaW5QZW5kaW5nKHBlbmRpbmdBZG1pbik7CiAgICAgICAgcGVuZGluZ0FkbWluID0gbmV3QWRtaW47CiAgICB9CgogICAgZXZlbnQgQWRtaW5DbGFpbWVkKCBhZGRyZXNzIG5ld0FkbWluLCBhZGRyZXNzIHByZXZpb3VzQWRtaW4pOwoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSBjaGFuZ2UgYWRtaW4gcHJvY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BZG1pbigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShwZW5kaW5nQWRtaW4gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgQWRtaW5DbGFpbWVkKHBlbmRpbmdBZG1pbiwgYWRtaW4pOwogICAgICAgIGFkbWluID0gcGVuZGluZ0FkbWluOwogICAgICAgIHBlbmRpbmdBZG1pbiA9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZXZlbnQgQWxlcnRlckFkZGVkIChhZGRyZXNzIG5ld0FsZXJ0ZXIsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZEFsZXJ0ZXIoYWRkcmVzcyBuZXdBbGVydGVyKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFhbGVydGVyc1tuZXdBbGVydGVyXSk7IC8vIHByZXZlbnQgZHVwbGljYXRlcy4KICAgICAgICBBbGVydGVyQWRkZWQobmV3QWxlcnRlciwgdHJ1ZSk7CiAgICAgICAgYWxlcnRlcnNbbmV3QWxlcnRlcl0gPSB0cnVlOwogICAgICAgIGFsZXJ0ZXJzR3JvdXAucHVzaChuZXdBbGVydGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVBbGVydGVyIChhZGRyZXNzIGFsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbYWxlcnRlcl0pOwogICAgICAgIGFsZXJ0ZXJzW2FsZXJ0ZXJdID0gZmFsc2U7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsZXJ0ZXJzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKGFsZXJ0ZXJzR3JvdXBbaV0gPT0gYWxlcnRlcikgewogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cFtpXSA9IGFsZXJ0ZXJzR3JvdXBbYWxlcnRlcnNHcm91cC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGFsZXJ0ZXJzR3JvdXAubGVuZ3RoLS07CiAgICAgICAgICAgICAgICBBbGVydGVyQWRkZWQoYWxlcnRlciwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZXZlbnQgT3BlcmF0b3JBZGRlZChhZGRyZXNzIG5ld09wZXJhdG9yLCBib29sIGlzQWRkKTsKCiAgICBmdW5jdGlvbiBhZGRPcGVyYXRvcihhZGRyZXNzIG5ld09wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFvcGVyYXRvcnNbbmV3T3BlcmF0b3JdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIE9wZXJhdG9yQWRkZWQobmV3T3BlcmF0b3IsIHRydWUpOwogICAgICAgIG9wZXJhdG9yc1tuZXdPcGVyYXRvcl0gPSB0cnVlOwogICAgICAgIG9wZXJhdG9yc0dyb3VwLnB1c2gobmV3T3BlcmF0b3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU9wZXJhdG9yIChhZGRyZXNzIG9wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1tvcGVyYXRvcl0pOwogICAgICAgIG9wZXJhdG9yc1tvcGVyYXRvcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3BlcmF0b3JzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKG9wZXJhdG9yc0dyb3VwW2ldID09IG9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvcnNHcm91cFtpXSA9IG9wZXJhdG9yc0dyb3VwW29wZXJhdG9yc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgb3BlcmF0b3JzR3JvdXAubGVuZ3RoIC09IDE7CiAgICAgICAgICAgICAgICBPcGVyYXRvckFkZGVkKG9wZXJhdG9yLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgVXRpbHMgewoKICAgIEVSQzIwIGNvbnN0YW50IGludGVybmFsIEVUSF9UT0tFTl9BRERSRVNTID0gRVJDMjAoMHgwMGVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWUpOwogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgUFJFQ0lTSU9OID0gKDEwKioxOCk7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfUVRZICAgPSAoMTAqKjI4KTsgLy8gMTBCIHRva2VucwogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgTUFYX1JBVEUgID0gKFBSRUNJU0lPTiAqIDEwKio2KTsgLy8gdXAgdG8gMU0gdG9rZW5zIHBlciBFVEgKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9ERUNJTUFMUyA9IDE4OwogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgRVRIX0RFQ0lNQUxTID0gMTg7CiAgICBtYXBwaW5nKGFkZHJlc3M9PnVpbnQpIGludGVybmFsIGRlY2ltYWxzOwoKICAgIGZ1bmN0aW9uIHNldERlY2ltYWxzKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKHRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTKSBkZWNpbWFsc1t0b2tlbl0gPSBFVEhfREVDSU1BTFM7CiAgICAgICAgZWxzZSBkZWNpbWFsc1t0b2tlbl0gPSB0b2tlbi5kZWNpbWFscygpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldERlY2ltYWxzKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIGlmICh0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUykgcmV0dXJuIEVUSF9ERUNJTUFMUzsgLy8gc2F2ZSBzdG9yYWdlIGFjY2VzcwogICAgICAgIHVpbnQgdG9rZW5EZWNpbWFscyA9IGRlY2ltYWxzW3Rva2VuXTsKICAgICAgICAvLyB0ZWNobmljYWxseSwgdGhlcmUgbWlnaHQgYmUgdG9rZW4gd2l0aCBkZWNpbWFscyAwCiAgICAgICAgLy8gbW9yZW92ZXIsIHZlcnkgcG9zc2libGUgdGhhdCBvbGQgdG9rZW5zIGhhdmUgZGVjaW1hbHMgMAogICAgICAgIC8vIHRoZXNlIHRva2VucyB3aWxsIGp1c3QgaGF2ZSBoaWdoZXIgZ2FzIGZlZXMuCiAgICAgICAgaWYodG9rZW5EZWNpbWFscyA9PSAwKSByZXR1cm4gdG9rZW4uZGVjaW1hbHMoKTsKCiAgICAgICAgcmV0dXJuIHRva2VuRGVjaW1hbHM7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY0RzdFF0eSh1aW50IHNyY1F0eSwgdWludCBzcmNEZWNpbWFscywgdWludCBkc3REZWNpbWFscywgdWludCByYXRlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIHJlcXVpcmUoc3JjUXR5IDw9IE1BWF9RVFkpOwogICAgICAgIHJlcXVpcmUocmF0ZSA8PSBNQVhfUkFURSk7CgogICAgICAgIGlmIChkc3REZWNpbWFscyA+PSBzcmNEZWNpbWFscykgewogICAgICAgICAgICByZXF1aXJlKChkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSA8PSBNQVhfREVDSU1BTFMpOwogICAgICAgICAgICByZXR1cm4gKHNyY1F0eSAqIHJhdGUgKiAoMTAqKihkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSkpIC8gUFJFQ0lTSU9OOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIHJldHVybiAoc3JjUXR5ICogcmF0ZSkgLyAoUFJFQ0lTSU9OICogKDEwKiooc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykpKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY1NyY1F0eSh1aW50IGRzdFF0eSwgdWludCBzcmNEZWNpbWFscywgdWludCBkc3REZWNpbWFscywgdWludCByYXRlKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIHJlcXVpcmUoZHN0UXR5IDw9IE1BWF9RVFkpOwogICAgICAgIHJlcXVpcmUocmF0ZSA8PSBNQVhfUkFURSk7CgogICAgICAgIC8vc291cmNlIHF1YW50aXR5IGlzIHJvdW5kZWQgdXAuIHRvIGF2b2lkIGRlc3QgcXVhbnRpdHkgYmVpbmcgdG9vIGxvdy4KICAgICAgICB1aW50IG51bWVyYXRvcjsKICAgICAgICB1aW50IGRlbm9taW5hdG9yOwogICAgICAgIGlmIChzcmNEZWNpbWFscyA+PSBkc3REZWNpbWFscykgewogICAgICAgICAgICByZXF1aXJlKChzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSA8PSBNQVhfREVDSU1BTFMpOwogICAgICAgICAgICBudW1lcmF0b3IgPSAoUFJFQ0lTSU9OICogZHN0UXR5ICogKDEwKiooc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykpKTsKICAgICAgICAgICAgZGVub21pbmF0b3IgPSByYXRlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlcXVpcmUoKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIG51bWVyYXRvciA9IChQUkVDSVNJT04gKiBkc3RRdHkpOwogICAgICAgICAgICBkZW5vbWluYXRvciA9IChyYXRlICogKDEwKiooZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChudW1lcmF0b3IgKyBkZW5vbWluYXRvciAtIDEpIC8gZGVub21pbmF0b3I7IC8vYXZvaWQgcm91bmRpbmcgZG93biBlcnJvcnMKICAgIH0KfQoKaW50ZXJmYWNlIEt5YmVyUmVzZXJ2ZUludGVyZmFjZSB7CgogICAgZnVuY3Rpb24gdHJhZGUoCiAgICAgICAgRVJDMjAgc3JjVG9rZW4sCiAgICAgICAgdWludCBzcmNBbW91bnQsCiAgICAgICAgRVJDMjAgZGVzdFRva2VuLAogICAgICAgIGFkZHJlc3MgZGVzdEFkZHJlc3MsCiAgICAgICAgdWludCBjb252ZXJzaW9uUmF0ZSwKICAgICAgICBib29sIHZhbGlkYXRlCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIHJldHVybnMoYm9vbCk7CgogICAgZnVuY3Rpb24gZ2V0Q29udmVyc2lvblJhdGUoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY1F0eSwgdWludCBibG9ja051bWJlcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KTsKfQoKY29udHJhY3QgV2l0aGRyYXdhYmxlIGlzIFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGV2ZW50IFRva2VuV2l0aGRyYXcoRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IGFsbCBFUkMyMCBjb21wYXRpYmxlIHRva2VucwogICAgICogQHBhcmFtIHRva2VuIEVSQzIwIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihzZW5kVG8sIGFtb3VudCkpOwogICAgICAgIFRva2VuV2l0aGRyYXcodG9rZW4sIGFtb3VudCwgc2VuZFRvKTsKICAgIH0KCiAgICBldmVudCBFdGhlcldpdGhkcmF3KHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IEV0aGVycwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBzZW5kVG8udHJhbnNmZXIoYW1vdW50KTsKICAgICAgICBFdGhlcldpdGhkcmF3KGFtb3VudCwgc2VuZFRvKTsKICAgIH0KfQoKY29udHJhY3QgS3liZXJOZXR3b3JrIGlzIFdpdGhkcmF3YWJsZSwgVXRpbHMgewoKICAgIHVpbnQgcHVibGljIG5lZ2xpZ2libGVSYXRlRGlmZiA9IDEwOyAvLyBiYXNpYyByYXRlIHN0ZXBzIHdpbGwgYmUgaW4gMC4wMSUKICAgIEt5YmVyUmVzZXJ2ZUludGVyZmFjZVtdIHB1YmxpYyByZXNlcnZlczsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgcHVibGljIGlzUmVzZXJ2ZTsKICAgIFdoaXRlTGlzdEludGVyZmFjZSBwdWJsaWMgd2hpdGVMaXN0Q29udHJhY3Q7CiAgICBFeHBlY3RlZFJhdGVJbnRlcmZhY2UgcHVibGljIGV4cGVjdGVkUmF0ZUNvbnRyYWN0OwogICAgRmVlQnVybmVySW50ZXJmYWNlICAgIHB1YmxpYyBmZWVCdXJuZXJDb250cmFjdDsKICAgIHVpbnQgICAgICAgICAgICAgICAgICBwdWJsaWMgbWF4R2FzUHJpY2UgPSA1MCAqIDEwMDAgKiAxMDAwICogMTAwMDsgLy8gNTAgZ3dlaQogICAgYm9vbCAgICAgICAgICAgICAgICAgIHB1YmxpYyBlbmFibGVkID0gZmFsc2U7IC8vIG5ldHdvcmsgaXMgZW5hYmxlZAogICAgbWFwcGluZyhhZGRyZXNzPT5tYXBwaW5nKGJ5dGVzMzI9PmJvb2wpKSBwdWJsaWMgcGVyUmVzZXJ2ZUxpc3RlZFBhaXJzOwoKICAgIGZ1bmN0aW9uIEt5YmVyTmV0d29yayhhZGRyZXNzIF9hZG1pbikgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9hZG1pbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICBhZG1pbiA9IF9hZG1pbjsKICAgIH0KCiAgICBldmVudCBFdGhlclJlY2VpdmFsKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQgYW1vdW50KTsKCiAgICAvKiBzb2xoaW50LWRpc2FibGUgbm8tY29tcGxleC1mYWxsYmFjayAqLwogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShpc1Jlc2VydmVbbXNnLnNlbmRlcl0pOwogICAgICAgIEV0aGVyUmVjZWl2YWwobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KICAgIC8qIHNvbGhpbnQtZW5hYmxlIG5vLWNvbXBsZXgtZmFsbGJhY2sgKi8KCiAgICBldmVudCBFeGVjdXRlVHJhZGUoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IGFjdHVhbFNyY0Ftb3VudCwgdWludCBhY3R1YWxEZXN0QW1vdW50KTsKCiAgICAvLy8gQG5vdGljZSB1c2UgdG9rZW4gYWRkcmVzcyBFVEhfVE9LRU5fQUREUkVTUyBmb3IgZXRoZXIKICAgIC8vLyBAZGV2IG1ha2VzIGEgdHJhZGUgYmV0d2VlbiBzcmMgYW5kIGRlc3QgdG9rZW4gYW5kIHNlbmQgZGVzdCB0b2tlbiB0byBkZXN0QWRkcmVzcwogICAgLy8vIEBwYXJhbSBzcmMgU3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIHNyY0Ftb3VudCBhbW91bnQgb2Ygc3JjIHRva2VucwogICAgLy8vIEBwYXJhbSBkZXN0ICAgRGVzdGluYXRpb24gdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVzdEFkZHJlc3MgQWRkcmVzcyB0byBzZW5kIHRva2VucyB0bwogICAgLy8vIEBwYXJhbSBtYXhEZXN0QW1vdW50IEEgbGltaXQgb24gdGhlIGFtb3VudCBvZiBkZXN0IHRva2VucwogICAgLy8vIEBwYXJhbSBtaW5Db252ZXJzaW9uUmF0ZSBUaGUgbWluaW1hbCBjb252ZXJzaW9uIHJhdGUuIElmIGFjdHVhbCByYXRlIGlzIGxvd2VyLCB0cmFkZSBpcyBjYW5jZWxlZC4KICAgIC8vLyBAcGFyYW0gd2FsbGV0SWQgaXMgdGhlIHdhbGxldCBJRCB0byBzZW5kIHBhcnQgb2YgdGhlIGZlZXMKICAgIC8vLyBAcmV0dXJuIGFtb3VudCBvZiBhY3R1YWwgZGVzdCB0b2tlbnMKICAgIGZ1bmN0aW9uIHRyYWRlKAogICAgICAgIEVSQzIwIHNyYywKICAgICAgICB1aW50IHNyY0Ftb3VudCwKICAgICAgICBFUkMyMCBkZXN0LAogICAgICAgIGFkZHJlc3MgZGVzdEFkZHJlc3MsCiAgICAgICAgdWludCBtYXhEZXN0QW1vdW50LAogICAgICAgIHVpbnQgbWluQ29udmVyc2lvblJhdGUsCiAgICAgICAgYWRkcmVzcyB3YWxsZXRJZAogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICByZXR1cm5zKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShlbmFibGVkKTsKCiAgICAgICAgdWludCB1c2VyU3JjQmFsYW5jZUJlZm9yZTsKICAgICAgICB1aW50IHVzZXJTcmNCYWxhbmNlQWZ0ZXI7CiAgICAgICAgdWludCB1c2VyRGVzdEJhbGFuY2VCZWZvcmU7CiAgICAgICAgdWludCB1c2VyRGVzdEJhbGFuY2VBZnRlcjsKCiAgICAgICAgdXNlclNyY0JhbGFuY2VCZWZvcmUgPSBnZXRCYWxhbmNlKHNyYywgbXNnLnNlbmRlcik7CiAgICAgICAgaWYgKHNyYyA9PSBFVEhfVE9LRU5fQUREUkVTUykKICAgICAgICAgICAgdXNlclNyY0JhbGFuY2VCZWZvcmUgKz0gbXNnLnZhbHVlOwogICAgICAgIHVzZXJEZXN0QmFsYW5jZUJlZm9yZSA9IGdldEJhbGFuY2UoZGVzdCwgZGVzdEFkZHJlc3MpOwoKICAgICAgICB1aW50IGFjdHVhbERlc3RBbW91bnQgPSBkb1RyYWRlKHNyYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNyY0Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0QWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heERlc3RBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5Db252ZXJzaW9uUmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhbGxldElkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgIHJlcXVpcmUoYWN0dWFsRGVzdEFtb3VudCA+IDApOwoKICAgICAgICB1c2VyU3JjQmFsYW5jZUFmdGVyID0gZ2V0QmFsYW5jZShzcmMsIG1zZy5zZW5kZXIpOwogICAgICAgIHVzZXJEZXN0QmFsYW5jZUFmdGVyID0gZ2V0QmFsYW5jZShkZXN0LCBkZXN0QWRkcmVzcyk7CgogICAgICAgIHJlcXVpcmUodXNlclNyY0JhbGFuY2VBZnRlciA8PSB1c2VyU3JjQmFsYW5jZUJlZm9yZSk7CiAgICAgICAgcmVxdWlyZSh1c2VyRGVzdEJhbGFuY2VBZnRlciA+PSB1c2VyRGVzdEJhbGFuY2VCZWZvcmUpOwoKICAgICAgICByZXF1aXJlKCh1c2VyRGVzdEJhbGFuY2VBZnRlciAtIHVzZXJEZXN0QmFsYW5jZUJlZm9yZSkgPj0KICAgICAgICAgICAgY2FsY0RzdFF0eSgodXNlclNyY0JhbGFuY2VCZWZvcmUgLSB1c2VyU3JjQmFsYW5jZUFmdGVyKSwgZ2V0RGVjaW1hbHMoc3JjKSwgZ2V0RGVjaW1hbHMoZGVzdCksCiAgICAgICAgICAgICAgICBtaW5Db252ZXJzaW9uUmF0ZSkpOwoKICAgICAgICByZXR1cm4gYWN0dWFsRGVzdEFtb3VudDsKICAgIH0KCiAgICBldmVudCBBZGRSZXNlcnZlVG9OZXR3b3JrKEt5YmVyUmVzZXJ2ZUludGVyZmFjZSByZXNlcnZlLCBib29sIGFkZCk7CgogICAgLy8vIEBub3RpY2UgY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGFkbWluCiAgICAvLy8gQGRldiBhZGQgb3IgZGVsZXRlcyBhIHJlc2VydmUgdG8vZnJvbSB0aGUgbmV0d29yay4KICAgIC8vLyBAcGFyYW0gcmVzZXJ2ZSBUaGUgcmVzZXJ2ZSBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGQgSWYgdHJ1ZSwgdGhlIGFkZCByZXNlcnZlLiBPdGhlcndpc2UgZGVsZXRlIHJlc2VydmUuCiAgICBmdW5jdGlvbiBhZGRSZXNlcnZlKEt5YmVyUmVzZXJ2ZUludGVyZmFjZSByZXNlcnZlLCBib29sIGFkZCkgcHVibGljIG9ubHlBZG1pbiB7CgogICAgICAgIGlmIChhZGQpIHsKICAgICAgICAgICAgcmVxdWlyZSghaXNSZXNlcnZlW3Jlc2VydmVdKTsKICAgICAgICAgICAgcmVzZXJ2ZXMucHVzaChyZXNlcnZlKTsKICAgICAgICAgICAgaXNSZXNlcnZlW3Jlc2VydmVdID0gdHJ1ZTsKICAgICAgICAgICAgQWRkUmVzZXJ2ZVRvTmV0d29yayhyZXNlcnZlLCB0cnVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpc1Jlc2VydmVbcmVzZXJ2ZV0gPSBmYWxzZTsKICAgICAgICAgICAgLy8gd2lsbCBoYXZlIHRyb3VibGUgaWYgbW9yZSB0aGFuIDUwayByZXNlcnZlcy4uLgogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByZXNlcnZlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHJlc2VydmVzW2ldID09IHJlc2VydmUpIHsKICAgICAgICAgICAgICAgICAgICByZXNlcnZlc1tpXSA9IHJlc2VydmVzW3Jlc2VydmVzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgICAgIHJlc2VydmVzLmxlbmd0aC0tOwogICAgICAgICAgICAgICAgICAgIEFkZFJlc2VydmVUb05ldHdvcmsocmVzZXJ2ZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGV2ZW50IExpc3RSZXNlcnZlUGFpcnMoYWRkcmVzcyByZXNlcnZlLCBFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIGJvb2wgYWRkKTsKCiAgICAvLy8gQG5vdGljZSBjYW4gYmUgY2FsbGVkIG9ubHkgYnkgYWRtaW4KICAgIC8vLyBAZGV2IGFsbG93IG9yIHByZXZlbnQgYSBzcGVjaWZpYyByZXNlcnZlIHRvIHRyYWRlIGEgcGFpciBvZiB0b2tlbnMKICAgIC8vLyBAcGFyYW0gcmVzZXJ2ZSBUaGUgcmVzZXJ2ZSBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBzcmMgU3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3QgRGVzdGluYXRpb24gdG9rZW4KICAgIC8vLyBAcGFyYW0gYWRkIElmIHRydWUgdGhlbiBlbmFibGUgdHJhZGUsIG90aGVyd2lzZSBkZWxpc3QgcGFpci4KICAgIGZ1bmN0aW9uIGxpc3RQYWlyRm9yUmVzZXJ2ZShhZGRyZXNzIHJlc2VydmUsIEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgYm9vbCBhZGQpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIChwZXJSZXNlcnZlTGlzdGVkUGFpcnNbcmVzZXJ2ZV0pW2tlY2NhazI1NihzcmMsIGRlc3QpXSA9IGFkZDsKCiAgICAgICAgaWYgKHNyYyAhPSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBpZiAoYWRkKSB7CiAgICAgICAgICAgICAgICBzcmMuYXBwcm92ZShyZXNlcnZlLCAyKioyNTUpOyAvLyBhcHByb3ZlIGluZmluaXR5CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzcmMuYXBwcm92ZShyZXNlcnZlLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2V0RGVjaW1hbHMoc3JjKTsKICAgICAgICBzZXREZWNpbWFscyhkZXN0KTsKCiAgICAgICAgTGlzdFJlc2VydmVQYWlycyhyZXNlcnZlLCBzcmMsIGRlc3QsIGFkZCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UGFyYW1zKAogICAgICAgIFdoaXRlTGlzdEludGVyZmFjZSAgICBfd2hpdGVMaXN0LAogICAgICAgIEV4cGVjdGVkUmF0ZUludGVyZmFjZSBfZXhwZWN0ZWRSYXRlLAogICAgICAgIEZlZUJ1cm5lckludGVyZmFjZSAgICBfZmVlQnVybmVyLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgICBfbWF4R2FzUHJpY2UsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICAgIF9uZWdsaWdpYmxlUmF0ZURpZmYKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5QWRtaW4KICAgIHsKICAgICAgICByZXF1aXJlKF93aGl0ZUxpc3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfZmVlQnVybmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2V4cGVjdGVkUmF0ZSAhPSBhZGRyZXNzKDApKTsKICAgICAgICB3aGl0ZUxpc3RDb250cmFjdCA9IF93aGl0ZUxpc3Q7CiAgICAgICAgZXhwZWN0ZWRSYXRlQ29udHJhY3QgPSBfZXhwZWN0ZWRSYXRlOwogICAgICAgIGZlZUJ1cm5lckNvbnRyYWN0ID0gX2ZlZUJ1cm5lcjsKICAgICAgICBtYXhHYXNQcmljZSA9IF9tYXhHYXNQcmljZTsKICAgICAgICBuZWdsaWdpYmxlUmF0ZURpZmYgPSBfbmVnbGlnaWJsZVJhdGVEaWZmOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEVuYWJsZShib29sIF9lbmFibGUpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIGlmIChfZW5hYmxlKSB7CiAgICAgICAgICAgIHJlcXVpcmUod2hpdGVMaXN0Q29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgICAgIHJlcXVpcmUoZmVlQnVybmVyQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgICAgIHJlcXVpcmUoZXhwZWN0ZWRSYXRlQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgfQogICAgICAgIGVuYWJsZWQgPSBfZW5hYmxlOwogICAgfQoKICAgIC8vLyBAZGV2IHJldHVybnMgbnVtYmVyIG9mIHJlc2VydmVzCiAgICAvLy8gQHJldHVybiBudW1iZXIgb2YgcmVzZXJ2ZXMKICAgIGZ1bmN0aW9uIGdldE51bVJlc2VydmVzKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJlc2VydmVzLmxlbmd0aDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBzaG91bGQgYmUgY2FsbGVkIG9mZiBjaGFpbiB3aXRoIGFzIG11Y2ggZ2FzIGFzIG5lZWRlZAogICAgLy8vIEBkZXYgZ2V0IGFuIGFycmF5IG9mIGFsbCByZXNlcnZlcwogICAgLy8vIEByZXR1cm4gQW4gYXJyYXkgb2YgYWxsIHJlc2VydmVzCiAgICBmdW5jdGlvbiBnZXRSZXNlcnZlcygpIHB1YmxpYyB2aWV3IHJldHVybnMoS3liZXJSZXNlcnZlSW50ZXJmYWNlW10pIHsKICAgICAgICByZXR1cm4gcmVzZXJ2ZXM7CiAgICB9CgogICAgLy8vIEBkZXYgZ2V0IHRoZSBiYWxhbmNlIG9mIGEgdXNlci4KICAgIC8vLyBAcGFyYW0gdG9rZW4gVGhlIHRva2VuIHR5cGUKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHVzZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIGlmICh0b2tlbiA9PSBFVEhfVE9LRU5fQUREUkVTUykKICAgICAgICAgICAgcmV0dXJuIHVzZXIuYmFsYW5jZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2YodXNlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBiZXN0IGNvbnZlcnNpb24gcmF0ZSBmb3IgYSBwYWlyIG9mIHRva2VucywgaWYgbnVtYmVyIG9mIHJlc2VydmVzIGhhdmUgc21hbGwgZGlmZmVyZW5jZXMuIHJhbmRvbWl6ZQogICAgLy8vIEBwYXJhbSBzcmMgU3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3QgRGVzdGluYXRpb24gdG9rZW4KICAgIC8qIHNvbGhpbnQtZGlzYWJsZSBjb2RlLWNvbXBsZXhpdHkgKi8KICAgIGZ1bmN0aW9uIGZpbmRCZXN0UmF0ZShFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgc3JjUXR5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQsIHVpbnQpIHsKICAgICAgICB1aW50IGJlc3RSYXRlID0gMDsKICAgICAgICB1aW50IGJlc3RSZXNlcnZlID0gMDsKICAgICAgICB1aW50IG51bVJlbGV2YW50UmVzZXJ2ZXMgPSAwOwogICAgICAgIHVpbnQgbnVtUmVzZXJ2ZXMgPSByZXNlcnZlcy5sZW5ndGg7CiAgICAgICAgdWludFtdIG1lbW9yeSByYXRlcyA9IG5ldyB1aW50W10obnVtUmVzZXJ2ZXMpOwogICAgICAgIHVpbnRbXSBtZW1vcnkgcmVzZXJ2ZUNhbmRpZGF0ZXMgPSBuZXcgdWludFtdKG51bVJlc2VydmVzKTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtUmVzZXJ2ZXM7IGkrKykgewogICAgICAgICAgICAvL2xpc3QgYWxsIHJlc2VydmVzIHRoYXQgaGF2ZSB0aGlzIHRva2VuLgogICAgICAgICAgICBpZiAoIShwZXJSZXNlcnZlTGlzdGVkUGFpcnNbcmVzZXJ2ZXNbaV1dKVtrZWNjYWsyNTYoc3JjLCBkZXN0KV0pIGNvbnRpbnVlOwoKICAgICAgICAgICAgcmF0ZXNbaV0gPSByZXNlcnZlc1tpXS5nZXRDb252ZXJzaW9uUmF0ZShzcmMsIGRlc3QsIHNyY1F0eSwgYmxvY2subnVtYmVyKTsKCiAgICAgICAgICAgIGlmIChyYXRlc1tpXSA+IGJlc3RSYXRlKSB7CiAgICAgICAgICAgICAgICAvL2Jlc3QgcmF0ZSBpcyBoaWdoZXN0IHJhdGUKICAgICAgICAgICAgICAgIGJlc3RSYXRlID0gcmF0ZXNbaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChiZXN0UmF0ZSA+IDApIHsKICAgICAgICAgICAgdWludCByYW5kb20gPSAwOwogICAgICAgICAgICB1aW50IHNtYWxsZXN0UmVsZXZhbnRSYXRlID0gKGJlc3RSYXRlICogMTAwMDApIC8gKDEwMDAwICsgbmVnbGlnaWJsZVJhdGVEaWZmKTsKCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1SZXNlcnZlczsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocmF0ZXNbaV0gPj0gc21hbGxlc3RSZWxldmFudFJhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZXNlcnZlQ2FuZGlkYXRlc1tudW1SZWxldmFudFJlc2VydmVzKytdID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG51bVJlbGV2YW50UmVzZXJ2ZXMgPiAxKSB7CiAgICAgICAgICAgICAgICAvL3doZW4gZW5jb3VudGVyaW5nIHNtYWxsIHJhdGUgZGlmZiBmcm9tIGJlc3RSYXRlLiBkcmF3IGZyb20gcmVsZXZhbnQgcmVzZXJ2ZXMKICAgICAgICAgICAgICAgIHJhbmRvbSA9IHVpbnQoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSkgJSBudW1SZWxldmFudFJlc2VydmVzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBiZXN0UmVzZXJ2ZSA9IHJlc2VydmVDYW5kaWRhdGVzW3JhbmRvbV07CiAgICAgICAgICAgIGJlc3RSYXRlID0gcmF0ZXNbYmVzdFJlc2VydmVdOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChiZXN0UmVzZXJ2ZSwgYmVzdFJhdGUpOwogICAgfQogICAgLyogc29saGludC1lbmFibGUgY29kZS1jb21wbGV4aXR5ICovCgogICAgZnVuY3Rpb24gZ2V0RXhwZWN0ZWRSYXRlKEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBzcmNRdHkpCiAgICAgICAgcHVibGljIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IGV4cGVjdGVkUmF0ZSwgdWludCBzbGlwcGFnZVJhdGUpCiAgICB7CiAgICAgICAgcmVxdWlyZShleHBlY3RlZFJhdGVDb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXR1cm4gZXhwZWN0ZWRSYXRlQ29udHJhY3QuZ2V0RXhwZWN0ZWRSYXRlKHNyYywgZGVzdCwgc3JjUXR5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRVc2VyQ2FwSW5XZWkoYWRkcmVzcyB1c2VyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gd2hpdGVMaXN0Q29udHJhY3QuZ2V0VXNlckNhcEluV2VpKHVzZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRvVHJhZGUoCiAgICAgICAgRVJDMjAgc3JjLAogICAgICAgIHVpbnQgc3JjQW1vdW50LAogICAgICAgIEVSQzIwIGRlc3QsCiAgICAgICAgYWRkcmVzcyBkZXN0QWRkcmVzcywKICAgICAgICB1aW50IG1heERlc3RBbW91bnQsCiAgICAgICAgdWludCBtaW5Db252ZXJzaW9uUmF0ZSwKICAgICAgICBhZGRyZXNzIHdhbGxldElkCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zKHVpbnQpCiAgICB7CiAgICAgICAgcmVxdWlyZSh0eC5nYXNwcmljZSA8PSBtYXhHYXNQcmljZSk7CiAgICAgICAgcmVxdWlyZSh2YWxpZGF0ZVRyYWRlSW5wdXQoc3JjLCBzcmNBbW91bnQsIGRlc3RBZGRyZXNzKSk7CgogICAgICAgIHVpbnQgcmVzZXJ2ZUluZDsKICAgICAgICB1aW50IHJhdGU7CgogICAgICAgIChyZXNlcnZlSW5kLCByYXRlKSA9IGZpbmRCZXN0UmF0ZShzcmMsIGRlc3QsIHNyY0Ftb3VudCk7CiAgICAgICAgS3liZXJSZXNlcnZlSW50ZXJmYWNlIHRoZVJlc2VydmUgPSByZXNlcnZlc1tyZXNlcnZlSW5kXTsKICAgICAgICByZXF1aXJlKHJhdGUgPiAwKTsKICAgICAgICByZXF1aXJlKHJhdGUgPCBNQVhfUkFURSk7CiAgICAgICAgcmVxdWlyZShyYXRlID49IG1pbkNvbnZlcnNpb25SYXRlKTsKCiAgICAgICAgdWludCBhY3R1YWxTcmNBbW91bnQgPSBzcmNBbW91bnQ7CiAgICAgICAgdWludCBhY3R1YWxEZXN0QW1vdW50ID0gY2FsY0Rlc3RBbW91bnQoc3JjLCBkZXN0LCBhY3R1YWxTcmNBbW91bnQsIHJhdGUpOwogICAgICAgIGlmIChhY3R1YWxEZXN0QW1vdW50ID4gbWF4RGVzdEFtb3VudCkgewogICAgICAgICAgICBhY3R1YWxEZXN0QW1vdW50ID0gbWF4RGVzdEFtb3VudDsKICAgICAgICAgICAgYWN0dWFsU3JjQW1vdW50ID0gY2FsY1NyY0Ftb3VudChzcmMsIGRlc3QsIGFjdHVhbERlc3RBbW91bnQsIHJhdGUpOwogICAgICAgICAgICByZXF1aXJlKGFjdHVhbFNyY0Ftb3VudCA8PSBzcmNBbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgLy8gZG8gdGhlIHRyYWRlCiAgICAgICAgLy8gdmVyaWZ5IHRyYWRlIHNpemUgaXMgc21hbGxlciB0aGFuIHVzZXIgY2FwCiAgICAgICAgdWludCBldGhBbW91bnQ7CiAgICAgICAgaWYgKHNyYyA9PSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBldGhBbW91bnQgPSBhY3R1YWxTcmNBbW91bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXRoQW1vdW50ID0gYWN0dWFsRGVzdEFtb3VudDsKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoZXRoQW1vdW50IDw9IGdldFVzZXJDYXBJbldlaShtc2cuc2VuZGVyKSk7CiAgICAgICAgcmVxdWlyZShkb1Jlc2VydmVUcmFkZSgKICAgICAgICAgICAgICAgIHNyYywKICAgICAgICAgICAgICAgIGFjdHVhbFNyY0Ftb3VudCwKICAgICAgICAgICAgICAgIGRlc3QsCiAgICAgICAgICAgICAgICBkZXN0QWRkcmVzcywKICAgICAgICAgICAgICAgIGFjdHVhbERlc3RBbW91bnQsCiAgICAgICAgICAgICAgICB0aGVSZXNlcnZlLAogICAgICAgICAgICAgICAgcmF0ZSwKICAgICAgICAgICAgICAgIHRydWUpKTsKCiAgICAgICAgaWYgKChhY3R1YWxTcmNBbW91bnQgPCBzcmNBbW91bnQpICYmIChzcmMgPT0gRVRIX1RPS0VOX0FERFJFU1MpKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoc3JjQW1vdW50IC0gYWN0dWFsU3JjQW1vdW50KTsKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoZmVlQnVybmVyQ29udHJhY3QuaGFuZGxlRmVlcyhldGhBbW91bnQsIHRoZVJlc2VydmUsIHdhbGxldElkKSk7CgogICAgICAgIEV4ZWN1dGVUcmFkZShtc2cuc2VuZGVyLCBzcmMsIGRlc3QsIGFjdHVhbFNyY0Ftb3VudCwgYWN0dWFsRGVzdEFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFjdHVhbERlc3RBbW91bnQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBkbyBvbmUgdHJhZGUgd2l0aCBhIHJlc2VydmUKICAgIC8vLyBAcGFyYW0gc3JjIFNyYyB0b2tlbgogICAgLy8vIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHNyYyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gZGVzdCAgIERlc3RpbmF0aW9uIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RBZGRyZXNzIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgIC8vLyBAcGFyYW0gcmVzZXJ2ZSBSZXNlcnZlIHRvIHVzZQogICAgLy8vIEBwYXJhbSB2YWxpZGF0ZSBJZiB0cnVlLCBhZGRpdGlvbmFsIHZhbGlkYXRpb25zIGFyZSBhcHBsaWNhYmxlCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIHRyYWRlIGlzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvUmVzZXJ2ZVRyYWRlKAogICAgICAgIEVSQzIwIHNyYywKICAgICAgICB1aW50IGFtb3VudCwKICAgICAgICBFUkMyMCBkZXN0LAogICAgICAgIGFkZHJlc3MgZGVzdEFkZHJlc3MsCiAgICAgICAgdWludCBleHBlY3RlZERlc3RBbW91bnQsCiAgICAgICAgS3liZXJSZXNlcnZlSW50ZXJmYWNlIHJlc2VydmUsCiAgICAgICAgdWludCBjb252ZXJzaW9uUmF0ZSwKICAgICAgICBib29sIHZhbGlkYXRlCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zKGJvb2wpCiAgICB7CiAgICAgICAgdWludCBjYWxsVmFsdWUgPSAwOwoKICAgICAgICBpZiAoc3JjID09IEVUSF9UT0tFTl9BRERSRVNTKSB7CiAgICAgICAgICAgIGNhbGxWYWx1ZSA9IGFtb3VudDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0YWtlIHNyYyB0b2tlbnMgdG8gdGhpcyBjb250cmFjdAogICAgICAgICAgICBzcmMudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIGFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXNlcnZlIHNlbmRzIHRva2Vucy9ldGggdG8gbmV0d29yay4gbmV0d29yayBzZW5kcyBpdCB0byBkZXN0aW5hdGlvbgogICAgICAgIHJlcXVpcmUocmVzZXJ2ZS50cmFkZS52YWx1ZShjYWxsVmFsdWUpKHNyYywgYW1vdW50LCBkZXN0LCB0aGlzLCBjb252ZXJzaW9uUmF0ZSwgdmFsaWRhdGUpKTsKCiAgICAgICAgaWYgKGRlc3QgPT0gRVRIX1RPS0VOX0FERFJFU1MpIHsKICAgICAgICAgICAgZGVzdEFkZHJlc3MudHJhbnNmZXIoZXhwZWN0ZWREZXN0QW1vdW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXF1aXJlKGRlc3QudHJhbnNmZXIoZGVzdEFkZHJlc3MsIGV4cGVjdGVkRGVzdEFtb3VudCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY0Rlc3RBbW91bnQoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY0Ftb3VudCwgdWludCByYXRlKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBjYWxjRHN0UXR5KHNyY0Ftb3VudCwgZ2V0RGVjaW1hbHMoc3JjKSwgZ2V0RGVjaW1hbHMoZGVzdCksIHJhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNTcmNBbW91bnQoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IGRlc3RBbW91bnQsIHVpbnQgcmF0ZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gY2FsY1NyY1F0eShkZXN0QW1vdW50LCBnZXREZWNpbWFscyhzcmMpLCBnZXREZWNpbWFscyhkZXN0KSwgcmF0ZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBjaGVja3MgdGhhdCB1c2VyIHNlbnQgZXRoZXIvdG9rZW5zIHRvIGNvbnRyYWN0IGJlZm9yZSB0cmFkZQogICAgLy8vIEBwYXJhbSBzcmMgU3JjIHRva2VuCiAgICAvLy8gQHBhcmFtIHNyY0Ftb3VudCBhbW91bnQgb2Ygc3JjIHRva2VucwogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBpbnB1dCBpcyB2YWxpZAogICAgZnVuY3Rpb24gdmFsaWRhdGVUcmFkZUlucHV0KEVSQzIwIHNyYywgdWludCBzcmNBbW91bnQsIGFkZHJlc3MgZGVzdEFkZHJlc3MpIGludGVybmFsIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYgKChzcmNBbW91bnQgPj0gTUFYX1FUWSkgfHwgKHNyY0Ftb3VudCA9PSAwKSB8fCAoZGVzdEFkZHJlc3MgPT0gMCkpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKHNyYyA9PSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBpZiAobXNnLnZhbHVlICE9IHNyY0Ftb3VudCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoKG1zZy52YWx1ZSAhPSAwKSB8fCAoc3JjLmFsbG93YW5jZShtc2cuc2VuZGVyLCB0aGlzKSA8IHNyY0Ftb3VudCkpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKaW50ZXJmYWNlIEZlZUJ1cm5lckludGVyZmFjZSB7CiAgICBmdW5jdGlvbiBoYW5kbGVGZWVzICh1aW50IHRyYWRlV2VpQW1vdW50LCBhZGRyZXNzIHJlc2VydmUsIGFkZHJlc3Mgd2FsbGV0KSBwdWJsaWMgcmV0dXJucyhib29sKTsKfQoKaW50ZXJmYWNlIEVSQzIwIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBzdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50IGRpZ2l0cyk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKfQoKaW50ZXJmYWNlIEV4cGVjdGVkUmF0ZUludGVyZmFjZSB7CiAgICBmdW5jdGlvbiBnZXRFeHBlY3RlZFJhdGUoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY1F0eSkgcHVibGljIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IGV4cGVjdGVkUmF0ZSwgdWludCBzbGlwcGFnZVJhdGUpOwp9Cgpjb250cmFjdCBXaGl0ZUxpc3RJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gZ2V0VXNlckNhcEluV2VpKGFkZHJlc3MgdXNlcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHVzZXJDYXBXZWkpOwp9'.
	

]
