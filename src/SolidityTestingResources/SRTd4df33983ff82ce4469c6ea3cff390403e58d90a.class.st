Class {
	#name : #SRTd4df33983ff82ce4469c6ea3cff390403e58d90a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd4df33983ff82ce4469c6ea3cff390403e58d90a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCgovKioKICogQHRpdGxlIENsYWltYWJsZQogKiBAZGV2IEV4dGVuc2lvbiBmb3IgdGhlIE93bmFibGUgY29udHJhY3QsIHdoZXJlIHRoZSBvd25lcnNoaXAgbmVlZHMgdG8gYmUgY2xhaW1lZC4KICogVGhpcyBhbGxvd3MgdGhlIG5ldyBvd25lciB0byBhY2NlcHQgdGhlIHRyYW5zZmVyLgogKi8KY29udHJhY3QgQ2xhaW1hYmxlIGlzIE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIHBlbmRpbmdPd25lcjsKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0aHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIHBlbmRpbmdPd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5UGVuZGluZ093bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHBlbmRpbmdPd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gc2V0IHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcy4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcGVuZGluZ093bmVyID0gbmV3T3duZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MgdG8gZmluYWxpemUgdGhlIHRyYW5zZmVyLgogICAqLwogIGZ1bmN0aW9uIGNsYWltT3duZXJzaGlwKCkgb25seVBlbmRpbmdPd25lciBwdWJsaWMgewogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIHBlbmRpbmdPd25lcik7CiAgICBvd25lciA9IHBlbmRpbmdPd25lcjsKICAgIHBlbmRpbmdPd25lciA9IGFkZHJlc3MoMCk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFNhZmVFUkMyMAogKiBAZGV2IFdyYXBwZXJzIGFyb3VuZCBFUkMyMCBvcGVyYXRpb25zIHRoYXQgdGhyb3cgb24gZmFpbHVyZS4KICogVG8gdXNlIHRoaXMgbGlicmFyeSB5b3UgY2FuIGFkZCBhIGB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwO2Agc3RhdGVtZW50IHRvIHlvdXIgY29udHJhY3QsCiAqIHdoaWNoIGFsbG93cyB5b3UgdG8gY2FsbCB0aGUgc2FmZSBvcGVyYXRpb25zIGFzIGB0b2tlbi5zYWZlVHJhbnNmZXIoLi4uKWAsIGV0Yy4KICovCmxpYnJhcnkgU2FmZUVSQzIwIHsKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXIoRVJDMjBCYXNpYyB0b2tlbiwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyRnJvbShFUkMyMCB0b2tlbiwgYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSkpOwogIH0KCiAgZnVuY3Rpb24gc2FmZUFwcHJvdmUoRVJDMjAgdG9rZW4sIGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpKTsKICB9Cn0KCgovKioKICogQHRpdGxlIENvbnRyYWN0cyB0aGF0IHNob3VsZCBiZSBhYmxlIHRvIHJlY292ZXIgdG9rZW5zCiAqIEBhdXRob3IgU3lsVGkKICogQGRldiBUaGlzIGFsbG93IGEgY29udHJhY3QgdG8gcmVjb3ZlciBhbnkgRVJDMjAgdG9rZW4gcmVjZWl2ZWQgaW4gYSBjb250cmFjdCBieSB0cmFuc2ZlcnJpbmcgdGhlIGJhbGFuY2UgdG8gdGhlIGNvbnRyYWN0IG93bmVyLgogKiBUaGlzIHdpbGwgcHJldmVudCBhbnkgYWNjaWRlbnRhbCBsb3NzIG9mIHRva2Vucy4KICovCmNvbnRyYWN0IENhblJlY2xhaW1Ub2tlbiBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlRVJDMjAgZm9yIEVSQzIwQmFzaWM7CgogIC8qKgogICAqIEBkZXYgUmVjbGFpbSBhbGwgRVJDMjBCYXNpYyBjb21wYXRpYmxlIHRva2VucwogICAqIEBwYXJhbSB0b2tlbiBFUkMyMEJhc2ljIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAqLwogIGZ1bmN0aW9uIHJlY2xhaW1Ub2tlbihFUkMyMEJhc2ljIHRva2VuKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgdG9rZW4uc2FmZVRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICB9Cgp9CgoKLy8vIEB0aXRsZSBJbnRlcmZhY2UgZm9yIGNvbnRyYWN0cyBjb25mb3JtaW5nIHRvIEVSQy03MjE6IERlZWQgU3RhbmRhcmQKLy8vIEBhdXRob3IgV2lsbGlhbSBFbnRyaWtlbiAoaHR0cHM6Ly9waG9yLm5ldCksIGV0IGFsLgovLy8gQGRldiBTcGVjaWZpY2F0aW9uIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL3B1bGwvODQxIChEUkFGVCkKaW50ZXJmYWNlIEVSQzcyMSB7CgogICAgLy8gQ09NUExJQU5DRSBXSVRIIEVSQy0xNjUgKERSQUZUKSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBpdHNlbGYKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSA9IC8vIDB4MDFmZmM5YTcKICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSA9IC8vIDB4ZGE2NzFiOWIKICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdjb3VudE9mRGVlZHMoKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NignY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NignZGVlZE9mT3duZXJCeUluZGV4KGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NigndGFrZU93bmVyc2hpcCh1aW50MjU2KScpKTsKCiAgICAvLy8gQG5vdGljZSBRdWVyeSBhIGNvbnRyYWN0IHRvIHNlZSBpZiBpdCBzdXBwb3J0cyBhIGNlcnRhaW4gaW50ZXJmYWNlCiAgICAvLy8gQGRldiBSZXR1cm5zIGB0cnVlYCB0aGUgaW50ZXJmYWNlIGlzIHN1cHBvcnRlZCBhbmQgYGZhbHNlYCBvdGhlcndpc2UsCiAgICAvLy8gIHJldHVybnMgYHRydWVgIGZvciBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSBhbmQKICAgIC8vLyAgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEsIHNlZSBFUkMtMTY1IGZvciBvdGhlciBpbnRlcmZhY2Ugc2lnbmF0dXJlcy4KICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCk7CgogICAgLy8gUFVCTElDIFFVRVJZIEZVTkNUSU9OUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEZpbmQgdGhlIG93bmVyIG9mIGEgZGVlZAogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIGZvciBhIGRlZWQgd2UgYXJlIGluc3BlY3RpbmcKICAgIC8vLyBAZGV2IERlZWRzIGFzc2lnbmVkIHRvIHplcm8gYWRkcmVzcyBhcmUgY29uc2lkZXJlZCBkZXN0cm95ZWQsIGFuZAogICAgLy8vICBxdWVyaWVzIGFib3V0IHRoZW0gZG8gdGhyb3cuCiAgICAvLy8gQHJldHVybiBUaGUgbm9uLXplcm8gYWRkcmVzcyBvZiB0aGUgb3duZXIgb2YgZGVlZCBgX2RlZWRJZGAsIG9yIGB0aHJvd2AKICAgIC8vLyAgaWYgZGVlZCBgX2RlZWRJZGAgaXMgbm90IHRyYWNrZWQgYnkgdGhpcyBjb250cmFjdAogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwoKICAgIC8vLyBAbm90aWNlIENvdW50IGRlZWRzIHRyYWNrZWQgYnkgdGhpcyBjb250cmFjdAogICAgLy8vIEByZXR1cm4gQSBjb3VudCBvZiB0aGUgZGVlZHMgdHJhY2tlZCBieSB0aGlzIGNvbnRyYWN0LCB3aGVyZSBlYWNoIG9uZSBvZgogICAgLy8vICB0aGVtIGhhcyBhbiBhc3NpZ25lZCBhbmQgcXVlcnlhYmxlIG93bmVyCiAgICBmdW5jdGlvbiBjb3VudE9mRGVlZHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IF9jb3VudCk7CgogICAgLy8vIEBub3RpY2UgQ291bnQgYWxsIGRlZWRzIGFzc2lnbmVkIHRvIGFuIG93bmVyCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgYF9vd25lcmAgaXMgdGhlIHplcm8gYWRkcmVzcywgcmVwcmVzZW50aW5nIGRlc3Ryb3llZCBkZWVkcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFuIGFkZHJlc3Mgd2hlcmUgd2UgYXJlIGludGVyZXN0ZWQgaW4gZGVlZHMgb3duZWQgYnkgdGhlbQogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBkZWVkcyBvd25lZCBieSBgX293bmVyYCwgcG9zc2libHkgemVybwogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfY291bnQpOwoKICAgIC8vLyBAbm90aWNlIEVudW1lcmF0ZSBkZWVkcyBhc3NpZ25lZCB0byBhbiBvd25lcgogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBfaW5kZXhgID49IGBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcilgIG9yIGlmCiAgICAvLy8gIGBfb3duZXJgIGlzIHRoZSB6ZXJvIGFkZHJlc3MsIHJlcHJlc2VudGluZyBkZXN0cm95ZWQgZGVlZHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBbiBhZGRyZXNzIHdoZXJlIHdlIGFyZSBpbnRlcmVzdGVkIGluIGRlZWRzIG93bmVkIGJ5IHRoZW0KICAgIC8vLyBAcGFyYW0gX2luZGV4IEEgY291bnRlciBiZXR3ZWVuIHplcm8gYW5kIGBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcilgLAogICAgLy8vICBpbmNsdXNpdmUKICAgIC8vLyBAcmV0dXJuIFRoZSBpZGVudGlmaWVyIGZvciB0aGUgYF9pbmRleGB0aCBkZWVkIGFzc2lnbmVkIHRvIGBfb3duZXJgLAogICAgLy8vICAgKHNvcnQgb3JkZXIgbm90IHNwZWNpZmllZCkKICAgIGZ1bmN0aW9uIGRlZWRPZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBfZGVlZElkKTsKCiAgICAvLyBUUkFOU0ZFUiBNRUNIQU5JU00gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgVGhpcyBldmVudCBlbWl0cyB3aGVuIG93bmVyc2hpcCBvZiBhbnkgZGVlZCBjaGFuZ2VzIGJ5IGFueQogICAgLy8vICBtZWNoYW5pc20uIFRoaXMgZXZlbnQgZW1pdHMgd2hlbiBkZWVkcyBhcmUgY3JlYXRlZCAoYGZyb21gID09IDApIGFuZAogICAgLy8vICBkZXN0cm95ZWQgKGB0b2AgPT0gMCkuIEV4Y2VwdGlvbjogZHVyaW5nIGNvbnRyYWN0IGNyZWF0aW9uLCBhbnkKICAgIC8vLyAgdHJhbnNmZXJzIG1heSBvY2N1ciB3aXRob3V0IGVtaXR0aW5nIGBUcmFuc2ZlcmAuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgZGVlZElkKTsKCiAgICAvLy8gQGRldiBUaGlzIGV2ZW50IGVtaXRzIG9uIGFueSBzdWNjZXNzZnVsIGNhbGwgdG8KICAgIC8vLyAgYGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfZGVlZElkKWAuIEV4Y2VwdGlvbjogZG9lcyBub3QgZW1pdAogICAgLy8vICBpZiBhbiBvd25lciByZXZva2VzIGFwcHJvdmFsIChgX3RvYCA9PSAweDApIG9uIGEgZGVlZCB3aXRoIG5vIGV4aXN0aW5nCiAgICAvLy8gIGFwcHJvdmFsLgogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQpOwoKICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYSBuZXcgb3duZXIgdG8gdGFrZSB5b3VyIGRlZWQsIG9yIHJldm9rZSBhcHByb3ZhbCBieQogICAgLy8vICBzZXR0aW5nIHRoZSB6ZXJvIGFkZHJlc3MuIFlvdSBtYXkgYGFwcHJvdmVgIGFueSBudW1iZXIgb2YgdGltZXMgd2hpbGUKICAgIC8vLyAgdGhlIGRlZWQgaXMgYXNzaWduZWQgdG8geW91LCBvbmx5IHRoZSBtb3N0IHJlY2VudCBhcHByb3ZhbCBtYXR0ZXJzLgogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBtc2cuc2VuZGVyYCBkb2VzIG5vdCBvd24gZGVlZCBgX2RlZWRJZGAgb3IgaWYgYF90b2AgPT0KICAgIC8vLyAgYG1zZy5zZW5kZXJgLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBkZWVkIHlvdSBhcmUgZ3JhbnRpbmcgb3duZXJzaGlwIG9mCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsOwoKICAgIC8vLyBAbm90aWNlIEJlY29tZSBvd25lciBvZiBhIGRlZWQgZm9yIHdoaWNoIHlvdSBhcmUgY3VycmVudGx5IGFwcHJvdmVkCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgYG1zZy5zZW5kZXJgIGlzIG5vdCBhcHByb3ZlZCB0byBiZWNvbWUgdGhlIG93bmVyIG9mCiAgICAvLy8gIGBkZWVkSWRgIG9yIGlmIGBtc2cuc2VuZGVyYCBjdXJyZW50bHkgb3ducyBgX2RlZWRJZGAuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGRlZWQgdGhhdCBpcyBiZWluZyB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsOwogICAgCiAgICAvLyBTUEVDIEVYVEVOU0lPTlMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgZGVlZCB0byBhIG5ldyBvd25lci4KICAgIC8vLyBAZGV2IFRocm93cyBpZiBgbXNnLnNlbmRlcmAgZG9lcyBub3Qgb3duIGRlZWQgYF9kZWVkSWRgIG9yIGlmCiAgICAvLy8gIGBfdG9gID09IDB4MC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGRlZWQgeW91IGFyZSB0cmFuc2ZlcnJpbmcuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBleHRlcm5hbDsKfQoKCi8vLyBAdGl0bGUgTWV0YWRhdGEgZXh0ZW5zaW9uIHRvIEVSQy03MjEgaW50ZXJmYWNlCi8vLyBAYXV0aG9yIFdpbGxpYW0gRW50cmlrZW4gKGh0dHBzOi8vcGhvci5uZXQpCi8vLyBAZGV2IFNwZWNpZmljYXRpb24gYXQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvcHVsbC84NDEgKERSQUZUKQppbnRlcmZhY2UgRVJDNzIxTWV0YWRhdGEgewoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU1ldGFkYXRhID0gLy8gMHgyYTc4NmYxMQogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3ltYm9sKCknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2RlZWRVcmkodWludDI1NiknKSk7CgogICAgLy8vIEBub3RpY2UgQSBkZXNjcmlwdGl2ZSBuYW1lIGZvciBhIGNvbGxlY3Rpb24gb2YgZGVlZHMgbWFuYWdlZCBieSB0aGlzCiAgICAvLy8gIGNvbnRyYWN0CiAgICAvLy8gQGRldiBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9kZWVkTmFtZSk7CgogICAgLy8vIEBub3RpY2UgQW4gYWJicmV2aWF0ZWQgbmFtZSBmb3IgZGVlZHMgbWFuYWdlZCBieSB0aGlzIGNvbnRyYWN0CiAgICAvLy8gQGRldiBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcgX2RlZWRTeW1ib2wpOwoKICAgIC8vLyBAbm90aWNlIEEgZGlzdGluY3QgVVJJIChSRkMgMzk4NikgZm9yIGEgZ2l2ZW4gdG9rZW4uCiAgICAvLy8gQGRldiBJZjoKICAgIC8vLyAgKiBUaGUgVVJJIGlzIGEgVVJMCiAgICAvLy8gICogVGhlIFVSTCBpcyBhY2Nlc3NpYmxlCiAgICAvLy8gICogVGhlIFVSTCBwb2ludHMgdG8gYSB2YWxpZCBKU09OIGZpbGUgZm9ybWF0IChFQ01BLTQwNCAybmQgZWQuKQogICAgLy8vICAqIFRoZSBKU09OIGJhc2UgZWxlbWVudCBpcyBhbiBvYmplY3QKICAgIC8vLyAgdGhlbiB0aGVzZSBuYW1lcyBvZiB0aGUgYmFzZSBlbGVtZW50IFNIQUxMIGhhdmUgc3BlY2lhbCBtZWFuaW5nOgogICAgLy8vICAqICJuYW1lIjogQSBzdHJpbmcgaWRlbnRpZnlpbmcgdGhlIGl0ZW0gdG8gd2hpY2ggYF9kZWVkSWRgIGdyYW50cwogICAgLy8vICAgIG93bmVyc2hpcAogICAgLy8vICAqICJkZXNjcmlwdGlvbiI6IEEgc3RyaW5nIGRldGFpbGluZyB0aGUgaXRlbSB0byB3aGljaCBgX2RlZWRJZGAgZ3JhbnRzCiAgICAvLy8gICAgb3duZXJzaGlwCiAgICAvLy8gICogImltYWdlIjogQSBVUkkgcG9pbnRpbmcgdG8gYSBmaWxlIG9mIGltYWdlLyogbWltZSB0eXBlIHJlcHJlc2VudGluZwogICAgLy8vICAgIHRoZSBpdGVtIHRvIHdoaWNoIGBfZGVlZElkYCBncmFudHMgb3duZXJzaGlwCiAgICAvLy8gIFdhbGxldHMgYW5kIGV4Y2hhbmdlcyBNQVkgZGlzcGxheSB0aGlzIHRvIHRoZSBlbmQgdXNlci4KICAgIC8vLyAgQ29uc2lkZXIgbWFraW5nIGFueSBpbWFnZXMgYXQgYSB3aWR0aCBiZXR3ZWVuIDMyMCBhbmQgMTA4MCBwaXhlbHMgYW5kCiAgICAvLy8gIGFzcGVjdCByYXRpbyBiZXR3ZWVuIDEuOTE6MSBhbmQgNDo1IGluY2x1c2l2ZS4KICAgIGZ1bmN0aW9uIGRlZWRVcmkodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZyBfdXJpKTsKfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgYWNjZXNzIGNvbnRyb2wgdG8gdGhlIERXb3JsZCBjb250cmFjdC4KY29udHJhY3QgRFdvcmxkQWNjZXNzQ29udHJvbCBpcyBDbGFpbWFibGUsIFBhdXNhYmxlLCBDYW5SZWNsYWltVG9rZW4gewogICAgYWRkcmVzcyBwdWJsaWMgY2ZvQWRkcmVzczsKCiAgICBmdW5jdGlvbiBEV29ybGRBY2Nlc3NDb250cm9sKCkgcHVibGljIHsKICAgICAgICAvLyBUaGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0ZPLgogICAgICAgIGNmb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENGTy1vbmx5IGZ1bmN0aW9uYWxpdHkuCiAgICBtb2RpZmllciBvbmx5Q0ZPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENGTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgY29udHJhY3Qgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9uZXdDRk8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRk8uCiAgICBmdW5jdGlvbiBzZXRDRk8oYWRkcmVzcyBfbmV3Q0ZPKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX25ld0NGTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2ZvQWRkcmVzcyA9IF9uZXdDRk87CiAgICB9Cn0KCgovLy8gQGRldiBEZWZpbmVzIGJhc2UgZGF0YSBzdHJ1Y3R1cmVzIGZvciBEV29ybGQuCmNvbnRyYWN0IERXb3JsZEJhc2UgaXMgRFdvcmxkQWNjZXNzQ29udHJvbCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgLy8vIEBkZXYgQWxsIG1pbnRlZCBwbG90cyAoYXJyYXkgb2YgcGxvdCBpZGVudGlmaWVycykuIFRoZXJlIGFyZQogICAgLy8vIDJeMTYgKiAyXjE2IHBvc3NpYmxlIHBsb3RzIChjb3ZlcmluZyB0aGUgZW50aXJlIHdvcmxkKSwgdGh1cwogICAgLy8vIDMyIGJpdHMgYXJlIHJlcXVpcmVkLiBUaGlzIGZpdHMgaW4gYSB1aW50MzIuIFN0b3JpbmcKICAgIC8vLyB0aGUgaWRlbnRpZmllcnMgYXMgdWludDMyIGluc3RlYWQgb2YgdWludDI1NiBtYWtlcyBzdG9yYWdlCiAgICAvLy8gY2hlYXBlci4gKFRoZSBpbXBhY3Qgb2YgdGhpcyBpbiBtYXBwaW5ncyBpcyBsZXNzIG5vdGljZWFibGUsCiAgICAvLy8gYW5kIHVzaW5nIHVpbnQzMiBpbiB0aGUgbWFwcGluZ3MgYmVsb3cgYWN0dWFsbHkgKmluY3JlYXNlcyoKICAgIC8vLyBnYXMgY29zdCBmb3IgbWludGluZykuCiAgICB1aW50MzJbXSBwdWJsaWMgcGxvdHM7CiAgICAKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaWRlbnRpZmllclRvT3duZXI7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGlkZW50aWZpZXJUb0FwcHJvdmVkOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBvd25lcnNoaXBEZWVkQ291bnQ7CiAgICAKICAgIC8vLyBAZGV2IEV2ZW50IGZpcmVkIHdoZW4gYSBwbG90J3MgZGF0YSBhcmUgY2hhbmdlZC4gVGhlIHBsb3QKICAgIC8vLyBkYXRhIGFyZSBub3Qgc3RvcmVkIGluIHRoZSBjb250cmFjdCBkaXJlY3RseSwgaW5zdGVhZCB0aGUKICAgIC8vLyBkYXRhIGFyZSBsb2dnZWQgdG8gdGhlIGJsb2NrLiBUaGlzIGdpdmVzIHNpZ25pZmljYW50CiAgICAvLy8gcmVkdWN0aW9ucyBpbiBnYXMgcmVxdWlyZW1lbnRzICh+NzVrIGZvciBtaW50aW5nIHdpdGggZGF0YQogICAgLy8vIGluc3RlYWQgb2YgfjE4MGspLiBIb3dldmVyLCBpdCBhbHNvIG1lYW5zIHBsb3QgZGF0YSBhcmUKICAgIC8vLyBub3QgYXZhaWxhYmxlIGZyb20gKndpdGhpbiogb3RoZXIgY29udHJhY3RzLgogICAgZXZlbnQgU2V0RGF0YSh1aW50MjU2IGluZGV4ZWQgZGVlZElkLCBzdHJpbmcgbmFtZSwgc3RyaW5nIGRlc2NyaXB0aW9uLCBzdHJpbmcgaW1hZ2VVcmwsIHN0cmluZyBpbmZvVXJsKTsKICAgIAogICAgLy8vIEBub3RpY2UgR2V0IGFsbCBtaW50ZWQgcGxvdHMuCiAgICBmdW5jdGlvbiBnZXRBbGxQbG90cygpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MzJbXSkgewogICAgICAgIHJldHVybiBwbG90czsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUmVwcmVzZW50IGEgMkQgY29vcmRpbmF0ZSBhcyBhIHNpbmdsZSB1aW50LgogICAgLy8vIEBwYXJhbSB4IFRoZSB4LWNvb3JkaW5hdGUuCiAgICAvLy8gQHBhcmFtIHkgVGhlIHktY29vcmRpbmF0ZS4KICAgIGZ1bmN0aW9uIGNvb3JkaW5hdGVUb0lkZW50aWZpZXIodWludDI1NiB4LCB1aW50MjU2IHkpIHB1YmxpYyBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIHJlcXVpcmUodmFsaWRDb29yZGluYXRlKHgsIHkpKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKHkgPDwgMTYpICsgeDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgVHVybiBhIHNpbmdsZSB1aW50IHJlcHJlc2VudGF0aW9uIG9mIGEgY29vcmRpbmF0ZSBpbnRvIGl0cyB4IGFuZCB5IHBhcnRzLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSB1aW50IHJlcHJlc2VudGF0aW9uIG9mIGEgY29vcmRpbmF0ZS4KICAgIGZ1bmN0aW9uIGlkZW50aWZpZXJUb0Nvb3JkaW5hdGUodWludDI1NiBpZGVudGlmaWVyKSBwdWJsaWMgcHVyZSByZXR1cm5zKHVpbnQyNTYgeCwgdWludDI1NiB5KSB7CiAgICAgICAgcmVxdWlyZSh2YWxpZElkZW50aWZpZXIoaWRlbnRpZmllcikpOwogICAgCiAgICAgICAgeSA9IGlkZW50aWZpZXIgPj4gMTY7CiAgICAgICAgeCA9IGlkZW50aWZpZXIgLSAoeSA8PCAxNik7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFRlc3Qgd2hldGhlciB0aGUgY29vcmRpbmF0ZSBpcyB2YWxpZC4KICAgIC8vLyBAcGFyYW0geCBUaGUgeC1wYXJ0IG9mIHRoZSBjb29yZGluYXRlIHRvIHRlc3QuCiAgICAvLy8gQHBhcmFtIHkgVGhlIHktcGFydCBvZiB0aGUgY29vcmRpbmF0ZSB0byB0ZXN0LgogICAgZnVuY3Rpb24gdmFsaWRDb29yZGluYXRlKHVpbnQyNTYgeCwgdWludDI1NiB5KSBwdWJsaWMgcHVyZSByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4geCA8IDY1NTM2ICYmIHkgPCA2NTUzNjsgLy8gMl4xNgogICAgfQogICAgCiAgICAvLy8gQGRldiBUZXN0IHdoZXRoZXIgYW4gaWRlbnRpZmllciBpcyB2YWxpZC4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciB0byB0ZXN0LgogICAgZnVuY3Rpb24gdmFsaWRJZGVudGlmaWVyKHVpbnQyNTYgaWRlbnRpZmllcikgcHVibGljIHB1cmUgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGlkZW50aWZpZXIgPCA0Mjk0OTY3Mjk2OyAvLyAyXjE2ICogMl4xNgogICAgfQogICAgCiAgICAvLy8gQGRldiBTZXQgYSBwbG90J3MgZGF0YS4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGxvdCB0byBzZXQgZGF0YSBmb3IuCiAgICBmdW5jdGlvbiBfc2V0UGxvdERhdGEodWludDI1NiBpZGVudGlmaWVyLCBzdHJpbmcgbmFtZSwgc3RyaW5nIGRlc2NyaXB0aW9uLCBzdHJpbmcgaW1hZ2VVcmwsIHN0cmluZyBpbmZvVXJsKSBpbnRlcm5hbCB7CiAgICAgICAgU2V0RGF0YShpZGVudGlmaWVyLCBuYW1lLCBkZXNjcmlwdGlvbiwgaW1hZ2VVcmwsIGluZm9VcmwpOwogICAgfQp9CgoKLy8vIEBkZXYgSG9sZHMgZGVlZCBmdW5jdGlvbmFsaXR5IHN1Y2ggYXMgYXBwcm92aW5nIGFuZCB0cmFuc2ZlcnJpbmcuIEltcGxlbWVudHMgRVJDNzIxLgpjb250cmFjdCBEV29ybGREZWVkIGlzIERXb3JsZEJhc2UsIEVSQzcyMSwgRVJDNzIxTWV0YWRhdGEgewogICAgCiAgICAvLy8gQG5vdGljZSBOYW1lIG9mIHRoZSBjb2xsZWN0aW9uIG9mIGRlZWRzIChub24tZnVuZ2libGUgdG9rZW4pLCBhcyBkZWZpbmVkIGluIEVSQzcyMU1ldGFkYXRhLgogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfZGVlZE5hbWUpIHsKICAgICAgICBfZGVlZE5hbWUgPSAiRFdvcmxkIFBsb3RzIjsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgU3ltYm9sIG9mIHRoZSBjb2xsZWN0aW9uIG9mIGRlZWRzIChub24tZnVuZ2libGUgdG9rZW4pLCBhcyBkZWZpbmVkIGluIEVSQzcyMU1ldGFkYXRhLgogICAgZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9kZWVkU3ltYm9sKSB7CiAgICAgICAgX2RlZWRTeW1ib2wgPSAiRFdQIjsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgRVJDLTE2NSAoZHJhZnQpIGludGVyZmFjZSBzaWduYXR1cmUgZm9yIGl0c2VsZgogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDMTY1ID0gLy8gMHgwMWZmYzlhNwogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCknKSk7CgogICAgLy8vIEBkZXYgRVJDLTE2NSAoZHJhZnQpIGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQzcyMQogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxID0gLy8gMHhkYTY3MWI5YgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ293bmVyT2YodWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2NvdW50T2ZEZWVkcygpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdjb3VudE9mRGVlZHNCeU93bmVyKGFkZHJlc3MpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdkZWVkT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignYXBwcm92ZShhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0YWtlT3duZXJzaGlwKHVpbnQyNTYpJykpOwogICAgICAgIAogICAgLy8vIEBkZXYgRVJDLTE2NSAoZHJhZnQpIGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQzcyMQogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxTWV0YWRhdGEgPSAvLyAweDJhNzg2ZjExCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignbmFtZSgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignZGVlZFVyaSh1aW50MjU2KScpKTsKICAgIAogICAgLy8vIEBub3RpY2UgSW50cm9zcGVjdGlvbiBpbnRlcmZhY2UgYXMgcGVyIEVSQy0xNjUgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpLgogICAgLy8vIFJldHVybnMgdHJ1ZSBmb3IgYW55IHN0YW5kYXJkaXplZCBpbnRlcmZhY2VzIGltcGxlbWVudGVkIGJ5IHRoaXMgY29udHJhY3QuCiAgICAvLy8gKEVSQy0xNjUgYW5kIEVSQy03MjEuKQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgKF9pbnRlcmZhY2VJRCA9PSBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSkKICAgICAgICAgICAgfHwgKF9pbnRlcmZhY2VJRCA9PSBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSkKICAgICAgICAgICAgfHwgKF9pbnRlcmZhY2VJRCA9PSBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU1ldGFkYXRhKQogICAgICAgICk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3Mgb3ducyBhIHBhcnRpY3VsYXIgcGxvdC4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBvd25lciB0byBjaGVjayBmb3IuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIHBsb3QgaWRlbnRpZmllciB0byBjaGVjayBmb3IuCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfZGVlZElkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF0gPT0gX293bmVyOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBcHByb3ZlIGEgZ2l2ZW4gYWRkcmVzcyB0byB0YWtlIG93bmVyc2hpcCBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGFwcHJvdmluZyB0YWtpbmcgb3duZXJzaGlwLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYXBwcm92ZSB0YWtpbmcgb3duZXJzaGlwLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGdpdmUgYXBwcm92YWwgZm9yLgogICAgZnVuY3Rpb24gX2FwcHJvdmUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIGlkZW50aWZpZXJUb0FwcHJvdmVkW19kZWVkSWRdID0gX3RvOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgZXZlbnQuCiAgICAgICAgQXBwcm92YWwoX2Zyb20sIF90bywgX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgaGFzIGFwcHJvdmFsIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgZGVlZC4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IFRoZSBhZGRyZXNzIG9mIHRoZSBjbGFpbWFudCB0byBjaGVjayBmb3IuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gY2hlY2sgZm9yLgogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBpZGVudGlmaWVyVG9BcHByb3ZlZFtfZGVlZElkXSA9PSBfY2xhaW1hbnQ7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgZGVlZCB0byBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0aGUgZGVlZCBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdGhlIGRlZWQgdG8uCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFRoZSBudW1iZXIgb2YgcGxvdHMgaXMgY2FwcGVkIGF0IDJeMTYgKiAyXjE2LCBzbyB0aGlzIGNhbm5vdAogICAgICAgIC8vIGJlIG92ZXJmbG93ZWQuCiAgICAgICAgb3duZXJzaGlwRGVlZENvdW50W190b10rKzsKICAgICAgICAKICAgICAgICAvLyBUcmFuc2ZlciBvd25lcnNoaXAuCiAgICAgICAgaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF0gPSBfdG87CiAgICAgICAgCiAgICAgICAgLy8gV2hlbiBhIG5ldyBkZWVkIGlzIG1pbnRlZCwgdGhlIF9mcm9tIGFkZHJlc3MgaXMgMHgwLCBidXQgd2UKICAgICAgICAvLyBkbyBub3QgdHJhY2sgZGVlZCBvd25lcnNoaXAgb2YgMHgwLgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyc2hpcERlZWRDb3VudFtfZnJvbV0tLTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENsZWFyIHRha2luZyBvd25lcnNoaXAgYXBwcm92YWwuCiAgICAgICAgICAgIGRlbGV0ZSBpZGVudGlmaWVyVG9BcHByb3ZlZFtfZGVlZElkXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gRW1pdCB0aGUgdHJhbnNmZXIgZXZlbnQuCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vIEVSQyA3MjEgaW1wbGVtZW50YXRpb24KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIGRlZWRzIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBwbG90cy5sZW5ndGg7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIG51bWJlciBvZiBkZWVkcyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKICAgIGZ1bmN0aW9uIGNvdW50T2ZEZWVkc0J5T3duZXIoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gb3duZXJzaGlwRGVlZENvdW50W19vd25lcl07CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGFkZHJlc3MgY3VycmVudGx5IGFzc2lnbmVkIG93bmVyc2hpcCBvZiBhIGdpdmVuIGRlZWQuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpIHsKICAgICAgICBfb3duZXIgPSBpZGVudGlmaWVyVG9Pd25lcltfZGVlZElkXTsKCiAgICAgICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYSBnaXZlbiBhZGRyZXNzIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgZGVlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGFwcHJvdmUgdGFraW5nIG93ZXJuc2hpcC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBnaXZlIGFwcHJvdmFsIGZvci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgX2RlZWRJZHMgPSBuZXcgdWludDI1NltdKDEpOwogICAgICAgIF9kZWVkSWRzWzBdID0gX2RlZWRJZDsKICAgICAgICAKICAgICAgICBhcHByb3ZlTXVsdGlwbGUoX3RvLCBfZGVlZElkcyk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYSBnaXZlbiBhZGRyZXNzIHRvIHRha2Ugb3duZXJzaGlwIG9mIG11bHRpcGxlIGRlZWRzLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYXBwcm92ZSB0YWtpbmcgb3duZXJzaGlwLgogICAgLy8vIEBwYXJhbSBfZGVlZElkcyBUaGUgaWRlbnRpZmllcnMgb2YgdGhlIGRlZWRzIHRvIGdpdmUgYXBwcm92YWwgZm9yLgogICAgZnVuY3Rpb24gYXBwcm92ZU11bHRpcGxlKGFkZHJlc3MgX3RvLCB1aW50MjU2W10gX2RlZWRJZHMpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBFbnN1cmUgdGhlIHNlbmRlciBpcyBub3QgYXBwcm92aW5nIHRoZW1zZWx2ZXMuCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IF90byk7CiAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfZGVlZElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50MjU2IF9kZWVkSWQgPSBfZGVlZElkc1tpXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlcXVpcmUgdGhlIHNlbmRlciBpcyB0aGUgb3duZXIgb2YgdGhlIGRlZWQuCiAgICAgICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2RlZWRJZCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUGVyZm9ybSB0aGUgYXBwcm92YWwuCiAgICAgICAgICAgIF9hcHByb3ZlKG1zZy5zZW5kZXIsIF90bywgX2RlZWRJZCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIGRlZWQgdG8gYW5vdGhlciBhZGRyZXNzLiBJZiB0cmFuc2ZlcnJpbmcgdG8gYSBzbWFydAogICAgLy8vIGNvbnRyYWN0IGJlIFZFUlkgQ0FSRUZVTCB0byBlbnN1cmUgdGhhdCBpdCBpcyBhd2FyZSBvZiBFUkMtNzIxLCBvciB5b3VyCiAgICAvLy8gZGVlZCBtYXkgYmUgbG9zdCBmb3JldmVyLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byB0cmFuc2Zlci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IF9kZWVkSWRzID0gbmV3IHVpbnQyNTZbXSgxKTsKICAgICAgICBfZGVlZElkc1swXSA9IF9kZWVkSWQ7CiAgICAgICAgCiAgICAgICAgdHJhbnNmZXJNdWx0aXBsZShfdG8sIF9kZWVkSWRzKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIG11bHRpcGxlIGRlZWRzIHRvIGFub3RoZXIgYWRkcmVzcy4gSWYgdHJhbnNmZXJyaW5nIHRvCiAgICAvLy8gYSBzbWFydCBjb250cmFjdCBiZSBWRVJZIENBUkVGVUwgdG8gZW5zdXJlIHRoYXQgaXQgaXMgYXdhcmUgb2YgRVJDLTcyMSwKICAgIC8vLyBvciB5b3VyIGRlZWRzIG1heSBiZSBsb3N0IGZvcmV2ZXIuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LCBjYW4gYmUgYSB1c2VyIG9yIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZGVlZElkcyBUaGUgaWRlbnRpZmllcnMgb2YgdGhlIGRlZWRzIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gdHJhbnNmZXJNdWx0aXBsZShhZGRyZXNzIF90bywgdWludDI1NltdIF9kZWVkSWRzKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIAogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfZGVlZElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50MjU2IF9kZWVkSWQgPSBfZGVlZElkc1tpXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE9uZSBjYW4gb25seSB0cmFuc2ZlciB0aGVpciBvd24gcGxvdHMuCiAgICAgICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2RlZWRJZCkpOwoKICAgICAgICAgICAgLy8gVHJhbnNmZXIgb3duZXJzaGlwCiAgICAgICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9kZWVkSWQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBkZWVkIG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nCiAgICAvLy8gYWRkcmVzcyBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IF9kZWVkSWRzID0gbmV3IHVpbnQyNTZbXSgxKTsKICAgICAgICBfZGVlZElkc1swXSA9IF9kZWVkSWQ7CiAgICAgICAgCiAgICAgICAgdGFrZU93bmVyc2hpcE11bHRpcGxlKF9kZWVkSWRzKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgbXVsdGlwbGUgZGVlZHMgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlCiAgICAvLy8gY2FsbGluZyBhZGRyZXNzIGhhcyBwcmV2aW91c2x5IGJlZW4gZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbCBieSB0aGUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWRzIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGJlIHRyYW5zZmVycmVkLgogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcE11bHRpcGxlKHVpbnQyNTZbXSBfZGVlZElkcykgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9kZWVkSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgX2RlZWRJZCA9IF9kZWVkSWRzW2ldOwogICAgICAgICAgICBhZGRyZXNzIF9mcm9tID0gaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDaGVjayBmb3IgdHJhbnNmZXIgYXBwcm92YWwKICAgICAgICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX2RlZWRJZCkpOwoKICAgICAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgICAgICBfdHJhbnNmZXIoX2Zyb20sIG1zZy5zZW5kZXIsIF9kZWVkSWQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhIGxpc3Qgb2YgYWxsIGRlZWQgaWRlbnRpZmllcnMgYXNzaWduZWQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciB3aG9zZSBkZWVkcyB3ZSBhcmUgaW50ZXJlc3RlZCBpbi4KICAgIC8vLyBAZGV2IFRoaXMgbWV0aG9kIE1VU1QgTkVWRVIgYmUgY2FsbGVkIGJ5IHNtYXJ0IGNvbnRyYWN0IGNvZGUuIEl0J3MgdmVyeQogICAgLy8vIGV4cGVuc2l2ZSBhbmQgaXMgbm90IHN1cHBvcnRlZCBpbiBjb250cmFjdC10by1jb250cmFjdCBjYWxscyBhcyBpdCByZXR1cm5zCiAgICAvLy8gYSBkeW5hbWljIGFycmF5IChvbmx5IHN1cHBvcnRlZCBmb3Igd2ViMyBjYWxscykuCiAgICBmdW5jdGlvbiBkZWVkc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10pIHsKICAgICAgICB1aW50MjU2IGRlZWRDb3VudCA9IGNvdW50T2ZEZWVkc0J5T3duZXIoX293bmVyKTsKCiAgICAgICAgaWYgKGRlZWRDb3VudCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheS4KICAgICAgICAgICAgcmV0dXJuIG5ldyB1aW50MjU2W10oMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKGRlZWRDb3VudCk7CiAgICAgICAgICAgIHVpbnQyNTYgdG90YWxEZWVkcyA9IGNvdW50T2ZEZWVkcygpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAodWludDI1NiBkZWVkTnVtYmVyID0gMDsgZGVlZE51bWJlciA8IHRvdGFsRGVlZHM7IGRlZWROdW1iZXIrKykgewogICAgICAgICAgICAgICAgdWludDI1NiBpZGVudGlmaWVyID0gcGxvdHNbZGVlZE51bWJlcl07CiAgICAgICAgICAgICAgICBpZiAoaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IGlkZW50aWZpZXI7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBkZWVkIGlkZW50aWZpZXIgb2YgdGhlIG93bmVyIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBvd25lciB3ZSB3YW50IHRvIGdldCBhIGRlZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfaW5kZXggVGhlIGluZGV4IG9mIHRoZSBkZWVkIHdlIHdhbnQuCiAgICBmdW5jdGlvbiBkZWVkT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBUaGUgaW5kZXggc2hvdWxkIGJlIHZhbGlkLgogICAgICAgIHJlcXVpcmUoX2luZGV4IDwgY291bnRPZkRlZWRzQnlPd25lcihfb3duZXIpKTsKCiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBwbG90cywgYWNjb3VudGluZyB0aGUgbnVtYmVyIG9mIHBsb3RzIG9mIHRoZSBvd25lciB3ZSd2ZSBzZWVuLgogICAgICAgIHVpbnQyNTYgc2VlbiA9IDA7CiAgICAgICAgdWludDI1NiB0b3RhbERlZWRzID0gY291bnRPZkRlZWRzKCk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGRlZWROdW1iZXIgPSAwOyBkZWVkTnVtYmVyIDwgdG90YWxEZWVkczsgZGVlZE51bWJlcisrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgaWRlbnRpZmllciA9IHBsb3RzW2RlZWROdW1iZXJdOwogICAgICAgICAgICBpZiAoaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VlbiA9PSBfaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRlbnRpZmllcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VlbisrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGFuIChvZmYtY2hhaW4pIG1ldGFkYXRhIHVybCBmb3IgdGhlIGdpdmVuIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gZ2V0IHRoZSBtZXRhZGF0YQogICAgLy8vIHVybCBmb3IuCiAgICAvLy8gQGRldiBJbXBsZW1lbnRhdGlvbiBvZiBvcHRpb25hbCBFUkMtNzIxIGZ1bmN0aW9uYWxpdHkuCiAgICBmdW5jdGlvbiBkZWVkVXJpKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcgdXJpKSB7CiAgICAgICAgcmVxdWlyZSh2YWxpZElkZW50aWZpZXIoX2RlZWRJZCkpOwogICAgCiAgICAgICAgdmFyICh4LCB5KSA9IGlkZW50aWZpZXJUb0Nvb3JkaW5hdGUoX2RlZWRJZCk7CiAgICAKICAgICAgICAvLyBNYXhpbXVtIGNvb3JkaW5hdGUgbGVuZ3RoIGluIGRlY2ltYWxzIGlzIDUgKDY1NTM1KQogICAgICAgIHVyaSA9ICJodHRwczovL2R3b3JsZC5pby9wbG90L3h4eHh4L3h4eHh4IjsKICAgICAgICBieXRlcyBtZW1vcnkgX3VyaSA9IGJ5dGVzKHVyaSk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgICAgIF91cmlbMjcgLSBpXSA9IGJ5dGUoNDggKyAoeCAvIDEwICoqIGkpICUgMTApOwogICAgICAgICAgICBfdXJpWzMzIC0gaV0gPSBieXRlKDQ4ICsgKHkgLyAxMCAqKiBpKSAlIDEwKTsKICAgICAgICB9CiAgICB9Cn0KCgovLy8gQGRldiBJbXBsZW1lbnRzIHJlbnRpbmcgZnVuY3Rpb25hbGl0eS4KY29udHJhY3QgRFdvcmxkUmVudGluZyBpcyBEV29ybGREZWVkIHsKICAgIGV2ZW50IFJlbnQoYWRkcmVzcyBpbmRleGVkIHJlbnRlciwgdWludDI1NiBpbmRleGVkIGRlZWRJZCwgdWludDI1NiByZW50UGVyaW9kRW5kVGltZXN0YW1wLCB1aW50MjU2IHJlbnRQZXJpb2QpOwogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBpZGVudGlmaWVyVG9SZW50ZXI7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIGlkZW50aWZpZXJUb1JlbnRQZXJpb2RFbmRUaW1lc3RhbXA7CgogICAgLy8vIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyByZW50cyBhIHBhcnRpY3VsYXIgcGxvdC4KICAgIC8vLyBAcGFyYW0gX3JlbnRlciBUaGUgYWRkcmVzcyBvZiB0aGUgcmVudGVyIHRvIGNoZWNrIGZvci4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgcGxvdCBpZGVudGlmaWVyIHRvIGNoZWNrIGZvci4KICAgIGZ1bmN0aW9uIF9yZW50cyhhZGRyZXNzIF9yZW50ZXIsIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGlkZW50aWZpZXJUb1JlbnRlcltfZGVlZElkXSA9PSBfcmVudGVyICYmIGlkZW50aWZpZXJUb1JlbnRQZXJpb2RFbmRUaW1lc3RhbXBbX2RlZWRJZF0gPj0gbm93OwogICAgfQogICAgCiAgICAvLy8gQGRldiBSZW50IG91dCBhIGRlZWQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHJlbnQgdGhlIGRlZWQgb3V0IHRvLgogICAgLy8vIEBwYXJhbSBfcmVudFBlcmlvZCBUaGUgcmVudCBwZXJpb2QgaW4gc2Vjb25kcy4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byByZW50IG91dC4KICAgIGZ1bmN0aW9uIF9yZW50T3V0KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9yZW50UGVyaW9kLCB1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHsKICAgICAgICAvLyBTZXQgdGhlIHJlbnRlciBhbmQgcmVudCBwZXJpb2QgZW5kIHRpbWVzdGFtcAogICAgICAgIHVpbnQyNTYgcmVudFBlcmlvZEVuZFRpbWVzdGFtcCA9IG5vdy5hZGQoX3JlbnRQZXJpb2QpOwogICAgICAgIGlkZW50aWZpZXJUb1JlbnRlcltfZGVlZElkXSA9IF90bzsKICAgICAgICBpZGVudGlmaWVyVG9SZW50UGVyaW9kRW5kVGltZXN0YW1wW19kZWVkSWRdID0gcmVudFBlcmlvZEVuZFRpbWVzdGFtcDsKICAgICAgICAKICAgICAgICBSZW50KF90bywgX2RlZWRJZCwgcmVudFBlcmlvZEVuZFRpbWVzdGFtcCwgX3JlbnRQZXJpb2QpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZW50cyBhIHBsb3Qgb3V0IHRvIGFub3RoZXIgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZW50ZXIsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9yZW50UGVyaW9kIFRoZSByZW50IHRpbWUgcGVyaW9kIGluIHNlY29uZHMuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIHBsb3QgdG8gcmVudCBvdXQuCiAgICBmdW5jdGlvbiByZW50T3V0KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9yZW50UGVyaW9kLCB1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgX2RlZWRJZHMgPSBuZXcgdWludDI1NltdKDEpOwogICAgICAgIF9kZWVkSWRzWzBdID0gX2RlZWRJZDsKICAgICAgICAKICAgICAgICByZW50T3V0TXVsdGlwbGUoX3RvLCBfcmVudFBlcmlvZCwgX2RlZWRJZHMpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZW50cyBtdWx0aXBsZSBwbG90cyBvdXQgdG8gYW5vdGhlciBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlbnRlciwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3JlbnRQZXJpb2QgVGhlIHJlbnQgdGltZSBwZXJpb2QgaW4gc2Vjb25kcy4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZHMgVGhlIGlkZW50aWZpZXJzIG9mIHRoZSBwbG90cyB0byByZW50IG91dC4KICAgIGZ1bmN0aW9uIHJlbnRPdXRNdWx0aXBsZShhZGRyZXNzIF90bywgdWludDI1NiBfcmVudFBlcmlvZCwgdWludDI1NltdIF9kZWVkSWRzKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIAogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RlZWRJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdWludDI1NiBfZGVlZElkID0gX2RlZWRJZHNbaV07CiAgICAgICAgICAgIAogICAgICAgICAgICByZXF1aXJlKHZhbGlkSWRlbnRpZmllcihfZGVlZElkKSk7CiAgICAgICAgCiAgICAgICAgICAgIC8vIFRoZXJlIHNob3VsZCBub3QgYmUgYW4gYWN0aXZlIHJlbnRlci4KICAgICAgICAgICAgcmVxdWlyZShpZGVudGlmaWVyVG9SZW50UGVyaW9kRW5kVGltZXN0YW1wW19kZWVkSWRdIDwgbm93KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE9uZSBjYW4gb25seSByZW50IG91dCB0aGVpciBvd24gcGxvdHMuCiAgICAgICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2RlZWRJZCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgX3JlbnRPdXQoX3RvLCBfcmVudFBlcmlvZCwgX2RlZWRJZCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBhZGRyZXNzIG9mIHRoZSBjdXJyZW50bHkgYXNzaWduZWQgcmVudGVyIGFuZAogICAgLy8vIGVuZCB0aW1lIG9mIHRoZSByZW50IHBlcmlvZCBvZiBhIGdpdmVuIHBsb3QuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gZ2V0IHRoZSByZW50ZXIgYW5kIAogICAgLy8vIHJlbnQgcGVyaW9kIGZvci4KICAgIGZ1bmN0aW9uIHJlbnRlck9mKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIF9yZW50ZXIsIHVpbnQyNTYgX3JlbnRQZXJpb2RFbmRUaW1lc3RhbXApIHsKICAgICAgICByZXF1aXJlKHZhbGlkSWRlbnRpZmllcihfZGVlZElkKSk7CiAgICAKICAgICAgICBpZiAoaWRlbnRpZmllclRvUmVudFBlcmlvZEVuZFRpbWVzdGFtcFtfZGVlZElkXSA8IG5vdykgewogICAgICAgICAgICAvLyBUaGVyZSBpcyBubyBhY3RpdmUgcmVudGVyCiAgICAgICAgICAgIF9yZW50ZXIgPSBhZGRyZXNzKDApOwogICAgICAgICAgICBfcmVudFBlcmlvZEVuZFRpbWVzdGFtcCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3JlbnRlciA9IGlkZW50aWZpZXJUb1JlbnRlcltfZGVlZElkXTsKICAgICAgICAgICAgX3JlbnRQZXJpb2RFbmRUaW1lc3RhbXAgPSBpZGVudGlmaWVyVG9SZW50UGVyaW9kRW5kVGltZXN0YW1wW19kZWVkSWRdOwogICAgICAgIH0KICAgIH0KfQoKCi8vLyBAdGl0bGUgVGhlIGludGVybmFsIGNsb2NrIGF1Y3Rpb24gZnVuY3Rpb25hbGl0eS4KLy8vIEluc3BpcmVkIGJ5IENyeXB0b0tpdHRpZXMnIGNsb2NrIGF1Y3Rpb24KY29udHJhY3QgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8gQWRkcmVzcyBvZiB0aGUgRVJDNzIxIGNvbnRyYWN0IHRoaXMgYXVjdGlvbiBpcyBsaW5rZWQgdG8uCiAgICBFUkM3MjEgcHVibGljIGRlZWRDb250cmFjdDsKCiAgICAvLyBGZWUgcGVyIHN1Y2Nlc3NmdWwgYXVjdGlvbiBpbiAxLzEwMDB0aCBvZiBhIHBlcmNlbnRhZ2UuCiAgICB1aW50MjU2IHB1YmxpYyBmZWU7CiAgICAKICAgIC8vIFRvdGFsIGFtb3VudCBvZiBldGhlciB5ZXQgdG8gYmUgcGFpZCB0byBhdWN0aW9uIGJlbmVmaWNpYXJpZXMuCiAgICB1aW50MjU2IHB1YmxpYyBvdXRzdGFuZGluZ0V0aGVyID0gMCBldGhlcjsKICAgIAogICAgLy8gQW1vdW50IG9mIGV0aGVyIHlldCB0byBiZSBwYWlkIHBlciBiZW5lZmljaWFyeS4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGFkZHJlc3NUb0V0aGVyT3dlZDsKICAgIAogICAgLy8vIEBkZXYgUmVwcmVzZW50cyBhIGRlZWQgYXVjdGlvbi4KICAgIC8vLyBDYXJlIGhhcyBiZWVuIHRha2VuIHRvIGVuc3VyZSB0aGUgYXVjdGlvbiBmaXRzIGluCiAgICAvLy8gdHdvIDI1Ni1iaXQgd29yZHMuCiAgICBzdHJ1Y3QgQXVjdGlvbiB7CiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgdWludDEyOCBzdGFydFByaWNlOwogICAgICAgIHVpbnQxMjggZW5kUHJpY2U7CiAgICAgICAgdWludDY0IGR1cmF0aW9uOwogICAgICAgIHVpbnQ2NCBzdGFydGVkQXQ7CiAgICB9CgogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSBpZGVudGlmaWVyVG9BdWN0aW9uOwogICAgCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKGFkZHJlc3MgaW5kZXhlZCBzZWxsZXIsIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQsIHVpbnQyNTYgc3RhcnRQcmljZSwgdWludDI1NiBlbmRQcmljZSwgdWludDI1NiBkdXJhdGlvbik7CiAgICBldmVudCBBdWN0aW9uU3VjY2Vzc2Z1bChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQsIHVpbnQyNTYgdG90YWxQcmljZSk7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQpOwogICAgCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBjaGVjayB3aGV0aGVyIHRoZSB2YWx1ZSBjYW4gYmUgc3RvcmVkIGluIGEgNjQgYml0IHVpbnQuCiAgICBtb2RpZmllciBmaXRzSW42NEJpdHModWludDI1NiBfdmFsdWUpIHsKICAgICAgICByZXF1aXJlIChfdmFsdWUgPT0gdWludDI1Nih1aW50NjQoX3ZhbHVlKSkpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGNoZWNrIHdoZXRoZXIgdGhlIHZhbHVlIGNhbiBiZSBzdG9yZWQgaW4gYSAxMjggYml0IHVpbnQuCiAgICBtb2RpZmllciBmaXRzSW4xMjhCaXRzKHVpbnQyNTYgX3ZhbHVlKSB7CiAgICAgICAgcmVxdWlyZSAoX3ZhbHVlID09IHVpbnQyNTYodWludDEyOChfdmFsdWUpKSk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gQ2xvY2tBdWN0aW9uQmFzZShhZGRyZXNzIF9kZWVkQ29udHJhY3RBZGRyZXNzLCB1aW50MjU2IF9mZWUpIHB1YmxpYyB7CiAgICAgICAgZGVlZENvbnRyYWN0ID0gRVJDNzIxKF9kZWVkQ29udHJhY3RBZGRyZXNzKTsKICAgICAgICAKICAgICAgICAvLyBDb250cmFjdCBtdXN0IGluZGljYXRlIHN1cHBvcnQgZm9yIEVSQzcyMSB0aHJvdWdoIGl0cyBpbnRlcmZhY2Ugc2lnbmF0dXJlLgogICAgICAgIHJlcXVpcmUoZGVlZENvbnRyYWN0LnN1cHBvcnRzSW50ZXJmYWNlKDB4ZGE2NzFiOWIpKTsKICAgICAgICAKICAgICAgICAvLyBGZWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEwMCUuCiAgICAgICAgcmVxdWlyZSgwIDw9IF9mZWUgJiYgX2ZlZSA8PSAxMDAwMDApOwogICAgICAgIGZlZSA9IF9mZWU7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENoZWNrcyB3aGV0aGVyIHRoZSBnaXZlbiBhdWN0aW9uIGlzIGFjdGl2ZS4KICAgIC8vLyBAcGFyYW0gYXVjdGlvbiBUaGUgYXVjdGlvbiB0byBjaGVjayBmb3IgYWN0aXZpdHkuCiAgICBmdW5jdGlvbiBfYWN0aXZlQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGF1Y3Rpb24uc3RhcnRlZEF0ID4gMDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUHV0IHRoZSBkZWVkIGludG8gZXNjcm93LCB0aGVyZWJ5IHRha2luZyBvd25lcnNoaXAgb2YgaXQuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gcGxhY2UgaW50byBlc2Nyb3cuCiAgICBmdW5jdGlvbiBfZXNjcm93KHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFRocm93cyBpZiB0aGUgdHJhbnNmZXIgZmFpbHMKICAgICAgICBkZWVkQ29udHJhY3QudGFrZU93bmVyc2hpcChfZGVlZElkKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ3JlYXRlIHRoZSBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNyZWF0ZSB0aGUgYXVjdGlvbiBmb3IuCiAgICAvLy8gQHBhcmFtIGF1Y3Rpb24gVGhlIGF1Y3Rpb24gdG8gY3JlYXRlLgogICAgZnVuY3Rpb24gX2NyZWF0ZUF1Y3Rpb24odWludDI1NiBfZGVlZElkLCBBdWN0aW9uIGF1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBBZGQgdGhlIGF1Y3Rpb24gdG8gdGhlIGF1Y3Rpb24gbWFwcGluZy4KICAgICAgICBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdID0gYXVjdGlvbjsKICAgICAgICAKICAgICAgICAvLyBUcmlnZ2VyIGF1Y3Rpb24gY3JlYXRlZCBldmVudC4KICAgICAgICBBdWN0aW9uQ3JlYXRlZChhdWN0aW9uLnNlbGxlciwgX2RlZWRJZCwgYXVjdGlvbi5zdGFydFByaWNlLCBhdWN0aW9uLmVuZFByaWNlLCBhdWN0aW9uLmR1cmF0aW9uKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgQmlkIG9uIGFuIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9idXllciBUaGUgYWRkcmVzcyBvZiB0aGUgYnV5ZXIuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgdmFsdWUgc2VudCBieSB0aGUgc2VuZGVyIChpbiBldGhlcikuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gYmlkIG9uLgogICAgZnVuY3Rpb24gX2JpZChhZGRyZXNzIF9idXllciwgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gaWRlbnRpZmllclRvQXVjdGlvbltfZGVlZElkXTsKICAgICAgICAKICAgICAgICAvLyBUaGUgYXVjdGlvbiBtdXN0IGJlIGFjdGl2ZS4KICAgICAgICByZXF1aXJlKF9hY3RpdmVBdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGF1Y3Rpb24ncyBjdXJyZW50IHByaWNlLgogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgICAgIAogICAgICAgIC8vIE1ha2Ugc3VyZSBlbm91Z2ggZnVuZHMgd2VyZSBzZW50LgogICAgICAgIHJlcXVpcmUoX3ZhbHVlID49IHByaWNlKTsKICAgICAgICAKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgCiAgICAgICAgaWYgKHByaWNlID4gMCkgewogICAgICAgICAgICB1aW50MjU2IHRvdGFsRmVlID0gX2NhbGN1bGF0ZUZlZShwcmljZSk7CiAgICAgICAgICAgIHVpbnQyNTYgcHJvY2VlZHMgPSBwcmljZSAtIHRvdGFsRmVlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQXNzaWduIHRoZSBwcm9jZWVkcyB0byB0aGUgc2VsbGVyLgogICAgICAgICAgICAvLyBXZSBkbyBub3Qgc2VuZCB0aGUgcHJvY2VlZHMgZGlyZWN0bHksIGFzIHRvIHByZXZlbnQKICAgICAgICAgICAgLy8gbWFsaWNpb3VzIHNlbGxlcnMgZnJvbSBkZW55aW5nIGF1Y3Rpb25zIChhbmQgYnVybmluZwogICAgICAgICAgICAvLyB0aGUgYnV5ZXIncyBnYXMpLgogICAgICAgICAgICBfYXNzaWduUHJvY2VlZHMoc2VsbGVyLCBwcm9jZWVkcyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF9idXllciwgX2RlZWRJZCwgcHJpY2UpOwogICAgICAgIAogICAgICAgIC8vIFRoZSBiaWQgd2FzIHdvbiEKICAgICAgICBfd2luQmlkKHNlbGxlciwgX2J1eWVyLCBfZGVlZElkLCBwcmljZSk7CiAgICAgICAgCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBhdWN0aW9uICh3ZSBkbyB0aGlzIGF0IHRoZSBlbmQsIGFzCiAgICAgICAgLy8gd2luQmlkIG1pZ2h0IHJlcXVpcmUgc29tZSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uCiAgICAgICAgLy8gdGhhdCB3aWxsIGJlIHJlbW92ZWQgd2hlbiBfcmVtb3ZlQXVjdGlvbiBpcwogICAgICAgIC8vIGNhbGxlZC4gQXMgd2UgZG8gbm90IHRyYW5zZmVyIGZ1bmRzIGhlcmUsIHdlIGRvCiAgICAgICAgLy8gbm90IGhhdmUgdG8gd29ycnkgYWJvdXQgcmUtZW50cnkgYXR0YWNrcy4KICAgICAgICBfcmVtb3ZlQXVjdGlvbihfZGVlZElkKTsKICAgIH0KCiAgICAvLy8gQGRldiBQZXJmb3JtIHRoZSBiaWQgd2luIGxvZ2ljIChpbiB0aGlzIGNhc2U6IHRyYW5zZmVyIHRoZSBkZWVkKS4KICAgIC8vLyBAcGFyYW0gX3NlbGxlciBUaGUgYWRkcmVzcyBvZiB0aGUgc2VsbGVyLgogICAgLy8vIEBwYXJhbSBfd2lubmVyIFRoZSBhZGRyZXNzIG9mIHRoZSB3aW5uZXIuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9wcmljZSBUaGUgcHJpY2UgdGhlIGF1Y3Rpb24gd2FzIGJvdWdodCBhdC4KICAgIGZ1bmN0aW9uIF93aW5CaWQoYWRkcmVzcyBfc2VsbGVyLCBhZGRyZXNzIF93aW5uZXIsIHVpbnQyNTYgX2RlZWRJZCwgdWludDI1NiBfcHJpY2UpIGludGVybmFsIHsKICAgICAgICBfdHJhbnNmZXIoX3dpbm5lciwgX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENhbmNlbCBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIGZvciB3aGljaCB0aGUgYXVjdGlvbiBzaG91bGQgYmUgY2FuY2VsbGVkLgogICAgLy8vIEBwYXJhbSBhdWN0aW9uIFRoZSBhdWN0aW9uIHRvIGNhbmNlbC4KICAgIGZ1bmN0aW9uIF9jYW5jZWxBdWN0aW9uKHVpbnQyNTYgX2RlZWRJZCwgQXVjdGlvbiBhdWN0aW9uKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gUmVtb3ZlIHRoZSBhdWN0aW9uCiAgICAgICAgX3JlbW92ZUF1Y3Rpb24oX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIGRlZWQgYmFjayB0byB0aGUgc2VsbGVyCiAgICAgICAgX3RyYW5zZmVyKGF1Y3Rpb24uc2VsbGVyLCBfZGVlZElkKTsKICAgICAgICAKICAgICAgICAvLyBUcmlnZ2VyIGF1Y3Rpb24gY2FuY2VsbGVkIGV2ZW50LgogICAgICAgIEF1Y3Rpb25DYW5jZWxsZWQoX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFJlbW92ZSBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIGZvciB3aGljaCB0aGUgYXVjdGlvbiBzaG91bGQgYmUgcmVtb3ZlZC4KICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdOwogICAgfQogICAgCiAgICAvLy8gQGRldiBUcmFuc2ZlciBhIGRlZWQgb3duZWQgYnkgdGhpcyBjb250cmFjdCB0byBhbm90aGVyIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0aGUgZGVlZCB0by4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZC4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gVGhyb3dzIGlmIHRoZSB0cmFuc2ZlciBmYWlscwogICAgICAgIGRlZWRDb250cmFjdC50cmFuc2ZlcihfdG8sIF9kZWVkSWQpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBc3NpZ24gcHJvY2VlZHMgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGFzc2lnbiBwcm9jZWVkcyB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBwcm9jZWVkcyB0byBhc3NpZ24uCiAgICBmdW5jdGlvbiBfYXNzaWduUHJvY2VlZHMoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgb3V0c3RhbmRpbmdFdGhlciArPSBfdmFsdWU7CiAgICAgICAgYWRkcmVzc1RvRXRoZXJPd2VkW190b10gKz0gX3ZhbHVlOwogICAgfQogICAgCiAgICAvLy8gQGRldiBDYWxjdWxhdGUgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4KICAgIGZ1bmN0aW9uIF9jdXJyZW50UHJpY2UoQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKG5vdyA+PSBfYXVjdGlvbi5zdGFydGVkQXQpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICAKICAgICAgICBpZiAoc2Vjb25kc1Bhc3NlZCA+PSBfYXVjdGlvbi5kdXJhdGlvbikgewogICAgICAgICAgICByZXR1cm4gX2F1Y3Rpb24uZW5kUHJpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gTmVnYXRpdmUgaWYgdGhlIGVuZCBwcmljZSBpcyBoaWdoZXIgdGhhbiB0aGUgc3RhcnQgcHJpY2UhCiAgICAgICAgICAgIGludDI1NiB0b3RhbFByaWNlQ2hhbmdlID0gaW50MjU2KF9hdWN0aW9uLmVuZFByaWNlKSAtIGludDI1NihfYXVjdGlvbi5zdGFydFByaWNlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgY3VycmVudCBwcmljZSBiYXNlZCBvbiB0aGUgdG90YWwgY2hhbmdlIG92ZXIgdGhlIGVudGlyZQogICAgICAgICAgICAvLyBhdWN0aW9uIGR1cmF0aW9uLCBhbmQgdGhlIGFtb3VudCBvZiB0aW1lIHBhc3NlZCBzaW5jZSB0aGUgc3RhcnQgb2YgdGhlCiAgICAgICAgICAgIC8vIGF1Y3Rpb24uCiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2VDaGFuZ2UgPSB0b3RhbFByaWNlQ2hhbmdlICogaW50MjU2KHNlY29uZHNQYXNzZWQpIC8gaW50MjU2KF9hdWN0aW9uLmR1cmF0aW9uKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZmluYWwgcHJpY2UuIE5vdGUgdGhpcyBvbmNlIGFnYWluCiAgICAgICAgICAgIC8vIGlzIHJlcHJlc2VudGFibGUgYnkgYSB1aW50MjU2LCBhcyB0aGUgcHJpY2UgY2FuCiAgICAgICAgICAgIC8vIG5ldmVyIGJlIG5lZ2F0aXZlLgogICAgICAgICAgICBpbnQyNTYgcHJpY2UgPSBpbnQyNTYoX2F1Y3Rpb24uc3RhcnRQcmljZSkgKyBjdXJyZW50UHJpY2VDaGFuZ2U7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUaGlzIG5ldmVyIHRocm93cy4KICAgICAgICAgICAgYXNzZXJ0KHByaWNlID49IDApOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYocHJpY2UpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIHRoZSBmZWUgZm9yIGEgZ2l2ZW4gcHJpY2UuCiAgICAvLy8gQHBhcmFtIF9wcmljZSBUaGUgcHJpY2UgdG8gY2FsY3VsYXRlIHRoZSBmZWUgZm9yLgogICAgZnVuY3Rpb24gX2NhbGN1bGF0ZUZlZSh1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gX3ByaWNlIGlzIGd1YXJhbnRlZWQgdG8gZml0IGluIGEgdWludDEyOCBkdWUgdG8gdGhlIGNyZWF0ZUF1Y3Rpb24gZW50cnkKICAgICAgICAvLyBtb2RpZmllcnMsIHNvIHRoaXMgY2Fubm90IG92ZXJmbG93LgogICAgICAgIHJldHVybiBfcHJpY2UgKiBmZWUgLyAxMDAwMDA7CiAgICB9Cn0KCgpjb250cmFjdCBDbG9ja0F1Y3Rpb24gaXMgQ2xvY2tBdWN0aW9uQmFzZSwgUGF1c2FibGUgewogICAgZnVuY3Rpb24gQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX2RlZWRDb250cmFjdEFkZHJlc3MsIHVpbnQyNTYgX2ZlZSkgCiAgICAgICAgQ2xvY2tBdWN0aW9uQmFzZShfZGVlZENvbnRyYWN0QWRkcmVzcywgX2ZlZSkKICAgICAgICBwdWJsaWMKICAgIHt9CiAgICAKICAgIC8vLyBAbm90aWNlIFVwZGF0ZSB0aGUgYXVjdGlvbiBmZWUuCiAgICAvLy8gQHBhcmFtIF9mZWUgVGhlIG5ldyBmZWUuCiAgICBmdW5jdGlvbiBzZXRGZWUodWludDI1NiBfZmVlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoMCA8PSBfZmVlICYmIF9mZWUgPD0gMTAwMDAwKTsKICAgIAogICAgICAgIGZlZSA9IF9mZWU7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgYXVjdGlvbiBmb3IgdGhlIGdpdmVuIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gZ2V0IHRoZSBhdWN0aW9uIGZvci4KICAgIC8vLyBAZGV2IFRocm93cyBpZiB0aGVyZSBpcyBubyBhdWN0aW9uIGZvciB0aGUgZ2l2ZW4gZGVlZC4KICAgIGZ1bmN0aW9uIGdldEF1Y3Rpb24odWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgICAgICBhZGRyZXNzIHNlbGxlciwKICAgICAgICAgICAgdWludDI1NiBzdGFydFByaWNlLAogICAgICAgICAgICB1aW50MjU2IGVuZFByaWNlLAogICAgICAgICAgICB1aW50MjU2IGR1cmF0aW9uLAogICAgICAgICAgICB1aW50MjU2IHN0YXJ0ZWRBdAogICAgICAgICkKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGlkZW50aWZpZXJUb0F1Y3Rpb25bX2RlZWRJZF07CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGF1Y3Rpb24gbXVzdCBiZSBhY3RpdmUKICAgICAgICByZXF1aXJlKF9hY3RpdmVBdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydFByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmVuZFByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ3JlYXRlIGFuIGF1Y3Rpb24gZm9yIGEgZ2l2ZW4gZGVlZC4KICAgIC8vLyBNdXN0IHByZXZpb3VzbHkgaGF2ZSBiZWVuIGdpdmVuIGFwcHJvdmFsIHRvIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBkZWVkLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNyZWF0ZSBhbiBhdWN0aW9uIGZvci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0UHJpY2UgVGhlIHN0YXJ0aW5nIHByaWNlIG9mIHRoZSBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kUHJpY2UgVGhlIGVuZGluZyBwcmljZSBvZiB0aGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIFRoZSBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcGFydCBvZiB0aGUgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24odWludDI1NiBfZGVlZElkLCB1aW50MjU2IF9zdGFydFByaWNlLCB1aW50MjU2IF9lbmRQcmljZSwgdWludDI1NiBfZHVyYXRpb24pCiAgICAgICAgcHVibGljCiAgICAgICAgZml0c0luMTI4Qml0cyhfc3RhcnRQcmljZSkKICAgICAgICBmaXRzSW4xMjhCaXRzKF9lbmRQcmljZSkKICAgICAgICBmaXRzSW42NEJpdHMoX2R1cmF0aW9uKQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBHZXQgdGhlIG93bmVyIG9mIHRoZSBkZWVkIHRvIGJlIGF1Y3Rpb25lZAogICAgICAgIGFkZHJlc3MgZGVlZE93bmVyID0gZGVlZENvbnRyYWN0Lm93bmVyT2YoX2RlZWRJZCk7CiAgICAKICAgICAgICAvLyBDYWxsZXIgbXVzdCBlaXRoZXIgYmUgdGhlIGRlZWQgY29udHJhY3Qgb3IgdGhlIG93bmVyIG9mIHRoZSBkZWVkCiAgICAgICAgLy8gdG8gcHJldmVudCBhYnVzZS4KICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3MoZGVlZENvbnRyYWN0KSB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGRlZWRPd25lcgogICAgICAgICk7CiAgICAKICAgICAgICAvLyBUaGUgZHVyYXRpb24gb2YgdGhlIGF1Y3Rpb24gbXVzdCBiZSBhdCBsZWFzdCA2MCBzZWNvbmRzLgogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID49IDYwKTsKICAgIAogICAgICAgIC8vIFRocm93cyBpZiBwbGFjaW5nIHRoZSBkZWVkIGluIGVzY3JvdyBmYWlscyAodGhlIGNvbnRyYWN0IHJlcXVpcmVzCiAgICAgICAgLy8gdHJhbnNmZXIgYXBwcm92YWwgcHJpb3IgdG8gY3JlYXRpbmcgdGhlIGF1Y3Rpb24pLgogICAgICAgIF9lc2Nyb3coX2RlZWRJZCk7CiAgICAgICAgCiAgICAgICAgLy8gQXVjdGlvbiBzdHJ1Y3QKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgZGVlZE93bmVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydFByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIAogICAgICAgIF9jcmVhdGVBdWN0aW9uKF9kZWVkSWQsIGF1Y3Rpb24pOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBDYW5jZWwgYW4gYXVjdGlvbgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNhbmNlbCB0aGUgYXVjdGlvbiBmb3IuCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdOwogICAgICAgIAogICAgICAgIC8vIFRoZSBhdWN0aW9uIG11c3QgYmUgYWN0aXZlLgogICAgICAgIHJlcXVpcmUoX2FjdGl2ZUF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIAogICAgICAgIC8vIFRoZSBhdWN0aW9uIGNhbiBvbmx5IGJlIGNhbmNlbGxlZCBieSB0aGUgc2VsbGVyCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGF1Y3Rpb24uc2VsbGVyKTsKICAgICAgICAKICAgICAgICBfY2FuY2VsQXVjdGlvbihfZGVlZElkLCBhdWN0aW9uKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQmlkIG9uIGFuIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gYmlkIG9uLgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBUaHJvd3MgaWYgdGhlIGJpZCBkb2VzIG5vdCBzdWNjZWVkLgogICAgICAgIF9iaWQobXNnLnNlbmRlciwgbXNnLnZhbHVlLCBfZGVlZElkKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGdldCB0aGUgY3VycmVuY3kgcHJpY2UgZm9yLgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFByaWNlKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdOwogICAgICAgIAogICAgICAgIC8vIFRoZSBhdWN0aW9uIG11c3QgYmUgYWN0aXZlLgogICAgICAgIHJlcXVpcmUoX2FjdGl2ZUF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIAogICAgICAgIHJldHVybiBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBXaXRoZHJhdyBldGhlciBvd2VkIHRvIGEgYmVuZWZpY2lhcnkuCiAgICAvLy8gQHBhcmFtIGJlbmVmaWNpYXJ5IFRoZSBhZGRyZXNzIHRvIHdpdGhkcmF3IHRoZSBhdWN0aW9uIGJhbGFuY2UgZm9yLgogICAgZnVuY3Rpb24gd2l0aGRyYXdBdWN0aW9uQmFsYW5jZShhZGRyZXNzIGJlbmVmaWNpYXJ5KSBleHRlcm5hbCB7CiAgICAgICAgLy8gVGhlIHNlbmRlciBtdXN0IGVpdGhlciBiZSB0aGUgYmVuZWZpY2lhcnkgb3IgdGhlIGNvcmUgZGVlZCBjb250cmFjdC4KICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGJlbmVmaWNpYXJ5IHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhkZWVkQ29udHJhY3QpCiAgICAgICAgKTsKICAgICAgICAKICAgICAgICB1aW50MjU2IGV0aGVyT3dlZCA9IGFkZHJlc3NUb0V0aGVyT3dlZFtiZW5lZmljaWFyeV07CiAgICAgICAgCiAgICAgICAgLy8gRW5zdXJlIGV0aGVyIGlzIG93ZWQgdG8gdGhlIGJlbmVmaWNpYXJ5LgogICAgICAgIHJlcXVpcmUoZXRoZXJPd2VkID4gMCk7CiAgICAgICAgIAogICAgICAgIC8vIFNldCBldGhlciBvd2VkIHRvIDAgICAKICAgICAgICBkZWxldGUgYWRkcmVzc1RvRXRoZXJPd2VkW2JlbmVmaWNpYXJ5XTsKICAgICAgICAKICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRvdGFsIG91dHN0YW5kaW5nIGJhbGFuY2UuIGV0aGVyT3dlZCBpcyBndWFyYW50ZWVkCiAgICAgICAgLy8gdG8gYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIG91dHN0YW5kaW5nRXRoZXIsIHNvIHRoaXMgY2Fubm90CiAgICAgICAgLy8gdW5kZXJmbG93LgogICAgICAgIG91dHN0YW5kaW5nRXRoZXIgLT0gZXRoZXJPd2VkOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIGV0aGVyIG93ZWQgdG8gdGhlIGJlbmVmaWNpYXJ5IChub3Qgc3VzY2VwdGlibGUgdG8gcmUtZW50cnkKICAgICAgICAvLyBhdHRhY2ssIGFzIHRoZSBldGhlciBvd2VkIGlzIHNldCB0byAwIGJlZm9yZSB0aGUgdHJhbnNmZXIgdGFrZXMgcGxhY2UpLgogICAgICAgIGJlbmVmaWNpYXJ5LnRyYW5zZmVyKGV0aGVyT3dlZCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFdpdGhkcmF3ICh1bm93ZWQpIGNvbnRyYWN0IGJhbGFuY2UuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0ZyZWVCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZnJlZSAodW5vd2VkKSBiYWxhbmNlLiBUaGlzIG5ldmVyIHVuZGVyZmxvd3MsIGFzCiAgICAgICAgLy8gb3V0c3RhbmRpbmdFdGhlciBpcyBndWFyYW50ZWVkIHRvIGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUKICAgICAgICAvLyBjb250cmFjdCBiYWxhbmNlLgogICAgICAgIHVpbnQyNTYgZnJlZUJhbGFuY2UgPSB0aGlzLmJhbGFuY2UgLSBvdXRzdGFuZGluZ0V0aGVyOwogICAgICAgIAogICAgICAgIGFkZHJlc3MgZGVlZENvbnRyYWN0QWRkcmVzcyA9IGFkZHJlc3MoZGVlZENvbnRyYWN0KTsKCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBvd25lciB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGRlZWRDb250cmFjdEFkZHJlc3MKICAgICAgICApOwogICAgICAgIAogICAgICAgIGRlZWRDb250cmFjdEFkZHJlc3MudHJhbnNmZXIoZnJlZUJhbGFuY2UpOwogICAgfQp9CgoKY29udHJhY3QgU2FsZUF1Y3Rpb24gaXMgQ2xvY2tBdWN0aW9uIHsKICAgIGZ1bmN0aW9uIFNhbGVBdWN0aW9uKGFkZHJlc3MgX2RlZWRDb250cmFjdEFkZHJlc3MsIHVpbnQyNTYgX2ZlZSkgQ2xvY2tBdWN0aW9uKF9kZWVkQ29udHJhY3RBZGRyZXNzLCBfZmVlKSBwdWJsaWMge30KICAgIAogICAgLy8vIEBkZXYgQWxsb3dzIG90aGVyIGNvbnRyYWN0cyB0byBjaGVjayB3aGV0aGVyIHRoaXMgaXMgdGhlIGV4cGVjdGVkIGNvbnRyYWN0LgogICAgYm9vbCBwdWJsaWMgaXNTYWxlQXVjdGlvbiA9IHRydWU7Cn0KCgpjb250cmFjdCBSZW50QXVjdGlvbiBpcyBDbG9ja0F1Y3Rpb24gewogICAgZnVuY3Rpb24gUmVudEF1Y3Rpb24oYWRkcmVzcyBfZGVlZENvbnRyYWN0QWRkcmVzcywgdWludDI1NiBfZmVlKSBDbG9ja0F1Y3Rpb24oX2RlZWRDb250cmFjdEFkZHJlc3MsIF9mZWUpIHB1YmxpYyB7fQogICAgCiAgICAvLy8gQGRldiBBbGxvd3Mgb3RoZXIgY29udHJhY3RzIHRvIGNoZWNrIHdoZXRoZXIgdGhpcyBpcyB0aGUgZXhwZWN0ZWQgY29udHJhY3QuCiAgICBib29sIHB1YmxpYyBpc1JlbnRBdWN0aW9uID0gdHJ1ZTsKICAgIAogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgaWRlbnRpZmllclRvUmVudFBlcmlvZDsKICAgIAogICAgLy8vIEBub3RpY2UgQ3JlYXRlIGFuIGF1Y3Rpb24gZm9yIGEgZ2l2ZW4gZGVlZC4gQmUgY2FyZWZ1bCB3aGVuIGNhbGxpbmcKICAgIC8vLyBjcmVhdGVBdWN0aW9uIGZvciBhIFJlbnRBdWN0aW9uLCB0aGF0IHRoaXMgb3ZlcmxvYWRlZCBmdW5jdGlvbiAoaW5jbHVkaW5nCiAgICAvLy8gdGhlIF9yZW50UGVyaW9kIHBhcmFtZXRlcikgaXMgdXNlZC4gT3RoZXJ3aXNlIHRoZSByZW50IHBlcmlvZCBkZWZhdWx0cyB0bwogICAgLy8vIGEgd2Vlay4KICAgIC8vLyBNdXN0IHByZXZpb3VzbHkgaGF2ZSBiZWVuIGdpdmVuIGFwcHJvdmFsIHRvIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBkZWVkLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGNyZWF0ZSBhbiBhdWN0aW9uIGZvci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0UHJpY2UgVGhlIHN0YXJ0aW5nIHByaWNlIG9mIHRoZSBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kUHJpY2UgVGhlIGVuZGluZyBwcmljZSBvZiB0aGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIFRoZSBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcGFydCBvZiB0aGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3JlbnRQZXJpb2QgVGhlIHJlbnQgcGVyaW9kIGluIHNlY29uZHMgYmVpbmcgYXVjdGlvbmVkLgogICAgZnVuY3Rpb24gY3JlYXRlQXVjdGlvbigKICAgICAgICB1aW50MjU2IF9kZWVkSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9yZW50UGVyaW9kCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICAvLyBSZXF1aXJlIHRoZSByZW50IHBlcmlvZCB0byBiZSBhdCBsZWFzdCBvbmUgaG91ci4KICAgICAgICByZXF1aXJlKF9yZW50UGVyaW9kID49IDM2MDApOwogICAgICAgIAogICAgICAgIC8vIFJlcXVpcmUgdGhlcmUgdG8gYmUgbm8gYWN0aXZlIHJlbnRlci4KICAgICAgICBEV29ybGRSZW50aW5nIGRXb3JsZFJlbnRpbmdDb250cmFjdCA9IERXb3JsZFJlbnRpbmcoZGVlZENvbnRyYWN0KTsKICAgICAgICB2YXIgKHJlbnRlciwpID0gZFdvcmxkUmVudGluZ0NvbnRyYWN0LnJlbnRlck9mKF9kZWVkSWQpOwogICAgICAgIHJlcXVpcmUocmVudGVyID09IGFkZHJlc3MoMCkpOwogICAgCiAgICAgICAgLy8gU2V0IHRoZSByZW50IHBlcmlvZC4KICAgICAgICBpZGVudGlmaWVyVG9SZW50UGVyaW9kW19kZWVkSWRdID0gX3JlbnRQZXJpb2Q7CiAgICAKICAgICAgICAvLyBUaHJvd3MgKHJldmVydHMpIGlmIGNyZWF0aW5nIHRoZSBhdWN0aW9uIGZhaWxzLgogICAgICAgIGNyZWF0ZUF1Y3Rpb24oX2RlZWRJZCwgX3N0YXJ0UHJpY2UsIF9lbmRQcmljZSwgX2R1cmF0aW9uKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgUGVyZm9ybSB0aGUgYmlkIHdpbiBsb2dpYyAoaW4gdGhpcyBjYXNlOiBnaXZlIHJlbnRlciBzdGF0dXMgdG8gdGhlIHdpbm5lcikuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbGxlci4KICAgIC8vLyBAcGFyYW0gX3dpbm5lciBUaGUgYWRkcmVzcyBvZiB0aGUgd2lubmVyLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkLgogICAgLy8vIEBwYXJhbSBfcHJpY2UgVGhlIHByaWNlIHRoZSBhdWN0aW9uIHdhcyBib3VnaHQgYXQuCiAgICBmdW5jdGlvbiBfd2luQmlkKGFkZHJlc3MgX3NlbGxlciwgYWRkcmVzcyBfd2lubmVyLCB1aW50MjU2IF9kZWVkSWQsIHVpbnQyNTYgX3ByaWNlKSBpbnRlcm5hbCB7CiAgICAgICAgRFdvcmxkUmVudGluZyBkV29ybGRSZW50aW5nQ29udHJhY3QgPSBEV29ybGRSZW50aW5nKGRlZWRDb250cmFjdCk7CiAgICAKICAgICAgICB1aW50MjU2IHJlbnRQZXJpb2QgPSBpZGVudGlmaWVyVG9SZW50UGVyaW9kW19kZWVkSWRdOwogICAgICAgIGlmIChyZW50UGVyaW9kID09IDApIHsKICAgICAgICAgICAgcmVudFBlcmlvZCA9IDYwNDgwMDsgLy8gMSB3ZWVrIGJ5IGRlZmF1bHQKICAgICAgICB9CiAgICAKICAgICAgICAvLyBSZW50IHRoZSBkZWVkIG91dCB0byB0aGUgd2lubmVyLgogICAgICAgIGRXb3JsZFJlbnRpbmdDb250cmFjdC5yZW50T3V0KF93aW5uZXIsIGlkZW50aWZpZXJUb1JlbnRQZXJpb2RbX2RlZWRJZF0sIF9kZWVkSWQpOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIHRoZSBkZWVkIGJhY2sgdG8gdGhlIHNlbGxlci4KICAgICAgICBfdHJhbnNmZXIoX3NlbGxlciwgX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFJlbW92ZSBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIGZvciB3aGljaCB0aGUgYXVjdGlvbiBzaG91bGQgYmUgcmVtb3ZlZC4KICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSBpZGVudGlmaWVyVG9BdWN0aW9uW19kZWVkSWRdOwogICAgICAgIGRlbGV0ZSBpZGVudGlmaWVyVG9SZW50UGVyaW9kW19kZWVkSWRdOwogICAgfQp9CgoKLy8vIEBkZXYgSG9sZHMgZnVuY3Rpb25hbGl0eSBmb3IgbWludGluZyBuZXcgcGxvdCBkZWVkcy4KY29udHJhY3QgRFdvcmxkTWludGluZyBpcyBEV29ybGRSZW50aW5nIHsKICAgIHVpbnQyNTYgcHVibGljIHVuY2xhaW1lZFBsb3RQcmljZSA9IDAuMDAyNSBldGhlcjsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgZnJlZUNsYWltQWxsb3dhbmNlOwogICAgCiAgICAvLy8gQG5vdGljZSBTZXRzIHRoZSBuZXcgcHJpY2UgZm9yIHVuY2xhaW1lZCBwbG90cy4KICAgIC8vLyBAcGFyYW0gX3VuY2xhaW1lZFBsb3RQcmljZSBUaGUgbmV3IHByaWNlIGZvciB1bmNsYWltZWQgcGxvdHMuCiAgICBmdW5jdGlvbiBzZXRVbmNsYWltZWRQbG90UHJpY2UodWludDI1NiBfdW5jbGFpbWVkUGxvdFByaWNlKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICB1bmNsYWltZWRQbG90UHJpY2UgPSBfdW5jbGFpbWVkUGxvdFByaWNlOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXQgdGhlIGZyZWUgY2xhaW0gYWxsb3dhbmNlIGZvciBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIFRoZSBhZGRyZXNzIHRvIHNldCB0aGUgZnJlZSBjbGFpbSBhbGxvd2FuY2UgZm9yLgogICAgLy8vIEBwYXJhbSBhbGxvd2FuY2UgVGhlIGZyZWUgY2xhaW0gYWxsb3dhbmNlIHRvIHNldC4KICAgIGZ1bmN0aW9uIHNldEZyZWVDbGFpbUFsbG93YW5jZShhZGRyZXNzIGFkZHIsIHVpbnQyNTYgYWxsb3dhbmNlKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICBmcmVlQ2xhaW1BbGxvd2FuY2VbYWRkcl0gPSBhbGxvd2FuY2U7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEdldCB0aGUgZnJlZSBjbGFpbSBhbGxvd2FuY2Ugb2YgYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkciBUaGUgYWRkcmVzcyB0byBnZXQgdGhlIGZyZWUgY2xhaW0gYWxsb3dhbmNlIG9mLgogICAgZnVuY3Rpb24gZnJlZUNsYWltQWxsb3dhbmNlT2YoYWRkcmVzcyBhZGRyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZnJlZUNsYWltQWxsb3dhbmNlW2FkZHJdOwogICAgfQogICAgICAgCiAgICAvLy8gQG5vdGljZSBCdXkgYW4gdW5jbGFpbWVkIHBsb3QuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIHVuY2xhaW1lZCBwbG90IHRvIGJ1eS4KICAgIGZ1bmN0aW9uIGNsYWltUGxvdCh1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgY2xhaW1QbG90V2l0aERhdGEoX2RlZWRJZCwgIiIsICIiLCAiIiwgIiIpOwogICAgfQogICAgICAgCiAgICAvLy8gQG5vdGljZSBCdXkgYW4gdW5jbGFpbWVkIHBsb3QuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIHVuY2xhaW1lZCBwbG90IHRvIGJ1eS4KICAgIC8vLyBAcGFyYW0gbmFtZSBUaGUgbmFtZSB0byBnaXZlIHRoZSBwbG90LgogICAgLy8vIEBwYXJhbSBkZXNjcmlwdGlvbiBUaGUgZGVzY3JpcHRpb24gdG8gYWRkIHRvIHRoZSBwbG90LgogICAgLy8vIEBwYXJhbSBpbWFnZVVybCBUaGUgaW1hZ2UgdXJsIGZvciB0aGUgcGxvdC4KICAgIC8vLyBAcGFyYW0gaW5mb1VybCBUaGUgaW5mbyB1cmwgZm9yIHRoZSBwbG90LgogICAgZnVuY3Rpb24gY2xhaW1QbG90V2l0aERhdGEodWludDI1NiBfZGVlZElkLCBzdHJpbmcgbmFtZSwgc3RyaW5nIGRlc2NyaXB0aW9uLCBzdHJpbmcgaW1hZ2VVcmwsIHN0cmluZyBpbmZvVXJsKSBwdWJsaWMgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IF9kZWVkSWRzID0gbmV3IHVpbnQyNTZbXSgxKTsKICAgICAgICBfZGVlZElkc1swXSA9IF9kZWVkSWQ7CiAgICAgICAgCiAgICAgICAgY2xhaW1QbG90TXVsdGlwbGVXaXRoRGF0YShfZGVlZElkcywgbmFtZSwgZGVzY3JpcHRpb24sIGltYWdlVXJsLCBpbmZvVXJsKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQnV5IHVuY2xhaW1lZCBwbG90cy4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZHMgVGhlIHVuY2xhaW1lZCBwbG90cyB0byBidXkuCiAgICBmdW5jdGlvbiBjbGFpbVBsb3RNdWx0aXBsZSh1aW50MjU2W10gX2RlZWRJZHMpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgY2xhaW1QbG90TXVsdGlwbGVXaXRoRGF0YShfZGVlZElkcywgIiIsICIiLCAiIiwgIiIpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBCdXkgdW5jbGFpbWVkIHBsb3RzLgogICAgLy8vIEBwYXJhbSBfZGVlZElkcyBUaGUgdW5jbGFpbWVkIHBsb3RzIHRvIGJ1eS4KICAgIC8vLyBAcGFyYW0gbmFtZSBUaGUgbmFtZSB0byBnaXZlIHRoZSBwbG90cy4KICAgIC8vLyBAcGFyYW0gZGVzY3JpcHRpb24gVGhlIGRlc2NyaXB0aW9uIHRvIGFkZCB0byB0aGUgcGxvdHMuCiAgICAvLy8gQHBhcmFtIGltYWdlVXJsIFRoZSBpbWFnZSB1cmwgZm9yIHRoZSBwbG90cy4KICAgIC8vLyBAcGFyYW0gaW5mb1VybCBUaGUgaW5mbyB1cmwgZm9yIHRoZSBwbG90cy4KICAgIGZ1bmN0aW9uIGNsYWltUGxvdE11bHRpcGxlV2l0aERhdGEodWludDI1NltdIF9kZWVkSWRzLCBzdHJpbmcgbmFtZSwgc3RyaW5nIGRlc2NyaXB0aW9uLCBzdHJpbmcgaW1hZ2VVcmwsIHN0cmluZyBpbmZvVXJsKSBwdWJsaWMgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2IGJ1eUFtb3VudCA9IF9kZWVkSWRzLmxlbmd0aDsKICAgICAgICB1aW50MjU2IGV0aGVyUmVxdWlyZWQ7CiAgICAgICAgaWYgKGZyZWVDbGFpbUFsbG93YW5jZVttc2cuc2VuZGVyXSA+IDApIHsKICAgICAgICAgICAgLy8gVGhlIHNlbmRlciBoYXMgYSBmcmVlIGNsYWltIGFsbG93YW5jZS4KICAgICAgICAgICAgaWYgKGZyZWVDbGFpbUFsbG93YW5jZVttc2cuc2VuZGVyXSA+IGJ1eUFtb3VudCkgewogICAgICAgICAgICAgICAgLy8gU3VidHJhY3QgZnJvbSBhbGxvd2FuY2UuCiAgICAgICAgICAgICAgICBmcmVlQ2xhaW1BbGxvd2FuY2VbbXNnLnNlbmRlcl0gLT0gYnV5QW1vdW50OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBObyBldGhlciBpcyByZXF1aXJlZC4KICAgICAgICAgICAgICAgIGV0aGVyUmVxdWlyZWQgPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdWludDI1NiBmcmVlQW1vdW50ID0gZnJlZUNsYWltQWxsb3dhbmNlW21zZy5zZW5kZXJdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUaGUgZnVsbCBhbGxvd2FuY2UgaGFzIGJlZW4gdXNlZC4KICAgICAgICAgICAgICAgIGRlbGV0ZSBmcmVlQ2xhaW1BbGxvd2FuY2VbbXNnLnNlbmRlcl07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRoZSBzdWJ0cmFjdGlvbiBjYW5ub3QgdW5kZXJmbG93LCBhcyBmcmVlQW1vdW50IDw9IGJ1eUFtb3VudC4KICAgICAgICAgICAgICAgIGV0aGVyUmVxdWlyZWQgPSB1bmNsYWltZWRQbG90UHJpY2UubXVsKGJ1eUFtb3VudCAtIGZyZWVBbW91bnQpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gVGhlIHNlbmRlciBkb2VzIG5vdCBoYXZlIGEgZnJlZSBjbGFpbSBhbGxvd2FuY2UuCiAgICAgICAgICAgIGV0aGVyUmVxdWlyZWQgPSB1bmNsYWltZWRQbG90UHJpY2UubXVsKGJ1eUFtb3VudCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEVuc3VyZSBlbm91Z2ggZXRoZXIgaXMgc3VwcGxpZWQuCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gZXRoZXJSZXF1aXJlZCk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBvZmZzZXQgPSBwbG90cy5sZW5ndGg7CiAgICAgICAgCiAgICAgICAgLy8gQWxsb2NhdGUgYWRkaXRpb25hbCBtZW1vcnkgZm9yIHRoZSBwbG90cyBhcnJheQogICAgICAgIC8vICh0aGlzIGlzIG1vcmUgZWZmaWNpZW50IHRoYW4gLnB1c2gtaW5nIGVhY2ggaW5kaXZpZHVhbAogICAgICAgIC8vIHBsb3QsIGFzIHRoYXQgcmVxdWlyZXMgbXVsdGlwbGUgZHluYW1pYyBhbGxvY2F0aW9ucykuCiAgICAgICAgcGxvdHMubGVuZ3RoID0gcGxvdHMubGVuZ3RoLmFkZChfZGVlZElkcy5sZW5ndGgpOwogICAgICAgIAogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9kZWVkSWRzLmxlbmd0aDsgaSsrKSB7IAogICAgICAgICAgICB1aW50MjU2IF9kZWVkSWQgPSBfZGVlZElkc1tpXTsKICAgICAgICAgICAgcmVxdWlyZSh2YWxpZElkZW50aWZpZXIoX2RlZWRJZCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGhlIHBsb3QgbXVzdCBiZSB1bm93bmVkIChhIHBsb3QgZGVlZCBjYW5ub3QgYmUgdHJhbnNmZXJyZWQgdG8KICAgICAgICAgICAgLy8gMHgwLCBzbyBvbmNlIGEgcGxvdCBpcyBjbGFpbWVkIGl0IHdpbGwgYWx3YXlzIGJlIG93bmVkIGJ5IGEKICAgICAgICAgICAgLy8gbm9uLXplcm8gYWRkcmVzcykuCiAgICAgICAgICAgIHJlcXVpcmUoaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF0gPT0gYWRkcmVzcygwKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHBsb3QKICAgICAgICAgICAgcGxvdHNbb2Zmc2V0ICsgaV0gPSB1aW50MzIoX2RlZWRJZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUcmFuc2ZlciB0aGUgbmV3IHBsb3QgdG8gdGhlIHNlbmRlci4KICAgICAgICAgICAgX3RyYW5zZmVyKGFkZHJlc3MoMCksIG1zZy5zZW5kZXIsIF9kZWVkSWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2V0IHRoZSBwbG90IGRhdGEuCiAgICAgICAgICAgIF9zZXRQbG90RGF0YShfZGVlZElkLCBuYW1lLCBkZXNjcmlwdGlvbiwgaW1hZ2VVcmwsIGluZm9VcmwpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGV4Y2VzcyBldGhlciBzZW50CiAgICAgICAgLy8gbXNnLnZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byBldGhlclJlcXVpcmVkLAogICAgICAgIC8vIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGV4Y2VzcyA9IG1zZy52YWx1ZSAtIGV0aGVyUmVxdWlyZWQ7CiAgICAgICAgCiAgICAgICAgaWYgKGV4Y2VzcyA+IDApIHsKICAgICAgICAgICAgLy8gUmVmdW5kIGFueSBleGNlc3MgZXRoZXIgKG5vdCBzdXNjZXB0aWJsZSB0byByZS1lbnRyeSBhdHRhY2ssIGFzCiAgICAgICAgICAgIC8vIHRoZSBvd25lciBpcyBhc3NpZ25lZCBiZWZvcmUgdGhlIHRyYW5zZmVyIHRha2VzIHBsYWNlKS4KICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlc3MpOwogICAgICAgIH0KICAgIH0KfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgRFdvcmxkIGF1Y3Rpb24gZnVuY3Rpb25hbGl0eS4KY29udHJhY3QgRFdvcmxkQXVjdGlvbiBpcyBEV29ybGRNaW50aW5nIHsKICAgIFNhbGVBdWN0aW9uIHB1YmxpYyBzYWxlQXVjdGlvbkNvbnRyYWN0OwogICAgUmVudEF1Y3Rpb24gcHVibGljIHJlbnRBdWN0aW9uQ29udHJhY3Q7CiAgICAKICAgIC8vLyBAbm90aWNlIHNldCB0aGUgY29udHJhY3QgYWRkcmVzcyBvZiB0aGUgc2FsZSBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgc2FsZSBhdWN0aW9uLgogICAgZnVuY3Rpb24gc2V0U2FsZUF1Y3Rpb25Db250cmFjdEFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBTYWxlQXVjdGlvbiBfY29udHJhY3QgPSBTYWxlQXVjdGlvbihfYWRkcmVzcyk7CiAgICAKICAgICAgICByZXF1aXJlKF9jb250cmFjdC5pc1NhbGVBdWN0aW9uKCkpOwogICAgICAgIAogICAgICAgIHNhbGVBdWN0aW9uQ29udHJhY3QgPSBfY29udHJhY3Q7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNldCB0aGUgY29udHJhY3QgYWRkcmVzcyBvZiB0aGUgcmVudCBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgcmVudCBhdWN0aW9uLgogICAgZnVuY3Rpb24gc2V0UmVudEF1Y3Rpb25Db250cmFjdEFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBSZW50QXVjdGlvbiBfY29udHJhY3QgPSBSZW50QXVjdGlvbihfYWRkcmVzcyk7CiAgICAKICAgICAgICByZXF1aXJlKF9jb250cmFjdC5pc1JlbnRBdWN0aW9uKCkpOwogICAgICAgIAogICAgICAgIHJlbnRBdWN0aW9uQ29udHJhY3QgPSBfY29udHJhY3Q7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIENyZWF0ZSBhIHNhbGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBjcmVhdGUgYSBzYWxlIGF1Y3Rpb24gZm9yLgogICAgLy8vIEBwYXJhbSBfc3RhcnRQcmljZSBUaGUgc3RhcnRpbmcgcHJpY2Ugb2YgdGhlIHNhbGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZFByaWNlIFRoZSBlbmRpbmcgcHJpY2Ugb2YgdGhlIHNhbGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIFRoZSBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcGFydCBvZiB0aGUgc2FsZSBhdWN0aW9uLgogICAgZnVuY3Rpb24gY3JlYXRlU2FsZUF1Y3Rpb24odWludDI1NiBfZGVlZElkLCB1aW50MjU2IF9zdGFydFByaWNlLCB1aW50MjU2IF9lbmRQcmljZSwgdWludDI1NiBfZHVyYXRpb24pCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfZGVlZElkKSk7CiAgICAgICAgCiAgICAgICAgLy8gUHJldmVudCBjcmVhdGluZyBhIHNhbGUgYXVjdGlvbiBpZiBubyBzYWxlIGF1Y3Rpb24gY29udHJhY3QgaXMgY29uZmlndXJlZC4KICAgICAgICByZXF1aXJlKGFkZHJlc3Moc2FsZUF1Y3Rpb25Db250cmFjdCkgIT0gYWRkcmVzcygwKSk7CiAgICAKICAgICAgICAvLyBBcHByb3ZlIHRoZSBkZWVkIGZvciB0cmFuc2ZlcnJpbmcgdG8gdGhlIHNhbGUgYXVjdGlvbi4KICAgICAgICBfYXBwcm92ZShtc2cuc2VuZGVyLCBhZGRyZXNzKHNhbGVBdWN0aW9uQ29udHJhY3QpLCBfZGVlZElkKTsKICAgIAogICAgICAgIC8vIEF1Y3Rpb24gY29udHJhY3QgY2hlY2tzIGlucHV0IHZhbHVlcyAodGhyb3dzIGlmIGludmFsaWQpIGFuZCBwbGFjZXMgdGhlIGRlZWQgaW50byBlc2Nyb3cuCiAgICAgICAgc2FsZUF1Y3Rpb25Db250cmFjdC5jcmVhdGVBdWN0aW9uKF9kZWVkSWQsIF9zdGFydFByaWNlLCBfZW5kUHJpY2UsIF9kdXJhdGlvbik7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIENyZWF0ZSBhIHJlbnQgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBjcmVhdGUgYSByZW50IGF1Y3Rpb24gZm9yLgogICAgLy8vIEBwYXJhbSBfc3RhcnRQcmljZSBUaGUgc3RhcnRpbmcgcHJpY2Ugb2YgdGhlIHJlbnQgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZFByaWNlIFRoZSBlbmRpbmcgcHJpY2Ugb2YgdGhlIHJlbnQgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIFRoZSBkdXJhdGlvbiBpbiBzZWNvbmRzIG9mIHRoZSBkeW5hbWljIHByaWNpbmcgcGFydCBvZiB0aGUgcmVudCBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfcmVudFBlcmlvZCBUaGUgcmVudCBwZXJpb2QgaW4gc2Vjb25kcyBiZWluZyBhdWN0aW9uZWQuCiAgICBmdW5jdGlvbiBjcmVhdGVSZW50QXVjdGlvbih1aW50MjU2IF9kZWVkSWQsIHVpbnQyNTYgX3N0YXJ0UHJpY2UsIHVpbnQyNTYgX2VuZFByaWNlLCB1aW50MjU2IF9kdXJhdGlvbiwgdWludDI1NiBfcmVudFBlcmlvZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKICAgICAgICAKICAgICAgICAvLyBQcmV2ZW50IGNyZWF0aW5nIGEgcmVudCBhdWN0aW9uIGlmIG5vIHJlbnQgYXVjdGlvbiBjb250cmFjdCBpcyBjb25maWd1cmVkLgogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhyZW50QXVjdGlvbkNvbnRyYWN0KSAhPSBhZGRyZXNzKDApKTsKICAgICAgICAKICAgICAgICAvLyBBcHByb3ZlIHRoZSBkZWVkIGZvciB0cmFuc2ZlcnJpbmcgdG8gdGhlIHJlbnQgYXVjdGlvbi4KICAgICAgICBfYXBwcm92ZShtc2cuc2VuZGVyLCBhZGRyZXNzKHJlbnRBdWN0aW9uQ29udHJhY3QpLCBfZGVlZElkKTsKICAgICAgICAKICAgICAgICAvLyBUaHJvd3MgaWYgdGhlIGF1Y3Rpb24gaXMgaW52YWxpZCAoZS5nLiBkZWVkIGlzIGFscmVhZHkgcmVudGVkIG91dCksCiAgICAgICAgLy8gYW5kIHBsYWNlcyB0aGUgZGVlZCBpbnRvIGVzY3Jvdy4KICAgICAgICByZW50QXVjdGlvbkNvbnRyYWN0LmNyZWF0ZUF1Y3Rpb24oX2RlZWRJZCwgX3N0YXJ0UHJpY2UsIF9lbmRQcmljZSwgX2R1cmF0aW9uLCBfcmVudFBlcmlvZCk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEFsbG93IHRoZSBDRk8gdG8gY2FwdHVyZSB0aGUgZnJlZSBiYWxhbmNlIGF2YWlsYWJsZQogICAgLy8vIGluIHRoZSBhdWN0aW9uIGNvbnRyYWN0cy4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnJlZUF1Y3Rpb25CYWxhbmNlcygpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIHNhbGVBdWN0aW9uQ29udHJhY3Qud2l0aGRyYXdGcmVlQmFsYW5jZSgpOwogICAgICAgIHJlbnRBdWN0aW9uQ29udHJhY3Qud2l0aGRyYXdGcmVlQmFsYW5jZSgpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBBbGxvdyB3aXRoZHJhd2luZyBiYWxhbmNlcyBmcm9tIHRoZSBhdWN0aW9uIGNvbnRyYWN0cwogICAgLy8vIGluIGEgc2luZ2xlIHN0ZXAuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0F1Y3Rpb25CYWxhbmNlcygpIGV4dGVybmFsIHsKICAgICAgICAvLyBXaXRoZHJhdyBmcm9tIHRoZSBzYWxlIGNvbnRyYWN0IGlmIHRoZSBzZW5kZXIgaXMgb3dlZCBFdGhlci4KICAgICAgICBpZiAoc2FsZUF1Y3Rpb25Db250cmFjdC5hZGRyZXNzVG9FdGhlck93ZWQobXNnLnNlbmRlcikgPiAwKSB7CiAgICAgICAgICAgIHNhbGVBdWN0aW9uQ29udHJhY3Qud2l0aGRyYXdBdWN0aW9uQmFsYW5jZShtc2cuc2VuZGVyKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gV2l0aGRyYXcgZnJvbSB0aGUgcmVudCBjb250cmFjdCBpZiB0aGUgc2VuZGVyIGlzIG93ZWQgRXRoZXIuCiAgICAgICAgaWYgKHJlbnRBdWN0aW9uQ29udHJhY3QuYWRkcmVzc1RvRXRoZXJPd2VkKG1zZy5zZW5kZXIpID4gMCkgewogICAgICAgICAgICByZW50QXVjdGlvbkNvbnRyYWN0LndpdGhkcmF3QXVjdGlvbkJhbGFuY2UobXNnLnNlbmRlcik7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQGRldiBUaGlzIGNvbnRyYWN0IGlzIG9ubHkgcGF5YWJsZSBieSB0aGUgYXVjdGlvbiBjb250cmFjdHMuCiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3Moc2FsZUF1Y3Rpb25Db250cmFjdCkgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBhZGRyZXNzKHJlbnRBdWN0aW9uQ29udHJhY3QpCiAgICAgICAgKTsKICAgIH0KfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgaGlnaGVzdC1sZXZlbCBEV29ybGQgZnVuY3Rpb25hbGl0eS4KY29udHJhY3QgRFdvcmxkQ29yZSBpcyBEV29ybGRBdWN0aW9uIHsKICAgIC8vLyBJZiB0aGlzIGNvbnRyYWN0IGlzIGJyb2tlbiwgdGhpcyB3aWxsIGJlIHVzZWQgdG8gcHVibGlzaCB0aGUgYWRkcmVzcyBhdCB3aGljaCBhbiB1cGdyYWRlZCBjb250cmFjdCBjYW4gYmUgZm91bmQKICAgIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVkQ29udHJhY3RBZGRyZXNzOwogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgdXBncmFkZWRDb250cmFjdEFkZHJlc3MpOwoKICAgIC8vLyBAbm90aWNlIE9ubHkgdG8gYmUgdXNlZCB3aGVuIHRoaXMgY29udHJhY3QgaXMgc2lnbmlmaWNhbnRseSBicm9rZW4sCiAgICAvLy8gYW5kIGFuIHVwZ3JhZGUgaXMgcmVxdWlyZWQuCiAgICBmdW5jdGlvbiBzZXRVcGdyYWRlZENvbnRyYWN0QWRkcmVzcyhhZGRyZXNzIF91cGdyYWRlZENvbnRyYWN0QWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5QYXVzZWQgewogICAgICAgIHVwZ3JhZGVkQ29udHJhY3RBZGRyZXNzID0gX3VwZ3JhZGVkQ29udHJhY3RBZGRyZXNzOwogICAgICAgIENvbnRyYWN0VXBncmFkZShfdXBncmFkZWRDb250cmFjdEFkZHJlc3MpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNldCB0aGUgZGF0YSBhc3NvY2lhdGVkIHdpdGggYSBwbG90LgogICAgZnVuY3Rpb24gc2V0UGxvdERhdGEodWludDI1NiBfZGVlZElkLCBzdHJpbmcgbmFtZSwgc3RyaW5nIGRlc2NyaXB0aW9uLCBzdHJpbmcgaW1hZ2VVcmwsIHN0cmluZyBpbmZvVXJsKQogICAgICAgIHB1YmxpYwogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBUaGUgc2VuZGVyIHJlcXVlc3RpbmcgdGhlIGRhdGEgdXBkYXRlIHNob3VsZCBiZQogICAgICAgIC8vIHRoZSBvd25lciAod2l0aG91dCBhbiBhY3RpdmUgcmVudGVyKSBvciBzaG91bGQKICAgICAgICAvLyBiZSB0aGUgYWN0aXZlIHJlbnRlci4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF9kZWVkSWQpICYmIGlkZW50aWZpZXJUb1JlbnRQZXJpb2RFbmRUaW1lc3RhbXBbX2RlZWRJZF0gPCBub3cgfHwgX3JlbnRzKG1zZy5zZW5kZXIsIF9kZWVkSWQpKTsKICAgIAogICAgICAgIC8vIFNldCB0aGUgZGF0YQogICAgICAgIF9zZXRQbG90RGF0YShfZGVlZElkLCBuYW1lLCBkZXNjcmlwdGlvbiwgaW1hZ2VVcmwsIGluZm9VcmwpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXQgdGhlIGRhdGEgYXNzb2NpYXRlZCB3aXRoIG11bHRpcGxlIHBsb3RzLgogICAgZnVuY3Rpb24gc2V0UGxvdERhdGFNdWx0aXBsZSh1aW50MjU2W10gX2RlZWRJZHMsIHN0cmluZyBuYW1lLCBzdHJpbmcgZGVzY3JpcHRpb24sIHN0cmluZyBpbWFnZVVybCwgc3RyaW5nIGluZm9VcmwpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RlZWRJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdWludDI1NiBfZGVlZElkID0gX2RlZWRJZHNbaV07CiAgICAgICAgCiAgICAgICAgICAgIHNldFBsb3REYXRhKF9kZWVkSWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZVVybCwgaW5mb1VybCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBBbGxvdyB0aGUgQ0ZPIHRvIHdpdGhkcmF3IGJhbGFuY2UgYXZhaWxhYmxlIHRvIHRoaXMgY29udHJhY3QuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICBjZm9BZGRyZXNzLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9Cn0='.
	

]
