Class {
	#name : #SRTce2c1941dc92f12d6c06ce6645c0466090540dcd,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTce2c1941dc92f12d6c06ce6645c0466090540dcd >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovLyBGaWxlOiBjb250cmFjdHMvemVwcGVsaW4tc29saWRpdHktMS40L093bmFibGUuc29sCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvQlJEQ3Jvd2RzYWxlQXV0aG9yaXplci5zb2wKCi8qKgogKiBDb250cmFjdCBCUkRDcm93ZHNhbGVBdXRob3JpemVyIGlzIHVzZWQgYnkgdGhlIGNyb3dkc2FsZSB3ZWJzaXRlCiAqIHRvIGF1dG9yaXplIHdhbGxldHMgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZS4gQmVjYXVzZSBhbGwKICogcGFydGljaXBhbnRzIG11c3QgZ28gdGhyb3VnaCB0aGUgS1lDL0FNTCBwaGFzZSwgb25seSBhY2NvdW50cwogKiBsaXN0ZWQgaW4gdGhpcyBjb250cmFjdCBtYXkgY29udHJpYnV0ZSB0byB0aGUgY3Jvd2RzYWxlCiAqLwpjb250cmFjdCBCUkRDcm93ZHNhbGVBdXRob3JpemVyIGlzIE93bmFibGUgewogIC8vIHRoZXNlIGFjY291bnRzIGFyZSBhdXRob3JpemVkIHRvIHBhcnRpY2lwYXRlIGluIHRoZSBjcm93ZHNhbGUKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGludGVybmFsIGF1dGhvcml6ZWRBY2NvdW50czsKICAvLyB0aGVzZSBhY2NvdW50cyBhcmUgYXV0aG9yaXplZCB0byBhdXRob3JpemUgYWNjb3VudHMKICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGludGVybmFsIGF1dGhvcml6ZXJzOwoKICAvLyBlbWl0dGVkIHdoZW4gYSBuZXcgYWNjb3VudCBpcyBhdXRob3JpemVkCiAgZXZlbnQgQXV0aG9yaXplZChhZGRyZXNzIGluZGV4ZWQgX3RvKTsKCiAgLy8gYWRkIGFuIGF1dGhvcml6ZXIgdG8gdGhlIGF1dGhvcml6ZXJzIG1hcHBpbmcuIHRoZSBfbmV3QXV0aG9yaXplciB3aWxsCiAgLy8gYmUgYWJsZSB0byBhZGQgb3RoZXIgYXV0aG9yaXplcnMgYW5kIGF1dGhvcml6ZSBjcm93ZHNhbGUgcGFydGljaXBhbnRzCiAgZnVuY3Rpb24gYWRkQXV0aG9yaXplcihhZGRyZXNzIF9uZXdBdXRob3JpemVyKSBvbmx5T3duZXJPckF1dGhvcml6ZXIgcHVibGljIHsKICAgIC8vIGFsbG93IHRoZSBwcm92aWRlZCBhZGRyZXNzIHRvIGF1dGhvcml6ZSBhY2NvdW50cwogICAgYXV0aG9yaXplcnNbX25ld0F1dGhvcml6ZXJdID0gdHJ1ZTsKICB9CgogIC8vIHJlbW92ZSBhbiBhdXRob3JpemVyIGZyb20gdGhlIGF1dGhvcml6ZXJzIG1hcHBpbmcuIHRoZSBfYmFubmVkQXV0aG9yaXplciB3aWxsCiAgLy8gbm8gbG9uZ2VyIGhhdmUgcGVybWlzc2lvbiB0byBkbyBhbnl0aGluZyBvbiB0aGlzIGNvbnRyYWN0CiAgZnVuY3Rpb24gcmVtb3ZlQXV0aG9yaXplcihhZGRyZXNzIF9iYW5uZWRBdXRob3JpemVyKSBvbmx5T3duZXJPckF1dGhvcml6ZXIgcHVibGljIHsKICAgIC8vIG9ubHkgYXR0ZW1wdCB0byByZW1vdmUgdGhlIGF1dGhvcml6ZXIgaWYgdGhleSBhcmUgY3VycmVudGx5IGF1dGhvcml6ZWQKICAgIHJlcXVpcmUoYXV0aG9yaXplcnNbX2Jhbm5lZEF1dGhvcml6ZXJdKTsKICAgIC8vIHJlbW92ZSB0aGUgYXV0aG9yaXplcgogICAgZGVsZXRlIGF1dGhvcml6ZXJzW19iYW5uZWRBdXRob3JpemVyXTsKICB9CgogIC8vIGFsbG93IGFuIGFjY291bnQgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZQogIGZ1bmN0aW9uIGF1dGhvcml6ZUFjY291bnQoYWRkcmVzcyBfbmV3QWNjb3VudCkgb25seU93bmVyT3JBdXRob3JpemVyIHB1YmxpYyB7CiAgICBpZiAoIWF1dGhvcml6ZWRBY2NvdW50c1tfbmV3QWNjb3VudF0pIHsKICAgICAgLy8gYWxsb3cgdGhlIHByb3ZpZGVkIGFjY291bnQgdG8gcGFydGljaXBhdGUgaW4gdGhlIGNyb3dkc2FsZQogICAgICBhdXRob3JpemVkQWNjb3VudHNbX25ld0FjY291bnRdID0gdHJ1ZTsKICAgICAgLy8gZW1pdCB0aGUgQXV0aG9yaXplZCBldmVudAogICAgICBBdXRob3JpemVkKF9uZXdBY2NvdW50KTsKICAgIH0KICB9CgogIC8vIHJldHVybnMgd2hldGhlciBvciBub3QgdGhlIHByb3ZpZGVkIF9hY2NvdW50IGlzIGFuIGF1dGhvcml6ZXIKICBmdW5jdGlvbiBpc0F1dGhvcml6ZXIoYWRkcmVzcyBfYWNjb3VudCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wgX2lzQXV0aG9yaXplcikgewogICAgcmV0dXJuIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgYXV0aG9yaXplcnNbX2FjY291bnRdID09IHRydWU7CiAgfQoKICAvLyByZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBwcm92aWRlZCBfYWNjb3VudCBpcyBhdXRob3JpemVkIHRvIHBhcnRpY2lwYXRlIGluIHRoZSBjcm93ZHNhbGUKICBmdW5jdGlvbiBpc0F1dGhvcml6ZWQoYWRkcmVzcyBfYWNjb3VudCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wgX2F1dGhvcml6ZWQpIHsKICAgIHJldHVybiBhdXRob3JpemVkQWNjb3VudHNbX2FjY291bnRdID09IHRydWU7CiAgfQoKICAvLyBhbGxvdyBvbmx5IHRoZSBjb250cmFjdCBjcmVhdG9yIG9yIG9uZSBvZiB0aGUgYXV0aG9yaXplcnMgdG8gZG8gdGhpcwogIG1vZGlmaWVyIG9ubHlPd25lck9yQXV0aG9yaXplcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lciB8fCBhdXRob3JpemVyc1ttc2cuc2VuZGVyXSk7CiAgICBfOwogIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL3plcHBlbGluLXNvbGlkaXR5LTEuNC9TYWZlTWF0aC5zb2wKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9CUkRMb2NrdXAuc29sCgovKioKICogQ29udHJhY3QgQlJETG9ja3VwIGtlZXBzIHRyYWNrIG9mIGEgdmVzdGluZyBzY2hlZHVsZSBmb3IgcHJlLXNvbGQgdG9rZW5zLgogKiBQcmUtc29sZCB0b2tlbnMgYXJlIHJld2FyZGVkIHVwIHRvIGBudW1JbnRlcnZhbHNgIHRpbWVzIHNlcGFyYXRlZCBieSBhbgogKiBgaW50ZXJ2YWxgIG9mIHRpbWUuIEFuIGVxdWFsIGFtb3VudCBvZiB0b2tlbnMgKGBhbGxvY2F0aW9uYCBkaXZpZGVkIGJ5IGBudW1JbnRlcnZhbHNgKQogKiBpcyBtYXJrZWQgZm9yIHJld2FyZCBlYWNoIGBpbnRlcnZhbGAuCiAqCiAqIFRoZSBvd25lciBvZiB0aGUgY29udHJhY3Qgd2lsbCBjYWxsIHByb2Nlc3NJbnRlcnZhbCgpIHdoaWNoIHdpbGwKICogdXBkYXRlIHRoZSBhbGxvY2F0aW9uIHN0YXRlLiBUaGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IHNob3VsZCB0aGVuCiAqIHJlYWQgdGhlIGFsbG9jYXRpb24gZGF0YSBhbmQgcmV3YXJkIHRoZSBiZW5lZmljaWFyaWVzLgogKi8KY29udHJhY3QgQlJETG9ja3VwIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBBbGxvY2F0aW9uIHN0b3JlcyBpbmZvIGFib3V0IGhvdyBtYW55IHRva2VucyB0byByZXdhcmQgYSBiZW5lZmljaWFyeSBhY2NvdW50CiAgc3RydWN0IEFsbG9jYXRpb24gewogICAgYWRkcmVzcyBiZW5lZmljaWFyeTsgICAgICAvLyBhY2NvdW50IHRvIHJlY2VpdmUgcmV3YXJkcwogICAgdWludDI1NiBhbGxvY2F0aW9uOyAgICAgICAvLyB0b3RhbCBhbGxvY2F0ZWQgdG9rZW5zCiAgICB1aW50MjU2IHJlbWFpbmluZ0JhbGFuY2U7IC8vIHJlbWFpbmluZyBiYWxhbmNlIGFmdGVyIHRoZSBjdXJyZW50IGludGVydmFsCiAgICB1aW50MjU2IGN1cnJlbnRJbnRlcnZhbDsgIC8vIHRoZSBjdXJyZW50IGludGVydmFsIGZvciB0aGUgZ2l2ZW4gcmV3YXJkCiAgICB1aW50MjU2IGN1cnJlbnRSZXdhcmQ7ICAgIC8vIGFtb3VudCB0byBiZSByZXdhcmRlZCBkdXJpbmcgdGhlIGN1cnJlbnQgaW50ZXJ2YWwKICB9CgogIC8vIHRoZSBhbGxvY2F0aW9uIHN0YXRlCiAgQWxsb2NhdGlvbltdIHB1YmxpYyBhbGxvY2F0aW9uczsKCiAgLy8gdGhlIGRhdGUgYXQgd2hpY2ggYWxsb2NhdGlvbnMgYmVnaW4gdW5sb2NraW5nCiAgdWludDI1NiBwdWJsaWMgdW5sb2NrRGF0ZTsKCiAgLy8gdGhlIGN1cnJlbnQgdW5sb2NrIGludGVydmFsCiAgdWludDI1NiBwdWJsaWMgY3VycmVudEludGVydmFsOwoKICAvLyB0aGUgaW50ZXJ2YWwgYXQgd2hpY2ggYWxsb2NhdGlvbnMgd2lsbCBiZSByZXdhcmRlZAogIHVpbnQyNTYgcHVibGljIGludGVydmFsRHVyYXRpb247CgogIC8vIHRoZSBudW1iZXIgb2YgdG90YWwgcmV3YXJkIGludGVydmFscywgemVybyBpbmRleGVkCiAgdWludDI1NiBwdWJsaWMgbnVtSW50ZXJ2YWxzOwoKICBldmVudCBMb2NrKGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7CgogIGV2ZW50IFVubG9jayhhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF9hbW91bnQpOwoKICAvLyBjb25zdHJ1Y3RvcgogIC8vIEBwYXJhbSBfY3Jvd2RzYWxlRW5kRGF0ZSAtIHRoZSBkYXRlIHRoZSBjcm93ZHNhbGUgZW5kcwogIGZ1bmN0aW9uIEJSRExvY2t1cCh1aW50MjU2IF9jcm93ZHNhbGVFbmREYXRlLCB1aW50MjU2IF9udW1JbnRlcnZhbHMsIHVpbnQyNTYgX2ludGVydmFsRHVyYXRpb24pICBwdWJsaWMgewogICAgdW5sb2NrRGF0ZSA9IF9jcm93ZHNhbGVFbmREYXRlOwogICAgbnVtSW50ZXJ2YWxzID0gX251bUludGVydmFsczsKICAgIGludGVydmFsRHVyYXRpb24gPSBfaW50ZXJ2YWxEdXJhdGlvbjsKICAgIGN1cnJlbnRJbnRlcnZhbCA9IDA7CiAgfQoKICAvLyB1cGRhdGUgdGhlIGFsbG9jYXRpb24gc3RvcmFnZSByZW1haW5pbmcgYmFsYW5jZXMKICBmdW5jdGlvbiBwcm9jZXNzSW50ZXJ2YWwoKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wgX3Nob3VsZFByb2Nlc3NSZXdhcmRzKSB7CiAgICAvLyBlbnN1cmUgdGhlIHRpbWUgaW50ZXJ2YWwgaXMgY29ycmVjdAogICAgYm9vbCBfY29ycmVjdEludGVydmFsID0gbm93ID49IHVubG9ja0RhdGUgJiYgbm93LnN1Yih1bmxvY2tEYXRlKSA+IGN1cnJlbnRJbnRlcnZhbC5tdWwoaW50ZXJ2YWxEdXJhdGlvbik7CiAgICBib29sIF92YWxpZEludGVydmFsID0gY3VycmVudEludGVydmFsIDwgbnVtSW50ZXJ2YWxzOwogICAgaWYgKCFfY29ycmVjdEludGVydmFsIHx8ICFfdmFsaWRJbnRlcnZhbCkKICAgICAgcmV0dXJuIGZhbHNlOwoKICAgIC8vIGFkdmFuY2UgdGhlIGN1cnJlbnQgaW50ZXJ2YWwKICAgIGN1cnJlbnRJbnRlcnZhbCA9IGN1cnJlbnRJbnRlcnZhbC5hZGQoMSk7CgogICAgLy8gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgdG8gcmVhZCBhbGwgYWxsb2NhdGlvbnMKICAgIHVpbnQgX2FsbG9jYXRpb25zSW5kZXggPSBhbGxvY2F0aW9ucy5sZW5ndGg7CgogICAgLy8gbG9vcCB0aHJvdWdoIGV2ZXJ5IGFsbG9jYXRpb24KICAgIGZvciAodWludCBfaSA9IDA7IF9pIDwgX2FsbG9jYXRpb25zSW5kZXg7IF9pKyspIHsKICAgICAgLy8gdGhlIGN1cnJlbnQgcmV3YXJkIGZvciB0aGUgYWxsb2NhdGlvbiBhdCBpbmRleCBgaWAKICAgICAgdWludDI1NiBfYW1vdW50VG9SZXdhcmQ7CgogICAgICAvLyBpZiB3ZSBhcmUgYXQgdGhlIGxhc3QgaW50ZXJ2YWwsIHRoZSByZXdhcmQgYW1vdW50IGlzIHRoZSBlbnRpcmUgcmVtYWluaW5nIGJhbGFuY2UKICAgICAgaWYgKGN1cnJlbnRJbnRlcnZhbCA9PSBudW1JbnRlcnZhbHMpIHsKICAgICAgICBfYW1vdW50VG9SZXdhcmQgPSBhbGxvY2F0aW9uc1tfaV0ucmVtYWluaW5nQmFsYW5jZTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBvdGhlcndpc2UgdGhlIHJld2FyZCBhbW91bnQgaXMgdGhlIHRvdGFsIGFsbG9jYXRpb24gZGl2aWRlZCBieSB0aGUgbnVtYmVyIG9mIGludGVydmFscwogICAgICAgIF9hbW91bnRUb1Jld2FyZCA9IGFsbG9jYXRpb25zW19pXS5hbGxvY2F0aW9uLmRpdihudW1JbnRlcnZhbHMpOwogICAgICB9CiAgICAgIC8vIHVwZGF0ZSB0aGUgYWxsb2NhdGlvbiBzdG9yYWdlCiAgICAgIGFsbG9jYXRpb25zW19pXS5jdXJyZW50UmV3YXJkID0gX2Ftb3VudFRvUmV3YXJkOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8gdGhlIHRvdGFsIG51bWJlciBvZiBhbGxvY2F0aW9ucwogIGZ1bmN0aW9uIG51bUFsbG9jYXRpb25zKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBhbGxvY2F0aW9ucy5sZW5ndGg7CiAgfQoKICAvLyB0aGUgYW1vdW50IGFsbG9jYXRlZCBmb3IgYmVuZWZpY2lhcnkgYXQgYF9pbmRleGAKICBmdW5jdGlvbiBhbGxvY2F0aW9uQW1vdW50KHVpbnQgX2luZGV4KSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG9jYXRpb25zW19pbmRleF0uYWxsb2NhdGlvbjsKICB9CgogIC8vIHJld2FyZCB0aGUgYmVuZWZpY2lhcnkgYXQgYF9pbmRleGAKICBmdW5jdGlvbiB1bmxvY2sodWludCBfaW5kZXgpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCBfc2hvdWxkUmV3YXJkLCBhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfcmV3YXJkQW1vdW50KSB7CiAgICAvLyBlbnN1cmUgdGhlIGJlbmVmaWNpYXJ5IGlzIG5vdCByZXdhcmRlZCB0d2ljZSBkdXJpbmcgdGhlIHNhbWUgaW50ZXJ2YWwKICAgIGlmIChhbGxvY2F0aW9uc1tfaW5kZXhdLmN1cnJlbnRJbnRlcnZhbCA8IGN1cnJlbnRJbnRlcnZhbCkgewogICAgICAvLyByZWNvcmQgdGhlIGN1cnJlbnRJbnRlcnZhbCBzbyB0aGUgYWJvdmUgY2hlY2sgaXMgdXNlZnVsCiAgICAgIGFsbG9jYXRpb25zW19pbmRleF0uY3VycmVudEludGVydmFsID0gY3VycmVudEludGVydmFsOwogICAgICAvLyBzdWJ0cmFjdCB0aGUgcmV3YXJkIGZyb20gdGhlaXIgcmVtYWluaW5nIGJhbGFuY2UKICAgICAgYWxsb2NhdGlvbnNbX2luZGV4XS5yZW1haW5pbmdCYWxhbmNlID0gYWxsb2NhdGlvbnNbX2luZGV4XS5yZW1haW5pbmdCYWxhbmNlLnN1YihhbGxvY2F0aW9uc1tfaW5kZXhdLmN1cnJlbnRSZXdhcmQpOwogICAgICAvLyBlbWl0IGV2ZW50CiAgICAgIFVubG9jayhhbGxvY2F0aW9uc1tfaW5kZXhdLmJlbmVmaWNpYXJ5LCBhbGxvY2F0aW9uc1tfaW5kZXhdLmN1cnJlbnRSZXdhcmQpOwogICAgICAvLyByZXR1cm4gdmFsdWUKICAgICAgX3Nob3VsZFJld2FyZCA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICAvLyByZXR1cm4gdmFsdWUKICAgICAgX3Nob3VsZFJld2FyZCA9IGZhbHNlOwogICAgfQoKICAgIC8vIHJldHVybiB2YWx1ZXMKICAgIF9yZXdhcmRBbW91bnQgPSBhbGxvY2F0aW9uc1tfaW5kZXhdLmN1cnJlbnRSZXdhcmQ7CiAgICBfYmVuZWZpY2lhcnkgPSBhbGxvY2F0aW9uc1tfaW5kZXhdLmJlbmVmaWNpYXJ5OwogIH0KCiAgLy8gYWRkIGEgbmV3IGFsbG9jYXRpb24gdG8gdGhlIGxvY2t1cAogIGZ1bmN0aW9uIHB1c2hBbGxvY2F0aW9uKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9udW1Ub2tlbnMpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShub3cgPCB1bmxvY2tEYXRlKTsKICAgIGFsbG9jYXRpb25zLnB1c2goCiAgICAgIEFsbG9jYXRpb24oCiAgICAgICAgX2JlbmVmaWNpYXJ5LAogICAgICAgIF9udW1Ub2tlbnMsCiAgICAgICAgX251bVRva2VucywKICAgICAgICAwLAogICAgICAgIDAKICAgICAgKQogICAgKTsKICAgIExvY2soX2JlbmVmaWNpYXJ5LCBfbnVtVG9rZW5zKTsKICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy96ZXBwZWxpbi1zb2xpZGl0eS0xLjQvRVJDMjBCYXNpYy5zb2wKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy96ZXBwZWxpbi1zb2xpZGl0eS0xLjQvQmFzaWNUb2tlbi5zb2wKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLy8gRmlsZTogY29udHJhY3RzL3plcHBlbGluLXNvbGlkaXR5LTEuNC9FUkMyMC5zb2wKCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy96ZXBwZWxpbi1zb2xpZGl0eS0xLjQvU3RhbmRhcmRUb2tlbi5zb2wKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvemVwcGVsaW4tc29saWRpdHktMS40L01pbnRhYmxlVG9rZW4uc29sCgovKioKICogQHRpdGxlIE1pbnRhYmxlIHRva2VuCiAqIEBkZXYgU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggbWludGFibGUgdG9rZW4gY3JlYXRpb24KICogQGRldiBJc3N1ZTogKiBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5L2lzc3Vlcy8xMjAKICogQmFzZWQgb24gY29kZSBieSBUb2tlbk1hcmtldE5ldDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9jb250cmFjdHMvTWludGFibGVUb2tlbi5zb2wKICovCgpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgTWludChfdG8sIF9hbW91bnQpOwogICAgVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0JSRFRva2VuLnNvbAoKY29udHJhY3QgQlJEVG9rZW4gaXMgTWludGFibGVUb2tlbiB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJCcmVhZCBUb2tlbiI7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiQlJEIjsKICB1aW50MjU2IHB1YmxpYyBkZWNpbWFscyA9IDE4OwoKICAvLyBvdmVycmlkZSBTdGFuZGFyZFRva2VuI3RyYW5zZmVyRnJvbQogIC8vIGVuc3VyZXMgdGhhdCBtaW50aW5nIGhhcyBmaW5pc2hlZCBvciB0aGUgbWVzc2FnZSBzZW5kZXIgaXMgdGhlIHRva2VuIG93bmVyCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobWludGluZ0ZpbmlzaGVkIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgLy8gb3ZlcnJpZGUgU3RhbmRhcmRUb2tlbiN0cmFuc2ZlcgogIC8vIGVuc3VyZXMgdGhlIG1pbnRpbmcgaGFzIGZpbmlzaGVkIG9yIHRoZSBtZXNzYWdlIHNlbmRlciBpcyB0aGUgdG9rZW4gb3duZXIKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKG1pbnRpbmdGaW5pc2hlZCB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvemVwcGVsaW4tc29saWRpdHktMS40L0Nyb3dkc2FsZS5zb2wKCi8qKgogKiBAdGl0bGUgQ3Jvd2RzYWxlCiAqIEBkZXYgQ3Jvd2RzYWxlIGlzIGEgYmFzZSBjb250cmFjdCBmb3IgbWFuYWdpbmcgYSB0b2tlbiBjcm93ZHNhbGUuCiAqIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcywgd2hlcmUgaW52ZXN0b3JzIGNhbiBtYWtlCiAqIHRva2VuIHB1cmNoYXNlcyBhbmQgdGhlIGNyb3dkc2FsZSB3aWxsIGFzc2lnbiB0aGVtIHRva2VucyBiYXNlZAogKiBvbiBhIHRva2VuIHBlciBFVEggcmF0ZS4gRnVuZHMgY29sbGVjdGVkIGFyZSBmb3J3YXJkZWQgdG8gYSB3YWxsZXQKICogYXMgdGhleSBhcnJpdmUuCiAqLwpjb250cmFjdCBDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogIE1pbnRhYmxlVG9rZW4gcHVibGljIHRva2VuOwoKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogIC8vIGhvdyBtYW55IHRva2VuIHVuaXRzIGEgYnV5ZXIgZ2V0cyBwZXIgd2VpCiAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfcmF0ZSwgYWRkcmVzcyBfd2FsbGV0KSBwdWJsaWMgewogICAgcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICByZXF1aXJlKF9lbmRUaW1lID49IF9zdGFydFRpbWUpOwogICAgcmVxdWlyZShfcmF0ZSA+IDApOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOwogICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgIHJhdGUgPSBfcmF0ZTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgfQoKICAvLyBjcmVhdGVzIHRoZSB0b2tlbiB0byBiZSBzb2xkLgogIC8vIG92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGhhdmUgY3Jvd2RzYWxlIG9mIGEgc3BlY2lmaWMgbWludGFibGUgdG9rZW4uCiAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIGludGVybmFsIHJldHVybnMgKE1pbnRhYmxlVG9rZW4pIHsKICAgIHJldHVybiBuZXcgTWludGFibGVUb2tlbigpOwogIH0KCgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICB9CgogIC8vIGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZSh2YWxpZFB1cmNoYXNlKCkpOwoKICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgdWludDI1NiB0b2tlbnMgPSB3ZWlBbW91bnQubXVsKHJhdGUpOwoKICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwoKICAgIHRva2VuLm1pbnQoYmVuZWZpY2lhcnksIHRva2Vucyk7CiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CgogICAgZm9yd2FyZEZ1bmRzKCk7CiAgfQoKICAvLyBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgLy8gb3ZlcnJpZGUgdG8gY3JlYXRlIGN1c3RvbSBmdW5kIGZvcndhcmRpbmcgbWVjaGFuaXNtcwogIGZ1bmN0aW9uIGZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgIHdhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOwogIH0KCiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbm93ID4gZW5kVGltZTsKICB9CgoKfQoKLy8gRmlsZTogY29udHJhY3RzL3plcHBlbGluLXNvbGlkaXR5LTEuNC9GaW5hbGl6YWJsZUNyb3dkc2FsZS5zb2wKCi8qKgogKiBAdGl0bGUgRmluYWxpemFibGVDcm93ZHNhbGUKICogQGRldiBFeHRlbnNpb24gb2YgQ3Jvd2RzYWxlIHdoZXJlIGFuIG93bmVyIGNhbiBkbyBleHRyYSB3b3JrCiAqIGFmdGVyIGZpbmlzaGluZy4KICovCmNvbnRyYWN0IEZpbmFsaXphYmxlQ3Jvd2RzYWxlIGlzIENyb3dkc2FsZSwgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CgogIGV2ZW50IEZpbmFsaXplZCgpOwoKICAvKioKICAgKiBAZGV2IE11c3QgYmUgY2FsbGVkIGFmdGVyIGNyb3dkc2FsZSBlbmRzLCB0byBkbyBzb21lIGV4dHJhIGZpbmFsaXphdGlvbgogICAqIHdvcmsuIENhbGxzIHRoZSBjb250cmFjdCdzIGZpbmFsaXphdGlvbiBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwogICAgcmVxdWlyZShoYXNFbmRlZCgpKTsKCiAgICBmaW5hbGl6YXRpb24oKTsKICAgIEZpbmFsaXplZCgpOwoKICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FuIGJlIG92ZXJyaWRkZW4gdG8gYWRkIGZpbmFsaXphdGlvbiBsb2dpYy4gVGhlIG92ZXJyaWRpbmcgZnVuY3Rpb24KICAgKiBzaG91bGQgY2FsbCBzdXBlci5maW5hbGl6YXRpb24oKSB0byBlbnN1cmUgdGhlIGNoYWluIG9mIGZpbmFsaXphdGlvbiBpcwogICAqIGV4ZWN1dGVkIGVudGlyZWx5LgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXphdGlvbigpIGludGVybmFsIHsKICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9CUkRDcm93ZHNhbGUuc29sCgpjb250cmFjdCBCUkRDcm93ZHNhbGUgaXMgRmluYWxpemFibGVDcm93ZHNhbGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBtYXhpbXVtIGFtb3VudCBvZiB3ZWkgcmFpc2VkIGR1cmluZyB0aGlzIGNyb3dkc2FsZQogIHVpbnQyNTYgcHVibGljIGNhcDsKCiAgLy8gbWluaW11bSBwZXItcGFydGljaXBhbnQgd2VpIGNvbnRyaWJ1dGlvbgogIHVpbnQyNTYgcHVibGljIG1pbkNvbnRyaWJ1dGlvbjsKCiAgLy8gbWF4aW11bSBwZXItcGFydGljaXBhbnQgd2VpIGNvbnRyaWJ1dGlvbgogIHVpbnQyNTYgcHVibGljIG1heENvbnRyaWJ1dGlvbjsKCiAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdGVzIHRoZSBvd25lciBnZXRzIHBlciBidXllciB3ZWkKICB1aW50MjU2IHB1YmxpYyBvd25lclJhdGU7CgogIC8vIG51bWJlciBvZiB0b2tlbnMgcGVyIDEwMCB0byBsb2NrIHVwIGluIGxvY2t1cFRva2VucygpCiAgdWludDI1NiBwdWJsaWMgYm9udXNSYXRlOwoKICAvLyB0aGUgYWRkcmVzcyB0byB3aGljaCB0aGUgb3duZXIgc2hhcmUgb2YgdG9rZW5zIGFyZSBzZW50CiAgYWRkcmVzcyBwdWJsaWMgdG9rZW5XYWxsZXQ7CgogIC8vIGNyb3dkc2FsZSBhdXRob3JpemVyIGNvbnRyYWN0IGRldGVybWluZXMgd2hvIGNhbiBwYXJ0aWNpcGF0ZQogIEJSRENyb3dkc2FsZUF1dGhvcml6ZXIgcHVibGljIGF1dGhvcml6ZXI7CgogIC8vIHRoZSBsb2NrdXAgY29udHJhY3QgaG9sZHMgcHJlc2FsZSBhdXRob3JpemF0aW9uIGFtb3VudHMKICBCUkRMb2NrdXAgcHVibGljIGxvY2t1cDsKCiAgLy8gY29uc3RydWN0b3IKICBmdW5jdGlvbiBCUkRDcm93ZHNhbGUoCiAgICB1aW50MjU2IF9jYXAsICAgICAgICAgLy8gbWF4aW11bSB3ZWkgcmFpc2VkCiAgICB1aW50MjU2IF9taW5XZWksICAgICAgLy8gbWluaW11bSBwZXItY29udHJpYnV0b3Igd2VpCiAgICB1aW50MjU2IF9tYXhXZWksICAgICAgLy8gbWF4aW11bSBwZXItY29udHJpYnV0b3Igd2VpCiAgICB1aW50MjU2IF9zdGFydFRpbWUsICAgLy8gY3Jvd2RzYWxlIHN0YXJ0IHRpbWUKICAgIHVpbnQyNTYgX2VuZFRpbWUsICAgICAvLyBjcm93ZHNhbGUgZW5kIHRpbWUKICAgIHVpbnQyNTYgX3JhdGUsICAgICAgICAvLyB0b2tlbnMgcGVyIHdlaQogICAgdWludDI1NiBfb3duZXJSYXRlLCAgIC8vIG93bmVyIHRva2VucyBwZXIgYnV5ZXIgd2VpCiAgICB1aW50MjU2IF9ib251c1JhdGUsICAgLy8gcGVyY2VudGFnZSBvZiB0b2tlbnMgdG8gbG9ja3VwCiAgICBhZGRyZXNzIF93YWxsZXQsICAgICAgLy8gdGFyZ2V0IGV0aCB3YWxsZXQKICAgIGFkZHJlc3MgX3Rva2VuV2FsbGV0KSAvLyB0YXJnZXQgdG9rZW4gd2FsbGV0CiAgICBDcm93ZHNhbGUoX3N0YXJ0VGltZSwgX2VuZFRpbWUsIF9yYXRlLCBfd2FsbGV0KQogICBwdWJsaWMKICB7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIHJlcXVpcmUoX3Rva2VuV2FsbGV0ICE9IDB4MCk7CiAgICBjYXAgPSBfY2FwOwogICAgbWluQ29udHJpYnV0aW9uID0gX21pbldlaTsKICAgIG1heENvbnRyaWJ1dGlvbiA9IF9tYXhXZWk7CiAgICBvd25lclJhdGUgPSBfb3duZXJSYXRlOwogICAgYm9udXNSYXRlID0gX2JvbnVzUmF0ZTsKICAgIHRva2VuV2FsbGV0ID0gX3Rva2VuV2FsbGV0OwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjaGFzRW5kZWQgdG8gYWRkIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBfY2FwUmVhY2hlZCA9IHdlaVJhaXNlZCA+PSBjYXA7CiAgICByZXR1cm4gc3VwZXIuaGFzRW5kZWQoKSB8fCBfY2FwUmVhY2hlZDsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBzdGFydGVkCiAgZnVuY3Rpb24gaGFzU3RhcnRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gbm93ID4gc3RhcnRUaW1lOwogIH0KCiAgLy8gb3ZlcnJpZGluZyBDcm93ZHNhbGUjYnV5VG9rZW5zCiAgLy8gbWludHMgdGhlIG93bmVyUmF0ZSBvZiB0b2tlbnMgaW4gYWRkaXRpb24gdG8gY2FsbGluZyB0aGUgc3VwZXIgbWV0aG9kCiAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICAvLyBjYWxsIHRoZSBwYXJlbnQgbWV0aG9kIHRvIG1pbnQgdG9rZW5zIHRvIHRoZSBiZW5lZmljaWFyeQogICAgc3VwZXIuYnV5VG9rZW5zKF9iZW5lZmljaWFyeSk7CiAgICAvLyBjYWxjdWxhdGUgdGhlIG93bmVyIHNoYXJlIG9mIHRva2VucwogICAgdWludDI1NiBfb3duZXJUb2tlbnMgPSBtc2cudmFsdWUubXVsKG93bmVyUmF0ZSk7CiAgICAvLyBtaW50IHRoZSBvd25lciBzaGFyZSBhbmQgc2VuZCB0byB0aGUgb3duZXIgdG9rZSB3YWxsZXQKICAgIHRva2VuLm1pbnQodG9rZW5XYWxsZXQsIF9vd25lclRva2Vucyk7CiAgfQoKICAvLyBpbW1lZGlhdGVseSBtaW50IF9hbW91bnQgdG9rZW5zIHRvIHRoZSBfYmVuZWZpY2lhcnkuIHRoaXMgaXMgdXNlZCBmb3IgT09CIHRva2VuIHB1cmNoYXNlcy4gCiAgZnVuY3Rpb24gYWxsb2NhdGVUb2tlbnMoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CgogICAgLy8gdXBkYXRlIHN0YXRlCiAgICB1aW50MjU2IF93ZWlBbW91bnQgPSBfYW1vdW50LmRpdihyYXRlKTsKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQoX3dlaUFtb3VudCk7CgogICAgLy8gbWludCB0aGUgdG9rZW5zIHRvIHRoZSBiZW5lZmljaWFyeQogICAgdG9rZW4ubWludChfYmVuZWZpY2lhcnksIF9hbW91bnQpOwoKICAgIC8vIG1pbnQgdGhlIG93bmVyIHNoYXJlIHRva2VucyAKICAgIHVpbnQyNTYgX293bmVyVG9rZW5zID0gX3dlaUFtb3VudC5tdWwob3duZXJSYXRlKTsKICAgIHRva2VuLm1pbnQodG9rZW5XYWxsZXQsIF9vd25lclRva2Vucyk7CiAgICAKICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgX2JlbmVmaWNpYXJ5LCBfd2VpQW1vdW50LCBfYW1vdW50KTsKICB9CgogIC8vIG1pbnRzIF9hbW91bnQgdG9rZW5zIHRvIHRoZSBfYmVuZWZpY2lhcnkgbWludXMgdGhlIGJvbnVzUmF0ZQogIC8vIHRva2VucyB0byBiZSBsb2NrZWQgdXAgdmlhIHRoZSBsb2NrdXAgY29udHJhY3QuIGxvY2tlZCB1cCB0b2tlbnMKICAvLyBhcmUgc2VudCB0byB0aGUgY29udHJhY3QgYW5kIG1heSBiZSB1bmxvY2tlZCBhY2NvcmRpbmcgdG8KICAvLyB0aGUgbG9ja3VwIGNvbmZpZ3VyYXRpb24gYWZ0ZXIgdGhlIHNhbGUgZW5kcwogIGZ1bmN0aW9uIGxvY2t1cFRva2VucyhhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoIWlzRmluYWxpemVkKTsKCiAgICAvLyBjYWxjdWxhdGUgdGhlIG93bmVyIHNoYXJlIG9mIHRva2VucwogICAgdWludDI1NiBfb3duZXJUb2tlbnMgPSBvd25lclJhdGUubXVsKF9hbW91bnQpLmRpdihyYXRlKTsKICAgIC8vIG1pbnQgdGhlIG93bmVyIHNoYXJlIGFuZCBzZW5kIHRvIHRoZSBvd25lciB3YWxsZXQKICAgIHRva2VuLm1pbnQodG9rZW5XYWxsZXQsIF9vd25lclRva2Vucyk7CgogICAgLy8gY2FsY3VsYXRlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGxvY2tlZCB1cAogICAgdWludDI1NiBfbG9ja3VwVG9rZW5zID0gYm9udXNSYXRlLm11bChfYW1vdW50KS5kaXYoMTAwKTsKICAgIC8vIGNyZWF0ZSB0aGUgbG9ja2VkIGFsbG9jYXRpb24gaW4gdGhlIGxvY2t1cCBjb250cmFjdAogICAgbG9ja3VwLnB1c2hBbGxvY2F0aW9uKF9iZW5lZmljaWFyeSwgX2xvY2t1cFRva2Vucyk7CiAgICAvLyBtaW50IGxvY2tlZCB0b2tlbnMgdG8gdGhlIGNyb3dkc2FsZSBjb250cmFjdCB0byBsYXRlciBiZSB1bmxvY2tlZAogICAgdG9rZW4ubWludCh0aGlzLCBfbG9ja3VwVG9rZW5zKTsKCiAgICAvLyB0aGUgbm9uLWJvbnVzIHRva2VucyBhcmUgaW1tZWRpYXRlbHkgcmV3YXJkZWQKICAgIHVpbnQyNTYgX3JlbWFpbmRlciA9IF9hbW91bnQuc3ViKF9sb2NrdXBUb2tlbnMpOwogICAgdG9rZW4ubWludChfYmVuZWZpY2lhcnksIF9yZW1haW5kZXIpOwogIH0KCiAgLy8gdW5sb2NrcyB0b2tlbnMgZnJvbSB0aGUgdG9rZW4gbG9ja3VwIGNvbnRyYWN0LiBubyB0b2tlbnMgYXJlIGhlbGQgYnkKICAvLyB0aGUgbG9ja3VwIGNvbnRyYWN0LCBqdXN0IHRoZSBhbW91bnRzIGFuZCB0aW1lcyB0aGF0IHRva2VucyBzaG91bGQgYmUgcmV3YXJkZWQuCiAgLy8gdGhlIHRva2VucyBhcmUgaGVsZCBieSB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0CiAgZnVuY3Rpb24gdW5sb2NrVG9rZW5zKCkgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sIF9kaWRJc3N1ZVJld2FyZHMpIHsKICAgIC8vIGF0dGVtcHQgdG8gcHJvY2VzcyB0aGUgaW50ZXJ2YWwuIGl0IHVwZGF0ZSB0aGUgYWxsb2NhdGlvbiBib29ra2VlcGluZwogICAgLy8gYW5kIHdpbGwgb25seSByZXR1cm4gdHJ1ZSB3aGVuIHRoZSBpbnRlcnZhbCBzaG91bGQgYmUgcHJvY2Vzc2VkCiAgICBpZiAoIWxvY2t1cC5wcm9jZXNzSW50ZXJ2YWwoKSkKICAgICAgcmV0dXJuIGZhbHNlOwoKICAgIC8vIHRoZSB0b3RhbCBudW1iZXIgb2YgYWxsb2NhdGlvbnMKICAgIHVpbnQgX251bUFsbG9jYXRpb25zID0gbG9ja3VwLm51bUFsbG9jYXRpb25zKCk7CgogICAgLy8gZm9yIGV2ZXJ5IGFsbG9jYXRpb24sIGF0dGVtcHQgdG8gdW5sb2NrIHRoZSByZXdhcmQKICAgIGZvciAodWludCBfaSA9IDA7IF9pIDwgX251bUFsbG9jYXRpb25zOyBfaSsrKSB7CiAgICAgIC8vIGF0dGVtcHQgdG8gdW5sb2NrIHRoZSByZXdhcmQKICAgICAgdmFyIChfc2hvdWxkUmV3YXJkLCBfdG8sIF9hbW91bnQpID0gbG9ja3VwLnVubG9jayhfaSk7CiAgICAgIC8vIGlmIHRoZSBiZW5lZmljaWFyeSBzaG91bGQgYmUgcmV3YXJkZWQsIHNlbmQgdGhlbSB0b2tlbnMKICAgICAgaWYgKF9zaG91bGRSZXdhcmQpIHsKICAgICAgICB0b2tlbi50cmFuc2ZlcihfdG8sIF9hbW91bnQpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLyBzZXRzIHRoZSBhdXRob3JpemVyIGNvbnRyYWN0IGlmIHRoZSBjcm93ZHNhbGUgaGFzbid0IHN0YXJ0ZWQKICBmdW5jdGlvbiBzZXRBdXRob3JpemVyKEJSRENyb3dkc2FsZUF1dGhvcml6ZXIgX2F1dGhvcml6ZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZSghaGFzU3RhcnRlZCgpKTsKICAgIGF1dGhvcml6ZXIgPSBfYXV0aG9yaXplcjsKICB9CgogIC8vIHNldHMgdGhlIGxvY2t1cCBjb250cmFjdCBpZiB0aGUgY3Jvd2RzYWxlIGhhc24ndCBzdGFydGVkCiAgZnVuY3Rpb24gc2V0TG9ja3VwKEJSRExvY2t1cCBfbG9ja3VwKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoIWhhc1N0YXJ0ZWQoKSk7CiAgICBsb2NrdXAgPSBfbG9ja3VwOwogIH0KCiAgLy8gc2V0cyB0aGUgdG9rZW4gY29udHJhY3QgaWYgdGhlIGNyb3dkc2FsZSBoYXNuJ3Qgc3RhcnRlZAogIGZ1bmN0aW9uIHNldFRva2VuKEJSRFRva2VuIF90b2tlbikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKCFoYXNTdGFydGVkKCkpOwogICAgdG9rZW4gPSBfdG9rZW47CiAgfQoKICAvLyBzZXQgdGhlIGNhcCBvbiB0aGUgY29udHJhY3QgaWYgdGhlIGNyb3dkc2FsZSBoYXNuJ3Qgc3RhcnRlZAogIGZ1bmN0aW9uIHNldENhcCh1aW50MjU2IF9uZXdDYXApIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShfbmV3Q2FwID4gMCk7CiAgICByZXF1aXJlKCFoYXNTdGFydGVkKCkpOwogICAgY2FwID0gX25ld0NhcDsKICB9CgogIC8vIGFsbG93cyBtYXhDb250cmlidXRpb24gdG8gYmUgbW9kaWZpZWQKICBmdW5jdGlvbiBzZXRNYXhDb250cmlidXRpb24odWludDI1NiBfbmV3TWF4Q29udHJpYnV0aW9uKSBvbmx5T3duZXIgcHVibGljIHsKICAgIG1heENvbnRyaWJ1dGlvbiA9IF9uZXdNYXhDb250cmlidXRpb247CiAgfQoKICAvLyBhbGxvd3MgZW5kVGltZSB0byBiZSBtb2RpZmllZAogIGZ1bmN0aW9uIHNldEVuZFRpbWUodWludDI1NiBfbmV3RW5kVGltZSkgb25seU93bmVyIHB1YmxpYyB7CiAgICBlbmRUaW1lID0gX25ld0VuZFRpbWU7CiAgfQoKICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSNjcmVhdGVUb2tlbkNvbnRyYWN0CiAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIGludGVybmFsIHJldHVybnMgKE1pbnRhYmxlVG9rZW4pIHsKICAgIC8vIHNldCB0aGUgdG9rZW4gdG8gbnVsbCBpbml0aWFsbHkKICAgIC8vIGNhbGwgc2V0VG9rZW4oKSBhYm92ZSB0byBzZXQgdGhlIGFjdHVhbCB0b2tlbiBhZGRyZXNzCiAgICByZXR1cm4gQlJEVG9rZW4oYWRkcmVzcygwKSk7CiAgfQoKICAvLyBvdmVycmlkaW5nIEZpbmFsaXphYmxlQ3Jvd2RzYWxlI2ZpbmFsaXphdGlvbgogIC8vIGZpbmFsaXplcyBtaW50aW5nIGZvciB0aGUgdG9rZW4gY29udHJhY3QsIGRpc2FibGluZyBmdXJ0aGVyIG1pbnRpbmcKICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgICAvLyBlbmQgbWludGluZwogICAgdG9rZW4uZmluaXNoTWludGluZygpOwoKICAgIC8vIGlzc3VlIHRoZSBmaXJzdCBsb2NrdXAgcmV3YXJkCiAgICB1bmxvY2tUb2tlbnMoKTsKCiAgICBzdXBlci5maW5hbGl6YXRpb24oKTsKICB9CgogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI3ZhbGlkUHVyY2hhc2UgdG8gYWRkIGV4dHJhIGNhcCBsb2dpYwogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgcGFydGljaXBhbnRzIGNhbiBidXkgYXQgdGhlIG1vbWVudAogIC8vIGNoZWNrcyB3aGV0aGVyIHRoZSBjYXAgaGFzIG5vdCBiZWVuIHJlYWNoZWQsIHRoZSBwdXJjaGFzZXIgaGFzCiAgLy8gYmVlbiBhdXRob3JpemVkLCBhbmQgdGhlaXIgY29udHJpYnV0aW9uIGlzIHdpdGhpbiB0aGUgbWluL21heAogIC8vIHRocmVzaG9sZHMKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCBfd2l0aGluQ2FwID0gd2VpUmFpc2VkLmFkZChtc2cudmFsdWUpIDw9IGNhcDsKICAgIGJvb2wgX2lzQXV0aG9yaXplZCA9IGF1dGhvcml6ZXIuaXNBdXRob3JpemVkKG1zZy5zZW5kZXIpOwogICAgYm9vbCBfaXNNaW4gPSBtc2cudmFsdWUgPj0gbWluQ29udHJpYnV0aW9uOwogICAgdWludDI1NiBfYWxyZWFkeUNvbnRyaWJ1dGVkID0gdG9rZW4uYmFsYW5jZU9mKG1zZy5zZW5kZXIpLmRpdihyYXRlKTsKICAgIGJvb2wgX3dpdGhpbk1heCA9IG1zZy52YWx1ZS5hZGQoX2FscmVhZHlDb250cmlidXRlZCkgPD0gbWF4Q29udHJpYnV0aW9uOwogICAgcmV0dXJuIHN1cGVyLnZhbGlkUHVyY2hhc2UoKSAmJiBfd2l0aGluQ2FwICYmIF9pc0F1dGhvcml6ZWQgJiYgX2lzTWluICYmIF93aXRoaW5NYXg7CiAgfQp9'.
	

]
