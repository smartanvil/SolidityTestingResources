Class {
	#name : #SRTd556caf704e39fc728058557a113b226207d2212,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd556caf704e39fc728058557a113b226207d2212 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgogKi8KCi8vIEFic3RyYWN0IGNvbnRyYWN0IGZvciB0aGUgZnVsbCBFUkMgMjAgVG9rZW4gc3RhbmRhcmQKLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCgpjb250cmFjdCBFUkMyMFRva2VuIHsKICAgIC8qIFRoaXMgaXMgYSBzbGlnaHQgY2hhbmdlIHRvIHRoZSBFUkMyMCBiYXNlIHN0YW5kYXJkLgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBpcyByZXBsYWNlZCB3aXRoOgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBUaGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlcyBhIGdldHRlciBmdW5jdGlvbiBmb3IgdGhlIHRvdGFsU3VwcGx5LgogICAgVGhpcyBpcyBtb3ZlZCB0byB0aGUgYmFzZSBjb250cmFjdCBzaW5jZSBwdWJsaWMgZ2V0dGVyIGZ1bmN0aW9ucyBhcmUgbm90CiAgICBjdXJyZW50bHkgcmVjb2duaXNlZCBhcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbWF0Y2hpbmcgYWJzdHJhY3QKICAgIGZ1bmN0aW9uIGJ5IHRoZSBjb21waWxlci4KICAgICovCiAgICAvLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgoKCi8vLyBAdGl0bGUgTWluaU1lVG9rZW4gQ29udHJhY3QKLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQovLy8gQGRldiBUaGlzIHRva2VuIGNvbnRyYWN0J3MgZ29hbCBpcyB0byBtYWtlIGl0IGVhc3kgZm9yIGFueW9uZSB0byBjbG9uZSB0aGlzCi8vLyAgdG9rZW4gdXNpbmcgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBhdCBhIGdpdmVuIGJsb2NrLCB0aGlzIHdpbGwgYWxsb3cgREFPJ3MKLy8vICBhbmQgREFwcHMgdG8gdXBncmFkZSB0aGVpciBmZWF0dXJlcyBpbiBhIGRlY2VudHJhbGl6ZWQgbWFubmVyIHdpdGhvdXQKLy8vICBhZmZlY3RpbmcgdGhlIG9yaWdpbmFsIHRva2VuCi8vLyBAZGV2IEl0IGlzIEVSQzIwIGNvbXBsaWFudCwgYnV0IHN0aWxsIG5lZWRzIHRvIHVuZGVyIGdvIGZ1cnRoZXIgdGVzdGluZy4KCgovLy8gQGRldiBUaGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCBtdXN0IGltcGxlbWVudCB0aGVzZSBmdW5jdGlvbnMKY29udHJhY3QgVG9rZW5Db250cm9sbGVyIHsKICAgIC8vLyBAbm90aWNlIENhbGxlZCB3aGVuIGBfb3duZXJgIHNlbmRzIGV0aGVyIHRvIHRoZSBNaW5pTWUgVG9rZW4gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgdG8gY3JlYXRlIHRva2VucwogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cwogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0b2tlbiB0cmFuc2ZlciBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBzcGVuZGVyIGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpCiAgICAgICAgcmV0dXJucyhib29sKTsKfQoKY29udHJhY3QgQ29udHJvbGxlZCB7CiAgICAvLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJvbGxlciBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwKICAgIC8vLyAgYSBmdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9CgovLy8gQGRldiBUaGUgYWN0dWFsIHRva2VuIGNvbnRyYWN0LCB0aGUgZGVmYXVsdCBjb250cm9sbGVyIGlzIHRoZSBtc2cuc2VuZGVyCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQovLy8gIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QsIHdoaWNoIEdpdmV0aCB3aWxsIGNhbGwgYSAiQ2FtcGFpZ24iCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIENvbnRyb2xsZWQgewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2VucwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAvL051bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnTU1UXzAuMSc7IC8vQW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lCgoKICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQogICAgLy8vICBnaXZlbiB2YWx1ZSwgdGhlIGJsb2NrIG51bWJlciBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0ICBDaGVja3BvaW50IHsKCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20KICAgICAgICB1aW50MTI4IGZyb21CbG9jazsKCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcgogICAgICAgIHVpbnQxMjggdmFsdWU7CiAgICB9CgogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOwogICAgLy8gIGl0IHdpbGwgYmUgMHgwIGZvciBhIHRva2VuIHRoYXQgd2FzIG5vdCBjbG9uZWQKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsKCiAgICAvLyBgcGFyZW50U25hcFNob3RCbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciBmcm9tIHRoZSBQYXJlbnQgVG9rZW4gdGhhdCB3YXMKICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuCiAgICB1aW50IHB1YmxpYyBwYXJlbnRTbmFwU2hvdEJsb2NrOwoKICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMKICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UKICAgIC8vICBvY2N1cnJlZCBpcyBhbHNvIGluY2x1ZGVkIGluIHRoZSBtYXAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsKCiAgICAvLyBgYWxsb3dlZGAgdHJhY2tzIGFueSBleHRyYSB0cmFuc2ZlciByaWdodHMgYXMgaW4gYWxsIEVSQzIwIHRva2VucwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIFRyYWNrcyB0aGUgaGlzdG9yeSBvZiB0aGUgYHRvdGFsU3VwcGx5YCBvZiB0aGUgdG9rZW4KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7CgogICAgLy8gRmxhZyB0aGF0IGRldGVybWluZXMgaWYgdGhlIHRva2VuIGlzIHRyYW5zZmVyYWJsZSBvciBub3QuCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOwoKICAgIC8vIFRoZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIG5ldyBjbG9uZSB0b2tlbnMKICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5OwoKLy8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQKICAgIC8vLyAgd2lsbCBjcmVhdGUgdGhlIENsb25lIHRva2VuIGNvbnRyYWN0cywgdGhlIHRva2VuIGZhY3RvcnkgbmVlZHMgdG8gYmUKICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QKICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhCiAgICAvLy8gIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQKICAgIC8vLyAgaXMgYSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sCiAgICAgICAgcGFyZW50VG9rZW4gPSBNaW5pTWVUb2tlbihfcGFyZW50VG9rZW4pOwogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEVSQzIwIE1ldGhvZHMKLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUKICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7CiAgICAgICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7CgogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuCiAgICAvLy8gIG9ubHkgYmUgY2FsbGVkIGJ5IG90aGVyIGZ1bmN0aW9ucyBpbiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CgogICAgICAgICAgIGlmIChwYXJlbnRTbmFwU2hvdEJsb2NrID49IGJsb2NrLm51bWJlcikgdGhyb3c7CgogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZgogICAgICAgICAgIGlmICgoX3RvID09IDApIHx8IChfdG8gPT0gYWRkcmVzcyh0aGlzKSkpIHRocm93OwoKICAgICAgICAgICAvLyBJZiB0aGUgYW1vdW50IGJlaW5nIHRyYW5zZmVyZWQgaXMgbW9yZSB0aGFuIHRoZSBiYWxhbmNlIG9mIHRoZQogICAgICAgICAgIC8vICBhY2NvdW50IHRoZSB0cmFuc2ZlciByZXR1cm5zIGZhbHNlCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2ZBdChfZnJvbSwgYmxvY2subnVtYmVyKTsKICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsKICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgIH0KCiAgICAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSB0cmFuc2ZlcgogICAgICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCkpCiAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgIH0KCiAgICAgICAgICAgLy8gRmlyc3QgdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgc2VuZGluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfZnJvbV0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKCiAgICAgICAgICAgLy8gVGhlbiB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2VucwogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZkF0KF90bywgYmxvY2subnVtYmVyKTsKICAgICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50IDwgcHJldmlvdXNCYWxhbmNlVG8pIHRocm93OyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CgogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwoKICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIGlmICgoX2Ftb3VudCE9MCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9MCkpIHRocm93OwoKICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIGFwcHJvdmUgZnVuY3Rpb24gY2FsbAogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpCiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcwogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bwogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKCFhcHByb3ZlKF9zcGVuZGVyLCBfYW1vdW50KSkgdGhyb3c7CgogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIGJhbGFuY2Ugb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4uYmFsYW5jZU9mQXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoYXQgdG9rZW4gYXMgdGhpcyBjb250YWlucyBpbml0aWFsIGJhbGFuY2Ugb2YKICAgICAgICAvLyAgdGhpcyB0b2tlbgogICAgICAgIGlmICgoYmFsYW5jZXNbX293bmVyXS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKGJhbGFuY2VzW19vd25lcl1bMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLmJhbGFuY2VPZkF0KF9vd25lciwgbWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudAogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgYmFsYW5jZSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAuCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIHRvdGFsU3VwcGx5IGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMKICAgICAgICAvLyAgdG9rZW4gYXQgdGhpcyBibG9jayBudW1iZXIuCiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXQobWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgdG90YWxTdXBwbHkgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ2xvbmUgVG9rZW4gTWV0aG9kCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47CiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZAogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgTWluaU1lVG9rZW4gQ29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICkgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBibG9jay5udW1iZXIpOwogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSArIF9hbW91bnQgPCBjdXJUb3RhbFN1cHBseSkgdGhyb3c7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPCBwcmV2aW91c0JhbGFuY2VUbykgdGhyb3c7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGJ1cm4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7CiAgICAgICAgaWYgKGN1clRvdGFsU3VwcGx5IDwgX2Ftb3VudCkgdGhyb3c7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5IC0gX2Ftb3VudCk7CiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHRocm93OwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKF9vd25lciwgMCwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEVuYWJsZSB0b2tlbnMgdHJhbnNmZXJzCi8vLy8vLy8vLy8vLy8vLy8KCgogICAgLy8vIEBub3RpY2UgRW5hYmxlcyB0b2tlbiBob2xkZXJzIHRvIHRyYW5zZmVyIHRoZWlyIHRva2VucyBmcmVlbHkgaWYgdHJ1ZQogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycyhib29sIF90cmFuc2ZlcnNFbmFibGVkKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBJbnRlcm5hbCBoZWxwZXIgZnVuY3Rpb25zIHRvIHF1ZXJ5IGFuZCBzZXQgYSB2YWx1ZSBpbiBhIHNuYXBzaG90IGFycmF5Ci8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBgZ2V0VmFsdWVBdGAgcmV0cmlldmVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIGF0IGEgZ2l2ZW4gYmxvY2sgbnVtYmVyCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIHZhbHVlcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHBhcmFtIF9ibG9jayBUaGUgYmxvY2sgbnVtYmVyIHRvIHJldHJpZXZlIHRoZSB2YWx1ZSBhdAogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiB0b2tlbnMgYmVpbmcgcXVlcmllZAogICAgZnVuY3Rpb24gZ2V0VmFsdWVBdChDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfYmxvY2sKICAgICkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGlmIChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkgcmV0dXJuIDA7CgogICAgICAgIC8vIFNob3J0Y3V0IGZvciB0aGUgYWN0dWFsIHZhbHVlCiAgICAgICAgaWYgKF9ibG9jayA+PSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0uZnJvbUJsb2NrKQogICAgICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLnZhbHVlOwogICAgICAgIGlmIChfYmxvY2sgPCBjaGVja3BvaW50c1swXS5mcm9tQmxvY2spIHJldHVybiAwOwoKICAgICAgICAvLyBCaW5hcnkgc2VhcmNoIG9mIHRoZSB2YWx1ZSBpbiB0aGUgYXJyYXkKICAgICAgICB1aW50IG1pbiA9IDA7CiAgICAgICAgdWludCBtYXggPSBjaGVja3BvaW50cy5sZW5ndGgtMTsKICAgICAgICB3aGlsZSAobWF4ID4gbWluKSB7CiAgICAgICAgICAgIHVpbnQgbWlkID0gKG1heCArIG1pbiArIDEpLyAyOwogICAgICAgICAgICBpZiAoY2hlY2twb2ludHNbbWlkXS5mcm9tQmxvY2s8PV9ibG9jaykgewogICAgICAgICAgICAgICAgbWluID0gbWlkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWF4ID0gbWlkLTE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7CiAgICB9CgogICAgLy8vIEBkZXYgYHVwZGF0ZVZhbHVlQXROb3dgIHVzZWQgdG8gdXBkYXRlIHRoZSBgYmFsYW5jZXNgIG1hcCBhbmQgdGhlCiAgICAvLy8gIGB0b3RhbFN1cHBseUhpc3RvcnlgCiAgICAvLy8gQHBhcmFtIGNoZWNrcG9pbnRzIFRoZSBoaXN0b3J5IG9mIGRhdGEgYmVpbmcgdXBkYXRlZAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIG5ldyBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB1cGRhdGVWYWx1ZUF0Tm93KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF92YWx1ZQogICAgKSBpbnRlcm5hbCAgewogICAgICAgIGlmICgoY2hlY2twb2ludHMubGVuZ3RoID09IDApCiAgICAgICAgfHwgKGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtMV0uZnJvbUJsb2NrIDwgYmxvY2subnVtYmVyKSkgewogICAgICAgICAgICAgICBDaGVja3BvaW50IG5ld0NoZWNrUG9pbnQgPSBjaGVja3BvaW50c1sgY2hlY2twb2ludHMubGVuZ3RoKysgXTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC5mcm9tQmxvY2sgPSAgdWludDEyOChibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uOiBJZiB0aGUgY29udHJhY3QncyBjb250cm9sbGVyIGhhcyBub3QgYmVlbgogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlCiAgICAvLy8gIGV0aGVyIGFuZCBjcmVhdGVzIHRva2VucyBhcyBkZXNjcmliZWQgaW4gdGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QKICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICBpZiAoISBUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpCiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgY29udHJvbGxlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBFdmVudHMKLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQgX2Ftb3VudCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7CiAgICBldmVudCBBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX293bmVyLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICAgICApOwoKfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gTWluaU1lVG9rZW5GYWN0b3J5Ci8vLy8vLy8vLy8vLy8vLy8KCi8vLyBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCB0byBnZW5lcmF0ZSBjbG9uZSBjb250cmFjdHMgZnJvbSBhIGNvbnRyYWN0LgovLy8gIEluIHNvbGlkaXR5IHRoaXMgaXMgdGhlIHdheSB0byBjcmVhdGUgYSBjb250cmFjdCBmcm9tIGEgY29udHJhY3Qgb2YgdGhlCi8vLyAgc2FtZSBjbGFzcwpjb250cmFjdCBNaW5pTWVUb2tlbkZhY3RvcnkgewoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZSB0aGUgREFwcCBieSBjcmVhdGluZyBhIG5ldyB0b2tlbiB3aXRoIG5ldyBmdW5jdGlvbmFsaXRpZXMKICAgIC8vLyAgdGhlIG1zZy5zZW5kZXIgYmVjb21lcyB0aGUgY29udHJvbGxlciBvZiB0aGlzIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSB0b2tlbiBiZWluZyBjbG9uZWQKICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwKICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdG9rZW4gY29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSByZXR1cm5zIChNaW5pTWVUb2tlbikgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOwogICAgfQp9CgoKLy8vIEBkZXYgYE93bmVkYCBpcyBhIGJhc2UgbGV2ZWwgY29udHJhY3QgdGhhdCBhc3NpZ25zIGFuIGBvd25lcmAgdGhhdCBjYW4gYmUKLy8vICBsYXRlciBjaGFuZ2VkCmNvbnRyYWN0IE93bmVkIHsKICAgIC8vLyBAZGV2IGBvd25lcmAgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7IGlmIChtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsgXzsgfQoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIC8vLyBAbm90aWNlIFRoZSBDb25zdHJ1Y3RvciBhc3NpZ25zIHRoZSBtZXNzYWdlIHNlbmRlciB0byBiZSBgb3duZXJgCiAgICBmdW5jdGlvbiBPd25lZCgpIHsgb3duZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBgb3duZXJgIGNhbiBzdGVwIGRvd24gYW5kIGFzc2lnbiBzb21lIG90aGVyIGFkZHJlc3MgdG8gdGhpcyByb2xlCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyLiAweDAgY2FuIGJlIHVzZWQgdG8gY3JlYXRlCiAgICAvLy8gIGFuIHVub3duZWQgbmV1dHJhbCB2YXVsdCwgaG93ZXZlciB0aGF0IGNhbm5vdCBiZSB1bmRvbmUKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX25ld093bmVyKSBvbmx5T3duZXIgewogICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgfQp9CgoKLy8vIEBkZXYgVGhpcyBpcyBkZXNpZ25lZCB0byBjb250cm9sIHRoZSBpc3N1YW5jZSBvZiBhIE1pbmlNZSBUb2tlbiBmb3IgYQovLy8gIG5vbi1wcm9maXQgQ2FtcGFpZ24uIFRoaXMgY29udHJhY3QgZWZmZWN0aXZlbHkgZGljdGF0ZXMgdGhlIHRlcm1zIG9mIHRoZQovLy8gIGZ1bmRpbmcgcm91bmQuCgpjb250cmFjdCBHaXZldGhDYW1wYWlnbiBpcyBUb2tlbkNvbnRyb2xsZXIsIE93bmVkIHsKCiAgICB1aW50IHB1YmxpYyBzdGFydEZ1bmRpbmdUaW1lOyAgICAgICAvLyBJbiBVTklYIFRpbWUgRm9ybWF0CiAgICB1aW50IHB1YmxpYyBlbmRGdW5kaW5nVGltZTsgICAgICAgICAvLyBJbiBVTklYIFRpbWUgRm9ybWF0CiAgICB1aW50IHB1YmxpYyBtYXhpbXVtRnVuZGluZzsgICAgICAgICAvLyBJbiB3ZWkKICAgIHVpbnQgcHVibGljIHRvdGFsQ29sbGVjdGVkOyAgICAgICAgIC8vIEluIHdlaQogICAgTWluaU1lVG9rZW4gcHVibGljIHRva2VuQ29udHJhY3Q7ICAgLy8gVGhlIG5ldyB0b2tlbiBmb3IgdGhpcyBDYW1wYWlnbgogICAgYWRkcmVzcyBwdWJsaWMgdmF1bHRBZGRyZXNzOyAgICAgICAgLy8gVGhlIGFkZHJlc3MgdG8gaG9sZCB0aGUgZnVuZHMgZG9uYXRlZAoKLy8vIEBub3RpY2UgJ0dpdmV0aENhbXBhaWduKCknIGluaXRpYXRlcyB0aGUgQ2FtcGFpZ24gYnkgc2V0dGluZyBpdHMgZnVuZGluZwovLy8gcGFyYW1ldGVycwovLy8gQGRldiBUaGVyZSBhcmUgc2V2ZXJhbCBjaGVja3MgdG8gbWFrZSBzdXJlIHRoZSBwYXJhbWV0ZXJzIGFyZSBhY2NlcHRhYmxlCi8vLyBAcGFyYW0gX3N0YXJ0RnVuZGluZ1RpbWUgVGhlIFVOSVggdGltZSB0aGF0IHRoZSBDYW1wYWlnbiB3aWxsIGJlIGFibGUgdG8KLy8vIHN0YXJ0IHJlY2VpdmluZyBmdW5kcwovLy8gQHBhcmFtIF9lbmRGdW5kaW5nVGltZSBUaGUgVU5JWCB0aW1lIHRoYXQgdGhlIENhbXBhaWduIHdpbGwgc3RvcCBiZWluZyBhYmxlCi8vLyB0byByZWNlaXZlIGZ1bmRzCi8vLyBAcGFyYW0gX21heGltdW1GdW5kaW5nIEluIHdlaSwgdGhlIE1heGltdW0gYW1vdW50IHRoYXQgdGhlIENhbXBhaWduIGNhbgovLy8gcmVjZWl2ZSAoY3VycmVudGx5IHRoZSBtYXggaXMgc2V0IGF0IDEwLDAwMCBFVEggZm9yIHRoZSBiZXRhKQovLy8gQHBhcmFtIF92YXVsdEFkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHN0b3JlIHRoZSBkb25hdGVkIGZ1bmRzCi8vLyBAcGFyYW0gX3Rva2VuQWRkcmVzcyBBZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGlzIGNvbnRyYWN0IGNvbnRyb2xzCgogICAgZnVuY3Rpb24gR2l2ZXRoQ2FtcGFpZ24oCiAgICAgICAgdWludCBfc3RhcnRGdW5kaW5nVGltZSwKICAgICAgICB1aW50IF9lbmRGdW5kaW5nVGltZSwKICAgICAgICB1aW50IF9tYXhpbXVtRnVuZGluZywKICAgICAgICBhZGRyZXNzIF92YXVsdEFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfdG9rZW5BZGRyZXNzCgogICAgKSB7CiAgICAgICAgaWYgKChfZW5kRnVuZGluZ1RpbWUgPCBub3cpIHx8ICAgICAgICAgICAgICAgIC8vIENhbm5vdCBlbmQgaW4gdGhlIHBhc3QKICAgICAgICAgICAgKF9lbmRGdW5kaW5nVGltZSA8PSBfc3RhcnRGdW5kaW5nVGltZSkgfHwKICAgICAgICAgICAgKF9tYXhpbXVtRnVuZGluZyA+IDEwMDAwIGV0aGVyKSB8fCAgICAgICAgLy8gVGhlIEJldGEgaXMgbGltaXRlZAogICAgICAgICAgICAoX3ZhdWx0QWRkcmVzcyA9PSAwKSkgICAgICAgICAgICAgICAgICAgICAvLyBUbyBwcmV2ZW50IGJ1cm5pbmcgRVRICiAgICAgICAgICAgIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICAgIH0KICAgICAgICBzdGFydEZ1bmRpbmdUaW1lID0gX3N0YXJ0RnVuZGluZ1RpbWU7CiAgICAgICAgZW5kRnVuZGluZ1RpbWUgPSBfZW5kRnVuZGluZ1RpbWU7CiAgICAgICAgbWF4aW11bUZ1bmRpbmcgPSBfbWF4aW11bUZ1bmRpbmc7CiAgICAgICAgdG9rZW5Db250cmFjdCA9IE1pbmlNZVRva2VuKF90b2tlbkFkZHJlc3MpOy8vIFRoZSBEZXBsb3llZCBUb2tlbiBDb250cmFjdAogICAgICAgIHZhdWx0QWRkcmVzcyA9IF92YXVsdEFkZHJlc3M7CiAgICB9CgovLy8gQGRldiBUaGUgZmFsbGJhY2sgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gZXRoZXIgaXMgc2VudCB0byB0aGUgY29udHJhY3QsIGl0Ci8vLyBzaW1wbHkgY2FsbHMgYGRvUGF5bWVudCgpYCB3aXRoIHRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgYXMgdGhlCi8vLyBgX293bmVyYC4gUGF5YWJsZSBpcyBhIHJlcXVpcmVkIHNvbGlkaXR5IG1vZGlmaWVyIGZvciBmdW5jdGlvbnMgdG8gcmVjZWl2ZQovLy8gZXRoZXIsIHdpdGhvdXQgdGhpcyBtb2RpZmllciBmdW5jdGlvbnMgd2lsbCB0aHJvdyBpZiBldGhlciBpcyBzZW50IHRvIHRoZW0KCiAgICBmdW5jdGlvbiAoKSAgcGF5YWJsZSB7CiAgICAgICAgZG9QYXltZW50KG1zZy5zZW5kZXIpOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLy8KLy8gVG9rZW5Db250cm9sbGVyIGludGVyZmFjZQovLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBub3RpY2UgYHByb3h5UGF5bWVudCgpYCBhbGxvd3MgdGhlIGNhbGxlciB0byBzZW5kIGV0aGVyIHRvIHRoZSBDYW1wYWlnbiBhbmQKLy8vIGhhdmUgdGhlIHRva2VucyBjcmVhdGVkIGluIGFuIGFkZHJlc3Mgb2YgdGhlaXIgY2hvb3NpbmcKLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zCgogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCkgewogICAgICAgIGRvUGF5bWVudChfb3duZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0cmFuc2ZlciwgZm9yIHRoaXMgQ2FtcGFpZ24gYWxsCi8vLyAgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGJ5IGRlZmF1bHQgYW5kIG5vIGV4dHJhIG5vdGlmaWNhdGlvbnMgYXJlIG5lZWRlZAovLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCi8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCi8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCwgZm9yIHRoaXMgQ2FtcGFpZ24gYWxsCi8vLyAgYXBwcm92YWxzIGFyZSBhbGxvd2VkIGJ5IGRlZmF1bHQgYW5kIG5vIGV4dHJhIG5vdGlmaWNhdGlvbnMgYXJlIG5lZWRlZAovLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCi8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpCiAgICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCi8vLyBAZGV2IGBkb1BheW1lbnQoKWAgaXMgYW4gaW50ZXJuYWwgZnVuY3Rpb24gdGhhdCBzZW5kcyB0aGUgZXRoZXIgdGhhdCB0aGlzCi8vLyAgY29udHJhY3QgcmVjZWl2ZXMgdG8gdGhlIGB2YXVsdGAgYW5kIGNyZWF0ZXMgdG9rZW5zIGluIHRoZSBhZGRyZXNzIG9mIHRoZQovLy8gIGBfb3duZXJgIGFzc3VtaW5nIHRoZSBDYW1wYWlnbiBpcyBzdGlsbCBhY2NlcHRpbmcgZnVuZHMKLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zCgogICAgZnVuY3Rpb24gZG9QYXltZW50KGFkZHJlc3MgX293bmVyKSBpbnRlcm5hbCB7CgovLyBGaXJzdCBjaGVjayB0aGF0IHRoZSBDYW1wYWlnbiBpcyBhbGxvd2VkIHRvIHJlY2VpdmUgdGhpcyBkb25hdGlvbgogICAgICAgIGlmICgobm93PHN0YXJ0RnVuZGluZ1RpbWUpIHx8CiAgICAgICAgICAgIChub3c+ZW5kRnVuZGluZ1RpbWUpIHx8CiAgICAgICAgICAgICh0b2tlbkNvbnRyYWN0LmNvbnRyb2xsZXIoKSA9PSAwKSB8fCAgICAgICAgICAgLy8gRXh0cmEgY2hlY2sKICAgICAgICAgICAgKG1zZy52YWx1ZSA9PSAwKSB8fAogICAgICAgICAgICAodG90YWxDb2xsZWN0ZWQgKyBtc2cudmFsdWUgPiBtYXhpbXVtRnVuZGluZykpCiAgICAgICAgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CgovL1RyYWNrIGhvdyBtdWNoIHRoZSBDYW1wYWlnbiBoYXMgY29sbGVjdGVkCiAgICAgICAgdG90YWxDb2xsZWN0ZWQgKz0gbXNnLnZhbHVlOwoKLy9TZW5kIHRoZSBldGhlciB0byB0aGUgdmF1bHQKICAgICAgICBpZiAoIXZhdWx0QWRkcmVzcy5zZW5kKG1zZy52YWx1ZSkpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQoKLy8gQ3JlYXRlcyBhbiBlcXVhbCBhbW91bnQgb2YgdG9rZW5zIGFzIGV0aGVyIHNlbnQuIFRoZSBuZXcgdG9rZW5zIGFyZSBjcmVhdGVkCi8vICBpbiB0aGUgYF9vd25lcmAgYWRkcmVzcwogICAgICAgIGlmICghdG9rZW5Db250cmFjdC5nZW5lcmF0ZVRva2Vucyhfb3duZXIsIG1zZy52YWx1ZSkpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICB9CgovLy8gQG5vdGljZSBgZmluYWxpemVGdW5kaW5nKClgIGVuZHMgdGhlIENhbXBhaWduIGJ5IGNhbGxpbmcgc2V0dGluZyB0aGUKLy8vICBjb250cm9sbGVyIHRvIDAsIHRoZXJlYnkgZW5kaW5nIHRoZSBpc3N1YW5jZSBvZiBuZXcgdG9rZW5zIGFuZCBzdG9wcGluZyB0aGUKLy8vICBDYW1wYWlnbiBmcm9tIHJlY2VpdmluZyBtb3JlIGV0aGVyCi8vLyBAZGV2IGBmaW5hbGl6ZUZ1bmRpbmcoKWAgY2FuIG9ubHkgYmUgY2FsbGVkIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGZ1bmRpbmcgcGVyaW9kLgoKICAgIGZ1bmN0aW9uIGZpbmFsaXplRnVuZGluZygpIHsKICAgICAgICBpZiAobm93IDwgZW5kRnVuZGluZ1RpbWUpIHRocm93OwogICAgICAgIHRva2VuQ29udHJhY3QuY2hhbmdlQ29udHJvbGxlcigwKTsKICAgIH0KCgovLy8gQG5vdGljZSBgb25seU93bmVyYCBjaGFuZ2VzIHRoZSBsb2NhdGlvbiB0aGF0IGV0aGVyIGlzIHNlbnQKLy8vIEBwYXJhbSBfbmV3VmF1bHRBZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBldGhlciBzZW50IHRvIHRoaXMKLy8vICBDYW1wYWlnbgogICAgZnVuY3Rpb24gc2V0VmF1bHQoYWRkcmVzcyBfbmV3VmF1bHRBZGRyZXNzKSBvbmx5T3duZXIgewogICAgICAgIHZhdWx0QWRkcmVzcyA9IF9uZXdWYXVsdEFkZHJlc3M7CiAgICB9CgogICAgLy8vLy8vLy8vLwogICAgLy8gU2FmZXR5IE1ldGhvZHMKICAgIC8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmICh0b2tlbkNvbnRyYWN0LmNvbnRyb2xsZXIoKSA9PSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgICAgIHRva2VuQ29udHJhY3QuY2xhaW1Ub2tlbnMoX3Rva2VuKTsKICAgICAgICB9CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgRVJDMjBUb2tlbiB0b2tlbiA9IEVSQzIwVG9rZW4oX3Rva2VuKTsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgdG9rZW4udHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogICAgICAgIENsYWltZWRUb2tlbnMoX3Rva2VuLCBvd25lciwgYmFsYW5jZSk7CiAgICB9CgogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQgX2Ftb3VudCk7Cgp9'.
	

]
