Class {
	#name : #SRTa661bdb2b809691209018ae0776c25ec0585d268,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa661bdb2b809691209018ae0776c25ec0585d268 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgppbnRlcmZhY2UgSUVtaXNzaW9uUGFydE1pbnRlciB7CiAgICBmdW5jdGlvbiBtaW50UGFydE9mRW1pc3Npb24oYWRkcmVzcyB0bywgdWludCBwYXJ0LCB1aW50IHBhcnRPZkVtaXNzaW9uRm9yUHVibGljU2FsZXMpIHB1YmxpYzsKfQoKY29udHJhY3QgQXJndW1lbnRzQ2hlY2tlciB7CgogICAgLy8vIEBkZXYgY2hlY2sgd2hpY2ggcHJldmVudHMgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICAgIG1vZGlmaWVyIHBheWxvYWRTaXplSXModWludCBzaXplKSB7CiAgICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA9PSBzaXplICsgNCAvKiBmdW5jdGlvbiBzZWxlY3RvciAqLyk7CiAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IGNoZWNrIHRoYXQgYWRkcmVzcyBpcyB2YWxpZAogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKGFkZHJlc3MgYWRkcikgewogICAgICAgIHJlcXVpcmUoYWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQp9Cgpjb250cmFjdCBNaW50YWJsZVRva2VuIHsKICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CgogICAgLy8vIEBkZXYgbWludHMgbmV3IHRva2VucwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgbXVsdGlvd25lZCB7CgoJLy8gVFlQRVMKCiAgICAvLyBzdHJ1Y3QgZm9yIHRoZSBzdGF0dXMgb2YgYSBwZW5kaW5nIG9wZXJhdGlvbi4KICAgIHN0cnVjdCBNdWx0aU93bmVkT3BlcmF0aW9uUGVuZGluZ1N0YXRlIHsKICAgICAgICAvLyBjb3VudCBvZiBjb25maXJtYXRpb25zIG5lZWRlZAogICAgICAgIHVpbnQgeWV0TmVlZGVkOwoKICAgICAgICAvLyBiaXRtYXAgb2YgY29uZmlybWF0aW9ucyB3aGVyZSBvd25lciAjb3duZXJJbmRleCdzIGRlY2lzaW9uIGNvcnJlc3BvbmRzIHRvIDIqKm93bmVySW5kZXggYml0CiAgICAgICAgdWludCBvd25lcnNEb25lOwoKICAgICAgICAvLyBwb3NpdGlvbiBvZiB0aGlzIG9wZXJhdGlvbiBrZXkgaW4gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4CiAgICAgICAgdWludCBpbmRleDsKICAgIH0KCgkvLyBFVkVOVFMKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwogICAgZXZlbnQgUmV2b2tlKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIGV2ZW50IEZpbmFsQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKCiAgICAvLyBzb21lIG90aGVycyBhcmUgaW4gdGhlIGNhc2Ugb2YgYW4gb3duZXIgY2hhbmdpbmcuCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBvbGRPd25lciwgYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3Mgb2xkT3duZXIpOwoKICAgIC8vIHRoZSBsYXN0IG9uZSBpcyBlbWl0dGVkIGlmIHRoZSByZXF1aXJlZCBzaWduYXR1cmVzIGNoYW5nZQogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2VkKHVpbnQgbmV3UmVxdWlyZW1lbnQpOwoKCS8vIE1PRElGSUVSUwoKICAgIC8vIHNpbXBsZSBzaW5nbGUtc2lnIGZ1bmN0aW9uIG1vZGlmaWVyLgogICAgbW9kaWZpZXIgb25seW93bmVyIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CiAgICAvLyBtdWx0aS1zaWcgZnVuY3Rpb24gbW9kaWZpZXI6IHRoZSBvcGVyYXRpb24gbXVzdCBoYXZlIGFuIGludHJpbnNpYyBoYXNoIGluIG9yZGVyCiAgICAvLyB0aGF0IGxhdGVyIGF0dGVtcHRzIGNhbiBiZSByZWFsaXNlZCBhcyB0aGUgc2FtZSB1bmRlcmx5aW5nIG9wZXJhdGlvbiBhbmQKICAgIC8vIHRodXMgY291bnQgYXMgY29uZmlybWF0aW9ucy4KICAgIG1vZGlmaWVyIG9ubHltYW55b3duZXJzKGJ5dGVzMzIgX29wZXJhdGlvbikgewogICAgICAgIGlmIChjb25maXJtQW5kQ2hlY2soX29wZXJhdGlvbikpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICAgICAgLy8gRXZlbiBpZiByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBoYXMndCBiZWVuIGNvbGxlY3RlZCB5ZXQsCiAgICAgICAgLy8gd2UgY2FuJ3QgdGhyb3cgaGVyZSAtIGJlY2F1c2UgY2hhbmdlcyB0byB0aGUgc3RhdGUgaGF2ZSB0byBiZSBwcmVzZXJ2ZWQuCiAgICAgICAgLy8gQnV0LCBjb25maXJtQW5kQ2hlY2sgaXRzZWxmIHdpbGwgdGhyb3cgaW4gY2FzZSBzZW5kZXIgaXMgbm90IGFuIG93bmVyLgogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkTnVtT3duZXJzKHVpbnQgX251bU93bmVycykgewogICAgICAgIHJlcXVpcmUoX251bU93bmVycyA+IDAgJiYgX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCwgdWludCBfbnVtT3duZXJzKSB7CiAgICAgICAgcmVxdWlyZShfcmVxdWlyZWQgPiAwICYmIF9yZXF1aXJlZCA8PSBfbnVtT3duZXJzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRXhpc3RzKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIoX2FkZHJlc3MpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKCFpc093bmVyKF9hZGRyZXNzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSB7CiAgICAgICAgcmVxdWlyZShpc09wZXJhdGlvbkFjdGl2ZShfb3BlcmF0aW9uKSk7CiAgICAgICAgXzsKICAgIH0KCgkvLyBNRVRIT0RTCgogICAgLy8gY29uc3RydWN0b3IgaXMgZ2l2ZW4gbnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgdG8gZG8gcHJvdGVjdGVkICJvbmx5bWFueW93bmVycyIgdHJhbnNhY3Rpb25zCiAgICAvLyBhcyB3ZWxsIGFzIHRoZSBzZWxlY3Rpb24gb2YgYWRkcmVzc2VzIGNhcGFibGUgb2YgY29uZmlybWluZyB0aGVtIChtc2cuc2VuZGVyIGlzIG5vdCBhZGRlZCB0byB0aGUgb3duZXJzISkuCiAgICBmdW5jdGlvbiBtdWx0aW93bmVkKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZE51bU93bmVycyhfb3duZXJzLmxlbmd0aCkKICAgICAgICBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudChfcmVxdWlyZWQsIF9vd25lcnMubGVuZ3RoKQogICAgewogICAgICAgIGFzc2VydChjX21heE93bmVycyA8PSAyNTUpOwoKICAgICAgICBtX251bU93bmVycyA9IF9vd25lcnMubGVuZ3RoOwogICAgICAgIG1fbXVsdGlPd25lZFJlcXVpcmVkID0gX3JlcXVpcmVkOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfb3duZXJzLmxlbmd0aDsgKytpKQogICAgICAgIHsKICAgICAgICAgICAgYWRkcmVzcyBvd25lciA9IF9vd25lcnNbaV07CiAgICAgICAgICAgIC8vIGludmFsaWQgYW5kIGR1cGxpY2F0ZSBhZGRyZXNzZXMgYXJlIG5vdCBhbGxvd2VkCiAgICAgICAgICAgIHJlcXVpcmUoMCAhPSBvd25lciAmJiAhaXNPd25lcihvd25lcikgLyogbm90IGlzT3duZXIgeWV0ISAqLyk7CgogICAgICAgICAgICB1aW50IGN1cnJlbnRPd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KGkgKyAxIC8qIGZpcnN0IHNsb3QgaXMgdW51c2VkICovKTsKICAgICAgICAgICAgbV9vd25lcnNbY3VycmVudE93bmVySW5kZXhdID0gb3duZXI7CiAgICAgICAgICAgIG1fb3duZXJJbmRleFtvd25lcl0gPSBjdXJyZW50T3duZXJJbmRleDsKICAgICAgICB9CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSByZXBsYWNlcyBhbiBvd25lciBgX2Zyb21gIHdpdGggYW5vdGhlciBgX3RvYC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gYWRkcmVzcyBvZiBvd25lciB0byByZXBsYWNlCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIG9mIG5ldyBvd25lcgogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvd25lckV4aXN0cyhfZnJvbSkKICAgICAgICBvd25lckRvZXNOb3RFeGlzdChfdG8pCiAgICAgICAgb25seW1hbnlvd25lcnMoa2VjY2FrMjU2KG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IGNoZWNrT3duZXJJbmRleChtX293bmVySW5kZXhbX2Zyb21dKTsKICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IF90bzsKICAgICAgICBtX293bmVySW5kZXhbX2Zyb21dID0gMDsKICAgICAgICBtX293bmVySW5kZXhbX3RvXSA9IG93bmVySW5kZXg7CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgICAgICBPd25lckNoYW5nZWQoX2Zyb20sIF90byk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYWRkcyBhbiBvd25lcgogICAgLy8vIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBvZiBuZXcgb3duZXIKICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIGFkZE93bmVyKGFkZHJlc3MgX293bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb3duZXJEb2VzTm90RXhpc3QoX293bmVyKQogICAgICAgIHZhbGlkTnVtT3duZXJzKG1fbnVtT3duZXJzICsgMSkKICAgICAgICBvbmx5bWFueW93bmVycyhrZWNjYWsyNTYobXNnLmRhdGEpKQogICAgewogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgbV9udW1Pd25lcnMrKzsKICAgICAgICBtX293bmVyc1ttX251bU93bmVyc10gPSBfb3duZXI7CiAgICAgICAgbV9vd25lckluZGV4W19vd25lcl0gPSBjaGVja093bmVySW5kZXgobV9udW1Pd25lcnMpOwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJBZGRlZChfb3duZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHJlbW92ZXMgYW4gb3duZXIKICAgIC8vLyBAcGFyYW0gX293bmVyIGFkZHJlc3Mgb2Ygb3duZXIgdG8gcmVtb3ZlCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiByZW1vdmVPd25lcihhZGRyZXNzIF9vd25lcikKICAgICAgICBleHRlcm5hbAogICAgICAgIG93bmVyRXhpc3RzKF9vd25lcikKICAgICAgICB2YWxpZE51bU93bmVycyhtX251bU93bmVycyAtIDEpCiAgICAgICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQobV9tdWx0aU93bmVkUmVxdWlyZWQsIG1fbnVtT3duZXJzIC0gMSkKICAgICAgICBvbmx5bWFueW93bmVycyhrZWNjYWsyNTYobXNnLmRhdGEpKQogICAgewogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtfb3duZXJdKTsKICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W19vd25lcl0gPSAwOwogICAgICAgIC8vbWFrZSBzdXJlIG1fbnVtT3duZXJzIGlzIGVxdWFsIHRvIHRoZSBudW1iZXIgb2Ygb3duZXJzIGFuZCBhbHdheXMgcG9pbnRzIHRvIHRoZSBsYXN0IG93bmVyCiAgICAgICAgcmVvcmdhbml6ZU93bmVycygpOwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJSZW1vdmVkKF9vd25lcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgY2hhbmdlcyB0aGUgcmVxdWlyZWQgbnVtYmVyIG9mIG93bmVyIHNpZ25hdHVyZXMKICAgIC8vLyBAcGFyYW0gX25ld1JlcXVpcmVkIG5ldyBudW1iZXIgb2Ygc2lnbmF0dXJlcyByZXF1aXJlZAogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfbmV3UmVxdWlyZWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudChfbmV3UmVxdWlyZWQsIG1fbnVtT3duZXJzKQogICAgICAgIG9ubHltYW55b3duZXJzKGtlY2NhazI1Nihtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgbV9tdWx0aU93bmVkUmVxdWlyZWQgPSBfbmV3UmVxdWlyZWQ7CiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2VkKF9uZXdSZXF1aXJlZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0cyBhbiBvd25lciBieSAwLWluZGV4ZWQgcG9zaXRpb24KICAgIC8vLyBAcGFyYW0gb3duZXJJbmRleCAwLWluZGV4ZWQgb3duZXIgcG9zaXRpb24KICAgIGZ1bmN0aW9uIGdldE93bmVyKHVpbnQgb3duZXJJbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gbV9vd25lcnNbb3duZXJJbmRleCArIDFdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldHMgb3duZXJzCiAgICAvLy8gQHJldHVybiBtZW1vcnkgYXJyYXkgb2Ygb3duZXJzCiAgICBmdW5jdGlvbiBnZXRPd25lcnMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzc1tdKSB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSByZXN1bHQgPSBuZXcgYWRkcmVzc1tdKG1fbnVtT3duZXJzKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtX251bU93bmVyczsgaSsrKQogICAgICAgICAgICByZXN1bHRbaV0gPSBnZXRPd25lcihpKTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjaGVja3MgaWYgcHJvdmlkZWQgYWRkcmVzcyBpcyBhbiBvd25lciBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9hZGRyIGFkZHJlc3MgdG8gY2hlY2sKICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgaXQncyBhbiBvd25lcgogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtX293bmVySW5kZXhbX2FkZHJdID4gMDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUZXN0cyBvd25lcnNoaXAgb2YgdGhlIGN1cnJlbnQgY2FsbGVyLgogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIGFuIG93bmVyCiAgICAvLyBJdCdzIGFkdmlzYWJsZSB0byBjYWxsIGl0IGJ5IG5ldyBvd25lciB0byBtYWtlIHN1cmUgdGhhdCB0aGUgc2FtZSBlcnJvbmVvdXMgYWRkcmVzcyBpcyBub3QgY29weS1wYXN0ZWQgdG8KICAgIC8vIGFkZE93bmVyL2NoYW5nZU93bmVyIGFuZCB0byBpc093bmVyLgogICAgZnVuY3Rpb24gYW1JT3duZXIoKSBleHRlcm5hbCBjb25zdGFudCBvbmx5b3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldm9rZXMgYSBwcmlvciBjb25maXJtYXRpb24gb2YgdGhlIGdpdmVuIG9wZXJhdGlvbgogICAgLy8vIEBwYXJhbSBfb3BlcmF0aW9uIG9wZXJhdGlvbiB2YWx1ZSwgdHlwaWNhbGx5IGtlY2NhazI1Nihtc2cuZGF0YSkKICAgIGZ1bmN0aW9uIHJldm9rZShieXRlczMyIF9vcGVyYXRpb24pCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoX29wZXJhdGlvbikKICAgICAgICBvbmx5b3duZXIKICAgIHsKICAgICAgICB1aW50IG93bmVySW5kZXhCaXQgPSBtYWtlT3duZXJCaXRtYXBCaXQobXNnLnNlbmRlcik7CiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dOwogICAgICAgIHJlcXVpcmUocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA+IDApOwoKICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CgogICAgICAgIHBlbmRpbmcueWV0TmVlZGVkKys7CiAgICAgICAgcGVuZGluZy5vd25lcnNEb25lIC09IG93bmVySW5kZXhCaXQ7CgogICAgICAgIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChfb3BlcmF0aW9uKTsKICAgICAgICBSZXZva2UobXNnLnNlbmRlciwgX29wZXJhdGlvbik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIGlmIG93bmVyIGNvbmZpcm1lZCBnaXZlbiBvcGVyYXRpb24KICAgIC8vLyBAcGFyYW0gX29wZXJhdGlvbiBvcGVyYXRpb24gdmFsdWUsIHR5cGljYWxseSBrZWNjYWsyNTYobXNnLmRhdGEpCiAgICAvLy8gQHBhcmFtIF9vd25lciBhbiBvd25lciBhZGRyZXNzCiAgICBmdW5jdGlvbiBoYXNDb25maXJtZWQoYnl0ZXMzMiBfb3BlcmF0aW9uLCBhZGRyZXNzIF9vd25lcikKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgbXVsdGlPd25lZE9wZXJhdGlvbklzQWN0aXZlKF9vcGVyYXRpb24pCiAgICAgICAgb3duZXJFeGlzdHMoX293bmVyKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuICEobV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXS5vd25lcnNEb25lICYgbWFrZU93bmVyQml0bWFwQml0KF9vd25lcikgPT0gMCk7CiAgICB9CgogICAgLy8gSU5URVJOQUwgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGNvbmZpcm1BbmRDaGVjayhieXRlczMyIF9vcGVyYXRpb24pCiAgICAgICAgcHJpdmF0ZQogICAgICAgIG9ubHlvd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKDUxMiA9PSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoKQogICAgICAgICAgICAvLyBJbiBjYXNlIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleCBncm93cyB0b28gbXVjaCB3ZSBoYXZlIHRvIHNocmluayBpdDogb3RoZXJ3aXNlIGF0IHNvbWUgcG9pbnQKICAgICAgICAgICAgLy8gd2Ugd29uJ3QgYmUgYWJsZSB0byBkbyBpdCBiZWNhdXNlIG9mIGJsb2NrIGdhcyBsaW1pdC4KICAgICAgICAgICAgLy8gWWVzLCBwZW5kaW5nIGNvbmZpcm1hdGlvbnMgd2lsbCBiZSBsb3N0LiBEb250IHNlZSBhbnkgc2VjdXJpdHkgb3Igc3RhYmlsaXR5IGltcGxpY2F0aW9ucy4KICAgICAgICAgICAgLy8gVE9ETyB1c2UgbW9yZSBncmFjZWZ1bCBhcHByb2FjaCBsaWtlIGNvbXBhY3Qgb3IgcmVtb3ZhbCBvZiBjbGVhclBlbmRpbmcgY29tcGxldGVseQogICAgICAgICAgICBjbGVhclBlbmRpbmcoKTsKCiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dOwoKICAgICAgICAvLyBpZiB3ZSdyZSBub3QgeWV0IHdvcmtpbmcgb24gdGhpcyBvcGVyYXRpb24sIHN3aXRjaCBvdmVyIGFuZCByZXNldCB0aGUgY29uZmlybWF0aW9uIHN0YXR1cy4KICAgICAgICBpZiAoISBpc09wZXJhdGlvbkFjdGl2ZShfb3BlcmF0aW9uKSkgewogICAgICAgICAgICAvLyByZXNldCBjb3VudCBvZiBjb25maXJtYXRpb25zIG5lZWRlZC4KICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQgPSBtX211bHRpT3duZWRSZXF1aXJlZDsKICAgICAgICAgICAgLy8gcmVzZXQgd2hpY2ggb3duZXJzIGhhdmUgY29uZmlybWVkIChub25lKSAtIHNldCBvdXIgYml0bWFwIHRvIDAuCiAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSA9IDA7CiAgICAgICAgICAgIHBlbmRpbmcuaW5kZXggPSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoKys7CiAgICAgICAgICAgIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtwZW5kaW5nLmluZGV4XSA9IF9vcGVyYXRpb247CiAgICAgICAgICAgIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChfb3BlcmF0aW9uKTsKICAgICAgICB9CgogICAgICAgIC8vIGRldGVybWluZSB0aGUgYml0IHRvIHNldCBmb3IgdGhpcyBvd25lci4KICAgICAgICB1aW50IG93bmVySW5kZXhCaXQgPSBtYWtlT3duZXJCaXRtYXBCaXQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gbWFrZSBzdXJlIHdlICh0aGUgbWVzc2FnZSBzZW5kZXIpIGhhdmVuJ3QgY29uZmlybWVkIHRoaXMgb3BlcmF0aW9uIHByZXZpb3VzbHkuCiAgICAgICAgaWYgKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPT0gMCkgewogICAgICAgICAgICAvLyBvayAtIGNoZWNrIGlmIGNvdW50IGlzIGVub3VnaCB0byBnbyBhaGVhZC4KICAgICAgICAgICAgYXNzZXJ0KHBlbmRpbmcueWV0TmVlZGVkID4gMCk7CiAgICAgICAgICAgIGlmIChwZW5kaW5nLnlldE5lZWRlZCA9PSAxKSB7CiAgICAgICAgICAgICAgICAvLyBlbm91Z2ggY29uZmlybWF0aW9uczogcmVzZXQgYW5kIHJ1biBpbnRlcmlvci4KICAgICAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXS5pbmRleF07CiAgICAgICAgICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICAgICAgICAgIEZpbmFsQ29uZmlybWF0aW9uKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyBub3QgZW5vdWdoOiByZWNvcmQgdGhhdCB0aGlzIG93bmVyIGluIHBhcnRpY3VsYXIgY29uZmlybWVkLgogICAgICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQtLTsKICAgICAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSB8PSBvd25lckluZGV4Qml0OwogICAgICAgICAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwogICAgICAgICAgICAgICAgQ29uZmlybWF0aW9uKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFJlY2xhaW1zIGZyZWUgc2xvdHMgYmV0d2VlbiB2YWxpZCBvd25lcnMgaW4gbV9vd25lcnMuCiAgICAvLyBUT0RPIGdpdmVuIHRoYXQgaXRzIGNhbGxlZCBhZnRlciBlYWNoIHJlbW92YWwsIGl0IGNvdWxkIGJlIHNpbXBsaWZpZWQuCiAgICBmdW5jdGlvbiByZW9yZ2FuaXplT3duZXJzKCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCBmcmVlID0gMTsKICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzKQogICAgICAgIHsKICAgICAgICAgICAgLy8gaXRlcmF0aW5nIHRvIHRoZSBmaXJzdCBmcmVlIHNsb3QgZnJvbSB0aGUgYmVnaW5uaW5nCiAgICAgICAgICAgIHdoaWxlIChmcmVlIDwgbV9udW1Pd25lcnMgJiYgbV9vd25lcnNbZnJlZV0gIT0gMCkgZnJlZSsrOwoKICAgICAgICAgICAgLy8gaXRlcmF0aW5nIHRvIHRoZSBmaXJzdCBvY2N1cGllZCBzbG90IGZyb20gdGhlIGVuZAogICAgICAgICAgICB3aGlsZSAobV9udW1Pd25lcnMgPiAxICYmIG1fb3duZXJzW21fbnVtT3duZXJzXSA9PSAwKSBtX251bU93bmVycy0tOwoKICAgICAgICAgICAgLy8gc3dhcCwgaWYgcG9zc2libGUsIHNvIGZyZWUgc2xvdCBpcyBsb2NhdGVkIGF0IHRoZSBlbmQgYWZ0ZXIgdGhlIHN3YXAKICAgICAgICAgICAgaWYgKGZyZWUgPCBtX251bU93bmVycyAmJiBtX293bmVyc1ttX251bU93bmVyc10gIT0gMCAmJiBtX293bmVyc1tmcmVlXSA9PSAwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyBvd25lcnMgYmV0d2VlbiBzd2FwcGVkIHNsb3RzIHNob3VsZCd0IGJlIHJlbnVtYmVyZWQgLSB0aGF0IHNhdmVzIGEgbG90IG9mIGdhcwogICAgICAgICAgICAgICAgbV9vd25lcnNbZnJlZV0gPSBtX293bmVyc1ttX251bU93bmVyc107CiAgICAgICAgICAgICAgICBtX293bmVySW5kZXhbbV9vd25lcnNbZnJlZV1dID0gZnJlZTsKICAgICAgICAgICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYXJQZW5kaW5nKCkgcHJpdmF0ZSBvbmx5b3duZXIgewogICAgICAgIHVpbnQgbGVuZ3RoID0gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4Lmxlbmd0aDsKICAgICAgICAvLyBUT0RPIGJsb2NrIGdhcyBsaW1pdAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbaV0gIT0gMCkKICAgICAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nW21fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtpXV07CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tPd25lckluZGV4KHVpbnQgb3duZXJJbmRleCkgcHJpdmF0ZSBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoMCAhPSBvd25lckluZGV4ICYmIG93bmVySW5kZXggPD0gY19tYXhPd25lcnMpOwogICAgICAgIHJldHVybiBvd25lckluZGV4OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VPd25lckJpdG1hcEJpdChhZGRyZXNzIG93bmVyKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgobV9vd25lckluZGV4W293bmVyXSk7CiAgICAgICAgcmV0dXJuIDIgKiogb3duZXJJbmRleDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc09wZXJhdGlvbkFjdGl2ZShieXRlczMyIF9vcGVyYXRpb24pIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAwICE9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl0ueWV0TmVlZGVkOwogICAgfQoKCiAgICBmdW5jdGlvbiBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCkgcHJpdmF0ZSBjb25zdGFudCB7CiAgICAgICAgYXNzZXJ0KG1fbnVtT3duZXJzID4gMCk7CiAgICAgICAgYXNzZXJ0KG1fbnVtT3duZXJzIDw9IGNfbWF4T3duZXJzKTsKICAgICAgICBhc3NlcnQobV9vd25lcnNbMF0gPT0gMCk7CiAgICAgICAgYXNzZXJ0KDAgIT0gbV9tdWx0aU93bmVkUmVxdWlyZWQgJiYgbV9tdWx0aU93bmVkUmVxdWlyZWQgPD0gbV9udW1Pd25lcnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChieXRlczMyIF9vcGVyYXRpb24pIHByaXZhdGUgY29uc3RhbnQgewogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICBhc3NlcnQoMCAhPSBwZW5kaW5nLnlldE5lZWRlZCk7CiAgICAgICAgYXNzZXJ0KG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtwZW5kaW5nLmluZGV4XSA9PSBfb3BlcmF0aW9uKTsKICAgICAgICBhc3NlcnQocGVuZGluZy55ZXROZWVkZWQgPD0gbV9tdWx0aU93bmVkUmVxdWlyZWQpOwogICAgfQoKCiAgIAkvLyBGSUVMRFMKCiAgICB1aW50IGNvbnN0YW50IGNfbWF4T3duZXJzID0gMjUwOwoKICAgIC8vIHRoZSBudW1iZXIgb2Ygb3duZXJzIHRoYXQgbXVzdCBjb25maXJtIHRoZSBzYW1lIG9wZXJhdGlvbiBiZWZvcmUgaXQgaXMgcnVuLgogICAgdWludCBwdWJsaWMgbV9tdWx0aU93bmVkUmVxdWlyZWQ7CgoKICAgIC8vIHBvaW50ZXIgdXNlZCB0byBmaW5kIGEgZnJlZSBzbG90IGluIG1fb3duZXJzCiAgICB1aW50IHB1YmxpYyBtX251bU93bmVyczsKCiAgICAvLyBsaXN0IG9mIG93bmVycyAoYWRkcmVzc2VzKSwKICAgIC8vIHNsb3QgMCBpcyB1bnVzZWQgc28gdGhlcmUgYXJlIG5vIG93bmVyIHdoaWNoIGluZGV4IGlzIDAuCiAgICAvLyBUT0RPIGNvdWxkIHdlIHNhdmUgc3BhY2UgYXQgdGhlIGVuZCBvZiB0aGUgYXJyYXkgZm9yIHRoZSBjb21tb24gY2FzZSBvZiA8MTAgb3duZXJzPyBhbmQgc2hvdWxkIHdlPwogICAgYWRkcmVzc1syNTZdIGludGVybmFsIG1fb3duZXJzOwoKICAgIC8vIGluZGV4IG9uIHRoZSBsaXN0IG9mIG93bmVycyB0byBhbGxvdyByZXZlcnNlIGxvb2t1cDogb3duZXIgYWRkcmVzcyA9PiBpbmRleCBpbiBtX293bmVycwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGludGVybmFsIG1fb3duZXJJbmRleDsKCgogICAgLy8gdGhlIG9uZ29pbmcgb3BlcmF0aW9ucy4KICAgIG1hcHBpbmcoYnl0ZXMzMiA9PiBNdWx0aU93bmVkT3BlcmF0aW9uUGVuZGluZ1N0YXRlKSBpbnRlcm5hbCBtX211bHRpT3duZWRQZW5kaW5nOwogICAgYnl0ZXMzMltdIGludGVybmFsIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleDsKfQoKaW50ZXJmYWNlIElEZXRhY2hhYmxlIHsKICAgIGZ1bmN0aW9uIGRldGFjaCgpIHB1YmxpYzsKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgovKioKICogQHRpdGxlIENvbnRyYWN0IHRyYWNrcyAoaW4gcGVyY2VudHMpIHRva2VuIGFsbG9jYXRpb24gdG8gdmFyaW91cyBwb29scyBhbmQgZWFybHkgaW52ZXN0b3JzLgogKgogKiBXaGVuIGFsbCBwdWJsaWMgc2FsZXMgYXJlIGZpbmlzaGVkIGFuZCBhYnNvbHV0ZSB2YWx1ZXMgb2YgdG9rZW4gZW1pc3Npb24KICogYXJlIGtub3duLCB0aGlzIHBvb2wgcGVyY2VudC10b2tlbnMgYXJlIHVzZWQgdG8gbWludCBTTVIgdG9rZW5zIGluCiAqIGFwcHJvcHJpYXRlIGFtb3VudHMuCiAqCiAqIFNlZSBhbHNvIFNtYXJ0elRva2VuTGlmZWN5Y2xlTWFuYWdlci5zb2wuCiAqLwpjb250cmFjdCBTbWFydHpUb2tlbkVtaXNzaW9uUG9vbHMgaXMgQXJndW1lbnRzQ2hlY2tlciwgQmFzaWNUb2tlbiwgRVJDMjAsIG11bHRpb3duZWQsIE1pbnRhYmxlVG9rZW4gewoKICAgIGV2ZW50IENsYWltZWQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CgoKICAgIC8vIFBVQkxJQyBGVU5DVElPTlMKCiAgICBmdW5jdGlvbiBTbWFydHpUb2tlbkVtaXNzaW9uUG9vbHMoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3NpZ25hdHVyZXNSZXF1aXJlZCwgYWRkcmVzcyBfU01STWludGVyKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkQWRkcmVzcyhfU01STWludGVyKQogICAgICAgIG11bHRpb3duZWQoX293bmVycywgX3NpZ25hdHVyZXNSZXF1aXJlZCkKICAgIHsKICAgICAgICBtX1NNUk1pbnRlciA9IF9TTVJNaW50ZXI7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIG1pbnRzIHNwZWNpZmllZCBwZXJjZW50IG9mIHRva2VuIGVtaXNzaW9uIHRvIHBvb2wKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlsb2FkU2l6ZUlzKDMyICogMikKICAgICAgICB2YWxpZEFkZHJlc3MoX3RvKQogICAgICAgIG9ubHltYW55b3duZXJzKGtlY2NhazI1Nihtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgcmVxdWlyZSghbV9jbGFpbWluZ0lzQWN0aXZlKTsKICAgICAgICByZXF1aXJlKF9hbW91bnQgPiAwICYmIF9hbW91bnQgPCBwdWJsaWNseURpc3RyaWJ1dGVkUGFydHMoKSk7CgogICAgICAgIC8vIHJlY29yZCBuZXcgaG9sZGVyIHRvIGF1eGlsaWFyeSBzdHJ1Y3R1cmUKICAgICAgICBpZiAoMCA9PSBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgICAgIG1faG9sZGVycy5wdXNoKF90byk7CiAgICAgICAgfQoKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CgogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksIF90bywgX2Ftb3VudCk7CiAgICAgICAgTWludChfdG8sIF9hbW91bnQpOwoKICAgICAgICBhc3NlcnQocHVibGljbHlEaXN0cmlidXRlZFBhcnRzKCkgPiAwKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBnZXQgYXBwcm9wcmlhdGUgYW1vdW50IG9mIFNNUiBmb3IgbXNnLnNlbmRlciBhY2NvdW50CiAgICBmdW5jdGlvbiBjbGFpbVNNUigpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBjbGFpbVNNUkZvcihtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBpdGVyYXRpdmVseSBkaXN0cmlidXRlcyBTTVIgYWNjb3JkaW5nIHRvIFNNUkUgcG9zc2Vzc2lvbiB0byBhbGwgU01SRSBob2xkZXJzIGFuZCBwb29scwogICAgZnVuY3Rpb24gY2xhaW1TTVJmb3JBbGwodWludCBpbnZvY2F0aW9uc0xpbWl0KQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgcmVxdWlyZSh1bmNsYWltZWRQb29sc1ByZXNlbnQoKSk7CgogICAgICAgIHVpbnQgaW52b2NhdGlvbnMgPSAwOwogICAgICAgIHVpbnQgbWF4R2FzUGVySW52b2NhdGlvbiA9IDA7CiAgICAgICAgd2hpbGUgKHVuY2xhaW1lZFBvb2xzUHJlc2VudCgpICYmICsraW52b2NhdGlvbnMgPD0gaW52b2NhdGlvbnNMaW1pdCkgewogICAgICAgICAgICB1aW50IHN0YXJ0aW5nR2FzID0gbXNnLmdhczsKCiAgICAgICAgICAgIGNsYWltU01SRm9yKG1faG9sZGVyc1ttX3VuY2xhaW1lZEhvbGRlcklkeCsrXSk7CgogICAgICAgICAgICB1aW50IGdhc1Blckludm9jYXRpb24gPSBzdGFydGluZ0dhcy5zdWIobXNnLmdhcyk7CiAgICAgICAgICAgIGlmIChnYXNQZXJJbnZvY2F0aW9uID4gbWF4R2FzUGVySW52b2NhdGlvbikgewogICAgICAgICAgICAgICAgbWF4R2FzUGVySW52b2NhdGlvbiA9IGdhc1Blckludm9jYXRpb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1heEdhc1Blckludm9jYXRpb24uYWRkKDcwMDAwKSA+IG1zZy5nYXMpIHsKICAgICAgICAgICAgICAgIGJyZWFrOyAgLy8gZW5vdWdoIGludm9jYXRpb25zIGZvciB0aGlzIGNhbGwKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCEgdW5jbGFpbWVkUG9vbHNQcmVzZW50KCkpIHsKICAgICAgICAgICAgLy8gYWxsIHRva2VucyBjbGFpbWVkIC0gZGV0YWNoaW5nCiAgICAgICAgICAgIElEZXRhY2hhYmxlKG1fU01STWludGVyKS5kZXRhY2goKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8vIFZJRVdTCgogICAgLy8vIEBkZXYgYW1vdW50IG9mIG5vbi1kaXN0cmlidXRlZCBTTVJFCiAgICBmdW5jdGlvbiBwdWJsaWNseURpc3RyaWJ1dGVkUGFydHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG1heFN1cHBseS5zdWIodG90YWxTdXBwbHkpOwogICAgfQoKICAgIC8vLyBAZGV2IGFyZSB0aGVyZSBwYXJ0aWVzIHdoaWNoIHN0aWxsIGhhdmUndCByZWNlaXZlZCB0aGVpciBTTVI/CiAgICBmdW5jdGlvbiB1bmNsYWltZWRQb29sc1ByZXNlbnQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1fdW5jbGFpbWVkSG9sZGVySWR4IDwgbV9ob2xkZXJzLmxlbmd0aDsKICAgIH0KCgogICAgLyoKICAgICAqIFBVQkxJQyBGVU5DVElPTlM6IEVSQzIwCiAgICAgKgogICAgICogU01SRSB0b2tlbnMgYXJlIG5vdCB0cmFuc2ZlcmFibGUuIEVSQzIwIGhlcmUgaXMgZm9yIGNvbnZlbmllbmNlIC0gdG8gc2VlIGJhbGFuY2UgaW4gYSB3YWxsZXQuCiAgICAgKi8KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIC8qIHRvICovLCB1aW50MjU2IC8qIHZhbHVlICovKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldmVydCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIC8qIG93bmVyICovLCBhZGRyZXNzIC8qIHNwZW5kZXIgKi8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIC8qIGZyb20gKi8sIGFkZHJlc3MgLyogdG8gKi8sIHVpbnQyNTYgLyogdmFsdWUgKi8pIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIC8qIHNwZW5kZXIgKi8sIHVpbnQyNTYgLyogdmFsdWUgKi8pIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CgoKICAgIC8vIElOVEVSTkFMCgogICAgLy8vIEBkZXYgbWludCBTTVIgdG9rZW5zIGZvciBTTVJFIGhvbGRlcgogICAgZnVuY3Rpb24gY2xhaW1TTVJGb3IoYWRkcmVzcyBfZm9yKQogICAgICAgIHByaXZhdGUKICAgIHsKICAgICAgICBhc3NlcnQoX2ZvciAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgcmVxdWlyZSgwICE9IGJhbGFuY2VzW19mb3JdKTsKICAgICAgICBpZiAobV90b2tlbnNDbGFpbWVkW19mb3JdKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIG1fdG9rZW5zQ2xhaW1lZFtfZm9yXSA9IHRydWU7CgogICAgICAgIHVpbnQgcGFydCA9IGJhbGFuY2VzW19mb3JdOwogICAgICAgIHVpbnQgcGFydE9mRW1pc3Npb25Gb3JQdWJsaWNTYWxlcyA9IHB1YmxpY2x5RGlzdHJpYnV0ZWRQYXJ0cygpOwoKICAgICAgICAvLyBJZiBpdCdzIHRvbyBlYXJseSAobm90IGFuIGFwcHJvcHJpYXRlIFNNUiBsaWZlY3ljbGUgc3RhZ2UsIHNlZSBTbWFydHpUb2tlbkxpZmVjeWNsZU1hbmFnZXIpLAogICAgICAgIC8vIG1fU01STWludGVyIHdpbGwgcmV2ZXJ0KCkgYW5kIGFsbCBjaGFuZ2VzIHRvIHRoZSBzdGF0ZSBvZiB0aGlzIGNvbnRyYWN0IHdpbGwgYmUgcm9sbGVkIGJhY2suCiAgICAgICAgSUVtaXNzaW9uUGFydE1pbnRlcihtX1NNUk1pbnRlcikubWludFBhcnRPZkVtaXNzaW9uKF9mb3IsIHBhcnQsIHBhcnRPZkVtaXNzaW9uRm9yUHVibGljU2FsZXMpOwoKICAgICAgICBpZiAoISBtX2NsYWltaW5nSXNBY3RpdmUpIHsKICAgICAgICAgICAgbV9jbGFpbWluZ0lzQWN0aXZlID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIENsYWltZWQoX2ZvciwgcGFydCk7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAZGV2IElEZXRhY2hhYmxlIElFbWlzc2lvblBhcnRNaW50ZXIKICAgIGFkZHJlc3MgcHVibGljIG1fU01STWludGVyOwoKICAgIC8vLyBAZGV2IGxpc3Qgb2YgYWxsIFNNUkUgaG9sZGVycwogICAgYWRkcmVzc1tdIHB1YmxpYyBtX2hvbGRlcnM7CgogICAgLy8vIEBkZXYgaW5kZXggaW4gbV9ob2xkZXJzIHdoaWNoIGlzIHNjaGVkdWxlZCBuZXh0IGZvciBTTVJFLT5TTVIgY29udmVyc2lvbgogICAgdWludCBwdWJsaWMgbV91bmNsYWltZWRIb2xkZXJJZHg7CgogICAgLy8vIEBkZXYga2VlcHMgdHJhY2sgb2YgcG9vbCB3aGljaCBjbGFpbWVkIHRoZWlyIFNNUgogICAgLy8vIEFzIHRoZXkgY291bGQgZG8gaXQgbWFudWFsbHksIG91dC1vZi1vcmRlciwgbV91bmNsYWltZWRIb2xkZXJJZHggaXMgbm90IGVub3VnaC4KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbV90b2tlbnNDbGFpbWVkOwoKICAgIC8vLyBAZGV2IHRydWUgaWZmIFNNUkUtPlNNUiBjb252ZXJzaW9uIGlzIGFjdGl2ZSBhbmQgU01SRSB3aWxsIG5vIGxvbmdlciBiZSBtaW50ZWQKICAgIGJvb2wgcHVibGljIG1fY2xhaW1pbmdJc0FjdGl2ZSA9IGZhbHNlOwoKCiAgICAvLyBDT05TVEFOVFMKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiUGFydCBvZiBTbWFydHogdG9rZW4gZW1pc3Npb24iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiU01SRSI7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAyOwoKICAgIC8vIEBub3RpY2UgbWF4aW11bSBhbW91bnQgb2YgU01SRSB0byBiZSBhbGxvY2F0ZWQsIGluIHNtYWxsZXN0IHVuaXRzICgxLzEwMCBvZiBwZXJjZW50KQogICAgdWludCBwdWJsaWMgY29uc3RhbnQgbWF4U3VwcGx5ID0gdWludCgxMDApICogKHVpbnQoMTApICoqIHVpbnQoZGVjaW1hbHMpKTsKfQ=='.
	

]
