Class {
	#name : #SRTa17f2bc6b11b4dd60ab38c94e7784634646749c9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa17f2bc6b11b4dd60ab38c94e7784634646749c9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgLyoqCiAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLy8vIEB0aXRsZSBCYXNlIFRva2VuIGNvbnRyYWN0IC0gRnVuY3Rpb25zIHRvIGJlIGltcGxlbWVudGVkIGJ5IHRva2VuIGNvbnRyYWN0cy4KY29udHJhY3QgVG9rZW4gewogICAgLyoKICAgICAqIEltcGxlbWVudHMgRVJDIDIwIHN0YW5kYXJkLgogICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvYmxvYi9mOTA4NjRhM2QyYjJiNDVjNGRlY2Y5NWVmZDI2YjNmMGMyNzYwNTFhL0VJUFMvZWlwLTIwLXRva2VuLXN0YW5kYXJkLm1kCiAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICAgICAqCiAgICAgKiAgQWRkZWQgc3VwcG9ydCBmb3IgdGhlIEVSQyAyMjMgInRva2VuRmFsbGJhY2siIG1ldGhvZCBpbiBhICJ0cmFuc2ZlciIgZnVuY3Rpb24gd2l0aCBhIHBheWxvYWQuCiAgICAgKiAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIyMwogICAgICovCgogICAgLyoKICAgICAqIEVSQyAyMAogICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CiAgICBmdW5jdGlvbiBidXJuKHVpbnQgbnVtKSBwdWJsaWM7CgogICAgLyoKICAgICAqIEVSQyAyMjMKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoKICAgICAqIEV2ZW50cwogICAgICovCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgX2J1cm5lciwgdWludCBfdmFsdWUpOwoKICAgIC8vIFRoZXJlIGlzIG5vIEVSQzIyMyBjb21wYXRpYmxlIFRyYW5zZmVyIGV2ZW50LCB3aXRoIGBfZGF0YWAgaW5jbHVkZWQuCn0KCi8vIDxPUkFDTElaRV9BUEk+Ci8qCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTApDb3B5cmlnaHQgKGMpIDIwMTYgT3JhY2xpemUgTFRECgoKClBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwp0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKCgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOClRIRSBTT0ZUV0FSRS4KKi8KCi8vIFRoaXMgYXBpIGlzIGN1cnJlbnRseSB0YXJnZXRlZCBhdCAwLjQuMTgsIHBsZWFzZSBpbXBvcnQgb3JhY2xpemVBUElfcHJlMC40LnNvbCBvciBvcmFjbGl6ZUFQSV8wLjQgd2hlcmUgbmVjZXNzYXJ5CnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTikgcHVibGljIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04sIHVpbnQgX2dhc2xpbWl0KSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcHVibGljIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBwdWJsaWMgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhieXRlczMyKTsKfQpjb250cmFjdCBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgewogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHB1YmxpYyByZXR1cm5zIChhZGRyZXNzIF9hZGRyKTsKfQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsKICAgIHVpbnQgY29uc3RhbnQgZGF5ID0gNjAqNjAqMjQ7CiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3OwogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfQW5kcm9pZCA9IDB4MjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9MZWRnZXIgPSAweDMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTmF0aXZlID0gMHhGMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZTdG9yYWdlX0lQRlMgPSAweDAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21haW5uZXQgPSAxOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX3Rlc3RuZXQgPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfY29uc2Vuc3lzID0gMTYxOwoKICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7CgogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKChhZGRyZXNzKE9BUik9PTApfHwoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKT09MCkpCiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOwoKICAgICAgICBpZihhZGRyZXNzKG9yYWNsaXplKSAhPSBPQVIuZ2V0QWRkcmVzcygpKQogICAgICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKCiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgcmV0dXJuIG9yYWNsaXplX3NldE5ldHdvcmsoKTsKICAgICAgbmV0d29ya0lEOyAvLyBzaWxlbmNlIHRoZSB3YXJuaW5nIGFuZCByZW1haW4gYmFja3dhcmRzIGNvbXBhdGlibGUKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsoKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpewogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpPjApeyAvL21haW5uZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfbWFpbm5ldCIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk+MCl7IC8vcm9wc3RlbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JvcHN0ZW4zIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKT4wKXsgLy9rb3ZhbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX2tvdmFuIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KT4wKXsgLy9yaW5rZWJ5IHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcmlua2VieSIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk+MCl7IC8vZXRoZXJldW0tYnJpZGdlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik+MCl7IC8vZXRoZXIuY2FtcCBpZGUKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSBwdWJsaWMgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSBwdWJsaWMgewogICAgICByZXR1cm47CiAgICAgIG15aWQ7IHJlc3VsdDsgcHJvb2Y7IC8vIFNpbGVuY2UgY29tcGlsZXIgd2FybmluZ3MKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2NiQWRkcmVzcygpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5jYkFkZHJlc3MoKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldFByb29mKGJ5dGUgcHJvb2ZQKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldFByb29mVHlwZShwcm9vZlApOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UodWludCBnYXNQcmljZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUucmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9zaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZUFkZHIoc3RyaW5nIF9hKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoX2IpOwogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7CiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkgKyspCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgZWxzZSBpZiAoYVtpXSA+IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgaCA9IGJ5dGVzKF9oYXlzdGFjayk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG4gPSBieXRlcyhfbmVlZGxlKTsKICAgICAgICBpZihoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgc3ViaW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoLmxlbmd0aDsgaSArKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGhbaV0gPT0gblswXSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUoc3ViaW5kZXggPCBuLmxlbmd0aCAmJiAoaSArIHN1YmluZGV4KSA8IGgubGVuZ3RoICYmIGhbaSArIHN1YmluZGV4XSA9PSBuW3N1YmluZGV4XSkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHN1YmluZGV4ID09IG4ubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW50KGkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsKICAgICAgICAgICAgICAgIGlmIChkZWNpbWFscyl7CiAgICAgICAgICAgICAgICAgICBpZiAoX2IgPT0gMCkgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBfYi0tOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWludCAqPSAxMDsKICAgICAgICAgICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4OwogICAgICAgICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKF9iID4gMCkgbWludCAqPSAxMCoqX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJhMmNib3Ioc3RyaW5nW10gYXJyKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgogICAgZnVuY3Rpb24gYmEyY2JvcihieXRlc1tdIGFycikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKCiAgICBzdHJpbmcgb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29ya05hbWUoc3RyaW5nIF9uZXR3b3JrX25hbWUpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9uZXR3b3JrX25hbWUgPSBfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkodWludCBfZGVsYXksIHVpbnQgX25ieXRlcywgdWludCBfY3VzdG9tR2FzTGltaXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJlcXVpcmUoKF9uYnl0ZXMgPiAwKSAmJiAoX25ieXRlcyA8PSAzMikpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBuYnl0ZXMgPSBuZXcgYnl0ZXMoMSk7CiAgICAgICAgbmJ5dGVzWzBdID0gYnl0ZShfbmJ5dGVzKTsKICAgICAgICBieXRlcyBtZW1vcnkgdW5vbmNlID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvbktleUhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzMzIgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMiA9IG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBtc3RvcmUodW5vbmNlLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHVub25jZSwgMHgyMCksIHhvcihibG9ja2hhc2goc3ViKG51bWJlciwgMSkpLCB4b3IoY29pbmJhc2UsIHRpbWVzdGFtcCkpKQogICAgICAgICAgICBtc3RvcmUoc2Vzc2lvbktleUhhc2gsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2Vzc2lvbktleUhhc2gsIDB4MjApLCBzZXNzaW9uS2V5SGFzaF9ieXRlczMyKQogICAgICAgIH0KICAgICAgICBieXRlc1szXSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2hdOwogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KF9kZWxheSwgInJhbmRvbSIsIGFyZ3MsIF9jdXN0b21HYXNMaW1pdCk7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBrZWNjYWsyNTYoYnl0ZXM4KF9kZWxheSksIGFyZ3NbMV0sIHNoYTI1NihhcmdzWzBdKSwgYXJnc1syXSkpOwogICAgICAgIHJldHVybiBxdWVyeUlkOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQoYnl0ZXMzMiBxdWVyeUlkLCBieXRlczMyIGNvbW1pdG1lbnQpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID0gY29tbWl0bWVudDsKICAgIH0KCiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJ5dGVzMzIpIG9yYWNsaXplX3JhbmRvbURTX2FyZ3M7CiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJvb2wpIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkOwoKICAgIGZ1bmN0aW9uIHZlcmlmeVNpZyhieXRlczMyIHRvc2lnbmgsIGJ5dGVzIGRlcnNpZywgYnl0ZXMgcHVia2V5KSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIHNpZ29rOwogICAgICAgIGFkZHJlc3Mgc2lnbmVyOwoKICAgICAgICBieXRlczMyIHNpZ3I7CiAgICAgICAgYnl0ZXMzMiBzaWdzOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lncl8gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIHVpbnQgb2Zmc2V0ID0gNCsodWludChkZXJzaWdbM10pIC0gMHgyMCk7CiAgICAgICAgc2lncl8gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQsIDMyLCBzaWdyXywgMCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3NfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBvZmZzZXQgKz0gMzIgKyAyOwogICAgICAgIHNpZ3NfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0Kyh1aW50KGRlcnNpZ1tvZmZzZXQtMV0pIC0gMHgyMCksIDMyLCBzaWdzXywgMCk7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2lnciA6PSBtbG9hZChhZGQoc2lncl8sIDMyKSkKICAgICAgICAgICAgc2lncyA6PSBtbG9hZChhZGQoc2lnc18sIDMyKSkKICAgICAgICB9CgoKICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjcsIHNpZ3IsIHNpZ3MpOwogICAgICAgIGlmIChhZGRyZXNzKGtlY2NhazI1NihwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjgsIHNpZ3IsIHNpZ3MpOwogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moa2VjY2FrMjU2KHB1YmtleSkpID09IHNpZ25lcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkoYnl0ZXMgcHJvb2YsIHVpbnQgc2lnMm9mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc2lnb2s7CgogICAgICAgIC8vIFN0ZXAgNjogdmVyaWZ5IHRoZSBhdHRlc3RhdGlvbiBzaWduYXR1cmUsIEFQUEtFWTEgbXVzdCBzaWduIHRoZSBzZXNzaW9uS2V5IGZyb20gdGhlIGNvcnJlY3QgbGVkZ2VyIGFwcCAoQ09ERUhBU0gpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzIgPSBuZXcgYnl0ZXModWludChwcm9vZltzaWcyb2Zmc2V0KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQsIHNpZzIubGVuZ3RoLCBzaWcyLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFwcGtleTFfcHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrMSwgNjQsIGFwcGtleTFfcHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSs2NSszMik7CiAgICAgICAgdG9zaWduMlswXSA9IGJ5dGUoMSk7IC8vcm9sZQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NSwgNjUsIHRvc2lnbjIsIDEpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsKICAgICAgICBjb3B5Qnl0ZXMoQ09ERUhBU0gsIDAsIDMyLCB0b3NpZ24yLCAxKzY1KTsKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMiksIHNpZzIsIGFwcGtleTFfcHVia2V5KTsKCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpCiAgICAgICAgYnl0ZXMgbWVtb3J5IExFREdFUktFWSA9IGhleCI3ZmI5NTY0NjljNWM5Yjg5ODQwZDU1YjQzNTM3ZTY2YTk4ZGQ0ODExZWEwYTI3MjI0MjcyYzJlNTYyMjkxMWU4NTM3YTJmOGU4NmE0NmJhZWM4Mjg2NGU5OGRkMDFlOWNjYzJmOGJjNWRmYzljYmU1YTkxYTI5MDQ5OGRkOTZlNCI7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDErNjUpOwogICAgICAgIHRvc2lnbjNbMF0gPSAweEZFOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMywgNjUsIHRvc2lnbjMsIDEpOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMyA9IG5ldyBieXRlcyh1aW50KHByb29mWzMrNjUrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMys2NSwgc2lnMy5sZW5ndGgsIHNpZzMsIDApOwoKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMyksIHNpZzMsIExFREdFUktFWSk7CgogICAgICAgIHJldHVybiBzaWdvazsKICAgIH0KCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICByZXF1aXJlKChfcHJvb2ZbMF0gPT0gIkwiKSAmJiAoX3Byb29mWzFdID09ICJQIikgJiYgKF9wcm9vZlsyXSA9PSAxKSk7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICByZXF1aXJlKHByb29mVmVyaWZpZWQpOwoKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19yZXR1cm5Db2RlKGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIGludGVybmFsIHJldHVybnMgKHVpbnQ4KXsKICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQogICAgICAgIGlmICgoX3Byb29mWzBdICE9ICJMIil8fChfcHJvb2ZbMV0gIT0gIlAiKXx8KF9wcm9vZlsyXSAhPSAxKSkgcmV0dXJuIDE7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgcmV0dXJuIDI7CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoQnl0ZXMzMlByZWZpeChieXRlczMyIGNvbnRlbnQsIGJ5dGVzIHByZWZpeCwgdWludCBuX3JhbmRvbV9ieXRlcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIG1hdGNoXyA9IHRydWU7CiAgICAgICAgCgogICAgICAgIGZvciAodWludDI1NiBpPTA7IGk8IG5fcmFuZG9tX2J5dGVzOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbnRlbnRbaV0gIT0gcHJlZml4W2ldKSBtYXRjaF8gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMys2NSsodWludChwcm9vZlszKzY1KzFdKSsyKSszMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGlmICghKGtlY2NhazI1NihrZXloYXNoKSA9PSBrZWNjYWsyNTYoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpKzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CgogICAgICAgIC8vIFN0ZXAgMzogd2UgYXNzdW1lIHNpZzEgaXMgdmFsaWQgKGl0IHdpbGwgYmUgdmVyaWZpZWQgZHVyaW5nIHN0ZXAgNSkgYW5kIHdlIHZlcmlmeSBpZiAncmVzdWx0JyBpcyB0aGUgcHJlZml4IG9mIHNoYTI1NihzaWcxKQogICAgICAgIGlmICghbWF0Y2hCeXRlczMyUHJlZml4KHNoYTI1NihzaWcxKSwgcmVzdWx0LCB1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKzMyKzhdKSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gU3RlcCA0OiBjb21taXRtZW50IG1hdGNoIHZlcmlmaWNhdGlvbiwga2VjY2FrMjU2KGRlbGF5LCBuYnl0ZXMsIHVub25jZSwgc2Vzc2lvbktleUhhc2gpID09IGNvbW1pdG1lbnQgaW4gc3RvcmFnZS4KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4KICAgICAgICBieXRlcyBtZW1vcnkgY29tbWl0bWVudFNsaWNlMSA9IG5ldyBieXRlcyg4KzErMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrMzIsIDgrMSszMiwgY29tbWl0bWVudFNsaWNlMSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uUHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICB1aW50IHNpZzJvZmZzZXQgPSBsZWRnZXJQcm9vZkxlbmd0aCszMisoOCsxKzMyKStzaWcxLmxlbmd0aCs2NTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjQsIDY0LCBzZXNzaW9uUHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uUHVia2V5SGFzaCA9IHNoYTI1NihzZXNzaW9uUHVia2V5KTsKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9PSBrZWNjYWsyNTYoY29tbWl0bWVudFNsaWNlMSwgc2Vzc2lvblB1YmtleUhhc2gpKXsgLy91bm9uY2UsIG5ieXRlcyBhbmQgc2Vzc2lvbktleUhhc2ggbWF0Y2gKICAgICAgICAgICAgZGVsZXRlIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF07CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIrOCsxKzMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBpZiAoIXZlcmlmeVNpZyhzaGEyNTYodG9zaWduMSksIHNpZzEsIHNlc3Npb25QdWJrZXkpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIHZlcmlmeSBpZiBzZXNzaW9uUHVia2V5SGFzaCB3YXMgdmVyaWZpZWQgYWxyZWFkeSwgaWYgbm90Li4gbGV0J3MgZG8gaXQhCiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9PSBmYWxzZSl7CiAgICAgICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkocHJvb2YsIHNpZzJvZmZzZXQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXTsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gY29weUJ5dGVzKGJ5dGVzIGZyb20sIHVpbnQgZnJvbU9mZnNldCwgdWludCBsZW5ndGgsIGJ5dGVzIHRvLCB1aW50IHRvT2Zmc2V0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbAogICAgICAgIHJlcXVpcmUodG8ubGVuZ3RoID49IG1pbkxlbmd0aCk7IC8vIFNob3VsZCBiZSBhIGJldHRlciB3YXk/CgogICAgICAgIC8vIE5PVEU6IHRoZSBvZmZzZXQgMzIgaXMgYWRkZWQgdG8gc2tpcCB0aGUgYHNpemVgIGZpZWxkIG9mIGJvdGggYnl0ZXMgdmFyaWFibGVzCiAgICAgICAgdWludCBpID0gMzIgKyBmcm9tT2Zmc2V0OwogICAgICAgIHVpbnQgaiA9IDMyICsgdG9PZmZzZXQ7CgogICAgICAgIHdoaWxlIChpIDwgKDMyICsgZnJvbU9mZnNldCArIGxlbmd0aCkpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IHRtcCA6PSBtbG9hZChhZGQoZnJvbSwgaSkpCiAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRvLCBqKSwgdG1wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMzI7CiAgICAgICAgICAgIGogKz0gMzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzaXplIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA2NCksIHIpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUKICAgICAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBlY3JlY292ZXJ5KGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkKICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQoKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuCiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vICdtbG9hZDgnIHRvIGRvIHRoaXMsIGJ1dCB0aGF0IHdvdWxkIGJlIG5pY2VyLgogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKCiAgICAgICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOgogICAgICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMKICAgICAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnCiAgICAgICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkKICAgICAgICB9CgogICAgICAgIC8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAogICAgICAgIC8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQogICAgICAgIC8vCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwogICAgICAgIGlmICh2IDwgMjcpCiAgICAgICAgICB2ICs9IDI3OwoKICAgICAgICBpZiAodiAhPSAyNyAmJiB2ICE9IDI4KQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKICAgIH0KCn0KLy8gPC9PUkFDTElaRV9BUEk+CgovKioKICogQHRpdGxlIHByZS1pY28KICogQGRldiBwcmUtaWNvIGlzIGEgYmFzZSBjb250cmFjdCBmb3IgbWFuYWdpbmcgYSB0b2tlbiBjcm93ZHNhbGUuCiAqIENyb3dkc2FsZXMKICovCmNvbnRyYWN0IFByZUljbyBpcyB1c2luZ09yYWNsaXplIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgLyoqCiAgICogU2VjdGlvbiAxCiAgICogLSBWYXJpYWJsZXMKICAgKi8KICAvKiBTZWN0aW9uIDEuMSBjcm93ZHNhbGUga2V5IHZhcmlhYmxlcyAqLwogIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgVG9rZW4gcHVibGljIHRva2VuOwoKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lOwoKICAvLyBhZGRyZXNzIHdoZXJlIEVUSCBmdW5kcyBhcmUgc2VudAogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgLy8gb3duZXIgb2YgdGhpcyBjb250cmFjdAogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIC8vIEhvdyBtYW55IFBISSB0b2tlbnMgdG8gc2VsbCAoaW4gc3BoaSkKICB1aW50MjU2IHB1YmxpYyBNQVhfVE9LRU5TID0gMzUyNDU3OCAqIDEwKioxODsKICAvLyBLZWVwIHRyYWNrIG9mIHNvbGQgdG9rZW5zCiAgdWludDI1NiBwdWJsaWMgdG9rZW5zU29sZCA9IDA7CiAgLy8gS2VlcCB0cmFjayBvZiB0b2tlbnMgc2VudCB0byB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMKICB1aW50MjU2IHB1YmxpYyB0b2tlbnNGaW5hbGl6ZWQgPSAwOwogIC8vIEtlZXAgdHJhY2sgb2YgZW5hYmxlZCBhZGRyZXNzZXMKICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHJlc2VydmF0aW9uQ29udHJhY3RzOwoKICAvKiBTZWN0aW9uIDEuMiByYXRlL3ByaWNlIHZhcmlhYmxlcyAqLwogIC8vIEVUSC9VU0QgcmF0ZQogIHVpbnQyNTYgcHVibGljIGV0aFVzZDsKICAvKioKICAgICogUGhpIHJhdGUgaW4gVVNEIG11bHRpcGxpZWQgYnkgMTAqKjE4CiAgICAqIGJlY2F1c2Ugb2YgU29saWRpdHkgZmxvYXQgbGltaXRhdGlvbnMsCiAgICAqIHNlZSBodHRwOi8vc29saWRpdHkucmVhZHRoZWRvY3MuaW8vZW4vdjAuNC4xOS90eXBlcy5odG1sP2hpZ2hsaWdodD1GaXhlZCUyMFBvaW50JTIwTnVtYmVycyNmaXhlZC1wb2ludC1udW1iZXJzCiAgICAqLwogIHVpbnQyNTYgcHVibGljIHBoaVJhdGUgPSAxMjc4MjQ2ODUyMTAwMDAwMDAwOyAvLyBwcmUtaWNvIGZpeGVkIHByaWNlICgxLDYxODAzMzk5ICogMjElKSAqIDEwKioxOAoKICAvKiBTZWN0aW9uIDEuMyBvcmFjbGUgcmVsYXRlZCB2YXJpYWJsZXMgKi8KICAvLyBrZWVwIHRyYWNrIG9mIHRoZSBsYXN0IEVUSC9VU0QgdXBkYXRlCiAgdWludDI1NiBwdWJsaWMgbGFzdE9yYWNsZVVwZGF0ZTsKICAvLyBzZXQgZGVmYXVsdCBFVEgvVVNEIHVwZGF0ZSBpbnRlcnZhbCAoaW4gc2Vjb25kcykKICB1aW50MjU2IHB1YmxpYyBpbnRlcnZhbFVwZGF0ZTsKICAvLyBjdXN0b20gb3JhY2xpemVfcXVlcnkgZ2FzIGNvc3QgKHdlaSksIGV4cGVjdGVkIGdhcyB1c2FnZSBpcyB+MTEwawogIHVpbnQyNTYgcHVibGljIE9SQUNMSVpFX0dBU19MSU1JVCA9IDE0NTAwMDsKCiAgLyogU2VjdGlvbiAxLjQgdmFyaWFibGVzIHRvIGtlZXAgS1lDIGFuZCBiYWxhbmNlIHN0YXRlICovCiAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CiAgLy8ga2VlcCB0cmFjayBvZiBhZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBrZWVwIHRva2VucwogIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNXaGl0ZWxpc3RlZDsKICAvLyBrZWVwIHRyYWNrIG9mIGludmVzdG9ycyAodG9rZW4gYmFsYW5jZSkKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VzVG9rZW47CiAgLy8ga2VlcCB0cmFjayBvZiBpbnZlc3RlZCBhbW91bnQgKHdlaSBiYWxhbmNlKQogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZXNXZWk7CgogIC8qKgogICAqIFNlY3Rpb24gMgogICAqIC0gRW51bXMKICAgKi8KICAvLyBEZXNjcmliZXMgY3VycmVudCBjcm93ZHNhbGUgc3RhZ2UKICBlbnVtIFN0YWdlCiAgewogICAgVG9Jbml0aWFsaXplLCAvLyBbMF0gcHJlLWljbyBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQKICAgIFdhaXRpbmcsICAgICAgLy8gWzFdIHByZS1pY28gaXMgd2FpdGluZyBzdGFydCB0aW1lCiAgICBSdW5uaW5nLCAgICAgIC8vIFsyXSBwcmUtaWNvIGlzIHJ1bm5pbmcgKGJldHdlZW4gc3RhcnQgdGltZSBhbmQgZW5kIHRpbWUpCiAgICBQYXVzZWQsICAgICAgIC8vIFszXSBwcmUtaWNvIGhhcyBiZWVuIHBhdXNlZAogICAgRmluaXNoZWQsICAgICAvLyBbNF0gcHJlLWljbyBoYXMgYmVlbiBmaW5pc2hlZCAoYnV0IG5vdCBmaW5hbGl6ZWQpCiAgICBGaW5hbGl6ZWQgICAgIC8vIFs1XSBwcmUtaWNvIGhhcyBiZWVuIGZpbmFsaXplZAogIH0KICBTdGFnZSBwdWJsaWMgY3VycmVudFN0YWdlID0gU3RhZ2UuVG9Jbml0aWFsaXplOwoKICAvKioKICAgKiBTZWN0aW9uIDMKICAgKiAtIEV2ZW50cwogICAqLwogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKICAvKioKICAgKiBldmVudCB0byBlbWl0IHdoZW4gYSBuZXcgcmF0ZSBpcyByZWNlaXZlZCBmcm9tIE9yYWNsaXplCiAgICogQHBhcmFtIG5ld1JhdGUgUmF0ZSByZWNlaXZlZCBpbiBXRUkKICAgKiBAcGFyYW0gdGltZVJlY3YgV2hlbiB0aGUgcmF0ZSB3YXMgcmVjZWl2ZWQKICAgKi8KICBldmVudCBMb2dSYXRlVXBkYXRlKHVpbnQgbmV3UmF0ZSwgdWludCB0aW1lUmVjdik7CgogIC8qKgogICAqIGV2ZW50IHRvIGVtaXQgaW4gY2FzZSB0aGUgY29udHJhY3QgbmVlZHMgYmFsYW5jZSAoZm9yIE9yYWNsaXplIHF1ZXJpZXMpCiAgICovCiAgZXZlbnQgTG9nQmFsYW5jZVJlcXVpcmVkKCk7CgogIC8qKgogICAqIGV2ZW50IHRvIG5vdGlmeSBpbml0aWFsaXplCiAgICovCiAgIGV2ZW50IExvZ0Nyb3dkc2FsZUluaXQoKTsKCiAgLyoqCiAgICogU2VjdGlvbiA0CiAgICogLSBNb2RpZmllcnMKICAgKi8KICAvKgogICAgQ2hlY2sgaWYgYSBwdXJjaGFzZSBjYW4gYmUgbWFkZSwgY2hlY2sgc3RhcnRUaW1lLCBlbmRUaW1lCiAgICBhbmQgdXBkYXRlIFN0YWdlIGlmIHNvCiAgKi8KICBtb2RpZmllciB2YWxpZFB1cmNoYXNlIHsKICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCAmJiB3aXRoaW5QZXJpb2QgJiYgc3RhcnRUaW1lICE9IDApOwogICAgLyoKICAgICAgVXBkYXRlIGN1cnJlbnQgc3RhZ2Ugb25seSBpZiB0aGUgcHJldmlvdXMgc3RhZ2UgaXMgYFdhaXRpbmdgCiAgICAgIGFuZCB3ZSBhcmUgd2l0aGluIHRoZSBjcm93ZHNhbGUgcGVyaW9kLCB1c2VkIHRvIGF1dG9tYXRpY2FsbHkKICAgICAgdXBkYXRlIHRoZSBzdGFnZSBieSBhbiBpbnZlc3RvcgogICAgKi8KICAgIGlmICh3aXRoaW5QZXJpb2QgPT0gdHJ1ZSAmJiBjdXJyZW50U3RhZ2UgPT0gU3RhZ2UuV2FpdGluZykgewogICAgICBjdXJyZW50U3RhZ2UgPSBTdGFnZS5SdW5uaW5nOwogICAgfQogICAgXzsKICB9CiAgLy8gQWxsb3cgb25seSB0aGUgb3duZXIgb2YgdGhpcyBjb250cmFjdAogIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIC8vIEFsbG93IG9ubHkgaWYgaXMgY2xvc2UgdG8gc3RhcnQgdGltZSBvciBpZiBpcyBpdCBydW5uaW5nCiAgbW9kaWZpZXIgY2xvc2VPckR1cmluZ0Nyb3dkc2FsZSB7CiAgICByZXF1aXJlKG5vdyA+PSBzdGFydFRpbWUgLSBpbnRlcnZhbFVwZGF0ZSk7CiAgICByZXF1aXJlKGN1cnJlbnRTdGFnZSA9PSBTdGFnZS5SdW5uaW5nIHx8IGN1cnJlbnRTdGFnZSA9PSBTdGFnZS5XYWl0aW5nKTsKICAgIF87CiAgfQoKICAvLyBDaGVjayBpZiB0aGUgcHJvdmlkZWQgc3RhZ2UgaXMgdGhlIGN1cnJlbnQgb25lCiAgbW9kaWZpZXIgbXVzdEJlQXRTdGFnZSAoU3RhZ2Ugc3RhZ2VOZWVkZWQpIHsKICAgIHJlcXVpcmUoc3RhZ2VOZWVkZWQgPT0gY3VycmVudFN0YWdlKTsKICAgIF87CiAgfQoKICAvLyBBbGxvdyBvbmx5IHRvIHByb3h5IGZyb20gcmVzZXJ2YXRpb24gY29udHJhY3QKICBtb2RpZmllciBvbmx5RnJvbVJjICgpIHsKICAgIHJlcXVpcmUocmVzZXJ2YXRpb25Db250cmFjdHNbbXNnLnNlbmRlcl0gPT0gdHJ1ZSk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBDb25zdHJ1Y3RvcgogICAqIEBwYXJhbSBfd2FsbGV0IFdoZXJlIHRvIHNlbmQgRVRIIGNvbGxlY3RlZCBmcm9tIHRoZSBwcmUtaWNvCiAgICovCiAgZnVuY3Rpb24gUHJlSWNvKGFkZHJlc3MgX3dhbGxldCkgcHVibGljIHsKICAgIHJlcXVpcmUocGhpUmF0ZSA+IDAgJiYgc3RhcnRUaW1lID09IDApOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgIC8vIHVwZGF0ZSBnbG9iYWwgdmFyaWFibGUKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgY3VycmVudFN0YWdlID0gU3RhZ2UuVG9Jbml0aWFsaXplOwoKICAgIC8vIHNldCBPcmFjbGl6ZSBnYXMgcHJpY2UgKGZvciBfX2NhbGxiYWNrKQogICAgb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UoMjUwMDAwMDAwMCk7IC8vIDIuNSBnd2VpIGluc3RlYWQgb2YgMjAgZ3dlaQogIH0KCiAgLyoqCiAgICogQGRldiBVc2VkIHRvIGluaXQgY3Jvd2RzYWxlLCBzZXQgc3RhcnQtZW5kIHRpbWUsIHN0YXJ0IHVzZCByYXRlIHVwZGF0ZQogICAqIEBub3RpY2UgWW91IG11c3Qgc2VuZCBzb21lIEVUSCB0byBjb3ZlciB0aGUgb3JhY2xpemVfcXVlcnkgZmVlcwogICAqIEBwYXJhbSBfc3RhcnRUaW1lIFN0YXJ0IG9mIHRoZSBjcm93ZHNhbGUgKFVOSVggdGltZXN0YW1wKQogICAqIEBwYXJhbSBfZW5kVGltZSBFbmQgb2YgdGhlIGNyb3dkc2FsZSAoVU5JWCB0aW1lc3RhbXApCiAgICogQHBhcmFtIF90b2tlbiBBZGRyZXNzIG9mIHRoZSBQSEkgRVJDMjIzIFRva2VuCiAgICovCiAgZnVuY3Rpb24gaW5pdGlhbGl6ZUNyb3dkc2FsZSgKICAgIHVpbnQyNTYgX3N0YXJ0VGltZSwKICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICBhZGRyZXNzIF90b2tlbiwKICAgIHVpbnQyNTYgX2ludGVydmFsVXBkYXRlCiAgKQogICAgcHVibGljCiAgICBwYXlhYmxlCiAgICBvbmx5T3duZXIKICAgIG11c3RCZUF0U3RhZ2UoU3RhZ2UuVG9Jbml0aWFsaXplKQogIHsKICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA+PSBub3cpOwogICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgIHJlcXVpcmUoX3Rva2VuICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgIHJlcXVpcmUoaXNDb250cmFjdChfdG9rZW4pID09IHRydWUpOwoKICAgIC8vIGludGVydmFsIHVwZGF0ZSBtdXN0IGJlIGFib3ZlIG9yIGVxdWFsIHRvIDUgc2Vjb25kcwogICAgcmVxdWlyZShfaW50ZXJ2YWxVcGRhdGUgPj0gNSk7CgogICAgLy8gdXBkYXRlIGdsb2JhbCB2YXJpYWJsZXMKICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgICB0b2tlbiA9IFRva2VuKF90b2tlbik7CiAgICBpbnRlcnZhbFVwZGF0ZSA9IF9pbnRlcnZhbFVwZGF0ZTsKCiAgICAvLyB1cGRhdGUgc3RhZ2UKICAgIGN1cnJlbnRTdGFnZSA9IFN0YWdlLldhaXRpbmc7CgogICAgLyoKICAgICAgc3RhcnQgdG8gZmV0Y2ggRVRIL1VTRCBwcmljZSBgaW50ZXJ2YWxVcGRhdGVgIGJlZm9yZSB0aGUgYHN0YXJ0VGltZWAsCiAgICAgIDMwIHNlY29uZHMgaXMgYWRkZWQgYmVjYXVzZSBPcmFjbGl6ZSB0YWtlcyB0aW1lIHRvIGNhbGwgdGhlIF9fY2FsbGJhY2sKICAgICovCiAgICB1cGRhdGVFdGhSYXRlV2l0aERlbGF5KHN0YXJ0VGltZSAtIChpbnRlcnZhbFVwZGF0ZSArIDMwKSk7CgogICAgTG9nQ3Jvd2RzYWxlSW5pdCgpOwoKICAgIC8vIGNoZWNrIGFtb3VudCBvZiB0b2tlbnMgaGVsZCBieSB0aGlzIGNvbnRyYWN0IG1hdGNoZXMgTUFYX1RPS0VOUwogICAgYXNzZXJ0KHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSA9PSBNQVhfVE9LRU5TKTsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3cgYSBuZXcgcmVzZXJ2YXRpb24gY29udHJhY3QgdG8gaW52ZXN0IGluIHRoZSBwcmUtaWNvCiAgICogQG5vdGljZSBDYWxsIHRoaXMgYmVmb3JlIHRoZSBzdGFydFRpbWUgdG8gYXZvaWQgZGVsYXlzCiAgICogQHBhcmFtIG5ld1JjQWRkciBBZGRyZXNzIG9mIHRoZSByZXNlcnZhdGlvbiBjb250cmFjdAogICAqIHlvdSB3YW50IHRvIGVuYWJsZSAobXVzdCBiZSBhIGNvbnRyYWN0KQogICAqLwogICBmdW5jdGlvbiBhZGROZXdSZXNlcnZDb250cmFjdCAoYWRkcmVzcyBuZXdSY0FkZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShpc0NvbnRyYWN0KG5ld1JjQWRkcikgPT0gdHJ1ZSk7CiAgICByZXF1aXJlKG5ld1JjQWRkciAhPSAweDAgJiYgbmV3UmNBZGRyICE9IGFkZHJlc3ModGhpcykgJiYgbmV3UmNBZGRyICE9IGFkZHJlc3ModG9rZW4pKTsKICAgIHJlcXVpcmUocmVzZXJ2YXRpb25Db250cmFjdHNbbmV3UmNBZGRyXSA9PSBmYWxzZSk7CiAgICByZXNlcnZhdGlvbkNvbnRyYWN0c1tuZXdSY0FkZHJdID0gdHJ1ZTsKICAgfQoKICAvKioKICAgKiBAZGV2IFJlbW92ZSBhIHJlc2VydmF0aW9uIGNvbnRyYWN0CiAgICogQHBhcmFtIHRvUmVtb3ZlIEFkZHJlc3Mgb2YgdGhlIHJlc2VydmF0aW9uIGNvbnRyYWN0CiAgICogeW91IHdhbnQgdG8gcmVtb3ZlCiAgICovCiAgIGZ1bmN0aW9uIHJlbW92ZVJlc2VydkNvbnRyYWN0IChhZGRyZXNzIHRvUmVtb3ZlKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUocmVzZXJ2YXRpb25Db250cmFjdHNbdG9SZW1vdmVdID09IHRydWUpOwogICAgcmVzZXJ2YXRpb25Db250cmFjdHNbdG9SZW1vdmVdID0gZmFsc2U7CiAgIH0KCiAgLyogT3JhY2xpemUgcmVsYXRlZCBmdW5jdGlvbnMgKi8KICAvKioKICAgKiBAZGV2IENhbGxiYWNrIGZ1bmN0aW9uIHVzZWQgYnkgT3JhY2xpemUgdG8gdXBkYXRlIHRoZSBwcmljZS4KICAgKiBAbm90aWNlIEVUSC9VU0QgcmF0ZSBpcyByZWNlaXZkIGFuZCBjb252ZXJ0ZWQgdG8gd2VpLCB0aGlzCiAgICogZnVuY3Rpb25zIGlzIHVzZWQgYWxzbyB0byBhdXRvbWF0aWNhbGx5IHVwZGF0ZSB0aGUgc3RhZ2Ugc3RhdHVzCiAgICogQHBhcmFtIG15aWQgVW5pcXVlIGlkZW50aWZpZXIgZm9yIE9yYWNsaXplIHF1ZXJpZXMKICAgKiBAcGFyYW0gcmVzdWx0IFJlc3VsdCBvZiB0aGUgcmVxdWVzdGVkIHF1ZXJ5CiAgICovCiAgZnVuY3Rpb24gX19jYWxsYmFjaygKICAgIGJ5dGVzMzIgbXlpZCwKICAgIHN0cmluZyByZXN1bHQKICApIAogICAgcHVibGljCiAgICBjbG9zZU9yRHVyaW5nQ3Jvd2RzYWxlCiAgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3JhY2xpemVfY2JBZGRyZXNzKCkpIHJldmVydCgpOwogICAgLy8gcGFyc2UgdG8gaW50IGFuZCBtdWx0aXBseSBieSAxMCoqMTggdG8gYWxsb3cgbWF0aCBvcGVyYXRpb25zCiAgICB1aW50MjU2IHVzZFJhdGUgPSBwYXJzZUludChyZXN1bHQsIDE4KTsKICAgIC8vIGRvIG5vdCBhbGxvdyAwCiAgICByZXF1aXJlKHVzZFJhdGUgPiAwKTsKCiAgICBldGhVc2QgPSB1c2RSYXRlOwoKICAgIExvZ1JhdGVVcGRhdGUoZXRoVXNkLCBub3cpOwoKICAgIC8vIGNoZWNrIGlmIHRpbWUgaXMgb3ZlcgogICAgaWYgKGhhc0VuZGVkKCkgPT0gdHJ1ZSkgewogICAgICBjdXJyZW50U3RhZ2UgPSBTdGFnZS5GaW5pc2hlZDsKICAgIH0gZWxzZSB7CiAgICAgIHVwZGF0ZUV0aFJhdGUoKTsKICAgICAgbGFzdE9yYWNsZVVwZGF0ZSA9IG5vdzsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgVXBkYXRlIEVUSC9VU0QgcmF0ZSBtYW51YWxseSBpbiBjYXNlIE9yYWNsaXplIGlzIG5vdAogICAqIGNhbGxpbmcgYnkgb3VyIGNvbnRyYWN0CiAgICogQG5vdGljZSBBbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIChlLmcuIDg3MCwgOTEwKSwgdGhpcyBmdW5jdGlvbgogICAqIHdpbGwgYWxzbyBtdWx0aXBsaWNhdGUgYnkgMTAqKjE4CiAgICogQHBhcmFtIF9uZXdFdGhVc2QgTmV3IEVUSC9VU0QgcmF0ZSBpbnRlZ2VyCiAgICovCiAgZnVuY3Rpb24gdXBkYXRlRXRoVXNkTWFudWFsbHkgKHVpbnQgX25ld0V0aFVzZCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKF9uZXdFdGhVc2QgPiAwKTsKICAgIHVpbnQyNTYgbmV3UmF0ZSA9IF9uZXdFdGhVc2QubXVsKDEwKioxOCk7CiAgICByZXF1aXJlKG5ld1JhdGUgPiAwKTsKICAgIGV0aFVzZCA9IG5ld1JhdGU7CiAgfSAKCiAgLyoqCiAgICogQGRldiBVc2VkIHRvIHJlY3Vyc2l2ZWx5IGNhbGwgdGhlIG9yYWNsaXplIHF1ZXJ5IAogICAqIEBub3RpY2UgVGhpcyBmdW5jdGlvbiB3aWxsIG5vdCB0aHJvdyBpbiBjYXNlIHRoZQogICAqIGludGVydmFsIHVwZGF0ZSBpcyBleGNlZWRlZCwgaW4gdGhpcyB3YXkgdGhlIGxhdGVzdAogICAqIHVwZGF0ZSBtYWRlIHRvIHRoZSBFVEgvVVNEIHJhdGUgaXMga2VwdCAKICAgKi8KICBmdW5jdGlvbiB1cGRhdGVFdGhSYXRlICgpIGludGVybmFsIHsKICAgIC8vIHByZXZlbnQgbXVsdGlwbGUgdXBkYXRlcwogICAgaWYoaW50ZXJ2YWxVcGRhdGUgPiAobm93IC0gbGFzdE9yYWNsZVVwZGF0ZSkpIHt9CiAgICBlbHNlIHsKICAgICAgdXBkYXRlRXRoUmF0ZVdpdGhEZWxheShpbnRlcnZhbFVwZGF0ZSk7CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IENoYW5nZSBpbnRlcnZhbCB1cGRhdGUKICAgKiBAcGFyYW0gbmV3SW50ZXJ2YWwgTmV3IGludGVydmFsIHJhdGUgKGluIHNlY29uZHMpCiAgICovCiAgZnVuY3Rpb24gY2hhbmdlSW50ZXJ2YWxVcGRhdGUgKHVpbnQgbmV3SW50ZXJ2YWwpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdJbnRlcnZhbCA+PSA1KTsKICAgIGludGVydmFsVXBkYXRlID0gbmV3SW50ZXJ2YWw7CiAgfQoKICAvKioKICAgKiBAZGV2IEhlbHBlciBmdW5jdGlvbiBhcm91bmQgb3JhY2xpemVfcXVlcnkKICAgKiBAbm90aWNlIENhbGwgb3JhY2xpemVfcXVlcnkgd2l0aCBhIGRlbGF5IGluIHNlY29uZHMKICAgKiBAcGFyYW0gZGVsYXkgRGVsYXkgaW4gc2Vjb25kcyAKICAgKi8KICBmdW5jdGlvbiB1cGRhdGVFdGhSYXRlV2l0aERlbGF5ICh1aW50IGRlbGF5KSBpbnRlcm5hbCB7CiAgICAvLyBkZWxheSBjYW5ub3QgYmUgYmVsb3cgNSBzZWNvbmRzICh0b28gZmFzdCkKICAgIHJlcXVpcmUoZGVsYXkgPj0gNSk7CiAgICBpZiAob3JhY2xpemVfZ2V0UHJpY2UoIlVSTCIsIE9SQUNMSVpFX0dBU19MSU1JVCkgPiB0aGlzLmJhbGFuY2UpIHsKICAgICAgLy8gTm90aWZ5IHRoYXQgd2UgbmVlZCBhIHRvcCB1cCAKICAgICAgTG9nQmFsYW5jZVJlcXVpcmVkKCk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIEdldCBFVEgvVVNEIHJhdGUgZnJvbSBrcmFrZW4gQVBJCiAgICAgICAgb3JhY2xpemVfcXVlcnkoCiAgICAgICAgICBkZWxheSwKICAgICAgICAgICJVUkwiLAogICAgICAgICAgImpzb24oaHR0cHM6Ly9hcGkua3Jha2VuLmNvbS8wL3B1YmxpYy9UaWNrZXI/cGFpcj1FVEhVU0QpLnJlc3VsdC5YRVRIWlVTRC5jLjAiLAogICAgICAgICAgT1JBQ0xJWkVfR0FTX0xJTUlUCiAgICAgICAgKTsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3cgb3duZXIgdG8gZm9yY2UgcmF0ZSB1cGRhdGUKICAgKiBAcGFyYW0gZGVsYXkgRGVsYXkgaW4gc2Vjb25kcyBvZiBvcmFjbGl6ZV9xdWVyeSwgY2FuIGJlIHNldCB0byA1IChtaW5pbXVtKQogICAqLwogIGZ1bmN0aW9uIGZvcmNlT3JhY2xpemVVcGRhdGUgKHVpbnQyNTYgZGVsYXkpIHB1YmxpYyBvbmx5T3duZXIgewogICAgdXBkYXRlRXRoUmF0ZVdpdGhEZWxheShkZWxheSk7CiAgfQoKICAvKioKICAgKiBAZGV2IENoYW5nZSBPcmFjbGl6ZSBnYXMgbGltaXQgKHVzZWQgaW4gb3JhY2xpemVfcXVlcnkpCiAgICogQG5vdGljZSBUbyBiZSB1c2VkIGluIGNhc2UgdGhlIGRlZmF1bHQgZ2FzIGNvc3QgaXMgdG9vIGxvdwogICAqIEBwYXJhbSBuZXdHYXMgTmV3IGdhcyB0byB1c2UgKGluIHdlaSkKICAgKi8KICBmdW5jdGlvbiBjaGFuZ2VPcmFjbGl6ZUdhcyh1aW50IG5ld0dhcykgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld0dhcyA+IDAgJiYgbmV3R2FzIDw9IDQwMDAwMDApOwogICAgT1JBQ0xJWkVfR0FTX0xJTUlUID0gbmV3R2FzOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGFuZ2UgT3JhY2xpemUgZ2FzIHByaWNlCiAgICogQG5vdGljZSBUbyBiZSB1c2VkIGluIGNhc2UgdGhlIGRlZmF1bHQgZ2FzIHByaWNlIGlzIHRvbyBsb3cKICAgKiBAcGFyYW0gX2dhc1ByaWNlIEdhcyBwcmljZSBpbiB3ZWkKICAgKi8KICBmdW5jdGlvbiBjaGFuZ2VPcmFjbGl6ZUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoX2dhc1ByaWNlID49IDEwMDAwMDAwMDApOyAvLyBtaW5pbXVtIDEgZ3dlaQogICAgb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UoX2dhc1ByaWNlKTsKICB9CgogIC8qKgogICAqIEBkZXYgVG9wIHVwIGJhbGFuY2UKICAgKiBAbm90aWNlIFRoaXMgZnVuY3Rpb24gbXVzdCBiZSB1c2VkICoqb25seSBpZiAKICAgKiB0aGlzIGNvbnRyYWN0IGJhbGFuY2UgaXMgdG9vIGxvdyBmb3Igb3JhY2xpemVfcXVlcnkKICAgKiB0byBiZSBleGVjdXRlZCoqCiAgICogQHBhcmFtIHZlcmlmeUNvZGUgVXNlZCBvbmx5IHRvIGFsbG93IHBlb3BsZSB0aGF0IHJlYWQKICAgKiB0aGUgbm90aWNlIChub3QgYWNjaWRlbnRhbCkKICAgKi8KICBmdW5jdGlvbiB0b3BVcEJhbGFuY2UgKHVpbnQgdmVyaWZ5Q29kZSkgcHVibGljIHBheWFibGUgbXVzdEJlQXRTdGFnZShTdGFnZS5SdW5uaW5nKSB7CiAgICAvLyB2YWx1ZSBpcyByZXF1aXJlZAogICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgIC8vIG1ha2Ugc3VyZSBvbmx5IHRoZSBwZW9wbGUgdGhhdCByZWFkCiAgICAvLyB0aGlzIGNhbiB1c2UgdGhlIGZ1bmN0aW9uCiAgICByZXF1aXJlKHZlcmlmeUNvZGUgPT0gMjgzOTE3Mjg0NDgpOwogIH0KCiAgLyoqCiAgICogQGRldiBXaXRoZHJhdyBiYWxhbmNlIG9mIHRoaXMgY29udHJhY3QgdG8gdGhlIGB3YWxsZXRgIGFkZHJlc3MKICAgKiBAbm90aWNlIFVzZWQgb25seSBpZiB0aGVyZSBhcmUgc29tZSBsZWZ0b3ZlcgogICAqIGZ1bmRzIChiZWNhdXNlIG9mIHRvcFVwQmFsYW5jZSkKICAqLwogIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIHB1YmxpYyBtdXN0QmVBdFN0YWdlKFN0YWdlLkZpbmFsaXplZCkgewogICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICAvKiBJbnZlc3QgcmVsYXRlZCBmdW5jdGlvbnMgKi8KICAvKioKICAgKiBAZGV2IExvdyBsZXZlbCBmdW5jdGlvbiB0byBwdXJjaGFzZSBmdW5jdGlvbiBvbiBiZWhhbGYgb2YgYSBiZW5lZmljaWFyeQogICAqIEBub3RpY2UgSWYgeW91IGNhbGwgZGlyZWN0bHkgdGhpcyBmdW5jdGlvbiB5b3VyIGFyZSBidXlpbmcgZm9yIHNvbWVvbmUgZWxzZQogICAqIEBwYXJhbSBiZW5lZmljaWFyeSBXaGVyZSB0b2tlbnMgc2hvdWxkIGJlIHNlbnQKICAgKi8KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIG9ubHlGcm9tUmMgdmFsaWRQdXJjaGFzZSBtdXN0QmVBdFN0YWdlKFN0YWdlLlJ1bm5pbmcpIHBheWFibGUgewogICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSAxIGV0aGVyKTsKCiAgICB1aW50MjU2IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIHRyYW5zZmVyZWQKICAgIHVpbnQyNTYgdG9rZW5zID0gZ2V0VG9rZW5BbW91bnQod2VpQW1vdW50KTsKCiAgICByZXF1aXJlKHRva2VucyA+IDApOwogICAgLy8gY2hlY2sgaWYgd2UgYXJlIGJlbG93IE1BWF9UT0tFTlMKICAgIHJlcXVpcmUodG9rZW5zU29sZC5hZGQodG9rZW5zKSA8PSBNQVhfVE9LRU5TKTsKCiAgICAvLyB1cGRhdGUgdG9rZW5zIHNvbGQKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLmFkZCh0b2tlbnMpOwoKICAgIC8vIHVwZGF0ZSB0b3RhbCB3ZWkgY291bnRlcgogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwoKICAgIC8vIHVwZGF0ZSBiYWxhbmNlIG9mIHRoZSBiZW5lZmljaWFyeQogICAgYmFsYW5jZXNUb2tlbltiZW5lZmljaWFyeV0gPSBiYWxhbmNlc1Rva2VuW2JlbmVmaWNpYXJ5XS5hZGQodG9rZW5zKTsKICAgIGJhbGFuY2VzV2VpW2JlbmVmaWNpYXJ5XSA9IGJhbGFuY2VzV2VpW2JlbmVmaWNpYXJ5XS5hZGQod2VpQW1vdW50KTsKCiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CgogICAgLy8gZm9yd2FyZCBFVEgKICAgIGZvcndhcmRGdW5kcygpOwogIH0KCiAgLyoqCiAgICogQGRldiBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgICovCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewogICAgd2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgfQoKICAvKiBGaW5hbGl6ZS93aGl0ZWxpc3QgZnVuY3Rpb25zICovCgogIC8qKgogICAqIEBkZXYgQWRkIG11bHRpcGxlIHdoaXRlbGlzdGVkIGFkZHJlc3NlcwogICAqIEBub3RpY2UgTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBoYXMgZmluaXNoZWQKICAgKiBAcGFyYW0gaW52ZXN0b3JzIEFycmF5IG9yIGludmVzdG9ycyB0byBlbmFibGUKICAgKi8gCiAgZnVuY3Rpb24gYWRkV2hpdGVsaXN0QWRkckJ5TGlzdCAoYWRkcmVzc1tdIGludmVzdG9ycykgcHVibGljIG9ubHlPd25lciBtdXN0QmVBdFN0YWdlKFN0YWdlLkZpbmlzaGVkKSB7CiAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGludmVzdG9ycy5sZW5ndGg7IGkrKykgewogICAgICBhZGRXaGl0ZWxpc3RBZGRyZXNzKGludmVzdG9yc1tpXSk7CiAgICB9CiAgfQoKICAvKioKICAgKiBAZGV2IFdoaXRlbGlzdCBhIHNwZWNpZmljIGFkZHJlc3MKICAgKiBAbm90aWNlIFRoaXMgaXMgbWFpbmx5IGFuIGhlbHBlciBmdW5jdGlvbiBidXQgY2FuIGJlIHVzZWZ1bCBpbgogICAqIGNhc2UgdGhlIGBhZGRXaGl0ZWxpc3RBZGRyc2AgbG9vcCBoYXMgaXNzdWVzCiAgICogQHBhcmFtIGludmVzdG9yIEludmVzdG9yIHRvIHdoaXRlbGlzdAogICAqLyAKICBmdW5jdGlvbiBhZGRXaGl0ZWxpc3RBZGRyZXNzIChhZGRyZXNzIGludmVzdG9yKSBwdWJsaWMgb25seU93bmVyIG11c3RCZUF0U3RhZ2UoU3RhZ2UuRmluaXNoZWQpIHsKICAgIHJlcXVpcmUoaW52ZXN0b3IgIT0gYWRkcmVzcygwKSAmJiBpbnZlc3RvciAhPSBhZGRyZXNzKHRoaXMpKTsKICAgIHJlcXVpcmUoaXNXaGl0ZWxpc3RlZFtpbnZlc3Rvcl0gPT0gZmFsc2UpOwogICAgcmVxdWlyZShiYWxhbmNlc1Rva2VuW2ludmVzdG9yXSA+IDApOwogICAgaXNXaGl0ZWxpc3RlZFtpbnZlc3Rvcl0gPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBSZW1vdmUgYW4gYWRkcmVzcyBmcm9tIHdoaXRlbGlzdAogICAqLwogIGZ1bmN0aW9uIHJlbW92ZVdoaXRlbGlzdGVkQWRkcmVzcyAoYWRkcmVzcyB0b1JlbW92ZSkgcHVibGljIG9ubHlPd25lciBtdXN0QmVBdFN0YWdlKFN0YWdlLkZpbmlzaGVkKSB7CiAgICByZXF1aXJlKGlzV2hpdGVsaXN0ZWRbdG9SZW1vdmVdID09IHRydWUpOwogICAgaXNXaGl0ZWxpc3RlZFt0b1JlbW92ZV0gPSBmYWxzZTsKICB9CgogIC8qKgogICAqIEBkZXYgRmluYWxpemUgY3Jvd2RzYWxlIHdpdGggaW52ZXN0b3JzIGFycmF5CiAgICogQG5vdGljZSBUcmFuc2ZlcnMgdG9rZW5zIHRvIHdoaXRlbGlzdGVkIGFkZHJlc3NlcwogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplSW52ZXN0b3JzQnlMaXN0KGFkZHJlc3NbXSBpbnZlc3RvcnMpIHB1YmxpYyBvbmx5T3duZXIgbXVzdEJlQXRTdGFnZShTdGFnZS5GaW5pc2hlZCkgewogICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBpbnZlc3RvcnMubGVuZ3RoOyBpKyspIHsKICAgICAgZmluYWxpemVTaW5nbGVJbnZlc3RvcihpbnZlc3RvcnNbaV0pOwogICAgfQogIH0KCiAgLyoqCiAgICogQGRldiBGaW5hbGl6ZSBhIHNwZWNpZmljIGludmVzdG9yCiAgICogQG5vdGljZSBUaGlzIGlzIG1haW5seSBhbiBoZWxwZXIgZnVuY3Rpb24gdG8gYGZpbmFsaXplYCBidXQKICAgKiBjYW4gYmUgdXNlZCBpZiBgZmluYWxpemVgIGhhcyBpc3N1ZXMgd2l0aCB0aGUgbG9vcAogICAqIEBwYXJhbSBpbnZlc3RvckFkZHIgQWRkcmVzcyB0byBmaW5hbGl6ZQogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplU2luZ2xlSW52ZXN0b3IoYWRkcmVzcyBpbnZlc3RvckFkZHIpIHB1YmxpYyBvbmx5T3duZXIgbXVzdEJlQXRTdGFnZShTdGFnZS5GaW5pc2hlZCkgewogICAgcmVxdWlyZShpbnZlc3RvckFkZHIgIT0gYWRkcmVzcygwKSAmJiBpbnZlc3RvckFkZHIgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICByZXF1aXJlKGJhbGFuY2VzVG9rZW5baW52ZXN0b3JBZGRyXSA+IDApOwogICAgcmVxdWlyZShpc1doaXRlbGlzdGVkW2ludmVzdG9yQWRkcl0gPT0gdHJ1ZSk7CiAgICAvLyBzYXZlIGRhdGEgaW50byB2YXJpYWJsZXMKICAgIHVpbnQyNTYgYmFsYW5jZVRvVHJhbnNmZXIgPSBiYWxhbmNlc1Rva2VuW2ludmVzdG9yQWRkcl07CiAgICAvLyByZXNldCBjdXJyZW50IHN0YXRlCiAgICBiYWxhbmNlc1Rva2VuW2ludmVzdG9yQWRkcl0gPSAwOwogICAgaXNXaGl0ZWxpc3RlZFtpbnZlc3RvckFkZHJdID0gZmFsc2U7CiAgICAvLyB0cmFuc2ZlciB0b2tlbiB0byB0aGUgaW52ZXN0b3IgYWRkcmVzcyBhbmQgdGhlIGJhbGFuY2UKICAgIC8vIHRoYXQgd2UgaGF2ZSByZWNvcmRlZCBiZWZvcmUKICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoaW52ZXN0b3JBZGRyLCBiYWxhbmNlVG9UcmFuc2ZlcikpOwogICAgLy8gdXBkYXRlIHRva2VucyBzZW50CiAgICB0b2tlbnNGaW5hbGl6ZWQgPSB0b2tlbnNGaW5hbGl6ZWQuYWRkKGJhbGFuY2VUb1RyYW5zZmVyKTsKICAgIGFzc2VydCh0b2tlbnNGaW5hbGl6ZWQgPD0gTUFYX1RPS0VOUyk7CiAgfQoKICAvKioKICAgKiBAZGV2IEJ1cm4gdW5zb2xkIHRva2VucwogICAqIEBub3RpY2UgQ2FsbCB0aGlzIGZ1bmN0aW9uIGFmdGVyIGZpbmFsaXppbmcKICAgKi8KICBmdW5jdGlvbiBidXJuUmVtYWluaW5nVG9rZW5zKCkgcHVibGljIG9ubHlPd25lciBtdXN0QmVBdFN0YWdlKFN0YWdlLkZpbmFsaXplZCkgewogICAgLy8gc2hvdWxkIGFsd2F5cyBiZSB0cnVlCiAgICByZXF1aXJlKE1BWF9UT0tFTlMgPj0gdG9rZW5zRmluYWxpemVkKTsKICAgIHVpbnQgdW5zb2xkID0gTUFYX1RPS0VOUy5zdWIodG9rZW5zRmluYWxpemVkKTsKICAgIGlmICh1bnNvbGQgPiAwKSB7CiAgICAgIHRva2VuLmJ1cm4odW5zb2xkKTsKICAgIH0KICB9CgogIC8qKgogICAqIEBkZXYgQnVybiBhbGwgcmVtYWluaW5nIHRva2VucyBoZWxkIGJ5IHRoaXMgY29udHJhY3QKICAgKiBAbm90aWNlIEdldCB0aGUgdG9rZW4gYmFsYW5jZSBvZiB0aGlzIGNvbnRyYWN0IGFuZCBidXJucyBhbGwgdG9rZW5zCiAgICovCiAgZnVuY3Rpb24gYnVybkFsbFRva2VucygpIHB1YmxpYyBvbmx5T3duZXIgbXVzdEJlQXRTdGFnZShTdGFnZS5GaW5hbGl6ZWQpIHsKICAgIHVpbnQgdGhpc1Rva2VuQmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKTsKICAgIGlmICh0aGlzVG9rZW5CYWxhbmNlID4gMCkgewogICAgICB0b2tlbi5idXJuKHRoaXNUb2tlbkJhbGFuY2UpOwogICAgfQogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvdyB0byBjaGFuZ2UgdGhlIGN1cnJlbnQgc3RhZ2UKICAgKiBAcGFyYW0gbmV3U3RhZ2UgTmV3IHN0YWdlCiAgICovCiAgZnVuY3Rpb24gY2hhbmdlU3RhZ2UgKFN0YWdlIG5ld1N0YWdlKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGN1cnJlbnRTdGFnZSA9IG5ld1N0YWdlOwogIH0KCiAgLyoqCiAgICogQGRldiBwcmUtaWNvIHN0YXR1cyAoYmFzZWQgb25seSBvbiB0aW1lKQogICAqIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgICovCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWUgJiYgc3RhcnRUaW1lICE9IDA7CiAgfQoKICAvKiBQcmljZSBmdW5jdGlvbnMgKi8KICAvKioKICAgKiBAZGV2IEdldCBjdXJyZW50IEVUSC9QSEkgcmF0ZSAoMSBFVEggPSBnZXRFdGhQaGlSYXRlKCkgUEhJKQogICAqIEBub3RpY2UgSXQgZGl2aWRlcyAoRVRIL1VTRCByYXRlKSAvIChQSEkvVVNEIHJhdGUpLCB1c2UgdGhlCiAgICogY3VzdG9tIGZ1bmN0aW9uIGBnZXRFdGhQaGlSYXRlKGZhbHNlKWAgaWYgeW91IHdhbnQgYSBtb3JlCiAgICogYWNjdXJhdGUgcmF0ZQogICAqIEByZXR1cm4gRVRIL1BISSByYXRlCiAgICovCiAgZnVuY3Rpb24gZ2V0RXRoUGhpUmF0ZSAoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgLy8gMS8oRVRIL1BISSByYXRlKSAqIChFVEgvVVNEIHJhdGUpIHNob3VsZCByZXR1cm4gUEhJIHJhdGUKICAgIC8vIG11bHRpcGx5IGJ5IDEwMDAgdG8ga2VlcCBkZWNpbWFscyBmcm9tIHRoZSBkaXZpc2lvbgogICAgcmV0dXJuIGV0aFVzZC5kaXYocGhpUmF0ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IEdldCBjdXJyZW50IGtFVEgvUEhJIHJhdGUgKDEwMDAgRVRIID0gZ2V0a0V0aFBoaVJhdGUoKSBQSEkpCiAgICogdXNlZCB0byBnZXQgYSBtb3JlIGFjY3VyYXRlIHJhdGUgKGJ5IG5vdCB0cnVuY2F0aW5nIGRlY2ltYWxzKQogICAqIEBub3RpY2UgSXQgZGl2aWRlcyAoRVRIL1VTRCByYXRlKSAvIChQSEkvVVNEIHJhdGUpCiAgICogQHJldHVybiBrRVRIL1BISSByYXRlCiAgICovCiAgZnVuY3Rpb24gZ2V0a0V0aFBoaVJhdGUgKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIC8vIDEvKGtFVEgvUEhJIHJhdGUpICogKEVUSC9VU0QgcmF0ZSkgc2hvdWxkIHJldHVybiBQSEkgcmF0ZQogICAgLy8gbXVsdGlwbHkgYnkgMTAwMCB0byBrZWVwIGRlY2ltYWxzIGZyb20gdGhlIGRpdmlzaW9uLCBhbmQgcmV0dXJuIGtFdGgvUEhJIHJhdGUKICAgIHJldHVybiBldGhVc2QubXVsKDEwMDApLmRpdihwaGlSYXRlKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB0b2tlbiBiYXNlZCBvbiB3ZWkgYW1vdW50CiAgICogQHBhcmFtIHdlaUFtb3VudCBBbW91bnQgb2Ygd2VpCiAgICogQHJldHVybiBBbW91bnQgb2YgUEhJIHRva2VucwogICAqLwogIGZ1bmN0aW9uIGdldFRva2VuQW1vdW50KHVpbnQyNTYgd2VpQW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAvLyBnZXQga0V0aCByYXRlIHRvIGtlZXAgZGVjaW1hbHMKICAgIHVpbnQgY3VycmVudEtldGhSYXRlID0gZ2V0a0V0aFBoaVJhdGUoKTsKICAgIC8vIGRpdmlkZSBieSAxMDAwIHRvIHJldmVydCBiYWNrIHRoZSBtdWx0aXBseQogICAgcmV0dXJuIGN1cnJlbnRLZXRoUmF0ZS5tdWwod2VpQW1vdW50KS5kaXYoMTAwMCk7CiAgfQoKICAvKiBIZWxwZXIgZnVuY3Rpb25zIGZvciB0b2tlbiBiYWxhbmNlICovCiAgLyoqCiAgICogQGRldiBSZXR1cm5zIGhvdyBtYW55IHRva2VucyBhbiBpbnZlc3RvciBoYXMKICAgKiBAcGFyYW0gaW52ZXN0b3IgSW52ZXN0b3IgdG8gbG9vayBmb3IKICAgKiBAcmV0dXJuIEJhbGFuY2Ugb2YgdGhlIGludmVzdG9yCiAgICovCiAgZnVuY3Rpb24gZ2V0SW52ZXN0b3JCYWxhbmNlKGFkZHJlc3MgaW52ZXN0b3IpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBiYWxhbmNlc1Rva2VuW2ludmVzdG9yXTsKICB9CgogIC8qKgogICAqIEBkZXYgUmV0dXJucyBob3cgbWFueSB3ZWkgYW4gaW52ZXN0b3IgaGFzIGludmVzdGVkCiAgICogQHBhcmFtIGludmVzdG9yIEludmVzdG9yIHRvIGxvb2sgZm9yCiAgICogQHJldHVybiBCYWxhbmNlIG9mIHRoZSBpbnZlc3RvcgogICAqLwogIGZ1bmN0aW9uIGdldEludmVzdG9yV2VpQmFsYW5jZShhZGRyZXNzIGludmVzdG9yKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYmFsYW5jZXNXZWlbaW52ZXN0b3JdOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVjayBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgKiBAcGFyYW0gYWRkciBBZGRyZXNzIHRvIGNoZWNrCiAgICogQHJldHVybiBUcnVlIGlmIGlzIGEgY29udHJhY3QKICAgKi8KICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHVpbnQgc2l6ZTsKICAgIGFzc2VtYmx5IHsgc2l6ZSA6PSBleHRjb2Rlc2l6ZShhZGRyKSB9CiAgICByZXR1cm4gc2l6ZSA+IDA7CiAgfQoKICAvKiBJY28gZW5naW5lIGNvbXBhdGlibGUgZnVuY3Rpb25zICovCiAgLyoqCiAgICogQGRldiBSZXR1cm4gYHN0YXJ0ZWRgIHN0YXRlCiAgICogZmFsc2UgaWYgdGhlIGNyb3dkc2FsZSBpcyBub3Qgc3RhcnRlZCwKICAgKiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaXMgc3RhcnRlZCBhbmQgcnVubmluZywKICAgKiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaXMgY29tcGxldGVkCiAgICogQHJldHVybiBjcm93ZHNhbGUgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBzdGFydGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICBpZiAoKHVpbnQ4KGN1cnJlbnRTdGFnZSkgPj0gMiB8fCBub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lKSAmJiB1aW50OChjdXJyZW50U3RhZ2UpICE9IDMpIHJldHVybiB0cnVlOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogQGRldiBSZXR1cm4gaWYgY3Jvd2RzYWxlIGVuZGVkCiAgICogZmFsc2UgaWYgdGhlIGNyb3dkc2FsZSBpcyBub3Qgc3RhcnRlZCwKICAgKiBmYWxzZSBpZiB0aGUgY3Jvd2RzYWxlIGlzIHN0YXJ0ZWQgYW5kIHJ1bm5pbmcsCiAgICogdHJ1ZSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGNvbXBsZXRlZAogICAqIEByZXR1cm4gZW5kZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBlbmRlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgaWYgKHRva2Vuc1NvbGQgPT0gTUFYX1RPS0VOUykgcmV0dXJuIHRydWU7CiAgICBpZiAodWludDgoY3VycmVudFN0YWdlKSA+PSA0KSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiBoYXNFbmRlZCgpOwogIH0KCiAgLyoqCiAgICogQGRldiByZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgdGhlIHRva2VucyBhdmFpbGFibGUgZm9yIHRoZSBzYWxlLAogICAqIG11c3Qgbm90IGNoYW5nZSB3aGVuIHRoZSBjcm93ZHNhbGUgaXMgc3RhcnRlZAogICAqIEByZXR1cm4gdG90YWwgdG9rZW5zIGluIHNwaGkKICAgKi8KICBmdW5jdGlvbiB0b3RhbFRva2VucygpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgcmV0dXJuIE1BWF9UT0tFTlM7CiAgfQogIAogIC8qKgogICAqIEBkZXYgcmV0dXJucyB0aGUgbnVtYmVyIG9mIHRoZSB0b2tlbnMgYXZhaWxhYmxlIGZvciB0aGUgY3Jvd2RzYWxlLgogICAqIEF0IHRoZSBtb21lbnQgdGhhdCB0aGUgY3Jvd2RzYWxlIHN0YXJ0cyBpdCBtdXN0IGJlIGVxdWFsIHRvIHRvdGFsVG9rZW5zKCksCiAgICogdGhlbiBpdCB3aWxsIGRlY3JlYXNlLiBJdCBpcyB1c2VkIHRvIGNhbGN1bGF0ZSB0aGUKICAgKiBwZXJjZW50YWdlIG9mIHNvbGQgdG9rZW5zIGFzIHJlbWFpbmluZ1Rva2VucygpIC8gdG90YWxUb2tlbnMoKQogICAqIEByZXR1cm4gUmVtYWluaW5nIHRva2VucyBpbiBzcGhpCiAgICovCiAgZnVuY3Rpb24gcmVtYWluaW5nVG9rZW5zKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICByZXR1cm4gTUFYX1RPS0VOUy5zdWIodG9rZW5zU29sZCk7CiAgfQoKICAvKioKICAgKiBAZGV2IHJldHVybiB0aGUgcHJpY2UgYXMgbnVtYmVyIG9mIHRva2VucyByZWxlYXNlZCBmb3IgZWFjaCBldGhlcgogICAqIEByZXR1cm4gYW1vdW50IGluIHNwaGkgZm9yIDEgZXRoZXIKICAgKi8KICBmdW5jdGlvbiBwcmljZSgpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgcmV0dXJuIGdldFRva2VuQW1vdW50KDEgZXRoZXIpOwogIH0KfQ=='.
	

]
