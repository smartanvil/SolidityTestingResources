Class {
	#name : #SRT3f45d2d5feb6b4b000d2d3b84442eeddf54a735a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3f45d2d5feb6b4b000d2d3b84442eeddf54a735a >> base64 [
	^ 'Ly9GaWxlOiBjb250cmFjdHMvSUxpcXVpZFBsZWRnaW5nUGx1Z2luLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKCi8qCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQogICAgQ29udHJpYnV0b3JzOiBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjNjNWQ1ODRlNTU1ZDdjNWY1MzU4NTk1ZjUzNTI0ODU5NDQ0ODEyNTU1MyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LCBSSiBFd2luZywgR3JpZmYKICAgIEdyZWVuLCBBcnRodXIgTHVubgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgoKLy8vIEBkZXYgYElMaXF1aWRQbGVkZ2luZ1BsdWdpbmAgaXMgdGhlIGJhc2ljIGludGVyZmFjZSBmb3IgYW55Ci8vLyAgbGlxdWlkIHBsZWRnaW5nIHBsdWdpbgpjb250cmFjdCBJTGlxdWlkUGxlZGdpbmdQbHVnaW4gewoKICAgIC8vLyBAbm90aWNlIFBsdWdpbnMgYXJlIHVzZWQgKG11Y2ggbGlrZSB3ZWIgaG9va3MpIHRvIGluaXRpYXRlIGFuIGFjdGlvbgogICAgLy8vICB1cG9uIGFueSBkb25hdGlvbiwgZGVsZWdhdGlvbiwgb3IgdHJhbnNmZXI7IHRoaXMgaXMgYW4gb3B0aW9uYWwgZmVhdHVyZQogICAgLy8vICBhbmQgYWxsb3dzIGZvciBleHRyZW1lIGN1c3RvbWl6YXRpb24gb2YgdGhlIGNvbnRyYWN0LiBUaGlzIGZ1bmN0aW9uCiAgICAvLy8gIGltcGxlbWVudHMgYW55IGFjdGlvbiB0aGF0IHNob3VsZCBiZSBpbml0aWF0ZWQgYmVmb3JlIGEgdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIHBsZWRnZU1hbmFnZXIgVGhlIGFkbWluIG9yIGN1cnJlbnQgbWFuYWdlciBvZiB0aGUgcGxlZGdlCiAgICAvLy8gQHBhcmFtIHBsZWRnZUZyb20gVGhpcyBpcyB0aGUgSWQgZnJvbSB3aGljaCB2YWx1ZSB3aWxsIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIHBsZWRnZVRvIFRoaXMgaXMgdGhlIElkIHRoYXQgdmFsdWUgd2lsbCBiZSB0cmFuc2ZlcmVkIHRvLiAgICAKICAgIC8vLyBAcGFyYW0gY29udGV4dCBUaGUgc2l0dWF0aW9uIHRoYXQgaXMgdHJpZ2dlcmluZyB0aGUgcGx1Z2luOgogICAgLy8vICAwIC0+IFBsdWdpbiBmb3IgdGhlIG93bmVyIHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAxIC0+IFBsdWdpbiBmb3IgdGhlIGZpcnN0IGRlbGVnYXRlIHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAyIC0+IFBsdWdpbiBmb3IgdGhlIHNlY29uZCBkZWxlZ2F0ZSB0cmFuc2ZlcnJpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgLi4uCiAgICAvLy8gIDI1NSAtPiBQbHVnaW4gZm9yIHRoZSBpbnRlbmRlZFByb2plY3QgdHJhbnNmZXJyaW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8KICAgIC8vLyAgMjU2IC0+IFBsdWdpbiBmb3IgdGhlIG93bmVyIHJlY2VpdmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAyNTcgLT4gUGx1Z2luIGZvciB0aGUgZmlyc3QgZGVsZWdhdGUgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIDI1OCAtPiBQbHVnaW4gZm9yIHRoZSBzZWNvbmQgZGVsZWdhdGUgcmVjZWl2aW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIC4uLgogICAgLy8vICA1MTEgLT4gUGx1Z2luIGZvciB0aGUgaW50ZW5kZWRQcm9qZWN0IHJlY2VpdmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiB2YWx1ZSB0aGF0IHdpbGwgYmUgdHJhbnNmZXJlZC4KICAgIGZ1bmN0aW9uIGJlZm9yZVRyYW5zZmVyKAogICAgICAgIHVpbnQ2NCBwbGVkZ2VNYW5hZ2VyLAogICAgICAgIHVpbnQ2NCBwbGVkZ2VGcm9tLAogICAgICAgIHVpbnQ2NCBwbGVkZ2VUbywKICAgICAgICB1aW50NjQgY29udGV4dCwKICAgICAgICB1aW50IGFtb3VudCApIHJldHVybnMgKHVpbnQgbWF4QWxsb3dlZCk7CgogICAgLy8vIEBub3RpY2UgUGx1Z2lucyBhcmUgdXNlZCAobXVjaCBsaWtlIHdlYiBob29rcykgdG8gaW5pdGlhdGUgYW4gYWN0aW9uCiAgICAvLy8gIHVwb24gYW55IGRvbmF0aW9uLCBkZWxlZ2F0aW9uLCBvciB0cmFuc2ZlcjsgdGhpcyBpcyBhbiBvcHRpb25hbCBmZWF0dXJlCiAgICAvLy8gIGFuZCBhbGxvd3MgZm9yIGV4dHJlbWUgY3VzdG9taXphdGlvbiBvZiB0aGUgY29udHJhY3QuIFRoaXMgZnVuY3Rpb24KICAgIC8vLyAgaW1wbGVtZW50cyBhbnkgYWN0aW9uIHRoYXQgc2hvdWxkIGJlIGluaXRpYXRlZCBhZnRlciBhIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBwbGVkZ2VNYW5hZ2VyIFRoZSBhZG1pbiBvciBjdXJyZW50IG1hbmFnZXIgb2YgdGhlIHBsZWRnZQogICAgLy8vIEBwYXJhbSBwbGVkZ2VGcm9tIFRoaXMgaXMgdGhlIElkIGZyb20gd2hpY2ggdmFsdWUgd2lsbCBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBwbGVkZ2VUbyBUaGlzIGlzIHRoZSBJZCB0aGF0IHZhbHVlIHdpbGwgYmUgdHJhbnNmZXJlZCB0by4gICAgCiAgICAvLy8gQHBhcmFtIGNvbnRleHQgVGhlIHNpdHVhdGlvbiB0aGF0IGlzIHRyaWdnZXJpbmcgdGhlIHBsdWdpbjoKICAgIC8vLyAgMCAtPiBQbHVnaW4gZm9yIHRoZSBvd25lciB0cmFuc2ZlcnJpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgMSAtPiBQbHVnaW4gZm9yIHRoZSBmaXJzdCBkZWxlZ2F0ZSB0cmFuc2ZlcnJpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgMiAtPiBQbHVnaW4gZm9yIHRoZSBzZWNvbmQgZGVsZWdhdGUgdHJhbnNmZXJyaW5nIHBsZWRnZSB0byBhbm90aGVyIHBhcnR5CiAgICAvLy8gIC4uLgogICAgLy8vICAyNTUgLT4gUGx1Z2luIGZvciB0aGUgaW50ZW5kZWRQcm9qZWN0IHRyYW5zZmVycmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vCiAgICAvLy8gIDI1NiAtPiBQbHVnaW4gZm9yIHRoZSBvd25lciByZWNlaXZpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgMjU3IC0+IFBsdWdpbiBmb3IgdGhlIGZpcnN0IGRlbGVnYXRlIHJlY2VpdmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAyNTggLT4gUGx1Z2luIGZvciB0aGUgc2Vjb25kIGRlbGVnYXRlIHJlY2VpdmluZyBwbGVkZ2UgdG8gYW5vdGhlciBwYXJ0eQogICAgLy8vICAuLi4KICAgIC8vLyAgNTExIC0+IFBsdWdpbiBmb3IgdGhlIGludGVuZGVkUHJvamVjdCByZWNlaXZpbmcgcGxlZGdlIHRvIGFub3RoZXIgcGFydHkKICAgIC8vLyAgQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHZhbHVlIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcmVkLgogICAgZnVuY3Rpb24gYWZ0ZXJUcmFuc2ZlcigKICAgICAgICB1aW50NjQgcGxlZGdlTWFuYWdlciwKICAgICAgICB1aW50NjQgcGxlZGdlRnJvbSwKICAgICAgICB1aW50NjQgcGxlZGdlVG8sCiAgICAgICAgdWludDY0IGNvbnRleHQsCiAgICAgICAgdWludCBhbW91bnQKICAgICk7Cn0KCi8vRmlsZTogbm9kZV9tb2R1bGVzL2dpdmV0aC1jb21tb24tY29udHJhY3RzL2NvbnRyYWN0cy9Pd25lZC5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLy8vIEB0aXRsZSBPd25lZAovLy8gQGF1dGhvciBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImU5ODg4ZDliODA4OGE5OGE4NjhkOGM4YTg2ODc5ZDhjOTE5ZGM3ODA4NiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+Ci8vLyBAbm90aWNlIFRoZSBPd25lZCBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIAovLy8gIGF1dGhvcml6YXRpb24gY29udHJvbCBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyAmIHRoZSBpbXBsZW1lbnRhdGlvbiBvZgovLy8gIHVzZXIgcGVybWlzc2lvbnM7IHRoaXMgY29udHJhY3QgaGFzIHRocmVlIHdvcmsgZmxvd3MgZm9yIGEgY2hhbmdlIGluCi8vLyAgb3duZXJzaGlwLCB0aGUgZmlyc3QgcmVxdWlyZXMgdGhlIG5ldyBvd25lciB0byB2YWxpZGF0ZSB0aGF0IHRoZXkgaGF2ZSB0aGUKLy8vICBhYmlsaXR5IHRvIGFjY2VwdCBvd25lcnNoaXAsIHRoZSBzZWNvbmQgYWxsb3dzIHRoZSBvd25lcnNoaXAgdG8gYmUKLy8vICBkaXJlY3RseSB0cmFuc2ZlcmVkIHdpdGhvdXQgcmVxdWlyaW5nIGFjY2VwdGFuY2UsIGFuZCB0aGUgdGhpcmQgYWxsb3dzIGZvcgovLy8gIHRoZSBvd25lcnNoaXAgdG8gYmUgcmVtb3ZlZCB0byBhbGxvdyBmb3IgZGVjZW50cmFsaXphdGlvbiAKY29udHJhY3QgT3duZWQgewoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXJDYW5kaWRhdGU7CgogICAgZXZlbnQgT3duZXJzaGlwUmVxdWVzdGVkKGFkZHJlc3MgaW5kZXhlZCBieSwgYWRkcmVzcyBpbmRleGVkIHRvKTsKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8pOwogICAgZXZlbnQgT3duZXJzaGlwUmVtb3ZlZCgpOwoKICAgIC8vLyBAZGV2IFRoZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBgbXNnLnNlbmRlcmAgYXMgdGhlYG93bmVyYCBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIE93bmVkKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8vIEBkZXYgYG93bmVyYCBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwgYSBmdW5jdGlvbiB3aXRoIHRoaXMKICAgIC8vLyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEluIHRoaXMgMXN0IG9wdGlvbiBmb3Igb3duZXJzaGlwIHRyYW5zZmVyIGBwcm9wb3NlT3duZXJzaGlwKClgIG11c3QKICAgIC8vLyAgYmUgY2FsbGVkIGZpcnN0IGJ5IHRoZSBjdXJyZW50IGBvd25lcmAgdGhlbiBgYWNjZXB0T3duZXJzaGlwKClgIG11c3QgYmUKICAgIC8vLyAgY2FsbGVkIGJ5IHRoZSBgbmV3T3duZXJDYW5kaWRhdGVgCiAgICAvLy8gQG5vdGljZSBgb25seU93bmVyYCBQcm9wb3NlcyB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhCiAgICAvLy8gIG5ldyBvd25lcgogICAgLy8vIEBwYXJhbSBfbmV3T3duZXJDYW5kaWRhdGUgVGhlIGFkZHJlc3MgYmVpbmcgcHJvcG9zZWQgYXMgdGhlIG5ldyBvd25lcgogICAgZnVuY3Rpb24gcHJvcG9zZU93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lckNhbmRpZGF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgbmV3T3duZXJDYW5kaWRhdGUgPSBfbmV3T3duZXJDYW5kaWRhdGU7CiAgICAgICAgT3duZXJzaGlwUmVxdWVzdGVkKG1zZy5zZW5kZXIsIG5ld093bmVyQ2FuZGlkYXRlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGBuZXdPd25lckNhbmRpZGF0ZWAsIGFjY2VwdHMgdGhlCiAgICAvLy8gIHRyYW5zZmVyIG9mIG93bmVyc2hpcAogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmV3T3duZXJDYW5kaWRhdGUpOwoKICAgICAgICBhZGRyZXNzIG9sZE93bmVyID0gb3duZXI7CiAgICAgICAgb3duZXIgPSBuZXdPd25lckNhbmRpZGF0ZTsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IDB4MDsKCiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob2xkT3duZXIsIG93bmVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBJbiB0aGlzIDJuZCBvcHRpb24gZm9yIG93bmVyc2hpcCB0cmFuc2ZlciBgY2hhbmdlT3duZXJzaGlwKClgIGNhbgogICAgLy8vICBiZSBjYWxsZWQgYW5kIGl0IHdpbGwgaW1tZWRpYXRlbHkgYXNzaWduIG93bmVyc2hpcCB0byB0aGUgYG5ld093bmVyYAogICAgLy8vIEBub3RpY2UgYG93bmVyYCBjYW4gc3RlcCBkb3duIGFuZCBhc3NpZ24gc29tZSBvdGhlciBhZGRyZXNzIHRvIHRoaXMgcm9sZQogICAgLy8vIEBwYXJhbSBfbmV3T3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBvd25lcgogICAgZnVuY3Rpb24gY2hhbmdlT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSAweDApOwoKICAgICAgICBhZGRyZXNzIG9sZE93bmVyID0gb3duZXI7CiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICAgICAgbmV3T3duZXJDYW5kaWRhdGUgPSAweDA7CgogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG9sZE93bmVyLCBvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgSW4gdGhpcyAzcmQgb3B0aW9uIGZvciBvd25lcnNoaXAgdHJhbnNmZXIgYHJlbW92ZU93bmVyc2hpcCgpYCBjYW4KICAgIC8vLyAgYmUgY2FsbGVkIGFuZCBpdCB3aWxsIGltbWVkaWF0ZWx5IGFzc2lnbiBvd25lcnNoaXAgdG8gdGhlIDB4MCBhZGRyZXNzOwogICAgLy8vICBpdCByZXF1aXJlcyBhIDB4ZGVjZSBiZSBpbnB1dCBhcyBhIHBhcmFtZXRlciB0byBwcmV2ZW50IGFjY2lkZW50YWwgdXNlCiAgICAvLy8gQG5vdGljZSBEZWNlbnRyYWxpemVzIHRoZSBjb250cmFjdCwgdGhpcyBvcGVyYXRpb24gY2Fubm90IGJlIHVuZG9uZSAKICAgIC8vLyBAcGFyYW0gX2RhYyBgMHhkYWNgIGhhcyB0byBiZSBlbnRlcmVkIGZvciB0aGlzIGZ1bmN0aW9uIHRvIHdvcmsKICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyc2hpcChhZGRyZXNzIF9kYWMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX2RhYyA9PSAweGRhYyk7CiAgICAgICAgb3duZXIgPSAweDA7CiAgICAgICAgbmV3T3duZXJDYW5kaWRhdGUgPSAweDA7CiAgICAgICAgT3duZXJzaGlwUmVtb3ZlZCgpOyAgICAgCiAgICB9Cn0gCgovL0ZpbGU6IG5vZGVfbW9kdWxlcy9naXZldGgtY29tbW9uLWNvbnRyYWN0cy9jb250cmFjdHMvRVJDMjAuc29sCnByYWdtYSBzb2xpZGl0eSBeMC40LjE1OwoKCi8qKgogKiBAdGl0bGUgRVJDMjAKICogQGRldiBBIHN0YW5kYXJkIGludGVyZmFjZSBmb3IgdG9rZW5zLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvbWFzdGVyL0VJUFMvZWlwLTIwLXRva2VuLXN0YW5kYXJkLm1kCiAqLwpjb250cmFjdCBFUkMyMCB7CiAgCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSB0b3RhbCB0b2tlbiBzdXBwbHkKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsKCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBhY2NvdW50IGJhbGFuY2Ugb2YgdGhlIGFjY291bnQgd2l0aCBhZGRyZXNzIF9vd25lcgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgX3ZhbHVlIG51bWJlciBvZiB0b2tlbnMgdG8gYWRkcmVzcyBfdG8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIF92YWx1ZSBudW1iZXIgb2YgdG9rZW5zIGZyb20gYWRkcmVzcyBfZnJvbSB0byBhZGRyZXNzIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBkZXYgQWxsb3dzIF9zcGVuZGVyIHRvIHdpdGhkcmF3IGZyb20gdGhlIG1zZy5zZW5kZXIncyBhY2NvdW50IHVwIHRvIHRoZSBfdmFsdWUgYW1vdW50CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBhbW91bnQgd2hpY2ggX3NwZW5kZXIgaXMgc3RpbGwgYWxsb3dlZCB0byB3aXRoZHJhdyBmcm9tIF9vd25lcgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cgp9CgovL0ZpbGU6IG5vZGVfbW9kdWxlcy9naXZldGgtY29tbW9uLWNvbnRyYWN0cy9jb250cmFjdHMvRXNjYXBhYmxlLnNvbApwcmFnbWEgc29saWRpdHkgXjAuNC4xNTsKLyoKICAgIENvcHlyaWdodCAyMDE2LCBKb3JkaSBCYXlsaW5hCiAgICBDb250cmlidXRvcjogQWRyaSYjMjI0OyBNYXNzYW5ldCA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJmOTk4OWQ4YjkwOThiOTlhOTY5ZDljOWE5Njk3OGQ5YzgxOGRkNzkwOTYiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgoKCgoKLy8vIEBkZXYgYEVzY2FwYWJsZWAgaXMgYSBiYXNlIGxldmVsIGNvbnRyYWN0IGJ1aWx0IG9mZiBvZiB0aGUgYE93bmVkYAovLy8gIGNvbnRyYWN0OyBpdCBjcmVhdGVzIGFuIGVzY2FwZSBoYXRjaCBmdW5jdGlvbiB0aGF0IGNhbiBiZSBjYWxsZWQgaW4gYW4KLy8vICBlbWVyZ2VuY3kgdGhhdCB3aWxsIGFsbG93IGRlc2lnbmF0ZWQgYWRkcmVzc2VzIHRvIHNlbmQgYW55IGV0aGVyIG9yIHRva2VucwovLy8gIGhlbGQgaW4gdGhlIGNvbnRyYWN0IHRvIGFuIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYCBhcyBsb25nIGFzIHRoZXkgd2VyZQovLy8gIG5vdCBibGFja2xpc3RlZApjb250cmFjdCBFc2NhcGFibGUgaXMgT3duZWQgewogICAgYWRkcmVzcyBwdWJsaWMgZXNjYXBlSGF0Y2hDYWxsZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBlc2NhcGVIYXRjaERlc3RpbmF0aW9uOwogICAgbWFwcGluZyAoYWRkcmVzcz0+Ym9vbCkgcHJpdmF0ZSBlc2NhcGVCbGFja2xpc3Q7IC8vIFRva2VuIGNvbnRyYWN0IGFkZHJlc3NlcwoKICAgIC8vLyBAbm90aWNlIFRoZSBDb25zdHJ1Y3RvciBhc3NpZ25zIHRoZSBgZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbmAgYW5kIHRoZQogICAgLy8vICBgZXNjYXBlSGF0Y2hDYWxsZXJgCiAgICAvLy8gQHBhcmFtIF9lc2NhcGVIYXRjaENhbGxlciBUaGUgYWRkcmVzcyBvZiBhIHRydXN0ZWQgYWNjb3VudCBvciBjb250cmFjdAogICAgLy8vICB0byBjYWxsIGBlc2NhcGVIYXRjaCgpYCB0byBzZW5kIHRoZSBldGhlciBpbiB0aGlzIGNvbnRyYWN0IHRvIHRoZQogICAgLy8vICBgZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbmAgaXQgd291bGQgYmUgaWRlYWwgdGhhdCBgZXNjYXBlSGF0Y2hDYWxsZXJgCiAgICAvLy8gIGNhbm5vdCBtb3ZlIGZ1bmRzIG91dCBvZiBgZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbmAKICAgIC8vLyBAcGFyYW0gX2VzY2FwZUhhdGNoRGVzdGluYXRpb24gVGhlIGFkZHJlc3Mgb2YgYSBzYWZlIGxvY2F0aW9uICh1c3UgYQogICAgLy8vICBNdWx0aXNpZykgdG8gc2VuZCB0aGUgZXRoZXIgaGVsZCBpbiB0aGlzIGNvbnRyYWN0OyBpZiBhIG5ldXRyYWwgYWRkcmVzcwogICAgLy8vICBpcyByZXF1aXJlZCwgdGhlIFdIRyBNdWx0aXNpZyBpcyBhbiBvcHRpb246CiAgICAvLy8gIDB4OEZmOTIwMDIwYzhBRDY3MzY2MWM4MTE3ZjI4NTVDMzg0NzU4QzU3MiAKICAgIGZ1bmN0aW9uIEVzY2FwYWJsZShhZGRyZXNzIF9lc2NhcGVIYXRjaENhbGxlciwgYWRkcmVzcyBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbikgcHVibGljIHsKICAgICAgICBlc2NhcGVIYXRjaENhbGxlciA9IF9lc2NhcGVIYXRjaENhbGxlcjsKICAgICAgICBlc2NhcGVIYXRjaERlc3RpbmF0aW9uID0gX2VzY2FwZUhhdGNoRGVzdGluYXRpb247CiAgICB9CgogICAgLy8vIEBkZXYgVGhlIGFkZHJlc3NlcyBwcmVhc3NpZ25lZCBhcyBgZXNjYXBlSGF0Y2hDYWxsZXJgIG9yIGBvd25lcmAKICAgIC8vLyAgYXJlIHRoZSBvbmx5IGFkZHJlc3NlcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5RXNjYXBlSGF0Y2hDYWxsZXJPck93bmVyIHsKICAgICAgICByZXF1aXJlICgobXNnLnNlbmRlciA9PSBlc2NhcGVIYXRjaENhbGxlcil8fChtc2cuc2VuZGVyID09IG93bmVyKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIHRoZSBibGFja2xpc3Qgb2YgdG9rZW5zIHRoYXQgYXJlIG5vdCBhYmxlIHRvIGJlIHRha2VuCiAgICAvLy8gIG91dCBvZiB0aGUgY29udHJhY3Q7IGNhbiBvbmx5IGJlIGRvbmUgYXQgdGhlIGRlcGxveW1lbnQsIGFuZCB0aGUgbG9naWMKICAgIC8vLyAgdG8gYWRkIHRvIHRoZSBibGFja2xpc3Qgd2lsbCBiZSBpbiB0aGUgY29uc3RydWN0b3Igb2YgYSBjaGlsZCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfdG9rZW4gdGhlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MgdGhhdCBpcyB0byBiZSBibGFja2xpc3RlZCAKICAgIGZ1bmN0aW9uIGJsYWNrbGlzdEVzY2FwZVRva2VuKGFkZHJlc3MgX3Rva2VuKSBpbnRlcm5hbCB7CiAgICAgICAgZXNjYXBlQmxhY2tsaXN0W190b2tlbl0gPSB0cnVlOwogICAgICAgIEVzY2FwZUhhdGNoQmxhY2tpc3RlZFRva2VuKF90b2tlbik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIHRvIHNlZSBpZiBgX3Rva2VuYCBpcyBpbiB0aGUgYmxhY2tsaXN0IG9mIHRva2VucwogICAgLy8vIEBwYXJhbSBfdG9rZW4gdGhlIHRva2VuIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgYF90b2tlbmAgaXMgaW4gdGhlIGJsYWNrbGlzdCBhbmQgY2FuJ3QgYmUgdGFrZW4gb3V0IG9mCiAgICAvLy8gIHRoZSBjb250cmFjdCB2aWEgdGhlIGBlc2NhcGVIYXRjaCgpYAogICAgZnVuY3Rpb24gaXNUb2tlbkVzY2FwYWJsZShhZGRyZXNzIF90b2tlbikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gIWVzY2FwZUJsYWNrbGlzdFtfdG9rZW5dOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoZSBgZXNjYXBlSGF0Y2goKWAgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGFzIGEgbGFzdCByZXNvcnQgaWYgYQogICAgLy8vIHNlY3VyaXR5IGlzc3VlIGlzIHVuY292ZXJlZCBvciBzb21ldGhpbmcgdW5leHBlY3RlZCBoYXBwZW5lZAogICAgLy8vIEBwYXJhbSBfdG9rZW4gdG8gdHJhbnNmZXIsIHVzZSAweDAgZm9yIGV0aGVyCiAgICBmdW5jdGlvbiBlc2NhcGVIYXRjaChhZGRyZXNzIF90b2tlbikgcHVibGljIG9ubHlFc2NhcGVIYXRjaENhbGxlck9yT3duZXIgeyAgIAogICAgICAgIHJlcXVpcmUoZXNjYXBlQmxhY2tsaXN0W190b2tlbl09PWZhbHNlKTsKCiAgICAgICAgdWludDI1NiBiYWxhbmNlOwoKICAgICAgICAvLy8gQGRldiBMb2dpYyBmb3IgZXRoZXIKICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgewogICAgICAgICAgICBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgICAgICAgICBlc2NhcGVIYXRjaERlc3RpbmF0aW9uLnRyYW5zZmVyKGJhbGFuY2UpOwogICAgICAgICAgICBFc2NhcGVIYXRjaENhbGxlZChfdG9rZW4sIGJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vLyBAZGV2IExvZ2ljIGZvciB0b2tlbnMKICAgICAgICBFUkMyMCB0b2tlbiA9IEVSQzIwKF90b2tlbik7CiAgICAgICAgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyKGVzY2FwZUhhdGNoRGVzdGluYXRpb24sIGJhbGFuY2UpKTsKICAgICAgICBFc2NhcGVIYXRjaENhbGxlZChfdG9rZW4sIGJhbGFuY2UpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGFkZHJlc3MgYXNzaWduZWQgdG8gY2FsbCBgZXNjYXBlSGF0Y2goKWAKICAgIC8vLyBAcGFyYW0gX25ld0VzY2FwZUhhdGNoQ2FsbGVyIFRoZSBhZGRyZXNzIG9mIGEgdHJ1c3RlZCBhY2NvdW50IG9yCiAgICAvLy8gIGNvbnRyYWN0IHRvIGNhbGwgYGVzY2FwZUhhdGNoKClgIHRvIHNlbmQgdGhlIHZhbHVlIGluIHRoaXMgY29udHJhY3QgdG8KICAgIC8vLyAgdGhlIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYDsgaXQgd291bGQgYmUgaWRlYWwgdGhhdCBgZXNjYXBlSGF0Y2hDYWxsZXJgCiAgICAvLy8gIGNhbm5vdCBtb3ZlIGZ1bmRzIG91dCBvZiBgZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbmAKICAgIGZ1bmN0aW9uIGNoYW5nZUhhdGNoRXNjYXBlQ2FsbGVyKGFkZHJlc3MgX25ld0VzY2FwZUhhdGNoQ2FsbGVyKSBwdWJsaWMgb25seUVzY2FwZUhhdGNoQ2FsbGVyT3JPd25lciB7CiAgICAgICAgZXNjYXBlSGF0Y2hDYWxsZXIgPSBfbmV3RXNjYXBlSGF0Y2hDYWxsZXI7CiAgICB9CgogICAgZXZlbnQgRXNjYXBlSGF0Y2hCbGFja2lzdGVkVG9rZW4oYWRkcmVzcyB0b2tlbik7CiAgICBldmVudCBFc2NhcGVIYXRjaENhbGxlZChhZGRyZXNzIHRva2VuLCB1aW50IGFtb3VudCk7Cn0KCi8vRmlsZTogY29udHJhY3RzL0xpcXVpZFBsZWRnaW5nQmFzZS5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Ci8qCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQogICAgQ29udHJpYnV0b3JzOiBBZHJpJiMyMjQ7IE1hc3NhbmV0IDw8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImQxYjBiNWEzYjhiMDkxYjJiZWI1YjRiMmJlYmZhNWI0YTlhNWZmYjhiZSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4+LCBSSiBFd2luZywgR3JpZmYKICAgIEdyZWVuLCBBcnRodXIgTHVubgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiovCgoKCgovLy8gQGRldiBUaGlzIGlzIGFuIGludGVyZmFjZSBmb3IgYExQVmF1bHRgIHdoaWNoIHNlcnZlcyBhcyBhIHNlY3VyZSBzdG9yYWdlIGZvcgovLy8gIHRoZSBFVEggdGhhdCBiYWNrcyB0aGUgUGxlZGdlcywgb25seSBhZnRlciBgTGlxdWlkUGxlZGdpbmdgIGF1dGhvcml6ZXMKLy8vICBwYXltZW50cyBjYW4gUGxlZGdlcyBiZSBjb252ZXJ0ZWQgZm9yIEVUSAppbnRlcmZhY2UgTFBWYXVsdCB7CiAgICBmdW5jdGlvbiBhdXRob3JpemVQYXltZW50KGJ5dGVzMzIgX3JlZiwgYWRkcmVzcyBfZGVzdCwgdWludCBfYW1vdW50KTsKICAgIGZ1bmN0aW9uICgpIHBheWFibGU7Cn0KCi8vLyBAZGV2IGBMaXF1aWRQbGVkZ2luZ0Jhc2VgIGlzIHRoZSBiYXNlIGxldmVsIGNvbnRyYWN0IHVzZWQgdG8gY2Fycnkgb3V0Ci8vLyAgbGlxdWlkUGxlZGdpbmcncyBtb3N0IGJhc2ljIGZ1bmN0aW9ucywgbW9zdGx5IGhhbmRsaW5nIGFuZCBzZWFyY2hpbmcgdGhlCi8vLyAgZGF0YSBzdHJ1Y3R1cmVzCmNvbnRyYWN0IExpcXVpZFBsZWRnaW5nQmFzZSBpcyBFc2NhcGFibGUgewoKICAgIC8vIExpbWl0cyBpbnNlcnRlZCB0byBwcmV2ZW50IGxhcmdlIGxvb3BzIHRoYXQgY291bGQgcHJldmVudCBjYW5jZWxpbmcKICAgIHVpbnQgY29uc3RhbnQgTUFYX0RFTEVHQVRFUyA9IDEwOwogICAgdWludCBjb25zdGFudCBNQVhfU1VCUFJPSkVDVF9MRVZFTCA9IDIwOwogICAgdWludCBjb25zdGFudCBNQVhfSU5URVJQUk9KRUNUX0xFVkVMID0gMjA7CgogICAgZW51bSBQbGVkZ2VBZG1pblR5cGUgeyBHaXZlciwgRGVsZWdhdGUsIFByb2plY3QgfQogICAgZW51bSBQbGVkZ2VTdGF0ZSB7IFBsZWRnZWQsIFBheWluZywgUGFpZCB9CgogICAgLy8vIEBkZXYgVGhpcyBzdHJ1Y3QgZGVmaW5lcyB0aGUgZGV0YWlscyBvZiBhIGBQbGVkZ2VBZG1pbmAgd2hpY2ggYXJlIAogICAgLy8vICBjb21tb25seSByZWZlcmVuY2VkIGJ5IHRoZWlyIGluZGV4IGluIHRoZSBgYWRtaW5zYCBhcnJheQogICAgLy8vICBhbmQgY2FuIG93biBwbGVkZ2VzIGFuZCBhY3QgYXMgZGVsZWdhdGVzCiAgICBzdHJ1Y3QgUGxlZGdlQWRtaW4geyAKICAgICAgICBQbGVkZ2VBZG1pblR5cGUgYWRtaW5UeXBlOyAvLyBHaXZlciwgRGVsZWdhdGUgb3IgUHJvamVjdAogICAgICAgIGFkZHJlc3MgYWRkcjsgLy8gQWNjb3VudCBvciBjb250cmFjdCBhZGRyZXNzIGZvciBhZG1pbgogICAgICAgIHN0cmluZyBuYW1lOwogICAgICAgIHN0cmluZyB1cmw7ICAvLyBDYW4gYmUgSVBGUyBoYXNoCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWU7ICAvLyBJbiBzZWNvbmRzLCB1c2VkIGZvciBHaXZlcnMnICYgRGVsZWdhdGVzJyB2ZXRvcwogICAgICAgIHVpbnQ2NCBwYXJlbnRQcm9qZWN0OyAgLy8gT25seSBmb3IgcHJvamVjdHMKICAgICAgICBib29sIGNhbmNlbGVkOyAgICAgIC8vQWx3YXlzIGZhbHNlIGV4Y2VwdCBmb3IgY2FuY2VsZWQgcHJvamVjdHMKCiAgICAgICAgLy8vIEBkZXYgaWYgdGhlIHBsdWdpbiBpcyAweDAgdGhlbiBub3RoaW5nIGhhcHBlbnMsIGlmIGl0cyBhbiBhZGRyZXNzCiAgICAgICAgLy8gdGhhbiB0aGF0IHNtYXJ0IGNvbnRyYWN0IGlzIGNhbGxlZCB3aGVuIGFwcHJvcHJpYXRlCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbjsgCiAgICB9CgogICAgc3RydWN0IFBsZWRnZSB7CiAgICAgICAgdWludCBhbW91bnQ7CiAgICAgICAgdWludDY0IG93bmVyOyAvLyBQbGVkZ2VBZG1pbgogICAgICAgIHVpbnQ2NFtdIGRlbGVnYXRpb25DaGFpbjsgLy8gTGlzdCBvZiBkZWxlZ2F0ZXMgaW4gb3JkZXIgb2YgYXV0aG9yaXR5CiAgICAgICAgdWludDY0IGludGVuZGVkUHJvamVjdDsgLy8gVXNlZCB3aGVuIGRlbGVnYXRlcyBhcmUgc2VuZGluZyB0byBwcm9qZWN0cwogICAgICAgIHVpbnQ2NCBjb21taXRUaW1lOyAgLy8gV2hlbiB0aGUgaW50ZW5kZWRQcm9qZWN0IHdpbGwgYmVjb21lIHRoZSBvd25lciAgCiAgICAgICAgdWludDY0IG9sZFBsZWRnZTsgLy8gUG9pbnRzIHRvIHRoZSBpZCB0aGF0IHRoaXMgUGxlZGdlIHdhcyBkZXJpdmVkIGZyb20KICAgICAgICBQbGVkZ2VTdGF0ZSBwbGVkZ2VTdGF0ZTsgLy8gIFBsZWRnZWQsIFBheWluZywgUGFpZAogICAgfQoKICAgIFBsZWRnZVtdIHBsZWRnZXM7CiAgICBQbGVkZ2VBZG1pbltdIGFkbWluczsgLy9UaGUgbGlzdCBvZiBwbGVkZ2VBZG1pbnMgMCBtZWFucyB0aGVyZSBpcyBubyBhZG1pbgogICAgTFBWYXVsdCBwdWJsaWMgdmF1bHQ7CgogICAgLy8vIEBkZXYgdGhpcyBtYXBwaW5nIGFsbG93cyB5b3UgdG8gc2VhcmNoIGZvciBhIHNwZWNpZmljIHBsZWRnZSdzIAogICAgLy8vICBpbmRleCBudW1iZXIgYnkgdGhlIGhhc2ggb2YgdGhhdCBwbGVkZ2UKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDY0KSBoUGxlZGdlMmlkeDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYm9vbCkgcGx1Z2luV2hpdGVsaXN0OwogICAgCiAgICBib29sIHB1YmxpYyB1c2VQbHVnaW5XaGl0ZWxpc3QgPSB0cnVlOwoKLy8vLy8vLy8vLy8vLwovLyBNb2RpZmllcnMKLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQGRldiBUaGUgYHZhdWx0YGlzIHRoZSBvbmx5IGFkZHJlc3NlcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5VmF1bHQoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModmF1bHQpKTsKICAgICAgICBfOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGUgQ29uc3RydWN0b3IgY3JlYXRlcyBgTGlxdWlkUGxlZGdpbmdCYXNlYCBvbiB0aGUgYmxvY2tjaGFpbgogICAgLy8vIEBwYXJhbSBfdmF1bHQgVGhlIHZhdWx0IHdoZXJlIHRoZSBFVEggYmFja2luZyB0aGUgcGxlZGdlcyBpcyBzdG9yZWQKICAgIGZ1bmN0aW9uIExpcXVpZFBsZWRnaW5nQmFzZSgKICAgICAgICBhZGRyZXNzIF92YXVsdCwKICAgICAgICBhZGRyZXNzIF9lc2NhcGVIYXRjaENhbGxlciwKICAgICAgICBhZGRyZXNzIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uCiAgICApIEVzY2FwYWJsZShfZXNjYXBlSGF0Y2hDYWxsZXIsIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uKSBwdWJsaWMgewogICAgICAgIGFkbWlucy5sZW5ndGggPSAxOyAvLyB3ZSByZXNlcnZlIHRoZSAwIGFkbWluCiAgICAgICAgcGxlZGdlcy5sZW5ndGggPSAxOyAvLyB3ZSByZXNlcnZlIHRoZSAwIHBsZWRnZQogICAgICAgIHZhdWx0ID0gTFBWYXVsdChfdmF1bHQpOyAvLyBBc3NpZ25zIHRoZSBzcGVjaWZpZWQgdmF1bHQKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFBsZWRnZUFkbWluIGZ1bmN0aW9ucwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIEdpdmVyIEFkbWluIHdpdGggdGhlIGBtc2cuc2VuZGVyYCBhcyB0aGUgQWRtaW4gYWRkcmVzcwogICAgLy8vIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgR2l2ZXIncyBwcm9maWxlIG9mdGVuIGFuIElQRlMgaGFzaAogICAgLy8vIEBwYXJhbSBjb21taXRUaW1lIFRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBHaXZlciBoYXMgdG8KICAgIC8vLyAgIHZldG8gd2hlbiB0aGUgR2l2ZXIncyBkZWxlZ2F0ZXMgUGxlZGdlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgLy8vIEBwYXJhbSBwbHVnaW4gVGhpcyBpcyBHaXZlcidzIGxpcXVpZCBwbGVkZ2UgcGx1Z2luIGFsbG93aW5nIGZvciAKICAgIC8vLyAgZXh0ZW5kZWQgZnVuY3Rpb25hbGl0eQogICAgLy8vIEByZXR1cm4gaWRHaXZlciBUaGUgaWQgbnVtYmVyIHVzZWQgdG8gcmVmZXJlbmNlIHRoaXMgQWRtaW4KICAgIGZ1bmN0aW9uIGFkZEdpdmVyKAogICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgIHN0cmluZyB1cmwsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbgogICAgKSByZXR1cm5zICh1aW50NjQgaWRHaXZlcikgewoKICAgICAgICByZXF1aXJlKGlzVmFsaWRQbHVnaW4ocGx1Z2luKSk7IC8vIFBsdWdpbiBjaGVjawoKICAgICAgICBpZEdpdmVyID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLkdpdmVyLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICB1cmwsCiAgICAgICAgICAgIGNvbW1pdFRpbWUsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICBwbHVnaW4pKTsKCiAgICAgICAgR2l2ZXJBZGRlZChpZEdpdmVyKTsKICAgIH0KCiAgICBldmVudCBHaXZlckFkZGVkKHVpbnQ2NCBpbmRleGVkIGlkR2l2ZXIpOwoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgYSBHaXZlcidzIGluZm8gdG8gY2hhbmdlIHRoZSBhZGRyZXNzLCBuYW1lLCB1cmwsIG9yIAogICAgLy8vICBjb21taXRUaW1lLCBpdCBjYW5ub3QgYmUgdXNlZCB0byBjaGFuZ2UgYSBwbHVnaW4sIGFuZCBpdCBtdXN0IGJlIGNhbGxlZAogICAgLy8vICBieSB0aGUgY3VycmVudCBhZGRyZXNzIG9mIHRoZSBHaXZlcgogICAgLy8vIEBwYXJhbSBpZEdpdmVyIFRoaXMgaXMgdGhlIEFkbWluIGlkIG51bWJlciB1c2VkIHRvIHNwZWNpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld0FkZHIgVGhlIG5ldyBhZGRyZXNzIHRoYXQgcmVwcmVzZW50cyB0aGlzIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld05hbWUgVGhlIG5ldyBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIEdpdmVyCiAgICAvLy8gQHBhcmFtIG5ld1VybCBUaGUgbmV3IGxpbmsgdG8gdGhlIEdpdmVyJ3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcGFyYW0gbmV3Q29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBHaXZlciBoYXMgdG8KICAgIC8vLyAgIHZldG8gd2hlbiB0aGUgR2l2ZXIncyBkZWxlZ2F0ZXMgUGxlZGdlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgZnVuY3Rpb24gdXBkYXRlR2l2ZXIoCiAgICAgICAgdWludDY0IGlkR2l2ZXIsCiAgICAgICAgYWRkcmVzcyBuZXdBZGRyLAogICAgICAgIHN0cmluZyBuZXdOYW1lLAogICAgICAgIHN0cmluZyBuZXdVcmwsCiAgICAgICAgdWludDY0IG5ld0NvbW1pdFRpbWUpCiAgICB7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBnaXZlciA9IGZpbmRBZG1pbihpZEdpdmVyKTsKICAgICAgICByZXF1aXJlKGdpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpOyAvLyBNdXN0IGJlIGEgR2l2ZXIKICAgICAgICByZXF1aXJlKGdpdmVyLmFkZHIgPT0gbXNnLnNlbmRlcik7IC8vIEN1cnJlbnQgYWRkciBoYWQgdG8gc2VuZCB0aGlzIHR4CiAgICAgICAgZ2l2ZXIuYWRkciA9IG5ld0FkZHI7CiAgICAgICAgZ2l2ZXIubmFtZSA9IG5ld05hbWU7CiAgICAgICAgZ2l2ZXIudXJsID0gbmV3VXJsOwogICAgICAgIGdpdmVyLmNvbW1pdFRpbWUgPSBuZXdDb21taXRUaW1lOwogICAgICAgIEdpdmVyVXBkYXRlZChpZEdpdmVyKTsKICAgIH0KCiAgICBldmVudCBHaXZlclVwZGF0ZWQodWludDY0IGluZGV4ZWQgaWRHaXZlcik7CgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIERlbGVnYXRlIEFkbWluIHdpdGggdGhlIGBtc2cuc2VuZGVyYCBhcyB0aGUgQWRtaW4gYWRkcgogICAgLy8vIEBwYXJhbSBuYW1lIFRoZSBuYW1lIHVzZWQgdG8gaWRlbnRpZnkgdGhlIERlbGVnYXRlCiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgRGVsZWdhdGUncyBwcm9maWxlIG9mdGVuIGFuIElQRlMgaGFzaAogICAgLy8vIEBwYXJhbSBjb21taXRUaW1lIFNldHMgdGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhhdCB0aGlzIGRlbGVnYXRlCiAgICAvLy8gIGNhbiBiZSB2ZXRvZWQuIFdoZW5ldmVyIHRoaXMgZGVsZWdhdGUgaXMgaW4gYSBkZWxlZ2F0ZSBjaGFpbiB0aGUgdGltZQogICAgLy8vICBhbGxvd2VkIHRvIHZldG8gYW55IGV2ZW50IG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHRoaXMgdGltZS4KICAgIC8vLyBAcGFyYW0gcGx1Z2luIFRoaXMgaXMgRGVsZWdhdGUncyBsaXF1aWQgcGxlZGdlIHBsdWdpbiBhbGxvd2luZyBmb3IgCiAgICAvLy8gIGV4dGVuZGVkIGZ1bmN0aW9uYWxpdHkKICAgIC8vLyBAcmV0dXJuIGlkeERlbGVnYXRlIFRoZSBpZCBudW1iZXIgdXNlZCB0byByZWZlcmVuY2UgdGhpcyBEZWxlZ2F0ZSB3aXRoaW4KICAgIC8vLyAgdGhlIGFkbWlucyBhcnJheQogICAgZnVuY3Rpb24gYWRkRGVsZWdhdGUoCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICBJTGlxdWlkUGxlZGdpbmdQbHVnaW4gcGx1Z2luCiAgICApIHJldHVybnMgKHVpbnQ2NCBpZERlbGVnYXRlKSB7IAoKICAgICAgICByZXF1aXJlKGlzVmFsaWRQbHVnaW4ocGx1Z2luKSk7IC8vIFBsdWdpbiBjaGVjawoKICAgICAgICBpZERlbGVnYXRlID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLkRlbGVnYXRlLAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBuYW1lLAogICAgICAgICAgICB1cmwsCiAgICAgICAgICAgIGNvbW1pdFRpbWUsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICBwbHVnaW4pKTsKCiAgICAgICAgRGVsZWdhdGVBZGRlZChpZERlbGVnYXRlKTsKICAgIH0KCiAgICBldmVudCBEZWxlZ2F0ZUFkZGVkKHVpbnQ2NCBpbmRleGVkIGlkRGVsZWdhdGUpOwoKICAgIC8vLyBAbm90aWNlIFVwZGF0ZXMgYSBEZWxlZ2F0ZSdzIGluZm8gdG8gY2hhbmdlIHRoZSBhZGRyZXNzLCBuYW1lLCB1cmwsIG9yIAogICAgLy8vICBjb21taXRUaW1lLCBpdCBjYW5ub3QgYmUgdXNlZCB0byBjaGFuZ2UgYSBwbHVnaW4sIGFuZCBpdCBtdXN0IGJlIGNhbGxlZAogICAgLy8vICBieSB0aGUgY3VycmVudCBhZGRyZXNzIG9mIHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBpZERlbGVnYXRlIFRoZSBBZG1pbiBpZCBudW1iZXIgdXNlZCB0byBzcGVjaWZ5IHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdBZGRyIFRoZSBuZXcgYWRkcmVzcyB0aGF0IHJlcHJlc2VudHMgdGhpcyBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdOYW1lIFRoZSBuZXcgbmFtZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBEZWxlZ2F0ZQogICAgLy8vIEBwYXJhbSBuZXdVcmwgVGhlIG5ldyBsaW5rIHRvIHRoZSBEZWxlZ2F0ZSdzIHByb2ZpbGUgb2Z0ZW4gYW4gSVBGUyBoYXNoCiAgICAvLy8gQHBhcmFtIG5ld0NvbW1pdFRpbWUgU2V0cyB0aGUgbGVuZ3RoIG9mIHRpbWUgaW4gc2Vjb25kcyB0aGF0IHRoaXMgCiAgICAvLy8gIGRlbGVnYXRlIGNhbiBiZSB2ZXRvZWQuIFdoZW5ldmVyIHRoaXMgZGVsZWdhdGUgaXMgaW4gYSBkZWxlZ2F0ZSBjaGFpbiAKICAgIC8vLyAgdGhlIHRpbWUgYWxsb3dlZCB0byB2ZXRvIGFueSBldmVudCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0bwogICAgLy8vICB0aGlzIHRpbWUuCiAgICBmdW5jdGlvbiB1cGRhdGVEZWxlZ2F0ZSgKICAgICAgICB1aW50NjQgaWREZWxlZ2F0ZSwKICAgICAgICBhZGRyZXNzIG5ld0FkZHIsCiAgICAgICAgc3RyaW5nIG5ld05hbWUsCiAgICAgICAgc3RyaW5nIG5ld1VybCwKICAgICAgICB1aW50NjQgbmV3Q29tbWl0VGltZSkgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgZGVsZWdhdGUgPSBmaW5kQWRtaW4oaWREZWxlZ2F0ZSk7CiAgICAgICAgcmVxdWlyZShkZWxlZ2F0ZS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLkRlbGVnYXRlKTsKICAgICAgICByZXF1aXJlKGRlbGVnYXRlLmFkZHIgPT0gbXNnLnNlbmRlcik7Ly8gQ3VycmVudCBhZGRyIGhhZCB0byBzZW5kIHRoaXMgdHgKICAgICAgICBkZWxlZ2F0ZS5hZGRyID0gbmV3QWRkcjsKICAgICAgICBkZWxlZ2F0ZS5uYW1lID0gbmV3TmFtZTsKICAgICAgICBkZWxlZ2F0ZS51cmwgPSBuZXdVcmw7CiAgICAgICAgZGVsZWdhdGUuY29tbWl0VGltZSA9IG5ld0NvbW1pdFRpbWU7CiAgICAgICAgRGVsZWdhdGVVcGRhdGVkKGlkRGVsZWdhdGUpOwogICAgfQoKICAgIGV2ZW50IERlbGVnYXRlVXBkYXRlZCh1aW50NjQgaW5kZXhlZCBpZERlbGVnYXRlKTsKCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgUHJvamVjdCBBZG1pbiB3aXRoIHRoZSBgbXNnLnNlbmRlcmAgYXMgdGhlIEFkbWluIGFkZHIKICAgIC8vLyBAcGFyYW0gbmFtZSBUaGUgbmFtZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBQcm9qZWN0CiAgICAvLy8gQHBhcmFtIHVybCBUaGUgbGluayB0byB0aGUgUHJvamVjdCdzIHByb2ZpbGUgb2Z0ZW4gYW4gSVBGUyBoYXNoCiAgICAvLy8gQHBhcmFtIHByb2plY3RBZG1pbiBUaGUgYWRkcmVzcyBmb3IgdGhlIHRydXN0ZWQgcHJvamVjdCBtYW5hZ2VyIAogICAgLy8vIEBwYXJhbSBwYXJlbnRQcm9qZWN0IFRoZSBBZG1pbiBpZCBudW1iZXIgZm9yIHRoZSBwYXJlbnQgcHJvamVjdCBvciAwIGlmCiAgICAvLy8gIHRoZXJlIGlzIG5vIHBhcmVudFByb2plY3QKICAgIC8vLyBAcGFyYW0gY29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBQcm9qZWN0IGhhcyB0bwogICAgLy8vICAgdmV0byB3aGVuIHRoZSBQcm9qZWN0IGRlbGVnYXRlcyB0byBhbm90aGVyIERlbGVnYXRlIGFuZCB0aGV5IHBsZWRnZSAKICAgIC8vLyAgIHRob3NlIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgLy8vIEBwYXJhbSBwbHVnaW4gVGhpcyBpcyBQcm9qZWN0J3MgbGlxdWlkIHBsZWRnZSBwbHVnaW4gYWxsb3dpbmcgZm9yIAogICAgLy8vICBleHRlbmRlZCBmdW5jdGlvbmFsaXR5CiAgICAvLy8gQHJldHVybiBpZFByb2plY3QgVGhlIGlkIG51bWJlciB1c2VkIHRvIHJlZmVyZW5jZSB0aGlzIEFkbWluCiAgICBmdW5jdGlvbiBhZGRQcm9qZWN0KAogICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgIHN0cmluZyB1cmwsCiAgICAgICAgYWRkcmVzcyBwcm9qZWN0QWRtaW4sCiAgICAgICAgdWludDY0IHBhcmVudFByb2plY3QsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgSUxpcXVpZFBsZWRnaW5nUGx1Z2luIHBsdWdpbgogICAgKSByZXR1cm5zICh1aW50NjQgaWRQcm9qZWN0KSB7CiAgICAgICAgcmVxdWlyZShpc1ZhbGlkUGx1Z2luKHBsdWdpbikpOwoKICAgICAgICBpZiAocGFyZW50UHJvamVjdCAhPSAwKSB7CiAgICAgICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcGEgPSBmaW5kQWRtaW4ocGFyZW50UHJvamVjdCk7CiAgICAgICAgICAgIHJlcXVpcmUocGEuYWRtaW5UeXBlID09IFBsZWRnZUFkbWluVHlwZS5Qcm9qZWN0KTsKICAgICAgICAgICAgcmVxdWlyZShnZXRQcm9qZWN0TGV2ZWwocGEpIDwgTUFYX1NVQlBST0pFQ1RfTEVWRUwpOwogICAgICAgIH0KCiAgICAgICAgaWRQcm9qZWN0ID0gdWludDY0KGFkbWlucy5sZW5ndGgpOwoKICAgICAgICBhZG1pbnMucHVzaChQbGVkZ2VBZG1pbigKICAgICAgICAgICAgUGxlZGdlQWRtaW5UeXBlLlByb2plY3QsCiAgICAgICAgICAgIHByb2plY3RBZG1pbiwKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgdXJsLAogICAgICAgICAgICBjb21taXRUaW1lLAogICAgICAgICAgICBwYXJlbnRQcm9qZWN0LAogICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgcGx1Z2luKSk7CgoKICAgICAgICBQcm9qZWN0QWRkZWQoaWRQcm9qZWN0KTsKICAgIH0KCiAgICBldmVudCBQcm9qZWN0QWRkZWQodWludDY0IGluZGV4ZWQgaWRQcm9qZWN0KTsKCgogICAgLy8vIEBub3RpY2UgVXBkYXRlcyBhIFByb2plY3QncyBpbmZvIHRvIGNoYW5nZSB0aGUgYWRkcmVzcywgbmFtZSwgdXJsLCBvciAKICAgIC8vLyAgY29tbWl0VGltZSwgaXQgY2Fubm90IGJlIHVzZWQgdG8gY2hhbmdlIGEgcGx1Z2luIG9yIGEgcGFyZW50UHJvamVjdCwKICAgIC8vLyAgYW5kIGl0IG11c3QgYmUgY2FsbGVkIGJ5IHRoZSBjdXJyZW50IGFkZHJlc3Mgb2YgdGhlIFByb2plY3QKICAgIC8vLyBAcGFyYW0gaWRQcm9qZWN0IFRoZSBBZG1pbiBpZCBudW1iZXIgdXNlZCB0byBzcGVjaWZ5IHRoZSBQcm9qZWN0CiAgICAvLy8gQHBhcmFtIG5ld0FkZHIgVGhlIG5ldyBhZGRyZXNzIHRoYXQgcmVwcmVzZW50cyB0aGlzIFByb2plY3QKICAgIC8vLyBAcGFyYW0gbmV3TmFtZSBUaGUgbmV3IG5hbWUgdXNlZCB0byBpZGVudGlmeSB0aGUgUHJvamVjdAogICAgLy8vIEBwYXJhbSBuZXdVcmwgVGhlIG5ldyBsaW5rIHRvIHRoZSBQcm9qZWN0J3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcGFyYW0gbmV3Q29tbWl0VGltZSBTZXRzIHRoZSBsZW5ndGggb2YgdGltZSBpbiBzZWNvbmRzIHRoZSBQcm9qZWN0IGhhcwogICAgLy8vICB0byB2ZXRvIHdoZW4gdGhlIFByb2plY3QgZGVsZWdhdGVzIHRvIGEgRGVsZWdhdGUgYW5kIHRoZXkgcGxlZGdlIHRob3NlCiAgICAvLy8gIGZ1bmRzIHRvIGEgcHJvamVjdAogICAgZnVuY3Rpb24gdXBkYXRlUHJvamVjdCgKICAgICAgICB1aW50NjQgaWRQcm9qZWN0LAogICAgICAgIGFkZHJlc3MgbmV3QWRkciwKICAgICAgICBzdHJpbmcgbmV3TmFtZSwKICAgICAgICBzdHJpbmcgbmV3VXJsLAogICAgICAgIHVpbnQ2NCBuZXdDb21taXRUaW1lKQogICAgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcHJvamVjdCA9IGZpbmRBZG1pbihpZFByb2plY3QpOwogICAgICAgIHJlcXVpcmUocHJvamVjdC5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIHJlcXVpcmUocHJvamVjdC5hZGRyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHByb2plY3QuYWRkciA9IG5ld0FkZHI7CiAgICAgICAgcHJvamVjdC5uYW1lID0gbmV3TmFtZTsKICAgICAgICBwcm9qZWN0LnVybCA9IG5ld1VybDsKICAgICAgICBwcm9qZWN0LmNvbW1pdFRpbWUgPSBuZXdDb21taXRUaW1lOwogICAgICAgIFByb2plY3RVcGRhdGVkKGlkUHJvamVjdCk7CiAgICB9CgogICAgZXZlbnQgUHJvamVjdFVwZGF0ZWQodWludDY0IGluZGV4ZWQgaWRBZG1pbik7CgoKLy8vLy8vLy8vLwovLyBQdWJsaWMgY29uc3RhbnQgZnVuY3Rpb25zCi8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBBIGNvbnN0YW50IGdldHRlciB0aGF0IHJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBwbGVkZ2VzCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIFBsZWRnZXMgaW4gdGhlIHN5c3RlbQogICAgZnVuY3Rpb24gbnVtYmVyT2ZQbGVkZ2VzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwbGVkZ2VzLmxlbmd0aCAtIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdGhhdCByZXR1cm5zIHRoZSBkZXRhaWxzIG9mIHRoZSBzcGVjaWZpZWQgcGxlZGdlCiAgICAvLy8gQHBhcmFtIGlkUGxlZGdlIHRoZSBpZCBudW1iZXIgb2YgdGhlIHBsZWRnZSBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiB0aGUgYW1vdW50LCBvd25lciwgdGhlIG51bWJlciBvZiBkZWxlZ2F0ZXMgKGJ1dCBub3QgdGhlIGFjdHVhbAogICAgLy8vICBkZWxlZ2F0ZXMsIHRoZSBpbnRlbmRlZFByb2plY3QgKGlmIGFueSksIHRoZSBjdXJyZW50IGNvbW1pdCB0aW1lIGFuZAogICAgLy8vICB0aGUgcHJldmlvdXMgcGxlZGdlIHRoaXMgcGxlZGdlIHdhcyBkZXJpdmVkIGZyb20KICAgIGZ1bmN0aW9uIGdldFBsZWRnZSh1aW50NjQgaWRQbGVkZ2UpIGNvbnN0YW50IHJldHVybnMoCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IG93bmVyLAogICAgICAgIHVpbnQ2NCBuRGVsZWdhdGVzLAogICAgICAgIHVpbnQ2NCBpbnRlbmRlZFByb2plY3QsCiAgICAgICAgdWludDY0IGNvbW1pdFRpbWUsCiAgICAgICAgdWludDY0IG9sZFBsZWRnZSwKICAgICAgICBQbGVkZ2VTdGF0ZSBwbGVkZ2VTdGF0ZQogICAgKSB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIGFtb3VudCA9IHAuYW1vdW50OwogICAgICAgIG93bmVyID0gcC5vd25lcjsKICAgICAgICBuRGVsZWdhdGVzID0gdWludDY0KHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aCk7CiAgICAgICAgaW50ZW5kZWRQcm9qZWN0ID0gcC5pbnRlbmRlZFByb2plY3Q7CiAgICAgICAgY29tbWl0VGltZSA9IHAuY29tbWl0VGltZTsKICAgICAgICBvbGRQbGVkZ2UgPSBwLm9sZFBsZWRnZTsKICAgICAgICBwbGVkZ2VTdGF0ZSA9IHAucGxlZGdlU3RhdGU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0dGVyIHRvIGZpbmQgRGVsZWdhdGUgdy8gdGhlIFBsZWRnZSBJRCAmIHRoZSBEZWxlZ2F0ZSBpbmRleAogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBUaGUgaWQgbnVtYmVyIHJlcHJlc2VudGluZyB0aGUgcGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gaWR4RGVsZWdhdGUgVGhlIGluZGV4IG51bWJlciBmb3IgdGhlIGRlbGVnYXRlIGluIHRoaXMgUGxlZGdlIAogICAgZnVuY3Rpb24gZ2V0UGxlZGdlRGVsZWdhdGUodWludDY0IGlkUGxlZGdlLCB1aW50IGlkeERlbGVnYXRlKSBjb25zdGFudCByZXR1cm5zKAogICAgICAgIHVpbnQ2NCBpZERlbGVnYXRlLAogICAgICAgIGFkZHJlc3MgYWRkciwKICAgICAgICBzdHJpbmcgbmFtZQogICAgKSB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIGlkRGVsZWdhdGUgPSBwLmRlbGVnYXRpb25DaGFpbltpZHhEZWxlZ2F0ZSAtIDFdOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgZGVsZWdhdGUgPSBmaW5kQWRtaW4oaWREZWxlZ2F0ZSk7CiAgICAgICAgYWRkciA9IGRlbGVnYXRlLmFkZHI7CiAgICAgICAgbmFtZSA9IGRlbGVnYXRlLm5hbWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBjb25zdGFudCBnZXR0ZXIgdXNlZCB0byBjaGVjayBob3cgbWFueSB0b3RhbCBBZG1pbnMgZXhpc3QKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgYWRtaW5zIChHaXZlcnMsIERlbGVnYXRlcyBhbmQgUHJvamVjdHMpIC4KICAgIGZ1bmN0aW9uIG51bWJlck9mUGxlZGdlQWRtaW5zKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFkbWlucy5sZW5ndGggLSAxOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEEgY29uc3RhbnQgZ2V0dGVyIHRvIGNoZWNrIHRoZSBkZXRhaWxzIG9mIGEgc3BlY2lmaWVkIEFkbWluICAKICAgIC8vLyBAcmV0dXJuIGFkZHIgQWNjb3VudCBvciBjb250cmFjdCBhZGRyZXNzIGZvciBhZG1pbgogICAgLy8vIEByZXR1cm4gbmFtZSBOYW1lIG9mIHRoZSBwbGVkZ2VBZG1pbgogICAgLy8vIEByZXR1cm4gdXJsIFRoZSBsaW5rIHRvIHRoZSBQcm9qZWN0J3MgcHJvZmlsZSBvZnRlbiBhbiBJUEZTIGhhc2gKICAgIC8vLyBAcmV0dXJuIGNvbW1pdFRpbWUgVGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhlIEFkbWluIGhhcyB0byB2ZXRvCiAgICAvLy8gICB3aGVuIHRoZSBBZG1pbiBkZWxlZ2F0ZXMgdG8gYSBEZWxlZ2F0ZSBhbmQgdGhhdCBEZWxlZ2F0ZSBwbGVkZ2VzIHRob3NlCiAgICAvLy8gICBmdW5kcyB0byBhIHByb2plY3QKICAgIC8vLyBAcmV0dXJuIHBhcmVudFByb2plY3QgVGhlIEFkbWluIGlkIG51bWJlciBmb3IgdGhlIHBhcmVudCBwcm9qZWN0IG9yIDAKICAgIC8vLyAgaWYgdGhlcmUgaXMgbm8gcGFyZW50UHJvamVjdAogICAgLy8vIEByZXR1cm4gY2FuY2VsZWQgMCBmb3IgRGVsZWdhdGVzICYgR2l2ZXJzLCB0cnVlIGlmIGEgUHJvamVjdCBoYXMgYmVlbiAKICAgIC8vLyAgY2FuY2VsZWQKICAgIC8vLyBAcmV0dXJuIHBsdWdpbiBUaGlzIGlzIFByb2plY3QncyBsaXF1aWRQbGVkZ2luZyBwbHVnaW4gYWxsb3dpbmcgZm9yIAogICAgLy8vICBleHRlbmRlZCBmdW5jdGlvbmFsaXR5CiAgICBmdW5jdGlvbiBnZXRQbGVkZ2VBZG1pbih1aW50NjQgaWRBZG1pbikgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgICAgUGxlZGdlQWRtaW5UeXBlIGFkbWluVHlwZSwKICAgICAgICBhZGRyZXNzIGFkZHIsCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICB1aW50NjQgcGFyZW50UHJvamVjdCwKICAgICAgICBib29sIGNhbmNlbGVkLAogICAgICAgIGFkZHJlc3MgcGx1Z2luKQogICAgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgbSA9IGZpbmRBZG1pbihpZEFkbWluKTsKICAgICAgICBhZG1pblR5cGUgPSBtLmFkbWluVHlwZTsKICAgICAgICBhZGRyID0gbS5hZGRyOwogICAgICAgIG5hbWUgPSBtLm5hbWU7CiAgICAgICAgdXJsID0gbS51cmw7CiAgICAgICAgY29tbWl0VGltZSA9IG0uY29tbWl0VGltZTsKICAgICAgICBwYXJlbnRQcm9qZWN0ID0gbS5wYXJlbnRQcm9qZWN0OwogICAgICAgIGNhbmNlbGVkID0gbS5jYW5jZWxlZDsKICAgICAgICBwbHVnaW4gPSBhZGRyZXNzKG0ucGx1Z2luKTsKICAgIH0KCi8vLy8vLy8vCi8vIFByaXZhdGUgbWV0aG9kcwovLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBjcmVhdGVzIGEgUGxlZGdlIHdpdGggYW4gaW5pdGlhbCBhbW91bnQgb2YgMCBpZiBvbmUgaXMgbm90CiAgICAvLy8gIGNyZWF0ZWQgYWxyZWFkeTsgb3RoZXJ3aXNlIGl0IGZpbmRzIHRoZSBwbGVkZ2Ugd2l0aCB0aGUgc3BlY2lmaWVkCiAgICAvLy8gIGF0dHJpYnV0ZXM7IGFsbCBwbGVkZ2VzIHRlY2huaWNhbGx5IGV4aXN0LCBpZiB0aGUgcGxlZGdlIGhhc24ndCBiZWVuCiAgICAvLy8gIGNyZWF0ZWQgaW4gdGhpcyBzeXN0ZW0geWV0IGl0IHNpbXBseSBpc24ndCBpbiB0aGUgaGFzaCBhcnJheQogICAgLy8vICBoUGxlZGdlMmlkeFtdIHlldAogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgb3duZXIgb2YgdGhlIHBsZWRnZSBiZWluZyBsb29rZWQgdXAKICAgIC8vLyBAcGFyYW0gZGVsZWdhdGlvbkNoYWluIFRoZSBsaXN0IG9mIGRlbGVnYXRlcyBpbiBvcmRlciBvZiBhdXRob3JpdHkKICAgIC8vLyBAcGFyYW0gaW50ZW5kZWRQcm9qZWN0IFRoZSBwcm9qZWN0IHRoaXMgcGxlZGdlIHdpbGwgRnVuZCBhZnRlciB0aGUKICAgIC8vLyAgY29tbWl0VGltZSBoYXMgcGFzc2VkCiAgICAvLy8gQHBhcmFtIGNvbW1pdFRpbWUgVGhlIGxlbmd0aCBvZiB0aW1lIGluIHNlY29uZHMgdGhlIEdpdmVyIGhhcyB0bwogICAgLy8vICAgdmV0byB3aGVuIHRoZSBHaXZlcidzIGRlbGVnYXRlcyBQbGVkZ2UgZnVuZHMgdG8gYSBwcm9qZWN0CiAgICAvLy8gQHBhcmFtIG9sZFBsZWRnZSBUaGlzIHZhbHVlIGlzIHVzZWQgdG8gc3RvcmUgdGhlIHBsZWRnZSB0aGUgY3VycmVudAogICAgLy8vICBwbGVkZ2Ugd2FzIGNhbWUgZnJvbSwgYW5kIGluIHRoZSBjYXNlIGEgUHJvamVjdCBpcyBjYW5jZWxlZCwgdGhlIFBsZWRnZQogICAgLy8vICB3aWxsIHJldmVydCBiYWNrIHRvIGl0J3MgcHJldmlvdXMgc3RhdGUKICAgIC8vLyBAcGFyYW0gc3RhdGUgVGhlIHBsZWRnZSBzdGF0ZTogUGxlZGdlZCwgUGF5aW5nLCBvciBzdGF0ZQogICAgLy8vIEByZXR1cm4gVGhlIGhQbGVkZ2UyaWR4IGluZGV4IG51bWJlcgogICAgZnVuY3Rpb24gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgIHVpbnQ2NCBvd25lciwKICAgICAgICB1aW50NjRbXSBkZWxlZ2F0aW9uQ2hhaW4sCiAgICAgICAgdWludDY0IGludGVuZGVkUHJvamVjdCwKICAgICAgICB1aW50NjQgY29tbWl0VGltZSwKICAgICAgICB1aW50NjQgb2xkUGxlZGdlLAogICAgICAgIFBsZWRnZVN0YXRlIHN0YXRlCiAgICAgICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50NjQpCiAgICB7CiAgICAgICAgYnl0ZXMzMiBoUGxlZGdlID0gc2hhMygKICAgICAgICAgICAgb3duZXIsIGRlbGVnYXRpb25DaGFpbiwgaW50ZW5kZWRQcm9qZWN0LCBjb21taXRUaW1lLCBvbGRQbGVkZ2UsIHN0YXRlKTsKICAgICAgICB1aW50NjQgaWR4ID0gaFBsZWRnZTJpZHhbaFBsZWRnZV07CiAgICAgICAgaWYgKGlkeCA+IDApIHJldHVybiBpZHg7CiAgICAgICAgaWR4ID0gdWludDY0KHBsZWRnZXMubGVuZ3RoKTsKICAgICAgICBoUGxlZGdlMmlkeFtoUGxlZGdlXSA9IGlkeDsKICAgICAgICBwbGVkZ2VzLnB1c2goUGxlZGdlKAogICAgICAgICAgICAwLCBvd25lciwgZGVsZWdhdGlvbkNoYWluLCBpbnRlbmRlZFByb2plY3QsIGNvbW1pdFRpbWUsIG9sZFBsZWRnZSwgc3RhdGUpKTsKICAgICAgICByZXR1cm4gaWR4OwogICAgfQoKICAgIC8vLyBAbm90aWNlIEEgZ2V0dGVyIHRvIGxvb2sgdXAgYSBBZG1pbidzIGRldGFpbHMKICAgIC8vLyBAcGFyYW0gaWRBZG1pbiBUaGUgaWQgZm9yIHRoZSBBZG1pbiB0byBsb29rdXAKICAgIC8vLyBAcmV0dXJuIFRoZSBQbGVkZ2VBZG1pbiBzdHJ1Y3QgZm9yIHRoZSBzcGVjaWZpZWQgQWRtaW4KICAgIGZ1bmN0aW9uIGZpbmRBZG1pbih1aW50NjQgaWRBZG1pbikgaW50ZXJuYWwgcmV0dXJucyAoUGxlZGdlQWRtaW4gc3RvcmFnZSkgewogICAgICAgIHJlcXVpcmUoaWRBZG1pbiA8IGFkbWlucy5sZW5ndGgpOwogICAgICAgIHJldHVybiBhZG1pbnNbaWRBZG1pbl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gbG9vayB1cCBhIFBsZWRnZSdzIGRldGFpbHMKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhlIGlkIGZvciB0aGUgUGxlZGdlIHRvIGxvb2t1cAogICAgLy8vIEByZXR1cm4gVGhlIFBsZWRnZUEgc3RydWN0IGZvciB0aGUgc3BlY2lmaWVkIFBsZWRnZQogICAgZnVuY3Rpb24gZmluZFBsZWRnZSh1aW50NjQgaWRQbGVkZ2UpIGludGVybmFsIHJldHVybnMgKFBsZWRnZSBzdG9yYWdlKSB7CiAgICAgICAgcmVxdWlyZShpZFBsZWRnZSA8IHBsZWRnZXMubGVuZ3RoKTsKICAgICAgICByZXR1cm4gcGxlZGdlc1tpZFBsZWRnZV07CiAgICB9CgogICAgLy8gYSBjb25zdGFudCBmb3Igd2hlbiBhIGRlbGVnYXRlIGlzIHJlcXVlc3RlZCB0aGF0IGlzIG5vdCBpbiB0aGUgc3lzdGVtCiAgICB1aW50NjQgY29uc3RhbnQgIE5PVEZPVU5EID0gMHhGRkZGRkZGRkZGRkZGRkZGOwoKICAgIC8vLyBAbm90aWNlIEEgZ2V0dGVyIHRoYXQgc2VhcmNoZXMgdGhlIGRlbGVnYXRpb25DaGFpbiBmb3IgdGhlIGxldmVsIG9mCiAgICAvLy8gIGF1dGhvcml0eSBhIHNwZWNpZmljIGRlbGVnYXRlIGhhcyB3aXRoaW4gYSBQbGVkZ2UKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIHRoYXQgd2lsbCBiZSBzZWFyY2hlZAogICAgLy8vIEBwYXJhbSBpZERlbGVnYXRlIFRoZSBzcGVjaWZpZWQgZGVsZWdhdGUgdGhhdCdzIHNlYXJjaGVkIGZvcgogICAgLy8vIEByZXR1cm4gSWYgdGhlIGRlbGVnYXRlIGNoYWluIGNvbnRhaW5zIHRoZSBkZWxlZ2F0ZSB3aXRoIHRoZQogICAgLy8vICBgYWRtaW5zYCBhcnJheSBpbmRleCBgaWREZWxlZ2F0ZWAgdGhpcyByZXR1cm5zIHRoYXQgZGVsZWdhdGVzCiAgICAvLy8gIGNvcnJlc3BvbmRpbmcgaW5kZXggaW4gdGhlIGRlbGVnYXRpb25DaGFpbi4gT3RoZXJ3aXNlIGl0IHJldHVybnMKICAgIC8vLyAgdGhlIE5PVEZPVU5EIGNvbnN0YW50CiAgICBmdW5jdGlvbiBnZXREZWxlZ2F0ZUlkeChQbGVkZ2UgcCwgdWludDY0IGlkRGVsZWdhdGUpIGludGVybmFsIHJldHVybnModWludDY0KSB7CiAgICAgICAgZm9yICh1aW50IGk9MDsgaSA8IHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwLmRlbGVnYXRpb25DaGFpbltpXSA9PSBpZERlbGVnYXRlKSByZXR1cm4gdWludDY0KGkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gTk9URk9VTkQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCBob3cgbWFueSBvbGQgInBhcmVudCIgcGxlZGdlcyBhIHNwZWNpZmljIFBsZWRnZQogICAgLy8vICBoYWQgdXNpbmcgYSBzZWxmLXJlZmVyZW50aWFsIGxvb3AKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2xkICJwYXJlbnQiIHBsZWRnZXMgYSBzcGVjaWZpYyBQbGVkZ2UgaGFkCiAgICBmdW5jdGlvbiBnZXRQbGVkZ2VMZXZlbChQbGVkZ2UgcCkgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKHAub2xkUGxlZGdlID09IDApIHJldHVybiAwOwogICAgICAgIFBsZWRnZSBzdG9yYWdlIG9sZE4gPSBmaW5kUGxlZGdlKHAub2xkUGxlZGdlKTsKICAgICAgICByZXR1cm4gZ2V0UGxlZGdlTGV2ZWwob2xkTikgKyAxOyAvLyBhIGxvb3AgbG9va3VwCiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCB0aGUgbG9uZ2VzdCBjb21taXRUaW1lIG91dCBvZiB0aGUgb3duZXIgYW5kIGFsbAogICAgLy8vICB0aGUgZGVsZWdhdGVzIGZvciBhIHNwZWNpZmllZCBwbGVkZ2UKICAgIC8vLyBAcGFyYW0gcCBUaGUgUGxlZGdlIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBtYXhpbXVtIGNvbW1pdFRpbWUgb3V0IG9mIHRoZSBvd25lciBhbmQgYWxsIHRoZSBkZWxlZ2F0ZXMKICAgIGZ1bmN0aW9uIG1heENvbW1pdFRpbWUoUGxlZGdlIHApIGludGVybmFsIHJldHVybnModWludCBjb21taXRUaW1lKSB7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBtID0gZmluZEFkbWluKHAub3duZXIpOwogICAgICAgIGNvbW1pdFRpbWUgPSBtLmNvbW1pdFRpbWU7IC8vIHN0YXJ0IHdpdGggdGhlIG93bmVyJ3MgY29tbWl0VGltZQoKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG0gPSBmaW5kQWRtaW4ocC5kZWxlZ2F0aW9uQ2hhaW5baV0pOwoKICAgICAgICAgICAgLy8gSWYgYSBkZWxlZ2F0ZSdzIGNvbW1pdFRpbWUgaXMgbG9uZ2VyLCBtYWtlIGl0IHRoZSBuZXcgY29tbWl0VGltZQogICAgICAgICAgICBpZiAobS5jb21taXRUaW1lID4gY29tbWl0VGltZSkgY29tbWl0VGltZSA9IG0uY29tbWl0VGltZTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCB0aGUgbGV2ZWwgb2YgYXV0aG9yaXR5IGEgc3BlY2lmaWMgUHJvamVjdCBoYXMKICAgIC8vLyAgdXNpbmcgYSBzZWxmLXJlZmVyZW50aWFsIGxvb3AKICAgIC8vLyBAcGFyYW0gbSBUaGUgUHJvamVjdCBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgbGV2ZWwgb2YgYXV0aG9yaXR5IGEgc3BlY2lmaWMgUHJvamVjdCBoYXMKICAgIGZ1bmN0aW9uIGdldFByb2plY3RMZXZlbChQbGVkZ2VBZG1pbiBtKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICBhc3NlcnQobS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIGlmIChtLnBhcmVudFByb2plY3QgPT0gMCkgcmV0dXJuKDEpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcGFyZW50Tk0gPSBmaW5kQWRtaW4obS5wYXJlbnRQcm9qZWN0KTsKICAgICAgICByZXR1cm4gZ2V0UHJvamVjdExldmVsKHBhcmVudE5NKSArIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQSBnZXR0ZXIgdG8gZmluZCBpZiBhIHNwZWNpZmllZCBQcm9qZWN0IGhhcyBiZWVuIGNhbmNlbGVkCiAgICAvLy8gQHBhcmFtIHByb2plY3RJZCBUaGUgQWRtaW4gaWQgbnVtYmVyIHVzZWQgdG8gc3BlY2lmeSB0aGUgUHJvamVjdAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgUHJvamVjdCBoYXMgYmVlbiBjYW5jZWxlZAogICAgZnVuY3Rpb24gaXNQcm9qZWN0Q2FuY2VsZWQodWludDY0IHByb2plY3RJZCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgbSA9IGZpbmRBZG1pbihwcm9qZWN0SWQpOwogICAgICAgIGlmIChtLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlcnQobS5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpOwogICAgICAgIGlmIChtLmNhbmNlbGVkKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAobS5wYXJlbnRQcm9qZWN0ID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gaXNQcm9qZWN0Q2FuY2VsZWQobS5wYXJlbnRQcm9qZWN0KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBIGdldHRlciB0byBmaW5kIHRoZSBvbGRlc3QgcGxlZGdlIHRoYXQgaGFzbid0IGJlZW4gY2FuY2VsZWQKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgVGhlIHN0YXJ0aW5nIHBsYWNlIHRvIGxvb2t1cCB0aGUgcGxlZGdlcyAKICAgIC8vLyBAcmV0dXJuIFRoZSBvbGRlc3QgaWRQbGVkZ2UgdGhhdCBoYXNuJ3QgYmVlbiBjYW5jZWxlZCAoRFVIISkKICAgIGZ1bmN0aW9uIGdldE9sZGVzdFBsZWRnZU5vdENhbmNlbGVkKHVpbnQ2NCBpZFBsZWRnZQogICAgICAgICkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50NjQpIHsKICAgICAgICBpZiAoaWRQbGVkZ2UgPT0gMCkgcmV0dXJuIDA7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgYWRtaW4gPSBmaW5kQWRtaW4ocC5vd25lcik7CiAgICAgICAgaWYgKGFkbWluLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHJldHVybiBpZFBsZWRnZTsKCiAgICAgICAgYXNzZXJ0KGFkbWluLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuUHJvamVjdCk7CgogICAgICAgIGlmICghaXNQcm9qZWN0Q2FuY2VsZWQocC5vd25lcikpIHJldHVybiBpZFBsZWRnZTsKCiAgICAgICAgcmV0dXJuIGdldE9sZGVzdFBsZWRnZU5vdENhbmNlbGVkKHAub2xkUGxlZGdlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBIGNoZWNrIHRvIHNlZSBpZiB0aGUgbXNnLnNlbmRlciBpcyB0aGUgb3duZXIgb3IgdGhlCiAgICAvLy8gIHBsdWdpbiBjb250cmFjdCBmb3IgYSBzcGVjaWZpYyBBZG1pbgogICAgLy8vIEBwYXJhbSBtIFRoZSBBZG1pbiBiZWluZyBjaGVja2VkCiAgICBmdW5jdGlvbiBjaGVja0FkbWluT3duZXIoUGxlZGdlQWRtaW4gbSkgaW50ZXJuYWwgY29uc3RhbnQgewogICAgICAgIHJlcXVpcmUoKG1zZy5zZW5kZXIgPT0gbS5hZGRyKSB8fCAobXNnLnNlbmRlciA9PSBhZGRyZXNzKG0ucGx1Z2luKSkpOwogICAgfQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gUGx1Z2luIFdoaXRlbGlzdCBNZXRob2RzCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIGFkZFZhbGlkUGx1Z2luKGJ5dGVzMzIgY29udHJhY3RIYXNoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHBsdWdpbldoaXRlbGlzdFtjb250cmFjdEhhc2hdID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVWYWxpZFBsdWdpbihieXRlczMyIGNvbnRyYWN0SGFzaCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBwbHVnaW5XaGl0ZWxpc3RbY29udHJhY3RIYXNoXSA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVzZVdoaXRlbGlzdChib29sIHVzZVdoaXRlbGlzdCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICB1c2VQbHVnaW5XaGl0ZWxpc3QgPSB1c2VXaGl0ZWxpc3Q7CiAgICB9CgogICAgZnVuY3Rpb24gaXNWYWxpZFBsdWdpbihhZGRyZXNzIGFkZHIpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAoIXVzZVBsdWdpbldoaXRlbGlzdCB8fCBhZGRyID09IDB4MCkgcmV0dXJuIHRydWU7CgogICAgICAgIGJ5dGVzMzIgY29udHJhY3RIYXNoID0gZ2V0Q29kZUhhc2goYWRkcik7CgogICAgICAgIHJldHVybiBwbHVnaW5XaGl0ZWxpc3RbY29udHJhY3RIYXNoXTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb2RlSGFzaChhZGRyZXNzIGFkZHIpIHB1YmxpYyByZXR1cm5zKGJ5dGVzMzIpIHsKICAgICAgICBieXRlcyBtZW1vcnkgb19jb2RlOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gcmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUsIHRoaXMgbmVlZHMgYXNzZW1ibHkKICAgICAgICAgICAgbGV0IHNpemUgOj0gZXh0Y29kZXNpemUoYWRkcikKICAgICAgICAgICAgLy8gYWxsb2NhdGUgb3V0cHV0IGJ5dGUgYXJyYXkgLSB0aGlzIGNvdWxkIGFsc28gYmUgZG9uZSB3aXRob3V0IGFzc2VtYmx5CiAgICAgICAgICAgIC8vIGJ5IHVzaW5nIG9fY29kZSA9IG5ldyBieXRlcyhzaXplKQogICAgICAgICAgICBvX2NvZGUgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgLy8gbmV3ICJtZW1vcnkgZW5kIiBpbmNsdWRpbmcgcGFkZGluZwogICAgICAgICAgICBtc3RvcmUoMHg0MCwgYWRkKG9fY29kZSwgYW5kKGFkZChhZGQoc2l6ZSwgMHgyMCksIDB4MWYpLCBub3QoMHgxZikpKSkKICAgICAgICAgICAgLy8gc3RvcmUgbGVuZ3RoIGluIG1lbW9yeQogICAgICAgICAgICBtc3RvcmUob19jb2RlLCBzaXplKQogICAgICAgICAgICAvLyBhY3R1YWxseSByZXRyaWV2ZSB0aGUgY29kZSwgdGhpcyBuZWVkcyBhc3NlbWJseQogICAgICAgICAgICBleHRjb2RlY29weShhZGRyLCBhZGQob19jb2RlLCAweDIwKSwgMCwgc2l6ZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGtlY2NhazI1NihvX2NvZGUpOwogICAgfQp9CgovL0ZpbGU6IGNvbnRyYWN0cy9MaXF1aWRQbGVkZ2luZy5zb2wKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKgogICAgQ29weXJpZ2h0IDIwMTcsIEpvcmRpIEJheWxpbmEKICAgIENvbnRyaWJ1dG9yczogQWRyaSYjMjI0OyBNYXNzYW5ldCA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJjMWEwYTViM2E4YTA4MWEyYWVhNWE0YTJhZWFmYjVhNGI5YjVlZmE4YWUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+PiwgUkogRXdpbmcsIEdyaWZmCiAgICBHcmVlbiwgQXJ0aHVyIEx1bm4KCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoqLwoKCgovLy8gQGRldiBgTGlxdWlkUGxlZGluZ2AgYWxsb3dzIGZvciBsaXF1aWQgcGxlZGdpbmcgdGhyb3VnaCB0aGUgdXNlIG9mCi8vLyAgaW50ZXJuYWwgaWQgc3RydWN0dXJlcyBhbmQgZGVsZWdhdGUgY2hhaW5pbmcuIEFsbCBiYXNpYyBvcGVyYXRpb25zIGZvcgovLy8gIGhhbmRsaW5nIGxpcXVpZCBwbGVkZ2luZyBhcmUgc3VwcGxpZWQgYXMgd2VsbCBhcyBwbHVnaW4gZmVhdHVyZXMKLy8vICB0byBhbGxvdyBmb3IgZXhwYW5kZWQgZnVuY3Rpb25hbGl0eS4KY29udHJhY3QgTGlxdWlkUGxlZGdpbmcgaXMgTGlxdWlkUGxlZGdpbmdCYXNlIHsKCgovLy8vLy8KLy8gQ29uc3RydWN0b3IKLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQmFzaWMgY29uc3RydWN0b3IgZm9yIExpcXVpZFBsZWRpbmcsIGFsc28gY2FsbHMgdGhlCiAgICAvLy8gIExpcXVpZFBsZWRnaW5nQmFzZSBjb250cmFjdAogICAgLy8vIEBkZXYgVGhpcyBjb25zdHJ1Y3RvciAgYWxzbyBjYWxscyB0aGUgY29uc3RydWN0b3IgCiAgICAvLy8gIGZvciBgTGlxdWlkUGxlZGdpbmdCYXNlYAogICAgLy8vIEBwYXJhbSBfdmF1bHQgVGhlIHZhdWx0IHdoZXJlIEVUSCBiYWNraW5nIHRoaXMgcGxlZGdlIGlzIHN0b3JlZAogICAgZnVuY3Rpb24gTGlxdWlkUGxlZGdpbmcoCiAgICAgICAgYWRkcmVzcyBfdmF1bHQsCiAgICAgICAgYWRkcmVzcyBfZXNjYXBlSGF0Y2hDYWxsZXIsCiAgICAgICAgYWRkcmVzcyBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbgogICAgKSBMaXF1aWRQbGVkZ2luZ0Jhc2UoX3ZhdWx0LCBfZXNjYXBlSGF0Y2hDYWxsZXIsIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uKSB7CgogICAgfQoKICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgaG93IHZhbHVlIGVudGVycyB0aGUgc3lzdGVtIGFuZCBob3cgcGxlZGdlcyBhcmUgY3JlYXRlZDsKICAgIC8vLyAgdGhlIGV0aGVyIGlzIHNlbnQgdG8gdGhlIHZhdWx0LCBhbiBwbGVkZ2UgZm9yIHRoZSBHaXZlciBpcyBjcmVhdGVkIChvcgogICAgLy8vICBmb3VuZCksIHRoZSBhbW91bnQgb2YgRVRIIGRvbmF0ZWQgaW4gd2VpIGlzIGFkZGVkIHRvIHRoZSBgYW1vdW50YCBpbgogICAgLy8vICB0aGUgR2l2ZXIncyBQbGVkZ2UsIGFuZCBhbiBMUCB0cmFuc2ZlciBpcyBkb25lIHRvIHRoZSBpZFJlY2VpdmVyIGZvcgogICAgLy8vICB0aGUgZnVsbCBhbW91bnQKICAgIC8vLyBAcGFyYW0gaWRHaXZlciBUaGUgaWQgb2YgdGhlIEdpdmVyIGRvbmF0aW5nOyBpZiAwLCBhIG5ldyBpZCBpcyBjcmVhdGVkCiAgICAvLy8gQHBhcmFtIGlkUmVjZWl2ZXIgVGhlIEFkbWluIHJlY2VpdmluZyB0aGUgZG9uYXRpb247IGNhbiBiZSBhbnkgQWRtaW46CiAgICAvLy8gIHRoZSBHaXZlciB0aGVtc2VsdmVzLCBhbm90aGVyIEdpdmVyLCBhIERlbGVnYXRlIG9yIGEgUHJvamVjdAogICAgZnVuY3Rpb24gZG9uYXRlKHVpbnQ2NCBpZEdpdmVyLCB1aW50NjQgaWRSZWNlaXZlcikgcGF5YWJsZSB7CiAgICAgICAgaWYgKGlkR2l2ZXIgPT0gMCkgewoKICAgICAgICAgICAgLy8gZGVmYXVsdCB0byBhIDMgZGF5ICgyNTkyMDAgc2Vjb25kcykgY29tbWl0VGltZQogICAgICAgICAgICBpZEdpdmVyID0gYWRkR2l2ZXIoIiIsICIiLCAyNTkyMDAsIElMaXF1aWRQbGVkZ2luZ1BsdWdpbigweDApKTsKICAgICAgICB9CgogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2Ugc2VuZGVyID0gZmluZEFkbWluKGlkR2l2ZXIpOwogICAgICAgIGNoZWNrQWRtaW5Pd25lcihzZW5kZXIpOwogICAgICAgIHJlcXVpcmUoc2VuZGVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpOwogICAgICAgIHVpbnQgYW1vdW50ID0gbXNnLnZhbHVlOwogICAgICAgIHJlcXVpcmUoYW1vdW50ID4gMCk7CiAgICAgICAgdmF1bHQudHJhbnNmZXIoYW1vdW50KTsgLy8gU2VuZHMgdGhlIGBtc2cudmFsdWVgIChpbiB3ZWkpIHRvIHRoZSBgdmF1bHRgCiAgICAgICAgdWludDY0IGlkUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBpZEdpdmVyLAogICAgICAgICAgICBuZXcgdWludDY0W10oMCksIC8vIENyZWF0ZXMgZW1wdHkgYXJyYXkgZm9yIGRlbGVnYXRpb25DaGFpbgogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKCgogICAgICAgIFBsZWRnZSBzdG9yYWdlIG5UbyA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIG5Uby5hbW91bnQgKz0gYW1vdW50OwoKICAgICAgICBUcmFuc2ZlcigwLCBpZFBsZWRnZSwgYW1vdW50KTsgLy8gQW4gZXZlbnQKCiAgICAgICAgdHJhbnNmZXIoaWRHaXZlciwgaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7IC8vIExQIGFjY291bnRpbmcKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlcnMgYW1vdW50cyBiZXR3ZWVuIHBsZWRnZXMgZm9yIGludGVybmFsIGFjY291bnRpbmcgCiAgICAvLy8gQHBhcmFtIGlkU2VuZGVyIElkIG9mIHRoZSBBZG1pbiB0aGF0IGlzIHRyYW5zZmVycmluZyB0aGUgYW1vdW50IGZyb20KICAgIC8vLyAgUGxlZGdlIHRvIFBsZWRnZTsgdGhpcyBhZG1pbiBtdXN0IGhhdmUgcGVybWlzc2lvbnMgdG8gbW92ZSB0aGUgdmFsdWUKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0J3MgbW92aW5nIHRoZSB2YWx1ZQogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgRVRIIChpbiB3ZWkpIHRoYXQgdGhpcyBwbGVkZ2UgaXMgdHJhbnNmZXJyaW5nIAogICAgLy8vICB0aGUgYXV0aG9yaXR5IHRvIHdpdGhkcmF3IGZyb20gdGhlIHZhdWx0CiAgICAvLy8gQHBhcmFtIGlkUmVjZWl2ZXIgRGVzdGluYXRpb24gb2YgdGhlIGBhbW91bnRgLCBjYW4gYmUgYSBHaXZlci9Qcm9qZWN0IHNlbmRpbmcKICAgIC8vLyAgdG8gYSBHaXZlciwgYSBEZWxlZ2F0ZSBvciBhIFByb2plY3Q7IGEgRGVsZWdhdGUgc2VuZGluZyB0byBhbm90aGVyCiAgICAvLy8gIERlbGVnYXRlLCBvciBhIERlbGVnYXRlIHByZS1jb21taXRpbmcgaXQgdG8gYSBQcm9qZWN0IAogICAgZnVuY3Rpb24gdHJhbnNmZXIoIAogICAgICAgIHVpbnQ2NCBpZFNlbmRlciwKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICl7CgogICAgICAgIGlkUGxlZGdlID0gbm9ybWFsaXplUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2UgcmVjZWl2ZXIgPSBmaW5kQWRtaW4oaWRSZWNlaXZlcik7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBzZW5kZXIgPSBmaW5kQWRtaW4oaWRTZW5kZXIpOwoKICAgICAgICBjaGVja0FkbWluT3duZXIoc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHAucGxlZGdlU3RhdGUgPT0gUGxlZGdlU3RhdGUuUGxlZGdlZCk7CgogICAgICAgIC8vIElmIHRoZSBzZW5kZXIgaXMgdGhlIG93bmVyIG9mIHRoZSBQbGVkZ2UKICAgICAgICBpZiAocC5vd25lciA9PSBpZFNlbmRlcikgewoKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHsKICAgICAgICAgICAgICAgIHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcihpZFBsZWRnZSwgYW1vdW50LCBpZFJlY2VpdmVyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZWNlaXZlci5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpIHsKICAgICAgICAgICAgICAgIHRyYW5zZmVyT3duZXJzaGlwVG9Qcm9qZWN0KGlkUGxlZGdlLCBhbW91bnQsIGlkUmVjZWl2ZXIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuRGVsZWdhdGUpIHsKCiAgICAgICAgICAgICAgICB1aW50IHJlY2lldmVyRElkeCA9IGdldERlbGVnYXRlSWR4KHAsIGlkUmVjZWl2ZXIpOwogICAgICAgICAgICAgICAgaWYgKHAuaW50ZW5kZWRQcm9qZWN0ID4gMCAmJiByZWNpZXZlckRJZHggIT0gTk9URk9VTkQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhbiBpbnRlbmRlZFByb2plY3QgYW5kIHRoZSByZWNlaXZlciBpcyBpbiB0aGUgZGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICAgICAgICAgIC8vIHRoZW4gd2Ugd2FudCB0byBwcmVzZXJ2ZSB0aGUgZGVsZWdhdGlvbkNoYWluIGFzIHRoaXMgaXMgYSB2ZXRvIG9mIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGludGVuZGVkUHJvamVjdCBieSB0aGUgb3duZXIKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY2lldmVyRElkeCA9PSBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NCB0b1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgdG9QbGVkZ2UsIGFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWxlZ2F0ZShpZFBsZWRnZSwgYW1vdW50LCBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggLSByZWNlaXZlckRJZHggLSAxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIG93bmVyIGlzIG5vdCB2ZXRvaW5nIGFuIGludGVuZGVkUHJvamVjdCBhbmQgaXMgdHJhbnNmZXJyaW5nIHRoZSBwbGVkZ2UgdG8gYSBkZWxlZ2F0ZSwKICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSB3YW50IHRvIHJlc2V0IHRoZSBkZWxlZ2F0aW9uQ2hhaW4KICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSA9IHVuZGVsZWdhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGlkUGxlZGdlLAogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgYXBwZW5kRGVsZWdhdGUoaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIG5ldmVyIGJlIHJlYWNoZWQgYXMgdGhlIHJlY2lldmVyLmFkbWluVHlwZQogICAgICAgICAgICAgICAgLy8gc2hvdWxkIGFsd2F5cyBiZSBlaXRoZXIgYSBHaXZlciwgUHJvamVjdCwgb3IgRGVsZWdhdGUKICAgICAgICAgICAgICAgIGFzc2VydChmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gSWYgdGhlIHNlbmRlciBpcyBhIERlbGVnYXRlCiAgICAgICAgdWludCBzZW5kZXJESWR4ID0gZ2V0RGVsZWdhdGVJZHgocCwgaWRTZW5kZXIpOwogICAgICAgIGlmIChzZW5kZXJESWR4ICE9IE5PVEZPVU5EKSB7CgogICAgICAgICAgICAvLyBBbmQgdGhlIHJlY2VpdmVyIGlzIGFub3RoZXIgR2l2ZXIKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuR2l2ZXIpIHsKICAgICAgICAgICAgICAgIC8vIE9ubHkgdHJhbnNmZXIgdG8gdGhlIEdpdmVyIHdobyBvd25zIHRoZSBwbGRlZ2UKICAgICAgICAgICAgICAgIGFzc2VydChwLm93bmVyID09IGlkUmVjZWl2ZXIpOwogICAgICAgICAgICAgICAgdW5kZWxlZ2F0ZShpZFBsZWRnZSwgYW1vdW50LCBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBbmQgdGhlIHJlY2VpdmVyIGlzIGFub3RoZXIgRGVsZWdhdGUKICAgICAgICAgICAgaWYgKHJlY2VpdmVyLmFkbWluVHlwZSA9PSBQbGVkZ2VBZG1pblR5cGUuRGVsZWdhdGUpIHsKICAgICAgICAgICAgICAgIHVpbnQgcmVjZWl2ZXJESWR4ID0gZ2V0RGVsZWdhdGVJZHgocCwgaWRSZWNlaXZlcik7CgogICAgICAgICAgICAgICAgLy8gQW5kIG5vdCBpbiB0aGUgZGVsZWdhdGlvbkNoYWluCiAgICAgICAgICAgICAgICBpZiAocmVjZWl2ZXJESWR4ID09IE5PVEZPVU5EKSB7CiAgICAgICAgICAgICAgICAgICAgaWRQbGVkZ2UgPSB1bmRlbGVnYXRlKAogICAgICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggLSBzZW5kZXJESWR4IC0gMQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgYXBwZW5kRGVsZWdhdGUoaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CgogICAgICAgICAgICAgICAgLy8gQW5kIHBhcnQgb2YgdGhlIGRlbGVnYXRpb25DaGFpbiBhbmQgaXMgYWZ0ZXIgdGhlIHNlbmRlciwgdGhlbgogICAgICAgICAgICAgICAgLy8gIGFsbCBvZiB0aGUgb3RoZXIgZGVsZWdhdGVzIGFmdGVyIHRoZSBzZW5kZXIgYXJlIHJlbW92ZWQgYW5kCiAgICAgICAgICAgICAgICAvLyAgdGhlIHJlY2VpdmVyIGlzIGFwcGVuZGVkIGF0IHRoZSBlbmQgb2YgdGhlIGRlbGVnYXRpb25DaGFpbgogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZWNlaXZlckRJZHggPiBzZW5kZXJESWR4KSB7CiAgICAgICAgICAgICAgICAgICAgaWRQbGVkZ2UgPSB1bmRlbGVnYXRlKAogICAgICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggLSBzZW5kZXJESWR4IC0gMQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgYXBwZW5kRGVsZWdhdGUoaWRQbGVkZ2UsIGFtb3VudCwgaWRSZWNlaXZlcik7CgogICAgICAgICAgICAgICAgLy8gQW5kIGlzIGFscmVhZHkgcGFydCBvZiB0aGUgZGVsZWdhdGUgY2hhaW4gYnV0IGlzIGJlZm9yZSB0aGUKICAgICAgICAgICAgICAgIC8vICBzZW5kZXIsIHRoZW4gdGhlIHNlbmRlciBhbmQgYWxsIG9mIHRoZSBvdGhlciBkZWxlZ2F0ZXMgYWZ0ZXIKICAgICAgICAgICAgICAgIC8vICB0aGUgUkVDRUlWRVIgYXJlIHJlbW92ZWQgZnJvbSB0aGUgZGVsZWdhdGlvbkNoYWluIAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZWNlaXZlckRJZHggPD0gc2VuZGVyRElkeCkgey8vVE9ETyBDaGVjayBmb3IgR2FtZSBUaGVvcnkgaXNzdWVzIChmcm9tIEFydGh1cikgdGhpcyBhbGxvd3MgdGhlIHNlbmRlciB0byBzb3J0IG9mIGdvIGtvbWFrb3NpIGFuZCByZW1vdmUgaGltc2VsZiBhbmQgdGhlIGRlbGVnYXRlcyBiZXR3ZWVuIGhpbXNlbGYgYW5kIHRoZSByZWNlaXZlci4uLiBzaG91bGQgdGhpcyBhdXRob3JpdHkgYmUgYWxsb3dlZD8gCiAgICAgICAgICAgICAgICAgICAgdW5kZWxlZ2F0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgaWRQbGVkZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoIC0gcmVjZWl2ZXJESWR4IC0gMQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFuZCB0aGUgcmVjZWl2ZXIgaXMgYSBQcm9qZWN0LCBhbGwgdGhlIGRlbGVnYXRlcyBhZnRlciB0aGUgc2VuZGVyCiAgICAgICAgICAgIC8vICBhcmUgcmVtb3ZlZCBhbmQgdGhlIGFtb3VudCBpcyBwcmUtY29tbWl0dGVkIHRvIHRoZSBwcm9qZWN0CiAgICAgICAgICAgIGlmIChyZWNlaXZlci5hZG1pblR5cGUgPT0gUGxlZGdlQWRtaW5UeXBlLlByb2plY3QpIHsKICAgICAgICAgICAgICAgIGlkUGxlZGdlID0gdW5kZWxlZ2F0ZSgKICAgICAgICAgICAgICAgICAgICBpZFBsZWRnZSwKICAgICAgICAgICAgICAgICAgICBhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoIC0gc2VuZGVyRElkeCAtIDEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBwcm9wb3NlQXNzaWduUHJvamVjdChpZFBsZWRnZSwgYW1vdW50LCBpZFJlY2VpdmVyKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhc3NlcnQoZmFsc2UpOyAgLy8gV2hlbiB0aGUgc2VuZGVyIGlzIG5vdCBhbiBvd25lciBvciBhIGRlbGVnYXRlIAogICAgfQoKICAgIC8vLyBAbm90aWNlIEF1dGhvcml6ZXMgYSBwYXltZW50IGJlIG1hZGUgZnJvbSB0aGUgYHZhdWx0YCBjYW4gYmUgdXNlZCBieSB0aGUKICAgIC8vLyAgR2l2ZXIgdG8gdmV0byBhIHByZS1jb21taXR0ZWQgZG9uYXRpb24gZnJvbSBhIERlbGVnYXRlIHRvIGFuCiAgICAvLy8gIGludGVuZGVkUHJvamVjdAogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQgaXMgdG8gYmUgcmVkZWVtZWQgaW50byBldGhlcgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgZXRoZXIgKGluIHdlaSkgdG8gYmUgYXV0aG9yaXplZAogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludDY0IGlkUGxlZGdlLCB1aW50IGFtb3VudCkgewogICAgICAgIGlkUGxlZGdlID0gbm9ybWFsaXplUGxlZGdlKGlkUGxlZGdlKTsgLy8gVXBkYXRlcyBwbGVkZ2UgaW5mbyAKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CiAgICAgICAgcmVxdWlyZShwLnBsZWRnZVN0YXRlID09IFBsZWRnZVN0YXRlLlBsZWRnZWQpOwogICAgICAgIFBsZWRnZUFkbWluIHN0b3JhZ2Ugb3duZXIgPSBmaW5kQWRtaW4ocC5vd25lcik7CiAgICAgICAgY2hlY2tBZG1pbk93bmVyKG93bmVyKTsKCiAgICAgICAgdWludDY0IGlkTmV3UGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBwLm93bmVyLAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBheWluZwogICAgICAgICk7CgogICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIGlkTmV3UGxlZGdlLCBhbW91bnQpOwoKICAgICAgICB2YXVsdC5hdXRob3JpemVQYXltZW50KGJ5dGVzMzIoaWROZXdQbGVkZ2UpLCBvd25lci5hZGRyLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBvbmx5VmF1bHRgIENvbmZpcm1zIGEgd2l0aGRyYXcgcmVxdWVzdCBjaGFuZ2luZyB0aGUgUGxlZGdlU3RhdGUKICAgIC8vLyAgZnJvbSBQYXlpbmcgdG8gUGFpZAogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQgaXMgdG8gYmUgd2l0aGRyYXduCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiBldGhlciAoaW4gd2VpKSB0byBiZSB3aXRoZHJhd24KICAgIGZ1bmN0aW9uIGNvbmZpcm1QYXltZW50KHVpbnQ2NCBpZFBsZWRnZSwgdWludCBhbW91bnQpIG9ubHlWYXVsdCB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICByZXF1aXJlKHAucGxlZGdlU3RhdGUgPT0gUGxlZGdlU3RhdGUuUGF5aW5nKTsKCiAgICAgICAgdWludDY0IGlkTmV3UGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBwLm93bmVyLAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBhaWQKICAgICAgICApOwoKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCBpZE5ld1BsZWRnZSwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgb25seVZhdWx0YCBDYW5jZWxzIGEgd2l0aGRyYXcgcmVxdWVzdCwgY2hhbmdpbmcgdGhlIFBsZWRnZVN0YXRlIAogICAgLy8vICBmcm9tIFBheWluZyBiYWNrIHRvIFBsZWRnZWQKICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0J3Mgd2l0aGRyYXcgaXMgdG8gYmUgY2FuY2VsZWQKICAgIC8vLyBAcGFyYW0gYW1vdW50IFF1YW50aXR5IG9mIGV0aGVyIChpbiB3ZWkpIHRvIGJlIGNhbmNlbGVkCiAgICBmdW5jdGlvbiBjYW5jZWxQYXltZW50KHVpbnQ2NCBpZFBsZWRnZSwgdWludCBhbW91bnQpIG9ubHlWYXVsdCB7CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICByZXF1aXJlKHAucGxlZGdlU3RhdGUgPT0gUGxlZGdlU3RhdGUuUGF5aW5nKTsgLy9UT0RPIGNoYW5nZSB0byByZXZlcnQ/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/CgogICAgICAgIC8vIFdoZW4gYSBwYXltZW50IGlzIGNhbmNlbGVkLCBuZXZlciBpcyBhc3NpZ25lZCB0byBhIHByb2plY3QuCiAgICAgICAgdWludDY0IG9sZFBsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgcC5vd25lciwKICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4sCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIHAub2xkUGxlZGdlLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKCiAgICAgICAgb2xkUGxlZGdlID0gbm9ybWFsaXplUGxlZGdlKG9sZFBsZWRnZSk7CgogICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIG9sZFBsZWRnZSwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBgcHJvamVjdC5jYW5jZWxlZGAgZmxhZyB0byBgdHJ1ZWA7IGNhbm5vdCBiZSB1bmRvbmUKICAgIC8vLyBAcGFyYW0gaWRQcm9qZWN0IElkIG9mIHRoZSBwcm9qZWN0IHRoYXQgaXMgdG8gYmUgY2FuY2VsZWQKICAgIGZ1bmN0aW9uIGNhbmNlbFByb2plY3QodWludDY0IGlkUHJvamVjdCkgeyAKICAgICAgICBQbGVkZ2VBZG1pbiBzdG9yYWdlIHByb2plY3QgPSBmaW5kQWRtaW4oaWRQcm9qZWN0KTsKICAgICAgICBjaGVja0FkbWluT3duZXIocHJvamVjdCk7CiAgICAgICAgcHJvamVjdC5jYW5jZWxlZCA9IHRydWU7CgogICAgICAgIENhbmNlbFByb2plY3QoaWRQcm9qZWN0KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlcnMgYGFtb3VudGAgaW4gYGlkUGxlZGdlYCBiYWNrIHRvIHRoZSBgb2xkUGxlZGdlYCB0aGF0CiAgICAvLy8gIHRoYXQgc2VudCBpdCB0aGVyZSBpbiB0aGUgZmlyc3QgcGxhY2UsIGEgQ3RybC16IAogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXQgaXMgdG8gYmUgY2FuY2VsZWQKICAgIC8vLyBAcGFyYW0gYW1vdW50IFF1YW50aXR5IG9mIGV0aGVyIChpbiB3ZWkpIHRvIGJlIHRyYW5zZmVyZWQgdG8gdGhlIAogICAgLy8vICBgb2xkUGxlZGdlYAogICAgZnVuY3Rpb24gY2FuY2VsUGxlZGdlKHVpbnQ2NCBpZFBsZWRnZSwgdWludCBhbW91bnQpIHsgCiAgICAgICAgaWRQbGVkZ2UgPSBub3JtYWxpemVQbGVkZ2UoaWRQbGVkZ2UpOwoKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CiAgICAgICAgcmVxdWlyZShwLm9sZFBsZWRnZSAhPSAwKTsKCiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBtID0gZmluZEFkbWluKHAub3duZXIpOwogICAgICAgIGNoZWNrQWRtaW5Pd25lcihtKTsKCiAgICAgICAgdWludDY0IG9sZFBsZWRnZSA9IGdldE9sZGVzdFBsZWRnZU5vdENhbmNlbGVkKHAub2xkUGxlZGdlKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCBvbGRQbGVkZ2UsIGFtb3VudCk7CiAgICB9CgoKLy8vLy8vLy8KLy8gTXVsdGkgcGxlZGdlIG1ldGhvZHMKLy8vLy8vLy8KCiAgICAvLyBAZGV2IFRoaXMgc2V0IG9mIGZ1bmN0aW9ucyBtYWtlcyBtb3ZpbmcgYSBsb3Qgb2YgcGxlZGdlcyBhcm91bmQgbXVjaCBtb3JlCiAgICAvLyBlZmZpY2llbnQgKHNhdmVzIGdhcykgdGhhbiBjYWxsaW5nIHRoZXNlIGZ1bmN0aW9ucyBpbiBzZXJpZXMKICAgIAogICAgCiAgICAvLy8gQGRldiBCaXRtYXNrIHVzZWQgZm9yIGRpdmlkaW5nIHBsZWRnZSBhbW91bnRzIGluIE11bHRpIHBsZWRnZSBtZXRob2RzCiAgICB1aW50IGNvbnN0YW50IEQ2NCA9IDB4MTAwMDAwMDAwMDAwMDAwMDA7CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIG11bHRpcGxlIGFtb3VudHMgd2l0aGluIG11bHRpcGxlIFBsZWRnZXMgaW4gYW4KICAgIC8vLyAgZWZmaWNpZW50IHNpbmdsZSBjYWxsIAogICAgLy8vIEBwYXJhbSBpZFNlbmRlciBJZCBvZiB0aGUgQWRtaW4gdGhhdCBpcyB0cmFuc2ZlcnJpbmcgdGhlIGFtb3VudHMgZnJvbQogICAgLy8vICBhbGwgdGhlIFBsZWRnZXM7IHRoaXMgYWRtaW4gbXVzdCBoYXZlIHBlcm1pc3Npb25zIHRvIG1vdmUgdGhlIHZhbHVlCiAgICAvLy8gQHBhcmFtIHBsZWRnZXNBbW91bnRzIEFuIGFycmF5IG9mIFBsZWRnZSBhbW91bnRzIGFuZCB0aGUgaWRQbGVkZ2VzIHdpdGggCiAgICAvLy8gIHdoaWNoIHRoZSBhbW91bnRzIGFyZSBhc3NvY2lhdGVkOyB0aGVzZSBhcmUgZXh0cmFwb2xhdGVkIHVzaW5nIHRoZSBENjQKICAgIC8vLyAgYml0bWFzawogICAgLy8vIEBwYXJhbSBpZFJlY2VpdmVyIERlc3RpbmF0aW9uIG9mIHRoZSBgcGxlZGVzQW1vdW50c2AsIGNhbiBiZSBhIEdpdmVyIG9yIAogICAgLy8vICBQcm9qZWN0IHNlbmRpbmcgdG8gYSBHaXZlciwgYSBEZWxlZ2F0ZSBvciBhIFByb2plY3Q7IGEgRGVsZWdhdGUgc2VuZGluZwogICAgLy8vICB0byBhbm90aGVyIERlbGVnYXRlLCBvciBhIERlbGVnYXRlIHByZS1jb21taXRpbmcgaXQgdG8gYSBQcm9qZWN0IAogICAgZnVuY3Rpb24gbVRyYW5zZmVyKAogICAgICAgIHVpbnQ2NCBpZFNlbmRlciwKICAgICAgICB1aW50W10gcGxlZGdlc0Ftb3VudHMsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBsZWRnZXNBbW91bnRzLmxlbmd0aDsgaSsrICkgewogICAgICAgICAgICB1aW50NjQgaWRQbGVkZ2UgPSB1aW50NjQoIHBsZWRnZXNBbW91bnRzW2ldICYgKEQ2NC0xKSApOwogICAgICAgICAgICB1aW50IGFtb3VudCA9IHBsZWRnZXNBbW91bnRzW2ldIC8gRDY0OwoKICAgICAgICAgICAgdHJhbnNmZXIoaWRTZW5kZXIsIGlkUGxlZGdlLCBhbW91bnQsIGlkUmVjZWl2ZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBBdXRob3JpemVzIG11bHRpcGxlIGFtb3VudHMgd2l0aGluIG11bHRpcGxlIFBsZWRnZXMgdG8gYmUKICAgIC8vLyAgd2l0aGRyYXduIGZyb20gdGhlIGB2YXVsdGAgaW4gYW4gZWZmaWNpZW50IHNpbmdsZSBjYWxsIAogICAgLy8vIEBwYXJhbSBwbGVkZ2VzQW1vdW50cyBBbiBhcnJheSBvZiBQbGVkZ2UgYW1vdW50cyBhbmQgdGhlIGlkUGxlZGdlcyB3aXRoIAogICAgLy8vICB3aGljaCB0aGUgYW1vdW50cyBhcmUgYXNzb2NpYXRlZDsgdGhlc2UgYXJlIGV4dHJhcG9sYXRlZCB1c2luZyB0aGUgRDY0CiAgICAvLy8gIGJpdG1hc2sKICAgIGZ1bmN0aW9uIG1XaXRoZHJhdyh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIHdpdGhkcmF3KGlkUGxlZGdlLCBhbW91bnQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbUNvbmZpcm1QYXltZW50YCBhbGxvd3MgZm9yIG11bHRpcGxlIHBsZWRnZXMgdG8gYmUgY29uZmlybWVkCiAgICAvLy8gIGVmZmljaWVudGx5CiAgICAvLy8gQHBhcmFtIHBsZWRnZXNBbW91bnRzIEFuIGFycmF5IG9mIHBsZWRnZSBhbW91bnRzIGFuZCBJRHMgd2hpY2ggYXJlIGV4dHJhcG9sYXRlZAogICAgLy8vICB1c2luZyB0aGUgRDY0IGJpdG1hc2sKICAgIGZ1bmN0aW9uIG1Db25maXJtUGF5bWVudCh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIGNvbmZpcm1QYXltZW50KGlkUGxlZGdlLCBhbW91bnQpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbUNhbmNlbFBheW1lbnRgIGFsbG93cyBmb3IgbXVsdGlwbGUgcGxlZGdlcyB0byBiZSBjYW5jZWxlZAogICAgLy8vICBlZmZpY2llbnRseQogICAgLy8vIEBwYXJhbSBwbGVkZ2VzQW1vdW50cyBBbiBhcnJheSBvZiBwbGVkZ2UgYW1vdW50cyBhbmQgSURzIHdoaWNoIGFyZSBleHRyYXBvbGF0ZWQKICAgIC8vLyAgdXNpbmcgdGhlIEQ2NCBiaXRtYXNrCiAgICBmdW5jdGlvbiBtQ2FuY2VsUGF5bWVudCh1aW50W10gcGxlZGdlc0Ftb3VudHMpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwbGVkZ2VzQW1vdW50cy5sZW5ndGg7IGkrKyApIHsKICAgICAgICAgICAgdWludDY0IGlkUGxlZGdlID0gdWludDY0KCBwbGVkZ2VzQW1vdW50c1tpXSAmIChENjQtMSkgKTsKICAgICAgICAgICAgdWludCBhbW91bnQgPSBwbGVkZ2VzQW1vdW50c1tpXSAvIEQ2NDsKCiAgICAgICAgICAgIGNhbmNlbFBheW1lbnQoaWRQbGVkZ2UsIGFtb3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtTm9ybWFsaXplUGxlZGdlYCBhbGxvd3MgZm9yIG11bHRpcGxlIHBsZWRnZXMgdG8gYmUKICAgIC8vLyAgbm9ybWFsaXplZCBlZmZpY2llbnRseQogICAgLy8vIEBwYXJhbSBwbGVkZ2VzIEFuIGFycmF5IG9mIHBsZWRnZSBJRHMKICAgIGZ1bmN0aW9uIG1Ob3JtYWxpemVQbGVkZ2UodWludDY0W10gcGxlZGdlcykgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHBsZWRnZXMubGVuZ3RoOyBpKysgKSB7CiAgICAgICAgICAgIG5vcm1hbGl6ZVBsZWRnZSggcGxlZGdlc1tpXSApOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vCi8vIFByaXZhdGUgbWV0aG9kcwovLy8vLy8vCgogICAgLy8vIEBub3RpY2UgYHRyYW5zZmVyT3duZXJzaGlwVG9Qcm9qZWN0YCBhbGxvd3MgZm9yIHRoZSB0cmFuc2ZlciBvZgogICAgLy8vICBvd25lcnNoaXAgdG8gdGhlIHByb2plY3QsIGJ1dCBpdCBjYW4gYWxzbyBiZSBjYWxsZWQgYnkgYSBwcm9qZWN0CiAgICAvLy8gIHRvIHVuLWRlbGVnYXRlIGV2ZXJ5b25lIGJ5IHNldHRpbmcgb25lJ3Mgb3duIGlkIGZvciB0aGUgaWRSZWNlaXZlcgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRvIGJlIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGF0J3MgYmVpbmcgdHJhbnNmZXJlZAogICAgLy8vIEBwYXJhbSBpZFJlY2VpdmVyIFRoZSBuZXcgb3duZXIgb2YgdGhlIHByb2plY3QgKG9yIHNlbGYgdG8gdW4tZGVsZWdhdGUpCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcFRvUHJvamVjdCgKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgLy8gRW5zdXJlIHRoYXQgdGhlIHBsZWRnZSBpcyBub3QgYWxyZWFkeSBhdCBtYXggcGxlZGdlIGRlcHRoCiAgICAgICAgLy8gYW5kIHRoZSBwcm9qZWN0IGhhcyBub3QgYmVlbiBjYW5jZWxlZAogICAgICAgIHJlcXVpcmUoZ2V0UGxlZGdlTGV2ZWwocCkgPCBNQVhfSU5URVJQUk9KRUNUX0xFVkVMKTsKICAgICAgICByZXF1aXJlKCFpc1Byb2plY3RDYW5jZWxlZChpZFJlY2VpdmVyKSk7CgogICAgICAgIHVpbnQ2NCBvbGRQbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBwLm9sZFBsZWRnZSwKICAgICAgICAgICAgUGxlZGdlU3RhdGUuUGxlZGdlZAogICAgICAgICk7CiAgICAgICAgdWludDY0IHRvUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBpZFJlY2VpdmVyLCAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmV3IG93bmVyCiAgICAgICAgICAgIG5ldyB1aW50NjRbXSgwKSwgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGhlIGRlbGVnYXRpb24gY2hhaW4KICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgb2xkUGxlZGdlLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgYW1vdW50KTsKICAgIH0gICAKCgogICAgLy8vIEBub3RpY2UgYHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcmAgYWxsb3dzIGZvciB0aGUgdHJhbnNmZXIgb2YKICAgIC8vLyAgdmFsdWUgYmFjayB0byB0aGUgR2l2ZXIsIHZhbHVlIGlzIHBsYWNlZCBpbiBhIHBsZWRnZWQgc3RhdGUKICAgIC8vLyAgd2l0aG91dCBiZWluZyBhdHRhY2hlZCB0byBhIHByb2plY3QsIGRlbGVnYXRpb24gY2hhaW4sIG9yIHRpbWUgbGluZS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0byBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgdmFsdWUgdGhhdCdzIGJlaW5nIHRyYW5zZmVyZWQKICAgIC8vLyBAcGFyYW0gaWRSZWNlaXZlciBUaGUgbmV3IG93bmVyIG9mIHRoZSBwbGVkZ2UKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwVG9HaXZlcigKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIHVpbnQ2NCB0b1BsZWRnZSA9IGZpbmRPckNyZWF0ZVBsZWRnZSgKICAgICAgICAgICAgaWRSZWNlaXZlciwKICAgICAgICAgICAgbmV3IHVpbnQ2NFtdKDApLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICBQbGVkZ2VTdGF0ZS5QbGVkZ2VkCiAgICAgICAgKTsKICAgICAgICBkb1RyYW5zZmVyKGlkUGxlZGdlLCB0b1BsZWRnZSwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgYXBwZW5kRGVsZWdhdGVgIGFsbG93cyBmb3IgYSBkZWxlZ2F0ZSB0byBiZSBhZGRlZCBvbnRvIHRoZQogICAgLy8vICBlbmQgb2YgdGhlIGRlbGVnYXRlIGNoYWluIGZvciBhIGdpdmVuIFBsZWRnZS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0cyBkZWxlZ2F0ZSBjaGFpbiB3aWxsIGJlIG1vZGlmaWVkLgogICAgLy8vIEBwYXJhbSBhbW91bnQgUXVhbnRpdHkgb2YgdmFsdWUgdGhhdCdzIGJlaW5nIGNoYWluZWQuCiAgICAvLy8gQHBhcmFtIGlkUmVjZWl2ZXIgVGhlIGRlbGVnYXRlIHRvIGJlIGFkZGVkIGF0IHRoZSBlbmQgb2YgdGhlIGNoYWluCiAgICBmdW5jdGlvbiBhcHBlbmREZWxlZ2F0ZSgKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgcmVxdWlyZShwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggPCBNQVhfREVMRUdBVEVTKTsKICAgICAgICB1aW50NjRbXSBtZW1vcnkgbmV3RGVsZWdhdGlvbkNoYWluID0gbmV3IHVpbnQ2NFtdKAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbi5sZW5ndGggKyAxCiAgICAgICAgKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGk8cC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluW2ldID0gcC5kZWxlZ2F0aW9uQ2hhaW5baV07CiAgICAgICAgfQoKICAgICAgICAvLyBNYWtlIHRoZSBsYXN0IGl0ZW0gaW4gdGhlIGFycmF5IHRoZSBpZFJlY2VpdmVyCiAgICAgICAgbmV3RGVsZWdhdGlvbkNoYWluW3AuZGVsZWdhdGlvbkNoYWluLmxlbmd0aF0gPSBpZFJlY2VpdmVyOwoKICAgICAgICB1aW50NjQgdG9QbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIG5ld0RlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBsZWRnZWQKICAgICAgICApOwogICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIHRvUGxlZGdlLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBhcHBlbmREZWxlZ2F0ZWAgYWxsb3dzIGZvciBhIGRlbGVnYXRlIHRvIGJlIGFkZGVkIG9udG8gdGhlCiAgICAvLy8gIGVuZCBvZiB0aGUgZGVsZWdhdGUgY2hhaW4gZm9yIGEgZ2l2ZW4gUGxlZGdlLgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBJZCBvZiB0aGUgcGxlZGdlIHRoYXRzIGRlbGVnYXRlIGNoYWluIHdpbGwgYmUgbW9kaWZpZWQuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGF0J3Mgc2hpZnRlZCBmcm9tIGRlbGVnYXRlcy4KICAgIC8vLyBAcGFyYW0gcSBOdW1iZXIgKG9yIGRlcHRoKSBvZiBkZWxlZ2F0ZXMgdG8gcmVtb3ZlCiAgICAvLy8gQHJldHVybiB0b1BsZWRnZSBUaGUgaWQgZm9yIHRoZSBwbGVkZ2UgYmVpbmcgYWRqdXN0ZWQgb3IgY3JlYXRlZAogICAgZnVuY3Rpb24gdW5kZWxlZ2F0ZSgKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludCBxCiAgICApIGludGVybmFsIHJldHVybnMgKHVpbnQ2NCkKICAgIHsKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CiAgICAgICAgdWludDY0W10gbWVtb3J5IG5ld0RlbGVnYXRpb25DaGFpbiA9IG5ldyB1aW50NjRbXSgKICAgICAgICAgICAgcC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoIC0gcQogICAgICAgICk7CgogICAgICAgIGZvciAodWludCBpPTA7IGk8cC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoIC0gcTsgaSsrKSB7CiAgICAgICAgICAgIG5ld0RlbGVnYXRpb25DaGFpbltpXSA9IHAuZGVsZWdhdGlvbkNoYWluW2ldOwogICAgICAgIH0KICAgICAgICB1aW50NjQgdG9QbGVkZ2UgPSBmaW5kT3JDcmVhdGVQbGVkZ2UoCiAgICAgICAgICAgIHAub3duZXIsCiAgICAgICAgICAgIG5ld0RlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgcC5vbGRQbGVkZ2UsCiAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBsZWRnZWQKICAgICAgICApOwogICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIHRvUGxlZGdlLCBhbW91bnQpOwoKICAgICAgICByZXR1cm4gdG9QbGVkZ2U7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYHByb3Bvc2VBc3NpZ25Qcm9qZWN0YCBwcm9wb3NlcyB0aGUgYXNzaWdubWVudCBvZiBhIHBsZWRnZQogICAgLy8vICB0byBhIHNwZWNpZmljIHByb2plY3QuCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIHNob3VsZCBwb3RlbnRpYWxseSBiZSBuYW1lZCBtb3JlIHNwZWNpZmljYWxseS4KICAgIC8vLyBAcGFyYW0gaWRQbGVkZ2UgSWQgb2YgdGhlIHBsZWRnZSB0aGF0IHdpbGwgYmUgYXNzaWduZWQuCiAgICAvLy8gQHBhcmFtIGFtb3VudCBRdWFudGl0eSBvZiB2YWx1ZSB0aGlzIHBsZWRnZSBsZWFkZXIgd291bGQgYmUgYXNzaWduZWQuCiAgICAvLy8gQHBhcmFtIGlkUmVjZWl2ZXIgVGhlIHByb2plY3QgdGhpcyBwbGVkZ2Ugd2lsbCBwb3RlbnRpYWxseSAKICAgIC8vLyAgYmUgYXNzaWduZWQgdG8uCiAgICBmdW5jdGlvbiBwcm9wb3NlQXNzaWduUHJvamVjdCgKICAgICAgICB1aW50NjQgaWRQbGVkZ2UsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgdWludDY0IGlkUmVjZWl2ZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIFBsZWRnZSBzdG9yYWdlIHAgPSBmaW5kUGxlZGdlKGlkUGxlZGdlKTsKCiAgICAgICAgcmVxdWlyZShnZXRQbGVkZ2VMZXZlbChwKSA8IE1BWF9JTlRFUlBST0pFQ1RfTEVWRUwpOwogICAgICAgIHJlcXVpcmUoIWlzUHJvamVjdENhbmNlbGVkKGlkUmVjZWl2ZXIpKTsKCiAgICAgICAgdWludDY0IHRvUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICBwLm93bmVyLAogICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbiwKICAgICAgICAgICAgaWRSZWNlaXZlciwKICAgICAgICAgICAgdWludDY0KGdldFRpbWUoKSArIG1heENvbW1pdFRpbWUocCkpLAogICAgICAgICAgICBwLm9sZFBsZWRnZSwKICAgICAgICAgICAgUGxlZGdlU3RhdGUuUGxlZGdlZAogICAgICAgICk7CiAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgdG9QbGVkZ2UsIGFtb3VudCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYGRvVHJhbnNmZXJgIGlzIGRlc2lnbmVkIHRvIGFsbG93IGZvciBwbGVkZ2UgYW1vdW50cyB0byBiZSAKICAgIC8vLyAgc2hpZnRlZCBhcm91bmQgaW50ZXJuYWxseS4KICAgIC8vLyBAcGFyYW0gZnJvbSBUaGlzIGlzIHRoZSBJZCBmcm9tIHdoaWNoIHZhbHVlIHdpbGwgYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gdG8gVGhpcyBpcyB0aGUgSWQgdGhhdCB2YWx1ZSB3aWxsIGJlIHRyYW5zZmVyZWQgdG8uCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB2YWx1ZSB0aGF0IHdpbGwgYmUgdHJhbnNmZXJlZC4KICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIodWludDY0IGZyb20sIHVpbnQ2NCB0bywgdWludCBfYW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgdWludCBhbW91bnQgPSBjYWxsUGx1Z2lucyh0cnVlLCBmcm9tLCB0bywgX2Ftb3VudCk7CiAgICAgICAgaWYgKGZyb20gPT0gdG8pIHsgCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGFtb3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgUGxlZGdlIHN0b3JhZ2UgbkZyb20gPSBmaW5kUGxlZGdlKGZyb20pOwogICAgICAgIFBsZWRnZSBzdG9yYWdlIG5UbyA9IGZpbmRQbGVkZ2UodG8pOwogICAgICAgIHJlcXVpcmUobkZyb20uYW1vdW50ID49IGFtb3VudCk7CiAgICAgICAgbkZyb20uYW1vdW50IC09IGFtb3VudDsKICAgICAgICBuVG8uYW1vdW50ICs9IGFtb3VudDsKCiAgICAgICAgVHJhbnNmZXIoZnJvbSwgdG8sIGFtb3VudCk7CiAgICAgICAgY2FsbFBsdWdpbnMoZmFsc2UsIGZyb20sIHRvLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE9ubHkgYWZmZWN0cyBwbGVkZ2VzIHdpdGggdGhlIFBsZWRnZWQgUGxlZGdlU3RhdGUgZm9yIDIgdGhpbmdzOgogICAgLy8vICAgIzE6IENoZWNrcyBpZiB0aGUgcGxlZGdlIHNob3VsZCBiZSBjb21taXR0ZWQuIFRoaXMgbWVhbnMgdGhhdAogICAgLy8vICAgICAgIGlmIHRoZSBwbGVkZ2UgaGFzIGFuIGludGVuZGVkUHJvamVjdCBhbmQgaXQgaXMgcGFzdCB0aGUKICAgIC8vLyAgICAgICBjb21taXRUaW1lLCBpdCBjaGFuZ2VzIHRoZSBvd25lciB0byBiZSB0aGUgcHJvcG9zZWQgcHJvamVjdAogICAgLy8vICAgICAgIChUaGUgVUkgd2lsbCBoYXZlIHRvIHJlYWQgdGhlIGNvbW1pdCB0aW1lIGFuZCBtYW51YWxseSBkbyB3aGF0CiAgICAvLy8gICAgICAgdGhpcyBmdW5jdGlvbiBkb2VzIHRvIHRoZSBwbGVkZ2UgZm9yIHRoZSBlbmQgdXNlcgogICAgLy8vICAgICAgIGF0IHRoZSBleHBpcmF0aW9uIG9mIHRoZSBjb21taXRUaW1lKQogICAgLy8vCiAgICAvLy8gICAjMjogQ2hlY2tzIHRvIG1ha2Ugc3VyZSB0aGF0IGlmIHRoZXJlIGhhcyBiZWVuIGEgY2FuY2VsbGF0aW9uIGluIHRoZQogICAgLy8vICAgICAgIGNoYWluIG9mIHByb2plY3RzLCB0aGUgcGxlZGdlJ3Mgb3duZXIgaGFzIGJlZW4gY2hhbmdlZAogICAgLy8vICAgICAgIGFwcHJvcHJpYXRlbHkuCiAgICAvLy8KICAgIC8vLyBUaGlzIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgYnkgYW55Ym9keSBhdCBhbnl0aW1lIG9uIGFueSBwbGVkZ2UuCiAgICAvLy8gIEluIGdlbmVyYWwgaXQgY2FuIGJlIGNhbGxlZCB0byBmb3JjZSB0aGUgY2FsbHMgb2YgdGhlIGFmZmVjdGVkIAogICAgLy8vICBwbHVnaW5zLCB3aGljaCBhbHNvIG5lZWQgdG8gYmUgcHJlZGljdGVkIGJ5IHRoZSBVSQogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBUaGlzIGlzIHRoZSBpZCBvZiB0aGUgcGxlZGdlIHRoYXQgd2lsbCBiZSBub3JtYWxpemVkCiAgICAvLy8gQHJldHVybiBUaGUgbm9ybWFsaXplZCBQbGVkZ2UhCiAgICBmdW5jdGlvbiBub3JtYWxpemVQbGVkZ2UodWludDY0IGlkUGxlZGdlKSByZXR1cm5zKHVpbnQ2NCkgewoKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CgogICAgICAgIC8vIENoZWNrIHRvIG1ha2Ugc3VyZSB0aGlzIHBsZWRnZSBoYXNuJ3QgYWxyZWFkeSBiZWVuIHVzZWQgCiAgICAgICAgLy8gb3IgaXMgaW4gdGhlIHByb2Nlc3Mgb2YgYmVpbmcgdXNlZAogICAgICAgIGlmIChwLnBsZWRnZVN0YXRlICE9IFBsZWRnZVN0YXRlLlBsZWRnZWQpIHsKICAgICAgICAgICAgcmV0dXJuIGlkUGxlZGdlOwogICAgICAgIH0KCiAgICAgICAgLy8gRmlyc3Qgc2VuZCB0byBhIHByb2plY3QgaWYgaXQncyBwcm9wb3NlZCBhbmQgY29tbWl0dGVkCiAgICAgICAgaWYgKChwLmludGVuZGVkUHJvamVjdCA+IDApICYmICggZ2V0VGltZSgpID4gcC5jb21taXRUaW1lKSkgewogICAgICAgICAgICB1aW50NjQgb2xkUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICAgICAgcC5vd25lciwKICAgICAgICAgICAgICAgIHAuZGVsZWdhdGlvbkNoYWluLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICBwLm9sZFBsZWRnZSwKICAgICAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBsZWRnZWQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdWludDY0IHRvUGxlZGdlID0gZmluZE9yQ3JlYXRlUGxlZGdlKAogICAgICAgICAgICAgICAgcC5pbnRlbmRlZFByb2plY3QsCiAgICAgICAgICAgICAgICBuZXcgdWludDY0W10oMCksCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgMCwKICAgICAgICAgICAgICAgIG9sZFBsZWRnZSwKICAgICAgICAgICAgICAgIFBsZWRnZVN0YXRlLlBsZWRnZWQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgZG9UcmFuc2ZlcihpZFBsZWRnZSwgdG9QbGVkZ2UsIHAuYW1vdW50KTsKICAgICAgICAgICAgaWRQbGVkZ2UgPSB0b1BsZWRnZTsKICAgICAgICAgICAgcCA9IGZpbmRQbGVkZ2UoaWRQbGVkZ2UpOwogICAgICAgIH0KCiAgICAgICAgdG9QbGVkZ2UgPSBnZXRPbGRlc3RQbGVkZ2VOb3RDYW5jZWxlZChpZFBsZWRnZSk7CiAgICAgICAgaWYgKHRvUGxlZGdlICE9IGlkUGxlZGdlKSB7CiAgICAgICAgICAgIGRvVHJhbnNmZXIoaWRQbGVkZ2UsIHRvUGxlZGdlLCBwLmFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG9QbGVkZ2U7CiAgICB9CgovLy8vLy8vLy8vLy8vCi8vIFBsdWdpbnMKLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIGBjYWxsUGx1Z2luYCBpcyB1c2VkIHRvIHRyaWdnZXIgdGhlIGdlbmVyYWwgZnVuY3Rpb25zIGluIHRoZQogICAgLy8vICBwbHVnaW4gZm9yIGFueSBhY3Rpb25zIG5lZWRlZCBiZWZvcmUgYW5kIGFmdGVyIGEgdHJhbnNmZXIgaGFwcGVucy4KICAgIC8vLyAgU3BlY2lmaWNhbGx5IHdoYXQgdGhpcyBkb2VzIGluIHJlbGF0aW9uIHRvIHRoZSBwbHVnaW4gaXMgc29tZXRoaW5nCiAgICAvLy8gIHRoYXQgbGFyZ2VseSBkZXBlbmRzIG9uIHRoZSBmdW5jdGlvbnMgb2YgdGhhdCBwbHVnaW4uIFRoaXMgZnVuY3Rpb24KICAgIC8vLyAgaXMgZ2VuZXJhbGx5IGNhbGxlZCBpbiBwYWlycywgb25jZSBiZWZvcmUsIGFuZCBvbmNlIGFmdGVyIGEgdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIGJlZm9yZSBUaGlzIHRvZ2dsZSBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHBsdWdpbiBjYWxsIGlzIG9jY3VycmluZwogICAgLy8vICBiZWZvcmUgb3IgYWZ0ZXIgYSB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gYWRtaW5JZCBUaGlzIHNob3VsZCBiZSB0aGUgSWQgb2YgdGhlICp0cnVzdGVkKiBpbmRpdmlkdWFsCiAgICAvLy8gIHdobyBoYXMgY29udHJvbCBvdmVyIHRoaXMgcGx1Z2luLgogICAgLy8vIEBwYXJhbSBmcm9tUGxlZGdlIFRoaXMgaXMgdGhlIElkIGZyb20gd2hpY2ggdmFsdWUgaXMgYmVpbmcgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gdG9QbGVkZ2UgVGhpcyBpcyB0aGUgSWQgdGhhdCB2YWx1ZSBpcyBiZWluZyB0cmFuc2ZlcmVkIHRvLgogICAgLy8vIEBwYXJhbSBjb250ZXh0IFRoZSBzaXR1YXRpb24gdGhhdCBpcyB0cmlnZ2VyaW5nIHRoZSBwbHVnaW4uIFNlZSBwbHVnaW4KICAgIC8vLyAgZm9yIGEgZnVsbCBkZXNjcmlwdGlvbiBvZiBjb250ZXh0cy4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdmFsdWUgdGhhdCBpcyBiZWluZyB0cmFuc2ZlcmVkLgogICAgZnVuY3Rpb24gY2FsbFBsdWdpbigKICAgICAgICBib29sIGJlZm9yZSwKICAgICAgICB1aW50NjQgYWRtaW5JZCwKICAgICAgICB1aW50NjQgZnJvbVBsZWRnZSwKICAgICAgICB1aW50NjQgdG9QbGVkZ2UsCiAgICAgICAgdWludDY0IGNvbnRleHQsCiAgICAgICAgdWludCBhbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludCBhbGxvd2VkQW1vdW50KSB7CgogICAgICAgIHVpbnQgbmV3QW1vdW50OwogICAgICAgIGFsbG93ZWRBbW91bnQgPSBhbW91bnQ7CiAgICAgICAgUGxlZGdlQWRtaW4gc3RvcmFnZSBhZG1pbiA9IGZpbmRBZG1pbihhZG1pbklkKTsKICAgICAgICAvLyBDaGVja3MgYWRtaW4gaGFzIGEgcGx1Z2luIGFzc2lnbmVkIGFuZCBhIG5vbi16ZXJvIGFtb3VudCBpcyByZXF1ZXN0ZWQKICAgICAgICBpZiAoKGFkZHJlc3MoYWRtaW4ucGx1Z2luKSAhPSAwKSAmJiAoYWxsb3dlZEFtb3VudCA+IDApKSB7CiAgICAgICAgICAgIC8vIFRoZXJlIGFyZSB0d28gc2VwZXJhdGUgZnVuY3Rpb25zIGNhbGxlZCBpbiB0aGUgcGx1Z2luLgogICAgICAgICAgICAvLyBPbmUgaXMgY2FsbGVkIGJlZm9yZSB0aGUgdHJhbnNmZXIgYW5kIG9uZSBhZnRlcgogICAgICAgICAgICBpZiAoYmVmb3JlKSB7CiAgICAgICAgICAgICAgICBuZXdBbW91bnQgPSBhZG1pbi5wbHVnaW4uYmVmb3JlVHJhbnNmZXIoCiAgICAgICAgICAgICAgICAgICAgYWRtaW5JZCwKICAgICAgICAgICAgICAgICAgICBmcm9tUGxlZGdlLAogICAgICAgICAgICAgICAgICAgIHRvUGxlZGdlLAogICAgICAgICAgICAgICAgICAgIGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmVxdWlyZShuZXdBbW91bnQgPD0gYWxsb3dlZEFtb3VudCk7CiAgICAgICAgICAgICAgICBhbGxvd2VkQW1vdW50ID0gbmV3QW1vdW50OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWRtaW4ucGx1Z2luLmFmdGVyVHJhbnNmZXIoCiAgICAgICAgICAgICAgICAgICAgYWRtaW5JZCwKICAgICAgICAgICAgICAgICAgICBmcm9tUGxlZGdlLAogICAgICAgICAgICAgICAgICAgIHRvUGxlZGdlLAogICAgICAgICAgICAgICAgICAgIGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgYW1vdW50CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIGBjYWxsUGx1Z2luc1BsZWRnZWAgaXMgdXNlZCB0byBhcHBseSBwbHVnaW4gY2FsbHMgdG8KICAgIC8vLyAgdGhlIGRlbGVnYXRlIGNoYWluIGFuZCB0aGUgaW50ZW5kZWQgcHJvamVjdCBpZiB0aGVyZSBpcyBvbmUuCiAgICAvLy8gIEl0IGRvZXMgc28gaW4gZWl0aGVyIGEgdHJhbnNmZXJyaW5nIG9yIHJlY2VpdmluZyBjb250ZXh0IGJhc2VkCiAgICAvLy8gIG9uIHRoZSBgaWRQbGVkZ2VgIGFuZCAgYGZyb21QbGVkZ2VgIHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIGJlZm9yZSBUaGlzIHRvZ2dsZSBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHBsdWdpbiBjYWxsIGlzIG9jY3VyaW5nCiAgICAvLy8gIGJlZm9yZSBvciBhZnRlciBhIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBpZFBsZWRnZSBUaGlzIGlzIHRoZSBJZCBvZiB0aGUgcGxlZGdlIG9uIHdoaWNoIHRoaXMgcGx1Z2luCiAgICAvLy8gIGlzIGJlaW5nIGNhbGxlZC4KICAgIC8vLyBAcGFyYW0gZnJvbVBsZWRnZSBUaGlzIGlzIHRoZSBJZCBmcm9tIHdoaWNoIHZhbHVlIGlzIGJlaW5nIHRyYW5zZmVyZWQuCiAgICAvLy8gQHBhcmFtIHRvUGxlZGdlIFRoaXMgaXMgdGhlIElkIHRoYXQgdmFsdWUgaXMgYmVpbmcgdHJhbnNmZXJlZCB0by4KICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdmFsdWUgdGhhdCBpcyBiZWluZyB0cmFuc2ZlcmVkLgogICAgZnVuY3Rpb24gY2FsbFBsdWdpbnNQbGVkZ2UoCiAgICAgICAgYm9vbCBiZWZvcmUsCiAgICAgICAgdWludDY0IGlkUGxlZGdlLAogICAgICAgIHVpbnQ2NCBmcm9tUGxlZGdlLAogICAgICAgIHVpbnQ2NCB0b1BsZWRnZSwKICAgICAgICB1aW50IGFtb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGFsbG93ZWRBbW91bnQpIHsKICAgICAgICAvLyBEZXRlcm1pbmUgaWYgY2FsbFBsdWdpbiBpcyBiZWluZyBhcHBsaWVkIGluIGEgcmVjZWl2aW5nCiAgICAgICAgLy8gb3IgdHJhbnNmZXJyaW5nIGNvbnRleHQKICAgICAgICB1aW50NjQgb2Zmc2V0ID0gaWRQbGVkZ2UgPT0gZnJvbVBsZWRnZSA/IDAgOiAyNTY7CiAgICAgICAgYWxsb3dlZEFtb3VudCA9IGFtb3VudDsKICAgICAgICBQbGVkZ2Ugc3RvcmFnZSBwID0gZmluZFBsZWRnZShpZFBsZWRnZSk7CgogICAgICAgIC8vIEFsd2F5cyBjYWxsIHRoZSBwbHVnaW4gb24gdGhlIG93bmVyCiAgICAgICAgYWxsb3dlZEFtb3VudCA9IGNhbGxQbHVnaW4oCiAgICAgICAgICAgIGJlZm9yZSwKICAgICAgICAgICAgcC5vd25lciwKICAgICAgICAgICAgZnJvbVBsZWRnZSwKICAgICAgICAgICAgdG9QbGVkZ2UsCiAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgYWxsb3dlZEFtb3VudAogICAgICAgICk7CgogICAgICAgIC8vIEFwcGx5IGNhbGwgcGx1Z2luIHRvIGFsbCBkZWxlZ2F0ZXMKICAgICAgICBmb3IgKHVpbnQ2NCBpPTA7IGk8cC5kZWxlZ2F0aW9uQ2hhaW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYWxsb3dlZEFtb3VudCA9IGNhbGxQbHVnaW4oCiAgICAgICAgICAgICAgICBiZWZvcmUsCiAgICAgICAgICAgICAgICBwLmRlbGVnYXRpb25DaGFpbltpXSwKICAgICAgICAgICAgICAgIGZyb21QbGVkZ2UsCiAgICAgICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgICAgIG9mZnNldCArIGkrMSwKICAgICAgICAgICAgICAgIGFsbG93ZWRBbW91bnQKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGludGVuZGVkIHByb2plY3QgYWxzbyBjYWxsIHRoZSBwbHVnaW4gaW4KICAgICAgICAvLyBlaXRoZXIgYSB0cmFuc2ZlcnJpbmcgb3IgcmVjZWl2aW5nIGNvbnRleHQgYmFzZWQgb24gb2Zmc2V0CiAgICAgICAgLy8gb24gdGhlIGludGVuZGVkIHByb2plY3QKICAgICAgICBpZiAocC5pbnRlbmRlZFByb2plY3QgPiAwKSB7CiAgICAgICAgICAgIGFsbG93ZWRBbW91bnQgPSBjYWxsUGx1Z2luKAogICAgICAgICAgICAgICAgYmVmb3JlLAogICAgICAgICAgICAgICAgcC5pbnRlbmRlZFByb2plY3QsCiAgICAgICAgICAgICAgICBmcm9tUGxlZGdlLAogICAgICAgICAgICAgICAgdG9QbGVkZ2UsCiAgICAgICAgICAgICAgICBvZmZzZXQgKyAyNTUsCiAgICAgICAgICAgICAgICBhbGxvd2VkQW1vdW50CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKCiAgICAvLy8gQG5vdGljZSBgY2FsbFBsdWdpbnNgIGNhbGxzIGBjYWxsUGx1Z2luc1BsZWRnZWAgb25jZSBmb3IgdGhlIHRyYW5zZmVyCiAgICAvLy8gIGNvbnRleHQgYW5kIG9uY2UgZm9yIHRoZSByZWNlaXZpbmcgY29udGV4dC4gVGhlIGFnZ3JlZ2F0ZWQgCiAgICAvLy8gIGFsbG93ZWQgYW1vdW50IGlzIHRoZW4gcmV0dXJuZWQuCiAgICAvLy8gQHBhcmFtIGJlZm9yZSBUaGlzIHRvZ2dsZSBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHBsdWdpbiBjYWxsIGlzIG9jY3VycmluZwogICAgLy8vICBiZWZvcmUgb3IgYWZ0ZXIgYSB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gZnJvbVBsZWRnZSBUaGlzIGlzIHRoZSBJZCBmcm9tIHdoaWNoIHZhbHVlIGlzIGJlaW5nIHRyYW5zZmVycmVkLgogICAgLy8vIEBwYXJhbSB0b1BsZWRnZSBUaGlzIGlzIHRoZSBJZCB0aGF0IHZhbHVlIGlzIGJlaW5nIHRyYW5zZmVycmVkIHRvLgogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiB2YWx1ZSB0aGF0IGlzIGJlaW5nIHRyYW5zZmVycmVkLgogICAgZnVuY3Rpb24gY2FsbFBsdWdpbnMoCiAgICAgICAgYm9vbCBiZWZvcmUsCiAgICAgICAgdWludDY0IGZyb21QbGVkZ2UsCiAgICAgICAgdWludDY0IHRvUGxlZGdlLAogICAgICAgIHVpbnQgYW1vdW50CiAgICApIGludGVybmFsIHJldHVybnMgKHVpbnQgYWxsb3dlZEFtb3VudCkgewogICAgICAgIGFsbG93ZWRBbW91bnQgPSBhbW91bnQ7CgogICAgICAgIC8vIENhbGwgdGhlIHBsZWRnZXMgcGx1Z2lucyBpbiB0aGUgdHJhbnNmZXIgY29udGV4dAogICAgICAgIGFsbG93ZWRBbW91bnQgPSBjYWxsUGx1Z2luc1BsZWRnZSgKICAgICAgICAgICAgYmVmb3JlLAogICAgICAgICAgICBmcm9tUGxlZGdlLAogICAgICAgICAgICBmcm9tUGxlZGdlLAogICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgYWxsb3dlZEFtb3VudAogICAgICAgICk7CgogICAgICAgIC8vIENhbGwgdGhlIHBsZWRnZXMgcGx1Z2lucyBpbiB0aGUgcmVjZWl2ZSBjb250ZXh0CiAgICAgICAgYWxsb3dlZEFtb3VudCA9IGNhbGxQbHVnaW5zUGxlZGdlKAogICAgICAgICAgICBiZWZvcmUsCiAgICAgICAgICAgIHRvUGxlZGdlLAogICAgICAgICAgICBmcm9tUGxlZGdlLAogICAgICAgICAgICB0b1BsZWRnZSwKICAgICAgICAgICAgYWxsb3dlZEFtb3VudAogICAgICAgICk7CiAgICB9CgovLy8vLy8vLy8vLy8vCi8vIFRlc3QgZnVuY3Rpb25zCi8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBCYXNpYyBoZWxwZXIgZnVuY3Rpb24gdG8gcmV0dXJuIHRoZSBjdXJyZW50IHRpbWUKICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICAvLyBFdmVudCBEZWxjZXJhdGlvbnMKICAgIGV2ZW50IFRyYW5zZmVyKHVpbnQ2NCBpbmRleGVkIGZyb20sIHVpbnQ2NCBpbmRleGVkIHRvLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBDYW5jZWxQcm9qZWN0KHVpbnQ2NCBpbmRleGVkIGlkUHJvamVjdCk7Cgp9'.
	

]
