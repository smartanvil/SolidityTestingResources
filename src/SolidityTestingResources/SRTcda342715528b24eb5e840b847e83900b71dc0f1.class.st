Class {
	#name : #SRTcda342715528b24eb5e840b847e83900b71dc0f1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcda342715528b24eb5e840b847e83900b71dc0f1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyBDcmVhdGVkIGZvciBjb25kdWN0aW9uIG9mIFphYmVyIElDTyAtIGh0dHA6Ly93d3cuemFiZXJjb2luLmlvLwovLyBDb3B5aW5nIGluIHdob2xlIG9yIGluIHBhcnQgaXMgcHJvaGliaXRlZC4KLy8gVGhpcyBjb2RlIGlzIHRoZSBwcm9wZXJ0eSBvZiBJQ09SYXRpbmcgYW5kIElDT21hY2hpbmUgLSBodHRwOi8vSUNPUmF0aW5nLmNvbQovLyBBdXRob3JzOiBJdmFuIEZlZG9yb3YgYW5kIERtaXRyeSBCb3JvZGluCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgCXVpbnQyNTYgYyA9IGEgKiBiOwogICAgCWFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAJcmV0dXJuIGM7Cgl9CgogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2VzIG5vdCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CgkJcmV0dXJuIGM7CiAgICB9Cn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgCiAgICAKICAgIC8qKgogICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAgKiBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpY3sKICAgICAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgICAKfQoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICAgIGV2ZW50IFBhdXNlKCk7CiAgICBldmVudCBVbnBhdXNlKCk7CiAgICAKICAgIGJvb2wgX3BhdXNlZCA9IGZhbHNlOwogICAgCiAgICBmdW5jdGlvbiBwYXVzZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKQogICAgewogICAgICAgIHJldHVybiBfcGF1c2VkOwogICAgfQogICAgCiAgICAKICAgIC8qKgogICAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICAgKi8KICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKCkpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZSghX3BhdXNlZCk7CiAgICAgICAgX3BhdXNlZCA9IHRydWU7CiAgICAgICAgUGF1c2UoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgICAqLwogICAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX3BhdXNlZCk7CiAgICAgICAgX3BhdXNlZCA9IGZhbHNlOwogICAgICAgIFVucGF1c2UoKTsKICAgIH0KfQoKCi8vIENvbnRyYWN0IGludGVyZmFjZSBmb3IgdHJhbnNmZXJyaW5nIGN1cnJlbnQgdG9rZW5zIHRvIGFub3RoZXIKY29udHJhY3QgTWlncmF0aW9uQWdlbnQKewogICAgZnVuY3Rpb24gbWlncmF0ZUZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYzsKfQoKCi8vIChBMikKLy8gQ29udHJhY3QgdG9rZW4KY29udHJhY3QgVG9rZW4gaXMgUGF1c2FibGV7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlpBQkVSY29pbiI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJaQUIiOwogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgICAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHVucGF1c2VkV2FsbGV0OwogICAgCiAgICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKICAgIAogICAgdWludDI1NiBwdWJsaWMgdG90YWxNaWdyYXRlZDsKICAgIGFkZHJlc3MgcHVibGljIG1pZ3JhdGlvbkFnZW50OwogICAgCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogICAgCiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWludEZpbmlzaGVkKCk7CiAgICAKICAgIGV2ZW50IE1pZ3JhdGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICAKICAgIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICAgICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBUb2tlbigpewogICAgICAgIG93bmVyID0gMHgwOwogICAgfSAgICAKICAgIAogICAgZnVuY3Rpb24gc2V0T3duZXIoKSBwdWJsaWN7CiAgICAgICAgcmVxdWlyZShvd25lciA9PSAweDApOwogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0gICAgCiAgICAKICAgIC8vIEJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KICAgIAogICAgLy8gVHJhbnNmZXIgb2YgdG9rZW5zIGZyb20gb25lIGFjY291bnQgdG8gYW5vdGhlcgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSAoX3ZhbHVlID4gMCk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8vIFJldHVybnMgdGhlIG51bWJlciBvZiB0b2tlbnMgdGhhdCBfb3duZXIgdHJ1c3RlZCB0byBzcGVuZCBmcm9tIGhpcyBhY2NvdW50IF9zcGVuZGVyCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQogICAgCiAgICAvLyBUcnVzdCBfc2VuZGVyIGFuZCBzcGVuZCBfdmFsdWUgdG9rZW5zIGZyb20geW91ciBhY2NvdW50CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAKICAgICAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgICAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKICAgICAgCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8vIFRyYW5zZmVyIG9mIHRva2VucyBmcm9tIHRoZSB0cnVzdGVkIGFkZHJlc3MgX2Zyb20gdG8gdGhlIGFkZHJlc3MgX3RvIGluIHRoZSBudW1iZXIgX3ZhbHVlCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgICAgCiAgICAgICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAgICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwogICAgICAKICAgICAgICByZXF1aXJlIChfdmFsdWUgPiAwKTsKICAgICAgCiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvLyBJc3N1ZSBuZXcgdG9rZW5zIHRvIHRoZSBhZGRyZXNzIF90byBpbiB0aGUgYW1vdW50IF9hbW91bnQuIEF2YWlsYWJsZSB0byB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IChjb250cmFjdCBDcm93ZHNhbGUpCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgY2FuTWludCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigweDAsIF90bywgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8vIFN0b3AgdGhlIHJlbGVhc2Ugb2YgdG9rZW5zLiBUaGlzIGlzIG5vdCBwb3NzaWJsZSB0byBjYW5jZWwuIEF2YWlsYWJsZSB0byB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0LgoJLy8gICAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewoJLy8gICAgICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CgkvLyAgICAgICAgTWludEZpbmlzaGVkKCk7CgkvLyAgICAgICAgcmV0dXJuIHRydWU7CgkvLyAgICB9CiAgICAKICAgIC8vIFJlZGVmaW5pdGlvbiBvZiB0aGUgbWV0aG9kIG9mIHRoZSByZXR1cm5pbmcgc3RhdHVzIG9mIHRoZSAiRXhjaGFuZ2UgcGF1c2UiLiAKICAgIC8vIE5ldmVyIGZvciB0aGUgb3duZXIgb2YgYW4gdW5wYXVzZWQgd2FsbGV0LgogICAgZnVuY3Rpb24gcGF1c2VkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci5wYXVzZWQoKSAmJiAhdW5wYXVzZWRXYWxsZXRbbXNnLnNlbmRlcl07CiAgICB9CiAgICAKICAgIAogICAgLy8gQWRkIGEgd2FsbGV0IGlnbm9yaW5nIHRoZSAiRXhjaGFuZ2UgcGF1c2UiLiBBdmFpbGFibGUgdG8gdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGFkZFVucGF1c2VkV2FsbGV0KGFkZHJlc3MgX3dhbGxldCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgdW5wYXVzZWRXYWxsZXRbX3dhbGxldF0gPSB0cnVlOwogICAgfQogICAgCiAgICAvLyBSZW1vdmUgdGhlIHdhbGxldCBpZ25vcmluZyB0aGUgIkV4Y2hhbmdlIHBhdXNlIi4gQXZhaWxhYmxlIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBkZWxVbnBhdXNlZFdhbGxldChhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgICB1bnBhdXNlZFdhbGxldFtfd2FsbGV0XSA9IGZhbHNlOwogICAgfQogICAgCiAgICAvLyBFbmFibGUgdGhlIHRyYW5zZmVyIG9mIGN1cnJlbnQgdG9rZW5zIHRvIG90aGVycy4gT25seSAxIHRpbWUuIERpc2FibGluZyB0aGlzIGlzIG5vdCBwb3NzaWJsZS4gCiAgICAvLyBBdmFpbGFibGUgdG8gdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHNldE1pZ3JhdGlvbkFnZW50KGFkZHJlc3MgX21pZ3JhdGlvbkFnZW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG1pZ3JhdGlvbkFnZW50ID09IDB4MCk7CiAgICAgICAgbWlncmF0aW9uQWdlbnQgPSBfbWlncmF0aW9uQWdlbnQ7CiAgICB9CiAgICAKICAgIC8vIFJlaXNzdWUgeW91ciB0b2tlbnMuCiAgICBmdW5jdGlvbiBtaWdyYXRlKCkgcHVibGljCiAgICB7CiAgICAgICAgdWludDI1NiB2YWx1ZSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUodmFsdWUgPiAwKTsKICAgIAogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKHZhbHVlKTsKICAgICAgICB0b3RhbE1pZ3JhdGVkID0gdG90YWxNaWdyYXRlZC5hZGQodmFsdWUpOwogICAgICAgIE1pZ3JhdGlvbkFnZW50KG1pZ3JhdGlvbkFnZW50KS5taWdyYXRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAgICAgTWlncmF0ZShtc2cuc2VuZGVyLG1pZ3JhdGlvbkFnZW50LHZhbHVlKTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IDA7CiAgICB9Cn0KCgovLyAoQTMpCi8vIENvbnRyYWN0IGZvciBmcmVlemluZyBvZiBpbnZlc3RvcnMnIGZ1bmRzLiBIZW5jZSwgaW52ZXN0b3JzIHdpbGwgYmUgYWJsZSB0byB3aXRoZHJhdyBtb25leSBpZiB0aGUgCi8vIHJvdW5kIGRvZXMgbm90IGF0dGFpbiB0aGUgc29mdGNhcC4gRnJvbSBoZXJlIHRoZSB3YWxsZXQgb2YgdGhlIGJlbmVmaWNpYXJ5IHdpbGwgcmVjZWl2ZSBhbGwgdGhlIAovLyBtb25leSAobmFtZWx5LCB0aGUgYmVuZWZpY2lhcnksIG5vdCB0aGUgbWFuYWdlcidzIHdhbGxldCkuCmNvbnRyYWN0IFJlZnVuZFZhdWx0IGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgCgl1aW50OCBwdWJsaWMgcm91bmQgPSAwOwoKCWVudW0gU3RhdGUgeyBBY3RpdmUsIFJlZnVuZGluZywgQ2xvc2VkIH0KICAKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHB1YmxpYyBkZXBvc2l0ZWQ7CgogICAgU3RhdGUgcHVibGljIHN0YXRlOwogIAogICAgZXZlbnQgQ2xvc2VkKCk7CiAgICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwogICAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHdlaUFtb3VudCk7CiAgCiAgICBmdW5jdGlvbiBSZWZ1bmRWYXVsdCgpIHB1YmxpYyB7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgICB9CiAgCiAgICAvLyBEZXBvc2l0aW5nIGZ1bmRzIG9uIGJlaGFsZiBvZiBhbiBJQ08gaW52ZXN0b3IuIEF2YWlsYWJsZSB0byB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0IChDcm93ZHNhbGUgQ29udHJhY3QpLgogICAgZnVuY3Rpb24gZGVwb3NpdChhZGRyZXNzIGludmVzdG9yKSBvbmx5T3duZXIgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKCQlkZXBvc2l0ZWRbcm91bmRdW2ludmVzdG9yXSA9IGRlcG9zaXRlZFtyb3VuZF1baW52ZXN0b3JdLmFkZChtc2cudmFsdWUpOwogICAgfQogIAogICAgLy8gTW92ZSB0aGUgY29sbGVjdGVkIGZ1bmRzIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MuIEF2YWlsYWJsZSB0byB0aGUgb3duZXIgb2YgdGhlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gY2xvc2UoYWRkcmVzcyBfd2FsbGV0KSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7CiAgICAgICAgQ2xvc2VkKCk7CiAgICAgICAgX3dhbGxldC50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQogIAogICAgLy8gQWxsb3cgcmVmdW5kIHRvIGludmVzdG9ycy4gQXZhaWxhYmxlIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgICB9CiAgCiAgICAvLyBSZXR1cm4gdGhlIGZ1bmRzIHRvIGEgc3BlY2lmaWVkIGludmVzdG9yLiBJbiBjYXNlIG9mIGZhaWx1cmUgb2YgdGhlIHJvdW5kLCB0aGUgaW52ZXN0b3IgCiAgICAvLyBzaG91bGQgY2FsbCB0aGlzIG1ldGhvZCBvZiB0aGlzIGNvbnRyYWN0IChSZWZ1bmRWYXVsdCkgb3IgY2FsbCB0aGUgbWV0aG9kIGNsYWltUmVmdW5kIG9mIENyb3dkc2FsZSAKICAgIC8vIGNvbnRyYWN0LiBUaGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBjYWxsZWQgZWl0aGVyIGJ5IHRoZSBpbnZlc3RvciBoaW1zZWxmLCBvciB0aGUgY29tcGFueSAKICAgIC8vIChvciBhbnlvbmUpIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24gaW4gdGhlIGxvb3AgdG8gcmV0dXJuIGZ1bmRzIHRvIGFsbCBpbnZlc3RvcnMgZW4gbWFzc2UuCiAgICBmdW5jdGlvbiByZWZ1bmQoYWRkcmVzcyBpbnZlc3RvcikgcHVibGljIHsKICAgICAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CgkJdWludDI1NiBkZXBvc2l0ZWRWYWx1ZSA9IGRlcG9zaXRlZFtyb3VuZF1baW52ZXN0b3JdOwoJCWRlcG9zaXRlZFtyb3VuZF1baW52ZXN0b3JdID0gMDsKICAgICAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICAgICAgUmVmdW5kZWQoaW52ZXN0b3IsIGRlcG9zaXRlZFZhbHVlKTsKICAgIH0KCglmdW5jdGlvbiByZXN0YXJ0KCkgb25seU93bmVyIHB1YmxpY3sKCSAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkNsb3NlZCk7CgkgICAgcm91bmQgKz0gMTsKCSAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKCX0KICAKICAgIC8vIERlc3RydWN0aW9uIG9mIHRoZSBjb250cmFjdCB3aXRoIHJldHVybiBvZiBmdW5kcyB0byB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuIEF2YWlsYWJsZSB0bwogICAgLy8gdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGRlbChhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHNlbGZkZXN0cnVjdChfd2FsbGV0KTsKICAgIH0KfQoKCmNvbnRyYWN0IERpc3RyaWJ1dG9yUmVmdW5kVmF1bHQgaXMgUmVmdW5kVmF1bHR7CiAKICAgIGFkZHJlc3MgcHVibGljIHRheENvbGxlY3RvcjsKICAgIHVpbnQyNTYgcHVibGljIHRheFZhbHVlOwogICAgCiAgICBmdW5jdGlvbiBEaXN0cmlidXRvclJlZnVuZFZhdWx0KGFkZHJlc3MgX3RheENvbGxlY3RvciwgdWludDI1NiBfdGF4VmFsdWUpIFJlZnVuZFZhdWx0KCkgcHVibGljewogICAgICAgIHRheENvbGxlY3RvciA9IF90YXhDb2xsZWN0b3I7CiAgICAgICAgdGF4VmFsdWUgPSBfdGF4VmFsdWU7CiAgICB9CiAgIAogICAgZnVuY3Rpb24gY2xvc2UoYWRkcmVzcyBfd2FsbGV0KSBvbmx5T3duZXIgcHVibGljIHsKICAgIAogICAgICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgICAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKICAgICAgICAKICAgICAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgICAgICBDbG9zZWQoKTsKICAgICAgICB1aW50MjU2IGFsbFBheSA9IHRoaXMuYmFsYW5jZTsKICAgICAgICB1aW50MjU2IGZvclRhcmdldDE7CiAgICAgICAgdWludDI1NiBmb3JUYXJnZXQyOwogICAgICAgIGlmKHRheFZhbHVlIDw9IGFsbFBheSl7CiAgICAgICAgICAgZm9yVGFyZ2V0MSA9IHRheFZhbHVlOwogICAgICAgICAgIGZvclRhcmdldDIgPSBhbGxQYXkuc3ViKHRheFZhbHVlKTsKICAgICAgICAgICB0YXhWYWx1ZSA9IDA7CiAgICAgICAgfWVsc2UgewogICAgICAgICAgICB0YXhWYWx1ZSA9IHRheFZhbHVlLnN1YihhbGxQYXkpOwogICAgICAgICAgICBmb3JUYXJnZXQxID0gYWxsUGF5OwogICAgICAgICAgICBmb3JUYXJnZXQyID0gMDsKICAgICAgICB9CiAgICAgICAgaWYoZm9yVGFyZ2V0MSAhPSAwKXsKICAgICAgICAgICAgdGF4Q29sbGVjdG9yLnRyYW5zZmVyKGZvclRhcmdldDEpOwogICAgICAgIH0KICAgICAgIAogICAgICAgIGlmKGZvclRhcmdldDIgIT0gMCl7CiAgICAgICAgICAgIF93YWxsZXQudHJhbnNmZXIoZm9yVGFyZ2V0Mik7CiAgICAgICAgfQoKICAgIH0KCn0KCgovLyAoQTEpCi8vIFRoZSBtYWluIGNvbnRyYWN0IGZvciB0aGUgc2FsZSBhbmQgbWFuYWdlbWVudCBvZiByb3VuZHMuCmNvbnRyYWN0IENyb3dkc2FsZXsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIGVudW0gSUNPVHlwZSB7cHJlU2FsZSwgc2FsZX0KICAgIGVudW0gUm9sZXMge2JlbmVmaWNpYXJ5LGFjY291bnRhbnQsbWFuYWdlcixvYnNlcnZlcix0ZWFtfQoKICAgIFRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICBib29sIHB1YmxpYyBpc0ZpbmFsaXplZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgaXNJbml0aWFsaXplZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgaXNQYXVzZWRDcm93ZHNhbGUgPSBmYWxzZTsKCiAgICBtYXBwaW5nICh1aW50OCA9PiBhZGRyZXNzKSBwdWJsaWMgd2FsbGV0czsKCiAgICB1aW50MjU2IHB1YmxpYyBtYXhQcm9maXQ7ICAgLy8gcGVyY2VudCBmcm9tIDAgdG8gOTAKICAgIHVpbnQyNTYgcHVibGljIG1pblByb2ZpdDsgICAvLyBwZXJjZW50IGZyb20gMCB0byA5MAogICAgdWludDI1NiBwdWJsaWMgc3RlcFByb2ZpdDsgIC8vIHBlcmNlbnQgc3RlcCwgZnJvbSAxIHRvIDUwIChwbGVhc2UsIHJlYWQgZG9jISkKCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7ICAgICAgICAvLyB1bml4dGltZQogICAgdWludDI1NiBwdWJsaWMgZW5kRGlzY291bnRUaW1lOyAgLy8gdW5peHRpbWUKICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7ICAgICAgICAgIC8vIHVuaXh0aW1lCgogICAgLy8gSG93IG1hbnkgdG9rZW5zIChleGNsdWRpbmcgdGhlIGJvbnVzKSBhcmUgdHJhbnNmZXJyZWQgdG8gdGhlIGludmVzdG9yIGluIGV4Y2hhbmdlIGZvciAxIEVUSAogICAgLy8gKipUSE9VU0FORFMqKiAxMF4zIGZvciBodW1hbiwgMSoqMyBmb3IgU29saWRpdHksIDFlMyBmb3IgTXlFdGhlcldhbGxldCAoTUVXKS4gCiAgICAvLyBFeGFtcGxlOiBpZiAxRVRIID0gNDAuNSBUb2tlbiA9PT4gdXNlIDQwNTAwCiAgICB1aW50MjU2IHB1YmxpYyByYXRlOyAgICAgICAgCiAgICAgIAogICAgLy8gSWYgdGhlIHJvdW5kIGRvZXMgbm90IGF0dGFpbiB0aGlzIHZhbHVlIGJlZm9yZSB0aGUgY2xvc2luZyBkYXRlLCB0aGUgcm91bmQgaXMgcmVjb2duaXplZCBhcyBhIAogICAgLy8gZmFpbHVyZSBhbmQgaW52ZXN0b3JzIHRha2UgdGhlIG1vbmV5IGJhY2sgKHRoZSBmb3VuZGVycyB3aWxsIG5vdCBpbnRlcmZlcmUgaW4gYW55IHdheSkuCiAgICAvLyAqKlFVSU5USUxMSU9OUyoqIDEwXjE4IC8gMSoqMTggLyAxZTE4LiBFeGFtcGxlOiBzb2Z0Y2FwPTE1RVRIID09PiB1c2UgMTUqKjE4IChTb2xpZGl0eSkgb3IgMTVlMTggKE1FVykKICAgIHVpbnQyNTYgcHVibGljIHNvZnRDYXA7CgogICAgLy8gVGhlIG1heGltdW0gcG9zc2libGUgYW1vdW50IG9mIGluY29tZQogICAgLy8gKipRVUlOVElMTElPTlMqKiAxMF4xOCAvIDEqKjE4IC8gMWUxOC4gRXhhbXBsZTogaGFyZGNhcD0xMjMuNDVFVEggPT0+IHVzZSAxMjM0NTAqKjE1IChTb2xpZGl0eSkgb3IgMTIzNDVlMTUgKE1FVykKICAgIHVpbnQyNTYgcHVibGljIGhhcmRDYXA7CgogICAgLy8gSWYgdGhlIGxhc3QgcGF5bWVudCBpcyBzbGlnaHRseSBoaWdoZXIgdGhhbiB0aGUgaGFyZGNhcCwgdGhlbiB0aGUgdXN1YWwgY29udHJhY3RzIGRvIAogICAgLy8gbm90IGFjY2VwdCBpdCwgYmVjYXVzZSBpdCBnb2VzIGJleW9uZCB0aGUgaGFyZGNhcC4gSG93ZXZlciBpdCBpcyBtb3JlIHJlYXNvbmFibGUgdG8gYWNjZXB0IHRoZQogICAgLy8gbGFzdCBwYXltZW50LCB2ZXJ5IHNsaWdodGx5IHJhaXNpbmcgdGhlIGhhcmRjYXAuIFRoZSB2YWx1ZSBpbmRpY2F0ZXMgYnkgaG93IG1hbnkgRVRIIHRoZSAKICAgIC8vIGxhc3QgcGF5bWVudCBjYW4gZXhjZWVkIHRoZSBoYXJkY2FwIHRvIGFsbG93IGl0IHRvIGJlIHBhaWQuIEltbWVkaWF0ZWx5IGFmdGVyIHRoaXMgcGF5bWVudCwgdGhlIAogICAgLy8gcm91bmQgY2xvc2VzLiBUaGUgZnVuZGVycyBzaG91bGQgd3JpdGUgaGVyZSBhIHNtYWxsIG51bWJlciwgbm90IG1vcmUgdGhhbiAxJSBvZiB0aGUgQ0FQLgogICAgLy8gQ2FuIGJlIGVxdWFsIHRvIHplcm8sIHRvIGNhbmNlbC4KICAgIC8vICoqUVVJTlRJTExJT05TKiogMTBeMTggLyAxKioxOCAvIDFlMTgKICAgIHVpbnQyNTYgcHVibGljIG92ZXJMaW1pdDsKCiAgICAvLyBUaGUgbWluaW11bSBwb3NzaWJsZSBwYXltZW50IGZyb20gYW4gaW52ZXN0b3IgaW4gRVRILiBQYXltZW50cyBiZWxvdyB0aGlzIHZhbHVlIHdpbGwgYmUgcmVqZWN0ZWQuCiAgICAvLyAqKlFVSU5USUxMSU9OUyoqIDEwXjE4IC8gMSoqMTggLyAxZTE4LiBFeGFtcGxlOiBtaW5QYXk9MC4xRVRIID09PiB1c2UgMTAwKioxNSAoU29saWRpdHkpIG9yIDEwMGUxNSAoTUVXKQogICAgdWludDI1NiBwdWJsaWMgbWluUGF5OwoKICAgIHVpbnQyNTYgZXRoV2VpUmFpc2VkOwogICAgdWludDI1NiBub25FdGhXZWlSYWlzZWQ7CiAgICB1aW50MjU2IHdlaVByZVNhbGU7CiAgICB1aW50MjU2IHB1YmxpYyB0b2tlblJlc2VydmVkOwoKICAgIERpc3RyaWJ1dG9yUmVmdW5kVmF1bHQgcHVibGljIHZhdWx0OwoKICAgIFNWVEFsbG9jYXRpb24gcHVibGljIGxvY2tlZEFsbG9jYXRpb247CgogICAgSUNPVHlwZSBJQ08gPSBJQ09UeXBlLnByZVNhbGU7CgogICAgdWludDI1NiBhbGxUb2tlbjsKCiAgICBib29sIHB1YmxpYyB0ZWFtID0gZmFsc2U7CgogICAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCiAgICBldmVudCBGaW5hbGl6ZWQoKTsKICAgIGV2ZW50IEluaXRpYWxpemVkKCk7CgogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKFRva2VuIF90b2tlbikgcHVibGljCiAgICB7CgogICAgICAgIC8vIEluaXRpYWxseSwgYWxsIG5leHQgNS03IHJvbGVzL3dhbGxldHMgYXJlIGdpdmVuIHRvIHRoZSBNYW5hZ2VyLiBUaGUgTWFuYWdlciBpcyBhbiBlbXBsb3llZSBvZiB0aGUgY29tcGFueSAKICAgICAgICAvLyB3aXRoIGtub3dsZWRnZSBvZiBJVCwgd2hvIHB1Ymxpc2hlcyB0aGUgY29udHJhY3QgYW5kIHNldHMgaXQgdXAuIEhvd2V2ZXIsIG1vbmV5IGFuZCB0b2tlbnMgcmVxdWlyZSAKICAgICAgICAvLyBhIEJlbmVmaWNpYXJ5IGFuZCBvdGhlciByb2xlcyAoQWNjb3VudGFudCwgVGVhbSwgZXRjLikuIFRoZSBNYW5hZ2VyIHdpbGwgbm90IGhhdmUgdGhlIHJpZ2h0IAogICAgICAgIC8vIHRvIHJlY2VpdmUgdGhlbS4gVG8gZW5hYmxlIHRoaXMsIHRoZSBNYW5hZ2VyIG11c3QgZWl0aGVyIGVudGVyIHNwZWNpZmljIHdhbGxldHMgaGVyZSwgb3IgcGVyZm9ybSAKICAgICAgICAvLyB0aGlzIHZpYSBtZXRob2QgY2hhbmdlV2FsbGV0LiBJbiB0aGUgZmluYWxpemF0aW9uIG1ldGhvZHMgaXQgaXMgd3JpdHRlbiB3aGljaCB3YWxsZXQgYW5kIAogICAgICAgIC8vIHdoYXQgcGVyY2VudGFnZSBvZiB0b2tlbnMgYXJlIHJlY2VpdmVkLgoKICAgICAgICAvLyBSZWNlaXZlcyBhbGwgdGhlIG1vbmV5ICh3aGVuIGZpbmFsaXppbmcgcHJlLUlDTyAmIElDTykKICAgICAgICB3YWxsZXRzW3VpbnQ4KFJvbGVzLmJlbmVmaWNpYXJ5KV0gPSAweDhkNmI0NDdmNDQzY2U3Y0FBMTIzOTlCNjBCQzlFNjAxRDAzMTExZjk7IAoKICAgICAgICAvLyBSZWNlaXZlcyBhbGwgdGhlIHRva2VucyBmb3Igbm9uLUVUSCBpbnZlc3RvcnMgKHdoZW4gZmluYWxpemluZyBwcmUtSUNPICYgSUNPKQogICAgICAgIHdhbGxldHNbdWludDgoUm9sZXMuYWNjb3VudGFudCldID0gMHg5OWEyODBEYzM0QTk5NjQ3NGU1MTQwZjM0NDM0Q0U1OWI1ZTY1ODc5OwoKICAgICAgICAvLyBBbGwgcmlnaHRzIGV4Y2VwdCB0aGUgcmlnaHRzIHRvIHJlY2VpdmUgdG9rZW5zIG9yIG1vbmV5LiBIYXMgdGhlIHJpZ2h0IHRvIGNoYW5nZSBhbnkgb3RoZXIgCiAgICAgICAgLy8gd2FsbGV0cyAoQmVuZWZpY2lhcnksIEFjY291bnRhbnQsIC4uLiksIGJ1dCBvbmx5IGlmIHRoZSByb3VuZCBoYXMgbm90IHN0YXJ0ZWQuIE9uY2UgdGhlIAogICAgICAgIC8vIHJvdW5kIGlzIGluaXRpYWxpemVkLCB0aGUgTWFuYWdlciBoYXMgbG9zdCBhbGwgcmlnaHRzIHRvIGNoYW5nZSB0aGUgd2FsbGV0cy4KICAgICAgICAvLyBJZiB0aGUgSUNPIGlzIGNvbmR1Y3RlZCBieSBvbmUgcGVyc29uLCB0aGVuIG5vdGhpbmcgbmVlZHMgdG8gYmUgY2hhbmdlZC4gUGVybWl0IGFsbCA3IHJvbGVzIAogICAgICAgIC8vIHBvaW50IHRvIGEgc2luZ2xlIHdhbGxldC4KICAgICAgICB3YWxsZXRzW3VpbnQ4KFJvbGVzLm1hbmFnZXIpXSA9IG1zZy5zZW5kZXI7IAoKICAgICAgICAvLyBIYXMgb25seSB0aGUgcmlnaHQgdG8gY2FsbCBwYXltZW50c0luT3RoZXJDdXJyZW5jeSAocGxlYXNlIHJlYWQgdGhlIGRvY3VtZW50KQogICAgICAgIHdhbGxldHNbdWludDgoUm9sZXMub2JzZXJ2ZXIpXSA9IDB4OGJhZjhGMTgyNTY5NTIzNjJFNDg1ZkVGMUQwOTA5RjIxZjlhODg2QzsKCiAgICAgICAgLy8gV2hlbiB0aGUgcm91bmQgaXMgZmluYWxpemVkLCBhbGwgdGVhbSB0b2tlbnMgYXJlIHRyYW5zZmVycmVkIHRvIGEgc3BlY2lhbCBmcmVlemluZyAKICAgICAgICAvLyBjb250cmFjdC4gQXMgc29vbiBhcyBkZWZyb3N0aW5nIGlzIG92ZXIsIG9ubHkgdGhlIFRlYW0gd2FsbGV0IHdpbGwgYmUgYWJsZSB0byAKICAgICAgICAvLyBjb2xsZWN0IGFsbCB0aGUgdG9rZW5zLiBJdCBkb2VzIG5vdCBzdG9yZSB0aGUgYWRkcmVzcyBvZiB0aGUgZnJlZXppbmcgY29udHJhY3QsIAogICAgICAgIC8vIGJ1dCB0aGUgZmluYWwgd2FsbGV0IG9mIHRoZSBwcm9qZWN0IHRlYW0uCiAgICAgICAgd2FsbGV0c1t1aW50OChSb2xlcy50ZWFtKV0gPSAweDI1MzY1ZDRCMjkzRWMzNGMzOUMwMGJCYWMzZTVDNUZmMmRDODFGNEY7CgogICAgICAgIC8vIHN0YXJ0VGltZSwgZW5kRGlzY291bnRUaW1lLCBlbmRUaW1lICh0aGVuIHlvdSBjYW4gY2hhbmdlIGl0IGluIHRoZSBzZXR1cCkKICAgICAgICBjaGFuZ2VQZXJpb2QoMTUxMDMxMTYwMCwgMTUxMTYwNzYwMCwgMTUxMTYwNzYwMCk7CgogICAgICAgIC8vIHNvZnRDYXAgJiBoYXJkQ2FwICh0aGVuIHlvdSBjYW4gY2hhbmdlIGl0IGluIHRoZSBzZXR1cCkKICAgICAgICBjaGFuZ2VUYXJnZXRzKDAgZXRoZXIsIDUxMTk1IGV0aGVyKTsgLy8gJDE1IDAwMCAwMDAgLyAkMjkzCgogICAgICAgIC8vIHJhdGUgKDEwXjMpLCBvdmVyTGltaXQgKDEwXjE4KSwgbWluUGF5ICgxMF4xOCkgKHRoZW4geW91IGNhbiBjaGFuZ2UgaXQgaW4gdGhlIHNldHVwKQogICAgICAgIGNoYW5nZVJhdGUoNjEyNTAsIDUwMCBldGhlciwgMTAgZXRoZXIpOwoKICAgICAgICAvLyBtaW5Qcm9maXQsIG1heFByb2ZpdCwgc3RlcFByb2ZpdAogICAgICAgIGNoYW5nZURpc2NvdW50KDAsMCwwKTsKIAogICAgICAgIHRva2VuID0gX3Rva2VuOwogICAgICAgIHRva2VuLnNldE93bmVyKCk7CgogICAgICAgIHRva2VuLnBhdXNlKCk7IC8vIGJsb2NrIGV4Y2hhbmdlIHRva2VucwoKICAgICAgICB0b2tlbi5hZGRVbnBhdXNlZFdhbGxldChtc2cuc2VuZGVyKTsKCiAgICAgICAgLy8gVGhlIHJldHVybiBvZiBmdW5kcyB0byBpbnZlc3RvcnMgJiBwYXkgZmVlIGZvciBwYXJ0bmVyIAogICAgICAgIHZhdWx0ID0gbmV3IERpc3RyaWJ1dG9yUmVmdW5kVmF1bHQoMHg3OTNBREY0RkIxRThhNzREZmQ1NDhCNUUyQjVjNTViNmVlQzlhM2Y4LCAxMCBldGhlcik7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbmFtZSBvZiB0aGUgY3VycmVudCByb3VuZCBpbiBwbGFpbiB0ZXh0LiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIElDT1NhbGVUeXBlKCkgIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZyl7CiAgICAgICAgcmV0dXJuIChJQ08gPT0gSUNPVHlwZS5wcmVTYWxlKT8ncHJlIElDTyc6J0lDTyc7CiAgICB9CgogICAgLy8gVHJhbnNmZXJzIHRoZSBmdW5kcyBvZiB0aGUgaW52ZXN0b3IgdG8gdGhlIGNvbnRyYWN0IG9mIHJldHVybiBvZiBmdW5kcy4gSW50ZXJuYWwuCiAgICBmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSBpbnRlcm5hbCB7CiAgICAgICAgdmF1bHQuZGVwb3NpdC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIENoZWNrIGZvciB0aGUgcG9zc2liaWxpdHkgb2YgYnV5aW5nIHRva2Vucy4gSW5zaWRlLiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CgogICAgICAgIC8vIFRoZSByb3VuZCBzdGFydGVkIGFuZCBkaWQgbm90IGVuZAogICAgICAgIGJvb2wgd2l0aGluUGVyaW9kID0gKG5vdyA+IHN0YXJ0VGltZSAmJiBub3cgPCBlbmRUaW1lKTsKCiAgICAgICAgLy8gUmF0ZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIG1pbmltdW0KICAgICAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSA+PSBtaW5QYXk7CgogICAgICAgIC8vIGhhcmRDYXAgaXMgbm90IHJlYWNoZWQsIGFuZCBpbiB0aGUgZXZlbnQgb2YgYSB0cmFuc2FjdGlvbiwgaXQgd2lsbCBub3QgYmUgZXhjZWVkZWQgYnkgbW9yZSB0aGFuIE92ZXJMaW1pdAogICAgICAgIGJvb2wgd2l0aGluQ2FwID0gbXNnLnZhbHVlIDw9IGhhcmRDYXAuc3ViKHdlaVJhaXNlZCgpKS5hZGQob3ZlckxpbWl0KTsKCiAgICAgICAgLy8gcm91bmQgaXMgaW5pdGlhbGl6ZWQgYW5kIG5vICJQYXVzZSBvZiB0cmFkaW5nIiBpcyBzZXQKICAgICAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZSAmJiB3aXRoaW5DYXAgJiYgaXNJbml0aWFsaXplZCAmJiAhaXNQYXVzZWRDcm93ZHNhbGU7CiAgICB9CgogICAgLy8gQ2hlY2sgZm9yIHRoZSBhYmlsaXR5IHRvIGZpbmFsaXplIHRoZSByb3VuZC4gQ29uc3RhbnQuCiAgICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CgogICAgICAgIGJvb2wgdGltZVJlYWNoZWQgPSBub3cgPiBlbmRUaW1lOwoKICAgICAgICBib29sIGNhcFJlYWNoZWQgPSB3ZWlSYWlzZWQoKSA+PSBoYXJkQ2FwOwoKICAgICAgICByZXR1cm4gKHRpbWVSZWFjaGVkIHx8IGNhcFJlYWNoZWQpICYmIGlzSW5pdGlhbGl6ZWQ7CiAgICB9CgogICAgLy8gRmluYWxpemUuIE9ubHkgYXZhaWxhYmxlIHRvIHRoZSBNYW5hZ2VyIGFuZCB0aGUgQmVuZWZpY2lhcnkuIElmIHRoZSByb3VuZCBmYWlsZWQsIHRoZW4gCiAgICAvLyBhbnlvbmUgY2FuIGNhbGwgdGhlIGZpbmFsaXphdGlvbiB0byB1bmxvY2sgdGhlIHJldHVybiBvZiBmdW5kcyB0byBpbnZlc3RvcnMKICAgIC8vIFlvdSBtdXN0IGNhbGwgYSBmdW5jdGlvbiB0byBmaW5hbGl6ZSBlYWNoIHJvdW5kIChhZnRlciB0aGUgcHJlLUlDTyAmIGFmdGVyIHRoZSBJQ08pCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyB7CgogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlciB8fCB3YWxsZXRzW3VpbnQ4KFJvbGVzLmJlbmVmaWNpYXJ5KV0gPT0gbXNnLnNlbmRlciB8fCAhZ29hbFJlYWNoZWQoKSk7CiAgICAgICAgcmVxdWlyZSghaXNGaW5hbGl6ZWQpOwogICAgICAgIHJlcXVpcmUoaGFzRW5kZWQoKSk7CgogICAgICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICAgICAgICBmaW5hbGl6YXRpb24oKTsKICAgICAgICBGaW5hbGl6ZWQoKTsKICAgIH0KCiAgICAvLyBUaGUgbG9naWMgb2YgZmluYWxpemF0aW9uLiBJbnRlcm5hbAogICAgZnVuY3Rpb24gZmluYWxpemF0aW9uKCkgaW50ZXJuYWwgewoKICAgICAgICAvLyBJZiB0aGUgZ29hbCBvZiB0aGUgYWNoaWV2ZW1lbnQKICAgICAgICBpZiAoZ29hbFJlYWNoZWQoKSkgewoKICAgICAgICAgICAgLy8gU2VuZCBldGhlciB0byBCZW5lZmljaWFyeQoJICAgICAgICB2YXVsdC5jbG9zZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLmJlbmVmaWNpYXJ5KV0pOwoKICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYW55dGhpbmcgdG8gZ2l2ZQogICAgICAgICAgICBpZiAodG9rZW5SZXNlcnZlZCA+IDApIHsKCiAgICAgICAgICAgICAgICAvLyBJc3N1ZSB0b2tlbnMgb2Ygbm9uLWV0aCBpbnZlc3RvcnMgdG8gQWNjb3VudGFudCBhY2NvdW50CiAgICAgICAgICAgICAgICB0b2tlbi5taW50KHdhbGxldHNbdWludDgoUm9sZXMuYWNjb3VudGFudCldLHRva2VuUmVzZXJ2ZWQpOwoKICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBjb3VudGVyCiAgICAgICAgICAgICAgICB0b2tlblJlc2VydmVkID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgdGhlIGZpbmFsaXphdGlvbiBpcyBSb3VuZCAxIHByZS1JQ08KICAgICAgICAgICAgaWYgKElDTyA9PSBJQ09UeXBlLnByZVNhbGUpIHsKCiAgICAgICAgICAgICAgICAvLyBSZXNldCBzZXR0aW5ncwogICAgICAgICAgICAgICAgaXNJbml0aWFsaXplZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgaXNGaW5hbGl6ZWQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyBTd2l0Y2ggdG8gdGhlIHNlY29uZCByb3VuZCAodG8gSUNPKQogICAgICAgICAgICAgICAgSUNPID0gSUNPVHlwZS5zYWxlOwoKICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBjb2xsZWN0aW9uIGNvdW50ZXIKICAgICAgICAgICAgICAgIHdlaVByZVNhbGUgPSB3ZWlSYWlzZWQoKTsKICAgICAgICAgICAgICAgIGV0aFdlaVJhaXNlZCA9IDA7CiAgICAgICAgICAgICAgICBub25FdGhXZWlSYWlzZWQgPSAwOwoKICAgICAgICAgICAgICAgIC8vIFJlLXN0YXJ0IGEgcmVmdW5kIGNvbnRyYWN0CiAgICAgICAgICAgICAgICB2YXVsdC5yZXN0YXJ0KCk7CgoKICAgICAgICAgICAgfSAKICAgICAgICAgICAgZWxzZSAvLyBJZiB0aGUgc2Vjb25kIHJvdW5kIGlzIGZpbmFsaXplZCAKICAgICAgICAgICAgeyAKCiAgICAgICAgICAgICAgICAvLyBSZWNvcmQgaG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgaXNzdWVkCiAgICAgICAgICAgICAgICBhbGxUb2tlbiA9IHRva2VuLnRvdGFsU3VwcGx5KCk7CgogICAgICAgICAgICAgICAgLy8gUGVybWlzc2lvbiB0byBjb2xsZWN0IHRva2VucyB0byB0aG9zZSB3aG8gY2FuIHBpY2sgdGhlbSB1cAogICAgICAgICAgICAgICAgdGVhbSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIGVsc2UgLy8gSWYgdGhleSBmYWlsZWQgcm91bmQKICAgICAgICB7IAogICAgICAgICAgICAvLyBBbGxvdyBpbnZlc3RvcnMgdG8gd2l0aGRyYXcgdGhlaXIgZnVuZHMKICAgICAgICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBUaGUgTWFuYWdlciBmcmVlemVzIHRoZSB0b2tlbnMgZm9yIHRoZSBUZWFtLgogICAgLy8gWW91IG11c3QgY2FsbCBhIGZ1bmN0aW9uIHRvIGZpbmFsaXplIFJvdW5kIDIgKG9ubHkgYWZ0ZXIgdGhlIElDTykKICAgIGZ1bmN0aW9uIGZpbmFsaXplMSgpICBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZSh0ZWFtKTsKICAgICAgICB0ZWFtID0gZmFsc2U7CiAgICAgICAgbG9ja2VkQWxsb2NhdGlvbiA9IG5ldyBTVlRBbGxvY2F0aW9uKHRva2VuLCB3YWxsZXRzW3VpbnQ4KFJvbGVzLnRlYW0pXSk7CiAgICAgICAgdG9rZW4uYWRkVW5wYXVzZWRXYWxsZXQobG9ja2VkQWxsb2NhdGlvbik7CiAgICAgICAgLy8gMjAlIC0gdG9rZW5zIHRvIFRlYW0gd2FsbGV0IGFmdGVyIGZyZWV6ZSAoODAlIGZvciBpbnZlc3RvcnMpCiAgICAgICAgLy8gKioqIENIRUNLIFRIRVNFIE5VTUJFUlMgKioqCiAgICAgICAgdG9rZW4ubWludChsb2NrZWRBbGxvY2F0aW9uLGFsbFRva2VuLm11bCgyMCkuZGl2KDgwKSk7CiAgICB9CgogICAgLy8gSW5pdGlhbGl6aW5nIHRoZSByb3VuZC4gQXZhaWxhYmxlIHRvIHRoZSBtYW5hZ2VyLiBBZnRlciBjYWxsaW5nIHRoZSBmdW5jdGlvbiwgCiAgICAvLyB0aGUgTWFuYWdlciBsb3NlcyBhbGwgcmlnaHRzOiBNYW5hZ2VyIGNhbiBub3QgY2hhbmdlIHRoZSBzZXR0aW5ncyAoc2V0dXApLCBjaGFuZ2UgCiAgICAvLyB3YWxsZXRzLCBwcmV2ZW50IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJvdW5kLCBldGMuIFlvdSBtdXN0IGNhbGwgYSBmdW5jdGlvbiBhZnRlciBzZXR1cCAKICAgIC8vIGZvciB0aGUgaW5pdGlhbCByb3VuZCAoYmVmb3JlIHRoZSBQcmUtSUNPIGFuZCBiZWZvcmUgdGhlIElDTykKICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSBwdWJsaWN7CgogICAgICAgIC8vIE9ubHkgdGhlIE1hbmFnZXIKICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBJZiBub3QgeWV0IGluaXRpYWxpemVkCiAgICAgICAgcmVxdWlyZSghaXNJbml0aWFsaXplZCk7CgogICAgICAgIC8vIEFuZCB0aGUgc3BlY2lmaWVkIHN0YXJ0IHRpbWUgaGFzIG5vdCB5ZXQgY29tZQogICAgICAgIC8vIElmIGluaXRpYWxpemF0aW9uIHJldHVybiBhbiBlcnJvciwgY2hlY2sgdGhlIHN0YXJ0IGRhdGUhCiAgICAgICAgcmVxdWlyZShub3cgPD0gc3RhcnRUaW1lKTsKCiAgICAgICAgaW5pdGlhbGl6YXRpb24oKTsKCiAgICAgICAgSW5pdGlhbGl6ZWQoKTsKCiAgICAgICAgaXNJbml0aWFsaXplZCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdGlhbGl6YXRpb24oKSBpbnRlcm5hbCB7CgkgICAgLy8gbm8gY29kZQogICAgfQoKICAgIC8vIEF0IHRoZSByZXF1ZXN0IG9mIHRoZSBpbnZlc3Rvciwgd2UgcmFpc2UgdGhlIGZ1bmRzIChpZiB0aGUgcm91bmQgaGFzIGZhaWxlZCBiZWNhdXNlIG9mIHRoZSBoYXJkY2FwKQogICAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoKSBwdWJsaWN7CiAgICAgICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIFdlIGNoZWNrIHdoZXRoZXIgd2UgY29sbGVjdGVkIHRoZSBuZWNlc3NhcnkgbWluaW11bSBmdW5kcy4gQ29uc3RhbnQuCiAgICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHdlaVJhaXNlZCgpID49IHNvZnRDYXA7CiAgICB9CgogICAgLy8gQ3VzdG9taXplLiBUaGUgYXJndW1lbnRzIGFyZSBkZXNjcmliZWQgaW4gdGhlIGNvbnN0cnVjdG9yIGFib3ZlLgogICAgZnVuY3Rpb24gc2V0dXAodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmREaXNjb3VudFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIHVpbnQyNTYgX3NvZnRDYXAsIHVpbnQyNTYgX2hhcmRDYXAsIHVpbnQyNTYgX3JhdGUsIHVpbnQyNTYgX292ZXJMaW1pdCwgdWludDI1NiBfbWluUGF5LCB1aW50MjU2IF9taW5Qcm9maXQsIHVpbnQyNTYgX21heFByb2ZpdCwgdWludDI1NiBfc3RlcFByb2ZpdCkgcHVibGljewogICAgICAgICAgICBjaGFuZ2VQZXJpb2QoX3N0YXJ0VGltZSwgX2VuZERpc2NvdW50VGltZSwgX2VuZFRpbWUpOwogICAgICAgICAgICBjaGFuZ2VUYXJnZXRzKF9zb2Z0Q2FwLCBfaGFyZENhcCk7CiAgICAgICAgICAgIGNoYW5nZVJhdGUoX3JhdGUsIF9vdmVyTGltaXQsIF9taW5QYXkpOwogICAgICAgICAgICBjaGFuZ2VEaXNjb3VudChfbWluUHJvZml0LCBfbWF4UHJvZml0LCBfc3RlcFByb2ZpdCk7CiAgICB9ICAKCgkvLyBDaGFuZ2UgdGhlIGRhdGUgYW5kIHRpbWU6IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHJvdW5kLCB0aGUgZW5kIG9mIHRoZSBib251cywgdGhlIGVuZCBvZiB0aGUgcm91bmQuIEF2YWlsYWJsZSB0byBNYW5hZ2VyCiAgICAvLyBEZXNjcmlwdGlvbiBpbiB0aGUgQ3Jvd2RzYWxlIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBjaGFuZ2VQZXJpb2QodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmREaXNjb3VudFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUpIHB1YmxpY3sKCiAgICAgICAgcmVxdWlyZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLm1hbmFnZXIpXSA9PSBtc2cuc2VuZGVyKTsKCiAgICAgICAgcmVxdWlyZSghaXNJbml0aWFsaXplZCk7CgogICAgICAgIC8vIERhdGUgYW5kIHRpbWUgYXJlIGNvcnJlY3QKICAgICAgICByZXF1aXJlKG5vdyA8PSBfc3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKF9lbmREaXNjb3VudFRpbWUgPiBfc3RhcnRUaW1lICYmIF9lbmREaXNjb3VudFRpbWUgPD0gX2VuZFRpbWUpOwoKICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgICAgICBlbmREaXNjb3VudFRpbWUgPSBfZW5kRGlzY291bnRUaW1lOwoKICAgIH0KCiAgICAvLyBXZSBjaGFuZ2UgdGhlIHB1cnBvc2Ugb2YgcmFpc2luZyBmdW5kcy4gQXZhaWxhYmxlIHRvIHRoZSBtYW5hZ2VyLgogICAgLy8gRGVzY3JpcHRpb24gaW4gdGhlIENyb3dkc2FsZSBjb25zdHJ1Y3Rvci4KICAgIGZ1bmN0aW9uIGNoYW5nZVRhcmdldHModWludDI1NiBfc29mdENhcCwgdWludDI1NiBfaGFyZENhcCkgcHVibGljIHsKCiAgICAgICAgcmVxdWlyZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLm1hbmFnZXIpXSA9PSBtc2cuc2VuZGVyKTsKCiAgICAgICAgcmVxdWlyZSghaXNJbml0aWFsaXplZCk7CgogICAgICAgIC8vIFRoZSBwYXJhbWV0ZXJzIGFyZSBjb3JyZWN0CiAgICAgICAgcmVxdWlyZShfc29mdENhcCA8PSBfaGFyZENhcCk7CgogICAgICAgIHNvZnRDYXAgPSBfc29mdENhcDsKICAgICAgICBoYXJkQ2FwID0gX2hhcmRDYXA7CiAgICB9CgogICAgLy8gQ2hhbmdlIHRoZSBwcmljZSAodGhlIG51bWJlciBvZiB0b2tlbnMgcGVyIDEgZXRoKSwgdGhlIG1heGltdW0gaGFyZENhcCBmb3IgdGhlIGxhc3QgYmV0LCAKICAgIC8vIHRoZSBtaW5pbXVtIGJldC4gQXZhaWxhYmxlIHRvIHRoZSBNYW5hZ2VyLgogICAgLy8gRGVzY3JpcHRpb24gaW4gdGhlIENyb3dkc2FsZSBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gY2hhbmdlUmF0ZSh1aW50MjU2IF9yYXRlLCB1aW50MjU2IF9vdmVyTGltaXQsIHVpbnQyNTYgX21pblBheSkgcHVibGljIHsKCiAgICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CgogICAgICAgICByZXF1aXJlKCFpc0luaXRpYWxpemVkKTsKCiAgICAgICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKCiAgICAgICAgIHJhdGUgPSBfcmF0ZTsKICAgICAgICAgb3ZlckxpbWl0ID0gX292ZXJMaW1pdDsKICAgICAgICAgbWluUGF5ID0gX21pblBheTsKICAgIH0KCiAgICAvLyBXZSBjaGFuZ2UgdGhlIHBhcmFtZXRlcnMgb2YgdGhlIGRpc2NvdW50OiUgbWluIGJvbnVzLCUgbWF4IGJvbnVzLCBudW1iZXIgb2Ygc3RlcHMuIAogICAgLy8gQXZhaWxhYmxlIHRvIHRoZSBtYW5hZ2VyLiBEZXNjcmlwdGlvbiBpbiB0aGUgQ3Jvd2RzYWxlIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBjaGFuZ2VEaXNjb3VudCh1aW50MjU2IF9taW5Qcm9maXQsIHVpbnQyNTYgX21heFByb2ZpdCwgdWludDI1NiBfc3RlcFByb2ZpdCkgcHVibGljIHsKCiAgICAgICAgcmVxdWlyZSh3YWxsZXRzW3VpbnQ4KFJvbGVzLm1hbmFnZXIpXSA9PSBtc2cuc2VuZGVyKTsKCiAgICAgICAgcmVxdWlyZSghaXNJbml0aWFsaXplZCk7CgogICAgICAgIC8vIFRoZSBwYXJhbWV0ZXJzIGFyZSBjb3JyZWN0CiAgICAgICAgcmVxdWlyZShfc3RlcFByb2ZpdCA8PSBfbWF4UHJvZml0LnN1YihfbWluUHJvZml0KSk7CgogICAgICAgIC8vIElmIG5vdCB6ZXJvIHN0ZXBzCiAgICAgICAgaWYoX3N0ZXBQcm9maXQgPiAwKXsKICAgICAgICAgICAgLy8gV2Ugd2lsbCBzcGVjaWZ5IHRoZSBtYXhpbXVtIHBlcmNlbnRhZ2UgYXQgd2hpY2ggaXQgaXMgcG9zc2libGUgdG8gcHJvdmlkZSAKICAgICAgICAgICAgLy8gdGhlIHNwZWNpZmllZCBudW1iZXIgb2Ygc3RlcHMgd2l0aG91dCBmcmFjdGlvbmFsIHBhcnRzCiAgICAgICAgICAgIG1heFByb2ZpdCA9IF9tYXhQcm9maXQuc3ViKF9taW5Qcm9maXQpLmRpdihfc3RlcFByb2ZpdCkubXVsKF9zdGVwUHJvZml0KS5hZGQoX21pblByb2ZpdCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIC8vIHRvIGF2b2lkIGEgZGl2aWRlIHRvIHplcm8gZXJyb3IsIHNldCB0aGUgYm9udXMgYXMgc3RhdGljCiAgICAgICAgICAgIG1heFByb2ZpdCA9IF9taW5Qcm9maXQ7CiAgICAgICAgfQoKICAgICAgICBtaW5Qcm9maXQgPSBfbWluUHJvZml0OwogICAgICAgIHN0ZXBQcm9maXQgPSBfc3RlcFByb2ZpdDsKICAgIH0KCiAgICAvLyBDb2xsZWN0ZWQgZnVuZHMgZm9yIHRoZSBjdXJyZW50IHJvdW5kLiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIHdlaVJhaXNlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYpewogICAgICAgIHJldHVybiBldGhXZWlSYWlzZWQuYWRkKG5vbkV0aFdlaVJhaXNlZCk7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgYW1vdW50IG9mIGZlZXMgZm9yIGJvdGggcGhhc2VzLiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIHdlaVRvdGFsUmFpc2VkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDI1Nil7CiAgICAgICAgcmV0dXJuIHdlaVByZVNhbGUuYWRkKHdlaVJhaXNlZCgpKTsKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBwZXJjZW50YWdlIG9mIHRoZSBib251cyBvbiB0aGUgY3VycmVudCBkYXRlLiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIGdldFByb2ZpdFBlcmNlbnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgcmV0dXJuIGdldFByb2ZpdFBlcmNlbnRGb3JEYXRhKG5vdyk7CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgcGVyY2VudGFnZSBvZiB0aGUgYm9udXMgb24gdGhlIGdpdmVuIGRhdGUuIENvbnN0YW50LgogICAgZnVuY3Rpb24gZ2V0UHJvZml0UGVyY2VudEZvckRhdGEodWludDI1NiB0aW1lTm93KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBpZiB0aGUgZGlzY291bnQgaXMgMCBvciB6ZXJvIHN0ZXBzLCBvciB0aGUgcm91bmQgZG9lcyBub3Qgc3RhcnQsIHdlIHJldHVybiB0aGUgbWluaW11bSBkaXNjb3VudAogICAgICAgIGlmKG1heFByb2ZpdCA9PSAwIHx8IHN0ZXBQcm9maXQgPT0gMCB8fCB0aW1lTm93ID4gZW5kRGlzY291bnRUaW1lKSB7CiAgICAgICAgICAgIHJldHVybiBtaW5Qcm9maXQuYWRkKDEwMCk7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGUgcm91bmQgaXMgb3ZlciAtIHRoZSBtYXhpbXVtCiAgICAgICAgaWYodGltZU5vdzw9c3RhcnRUaW1lKSB7CiAgICAgICAgICAgIHJldHVybiBtYXhQcm9maXQuYWRkKDEwMCk7CiAgICAgICAgfQoKICAgICAgICAvLyBib251cyBwZXJpb2QKICAgICAgICB1aW50MjU2IHJhbmdlID0gZW5kRGlzY291bnRUaW1lLnN1YihzdGFydFRpbWUpOwoKICAgICAgICAvLyBkZWx0YSBib251cyBwZXJjZW50YWdlCiAgICAgICAgdWludDI1NiBwcm9maXRSYW5nZSA9IG1heFByb2ZpdC5zdWIobWluUHJvZml0KTsKCiAgICAgICAgLy8gVGltZSBsZWZ0CiAgICAgICAgdWludDI1NiB0aW1lUmVzdCA9IGVuZERpc2NvdW50VGltZS5zdWIodGltZU5vdyk7CgogICAgICAgIC8vIERpdmlkZSB0aGUgZGVsdGEgb2YgdGltZSBpbnRvCiAgICAgICAgdWludDI1NiBwcm9maXRQcm9jZW50ID0gcHJvZml0UmFuZ2UuZGl2KHN0ZXBQcm9maXQpLm11bCh0aW1lUmVzdC5tdWwoc3RlcFByb2ZpdC5hZGQoMSkpLmRpdihyYW5nZSkpOwogICAgICAgIHJldHVybiBwcm9maXRQcm9jZW50LmFkZChtaW5Qcm9maXQpLmFkZCgxMDApOwogICAgfQoKICAgIC8vIFRoZSBhYmlsaXR5IHRvIHF1aWNrbHkgY2hlY2sgcHJlLUlDTyAob25seSBmb3IgUm91bmQgMSwgb25seSAxIHRpbWUpLiBDb21wbGV0ZXMgdGhlIHByZS1JQ08gYnkgCiAgICAvLyB0cmFuc2ZlcnJpbmcgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgdG9rZW5zIHRvIHRoZSBBY2NvdW50YW50J3Mgd2FsbGV0LiBBdmFpbGFibGUgdG8gdGhlIE1hbmFnZXIuIAogICAgLy8gVXNlIG9ubHkgaWYgdGhpcyBpcyBwcm92aWRlZCBieSB0aGUgc2NyaXB0IGFuZCB3aGl0ZSBwYXBlci4gSW4gdGhlIG5vcm1hbCBzY2VuYXJpbywgaXQgCiAgICAvLyBkb2VzIG5vdCBjYWxsIGFuZCB0aGUgZnVuZHMgYXJlIHJhaXNlZCBub3JtYWxseS4gV2UgcmVjb21tZW5kIHRoYXQgeW91IGRlbGV0ZSB0aGlzIAogICAgLy8gZnVuY3Rpb24gZW50aXJlbHksIHNvIGFzIG5vdCB0byBjb25mdXNlIHRoZSBhdWRpdG9ycy4gSW5pdGlhbGl6ZSAmIEZpbmFsaXplIG5vdCBuZWVkZWQuIAogICAgLy8gKiogUVVJTlRJTElPTlMgKiogIDEwXjE4IC8gMSoqMTggLyAxZTE4CiAgICBmdW5jdGlvbiBmYXN0SUNPKHVpbnQyNTYgX3RvdGFsU3VwcGx5KSBwdWJsaWMgewogICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIpOwogICAgICByZXF1aXJlKElDTyA9PSBJQ09UeXBlLnByZVNhbGUgJiYgIWlzSW5pdGlhbGl6ZWQpOwogICAgICB0b2tlbi5taW50KHdhbGxldHNbdWludDgoUm9sZXMuYWNjb3VudGFudCldLCBfdG90YWxTdXBwbHkpOwogICAgICBJQ08gPSBJQ09UeXBlLnNhbGU7CiAgICB9CiAgICAKICAgIC8vIFJlbW92ZSB0aGUgIlBhdXNlIG9mIGV4Y2hhbmdlIi4gQXZhaWxhYmxlIHRvIHRoZSBtYW5hZ2VyIGF0IGFueSB0aW1lLiBJZiB0aGUgCiAgICAvLyBtYW5hZ2VyIHJlZnVzZXMgdG8gcmVtb3ZlIHRoZSBwYXVzZSwgdGhlbiAxMjAgZGF5cyBhZnRlciB0aGUgc3VjY2Vzc2Z1bCAKICAgIC8vIGNvbXBsZXRpb24gb2YgdGhlIElDTywgYW55b25lIGNhbiByZW1vdmUgYSBwYXVzZSBhbmQgYWxsb3cgdGhlIGV4Y2hhbmdlIHRvIGNvbnRpbnVlLiAKICAgIC8vIFRoZSBtYW5hZ2VyIGRvZXMgbm90IGludGVyZmVyZSBhbmQgd2lsbCBub3QgYmUgYWJsZSB0byBkZWxheSB0aGUgdGVybS4gCiAgICAvLyBIZSBjYW4gb25seSBjYW5jZWwgdGhlIHBhdXNlIGJlZm9yZSB0aGUgYXBwb2ludGVkIHRpbWUuCiAgICBmdW5jdGlvbiB0b2tlblVucGF1c2UoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlciAKICAgICAgICAJfHwgKG5vdyA+IGVuZFRpbWUgKyAxMjAgZGF5cyAmJiBJQ08gPT0gSUNPVHlwZS5zYWxlICYmIGlzRmluYWxpemVkICYmIGdvYWxSZWFjaGVkKCkpKTsKICAgICAgICB0b2tlbi51bnBhdXNlKCk7CiAgICB9CgogICAgLy8gRW5hYmxlIHRoZSAiUGF1c2Ugb2YgZXhjaGFuZ2UiLiBBdmFpbGFibGUgdG8gdGhlIG1hbmFnZXIgdW50aWwgdGhlIElDTyBpcyBjb21wbGV0ZWQuCiAgICAvLyBUaGUgbWFuYWdlciBjYW5ub3QgdHVybiBvbiB0aGUgcGF1c2UsIGZvciBleGFtcGxlLCAzIHllYXJzIGFmdGVyIHRoZSBlbmQgb2YgdGhlIElDTy4KICAgIGZ1bmN0aW9uIHRva2VuUGF1c2UoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlciAmJiAhaXNGaW5hbGl6ZWQpOwogICAgICAgIHRva2VuLnBhdXNlKCk7CiAgICB9CiAgICAKICAgIC8vIFBhdXNlIG9mIHNhbGUuIEF2YWlsYWJsZSB0byB0aGUgbWFuYWdlci4KICAgIGZ1bmN0aW9uIGNyb3dkc2FsZVBhdXNlKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMubWFuYWdlcildID09IG1zZy5zZW5kZXIpOwogICAgICAgIHJlcXVpcmUoaXNQYXVzZWRDcm93ZHNhbGUgPT0gZmFsc2UpOwogICAgICAgIGlzUGF1c2VkQ3Jvd2RzYWxlID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBXaXRoZHJhd2FsIGZyb20gdGhlIHBhdXNlIG9mIHNhbGUuIEF2YWlsYWJsZSB0byB0aGUgbWFuYWdlci4KICAgIGZ1bmN0aW9uIGNyb3dkc2FsZVVucGF1c2UoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShpc1BhdXNlZENyb3dkc2FsZSA9PSB0cnVlKTsKICAgICAgICBpc1BhdXNlZENyb3dkc2FsZSA9IGZhbHNlOwogICAgfQoKICAgIC8vIENoZWNraW5nIHdoZXRoZXIgdGhlIHJpZ2h0cyB0byBhZGRyZXNzIGlnbm9yZSB0aGUgIlBhdXNlIG9mIGV4Y2hhbmdlIi4gSWYgdGhlIAogICAgLy8gd2FsbGV0IGlzIGluY2x1ZGVkIGluIHRoaXMgbGlzdCwgaXQgY2FuIHRyYW5zbGF0ZSB0b2tlbnMsIGlnbm9yaW5nIHRoZSBwYXVzZS4gQnkgZGVmYXVsdCwgCiAgICAvLyBvbmx5IHRoZSBmb2xsb3dpbmcgd2FsbGV0cyBhcmUgaW5jbHVkZWQ6IAogICAgLy8gICAgLSBBY2NvdW50YW50IHdhbGxldCAoaGUgc2hvdWxkIGltbWVkaWF0ZWx5IHRyYW5zZmVyIHRva2VucywgYnV0IG5vdCB0byBub24tRVRIIGludmVzdG9ycykKICAgIC8vICAgIC0gQ29udHJhY3QgZm9yIGZyZWV6aW5nIHRoZSB0b2tlbnMgZm9yIHRoZSBUZWFtIChidXQgVGVhbSB3YWxsZXQgbm90IGluY2x1ZGVkKQogICAgLy8gSW5zaWRlLiBDb25zdGFudC4KICAgIGZ1bmN0aW9uIHVucGF1c2VkV2FsbGV0KGFkZHJlc3MgX3dhbGxldCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgYm9vbCBfYWNjb3VudGFudCA9IHdhbGxldHNbdWludDgoUm9sZXMuYWNjb3VudGFudCldID09IF93YWxsZXQ7CiAgICAgICAgcmV0dXJuIF9hY2NvdW50YW50OwogICAgfQoKICAgIC8vIEZvciBleGFtcGxlIC0gQWZ0ZXIgNSB5ZWFycyBvZiB0aGUgcHJvamVjdCdzIGV4aXN0ZW5jZSwgYWxsIG9mIHVzIHN1ZGRlbmx5IGRlY2lkZWQgY29sbGVjdGl2ZWx5IAogICAgLy8gKGNvbXBhbnkgKyBpbnZlc3RvcnMpIHRoYXQgaXQgd291bGQgYmUgbW9yZSBwcm9maXRhYmxlIGZvciBldmVyeW9uZSB0byBzd2l0Y2ggdG8gYW5vdGhlciBzbWFydCAKICAgIC8vIGNvbnRyYWN0IHJlc3BvbnNpYmxlIGZvciB0b2tlbnMuIFRoZSBjb21wYW55IHRoZW4gcHJlcGFyZXMgYSBuZXcgdG9rZW4sIGludmVzdG9ycyAKICAgIC8vIGRpc2Fzc2VtYmxlLCBzdHVkeSwgZGlzY3VzcywgZXRjLiBBZnRlciBhIGdlbmVyYWwgYWdyZWVtZW50LCB0aGUgbWFuYWdlciBhbGxvd3MgYW55IGludmVzdG9yOgoJLy8gICAgICAtIHRvIGJ1cm4gdGhlIHRva2VucyBvZiB0aGUgcHJldmlvdXMgY29udHJhY3QKCS8vICAgICAgLSBnZW5lcmF0ZSBuZXcgdG9rZW5zIGZvciBhIG5ldyBjb250cmFjdAoJLy8gSXQgaXMgdW5kZXJzdG9vZCB0aGF0IGFmdGVyIGEgZ2VuZXJhbCBzb2x1dGlvbiB0aHJvdWdoIHRoaXMgZnVuY3Rpb24gYWxsIGludmVzdG9ycyAKCS8vIHdpbGwgY29sbGVjdGl2ZWx5IChhbmQgdm9sdW50YXJpbHkpIG1vdmUgdG8gYSBuZXcgdG9rZW4uCiAgICBmdW5jdGlvbiBtb3ZlVG9rZW5zKGFkZHJlc3MgX21pZ3JhdGlvbkFnZW50KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUod2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgdG9rZW4uc2V0TWlncmF0aW9uQWdlbnQoX21pZ3JhdGlvbkFnZW50KTsKICAgIH0KCgkvLyBDaGFuZ2UgdGhlIGFkZHJlc3MgZm9yIHRoZSBzcGVjaWZpZWQgcm9sZS4KCS8vIEF2YWlsYWJsZSB0byBhbnkgd2FsbGV0IG93bmVyIGV4Y2VwdCB0aGUgb2JzZXJ2ZXIuCgkvLyBBdmFpbGFibGUgdG8gdGhlIG1hbmFnZXIgdW50aWwgdGhlIHJvdW5kIGlzIGluaXRpYWxpemVkLgoJLy8gVGhlIE9ic2VydmVyJ3Mgd2FsbGV0IG9yIGhpcyBvd24gbWFuYWdlciBjYW4gY2hhbmdlIGF0IGFueSB0aW1lLgogICAgZnVuY3Rpb24gY2hhbmdlV2FsbGV0KFJvbGVzIF9yb2xlLCBhZGRyZXNzIF93YWxsZXQpIHB1YmxpYwogICAgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgCQkobXNnLnNlbmRlciA9PSB3YWxsZXRzW3VpbnQ4KF9yb2xlKV0gJiYgX3JvbGUgIT0gUm9sZXMub2JzZXJ2ZXIpCiAgICAgIAkJfHwKICAgICAgCQkJKG1zZy5zZW5kZXIgPT0gd2FsbGV0c1t1aW50OChSb2xlcy5tYW5hZ2VyKV0gJiYgKCFpc0luaXRpYWxpemVkIHx8IF9yb2xlID09IFJvbGVzLm9ic2VydmVyKSkKICAgICAgCSk7CiAgICAgICAgYWRkcmVzcyBvbGRXYWxsZXQgPSB3YWxsZXRzW3VpbnQ4KF9yb2xlKV07CiAgICAgICAgd2FsbGV0c1t1aW50OChfcm9sZSldID0gX3dhbGxldDsKICAgICAgICBpZighdW5wYXVzZWRXYWxsZXQob2xkV2FsbGV0KSkKICAgICAgICAgICAgdG9rZW4uZGVsVW5wYXVzZWRXYWxsZXQob2xkV2FsbGV0KTsKICAgICAgICBpZih1bnBhdXNlZFdhbGxldChfd2FsbGV0KSkKICAgICAgICAgICAgdG9rZW4uYWRkVW5wYXVzZWRXYWxsZXQoX3dhbGxldCk7CiAgICB9CgogICAgLy8gSWYgYSBsaXR0bGUgbW9yZSB0aGFuIGEgeWVhciBoYXMgZWxhcHNlZCAoSUNPIHN0YXJ0IGRhdGUgKyA0NjAgZGF5cyksIGEgc21hcnQgY29udHJhY3QgCiAgICAvLyB3aWxsIGFsbG93IHlvdSB0byBzZW5kIGFsbCB0aGUgbW9uZXkgdG8gdGhlIEJlbmVmaWNpYXJ5LCBpZiBhbnkgbW9uZXkgaXMgcHJlc2VudC4gVGhpcyBpcyAKICAgIC8vIHBvc3NpYmxlIGlmIHlvdSBtaXN0YWtlbmx5IGxhdW5jaCB0aGUgSUNPIGZvciAzMCB5ZWFycyAobm90IDMwIGRheXMpLCBpbnZlc3RvcnMgd2lsbCB0cmFuc2ZlciAKICAgIC8vIG1vbmV5IHRoZXJlIGFuZCB5b3Ugd2lsbCBub3QgYmUgYWJsZSB0byBwaWNrIHRoZW0gdXAgd2l0aGluIGEgcmVhc29uYWJsZSB0aW1lLiBJdCBpcyBhbHNvIAogICAgLy8gcG9zc2libGUgdGhhdCBpbiBvdXIgY2hlY2tlZCBzY3JpcHQgc29tZW9uZSB3aWxsIG1ha2UgdW5mb3Jlc2VlbiBtaXN0YWtlcywgc3BvaWxpbmcgdGhlIAogICAgLy8gZmluYWxpemF0aW9uLiBXaXRob3V0IGZpbmFsaXphdGlvbiwgbW9uZXkgY2Fubm90IGJlIHJldHVybmVkLiBUaGlzIGlzIGEgcmVzY3VlIG9wdGlvbiB0byAKICAgIC8vIGdldCBhcm91bmQgdGhpcyBwcm9ibGVtLCBidXQgYXZhaWxhYmxlIG9ubHkgYWZ0ZXIgYSB5ZWFyICg0NjAgZGF5cykuCgoJLy8gQW5vdGhlciByZWFzb24gLSB0aGUgSUNPIHdhcyBhIGZhaWx1cmUsIGJ1dCBub3QgYWxsIEVUSCBpbnZlc3RvcnMgdG9vayB0aGVpciBtb25leSBkdXJpbmcgdGhlIHllYXIgYWZ0ZXIuIAoJLy8gU29tZSBpbnZlc3RvcnMgbWF5IGhhdmUgbG9zdCBhIHdhbGxldCBrZXksIGZvciBleGFtcGxlLgoKCS8vIFRoZSBtZXRob2Qgd29ya3MgZXF1YWxseSB3aXRoIHRoZSBwcmUtSUNPIGFuZCBJQ08uIFdoZW4gdGhlIHByZS1JQ08gc3RhcnRzLCB0aGUgdGltZSBmb3IgdW5sb2NraW5nIAoJLy8gdGhlIGRpc3RydWN0VmF1bHQgYmVnaW5zLiBJZiB0aGUgSUNPIGlzIHRoZW4gc3RhcnRlZCwgdGhlbiB0aGUgdGVybSBzdGFydHMgYW5ldyBmcm9tIHRoZSBmaXJzdCBkYXkgb2YgdGhlIElDTy4KCgkvLyBOZXh0LCBhY3QgaW5kZXBlbmRlbnRseSwgaW4gYWNjb3JkYW5jZSB3aXRoIG9ibGlnYXRpb25zIHRvIGludmVzdG9ycy4KCgkvLyBXaXRoaW4gNDAwIGRheXMgb2YgdGhlIHN0YXJ0IG9mIHRoZSBSb3VuZCwgaWYgaXQgZmFpbHMgb25seSBpbnZlc3RvcnMgY2FuIHRha2UgbW9uZXkuIEFmdGVyIAoJLy8gdGhlIGRlYWRsaW5lIHRoaXMgY2FuIGFsc28gaW5jbHVkZSB0aGUgY29tcGFueSBhcyB3ZWxsIGFzIGludmVzdG9ycywgZGVwZW5kaW5nIG9uIHdobyBpcyB0aGUgZmlyc3QgdG8gdXNlIHRoZSBtZXRob2QuCiAgICBmdW5jdGlvbiBkaXN0cnVjdFZhdWx0KCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMuYmVuZWZpY2lhcnkpXSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKG5vdyA+IHN0YXJ0VGltZSArIDQwMCBkYXlzKTsKICAgICAgICB2YXVsdC5kZWwod2FsbGV0c1t1aW50OChSb2xlcy5iZW5lZmljaWFyeSldKTsKICAgIH0KCgoJLy8gV2UgYWNjZXB0IHBheW1lbnRzIG90aGVyIHRoYW4gRXRoZXJldW0gKEVUSCkgYW5kIG90aGVyIGN1cnJlbmNpZXMsIGZvciBleGFtcGxlLCBCaXRjb2luIChCVEMpLiAKCS8vIFBlcmhhcHMgb3RoZXIgdHlwZXMgb2YgY3J5cHRvY3VycmVuY3kgLSBzZWUgdGhlIG9yaWdpbmFsIHRlcm1zIGluIHRoZSB3aGl0ZSBwYXBlciBhbmQgb24gdGhlIElDTyB3ZWJzaXRlLgoKCS8vIFdlIHJlbGVhc2UgdG9rZW5zIG9uIEV0aGVyZXVtLiBEdXJpbmcgdGhlIHByZS1JQ08gYW5kIElDTyB3aXRoIGEgc21hcnQgY29udHJhY3QsIHlvdSBkaXJlY3RseSB0cmFuc2ZlciAKCS8vIHRoZSB0b2tlbnMgdGhlcmUgYW5kIGltbWVkaWF0ZWx5LCB3aXRoIHRoZSBzYW1lIHRyYW5zYWN0aW9uLCByZWNlaXZlIHRva2VucyBpbiB5b3VyIHdhbGxldC4KCgkvLyBXaGVuIHBheWluZyBpbiBhbnkgb3RoZXIgY3VycmVuY3ksIGZvciBleGFtcGxlIGluIEJUQywgd2UgYWNjZXB0IHlvdXIgbW9uZXkgdmlhIG9uZSBjb21tb24gd2FsbGV0LiAKCS8vIE91ciBtYW5hZ2VyIGZpeGVzIHRoZSBhbW91bnQgcmVjZWl2ZWQgZm9yIHRoZSBiaXRjb2luIHdhbGxldCBhbmQgY2FsbHMgdGhlIG1ldGhvZCBvZiB0aGUgc21hcnQgCiAgICAvLyBjb250cmFjdCBwYXltZW50c0luT3RoZXJDdXJyZW5jeSB0byBpbmZvcm0gaGltIGhvdyBtdWNoIGZvcmVpZ24gY3VycmVuY3kgaGFzIGJlZW4gcmVjZWl2ZWQgLSBvbiBhIGRhaWx5IGJhc2lzLiAKICAgIC8vIFRoZSBzbWFydCBjb250cmFjdCBwaW5zIHRoZSBudW1iZXIgb2YgYWNjZXB0ZWQgRVRIIGRpcmVjdGx5IGFuZCB0aGUgbnVtYmVyIG9mIEJUQy4gU21hcnQgY29udHJhY3QgCiAgICAvLyBtb25pdG9ycyBzb2Z0Y2FwIGFuZCBoYXJkY2FwLCBzbyBhcyBub3QgdG8gZ28gYmV5b25kIHRoaXMgZnJhbWV3b3JrLgoJCgkvLyBJbiB0aGVvcnksIGl0IGlzIHBvc3NpYmxlIHRoYXQgd2hlbiBhcHByb2FjaGluZyBoYXJkY2FwLCB3ZSB3aWxsIHJlY2VpdmUgYSB0cmFuc2ZlciAob25lIG9yIHNldmVyYWwgCgkvLyB0cmFuc2ZlcnMpIHRvIHRoZSB3YWxsZXQgb2YgQlRDLCB0aGF0IHRvZ2V0aGVyIHdpdGggcHJldmlvdXNseSByZWNlaXZlZCBtb25leSB3aWxsIGV4Y2VlZCB0aGUgaGFyZGNhcCBpbiB0b3RhbC4gCgkvLyBJbiB0aGlzIGNhc2UsIHdlIHdpbGwgcmVmdW5kIGFsbCB0aGUgYW1vdW50cyBhYm92ZSwgaW4gb3JkZXIgbm90IHRvIGV4Y2VlZCB0aGUgaGFyZGNhcC4KCgkvLyBDb2xsZWN0aW9uIG9mIG1vbmV5IGluIEJUQyB3aWxsIGJlIGNhcnJpZWQgb3V0IHZpYSBvbmUgY29tbW9uIHdhbGxldC4gVGhlIHdhbGxldCdzIGFkZHJlc3Mgd2lsbCBiZSBwdWJsaXNoZWQgCgkvLyBldmVyeXdoZXJlIChpbiBhIHdoaXRlIHBhcGVyLCBvbiB0aGUgSUNPIHdlYnNpdGUsIG9uIFRlbGVncmFtLCBvbiBCaXRjb2ludGFsaywgaW4gdGhpcyBjb2RlLCBldGMuKQoJLy8gQW55b25lIGludGVyZXN0ZWQgY2FuIGNoZWNrIHRoYXQgdGhlIGFkbWluaXN0cmF0b3Igb2YgdGhlIHNtYXJ0IGNvbnRyYWN0IHdyaXRlcyBkb3duIGV4YWN0bHkgdGhlIGFtb3VudCAKCS8vIGluIEVUSCAoaW4gZXF1aXZhbGVudCBmb3IgQlRDKSB0aGVyZS4gSW4gdGhlb3J5LCB0aGUgYWJpbGl0eSB0byBieXBhc3MgYSBzbWFydCBjb250cmFjdCB0byBhY2NlcHQgbW9uZXkgaW4gCgkvLyBCVEMgYW5kIG5vdCByZWdpc3RlciB0aGVtIGluIEVUSCBjcmVhdGVzIGEgcG9zc2liaWxpdHkgZm9yIG1hbmlwdWxhdGlvbiBieSB0aGUgY29tcGFueS4gVGhhbmtzIHRvIAoJLy8gcGF5bWVudHNJbk90aGVyQ3VycmVuY3kgaG93ZXZlciwgdGhpcyB0aHJlYXQgaXMgbGV2ZWxlZC4KCQoJLy8gQW55IHVzZXIgY2FuIGNoZWNrIHRoZSBhbW91bnRzIGluIEJUQyBhbmQgdGhlIHZhcmlhYmxlIG9mIHRoZSBzbWFydCBjb250cmFjdCB0aGF0IGFjY291bnRzIGZvciB0aGlzIAoJLy8gKHBheW1lbnRzSW5PdGhlckN1cnJlbmN5IG1ldGhvZCkuIEFueSB1c2VyIGNhbiBlYXNpbHkgY2hlY2sgdGhlIGluY29taW5nIHRyYW5zYWN0aW9ucyBpbiBhIHNtYXJ0IGNvbnRyYWN0IAoJLy8gb24gYSBkYWlseSBiYXNpcy4gQW55IGh5cG90aGV0aWNhbCB0cmlja3Mgb24gdGhlIHBhcnQgb2YgdGhlIGNvbXBhbnkgY2FuIGJlIGV4cG9zZWQgYW5kIHBhbmljIGR1cmluZyB0aGUgSUNPLCAKCS8vIHNpbXBseSBwb2ludGluZyBvdXQgdGhlIGluY29tcGF0aWJpbGl0eSBvZiBwYXltZW50c0luT3RoZXJDdXJyZW5jeSAoaWUsIHRoZSBhbW91bnQgb2YgRVRIICsgQlRDIGNvbGxlY3Rpb24pIAoJLy8gYW5kIHRoZSBhY3R1YWwgdHJhbnNhY3Rpb25zIGluIEJUQy4gVGhlIGNvbXBhbnkgc3RyaWN0bHkgYWRoZXJlcyB0byB0aGUgZGVzY3JpYmVkIHByaW5jaXBsZXMgb2Ygb3Blbm5lc3MuCgkKCS8vIFRoZSBjb21wYW55IGFkbWluaXN0cmF0b3IgaXMgcmVxdWlyZWQgdG8gc3luY2hyb25pemUgcGF5bWVudHNJbk90aGVyQ3VycmVuY3kgZXZlcnkgd29ya2luZyBkYXkgKGJ1dCB5b3UgCgkvLyBjYW5ub3Qgc3luY2hyb25pemUgaWYgdGhlcmUgYXJlIG5vIG5ldyBCVEMgcGF5bWVudHMpLiBJbiB0aGUgY2FzZSBvZiB1bmZvcmVzZWVuIHByb2JsZW1zLCBzdWNoIGFzIAoJLy8gYnJha2VzIG9uIHRoZSBFdGhlcmV1bSBuZXR3b3JrLCB0aGlzIG9wZXJhdGlvbiBtYXkgYmUgZGlmZmljdWx0LiBZb3Ugc2hvdWxkIG9ubHkgd29ycnkgaWYgdGhlIAoJLy8gYWRtaW5pc3RyYXRvciBkb2VzIG5vdCBzeW5jaHJvbml6ZSB0aGUgYW1vdW50IGZvciBtb3JlIHRoYW4gOTYgaG91cnMgaW4gYSByb3csIGFuZCB0aGUgQlRDIHdhbGxldAoJLy8gcmVjZWl2ZXMgc2lnbmlmaWNhbnQgYW1vdW50cy4gCgkKCS8vIFRoaXMgc2NlbmFyaW8gZW5zdXJlcyB0aGF0IGZvciB0aGUgc3VtIG9mIGFsbCBmZWVzIGluIGFsbCBjdXJyZW5jaWVzIHRoaXMgdmFsdWUgZG9lcyBub3QgZXhjZWVkIGhhcmRjYXAuCgogICAgLy8gT3VyIEJUQyB3YWxsZXQgZm9yIGF1ZGl0IGluIHRoaXMgZnVuY3Rpb246IDFDQXlMY0VTMXROdWF0UmhuTDFvb1BWaVozMnZGNUtRNEEKCiAgICAvLyAqKiBRVUlOVElMTElPTlMgKiogMTBeMTggLyAxKioxOCAvIDFlMTgKICAgIGZ1bmN0aW9uIHBheW1lbnRzSW5PdGhlckN1cnJlbmN5KHVpbnQyNTYgX3Rva2VuLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHdhbGxldHNbdWludDgoUm9sZXMub2JzZXJ2ZXIpXSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBib29sIHdpdGhpblBlcmlvZCA9IChub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lKTsKICAgICAgICAKICAgICAgICBib29sIHdpdGhpbkNhcCA9IF92YWx1ZS5hZGQoZXRoV2VpUmFpc2VkKSA8PSBoYXJkQ2FwLmFkZChvdmVyTGltaXQpOwogICAgICAgIHJlcXVpcmUod2l0aGluUGVyaW9kICYmIHdpdGhpbkNhcCAmJiBpc0luaXRpYWxpemVkKTsKCiAgICAgICAgbm9uRXRoV2VpUmFpc2VkID0gX3ZhbHVlOwogICAgICAgIHRva2VuUmVzZXJ2ZWQgPSBfdG9rZW47CgogICAgfQoKICAgIC8vIFRoZSBmdW5jdGlvbiBmb3Igb2J0YWluaW5nIHNtYXJ0IGNvbnRyYWN0IGZ1bmRzIGluIEVUSC4gSWYgYWxsIHRoZSBjaGVja3MgYXJlIHRydWUsIHRoZSB0b2tlbiBpcyAKICAgIC8vIHRyYW5zZmVycmVkIHRvIHRoZSBidXllciwgdGFraW5nIGludG8gYWNjb3VudCB0aGUgY3VycmVudCBib251cy4KICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGJlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSAweDApOwogICAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIHVpbnQyNTYgUHJvZml0UHJvY2VudCA9IGdldFByb2ZpdFBlcmNlbnQoKTsKICAgICAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgICAgICB1aW50MjU2IHRva2VucyA9IHdlaUFtb3VudC5tdWwocmF0ZSkubXVsKFByb2ZpdFByb2NlbnQpLmRpdigxMDAwMDApOwoKICAgICAgICAvLyB1cGRhdGUgc3RhdGUKICAgICAgICBldGhXZWlSYWlzZWQgPSBldGhXZWlSYWlzZWQuYWRkKHdlaUFtb3VudCk7CgogICAgICAgIHRva2VuLm1pbnQoYmVuZWZpY2lhcnksIHRva2Vucyk7CiAgICAgICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwoKICAgICAgICBmb3J3YXJkRnVuZHMoKTsKICAgIH0KCiAgICAvLyBidXlUb2tlbnMgYWxpYXMgCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogICAgfQoKfQoKLy8gKEIpCi8vIFRoZSBjb250cmFjdCBmb3IgZnJlZXppbmcgdG9rZW5zIGZvciB0aGUgdGVhbS4uCmNvbnRyYWN0IFNWVEFsbG9jYXRpb24gewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgVG9rZW4gcHVibGljIHRva2VuOwoKCWFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIHVpbnQyNTYgcHVibGljIHVubG9ja2VkQXQ7CgogICAgdWludDI1NiB0b2tlbnNDcmVhdGVkID0gMDsKCiAgICAvLyBUaGUgY29udHJhY3QgdGFrZXMgdGhlIEVSQzIwIGNvaW4gYWRkcmVzcyBmcm9tIHdoaWNoIHRoaXMgY29udHJhY3Qgd2lsbCB3b3JrIGFuZCBmcm9tIHRoZSAKICAgIC8vIG93bmVyIChUZWFtIHdhbGxldCkgd2hvIG93bnMgdGhlIGZ1bmRzLgogICAgZnVuY3Rpb24gU1ZUQWxsb2NhdGlvbihUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX293bmVyKSBwdWJsaWN7CgogICAgCS8vIEhvdyBtYW55IGRheXMgdG8gZnJlZXplIGZyb20gdGhlIG1vbWVudCBvZiBmaW5hbGl6aW5nIElDTwogICAgICAgIHVubG9ja2VkQXQgPSBub3cgKyAzNjUgZGF5czsgLy8gZnJlZXplIFRFQU0gdG9rZW5zIGZvciAxIHllYXIKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgIH0KCiAgICAvLyBJZiB0aGUgdGltZSBvZiBmcmVlemluZyBleHBpcmVkIHdpbGwgcmV0dXJuIHRoZSBmdW5kcyB0byB0aGUgb3duZXIuCiAgICBmdW5jdGlvbiB1bmxvY2soKSBwdWJsaWN7CiAgICAgICAgcmVxdWlyZShub3cgPj0gdW5sb2NrZWRBdCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2Zlcihvd25lcix0b2tlbi5iYWxhbmNlT2YodGhpcykpKTsKICAgIH0KfQ=='.
	

]
