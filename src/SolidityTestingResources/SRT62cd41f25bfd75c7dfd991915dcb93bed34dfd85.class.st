Class {
	#name : #SRT62cd41f25bfd75c7dfd991915dcb93bed34dfd85,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT62cd41f25bfd75c7dfd991915dcb93bed34dfd85 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBBcmd1bWVudHNDaGVja2VyIHsKCiAgICAvLy8gQGRldiBjaGVjayB3aGljaCBwcmV2ZW50cyBzaG9ydCBhZGRyZXNzIGF0dGFjawogICAgbW9kaWZpZXIgcGF5bG9hZFNpemVJcyh1aW50IHNpemUpIHsKICAgICAgIHJlcXVpcmUobXNnLmRhdGEubGVuZ3RoID09IHNpemUgKyA0IC8qIGZ1bmN0aW9uIHNlbGVjdG9yICovKTsKICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgY2hlY2sgdGhhdCBhZGRyZXNzIGlzIHZhbGlkCiAgICBtb2RpZmllciB2YWxpZEFkZHJlc3MoYWRkcmVzcyBhZGRyKSB7CiAgICAgICAgcmVxdWlyZShhZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIF87CiAgICB9Cn0KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gewogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKCiAgICAvLy8gQGRldiBtaW50cyBuZXcgdG9rZW5zCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKaW50ZXJmYWNlIElBcHByb3ZhbFJlY2lwaWVudCB7CiAgICAvKioKICAgICAqIEBub3RpY2UgU2lnbmFscyB0aGF0IHRva2VuIGhvbGRlciBhcHByb3ZlZCBzcGVuZGluZyBvZiB0b2tlbnMgYW5kIHNvbWUgYWN0aW9uIHNob3VsZCBiZSB0YWtlbi4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NlbmRlciB0b2tlbiBob2xkZXIgd2hpY2ggYXBwcm92ZWQgc3BlbmRpbmcgb2YgaGlzIHRva2VucwogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIGFwcHJvdmVkIHRvIGJlIHNwZW50CiAgICAgKiBAcGFyYW0gX2V4dHJhRGF0YSBhbnkgZXh0cmEgZGF0YSB0b2tlbiBob2xkZXIgcHJvdmlkZWQgdG8gdGhlIGNhbGwKICAgICAqCiAgICAgKiBAZGV2IHdhcm5pbmc6IGltcGxlbWVudG9ycyBzaG91bGQgdmFsaWRhdGUgc2VuZGVyIG9mIHRoaXMgbWVzc2FnZSAoaXQgc2hvdWxkIGJlIHRoZSB0b2tlbikgYW5kIG1ha2Ugbm8gZnVydGhlcgogICAgICogICAgICBhc3N1bXB0aW9ucyB1bmxlc3MgdmFsaWRhdGVkIHRoZW0gdmlhIEVSQzIwIG1ldGhvZHMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9zZW5kZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZXh0cmFEYXRhKSBwdWJsaWM7Cn0KCmludGVyZmFjZSBJRGV0YWNoYWJsZSB7CiAgICBmdW5jdGlvbiBkZXRhY2goKSBwdWJsaWM7Cn0KCmNvbnRyYWN0IG11bHRpb3duZWQgewoKCS8vIFRZUEVTCgogICAgLy8gc3RydWN0IGZvciB0aGUgc3RhdHVzIG9mIGEgcGVuZGluZyBvcGVyYXRpb24uCiAgICBzdHJ1Y3QgTXVsdGlPd25lZE9wZXJhdGlvblBlbmRpbmdTdGF0ZSB7CiAgICAgICAgLy8gY291bnQgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQKICAgICAgICB1aW50IHlldE5lZWRlZDsKCiAgICAgICAgLy8gYml0bWFwIG9mIGNvbmZpcm1hdGlvbnMgd2hlcmUgb3duZXIgI293bmVySW5kZXgncyBkZWNpc2lvbiBjb3JyZXNwb25kcyB0byAyKipvd25lckluZGV4IGJpdAogICAgICAgIHVpbnQgb3duZXJzRG9uZTsKCiAgICAgICAgLy8gcG9zaXRpb24gb2YgdGhpcyBvcGVyYXRpb24ga2V5IGluIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleAogICAgICAgIHVpbnQgaW5kZXg7CiAgICB9CgoJLy8gRVZFTlRTCgogICAgZXZlbnQgQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIGV2ZW50IFJldm9rZShhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbik7CiAgICBldmVudCBGaW5hbENvbmZpcm1hdGlvbihhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbik7CgogICAgLy8gc29tZSBvdGhlcnMgYXJlIGluIHRoZSBjYXNlIG9mIGFuIG93bmVyIGNoYW5naW5nLgogICAgZXZlbnQgT3duZXJDaGFuZ2VkKGFkZHJlc3Mgb2xkT3duZXIsIGFkZHJlc3MgbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJBZGRlZChhZGRyZXNzIG5ld093bmVyKTsKICAgIGV2ZW50IE93bmVyUmVtb3ZlZChhZGRyZXNzIG9sZE93bmVyKTsKCiAgICAvLyB0aGUgbGFzdCBvbmUgaXMgZW1pdHRlZCBpZiB0aGUgcmVxdWlyZWQgc2lnbmF0dXJlcyBjaGFuZ2UKICAgIGV2ZW50IFJlcXVpcmVtZW50Q2hhbmdlZCh1aW50IG5ld1JlcXVpcmVtZW50KTsKCgkvLyBNT0RJRklFUlMKCiAgICAvLyBzaW1wbGUgc2luZ2xlLXNpZyBmdW5jdGlvbiBtb2RpZmllci4KICAgIG1vZGlmaWVyIG9ubHlvd25lciB7CiAgICAgICAgcmVxdWlyZShpc093bmVyKG1zZy5zZW5kZXIpKTsKICAgICAgICBfOwogICAgfQogICAgLy8gbXVsdGktc2lnIGZ1bmN0aW9uIG1vZGlmaWVyOiB0aGUgb3BlcmF0aW9uIG11c3QgaGF2ZSBhbiBpbnRyaW5zaWMgaGFzaCBpbiBvcmRlcgogICAgLy8gdGhhdCBsYXRlciBhdHRlbXB0cyBjYW4gYmUgcmVhbGlzZWQgYXMgdGhlIHNhbWUgdW5kZXJseWluZyBvcGVyYXRpb24gYW5kCiAgICAvLyB0aHVzIGNvdW50IGFzIGNvbmZpcm1hdGlvbnMuCiAgICBtb2RpZmllciBvbmx5bWFueW93bmVycyhieXRlczMyIF9vcGVyYXRpb24pIHsKICAgICAgICBpZiAoY29uZmlybUFuZENoZWNrKF9vcGVyYXRpb24pKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgICAgIC8vIEV2ZW4gaWYgcmVxdWlyZWQgbnVtYmVyIG9mIGNvbmZpcm1hdGlvbnMgaGFzJ3QgYmVlbiBjb2xsZWN0ZWQgeWV0LAogICAgICAgIC8vIHdlIGNhbid0IHRocm93IGhlcmUgLSBiZWNhdXNlIGNoYW5nZXMgdG8gdGhlIHN0YXRlIGhhdmUgdG8gYmUgcHJlc2VydmVkLgogICAgICAgIC8vIEJ1dCwgY29uZmlybUFuZENoZWNrIGl0c2VsZiB3aWxsIHRocm93IGluIGNhc2Ugc2VuZGVyIGlzIG5vdCBhbiBvd25lci4KICAgIH0KCiAgICBtb2RpZmllciB2YWxpZE51bU93bmVycyh1aW50IF9udW1Pd25lcnMpIHsKICAgICAgICByZXF1aXJlKF9udW1Pd25lcnMgPiAwICYmIF9udW1Pd25lcnMgPD0gY19tYXhPd25lcnMpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQodWludCBfcmVxdWlyZWQsIHVpbnQgX251bU93bmVycykgewogICAgICAgIHJlcXVpcmUoX3JlcXVpcmVkID4gMCAmJiBfcmVxdWlyZWQgPD0gX251bU93bmVycyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvd25lckV4aXN0cyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShpc093bmVyKF9hZGRyZXNzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvd25lckRvZXNOb3RFeGlzdChhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZSghaXNPd25lcihfYWRkcmVzcykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbXVsdGlPd25lZE9wZXJhdGlvbklzQWN0aXZlKGJ5dGVzMzIgX29wZXJhdGlvbikgewogICAgICAgIHJlcXVpcmUoaXNPcGVyYXRpb25BY3RpdmUoX29wZXJhdGlvbikpOwogICAgICAgIF87CiAgICB9CgoJLy8gTUVUSE9EUwoKICAgIC8vIGNvbnN0cnVjdG9yIGlzIGdpdmVuIG51bWJlciBvZiBzaWdzIHJlcXVpcmVkIHRvIGRvIHByb3RlY3RlZCAib25seW1hbnlvd25lcnMiIHRyYW5zYWN0aW9ucwogICAgLy8gYXMgd2VsbCBhcyB0aGUgc2VsZWN0aW9uIG9mIGFkZHJlc3NlcyBjYXBhYmxlIG9mIGNvbmZpcm1pbmcgdGhlbSAobXNnLnNlbmRlciBpcyBub3QgYWRkZWQgdG8gdGhlIG93bmVycyEpLgogICAgZnVuY3Rpb24gbXVsdGlvd25lZChhZGRyZXNzW10gX293bmVycywgdWludCBfcmVxdWlyZWQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmFsaWROdW1Pd25lcnMoX293bmVycy5sZW5ndGgpCiAgICAgICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQoX3JlcXVpcmVkLCBfb3duZXJzLmxlbmd0aCkKICAgIHsKICAgICAgICBhc3NlcnQoY19tYXhPd25lcnMgPD0gMjU1KTsKCiAgICAgICAgbV9udW1Pd25lcnMgPSBfb3duZXJzLmxlbmd0aDsKICAgICAgICBtX211bHRpT3duZWRSZXF1aXJlZCA9IF9yZXF1aXJlZDsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX293bmVycy5sZW5ndGg7ICsraSkKICAgICAgICB7CiAgICAgICAgICAgIGFkZHJlc3Mgb3duZXIgPSBfb3duZXJzW2ldOwogICAgICAgICAgICAvLyBpbnZhbGlkIGFuZCBkdXBsaWNhdGUgYWRkcmVzc2VzIGFyZSBub3QgYWxsb3dlZAogICAgICAgICAgICByZXF1aXJlKDAgIT0gb3duZXIgJiYgIWlzT3duZXIob3duZXIpIC8qIG5vdCBpc093bmVyIHlldCEgKi8pOwoKICAgICAgICAgICAgdWludCBjdXJyZW50T3duZXJJbmRleCA9IGNoZWNrT3duZXJJbmRleChpICsgMSAvKiBmaXJzdCBzbG90IGlzIHVudXNlZCAqLyk7CiAgICAgICAgICAgIG1fb3duZXJzW2N1cnJlbnRPd25lckluZGV4XSA9IG93bmVyOwogICAgICAgICAgICBtX293bmVySW5kZXhbb3duZXJdID0gY3VycmVudE93bmVySW5kZXg7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgcmVwbGFjZXMgYW4gb3duZXIgYF9mcm9tYCB3aXRoIGFub3RoZXIgYF90b2AuCiAgICAvLy8gQHBhcmFtIF9mcm9tIGFkZHJlc3Mgb2Ygb3duZXIgdG8gcmVwbGFjZQogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBvZiBuZXcgb3duZXIKICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb3duZXJFeGlzdHMoX2Zyb20pCiAgICAgICAgb3duZXJEb2VzTm90RXhpc3QoX3RvKQogICAgICAgIG9ubHltYW55b3duZXJzKGtlY2NhazI1Nihtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgobV9vd25lckluZGV4W19mcm9tXSk7CiAgICAgICAgbV9vd25lcnNbb3duZXJJbmRleF0gPSBfdG87CiAgICAgICAgbV9vd25lckluZGV4W19mcm9tXSA9IDA7CiAgICAgICAgbV9vd25lckluZGV4W190b10gPSBvd25lckluZGV4OwoKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CiAgICAgICAgT3duZXJDaGFuZ2VkKF9mcm9tLCBfdG8pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGFkZHMgYW4gb3duZXIKICAgIC8vLyBAcGFyYW0gX293bmVyIGFkZHJlc3Mgb2YgbmV3IG93bmVyCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIF9vd25lcikKICAgICAgICBleHRlcm5hbAogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KF9vd25lcikKICAgICAgICB2YWxpZE51bU93bmVycyhtX251bU93bmVycyArIDEpCiAgICAgICAgb25seW1hbnlvd25lcnMoa2VjY2FrMjU2KG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIG1fbnVtT3duZXJzKys7CiAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gX293bmVyOwogICAgICAgIG1fb3duZXJJbmRleFtfb3duZXJdID0gY2hlY2tPd25lckluZGV4KG1fbnVtT3duZXJzKTsKCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgICAgIE93bmVyQWRkZWQoX293bmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSByZW1vdmVzIGFuIG93bmVyCiAgICAvLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIG9mIG93bmVyIHRvIHJlbW92ZQogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBfb3duZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvd25lckV4aXN0cyhfb3duZXIpCiAgICAgICAgdmFsaWROdW1Pd25lcnMobV9udW1Pd25lcnMgLSAxKQogICAgICAgIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KG1fbXVsdGlPd25lZFJlcXVpcmVkLCBtX251bU93bmVycyAtIDEpCiAgICAgICAgb25seW1hbnlvd25lcnMoa2VjY2FrMjU2KG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IGNoZWNrT3duZXJJbmRleChtX293bmVySW5kZXhbX293bmVyXSk7CiAgICAgICAgbV9vd25lcnNbb3duZXJJbmRleF0gPSAwOwogICAgICAgIG1fb3duZXJJbmRleFtfb3duZXJdID0gMDsKICAgICAgICAvL21ha2Ugc3VyZSBtX251bU93bmVycyBpcyBlcXVhbCB0byB0aGUgbnVtYmVyIG9mIG93bmVycyBhbmQgYWx3YXlzIHBvaW50cyB0byB0aGUgbGFzdCBvd25lcgogICAgICAgIHJlb3JnYW5pemVPd25lcnMoKTsKCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgICAgIE93bmVyUmVtb3ZlZChfb3duZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGNoYW5nZXMgdGhlIHJlcXVpcmVkIG51bWJlciBvZiBvd25lciBzaWduYXR1cmVzCiAgICAvLy8gQHBhcmFtIF9uZXdSZXF1aXJlZCBuZXcgbnVtYmVyIG9mIHNpZ25hdHVyZXMgcmVxdWlyZWQKICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIGNoYW5nZVJlcXVpcmVtZW50KHVpbnQgX25ld1JlcXVpcmVkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbXVsdGlPd25lZFZhbGlkUmVxdWlyZW1lbnQoX25ld1JlcXVpcmVkLCBtX251bU93bmVycykKICAgICAgICBvbmx5bWFueW93bmVycyhrZWNjYWsyNTYobXNnLmRhdGEpKQogICAgewogICAgICAgIG1fbXVsdGlPd25lZFJlcXVpcmVkID0gX25ld1JlcXVpcmVkOwogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIFJlcXVpcmVtZW50Q2hhbmdlZChfbmV3UmVxdWlyZWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldHMgYW4gb3duZXIgYnkgMC1pbmRleGVkIHBvc2l0aW9uCiAgICAvLy8gQHBhcmFtIG93bmVySW5kZXggMC1pbmRleGVkIG93bmVyIHBvc2l0aW9uCiAgICBmdW5jdGlvbiBnZXRPd25lcih1aW50IG93bmVySW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIG1fb3duZXJzW293bmVySW5kZXggKyAxXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXRzIG93bmVycwogICAgLy8vIEByZXR1cm4gbWVtb3J5IGFycmF5IG9mIG93bmVycwogICAgZnVuY3Rpb24gZ2V0T3duZXJzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3NbXSkgewogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IGFkZHJlc3NbXShtX251bU93bmVycyk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbV9udW1Pd25lcnM7IGkrKykKICAgICAgICAgICAgcmVzdWx0W2ldID0gZ2V0T3duZXIoaSk7CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgY2hlY2tzIGlmIHByb3ZpZGVkIGFkZHJlc3MgaXMgYW4gb3duZXIgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfYWRkciBhZGRyZXNzIHRvIGNoZWNrCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGl0J3MgYW4gb3duZXIKICAgIGZ1bmN0aW9uIGlzT3duZXIoYWRkcmVzcyBfYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbV9vd25lckluZGV4W19hZGRyXSA+IDA7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGVzdHMgb3duZXJzaGlwIG9mIHRoZSBjdXJyZW50IGNhbGxlci4KICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgaXQncyBhbiBvd25lcgogICAgLy8gSXQncyBhZHZpc2FibGUgdG8gY2FsbCBpdCBieSBuZXcgb3duZXIgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHNhbWUgZXJyb25lb3VzIGFkZHJlc3MgaXMgbm90IGNvcHktcGFzdGVkIHRvCiAgICAvLyBhZGRPd25lci9jaGFuZ2VPd25lciBhbmQgdG8gaXNPd25lci4KICAgIGZ1bmN0aW9uIGFtSU93bmVyKCkgZXh0ZXJuYWwgY29uc3RhbnQgb25seW93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXZva2VzIGEgcHJpb3IgY29uZmlybWF0aW9uIG9mIHRoZSBnaXZlbiBvcGVyYXRpb24KICAgIC8vLyBAcGFyYW0gX29wZXJhdGlvbiBvcGVyYXRpb24gdmFsdWUsIHR5cGljYWxseSBrZWNjYWsyNTYobXNnLmRhdGEpCiAgICBmdW5jdGlvbiByZXZva2UoYnl0ZXMzMiBfb3BlcmF0aW9uKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbXVsdGlPd25lZE9wZXJhdGlvbklzQWN0aXZlKF9vcGVyYXRpb24pCiAgICAgICAgb25seW93bmVyCiAgICB7CiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gbWFrZU93bmVyQml0bWFwQml0KG1zZy5zZW5kZXIpOwogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICByZXF1aXJlKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPiAwKTsKCiAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwoKICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCsrOwogICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSAtPSBvd25lckluZGV4Qml0OwoKICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgUmV2b2tlKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyBpZiBvd25lciBjb25maXJtZWQgZ2l2ZW4gb3BlcmF0aW9uCiAgICAvLy8gQHBhcmFtIF9vcGVyYXRpb24gb3BlcmF0aW9uIHZhbHVlLCB0eXBpY2FsbHkga2VjY2FrMjU2KG1zZy5kYXRhKQogICAgLy8vIEBwYXJhbSBfb3duZXIgYW4gb3duZXIgYWRkcmVzcwogICAgZnVuY3Rpb24gaGFzQ29uZmlybWVkKGJ5dGVzMzIgX29wZXJhdGlvbiwgYWRkcmVzcyBfb3duZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG11bHRpT3duZWRPcGVyYXRpb25Jc0FjdGl2ZShfb3BlcmF0aW9uKQogICAgICAgIG93bmVyRXhpc3RzKF9vd25lcikKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiAhKG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl0ub3duZXJzRG9uZSAmIG1ha2VPd25lckJpdG1hcEJpdChfb3duZXIpID09IDApOwogICAgfQoKICAgIC8vIElOVEVSTkFMIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBjb25maXJtQW5kQ2hlY2soYnl0ZXMzMiBfb3BlcmF0aW9uKQogICAgICAgIHByaXZhdGUKICAgICAgICBvbmx5b3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmICg1MTIgPT0gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4Lmxlbmd0aCkKICAgICAgICAgICAgLy8gSW4gY2FzZSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXggZ3Jvd3MgdG9vIG11Y2ggd2UgaGF2ZSB0byBzaHJpbmsgaXQ6IG90aGVyd2lzZSBhdCBzb21lIHBvaW50CiAgICAgICAgICAgIC8vIHdlIHdvbid0IGJlIGFibGUgdG8gZG8gaXQgYmVjYXVzZSBvZiBibG9jayBnYXMgbGltaXQuCiAgICAgICAgICAgIC8vIFllcywgcGVuZGluZyBjb25maXJtYXRpb25zIHdpbGwgYmUgbG9zdC4gRG9udCBzZWUgYW55IHNlY3VyaXR5IG9yIHN0YWJpbGl0eSBpbXBsaWNhdGlvbnMuCiAgICAgICAgICAgIC8vIFRPRE8gdXNlIG1vcmUgZ3JhY2VmdWwgYXBwcm9hY2ggbGlrZSBjb21wYWN0IG9yIHJlbW92YWwgb2YgY2xlYXJQZW5kaW5nIGNvbXBsZXRlbHkKICAgICAgICAgICAgY2xlYXJQZW5kaW5nKCk7CgogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKCiAgICAgICAgLy8gaWYgd2UncmUgbm90IHlldCB3b3JraW5nIG9uIHRoaXMgb3BlcmF0aW9uLCBzd2l0Y2ggb3ZlciBhbmQgcmVzZXQgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICAgICAgaWYgKCEgaXNPcGVyYXRpb25BY3RpdmUoX29wZXJhdGlvbikpIHsKICAgICAgICAgICAgLy8gcmVzZXQgY291bnQgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQuCiAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkID0gbV9tdWx0aU93bmVkUmVxdWlyZWQ7CiAgICAgICAgICAgIC8vIHJlc2V0IHdoaWNoIG93bmVycyBoYXZlIGNvbmZpcm1lZCAobm9uZSkgLSBzZXQgb3VyIGJpdG1hcCB0byAwLgogICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgPSAwOwogICAgICAgICAgICBwZW5kaW5nLmluZGV4ID0gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4Lmxlbmd0aCsrOwogICAgICAgICAgICBtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPSBfb3BlcmF0aW9uOwogICAgICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgfQoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gbWFrZU93bmVyQml0bWFwQml0KG1zZy5zZW5kZXIpOwogICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSAodGhlIG1lc3NhZ2Ugc2VuZGVyKSBoYXZlbid0IGNvbmZpcm1lZCB0aGlzIG9wZXJhdGlvbiBwcmV2aW91c2x5LgogICAgICAgIGlmIChwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID09IDApIHsKICAgICAgICAgICAgLy8gb2sgLSBjaGVjayBpZiBjb3VudCBpcyBlbm91Z2ggdG8gZ28gYWhlYWQuCiAgICAgICAgICAgIGFzc2VydChwZW5kaW5nLnlldE5lZWRlZCA+IDApOwogICAgICAgICAgICBpZiAocGVuZGluZy55ZXROZWVkZWQgPT0gMSkgewogICAgICAgICAgICAgICAgLy8gZW5vdWdoIGNvbmZpcm1hdGlvbnM6IHJlc2V0IGFuZCBydW4gaW50ZXJpb3IuCiAgICAgICAgICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W21fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl0uaW5kZXhdOwogICAgICAgICAgICAgICAgZGVsZXRlIG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgICAgICAgICBGaW5hbENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gbm90IGVub3VnaDogcmVjb3JkIHRoYXQgdGhpcyBvd25lciBpbiBwYXJ0aWN1bGFyIGNvbmZpcm1lZC4KICAgICAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkLS07CiAgICAgICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgfD0gb3duZXJJbmRleEJpdDsKICAgICAgICAgICAgICAgIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChfb3BlcmF0aW9uKTsKICAgICAgICAgICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBSZWNsYWltcyBmcmVlIHNsb3RzIGJldHdlZW4gdmFsaWQgb3duZXJzIGluIG1fb3duZXJzLgogICAgLy8gVE9ETyBnaXZlbiB0aGF0IGl0cyBjYWxsZWQgYWZ0ZXIgZWFjaCByZW1vdmFsLCBpdCBjb3VsZCBiZSBzaW1wbGlmaWVkLgogICAgZnVuY3Rpb24gcmVvcmdhbml6ZU93bmVycygpIHByaXZhdGUgewogICAgICAgIHVpbnQgZnJlZSA9IDE7CiAgICAgICAgd2hpbGUgKGZyZWUgPCBtX251bU93bmVycykKICAgICAgICB7CiAgICAgICAgICAgIC8vIGl0ZXJhdGluZyB0byB0aGUgZmlyc3QgZnJlZSBzbG90IGZyb20gdGhlIGJlZ2lubmluZwogICAgICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW2ZyZWVdICE9IDApIGZyZWUrKzsKCiAgICAgICAgICAgIC8vIGl0ZXJhdGluZyB0byB0aGUgZmlyc3Qgb2NjdXBpZWQgc2xvdCBmcm9tIHRoZSBlbmQKICAgICAgICAgICAgd2hpbGUgKG1fbnVtT3duZXJzID4gMSAmJiBtX293bmVyc1ttX251bU93bmVyc10gPT0gMCkgbV9udW1Pd25lcnMtLTsKCiAgICAgICAgICAgIC8vIHN3YXAsIGlmIHBvc3NpYmxlLCBzbyBmcmVlIHNsb3QgaXMgbG9jYXRlZCBhdCB0aGUgZW5kIGFmdGVyIHRoZSBzd2FwCiAgICAgICAgICAgIGlmIChmcmVlIDwgbV9udW1Pd25lcnMgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdICE9IDAgJiYgbV9vd25lcnNbZnJlZV0gPT0gMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gb3duZXJzIGJldHdlZW4gc3dhcHBlZCBzbG90cyBzaG91bGQndCBiZSByZW51bWJlcmVkIC0gdGhhdCBzYXZlcyBhIGxvdCBvZiBnYXMKICAgICAgICAgICAgICAgIG1fb3duZXJzW2ZyZWVdID0gbV9vd25lcnNbbV9udW1Pd25lcnNdOwogICAgICAgICAgICAgICAgbV9vd25lckluZGV4W21fb3duZXJzW2ZyZWVdXSA9IGZyZWU7CiAgICAgICAgICAgICAgICBtX293bmVyc1ttX251bU93bmVyc10gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNsZWFyUGVuZGluZygpIHByaXZhdGUgb25seW93bmVyIHsKICAgICAgICB1aW50IGxlbmd0aCA9IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGg7CiAgICAgICAgLy8gVE9ETyBibG9jayBnYXMgbGltaXQKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAobV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W2ldICE9IDApCiAgICAgICAgICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ1ttX211bHRpT3duZWRQZW5kaW5nSW5kZXhbaV1dOwogICAgICAgIH0KICAgICAgICBkZWxldGUgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4OwogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrT3duZXJJbmRleCh1aW50IG93bmVySW5kZXgpIHByaXZhdGUgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KDAgIT0gb3duZXJJbmRleCAmJiBvd25lckluZGV4IDw9IGNfbWF4T3duZXJzKTsKICAgICAgICByZXR1cm4gb3duZXJJbmRleDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlT3duZXJCaXRtYXBCaXQoYWRkcmVzcyBvd25lcikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtvd25lcl0pOwogICAgICAgIHJldHVybiAyICoqIG93bmVySW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gaXNPcGVyYXRpb25BY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gMCAhPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLnlldE5lZWRlZDsKICAgIH0KCgogICAgZnVuY3Rpb24gYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpIHByaXZhdGUgY29uc3RhbnQgewogICAgICAgIGFzc2VydChtX251bU93bmVycyA+IDApOwogICAgICAgIGFzc2VydChtX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgYXNzZXJ0KG1fb3duZXJzWzBdID09IDApOwogICAgICAgIGFzc2VydCgwICE9IG1fbXVsdGlPd25lZFJlcXVpcmVkICYmIG1fbXVsdGlPd25lZFJlcXVpcmVkIDw9IG1fbnVtT3duZXJzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgYXNzZXJ0KDAgIT0gcGVuZGluZy55ZXROZWVkZWQpOwogICAgICAgIGFzc2VydChtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPT0gX29wZXJhdGlvbik7CiAgICAgICAgYXNzZXJ0KHBlbmRpbmcueWV0TmVlZGVkIDw9IG1fbXVsdGlPd25lZFJlcXVpcmVkKTsKICAgIH0KCgogICAJLy8gRklFTERTCgogICAgdWludCBjb25zdGFudCBjX21heE93bmVycyA9IDI1MDsKCiAgICAvLyB0aGUgbnVtYmVyIG9mIG93bmVycyB0aGF0IG11c3QgY29uZmlybSB0aGUgc2FtZSBvcGVyYXRpb24gYmVmb3JlIGl0IGlzIHJ1bi4KICAgIHVpbnQgcHVibGljIG1fbXVsdGlPd25lZFJlcXVpcmVkOwoKCiAgICAvLyBwb2ludGVyIHVzZWQgdG8gZmluZCBhIGZyZWUgc2xvdCBpbiBtX293bmVycwogICAgdWludCBwdWJsaWMgbV9udW1Pd25lcnM7CgogICAgLy8gbGlzdCBvZiBvd25lcnMgKGFkZHJlc3NlcyksCiAgICAvLyBzbG90IDAgaXMgdW51c2VkIHNvIHRoZXJlIGFyZSBubyBvd25lciB3aGljaCBpbmRleCBpcyAwLgogICAgLy8gVE9ETyBjb3VsZCB3ZSBzYXZlIHNwYWNlIGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5IGZvciB0aGUgY29tbW9uIGNhc2Ugb2YgPDEwIG93bmVycz8gYW5kIHNob3VsZCB3ZT8KICAgIGFkZHJlc3NbMjU2XSBpbnRlcm5hbCBtX293bmVyczsKCiAgICAvLyBpbmRleCBvbiB0aGUgbGlzdCBvZiBvd25lcnMgdG8gYWxsb3cgcmV2ZXJzZSBsb29rdXA6IG93bmVyIGFkZHJlc3MgPT4gaW5kZXggaW4gbV9vd25lcnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBpbnRlcm5hbCBtX293bmVySW5kZXg7CgoKICAgIC8vIHRoZSBvbmdvaW5nIG9wZXJhdGlvbnMuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gTXVsdGlPd25lZE9wZXJhdGlvblBlbmRpbmdTdGF0ZSkgaW50ZXJuYWwgbV9tdWx0aU93bmVkUGVuZGluZzsKICAgIGJ5dGVzMzJbXSBpbnRlcm5hbCBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7Cn0KCmNvbnRyYWN0IE11bHRpb3duZWRDb250cm9sbGVkIGlzIG11bHRpb3duZWQgewoKICAgIGV2ZW50IENvbnRyb2xsZXJTZXQoYWRkcmVzcyBjb250cm9sbGVyKTsKICAgIGV2ZW50IENvbnRyb2xsZXJSZXRpcmVkKGFkZHJlc3Mgd2FzKTsKICAgIGV2ZW50IENvbnRyb2xsZXJSZXRpcmVkRm9yZXZlcihhZGRyZXNzIHdhcyk7CgoKICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbV9jb250cm9sbGVyKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlCgogICAgZnVuY3Rpb24gTXVsdGlvd25lZENvbnRyb2xsZWQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3NpZ25hdHVyZXNSZXF1aXJlZCwgYWRkcmVzcyBfY29udHJvbGxlcikKICAgICAgICBwdWJsaWMKICAgICAgICBtdWx0aW93bmVkKF9vd25lcnMsIF9zaWduYXR1cmVzUmVxdWlyZWQpCiAgICB7CiAgICAgICAgbV9jb250cm9sbGVyID0gX2NvbnRyb2xsZXI7CiAgICAgICAgQ29udHJvbGxlclNldChtX2NvbnRyb2xsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IHNldHMgdGhlIGNvbnRyb2xsZXIKICAgIGZ1bmN0aW9uIHNldENvbnRyb2xsZXIoYWRkcmVzcyBfY29udHJvbGxlcikgZXh0ZXJuYWwgb25seW1hbnlvd25lcnMoa2VjY2FrMjU2KG1zZy5kYXRhKSkgewogICAgICAgIHJlcXVpcmUobV9hdHRhY2hpbmdfZW5hYmxlZCk7CiAgICAgICAgbV9jb250cm9sbGVyID0gX2NvbnRyb2xsZXI7CiAgICAgICAgQ29udHJvbGxlclNldChtX2NvbnRyb2xsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IGFiaWxpdHkgZm9yIGNvbnRyb2xsZXIgdG8gc3RlcCBkb3duCiAgICBmdW5jdGlvbiBkZXRhY2hDb250cm9sbGVyKCkgZXh0ZXJuYWwgb25seUNvbnRyb2xsZXIgewogICAgICAgIGFkZHJlc3Mgd2FzID0gbV9jb250cm9sbGVyOwogICAgICAgIG1fY29udHJvbGxlciA9IGFkZHJlc3MoMCk7CiAgICAgICAgQ29udHJvbGxlclJldGlyZWQod2FzKTsKICAgIH0KCiAgICAvLy8gQGRldiBhYmlsaXR5IGZvciBjb250cm9sbGVyIHRvIHN0ZXAgZG93biBhbmQgbWFrZSB0aGlzIGNvbnRyYWN0IGNvbXBsZXRlbHkgYXV0b21hdGljICh3aXRob3V0IHRoaXJkLXBhcnR5IGNvbnRyb2wpCiAgICBmdW5jdGlvbiBkZXRhY2hDb250cm9sbGVyRm9yZXZlcigpIGV4dGVybmFsIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBhc3NlcnQobV9hdHRhY2hpbmdfZW5hYmxlZCk7CiAgICAgICAgYWRkcmVzcyB3YXMgPSBtX2NvbnRyb2xsZXI7CiAgICAgICAgbV9jb250cm9sbGVyID0gYWRkcmVzcygwKTsKICAgICAgICBtX2F0dGFjaGluZ19lbmFibGVkID0gZmFsc2U7CiAgICAgICAgQ29udHJvbGxlclJldGlyZWRGb3JldmVyKHdhcyk7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIGFkZHJlc3Mgb2YgZW50aXR5IGVudGl0bGVkIHRvIG1pbnQgbmV3IHRva2VucwogICAgYWRkcmVzcyBwdWJsaWMgbV9jb250cm9sbGVyOwoKICAgIGJvb2wgcHVibGljIG1fYXR0YWNoaW5nX2VuYWJsZWQgPSB0cnVlOwp9CgppbnRlcmZhY2UgSUVtaXNzaW9uUGFydE1pbnRlciB7CiAgICBmdW5jdGlvbiBtaW50UGFydE9mRW1pc3Npb24oYWRkcmVzcyB0bywgdWludCBwYXJ0LCB1aW50IHBhcnRPZkVtaXNzaW9uRm9yUHVibGljU2FsZXMpIHB1YmxpYzsKfQoKY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb250cmFjdCBDaXJjdWxhdGluZ1Rva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIGV2ZW50IENpcmN1bGF0aW9uRW5hYmxlZCgpOwoKICAgIG1vZGlmaWVyIHJlcXVpcmVzQ2lyY3VsYXRpb24gewogICAgICAgIHJlcXVpcmUobV9pc0NpcmN1bGF0aW5nKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlCgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmVxdWlyZXNDaXJjdWxhdGlvbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmVxdWlyZXNDaXJjdWxhdGlvbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXF1aXJlc0NpcmN1bGF0aW9uIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICAgIH0KCgogICAgLy8gSU5URVJOQUwgZnVuY3Rpb25zCgogICAgZnVuY3Rpb24gZW5hYmxlQ2lyY3VsYXRpb24oKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKG1faXNDaXJjdWxhdGluZykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBtX2lzQ2lyY3VsYXRpbmcgPSB0cnVlOwogICAgICAgIENpcmN1bGF0aW9uRW5hYmxlZCgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLyBGSUVMRFMKCiAgICAvLy8gQG5vdGljZSBhcmUgdGhlIGNpcmN1bGF0aW9uIHN0YXJ0ZWQ/CiAgICBib29sIHB1YmxpYyBtX2lzQ2lyY3VsYXRpbmc7Cn0KCmNvbnRyYWN0IE1pbnRhYmxlTXVsdGlvd25lZFRva2VuIGlzIE1pbnRhYmxlVG9rZW4sIE11bHRpb3duZWRDb250cm9sbGVkLCBTdGFuZGFyZFRva2VuIHsKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlCgogICAgZnVuY3Rpb24gTWludGFibGVNdWx0aW93bmVkVG9rZW4oYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3NpZ25hdHVyZXNSZXF1aXJlZCwgYWRkcmVzcyBfbWludGVyKQogICAgICAgIHB1YmxpYwogICAgICAgIE11bHRpb3duZWRDb250cm9sbGVkKF9vd25lcnMsIF9zaWduYXR1cmVzUmVxdWlyZWQsIF9taW50ZXIpCiAgICB7CiAgICB9CgoKICAgIC8vLyBAZGV2IG1pbnRzIG5ldyB0b2tlbnMKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICByZXF1aXJlKG1fZXh0ZXJuYWxNaW50aW5nRW5hYmxlZCk7CiAgICAgICAgbWludEludGVybmFsKF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgZGlzYWJsZXMgbWludCgpLCBpcnJldmVyc2libGUhCiAgICBmdW5jdGlvbiBkaXNhYmxlTWludGluZygpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgcmVxdWlyZShtX2V4dGVybmFsTWludGluZ0VuYWJsZWQpOwogICAgICAgIG1fZXh0ZXJuYWxNaW50aW5nRW5hYmxlZCA9IGZhbHNlOwogICAgfQoKCiAgICAvLyBJTlRFUk5BTCBmdW5jdGlvbnMKCiAgICBmdW5jdGlvbiBtaW50SW50ZXJuYWwoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgaW50ZXJuYWwgewogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9hbW91bnQpOwogICAgICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIH0KCgogICAgLy8gRklFTERTCgogICAgLy8vIEBub3RpY2UgaWYgdGhpcyB0cnVlIHRoZW4gdG9rZW4gaXMgc3RpbGwgZXh0ZXJuYWxseSBtaW50YWJsZQogICAgYm9vbCBwdWJsaWMgbV9leHRlcm5hbE1pbnRpbmdFbmFibGVkID0gdHJ1ZTsKfQoKY29udHJhY3QgU21hcnR6VG9rZW4gaXMgQ2lyY3VsYXRpbmdUb2tlbiwgTWludGFibGVNdWx0aW93bmVkVG9rZW4gewoKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGZyb20sIHVpbnQyNTYgYW1vdW50KTsKCgogICAgLy8gUFVCTElDIEZVTkNUSU9OUwoKICAgIC8qKgogICAgICogQG5vdGljZSBDb25zdHJ1Y3RzIHRva2VuLgogICAgICoKICAgICAqIEBwYXJhbSBfaW5pdGlhbE93bmVycyBpbml0aWFsIG11bHRpLXNpZ25hdHVyZXMsIHNlZSBjb21tZW50IGJlbG93CiAgICAgKiBAcGFyYW0gX3NpZ25hdHVyZXNSZXF1aXJlZCBxdW9ydW0gb2YgbXVsdGktc2lnbmF0dXJlcwogICAgICoKICAgICAqIEluaXRpYWwgb3duZXJzIGhhdmUgcG93ZXIgb3ZlciB0aGUgdG9rZW4gY29udHJhY3Qgb25seSBkdXJpbmcgYm9vdHN0cmFwIHBoYXNlIChlYXJseSBpbnZlc3RtZW50cyBhbmQgdG9rZW4KICAgICAqIHNhbGVzKS4gQWZ0ZXIgZmluYWwgdG9rZW4gc2FsZSBhbnkgY29udHJvbCBvdmVyIHRoZSB0b2tlbiByZW1vdmVkIGJ5IGlzc3VpbmcgZGV0YWNoQ29udHJvbGxlckZvcmV2ZXIgY2FsbC4KICAgICAqIEZvciBsaWZlY3ljbGUgZXhhbXBsZSBwbGVhc2Ugc2VlIHRlc3QvU21hcnR6VG9rZW5UZXN0LmpzLCAndGVzdCBmdWxsIGxpZmVjeWNsZScuCiAgICAgKi8KICAgIGZ1bmN0aW9uIFNtYXJ0elRva2VuKGFkZHJlc3NbXSBfaW5pdGlhbE93bmVycywgdWludCBfc2lnbmF0dXJlc1JlcXVpcmVkKQogICAgICAgIHB1YmxpYwogICAgICAgIE1pbnRhYmxlTXVsdGlvd25lZFRva2VuKF9pbml0aWFsT3duZXJzLCBfc2lnbmF0dXJlc1JlcXVpcmVkLCBhZGRyZXNzKDApKQogICAgewogICAgfQoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdG8gYnVybiBtc2cuc2VuZGVyJ3MgdG9rZW5zLgogICAgICoKICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJ1cm4KICAgICAqCiAgICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAgICovCiAgICBmdW5jdGlvbiBidXJuKHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhZGRyZXNzIGZyb20gPSBtc2cuc2VuZGVyOwogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA+IDApOwogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA8PSBiYWxhbmNlc1tmcm9tXSk7CgogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW2Zyb21dID0gYmFsYW5jZXNbZnJvbV0uc3ViKF9hbW91bnQpOwogICAgICAgIEJ1cm4oZnJvbSwgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoZnJvbSwgYWRkcmVzcygwKSwgX2Ftb3VudCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBBcHByb3ZlcyBzcGVuZGluZyB0b2tlbnMgYW5kIGltbWVkaWF0ZWx5IHRyaWdnZXJzIHRva2VuIHJlY2lwaWVudCBsb2dpYy4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgY29udHJhY3Qgd2hpY2ggc3VwcG9ydHMgSUFwcHJvdmFsUmVjaXBpZW50IGFuZCBhbGxvd2VkIHRvIHJlY2VpdmUgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgYXBwcm92ZWQgdG8gYmUgc3BlbnQKICAgICAqIEBwYXJhbSBfZXh0cmFEYXRhIGFueSBleHRyYSBkYXRhIHdoaWNoIHRvIGJlIHByb3ZpZGVkIHRvIHRoZSBfc3BlbmRlcgogICAgICoKICAgICAqIEJ5IGludm9raW5nIHRoaXMgdXRpbGl0eSBmdW5jdGlvbiB0b2tlbiBob2xkZXIgY291bGQgZG8gdHdvIHRoaW5ncyBpbiBvbmUgdHJhbnNhY3Rpb246IGFwcHJvdmUgc3BlbmRpbmcgaGlzCiAgICAgKiB0b2tlbnMgYW5kIGV4ZWN1dGUgc29tZSBleHRlcm5hbCBjb250cmFjdCB3aGljaCBzcGVuZHMgdGhlbSBvbiB0b2tlbiBob2xkZXIncyBiZWhhbGYuCiAgICAgKiBJdCBjYW4ndCBiZSBrbm93biBpZiBfc3BlbmRlcidzIGludm9jYXRpb24gc3VjY2VlZCBvciBub3QuCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cgaWYgYXBwcm92YWwgZmFpbGVkLgogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSkpOwogICAgICAgIElBcHByb3ZhbFJlY2lwaWVudChfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2V4dHJhRGF0YSk7CiAgICB9CgoKICAgIC8vIEFETUlOSVNUUkFUSVZFIEZVTkNUSU9OUwoKICAgIGZ1bmN0aW9uIHN0YXJ0Q2lyY3VsYXRpb24oKSBleHRlcm5hbCBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGVuYWJsZUNpcmN1bGF0aW9uKCk7CiAgICB9CgoKICAgIC8vIENPTlNUQU5UUwoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJTbWFydHogdG9rZW4iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiU01SIjsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4Owp9CgovLy8gQHRpdGxlIENvbnRyYWN0IG9yY2hlc3RyYXRlcyBtaW50aW5nIG9mIFNNUiB0b2tlbnMgdG8gdmFyaW91cyBwYXJ0aWVzLgpjb250cmFjdCBTbWFydHpUb2tlbkxpZmVjeWNsZU1hbmFnZXIgaXMgQXJndW1lbnRzQ2hlY2tlciwgbXVsdGlvd25lZCwgSURldGFjaGFibGUsIE1pbnRhYmxlVG9rZW4sIElFbWlzc2lvblBhcnRNaW50ZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLyoqCiAgICAgKiBAbm90aWNlIFN0YXRlIG1hY2hpbmUgb2YgdGhlIGNvbnRyYWN0LgogICAgICoKICAgICAqIFN0YXRlIHRyYW5zaXRpb25zIGFyZSBzdHJhaWdodGZvcndhcmQ6IE1JTlRJTkcyUFVCTElDX1NBTEVTIC0+IE1JTlRJTkcyUE9PTFMgLT4gQ0lSQ1VMQVRJTkdfVE9LRU4uCiAgICAgKi8KICAgIGVudW0gU3RhdGUgewogICAgICAgIC8vIG1pbnRpbmcgdG9rZW5zIGR1cmluZyBwdWJsaWMgc2FsZXMKICAgICAgICBNSU5USU5HMlBVQkxJQ19TQUxFUywKICAgICAgICAvLyBtaW50aW5nIHRva2VucyB0byB0b2tlbiBwb29scwogICAgICAgIE1JTlRJTkcyUE9PTFMsCiAgICAgICAgLy8gZnVydGhlciBtaW50aW5nIGlzIG5vdCBwb3NzaWJsZQogICAgICAgIENJUkNVTEFUSU5HX1RPS0VOCiAgICB9CgoKICAgIGV2ZW50IFN0YXRlQ2hhbmdlZChTdGF0ZSBfc3RhdGUpOwoKCiAgICBtb2RpZmllciByZXF1aXJlc1N0YXRlKFN0YXRlIF9zdGF0ZSkgewogICAgICAgIHJlcXVpcmUobV9zdGF0ZSA9PSBfc3RhdGUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUJ5KGFkZHJlc3MgX2Zyb20pIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gX2Zyb20pOwogICAgICAgIF87CiAgICB9CgoKICAgIC8vIFBVQkxJQyBGVU5DVElPTlMKCiAgICBmdW5jdGlvbiBTbWFydHpUb2tlbkxpZmVjeWNsZU1hbmFnZXIoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3NpZ25hdHVyZXNSZXF1aXJlZCwgU21hcnR6VG9rZW4gX1NNUikKICAgICAgICBwdWJsaWMKICAgICAgICB2YWxpZEFkZHJlc3MoX1NNUikKICAgICAgICBtdWx0aW93bmVkKF9vd25lcnMsIF9zaWduYXR1cmVzUmVxdWlyZWQpCiAgICB7CiAgICAgICAgbV9TTVIgPSBfU01SOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBNaW50cyB0b2tlbnMgZHVyaW5nIHB1YmxpYyBzYWxlcwogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWxvYWRTaXplSXMoMzIgKiAyKQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG8pCiAgICAgICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5NSU5USU5HMlBVQkxJQ19TQUxFUykKICAgICAgICBvbmx5QnkobV9zYWxlKQogICAgewogICAgICAgIG1fU01SLm1pbnQoX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBNaW50cyB0b2tlbnMgdG8gcHJlZGVmaW5lZCB0b2tlbiBwb29scyBhZnRlciBwdWJsaWMgc2FsZXMKICAgIGZ1bmN0aW9uIG1pbnRQYXJ0T2ZFbWlzc2lvbihhZGRyZXNzIHRvLCB1aW50IHBhcnQsIHVpbnQgcGFydE9mRW1pc3Npb25Gb3JQdWJsaWNTYWxlcykKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlsb2FkU2l6ZUlzKDMyICogMykKICAgICAgICB2YWxpZEFkZHJlc3ModG8pCiAgICAgICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5NSU5USU5HMlBPT0xTKQogICAgICAgIG9ubHlCeShtX3Bvb2xzKQogICAgewogICAgICAgIHVpbnQgcG9vbFRva2VucyA9IG1fcHVibGljbHlEaXN0cmlidXRlZFRva2Vucy5tdWwocGFydCkuZGl2KHBhcnRPZkVtaXNzaW9uRm9yUHVibGljU2FsZXMpOwogICAgICAgIG1fU01SLm1pbnQodG8sIHBvb2xUb2tlbnMpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIERldGFjaCBpcyBleGVjdXRlZCBieSBzYWxlIGNvbnRyYWN0IG9yIHRva2VuIHBvb2xzIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBkZXRhY2goKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIGlmIChtX3N0YXRlID09IFN0YXRlLk1JTlRJTkcyUFVCTElDX1NBTEVTKSB7CiAgICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtX3NhbGUpOwogICAgICAgICAgICBtX3NhbGUgPSBhZGRyZXNzKDApOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChtX3N0YXRlID09IFN0YXRlLk1JTlRJTkcyUE9PTFMpIHsKICAgICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG1fcG9vbHMpOwogICAgICAgICAgICBtX3Bvb2xzID0gYWRkcmVzcygwKTsKCiAgICAgICAgICAgIC8vIGZpbmFsIHN0YWdlIG9mIHRoZSBsaWZlY3ljbGU6IGF1dG9ub21vdXMgdG9rZW4gY2lyY3VsYXRpb24KICAgICAgICAgICAgY2hhbmdlU3RhdGUoU3RhdGUuQ0lSQ1VMQVRJTkdfVE9LRU4pOwogICAgICAgICAgICBtX1NNUi5kaXNhYmxlTWludGluZygpOwogICAgICAgICAgICBhc3NlcnQobV9TTVIuc3RhcnRDaXJjdWxhdGlvbigpKTsKICAgICAgICAgICAgbV9TTVIuZGV0YWNoQ29udHJvbGxlckZvcmV2ZXIoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KCgogICAgLy8gQURNSU5JU1RSQVRJVkUgRlVOQ1RJT05TCgogICAgLy8vIEBkZXYgU2V0cyB0aGUgbmV4dCBzYWxlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXRTYWxlKGFkZHJlc3Mgc2FsZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWxvYWRTaXplSXMoMzIpCiAgICAgICAgdmFsaWRBZGRyZXNzKHNhbGUpCiAgICAgICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5NSU5USU5HMlBVQkxJQ19TQUxFUykKICAgICAgICBvbmx5bWFueW93bmVycyhrZWNjYWsyNTYobXNnLmRhdGEpKQogICAgewogICAgICAgIG1fc2FsZSA9IHNhbGU7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0cyBjb250cmFjdCB3aGljaCBpcyByZXNwb25zaWJsZSBmb3IgdG9rZW4gcG9vbHMgYWNjb3VudGluZwogICAgZnVuY3Rpb24gc2V0UG9vbHMoYWRkcmVzcyBwb29scykKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWxvYWRTaXplSXMoMzIpCiAgICAgICAgdmFsaWRBZGRyZXNzKHBvb2xzKQogICAgICAgIHJlcXVpcmVzU3RhdGUoU3RhdGUuTUlOVElORzJQVUJMSUNfU0FMRVMpCiAgICAgICAgb25seW1hbnlvd25lcnMoa2VjY2FrMjU2KG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBtX3Bvb2xzID0gcG9vbHM7CiAgICB9CgogICAgLy8vIEBkZXYgU2lnbmFscyB0aGF0IHRoZXJlIHdpbGwgYmUgbm8gbW9yZSBwdWJsaWMgc2FsZXMKICAgIGZ1bmN0aW9uIHNldFNhbGVzRmluaXNoZWQoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5NSU5USU5HMlBVQkxJQ19TQUxFUykKICAgICAgICBvbmx5bWFueW93bmVycyhrZWNjYWsyNTYobXNnLmRhdGEpKQogICAgewogICAgICAgIHJlcXVpcmUobV9wb29scyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjaGFuZ2VTdGF0ZShTdGF0ZS5NSU5USU5HMlBPT0xTKTsKICAgICAgICBtX3B1YmxpY2x5RGlzdHJpYnV0ZWRUb2tlbnMgPSBtX1NNUi50b3RhbFN1cHBseSgpOwogICAgfQoKCiAgICAvLyBJTlRFUk5BTAoKICAgIC8vLyBAZGV2IHBlcmZvcm1zIG9ubHkgYWxsb3dlZCBzdGF0ZSB0cmFuc2l0aW9ucwogICAgZnVuY3Rpb24gY2hhbmdlU3RhdGUoU3RhdGUgX25ld1N0YXRlKQogICAgICAgIHByaXZhdGUKICAgIHsKICAgICAgICBhc3NlcnQobV9zdGF0ZSAhPSBfbmV3U3RhdGUpOwoKICAgICAgICBpZiAoU3RhdGUuTUlOVElORzJQVUJMSUNfU0FMRVMgPT0gbV9zdGF0ZSkgeyAgICBhc3NlcnQoU3RhdGUuTUlOVElORzJQT09MUyA9PSBfbmV3U3RhdGUpOyB9CiAgICAgICAgZWxzZSBpZiAoU3RhdGUuTUlOVElORzJQT09MUyA9PSBtX3N0YXRlKSB7ICAgICAgYXNzZXJ0KFN0YXRlLkNJUkNVTEFUSU5HX1RPS0VOID09IF9uZXdTdGF0ZSk7IH0KICAgICAgICBlbHNlIGFzc2VydChmYWxzZSk7CgogICAgICAgIG1fc3RhdGUgPSBfbmV3U3RhdGU7CiAgICAgICAgU3RhdGVDaGFuZ2VkKG1fc3RhdGUpOwogICAgfQoKCiAgICAvLyBGSUVMRFMKCiAgICAvLy8gQG5vdGljZSBtYW5hZ2VkIFNNUiB0b2tlbgogICAgU21hcnR6VG9rZW4gcHVibGljIG1fU01SOwoKICAgIC8vLyBAbm90aWNlIGN1cnJlbnQgc2FsZSBjb250cmFjdCB3aGljaCBjYW4gbWludCB0b2tlbnMKICAgIGFkZHJlc3MgcHVibGljIG1fc2FsZTsKCiAgICAvLy8gQG5vdGljZSBjb250cmFjdCB3aGljaCBpcyByZXNwb25zaWJsZSBmb3IgdG9rZW4gcG9vbHMgYWNjb3VudGluZwogICAgYWRkcmVzcyBwdWJsaWMgbV9wb29sczsKCiAgICAvLy8gQG5vdGljZSBzdGFnZSBvZiB0aGUgbGlmZSBjeWNsZQogICAgU3RhdGUgcHVibGljIG1fc3RhdGUgPSBTdGF0ZS5NSU5USU5HMlBVQkxJQ19TQUxFUzsKCiAgICAvLy8gQG5vdGljZSBhbW91bnQgb2YgdG9rZW5zIHNvbGQgZHVyaW5nIHB1YmxpYyBzYWxlcwogICAgdWludCBwdWJsaWMgbV9wdWJsaWNseURpc3RyaWJ1dGVkVG9rZW5zOwp9'.
	

]
