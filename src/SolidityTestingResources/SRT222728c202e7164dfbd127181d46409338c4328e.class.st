Class {
	#name : #SRT222728c202e7164dfbd127181d46409338c4328e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT222728c202e7164dfbd127181d46409338c4328e >> base64 [
	^ 'LyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLgogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBUaGUgTUlORFRva2VuIGNvbnRyYWN0CiAqIEBkZXYgVGhlIE1JTkRUb2tlbiBUb2tlbiBjb250cmFjdAogKiBAZGV2IGluaGVyaXRlIGZyb20gU3RhbmRhcmRUb2tlbiBhbmQgT3duYWJsZSBieSBaZXBwZWxpbgogKiBAYXV0aG9yIFJlcXVlc3QubmV0d29yawogKi8KY29udHJhY3QgTUlORFRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogICAgc3RyaW5nICBwdWJsaWMgIGNvbnN0YW50IG5hbWUgPSAiTUlORCBUb2tlbiI7CiAgICBzdHJpbmcgIHB1YmxpYyAgY29uc3RhbnQgc3ltYm9sID0gIk1JTkQiOwogICAgdWludDggICAgcHVibGljICBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgIHVpbnQgICAgcHVibGljICB0cmFuc2ZlcmFibGVTdGFydFRpbWU7CgogICAgYWRkcmVzcyBwdWJsaWMgIHRva2VuU2FsZUNvbnRyYWN0OwogICAgYWRkcmVzcyBwdWJsaWMgIGZ1bGxUb2tlbldhbGxldDsKCiAgICBmdW5jdGlvbiBnZXR0cmFuc2ZlcmFibGVTdGFydFRpbWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50KXtyZXR1cm4gbm93IC0gdHJhbnNmZXJhYmxlU3RhcnRUaW1lO30KCiAgICBtb2RpZmllciBvbmx5V2hlblRyYW5zZmVyRW5hYmxlZCgpIAogICAgewogICAgICAgIGlmICggbm93IDwgdHJhbnNmZXJhYmxlU3RhcnRUaW1lICkgewogICAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdG9rZW5TYWxlQ29udHJhY3QgfHwgbXNnLnNlbmRlciA9PSBmdWxsVG9rZW5XYWxsZXQgfHwgbXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWREZXN0aW5hdGlvbihhZGRyZXNzIHRvKSAKICAgIHsKICAgICAgICByZXF1aXJlKHRvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVNhbGVDb250cmFjdCgpCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHRva2VuU2FsZUNvbnRyYWN0KTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIE1JTkRUb2tlbigKICAgICAgICB1aW50IHRva2VuVG90YWxBbW91bnQsIAogICAgICAgIHVpbnQgX3RyYW5zZmVyYWJsZVN0YXJ0VGltZSwgCiAgICAgICAgYWRkcmVzcyBfYWRtaW4sIAogICAgICAgIGFkZHJlc3MgX2Z1bGxUb2tlbldhbGxldCkgCiAgICB7CiAgICAgICAgCiAgICAgICAgLy8gTWludCBhbGwgdG9rZW5zLiBUaGVuIGRpc2FibGUgbWludGluZyBmb3JldmVyLgogICAgICAgIHRvdGFsU3VwcGx5ID0gdG9rZW5Ub3RhbEFtb3VudCAqICgxMCAqKiB1aW50MjU2KGRlY2ltYWxzKSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gdG90YWxTdXBwbHk7CiAgICAgICAgVHJhbnNmZXIoYWRkcmVzcygweDApLCBtc2cuc2VuZGVyLCB0b3RhbFN1cHBseSk7CgogICAgICAgIHRyYW5zZmVyYWJsZVN0YXJ0VGltZSA9IF90cmFuc2ZlcmFibGVTdGFydFRpbWU7CiAgICAgICAgdG9rZW5TYWxlQ29udHJhY3QgPSBtc2cuc2VuZGVyOwogICAgICAgIGZ1bGxUb2tlbldhbGxldCA9IF9mdWxsVG9rZW5XYWxsZXQ7CgogICAgICAgIHRyYW5zZmVyT3duZXJzaGlwKF9hZG1pbik7IC8vIGFkbWluIGNvdWxkIGRyYWluIHRva2VucyBhbmQgZXRoIHRoYXQgd2VyZSBzZW50IGhlcmUgYnkgbWlzdGFrZQoKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgb3ZlcnJpZGUgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MgdG8gYWRkIG9ubHlXaGVuVHJhbnNmZXJFbmFibGVkIGFuZCB2YWxpZERlc3RpbmF0aW9uCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgdmFsaWREZXN0aW5hdGlvbihfdG8pCiAgICAgICAgb25seVdoZW5UcmFuc2ZlckVuYWJsZWQKICAgICAgICByZXR1cm5zIChib29sKSAKICAgIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBvdmVycmlkZSB0cmFuc2ZlckZyb20gdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MgdG8gYWRkIG9ubHlXaGVuVHJhbnNmZXJFbmFibGVkIGFuZCB2YWxpZERlc3RpbmF0aW9uCiAgICAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgZnJvbS4KICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgdmFsaWREZXN0aW5hdGlvbihfdG8pCiAgICAgICAgb25seVdoZW5UcmFuc2ZlckVuYWJsZWQKICAgICAgICByZXR1cm5zIChib29sKSAKICAgIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgX2J1cm5lciwgdWludCBfdmFsdWUpOwoKICAgIC8qKgogICAgICogQGRldiBidXJuIHRva2VucwogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIGJ1cm5lZC4KICAgICAqIEByZXR1cm4gYWx3YXlzIHRydWUgKG5lY2Vzc2FyeSBpbiBjYXNlIG9mIG92ZXJyaWRlKQogICAgICovCiAgICBmdW5jdGlvbiBidXJuKHVpbnQgX3ZhbHVlKSAKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2hlblRyYW5zZmVyRW5hYmxlZAogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIEJ1cm4obXNnLnNlbmRlciwgX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBhZGRyZXNzKDB4MCksIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGJ1cm4gdG9rZW5zIGluIHRoZSBiZWhhbGYgb2Ygc29tZW9uZQogICAgICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBvd25lciBvZiB0aGUgdG9rZW4uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgYnVybmVkLgogICAgICogQHJldHVybiBhbHdheXMgdHJ1ZSAobmVjZXNzYXJ5IGluIGNhc2Ugb2Ygb3ZlcnJpZGUpCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJ1cm5Gcm9tKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlKSAKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2hlblRyYW5zZmVyRW5hYmxlZAogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMoYm9vbCkgCiAgICB7CiAgICAgICAgYXNzZXJ0KHRyYW5zZmVyRnJvbShfZnJvbSwgbXNnLnNlbmRlciwgX3ZhbHVlKSk7CiAgICAgICAgcmV0dXJuIGJ1cm4oX3ZhbHVlKTsKICAgIH0KCiAgICAvKiogCiAgICAqIGVuYWJsZSB0cmFuc2ZlciBlYXJsaWVyIChvbmx5IHByZXNhbGUgY29udHJhY3QgY2FuIGVuYWJsZSB0aGUgc2FsZSBlYXJsaWVyKQogICAgKi8KICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVyRWFybGllciAoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlTYWxlQ29udHJhY3QKICAgIHsKICAgICAgICB0cmFuc2ZlcmFibGVTdGFydFRpbWUgPSBub3cgKyAzIGRheXM7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiB0cmFuc2ZlciB0byBvd25lciBhbnkgdG9rZW5zIHNlbmQgYnkgbWlzdGFrZSBvbiB0aGlzIGNvbnRyYWN0cwogICAgICogQHBhcmFtIHRva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcmVkLgogICAgICovCiAgICBmdW5jdGlvbiBlbWVyZ2VuY3lFUkMyMERyYWluKEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyIAogICAgewogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBhbW91bnQpOwogICAgfQoKfQoKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmRDcm93ZHNhbGUgCiAqIEBkZXYgU3RhbmRhcmRDcm93ZHNhbGUgaXMgYSBiYXNlIGNvbnRyYWN0IGZvciBtYW5hZ2luZyBhIHRva2VuIGNyb3dkc2FsZS4KICogQ3Jvd2RzYWxlcyBoYXZlIGEgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzLCB3aGVyZSBpbnZlc3RvcnMgY2FuIG1ha2UKICogdG9rZW4gcHVyY2hhc2VzIGFuZCB0aGUgY3Jvd2RzYWxlIHdpbGwgYXNzaWduIHRoZW0gdG9rZW5zIGJhc2VkCiAqIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAogKiBhcyB0aGV5IGFycml2ZS4KICogQGRldiBmcm9tIENyb3dkc2FsZSBieSBaZXBlbGxpbiB3aXRoIHNtYWxsIGNoYW5nZXMuIENoYW5nZXMgYXJlIGNvbW1lbnRlZCB3aXRoICJSZXF1ZXN0IE1vZGlmaWNhdGlvbiIKICovCmNvbnRyYWN0IFN0YW5kYXJkQ3Jvd2RzYWxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgICBTdGFuZGFyZFRva2VuIHB1YmxpYyB0b2tlbjsgLy8gUmVxdWVzdCBNb2RpZmljYXRpb24gOiBjaGFuZ2UgdG8gbm90IG1pbnRhYmxlCgogICAgLy8gc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzIHdoZXJlIGludmVzdG1lbnRzIGFyZSBhbGxvd2VkIChib3RoIGluY2x1c2l2ZSkKICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogICAgLy8gYWRkcmVzcyB3aGVyZSBmdW5kcyBhcmUgY29sbGVjdGVkCiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogICAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdHMgYSBidXllciBnZXRzIHBlciB3ZWkKICAgIHVpbnQyNTYgcHVibGljIHJhdGU7CgogICAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZDsKCiAgICAvKioKICAgICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAgICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAgICovCiAgICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCiAgICBmdW5jdGlvbiBTdGFuZGFyZENyb3dkc2FsZSgKICAgICAgICB1aW50MjU2IF9zdGFydFRpbWUsIAogICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsIAogICAgICAgIHVpbnQyNTYgX3JhdGUsIAogICAgICAgIGFkZHJlc3MgX3dhbGxldCkgCiAgICB7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICAgICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKF9yYXRlID4gMCk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CgogICAgICAgIHN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICAgICAgZW5kVGltZSA9IF9lbmRUaW1lOwogICAgICAgIHJhdGUgPSBfcmF0ZTsKICAgICAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgICAgIAogICAgICAgIHRva2VuID0gY3JlYXRlVG9rZW5Db250cmFjdCgpOyAvLyBSZXF1ZXN0IE1vZGlmaWNhdGlvbiA6IGNoYW5nZSB0byBTdGFuZGFyZFRva2VuICsgcG9zaXRpb24KICAgIH0KCiAgICAvLyBjcmVhdGVzIHRoZSB0b2tlbiB0byBiZSBzb2xkLgogICAgLy8gUmVxdWVzdCBNb2RpZmljYXRpb24gOiBjaGFuZ2UgdG8gU3RhbmRhcmRUb2tlbgogICAgLy8gb3ZlcnJpZGUgdGhpcyBtZXRob2QgdG8gaGF2ZSBjcm93ZHNhbGUgb2YgYSBzcGVjaWZpYyBtaW50YWJsZSB0b2tlbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZVRva2VuQ29udHJhY3QoKSAKICAgICAgICBpbnRlcm5hbCAKICAgICAgICByZXR1cm5zKFN0YW5kYXJkVG9rZW4pIAogICAgewogICAgICAgIHJldHVybiBuZXcgU3RhbmRhcmRUb2tlbigpOwogICAgfQoKICAgIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICAgIGZ1bmN0aW9uICgpIAogICAgICAgcGF5YWJsZSAKICAgIHsKICAgICAgICBidXlUb2tlbnMoKTsKICAgIH0KCiAgICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICAgIC8vIFJlcXVlc3QgTW9kaWZpY2F0aW9uIDogY2hhbmdlIHRvIG5vdCBtaW50IGJ1dCB0cmFuc2ZlciBmcm9tIHRoaXMgY29udHJhY3QKICAgIGZ1bmN0aW9uIGJ1eVRva2VucygpIAogICAgICAgcHVibGljIAogICAgICAgcGF5YWJsZSAKICAgIHsKICAgICAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CgogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgICAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgICAgICB1aW50MjU2IHRva2VucyA9IHdlaUFtb3VudC5tdWwocmF0ZSk7CiAgICAgICAgdG9rZW5zICs9IGdldEJvbnVzKHRva2Vucyk7CgogICAgICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKCiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCB0b2tlbnMpKTsgLy8gUmVxdWVzdCBNb2RpZmljYXRpb24gOiBjaGFuZ2VkIGhlcmUgLSB0cmFuZmVyIGluc3RlYWQgb2YgbWludGFibGUKICAgICAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIHdlaUFtb3VudCwgdG9rZW5zKTsKCiAgICAgICAgZm9yd2FyZEZ1bmRzKCk7CgogICAgICAgIHBvc3RCdXlUb2tlbnMoKTsKICAgIH0KCiAgICAvLyBBY3Rpb24gYWZ0ZXIgYnV5aW5nIHRva2VucwogICAgZnVuY3Rpb24gcG9zdEJ1eVRva2VucyAoKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICB9CgogICAgLy8gc2VuZCBldGhlciB0byB0aGUgZnVuZCBjb2xsZWN0aW9uIHdhbGxldAogICAgLy8gb3ZlcnJpZGUgdG8gY3JlYXRlIGN1c3RvbSBmdW5kIGZvcndhcmRpbmcgbWVjaGFuaXNtcwogICAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgCiAgICAgICBpbnRlcm5hbCAKICAgIHsKICAgICAgICB3YWxsZXQudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgCiAgICAgICAgaW50ZXJuYWwgCiAgICAgICAgcmV0dXJucyhib29sKSAKICAgIHsKICAgICAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICAgICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgICAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICAgIH0KCiAgICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogICAgZnVuY3Rpb24gaGFzRW5kZWQoKSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgY29uc3RhbnQgCiAgICAgICAgcmV0dXJucyhib29sKSAKICAgIHsKICAgICAgICByZXR1cm4gbm93ID4gZW5kVGltZTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QmVmb3JlU2FsZSgpIHsKICAgICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBSZXF1ZXN0IE1vZGlmaWNhdGlvbiA6IEFkZCBjaGVjayAyNGhvdXJzIGJlZm9yZSB0b2tlbiBzYWxlCiAgICBtb2RpZmllciBvbmx5MjRIQmVmb3JlU2FsZSgpIHsKICAgICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZS5zdWIoMSBkYXlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCb251cyh1aW50MjU2IF90b2tlbnMpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYm9udXMpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBDYXBwZWRDcm93ZHNhbGUKICogQGRldiBFeHRlbnNpb24gb2YgQ3Jvd2RzYWxlIHdpdGggYSBtYXggYW1vdW50IG9mIGZ1bmRzIHJhaXNlZAogKi8KY29udHJhY3QgQ2FwcGVkQ3Jvd2RzYWxlIGlzIFN0YW5kYXJkQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgdWludDI1NiBwdWJsaWMgY2FwOwoKICBmdW5jdGlvbiBDYXBwZWRDcm93ZHNhbGUodWludDI1NiBfY2FwKSB7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIGNhcCA9IF9jYXA7CiAgfQoKICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSN2YWxpZFB1cmNoYXNlIHRvIGFkZCBleHRyYSBjYXAgbG9naWMKICAvLyBAcmV0dXJuIHRydWUgaWYgaW52ZXN0b3JzIGNhbiBidXkgYXQgdGhlIG1vbWVudAogIC8vIFJlcXVlc3QgTW9kaWZpY2F0aW9uIDogZGVsZXRlIGNvbnN0YW50IGJlY2F1c2UgbmVlZGVkIGluIHNvbiBjb250cmFjdAogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpbkNhcCA9IHdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKSA8PSBjYXA7CiAgICByZXR1cm4gc3VwZXIudmFsaWRQdXJjaGFzZSgpICYmIHdpdGhpbkNhcDsKICB9CgogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI2hhc0VuZGVkIHRvIGFkZCBjYXAgbG9naWMKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgY2FwUmVhY2hlZCA9IHdlaVJhaXNlZCA+PSBjYXA7CiAgICByZXR1cm4gc3VwZXIuaGFzRW5kZWQoKSB8fCBjYXBSZWFjaGVkOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgTUlORFRva2VuUHJlU2FsZQogKiBAZGV2IAogKiBXZSBhZGQgbmV3IGZlYXR1cmVzIHRvIGEgYmFzZSBjcm93ZHNhbGUgdXNpbmcgbXVsdGlwbGUgaW5oZXJpdGFuY2UuCiAqIFdlIGFyZSB1c2luZyB0aGUgZm9sbG93aW5nIGV4dGVuc2lvbnM6CiAqIENhcHBlZENyb3dkc2FsZSAtIHNldHMgYSBtYXggYm91bmRhcnkgZm9yIHJhaXNlZCBmdW5kcwogKgogKiBUaGUgY29kZSBpcyBiYXNlZCBvbiB0aGUgY29udHJhY3RzIG9mIE9wZW4gWmVwcGVsaW4gYW5kIHdlIGFkZCBvdXIgY29udHJhY3RzIDogTUlORFRva2VuUHJlU2FsZSBhbmQgdGhlIFJlcXVlc3QgVG9rZW4KICoKICogQGF1dGhvciBSZXF1ZXN0Lm5ldHdvcmsKICovCmNvbnRyYWN0IE1JTkRUb2tlblByZVNhbGUgaXMgT3duYWJsZSwgQ2FwcGVkQ3Jvd2RzYWxlIHsKICAgIC8vIGhhcmQgY2FwIG9mIHRoZSB0b2tlbiBwcmUtc2FsZSBpbiBldGhlcgogICAgdWludCBwcml2YXRlIGNvbnN0YW50IEhBUkRfQ0FQX0lOX1dFSSA9IDEwMDAwIGV0aGVyOwoKICAgIC8vIFRvdGFsIG9mIE1JTkQgVG9rZW4gc3VwcGx5CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBUT1RBTF9NSU5EX1RPS0VOX1NVUFBMWSA9IDUwMDAwMDAwOwoKICAgIC8vIFRva2VuIHNhbGUgcmF0ZSBmcm9tIEVUSCB0byBNSU5ECiAgICB1aW50IHByaXZhdGUgY29uc3RhbnQgUkFURV9FVEhfTUlORCA9IDEwMDA7CgogICAgLy8gVG9rZW4gaW5pdGlhbHkgZGlzdHJpYnV0ZWQgZm9yIHRoZSB0ZWFtICgxNSUpCiAgICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBURUFNX1ZFU1RJTkdfV0FMTEVUID0gMHhiM0YzRDc3NEMzNTc1YUIwMWJjZTlkOWE5RmU5MkFhNDE5MjZhOTJlOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgVEVBTV9WRVNUSU5HX0FNT1VOVCA9IDc1MDAwMDBlMTg7CgogICAgLy8gVG9rZW4gaW5pdGlhbHkgZGlzdHJpYnV0ZWQgZm9yIHRoZSBmdWxsIHRva2VuIHNhbGUgKDIwJSkKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IEZVTExfVE9LRU5fV0FMTEVUID0gMHg4NzU5QTAzQjNCRUIxYWExQTdiQTc2NTc5MmNGODNDYUFlNGYyOEU5OwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRlVMTF9UT0tFTl9BTU9VTlQgPSAyMDAwMDAwMGUxODsKCiAgICAvLyBUb2tlbiBpbml0aWFseSBkaXN0cmlidXRlZCBmb3IgdGhlIGVhcmx5IGZvdW5kYXRpb24gKDE1JSkKICAgIC8vIHdhbGxldCB1c2UgYWxzbyB0byBnYXRoZXIgdGhlIGV0aGVyIG9mIHRoZSB0b2tlbiBzYWxlCiAgICBhZGRyZXNzIHByaXZhdGUgY29uc3RhbnQgTUlORF9GT1VOREFUSU9OX1dBTExFVCA9IDB4RGZENWUwOWJCODQ1ZDM5YmQwNWJlNDY2NDI3MWU0NzFGQThkQTRFNjsKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1JTkRfRk9VTkRBVElPTl9BTU9VTlQgPSA3NTAwMDAwZTE4OwoKICAgIC8vIFBFUklPRCBXSEVOIFRPS0VOIElTIE5PVCBUUkFOU0ZFUkFCTEUgQUZURVIgVEhFIFNBTEUKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFBFUklPRF9BRlRFUlNBTEVfTk9UX1RSQU5TRkVSQUJMRV9JTl9TRUMgPSAzIGRheXM7CgogICAgZXZlbnQgUHJlU2FsZVRva2VuU29sZG91dCgpOwoKICAgIGZ1bmN0aW9uIE1JTkRUb2tlblByZVNhbGUodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lKQogICAgICBDYXBwZWRDcm93ZHNhbGUoSEFSRF9DQVBfSU5fV0VJKQogICAgICBTdGFuZGFyZENyb3dkc2FsZShfc3RhcnRUaW1lLCBfZW5kVGltZSwgUkFURV9FVEhfTUlORCwgTUlORF9GT1VOREFUSU9OX1dBTExFVCkKICAgIHsKICAgICAgICAKICAgICAgICB0b2tlbi50cmFuc2ZlcihURUFNX1ZFU1RJTkdfV0FMTEVULCBURUFNX1ZFU1RJTkdfQU1PVU5UKTsKCiAgICAgICAgdG9rZW4udHJhbnNmZXIoRlVMTF9UT0tFTl9XQUxMRVQsIEZVTExfVE9LRU5fQU1PVU5UKTsKCiAgICAgICAgdG9rZW4udHJhbnNmZXIoTUlORF9GT1VOREFUSU9OX1dBTExFVCwgTUlORF9GT1VOREFUSU9OX0FNT1VOVCk7CiAgICAgICAgCiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENyZWF0ZSB0aGUgTUlORCB0b2tlbiAob3ZlcnJpZGUgY3JlYXRlVG9rZW5Db250cmFjdCBvZiBTdGFuZGFyZENyb3dkc2FsZSkKICAgICAqIEByZXR1cm4gdGhlIFN0YW5kYXJkVG9rZW4gY3JlYXRlZAogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbkNvbnRyYWN0ICgpIAogICAgICBpbnRlcm5hbCAKICAgICAgcmV0dXJucyhTdGFuZGFyZFRva2VuKSAKICAgIHsKICAgICAgICByZXR1cm4gbmV3IE1JTkRUb2tlbihUT1RBTF9NSU5EX1RPS0VOX1NVUFBMWSwgZW5kVGltZS5hZGQoUEVSSU9EX0FGVEVSU0FMRV9OT1RfVFJBTlNGRVJBQkxFX0lOX1NFQyksIE1JTkRfRk9VTkRBVElPTl9XQUxMRVQsIEZVTExfVE9LRU5fV0FMTEVUKTsKICAgIH0KCiAgICAvKioKICAgICAgKiBAZGV2IEdldCB0aGUgYm9udXMgYmFzZWQgb24gdGhlIGJ1eSB0aW1lIChvdmVycmlkZSBnZXRCb251cyBvZiBTdGFuZGFyZENyb3dkc2FsZSkKICAgICAgKiBAcmV0dXJuIHRoZSBudW1iZXIgb2YgYm9udXMgdG9rZW4KICAgICovCiAgICBmdW5jdGlvbiBnZXRCb251cyh1aW50MjU2IF90b2tlbnMpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYm9udXMpIHsKICAgICAgICByZXF1aXJlKF90b2tlbnMgIT0gMCk7CiAgICAgICAgaWYgKHN0YXJ0VGltZSA8PSBub3cgJiYgbm93IDwgc3RhcnRUaW1lICsgMSBkYXlzKSB7CiAgICAgICAgICAgIHJldHVybiBfdG9rZW5zLmRpdigyKTsKICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0VGltZSArIDEgZGF5cyA8PSBub3cgJiYgbm93IDwgc3RhcnRUaW1lICsgMiBkYXlzICkgewogICAgICAgICAgICByZXR1cm4gX3Rva2Vucy5kaXYoNCk7CiAgICAgICAgfSBlbHNlIGlmIChzdGFydFRpbWUgKyAyIGRheXMgPD0gbm93ICYmIG5vdyA8IHN0YXJ0VGltZSArIDMgZGF5cyApIHsKICAgICAgICAgICAgcmV0dXJuIF90b2tlbnMuZGl2KDEwKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlciB0aGUgdW5zb2xkIHRva2VucyB0byB0aGUgTUlORCBGb3VuZGF0aW9uIG11bHRpc2lnbiB3YWxsZXQgCiAgICAgKiBAZGV2IE9ubHkgZm9yIG93bmVyCiAgICAgKiBAcmV0dXJuIHRoZSBTdGFuZGFyZFRva2VuIGNyZWF0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gZHJhaW5SZW1haW5pbmdUb2tlbiAoKSAKICAgICAgcHVibGljCiAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUoaGFzRW5kZWQoKSk7CiAgICAgICAgdG9rZW4udHJhbnNmZXIoTUlORF9GT1VOREFUSU9OX1dBTExFVCwgdG9rZW4uYmFsYW5jZU9mKHRoaXMpKTsKICAgIH0KCgogICAgLyoqCiAgICAgICogQGRldiBBY3Rpb24gYWZ0ZXIgYnV5aW5nIHRva2VuczogY2hlY2sgaWYgYWxsIHNvbGQgb3V0IGFuZCBlbmFibGUgdHJhbnNmZXIgaW1tZWRpYXRlbHkKICAgICAgKi8KICAgIGZ1bmN0aW9uIHBvc3RCdXlUb2tlbnMgKCkKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIGlmICggd2VpUmFpc2VkID49IEhBUkRfQ0FQX0lOX1dFSSApIAogICAgICAgIHsKICAgICAgICAgICAgTUlORFRva2VuIG1pbmRUb2tlbiA9IE1JTkRUb2tlbiAodG9rZW4pOwogICAgICAgICAgICBtaW5kVG9rZW4uZW5hYmxlVHJhbnNmZXJFYXJsaWVyKCk7CiAgICAgICAgICAgIFByZVNhbGVUb2tlblNvbGRvdXQoKTsKICAgICAgICB9CiAgICB9Cn0='.
	

]
