Class {
	#name : #SRT9b97195085d2b54c8c892c5c69d5f9045ea674de,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9b97195085d2b54c8c892c5c69d5f9045ea674de >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjE7CgovLyBFdGhlclZlZ2FzIFYzIAovLyBVcGRhdGVzOiB0aW1lIGlzIG5vdyBhIGhhcmQgcmVzZXQgYW5kIGlzIGJhc2VkIG9uIHRoZSBwcmljZSB5b3UgYnV5IHdpdGggbWluaW11bSAKLy8gTmFtZSBmZWF0dXJlIGludHJvZHVjZWQgcGx1cyBxdW90ZXMgW2FkZGVkIHRvIFVJIHNvb25dCi8vIFBva2VyIGZlYXR1cmUgYWRkZWQsIHBheXMgYWJvdXQgfjQvMjUgb2YgZW50aXJlIGNvbGxlY3RlZCBwb3QgY3VycmVudGx5IAovLyBjYW4gYmUgY2xhaW1lZCBtdWx0aXBsZSB0aW1lcyAoYnkgb3RoZXIgdXNlcnMpLiBMYXN0IHBva2VyIHdpbm5lciBnZXRzIAovLyByZW1haW5pbmcgcG90IHdoZW4gY29tcGxldGUgamFja3BvdCBpcyBwYWlkIG91dCAKCi8vIEhPU1Q6IGV0aGxhc3ZlZ2FzLnN1cmdlLnNoIAovLyBNYWRlIGJ5IEV0aGVyR3V5IAovLyBRdWVzdGlvbnMgb3Igc3VnZ2VzdGlvbnM/IDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIzNjUzNDI1ZTUzNDQ1MTQzNGY3NjViNTc1ZjVhMTg1NTU5NWIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+IAoKY29udHJhY3QgUk5HewogICAgIHVpbnQyNTYgc2VjcmV0ID0gMDsKICAgICAKICAgIC8vIFRoYW5rcyB0byBUZWNobmljYWxSaXNlCiAgICAvLyBCYW4gY29udHJhY3RzCiAgICBtb2RpZmllciBOb0NvbnRyYWN0KCl7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGFkZHJlc3MgYWRkciA9IG1zZy5zZW5kZXI7CiAgICAgICAgYXNzZW1ibHkgeyBzaXplIDo9IGV4dGNvZGVzaXplKGFkZHIpIH0KICAgICAgICByZXF1aXJlKHNpemUgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gUk5HKCkgcHVibGljIE5vQ29udHJhY3R7CiAgICAgICAgc2VjcmV0ID0gdWludDI1NihrZWNjYWsyNTYoYmxvY2suY29pbmJhc2UpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2dpdmVSTkcodWludDI1NiBtb2R1bG8sIHVpbnQyNTYgc2VjcikgcHJpdmF0ZSB2aWV3IHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYpewogICAgICAgIHVpbnQyNTYgc2VlZDEgPSB1aW50MjU2KGJsb2NrLmNvaW5iYXNlKTsKICAgICAgICB1aW50MjU2IHNlZWQzID0gc2VjcjsgCiAgICAgICAgdWludDI1NiBuZXdzZWNyID0gKHVpbnQyNTYoa2VjY2FrMjU2KHNlZWQxLHNlZWQzKSkpOwogICAgICAgIHJldHVybiAobmV3c2VjciAlIG1vZHVsbywgbmV3c2Vjcik7CiAgICB9CiAgICAKCiAgICBmdW5jdGlvbiBHaXZlUk5HKHVpbnQyNTYgbWF4KSBpbnRlcm5hbCBOb0NvbnRyYWN0IHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIHVpbnQyNTYgbnVtOwogICAgICAgIHVpbnQyNTYgbmV3c2VjcmV0ID0gc2VjcmV0OwoKICAgICAgICAobnVtLG5ld3NlY3JldCkgPSBfZ2l2ZVJORyhtYXgsIG5ld3NlY3JldCk7CiAgICAgICAgc2VjcmV0PW5ld3NlY3JldDsKICAgICAgICByZXR1cm4gbnVtOyAKICAgIH0KICAgIAoKfQoKY29udHJhY3QgUG9rZXIgaXMgUk5HewogICAgLy8gd2FybmluZzsgbnVtYmVyIDAgaXMgYSBub24tZXhpc3RpbmcgY2FyZDsgbWVhbnMgZW1wdHk7CiAgICAKCgogICAgdWludDhbNV0gcHVibGljIEhvdXNlQ2FyZHM7CiAgICAKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50OFsyXSkgcHVibGljIFBsYXllckNhcmRzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBQbGF5ZXJSb3VuZDsKICAgIAogICAgdWludDI1NiBwdWJsaWMgUm91bmROdW1iZXI7CiAgICAKICAgIHVpbnQ4WzZdIHB1YmxpYyBXaW5uaW5nSGFuZDsgLy8gdHJhY2tzIHdpbm5pbmcgaGFuZC4gSUQgMSBkZWZpbmVzIHdpbm5pbmcgbGV2ZWwgKDk9c3RyYWlnaHQgZmx1c2gsIDg9NCBvZiBhIGtpbmQsIGV0YykgYW5kIG90aGVyIG51bWJlcnMgCiAgICBhZGRyZXNzICBwdWJsaWMgUG9rZXJXaW5uZXI7CiAgICAKICAgIHVpbnQ4WzJdIHB1YmxpYyBXaW5uaW5nQ2FyZHM7CiAgICAvLyBkZWZpbmUgdGhlIG90aGVyIGNhcmRzIHdoaWNoIG1pZ2h0IHBsYXkgaW4gZGVmaW5pbmcgdGhlIHdpbm5lci4gCgogICAgZnVuY3Rpb24gR2V0Q2FyZE51bWJlcih1aW50OCByYW5rLCB1aW50OCBzdWl0KSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCl7CiAgICAgICAgaWYgKHJhbms9PTApewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuICgocmFuay0xKSo0KzEpK3N1aXQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEdldFBsYXllclJvdW5kKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICByZXR1cm4gUGxheWVyUm91bmRbd2hvXTsKICAgIH0KICAgIAogICAgCiAgICAKICAgIGZ1bmN0aW9uIEdldENhcmRJbmZvKHVpbnQ4IG4pIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQ4IHJhbmssIHVpbnQ4IHN1aXQpewogICAgICAgIGlmIChuPT0wKXsKICAgICAgICAgICAgcmV0dXJuICgwLDApOwogICAgICAgIH0KICAgICAgICBzdWl0ID0gKG4tMSklNDsKICAgICAgICByYW5rID0gKG4tMSkvNCsxOwogICAgfQogICAgCiAgIC8vIGV2ZW50IHB1c2hpZm8odWludDgsIHVpbnQ4LCB1aW50OCx1aW50OCx1aW50OCk7CiAgICAvLyByZXNldHMgZ2FtZSAKICAgIGZ1bmN0aW9uIERyYXdIb3VzZSgpIGludGVybmFsIHsKICAgICAgICAvLyBEcmF3IHRhYmxlIGNhcmRzIAogICAgICAgIHVpbnQ4IGk7CiAgICAgICAgdWludDggcmFuazsKICAgICAgICB1aW50OCBzdWl0OwogICAgICAgIHVpbnQ4IG47CiAgICAgICAgZm9yIChpPTA7IGk8NTsgaSsrKXsKICAgICAgICAgICAgcmFuayA9IHVpbnQ4KEdpdmVSTkcoMTMpKzEpOwogICAgICAgICAgICBzdWl0ID0gdWludDgoR2l2ZVJORyg0KSk7CiAgICAgICAgICAgIG4gPSBHZXRDYXJkTnVtYmVyKHJhbmssc3VpdCk7CiAgICAgICAgICAgIEhvdXNlQ2FyZHNbaV09bjsKICAgICAgICB9CgogICAgICAgIHVpbnQ4WzJdIHN0b3JhZ2UgdGFyZ2V0ID0gUGxheWVyQ2FyZHNbYWRkcmVzcyh0aGlzKV07CiAgICAgICAgZm9yIChpPTA7IGk8MjsgaSsrKXsKICAgICAgICAgICAgcmFuayA9IHVpbnQ4KEdpdmVSTkcoMTMpKzEpOwogICAgICAgICAgICBzdWl0ID0gdWludDgoR2l2ZVJORyg0KSk7CiAgICAgICAgICAgIG4gPSBHZXRDYXJkTnVtYmVyKHJhbmssc3VpdCk7CgogICAgICAgICAgICB0YXJnZXRbaV09bjsKCiAgICAgICAgfQogICAgICAgIAogICAgICAgIFdpbm5pbmdIYW5kID0gUmFua1Njb3JlKGFkZHJlc3ModGhpcykpOwogICAgICAgIFdpbm5pbmdDYXJkcz1bdGFyZ2V0WzBdLHRhcmdldFsxXV07CiAgICAgICAgUG9rZXJXaW5uZXI9IGFkZHJlc3ModGhpcyk7CiAgICB9CiAgICAKICAgIGV2ZW50IERyYXduQ2FyZHMoYWRkcmVzcyBwbGF5ZXIsIHVpbnQ4IGNhcmQxLCB1aW50OCBjYXJkMik7CiAgICBmdW5jdGlvbiBEcmF3QWRkcigpIGludGVybmFsIHsKICAgICAgICB1aW50OCB0Y2FyZDE7CiAgICAgICAgdWludDggdGNhcmQyOwogICAgICAgIGZvciAodWludDggaT0wOyBpPDI7IGkrKyl7CiAgICAgICAgICAgIHVpbnQ4IHJhbmsgPSB1aW50OChHaXZlUk5HKDEzKSsxKTsKICAgICAgICAgICAgdWludDggc3VpdCA9IHVpbnQ4KEdpdmVSTkcoNCkpOwogICAgICAgICAgICB1aW50OCBuID0gR2V0Q2FyZE51bWJlcihyYW5rLHN1aXQpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGk9PTApewogICAgICAgICAgICAgICAgdGNhcmQxPW47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIHRjYXJkMj1uOwogICAgICAgICAgICB9CgogICAgICAgICAgICBQbGF5ZXJDYXJkc1ttc2cuc2VuZGVyXVtpXT1uOwoKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKFBsYXllclJvdW5kW21zZy5zZW5kZXJdICE9IFJvdW5kTnVtYmVyKXsKICAgICAgICAgICAgUGxheWVyUm91bmRbbXNnLnNlbmRlcl0gPSBSb3VuZE51bWJlcjsKICAgICAgICB9CiAgICAgICAgZW1pdCBEcmF3bkNhcmRzKG1zZy5zZW5kZXIsdGNhcmQxLCB0Y2FyZDIpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBHZXRQbGF5ZXJDYXJkcyhhZGRyZXNzIHdobykgcHVibGljIHZpZXcgTm9Db250cmFjdCByZXR1cm5zICh1aW50OCwgdWludDgpewogICAgICAgIHVpbnQ4WzJdIG1lbW9yeSB0YXJnZXQgPSBQbGF5ZXJDYXJkc1t3aG9dOwogICAgICAgIAogICAgICAgIHJldHVybiAodGFyZ2V0WzBdLCB0YXJnZXRbMV0pOwogICAgfQoKICAgIGZ1bmN0aW9uIEdldFdpbkNhcmRzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgsIHVpbnQ4KXsKICAgICAgICByZXR1cm4gKFdpbm5pbmdDYXJkc1swXSwgV2lubmluZ0NhcmRzWzFdKTsKICAgIH0KICAgIAogICAgCiAgICAKICAgIC8vIHdlbHAgdGhpcyBpcyBoYW5keSAKICAgIHN0cnVjdCBDYXJkewogICAgICAgIHVpbnQ4IHJhbms7CiAgICAgICAgdWludDggc3VpdDsKICAgIH0KICAgIAogICAgLy8gd2ViIAogIC8vICBmdW5jdGlvbiBIYW5kV2luc1ZpZXcoYWRkcmVzcyBjaGVja2hhbmQpIHZpZXcgcmV0dXJucyAodWludDgpewogICAgLy8gICAgcmV0dXJuIEhhbmRXaW5zKGNoZWNraGFuZCk7CiAgICAvL30KICAgIAogICAgCiAgICBmdW5jdGlvbiBIYW5kV2lucyhhZGRyZXNzIGNoZWNraGFuZCkgaW50ZXJuYWwgcmV0dXJucyAodWludDgpewogICAgICAgIHVpbnQ4IHJlc3VsdCA9IEhhbmRXaW5zVmlldyhjaGVja2hhbmQpOwogICAgICAgIAogICAgICAgIHVpbnQ4WzZdIG1lbW9yeSBDdXJyU2NvcmUgPSBSYW5rU2NvcmUoY2hlY2toYW5kKTsKICAgICAgICAgICAgCiAgICAgICAgdWludDhbMl0gbWVtb3J5IHRhcmdldCA9IFBsYXllckNhcmRzW2NoZWNraGFuZF07CiAgICAgICAgCiAgICAgICAgaWYgKHJlc3VsdCA9PSAxKXsKICAgICAgICAgICAgV2lubmluZ0hhbmQgPSBDdXJyU2NvcmU7CiAgICAgICAgICAgIFdpbm5pbmdDYXJkcz0gW3RhcmdldFswXSx0YXJnZXRbMV1dOwogICAgICAgICAgICBQb2tlcldpbm5lcj1tc2cuc2VuZGVyOwogICAgICAgICAgICAvLyBjbGVhciBjYXJkcyAKICAgICAgICAgICAgLy9QbGF5ZXJDYXJkc1tjaGVja2hhbmRdWzBdPTA7CiAgICAgICAgICAgIC8vUGxheWVyQ2FyZHNbY2hlY2toYW5kXVsxXT0wOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAvLyByZXR1cm5zIDAgaWYgbG9zZSwgMSBpZiB3aW4sIDIgaWYgZXF1YWwgCiAgICAvLyBpZiB3aW5uZXIgZm91bmQgaW1tZWRpYXRlbHkgc2V0cyB3aW5uZXIgdmFsdWVzIAogICAgZnVuY3Rpb24gSGFuZFdpbnNWaWV3KGFkZHJlc3MgY2hlY2toYW5kKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCl7IAogICAgICAgIGlmIChQbGF5ZXJSb3VuZFtjaGVja2hhbmRdICE9IFJvdW5kTnVtYmVyKXsKICAgICAgICAgICAgcmV0dXJuIDA7IC8vIGVtcHR5IGNhcmRzIGluIG5ldyByb3VuZC4gCiAgICAgICAgfQogICAgICAgIHVpbnQ4WzZdIG1lbW9yeSBDdXJyZW50V2luSGFuZCA9IFdpbm5pbmdIYW5kOwogICAgICAgIAogICAgICAgIHVpbnQ4WzZdIG1lbW9yeSBDdXJyU2NvcmUgPSBSYW5rU2NvcmUoY2hlY2toYW5kKTsKICAgICAgICAKICAgICAgICAKICAgICAgICB1aW50OCByZXQgPSAyOwogICAgICAgIGlmIChDdXJyU2NvcmVbMF0gPiBDdXJyZW50V2luSGFuZFswXSl7CiAKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKEN1cnJTY29yZVswXSA9PSBDdXJyZW50V2luSGFuZFswXSl7CiAgICAgICAgICAgIGZvciAodWludCBpPTE7IGk8PTU7IGkrKyl7CiAgICAgICAgICAgICAgICBpZiAoQ3VyclNjb3JlW2ldID49IEN1cnJlbnRXaW5IYW5kW2ldKXsKICAgICAgICAgICAgICAgICAgICBpZiAoQ3VyclNjb3JlW2ldID4gQ3VycmVudFdpbkhhbmRbaV0pewoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICByZXQ9MDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICByZXQ9MDsKICAgICAgICB9CiAgICAgICAgLy8gMiBpcyBzYW1lIGhhbmQuIGNvbW1lbnRlZCBvdXQgaW4gcGF5IG1vZGUgCiAgICAgICAgLy8gb25seSB3aW5uZXIgZ2V0cyBwb3QuIAogICAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgICAKICAgIAoKICAgIGZ1bmN0aW9uIFJhbmtTY29yZShhZGRyZXNzIGNoZWNraGFuZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50OFs2XSBvdXRwdXQpewogICAgICAKICAgICAgICB1aW50OFs0XSBtZW1vcnkgRmx1c2hUcmFja2VyOwogICAgICAgIHVpbnQ4WzE0XSBtZW1vcnkgQ2FyZFRyYWNrZXI7CiAgICAgICAgCiAgICAgICAgdWludDggcmFuazsKICAgICAgICB1aW50OCBzdWl0OwogICAgICAgIAogICAgICAgIENhcmRbN10gbWVtb3J5IENhcmRzOwogICAgICAgIAogICAgICAgIGZvciAodWludDggaT0wOyBpPDc7IGkrKyl7CiAgICAgICAgICAgIGlmIChpPj01KXsKICAgICAgICAgICAgICAgIChyYW5rLHN1aXQpID0gR2V0Q2FyZEluZm8oUGxheWVyQ2FyZHNbY2hlY2toYW5kXVtpLTVdKTsKICAgICAgICAgICAgICAgIEZsdXNoVHJhY2tlcltzdWl0XSsrOwogICAgICAgICAgICAgICAgQ2FyZFRyYWNrZXJbcmFua10rKzsKICAgICAgICAgICAgICAgIENhcmRzW2ldID0gQ2FyZChyYW5rLHN1aXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAocmFuayxzdWl0KSA9IEdldENhcmRJbmZvKEhvdXNlQ2FyZHNbaV0pOwogICAgICAgICAgICAgICAgRmx1c2hUcmFja2VyW3N1aXRdKys7CiAgICAgICAgICAgICAgICBDYXJkVHJhY2tlcltyYW5rXSsrOwogICAgICAgICAgICAgICAgQ2FyZHNbaV0gPSBDYXJkKHJhbmssc3VpdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDggc3RyYWlnaHQgPSAwOwogICAgICAgIC8vIHNraXAgYWxsIHplcm8ncwogICAgICAgIHVpbnQ4WzNdIG1lbW9yeSBzdHJhaWdodF9zdGFydGNhcmQ7CiAgICAgICAgZm9yICh1aW50OCBzdGFydGNhcmQ9MTM7IGk+PTU7IGktLSl7CiAgICAgICAgICAgIGlmIChDYXJkVHJhY2tlcltzdGFydGNhcmRdID49IDEpewogICAgICAgICAgICAgICAgZm9yICh1aW50OCBjdXJyY2FyZD1zdGFydGNhcmQtMTsgY3VycmNhcmQ+PShzdGFydGNhcmQtNCk7IGN1cnJjYXJkLS0pewogICAgICAgICAgICAgICAgICAgIGlmIChDYXJkVHJhY2tlcltjdXJyY2FyZF0gPj0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyY2FyZCA9PSAoc3RhcnRjYXJkLTQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGF0IGVuZCwgc3RyYWlnaHQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJhaWdodF9zdGFydGNhcmRbc3RyYWlnaHRdID0gc3RhcnRjYXJkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyYWlnaHQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDggZmx1c2g9MDsKCiAgICAgICAgZm9yIChpPTA7aTw9MztpKyspewogICAgICAgICAgICBpZiAoRmx1c2hUcmFja2VyW2ldPj01KXsKICAgICAgICAgICAgICAgIGZsdXNoPWk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBkb25lIGluaXQuIAogICAgICAgIAogICAgICAgIC8vIHN0cmFpZ2h0IGZsdXNoPyAKICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICBpZiAoZmx1c2g+MCAmJiBzdHJhaWdodD4wKXsKICAgICAgICAgICAgLy8gc29tZW9uZSBoYXMgc3RyYWlnaHQgZmx1c2g/IAogICAgICAgICAgICAvLyBsZXZlbCBzY29yZSA5IAogICAgICAgICAgICBvdXRwdXRbMF0gPSA5OwogICAgICAgICAgICBjdXJyY2FyZD0wOwogICAgICAgICAgICBmb3IgKGk9MDsgaTwzOyBpKyspewogICAgICAgICAgICAgICAgc3RhcnRjYXJkPXN0cmFpZ2h0X3N0YXJ0Y2FyZFtpXTsKICAgICAgICAgICAgICAgIGN1cnJjYXJkPTU7IC8vIHRyYWNrIGZsdXNoLCBudW0gNSBpcyBzdGFuZGFyZC4gICAgCiAgICAgICAgICAgICAgICBmb3IgKHJhbms9MDsgaTw3OyBpKyspewogICAgICAgICAgICAgICAgICAgIGlmIChDYXJkc1tpXS5zdWl0ID09IGZsdXNoICYmIENhcmRzW2ldLnJhbmsgPD0gc3RhcnRjYXJkICYmIENhcmRzW2ldLnJhbms+PShzdGFydGNhcmQtNCkpewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyY2FyZC0tOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmNhcmQ9PTApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY3VycmNhcmQ9PTApewogICAgICAgICAgICAgICAgICAgIC8vIGZvdW5kIHN0cmFpZ2h0IGZsdXNoIGhpZ2guIAogICAgICAgICAgICAgICAgICAgIG91dHB1dFsxXSA9IHN0cmFpZ2h0X3N0YXJ0Y2FyZFtpXTsgLy8gc2F2ZSB0aGUgaGlnaCBjYXJkIAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gb3V0cHV0OyAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gaGlnaCBjYXJkIAogICAgICAgIAogICAgICAgIC8vcmV1c2UgdGhlIHJhbmsgdmFyaWFibGUgdG8gc3VtIGNhcmRzOyAKICAgICAgICByYW5rPTA7CiAgICAgICAgZm9yIChpPTEzO2k+PTE7aS0tKXsKICAgICAgICAgICAgcmFuayA9IHJhbmsgKyBDYXJkVHJhY2tlcltpXTsKICAgICAgICAgICAgaWYgKENhcmRUcmFja2VyW2ldID49IDQpewogICAgICAgICAgICAgICAgb3V0cHV0WzBdID0gODsgLy8gaGlnaCBjYXJkIAogICAgICAgICAgICAgICAgb3V0cHV0WzFdID0gaTsgLy8gdGhlIHR5cGUgb2YgY2FyZCAKICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJhbmsgPj00KXsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGZ1bGwgaG91c2UgCiAgICAgICAgCiAgICAgICAgcmFuaz0wOyAvLyB0cmFjayAzLWtpbmQgCiAgICAgICAgc3VpdD0wOyAvLyB0cmFjayAyLWtpbmQgCiAgICAgICAgc3RhcnRjYXJkPTA7CiAgICAgICAgY3VycmNhcmQ9MDsKICAgICAgICAKICAgICAgICBmb3IgKGk9MTM7aT49MTtpLS0pewogICAgICAgICAgICBpZiAocmFuayA9PSAwICYmIENhcmRUcmFja2VyW2ldID49IDMpewogICAgICAgICAgICAgICAgcmFuayA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZihDYXJkVHJhY2tlcltpXSA+PSAyKXsKICAgICAgICAgICAgICAgIGlmIChzdWl0ID09IDApewogICAgICAgICAgICAgICAgICAgIHN1aXQgPSBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICAvLyBkb3VibGUgbmljZSAKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnRjYXJkPT0wKXsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRjYXJkPWk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyYW5rICE9IDAgJiYgc3VpdCAhPSAwKXsKICAgICAgICAgICAgb3V0cHV0WzBdID0gNzsKICAgICAgICAgICAgb3V0cHV0WzFdID0gcmFuazsgLy8gZnVsbCBob3VzZSB0cmlwcGxlIGhpZ2ggCiAgICAgICAgICAgIG91dHB1dFsyXSA9IHN1aXQ7IC8vIGZ1bGwgaG91c2UgdHJpcHBsZSBsb3cgCiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChmbHVzaD4wKXsKICAgICAgICAgICAgLy8gZmx1c2ggCiAgICAgICAgICAgIG91dHB1dFswXSA9IDY7CiAgICAgICAgICAgIG91dHB1dFsxXSA9IGZsdXNoOwogICAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHN0cmFpZ2h0PjApewogICAgICAgICAgICAvL3N0cmFpZ2h0IAogICAgICAgICAgICBvdXRwdXRbMF0gPSA1OwogICAgICAgICAgICBvdXRwdXRbMV0gPSBzdHJhaWdodF9zdGFydGNhcmRbMF07CiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyYW5rPjApewogICAgICAgICAgICAvLyB0cmlwcGxlIAogICAgICAgICAgICBvdXRwdXRbMF09NDsKICAgICAgICAgICAgb3V0cHV0WzFdPXJhbms7CiAgICAgICAgICAgIGN1cnJjYXJkPTI7IC8vIHRyYWNrIGluZGV4OyAKICAgICAgICAgICAgLy8gZ2V0IDIgaGlnaGVzdCBjYXJkcyAKICAgICAgICAgICAgZm9yIChpPTEzO2k+PTE7aS0tKXsKICAgICAgICAgICAgICAgIGlmIChpICE9IHJhbmspewogICAgICAgICAgICAgICAgICAgIGlmIChDYXJkVHJhY2tlcltpXSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAvLyBub3RlIGF0IHRocmVlIG9mIGEga2luZCB3ZSBoYXZlIG5vIG90aGVyIGRvdWJsZXM7IGFsbCBvdGhlciByYW5rcyBhcmUgZGlmZmVyZW50IHNvIG5vIGNoZWNrID4gMSAKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W2N1cnJjYXJkXSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJjYXJkKys7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGN1cnJjYXJkPT00KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHN1aXQgPiAwICYmIHN0YXJ0Y2FyZCA+IDApewogICAgICAgICAgICAvLyBkb3VibGUgcGFpciAKICAgICAgICAgICAgb3V0cHV0WzBdID0gMzsKICAgICAgICAgICAgb3V0cHV0WzFdID0gc3VpdDsKICAgICAgICAgICAgb3V0cHV0WzJdID0gc3RhcnRjYXJkOwogICAgICAgICAgICAvLyBnZXQgaGlnaGVzdCBjYXJkIAogICAgICAgICAgICBmb3IgKGk9MTM7aT49MTtpLS0pewogICAgICAgICAgICAgICAgaWYgKGkhPXN1aXQgJiYgaSE9c3RhcnRjYXJkICYmIENhcmRUcmFja2VyW2ldPjApewogICAgICAgICAgICAgICAgICAgIG91dHB1dFszXT1pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHN1aXQgPiAwKXsKICAgICAgICAgICAgLy8gcGFpciAKICAgICAgICAgICAgb3V0cHV0WzBdPTI7CiAgICAgICAgICAgIG91dHB1dFsxXT1zdWl0OwogICAgICAgICAgICBjdXJyY2FyZD0yOwogICAgICAgICAgICAvLyBmaWxsIDMgb3RoZXIgcG9zaXRpb25zIHdpdGggaGlnaCBjYXJkcy4gCiAgICAgICAgICAgIGZvciAoaT0xMztpPj0xO2ktLSl7CiAgICAgICAgICAgICAgICBpZiAoaSE9c3VpdCAmJiBDYXJkVHJhY2tlcltpXT4wKXsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbY3VycmNhcmRdPWk7CiAgICAgICAgICAgICAgICAgICAgY3VycmNhcmQrKzsKICAgICAgICAgICAgICAgICAgICBpZihjdXJyY2FyZD09NSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIHdlbHAgeW91IGFyZSBoZXJlIG5vdywgb25seSBoYXZlIGhpZ2ggY2FyZD8KICAgICAgICAvLyBib3JpbmcgCiAgICAgICAgb3V0cHV0WzBdPTE7CiAgICAgICAgY3VycmNhcmQ9MTsKICAgICAgICBmb3IgKGk9MTM7aT49MTtpLS0pewogICAgICAgICAgICBpZiAoQ2FyZFRyYWNrZXJbaV0+MCl7CiAgICAgICAgICAgICAgICBvdXRwdXRbY3VycmNhcmRdPWk7CiAgICAgICAgICAgICAgICBjdXJyY2FyZCsrOwogICAgICAgICAgICAgICAgaWYgKGN1cnJjYXJkPT02KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCn0KCmNvbnRyYWN0IFZlZ2FzIGlzIFBva2VyewogICAgYWRkcmVzcyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIGZlZXNlbmQ7CiAgICAKICAgIAogICAgdWludDI1NiBwdWJsaWMgVGltZXI7CiAgICAKICAgIHVpbnQ4IGNvbnN0YW50IE1BWFBSSUNFUE9XRVIgPSA0MDsgLy8gPCAyNTUKICAgIAogICAgYWRkcmVzcyBwdWJsaWMgSmFja3BvdFdpbm5lcjsKICAgIAogICAgdWludDE2IHB1YmxpYyBKYWNrcG90UGF5b3V0ID0gODAwMDsgCiAgICB1aW50MTYgcHVibGljIFBva2VyUGF5b3V0ID0gMjAwMDsKICAgIHVpbnQxNiBwdWJsaWMgUHJldmlvdXNQYXlvdXQgPSA2NTAwOwogICAgdWludDE2IHB1YmxpYyBJbmNyZWFzZSA9IDk3MDA7CiAgICB1aW50MTYgcHVibGljIFRheCA9IDUwMDsKICAgIHVpbnQxNiBwdWJsaWMgUG90UGF5b3V0ID0gODAwMDsKICAgIAogICAgdWludDI1NiBwdWJsaWMgQmFzZVByaWNlID0gKDAuMDA1IGV0aGVyKTsKICAgIAogICAgdWludDI1NiBwdWJsaWMgVG90YWxQb3Q7CiAgICB1aW50MjU2IHB1YmxpYyBQb2tlclBheW91dFZhbHVlOwogICAgCiAgICAvLyBtYWlubmV0IAogICAgdWludDI1Nls5XSBUaW1lQXJyYXkgPSBbdWludDI1Nig2IGhvdXJzKSwgdWludDI1NigzIGhvdXJzKSwgdWludDI1NigyIGhvdXJzKSwgdWludDI1NigxIGhvdXJzKSwgdWludDI1Nig1MCBtaW51dGVzKSwgdWludDI1Nig0MCBtaW51dGVzKSwgdWludDI1NigzMCBtaW51dGVzKSwgdWludDI1NigyMCBtaW51dGVzKSwgdWludDI1NigxNSBtaW51dGVzKV07CiAgICAvLyB0ZXN0bmV0IAogICAgLy91aW50MjU2WzNdIFRpbWVBcnJheSA9IFt1aW50MjU2KDMgbWludXRlcyksIHVpbnQyNTYoMyBtaW51dGVzKSwgdWludDI1NigyIG1pbnV0ZXMpXTsKICAgIAogICAgc3RydWN0IEl0ZW17CiAgICAgICAgYWRkcmVzcyBIb2xkZXI7CiAgICAgICAgdWludDggUHJpY2VJRDsKICAgIH0KICAgIAogICAgSXRlbVsxNl0gcHVibGljIE1hcmtldDsKICAgIAogICAgdWludDggcHVibGljIE1heEl0ZW1zID0gMTI7IC8vIG1heCBJRCwgaXMgTk9UIGluZGV4IGJ1dCBhY3R1YWwgbWF4IGl0ZW1zIHRvIGJ1eS4gMCBtZWFucyByZWFsbHkgbm90aGluZywgbm90IDEgaXRlbSAKICAgIAogICAgZXZlbnQgSXRlbUJvdWdodCh1aW50MjU2IFJvdW5kLCB1aW50OCBJRCwgIHVpbnQyNTYgUHJpY2UsIGFkZHJlc3MgQm91Z2h0RnJvbSwgYWRkcmVzcyBOZXdPd25lciwgdWludDI1NiBOZXdUaW1lciwgdWludDI1NiBOZXdKUCwgc3RyaW5nIFF1b3RlLCBzdHJpbmcgTmFtZSk7CiAgICAvLyBxdW90ZXMgaGVyZSA/IAogICAgZXZlbnQgUG9rZXJQYWlkKHVpbnQyNTYgUm91bmQsIHVpbnQyNTYgQW1vdW50V29uLCBhZGRyZXNzIFdobywgc3RyaW5nIFF1b3RlLCBzdHJpbmcgTmFtZSwgdWludDhbNl0gV2luSGFuZCk7CiAgICBldmVudCBKYWNrcG90UGFpZCh1aW50MjU2IFJvdW5kLCB1aW50MjU2IEFtb3VudCwgIGFkZHJlc3MgV2hvLCBzdHJpbmcgUXVvdGUsIHN0cmluZyBOYW1lKTsKICAgIGV2ZW50IE5ld1JvdW5kKCk7CiAgICAKICAgIGJvb2wgcHVibGljIEVkaXRNb2RlOwogICAgYm9vbCBwdWJsaWMgU2V0RWRpdE1vZGU7CiAgICAvLyBkZXYgZnVuY3Rpb25zIAogICAgCiAgICBtb2RpZmllciBPbmx5T3duZXIoKXsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIEdhbWVDbG9zZWQoKXsKICAgICAgICByZXF1aXJlIChibG9jay50aW1lc3RhbXAgPiBUaW1lcik7CiAgICAgICAgXzsKICAgIH0KICAgIAoKICAgIAogICAgZnVuY3Rpb24gVmVnYXMoKSBwdWJsaWN7CiAgICAgICAgb3duZXI9bXNnLnNlbmRlcjsKICAgICAgICBmZWVzZW5kPTB4MDk0NzA0MzZCRDViNDRjN0ViRGI3NWVFZTI0NzhlQzE3MmVBYUJGNjsKICAgICAgICAvLyB3aXRoZHJhdyBhbHNvIHNldHVwcyBuZXcgZ2FtZS4gCiAgICAgICAgLy8gcGF5cyBvdXQgMCBldGggb2YgY291cnNlIHRvIG93bmVyLCBubyBldGggaW4gY29udHJhY3QuIAogICAgICAgIFRpbWVyID0gMTsgLy8gbWFrZXMgc3VyZSB3aXRoZHJhd2FsIHJ1bnMKICAgICAgICBXaXRoZHJhdygiR2FtZSBpbml0IiwgIkFkbWluIik7CiAgICB9CiAgICAKICAgIC8vIGFsbCBjb250cmFjdCBjYWxscyBhcmUgYmFubmVkIGZyb20gYnV5aW5nIAogICAgZnVuY3Rpb24gQnV5KHVpbnQ4IElELCBzdHJpbmcgUXVvdGUsIHN0cmluZyBOYW1lKSBwdWJsaWMgcGF5YWJsZSBOb0NvbnRyYWN0IHsKICAgICAgICByZXF1aXJlKElEIDwgTWF4SXRlbXMpOwogICAgICAgIHJlcXVpcmUoIUVkaXRNb2RlKTsKICAgICAgICAvLyBnZXQgcHJpY2UgCiAgICAgICAgLy91aW50OCBwaWQgPSBNYXJrZXRbSURdLlByaWNlSUQ7CiAgICAgICAgdWludDI1NiBwcmljZSA9IEdldFByaWNlKE1hcmtldFtJRF0uUHJpY2VJRCk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcHJpY2UpOwogICAgICAgIAogICAgICAgIGlmIChibG9jay50aW1lc3RhbXAgPiBUaW1lcil7CiAgICAgICAgICAgIGlmIChUaW1lciAhPSAwKXsgLy8gdGltZXIgMCBtZWFucyB3aXRoZHJhdyBpcyBnb25lOyB3aXRoZHJhdyB3aWxsIHRocm93IG9uIDAKICAgICAgICAgICAgICAgIFdpdGhkcmF3KCJHYW1lSW5pdCIsICJBZG1pbiIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIHJldHVybiBleGNlc3MgCiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IHByaWNlKXsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUtcHJpY2UpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1aW50MjU2IFBheVRheCA9IChwcmljZSAqIFRheCkvMTAwMDA7CiAgICAgICAgZmVlc2VuZC50cmFuc2ZlcihQYXlUYXgpOwogICAgICAgIHVpbnQyNTYgTGVmdCA9IChwcmljZS1QYXlUYXgpOwogICAgICAgIAogICAgICAgIAogICAgICAgIGlmIChNYXJrZXRbSURdLlByaWNlSUQhPTApewogICAgICAgICAgICAvLyB1bnplcm8sIG1vdmUgdG8gcHJldmlvdXMgb3duZXIKICAgICAgICAgICAgdWludDI1NiBwYXkgPSAoTGVmdCpQcmV2aW91c1BheW91dCkvMTAwMDA7CiAgICAgICAgICAgIFRvdGFsUG90ID0gVG90YWxQb3QgKyAoTGVmdC1wYXkpOwogICAgICAgICAgIC8vIExlZnQ9TGVmdC1wYXk7CiAgICAgICAgICAgIE1hcmtldFtJRF0uSG9sZGVyLnRyYW5zZmVyKHBheSk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIFRvdGFsUG90ID0gVG90YWxQb3QgKyBMZWZ0OwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyByZXNldCB0aW1lcjsgCiAgICAgICAgVGltZXIgPSBibG9jay50aW1lc3RhbXAgKyBHZXRUaW1lKE1hcmtldFtJRF0uUHJpY2VJRCk7CiAgICAgICAgLy9zZXQgamFja3BvdCB3aW5uZXIgCiAgICAgICAgSmFja3BvdFdpbm5lciA9IG1zZy5zZW5kZXI7CgoKICAgICAgICAvLyBnaXZlIHVzZXIgbmV3IGNhcmQ7IAogICAgICAgIAogICAgICAgIGVtaXQgSXRlbUJvdWdodChSb3VuZE51bWJlcixJRCwgIHByaWNlLCAgTWFya2V0W0lEXS5Ib2xkZXIsIG1zZy5zZW5kZXIsIFRpbWVyLCAgVG90YWxQb3QsICBRdW90ZSwgTmFtZSk7CiAgICAgICAgCiAgICAgICAgRHJhd0FkZHIoKTsgLy8gZ2l2ZSBwbGF5ZXIgY2FyZHMKICAgICAgICAKICAgICAgICAvLyB1cGRhdGUgcHJpY2UgCiAgICAgICAgTWFya2V0W0lEXS5QcmljZUlEKys7CiAgICAgICAgLy9zZXQgaG9sZGVyIAogICAgICAgIE1hcmtldFtJRF0uSG9sZGVyPW1zZy5zZW5kZXI7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEdldFByaWNlKHVpbnQ4IGlkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICB1aW50MjU2IHAgPSBCYXNlUHJpY2U7CiAgICAgICAgaWYgKGlkID4gMCl7CiAgICAgICAgICAgIC8vIG1heCBwcmljZSBiYXNlcHJpY2UgKiBpbmNyZWFzZV4yMCBpcyByZWFzb25hYmxlCiAgICAgICAgICAgIGZvciAodWludCBpPTE7IGk8PWlkOyBpKyspewogICAgICAgICAgICAgICAgaWYgKGk9PU1BWFBSSUNFUE9XRVIpewogICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBwcmV2ZW50IG92ZXJmbG93IChub3Qgc3VyZSB3aHkgc29tZW9uZSB3b3VsZCBidXkgYXQgaW5jcmVhc2VeMjU1KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcCA9IChwICogKDEwMDAwICsgSW5jcmVhc2UpKS8xMDAwMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gcDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gUGF5UG9rZXIoc3RyaW5nIFF1b3RlLCBzdHJpbmcgTmFtZSkgcHVibGljIE5vQ29udHJhY3R7CiAgICAgICAgdWludDggd2lucyA9IEhhbmRXaW5zKG1zZy5zZW5kZXIpOwogICAgICAgIGlmICh3aW5zPjApewogICAgICAgICAgICB1aW50MjU2IGF2YWlsYWJsZV9iYWxhbmNlID0gKFRvdGFsUG90KlBvdFBheW91dCkvMTAwMDA7CiAgICAgICAgICAgIHVpbnQyNTYgcGF5bWVudCA9IHN1YiAoKGF2YWlsYWJsZV9iYWxhbmNlICogUG9rZXJQYXlvdXQpLzEwMDAwICwgUG9rZXJQYXlvdXRWYWx1ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIFBva2VyUGF5b3V0VmFsdWUgPSBQb2tlclBheW91dFZhbHVlICsgcGF5bWVudDsKICAgICAgICAgICAgaWYgKHdpbnM9PTEpewogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihwYXltZW50KTsKICAgICAgICAgICAgICAgIGVtaXQgUG9rZXJQYWlkKFJvdW5kTnVtYmVyLCBwYXltZW50LCBtc2cuc2VuZGVyLCAgUXVvdGUsICBOYW1lLCBXaW5uaW5nSGFuZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLyoKICAgICAgICAgICAgZWxzZSBpZiAod2lucz09Mil7CiAgICAgICAgICAgICAgICB1aW50MjU2IHB2YWwgPSBwYXltZW50LzI7CiAgICAgICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHB2YWwpOwogICAgICAgICAgICAgICAgUG9rZXJXaW5uZXIudHJhbnNmZXIocGF5bWVudC1wdmFsKTsvLyBzYXZlcyAxIHdlaSBlcnJvciAKICAgICAgICAgICAgICAgIGVtaXQgUG9rZXJQYWlkKFJvdW5kTnVtYmVyLCBwdmFsLCBtc2cuc2VuZGVyLCAgUXVvdGUsICBOYW1lLCBXaW5uaW5nSGFuZCk7CiAgICAgICAgICAgICAgICBlbWl0IFBva2VyUGFpZChSb3VuZE51bWJlciwgcHZhbCwgbXNnLnNlbmRlciwgIiIsICIiLCBXaW5uaW5nSGFuZCk7CiAgICAgICAgICAgIH0qLwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICAvLyBuaWNlIGJsdWZmIG1hdGUgCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gR2V0VGltZSh1aW50OCBpZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgaWYgKGlkID49IFRpbWVBcnJheS5sZW5ndGgpewogICAgICAgICAgICByZXR1cm4gVGltZUFycmF5W1RpbWVBcnJheS5sZW5ndGgtMV07CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHJldHVybiBUaW1lQXJyYXlbaWRdOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy9mdW5jdGlvbiBDYWxsKCkgcHVibGljIHsKICAgLy8gICAgIERyYXdIb3VzZSgpOwogICAvLyB9CiAgICAKICAgIAogICAgLy8gcGF5cyB3aW5uZXIuIAogICAgLy8gYWxzbyBzZXRzIHVwIG5ldyBnYW1lIAogICAgLy8gd2lubmVyIHJlY2VpdmVzIGxvdHMgb2YgZXRoIGNvbXBhcmVkIHRvIGdhcyBzbyBhIHNtYWxsIHBheW1lbnQgdG8gZ2FzIGlzIHJlYXNvbmFibGUuCiAgICAKICAgIGZ1bmN0aW9uIFdpdGhkcmF3KHN0cmluZyBRdW90ZSwgc3RyaW5nIE5hbWUpIHB1YmxpYyBOb0NvbnRyYWN0IHsKICAgICAgICBfd2l0aGRyYXcoUXVvdGUsTmFtZSxmYWxzZSk7CiAgICB9CiAgICAKICAgIC8vIGluIGNhc2UgdGhlcmUgaXMgYSByZXZlcnQgYnVnIGluIHRoZSBwb2tlciBjb250cmFjdCAKICAgIC8vIGFsbG93cyB3aW5uZXIgdG8gZ2V0IHBhaWQgd2l0aG91dCBjYWxsaW5nIHBva2VyLiBzaG91bGQgbmV2ZXIgYmUgY2FsbGVkIAogICAgLy8gZm9sbG93cyBhbGwgbm9ybWFsIHJ1bGVzIG9mIGdhbWUgLgogICAgZnVuY3Rpb24gV2l0aGRyYXdFbWVyZ2VuY3koKSBwdWJsaWMgT25seU93bmVyewogICAgICAgIF93aXRoZHJhdygiRW1lcmdlbmN5IHdpdGhkcmF3IGNhbGwiLCJBZG1pbiIsdHJ1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBfd2l0aGRyYXcoc3RyaW5nIFF1b3RlLCBzdHJpbmcgTmFtZSwgYm9vbCBFbWVyZ2VuY3kpIE5vQ29udHJhY3QgaW50ZXJuYWwgewogICAgICAgIC8vIFNldHVwIGNhcmRzIGZvciBuZXcgZ2FtZS4gCiAgICAgICAgCiAgICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPiBUaW1lciAmJiBUaW1lciAhPSAwKTsKICAgICAgICBUaW1lcj0wOyAvLyBwcmV2ZW50IHJlLWVudHJhbmN5IGltbWVkaWF0ZWx5LiAKICAgICAgICAKICAgICAgICAvLyBzZW5kIGZyb20gdGhpcy5iYWxhbmNlIAogICAgICAgIHVpbnQyNTYgYXZhaWxhYmxlX2JhbGFuY2UgPSAoVG90YWxQb3QqUG90UGF5b3V0KS8xMDAwMDsKICAgICAgICB1aW50MjU2IGJhbCA9IChhdmFpbGFibGVfYmFsYW5jZSAqIEphY2twb3RQYXlvdXQpLzEwMDAwOwogICAgICAgIAogICAgICAgICAgICAgICAgICAgIAogICAgICAgIEphY2twb3RXaW5uZXIudHJhbnNmZXIoYmFsKTsKICAgICAgICBlbWl0IEphY2twb3RQYWlkKFJvdW5kTnVtYmVyLCBiYWwsICBKYWNrcG90V2lubmVyLCBRdW90ZSwgTmFtZSk7CiAgICAgICAgCiAgICAgICAgLy8gcGF5IHRoZSBsYXN0IHBva2VyIHdpbm5lciByZW1haW5pbmcgcG9rZXIgcG90LgogICAgICAgIGJhbCA9IHN1YihzdWIoYXZhaWxhYmxlX2JhbGFuY2UsIGJhbCksUG9rZXJQYXlvdXRWYWx1ZSk7CiAgICAgICAgaWYgKGJhbCA+IDAgJiYgUG9rZXJXaW5uZXIgIT0gYWRkcmVzcyh0aGlzKSl7CiAgICAgICAgICAgIC8vIHRoaXMgb25seSBoYXBwZW5zIGF0IHN0YXJ0IGdhbWUsICBzb21lIHdlaSBlcnJvciAKICAgICAgICAgICAgaWYgKGJhbCA+IGFkZHJlc3ModGhpcykuYmFsYW5jZSl7CiAgICAgICAgICAgICAgICBQb2tlcldpbm5lci50cmFuc2ZlcihhZGRyZXNzKHRoaXMpLmJhbGFuY2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICBQb2tlcldpbm5lci50cmFuc2ZlcihiYWwpOyAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAKICAgICAgICAgICAgZW1pdCBQb2tlclBhaWQoUm91bmROdW1iZXIsIGJhbCwgUG9rZXJXaW5uZXIsICAiUGFpZCBvdXQgbGVmdCBwb2tlciBwb3QiLCAiRGVhbGVyIiwgV2lubmluZ0hhbmQpOwogICAgICAgIH0KICAgICAgICBUb3RhbFBvdCA9IGFkZHJlc3ModGhpcykuYmFsYW5jZTsKICAgIAogICAgICAgIC8vIG5leHQgcG9rZXIgcG90IHN0YXJ0cyBhdCB6ZXJvLiAKICAgICAgICBQb2tlclBheW91dFZhbHVlPSAoVG90YWxQb3QgKiBQb3RQYXlvdXQgKiBQb2tlclBheW91dCkvKDEwMDAwKjEwMDAwKTsKCiAgICAgICAgLy8gcmVzZXQgcHJpY2UgCgogICAgICAgIGZvciAodWludCBpPTA7IGk8TWF4SXRlbXM7IGkrKyl7CiAgICAgICAgICAgIE1hcmtldFtpXS5QcmljZUlEPTA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICghRW1lcmdlbmN5KXsKICAgICAgICAgICAgRHJhd0hvdXNlKCk7CiAgICAgICAgfQogICAgICAgIFJvdW5kTnVtYmVyKys7CiAgICAgICAgLy8gZW5hYmxlIGVkaXQgbW9kZSBpZiBzZXQgYnkgZGV2LgogICAgICAgIEVkaXRNb2RlPVNldEVkaXRNb2RlOwogICAgICAgIAogICAgICAgIGVtaXQgTmV3Um91bmQoKTsKICAgIH0KICAgIAogICAgLy8gZGV2IGVkaXQgZnVuY3Rpb25zIGJlbG93IAogICAgCiAgICAKICAgIGZ1bmN0aW9uIHNldEVkaXRNb2RlQm9vbChib29sIGVkaXRtb2RlKSBwdWJsaWMgT25seU93bmVyIHsKICAgICAgICAvLyBzdGFydCBlZGl0IG1vZGUgY2xvc2VzIHRoZSB3aG9sZSBnYW1lLiAKICAgICAgICBTZXRFZGl0TW9kZT1lZGl0bW9kZTsKICAgICAgICBpZiAoIWVkaXRtb2RlKXsKICAgICAgICAgICAgLy8gZW5hYmxlIGdhbWUgcm91bmQuCiAgICAgICAgICAgIEVkaXRNb2RlPWZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gZW1lcmdlbmN5RHJvcEV0aCgpIHB1YmxpYyBwYXlhYmxlewogICAgICAgIC8vIGFueSB3ZWlyZCBlcnJvciBtaWdodCBiZSBzb2x2ZWQgYnkgZHJvcHBpbmcgZXRoIChhbmQgbm8gdGhpcyBpcyBub3QgZXZlbiBhIHNjYW0sIGlmIGNvbnRyYWN0IG5lZWRzIGEgd2VpIG1vcmUsIHdlIHNlbmQgYSB3ZWksIGdldCBmdW5kcyBvdXQgYW5kIGZpeCBjb250cmFjdCkKICAgIH0KICAgICAgICAKICAgIGZ1bmN0aW9uIGVkaXRUaW1lcih1aW50OCBJRCwgdWludDI1NiBUaW1lKSBwdWJsaWMgT25seU93bmVyIEdhbWVDbG9zZWR7CiAgICAgICAgVGltZUFycmF5W0lEXSA9IFRpbWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGVkaXRCYXNlUHJpY2UodWludDI1NiBOZXdCYXNlUHJpY2UpIHB1YmxpYyBPbmx5T3duZXIgR2FtZUNsb3NlZHsKICAgICAgICBCYXNlUHJpY2UgPSBOZXdCYXNlUHJpY2U7ICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZWRpdE1heEl0ZW1zKHVpbnQ4IE5ld01heCkgcHVibGljIE9ubHlPd25lciBHYW1lQ2xvc2VkewogICAgICAgIE1heEl0ZW1zID0gTmV3TWF4OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBlZGl0UGF5b3V0U2V0dGluZyh1aW50OCBzZXR0aW5nLCB1aW50MTYgbmV3dikgcHVibGljIE9ubHlPd25lciBHYW1lQ2xvc2VkewogICAgICAgIHJlcXVpcmUoc2V0dGluZyA+IDApOwogICAgICAgIGlmIChzZXR0aW5nID09IDEpewogICAgICAgICAgICByZXF1aXJlKG5ld3YgPD0gMTAwMDApOwogICAgICAgICAgICBKYWNrcG90UGF5b3V0ID0gbmV3djsKICAgICAgICAgICAgUG9rZXJQYXlvdXQgPSAxMDAwMC1uZXd2OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChzZXR0aW5nID09IDIpewogICAgICAgICAgICByZXF1aXJlKG5ld3YgPD0gMTAwMDApOwogICAgICAgICAgICBQb2tlclBheW91dCA9IG5ld3Y7CiAgICAgICAgICAgIEphY2twb3RQYXlvdXQgPSAxMDAwMC1uZXd2OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChzZXR0aW5nID09IDMpewogICAgICAgICAgICByZXF1aXJlIChuZXd2IDw9IDEwMDAwKTsKICAgICAgICAgICAgUHJldmlvdXNQYXlvdXQgPSBuZXd2OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChzZXR0aW5nID09IDQpewogICAgICAgICAgICByZXF1aXJlKG5ld3YgPD0gMzAwMDApOwogICAgICAgICAgICBJbmNyZWFzZSA9IG5ld3Y7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHNldHRpbmcgPT0gNSl7CiAgICAgICAgICAgIHJlcXVpcmUobmV3diA8PTEwMDAwKTsKICAgICAgICAgICAgUG90UGF5b3V0ID0gbmV3djsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoc2V0dGluZyA9PSA2KXsKICAgICAgICAgICAgcmVxdWlyZShuZXd2IDwgNzAwKTsKICAgICAgICAgICAgVGF4ID0gbmV3djsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQogICAgCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICovCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9'.
	

]
