Class {
	#name : #SRTd9ecb0271877147df323ed7ad8486b9e138d18f0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd9ecb0271877147df323ed7ad8486b9e138d18f0 >> base64 [
	^ 'bGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZSB7CiAgICBmdW5jdGlvbiBzdGFydERhdGUoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7fQogICAgZnVuY3Rpb24gZW5kZWRBdCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHt9CiAgICBmdW5jdGlvbiBpc0VuZGVkKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB0b3RhbFJhaXNlZEFtb3VudEluQ255KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBudW1PZlB1cmNoYXNlZFRva2Vuc09uQ3NCeShhZGRyZXNzIHB1cmNoYXNlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeShhZGRyZXNzIHB1cmNoYXNlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7Cn0KCgpjb250cmFjdCBBYnN0cmFjdFN0YXJiYXNlVG9rZW4gewogICAgZnVuY3Rpb24gaXNGdW5kcmFpc2VyKGFkZHJlc3MgZnVuZHJhaXNlckFkZHJlc3MpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGNvbXBhbnkoKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBhbGxvY2F0ZVRvQ3Jvd2RzYWxlUHVyY2hhc2VyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9NYXJrZXRpbmdTdXBwb3J0ZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CgoKY29udHJhY3QgU3RhcmJhc2VFYXJseVB1cmNoYXNlIHsKICAgIC8qCiAgICAgKiAgQ29uc3RhbnRzCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX1VOSVQgPSAnQ05ZJzsgICAgLy8gQ2hpbmVzZSBZdWFuCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0FNT1VOVF9SQVRFX1JFRkVSRU5DRSA9ICdodHRwOi8vd3d3LnhlLmNvbS9jdXJyZW5jeXRhYmxlcy8nOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX0NBUCA9IDkwMDAwMDA7CgogICAgLyoKICAgICAqICBUeXBlcwogICAgICovCiAgICBzdHJ1Y3QgRWFybHlQdXJjaGFzZSB7CiAgICAgICAgYWRkcmVzcyBwdXJjaGFzZXI7CiAgICAgICAgdWludDI1NiBhbW91bnQ7ICAgICAgICAvLyBDTlkgYmFzZWQgYW1vdW50CiAgICAgICAgdWludDI1NiBwdXJjaGFzZWRBdDsgICAvLyB0aW1lc3RhbXAKICAgIH0KCiAgICAvKgogICAgICogIEV4dGVybmFsIGNvbnRyYWN0cwogICAgICovCiAgICBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHB1YmxpYyBzdGFyYmFzZUNyb3dkc2FsZTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBFYXJseVB1cmNoYXNlW10gcHVibGljIGVhcmx5UHVyY2hhc2VzOwogICAgdWludDI1NiBwdWJsaWMgZWFybHlQdXJjaGFzZUNsb3NlZEF0OwoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG5vRXRoZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVDcm93ZHNhbGUoKSB7CiAgICAgICAgYXNzZXJ0KGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpID09IGFkZHJlc3MoMCkgfHwgc3RhcmJhc2VDcm93ZHNhbGUuc3RhcnREYXRlKCkgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RWFybHlQdXJjaGFzZVRlcm0oKSB7CiAgICAgICAgYXNzZXJ0KGVhcmx5UHVyY2hhc2VDbG9zZWRBdCA8PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgQ29udHJhY3QgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGJ5IHB1cmNoYXNlcidzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gcHVyY2hhc2VkQW1vdW50QnkoYWRkcmVzcyBwdXJjaGFzZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGVhcmx5UHVyY2hhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChlYXJseVB1cmNoYXNlc1tpXS5wdXJjaGFzZXIgPT0gcHVyY2hhc2VyKSB7CiAgICAgICAgICAgICAgICBhbW91bnQgKz0gZWFybHlQdXJjaGFzZXNbaV0uYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIGFtb3VudCBvZiByYWlzZWQgZnVuZHMgYnkgRWFybHkgUHVyY2hhc2VycwogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgdG90YWxBbW91bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBlYXJseVB1cmNoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3RhbEFtb3VudCArPSBlYXJseVB1cmNoYXNlc1tpXS5hbW91bnQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMKICAgICAqLwogICAgZnVuY3Rpb24gbnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBlYXJseVB1cmNoYXNlcy5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFwcGVuZCBhbiBlYXJseSBwdXJjaGFzZSBsb2cKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgICAqIEBwYXJhbSBhbW91bnQgUHVyY2hhc2UgYW1vdW50CiAgICAgKiBAcGFyYW0gcHVyY2hhc2VkQXQgVGltZXN0YW1wIG9mIHB1cmNoYXNlZCBkYXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcGVuZEVhcmx5UHVyY2hhc2UoYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHB1cmNoYXNlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZVRlcm0KICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChhbW91bnQgPT0gMCB8fAogICAgICAgICAgICB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSArIGFtb3VudCA+IFBVUkNIQVNFX0FNT1VOVF9DQVApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnQocHVyY2hhc2VkQXQgIT0gMCB8fCBwdXJjaGFzZWRBdCA8PSBub3cpOwoKICAgICAgICBlYXJseVB1cmNoYXNlcy5wdXNoKEVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENsb3NlIGVhcmx5IHB1cmNoYXNlIHRlcm0KICAgICAqLwogICAgZnVuY3Rpb24gY2xvc2VFYXJseVB1cmNoYXNlKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGVhcmx5UHVyY2hhc2VDbG9zZWRBdCA9IG5vdzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0dXAgZnVuY3Rpb24gc2V0cyBleHRlcm5hbCBjb250cmFjdCdzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MgVG9rZW4gYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcykKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSA9PSAwKSB7CiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlID0gQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZShzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBmdW5jdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UoKSBub0V0aGVyIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9Cn0KCgpjb250cmFjdCBTdGFyYmFzZUVhcmx5UHVyY2hhc2VBbWVuZG1lbnQgewogICAgLyoKICAgICAqICBFdmVudHMKICAgICAqLwogICAgZXZlbnQgRWFybHlQdXJjaGFzZUludmFsaWRhdGVkKHVpbnQyNTYgZXBJZHgpOwogICAgZXZlbnQgRWFybHlQdXJjaGFzZUFtZW5kZWQodWludDI1NiBlcElkeCk7CgogICAgLyoKICAgICAqICBFeHRlcm5hbCBjb250cmFjdHMKICAgICAqLwogICAgQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZSBwdWJsaWMgc3RhcmJhc2VDcm93ZHNhbGU7CiAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UgcHVibGljIHN0YXJiYXNlRWFybHlQdXJjaGFzZTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICB1aW50MjU2W10gcHVibGljIGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlczsKICAgIHVpbnQyNTZbXSBwdWJsaWMgYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzOwogICAgbWFwcGluZyAodWludDI1NiA9PiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZSkgcHVibGljIGFtZW5kZWRFYXJseVB1cmNoYXNlczsKCiAgICAvKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBub0V0aGVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QmVmb3JlQ3Jvd2RzYWxlKCkgewogICAgICAgIGFzc2VydChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSA9PSBhZGRyZXNzKDApIHx8IHN0YXJiYXNlQ3Jvd2RzYWxlLnN0YXJ0RGF0ZSgpID09IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkKCkgewogICAgICAgIGFzc2VydChhZGRyZXNzKHN0YXJiYXNlRWFybHlQdXJjaGFzZSkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKgogICAgICogIEZ1bmN0aW9ucyBiZWxvdyBhcmUgY29tcGF0aWJsZSB3aXRoIHN0YXJiYXNlRWFybHlQdXJjaGFzZSBjb250cmFjdAogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgYW4gZWFybHkgcHVyY2hhc2UgcmVjb3JkCiAgICAgKiBAcGFyYW0gZWFybHlQdXJjaGFzZUluZGV4IEluZGV4IG51bWJlciBvZiBhbiBlYXJseSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBlYXJseVB1cmNoYXNlcyh1aW50MjU2IGVhcmx5UHVyY2hhc2VJbmRleCkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkCiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHB1cmNoYXNlZEF0KQogICAgewogICAgICAgIHJldHVybiBzdGFyYmFzZUVhcmx5UHVyY2hhc2UuZWFybHlQdXJjaGFzZXMoZWFybHlQdXJjaGFzZUluZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGJ5IHB1cmNoYXNlcidzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gcHVyY2hhc2VkQW1vdW50QnkoYWRkcmVzcyBwdXJjaGFzZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdIG1lbW9yeSBub3JtYWxpemVkRVAgPQogICAgICAgICAgICBub3JtYWxpemVkRWFybHlQdXJjaGFzZXMoKTsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IG5vcm1hbGl6ZWRFUC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAobm9ybWFsaXplZEVQW2ldLnB1cmNoYXNlciA9PSBwdXJjaGFzZXIpIHsKICAgICAgICAgICAgICAgIGFtb3VudCArPSBub3JtYWxpemVkRVBbaV0uYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIGFtb3VudCBvZiByYWlzZWQgZnVuZHMgYnkgRWFybHkgUHVyY2hhc2VycwogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgdG90YWxBbW91bnQpCiAgICB7CiAgICAgICAgU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2VbXSBtZW1vcnkgbm9ybWFsaXplZEVQID0KICAgICAgICAgICAgbm9ybWFsaXplZEVhcmx5UHVyY2hhc2VzKCk7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBub3JtYWxpemVkRVAubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG90YWxBbW91bnQgKz0gbm9ybWFsaXplZEVQW2ldLmFtb3VudDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgbnVtYmVyIG9mIGVhcmx5IHB1cmNoYXNlcwogICAgICovCiAgICBmdW5jdGlvbiBudW1iZXJPZkVhcmx5UHVyY2hhc2VzKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRFYXJseVB1cmNoYXNlcygpLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0cyB1cCBmdW5jdGlvbiBzZXRzIGV4dGVybmFsIGNvbnRyYWN0J3MgYWRkcmVzcwogICAgICogQHBhcmFtIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcyBUb2tlbiBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwKGFkZHJlc3Mgc3RhcmJhc2VDcm93ZHNhbGVBZGRyZXNzKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaWYgKGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpID09IDApIHsKICAgICAgICAgICAgc3RhcmJhc2VDcm93ZHNhbGUgPSBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlKHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcyk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoKICAgICAqICBDb250cmFjdCBmdW5jdGlvbnMgdW5pcXVlIHRvIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudAogICAgICovCgogICAgIC8qKgogICAgICAqIEBkZXYgSW52YWxpZGF0ZSBlYXJseSBwdXJjaGFzZQogICAgICAqIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIHRoZSBwdXJjaGFzZQogICAgICAqLwogICAgZnVuY3Rpb24gaW52YWxpZGF0ZUVhcmx5UHVyY2hhc2UodWludDI1NiBlYXJseVB1cmNoYXNlSW5kZXgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBub0V0aGVyCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkCiAgICAgICAgb25seUJlZm9yZUNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA+IGVhcmx5UHVyY2hhc2VJbmRleCk7IC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uCgogICAgICAgIGZvciAodWludDI1NiBpOyBpIDwgaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFzc2VydChpbnZhbGlkRWFybHlQdXJjaGFzZUluZGV4ZXNbaV0gIT0gZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICB9CgogICAgICAgIGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlcy5wdXNoKGVhcmx5UHVyY2hhc2VJbmRleCk7CiAgICAgICAgRWFybHlQdXJjaGFzZUludmFsaWRhdGVkKGVhcmx5UHVyY2hhc2VJbmRleCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIGVhcmx5IHB1cmNoYXNlIGlzIGludmFsaWQKICAgICAqIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIHRoZSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBpc0ludmFsaWRFYXJseVB1cmNoYXNlKHVpbnQyNTYgZWFybHlQdXJjaGFzZUluZGV4KQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA+IGVhcmx5UHVyY2hhc2VJbmRleCk7IC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uCgoKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzW2ldID09IGVhcmx5UHVyY2hhc2VJbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbWVuZHMgYSBnaXZlbiBlYXJseSBwdXJjaGFzZSB3aXRoIGRhdGEKICAgICAqIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIHRoZSBwdXJjaGFzZQogICAgICogQHBhcmFtIHB1cmNoYXNlciBQdXJjaGFzZXIncyBhZGRyZXNzCiAgICAgKiBAcGFyYW0gYW1vdW50IFZhbHVlIG9mIHB1cmNoYXNlCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VkQXQgUHVyY2hhc2UgdGltZXN0YW1wCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFtZW5kRWFybHlQdXJjaGFzZSh1aW50MjU2IGVhcmx5UHVyY2hhc2VJbmRleCwgYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHB1cmNoYXNlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZAogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFzc2VydChwdXJjaGFzZWRBdCAhPSAwIHx8IHB1cmNoYXNlZEF0IDw9IG5vdyk7CgogICAgICAgIGFzc2VydChudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCkgPiBlYXJseVB1cmNoYXNlSW5kZXgpOwoKICAgICAgICBhc3NlcnQoIWlzSW52YWxpZEVhcmx5UHVyY2hhc2UoZWFybHlQdXJjaGFzZUluZGV4KSk7IC8vIEludmFsaWQgZWFybHkgcHVyY2hhc2UgY2Fubm90IGJlIGFtZW5kZWQKCiAgICAgICAgaWYgKCFpc0FtZW5kZWRFYXJseVB1cmNoYXNlKGVhcmx5UHVyY2hhc2VJbmRleCkpIHsKICAgICAgICAgICAgYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzLnB1c2goZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICB9CgogICAgICAgIGFtZW5kZWRFYXJseVB1cmNoYXNlc1tlYXJseVB1cmNoYXNlSW5kZXhdID0KICAgICAgICAgICAgU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KTsKICAgICAgICBFYXJseVB1cmNoYXNlQW1lbmRlZChlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDaGVja3Mgd2hldGhlciBlYXJseSBwdXJjaGFzZSBpcyBhbWVuZGVkCiAgICAgKiBAcGFyYW0gZWFybHlQdXJjaGFzZUluZGV4IEluZGV4IG51bWJlciBvZiB0aGUgcHVyY2hhc2UKICAgICAqLwogICAgZnVuY3Rpb24gaXNBbWVuZGVkRWFybHlQdXJjaGFzZSh1aW50MjU2IGVhcmx5UHVyY2hhc2VJbmRleCkKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFzc2VydChudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCkgPiBlYXJseVB1cmNoYXNlSW5kZXgpOyAvLyBBcnJheSBJbmRleCBPdXQgb2YgQm91bmRzIEV4Y2VwdGlvbgoKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGFtZW5kZWRFYXJseVB1cmNoYXNlSW5kZXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzW2ldID09IGVhcmx5UHVyY2hhc2VJbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBMb2FkcyBlYXJseSBwdXJjaGFzZXMgZGF0YSB0byBTdGFyYmFzZUVhcmx5UHVyY2hhc2VBbWVuZG1lbnQgY29udHJhY3QKICAgICAqIEBwYXJhbSBzdGFyYmFzZUVhcmx5UHVyY2hhc2VBZGRyZXNzIEFkZHJlc3MgZnJvbSBzdGFyYmFzZSBlYXJseSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBsb2FkU3RhcmJhc2VFYXJseVB1cmNoYXNlcyhhZGRyZXNzIHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBub0V0aGVyCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUJlZm9yZUNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MgIT0gMCB8fAogICAgICAgICAgICBhZGRyZXNzKHN0YXJiYXNlRWFybHlQdXJjaGFzZSkgPT0gMCk7CgogICAgICAgIHN0YXJiYXNlRWFybHlQdXJjaGFzZSA9IFN0YXJiYXNlRWFybHlQdXJjaGFzZShzdGFyYmFzZUVhcmx5UHVyY2hhc2VBZGRyZXNzKTsKICAgICAgICBhc3NlcnQoc3RhcmJhc2VFYXJseVB1cmNoYXNlLmVhcmx5UHVyY2hhc2VDbG9zZWRBdCgpICE9IDApOyAvLyB0aGUgZWFybHkgcHVyY2hhc2UgbXVzdCBiZSBjbG9zZWQKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENvbnRyYWN0IGNvbnN0cnVjdG9yIGZ1bmN0aW9uLiBJdCBzZXRzIG93bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCgpIG5vRXRoZXIgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IE5vcm1hbGl6ZXMgZWFybHkgcHVyY2hhc2VzIGRhdGEKICAgICAqLwogICAgZnVuY3Rpb24gbm9ybWFsaXplZEVhcmx5UHVyY2hhc2VzKCkKICAgICAgICBjb25zdGFudAogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAoU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2VbXSBub3JtYWxpemVkRVApCiAgICB7CiAgICAgICAgdWludDI1NiByYXdFUENvdW50ID0gbnVtYmVyT2ZSYXdFYXJseVB1cmNoYXNlcygpOwogICAgICAgIG5vcm1hbGl6ZWRFUCA9IG5ldyBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdKAogICAgICAgICAgICByYXdFUENvdW50IC0gaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aCk7CgogICAgICAgIHVpbnQyNTYgbm9ybWFsaXplZElkeDsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IHJhd0VQQ291bnQ7IGkrKykgewogICAgICAgICAgICBpZiAoaXNJbnZhbGlkRWFybHlQdXJjaGFzZShpKSkgewogICAgICAgICAgICAgICAgY29udGludWU7ICAgLy8gaW52YWxpZCBlYXJseSBwdXJjaGFzZSBzaG91bGQgYmUgaWdub3JlZAogICAgICAgICAgICB9CgogICAgICAgICAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZSBtZW1vcnkgZXA7CiAgICAgICAgICAgIGlmIChpc0FtZW5kZWRFYXJseVB1cmNoYXNlKGkpKSB7CiAgICAgICAgICAgICAgICBlcCA9IGFtZW5kZWRFYXJseVB1cmNoYXNlc1tpXTsgIC8vIGFtZW5kZWQgZWFybHkgcHVyY2hhc2Ugc2hvdWxkIHRha2UgYSBwcmlvcml0eQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZXAgPSBnZXRFYXJseVB1cmNoYXNlKGkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBub3JtYWxpemVkRVBbbm9ybWFsaXplZElkeF0gPSBlcDsKICAgICAgICAgICAgbm9ybWFsaXplZElkeCsrOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmV0Y2hlcyBlYXJseSBwdXJjaGFzZXMgZGF0YQogICAgICovCiAgICBmdW5jdGlvbiBnZXRFYXJseVB1cmNoYXNlKHVpbnQyNTYgZWFybHlQdXJjaGFzZUluZGV4KQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQKICAgICAgICByZXR1cm5zIChTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZSkKICAgIHsKICAgICAgICB2YXIgKHB1cmNoYXNlciwgYW1vdW50LCBwdXJjaGFzZWRBdCkgPQogICAgICAgICAgICBzdGFyYmFzZUVhcmx5UHVyY2hhc2UuZWFybHlQdXJjaGFzZXMoZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICByZXR1cm4gU3RhcmJhc2VFYXJseVB1cmNoYXNlLkVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyByYXcgbnVtYmVyIG9mIGVhcmx5IHB1cmNoYXNlcwogICAgICovCiAgICBmdW5jdGlvbiBudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gc3RhcmJhc2VFYXJseVB1cmNoYXNlLm51bWJlck9mRWFybHlQdXJjaGFzZXMoKTsKICAgIH0KfQoKCmNvbnRyYWN0IENlcnRpZmllciB7CglldmVudCBDb25maXJtZWQoYWRkcmVzcyBpbmRleGVkIHdobyk7CglldmVudCBSZXZva2VkKGFkZHJlc3MgaW5kZXhlZCB3aG8pOwoJZnVuY3Rpb24gY2VydGlmaWVkKGFkZHJlc3MpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCWZ1bmN0aW9uIGdldChhZGRyZXNzLCBzdHJpbmcpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChieXRlczMyKTsKCWZ1bmN0aW9uIGdldEFkZHJlc3MoYWRkcmVzcywgc3RyaW5nKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyk7CglmdW5jdGlvbiBnZXRVaW50KGFkZHJlc3MsIHN0cmluZykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwp9CgoKLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUgY29udHJhY3QgLSBTdGFyYmFzZSBjcm93ZHNhbGUgdG8gY3JlYXRlIFNUQVIuCiAqIEBhdXRob3IgU3RhcmJhc2UgUFRFLiBMVEQuIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIyMDQ5NGU0NjRmNjA1MzU0NDE1MjQyNDE1MzQ1MGU0MzRmIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KICovCmNvbnRyYWN0IFN0YXJiYXNlQ3Jvd2RzYWxlIGlzIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICAvKgogICAgICogIEV2ZW50cwogICAgICovCiAgICBldmVudCBDcm93ZHNhbGVFbmRlZCh1aW50MjU2IGVuZGVkQXQpOwogICAgZXZlbnQgU3RhcmJhc2VQdXJjaGFzZWRXaXRoRXRoKGFkZHJlc3MgcHVyY2hhc2VyLCB1aW50MjU2IGFtb3VudCwgdWludDI1NiByYXdBbW91bnQsIHVpbnQyNTYgY255RXRoUmF0ZSk7CiAgICBldmVudCBDbnlFdGhSYXRlVXBkYXRlZCh1aW50MjU2IGNueUV0aFJhdGUpOwogICAgZXZlbnQgQ255QnRjUmF0ZVVwZGF0ZWQodWludDI1NiBjbnlCdGNSYXRlKTsKICAgIGV2ZW50IFF1YWxpZmllZFBhcnRuZXJBZGRyZXNzKGFkZHJlc3MgcXVhbGlmaWVkUGFydG5lcik7CgogICAgLyoqCiAgICAgKiAgRXh0ZXJuYWwgY29udHJhY3RzCiAgICAgKi8KICAgIEFic3RyYWN0U3RhcmJhc2VUb2tlbiBwdWJsaWMgc3RhcmJhc2VUb2tlbjsKICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCBwdWJsaWMgc3RhcmJhc2VFcEFtZW5kbWVudDsKICAgIENlcnRpZmllciBwdWJsaWMgcGljb3BzQ2VydGlmaWVyOwoKICAgIC8qKgogICAgICogIENvbnN0YW50cwogICAgICovCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBjcm93ZHNhbGVUb2tlbkFtb3VudCA9IDEyNTAwMDAwMGUxODsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIGVhcmx5UHVyY2hhc2VUb2tlbkFtb3VudCA9IDUwMDAwMDAwZTE4OwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgTUlOX0lOVkVTVE1FTlQgPSAxOyAvLyBtaW4gaXMgMSBXZWkKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1BWF9DQVAgPSA2NzAwMDAwMDsgLy8gaW4gQ05ZLiBhcHByb3hpbWF0ZWx5IDEwTSBVU0QuIChpbmNsdWRlcyByYWlzZWQgYW1vdW50IGZyb20gYm90aCBFUCBhbmQgQ1MpCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0FNT1VOVF9VTklUID0gJ0NOWSc7ICAvLyBDaGluZXNlIFl1YW4KCiAgICAvKioKICAgICAqIFR5cGVzCiAgICAgKi8KICAgIHN0cnVjdCBDcm93ZHNhbGVQdXJjaGFzZSB7CiAgICAgICAgYWRkcmVzcyBwdXJjaGFzZXI7CiAgICAgICAgdWludDI1NiBhbW91bnQ7ICAgICAgICAvLyBDTlkgYmFzZWQgYW1vdW50IHdpdGggYm9udXMKICAgICAgICB1aW50MjU2IHJhd0Ftb3VudDsgICAgIC8vIENOWSBiYXNlZCBhbW91bnQgbm8gYm9udXMKICAgICAgICB1aW50MjU2IHB1cmNoYXNlZEF0OyAgIC8vIHRpbWVzdGFtcAogICAgfQoKICAgIHN0cnVjdCBRdWFsaWZpZWRQYXJ0bmVycyB7CiAgICAgICAgdWludDI1NiBhbW91bnRDYXA7CiAgICAgICAgdWludDI1NiBhbW91bnRSYWlzZWQ7CiAgICAgICAgYm9vbCAgICBib25hRmlkZTsKICAgICAgICB1aW50MjU2IGNvbW1pc3Npb25GZWVQZXJjZW50YWdlOyAvLyBleGFtcGxlIDUgd2lsbCBjYWxjdWxhdGUgdGhlIHBlcmNlbnRhZ2UgYXMgNSUKICAgIH0KCiAgICAvKgogICAgICogIEVudW1zCiAgICAgKi8KICAgIGVudW0gQm9udXNNaWxlc3RvbmVzIHsKICAgICAgICBGaXJzdCwKICAgICAgICBTZWNvbmQsCiAgICAgICAgVGhpcmQsCiAgICAgICAgRm91cnRoLAogICAgICAgIEZpZnRoCiAgICB9CgogICAgLy8gSW5pdGlhbGl6ZSBib251c01pbGVzdG9uZXMKICAgIEJvbnVzTWlsZXN0b25lcyBwdWJsaWMgYm9udXNNaWxlc3RvbmVzID0gQm9udXNNaWxlc3RvbmVzLkZpcnN0OwoKICAgIC8qKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgdWludCBwdWJsaWMgbnVtT2ZEZWxpdmVyZWRDcm93ZHNhbGVQdXJjaGFzZXM7ICAvLyBpbmRleCB0byBrZWVwIHRoZSBudW1iZXIgb2YgY3Jvd2RzYWxlIHB1cmNoYXNlcyBoYXZlIGFscmVhZHkgYmVlbiBwcm9jZXNzZWQgYnkgYHdpdGhkcmF3UHVyY2hhc2VkVG9rZW5zYAogICAgdWludCBwdWJsaWMgbnVtT2ZEZWxpdmVyZWRFYXJseVB1cmNoYXNlczsgIC8vIGluZGV4IHRvIGtlZXAgdGhlIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMgaGF2ZSBhbHJlYWR5IGJlZW4gcHJvY2Vzc2VkIGJ5IGB3aXRoZHJhd1B1cmNoYXNlZFRva2Vuc2AKICAgIHVpbnQyNTYgcHVibGljIG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXM7IC8vIGluZGV4IHRvIGtlZXAgdGhlIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMgdGhhdCBoYXZlIGFscmVhZHkgYmVlbiBsb2FkZWQgYnkgYGxvYWRFYXJseVB1cmNoYXNlc2AKCiAgICAvLyBlYXJseSBwdXJjaGFzZQogICAgYWRkcmVzc1tdIHB1YmxpYyBlYXJseVB1cmNoYXNlcnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBlYXJseVB1cmNoYXNlZEFtb3VudEJ5OyAvLyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGluIENOWSBwZXIgcHVyY2hhc2VycycgYWRkcmVzcwogICAgYm9vbCBwdWJsaWMgZWFybHlQdXJjaGFzZXNMb2FkZWQgPSBmYWxzZTsgIC8vIHJldHVybnMgd2hldGhlciBhbGwgZWFybHkgcHVyY2hhc2VzIGFyZSBsb2FkZWQgaW50byB0aGlzIGNvbnRyYWN0CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXM7IC8vIGluY2x1ZGluZyAyMCUgYm9udXMKCiAgICAvLyBjcm93ZHNhbGUKICAgIGJvb2wgcHVibGljIHByZXNhbGVQdXJjaGFzZXNMb2FkZWQgPSBmYWxzZTsgLy8gcmV0dXJucyB3aGV0aGVyIGFsbCBwcmVzYWxlIHB1cmNoYXNlcyBhcmUgbG9hZGVkIGludG8gdGhpcyBjb250cmFjdAogICAgdWludDI1NiBwdWJsaWMgbWF4Q3Jvd2RzYWxlQ2FwOyAgICAgLy8gPSA2N00gQ05ZIC0gKHRvdGFsIHJhaXNlZCBhbW91bnQgZnJvbSBFUCkKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXM7IC8vIGluIENOWSwgaW5jbHVkaW5nIGJvbnVzZXMKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXM7IC8vIGluIENOWQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBRdWFsaWZpZWRQYXJ0bmVycykgcHVibGljIHF1YWxpZmllZFBhcnRuZXJzOwogICAgdWludDI1NiBwdWJsaWMgcHVyY2hhc2VTdGFydEJsb2NrOyAgLy8gY3Jvd2RzYWxlIHB1cmNoYXNlcyBjYW4gYmUgYWNjZXB0ZWQgZnJvbSB0aGlzIGJsb2NrIG51bWJlcgogICAgdWludDI1NiBwdWJsaWMgc3RhcnREYXRlOwogICAgdWludDI1NiBwdWJsaWMgZW5kZWRBdDsKICAgIENyb3dkc2FsZVB1cmNoYXNlW10gcHVibGljIGNyb3dkc2FsZVB1cmNoYXNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50Qnk7IC8vIGNyb3dkc2FsZSBwdXJjaGFzZSBhbW91bnQgaW4gQ05ZIHBlciBwdXJjaGFzZXJzJyBhZGRyZXNzCiAgICB1aW50MjU2IHB1YmxpYyBjbnlCdGNSYXRlOyAvLyB0aGlzIHJhdGUgd29uJ3QgYmUgdXNlZCBmcm9tIGEgc21hcnQgY29udHJhY3QgZnVuY3Rpb24gYnV0IGV4dGVybmFsIHN5c3RlbQogICAgdWludDI1NiBwdWJsaWMgY255RXRoUmF0ZTsKCiAgICAvLyBib251cyBtaWxlc3RvbmVzCiAgICB1aW50MjU2IHB1YmxpYyBmaXJzdEJvbnVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIHNlY29uZEJvbnVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIHRoaXJkQm9udXNFbmRzOwogICAgdWludDI1NiBwdWJsaWMgZm91cnRoQm9udXNFbmRzOwoKICAgIC8vIGFmdGVyIHRoZSBjcm93ZHNhbGUKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5OyAgICAvLyB0aGUgbnVtYmVyIG9mIHRva2VucyBwdXJjaGFzZWQgb24gdGhlIGNyb3dkc2FsZSBieSBhIHB1cmNoYXNlcgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkVwQnk7ICAgIC8vIHRoZSBudW1iZXIgb2YgdG9rZW5zIGVhcmx5IHB1cmNoYXNlZCBieSBhIHB1cmNoYXNlcgoKICAgIC8qKgogICAgICogIE1vZGlmaWVycwogICAgICovCiAgICBtb2RpZmllciBtaW5JbnZlc3RtZW50KCkgewogICAgICAgIC8vIFVzZXIgaGFzIHRvIHNlbmQgYXQgbGVhc3QgdGhlIGV0aGVyIHZhbHVlIG9mIG9uZSB0b2tlbi4KICAgICAgICBhc3NlcnQobXNnLnZhbHVlID49IE1JTl9JTlZFU1RNRU5UKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHdoZW5Ob3RTdGFydGVkKCkgewogICAgICAgIGFzc2VydChzdGFydERhdGUgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB3aGVuRW5kZWQoKSB7CiAgICAgICAgYXNzZXJ0KGlzRW5kZWQoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBoYXNCYWxhbmNlKCkgewogICAgICAgIGFzc2VydCh0aGlzLmJhbGFuY2UgPiAwKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgcmF0ZUlzU2V0KHVpbnQyNTYgX3JhdGUpIHsKICAgICAgICBhc3NlcnQoX3JhdGUgIT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB3aGVuTm90RW5kZWQoKSB7CiAgICAgICAgYXNzZXJ0KCFpc0VuZGVkKCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdG9rZW5zTm90RGVsaXZlcmVkKCkgewogICAgICAgIGFzc2VydChudW1PZkRlbGl2ZXJlZENyb3dkc2FsZVB1cmNoYXNlcyA9PSAwKTsKICAgICAgICBhc3NlcnQobnVtT2ZEZWxpdmVyZWRFYXJseVB1cmNoYXNlcyA9PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlGdW5kcmFpc2VyKCkgewogICAgICAgIGFzc2VydChhZGRyZXNzKHN0YXJiYXNlVG9rZW4pICE9IDApOwogICAgICAgIGFzc2VydChzdGFyYmFzZVRva2VuLmlzRnVuZHJhaXNlcihtc2cuc2VuZGVyKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5UXVhbGlmaWVkUGFydG5lcigpIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYm9uYUZpZGUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVF1YWxpZmllZFBhcnRuZXJPUlBpY29wc0NlcnRpZmllZCgpIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYm9uYUZpZGUgfHwgcGljb3BzQ2VydGlmaWVyLmNlcnRpZmllZChtc2cuc2VuZGVyKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnRyYWN0IGZ1bmN0aW9ucwogICAgICovCiAgICAvKioKICAgICAqIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyBvd25lciBhZGRyZXNzIGFuZAogICAgICogICAgICBhZGRyZXNzIG9mIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCBjb250cmFjdC4KICAgICAqIEBwYXJhbSBzdGFyYmFzZUVwQWRkciBUaGUgYWRkcmVzcyB0aGF0IGhvbGRzIHRoZSBlYXJseSBwdXJjaGFzZXJzIFN0YXIgdG9rZW5zCiAgICAgKiBAcGFyYW0gcGljb3BzQ2VydGlmaWVyQWRkciBUaGUgYWRkcmVzcyBvZiB0aGUgUElDT1BTIGNlcnRpZmllci4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlZSBhbHNvIGh0dHBzOi8vcGljb3BzLnBhcml0eS5pby8jL2RldGFpbHMKICAgICAqLwogICAgZnVuY3Rpb24gU3RhcmJhc2VDcm93ZHNhbGUoYWRkcmVzcyBzdGFyYmFzZUVwQWRkciwgYWRkcmVzcyBwaWNvcHNDZXJ0aWZpZXJBZGRyKSB7CiAgICAgICAgcmVxdWlyZShzdGFyYmFzZUVwQWRkciAhPSAwICYmIHBpY29wc0NlcnRpZmllckFkZHIgIT0gMCk7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHN0YXJiYXNlRXBBbWVuZG1lbnQgPSBTdGFyYmFzZUVhcmx5UHVyY2hhc2VBbWVuZG1lbnQoc3RhcmJhc2VFcEFkZHIpOwogICAgICAgIHBpY29wc0NlcnRpZmllciA9IENlcnRpZmllcihwaWNvcHNDZXJ0aWZpZXJBZGRyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmFsbGJhY2sgYWNjZXB0cyBwYXltZW50IGZvciBTdGFyIHRva2VucyB3aXRoIEV0aAogICAgICovCiAgICBmdW5jdGlvbigpIHBheWFibGUgewogICAgICAgIHJlZGlyZWN0VG9QdXJjaGFzZSgpOwogICAgfQoKICAgIC8qKgogICAgICogRXh0ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgU2V0dXAgZnVuY3Rpb24gc2V0cyBleHRlcm5hbCBjb250cmFjdHMnIGFkZHJlc3NlcyBhbmQgc2V0IHRoZSBtYXggY3Jvd2RzYWxlIGNhcAogICAgICogQHBhcmFtIHN0YXJiYXNlVG9rZW5BZGRyZXNzIFRva2VuIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3B1cmNoYXNlU3RhcnRCbG9jayBCbG9jayBudW1iZXIgdG8gc3RhcnQgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwKGFkZHJlc3Mgc3RhcmJhc2VUb2tlbkFkZHJlc3MsIHVpbnQyNTYgX3B1cmNoYXNlU3RhcnRCbG9jaykKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShzdGFyYmFzZVRva2VuQWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3Moc3RhcmJhc2VUb2tlbikgPT0gMCk7CiAgICAgICAgc3RhcmJhc2VUb2tlbiA9IEFic3RyYWN0U3RhcmJhc2VUb2tlbihzdGFyYmFzZVRva2VuQWRkcmVzcyk7CiAgICAgICAgcHVyY2hhc2VTdGFydEJsb2NrID0gX3B1cmNoYXNlU3RhcnRCbG9jazsKCiAgICAgICAgLy8gc2V0IHRoZSBtYXggY2FwIG9mIHRoaXMgY3Jvd2RzYWxlCiAgICAgICAgbWF4Q3Jvd2RzYWxlQ2FwID0gTUFYX0NBUC5zdWIodG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzV2l0aG91dEJvbnVzKCkpOwoKICAgICAgICBhc3NlcnQobWF4Q3Jvd2RzYWxlQ2FwID4gMCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlcnMgcmFpc2VkIGZ1bmRzIHRvIGNvbXBhbnkncyB3YWxsZXQgYWRkcmVzcyBhdCBhbnkgZ2l2ZW4gdGltZS4KICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdGb3JDb21wYW55KCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyCiAgICAgICAgaGFzQmFsYW5jZQogICAgewogICAgICAgIGFkZHJlc3MgY29tcGFueSA9IHN0YXJiYXNlVG9rZW4uY29tcGFueSgpOwogICAgICAgIHJlcXVpcmUoY29tcGFueSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjb21wYW55LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZSBzdGFydCBibG9jayBOdW1iZXIgZm9yIHRoZSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlUHVyY2hhc2VTdGFydEJsb2NrKHVpbnQyNTYgX3B1cmNoYXNlU3RhcnRCbG9jaykKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RTdGFydGVkCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHB1cmNoYXNlU3RhcnRCbG9jayA9IF9wdXJjaGFzZVN0YXJ0QmxvY2s7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZSB0aGUgQ05ZL0VUSCByYXRlIHRvIHJlY29yZCBwdXJjaGFzZXMgaW4gQ05ZCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUNueUV0aFJhdGUodWludDI1NiByYXRlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGNueUV0aFJhdGUgPSByYXRlOwogICAgICAgIENueUV0aFJhdGVVcGRhdGVkKGNueUV0aFJhdGUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVcGRhdGUgdGhlIENOWS9CVEMgcmF0ZSB0byByZWNvcmQgcHVyY2hhc2VzIGluIENOWQogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDbnlCdGNSYXRlKHVpbnQyNTYgcmF0ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBjbnlCdGNSYXRlID0gcmF0ZTsKICAgICAgICBDbnlCdGNSYXRlVXBkYXRlZChjbnlCdGNSYXRlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3cgZm9yIHRoZSBwb3NzaWJpbGl0eSBmb3IgY29udHJhY3Qgb3duZXIgdG8gc3RhcnQgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyU3RhcnRzQ3Jvd2RzYWxlKHVpbnQyNTYgdGltZXN0YW1wKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFN0YXJ0ZWQKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBhc3NlcnQoYmxvY2subnVtYmVyID49IHB1cmNoYXNlU3RhcnRCbG9jayk7ICAgLy8gdGhpcyBzaG91bGQgYmUgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBzdGFydCBibG9jawogICAgICAgIHN0YXJ0Q3Jvd2RzYWxlKHRpbWVzdGFtcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEVuZHMgY3Jvd2RzYWxlCiAgICAgKiAgICAgIFRoaXMgbWF5IGJlIGV4ZWN1dGVkIGJ5IGFuIG93bmVyIGlmIHRoZSByYWlzZWQgZnVuZHMgZGlkIG5vdCByZWFjaCB0aGUgbWFwIGNhcAogICAgICogQHBhcmFtIHRpbWVzdGFtcCBUaW1lc3RhbXAgYXQgdGhlIGNyb3dkc2FsZSBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBlbmRDcm93ZHNhbGUodWludDI1NiB0aW1lc3RhbXApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBhc3NlcnQodGltZXN0YW1wID4gMCAmJiB0aW1lc3RhbXAgPD0gbm93KTsKICAgICAgICBhc3NlcnQoYmxvY2subnVtYmVyID49IHB1cmNoYXNlU3RhcnRCbG9jayAmJiBlbmRlZEF0ID09IDApOyAgIC8vIGNhbm5vdCBlbmQgYmVmb3JlIGl0IHN0YXJ0cyBhbmQgb3ZlcndyaXRpbmcgdGltZSBpcyBub3QgcGVybWl0dGVkCiAgICAgICAgZW5kZWRBdCA9IHRpbWVzdGFtcDsKICAgICAgICBDcm93ZHNhbGVFbmRlZChlbmRlZEF0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRW5kcyBjcm93ZHNhbGUKICAgICAqICAgICAgVGhpcyBtYXkgYmUgZXhlY3V0ZWQgYnkgcHVyY2hhc2VXaXRoRXRoIHdoZW4gdGhlIHJhaXNlZCBmdW5kcyByZWFjaCB0aGUgbWFwIGNhcAogICAgICovCiAgICBmdW5jdGlvbiBlbmRDcm93ZHNhbGUoKSBpbnRlcm5hbCB7CiAgICAgICAgYXNzZXJ0KGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2sgJiYgZW5kZWRBdCA9PSAwKTsKICAgICAgICBlbmRlZEF0ID0gbm93OwogICAgICAgIENyb3dkc2FsZUVuZGVkKGVuZGVkQXQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWxpdmVyIHRva2VucyB0byBwdXJjaGFzZXJzIGFjY29yZGluZyB0byB0aGVpciBwdXJjaGFzZSBhbW91bnQgaW4gQ05ZCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UHVyY2hhc2VkVG9rZW5zKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5FbmRlZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KGVhcmx5UHVyY2hhc2VzTG9hZGVkKTsKICAgICAgICBhc3NlcnQoYWRkcmVzcyhzdGFyYmFzZVRva2VuKSAhPSAwKTsKCiAgICAgICAgLyoKICAgICAgICAgKiDigJxWYWx1ZeKAnSByZWZlcnMgdG8gdGhlIGNvbnRyaWJ1dGlvbiBvZiB0aGUgVXNlcjoKICAgICAgICAgKiAge2Nyb3dkc2FsZV9wdXJjaGFzZXJfdG9rZW5fYW1vdW50fSA9CiAgICAgICAgICogIHtjcm93ZHNhbGVfdG9rZW5fYW1vdW50fSAqIHtjcm93ZHNhbGVQdXJjaGFzZV92YWx1ZX0gLyB7ZWFybHlwdXJjaGFzZV92YWx1ZX0gKyB7Y3Jvd2RzYWxlX3ZhbHVlfS4KICAgICAgICAgKgogICAgICAgICAqIEV4YW1wbGU6IElmIGEgVXNlciBjb250cmlidXRlcyBkdXJpbmcgdGhlIENvbnRyaWJ1dGlvbiBQZXJpb2QgMTAwIENOWSAoaW5jbHVkaW5nIGFwcGxpY2FibGUKICAgICAgICAgKiBCb251cywgaWYgYW55KSBhbmQgdGhlIHRvdGFsIGFtb3VudCBlYXJseSBwdXJjaGFzZXMgYW1vdW50cyB0byA24oCZMDAw4oCZMDAwIENOWQogICAgICAgICAqIGFuZCB0b3RhbCBhbW91bnQgcmFpc2VkIGR1cmluZyB0aGUgQ29udHJpYnV0aW9uIFBlcmlvZCBpcyAzMOKAmTAwMOKAmTAwMCwgdGhlbiBoZSB3aWxsIGdldAogICAgICAgICAqIDM0Ny4yMiBTVEFSID0gMTI14oCZMDAw4oCZMDAwIFNUQVIgKiAxMDAgQ05ZIC8gMzDigJkwMDDigJkwMDAgQ05ZICsgNuKAmTAwMOKAmTAwMCBDTlkuCiAgICAgICAgKi8KCiAgICAgICAgaWYgKGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl0gPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgY3Jvd2RzYWxlUHVyY2hhc2VWYWx1ZSA9IGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl07CiAgICAgICAgICAgIGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0KICAgICAgICAgICAgICAgIFNhZmVNYXRoLm11bChjcm93ZHNhbGVUb2tlbkFtb3VudCwgY3Jvd2RzYWxlUHVyY2hhc2VWYWx1ZSkgLwogICAgICAgICAgICAgICAgdG90YWxSYWlzZWRBbW91bnRJbkNueSgpOwoKICAgICAgICAgICAgbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkNzQnlbbXNnLnNlbmRlcl0gPQogICAgICAgICAgICAgICAgU2FmZU1hdGguYWRkKG51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5W21zZy5zZW5kZXJdLCB0b2tlbkNvdW50KTsKICAgICAgICAgICAgYXNzZXJ0KHN0YXJiYXNlVG9rZW4uYWxsb2NhdGVUb0Nyb3dkc2FsZVB1cmNoYXNlcihtc2cuc2VuZGVyLCB0b2tlbkNvdW50KSk7CiAgICAgICAgICAgIG51bU9mRGVsaXZlcmVkQ3Jvd2RzYWxlUHVyY2hhc2VzKys7CiAgICAgICAgfQoKICAgICAgICAvKgogICAgICAgICAqIOKAnFZhbHVl4oCdIHJlZmVycyB0byB0aGUgY29udHJpYnV0aW9uIG9mIHRoZSBVc2VyOgogICAgICAgICAqIHtlYXJseXB1cmNoYXNlcl90b2tlbl9hbW91bnR9ID0KICAgICAgICAgKiB7ZWFybHlwdXJjaGFzZXJfdG9rZW5fYW1vdW50fSAqICh7ZWFybHlwdXJjaGFzZV92YWx1ZX0gLyB7dG90YWxfZWFybHlwdXJjaGFzZV92YWx1ZX0pCiAgICAgICAgICogICsge2Nyb3dkc2FsZV90b2tlbl9hbW91bnR9ICogKHtlYXJseXB1cmNoYXNlX3ZhbHVlfSAvIHtlYXJseXB1cmNoYXNlX3ZhbHVlfSArIHtjcm93ZHNhbGVfdmFsdWV9KS4KICAgICAgICAgKgogICAgICAgICAqIEV4YW1wbGU6IElmIGFuIEVhcmx5IFB1cmNoYXNlciBjb250cmlidXRlcyAxMDAgQ05ZIChpbmNsdWRpbmcgQm9udXMgb2YgMjAlKSBhbmQgdGhlCiAgICAgICAgICogdG90YWwgYW1vdW50IG9mIGVhcmx5IHB1cmNoYXNlcyBhbW91bnRzIHRvIDbigJkwMDDigJkwMDAgQ05ZIGFuZCB0aGUgdG90YWwgYW1vdW50IHJhaXNlZAogICAgICAgICAqIGR1cmluZyB0aGUgQ29udHJpYnV0aW9uIFBlcmlvZCBpcyAzMOKAmTAwMOKAmTAwMCBDTlksIHRoZW4gaGUgd2lsbCBnZXQgMTE4MC41NSBTVEFSID0KICAgICAgICAgKiA1MOKAmTAwMOKAmTAwMCBTVEFSICogMTAwIENOWSAvIDbigJkwMDDigJkwMDAgQ05ZICsgMTI14oCZMDAw4oCZMDAwIFNUQVIgKiAxMDAgQ05ZIC8KICAgICAgICAgKiAzMOKAmTAwMOKAmTAwMCBDTlkgKyA24oCZMDAw4oCZMDAwIENOWQogICAgICAgICAqLwoKICAgICAgICBpZiAoZWFybHlQdXJjaGFzZWRBbW91bnRCeVttc2cuc2VuZGVyXSA+IDApIHsgIC8vIHNraXAgaWYgaXMgbm90IGFuIGVhcmx5IHB1cmNoYXNlcgogICAgICAgICAgICB1aW50MjU2IGVhcmx5UHVyY2hhc2VyUHVyY2hhc2VWYWx1ZSA9IGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbbXNnLnNlbmRlcl07CiAgICAgICAgICAgIGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICAgICAgdWludDI1NiBlcFRva2VuQ2FsY3VsYXRpb25Gcm9tRVBUb2tlbkFtb3VudCA9IFNhZmVNYXRoLm11bChlYXJseVB1cmNoYXNlVG9rZW5BbW91bnQsIGVhcmx5UHVyY2hhc2VyUHVyY2hhc2VWYWx1ZSkgLyB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXM7CgogICAgICAgICAgICB1aW50MjU2IGVwVG9rZW5DYWxjdWxhdGlvbkZyb21Dcm93ZHNhbGVUb2tlbkFtb3VudCA9IFNhZmVNYXRoLm11bChjcm93ZHNhbGVUb2tlbkFtb3VudCwgZWFybHlQdXJjaGFzZXJQdXJjaGFzZVZhbHVlKSAvIHRvdGFsUmFpc2VkQW1vdW50SW5DbnkoKTsKCiAgICAgICAgICAgIHVpbnQyNTYgZXBUb2tlbkNvdW50ID0gU2FmZU1hdGguYWRkKGVwVG9rZW5DYWxjdWxhdGlvbkZyb21FUFRva2VuQW1vdW50LCBlcFRva2VuQ2FsY3VsYXRpb25Gcm9tQ3Jvd2RzYWxlVG9rZW5BbW91bnQpOwoKICAgICAgICAgICAgbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkVwQnlbbXNnLnNlbmRlcl0gPSBTYWZlTWF0aC5hZGQobnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkVwQnlbbXNnLnNlbmRlcl0sIGVwVG9rZW5Db3VudCk7CiAgICAgICAgICAgIGFzc2VydChzdGFyYmFzZVRva2VuLmFsbG9jYXRlVG9Dcm93ZHNhbGVQdXJjaGFzZXIobXNnLnNlbmRlciwgZXBUb2tlbkNvdW50KSk7CiAgICAgICAgICAgIG51bU9mRGVsaXZlcmVkRWFybHlQdXJjaGFzZXMrKzsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBMb2FkIGVhcmx5IHB1cmNoYXNlcyBmcm9tIHRoZSBjb250cmFjdCBrZWVwcyB0cmFjayBvZiB0aGVtCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxvYWRFYXJseVB1cmNoYXNlcygpIGV4dGVybmFsIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGVhcmx5UHVyY2hhc2VzTG9hZGVkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgICAgLy8gYWxsIEVQcyBoYXZlIGFscmVhZHkgYmVlbiBsb2FkZWQKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgbnVtT2ZPcmlnRXAgPSBzdGFyYmFzZUVwQW1lbmRtZW50CiAgICAgICAgICAgIC5zdGFyYmFzZUVhcmx5UHVyY2hhc2UoKQogICAgICAgICAgICAubnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpOwoKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXM7IGkgPCBudW1PZk9yaWdFcCAmJiBtc2cuZ2FzID4gMjAwMDAwOyBpKyspIHsKICAgICAgICAgICAgaWYgKHN0YXJiYXNlRXBBbWVuZG1lbnQuaXNJbnZhbGlkRWFybHlQdXJjaGFzZShpKSkgewogICAgICAgICAgICAgICAgbnVtT2ZMb2FkZWRFYXJseVB1cmNoYXNlcyA9IFNhZmVNYXRoLmFkZChudW1PZkxvYWRlZEVhcmx5UHVyY2hhc2VzLCAxKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciAocHVyY2hhc2VyLCBhbW91bnQsKSA9CiAgICAgICAgICAgICAgICBzdGFyYmFzZUVwQW1lbmRtZW50LmlzQW1lbmRlZEVhcmx5UHVyY2hhc2UoaSkKICAgICAgICAgICAgICAgID8gc3RhcmJhc2VFcEFtZW5kbWVudC5hbWVuZGVkRWFybHlQdXJjaGFzZXMoaSkKICAgICAgICAgICAgICAgIDogc3RhcmJhc2VFcEFtZW5kbWVudC5lYXJseVB1cmNoYXNlcyhpKTsKICAgICAgICAgICAgaWYgKGFtb3VudCA+IDApIHsKICAgICAgICAgICAgICAgIGlmIChlYXJseVB1cmNoYXNlZEFtb3VudEJ5W3B1cmNoYXNlcl0gPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGVhcmx5UHVyY2hhc2Vycy5wdXNoKHB1cmNoYXNlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBlYWNoIGVhcmx5IHB1cmNoYXNlciByZWNlaXZlcyAyMCUgYm9udXMKICAgICAgICAgICAgICAgIHVpbnQyNTYgYm9udXMgPSBTYWZlTWF0aC5tdWwoYW1vdW50LCAyMCkgLyAxMDA7CiAgICAgICAgICAgICAgICB1aW50MjU2IGFtb3VudFdpdGhCb251cyA9IFNhZmVNYXRoLmFkZChhbW91bnQsIGJvbnVzKTsKCiAgICAgICAgICAgICAgICBlYXJseVB1cmNoYXNlZEFtb3VudEJ5W3B1cmNoYXNlcl0gPSBTYWZlTWF0aC5hZGQoZWFybHlQdXJjaGFzZWRBbW91bnRCeVtwdXJjaGFzZXJdLCBhbW91bnRXaXRoQm9udXMpOwogICAgICAgICAgICAgICAgdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzID0gdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzLmFkZChhbW91bnRXaXRoQm9udXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBudW1PZkxvYWRlZEVhcmx5UHVyY2hhc2VzID0gU2FmZU1hdGguYWRkKG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMsIDEpOwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0KG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMgPD0gbnVtT2ZPcmlnRXApOwogICAgICAgIGlmIChudW1PZkxvYWRlZEVhcmx5UHVyY2hhc2VzID09IG51bU9mT3JpZ0VwKSB7CiAgICAgICAgICAgIGVhcmx5UHVyY2hhc2VzTG9hZGVkID0gdHJ1ZTsgICAgLy8gZW5hYmxlIHRoZSBmbGFnCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBMb2FkIHByZXNhbGUgcHVyY2hhc2VzIGZyb20gdGhlIGNvbnRyYWN0IGtlZXBzIHRyYWNrIG9mIHRoZW0KICAgICAqIEBwYXJhbSBzdGFyYmFzZUNyb3dkc2FsZVByZXNhbGUgU3RhcmJhc2UgcHJlc2FsZSBjb250cmFjdCBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxvYWRQcmVzYWxlUHVyY2hhc2VzKGFkZHJlc3Mgc3RhcmJhc2VDcm93ZHNhbGVQcmVzYWxlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICAgICAgd2hlbk5vdEVuZGVkCiAgICB7CiAgICAgICAgcmVxdWlyZShzdGFyYmFzZUNyb3dkc2FsZVByZXNhbGUgIT0gMCk7CiAgICAgICAgcmVxdWlyZSghcHJlc2FsZVB1cmNoYXNlc0xvYWRlZCk7CiAgICAgICAgU3RhcmJhc2VDcm93ZHNhbGUgcHJlc2FsZSA9IFN0YXJiYXNlQ3Jvd2RzYWxlKHN0YXJiYXNlQ3Jvd2RzYWxlUHJlc2FsZSk7CiAgICAgICAgZm9yICh1aW50IGk7IGkgPCBwcmVzYWxlLm51bU9mUHVyY2hhc2VzKCk7IGkrKykgewogICAgICAgICAgICB2YXIgKHB1cmNoYXNlciwgYW1vdW50LCByYXdBbW91bnQsIHB1cmNoYXNlZEF0KSA9CiAgICAgICAgICAgICAgICBwcmVzYWxlLmNyb3dkc2FsZVB1cmNoYXNlcyhpKTsgIC8vIHByZXNhbGUgcHVyY2hhc2UKICAgICAgICAgICAgY3Jvd2RzYWxlUHVyY2hhc2VzLnB1c2goQ3Jvd2RzYWxlUHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHJhd0Ftb3VudCwgcHVyY2hhc2VkQXQpKTsKCiAgICAgICAgICAgIC8vIEluY3JlYXNlIHRoZSBzdW1zCiAgICAgICAgICAgIGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbcHVyY2hhc2VyXSA9IFNhZmVNYXRoLmFkZChjcm93ZHNhbGVQdXJjaGFzZUFtb3VudEJ5W3B1cmNoYXNlcl0sIGFtb3VudCk7CiAgICAgICAgICAgIHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXMgPSB0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzLmFkZChhbW91bnQpOwogICAgICAgICAgICB0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzID0gdG90YWxBbW91bnRPZkNyb3dkc2FsZVB1cmNoYXNlc1dpdGhvdXRCb251cy5hZGQocmF3QW1vdW50KTsKICAgICAgICB9CiAgICAgICAgcHJlc2FsZVB1cmNoYXNlc0xvYWRlZCA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICogQGRldiBTZXQgcXVhbGlmaWVkIGNyb3dkc2FsZSBwYXJ0bmVyIGkuZS4gQml0Y29pbiBTdWlzc2UgYWRkcmVzcwogICAgICAqIEBwYXJhbSBfcXVhbGlmaWVkUGFydG5lciBBZGRyZXNzIG9mIHRoZSBxdWFsaWZpZWQgcGFydG5lciB0aGF0IGNhbiBwdXJjaGFzZSBkdXJpbmcgY3Jvd2RzYWxlCiAgICAgICogQHBhcmFtIF9hbW91bnRDYXAgRXRoZXIgdmFsdWUgd2hpY2ggcGFydG5lciBpcyBhYmxlIHRvIGNvbnRyaWJ1dGUKICAgICAgKiBAcGFyYW0gX2NvbW1pc3Npb25GZWVQZXJjZW50YWdlIEludGVnZXIgdGhhdCByZXByZXNlbnRzIHRoZSBmZWUgdG8gcGF5IHF1YWxpZmllZCBwYXJ0bmVyIDUgaXMgNSUKICAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFF1YWxpZmllZFBhcnRuZXIoYWRkcmVzcyBfcXVhbGlmaWVkUGFydG5lciwgdWludDI1NiBfYW1vdW50Q2FwLCB1aW50MjU2IF9jb21taXNzaW9uRmVlUGVyY2VudGFnZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGFzc2VydCghcXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYm9uYUZpZGUgPSB0cnVlOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW19xdWFsaWZpZWRQYXJ0bmVyXS5hbW91bnRDYXAgPSBfYW1vdW50Q2FwOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW19xdWFsaWZpZWRQYXJ0bmVyXS5jb21taXNzaW9uRmVlUGVyY2VudGFnZSA9IF9jb21taXNzaW9uRmVlUGVyY2VudGFnZTsKICAgICAgICBRdWFsaWZpZWRQYXJ0bmVyQWRkcmVzcyhfcXVhbGlmaWVkUGFydG5lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZSBhZGRyZXNzIGZyb20gcXVhbGlmaWVkIHBhcnRuZXJzIGxpc3QuCiAgICAgKiBAcGFyYW0gX3F1YWxpZmllZFBhcnRuZXIgQWRkcmVzcyB0byBiZSByZW1vdmVkIGZyb20gdGhlIGxpc3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVubGlzdFF1YWxpZmllZFBhcnRuZXIoYWRkcmVzcyBfcXVhbGlmaWVkUGFydG5lcikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYm9uYUZpZGUgPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIHdoaXRlbGlzdGVkIGFkZHJlc3MgYW1vdW50IGFsbG93ZWQgdG8gcmFpc2UgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICogQHBhcmFtIF9xdWFsaWZpZWRQYXJ0bmVyIFF1YWxpZmllZCBQYXJ0bmVyIGFkZHJlc3MgdG8gYmUgdXBkYXRlZC4KICAgICAqIEBwYXJhbSBfYW1vdW50Q2FwIEFtb3VudCB0aGF0IHRoZSBhZGRyZXNzIGlzIGFibGUgdG8gcmFpc2UgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVRdWFsaWZpZWRQYXJ0bmVyQ2FwQW1vdW50KGFkZHJlc3MgX3F1YWxpZmllZFBhcnRuZXIsIHVpbnQyNTYgX2Ftb3VudENhcCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYW1vdW50Q2FwID0gX2Ftb3VudENhcDsKICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIGJvb2xlYW4gZm9yIHdoZXRoZXIgY3Jvd2RzYWxlIGhhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBpc0VuZGVkKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKGVuZGVkQXQgPiAwICYmIGVuZGVkQXQgPD0gbm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgcHVyY2hhc2VzIHRvIGRhdGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gY3Jvd2RzYWxlUHVyY2hhc2VzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0b3RhbCByYWlzZWQgYW1vdW50IGluIENOWSAoaW5jbHVkZXMgRVApIGFuZCBib251c2VzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsUmFpc2VkQW1vdW50SW5DbnkoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMuYWRkKHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXMpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIGFtb3VudCBvZiBlYXJseSBwdXJjaGFzZXMgaW4gQ05ZIGFuZCBib251c2VzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlc1dpdGhCb251cygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgIHJldHVybiBzdGFyYmFzZUVwQW1lbmRtZW50LnRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlcygpLm11bCgxMjApLmRpdigxMDApOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIGFtb3VudCBvZiBlYXJseSBwdXJjaGFzZXMgaW4gQ05ZCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlc1dpdGhvdXRCb251cygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgIHJldHVybiBzdGFyYmFzZUVwQW1lbmRtZW50LnRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlcygpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgcXVhbGlmaWVkIGNyb3dkc2FsZSBwYXJ0bmVyIHRvIHB1cmNoYXNlIFN0YXIgVG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHB1cmNoYXNlQXNRdWFsaWZpZWRQYXJ0bmVyKCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgcHVibGljCiAgICAgICAgcmF0ZUlzU2V0KGNueUV0aFJhdGUpCiAgICAgICAgb25seVF1YWxpZmllZFBhcnRuZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICAgICAgcXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYW1vdW50UmFpc2VkID0gU2FmZU1hdGguYWRkKG1zZy52YWx1ZSwgcXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYW1vdW50UmFpc2VkKTsKCiAgICAgICAgYXNzZXJ0KHF1YWxpZmllZFBhcnRuZXJzW21zZy5zZW5kZXJdLmFtb3VudFJhaXNlZCA8PSBxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5hbW91bnRDYXApOwoKICAgICAgICB1aW50MjU2IHJhd0Ftb3VudCA9IFNhZmVNYXRoLm11bChtc2cudmFsdWUsIGNueUV0aFJhdGUpIC8gMWUxODsKICAgICAgICByZWNvcmRQdXJjaGFzZShtc2cuc2VuZGVyLCByYXdBbW91bnQsIG5vdyk7CgogICAgICAgIGlmIChxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5jb21taXNzaW9uRmVlUGVyY2VudGFnZSA+IDApIHsKICAgICAgICAgICAgc2VuZFF1YWxpZmllZFBhcnRuZXJDb21taXNzaW9uRmVlKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHVzZXIgdG8gcHVyY2hhc2UgU1RBUiB0b2tlbnMgd2l0aCBFdGhlcgogICAgICovCiAgICBmdW5jdGlvbiBwdXJjaGFzZVdpdGhFdGgoKQogICAgICAgIHBheWFibGUKICAgICAgICBwdWJsaWMKICAgICAgICBtaW5JbnZlc3RtZW50CiAgICAgICAgd2hlbk5vdEVuZGVkCiAgICAgICAgcmF0ZUlzU2V0KGNueUV0aFJhdGUpCiAgICAgICAgb25seVF1YWxpZmllZFBhcnRuZXJPUlBpY29wc0NlcnRpZmllZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShwdXJjaGFzZVN0YXJ0QmxvY2sgPiAwICYmIGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spOwoKICAgICAgICBpZiAoc3RhcnREYXRlID09IDApIHsKICAgICAgICAgICAgc3RhcnRDcm93ZHNhbGUoYmxvY2sudGltZXN0YW1wKTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcmF3QW1vdW50ID0gU2FmZU1hdGgubXVsKG1zZy52YWx1ZSwgY255RXRoUmF0ZSkgLyAxZTE4OwogICAgICAgIHJlY29yZFB1cmNoYXNlKG1zZy5zZW5kZXIsIHJhd0Ftb3VudCwgbm93KTsKCiAgICAgICAgaWYgKHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXMgPj0gbWF4Q3Jvd2RzYWxlQ2FwKSB7CiAgICAgICAgICAgIGVuZENyb3dkc2FsZSgpOyAvLyBlbmRzIHRoaXMgY3Jvd2RzYWxlIGF1dG9tYXRpY2FsbHkKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgSW5pdGlhbGl6ZXMgU3RhcmJhc2UgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YXJ0Q3Jvd2RzYWxlKHVpbnQyNTYgdGltZXN0YW1wKSBpbnRlcm5hbCB7CiAgICAgICAgc3RhcnREYXRlID0gdGltZXN0YW1wOwogICAgICAgIHVpbnQyNTYgcHJlc2FsZUFtb3VudCA9IHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXM7CiAgICAgICAgaWYgKG1heENyb3dkc2FsZUNhcCA+IHByZXNhbGVBbW91bnQpIHsKICAgICAgICAgICAgdWludDI1NiBtYWluU2FsZUNhcCA9IG1heENyb3dkc2FsZUNhcC5zdWIocHJlc2FsZUFtb3VudCk7CiAgICAgICAgICAgIHVpbnQyNTYgdHdlbnR5UGVyY2VudE9mQ3Jvd2RzYWxlUHVyY2hhc2UgPSBtYWluU2FsZUNhcC5tdWwoMjApLmRpdigxMDApOwoKICAgICAgICAgICAgLy8gc2V0IHRva2VuIGJvbnVzIG1pbGVzdG9uZXMgaW4gY255IHRvdGFsIGNyb3dkc2FsZSBwdXJjaGFzZQogICAgICAgICAgICBmaXJzdEJvbnVzRW5kcyA9ICB0d2VudHlQZXJjZW50T2ZDcm93ZHNhbGVQdXJjaGFzZTsKICAgICAgICAgICAgc2Vjb25kQm9udXNFbmRzID0gZmlyc3RCb251c0VuZHMuYWRkKHR3ZW50eVBlcmNlbnRPZkNyb3dkc2FsZVB1cmNoYXNlKTsKICAgICAgICAgICAgdGhpcmRCb251c0VuZHMgPSAgc2Vjb25kQm9udXNFbmRzLmFkZCh0d2VudHlQZXJjZW50T2ZDcm93ZHNhbGVQdXJjaGFzZSk7CiAgICAgICAgICAgIGZvdXJ0aEJvbnVzRW5kcyA9IHRoaXJkQm9udXNFbmRzLmFkZCh0d2VudHlQZXJjZW50T2ZDcm93ZHNhbGVQdXJjaGFzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBYnN0cmFjdCByZWNvcmQgb2YgYSBwdXJjaGFzZSB0byBUb2tlbnMKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgQWRkcmVzcyBvZiB0aGUgYnV5ZXIKICAgICAqIEBwYXJhbSByYXdBbW91bnQgQW1vdW50IGluIENOWSBhcyBwZXIgdGhlIENOWS9FVEggcmF0ZSB1c2VkCiAgICAgKiBAcGFyYW0gdGltZXN0YW1wIFRpbWVzdGFtcCBhdCB0aGUgcHVyY2hhc2UgbWFkZQogICAgICovCiAgICBmdW5jdGlvbiByZWNvcmRQdXJjaGFzZSgKICAgICAgICBhZGRyZXNzIHB1cmNoYXNlciwKICAgICAgICB1aW50MjU2IHJhd0Ftb3VudCwKICAgICAgICB1aW50MjU2IHRpbWVzdGFtcAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBhbW91bnQgPSByYXdBbW91bnQ7IC8vIGFtb3VudCB0byBjaGVjayByZWFjaCBvZiBtYXggY2FwLiBpdCBkb2VzIG5vdCBjYXJlIGZvciBib251cyB0b2tlbnMgaGVyZQoKICAgICAgICAvLyBwcmVzYWxlIHRyYW5zZmVycyB3aGljaCBvY2N1cnMgYmVmb3JlIHRoZSBjcm93ZHNhbGUgaWdub3JlcyB0aGUgY3Jvd2RzYWxlIGhhcmQgY2FwCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spIHsKICAgICAgICAgICAgcmVxdWlyZSh0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzIDwgbWF4Q3Jvd2RzYWxlQ2FwKTsgICAvLyBjaGVjayBpZiB0aGUgYW1vdW50IGhhcyBhbHJlYWR5IHJlYWNoZWQgdGhlIGNhcAoKICAgICAgICAgICAgdWludDI1NiBjcm93ZHNhbGVUb3RhbEFtb3VudEFmdGVyUHVyY2hhc2UgPQogICAgICAgICAgICAgICAgU2FmZU1hdGguYWRkKHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXMsIGFtb3VudCk7CgogICAgICAgICAgICAvLyBjaGVjayB3aGV0aGVyIHB1cmNoYXNlIGdvZXMgb3ZlciB0aGUgY2FwIGFuZCBzZW5kIHRoZSBkaWZmZXJlbmNlIGJhY2sgdG8gdGhlIHB1cmNoYXNlci4KICAgICAgICAgICAgaWYgKGNyb3dkc2FsZVRvdGFsQW1vdW50QWZ0ZXJQdXJjaGFzZSA+IG1heENyb3dkc2FsZUNhcCkgewogICAgICAgICAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZSA9IFNhZmVNYXRoLnN1Yihjcm93ZHNhbGVUb3RhbEFtb3VudEFmdGVyUHVyY2hhc2UsIG1heENyb3dkc2FsZUNhcCk7CiAgICAgICAgICAgICAgdWludDI1NiBldGhWYWx1ZVRvUmV0dXJuID0gU2FmZU1hdGgubXVsKGRpZmZlcmVuY2UsIDFlMTgpIC8gY255RXRoUmF0ZTsKICAgICAgICAgICAgICBwdXJjaGFzZXIudHJhbnNmZXIoZXRoVmFsdWVUb1JldHVybik7CiAgICAgICAgICAgICAgYW1vdW50ID0gU2FmZU1hdGguc3ViKGFtb3VudCwgZGlmZmVyZW5jZSk7CiAgICAgICAgICAgICAgcmF3QW1vdW50ID0gYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhbW91bnQgPSBnZXRCb251c0Ftb3VudENhbGN1bGF0aW9uKGFtb3VudCk7IC8vIGF0IHRoaXMgcG9pbnQgYW1vdW50IGJvbnVzIGlzIGNhbGN1bGF0ZWQKCiAgICAgICAgQ3Jvd2RzYWxlUHVyY2hhc2UgbWVtb3J5IHB1cmNoYXNlID0gQ3Jvd2RzYWxlUHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHJhd0Ftb3VudCwgdGltZXN0YW1wKTsKICAgICAgICBjcm93ZHNhbGVQdXJjaGFzZXMucHVzaChwdXJjaGFzZSk7CiAgICAgICAgU3RhcmJhc2VQdXJjaGFzZWRXaXRoRXRoKG1zZy5zZW5kZXIsIGFtb3VudCwgcmF3QW1vdW50LCBjbnlFdGhSYXRlKTsKICAgICAgICBjcm93ZHNhbGVQdXJjaGFzZUFtb3VudEJ5W3B1cmNoYXNlcl0gPSBTYWZlTWF0aC5hZGQoY3Jvd2RzYWxlUHVyY2hhc2VBbW91bnRCeVtwdXJjaGFzZXJdLCBhbW91bnQpOwogICAgICAgIHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXMgPSB0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzLmFkZChhbW91bnQpOwogICAgICAgIHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXMgPSB0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzLmFkZChyYXdBbW91bnQpOwogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbGN1bGF0ZXMgYW1vdW50IHdpdGggYm9udXMgZm9yIGJvbnVzIG1pbGVzdG9uZXMKICAgICAqLwogICAgZnVuY3Rpb24gY2FsY3VsYXRlQm9udXMKICAgICAgICAoCiAgICAgICAgICAgIEJvbnVzTWlsZXN0b25lcyBuZXh0TWlsZXN0b25lLAogICAgICAgICAgICB1aW50MjU2IGFtb3VudCwKICAgICAgICAgICAgdWludDI1NiBib251c1JhbmdlLAogICAgICAgICAgICB1aW50MjU2IGJvbnVzVGllciwKICAgICAgICAgICAgdWludDI1NiByZXN1bHRzCiAgICAgICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludDI1NiByZXN1bHQsIHVpbnQyNTYgbmV3QW1vdW50KQogICAgewogICAgICAgIHVpbnQyNTYgYm9udXNDYWxjOwoKICAgICAgICBpZiAoYW1vdW50IDw9IGJvbnVzUmFuZ2UpIHsKICAgICAgICAgICAgYm9udXNDYWxjID0gYW1vdW50Lm11bChib251c1RpZXIpLmRpdigxMDApOwoKICAgICAgICAgICAgaWYgKGFtb3VudC5hZGQodG90YWxBbW91bnRPZkNyb3dkc2FsZVB1cmNoYXNlc1dpdGhvdXRCb251cykgPj0gYm9udXNSYW5nZSkKICAgICAgICAgICAgICAgIGJvbnVzTWlsZXN0b25lcyA9IG5leHRNaWxlc3RvbmU7CgogICAgICAgICAgICByZXN1bHQgPSByZXN1bHRzLmFkZChhbW91bnQpLmFkZChib251c0NhbGMpOwogICAgICAgICAgICBuZXdBbW91bnQgPSAwOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBib251c0NhbGMgPSBib251c1JhbmdlLm11bChib251c1RpZXIpLmRpdigxMDApOwogICAgICAgICAgICBib251c01pbGVzdG9uZXMgPSBuZXh0TWlsZXN0b25lOwogICAgICAgICAgICByZXN1bHQgPSByZXN1bHRzLmFkZChib251c1JhbmdlKS5hZGQoYm9udXNDYWxjKTsKICAgICAgICAgICAgbmV3QW1vdW50ID0gYW1vdW50LnN1Yihib251c1JhbmdlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEZldGNocyBCb251cyB0aWVyIHBlcmNlbnRhZ2UgcGVyIGJvbnVzIG1pbGVzdG9uZXMKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Qm9udXNBbW91bnRDYWxjdWxhdGlvbih1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChibG9jay5udW1iZXIgPCBwdXJjaGFzZVN0YXJ0QmxvY2spIHsKICAgICAgICAgICAgdWludDI1NiBib251c0Zyb21BbW91bnQgPSBhbW91bnQubXVsKDMwKS5kaXYoMTAwKTsgLy8gcHJlc2FsZSBoYXMgMzAlIGJvbnVzCiAgICAgICAgICAgIHJldHVybiBhbW91bnQuYWRkKGJvbnVzRnJvbUFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICAvLyByYW5nZSBvZiBlYWNoIGJvbnVzIG1pbGVzdG9uZXMKICAgICAgICB1aW50MjU2IGZpcnN0Qm9udXNSYW5nZSA9IGZpcnN0Qm9udXNFbmRzOwogICAgICAgIHVpbnQyNTYgc2Vjb25kQm9udXNSYW5nZSA9IHNlY29uZEJvbnVzRW5kcy5zdWIoZmlyc3RCb251c0VuZHMpOwogICAgICAgIHVpbnQyNTYgdGhpcmRCb251c1JhbmdlID0gdGhpcmRCb251c0VuZHMuc3ViKHNlY29uZEJvbnVzRW5kcyk7CiAgICAgICAgdWludDI1NiBmb3VydGhCb251c1JhbmdlID0gZm91cnRoQm9udXNFbmRzLnN1Yih0aGlyZEJvbnVzRW5kcyk7CiAgICAgICAgdWludDI1NiByZXN1bHQ7CgogICAgICAgIGlmIChib251c01pbGVzdG9uZXMgPT0gQm9udXNNaWxlc3RvbmVzLkZpcnN0KQogICAgICAgICAgICAocmVzdWx0LCBhbW91bnQpID0gY2FsY3VsYXRlQm9udXMoQm9udXNNaWxlc3RvbmVzLlNlY29uZCwgYW1vdW50LCBmaXJzdEJvbnVzUmFuZ2UsIDIwLCByZXN1bHQpOwoKICAgICAgICBpZiAoYm9udXNNaWxlc3RvbmVzID09IEJvbnVzTWlsZXN0b25lcy5TZWNvbmQpCiAgICAgICAgICAgIChyZXN1bHQsIGFtb3VudCkgPSBjYWxjdWxhdGVCb251cyhCb251c01pbGVzdG9uZXMuVGhpcmQsIGFtb3VudCwgc2Vjb25kQm9udXNSYW5nZSwgMTUsIHJlc3VsdCk7CgogICAgICAgIGlmIChib251c01pbGVzdG9uZXMgPT0gQm9udXNNaWxlc3RvbmVzLlRoaXJkKQogICAgICAgICAgICAocmVzdWx0LCBhbW91bnQpID0gY2FsY3VsYXRlQm9udXMoQm9udXNNaWxlc3RvbmVzLkZvdXJ0aCwgYW1vdW50LCB0aGlyZEJvbnVzUmFuZ2UsIDEwLCByZXN1bHQpOwoKICAgICAgICBpZiAoYm9udXNNaWxlc3RvbmVzID09IEJvbnVzTWlsZXN0b25lcy5Gb3VydGgpCiAgICAgICAgICAgIChyZXN1bHQsIGFtb3VudCkgPSBjYWxjdWxhdGVCb251cyhCb251c01pbGVzdG9uZXMuRmlmdGgsIGFtb3VudCwgZm91cnRoQm9udXNSYW5nZSwgNSwgcmVzdWx0KTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdC5hZGQoYW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmV0Y2hzIEJvbnVzIHRpZXIgcGVyY2VudGFnZSBwZXIgYm9udXMgbWlsZXN0b25lcwogICAgICogQGRldiBxdWFsaWZpZWRQYXJ0bmVyIEFkZHJlc3Mgb2YgcGFydG5lcnMgdGhhdCBwYXJ0aWNpcGF0ZWQgaW4gcHJlIHNhbGUKICAgICAqIEBkZXYgYW1vdW50U2VudCBWYWx1ZSBzZW50IGJ5IHF1YWxpZmllZCBwYXJ0bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlbmRRdWFsaWZpZWRQYXJ0bmVyQ29tbWlzc2lvbkZlZShhZGRyZXNzIHF1YWxpZmllZFBhcnRuZXIsIHVpbnQyNTYgYW1vdW50U2VudCkgaW50ZXJuYWwgewogICAgICAgIC8vY2FsY3VsYXRlIHRoZSBjb21taXNzaW9uIGZlZSB0byBzZW5kIHRvIHF1YWxpZmllZCBwYXJ0bmVyCiAgICAgICAgdWludDI1NiBjb21taXNzaW9uRmVlUGVyY2VudGFnZUNhbGN1bGF0aW9uQW1vdW50ID0gU2FmZU1hdGgubXVsKGFtb3VudFNlbnQsIHF1YWxpZmllZFBhcnRuZXJzW3F1YWxpZmllZFBhcnRuZXJdLmNvbW1pc3Npb25GZWVQZXJjZW50YWdlKSAvIDEwMDsKCiAgICAgICAgLy8gc2VuZCBjb21taXNzaW9uIGZlZSBhbW91bnQKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyLnRyYW5zZmVyKGNvbW1pc3Npb25GZWVQZXJjZW50YWdlQ2FsY3VsYXRpb25BbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiByZWRpcmVjdFRvUHVyY2hhc2UgUmVkaXJlY3QgdG8gYWRlcXVhdGUgcHVyY2hhc2UgZnVuY3Rpb24gd2l0aGluIHRoZSBzbWFydCBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiByZWRpcmVjdFRvUHVyY2hhc2UoKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8IHB1cmNoYXNlU3RhcnRCbG9jaykgewogICAgICAgICAgICBwdXJjaGFzZUFzUXVhbGlmaWVkUGFydG5lcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHB1cmNoYXNlV2l0aEV0aCgpOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
