Class {
	#name : #SRT055a9c349cDC2A598439d6A45D0A83CAd3864FDc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT055a9c349cDC2A598439d6A45D0A83CAd3864FDc >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjsKCi8qCiAqCiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFBhc3MgREFPLgogKgogKiBUaGUgVG9rZW4gTWFuYWdlciBzbWFydCBjb250cmFjdCBpcyB1c2VkIGZvciB0aGUgbWFuYWdlbWVudCBvZiB0b2tlbnMKICogYnkgYSBjbGllbnQgc21hcnQgY29udHJhY3QgKHRoZSBEYW8pLiBEZWZpbmVzIHRoZSBmdW5jdGlvbnMgdG8gc2V0IG5ldyBmdW5kaW5nIHJ1bGVzLAogKiBjcmVhdGUgb3IgcmV3YXJkIHRva2VucywgY2hlY2sgdG9rZW4gYmFsYW5jZXMsIHNlbmQgdG9rZW5zIGFuZCBzZW5kCiAqIHRva2VucyBvbiBiZWhhbGYgb2YgYSAzcmQgcGFydHkgYW5kIHRoZSBjb3JyZXNwb25kaW5nIGFwcHJvdmFsIHByb2Nlc3MuCiAqCiovCgovLy8gQHRpdGxlIFRva2VuIE1hbmFnZXIgc21hcnQgY29udHJhY3Qgb2YgdGhlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbgpjb250cmFjdCBQYXNzVG9rZW5NYW5hZ2VySW50ZXJmYWNlIHsKICAgIAogICAgc3RydWN0IGZ1bmRpbmdEYXRhIHsKICAgICAgICAvLyBUcnVlIGlmIHB1YmxpYyBmdW5kaW5nIHdpdGhvdXQgYSBtYWluIHBhcnRuZXIKICAgICAgICBib29sIHB1YmxpY0NyZWF0aW9uOyAKICAgICAgICAvLyBUaGUgYWRkcmVzcyB3aGljaCBzZXRzIHBhcnRuZXJzIGFuZCBtYW5hZ2VzIHRoZSBmdW5kaW5nIGluIGNhc2Ugb2YgcHJpdmF0ZSBmdW5kaW5nCiAgICAgICAgYWRkcmVzcyBtYWluUGFydG5lcjsKICAgICAgICAvLyBUaGUgbWF4aW11bSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IG1heEFtb3VudFRvRnVuZDsKICAgICAgICAvLyBUaGUgYWN0dWFsIGZ1bmRlZCBhbW91bnQgKGluIHdlaSkKICAgICAgICB1aW50IGZ1bmRlZEFtb3VudDsKICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgc3RhcnQgdGltZSBvZiB0aGUgZnVuZGluZwogICAgICAgIHVpbnQgc3RhcnRUaW1lOyAKICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgY2xvc2luZyB0aW1lIG9mIHRoZSBmdW5kaW5nCiAgICAgICAgdWludCBjbG9zaW5nVGltZTsgIAogICAgICAgIC8vIFRoZSBwcmljZSBtdWx0aXBsaWVyIGZvciBhIHNoYXJlIG9yIGEgdG9rZW4gd2l0aG91dCBjb25zaWRlcmluZyB0aGUgaW5mbGF0aW9uIHJhdGUKICAgICAgICB1aW50IGluaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgLy8gUmF0ZSBwZXIgeWVhciBpbiBwZXJjZW50YWdlIGFwcGxpZWQgdG8gdGhlIHNoYXJlIG9yIHRva2VuIHByaWNlIAogICAgICAgIHVpbnQgaW5mbGF0aW9uUmF0ZTsgCiAgICAgICAgLy8gSW5kZXggb2YgdGhlIGNsaWVudCBwcm9wb3NhbAogICAgICAgIHVpbnQgcHJvcG9zYWxJRDsKICAgIH0gCgogICAgLy8gQWRkcmVzcyBvZiB0aGUgY3JlYXRvciBvZiB0aGUgc21hcnQgY29udHJhY3QKICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3I7CiAgICAvLyBBZGRyZXNzIG9mIHRoZSBEYW8gICAgCiAgICBhZGRyZXNzIHB1YmxpYyBjbGllbnQ7CiAgICAvLyBBZGRyZXNzIG9mIHRoZSByZWNpcGllbnQ7CiAgICBhZGRyZXNzIHB1YmxpYyByZWNpcGllbnQ7CiAgICAKICAgIC8vIFRoZSB0b2tlbiBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIC8vIFRoZSB0b2tlbiBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICAvLyBUaGUgcXVhbnRpdHkgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgdG90YWxTdXBwbHk7CgogICAgLy8gQXJyYXkgd2l0aCBhbGwgYmFsYW5jZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICAvLyBBcnJheSB3aXRoIGFsbCBhbGxvd2FuY2VzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gTWFwIG9mIHRoZSByZXN1bHQgKGluIHdlaSkgb2YgZnVuZGluZ3MKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgZnVuZGVkQW1vdW50OwogICAgCiAgICAvLyBJZiB0cnVlLCB0aGUgc2hhcmVzIG9yIHRva2VucyBjYW4gYmUgdHJhbnNmZXJlZAogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJhYmxlOwogICAgLy8gTWFwIG9mIGJsb2NrZWQgRGFvIHNoYXJlIGFjY291bnRzLiBQb2ludHMgdG8gdGhlIGRhdGUgd2hlbiB0aGUgc2hhcmUgaG9sZGVyIGNhbiB0cmFuc2ZlciBzaGFyZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJsb2NrZWREZWFkTGluZTsgCgogICAgLy8gUnVsZXMgZm9yIHRoZSBhY3R1YWwgZnVuZGluZyBhbmQgdGhlIGNvbnRyYWN0b3IgdG9rZW4gcHJpY2UKICAgIGZ1bmRpbmdEYXRhWzJdIHB1YmxpYyBGdW5kaW5nUnVsZXM7CiAgICAKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBzdXBwbHkgb2Ygc2hhcmVzIG9yIHRva2VucyAKICAgIGZ1bmN0aW9uIFRvdGFsU3VwcGx5KCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFF1YW50aXR5IG9mIHJlbWFpbmluZyB0b2tlbnMgb2YgX293bmVyIHRoYXQgX3NwZW5kZXIgaXMgYWxsb3dlZCB0byBzcGVuZAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIERhbyBwcm9wb3NhbAogICAgLy8vIEByZXR1cm4gVGhlIHJlc3VsdCAoaW4gd2VpKSBvZiB0aGUgZnVuZGluZwogICAgZnVuY3Rpb24gRnVuZGVkQW1vdW50KHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAcGFyYW0gX3NhbGVEYXRlIGluIGNhc2Ugb2YgcHJlc2FsZSwgdGhlIGRhdGUgb2YgdGhlIHByZXNhbGUKICAgIC8vLyBAcmV0dXJuIHRoZSBzaGFyZSBvciB0b2tlbiBwcmljZSBkaXZpc29yIGNvbmRpZGVyaW5nIHRoZSBzYWxlIGRhdGUgYW5kIHRoZSBpbmZsYXRpb24gcmF0ZQogICAgZnVuY3Rpb24gcHJpY2VEaXZpc29yKHVpbnQgX3NhbGVEYXRlKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgIAogICAgLy8vIEByZXR1cm4gdGhlIGFjdHVhbCBwcmljZSBkaXZpc29yIG9mIGEgc2hhcmUgb3IgdG9rZW4KICAgIGZ1bmN0aW9uIGFjdHVhbFByaWNlRGl2aXNvcigpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAcmV0dXJuIFRoZSBtYXhpbWFsIGFtb3VudCBhIG1haW4gcGFydG5lciBjYW4gZnVuZCBhdCB0aGlzIG1vbWVudAogICAgLy8vIEBwYXJhbSBfbWFpblBhcnRuZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG1haW4gcGFybmVyCiAgICBmdW5jdGlvbiBmdW5kaW5nTWF4QW1vdW50KGFkZHJlc3MgX21haW5QYXJ0bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKCiAgICAvLyBNb2RpZmllciB0aGF0IGFsbG93cyBvbmx5IHRoZSBjbGllbnQgdG8gbWFuYWdlIHRoaXMgYWNjb3VudCBtYW5hZ2VyCiAgICBtb2RpZmllciBvbmx5Q2xpZW50IHtpZiAobXNnLnNlbmRlciAhPSBjbGllbnQpIHRocm93OyBfO30KCiAgICAvLyBNb2RpZmllciB0aGF0IGFsbG93cyBvbmx5IHRoZSBtYWluIHBhcnRuZXIgdG8gbWFuYWdlIHRoZSBhY3R1YWwgZnVuZGluZwogICAgbW9kaWZpZXIgb25seU1haW5QYXJ0bmVyIHtpZiAobXNnLnNlbmRlciAhPSAgRnVuZGluZ1J1bGVzWzBdLm1haW5QYXJ0bmVyKSB0aHJvdzsgXzt9CiAgICAKICAgIC8vIE1vZGlmaWVyIHRoYXQgYWxsb3dzIG9ubHkgdGhlIGNvbnRyYWN0b3IgcHJvcG9zZSBzZXQgdGhlIHRva2VuIHByaWNlIG9yIHdpdGhkcmF3CiAgICBtb2RpZmllciBvbmx5Q29udHJhY3RvciB7aWYgKHJlY2lwaWVudCA9PSAwIHx8IChtc2cuc2VuZGVyICE9IHJlY2lwaWVudCAmJiBtc2cuc2VuZGVyICE9IGNyZWF0b3IpKSB0aHJvdzsgXzt9CiAgICAKICAgIC8vIE1vZGlmaWVyIGZvciBEYW8gZnVuY3Rpb25zCiAgICBtb2RpZmllciBvbmx5RGFvIHtpZiAocmVjaXBpZW50ICE9IDApIHRocm93OyBfO30KICAgIAogICAgLy8vIEBkZXYgVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yIFRoZSBhZGRyZXNzIG9mIHRoZSBjcmVhdG9yIG9mIHRoZSBzbWFydCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfY2xpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSBjbGllbnQgb3IgRGFvCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIHJlY2lwaWVudCBvZiB0aGlzIG1hbmFnZXIKICAgIC8vZnVuY3Rpb24gVG9rZW5NYW5hZ2VyKAogICAgICAgIC8vYWRkcmVzcyBfY3JlYXRvciwKICAgICAgICAvL2FkZHJlc3MgX2NsaWVudCwKICAgICAgICAvL2FkZHJlc3MgX3JlY2lwaWVudAogICAgLy8pOwoKICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBUaGUgdG9rZW4gbmFtZSBmb3IgZGlzcGxheSBwdXJwb3NlCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUaGUgdG9rZW4gc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIC8vLyBAcGFyYW0gX3Rva2VuRGVjaW1hbHMgVGhlIHF1YW50aXR5IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIC8vLyBAcGFyYW0gX2luaXRpYWxTdXBwbHlSZWNpcGllbnQgVGhlIHJlY2lwaWVudCBvZiB0aGUgaW5pdGlhbCBzdXBwbHkgKG5vdCBtYW5kYXRvcnkpCiAgICAvLy8gQHBhcmFtIF9pbml0aWFsU3VwcGx5IFRoZSBpbml0aWFsIHN1cHBseSBvZiB0b2tlbnMgZm9yIHRoZSByZWNpcGllbnQgKG5vdCBtYW5kYXRvcnkpCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcmFibGUgVHJ1ZSBpZiBhbGxvd3MgdGhlIHRyYW5zZmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gaW5pdFRva2VuKAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgdWludDggX3Rva2VuRGVjaW1hbHMsCiAgICAgICAgYWRkcmVzcyBfaW5pdGlhbFN1cHBseVJlY2lwaWVudCwKICAgICAgICB1aW50MjU2IF9pbml0aWFsU3VwcGx5LAogICAgICAgIGJvb2wgX3RyYW5zZmVyYWJsZQogICAgICAgKTsKCiAgICAvLy8gQHBhcmFtIF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyIFRoZSBpbml0aWFsIHByaWNlIG11bHRpcGxpZXIgb2YgY29udHJhY3RvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2luZmxhdGlvblJhdGUgSWYgMCwgdGhlIGNvbnRyYWN0b3IgdG9rZW4gcHJpY2UgZG9lc24ndCBjaGFuZ2UgZHVyaW5nIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9jbG9zaW5nVGltZSBUaGUgaW5pdGlhbCBwcmljZSBhbmQgaW5mbGF0aW9uIHJhdGUgY2FuIGJlIGNoYW5nZWQgYWZ0ZXIgdGhpcyBkYXRlCiAgICBmdW5jdGlvbiBzZXRUb2tlblByaWNlUHJvcG9zYWwoICAgICAgICAKICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX2Nsb3NpbmdUaW1lCiAgICApOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNldCBhIGZ1bmRpbmcuIENhbiBiZSBwcml2YXRlIG9yIHB1YmxpYwogICAgLy8vIEBwYXJhbSBfbWFpblBhcnRuZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHNtYXJ0IGNvbnRyYWN0IHRvIG1hbmFnZSBhIHByaXZhdGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfcHVibGljQ3JlYXRpb24gVHJ1ZSBpZiBwdWJsaWMgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfaW5pdGlhbFByaWNlTXVsdGlwbGllciBQcmljZSBtdWx0aXBsaWVyIHdpdGhvdXQgY29uc2lkZXJpbmcgYW55IGluZmxhdGlvbiByYXRlCiAgICAvLy8gQHBhcmFtIF9tYXhBbW91bnRUb0Z1bmQgVGhlIG1heGltdW0gYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRnVuZGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfaW5mbGF0aW9uUmF0ZSBJZiAwLCB0aGUgdG9rZW4gcHJpY2UgZG9lc24ndCBjaGFuZ2UgZHVyaW5nIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwgKG5vdCBtYW5kYXRvcnkpCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nUnVsZXMoCiAgICAgICAgYWRkcmVzcyBfbWFpblBhcnRuZXIsCiAgICAgICAgYm9vbCBfcHVibGljQ3JlYXRpb24sIAogICAgICAgIHVpbnQgX2luaXRpYWxQcmljZU11bHRpcGxpZXIsIAogICAgICAgIHVpbnQgX21heEFtb3VudFRvRnVuZCwgCiAgICAgICAgdWludCBfbWludXRlc0Z1bmRpbmdQZXJpb2QsIAogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsCiAgICAgICAgdWludCBfcHJvcG9zYWxJRAogICAgKSBleHRlcm5hbDsKICAgIAogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gZm9yIHRoZSBjcmVhdGlvbiBvZiBzaGFyZXMgb3IgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIHJlY2lwaWVudCBhZGRyZXNzIG9mIHNoYXJlcyBvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgZnVuZGVkIGFtb3VudCAoaW4gd2VpKQogICAgLy8vIEBwYXJhbSBfc2FsZURhdGUgSW4gY2FzZSBvZiBwcmVzYWxlLCB0aGUgZGF0ZSBvZiB0aGUgcHJlc2FsZQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgY3JlYXRpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbigKICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICB1aW50IF9zYWxlRGF0ZQogICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIG1haW4gcGFydG5lciB0byBzZXQgdGhlIHN0YXJ0IHRpbWUgb2YgdGhlIGZ1bmRpbmcKICAgIC8vLyBAcGFyYW0gX3N0YXJ0VGltZSBUaGUgdW5peCBzdGFydCBkYXRlIG9mIHRoZSBmdW5kaW5nIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIG1haW4gcGFydG5lciB0byByZXdhcmQgc2hhcmVzIG9yIHRva2VucwogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQgb2Ygc2hhcmVzIG9yIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIFdlaSkgdG8gY2FsY3VsYXRlIHRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGNyZWF0ZQogICAgLy8vIEBwYXJhbSBfZGF0ZSBUaGUgdW5peCBkYXRlIHRvIGNvbnNpZGVyIGZvciB0aGUgc2hhcmUgb3IgdG9rZW4gcHJpY2UgY2FsY3VsYXRpb24KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gcmV3YXJkVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCAKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfZGF0ZQogICAgICAgICkgZXh0ZXJuYWw7CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2xvc2UgdGhlIGFjdHVhbCBmdW5kaW5nCiAgICBmdW5jdGlvbiBjbG9zZUZ1bmRpbmcoKSBpbnRlcm5hbDsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgbWFpbiBwYXJ0bmVyIHRvIHNldCB0aGUgZnVuZGluZyBmdWVsZWQKICAgIGZ1bmN0aW9uIHNldEZ1bmRpbmdGdWVsZWQoKSBleHRlcm5hbDsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzIG9yIGNvbnRyYWN0b3IgdG9rZW5zCiAgICBmdW5jdGlvbiBhYmxlVHJhbnNmZXIoKTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBkaXNhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzCiAgICBmdW5jdGlvbiBkaXNhYmxlVHJhbnNmZXIoKTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjbGllbnQgdG8gYmxvY2sgdGhlIHRyYW5zZmVyIG9mIHNoYXJlcyBmcm9tIGFuZCB0byBhIHNoYXJlIGhvbGRlcgogICAgLy8vIEBwYXJhbSBfc2hhcmVIb2xkZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHNoYXJlIGhvbGRlcgogICAgLy8vIEBwYXJhbSBfZGVhZExpbmUgV2hlbiB0aGUgYWNjb3VudCB3aWxsIGJlIHVuYmxvY2tlZAogICAgZnVuY3Rpb24gYmxvY2tUcmFuc2ZlcihhZGRyZXNzIF9zaGFyZUhvbGRlciwgdWludCBfZGVhZExpbmUpIGV4dGVybmFsOwoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX0Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb21UbygKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLCAKICAgICAgICB1aW50MjU2IF92YWx1ZQogICAgICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIHF1YW50aXR5IG9mIHNoYXJlcyBvciB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgCiAgICAgICAgYWRkcmVzcyBfdG8sIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgICAgICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24gaXRzIGJlaGFsZgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGV2ZW50IFRva2Vuc0NyZWF0ZWQoYWRkcmVzcyBpbmRleGVkIFNlbmRlciwgYWRkcmVzcyBpbmRleGVkIFRva2VuSG9sZGVyLCB1aW50IFF1YW50aXR5KTsKICAgIGV2ZW50IEZ1bmRpbmdSdWxlc1NldChhZGRyZXNzIGluZGV4ZWQgTWFpblBhcnRuZXIsIHVpbnQgaW5kZXhlZCBGdW5kaW5nUHJvcG9zYWxJZCwgdWludCBpbmRleGVkIFN0YXJ0VGltZSwgdWludCBDbG9zaW5nVGltZSk7CiAgICBldmVudCBGdW5kaW5nRnVlbGVkKHVpbnQgaW5kZXhlZCBGdW5kaW5nUHJvcG9zYWxJRCwgdWludCBGdW5kZWRBbW91bnQpOwogICAgZXZlbnQgVHJhbnNmZXJBYmxlKCk7CiAgICBldmVudCBUcmFuc2ZlckRpc2FibGUoKTsKCn0gICAgCgpjb250cmFjdCBQYXNzVG9rZW5NYW5hZ2VyIGlzIFBhc3NUb2tlbk1hbmFnZXJJbnRlcmZhY2UgewogICAgCiAgICBmdW5jdGlvbiBUb3RhbFN1cHBseSgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHk7CiAgICB9CgogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBGdW5kZWRBbW91bnQodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBmdW5kZWRBbW91bnRbX3Byb3Bvc2FsSURdOwogICAgfQoKICAgIGZ1bmN0aW9uIHByaWNlRGl2aXNvcih1aW50IF9zYWxlRGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgX2RhdGUgPSBfc2FsZURhdGU7CiAgICAgICAgCiAgICAgICAgaWYgKF9zYWxlRGF0ZSA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgX2RhdGUgPSBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWU7CiAgICAgICAgaWYgKF9zYWxlRGF0ZSA8IEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUpIF9kYXRlID0gRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZTsKCiAgICAgICAgcmV0dXJuIDEwMCArIDEwMCpGdW5kaW5nUnVsZXNbMF0uaW5mbGF0aW9uUmF0ZSooX2RhdGUgLSBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lKS8oMTAwKjM2NSBkYXlzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWN0dWFsUHJpY2VEaXZpc29yKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwcmljZURpdmlzb3Iobm93KTsKICAgIH0KCiAgICBmdW5jdGlvbiBmdW5kaW5nTWF4QW1vdW50KGFkZHJlc3MgX21haW5QYXJ0bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBub3cgPCBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lCiAgICAgICAgICAgIHx8IF9tYWluUGFydG5lciAhPSBGdW5kaW5nUnVsZXNbMF0ubWFpblBhcnRuZXIpIHsKICAgICAgICAgICAgcmV0dXJuIDA7ICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIEZ1bmRpbmdSdWxlc1swXS5tYXhBbW91bnRUb0Z1bmQ7CiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIFBhc3NUb2tlbk1hbmFnZXIoCiAgICAgICAgYWRkcmVzcyBfY3JlYXRvciwKICAgICAgICBhZGRyZXNzIF9jbGllbnQsCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50CiAgICApIHsKICAgICAgICAKICAgICAgICBpZiAoX2NyZWF0b3IgPT0gMCAKICAgICAgICAgICAgfHwgX2NsaWVudCA9PSAwIAogICAgICAgICAgICB8fCBfY2xpZW50ID09IF9yZWNpcGllbnQgCiAgICAgICAgICAgIHx8IF9jbGllbnQgPT0gYWRkcmVzcyh0aGlzKSAKICAgICAgICAgICAgfHwgX3JlY2lwaWVudCA9PSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsKCiAgICAgICAgY3JlYXRvciA9IF9jcmVhdG9yOyAKICAgICAgICBjbGllbnQgPSBfY2xpZW50OwogICAgICAgIHJlY2lwaWVudCA9IF9yZWNpcGllbnQ7CiAgICAgICAgCiAgICB9CiAgIAogICAgZnVuY3Rpb24gaW5pdFRva2VuKAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgdWludDggX3Rva2VuRGVjaW1hbHMsCiAgICAgICAgYWRkcmVzcyBfaW5pdGlhbFN1cHBseVJlY2lwaWVudCwKICAgICAgICB1aW50MjU2IF9pbml0aWFsU3VwcGx5LAogICAgICAgIGJvb2wgX3RyYW5zZmVyYWJsZSkgewogICAgICAgICAgIAogICAgICAgIGlmIChfaW5pdGlhbFN1cHBseVJlY2lwaWVudCA9PSBhZGRyZXNzKHRoaXMpCiAgICAgICAgICAgIHx8IGRlY2ltYWxzICE9IDAKICAgICAgICAgICAgfHwgbXNnLnNlbmRlciAhPSBjcmVhdG9yCiAgICAgICAgICAgIHx8IHRvdGFsU3VwcGx5ICE9IDApIHRocm93OwogICAgICAgICAgICAKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7CiAgICAgICAgZGVjaW1hbHMgPSBfdG9rZW5EZWNpbWFsczsKICAgICAgICAgIAogICAgICAgIGlmIChfdHJhbnNmZXJhYmxlKSB7CiAgICAgICAgICAgIHRyYW5zZmVyYWJsZSA9IHRydWU7CiAgICAgICAgICAgIFRyYW5zZmVyQWJsZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyYW5zZmVyYWJsZSA9IGZhbHNlOwogICAgICAgICAgICBUcmFuc2ZlckRpc2FibGUoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYmFsYW5jZXNbX2luaXRpYWxTdXBwbHlSZWNpcGllbnRdID0gX2luaXRpYWxTdXBwbHk7IAogICAgICAgIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHk7CiAgICAgICAgVG9rZW5zQ3JlYXRlZChtc2cuc2VuZGVyLCBfaW5pdGlhbFN1cHBseVJlY2lwaWVudCwgX2luaXRpYWxTdXBwbHkpOwogICAgICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRUb2tlblByaWNlUHJvcG9zYWwoICAgICAgICAKICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX2Nsb3NpbmdUaW1lCiAgICApIG9ubHlDb250cmFjdG9yIHsKICAgICAgICAKICAgICAgICBpZiAoX2Nsb3NpbmdUaW1lIDwgbm93IAogICAgICAgICAgICB8fCBub3cgPCBGdW5kaW5nUnVsZXNbMV0uY2xvc2luZ1RpbWUpIHRocm93OwogICAgICAgIAogICAgICAgIEZ1bmRpbmdSdWxlc1sxXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gX2luaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgRnVuZGluZ1J1bGVzWzFdLmluZmxhdGlvblJhdGUgPSBfaW5mbGF0aW9uUmF0ZTsKICAgICAgICBGdW5kaW5nUnVsZXNbMV0uc3RhcnRUaW1lID0gbm93OwogICAgICAgIEZ1bmRpbmdSdWxlc1sxXS5jbG9zaW5nVGltZSA9IF9jbG9zaW5nVGltZTsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1J1bGVzKAogICAgICAgIGFkZHJlc3MgX21haW5QYXJ0bmVyLAogICAgICAgIGJvb2wgX3B1YmxpY0NyZWF0aW9uLCAKICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLAogICAgICAgIHVpbnQgX21heEFtb3VudFRvRnVuZCwgCiAgICAgICAgdWludCBfbWludXRlc0Z1bmRpbmdQZXJpb2QsIAogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsCiAgICAgICAgdWludCBfcHJvcG9zYWxJRAogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHsKCiAgICAgICAgaWYgKG5vdyA8IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBfbWFpblBhcnRuZXIgPT0gYWRkcmVzcyh0aGlzKQogICAgICAgICAgICB8fCBfbWFpblBhcnRuZXIgPT0gY2xpZW50CiAgICAgICAgICAgIHx8ICghX3B1YmxpY0NyZWF0aW9uICYmIF9tYWluUGFydG5lciA9PSAwKQogICAgICAgICAgICB8fCAoX3B1YmxpY0NyZWF0aW9uICYmIF9tYWluUGFydG5lciAhPSAwKQogICAgICAgICAgICB8fCAocmVjaXBpZW50ID09IDAgJiYgX2luaXRpYWxQcmljZU11bHRpcGxpZXIgPT0gMCkKICAgICAgICAgICAgfHwgKHJlY2lwaWVudCAhPSAwIAogICAgICAgICAgICAgICAgJiYgKEZ1bmRpbmdSdWxlc1sxXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID09IDAKICAgICAgICAgICAgICAgICAgICB8fCBfaW5mbGF0aW9uUmF0ZSA8IEZ1bmRpbmdSdWxlc1sxXS5pbmZsYXRpb25SYXRlCiAgICAgICAgICAgICAgICAgICAgfHwgbm93IDwgRnVuZGluZ1J1bGVzWzFdLnN0YXJ0VGltZQogICAgICAgICAgICAgICAgICAgIHx8IEZ1bmRpbmdSdWxlc1sxXS5jbG9zaW5nVGltZSA8IG5vdyArIChfbWludXRlc0Z1bmRpbmdQZXJpb2QgKiAxIG1pbnV0ZXMpKSkKICAgICAgICAgICAgfHwgX21heEFtb3VudFRvRnVuZCA9PSAwCiAgICAgICAgICAgIHx8IF9taW51dGVzRnVuZGluZ1BlcmlvZCA9PSAwCiAgICAgICAgICAgICkgdGhyb3c7CgogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUgPSBub3c7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLmNsb3NpbmdUaW1lID0gbm93ICsgX21pbnV0ZXNGdW5kaW5nUGVyaW9kICogMSBtaW51dGVzOwogICAgICAgICAgICAKICAgICAgICBGdW5kaW5nUnVsZXNbMF0ubWFpblBhcnRuZXIgPSBfbWFpblBhcnRuZXI7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnB1YmxpY0NyZWF0aW9uID0gX3B1YmxpY0NyZWF0aW9uOwogICAgICAgIAogICAgICAgIGlmIChyZWNpcGllbnQgPT0gMCkgRnVuZGluZ1J1bGVzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPSBfaW5pdGlhbFByaWNlTXVsdGlwbGllcjsKICAgICAgICBlbHNlIEZ1bmRpbmdSdWxlc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gRnVuZGluZ1J1bGVzWzFdLmluaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgCiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAwKSBGdW5kaW5nUnVsZXNbMF0uaW5mbGF0aW9uUmF0ZSA9IF9pbmZsYXRpb25SYXRlOwogICAgICAgIGVsc2UgRnVuZGluZ1J1bGVzWzBdLmluZmxhdGlvblJhdGUgPSBGdW5kaW5nUnVsZXNbMV0uaW5mbGF0aW9uUmF0ZTsKICAgICAgICAKICAgICAgICBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50ID0gMDsKICAgICAgICBGdW5kaW5nUnVsZXNbMF0ubWF4QW1vdW50VG9GdW5kID0gX21heEFtb3VudFRvRnVuZDsKCiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnByb3Bvc2FsSUQgPSBfcHJvcG9zYWxJRDsKCiAgICAgICAgRnVuZGluZ1J1bGVzU2V0KF9tYWluUGFydG5lciwgX3Byb3Bvc2FsSUQsIEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUsIEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSk7CiAgICAgICAgICAgIAogICAgfSAKICAgIAogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCAKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfc2FsZURhdGUKICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIGlmIChub3cgPiBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWUKICAgICAgICAgICAgfHwgbm93IDwgRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZQogICAgICAgICAgICB8fF9zYWxlRGF0ZSA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBfc2FsZURhdGUgPCBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lCiAgICAgICAgICAgIHx8IEZ1bmRpbmdSdWxlc1swXS5mdW5kZWRBbW91bnQgKyBfYW1vdW50ID4gRnVuZGluZ1J1bGVzWzBdLm1heEFtb3VudFRvRnVuZCkgcmV0dXJuOwoKICAgICAgICB1aW50IF9hID0gX2Ftb3VudCpGdW5kaW5nUnVsZXNbMF0uaW5pdGlhbFByaWNlTXVsdGlwbGllcjsKICAgICAgICB1aW50IF9tdWx0aXBsaWVyID0gMTAwKl9hOwogICAgICAgIHVpbnQgX3F1YW50aXR5ID0gX211bHRpcGxpZXIvcHJpY2VEaXZpc29yKF9zYWxlRGF0ZSk7CiAgICAgICAgaWYgKF9hL19hbW91bnQgIT0gRnVuZGluZ1J1bGVzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXIKICAgICAgICAgICAgfHwgX211bHRpcGxpZXIvMTAwICE9IF9hCiAgICAgICAgICAgIHx8IHRvdGFsU3VwcGx5ICsgX3F1YW50aXR5IDw9IHRvdGFsU3VwcGx5IAogICAgICAgICAgICB8fCB0b3RhbFN1cHBseSArIF9xdWFudGl0eSA8PSBfcXVhbnRpdHkpIHJldHVybjsKCiAgICAgICAgYmFsYW5jZXNbX3JlY2lwaWVudF0gKz0gX3F1YW50aXR5OwogICAgICAgIHRvdGFsU3VwcGx5ICs9IF9xdWFudGl0eTsKICAgICAgICBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50ICs9IF9hbW91bnQ7CgogICAgICAgIFRva2Vuc0NyZWF0ZWQobXNnLnNlbmRlciwgX3JlY2lwaWVudCwgX3F1YW50aXR5KTsKICAgICAgICAKICAgICAgICBpZiAoRnVuZGluZ1J1bGVzWzBdLmZ1bmRlZEFtb3VudCA9PSBGdW5kaW5nUnVsZXNbMF0ubWF4QW1vdW50VG9GdW5kKSBjbG9zZUZ1bmRpbmcoKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgdGhyb3c7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJld2FyZFRva2VuKAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfYW1vdW50LAogICAgICAgIHVpbnQgX2RhdGUKICAgICAgICApIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CgogICAgICAgIHVpbnQgX3NhbGVEYXRlOwogICAgICAgIGlmIChfZGF0ZSA9PSAwKSBfc2FsZURhdGUgPSBub3c7IGVsc2UgX3NhbGVEYXRlID0gX2RhdGU7CgogICAgICAgIGlmICghY3JlYXRlVG9rZW4oX3JlY2lwaWVudCwgX2Ftb3VudCwgX3NhbGVEYXRlKSkgdGhyb3c7CgogICAgfQoKICAgIGZ1bmN0aW9uIGNsb3NlRnVuZGluZygpIGludGVybmFsIHsKICAgICAgICBpZiAocmVjaXBpZW50ID09IDApIGZ1bmRlZEFtb3VudFtGdW5kaW5nUnVsZXNbMF0ucHJvcG9zYWxJRF0gPSBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50OwogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSA9IG5vdzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ0Z1ZWxlZCgpIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgdGhyb3c7CiAgICAgICAgY2xvc2VGdW5kaW5nKCk7CiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAwKSBGdW5kaW5nRnVlbGVkKEZ1bmRpbmdSdWxlc1swXS5wcm9wb3NhbElELCBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWJsZVRyYW5zZmVyKCkgb25seUNsaWVudCB7CiAgICAgICAgaWYgKCF0cmFuc2ZlcmFibGUpIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgVHJhbnNmZXJBYmxlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcigpIG9ubHlDbGllbnQgewogICAgICAgIGlmICh0cmFuc2ZlcmFibGUpIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIFRyYW5zZmVyRGlzYWJsZSgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmxvY2tUcmFuc2ZlcihhZGRyZXNzIF9zaGFyZUhvbGRlciwgdWludCBfZGVhZExpbmUpIGV4dGVybmFsIG9ubHlDbGllbnQgb25seURhbyB7CiAgICAgICAgaWYgKF9kZWFkTGluZSA+IGJsb2NrZWREZWFkTGluZVtfc2hhcmVIb2xkZXJdKSB7CiAgICAgICAgICAgIGJsb2NrZWREZWFkTGluZVtfc2hhcmVIb2xkZXJdID0gX2RlYWRMaW5lOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tVG8oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywgCiAgICAgICAgdWludDI1NiBfdmFsdWUKICAgICAgICApIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsgIAoKICAgICAgICBpZiAodHJhbnNmZXJhYmxlCiAgICAgICAgICAgICYmIG5vdyA+IGJsb2NrZWREZWFkTGluZVtfZnJvbV0KICAgICAgICAgICAgJiYgbm93ID4gYmxvY2tlZERlYWRMaW5lW190b10KICAgICAgICAgICAgJiYgX3RvICE9IGFkZHJlc3ModGhpcykKICAgICAgICAgICAgJiYgYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZQogICAgICAgICAgICAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXQogICAgICAgICAgICAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID49IF92YWx1ZQogICAgICAgICkgewogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHsgIAogICAgICAgIGlmICghdHJhbnNmZXJGcm9tVG8obXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpKSB0aHJvdzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgCiAgICAgICAgYWRkcmVzcyBfdG8sIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgICAgICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsgCiAgICAgICAgCiAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX3ZhbHVlCiAgICAgICAgICAgIHx8ICF0cmFuc2ZlckZyb21UbyhfZnJvbSwgX3RvLCBfdmFsdWUpKSB0aHJvdzsKICAgICAgICAgICAgCiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwoKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0gICAgCiAgCgpwcmFnbWEgc29saWRpdHkgXjAuNC4yOwoKLyoKICoKICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uCiAqCiAqIFRoZSBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IGlzIHVzZWQgZm9yIHRoZSBtYW5hZ2VtZW50IG9mIGFjY291bnRzIGFuZCB0b2tlbnMuCiAqIEFsbG93cyB0byByZWNlaXZlIG9yIHdpdGhkcmF3IGV0aGVycyBhbmQgdG8gYnV5IERhbyBzaGFyZXMuCiAqIFRoZSBjb250cmFjdCBkZXJpdmVzIHRvIHRoZSBUb2tlbiBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IGZvciB0aGUgbWFuYWdlbWVudCBvZiB0b2tlbnMuCiAqCiAqIFJlY2lwaWVudCBpcyAwIGZvciB0aGUgRGFvIGFjY291bnQgbWFuYWdlciBhbmQgdGhlIGFkZHJlc3Mgb2YKICogY29udHJhY3RvcidzIHJlY2lwaWVudCBmb3IgdGhlIGNvbnRyYWN0b3JzJ3MgbWFoYWdlcnMuCiAqCiovCgovLy8gQHRpdGxlIE1hbmFnZXIgc21hcnQgY29udHJhY3Qgb2YgdGhlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbgpjb250cmFjdCBQYXNzTWFuYWdlckludGVyZmFjZSBpcyBQYXNzVG9rZW5NYW5hZ2VySW50ZXJmYWNlIHsKCiAgICBzdHJ1Y3QgcHJvcG9zYWwgewogICAgICAgIC8vIEFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwKICAgICAgICB1aW50IGFtb3VudDsKICAgICAgICAvLyBBIGRlc2NyaXB0aW9uIG9mIHRoZSBwcm9wb3NhbAogICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbjsKICAgICAgICAvLyBUaGUgaGFzaCBvZiB0aGUgcHJvcG9zYWwncyBkb2N1bWVudAogICAgICAgIGJ5dGVzMzIgaGFzaE9mVGhlRG9jdW1lbnQ7CiAgICAgICAgLy8gQSB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIGRhdGUgd2hlbiB0aGUgcHJvcG9zYWwgd2FzIGNyZWF0ZWQKICAgICAgICB1aW50IGRhdGVPZlByb3Bvc2FsOwogICAgICAgIC8vIFRoZSBzdW0gYW1vdW50IChpbiB3ZWkpIG9yZGVyZWQgZm9yIHRoaXMgcHJvcG9zYWwgCiAgICAgICAgdWludCBvcmRlckFtb3VudDsKICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCBvcmRlciBmb3IgdGhlIGFwcHJvdmVkIHByb3Bvc2FsCiAgICAgICAgdWludCBkYXRlT2ZPcmRlcjsKICAgIH0KICAgICAgICAKICAgIC8vIFByb3Bvc2FscyB0byB3b3JrIGZvciB0aGUgY2xpZW50CiAgICBwcm9wb3NhbFtdIHB1YmxpYyBwcm9wb3NhbHM7CiAgICAKICAgIC8vLyBAZGV2IFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbgogICAgLy8vIEBwYXJhbSBfY3JlYXRvciBUaGUgYWRkcmVzcyBvZiB0aGUgY3JlYXRvcgogICAgLy8vIEBwYXJhbSBfY2xpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSBEYW8KICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LiAwIGZvciB0aGUgRGFvCiAgICAvL2Z1bmN0aW9uIFBhc3NNYW5hZ2VyKAogICAgICAgIC8vYWRkcmVzcyBfY3JlYXRvciwKICAgICAgICAvL2FkZHJlc3MgX2NsaWVudCwKICAgICAgICAvL2FkZHJlc3MgX3JlY2lwaWVudAogICAgLy8pIFBhc3NUb2tlbk1hbmFnZXIoCiAgICAgICAgLy9fY3JlYXRvciwKICAgICAgICAvL19jbGllbnQsCiAgICAgICAgLy9fcmVjaXBpZW50KTsKCiAgICAvLy8gQG5vdGljZSBGYWxsYmFjayBmdW5jdGlvbiB0byBhbGxvdyBzZW5kaW5nIGV0aGVycyB0byB0aGlzIHNtYXJ0IGNvbnRyYWN0CiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlOwogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byB1cGRhdGUgdGhlIHJlY2lwZW50IGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX25ld1JlY2lwaWVudCBUaGUgYWRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIGZ1bmN0aW9uIHVwZGF0ZVJlY2lwaWVudChhZGRyZXNzIF9uZXdSZWNpcGllbnQpOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGJ1eSBEYW8gc2hhcmVzIGFjY29yZGluZyB0byB0aGUgZnVuZGluZyBydWxlcyAKICAgIC8vLyB3aXRoIGBtc2cuc2VuZGVyYCBhcyB0aGUgYmVuZWZpY2lhcnkKICAgIGZ1bmN0aW9uIGJ1eVNoYXJlcygpIHBheWFibGU7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGJ1eSBEYW8gc2hhcmVzIGFjY29yZGluZyB0byB0aGUgZnVuZGluZyBydWxlcyAKICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgYmVuZWZpY2lhcnkgb2YgdGhlIGNyZWF0ZWQgc2hhcmVzCiAgICBmdW5jdGlvbiBidXlTaGFyZXNGb3IoYWRkcmVzcyBfcmVjaXBpZW50KSBwYXlhYmxlOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIG1ha2UgYSBwcm9wb3NhbCB0byB3b3JrIGZvciB0aGUgY2xpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX2Rlc2NyaXB0aW9uIFN0cmluZyBkZXNjcmliaW5nIHRoZSBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfaGFzaE9mVGhlRG9jdW1lbnQgVGhlIGhhc2ggb2YgdGhlIHByb3Bvc2FsIGRvY3VtZW50CiAgICAvLy8gQHJldHVybiBUaGUgaW5kZXggb2YgdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwKICAgIGZ1bmN0aW9uIG5ld1Byb3Bvc2FsKAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLCAKICAgICAgICBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudAogICAgKSByZXR1cm5zICh1aW50KTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY2xpZW50IHRvIG9yZGVyIGFjY29yZGluZyB0byB0aGUgY29udHJhY3RvciBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBvcmRlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgb3JkZXIgd2FzIG1hZGUgb3Igbm90CiAgICBmdW5jdGlvbiBvcmRlcigKICAgICAgICB1aW50IF9wcm9wb3NhbElELAogICAgICAgIHVpbnQgX2Ftb3VudAogICAgKSBleHRlcm5hbCByZXR1cm5zIChib29sKSA7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIGNsaWVudCB0byBzZW5kIGV0aGVycyBmcm9tIHRoZSBEYW8gbWFuYWdlcgogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBhZGRyZXNzIHRvIHNlbmQgdG8KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIHRvIHNlbmQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gc2VuZFRvKAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfYW1vdW50CiAgICApIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGFsbG93IGNvbnRyYWN0b3JzIHRvIHdpdGhkcmF3IGV0aGVycwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkgdG8gd2l0aGRyYXcKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgX2Ftb3VudCk7CiAgICAKICAgIGV2ZW50IFByb3Bvc2FsQWRkZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgQW1vdW50LCBzdHJpbmcgRGVzY3JpcHRpb24pOwogICAgZXZlbnQgT3JkZXIodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgQW1vdW50KTsKICAgIGV2ZW50IFdpdGhkYXdhbChhZGRyZXNzIGluZGV4ZWQgUmVjaXBpZW50LCB1aW50IEFtb3VudCk7Cgp9ICAgIAoKY29udHJhY3QgUGFzc01hbmFnZXIgaXMgUGFzc01hbmFnZXJJbnRlcmZhY2UsIFBhc3NUb2tlbk1hbmFnZXIgewoKICAgIGZ1bmN0aW9uIFBhc3NNYW5hZ2VyKAogICAgICAgIGFkZHJlc3MgX2NyZWF0b3IsCiAgICAgICAgYWRkcmVzcyBfY2xpZW50LAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudAogICAgKSBQYXNzVG9rZW5NYW5hZ2VyKAogICAgICAgIF9jcmVhdG9yLAogICAgICAgIF9jbGllbnQsCiAgICAgICAgX3JlY2lwaWVudAogICAgICAgICkgewogICAgICAgIHByb3Bvc2Fscy5sZW5ndGggPSAxOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHBheWFibGUge30KCiAgICBmdW5jdGlvbiB1cGRhdGVSZWNpcGllbnQoYWRkcmVzcyBfbmV3UmVjaXBpZW50KSBvbmx5Q29udHJhY3RvciB7CgogICAgICAgIGlmIChfbmV3UmVjaXBpZW50ID09IDAgCiAgICAgICAgICAgIHx8IF9uZXdSZWNpcGllbnQgPT0gY2xpZW50KSB0aHJvdzsKCiAgICAgICAgcmVjaXBpZW50ID0gX25ld1JlY2lwaWVudDsKICAgIH0gCgogICAgZnVuY3Rpb24gYnV5U2hhcmVzKCkgcGF5YWJsZSB7CiAgICAgICAgYnV5U2hhcmVzRm9yKG1zZy5zZW5kZXIpOwogICAgfSAKICAgIAogICAgZnVuY3Rpb24gYnV5U2hhcmVzRm9yKGFkZHJlc3MgX3JlY2lwaWVudCkgcGF5YWJsZSBvbmx5RGFvIHsKICAgICAgICAKICAgICAgICBpZiAoIUZ1bmRpbmdSdWxlc1swXS5wdWJsaWNDcmVhdGlvbiAKICAgICAgICAgICAgfHwgIWNyZWF0ZVRva2VuKF9yZWNpcGllbnQsIG1zZy52YWx1ZSwgbm93KSkgdGhyb3c7CgogICAgfQogICAKICAgIGZ1bmN0aW9uIG5ld1Byb3Bvc2FsKAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLCAKICAgICAgICBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudAogICAgKSBvbmx5Q29udHJhY3RvciByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQgPSBwcm9wb3NhbHMubGVuZ3RoKys7CiAgICAgICAgcHJvcG9zYWwgYyA9IHByb3Bvc2Fsc1tfcHJvcG9zYWxJRF07CgogICAgICAgIGMuYW1vdW50ID0gX2Ftb3VudDsKICAgICAgICBjLmRlc2NyaXB0aW9uID0gX2Rlc2NyaXB0aW9uOwogICAgICAgIGMuaGFzaE9mVGhlRG9jdW1lbnQgPSBfaGFzaE9mVGhlRG9jdW1lbnQ7IAogICAgICAgIGMuZGF0ZU9mUHJvcG9zYWwgPSBub3c7CiAgICAgICAgCiAgICAgICAgUHJvcG9zYWxBZGRlZChfcHJvcG9zYWxJRCwgYy5hbW91bnQsIGMuZGVzY3JpcHRpb24pOwogICAgICAgIAogICAgICAgIHJldHVybiBfcHJvcG9zYWxJRDsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JkZXIoCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwKICAgICAgICB1aW50IF9vcmRlckFtb3VudAogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHJldHVybnMgKGJvb2wpIHsKICAgIAogICAgICAgIHByb3Bvc2FsIGMgPSBwcm9wb3NhbHNbX3Byb3Bvc2FsSURdOwogICAgICAgIAogICAgICAgIHVpbnQgX3N1bSA9IGMub3JkZXJBbW91bnQgKyBfb3JkZXJBbW91bnQ7CiAgICAgICAgaWYgKF9zdW0gPiBjLmFtb3VudAogICAgICAgICAgICB8fCBfc3VtIDwgYy5vcmRlckFtb3VudAogICAgICAgICAgICB8fCBfc3VtIDwgX29yZGVyQW1vdW50KSByZXR1cm47IAoKICAgICAgICBjLm9yZGVyQW1vdW50ID0gX3N1bTsKICAgICAgICBjLmRhdGVPZk9yZGVyID0gbm93OwogICAgICAgIAogICAgICAgIE9yZGVyKF9wcm9wb3NhbElELCBfb3JkZXJBbW91bnQpOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZW5kVG8oCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LAogICAgICAgIHVpbnQgX2Ftb3VudAogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IG9ubHlEYW8gcmV0dXJucyAoYm9vbCkgewogICAgCiAgICAgICAgaWYgKF9yZWNpcGllbnQuc2VuZChfYW1vdW50KSkgcmV0dXJuIHRydWU7CiAgICAgICAgZWxzZSByZXR1cm4gZmFsc2U7CgogICAgfQogICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgX2Ftb3VudCkgb25seUNvbnRyYWN0b3IgewogICAgICAgIGlmICghcmVjaXBpZW50LnNlbmQoX2Ftb3VudCkpIHRocm93OwogICAgICAgIFdpdGhkYXdhbChyZWNpcGllbnQsIF9hbW91bnQpOwogICAgfQogICAgCn0gICAgCgpjb250cmFjdCBQYXNzTWFuYWdlckNyZWF0b3IgewogICAgZXZlbnQgTmV3UGFzc01hbmFnZXIoYWRkcmVzcyBDcmVhdG9yLCBhZGRyZXNzIENsaWVudCwgYWRkcmVzcyBSZWNpcGllbnQsIGFkZHJlc3MgUGFzc01hbmFnZXIpOwogICAgZnVuY3Rpb24gY3JlYXRlTWFuYWdlcigKICAgICAgICBhZGRyZXNzIF9jbGllbnQsCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50CiAgICAgICAgKSByZXR1cm5zIChQYXNzTWFuYWdlcikgewogICAgICAgIFBhc3NNYW5hZ2VyIF9wYXNzTWFuYWdlciA9IG5ldyBQYXNzTWFuYWdlcigKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2NsaWVudCwKICAgICAgICAgICAgX3JlY2lwaWVudAogICAgICAgICk7CiAgICAgICAgTmV3UGFzc01hbmFnZXIobXNnLnNlbmRlciwgX2NsaWVudCwgX3JlY2lwaWVudCwgX3Bhc3NNYW5hZ2VyKTsKICAgICAgICByZXR1cm4gX3Bhc3NNYW5hZ2VyOwogICAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4yOwoKLyoKICoKICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgdGhlIERBTy4KICoKICogU21hcnQgY29udHJhY3QgdXNlZCBmb3IgdGhlIGZ1bmRpbmcgb2YgUGFzcyBEYW8uCiAqCiovCgovLy8gQHRpdGxlIEZ1bmRpbmcgc21hcnQgY29udHJhY3QgZm9yIHRoZSBQYXNzIERlY2VudHJhbGl6ZWQgQXV0b25vbW91cyBPcmdhbmlzYXRpb24KY29udHJhY3QgUGFzc0Z1bmRpbmdJbnRlcmZhY2UgewoKICAgIHN0cnVjdCBQYXJ0bmVyIHsKICAgICAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgcGFydG5lcgogICAgICAgIGFkZHJlc3MgcGFydG5lckFkZHJlc3M7IAogICAgICAgIC8vIFRoZSBhbW91bnQgKGluIHdlaSkgdGhhdCB0aGUgcGFydG5lciB3aXNoIHRvIGZ1bmQKICAgICAgICB1aW50IHByZXNhbGVBbW91bnQ7CiAgICAgICAgLy8gVGhlIHVuaXggdGltZXN0YW1wIGRlbm90aW5nIHRoZSBhdmVyYWdlIGRhdGUgb2YgdGhlIHByZXNhbGUgb2YgdGhlIHBhcnRuZXIgCiAgICAgICAgdWludCBwcmVzYWxlRGF0ZTsKICAgICAgICAvLyBUaGUgZnVuZGluZyBhbW91bnQgKGluIHdlaSkgYWNjb3JkaW5nIHRvIHRoZSBzZXQgbGltaXRzCiAgICAgICAgdWludCBmdW5kaW5nQW1vdW50TGltaXQ7CiAgICAgICAgLy8gVGhlIGFtb3VudCAoaW4gd2VpKSB0aGF0IHRoZSBwYXJ0bmVyIGZ1bmRlZCB0byB0aGUgRGFvCiAgICAgICAgdWludCBmdW5kZWRBbW91bnQ7CiAgICAgICAgLy8gVHJ1ZSBpZiB0aGUgcGFydG5lciBjYW4gZnVuZCB0aGUgZGFvCiAgICAgICAgYm9vbCB2YWxpZDsKICAgIH0KCiAgICAvLyBBZGRyZXNzIG9mIHRoZSBjcmVhdG9yIG9mIHRoaXMgY29udHJhY3QKICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3I7CiAgICAvLyBUaGUgbWFuYWdlciBzbWFydCBjb250cmFjdCB0byBmdW5kCiAgICBQYXNzTWFuYWdlciBwdWJsaWMgRGFvTWFuYWdlcjsKICAgIC8vIFRydWUgaWYgY29udHJhY3RvciB0b2tlbiBjcmVhdGlvbgogICAgYm9vbCB0b2tlbkNyZWF0aW9uOyAgICAgICAgICAgIAogICAgLy8gVGhlIG1hbmFnZXIgc21hcnQgY29udHJhY3QgZm9yIHRoZSByZXdhcmQgb2YgY29udHJhY3RvciB0b2tlbnMKICAgIFBhc3NNYW5hZ2VyIHB1YmxpYyBjb250cmFjdG9yTWFuYWdlcjsKICAgIC8vIE1pbmltdW0gYW1vdW50IChpbiB3ZWkpIHRvIGZ1bmQKICAgIHVpbnQgcHVibGljIG1pbkZ1bmRpbmdBbW91bnQ7CiAgICAvLyBNaW5pbXVtIGFtb3VudCAoaW4gd2VpKSB0aGF0IHBhcnRuZXJzIGNhbiBzZW5kIHRvIHRoaXMgc21hcnQgY29udHJhY3QKICAgIHVpbnQgcHVibGljIG1pblByZXNhbGVBbW91bnQ7CiAgICAvLyBNYXhpbXVtIGFtb3VudCAoaW4gd2VpKSB0aGF0IHBhcnRuZXJzIGNhbiBzZW5kIHRvIHRoaXMgc21hcnQgY29udHJhY3QKICAgIHVpbnQgcHVibGljIG1heFByZXNhbGVBbW91bnQ7CiAgICAvLyBUaGUgdW5peCBzdGFydCB0aW1lIG9mIHRoZSBwcmVzYWxlCiAgICB1aW50IHB1YmxpYyBzdGFydFRpbWU7CiAgICAvLyBUaGUgdW5peCBjbG9zaW5nIHRpbWUgb2YgdGhlIGZ1bmRpbmcKICAgIHVpbnQgcHVibGljIGNsb3NpbmdUaW1lOwogICAgLy8vIFRoZSBhbW91bnQgKGluIHdlaSkgYmVsb3cgdGhpcyBsaW1pdCBjYW4gZnVuZCB0aGUgZGFvCiAgICB1aW50IG1pbkFtb3VudExpbWl0OwogICAgLy8vIE1heGltdW0gYW1vdW50IChpbiB3ZWkpIGEgcGFydG5lciBjYW4gZnVuZAogICAgdWludCBtYXhBbW91bnRMaW1pdDsgCiAgICAvLy8gVGhlIHBhcnRuZXIgY2FuIGZ1bmQgYmVsb3cgdGhlIG1pbmltdW0gYW1vdW50IGxpbWl0IG9yIGEgc2V0IHBlcmNlbnRhZ2Ugb2YgaGlzIGV0aGVyIGJhbGFuY2UgCiAgICB1aW50IGRpdmlzb3JCYWxhbmNlTGltaXQ7CiAgICAvLy8gVGhlIHBhcnRuZXIgY2FuIGZ1bmQgYmVsb3cgdGhlIG1pbmltdW0gYW1vdW50IGxpbWl0IG9yIGEgc2V0IHBlcmNlbnRhZ2Ugb2YgaGlzIHNoYXJlcyBiYWxhbmNlIGluIHRoZSBEYW8KICAgIHVpbnQgbXVsdGlwbGllclNoYXJlc0xpbWl0OwogICAgLy8vIFRoZSBwYXJ0bmVyIGNhbiBmdW5kIGJlbG93IHRoZSBtaW5pbXVtIGFtb3VudCBsaW1pdCBvciBhIHNldCBwZXJjZW50YWdlIG9mIGhpcyBzaGFyZXMgYmFsYW5jZSBpbiB0aGUgRGFvIAogICAgdWludCBkaXZpc29yU2hhcmVzTGltaXQ7CiAgICAvLyBUcnVlIGlmIHRoZSBhbW91bnQgYW5kIGRpdmlzb3IgYmFsYW5jZSBsaW1pdHMgZm9yIHRoZSBmdW5kaW5nIGFyZSBzZXQKICAgIGJvb2wgcHVibGljIGxpbWl0U2V0OwogICAgLy8gVHJ1ZSBpZiBhbGwgdGhlIHBhcnRuZXJzIGFyZSBzZXQgYnkgdGhlIGNyZWF0b3IgYW5kIHRoZSBmdW5kaW5nIGNhbiBiZSBjb21wbGV0ZWQgCiAgICBib29sIHB1YmxpYyBhbGxTZXQ7CiAgICAvLyBBcnJheSBvZiBwYXJ0bmVycyB3aG8gd2lzaCB0byBmdW5kIHRoZSBkYW8KICAgIFBhcnRuZXJbXSBwdWJsaWMgcGFydG5lcnM7CiAgICAvLyBNYXAgd2l0aCB0aGUgaW5kZXhlcyBvZiB0aGUgcGFydG5lcnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHBhcnRuZXJJRDsgCiAgICAvLyBUaGUgdG90YWwgZnVuZGVkIGFtb3VudCAoaW4gd2VpKQogICAgdWludCBwdWJsaWMgdG90YWxGdW5kZWQ7IAogICAgLy8gVGhlIGNhbGN1bGF0ZWQgc3VtIG9mIGZ1bmRpbmcgYW1vdXQgbGltaXRzIChpbiB3ZWkpIGFjY29yZGluZyB0byB0aGUgc2V0IGxpbWl0cwogICAgdWludCBzdW1PZkZ1bmRpbmdBbW91bnRMaW1pdHM7CiAgICAKICAgIC8vIFRvIGFsbG93IHRoZSBjcmVhdG9yIHRvIHBhdXNlIGR1cmluZyB0aGUgcHJlc2FsZQogICAgdWludCBwdWJsaWMgcGF1c2VDbG9zaW5nVGltZTsKICAgIC8vIFRvIGFsbG93IHRoZSBjcmVhdG9yIHRvIGFib3J0IHRoZSBmdW5kaW5nIGJlZm9yZSB0aGUgY2xvc2luZyB0aW1lCiAgICBib29sIElzZnVuZGluZ0Fib3J0ZWQ7CiAgICAKICAgIC8vIFRvIGFsbG93IHRoZSBzZXQgb2YgcGFydG5lcnMgaW4gc2V2ZXJhbCB0aW1lcwogICAgdWludCBzZXRGcm9tUGFydG5lcjsKICAgIC8vIFRvIGFsbG93IHRoZSByZWZ1bmQgZm9yIHBhcnRuZXJzIGluIHNldmVyYWwgdGltZXMKICAgIHVpbnQgcmVmdW5kRnJvbVBhcnRuZXI7CgogICAgLy8gVGhlIG1hbmFnZXIgb2YgdGhpcyBmdW5kaW5nIGlzIHRoZSBjcmVhdG9yIG9mIHRoaXMgY29udHJhY3QKICAgIG1vZGlmaWVyIG9ubHlDcmVhdG9yIHtpZiAobXNnLnNlbmRlciAhPSBjcmVhdG9yKSB0aHJvdzsgXyA7fQoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yIFRoZSBjcmVhdG9yIG9mIHRoZSBzbWFydCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfRGFvTWFuYWdlciBUaGUgRGFvIG1hbmFnZXIgc21hcnQgY29udHJhY3QKICAgIC8vLyBmb3IgdGhlIHJld2FyZCBvZiB0b2tlbnMgKG5vdCBtYW5kYXRvcnkpCiAgICAvLy8gQHBhcmFtIF9taW5BbW91bnQgTWluaW11bSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcgdG8gYmUgZnVlbGVkIAogICAgLy8vIEBwYXJhbSBfc3RhcnRUaW1lIFRoZSB1bml4IHN0YXJ0IHRpbWUgb2YgdGhlIHByZXNhbGUKICAgIC8vLyBAcGFyYW0gX2Nsb3NpbmdUaW1lIFRoZSB1bml4IGNsb3NpbmcgdGltZSBvZiB0aGUgZnVuZGluZwogICAgLy9mdW5jdGlvbiBQYXNzRnVuZGluZyAoCiAgICAgICAgLy9hZGRyZXNzIF9jcmVhdG9yLAogICAgICAgIC8vYWRkcmVzcyBfRGFvTWFuYWdlciwKICAgICAgICAvL3VpbnQgX21pbkFtb3VudCwKICAgICAgICAvL3VpbnQgX3N0YXJ0VGltZSwKICAgICAgICAvL3VpbnQgX2Nsb3NpbmdUaW1lCiAgICAvLyk7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY3JlYXRvciB0byBzZXQgdGhlIGNvbnRyYWN0b3IgbWFuYWdlciBzbWFydCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfY29udHJhY3Rvck1hbmFnZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0b3IgbWFuYWdlciBzbWFydCBjb250cmFjdAogICAgZnVuY3Rpb24gU2V0Q29udHJhY3Rvck1hbmFnZXIoYWRkcmVzcyBfY29udHJhY3Rvck1hbmFnZXIpOwogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjcmVhdG9yIHRvIHNldCB0aGUgcHJlc2FsZSBsaW1pdHMKICAgIC8vLyBAcGFyYW0gX21pblByZXNhbGVBbW91bnQgTWluaW11bSBhbW91bnQgKGluIHdlaSkgdGhhdCBwYXJ0bmVycyBjYW4gc2VuZAogICAgLy8vIEBwYXJhbSBfbWF4UHJlc2FsZUFtb3VudCBNYXhpbXVtIGFtb3VudCAoaW4gd2VpKSB0aGF0IHBhcnRuZXJzIGNhbiBzZW5kCiAgICBmdW5jdGlvbiBTZXRQcmVzYWxlQW1vdW50TGltaXRzKAogICAgICAgIHVpbnQgX21pblByZXNhbGVBbW91bnQsCiAgICAgICAgdWludCBfbWF4UHJlc2FsZUFtb3VudAogICAgICAgICk7CgogICAgLy8vIEBkZXYgRmFsbGJhY2sgZnVuY3Rpb24KICAgIGZ1bmN0aW9uICgpIHBheWFibGU7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcGFydGljaXBhdGUgaW4gdGhlIHByZXNhbGUgb2YgdGhlIGZ1bmRpbmcKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHByZXNhbGUgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBwcmVzYWxlKCkgcGF5YWJsZSByZXR1cm5zIChib29sKTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY3JlYXRvciB0byBzZXQgYWRkcmVzc2VzIHRoYXQgY2FuIGZ1bmQgdGhlIGRhbwogICAgLy8vIEBwYXJhbSBfdmFsaWQgVHJ1ZSBpZiB0aGUgYWRkcmVzcyBjYW4gZnVuZCB0aGUgRGFvCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBpbmRleCBvZiB0aGUgZmlyc3QgcGFydG5lciB0byBzZXQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBwYXJ0bmVyIHRvIHNldAogICAgZnVuY3Rpb24gc2V0UGFydG5lcnMoCiAgICAgICAgICAgIGJvb2wgX3ZhbGlkLAogICAgICAgICAgICB1aW50IF9mcm9tLAogICAgICAgICAgICB1aW50IF90bwogICAgICAgICk7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY3JlYXRvciB0byBzZXQgdGhlIGFkZHJlc3NlcyBvZiBEYW8gc2hhcmUgaG9sZGVycwogICAgLy8vIEBwYXJhbSBfdmFsaWQgVHJ1ZSBpZiB0aGUgYWRkcmVzcyBjYW4gZnVuZCB0aGUgRGFvCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBpbmRleCBvZiB0aGUgZmlyc3QgcGFydG5lciB0byBzZXQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBwYXJ0bmVyIHRvIHNldAogICAgZnVuY3Rpb24gc2V0U2hhcmVIb2xkZXJzKAogICAgICAgICAgICBib29sIF92YWxpZCwKICAgICAgICAgICAgdWludCBfZnJvbSwKICAgICAgICAgICAgdWludCBfdG8KICAgICAgICApOwogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBhbGxvdyB0aGUgY3JlYXRvciB0byBhYm9ydCB0aGUgZnVuZGluZyBiZWZvcmUgdGhlIGNsb3NpbmcgdGltZQogICAgZnVuY3Rpb24gYWJvcnRGdW5kaW5nKCk7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIFRvIGFsbG93IHRoZSBjcmVhdG9yIHRvIHBhdXNlIGR1cmluZyB0aGUgcHJlc2FsZQogICAgZnVuY3Rpb24gcGF1c2UodWludCBfcGF1c2VDbG9zaW5nVGltZSkgewogICAgICAgIHBhdXNlQ2xvc2luZ1RpbWUgPSBfcGF1c2VDbG9zaW5nVGltZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjcmVhdG9yIHRvIHNldCB0aGUgZnVuZGluZyBsaW1pdHMgZm9yIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9taW5BbW91bnRMaW1pdCBUaGUgYW1vdW50IGJlbG93IHRoaXMgbGltaXQgKGluIHdlaSkgY2FuIGZ1bmQgdGhlIGRhbwogICAgLy8vIEBwYXJhbSBfbWF4QW1vdW50TGltaXQgTWF4aW11bSBhbW91bnQgKGluIHdlaSkgYSBwYXJ0bmVyIGNhbiBmdW5kCiAgICAvLy8gQHBhcmFtIF9kaXZpc29yQmFsYW5jZUxpbWl0IFRoZSBjcmVhdG9yIGNhbiBzZXQgYSBsaW1pdCBpbiBwZXJjZW50YWdlIG9mIEV0aCBiYWxhbmNlIChub3QgbWFuZGF0b3J5KQogICAgLy8vIEBwYXJhbSBfbXVsdGlwbGllclNoYXJlc0xpbWl0IFRoZSBjcmVhdG9yIGNhbiBzZXQgYSBsaW1pdCBpbiBwZXJjZW50YWdlIG9mIHNoYXJlcyBiYWxhbmNlIGluIHRoZSBEYW8gKG5vdCBtYW5kYXRvcnkpCiAgICAvLy8gQHBhcmFtIF9kaXZpc29yU2hhcmVzTGltaXQgVGhlIGNyZWF0b3IgY2FuIHNldCBhIGxpbWl0IGluIHBlcmNlbnRhZ2Ugb2Ygc2hhcmVzIGJhbGFuY2UgaW4gdGhlIERhbyAobm90IG1hbmRhdG9yeSkgCiAgICBmdW5jdGlvbiBzZXRMaW1pdHMoCiAgICAgICAgICAgIHVpbnQgX21pbkFtb3VudExpbWl0LAogICAgICAgICAgICB1aW50IF9tYXhBbW91bnRMaW1pdCwgCiAgICAgICAgICAgIHVpbnQgX2Rpdmlzb3JCYWxhbmNlTGltaXQsCiAgICAgICAgICAgIHVpbnQgX211bHRpcGxpZXJTaGFyZXNMaW1pdCwKICAgICAgICAgICAgdWludCBfZGl2aXNvclNoYXJlc0xpbWl0CiAgICApOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgdG8gc2V0IHRoZSBmdW5kaW5nIGxpbWl0cyBmb3IgcGFydG5lcnMKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBwYXJ0bmVyIHRvIHNldAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgc2V0IHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gc2V0RnVuZGluZyh1aW50IF90bykgcmV0dXJucyAoYm9vbCBfc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gZm9yIHRoZSBmdW5kaW5nIG9mIHRoZSBEYW8gYnkgYSBncm91cCBvZiBwYXJ0bmVycwogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgaW5kZXggb2YgdGhlIGZpcnN0IHBhcnRuZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBpbmRleCBvZiB0aGUgbGFzdCBwYXJ0bmVyCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBEYW8gd2FzIGZ1bmRlZCBvciBub3QKICAgIGZ1bmN0aW9uIGZ1bmREYW9Gb3IoCiAgICAgICAgICAgIHVpbnQgX2Zyb20sCiAgICAgICAgICAgIHVpbnQgX3RvCiAgICAgICAgKSByZXR1cm5zIChib29sKTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gZnVuZCB0aGUgRGFvIHdpdGggJ21zZy5zZW5kZXInIGFzICdiZW5lZmljaWFyeScKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIERhbyB3YXMgZnVuZGVkIG9yIG5vdCAKICAgIGZ1bmN0aW9uIGZ1bmREYW8oKSByZXR1cm5zIChib29sKTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcmVmdW5kIGZvciBhIHBhcnRuZXIKICAgIC8vLyBAcGFyYW0gX3BhcnRuZXJJRCBUaGUgaW5kZXggb2YgdGhlIHBhcnRuZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHJlZnVuZCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiByZWZ1bmRGb3IodWludCBfcGFydG5lcklEKSBpbnRlcm5hbCByZXR1cm5zIChib29sKTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byByZWZ1bmQgZm9yIHZhbGlkIHBhcnRuZXJzIGJlZm9yZSB0aGUgY2xvc2luZyB0aW1lCiAgICAvLy8gQHBhcmFtIF90byBUaGUgaW5kZXggb2YgdGhlIGxhc3QgcGFydG5lcgogICAgZnVuY3Rpb24gcmVmdW5kRm9yVmFsaWRQYXJ0bmVycyh1aW50IF90byk7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gcmVmdW5kIGZvciBhIGdyb3VwIG9mIHBhcnRuZXJzIGFmdGVyIHRoZSBjbG9zaW5nIHRpbWUKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGluZGV4IG9mIHRoZSBmaXJzdCBwYXJ0bmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgaW5kZXggb2YgdGhlIGxhc3QgcGFydG5lcgogICAgZnVuY3Rpb24gcmVmdW5kRm9yQWxsKAogICAgICAgIHVpbnQgX2Zyb20sCiAgICAgICAgdWludCBfdG8pOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHJlZnVuZCBhZnRlciB0aGUgY2xvc2luZyB0aW1lIHdpdGggJ21zZy5zZW5kZXInIGFzICdiZW5lZmljaWFyeScKICAgIGZ1bmN0aW9uIHJlZnVuZCgpOwoKICAgIC8vLyBAcGFyYW0gX21pbkFtb3VudExpbWl0IFRoZSBhbW91bnQgKGluIHdlaSkgYmVsb3cgdGhpcyBsaW1pdCBjYW4gZnVuZCB0aGUgZGFvCiAgICAvLy8gQHBhcmFtIF9tYXhBbW91bnRMaW1pdCBNYXhpbXVtIGFtb3VudCAoaW4gd2VpKSBhIHBhcnRuZXIgY2FuIGZ1bmQKICAgIC8vLyBAcGFyYW0gX2Rpdmlzb3JCYWxhbmNlTGltaXQgVGhlIHBhcnRuZXIgY2FuIGZ1bmQgCiAgICAvLy8gb25seSB1bmRlciBhIGRlZmluZWQgcGVyY2VudGFnZSBvZiBoaXMgZXRoZXIgYmFsYW5jZQogICAgLy8vIEBwYXJhbSBfbXVsdGlwbGllclNoYXJlc0xpbWl0IFRoZSBwYXJ0bmVyIGNhbiBmdW5kIAogICAgLy8vIG9ubHkgdW5kZXIgYSBkZWZpbmVkIHBlcmNlbnRhZ2Ugb2YgaGlzIHNoYXJlcyBiYWxhbmNlIGluIHRoZSBEYW8gCiAgICAvLy8gQHBhcmFtIF9kaXZpc29yU2hhcmVzTGltaXQgVGhlIHBhcnRuZXIgY2FuIGZ1bmQgCiAgICAvLy8gb25seSB1bmRlciBhIGRlZmluZWQgcGVyY2VudGFnZSBvZiBoaXMgc2hhcmVzIGJhbGFuY2UgaW4gdGhlIERhbyAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGluZGV4IG9mIHRoZSBmaXJzdCBwYXJ0bmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgaW5kZXggb2YgdGhlIGxhc3QgcGFydG5lcgogICAgLy8vIEByZXR1cm4gVGhlIHJlc3VsdCBvZiB0aGUgZnVuZGluZyBwcm9jZWR1cmUgKGluIHdlaSkgYXQgcHJlc2VudCB0aW1lCiAgICBmdW5jdGlvbiBlc3RpbWF0ZWRGdW5kaW5nQW1vdW50KAogICAgICAgIHVpbnQgX21pbkFtb3VudExpbWl0LAogICAgICAgIHVpbnQgX21heEFtb3VudExpbWl0LCAKICAgICAgICB1aW50IF9kaXZpc29yQmFsYW5jZUxpbWl0LAogICAgICAgIHVpbnQgX211bHRpcGxpZXJTaGFyZXNMaW1pdCwKICAgICAgICB1aW50IF9kaXZpc29yU2hhcmVzTGltaXQsCiAgICAgICAgdWludCBfZnJvbSwKICAgICAgICB1aW50IF90bwogICAgICAgICkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBwYXJhbSBfaW5kZXggVGhlIGluZGV4IG9mIHRoZSBwYXJ0bmVyCiAgICAvLy8gQHBhcmFtIF9taW5BbW91bnRMaW1pdCBUaGUgYW1vdW50IChpbiB3ZWkpIGJlbG93IHRoaXMgbGltaXQgY2FuIGZ1bmQgdGhlIGRhbwogICAgLy8vIEBwYXJhbSBfbWF4QW1vdW50TGltaXQgTWF4aW11bSBhbW91bnQgKGluIHdlaSkgYSBwYXJ0bmVyIGNhbiBmdW5kCiAgICAvLy8gQHBhcmFtIF9kaXZpc29yQmFsYW5jZUxpbWl0IFRoZSBwYXJ0bmVyIGNhbiBmdW5kIAogICAgLy8vIG9ubHkgdW5kZXIgYSBkZWZpbmVkIHBlcmNlbnRhZ2Ugb2YgaGlzIGV0aGVyIGJhbGFuY2UgCiAgICAvLy8gQHBhcmFtIF9tdWx0aXBsaWVyU2hhcmVzTGltaXQgVGhlIHBhcnRuZXIgY2FuIGZ1bmQgCiAgICAvLy8gb25seSB1bmRlciBhIGRlZmluZWQgcGVyY2VudGFnZSBvZiBoaXMgc2hhcmVzIGJhbGFuY2UgaW4gdGhlIERhbyAKICAgIC8vLyBAcGFyYW0gX2Rpdmlzb3JTaGFyZXNMaW1pdCBUaGUgcGFydG5lciBjYW4gZnVuZCAKICAgIC8vLyBvbmx5IHVuZGVyIGEgZGVmaW5lZCBwZXJjZW50YWdlIG9mIGhpcyBzaGFyZXMgYmFsYW5jZSBpbiB0aGUgRGFvIAogICAgLy8vIEByZXR1cm4gVGhlIG1heGltdW0gYW1vdW50IChpbiB3ZWkpIGEgcGFydG5lciBjYW4gZnVuZAogICAgZnVuY3Rpb24gcGFydG5lckZ1bmRpbmdMaW1pdCgKICAgICAgICB1aW50IF9pbmRleCwgCiAgICAgICAgdWludCBfbWluQW1vdW50TGltaXQsCiAgICAgICAgdWludCBfbWF4QW1vdW50TGltaXQsIAogICAgICAgIHVpbnQgX2Rpdmlzb3JCYWxhbmNlTGltaXQsCiAgICAgICAgdWludCBfbXVsdGlwbGllclNoYXJlc0xpbWl0LAogICAgICAgIHVpbnQgX2Rpdmlzb3JTaGFyZXNMaW1pdAogICAgICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludCk7CiAgICAgICAgCiAgICAvLy8gQHJldHVybiB0aGUgbnVtYmVyIG9mIHBhcnRuZXJzCiAgICBmdW5jdGlvbiBudW1iZXJPZlBhcnRuZXJzKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCk7CiAgICAKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGluZGV4IG9mIHRoZSBmaXJzdCBwYXJ0bmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgaW5kZXggb2YgdGhlIGxhc3QgcGFydG5lcgogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiB2YWxpZCBwYXJ0bmVycwogICAgZnVuY3Rpb24gbnVtYmVyT2ZWYWxpZFBhcnRuZXJzKAogICAgICAgIHVpbnQgX2Zyb20sCiAgICAgICAgdWludCBfdG8KICAgICAgICApIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIGV2ZW50IENvbnRyYWN0b3JNYW5hZ2VyU2V0KGFkZHJlc3MgQ29udHJhY3Rvck1hbmFnZXJBZGRyZXNzKTsKICAgIGV2ZW50IEludGVudGlvblRvRnVuZChhZGRyZXNzIGluZGV4ZWQgcGFydG5lciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgRnVuZChhZGRyZXNzIGluZGV4ZWQgcGFydG5lciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgUmVmdW5kKGFkZHJlc3MgaW5kZXhlZCBwYXJ0bmVyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBMaW1pdFNldCh1aW50IG1pbkFtb3VudExpbWl0LCB1aW50IG1heEFtb3VudExpbWl0LCB1aW50IGRpdmlzb3JCYWxhbmNlTGltaXQsIAogICAgICAgIHVpbnQgX211bHRpcGxpZXJTaGFyZXNMaW1pdCwgdWludCBkaXZpc29yU2hhcmVzTGltaXQpOwogICAgZXZlbnQgUGFydG5lcnNOb3RTZXQodWludCBzdW1PZkZ1bmRpbmdBbW91bnRMaW1pdHMpOwogICAgZXZlbnQgQWxsUGFydG5lcnNTZXQodWludCBmdW5kaW5nQW1vdW50KTsKICAgIGV2ZW50IEZ1ZWxlZCgpOwogICAgZXZlbnQgRnVuZGluZ0Nsb3NlZCgpOwogICAgCn0KCmNvbnRyYWN0IFBhc3NGdW5kaW5nIGlzIFBhc3NGdW5kaW5nSW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiBQYXNzRnVuZGluZyAoCiAgICAgICAgYWRkcmVzcyBfY3JlYXRvciwKICAgICAgICBhZGRyZXNzIF9EYW9NYW5hZ2VyLAogICAgICAgIHVpbnQgX21pbkZ1bmRpbmdBbW91bnQsCiAgICAgICAgdWludCBfc3RhcnRUaW1lLAogICAgICAgIHVpbnQgX2Nsb3NpbmdUaW1lCiAgICAgICAgKSB7CgogICAgICAgIGlmIChfY3JlYXRvciA9PSBfRGFvTWFuYWdlcgogICAgICAgICAgICB8fCBfY3JlYXRvciA9PSAwCiAgICAgICAgICAgIHx8IF9EYW9NYW5hZ2VyID09IDAKICAgICAgICAgICAgfHwgKF9zdGFydFRpbWUgPCBub3cgJiYgX3N0YXJ0VGltZSAhPSAwKSkgdGhyb3c7CiAgICAgICAgICAgIAogICAgICAgIGNyZWF0b3IgPSBfY3JlYXRvcjsKICAgICAgICBEYW9NYW5hZ2VyID0gUGFzc01hbmFnZXIoX0Rhb01hbmFnZXIpOwoKICAgICAgICBtaW5GdW5kaW5nQW1vdW50ID0gX21pbkZ1bmRpbmdBbW91bnQ7CgogICAgICAgIGlmIChfc3RhcnRUaW1lID09IDApIHtzdGFydFRpbWUgPSBub3c7fSBlbHNlIHtzdGFydFRpbWUgPSBfc3RhcnRUaW1lO30KCiAgICAgICAgaWYgKF9jbG9zaW5nVGltZSA8PSBzdGFydFRpbWUpIHRocm93OwogICAgICAgIGNsb3NpbmdUaW1lID0gX2Nsb3NpbmdUaW1lOwogICAgICAgIAogICAgICAgIHNldEZyb21QYXJ0bmVyID0gMTsKICAgICAgICByZWZ1bmRGcm9tUGFydG5lciA9IDE7CgogICAgICAgIHBhcnRuZXJzLmxlbmd0aCA9IDE7IAogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBTZXRDb250cmFjdG9yTWFuYWdlcihhZGRyZXNzIF9jb250cmFjdG9yTWFuYWdlcikgb25seUNyZWF0b3IgewogICAgICAgIAogICAgICAgIGlmIChfY29udHJhY3Rvck1hbmFnZXIgPT0gMAogICAgICAgICAgICB8fCBsaW1pdFNldAogICAgICAgICAgICB8fCBhZGRyZXNzKGNvbnRyYWN0b3JNYW5hZ2VyKSAhPSAwCiAgICAgICAgICAgIHx8IGNyZWF0b3IgPT0gX2NvbnRyYWN0b3JNYW5hZ2VyCiAgICAgICAgICAgIHx8IF9jb250cmFjdG9yTWFuYWdlciA9PSBhZGRyZXNzKERhb01hbmFnZXIpKSB0aHJvdzsKICAgICAgICAgICAgCiAgICAgICAgdG9rZW5DcmVhdGlvbiA9IHRydWU7ICAgICAgICAgICAgCiAgICAgICAgY29udHJhY3Rvck1hbmFnZXIgPSBQYXNzTWFuYWdlcihfY29udHJhY3Rvck1hbmFnZXIpOwogICAgICAgIENvbnRyYWN0b3JNYW5hZ2VyU2V0KF9jb250cmFjdG9yTWFuYWdlcik7CiAgICAgICAgCiAgICB9CgogICAgZnVuY3Rpb24gU2V0UHJlc2FsZUFtb3VudExpbWl0cygKICAgICAgICB1aW50IF9taW5QcmVzYWxlQW1vdW50LAogICAgICAgIHVpbnQgX21heFByZXNhbGVBbW91bnQKICAgICAgICApIG9ubHlDcmVhdG9yIHsKCiAgICAgICAgaWYgKGxpbWl0U2V0KSB0aHJvdzsKICAgICAgICAKICAgICAgICBtaW5QcmVzYWxlQW1vdW50ID0gX21pblByZXNhbGVBbW91bnQ7CiAgICAgICAgbWF4UHJlc2FsZUFtb3VudCA9IF9tYXhQcmVzYWxlQW1vdW50OwoKICAgIH0KCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICBpZiAoIXByZXNhbGUoKSkgdGhyb3c7CiAgICB9CgogICAgZnVuY3Rpb24gcHJlc2FsZSgpIHBheWFibGUgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICBpZiAobXNnLnZhbHVlIDw9IDAKICAgICAgICAgICAgfHwgbm93IDwgc3RhcnRUaW1lCiAgICAgICAgICAgIHx8IG5vdyA+IGNsb3NpbmdUaW1lCiAgICAgICAgICAgIHx8IG5vdyA8IHBhdXNlQ2xvc2luZ1RpbWUKICAgICAgICAgICAgfHwgbGltaXRTZXQKICAgICAgICAgICAgfHwgbXNnLnZhbHVlIDwgbWluUHJlc2FsZUFtb3VudAogICAgICAgICAgICB8fCBtc2cudmFsdWUgPiBtYXhQcmVzYWxlQW1vdW50CiAgICAgICAgICAgIHx8IG1zZy5zZW5kZXIgPT0gY3JlYXRvcgogICAgICAgICkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgaWYgKHBhcnRuZXJJRFttc2cuc2VuZGVyXSA9PSAwKSB7CgogICAgICAgICAgICB1aW50IF9wYXJ0bmVySUQgPSBwYXJ0bmVycy5sZW5ndGgrKzsKICAgICAgICAgICAgUGFydG5lciB0ID0gcGFydG5lcnNbX3BhcnRuZXJJRF07CiAgICAgICAgICAgICAKICAgICAgICAgICAgcGFydG5lcklEW21zZy5zZW5kZXJdID0gX3BhcnRuZXJJRDsKICAgICAgICAgICAgdC5wYXJ0bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICB0LnByZXNhbGVBbW91bnQgKz0gbXNnLnZhbHVlOwogICAgICAgICAgICB0LnByZXNhbGVEYXRlID0gbm93OwoKICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgUGFydG5lciBwID0gcGFydG5lcnNbcGFydG5lcklEW21zZy5zZW5kZXJdXTsKICAgICAgICAgICAgaWYgKHAucHJlc2FsZUFtb3VudCArIG1zZy52YWx1ZSA+IG1heFByZXNhbGVBbW91bnQpIHRocm93OwoKICAgICAgICAgICAgcC5wcmVzYWxlRGF0ZSA9IChwLnByZXNhbGVEYXRlKnAucHJlc2FsZUFtb3VudCArIG5vdyptc2cudmFsdWUpLyhwLnByZXNhbGVBbW91bnQgKyBtc2cudmFsdWUpOwogICAgICAgICAgICBwLnByZXNhbGVBbW91bnQgKz0gbXNnLnZhbHVlOwoKICAgICAgICB9ICAgIAogICAgICAgIAogICAgICAgIEludGVudGlvblRvRnVuZChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRQYXJ0bmVycygKICAgICAgICAgICAgYm9vbCBfdmFsaWQsCiAgICAgICAgICAgIHVpbnQgX2Zyb20sCiAgICAgICAgICAgIHVpbnQgX3RvCiAgICAgICAgKSBvbmx5Q3JlYXRvciB7CgogICAgICAgIGlmIChsaW1pdFNldAogICAgICAgICAgICB8fF9mcm9tIDwgMSAKICAgICAgICAgICAgfHwgX3RvID4gcGFydG5lcnMubGVuZ3RoIC0gMSkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50IGkgPSBfZnJvbTsgaSA8PSBfdG87IGkrKykgewogICAgICAgICAgICBQYXJ0bmVyIHQgPSBwYXJ0bmVyc1tpXTsKICAgICAgICAgICAgdC52YWxpZCA9IF92YWxpZDsKICAgICAgICB9CiAgICAgICAgCiAgICB9CgogICAgZnVuY3Rpb24gc2V0U2hhcmVIb2xkZXJzKAogICAgICAgICAgICBib29sIF92YWxpZCwKICAgICAgICAgICAgdWludCBfZnJvbSwKICAgICAgICAgICAgdWludCBfdG8KICAgICAgICApIG9ubHlDcmVhdG9yIHsKCiAgICAgICAgaWYgKGxpbWl0U2V0CiAgICAgICAgICAgIHx8X2Zyb20gPCAxIAogICAgICAgICAgICB8fCBfdG8gPiBwYXJ0bmVycy5sZW5ndGggLSAxKSB0aHJvdzsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQgaSA9IF9mcm9tOyBpIDw9IF90bzsgaSsrKSB7CiAgICAgICAgICAgIFBhcnRuZXIgdCA9IHBhcnRuZXJzW2ldOwogICAgICAgICAgICBpZiAoRGFvTWFuYWdlci5iYWxhbmNlT2YodC5wYXJ0bmVyQWRkcmVzcykgIT0gMCkgdC52YWxpZCA9IF92YWxpZDsKICAgICAgICB9CiAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFib3J0RnVuZGluZygpIG9ubHlDcmVhdG9yIHsKICAgICAgICBsaW1pdFNldCA9IHRydWU7CiAgICAgICAgbWF4UHJlc2FsZUFtb3VudCA9IDA7CiAgICAgICAgSXNmdW5kaW5nQWJvcnRlZCA9IHRydWU7IAogICAgfQogICAgCiAgICBmdW5jdGlvbiBwYXVzZSh1aW50IF9wYXVzZUNsb3NpbmdUaW1lKSBvbmx5Q3JlYXRvciB7CiAgICAgICAgcGF1c2VDbG9zaW5nVGltZSA9IF9wYXVzZUNsb3NpbmdUaW1lOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRMaW1pdHMoCiAgICAgICAgICAgIHVpbnQgX21pbkFtb3VudExpbWl0LAogICAgICAgICAgICB1aW50IF9tYXhBbW91bnRMaW1pdCwgCiAgICAgICAgICAgIHVpbnQgX2Rpdmlzb3JCYWxhbmNlTGltaXQsCiAgICAgICAgICAgIHVpbnQgX211bHRpcGxpZXJTaGFyZXNMaW1pdCwKICAgICAgICAgICAgdWludCBfZGl2aXNvclNoYXJlc0xpbWl0CiAgICApIG9ubHlDcmVhdG9yIHsKICAgICAgICAKICAgICAgICBpZiAobGltaXRTZXQpIHRocm93OwogICAgICAgIAogICAgICAgIG1pbkFtb3VudExpbWl0ID0gX21pbkFtb3VudExpbWl0OwogICAgICAgIG1heEFtb3VudExpbWl0ID0gX21heEFtb3VudExpbWl0OwogICAgICAgIGRpdmlzb3JCYWxhbmNlTGltaXQgPSBfZGl2aXNvckJhbGFuY2VMaW1pdDsKICAgICAgICBtdWx0aXBsaWVyU2hhcmVzTGltaXQgPSBfbXVsdGlwbGllclNoYXJlc0xpbWl0OwogICAgICAgIGRpdmlzb3JTaGFyZXNMaW1pdCA9IF9kaXZpc29yU2hhcmVzTGltaXQ7CgogICAgICAgIGxpbWl0U2V0ID0gdHJ1ZTsKICAgICAgICAKICAgICAgICBMaW1pdFNldChfbWluQW1vdW50TGltaXQsIF9tYXhBbW91bnRMaW1pdCwgX2Rpdmlzb3JCYWxhbmNlTGltaXQsIF9tdWx0aXBsaWVyU2hhcmVzTGltaXQsIF9kaXZpc29yU2hhcmVzTGltaXQpOwogICAgCiAgICB9CgogICAgZnVuY3Rpb24gc2V0RnVuZGluZyh1aW50IF90bykgb25seUNyZWF0b3IgcmV0dXJucyAoYm9vbCBfc3VjY2VzcykgewoKICAgICAgICB1aW50IF9mdW5kaW5nTWF4QW1vdW50ID0gRGFvTWFuYWdlci5mdW5kaW5nTWF4QW1vdW50KGFkZHJlc3ModGhpcykpOwoKICAgICAgICBpZiAoIWxpbWl0U2V0IAogICAgICAgICAgICB8fCBfZnVuZGluZ01heEFtb3VudCA8IG1pbkZ1bmRpbmdBbW91bnQKICAgICAgICAgICAgfHwgc2V0RnJvbVBhcnRuZXIgPiBfdG8gCiAgICAgICAgICAgIHx8IF90byA+IHBhcnRuZXJzLmxlbmd0aCAtIDEpIHRocm93OwoKICAgICAgICBEYW9NYW5hZ2VyLnNldEZ1bmRpbmdTdGFydFRpbWUoc3RhcnRUaW1lKTsKICAgICAgICBpZiAodG9rZW5DcmVhdGlvbikgY29udHJhY3Rvck1hbmFnZXIuc2V0RnVuZGluZ1N0YXJ0VGltZShzdGFydFRpbWUpOwoKICAgICAgICBpZiAoc2V0RnJvbVBhcnRuZXIgPT0gMSkgc3VtT2ZGdW5kaW5nQW1vdW50TGltaXRzID0gMDsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQgaSA9IHNldEZyb21QYXJ0bmVyOyBpIDw9IF90bzsgaSsrKSB7CgogICAgICAgICAgICBwYXJ0bmVyc1tpXS5mdW5kaW5nQW1vdW50TGltaXQgPSBwYXJ0bmVyRnVuZGluZ0xpbWl0KGksIG1pbkFtb3VudExpbWl0LCBtYXhBbW91bnRMaW1pdCwgCiAgICAgICAgICAgICAgICBkaXZpc29yQmFsYW5jZUxpbWl0LCBtdWx0aXBsaWVyU2hhcmVzTGltaXQsIGRpdmlzb3JTaGFyZXNMaW1pdCk7CgogICAgICAgICAgICBzdW1PZkZ1bmRpbmdBbW91bnRMaW1pdHMgKz0gcGFydG5lcnNbaV0uZnVuZGluZ0Ftb3VudExpbWl0OwoKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2V0RnJvbVBhcnRuZXIgPSBfdG8gKyAxOwogICAgICAgIAogICAgICAgIGlmIChzZXRGcm9tUGFydG5lciA+PSBwYXJ0bmVycy5sZW5ndGgpIHsKCiAgICAgICAgICAgIHNldEZyb21QYXJ0bmVyID0gMTsKCiAgICAgICAgICAgIGlmIChzdW1PZkZ1bmRpbmdBbW91bnRMaW1pdHMgPCBtaW5GdW5kaW5nQW1vdW50IAogICAgICAgICAgICAgICAgfHwgc3VtT2ZGdW5kaW5nQW1vdW50TGltaXRzID4gX2Z1bmRpbmdNYXhBbW91bnQpIHsKCiAgICAgICAgICAgICAgICBtYXhQcmVzYWxlQW1vdW50ID0gMDsKICAgICAgICAgICAgICAgIElzZnVuZGluZ0Fib3J0ZWQgPSB0cnVlOyAKICAgICAgICAgICAgICAgIFBhcnRuZXJzTm90U2V0KHN1bU9mRnVuZGluZ0Ftb3VudExpbWl0cyk7CiAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYWxsU2V0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIEFsbFBhcnRuZXJzU2V0KHN1bU9mRnVuZGluZ0Ftb3VudExpbWl0cyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICB9CgogICAgfQoKICAgIGZ1bmN0aW9uIGZ1bmREYW9Gb3IoCiAgICAgICAgICAgIHVpbnQgX2Zyb20sCiAgICAgICAgICAgIHVpbnQgX3RvCiAgICAgICAgKSByZXR1cm5zIChib29sKSB7CgogICAgICAgIGlmICghYWxsU2V0KSB0aHJvdzsKICAgICAgICAKICAgICAgICBpZiAoX2Zyb20gPCAxIHx8IF90byA+IHBhcnRuZXJzLmxlbmd0aCAtIDEpIHRocm93OwogICAgICAgIAogICAgICAgIGFkZHJlc3MgX3BhcnRuZXI7CiAgICAgICAgdWludCBfYW1vdW50VG9GdW5kOwogICAgICAgIHVpbnQgX3N1bUFtb3VudFRvRnVuZCA9IDA7CgogICAgICAgIGZvciAodWludCBpID0gX2Zyb207IGkgPD0gX3RvOyBpKyspIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIF9wYXJ0bmVyID0gcGFydG5lcnNbaV0ucGFydG5lckFkZHJlc3M7CiAgICAgICAgICAgIF9hbW91bnRUb0Z1bmQgPSBwYXJ0bmVyc1tpXS5mdW5kaW5nQW1vdW50TGltaXQgLSBwYXJ0bmVyc1tpXS5mdW5kZWRBbW91bnQ7CiAgICAgICAgCiAgICAgICAgICAgIGlmIChfYW1vdW50VG9GdW5kID4gMCkgewoKICAgICAgICAgICAgICAgIHBhcnRuZXJzW2ldLmZ1bmRlZEFtb3VudCArPSBfYW1vdW50VG9GdW5kOwogICAgICAgICAgICAgICAgX3N1bUFtb3VudFRvRnVuZCArPSBfYW1vdW50VG9GdW5kOwoKICAgICAgICAgICAgICAgIERhb01hbmFnZXIucmV3YXJkVG9rZW4oX3BhcnRuZXIsIF9hbW91bnRUb0Z1bmQsIHBhcnRuZXJzW2ldLnByZXNhbGVEYXRlKTsKCiAgICAgICAgICAgICAgICBpZiAodG9rZW5DcmVhdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNvbnRyYWN0b3JNYW5hZ2VyLnJld2FyZFRva2VuKF9wYXJ0bmVyLCBfYW1vdW50VG9GdW5kLCBwYXJ0bmVyc1tpXS5wcmVzYWxlRGF0ZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgaWYgKF9zdW1BbW91bnRUb0Z1bmQgPT0gMCkgcmV0dXJuOwogICAgICAgIAogICAgICAgIGlmICghRGFvTWFuYWdlci5zZW5kKF9zdW1BbW91bnRUb0Z1bmQpKSB0aHJvdzsKCiAgICAgICAgdG90YWxGdW5kZWQgKz0gX3N1bUFtb3VudFRvRnVuZDsKCiAgICAgICAgaWYgKHRvdGFsRnVuZGVkID09IHN1bU9mRnVuZGluZ0Ftb3VudExpbWl0cykgewogICAgICAgICAgICBEYW9NYW5hZ2VyLnNldEZ1bmRpbmdGdWVsZWQoKTsgCiAgICAgICAgICAgIGlmICh0b2tlbkNyZWF0aW9uKSBjb250cmFjdG9yTWFuYWdlci5zZXRGdW5kaW5nRnVlbGVkKCk7IAogICAgICAgICAgICBGdWVsZWQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgfQogICAgCiAgICBmdW5jdGlvbiBmdW5kRGFvKCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBmdW5kRGFvRm9yKHBhcnRuZXJJRFttc2cuc2VuZGVyXSwgcGFydG5lcklEW21zZy5zZW5kZXJdKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWZ1bmRGb3IodWludCBfcGFydG5lcklEKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CgogICAgICAgIFBhcnRuZXIgdCA9IHBhcnRuZXJzW19wYXJ0bmVySURdOwogICAgICAgIHVpbnQgX2Ftb3VudG5vdFRvUmVmdW5kID0gdC5wcmVzYWxlQW1vdW50OwogICAgICAgIHVpbnQgX2Ftb3VudFRvUmVmdW5kOwogICAgICAgIAogICAgICAgIGlmICh0LnByZXNhbGVBbW91bnQgPiBtYXhQcmVzYWxlQW1vdW50ICYmIHQudmFsaWQpIHsKICAgICAgICAgICAgX2Ftb3VudG5vdFRvUmVmdW5kID0gbWF4UHJlc2FsZUFtb3VudDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHQuZnVuZGVkQW1vdW50ID4gMCB8fCBub3cgPiBjbG9zaW5nVGltZSkgewogICAgICAgICAgICBfYW1vdW50bm90VG9SZWZ1bmQgPSB0LmZ1bmRlZEFtb3VudDsKICAgICAgICB9CgogICAgICAgIF9hbW91bnRUb1JlZnVuZCA9IHQucHJlc2FsZUFtb3VudCAtIF9hbW91bnRub3RUb1JlZnVuZDsKICAgICAgICBpZiAoX2Ftb3VudFRvUmVmdW5kIDw9IDApIHJldHVybiB0cnVlOwoKICAgICAgICB0LnByZXNhbGVBbW91bnQgPSBfYW1vdW50bm90VG9SZWZ1bmQ7CiAgICAgICAgaWYgKHQucGFydG5lckFkZHJlc3Muc2VuZChfYW1vdW50VG9SZWZ1bmQpKSB7CiAgICAgICAgICAgIFJlZnVuZCh0LnBhcnRuZXJBZGRyZXNzLCBfYW1vdW50VG9SZWZ1bmQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0LnByZXNhbGVBbW91bnQgPSBfYW1vdW50bm90VG9SZWZ1bmQgKyBfYW1vdW50VG9SZWZ1bmQ7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgfQoKICAgIGZ1bmN0aW9uIHJlZnVuZEZvclZhbGlkUGFydG5lcnModWludCBfdG8pIHsKCiAgICAgICAgaWYgKHJlZnVuZEZyb21QYXJ0bmVyID4gX3RvIHx8IF90byA+IHBhcnRuZXJzLmxlbmd0aCAtIDEpIHRocm93OwogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gcmVmdW5kRnJvbVBhcnRuZXI7IGkgPD0gX3RvOyBpKyspIHsKICAgICAgICAgICAgaWYgKHBhcnRuZXJzW2ldLnZhbGlkKSB7CiAgICAgICAgICAgICAgICBpZiAoIXJlZnVuZEZvcihpKSkgdGhyb3c7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJlZnVuZEZyb21QYXJ0bmVyID0gX3RvICsgMTsKICAgICAgICAKICAgICAgICBpZiAocmVmdW5kRnJvbVBhcnRuZXIgPj0gcGFydG5lcnMubGVuZ3RoKSB7CiAgICAgICAgICAgIHJlZnVuZEZyb21QYXJ0bmVyID0gMTsKCiAgICAgICAgICAgIGlmICgodG90YWxGdW5kZWQgPj0gc3VtT2ZGdW5kaW5nQW1vdW50TGltaXRzICYmIGFsbFNldCAmJiBjbG9zaW5nVGltZSA+IG5vdykKICAgICAgICAgICAgICAgIHx8IElzZnVuZGluZ0Fib3J0ZWQpIHsKCiAgICAgICAgICAgICAgICBjbG9zaW5nVGltZSA9IG5vdzsgCiAgICAgICAgICAgICAgICBGdW5kaW5nQ2xvc2VkKCk7IAoKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiByZWZ1bmRGb3JBbGwoCiAgICAgICAgdWludCBfZnJvbSwKICAgICAgICB1aW50IF90bykgewoKICAgICAgICBpZiAoX2Zyb20gPCAxIHx8IF90byA+IHBhcnRuZXJzLmxlbmd0aCAtIDEpIHRocm93OwogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gX2Zyb207IGkgPD0gX3RvOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFyZWZ1bmRGb3IoaSkpIHRocm93OwogICAgICAgIH0KCiAgICB9CgogICAgZnVuY3Rpb24gcmVmdW5kKCkgewogICAgICAgIHJlZnVuZEZvckFsbChwYXJ0bmVySURbbXNnLnNlbmRlcl0sIHBhcnRuZXJJRFttc2cuc2VuZGVyXSk7CiAgICB9CgogICAgZnVuY3Rpb24gZXN0aW1hdGVkRnVuZGluZ0Ftb3VudCgKICAgICAgICB1aW50IF9taW5BbW91bnRMaW1pdCwKICAgICAgICB1aW50IF9tYXhBbW91bnRMaW1pdCwgCiAgICAgICAgdWludCBfZGl2aXNvckJhbGFuY2VMaW1pdCwKICAgICAgICB1aW50IF9tdWx0aXBsaWVyU2hhcmVzTGltaXQsCiAgICAgICAgdWludCBfZGl2aXNvclNoYXJlc0xpbWl0LAogICAgICAgIHVpbnQgX2Zyb20sCiAgICAgICAgdWludCBfdG8KICAgICAgICApIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgaWYgKF9mcm9tIDwgMSB8fCBfdG8gPiBwYXJ0bmVycy5sZW5ndGggLSAxKSB0aHJvdzsKCiAgICAgICAgdWludCBfdG90YWwgPSAwOwogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gX2Zyb207IGkgPD0gX3RvOyBpKyspIHsKICAgICAgICAgICAgX3RvdGFsICs9IHBhcnRuZXJGdW5kaW5nTGltaXQoaSwgX21pbkFtb3VudExpbWl0LCBfbWF4QW1vdW50TGltaXQsIAogICAgICAgICAgICAgICAgX2Rpdmlzb3JCYWxhbmNlTGltaXQsIF9tdWx0aXBsaWVyU2hhcmVzTGltaXQsIF9kaXZpc29yU2hhcmVzTGltaXQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF90b3RhbDsKCiAgICB9CgogICAgZnVuY3Rpb24gcGFydG5lckZ1bmRpbmdMaW1pdCgKICAgICAgICB1aW50IF9pbmRleCwgCiAgICAgICAgdWludCBfbWluQW1vdW50TGltaXQsCiAgICAgICAgdWludCBfbWF4QW1vdW50TGltaXQsIAogICAgICAgIHVpbnQgX2Rpdmlzb3JCYWxhbmNlTGltaXQsCiAgICAgICAgdWludCBfbXVsdGlwbGllclNoYXJlc0xpbWl0LAogICAgICAgIHVpbnQgX2Rpdmlzb3JTaGFyZXNMaW1pdAogICAgICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewoKICAgICAgICB1aW50IF9hbW91bnQ7CiAgICAgICAgdWludCBfYW1vdW50MTsKCiAgICAgICAgUGFydG5lciB0ID0gcGFydG5lcnNbX2luZGV4XTsKICAgICAgICAgICAgCiAgICAgICAgaWYgKHQudmFsaWQpIHsKCiAgICAgICAgICAgIF9hbW91bnQgPSB0LnByZXNhbGVBbW91bnQ7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoX2Rpdmlzb3JCYWxhbmNlTGltaXQgPiAwKSB7CiAgICAgICAgICAgICAgICBfYW1vdW50MSA9IHVpbnQodC5wYXJ0bmVyQWRkcmVzcy5iYWxhbmNlKS91aW50KF9kaXZpc29yQmFsYW5jZUxpbWl0KTsKICAgICAgICAgICAgICAgIGlmIChfYW1vdW50ID4gX2Ftb3VudDEpIF9hbW91bnQgPSBfYW1vdW50MTsgCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX211bHRpcGxpZXJTaGFyZXNMaW1pdCA+IDAgJiYgX2Rpdmlzb3JTaGFyZXNMaW1pdCA+IDApIHsKCiAgICAgICAgICAgICAgICB1aW50IF9iYWxhbmNlID0gdWludChEYW9NYW5hZ2VyLmJhbGFuY2VPZih0LnBhcnRuZXJBZGRyZXNzKSk7CgogICAgICAgICAgICAgICAgdWludCBfbXVsdGlwbGllciA9IF9iYWxhbmNlKl9tdWx0aXBsaWVyU2hhcmVzTGltaXQ7CiAgICAgICAgICAgICAgICBpZiAoX211bHRpcGxpZXIvX2JhbGFuY2UgIT0gX211bHRpcGxpZXJTaGFyZXNMaW1pdCkgdGhyb3c7CgogICAgICAgICAgICAgICAgX2Ftb3VudDEgPSBfbXVsdGlwbGllci9fZGl2aXNvclNoYXJlc0xpbWl0OwogICAgICAgICAgICAgICAgaWYgKF9hbW91bnQgPiBfYW1vdW50MSkgX2Ftb3VudCA9IF9hbW91bnQxOyAKCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX2Ftb3VudCA+IF9tYXhBbW91bnRMaW1pdCkgX2Ftb3VudCA9IF9tYXhBbW91bnRMaW1pdDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChfYW1vdW50IDwgX21pbkFtb3VudExpbWl0KSBfYW1vdW50ID0gX21pbkFtb3VudExpbWl0OwoKICAgICAgICAgICAgaWYgKF9hbW91bnQgPiB0LnByZXNhbGVBbW91bnQpIF9hbW91bnQgPSB0LnByZXNhbGVBbW91bnQ7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gX2Ftb3VudDsKICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBudW1iZXJPZlBhcnRuZXJzKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJ0bmVycy5sZW5ndGggLSAxOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBudW1iZXJPZlZhbGlkUGFydG5lcnMoCiAgICAgICAgdWludCBfZnJvbSwKICAgICAgICB1aW50IF90bwogICAgICAgICkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIAogICAgICAgIGlmIChfZnJvbSA8IDEgfHwgX3RvID4gcGFydG5lcnMubGVuZ3RoLTEpIHRocm93OwoKICAgICAgICB1aW50IF90b3RhbCA9IDA7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50IGkgPSBfZnJvbTsgaSA8PSBfdG87IGkrKykgewogICAgICAgICAgICBpZiAocGFydG5lcnNbaV0udmFsaWQpIF90b3RhbCArPSAxOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF90b3RhbDsKICAgICAgICAKICAgIH0KCn0KCmNvbnRyYWN0IFBhc3NGdW5kaW5nQ3JlYXRvciB7CiAgICBldmVudCBOZXdGdW5kaW5nKGFkZHJlc3MgY3JlYXRvciwgYWRkcmVzcyBEYW9NYW5hZ2VyLCAKICAgICAgICB1aW50IE1pbkZ1bmRpbmdBbW91bnQsIHVpbnQgU3RhcnRUaW1lLCB1aW50IENsb3NpbmdUaW1lLCBhZGRyZXNzIEZ1bmRpbmdDb250cmFjdEFkZHJlc3MpOwogICAgZnVuY3Rpb24gY3JlYXRlRnVuZGluZygKICAgICAgICBhZGRyZXNzIF9EYW9NYW5hZ2VyLAogICAgICAgIHVpbnQgX21pbkZ1bmRpbmdBbW91bnQsCiAgICAgICAgdWludCBfc3RhcnRUaW1lLAogICAgICAgIHVpbnQgX2Nsb3NpbmdUaW1lCiAgICAgICAgKSByZXR1cm5zIChQYXNzRnVuZGluZykgewogICAgICAgIFBhc3NGdW5kaW5nIF9uZXdGdW5kaW5nID0gbmV3IFBhc3NGdW5kaW5nKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBfRGFvTWFuYWdlciwgICAgICAgIAogICAgICAgICAgICBfbWluRnVuZGluZ0Ftb3VudCwKICAgICAgICAgICAgX3N0YXJ0VGltZSwKICAgICAgICAgICAgX2Nsb3NpbmdUaW1lCiAgICAgICAgKTsKICAgICAgICBOZXdGdW5kaW5nKG1zZy5zZW5kZXIsIF9EYW9NYW5hZ2VyLCAgCiAgICAgICAgICAgIF9taW5GdW5kaW5nQW1vdW50LCBfc3RhcnRUaW1lLCBfY2xvc2luZ1RpbWUsIGFkZHJlc3MoX25ld0Z1bmRpbmcpKTsKICAgICAgICByZXR1cm4gX25ld0Z1bmRpbmc7CiAgICB9Cn0='.
	

]
