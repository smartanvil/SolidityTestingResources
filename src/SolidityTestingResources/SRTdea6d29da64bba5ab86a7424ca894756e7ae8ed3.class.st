Class {
	#name : #SRTdea6d29da64bba5ab86a7424ca894756e7ae8ed3,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdea6d29da64bba5ab86a7424ca894756e7ae8ed3 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogVHJhZGVUb2tlbiBDcm93ZHNhbGUgQ29udHJhY3QKICoKICogVGhpcyBpcyB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IGZvciB0aGUgVHJhZGVUb2tlbi4gSXQgdXRpbGl6ZXMgTWFqb29scidzCiAqIENyb3dkc2FsZUxpYiBsaWJyYXJ5IHRvIHJlZHVjZSBjdXN0b20gc291cmNlIGNvZGUgc3VyZmFjZSBhcmVhIGFuZCBpbmNyZWFzZQogKiBvdmVyYWxsIHNlY3VyaXR5Lk1ham9vbHIgcHJvdmlkZXMgc21hcnQgY29udHJhY3Qgc2VydmljZXMgYW5kIHNlY3VyaXR5IHJldmlld3MKICogZm9yIGNvbnRyYWN0IGRlcGxveW1lbnRzIGluIGFkZGl0aW9uIHRvIHdvcmtpbmcgb24gb3BlbiBzb3VyY2UgcHJvamVjdHMgaW4gdGhlCiAqIEV0aGVyZXVtIGNvbW11bml0eS4KICogRm9yIGZ1cnRoZXIgaW5mb3JtYXRpb246IHRyYWRlLmlvLCBtYWpvb2xyLmlvCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpjb250cmFjdCBUSU9Dcm93ZHNhbGUgewogIHVzaW5nIERpcmVjdENyb3dkc2FsZUxpYiBmb3IgRGlyZWN0Q3Jvd2RzYWxlTGliLkRpcmVjdENyb3dkc2FsZVN0b3JhZ2U7CgogIERpcmVjdENyb3dkc2FsZUxpYi5EaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHNhbGU7CiAgYm9vbCBwdWJsaWMgZ3JlZW5zaG9lQWN0aXZlOwoKICBmdW5jdGlvbiBUSU9Dcm93ZHNhbGUoCiAgICAgICAgICAgICAgICBhZGRyZXNzIG93bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIHNhbGVEYXRhLCAgICAgICAgICAgLy8gWzE1MTE4MjM2NjAsIDIwMCwgMCwgMTUxMjQyODM0MCwgMjQwLCAwLCAxNTEzMDMzMTQwLCAzMDAsIDBdCiAgICAgICAgICAgICAgICB1aW50MjU2IGZhbGxiYWNrRXhjaGFuZ2VSYXRlLCAvLyAzMDAwMAogICAgICAgICAgICAgICAgdWludDI1NiBjYXBBbW91bnRJbkNlbnRzLCAgICAgLy8gOTkwMDAwMDAwMDAKICAgICAgICAgICAgICAgIHVpbnQyNTYgZW5kVGltZSwgICAgICAgICAgICAgIC8vIDE1MTE5NzQ4MDAKICAgICAgICAgICAgICAgIHVpbnQ4IHBlcmNlbnRCdXJuLCAgICAgICAgICAgIC8vIDEwMAogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlVG9rZW4gdG9rZW4pICAgICAgICAgLy8gMHg4MGJjNTUxMjU2MWM3Zjg1YTNhOTUwOGM3ZGY3OTAxYjM3MGZhMWRmCiAgewogIAlzYWxlLmluaXQob3duZXIsIHNhbGVEYXRhLCBmYWxsYmFja0V4Y2hhbmdlUmF0ZSwgY2FwQW1vdW50SW5DZW50cywgZW5kVGltZSwgcGVyY2VudEJ1cm4sIHRva2VuKTsKICB9CgogIC8vIGZhbGxiYWNrIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHRvIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgIHNlbmRQdXJjaGFzZSgpOwogIH0KCiAgZnVuY3Rpb24gc2VuZFB1cmNoYXNlKCkgcGF5YWJsZSByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IF90b2tlbnNTb2xkID0gZ2V0VG9rZW5zU29sZCgpOwogICAgaWYoX3Rva2Vuc1NvbGQgPiAyNzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgJiYgKCFncmVlbnNob2VBY3RpdmUpKXsKICAgICAgYm9vbCBzdWNjZXNzID0gYWN0aXZhdGVHcmVlbnNob2UoKTsKICAgICAgYXNzZXJ0KHN1Y2Nlc3MpOwogICAgfQogIAlyZXR1cm4gc2FsZS5yZWNlaXZlUHVyY2hhc2UobXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFjdGl2YXRlR3JlZW5zaG9lKCkgcHJpdmF0ZSByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IF9jdXJyZW50UHJpY2UgPSBzYWxlLmJhc2Uuc2FsZURhdGFbc2FsZS5iYXNlLm1pbGVzdG9uZVRpbWVzW3NhbGUuYmFzZS5jdXJyZW50TWlsZXN0b25lXV1bMF07CiAgICB3aGlsZShzYWxlLmJhc2UubWlsZXN0b25lVGltZXMubGVuZ3RoID4gc2FsZS5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxKQogICAgewogICAgICBzYWxlLmJhc2UuY3VycmVudE1pbGVzdG9uZSArPSAxOwogICAgICBzYWxlLmJhc2Uuc2FsZURhdGFbc2FsZS5iYXNlLm1pbGVzdG9uZVRpbWVzW3NhbGUuYmFzZS5jdXJyZW50TWlsZXN0b25lXV1bMF0gPSBfY3VycmVudFByaWNlOwogICAgfQogICAgZ3JlZW5zaG9lQWN0aXZlID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKSByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBzYWxlLndpdGhkcmF3VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKCkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNhbGUud2l0aGRyYXdMZWZ0b3ZlcldlaSgpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aCgpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLndpdGhkcmF3T3duZXJFdGgoKTsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUFjdGl2ZSgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLmNyb3dkc2FsZUFjdGl2ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlRW5kZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZS5jcm93ZHNhbGVFbmRlZCgpOwogIH0KCiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUodWludDI1NiBfZXhjaGFuZ2VSYXRlKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZS5zZXRUb2tlbkV4Y2hhbmdlUmF0ZShfZXhjaGFuZ2VSYXRlKTsKICB9CgogIGZ1bmN0aW9uIHNldFRva2VucygpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLnNldFRva2VucygpOwogIH0KCiAgZnVuY3Rpb24gZ2V0T3duZXIoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gc2FsZS5iYXNlLm93bmVyOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zUGVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS50b2tlbnNQZXJFdGg7CiAgfQoKICBmdW5jdGlvbiBnZXRFeGNoYW5nZVJhdGUoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2FsZS5iYXNlLmV4Y2hhbmdlUmF0ZTsKICB9CgogIGZ1bmN0aW9uIGdldENhcEFtb3VudCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmKCFncmVlbnNob2VBY3RpdmUpIHsKICAgICAgcmV0dXJuIHNhbGUuYmFzZS5jYXBBbW91bnQgLSA1NTAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gc2FsZS5iYXNlLmNhcEFtb3VudDsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldFN0YXJ0VGltZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uuc3RhcnRUaW1lOwogIH0KCiAgZnVuY3Rpb24gZ2V0RW5kVGltZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2UuZW5kVGltZTsKICB9CgogIGZ1bmN0aW9uIGdldEV0aFJhaXNlZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uub3duZXJCYWxhbmNlOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0aW9uKGFkZHJlc3MgX2J1eWVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgCXJldHVybiBzYWxlLmJhc2UuaGFzQ29udHJpYnV0ZWRbX2J1eWVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2VuUHVyY2hhc2UoYWRkcmVzcyBfYnV5ZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAJcmV0dXJuIHNhbGUuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFtfYnV5ZXJdOwogIH0KCiAgZnVuY3Rpb24gZ2V0TGVmdG92ZXJXZWkoYWRkcmVzcyBfYnV5ZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2UubGVmdG92ZXJXZWlbX2J1eWVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFNhbGVEYXRhKHVpbnQyNTYgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2WzNdKSB7CiAgICByZXR1cm4gc2FsZS5nZXRTYWxlRGF0YSh0aW1lc3RhbXApOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uuc3RhcnRpbmdUb2tlbkJhbGFuY2UgLSBzYWxlLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2FsZS5iYXNlLm93bmVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFBlcmNlbnRCdXJuKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5wZXJjZW50QnVybjsKICB9Cn0KCmxpYnJhcnkgRGlyZWN0Q3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CiAgdXNpbmcgQ3Jvd2RzYWxlTGliIGZvciBDcm93ZHNhbGVMaWIuQ3Jvd2RzYWxlU3RvcmFnZTsKCiAgc3RydWN0IERpcmVjdENyb3dkc2FsZVN0b3JhZ2UgewoKICAJQ3Jvd2RzYWxlTGliLkNyb3dkc2FsZVN0b3JhZ2UgYmFzZTsgLy8gYmFzZSBzdG9yYWdlIGZyb20gQ3Jvd2RzYWxlTGliCgogIH0KCiAgZXZlbnQgTG9nVG9rZW5zQm91Z2h0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IExvZ0FkZHJlc3NDYXBFeGNlZWRlZChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKICBldmVudCBMb2dFcnJvck1zZyh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nVG9rZW5QcmljZUNoYW5nZSh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CgoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIGNlbnRzIGF0IHRoYXQgdGltZSwKICAvLy8gMyBpcyBhZGRyZXNzIHB1cmNoYXNlIGNhcCBhdCB0aGF0IHRpbWUsIDAgaWYgbm8gYWRkcmVzcyBjYXAKICAvLy8gQHBhcmFtIF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSBFeGNoYW5nZSByYXRlIG9mIGNlbnRzL0VUSAogIC8vLyBAcGFyYW0gX2NhcEFtb3VudEluQ2VudHMgVG90YWwgdG8gYmUgcmFpc2VkIGluIGNlbnRzCiAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaW1lc3RhbXAgb2Ygc2FsZSBlbmQgdGltZQogIC8vLyBAcGFyYW0gX3BlcmNlbnRCdXJuIFBlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHBhcmFtIF90b2tlbiBUb2tlbiBiZWluZyBzb2xkCiAgZnVuY3Rpb24gaW5pdChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICB1aW50OCBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICBDcm93ZHNhbGVUb2tlbiBfdG9rZW4pCiAgewogIAlzZWxmLmJhc2UuaW5pdChfb3duZXIsCiAgICAgICAgICAgICAgICBfc2FsZURhdGEsCiAgICAgICAgICAgICAgICBfZmFsbGJhY2tFeGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIF9lbmRUaW1lLAogICAgICAgICAgICAgICAgX3BlcmNlbnRCdXJuLAogICAgICAgICAgICAgICAgX3Rva2VuKTsKICB9CgogIC8vLyBAZGV2IENhbGxlZCB3aGVuIGFuIGFkZHJlc3Mgd2FudHMgdG8gcHVyY2hhc2UgdG9rZW5zCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9hbW91bnQgYW1vdW50IG9mIHdlaSB0aGF0IHRoZSBidXllciBpcyBzZW5kaW5nCiAgLy8vIEByZXR1cm4gdHJ1ZSBvbiBzdWNjZXNmdWwgcHVyY2hhc2UKICBmdW5jdGlvbiByZWNlaXZlUHVyY2hhc2UoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IHNlbGYuYmFzZS5vd25lcik7CiAgCXJlcXVpcmUoc2VsZi5iYXNlLnZhbGlkUHVyY2hhc2UoKSk7CgogICAgcmVxdWlyZSgoc2VsZi5iYXNlLm93bmVyQmFsYW5jZSArIF9hbW91bnQpIDw9IHNlbGYuYmFzZS5jYXBBbW91bnQpOwoKICAJLy8gaWYgdGhlIHRva2VuIHByaWNlIGluY3JlYXNlIGludGVydmFsIGhhcyBwYXNzZWQsIHVwZGF0ZSB0aGUgY3VycmVudCBkYXkgYW5kIGNoYW5nZSB0aGUgdG9rZW4gcHJpY2UKICAJaWYgKChzZWxmLmJhc2UubWlsZXN0b25lVGltZXMubGVuZ3RoID4gc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxKSAmJgogICAgICAgIChub3cgPiBzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxXSkpCiAgICB7CiAgICAgICAgd2hpbGUoKHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lcy5sZW5ndGggPiBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDEpICYmCiAgICAgICAgICAgICAgKG5vdyA+IHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDFdKSkKICAgICAgICB7CiAgICAgICAgICBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5iYXNlLmNoYW5nZVRva2VuUHJpY2Uoc2VsZi5iYXNlLnNhbGVEYXRhW3NlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZV1dWzBdKTsKICAgICAgICBMb2dUb2tlblByaWNlQ2hhbmdlKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgsIlRva2VuIFByaWNlIGhhcyBjaGFuZ2VkISIpOwogICAgfQoKICAJdWludDI1NiBfbnVtVG9rZW5zOyAvL251bWJlciBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHB1cmNoYXNlZAogICAgdWludDI1NiBfbmV3QmFsYW5jZTsgLy90aGUgbmV3IGJhbGFuY2Ugb2YgdGhlIG93bmVyIG9mIHRoZSBjcm93ZHNhbGUKICAgIHVpbnQyNTYgX3dlaVRva2VuczsgLy90ZW1wIGNhbGMgaG9sZGVyCiAgICB1aW50MjU2IF96ZXJvczsgLy9mb3IgY2FsY3VsYXRpbmcgdG9rZW4KICAgIHVpbnQyNTYgX2xlZnRvdmVyV2VpOyAvL3dlaSBjaGFuZ2UgZm9yIHB1cmNoYXNlcgogICAgdWludDI1NiBfcmVtYWluZGVyOyAvL3RlbXAgY2FsYyBob2xkZXIKICAgIGJvb2wgZXJyOwoKICAgIC8vIEZpbmQgdGhlIG51bWJlciBvZiB0b2tlbnMgYXMgYSBmdW5jdGlvbiBpbiB3ZWkKICAgIChlcnIsX3dlaVRva2VucykgPSBfYW1vdW50LnRpbWVzKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBpZihzZWxmLmJhc2UudG9rZW5EZWNpbWFscyA8PSAxOCl7CiAgICAgIF96ZXJvcyA9IDEwKiooMTgtdWludDI1NihzZWxmLmJhc2UudG9rZW5EZWNpbWFscykpOwogICAgICBfbnVtVG9rZW5zID0gX3dlaVRva2Vucy9femVyb3M7CiAgICAgIF9sZWZ0b3ZlcldlaSA9IF93ZWlUb2tlbnMgJSBfemVyb3M7CiAgICAgIHNlbGYuYmFzZS5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSArPSBfbGVmdG92ZXJXZWk7CiAgICB9IGVsc2UgewogICAgICBfemVyb3MgPSAxMCoqKHVpbnQyNTYoc2VsZi5iYXNlLnRva2VuRGVjaW1hbHMpLTE4KTsKICAgICAgX251bVRva2VucyA9IF93ZWlUb2tlbnMqX3plcm9zOwogICAgfQoKICAgIC8vIGNhbid0IG92ZXJmbG93IGJlY2F1c2UgaXQgaXMgdW5kZXIgdGhlIGNhcAogICAgc2VsZi5iYXNlLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdICs9IF9hbW91bnQgLSBfbGVmdG92ZXJXZWk7CgogICAgcmVxdWlyZShfbnVtVG9rZW5zIDw9IHNlbGYuYmFzZS50b2tlbi5iYWxhbmNlT2YodGhpcykpOwoKICAgIC8vIGNhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIGV0aGVyIGluIHRoZSBvd25lcnMgYmFsYW5jZQogICAgKGVycixfbmV3QmFsYW5jZSkgPSBzZWxmLmJhc2Uub3duZXJCYWxhbmNlLnBsdXMoX2Ftb3VudC1fbGVmdG92ZXJXZWkpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLmJhc2Uub3duZXJCYWxhbmNlID0gX25ld0JhbGFuY2U7ICAgLy8gImRlcG9zaXQiIHRoZSBhbW91bnQKCiAgICAvLyBjYW4ndCBvdmVyZmxvdyBiZWNhdXNlIGl0IHdpbGwgYmUgdW5kZXIgdGhlIGNhcAoJICBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gKz0gX251bVRva2VuczsKCiAgICAvL3N1YnRyYWN0IHRva2VucyBmcm9tIG93bmVyJ3Mgc2hhcmUKICAgIChlcnIsX3JlbWFpbmRlcikgPSBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2VsZi5iYXNlLm93bmVyXS5taW51cyhfbnVtVG9rZW5zKTsKICAgIHNlbGYuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFtzZWxmLmJhc2Uub3duZXJdID0gX3JlbWFpbmRlcjsKCgkgIExvZ1Rva2Vuc0JvdWdodChtc2cuc2VuZGVyLCBfbnVtVG9rZW5zKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qRnVuY3Rpb25zICJpbmhlcml0ZWQiIGZyb20gQ3Jvd2RzYWxlTGliIGxpYnJhcnkqLwoKICBmdW5jdGlvbiBzZXRUb2tlbkV4Y2hhbmdlUmF0ZShEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfZXhjaGFuZ2VSYXRlKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLnNldFRva2VuRXhjaGFuZ2VSYXRlKF9leGNoYW5nZVJhdGUpOwogIH0KCiAgZnVuY3Rpb24gc2V0VG9rZW5zKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLnNldFRva2VucygpOwogIH0KCiAgZnVuY3Rpb24gZ2V0U2FsZURhdGEoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgdGltZXN0YW1wKSByZXR1cm5zICh1aW50MjU2WzNdKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmdldFNhbGVEYXRhKHRpbWVzdGFtcCk7CiAgfQoKICBmdW5jdGlvbiBnZXRUb2tlbnNTb2xkKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmdldFRva2Vuc1NvbGQoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLndpdGhkcmF3TGVmdG92ZXJXZWkoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3T3duZXJFdGgoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdPd25lckV0aCgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlQWN0aXZlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmNyb3dkc2FsZUFjdGl2ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlRW5kZWQoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuY3Jvd2RzYWxlRW5kZWQoKTsKICB9CgogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UudmFsaWRQdXJjaGFzZSgpOwogIH0KfQoKbGlicmFyeSBDcm93ZHNhbGVMaWIgewogIHVzaW5nIEJhc2ljTWF0aExpYiBmb3IgdWludDI1NjsKCiAgc3RydWN0IENyb3dkc2FsZVN0b3JhZ2UgewogIAlhZGRyZXNzIG93bmVyOyAgICAgLy9vd25lciBvZiB0aGUgY3Jvd2RzYWxlCgogIAl1aW50MjU2IHRva2Vuc1BlckV0aDsgIC8vbnVtYmVyIG9mIHRva2VucyByZWNlaXZlZCBwZXIgZXRoZXIKICAJdWludDI1NiBjYXBBbW91bnQ7IC8vTWF4aW11bSBhbW91bnQgdG8gYmUgcmFpc2VkIGluIHdlaQogIAl1aW50MjU2IHN0YXJ0VGltZTsgLy9JQ08gc3RhcnQgdGltZSwgdGltZXN0YW1wCiAgCXVpbnQyNTYgZW5kVGltZTsgLy9JQ08gZW5kIHRpbWUsIHRpbWVzdGFtcCBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQKICAgIHVpbnQyNTYgZXhjaGFuZ2VSYXRlOyAvL2NlbnRzL0VUSCBleGNoYW5nZSByYXRlIGF0IHRoZSB0aW1lIG9mIHRoZSBzYWxlCiAgICB1aW50MjU2IG93bmVyQmFsYW5jZTsgLy9vd25lciB3ZWkgQmFsYW5jZQogICAgdWludDI1NiBzdGFydGluZ1Rva2VuQmFsYW5jZTsgLy9pbml0aWFsIGFtb3VudCBvZiB0b2tlbnMgZm9yIHNhbGUKICAgIHVpbnQyNTZbXSBtaWxlc3RvbmVUaW1lczsgLy9BcnJheSBvZiB0aW1lc3RhbXBzIHdoZW4gdG9rZW4gcHJpY2UgYW5kIGFkZHJlc3MgY2FwIGNoYW5nZXMKICAgIHVpbnQ4IGN1cnJlbnRNaWxlc3RvbmU7IC8vUG9pbnRlciB0byB0aGUgY3VycmVudCBtaWxlc3RvbmUKICAgIHVpbnQ4IHRva2VuRGVjaW1hbHM7IC8vc3RvcmVkIHRva2VuIGRlY2ltYWxzIGZvciBjYWxjdWxhdGlvbiBsYXRlcgogICAgdWludDggcGVyY2VudEJ1cm47IC8vcGVyY2VudGFnZSBvZiBleHRyYSB0b2tlbnMgdG8gYnVybgogICAgYm9vbCB0b2tlbnNTZXQ7IC8vdHJ1ZSBpZiB0b2tlbnMgaGF2ZSBiZWVuIHByZXBhcmVkIGZvciBjcm93ZHNhbGUKICAgIGJvb2wgcmF0ZVNldDsgLy90cnVlIGlmIGV4Y2hhbmdlIHJhdGUgaGFzIGJlZW4gc2V0CgogICAgLy9NYXBzIHRpbWVzdGFtcCB0byB0b2tlbiBwcmljZSBhbmQgYWRkcmVzcyBwdXJjaGFzZSBjYXAgc3RhcnRpbmcgYXQgdGhhdCB0aW1lCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTZbMl0pIHNhbGVEYXRhOwoKICAgIC8vc2hvd3MgaG93IG11Y2ggd2VpIGFuIGFkZHJlc3MgaGFzIGNvbnRyaWJ1dGVkCiAgCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgaGFzQ29udHJpYnV0ZWQ7CgogICAgLy9Gb3IgdG9rZW4gd2l0aGRyYXcgZnVuY3Rpb24sIG1hcHMgYSB1c2VyIGFkZHJlc3MgdG8gdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhleSBjYW4gd2l0aGRyYXcKICAJbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSB3aXRoZHJhd1Rva2Vuc01hcDsKCiAgICAvLyBhbnkgbGVmdG92ZXIgd2VpIHRoYXQgYnV5ZXJzIGNvbnRyaWJ1dGVkIHRoYXQgZGlkbid0IGFkZCB1cCB0byBhIHdob2xlIHRva2VuIGFtb3VudAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBsZWZ0b3ZlcldlaTsKCiAgCUNyb3dkc2FsZVRva2VuIHRva2VuOyAvL3Rva2VuIGJlaW5nIHNvbGQKICB9CgogIC8vIEluZGljYXRlcyB3aGVuIGFuIGFkZHJlc3MgaGFzIHdpdGhkcmF3biB0aGVpciBzdXBwbHkgb2YgdG9rZW5zCiAgZXZlbnQgTG9nVG9rZW5zV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfYmlkZGVyLCB1aW50MjU2IEFtb3VudCk7CgogIC8vIEluZGljYXRlcyB3aGVuIGFuIGFkZHJlc3MgaGFzIHdpdGhkcmF3biB0aGVpciBzdXBwbHkgb2YgZXh0cmEgd2VpCiAgZXZlbnQgTG9nV2VpV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfYmlkZGVyLCB1aW50MjU2IEFtb3VudCk7CgogIC8vIExvZ3Mgd2hlbiBvd25lciBoYXMgcHVsbGVkIGV0aAogIGV2ZW50IExvZ093bmVyRXRoV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKICAvLyBHZW5lcmljIE5vdGljZSBtZXNzYWdlIHRoYXQgaW5jbHVkZXMgYW5kIGFkZHJlc3MgYW5kIG51bWJlcgogIGV2ZW50IExvZ05vdGljZU1zZyhhZGRyZXNzIF9idXllciwgdWludDI1NiB2YWx1ZSwgc3RyaW5nIE1zZyk7CgogIC8vIEluZGljYXRlcyB3aGVuIGFuIGVycm9yIGhhcyBvY2N1cnJlZCBpbiB0aGUgZXhlY3V0aW9uIG9mIGEgZnVuY3Rpb24KICBldmVudCBMb2dFcnJvck1zZyhzdHJpbmcgTXNnKTsKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIGNyb3dkc2FsZSBvd25lcgogIC8vLyBAcGFyYW0gX3NhbGVEYXRhIEFycmF5IG9mIDMgaXRlbSBzZXRzIHN1Y2ggdGhhdCwgaW4gZWFjaCAzIGVsZW1lbnQKICAvLy8gc2V0LCAxIGlzIHRpbWVzdGFtcCwgMiBpcyBwcmljZSBpbiBjZW50cyBhdCB0aGF0IHRpbWUsCiAgLy8vIDMgaXMgYWRkcmVzcyB0b2tlbiBwdXJjaGFzZSBjYXAgYXQgdGhhdCB0aW1lLCAwIGlmIG5vIGFkZHJlc3MgY2FwCiAgLy8vIEBwYXJhbSBfZmFsbGJhY2tFeGNoYW5nZVJhdGUgRXhjaGFuZ2UgcmF0ZSBvZiBjZW50cy9FVEgKICAvLy8gQHBhcmFtIF9jYXBBbW91bnRJbkNlbnRzIFRvdGFsIHRvIGJlIHJhaXNlZCBpbiBjZW50cwogIC8vLyBAcGFyYW0gX2VuZFRpbWUgVGltZXN0YW1wIG9mIHNhbGUgZW5kIHRpbWUKICAvLy8gQHBhcmFtIF9wZXJjZW50QnVybiBQZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgLy8vIEBwYXJhbSBfdG9rZW4gVG9rZW4gYmVpbmcgc29sZAogIGZ1bmN0aW9uIGluaXQoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTZbXSBfc2FsZURhdGEsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2NhcEFtb3VudEluQ2VudHMsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9lbmRUaW1lLAogICAgICAgICAgICAgICAgdWludDggX3BlcmNlbnRCdXJuLAogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlVG9rZW4gX3Rva2VuKQogIHsKICAJcmVxdWlyZShzZWxmLmNhcEFtb3VudCA9PSAwKTsKICAJcmVxdWlyZShzZWxmLm93bmVyID09IDApOwogICAgcmVxdWlyZShfc2FsZURhdGEubGVuZ3RoID4gMCk7CiAgICByZXF1aXJlKChfc2FsZURhdGEubGVuZ3RoJTMpID09IDApOyAvLyBlbnN1cmUgc2FsZURhdGEgaXMgMy1pdGVtIHNldHMKICAgIHJlcXVpcmUoX3NhbGVEYXRhWzBdID4gKG5vdyArIDMgZGF5cykpOwogICAgcmVxdWlyZShfZW5kVGltZSA+IF9zYWxlRGF0YVswXSk7CiAgICByZXF1aXJlKF9jYXBBbW91bnRJbkNlbnRzID4gMCk7CiAgICByZXF1aXJlKF9vd25lciA+IDApOwogICAgcmVxdWlyZShfZmFsbGJhY2tFeGNoYW5nZVJhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3BlcmNlbnRCdXJuIDw9IDEwMCk7CiAgICBzZWxmLm93bmVyID0gX293bmVyOwogICAgc2VsZi5jYXBBbW91bnQgPSAoKF9jYXBBbW91bnRJbkNlbnRzL19mYWxsYmFja0V4Y2hhbmdlUmF0ZSkgKyAxKSooMTAqKjE4KTsKICAgIHNlbGYuc3RhcnRUaW1lID0gX3NhbGVEYXRhWzBdOwogICAgc2VsZi5lbmRUaW1lID0gX2VuZFRpbWU7CiAgICBzZWxmLnRva2VuID0gX3Rva2VuOwogICAgc2VsZi50b2tlbkRlY2ltYWxzID0gX3Rva2VuLmRlY2ltYWxzKCk7CiAgICBzZWxmLnBlcmNlbnRCdXJuID0gX3BlcmNlbnRCdXJuOwogICAgc2VsZi5leGNoYW5nZVJhdGUgPSBfZmFsbGJhY2tFeGNoYW5nZVJhdGU7CgogICAgdWludDI1NiBfdGVtcFRpbWU7CiAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IF9zYWxlRGF0YS5sZW5ndGg7IGkgKz0gMyl7CiAgICAgIHJlcXVpcmUoX3NhbGVEYXRhW2ldID4gX3RlbXBUaW1lKTsKICAgICAgcmVxdWlyZShfc2FsZURhdGFbaSArIDFdID4gMCk7CiAgICAgIHJlcXVpcmUoKF9zYWxlRGF0YVtpICsgMl0gPT0gMCkgfHwgKF9zYWxlRGF0YVtpICsgMl0gPj0gMTAwKSk7CiAgICAgIHNlbGYubWlsZXN0b25lVGltZXMucHVzaChfc2FsZURhdGFbaV0pOwogICAgICBzZWxmLnNhbGVEYXRhW19zYWxlRGF0YVtpXV1bMF0gPSBfc2FsZURhdGFbaSArIDFdOwogICAgICBzZWxmLnNhbGVEYXRhW19zYWxlRGF0YVtpXV1bMV0gPSBfc2FsZURhdGFbaSArIDJdOwogICAgICBfdGVtcFRpbWUgPSBfc2FsZURhdGFbaV07CiAgICB9CiAgICBjaGFuZ2VUb2tlblByaWNlKHNlbGYsIF9zYWxlRGF0YVsxXSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBhY3RpdmUKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHN1Y2Nlc3MKICBmdW5jdGlvbiBjcm93ZHNhbGVBY3RpdmUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIChub3cgPj0gc2VsZi5zdGFydFRpbWUgJiYgbm93IDw9IHNlbGYuZW5kVGltZSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gc3VjY2VzcwogIGZ1bmN0aW9uIGNyb3dkc2FsZUVuZGVkKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBub3cgPiBzZWxmLmVuZFRpbWU7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiBhIHB1cmNoYXNlIGlzIHZhbGlkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICBpZiAoY3Jvd2RzYWxlQWN0aXZlKHNlbGYpICYmIG5vblplcm9QdXJjaGFzZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIExvZ0Vycm9yTXNnKCJJbnZhbGlkIFB1cmNoYXNlISBDaGVjayBzZW5kIHRpbWUgYW5kIGFtb3VudCBvZiBldGhlci4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gY2FsbGVkIGJ5IHB1cmNoYXNlcnMgdG8gcHVsbCB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHdlcmUgd2l0aGRyYXduCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgb2s7CgogICAgaWYgKHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPT0gMCkgewogICAgICBMb2dFcnJvck1zZygiU2VuZGVyIGhhcyBubyB0b2tlbnMgdG8gd2l0aGRyYXchIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKSB7CiAgICAgIGlmKCFjcm93ZHNhbGVFbmRlZChzZWxmKSl7CiAgICAgICAgTG9nRXJyb3JNc2coIk93bmVyIGNhbm5vdCB3aXRoZHJhdyBleHRyYSB0b2tlbnMgdW50aWwgYWZ0ZXIgdGhlIHNhbGUhIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIGlmKHNlbGYucGVyY2VudEJ1cm4gPiAwKXsKICAgICAgICAgIHVpbnQyNTYgX2J1cm5BbW91bnQgPSAoc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSAqIHNlbGYucGVyY2VudEJ1cm4pLzEwMDsKICAgICAgICAgIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPSBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdIC0gX2J1cm5BbW91bnQ7CiAgICAgICAgICBvayA9IHNlbGYudG9rZW4uYnVyblRva2VuKF9idXJuQW1vdW50KTsKICAgICAgICAgIHJlcXVpcmUob2spOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHZhciB0b3RhbCA9IHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl07CiAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gMDsKICAgIG9rID0gc2VsZi50b2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXF1aXJlKG9rKTsKICAgIExvZ1Rva2Vuc1dpdGhkcmF3bihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIGNhbGxlZCBieSBwdXJjaGFzZXJzIHRvIHB1bGwgbGVmdG92ZXIgd2VpIGZyb20gdGhlaXIgcHVyY2hhc2VzCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHdlaSB3YXMgd2l0aGRyYXduCiAgZnVuY3Rpb24gd2l0aGRyYXdMZWZ0b3ZlcldlaShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShzZWxmLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdID4gMCk7CiAgICBpZiAoc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSA9PSAwKSB7CiAgICAgIExvZ0Vycm9yTXNnKCJTZW5kZXIgaGFzIG5vIGV4dHJhIHdlaSB0byB3aXRoZHJhdyEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHZhciB0b3RhbCA9IHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl07CiAgICBzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdID0gMDsKICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodG90YWwpOwogICAgTG9nV2VpV2l0aGRyYXduKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgc2VuZCBldGhlciBmcm9tIHRoZSBjb21wbGV0ZWQgY3Jvd2RzYWxlIHRvIHRoZSBvd25lcnMgd2FsbGV0IGFkZHJlc3MKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgb3duZXIgd2l0aGRyZXcgZXRoCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKCghY3Jvd2RzYWxlRW5kZWQoc2VsZikpICYmIChzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKT4wKSkgewogICAgICBMb2dFcnJvck1zZygiQ2Fubm90IHdpdGhkcmF3IG93bmVyIGV0aGVyIHVudGlsIGFmdGVyIHRoZSBzYWxlISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgcmVxdWlyZShzZWxmLm93bmVyQmFsYW5jZSA+IDApOwoKICAgIHVpbnQyNTYgYW1vdW50ID0gc2VsZi5vd25lckJhbGFuY2U7CiAgICBzZWxmLm93bmVyQmFsYW5jZSA9IDA7CiAgICBzZWxmLm93bmVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICBMb2dPd25lckV0aFdpdGhkcmF3bihtc2cuc2VuZGVyLGFtb3VudCwiQ3Jvd2RzYWxlIG93bmVyIGhhcyB3aXRoZHJhd24gYWxsIGZ1bmRzISIpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBwcmljZSBvZiB0aGUgdG9rZW4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX25ld1ByaWNlIG5ldyB0b2tlbiBwcmljZSAoYW1vdW50IG9mIHRva2VucyBwZXIgZXRoZXIpCiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdG9rZW4gcHJpY2UgY2hhbmdlZCBzdWNjZXNzZnVsbHkKICBmdW5jdGlvbiBjaGFuZ2VUb2tlblByaWNlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLHVpbnQyNTYgX25ld1ByaWNlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgCXJlcXVpcmUoX25ld1ByaWNlID4gMCk7CgogICAgdWludDI1NiByZXN1bHQ7CiAgICB1aW50MjU2IHJlbWFpbmRlcjsKCiAgICByZXN1bHQgPSBzZWxmLmV4Y2hhbmdlUmF0ZSAvIF9uZXdQcmljZTsKICAgIHJlbWFpbmRlciA9IHNlbGYuZXhjaGFuZ2VSYXRlICUgX25ld1ByaWNlOwogICAgaWYocmVtYWluZGVyID4gMCkgewogICAgICBzZWxmLnRva2Vuc1BlckV0aCA9IHJlc3VsdCArIDE7CiAgICB9IGVsc2UgewogICAgICBzZWxmLnRva2Vuc1BlckV0aCA9IHJlc3VsdDsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgdGhyZWUgZGF5cyBiZWZvcmUgdGhlIHNhbGUgdG8gc2V0IHRoZSB0b2tlbiBhbmQgcHJpY2UKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX2V4Y2hhbmdlUmF0ZSAgRVRIIGV4Y2hhbmdlIHJhdGUgZXhwcmVzc2VkIGluIGNlbnRzL0VUSAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIGV4Y2hhbmdlIHJhdGUgaGFzIGJlZW4gc2V0CiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2V4Y2hhbmdlUmF0ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgcmVxdWlyZSgobm93ID4gKHNlbGYuc3RhcnRUaW1lIC0gMyBkYXlzKSkgJiYgKG5vdyA8IChzZWxmLnN0YXJ0VGltZSkpKTsKICAgIHJlcXVpcmUoIXNlbGYucmF0ZVNldCk7ICAgLy8gdGhlIGV4Y2hhbmdlIHJhdGUgY2FuIG9ubHkgYmUgc2V0IG9uY2UhCiAgICByZXF1aXJlKHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpID4gMCk7CiAgICByZXF1aXJlKF9leGNoYW5nZVJhdGUgPiAwKTsKCiAgICB1aW50MjU2IF9jYXBBbW91bnRJbkNlbnRzOwogICAgdWludDI1NiBfdG9rZW5CYWxhbmNlOwogICAgYm9vbCBlcnI7CgogICAgKGVyciwgX2NhcEFtb3VudEluQ2VudHMpID0gc2VsZi5leGNoYW5nZVJhdGUudGltZXMoc2VsZi5jYXBBbW91bnQpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBfdG9rZW5CYWxhbmNlID0gc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYuc3RhcnRpbmdUb2tlbkJhbGFuY2UgPSBfdG9rZW5CYWxhbmNlOwogICAgc2VsZi50b2tlbnNTZXQgPSB0cnVlOwoKICAgIHNlbGYuZXhjaGFuZ2VSYXRlID0gX2V4Y2hhbmdlUmF0ZTsKICAgIHNlbGYuY2FwQW1vdW50ID0gKF9jYXBBbW91bnRJbkNlbnRzL19leGNoYW5nZVJhdGUpICsgMTsKICAgIGNoYW5nZVRva2VuUHJpY2Uoc2VsZixzZWxmLnNhbGVEYXRhW3NlbGYubWlsZXN0b25lVGltZXNbMF1dWzBdKTsKICAgIHNlbGYucmF0ZVNldCA9IHRydWU7CgogICAgTG9nTm90aWNlTXNnKG1zZy5zZW5kZXIsc2VsZi50b2tlbnNQZXJFdGgsIk93bmVyIGhhcyBzZW50IHRoZSBleGNoYW5nZSBSYXRlIGFuZCB0b2tlbnMgYm91Z2h0IHBlciBFVEghIik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHNldCB0b2tlbnMgaWYgdGhlIGV4Y2hhbmdlIHJhdGUgZnVuY3Rpb24gd2FzIG5vdCBjYWxsZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHNldCBzdWNjZXNzZnVsbHkKICBmdW5jdGlvbiBzZXRUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoIXNlbGYudG9rZW5zU2V0KTsKCiAgICB1aW50MjU2IF90b2tlbkJhbGFuY2U7CgogICAgX3Rva2VuQmFsYW5jZSA9IHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IF90b2tlbkJhbGFuY2U7CiAgICBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYudG9rZW5zU2V0ID0gdHJ1ZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEdldHMgdGhlIHByaWNlIGFuZCBidXkgY2FwIGZvciBpbmRpdmlkdWFsIGFkZHJlc3NlcyBhdCB0aGUgZ2l2ZW4gbWlsZXN0b25lIGluZGV4CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIHRpbWVzdGFtcCBUaW1lIGR1cmluZyBzYWxlIGZvciB3aGljaCBkYXRhIGlzIHJlcXVlc3RlZAogIC8vLyBAcmV0dXJuIEEgMy1lbGVtZW50IGFycmF5IHdpdGggMCB0aGUgdGltZXN0YW1wLCAxIHRoZSBwcmljZSBpbiBjZW50cywgMiB0aGUgYWRkcmVzcyBjYXAKICBmdW5jdGlvbiBnZXRTYWxlRGF0YShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiB0aW1lc3RhbXApIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTZbM10pIHsKICAgIHVpbnQyNTZbM10gbWVtb3J5IF90aGlzRGF0YTsKICAgIHVpbnQyNTYgaW5kZXg7CgogICAgd2hpbGUoKGluZGV4IDwgc2VsZi5taWxlc3RvbmVUaW1lcy5sZW5ndGgpICYmIChzZWxmLm1pbGVzdG9uZVRpbWVzW2luZGV4XSA8IHRpbWVzdGFtcCkpIHsKICAgICAgaW5kZXgrKzsKICAgIH0KICAgIGlmKGluZGV4ID09IDApCiAgICAgIGluZGV4Kys7CgogICAgX3RoaXNEYXRhWzBdID0gc2VsZi5taWxlc3RvbmVUaW1lc1tpbmRleCAtIDFdOwogICAgX3RoaXNEYXRhWzFdID0gc2VsZi5zYWxlRGF0YVtfdGhpc0RhdGFbMF1dWzBdOwogICAgX3RoaXNEYXRhWzJdID0gc2VsZi5zYWxlRGF0YVtfdGhpc0RhdGFbMF1dWzFdOwogICAgcmV0dXJuIF90aGlzRGF0YTsKICB9CgogIC8vLyBAZGV2IEdldHMgdGhlIG51bWJlciBvZiB0b2tlbnMgc29sZCB0aHVzIGZhcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgQ3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIHRva2VucyBzb2xkCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYuc3RhcnRpbmdUb2tlbkJhbGFuY2UgLSBzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKTsKICB9Cn0KCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIHsKICB1c2luZyBUb2tlbkxpYiBmb3IgVG9rZW5MaWIuVG9rZW5TdG9yYWdlOwoKICBUb2tlbkxpYi5Ub2tlblN0b3JhZ2UgcHVibGljIHRva2VuOwoKICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbihhZGRyZXNzIG93bmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDggZGVjaW1hbHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBpbml0aWFsU3VwcGx5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgYWxsb3dNaW50aW5nKQogIHsKICAgIHRva2VuLmluaXQob3duZXIsIG5hbWUsIHN5bWJvbCwgZGVjaW1hbHMsIGluaXRpYWxTdXBwbHksIGFsbG93TWludGluZyk7CiAgfQoKICBmdW5jdGlvbiBuYW1lKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gdG9rZW4ubmFtZTsKICB9CgogIGZ1bmN0aW9uIHN5bWJvbCgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIHRva2VuLnN5bWJvbDsKICB9CgogIGZ1bmN0aW9uIGRlY2ltYWxzKCkgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgIHJldHVybiB0b2tlbi5kZWNpbWFsczsKICB9CgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLnRvdGFsU3VwcGx5OwogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5JTklUSUFMX1NVUFBMWTsKICB9CgogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLmJhbGFuY2VPZih3aG8pOwogIH0KCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLmFsbG93YW5jZShvd25lciwgc3BlbmRlcik7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4uYXBwcm92ZShzcGVuZGVyLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIG5ld093bmVyKSByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4uY2hhbmdlT3duZXIobmV3T3duZXIpOwogIH0KCiAgZnVuY3Rpb24gYnVyblRva2VuKHVpbnQyNTYgYW1vdW50KSByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4uYnVyblRva2VuKGFtb3VudCk7CiAgfQp9CgpsaWJyYXJ5IFRva2VuTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CgogIHN0cnVjdCBUb2tlblN0b3JhZ2UgewogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICBzdHJpbmcgbmFtZTsKICAgIHN0cmluZyBzeW1ib2w7CiAgICB1aW50MjU2IHRvdGFsU3VwcGx5OwogICAgdWludDI1NiBJTklUSUFMX1NVUFBMWTsKICAgIGFkZHJlc3Mgb3duZXI7CiAgICB1aW50OCBkZWNpbWFsczsKICAgIGJvb2wgc3RpbGxNaW50aW5nOwogIH0KCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgT3duZXJDaGFuZ2UoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvKTsKICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBidXJuZXIsIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IE1pbnRpbmdDbG9zZWQoYm9vbCBtaW50aW5nQ2xvc2VkKTsKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IHRoZSBTdGFuZGFyZCBUb2tlbiB1cG9uIGNyZWF0aW9uLgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX25hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgLy8vIEBwYXJhbSBfc3ltYm9sIFN5bWJvbCBvZiB0aGUgbmV3IHRva2VuCiAgLy8vIEBwYXJhbSBfZGVjaW1hbHMgRGVjaW1hbCBwbGFjZXMgZm9yIHRoZSB0b2tlbiByZXByZXNlbnRlZAogIC8vLyBAcGFyYW0gX2luaXRpYWxfc3VwcGx5IFRoZSBpbml0aWFsIHRva2VuIHN1cHBseQogIC8vLyBAcGFyYW0gX2FsbG93TWludGluZyBUcnVlIGlmIGFkZGl0aW9uYWwgdG9rZW5zIGNhbiBiZSBjcmVhdGVkLCBmYWxzZSBvdGhlcndpc2UKICBmdW5jdGlvbiBpbml0KFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICAgICAgICAgIHN0cmluZyBfc3ltYm9sLAogICAgICAgICAgICAgICAgdWludDggX2RlY2ltYWxzLAogICAgICAgICAgICAgICAgdWludDI1NiBfaW5pdGlhbF9zdXBwbHksCiAgICAgICAgICAgICAgICBib29sIF9hbGxvd01pbnRpbmcpCiAgewogICAgcmVxdWlyZShzZWxmLklOSVRJQUxfU1VQUExZID09IDApOwogICAgc2VsZi5uYW1lID0gX25hbWU7CiAgICBzZWxmLnN5bWJvbCA9IF9zeW1ib2w7CiAgICBzZWxmLnRvdGFsU3VwcGx5ID0gX2luaXRpYWxfc3VwcGx5OwogICAgc2VsZi5JTklUSUFMX1NVUFBMWSA9IF9pbml0aWFsX3N1cHBseTsKICAgIHNlbGYuZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICBzZWxmLm93bmVyID0gX293bmVyOwogICAgc2VsZi5zdGlsbE1pbnRpbmcgPSBfYWxsb3dNaW50aW5nOwogICAgc2VsZi5iYWxhbmNlc1tfb3duZXJdID0gX2luaXRpYWxfc3VwcGx5OwogIH0KCiAgLy8vIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gY2FsbGVyJ3MgYWNjb3VudCB0byBhbm90aGVyIGFjY291bnQuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBzZW5kIHRva2VucwogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXIoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgYmFsYW5jZTsKCiAgICAoZXJyLGJhbGFuY2UpID0gc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKICAgIHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlOwogICAgLy9JdCdzIG5vdCBwb3NzaWJsZSB0byBvdmVyZmxvdyB0b2tlbiBzdXBwbHkKICAgIHNlbGYuYmFsYW5jZXNbX3RvXSA9IHNlbGYuYmFsYW5jZXNbX3RvXSArIF92YWx1ZTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgQXV0aG9yaXplZCBjYWxsZXIgdHJhbnNmZXJzIHRva2VucyBmcm9tIG9uZSBhY2NvdW50IHRvIGFub3RoZXIKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9mcm9tIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgZnJvbQogIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHNlbmQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBfdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgdmFyIF9hbGxvd2FuY2UgPSBzZWxmLmFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwogICAgYm9vbCBlcnI7CiAgICB1aW50MjU2IGJhbGFuY2VPd25lcjsKICAgIHVpbnQyNTYgYmFsYW5jZVNwZW5kZXI7CgogICAgKGVycixiYWxhbmNlT3duZXIpID0gc2VsZi5iYWxhbmNlc1tfZnJvbV0ubWludXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgKGVycixiYWxhbmNlU3BlbmRlcikgPSBfYWxsb3dhbmNlLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYuYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZU93bmVyOwogICAgc2VsZi5hbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGJhbGFuY2VTcGVuZGVyOwogICAgc2VsZi5iYWxhbmNlc1tfdG9dID0gc2VsZi5iYWxhbmNlc1tfdG9dICsgX3ZhbHVlOwoKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFJldHJpZXZlIHRva2VuIGJhbGFuY2UgZm9yIGFuIGFjY291bnQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIHRvIHJldHJpZXZlIGJhbGFuY2Ugb2YKICAvLy8gQHJldHVybiBiYWxhbmNlIFRoZSBudW1iZXIgb2YgdG9rZW5zIGluIHRoZSBzdWJqZWN0IGFjY291bnQKICBmdW5jdGlvbiBiYWxhbmNlT2YoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIHNlbGYuYmFsYW5jZXNbX293bmVyXTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZSBhbiBhY2NvdW50IHRvIHNlbmQgdG9rZW5zIG9uIGNhbGxlcidzIGJlaGFsZgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyB0byBhdXRob3JpemUKICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIGF1dGhvcml6ZWQgYWNjb3VudCBtYXkgc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gYXBwcm92ZShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBSZW1haW5pbmcgdG9rZW5zIHRoaXJkIHBhcnR5IHNwZW5kZXIgaGFzIHRvIHNlbmQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIHRva2VuIGhvbGRlcgogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiBhdXRob3JpemVkIHNwZW5kZXIKICAvLy8gQHJldHVybiByZW1haW5pbmcgTnVtYmVyIG9mIHRva2VucyBzcGVuZGVyIGhhcyBsZWZ0IGluIG93bmVyJ3MgYWNjb3VudAogIGZ1bmN0aW9uIGFsbG93YW5jZShUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBzZWxmLmFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemUgdGhpcmQgcGFydHkgdHJhbnNmZXIgYnkgaW5jcmVhc2luZy9kZWNyZWFzaW5nIGFsbG93ZWQgcmF0aGVyIHRoYW4gc2V0dGluZyBpdAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyB0byBhdXRob3JpemUKICAvLy8gQHBhcmFtIF92YWx1ZUNoYW5nZSBJbmNyZWFzZSBvciBkZWNyZWFzZSBpbiBudW1iZXIgb2YgdG9rZW5zIGF1dGhvcml6ZWQgYWNjb3VudCBtYXkgc2VuZAogIC8vLyBAcGFyYW0gX2luY3JlYXNlIFRydWUgaWYgaW5jcmVhc2luZyBhbGxvd2FuY2UsIGZhbHNlIGlmIGRlY3JlYXNpbmcgYWxsb3dhbmNlCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBhcHByb3ZlQ2hhbmdlIChUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZUNoYW5nZSwgYm9vbCBfaW5jcmVhc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICB1aW50MjU2IF9uZXdBbGxvd2VkOwogICAgYm9vbCBlcnI7CgogICAgaWYoX2luY3JlYXNlKSB7CiAgICAgIChlcnIsIF9uZXdBbGxvd2VkKSA9IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0ucGx1cyhfdmFsdWVDaGFuZ2UpOwogICAgICByZXF1aXJlKCFlcnIpOwoKICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9uZXdBbGxvd2VkOwogICAgfSBlbHNlIHsKICAgICAgaWYgKF92YWx1ZUNoYW5nZSA+IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pIHsKICAgICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBfbmV3QWxsb3dlZCA9IHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gLSBfdmFsdWVDaGFuZ2U7CiAgICAgICAgc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9uZXdBbGxvd2VkOwogICAgICB9CiAgICB9CgogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9uZXdBbGxvd2VkKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgQ2hhbmdlIG93bmluZyBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCwgc3BlY2lmaWNhbGx5IGZvciBtaW50aW5nCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfbmV3T3duZXIgQWRkcmVzcyBmb3IgdGhlIG5ldyBvd25lcgogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gY2hhbmdlT3duZXIoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfbmV3T3duZXIpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcikgJiYgKF9uZXdPd25lciA+IDApKTsKCiAgICBzZWxmLm93bmVyID0gX25ld093bmVyOwogICAgT3duZXJDaGFuZ2UobXNnLnNlbmRlciwgX25ld093bmVyKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgTWludHMgYWRkaXRpb25hbCB0b2tlbnMsIG5ldyB0b2tlbnMgZ28gdG8gb3duZXIKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9hbW91bnQgTnVtYmVyIG9mIHRva2VucyB0byBtaW50CiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBtaW50VG9rZW4oVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKChzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpICYmIHNlbGYuc3RpbGxNaW50aW5nKTsKICAgIHVpbnQyNTYgX25ld0Ftb3VudDsKICAgIGJvb2wgZXJyOwoKICAgIChlcnIsIF9uZXdBbW91bnQpID0gc2VsZi50b3RhbFN1cHBseS5wbHVzKF9hbW91bnQpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBzZWxmLnRvdGFsU3VwcGx5ID0gIF9uZXdBbW91bnQ7CiAgICBzZWxmLmJhbGFuY2VzW3NlbGYub3duZXJdID0gc2VsZi5iYWxhbmNlc1tzZWxmLm93bmVyXSArIF9hbW91bnQ7CiAgICBUcmFuc2ZlcigweDAsIHNlbGYub3duZXIsIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBQZXJtYW5lbnQgc3RvcHMgbWludGluZwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gY2xvc2VNaW50KFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKTsKCiAgICBzZWxmLnN0aWxsTWludGluZyA9IGZhbHNlOwogICAgTWludGluZ0Nsb3NlZCh0cnVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUGVybWFuZW50bHkgYnVybiB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9hbW91bnQgQW1vdW50IG9mIHRva2VucyB0byBidXJuCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBidXJuVG9rZW4oVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sKSB7CiAgICAgIHVpbnQyNTYgX25ld0JhbGFuY2U7CiAgICAgIGJvb2wgZXJyOwoKICAgICAgKGVyciwgX25ld0JhbGFuY2UpID0gc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXS5taW51cyhfYW1vdW50KTsKICAgICAgcmVxdWlyZSghZXJyKTsKCiAgICAgIHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBfbmV3QmFsYW5jZTsKICAgICAgc2VsZi50b3RhbFN1cHBseSA9IHNlbGYudG90YWxTdXBwbHkgLSBfYW1vdW50OwogICAgICBCdXJuKG1zZy5zZW5kZXIsIF9hbW91bnQpOwogICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCAweDAsIF9hbW91bnQpOwogICAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmxpYnJhcnkgQmFzaWNNYXRoTGliIHsKICBldmVudCBFcnIoc3RyaW5nIHR5cGVFcnIpOwoKICAvLy8gQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIG92ZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93IGJ1dCByYXRoZXIgbG9ncyBhbiBFcnIgZXZlbnQgaWYgdGhlcmUgaXMgb3ZlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBwcm9kdWN0IG9mIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICBmdW5jdGlvbiB0aW1lcyh1aW50MjU2IGEsIHVpbnQyNTYgYikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBlcnIsdWludDI1NiByZXMpIHsKICAgIGFzc2VtYmx5ewogICAgICByZXMgOj0gbXVsKGEsYikKICAgICAgc3dpdGNoIG9yKGlzemVybyhiKSwgZXEoZGl2KHJlcyxiKSwgYSkpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgICBpZiAoZXJyKQogICAgICBFcnIoInRpbWVzIGZ1bmMgb3ZlcmZsb3ciKTsKICB9CgogIC8vLyBAZGV2IERpdmlkZXMgdHdvIG51bWJlcnMgYnV0IGNoZWNrcyBmb3IgMCBpbiB0aGUgZGl2aXNvciBmaXJzdC4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiAwIGlzIGluIHRoZSBkaXZpc29yLgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiBgYmAgaXMgMAogIC8vLyBAcmV0dXJuIHJlcyBUaGUgcXVvdGllbnQgb2YgYSBhbmQgYiwgb3IgMCBpZiBgYmAgaXMgMAogIGZ1bmN0aW9uIGRpdmlkZWRCeSh1aW50MjU2IGEsIHVpbnQyNTYgYikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBlcnIsdWludDI1NiByZXMpIHsKICAgIGFzc2VtYmx5ewogICAgICBzd2l0Y2ggaXN6ZXJvKGIpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgcmVzIDo9IGRpdihhLGIpCiAgICAgICAgbXN0b3JlKGFkZChtbG9hZCgweDQwKSwweDIwKSxyZXMpCiAgICAgICAgcmV0dXJuKG1sb2FkKDB4NDApLDB4NDApCiAgICAgIH0KICAgIH0KICAgIEVycigidHJpZWQgdG8gZGl2aWRlIGJ5IHplcm8iKTsKICAgIHJldHVybiAodHJ1ZSwgMCk7CiAgfQoKICAvLy8gQGRldiBBZGRzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIG92ZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93IGJ1dCByYXRoZXIgbG9ncyBhbiBFcnIgZXZlbnQgaWYgdGhlcmUgaXMgb3ZlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBzdW0gb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHBsdXModWludDI1NiBhLCB1aW50MjU2IGIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZXJyLCB1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBhZGQoYSxiKQogICAgICBzd2l0Y2ggYW5kKGVxKHN1YihyZXMsYiksIGEpLCBvcihndChyZXMsYiksZXEocmVzLGIpKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICAgIGlmIChlcnIpCiAgICAgIEVycigicGx1cyBmdW5jIG92ZXJmbG93Iik7CiAgfQoKICAvLy8gQGRldiBTdWJ0cmFjdHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3IgdW5kZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93IGJ1dCByYXRoZXIgbG9ncyBhbiBFcnIgZXZlbnQgaWYgdGhlcmUgaXMgdW5kZXJmbG93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiB0aGVyZSBpcyB1bmRlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIGZ1bmN0aW9uIG1pbnVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBzdWIoYSxiKQogICAgICBzd2l0Y2ggZXEoYW5kKGVxKGFkZChyZXMsYiksIGEpLCBvcihsdChyZXMsYSksIGVxKHJlcyxhKSkpLCAxKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogICAgaWYgKGVycikKICAgICAgRXJyKCJtaW51cyBmdW5jIHVuZGVyZmxvdyIpOwogIH0KfQ=='.
	

]
