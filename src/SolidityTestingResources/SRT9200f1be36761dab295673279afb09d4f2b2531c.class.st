Class {
	#name : #SRT9200f1be36761dab295673279afb09d4f2b2531c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9200f1be36761dab295673279afb09d4f2b2531c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9Cgpjb250cmFjdCBRdWFudHN0YW1wU2FsZSBpcyBQYXVzYWJsZSB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy8gVGhlIGJlbmVmaWNpYXJ5IGlzIHRoZSBmdXR1cmUgcmVjaXBpZW50IG9mIHRoZSBmdW5kcwogICAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7CgogICAgLy8gVGhlIGNyb3dkc2FsZSBoYXMgYSBmdW5kaW5nIGdvYWwsIGNhcCwgZGVhZGxpbmUsIGFuZCBtaW5pbXVtIGNvbnRyaWJ1dGlvbgogICAgdWludCBwdWJsaWMgZnVuZGluZ0NhcDsKICAgIHVpbnQgcHVibGljIG1pbkNvbnRyaWJ1dGlvbjsKICAgIGJvb2wgcHVibGljIGZ1bmRpbmdDYXBSZWFjaGVkID0gZmFsc2U7CiAgICBib29sIHB1YmxpYyBzYWxlQ2xvc2VkID0gZmFsc2U7CgogICAgLy8gV2hpdGVsaXN0IGRhdGEKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgcmVnaXN0cnk7CgogICAgLy8gRm9yIGVhY2ggdXNlciwgc3BlY2lmaWVzIHRoZSBjYXAgKGluIHdlaSkgdGhhdCBjYW4gYmUgY29udHJpYnV0ZWQgZm9yIGVhY2ggdGllcgogICAgLy8gVGllcnMgYXJlIGZpbGxlZCBpbiB0aGUgb3JkZXIgMywgMiwgMSwgNAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjYXAxOyAgICAgICAgLy8gMTAwJSBib251cwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjYXAyOyAgICAgICAgLy8gNDAlIGJvbnVzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNhcDM7ICAgICAgICAvLyAyMCUgYm9udXMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY2FwNDsgICAgICAgIC8vIDAlIGJvbnVzCgogICAgLy8gU3RvcmVzIHRoZSBhbW91bnQgY29udHJpYnV0ZWQgZm9yIGVhY2ggdGllciBmb3IgYSBnaXZlbiBhZGRyZXNzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNvbnRyaWJ1dGVkMTsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY29udHJpYnV0ZWQyOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjb250cmlidXRlZDM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNvbnRyaWJ1dGVkNDsKCgogICAgLy8gQ29udmVyc2lvbiByYXRlIGJ5IHRpZXIgKFFTUCA6IEVUSEVSKQogICAgdWludCBwdWJsaWMgcmF0ZTEgPSAxMDAwMDsKICAgIHVpbnQgcHVibGljIHJhdGUyID0gNzAwMDsKICAgIHVpbnQgcHVibGljIHJhdGUzID0gNjAwMDsKICAgIHVpbnQgcHVibGljIHJhdGU0ID0gNTAwMDsKCiAgICAvLyBUaW1lIHBlcmlvZCBvZiBzYWxlIChVTklYIHRpbWVzdGFtcHMpCiAgICB1aW50IHB1YmxpYyBzdGFydFRpbWU7CiAgICB1aW50IHB1YmxpYyBlbmRUaW1lOwoKICAgIC8vIEtlZXBzIHRyYWNrIG9mIHRoZSBhbW91bnQgb2Ygd2VpIHJhaXNlZAogICAgdWludCBwdWJsaWMgYW1vdW50UmFpc2VkOwoKICAgIC8vIHByZXZlbnQgY2VydGFpbiBmdW5jdGlvbnMgZnJvbSBiZWluZyByZWN1cnNpdmVseSBjYWxsZWQKICAgIGJvb2wgcHJpdmF0ZSByZW50cmFuY3lfbG9jayA9IGZhbHNlOwoKICAgIC8vIFRoZSB0b2tlbiBiZWluZyBzb2xkCiAgICAvLyBRdWFudHN0YW1wVG9rZW4gcHVibGljIHRva2VuUmV3YXJkOwoKICAgIC8vIEEgbWFwIHRoYXQgdHJhY2tzIHRoZSBhbW91bnQgb2Ygd2VpIGNvbnRyaWJ1dGVkIGJ5IGFkZHJlc3MKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZU9mOwoKICAgIC8vIEEgbWFwIHRoYXQgdHJhY2tzIHRoZSBhbW91bnQgb2YgUVNQIHRva2VucyB0aGF0IHNob3VsZCBiZSBhbGxvY2F0ZWQgdG8gZWFjaCBhZGRyZXNzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQmFsYW5jZU9mOwoKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IENhcFJlYWNoZWQoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX2Ftb3VudFJhaXNlZCk7CiAgICBldmVudCBGdW5kVHJhbnNmZXIoYWRkcmVzcyBfYmFja2VyLCB1aW50IF9hbW91bnQsIGJvb2wgX2lzQ29udHJpYnV0aW9uKTsKICAgIGV2ZW50IFJlZ2lzdHJhdGlvblN0YXR1c0NoYW5nZWQoYWRkcmVzcyB0YXJnZXQsIGJvb2wgaXNSZWdpc3RlcmVkLCB1aW50IGMxLCB1aW50IGMyLCB1aW50IGMzLCB1aW50IGM0KTsKCgogICAgLy8gTW9kaWZpZXJzCiAgICBtb2RpZmllciBiZWZvcmVEZWFkbGluZSgpICAgeyByZXF1aXJlIChjdXJyZW50VGltZSgpIDwgZW5kVGltZSk7IF87IH0KICAgIC8vIG1vZGlmaWVyIGFmdGVyRGVhZGxpbmUoKSAgICB7IHJlcXVpcmUgKGN1cnJlbnRUaW1lKCkgPj0gZW5kVGltZSk7IF87IH0gbm8gbG9uZ2VyIHVzZWQgd2l0aG91dCBmdW5kaW5nR29hbAogICAgbW9kaWZpZXIgYWZ0ZXJTdGFydFRpbWUoKSAgICB7IHJlcXVpcmUgKGN1cnJlbnRUaW1lKCkgPj0gc3RhcnRUaW1lKTsgXzsgfQoKICAgIG1vZGlmaWVyIHNhbGVOb3RDbG9zZWQoKSAgICB7IHJlcXVpcmUgKCFzYWxlQ2xvc2VkKTsgXzsgfQoKICAgIG1vZGlmaWVyIG5vblJlZW50cmFudCgpIHsKICAgICAgICByZXF1aXJlKCFyZW50cmFuY3lfbG9jayk7CiAgICAgICAgcmVudHJhbmN5X2xvY2sgPSB0cnVlOwogICAgICAgIF87CiAgICAgICAgcmVudHJhbmN5X2xvY2sgPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yIGZvciBhIGNyb3dkc2FsZSBvZiBRdWFudHN0YW1wVG9rZW4gdG9rZW5zLgogICAgICoKICAgICAqIEBwYXJhbSBpZlN1Y2Nlc3NmdWxTZW5kVG8gICAgICAgICAgICB0aGUgYmVuZWZpY2lhcnkgb2YgdGhlIGZ1bmQKICAgICAqIEBwYXJhbSBmdW5kaW5nQ2FwSW5FdGhlcnMgICAgICAgICAgICB0aGUgY2FwIChtYXhpbXVtKSBzaXplIG9mIHRoZSBmdW5kCiAgICAgKiBAcGFyYW0gbWluaW11bUNvbnRyaWJ1dGlvbkluV2VpICAgICAgbWluaW11bSBjb250cmlidXRpb24gKGluIHdlaSkKICAgICAqIEBwYXJhbSBzdGFydCAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgc3RhcnQgdGltZSAoVU5JWCB0aW1lc3RhbXApCiAgICAgKiBAcGFyYW0gZHVyYXRpb25Jbk1pbnV0ZXMgICAgICAgICAgICAgdGhlIGR1cmF0aW9uIG9mIHRoZSBjcm93ZHNhbGUgaW4gbWludXRlcwogICAgICovCiAgICBmdW5jdGlvbiBRdWFudHN0YW1wU2FsZSgKICAgICAgICBhZGRyZXNzIGlmU3VjY2Vzc2Z1bFNlbmRUbywKICAgICAgICB1aW50IGZ1bmRpbmdDYXBJbkV0aGVycywKICAgICAgICB1aW50IG1pbmltdW1Db250cmlidXRpb25JbldlaSwKICAgICAgICB1aW50IHN0YXJ0LAogICAgICAgIHVpbnQgZHVyYXRpb25Jbk1pbnV0ZXMKICAgICAgICAvLyBhZGRyZXNzIGFkZHJlc3NPZlRva2VuVXNlZEFzUmV3YXJkCiAgICApIHsKICAgICAgICByZXF1aXJlKGlmU3VjY2Vzc2Z1bFNlbmRUbyAhPSBhZGRyZXNzKDApICYmIGlmU3VjY2Vzc2Z1bFNlbmRUbyAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvL3JlcXVpcmUoYWRkcmVzc09mVG9rZW5Vc2VkQXNSZXdhcmQgIT0gYWRkcmVzcygwKSAmJiBhZGRyZXNzT2ZUb2tlblVzZWRBc1Jld2FyZCAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKGR1cmF0aW9uSW5NaW51dGVzID4gMCk7CiAgICAgICAgYmVuZWZpY2lhcnkgPSBpZlN1Y2Nlc3NmdWxTZW5kVG87CiAgICAgICAgZnVuZGluZ0NhcCA9IGZ1bmRpbmdDYXBJbkV0aGVycyAqIDEgZXRoZXI7CiAgICAgICAgbWluQ29udHJpYnV0aW9uID0gbWluaW11bUNvbnRyaWJ1dGlvbkluV2VpOwogICAgICAgIHN0YXJ0VGltZSA9IHN0YXJ0OwogICAgICAgIGVuZFRpbWUgPSBzdGFydCArIChkdXJhdGlvbkluTWludXRlcyAqIDEgbWludXRlcyk7CiAgICAgICAgLy8gdG9rZW5SZXdhcmQgPSBRdWFudHN0YW1wVG9rZW4oYWRkcmVzc09mVG9rZW5Vc2VkQXNSZXdhcmQpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIgRXRoZXIgaXMgc2VudCB0byB0aGUKICAgICAqIHNtYXJ0IGNvbnRyYWN0LiBJdCBjYW4gb25seSBiZSBleGVjdXRlZCB3aGVuIHRoZSBjcm93ZHNhbGUgaXMKICAgICAqIG5vdCBwYXVzZWQsIG5vdCBjbG9zZWQsIGFuZCBiZWZvcmUgdGhlIGRlYWRsaW5lIGhhcyBiZWVuIHJlYWNoZWQuCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiB3aWxsIHVwZGF0ZSBzdGF0ZSB2YXJpYWJsZXMgZm9yIHdoZXRoZXIgb3Igbm90IHRoZQogICAgICogZnVuZGluZyBnb2FsIG9yIGNhcCBoYXZlIGJlZW4gcmVhY2hlZC4gSXQgYWxzbyBlbnN1cmVzIHRoYXQgdGhlCiAgICAgKiB0b2tlbnMgYXJlIHRyYW5zZmVycmVkIHRvIHRoZSBzZW5kZXIsIGFuZCB0aGF0IHRoZSBjb3JyZWN0CiAgICAgKiBudW1iZXIgb2YgdG9rZW5zIGFyZSBzZW50IGFjY29yZGluZyB0byB0aGUgY3VycmVudCByYXRlLgogICAgICovCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICBidXkoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXkgKCkKICAgICAgICBwYXlhYmxlIHB1YmxpYwogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgICAgICBiZWZvcmVEZWFkbGluZQogICAgICAgIGFmdGVyU3RhcnRUaW1lCiAgICAgICAgc2FsZU5vdENsb3NlZAogICAgICAgIG5vblJlZW50cmFudAogICAgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IG1pbkNvbnRyaWJ1dGlvbik7CiAgICAgICAgdWludCBhbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIC8vIGVuc3VyZSB0aGF0IHRoZSB1c2VyIGFkaGVyZXMgdG8gd2hpdGVsaXN0IHJlc3RyaWN0aW9ucwogICAgICAgIHJlcXVpcmUocmVnaXN0cnlbbXNnLnNlbmRlcl0pOwoKICAgICAgICB1aW50IG51bVRva2VucyA9IGNvbXB1dGVUb2tlbkFtb3VudChtc2cuc2VuZGVyLCBhbW91bnQpOwogICAgICAgIGFzc2VydChudW1Ub2tlbnMgPiAwKTsKCiAgICAgICAgLy8gdXBkYXRlIHRoZSB0b3RhbCBhbW91bnQgcmFpc2VkCiAgICAgICAgYW1vdW50UmFpc2VkID0gYW1vdW50UmFpc2VkLmFkZChhbW91bnQpOwogICAgICAgIHJlcXVpcmUoYW1vdW50UmFpc2VkIDw9IGZ1bmRpbmdDYXApOwoKICAgICAgICAvLyB1cGRhdGUgdGhlIHNlbmRlcidzIGJhbGFuY2Ugb2Ygd2VpIGNvbnRyaWJ1dGVkCiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdID0gYmFsYW5jZU9mW21zZy5zZW5kZXJdLmFkZChhbW91bnQpOwogICAgICAgIC8vIGFkZCB0byB0aGUgdG9rZW4gYmFsYW5jZSBvZiB0aGUgc2VuZGVyCiAgICAgICAgdG9rZW5CYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSB0b2tlbkJhbGFuY2VPZlttc2cuc2VuZGVyXS5hZGQobnVtVG9rZW5zKTsKCiAgICAgICAgRnVuZFRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudCwgdHJ1ZSk7CiAgICAgICAgdXBkYXRlRnVuZGluZ0NhcCgpOwogICAgfQoKICAgIC8qKgogICAgKiBDb21wdXRlcyB0aGUgYW1vdW50IG9mIFFTUCB0aGF0IHNob3VsZCBiZSBpc3N1ZWQgZm9yIHRoZSBnaXZlbiB0cmFuc2FjdGlvbi4KICAgICogQ29udHJpYnV0aW9uIHRpZXJzIGFyZSBmaWxsZWQgdXAgaW4gdGhlIG9yZGVyIDMsIDIsIDEsIDQuCiAgICAqIEBwYXJhbSBhZGRyICAgICAgVGhlIHdhbGxldCBhZGRyZXNzIG9mIHRoZSBjb250cmlidXRvcgogICAgKiBAcGFyYW0gYW1vdW50ICAgIEFtb3VudCBvZiB3ZWkgZm9yIHBheW1lbnQKICAgICovCiAgICBmdW5jdGlvbiBjb21wdXRlVG9rZW5BbW91bnQoYWRkcmVzcyBhZGRyLCB1aW50IGFtb3VudCkgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50KXsKICAgICAgICByZXF1aXJlKGFtb3VudCA+IDApOwoKICAgICAgICB1aW50IHIzID0gY2FwM1thZGRyXS5zdWIoY29udHJpYnV0ZWQzW2FkZHJdKTsKICAgICAgICB1aW50IHIyID0gY2FwMlthZGRyXS5zdWIoY29udHJpYnV0ZWQyW2FkZHJdKTsKICAgICAgICB1aW50IHIxID0gY2FwMVthZGRyXS5zdWIoY29udHJpYnV0ZWQxW2FkZHJdKTsKICAgICAgICB1aW50IHI0ID0gY2FwNFthZGRyXS5zdWIoY29udHJpYnV0ZWQ0W2FkZHJdKTsKICAgICAgICB1aW50IG51bVRva2VucyA9IDA7CgogICAgICAgIC8vIGNhbm5vdCBjb250cmlidXRlIG1vcmUgdGhhbiB0aGUgcmVtYWluaW5nIHN1bQogICAgICAgIGFzc2VydChhbW91bnQgPD0gcjMuYWRkKHIyKS5hZGQocjEpLmFkZChyNCkpOwoKICAgICAgICAvLyBDb21wdXRlIHRva2VucyBmb3IgdGllciAzCiAgICAgICAgaWYocjMgPiAwKXsKICAgICAgICAgICAgaWYoYW1vdW50IDw9IHIzKXsKICAgICAgICAgICAgICAgIGNvbnRyaWJ1dGVkM1thZGRyXSA9IGNvbnRyaWJ1dGVkM1thZGRyXS5hZGQoYW1vdW50KTsKICAgICAgICAgICAgICAgIHJldHVybiByYXRlMy5tdWwoYW1vdW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgbnVtVG9rZW5zID0gcmF0ZTMubXVsKHIzKTsKICAgICAgICAgICAgICAgIGFtb3VudCA9IGFtb3VudC5zdWIocjMpOwogICAgICAgICAgICAgICAgY29udHJpYnV0ZWQzW2FkZHJdID0gY2FwM1thZGRyXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBDb21wdXRlIHRva2VucyBmb3IgdGllciAyCiAgICAgICAgaWYocjIgPiAwKXsKICAgICAgICAgICAgaWYoYW1vdW50IDw9IHIyKXsKICAgICAgICAgICAgICAgIGNvbnRyaWJ1dGVkMlthZGRyXSA9IGNvbnRyaWJ1dGVkMlthZGRyXS5hZGQoYW1vdW50KTsKICAgICAgICAgICAgICAgIHJldHVybiBudW1Ub2tlbnMuYWRkKHJhdGUyLm11bChhbW91bnQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgbnVtVG9rZW5zID0gbnVtVG9rZW5zLmFkZChyYXRlMi5tdWwocjIpKTsKICAgICAgICAgICAgICAgIGFtb3VudCA9IGFtb3VudC5zdWIocjIpOwogICAgICAgICAgICAgICAgY29udHJpYnV0ZWQyW2FkZHJdID0gY2FwMlthZGRyXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBDb21wdXRlIHRva2VucyBmb3IgdGllciAxCiAgICAgICAgaWYocjEgPiAwKXsKICAgICAgICAgICAgaWYoYW1vdW50IDw9IHIxKXsKICAgICAgICAgICAgICAgIGNvbnRyaWJ1dGVkMVthZGRyXSA9IGNvbnRyaWJ1dGVkMVthZGRyXS5hZGQoYW1vdW50KTsKICAgICAgICAgICAgICAgIHJldHVybiBudW1Ub2tlbnMuYWRkKHJhdGUxLm11bChhbW91bnQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgbnVtVG9rZW5zID0gbnVtVG9rZW5zLmFkZChyYXRlMS5tdWwocjEpKTsKICAgICAgICAgICAgICAgIGFtb3VudCA9IGFtb3VudC5zdWIocjEpOwogICAgICAgICAgICAgICAgY29udHJpYnV0ZWQxW2FkZHJdID0gY2FwMVthZGRyXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBDb21wdXRlIHRva2VucyBmb3IgdGllciA0IChvdmVyZmxvdykKICAgICAgICBjb250cmlidXRlZDRbYWRkcl0gPSBjb250cmlidXRlZDRbYWRkcl0uYWRkKGFtb3VudCk7CiAgICAgICAgcmV0dXJuIG51bVRva2Vucy5hZGQocmF0ZTQubXVsKGFtb3VudCkpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDaGVjayBpZiBhIGNvbnRyaWJ1dG9yIHdhcyBhdCBhbnkgcG9pbnQgcmVnaXN0ZXJlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udHJpYnV0b3IgQWRkcmVzcyB0aGF0IHdpbGwgYmUgY2hlY2tlZC4KICAgICAqLwogICAgZnVuY3Rpb24gaGFzUHJldmlvdXNseVJlZ2lzdGVyZWQoYWRkcmVzcyBjb250cmlidXRvcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgb25seU93bmVyIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gaWYgY2FwcyBmb3IgdGhpcyBjdXN0b21lciBleGlzdCwgdGhlbiB0aGUgY3VzdG9tZXIgaGFzIHByZXZpb3VzbHkgYmVlbiByZWdpc3RlcmVkCiAgICAgICAgcmV0dXJuIChjYXAxW2NvbnRyaWJ1dG9yXS5hZGQoY2FwMltjb250cmlidXRvcl0pLmFkZChjYXAzW2NvbnRyaWJ1dG9yXSkuYWRkKGNhcDRbY29udHJpYnV0b3JdKSkgPiAwOwogICAgfQoKICAgIC8qCiAgICAqIElmIHRoZSB1c2VyIHdhcyBhbHJlYWR5IHJlZ2lzdGVyZWQsIGVuc3VyZSB0aGF0IHRoZSBuZXcgY2FwcyBkbyBub3QgY29uZmxpY3QgcHJldmlvdXMgY29udHJpYnV0aW9ucwogICAgKgogICAgKiBOT1RFOiBjYW5ub3QgdXNlIFNhZmVNYXRoIGhlcmUsIGJlY2F1c2UgaXQgZXhjZWVkcyB0aGUgbG9jYWwgdmFyaWFibGUgc3RhY2sgbGltaXQuCiAgICAqIFNob3VsZCBiZSBvayBzaW5jZSBpdCBpcyBvbmx5T3duZXIsIGFuZCBjb25kaXRpb25hbHMgc2hvdWxkIGd1YXJkIHRoZSBzdWJ0cmFjdGlvbnMgZnJvbSB1bmRlcmZsb3cuCiAgICAqLwogICAgZnVuY3Rpb24gdmFsaWRhdGVVcGRhdGVkUmVnaXN0cmF0aW9uKGFkZHJlc3MgYWRkciwgdWludCBjMSwgdWludCBjMiwgdWludCBjMywgdWludCBjNCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgb25seU93bmVyIHJldHVybnMoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gKGNvbnRyaWJ1dGVkM1thZGRyXSA8PSBjMykgJiYgKGNvbnRyaWJ1dGVkMlthZGRyXSA8PSBjMikKICAgICAgICAgICAgJiYgKGNvbnRyaWJ1dGVkMVthZGRyXSA8PSBjMSkgJiYgKGNvbnRyaWJ1dGVkNFthZGRyXSA8PSBjNCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldHMgcmVnaXN0cmF0aW9uIHN0YXR1cyBvZiBhbiBhZGRyZXNzIGZvciBwYXJ0aWNpcGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBjb250cmlidXRvciBBZGRyZXNzIHRoYXQgd2lsbCBiZSByZWdpc3RlcmVkL2RlcmVnaXN0ZXJlZC4KICAgICAqIEBwYXJhbSBjMSBUaGUgbWF4aW11bSBhbW91bnQgb2Ygd2VpIHRoYXQgdGhlIHVzZXIgY2FuIGNvbnRyaWJ1dGUgaW4gdGllciAxLgogICAgICogQHBhcmFtIGMyIFRoZSBtYXhpbXVtIGFtb3VudCBvZiB3ZWkgdGhhdCB0aGUgdXNlciBjYW4gY29udHJpYnV0ZSBpbiB0aWVyIDIuCiAgICAgKiBAcGFyYW0gYzMgVGhlIG1heGltdW0gYW1vdW50IG9mIHdlaSB0aGF0IHRoZSB1c2VyIGNhbiBjb250cmlidXRlIGluIHRpZXIgMy4KICAgICAqIEBwYXJhbSBjNCBUaGUgbWF4aW11bSBhbW91bnQgb2Ygd2VpIHRoYXQgdGhlIHVzZXIgY2FuIGNvbnRyaWJ1dGUgaW4gdGllciA0LgogICAgICovCiAgICBmdW5jdGlvbiByZWdpc3RlclVzZXIoYWRkcmVzcyBjb250cmlidXRvciwgdWludCBjMSwgdWludCBjMiwgdWludCBjMywgdWludCBjNCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dG9yICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIGlmIHRoZSB1c2VyIHdhcyBhbHJlYWR5IHJlZ2lzdGVyZWQgZW5zdXJlIHRoYXQgdGhlIG5ldyBjYXBzIGRvIG5vdCBjb250cmFkaWN0IHRoZWlyIGN1cnJlbnQgY29udHJpYnV0aW9ucwogICAgICAgIGlmKGhhc1ByZXZpb3VzbHlSZWdpc3RlcmVkKGNvbnRyaWJ1dG9yKSl7CiAgICAgICAgICAgIHJlcXVpcmUodmFsaWRhdGVVcGRhdGVkUmVnaXN0cmF0aW9uKGNvbnRyaWJ1dG9yLCBjMSwgYzIsIGMzLCBjNCkpOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKGMxLmFkZChjMikuYWRkKGMzKS5hZGQoYzQpID49IG1pbkNvbnRyaWJ1dGlvbik7CiAgICAgICAgcmVnaXN0cnlbY29udHJpYnV0b3JdID0gdHJ1ZTsKICAgICAgICBjYXAxW2NvbnRyaWJ1dG9yXSA9IGMxOwogICAgICAgIGNhcDJbY29udHJpYnV0b3JdID0gYzI7CiAgICAgICAgY2FwM1tjb250cmlidXRvcl0gPSBjMzsKICAgICAgICBjYXA0W2NvbnRyaWJ1dG9yXSA9IGM0OwogICAgICAgIFJlZ2lzdHJhdGlvblN0YXR1c0NoYW5nZWQoY29udHJpYnV0b3IsIHRydWUsIGMxLCBjMiwgYzMsIGM0KTsKICAgIH0KCiAgICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZSByZWdpc3RyYXRpb24gc3RhdHVzIG9mIGFuIGFkZHJlc3MgZm9yIHBhcnRpY2lwYXRpb24uCiAgICAgKgogICAgICogTk9URTogaWYgdGhlIHVzZXIgbWFkZSBpbml0aWFsIGNvbnRyaWJ1dGlvbnMgdG8gdGhlIGNyb3dkc2FsZSwKICAgICAqICAgICAgIHRoaXMgd2lsbCBub3QgcmV0dXJuIHRoZSBwcmV2aW91c2x5IGFsbG90dGVkIHRva2Vucy4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udHJpYnV0b3IgQWRkcmVzcyB0byBiZSB1bnJlZ2lzdGVyZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlYWN0aXZhdGUoYWRkcmVzcyBjb250cmlidXRvcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKHJlZ2lzdHJ5W2NvbnRyaWJ1dG9yXSk7CiAgICAgICAgcmVnaXN0cnlbY29udHJpYnV0b3JdID0gZmFsc2U7CiAgICAgICAgUmVnaXN0cmF0aW9uU3RhdHVzQ2hhbmdlZChjb250cmlidXRvciwgZmFsc2UsIGNhcDFbY29udHJpYnV0b3JdLCBjYXAyW2NvbnRyaWJ1dG9yXSwgY2FwM1tjb250cmlidXRvcl0sIGNhcDRbY29udHJpYnV0b3JdKTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlLXJlZ2lzdGVycyBhbiBhbHJlYWR5IGV4aXN0aW5nIGNvbnRyaWJ1dG9yCiAgICAgKgogICAgICogQHBhcmFtIGNvbnRyaWJ1dG9yIEFkZHJlc3MgdG8gYmUgdW5yZWdpc3RlcmVkLgogICAgICovCiAgICBmdW5jdGlvbiByZWFjdGl2YXRlKGFkZHJlc3MgY29udHJpYnV0b3IpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZShoYXNQcmV2aW91c2x5UmVnaXN0ZXJlZChjb250cmlidXRvcikpOwogICAgICAgIHJlZ2lzdHJ5W2NvbnRyaWJ1dG9yXSA9IHRydWU7CiAgICAgICAgUmVnaXN0cmF0aW9uU3RhdHVzQ2hhbmdlZChjb250cmlidXRvciwgdHJ1ZSwgY2FwMVtjb250cmlidXRvcl0sIGNhcDJbY29udHJpYnV0b3JdLCBjYXAzW2NvbnRyaWJ1dG9yXSwgY2FwNFtjb250cmlidXRvcl0pOwoKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0cyByZWdpc3RyYXRpb24gc3RhdHVzZXMgb2YgYWRkcmVzc2VzIGZvciBwYXJ0aWNpcGF0aW9uLgogICAgICogQHBhcmFtIGNvbnRyaWJ1dG9ycyBBZGRyZXNzZXMgdGhhdCB3aWxsIGJlIHJlZ2lzdGVyZWQvZGVyZWdpc3RlcmVkLgogICAgICogQHBhcmFtIGNhcHMxIFRoZSBtYXhpbXVtIGFtb3VudCBvZiB3ZWkgdGhhdCBlYWNoIHVzZXIgY2FuIGNvbnRyaWJ1dGUgdG8gY2FwMSwgaW4gdGhlIHNhbWUgb3JkZXIgYXMgdGhlIGFkZHJlc3Nlcy4KICAgICAqIEBwYXJhbSBjYXBzMiBUaGUgbWF4aW11bSBhbW91bnQgb2Ygd2VpIHRoYXQgZWFjaCB1c2VyIGNhbiBjb250cmlidXRlIHRvIGNhcDIsIGluIHRoZSBzYW1lIG9yZGVyIGFzIHRoZSBhZGRyZXNzZXMuCiAgICAgKiBAcGFyYW0gY2FwczMgVGhlIG1heGltdW0gYW1vdW50IG9mIHdlaSB0aGF0IGVhY2ggdXNlciBjYW4gY29udHJpYnV0ZSB0byBjYXAzLCBpbiB0aGUgc2FtZSBvcmRlciBhcyB0aGUgYWRkcmVzc2VzLgogICAgICogQHBhcmFtIGNhcHM0IFRoZSBtYXhpbXVtIGFtb3VudCBvZiB3ZWkgdGhhdCBlYWNoIHVzZXIgY2FuIGNvbnRyaWJ1dGUgdG8gY2FwNCwgaW4gdGhlIHNhbWUgb3JkZXIgYXMgdGhlIGFkZHJlc3Nlcy4KICAgICAqLwogICAgZnVuY3Rpb24gcmVnaXN0ZXJVc2VycyhhZGRyZXNzW10gY29udHJpYnV0b3JzLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gY2FwczEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnRbXSBjYXBzMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludFtdIGNhcHMzLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50W10gY2FwczQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICAvLyBjaGVjayB0aGF0IGFsbCBhcnJheXMgaGF2ZSB0aGUgc2FtZSBsZW5ndGgKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dG9ycy5sZW5ndGggPT0gY2FwczEubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dG9ycy5sZW5ndGggPT0gY2FwczIubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dG9ycy5sZW5ndGggPT0gY2FwczMubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGNvbnRyaWJ1dG9ycy5sZW5ndGggPT0gY2FwczQubGVuZ3RoKTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgY29udHJpYnV0b3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlZ2lzdGVyVXNlcihjb250cmlidXRvcnNbaV0sIGNhcHMxW2ldLCBjYXBzMltpXSwgY2FwczNbaV0sIGNhcHM0W2ldKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgb3duZXIgY2FuIHRlcm1pbmF0ZSB0aGUgY3Jvd2RzYWxlIGF0IGFueSB0aW1lLgogICAgICovCiAgICBmdW5jdGlvbiB0ZXJtaW5hdGUoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHNhbGVDbG9zZWQgPSB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG93bmVyIGNhbiBhbGxvY2F0ZSB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgZnJvbSB0aGUKICAgICAqIGNyb3dkc2FsZSBhbGxvd2FuY2UgdG8gdGhlIHJlY2lwaWVudCBhZGRyZXNzZXMuCiAgICAgKgogICAgICogTk9URTogYmUgZXh0cmVtZWx5IGNhcmVmdWwgdG8gZ2V0IHRoZSBhbW91bnRzIGNvcnJlY3QsIHdoaWNoCiAgICAgKiBhcmUgaW4gdW5pdHMgb2Ygd2VpIGFuZCBtaW5pLVFTUC4gRXZlcnkgZGlnaXQgY291bnRzLgogICAgICoKICAgICAqIEBwYXJhbSBhZGRycyAgICAgICAgICB0aGUgcmVjaXBpZW50IGFkZHJlc3NlcwogICAgICogQHBhcmFtIHdlaUFtb3VudHMgICAgIHRoZSBhbW91bnRzIGNvbnRyaWJ1dGVkIGluIHdlaQogICAgICogQHBhcmFtIG1pbmlRc3BBbW91bnRzIHRoZSBhbW91bnRzIG9mIHRva2VucyB0cmFuc2ZlcnJlZCBpbiBtaW5pLVFTUAogICAgICovCiAgICBmdW5jdGlvbiBvd25lckFsbG9jYXRlVG9rZW5zRm9yTGlzdChhZGRyZXNzW10gYWRkcnMsIHVpbnRbXSB3ZWlBbW91bnRzLCB1aW50W10gbWluaVFzcEFtb3VudHMpCiAgICAgICAgICAgIGV4dGVybmFsIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUoYWRkcnMubGVuZ3RoID09IHdlaUFtb3VudHMubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGFkZHJzLmxlbmd0aCA9PSBtaW5pUXNwQW1vdW50cy5sZW5ndGgpOwogICAgICAgIGZvcih1aW50IGkgPSAwOyBpIDwgYWRkcnMubGVuZ3RoOyBpKyspewogICAgICAgICAgICBvd25lckFsbG9jYXRlVG9rZW5zKGFkZHJzW2ldLCB3ZWlBbW91bnRzW2ldLCBtaW5pUXNwQW1vdW50c1tpXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICoKICAgICAqIFRoZSBvd25lciBjYW4gYWxsb2NhdGUgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIGZyb20gdGhlCiAgICAgKiBjcm93ZHNhbGUgYWxsb3dhbmNlIHRvIHRoZSByZWNpcGllbnQgKF90bykuCiAgICAgKgogICAgICoKICAgICAqCiAgICAgKiBOT1RFOiBiZSBleHRyZW1lbHkgY2FyZWZ1bCB0byBnZXQgdGhlIGFtb3VudHMgY29ycmVjdCwgd2hpY2gKICAgICAqIGFyZSBpbiB1bml0cyBvZiB3ZWkgYW5kIG1pbmktUVNQLiBFdmVyeSBkaWdpdCBjb3VudHMuCiAgICAgKgogICAgICogQHBhcmFtIF90byAgICAgICAgICAgIHRoZSByZWNpcGllbnQgb2YgdGhlIHRva2VucwogICAgICogQHBhcmFtIGFtb3VudFdlaSAgICAgdGhlIGFtb3VudCBjb250cmlidXRlZCBpbiB3ZWkKICAgICAqIEBwYXJhbSBhbW91bnRNaW5pUXNwIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRyYW5zZmVycmVkIGluIG1pbmktUVNQCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyQWxsb2NhdGVUb2tlbnMoYWRkcmVzcyBfdG8sIHVpbnQgYW1vdW50V2VpLCB1aW50IGFtb3VudE1pbmlRc3ApCiAgICAgICAgICAgIG9ubHlPd25lciBub25SZWVudHJhbnQKICAgIHsKICAgICAgICAvLyBkb24ndCBhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBhZG1pbgogICAgICAgIC8vIHJlcXVpcmUodG9rZW5SZXdhcmQuYWRtaW5BZGRyKCkgIT0gX3RvKTsKCiAgICAgICAgYW1vdW50UmFpc2VkID0gYW1vdW50UmFpc2VkLmFkZChhbW91bnRXZWkpOwogICAgICAgIHJlcXVpcmUoYW1vdW50UmFpc2VkIDw9IGZ1bmRpbmdDYXApOwoKICAgICAgICB0b2tlbkJhbGFuY2VPZltfdG9dID0gdG9rZW5CYWxhbmNlT2ZbX3RvXS5hZGQoYW1vdW50TWluaVFzcCk7CiAgICAgICAgYmFsYW5jZU9mW190b10gPSBiYWxhbmNlT2ZbX3RvXS5hZGQoYW1vdW50V2VpKTsKCiAgICAgICAgRnVuZFRyYW5zZmVyKF90bywgYW1vdW50V2VpLCB0cnVlKTsKICAgICAgICB1cGRhdGVGdW5kaW5nQ2FwKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogVGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24gdG8gd2l0aGRyYXcgdGhlIGZ1bmRzIHRoYXQKICAgICAqIGhhdmUgYmVlbiBzZW50IHRvIHRoaXMgY29udHJhY3QgZm9yIHRoZSBjcm93ZHNhbGUgc3ViamVjdCB0bwogICAgICogdGhlIGZ1bmRpbmcgZ29hbCBoYXZpbmcgYmVlbiByZWFjaGVkLiBUaGUgZnVuZHMgd2lsbCBiZSBzZW50CiAgICAgKiB0byB0aGUgYmVuZWZpY2lhcnkgc3BlY2lmaWVkIHdoZW4gdGhlIGNyb3dkc2FsZSB3YXMgY3JlYXRlZC4KICAgICAqLwogICAgZnVuY3Rpb24gb3duZXJTYWZlV2l0aGRyYXdhbCgpIGV4dGVybmFsIG9ubHlPd25lciBub25SZWVudHJhbnQgewogICAgICAgIHVpbnQgYmFsYW5jZVRvU2VuZCA9IHRoaXMuYmFsYW5jZTsKICAgICAgICBiZW5lZmljaWFyeS50cmFuc2ZlcihiYWxhbmNlVG9TZW5kKTsKICAgICAgICBGdW5kVHJhbnNmZXIoYmVuZWZpY2lhcnksIGJhbGFuY2VUb1NlbmQsIGZhbHNlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBDaGVja3MgaWYgdGhlIGZ1bmRpbmcgY2FwIGhhcyBiZWVuIHJlYWNoZWQuIElmIGl0IGhhcywgdGhlbgogICAgICogdGhlIENhcFJlYWNoZWQgZXZlbnQgaXMgdHJpZ2dlcmVkLgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVGdW5kaW5nQ2FwKCkgaW50ZXJuYWwgewogICAgICAgIGFzc2VydCAoYW1vdW50UmFpc2VkIDw9IGZ1bmRpbmdDYXApOwogICAgICAgIGlmIChhbW91bnRSYWlzZWQgPT0gZnVuZGluZ0NhcCkgewogICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgZnVuZGluZyBjYXAgaGFzIGJlZW4gcmVhY2hlZAogICAgICAgICAgICBmdW5kaW5nQ2FwUmVhY2hlZCA9IHRydWU7CiAgICAgICAgICAgIHNhbGVDbG9zZWQgPSB0cnVlOwogICAgICAgICAgICBDYXBSZWFjaGVkKGJlbmVmaWNpYXJ5LCBhbW91bnRSYWlzZWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZS4KICAgICAqIFVzZWZ1bCB0byBhYnN0cmFjdCBjYWxscyB0byAibm93IiBmb3IgdGVzdHMuCiAgICAqLwogICAgZnVuY3Rpb24gY3VycmVudFRpbWUoKSBjb25zdGFudCByZXR1cm5zICh1aW50IF9jdXJyZW50VGltZSkgewogICAgICAgIHJldHVybiBub3c7CiAgICB9Cn0KCi8qKgogKiBUaGUgRXh0ZW5kZWRRdWFudHN0YW1wU2FsZSBzbWFydCBjb250cmFjdCBpcyB1c2VkIGZvciBzZWxsaW5nIFF1YW50c3RhbXBUb2tlbgogKiB0b2tlbnMgKFFTUCkuIEl0IGRvZXMgc28gYnkgY29udmVydGluZyBFVEggcmVjZWl2ZWQgaW50byBhIHF1YW50aXR5IG9mCiAqIHRva2VucyB0aGF0IGFyZSB0cmFuc2ZlcnJlZCB0byB0aGUgY29udHJpYnV0b3IgdmlhIHRoZSBFUkMyMC1jb21wYXRpYmxlCiAqIHRyYW5zZmVyRnJvbSgpIGZ1bmN0aW9uLgogKi8KY29udHJhY3QgRXh0ZW5kZWRRdWFudHN0YW1wU2FsZSBpcyBQYXVzYWJsZSB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsKICAgIHVpbnQgcHVibGljIGZ1bmRpbmdDYXA7CiAgICB1aW50IHB1YmxpYyBtaW5Db250cmlidXRpb247CiAgICBib29sIHB1YmxpYyBmdW5kaW5nQ2FwUmVhY2hlZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgc2FsZUNsb3NlZCA9IGZhbHNlOwoKICAgIC8vIFdoaXRlbGlzdCBkYXRhCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHJlZ2lzdHJ5OwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjYXA7CgogICAgLy8gVGltZSBwZXJpb2Qgb2Ygc2FsZSAoVU5JWCB0aW1lc3RhbXBzKQogICAgdWludCBwdWJsaWMgc3RhcnRUaW1lOwogICAgdWludCBwdWJsaWMgZW5kVGltZTsKCiAgICAvLyBLZWVwcyB0cmFjayBvZiB0aGUgYW1vdW50IG9mIHdlaSByYWlzZWQKICAgIHVpbnQgcHVibGljIGFtb3VudFJhaXNlZDsKCiAgICAvLyBwcmV2ZW50IGNlcnRhaW4gZnVuY3Rpb25zIGZyb20gYmVpbmcgcmVjdXJzaXZlbHkgY2FsbGVkCiAgICBib29sIHByaXZhdGUgcmVudHJhbmN5X2xvY2sgPSBmYWxzZTsKCiAgICAvLyBBIG1hcCB0aGF0IHRyYWNrcyB0aGUgYW1vdW50IG9mIHdlaSBjb250cmlidXRlZCBieSBhZGRyZXNzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VPZjsKCiAgICAvLyBQcmV2aW91c2x5IGNyZWF0ZWQgY29udHJhY3QKICAgIFF1YW50c3RhbXBTYWxlIHB1YmxpYyBwcmV2aW91c0NvbnRyYWN0OwoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgQ2FwUmVhY2hlZChhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfYW1vdW50UmFpc2VkKTsKICAgIGV2ZW50IEZ1bmRUcmFuc2ZlcihhZGRyZXNzIF9iYWNrZXIsIHVpbnQgX2Ftb3VudCwgYm9vbCBfaXNDb250cmlidXRpb24pOwogICAgZXZlbnQgUmVnaXN0cmF0aW9uU3RhdHVzQ2hhbmdlZChhZGRyZXNzIHRhcmdldCwgYm9vbCBpc1JlZ2lzdGVyZWQsIHVpbnQgYyk7CgogICAgLy8gTW9kaWZpZXJzCiAgICBtb2RpZmllciBiZWZvcmVEZWFkbGluZSgpICAgeyAgcmVxdWlyZSAoY3VycmVudFRpbWUoKSA8IGVuZFRpbWUpOyBfOyAgICAgfQogICAgbW9kaWZpZXIgYWZ0ZXJTdGFydFRpbWUoKSAgIHsgIHJlcXVpcmUgKGN1cnJlbnRUaW1lKCkgPj0gc3RhcnRUaW1lKTsgXzsgIH0KICAgIG1vZGlmaWVyIHNhbGVOb3RDbG9zZWQoKSAgICB7ICByZXF1aXJlICghc2FsZUNsb3NlZCk7IF87ICAgICAgICAgICAgICAgICB9CgogICAgbW9kaWZpZXIgbm9uUmVlbnRyYW50KCkgewogICAgICAgIHJlcXVpcmUoIXJlbnRyYW5jeV9sb2NrKTsKICAgICAgICByZW50cmFuY3lfbG9jayA9IHRydWU7CiAgICAgICAgXzsKICAgICAgICByZW50cmFuY3lfbG9jayA9IGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IgZm9yIGEgY3Jvd2RzYWxlIG9mIFF1YW50c3RhbXBUb2tlbiB0b2tlbnMuCiAgICAgKgogICAgICogQHBhcmFtIGlmU3VjY2Vzc2Z1bFNlbmRUbyAgICAgICAgICAgIHRoZSBiZW5lZmljaWFyeSBvZiB0aGUgZnVuZAogICAgICogQHBhcmFtIGZ1bmRpbmdDYXBJbkV0aGVycyAgICAgICAgICAgIHRoZSBjYXAgKG1heGltdW0pIHNpemUgb2YgdGhlIGZ1bmQKICAgICAqIEBwYXJhbSBtaW5pbXVtQ29udHJpYnV0aW9uSW5XZWkgICAgICBtaW5pbXVtIGNvbnRyaWJ1dGlvbiAoaW4gd2VpKQogICAgICogQHBhcmFtIHN0YXJ0ICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBzdGFydCB0aW1lIChVTklYIHRpbWVzdGFtcCkKICAgICAqIEBwYXJhbSBkdXJhdGlvbkluTWludXRlcyAgICAgICAgICAgICB0aGUgZHVyYXRpb24gb2YgdGhlIGNyb3dkc2FsZSBpbiBtaW51dGVzCiAgICAgKi8KICAgIGZ1bmN0aW9uIEV4dGVuZGVkUXVhbnRzdGFtcFNhbGUoCiAgICAgICAgYWRkcmVzcyBpZlN1Y2Nlc3NmdWxTZW5kVG8sCiAgICAgICAgdWludCBmdW5kaW5nQ2FwSW5FdGhlcnMsCiAgICAgICAgdWludCBtaW5pbXVtQ29udHJpYnV0aW9uSW5XZWksCiAgICAgICAgdWludCBzdGFydCwKICAgICAgICB1aW50IGR1cmF0aW9uSW5NaW51dGVzLAogICAgICAgIGFkZHJlc3MgcHJldmlvdXNDb250cmFjdEFkZHJlc3MKICAgICkgewogICAgICAgIHJlcXVpcmUoaWZTdWNjZXNzZnVsU2VuZFRvICE9IGFkZHJlc3MoMCkgJiYgaWZTdWNjZXNzZnVsU2VuZFRvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoZHVyYXRpb25Jbk1pbnV0ZXMgPiAwKTsKICAgICAgICBiZW5lZmljaWFyeSA9IGlmU3VjY2Vzc2Z1bFNlbmRUbzsKICAgICAgICBmdW5kaW5nQ2FwID0gZnVuZGluZ0NhcEluRXRoZXJzICogMSBldGhlcjsKICAgICAgICBtaW5Db250cmlidXRpb24gPSBtaW5pbXVtQ29udHJpYnV0aW9uSW5XZWk7CiAgICAgICAgc3RhcnRUaW1lID0gc3RhcnQ7CiAgICAgICAgZW5kVGltZSA9IHN0YXJ0ICsgKGR1cmF0aW9uSW5NaW51dGVzICogMSBtaW51dGVzKTsKICAgICAgICBwcmV2aW91c0NvbnRyYWN0ID0gUXVhbnRzdGFtcFNhbGUocHJldmlvdXNDb250cmFjdEFkZHJlc3MpOwogICAgfQoKICAgIC8qKgogICAgICogRmFsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyBwYXlhYmxlIGFuZCBjYWxscyAiYnV5IiB0byBwdXJjaGFzZSB0b2tlbnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgICAgIGJ1eSgpOwogICAgfQoKICAgIC8qKgogICAgICogQnV5IHRva2Vucywgc3ViamVjdCB0byB0aGUgZGVzY3JpcHRpdmUgY29uc3RyYWludHMgc3BlY2lmaWVkIGJ5IG1vZGlmaWVycy4KICAgICAqLwogICAgZnVuY3Rpb24gYnV5ICgpCiAgICAgICAgcGF5YWJsZSBwdWJsaWMKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICAgICAgYmVmb3JlRGVhZGxpbmUKICAgICAgICBhZnRlclN0YXJ0VGltZQogICAgICAgIHNhbGVOb3RDbG9zZWQKICAgICAgICBub25SZWVudHJhbnQKICAgIHsKICAgICAgICB1aW50IGFtb3VudCA9IG1zZy52YWx1ZTsKICAgICAgICByZXF1aXJlKGFtb3VudCA+PSBtaW5Db250cmlidXRpb24pOwoKICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgdXNlciBhZGhlcmVzIHRvIHdoaXRlbGlzdCByZXN0cmljdGlvbnMKICAgICAgICByZXF1aXJlKHJlZ2lzdHJ5W21zZy5zZW5kZXJdKTsKCiAgICAgICAgLy8gdXBkYXRlIHRoZSBhbW91bnQgcmFpc2VkCiAgICAgICAgYW1vdW50UmFpc2VkID0gYW1vdW50UmFpc2VkLmFkZChhbW91bnQpOwogICAgICAgIHJlcXVpcmUoZ2V0VG90YWxBbW91bnRSYWlzZWQoKSA8PSBmdW5kaW5nQ2FwKTsKCiAgICAgICAgLy8gdXBkYXRlIHRoZSBzZW5kZXIncyBiYWxhbmNlIG9mIHdlaSBjb250cmlidXRlZAogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSA9IGJhbGFuY2VPZlttc2cuc2VuZGVyXS5hZGQoYW1vdW50KTsKICAgICAgICByZXF1aXJlKGdldFVzZXJCYWxhbmNlKG1zZy5zZW5kZXIpIDw9IGNhcFttc2cuc2VuZGVyXSk7CgogICAgICAgIEZ1bmRUcmFuc2Zlcihtc2cuc2VuZGVyLCBhbW91bnQsIHRydWUpOwogICAgICAgIHVwZGF0ZUZ1bmRpbmdDYXAoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb3RhbEFtb3VudFJhaXNlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFtb3VudFJhaXNlZC5hZGQocHJldmlvdXNDb250cmFjdC5hbW91bnRSYWlzZWQoKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VXNlckJhbGFuY2UoYWRkcmVzcyB1c2VyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZbdXNlcl0uYWRkKHByZXZpb3VzQ29udHJhY3QuYmFsYW5jZU9mKHVzZXIpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRFbmRUaW1lKHVpbnQgdGltZXN0YW1wKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBlbmRUaW1lID0gdGltZXN0YW1wOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDaGVjayBpZiBhIGNvbnRyaWJ1dG9yIHdhcyBhdCBhbnkgcG9pbnQgcmVnaXN0ZXJlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udHJpYnV0b3IgQWRkcmVzcyB0aGF0IHdpbGwgYmUgY2hlY2tlZC4KICAgICAqLwogICAgZnVuY3Rpb24gaGFzUHJldmlvdXNseVJlZ2lzdGVyZWQoYWRkcmVzcyBjb250cmlidXRvcikKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvLyBpZiBhIGNhcCBmb3IgdGhpcyBjdXN0b21lciBleGlzdCwgdGhlbiB0aGUgY3VzdG9tZXIgaGFzIHByZXZpb3VzbHkgYmVlbiByZWdpc3RlcmVkCiAgICAgICAgLy8gd2Ugc2tpcCB0aGUgY2FwcyBmcm9tIHRoZSBwcmV2aW91cyBjb250cmFjdAogICAgICAgIHJldHVybiBjYXBbY29udHJpYnV0b3JdID4gMDsKICAgIH0KCiAgICAvKgogICAgICogSWYgdGhlIHVzZXIgd2FzIGFscmVhZHkgcmVnaXN0ZXJlZCwgZW5zdXJlIHRoYXQgdGhlIG5ldyBjYXBzIGRvIG5vdCBjb25mbGljdCBwcmV2aW91cyBjb250cmlidXRpb25zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHZhbGlkYXRlVXBkYXRlZFJlZ2lzdHJhdGlvbihhZGRyZXNzIGFkZHIsIHVpbnQgX2NhcCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIHJldHVybiAoZ2V0VXNlckJhbGFuY2UoYWRkcikgPD0gX2NhcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldHMgcmVnaXN0cmF0aW9uIHN0YXR1cyBvZiBhbiBhZGRyZXNzIGZvciBwYXJ0aWNpcGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBjb250cmlidXRvciBBZGRyZXNzIHRoYXQgd2lsbCBiZSByZWdpc3RlcmVkL2RlcmVnaXN0ZXJlZC4KICAgICAqIEBwYXJhbSBfY2FwIFRoZSBtYXhpbXVtIGFtb3VudCBvZiB3ZWkgdGhhdCB0aGUgdXNlciBjYW4gY29udHJpYnV0ZQogICAgICovCiAgICBmdW5jdGlvbiByZWdpc3RlclVzZXIoYWRkcmVzcyBjb250cmlidXRvciwgdWludCBfY2FwKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUoY29udHJpYnV0b3IgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gaWYgdGhlIHVzZXIgd2FzIGFscmVhZHkgcmVnaXN0ZXJlZCBlbnN1cmUgdGhhdCB0aGUgbmV3IGNhcHMgZG8gbm90IGNvbnRyYWRpY3QgdGhlaXIgY3VycmVudCBjb250cmlidXRpb25zCiAgICAgICAgaWYoaGFzUHJldmlvdXNseVJlZ2lzdGVyZWQoY29udHJpYnV0b3IpKXsKICAgICAgICAgICAgcmVxdWlyZSh2YWxpZGF0ZVVwZGF0ZWRSZWdpc3RyYXRpb24oY29udHJpYnV0b3IsIF9jYXApKTsKICAgICAgICB9CiAgICAgICAgcmVxdWlyZShfY2FwID49IG1pbkNvbnRyaWJ1dGlvbik7CiAgICAgICAgcmVnaXN0cnlbY29udHJpYnV0b3JdID0gdHJ1ZTsKICAgICAgICBjYXBbY29udHJpYnV0b3JdID0gX2NhcDsKICAgICAgICBSZWdpc3RyYXRpb25TdGF0dXNDaGFuZ2VkKGNvbnRyaWJ1dG9yLCB0cnVlLCBfY2FwKTsKICAgIH0KCiAgICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZSByZWdpc3RyYXRpb24gc3RhdHVzIG9mIGFuIGFkZHJlc3MgZm9yIHBhcnRpY2lwYXRpb24uCiAgICAgKgogICAgICogTk9URTogaWYgdGhlIHVzZXIgbWFkZSBpbml0aWFsIGNvbnRyaWJ1dGlvbnMgdG8gdGhlIGNyb3dkc2FsZSwKICAgICAqICAgICAgIHRoaXMgd2lsbCBub3QgcmV0dXJuIHRoZSBwcmV2aW91c2x5IGFsbG90dGVkIHRva2Vucy4KICAgICAqCiAgICAgKiBAcGFyYW0gY29udHJpYnV0b3IgQWRkcmVzcyB0byBiZSB1bnJlZ2lzdGVyZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlYWN0aXZhdGUoYWRkcmVzcyBjb250cmlidXRvcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKHJlZ2lzdHJ5W2NvbnRyaWJ1dG9yXSk7CiAgICAgICAgcmVnaXN0cnlbY29udHJpYnV0b3JdID0gZmFsc2U7CiAgICAgICAgUmVnaXN0cmF0aW9uU3RhdHVzQ2hhbmdlZChjb250cmlidXRvciwgZmFsc2UsIGNhcFtjb250cmlidXRvcl0pOwoKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmUtcmVnaXN0ZXJzIGFuIGFscmVhZHkgZXhpc3RpbmcgY29udHJpYnV0b3IKICAgICAqCiAgICAgKiBAcGFyYW0gY29udHJpYnV0b3IgQWRkcmVzcyB0byBiZSB1bnJlZ2lzdGVyZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlYWN0aXZhdGUoYWRkcmVzcyBjb250cmlidXRvcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKGhhc1ByZXZpb3VzbHlSZWdpc3RlcmVkKGNvbnRyaWJ1dG9yKSk7CiAgICAgICAgcmVnaXN0cnlbY29udHJpYnV0b3JdID0gdHJ1ZTsKICAgICAgICBSZWdpc3RyYXRpb25TdGF0dXNDaGFuZ2VkKGNvbnRyaWJ1dG9yLCB0cnVlLCBjYXBbY29udHJpYnV0b3JdKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0cyByZWdpc3RyYXRpb24gc3RhdHVzZXMgb2YgYWRkcmVzc2VzIGZvciBwYXJ0aWNpcGF0aW9uLgogICAgICogQHBhcmFtIGNvbnRyaWJ1dG9ycyBBZGRyZXNzZXMgdGhhdCB3aWxsIGJlIHJlZ2lzdGVyZWQvZGVyZWdpc3RlcmVkLgogICAgICogQHBhcmFtIGNhcHMgVGhlIG1heGltdW0gYW1vdW50IG9mIHdlaSB0aGF0IGVhY2ggdXNlciBjYW4gY29udHJpYnV0ZSB0byBjYXAsIGluIHRoZSBzYW1lIG9yZGVyIGFzIHRoZSBhZGRyZXNzZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVXNlcnMoYWRkcmVzc1tdIGNvbnRyaWJ1dG9ycywgdWludFtdIGNhcHMpIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgLy8gY2hlY2sgdGhhdCBhbGwgYXJyYXlzIGhhdmUgdGhlIHNhbWUgbGVuZ3RoCiAgICAgICAgcmVxdWlyZShjb250cmlidXRvcnMubGVuZ3RoID09IGNhcHMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgY29udHJpYnV0b3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlZ2lzdGVyVXNlcihjb250cmlidXRvcnNbaV0sIGNhcHNbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBvd25lciBjYW4gdGVybWluYXRlIHRoZSBjcm93ZHNhbGUgYXQgYW55IHRpbWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRlcm1pbmF0ZSgpIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgc2FsZUNsb3NlZCA9IHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKgogICAgICogVGhlIG93bmVyIGNhbiBhbGxvY2F0ZSB0aGUgc3BlY2lmaWVkIGFtb3VudC4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvICAgICAgICAgICAgdGhlIHJlY2lwaWVudCBvZiB0aGUgdG9rZW5zCiAgICAgKiBAcGFyYW0gYW1vdW50V2VpICAgICB0aGUgYW1vdW50IGNvbnRyaWJ1dGVkIGluIHdlaQogICAgICovCiAgICBmdW5jdGlvbiBvd25lckFsbG9jYXRlKGFkZHJlc3MgX3RvLCB1aW50IGFtb3VudFdlaSkgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgbm9uUmVlbnRyYW50CiAgICB7CiAgICAgICAgYW1vdW50UmFpc2VkID0gYW1vdW50UmFpc2VkLmFkZChhbW91bnRXZWkpOwogICAgICAgIHJlcXVpcmUoZ2V0VG90YWxBbW91bnRSYWlzZWQoKSA8PSBmdW5kaW5nQ2FwKTsKCiAgICAgICAgYmFsYW5jZU9mW190b10gPSBiYWxhbmNlT2ZbX3RvXS5hZGQoYW1vdW50V2VpKTsKCiAgICAgICAgRnVuZFRyYW5zZmVyKF90bywgYW1vdW50V2VpLCB0cnVlKTsKICAgICAgICB1cGRhdGVGdW5kaW5nQ2FwKCk7CiAgICB9CgoKICAgIC8qKgogICAgICogVGhlIG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24gdG8gd2l0aGRyYXcgdGhlIGZ1bmRzIHRoYXQKICAgICAqIGhhdmUgYmVlbiBzZW50IHRvIHRoaXMgY29udHJhY3QgZm9yIHRoZSBjcm93ZHNhbGUgc3ViamVjdCB0bwogICAgICogdGhlIGZ1bmRpbmcgZ29hbCBoYXZpbmcgYmVlbiByZWFjaGVkLiBUaGUgZnVuZHMgd2lsbCBiZSBzZW50CiAgICAgKiB0byB0aGUgYmVuZWZpY2lhcnkgc3BlY2lmaWVkIHdoZW4gdGhlIGNyb3dkc2FsZSB3YXMgY3JlYXRlZC4KICAgICAqLwogICAgZnVuY3Rpb24gb3duZXJTYWZlV2l0aGRyYXdhbCgpIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICAgICAgbm9uUmVlbnRyYW50CiAgICB7CiAgICAgICAgdWludCBiYWxhbmNlVG9TZW5kID0gdGhpcy5iYWxhbmNlOwogICAgICAgIGJlbmVmaWNpYXJ5LnRyYW5zZmVyKGJhbGFuY2VUb1NlbmQpOwogICAgICAgIEZ1bmRUcmFuc2ZlcihiZW5lZmljaWFyeSwgYmFsYW5jZVRvU2VuZCwgZmFsc2UpOwogICAgfQoKCiAgICAvKioKICAgICAqIENoZWNrcyBpZiB0aGUgZnVuZGluZyBjYXAgaGFzIGJlZW4gcmVhY2hlZC4gSWYgaXQgaGFzLCB0aGVuCiAgICAgKiB0aGUgQ2FwUmVhY2hlZCBldmVudCBpcyB0cmlnZ2VyZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUZ1bmRpbmdDYXAoKSBpbnRlcm5hbAogICAgewogICAgICAgIHVpbnQgYW1vdW50ID0gZ2V0VG90YWxBbW91bnRSYWlzZWQoKTsKICAgICAgICBhc3NlcnQgKGFtb3VudCA8PSBmdW5kaW5nQ2FwKTsKICAgICAgICBpZiAoYW1vdW50ID09IGZ1bmRpbmdDYXApIHsKICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZ1bmRpbmcgY2FwIGhhcyBiZWVuIHJlYWNoZWQKICAgICAgICAgICAgZnVuZGluZ0NhcFJlYWNoZWQgPSB0cnVlOwogICAgICAgICAgICBzYWxlQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgQ2FwUmVhY2hlZChiZW5lZmljaWFyeSwgYW1vdW50KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHRpbWUuCiAgICAgKiBVc2VmdWwgdG8gYWJzdHJhY3QgY2FsbHMgdG8gIm5vdyIgZm9yIHRlc3RzLgogICAgKi8KICAgIGZ1bmN0aW9uIGN1cnJlbnRUaW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgX2N1cnJlbnRUaW1lKQogICAgewogICAgICAgIHJldHVybiBub3c7CiAgICB9Cn0='.
	

]
