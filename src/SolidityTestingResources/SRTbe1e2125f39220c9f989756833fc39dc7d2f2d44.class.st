Class {
	#name : #SRTbe1e2125f39220c9f989756833fc39dc7d2f2d44,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTbe1e2125f39220c9f989756833fc39dc7d2f2d44 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBtb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgTk9UIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCgovKioKICogUGF1c2FibGUgdG9rZW4KICoKICogU2ltcGxlIEVSQzIwIFRva2VuIGV4YW1wbGUsIHdpdGggcGF1c2FibGUgdG9rZW4gY3JlYXRpb24KICoqLwpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9Cn0KCgovKioKICogQHRpdGxlIFJlZnVuZFZhdWx0CiAqIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIGZvciBzdG9yaW5nIGZ1bmRzIHdoaWxlIGEgY3Jvd2RzYWxlCiAqIGlzIGluIHByb2dyZXNzLiBTdXBwb3J0cyByZWZ1bmRpbmcgdGhlIG1vbmV5IGlmIGNyb3dkc2FsZSBmYWlscywKICogYW5kIGZvcndhcmRpbmcgaXQgaWYgY3Jvd2RzYWxlIGlzIHN1Y2Nlc3NmdWwuCiAqLwpjb250cmFjdCBSZWZ1bmRWYXVsdCBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgZW51bSBTdGF0ZSB7IEFjdGl2ZSwgUmVmdW5kaW5nLCBDbG9zZWQgfQoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBkZXBvc2l0ZWQ7CiAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogIFN0YXRlIHB1YmxpYyBzdGF0ZTsKCiAgZXZlbnQgQ2xvc2VkKCk7CiAgZXZlbnQgUmVmdW5kc0VuYWJsZWQoKTsKICBldmVudCBSZWZ1bmRlZChhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgd2VpQW1vdW50KTsKCiAgZnVuY3Rpb24gUmVmdW5kVmF1bHQoYWRkcmVzcyBfd2FsbGV0KSB7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICB9CgogIGZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyBpbnZlc3Rvcikgb25seU93bmVyIHBheWFibGUgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl0uYWRkKG1zZy52YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBjbG9zZSgpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLkFjdGl2ZSk7CiAgICBzdGF0ZSA9IFN0YXRlLkNsb3NlZDsKICAgIENsb3NlZCgpOwogICAgd2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgfQoKICBmdW5jdGlvbiBlbmFibGVSZWZ1bmRzKCkgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgUmVmdW5kc0VuYWJsZWQoKTsKICB9CgogIGZ1bmN0aW9uIHJlZnVuZChhZGRyZXNzIGludmVzdG9yKSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CiAgICB1aW50MjU2IGRlcG9zaXRlZFZhbHVlID0gZGVwb3NpdGVkW2ludmVzdG9yXTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSAwOwogICAgaW52ZXN0b3IudHJhbnNmZXIoZGVwb3NpdGVkVmFsdWUpOwogICAgUmVmdW5kZWQoaW52ZXN0b3IsIGRlcG9zaXRlZFZhbHVlKTsKICB9Cn0KCi8vIEB0aXRsZSBUaGUgUGFsbHlDb2luCi8vLyBAYXV0aG9yIE1hbm9qIFBhdGlkYXIKY29udHJhY3QgUGFsbHlDb2luIGlzIFBhdXNhYmxlVG9rZW4gewogICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICdQYWxseUNvaW4nOwoKICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAnUExMJzsKCiAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgdWludDI1NiBwdWJsaWMgIHRvdGFsU3VwcGx5ID0gMTAwZTI0OyAvLyAxMDBNIHRva2VucyB3aXRoIDE4IGRlY2ltYWxzCgogICBib29sIHB1YmxpYyByZW1haW5pbmdUb2tlbkJ1cm50ID0gZmFsc2U7CgogICAvLyBUaGUgdG9rZW5zIGFscmVhZHkgdXNlZCBmb3IgdGhlIHByZXNhbGUgYnV5ZXJzCiAgIHVpbnQyNTYgcHVibGljIHRva2Vuc0Rpc3RyaWJ1dGVkUHJlc2FsZSA9IDA7CgogICAvLyBUaGUgdG9rZW5zIGFscmVhZHkgdXNlZCBmb3IgdGhlIElDTyBidXllcnMKICAgdWludDI1NiBwdWJsaWMgdG9rZW5zRGlzdHJpYnV0ZWRDcm93ZHNhbGUgPSAwOwoKICAgLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGNyb3dkc2FsZQogICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGU7CgogICAvLyBUaGUgaW5pdGlhbCBzdXBwbHkgdXNlZCBmb3IgcGxhdGZvcm0gYW5kIGRldmVsb3BtZW50IGFzIHNwZWNpZmllZCBpbiB0aGUgd2hpdGVwYXBlcgogICB1aW50MjU2IHB1YmxpYyBpbml0aWFsU3VwcGx5ID0gNDBlMjQ7CgogICAvLyBUaGUgbWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIGZvciB0aGUgcHJlc2FsZSBpbnZlc3RvcnMKICAgdWludDI1NiBwdWJsaWMgbGltaXRQcmVzYWxlID0gMTBlMjQ7CgogICAvLyBUaGUgbWF4aW11bSBhbW91bnQgb2YgdG9rZW5zIHNvbGQgaW4gdGhlIGNyb3dkc2FsZQogICB1aW50MjU2IHB1YmxpYyBsaW1pdENyb3dkc2FsZSA9IDUwZTI0OwoKICAgLy8vIEBub3RpY2UgT25seSBhbGxvd3MgdGhlIGV4ZWN1dGlvbiBvZiB0aGUgZnVuY3Rpb24gaWYgaXQncyBjb21taW5nIGZyb20gY3Jvd2RzYWxlCiAgIG1vZGlmaWVyIG9ubHlDcm93ZHNhbGUoKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjcm93ZHNhbGUpOwogICAgICBfOwogICB9CgogICAvLyBXaGVuIHNvbWVvbmUgcmVmdW5kcyB0b2tlbnMKICAgZXZlbnQgUmVmdW5kZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIHVzZXIsIHVpbnQyNTYgdG9rZW5zKTsKCiAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHVzZWQgdG8gc2V0IHRoZSBwbGF0Zm9ybSAmIGRldmVsb3BtZW50IHRva2Vucy4gVGhpcyBpcwogICAvLy8gVGhlIDIwJSArIDIwJSBvZiB0aGUgMTAwIE0gdG9rZW5zIHVzZWQgZm9yIHBsYXRmb3JtIGFuZCBkZXZlbG9wbWVudCB0ZWFtLgogICAvLy8gVGhlIG93bmVyLCBtc2cuc2VuZGVyLCBpcyBhYmxlIHRvIGRvIGFsbG93YW5jZSBmb3Igb3RoZXIgY29udHJhY3RzLiBSZW1lbWJlcgogICAvLy8gdG8gdXNlIGB0cmFuc2ZlckZyb20oKWAgaWYgeW91J3JlIGFsbG93ZWQKICAgZnVuY3Rpb24gUGFsbHlDb2luKCkgewogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGluaXRpYWxTdXBwbHk7IC8vIDQwTSB0b2tlbnMgd2VpCiAgIH0KCiAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNldCB0aGUgY3Jvd2RzYWxlIHNtYXJ0IGNvbnRyYWN0J3MgYWRkcmVzcyBvbmx5IGJ5IHRoZSBvd25lciBvZiB0aGlzIHRva2VuCiAgIC8vLyBAcGFyYW0gX2Nyb3dkc2FsZSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgdXNlZAogICBmdW5jdGlvbiBzZXRDcm93ZHNhbGVBZGRyZXNzKGFkZHJlc3MgX2Nyb3dkc2FsZSkgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgICByZXF1aXJlKF9jcm93ZHNhbGUgIT0gYWRkcmVzcygwKSk7CgogICAgICBjcm93ZHNhbGUgPSBfY3Jvd2RzYWxlOwogICB9CgogICAvLy8gQG5vdGljZSBEaXN0cmlidXRlcyB0aGUgcHJlc2FsZSB0b2tlbnMuIE9ubHkgdGhlIG93bmVyIGNhbiBkbyB0aGlzCiAgIC8vLyBAcGFyYW0gX2J1eWVyIFRoZSBhZGRyZXNzIG9mIHRoZSBidXllcgogICAvLy8gQHBhcmFtIHRva2VucyBUaGUgYW1vdW50IG9mIHRva2VucyBjb3JyZXNwb25kaW5nIHRvIHRoYXQgYnV5ZXIKICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVByZXNhbGVUb2tlbnMoYWRkcmVzcyBfYnV5ZXIsIHVpbnQgdG9rZW5zKSBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDAgJiYgdG9rZW5zIDw9IGxpbWl0UHJlc2FsZSk7CgogICAgICAvLyBDaGVjayB0aGF0IHRoZSBsaW1pdCBvZiAxME0gcHJlc2FsZSB0b2tlbnMgaGFzbid0IGJlZW4gbWV0IHlldAogICAgICByZXF1aXJlKHRva2Vuc0Rpc3RyaWJ1dGVkUHJlc2FsZSA8IGxpbWl0UHJlc2FsZSk7CiAgICAgIHJlcXVpcmUodG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlLmFkZCh0b2tlbnMpIDwgbGltaXRQcmVzYWxlKTsKCiAgICAgIHRva2Vuc0Rpc3RyaWJ1dGVkUHJlc2FsZSA9IHRva2Vuc0Rpc3RyaWJ1dGVkUHJlc2FsZS5hZGQodG9rZW5zKTsKICAgICAgYmFsYW5jZXNbX2J1eWVyXSA9IGJhbGFuY2VzW19idXllcl0uYWRkKHRva2Vucyk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIERpc3RyaWJ1dGVzIHRoZSBJQ08gdG9rZW5zLiBPbmx5IHRoZSBjcm93ZHNhbGUgYWRkcmVzcyBjYW4gZXhlY3V0ZSB0aGlzCiAgIC8vLyBAcGFyYW0gX2J1eWVyIFRoZSBidXllciBhZGRyZXNzCiAgIC8vLyBAcGFyYW0gdG9rZW5zIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbmQgdG8gdGhhdCBhZGRyZXNzCiAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVJQ09Ub2tlbnMoYWRkcmVzcyBfYnV5ZXIsIHVpbnQgdG9rZW5zKSBleHRlcm5hbCBvbmx5Q3Jvd2RzYWxlIHdoZW5Ob3RQYXVzZWQgewogICAgICByZXF1aXJlKF9idXllciAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZSh0b2tlbnMgPiAwKTsKCiAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGxpbWl0IG9mIDUwTSBJQ08gdG9rZW5zIGhhc24ndCBiZWVuIG1ldCB5ZXQKICAgICAgcmVxdWlyZSh0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSA8IGxpbWl0Q3Jvd2RzYWxlKTsKICAgICAgcmVxdWlyZSh0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZS5hZGQodG9rZW5zKSA8PSBsaW1pdENyb3dkc2FsZSk7CgogICAgICB0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSA9IHRva2Vuc0Rpc3RyaWJ1dGVkQ3Jvd2RzYWxlLmFkZCh0b2tlbnMpOwogICAgICBiYWxhbmNlc1tfYnV5ZXJdID0gYmFsYW5jZXNbX2J1eWVyXS5hZGQodG9rZW5zKTsKICAgfQoKICAgLy8vIEBub3RpY2UgRGVsZXRlcyB0aGUgYW1vdW50IG9mIHRva2VucyByZWZ1bmRlZCBmcm9tIHRoYXQgYnV5ZXIgYmFsYW5jZQogICAvLy8gQHBhcmFtIF9idXllciBUaGUgYnV5ZXIgdGhhdCB3YW50cyB0aGUgcmVmdW5kCiAgIC8vLyBAcGFyYW0gdG9rZW5zIFRoZSB0b2tlbnMgdG8gcmV0dXJuCiAgIGZ1bmN0aW9uIHJlZnVuZFRva2VucyhhZGRyZXNzIF9idXllciwgdWludDI1NiB0b2tlbnMpIGV4dGVybmFsIG9ubHlDcm93ZHNhbGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDApOwogICAgICByZXF1aXJlKGJhbGFuY2VzW19idXllcl0gPj0gdG9rZW5zKTsKCiAgICAgIGJhbGFuY2VzW19idXllcl0gPSBiYWxhbmNlc1tfYnV5ZXJdLnN1Yih0b2tlbnMpOwogICAgICBSZWZ1bmRlZFRva2VucyhfYnV5ZXIsIHRva2Vucyk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEJ1cm4gdGhlIGFtb3VudCBvZiB0b2tlbnMgcmVtYWluaW5nIGFmdGVyIElDTyBlbmRzCiAgIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoKSBleHRlcm5hbCBvbmx5Q3Jvd2RzYWxlIHdoZW5Ob3RQYXVzZWQgewogICAgICAKICAgICAgdWludDI1NiByZW1haW5pbmdJQ09Ub2tlbiA9IGxpbWl0Q3Jvd2RzYWxlLnN1Yih0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSk7CiAgICAgIGlmKHJlbWFpbmluZ0lDT1Rva2VuID4gMCAmJiAhcmVtYWluaW5nVG9rZW5CdXJudCkgewogICAgICByZW1haW5pbmdUb2tlbkJ1cm50ID0gdHJ1ZTsgICAgCiAgICAgIGxpbWl0Q3Jvd2RzYWxlID0gbGltaXRDcm93ZHNhbGUuc3ViKHJlbWFpbmluZ0lDT1Rva2VuKTsgIAogICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihyZW1haW5pbmdJQ09Ub2tlbik7CiAgICAgIH0KICAgfQp9Ci8vLyAxLiBGaXJzdCB5b3Ugc2V0IHRoZSBhZGRyZXNzIG9mIHRoZSB3YWxsZXQgaW4gdGhlIFJlZnVuZFZhdWx0IGNvbnRyYWN0IHRoYXQgd2lsbCBzdG9yZSB0aGUgZGVwb3NpdCBvZiBldGhlcgovLyAyLiBJZiB0aGUgZ29hbCBpcyByZWFjaGVkLCB0aGUgc3RhdGUgb2YgdGhlIHZhdWx0IHdpbGwgY2hhbmdlIGFuZCB0aGUgZXRoZXIgd2lsbCBiZSBzZW50IHRvIHRoZSBhZGRyZXNzCi8vIDMuIElmIHRoZSBnb2FsIGlzIG5vdCByZWFjaGVkICwgdGhlIHN0YXRlIG9mIHRoZSB2YXVsdCB3aWxsIGNoYW5nZSB0byByZWZ1bmRpbmcgYW5kIHRoZSB1c2VycyB3aWxsIGJlIGFibGUgdG8gY2FsbCBjbGFpbVJlZnVuZCgpIHRvIGdldCB0aGVpciBldGhlcgoKLy8vIEB0aXRsZSBDcm93ZHNhbGUgY29udHJhY3QgdG8gY2Fycnkgb3V0IGFuIElDTyB3aXRoIHRoZSBQYWxseUNvaW4KLy8vIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcywgd2hlcmUgaW52ZXN0b3JzIGNhbiBtYWtlCi8vLyB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKLy8vIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAovLy8gYXMgdGhleSBhcnJpdmUuCi8vLyBAYXV0aG9yIE1hbm9qIFBhdGlkYXIgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlNzk3ODY5MzhlODM4Njk1OGE4Njg5ODg4ZGE3ODA4YTg2OGU4YmM5ODQ4ODhhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIFBhdXNhYmxlIHsKICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogICBQYWxseUNvaW4gcHVibGljIHRva2VuOwoKICAgLy8gVGhlIHZhdWx0IHRoYXQgd2lsbCBzdG9yZSB0aGUgZXRoZXIgdW50aWwgdGhlIGdvYWwgaXMgcmVhY2hlZAogICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CgogICAvLyBUaGUgYmxvY2sgbnVtYmVyIG9mIHdoZW4gdGhlIGNyb3dkc2FsZSBzdGFydHMKICAgLy8gMTAvMTUvMjAxNyBAIDExOjAwYW0gKFVUQykKICAgLy8gMTAvMTUvMjAxNyBAIDEyOjAwcG0gKEdNVCArIDEpCiAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZSA9IDE1MTEwNjg4Mjk7CgogICAvLyBUaGUgYmxvY2sgbnVtYmVyIG9mIHdoZW4gdGhlIGNyb3dkc2FsZSBlbmRzCiAgIC8vIDExLzEzLzIwMTcgQCAxMTowMGFtIChVVEMpCiAgIC8vIDExLzEzLzIwMTcgQCAxMjowMHBtIChHTVQgKyAxKQogICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lID0gMTUxMjAyMTAyOTsKCiAgIC8vIFRoZSB3YWxsZXQgdGhhdCBob2xkcyB0aGUgV2VpIHJhaXNlZCBvbiB0aGUgY3Jvd2RzYWxlCiAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgIC8vIFRoZSB3YWxsZXQgdGhhdCBob2xkcyB0aGUgV2VpIHJhaXNlZCBvbiB0aGUgY3Jvd2RzYWxlIGFmdGVyIHNvZnQgY2FwIHJlYWNoZWQKICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0QjsKCiAgIC8vIFRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIuIE9ubHkgYXBwbGllZCBmb3IgdGhlIGZpcnN0IHRpZXIsIHRoZSBmaXJzdAogICAvLyAxMi41IG1pbGxpb24gdG9rZW5zIHNvbGQKICAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgIC8vIFRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIuIE9ubHkgYXBwbGllZCBmb3IgdGhlIHNlY29uZCB0aWVyLCBhdCBiZXR3ZWVuCiAgIC8vIDEyLjUgbWlsbGlvbiB0b2tlbnMgc29sZCBhbmQgMjUgbWlsbGlvbiB0b2tlbnMgc29sZAogICB1aW50MjU2IHB1YmxpYyByYXRlVGllcjI7CgogICAvLyBUaGUgcmF0ZSBvZiB0b2tlbnMgcGVyIGV0aGVyLiBPbmx5IGFwcGxpZWQgZm9yIHRoZSB0aGlyZCB0aWVyLCBhdCBiZXR3ZWVuCiAgIC8vIDI1IG1pbGxpb24gdG9rZW5zIHNvbGQgYW5kIDM3LjUgbWlsbGlvbiB0b2tlbnMgc29sZAogICB1aW50MjU2IHB1YmxpYyByYXRlVGllcjM7CgogICAvLyBUaGUgcmF0ZSBvZiB0b2tlbnMgcGVyIGV0aGVyLiBPbmx5IGFwcGxpZWQgZm9yIHRoZSBmb3VydGggdGllciwgYXQgYmV0d2VlbgogICAvLyAzNy41IG1pbGxpb24gdG9rZW5zIHNvbGQgYW5kIDUwIG1pbGxpb24gdG9rZW5zIHNvbGQKICAgdWludDI1NiBwdWJsaWMgcmF0ZVRpZXI0OwoKICAgLy8gVGhlIG1heGltdW0gYW1vdW50IG9mIHdlaSBmb3IgZWFjaCB0aWVyCiAgIHVpbnQyNTYgcHVibGljIGxpbWl0VGllcjEgPSAxMi41ZTI0OwogICB1aW50MjU2IHB1YmxpYyBsaW1pdFRpZXIyID0gMjVlMjQ7CiAgIHVpbnQyNTYgcHVibGljIGxpbWl0VGllcjMgPSAzNy41ZTI0OwoKICAgLy8gVGhlIGFtb3VudCBvZiB3ZWkgcmFpc2VkCiAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogICAvLyBUaGUgYW1vdW50IG9mIHRva2VucyByYWlzZWQKICAgdWludDI1NiBwdWJsaWMgdG9rZW5zUmFpc2VkID0gMDsKCiAgIC8vIFlvdSBjYW4gb25seSBidXkgdXAgdG8gNTAgTSB0b2tlbnMgZHVyaW5nIHRoZSBJQ08KICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbWF4VG9rZW5zUmFpc2VkID0gNTBlMjQ7CgogICAvLyBUaGUgbWluaW11bSBhbW91bnQgb2YgV2VpIHlvdSBtdXN0IHBheSB0byBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlCiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pblB1cmNoYXNlID0gMTAgZmlubmV5OyAvLyAwLjAxIGV0aGVyCgogICAvLyBUaGUgbWF4IGFtb3VudCBvZiBXZWkgdGhhdCB5b3UgY2FuIHBheSB0byBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlCiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1heFB1cmNoYXNlID0gMjAwMCBldGhlcjsKCiAgIC8vIE1pbmltdW0gYW1vdW50IG9mIHRva2VucyB0byBiZSByYWlzZWQuIDcuNSBtaWxsaW9uIHRva2VucyB3aGljaCBpcyB0aGUgMTUlCiAgIC8vIG9mIHRoZSB0b3RhbCBvZiA1MCBtaWxsaW9uIHRva2VucyBzb2xkIGluIHRoZSBjcm93ZHNhbGUKICAgLy8gNy41ZTYgKyAxZTE4CiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pbmltdW1Hb2FsID0gNDI2NmUxODsvLzUuMzNlMjQ7CgogICAvLyBJZiB0aGUgY3Jvd2RzYWxlIHdhc24ndCBzdWNjZXNzZnVsLCB0aGlzIHdpbGwgYmUgdHJ1ZSBhbmQgdXNlcnMgd2lsbCBiZSBhYmxlCiAgIC8vIHRvIGNsYWltIHRoZSByZWZ1bmQgb2YgdGhlaXIgZXRoZXIKICAgYm9vbCBwdWJsaWMgaXNSZWZ1bmRpbmcgPSBmYWxzZTsKCiAgIC8vIElmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkIG9yIG5vdAogICBib29sIHB1YmxpYyBpc0VuZGVkID0gZmFsc2U7CgogICAvLyBUaGUgbnVtYmVyIG9mIHRyYW5zYWN0aW9ucwogICB1aW50MjU2IHB1YmxpYyBudW1iZXJPZlRyYW5zYWN0aW9uczsKCiAgIC8vIFRoZSBnYXMgcHJpY2UgdG8gYnV5IHRva2VucyBtdXN0IGJlIDUwIGd3ZWkgb3IgYmVsb3cKICAgdWludDI1NiBwdWJsaWMgbGltaXRHYXNQcmljZSA9IDUwMDAwMDAwMDAwIHdlaTsKCiAgIC8vIEhvdyBtdWNoIGVhY2ggdXNlciBwYWlkIGZvciB0aGUgY3Jvd2RzYWxlCiAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY3Jvd2RzYWxlQmFsYW5jZXM7CgogICAvLyBIb3cgbWFueSB0b2tlbnMgZWFjaCB1c2VyIGdvdCBmb3IgdGhlIGNyb3dkc2FsZQogICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2Vuc0JvdWdodDsKCiAgIC8vIFRvIGluZGljYXRlIHdobyBwdXJjaGFzZWQgd2hhdCBhbW91bnQgb2YgdG9rZW5zIGFuZCB3aG8gcmVjZWl2ZWQgd2hhdCBhbW91bnQgb2Ygd2VpCiAgIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudE9mVG9rZW5zKTsKCiAgIC8vIEluZGljYXRlcyBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZAogICBldmVudCBGaW5hbGl6ZWQoKTsKCiAgIC8vIE9ubHkgYWxsb3cgdGhlIGV4ZWN1dGlvbiBvZiB0aGUgZnVuY3Rpb24gYmVmb3JlIHRoZSBjcm93ZHNhbGUgc3RhcnRzCiAgIG1vZGlmaWVyIGJlZm9yZVN0YXJ0aW5nKCkgewogICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZSk7CiAgICAgIF87CiAgIH0KCiAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIG9mIHRoZSBjcm93c2FsZSB0byBzZXQgdXAgdGhlIG1haW4gdmFyaWFibGVzIGFuZCBjcmVhdGUgYSB0b2tlbgogICAvLy8gQHBhcmFtIF93YWxsZXQgVGhlIHdhbGxldCBhZGRyZXNzIHRoYXQgc3RvcmVzIHRoZSBXZWkgcmFpc2VkCiAgIC8vLyBAcGFyYW0gX3dhbGxldEIgVGhlIHdhbGxldCBhZGRyZXNzIHRoYXQgc3RvcmVzIHRoZSBXZWkgcmFpc2VkIGFmdGVyIHNvZnQgY2FwIHJlYWNoZWQKICAgLy8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIFRoZSB0b2tlbiB1c2VkIGZvciB0aGUgSUNPCiAgIGZ1bmN0aW9uIENyb3dkc2FsZSgKICAgICAgYWRkcmVzcyBfd2FsbGV0LAogICAgICBhZGRyZXNzIF93YWxsZXRCLAogICAgICBhZGRyZXNzIF90b2tlbkFkZHJlc3MsCiAgICAgIHVpbnQyNTYgX3N0YXJ0VGltZSwKICAgICAgdWludDI1NiBfZW5kVGltZQogICApIHB1YmxpYyB7CiAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShfdG9rZW5BZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKF93YWxsZXRCICE9IGFkZHJlc3MoMCkpOwoKICAgICAgLy8gSWYgeW91IHNlbmQgdGhlIHN0YXJ0IGFuZCBlbmQgdGltZSBvbiB0aGUgY29uc3RydWN0b3IsIHRoZSBlbmQgbXVzdCBiZSBsYXJnZXIKICAgICAgaWYoX3N0YXJ0VGltZSA+IDAgJiYgX2VuZFRpbWUgPiAwKQogICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPCBfZW5kVGltZSk7CgogICAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgICB3YWxsZXRCID0gX3dhbGxldEI7CiAgICAgIHRva2VuID0gUGFsbHlDb2luKF90b2tlbkFkZHJlc3MpOwogICAgICB2YXVsdCA9IG5ldyBSZWZ1bmRWYXVsdChfd2FsbGV0KTsKCiAgICAgIGlmKF9zdGFydFRpbWUgPiAwKQogICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwoKICAgICAgaWYoX2VuZFRpbWUgPiAwKQogICAgICAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEZhbGxiYWNrIGZ1bmN0aW9uIHRvIGJ1eSB0b2tlbnMKICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgIGJ1eVRva2VucygpOwogICB9CgogICAvLy8gQG5vdGljZSBUbyBidXkgdG9rZW5zIGdpdmVuIGFuIGFkZHJlc3MKICAgZnVuY3Rpb24gYnV5VG9rZW5zKCkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICAgIHVpbnQyNTYgdG9rZW5zID0gMDsKICAgICAgCiAgICAgIHVpbnQyNTYgYW1vdW50UGFpZCA9IGNhbGN1bGF0ZUV4Y2Vzc0JhbGFuY2UoKTsKCiAgICAgIGlmKHRva2Vuc1JhaXNlZCA8IGxpbWl0VGllcjEpIHsKCiAgICAgICAgIC8vIFRpZXIgMQogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlKTsKCiAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgeW91IHdhbnQgdG8gYnV5IGdldHMgb3V0IG9mIHRoaXMgdGllcgogICAgICAgICBpZih0b2tlbnNSYWlzZWQuYWRkKHRva2VucykgPiBsaW1pdFRpZXIxKQogICAgICAgICAgICB0b2tlbnMgPSBjYWxjdWxhdGVFeGNlc3NUb2tlbnMoYW1vdW50UGFpZCwgbGltaXRUaWVyMSwgMSwgcmF0ZSk7CiAgICAgIH0gZWxzZSBpZih0b2tlbnNSYWlzZWQgPj0gbGltaXRUaWVyMSAmJiB0b2tlbnNSYWlzZWQgPCBsaW1pdFRpZXIyKSB7CgogICAgICAgICAvLyBUaWVyIDIKICAgICAgICAgdG9rZW5zID0gYW1vdW50UGFpZC5tdWwocmF0ZVRpZXIyKTsKCiAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgeW91IHdhbnQgdG8gYnV5IGdldHMgb3V0IG9mIHRoaXMgdGllcgogICAgICAgICBpZih0b2tlbnNSYWlzZWQuYWRkKHRva2VucykgPiBsaW1pdFRpZXIyKQogICAgICAgICAgICB0b2tlbnMgPSBjYWxjdWxhdGVFeGNlc3NUb2tlbnMoYW1vdW50UGFpZCwgbGltaXRUaWVyMiwgMiwgcmF0ZVRpZXIyKTsKICAgICAgfSBlbHNlIGlmKHRva2Vuc1JhaXNlZCA+PSBsaW1pdFRpZXIyICYmIHRva2Vuc1JhaXNlZCA8IGxpbWl0VGllcjMpIHsKCiAgICAgICAgIC8vIFRpZXIgMwogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlVGllcjMpOwoKICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB5b3Ugd2FudCB0byBidXkgZ2V0cyBvdXQgb2YgdGhpcyB0aWVyCiAgICAgICAgIGlmKHRva2Vuc1JhaXNlZC5hZGQodG9rZW5zKSA+IGxpbWl0VGllcjMpCiAgICAgICAgICAgIHRva2VucyA9IGNhbGN1bGF0ZUV4Y2Vzc1Rva2VucyhhbW91bnRQYWlkLCBsaW1pdFRpZXIzLCAzLCByYXRlVGllcjMpOwogICAgICB9IGVsc2UgaWYodG9rZW5zUmFpc2VkID49IGxpbWl0VGllcjMpIHsKCiAgICAgICAgIC8vIFRpZXIgNAogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlVGllcjQpOwogICAgICB9CgogICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKGFtb3VudFBhaWQpOwogICAgICB1aW50MjU2IHRva2Vuc1JhaXNlZEJlZm9yZVRoaXNUcmFuc2FjdGlvbiA9IHRva2Vuc1JhaXNlZDsKICAgICAgdG9rZW5zUmFpc2VkID0gdG9rZW5zUmFpc2VkLmFkZCh0b2tlbnMpOwogICAgICB0b2tlbi5kaXN0cmlidXRlSUNPVG9rZW5zKG1zZy5zZW5kZXIsIHRva2Vucyk7CgogICAgICAvLyBLZWVwIGEgcmVjb3JkIG9mIGhvdyBtYW55IHRva2VucyBldmVyeWJvZHkgZ2V0cyBpbiBjYXNlIHdlIG5lZWQgdG8gZG8gcmVmdW5kcwogICAgICB0b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl0gPSB0b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl0uYWRkKHRva2Vucyk7CiAgICAgIFRva2VuUHVyY2hhc2UobXNnLnNlbmRlciwgYW1vdW50UGFpZCwgdG9rZW5zKTsKICAgICAgbnVtYmVyT2ZUcmFuc2FjdGlvbnMgPSBudW1iZXJPZlRyYW5zYWN0aW9ucy5hZGQoMSk7CgogICAgICBpZih0b2tlbnNSYWlzZWRCZWZvcmVUaGlzVHJhbnNhY3Rpb24gPiBtaW5pbXVtR29hbCkgewoKICAgICAgICAgd2FsbGV0Qi50cmFuc2ZlcihhbW91bnRQYWlkKTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgIHZhdWx0LmRlcG9zaXQudmFsdWUoYW1vdW50UGFpZCkobXNnLnNlbmRlcik7CiAgICAgICAgIGlmKGdvYWxSZWFjaGVkKCkpIHsKICAgICAgICAgIHZhdWx0LmNsb3NlKCk7CiAgICAgICAgIH0KICAgICAgICAgCiAgICAgIH0KCiAgICAgIC8vIElmIHRoZSBtaW5pbXVtIGdvYWwgb2YgdGhlIElDTyBoYXMgYmVlbiByZWFjaCwgY2xvc2UgdGhlIHZhdWx0IHRvIHNlbmQKICAgICAgLy8gdGhlIGV0aGVyIHRvIHRoZSB3YWxsZXQgb2YgdGhlIGNyb3dkc2FsZQogICAgICBjaGVja0NvbXBsZXRlZENyb3dkc2FsZSgpOwogICB9CgogICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIGhvdyBtYW55IGV0aGVyIHdpbGwgYmUgdXNlZCB0byBnZW5lcmF0ZSB0aGUgdG9rZW5zIGluCiAgIC8vLyBjYXNlIHRoZSBidXllciBzZW5kcyBtb3JlIHRoYW4gdGhlIG1heGltdW0gYmFsYW5jZSBidXQgaGFzIHNvbWUgYmFsYW5jZSBsZWZ0CiAgIC8vLyBhbmQgdXBkYXRlcyB0aGUgYmFsYW5jZSBvZiB0aGF0IGJ1eWVyLgogICAvLy8gRm9yIGluc3RhbmNlIGlmIGhlJ3MgNTAwIGJhbGFuY2UgYW5kIGhlIHNlbmRzIDEwMDAsIGl0IHdpbGwgcmV0dXJuIDUwMAogICAvLy8gYW5kIHJlZnVuZCB0aGUgb3RoZXIgNTAwIGV0aGVyCiAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUV4Y2Vzc0JhbGFuY2UoKSBpbnRlcm5hbCB3aGVuTm90UGF1c2VkIHJldHVybnModWludDI1NikgewogICAgICB1aW50MjU2IGFtb3VudFBhaWQgPSBtc2cudmFsdWU7CiAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZVdlaSA9IDA7CiAgICAgIHVpbnQyNTYgZXhjZWVkaW5nQmFsYW5jZSA9IDA7CgogICAgICAvLyBJZiB3ZSdyZSBpbiB0aGUgbGFzdCB0aWVyLCBjaGVjayB0aGF0IHRoZSBsaW1pdCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgICAgIC8vIGFuZCBpZiBzbywgcmVmdW5kIHRoZSBkaWZmZXJlbmNlIGFuZCByZXR1cm4gd2hhdCB3aWxsIGJlIHVzZWQgdG8KICAgICAgLy8gYnV5IHRoZSByZW1haW5pbmcgdG9rZW5zCiAgICAgIGlmKHRva2Vuc1JhaXNlZCA+PSBsaW1pdFRpZXIzKSB7CiAgICAgICAgIHVpbnQyNTYgYWRkZWRUb2tlbnMgPSB0b2tlbnNSYWlzZWQuYWRkKGFtb3VudFBhaWQubXVsKHJhdGVUaWVyNCkpOwoKICAgICAgICAgLy8gSWYgdG9rZW5zUmFpc2VkICsgd2hhdCB5b3UgcGFpZCBjb252ZXJ0ZWQgdG8gdG9rZW5zIGlzIGJpZ2dlciB0aGFuIHRoZSBtYXgKICAgICAgICAgaWYoYWRkZWRUb2tlbnMgPiBtYXhUb2tlbnNSYWlzZWQpIHsKCiAgICAgICAgICAgIC8vIFJlZnVuZCB0aGUgZGlmZmVyZW5jZQogICAgICAgICAgICB1aW50MjU2IGRpZmZlcmVuY2UgPSBhZGRlZFRva2Vucy5zdWIobWF4VG9rZW5zUmFpc2VkKTsKICAgICAgICAgICAgZGlmZmVyZW5jZVdlaSA9IGRpZmZlcmVuY2UuZGl2KHJhdGVUaWVyNCk7CiAgICAgICAgICAgIGFtb3VudFBhaWQgPSBhbW91bnRQYWlkLnN1YihkaWZmZXJlbmNlV2VpKTsKICAgICAgICAgfQogICAgICB9CgogICAgICB1aW50MjU2IGFkZGVkQmFsYW5jZSA9IGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChhbW91bnRQYWlkKTsKCiAgICAgIC8vIENoZWNraW5nIHRoYXQgdGhlIGluZGl2aWR1YWwgbGltaXQgb2YgMTAwMCBFVEggcGVyIHVzZXIgaXMgbm90IHJlYWNoZWQKICAgICAgaWYoYWRkZWRCYWxhbmNlIDw9IG1heFB1cmNoYXNlKSB7CiAgICAgICAgIGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdID0gY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKGFtb3VudFBhaWQpOwogICAgICB9IGVsc2UgewoKICAgICAgICAgLy8gU3Vic3RyYWN0aW5nIDEwMDAgZXRoZXIgaW4gd2VpCiAgICAgICAgIGV4Y2VlZGluZ0JhbGFuY2UgPSBhZGRlZEJhbGFuY2Uuc3ViKG1heFB1cmNoYXNlKTsKICAgICAgICAgYW1vdW50UGFpZCA9IGFtb3VudFBhaWQuc3ViKGV4Y2VlZGluZ0JhbGFuY2UpOwoKICAgICAgICAgLy8gQWRkIHRoYXQgYmFsYW5jZSB0byB0aGUgYmFsYW5jZXMKICAgICAgICAgY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQoYW1vdW50UGFpZCk7CiAgICAgIH0KCiAgICAgIC8vIE1ha2UgdGhlIHRyYW5zZmVycyBhdCB0aGUgZW5kIG9mIHRoZSBmdW5jdGlvbiBmb3Igc2VjdXJpdHkgcHVycG9zZXMKICAgICAgaWYoZGlmZmVyZW5jZVdlaSA+IDApCiAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZGlmZmVyZW5jZVdlaSk7CgogICAgICBpZihleGNlZWRpbmdCYWxhbmNlID4gMCkgewoKICAgICAgICAgLy8gUmV0dXJuIHRoZSBleGNlZWRpbmcgYmFsYW5jZSB0byB0aGUgYnV5ZXIKICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlZWRpbmdCYWxhbmNlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGFtb3VudFBhaWQ7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFNldCdzIHRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIgZm9yIGVhY2ggdGllci4gVXNlIGl0IGFmdGVyIHRoZQogICAvLy8gc21hcnQgY29udHJhY3QgaXMgZGVwbG95ZWQgdG8gc2V0IHRoZSBwcmljZSBhY2NvcmRpbmcgdG8gdGhlIGV0aGVyIHByaWNlCiAgIC8vLyBhdCB0aGUgc3RhcnQgb2YgdGhlIElDTwogICAvLy8gQHBhcmFtIHRpZXIxIFRoZSBhbW91bnQgb2YgdG9rZW5zIHlvdSBnZXQgaW4gdGhlIHRpZXIgb25lCiAgIC8vLyBAcGFyYW0gdGllcjIgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciB0d28KICAgLy8vIEBwYXJhbSB0aWVyMyBUaGUgYW1vdW50IG9mIHRva2VucyB5b3UgZ2V0IGluIHRoZSB0aWVyIHRocmVlCiAgIC8vLyBAcGFyYW0gdGllcjQgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciBmb3VyCiAgIGZ1bmN0aW9uIHNldFRpZXJSYXRlcyh1aW50MjU2IHRpZXIxLCB1aW50MjU2IHRpZXIyLCB1aW50MjU2IHRpZXIzLCB1aW50MjU2IHRpZXI0KQogICAgICBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZAogICB7CiAgICAgIHJlcXVpcmUodGllcjEgPiAwICYmIHRpZXIyID4gMCAmJiB0aWVyMyA+IDAgJiYgdGllcjQgPiAwKTsKICAgICAgcmVxdWlyZSh0aWVyMSA+IHRpZXIyICYmIHRpZXIyID4gdGllcjMgJiYgdGllcjMgPiB0aWVyNCk7CgogICAgICByYXRlID0gdGllcjE7CiAgICAgIHJhdGVUaWVyMiA9IHRpZXIyOwogICAgICByYXRlVGllcjMgPSB0aWVyMzsKICAgICAgcmF0ZVRpZXI0ID0gdGllcjQ7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEFsbG93IHRvIGV4dGVuZCBJQ08gZW5kIGRhdGUKICAgLy8vIEBwYXJhbSBfZW5kVGltZSBFbmR0aW1lIG9mIElDTwogICBmdW5jdGlvbiBzZXRFbmREYXRlKHVpbnQyNTYgX2VuZFRpbWUpCiAgICAgIGV4dGVybmFsIG9ubHlPd25lciB3aGVuTm90UGF1c2VkCiAgIHsKICAgICAgcmVxdWlyZShub3cgPD0gX2VuZFRpbWUpOwogICAgICByZXF1aXJlKHN0YXJ0VGltZSA8IF9lbmRUaW1lKTsKICAgICAgCiAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgfQoKCiAgIC8vLyBAbm90aWNlIENoZWNrIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkIGFuZCBlbmFibGVzIHJlZnVuZHMgb25seSBpbiBjYXNlIHRoZQogICAvLy8gZ29hbCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgIGZ1bmN0aW9uIGNoZWNrQ29tcGxldGVkQ3Jvd2RzYWxlKCkgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICBpZighaXNFbmRlZCkgewogICAgICAgICBpZihoYXNFbmRlZCgpICYmICFnb2FsUmVhY2hlZCgpKXsKICAgICAgICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwoKICAgICAgICAgICAgaXNSZWZ1bmRpbmcgPSB0cnVlOwogICAgICAgICAgICBpc0VuZGVkID0gdHJ1ZTsKICAgICAgICAgICAgRmluYWxpemVkKCk7CiAgICAgICAgIH0gZWxzZSBpZihoYXNFbmRlZCgpICAmJiBnb2FsUmVhY2hlZCgpKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgaXNFbmRlZCA9IHRydWU7IAoKCiAgICAgICAgICAgIC8vIEJ1cm4gdG9rZW4gb25seSB3aGVuIG1pbmltdW0gZ29hbCByZWFjaGVkIGFuZCBtYXhHb2FsIG5vdCByZWFjaGVkLiAKICAgICAgICAgICAgaWYodG9rZW5zUmFpc2VkIDwgbWF4VG9rZW5zUmFpc2VkKSB7CgogICAgICAgICAgICAgICB0b2tlbi5idXJuVG9rZW5zKCk7CgogICAgICAgICAgICB9IAoKICAgICAgICAgICAgRmluYWxpemVkKCk7CiAgICAgICAgIH0gCiAgICAgICAgIAogICAgICAgICAKICAgICAgfQogICB9CgogICAvLy8gQG5vdGljZSBJZiBjcm93ZHNhbGUgaXMgdW5zdWNjZXNzZnVsLCBpbnZlc3RvcnMgY2FuIGNsYWltIHJlZnVuZHMgaGVyZQogICBmdW5jdGlvbiBjbGFpbVJlZnVuZCgpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgICByZXF1aXJlKGhhc0VuZGVkKCkgJiYgIWdvYWxSZWFjaGVkKCkgJiYgaXNSZWZ1bmRpbmcpOwoKICAgICB2YXVsdC5yZWZ1bmQobXNnLnNlbmRlcik7CiAgICAgdG9rZW4ucmVmdW5kVG9rZW5zKG1zZy5zZW5kZXIsIHRva2Vuc0JvdWdodFttc2cuc2VuZGVyXSk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEJ1eXMgdGhlIHRva2VucyBmb3IgdGhlIHNwZWNpZmllZCB0aWVyIGFuZCBmb3IgdGhlIG5leHQgb25lCiAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgZXRoZXIgcGFpZCB0byBidXkgdGhlIHRva2VucwogICAvLy8gQHBhcmFtIHRva2Vuc1RoaXNUaWVyIFRoZSBsaW1pdCBvZiB0b2tlbnMgb2YgdGhhdCB0aWVyCiAgIC8vLyBAcGFyYW0gdGllclNlbGVjdGVkIFRoZSB0aWVyIHNlbGVjdGVkCiAgIC8vLyBAcGFyYW0gX3JhdGUgVGhlIHJhdGUgdXNlZCBmb3IgdGhhdCBgdGllclNlbGVjdGVkYAogICAvLy8gQHJldHVybiB1aW50IFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGJvdWdodCBjb21iaW5pbmcgdGhlIHRpZXIgcHJpY2VzCiAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUV4Y2Vzc1Rva2VucygKICAgICAgdWludDI1NiBhbW91bnQsCiAgICAgIHVpbnQyNTYgdG9rZW5zVGhpc1RpZXIsCiAgICAgIHVpbnQyNTYgdGllclNlbGVjdGVkLAogICAgICB1aW50MjU2IF9yYXRlCiAgICkgcHVibGljIHJldHVybnModWludDI1NiB0b3RhbFRva2VucykgewogICAgICByZXF1aXJlKGFtb3VudCA+IDAgJiYgdG9rZW5zVGhpc1RpZXIgPiAwICYmIF9yYXRlID4gMCk7CiAgICAgIHJlcXVpcmUodGllclNlbGVjdGVkID49IDEgJiYgdGllclNlbGVjdGVkIDw9IDQpOwoKICAgICAgdWludCB3ZWlUaGlzVGllciA9IHRva2Vuc1RoaXNUaWVyLnN1Yih0b2tlbnNSYWlzZWQpLmRpdihfcmF0ZSk7CiAgICAgIHVpbnQgd2VpTmV4dFRpZXIgPSBhbW91bnQuc3ViKHdlaVRoaXNUaWVyKTsKICAgICAgdWludCB0b2tlbnNOZXh0VGllciA9IDA7CiAgICAgIGJvb2wgcmV0dXJuVG9rZW5zID0gZmFsc2U7CgogICAgICAvLyBJZiB0aGVyZSdzIGV4Y2Vzc2l2ZSB3ZWkgZm9yIHRoZSBsYXN0IHRpZXIsIHJlZnVuZCB0aG9zZQogICAgICBpZih0aWVyU2VsZWN0ZWQgIT0gNCkKICAgICAgICAgdG9rZW5zTmV4dFRpZXIgPSBjYWxjdWxhdGVUb2tlbnNUaWVyKHdlaU5leHRUaWVyLCB0aWVyU2VsZWN0ZWQuYWRkKDEpKTsKICAgICAgZWxzZQogICAgICAgICByZXR1cm5Ub2tlbnMgPSB0cnVlOwoKICAgICAgdG90YWxUb2tlbnMgPSB0b2tlbnNUaGlzVGllci5zdWIodG9rZW5zUmFpc2VkKS5hZGQodG9rZW5zTmV4dFRpZXIpOwoKICAgICAgLy8gRG8gdGhlIHRyYW5zZmVyIGF0IHRoZSBlbmQKICAgICAgaWYocmV0dXJuVG9rZW5zKSBtc2cuc2VuZGVyLnRyYW5zZmVyKHdlaU5leHRUaWVyKTsKICAgfQoKICAgLy8vIEBub3RpY2UgQnV5cyB0aGUgdG9rZW5zIGdpdmVuIHRoZSBwcmljZSBvZiB0aGUgdGllciBvbmUgYW5kIHRoZSB3ZWkgcGFpZAogICAvLy8gQHBhcmFtIHdlaVBhaWQgVGhlIGFtb3VudCBvZiB3ZWkgcGFpZCB0aGF0IHdpbGwgYmUgdXNlZCB0byBidXkgdG9rZW5zCiAgIC8vLyBAcGFyYW0gdGllclNlbGVjdGVkIFRoZSB0aWVyIHRoYXQgeW91J2xsIHVzZSBmb3IgdGhpciBwdXJjaGFzZQogICAvLy8gQHJldHVybiBjYWxjdWxhdGVkVG9rZW5zIFJldHVybnMgaG93IG1hbnkgdG9rZW5zIHlvdSd2ZSBib3VnaHQgZm9yIHRoYXQgd2VpIHBhaWQKICAgZnVuY3Rpb24gY2FsY3VsYXRlVG9rZW5zVGllcih1aW50MjU2IHdlaVBhaWQsIHVpbnQyNTYgdGllclNlbGVjdGVkKQogICAgICAgIGludGVybmFsIGNvbnN0YW50IHJldHVybnModWludDI1NiBjYWxjdWxhdGVkVG9rZW5zKQogICB7CiAgICAgIHJlcXVpcmUod2VpUGFpZCA+IDApOwogICAgICByZXF1aXJlKHRpZXJTZWxlY3RlZCA+PSAxICYmIHRpZXJTZWxlY3RlZCA8PSA0KTsKCiAgICAgIGlmKHRpZXJTZWxlY3RlZCA9PSAxKQogICAgICAgICBjYWxjdWxhdGVkVG9rZW5zID0gd2VpUGFpZC5tdWwocmF0ZSk7CiAgICAgIGVsc2UgaWYodGllclNlbGVjdGVkID09IDIpCiAgICAgICAgIGNhbGN1bGF0ZWRUb2tlbnMgPSB3ZWlQYWlkLm11bChyYXRlVGllcjIpOwogICAgICBlbHNlIGlmKHRpZXJTZWxlY3RlZCA9PSAzKQogICAgICAgICBjYWxjdWxhdGVkVG9rZW5zID0gd2VpUGFpZC5tdWwocmF0ZVRpZXIzKTsKICAgICAgZWxzZQogICAgICAgICBjYWxjdWxhdGVkVG9rZW5zID0gd2VpUGFpZC5tdWwocmF0ZVRpZXI0KTsKICAgfQoKCiAgIC8vLyBAbm90aWNlIENoZWNrcyBpZiBhIHB1cmNoYXNlIGlzIGNvbnNpZGVyZWQgdmFsaWQKICAgLy8vIEByZXR1cm4gYm9vbCBJZiB0aGUgcHVyY2hhc2UgaXMgdmFsaWQgb3Igbm90CiAgIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgYm9vbCB3aXRoaW5QZXJpb2QgPSBub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lOwogICAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSA+IDA7CiAgICAgIGJvb2wgd2l0aGluVG9rZW5MaW1pdCA9IHRva2Vuc1JhaXNlZCA8IG1heFRva2Vuc1JhaXNlZDsKICAgICAgYm9vbCBtaW5pbXVtUHVyY2hhc2UgPSBtc2cudmFsdWUgPj0gbWluUHVyY2hhc2U7CiAgICAgIGJvb2wgaGFzQmFsYW5jZUF2YWlsYWJsZSA9IGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdIDwgbWF4UHVyY2hhc2U7CgogICAgICAvLyBXZSB3YW50IHRvIGxpbWl0IHRoZSBnYXMgdG8gYXZvaWQgZ2l2aW5nIHByaW9yaXR5IHRvIHRoZSBiaWdnZXN0IHBheWluZyBjb250cmlidXRvcnMKICAgICAgLy9ib29sIGxpbWl0R2FzID0gdHguZ2FzcHJpY2UgPD0gbGltaXRHYXNQcmljZTsKCiAgICAgIHJldHVybiB3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlICYmIHdpdGhpblRva2VuTGltaXQgJiYgbWluaW11bVB1cmNoYXNlICYmIGhhc0JhbGFuY2VBdmFpbGFibGU7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFRvIHNlZSBpZiB0aGUgbWluaW11bSBnb2FsIG9mIHRva2VucyBvZiB0aGUgSUNPIGhhcyBiZWVuIHJlYWNoZWQKICAgLy8vIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSB0b2tlbnMgcmFpc2VkIGFyZSBiaWdnZXIgdGhhbiB0aGUgZ29hbCBvciBmYWxzZSBvdGhlcndpc2UKICAgZnVuY3Rpb24gZ29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgIHJldHVybiB0b2tlbnNSYWlzZWQgPj0gbWluaW11bUdvYWw7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFB1YmxpYyBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZCBvciBub3QKICAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgIHJldHVybiBub3cgPiBlbmRUaW1lIHx8IHRva2Vuc1JhaXNlZCA+PSBtYXhUb2tlbnNSYWlzZWQ7CiAgIH0KfQ=='.
	

]
