Class {
	#name : #SRT2107a4aa352d92b73d0ea959a2a02384d68d8bfc,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2107a4aa352d92b73d0ea959a2a02384d68d8bfc >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBUb2tlbiB7IC8vIEVSQzIwIHN0YW5kYXJkCgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKY29udHJhY3QgU2FmZU1hdGggewoKICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CiAgZnVuY3Rpb24gc2FmZU51bURpZ2l0cyh1aW50IG51bWJlcikgcHVyZSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCkgewogICAgdWludDggZGlnaXRzID0gMDsKICAgIHdoaWxlIChudW1iZXIgIT0gMCkgewogICAgICAgIG51bWJlciAvPSAxMDsKICAgICAgICBkaWdpdHMrKzsKICAgIH0KICAgIHJldHVybiBkaWdpdHM7Cn0KCiAgLy8gbWl0aWdhdGUgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICAvLyB0aGFua3MgdG8gaHR0cHM6Ly9naXRodWIuY29tL251bWVyYWkvY29udHJhY3QvYmxvYi9jMTgyNDY1ZjgyZTUwY2VkOGRhY2IzOTc3ZWMzNzRhODkyZjVmYThjL2NvbnRyYWN0cy9TYWZlLnNvbCNMMzAtTDM0LgogIC8vIFRPRE86IGRvdWJsZWNoZWNrIGltcGxpY2F0aW9uIG9mID49IGNvbXBhcmVkIHRvID09CiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgbnVtV29yZHMpIHsKICAgICBhc3NlcnQobXNnLmRhdGEubGVuZ3RoID49IG51bVdvcmRzICogMzIgKyA0KTsKICAgICBfOwogIH0KCn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgVG9rZW4sIFNhZmVNYXRoIHsKCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlQYXlsb2FkU2l6ZSgyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMykgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3NlcycKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nICdhcHByb3ZlKF9zcGVuZGVyLCAwKScgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlQYXlsb2FkU2l6ZSgyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfb2xkVmFsdWUsIHVpbnQyNTYgX25ld1ZhbHVlKSBwdWJsaWMgb25seVBheWxvYWRTaXplKDMpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gX29sZFZhbHVlKTsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9uZXdWYWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX25ld1ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCn0KCgpjb250cmFjdCBHUk8gaXMgU3RhbmRhcmRUb2tlbiB7CiAgICAvLyBGSUVMRFMKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJHcm9uIERpZ2l0YWwiOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiR1JPIjsKICAgIHVpbnQyNTYgcHVibGljIGRlY2ltYWxzID0gMTg7CiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAiMTAuMCI7CgogICAgLy8gTmluZSBIdW5kcmVkIGFuZCBGaWZ0eSBtaWxsaW9uIHdpdGggc3VwcG9ydCBmb3IgMTggZGVjaW1hbHMKICAgIHVpbnQyNTYgcHVibGljIHRva2VuQ2FwID0gOTUwMDAwMDAwICogMTAqKjE4OwoKICAgIC8vIGNyb3dkc2FsZSBwYXJhbWV0ZXJzCiAgICB1aW50MjU2IHB1YmxpYyBmdW5kaW5nU3RhcnRCbG9jazsKICAgIHVpbnQyNTYgcHVibGljIGZ1bmRpbmdFbmRCbG9jazsKCiAgICAvLyB2ZXN0aW5nIGZpZWxkcwogICAgYWRkcmVzcyBwdWJsaWMgdmVzdGluZ0NvbnRyYWN0OwogICAgYm9vbCBwcml2YXRlIHZlc3RpbmdTZXQgPSBmYWxzZTsKCiAgICAvLyByb290IGNvbnRyb2wKICAgIGFkZHJlc3MgcHVibGljIGZ1bmRXYWxsZXQ7CiAgICAvLyBjb250cm9sIG9mIGxpcXVpZGl0eSBhbmQgbGltaXRlZCBjb250cm9sIG9mIHVwZGF0ZVByaWNlCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sV2FsbGV0OwogICAgLy8gdGltZSB0byB3YWl0IGJldHdlZW4gY29udHJvbFdhbGxldCBwcmljZSB1cGRhdGVzCiAgICB1aW50MjU2IHB1YmxpYyB3YWl0VGltZSA9IDUgaG91cnM7CgogICAgLy8gZnVuZFdhbGxldCBjb250cm9sbGVkIHN0YXRlIHZhcmlhYmxlcwogICAgLy8gaGFsdGVkOiBoYWx0IGJ1eWluZyBkdWUgdG8gZW1lcmdlbmN5LCB0cmFkZWFibGU6IHNpZ25hbCB0aGF0IEdST04gcGxhdGZvcm0gaXMgdXAgYW5kIHJ1bm5pbmcKICAgIGJvb2wgcHVibGljIGhhbHRlZCA9IGZhbHNlOwogICAgYm9vbCBwdWJsaWMgdHJhZGVhYmxlID0gZmFsc2U7CgogICAgLy8gLS0gdG90YWxTdXBwbHkgZGVmaW5lZCBpbiBTdGFuZGFyZFRva2VuCiAgICAvLyAtLSBtYXBwaW5nIHRvIHRva2VuIGJhbGFuY2VzIGRvbmUgaW4gU3RhbmRhcmRUb2tlbgoKICAgIHVpbnQyNTYgcHVibGljIHByZXZpb3VzVXBkYXRlVGltZSA9IDA7CiAgICBQcmljZSBwdWJsaWMgY3VycmVudFByaWNlOwogICAgdWludDI1NiBwdWJsaWMgbWluQW1vdW50ID0gMC4wNSBldGhlcjsgLy8gNTAwIEdSTwoKICAgIC8vIG1hcCBwYXJ0aWNpcGFudCBhZGRyZXNzIHRvIGEgd2l0aGRyYXdhbCByZXF1ZXN0CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFdpdGhkcmF3YWwpIHB1YmxpYyB3aXRoZHJhd2FsczsKICAgIC8vIG1hcHMgcHJldmlvdXNVcGRhdGVUaW1lIHRvIHRoZSBuZXh0IHByaWNlCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IFByaWNlKSBwdWJsaWMgcHJpY2VzOwogICAgLy8gbWFwcyBhZGRyZXNzZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHdoaXRlbGlzdDsKCiAgICAvLyBUWVBFUwoKICAgIHN0cnVjdCBQcmljZSB7IC8vIHRva2Vuc1BlckV0aAogICAgICAgIHVpbnQyNTYgbnVtZXJhdG9yOwogICAgfQoKICAgIHN0cnVjdCBXaXRoZHJhd2FsIHsKICAgICAgICB1aW50MjU2IHRva2VuczsKICAgICAgICB1aW50MjU2IHRpbWU7IC8vIHRpbWUgZm9yIGVhY2ggd2l0aGRyYXdhbCBpcyBzZXQgdG8gdGhlIHByZXZpb3VzVXBkYXRlVGltZQogICAgfQoKICAgIC8vIEVWRU5UUwoKICAgIGV2ZW50IEJ1eShhZGRyZXNzIGluZGV4ZWQgcGFydGljaXBhbnQsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlWYWx1ZSwgdWludDI1NiBhbW91bnRUb2tlbnMpOwogICAgZXZlbnQgQWxsb2NhdGVQcmVzYWxlKGFkZHJlc3MgaW5kZXhlZCBwYXJ0aWNpcGFudCwgdWludDI1NiBhbW91bnRUb2tlbnMpOwogICAgZXZlbnQgQm9udXNBbGxvY2F0aW9uKGFkZHJlc3MgaW5kZXhlZCBwYXJ0aWNpcGFudCwgc3RyaW5nIHBhcnRpY2lwYW50X2FkZHIsIHN0cmluZyB0eG5IYXNoLCB1aW50MjU2IGJvbnVzVG9rZW5zKTsKICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBXaGl0ZWxpc3QoYWRkcmVzcyBpbmRleGVkIHBhcnRpY2lwYW50KTsKICAgIGV2ZW50IFByaWNlVXBkYXRlKHVpbnQyNTYgbnVtZXJhdG9yKTsKICAgIGV2ZW50IEFkZExpcXVpZGl0eSh1aW50MjU2IGV0aEFtb3VudCk7CiAgICBldmVudCBSZW1vdmVMaXF1aWRpdHkodWludDI1NiBldGhBbW91bnQpOwogICAgZXZlbnQgV2l0aGRyYXdSZXF1ZXN0KGFkZHJlc3MgaW5kZXhlZCBwYXJ0aWNpcGFudCwgdWludDI1NiBhbW91bnRUb2tlbnMpOwogICAgZXZlbnQgV2l0aGRyYXcoYWRkcmVzcyBpbmRleGVkIHBhcnRpY2lwYW50LCB1aW50MjU2IGFtb3VudFRva2VucywgdWludDI1NiBldGhlckFtb3VudCk7CgogICAgLy8gTU9ESUZJRVJTCgogICAgbW9kaWZpZXIgaXNUcmFkZWFibGUgeyAvLyBleGVtcHQgdmVzdGluZ0NvbnRyYWN0IGFuZCBmdW5kV2FsbGV0IHRvIGFsbG93IGRldiBhbGxvY2F0aW9ucwogICAgICAgIHJlcXVpcmUodHJhZGVhYmxlIHx8IG1zZy5zZW5kZXIgPT0gZnVuZFdhbGxldCB8fCBtc2cuc2VuZGVyID09IHZlc3RpbmdDb250cmFjdCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5V2hpdGVsaXN0IHsKICAgICAgICByZXF1aXJlKHdoaXRlbGlzdFttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGZ1bmRXYWxsZXQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU1hbmFnaW5nV2FsbGV0cyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyb2xXYWxsZXQgfHwgbXNnLnNlbmRlciA9PSBmdW5kV2FsbGV0KTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlfaWZfY29udHJvbFdhbGxldCB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gY29udHJvbFdhbGxldCkgXzsKICAgIH0KICAgIG1vZGlmaWVyIHJlcXVpcmVfd2FpdGVkIHsKICAgICAgcmVxdWlyZShzYWZlU3ViKGN1cnJlbnRUaW1lKCksIHdhaXRUaW1lKSA+PSBwcmV2aW91c1VwZGF0ZVRpbWUpOwogICAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBvbmx5X2lmX2RlY3JlYXNlICh1aW50MjU2IG5ld051bWVyYXRvcikgewogICAgICAgIGlmIChuZXdOdW1lcmF0b3IgPCBjdXJyZW50UHJpY2UubnVtZXJhdG9yKSBfOwogICAgfQoKICAgIC8vIENPTlNUUlVDVE9SCiAgICBmdW5jdGlvbiBHUk8oKSBwdWJsaWMgewogICAgICAgIGZ1bmRXYWxsZXQgPSBtc2cuc2VuZGVyOwogICAgICAgIHdoaXRlbGlzdFtmdW5kV2FsbGV0XSA9IHRydWU7CiAgICAgICAgcHJldmlvdXNVcGRhdGVUaW1lID0gY3VycmVudFRpbWUoKTsKICAgIH0KCiAgICAvLyBDYWxsZWQgYWZ0ZXIgZGVwbG95bWVudAogICAgLy8gTm90IGFsbCBkZXBsb3ltZW50IGNsaWVudHMgc3VwcG9ydCBjb25zdHJ1Y3RvciBhcmd1bWVudHMuCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIHByb3ZpZGVkIGZvciBtYXhpbXVtIGNvbXBhdGliaWxpdHkuIAogICAgZnVuY3Rpb24gaW5pdGlhbGlzZUNvbnRyYWN0KGFkZHJlc3MgY29udHJvbFdhbGxldElucHV0LCB1aW50MjU2IHByaWNlTnVtZXJhdG9ySW5wdXQsIHVpbnQyNTYgc3RhcnRCbG9ja0lucHV0LCB1aW50MjU2IGVuZEJsb2NrSW5wdXQpIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgcmVxdWlyZShjb250cm9sV2FsbGV0SW5wdXQgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUocHJpY2VOdW1lcmF0b3JJbnB1dCA+IDApOwogICAgICByZXF1aXJlKGVuZEJsb2NrSW5wdXQgPiBzdGFydEJsb2NrSW5wdXQpOwogICAgICBjb250cm9sV2FsbGV0ID0gY29udHJvbFdhbGxldElucHV0OwogICAgICB3aGl0ZWxpc3RbY29udHJvbFdhbGxldF0gPSB0cnVlOwogICAgICBjdXJyZW50UHJpY2UgPSBQcmljZShwcmljZU51bWVyYXRvcklucHV0KTsKICAgICAgZnVuZGluZ1N0YXJ0QmxvY2sgPSBzdGFydEJsb2NrSW5wdXQ7CiAgICAgIGZ1bmRpbmdFbmRCbG9jayA9IGVuZEJsb2NrSW5wdXQ7CiAgICAgIHByZXZpb3VzVXBkYXRlVGltZSA9IGN1cnJlbnRUaW1lKCk7CiAgICB9CgogICAgLy8gTUVUSE9EUwoKICAgIGZ1bmN0aW9uIHNldFZlc3RpbmdDb250cmFjdChhZGRyZXNzIHZlc3RpbmdDb250cmFjdElucHV0KSBleHRlcm5hbCBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgcmVxdWlyZSh2ZXN0aW5nQ29udHJhY3RJbnB1dCAhPSBhZGRyZXNzKDApKTsKICAgICAgICB2ZXN0aW5nQ29udHJhY3QgPSB2ZXN0aW5nQ29udHJhY3RJbnB1dDsKICAgICAgICB3aGl0ZWxpc3RbdmVzdGluZ0NvbnRyYWN0XSA9IHRydWU7CiAgICAgICAgdmVzdGluZ1NldCA9IHRydWU7CiAgICB9CgogICAgLy8gYWxsb3dzIGNvbnRyb2xXYWxsZXQgdG8gdXBkYXRlIHRoZSBwcmljZSB3aXRoaW4gYSB0aW1lIGNvbnRzdHJhaW50LCBhbGxvd3MgZnVuZFdhbGxldCBjb21wbGV0ZSBjb250cm9sCiAgICBmdW5jdGlvbiB1cGRhdGVQcmljZSh1aW50MjU2IG5ld051bWVyYXRvcikgZXh0ZXJuYWwgb25seU1hbmFnaW5nV2FsbGV0cyB7CiAgICAgICAgcmVxdWlyZShuZXdOdW1lcmF0b3IgPiAwKTsKICAgICAgICByZXF1aXJlX2xpbWl0ZWRfY2hhbmdlKG5ld051bWVyYXRvcik7CiAgICAgICAgLy8gZWl0aGVyIGNvbnRyb2xXYWxsZXQgY29tbWFuZCBpcyBjb21wbGlhbnQgb3IgdHJhbnNhY3Rpb24gY2FtZSBmcm9tIGZ1bmRXYWxsZXQKICAgICAgICBjdXJyZW50UHJpY2UubnVtZXJhdG9yID0gbmV3TnVtZXJhdG9yOwogICAgICAgIC8vIG1hcHMgdGltZSB0byBuZXcgUHJpY2UgKGlmIG5vdCBkdXJpbmcgSUNPKQogICAgICAgIHByaWNlc1twcmV2aW91c1VwZGF0ZVRpbWVdID0gY3VycmVudFByaWNlOwogICAgICAgIHByZXZpb3VzVXBkYXRlVGltZSA9IGN1cnJlbnRUaW1lKCk7CiAgICAgICAgUHJpY2VVcGRhdGUobmV3TnVtZXJhdG9yKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZXF1aXJlX2xpbWl0ZWRfY2hhbmdlICh1aW50MjU2IG5ld051bWVyYXRvcikKICAgICAgcHJpdmF0ZQogICAgICB2aWV3CiAgICAgIG9ubHlfaWZfY29udHJvbFdhbGxldAogICAgICByZXF1aXJlX3dhaXRlZAogICAgICBvbmx5X2lmX2RlY3JlYXNlKG5ld051bWVyYXRvcikKICAgIHsKICAgICAgICB1aW50MjU2IHBlcmNlbnRhZ2VfZGlmZiA9IDA7CiAgICAgICAgcGVyY2VudGFnZV9kaWZmID0gc2FmZU11bChuZXdOdW1lcmF0b3IsIDEwMCkgLyBjdXJyZW50UHJpY2UubnVtZXJhdG9yOwogICAgICAgIHBlcmNlbnRhZ2VfZGlmZiA9IHNhZmVTdWIoMTAwLCBwZXJjZW50YWdlX2RpZmYpOwogICAgICAgIC8vIGNvbnRyb2xXYWxsZXQgY2FuIG9ubHkgaW5jcmVhc2UgcHJpY2UgYnkgbWF4IDIwJSBhbmQgb25seSBldmVyeSB3YWl0VGltZQogICAgICAgIHJlcXVpcmUocGVyY2VudGFnZV9kaWZmIDw9IDIwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgcGFydGljaXBhbnQsIHVpbnQyNTYgYW1vdW50VG9rZW5zKSBwcml2YXRlIHsKICAgICAgICByZXF1aXJlKHZlc3RpbmdTZXQpOwogICAgICAgIC8vIDQwJSBvZiB0b3RhbCBhbGxvY2F0ZWQgZm9yIEZvdW5kZXJzLCBUZWFtIGluY2VudGl2ZXMgJiBCb251c2VzLgoKCS8vIFNvbGlkaXR5IHYwLjQuMTggLSBmbG9hdGluZyBwb2ludCBpcyBub3QgZnVsbHkgc3VwcG9ydGVkLAoJLy8gaW50ZWdlciBkaXZpc2lvbiByZXN1bHRzIGluIHRydW5jYXRlZCB2YWx1ZXMKCS8vIFRoZXJlZm9yZSB3ZSBhcmUgbXVsdGlwbHlpbmcgb3V0IGJ5IDEwMDAwMDAuLi4gZm9yCgkvLyBwcmVjaXNpb24uIFRoaXMgYWxsb3dzIHJhdGlvcyB2YWx1ZXMgdXAgdG8gMC4wMDAweCBvciAwLjAweCBwZXJjZW50Cgl1aW50MjU2IHByZWNpc2lvbiA9IDEwKioxODsKCXVpbnQyNTYgYWxsb2NhdGlvblJhdGlvID0gc2FmZU11bChhbW91bnRUb2tlbnMsIHByZWNpc2lvbikgLyBzYWZlTXVsKDU3MDAwMDAwMCwgcHJlY2lzaW9uKTsKICAgICAgICB1aW50MjU2IGRldmVsb3BtZW50QWxsb2NhdGlvbiA9IHNhZmVNdWwoYWxsb2NhdGlvblJhdGlvLCBzYWZlTXVsKDM4MDAwMDAwMCwgcHJlY2lzaW9uKSkgLyBwcmVjaXNpb247CiAgICAgICAgLy8gY2hlY2sgdGhhdCB0b2tlbiBjYXAgaXMgbm90IGV4Y2VlZGVkCiAgICAgICAgdWludDI1NiBuZXdUb2tlbnMgPSBzYWZlQWRkKGFtb3VudFRva2VucywgZGV2ZWxvcG1lbnRBbGxvY2F0aW9uKTsKICAgICAgICByZXF1aXJlKHNhZmVBZGQodG90YWxTdXBwbHksIG5ld1Rva2VucykgPD0gdG9rZW5DYXApOwogICAgICAgIC8vIGluY3JlYXNlIHRva2VuIHN1cHBseSwgYXNzaWduIHRva2VucyB0byBwYXJ0aWNpcGFudAogICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZUFkZCh0b3RhbFN1cHBseSwgbmV3VG9rZW5zKTsKICAgICAgICBiYWxhbmNlc1twYXJ0aWNpcGFudF0gPSBzYWZlQWRkKGJhbGFuY2VzW3BhcnRpY2lwYW50XSwgYW1vdW50VG9rZW5zKTsKICAgICAgICBiYWxhbmNlc1t2ZXN0aW5nQ29udHJhY3RdID0gc2FmZUFkZChiYWxhbmNlc1t2ZXN0aW5nQ29udHJhY3RdLCBkZXZlbG9wbWVudEFsbG9jYXRpb24pOwoKCU1pbnQoZnVuZFdhbGxldCwgbmV3VG9rZW5zKTsKCVRyYW5zZmVyKGZ1bmRXYWxsZXQsIHBhcnRpY2lwYW50LCBhbW91bnRUb2tlbnMpOwoJVHJhbnNmZXIoZnVuZFdhbGxldCwgdmVzdGluZ0NvbnRyYWN0LCBkZXZlbG9wbWVudEFsbG9jYXRpb24pOwogICAgfQoKICAgIC8vIGFtb3VudFRva2VucyBpcyBub3Qgc3VwcGxpZWQgaW4gc3VidW5pdHMuICh3aXRob3V0IDE4IDAncykKICAgIGZ1bmN0aW9uIGFsbG9jYXRlUHJlc2FsZVRva2VucygKCQkJICAgICAgIGFkZHJlc3MgcGFydGljaXBhbnRfYWRkcmVzcywKCQkJICAgICAgIHN0cmluZyBwYXJ0aWNpcGFudF9zdHIsCgkJCSAgICAgICB1aW50MjU2IGFtb3VudFRva2VucywKCQkJICAgICAgIHN0cmluZyB0eG5IYXNoCgkJCSAgICAgICApCiAgICAgIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKCiAgICAgIHJlcXVpcmUoY3VycmVudEJsb2NrKCkgPCBmdW5kaW5nRW5kQmxvY2spOwogICAgICByZXF1aXJlKHBhcnRpY2lwYW50X2FkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgCiAgICAgIHVpbnQyNTYgYm9udXNUb2tlbnMgPSAwOwogICAgICB1aW50MjU2IHRvdGFsVG9rZW5zID0gc2FmZU11bChhbW91bnRUb2tlbnMsIDEwKioxOCk7IC8vIHNjYWxlIHRvIHN1YnVuaXQKCiAgICAgIGlmIChmaXJzdERpZ2l0KHR4bkhhc2gpID09IGZpcnN0RGlnaXQocGFydGljaXBhbnRfc3RyKSkgewoJICAvLyBDYWxjdWxhdGUgMTAlIGJvbnVzCgkgIGJvbnVzVG9rZW5zID0gc2FmZU11bCh0b3RhbFRva2VucywgMTApIC8gMTAwOwoJICB0b3RhbFRva2VucyA9IHNhZmVBZGQodG90YWxUb2tlbnMsIGJvbnVzVG9rZW5zKTsKICAgICAgfQoKICAgICAgICB3aGl0ZWxpc3RbcGFydGljaXBhbnRfYWRkcmVzc10gPSB0cnVlOwogICAgICAgIG1pbnQocGFydGljaXBhbnRfYWRkcmVzcywgdG90YWxUb2tlbnMpOwoJLy8gRXZlbnRzCiAgICAgICAgV2hpdGVsaXN0KHBhcnRpY2lwYW50X2FkZHJlc3MpOwogICAgICAgIEFsbG9jYXRlUHJlc2FsZShwYXJ0aWNpcGFudF9hZGRyZXNzLCB0b3RhbFRva2Vucyk7CglCb251c0FsbG9jYXRpb24ocGFydGljaXBhbnRfYWRkcmVzcywgcGFydGljaXBhbnRfc3RyLCB0eG5IYXNoLCBib251c1Rva2Vucyk7CiAgICB9CgogICAgLy8gcmV0dXJucyB0aGUgZmlyc3QgY2hhcmFjdGVyIGFzIGEgYnl0ZSBpbiBhIGdpdmVuIGhleCBzdHJpbmcKICAgIC8vIGFkZHJlc3MgR2l2ZW4gMHgxYWJjZC4uLiByZXR1cm5zIDEKICAgIGZ1bmN0aW9uIGZpcnN0RGlnaXQoc3RyaW5nIHMpIHB1cmUgcHVibGljIHJldHVybnMoYnl0ZSl7CglieXRlcyBtZW1vcnkgc3RyQnl0ZXMgPSBieXRlcyhzKTsKCXJldHVybiBzdHJCeXRlc1syXTsKICAgICAgfQoKICAgIGZ1bmN0aW9uIHZlcmlmeVBhcnRpY2lwYW50KGFkZHJlc3MgcGFydGljaXBhbnQpIGV4dGVybmFsIG9ubHlNYW5hZ2luZ1dhbGxldHMgewogICAgICAgIHdoaXRlbGlzdFtwYXJ0aWNpcGFudF0gPSB0cnVlOwogICAgICAgIFdoaXRlbGlzdChwYXJ0aWNpcGFudCk7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5KCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgYnV5VG8obXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5VG8oYWRkcmVzcyBwYXJ0aWNpcGFudCkgcHVibGljIHBheWFibGUgb25seVdoaXRlbGlzdCB7CiAgICAgIHJlcXVpcmUoIWhhbHRlZCk7CiAgICAgIHJlcXVpcmUocGFydGljaXBhbnQgIT0gYWRkcmVzcygwKSk7CiAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IG1pbkFtb3VudCk7CiAgICAgIHJlcXVpcmUoY3VycmVudEJsb2NrKCkgPj0gZnVuZGluZ1N0YXJ0QmxvY2sgJiYgY3VycmVudEJsb2NrKCkgPCBmdW5kaW5nRW5kQmxvY2spOwogICAgICAvLyBtc2cudmFsdWUgaW4gd2VpIC0gc2NhbGUgdG8gR1JPCiAgICAgIHVpbnQyNTYgYmFzZUFtb3VudFRva2VucyA9IHNhZmVNdWwobXNnLnZhbHVlLCBjdXJyZW50UHJpY2UubnVtZXJhdG9yKTsKICAgICAgLy8gY2FsYyBsb3R0ZXJ5IGFtb3VudCBleGNsdWRpbmcgcG90ZW50aWFsIGljbyBib251cwogICAgICB1aW50MjU2IGxvdHRlcnlBbW91bnQgPSBibG9ja0xvdHRlcnkoYmFzZUFtb3VudFRva2Vucyk7CiAgICAgIHVpbnQyNTYgaWNvQW1vdW50ID0gc2FmZU11bChtc2cudmFsdWUsIGljb051bWVyYXRvclByaWNlKCkpOwoKICAgICAgdWludDI1NiB0b2tlbnNUb0J1eSA9IHNhZmVBZGQoaWNvQW1vdW50LCBsb3R0ZXJ5QW1vdW50KTsKICAgICAgbWludChwYXJ0aWNpcGFudCwgdG9rZW5zVG9CdXkpOwogICAgICAvLyBzZW5kIGV0aGVyIHRvIGZ1bmRXYWxsZXQKICAgICAgZnVuZFdhbGxldC50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgICAvLyBFdmVudHMKICAgICAgQnV5KG1zZy5zZW5kZXIsIHBhcnRpY2lwYW50LCBtc2cudmFsdWUsIHRva2Vuc1RvQnV5KTsKICAgIH0KCiAgICAvLyB0aW1lIGJhc2VkIG9uIGJsb2NrbnVtYmVycywgYXNzdW1pbmcgYSBibG9ja3RpbWUgb2YgMTVzCiAgICBmdW5jdGlvbiBpY29OdW1lcmF0b3JQcmljZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBpY29EdXJhdGlvbiA9IHNhZmVTdWIoY3VycmVudEJsb2NrKCksIGZ1bmRpbmdTdGFydEJsb2NrKTsKICAgICAgICB1aW50MjU2IG51bWVyYXRvcjsKCiAgICAgICAgdWludDI1NiBmaXJzdEJsb2NrUGhhc2UgPSA4MDY0MDsgLy8gI2Jsb2NrcyA9IDIqNyoyNCo2MCo2MC8xNSA9IDgwNjQwCiAgICAgICAgdWludDI1NiBzZWNvbmRCbG9ja1BoYXNlID0gMTYxMjgwOyAvLyAvLyAjYmxvY2tzID0gNCo3KjI0KjYwKjYwLzE1ID0gMTYxMjgwCiAgICAgICAgdWludDI1NiB0aGlyZEJsb2NrUGhhc2UgPSAyNDE5MjA7IC8vIC8vICNibG9ja3MgPSA2KjcqMjQqNjAqNjAvMTUgPSAyNDE5MjAKICAgICAgICAvL3VpbnQyNTYgZm91cnRoQmxvY2sgPSAzMjI1NjA7IC8vICNibG9ja3MgPSBHcmVhdGVyIFRoYW4gdGhpcmRCbG9jawoKICAgICAgICBpZiAoaWNvRHVyYXRpb24gPCBmaXJzdEJsb2NrUGhhc2UgKSB7CiAgICAgICAgICAgIG51bWVyYXRvciA9IDEzMDAwOwoJICAgIHJldHVybiBudW1lcmF0b3I7CiAgICAgICAgfSBlbHNlIGlmIChpY29EdXJhdGlvbiA8IHNlY29uZEJsb2NrUGhhc2UgKSB7IAogICAgICAgICAgICBudW1lcmF0b3IgPSAxMjAwMDsKCSAgICByZXR1cm4gbnVtZXJhdG9yOwogICAgICAgIH0gZWxzZSBpZiAoaWNvRHVyYXRpb24gPCB0aGlyZEJsb2NrUGhhc2UgKSB7IAogICAgICAgICAgICBudW1lcmF0b3IgPSAxMTAwMDsKCSAgICByZXR1cm4gbnVtZXJhdG9yOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG51bWVyYXRvciA9IDEwMDAwOwoJICAgIHJldHVybiBudW1lcmF0b3I7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGN1cnJlbnRCbG9jaygpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IF9jdXJyZW50QmxvY2spIHsKICAgICAgcmV0dXJuIGJsb2NrLm51bWJlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBjdXJyZW50VGltZSgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2IF9jdXJyZW50VGltZSkgewogICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIGZ1bmN0aW9uIGJsb2NrTG90dGVyeSh1aW50MjU2IF9hbW91bnRUb2tlbnMpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgIHVpbnQyNTYgZGl2aXNvciA9IDEwOwogICAgICB1aW50MjU2IHdpbm5pbmdfZGlnaXQgPSAwOwogICAgICB1aW50MjU2IHRva2VuV2lubmluZ3MgPSAwOwoKICAgICAgaWYgKGN1cnJlbnRCbG9jaygpICUgZGl2aXNvciA9PSB3aW5uaW5nX2RpZ2l0KSB7Cgl0b2tlbldpbm5pbmdzID0gc2FmZU11bChfYW1vdW50VG9rZW5zLCAxMCkgLyAxMDA7CiAgICAgIH0KICAgICAgCiAgICAgIHJldHVybiB0b2tlbldpbm5pbmdzOwkKICAgIH0KCiAgICBmdW5jdGlvbiByZXF1ZXN0V2l0aGRyYXdhbCh1aW50MjU2IGFtb3VudFRva2Vuc1RvV2l0aGRyYXcpIGV4dGVybmFsIGlzVHJhZGVhYmxlIG9ubHlXaGl0ZWxpc3QgewogICAgICByZXF1aXJlKGN1cnJlbnRCbG9jaygpID4gZnVuZGluZ0VuZEJsb2NrKTsKICAgICAgICByZXF1aXJlKGFtb3VudFRva2Vuc1RvV2l0aGRyYXcgPiAwKTsKICAgICAgICBhZGRyZXNzIHBhcnRpY2lwYW50ID0gbXNnLnNlbmRlcjsKICAgICAgICByZXF1aXJlKGJhbGFuY2VPZihwYXJ0aWNpcGFudCkgPj0gYW1vdW50VG9rZW5zVG9XaXRoZHJhdyk7CiAgICAgICAgcmVxdWlyZSh3aXRoZHJhd2Fsc1twYXJ0aWNpcGFudF0udG9rZW5zID09IDApOyAvLyBwYXJ0aWNpcGFudCBjYW5ub3QgaGF2ZSBvdXRzdGFuZGluZyB3aXRoZHJhd2FscwogICAgICAgIGJhbGFuY2VzW3BhcnRpY2lwYW50XSA9IHNhZmVTdWIoYmFsYW5jZXNbcGFydGljaXBhbnRdLCBhbW91bnRUb2tlbnNUb1dpdGhkcmF3KTsKICAgICAgICB3aXRoZHJhd2Fsc1twYXJ0aWNpcGFudF0gPSBXaXRoZHJhd2FsKHt0b2tlbnM6IGFtb3VudFRva2Vuc1RvV2l0aGRyYXcsIHRpbWU6IHByZXZpb3VzVXBkYXRlVGltZX0pOwogICAgICAgIFdpdGhkcmF3UmVxdWVzdChwYXJ0aWNpcGFudCwgYW1vdW50VG9rZW5zVG9XaXRoZHJhdyk7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSBleHRlcm5hbCB7CiAgICAgICAgYWRkcmVzcyBwYXJ0aWNpcGFudCA9IG1zZy5zZW5kZXI7CiAgICAgICAgdWludDI1NiB0b2tlbnMgPSB3aXRoZHJhd2Fsc1twYXJ0aWNpcGFudF0udG9rZW5zOwogICAgICAgIHJlcXVpcmUodG9rZW5zID4gMCk7IC8vIHBhcnRpY2lwYW50IG11c3QgaGF2ZSByZXF1ZXN0ZWQgYSB3aXRoZHJhd2FsCiAgICAgICAgdWludDI1NiByZXF1ZXN0VGltZSA9IHdpdGhkcmF3YWxzW3BhcnRpY2lwYW50XS50aW1lOwogICAgICAgIC8vIG9idGFpbiB0aGUgbmV4dCBwcmljZSB0aGF0IHdhcyBzZXQgYWZ0ZXIgdGhlIHJlcXVlc3QKICAgICAgICBQcmljZSBwcmljZSA9IHByaWNlc1tyZXF1ZXN0VGltZV07CiAgICAgICAgcmVxdWlyZShwcmljZS5udW1lcmF0b3IgPiAwKTsgLy8gcHJpY2UgbXVzdCBoYXZlIGJlZW4gc2V0CiAgICAgICAgdWludDI1NiB3aXRoZHJhd1ZhbHVlID0gdG9rZW5zIC8gcHJpY2UubnVtZXJhdG9yOwogICAgICAgIC8vIGlmIGNvbnRyYWN0IGV0aGJhbCA+IHRoZW4gc2VuZCArIHRyYW5zZmVyIHRva2VucyB0byBmdW5kV2FsbGV0LCBvdGhlcndpc2UgZ2l2ZSB0b2tlbnMgYmFjawogICAgICAgIHdpdGhkcmF3YWxzW3BhcnRpY2lwYW50XS50b2tlbnMgPSAwOwogICAgICAgIGlmICh0aGlzLmJhbGFuY2UgPj0gd2l0aGRyYXdWYWx1ZSkgewogICAgICAgICAgICBlbmFjdF93aXRoZHJhd2FsX2dyZWF0ZXJfZXF1YWwocGFydGljaXBhbnQsIHdpdGhkcmF3VmFsdWUsIHRva2Vucyk7Cgl9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGVuYWN0X3dpdGhkcmF3YWxfbGVzcyhwYXJ0aWNpcGFudCwgd2l0aGRyYXdWYWx1ZSwgdG9rZW5zKTsKCX0KICAgIH0KCiAgICBmdW5jdGlvbiBlbmFjdF93aXRoZHJhd2FsX2dyZWF0ZXJfZXF1YWwoYWRkcmVzcyBwYXJ0aWNpcGFudCwgdWludDI1NiB3aXRoZHJhd1ZhbHVlLCB1aW50MjU2IHRva2VucykKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgYXNzZXJ0KHRoaXMuYmFsYW5jZSA+PSB3aXRoZHJhd1ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tmdW5kV2FsbGV0XSA9IHNhZmVBZGQoYmFsYW5jZXNbZnVuZFdhbGxldF0sIHRva2Vucyk7CiAgICAgICAgcGFydGljaXBhbnQudHJhbnNmZXIod2l0aGRyYXdWYWx1ZSk7CiAgICAgICAgV2l0aGRyYXcocGFydGljaXBhbnQsIHRva2Vucywgd2l0aGRyYXdWYWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBlbmFjdF93aXRoZHJhd2FsX2xlc3MoYWRkcmVzcyBwYXJ0aWNpcGFudCwgdWludDI1NiB3aXRoZHJhd1ZhbHVlLCB1aW50MjU2IHRva2VucykKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgYXNzZXJ0KHRoaXMuYmFsYW5jZSA8IHdpdGhkcmF3VmFsdWUpOwogICAgICAgIGJhbGFuY2VzW3BhcnRpY2lwYW50XSA9IHNhZmVBZGQoYmFsYW5jZXNbcGFydGljaXBhbnRdLCB0b2tlbnMpOwogICAgICAgIFdpdGhkcmF3KHBhcnRpY2lwYW50LCB0b2tlbnMsIDApOyAvLyBpbmRpY2F0ZSBhIGZhaWxlZCB3aXRoZHJhd2FsCiAgICB9CgoKICAgIGZ1bmN0aW9uIGNoZWNrV2l0aGRyYXdWYWx1ZSh1aW50MjU2IGFtb3VudFRva2Vuc1RvV2l0aGRyYXcpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGV0aGVyVmFsdWUpIHsKICAgICAgICByZXF1aXJlKGFtb3VudFRva2Vuc1RvV2l0aGRyYXcgPiAwKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VPZihtc2cuc2VuZGVyKSA+PSBhbW91bnRUb2tlbnNUb1dpdGhkcmF3KTsKICAgICAgICB1aW50MjU2IHdpdGhkcmF3VmFsdWUgPSBzYWZlTXVsKGFtb3VudFRva2Vuc1RvV2l0aGRyYXcsIGN1cnJlbnRQcmljZS5udW1lcmF0b3IpOwogICAgICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IHdpdGhkcmF3VmFsdWUpOwogICAgICAgIHJldHVybiB3aXRoZHJhd1ZhbHVlOwogICAgfQoKICAgIC8vIGFsbG93IGZ1bmRXYWxsZXQgb3IgY29udHJvbFdhbGxldCB0byBhZGQgZXRoZXIgdG8gY29udHJhY3QKICAgIGZ1bmN0aW9uIGFkZExpcXVpZGl0eSgpIGV4dGVybmFsIG9ubHlNYW5hZ2luZ1dhbGxldHMgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgICAgICBBZGRMaXF1aWRpdHkobXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLyBhbGxvdyBmdW5kV2FsbGV0IHRvIHJlbW92ZSBldGhlciBmcm9tIGNvbnRyYWN0CiAgICBmdW5jdGlvbiByZW1vdmVMaXF1aWRpdHkodWludDI1NiBhbW91bnQpIGV4dGVybmFsIG9ubHlNYW5hZ2luZ1dhbGxldHMgewogICAgICAgIHJlcXVpcmUoYW1vdW50IDw9IHRoaXMuYmFsYW5jZSk7CiAgICAgICAgZnVuZFdhbGxldC50cmFuc2ZlcihhbW91bnQpOwogICAgICAgIFJlbW92ZUxpcXVpZGl0eShhbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZUZ1bmRXYWxsZXQoYWRkcmVzcyBuZXdGdW5kV2FsbGV0KSBleHRlcm5hbCBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgcmVxdWlyZShuZXdGdW5kV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGZ1bmRXYWxsZXQgPSBuZXdGdW5kV2FsbGV0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xXYWxsZXQoYWRkcmVzcyBuZXdDb250cm9sV2FsbGV0KSBleHRlcm5hbCBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgcmVxdWlyZShuZXdDb250cm9sV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGNvbnRyb2xXYWxsZXQgPSBuZXdDb250cm9sV2FsbGV0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVdhaXRUaW1lKHVpbnQyNTYgbmV3V2FpdFRpbWUpIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgICB3YWl0VGltZSA9IG5ld1dhaXRUaW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUZ1bmRpbmdTdGFydEJsb2NrKHVpbnQyNTYgbmV3RnVuZGluZ1N0YXJ0QmxvY2spIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgcmVxdWlyZShjdXJyZW50QmxvY2soKSA8IGZ1bmRpbmdTdGFydEJsb2NrKTsKICAgICAgICByZXF1aXJlKGN1cnJlbnRCbG9jaygpIDwgbmV3RnVuZGluZ1N0YXJ0QmxvY2spOwogICAgICAgIGZ1bmRpbmdTdGFydEJsb2NrID0gbmV3RnVuZGluZ1N0YXJ0QmxvY2s7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlRnVuZGluZ0VuZEJsb2NrKHVpbnQyNTYgbmV3RnVuZGluZ0VuZEJsb2NrKSBleHRlcm5hbCBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgcmVxdWlyZShjdXJyZW50QmxvY2soKSA8IGZ1bmRpbmdFbmRCbG9jayk7CiAgICAgICAgcmVxdWlyZShjdXJyZW50QmxvY2soKSA8IG5ld0Z1bmRpbmdFbmRCbG9jayk7CiAgICAgICAgZnVuZGluZ0VuZEJsb2NrID0gbmV3RnVuZGluZ0VuZEJsb2NrOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5RnVuZFdhbGxldCB7CiAgICAgICAgaGFsdGVkID0gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgICBoYWx0ZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmFibGVUcmFkaW5nKCkgZXh0ZXJuYWwgb25seUZ1bmRXYWxsZXQgewogICAgICAgIHJlcXVpcmUoY3VycmVudEJsb2NrKCkgPiBmdW5kaW5nRW5kQmxvY2spOwogICAgICAgIHRyYWRlYWJsZSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIGV4dGVybmFsIG9ubHlGdW5kV2FsbGV0IHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICBUb2tlbiB0b2tlbiA9IFRva2VuKF90b2tlbik7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKGZ1bmRXYWxsZXQsIGJhbGFuY2UpOwogICAgIH0KCiAgICAvLyBwcmV2ZW50IHRyYW5zZmVycyB1bnRpbCB0cmFkaW5nIGFsbG93ZWQKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIGlzVHJhZGVhYmxlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgaXNUcmFkZWFibGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQp9'.
	

]
