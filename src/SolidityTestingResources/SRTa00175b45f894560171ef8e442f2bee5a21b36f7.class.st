Class {
	#name : #SRTa00175b45f894560171ef8e442f2bee5a21b36f7,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa00175b45f894560171ef8e442f2bee5a21b36f7 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyA9PT09IERJU0NMQUlNRVIgPT09PQovLwovLyBFVEhFUkVVTSBJUyBTVElMTCBBTiBFWFBFUkVNRU5UQUwgVEVDSE5PTE9HWS4KLy8gQUxUSE9VR0ggVEhJUyBTTUFSVCBDT05UUkFDVCBXQVMgQ1JFQVRFRCBXSVRIIEdSRUFUIENBUkUgQU5EIElOIFRIRSBIT1BFIE9GIEJFSU5HIFVTRUZVTCwgTk8gR1VBUkFOVEVFUyBPRiBGTEFXTEVTUyBPUEVSQVRJT04gQ0FOIEJFIEdJVkVOLgovLyBJTiBQQVJUSUNVTEFSIC0gU1VCVElMRSBCVUdTLCBIQUNLRVIgQVRUQUNLUyBPUiBNQUxGVU5DVElPTiBPRiBVTkRFUkxZSU5HIFRFQ0hOT0xPR1kgQ0FOIENBVVNFIFVOSU5URU5USU9OQUwgQkVIQVZJT1VSLgovLyBZT1UgQVJFIFNUUk9OR0xZIEVOQ09VUkFHRUQgVE8gU1RVRFkgVEhJUyBTTUFSVCBDT05UUkFDVCBDQVJFRlVMTFkgSU4gT1JERVIgVE8gVU5ERVJTVEFORCBQT1NTSUJMRSBFREdFIENBU0VTIEFORCBSSVNLUy4KLy8gRE9OJ1QgVVNFIFRISVMgU01BUlQgQ09OVFJBQ1QgSUYgWU9VIEhBVkUgU1VCU1RBTlRJQUwgRE9VQlRTIE9SIElGIFlPVSBET04nVCBLTk9XIFdIQVQgWU9VIEFSRSBET0lORy4KLy8KLy8gVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQovLyBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsCi8vIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsCi8vIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLAovLyBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgovLyA9PT09Ci8vCgovLy8gQGF1dGhvciBTYW50aW1lbnQgTExDCi8vLyBAdGl0bGUgIFN1YnNjcmlwdGlvbiBNb2R1bGUgZm9yIFNBTiAtIHNhbnRpbWVudCB0b2tlbgoKY29udHJhY3QgQmFzZSB7CgogICAgZnVuY3Rpb24gbWF4KHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7IHJldHVybiBhID49IGIgPyBhIDogYjsgfQogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7IHJldHVybiBhIDw9IGIgPyBhIDogYjsgfQoKICAgIG1vZGlmaWVyIG9ubHkoYWRkcmVzcyBhbGxvd2VkKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWxsb3dlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCgogICAgLy8vQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gKHNpemUgPiAwKTsKICAgIH0KCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgIHJlZW50cmFuY3kgaGFuZGxpbmcgICAgICAgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy9AZGV2IHByZWRlZmluZWQgbG9ja3MgKHVwIHRvIHVpbnQgYml0IGxlbmd0aCwgaS5lLiAyNTYgcG9zc2libGUpCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMCA9IDIgKiogMDsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAxID0gMiAqKiAxOwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDIgPSAyICoqIDI7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMyA9IDIgKiogMzsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDA0ID0gMiAqKiA0OwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDUgPSAyICoqIDU7CgogICAgLy9wcmV2ZW50cyByZWVudHJhbmN5IGF0dGFjczogc3BlY2lmaWMgbG9ja3MKICAgIHVpbnQgcHJpdmF0ZSBiaXRsb2NrcyA9IDA7CiAgICBtb2RpZmllciBub1JlZW50cmFuY3kodWludCBtKSB7CiAgICAgICAgdmFyIF9sb2NrcyA9IGJpdGxvY2tzOwogICAgICAgIGlmIChfbG9ja3MgJiBtID4gMCkgdGhyb3c7CiAgICAgICAgYml0bG9ja3MgfD0gbTsKICAgICAgICBfOwogICAgICAgIGJpdGxvY2tzID0gX2xvY2tzOwogICAgfQoKICAgIG1vZGlmaWVyIG5vQW55UmVlbnRyYW5jeSB7CiAgICAgICAgdmFyIF9sb2NrcyA9IGJpdGxvY2tzOwogICAgICAgIGlmIChfbG9ja3MgPiAwKSB0aHJvdzsKICAgICAgICBiaXRsb2NrcyA9IHVpbnQoLTEpOwogICAgICAgIF87CiAgICAgICAgYml0bG9ja3MgPSBfbG9ja3M7CiAgICB9CgogICAgLy8vQGRldiBlbXB0eSBtYXJraW5nIG1vZGlmaWVyIHNpZ25hbGluZyB0byB1c2VyIG9mIHRoZSBtYXJrZWQgZnVuY3Rpb24gLCB0aGF0IGl0IGNhbiBjYXVzZSBhbiByZWVudHJhbnQgY2FsbC4KICAgIC8vLyAgICAgZGV2ZWxvcGVyIHNob3VsZCBtYWtlIHRoZSBjYWxsZXIgZnVuY3Rpb24gcmVlbnRyYW50LXNhZmUgaWYgaXQgdXNlIGEgcmVlbnRyYW50IGZ1bmN0aW9uLgogICAgbW9kaWZpZXIgcmVlbnRyYW50IHsgXzsgfQoKfQoKY29udHJhY3QgT3duZWQgaXMgQmFzZSB7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHkob3duZXIpIHsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBvbmx5KG5ld093bmVyKSB7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90byk7Cgp9CgoKY29udHJhY3QgRVJDMjAgaXMgT3duZWQgewoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0KICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgewogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0KICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBib29sICAgIHB1YmxpYyBpc1N0YXJ0ZWQgPSBmYWxzZTsKCiAgICBtb2RpZmllciBvbmx5SG9sZGVyKGFkZHJlc3MgaG9sZGVyKSB7CiAgICAgICAgaWYgKGJhbGFuY2VPZihob2xkZXIpID09IDApIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNTdGFydGVkT25seSgpIHsKICAgICAgICBpZiAoIWlzU3RhcnRlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCn0KCi8vRGVjaXNpb24gbWFkZS4KLy8gMSAtIFByb3ZpZGVyIGlzIHNvbGVseSByZXNwb25zaWJsZSB0byBjb25zaWRlciBmYWlsZWQgc3ViIGNoYXJnZSBhcyBhbiBlcnJvciBhbmQgc3RvcCB0aGUgc2VydmljZSwKLy8gICAgdGhlcmVmb3JlIHRoZXJlIGlzIG5vIHNlcGFyYXRlIGVycm9yIHN0YXRlIG9yIGNvdW50ZXIgZm9yIHRoYXQgaW4gdGhpcyBUb2tlbiBDb250cmFjdC4KLy8KLy8gMiAtIEEgY2FsbCBvcmlnaW5hdGVkIGZyb20gdGhlIHVzZXIgKGlzQ29udHJhY3QobXNnLnNlbmRlcik9PWZhbHNlKSBzaG91bGQgdGhyb3cgYW4gZXhjZXB0aW9uIG9uIGVycm9yLAovLyAgICAgYnV0IGl0IHNob3VsZCByZXR1cm4gImZhbHNlIiBvbiBlcnJvciBpZiBjYWxsZWQgZnJvbSBvdGhlciBjb250cmFjdCAoaXNDb250cmFjdChtc2cuc2VuZGVyKT09dHJ1ZSkuCi8vICAgICBSZWFzb246IHRocm93biBleGNlcHRpb24gYXJlIGVhc2llciB0byBzZWUgaW4gd2FsbGV0cywgcmV0dXJuZWQgYm9vbGVhbiB2YWx1ZXMgYXJlIGVhc2llciB0byBldmFsdWF0ZSBpbiB0aGUgY29kZSBvZiB0aGUgY2FsbGluZyBjb250cmFjdC4KLy8KLy8gMyAtIFNlcnZpY2UgcHJvdmlkZXJzIGFyZSByZXNwb25zaWJsZSBmb3IgZmlyaW5nIGV2ZW50cyBpbiBjYXNlIG9mIG9mZmVyIGNoYW5nZXM7Ci8vICAgICBpdCBpcyB0aGVpcnMgZGVjaXNpb24gdG8gaW5mb3JtIERBcHBzIGFib3V0IG9mZmVyIGNoYW5nZXMgb3Igbm90LgovLwoKCi8vL0BkZXYgYW4gYmFzZSBjbGFzcyB0byBpbXBsZW1lbnQgYnkgU2VydmljZSBQcm92aWRlciBjb250cmFjdCB0byBiZSBub3RpZmllZCBhYm91dCBzdWJzY3JpcHRpb24gY2hhbmdlcyAoaW4tVHggbm90aWZpY2F0aW9uKS4KLy8vICAgICBBZGRpdGlvbmFsbHkgaXQgY29udGFpbnMgc3RhbmRhcmQgZXZlbnRzIHRvIGJlIGZpcmVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgb24gb2ZmZXIgY2hhbmdlcy4KLy8vICAgICBzZWUgYWxzZSBFVk0gZXZlbnRzIGxvZ2dlZCBieSBzdWJzY3JpcHRpb24gbW9kdWxlLgovLwpjb250cmFjdCBTZXJ2aWNlUHJvdmlkZXIgewoKICAgIC8vL0BkZXYgZ2V0IGh1bWFuIHJlYWRhYmxlIGRlc2NyaXB0b3IgKG9yIHVybCkgZm9yIHRoaXMgU2VydmljZSBwcm92aWRlcgogICAgLy8KICAgIGZ1bmN0aW9uIGluZm8oKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhzdHJpbmcpOwoKICAgIC8vL0BkZXYgY2FsbGVkIHRvIHBvc3QtYXBwcm92ZS9yZWplY3QgaW5jb21pbmcgc2luZ2xlIHBheW1lbnQuCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgcGF5bWVudC4KICAgIC8vCiAgICBmdW5jdGlvbiBvblBheW1lbnQoYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKICAgIC8vL0BkZXYgY2FsbGVkIHRvIHBvc3QtYXBwcm92ZS9yZWplY3Qgc3Vic2NyaXB0aW9uIGNoYXJnZS4KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBvcGVyYXRpb24uCiAgICAvLwogICAgZnVuY3Rpb24gb25TdWJFeGVjdXRlZCh1aW50IHN1YklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vQGRldiBjYWxsZWQgdG8gcG9zdC1hcHByb3ZlL3JlamVjdCBhIGNyZWF0aW9uIG9mIHRoZSBzdWJzY3JpcHRpb24uCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgb3BlcmF0aW9uLgogICAgLy8KICAgIGZ1bmN0aW9uIG9uU3ViTmV3KHVpbnQgbmV3U3ViSWQsIHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKICAgIC8vL0BkZXYgY2FsbGVkIHRvIG5vdGlmeSBzZXJ2aWNlIHByb3ZpZGVyIGFib3V0IHN1YnNjcmlwdGlvbiBjYW5jZWxsYXRpb24uCiAgICAvLy8gICAgIFByb3ZpZGVyIGlzIG5vdCBhYmxlIHRvIHByZXZlbnQgdGhlIGNhbmNlbGxhdGlvbi4KICAgIC8vL0ByZXR1cm4gPDxyZXNlcnZlZCBmb3IgZnV0dXJlIGltcGxlbWVudGF0aW9uPj4KICAgIC8vCiAgICBmdW5jdGlvbiBvblN1YkNhbmNlbGVkKHVpbnQgc3ViSWQsIGFkZHJlc3MgY2FsbGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vQGRldiBjYWxsZWQgdG8gbm90aWZ5IHNlcnZpY2UgcHJvdmlkZXIgYWJvdXQgc3Vic2NyaXB0aW9uIGdvdCBob2xkL3VuaG9sZC4KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBvcGVyYXRpb24uCiAgICAvLwogICAgZnVuY3Rpb24gb25TdWJVbkhvbGQodWludCBzdWJJZCwgYWRkcmVzcyBjYWxsZXIsIGJvb2wgaXNPbkhvbGQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCgogICAgLy8vQGRldiBmb2xsb3dpbmcgZXZlbnRzIHNob3VsZCBiZSB1c2VkIGJ5IFNlcnZpY2VQcm92aWRlciBjb250cmFjdCB0byBub3RpZnkgREFwcHMgYWJvdXQgb2ZmZXIgY2hhbmdlcy4KICAgIC8vLyAgICAgU3Vic2NyaXB0aW9uTW9kdWxlIGRvIG5vdCB0aGlzIG5vdGlmaWNhdGlvbiBhbmQgZXhwZWN0cyBpdCBmcm9tIFNlcnZpY2UgUHJvdmlkZXIgaWYgZGVzaXJlZC4KICAgIC8vLwogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gbmV3IE9mZmVyIGNyZWF0ZWQgaW4gYSBwbGF0Zm9ybS4KICAgIGV2ZW50IE9mZmVyQ3JlYXRlZCh1aW50IG9mZmVySWQsICBieXRlcyBkZXNjcmlwdG9yLCBhZGRyZXNzIHByb3ZpZGVyKTsKCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBPZmZlciB1cGRhdGVkLgogICAgZXZlbnQgT2ZmZXJVcGRhdGVkKHVpbnQgb2ZmZXJJZCwgIGJ5dGVzIGRlc2NyaXB0b3IsIHVpbnQgb2xkRXhlY0NvdW50ZXIsIGFkZHJlc3MgcHJvdmlkZXIpOwoKICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIE9mZmVyIGNhbmNlbGVkLgogICAgZXZlbnQgT2ZmZXJDYW5jZWxlZCh1aW50IG9mZmVySWQsIGJ5dGVzIGRlc2NyaXB0b3IsIGFkZHJlc3MgcHJvdmlkZXIpOwoKICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIE9mZmVyIGhvbGQvdW5ob2xkIHN0YXR1cyBjaGFuZ2VkLgogICAgZXZlbnQgT2ZmZXJVbkhvbGQodWludCBvZmZlcklkLCAgIGJ5dGVzIGRlc2NyaXB0b3IsIGJvb2wgaXNPbkhvbGROb3csIGFkZHJlc3MgcHJvdmlkZXIpOwp9IC8vU2VydmljZVByb3ZpZGVyCgovLy9Abm90aWNlIFhSYXRlUHJvdmlkZXIgaXMgYW4gZXh0ZXJuYWwgc2VydmljZSBwcm92aWRpbmcgYW4gZXhjaGFuZ2UgcmF0ZSBmcm9tIGV4dGVybmFsIGN1cnJlbmN5IHRvIFNBTiB0b2tlbi4KLy8vIGl0IHVzZWQgZm9yIHN1YnNjcmlwdGlvbnMgcHJpY2VkIGluIG90aGVyIGN1cnJlbmN5IHRoYW4gU0FOIChldmVuIGNhbGN1bGF0ZWQgYW5kIHBhaWQgZm9ybWFsbHkgaW4gU0FOKS4KLy8vIGlmIG5vbi1kZWZhdWx0IFhSYXRlUHJvdmlkZXIgaXMgc2V0IGZvciBzb21lIHN1YnNjcmlwdGlvbiwgdGhlbiB0aGUgYW1vdW50IGluIFNBTiBmb3IgZXZlcnkgcGVyaW9kaWMgcGF5bWVudAovLy8gd2lsbCBiZSByZWNhbGN1bGF0ZWQgdXNpbmcgcHJvdmlkZWQgZXhjaGFuZ2UgcmF0ZS4KLy8vCi8vLyBQbGVhc2Ugbm90ZSwgdGhhdCB0aGUgZXhjaGFuZ2UgcmF0ZSBmcmFjdGlvbiBpcyAodWludDMyLHVpbnQzMikgbnVtYmVyLiBJdCBzaG91bGQgYmUgZW5vdWdoIHRvIGV4cHJlc3MKLy8vIGFueSByZWFsIGV4Y2hhbmdlIHJhdGUgdm9sYXRpbGl0eS4gTmV2ZXJ0aGVsZXNzIHlvdSBhcmUgYWR2aXNlZCB0byBhdm9pZCB0b28gYmlnIG51bWJlcnMgaW4gdGhlIGZyYWN0aW9uLgovLy8gUG9zc2lpYmx5IHlvdSBjb3VsZCBpbXBsZW1lbnQgdGhlIHJhdGlvIG9mIG11bHRpcGxlIHRva2VuIHBlciBTQU4gaW4gb3JkZXIgdG8ga2VlcCB0aGUgYXZlcmFnZSByYXRpbyBhcm91bmQgMToxLgovLy8KLy8vIFRoZSBkZWZhdWx0IFhSYXRlUHJvdmlkZXIgKHdpdGggaWQ9PTApIGRlZmluZXMgZXhjaGFuZ2UgcmF0ZSAxOjEgYW5kIHJlcHJlc2VudHMgZXhjaGFuZ2UgcmF0ZSBvZiBTQU4gdG9rZW4gdG8gaXRzZWxmLgovLy8gdGhpcyBwcm92aWRlciBpcyBzZXQgYnkgZGVmYWx1bHQgYW5kIHRodXMgdGhlIHN1YnNjcmlwdGlvbiBiZWNvbWVzIG5vbWluYXRlZCBpbiBTQU4uCi8vCmNvbnRyYWN0IFhSYXRlUHJvdmlkZXIgewoKICAgIC8vQGRldiByZXR1cm5zIGN1cnJlbnQgZXhjaGFuZ2UgcmF0ZSAoaW4gZm9ybSBvZiBhIHNpbXBsZSBmcmFjdGlvbikgZnJvbSBvdGhlciBjdXJyZW5jeSB0byBTQU4gKGYuZS4gRVRIOlNBTikuCiAgICAvL0BkZXYgZnJhY3Rpb24gbnVtYmVycyBhcmUgcmVzdHJpY3RlZCB0byB1aW50MTYgdG8gcHJldmVudCBvdmVyZmxvdyBpbiBjYWxjdWxhdGlvbnM7CiAgICBmdW5jdGlvbiBnZXRSYXRlKCkgcHVibGljIHJldHVybnMgKHVpbnQzMiAvKm5vbWluYXRvciovLCB1aW50MzIgLypkZW5vbWluYXRvciovKTsKCiAgICAvL0BkZXYgcHJvdmlkZXMgYSBjb2RlIGZvciBhbm90aGVyIGN1cnJlbmN5LCBmLmUuICJFVEgiIG9yICJVU0QiCiAgICBmdW5jdGlvbiBnZXRDb2RlKCkgcHVibGljIHJldHVybnMgKHN0cmluZyk7Cn0KCgovL0BkZXYgZGF0YSBzdHJ1Y3R1cmUgZm9yIFN1YnNjcmlwdGlvbk1vZHVsZQpjb250cmFjdCBTdWJzY3JpcHRpb25CYXNlIHsKCiAgICBlbnVtIFN1YlN0YXRlICAge05PVF9FWElTVCwgQkVGT1JFX1NUQVJULCBQQUlELCBDSEFSR0VBQkxFLCBPTl9IT0xELCBDQU5DRUxFRCwgRVhQSVJFRCwgRklOQUxJWkVEfQogICAgZW51bSBPZmZlclN0YXRlIHtOT1RfRVhJU1QsIEJFRk9SRV9TVEFSVCwgQUNUSVZFLCBTT0xEX09VVCwgT05fSE9MRCwgRVhQSVJFRH0KCiAgICBzdHJpbmdbXSBpbnRlcm5hbCBTVUJfU1RBVEVTICAgPSBbIk5PVF9FWElTVCIsICJCRUZPUkVfU1RBUlQiLCAiUEFJRCIsICJDSEFSR0VBQkxFIiwgIk9OX0hPTEQiLCAiQ0FOQ0VMRUQiLCAiRVhQSVJFRCIsICJGSU5BTElaRUQiIF07CiAgICBzdHJpbmdbXSBpbnRlcm5hbCBPRkZFUl9TVEFURVMgPSBbIk5PVF9FWElTVCIsICJCRUZPUkVfU1RBUlQiLCAiQUNUSVZFIiwgIlNPTERfT1VUIiwgIk9OX0hPTEQiLCAiRVhQSVJFRCJdOwoKICAgIC8vQGRldiBzdWJzY3JpcHRpb24gYW5kIHN1YnNjcmlwdGlvbiBvZmZlciB1c2UgdGhlIHNhbWUgc3RydWN0dXJlLiBPZmZlciBpcyB0ZWNobmljYWxseSBhIHRlbXBsYXRlIGZvciBzdWJzY3JpcHRpb24uCiAgICBzdHJ1Y3QgU3Vic2NyaXB0aW9uIHsKICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbTsgICAvLyBjdXN0b21lciAodW5zZXQgaW4gc3Vic2NyaXB0aW9uIG9mZmVyKQogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJUbzsgICAgIC8vIHNlcnZpY2UgcHJvdmlkZXIKICAgICAgICB1aW50IHByaWNlUGVySG91cjsgICAgICAvLyBwcmljZSBpbiBTQU4gcGVyIGhvdXIgKHBvc3NpYmx5IHJlY2FsY3VsYXRlZCB1c2luZyBleGNoYW5nZSByYXRlKQogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfbjsgIC8vIG5vbWluYXRvcgogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfZDsgIC8vIGRlbm9taW5hdG9yCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZDsgLy8gaWQgb2YgYSByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIKICAgICAgICB1aW50IHBhaWRVbnRpbDsgICAgICAgICAvLyBzdWJzY3JpcHRpb24gaXMgcGFpZCB1bnRpbCB0aW1lCiAgICAgICAgdWludCBjaGFyZ2VQZXJpb2Q7ICAgICAgLy8gc3Vic2NyaXB0aW9uIGNhbid0IGJlIGNoYXJnZWQgbW9yZSBvZnRlbiB0aGFuIHRoaXMgcGVyaW9kCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50OyAgICAgLy8gdXBmcm9udCBkZXBvc2l0IG9uIGNyZWF0aW5nIHN1YnNjcmlwdGlvbiAocG9zc2libHkgcmVjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUpCgogICAgICAgIHVpbnQgc3RhcnRPbjsgICAgICAgICAgIC8vIGZvciBvZmZlcjogY2FuJ3QgYmUgYWNjZXB0ZWQgYmVmb3JlICA8c3RhcnRPbj4gOyBmb3Igc3Vic2NyaXB0aW9uOiBjYW4ndCBiZSBjaGFyZ2VkIGJlZm9yZSA8c3RhcnRPbj4KICAgICAgICB1aW50IGV4cGlyZU9uOyAgICAgICAgICAvLyBmb3Igb2ZmZXI6IGNhbid0IGJlIGFjY2VwdGVkIGFmdGVyICA8ZXhwaXJlT24+IDsgZm9yIHN1YnNjcmlwdGlvbjogY2FuJ3QgYmUgY2hhcmdlZCBhZnRlciAgPGV4cGlyZU9uPgogICAgICAgIHVpbnQgZXhlY0NvdW50ZXI7ICAgICAgIC8vIGZvciBvZmZlcjogbWF4IG51bSBvZiBzdWJzY3JpcHRpb25zIGF2YWlsYWJsZSAgOyBmb3Igc3Vic2NyaXB0aW9uOiBudW0gb2YgY2hhcmdlcyBtYWRlLgogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3I7ICAgICAgIC8vIHN1YnNjcmlwdGlvbiBwYXlsb2FkIChzdWJqZWN0KTogZXZhbHVhdGVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIuCiAgICAgICAgdWludCBvbkhvbGRTaW5jZTsgICAgICAgLy8gc3Vic2NyaXB0aW9uOiBvbi1ob2xkIHNpbmNlIHRpbWUgb3IgMCBpZiBub3Qgb25Ib2xkLiBvZmZlcjogdW51c2VkOiAvL1RvRG86IHRvIGJlIGltcGxlbWVudGVkCiAgICB9CgogICAgc3RydWN0IERlcG9zaXQgewogICAgICAgIHVpbnQgdmFsdWU7ICAgICAgICAgLy8gdmFsdWUgb24gZGVwb3NpdAogICAgICAgIGFkZHJlc3Mgb3duZXI7ICAgICAgLy8gdXN1YWxseSBhIGN1c3RvbWVyCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcjsgICAvLyBzZXJ2aWNlIHJlbGF0ZWQgZGVzY3JpcHRvciB0byBiZSBldmFsdWF0ZWQgYnkgc2VydmljZSBwcm92aWRlcgogICAgfQoKICAgIGV2ZW50IE5ld1N1YnNjcmlwdGlvbihhZGRyZXNzIGN1c3RvbWVyLCBhZGRyZXNzIHNlcnZpY2UsIHVpbnQgb2ZmZXJJZCwgdWludCBzdWJJZCk7CiAgICBldmVudCBOZXdEZXBvc2l0KHVpbnQgZGVwb3NpdElkLCB1aW50IHZhbHVlLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBOZXdYUmF0ZVByb3ZpZGVyKGFkZHJlc3MgYWRkciwgdWludDE2IHhSYXRlUHJvdmlkZXJJZCwgYWRkcmVzcyBzZW5kZXIpOwogICAgZXZlbnQgRGVwb3NpdFJldHVybmVkKHVpbnQgZGVwb3NpdElkLCBhZGRyZXNzIHJldHVybmVkVG8pOwogICAgZXZlbnQgU3Vic2NyaXB0aW9uRGVwb3NpdFJldHVybmVkKHVpbnQgc3ViSWQsIHVpbnQgYW1vdW50LCBhZGRyZXNzIHJldHVybmVkVG8sIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IE9mZmVyT25Ib2xkKHVpbnQgb2ZmZXJJZCwgYm9vbCBvbkhvbGQsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IE9mZmVyQ2FuY2VsZWQodWludCBvZmZlcklkLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBTdWJPbkhvbGQodWludCBvZmZlcklkLCBib29sIG9uSG9sZCwgYWRkcmVzcyBzZW5kZXIpOwogICAgZXZlbnQgU3ViQ2FuY2VsZWQodWludCBzdWJJZCwgYWRkcmVzcyBzZW5kZXIpOwoKfQoKLy8vQGRldiBhbiBJbnRlcmZhY2UgZm9yIFN1YnNjcmlwdGlvbk1vZHVsZS4KLy8vICAgICBleHRyYWN0ZWQgaGVyZSBmb3IgYmV0dGVyIG92ZXJ2aWV3LgovLy8gICAgIHNlZSBkZXRhaWxlZCBkb2N1bWVudGF0aW9uIGluIGltcGxlbWVudGF0aW9uIG1vZHVsZS4KY29udHJhY3QgU3Vic2NyaXB0aW9uTW9kdWxlIGlzIFN1YnNjcmlwdGlvbkJhc2UsIEJhc2UgewoKICAgIC8vL0BkZXYgKioqKiogbW9kdWxlIGNvbmZpZ3VyYXRpb24gKioqKioKICAgIGZ1bmN0aW9uIGF0dGFjaFRva2VuKGFkZHJlc3MgdG9rZW4pIHB1YmxpYzsKCiAgICAvLy9AZGV2ICoqKioqIHNpbmdsZSBwYXltZW50IGhhbmRsaW5nICoqKioqCiAgICBmdW5jdGlvbiBwYXltZW50VG8odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gcGF5bWVudEZyb20odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgYWRkcmVzcyBfZnJvbSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vL0BkZXYgKioqKiogc3Vic2NyaXB0aW9uIGhhbmRsaW5nICoqKioqCiAgICAvLy9AZGV2IHNvbWUgZnVuY3Rpb25zIGFyZSBtYXJrZWQgYXMgcmVlbnRyYW50LCBldmVuIHRoZWlycyBpbXBsZW1lbnRhdGlvbiBpcyBtYXJrZWQgd2l0aCBub1JlZW50cmFuY3koTE9DSykuCiAgICAvLy8gICAgIFRoaXMgaXMgaW50ZW50aW9uYWxseSBiZWNhdXNlIHRoZXNlIG5vUmVlbnRyYW5jeShMT0NLKSByZXN0cmljdGlvbnMgY2FuIGJlIGxpZnRlZCBpbiB0aGUgZnV0dXJlLgogICAgLy8gICAgICBGdW5jdGlvbnMgd291bGQgYmVjb21lIHJlZW50cmFudC4KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbih1aW50IF9vZmZlcklkLCB1aW50IF9leHBpcmVPbiwgdWludCBfc3RhcnRPbikgcHVibGljIHJlZW50cmFudCByZXR1cm5zICh1aW50IG5ld1N1YklkKTsKICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSByZWVudHJhbnQgcHVibGljOwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSkgcmVlbnRyYW50IHB1YmxpYzsKICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdW5ob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGV4ZWN1dGVTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gcG9zdHBvbmVEdWVEYXRlKHVpbnQgc3ViSWQsIHVpbnQgbmV3RHVlRGF0ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBjbGFpbVN1YnNjcmlwdGlvbkRlcG9zaXQodWludCBzdWJJZCkgcHVibGljOwogICAgZnVuY3Rpb24gc3RhdGUodWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHN0YXRlKTsKICAgIGZ1bmN0aW9uIHN0YXRlQ29kZSh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50IHN0YXRlQ29kZSk7CgogICAgLy8vQGRldiAqKioqKiBzdWJzY3JpcHRpb24gb2ZmZXIgaGFuZGxpbmcgKioqKioKICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX3ByaWNlLCB1aW50MTYgX3hyYXRlUHJvdmlkZXJJZCwgdWludCBfY2hhcmdlUGVyaW9kLCB1aW50IF9leHBpcmVPbiwgdWludCBfb2ZmZXJMaW1pdCwgdWludCBfZGVwb3NpdFZhbHVlLCB1aW50IF9zdGFydE9uLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIHJlZW50cmFudCByZXR1cm5zICh1aW50IHN1YklkKTsKICAgIGZ1bmN0aW9uIHVwZGF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCwgdWludCBfb2ZmZXJMaW1pdCkgcHVibGljOwogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vQGRldiAqKioqKiBzaW1wbGUgZGVwb3NpdCBoYW5kbGluZyAqKioqKgogICAgZnVuY3Rpb24gY3JlYXRlRGVwb3NpdCh1aW50IF92YWx1ZSwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZXR1cm5zICh1aW50IHN1YklkKTsKICAgIGZ1bmN0aW9uIGNsYWltRGVwb3NpdCh1aW50IGRlcG9zaXRJZCkgcHVibGljOwoKICAgIC8vL0BkZXYgKioqKiogRXhjaGFuZ2VSYXRlIHByb3ZpZGVyICoqKioqCiAgICBmdW5jdGlvbiByZWdpc3RlclhSYXRlUHJvdmlkZXIoWFJhdGVQcm92aWRlciBhZGRyKSBwdWJsaWMgcmV0dXJucyAodWludDE2IHhyYXRlUHJvdmlkZXJJZCk7CgogICAgLy8vQGRldiAqKioqKiBTZXJ2aWNlIHByb3ZpZGVyIChwYXltZW50IHJlY2VpdmVyKSAqKioqKgogICAgZnVuY3Rpb24gZW5hYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljOwogICAgZnVuY3Rpb24gZGlzYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYzsKCgogICAgLy8vQGRldiAqKioqKiBjb252ZW5pZW5jZSBzdWJzY3JpcHRpb24gZ2V0dGVyICoqKioqCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25EZXRhaWxzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKAogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJGcm9tLAogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJUbywKICAgICAgICB1aW50IHByaWNlUGVySG91ciwKICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX24sIC8vbm9taW5hdG9yCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kLCAvL2Rlbm9taW5hdG9yCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZCwKICAgICAgICB1aW50IGNoYXJnZVBlcmlvZCwKICAgICAgICB1aW50IHN0YXJ0T24sCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcgogICAgKTsKCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25TdGF0dXModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50LAogICAgICAgIHVpbnQgZXhwaXJlT24sCiAgICAgICAgdWludCBleGVjQ291bnRlciwKICAgICAgICB1aW50IHBhaWRVbnRpbCwKICAgICAgICB1aW50IG9uSG9sZFNpbmNlCiAgICApOwoKICAgIGVudW0gUGF5bWVudFN0YXR1cyB7T0ssIEJBTEFOQ0VfRVJST1IsIEFQUFJPVkFMX0VSUk9SfQogICAgZXZlbnQgUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHVpbnQgX2ZlZSwgYWRkcmVzcyBzZW5kZXIsIFBheW1lbnRTdGF0dXMgc3RhdHVzLCB1aW50IHN1YklkKTsKICAgIGV2ZW50IFNlcnZpY2VQcm92aWRlckVuYWJsZWQoYWRkcmVzcyBhZGRyLCBieXRlcyBtb3JlSW5mbyk7CiAgICBldmVudCBTZXJ2aWNlUHJvdmlkZXJEaXNhYmxlZChhZGRyZXNzIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKTsKCn0gLy9TdWJzY3JpcHRpb25Nb2R1bGUKCmNvbnRyYWN0IEVSQzIwTW9kdWxlU3VwcG9ydCB7CiAgICBmdW5jdGlvbiBfZnVsZmlsbFByZWFwcHJvdmVkUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGFkZHJlc3MgbXNnX3NlbmRlcikgcHVibGljIHJldHVybnMoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIF9mdWxmaWxsUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHVpbnQgc3ViSWQsIGFkZHJlc3MgbXNnX3NlbmRlcikgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBfbWludEZyb21EZXBvc2l0KGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBfYnVybkZvckRlcG9zaXQoYWRkcmVzcyBvd25lciwgdWludCBhbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2Vzcyk7Cn0KCi8vQGRldiBpbXBsZW1lbnRhdGlvbgpjb250cmFjdCBTdWJzY3JpcHRpb25Nb2R1bGVJbXBsIGlzIFN1YnNjcmlwdGlvbk1vZHVsZSwgT3duZWQgIHsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFZFUlNJT04gPSAiMC4xLjAiOwoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgICAgIGNvbnRyYWN0IHN0YXRlcyAgICAgICAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvLy9AZGV2IGxpc3Qgb2YgYWxsIHJlZ2lzdGVyZWQgc2VydmljZSBwcm92aWRlciBjb250cmFjdHMgaW1wbGVtZW50ZWQgYXMgYSBtYXAgZm9yIGJldHRlciBsb29rdXAuCiAgICBtYXBwaW5nIChhZGRyZXNzPT5ib29sKSBwdWJsaWMgcHJvdmlkZXJSZWdpc3RyeTsKCiAgICAvLy9AZGV2IGFsbCBzdWJzY3JpcHRpb25zIGFuZCBvZmZlcnMgKGluY2wuIEZJTkFMSVpFRCkuCiAgICBtYXBwaW5nICh1aW50ID0+IFN1YnNjcmlwdGlvbikgcHVibGljIHN1YnNjcmlwdGlvbnM7CgogICAgLy8vQGRldiBhbGwgYWN0aXZlIHNpbXBsZSBkZXBvc2l0cyBnaXZlZCBieSBkZXBvc2l0SWQuCiAgICBtYXBwaW5nICh1aW50ID0+IERlcG9zaXQpIHB1YmxpYyBkZXBvc2l0czsKCiAgICAvLy9AZGV2IGFkZHJlc3NlcyBvZiByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXJzLgogICAgWFJhdGVQcm92aWRlcltdIHB1YmxpYyB4cmF0ZVByb3ZpZGVyczsKCiAgICAvLy9AZGV2IG9uZ29pbmcgY291bnRlciBmb3Igc3Vic2NyaXB0aW9uIGlkcyBzdGFydGluZyBmcm9tIDEuCiAgICAvLy8gICAgIEN1cnJlbnQgdmFsdWUgcmVwcmVzZW50cyBhbiBpZCBvZiBsYXN0IGNyZWF0ZWQgc3Vic2NyaXB0aW9uLgogICAgdWludCBwdWJsaWMgc3Vic2NyaXB0aW9uQ291bnRlciA9IDA7CgogICAgLy8vQGRldiBvbmdvaW5nIGNvdW50ZXIgZm9yIHNpbXBsZSBkZXBvc2l0IGlkcyBzdGFydGluZyBmcm9tIDEuCiAgICAvLy8gICAgIEN1cnJlbnQgdmFsdWUgcmVwcmVzZW50cyBhbiBpZCBvZiBsYXN0IGNyZWF0ZWQgZGVwb3NpdC4KICAgIHVpbnQgcHVibGljIGRlcG9zaXRDb3VudGVyID0gMDsKCiAgICAvLy9AZGV2IFRva2VuIGNvbnRyYWN0IHdpdGggRVJDMjBNb2R1bGVTdXBwb3J0IGFkZG9uLgogICAgLy8vICAgICBTdWJzY3JpcHRpb24gTW9kdWxlIG9wZXJhdGVzIG9uIGl0cyBiYWxhbmNlcyB2aWEgRVJDMjBNb2R1bGVTdXBwb3J0IGludGVyZmFjZSBhcyB0cnVzdGVkIG1vZHVsZS4KICAgIEVSQzIwTW9kdWxlU3VwcG9ydCBwdWJsaWMgc2FuOwoKCgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgcmVqZWN0IGFsbCBldGhlciBzZW50IHRvIHRoaXMgY29udHJhY3QgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93OwogICAgfQoKCgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgICAgICAgIHNldHVwIGFuZCBjb25maWd1cmF0aW9uICAgICAgICAgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vL0BkZXYgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFN1YnNjcmlwdGlvbk1vZHVsZUltcGwoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHhyYXRlUHJvdmlkZXJzLnB1c2goWFJhdGVQcm92aWRlcih0aGlzKSk7IC8vdGhpcyBpcyBhIGRlZmF1bHQgU0FOOlNBTiAoMToxKSBwcm92aWRlciB3aXRoIGRlZmF1bHQgaWQgPT0gMAogICAgfQoKCiAgICAvLy9AZGV2IGF0dGFjaCBTQU4gdG9rZW4gdG8gd29yayB3aXRoOyBjYW4gYmUgZG9uZSBvbmx5IG9uY2UuCiAgICBmdW5jdGlvbiBhdHRhY2hUb2tlbihhZGRyZXNzIHRva2VuKSBwdWJsaWMgewogICAgICAgIGFzc2VydChhZGRyZXNzKHNhbikgPT0gMCk7IC8vb25seSBpbiBuZXcgZGVwbG95ZWQgc3RhdGUKICAgICAgICBzYW4gPSBFUkMyME1vZHVsZVN1cHBvcnQodG9rZW4pOwogICAgfQoKCiAgICAvLy9AZGV2IHJlZ2lzdGVyIGEgbmV3IHNlcnZpY2UgcHJvdmlkZXIgdG8gdGhlIHBsYXRmb3JtLgogICAgZnVuY3Rpb24gZW5hYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljIG9ubHkob3duZXIpIHsKICAgICAgICBwcm92aWRlclJlZ2lzdHJ5W2FkZHJdID0gdHJ1ZTsKICAgICAgICBTZXJ2aWNlUHJvdmlkZXJFbmFibGVkKGFkZHIsIG1vcmVJbmZvKTsKICAgIH0KCgogICAgLy8vQGRldiBkZS1yZWdpc3RlciB0aGUgc2VydmljZSBwcm92aWRlciB3aXRoIGdpdmVuIGBhZGRyYC4KICAgIGZ1bmN0aW9uIGRpc2FibGVTZXJ2aWNlUHJvdmlkZXIoU2VydmljZVByb3ZpZGVyIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKSBwdWJsaWMgb25seShvd25lcikgewogICAgICAgIGRlbGV0ZSBwcm92aWRlclJlZ2lzdHJ5W2FkZHJdOwogICAgICAgIFNlcnZpY2VQcm92aWRlckRpc2FibGVkKGFkZHIsIG1vcmVJbmZvKTsKICAgIH0KCgogICAgLy8vQGRldiByZWdpc3RlciBuZXcgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlci4KICAgIC8vLyAgICAgWFJhdGVQcm92aWRlciBjYW4ndCBiZSBkZS1yZWdpc3RlcmVkLCBiZWNhdXNlIHRoZXkgY291bGQgYmUgc3RpbGwgaW4gdXNlIGJ5IHNvbWUgc3Vic2NyaXB0aW9uLgogICAgZnVuY3Rpb24gcmVnaXN0ZXJYUmF0ZVByb3ZpZGVyKFhSYXRlUHJvdmlkZXIgYWRkcikgcHVibGljIG9ubHkob3duZXIpIHJldHVybnMgKHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQpIHsKICAgICAgICB4cmF0ZVByb3ZpZGVySWQgPSB1aW50MTYoeHJhdGVQcm92aWRlcnMubGVuZ3RoKTsKICAgICAgICB4cmF0ZVByb3ZpZGVycy5wdXNoKGFkZHIpOwogICAgICAgIE5ld1hSYXRlUHJvdmlkZXIoYWRkciwgeHJhdGVQcm92aWRlcklkLCBtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLy8vQGRldiB4cmF0ZVByb3ZpZGVycyBsZW5ndGggYWNjZXNzb3IuCiAgICBmdW5jdGlvbiBnZXRYUmF0ZVByb3ZpZGVyTGVuZ3RoKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4geHJhdGVQcm92aWRlcnMubGVuZ3RoOwogICAgfQoKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgICBzaW5nbGUgcGF5bWVudCBtZXRob2RzICAgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy8vQG5vdGljZSBtYWtlcyBzaW5nbGUgcGF5bWVudCB0byBzZXJ2aWNlIHByb3ZpZGVyLgogICAgLy8vQHBhcmFtIF92YWx1ZSAtIGFtb3VudCBvZiBTQU4gdG9rZW4gdG8gc2VudAogICAgLy8vQHBhcmFtIF9wYXltZW50RGF0YSAtICdwYXltZW50IHB1cnBvc2UnIGNvZGUgdXN1YWxseSBpc3N1ZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBjdXN0b21lciBiZWZvcmUgcGF5bWVudC4KICAgIC8vL0BwYXJhbSBfdG8gLSBzZXJ2aWNlIHByb3ZpZGVyIGNvbnRyYWN0CiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBwYXltZW50VG8odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoc2FuLl9mdWxmaWxsUGF5bWVudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgMCwgbXNnLnNlbmRlcikpIHsKICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudAogICAgICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihfdG8pLm9uUGF5bWVudChtc2cuc2VuZGVyLCBfdmFsdWUsIF9wYXltZW50RGF0YSkpOyAgICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIG1ha2VzIHNpbmdsZSBwcmVhcHByb3ZlZCBwYXltZW50IHRvIHNlcnZpY2UgcHJvdmlkZXIuIEFuIGFtb3VudCBtdXN0IGJlIGFscmVhZHkgcHJlYXBwcm92ZWQgYnkgcGF5bWVudCBzZW5kZXIgdG8gcmVjZXBpZW50LgogICAgLy8vQHBhcmFtIF92YWx1ZSAtIGFtb3VudCBvZiBTQU4gdG9rZW4gdG8gc2VudAogICAgLy8vQHBhcmFtIF9wYXltZW50RGF0YSAtICdwYXltZW50IHB1cnBvc2UnIGNvZGUgdXN1YWxseSBpc3N1ZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBjdXN0b21lciBiZWZvcmUgcGF5bWVudC4KICAgIC8vL0BwYXJhbSBfZnJvbSAtIHNlbmRlciBvZiB0aGUgcGF5bWVudCAob3RoZXIgdGhhbiBtc2cuc2VuZGVyKQogICAgLy8vQHBhcmFtIF90byAtIHNlcnZpY2UgcHJvdmlkZXIgY29udHJhY3QKICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIHBheW1lbnRGcm9tKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIGFkZHJlc3MgX2Zyb20sIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKHNhbi5fZnVsZmlsbFByZWFwcHJvdmVkUGF5bWVudChfZnJvbSwgX3RvLCBfdmFsdWUsIG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgIC8vIGEgU2VydmljZVByb3ZpZGVyIChhIFNlcnZpY2VQcm92aWRlcikgaGFzIGhlcmUgYW4gb3Bwb3J0dW5pdHkgdmVyaWZ5IGFuZCByZWplY3QgdGhlIHBheW1lbnQKICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblBheW1lbnQoX2Zyb20sIF92YWx1ZSwgX3BheW1lbnREYXRhKSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgICAgICAgIHN1YnNjcmlwdGlvbiBoYW5kbGluZyAgICAgICAgICAgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vL0BkZXYgY29udmVuaWVuY2UgZ2V0dGVyIGZvciBzb21lIHN1YnNjcmlwdGlvbiBmaWVsZHMKICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkRldGFpbHModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKAogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJGcm9tLAogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJUbywKICAgICAgICB1aW50IHByaWNlUGVySG91ciwKICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX24sIC8vbm9taW5hdG9yCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kLCAvL2Rlbm9taW5hdG9yCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZCwKICAgICAgICB1aW50IGNoYXJnZVBlcmlvZCwKICAgICAgICB1aW50IHN0YXJ0T24sCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcgogICAgKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIHJldHVybiAoc3ViLnRyYW5zZmVyRnJvbSwgc3ViLnRyYW5zZmVyVG8sIHN1Yi5wcmljZVBlckhvdXIsIHN1Yi5pbml0aWFsWHJhdGVfbiwgc3ViLmluaXRpYWxYcmF0ZV9kLCBzdWIueHJhdGVQcm92aWRlcklkLCBzdWIuY2hhcmdlUGVyaW9kLCBzdWIuc3RhcnRPbiwgc3ViLmRlc2NyaXB0b3IpOwogICAgfQoKCiAgICAvLy9AZGV2IGNvbnZlbmllbmNlIGdldHRlciBmb3Igc29tZSBzdWJzY3JpcHRpb24gZmllbGRzCiAgICAvLy8gICAgIGEgY2FsbGVyIG11c3Qga25vdywgdGhhdCB0aGUgc3Vic2NyaXB0aW9uIHdpdGggZ2l2ZW4gaWQgZXhpc3RzLCBiZWNhdXNlIGFsbCB0aGVzZSBmaWVsZHMgY2FuIGJlIDAgZXZlbiB0aGUgc3Vic2NyaXB0aW9uIHdpdGggZ2l2ZW4gaWQgZXhpc3RzLgogICAgZnVuY3Rpb24gc3Vic2NyaXB0aW9uU3RhdHVzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKAogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudCwKICAgICAgICB1aW50IGV4cGlyZU9uLAogICAgICAgIHVpbnQgZXhlY0NvdW50ZXIsCiAgICAgICAgdWludCBwYWlkVW50aWwsCiAgICAgICAgdWludCBvbkhvbGRTaW5jZQogICAgKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIHJldHVybiAoc3ViLmRlcG9zaXRBbW91bnQsIHN1Yi5leHBpcmVPbiwgc3ViLmV4ZWNDb3VudGVyLCBzdWIucGFpZFVudGlsLCBzdWIub25Ib2xkU2luY2UpOwogICAgfQoKCiAgICAvLy9Abm90aWNlIGV4ZWN1dGUgcGVyaW9kaWMgc3Vic2NyaXB0aW9uIHBheW1lbnQuCiAgICAvLy8gICAgICAgIEFueSBvZiBjdXN0b21lciwgc2VydmljZSBwcm92aWRlciBhbmQgcGxhdGZvcm0gb3duZXIgY2FuIGV4ZWN1dGUgdGhpcyBmdW5jdGlvbi4KICAgIC8vLyAgICAgICAgVGhpcyBlbnN1cmVzLCB0aGF0IHRoZSBzdWJzY3JpcHRpb24gY2hhcmdlIGRvZXNuJ3QgYmVjb21lIGRlbGF5ZWQuCiAgICAvLy8gICAgICAgIEF0IGxlYXN0IHRoZSBwbGF0Zm9ybSBvd25lciBoYXMgYW4gaW5jZW50aXZlIHRvIGdldCBmZWUgYW5kIHRodXMgY2FuIHRyaWdnZXIgdGhlIGZ1bmN0aW9uLgogICAgLy8vICAgICAgICBBbiBleGVjdXRpb24gZmFpbHMgaWYgc3Vic2NyaXB0aW9uIGlzIG5vdCBpbiBzdGF0dXMgYENIQVJHRUFCTEVgLgogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIHRvIGJlIGNoYXJnZWQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBleGVjdXRlU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub1JlZW50cmFuY3koTDAwKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgYXNzZXJ0IChtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20gfHwgbXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBpZiAoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yik9PVN1YlN0YXRlLkNIQVJHRUFCTEUpIHsKICAgICAgICAgICAgdmFyIF9mcm9tID0gc3ViLnRyYW5zZmVyRnJvbTsKICAgICAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOwogICAgICAgICAgICB2YXIgX3ZhbHVlID0gX2Ftb3VudFRvQ2hhcmdlKHN1Yik7CiAgICAgICAgICAgIGlmIChzYW4uX2Z1bGZpbGxQYXltZW50KF9mcm9tLCBfdG8sIF92YWx1ZSwgc3ViSWQsIG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgICAgICBzdWIucGFpZFVudGlsICA9IG1heChzdWIucGFpZFVudGlsLCBzdWIuc3RhcnRPbikgKyBzdWIuY2hhcmdlUGVyaW9kOwogICAgICAgICAgICAgICAgKytzdWIuZXhlY0NvdW50ZXI7CiAgICAgICAgICAgICAgICAvLyBhIFNlcnZpY2VQcm92aWRlciAoYSBTZXJ2aWNlUHJvdmlkZXIpIGhhcyBoZXJlIGFuIG9wcG9ydHVuaXR5IHRvIHZlcmlmeSBhbmQgcmVqZWN0IHRoZSBwYXltZW50CiAgICAgICAgICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViRXhlY3V0ZWQoc3ViSWQpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIG1vdmUgYHBhaWRVbnRpbGAgZm9yd2FyZCB0byBnaXZlbiBgbmV3RHVlRGF0ZWAuIEl0IHdhaXZlcyBwYXltZW50cyBmb3IgZ2l2ZW4gdGltZS4KICAgIC8vLyAgICAgICAgVGhpcyBmdW5jdGlvbiBjYW4gYmUgdXNlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIGBnaXZlIGF3YXlgIHNvbWUgc2VydmljZSB0aW1lIGZvciBmcmVlLgogICAgLy8vQHBhcmFtIHN1YklkIC0gaWQgb2Ygc3Vic2NyaXB0aW9uIHRvIGJlIHBvc3Rwb25lZC4KICAgIC8vL0BwYXJhbSBuZXdEdWVEYXRlIC0gbmV3IGBwYWlkVW50aWxgIGRhdGV0aW1lOyByZXF1aXJlIGBuZXdEdWVEYXRlID4gcGFpZFVudGlsYC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIHBvc3Rwb25lRHVlRGF0ZSh1aW50IHN1YklkLCB1aW50IG5ld0R1ZURhdGUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOwogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlcik7IC8vb25seSBTZXJ2aWNlIFByb3ZpZGVyIGlzIGFsbG93ZWQgdG8gcG9zdHBvbmUgdGhlIER1ZURhdGUKICAgICAgICBpZiAoc3ViLnBhaWRVbnRpbCA8IG5ld0R1ZURhdGUpIHsKICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCA9IG5ld0R1ZURhdGU7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9AZGV2IHJldHVybiBjdXJyZW50IHN0YXR1cyBhcyBhIG5hbWUgb2YgYSBzdWJzY3JpcHRpb24gKG9yIGFuIG9mZmVyKSB3aXRoIGdpdmVuIGlkOwogICAgZnVuY3Rpb24gc3RhdGUodWludCBzdWJPck9mZmVySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZyBzdGF0ZSkgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdWJPck9mZmVyID0gc3Vic2NyaXB0aW9uc1tzdWJPck9mZmVySWRdOwogICAgICAgIHJldHVybiBfaXNPZmZlcihzdWJPck9mZmVyKQogICAgICAgICAgICAgID8gT0ZGRVJfU1RBVEVTW3VpbnQoX29mZmVyU3RhdGUoc3ViT3JPZmZlcikpXQogICAgICAgICAgICAgIDogU1VCX1NUQVRFU1t1aW50KF9zdWJzY3JpcHRpb25TdGF0ZShzdWJPck9mZmVyKSldOwogICAgfQoKCiAgICAvLy9AZGV2IHJldHVybiBjdXJyZW50IHN0YXR1cyBhcyBhIGNvZGUgb2YgYSBzdWJzY3JpcHRpb24gKG9yIGFuIG9mZmVyKSB3aXRoIGdpdmVuIGlkOwogICAgZnVuY3Rpb24gc3RhdGVDb2RlKHVpbnQgc3ViT3JPZmZlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50IHN0YXRlQ29kZSkgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdWJPck9mZmVyID0gc3Vic2NyaXB0aW9uc1tzdWJPck9mZmVySWRdOwogICAgICAgIHJldHVybiBfaXNPZmZlcihzdWJPck9mZmVyKQogICAgICAgICAgICAgID8gdWludChfb2ZmZXJTdGF0ZShzdWJPck9mZmVyKSkKICAgICAgICAgICAgICA6IHVpbnQoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yk9yT2ZmZXIpKTsKICAgIH0KCgogICAgZnVuY3Rpb24gX29mZmVyU3RhdGUoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKE9mZmVyU3RhdGUgc3RhdHVzKSB7CiAgICAgICAgaWYgKCFfaXNPZmZlcihzdWIpKSB7CiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLk5PVF9FWElTVDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi5zdGFydE9uID4gbm93KSB7CiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLkJFRk9SRV9TVEFSVDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuT05fSE9MRDsKICAgICAgICB9IGVsc2UgaWYgKG5vdyA8PSBzdWIuZXhwaXJlT24pIHsKICAgICAgICAgICAgcmV0dXJuIHN1Yi5leGVjQ291bnRlciA+IDAKICAgICAgICAgICAgICAgID8gT2ZmZXJTdGF0ZS5BQ1RJVkUKICAgICAgICAgICAgICAgIDogT2ZmZXJTdGF0ZS5TT0xEX09VVDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5FWFBJUkVEOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfc3Vic2NyaXB0aW9uU3RhdGUoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKFN1YlN0YXRlIHN0YXR1cykgewogICAgICAgIGlmICghX2lzU3Vic2NyaXB0aW9uKHN1YikpIHsKICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLk5PVF9FWElTVDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi5zdGFydE9uID4gbm93KSB7CiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5CRUZPUkVfU1RBUlQ7CiAgICAgICAgfSBlbHNlIGlmIChzdWIub25Ib2xkU2luY2UgPiAwKSB7CiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5PTl9IT0xEOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLnBhaWRVbnRpbCA+PSBzdWIuZXhwaXJlT24pIHsKICAgICAgICAgICAgcmV0dXJuIG5vdyA8IHN1Yi5leHBpcmVPbgogICAgICAgICAgICAgICAgPyBTdWJTdGF0ZS5DQU5DRUxFRAogICAgICAgICAgICAgICAgOiBzdWIuZGVwb3NpdEFtb3VudCA+IDAKICAgICAgICAgICAgICAgICAgICA/IFN1YlN0YXRlLkVYUElSRUQKICAgICAgICAgICAgICAgICAgICA6IFN1YlN0YXRlLkZJTkFMSVpFRDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi5wYWlkVW50aWwgPD0gbm93KSB7CiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5DSEFSR0VBQkxFOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5QQUlEOwogICAgICAgIH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBjcmVhdGUgYSBuZXcgc3Vic2NyaXB0aW9uIG9mZmVyLgogICAgLy8vQGRldiBvbmx5IHJlZ2lzdGVyZWQgc2VydmljZSBwcm92aWRlciBpcyBhbGxvd2VkIHRvIGNyZWF0ZSBvZmZlcnMuCiAgICAvLy9AZGV2IHN1YnNjcmlwdGlvbiB1c2VzIFNBTiB0b2tlbiBmb3IgcGF5bWVudCwgYnV0IGFuIGV4YWN0IGFtb3VudCB0byBiZSBwYWlkIG9yIGRlcG9zaXQgaXMgY2FsY3VsYXRlZCB1c2luZyBleGNoYW5nZSByYXRlIGZyb20gZXh0ZXJuYWwgeHJhdGVQcm92aWRlciAocHJldmlvc2x5IHJlZ2lzdGVyZWQgb24gcGxhdGZvcm0pLgogICAgLy8vICAgIFRoaXMgYWxsb3dzIHRvIGNyZWF0ZSBhIHN1YnNjcmlwdGlvbiBib3VuZCB0byBhbm90aGVyIHRva2VuIG9yIGV2ZW4gZmlhdCBjdXJyZW5jeS4KICAgIC8vL0BwYXJhbSBfcHJpY2VQZXJIb3VyIC0gc3Vic2NyaXB0aW9uIHByaWNlIHBlciBob3VyIGluIFNBTgogICAgLy8vQHBhcmFtIF94cmF0ZVByb3ZpZGVySWQgLSBpZCBvZiBleHRlcm5hbCBleGNoYW5nZSByYXRlIHByb3ZpZGVyIGZyb20gc3Vic2NyaXB0aW9uIGN1cnJlbmN5IHRvIFNBTjsgIjAiIG1lYW5zIHN1YnNjcmlwdGlvbiBpcyBwcmljZWQgaW4gU0FOIG5hdGl2ZWx5LgogICAgLy8vQHBhcmFtIF9jaGFyZ2VQZXJpb2QgLSB0aW1lIHBlcmlvZCB0byBjaGFyZ2U7IHN1YnNjcmlwdGlvbiBjYW4ndCBiZSBjaGFyZ2VkIG1vcmUgb2Z0ZW4gdGhhbiB0aGlzIHBlcmlvZC4gVGltZSB1bml0cyBhcmUgbmF0aXZlIGV0aGVyZXVtIHRpbWUsIHJldHVybmluZyBieSBgbm93YCwgaS5lLiBzZWNvbmRzLgogICAgLy8vQHBhcmFtIF9leHBpcmVPbiAtIG9mZmVyIGNhbid0IGJlIGFjY2VwdGVkIGFmdGVyIHRoaXMgdGltZS4KICAgIC8vL0BwYXJhbSBfb2ZmZXJMaW1pdCAtIGhvdyBtYW55IHN1YnNjcmlwdGlvbiBhcmUgYXZhaWxhYmxlIHRvIGNyZWF0ZWQgZnJvbSB0aGlzIG9mZmVyOyB0aGVyZSBpcyBubyBtYWdpYyBudW1iZXIgZm9yIHVubGltaXRlZCBvZmZlciAtLSB1c2UgYmlnIG51bWJlciBpbnN0ZWFkLgogICAgLy8vQHBhcmFtIF9kZXBvc2l0QW1vdW50IC0gdXBmcm9udCBkZXBvc2l0IHJlcXVpcmVkIGZvciBjcmVhdGluZyBhIHN1YnNjcmlwdGlvbjsgdGhpcyBkZXBvc2l0IGJlY29tZXMgZnVsbHkgcmV0dXJuZWQgb24gc3Vic2NyaXB0aW9uIGlzIG92ZXIuCiAgICAvLy8gICAgICAgY3VycmVudGx5IHRoaXMgZGVwb3NpdCBpcyBub3Qgc3ViamVjdCBvZiBwbGF0Zm9ybSBmZWVzIGFuZCB3aWxsIGJlIHJlZnVuZGVkIGluIGZ1bGwuIE5leHQgdmVyc2lvbnMgb2YgdGhpcyBtb2R1bGUgY2FuIHVzZSBkZXBvc2l0IGluIGNhc2Ugb2Ygb3V0c3RhbmRpbmcgcGF5bWVudHMuCiAgICAvLy9AcGFyYW0gX3N0YXJ0T24gLSBhIHN1YnNjcmlwdGlvbiBmcm9tIHRoaXMgb2ZmZXIgY2FuJ3QgYmUgY3JlYXRlZCBiZWZvcmUgdGhpcyB0aW1lLiBUaW1lIHVuaXRzIGFyZSBuYXRpdmUgZXRoZXJldW0gdGltZSwgcmV0dXJuaW5nIGJ5IGBub3dgLCBpLmUuIHNlY29uZHMuCiAgICAvLy9AcGFyYW0gX2Rlc2NyaXB0b3IgLSBhcmJpdHJhcnkgYnl0ZXMgYXMgYW4gb2ZmZXIgZGVzY3JpcHRvci4gVGhpcyBkZXNjcmlwdG9yIGlzIGNvcGllZCBpbnRvIHN1YnNjcmlwdGlvbiBhbmQgdGhlbiBzZXJ2aWNlIHByb3ZpZGVyIGJlY29tZXMgaXQgcGFzc2VkIGluIG5vdGlmaWNhdGlvbnMuCiAgICAvLwogICAgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfcHJpY2VQZXJIb3VyLCB1aW50MTYgX3hyYXRlUHJvdmlkZXJJZCwgdWludCBfY2hhcmdlUGVyaW9kLCB1aW50IF9leHBpcmVPbiwgdWludCBfb2ZmZXJMaW1pdCwgdWludCBfZGVwb3NpdEFtb3VudCwgdWludCBfc3RhcnRPbiwgYnl0ZXMgX2Rlc2NyaXB0b3IpCiAgICBwdWJsaWMKICAgIG5vUmVlbnRyYW5jeShMMDEpCiAgICBvbmx5UmVnaXN0ZXJlZFByb3ZpZGVyCiAgICByZXR1cm5zICh1aW50IHN1YklkKSB7CiAgICAgICAgYXNzZXJ0IChfc3RhcnRPbiA8IF9leHBpcmVPbik7CiAgICAgICAgYXNzZXJ0IChfY2hhcmdlUGVyaW9kIDw9IDEwIHllYXJzKTsgLy9zYW5pdHkgY2hlY2sKICAgICAgICB2YXIgKF94cmF0ZV9uLCBfeHJhdGVfZCkgPSBfeHJhdGVQcm92aWRlcklkID09IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAoMSwxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFhSYXRlUHJvdmlkZXIoeHJhdGVQcm92aWRlcnNbX3hyYXRlUHJvdmlkZXJJZF0pLmdldFJhdGUoKTsgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgYXNzZXJ0IChfeHJhdGVfbiA+IDAgJiYgX3hyYXRlX2QgPiAwKTsKICAgICAgICBzdWJzY3JpcHRpb25zWysrc3Vic2NyaXB0aW9uQ291bnRlcl0gPSBTdWJzY3JpcHRpb24gKHsKICAgICAgICAgICAgdHJhbnNmZXJGcm9tICAgIDogMCwgICAgICAgICAgICAgICAgICAvLyBlbXB0eSB0cmFuc2ZlckZyb20gZmllbGQgbWVhbnMgd2UgaGF2ZSBhbiBvZmZlciwgbm90IGEgc3Vic2NyaXB0aW9uCiAgICAgICAgICAgIHRyYW5zZmVyVG8gICAgICA6IG1zZy5zZW5kZXIsICAgICAgICAgLy8gc2VydmljZSBwcm92aWRlciBpcyBhIGJlbmVmaWNpYXJ5IG9mIHN1YnNjcmlwdG9uIHBheW1lbnRzCiAgICAgICAgICAgIHByaWNlUGVySG91ciAgICA6IF9wcmljZVBlckhvdXIsICAgICAgLy8gcHJpY2UgcGVyIGhvdXIgaW4gU0FOIChyZWNhbGN1bGF0ZWQgZnJvbSBiYXNlIGN1cnJlbmN5IGlmIG5lZWRlZCkKICAgICAgICAgICAgeHJhdGVQcm92aWRlcklkIDogX3hyYXRlUHJvdmlkZXJJZCwgICAvLyBpZCBvZiByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIgb3IgemVybyBpZiBhbiBvZmZlciBpcyBub21pbmF0ZWQgaW4gU0FOLgogICAgICAgICAgICBpbml0aWFsWHJhdGVfbiAgOiBfeHJhdGVfbiwgICAgICAgICAgIC8vIGZyYWN0aW9uIG5vbWluYXRvciBvZiB0aGUgaW5pdGlhbCBleGNoYW5nZSByYXRlCiAgICAgICAgICAgIGluaXRpYWxYcmF0ZV9kICA6IF94cmF0ZV9kLCAgICAgICAgICAgLy8gZnJhY3Rpb24gZGVub21pbmF0b3Igb2YgdGhlIGluaXRpYWwgZXhjaGFuZ2UgcmF0ZQogICAgICAgICAgICBwYWlkVW50aWwgICAgICAgOiAwLCAgICAgICAgICAgICAgICAgIC8vIHNlcnZpY2UgaXMgY29uc2lkZXJlZCB0byBiZSBwYWlkIHVudGlsIHRoaXMgdGltZTsgbm8gY2hhcmdlIGlzIHBvc3NpYmxlIHdoaWxlIHN1YnNjcmlwdGlvbiBpcyBwYWlkIGZvciBub3cuCiAgICAgICAgICAgIGNoYXJnZVBlcmlvZCAgICA6IF9jaGFyZ2VQZXJpb2QsICAgICAgLy8gcGVyaW9kIGluIHNlY29uZHMgKGV0aGVyZXVtIGJsb2NrIHRpbWUgdW5pdCkgdG8gY2hhcmdlLgogICAgICAgICAgICBkZXBvc2l0QW1vdW50ICAgOiBfZGVwb3NpdEFtb3VudCwgICAgIC8vIGRlcG9zaXQgcmVxdWlyZWQgZm9yIHN1YnNjcmlwdGlvbiBhY2NlcHQuCiAgICAgICAgICAgIHN0YXJ0T24gICAgICAgICA6IF9zdGFydE9uLAogICAgICAgICAgICBleHBpcmVPbiAgICAgICAgOiBfZXhwaXJlT24sCiAgICAgICAgICAgIGV4ZWNDb3VudGVyICAgICA6IF9vZmZlckxpbWl0LAogICAgICAgICAgICBkZXNjcmlwdG9yICAgICAgOiBfZGVzY3JpcHRvciwKICAgICAgICAgICAgb25Ib2xkU2luY2UgICAgIDogMCAgICAgICAgICAgICAgICAgICAvLyBvZmZlciBpcyBub3Qgb24gaG9sZCBieSBkZWZhdWx0LgogICAgICAgIH0pOwogICAgICAgIHJldHVybiBzdWJzY3JpcHRpb25Db3VudGVyOyAgICAgICAgICAgICAgIC8vIHJldHVybnMgYW4gaWQgb2YgdGhlIG5ldyBvZmZlci4KICAgIH0KCgogICAgLy8vQG5vdGljZSB1cGRhdGVzIGN1cnJlbnRseSBhdmFpbGFibGUgbnVtYmVyIG9mIHN1YnNjcmlwdGlvbiBmb3IgdGhpcyBvZmZlci4KICAgIC8vLyAgICAgICAgT3RoZXIgb2ZmZXIncyBwYXJhbWV0ZXIgY2FuJ3QgYmUgdXBkYXRlZCBiZWNhdXNlIHRoZXkgYXJlIGNvbnNpZGVyZWQgdG8gYmUgYSBwdWJsaWMgb2ZmZXIgcmV2aWV3ZWQgYnkgY3VzdG9tZXJzLgogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBzaG91bGQgcmVjcmVhdGUgdGhlIG9mZmVyIGFzIGEgbmV3IG9uZSBpbiBjYXNlIG9mIG90aGVyIGNoYW5nZXMuCiAgICAvLwogICAgZnVuY3Rpb24gdXBkYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfb2ZmZXJJZCwgdWludCBfb2ZmZXJMaW1pdCkgcHVibGljIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbX29mZmVySWRdOwogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsKICAgICAgICBhc3NlcnQgKG9mZmVyLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlcik7IC8vb25seSBQcm92aWRlciBpcyBhbGxvd2VkIHRvIHVwZGF0ZSB0aGUgb2ZmZXIuCiAgICAgICAgb2ZmZXIuZXhlY0NvdW50ZXIgPSBfb2ZmZXJMaW1pdDsKICAgIH0KCgogICAgLy8vQG5vdGljZSBhY2NlcHQgZ2l2ZW4gb2ZmZXIgYW5kIGNyZWF0ZSBhIG5ldyBzdWJzY3JpcHRpb24gb24gdGhlIGJhc2Ugb2YgaXQuCiAgICAvLy8KICAgIC8vL0BkZXYgdGhlIHNlcnZpY2UgcHJvdmlkZXIgKG9mZmVyLmB0cmFuc2ZlclRvYCkgYmVjb21lcyBub3RpZmllZCBhYm91dCBuZXcgc3Vic2NyaXB0aW9uIGJ5IGNhbGwgYG9uU3ViTmV3KG5ld1N1YklkLCBfb2ZmZXJJZClgLgogICAgLy8vICAgICBJdCBpcyBwcm92aWRlcidzIHJlc3BvbnNpYmlsaXR5IHRvIHJldHJpZXZlIGFuZCBzdG9yZSBhbnkgbmVjZXNzYXJ5IGluZm9ybWF0aW9uIGFib3V0IG9mZmVyIGFuZCB0aGlzIG5ldyBzdWJzY3JpcHRpb24uIFNvbWUgb2YgaW5mbyBpcyBvbmx5IGF2YWlsYWJsZSBhdCB0aGlzIHBvaW50LgogICAgLy8vICAgICBUaGUgU2VydmljZSBQcm92aWRlciBjYW4gYWxzbyByZWplY3QgdGhlIG5ldyBzdWJzY3JpcHRpb24gYnkgdGhyb3dpbmcgYW4gZXhjZXB0aW9uIG9yIHJldHVybmluZyBgZmFsc2VgIGZyb20gYG9uU3ViTmV3KG5ld1N1YklkLCBfb2ZmZXJJZClgIGV2ZW50IGhhbmRsZXIuCiAgICAvLy9AcGFyYW0gX29mZmVySWQgICAtIGlkIG9mIHRoZSBvZmZlciB0byBiZSBhY2NlcHRlZAogICAgLy8vQHBhcmFtIF9leHBpcmVPbiAgLSBzdWJzY3JpcHRpb24gZXhwaXJhdGlvbiB0aW1lOyBubyBjaGFyZ2VzIGFyZSBwb3NzaWJsZSBiZWhpbmQgdGhpcyB0aW1lLgogICAgLy8vQHBhcmFtIF9zdGFydE9uICAgLSBzdWJzY3JpcHRpb24gc3RhcnQgdGltZTsgbm8gY2hhcmdlcyBhcmUgcG9zc2libGUgYmVmb3JlIHRoaXMgdGltZS4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgSWYgdGhlIGBfc3RhcnRPbmAgaXMgaW4gdGhlIHBhc3Qgb3IgaXMgemVybywgaXQgbWVhbnMgc3RhcnQgdGhlIHN1YnNjcmlwdGlvbiBBU0FQLgogICAgLy8KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbih1aW50IF9vZmZlcklkLCB1aW50IF9leHBpcmVPbiwgdWludCBfc3RhcnRPbikgcHVibGljIG5vUmVlbnRyYW5jeShMMDIpIHJldHVybnMgKHVpbnQgbmV3U3ViSWQpIHsKICAgICAgICBhc3NlcnQgKF9zdGFydE9uIDwgX2V4cGlyZU9uKTsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbX29mZmVySWRdOwogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsKICAgICAgICBhc3NlcnQgKG9mZmVyLnN0YXJ0T24gPT0gMCAgICAgfHwgb2ZmZXIuc3RhcnRPbiAgPD0gbm93KTsKICAgICAgICBhc3NlcnQgKG9mZmVyLmV4cGlyZU9uID09IDAgICAgfHwgb2ZmZXIuZXhwaXJlT24gPj0gbm93KTsKICAgICAgICBhc3NlcnQgKG9mZmVyLm9uSG9sZFNpbmNlID09IDApOwogICAgICAgIGFzc2VydCAob2ZmZXIuZXhlY0NvdW50ZXIgPiAwKTsKICAgICAgICAtLW9mZmVyLmV4ZWNDb3VudGVyOwogICAgICAgIG5ld1N1YklkID0gKytzdWJzY3JpcHRpb25Db3VudGVyOwogICAgICAgIC8vY3JlYXRlIGEgY2xvbmUgb2YgdGhlIG9mZmVyLi4uCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2UgbmV3U3ViID0gc3Vic2NyaXB0aW9uc1tuZXdTdWJJZF0gPSBvZmZlcjsKICAgICAgICAvLy4uLiBhbmQgYWRqdXN0IHNvbWUgZmllbGRzIHNwZWNpZmljIHRvIHN1YnNjcmlwdGlvbgogICAgICAgIG5ld1N1Yi50cmFuc2ZlckZyb20gPSBtc2cuc2VuZGVyOwogICAgICAgIG5ld1N1Yi5leGVjQ291bnRlciA9IDA7CiAgICAgICAgbmV3U3ViLnBhaWRVbnRpbCA9IG5ld1N1Yi5zdGFydE9uID0gbWF4KF9zdGFydE9uLCBub3cpOyAgICAgLy9ubyBkZWJ0cyBiZWZvcmUgYWN0dWFsIGNyZWF0aW9uIHRpbWUhCiAgICAgICAgbmV3U3ViLmV4cGlyZU9uID0gX2V4cGlyZU9uOwogICAgICAgIG5ld1N1Yi5kZXBvc2l0QW1vdW50ID0gX2FwcGx5WGNoYW5nZVJhdGUobmV3U3ViLmRlcG9zaXRBbW91bnQsIG5ld1N1Yik7ICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAvL2RlcG9zaXRBbW91bnQgaXMgbm93IHN0b3JlZCBpbiB0aGUgc3ViLCBzbyBidXJuIHRoZSBzYW1lIGFtb3VudCBmcm9tIGN1c3RvbWVyJ3MgYWNjb3VudC4KICAgICAgICBhc3NlcnQgKHNhbi5fYnVybkZvckRlcG9zaXQobXNnLnNlbmRlciwgbmV3U3ViLmRlcG9zaXRBbW91bnQpKTsKICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihuZXdTdWIudHJhbnNmZXJUbykub25TdWJOZXcobmV3U3ViSWQsIF9vZmZlcklkKSk7ICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5OyBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBzdGlsbCByZWplY3QgdGhlIG5ldyBzdWJzY3JpcHRpb24gaGVyZQoKICAgICAgICBOZXdTdWJzY3JpcHRpb24obmV3U3ViLnRyYW5zZmVyRnJvbSwgbmV3U3ViLnRyYW5zZmVyVG8sIF9vZmZlcklkLCBuZXdTdWJJZCk7CiAgICAgICAgcmV0dXJuIG5ld1N1YklkOwogICAgfQoKCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBvZmZlciBnaXZlbiBieSBgb2ZmZXJJZGAuCiAgICAvLy9AZGV2IHNldHMgb2ZmZXIuYGV4cGlyZU9uYCB0byBgZXhwaXJlT25gLgogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsKICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7CiAgICAgICAgYXNzZXJ0IChvZmZlci50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzZXJ2aWNlIHByb3ZpZGVyIG9yIHBsYXRmb3JtIG93bmVyIGlzIGFsbG93ZWQgdG8gY2FuY2VsIHRoZSBvZmZlcgogICAgICAgIGlmIChvZmZlci5leHBpcmVPbj5ub3cpewogICAgICAgICAgICBvZmZlci5leHBpcmVPbiA9IG5vdzsKICAgICAgICAgICAgT2ZmZXJDYW5jZWxlZChvZmZlcklkLCBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBzdWJzY3JpcHRpb24gZ2l2ZW4gYnkgYHN1YklkYCAoYSBncmFjZWZ1bCB2ZXJzaW9uKS4KICAgIC8vL0Bub3RpY2UgSU1QT1JUQU5UOiBhIG1hbGljaW91cyBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBjb25zdW1lIGFsbCBnYXMgYW5kIHByZXZlbnRpbmcgc3Vic2NyaXB0aW9uIGZyb20gY2FuY2VsbGF0aW9uLgogICAgLy8vICAgICAgICBJZiBzbywgdXNlIGBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKWAgYXMgdGhlIGZvcmNlZCB2ZXJzaW9uLgogICAgLy8vICAgICAgICAgc2VlIGBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKWAgZm9yIG1vcmUgZG9jdW1lbnRhdGlvbi4KICAgIC8vCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHsKICAgICAgICByZXR1cm4gY2FuY2VsU3Vic2NyaXB0aW9uKHN1YklkLCAwKTsKICAgIH0KCgogICAgLy8vQG5vdGljZSBjYW5jZWwgYW4gc3Vic2NyaXB0aW9uIGdpdmVuIGJ5IGBzdWJJZGAgKGEgZm9yY2VkIHZlcnNpb24pLgogICAgLy8vICAgICAgICBDYW5jZWxsYXRpb24gbWVhbnMgbm8gZnVydGhlciBjaGFyZ2VzIHRvIHRoaXMgc3Vic2NyaXB0aW9uIGFyZSBwb3NzaWJsZS4gVGhlIHByb3ZpZGVkIHN1YnNjcmlwdGlvbiBkZXBvc2l0IGNhbiBiZSB3aXRoZHJhd24gb25seSBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4KICAgIC8vLyAgICAgICAgRGVwZW5kaW5nIG9uIG5hdHVyZSBvZiB0aGUgc2VydmljZSBwcm92aWRlZCwgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIGFsbG93IGFuIGltbWVkaWF0ZSBkZXBvc2l0IHdpdGhkcmF3YWwgYnkgYHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpYCBjYWxsLCBidXQgaXRzIG9uIGhpcyBvd24uCiAgICAvLy8gICAgICAgIEluIHNvbWUgYnVzaW5lc3MgY2FzZXMgYSBkZXBvc2l0IG11c3QgcmVtYWluIGxvY2tlZCB1bnRpbCBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3ZlciBldmVuLCB0aGUgc3Vic2NyaXB0aW9uIGlzIGFscmVhZHkgY2FuY2VsZWQuCiAgICAvLy9Abm90aWNlIGdhc1Jlc2VydmUgaXMgYSBnYXMgYW1vdW50IHJlc2VydmVkIGZvciBjb250cmFjdCBleGVjdXRpb24gQUZURVIgc2VydmljZSBwcm92aWRlciBiZWNvbWVzIGBvblN1YkNhbmNlbGVkKHVpbnQyNTYsYWRkcmVzcylgIG5vdGlmaWNhdGlvbi4KICAgIC8vLyAgICAgICAgSXQgZ3VhcmFudGVlcywgdGhhdCBjYW5jZWxsYXRpb24gYmVjb21lcyBleGVjdXRlZCBldmVuIGEgKG1hbGljaW91cykgc2VydmljZSBwcm92aWRlciBjb25zdW1lcyBhbGwgZ2FzIHByb3ZpZGVkLgogICAgLy8vICAgICAgICBJZiBzbywgdXNlIGBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKWAgYXMgdGhlIGZvcmNlZCB2ZXJzaW9uLgogICAgLy8vICAgICAgICBUaGlzIGRpZmZlcmVuY2UgaXMgYmVjYXVzZSB0aGUgY3VzdG9tZXIgbXVzdCBhbHdheXMgaGF2ZSBhIHBvc3NpYmlsaXR5IHRvIGNhbmNlbCBoaXMgY29udHJhY3QgZXZlbiB0aGUgc2VydmljZSBwcm92aWRlciBkaXNhZ3JlZSBvbiBjYW5jZWxsYXRpb24uCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gdG8gYmUgY2FuY2VsbGVkCiAgICAvLy9AcGFyYW0gZ2FzUmVzZXJ2ZSAtIGdhcyByZXNlcnZlZCBmb3IgY2FsbCBmaW5hbGl6YXRpb24gKG1pbmltdW0gcmVzZXJ2YXRpb24gaXMgMTAwMDAgZ2FzKQogICAgLy8KICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpIHB1YmxpYyBub1JlZW50cmFuY3koTDAzKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJGcm9tID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzdWJzY3JpcHRpb24gb3duZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byBjYW5jZWwgaXQKICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsKICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87CiAgICAgICAgc3ViLmV4cGlyZU9uID0gbWF4KG5vdywgc3ViLnBhaWRVbnRpbCk7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gX3RvKSB7CiAgICAgICAgICAgIC8vc3VwcmVzcyByZS10aHJvd2luZyBvZiBleGNlcHRpb25zOyByZXNlcnZlIGVub3VnaCBnYXMgdG8gZmluaXNoIHRoaXMgZnVuY3Rpb24KICAgICAgICAgICAgZ2FzUmVzZXJ2ZSA9IG1heChnYXNSZXNlcnZlLDEwMDAwKTsgIC8vcmVzZXJ2ZSBtaW5pbXVtIDEwMDAwIGdhcwogICAgICAgICAgICBhc3NlcnQgKG1zZy5nYXMgPiBnYXNSZXNlcnZlKTsgICAgICAgLy9zYW5pdHkgY2hlY2sKICAgICAgICAgICAgaWYgKF90by5jYWxsLmdhcyhtc2cuZ2FzLWdhc1Jlc2VydmUpKGJ5dGVzNChzaGEzKCJvblN1YkNhbmNlbGVkKHVpbnQyNTYsYWRkcmVzcykiKSksIHN1YklkLCBtc2cuc2VuZGVyKSkgeyAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgICAgICAvL2RvIG5vdGhpbmcuIGl0IGlzIG5vdGlmaWNhdGlvbiBvbmx5LgogICAgICAgICAgICAgICAgLy9MYXRlcjogaXMgaXQgcG9zc2libGUgdG8gZXZhbHVhdGUgcmV0dXJuIHZhbHVlIGhlcmU/IElmIGlzIGJldHRlciB0byByZXR1cm4gdGhlIHN1YnNjcmlwdGlvbiBkZXBvc2l0IGhlcmUuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgU3ViQ2FuY2VsZWQoc3ViSWQsIG1zZy5zZW5kZXIpOwogICAgfQoKCiAgICAvLy9Abm90aWNlIHBsYWNlIGFuIGFjdGl2ZSBvZmZlciBvbiBob2xkOyBpdCBtZWFucyBubyBzdWJzY3JpcHRpb25zIGNhbiBiZSBjcmVhdGVkIGZyb20gdGhpcyBvZmZlci4KICAgIC8vLyAgICAgICAgT25seSBzZXJ2aWNlIHByb3ZpZGVyIChvciBwbGF0Zm9ybSBvd25lcikgaXMgYWxsb3dlZCB0byBob2xkL3VuaG9sZCBhIHN1YnNjcmlwdGlvbiBvZmZlci4KICAgIC8vL0BwYXJhbSBvZmZlcklkIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIHBsYWNlZCBvbiBob2xkLgogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsKICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvZmZlci50cmFuc2ZlclRvIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOyAvL29ubHkgb3duZXIgb3Igc2VydmljZSBwcm92aWRlciBjYW4gcGxhY2UgdGhlIG9mZmVyIG9uIGhvbGQuCiAgICAgICAgaWYgKG9mZmVyLm9uSG9sZFNpbmNlID09IDApIHsKICAgICAgICAgICAgb2ZmZXIub25Ib2xkU2luY2UgPSBub3c7CiAgICAgICAgICAgIE9mZmVyT25Ib2xkKG9mZmVySWQsIHRydWUsIG1zZy5zZW5kZXIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgcmVzdW1lIG9uLWhvbGQgb2ZmZXI7IHN1YnNjcmlwdGlvbnMgY2FuIGJlIGNyZWF0ZWQgZnJvbSB0aGlzIG9mZmVyIGFnYWluIChpZiBvdGhlciBjb25kaXRpb25zIGFyZSBtZXQpLgogICAgLy8vICAgICAgICBPbmx5IHNlcnZpY2UgcHJvdmlkZXIgKG9yIHBsYXRmb3JtIG93bmVyKSBpcyBhbGxvd2VkIHRvIGhvbGQvdW5ob2xkIGEgc3Vic2NyaXB0aW9uIG9mZmVyLgogICAgLy8vQHBhcmFtIG9mZmVySWQgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgcmVzdW1lZC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsKICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvZmZlci50cmFuc2ZlclRvIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOyAvL29ubHkgb3duZXIgb3Igc2VydmljZSBwcm92aWRlciBjYW4gcmVhY3RpdmF0ZSB0aGUgb2ZmZXIuCiAgICAgICAgaWYgKG9mZmVyLm9uSG9sZFNpbmNlID4gMCkgewogICAgICAgICAgICBvZmZlci5vbkhvbGRTaW5jZSA9IDA7CiAgICAgICAgICAgIE9mZmVyT25Ib2xkKG9mZmVySWQsIGZhbHNlLCBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIGNhbGxlZCBieSBjdXN0b21lciBvciBzZXJ2aWNlIHByb3ZpZGVyIHRvIHBsYWNlIGEgc3Vic2NyaXB0aW9uIG9uIGhvbGQuCiAgICAvLy8gICAgICAgIElmIGNhbGwgaXMgb3JpZ2luYXRlZCBieSBjdXN0b21lciB0aGUgc2VydmljZSBwcm92aWRlciBjYW4gcmVqZWN0IHRoZSByZXF1ZXN0LgogICAgLy8vICAgICAgICBBIHN1YnNjcmlwdGlvbiBvbiBob2xkIHdpbGwgbm90IGJlIGNoYXJnZWQuIFRoZSBzZXJ2aWNlIGlzIHVzdWFsbHkgbm90IHByb3ZpZGVkIGFzIHdlbGwuCiAgICAvLy8gICAgICAgIER1cmluZyBob2xkIHRpbWUgYSBzdWJzY3JpcHRpb24gcHJlc2VydmUgcmVtYWluaW5nIHBhaWQgdGltZSBwZXJpb2QsIHdoaWNoIGJlY29tZXMgYXZhaWxhYmxlIGFmdGVyIHVuaG9sZC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vUmVlbnRyYW5jeShMMDQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOwogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IF90byB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20pOyAvL29ubHkgY3VzdG9tZXIgb3IgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBzdWJzY3JpcHRpb24gb24gaG9sZC4KICAgICAgICBpZiAoc3ViLm9uSG9sZFNpbmNlID09IDApIHsKICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViVW5Ib2xkKHN1YklkLCBtc2cuc2VuZGVyLCB0cnVlKSkgeyAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAgICAgICAgIHN1Yi5vbkhvbGRTaW5jZSA9IG5vdzsKICAgICAgICAgICAgICAgIFN1Yk9uSG9sZChzdWJJZCwgdHJ1ZSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb3Igc2VydmljZSBwcm92aWRlciB0byB1bmhvbGQgc3Vic2NyaXB0aW9uLgogICAgLy8vICAgICAgICBJZiBjYWxsIGlzIG9yaWdpbmF0ZWQgYnkgY3VzdG9tZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlamVjdCB0aGUgcmVxdWVzdC4KICAgIC8vLyAgICAgICAgQSBzdWJzY3JpcHRpb24gb24gaG9sZCB3aWxsIG5vdCBiZSBjaGFyZ2VkLiBUaGUgc2VydmljZSBpcyB1c3VhbGx5IG5vdCBwcm92aWRlZCBhcyB3ZWxsLgogICAgLy8vICAgICAgICBEdXJpbmcgaG9sZCB0aW1lIGEgc3Vic2NyaXB0aW9uIHByZXNlcnZlIHJlbWFpbmluZyBwYWlkIHRpbWUgcGVyaW9kLCB3aGljaCBiZWNvbWVzIGF2YWlsYWJsZSBhZnRlciB1bmhvbGQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vUmVlbnRyYW5jeShMMDUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOwogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IF90byB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20pOyAvL29ubHkgY3VzdG9tZXIgb3IgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBzdWJzY3JpcHRpb24gb24gaG9sZC4KICAgICAgICBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgewogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBfdG8gfHwgU2VydmljZVByb3ZpZGVyKF90bykub25TdWJVbkhvbGQoc3ViSWQsIG1zZy5zZW5kZXIsIGZhbHNlKSkgeyAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCArPSBub3cgLSBzdWIub25Ib2xkU2luY2U7CiAgICAgICAgICAgICAgICBzdWIub25Ib2xkU2luY2UgPSAwOwogICAgICAgICAgICAgICAgU3ViT25Ib2xkKHN1YklkLCBmYWxzZSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgICAgIGRlcG9zaXQgaGFuZGxpbmcgICAgICAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvLy9Abm90aWNlIGNhbiBiZSBjYWxsZWQgYnkgcHJvdmlkZXIgb24gQ0FOQ0VMRUQgc3Vic2NyaXB0aW9uIHRvIHJldHVybiBhIHN1YnNjcmlwdGlvbiBkZXBvc2l0IHRvIGN1c3RvbWVyIGltbWVkaWF0ZWx5LgogICAgLy8vICAgICAgICBDdXN0b21lciBjYW4gYW55d2F5IGNvbGxlY3QgaGlzIGRlcG9zaXQgYWZ0ZXIgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIuCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gaG9sZGluZyB0aGUgZGVwb3NpdAogICAgLy8KICAgIGZ1bmN0aW9uIHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYyB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgYXNzZXJ0IChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViKSA9PSBTdWJTdGF0ZS5DQU5DRUxFRCk7CiAgICAgICAgYXNzZXJ0IChzdWIuZGVwb3NpdEFtb3VudCA+IDApOyAvL3Nhbml0eSBjaGVjawogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyVG8gPT0gbXNnLnNlbmRlciB8fCBvd25lciA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IHN1YnNjcmlwdGlvbiBvd25lciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIHJlbGVhc2UgZGVwb3NpdC4KICAgICAgICBzdWIuZXhwaXJlT24gPSBub3c7CiAgICAgICAgX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHN1YklkLCBzdWIpOwogICAgfQoKCiAgICAvLy9Abm90aWNlIGNhbGxlZCBieSBjdXN0b21lciBvbiBFWFBJUkVEIHN1YnNjcmlwdGlvbiAoYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIpIHRvIGNvbGxlY3QgYSBzdWJzY3JpcHRpb24gZGVwb3NpdC4KICAgIC8vLyAgICAgICAgQ3VzdG9tZXIgY2FuIGFueXdheSBjb2xsZWN0IGhpcyBkZXBvc2l0IGFmdGVyIGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyLgogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIGhvbGRpbmcgdGhlIGRlcG9zaXQKICAgIC8vCiAgICBmdW5jdGlvbiBjbGFpbVN1YnNjcmlwdGlvbkRlcG9zaXQodWludCBzdWJJZCkgcHVibGljIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpID09IFN1YlN0YXRlLkVYUElSRUQpOwogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyRnJvbSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBhc3NlcnQgKHN1Yi5kZXBvc2l0QW1vdW50ID4gMCk7CiAgICAgICAgX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHN1YklkLCBzdWIpOwogICAgfQoKCiAgICAvL0BkZXYgcmV0dXJucyBzdWJzY3JpcHRpb24gZGVwb3NpdCB0byBjdXN0b21lcgogICAgZnVuY3Rpb24gX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQsIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgewogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudCA9IHN1Yi5kZXBvc2l0QW1vdW50OwogICAgICAgIHN1Yi5kZXBvc2l0QW1vdW50ID0gMDsKICAgICAgICBzYW4uX21pbnRGcm9tRGVwb3NpdChzdWIudHJhbnNmZXJGcm9tLCBkZXBvc2l0QW1vdW50KTsKICAgICAgICBTdWJzY3JpcHRpb25EZXBvc2l0UmV0dXJuZWQoc3ViSWQsIGRlcG9zaXRBbW91bnQsIHN1Yi50cmFuc2ZlckZyb20sIG1zZy5zZW5kZXIpOwogICAgfQoKCiAgICAvLy9Abm90aWNlIGNyZWF0ZSBzaW1wbGUgdW5sb2NrZWQgZGVwb3NpdCwgcmVxdWlyZWQgYnkgc29tZSBzZXJ2aWNlcy4gSXQgY2FuIGJlIGNvbnNpZGVyZWQgYXMgcHJvdmUgb2YgY3VzdG9tZXIncyBzdGFrZS4KICAgIC8vLyAgICAgICAgVGhpcyBkZXNwb3NpdCBjYW4gYmUgY2xhaW1lZCBiYWNrIGJ5IHRoZSBjdXN0b21lciBhdCBhbnl0aW1lLgogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBpcyByZXNwb25zaWJsZSB0byBjaGVjayB0aGUgZGVwb3NpdCBiZWZvcmUgcHJvdmlkaW5nIHRoZSBzZXJ2aWNlLgogICAgLy8vQHBhcmFtIF92YWx1ZSAtIG5vbiB6ZXJvIGRlcG9zaXQgYW1vdW50LgogICAgLy8vQHBhcmFtIF9kZXNjcmlwdG9yIC0gaXMgYSB1bmlxIGtleSwgdXN1YWxseSBnaXZlbiBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIHRoZSBjdXN0b21lciBpbiBvcmRlciB0byBtYWtlIHRoaXMgZGVwb3NpdCB1bmlxdWUuCiAgICAvLy8gICAgICAgIFNlcnZpY2UgUHJvdmlkZXIgc2hvdWxkIHJlamVjdCBkZXBvc2l0IHdpdGggdW5rbm93biBkZXNjcmlwdG9yLCBiZWNhdXNlIG1vc3QgcHJvYmFibHkgaXQgaXMgaW4gdXNlIGZvciBzb21lIGFub3RoZXIgc2VydmljZS4KICAgIC8vL0ByZXR1cm4gZGVwb3NpdElkIC0gYSBoYW5kbGUgdG8gY2xhaW0gYmFjayB0aGUgZGVwb3NpdCBsYXRlci4KICAgIC8vCiAgICBmdW5jdGlvbiBjcmVhdGVEZXBvc2l0KHVpbnQgX3ZhbHVlLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIHJldHVybnMgKHVpbnQgZGVwb3NpdElkKSB7CiAgICAgICAgcmVxdWlyZSAoX3ZhbHVlID4gMCk7CiAgICAgICAgYXNzZXJ0IChzYW4uX2J1cm5Gb3JEZXBvc2l0KG1zZy5zZW5kZXIsX3ZhbHVlKSk7CiAgICAgICAgZGVwb3NpdHNbKytkZXBvc2l0Q291bnRlcl0gPSBEZXBvc2l0ICh7CiAgICAgICAgICAgIG93bmVyIDogbXNnLnNlbmRlciwKICAgICAgICAgICAgdmFsdWUgOiBfdmFsdWUsCiAgICAgICAgICAgIGRlc2NyaXB0b3IgOiBfZGVzY3JpcHRvcgogICAgICAgIH0pOwogICAgICAgIE5ld0RlcG9zaXQoZGVwb3NpdENvdW50ZXIsIF92YWx1ZSwgbXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIGRlcG9zaXRDb3VudGVyOwogICAgfQoKCiAgICAvLy9Abm90aWNlIHJldHVybiBwcmV2aW91c2x5IGNyZWF0ZWQgZGVwb3NpdCB0byB0aGUgdXNlci4gVXNlciBjYW4gY29sbGVjdCBvbmx5IG93biBkZXBvc2l0LgogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBpcyByZXNwb25zaWJsZSB0byBjaGVjayB0aGUgZGVwb3NpdCBiZWZvcmUgcHJvdmlkaW5nIHRoZSBzZXJ2aWNlLgogICAgLy8vQHBhcmFtIF9kZXBvc2l0SWQgLSBhbiBpZCBvZiB0aGUgZGVwb3NpdCB0byBiZSBjb2xsZWN0ZWQuCiAgICAvLwogICAgZnVuY3Rpb24gY2xhaW1EZXBvc2l0KHVpbnQgX2RlcG9zaXRJZCkgcHVibGljIHsKICAgICAgICB2YXIgZGVwb3NpdCA9IGRlcG9zaXRzW19kZXBvc2l0SWRdOwogICAgICAgIHJlcXVpcmUgKGRlcG9zaXQub3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgdmFyIHZhbHVlID0gZGVwb3NpdHNbX2RlcG9zaXRJZF0udmFsdWU7CiAgICAgICAgZGVsZXRlIGRlcG9zaXRzW19kZXBvc2l0SWRdOwogICAgICAgIHNhbi5fbWludEZyb21EZXBvc2l0KG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgICAgICBEZXBvc2l0UmV0dXJuZWQoX2RlcG9zaXRJZCwgbXNnLnNlbmRlcik7CiAgICB9CgoKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgICAgc29tZSBpbnRlcm5hbCBmdW5jdGlvbnMgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgZnVuY3Rpb24gX2Ftb3VudFRvQ2hhcmdlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgcmVlbnRyYW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gX2FwcGx5WGNoYW5nZVJhdGUoc3ViLnByaWNlUGVySG91ciAqIHN1Yi5jaGFyZ2VQZXJpb2QsIHN1YikgLyAxIGhvdXJzOyAgICAgICAvLyA8PT09PSByZWVudHJhbnQgZnVuY3Rpb24gdXNhZ2UKICAgIH0KCiAgICBmdW5jdGlvbiBfYXBwbHlYY2hhbmdlUmF0ZSh1aW50IGFtb3VudCwgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCByZWVudHJhbnQgcmV0dXJucyAodWludCkgeyAgLy8gPD09IGFjdHVhbGx5IGNhbGxlZCBmcm9tIHJlZW50cmFuY3kgZ3VhcmRlZCBjb250ZXh0IG9ubHkgKGkuZS4gZXh0ZXJuYWxseSBzZWN1cmVkKQogICAgICAgIGlmIChzdWIueHJhdGVQcm92aWRlcklkID4gMCkgewogICAgICAgICAgICAvLyB4cmF0ZV9uOiBub21pbmF0b3IKICAgICAgICAgICAgLy8geHJhdGVfZDogZGVub21pbmF0b3Igb2YgdGhlIGV4Y2hhbmdlIHJhdGUgZnJhY3Rpb24uCiAgICAgICAgICAgIHZhciAoeHJhdGVfbiwgeHJhdGVfZCkgPSBYUmF0ZVByb3ZpZGVyKHhyYXRlUHJvdmlkZXJzW3N1Yi54cmF0ZVByb3ZpZGVySWRdKS5nZXRSYXRlKCk7ICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAgICAgYW1vdW50ID0gYW1vdW50ICogc3ViLmluaXRpYWxYcmF0ZV9uICogeHJhdGVfZCAvIHN1Yi5pbml0aWFsWHJhdGVfZCAvIHhyYXRlX247CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gX2lzT2ZmZXIoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsKICAgICAgICByZXR1cm4gc3ViLnRyYW5zZmVyRnJvbSA9PSAwICYmIHN1Yi50cmFuc2ZlclRvICE9IDA7CiAgICB9CgogICAgZnVuY3Rpb24gX2lzU3Vic2NyaXB0aW9uKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlckZyb20gIT0gMCAmJiBzdWIudHJhbnNmZXJUbyAhPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIF9leGlzdHMoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsKICAgICAgICByZXR1cm4gc3ViLnRyYW5zZmVyVG8gIT0gMDsgICAvL2V4aXN0aW5nIHN1YnNjcmlwdGlvbiBvciBvZmZlciBoYXMgYWx3YXlzIHRyYW5zZmVyVG8gc2V0LgogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlSZWdpc3RlcmVkUHJvdmlkZXIoKXsKICAgICAgICBpZiAoIXByb3ZpZGVyUmVnaXN0cnlbbXNnLnNlbmRlcl0pIHRocm93OwogICAgICAgIF87CiAgICB9Cgp9IC8vU3Vic2NyaXB0aW9uTW9kdWxlSW1wbA=='.
	

]
