Class {
	#name : #SRT88fcfbc22c6d3dbaa25af478c578978339bde77a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT88fcfbc22c6d3dbaa25af478c578978339bde77a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Ci8qClRoaXMgRllOIHRva2VuIGNvbnRyYWN0IGlzIGRlcml2ZWQgZnJvbSB0aGUgdlNsaWNlIElDTyBjb250cmFjdCwgYmFzZWQgb24gdGhlIEVSQzIwIHRva2VuIGNvbnRyYWN0LiAKQWRkaXRpb25hbCBmdW5jdGlvbmFsaXR5IGhhcyBiZWVuIGludGVncmF0ZWQ6CiogdGhlIGZ1bmN0aW9uIG1pbnRUb2tlbnMoKSBvbmx5IGNhbGxhYmxlIGZyb20gd2FsbGV0LCB3aGljaCBtYWtlcyB1c2Ugb2YgdGhlIGN1cnJlbnRTd2FwUmF0ZSgpIGFuZCBzYWZlVG9BZGQoKSBoZWxwZXJzCiogdGhlIGZ1bmN0aW9uIG1pbnRSZXNlcnZlKCkgb25seSBjYWxsYWJsZSBmcm9tIHdhbGxldCwgd2hpY2ggYXQgdGhlIGVuZCBvZiB0aGUgY3Jvd2RzYWxlIHdpbGwgYWxsb3cgdGhlIG93bmVycyB0byBjbGFpbSB0aGUgdW5zb2xkIHRva2VucwoqIHRoZSBmdW5jdGlvbiBzdG9wVG9rZW4oKSBvbmx5IGNhbGxhYmxlIGZyb20gd2FsbGV0LCB3aGljaCBpbiBhbiBlbWVyZ2VuY3ksIHdpbGwgdHJpZ2dlciBhIGNvbXBsZXRlIGFuZCBpcnJlY292ZXJhYmxlIHNodXRkb3duIG9mIHRoZSB0b2tlbgoqIENvbnRyYWN0IHRva2VucyBhcmUgbG9ja2VkIHdoZW4gY3JlYXRlZCwgYW5kIG5vIHRva2VucyBpbmNsdWRpbmcgcHJlLW1pbmUgY2FuIGJlIG1vdmVkIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KKi8KCgovLyBFUkMyMCBUb2tlbiBTdGFuZGFyZCBJbnRlcmZhY2UKLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCmNvbnRyYWN0IEVSQzIwIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBUb2tlbiBpcyBFUkMyMCB7CgogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJGdW5kWW91cnNlbGZOb3cgVG9rZW4iOwogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkZZTiI7CiAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7ICAvLyAxOCBpcyB0aGUgbW9zdCBjb21tb24gbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzCiAgdWludDI1NiBwdWJsaWMgdG9rZW5DYXAgPSAxMjUwMDAwMGUxODsgLy8gMTIuNSBtaWxsaW9uIEZZTiBjYXAgCgogIGFkZHJlc3MgcHVibGljIHdhbGxldEFkZHJlc3M7CiAgdWludDI1NiBwdWJsaWMgY3JlYXRpb25UaW1lOwogIGJvb2wgcHVibGljIHRyYW5zZmVyU3RvcDsKIAogIG1hcHBpbmcoIGFkZHJlc3MgPT4gdWludCApIF9iYWxhbmNlczsKICBtYXBwaW5nKCBhZGRyZXNzID0+IG1hcHBpbmcoIGFkZHJlc3MgPT4gdWludCApICkgX2FwcHJvdmFsczsKICB1aW50IF9zdXBwbHk7CgogIGV2ZW50IFRva2VuTWludChhZGRyZXNzIG5ld1Rva2VuSG9sZGVyLCB1aW50IGFtb3VudE9mVG9rZW5zKTsKICBldmVudCBUb2tlblN3YXBPdmVyKCk7CiAgZXZlbnQgRW1lcmdlbmN5U3RvcEFjdGl2YXRlZCgpOwoKICBtb2RpZmllciBvbmx5RnJvbVdhbGxldCB7CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHdhbGxldEFkZHJlc3MpIHRocm93OwogICAgICBfOwogIH0KCiAgLy8gQ2hlY2sgaWYgdHJhbnNmZXIgc2hvdWxkIHN0b3AKICBtb2RpZmllciBjaGVja1RyYW5zZmVyU3RvcCB7CiAgICAgIGlmICh0cmFuc2ZlclN0b3AgPT0gdHJ1ZSkgdGhyb3c7CiAgICAgIF87CiAgfQogCgogIC8qKgogICAqCiAgICogRml4IGZvciB0aGUgRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICAgKgogICAqIGh0dHA6Ly92ZXNzZW5lcy5jb20vdGhlLWVyYzIwLXNob3J0LWFkZHJlc3MtYXR0YWNrLWV4cGxhaW5lZC8KICAgKi8KCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGlmICghKG1zZy5kYXRhLmxlbmd0aCA9PSBzaXplICsgNCkpIHRocm93OwogICAgIF87CiAgIH0gCiAKICBmdW5jdGlvbiBUb2tlbiggdWludCBpbml0aWFsX2JhbGFuY2UsIGFkZHJlc3Mgd2FsbGV0LCB1aW50MjU2IGNyb3dkc2FsZVRpbWUpIHsKICAgIF9iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGluaXRpYWxfYmFsYW5jZTsKICAgIF9zdXBwbHkgPSBpbml0aWFsX2JhbGFuY2U7CiAgICB3YWxsZXRBZGRyZXNzID0gd2FsbGV0OwogICAgY3JlYXRpb25UaW1lID0gY3Jvd2RzYWxlVGltZTsKICAgIHRyYW5zZmVyU3RvcCA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgc3VwcGx5KSB7CiAgICByZXR1cm4gX3N1cHBseTsKICB9CgogIGZ1bmN0aW9uIGJhbGFuY2VPZiggYWRkcmVzcyB3aG8gKSBjb25zdGFudCByZXR1cm5zICh1aW50IHZhbHVlKSB7CiAgICByZXR1cm4gX2JhbGFuY2VzW3dob107CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IF9hbGxvd2FuY2UpIHsKICAgIHJldHVybiBfYXBwcm92YWxzW293bmVyXVtzcGVuZGVyXTsKICB9CgogIC8vIEEgaGVscGVyIHRvIG5vdGlmeSBpZiBvdmVyZmxvdyBvY2N1cnMKICBmdW5jdGlvbiBzYWZlVG9BZGQodWludCBhLCB1aW50IGIpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIChhICsgYiA+PSBhICYmIGEgKyBiID49IGIpOwogIH0KICAKICAvLyBBIGhlbHBlciB0byBub3RpZnkgaWYgb3ZlcmZsb3cgb2NjdXJzIGZvciBtdWx0aXBsaWNhdGlvbgogIGZ1bmN0aW9uIHNhZmVUb011bHRpcGx5KHVpbnQgX2EsIHVpbnQgX2IpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIChfYiA9PSAwIHx8ICgoX2EgKiBfYikgLyBfYikgPT0gX2EpOwogIH0KCiAgLy8gQSBoZWxwZXIgdG8gbm90aWZ5IGlmIHVuZGVyZmxvdyBvY2N1cnMgZm9yIHN1YnRyYWN0aW9uCiAgZnVuY3Rpb24gc2FmZVRvU3ViKHVpbnQgYSwgdWludCBiKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiAoYSA+PSBiKTsKICB9CgoKICBmdW5jdGlvbiB0cmFuc2ZlciggYWRkcmVzcyB0bywgdWludCB2YWx1ZSkKICAgIGNoZWNrVHJhbnNmZXJTdG9wCiAgICBvbmx5UGF5bG9hZFNpemUoMiAqIDMyKQogICAgcmV0dXJucyAoYm9vbCBvaykgewoKICAgIGlmICh0byA9PSB3YWxsZXRBZGRyZXNzKSB0aHJvdzsgLy8gUmVqZWN0IHRyYW5zZmVycyB0byB3YWxsZXQgKHdhbGxldCBjYW5ub3QgaW50ZXJhY3Qgd2l0aCB0b2tlbiBjb250cmFjdCkKICAgIGlmKCBfYmFsYW5jZXNbbXNnLnNlbmRlcl0gPCB2YWx1ZSApIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIGlmKCAhc2FmZVRvQWRkKF9iYWxhbmNlc1t0b10sIHZhbHVlKSApIHsKICAgICAgICB0aHJvdzsKICAgIH0KCiAgICBfYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gdmFsdWU7CiAgICBfYmFsYW5jZXNbdG9dICs9IHZhbHVlOwogICAgVHJhbnNmZXIoIG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSApOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkKICAgIGNoZWNrVHJhbnNmZXJTdG9wCiAgICByZXR1cm5zIChib29sIG9rKSB7CgogICAgaWYgKHRvID09IHdhbGxldEFkZHJlc3MpIHRocm93OyAvLyBSZWplY3QgdHJhbnNmZXJzIHRvIHdhbGxldCAod2FsbGV0IGNhbm5vdCBpbnRlcmFjdCB3aXRoIHRva2VuIGNvbnRyYWN0KQoKICAgIC8vIGlmIHlvdSBkb24ndCBoYXZlIGVub3VnaCBiYWxhbmNlLCB0aHJvdwogICAgaWYoIF9iYWxhbmNlc1tmcm9tXSA8IHZhbHVlICkgewogICAgICAgIHRocm93OwogICAgfQogICAgLy8gaWYgeW91IGRvbid0IGhhdmUgYXBwcm92YWwsIHRocm93CiAgICBpZiggX2FwcHJvdmFsc1tmcm9tXVttc2cuc2VuZGVyXSA8IHZhbHVlICkgewogICAgICAgIHRocm93OwogICAgfQogICAgaWYoICFzYWZlVG9BZGQoX2JhbGFuY2VzW3RvXSwgdmFsdWUpICkgewogICAgICAgIHRocm93OwogICAgfQogICAgLy8gdHJhbnNmZXIgYW5kIHJldHVybiB0cnVlCiAgICBfYXBwcm92YWxzW2Zyb21dW21zZy5zZW5kZXJdIC09IHZhbHVlOwogICAgX2JhbGFuY2VzW2Zyb21dIC09IHZhbHVlOwogICAgX2JhbGFuY2VzW3RvXSArPSB2YWx1ZTsKICAgIFRyYW5zZmVyKCBmcm9tLCB0bywgdmFsdWUgKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpCiAgICBjaGVja1RyYW5zZmVyU3RvcAogICAgcmV0dXJucyAoYm9vbCBvaykgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgLy8KICAgIC8vIE5vdGUgdGhhdCB0aGlzIGRvZXNuJ3QgcHJldmVudCBhdHRhY2tzOyB0aGUgdXNlciB3aWxsIGhhdmUgdG8gcGVyc29uYWxseQogICAgLy8gIGNoZWNrIHRvIGVuc3VyZSB0aGF0IHRoZSB0b2tlbiBjb3VudCBoYXMgbm90IGNoYW5nZWQsIGJlZm9yZSBpc3N1aW5nCiAgICAvLyAgYSBuZXcgYXBwcm92YWwuIEluY3JlbWVudC9kZWNyZW1lbnQgaXMgbm90IGNvbW1vbmx5IHNwZWMtZWQsIGFuZCAKICAgIC8vICBjaGFuZ2luZyB0byBhIGNoZWNrLW15LWFwcHJvdmFscy1iZWZvcmUtY2hhbmdpbmcgd291bGQgcmVxdWlyZSB1c2VyCiAgICAvLyAgdG8gZmluZCBvdXQgaGlzIGN1cnJlbnQgYXBwcm92YWwgZm9yIHNwZW5kZXIgYW5kIGNoYW5nZSBleHBlY3RlZAogICAgLy8gIGJlaGF2aW91ciBmb3IgRVJDMjAuCgoKICAgIGlmICgodmFsdWUhPTApICYmIChfYXBwcm92YWxzW21zZy5zZW5kZXJdW3NwZW5kZXJdICE9MCkpIHRocm93OwoKICAgIF9hcHByb3ZhbHNbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgIEFwcHJvdmFsKCBtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSApOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLyBUaGUgZnVuY3Rpb24gY3VycmVudFN3YXBSYXRlKCkgcmV0dXJucyB0aGUgY3VycmVudCBleGNoYW5nZSByYXRlCiAgLy8gYmV0d2VlbiBGWU4gdG9rZW5zIGFuZCBFdGhlciBkdXJpbmcgdGhlIHRva2VuIHN3YXAgcGVyaW9kCiAgZnVuY3Rpb24gY3VycmVudFN3YXBSYXRlKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgIHVpbnQgcHJlc2FsZVBlcmlvZCA9IDMgZGF5czsKICAgICAgdWludCBwcmVzYWxlVHJhbnNpdGlvbldpbmRvdyA9IDMgaG91cnM7CiAgICAgIGlmIChjcmVhdGlvblRpbWUgKyBwcmVzYWxlUGVyaW9kID4gbm93KSB7ICAvLyAyMDE3LTA2LTEwIDExYW0gR01UKzgKICAgICAgICAgIHJldHVybiAxNDA7IC8vIFByZXNhbGUgV2luZG93IGlzIHRyaWdnZXJlZCBieSBib3RoIHRpbWUgYW5kICJTdGFydCBUb2tlbiBTd2FwIC8gRW5kIFRva2VuIFN3YXAiLiBSZXN0cmljdGVkIHRvIGFubm91bmVtZW50IHJhbmdlIGFuZCBiYXNpYyB0ZXN0aW5nLgogICAgICB9IAogICAgICBlbHNlIGlmIChjcmVhdGlvblRpbWUgKyBwcmVzYWxlUGVyaW9kICsgMyB3ZWVrcyA+IG5vdykgeyAvLyAyMDE3LTA2LTEzIDExYW0gR01UKzgsIGJ1dCB3ZSB3aWxsIG9ubHkgU3RhcnQgVG9rZW4gU3dhcCBhdCAycG0KICAgICAgICAgIHJldHVybiAxMjA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoY3JlYXRpb25UaW1lICsgcHJlc2FsZVBlcmlvZCArIDYgd2Vla3MgKyA2IGRheXMgKyAzIGhvdXJzICsgcHJlc2FsZVRyYW5zaXRpb25XaW5kb3cgKyAxIGRheXMgPiBub3cpIHsgLy8gMjAxNy0wNy0zMSA1cG0gR01UKzggKCsxIGRheSB3aW5kb3cgICkKICAgICAgICAgIC8vIDEgZGF5IGJ1ZmZlciB0byBhbGxvdyBvbmUgZmluYWwgdHJhbnNhY3Rpb24gZnJvbSBhbnlvbmUgdG8gY2xvc2UgZXZlcnl0aGluZwogICAgICAgICAgLy8gb3RoZXJ3aXNlIHdhbGxldCB3aWxsIHJlY2VpdmUgZXRoZXIgYnV0IHNlbmQgMCB0b2tlbnMKICAgICAgICAgIC8vIHdlIGNhbm5vdCB0aHJvdyBhcyB3ZSB3aWxsIGxvc2UgdGhlIHN0YXRlIGNoYW5nZSB0byBzdGFydCBzd2FwcGFiaWxpdHkgb2YgdG9rZW5zIAogICAgICAgICAgLy8gVGhpcyBpcyBhY3R1YWxseSBqdXN0IGEgcHJpY2UgZ3VpZGUsIGFjdHVhbCBjbG9zaW5nIGlzIGRvbmUgYXQgdGhlIFdhbGxldCBsZXZlbAogICAgICAgICAgcmV0dXJuIDEwMDsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICB9CiAgfQoKICAvLyBUaGUgZnVuY3Rpb24gbWludFRva2VucyBpcyBvbmx5IHVzYWJsZSBieSB0aGUgY2hvc2VuIHdhbGxldAogIC8vIGNvbnRyYWN0IHRvIG1pbnQgYSBudW1iZXIgb2YgdG9rZW5zIHByb3BvcnRpb25hbCB0byB0aGUKICAvLyBhbW91bnQgb2YgZXRoZXIgc2VudCB0byB0aGUgd2FsbGV0IGNvbnRyYWN0LiBUaGUgZnVuY3Rpb24KICAvLyBjYW4gb25seSBiZSBjYWxsZWQgZHVyaW5nIHRoZSB0b2tlbnN3YXAgcGVyaW9kCiAgZnVuY3Rpb24gbWludFRva2VucyhhZGRyZXNzIG5ld1Rva2VuSG9sZGVyLCB1aW50IGV0aGVyQW1vdW50KQogICAgZXh0ZXJuYWwKICAgIG9ubHlGcm9tV2FsbGV0IHsKICAgICAgICBpZiAoIXNhZmVUb011bHRpcGx5KGN1cnJlbnRTd2FwUmF0ZSgpLCBldGhlckFtb3VudCkpIHRocm93OwogICAgICAgIHVpbnQgdG9rZW5zQW1vdW50ID0gY3VycmVudFN3YXBSYXRlKCkgKiBldGhlckFtb3VudDsKCiAgICAgICAgaWYoIXNhZmVUb0FkZChfYmFsYW5jZXNbbmV3VG9rZW5Ib2xkZXJdLHRva2Vuc0Ftb3VudCApKSB0aHJvdzsKICAgICAgICBpZighc2FmZVRvQWRkKF9zdXBwbHksdG9rZW5zQW1vdW50KSkgdGhyb3c7CgogICAgICAgIGlmICgoX3N1cHBseSArIHRva2Vuc0Ftb3VudCkgPiB0b2tlbkNhcCkgdGhyb3c7CgogICAgICAgIF9iYWxhbmNlc1tuZXdUb2tlbkhvbGRlcl0gKz0gdG9rZW5zQW1vdW50OwogICAgICAgIF9zdXBwbHkgKz0gdG9rZW5zQW1vdW50OwoKICAgICAgICBUb2tlbk1pbnQobmV3VG9rZW5Ib2xkZXIsIHRva2Vuc0Ftb3VudCk7CiAgfQoKICBmdW5jdGlvbiBtaW50UmVzZXJ2ZShhZGRyZXNzIGJlbmVmaWNpYXJ5KSAKICAgIGV4dGVybmFsCiAgICBvbmx5RnJvbVdhbGxldCB7CiAgICAgICAgaWYgKHRva2VuQ2FwIDw9IF9zdXBwbHkpIHRocm93OwogICAgICAgIGlmKCFzYWZlVG9TdWIodG9rZW5DYXAsX3N1cHBseSkpIHRocm93OwogICAgICAgIHVpbnQgdG9rZW5zQW1vdW50ID0gdG9rZW5DYXAgLSBfc3VwcGx5OwoKICAgICAgICBpZighc2FmZVRvQWRkKF9iYWxhbmNlc1tiZW5lZmljaWFyeV0sIHRva2Vuc0Ftb3VudCApKSB0aHJvdzsKICAgICAgICBpZighc2FmZVRvQWRkKF9zdXBwbHksdG9rZW5zQW1vdW50KSkgdGhyb3c7CgogICAgICAgIF9iYWxhbmNlc1tiZW5lZmljaWFyeV0gKz0gdG9rZW5zQW1vdW50OwogICAgICAgIF9zdXBwbHkgKz0gdG9rZW5zQW1vdW50OwogICAgICAgIAogICAgICAgIFRva2VuTWludChiZW5lZmljaWFyeSwgdG9rZW5zQW1vdW50KTsKICB9CgogIC8vIFRoZSBmdW5jdGlvbiBkaXNhYmxlVG9rZW5Td2FwTG9jaygpIGlzIGNhbGxlZCBieSB0aGUgd2FsbGV0CiAgLy8gY29udHJhY3Qgb25jZSB0aGUgdG9rZW4gc3dhcCBoYXMgcmVhY2hlZCBpdHMgZW5kIGNvbmRpdGlvbnMKICBmdW5jdGlvbiBkaXNhYmxlVG9rZW5Td2FwTG9jaygpCiAgICBleHRlcm5hbAogICAgb25seUZyb21XYWxsZXQgewogICAgICAgIHRyYW5zZmVyU3RvcCA9IGZhbHNlOwogICAgICAgIFRva2VuU3dhcE92ZXIoKTsKICB9CgogIC8vIE9uY2UgYWN0aXZhdGVkLCBhIG5ldyB0b2tlbiBjb250cmFjdCB3aWxsIG5lZWQgdG8gYmUgY3JlYXRlZCwgbWlycm9yaW5nIHRoZSBjdXJyZW50IHRva2VuIGhvbGRpbmdzLiAKICBmdW5jdGlvbiBzdG9wVG9rZW4oKSBvbmx5RnJvbVdhbGxldCB7CiAgICB0cmFuc2ZlclN0b3AgPSB0cnVlOwogICAgRW1lcmdlbmN5U3RvcEFjdGl2YXRlZCgpOwogIH0KfQoKCi8qClRoZSBzdGFuZGFyZCBXYWxsZXQgY29udHJhY3QsIHJldHJpZXZhYmxlIGF0Cmh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9kYXBwLWJpbi9ibG9iL21hc3Rlci93YWxsZXQvd2FsbGV0LnNvbCBoYXMgYmVlbgptb2RpZmllZCB0byBpbmNsdWRlIGFkZGl0aW9uYWwgZnVuY3Rpb25hbGl0eSwgaW4gcGFydGljdWxhcjoKKiBBbiBhZGRpdGlvbmFsIHBhcmVudCBvZiB3YWxsZXQgY29udHJhY3QgY2FsbGVkIHRva2Vuc3dhcCwgaW1wbGVtZW50aW5nIGFsbW9zdAphbGwgdGhlIGNoYW5nZXM6CiAgICAtIEZ1bmN0aW9ucyBmb3Igc3RhcnRpbmcgYW5kIHN0b3BwaW5nIHRoZSB0b2tlbnN3YXAKICAgIC0gQSBzZXQtb25seS1vbmNlIGZ1bmN0aW9uIGZvciB0aGUgdG9rZW4gY29udHJhY3QKICAgIC0gYnV5VG9rZW5zKCksIHdoaWNoIGNhbGxzIG1pbnRUb2tlbnMoKSBpbiB0aGUgdG9rZW4gY29udHJhY3QKICAgIC0gTW9kaWZpZXJzIGZvciBlbmZvcmNpbmcgdG9rZW5zd2FwIHRpbWUgbGltaXRzLCBtYXggZXRoZXIgY2FwLCBhbmQgbWF4IHRva2VuIGNhcAogICAgLSB3aXRoZHJhd0V0aGVyKCksIGZvciB3aXRoZHJhd2luZyB1bnNvbGQgdG9rZW5zIGFmdGVyIHRpbWUgY2FwCiogdGhlIHdhbGxldCBmYWxsYmFjayBmdW5jdGlvbiBjYWxscyB0aGUgYnV5VG9rZW5zIGZ1bmN0aW9uCiogdGhlIHdhbGxldCBjb250cmFjdCBjYW5ub3Qgc2VsZmRlc3RydWN0IGR1cmluZyB0aGUgdG9rZW5zd2FwCiovCgpjb250cmFjdCBtdWx0aW93bmVkIHsKCgkvLyBUWVBFUwoKICAgIC8vIHN0cnVjdCBmb3IgdGhlIHN0YXR1cyBvZiBhIHBlbmRpbmcgb3BlcmF0aW9uLgogICAgc3RydWN0IFBlbmRpbmdTdGF0ZSB7CiAgICAgICAgdWludCB5ZXROZWVkZWQ7CiAgICAgICAgdWludCBvd25lcnNEb25lOwogICAgICAgIHVpbnQgaW5kZXg7CiAgICB9CgoJLy8gRVZFTlRTCgogICAgLy8gdGhpcyBjb250cmFjdCBvbmx5IGhhcyBzaXggdHlwZXMgb2YgZXZlbnRzOiBpdCBjYW4gYWNjZXB0IGEgY29uZmlybWF0aW9uLCBpbiB3aGljaCBjYXNlCiAgICAvLyB3ZSByZWNvcmQgb3duZXIgYW5kIG9wZXJhdGlvbiAoaGFzaCkgYWxvbmdzaWRlIGl0LgogICAgZXZlbnQgQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIGV2ZW50IFJldm9rZShhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbik7CiAgICAvLyBzb21lIG90aGVycyBhcmUgaW4gdGhlIGNhc2Ugb2YgYW4gb3duZXIgY2hhbmdpbmcuCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBvbGRPd25lciwgYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3Mgb2xkT3duZXIpOwogICAgLy8gdGhlIGxhc3Qgb25lIGlzIGVtaXR0ZWQgaWYgdGhlIHJlcXVpcmVkIHNpZ25hdHVyZXMgY2hhbmdlCiAgICBldmVudCBSZXF1aXJlbWVudENoYW5nZWQodWludCBuZXdSZXF1aXJlbWVudCk7CgoJLy8gTU9ESUZJRVJTCgogICAgLy8gc2ltcGxlIHNpbmdsZS1zaWcgZnVuY3Rpb24gbW9kaWZpZXIuCiAgICBtb2RpZmllciBvbmx5b3duZXIgewogICAgICAgIGlmIChpc093bmVyKG1zZy5zZW5kZXIpKQogICAgICAgICAgICBfOwogICAgfQogICAgLy8gbXVsdGktc2lnIGZ1bmN0aW9uIG1vZGlmaWVyOiB0aGUgb3BlcmF0aW9uIG11c3QgaGF2ZSBhbiBpbnRyaW5zaWMgaGFzaCBpbiBvcmRlcgogICAgLy8gdGhhdCBsYXRlciBhdHRlbXB0cyBjYW4gYmUgcmVhbGlzZWQgYXMgdGhlIHNhbWUgdW5kZXJseWluZyBvcGVyYXRpb24gYW5kCiAgICAvLyB0aHVzIGNvdW50IGFzIGNvbmZpcm1hdGlvbnMuCiAgICBtb2RpZmllciBvbmx5bWFueW93bmVycyhieXRlczMyIF9vcGVyYXRpb24pIHsKICAgICAgICBpZiAoY29uZmlybUFuZENoZWNrKF9vcGVyYXRpb24pKQogICAgICAgICAgICBfOwogICAgfQoKCS8vIE1FVEhPRFMKCiAgICAvLyBjb25zdHJ1Y3RvciBpcyBnaXZlbiBudW1iZXIgb2Ygc2lncyByZXF1aXJlZCB0byBkbyBwcm90ZWN0ZWQgIm9ubHltYW55b3duZXJzIiB0cmFuc2FjdGlvbnMKICAgIC8vIGFzIHdlbGwgYXMgdGhlIHNlbGVjdGlvbiBvZiBhZGRyZXNzZXMgY2FwYWJsZSBvZiBjb25maXJtaW5nIHRoZW0uCiAgICBmdW5jdGlvbiBtdWx0aW93bmVkKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkgewogICAgICAgIG1fbnVtT3duZXJzID0gX293bmVycy5sZW5ndGggKyAxOwogICAgICAgIG1fb3duZXJzWzFdID0gdWludChtc2cuc2VuZGVyKTsKICAgICAgICBtX293bmVySW5kZXhbdWludChtc2cuc2VuZGVyKV0gPSAxOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9vd25lcnMubGVuZ3RoOyArK2kpCiAgICAgICAgewogICAgICAgICAgICBtX293bmVyc1syICsgaV0gPSB1aW50KF9vd25lcnNbaV0pOwogICAgICAgICAgICBtX293bmVySW5kZXhbdWludChfb3duZXJzW2ldKV0gPSAyICsgaTsKICAgICAgICB9CiAgICAgICAgbV9yZXF1aXJlZCA9IF9yZXF1aXJlZDsKICAgIH0KCiAgICAvLyBSZXZva2VzIGEgcHJpb3IgY29uZmlybWF0aW9uIG9mIHRoZSBnaXZlbiBvcGVyYXRpb24KICAgIGZ1bmN0aW9uIHJldm9rZShieXRlczMyIF9vcGVyYXRpb24pIGV4dGVybmFsIHsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBtX293bmVySW5kZXhbdWludChtc2cuc2VuZGVyKV07CiAgICAgICAgLy8gbWFrZSBzdXJlIHRoZXkncmUgYW4gb3duZXIKICAgICAgICBpZiAob3duZXJJbmRleCA9PSAwKSByZXR1cm47CiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gMioqb3duZXJJbmRleDsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fcGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICBpZiAocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA+IDApIHsKICAgICAgICAgICAgcGVuZGluZy55ZXROZWVkZWQrKzsKICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lIC09IG93bmVySW5kZXhCaXQ7CiAgICAgICAgICAgIFJldm9rZShtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gUmVwbGFjZXMgYW4gb3duZXIgYF9mcm9tYCB3aXRoIGFub3RoZXIgYF90b2AuCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICBpZiAoaXNPd25lcihfdG8pKSByZXR1cm47CiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQoX2Zyb20pXTsKICAgICAgICBpZiAob3duZXJJbmRleCA9PSAwKSByZXR1cm47CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIG1fb3duZXJzW293bmVySW5kZXhdID0gdWludChfdG8pOwogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9mcm9tKV0gPSAwOwogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF90byldID0gb3duZXJJbmRleDsKICAgICAgICBPd25lckNoYW5nZWQoX2Zyb20sIF90byk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkT3duZXIoYWRkcmVzcyBfb3duZXIpIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKGlzT3duZXIoX293bmVyKSkgcmV0dXJuOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICBpZiAobV9udW1Pd25lcnMgPj0gY19tYXhPd25lcnMpCiAgICAgICAgICAgIHJlb3JnYW5pemVPd25lcnMoKTsKICAgICAgICBpZiAobV9udW1Pd25lcnMgPj0gY19tYXhPd25lcnMpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBtX251bU93bmVycysrOwogICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IHVpbnQoX293bmVyKTsKICAgICAgICBtX293bmVySW5kZXhbdWludChfb3duZXIpXSA9IG1fbnVtT3duZXJzOwogICAgICAgIE93bmVyQWRkZWQoX293bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVPd25lcihhZGRyZXNzIF9vd25lcikgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBtX293bmVySW5kZXhbdWludChfb3duZXIpXTsKICAgICAgICBpZiAob3duZXJJbmRleCA9PSAwKSByZXR1cm47CiAgICAgICAgaWYgKG1fcmVxdWlyZWQgPiBtX251bU93bmVycyAtIDEpIHJldHVybjsKCiAgICAgICAgbV9vd25lcnNbb3duZXJJbmRleF0gPSAwOwogICAgICAgIG1fb3duZXJJbmRleFt1aW50KF9vd25lcildID0gMDsKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICByZW9yZ2FuaXplT3duZXJzKCk7IC8vbWFrZSBzdXJlIG1fbnVtT3duZXIgaXMgZXF1YWwgdG8gdGhlIG51bWJlciBvZiBvd25lcnMgYW5kIGFsd2F5cyBwb2ludHMgdG8gdGhlIG9wdGltYWwgZnJlZSBzbG90CiAgICAgICAgT3duZXJSZW1vdmVkKF9vd25lcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlUmVxdWlyZW1lbnQodWludCBfbmV3UmVxdWlyZWQpIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7CiAgICAgICAgaWYgKF9uZXdSZXF1aXJlZCA+IG1fbnVtT3duZXJzKSByZXR1cm47CiAgICAgICAgbV9yZXF1aXJlZCA9IF9uZXdSZXF1aXJlZDsKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICBSZXF1aXJlbWVudENoYW5nZWQoX25ld1JlcXVpcmVkKTsKICAgIH0KCiAgICAvLyBHZXRzIGFuIG93bmVyIGJ5IDAtaW5kZXhlZCBwb3NpdGlvbiAodXNpbmcgbnVtT3duZXJzIGFzIHRoZSBjb3VudCkKICAgIGZ1bmN0aW9uIGdldE93bmVyKHVpbnQgb3duZXJJbmRleCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBhZGRyZXNzKG1fb3duZXJzW293bmVySW5kZXggKyAxXSk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9hZGRyKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1fb3duZXJJbmRleFt1aW50KF9hZGRyKV0gPiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc0NvbmZpcm1lZChieXRlczMyIF9vcGVyYXRpb24sIGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX3BlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgdWludCBvd25lckluZGV4ID0gbV9vd25lckluZGV4W3VpbnQoX293bmVyKV07CgogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGV5J3JlIGFuIG93bmVyCiAgICAgICAgaWYgKG93bmVySW5kZXggPT0gMCkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gMioqb3duZXJJbmRleDsKICAgICAgICByZXR1cm4gIShwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID09IDApOwogICAgfQoKICAgIC8vIElOVEVSTkFMIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBjb25maXJtQW5kQ2hlY2soYnl0ZXMzMiBfb3BlcmF0aW9uKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gZGV0ZXJtaW5lIHdoYXQgaW5kZXggdGhlIHByZXNlbnQgc2VuZGVyIGlzOgogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IG1fb3duZXJJbmRleFt1aW50KG1zZy5zZW5kZXIpXTsKICAgICAgICAvLyBtYWtlIHN1cmUgdGhleSdyZSBhbiBvd25lcgogICAgICAgIGlmIChvd25lckluZGV4ID09IDApIHJldHVybjsKCiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX3BlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgLy8gaWYgd2UncmUgbm90IHlldCB3b3JraW5nIG9uIHRoaXMgb3BlcmF0aW9uLCBzd2l0Y2ggb3ZlciBhbmQgcmVzZXQgdGhlIGNvbmZpcm1hdGlvbiBzdGF0dXMuCiAgICAgICAgaWYgKHBlbmRpbmcueWV0TmVlZGVkID09IDApIHsKICAgICAgICAgICAgLy8gcmVzZXQgY291bnQgb2YgY29uZmlybWF0aW9ucyBuZWVkZWQuCiAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkID0gbV9yZXF1aXJlZDsKICAgICAgICAgICAgLy8gcmVzZXQgd2hpY2ggb3duZXJzIGhhdmUgY29uZmlybWVkIChub25lKSAtIHNldCBvdXIgYml0bWFwIHRvIDAuCiAgICAgICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSA9IDA7CiAgICAgICAgICAgIHBlbmRpbmcuaW5kZXggPSBtX3BlbmRpbmdJbmRleC5sZW5ndGgrKzsKICAgICAgICAgICAgbV9wZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPSBfb3BlcmF0aW9uOwogICAgICAgIH0KICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIGJpdCB0byBzZXQgZm9yIHRoaXMgb3duZXIuCiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gMioqb3duZXJJbmRleDsKICAgICAgICAvLyBtYWtlIHN1cmUgd2UgKHRoZSBtZXNzYWdlIHNlbmRlcikgaGF2ZW4ndCBjb25maXJtZWQgdGhpcyBvcGVyYXRpb24gcHJldmlvdXNseS4KICAgICAgICBpZiAocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA9PSAwKSB7CiAgICAgICAgICAgIENvbmZpcm1hdGlvbihtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgICAgICAgICAgLy8gb2sgLSBjaGVjayBpZiBjb3VudCBpcyBlbm91Z2ggdG8gZ28gYWhlYWQuCiAgICAgICAgICAgIGlmIChwZW5kaW5nLnlldE5lZWRlZCA8PSAxKSB7CiAgICAgICAgICAgICAgICAvLyBlbm91Z2ggY29uZmlybWF0aW9uczogcmVzZXQgYW5kIHJ1biBpbnRlcmlvci4KICAgICAgICAgICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdJbmRleFttX3BlbmRpbmdbX29wZXJhdGlvbl0uaW5kZXhdOwogICAgICAgICAgICAgICAgZGVsZXRlIG1fcGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gbm90IGVub3VnaDogcmVjb3JkIHRoYXQgdGhpcyBvd25lciBpbiBwYXJ0aWN1bGFyIGNvbmZpcm1lZC4KICAgICAgICAgICAgICAgIHBlbmRpbmcueWV0TmVlZGVkLS07CiAgICAgICAgICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgfD0gb3duZXJJbmRleEJpdDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZW9yZ2FuaXplT3duZXJzKCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCBmcmVlID0gMTsKICAgICAgICB3aGlsZSAoZnJlZSA8IG1fbnVtT3duZXJzKQogICAgICAgIHsKICAgICAgICAgICAgd2hpbGUgKGZyZWUgPCBtX251bU93bmVycyAmJiBtX293bmVyc1tmcmVlXSAhPSAwKSBmcmVlKys7CiAgICAgICAgICAgIHdoaWxlIChtX251bU93bmVycyA+IDEgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdID09IDApIG1fbnVtT3duZXJzLS07CiAgICAgICAgICAgIGlmIChmcmVlIDwgbV9udW1Pd25lcnMgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdICE9IDAgJiYgbV9vd25lcnNbZnJlZV0gPT0gMCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbV9vd25lcnNbZnJlZV0gPSBtX293bmVyc1ttX251bU93bmVyc107CiAgICAgICAgICAgICAgICBtX293bmVySW5kZXhbbV9vd25lcnNbZnJlZV1dID0gZnJlZTsKICAgICAgICAgICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2xlYXJQZW5kaW5nKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgbGVuZ3RoID0gbV9wZW5kaW5nSW5kZXgubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKQogICAgICAgICAgICBpZiAobV9wZW5kaW5nSW5kZXhbaV0gIT0gMCkKICAgICAgICAgICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdbbV9wZW5kaW5nSW5kZXhbaV1dOwogICAgICAgIGRlbGV0ZSBtX3BlbmRpbmdJbmRleDsKICAgIH0KCiAgIAkvLyBGSUVMRFMKCiAgICAvLyB0aGUgbnVtYmVyIG9mIG93bmVycyB0aGF0IG11c3QgY29uZmlybSB0aGUgc2FtZSBvcGVyYXRpb24gYmVmb3JlIGl0IGlzIHJ1bi4KICAgIHVpbnQgcHVibGljIG1fcmVxdWlyZWQ7CiAgICAvLyBwb2ludGVyIHVzZWQgdG8gZmluZCBhIGZyZWUgc2xvdCBpbiBtX293bmVycwogICAgdWludCBwdWJsaWMgbV9udW1Pd25lcnM7CgogICAgLy8gbGlzdCBvZiBvd25lcnMKICAgIHVpbnRbMjU2XSBtX293bmVyczsKICAgIHVpbnQgY29uc3RhbnQgY19tYXhPd25lcnMgPSAyNTA7CiAgICAvLyBpbmRleCBvbiB0aGUgbGlzdCBvZiBvd25lcnMgdG8gYWxsb3cgcmV2ZXJzZSBsb29rdXAKICAgIG1hcHBpbmcodWludCA9PiB1aW50KSBtX293bmVySW5kZXg7CiAgICAvLyB0aGUgb25nb2luZyBvcGVyYXRpb25zLgogICAgbWFwcGluZyhieXRlczMyID0+IFBlbmRpbmdTdGF0ZSkgbV9wZW5kaW5nOwogICAgYnl0ZXMzMltdIG1fcGVuZGluZ0luZGV4Owp9CgovLyBpbmhlcml0YWJsZSAicHJvcGVydHkiIGNvbnRyYWN0IHRoYXQgZW5hYmxlcyBtZXRob2RzIHRvIGJlIHByb3RlY3RlZCBieSBwbGFjaW5nIGEgbGluZWFyIGxpbWl0IChzcGVjaWZpYWJsZSkKLy8gb24gYSBwYXJ0aWN1bGFyIHJlc291cmNlIHBlciBjYWxlbmRhciBkYXkuIGlzIG11bHRpb3duZWQgdG8gYWxsb3cgdGhlIGxpbWl0IHRvIGJlIGFsdGVyZWQuIHJlc291cmNlIHRoYXQgbWV0aG9kCi8vIHVzZXMgaXMgc3BlY2lmaWVkIGluIHRoZSBtb2RpZmllci4KY29udHJhY3QgZGF5bGltaXQgaXMgbXVsdGlvd25lZCB7CgoJLy8gTU9ESUZJRVJTCgogICAgLy8gc2ltcGxlIG1vZGlmaWVyIGZvciBkYWlseSBsaW1pdC4KICAgIG1vZGlmaWVyIGxpbWl0ZWREYWlseSh1aW50IF92YWx1ZSkgewogICAgICAgIGlmICh1bmRlckxpbWl0KF92YWx1ZSkpCiAgICAgICAgICAgIF87CiAgICB9CgoJLy8gTUVUSE9EUwoKICAgIC8vIGNvbnN0cnVjdG9yIC0gc3RvcmVzIGluaXRpYWwgZGFpbHkgbGltaXQgYW5kIHJlY29yZHMgdGhlIHByZXNlbnQgZGF5J3MgaW5kZXguCiAgICBmdW5jdGlvbiBkYXlsaW1pdCh1aW50IF9saW1pdCkgewogICAgICAgIG1fZGFpbHlMaW1pdCA9IF9saW1pdDsKICAgICAgICBtX2xhc3REYXkgPSB0b2RheSgpOwogICAgfQogICAgLy8gKHJlKXNldHMgdGhlIGRhaWx5IGxpbWl0LiBuZWVkcyBtYW55IG9mIHRoZSBvd25lcnMgdG8gY29uZmlybS4gZG9lc24ndCBhbHRlciB0aGUgYW1vdW50IGFscmVhZHkgc3BlbnQgdG9kYXkuCiAgICBmdW5jdGlvbiBzZXREYWlseUxpbWl0KHVpbnQgX25ld0xpbWl0KSBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgZXh0ZXJuYWwgewogICAgICAgIG1fZGFpbHlMaW1pdCA9IF9uZXdMaW1pdDsKICAgIH0KICAgIC8vIHJlc2V0cyB0aGUgYW1vdW50IGFscmVhZHkgc3BlbnQgdG9kYXkuIG5lZWRzIG1hbnkgb2YgdGhlIG93bmVycyB0byBjb25maXJtLgogICAgZnVuY3Rpb24gcmVzZXRTcGVudFRvZGF5KCkgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpIGV4dGVybmFsIHsKICAgICAgICBtX3NwZW50VG9kYXkgPSAwOwogICAgfQoKICAgIC8vIElOVEVSTkFMIE1FVEhPRFMKCiAgICAvLyBjaGVja3MgdG8gc2VlIGlmIHRoZXJlIGlzIGF0IGxlYXN0IGBfdmFsdWVgIGxlZnQgZnJvbSB0aGUgZGFpbHkgbGltaXQgdG9kYXkuIGlmIHRoZXJlIGlzLCBzdWJ0cmFjdHMgaXQgYW5kCiAgICAvLyByZXR1cm5zIHRydWUuIG90aGVyd2lzZSBqdXN0IHJldHVybnMgZmFsc2UuCiAgICBmdW5jdGlvbiB1bmRlckxpbWl0KHVpbnQgX3ZhbHVlKSBpbnRlcm5hbCBvbmx5b3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIHJlc2V0IHRoZSBzcGVuZCBsaW1pdCBpZiB3ZSdyZSBvbiBhIGRpZmZlcmVudCBkYXkgdG8gbGFzdCB0aW1lLgogICAgICAgIGlmICh0b2RheSgpID4gbV9sYXN0RGF5KSB7CiAgICAgICAgICAgIG1fc3BlbnRUb2RheSA9IDA7CiAgICAgICAgICAgIG1fbGFzdERheSA9IHRvZGF5KCk7CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGlmIGl0J3Mgc2VuZGluZyBub3RoaW5nICh3aXRoIG9yIHdpdGhvdXQgZGF0YSkuIFRoaXMgbmVlZHMgTXVsdGl0cmFuc2FjdAogICAgICAgIGlmIChfdmFsdWUgPT0gMCkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgdGhlcmUncyBlbm91Z2ggbGVmdCAtIGlmIHNvLCBzdWJ0cmFjdCBhbmQgcmV0dXJuIHRydWUuCiAgICAgICAgLy8gb3ZlcmZsb3cgcHJvdGVjdGlvbiAgICAgICAgICAgICAgICAgICAgLy8gZGFpbHlMaW1pdCBjaGVjawogICAgICAgIGlmIChtX3NwZW50VG9kYXkgKyBfdmFsdWUgPj0gbV9zcGVudFRvZGF5ICYmIG1fc3BlbnRUb2RheSArIF92YWx1ZSA8PSBtX2RhaWx5TGltaXQpIHsKICAgICAgICAgICAgbV9zcGVudFRvZGF5ICs9IF92YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIGRldGVybWluZXMgdG9kYXkncyBpbmRleC4KICAgIGZ1bmN0aW9uIHRvZGF5KCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7IHJldHVybiBub3cgLyAxIGRheXM7IH0KCgkvLyBGSUVMRFMKCiAgICB1aW50IHB1YmxpYyBtX2RhaWx5TGltaXQ7CiAgICB1aW50IHB1YmxpYyBtX3NwZW50VG9kYXk7CiAgICB1aW50IHB1YmxpYyBtX2xhc3REYXk7Cn0KCi8vIGludGVyZmFjZSBjb250cmFjdCBmb3IgbXVsdGlzaWcgcHJveHkgY29udHJhY3RzOyBzZWUgYmVsb3cgZm9yIGRvY3MuCmNvbnRyYWN0IG11bHRpc2lnIHsKCgkvLyBFVkVOVFMKCiAgICAvLyBsb2dnZWQgZXZlbnRzOgogICAgLy8gRnVuZHMgaGFzIGFycml2ZWQgaW50byB0aGUgd2FsbGV0IChyZWNvcmQgaG93IG11Y2gpLgogICAgZXZlbnQgRGVwb3NpdChhZGRyZXNzIF9mcm9tLCB1aW50IHZhbHVlKTsKICAgIC8vIFNpbmdsZSB0cmFuc2FjdGlvbiBnb2luZyBvdXQgb2YgdGhlIHdhbGxldCAocmVjb3JkIHdobyBzaWduZWQgZm9yIGl0LCBob3cgbXVjaCwgYW5kIHRvIHdob20gaXQncyBnb2luZykuCiAgICBldmVudCBTaW5nbGVUcmFuc2FjdChhZGRyZXNzIG93bmVyLCB1aW50IHZhbHVlLCBhZGRyZXNzIHRvLCBieXRlcyBkYXRhKTsKICAgIC8vIE11bHRpLXNpZyB0cmFuc2FjdGlvbiBnb2luZyBvdXQgb2YgdGhlIHdhbGxldCAocmVjb3JkIHdobyBzaWduZWQgZm9yIGl0IGxhc3QsIHRoZSBvcGVyYXRpb24gaGFzaCwgaG93IG11Y2gsIGFuZCB0byB3aG9tIGl0J3MgZ29pbmcpLgogICAgZXZlbnQgTXVsdGlUcmFuc2FjdChhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbiwgdWludCB2YWx1ZSwgYWRkcmVzcyB0bywgYnl0ZXMgZGF0YSk7CiAgICAvLyBDb25maXJtYXRpb24gc3RpbGwgbmVlZGVkIGZvciBhIHRyYW5zYWN0aW9uLgogICAgZXZlbnQgQ29uZmlybWF0aW9uTmVlZGVkKGJ5dGVzMzIgb3BlcmF0aW9uLCBhZGRyZXNzIGluaXRpYXRvciwgdWludCB2YWx1ZSwgYWRkcmVzcyB0bywgYnl0ZXMgZGF0YSk7CgogICAgLy8gRlVOQ1RJT05TCgogICAgLy8gVE9ETzogZG9jdW1lbnQKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGV4ZWN1dGUoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgZXh0ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMik7CiAgICBmdW5jdGlvbiBjb25maXJtKGJ5dGVzMzIgX2gpIHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCB0b2tlbnN3YXAgaXMgbXVsdGlzaWcsIG11bHRpb3duZWQgewogICAgVG9rZW4gcHVibGljIHRva2VuQ3RyOwogICAgYm9vbCBwdWJsaWMgdG9rZW5Td2FwOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgUFJFU0FMRV9MRU5HVEggPSAzIGRheXM7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBUUkFOU0lUSU9OX1dJTkRPVyA9IDMgaG91cnM7IC8vIFdlIHdpbGwgdHVybiBvbiB0b2tlblN3YXAgaW4gdGhpcyBwZXJpb2QgYW5kIGl0IHdpbGwgMTIwIEZZTiAvIEVUSAogICAgdWludCBwdWJsaWMgY29uc3RhbnQgU1dBUF9MRU5HVEggPSBQUkVTQUxFX0xFTkdUSCArIFRSQU5TSVRJT05fV0lORE9XICsgNiB3ZWVrcyArIDYgZGF5cyArIDMgaG91cnM7CiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfRVRIID0gNzUwMDAgZXRoZXI7IC8vIEhhcmQgY2FwLCBjYXBwZWQgb3RoZXJ3aXNlIGJ5IHRvdGFsIHRva2VucyBzb2xkIChtYXggNy41TSBGWU4pCiAgICB1aW50IHB1YmxpYyBhbW91bnRSYWlzZWQ7CgogICAgbW9kaWZpZXIgaXNVbmRlclByZXNhbGVNaW5pbXVtIHsKICAgICAgICBpZiAodG9rZW5DdHIuY3JlYXRpb25UaW1lKCkgKyBQUkVTQUxFX0xFTkdUSCA+IG5vdykgewogICAgICAgICAgICBpZiAobXNnLnZhbHVlIDwgMjAgZXRoZXIpIHRocm93OwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzWmVyb1ZhbHVlIHsKICAgICAgICBpZiAobXNnLnZhbHVlID09IDApIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNPdmVyQ2FwIHsKICAgIAlpZiAoYW1vdW50UmFpc2VkICsgbXNnLnZhbHVlID4gTUFYX0VUSCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc092ZXJUb2tlbkNhcCB7CiAgICAgICAgaWYgKCFzYWZlVG9NdWx0aXBseSh0b2tlbkN0ci5jdXJyZW50U3dhcFJhdGUoKSwgbXNnLnZhbHVlKSkgdGhyb3c7CiAgICAgICAgdWludCB0b2tlbnNBbW91bnQgPSB0b2tlbkN0ci5jdXJyZW50U3dhcFJhdGUoKSAqIG1zZy52YWx1ZTsKICAgICAgICBpZighc2FmZVRvQWRkKHRva2VuQ3RyLnRvdGFsU3VwcGx5KCksdG9rZW5zQW1vdW50KSkgdGhyb3c7CiAgICAgICAgaWYgKHRva2VuQ3RyLnRvdGFsU3VwcGx5KCkgKyB0b2tlbnNBbW91bnQgPiB0b2tlbkN0ci50b2tlbkNhcCgpKSB0aHJvdzsKICAgICAgICBfOwoKICAgIH0KCiAgICBtb2RpZmllciBpc1N3YXBTdG9wcGVkIHsKICAgICAgICBpZiAoIXRva2VuU3dhcCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBhcmVDb25kaXRpb25zU2F0aXNmaWVkIHsKICAgICAgICBfOwogICAgICAgIC8vIEVuZCB0b2tlbiBzd2FwIGlmIHNhbGUgcGVyaW9kIGVuZGVkCiAgICAgICAgLy8gV2UgY2FuJ3QgdGhyb3cgdG8gcmV2ZXJzZSB0aGUgYW1vdW50IHNlbnQgaW4gb3Igd2Ugd2lsbCBsb3NlIHN0YXRlCiAgICAgICAgLy8gLCBzbyB3ZSB3aWxsIGFjY2VwdCBpdCBldmVuIHRob3VnaCBpZiBpdCBpcyBhZnRlciBjcm93ZHNhbGUKICAgICAgICBpZiAodG9rZW5DdHIuY3JlYXRpb25UaW1lKCkgKyBTV0FQX0xFTkdUSCA8IG5vdykgewogICAgICAgICAgICB0b2tlbkN0ci5kaXNhYmxlVG9rZW5Td2FwTG9jaygpOwogICAgICAgICAgICB0b2tlblN3YXAgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gQ2hlY2sgaWYgY2FwIGhhcyBiZWVuIHJlYWNoZWQgaW4gdGhpcyB0eAogICAgICAgIGlmIChhbW91bnRSYWlzZWQgPT0gTUFYX0VUSCkgewogICAgICAgICAgICB0b2tlbkN0ci5kaXNhYmxlVG9rZW5Td2FwTG9jaygpOwogICAgICAgICAgICB0b2tlblN3YXAgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGlmIHRva2VuIGNhcCBoYXMgYmVlbiByZWFjaCBpbiB0aGlzIHR4CiAgICAgICAgaWYgKHRva2VuQ3RyLnRvdGFsU3VwcGx5KCkgPT0gdG9rZW5DdHIudG9rZW5DYXAoKSkgewogICAgICAgICAgICB0b2tlbkN0ci5kaXNhYmxlVG9rZW5Td2FwTG9jaygpOwogICAgICAgICAgICB0b2tlblN3YXAgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQSBoZWxwZXIgdG8gbm90aWZ5IGlmIG92ZXJmbG93IG9jY3VycyBmb3IgYWRkaXRpb24KICAgIGZ1bmN0aW9uIHNhZmVUb0FkZCh1aW50IGEsIHVpbnQgYikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgIHJldHVybiAoYSArIGIgPj0gYSAmJiBhICsgYiA+PSBiKTsKICAgIH0KICAKICAgIC8vIEEgaGVscGVyIHRvIG5vdGlmeSBpZiBvdmVyZmxvdyBvY2N1cnMgZm9yIG11bHRpcGxpY2F0aW9uCiAgICBmdW5jdGlvbiBzYWZlVG9NdWx0aXBseSh1aW50IF9hLCB1aW50IF9iKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgcmV0dXJuIChfYiA9PSAwIHx8ICgoX2EgKiBfYikgLyBfYikgPT0gX2EpOwogICAgfQoKCiAgICBmdW5jdGlvbiBzdGFydFRva2VuU3dhcCgpIG9ubHlvd25lciB7CiAgICAgICAgdG9rZW5Td2FwID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdG9wVG9rZW5Td2FwKCkgb25seW93bmVyIHsKICAgICAgICB0b2tlblN3YXAgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRUb2tlbkNvbnRyYWN0KGFkZHJlc3MgbmV3VG9rZW5Db250cmFjdEFkZHIpIG9ubHlvd25lciB7CiAgICAgICAgaWYgKG5ld1Rva2VuQ29udHJhY3RBZGRyID09IGFkZHJlc3MoMHgwKSkgdGhyb3c7CiAgICAgICAgLy8gQWxsb3cgc2V0dGluZyBvbmx5IG9uY2UKICAgICAgICBpZiAodG9rZW5DdHIgIT0gYWRkcmVzcygweDApKSB0aHJvdzsKCiAgICAgICAgdG9rZW5DdHIgPSBUb2tlbihuZXdUb2tlbkNvbnRyYWN0QWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KQogICAgcGF5YWJsZQogICAgaXNVbmRlclByZXNhbGVNaW5pbXVtCiAgICBpc1plcm9WYWx1ZQogICAgaXNPdmVyQ2FwCiAgICBpc092ZXJUb2tlbkNhcAogICAgaXNTd2FwU3RvcHBlZAogICAgYXJlQ29uZGl0aW9uc1NhdGlzZmllZCB7CiAgICAgICAgRGVwb3NpdChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgICAgIHRva2VuQ3RyLm1pbnRUb2tlbnMoX2JlbmVmaWNpYXJ5LCBtc2cudmFsdWUpOwogICAgICAgIGlmICghc2FmZVRvQWRkKGFtb3VudFJhaXNlZCwgbXNnLnZhbHVlKSkgdGhyb3c7CiAgICAgICAgYW1vdW50UmFpc2VkICs9IG1zZy52YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Jlc2VydmUoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIG9ubHlvd25lciB7CgkgICAgaWYgKHRva2VuQ3RyLmNyZWF0aW9uVGltZSgpICsgU1dBUF9MRU5HVEggPCBub3cpIHsKICAgICAgICAgICAgdG9rZW5DdHIubWludFJlc2VydmUoX2JlbmVmaWNpYXJ5KTsKICAgICAgICB9CiAgICB9IAp9CgovLyB1c2FnZToKLy8gYnl0ZXMzMiBoID0gV2FsbGV0KHcpLmZyb20ob25lT3duZXIpLnRyYW5zYWN0KHRvLCB2YWx1ZSwgZGF0YSk7Ci8vIFdhbGxldCh3KS5mcm9tKGFub3RoZXJPd25lcikuY29uZmlybShoKTsKY29udHJhY3QgV2FsbGV0IGlzIG11bHRpc2lnLCBtdWx0aW93bmVkLCBkYXlsaW1pdCwgdG9rZW5zd2FwIHsKCgkvLyBUWVBFUwoKICAgIC8vIFRyYW5zYWN0aW9uIHN0cnVjdHVyZSB0byByZW1lbWJlciBkZXRhaWxzIG9mIHRyYW5zYWN0aW9uIGxlc3QgaXQgbmVlZCBiZSBzYXZlZCBmb3IgYSBsYXRlciBjYWxsLgogICAgc3RydWN0IFRyYW5zYWN0aW9uIHsKICAgICAgICBhZGRyZXNzIHRvOwogICAgICAgIHVpbnQgdmFsdWU7CiAgICAgICAgYnl0ZXMgZGF0YTsKICAgIH0KCiAgICAvLyBNRVRIT0RTCgogICAgLy8gY29uc3RydWN0b3IgLSBqdXN0IHBhc3Mgb24gdGhlIG93bmVyIGFycmF5IHRvIHRoZSBtdWx0aW93bmVkIGFuZAogICAgLy8gdGhlIGxpbWl0IHRvIGRheWxpbWl0CiAgICBmdW5jdGlvbiBXYWxsZXQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3JlcXVpcmVkLCB1aW50IF9kYXlsaW1pdCkKICAgICAgICAgICAgbXVsdGlvd25lZChfb3duZXJzLCBfcmVxdWlyZWQpIGRheWxpbWl0KF9kYXlsaW1pdCkgewogICAgfQoKICAgIC8vIGtpbGxzIHRoZSBjb250cmFjdCBzZW5kaW5nIGV2ZXJ5dGhpbmcgdG8gYF90b2AuCiAgICBmdW5jdGlvbiBraWxsKGFkZHJlc3MgX3RvKSBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgZXh0ZXJuYWwgewogICAgICAgIC8vIGVuc3VyZSBvd25lcnMgY2FuJ3QgcHJlbWF0dXJlbHkgc3RvcCB0b2tlbiBzYWxlCiAgICAgICAgaWYgKHRva2VuU3dhcCkgdGhyb3c7CiAgICAgICAgLy8gZW5zdXJlIG93bmVycyBjYW4ndCBraWxsIHdhbGxldCB3aXRob3V0IHN0b3BwaW5nIHRva2VuCiAgICAgICAgLy8gIG90aGVyd2lzZSB0b2tlbiBjYW4gbmV2ZXIgYmUgc3RvcHBlZAogICAgICAgIGlmICh0b2tlbkN0ci50cmFuc2ZlclN0b3AoKSA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgc3VpY2lkZShfdG8pOwogICAgfQoKICAgIC8vIEFjdGl2YXRlcyBFbWVyZ2VuY3kgU3RvcCBmb3IgVG9rZW4KICAgIGZ1bmN0aW9uIHN0b3BUb2tlbigpIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKSBleHRlcm5hbCB7CiAgICAgICB0b2tlbkN0ci5zdG9wVG9rZW4oKTsKICAgIH0KCiAgICAvLyBnZXRzIGNhbGxlZCB3aGVuIG5vIG90aGVyIGZ1bmN0aW9uIG1hdGNoZXMKICAgIGZ1bmN0aW9uKCkKICAgIHBheWFibGUgewogICAgICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvLyBPdXRzaWRlLXZpc2libGUgdHJhbnNhY3QgZW50cnkgcG9pbnQuIEV4ZWN1dGVzIHRyYW5zYWN0aW9uIGltbWVkaWF0ZWx5IGlmIGJlbG93IGRhaWx5IHNwZW5kIGxpbWl0LgogICAgLy8gSWYgbm90LCBnb2VzIGludG8gbXVsdGlzaWcgcHJvY2Vzcy4gV2UgcHJvdmlkZSBhIGhhc2ggb24gcmV0dXJuIHRvIGFsbG93IHRoZSBzZW5kZXIgdG8gcHJvdmlkZQogICAgLy8gc2hvcnRjdXRzIGZvciB0aGUgb3RoZXIgY29uZmlybWF0aW9ucyAoYWxsb3dpbmcgdGhlbSB0byBhdm9pZCByZXBsaWNhdGluZyB0aGUgX3RvLCBfdmFsdWUKICAgIC8vIGFuZCBfZGF0YSBhcmd1bWVudHMpLiBUaGV5IHN0aWxsIGdldCB0aGUgb3B0aW9uIG9mIHVzaW5nIHRoZW0gaWYgdGhleSB3YW50LCBhbnl3YXlzLgogICAgZnVuY3Rpb24gZXhlY3V0ZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBleHRlcm5hbCBvbmx5b3duZXIgcmV0dXJucyAoYnl0ZXMzMiBfcikgewogICAgICAgIC8vIERpc2FsbG93IHRoZSB3YWxsZXQgY29udHJhY3QgZnJvbSBjYWxsaW5nIHRva2VuIGNvbnRyYWN0IG9uY2UgaXQncyBzZXQKICAgICAgICAvLyBzbyB0b2tlbnMgY2FuJ3QgYmUgbWludGVkIGFyYml0cmFyaWx5IG9uY2UgdGhlIHNhbGUgc3RhcnRzLgogICAgICAgIC8vIFRva2VucyBjYW4gYmUgbWludGVkIGZvciBwcmVtaW5lIGJlZm9yZSB0aGUgc2FsZSBvcGVucyBhbmQgdG9rZW5DdHIgaXMgc2V0LgogICAgICAgIGlmIChfdG8gPT0gYWRkcmVzcyh0b2tlbkN0cikpIHRocm93OwoKICAgICAgICAvLyBmaXJzdCwgdGFrZSB0aGUgb3Bwb3J0dW5pdHkgdG8gY2hlY2sgdGhhdCB3ZSdyZSB1bmRlciB0aGUgZGFpbHkgbGltaXQuCiAgICAgICAgaWYgKHVuZGVyTGltaXQoX3ZhbHVlKSkgewogICAgICAgICAgICBTaW5nbGVUcmFuc2FjdChtc2cuc2VuZGVyLCBfdmFsdWUsIF90bywgX2RhdGEpOwogICAgICAgICAgICAvLyB5ZXMgLSBqdXN0IGV4ZWN1dGUgdGhlIGNhbGwuCiAgICAgICAgICAgIGlmKCFfdG8uY2FsbC52YWx1ZShfdmFsdWUpKF9kYXRhKSkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyBkZXRlcm1pbmUgb3VyIG9wZXJhdGlvbiBoYXNoLgogICAgICAgIF9yID0gc2hhMyhtc2cuZGF0YSwgYmxvY2subnVtYmVyKTsKICAgICAgICBpZiAoIWNvbmZpcm0oX3IpICYmIG1fdHhzW19yXS50byA9PSAwKSB7CiAgICAgICAgICAgIG1fdHhzW19yXS50byA9IF90bzsKICAgICAgICAgICAgbV90eHNbX3JdLnZhbHVlID0gX3ZhbHVlOwogICAgICAgICAgICBtX3R4c1tfcl0uZGF0YSA9IF9kYXRhOwogICAgICAgICAgICBDb25maXJtYXRpb25OZWVkZWQoX3IsIG1zZy5zZW5kZXIsIF92YWx1ZSwgX3RvLCBfZGF0YSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGNvbmZpcm0gYSB0cmFuc2FjdGlvbiB0aHJvdWdoIGp1c3QgdGhlIGhhc2guIHdlIHVzZSB0aGUgcHJldmlvdXMgdHJhbnNhY3Rpb25zIG1hcCwgbV90eHMsIGluIG9yZGVyCiAgICAvLyB0byBkZXRlcm1pbmUgdGhlIGJvZHkgb2YgdGhlIHRyYW5zYWN0aW9uIGZyb20gdGhlIGhhc2ggcHJvdmlkZWQuCiAgICBmdW5jdGlvbiBjb25maXJtKGJ5dGVzMzIgX2gpIG9ubHltYW55b3duZXJzKF9oKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKG1fdHhzW19oXS50byAhPSAwKSB7CiAgICAgICAgICAgIGlmICghbV90eHNbX2hdLnRvLmNhbGwudmFsdWUobV90eHNbX2hdLnZhbHVlKShtX3R4c1tfaF0uZGF0YSkpICAgLy8gQnVnZml4OiBJZiBzdWNjZXNzZnVsLCBNdWx0aVRyYW5zYWN0IGV2ZW50IHNob3VsZCBmaXJlOyBpZiB1bnN1Y2Nlc3NmdWwsIHdlIHNob3VsZCB0aHJvdwogICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICAgIE11bHRpVHJhbnNhY3QobXNnLnNlbmRlciwgX2gsIG1fdHhzW19oXS52YWx1ZSwgbV90eHNbX2hdLnRvLCBtX3R4c1tfaF0uZGF0YSk7CiAgICAgICAgICAgIGRlbGV0ZSBtX3R4c1tfaF07CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBJTlRFUk5BTCBNRVRIT0RTCgogICAgZnVuY3Rpb24gY2xlYXJQZW5kaW5nKCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgbGVuZ3RoID0gbV9wZW5kaW5nSW5kZXgubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKQogICAgICAgICAgICBkZWxldGUgbV90eHNbbV9wZW5kaW5nSW5kZXhbaV1dOwogICAgICAgIHN1cGVyLmNsZWFyUGVuZGluZygpOwogICAgfQoKCS8vIEZJRUxEUwoKICAgIC8vIHBlbmRpbmcgdHJhbnNhY3Rpb25zIHdlIGhhdmUgYXQgcHJlc2VudC4KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gVHJhbnNhY3Rpb24pIG1fdHhzOwp9'.
	

]
