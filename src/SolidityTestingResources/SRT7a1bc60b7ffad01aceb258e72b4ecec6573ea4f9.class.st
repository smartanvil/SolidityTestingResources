Class {
	#name : #SRT7a1bc60b7ffad01aceb258e72b4ecec6573ea4f9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7a1bc60b7ffad01aceb258e72b4ecec6573ea4f9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIEV2ZW5EaXN0cm9Dcm93ZHNhbGVMaWIKICogQGF1dGhvciBNb2R1bGFyIEluYywgaHR0cHM6Ly9tb2R1bGFyLm5ldHdvcmsKICoKICogdmVyc2lvbiAyLjIuMQogKiBDb3B5cmlnaHQgKGMpIDIwMTcgTW9kdWxhciBJbmMKICogVGhlIE1JVCBMaWNlbnNlIChNSVQpCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9Nb2R1bGFyLU5ldHdvcmsvZXRoZXJldW0tbGlicmFyaWVzL2Jsb2IvbWFzdGVyL0xJQ0VOU0UKICoKICogVGhlIEV2ZW5EaXN0cm9Dcm93ZHNhbGUgTGlicmFyeSBwcm92aWRlcyBmdW5jdGlvbmFsaXR5IHRvIGNyZWF0ZSBhIGluaXRpYWwgY29pbiBvZmZlcmluZwogKiBmb3IgYSBzdGFuZGFyZCB0b2tlbiBzYWxlIHdpdGggaGlnaCBkZW1hbmQgd2hlcmUgdGhlIGFtb3VudCBvZiBldGhlciBhIHNpbmdsZSBhZGRyZXNzCiAqIGNhbiBjb250cmlidXRlIGlzIGNhbGN1bGF0ZWQgYnkgZGl2aWRpbmcgdGhlIHNhbGUncyBjb250cmlidXRpb24gY2FwIGJ5IHRoZSBudW1iZXIKICogb2YgYWRkcmVzc2VzIHdobyByZWdpc3RlciBiZWZvcmUgdGhlIHNhbGUgc3RhcnRzCiAqCiAqIE1vZHVsYXIgcHJvdmlkZXMgc21hcnQgY29udHJhY3Qgc2VydmljZXMgYW5kIHNlY3VyaXR5IHJldmlld3MgZm9yIGNvbnRyYWN0CiAqIGRlcGxveW1lbnRzIGluIGFkZGl0aW9uIHRvIHdvcmtpbmcgb24gb3BlbiBzb3VyY2UgcHJvamVjdHMgaW4gdGhlIEV0aGVyZXVtCiAqIGNvbW11bml0eS4gT3VyIHB1cnBvc2UgaXMgdG8gdGVzdCwgZG9jdW1lbnQsIGFuZCBkZXBsb3kgcmV1c2FibGUgY29kZSBvbnRvIHRoZQogKiBibG9ja2NoYWluIGFuZCBpbXByb3ZlIGJvdGggc2VjdXJpdHkgYW5kIHVzYWJpbGl0eS4gV2UgYWxzbyBlZHVjYXRlIG5vbi1wcm9maXRzLAogKiBzY2hvb2xzLCBhbmQgb3RoZXIgY29tbXVuaXR5IG1lbWJlcnMgYWJvdXQgdGhlIGFwcGxpY2F0aW9uIG9mIGJsb2NrY2hhaW4KICogdGVjaG5vbG9neS4gRm9yIGZ1cnRoZXIgaW5mb3JtYXRpb246IG1vZHVsYXIubmV0d29yawogKgogKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwogKiBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCiAqIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4KICogSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkKICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwKICogVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUKICogU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAqLwoKbGlicmFyeSBFdmVuRGlzdHJvQ3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CiAgdXNpbmcgQ3Jvd2RzYWxlTGliIGZvciBDcm93ZHNhbGVMaWIuQ3Jvd2RzYWxlU3RvcmFnZTsKCiAgc3RydWN0IEV2ZW5EaXN0cm9Dcm93ZHNhbGVTdG9yYWdlIHsKCiAgCUNyb3dkc2FsZUxpYi5Dcm93ZHNhbGVTdG9yYWdlIGJhc2U7IC8vIGJhc2Ugc3RvcmFnZSBmcm9tIENyb3dkc2FsZUxpYgoKICAgIC8vIG1hcHBpbmcgc2hvd2luZyB3aGljaCBhZGRyZXNzZXMgaGF2ZSByZWdpc3RlcmVkIGZvciB0aGUgc2FsZS4gY2FuIG9ubHkgYmUgY2hhbmdlZCBieSB0aGUgb3duZXIKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgaXNSZWdpc3RlcmVkOwoKICAgIC8vIHRyYWNrcyB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucyBib3VnaHQgZm9yIGVhY2ggYWRkcmVzcwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHRva2Vuc0JvdWdodDsKCiAgICB1aW50MjU2IG51bVJlZ2lzdGVyZWQ7IC8vIHJlY29yZHMgaG93IG1hbnkgYWRkcmVzc2VzIGhhdmUgcmVnaXN0ZXJlZAogICAgdWludDI1NiBhZGRyZXNzVG9rZW5DYXA7IC8vIGNhcCBvbiBob3cgbXVjaCB3ZWkgYW4gYWRkcmVzcyBjYW4gY29udHJpYnV0ZSBpbiB0aGUgc2FsZQogICAgYm9vbCBzdGF0aWNDYXA7IC8vIHRydWUgaWYgdGhlIGdpdmVuIGFkZHJlc3MgY2FwIGFtb3VudHMgYXJlIHNldCBvbiBpbml0aWFsaXphdGlvbgogIH0KCgogIGV2ZW50IExvZ1Rva2Vuc0JvdWdodChhZGRyZXNzIGJ1eWVyLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgTG9nVG9rZW5QcmljZUNoYW5nZSh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nRXJyb3JNc2codWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKICAvLyBMb2dzIHdoZW4gYSB1c2VyIGlzIHJlZ2lzdGVyZWQgaW4gdGhlIHN5c3RlbSBiZWZvcmUgdGhlIHNhbGUKICBldmVudCBMb2dVc2VyUmVnaXN0ZXJlZChhZGRyZXNzIHJlZ2lzdHJhbnQpOwoKICAvLyBMb2dzIHdoZW4gYSB1c2VyIGlzIHVucmVnaXN0ZXJlZCBmcm9tIHRoZSBzeXN0ZW0gYmVmb3JlIHRoZSBzYWxlCiAgZXZlbnQgTG9nVXNlclVuUmVnaXN0ZXJlZChhZGRyZXNzIHJlZ2lzdHJhbnQpOwoKICAvLyBMb2dzIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3Igd2l0aCB1c2VyIHJlZ2lzdHJhdGlvbgogIGV2ZW50IExvZ1JlZ0Vycm9yKGFkZHJlc3MgdXNlciwgc3RyaW5nIE1zZyk7CgogIC8vIExvZ3Mgd2hlbiB0aGVyZSBpcyBhbiBpbmNyZWFzZSBpbiB0aGUgY29udHJpYnV0aW9uIGNhcCBwZXIgYWRkcmVzcwogIGV2ZW50IExvZ0FkZHJlc3NUb2tlbkNhcENoYW5nZSh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CgogIC8vIExvZ3Mgd2hlbiB0aGUgYWRkcmVzcyBjYXAgaXMgaW5pdGlhbGx5IGNhbGN1bGF0ZWQKICBldmVudCBMb2dBZGRyZXNzVG9rZW5DYXBDYWxjdWxhdGVkKHVpbnQyNTYgbnVtUmVnaXN0ZXJlZCwgdWludDI1NiBjYXAsIHN0cmluZyBNc2cpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIHRva2Vucy9FVEggYXQgdGhhdCB0aW1lLAogIC8vLyAzIGlzIGFkZHJlc3MgcHVyY2hhc2UgY2FwIGF0IHRoYXQgdGltZSwgMCBpZiBubyBhZGRyZXNzIGNhcAogIC8vLyBAcGFyYW0gX2VuZFRpbWUgVGltZXN0YW1wIG9mIHNhbGUgZW5kIHRpbWUKICAvLy8gQHBhcmFtIF9wZXJjZW50QnVybiBQZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgLy8vIEBwYXJhbSBfc3RhdGljQ2FwIFdoZXRoZXIgb3Igbm90IHRoZSBhZGRyZXNzIGNhcCBpcyBnb2luZyB0byBiZSBzdGF0aWMKICAvLy8gQHBhcmFtIF90b2tlbiBUb2tlbiBiZWluZyBzb2xkCiAgZnVuY3Rpb24gaW5pdChFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTZbXSBfc2FsZURhdGEsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9lbmRUaW1lLAogICAgICAgICAgICAgICAgdWludDggX3BlcmNlbnRCdXJuLAogICAgICAgICAgICAgICAgdWludDI1NiBfaW5pdGlhbEFkZHJlc3NUb2tlbkNhcCwKICAgICAgICAgICAgICAgIGJvb2wgX3N0YXRpY0NhcCwKICAgICAgICAgICAgICAgIENyb3dkc2FsZVRva2VuIF90b2tlbikKICAgICAgICAgICAgICAgIHB1YmxpYwogIHsKICAJc2VsZi5iYXNlLmluaXQoX293bmVyLAogICAgICAgICAgICAgICAgICAgX3NhbGVEYXRhLAogICAgICAgICAgICAgICAgICAgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICAgICBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICAgICBfdG9rZW4pOwoKICAgIHNlbGYuYWRkcmVzc1Rva2VuQ2FwID0gX2luaXRpYWxBZGRyZXNzVG9rZW5DYXA7CiAgICBzZWxmLnN0YXRpY0NhcCA9IF9zdGF0aWNDYXA7CiAgfQoKICAvLy8gQGRldiByZWdpc3RlciB1c2VyIGZ1bmN0aW9uLiBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIHdoZW4gYSB1c2VyIHJlZ2lzdGVycyBvbiB0aGUgd2ViIGFwcC4KICAvLy8gcHV0cyB0aGVpciBhZGRyZXNzIGluIHRoZSByZWdpc3RlcmVkIG1hcHBpbmcgYW5kIGluY3JlbWVudHMgdGhlIG51bVJlZ2lzdGVyZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX3JlZ2lzdHJhbnQgYWRkcmVzcyB0byBiZSByZWdpc3RlcmVkIGZvciB0aGUgc2FsZQogIGZ1bmN0aW9uIHJlZ2lzdGVyVXNlcihFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3JlZ2lzdHJhbnQpCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJlcXVpcmUoKG1zZy5zZW5kZXIgPT0gc2VsZi5iYXNlLm93bmVyKSB8fCAobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKSk7CiAgICAvLyBpZiB0aGUgY2hhbmdlIGludGVydmFsIGlzIDAsIHRoZW4gcmVnaXN0cmF0aW9uIGlzIGFsbG93ZWQgdGhyb3VnaG91dCB0aGUKICAgIC8vIHNhbGUgc2luY2UgYSBjYXAgZG9lc24ndCBuZWVkIHRvIGJlIGNhbGN1bGF0ZWQKICAgIGlmICgoIXNlbGYuc3RhdGljQ2FwKSAmJiAobm93ID49IHNlbGYuYmFzZS5zdGFydFRpbWUgLSAyIGhvdXJzKSkgewogICAgICBMb2dSZWdFcnJvcihfcmVnaXN0cmFudCwgIkNhbiBvbmx5IHJlZ2lzdGVyIHVzZXJzIGVhcmxpZXIgdGhhbiAyIGhvdXJzIGJlZm9yZSB0aGUgc2FsZSEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYoc2VsZi5pc1JlZ2lzdGVyZWRbX3JlZ2lzdHJhbnRdKSB7CiAgICAgIExvZ1JlZ0Vycm9yKF9yZWdpc3RyYW50LCAiUmVnaXN0cmFudCBhZGRyZXNzIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCBmb3IgdGhlIHNhbGUhIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB1aW50MjU2IHJlc3VsdDsKICAgIGJvb2wgZXJyOwoKICAgIHNlbGYuaXNSZWdpc3RlcmVkW19yZWdpc3RyYW50XSA9IHRydWU7CiAgICAoZXJyLHJlc3VsdCkgPSBzZWxmLm51bVJlZ2lzdGVyZWQucGx1cygxKTsKICAgIHJlcXVpcmUoIWVycik7CiAgICBzZWxmLm51bVJlZ2lzdGVyZWQgPSByZXN1bHQ7CgogICAgTG9nVXNlclJlZ2lzdGVyZWQoX3JlZ2lzdHJhbnQpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgcmVnaXN0ZXJzIG11bHRpcGxlIHVzZXJzIGF0IHRoZSBzYW1lIHRpbWUKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX3JlZ2lzdHJhbnRzIGFkZHJlc3NlcyB0byByZWdpc3RlciBmb3IgdGhlIHNhbGUKICBmdW5jdGlvbiByZWdpc3RlclVzZXJzKEV2ZW5EaXN0cm9Dcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzc1tdIF9yZWdpc3RyYW50cykKICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5iYXNlLm93bmVyKTsKCiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfcmVnaXN0cmFudHMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVnaXN0ZXJVc2VyKHNlbGYsX3JlZ2lzdHJhbnRzW2ldKTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgQ2FuY2VscyBhIHVzZXIncyByZWdpc3RyYXRpb24gc3RhdHVzIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIgd2hlbiBhIHVzZXIgY2FuY2VscyB0aGVpciByZWdpc3RyYXRpb24uCiAgLy8vIHNldHMgdGhlaXIgYWRkcmVzcyBmaWVsZCBpbiB0aGUgcmVnaXN0ZXJlZCBtYXBwaW5nIHRvIGZhbHNlIGFuZCBkZWNyZW1lbnRzIHRoZSBudW1SZWdpc3RlcmVkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICBmdW5jdGlvbiB1bnJlZ2lzdGVyVXNlcihFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3JlZ2lzdHJhbnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKChtc2cuc2VuZGVyID09IHNlbGYuYmFzZS5vd25lcikgfHwgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSkpOwogICAgaWYgKCghc2VsZi5zdGF0aWNDYXApICYmIChub3cgPj0gc2VsZi5iYXNlLnN0YXJ0VGltZSAtIDIgaG91cnMpKSB7CiAgICAgIExvZ1JlZ0Vycm9yKF9yZWdpc3RyYW50LCAiQ2FuIG9ubHkgdW5yZWdpc3RlciB1c2VycyBlYXJsaWVyIHRoYW4gMiBob3VycyBiZWZvcmUgdGhlIHNhbGUhIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmKCFzZWxmLmlzUmVnaXN0ZXJlZFtfcmVnaXN0cmFudF0pIHsKICAgICAgTG9nUmVnRXJyb3IoX3JlZ2lzdHJhbnQsICJSZWdpc3RyYW50IGFkZHJlc3Mgbm90IHJlZ2lzdGVyZWQgZm9yIHRoZSBzYWxlISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdWludDI1NiByZXN1bHQ7CiAgICBib29sIGVycjsKCiAgICBzZWxmLmlzUmVnaXN0ZXJlZFtfcmVnaXN0cmFudF0gPSBmYWxzZTsKICAgIChlcnIscmVzdWx0KSA9IHNlbGYubnVtUmVnaXN0ZXJlZC5taW51cygxKTsKICAgIHJlcXVpcmUoIWVycik7CiAgICBzZWxmLm51bVJlZ2lzdGVyZWQgPSByZXN1bHQ7CgogICAgTG9nVXNlclVuUmVnaXN0ZXJlZChfcmVnaXN0cmFudCk7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiB1bnJlZ2lzdGVycyBtdWx0aXBsZSB1c2VycyBhdCB0aGUgc2FtZSB0aW1lCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9yZWdpc3RyYW50cyBhZGRyZXNzZXMgdG8gdW5yZWdpc3RlciBmb3IgdGhlIHNhbGUKICBmdW5jdGlvbiB1bnJlZ2lzdGVyVXNlcnMoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzW10gX3JlZ2lzdHJhbnRzKQogICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5iYXNlLm93bmVyKTsKCiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfcmVnaXN0cmFudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdW5yZWdpc3RlclVzZXIoc2VsZixfcmVnaXN0cmFudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0aGF0IGNhbGN1bGF0ZXMgYWRkcmVzcyBjYXAgZnJvbSB0aGUgbnVtYmVyIG9mIHVzZXJzIHJlZ2lzdGVyZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIGZ1bmN0aW9uIGNhbGN1bGF0ZUFkZHJlc3NUb2tlbkNhcChFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVybmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShzZWxmLm51bVJlZ2lzdGVyZWQgPiAwKTsKICAgIHJlcXVpcmUoc2VsZi5iYXNlLnRva2VuLmJhbGFuY2VPZih0aGlzKSA+IDApOwoKICAgIGlmIChzZWxmLnN0YXRpY0NhcCkgIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmVxdWlyZSghc2VsZi5iYXNlLnRva2Vuc1NldCk7ICAvLyBtYWtlcyBzdXJlIHRoaXMgY2FuIG9ubHkgYmUgY2FsbGVkIG9uY2UKCiAgICB1aW50MjU2IF9iYXNlQ2FwOwogICAgdWludDI1NiBfY2FsY0NhcDsKICAgIGJvb2wgZXJyOwoKICAgIF9iYXNlQ2FwID0gKHNlbGYuYmFzZS50b2tlbi5iYWxhbmNlT2YodGhpcykpL3NlbGYubnVtUmVnaXN0ZXJlZDsgLy8gbnVtUmVnaXN0ZXJlZCByZXF1aXJlZCB0byBiZSA+IDAKCiAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lcy5sZW5ndGg7IGkrKyl7CiAgICAgIChlcnIsX2NhbGNDYXApID0gc2VsZi5iYXNlLnNhbGVEYXRhW3NlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tpXV1bMV0udGltZXMoX2Jhc2VDYXApOwogICAgICByZXF1aXJlKCFlcnIpOwogICAgICBzZWxmLmJhc2Uuc2FsZURhdGFbc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzW2ldXVsxXSA9IF9jYWxjQ2FwLzEwMDsKICAgIH0KCiAgICBzZWxmLmFkZHJlc3NUb2tlbkNhcCA9IHNlbGYuYmFzZS5zYWxlRGF0YVtzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbMF1dWzFdOwogICAgTG9nQWRkcmVzc1Rva2VuQ2FwQ2FsY3VsYXRlZChzZWxmLm51bVJlZ2lzdGVyZWQsIHNlbGYuYWRkcmVzc1Rva2VuQ2FwLCAiQWRkcmVzcyBjYXAgd2FzIENhbGN1bGF0ZWQhIik7CiAgfQoKICAvLy8gQGRldiB1dGlsaXR5IGZ1bmN0aW9uIGZvciB0aGUgcmVjZWl2ZVB1cmNoYXNlIGZ1bmN0aW9uLiByZXR1cm5zIHRoZSBsb3dlciBudW1iZXIKICAvLy8gQHBhcmFtIGEgZmlyc3QgYXJndW1lbnQKICAvLy8gQHBhcmFtIGIgc2Vjb25kIGFyZ3VtZW50CiAgZnVuY3Rpb24gZ2V0TWluKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhPGIpIHsgcmV0dXJuIGE7IH0gZWxzZSB7IHJldHVybiBiOyB9CiAgfQoKCiAgLy8vIEBkZXYgQ2FsbGVkIHdoZW4gYW4gYWRkcmVzcyB3YW50cyB0byBwdXJjaGFzZSB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBhbW91bmQgb2Ygd2VpIHRoYXQgdGhlIGJ1eWVyIGlzIHNlbmRpbmcKICAvLy8gQHJldHVybiB0cnVlIG9uIHN1Y2Nlc2Z1bCBwdXJjaGFzZQogIGZ1bmN0aW9uIHJlY2VpdmVQdXJjaGFzZShFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wpCiAgewogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IHNlbGYuYmFzZS5vd25lcik7CiAgICByZXF1aXJlKHNlbGYuYmFzZS52YWxpZFB1cmNoYXNlKCkpOwogICAgcmVxdWlyZShzZWxmLmlzUmVnaXN0ZXJlZFttc2cuc2VuZGVyXSk7CgogIAkvLyBpZiB0aGUgYWRkcmVzcyBjYXAgaW5jcmVhc2UgaW50ZXJ2YWwgaGFzIHBhc3NlZCwgdXBkYXRlIHRoZSBjdXJyZW50IGRheSBhbmQgY2hhbmdlIHRoZSBhZGRyZXNzIGNhcAogIAlpZiAoKHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lcy5sZW5ndGggPiBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDEpICYmCiAgICAgICAgKG5vdyA+IHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDFdKSkKICAgIHsKICAgICAgd2hpbGUoKHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lcy5sZW5ndGggPiBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDEpICYmCiAgICAgICAgICAgIChub3cgPiBzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxXSkpCiAgICAgIHsKICAgICAgICBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArPSAxOwogICAgICB9CgogICAgICBzZWxmLmFkZHJlc3NUb2tlbkNhcCA9IHNlbGYuYmFzZS5zYWxlRGF0YVtzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmVdXVsxXTsKCiAgICAgIHNlbGYuYmFzZS5jaGFuZ2VUb2tlblByaWNlKHNlbGYuYmFzZS5zYWxlRGF0YVtzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmVdXVswXSk7CgogICAgICBMb2dBZGRyZXNzVG9rZW5DYXBDaGFuZ2Uoc2VsZi5hZGRyZXNzVG9rZW5DYXAsICJBZGRyZXNzIGNhcCBoYXMgaW5jcmVhc2VkISIpOwogICAgICBMb2dUb2tlblByaWNlQ2hhbmdlKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgsIlRva2VuIFByaWNlIGhhcyBjaGFuZ2VkISIpOwogIAl9CgogICAgdWludDI1NiBfbnVtVG9rZW5zOyAvL251bWJlciBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHB1cmNoYXNlZAogICAgdWludDI1NiBfbmV3QmFsYW5jZTsgLy90aGUgbmV3IGJhbGFuY2Ugb2YgdGhlIG93bmVyIG9mIHRoZSBjcm93ZHNhbGUKICAgIHVpbnQyNTYgX3dlaVRva2VuczsgLy90ZW1wIGNhbGMgaG9sZGVyCiAgICB1aW50MjU2IF9sZWZ0b3ZlcldlaTsgLy93ZWkgY2hhbmdlIGZvciBwdXJjaGFzZXIKICAgIHVpbnQyNTYgX3JlbWFpbmRlcjsgLy90ZW1wIGNhbGMgaG9sZGVyCiAgICB1aW50MjU2IF9hbGxvd2VkV2VpOyAgLy8gdGVsbHMgaG93IG11Y2ggbW9yZSB0aGUgYnV5ZXIgY2FuIGNvbnRyaWJ1dGUgdXAgdG8gdGhlaXIgY2FwCiAgICBib29sIGVycjsKCiAgICBpZihzZWxmLmFkZHJlc3NUb2tlbkNhcCA+IDApIHsKICAgICAgLy9fYWxsb3dlZFdlaSByZXByZXNlbnRzIHRva2VucyBmaXJzdCwgcmVjeWNsZSB2YXJpYWJsZSB0byBwcmV2ZW50IHN0YWNrIGRlcHRoIGlzc3VlcwogICAgICBfYWxsb3dlZFdlaSA9IHNlbGYuYWRkcmVzc1Rva2VuQ2FwIC0gc2VsZi50b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl07CgogICAgICAoZXJyLCBfYWxsb3dlZFdlaSkgPSBfYWxsb3dlZFdlaS50aW1lcygxMDAwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgcmVxdWlyZSghZXJyKTsKCiAgICAgIF9hbGxvd2VkV2VpID0gX2FsbG93ZWRXZWkvc2VsZi5iYXNlLnRva2Vuc1BlckV0aDsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGlmIGFkZHJlc3NUb2tlbkNhcCBpcyB6ZXJvIHRoZW4gdGhlcmUgaXMgbm8gY2FwCiAgICAgIF9hbGxvd2VkV2VpID0gX2Ftb3VudDsKICAgIH0KICAgIHJlcXVpcmUoX2FsbG93ZWRXZWkgPiAwKTsKICAgIF9hbGxvd2VkV2VpID0gZ2V0TWluKF9hbW91bnQsX2FsbG93ZWRXZWkpOwogICAgX2xlZnRvdmVyV2VpID0gX2xlZnRvdmVyV2VpICsgKF9hbW91bnQgLSBfYWxsb3dlZFdlaSk7CgogICAgLy8gRmluZCB0aGUgbnVtYmVyIG9mIHRva2VucyBhcyBhIGZ1bmN0aW9uIGluIHdlaQogICAgKGVycixfd2VpVG9rZW5zKSA9IF9hbGxvd2VkV2VpLnRpbWVzKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBfbnVtVG9rZW5zID0gX3dlaVRva2VucyAvIDEwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICBfcmVtYWluZGVyID0gX3dlaVRva2VucyAlIDEwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICBfcmVtYWluZGVyID0gX3JlbWFpbmRlciAvIHNlbGYuYmFzZS50b2tlbnNQZXJFdGg7CiAgICBfbGVmdG92ZXJXZWkgPSBfbGVmdG92ZXJXZWkgKyBfcmVtYWluZGVyOwogICAgX2Ftb3VudCA9IF9hbW91bnQgLSBfcmVtYWluZGVyOwogICAgc2VsZi5iYXNlLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdICs9IF9sZWZ0b3ZlcldlaTsKCiAgICAvLyBjYW4ndCBvdmVyZmxvdyBiZWNhdXNlIGl0IGlzIHVuZGVyIHRoZSBjYXAKICAgIHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXSArPSBfYWxsb3dlZFdlaSAtIF9yZW1haW5kZXI7CgogICAgYXNzZXJ0KF9udW1Ub2tlbnMgPD0gc2VsZi5iYXNlLnRva2VuLmJhbGFuY2VPZih0aGlzKSk7CgogICAgLy8gY2FsY3VsYXRlIHRoZSBhbW91bnQgb2YgZXRoZXIgaW4gdGhlIG93bmVycyBiYWxhbmNlCiAgICAoZXJyLF9uZXdCYWxhbmNlKSA9IHNlbGYuYmFzZS5vd25lckJhbGFuY2UucGx1cyhfYW1vdW50KTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi5iYXNlLm93bmVyQmFsYW5jZSA9IF9uZXdCYWxhbmNlOyAgIC8vICJkZXBvc2l0IiB0aGUgYW1vdW50CgogICAgLy8gY2FuJ3Qgb3ZlcmZsb3cgYmVjYXVzZSBpdCB3aWxsIGJlIHVuZGVyIHRoZSBjYXAKICAgIHNlbGYuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSArPSBfbnVtVG9rZW5zOwogICAgc2VsZi50b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl0gKz0gX251bVRva2VuczsKCiAgICAvL3N1YnRyYWN0IHRva2VucyBmcm9tIG93bmVyJ3Mgc2hhcmUKICAgIChlcnIsX3JlbWFpbmRlcikgPSBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2VsZi5iYXNlLm93bmVyXS5taW51cyhfbnVtVG9rZW5zKTsKICAgIHJlcXVpcmUoIWVycik7CiAgICBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2VsZi5iYXNlLm93bmVyXSA9IF9yZW1haW5kZXI7CgogICAgTG9nVG9rZW5zQm91Z2h0KG1zZy5zZW5kZXIsIF9udW1Ub2tlbnMpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLypGdW5jdGlvbnMgImluaGVyaXRlZCIgZnJvbSBDcm93ZHNhbGVMaWIgbGlicmFyeSovCgogIGZ1bmN0aW9uIHNldFRva2VucyhFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBjYWxjdWxhdGVBZGRyZXNzVG9rZW5DYXAoc2VsZik7CiAgICByZXR1cm4gc2VsZi5iYXNlLnNldFRva2VucygpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd1Rva2VucygpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdMZWZ0b3ZlcldlaShFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLndpdGhkcmF3TGVmdG92ZXJXZWkoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3T3duZXJFdGgoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd093bmVyRXRoKCk7CiAgfQoKICBmdW5jdGlvbiBnZXRTYWxlRGF0YShFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgdGltZXN0YW1wKQogICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgIHZpZXcKICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zICh1aW50MjU2WzNdKQogIHsKICAgIHJldHVybiBzZWxmLmJhc2UuZ2V0U2FsZURhdGEodGltZXN0YW1wKTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2Vuc1NvbGQoRXZlbkRpc3Ryb0Nyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmdldFRva2Vuc1NvbGQoKTsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUFjdGl2ZShFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuY3Jvd2RzYWxlQWN0aXZlKCk7CiAgfQoKICBmdW5jdGlvbiBjcm93ZHNhbGVFbmRlZChFdmVuRGlzdHJvQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuY3Jvd2RzYWxlRW5kZWQoKTsKICB9Cn0KCmxpYnJhcnkgQ3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CgogIHN0cnVjdCBDcm93ZHNhbGVTdG9yYWdlIHsKICAJYWRkcmVzcyBvd25lcjsgICAgIC8vb3duZXIgb2YgdGhlIGNyb3dkc2FsZQoKICAJdWludDI1NiB0b2tlbnNQZXJFdGg7ICAvL251bWJlciBvZiB0b2tlbnMgcmVjZWl2ZWQgcGVyIGV0aGVyCiAgCXVpbnQyNTYgc3RhcnRUaW1lOyAvL0lDTyBzdGFydCB0aW1lLCB0aW1lc3RhbXAKICAJdWludDI1NiBlbmRUaW1lOyAvL0lDTyBlbmQgdGltZSwgdGltZXN0YW1wIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZAogICAgdWludDI1NiBvd25lckJhbGFuY2U7IC8vb3duZXIgd2VpIEJhbGFuY2UKICAgIHVpbnQyNTYgc3RhcnRpbmdUb2tlbkJhbGFuY2U7IC8vaW5pdGlhbCBhbW91bnQgb2YgdG9rZW5zIGZvciBzYWxlCiAgICB1aW50MjU2W10gbWlsZXN0b25lVGltZXM7IC8vQXJyYXkgb2YgdGltZXN0YW1wcyB3aGVuIHRva2VuIHByaWNlIGFuZCBhZGRyZXNzIGNhcCBjaGFuZ2VzCiAgICB1aW50OCBjdXJyZW50TWlsZXN0b25lOyAvL1BvaW50ZXIgdG8gdGhlIGN1cnJlbnQgbWlsZXN0b25lCiAgICB1aW50OCBwZXJjZW50QnVybjsgLy9wZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgICBib29sIHRva2Vuc1NldDsgLy90cnVlIGlmIHRva2VucyBoYXZlIGJlZW4gcHJlcGFyZWQgZm9yIGNyb3dkc2FsZQoKICAgIC8vTWFwcyB0aW1lc3RhbXAgdG8gdG9rZW4gcHJpY2UgYW5kIGFkZHJlc3MgcHVyY2hhc2UgY2FwIHN0YXJ0aW5nIGF0IHRoYXQgdGltZQogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2WzJdKSBzYWxlRGF0YTsKCiAgICAvL3Nob3dzIGhvdyBtdWNoIHdlaSBhbiBhZGRyZXNzIGhhcyBjb250cmlidXRlZAogIAltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGhhc0NvbnRyaWJ1dGVkOwoKICAgIC8vRm9yIHRva2VuIHdpdGhkcmF3IGZ1bmN0aW9uLCBtYXBzIGEgdXNlciBhZGRyZXNzIHRvIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoZXkgY2FuIHdpdGhkcmF3CiAgCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgd2l0aGRyYXdUb2tlbnNNYXA7CgogICAgLy8gYW55IGxlZnRvdmVyIHdlaSB0aGF0IGJ1eWVycyBjb250cmlidXRlZCB0aGF0IGRpZG4ndCBhZGQgdXAgdG8gYSB3aG9sZSB0b2tlbiBhbW91bnQKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgbGVmdG92ZXJXZWk7CgogIAlDcm93ZHNhbGVUb2tlbiB0b2tlbjsgLy90b2tlbiBiZWluZyBzb2xkCiAgfQoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBhZGRyZXNzIGhhcyB3aXRoZHJhd24gdGhlaXIgc3VwcGx5IG9mIHRva2VucwogIGV2ZW50IExvZ1Rva2Vuc1dpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgX2JpZGRlciwgdWludDI1NiBBbW91bnQpOwoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBhZGRyZXNzIGhhcyB3aXRoZHJhd24gdGhlaXIgc3VwcGx5IG9mIGV4dHJhIHdlaQogIGV2ZW50IExvZ1dlaVdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgX2JpZGRlciwgdWludDI1NiBBbW91bnQpOwoKICAvLyBMb2dzIHdoZW4gb3duZXIgaGFzIHB1bGxlZCBldGgKICBldmVudCBMb2dPd25lckV0aFdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCiAgLy8gR2VuZXJpYyBOb3RpY2UgbWVzc2FnZSB0aGF0IGluY2x1ZGVzIGFuZCBhZGRyZXNzIGFuZCBudW1iZXIKICBldmVudCBMb2dOb3RpY2VNc2coYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgdmFsdWUsIHN0cmluZyBNc2cpOwoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBlcnJvciBoYXMgb2NjdXJyZWQgaW4gdGhlIGV4ZWN1dGlvbiBvZiBhIGZ1bmN0aW9uCiAgZXZlbnQgTG9nRXJyb3JNc2codWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIHRva2Vucy9ldGggYXQgdGhhdCB0aW1lLAogIC8vLyAzIGlzIGFkZHJlc3MgdG9rZW4gcHVyY2hhc2UgY2FwIGF0IHRoYXQgdGltZSwgMCBpZiBubyBhZGRyZXNzIGNhcAogIC8vLyBAcGFyYW0gX2VuZFRpbWUgVGltZXN0YW1wIG9mIHNhbGUgZW5kIHRpbWUKICAvLy8gQHBhcmFtIF9wZXJjZW50QnVybiBQZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgLy8vIEBwYXJhbSBfdG9rZW4gVG9rZW4gYmVpbmcgc29sZAogIGZ1bmN0aW9uIGluaXQoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTZbXSBfc2FsZURhdGEsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9lbmRUaW1lLAogICAgICAgICAgICAgICAgdWludDggX3BlcmNlbnRCdXJuLAogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlVG9rZW4gX3Rva2VuKQogICAgICAgICAgICAgICAgcHVibGljCiAgewogIAlyZXF1aXJlKHNlbGYub3duZXIgPT0gMCk7CiAgICByZXF1aXJlKF9zYWxlRGF0YS5sZW5ndGggPiAwKTsKICAgIHJlcXVpcmUoKF9zYWxlRGF0YS5sZW5ndGglMykgPT0gMCk7IC8vIGVuc3VyZSBzYWxlRGF0YSBpcyAzLWl0ZW0gc2V0cwogICAgcmVxdWlyZShfc2FsZURhdGFbMF0gPiAobm93ICsgMiBob3VycykpOwogICAgcmVxdWlyZShfZW5kVGltZSA+IF9zYWxlRGF0YVswXSk7CiAgICByZXF1aXJlKF9vd25lciA+IDApOwogICAgcmVxdWlyZShfcGVyY2VudEJ1cm4gPD0gMTAwKTsKICAgIHNlbGYub3duZXIgPSBfb3duZXI7CiAgICBzZWxmLnN0YXJ0VGltZSA9IF9zYWxlRGF0YVswXTsKICAgIHNlbGYuZW5kVGltZSA9IF9lbmRUaW1lOwogICAgc2VsZi50b2tlbiA9IF90b2tlbjsKICAgIHNlbGYucGVyY2VudEJ1cm4gPSBfcGVyY2VudEJ1cm47CgogICAgdWludDI1NiBfdGVtcFRpbWU7CiAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IF9zYWxlRGF0YS5sZW5ndGg7IGkgKz0gMyl7CiAgICAgIHJlcXVpcmUoX3NhbGVEYXRhW2ldID4gX3RlbXBUaW1lKTsKICAgICAgcmVxdWlyZShfc2FsZURhdGFbaSArIDFdID4gMCk7CiAgICAgIHJlcXVpcmUoKF9zYWxlRGF0YVtpICsgMl0gPT0gMCkgfHwgKF9zYWxlRGF0YVtpICsgMl0gPj0gMTAwKSk7CiAgICAgIHNlbGYubWlsZXN0b25lVGltZXMucHVzaChfc2FsZURhdGFbaV0pOwogICAgICBzZWxmLnNhbGVEYXRhW19zYWxlRGF0YVtpXV1bMF0gPSBfc2FsZURhdGFbaSArIDFdOwogICAgICBzZWxmLnNhbGVEYXRhW19zYWxlRGF0YVtpXV1bMV0gPSBfc2FsZURhdGFbaSArIDJdOwogICAgICBfdGVtcFRpbWUgPSBfc2FsZURhdGFbaV07CiAgICB9CiAgICBjaGFuZ2VUb2tlblByaWNlKHNlbGYsIF9zYWxlRGF0YVsxXSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBhY3RpdmUKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHN1Y2Nlc3MKICBmdW5jdGlvbiBjcm93ZHNhbGVBY3RpdmUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIChub3cgPj0gc2VsZi5zdGFydFRpbWUgJiYgbm93IDw9IHNlbGYuZW5kVGltZSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gc3VjY2VzcwogIGZ1bmN0aW9uIGNyb3dkc2FsZUVuZGVkKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBub3cgPiBzZWxmLmVuZFRpbWU7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiBhIHB1cmNoYXNlIGlzIHZhbGlkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICBpZiAoY3Jvd2RzYWxlQWN0aXZlKHNlbGYpICYmIG5vblplcm9QdXJjaGFzZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIExvZ0Vycm9yTXNnKG1zZy52YWx1ZSwgIkludmFsaWQgUHVyY2hhc2UhIENoZWNrIHN0YXJ0IHRpbWUgYW5kIGFtb3VudCBvZiBldGhlci4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gY2FsbGVkIGJ5IHB1cmNoYXNlcnMgdG8gcHVsbCB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHdlcmUgd2l0aGRyYXduCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBib29sIG9rOwoKICAgIGlmIChzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID09IDApIHsKICAgICAgTG9nRXJyb3JNc2coMCwgIlNlbmRlciBoYXMgbm8gdG9rZW5zIHRvIHdpdGhkcmF3ISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcikgewogICAgICBpZighY3Jvd2RzYWxlRW5kZWQoc2VsZikpewogICAgICAgIExvZ0Vycm9yTXNnKDAsICJPd25lciBjYW5ub3Qgd2l0aGRyYXcgZXh0cmEgdG9rZW5zIHVudGlsIGFmdGVyIHRoZSBzYWxlISIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZihzZWxmLnBlcmNlbnRCdXJuID4gMCl7CiAgICAgICAgICB1aW50MjU2IF9idXJuQW1vdW50ID0gKHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gKiBzZWxmLnBlcmNlbnRCdXJuKS8xMDA7CiAgICAgICAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSAtIF9idXJuQW1vdW50OwogICAgICAgICAgb2sgPSBzZWxmLnRva2VuLmJ1cm5Ub2tlbihfYnVybkFtb3VudCk7CiAgICAgICAgICByZXF1aXJlKG9rKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICB2YXIgdG90YWwgPSBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IDA7CiAgICBvayA9IHNlbGYudG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgdG90YWwpOwogICAgcmVxdWlyZShvayk7CiAgICBMb2dUb2tlbnNXaXRoZHJhd24obXNnLnNlbmRlciwgdG90YWwpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBGdW5jdGlvbiBjYWxsZWQgYnkgcHVyY2hhc2VycyB0byBwdWxsIGxlZnRvdmVyIHdlaSBmcm9tIHRoZWlyIHB1cmNoYXNlcwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB3ZWkgd2FzIHdpdGhkcmF3bgogIGZ1bmN0aW9uIHdpdGhkcmF3TGVmdG92ZXJXZWkoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBpZiAoc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSA9PSAwKSB7CiAgICAgIExvZ0Vycm9yTXNnKDAsICJTZW5kZXIgaGFzIG5vIGV4dHJhIHdlaSB0byB3aXRoZHJhdyEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHZhciB0b3RhbCA9IHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl07CiAgICBzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdID0gMDsKICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodG90YWwpOwogICAgTG9nV2VpV2l0aGRyYXduKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgc2VuZCBldGhlciBmcm9tIHRoZSBjb21wbGV0ZWQgY3Jvd2RzYWxlIHRvIHRoZSBvd25lcnMgd2FsbGV0IGFkZHJlc3MKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgb3duZXIgd2l0aGRyZXcgZXRoCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGlmICgoIWNyb3dkc2FsZUVuZGVkKHNlbGYpKSAmJiAoc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk+MCkpIHsKICAgICAgTG9nRXJyb3JNc2coMCwgIkNhbm5vdCB3aXRoZHJhdyBvd25lciBldGhlciB1bnRpbCBhZnRlciB0aGUgc2FsZSEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoc2VsZi5vd25lckJhbGFuY2UgPiAwKTsKCiAgICB1aW50MjU2IGFtb3VudCA9IHNlbGYub3duZXJCYWxhbmNlOwogICAgc2VsZi5vd25lckJhbGFuY2UgPSAwOwogICAgc2VsZi5vd25lci50cmFuc2ZlcihhbW91bnQpOwogICAgTG9nT3duZXJFdGhXaXRoZHJhd24obXNnLnNlbmRlcixhbW91bnQsIkNyb3dkc2FsZSBvd25lciBoYXMgd2l0aGRyYXduIGFsbCBmdW5kcyEiKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGNoYW5nZSB0aGUgcHJpY2Ugb2YgdGhlIHRva2VuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF90b2tlbnNQZXJFdGggbmV3IHRva2VuIHByaWNlIChhbW91bnQgb2YgdG9rZW5zIHBlciBldGhlcikKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0b2tlbiBwcmljZSBjaGFuZ2VkIHN1Y2Nlc3NmdWxseQogIGZ1bmN0aW9uIGNoYW5nZVRva2VuUHJpY2UoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF90b2tlbnNQZXJFdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgCXJlcXVpcmUoX3Rva2Vuc1BlckV0aCA+IDApOwoKICAgIHNlbGYudG9rZW5zUGVyRXRoID0gX3Rva2Vuc1BlckV0aDsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IGZ1bmN0aW9uIHRvIHNldCB0b2tlbnMgZm9yIHRoZSBzYWxlCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRva2VucyBzZXQgc3VjY2Vzc2Z1bGx5CiAgZnVuY3Rpb24gc2V0VG9rZW5zKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgcmVxdWlyZSghc2VsZi50b2tlbnNTZXQpOwogICAgcmVxdWlyZShub3cgPCBzZWxmLmVuZFRpbWUpOwoKICAgIHVpbnQyNTYgX3Rva2VuQmFsYW5jZTsKCiAgICBfdG9rZW5CYWxhbmNlID0gc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYuc3RhcnRpbmdUb2tlbkJhbGFuY2UgPSBfdG9rZW5CYWxhbmNlOwogICAgc2VsZi50b2tlbnNTZXQgPSB0cnVlOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgR2V0cyB0aGUgcHJpY2UgYW5kIGJ1eSBjYXAgZm9yIGluZGl2aWR1YWwgYWRkcmVzc2VzIGF0IHRoZSBnaXZlbiBtaWxlc3RvbmUgaW5kZXgKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gdGltZXN0YW1wIFRpbWUgZHVyaW5nIHNhbGUgZm9yIHdoaWNoIGRhdGEgaXMgcmVxdWVzdGVkCiAgLy8vIEByZXR1cm4gQSAzLWVsZW1lbnQgYXJyYXkgd2l0aCAwIHRoZSB0aW1lc3RhbXAsIDEgdGhlIHByaWNlIGluIGNlbnRzLCAyIHRoZSBhZGRyZXNzIGNhcAogIGZ1bmN0aW9uIGdldFNhbGVEYXRhKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IHRpbWVzdGFtcCkKICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICB2aWV3CiAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAodWludDI1NlszXSkKICB7CiAgICB1aW50MjU2WzNdIG1lbW9yeSBfdGhpc0RhdGE7CiAgICB1aW50MjU2IGluZGV4OwoKICAgIHdoaWxlKChpbmRleCA8IHNlbGYubWlsZXN0b25lVGltZXMubGVuZ3RoKSAmJiAoc2VsZi5taWxlc3RvbmVUaW1lc1tpbmRleF0gPCB0aW1lc3RhbXApKSB7CiAgICAgIGluZGV4Kys7CiAgICB9CiAgICBpZihpbmRleCA9PSAwKQogICAgICBpbmRleCsrOwoKICAgIF90aGlzRGF0YVswXSA9IHNlbGYubWlsZXN0b25lVGltZXNbaW5kZXggLSAxXTsKICAgIF90aGlzRGF0YVsxXSA9IHNlbGYuc2FsZURhdGFbX3RoaXNEYXRhWzBdXVswXTsKICAgIF90aGlzRGF0YVsyXSA9IHNlbGYuc2FsZURhdGFbX3RoaXNEYXRhWzBdXVsxXTsKICAgIHJldHVybiBfdGhpc0RhdGE7CiAgfQoKICAvLy8gQGRldiBHZXRzIHRoZSBudW1iZXIgb2YgdG9rZW5zIHNvbGQgdGh1cyBmYXIKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIE51bWJlciBvZiB0b2tlbnMgc29sZAogIGZ1bmN0aW9uIGdldFRva2Vuc1NvbGQoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlIC0gc2VsZi53aXRoZHJhd1Rva2Vuc01hcFtzZWxmLm93bmVyXTsKICB9Cn0KCmxpYnJhcnkgVG9rZW5MaWIgewogIHVzaW5nIEJhc2ljTWF0aExpYiBmb3IgdWludDI1NjsKCiAgc3RydWN0IFRva2VuU3RvcmFnZSB7CiAgICBib29sIGluaXRpYWxpemVkOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICBzdHJpbmcgbmFtZTsKICAgIHN0cmluZyBzeW1ib2w7CiAgICB1aW50MjU2IHRvdGFsU3VwcGx5OwogICAgdWludDI1NiBpbml0aWFsU3VwcGx5OwogICAgYWRkcmVzcyBvd25lcjsKICAgIHVpbnQ4IGRlY2ltYWxzOwogICAgYm9vbCBzdGlsbE1pbnRpbmc7CiAgfQoKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBPd25lckNoYW5nZShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8pOwogIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgTWludGluZ0Nsb3NlZChib29sIG1pbnRpbmdDbG9zZWQpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgdGhlIFN0YW5kYXJkIFRva2VuIHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfbmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAvLy8gQHBhcmFtIF9zeW1ib2wgU3ltYm9sIG9mIHRoZSBuZXcgdG9rZW4KICAvLy8gQHBhcmFtIF9kZWNpbWFscyBEZWNpbWFsIHBsYWNlcyBmb3IgdGhlIHRva2VuIHJlcHJlc2VudGVkCiAgLy8vIEBwYXJhbSBfaW5pdGlhbF9zdXBwbHkgVGhlIGluaXRpYWwgdG9rZW4gc3VwcGx5CiAgLy8vIEBwYXJhbSBfYWxsb3dNaW50aW5nIFRydWUgaWYgYWRkaXRpb25hbCB0b2tlbnMgY2FuIGJlIGNyZWF0ZWQsIGZhbHNlIG90aGVyd2lzZQogIGZ1bmN0aW9uIGluaXQoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgc3RyaW5nIF9uYW1lLAogICAgICAgICAgICAgICAgc3RyaW5nIF9zeW1ib2wsCiAgICAgICAgICAgICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9pbml0aWFsX3N1cHBseSwKICAgICAgICAgICAgICAgIGJvb2wgX2FsbG93TWludGluZykKICAgICAgICAgICAgICAgIHB1YmxpYwogIHsKICAgIHJlcXVpcmUoIXNlbGYuaW5pdGlhbGl6ZWQpOwogICAgc2VsZi5pbml0aWFsaXplZCA9IHRydWU7CiAgICBzZWxmLm5hbWUgPSBfbmFtZTsKICAgIHNlbGYuc3ltYm9sID0gX3N5bWJvbDsKICAgIHNlbGYudG90YWxTdXBwbHkgPSBfaW5pdGlhbF9zdXBwbHk7CiAgICBzZWxmLmluaXRpYWxTdXBwbHkgPSBfaW5pdGlhbF9zdXBwbHk7CiAgICBzZWxmLmRlY2ltYWxzID0gX2RlY2ltYWxzOwogICAgc2VsZi5vd25lciA9IF9vd25lcjsKICAgIHNlbGYuc3RpbGxNaW50aW5nID0gX2FsbG93TWludGluZzsKICAgIHNlbGYuYmFsYW5jZXNbX293bmVyXSA9IF9pbml0aWFsX3N1cHBseTsKICB9CgogIC8vLyBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIGNhbGxlcidzIGFjY291bnQgdG8gYW5vdGhlciBhY2NvdW50LgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMKICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHNlbmQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIHRyYW5zZmVyKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgYm9vbCBlcnI7CiAgICB1aW50MjU2IGJhbGFuY2U7CgogICAgKGVycixiYWxhbmNlKSA9IHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0ubWludXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CiAgICBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZTsKICAgIC8vSXQncyBub3QgcG9zc2libGUgdG8gb3ZlcmZsb3cgdG9rZW4gc3VwcGx5CiAgICBzZWxmLmJhbGFuY2VzW190b10gPSBzZWxmLmJhbGFuY2VzW190b10gKyBfdmFsdWU7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZWQgY2FsbGVyIHRyYW5zZmVycyB0b2tlbnMgZnJvbSBvbmUgYWNjb3VudCB0byBhbm90aGVyCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfZnJvbSBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zIGZyb20KICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zIHRvCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICB2YXIgX2FsbG93YW5jZSA9IHNlbGYuYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgYmFsYW5jZU93bmVyOwogICAgdWludDI1NiBiYWxhbmNlU3BlbmRlcjsKCiAgICAoZXJyLGJhbGFuY2VPd25lcikgPSBzZWxmLmJhbGFuY2VzW19mcm9tXS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICAoZXJyLGJhbGFuY2VTcGVuZGVyKSA9IF9hbGxvd2FuY2UubWludXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi5iYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlT3duZXI7CiAgICBzZWxmLmFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYmFsYW5jZVNwZW5kZXI7CiAgICBzZWxmLmJhbGFuY2VzW190b10gPSBzZWxmLmJhbGFuY2VzW190b10gKyBfdmFsdWU7CgogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUmV0cmlldmUgdG9rZW4gYmFsYW5jZSBmb3IgYW4gYWNjb3VudAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3MgdG8gcmV0cmlldmUgYmFsYW5jZSBvZgogIC8vLyBAcmV0dXJuIGJhbGFuY2UgVGhlIG51bWJlciBvZiB0b2tlbnMgaW4gdGhlIHN1YmplY3QgYWNjb3VudAogIGZ1bmN0aW9uIGJhbGFuY2VPZihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gc2VsZi5iYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgLy8vIEBkZXYgQXV0aG9yaXplIGFuIGFjY291bnQgdG8gc2VuZCB0b2tlbnMgb24gY2FsbGVyJ3MgYmVoYWxmCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGF1dGhvcml6ZQogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgYXV0aG9yaXplZCBhY2NvdW50IG1heSBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBhcHByb3ZlKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgLy8gbXVzdCBzZXQgdG8gemVybyBiZWZvcmUgY2hhbmdpbmcgYXBwcm92YWwgYW1vdW50IGluIGFjY29yZGFuY2Ugd2l0aCBzcGVjCiAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUmVtYWluaW5nIHRva2VucyB0aGlyZCBwYXJ0eSBzcGVuZGVyIGhhcyB0byBzZW5kCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBob2xkZXIKICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3Mgb2YgYXV0aG9yaXplZCBzcGVuZGVyCiAgLy8vIEByZXR1cm4gcmVtYWluaW5nIE51bWJlciBvZiB0b2tlbnMgc3BlbmRlciBoYXMgbGVmdCBpbiBvd25lcidzIGFjY291bnQKICBmdW5jdGlvbiBhbGxvd2FuY2UoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpCiAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICB2aWV3CiAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gc2VsZi5hbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLy8vIEBkZXYgQXV0aG9yaXplIHRoaXJkIHBhcnR5IHRyYW5zZmVyIGJ5IGluY3JlYXNpbmcvZGVjcmVhc2luZyBhbGxvd2VkIHJhdGhlciB0aGFuIHNldHRpbmcgaXQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3MgdG8gYXV0aG9yaXplCiAgLy8vIEBwYXJhbSBfdmFsdWVDaGFuZ2UgSW5jcmVhc2Ugb3IgZGVjcmVhc2UgaW4gbnVtYmVyIG9mIHRva2VucyBhdXRob3JpemVkIGFjY291bnQgbWF5IHNlbmQKICAvLy8gQHBhcmFtIF9pbmNyZWFzZSBUcnVlIGlmIGluY3JlYXNpbmcgYWxsb3dhbmNlLCBmYWxzZSBpZiBkZWNyZWFzaW5nIGFsbG93YW5jZQogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gYXBwcm92ZUNoYW5nZSAoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWVDaGFuZ2UsIGJvb2wgX2luY3JlYXNlKQogICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyByZXR1cm5zIChib29sKQogIHsKICAgIHVpbnQyNTYgX25ld0FsbG93ZWQ7CiAgICBib29sIGVycjsKCiAgICBpZihfaW5jcmVhc2UpIHsKICAgICAgKGVyciwgX25ld0FsbG93ZWQpID0gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5wbHVzKF92YWx1ZUNoYW5nZSk7CiAgICAgIHJlcXVpcmUoIWVycik7CgogICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX25ld0FsbG93ZWQ7CiAgICB9IGVsc2UgewogICAgICBpZiAoX3ZhbHVlQ2hhbmdlID4gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSkgewogICAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIF9uZXdBbGxvd2VkID0gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAtIF92YWx1ZUNoYW5nZTsKICAgICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX25ld0FsbG93ZWQ7CiAgICAgIH0KICAgIH0KCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX25ld0FsbG93ZWQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBDaGFuZ2Ugb3duaW5nIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0LCBzcGVjaWZpY2FsbHkgZm9yIG1pbnRpbmcKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9uZXdPd25lciBBZGRyZXNzIGZvciB0aGUgbmV3IG93bmVyCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBjaGFuZ2VPd25lcihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcikgJiYgKF9uZXdPd25lciA+IDApKTsKCiAgICBzZWxmLm93bmVyID0gX25ld093bmVyOwogICAgT3duZXJDaGFuZ2UobXNnLnNlbmRlciwgX25ld093bmVyKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgTWludHMgYWRkaXRpb25hbCB0b2tlbnMsIG5ldyB0b2tlbnMgZ28gdG8gb3duZXIKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9hbW91bnQgTnVtYmVyIG9mIHRva2VucyB0byBtaW50CiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBtaW50VG9rZW4oVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSgoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKSAmJiBzZWxmLnN0aWxsTWludGluZyk7CiAgICB1aW50MjU2IF9uZXdBbW91bnQ7CiAgICBib29sIGVycjsKCiAgICAoZXJyLCBfbmV3QW1vdW50KSA9IHNlbGYudG90YWxTdXBwbHkucGx1cyhfYW1vdW50KTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi50b3RhbFN1cHBseSA9ICBfbmV3QW1vdW50OwogICAgc2VsZi5iYWxhbmNlc1tzZWxmLm93bmVyXSA9IHNlbGYuYmFsYW5jZXNbc2VsZi5vd25lcl0gKyBfYW1vdW50OwogICAgVHJhbnNmZXIoMHgwLCBzZWxmLm93bmVyLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUGVybWFuZW50IHN0b3BzIG1pbnRpbmcKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGNsb3NlTWludChUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpOwoKICAgIHNlbGYuc3RpbGxNaW50aW5nID0gZmFsc2U7CiAgICBNaW50aW5nQ2xvc2VkKHRydWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBQZXJtYW5lbnRseSBidXJuIHRva2VucwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBBbW91bnQgb2YgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGJ1cm5Ub2tlbihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgIHVpbnQyNTYgX25ld0JhbGFuY2U7CiAgICAgIGJvb2wgZXJyOwoKICAgICAgKGVyciwgX25ld0JhbGFuY2UpID0gc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXS5taW51cyhfYW1vdW50KTsKICAgICAgcmVxdWlyZSghZXJyKTsKCiAgICAgIHNlbGYuYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBfbmV3QmFsYW5jZTsKICAgICAgc2VsZi50b3RhbFN1cHBseSA9IHNlbGYudG90YWxTdXBwbHkgLSBfYW1vdW50OwogICAgICBCdXJuKG1zZy5zZW5kZXIsIF9hbW91bnQpOwogICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCAweDAsIF9hbW91bnQpOwogICAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIHsKICB1c2luZyBUb2tlbkxpYiBmb3IgVG9rZW5MaWIuVG9rZW5TdG9yYWdlOwoKICBUb2tlbkxpYi5Ub2tlblN0b3JhZ2UgcHVibGljIHRva2VuOwoKICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbihhZGRyZXNzIG93bmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBzeW1ib2wsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDggZGVjaW1hbHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBpbml0aWFsU3VwcGx5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgYWxsb3dNaW50aW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogIHsKICAgIHRva2VuLmluaXQob3duZXIsIG5hbWUsIHN5bWJvbCwgZGVjaW1hbHMsIGluaXRpYWxTdXBwbHksIGFsbG93TWludGluZyk7CiAgfQoKICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gdG9rZW4ubmFtZTsKICB9CgogIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIHRva2VuLnN5bWJvbDsKICB9CgogIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgIHJldHVybiB0b2tlbi5kZWNpbWFsczsKICB9CgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLnRvdGFsU3VwcGx5OwogIH0KCiAgZnVuY3Rpb24gaW5pdGlhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5pbml0aWFsU3VwcGx5OwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKHdobyk7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uYWxsb3dhbmNlKG93bmVyLCBzcGVuZGVyKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmVDaGFuZ2UoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlQ2hhbmdlLCBib29sIGluY3JlYXNlKQogICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljCiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHJldHVybiB0b2tlbi5hcHByb3ZlQ2hhbmdlKHNwZW5kZXIsIHZhbHVlQ2hhbmdlLCBpbmNyZWFzZSk7CiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmNoYW5nZU93bmVyKG5ld093bmVyKTsKICB9CgogIGZ1bmN0aW9uIGJ1cm5Ub2tlbih1aW50MjU2IGFtb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5idXJuVG9rZW4oYW1vdW50KTsKICB9Cn0KCmxpYnJhcnkgQmFzaWNNYXRoTGliIHsKICAvLy8gQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzIGFuZCBjaGVja3MgZm9yIG92ZXJmbG93IGJlZm9yZSByZXR1cm5pbmcuCiAgLy8vIERvZXMgbm90IHRocm93LgogIC8vLyBAcGFyYW0gYSBGaXJzdCBudW1iZXIKICAvLy8gQHBhcmFtIGIgU2Vjb25kIG51bWJlcgogIC8vLyBAcmV0dXJuIGVyciBGYWxzZSBub3JtYWxseSwgb3IgdHJ1ZSBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgcHJvZHVjdCBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gdGltZXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IG11bChhLGIpCiAgICAgIHN3aXRjaCBvcihpc3plcm8oYiksIGVxKGRpdihyZXMsYiksIGEpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogIH0KCiAgLy8vIEBkZXYgRGl2aWRlcyB0d28gbnVtYmVycyBidXQgY2hlY2tzIGZvciAwIGluIHRoZSBkaXZpc29yIGZpcnN0LgogIC8vLyBEb2VzIG5vdCB0aHJvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgYGJgIGlzIDAKICAvLy8gQHJldHVybiByZXMgVGhlIHF1b3RpZW50IG9mIGEgYW5kIGIsIG9yIDAgaWYgYGJgIGlzIDAKICBmdW5jdGlvbiBkaXZpZGVkQnkodWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgaSkgewogICAgdWludDI1NiByZXM7CiAgICBhc3NlbWJseXsKICAgICAgc3dpdGNoIGlzemVybyhiKQogICAgICBjYXNlIDAgewogICAgICAgIHJlcyA6PSBkaXYoYSxiKQogICAgICAgIGxldCBsb2MgOj0gbWxvYWQoMHg0MCkKICAgICAgICBtc3RvcmUoYWRkKGxvYywweDIwKSxyZXMpCiAgICAgICAgaSA6PSBtbG9hZChhZGQobG9jLDB4MjApKQogICAgICB9CiAgICAgIGRlZmF1bHQgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgaSA6PSAwCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IEFkZHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgLy8vIEByZXR1cm4gcmVzIFRoZSBzdW0gb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHBsdXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wgZXJyLCB1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBhZGQoYSxiKQogICAgICBzd2l0Y2ggYW5kKGVxKHN1YihyZXMsYiksIGEpLCBvcihndChyZXMsYiksZXEocmVzLGIpKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICB9CgogIC8vLyBAZGV2IFN1YnRyYWN0cyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciB1bmRlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgZnVuY3Rpb24gbWludXModWludDI1NiBhLCB1aW50MjU2IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IHN1YihhLGIpCiAgICAgIHN3aXRjaCBlcShhbmQoZXEoYWRkKHJlcyxiKSwgYSksIG9yKGx0KHJlcyxhKSwgZXEocmVzLGEpKSksIDEpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgfQp9'.
	

]
