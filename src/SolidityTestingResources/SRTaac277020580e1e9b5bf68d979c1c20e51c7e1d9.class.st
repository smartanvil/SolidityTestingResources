Class {
	#name : #SRTaac277020580e1e9b5bf68d979c1c20e51c7e1d9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTaac277020580e1e9b5bf68d979c1c20e51c7e1d9 >> base64 [
	^ 'Ly8gQmFzZSBNaW50aW5nIENvbnRyYWN0CmNvbnRyYWN0IENhcmRNaW50aW5nRmFjaWxpdGF0b3IgewogICAgQ2FyZENvbmZpZyBzY2hlbWEgPSBDYXJkQ29uZmlnKDB4MDg1ODQyNzFkZjNkMDI0OWMyYzA2YWMxYmMxMjM3YTFkZDMwY2I5YSk7IAogICAgRXRoZXJHZW5Db3JlIHN0b3JhZ2VDb250cmFjdCA9IEV0aGVyR2VuQ29yZSgweDY3N2FhMWRjMDhiOTQyOWM1OTVlZmQ0NDI1YjJkMjE4Y2MyMmZkNmUpOwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIgPSAweDA4RjRhRTk2YjY0N0IzMDE3N2NjMTVCMjExOTU5NjA2MjVCQTQxNjM7CiAgICAKICAgIGZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tQ2FyZCh1aW50MzIgcmFuZG9tU2VlZCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDhbMTRdKSB7CiAgICAgICAgdWludDhbMTRdIG1lbW9yeSBjYXJkRGV0YWlsczsKICAgICAgIAogICAgICAgIHJhbmRvbVNlZWQgPSB1aW50MzIoc2hhMyhibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyKSwgcmFuZG9tU2VlZCkpOwogICAgICAgIGNhcmREZXRhaWxzWzBdID0gc2NoZW1hLmdldFR5cGUocmFuZG9tU2VlZCk7CgogICAgICAgIGlmIChjYXJkRGV0YWlsc1swXSA9PSB1aW50OChDYXJkQ29uZmlnLlR5cGUuTW9uc3RlcikpIHsKICAgICAgICAgICAgZ2VuZXJhdGVSYW5kb21Nb25zdGVyKGNhcmREZXRhaWxzLCByYW5kb21TZWVkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBnZW5lcmF0ZVJhbmRvbVNwZWxsKGNhcmREZXRhaWxzLCByYW5kb21TZWVkKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmFuZG9tU2VlZCA9IHVpbnQzMihzaGEzKGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXIpLCByYW5kb21TZWVkKSk7CiAgICAgICAgaWYgKHJhbmRvbVNlZWQgJSAyMDAgPT0gMTMpIHsgLy8gTHVja3kgbnVtYmVyIDEzCiAgICAgICAgICAgIGNhcmREZXRhaWxzWzEyXSA9IDE7IC8vIFNlY3JldCBnb2xkZW4gYXR0cmlidXRlCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBjYXJkRGV0YWlsczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2VuZXJhdGVSYW5kb21Nb25zdGVyKHVpbnQ4WzE0XSBjYXJkRGV0YWlscywgdWludDMyIHJhbmRvbVNlZWQpIGludGVybmFsIGNvbnN0YW50IHsKICAgICAgICB1aW50MjQgdG90YWxDb3N0OwogICAgICAgIAogICAgICAgIHJhbmRvbVNlZWQgPSB1aW50MzIoc2hhMyhibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyKSwgcmFuZG9tU2VlZCkpOwogICAgICAgIGNhcmREZXRhaWxzWzFdID0gc2NoZW1hLmdldFJhY2UocmFuZG9tU2VlZCk7CiAgICAgICAgdG90YWxDb3N0ICs9IHNjaGVtYS5nZXRDb3N0Rm9yUmFjZShjYXJkRGV0YWlsc1sxXSk7CgogICAgICAgIHJhbmRvbVNlZWQgPSB1aW50MzIoc2hhMyhibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyKSwgcmFuZG9tU2VlZCkpOwogICAgICAgIGNhcmREZXRhaWxzWzJdID0gc2NoZW1hLmdldFRyYWl0KHJhbmRvbVNlZWQpOwogICAgICAgIHRvdGFsQ29zdCArPSBzY2hlbWEuZ2V0Q29zdEZvclRyYWl0KGNhcmREZXRhaWxzWzJdKTsKCiAgICAgICAgdWludDggbmV3TXV0YXRpb247CiAgICAgICAgdWludDI0IG5ld011dGF0aW9uQ29zdDsKICAgICAgICByYW5kb21TZWVkID0gdWludDMyKHNoYTMoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciksIHJhbmRvbVNlZWQpKTsKICAgICAgICAKICAgICAgICB1aW50OCBudW1NdXRhdGlvbnMgPSB1aW50OChyYW5kb21TZWVkICUgMTIpOyAvLyAwID0gMCBtdXRhdGlvbnMsIDEgPSAxIG11dGF0aW9uLCAyLTUgPSAyIG11dGF0aW9ucywgNi0xMSA9IDMgbXV0YXRpb25zIAogICAgICAgIGlmIChudW1NdXRhdGlvbnMgPiA1KSB7CiAgICAgICAgICAgIG51bU11dGF0aW9ucyA9IDM7CiAgICAgICAgfSBlbHNlIGlmIChudW1NdXRhdGlvbnMgPiAyKSB7CiAgICAgICAgICAgIG51bU11dGF0aW9ucyA9IDI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciAodWludDggaSA9IDA7IGkgPCBudW1NdXRhdGlvbnM7IGkrKykgewogICAgICAgICAgICByYW5kb21TZWVkID0gdWludDMyKHNoYTMoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciksIHJhbmRvbVNlZWQpKTsKICAgICAgICAgICAgaWYgKGJvb2wocmFuZG9tU2VlZCAlIDMgPT0gMCkpIHsgLy8gMDogUmFjZTsgMS0yOiBOZXV0cmFsCiAgICAgICAgICAgICAgICByYW5kb21TZWVkID0gdWludDMyKHNoYTMoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciksIHJhbmRvbVNlZWQpKTsKCiAgICAgICAgICAgICAgICAvLyBIb3JyaWJseSBhZGQgbmV3IG11dGF0aW9ucyAocmF0aGVyIHRoYW4gbG9vcGluZyBmb3IgYSBmcmVzaCBvbmUpIHRoaXMgaXMgY2hlYXBlcgogICAgICAgICAgICAgICAgKG5ld011dGF0aW9uQ29zdCwgbmV3TXV0YXRpb24pID0gc2NoZW1hLmdldE11dGF0aW9uRm9yUmFjZShDYXJkQ29uZmlnLlJhY2UoY2FyZERldGFpbHNbMV0pLCByYW5kb21TZWVkKTsKICAgICAgICAgICAgICAgIGlmICh0b3RhbENvc3QgKyBuZXdNdXRhdGlvbkNvc3QgPCAyOTAwMDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY2FyZERldGFpbHNbNl0gPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXJkRGV0YWlsc1s2XSA9IG5ld011dGF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbENvc3QgKz0gbmV3TXV0YXRpb25Db3N0OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2FyZERldGFpbHNbNl0gPiAwICYmIGNhcmREZXRhaWxzWzddID09IDAgJiYgY2FyZERldGFpbHNbNl0gIT0gbmV3TXV0YXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FyZERldGFpbHNbN10gPSBuZXdNdXRhdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxDb3N0ICs9IG5ld011dGF0aW9uQ29zdDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgIChjYXJkRGV0YWlsc1s2XSA+IDAgJiYgY2FyZERldGFpbHNbN10gPiAwICYmIGNhcmREZXRhaWxzWzhdID09IDAgJiYgY2FyZERldGFpbHNbNl0gIT0gbmV3TXV0YXRpb24gJiYgY2FyZERldGFpbHNbN10gIT0gbmV3TXV0YXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FyZERldGFpbHNbOF0gPSBuZXdNdXRhdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxDb3N0ICs9IG5ld011dGF0aW9uQ29zdDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByYW5kb21TZWVkID0gdWludDMyKHNoYTMoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciksIHJhbmRvbVNlZWQpKTsKCiAgICAgICAgICAgICAgICAvLyBIb3JyaWJseSBhZGQgbmV3IG11dGF0aW9ucyAocmF0aGVyIHRoYW4gbG9vcGluZyBmb3IgYSBmcmVzaCBvbmUpIHRoaXMgaXMgY2hlYXBlcgogICAgICAgICAgICAgICAgKG5ld011dGF0aW9uQ29zdCwgbmV3TXV0YXRpb24pID0gc2NoZW1hLmdldE5ldXRyYWxNdXRhdGlvbihyYW5kb21TZWVkKTsKICAgICAgICAgICAgICAgIGlmICh0b3RhbENvc3QgKyBuZXdNdXRhdGlvbkNvc3QgPCAyOTAwMDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY2FyZERldGFpbHNbOV0gPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXJkRGV0YWlsc1s5XSA9IG5ld011dGF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbENvc3QgKz0gbmV3TXV0YXRpb25Db3N0OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2FyZERldGFpbHNbOV0gPiAwICYmIGNhcmREZXRhaWxzWzEwXSA9PSAwICYmIGNhcmREZXRhaWxzWzldICE9IG5ld011dGF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhcmREZXRhaWxzWzEwXSA9IG5ld011dGF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbENvc3QgKz0gbmV3TXV0YXRpb25Db3N0OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2FyZERldGFpbHNbOV0gPiAwICYmIGNhcmREZXRhaWxzWzEwXSA+IDAgJiYgY2FyZERldGFpbHNbMTFdID09IDAgJiYgY2FyZERldGFpbHNbOV0gIT0gbmV3TXV0YXRpb24gJiYgY2FyZERldGFpbHNbMTBdICE9IG5ld011dGF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhcmREZXRhaWxzWzExXSA9IG5ld011dGF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbENvc3QgKz0gbmV3TXV0YXRpb25Db3N0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gRm9yIGF0dGFjayAmIGhlYWx0aCBkaXN0cmlidXRpb24KICAgICAgICByYW5kb21TZWVkID0gdWludDMyKHNoYTMoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlciksIHJhbmRvbVNlZWQpKTsKICAgICAgICB1aW50MjQgcG93ZXJDb3N0ID0gc2NoZW1hLmdldENvc3RGb3JIZWFsdGgoMSkgKyB1aW50MjQocmFuZG9tU2VlZCAlICgzMDEwMDAgLSAodG90YWxDb3N0ICsgc2NoZW1hLmdldENvc3RGb3JIZWFsdGgoMSkpKSk7IC8vICUgdXB0byAzMDA5OTkgd2lsbCBhbGxvdyAzMCBjb3N0IGNhcmRzCgogICAgICAgIGlmICh0b3RhbENvc3QgKyBwb3dlckNvc3QgPCAxMDAwMDApIHsgLy8gQ2FyZHMgc2hvdWxkIGNvc3QgYXQgbGVhc3QgMTAgY3J5c3RhbHMgKDEwKjEwMDAwIGV4cG9uYW50KQogICAgICAgICAgICBwb3dlckNvc3QgPSAxMDAwMDAgLSB0b3RhbENvc3Q7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJhbmRvbVNlZWQgPSB1aW50MzIoc2hhMyhibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyKSwgcmFuZG9tU2VlZCkpOwogICAgICAgIGNhcmREZXRhaWxzWzVdID0gMSArIHVpbnQ4KHNjaGVtYS5nZXRIZWFsdGhGb3JDb3N0KHJhbmRvbVNlZWQgJSBwb3dlckNvc3QpKTsgLy8gc2hvdWxkIGJlICgxICsgcG93ZXJDb3N0IC0gc2NoZW1hLmdldENvc3RGb3JIZWFsdGgoMSkpCiAgICAgICAgdG90YWxDb3N0ICs9IHNjaGVtYS5nZXRDb3N0Rm9ySGVhbHRoKGNhcmREZXRhaWxzWzVdKTsKICAgICAgICAKICAgICAgICBwb3dlckNvc3QgPSBwb3dlckNvc3QgLSBzY2hlbWEuZ2V0Q29zdEZvckhlYWx0aChjYXJkRGV0YWlsc1s1XSk7IC8vIFBvd2VyIGxlZnQgZm9yIGF0dGFjawogICAgICAgIGNhcmREZXRhaWxzWzRdID0gdWludDgoc2NoZW1hLmdldEF0dGFja0ZvckNvc3QocG93ZXJDb3N0KSk7CiAgICAgICAgdG90YWxDb3N0ICs9IHNjaGVtYS5nZXRDb3N0Rm9yQXR0YWNrKGNhcmREZXRhaWxzWzRdKTsKICAgICAgIAogICAgICAgIC8vIFJlbW92ZSBleHBvbmVudCB0byBnZXQgdG90YWwgY2FyZCBjb3N0IFsxMC0zMF0KICAgICAgICBjYXJkRGV0YWlsc1szXSA9IHVpbnQ4KHRvdGFsQ29zdCAvIDEwMDAwKTsKICAgIH0KICAgIAogICAgCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVJhbmRvbVNwZWxsKHVpbnQ4WzE0XSBjYXJkRGV0YWlscywgdWludDMyIHJhbmRvbVNlZWQpIGludGVybmFsIGNvbnN0YW50IHsKICAgICAgICB1aW50MjQgdG90YWxDb3N0OwogICAgICAgIAogICAgICAgIHVpbnQ4IG5ld0FiaWxpdHk7CiAgICAgICAgdWludDI0IG5ld0FiaWxpdHlDb3N0OwogICAgICAgIHJhbmRvbVNlZWQgPSB1aW50MzIoc2hhMyhibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyKSwgcmFuZG9tU2VlZCkpOwogICAgICAgIAogICAgICAgIHVpbnQ4IG51bUFiaWxpdGllcyA9IHVpbnQ4KHJhbmRvbVNlZWQgJSAxNik7IC8vIDAgPSAxIGFiaWxpdHksIDEtOCA9IDIgYWJpbGl0aWVzLCA5LTE1ID0gMyBhYmlsaXRpZXMgCiAgICAgICAgaWYgKG51bUFiaWxpdGllcyA+IDgpIHsKICAgICAgICAgICAgbnVtQWJpbGl0aWVzID0gMzsKICAgICAgICB9IGVsc2UgaWYgKG51bUFiaWxpdGllcyA+IDApIHsKICAgICAgICAgICAgbnVtQWJpbGl0aWVzID0gMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBudW1BYmlsaXRpZXMgPSAxOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgbnVtQWJpbGl0aWVzOyBpKyspIHsKICAgICAgICAgICAgcmFuZG9tU2VlZCA9IHVpbnQzMihzaGEzKGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXIpLCByYW5kb21TZWVkKSk7CgogICAgICAgICAgICAvLyBIb3JyaWJseSBhZGQgbmV3IHNwZWxsIGFiaWxpdGllcyAocmF0aGVyIHRoYW4gbG9vcGluZyBmb3IgYSBmcmVzaCBvbmUpIHRoaXMgaXMgY2hlYXBlcgogICAgICAgICAgICAobmV3QWJpbGl0eUNvc3QsIG5ld0FiaWxpdHkpID0gc2NoZW1hLmdldFNwZWxsQWJpbGl0eShyYW5kb21TZWVkKTsKICAgICAgICAgICAgaWYgKHRvdGFsQ29zdCArIG5ld0FiaWxpdHlDb3N0IDw9IDMwMDAwMCkgewogICAgICAgICAgICAgICAgaWYgKGNhcmREZXRhaWxzWzldID09IDApIHsKICAgICAgICAgICAgICAgICAgICBjYXJkRGV0YWlsc1s5XSA9IG5ld0FiaWxpdHk7CiAgICAgICAgICAgICAgICAgICAgdG90YWxDb3N0ICs9IG5ld0FiaWxpdHlDb3N0OwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjYXJkRGV0YWlsc1s5XSA+IDAgJiYgY2FyZERldGFpbHNbMTBdID09IDAgJiYgY2FyZERldGFpbHNbOV0gIT0gbmV3QWJpbGl0eSkgewogICAgICAgICAgICAgICAgICAgIGNhcmREZXRhaWxzWzEwXSA9IG5ld0FiaWxpdHk7CiAgICAgICAgICAgICAgICAgICAgdG90YWxDb3N0ICs9IG5ld0FiaWxpdHlDb3N0OwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjYXJkRGV0YWlsc1s5XSA+IDAgJiYgY2FyZERldGFpbHNbMTBdID4gMCAmJiBjYXJkRGV0YWlsc1sxMV0gPT0gMCAmJiBjYXJkRGV0YWlsc1s5XSAhPSBuZXdBYmlsaXR5ICYmIGNhcmREZXRhaWxzWzEwXSAhPSBuZXdBYmlsaXR5KSB7CiAgICAgICAgICAgICAgICAgICAgY2FyZERldGFpbHNbMTFdID0gbmV3QWJpbGl0eTsKICAgICAgICAgICAgICAgICAgICB0b3RhbENvc3QgKz0gbmV3QWJpbGl0eUNvc3Q7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gUmVtb3ZlIGV4cG9uZW50IHRvIGdldCB0b3RhbCBjYXJkIGNvc3QgWzEwLTMwXQogICAgICAgIGNhcmREZXRhaWxzWzNdID0gdWludDgodG90YWxDb3N0IC8gMTAwMDApOwogICAgfQogICAgCiAgICAKICAgIGZ1bmN0aW9uIGdlbmVyYXRlQ29zdEZyb21BdHRyaWJ1dGVzKHVpbnQ4WzE0XSBjYXJkRGV0YWlscykgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDggY29zdCkgewogICAgICAgIHVpbnQyNCBleHBvbmVudENvc3QgPSAwOwogICAgICAgIGlmIChjYXJkRGV0YWlsc1swXSA9PSAxKSB7IC8vIFNwZWxsCiAgICAgICAgICAgIGV4cG9uZW50Q29zdCArPSBzY2hlbWEuZ2V0U3BlbGxBYmlsaXR5Q29zdChjYXJkRGV0YWlsc1s5XSk7CiAgICAgICAgICAgIGV4cG9uZW50Q29zdCArPSBzY2hlbWEuZ2V0U3BlbGxBYmlsaXR5Q29zdChjYXJkRGV0YWlsc1sxMF0pOwogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldFNwZWxsQWJpbGl0eUNvc3QoY2FyZERldGFpbHNbMTFdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldENvc3RGb3JSYWNlKGNhcmREZXRhaWxzWzFdKTsKICAgICAgICAgICAgZXhwb25lbnRDb3N0ICs9IHNjaGVtYS5nZXRDb3N0Rm9yVHJhaXQoY2FyZERldGFpbHNbMl0pOwogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldENvc3RGb3JBdHRhY2soY2FyZERldGFpbHNbNF0pOwogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldENvc3RGb3JIZWFsdGgoY2FyZERldGFpbHNbNV0pOwogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldFJhY2VNdXRhdGlvbkNvc3QoQ2FyZENvbmZpZy5SYWNlKGNhcmREZXRhaWxzWzFdKSwgY2FyZERldGFpbHNbNl0pOwogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldFJhY2VNdXRhdGlvbkNvc3QoQ2FyZENvbmZpZy5SYWNlKGNhcmREZXRhaWxzWzFdKSwgY2FyZERldGFpbHNbN10pOwogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldFJhY2VNdXRhdGlvbkNvc3QoQ2FyZENvbmZpZy5SYWNlKGNhcmREZXRhaWxzWzFdKSwgY2FyZERldGFpbHNbOF0pOwogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldE5ldXRyYWxNdXRhdGlvbkNvc3QoY2FyZERldGFpbHNbOV0pOwogICAgICAgICAgICBleHBvbmVudENvc3QgKz0gc2NoZW1hLmdldE5ldXRyYWxNdXRhdGlvbkNvc3QoY2FyZERldGFpbHNbMTBdKTsKICAgICAgICAgICAgZXhwb25lbnRDb3N0ICs9IHNjaGVtYS5nZXROZXV0cmFsTXV0YXRpb25Db3N0KGNhcmREZXRhaWxzWzExXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1aW50OChleHBvbmVudENvc3QgLyAxMDAwMCk7IC8vIEV2ZXJ5dGhpbmcgaXMgZmFjdG9yIDEwMDAwIGZvciBlYXNlIG9mIGF1dG9ub21vdXMgV29ya3Nob3AgY29zdC10dW5pbmcKICAgIH0KICAgIAogICAgLy8gQWxsb3dzIGZ1dHVyZSBleHRlbnNpYmlsaXR5IChOZXcgY2FyZCBtdXRhdGlvbnMgKyBXb3Jrc2hvcCB1cGRhdGVzKQogICAgZnVuY3Rpb24gdXBncmFkZUNhcmRDb25maWcoYWRkcmVzcyBuZXdDYXJkQ29uZmlnKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBzY2hlbWEgPSBDYXJkQ29uZmlnKG5ld0NhcmRDb25maWcpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1cGRhdGVTdG9yYWdlQ29udHJhY3QoYWRkcmVzcyBuZXdTdG9yYWdlKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBzdG9yYWdlQ29udHJhY3QgPSBFdGhlckdlbkNvcmUobmV3U3RvcmFnZSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVwZGF0ZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9Cn0KCgpjb250cmFjdCBMaW1pdGVkRWRpdGlvblNlZWRDYXJkc0Rpc3RyaWJ1dG9yIGlzIENhcmRNaW50aW5nRmFjaWxpdGF0b3IgewogICAgCiAgICAvLyBUbyBraWNrc3RhcnQgbWFya2V0cGxhY2UgMTAwLDAwMCBjYXJkcyB3aWxsIGJlIGxpc3RlZCBvdmVyIHRpbWUgKHN0YXJ0aW5nIGF0IGZvdXIgcGVyIGhvdXIpIAogICAgLy8gdGhpcyBpcyBhIHRpbnkgZnJhY3Rpb24gb2YgdGhlIHJvdWdoIDQsMDAwLDAwMCwwMDAgcG9zc2libGUgY2FyZHMsIHdlIGFudGljaXBhdGUgdGhlc2UgdG8gYmUKICAgIC8vIFZFUlkgbGltaXRlZCBlZGl0aW9uIGluIGZ1dHVyZSAoYXMgV29ya3Nob3Agd2lsbCBhdXRvbm9tb3VzbHkgYWRqdXN0IGNyeXN0YWwgY29zdHMgZm9yIHBvcHVsYXIgY2FyZC1jb21iaW5hdGlvbnMpCiAgICAvLyBzbyBtYXkgYmVjb21lIGltcG9zc2libGUgdG8gY3JhZnQgc29tZSBjYXJkcyBpbiB0aGlzIGJhdGNoLi4uIEdpZnQgdG8gb3VyIGVhcmx5IGFkb3B0ZXJzIQogICAgdWludDI0IGNvbnN0YW50IG1pbnRpbmdMaW1pdCA9IDEwMDAwMDsKICAgIHVpbnQxMjggY29uc3RhbnQgc3RhcnRpbmdQcmljZU11bHRpcGxpZXIgPSAyNTAgc3phYm87IC8vIENyeXN0YWwgY29zdCAqIDI1MCBzemFibyAoYWthIDI1MDAtNzUwMCBzemFibykKICAgIHVpbnQxMjggY29uc3RhbnQgZW5kUHJpY2VNdWx0aXBsaWVyID0gMTAwIHN6YWJvOyAvLyAoYWthIDEwMDAtMzAwMCBzemFibykgfiQyIGJhcmdhaW4hCiAgIAogICAgdWludDI0IHB1YmxpYyBjYXJkc01pbnRlZCA9IDA7CiAgICB1aW50NjRbXSBwcml2YXRlIG1pbnRlZENhcmRJZHM7CiAgICB1aW50MTI4IHByaXZhdGUgbmV4dE1hcmtldExpc3RpbmdUaW1lU3RhbXA7CiAgICAKICAgIE1hcHBlZE1hcmtldHBsYWNlIG1hcmtldHBsYWNlQ29udHJhY3QgPSBNYXBwZWRNYXJrZXRwbGFjZSgweGMzZDI3MzZiM2U0ZjBmNzg0NTdkNzViM2I1ZjAxOTFhMTRlOGJkNTcpOwogICAgCiAgICBmdW5jdGlvbiBtaW50TmV4dENhcmQoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShjYXJkc01pbnRlZCA8IG1pbnRpbmdMaW1pdCk7CiAgICAgICAgdWludDhbMTRdIG1lbW9yeSBuZXdDYXJkID0gZ2VuZXJhdGVSYW5kb21DYXJkKHVpbnQzMihzdG9yYWdlQ29udHJhY3QudG90YWxTdXBwbHkoKSAqIG5vdykpOwogICAgICAgIGNhcmRzTWludGVkKys7CiAgICAgICAgc3RvcmFnZUNvbnRyYWN0Lm1pbnRDYXJkKGFkZHJlc3ModGhpcyksIG5ld0NhcmQpOwogICAgICAgIG1pbnRlZENhcmRJZHMucHVzaCh1aW50NjQoc3RvcmFnZUNvbnRyYWN0LnRvdGFsU3VwcGx5KCkgLSAxKSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGxpc3ROZXh0Rm91ckNhcmRzKHVpbnQxMjggbmV4dERyb3ApIGV4dGVybmFsIHsKICAgICAgICAvLyBMaXN0cyBmb3VyIGNhcmRzIG9uIG1hcmtldCAoc3RhcnRpbmcgcmF0ZSA0IGNhcmRzIHBlciBob3VyLCBmbHVjdHVhdGluZyBvbiBkZW1hbmQpCiAgICAgICAgLy8gVW50aWwgYWxsIDEwMCwwMDAgUmFyZSBMaW1pdGVkIEVkaXRpb24gaGF2ZSBiZWVuIGxpc3RlZC4KICAgICAgICAvLyBXZSBlc3RpbWF0ZSBqdXN0IDYwLTkwIGRheXMgYmVmb3JlIG5vIG1vcmUgY2FyZHMsIGZvcmV2ZXIgKEV4Y2x1ZGluZyBXb3Jrc2hvcC9GdXNpbmcgb2YgQ2FyZHMpCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICByZXF1aXJlKG1pbnRlZENhcmRJZHMubGVuZ3RoID4gMyk7CiAgICAgICAgcmVxdWlyZShuZXh0RHJvcCA+IG5leHRNYXJrZXRMaXN0aW5nVGltZVN0YW1wKTsKICAgICAgICAKICAgICAgICBsaXN0U2luZ2xlQ2FyZCgpOwogICAgICAgIGxpc3RTaW5nbGVDYXJkKCk7CiAgICAgICAgbGlzdFNpbmdsZUNhcmQoKTsKICAgICAgICBsaXN0U2luZ2xlQ2FyZCgpOwogICAgICAgIAogICAgICAgIC8vIFVwZGF0ZSB0aW1lc3RhbXAgZm9yIG5leHQgYmF0Y2gKICAgICAgICBuZXh0TWFya2V0TGlzdGluZ1RpbWVTdGFtcCA9IG5leHREcm9wOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBsaXN0U2luZ2xlQ2FyZCgpIGludGVybmFsIHsKICAgICAgICB1aW50NjQgY2FyZElkID0gbWludGVkQ2FyZElkc1ttaW50ZWRDYXJkSWRzLmxlbmd0aCAtIDFdOwogICAgICAgIHVpbnQ4WzE0XSBtZW1vcnkgY2FyZEluZm8gPSBzdG9yYWdlQ29udHJhY3QuZ2V0Q2FyZChjYXJkSWQpOwogICAgICAgIAogICAgICAgIHVpbnQxMjggc3RhcnRQcmljZSA9IGNhcmRJbmZvWzNdICogc3RhcnRpbmdQcmljZU11bHRpcGxpZXI7CiAgICAgICAgdWludDEyOCBlbmRQcmljZSA9IGNhcmRJbmZvWzNdICogZW5kUHJpY2VNdWx0aXBsaWVyOwogICAgICAgIG1hcmtldHBsYWNlQ29udHJhY3QubGlzdENhcmQoY2FyZElkLCBzdGFydFByaWNlLCBlbmRQcmljZSwgMjQgaG91cnMpOwogICAgICAgIAogICAgICAgIGRlbGV0ZSBtaW50ZWRDYXJkSWRzW21pbnRlZENhcmRJZHMubGVuZ3RoIC0gMV07CiAgICAgICAgbWludGVkQ2FyZElkcy5sZW5ndGgtLTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0TmV4dERyb3BUaW1lKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDEyOCkgewogICAgICAgIHJldHVybiBuZXh0TWFya2V0TGlzdGluZ1RpbWVTdGFtcDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7IH0KICAgIAogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVNYXJrZXRDb250cmFjdChhZGRyZXNzIG5ld01hcmtldHBsYWNlKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBtYXJrZXRwbGFjZUNvbnRyYWN0ID0gTWFwcGVkTWFya2V0cGxhY2UobmV3TWFya2V0cGxhY2UpOwogICAgfQogICAgCn0KCi8vIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2Vucwpjb250cmFjdCBFUkM3MjEgewoKICAgIC8vIFJlcXVpcmVkIG1ldGhvZHMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjYXJkcyk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBwbGF5ZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgY2FyZElkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHRvLCB1aW50MjU2IGNhcmRJZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IGNhcmRJZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IGNhcmRJZCkgZXh0ZXJuYWw7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgY2FyZElkKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgYXBwcm92ZWQsIHVpbnQyNTYgY2FyZElkKTsKCiAgICAvLyBOYW1lIGFuZCBzeW1ib2wgb2YgdGhlIG5vbiBmdW5naWJsZSB0b2tlbiwgYXMgZGVmaW5lZCBpbiBFUkM3MjEuCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiRXRoZXJHZW4iOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiRVRHIjsKCiAgICAvLyBPcHRpb25hbCBtZXRob2RzCiAgICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgcGxheWVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQ2NFtdIGNhcmRJZHMpOwp9CgoKY29udHJhY3QgUGxheWVyc0NvbGxlY3Rpb25TdG9yYWdlIHsKICAgIAogICAgbWFwcGluZyhhZGRyZXNzID0+IFBsYXllcnNDb2xsZWN0aW9uKSBpbnRlcm5hbCBwbGF5ZXJzQ29sbGVjdGlvbnM7CiAgICBtYXBwaW5nKHVpbnQ2NCA9PiBDYXJkKSBpbnRlcm5hbCBjYXJkSWRNYXBwaW5nOwoKICAgIHN0cnVjdCBQbGF5ZXJzQ29sbGVjdGlvbiB7CiAgICAgICAgdWludDY0W10gY2FyZElkczsKICAgICAgICBib29sIHJlZmVyYWxDYXJkc1VubG9ja2VkOwogICAgfQoKICAgIHN0cnVjdCBDYXJkIHsKICAgICAgICB1aW50NjQgaWQ7CiAgICAgICAgdWludDY0IGNvbGxlY3Rpb25Qb2ludGVyOyAvLyBJbmRleCBpbiBwbGF5ZXIncyBjb2xsZWN0aW9uCiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICAKICAgICAgICB1aW50OCBjYXJkVHlwZTsKICAgICAgICB1aW50OCByYWNlOwogICAgICAgIHVpbnQ4IHRyYWl0OwoKICAgICAgICB1aW50OCBjb3N0OyAvLyBbMTAtMzBdCiAgICAgICAgdWludDggYXR0YWNrOyAvLyBbMC05OV0KICAgICAgICB1aW50OCBoZWFsdGg7IC8vIFsxLTk5XQoKICAgICAgICB1aW50OCByYWNlTXV0YXRpb24wOyAvLyBTdXBlciB1Z2x5IGJ1dCBkeW5hbWljIGxlbmd0aCBhcnJheXMgYXJlIGN1cnJlbnRseSBhIG5vLWdvIGFjcm9zcyBjb250cmFjdHMKICAgICAgICB1aW50OCByYWNlTXV0YXRpb24xOyAvLyArIHZlcnkgZXhwZW5zaXZlIGdhcyBzaW5jZSBjYXJkcyBhcmUgaW4gbmVzdGVkIHN0cnVjdHMgKGNvbGxlY3Rpb24gb2YgY2FyZHMpCiAgICAgICAgdWludDggcmFjZU11dGF0aW9uMjsKCiAgICAgICAgdWludDggbmV1dHJhbE11dGF0aW9uMDsKICAgICAgICB1aW50OCBuZXV0cmFsTXV0YXRpb24xOwogICAgICAgIHVpbnQ4IG5ldXRyYWxNdXRhdGlvbjI7CgogICAgICAgIC8qKgogICAgICAgICAqIEluaXRhbGx5IHJlZmVyYWwgKGZyZWUpIGNhcmRzIHdpbGwgYmUgdW50cmFkYWJsZSAodG8gc3RvcCBhYnVzZSkgaG93ZXZlciBFdGhlckdlbkNvcmUgaGFzCiAgICAgICAgICogdW5sb2NrVW50cmFkZWFibGVDYXJkcygpIHRvIG1ha2UgdGhlbSB0cmFkZWFibGUgLXRyaWdnZXJlZCBvbmNlIHBsYXllciBoaXRzIGNlcnRhaW4gYmF0dGxlL2dhbWUgbWlsZXN0b25lCiAgICAgICAgICovCiAgICAgICAgYm9vbCBpc1JlZmVyYWxSZXdhcmQ7CiAgICAgICAgYm9vbCBpc0dvbGRlbjsgLy8gVG9wIHNlY3JldCBRMiBhbmltYXRlZCBhcnQKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0UGxheWVyc0NvbGxlY3Rpb24oYWRkcmVzcyBwbGF5ZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50NjRbXSwgdWludDhbMTRdW10pIHsKICAgICAgICB1aW50OFsxNF1bXSBtZW1vcnkgY2FyZERldGFpbHMgPSBuZXcgdWludDhbMTRdW10ocGxheWVyc0NvbGxlY3Rpb25zW3BsYXllcl0uY2FyZElkcy5sZW5ndGgpOwogICAgICAgIHVpbnQ2NFtdIG1lbW9yeSBjYXJkSWRzID0gbmV3IHVpbnQ2NFtdKHBsYXllcnNDb2xsZWN0aW9uc1twbGF5ZXJdLmNhcmRJZHMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh1aW50MzIgaSA9IDA7IGkgPCBwbGF5ZXJzQ29sbGVjdGlvbnNbcGxheWVyXS5jYXJkSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIENhcmQgbWVtb3J5IGNhcmQgPSBjYXJkSWRNYXBwaW5nW3BsYXllcnNDb2xsZWN0aW9uc1twbGF5ZXJdLmNhcmRJZHNbaV1dOwogICAgICAgICAgICBjYXJkRGV0YWlsc1tpXVswXSA9IGNhcmQuY2FyZFR5cGU7CiAgICAgICAgICAgIGNhcmREZXRhaWxzW2ldWzFdID0gY2FyZC5yYWNlOwogICAgICAgICAgICBjYXJkRGV0YWlsc1tpXVsyXSA9IGNhcmQudHJhaXQ7CiAgICAgICAgICAgIGNhcmREZXRhaWxzW2ldWzNdID0gY2FyZC5jb3N0OwogICAgICAgICAgICBjYXJkRGV0YWlsc1tpXVs0XSA9IGNhcmQuYXR0YWNrOwogICAgICAgICAgICBjYXJkRGV0YWlsc1tpXVs1XSA9IGNhcmQuaGVhbHRoOwogICAgICAgICAgICBjYXJkRGV0YWlsc1tpXVs2XSA9IGNhcmQucmFjZU11dGF0aW9uMDsKICAgICAgICAgICAgY2FyZERldGFpbHNbaV1bN10gPSBjYXJkLnJhY2VNdXRhdGlvbjE7CiAgICAgICAgICAgIGNhcmREZXRhaWxzW2ldWzhdID0gY2FyZC5yYWNlTXV0YXRpb24yOwogICAgICAgICAgICBjYXJkRGV0YWlsc1tpXVs5XSA9IGNhcmQubmV1dHJhbE11dGF0aW9uMDsKICAgICAgICAgICAgY2FyZERldGFpbHNbaV1bMTBdID0gY2FyZC5uZXV0cmFsTXV0YXRpb24xOwogICAgICAgICAgICBjYXJkRGV0YWlsc1tpXVsxMV0gPSBjYXJkLm5ldXRyYWxNdXRhdGlvbjI7CgogICAgICAgICAgICBjYXJkRGV0YWlsc1tpXVsxMl0gPSBjYXJkLmlzR29sZGVuID8gMSA6IDA7IC8vIE5vdCBpZGVhbCBidXQgd2ViMy5qcyBkaWRuJ3QgbGlrZSByZXR1cm5pbmcgbXVsdGlwbGUgMmQgYXJyYXlzCiAgICAgICAgICAgIGNhcmREZXRhaWxzW2ldWzEzXSA9IGlzQ2FyZFRyYWRlYWJsZShjYXJkKSA/IDEgOiAwOwogICAgICAgICAgICAKICAgICAgICAgICAgY2FyZElkc1tpXSA9IGNhcmQuaWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoY2FyZElkcywgY2FyZERldGFpbHMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDYXJkKHVpbnQ2NCBjYXJkSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OFsxNF0pIHsKICAgICAgICBDYXJkIG1lbW9yeSBjYXJkID0gY2FyZElkTWFwcGluZ1tjYXJkSWRdOwogICAgICAgIHJldHVybiAoW2NhcmQuY2FyZFR5cGUsIGNhcmQucmFjZSwgY2FyZC50cmFpdCwgY2FyZC5jb3N0LCBjYXJkLmF0dGFjaywgY2FyZC5oZWFsdGgsCiAgICAgICAgICAgICAgICAgY2FyZC5yYWNlTXV0YXRpb24wLCBjYXJkLnJhY2VNdXRhdGlvbjEsIGNhcmQucmFjZU11dGF0aW9uMiwKICAgICAgICAgICAgICAgICBjYXJkLm5ldXRyYWxNdXRhdGlvbjAsIGNhcmQubmV1dHJhbE11dGF0aW9uMSwgY2FyZC5uZXV0cmFsTXV0YXRpb24yLAogICAgICAgICAgICAgICAgIGNhcmQuaXNHb2xkZW4gPyAxIDogMCwgCiAgICAgICAgICAgICAgICAgaXNDYXJkVHJhZGVhYmxlKGNhcmQpID8gMSA6IDBdKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNDYXJkVHJhZGVhYmxlKENhcmQgY2FyZCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIChwbGF5ZXJzQ29sbGVjdGlvbnNbY2FyZC5vd25lcl0ucmVmZXJhbENhcmRzVW5sb2NrZWQgfHwgIWNhcmQuaXNSZWZlcmFsUmV3YXJkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNDYXJkVHJhZGVhYmxlKHVpbnQ2NCBjYXJkSWQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBpc0NhcmRUcmFkZWFibGUoY2FyZElkTWFwcGluZ1tjYXJkSWRdKTsKICAgIH0KfQoKCgoKY29udHJhY3QgRXRoZXJHZW5Db3JlIGlzIFBsYXllcnNDb2xsZWN0aW9uU3RvcmFnZSwgRVJDNzIxIHsKICAgIAogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHByaXZhdGUgcHJpdmlsZWdlZFRyYW5zZmVyTW9kdWxlczsgLy8gTWFya2V0cGxhY2UgKCArIGZ1dHVyZSBmZWF0dXJlcykKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwcml2YXRlIHByaXZpbGVnZWRNaW50aW5nTW9kdWxlczsgLy8gUmVmZXJhbHMsIEZ1c2luZywgV29ya3Nob3AgZXRjLiAoICsgZnV0dXJlIGZlYXR1cmVzKQogICAgCiAgICBtYXBwaW5nKHVpbnQ2NCA9PiBhZGRyZXNzKSBwcml2YXRlIGNhcmRJZEFwcHJvdmVkczsgLy8gQXBwcm92YWwgbGlzdCAoRVJDNzIxIHRyYW5zZmVycykKICAgIHVpbnQ2NCBwcml2YXRlIHRvdGFsQ2FyZFN1cHBseTsgLy8gQWxzbyB1c2VkIGZvciBjYXJkSWQgaW5jcmVtZW50YXRpb24KICAgIAogICAgVHJhbnNmZXJSZXN0cmljdGlvblZlcmlmaWVyIHRyYW5zZmVyUmVzdHJpY3Rpb25WZXJpZmllciA9IFRyYW5zZmVyUmVzdHJpY3Rpb25WZXJpZmllcigweGQ5ODYxZDlhNjExMWJmYmI5MjM1YTcxMTUxZjY1NGQwZmU3ZWQ5NTQpOyAKICAgIGFkZHJlc3MgcHVibGljIG93bmVyID0gMHgwOEY0YUU5NmI2NDdCMzAxNzdjYzE1QjIxMTk1OTYwNjI1QkE0MTYzOwogICAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CiAgICAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjYXJkcykgewogICAgICAgIHJldHVybiB0b3RhbENhcmRTdXBwbHk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBjYXJkSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBjYXJkT3duZXIpIHsKICAgICAgICByZXR1cm4gY2FyZElkTWFwcGluZ1t1aW50NjQoY2FyZElkKV0ub3duZXI7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHBsYXllcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIHBsYXllcnNDb2xsZWN0aW9uc1twbGF5ZXJdLmNhcmRJZHMubGVuZ3RoOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgcGxheWVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQ2NFtdIGNhcmRJZHMpIHsKICAgICAgICByZXR1cm4gcGxheWVyc0NvbGxlY3Rpb25zW3BsYXllcl0uY2FyZElkczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBuZXdPd25lciwgdWludDI1NiBjYXJkSWQpIGV4dGVybmFsIHsKICAgICAgICB1aW50NjQgY2FzdENhcmRJZCA9IHVpbnQ2NChjYXJkSWQpOwogICAgICAgIHJlcXVpcmUoY2FyZElkTWFwcGluZ1tjYXN0Q2FyZElkXS5vd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKGlzQ2FyZFRyYWRlYWJsZShjYXJkSWRNYXBwaW5nW2Nhc3RDYXJkSWRdKSk7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlclJlc3RyaWN0aW9uVmVyaWZpZXIuaXNBdmFpbGFibGVGb3JUcmFuc2ZlcihjYXN0Q2FyZElkKSk7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICAKICAgICAgICByZW1vdmVDYXJkT3duZXIoY2FzdENhcmRJZCk7CiAgICAgICAgYXNzaWduQ2FyZE93bmVyKG5ld093bmVyLCBjYXN0Q2FyZElkKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBuZXdPd25lciwgY2FzdENhcmRJZCk7IC8vIEVtaXQgRXZlbnQKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgY3VycmVudE93bmVyLCBhZGRyZXNzIG5ld093bmVyLCB1aW50MjU2IGNhcmRJZCkgZXh0ZXJuYWwgewogICAgICAgIHVpbnQ2NCBjYXN0Q2FyZElkID0gdWludDY0KGNhcmRJZCk7CiAgICAgICAgcmVxdWlyZShjYXJkSWRNYXBwaW5nW2Nhc3RDYXJkSWRdLm93bmVyID09IGN1cnJlbnRPd25lcik7CiAgICAgICAgcmVxdWlyZShpc0FwcHJvdmVkVHJhbnNmZXJlcihtc2cuc2VuZGVyLCBjYXN0Q2FyZElkKSk7CiAgICAgICAgcmVxdWlyZShpc0NhcmRUcmFkZWFibGUoY2FyZElkTWFwcGluZ1tjYXN0Q2FyZElkXSkpOwogICAgICAgIHJlcXVpcmUodHJhbnNmZXJSZXN0cmljdGlvblZlcmlmaWVyLmlzQXZhaWxhYmxlRm9yVHJhbnNmZXIoY2FzdENhcmRJZCkpOwogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgCiAgICAgICAgcmVtb3ZlQ2FyZE93bmVyKGNhc3RDYXJkSWQpOwogICAgICAgIGFzc2lnbkNhcmRPd25lcihuZXdPd25lciwgY2FzdENhcmRJZCk7CiAgICAgICAgVHJhbnNmZXIoY3VycmVudE93bmVyLCBuZXdPd25lciwgY2FzdENhcmRJZCk7IC8vIEVtaXQgRXZlbnQKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IGNhcmRJZCkgZXh0ZXJuYWwgewogICAgICAgIHVpbnQ2NCBjYXN0Q2FyZElkID0gdWludDY0KGNhcmRJZCk7CiAgICAgICAgcmVxdWlyZShjYXJkSWRNYXBwaW5nW2Nhc3RDYXJkSWRdLm93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIAogICAgICAgIGNhcmRJZEFwcHJvdmVkc1tjYXN0Q2FyZElkXSA9IGFwcHJvdmVkOyAvLyBSZWdpc3RlciBhcHByb3ZhbCAocmVwbGFjaW5nIHByZXZpb3VzKQogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIGFwcHJvdmVkLCBjYXN0Q2FyZElkKTsgLy8gRW1pdCBFdmVudAogICAgfQogICAgCiAgICBmdW5jdGlvbiBpc0FwcHJvdmVkVHJhbnNmZXJlcihhZGRyZXNzIGFwcHJvdmVlLCB1aW50NjQgY2FyZElkKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gV2lsbCBvbmx5IHJldHVybiB0cnVlIGlmIGFwcHJvdmVlIChtc2cuc2VuZGVyKSBpcyBhIHByaXZpbGVnZWQgdHJhbnNmZXIgYWRkcmVzcyAoTWFya2V0cGxhY2UpIG9yIHNhbnRpb25lZCBieSBjYXJkJ3Mgb3duZXIgdXNpbmcgRVJDNzIxJ3MgYXBwcm92ZSgpCiAgICAgICAgcmV0dXJuIHByaXZpbGVnZWRUcmFuc2Zlck1vZHVsZXNbYXBwcm92ZWVdIHx8IGNhcmRJZEFwcHJvdmVkc1tjYXJkSWRdID09IGFwcHJvdmVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmVDYXJkT3duZXIodWludDY0IGNhcmRJZCkgaW50ZXJuYWwgewogICAgICAgIGFkZHJlc3MgY2FyZE93bmVyID0gY2FyZElkTWFwcGluZ1tjYXJkSWRdLm93bmVyOwoKICAgICAgICBpZiAocGxheWVyc0NvbGxlY3Rpb25zW2NhcmRPd25lcl0uY2FyZElkcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIHVpbnQ2NCByb3dUb0RlbGV0ZSA9IGNhcmRJZE1hcHBpbmdbY2FyZElkXS5jb2xsZWN0aW9uUG9pbnRlcjsKICAgICAgICAgICAgdWludDY0IGNhcmRJZFRvTW92ZSA9IHBsYXllcnNDb2xsZWN0aW9uc1tjYXJkT3duZXJdLmNhcmRJZHNbcGxheWVyc0NvbGxlY3Rpb25zW2NhcmRPd25lcl0uY2FyZElkcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgcGxheWVyc0NvbGxlY3Rpb25zW2NhcmRPd25lcl0uY2FyZElkc1tyb3dUb0RlbGV0ZV0gPSBjYXJkSWRUb01vdmU7CiAgICAgICAgICAgIGNhcmRJZE1hcHBpbmdbY2FyZElkVG9Nb3ZlXS5jb2xsZWN0aW9uUG9pbnRlciA9IHJvd1RvRGVsZXRlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwbGF5ZXJzQ29sbGVjdGlvbnNbY2FyZE93bmVyXS5jYXJkSWRzLmxlbmd0aC0tOwogICAgICAgIGNhcmRJZE1hcHBpbmdbY2FyZElkXS5vd25lciA9IDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFzc2lnbkNhcmRPd25lcihhZGRyZXNzIG5ld093bmVyLCB1aW50NjQgY2FyZElkKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgY2FyZElkTWFwcGluZ1tjYXJkSWRdLm93bmVyID0gbmV3T3duZXI7CiAgICAgICAgICAgIGNhcmRJZE1hcHBpbmdbY2FyZElkXS5jb2xsZWN0aW9uUG9pbnRlciA9IHVpbnQ2NChwbGF5ZXJzQ29sbGVjdGlvbnNbbmV3T3duZXJdLmNhcmRJZHMucHVzaChjYXJkSWQpIC0gMSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBtaW50Q2FyZChhZGRyZXNzIHJlY2lwaWVudCwgdWludDhbMTRdIGNhcmREZXRhaWxzKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShwcml2aWxlZ2VkTWludGluZ01vZHVsZXNbbXNnLnNlbmRlcl0pOwogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgCiAgICAgICAgQ2FyZCBtZW1vcnkgY2FyZDsKICAgICAgICBjYXJkLm93bmVyID0gcmVjaXBpZW50OwogICAgICAgIAogICAgICAgIGNhcmQuY2FyZFR5cGUgPSBjYXJkRGV0YWlsc1swXTsKICAgICAgICBjYXJkLnJhY2UgPSBjYXJkRGV0YWlsc1sxXTsKICAgICAgICBjYXJkLnRyYWl0ID0gY2FyZERldGFpbHNbMl07CiAgICAgICAgY2FyZC5jb3N0ID0gY2FyZERldGFpbHNbM107CiAgICAgICAgY2FyZC5hdHRhY2sgPSBjYXJkRGV0YWlsc1s0XTsKICAgICAgICBjYXJkLmhlYWx0aCA9IGNhcmREZXRhaWxzWzVdOwogICAgICAgIGNhcmQucmFjZU11dGF0aW9uMCA9IGNhcmREZXRhaWxzWzZdOwogICAgICAgIGNhcmQucmFjZU11dGF0aW9uMSA9IGNhcmREZXRhaWxzWzddOwogICAgICAgIGNhcmQucmFjZU11dGF0aW9uMiA9IGNhcmREZXRhaWxzWzhdOwogICAgICAgIGNhcmQubmV1dHJhbE11dGF0aW9uMCA9IGNhcmREZXRhaWxzWzldOwogICAgICAgIGNhcmQubmV1dHJhbE11dGF0aW9uMSA9IGNhcmREZXRhaWxzWzEwXTsKICAgICAgICBjYXJkLm5ldXRyYWxNdXRhdGlvbjIgPSBjYXJkRGV0YWlsc1sxMV07CiAgICAgICAgY2FyZC5pc0dvbGRlbiA9IGNhcmREZXRhaWxzWzEyXSA9PSAxOwogICAgICAgIGNhcmQuaXNSZWZlcmFsUmV3YXJkID0gY2FyZERldGFpbHNbMTNdID09IDE7CiAgICAgICAgCiAgICAgICAgY2FyZC5pZCA9IHRvdGFsQ2FyZFN1cHBseTsKICAgICAgICB0b3RhbENhcmRTdXBwbHkrKzsKCiAgICAgICAgY2FyZElkTWFwcGluZ1tjYXJkLmlkXSA9IGNhcmQ7CiAgICAgICAgY2FyZElkTWFwcGluZ1tjYXJkLmlkXS5jb2xsZWN0aW9uUG9pbnRlciA9IHVpbnQ2NChwbGF5ZXJzQ29sbGVjdGlvbnNbcmVjaXBpZW50XS5jYXJkSWRzLnB1c2goY2FyZC5pZCkgLSAxKTsKICAgIH0KICAgIAogICAgLy8gTWFuYWdlbWVudCBmdW5jdGlvbnMgdG8gZmFjaWxpdGF0ZSBmdXR1cmUgY29udHJhY3QgZXh0ZW5zaWJpbGl0eSwgdW5sb2NraW5nIG9mICh1bnRyYWRhYmxlKSByZWZlcmFsIGJvbnVzIGNhcmRzIGFuZCBjb250cmFjdCBvd25lcnNoaXAKICAgIAogICAgZnVuY3Rpb24gdW5sb2NrVW50cmFkZWFibGVDYXJkcyhhZGRyZXNzIHBsYXllcikgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUocHJpdmlsZWdlZFRyYW5zZmVyTW9kdWxlc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgcGxheWVyc0NvbGxlY3Rpb25zW3BsYXllcl0ucmVmZXJhbENhcmRzVW5sb2NrZWQgPSB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBtYW5hZ2VBcHByb3ZlZFRyYW5zZmVyTW9kdWxlKGFkZHJlc3MgbW9kdWxlQWRkcmVzcywgYm9vbCBpc0FwcHJvdmVkKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBwcml2aWxlZ2VkVHJhbnNmZXJNb2R1bGVzW21vZHVsZUFkZHJlc3NdID0gaXNBcHByb3ZlZDsgCiAgICB9CiAgICAKICAgICBmdW5jdGlvbiBtYW5hZ2VBcHByb3ZlZE1pbnRpbmdNb2R1bGUoYWRkcmVzcyBtb2R1bGVBZGRyZXNzLCBib29sIGlzQXBwcm92ZWQpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHByaXZpbGVnZWRNaW50aW5nTW9kdWxlc1ttb2R1bGVBZGRyZXNzXSA9IGlzQXBwcm92ZWQ7IAogICAgfQogICAgCiAgICBmdW5jdGlvbiB1cGRhdGVUcmFuc2ZlclJlc3RyaWN0aW9uVmVyaWZpZXIoYWRkcmVzcyBuZXdUcmFuc2ZlclJlc3RyaWN0aW9uVmVyaWZpZXIpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHRyYW5zZmVyUmVzdHJpY3Rpb25WZXJpZmllciA9IFRyYW5zZmVyUmVzdHJpY3Rpb25WZXJpZmllcihuZXdUcmFuc2ZlclJlc3RyaWN0aW9uVmVyaWZpZXIpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRQYXVzZWQoYm9vbCBzaG91bGRQYXVzZSkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgcGF1c2VkID0gc2hvdWxkUGF1c2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVwZGF0ZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgICAKfQoKCgoKY29udHJhY3QgQ2FyZENvbmZpZyB7CiAgICBlbnVtIFR5cGUge01vbnN0ZXIsIFNwZWxsfSAvLyBNb3JlIGNvdWxkIGNvbWUhCgogICAgZW51bSBSYWNlIHtEcmFnb24sIFNwaWRlcmxpbmcsIERlbW9uLCBIdW1hbm9pZCwgQmVhc3QsIFVuZGVhZCwgRWxlbWVudGFsLCBWYW1waXJlLCBTZXJwZW50LCBNZWNoLCBHb2xlbSwgUGFyYXNpdGV9CiAgICB1aW50MTYgY29uc3RhbnQgbnVtUmFjZXMgPSAxMjsKCiAgICBlbnVtIFRyYWl0IHtOb3JtYWwsIEZpcmUsIFBvaXNvbiwgTGlnaHRuaW5nLCBJY2UsIERpdmluZSwgU2hhZG93LCBBcmNhbmUsIEN1cnNlZCwgVm9pZH0KICAgIHVpbnQxNiBjb25zdGFudCBudW1UcmFpdHMgPSAxMDsKCiAgICBmdW5jdGlvbiBnZXRUeXBlKHVpbnQzMiByYW5kb21TZWVkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICBpZiAocmFuZG9tU2VlZCAlIDUgPiAwKSB7IC8vIDgwJSBjaGFuY2UgZm9yIG1vbnN0ZXIgKHNwZWxscyBhcmUgbGVzcyBmdW4gc28gbWFrZSB1cCBmb3IgaXQgaW4gcmFyaXR5KQogICAgICAgICAgICByZXR1cm4gdWludDgoVHlwZS5Nb25zdGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdWludDgoVHlwZS5TcGVsbCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRSYWNlKHVpbnQzMiByYW5kb21TZWVkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gdWludDgoUmFjZShyYW5kb21TZWVkICUgbnVtUmFjZXMpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUcmFpdCh1aW50MzIgcmFuZG9tU2VlZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIHVpbnQ4KFRyYWl0KHJhbmRvbVNlZWQgJSBudW1UcmFpdHMpKTsKICAgIH0KCiAgICBTcGVsbEFiaWxpdGllcyBzcGVsbEFiaWxpdGllcyA9IG5ldyBTcGVsbEFiaWxpdGllcygpOwogICAgU2hhcmVkTmV1dHJhbE11dGF0aW9ucyBuZXV0cmFsTXV0YXRpb25zID0gbmV3IFNoYXJlZE5ldXRyYWxNdXRhdGlvbnMoKTsKICAgIERyYWdvbk11dGF0aW9ucyBkcmFnb25NdXRhdGlvbnMgPSBuZXcgRHJhZ29uTXV0YXRpb25zKCk7CiAgICBTcGlkZXJsaW5nTXV0YXRpb25zIHNwaWRlcmxpbmdNdXRhdGlvbnMgPSBuZXcgU3BpZGVybGluZ011dGF0aW9ucygpOwogICAgRGVtb25NdXRhdGlvbnMgZGVtb25NdXRhdGlvbnMgPSBuZXcgRGVtb25NdXRhdGlvbnMoKTsKICAgIEh1bWFub2lkTXV0YXRpb25zIGh1bWFub2lkTXV0YXRpb25zID0gbmV3IEh1bWFub2lkTXV0YXRpb25zKCk7CiAgICBCZWFzdE11dGF0aW9ucyBiZWFzdE11dGF0aW9ucyA9IG5ldyBCZWFzdE11dGF0aW9ucygpOwogICAgVW5kZWFkTXV0YXRpb25zIHVuZGVhZE11dGF0aW9ucyA9IG5ldyBVbmRlYWRNdXRhdGlvbnMoKTsKICAgIEVsZW1lbnRhbE11dGF0aW9ucyBlbGVtZW50YWxNdXRhdGlvbnMgPSBuZXcgRWxlbWVudGFsTXV0YXRpb25zKCk7CiAgICBWYW1waXJlTXV0YXRpb25zIHZhbXBpcmVNdXRhdGlvbnMgPSBuZXcgVmFtcGlyZU11dGF0aW9ucygpOwogICAgU2VycGVudE11dGF0aW9ucyBzZXJwZW50TXV0YXRpb25zID0gbmV3IFNlcnBlbnRNdXRhdGlvbnMoKTsKICAgIE1lY2hNdXRhdGlvbnMgbWVjaE11dGF0aW9ucyA9IG5ldyBNZWNoTXV0YXRpb25zKCk7CiAgICBHb2xlbU11dGF0aW9ucyBnb2xlbU11dGF0aW9ucyA9IG5ldyBHb2xlbU11dGF0aW9ucygpOwogICAgUGFyYXNpdGVNdXRhdGlvbnMgcGFyYXNpdGVNdXRhdGlvbnMgPSBuZXcgUGFyYXNpdGVNdXRhdGlvbnMoKTsKICAgIAoKICAgIC8vIFRoZSBwb3dlcmZ1bCBzY2hlbWEgdGhhdCB3aWxsIGFsbG93IHRoZSBXb3Jrc2hvcCAoY3J5c3RhbCkgcHJpY2VzIHRvIGZsdWN0dWF0ZSBiYXNlZCBvbiBwZXJmb3JtYW5jZSwga2VlcGluZyB0aGUgZ2FtZSBmcmVzaCAmIGV2b2x2ZSBvdmVyIHRpbWUhCiAgICAKICAgIGZ1bmN0aW9uIGdldENvc3RGb3JSYWNlKHVpbnQ4IHJhY2UpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCBjb3N0KSB7CiAgICAgICAgcmV0dXJuIDA7IC8vIGJvcm4gZXF1YWwgKHVuZGVyIGN1cnJlbnQgY29uZmlnKQogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDb3N0Rm9yVHJhaXQodWludDggdHJhaXQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjQgY29zdCkgewogICAgICAgIGlmICh0cmFpdCA9PSB1aW50OChDYXJkQ29uZmlnLlRyYWl0Lk5vcm1hbCkpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiA0MDAwMDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0U3BlbGxBYmlsaXR5KHVpbnQzMiByYW5kb21TZWVkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI0IGNvc3QsIHVpbnQ4IHNwZWxsKSB7CiAgICAgICAgc3BlbGwgPSB1aW50OChzcGVsbEFiaWxpdGllcy5nZXRTcGVsbChyYW5kb21TZWVkKSkgKyAxOwogICAgICAgIHJldHVybiAoZ2V0U3BlbGxBYmlsaXR5Q29zdChzcGVsbCksIHNwZWxsKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0U3BlbGxBYmlsaXR5Q29zdCh1aW50OCBzcGVsbCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNCBjb3N0KSB7CiAgICAgICAgcmV0dXJuIDEwMDAwMDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXROZXV0cmFsTXV0YXRpb24odWludDMyIHJhbmRvbVNlZWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjQgY29zdCwgdWludDggbXV0YXRpb24pIHsKICAgICAgICBtdXRhdGlvbiA9IHVpbnQ4KG5ldXRyYWxNdXRhdGlvbnMuZ2V0TXV0YXRpb24ocmFuZG9tU2VlZCkpICsgMTsKICAgICAgICByZXR1cm4gKGdldE5ldXRyYWxNdXRhdGlvbkNvc3QobXV0YXRpb24pLCBtdXRhdGlvbik7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldE5ldXRyYWxNdXRhdGlvbkNvc3QodWludDggbXV0YXRpb24pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjQgY29zdCkgewogICAgICAgIGlmIChtdXRhdGlvbiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOyAgIAogICAgICAgIH0KICAgICAgICByZXR1cm4gNDAwMDA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TXV0YXRpb25Gb3JSYWNlKFJhY2UgcmFjZSwgdWludDMyIHJhbmRvbVNlZWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjQgY29zdCwgdWludDggbXV0YXRpb24pIHsKICAgICAgICBpZiAocmFjZSA9PSBSYWNlLkRyYWdvbikgewogICAgICAgICAgICBtdXRhdGlvbiA9IHVpbnQ4KGRyYWdvbk11dGF0aW9ucy5nZXRSYWNlTXV0YXRpb24ocmFuZG9tU2VlZCkpICsgMTsKICAgICAgICB9IGVsc2UgaWYgKHJhY2UgPT0gUmFjZS5TcGlkZXJsaW5nKSB7CiAgICAgICAgICAgIG11dGF0aW9uID0gdWludDgoc3BpZGVybGluZ011dGF0aW9ucy5nZXRSYWNlTXV0YXRpb24ocmFuZG9tU2VlZCkpICsgMTsKICAgICAgICB9IGVsc2UgaWYgKHJhY2UgPT0gUmFjZS5EZW1vbikgewogICAgICAgICAgICBtdXRhdGlvbiA9IHVpbnQ4KGRlbW9uTXV0YXRpb25zLmdldFJhY2VNdXRhdGlvbihyYW5kb21TZWVkKSkgKyAxOwogICAgICAgIH0gZWxzZSBpZiAocmFjZSA9PSBSYWNlLkh1bWFub2lkKSB7CiAgICAgICAgICAgIG11dGF0aW9uID0gdWludDgoaHVtYW5vaWRNdXRhdGlvbnMuZ2V0UmFjZU11dGF0aW9uKHJhbmRvbVNlZWQpKSArIDE7CiAgICAgICAgfSBlbHNlIGlmIChyYWNlID09IFJhY2UuQmVhc3QpIHsKICAgICAgICAgICAgbXV0YXRpb24gPSB1aW50OChiZWFzdE11dGF0aW9ucy5nZXRSYWNlTXV0YXRpb24ocmFuZG9tU2VlZCkpICsgMTsKICAgICAgICB9IGVsc2UgaWYgKHJhY2UgPT0gUmFjZS5VbmRlYWQpIHsKICAgICAgICAgICAgbXV0YXRpb24gPSB1aW50OCh1bmRlYWRNdXRhdGlvbnMuZ2V0UmFjZU11dGF0aW9uKHJhbmRvbVNlZWQpKSArIDE7CiAgICAgICAgfSBlbHNlIGlmIChyYWNlID09IFJhY2UuRWxlbWVudGFsKSB7CiAgICAgICAgICAgIG11dGF0aW9uID0gdWludDgoZWxlbWVudGFsTXV0YXRpb25zLmdldFJhY2VNdXRhdGlvbihyYW5kb21TZWVkKSkgKyAxOwogICAgICAgIH0gZWxzZSBpZiAocmFjZSA9PSBSYWNlLlZhbXBpcmUpIHsKICAgICAgICAgICAgbXV0YXRpb24gPSB1aW50OCh2YW1waXJlTXV0YXRpb25zLmdldFJhY2VNdXRhdGlvbihyYW5kb21TZWVkKSkgKyAxOwogICAgICAgIH0gZWxzZSBpZiAocmFjZSA9PSBSYWNlLlNlcnBlbnQpIHsKICAgICAgICAgICAgbXV0YXRpb24gPSB1aW50OChzZXJwZW50TXV0YXRpb25zLmdldFJhY2VNdXRhdGlvbihyYW5kb21TZWVkKSkgKyAxOwogICAgICAgIH0gZWxzZSBpZiAocmFjZSA9PSBSYWNlLk1lY2gpIHsKICAgICAgICAgICAgbXV0YXRpb24gPSB1aW50OChtZWNoTXV0YXRpb25zLmdldFJhY2VNdXRhdGlvbihyYW5kb21TZWVkKSkgKyAxOwogICAgICAgIH0gZWxzZSBpZiAocmFjZSA9PSBSYWNlLkdvbGVtKSB7CiAgICAgICAgICAgIG11dGF0aW9uID0gdWludDgoZ29sZW1NdXRhdGlvbnMuZ2V0UmFjZU11dGF0aW9uKHJhbmRvbVNlZWQpKSArIDE7CiAgICAgICAgfSBlbHNlIGlmIChyYWNlID09IFJhY2UuUGFyYXNpdGUpIHsKICAgICAgICAgICAgbXV0YXRpb24gPSB1aW50OChwYXJhc2l0ZU11dGF0aW9ucy5nZXRSYWNlTXV0YXRpb24ocmFuZG9tU2VlZCkpICsgMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChnZXRSYWNlTXV0YXRpb25Db3N0KHJhY2UsIG11dGF0aW9uKSwgbXV0YXRpb24pOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRSYWNlTXV0YXRpb25Db3N0KFJhY2UgcmFjZSwgdWludDggbXV0YXRpb24pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjQgY29zdCkgewogICAgICAgIGlmIChtdXRhdGlvbiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOyAgIAogICAgICAgIH0KICAgICAgICByZXR1cm4gNDAwMDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldENvc3RGb3JIZWFsdGgodWludDggaGVhbHRoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI0IGNvc3QpIHsKICAgICAgICByZXR1cm4gaGVhbHRoICogdWludDI0KDIwMDApOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRIZWFsdGhGb3JDb3N0KHVpbnQzMiBjb3N0KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDMyIGhlYWx0aCkgewogICAgICAgIGhlYWx0aCA9IGNvc3QgLyAyMDAwOwogICAgICAgIGlmIChoZWFsdGggPiA5OCkgeyAvLyAxK1swLTk4XSAoZ290dGEgaGF2ZSBbMS05OV0gaGVhbHRoKQogICAgICAgICAgICBoZWFsdGggPSA5ODsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhlYWx0aDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0Q29zdEZvckF0dGFjayh1aW50OCBhdHRhY2spIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjQgY29zdCkgewogICAgICAgIHJldHVybiBhdHRhY2sgKiB1aW50MjQoMjAwMCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldEF0dGFja0ZvckNvc3QodWludDMyIGNvc3QpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MzIgYXR0YWNrKSB7CiAgICAgICBhdHRhY2sgPSBjb3N0IC8gMjAwMDsKICAgICAgICBpZiAoYXR0YWNrID4gOTkpIHsKICAgICAgICAgICAgYXR0YWNrID0gOTk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhdHRhY2s7CiAgICB9CiAgICAKfQoKY29udHJhY3QgU3BlbGxBYmlsaXRpZXMgewogICAgZW51bSBTcGVsbHMge0xhdmFCbGFzdCwgRmxhbWVOb3ZhLCBQdXJpZnksIEljZUJsYXN0LCBGbGFzaEZyb3N0LCBTbm93U3Rvcm0sIEZyb3N0Rmx1cnJ5LCBDaGFyZ2VGb3dhcmQsIERlZXBGcmVlemUsIFRoYXdUYXJnZXQsCiAgICAgICAgICAgICAgICAgRmxhc2hPZkxpZ2h0LCBMaWdodEJlYWNvbiwgQmxhY2tIb2xlLCBFYXJ0aHF1YWtlLCBFbmNoYW50QXJtb3IsIEVuY2hhbnRXZWFwb24sIENhbGxSZWluZm9yY2VtZW50cywgUGFyYWx5c2lzUG90aW9uLAogICAgICAgICAgICAgICAgIEluZmxpY3RGZWFyLCBBcmNhbmVWaXNpb24sIEtpbGxTaG90LCBEcmFnb25zQnJlYXRoLCBHbGFjaWFsU2hhcmQsIEJsYWNrQXJyb3csIERpdmluZUtub3dsZWRnZSwgTGlnaHRuaW5nVm9ydGV4LAogICAgICAgICAgICAgICAgIFNvbGFyRmxhcmUsIFByaW1hbEJ1cnN0LCBSYWdpbmdTdG9ybSwgR2lhbnRDeWNsb25lLCBVbmxlYXNoRGFya25lc3MsIENoYXJnZWRPcmIsIFVuaG9seU1pZ2h0LCBQb3dlclNoaWVsZCwgSGFsbG93ZWRNaXN0LAogICAgICAgICAgICAgICAgIEVtYnJhY2VMaWdodCwgQWNpZFJhaW4sIEJvbmVGbHVycnksIFJlanV2ZW5hdGlvbiwgRGVhdGhHcmlwLCBTdW1tb25Td2FybSwgTWFnaWNhbENoYXJtLCBFbmNoYW50ZWRTaWxlbmNlLCBTb2xlbW5TdHJpa2UsCiAgICAgICAgICAgICAgICAgSW1wZW5kaW5nRG9vbSwgU3ByZWFkaW5nRmxhbWVzLCBTaGFkb3dMYW5jZSwgSGF1bnRlZEN1cnNlLCBMaWdodG5pbmdTaG9jaywgUG93ZXJTdXJnZX0KICAgIHVpbnQxNiBjb25zdGFudCBudW1TcGVsbHMgPSA1MDsKCiAgICBmdW5jdGlvbiBnZXRTcGVsbCh1aW50MzIgcmFuZG9tU2VlZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFNwZWxscyBzcGVsbCkgewogICAgICAgIHJldHVybiBTcGVsbHMocmFuZG9tU2VlZCAlIG51bVNwZWxscyk7CiAgICB9Cn0KCgpjb250cmFjdCBTaGFyZWROZXV0cmFsTXV0YXRpb25zIHsKICAgIGVudW0gTXV0YXRpb25zIHtGcm9udGxpbmUsIENhbGxSZWluZm9yY2VtZW50cywgQXJtb3JQaWVyY2luZywgQmF0dGxlY3J5LCBIZWFsQWxseSwgTGV2ZWxVcCwgU2Vjb25kV2luZCwgQ2hhcmdpbmdTdHJpa2UsIFNwZWxsU2hpZWxkLCBBdWdtZW50TWFnaWMsIENyeXN0YWxTaXBob24sIAogICAgICAgICAgICAgICAgICAgIE1hbmlwdWxhdGVDcnlzdGFscywgRGVhZGx5RGVtaXNlLCBGbGFtZVJlc2lzdGFuY2UsIEljZVJlc2lzdGFuY2UsIExpZ2h0bmluZ1Jlc2lzdGFuY2UsIFBvaXNvblJlc2lzdGFuY2UsIEN1cnNlUmVzaXN0YW5jZSwgRHJhZ29uU2xheWVyLCBTcGlkZXJsaW5nU2xheWVyLAogICAgICAgICAgICAgICAgICAgIFZhbXBpcmVTbGF5ZXIsIERlbW9uU2xheWVyLCBIdW1hbm9pZFNsYXllciwgQmVhc3RTbGF5ZXIsIFVuZGVhZFNsYXllciwgU2VycGVudFNsYXllciwgTWVjaFNsYXllciwgR29sZW1TbGF5ZXIsIEVsZW1lbnRhbFNsYXllciwgUGFyYXNpdGVTbGF5ZXJ9CiAgICB1aW50MTYgY29uc3RhbnQgbnVtTXV0YXRpb25zID0gMzA7CgogICAgZnVuY3Rpb24gZ2V0TXV0YXRpb24odWludDMyIHJhbmRvbVNlZWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChNdXRhdGlvbnMgbXV0YXRpb24pIHsKICAgICAgICByZXR1cm4gTXV0YXRpb25zKHJhbmRvbVNlZWQgJSBudW1NdXRhdGlvbnMpOwogICAgfQp9CgoKY29udHJhY3QgRHJhZ29uTXV0YXRpb25zIHsKICAgIGVudW0gUmFjZU11dGF0aW9ucyB7RmlyZUJyZWF0aCwgSG9ybmVkVGFpbCwgQmxvb2RNYWdpYywgQmFyYmVkU2NhbGVzLCBXaW5nZWRGbGlnaHQsIEVnZ1NwYXduLCBDaHJvbm9zaGlmdCwgUGhvZW5peEZlYXRoZXJzfQogICAgdWludDE2IGNvbnN0YW50IG51bU11dGF0aW9ucyA9IDg7CgogICAgZnVuY3Rpb24gZ2V0UmFjZU11dGF0aW9uKHVpbnQzMiByYW5kb21TZWVkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoUmFjZU11dGF0aW9ucyBtdXRhdGlvbikgewogICAgICAgIHJldHVybiBSYWNlTXV0YXRpb25zKHJhbmRvbVNlZWQgJSBudW1NdXRhdGlvbnMpOwogICAgfQp9Cgpjb250cmFjdCBTcGlkZXJsaW5nTXV0YXRpb25zIHsKICAgIGVudW0gUmFjZU11dGF0aW9ucyB7Q3JpcHBsaW5nQml0ZSwgQnVycm93VHJhcCwgU2tpdHRlcmluZ0ZyZW56eSwgRWdnU3Bhd24sIENyaXR0ZXJSdXNoLCBXZWJDb2Nvb24sIFN1bW1vbkJyb29kbW90aGVyLCBUcmVtb3JTZW5zZX0KICAgIHVpbnQxNiBjb25zdGFudCBudW1NdXRhdGlvbnMgPSA4OwoKICAgIGZ1bmN0aW9uIGdldFJhY2VNdXRhdGlvbih1aW50MzIgcmFuZG9tU2VlZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFJhY2VNdXRhdGlvbnMgbXV0YXRpb24pIHsKICAgICAgICByZXR1cm4gUmFjZU11dGF0aW9ucyhyYW5kb21TZWVkICUgbnVtTXV0YXRpb25zKTsKICAgIH0KfQoKY29udHJhY3QgVmFtcGlyZU11dGF0aW9ucyB7CiAgICBlbnVtIFJhY2VNdXRhdGlvbnMge0Jsb29kbGluaywgTGlmZUxlZWNoLCBCbG9vZGx1c3QsIERpYW1vbmRTa2luLCBUd2lsaWdodFZpc2lvbiwgUmVnZW5lcmF0aW9uLCBQaWVyY2luZ0ZhbmdzLCBTaGFkb3dzdHJpa2V9CiAgICB1aW50MTYgY29uc3RhbnQgbnVtTXV0YXRpb25zID0gODsKCiAgICBmdW5jdGlvbiBnZXRSYWNlTXV0YXRpb24odWludDMyIHJhbmRvbVNlZWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChSYWNlTXV0YXRpb25zIG11dGF0aW9uKSB7CiAgICAgICAgcmV0dXJuIFJhY2VNdXRhdGlvbnMocmFuZG9tU2VlZCAlIG51bU11dGF0aW9ucyk7CiAgICB9Cn0KCmNvbnRyYWN0IERlbW9uTXV0YXRpb25zIHsKICAgIGVudW0gUmFjZU11dGF0aW9ucyB7UHlyZVNjYWxlcywgU2hhZG93UmVhbG0sIE1lbmFjaW5nR2F6ZSwgSGVsbGZpcmUsIFJhaXNlQXNoLCBUYWlsTGFzaCwgUmVhcFNvdWxzLCBCbGFkZWRUYWxvbnN9CiAgICB1aW50MTYgY29uc3RhbnQgbnVtTXV0YXRpb25zID0gODsKCiAgICBmdW5jdGlvbiBnZXRSYWNlTXV0YXRpb24odWludDMyIHJhbmRvbVNlZWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChSYWNlTXV0YXRpb25zIG11dGF0aW9uKSB7CiAgICAgICAgcmV0dXJuIFJhY2VNdXRhdGlvbnMocmFuZG9tU2VlZCAlIG51bU11dGF0aW9ucyk7CiAgICB9Cn0KCmNvbnRyYWN0IEh1bWFub2lkTXV0YXRpb25zIHsKICAgIGVudW0gUmFjZU11dGF0aW9ucyB7R2Fycmlzb24sIEVudHJlbmNoLCBGbGFnYmVhcmVyLCBMZWdpb25Db21tYW5kZXIsIFNjb3V0QWhlYWQsIFZlbmdlYW5jZSwgRW5jaGFudGVkQmxhZGUsIEhvcnNlUmlkZXJ9CiAgICB1aW50MTYgY29uc3RhbnQgbnVtTXV0YXRpb25zID0gODsKCiAgICBmdW5jdGlvbiBnZXRSYWNlTXV0YXRpb24odWludDMyIHJhbmRvbVNlZWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChSYWNlTXV0YXRpb25zIG11dGF0aW9uKSB7CiAgICAgICAgcmV0dXJuIFJhY2VNdXRhdGlvbnMocmFuZG9tU2VlZCAlIG51bU11dGF0aW9ucyk7CiAgICB9Cn0KCmNvbnRyYWN0IEJlYXN0TXV0YXRpb25zIHsKICAgIGVudW0gUmFjZU11dGF0aW9ucyB7RmVyYWxSb2FyLCBGZWxpbmVDbGF3cywgUHJpbWl0aXZlVHVza3MsIEFyY3RpY0Z1ciwgUGFja0h1bnRlciwgRmVpZ25EZWF0aCwgUmF2ZW5vdXNCaXRlLCBOaWdodFByb3dsfQogICAgdWludDE2IGNvbnN0YW50IG51bU11dGF0aW9ucyA9IDg7CgogICAgZnVuY3Rpb24gZ2V0UmFjZU11dGF0aW9uKHVpbnQzMiByYW5kb21TZWVkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoUmFjZU11dGF0aW9ucyBtdXRhdGlvbikgewogICAgICAgIHJldHVybiBSYWNlTXV0YXRpb25zKHJhbmRvbVNlZWQgJSBudW1NdXRhdGlvbnMpOwogICAgfQp9Cgpjb250cmFjdCBVbmRlYWRNdXRhdGlvbnMgewogICAgZW51bSBSYWNlTXV0YXRpb25zIHtSZWNvbnN0cnVjdCwgQW5pbWF0ZURlYWQsIFBlc3RpbGVuY2UsIENyeXN0YWxTa3VsbCwgUHN5Y2hpY1NjcmVlY2gsIFJhdmFnZVN3aXBlLCBTcGlyaXRGb3JtLCBCb25lU3Bpa2VzfQogICAgdWludDE2IGNvbnN0YW50IG51bU11dGF0aW9ucyA9IDg7CgogICAgZnVuY3Rpb24gZ2V0UmFjZU11dGF0aW9uKHVpbnQzMiByYW5kb21TZWVkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoUmFjZU11dGF0aW9ucyBtdXRhdGlvbikgewogICAgICAgIHJldHVybiBSYWNlTXV0YXRpb25zKHJhbmRvbVNlZWQgJSBudW1NdXRhdGlvbnMpOwogICAgfQp9Cgpjb250cmFjdCBTZXJwZW50TXV0YXRpb25zIHsKICAgIGVudW0gUmFjZU11dGF0aW9ucyB7Q29uc3RyaWN0LCBCdXJyb3dpbmdTdHJpa2UsIFBldHJpZnlpbmdHYXplLCBFZ2dTcGF3biwgU2hlZFNjYWxlcywgU3RvbmVCYXNpbGlzaywgRW5ndWxmUHJleSwgU3ByYXlWZW5vbX0KICAgIHVpbnQxNiBjb25zdGFudCBudW1NdXRhdGlvbnMgPSA4OwoKICAgIGZ1bmN0aW9uIGdldFJhY2VNdXRhdGlvbih1aW50MzIgcmFuZG9tU2VlZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFJhY2VNdXRhdGlvbnMgbXV0YXRpb24pIHsKICAgICAgICByZXR1cm4gUmFjZU11dGF0aW9ucyhyYW5kb21TZWVkICUgbnVtTXV0YXRpb25zKTsKICAgIH0KfQoKY29udHJhY3QgTWVjaE11dGF0aW9ucyB7CiAgICBlbnVtIFJhY2VNdXRhdGlvbnMge1doaXJsaW5nQmxhZGUsIFJvY2tldEJvb3N0ZXJzLCBTZWxmRGVzdHJ1Y3QsIEVNUFNjcmFtYmxlLCBTcGFyZVBhcnRzLCBEZWNvbnN0cnVjdCwgVHdpbkNhbm5vbnMsIFBvd2VyU2hpZWxkfQogICAgdWludDE2IGNvbnN0YW50IG51bU11dGF0aW9ucyA9IDg7CgogICAgZnVuY3Rpb24gZ2V0UmFjZU11dGF0aW9uKHVpbnQzMiByYW5kb21TZWVkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoUmFjZU11dGF0aW9ucyBtdXRhdGlvbikgewogICAgICAgIHJldHVybiBSYWNlTXV0YXRpb25zKHJhbmRvbVNlZWQgJSBudW1NdXRhdGlvbnMpOwogICAgfQp9Cgpjb250cmFjdCBHb2xlbU11dGF0aW9ucyB7CiAgICBlbnVtIFJhY2VNdXRhdGlvbnMge1N0b25lU2VudGluZWwsIFNoYXR0ZXJpbmdTbWFzaCwgQW5pbWF0ZU11ZCwgTW9sdGVuQ29yZSwgVHJlbW9yR3JvdW5kLCBWaW5lU3Byb3V0cywgRWxlbWVudGFsUm9hciwgRm9zc2lsQXJteX0KICAgIHVpbnQxNiBjb25zdGFudCBudW1NdXRhdGlvbnMgPSA4OwoKICAgIGZ1bmN0aW9uIGdldFJhY2VNdXRhdGlvbih1aW50MzIgcmFuZG9tU2VlZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFJhY2VNdXRhdGlvbnMgbXV0YXRpb24pIHsKICAgICAgICByZXR1cm4gUmFjZU11dGF0aW9ucyhyYW5kb21TZWVkICUgbnVtTXV0YXRpb25zKTsKICAgIH0KfQoKY29udHJhY3QgRWxlbWVudGFsTXV0YXRpb25zIHsKICAgIGVudW0gUmFjZU11dGF0aW9ucyB7U2FuZHN0b3JtLCBTb2xhckZsYXJlLCBFbGVjdHJpY1N1cmdlLCBBcXVhUnVzaCwgU3Bpcml0Q2hhbm5lbCwgUGhhc2VTaGlmdCwgQ29zbWljQXVyYSwgTmF0dXJlc1dyYXRofQogICAgdWludDE2IGNvbnN0YW50IG51bU11dGF0aW9ucyA9IDg7CgogICAgZnVuY3Rpb24gZ2V0UmFjZU11dGF0aW9uKHVpbnQzMiByYW5kb21TZWVkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoUmFjZU11dGF0aW9ucyBtdXRhdGlvbikgewogICAgICAgIHJldHVybiBSYWNlTXV0YXRpb25zKHJhbmRvbVNlZWQgJSBudW1NdXRhdGlvbnMpOwogICAgfQp9Cgpjb250cmFjdCBQYXJhc2l0ZU11dGF0aW9ucyB7CiAgICBlbnVtIFJhY2VNdXRhdGlvbnMge0luZmVzdGF0aW9uLCBCbG9vZExlZWNoLCBDb3JydXB0aW9uLCBQcm90ZWN0aXZlU2hlbGwsIFRhaWxTd2lwZSwgRXhwb3NlV291bmQsIFN0aW5naW5nVGVudGFjbGVzLCBFcnVwdGl2ZUd1dH0KICAgIHVpbnQxNiBjb25zdGFudCBudW1NdXRhdGlvbnMgPSA4OwoKICAgIGZ1bmN0aW9uIGdldFJhY2VNdXRhdGlvbih1aW50MzIgcmFuZG9tU2VlZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKFJhY2VNdXRhdGlvbnMgbXV0YXRpb24pIHsKICAgICAgICByZXR1cm4gUmFjZU11dGF0aW9ucyhyYW5kb21TZWVkICUgbnVtTXV0YXRpb25zKTsKICAgIH0KfQoKLy8gUHVsbGluZyBjaGVja3MgbGlrZSB0aGlzIGludG8gc2Vjb25kYXJ5IGNvbnRyYWN0IGFsbG93cyBmb3IgbW9yZSBleHRlbnNpYmlsaXR5IGluIGZ1dHVyZSAoTG9hbk1hcmtldHBsYWNlIGFuZCBzbyBmb3J0aC4pCmNvbnRyYWN0IFRyYW5zZmVyUmVzdHJpY3Rpb25WZXJpZmllciB7CiAgICBNYXBwZWRNYXJrZXRwbGFjZSBtYXJrZXRwbGFjZUNvbnRyYWN0ID0gTWFwcGVkTWFya2V0cGxhY2UoMHhjM2QyNzM2YjNlNGYwZjc4NDU3ZDc1YjNiNWYwMTkxYTE0ZThiZDU3KTsKICAgIAogICAgZnVuY3Rpb24gaXNBdmFpbGFibGVGb3JUcmFuc2Zlcih1aW50NjQgY2FyZElkKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gIW1hcmtldHBsYWNlQ29udHJhY3QuaXNMaXN0ZWQoY2FyZElkKTsKICAgIH0KfQoKY29udHJhY3QgTWFwcGVkTWFya2V0cGxhY2UgewogICAgRXRoZXJHZW5Db3JlIHN0b3JhZ2VDb250cmFjdDsgLy8gTWFpbiBjYXJkIHN0b3JhZ2UgYW5kIEVSQzcyMSB0cmFuc2ZlciBmdW5jdGlvbmFsaXR5CiAgICBUcmFuc2ZlclJlc3RyaWN0aW9uVmVyaWZpZXIgdHJhbnNmZXJSZXN0cmljdGlvblZlcmlmaWVyOyAvLyBBbGxvd3MgZnV0dXJlIHN0dWZmIChsb2FuIG1hcmtldHBsYWNlIGV0Yy4pIHRvIHJlc3RyaWN0IGxpc3Rpbmcgc2FtZSBjYXJkIHR3aWNlCiAgICAKICAgIHVpbnQyNCBwcml2YXRlIGNvbnN0YW50IHJlbW92YWxEdXJhdGlvbiA9IDE0IGRheXM7IC8vIExpc3RpbmdzIGNhbiBiZSBwcnVuZWQgZnJvbSBtYXJrZXQgYWZ0ZXIgMTQgZGF5cwogICAgdWludDggcHJpdmF0ZSBjb25zdGFudCBtYXJrZXRDdXQgPSAxMDA7IC8vIDElIChub3QgMTAwJSBhcyBpdCBpcyBkaXZpZGVkKQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIgPSAweDA4RjRhRTk2YjY0N0IzMDE3N2NjMTVCMjExOTU5NjA2MjVCQTQxNjM7CiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgICBtYXBwaW5nKHVpbnQ2NCA9PiBMaXN0aW5nKSBwcml2YXRlIGxpc3RpbmdzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHByaXZhdGUgd2hpdGVsaXN0ZWRDb250cmFjdHM7CiAgICB1aW50NjRbXSBwcml2YXRlIGxpc3RlZENhcmRJZHM7CgogICAgc3RydWN0IExpc3RpbmcgewogICAgICAgIHVpbnQ2NCBsaXN0aW5nUG9pbnRlcjsgLy8gSW5kZXggaW4gdGhlIE1hcmtldCdzIGxpc3RpbmdzCiAgICAgICAgCiAgICAgICAgdWludDY0IGNhcmRJZDsKICAgICAgICB1aW50NjQgbGlzdFRpbWU7IC8vIFNlY29uZHMKICAgICAgICB1aW50MTI4IHN0YXJ0UHJpY2U7CiAgICAgICAgdWludDEyOCBlbmRQcmljZTsKICAgICAgICB1aW50MjQgcHJpY2VDaGFuZ2VEdXJhdGlvbjsgLy8gU2Vjb25kcwogICAgfQogICAgCiAgICBmdW5jdGlvbiBpc0xpc3RlZCh1aW50NjQgY2FyZElkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYgKGxpc3RlZENhcmRJZHMubGVuZ3RoID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gKGxpc3RpbmdzW2NhcmRJZF0ubGlzdFRpbWUgPiAwKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0TWFya2V0U2l6ZSgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBsaXN0ZWRDYXJkSWRzLmxlbmd0aDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbGlzdENhcmQodWludDY0IGNhcmRJZCwgdWludDEyOCBzdGFydFByaWNlLCB1aW50MTI4IGVuZFByaWNlLCB1aW50MjQgcHJpY2VDaGFuZ2VEdXJhdGlvbikgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoc3RvcmFnZUNvbnRyYWN0Lm93bmVyT2YoY2FyZElkKSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICByZXF1aXJlKHN0b3JhZ2VDb250cmFjdC5pc0NhcmRUcmFkZWFibGUoY2FyZElkKSk7CiAgICAgICAgcmVxdWlyZSh0cmFuc2ZlclJlc3RyaWN0aW9uVmVyaWZpZXIuaXNBdmFpbGFibGVGb3JUcmFuc2ZlcihjYXJkSWQpKTsKICAgICAgICByZXF1aXJlKGlzV2hpdGVsaXN0ZWQobXNnLnNlbmRlcikpOwogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgcmVxdWlyZShzdGFydFByaWNlID4gOTkgc3phYm8gJiYgc3RhcnRQcmljZSA8PSAxMCBldGhlcik7CiAgICAgICAgcmVxdWlyZShlbmRQcmljZSA+IDk5IHN6YWJvICYmIGVuZFByaWNlIDw9IDEwIGV0aGVyKTsKICAgICAgICByZXF1aXJlKHByaWNlQ2hhbmdlRHVyYXRpb24gPiAyMTU5OSAmJiBwcmljZUNoYW5nZUR1cmF0aW9uIDwgMjU5MjAxKTsgLy8gNi03MiBIb3VycwogICAgICAgCiAgICAgICAgbGlzdGluZ3NbY2FyZElkXSA9IExpc3RpbmcoMCwgY2FyZElkLCB1aW50NjQobm93KSwgc3RhcnRQcmljZSwgZW5kUHJpY2UsIHByaWNlQ2hhbmdlRHVyYXRpb24pOwogICAgICAgIGxpc3RpbmdzW2NhcmRJZF0ubGlzdGluZ1BvaW50ZXIgPSB1aW50NjQobGlzdGVkQ2FyZElkcy5wdXNoKGNhcmRJZCkgLSAxKTsKICAgIH0KICAgIAogICAgCiAgICBmdW5jdGlvbiBwdXJjaGFzZUNhcmQodWludDY0IGNhcmRJZCkgcGF5YWJsZSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShpc0xpc3RlZChjYXJkSWQpKTsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwoKICAgICAgICB1aW50MjU2IHByaWNlID0gZ2V0Q3VycmVudFByaWNlKGxpc3RpbmdzW2NhcmRJZF0uc3RhcnRQcmljZSwgbGlzdGluZ3NbY2FyZElkXS5lbmRQcmljZSwgbGlzdGluZ3NbY2FyZElkXS5wcmljZUNoYW5nZUR1cmF0aW9uLCAodWludDY0KG5vdykgLSBsaXN0aW5nc1tjYXJkSWRdLmxpc3RUaW1lKSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcHJpY2UpOwogICAgICAgIAogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gc3RvcmFnZUNvbnRyYWN0Lm93bmVyT2YoY2FyZElkKTsKICAgICAgICB1aW50MjU2IHNlbGxlclByb2NlZWRzID0gcHJpY2UgLSAocHJpY2UgLyBtYXJrZXRDdXQpOyAvLyAxJSBjdXQKICAgICAgICAKICAgICAgICByZW1vdmVMaXN0aW5nSW50ZXJuYWwoY2FyZElkKTsKICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgYmlkRXhjZXNzID0gbXNnLnZhbHVlIC0gcHJpY2U7CiAgICAgICAgaWYgKGJpZEV4Y2VzcyA+IDEgc3phYm8pIHsgLy8gTGl0dGxlIHBvaW50IG90aGVyd2lzZSB0aGV5J2xsIGp1c3QgcGF5IG1vcmUgaW4gZ2FzCiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmlkRXhjZXNzKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc3RvcmFnZUNvbnRyYWN0LnRyYW5zZmVyRnJvbShzZWxsZXIsIG1zZy5zZW5kZXIsIGNhcmRJZCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50MTI4IHN0YXJ0UHJpY2UsIHVpbnQxMjggZW5kUHJpY2UsIHVpbnQyNCBwcmljZUNoYW5nZUR1cmF0aW9uLCB1aW50NjQgc2Vjb25kc1NpbmNlTGlzdGluZykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoc2Vjb25kc1NpbmNlTGlzdGluZyA+PSBwcmljZUNoYW5nZUR1cmF0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiBlbmRQcmljZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpbnQyNTYgdG90YWxQcmljZUNoYW5nZSA9IGludDI1NihlbmRQcmljZSkgLSBpbnQyNTYoc3RhcnRQcmljZSk7IC8vIENhbiBiZSBuZWdhdGl2ZQogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlQ2hhbmdlID0gdG90YWxQcmljZUNoYW5nZSAqIGludDI1NihzZWNvbmRzU2luY2VMaXN0aW5nKSAvIGludDI1NihwcmljZUNoYW5nZUR1cmF0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoaW50MjU2KHN0YXJ0UHJpY2UpICsgY3VycmVudFByaWNlQ2hhbmdlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJlbW92ZUxpc3RpbmcodWludDY0IGNhcmRJZCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoaXNMaXN0ZWQoY2FyZElkKSk7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICByZXF1aXJlKHN0b3JhZ2VDb250cmFjdC5vd25lck9mKGNhcmRJZCkgPT0gbXNnLnNlbmRlciB8fCAobm93IC0gbGlzdGluZ3NbY2FyZElkXS5saXN0VGltZSkgPiByZW1vdmFsRHVyYXRpb24pOwogICAgICAgIHJlbW92ZUxpc3RpbmdJbnRlcm5hbChjYXJkSWQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmVMaXN0aW5nSW50ZXJuYWwodWludDY0IGNhcmRJZCkgaW50ZXJuYWwgewogICAgICAgIGlmIChsaXN0ZWRDYXJkSWRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgdWludDY0IHJvd1RvRGVsZXRlID0gbGlzdGluZ3NbY2FyZElkXS5saXN0aW5nUG9pbnRlcjsKICAgICAgICAgICAgdWludDY0IGtleVRvTW92ZSA9IGxpc3RlZENhcmRJZHNbbGlzdGVkQ2FyZElkcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxpc3RlZENhcmRJZHNbcm93VG9EZWxldGVdID0ga2V5VG9Nb3ZlOwogICAgICAgICAgICBsaXN0aW5nc1trZXlUb01vdmVdLmxpc3RpbmdQb2ludGVyID0gcm93VG9EZWxldGU7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxpc3RlZENhcmRJZHMubGVuZ3RoLS07CiAgICAgICAgZGVsZXRlIGxpc3RpbmdzW2NhcmRJZF07CiAgICB9CiAgICAKICAgIAogICAgZnVuY3Rpb24gZ2V0TGlzdGluZ3MoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjRbXSwgYWRkcmVzc1tdLCB1aW50NjRbXSwgdWludDEyOFtdLCB1aW50MTI4W10sIHVpbnQyNFtdLCB1aW50OFsxNF1bXSkgewogICAgICAgIHVpbnQ2NFtdIG1lbW9yeSBjYXJkSWRzID0gbmV3IHVpbnQ2NFtdKGxpc3RlZENhcmRJZHMubGVuZ3RoKTsgLy8gTm90IGlkZWFsIGJ1dCB3ZWIzLmpzIGRpZG4ndCBsaWtlIHJldHVybmluZyBtdWx0aXBsZSAyZCBhcnJheXMKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IGNhcmRPd25lcnMgPSBuZXcgYWRkcmVzc1tdKGxpc3RlZENhcmRJZHMubGVuZ3RoKTsKICAgICAgICB1aW50NjRbXSBtZW1vcnkgbGlzdFRpbWVzID0gbmV3IHVpbnQ2NFtdKGxpc3RlZENhcmRJZHMubGVuZ3RoKTsKICAgICAgICB1aW50MTI4W10gbWVtb3J5IHN0YXJ0UHJpY2VzID0gbmV3IHVpbnQxMjhbXShsaXN0ZWRDYXJkSWRzLmxlbmd0aCk7CiAgICAgICAgdWludDEyOFtdIG1lbW9yeSBlbmRQcmljZXMgPSBuZXcgdWludDEyOFtdKGxpc3RlZENhcmRJZHMubGVuZ3RoKTsKICAgICAgICB1aW50MjRbXSBtZW1vcnkgcHJpY2VDaGFuZ2VEdXJhdGlvbnMgPSBuZXcgdWludDI0W10obGlzdGVkQ2FyZElkcy5sZW5ndGgpOwogICAgICAgIHVpbnQ4WzE0XVtdIG1lbW9yeSBjYXJkRGV0YWlscyA9IG5ldyB1aW50OFsxNF1bXShsaXN0ZWRDYXJkSWRzLmxlbmd0aCk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50NjQgaSA9IDA7IGkgPCBsaXN0ZWRDYXJkSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIExpc3RpbmcgbWVtb3J5IGxpc3RpbmcgPSBsaXN0aW5nc1tsaXN0ZWRDYXJkSWRzW2ldXTsKICAgICAgICAgICAgY2FyZERldGFpbHNbaV0gPSBzdG9yYWdlQ29udHJhY3QuZ2V0Q2FyZChsaXN0aW5nLmNhcmRJZCk7CiAgICAgICAgICAgIGNhcmRPd25lcnNbaV0gPSBzdG9yYWdlQ29udHJhY3Qub3duZXJPZihsaXN0aW5nLmNhcmRJZCk7CiAgICAgICAgICAgIGNhcmRJZHNbaV0gPSBsaXN0aW5nLmNhcmRJZDsKICAgICAgICAgICAgbGlzdFRpbWVzW2ldID0gbGlzdGluZy5saXN0VGltZTsKICAgICAgICAgICAgc3RhcnRQcmljZXNbaV0gPSBsaXN0aW5nLnN0YXJ0UHJpY2U7CiAgICAgICAgICAgIGVuZFByaWNlc1tpXSA9IGxpc3RpbmcuZW5kUHJpY2U7CiAgICAgICAgICAgIHByaWNlQ2hhbmdlRHVyYXRpb25zW2ldID0gbGlzdGluZy5wcmljZUNoYW5nZUR1cmF0aW9uOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGNhcmRJZHMsIGNhcmRPd25lcnMsIGxpc3RUaW1lcywgc3RhcnRQcmljZXMsIGVuZFByaWNlcywgcHJpY2VDaGFuZ2VEdXJhdGlvbnMsIGNhcmREZXRhaWxzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0TGlzdGluZ0F0UG9zaXRpb24odWludDY0IGkpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQxMjhbNV0pIHsKICAgICAgICBMaXN0aW5nIG1lbW9yeSBsaXN0aW5nID0gbGlzdGluZ3NbbGlzdGVkQ2FyZElkc1tpXV07CiAgICAgICAgcmV0dXJuIChbbGlzdGluZy5jYXJkSWQsIGxpc3RpbmcubGlzdFRpbWUsIGxpc3Rpbmcuc3RhcnRQcmljZSwgbGlzdGluZy5lbmRQcmljZSwgbGlzdGluZy5wcmljZUNoYW5nZUR1cmF0aW9uXSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldExpc3RpbmcodWludDY0IGNhcmRJZCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDEyOFs1XSkgewogICAgICAgIExpc3RpbmcgbWVtb3J5IGxpc3RpbmcgPSBsaXN0aW5nc1tjYXJkSWRdOwogICAgICAgIHJldHVybiAoW2xpc3RpbmcuY2FyZElkLCBsaXN0aW5nLmxpc3RUaW1lLCBsaXN0aW5nLnN0YXJ0UHJpY2UsIGxpc3RpbmcuZW5kUHJpY2UsIGxpc3RpbmcucHJpY2VDaGFuZ2VEdXJhdGlvbl0pOwogICAgfQogICAgCiAgICAvLyBDb250cmFjdHMgY2FuJ3QgbGlzdCBjYXJkcyB3aXRob3V0IGNvbnRhY3RpbmcgdXMgKHdhbGxldCBhZGRyZXNzZXMgYXJlIHVuYWZmZWN0ZWQpCiAgICBmdW5jdGlvbiBpc1doaXRlbGlzdGVkKGFkZHJlc3Mgc2VsbGVyKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGFzc2VtYmx5IHsgc2l6ZSA6PSBleHRjb2Rlc2l6ZShzZWxsZXIpIH0KICAgICAgICByZXR1cm4gc2l6ZSA9PSAwIHx8IHdoaXRlbGlzdGVkQ29udHJhY3RzW3NlbGxlcl07CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHdoaXRlbGlzdENvbnRyYWN0KGFkZHJlc3Mgc2VsbGVyLCBib29sIHdoaXRlbGlzdGVkKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICB3aGl0ZWxpc3RlZENvbnRyYWN0c1tzZWxsZXJdID0gd2hpdGVsaXN0ZWQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVwZGF0ZVN0b3JhZ2VDb250cmFjdChhZGRyZXNzIG5ld1N0b3JhZ2UpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHN0b3JhZ2VDb250cmFjdCA9IEV0aGVyR2VuQ29yZShuZXdTdG9yYWdlKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdXBkYXRlVHJhbnNmZXJSZXN0cmljdGlvblZlcmlmaWVyKGFkZHJlc3MgbmV3VHJhbnNmZXJSZXN0cmljdGlvblZlcmlmaWVyKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICB0cmFuc2ZlclJlc3RyaWN0aW9uVmVyaWZpZXIgPSBUcmFuc2ZlclJlc3RyaWN0aW9uVmVyaWZpZXIobmV3VHJhbnNmZXJSZXN0cmljdGlvblZlcmlmaWVyKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0UGF1c2VkKGJvb2wgc2hvdWxkUGF1c2UpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIHBhdXNlZCA9IHNob3VsZFBhdXNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1cGRhdGVPd25lcihhZGRyZXNzIG5ld093bmVyKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKfQ=='.
	

]
