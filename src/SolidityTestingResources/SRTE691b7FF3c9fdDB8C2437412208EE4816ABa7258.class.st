Class {
	#name : #SRTE691b7FF3c9fdDB8C2437412208EE4816ABa7258,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTE691b7FF3c9fdDB8C2437412208EE4816ABa7258 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgpsaWJyYXJ5IE1hdGggewogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgTGVnYWxMYXp5U2NoZWR1bGVyIGlzIE93bmFibGUgewogICAgdWludDY0IHB1YmxpYyBsYXN0VXBkYXRlOwogICAgdWludDY0IHB1YmxpYyBpbnRlcnZhbER1cmF0aW9uOwogICAgYm9vbCBzY2hlZHVsZXJFbmFibGVkID0gZmFsc2U7CiAgICBmdW5jdGlvbigpIGludGVybmFsIGNhbGxiYWNrOwoKICAgIGV2ZW50IExvZ1JlZ2lzdGVyZWRJbnRlcnZhbCh1aW50NjQgZGF0ZSwgdWludDY0IGR1cmF0aW9uKTsKICAgIGV2ZW50IExvZ1Byb2Nlc3NlZEludGVydmFsKHVpbnQ2NCBkYXRlLCB1aW50NjQgaW50ZXJ2YWxzKTsgICAgCiAgICAvKioKICAgICogVHJpZ2dlcnMgdGhlIHJlZ2lzdGVyZWQgY2FsbGJhY2sgZnVuY3Rpb24gZm9yIHRoZSBudW1iZXIgb2YgcGVyaW9kcyBwYXNzZWQgc2luY2UgbGFzdCB1cGRhdGUKICAgICovCiAgICBtb2RpZmllciBpbnRlcnZhbFRyaWdnZXIoKSB7CiAgICAgICAgdWludDY0IGN1cnJlbnRUaW1lID0gdWludDY0KG5vdyk7CiAgICAgICAgdWludDY0IHJlcXVpcmVkSW50ZXJ2YWxzID0gKGN1cnJlbnRUaW1lIC0gbGFzdFVwZGF0ZSkgLyBpbnRlcnZhbER1cmF0aW9uOwogICAgICAgIGlmKCBzY2hlZHVsZXJFbmFibGVkICYmIChyZXF1aXJlZEludGVydmFscyA+IDApKSB7CiAgICAgICAgICAgIExvZ1Byb2Nlc3NlZEludGVydmFsKGxhc3RVcGRhdGUsIHJlcXVpcmVkSW50ZXJ2YWxzKTsKICAgICAgICAgICAgd2hpbGUgKHJlcXVpcmVkSW50ZXJ2YWxzLS0gPiAwKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxhc3RVcGRhdGUgPSBjdXJyZW50VGltZTsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gTGVnYWxMYXp5U2NoZWR1bGVyKCkgewogICAgICAgIGxhc3RVcGRhdGUgPSB1aW50NjQobm93KTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmFibGVTY2hlZHVsZXIoKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBzY2hlZHVsZXJFbmFibGVkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlckludGVydmFsQ2FsbCh1aW50NjQgX2ludGVydmFsRHVyYXRpb24sIGZ1bmN0aW9uKCkgaW50ZXJuYWwgX2NhbGxiYWNrKSBpbnRlcm5hbCB7CiAgICAgICAgbGFzdFVwZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgICAgIGludGVydmFsRHVyYXRpb24gPSBfaW50ZXJ2YWxEdXJhdGlvbjsKICAgICAgICBjYWxsYmFjayA9IF9jYWxsYmFjazsKICAgICAgICBMb2dSZWdpc3RlcmVkSW50ZXJ2YWwobGFzdFVwZGF0ZSwgaW50ZXJ2YWxEdXJhdGlvbik7ICAgICAgICAKICAgIH0KfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBMaW1pdGVkVHJhbnNmZXJUb2tlbiBpcyBFUkMyMCB7CgogIC8qKgogICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgaXQgY2FuIHRyYW5zZmVyIG9yIG90aGVyd2lzZSB0aHJvd3MuCiAgICovCiAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfc2VuZGVyLCB1aW50MjU2IF92YWx1ZSkgewogICAgcmVxdWlyZShfdmFsdWUgPD0gdHJhbnNmZXJhYmxlVG9rZW5zKF9zZW5kZXIsIHVpbnQ2NChub3cpKSk7CiAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IENoZWNrcyBtb2RpZmllciBhbmQgYWxsb3dzIHRyYW5zZmVyIGlmIHRva2VucyBhcmUgbm90IGxvY2tlZC4KICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICAvKioKICAqIEBkZXYgQ2hlY2tzIG1vZGlmaWVyIGFuZCBhbGxvd3MgdHJhbnNmZXIgaWYgdG9rZW5zIGFyZSBub3QgbG9ja2VkLgogICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBzZW5kIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSB0b2tlbnMuCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20sIF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9CgogIC8qKgogICAqIEBkZXYgRGVmYXVsdCB0cmFuc2ZlcmFibGUgdG9rZW5zIGZ1bmN0aW9uIHJldHVybnMgYWxsIHRva2VucyBmb3IgYSBob2xkZXIgKG5vIGxpbWl0KS4KICAgKiBAZGV2IE92ZXJ3cml0aW5nIHRyYW5zZmVyYWJsZVRva2VucyhhZGRyZXNzIGhvbGRlciwgdWludDY0IHRpbWUpIGlzIHRoZSB3YXkgdG8gcHJvdmlkZSB0aGUKICAgKiBzcGVjaWZpYyBsb2dpYyBmb3IgbGltaXRpbmcgdG9rZW4gdHJhbnNmZXJhYmlsaXR5IGZvciBhIGhvbGRlciBvdmVyIHRpbWUuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBiYWxhbmNlT2YoaG9sZGVyKTsKICB9Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIHVpbnQyNTYgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9Cgpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgTWludEZpbmlzaGVkKCk7CgogIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwoKCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBtaW50IHRva2VucwogICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1pbnRlZCB0b2tlbnMuCiAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgKiBAcmV0dXJuIEEgYm9vbGVhbiB0aGF0IGluZGljYXRlcyBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyIGNhbk1pbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgTWludChfdG8sIF9hbW91bnQpOwogICAgVHJhbnNmZXIoMHgwLCBfdG8sIF9hbW91bnQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIHN0b3AgbWludGluZyBuZXcgdG9rZW5zLgogICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHdhcyBzdWNjZXNzZnVsLgogICAqLwogIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBvbmx5T3duZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBNaW50RmluaXNoZWQoKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKY29udHJhY3QgVmVzdGVkVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgTGltaXRlZFRyYW5zZmVyVG9rZW4sIE93bmFibGUgewoKICB1aW50MjU2IE1BWF9HUkFOVFNfUEVSX0FERFJFU1MgPSAyMDsKCiAgc3RydWN0IFRva2VuR3JhbnQgewogICAgYWRkcmVzcyBncmFudGVyOyAgICAgLy8gMjAgYnl0ZXMKICAgIHVpbnQyNTYgdmFsdWU7ICAgICAgIC8vIDMyIGJ5dGVzCiAgICB1aW50NjQgY2xpZmY7CiAgICB1aW50NjQgdmVzdGluZzsKICAgIHVpbnQ2NCBzdGFydDsgICAgICAgIC8vIDMgKiA4ID0gMjQgYnl0ZXMKICAgIGJvb2wgcmV2b2thYmxlOwogICAgYm9vbCBidXJuc09uUmV2b2tlOyAgLy8gMiAqIDEgPSAyIGJpdHM/IG9yIDIgYnl0ZXM/CiAgfSAvLyB0b3RhbCA3OCBieXRlcyA9IDMgc3N0b3JlIHBlciBvcGVyYXRpb24gKDMyIHBlciBzc3RvcmUpCgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gVG9rZW5HcmFudFtdKSBwdWJsaWMgZ3JhbnRzOwoKICBldmVudCBOZXdUb2tlbkdyYW50KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgZ3JhbnRJZCk7CgogIC8qKgogICAqIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGdyYW50ZWQgdG8uCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGdyYW50ZWQuCiAgICogQHBhcmFtIF9zdGFydCB1aW50NjQgVGltZSBvZiB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudC4KICAgKiBAcGFyYW0gX2NsaWZmIHVpbnQ2NCBUaW1lIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICogQHBhcmFtIF92ZXN0aW5nIHVpbnQ2NCBUaGUgdmVzdGluZyBwZXJpb2QuCiAgICovCiAgZnVuY3Rpb24gZ3JhbnRWZXN0ZWRUb2tlbnMoCiAgICBhZGRyZXNzIF90bywKICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgdWludDY0IF9zdGFydCwKICAgIHVpbnQ2NCBfY2xpZmYsCiAgICB1aW50NjQgX3Zlc3RpbmcsCiAgICBib29sIF9yZXZva2FibGUsCiAgICBib29sIF9idXJuc09uUmV2b2tlCiAgKSBvbmx5T3duZXIgcHVibGljIHsKCiAgICAvLyBDaGVjayBmb3IgZGF0ZSBpbmNvbnNpc3RlbmNpZXMgdGhhdCBtYXkgY2F1c2UgdW5leHBlY3RlZCBiZWhhdmlvcgogICAgcmVxdWlyZShfY2xpZmYgPj0gX3N0YXJ0ICYmIF92ZXN0aW5nID49IF9jbGlmZik7CgogICAgcmVxdWlyZSh0b2tlbkdyYW50c0NvdW50KF90bykgPCBNQVhfR1JBTlRTX1BFUl9BRERSRVNTKTsgICAvLyBUbyBwcmV2ZW50IGEgdXNlciBiZWluZyBzcGFtbWVkIGFuZCBoYXZlIGhpcyBiYWxhbmNlIGxvY2tlZCAob3V0IG9mIGdhcyBhdHRhY2sgd2hlbiBjYWxjdWxhdGluZyB2ZXN0aW5nKS4KCiAgICB1aW50MjU2IGNvdW50ID0gZ3JhbnRzW190b10ucHVzaCgKICAgICAgICAgICAgICAgIFRva2VuR3JhbnQoCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUgPyBtc2cuc2VuZGVyIDogMCwgLy8gYXZvaWQgc3RvcmluZyBhbiBleHRyYSAyMCBieXRlcyB3aGVuIGl0IGlzIG5vbi1yZXZva2FibGUKICAgICAgICAgICAgICAgICAgX3ZhbHVlLAogICAgICAgICAgICAgICAgICBfY2xpZmYsCiAgICAgICAgICAgICAgICAgIF92ZXN0aW5nLAogICAgICAgICAgICAgICAgICBfc3RhcnQsCiAgICAgICAgICAgICAgICAgIF9yZXZva2FibGUsCiAgICAgICAgICAgICAgICAgIF9idXJuc09uUmV2b2tlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgKTsKCiAgICB0cmFuc2ZlcihfdG8sIF92YWx1ZSk7CgogICAgTmV3VG9rZW5HcmFudChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgY291bnQgLSAxKTsKICB9CgogIC8qKgogICAqIEBkZXYgUmV2b2tlIHRoZSBncmFudCBvZiB0b2tlbnMgb2YgYSBzcGVjaWZlZCBhZGRyZXNzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICovCiAgZnVuY3Rpb24gcmV2b2tlVG9rZW5HcmFudChhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX2dyYW50SWQpIHB1YmxpYyB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIHJlcXVpcmUoZ3JhbnQucmV2b2thYmxlKTsKICAgIHJlcXVpcmUoZ3JhbnQuZ3JhbnRlciA9PSBtc2cuc2VuZGVyKTsgLy8gT25seSBncmFudGVyIGNhbiByZXZva2UgaXQKCiAgICBhZGRyZXNzIHJlY2VpdmVyID0gZ3JhbnQuYnVybnNPblJldm9rZSA/IDB4ZGVhZCA6IG1zZy5zZW5kZXI7CgogICAgdWludDI1NiBub25WZXN0ZWQgPSBub25WZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKCiAgICAvLyByZW1vdmUgZ3JhbnQgZnJvbSBhcnJheQogICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXVtfZ3JhbnRJZF07CiAgICBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdID0gZ3JhbnRzW19ob2xkZXJdW2dyYW50c1tfaG9sZGVyXS5sZW5ndGguc3ViKDEpXTsKICAgIGdyYW50c1tfaG9sZGVyXS5sZW5ndGggLT0gMTsKCiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKG5vblZlc3RlZCk7CiAgICBiYWxhbmNlc1tfaG9sZGVyXSA9IGJhbGFuY2VzW19ob2xkZXJdLnN1Yihub25WZXN0ZWQpOwoKICAgIFRyYW5zZmVyKF9ob2xkZXIsIHJlY2VpdmVyLCBub25WZXN0ZWQpOwogIH0KCgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdHJhbnNmZXJhYmxlIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEBwYXJhbSB0aW1lIHVpbnQ2NCBUaGUgc3BlY2lmaWMgdGltZS4KICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIGEgaG9sZGVyJ3MgdG90YWwgYW1vdW50IG9mIHRyYW5zZmVyYWJsZSB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlVG9rZW5zKGFkZHJlc3MgaG9sZGVyLCB1aW50NjQgdGltZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgZ3JhbnRJbmRleCA9IHRva2VuR3JhbnRzQ291bnQoaG9sZGVyKTsKCiAgICBpZiAoZ3JhbnRJbmRleCA9PSAwKSAKICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyYWJsZVRva2Vucyhob2xkZXIsIHRpbWUpOyAvLyBzaG9ydGN1dCBmb3IgaG9sZGVyIHdpdGhvdXQgZ3JhbnRzCgogICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgZ3JhbnRzIHRoZSBob2xkZXIgaGFzLCBhbmQgYWRkIGFsbCBub24tdmVzdGVkIHRva2VucwogICAgdWludDI1NiBub25WZXN0ZWQgPSAwOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIG5vblZlc3RlZCA9IFNhZmVNYXRoLmFkZChub25WZXN0ZWQsIG5vblZlc3RlZFRva2VucyhncmFudHNbaG9sZGVyXVtpXSwgdGltZSkpOwogICAgfQoKICAgIC8vIEJhbGFuY2UgLSB0b3RhbE5vblZlc3RlZCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhIGhvbGRlciBjYW4gdHJhbnNmZXIgYXQgYW55IGdpdmVuIHRpbWUKICAgIHVpbnQyNTYgdmVzdGVkVHJhbnNmZXJhYmxlID0gU2FmZU1hdGguc3ViKGJhbGFuY2VPZihob2xkZXIpLCBub25WZXN0ZWQpOwoKICAgIC8vIFJldHVybiB0aGUgbWluaW11bSBvZiBob3cgbWFueSB2ZXN0ZWQgY2FuIHRyYW5zZmVyIGFuZCBvdGhlciB2YWx1ZQogICAgLy8gaW4gY2FzZSB0aGVyZSBhcmUgb3RoZXIgbGltaXRpbmcgdHJhbnNmZXJhYmlsaXR5IGZhY3RvcnMgKGRlZmF1bHQgaXMgYmFsYW5jZU9mKQogICAgcmV0dXJuIE1hdGgubWluMjU2KHZlc3RlZFRyYW5zZmVyYWJsZSwgc3VwZXIudHJhbnNmZXJhYmxlVG9rZW5zKGhvbGRlciwgdGltZSkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDaGVjayB0aGUgYW1vdW50IG9mIGdyYW50cyB0aGF0IGFuIGFkZHJlc3MgaGFzLgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBob2xkZXIgb2YgdGhlIGdyYW50cy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiByZXByZXNlbnRpbmcgdGhlIHRvdGFsIGFtb3VudCBvZiBncmFudHMuCiAgICovCiAgZnVuY3Rpb24gdG9rZW5HcmFudHNDb3VudChhZGRyZXNzIF9ob2xkZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGluZGV4KSB7CiAgICByZXR1cm4gZ3JhbnRzW19ob2xkZXJdLmxlbmd0aDsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmaWMgdGltZQogICAqIEBwYXJhbSB0b2tlbnMgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyBncmFudGVkCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcGFyYW0gc3RhcnQgdWludDY0IFRoZSB0aW1lIHJlcHJlc2VudGluZyB0aGUgYmVnaW5uaW5nIG9mIHRoZSBncmFudAogICAqIEBwYXJhbSBjbGlmZiB1aW50NjQgIFRoZSBjbGlmZiBwZXJpb2QsIHRoZSBwZXJpb2QgYmVmb3JlIG5vdGhpbmcgY2FuIGJlIHBhaWQgb3V0CiAgICogQHBhcmFtIHZlc3RpbmcgdWludDY0IFRoZSB2ZXN0aW5nIHBlcmlvZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQKICAgKiAgdHJhbnNmZXJhYmxlVG9rZW5zCiAgICogICB8ICAgICAgICAgICAgICAgICAgICAgICAgIF8vLS0tLS0tLS0gICB2ZXN0ZWRUb2tlbnMgcmVjdAogICAqICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgICBfLwogICAqICAgfCAgICAgICAgICAgICAgICAgXy8KICAgKiAgIHwgICAgICAgICAgICAgICAgLwogICAqICAgfCAgICAgICAgICAgICAgLnwKICAgKiAgIHwgICAgICAgICAgICAuICB8CiAgICogICB8ICAgICAgICAgIC4gICAgfAogICAqICAgfCAgICAgICAgLiAgICAgIHwKICAgKiAgIHwgICAgICAuICAgICAgICB8CiAgICogICB8ICAgIC4gICAgICAgICAgfAogICAqICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAqICAgICAgU3RhcnQgICAgICAgQ2xpZmYgICAgVmVzdGluZwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVZlc3RlZFRva2VucygKICAgIHVpbnQyNTYgdG9rZW5zLAogICAgdWludDI1NiB0aW1lLAogICAgdWludDI1NiBzdGFydCwKICAgIHVpbnQyNTYgY2xpZmYsCiAgICB1aW50MjU2IHZlc3RpbmcpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAvLyBTaG9ydGN1dHMgZm9yIGJlZm9yZSBjbGlmZiBhbmQgYWZ0ZXIgdmVzdGluZyBjYXNlcy4KICAgICAgaWYgKHRpbWUgPCBjbGlmZikgcmV0dXJuIDA7CiAgICAgIGlmICh0aW1lID49IHZlc3RpbmcpIHJldHVybiB0b2tlbnM7CgogICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2Vucy4KICAgICAgLy8gQXMgYmVmb3JlIGNsaWZmIHRoZSBzaG9ydGN1dCByZXR1cm5zIDAsIHdlIGNhbiB1c2UganVzdCBjYWxjdWxhdGUgYSB2YWx1ZQogICAgICAvLyBpbiB0aGUgdmVzdGluZyByZWN0IChhcyBzaG93biBpbiBhYm92ZSdzIGZpZ3VyZSkKCiAgICAgIC8vIHZlc3RlZFRva2VucyA9ICh0b2tlbnMgKiAodGltZSAtIHN0YXJ0KSkgLyAodmVzdGluZyAtIHN0YXJ0KQogICAgICB1aW50MjU2IHZlc3RlZFRva2VucyA9IFNhZmVNYXRoLmRpdigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGgubXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTYWZlTWF0aC5zdWIodGltZSwgc3RhcnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2FmZU1hdGguc3ViKHZlc3RpbmcsIHN0YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgcmV0dXJuIHZlc3RlZFRva2VuczsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIGdyYW50LgogICAqIEBwYXJhbSBfaG9sZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgaGF2ZSBpdHMgdG9rZW5zIHJldm9rZWQuCiAgICogQHBhcmFtIF9ncmFudElkIFRoZSBpZCBvZiB0aGUgdG9rZW4gZ3JhbnQuCiAgICogQHJldHVybiBSZXR1cm5zIGFsbCB0aGUgdmFsdWVzIHRoYXQgcmVwcmVzZW50IGEgVG9rZW5HcmFudChhZGRyZXNzLCB2YWx1ZSwgc3RhcnQsIGNsaWZmLAogICAqIHJldm9rYWJpbGl0eSwgYnVybnNPblJldm9rZSwgYW5kIHZlc3RpbmcpIHBsdXMgdGhlIHZlc3RlZCB2YWx1ZSBhdCB0aGUgY3VycmVudCB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHRva2VuR3JhbnQoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF9ncmFudElkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBncmFudGVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHZlc3RlZCwgdWludDY0IHN0YXJ0LCB1aW50NjQgY2xpZmYsIHVpbnQ2NCB2ZXN0aW5nLCBib29sIHJldm9rYWJsZSwgYm9vbCBidXJuc09uUmV2b2tlKSB7CiAgICBUb2tlbkdyYW50IHN0b3JhZ2UgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl1bX2dyYW50SWRdOwoKICAgIGdyYW50ZXIgPSBncmFudC5ncmFudGVyOwogICAgdmFsdWUgPSBncmFudC52YWx1ZTsKICAgIHN0YXJ0ID0gZ3JhbnQuc3RhcnQ7CiAgICBjbGlmZiA9IGdyYW50LmNsaWZmOwogICAgdmVzdGluZyA9IGdyYW50LnZlc3Rpbmc7CiAgICByZXZva2FibGUgPSBncmFudC5yZXZva2FibGU7CiAgICBidXJuc09uUmV2b2tlID0gZ3JhbnQuYnVybnNPblJldm9rZTsKCiAgICB2ZXN0ZWQgPSB2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHVpbnQ2NChub3cpKTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0IHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQgYXQgYSBzcGVjaWZpYyB0aW1lLgogICAqLwogIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhUb2tlbkdyYW50IGdyYW50LCB1aW50NjQgdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKAogICAgICBncmFudC52YWx1ZSwKICAgICAgdWludDI1Nih0aW1lKSwKICAgICAgdWludDI1NihncmFudC5zdGFydCksCiAgICAgIHVpbnQyNTYoZ3JhbnQuY2xpZmYpLAogICAgICB1aW50MjU2KGdyYW50LnZlc3RpbmcpCiAgICApOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBub24gdmVzdGVkIHRva2VucyBhdCBhIHNwZWNpZmljIHRpbWUuCiAgICogQHBhcmFtIGdyYW50IFRva2VuR3JhbnQgVGhlIGdyYW50IHRvIGJlIGNoZWNrZWQuCiAgICogQHBhcmFtIHRpbWUgdWludDY0IFRoZSB0aW1lIHRvIGJlIGNoZWNrZWQKICAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2Ygbm9uIHZlc3RlZCB0b2tlbnMgb2YgYSBzcGVjaWZpYyBncmFudCBvbiB0aGUKICAgKiBwYXNzZWQgdGltZSBmcmFtZS4KICAgKi8KICBmdW5jdGlvbiBub25WZXN0ZWRUb2tlbnMoVG9rZW5HcmFudCBncmFudCwgdWludDY0IHRpbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGdyYW50LnZhbHVlLnN1Yih2ZXN0ZWRUb2tlbnMoZ3JhbnQsIHRpbWUpKTsKICB9CgogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSBkYXRlIHdoZW4gdGhlIGhvbGRlciBjYW4gdHJhbnNmZXIgYWxsIGl0cyB0b2tlbnMKICAgKiBAcGFyYW0gaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlcgogICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGRhdGUgb2YgdGhlIGxhc3QgdHJhbnNmZXJhYmxlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBsYXN0VG9rZW5Jc1RyYW5zZmVyYWJsZURhdGUoYWRkcmVzcyBob2xkZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50NjQgZGF0ZSkgewogICAgZGF0ZSA9IHVpbnQ2NChub3cpOwogICAgdWludDI1NiBncmFudEluZGV4ID0gZ3JhbnRzW2hvbGRlcl0ubGVuZ3RoOwogICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgZ3JhbnRJbmRleDsgaSsrKSB7CiAgICAgIGRhdGUgPSBNYXRoLm1heDY0KGdyYW50c1tob2xkZXJdW2ldLnZlc3RpbmcsIGRhdGUpOwogICAgfQogIH0KfQoKY29udHJhY3QgTGVnYWxUb2tlbiBpcyBMZWdhbExhenlTY2hlZHVsZXIsIE1pbnRhYmxlVG9rZW4sIFZlc3RlZFRva2VuIHsKICAgIC8qKgogICAgKiBUaGUgbmFtZSBvZiB0aGUgdG9rZW4KICAgICovCiAgICBieXRlczMyIHB1YmxpYyBuYW1lOwoKICAgIC8qKgogICAgKiBUaGUgc3ltYm9sIHVzZWQgZm9yIGV4Y2hhbmdlCiAgICAqLwogICAgYnl0ZXMzMiBwdWJsaWMgc3ltYm9sOwoKICAgIC8qKgogICAgKiBVc2UgdG8gY29udmVydCB0byBudW1iZXIgb2YgdG9rZW5zLgogICAgKi8KICAgIHVpbnQgcHVibGljIGRlY2ltYWxzID0gMTg7CgogICAgLyoqCiAgICAqIFRoZSB5ZWFybHkgZXhwZWN0ZWQgaW5mbGF0aW9uIHJhdGUgaW4gYmFzZSBwb2ludHMuCiAgICAqLwogICAgdWludDMyIHB1YmxpYyBpbmZsYXRpb25Db21wQlBTOwoKICAgIC8qKgogICAgKiBUaGUgdG9rZW5zIGFyZSBsb2NrZWQgdW50aWwgdGhlIGVuZCBvZiB0aGUgVEdFLgogICAgKiBUaGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdGhlIHRva2VucyBpZiBUR0Ugc3VjY2Vzc2Z1bC4gSWYgZmFsc2Ugd2UgYXJlIGluIHRyYW5zZmVyIGxvY2sgdXAgcGVyaW9kLgogICAgKi8KICAgIGJvb2wgcHVibGljIHJlbGVhc2VkID0gZmFsc2U7CgogICAgLyoqCiAgICAqIEFubnVhbGx5IG5ldyBtaW50ZWQgdG9rZW5zIHdpbGwgYmUgdHJhbnNmZXJyZWQgdG8gdGhpcyB3YWxsZXQuCiAgICAqIFB1YmxpY2F0aW9ucyB3aWxsIGJlIHJld2FyZGVkIHdpdGggZnVuZHMgKGluY2VudGl2ZXMpLiAgCiAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgcmV3YXJkV2FsbGV0OwoKICAgIC8qKgogICAgKiBOYW1lIGFuZCBzeW1ib2wgd2VyZSB1cGRhdGVkLiAKICAgICovCiAgICBldmVudCBVcGRhdGVkVG9rZW5JbmZvcm1hdGlvbihieXRlczMyIG5ld05hbWUsIGJ5dGVzMzIgbmV3U3ltYm9sKTsKCiAgICAvKioKICAgICogQGRldiBDb25zdHJ1Y3RvciB0aGF0IGdpdmVzIG1zZy5zZW5kZXIgYWxsIG9mIGV4aXN0aW5nIHRva2Vucy4gCiAgICAqLwogICAgZnVuY3Rpb24gTGVnYWxUb2tlbihhZGRyZXNzIF9yZXdhcmRXYWxsZXQsIHVpbnQzMiBfaW5mbGF0aW9uQ29tcEJQUywgdWludDMyIF9pbmZsYXRpb25Db21wSW50ZXJ2YWwpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHNldFRva2VuSW5mb3JtYXRpb24oIkxlZ2FsIFRva2VuIiwgIkxHTCIpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gMDsgICAgICAgIAogICAgICAgIHJld2FyZFdhbGxldCA9IF9yZXdhcmRXYWxsZXQ7CiAgICAgICAgaW5mbGF0aW9uQ29tcEJQUyA9IF9pbmZsYXRpb25Db21wQlBTOwogICAgICAgIHJlZ2lzdGVySW50ZXJ2YWxDYWxsKF9pbmZsYXRpb25Db21wSW50ZXJ2YWwsIG1pbnRJbmZsYXRpb25QZXJpb2QpOwogICAgfSAgICAKCiAgICAvKioKICAgICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgdGhlIHRva2VuIG93bmVyIHRvIHJlbmFtZSB0aGUgdG9rZW4gYWZ0ZXIgdGhlIG9wZXJhdGlvbnMKICAgICogaGF2ZSBiZWVuIGNvbXBsZXRlZCBhbmQgdGhlbiBwb2ludCB0aGUgYXVkaWVuY2UgdG8gdXNlIHRoZSB0b2tlbiBjb250cmFjdC4KICAgICovCiAgICBmdW5jdGlvbiBzZXRUb2tlbkluZm9ybWF0aW9uKGJ5dGVzMzIgX25hbWUsIGJ5dGVzMzIgX3N5bWJvbCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICAgICAgVXBkYXRlZFRva2VuSW5mb3JtYXRpb24obmFtZSwgc3ltYm9sKTsKICAgIH0KCiAgICAvKioKICAgICogTWludCBuZXcgdG9rZW5zIGZvciB0aGUgcHJlZGVmaW5lZCBpbmZsYXRpb24gcGVyaW9kIGFuZCBhc3NpZ24gdGhlbSB0byB0aGUgcmV3YXJkIHdhbGxldC4gCiAgICAqLwogICAgZnVuY3Rpb24gbWludEluZmxhdGlvblBlcmlvZCgpIHByaXZhdGUgewogICAgICAgIHVpbnQyNTYgdG9rZW5zVG9NaW50ID0gdG90YWxTdXBwbHkubXVsKGluZmxhdGlvbkNvbXBCUFMpLmRpdigxMDAwMCk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQodG9rZW5zVG9NaW50KTsKICAgICAgICBiYWxhbmNlc1tyZXdhcmRXYWxsZXRdID0gYmFsYW5jZXNbcmV3YXJkV2FsbGV0XS5hZGQodG9rZW5zVG9NaW50KTsKICAgICAgICBNaW50KHJld2FyZFdhbGxldCwgdG9rZW5zVG9NaW50KTsKICAgICAgICBUcmFuc2ZlcigweDAsIHJld2FyZFdhbGxldCwgdG9rZW5zVG9NaW50KTsKICAgIH0gICAgIAogICAgCiAgICBmdW5jdGlvbiBzZXRSZXdhcmRXYWxsZXQoYWRkcmVzcyBfcmV3YXJkV2FsbGV0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXdhcmRXYWxsZXQgPSBfcmV3YXJkV2FsbGV0OwogICAgfQoKICAgIC8qKgogICAgKiBMaW1pdCB0b2tlbiB0cmFuc2ZlciB1bnRpbCB0aGUgVEdFIGlzIG92ZXIuCiAgICAqLwogICAgbW9kaWZpZXIgdG9rZW5SZWxlYXNlZChhZGRyZXNzIF9zZW5kZXIpIHsKICAgICAgICByZXF1aXJlKHJlbGVhc2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgKiBUaGlzIHdpbGwgbWFrZSB0aGUgdG9rZW5zIHRyYW5zZmVyYWJsZQogICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVsZWFzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIGVycm9yOiBjYW5UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdmFsdWUpCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyB0b2tlblJlbGVhc2VkKG1zZy5zZW5kZXIpIGludGVydmFsVHJpZ2dlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvLyBDYWxscyBTdGFuZGFyZFRva2VuLnRyYW5zZmVyKCkKICAgICAgICAvLyBlcnJvcjogc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHRva2VuUmVsZWFzZWQoX2Zyb20pIGludGVydmFsVHJpZ2dlciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvLyBDYWxscyBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB0b2tlblJlbGVhc2VkKG1zZy5zZW5kZXIpIGludGVydmFsVHJpZ2dlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gY2FsbHMgU3RhbmRhcmRUb2tlbi5hcHByb3ZlKC4uKQogICAgICAgIHJldHVybiBzdXBlci5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgLy8gY2FsbHMgU3RhbmRhcmRUb2tlbi5hbGxvd2FuY2UoLi4pCiAgICAgICAgcmV0dXJuIHN1cGVyLmFsbG93YW5jZShfb3duZXIsIF9zcGVuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgdG9rZW5SZWxlYXNlZChtc2cuc2VuZGVyKSBpbnRlcnZhbFRyaWdnZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy8gY2FsbHMgU3RhbmRhcmRUb2tlbi5pbmNyZWFzZUFwcHJvdmFsKC4uKQogICAgICAgIHJldHVybiBzdXBlci5pbmNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfYWRkZWRWYWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgdG9rZW5SZWxlYXNlZChtc2cuc2VuZGVyKSBpbnRlcnZhbFRyaWdnZXIgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgLy8gY2FsbHMgU3RhbmRhcmRUb2tlbi5kZWNyZWFzZUFwcHJvdmFsKC4uKQogICAgICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KfQ=='.
	

]
