Class {
	#name : #SRT1a70Fe4C8A7bA52Fd4b14a207928df42Cf9D7dAa,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1a70Fe4C8A7bA52Fd4b14a207928df42Cf9D7dAa >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCmNvbnRyYWN0IFdpbk1hdHJpeAogewogICBmdW5jdGlvbiBnZXRDb2VmZih1aW50MTYgbikgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7CiAgIGZ1bmN0aW9uIGdldEJldHNQcm9jZXNzZWQoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MTYpOwogfQoKY29udHJhY3QgU21hcnRSb3VsZXR0ZVRva2VuIAp7CiAgIGZ1bmN0aW9uIGVtaXNzaW9uKGFkZHJlc3MgcGxheWVyLCBhZGRyZXNzIHBhcnRuZXIsIHVpbnQyNTYgdmFsdWVfYmV0LCB1aW50MTYgY29lZl9wbGF5ZXIsIHVpbnQxNiBjb2VmX3BhcnRuZXIpIGV4dGVybmFsIHJldHVybnModWludDI1Nik7Cn0KCmNvbnRyYWN0IFNtYXJ0QWZmaWxpYXRlIAp7CiAgIGZ1bmN0aW9uIHJlZ2lzdGVyKGFkZHJlc3MgcGxheWVyLCBhZGRyZXNzIGFmZmlsaWF0ZSkgZXh0ZXJuYWw7CiAgIGZ1bmN0aW9uIGdldEFmZmlsaWF0ZUluZm8oYWRkcmVzcyBwbGF5ZXIpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcyBhZmZpbGlhdGUsIHVpbnQxNiBjb2VmX2FmZmlsaWF0ZSk7Cn0KCmNvbnRyYWN0IFNtYXJ0Um91bGV0dGUKewogICAgYWRkcmVzcyBkZXZlbG9wZXI7CiAgICBhZGRyZXNzIG9wZXJhdG9yOwoKICAgIC8vIFdhaXQgQmxvY2tEZWxheSBibG9ja3MgYmVmb3JlIHNwaW4gdGhlIHdoZWVsIAogICAgdWludDggQmxvY2tEZWxheTsKCiAgICAvLyBNYXhpbXVtIGJldCB2YWx1ZSBmb3IgZ2FtZQogICAgdWludDI1NiBjdXJyZW50TWF4QmV0OyAgICAKCiAgICAvLyBtYXhpbXVtIGdhbWVzIGNvdW50IHBlciBibG9jawogICAgdWludDY0IG1heEdhbWJsZXNQZXJCbG9jazsKICAgICAgICAKICAgIC8vIEVuYWJsZVxkaXNhYmxlIHRvIHBsYWNlIG5ldyBiZXRzCiAgICBib29sIENvbnRyYWN0U3RhdGU7CgogICAgLy8gdGFibGUgd2l0aCB3aW5uZXIgY29lZmZpY2llbnRzCiAgICBXaW5NYXRyaXggd2luTWF0cml4OwoKICAgIFNtYXJ0Um91bGV0dGVUb2tlbiBzbWFydFRva2VuOwoKICAgIGFkZHJlc3MgcHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3Q7CgogICAgU21hcnRBZmZpbGlhdGUgc21hcnRBZmZpbGlhdGVDb250cmFjdDsKCiAgICB1aW50MTYgY29uc3RhbnQgbWF4VHlwZUJldHMgPSAxNTc7CiAgICAgIAogICAvLyBsYXN0IGdhbWUgaW5kZXggZm9yIHBsYXllciAodXNlZCBmb3IgZmFzdCBhY2Nlc3MpCiAgIC8vbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50NjQpIHByaXZhdGUgZ2FtYmxlSW5kZXg7ICAgCiAgIAogICB1aW50MTYgY29lZl9wbGF5ZXI7ICAgCiAgIC8vIAogICB1aW50OCBkZWZhdWx0TWluQ3JlZGl0c09uQmV0OyAKICAgLy8KICAgbWFwcGluZyAodWludDggPT4gdWludDgpIHByaXZhdGUgbWluQ3JlZGl0c09uQmV0OwoKICAgc3RydWN0IEdhbWVJbmZvCiAgIHsKICAgICAgICBhZGRyZXNzIHBsYXllcjsKICAgICAgICB1aW50MjU2IGJsb2NrTnVtYmVyOwogICAgICAgIHVpbnQ4IHdoZWVsUmVzdWx0OwogICAgICAgIHVpbnQyNTYgYmV0czsKICAgICAgICBieXRlczMyIHZhbHVlczsKICAgICAgICBieXRlczMyIHZhbHVlczI7CiAgIH0KICAgICAgIAogICBHYW1lSW5mb1tdIHByaXZhdGUgZ2FtYmxlczsKCiAgIGVudW0gR2FtZVN0YXR1cyB7U3VjY2VzcywgU2tpcHBlZCwgU3RvcH0KCiAgIGVudW0gQmV0VHlwZXN7bnVtYmVyMCwgbnVtYmVyMSxudW1iZXIyLG51bWJlcjMsbnVtYmVyNCxudW1iZXI1LG51bWJlcjYsbnVtYmVyNyxudW1iZXI4LG51bWJlcjksCiAgICAgbnVtYmVyMTAsbnVtYmVyMTEsbnVtYmVyMTIsbnVtYmVyMTMsbnVtYmVyMTQsbnVtYmVyMTUsbnVtYmVyMTYsbnVtYmVyMTcsbnVtYmVyMTgsbnVtYmVyMTksbnVtYmVyMjAsbnVtYmVyMjEsCiAgICAgbnVtYmVyMjIsbnVtYmVyMjMsbnVtYmVyMjQsbnVtYmVyMjUsbnVtYmVyMjYsbnVtYmVyMjcsbnVtYmVyMjgsbnVtYmVyMjksbnVtYmVyMzAsbnVtYmVyMzEsbnVtYmVyMzIsbnVtYmVyMzMsCiAgICAgbnVtYmVyMzQsbnVtYmVyMzUsbnVtYmVyMzYsIHJlZCwgYmxhY2ssIG9kZCwgZXZlbiwgZG96ZW4xLGRvemVuMixkb3plbjMsIGNvbHVtbjEsY29sdW1uMixjb2x1bW4zLCBsb3csaGlnaCwKICAgICBwYWlyXzAxLCBwYWlyXzAyLCBwYWlyXzAzLCBwYWlyXzEyLCBwYWlyXzIzLCBwYWlyXzM2LCBwYWlyXzI1LCBwYWlyXzE0LCBwYWlyXzQ1LCBwYWlyXzU2LCBwYWlyXzY5LCBwYWlyXzU4LCBwYWlyXzQ3LAogICAgIHBhaXJfNzgsIHBhaXJfODksIHBhaXJfOTEyLCBwYWlyXzgxMSwgcGFpcl83MTAsIHBhaXJfMTAxMSwgcGFpcl8xMTEyLCBwYWlyXzEyMTUsIHBhaXJfMTUxOCwgcGFpcl8xNjE3LCBwYWlyXzE3MTgsIHBhaXJfMTcyMCwKICAgICBwYWlyXzE2MTksIHBhaXJfMTkyMiwgcGFpcl8yMDIzLCBwYWlyXzIxMjQsIHBhaXJfMjIyMywgcGFpcl8yMzI0LCBwYWlyXzI1MjgsIHBhaXJfMjYyOSwgcGFpcl8yNzMwLCBwYWlyXzI4MjksIHBhaXJfMjkzMCwgcGFpcl8xMTE0LAogICAgIHBhaXJfMTAxMywgcGFpcl8xMzE0LCBwYWlyXzE0MTUsIHBhaXJfMTMxNiwgcGFpcl8xNDE3LCBwYWlyXzE4MjEsIHBhaXJfMTkyMCwgcGFpcl8yMDIxLCBwYWlyXzIyMjUsIHBhaXJfMjMyNiwgcGFpcl8yNDI3LCBwYWlyXzI1MjYsCiAgICAgcGFpcl8yNjI3LCBwYWlyXzI4MzEsIHBhaXJfMjkzMiwgcGFpcl8zMDMzLCBwYWlyXzMxMzIsIHBhaXJfMzIzMywgcGFpcl8zMTM0LCBwYWlyXzMyMzUsIHBhaXJfMzMzNiwgcGFpcl8zNDM1LCBwYWlyXzM1MzYsIGNvcm5lcl8wXzFfMl8zLAogICAgIGNvcm5lcl8xXzJfNV80LCBjb3JuZXJfMl8zXzZfNSwgY29ybmVyXzRfNV84XzcsIGNvcm5lcl81XzZfOV84LCBjb3JuZXJfN184XzExXzEwLCBjb3JuZXJfOF85XzEyXzExLCBjb3JuZXJfMTBfMTFfMTRfMTMsIGNvcm5lcl8xMV8xMl8xNV8xNCwKICAgICBjb3JuZXJfMTNfMTRfMTdfMTYsIGNvcm5lcl8xNF8xNV8xOF8xNywgY29ybmVyXzE2XzE3XzIwXzE5LCBjb3JuZXJfMTdfMThfMjFfMjAsIGNvcm5lcl8xOV8yMF8yM18yMiwgY29ybmVyXzIwXzIxXzI0XzIzLCBjb3JuZXJfMjJfMjNfMjZfMjUsCiAgICAgY29ybmVyXzIzXzI0XzI3XzI2LCBjb3JuZXJfMjVfMjZfMjlfMjgsIGNvcm5lcl8yNl8yN18zMF8yOSwgY29ybmVyXzI4XzI5XzMyXzMxLCBjb3JuZXJfMjlfMzBfMzNfMzIsIGNvcm5lcl8zMV8zMl8zNV8zNCwgY29ybmVyXzMyXzMzXzM2XzM1LAogICAgIHRocmVlXzBfMl8zLCB0aHJlZV8wXzFfMiwgdGhyZWVfMV8yXzMsIHRocmVlXzRfNV82LCB0aHJlZV83XzhfOSwgdGhyZWVfMTBfMTFfMTIsIHRocmVlXzEzXzE0XzE1LCB0aHJlZV8xNl8xN18xOCwgdGhyZWVfMTlfMjBfMjEsIHRocmVlXzIyXzIzXzI0LAogICAgIHRocmVlXzI1XzI2XzI3LCB0aHJlZV8yOF8yOV8zMCwgdGhyZWVfMzFfMzJfMzMsIHRocmVlXzM0XzM1XzM2LCBzaXhfMV8yXzNfNF81XzYsIHNpeF80XzVfNl83XzhfOSwgc2l4XzdfOF85XzEwXzExXzEyLCBzaXhfMTBfMTFfMTJfMTNfMTRfMTUsCiAgICAgc2l4XzEzXzE0XzE1XzE2XzE3XzE4LCBzaXhfMTZfMTdfMThfMTlfMjBfMjEsIHNpeF8xOV8yMF8yMV8yMl8yM18yNCwgc2l4XzIyXzIzXzI0XzI1XzI2XzI3LCBzaXhfMjVfMjZfMjdfMjhfMjlfMzAsIHNpeF8yOF8yOV8zMF8zMV8zMl8zMywKICAgICBzaXhfMzFfMzJfMzNfMzRfMzVfMzZ9CiAgIAoKICAgZnVuY3Rpb24gU21hcnRSb3VsZXR0ZSgpIGludGVybmFsCiAgIHsgICAgICAgIAogICAgICAgIGRldmVsb3BlciAgPSBtc2cuc2VuZGVyOwogICAgICAgIG9wZXJhdG9yICAgPSBtc2cuc2VuZGVyOwogICAgICAgIAogICAgICAgIHdpbk1hdHJpeCA9IFdpbk1hdHJpeCgweDA3M0Q2NjIxRTkxNTBiRmY5ZDFENDUwY2FBZDNjNzkwYjZGMDcxRjIgKTsKICAgICAgICBpZiAod2luTWF0cml4LmdldEJldHNQcm9jZXNzZWQoKSAhPSBtYXhUeXBlQmV0cykgdGhyb3c7CiAgICAgICAgCiAgICAgICAgc21hcnRUb2tlbiA9IFNtYXJ0Um91bGV0dGVUb2tlbigweDdkRDhENGM1NTZkMjAwNWM1YmFmYzNkNTQ0OUE5OUZiNDYyNzlFNmIpOwoKICAgICAgICBjdXJyZW50TWF4QmV0ID0gMjU2MCBmaW5uZXk7IC8vIDIuNTYgZXRoZXIKICAgICAgICBCbG9ja0RlbGF5ID0gMTsgICAgICAgIAogICAgICAgIG1heEdhbWJsZXNQZXJCbG9jayA9IDU7CiAgICAgICAgZGVmYXVsdE1pbkNyZWRpdHNPbkJldCA9IDE7ICAgCiAgICAgICAgQ29udHJhY3RTdGF0ZSAgPSB0cnVlOyAgCiAgICAgICAgYmFua3JvbExpbWl0ID0gMjc3IGV0aGVyOwogICAgICAgIHByb2ZpdExpbWl0ICA9IDUwIGV0aGVyOwogICAgICAgIGNvZWZfcGxheWVyID0gMzAwOwogICB9CgogICBmdW5jdGlvbiBjaGFuZ2VNYXhCZXQodWludDI1NiBuZXdNYXhCZXQpIHB1YmxpYyBvbmx5RGV2ZWxvcGVyIAogICB7ICAgICAgICAgICAgIAogICAgICAvLyByb3VuZHMgdG8gMiBkaWd0cwogICAgICBuZXdNYXhCZXQgPSBuZXdNYXhCZXQgLyAyNTYwMDAwMDAwMDAwMDAwMDAwICogMjU2MDAwMDAwMDAwMDAwMDAwMDsgIAogICAgICBpZiAobmV3TWF4QmV0ICE9IGN1cnJlbnRNYXhCZXQpIAogICAgICB7CiAgICAgICAgY3VycmVudE1heEJldCA9IG5ld01heEJldDsKICAgICAgICBTZXR0aW5nc0NoYW5nZWQoY3VycmVudE1heEJldCwgY3VycmVudE1heEJldCAvIDI1NiwgIGRlZmF1bHRNaW5DcmVkaXRzT25CZXQsIG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5sb3cpXSwgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmRvemVuMSldLCBCbG9ja0RlbGF5LCBDb250cmFjdFN0YXRlKTsKICAgICAgfQogICB9CgogICB1aW50MjU2IGJhbmtyb2xMaW1pdDsKICAgdWludDI1NiBwcm9maXRMaW1pdDsKICAgdWludDI1NiBsYXN0RGlzdHJpYnV0ZWRQcm9maXQ7CiAgIHVpbnQyNTYgbGFzdERhdGVEaXN0cmlidXRlZFByb2ZpdDsKICAgCiAgIGZ1bmN0aW9uIGdldERpc3RyaWJ1dGVQcm9maXRzSW5mbygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGxhc3RQcm9maXQsIHVpbnQyNTYgbGFzdERhdGUpCiAgIHsKICAgICAgbGFzdFByb2ZpdCA9IGxhc3REaXN0cmlidXRlZFByb2ZpdDsKICAgICAgbGFzdERhdGUgPSBsYXN0RGF0ZURpc3RyaWJ1dGVkUHJvZml0OwogICB9CgogICBmdW5jdGlvbiBzZXRQcm9maXREaXN0cmlidXRpb25Db250cmFjdChhZGRyZXNzIGNvbnRyYWN0QWRkcmVzcykgb25seURldmVsb3BlcgogICB7CiAgICAgIGlmIChwcm9maXREaXN0cmlidXRpb25Db250cmFjdCA+IDApIHRocm93OwogICAgICBwcm9maXREaXN0cmlidXRpb25Db250cmFjdCA9IGNvbnRyYWN0QWRkcmVzczsKICAgfQoKICAgZnVuY3Rpb24gc2V0U21hcnRBZmZpbGlhdGVDb250cmFjdChhZGRyZXNzIGNvbnRyYWN0QWRkcmVzcykgb25seURldmVsb3BlcgogICB7CiAgICAgIGlmIChhZGRyZXNzKHNtYXJ0QWZmaWxpYXRlQ29udHJhY3QpID4gMCkgdGhyb3c7CiAgICAgIHNtYXJ0QWZmaWxpYXRlQ29udHJhY3QgPSBTbWFydEFmZmlsaWF0ZShjb250cmFjdEFkZHJlc3MpOwogICB9CgogICBmdW5jdGlvbiBkaXN0cmlidXRlUHJvZml0cyh1aW50MjU2IGdhc1ZhbHVlKSBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcgogICB7CiAgICAgIGlmIChwcm9maXREaXN0cmlidXRpb25Db250cmFjdCA+IDAgJiYgdGhpcy5iYWxhbmNlID49IChiYW5rcm9sTGltaXQrcHJvZml0TGltaXQpKQogICAgICB7CiAgICAgICAgIHVpbnQyNTYgZGlmZiA9IHRoaXMuYmFsYW5jZSAtIGJhbmtyb2xMaW1pdDsKICAgICAgICAgaWYgKGFkZHJlc3MocHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QpLmNhbGwuZ2FzKGdhc1ZhbHVlKS52YWx1ZShkaWZmKSgpID09IGZhbHNlKSB0aHJvdzsKICAgICAgICAgbGFzdERpc3RyaWJ1dGVkUHJvZml0ID0gZGlmZjsKICAgICAgICAgbGFzdERhdGVEaXN0cmlidXRlZFByb2ZpdCA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgfSAgICAgIAogICB9CgogICBmdW5jdGlvbiBnZXRUb2tlblNldHRpbmdzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludDE2IENvZWZfcGxheWVyLCB1aW50MjU2IEJhbmtyb2xMaW1pdCwgdWludDI1NiBQcm9maXRMaW1pdCkKICAgewogICAgICBDb2VmX3BsYXllciA9IGNvZWZfcGxheWVyOyAgICAgIAogICAgICBCYW5rcm9sTGltaXQgPSBiYW5rcm9sTGltaXQ7CiAgICAgIFByb2ZpdExpbWl0ID0gcHJvZml0TGltaXQ7CiAgIH0KCiAgIGZ1bmN0aW9uIGNoYW5nZVRva2VuU2V0dGluZ3ModWludDE2IG5ld0NvZWZfcGxheWVyLCB1aW50MjU2IG5ld0Jhbmtyb2xMaW1pdCwgdWludDI1NiBuZXdQcm9maXRMaW1pdCkgb25seURldmVsb3BlcgogICB7CiAgICAgIGNvZWZfcGxheWVyICA9IG5ld0NvZWZfcGxheWVyOyAgICAgIAogICAgICBiYW5rcm9sTGltaXQgPSBuZXdCYW5rcm9sTGltaXQ7CiAgICAgIHByb2ZpdExpbWl0ICA9IG5ld1Byb2ZpdExpbWl0OwogICB9CgogICBmdW5jdGlvbiBjaGFuZ2VTZXR0aW5ncyh1aW50NjQgTmV3TWF4QmV0c1BlckJsb2NrLCB1aW50OCBOZXdCbG9ja0RlbGF5LCB1aW50OCBNaW5DcmVkaXRzT25CZXQ1MCwgdWludDggTWluQ3JlZGl0c09uQmV0MzMsIHVpbnQ4IE5ld0RlZmF1bHRNaW5DcmVkaXRzT25CZXQpIG9ubHlEZXZlbG9wZXIKICAgeyAgICAgCiAgICAgIEJsb2NrRGVsYXkgPSBOZXdCbG9ja0RlbGF5OyAgICAgCgogICAgICBpZiAoTmV3TWF4QmV0c1BlckJsb2NrICE9IDApIG1heEdhbWJsZXNQZXJCbG9jayA9IE5ld01heEJldHNQZXJCbG9jazsgICAgIAoKICAgICAgaWYgKE1pbkNyZWRpdHNPbkJldDUwID4gMCkKICAgICAgewogICAgICAgIG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5sb3cpXSAgID0gTWluQ3JlZGl0c09uQmV0NTA7CiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmhpZ2gpXSAgPSBNaW5DcmVkaXRzT25CZXQ1MDsKICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMucmVkKV0gICA9IE1pbkNyZWRpdHNPbkJldDUwOwogICAgICAgIG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5ibGFjayldID0gTWluQ3JlZGl0c09uQmV0NTA7CiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLm9kZCldICAgPSBNaW5DcmVkaXRzT25CZXQ1MDsKICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuZXZlbildICA9IE1pbkNyZWRpdHNPbkJldDUwOwogICAgICB9ICAKCiAgICAgIGlmIChNaW5DcmVkaXRzT25CZXQzMyA+IDApCiAgICAgIHsKICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuZG96ZW4xKV0gPSBNaW5DcmVkaXRzT25CZXQzMzsKICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuZG96ZW4yKV0gPSBNaW5DcmVkaXRzT25CZXQzMzsKICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuZG96ZW4zKV0gPSBNaW5DcmVkaXRzT25CZXQzMzsKICAgICAgICBtaW5DcmVkaXRzT25CZXRbdWludDgoQmV0VHlwZXMuY29sdW1uMSldID0gTWluQ3JlZGl0c09uQmV0MzM7CiAgICAgICAgbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmNvbHVtbjIpXSA9IE1pbkNyZWRpdHNPbkJldDMzOwogICAgICAgIG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5jb2x1bW4zKV0gPSBNaW5DcmVkaXRzT25CZXQzMzsKICAgICAgfQoKICAgICAgaWYgKE5ld0RlZmF1bHRNaW5DcmVkaXRzT25CZXQgPiAwKSBkZWZhdWx0TWluQ3JlZGl0c09uQmV0ID0gTmV3RGVmYXVsdE1pbkNyZWRpdHNPbkJldDsgICAKICAgfQogICAKICAgZnVuY3Rpb24gZGVsZXRlQ29udHJhY3QoKSBvbmx5RGV2ZWxvcGVyICAKICAgewogICAgICAgIHN1aWNpZGUobXNnLnNlbmRlcik7CiAgIH0KCiAgIC8vIGJpdCBmcm9tIDAgdG8gMjU1CiAgIGZ1bmN0aW9uIGlzQml0U2V0KHVpbnQyNTYgZGF0YSwgdWludDggYml0KSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wgcmV0KQogICB7CiAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJldCA6PSBpc3plcm8oaXN6ZXJvKGFuZChkYXRhLCBleHAoMixiaXQpKSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgIH0KCiAgIC8vIHVuaXF1ZSBjb21iaW5hdGlvbiBvZiBiZXQgYW5kIHdoZWVsUmVzdWx0LCB1c2VkIGZvciBhY2Nlc3MgdG8gV2luTWF0cml4CiAgIGZ1bmN0aW9uIGdldEluZGV4KHVpbnQxNiBiZXQsIHVpbnQxNiB3aGVlbFJlc3VsdCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MTYpCiAgIHsKICAgICAgcmV0dXJuIChiZXQrMSkqMjU2ICsgKHdoZWVsUmVzdWx0KzEpOwogICB9CgogICAvLyBuIGZvcm0gMSA8PSB0byA8PSAzMgogICBmdW5jdGlvbiBnZXRCZXRWYWx1ZShieXRlczMyIHZhbHVlcywgdWludDggbikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogICB7CiAgICAgICAgLy8gYmV0IGluIGNyZWRpdHMgKDEuLjI1NikgCiAgICAgICAgdWludDI1NiBiZXQgPSB1aW50MjU2KHZhbHVlc1szMi1uXSkrMTsKCiAgICAgICAgIC8vIGNoZWNrIG1pbiBiZXQKICAgICAgICB1aW50OCBtaW5DcmVkaXRzID0gbWluQ3JlZGl0c09uQmV0W25dOwogICAgICAgIGlmIChtaW5DcmVkaXRzID09IDApIG1pbkNyZWRpdHMgPSBkZWZhdWx0TWluQ3JlZGl0c09uQmV0OwogICAgICAgIGlmIChiZXQgPCBtaW5DcmVkaXRzKSB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBiZXQgaW4gd2VpCiAgICAgICAgYmV0ID0gY3VycmVudE1heEJldCpiZXQvMjU2OwogICAgICAgIGlmIChiZXQgPiBjdXJyZW50TWF4QmV0KSB0aHJvdzsgICAgICAgICAKCiAgICAgICAgcmV0dXJuIGJldDsgICAgICAgIAogICB9CgogICBmdW5jdGlvbiBnZXRCZXRWYWx1ZUJ5R2FtYmxlKEdhbWVJbmZvIG1lbW9yeSBnYW1ibGUsIHVpbnQ4IG4pIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgCiAgIHsKICAgICAgaWYgKG48PTMyKSByZXR1cm4gZ2V0QmV0VmFsdWUoZ2FtYmxlLnZhbHVlcywgbik7CiAgICAgIGlmIChuPD02NCkgcmV0dXJuIGdldEJldFZhbHVlKGdhbWJsZS52YWx1ZXMyLCBuLTMyKTsKICAgICAgLy8gdGhlcmUgYXJlIDY0IG1heGltdW0gdW5pcXVlIGJldHMgKHBvc2l0aW9ucykgaW4gb25lIGdhbWUKICAgICAgdGhyb3c7CiAgIH0KICAKICAgZnVuY3Rpb24gdG90YWxHYW1lcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgIHsKICAgICAgIHJldHVybiBnYW1ibGVzLmxlbmd0aDsKICAgfQogICAKICAgZnVuY3Rpb24gZ2V0U2V0dGluZ3MoKSBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgbWF4QmV0LCB1aW50MjU2IG9uZUNyZWRpdCwgdWludDggTWluQmV0SW5DcmVkaXRzLCB1aW50OCBNaW5CZXRJbkNyZWRpdHNfNTAsdWludDggTWluQmV0SW5DcmVkaXRzXzMzLCB1aW50OCBibG9ja0RlbGF5QmVmb3JlU3BpbiwgYm9vbCBjb250cmFjdFN0YXRlKQogICAgewogICAgICAgIG1heEJldCAgICA9IGN1cnJlbnRNYXhCZXQ7CiAgICAgICAgb25lQ3JlZGl0ID0gY3VycmVudE1heEJldCAvIDI1NjsgCiAgICAgICAgYmxvY2tEZWxheUJlZm9yZVNwaW4gPSBCbG9ja0RlbGF5OyAgICAgICAgCiAgICAgICAgTWluQmV0SW5DcmVkaXRzICAgICAgPSBkZWZhdWx0TWluQ3JlZGl0c09uQmV0OwogICAgICAgIE1pbkJldEluQ3JlZGl0c181MCAgID0gbWluQ3JlZGl0c09uQmV0W3VpbnQ4KEJldFR5cGVzLmxvdyldOyAKICAgICAgICBNaW5CZXRJbkNyZWRpdHNfMzMgICA9IG1pbkNyZWRpdHNPbkJldFt1aW50OChCZXRUeXBlcy5jb2x1bW4xKV07IAogICAgICAgIGNvbnRyYWN0U3RhdGUgICAgICAgID0gQ29udHJhY3RTdGF0ZTsKICAgIH0KICAgCiAgICBtb2RpZmllciBvbmx5RGV2ZWxvcGVyKCkgCiAgICB7CiAgICAgICBpZiAobXNnLnNlbmRlciAhPSBkZXZlbG9wZXIpIHRocm93OwogICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcigpIAogICAgewogICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gZGV2ZWxvcGVyICYmIG1zZy5zZW5kZXIgIT0gb3BlcmF0b3IpIHRocm93OwogICAgICAgXzsKICAgIH0KCiAgIGZ1bmN0aW9uIGRpc2FibGVCZXR0aW5nX29ubHlfRGV2KCkKICAgIG9ubHlEZXZlbG9wZXJPck9wZXJhdG9yCiAgICB7CiAgICAgICAgQ29udHJhY3RTdGF0ZT1mYWxzZTsKICAgIH0KCgogICAgZnVuY3Rpb24gY2hhbmdlT3BlcmF0b3IoYWRkcmVzcyBuZXdPcGVyYXRvcikgb25seURldmVsb3BlcgogICAgewogICAgICAgb3BlcmF0b3IgPSBuZXdPcGVyYXRvcjsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmFibGVCZXR0aW5nX29ubHlfRGV2KCkKICAgIG9ubHlEZXZlbG9wZXJPck9wZXJhdG9yCiAgICB7CiAgICAgICAgQ29udHJhY3RTdGF0ZT10cnVlOwoKICAgIH0KCiAgICBldmVudCBQbGF5ZXJCZXQodWludDI1NiBnYW1ibGVJZCwgdWludDI1NiBwbGF5ZXJUb2tlbnMpOwogICAgZXZlbnQgRW5kR2FtZShhZGRyZXNzIHBsYXllciwgdWludDggcmVzdWx0LCB1aW50MjU2IGdhbWJsZUlkKTsKICAgIGV2ZW50IFNldHRpbmdzQ2hhbmdlZCh1aW50MjU2IG1heEJldCwgdWludDI1NiBvbmVDcmVkaXQsIHVpbnQ4IERlZmF1bHRNaW5CZXRJbkNyZWRpdHMsIHVpbnQ4IE1pbkJldEluQ3JlZGl0czUwLCB1aW50OCBNaW5CZXRJbkNyZWRpdHMzMywgdWludDggYmxvY2tEZWxheUJlZm9yZVNwaW4sIGJvb2wgY29udHJhY3RTdGF0ZSk7CiAgICBldmVudCBFcnJvckxvZyhhZGRyZXNzIHBsYXllciwgc3RyaW5nIG1lc3NhZ2UpOwogICAgZXZlbnQgR2FzTG9nKHN0cmluZyBtc2csIHVpbnQyNTYgbGV2ZWwsIHVpbnQyNTYgZ2FzKTsKCiAgIGZ1bmN0aW9uIHRvdGFsQmV0VmFsdWUoR2FtZUluZm8gbWVtb3J5IGcpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikKICAgeyAgICAgICAgICAgICAgCiAgICAgICB1aW50MjU2IHRvdGFsQmV0c1ZhbHVlID0gMDsgCiAgICAgICB1aW50OCBuUGxheWVyQmV0Tm8gPSAwOwogICAgICAgdWludDggYmV0c0NvdW50ID0gdWludDgoYnl0ZXMzMihnLmJldHMpWzBdKTsKCiAgICAgICBmb3IodWludDggaSA9IDA7IGkgPCBtYXhUeXBlQmV0cztpKyspIAogICAgICAgIGlmIChpc0JpdFNldChnLmJldHMsIGkpKQogICAgICAgIHsKICAgICAgICAgIHRvdGFsQmV0c1ZhbHVlICs9IGdldEJldFZhbHVlQnlHYW1ibGUoZywgblBsYXllckJldE5vKzEpOwogICAgICAgICAgblBsYXllckJldE5vKys7CgogICAgICAgICAgaWYgKGJldHNDb3VudCA9PSAxKSBicmVhazsKICAgICAgICAgIGJldHNDb3VudC0tOyAgICAgICAgICAKICAgICAgICB9CgogICAgICAgcmV0dXJuIHRvdGFsQmV0c1ZhbHVlOwogICB9CgogICBmdW5jdGlvbiB0b3RhbEJldENvdW50KEdhbWVJbmZvIG1lbW9yeSBnKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgIHsgICAgICAgICAgICAgIAogICAgICAgdWludDI1NiB0b3RhbEJldHMgPSAwOyAKICAgICAgIGZvcih1aW50OCBpPTA7IGkgPCBtYXhUeXBlQmV0cztpKyspIAogICAgICAgIGlmIChpc0JpdFNldChnLmJldHMsIGkpKSB0b3RhbEJldHMrKzsgICAgICAgICAgCiAgICAgICByZXR1cm4gdG90YWxCZXRzOyAgIAogICB9CgogICBmdW5jdGlvbiBwbGFjZUJldCh1aW50MjU2IGJldHMsIGJ5dGVzMzIgdmFsdWVzMSxieXRlczMyIHZhbHVlczIpIHB1YmxpYyBwYXlhYmxlCiAgIHsKICAgICAgIGlmIChDb250cmFjdFN0YXRlID09IGZhbHNlKQogICAgICAgewogICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiQ29udHJhY3REaXNhYmxlZCIpOwogICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93OwogICAgICAgICByZXR1cm47CiAgICAgICB9IAoKICAgICAgIHZhciBnYW1ibGVzTGVuZ3RoID0gZ2FtYmxlcy5sZW5ndGg7CgogICAgICAgaWYgKGdhbWJsZXNMZW5ndGggPiAwKQogICAgICAgewogICAgICAgICAgdWludDggZ2FtYmxlc0NvdW50SW5DdXJyZW50QmxvY2sgPSAwOwogICAgICAgICAgZm9yKHZhciBpID0gZ2FtYmxlc0xlbmd0aCAtIDE7aSA+IDA7IGktLSkKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKGdhbWJsZXNbaV0uYmxvY2tOdW1iZXIgPT0gYmxvY2subnVtYmVyKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICBpZiAoZ2FtYmxlc1tpXS5wbGF5ZXIgPT0gbXNnLnNlbmRlcikKICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIlBsYXkgdHdpY2UgdGhlIHNhbWUgYmxvY2siKTsKICAgICAgICAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgIGdhbWJsZXNDb3VudEluQ3VycmVudEJsb2NrKys7CiAgICAgICAgICAgICAgIGlmIChnYW1ibGVzQ291bnRJbkN1cnJlbnRCbG9jayA+PSBtYXhHYW1ibGVzUGVyQmxvY2spCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIm1heEdhbWJsZXNQZXJCbG9jayIpOwogICAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93OwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgIH0KICAgICAgIAogICAgICAgdmFyIF9jdXJyZW50TWF4QmV0ID0gY3VycmVudE1heEJldDsKCiAgICAgICBpZiAobXNnLnZhbHVlIDwgX2N1cnJlbnRNYXhCZXQvMjU2IHx8IGJldHMgPT0gMCkKICAgICAgIHsKICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJXcm9uZyBiZXQgdmFsdWUiKTsKICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgICByZXR1cm47CiAgICAgICB9CgogICAgICAgaWYgKG1zZy52YWx1ZSA+IF9jdXJyZW50TWF4QmV0KQogICAgICAgewogICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIkxpbWl0IGZvciB0YWJsZSIpOwogICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsKICAgICAgICAgIHJldHVybjsKICAgICAgIH0KCiAgICAgICBHYW1lSW5mbyBtZW1vcnkgZyA9IEdhbWVJbmZvKG1zZy5zZW5kZXIsIGJsb2NrLm51bWJlciwgMzcsIGJldHMsIHZhbHVlczEsdmFsdWVzMik7CgogICAgICAgaWYgKHRvdGFsQmV0VmFsdWUoZykgIT0gbXNnLnZhbHVlKQogICAgICAgewogICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIldyb25nIGJldCB2YWx1ZSIpOwogICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsKICAgICAgICAgIHJldHVybjsKICAgICAgIH0KCiAgICAgICBnYW1ibGVzLnB1c2goZyk7CgogICAgICAgYWRkcmVzcyBhZmZpbGlhdGUgPSAwOwogICAgICAgdWludDE2IGNvZWZfYWZmaWxpYXRlID0gMDsKICAgICAgIGlmIChhZGRyZXNzKHNtYXJ0QWZmaWxpYXRlQ29udHJhY3QpID4gMCkKICAgICAgIHsKICAgICAgICAgKGFmZmlsaWF0ZSwgY29lZl9hZmZpbGlhdGUpID0gc21hcnRBZmZpbGlhdGVDb250cmFjdC5nZXRBZmZpbGlhdGVJbmZvKG1zZy5zZW5kZXIpOyAgIAogICAgICAgfQogICAgICAgCiAgICAgICB1aW50MjU2IHBsYXllclRva2VucyA9IHNtYXJ0VG9rZW4uZW1pc3Npb24obXNnLnNlbmRlciwgYWZmaWxpYXRlLCBtc2cudmFsdWUsIGNvZWZfcGxheWVyLCBjb2VmX2FmZmlsaWF0ZSk7ICAgICAgICAgICAgCgogICAgICAgUGxheWVyQmV0KGdhbWJsZXNMZW5ndGgsIHBsYXllclRva2Vucyk7IAogICB9CgogICAgZnVuY3Rpb24gSW52ZXN0KCkgcGF5YWJsZSBvbmx5RGV2ZWxvcGVyCiAgICB7CiAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIEdldEdhbWVJbmRleGVzVG9Qcm9jZXNzKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTZbNjRdIGdhbWVJbmRleGVzKQogICAgeyAgICAgICAgICAgCiAgICAgIHVpbnQ4IGluZGV4ID0gMDsKICAgICAgZm9yKGludDI1NiBpID0gaW50MjU2KGdhbWJsZXMubGVuZ3RoKSAtIDE7aSA+PSAwO2ktLSkKICAgICAgeyAgICAgIAogICAgICAgICBHYW1lSW5mbyBtZW1vcnkgZyA9IGdhbWJsZXNbdWludDI1NihpKV07CiAgICAgICAgIGlmIChibG9jay5udW1iZXIgLSBnLmJsb2NrTnVtYmVyID49IDI1NikgYnJlYWs7CgogICAgICAgICBpZiAoZy53aGVlbFJlc3VsdCA9PSAzNyAmJiBibG9jay5udW1iZXIgPj0gZy5ibG9ja051bWJlciArIEJsb2NrRGVsYXkpCiAgICAgICAgIHsgCiAgICAgICAgICAgIGdhbWVJbmRleGVzW2luZGV4KytdID0gdWludDI1NihpICsgMSk7CiAgICAgICAgIH0KICAgICAgfSAgICAgIAogICAgfQoKICAgIHVpbnQyNTYgbGFzdEJsb2NrR2FtZXNQcm9jZXNzZWQ7CgogICAgZnVuY3Rpb24gUHJvY2Vzc0dhbWVzKHVpbnQyNTZbXSBnYW1lSW5kZXhlcywgYm9vbCBzaW11bGF0ZSkgCiAgICB7CiAgICAgIGlmICghc2ltdWxhdGUpCiAgICAgIHsKICAgICAgICAgaWYgKGxhc3RCbG9ja0dhbWVzUHJvY2Vzc2VkID09IGJsb2NrLm51bWJlcikgIHJldHVybjsKICAgICAgICAgbGFzdEJsb2NrR2FtZXNQcm9jZXNzZWQgPSBibG9jay5udW1iZXI7CiAgICAgIH0KCiAgICAgIHVpbnQ4IGRlbGF5ID0gQmxvY2tEZWxheTsKICAgICAgdWludDI1NiBsZW5ndGggPSBnYW1lSW5kZXhlcy5sZW5ndGg7CiAgICAgIGJvb2wgc3VjY2VzcyA9IGZhbHNlOwogICAgICBmb3IodWludDI1NiBpID0gMDtpIDwgbGVuZ3RoO2krKykKICAgICAgeyAgICAgIAogICAgICAgICBpZiAoUHJvY2Vzc0dhbWUoZ2FtZUluZGV4ZXNbaV0sIGRlbGF5KSA9PSBHYW1lU3RhdHVzLlN1Y2Nlc3MpIHN1Y2Nlc3MgPSB0cnVlOyAgICAgICAgIAogICAgICB9ICAgICAgCiAgICAgIGlmIChzaW11bGF0ZSAmJiAhc3VjY2VzcykgdGhyb3c7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFByb2Nlc3NHYW1lRXh0KHVpbnQyNTYgaW5kZXgpIHB1YmxpYyByZXR1cm5zIChHYW1lU3RhdHVzKQogICAgewogICAgICByZXR1cm4gUHJvY2Vzc0dhbWUoaW5kZXgsIEJsb2NrRGVsYXkpOwogICAgfQoKICAgIGZ1bmN0aW9uIFByb2Nlc3NHYW1lKHVpbnQyNTYgaW5kZXgsIHVpbnQyNTYgZGVsYXkpIHByaXZhdGUgcmV0dXJucyAoR2FtZVN0YXR1cykKICAgIHsgICAgICAgICAgICAKICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW2luZGV4XTsKICAgICAgaWYgKGJsb2NrLm51bWJlciAtIGcuYmxvY2tOdW1iZXIgPj0gMjU2KSByZXR1cm4gR2FtZVN0YXR1cy5TdG9wOwoKICAgICAgaWYgKGcud2hlZWxSZXN1bHQgPT0gMzcgJiYgYmxvY2subnVtYmVyID4gZy5ibG9ja051bWJlciArIGRlbGF5KQogICAgICB7ICAgICAgICAgICAgCiAgICAgICAgIGdhbWJsZXNbaW5kZXhdLndoZWVsUmVzdWx0ID0gZ2V0UmFuZG9tTnVtYmVyKGcucGxheWVyLCBnLmJsb2NrTnVtYmVyKTsKICAgICAgICAgICAgICAgICAKICAgICAgICAgdWludDI1NiBwbGF5ZXJXaW5uaW5ncyA9IGdldEdhbWVSZXN1bHQodWludDY0KGluZGV4KSk7CiAgICAgICAgIGlmIChwbGF5ZXJXaW5uaW5ncyA+IDApIAogICAgICAgICB7CiAgICAgICAgICAgIGlmIChnLnBsYXllci5zZW5kKHBsYXllcldpbm5pbmdzKSA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgIH0KCiAgICAgICAgIEVuZEdhbWUoZy5wbGF5ZXIsIGdhbWJsZXNbaW5kZXhdLndoZWVsUmVzdWx0LCBpbmRleCk7CiAgICAgICAgIHJldHVybiBHYW1lU3RhdHVzLlN1Y2Nlc3M7CiAgICAgIH0KCiAgICAgIHJldHVybiBHYW1lU3RhdHVzLlNraXBwZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmFuZG9tTnVtYmVyKGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHBsYXllcmJsb2NrKSBwcml2YXRlIHJldHVybnModWludDggd2hlZWxSZXN1bHQpCiAgICB7CiAgICAgICAgLy8gYmxvY2suYmxvY2toYXNoIC0gaGFzaCBvZiB0aGUgZ2l2ZW4gYmxvY2sgLSBvbmx5IHdvcmtzIGZvciAyNTYgbW9zdCByZWNlbnQgYmxvY2tzIGV4Y2x1ZGluZyBjdXJyZW50CiAgICAgICAgYnl0ZXMzMiBibG9ja0hhc2ggPSBibG9jay5ibG9ja2hhc2gocGxheWVyYmxvY2srQmxvY2tEZWxheSk7IAogICAgICAgIAogICAgICAgIGlmIChibG9ja0hhc2g9PTApIAogICAgICAgIHsKICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJDYW5ub3QgZ2VuZXJhdGUgcmFuZG9tIG51bWJlciIpOwogICAgICAgICAgd2hlZWxSZXN1bHQgPSAyMDA7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICBieXRlczMyIHNoYVBsYXllciA9IHNoYTMocGxheWVyLCBibG9ja0hhc2gpOwogICAgCiAgICAgICAgICB3aGVlbFJlc3VsdCA9IHVpbnQ4KHVpbnQyNTYoc2hhUGxheWVyKSUzNyk7CiAgICAgICAgfSAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSYW5kb21OdW1iZXJCeUJsb2NraGFzaCh1aW50MjU2IGJsb2NrSGFzaCwgYWRkcmVzcyBwbGF5ZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCB3aGVlbFJlc3VsdCkgCiAgICB7IAogICAgICAgICAgYnl0ZXMzMiBzaGFQbGF5ZXIgPSBzaGEzKHBsYXllciwgYmxvY2tIYXNoKTsKICAgIAogICAgICAgICAgd2hlZWxSZXN1bHQgPSB1aW50OCh1aW50MjU2KHNoYVBsYXllciklMzcpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVtZXJnZW5jeUZpeEdhbWVSZXN1bHQodWludDY0IGdhbWJsZUlkLCB1aW50MjU2IGJsb2NrSGFzaCkgb25seURldmVsb3Blck9yT3BlcmF0b3IKICAgIHsKICAgICAgLy8gUHJvYmFibHkgdGhpcyBmdW5jdGlvbiB3aWxsIG5ldmVyIGJlIGNhbGxlZCwgYnV0CiAgICAgIC8vIGlmIGdhbWUgd2FzIG5vdCBzcGlubmVkIGluIDI1NiBibG9ja3MgdGhlbiBibG9jay5ibG9ja2hhc2ggd2lsbCByZXR1cm5zIGFsd2F5cyAwIGFuZCAKICAgICAgLy8gd2Ugc2hvdWxkIGZpeCB0aGlzIG1hbnVhbGx5ICh5b3UgY2FuIGNoZWNrIHJlc3VsdCB3aXRoIHB1YmxpYyBmdW5jdGlvbiBjYWxjdWxhdGVSYW5kb21OdW1iZXJCeUJsb2NraGFzaCkKICAgICAgR2FtZUluZm8gbWVtb3J5IGdhbWJsZSA9IGdhbWJsZXNbZ2FtYmxlSWRdOwogICAgICBpZiAoZ2FtYmxlLndoZWVsUmVzdWx0ICE9IDIwMCkgdGhyb3c7CgogICAgICBnYW1ibGVzW2dhbWJsZUlkXS53aGVlbFJlc3VsdCA9IGNhbGN1bGF0ZVJhbmRvbU51bWJlckJ5QmxvY2toYXNoKGJsb2NrSGFzaCwgZ2FtYmxlLnBsYXllcik7CiAgICAgIC8vZ2FtYmxlc1tnYW1ibGVJZF0uYmxvY2tTcGlubmVkID0gYmxvY2subnVtYmVyOwoKICAgICAgaWYgKGdhbWJsZS5wbGF5ZXIuc2VuZChnZXRHYW1lUmVzdWx0KGdhbWJsZUlkKSkgPT0gZmFsc2UpIHRocm93OwoKICAgICAgRW5kR2FtZShnYW1ibGUucGxheWVyLCBnYW1ibGUud2hlZWxSZXN1bHQsIGdhbWJsZUlkKTsKICAgIH0KCgogICAgCiAgICAvLwogICAgZnVuY3Rpb24gY2hlY2tHYW1lc1JlYWR5Rm9yU3Bpbm5pbmcoKSBjb25zdGFudCByZXR1cm5zIChpbnQyNTZbMjU2XSByZXQpIAogICAgeyAKICAgICAgdWludDE2IGluZGV4ID0gMDsgICAgCiAgICAgIGZvcihpbnQyNTYgaSA9IGludDI1NihnYW1ibGVzLmxlbmd0aCkgLSAxO2kgPj0gMDtpLS0pCiAgICAgIHsgICAgICAKICAgICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW3VpbnQyNTYoaSldOwogICAgICAgICBpZiAoYmxvY2subnVtYmVyIC0gZy5ibG9ja051bWJlciA+PSAyNTYpIHJldHVybiA7CgogICAgICAgICBpZiAoZy53aGVlbFJlc3VsdCA9PSAzNyAmJiBibG9jay5udW1iZXIgPiBnLmJsb2NrTnVtYmVyICsgQmxvY2tEZWxheSkKICAgICAgICAgeyAgICAgICAgICAgIAogICAgICAgICAgICByZXRbaW5kZXgrK10gPSBpKzE7ICAgICAgICAgICAgCiAgICAgICAgIH0gICAgICAgICAgICAgICAKICAgICAgfSAKICAgIH0KCiAgICBmdW5jdGlvbiBwcmVsaW1pbmFyeUdhbWVSZXN1bHQodWludDY0IGdhbWJsZUluZGV4KSBjb25zdGFudCByZXR1cm5zICh1aW50NjQgZ2FtYmxlSWQsIGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IGJsb2NrTnVtYmVyLCB1aW50MjU2IHRvdGFsV2luLCB1aW50OCB3aGVlbFJlc3VsdCwgdWludDI1NiBiZXRzLCB1aW50MjU2IHZhbHVlczEsIHVpbnQyNTYgdmFsdWVzMiwgdWludDI1NiBuVG90YWxCZXRWYWx1ZSwgdWludDI1NiBuVG90YWxCZXRDb3VudCkgCiAgICB7IAogICAgICBHYW1lSW5mbyBtZW1vcnkgZyA9IGdhbWJsZXNbdWludDI1NihnYW1ibGVJbmRleCldOwogICAgICAKICAgICAgaWYgKGcud2hlZWxSZXN1bHQgPT0gMzcgJiYgYmxvY2subnVtYmVyID4gZy5ibG9ja051bWJlciArIEJsb2NrRGVsYXkpCiAgICAgIHsKICAgICAgICAgZ2FtYmxlc1tnYW1ibGVJbmRleF0ud2hlZWxSZXN1bHQgPSBnZXRSYW5kb21OdW1iZXIoZy5wbGF5ZXIsIGcuYmxvY2tOdW1iZXIpOwogICAgICAgICByZXR1cm4gZ2V0R2FtZShnYW1ibGVJbmRleCk7CiAgICAgIH0KICAgICAgdGhyb3c7ICAgICAgCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0R2FtZVJlc3VsdCh1aW50NjQgaW5kZXgpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB0b3RhbFdpbikgCiAgICB7CiAgICAgICAgR2FtZUluZm8gbWVtb3J5IGdhbWUgPSBnYW1ibGVzW2luZGV4XTsKICAgICAgICB0b3RhbFdpbiA9IDA7CiAgICAgICAgdWludDggblBsYXllckJldE5vID0gMDsKICAgICAgICAvLyB3ZSBzZW50IGNvdW50IGJldHMgYXQgbGFzdCBieXRlIAogICAgICAgIHVpbnQ4IGJldHNDb3VudCA9IHVpbnQ4KGJ5dGVzMzIoZ2FtZS5iZXRzKVswXSk7IAogICAgICAgIGZvcih1aW50OCBpPTA7IGk8bWF4VHlwZUJldHM7IGkrKykKICAgICAgICB7ICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoaXNCaXRTZXQoZ2FtZS5iZXRzLCBpKSkKICAgICAgICAgICAgeyAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgdmFyIHdpbk11bCA9IHdpbk1hdHJpeC5nZXRDb2VmZihnZXRJbmRleChpLCBnYW1lLndoZWVsUmVzdWx0KSk7IC8vIGdldCB3aW4gY29lZgogICAgICAgICAgICAgIGlmICh3aW5NdWwgPiAwKSB3aW5NdWwrKzsgLy8gKyByZXR1cm4gcGxheWVyIGJldAogICAgICAgICAgICAgIHRvdGFsV2luICs9IHdpbk11bCAqIGdldEJldFZhbHVlQnlHYW1ibGUoZ2FtZSwgblBsYXllckJldE5vKzEpOwogICAgICAgICAgICAgIG5QbGF5ZXJCZXRObysrOyAKCiAgICAgICAgICAgICAgaWYgKGJldHNDb3VudCA9PSAxKSBicmVhazsKICAgICAgICAgICAgICBiZXRzQ291bnQtLTsKICAgICAgICAgICAgfQogICAgICAgIH0gICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIGdldEdhbWUodWludDY0IGluZGV4KSBjb25zdGFudCByZXR1cm5zICh1aW50NjQgZ2FtYmxlSWQsIGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IGJsb2NrTnVtYmVyLCB1aW50MjU2IHRvdGFsV2luLCB1aW50OCB3aGVlbFJlc3VsdCwgdWludDI1NiBiZXRzLCB1aW50MjU2IHZhbHVlczEsIHVpbnQyNTYgdmFsdWVzMiwgdWludDI1NiBuVG90YWxCZXRWYWx1ZSwgdWludDI1NiBuVG90YWxCZXRDb3VudCkgCiAgICB7CiAgICAgICAgZ2FtYmxlSWQgPSBpbmRleDsKICAgICAgICBwbGF5ZXIgPSBnYW1ibGVzW2luZGV4XS5wbGF5ZXI7CiAgICAgICAgdG90YWxXaW4gPSBnZXRHYW1lUmVzdWx0KGluZGV4KTsKICAgICAgICBibG9ja051bWJlciA9IGdhbWJsZXNbaW5kZXhdLmJsb2NrTnVtYmVyOyAgICAgICAgCiAgICAgICAgd2hlZWxSZXN1bHQgPSBnYW1ibGVzW2luZGV4XS53aGVlbFJlc3VsdDsKICAgICAgICBuVG90YWxCZXRWYWx1ZSA9IHRvdGFsQmV0VmFsdWUoZ2FtYmxlc1tpbmRleF0pOwogICAgICAgIG5Ub3RhbEJldENvdW50ID0gdG90YWxCZXRDb3VudChnYW1ibGVzW2luZGV4XSk7CiAgICAgICAgYmV0cyA9IGdhbWJsZXNbaW5kZXhdLmJldHM7CiAgICAgICAgdmFsdWVzMSA9IHVpbnQyNTYoZ2FtYmxlc1tpbmRleF0udmFsdWVzKTsKICAgICAgICB2YWx1ZXMyID0gdWludDI1NihnYW1ibGVzW2luZGV4XS52YWx1ZXMyKTsgICAgICAgIAogICAgfQoKICAgZnVuY3Rpb24oKSAKICAgewogICAgICB0aHJvdzsKICAgfQogICAKCn0='.
	

]
