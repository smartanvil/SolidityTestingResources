Class {
	#name : #SRT4863e8c8bd928bd1cf85eea784736e35c2f48a6a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4863e8c8bd928bd1cf85eea784736e35c2f48a6a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7Cgpjb250cmFjdCBFUkMyMCB7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9Cgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwoKICAgIC8vLyBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgaWYgKChfdmFsdWUgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CgogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAgLy8vIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgIC8vLyBAcmV0dXJuIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKCiAgICAvLy8gQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICAgLy8vIEByZXR1cm4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIC8vLyBAZGV2IHRyYW5zZmVyIHRva2VuIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgdWludDI1NiBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlci4KICAgIC8vLyBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQyNTYgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lckNhbmRpZGF0ZTsKCiAgICBldmVudCBPd25lcnNoaXBSZXF1ZXN0ZWQoYWRkcmVzcyBpbmRleGVkIF9ieSwgYWRkcmVzcyBpbmRleGVkIF90byk7CiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8pOwoKICAgIC8vLyBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgIC8vLyBhY2NvdW50LgogICAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8vIEBkZXYgUmV2ZXJ0cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPd25lckNhbmRpZGF0ZSgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBuZXdPd25lckNhbmRpZGF0ZSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgUHJvcG9zZXMgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lckNhbmRpZGF0ZS4KICAgIC8vLyBAcGFyYW0gX25ld093bmVyQ2FuZGlkYXRlIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgZnVuY3Rpb24gcmVxdWVzdE93bmVyc2hpcFRyYW5zZmVyKGFkZHJlc3MgX25ld093bmVyQ2FuZGlkYXRlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX25ld093bmVyQ2FuZGlkYXRlICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IF9uZXdPd25lckNhbmRpZGF0ZTsKCiAgICAgICAgT3duZXJzaGlwUmVxdWVzdGVkKG1zZy5zZW5kZXIsIG5ld093bmVyQ2FuZGlkYXRlKTsKICAgIH0KCiAgICAvLy8gQGRldiBBY2NlcHQgb3duZXJzaGlwIHRyYW5zZmVyLiBUaGlzIG1ldGhvZCBuZWVkcyB0byBiZSBjYWxsZWQgYnkgdGhlIHByZXZpb3VzbHkgcHJvcG9zZWQgb3duZXIuCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBleHRlcm5hbCBvbmx5T3duZXJDYW5kaWRhdGUgewogICAgICAgIGFkZHJlc3MgcHJldmlvdXNPd25lciA9IG93bmVyOwoKICAgICAgICBvd25lciA9IG5ld093bmVyQ2FuZGlkYXRlOwogICAgICAgIG5ld093bmVyQ2FuZGlkYXRlID0gYWRkcmVzcygwKTsKCiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQocHJldmlvdXNPd25lciwgb3duZXIpOwogICAgfQp9CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgICAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgICB9CgogICAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgICB9CgogICAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuSG9sZGVyIGlzIE93bmFibGUgewogICAgLy8vIEBkZXYgQWxsb3cgdGhlIG93bmVyIHRvIHRyYW5zZmVyIG91dCBhbnkgYWNjaWRlbnRhbGx5IHNlbnQgRVJDMjAgdG9rZW5zLgogICAgLy8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIEVSQzIwIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfYW1vdW50IHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckFueUVSQzIwVG9rZW4oYWRkcmVzcyBfdG9rZW5BZGRyZXNzLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gRVJDMjAoX3Rva2VuQWRkcmVzcykudHJhbnNmZXIob3duZXIsIF9hbW91bnQpOwogICAgfQp9Cgpjb250cmFjdCBCbG9rVG9rZW4gaXMgT3duYWJsZSwgQmFzaWNUb2tlbiwgVG9rZW5Ib2xkZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkJsb2siOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiQkxPIjsKCiAgICAvLyBVc2luZyBzYW1lIGRlY2ltYWwgdmFsdWUgYXMgRVRIIChtYWtlcyBFVEgtQkxPIGNvbnZlcnNpb24gbXVjaCBlYXNpZXIpLgogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgLy8gU3RhdGVzIHdoZXRoZXIgY3JlYXRpbmcgbW9yZSB0b2tlbnMgaXMgYWxsb3dlZCBvciBub3QuCiAgICAvLyBVc2VkIGR1cmluZyB0b2tlbiBzYWxlLgogICAgYm9vbCBwdWJsaWMgaXNNaW50aW5nID0gdHJ1ZTsKCiAgICBldmVudCBNaW50aW5nRW5kZWQoKTsKCiAgICBtb2RpZmllciBvbmx5RHVyaW5nTWludGluZygpIHsKICAgICAgICByZXF1aXJlKGlzTWludGluZyk7CgogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFmdGVyTWludGluZygpIHsKICAgICAgICByZXF1aXJlKCFpc01pbnRpbmcpOwoKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IE1pbnQgQmxvayB0b2tlbnMuCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIEFkZHJlc3MgdG8gc2VuZCBtaW50ZWQgQmxvayB0by4KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCB1aW50MjU2IEFtb3VudCBvZiBCbG9rIHRva2VucyB0byBtaW50LgogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBleHRlcm5hbCBvbmx5T3duZXIgb25seUR1cmluZ01pbnRpbmcgewogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKCiAgICAgICAgVHJhbnNmZXIoMHgwLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IEVuZCBtaW50aW5nIG1vZGUuCiAgICBmdW5jdGlvbiBlbmRNaW50aW5nKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBpZiAoaXNNaW50aW5nID09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlzTWludGluZyA9IGZhbHNlOwoKICAgICAgICBNaW50aW5nRW5kZWQoKTsKICAgIH0KCiAgICAvLy8gQGRldiBTYW1lIEVSQzIwIGJlaGF2aW9yLCBidXQgcmV2ZXJ0cyBpZiBzdGlsbCBtaW50aW5nLgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgdWludDI1NiBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5QWZ0ZXJNaW50aW5nIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKTsKICAgIH0KCiAgICAvLy8gQGRldiBTYW1lIEVSQzIwIGJlaGF2aW9yLCBidXQgcmV2ZXJ0cyBpZiBzdGlsbCBtaW50aW5nLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlBZnRlck1pbnRpbmcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgU2FtZSBFUkMyMCBiZWhhdmlvciwgYnV0IHJldmVydHMgaWYgc3RpbGwgbWludGluZy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seUFmdGVyTWludGluZyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQp9Cgpjb250cmFjdCBCbG9rVG9rZW5TYWxlIGlzIE93bmFibGUsIFRva2VuSG9sZGVyIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIC8vIEV4dGVybmFsIHBhcnRpZXM6CgogICAgLy8gQkxPIHRva2VuIGNvbnRyYWN0LgogICAgQmxva1Rva2VuIHB1YmxpYyBibG9rOwoKICAgIC8vIFZlc3RpbmcgY29udHJhY3QgZm9yIHByZS1zYWxlIHBhcnRpY2lwYW50cy4KICAgIFZlc3RpbmdUcnVzdGVlIHB1YmxpYyB0cnVzdGVlOwoKICAgIC8vIFJlY2VpdmVkIGZ1bmRzIGFyZSBmb3J3YXJkZWQgdG8gdGhpcyBhZGRyZXNzLgogICAgYWRkcmVzcyBwdWJsaWMgZnVuZGluZ1JlY2lwaWVudDsKCiAgICAvLyBCbG9rIHRva2VuIHVuaXQuCiAgICAvLyBVc2luZyBzYW1lIGRlY2ltYWwgdmFsdWUgYXMgRVRIIChtYWtlcyBFVEgtQkxPIGNvbnZlcnNpb24gbXVjaCBlYXNpZXIpLgogICAgLy8gVGhpcyBpcyB0aGUgc2FtZSBhcyBpbiBCbG9rIHRva2VuIGNvbnRyYWN0LgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fVU5JVCA9IDEwICoqIDE4OwoKICAgIC8vIE1heGltdW0gbnVtYmVyIG9mIHRva2VucyBpbiBjaXJjdWxhdGlvbjogMTAgdHJpbGxpb24uCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBNQVhfVE9LRU5TID0gMzYwMDAwMDAwICogVE9LRU5fVU5JVDsKCiAgICAvLyBNYXhpbXVtIHRva2VucyBvZmZlcmVkIGluIHRoZSBzYWxlLgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUFYX1RPS0VOU19TT0xEID0gMjM0MDAwMDAwICogVE9LRU5fVU5JVDsKCiAgICAvLyBCTE8gdG8gMSB3ZWkgcmF0aW8uCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBCTE9fUEVSX1dFSSA9IDU3MDA7CgogICAgLy8gU2FsZSBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMuCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBTQUxFX0RVUkFUSU9OID0gMzAgZGF5czsKICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogICAgLy8gQW1vdW50IG9mIHRva2VucyBzb2xkIHVudGlsIG5vdyBpbiB0aGUgc2FsZS4KICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1NvbGQgPSAwOwoKICAgIC8vIFBhcnRpY2lwYXRpb24gY2FwcywgYWNjb3JkaW5nIHRvIEtZQyB0aWVycy4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRJRVJfMV9DQVAgPSAyMDAwMCBldGhlcjsgLy8gTWF4aW11bSB1aW50MjU2IHZhbHVlCgogICAgLy8gQWNjdW11bGF0ZWQgYW1vdW50IGVhY2ggcGFydGljaXBhbnQgaGFzIGNvbnRyaWJ1dGVkIHNvIGZhci4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHBhcnRpY2lwYXRpb25IaXN0b3J5OwoKICAgIC8vIE1heGltdW0gYW1vdW50IHRoYXQgZWFjaCBwYXJ0aWNpcGFudCBpcyBhbGxvd2VkIHRvIGNvbnRyaWJ1dGUgKGluIFdFSSkuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwYXJ0aWNpcGF0aW9uQ2FwczsKCiAgICAvLyBNYXhpbXVtIGFtb3VudCBBTllCT0RZIGlzIGN1cnJlbnRseSBhbGxvd2VkIHRvIGNvbnRyaWJ1dGUuCiAgICB1aW50MjU2IHB1YmxpYyBoYXJkUGFydGljaXBhdGlvbkNhcCA9IHVpbnQyNTYoLTEpOwoKICAgIC8vIFZlc3RpbmcgaW5mb3JtYXRpb24gZm9yIHNwZWNpYWwgYWRkcmVzc2VzOgogICAgc3RydWN0IFRva2VuR3JhbnQgewogICAgICAgIHVpbnQyNTYgdmFsdWU7CiAgICAgICAgdWludDI1NiBzdGFydE9mZnNldDsKICAgICAgICB1aW50MjU2IGNsaWZmT2Zmc2V0OwogICAgICAgIHVpbnQyNTYgZW5kT2Zmc2V0OwogICAgICAgIHVpbnQyNTYgaW5zdGFsbG1lbnRMZW5ndGg7CiAgICAgICAgdWludDggcGVyY2VudFZlc3RlZDsKICAgIH0KCiAgICBhZGRyZXNzW10gcHVibGljIHRva2VuR3JhbnRlZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFRva2VuR3JhbnQpIHB1YmxpYyB0b2tlbkdyYW50czsKICAgIHVpbnQyNTYgcHVibGljIGxhc3RHcmFudGVkSW5kZXggPSAwOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgTUFYX1RPS0VOX0dSQU5URUVTID0gMTAwOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR1JBTlRfQkFUQ0hfU0laRSA9IDEwOwoKICAgIGFkZHJlc3MgcHVibGljIGNvbnN0YW50IFJFU0VSVkVfVE9LRU5TID0gMHhBNjdFMWM1NkE1ZTAzNjNCNjFhMjM2NzBGRkMwRmNEOEYwOWYxNzhkOwogICAgYWRkcmVzcyBwdWJsaWMgY29uc3RhbnQgVEVBTV9XQUxMRVQgPSAweDUyYUE2QTYyNDA0MTA3NzQyYWMwMUZmMjQ3RUQ0N2I0OWIxNmM0MEE7CiAgICBhZGRyZXNzIHB1YmxpYyBjb25zdGFudCBCT1VOVFlfV0FMTEVUID0gMHhDZjFlNjRDZTI3NDBBMDMxOTJGMWQ3YTMyMzRBQUJkODhjMDI1YzRCOyAgICAKCiAgICBldmVudCBUb2tlbnNJc3N1ZWQoYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdG9rZW5zKTsKCiAgICAvLy8gQGRldiBSZXZlcnRzIGlmIGNhbGxlZCB3aGVuIG5vdCBkdXJpbmcgc2FsZS4KICAgIG1vZGlmaWVyIG9ubHlEdXJpbmdTYWxlKCkgewogICAgICAgIHJlcXVpcmUoIXNhbGVFbmRlZCgpICYmIG5vdyA+PSBzdGFydFRpbWUpOwoKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IFJldmVydHMgaWYgY2FsbGVkIGJlZm9yZSBzYWxlIGVuZHMuCiAgICBtb2RpZmllciBvbmx5QWZ0ZXJTYWxlKCkgewogICAgICAgIHJlcXVpcmUoc2FsZUVuZGVkKCkpOwoKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIHRoYXQgaW5pdGlhbGl6ZXMgdGhlIHNhbGUgY29uZGl0aW9ucy4KICAgIC8vLyBAcGFyYW0gX2Z1bmRpbmdSZWNpcGllbnQgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgZnVuZGluZyByZWNpcGllbnQuCiAgICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgdWludDI1NiBUaGUgc3RhcnQgdGltZSBvZiB0aGUgdG9rZW4gc2FsZS4KICAgIGZ1bmN0aW9uIEJsb2tUb2tlblNhbGUoYWRkcmVzcyBfZnVuZGluZ1JlY2lwaWVudCwgdWludDI1NiBfc3RhcnRUaW1lKSB7CiAgICAgICAgcmVxdWlyZShfZnVuZGluZ1JlY2lwaWVudCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPiBub3cpOwoKICAgICAgICAvLyBEZXBsb3kgbmV3IEJsb2tUb2tlbiBjb250cmFjdC4KICAgICAgICBibG9rID0gbmV3IEJsb2tUb2tlbigpOwoKICAgICAgICAvLyBEZXBsb3kgbmV3IFZlc3RpbmdUcnVzdGVlIGNvbnRyYWN0LgogICAgICAgIHRydXN0ZWUgPSBuZXcgVmVzdGluZ1RydXN0ZWUoYmxvayk7CgogICAgICAgIGZ1bmRpbmdSZWNpcGllbnQgPSBfZnVuZGluZ1JlY2lwaWVudDsKICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICAgIGVuZFRpbWUgPSBzdGFydFRpbWUgKyBTQUxFX0RVUkFUSU9OOwoKICAgICAgICAvLyBJbml0aWFsaXplIHNwZWNpYWwgdmVzdGluZyBncmFudHMuCiAgICAgICAgaW5pdFRva2VuR3JhbnRzKCk7CiAgICB9CgogICAgLy8vIEBkZXYgSW5pdGlhbGl6ZSB0b2tlbiBncmFudHMuCiAgICBmdW5jdGlvbiBpbml0VG9rZW5HcmFudHMoKSBwcml2YXRlIG9ubHlPd25lciB7CiAgICAgICAgdG9rZW5HcmFudGVlcy5wdXNoKFJFU0VSVkVfVE9LRU5TKTsKICAgICAgICB0b2tlbkdyYW50c1tSRVNFUlZFX1RPS0VOU10gPSBUb2tlbkdyYW50KE1BWF9UT0tFTlMubXVsKDE4KS5kaXYoMTAwKSwgMCwgMCwgMTAgZGF5cywgMSBkYXlzLCAwKTsKCiAgICAgICAgdG9rZW5HcmFudGVlcy5wdXNoKFRFQU1fV0FMTEVUKTsKICAgICAgICB0b2tlbkdyYW50c1tURUFNX1dBTExFVF0gPSBUb2tlbkdyYW50KE1BWF9UT0tFTlMubXVsKDEzKS5kaXYoMTAwKSwgMCwgMCwgMTAgZGF5cywgMSBkYXlzLCAwKTsKCiAgICAgICAgdG9rZW5HcmFudGVlcy5wdXNoKEJPVU5UWV9XQUxMRVQpOwogICAgICAgIHRva2VuR3JhbnRzW0JPVU5UWV9XQUxMRVRdID0gVG9rZW5HcmFudChNQVhfVE9LRU5TLm11bCg0KS5kaXYoMTAwKSwgMCwgMCwgMTAgZGF5cywgMSBkYXlzLCAwKTsKICAgIH0KCiAgICAvLy8gQGRldiBBZGRzIGEgQmxvayB0b2tlbiB2ZXN0aW5nIGdyYW50LgogICAgLy8vIEBwYXJhbSBfZ3JhbnRlZSBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBncmFudGVlLiBDYW4gYmUgZ3JhbnRlZCBvbmx5IG9uY2UuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB1aW50MjU2IFRoZSB2YWx1ZSBvZiB0aGUgZ3JhbnQuCiAgICBmdW5jdGlvbiBhZGRUb2tlbkdyYW50KGFkZHJlc3MgX2dyYW50ZWUsIHVpbnQyNTYgX3ZhbHVlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX2dyYW50ZWUgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKHRva2VuR3JhbnRlZXMubGVuZ3RoICsgMSA8PSBNQVhfVE9LRU5fR1JBTlRFRVMpOwoKICAgICAgICAvLyBWZXJpZnkgdGhlIGdyYW50IGRvZXNuJ3QgYWxyZWFkeSBleGlzdC4KICAgICAgICByZXF1aXJlKHRva2VuR3JhbnRzW19ncmFudGVlXS52YWx1ZSA9PSAwKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkdyYW50ZWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUodG9rZW5HcmFudGVlc1tpXSAhPSBfZ3JhbnRlZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBBZGQgZ3JhbnQgYW5kIGFkZCB0byBncmFudGVlIGxpc3QuCiAgICAgICAgdG9rZW5HcmFudGVlcy5wdXNoKF9ncmFudGVlKTsKICAgICAgICB0b2tlbkdyYW50c1tfZ3JhbnRlZV0gPSBUb2tlbkdyYW50KF92YWx1ZSwgMCwgMSB5ZWFycywgMSB5ZWFycywgMSBkYXlzLCA1MCk7CiAgICB9CgogICAgLy8vIEBkZXYgRGVsZXRlcyBhIEJsb2sgdG9rZW4gZ3JhbnQuCiAgICAvLy8gQHBhcmFtIF9ncmFudGVlIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGdyYW50ZWUuCiAgICBmdW5jdGlvbiBkZWxldGVUb2tlbkdyYW50KGFkZHJlc3MgX2dyYW50ZWUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfZ3JhbnRlZSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgLy8gRGVsZXRlIHRoZSBncmFudCBmcm9tIHRoZSBrZXlzIGFycmF5LgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHRva2VuR3JhbnRlZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRva2VuR3JhbnRlZXNbaV0gPT0gX2dyYW50ZWUpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0b2tlbkdyYW50ZWVzW2ldOwoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBEZWxldGUgdGhlIGdyYW50IGZyb20gdGhlIG1hcHBpbmcuCiAgICAgICAgZGVsZXRlIHRva2VuR3JhbnRzW19ncmFudGVlXTsKICAgIH0KCiAgICAvLy8gQGRldiBBZGQgYSBsaXN0IG9mIHBhcnRpY2lwYW50cyB0byBhIGNhcHBlZCBwYXJ0aWNpcGF0aW9uIHRpZXIuCiAgICAvLy8gQHBhcmFtIF9wYXJ0aWNpcGFudHMgYWRkcmVzc1tdIFRoZSBsaXN0IG9mIHBhcnRpY2lwYW50IGFkZHJlc3Nlcy4KICAgIC8vLyBAcGFyYW0gX2NhcCB1aW50MjU2IFRoZSBjYXAgYW1vdW50IChpbiBFVEgpLgogICAgZnVuY3Rpb24gc2V0UGFydGljaXBhdGlvbkNhcChhZGRyZXNzW10gX3BhcnRpY2lwYW50cywgdWludDI1NiBfY2FwKSBwcml2YXRlIG9ubHlPd25lciB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3BhcnRpY2lwYW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBwYXJ0aWNpcGF0aW9uQ2Fwc1tfcGFydGljaXBhbnRzW2ldXSA9IF9jYXA7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEFkZCBhIGxpc3Qgb2YgcGFydGljaXBhbnRzIHRvIGNhcCB0aWVyICMxLgogICAgLy8vIEBwYXJhbSBfcGFydGljaXBhbnRzIGFkZHJlc3NbXSBUaGUgbGlzdCBvZiBwYXJ0aWNpcGFudCBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBzZXRUaWVyMVBhcnRpY2lwYW50cyhhZGRyZXNzW10gX3BhcnRpY2lwYW50cykgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBzZXRQYXJ0aWNpcGF0aW9uQ2FwKF9wYXJ0aWNpcGFudHMsIFRJRVJfMV9DQVApOwogICAgfQoKICAgIC8vLyBAZGV2IFNldCBoYXJkIHBhcnRpY2lwYXRpb24gY2FwIGZvciBhbGwgcGFydGljaXBhbnRzLgogICAgLy8vIEBwYXJhbSBfY2FwIHVpbnQyNTYgVGhlIGhhcmQgY2FwIGFtb3VudC4KICAgIGZ1bmN0aW9uIHNldEhhcmRQYXJ0aWNpcGF0aW9uQ2FwKHVpbnQyNTYgX2NhcCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9jYXAgPiAwKTsKCiAgICAgICAgaGFyZFBhcnRpY2lwYXRpb25DYXAgPSBfY2FwOwogICAgfQoKICAgIC8vLyBAZGV2IEZhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgd2lsbCBkZWxlZ2F0ZSB0aGUgcmVxdWVzdCB0byBjcmVhdGUoKS4KICAgIGZ1bmN0aW9uICgpIGV4dGVybmFsIHBheWFibGUgb25seUR1cmluZ1NhbGUgewogICAgICAgIGNyZWF0ZShtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGUgYW5kIHNlbGwgdG9rZW5zIHRvIHRoZSBjYWxsZXIuCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50IHJlY2VpdmluZyB0aGUgdG9rZW5zLgogICAgZnVuY3Rpb24gY3JlYXRlKGFkZHJlc3MgX3JlY2lwaWVudCkgcHVibGljIHBheWFibGUgb25seUR1cmluZ1NhbGUgewogICAgICAgIHJlcXVpcmUoX3JlY2lwaWVudCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgLy8gRW5mb3JjZSBwYXJ0aWNpcGF0aW9uIGNhcCAoaW4gV2VpIHJlY2VpdmVkKS4KICAgICAgICB1aW50MjU2IHdlaUFscmVhZHlQYXJ0aWNpcGF0ZWQgPSBwYXJ0aWNpcGF0aW9uSGlzdG9yeVttc2cuc2VuZGVyXTsKICAgICAgICB1aW50MjU2IHBhcnRpY2lwYXRpb25DYXAgPSBTYWZlTWF0aC5taW4yNTYoVE9LRU5fVU5JVC5tdWwoMTUpLmFkZChwYXJ0aWNpcGF0aW9uQ2Fwc1ttc2cuc2VuZGVyXSksIGhhcmRQYXJ0aWNpcGF0aW9uQ2FwKTsKICAgICAgICB1aW50MjU2IGNhcHBlZFdlaVJlY2VpdmVkID0gU2FmZU1hdGgubWluMjU2KG1zZy52YWx1ZSwgcGFydGljaXBhdGlvbkNhcC5zdWIod2VpQWxyZWFkeVBhcnRpY2lwYXRlZCkpOwogICAgICAgIHJlcXVpcmUoY2FwcGVkV2VpUmVjZWl2ZWQgPiAwKTsKCiAgICAgICAgLy8gQWNjZXB0IGZ1bmRzIGFuZCB0cmFuc2ZlciB0byBmdW5kaW5nIHJlY2lwaWVudC4KICAgICAgICB1aW50MjU2IHdlaUxlZnRJblNhbGUgPSBNQVhfVE9LRU5TX1NPTEQuc3ViKHRva2Vuc1NvbGQpLmRpdihCTE9fUEVSX1dFSSk7CiAgICAgICAgdWludDI1NiB3ZWlUb1BhcnRpY2lwYXRlID0gU2FmZU1hdGgubWluMjU2KGNhcHBlZFdlaVJlY2VpdmVkLCB3ZWlMZWZ0SW5TYWxlKTsKICAgICAgICBwYXJ0aWNpcGF0aW9uSGlzdG9yeVttc2cuc2VuZGVyXSA9IHdlaUFscmVhZHlQYXJ0aWNpcGF0ZWQuYWRkKHdlaVRvUGFydGljaXBhdGUpOwogICAgICAgIGZ1bmRpbmdSZWNpcGllbnQudHJhbnNmZXIod2VpVG9QYXJ0aWNpcGF0ZSk7CgogICAgICAgIC8vIElzc3VlIHRva2VucyBhbmQgdHJhbnNmZXIgdG8gcmVjaXBpZW50LgogICAgICAgIHVpbnQyNTYgdG9rZW5zTGVmdEluU2FsZSA9IE1BWF9UT0tFTlNfU09MRC5zdWIodG9rZW5zU29sZCk7CiAgICAgICAgdWludDI1NiB0b2tlbnNUb0lzc3VlID0gd2VpVG9QYXJ0aWNpcGF0ZS5tdWwoQkxPX1BFUl9XRUkpOwogICAgICAgIGlmICh0b2tlbnNMZWZ0SW5TYWxlLnN1Yih0b2tlbnNUb0lzc3VlKSA8IEJMT19QRVJfV0VJKSB7CiAgICAgICAgICAgIC8vIElmIHB1cmNoYXNlIHdvdWxkIGNhdXNlIGxlc3MgdGhhbiBCTE9fUEVSX1dFSSB0b2tlbnMgbGVmdCB0aGVuIG5vYm9keSBjb3VsZCBldmVyIGJ1eSB0aGVtLgogICAgICAgICAgICAvLyBTbywgZ2lmdCB0aGVtIHRvIHRoZSBsYXN0IGJ1eWVyLgogICAgICAgICAgICB0b2tlbnNUb0lzc3VlID0gdG9rZW5zTGVmdEluU2FsZTsKICAgICAgICB9CiAgICAgICAgdG9rZW5zU29sZCA9IHRva2Vuc1NvbGQuYWRkKHRva2Vuc1RvSXNzdWUpOwogICAgICAgIGlzc3VlVG9rZW5zKF9yZWNpcGllbnQsIHRva2Vuc1RvSXNzdWUpOwoKICAgICAgICAvLyBQYXJ0aWFsIHJlZnVuZCBpZiBmdWxsIHBhcnRpY2lwYXRpb24gbm90IHBvc3NpYmxlCiAgICAgICAgLy8gZS5nLiBkdWUgdG8gY2FwIGJlaW5nIHJlYWNoZWQuCiAgICAgICAgdWludDI1NiByZWZ1bmQgPSBtc2cudmFsdWUuc3ViKHdlaVRvUGFydGljaXBhdGUpOwogICAgICAgIGlmIChyZWZ1bmQgPiAwKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocmVmdW5kKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgRmluYWxpemVzIHRoZSB0b2tlbiBzYWxlIGV2ZW50LCBieSBzdG9wcGluZyB0b2tlbiBtaW50aW5nLgogICAgZnVuY3Rpb24gZmluYWxpemUoKSBleHRlcm5hbCBvbmx5QWZ0ZXJTYWxlIG9ubHlPd25lciB7CiAgICAgICAgaWYgKCFibG9rLmlzTWludGluZygpKSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShsYXN0R3JhbnRlZEluZGV4ID09IHRva2VuR3JhbnRlZXMubGVuZ3RoKTsKCiAgICAgICAgLy8gRmluaXNoIG1pbnRpbmcuCiAgICAgICAgYmxvay5lbmRNaW50aW5nKCk7CiAgICB9CgogICAgLy8vIEBkZXYgR3JhbnRzIHByZS1jb25maWd1cmVkIHRva2VuIGdyYW50cyBpbiBiYXRjaGVzLiBXaGVuIHRoZSBtZXRob2QgaXMgY2FsbGVkLCBpdCdsbCByZXN1bWUgZnJvbSB0aGUgbGFzdCBncmFudCwKICAgIC8vLyBmcm9tIGl0cyBwcmV2aW91cyBydW4sIGFuZCB3aWxsIGZpbmlzaCBlaXRoZXIgYWZ0ZXIgZ3JhbnRpbmcgR1JBTlRfQkFUQ0hfU0laRSBncmFudHMgb3IgZmluaXNoaW5nIHRoZSB3aG9sZSBsaXN0CiAgICAvLy8gb2YgZ3JhbnRzLgogICAgZnVuY3Rpb24gZ3JhbnRUb2tlbnMoKSBleHRlcm5hbCBvbmx5QWZ0ZXJTYWxlIG9ubHlPd25lciB7CiAgICAgICAgdWludCBlbmRJbmRleCA9IFNhZmVNYXRoLm1pbjI1Nih0b2tlbkdyYW50ZWVzLmxlbmd0aCwgbGFzdEdyYW50ZWRJbmRleCArIEdSQU5UX0JBVENIX1NJWkUpOwogICAgICAgIGZvciAodWludCBpID0gbGFzdEdyYW50ZWRJbmRleDsgaSA8IGVuZEluZGV4OyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyBncmFudGVlID0gdG9rZW5HcmFudGVlc1tpXTsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBob3cgbWFueSB0b2tlbnMgaGF2ZSBiZWVuIGdyYW50ZWQsIHZlc3RlZCwgYW5kIGlzc3VlZCBzdWNoIHRoYXQ6IGdyYW50ZWQgPSB2ZXN0ZWQgKyBpc3N1ZWQuCiAgICAgICAgICAgIFRva2VuR3JhbnQgbWVtb3J5IHRva2VuR3JhbnQgPSB0b2tlbkdyYW50c1tncmFudGVlXTsKICAgICAgICAgICAgdWludDI1NiB0b2tlbnNHcmFudGVkID0gdG9rZW5HcmFudC52YWx1ZTsKICAgICAgICAgICAgdWludDI1NiB0b2tlbnNWZXN0aW5nID0gdG9rZW5zR3JhbnRlZC5tdWwodG9rZW5HcmFudC5wZXJjZW50VmVzdGVkKS5kaXYoMTAwKTsKICAgICAgICAgICAgdWludDI1NiB0b2tlbnNJc3N1ZWQgPSB0b2tlbnNHcmFudGVkLnN1Yih0b2tlbnNWZXN0aW5nKTsKCiAgICAgICAgICAgIC8vIFRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdGhhdCBoYXZlIHlldCB0byBiZSB0cmFuc2ZlcnJlZCB0byBncmFudGVlLgogICAgICAgICAgICBpZiAodG9rZW5zSXNzdWVkID4gMCkgewogICAgICAgICAgICAgICAgaXNzdWVUb2tlbnMoZ3JhbnRlZSwgdG9rZW5zSXNzdWVkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVHJhbnNmZXIgdmVzdGVkIHRva2VucyB0aGF0IGhhdmUgeWV0IHRvIGJlIHRyYW5zZmVycmVkIHRvIHZlc3RpbmcgdHJ1c3RlZSwgYW5kIGluaXRpYWxpemUgZ3JhbnQuCiAgICAgICAgICAgIGlmICh0b2tlbnNWZXN0aW5nID4gMCkgewogICAgICAgICAgICAgICAgaXNzdWVUb2tlbnModHJ1c3RlZSwgdG9rZW5zVmVzdGluZyk7CiAgICAgICAgICAgICAgICB0cnVzdGVlLmdyYW50KGdyYW50ZWUsIHRva2Vuc1Zlc3RpbmcsIG5vdy5hZGQodG9rZW5HcmFudC5zdGFydE9mZnNldCksIG5vdy5hZGQodG9rZW5HcmFudC5jbGlmZk9mZnNldCksCiAgICAgICAgICAgICAgICAgICAgbm93LmFkZCh0b2tlbkdyYW50LmVuZE9mZnNldCksIHRva2VuR3JhbnQuaW5zdGFsbG1lbnRMZW5ndGgsIHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYXN0R3JhbnRlZEluZGV4Kys7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IElzc3VlcyB0b2tlbnMgZm9yIHRoZSByZWNpcGllbnQuCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5zIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaXNzdWUuCiAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF9yZWNpcGllbnQsIHVpbnQyNTYgX3Rva2VucykgcHJpdmF0ZSB7CiAgICAgICAgLy8gUmVxdWVzdCBCbG9rIHRva2VuIGNvbnRyYWN0IHRvIG1pbnQgdGhlIHJlcXVlc3RlZCB0b2tlbnMgZm9yIHRoZSBidXllci4KICAgICAgICBibG9rLm1pbnQoX3JlY2lwaWVudCwgX3Rva2Vucyk7CgogICAgICAgIFRva2Vuc0lzc3VlZChfcmVjaXBpZW50LCBfdG9rZW5zKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHdoZXRoZXIgdGhlIHNhbGUgaGFzIGVuZGVkLgogICAgLy8vIEByZXR1cm4gYm9vbCBXaGV0aGVyIHRoZSBzYWxlIGhhcyBlbmRlZCBvciBub3QuCiAgICBmdW5jdGlvbiBzYWxlRW5kZWQoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdG9rZW5zU29sZCA+PSBNQVhfVE9LRU5TX1NPTEQgfHwgbm93ID49IGVuZFRpbWU7CiAgICB9CgogICAgLy8vIEBkZXYgUmVxdWVzdHMgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgQmxvayB0b2tlbiBjb250cmFjdCB0byBhIG5ldyBvd25lci4KICAgIC8vLyBAcGFyYW0gX25ld093bmVyQ2FuZGlkYXRlIGFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgLy8vCiAgICAvLy8gTk9URToKICAgIC8vLyAgIDEuIFRoZSBuZXcgb3duZXIgd2lsbCBuZWVkIHRvIGNhbGwgQmxvayB0b2tlbiBjb250cmFjdCdzIGFjY2VwdE93bmVyc2hpcCBkaXJlY3RseSBpbiBvcmRlciB0byBhY2NlcHQgdGhlIG93bmVyc2hpcC4KICAgIC8vLyAgIDIuIENhbGxpbmcgdGhpcyBtZXRob2QgZHVyaW5nIHRoZSB0b2tlbiBzYWxlIHdpbGwgcHJldmVudCB0aGUgdG9rZW4gc2FsZSB0byBjb250aW51ZSwgc2luY2Ugb25seSB0aGUgb3duZXIgb2YKICAgIC8vLyAgICAgIHRoZSBCbG9rIHRva2VuIGNvbnRyYWN0IGNhbiBpc3N1ZSBuZXcgdG9rZW5zLgogICAgZnVuY3Rpb24gcmVxdWVzdEJsb2tUb2tlbk93bmVyc2hpcFRyYW5zZmVyKGFkZHJlc3MgX25ld093bmVyQ2FuZGlkYXRlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGJsb2sucmVxdWVzdE93bmVyc2hpcFRyYW5zZmVyKF9uZXdPd25lckNhbmRpZGF0ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXB0cyBuZXcgb3duZXJzaGlwIG9uIGJlaGFsZiBvZiB0aGUgQmxvayB0b2tlbiBjb250cmFjdC4KICAgIC8vIFRoaXMgY2FuIGJlIHVzZWQgYnkgdGhlIHNhbGUgY29udHJhY3QgaXRzZWxmIHRvIGNsYWltIGJhY2sgb3duZXJzaGlwIG9mIHRoZSBCbG9rIHRva2VuIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gYWNjZXB0Qmxva1Rva2VuT3duZXJzaGlwKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBibG9rLmFjY2VwdE93bmVyc2hpcCgpOwogICAgfQoKICAgIC8vLyBAZGV2IFJlcXVlc3RzIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIFZlc3RpbmdUcnVzdGVlIGNvbnRyYWN0IHRvIGEgbmV3IG93bmVyLgogICAgLy8vIEBwYXJhbSBfbmV3T3duZXJDYW5kaWRhdGUgYWRkcmVzcyBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAvLy8KICAgIC8vLyBOT1RFOgogICAgLy8vICAgMS4gVGhlIG5ldyBvd25lciB3aWxsIG5lZWQgdG8gY2FsbCBWZXN0aW5nVHJ1c3RlZSdzIGFjY2VwdE93bmVyc2hpcCBkaXJlY3RseSBpbiBvcmRlciB0byBhY2NlcHQgdGhlIG93bmVyc2hpcC4KICAgIC8vLyAgIDIuIENhbGxpbmcgdGhpcyBtZXRob2QgZHVyaW5nIHRoZSB0b2tlbiBzYWxlIHdpbGwgcHJldmVudCB0aGUgdG9rZW4gc2FsZSBmcm9tIGZpbmFsaXphaW5nLCBzaW5jZSBvbmx5IHRoZSBvd25lcgogICAgLy8vICAgICAgb2YgdGhlIFZlc3RpbmdUcnVzdGVlIGNvbnRyYWN0IGNhbiBpc3N1ZSBuZXcgdG9rZW4gZ3JhbnRzLgogICAgZnVuY3Rpb24gcmVxdWVzdFZlc3RpbmdUcnVzdGVlT3duZXJzaGlwVHJhbnNmZXIoYWRkcmVzcyBfbmV3T3duZXJDYW5kaWRhdGUpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgdHJ1c3RlZS5yZXF1ZXN0T3duZXJzaGlwVHJhbnNmZXIoX25ld093bmVyQ2FuZGlkYXRlKTsKICAgIH0KCiAgICAvLy8gQGRldiBBY2NlcHRzIG5ldyBvd25lcnNoaXAgb24gYmVoYWxmIG9mIHRoZSBWZXN0aW5nVHJ1c3RlZSBjb250cmFjdC4KICAgIC8vLyBUaGlzIGNhbiBiZSB1c2VkIGJ5IHRoZSB0b2tlbiBzYWxlIGNvbnRyYWN0IGl0c2VsZiB0byBjbGFpbSBiYWNrIG93bmVyc2hpcCBvZiB0aGUgVmVzdGluZ1RydXN0ZWUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBhY2NlcHRWZXN0aW5nVHJ1c3RlZU93bmVyc2hpcCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgdHJ1c3RlZS5hY2NlcHRPd25lcnNoaXAoKTsKICAgIH0KfQoKY29udHJhY3QgVmVzdGluZ1RydXN0ZWUgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLyBCbG9rIHRva2VuIGNvbnRyYWN0LgogICAgQmxva1Rva2VuIHB1YmxpYyBibG9rOwoKICAgIC8vIFZlc3RpbmcgZ3JhbnQgZm9yIGEgc3BlaWNpZmMgaG9sZGVyLgogICAgc3RydWN0IEdyYW50IHsKICAgICAgICB1aW50MjU2IHZhbHVlOwogICAgICAgIHVpbnQyNTYgc3RhcnQ7CiAgICAgICAgdWludDI1NiBjbGlmZjsKICAgICAgICB1aW50MjU2IGVuZDsKICAgICAgICB1aW50MjU2IGluc3RhbGxtZW50TGVuZ3RoOyAvLyBJbiBzZWNvbmRzLgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJyZWQ7CiAgICAgICAgYm9vbCByZXZva2FibGU7CiAgICB9CgogICAgLy8gSG9sZGVyIHRvIGdyYW50IGluZm9ybWF0aW9uIG1hcHBpbmcuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IEdyYW50KSBwdWJsaWMgZ3JhbnRzOwoKICAgIC8vIFRvdGFsIHRva2VucyBhdmFpbGFibGUgZm9yIHZlc3RpbmcuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFZlc3Rpbmc7CgogICAgZXZlbnQgTmV3R3JhbnQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBUb2tlbnNVbmxvY2tlZChhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBHcmFudFJldm9rZWQoYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX3JlZnVuZCk7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgdGhhdCBpbml0aWFsaXplcyB0aGUgYWRkcmVzcyBvZiB0aGUgQmxvayB0b2tlbiBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Jsb2sgQmxva1Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSBwcmV2aW91c2x5IGRlcGxveWVkIEJsb2sgdG9rZW4gY29udHJhY3QuCiAgICBmdW5jdGlvbiBWZXN0aW5nVHJ1c3RlZShCbG9rVG9rZW4gX2Jsb2spIHsKICAgICAgICByZXF1aXJlKF9ibG9rICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBibG9rID0gX2Jsb2s7CiAgICB9CgogICAgLy8vIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIFRoZSBob2xkZXIgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0IHVpbnQyNTYgVGhlIGJlZ2lubmluZyBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9jbGlmZiB1aW50MjU2IER1cmF0aW9uIG9mIHRoZSBjbGlmZiBwZXJpb2QgKHdoZW4gdGhlIGZpcnN0IGluc3RhbGxtZW50IGlzIG1hZGUpLgogICAgLy8vIEBwYXJhbSBfZW5kIHVpbnQyNTYgVGhlIGVuZCBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9pbnN0YWxsbWVudExlbmd0aCB1aW50MjU2IFRoZSBsZW5ndGggb2YgZWFjaCB2ZXN0aW5nIGluc3RhbGxtZW50IChpbiBzZWNvbmRzKS4KICAgIC8vLyBAcGFyYW0gX3Jldm9rYWJsZSBib29sIFdoZXRoZXIgdGhlIGdyYW50IGlzIHJldm9rYWJsZSBvciBub3QuCiAgICBmdW5jdGlvbiBncmFudChhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9jbGlmZiwgdWludDI1NiBfZW5kLAogICAgICAgIHVpbnQyNTYgX2luc3RhbGxtZW50TGVuZ3RoLCBib29sIF9yZXZva2FibGUpCiAgICAgICAgZXh0ZXJuYWwgb25seU93bmVyIHsKCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7IC8vIERvbid0IGFsbG93IGhvbGRlciB0byBiZSB0aGlzIGNvbnRyYWN0LgogICAgICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgICAgIC8vIFJlcXVpcmUgdGhhdCBldmVyeSBob2xkZXIgY2FuIGJlIGdyYW50ZWQgdG9rZW5zIG9ubHkgb25jZS4KICAgICAgICByZXF1aXJlKGdyYW50c1tfdG9dLnZhbHVlID09IDApOwoKICAgICAgICAvLyBSZXF1aXJlIGZvciB0aW1lIHJhbmdlcyB0byBiZSBjb25zaXN0ZW50IGFuZCB2YWxpZC4KICAgICAgICByZXF1aXJlKF9zdGFydCA8PSBfY2xpZmYgJiYgX2NsaWZmIDw9IF9lbmQpOwoKICAgICAgICAvLyBSZXF1aXJlIGluc3RhbGxtZW50IGxlbmd0aCB0byBiZSB2YWxpZCBhbmQgbm8gbG9uZ2VyIHRoYW4gKGVuZCAtIHN0YXJ0KS4KICAgICAgICByZXF1aXJlKF9pbnN0YWxsbWVudExlbmd0aCA+IDAgJiYgX2luc3RhbGxtZW50TGVuZ3RoIDw9IF9lbmQuc3ViKF9zdGFydCkpOwoKICAgICAgICAvLyBHcmFudCBtdXN0IG5vdCBleGNlZWQgdGhlIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgY3VycmVudGx5IGF2YWlsYWJsZSBmb3IgdmVzdGluZy4KICAgICAgICByZXF1aXJlKHRvdGFsVmVzdGluZy5hZGQoX3ZhbHVlKSA8PSBibG9rLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSk7CgogICAgICAgIC8vIEFzc2lnbiBhIG5ldyBncmFudC4KICAgICAgICBncmFudHNbX3RvXSA9IEdyYW50KHsKICAgICAgICAgICAgdmFsdWU6IF92YWx1ZSwKICAgICAgICAgICAgc3RhcnQ6IF9zdGFydCwKICAgICAgICAgICAgY2xpZmY6IF9jbGlmZiwKICAgICAgICAgICAgZW5kOiBfZW5kLAogICAgICAgICAgICBpbnN0YWxsbWVudExlbmd0aDogX2luc3RhbGxtZW50TGVuZ3RoLAogICAgICAgICAgICB0cmFuc2ZlcnJlZDogMCwKICAgICAgICAgICAgcmV2b2thYmxlOiBfcmV2b2thYmxlCiAgICAgICAgfSk7CgogICAgICAgIC8vIFNpbmNlIHRva2VucyBoYXZlIGJlZW4gZ3JhbnRlZCwgcmVkdWNlIHRoZSB0b3RhbCBhbW91bnQgYXZhaWxhYmxlIGZvciB2ZXN0aW5nLgogICAgICAgIHRvdGFsVmVzdGluZyA9IHRvdGFsVmVzdGluZy5hZGQoX3ZhbHVlKTsKCiAgICAgICAgTmV3R3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldm9rZSB0aGUgZ3JhbnQgb2YgdG9rZW5zIG9mIGEgc3BlY2lmZWQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLgogICAgZnVuY3Rpb24gcmV2b2tlKGFkZHJlc3MgX2hvbGRlcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgR3JhbnQgbWVtb3J5IGdyYW50ID0gZ3JhbnRzW19ob2xkZXJdOwoKICAgICAgICAvLyBHcmFudCBtdXN0IGJlIHJldm9rYWJsZS4KICAgICAgICByZXF1aXJlKGdyYW50LnJldm9rYWJsZSk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyB0aGF0IGFyZSBzdGlsbCBhdmFpbGFibGUgdG8gYmUKICAgICAgICAvLyByZXR1cm5lZCB0byBvd25lci4KICAgICAgICB1aW50MjU2IHJlZnVuZCA9IGdyYW50LnZhbHVlLnN1YihncmFudC50cmFuc2ZlcnJlZCk7CgogICAgICAgIC8vIFJlbW92ZSBncmFudCBpbmZvcm1hdGlvbi4KICAgICAgICBkZWxldGUgZ3JhbnRzW19ob2xkZXJdOwoKICAgICAgICAvLyBVcGRhdGUgdG90YWwgdmVzdGluZyBhbW91bnQgYW5kIHRyYW5zZmVyIHByZXZpb3VzbHkgY2FsY3VsYXRlZCB0b2tlbnMgdG8gb3duZXIuCiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLnN1YihyZWZ1bmQpOwogICAgICAgIGJsb2sudHJhbnNmZXIobXNnLnNlbmRlciwgcmVmdW5kKTsKCiAgICAgICAgR3JhbnRSZXZva2VkKF9ob2xkZXIsIHJlZnVuZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIHRoZSB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIGhvbGRlciBhdCBhIGdpdmVuIHRpbWUuCiAgICAvLy8gQHBhcmFtIF9ob2xkZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiB0aGUgaG9sZGVyLgogICAgLy8vIEBwYXJhbSBfdGltZSB1aW50MjU2IFRoZSBzcGVjaWZpYyB0aW1lIHRvIGNhbGN1bGF0ZSBhZ2FpbnN0LgogICAgLy8vIEByZXR1cm4gYSB1aW50MjU2IFJlcHJlc2VudGluZyBhIGhvbGRlcidzIHRvdGFsIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zLgogICAgZnVuY3Rpb24gdmVzdGVkVG9rZW5zKGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiBfdGltZSkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIEdyYW50IG1lbW9yeSBncmFudCA9IGdyYW50c1tfaG9sZGVyXTsKICAgICAgICBpZiAoZ3JhbnQudmFsdWUgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjYWxjdWxhdGVWZXN0ZWRUb2tlbnMoZ3JhbnQsIF90aW1lKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxjdWxhdGUgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgYXQgYSBzcGVjaWZjIHRpbWUuCiAgICAvLy8gQHBhcmFtIF9ncmFudCBHcmFudCBUaGUgdmVzdGluZyBncmFudC4KICAgIC8vLyBAcGFyYW0gX3RpbWUgdWludDI1NiBUaGUgdGltZSB0byBiZSBjaGVja2VkCiAgICAvLy8gQHJldHVybiBhIHVpbnQyNTYgUmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb2YgdmVzdGVkIHRva2VucyBvZiBhIHNwZWNpZmljIGdyYW50LgogICAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKEdyYW50IF9ncmFudCwgdWludDI1NiBfdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gSWYgd2UncmUgYmVmb3JlIHRoZSBjbGlmZiwgdGhlbiBub3RoaW5nIGlzIHZlc3RlZC4KICAgICAgICBpZiAoX3RpbWUgPCBfZ3JhbnQuY2xpZmYpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB3ZSdyZSBhZnRlciB0aGUgZW5kIG9mIHRoZSB2ZXN0aW5nIHBlcmlvZCAtIGV2ZXJ5dGhpbmcgaXMgdmVzdGVkOwogICAgICAgIGlmIChfdGltZSA+PSBfZ3JhbnQuZW5kKSB7CiAgICAgICAgICAgIHJldHVybiBfZ3JhbnQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLyBDYWxjdWxhdGUgYW1vdW50IG9mIGluc3RhbGxtZW50cyBwYXN0IHVudGlsIG5vdy4KICAgICAgICAvLwogICAgICAgIC8vIE5PVEUgcmVzdWx0IGdldHMgZmxvb3JlZCBiZWNhdXNlIG9mIGludGVnZXIgZGl2aXNpb24uCiAgICAgICAgdWludDI1NiBpbnN0YWxsbWVudHNQYXN0ID0gX3RpbWUuc3ViKF9ncmFudC5zdGFydCkuZGl2KF9ncmFudC5pbnN0YWxsbWVudExlbmd0aCk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbW91bnQgb2YgZGF5cyBpbiBlbnRpcmUgdmVzdGluZyBwZXJpb2QuCiAgICAgICAgdWludDI1NiB2ZXN0aW5nRGF5cyA9IF9ncmFudC5lbmQuc3ViKF9ncmFudC5zdGFydCk7CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbmQgcmV0dXJuIGluc3RhbGxtZW50cyB0aGF0IGhhdmUgcGFzc2VkIGFjY29yZGluZyB0byB2ZXN0aW5nIGRheXMgdGhhdCBoYXZlIHBhc3NlZC4KICAgICAgICByZXR1cm4gX2dyYW50LnZhbHVlLm11bChpbnN0YWxsbWVudHNQYXN0Lm11bChfZ3JhbnQuaW5zdGFsbG1lbnRMZW5ndGgpKS5kaXYodmVzdGluZ0RheXMpOwogICAgfQoKICAgIC8vLyBAZGV2IFVubG9jayB2ZXN0ZWQgdG9rZW5zIGFuZCB0cmFuc2ZlciB0aGVtIHRvIHRoZWlyIGhvbGRlci4KICAgIC8vLyBAcmV0dXJuIGEgdWludDI1NiBSZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIHRyYW5zZmVycmVkIHRvIHRoZWlyIGhvbGRlci4KICAgIGZ1bmN0aW9uIHVubG9ja1Zlc3RlZFRva2VucygpIGV4dGVybmFsIHsKICAgICAgICBHcmFudCBzdG9yYWdlIGdyYW50ID0gZ3JhbnRzW21zZy5zZW5kZXJdOwoKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgdGhlcmUgd2lsbCBiZSBmdW5kcyBsZWZ0IGluIGdyYW50IHRvIHRyYW5mc2VyIHRvIGhvbGRlci4KICAgICAgICByZXF1aXJlKGdyYW50LnZhbHVlICE9IDApOwoKICAgICAgICAvLyBHZXQgdGhlIHRvdGFsIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zLCBhY2Njb3JkaW5nIHRvIGdyYW50LgogICAgICAgIHVpbnQyNTYgdmVzdGVkID0gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKGdyYW50LCBub3cpOwogICAgICAgIGlmICh2ZXN0ZWQgPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIGhvbGRlciBkb2Vzbid0IHRyYW5zZmVyIG1vcmUgdGhhbiB3aGF0IGhlIGFscmVhZHkgaGFzLgogICAgICAgIHVpbnQyNTYgdHJhbnNmZXJhYmxlID0gdmVzdGVkLnN1YihncmFudC50cmFuc2ZlcnJlZCk7CiAgICAgICAgaWYgKHRyYW5zZmVyYWJsZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIFVwZGF0ZSB0cmFuc2ZlcnJlZCBhbmQgdG90YWwgdmVzdGluZyBhbW91bnQsIHRoZW4gdHJhbnNmZXIgcmVtYWluaW5nIHZlc3RlZCBmdW5kcyB0byBob2xkZXIuCiAgICAgICAgZ3JhbnQudHJhbnNmZXJyZWQgPSBncmFudC50cmFuc2ZlcnJlZC5hZGQodHJhbnNmZXJhYmxlKTsKICAgICAgICB0b3RhbFZlc3RpbmcgPSB0b3RhbFZlc3Rpbmcuc3ViKHRyYW5zZmVyYWJsZSk7CiAgICAgICAgYmxvay50cmFuc2Zlcihtc2cuc2VuZGVyLCB0cmFuc2ZlcmFibGUpOwoKICAgICAgICBUb2tlbnNVbmxvY2tlZChtc2cuc2VuZGVyLCB0cmFuc2ZlcmFibGUpOwogICAgfQp9'.
	

]
