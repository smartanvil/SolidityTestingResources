Class {
	#name : #SRT354fd4d1e0d476692756da6b76b4351b9ea31ea9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT354fd4d1e0d476692756da6b76b4351b9ea31ea9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuNDsKCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgICBmdW5jdGlvbiBzYWZlTXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICB1aW50IGMgPSBhICogYjsKICAgICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgICByZXR1cm4gYzsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgIH0KCiAgICAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgICAgdWludCBjID0gYSArIGI7CiAgICAgICAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsKICAgICAgICAgIHJldHVybiBjOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7CiAgICAgICAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7CiAgICAgfQp9CgovLyBTdGFuZGFyZCB0b2tlbiBpbnRlcmZhY2UgKEVSQyAyMCkKLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCmNvbnRyYWN0IFRva2VuIGlzIFNhZmVNYXRoIHsKICAgICAvLyBGdW5jdGlvbnM6CiAgICAgLy8vIEByZXR1cm4gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpIHt9CgogICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZQogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7fQoKICAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHt9CgogICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSl7fQoKICAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9hZGRyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2Ygd2VpIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykge30KCiAgICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHt9CgogICAgIC8vIEV2ZW50czoKICAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKY29udHJhY3QgU3RkVG9rZW4gaXMgVG9rZW4gewogICAgIC8vIEZpZWxkczoKICAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwogICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5ID0gMDsKCiAgICAgLy8gRnVuY3Rpb25zOgogICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgewogICAgICAgICAgaWYoKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgX3ZhbHVlKSB8fCAoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA8PSBiYWxhbmNlc1tfdG9dKSkgewogICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgIH0KCiAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHsKICAgICAgICAgIGlmKChiYWxhbmNlc1tfZnJvbV0gPCBfdmFsdWUpIHx8IAogICAgICAgICAgICAgICAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfdmFsdWUpIHx8IAogICAgICAgICAgICAgICAoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA8PSBiYWxhbmNlc1tfdG9dKSkgCiAgICAgICAgICB7CiAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgfQoKICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKCiAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwoKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICAgfQoKICAgICBtb2RpZmllciBvbmx5UGF5bG9hZFNpemUodWludCBfc2l6ZSkgewogICAgICAgICAgaWYobXNnLmRhdGEubGVuZ3RoIDwgX3NpemUgKyA0KSB7CiAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgfQogICAgICAgICAgXzsKICAgICB9Cn0KCmNvbnRyYWN0IE1OVFAgaXMgU3RkVG9rZW4gewovLy8gRmllbGRzOgogICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJHb2xkbWludCBNTlQgUHJlbGF1bmNoIFRva2VuIjsKICAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJNTlRQIjsKICAgICB1aW50IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgICBhZGRyZXNzIHB1YmxpYyBjcmVhdG9yID0gMHgwOwogICAgIGFkZHJlc3MgcHVibGljIGljb0NvbnRyYWN0QWRkcmVzcyA9IDB4MDsKICAgICBib29sIHB1YmxpYyBsb2NrVHJhbnNmZXJzID0gZmFsc2U7CgogICAgIC8vIDEwIG1sbgogICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFRPVEFMX1RPS0VOX1NVUFBMWSA9IDEwMDAwMDAwICogKDEgZXRoZXIgLyAxIHdlaSk7CgovLy8gTW9kaWZpZXJzOgogICAgIG1vZGlmaWVyIG9ubHlDcmVhdG9yKCkgeyBpZihtc2cuc2VuZGVyICE9IGNyZWF0b3IpIHRocm93OyBfOyB9CiAgICAgbW9kaWZpZXIgYnlDcmVhdG9yT3JJY29Db250cmFjdCgpIHsgaWYoKG1zZy5zZW5kZXIgIT0gY3JlYXRvcikgJiYgKG1zZy5zZW5kZXIgIT0gaWNvQ29udHJhY3RBZGRyZXNzKSkgdGhyb3c7IF87IH0KCiAgICAgZnVuY3Rpb24gc2V0Q3JlYXRvcihhZGRyZXNzIF9jcmVhdG9yKSBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBjcmVhdG9yID0gX2NyZWF0b3I7CiAgICAgfQoKLy8vIFNldHRlcnMvR2V0dGVycwogICAgIGZ1bmN0aW9uIHNldEljb0NvbnRyYWN0QWRkcmVzcyhhZGRyZXNzIF9pY29Db250cmFjdEFkZHJlc3MpIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIGljb0NvbnRyYWN0QWRkcmVzcyA9IF9pY29Db250cmFjdEFkZHJlc3M7CiAgICAgfQoKLy8vIEZ1bmN0aW9uczoKICAgICAvLy8gQGRldiBDb25zdHJ1Y3RvcgogICAgIGZ1bmN0aW9uIE1OVFAoKSB7CiAgICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKCiAgICAgICAgICAvLyAxMCBtbG4gdG9rZW5zIHRvdGFsCiAgICAgICAgICBhc3NlcnQoVE9UQUxfVE9LRU5fU1VQUExZID09ICgxMDAwMDAwMCAqICgxIGV0aGVyIC8gMSB3ZWkpKSk7CiAgICAgfQoKICAgICAvLy8gQGRldiBPdmVycmlkZQogICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHsKICAgICAgICAgIGlmKGxvY2tUcmFuc2ZlcnMpewogICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgIH0KICAgICAgICAgIHN1cGVyLnRyYW5zZmVyKF90byxfdmFsdWUpOwogICAgIH0KCiAgICAgLy8vIEBkZXYgT3ZlcnJpZGUKICAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKXB1YmxpY3sKICAgICAgICAgIGlmKGxvY2tUcmFuc2ZlcnMpewogICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgIH0KICAgICAgICAgIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSxfdG8sX3ZhbHVlKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGlzc3VlVG9rZW5zKGFkZHJlc3MgX3dobywgdWludCBfdG9rZW5zKSBieUNyZWF0b3JPckljb0NvbnRyYWN0IHsKICAgICAgICAgIGlmKCh0b3RhbFN1cHBseSArIF90b2tlbnMpID4gVE9UQUxfVE9LRU5fU1VQUExZKXsKICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICB9CgogICAgICAgICAgYmFsYW5jZXNbX3dob10gKz0gX3Rva2VuczsKICAgICAgICAgIHRvdGFsU3VwcGx5ICs9IF90b2tlbnM7CiAgICAgfQoKICAgICBmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3MgX3dobywgdWludCBfdG9rZW5zKSBieUNyZWF0b3JPckljb0NvbnRyYWN0IHsKICAgICAgICAgIGJhbGFuY2VzW193aG9dID0gc2FmZVN1YihiYWxhbmNlc1tfd2hvXSwgX3Rva2Vucyk7CiAgICAgICAgICB0b3RhbFN1cHBseSA9IHNhZmVTdWIodG90YWxTdXBwbHksIF90b2tlbnMpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gbG9ja1RyYW5zZmVyKGJvb2wgX2xvY2spIGJ5Q3JlYXRvck9ySWNvQ29udHJhY3QgewogICAgICAgICAgbG9ja1RyYW5zZmVycyA9IF9sb2NrOwogICAgIH0KCiAgICAgLy8gRG8gbm90IGFsbG93IHRvIHNlbmQgbW9uZXkgZGlyZWN0bHkgdG8gdGhpcyBjb250cmFjdAogICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhyb3c7CiAgICAgfQp9CgovLyBUaGlzIGNvbnRyYWN0IHdpbGwgaG9sZCBhbGwgdG9rZW5zIHRoYXQgd2VyZSB1bnNvbGQgZHVyaW5nIElDTwovLyAoR29sZG1pbnQgc2hvdWxkIGJlIGFibGUgdG8gd2l0aGRyYXcgdGhlbSBhbmQgc29sZCBvbmx5IDEgeWVhciBwb3N0LUlDTykKY29udHJhY3QgR29sZG1pbnRVbnNvbGQgaXMgU2FmZU1hdGggewogICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3I7CiAgICAgYWRkcmVzcyBwdWJsaWMgdGVhbUFjY291bnRBZGRyZXNzOwogICAgIGFkZHJlc3MgcHVibGljIGljb0NvbnRyYWN0QWRkcmVzczsKICAgICB1aW50NjQgcHVibGljIGljb0lzRmluaXNoZWREYXRlOwoKICAgICBNTlRQIHB1YmxpYyBtbnRUb2tlbjsKCiAgICAgZnVuY3Rpb24gR29sZG1pbnRVbnNvbGQoYWRkcmVzcyBfdGVhbUFjY291bnRBZGRyZXNzLGFkZHJlc3MgX21udFRva2VuQWRkcmVzcyl7CiAgICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKICAgICAgICAgIHRlYW1BY2NvdW50QWRkcmVzcyA9IF90ZWFtQWNjb3VudEFkZHJlc3M7CgogICAgICAgICAgbW50VG9rZW4gPSBNTlRQKF9tbnRUb2tlbkFkZHJlc3MpOyAgICAgICAgICAKICAgICB9CgovLy8gU2V0dGVycy9HZXR0ZXJzCiAgICAgZnVuY3Rpb24gc2V0SWNvQ29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX2ljb0NvbnRyYWN0QWRkcmVzcykgewogICAgICAgICAgaWYobXNnLnNlbmRlciE9Y3JlYXRvcil7CiAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgfQoKICAgICAgICAgIGljb0NvbnRyYWN0QWRkcmVzcyA9IF9pY29Db250cmFjdEFkZHJlc3M7CiAgICAgfQoKICAgICBmdW5jdGlvbiBpY29Jc0ZpbmlzaGVkKCkgcHVibGljIHsKICAgICAgICAgIC8vIG9ubHkgYnkgR29sZG1pbnQgY29udHJhY3QgCiAgICAgICAgICBpZihtc2cuc2VuZGVyIT1pY29Db250cmFjdEFkZHJlc3MpewogICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgIH0KCiAgICAgICAgICBpY29Jc0ZpbmlzaGVkRGF0ZSA9IHVpbnQ2NChub3cpOwogICAgIH0KCiAgICAgLy8gY2FuIGJlIGNhbGxlZCBieSBhbnlvbmUuLi4KICAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucygpIHB1YmxpYyB7CiAgICAgICAgICAvLyB3YWl0IGZvciAxIHllYXIhCiAgICAgICAgICB1aW50NjQgb25lWWVhclBhc3NlZCA9IGljb0lzRmluaXNoZWREYXRlICsgMzY1IGRheXM7ICAKICAgICAgICAgIGlmKHVpbnQobm93KSA8IG9uZVllYXJQYXNzZWQpIHRocm93OwoKICAgICAgICAgIC8vIHRyYW5zZmVyIGFsbCB0b2tlbnMgZnJvbSB0aGlzIGNvbnRyYWN0IHRvIHRoZSB0ZWFtQWNjb3VudEFkZHJlc3MKICAgICAgICAgIHVpbnQgdG90YWwgPSBtbnRUb2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgICBtbnRUb2tlbi50cmFuc2Zlcih0ZWFtQWNjb3VudEFkZHJlc3MsdG90YWwpOwogICAgIH0KCiAgICAgLy8gRGVmYXVsdCBmYWxsYmFjayBmdW5jdGlvbgogICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgICB0aHJvdzsKICAgICB9Cn0KCmNvbnRyYWN0IEZvdW5kZXJzVmVzdGluZyBpcyBTYWZlTWF0aCB7CiAgICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvcjsKICAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtQWNjb3VudEFkZHJlc3M7CiAgICAgdWludDY0IHB1YmxpYyBsYXN0V2l0aGRyYXdUaW1lOwoKICAgICB1aW50IHB1YmxpYyB3aXRoZHJhd3NDb3VudCA9IDA7CiAgICAgdWludCBwdWJsaWMgYW1vdW50VG9TZW5kID0gMDsKCiAgICAgTU5UUCBwdWJsaWMgbW50VG9rZW47CgogICAgIGZ1bmN0aW9uIEZvdW5kZXJzVmVzdGluZyhhZGRyZXNzIF90ZWFtQWNjb3VudEFkZHJlc3MsYWRkcmVzcyBfbW50VG9rZW5BZGRyZXNzKXsKICAgICAgICAgIGNyZWF0b3IgPSBtc2cuc2VuZGVyOwogICAgICAgICAgdGVhbUFjY291bnRBZGRyZXNzID0gX3RlYW1BY2NvdW50QWRkcmVzczsKICAgICAgICAgIGxhc3RXaXRoZHJhd1RpbWUgPSB1aW50NjQobm93KTsKCiAgICAgICAgICBtbnRUb2tlbiA9IE1OVFAoX21udFRva2VuQWRkcmVzcyk7ICAgICAgICAgIAogICAgIH0KCiAgICAgLy8gY2FuIGJlIGNhbGxlZCBieSBhbnlvbmUuLi4KICAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucygpIHB1YmxpYyB7CiAgICAgICAgICAvLyAxIC0gd2FpdCBmb3IgbmV4dCBtb250aCEKICAgICAgICAgIHVpbnQ2NCBvbmVNb250aCA9IGxhc3RXaXRoZHJhd1RpbWUgKyAzMCBkYXlzOyAgCiAgICAgICAgICBpZih1aW50KG5vdykgPCBvbmVNb250aCkgdGhyb3c7CgogICAgICAgICAgLy8gMiAtIGNhbGN1bGF0ZSBhbW91bnQgKG9ubHkgZmlyc3QgdGltZSkKICAgICAgICAgIGlmKHdpdGhkcmF3c0NvdW50PT0wKXsKICAgICAgICAgICAgICAgYW1vdW50VG9TZW5kID0gbW50VG9rZW4uYmFsYW5jZU9mKHRoaXMpIC8gMTA7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gMyAtIHNlbmQgMS8xMHRoCiAgICAgICAgICBhc3NlcnQoYW1vdW50VG9TZW5kIT0wKTsKICAgICAgICAgIG1udFRva2VuLnRyYW5zZmVyKHRlYW1BY2NvdW50QWRkcmVzcyxhbW91bnRUb1NlbmQpOwoKICAgICAgICAgIHdpdGhkcmF3c0NvdW50Kys7CiAgICAgICAgICBsYXN0V2l0aGRyYXdUaW1lID0gdWludDY0KG5vdyk7CiAgICAgfQoKICAgICAvLyBEZWZhdWx0IGZhbGxiYWNrIGZ1bmN0aW9uCiAgICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICAgIHRocm93OwogICAgIH0KfQoKY29udHJhY3QgR29sZG1pbnQgaXMgU2FmZU1hdGggewogICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3IgPSAweDA7CiAgICAgYWRkcmVzcyBwdWJsaWMgdG9rZW5NYW5hZ2VyID0gMHgwOwogICAgIGFkZHJlc3MgcHVibGljIG11bHRpc2lnQWRkcmVzcyA9IDB4MDsKICAgICBhZGRyZXNzIHB1YmxpYyBvdGhlckN1cnJlbmNpZXNDaGVja2VyID0gMHgwOwoKICAgICB1aW50NjQgcHVibGljIGljb1N0YXJ0ZWRUaW1lID0gMDsKCiAgICAgTU5UUCBwdWJsaWMgbW50VG9rZW47IAogICAgIEdvbGRtaW50VW5zb2xkIHB1YmxpYyB1bnNvbGRDb250cmFjdDsKCiAgICAgLy8gVGhlc2UgY2FuIGJlIGNoYW5nZWQgYmVmb3JlIElDTyBzdGFydCAoJDdVU0QvTU5UUCkKICAgICB1aW50IGNvbnN0YW50IFNURF9QUklDRV9VU0RfUEVSXzEwMDBfVE9LRU5TID0gNzAwMDsKICAgICAvLyBjb2lubWFya2V0Y2FwLmNvbSAxNC4wOC4yMDE3CiAgICAgdWludCBjb25zdGFudCBFVEhfUFJJQ0VfSU5fVVNEID0gMzAwOwogICAgIC8vIHByaWNlIGNoYW5nZXMgZnJvbSBibG9jayB0byBibG9jawogICAgIC8vdWludCBwdWJsaWMgY29uc3RhbnQgU0lOR0xFX0JMT0NLX0xFTiA9IDcwMDAwMDsKCiAgICAgdWludCBwdWJsaWMgY29uc3RhbnQgU0lOR0xFX0JMT0NLX0xFTiA9IDEwMDsKCi8vLy8vLy8gICAgIAogICAgIC8vIDEgMDAwIDAwMCB0b2tlbnMKICAgICB1aW50IHB1YmxpYyBjb25zdGFudCBCT05VU19SRVdBUkQgPSAxMDAwMDAwICogKDEgZXRoZXIvIDEgd2VpKTsKICAgICAvLyAyIDAwMCAwMDAgdG9rZW5zCiAgICAgdWludCBwdWJsaWMgY29uc3RhbnQgRk9VTkRFUlNfUkVXQVJEID0gMjAwMDAwMCAqICgxIGV0aGVyIC8gMSB3ZWkpOwogICAgIC8vIDcgMDAwIDAwMCB3ZSBzZWxsIG9ubHkgdGhpcyBhbW91bnQgb2YgdG9rZW5zIGR1cmluZyB0aGUgSUNPCiAgICAgLy91aW50IHB1YmxpYyBjb25zdGFudCBJQ09fVE9LRU5fU1VQUExZX0xJTUlUID0gNzAwMDAwMCAqICgxIGV0aGVyIC8gMSB3ZWkpOyAKICAgICAKICAgICB1aW50IHB1YmxpYyBjb25zdGFudCBJQ09fVE9LRU5fU1VQUExZX0xJTUlUID0gMjUwICogKDEgZXRoZXIgLyAxIHdlaSk7IAoKICAgICAvLyB0aGlzIGlzIHRvdGFsIG51bWJlciBvZiB0b2tlbnMgc29sZCBkdXJpbmcgSUNPCiAgICAgdWludCBwdWJsaWMgaWNvVG9rZW5zU29sZCA9IDA7CiAgICAgLy8gdGhpcyBpcyB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIHNlbnQgdG8gR29sZG1pbnRVbnNvbGQgY29udHJhY3QgYWZ0ZXIgSUNPIGlzIGZpbmlzaGVkCiAgICAgdWludCBwdWJsaWMgaWNvVG9rZW5zVW5zb2xkID0gMDsKCiAgICAgLy8gdGhpcyBpcyB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIHRoYXQgd2VyZSBpc3N1ZWQgYnkgYSBzY3JpcHRzCiAgICAgdWludCBwdWJsaWMgaXNzdWVkRXh0ZXJuYWxseVRva2VucyA9IDA7CgogICAgIGJvb2wgcHVibGljIGZvdW5kZXJzUmV3YXJkc01pbnRlZCA9IGZhbHNlOwogICAgIGJvb2wgcHVibGljIHJlc3RUb2tlbnNNb3ZlZCA9IGZhbHNlOwoKICAgICAvLyB0aGlzIGlzIHdoZXJlIEZPVU5ERVJTX1JFV0FSRCB3aWxsIGJlIGFsbG9jYXRlZAogICAgIGFkZHJlc3MgcHVibGljIGZvdW5kZXJzUmV3YXJkc0FjY291bnQgPSAweDA7CgogICAgIGVudW0gU3RhdGV7CiAgICAgICAgICBJbml0LAoKICAgICAgICAgIElDT1J1bm5pbmcsCiAgICAgICAgICBJQ09QYXVzZWQsCiAgICAgICAgIAogICAgICAgICAgSUNPRmluaXNoZWQKICAgICB9CiAgICAgU3RhdGUgcHVibGljIGN1cnJlbnRTdGF0ZSA9IFN0YXRlLkluaXQ7CgovLy8gTW9kaWZpZXJzOgogICAgIG1vZGlmaWVyIG9ubHlDcmVhdG9yKCkgeyBpZihtc2cuc2VuZGVyICE9IGNyZWF0b3IpIHRocm93OyBfOyB9CiAgICAgbW9kaWZpZXIgb25seVRva2VuTWFuYWdlcigpIHsgaWYobXNnLnNlbmRlciAhPSB0b2tlbk1hbmFnZXIpIHRocm93OyBfOyB9CiAgICAgbW9kaWZpZXIgb25seU90aGVyQ3VycmVuY2llc0NoZWNrZXIoKSB7IGlmKG1zZy5zZW5kZXIgIT0gb3RoZXJDdXJyZW5jaWVzQ2hlY2tlcikgdGhyb3c7IF87IH0KCiAgICAgbW9kaWZpZXIgb25seUluU3RhdGUoU3RhdGUgc3RhdGUpeyBpZihzdGF0ZSAhPSBjdXJyZW50U3RhdGUpIHRocm93OyBfOyB9CgovLy8gRXZlbnRzOgogICAgIGV2ZW50IExvZ1N0YXRlU3dpdGNoKFN0YXRlIG5ld1N0YXRlKTsKICAgICBldmVudCBMb2dCdXkoYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IHZhbHVlKTsKICAgICBldmVudCBMb2dCdXJuKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCB2YWx1ZSk7CiAgICAgCi8vLyBGdW5jdGlvbnM6CiAgICAgLy8vIEBkZXYgQ29uc3RydWN0b3IKICAgICBmdW5jdGlvbiBHb2xkbWludCgKICAgICAgICAgIGFkZHJlc3MgX211bHRpc2lnQWRkcmVzcywKICAgICAgICAgIGFkZHJlc3MgX3Rva2VuTWFuYWdlciwKICAgICAgICAgIGFkZHJlc3MgX290aGVyQ3VycmVuY2llc0NoZWNrZXIsCgogICAgICAgICAgYWRkcmVzcyBfbW50VG9rZW5BZGRyZXNzLAogICAgICAgICAgYWRkcmVzcyBfdW5zb2xkQ29udHJhY3RBZGRyZXNzLAogICAgICAgICAgYWRkcmVzcyBfZm91bmRlcnNWZXN0aW5nQWRkcmVzcykKICAgICB7CiAgICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKCiAgICAgICAgICBtdWx0aXNpZ0FkZHJlc3MgPSBfbXVsdGlzaWdBZGRyZXNzOwogICAgICAgICAgdG9rZW5NYW5hZ2VyID0gX3Rva2VuTWFuYWdlcjsKICAgICAgICAgIG90aGVyQ3VycmVuY2llc0NoZWNrZXIgPSBfb3RoZXJDdXJyZW5jaWVzQ2hlY2tlcjsgCgogICAgICAgICAgbW50VG9rZW4gPSBNTlRQKF9tbnRUb2tlbkFkZHJlc3MpOwogICAgICAgICAgdW5zb2xkQ29udHJhY3QgPSBHb2xkbWludFVuc29sZChfdW5zb2xkQ29udHJhY3RBZGRyZXNzKTsKCiAgICAgICAgICAvLyBzbGlnaHQgcmVuYW1lCiAgICAgICAgICBmb3VuZGVyc1Jld2FyZHNBY2NvdW50ID0gX2ZvdW5kZXJzVmVzdGluZ0FkZHJlc3M7CiAgICAgfQoKICAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgY2FsbGVkIHdoZW4gSUNPIGlzIHN0YXJ0ZWQKICAgICAvLy8gV0FSTklORzogY2FuIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyEKICAgICBmdW5jdGlvbiBzdGFydElDTygpIGludGVybmFsIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIG1pbnRGb3VuZGVyc1Jld2FyZHMoZm91bmRlcnNSZXdhcmRzQWNjb3VudCk7CgogICAgICAgICAgbW50VG9rZW4ubG9ja1RyYW5zZmVyKHRydWUpOwoKICAgICAgICAgIGlmKGljb1N0YXJ0ZWRUaW1lPT0wKXsKICAgICAgICAgICAgICAgaWNvU3RhcnRlZFRpbWUgPSB1aW50NjQobm93KTsKICAgICAgICAgIH0KICAgICB9CgogICAgIGZ1bmN0aW9uIHBhdXNlSUNPKCkgaW50ZXJuYWwgb25seUNyZWF0b3IgewogICAgICAgICAgbW50VG9rZW4ubG9ja1RyYW5zZmVyKGZhbHNlKTsKICAgICB9CgogICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gaXMgYXV0b21hdGljYWxseSBjYWxsZWQgd2hlbiBJQ08gaXMgZmluaXNoZWQgCiAgICAgLy8vIFdBUk5JTkc6IGNhbiBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMhCiAgICAgZnVuY3Rpb24gZmluaXNoSUNPKCkgaW50ZXJuYWwgewogICAgICAgICAgbW50VG9rZW4ubG9ja1RyYW5zZmVyKGZhbHNlKTsKCiAgICAgICAgICBpZighcmVzdFRva2Vuc01vdmVkKXsKICAgICAgICAgICAgICAgcmVzdFRva2Vuc01vdmVkID0gdHJ1ZTsKCiAgICAgICAgICAgICAgIC8vIG1vdmUgYWxsIHVuc29sZCB0b2tlbnMgdG8gdW5zb2xkVG9rZW5zIGNvbnRyYWN0CiAgICAgICAgICAgICAgIGljb1Rva2Vuc1Vuc29sZCA9IHNhZmVTdWIoSUNPX1RPS0VOX1NVUFBMWV9MSU1JVCxpY29Ub2tlbnNTb2xkKTsKICAgICAgICAgICAgICAgaWYoaWNvVG9rZW5zVW5zb2xkPjApewogICAgICAgICAgICAgICAgICAgIG1udFRva2VuLmlzc3VlVG9rZW5zKHVuc29sZENvbnRyYWN0LGljb1Rva2Vuc1Vuc29sZCk7CiAgICAgICAgICAgICAgICAgICAgdW5zb2xkQ29udHJhY3QuaWNvSXNGaW5pc2hlZCgpOwogICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gc2VuZCBhbGwgRVRIIHRvIG11bHRpc2lnCiAgICAgICAgICBpZih0aGlzLmJhbGFuY2U+MCl7CiAgICAgICAgICAgICAgIGlmKCFtdWx0aXNpZ0FkZHJlc3Muc2VuZCh0aGlzLmJhbGFuY2UpKSB0aHJvdzsKICAgICAgICAgIH0KICAgICB9CgogICAgIGZ1bmN0aW9uIG1pbnRGb3VuZGVyc1Jld2FyZHMoYWRkcmVzcyBfd2hlcmVUb01pbnQpIGludGVybmFsIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIGlmKCFmb3VuZGVyc1Jld2FyZHNNaW50ZWQpewogICAgICAgICAgICAgICBmb3VuZGVyc1Jld2FyZHNNaW50ZWQgPSB0cnVlOwogICAgICAgICAgICAgICBtbnRUb2tlbi5pc3N1ZVRva2Vucyhfd2hlcmVUb01pbnQsRk9VTkRFUlNfUkVXQVJEKTsKICAgICAgICAgIH0KICAgICB9CgovLy8gQWNjZXNzIG1ldGhvZHM6CiAgICAgZnVuY3Rpb24gc2V0VG9rZW5NYW5hZ2VyKGFkZHJlc3MgX25ldykgcHVibGljIG9ubHlUb2tlbk1hbmFnZXIgewogICAgICAgICAgdG9rZW5NYW5hZ2VyID0gX25ldzsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNldE90aGVyQ3VycmVuY2llc0NoZWNrZXIoYWRkcmVzcyBfbmV3KSBwdWJsaWMgb25seU90aGVyQ3VycmVuY2llc0NoZWNrZXIgewogICAgICAgICAgb3RoZXJDdXJyZW5jaWVzQ2hlY2tlciA9IF9uZXc7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRUb2tlbnNJY29Tb2xkKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpewogICAgICAgICAgcmV0dXJuIGljb1Rva2Vuc1NvbGQ7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRUb3RhbEljb1Rva2VucygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KXsKICAgICAgICAgIHJldHVybiBJQ09fVE9LRU5fU1VQUExZX0xJTUlUOwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0TW50VG9rZW5CYWxhbmNlKGFkZHJlc3MgX29mKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCl7CiAgICAgICAgICByZXR1cm4gbW50VG9rZW4uYmFsYW5jZU9mKF9vZik7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UoKWNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KXsKICAgICAgICAgIHJldHVybiBnZXRNbnRUb2tlbnNQZXJFdGgoaWNvVG9rZW5zU29sZCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRCbG9ja0xlbmd0aCgpY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpewogICAgICAgICAgcmV0dXJuIFNJTkdMRV9CTE9DS19MRU47CiAgICAgfQoKLy8vLwogICAgIGZ1bmN0aW9uIGlzSWNvRmluaXNoZWQoKSBwdWJsaWMgcmV0dXJucyhib29sKXsKICAgICAgICAgIGlmKGljb1N0YXJ0ZWRUaW1lPT0wKXtyZXR1cm4gZmFsc2U7fSAgICAgICAgICAKCiAgICAgICAgICAvLyAxIC0gaWYgdGltZSBlbGFwc2VkCiAgICAgICAgICB1aW50NjQgb25lTW9udGggPSBpY29TdGFydGVkVGltZSArIDMwIGRheXM7ICAKICAgICAgICAgIGlmKHVpbnQobm93KSA+IG9uZU1vbnRoKXtyZXR1cm4gdHJ1ZTt9CgogICAgICAgICAgLy8gMiAtIGlmIGFsbCB0b2tlbnMgYXJlIHNvbGQKICAgICAgICAgIGlmKGljb1Rva2Vuc1NvbGQ+PUlDT19UT0tFTl9TVVBQTFlfTElNSVQpewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzZXRTdGF0ZShTdGF0ZSBfbmV4dFN0YXRlKSBwdWJsaWMgewogICAgICAgICAgLy8gb25seSBjcmVhdG9yIGNhbiBjaGFuZ2Ugc3RhdGUKICAgICAgICAgIC8vIGJ1dCBpbiBjYXNlIElDT0ZpbmlzaGVkIC0+IGFueW9uZSBjYW4gZG8gdGhhdCBhZnRlciBhbGwgdGltZSBpcyBlbGFwc2VkCiAgICAgICAgICBib29sIGljb1Nob3VsZEJlRmluaXNoZWQgPSBpc0ljb0ZpbmlzaGVkKCk7CiAgICAgICAgICBpZigobXNnLnNlbmRlciE9Y3JlYXRvcikgJiYgIShpY29TaG91bGRCZUZpbmlzaGVkICYmIFN0YXRlLklDT0ZpbmlzaGVkPT1fbmV4dFN0YXRlKSl7CiAgICAgICAgICAgICAgIHRocm93OwogICAgICAgICAgfQoKICAgICAgICAgIGJvb2wgY2FuU3dpdGNoU3RhdGUKICAgICAgICAgICAgICAgPSAgKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Jbml0ICYmIF9uZXh0U3RhdGUgPT0gU3RhdGUuSUNPUnVubmluZykKICAgICAgICAgICAgICAgfHwgKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5JQ09SdW5uaW5nICYmIF9uZXh0U3RhdGUgPT0gU3RhdGUuSUNPUGF1c2VkKQogICAgICAgICAgICAgICB8fCAoY3VycmVudFN0YXRlID09IFN0YXRlLklDT1BhdXNlZCAmJiBfbmV4dFN0YXRlID09IFN0YXRlLklDT1J1bm5pbmcpCiAgICAgICAgICAgICAgIHx8IChjdXJyZW50U3RhdGUgPT0gU3RhdGUuSUNPUnVubmluZyAmJiBfbmV4dFN0YXRlID09IFN0YXRlLklDT0ZpbmlzaGVkKQogICAgICAgICAgICAgICB8fCAoY3VycmVudFN0YXRlID09IFN0YXRlLklDT0ZpbmlzaGVkICYmIF9uZXh0U3RhdGUgPT0gU3RhdGUuSUNPUnVubmluZyk7CgogICAgICAgICAgaWYoIWNhblN3aXRjaFN0YXRlKSB0aHJvdzsKCiAgICAgICAgICBjdXJyZW50U3RhdGUgPSBfbmV4dFN0YXRlOwogICAgICAgICAgTG9nU3RhdGVTd2l0Y2goX25leHRTdGF0ZSk7CgogICAgICAgICAgaWYoY3VycmVudFN0YXRlPT1TdGF0ZS5JQ09SdW5uaW5nKXsKICAgICAgICAgICAgICAgc3RhcnRJQ08oKTsKICAgICAgICAgIH1lbHNlIGlmKGN1cnJlbnRTdGF0ZT09U3RhdGUuSUNPRmluaXNoZWQpewogICAgICAgICAgICAgICBmaW5pc2hJQ08oKTsKICAgICAgICAgIH1lbHNlIGlmKGN1cnJlbnRTdGF0ZT09U3RhdGUuSUNPUGF1c2VkKXsKICAgICAgICAgICAgICAgcGF1c2VJQ08oKTsKICAgICAgICAgIH0KICAgICB9CgogICAgIGZ1bmN0aW9uIGdldE1udFRva2Vuc1BlckV0aCh1aW50IHRva2Vuc1NvbGQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KXsKICAgICAgICAgIC8vIDEwIGJ1Y2tldHMKICAgICAgICAgIHVpbnQgcHJpY2VJbmRleCA9ICh0b2tlbnNTb2xkIC8gKDEgZXRoZXIvIDEgd2VpKSkgLyBTSU5HTEVfQkxPQ0tfTEVOOwogICAgICAgICAgYXNzZXJ0KHByaWNlSW5kZXg+PTAgJiYgKHByaWNlSW5kZXg8PTkpKTsKICAgICAgICAgIAogICAgICAgICAgdWludDhbMTBdIG1lbW9yeSBkaXNjb3VudFBlcmNlbnRzID0gWzIwLDE1LDEwLDgsNiw0LDIsMCwwLDBdOwoKICAgICAgICAgIC8vIFdlIGhhdmUgdG8gbXVsdGlwbHkgYnkgJzEgZXRoZXInIHRvIGF2b2lkIGZsb2F0IHRydW5jYXRpb25zCiAgICAgICAgICAvLyBFeGFtcGxlOiAoJDcwMDAgKiAxMDApIC8gMTIwID0gJDU4MzMuMzMzMzMKICAgICAgICAgIHVpbnQgcHJpY2VQZXIxMDAwdG9rZW5zVXNkID0gCiAgICAgICAgICAgICAgICgoU1REX1BSSUNFX1VTRF9QRVJfMTAwMF9UT0tFTlMgKiAxMDApICogKDEgZXRoZXIgLyAxIHdlaSkpIC8gKDEwMCArIGRpc2NvdW50UGVyY2VudHNbcHJpY2VJbmRleF0pOwoKICAgICAgICAgIC8vIENvcnJlY3Q6IDMwMDAwMCAvIDU4MzMuMzMzMzMzMzMgPSA1MS40Mjg1NzE0MgogICAgICAgICAgLy8gV2UgaGF2ZSB0byBtdWx0aXBseSBieSAnMSBldGhlcicgdG8gYXZvaWQgZmxvYXQgdHJ1bmNhdGlvbnMKICAgICAgICAgIHVpbnQgbW50UGVyRXRoID0gKEVUSF9QUklDRV9JTl9VU0QgKiAxMDAwICogKDEgZXRoZXIgLyAxIHdlaSkgKiAoMSBldGhlciAvIDEgd2VpKSkgLyBwcmljZVBlcjEwMDB0b2tlbnNVc2Q7CiAgICAgICAgICByZXR1cm4gbW50UGVyRXRoOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgX2J1eWVyKSBwdWJsaWMgcGF5YWJsZSBvbmx5SW5TdGF0ZShTdGF0ZS5JQ09SdW5uaW5nKSB7CiAgICAgICAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7CgogICAgICAgICAgLy8gVGhlIHByaWNlIGlzIHNlbGVjdGVkIGJhc2VkIG9uIGN1cnJlbnQgc29sZCB0b2tlbnMuCiAgICAgICAgICAvLyBQcmljZSBjYW4gJ292ZXJsYXAnLiBGb3IgZXhhbXBsZToKICAgICAgICAgIC8vICAgMS4gaWYgY3VycmVudGx5IHdlIHNvbGQgNjk5OTUwIHRva2VucyAodGhlIHByaWNlIGlzIDEwJSBkaXNjb3VudCkKICAgICAgICAgIC8vICAgMi4gYnV5ZXIgYnV5cyAxMDAwIHRva2VucwogICAgICAgICAgLy8gICAzLiB0aGUgcHJpY2Ugb2YgYWxsIDEwMDAgdG9rZW5zIHdvdWxkIGJlIHdpdGggMTAlIGRpc2NvdW50ISEhCiAgICAgICAgICB1aW50IG5ld1Rva2VucyA9IChtc2cudmFsdWUgKiBnZXRNbnRUb2tlbnNQZXJFdGgoaWNvVG9rZW5zU29sZCkpIC8gKDEgZXRoZXIgLyAxIHdlaSk7CgogICAgICAgICAgaXNzdWVUb2tlbnNJbnRlcm5hbChfYnV5ZXIsbmV3VG9rZW5zKTsKICAgICB9CgogICAgIC8vLyBAZGV2IFRoaXMgaXMgY2FsbGVkIGJ5IG90aGVyIGN1cnJlbmN5IHByb2Nlc3NvcnMgdG8gaXNzdWUgbmV3IHRva2VucyAKICAgICBmdW5jdGlvbiBpc3N1ZVRva2Vuc0Zyb21PdGhlckN1cnJlbmN5KGFkZHJlc3MgX3RvLCB1aW50IF93ZWlfY291bnQpIG9ubHlJblN0YXRlKFN0YXRlLklDT1J1bm5pbmcpIHB1YmxpYyBvbmx5T3RoZXJDdXJyZW5jaWVzQ2hlY2tlciB7CiAgICAgICAgICBpZihfd2VpX2NvdW50PT0gMCkgdGhyb3c7CiAgICAgICAgICB1aW50IG5ld1Rva2VucyA9IChfd2VpX2NvdW50ICogZ2V0TW50VG9rZW5zUGVyRXRoKGljb1Rva2Vuc1NvbGQpKSAvICgxIGV0aGVyIC8gMSB3ZWkpOwogICAgICAgICAgaXNzdWVUb2tlbnNJbnRlcm5hbChfdG8sbmV3VG9rZW5zKTsKICAgICB9CgogICAgIC8vLyBAZGV2IFRoaXMgY2FuIGJlIGNhbGxlZCB0byBtYW51YWxseSBpc3N1ZSBuZXcgdG9rZW5zIAogICAgIC8vLyBmcm9tIHRoZSBib251cyByZXdhcmQKICAgICBmdW5jdGlvbiBpc3N1ZVRva2Vuc0V4dGVybmFsKGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbnMpIHB1YmxpYyBvbmx5SW5TdGF0ZShTdGF0ZS5JQ09GaW5pc2hlZCkgb25seVRva2VuTWFuYWdlciB7CiAgICAgICAgICAvLyBjYW4gbm90IGlzc3VlIG1vcmUgdGhhbiBCT05VU19SRVdBUkQKICAgICAgICAgIGlmKChpc3N1ZWRFeHRlcm5hbGx5VG9rZW5zICsgX3Rva2Vucyk+Qk9OVVNfUkVXQVJEKXsKICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICB9CgogICAgICAgICAgbW50VG9rZW4uaXNzdWVUb2tlbnMoX3RvLF90b2tlbnMpOwoKICAgICAgICAgIGlzc3VlZEV4dGVybmFsbHlUb2tlbnMgPSBpc3N1ZWRFeHRlcm5hbGx5VG9rZW5zICsgX3Rva2VuczsKICAgICB9CgogICAgIGZ1bmN0aW9uIGlzc3VlVG9rZW5zSW50ZXJuYWwoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VucykgaW50ZXJuYWwgewogICAgICAgICAgaWYoKGljb1Rva2Vuc1NvbGQgKyBfdG9rZW5zKT5JQ09fVE9LRU5fU1VQUExZX0xJTUlUKXsKICAgICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICB9CgogICAgICAgICAgbW50VG9rZW4uaXNzdWVUb2tlbnMoX3RvLF90b2tlbnMpOwoKICAgICAgICAgIGljb1Rva2Vuc1NvbGQrPV90b2tlbnM7CgogICAgICAgICAgTG9nQnV5KF90byxfdG9rZW5zKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBfZnJvbSwgdWludCBfdG9rZW5zKSBwdWJsaWMgb25seUluU3RhdGUoU3RhdGUuSUNPRmluaXNoZWQpIG9ubHlUb2tlbk1hbmFnZXIgewogICAgICAgICAgbW50VG9rZW4uYnVyblRva2VucyhfZnJvbSxfdG9rZW5zKTsKCiAgICAgICAgICBMb2dCdXJuKF9mcm9tLF90b2tlbnMpOwogICAgIH0KCiAgICAgLy8gRGVmYXVsdCBmYWxsYmFjayBmdW5jdGlvbgogICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgICAvLyBidXlUb2tlbnMgLT4gaXNzdWVUb2tlbnNJbnRlcm5hbAogICAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogICAgIH0KfQ=='.
	

]
