Class {
	#name : #SRT7352cb77c2478a59d21230a8d65146e04b59f58c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7352cb77c2478a59d21230a8d65146e04b59f58c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKCmxpYnJhcnkgS2V5c1V0aWxzIHsKICAgIC8vIFN1Y2ggb3JkZXIgaXMgaW1wb3J0YW50IHRvIGxvYWQgZnJvbSBzdGF0ZQogICAgc3RydWN0IE9iamVjdCB7CiAgICAgICAgdWludDMyIGdhc1ByaWNlR3dlaTsKICAgICAgICB1aW50MzIgZ2FzTGltaXQ7CiAgICAgICAgdWludDMyIHRpbWVzdGFtcDsKICAgICAgICBhZGRyZXNzIGNvbnRyYWN0QWRkcmVzczsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0tleShPYmplY3QgX29iaikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgcmV0dXJuIHRvS2V5KF9vYmouY29udHJhY3RBZGRyZXNzLCBfb2JqLnRpbWVzdGFtcCwgX29iai5nYXNMaW1pdCwgX29iai5nYXNQcmljZUd3ZWkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvS2V5RnJvbVN0b3JhZ2UoT2JqZWN0IHN0b3JhZ2UgX29iaikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczMyIF9rZXkpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIF9rZXkgOj0gc2xvYWQoX29ial9zbG90KQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0b0tleShhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczMyIHJlc3VsdCkgewogICAgICAgIHJlc3VsdCA9IDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsKICAgICAgICAvLyAgICAgICAgIF5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl4gLSBhZGRyZXNzICgyMCBieXRlcykKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBeXl5eXl5eXiAtIHRpbWVzdGFtcCAoNCBieXRlcykKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl5eXl5eIC0gZ2FzIGxpbWl0ICg0IGJ5dGVzKQogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBeXl5eXl5eXiAtIGdhcyBwcmljZSAoNCBieXRlcykKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihyZXN1bHQsIG11bChfYWRkcmVzcywgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICAgICAgcmVzdWx0IDo9IG9yKHJlc3VsdCwgbXVsKGFuZChfdGltZXN0YW1wLCAweGZmZmZmZmZmKSwgMHgxMDAwMDAwMDAwMDAwMDAwMCkpCiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihyZXN1bHQsIG11bChhbmQoX2dhc0xpbWl0LCAweGZmZmZmZmZmKSwgMHgxMDAwMDAwMDApKQogICAgICAgICAgICByZXN1bHQgOj0gb3IocmVzdWx0LCBhbmQoX2dhc1ByaWNlLCAweGZmZmZmZmZmKSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdG9NZW1vcnlPYmplY3QoYnl0ZXMzMiBfa2V5LCBPYmplY3QgbWVtb3J5IF9kZXN0KSBpbnRlcm5hbCBwdXJlIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgYW5kKF9rZXksIDB4ZmZmZmZmZmYpKQogICAgICAgICAgICBtc3RvcmUoYWRkKF9kZXN0LCAweDIwKSwgYW5kKGRpdihfa2V5LCAweDEwMDAwMDAwMCksIDB4ZmZmZmZmZmYpKQogICAgICAgICAgICBtc3RvcmUoYWRkKF9kZXN0LCAweDQwKSwgYW5kKGRpdihfa2V5LCAweDEwMDAwMDAwMDAwMDAwMDAwKSwgMHhmZmZmZmZmZikpCiAgICAgICAgICAgIG1zdG9yZShhZGQoX2Rlc3QsIDB4NjApLCBkaXYoX2tleSwgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdG9PYmplY3QoYnl0ZXMzMiBfa2V5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKE9iamVjdCBtZW1vcnkgX2Rlc3QpIHsKICAgICAgICB0b01lbW9yeU9iamVjdChfa2V5LCBfZGVzdCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9TdGF0ZU9iamVjdChieXRlczMyIF9rZXksIE9iamVjdCBzdG9yYWdlIF9kZXN0KSBpbnRlcm5hbCB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzc3RvcmUoX2Rlc3Rfc2xvdCwgX2tleSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGltZXN0YW1wKGJ5dGVzMzIgX2tleSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmVzdWx0IDo9IGFuZChkaXYoX2tleSwgMHgxMDAwMDAwMDAwMDAwMDAwMCksIDB4ZmZmZmZmZmYpCiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBUcmFuc2ZlclRva2VuIGlzIE93bmFibGUgewogICAgZnVuY3Rpb24gdHJhbnNmZXJUb2tlbihFUkMyMEJhc2ljIF90b2tlbiwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBfdG9rZW4udHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQp9CgoKY29udHJhY3QgSm91bGVQcm94eUFQSSB7CiAgICAvKioKICAgICAqIEZ1bmN0aW9uIGhhc2ggaXM6IDB4NzMwMjdmNmQKICAgICAqLwogICAgZnVuY3Rpb24gY2FsbGJhY2soYWRkcmVzcyBfY29udHJhY3QpIHB1YmxpYzsKfQoKY29udHJhY3QgQ2hlY2thYmxlQ29udHJhY3QgewogICAgZXZlbnQgQ2hlY2tlZCgpOwogICAgLyoKICAgICAqIEZ1bmN0aW9uIGhhc2ggaXMgMHg5MTk4NDBhZC4KICAgICAqLwogICAgZnVuY3Rpb24gY2hlY2soKSBwdWJsaWM7Cn0KCgpjb250cmFjdCBKb3VsZUFQSSB7CiAgICBldmVudCBJbnZva2VkKGFkZHJlc3MgaW5kZXhlZCBfYWRkcmVzcywgYm9vbCBfc3RhdHVzLCB1aW50IF91c2VkR2FzKTsKICAgIGV2ZW50IFJlZ2lzdGVyZWQoYWRkcmVzcyBpbmRleGVkIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSk7CgogICAgLyoqCiAgICAgKiBAZGV2IFJlZ2lzdGVycyB0aGUgc3BlY2lmaWVkIGNvbnRyYWN0IHRvIGludm9rZSBhdCB0aGUgc3BlY2lmaWVkIHRpbWUgd2l0aCB0aGUgc3BlY2lmaWVkIGdhcyBhbmQgcHJpY2UuCiAgICAgKiBAbm90aWNlIEl0IHJlcXVpcmVkIGFtb3VudCBvZiBFVEggYXMgdmFsdWUsIHRvIGNvdmVyIGdhcyB1c2FnZS4gU2VlIGdldFByaWNlIG1ldGhvZC4KICAgICAqCiAgICAgKiBAcGFyYW0gX2FkZHJlc3MgQ29udHJhY3QncyBhZGRyZXNzLiBDb250cmFjdCBNVVNUIGltcGxlbWVudHMgQ2hlY2thYmxlIGludGVyZmFjZS4KICAgICAqIEBwYXJhbSBfdGltZXN0YW1wIFRpbWVzdGFtcCBhdCB3aGF0IG1vbWVudCBjb250cmFjdCBzaG91bGQgYmUgY2FsbGVkLiBJdCBNVVNUIGJlIGluIGZ1dHVyZS4KICAgICAqIEBwYXJhbSBfZ2FzTGltaXQgR2FzIHdoaWNoIHdpbGwgYmUgcG9zdGVkIHRvIGNhbGwuCiAgICAgKiBAcGFyYW0gX2dhc1ByaWNlIEdhcyBwcmljZSB3aGljaCBpcyByZWNvbW1lbmRlZCB0byB1c2UgZm9yIHRoaXMgaW52b2NhdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gcmVnaXN0ZXIoYWRkcmVzcyBfYWRkcmVzcywgdWludCBfdGltZXN0YW1wLCB1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IEludm9rZXMgbmV4dCBjb250cmFjdHMgaW4gdGhlIHF1ZXVlLgogICAgICogQG5vdGljZSBFdGggYW1vdW50IHRvIGNvdmVyIGdhcyB3aWxsIGJlIHJldHVybmVkIGlmIGdhcyBwcmljZSBpcyBlcXVhbCBvciBsZXNzIHRoZW4gc3BlY2lmaWVkIGZvciBjb250cmFjdC4gQ2hlY2sgZ2V0VG9wIGZvciByaWdodCBnYXMgcHJpY2UuCiAgICAgKiBAcmV0dXJuIFJld2FyZCBhbW91bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludm9rZSgpIHB1YmxpYyByZXR1cm5zICh1aW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgSW52b2tlcyB0aGUgdG9wIGNvbnRyYWN0IGluIHRoZSBxdWV1ZS4KICAgICAqIEBub3RpY2UgRXRoIGFtb3VudCB0byBjb3ZlciBnYXMgd2lsbCBiZSByZXR1cm5lZCBpZiBnYXMgcHJpY2UgaXMgZXF1YWwgb3IgbGVzcyB0aGVuIHNwZWNpZmllZCBmb3IgY29udHJhY3QuIENoZWNrIGdldFRvcCBmb3IgcmlnaHQgZ2FzIHByaWNlLgogICAgICogQHJldHVybiBSZXdhcmQgYW1vdW50LgogICAgICovCiAgICBmdW5jdGlvbiBpbnZva2VUb3AoKSBwdWJsaWMgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IENhbGN1bGF0ZXMgcmVxdWlyZWQgdG8gcmVnaXN0ZXIgYW1vdW50IG9mIFdFSS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2dhc0xpbWl0IEdhcyB3aGljaCB3aWxsIGJlIHBvc3RlZCB0byBjYWxsLgogICAgICogQHBhcmFtIF9nYXNQcmljZSBHYXMgcHJpY2Ugd2hpY2ggaXMgcmVjb21tZW5kZWQgdG8gdXNlIGZvciB0aGlzIGludm9jYXRpb24uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBpbiB3ZWkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFByaWNlKHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KTsKCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyBob3cgbWFueSBjb250cmFjdHMgYXJlIHJlZ2lzdGVyZWQgKGFuZCBub3QgaW52b2tlZCkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldENvdW50KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgogICAgLyoqCiAgICAgKiBAZGV2IEdldHMgdG9wIGNvbnRyYWN0ICh0aGUgbmV4dCB0byBpbnZva2UpLgogICAgICoKICAgICAqIEByZXR1cm4gY29udHJhY3RBZGRyZXNzICBUaGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEByZXR1cm4gdGltZXN0YW1wICAgICAgICBUaGUgaW52b2NhdGlvbiB0aW1lc3RhbXAuCiAgICAgKiBAcmV0dXJuIGdhc0xpbWl0ICAgICAgICAgVGhlIGludm9jYXRpb24gbWF4aW11bSBnYXMuCiAgICAgKiBAcmV0dXJuIGdhc1ByaWNlICAgICAgICAgVGhlIGludm9jYXRpb24gZXhwZWN0ZWQgcHJpY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRvcCgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgdWludCB0aW1lc3RhbXAsCiAgICAgICAgdWludCBnYXNMaW1pdCwKICAgICAgICB1aW50IGdhc1ByaWNlCiAgICApOwoKICAgIC8qKgogICAgICogQGRldiBHZXRzIHRvcCBfY291bnQgY29udHJhY3RzIChpbiBvcmRlciB0byBpbnZva2UpLgogICAgICoKICAgICAqIEBwYXJhbSBfY291bnQgICAgICAgIEhvdyBtYW55IHJlY29yZHMgd2lsbCBiZSByZXR1cm5lZC4KICAgICAqIEByZXR1cm4gYWRkcmVzc2VzICAgIFRoZSBjb250cmFjdHMgYWRkcmVzc2VzLgogICAgICogQHJldHVybiB0aW1lc3RhbXBzICAgVGhlIGludm9jYXRpb24gdGltZXN0YW1wcy4KICAgICAqIEByZXR1cm4gZ2FzTGltaXRzICAgIFRoZSBpbnZvY2F0aW9uIGdhcyBsaW1pdHMuCiAgICAgKiBAcmV0dXJuIGdhc1ByaWNlcyAgICBUaGUgaW52b2NhdGlvbiBleHBlY3RlZCBwcmljZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRvcCh1aW50IF9jb3VudCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICBhZGRyZXNzW10gYWRkcmVzc2VzLAogICAgICAgIHVpbnRbXSB0aW1lc3RhbXBzLAogICAgICAgIHVpbnRbXSBnYXNMaW1pdHMsCiAgICAgICAgdWludFtdIGdhc1ByaWNlcwogICAgKTsKCiAgICAvKioKICAgICAqIEBkZXYgR2V0cyBhY3R1YWwgY29kZSB2ZXJzaW9uLgogICAgICogQHJldHVybiBDb2RlIHZlcnNpb24uIE1hc2s6IDB4ZmYuMHhmZi4weGZmZmYtMHhmZmZmZmZmZiAobWFqb3IubWlub3IuYnVpbGQtaGFzaCkKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VmVyc2lvbigpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYnl0ZXM4KTsKfQoKCgpjb250cmFjdCB1c2luZ0NvbnN0cyB7CiAgICB1aW50IGNvbnN0YW50IEdXRUkgPSAwLjAwMSBzemFibzsKICAgIC8vIHRoaXMgdmFsdWUgaW5mbHVlbmNlIHRvIHRoZSByZXdhcmQgcHJpY2UhIGRvIG5vdCBjaGFuZ2UgZm9yIGFscmVhZHkgcmVnaXN0ZXJlZCBjb250cmFjdHMhCiAgICB1aW50IGNvbnN0YW50IElETEVfR0FTID0gMjIyNzM7CiAgICB1aW50IGNvbnN0YW50IE1BWF9HQVMgPSA0MDAwMDAwOwogICAgLy8gQ29kZSB2ZXJzaW9uCiAgICBieXRlczggY29uc3RhbnQgVkVSU0lPTiA9IDB4MDEwMDAwMTMwMDAwMDAwMDsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgXl4gLSBtYWpvcgogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgIF5eIC0gbWlub3IKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl4gLSBidWlsZAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl5eXl5eIC0gZ2l0IGhhc2gKfQoKCmNvbnRyYWN0IEpvdWxlSW5kZXggewogICAgdXNpbmcgS2V5c1V0aWxzIGZvciBieXRlczMyOwogICAgdWludCBjb25zdGFudCBZRUFSID0gMHgxREZFMjAwOwoKICAgIC8vIHllYXIgLT4gbW9udGggLT4gZGF5IC0+IGhvdXIKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYnl0ZXMzMikgaW5kZXg7CiAgICBieXRlczMyIGhlYWQ7CgogICAgZnVuY3Rpb24gaW5zZXJ0KGJ5dGVzMzIgX2tleSkgcHVibGljIHsKICAgICAgICB1aW50IHRpbWVzdGFtcCA9IF9rZXkuZ2V0VGltZXN0YW1wKCk7CiAgICAgICAgYnl0ZXMzMiB5ZWFyID0gdG9LZXkodGltZXN0YW1wLCBZRUFSKTsKICAgICAgICBieXRlczMyIGhlYWRMb3c7CiAgICAgICAgYnl0ZXMzMiBoZWFkSGlnaDsKICAgICAgICAoaGVhZExvdywgaGVhZEhpZ2gpID0gZnJvbVZhbHVlKGhlYWQpOwogICAgICAgIGlmICh5ZWFyIDwgaGVhZExvdyB8fCBoZWFkTG93ID09IDAgfHwgeWVhciA+IGhlYWRIaWdoKSB7CiAgICAgICAgICAgIGlmICh5ZWFyIDwgaGVhZExvdyB8fCBoZWFkTG93ID09IDApIHsKICAgICAgICAgICAgICAgIGhlYWRMb3cgPSB5ZWFyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh5ZWFyID4gaGVhZEhpZ2gpIHsKICAgICAgICAgICAgICAgIGhlYWRIaWdoID0geWVhcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBoZWFkID0gdG9WYWx1ZShoZWFkTG93LCBoZWFkSGlnaCk7CiAgICAgICAgfQoKICAgICAgICBieXRlczMyIHdlZWsgPSB0b0tleSh0aW1lc3RhbXAsIDEgd2Vla3MpOwogICAgICAgIGJ5dGVzMzIgbG93OwogICAgICAgIGJ5dGVzMzIgaGlnaDsKICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShpbmRleFt5ZWFyXSk7CiAgICAgICAgaWYgKHdlZWsgPCBsb3cgfHwgd2VlayA+IGhpZ2gpIHsKICAgICAgICAgICAgaWYgKHdlZWsgPCBsb3cgfHwgbG93ID09IDApIHsKICAgICAgICAgICAgICAgIGxvdyA9IHdlZWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdlZWsgPiBoaWdoKSB7CiAgICAgICAgICAgICAgICBoaWdoID0gd2VlazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbmRleFt5ZWFyXSA9IHRvVmFsdWUobG93LCBoaWdoKTsKICAgICAgICB9CgogICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKGluZGV4W3dlZWtdKTsKICAgICAgICBieXRlczMyIGhvdXIgPSB0b0tleSh0aW1lc3RhbXAsIDEgaG91cnMpOwogICAgICAgIGlmIChob3VyIDwgbG93IHx8IGhvdXIgPiBoaWdoKSB7CiAgICAgICAgICAgIGlmIChob3VyIDwgbG93IHx8IGxvdyA9PSAwKSB7CiAgICAgICAgICAgICAgICBsb3cgPSBob3VyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChob3VyID4gaGlnaCkgewogICAgICAgICAgICAgICAgaGlnaCA9IGhvdXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5kZXhbd2Vla10gPSB0b1ZhbHVlKGxvdywgaGlnaCk7CiAgICAgICAgfQoKICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShpbmRleFtob3VyXSk7CiAgICAgICAgYnl0ZXMzMiBtaW51dGUgPSB0b0tleSh0aW1lc3RhbXAsIDEgbWludXRlcyk7CiAgICAgICAgaWYgKG1pbnV0ZSA8IGxvdyB8fCBtaW51dGUgPiBoaWdoKSB7CiAgICAgICAgICAgIGlmIChtaW51dGUgPCBsb3cgfHwgbG93ID09IDApIHsKICAgICAgICAgICAgICAgIGxvdyA9IG1pbnV0ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobWludXRlID4gaGlnaCkgewogICAgICAgICAgICAgICAgaGlnaCA9IG1pbnV0ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbmRleFtob3VyXSA9IHRvVmFsdWUobG93LCBoaWdoKTsKICAgICAgICB9CgogICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKGluZGV4W21pbnV0ZV0pOwogICAgICAgIGJ5dGVzMzIgdHNLZXkgPSB0b0tleSh0aW1lc3RhbXApOwogICAgICAgIGlmICh0c0tleSA8IGxvdyB8fCB0c0tleSA+IGhpZ2gpIHsKICAgICAgICAgICAgaWYgKHRzS2V5IDwgbG93IHx8IGxvdyA9PSAwKSB7CiAgICAgICAgICAgICAgICBsb3cgPSB0c0tleTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHNLZXkgPiBoaWdoKSB7CiAgICAgICAgICAgICAgICBoaWdoID0gdHNLZXk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5kZXhbbWludXRlXSA9IHRvVmFsdWUobG93LCBoaWdoKTsKICAgICAgICB9CgogICAgICAgIGluZGV4W3RzS2V5XSA9IF9rZXk7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEZsb29yS2V5WWVhcih1aW50IF90aW1lc3RhbXAsIGJ5dGVzMzIgX2xvdywgYnl0ZXMzMiBfaGlnaCkgdmlldyBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiB5ZWFyID0gdG9LZXkoX3RpbWVzdGFtcCwgWUVBUik7CiAgICAgICAgaWYgKHllYXIgPCBfbG93KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBpZiAoeWVhciA+IF9oaWdoKSB7CiAgICAgICAgICAgIC8vIHdlZWsKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoaW5kZXhbX2hpZ2hdKTsKICAgICAgICAgICAgLy8gaG91cgogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShpbmRleFtoaWdoXSk7CiAgICAgICAgICAgIC8vIG1pbnV0ZQogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShpbmRleFtoaWdoXSk7CiAgICAgICAgICAgIC8vIHRzCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKGluZGV4W2hpZ2hdKTsKICAgICAgICAgICAgcmV0dXJuIGluZGV4W2hpZ2hdOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBsb3c7CiAgICAgICAgYnl0ZXMzMiBoaWdoOwoKICAgICAgICB3aGlsZSAoeWVhciA+PSBfbG93KSB7CiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKGluZGV4W3llYXJdKTsKICAgICAgICAgICAgaWYgKGxvdyAhPSAwKSB7CiAgICAgICAgICAgICAgICBieXRlczMyIGtleSA9IGZpbmRGbG9vcktleVdlZWsoX3RpbWVzdGFtcCwgbG93LCBoaWdoKTsKICAgICAgICAgICAgICAgIGlmIChrZXkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gMHgxREZFMjAwID0gNTIgd2Vla3MgPSAzMTQ0OTYwMAogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICB5ZWFyIDo9IHN1Yih5ZWFyLCAweDFERkUyMDApCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRGbG9vcktleVdlZWsodWludCBfdGltZXN0YW1wLCBieXRlczMyIF9sb3csIGJ5dGVzMzIgX2hpZ2gpIHZpZXcgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIGJ5dGVzMzIgd2VlayA9IHRvS2V5KF90aW1lc3RhbXAsIDEgd2Vla3MpOwogICAgICAgIGlmICh3ZWVrIDwgX2xvdykgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGJ5dGVzMzIgbG93OwogICAgICAgIGJ5dGVzMzIgaGlnaDsKCiAgICAgICAgaWYgKHdlZWsgPiBfaGlnaCkgewogICAgICAgICAgICAvLyBob3VyCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKGluZGV4W19oaWdoXSk7CiAgICAgICAgICAgIC8vIG1pbnV0ZQogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShpbmRleFtoaWdoXSk7CiAgICAgICAgICAgIC8vIHRzCiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKGluZGV4W2hpZ2hdKTsKICAgICAgICAgICAgcmV0dXJuIGluZGV4W2hpZ2hdOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHdlZWsgPj0gX2xvdykgewogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShpbmRleFt3ZWVrXSk7CiAgICAgICAgICAgIGlmIChsb3cgIT0gMCkgewogICAgICAgICAgICAgICAgYnl0ZXMzMiBrZXkgPSBmaW5kRmxvb3JLZXlIb3VyKF90aW1lc3RhbXAsIGxvdywgaGlnaCk7CiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxIHdlZWtzID0gNjA0ODAwCiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIHdlZWsgOj0gc3ViKHdlZWssIDYwNDgwMCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KCgogICAgZnVuY3Rpb24gZmluZEZsb29yS2V5SG91cih1aW50IF90aW1lc3RhbXAsIGJ5dGVzMzIgX2xvdywgYnl0ZXMzMiBfaGlnaCkgdmlldyBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiBob3VyID0gdG9LZXkoX3RpbWVzdGFtcCwgMSBob3Vycyk7CiAgICAgICAgaWYgKGhvdXIgPCBfbG93KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBsb3c7CiAgICAgICAgYnl0ZXMzMiBoaWdoOwoKICAgICAgICBpZiAoaG91ciA+IF9oaWdoKSB7CiAgICAgICAgICAgIC8vIG1pbnV0ZQogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShpbmRleFtfaGlnaF0pOwogICAgICAgICAgICAvLyB0cwogICAgICAgICAgICAobG93LCBoaWdoKSA9IGZyb21WYWx1ZShpbmRleFtoaWdoXSk7CiAgICAgICAgICAgIHJldHVybiBpbmRleFtoaWdoXTsKICAgICAgICB9CgogICAgICAgIHdoaWxlIChob3VyID49IF9sb3cpIHsKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoaW5kZXhbaG91cl0pOwogICAgICAgICAgICBpZiAobG93ICE9IDApIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIga2V5ID0gZmluZEZsb29yS2V5TWludXRlKF90aW1lc3RhbXAsIGxvdywgaGlnaCk7CiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxIGhvdXJzID0gMzYwMAogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBob3VyIDo9IHN1Yihob3VyLCAzNjAwKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRGbG9vcktleU1pbnV0ZSh1aW50IF90aW1lc3RhbXAsIGJ5dGVzMzIgX2xvdywgYnl0ZXMzMiBfaGlnaCkgdmlldyBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiBtaW51dGUgPSB0b0tleShfdGltZXN0YW1wLCAxIG1pbnV0ZXMpOwogICAgICAgIGlmIChtaW51dGUgPCBfbG93KSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBsb3c7CiAgICAgICAgYnl0ZXMzMiBoaWdoOwoKICAgICAgICBpZiAobWludXRlID4gX2hpZ2gpIHsKICAgICAgICAgICAgLy8gdHMKICAgICAgICAgICAgKGxvdywgaGlnaCkgPSBmcm9tVmFsdWUoaW5kZXhbX2hpZ2hdKTsKICAgICAgICAgICAgcmV0dXJuIGluZGV4W2hpZ2hdOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKG1pbnV0ZSA+PSBfbG93KSB7CiAgICAgICAgICAgIChsb3csIGhpZ2gpID0gZnJvbVZhbHVlKGluZGV4W21pbnV0ZV0pOwogICAgICAgICAgICBpZiAobG93ICE9IDApIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIga2V5ID0gZmluZEZsb29yS2V5VGltZXN0YW1wKF90aW1lc3RhbXAsIGxvdywgaGlnaCk7CiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAxIG1pbnV0ZXMgPSA2MAogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBtaW51dGUgOj0gc3ViKG1pbnV0ZSwgNjApCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRGbG9vcktleVRpbWVzdGFtcCh1aW50IF90aW1lc3RhbXAsIGJ5dGVzMzIgX2xvdywgYnl0ZXMzMiBfaGlnaCkgdmlldyBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgYnl0ZXMzMiB0c0tleSA9IHRvS2V5KF90aW1lc3RhbXApOwogICAgICAgIGlmICh0c0tleSA8IF9sb3cpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGlmICh0c0tleSA+IF9oaWdoKSB7CiAgICAgICAgICAgIHJldHVybiBpbmRleFtfaGlnaF07CiAgICAgICAgfQoKICAgICAgICB3aGlsZSAodHNLZXkgPj0gX2xvdykgewogICAgICAgICAgICBieXRlczMyIGtleSA9IGluZGV4W3RzS2V5XTsKICAgICAgICAgICAgaWYgKGtleSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIHRzS2V5IDo9IHN1Yih0c0tleSwgMSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kRmxvb3JLZXkodWludCBfdGltZXN0YW1wKSB2aWV3IHB1YmxpYyByZXR1cm5zIChieXRlczMyKSB7Ci8vICAgICAgICByZXF1aXJlKF90aW1lc3RhbXAgPiAweGZmZmZmZmZmKTsKLy8gICAgICAgIGlmIChfdGltZXN0YW1wIDwgMTUxNTYxMjQxNSkgewovLyAgICAgICAgICAgIHJldHVybiAwOwovLyAgICAgICAgfQoKICAgICAgICBieXRlczMyIHllYXJMb3c7CiAgICAgICAgYnl0ZXMzMiB5ZWFySGlnaDsKICAgICAgICAoeWVhckxvdywgeWVhckhpZ2gpID0gZnJvbVZhbHVlKGhlYWQpOwoKICAgICAgICByZXR1cm4gZmluZEZsb29yS2V5WWVhcihfdGltZXN0YW1wLCB5ZWFyTG93LCB5ZWFySGlnaCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9LZXkodWludCBfdGltZXN0YW1wLCB1aW50IHJvdW5kZXIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpIHsKICAgICAgICAvLyAweDAuLi4wMDAwMDAwMDAwMDAwMDAwMAogICAgICAgIC8vICAgICAgICBeXl5eXl5eXiAtIHJvdW5kZXIgbWFya2VyIChlZywgdG8gYXZvaWQgY3Jvc3NpbmcgZmlyc3QgZGF5IG9mIHllYXIgd2l0aCB5ZWFyKQogICAgICAgIC8vICAgICAgICAgICAgICAgIF5eXl5eXl5eIC0gcm91bmRlZCBtb21lbnQgKHllYXIsIHdlZWssIGV0YykKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihtdWwocm91bmRlciwgMHgxMDAwMDAwMDApLCBtdWwoZGl2KF90aW1lc3RhbXAsIHJvdW5kZXIpLCByb3VuZGVyKSkKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdG9WYWx1ZShieXRlczMyIF9sb3dLZXksIGJ5dGVzMzIgX2hpZ2hLZXkpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpIHsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBvcihtdWwoX2xvd0tleSwgMHgxMDAwMDAwMDAwMDAwMDAwMCksIF9oaWdoS2V5KQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBmcm9tVmFsdWUoYnl0ZXMzMiBfdmFsdWUpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBfbG93S2V5LCBieXRlczMyIF9oaWdoS2V5KSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBfbG93S2V5IDo9IGFuZChkaXYoX3ZhbHVlLCAweDEwMDAwMDAwMDAwMDAwMDAwKSwgMHhmZmZmZmZmZmZmZmZmZmZmKQogICAgICAgICAgICBfaGlnaEtleSA6PSBhbmQoX3ZhbHVlLCAweGZmZmZmZmZmZmZmZmZmZmYpCiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiB0b0tleSh1aW50IHRpbWVzdGFtcCkgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKSB7CiAgICAgICAgcmV0dXJuIGJ5dGVzMzIodGltZXN0YW1wKTsKICAgIH0KfQoKCmNvbnRyYWN0IEpvdWxlQ29udHJhY3RIb2xkZXIgaXMgdXNpbmdDb25zdHMgewogICAgdXNpbmcgS2V5c1V0aWxzIGZvciBieXRlczMyOwovLyAgICBldmVudCBGb3VuZCh1aW50IHRpbWVzdGFtcCk7CiAgICB1aW50IGludGVybmFsIGxlbmd0aDsKICAgIGJ5dGVzMzIgaGVhZDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYnl0ZXMzMikgb2JqZWN0czsKICAgIEpvdWxlSW5kZXggaW5kZXg7CgogICAgZnVuY3Rpb24gSm91bGVDb250cmFjdEhvbGRlcigpIHB1YmxpYyB7CiAgICAgICAgaW5kZXggPSBuZXcgSm91bGVJbmRleCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGluc2VydChhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgaW50ZXJuYWwgewogICAgICAgIGxlbmd0aCArKzsKICAgICAgICBieXRlczMyIGlkID0gS2V5c1V0aWxzLnRvS2V5KF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICAgICAgaWYgKGhlYWQgPT0gMCkgewogICAgICAgICAgICBoZWFkID0gaWQ7CiAgICAgICAgICAgIGluZGV4Lmluc2VydChpZCk7Ci8vICAgICAgICAgICAgRm91bmQoMHhmZmZmZmZmZik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYnl0ZXMzMiBwcmV2aW91cyA9IGluZGV4LmZpbmRGbG9vcktleShfdGltZXN0YW1wKTsKCiAgICAgICAgLy8gcmVqZWN0IGR1cGxpY2F0ZSBrZXkgb24gdGhlIGVuZAogICAgICAgIHJlcXVpcmUocHJldmlvdXMgIT0gaWQpOwogICAgICAgIC8vIHJlamVjdCBkdXBsaWNhdGUgaW4gdGhlIG1pZGRsZQogICAgICAgIHJlcXVpcmUob2JqZWN0c1tpZF0gPT0gMCk7CgogICAgICAgIHVpbnQgcHJldlRpbWVzdGFtcCA9IHByZXZpb3VzLmdldFRpbWVzdGFtcCgpOwovLyAgICAgICAgRm91bmQocHJldlRpbWVzdGFtcCk7CiAgICAgICAgdWludCBoZWFkVGltZXN0YW1wID0gaGVhZC5nZXRUaW1lc3RhbXAoKTsKICAgICAgICAvLyBhZGQgYXMgaGVhZCwgcHJldlRpbWVzdGFtcCA9PSAwIG9yIGluIHRoZSBwYXN0CiAgICAgICAgaWYgKHByZXZUaW1lc3RhbXAgPCBoZWFkVGltZXN0YW1wKSB7CiAgICAgICAgICAgIG9iamVjdHNbaWRdID0gaGVhZDsKICAgICAgICAgICAgaGVhZCA9IGlkOwogICAgICAgIH0KICAgICAgICAvLyBhZGQgYWZ0ZXIgdGhlIHByZXZpb3VzCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG9iamVjdHNbaWRdID0gb2JqZWN0c1twcmV2aW91c107CiAgICAgICAgICAgIG9iamVjdHNbcHJldmlvdXNdID0gaWQ7CiAgICAgICAgfQogICAgICAgIGluZGV4Lmluc2VydChpZCk7CiAgICB9CgogICAgZnVuY3Rpb24gbmV4dCgpIGludGVybmFsIHJldHVybnMgKEtleXNVdGlscy5PYmplY3QgbWVtb3J5IF9uZXh0KSB7CiAgICAgICAgaGVhZCA9IG9iamVjdHNbaGVhZF07CiAgICAgICAgbGVuZ3RoLS07CiAgICAgICAgX25leHQgPSBoZWFkLnRvT2JqZWN0KCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q291bnQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb3AodWludCBfY291bnQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzc1tdIF9hZGRyZXNzZXMsCiAgICAgICAgdWludFtdIF90aW1lc3RhbXBzLAogICAgICAgIHVpbnRbXSBfZ2FzTGltaXRzLAogICAgICAgIHVpbnRbXSBfZ2FzUHJpY2VzCiAgICApIHsKICAgICAgICB1aW50IGFtb3VudCA9IF9jb3VudCA8PSBsZW5ndGggPyBfY291bnQgOiBsZW5ndGg7CgogICAgICAgIF9hZGRyZXNzZXMgPSBuZXcgYWRkcmVzc1tdKGFtb3VudCk7CiAgICAgICAgX3RpbWVzdGFtcHMgPSBuZXcgdWludFtdKGFtb3VudCk7CiAgICAgICAgX2dhc0xpbWl0cyA9IG5ldyB1aW50W10oYW1vdW50KTsKICAgICAgICBfZ2FzUHJpY2VzID0gbmV3IHVpbnRbXShhbW91bnQpOwoKICAgICAgICBieXRlczMyIGN1cnJlbnQgPSBoZWFkOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFtb3VudDsgaSArKykgewogICAgICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBvYmogPSBjdXJyZW50LnRvT2JqZWN0KCk7CiAgICAgICAgICAgIF9hZGRyZXNzZXNbaV0gPSBvYmouY29udHJhY3RBZGRyZXNzOwogICAgICAgICAgICBfdGltZXN0YW1wc1tpXSA9IG9iai50aW1lc3RhbXA7CiAgICAgICAgICAgIF9nYXNMaW1pdHNbaV0gPSBvYmouZ2FzTGltaXQ7CiAgICAgICAgICAgIF9nYXNQcmljZXNbaV0gPSBvYmouZ2FzUHJpY2VHd2VpICogR1dFSTsKICAgICAgICAgICAgY3VycmVudCA9IG9iamVjdHNbY3VycmVudF07CiAgICAgICAgfQogICAgICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb3AoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3MgY29udHJhY3RBZGRyZXNzLAogICAgICAgIHVpbnQgdGltZXN0YW1wLAogICAgICAgIHVpbnQgZ2FzTGltaXQsCiAgICAgICAgdWludCBnYXNQcmljZQogICAgKSB7CiAgICAgICAgS2V5c1V0aWxzLk9iamVjdCBtZW1vcnkgb2JqID0gaGVhZC50b09iamVjdCgpOwoKICAgICAgICBjb250cmFjdEFkZHJlc3MgPSBvYmouY29udHJhY3RBZGRyZXNzOwogICAgICAgIHRpbWVzdGFtcCA9IG9iai50aW1lc3RhbXA7CiAgICAgICAgZ2FzTGltaXQgPSBvYmouZ2FzTGltaXQ7CiAgICAgICAgZ2FzUHJpY2UgPSBvYmouZ2FzUHJpY2VHd2VpICogR1dFSTsKICAgIH0KICAgIAogICAgICAgIGZ1bmN0aW9uIGdldE5leHQoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICB1aW50IF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc0xpbWl0LAogICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgdWludCB0aW1lc3RhbXAsCiAgICAgICAgdWludCBnYXNMaW1pdCwKICAgICAgICB1aW50IGdhc1ByaWNlCiAgICApIHsKICAgICAgICBpZiAoX3RpbWVzdGFtcCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRvcCgpOwogICAgICAgIH0KCiAgICAgICAgYnl0ZXMzMiBwcmV2ID0gS2V5c1V0aWxzLnRvS2V5KF9jb250cmFjdEFkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlIC8gR1dFSSk7CiAgICAgICAgYnl0ZXMzMiBjdXJyZW50ID0gb2JqZWN0c1twcmV2XTsKICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBvYmogPSBjdXJyZW50LnRvT2JqZWN0KCk7CgogICAgICAgIGNvbnRyYWN0QWRkcmVzcyA9IG9iai5jb250cmFjdEFkZHJlc3M7CiAgICAgICAgdGltZXN0YW1wID0gb2JqLnRpbWVzdGFtcDsKICAgICAgICBnYXNMaW1pdCA9IG9iai5nYXNMaW1pdDsKICAgICAgICBnYXNQcmljZSA9IG9iai5nYXNQcmljZUd3ZWkgKiBHV0VJOwogICAgfQoKfQoKCmNvbnRyYWN0IEpvdWxlIGlzIEpvdWxlQVBJLCBKb3VsZUNvbnRyYWN0SG9sZGVyIHsKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX3RpbWVzdGFtcCwgdWludCBfZ2FzTGltaXQsIHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHByaWNlID0gdGhpcy5nZXRQcmljZShfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcHJpY2UpOwoKICAgICAgICByZXF1aXJlKF90aW1lc3RhbXAgPiBub3cpOwogICAgICAgIHJlcXVpcmUoX3RpbWVzdGFtcCA8IDB4MTAwMDAwMDAwKTsKICAgICAgICByZXF1aXJlKF9nYXNMaW1pdCA8IE1BWF9HQVMpOwogICAgICAgIC8vIGZyb20gMSBnd2VpIHRvIDB4MTAwMDAwMDAwIGd3ZWkKICAgICAgICByZXF1aXJlKF9nYXNQcmljZSA+IEdXRUkpOwogICAgICAgIHJlcXVpcmUoX2dhc1ByaWNlIDwgMHgxMDAwMDAwMDAgKiBHV0VJKTsKCiAgICAgICAgaW5zZXJ0KF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSAvIEdXRUkpOwoKICAgICAgICBSZWdpc3RlcmVkKF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CgogICAgICAgIGlmIChtc2cudmFsdWUgPiBwcmljZSkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSAtIHByaWNlKTsKICAgICAgICAgICAgcmV0dXJuIG1zZy52YWx1ZSAtIHByaWNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQcmljZSh1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoX2dhc0xpbWl0IDwgNDMwMDAwMCk7CiAgICAgICAgcmVxdWlyZShfZ2FzUHJpY2UgPiBHV0VJKTsKICAgICAgICByZXF1aXJlKF9nYXNQcmljZSA8IDB4MTAwMDAwMDAwICogR1dFSSk7CgogICAgICAgIHJldHVybiBnZXRQcmljZUlubmVyKF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQcmljZUlubmVyKHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIChfZ2FzTGltaXQgKyBJRExFX0dBUykgKiBfZ2FzUHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlKCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gaW5uZXJJbnZva2UoaW52b2tlQ2FsbGJhY2spOwogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZVRvcCgpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGlubmVySW52b2tlVG9wKGludm9rZUNhbGxiYWNrKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRWZXJzaW9uKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChieXRlczgpIHsKICAgICAgICByZXR1cm4gVkVSU0lPTjsKICAgIH0KCiAgICBmdW5jdGlvbiBpbm5lckludm9rZShmdW5jdGlvbiAoYWRkcmVzcywgdWludCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgX2NhbGxiYWNrKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9hbW91bnQpIHsKICAgICAgICBLZXlzVXRpbHMuT2JqZWN0IG1lbW9yeSBjdXJyZW50ID0gS2V5c1V0aWxzLnRvT2JqZWN0KGhlYWQpOwoKICAgICAgICB1aW50IGFtb3VudDsKICAgICAgICB3aGlsZSAoY3VycmVudC50aW1lc3RhbXAgIT0gMCAmJiBjdXJyZW50LnRpbWVzdGFtcCA8IG5vdyAmJiBtc2cuZ2FzID49IGN1cnJlbnQuZ2FzTGltaXQpIHsKICAgICAgICAgICAgdWludCBnYXMgPSBtc2cuZ2FzOwogICAgICAgICAgICBib29sIHN0YXR1cyA9IF9jYWxsYmFjayhjdXJyZW50LmNvbnRyYWN0QWRkcmVzcywgY3VycmVudC5nYXNMaW1pdCk7Ci8vICAgICAgICAgICAgY3VycmVudC5jb250cmFjdEFkZHJlc3MuY2FsbC5nYXMoY3VycmVudC5nYXNMaW1pdCkoMHg5MTk4NDBhZCk7CiAgICAgICAgICAgIGdhcyAtPSBtc2cuZ2FzOwogICAgICAgICAgICBJbnZva2VkKGN1cnJlbnQuY29udHJhY3RBZGRyZXNzLCBzdGF0dXMsIGdhcyk7CgogICAgICAgICAgICBhbW91bnQgKz0gZ2V0UHJpY2VJbm5lcihjdXJyZW50Lmdhc0xpbWl0LCBjdXJyZW50Lmdhc1ByaWNlR3dlaSAqIEdXRUkpOwogICAgICAgICAgICBjdXJyZW50ID0gbmV4dCgpOwogICAgICAgIH0KICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gaW5uZXJJbnZva2VUb3AoZnVuY3Rpb24gKGFkZHJlc3MsIHVpbnQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIF9jYWxsYmFjaykgaW50ZXJuYWwgcmV0dXJucyAodWludCBfYW1vdW50KSB7CiAgICAgICAgS2V5c1V0aWxzLk9iamVjdCBtZW1vcnkgY3VycmVudCA9IEtleXNVdGlscy50b09iamVjdChoZWFkKTsKICAgICAgICB1aW50IGdhcyA9IG1zZy5nYXM7CiAgICAgICAgYm9vbCBzdGF0dXMgPSBfY2FsbGJhY2soY3VycmVudC5jb250cmFjdEFkZHJlc3MsIGN1cnJlbnQuZ2FzTGltaXQpOwogICAgICAgIGdhcyAtPSBtc2cuZ2FzOwoKICAgICAgICBJbnZva2VkKGN1cnJlbnQuY29udHJhY3RBZGRyZXNzLCBzdGF0dXMsIGdhcyk7CgogICAgICAgIHVpbnQgYW1vdW50ID0gZ2V0UHJpY2VJbm5lcihjdXJyZW50Lmdhc0xpbWl0LCBjdXJyZW50Lmdhc1ByaWNlR3dlaSAqIEdXRUkpOwoKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGludm9rZUNhbGxiYWNrKGFkZHJlc3MgX2NvbnRyYWN0LCB1aW50IF9nYXMpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gX2NvbnRyYWN0LmNhbGwuZ2FzKF9nYXMpKDB4OTE5ODQwYWQpOwogICAgfQoKfQoKCmNvbnRyYWN0IEpvdWxlQmVoaW5kUHJveHkgaXMgSm91bGUsIE93bmFibGUsIFRyYW5zZmVyVG9rZW4gewogICAgYWRkcmVzcyBwdWJsaWMgcHJveHk7CgogICAgZnVuY3Rpb24gc2V0UHJveHkoYWRkcmVzcyBfcHJveHkpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHByb3h5ID0gX3Byb3h5OwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlQcm94eSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcHJveHkpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlKCkgcHVibGljIG9ubHlQcm94eSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLmludm9rZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZVRvcCgpIHB1YmxpYyBvbmx5UHJveHkgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzdXBlci5pbnZva2VUb3AoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2VDYWxsYmFjayhhZGRyZXNzIF9jb250cmFjdCwgdWludCBfZ2FzKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHByb3h5LmNhbGwuZ2FzKF9nYXMpKDB4NzMwMjdmNmQsIF9jb250cmFjdCk7CiAgICB9Cn0KCmNvbnRyYWN0IEpvdWxlUHJveHkgaXMgSm91bGVQcm94eUFQSSwgSm91bGVBUEksIE93bmFibGUsIFRyYW5zZmVyVG9rZW4gewogICAgSm91bGVCZWhpbmRQcm94eSBwdWJsaWMgam91bGU7CgogICAgZnVuY3Rpb24gc2V0Sm91bGUoSm91bGVCZWhpbmRQcm94eSBfam91bGUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGpvdWxlID0gX2pvdWxlOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlKb3VsZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhqb3VsZSkpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgb25seUpvdWxlIHsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDb3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gam91bGUuZ2V0Q291bnQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlcihhZGRyZXNzIF9hZGRyZXNzLCB1aW50IF90aW1lc3RhbXAsIHVpbnQgX2dhc0xpbWl0LCB1aW50IF9nYXNQcmljZSkgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBjaGFuZ2UgPSBqb3VsZS5yZWdpc3Rlci52YWx1ZShtc2cudmFsdWUpKF9hZGRyZXNzLCBfdGltZXN0YW1wLCBfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICAgICAgaWYgKGNoYW5nZSA+IDApIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihjaGFuZ2UpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hhbmdlOwogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZSgpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBhbW91bnQgPSBqb3VsZS5pbnZva2UoKTsKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlVG9wKCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGFtb3VudCA9IGpvdWxlLmludm9rZVRvcCgpOwogICAgICAgIGlmIChhbW91bnQgPiAwKSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYW1vdW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQcmljZSh1aW50IF9nYXNMaW1pdCwgdWludCBfZ2FzUHJpY2UpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBqb3VsZS5nZXRQcmljZShfZ2FzTGltaXQsIF9nYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9wKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICBhZGRyZXNzIGNvbnRyYWN0QWRkcmVzcywKICAgICAgICB1aW50IHRpbWVzdGFtcCwKICAgICAgICB1aW50IGdhc0xpbWl0LAogICAgICAgIHVpbnQgZ2FzUHJpY2UKICAgICkgewogICAgICAgIChjb250cmFjdEFkZHJlc3MsIHRpbWVzdGFtcCwgZ2FzTGltaXQsIGdhc1ByaWNlKSA9IGpvdWxlLmdldFRvcCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE5leHQoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICB1aW50IF90aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgIHVpbnQgX2dhc0xpbWl0LAogICAgICAgICAgICAgICAgICAgICB1aW50IF9nYXNQcmljZSkgcHVibGljIHZpZXcgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyBjb250cmFjdEFkZHJlc3MsCiAgICAgICAgdWludCB0aW1lc3RhbXAsCiAgICAgICAgdWludCBnYXNMaW1pdCwKICAgICAgICB1aW50IGdhc1ByaWNlCiAgICApIHsKICAgICAgICAoY29udHJhY3RBZGRyZXNzLCB0aW1lc3RhbXAsIGdhc0xpbWl0LCBnYXNQcmljZSkgPSBqb3VsZS5nZXROZXh0KF9jb250cmFjdEFkZHJlc3MsIF90aW1lc3RhbXAsIF9nYXNMaW1pdCwgX2dhc1ByaWNlKTsKICAgIH0KCgoKICAgIGZ1bmN0aW9uIGdldFRvcCh1aW50IF9jb3VudCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICBhZGRyZXNzW10gX2FkZHJlc3NlcywKICAgICAgICB1aW50W10gX3RpbWVzdGFtcHMsCiAgICAgICAgdWludFtdIF9nYXNMaW1pdHMsCiAgICAgICAgdWludFtdIF9nYXNQcmljZXMKICAgICkgewogICAgICAgIHVpbnQgbGVuZ3RoID0gam91bGUuZ2V0Q291bnQoKTsKICAgICAgICB1aW50IGFtb3VudCA9IF9jb3VudCA8PSBsZW5ndGggPyBfY291bnQgOiBsZW5ndGg7CgogICAgICAgIF9hZGRyZXNzZXMgPSBuZXcgYWRkcmVzc1tdKGFtb3VudCk7CiAgICAgICAgX3RpbWVzdGFtcHMgPSBuZXcgdWludFtdKGFtb3VudCk7CiAgICAgICAgX2dhc0xpbWl0cyA9IG5ldyB1aW50W10oYW1vdW50KTsKICAgICAgICBfZ2FzUHJpY2VzID0gbmV3IHVpbnRbXShhbW91bnQpOwoKICAgICAgICBhZGRyZXNzIGNvbnRyYWN0QWRkcmVzczsKICAgICAgICB1aW50IHRpbWVzdGFtcDsKICAgICAgICB1aW50IGdhc0xpbWl0OwogICAgICAgIHVpbnQgZ2FzUHJpY2U7CgogICAgICAgIChjb250cmFjdEFkZHJlc3MsIHRpbWVzdGFtcCwgZ2FzTGltaXQsIGdhc1ByaWNlKSA9IGpvdWxlLmdldFRvcCgpOwogICAgICAgIF9hZGRyZXNzZXNbMF0gPSBjb250cmFjdEFkZHJlc3M7CiAgICAgICAgX3RpbWVzdGFtcHNbMF0gPSB0aW1lc3RhbXA7CiAgICAgICAgX2dhc0xpbWl0c1swXSA9IGdhc0xpbWl0OwogICAgICAgIF9nYXNQcmljZXNbMF0gPSBnYXNQcmljZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgYW1vdW50OyBpICsrKSB7CiAgICAgICAgICAgIChjb250cmFjdEFkZHJlc3MsIHRpbWVzdGFtcCwgZ2FzTGltaXQsIGdhc1ByaWNlKSA9IGpvdWxlLmdldE5leHQoY29udHJhY3RBZGRyZXNzLCB0aW1lc3RhbXAsIGdhc0xpbWl0LCBnYXNQcmljZSk7CiAgICAgICAgICAgIF9hZGRyZXNzZXNbaV0gPSBjb250cmFjdEFkZHJlc3M7CiAgICAgICAgICAgIF90aW1lc3RhbXBzW2ldID0gdGltZXN0YW1wOwogICAgICAgICAgICBfZ2FzTGltaXRzW2ldID0gZ2FzTGltaXQ7CiAgICAgICAgICAgIF9nYXNQcmljZXNbaV0gPSBnYXNQcmljZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VmVyc2lvbigpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYnl0ZXM4KSB7CiAgICAgICAgcmV0dXJuIGpvdWxlLmdldFZlcnNpb24oKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxsYmFjayhhZGRyZXNzIF9jb250cmFjdCkgcHVibGljIG9ubHlKb3VsZSB7CiAgICAgICAgQ2hlY2thYmxlQ29udHJhY3QoX2NvbnRyYWN0KS5jaGVjaygpOwogICAgfQp9'.
	

]
