Class {
	#name : #SRT2ea7ae77369654e4afe84ef3733fccd8e159e1fe,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2ea7ae77369654e4afe84ef3733fccd8e159e1fe >> base64 [
	^ 'Ly8gVkVSU0lPTiBNKEEpCgpwcmFnbWEgc29saWRpdHkgXjAuNC44OwoKCi8vCi8vIEZPUiBSRUZFUkVOQ0UgLSBJTkNMVURFICBpRTRSb3dFc2Nyb3cgIChpbnRlcmZhY2UpIENPTlRSQUNUIGF0IHRoZSB0b3AgLi4uLi4KLy8KCmNvbnRyYWN0IGlFNFJvd0VzY3JvdyB7CglmdW5jdGlvbiBnZXROdW1HYW1lc1N0YXJ0ZWQoKSBjb25zdGFudCByZXR1cm5zIChpbnQgbmdhbWVzKTsKfQoKLy8gQWJzdHJhY3QgY29udHJhY3QgZm9yIHRoZSBmdWxsIEVSQyAyMCBUb2tlbiBzdGFuZGFyZAovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBBQlNUUkFDVCBzdGFuZGFyZCB0b2tlbiBjbGFzcwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29udHJhY3QgVG9rZW4geyAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gIEU0Um93UmV3YXJkcyAtIGFic3RyYWN0IGU0IGRpdmlkZW5kIGNvbnRyYWN0Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEU0Um93UmV3YXJkcwp7CglmdW5jdGlvbiBjaGVja0RpdmlkZW5kcyhhZGRyZXNzIF9hZGRyKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2Ftb3VudCk7CglmdW5jdGlvbiB3aXRoZHJhd0RpdmlkZW5kcygpIHB1YmxpYyByZXR1cm5zICh1aW50IG5hbW91bnQpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgRmlubmV5IENoaXAgLSB0b2tlbiBjb250cmFjdAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb250cmFjdCBFNFRva2VuIGlzIFRva2VuLCBFNFJvd1Jld2FyZHMgewogICAgCWV2ZW50IFN0YXRFdmVudChzdHJpbmcgbXNnKTsKICAgIAlldmVudCBTdGF0RXZlbnRJKHN0cmluZyBtc2csIHVpbnQgdmFsKTsKCgllbnVtIFNldHRpbmdTdGF0ZVZhbHVlICB7ZGVidWcsIHJlbGVhc2UsIGxvY2tlZFJlbGVhc2V9CgllbnVtIEljb1N0YXR1c1ZhbHVlIHthbm91bmNlbWVudCwgc2FsZU9wZW4sIHNhbGVDbG9zZWQsIGZhaWxlZCwgc3VjY2VlZGVkfQoKCgoKCXN0cnVjdCB0b2tlbkFjY291bnQgewoJCWJvb2wgYWxsb2NlZDsgLy8gZmxhZyB0byBhc2NlcnQgcHJpb3IgYWxsb2NhdGlvbgoJCXVpbnQgdG9rZW5zOyAvLyBudW0gdG9rZW5zCgkJdWludCBiYWxhbmNlOyAvLyByZXdhcmRzIGJhbGFuY2UKCX0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gIGRhdGEgc3RvcmFnZQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglhZGRyZXNzIGRldmVsb3BlcnM7IC8vIGRldmVsb3BlcnMgdG9rZW4gaG9sZGluZyBhZGRyZXNzCglhZGRyZXNzIHB1YmxpYyBvd25lcjsgLy8gZGVwbG95ZXIgZXhlY3V0b3IKCWFkZHJlc3MgZm91bmRlck9yZzsgLy8gZm91bmRlciBvcmdpbmFpemF0aW9uIGNvbnRyYWN0CglhZGRyZXNzIGF1eFBhcnRuZXI7IC8vIGF1eCBwYXJ0bmVyIChwci9hdWRpdGluZykgLSAxIHBlcmNlbnQgdXBvbiBjbG9zZQoJYWRkcmVzcyBlNF9wYXJ0bmVyOyAvLyBlNHJvdyAgY29udHJhY3QgYWRkcmVzc2VzCgoKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdG9rZW5BY2NvdW50KSBob2xkZXJBY2NvdW50cyA7IC8vIHdobyBob2xkcyBob3cgbWFueSB0b2tlbnMgKGhpZ2ggdHdvIGJ5dGVzIGNvbnRhaW4gY3VyUGF5SWQpCgltYXBwaW5nICh1aW50ID0+IGFkZHJlc3MpIGhvbGRlckluZGV4ZXMgOyAvLyBmb3IgaXRlcmF0aW9uIHRocnUgaG9sZGVyCgl1aW50IG51bUFjY291bnRzOwoKCXVpbnQgcGFydG5lckNyZWRpdHM7IC8vIGFtb3VudCBwYXJ0bmVyIChlNHJvdykgIGhhcyBwYWlkCgltYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7IC8vIGFwcHJvdmFscwoKCgl1aW50IG1heE1pbnRhYmxlVG9rZW5zOyAvLyAuLi4KCXVpbnQgbWluSWNvVG9rZW5Hb2FsOy8vIHRva2VuIGdvYWwgYnkgc2FsZSBlbmQKCXVpbnQgbWluVXNhZ2VHb2FsOyAvLyAgbnVtIGdhbWVzIGdvYWwgYnkgdXNhZ2UgZGVhZGxpbmUKCXVpbnQgcHVibGljICB0b2tlblByaWNlOyAvLyBwcmljZSBwZXIgdG9rZW4KCXVpbnQgcHVibGljIHBheW91dFRocmVzaG9sZDsgLy8gdGhyZXNob2xkIHRpbGwgcGF5b3V0CgoJdWludCB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZDsgCS8vIHJ1bm5pbmcgdG90YWwgb2YgdG9rZW4gZnVuZHMgcmVjZWl2ZWQKCXVpbnQgcHVibGljIHRvdGFsVG9rZW5zTWludGVkOyAJLy8gdG90YWwgbnVtYmVyIG9mIHRva2VucyBtaW50ZWQKCXVpbnQgcHVibGljIGhvbGRvdmVyQmFsYW5jZTsgCQkvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQKCWludCBwdWJsaWMgcGF5b3V0QmFsYW5jZTsgCQkvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQKCWludCBwck9yaWdQYXlvdXRCYWw7CQkJLy8gb3JpZ2luYWwgcGF5b3V0IGJhbGFuY2UgYmVmb3JlIHJ1bgoJdWludCBwck9yaWdUb2tlbnNNaW50OyAJCQkvLyB0b2tlbnMgbWludGVkIGF0IHN0YXJ0IG9mIHBheSBydW4KCXVpbnQgcHVibGljIGN1clBheW91dElkOwkJLy8gY3VycmVudCBwYXlvdXQgaWQKCXVpbnQgcHVibGljIGxhc3RQYXlvdXRJbmRleDsJCS8vIHBheW91dCBpZHggYmV0d2VlbiBydW4gc2VnbWVudHMKCXVpbnQgcHVibGljIG1heFBheXNQZXI7CQkJLy8gbnVtIHBheXMgcGVyIHNlZ21lbnQKCXVpbnQgcHVibGljIG1pblBheUludGVydmFsOwkJLy8gbWluIGludGVydmFsIGJldHdlZW4gc3RhcnQgcGF5IHJ1bgoKCgl1aW50IGZ1bmRpbmdTdGFydDsgCQkvLyBmdW5kaW5nIHN0YXJ0IHRpbWUgaW1tZWRpYXRlbHkgYWZ0ZXIgYW5vdW5jZW1lbnQKCXVpbnQgZnVuZGluZ0RlYWRsaW5lOyAJCS8vIGZ1bmRpbmcgZW5kIHRpbWUKCXVpbnQgdXNhZ2VEZWFkbGluZTsgCQkvLyBkZWFkbGluZSB3aGVyZSBtaW5pbXVtIHVzYWdlIG5lZWRzIHRvIGJlIG1ldCBiZWZvcmUgY29uc2lkZXJlZCBzdWNjZXNzCgl1aW50IHB1YmxpYyBsYXN0UGF5b3V0VGltZTsgCS8vIHRpbWVzdGFtcCBvZiBsYXN0IHBheW91dCB0aW1lCgl1aW50IHZlc3RUaW1lOyAJCS8vIDEgeWVhciBwYXN0IHNhbGUgdmVzdCBkZXZlbG9wZXIgdG9rZW5zCgl1aW50IG51bURldlRva2VuczsgCS8vIDEwIHBlciBjZW50IG9mIHRva2VucyBhZnRlciBjbG9zZSB0byBkZXZlbG9wZXJzCglib29sIGRldmVsb3BlcnNHcmFudGVkOyAJCS8vIGZsYWcKCXVpbnQgcmVtdW5lcmF0aW9uU3RhZ2U7IAkvLyAwIGZvciBub3QgeWV0LCAxIGZvciAxMCBwZXJjZW50LCAyIGZvciByZW1haW5pbmcgIHVwb24gc3VjY2VlZGVkLgoJdWludCBwdWJsaWMgcmVtdW5lcmF0aW9uQmFsYW5jZTsgCS8vIHJlbXVuZXJhdGlvbiBiYWxhbmNlIHRvIHJlbGVhc2UgdG9rZW4gZnVuZHMKCXVpbnQgYXV4UGFydG5lckJhbGFuY2U7IAkvLyBhdXggcGFydG5lciBiYWxhbmNlIC0gMSBwZXJjZW50Cgl1aW50IHJtR2FzOyAvLyByZW11bmVyYXRpb24gZ2FzCgl1aW50IHJ3R2FzOyAvLyByZXdhcmQgZ2FzCgl1aW50IHJmR2FzOyAvLyByZWZ1bmQgZ2FzCgoJSWNvU3RhdHVzVmFsdWUgaWNvU3RhdHVzOyAgLy8gY3VycmVudCBzdGF0dXMgb2YgaWNvCglTZXR0aW5nU3RhdGVWYWx1ZSBwdWJsaWMgc2V0dGluZ3NTdGF0ZTsKCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGNvbnRyYWN0IGNvbnN0cnVjdG9yCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gRTRUb2tlbigpIAoJewoJCW93bmVyID0gbXNnLnNlbmRlcjsKCQlkZXZlbG9wZXJzID0gbXNnLnNlbmRlcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gdXNlIHRoaXMgdG8gcmVzZXQgZXZlcnl0aGluZywgd2lsbCBuZXZlciBiZSBjYWxsZWQgYWZ0ZXIgbG9ja1JlbGVhc2UKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBhcHBseVNldHRpbmdzKFNldHRpbmdTdGF0ZVZhbHVlIHFTdGF0ZSwgdWludCBfc2FsZVN0YXJ0LCB1aW50IF9zYWxlRW5kLCB1aW50IF91c2FnZUVuZCwgdWludCBfbWluVXNhZ2UsIHVpbnQgX3Rva0dvYWwsIHVpbnQgIF9tYXhNaW50YWJsZSwgdWludCBfdGhyZXNob2xkLCB1aW50IF9wcmljZSwgdWludCBfbXBwLCB1aW50IF9tcGkgKQoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyKSAKCQkJcmV0dXJuOwoKCQkvLyB0aGVzZSBzZXR0aW5ncyBhcmUgcGVybWFuZW50bHkgdHdlYWthYmxlIGZvciBwZXJmb3JtYW5jZSBhZGp1c3RtZW50cwoJCXBheW91dFRocmVzaG9sZCA9IF90aHJlc2hvbGQ7CgkJbWF4UGF5c1BlciA9IF9tcHA7CgkJbWluUGF5SW50ZXJ2YWwgPSBfbXBpOwoKCQkvLyB0aGlzIGZpcnN0IHRlc3QgY2hlY2tzIGlmIGFscmVhZHkgbG9ja2VkCgkJaWYgKHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJcmV0dXJuOwoKIAkgCXNldHRpbmdzU3RhdGUgPSBxU3RhdGU7CgoJCS8vIHRoaXMgc2Vjb25kIHRlc3QgYWxsb3dzIGxvY2tpbmcgd2l0aG91dCBjaGFuZ2luZyBvdGhlciBwZXJtYW5lbnQgc2V0dGluZ3MKCQkvLyBXQVJOSU5HLCBNQUtFIFNVUkUgWU9VUidSRSBIQVBQWSBXSVRIIEFMTCBTRVRUSU5HUyAKCQkvLyBCRUZPUkUgTE9DS0lORwoKCQlpZiAocVN0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpIHsKCQkJU3RhdEV2ZW50KCJMb2NraW5nISIpOwoJCQlyZXR1cm47CgkJfQoKCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudDsKCgkJcm1HYXMgPSAxMDAwMDA7IC8vIHJlbXVuZXJhdGlvbiBnYXMKCQlyd0dhcyA9IDEwMDAwOyAvLyByZXdhcmQgZ2FzCgkJcmZHYXMgPSAxMDAwMDsgLy8gcmVmdW5kIGdhcwoKCgkJLy8gemVybyBvdXQgYWxsIHRva2VuIGhvbGRlcnMuICAKCQkvLyBsZWF2ZSBhbGxvY2VkIG9uLCBsZWF2ZSBudW0gYWNjb3VudHMKCQkvLyBjYW50IGRlbGV0ZSB0aGVtIGFueXdheXMKCQoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCA+IDApIHsKCQkJZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtQWNjb3VudHM7IGkrKyApIHsKCQkJCWFkZHJlc3MgYSA9IGhvbGRlckluZGV4ZXNbaV07CgkJCQlpZiAoYSAhPSBhZGRyZXNzKDApKSB7CgkJCQkJaG9sZGVyQWNjb3VudHNbYV0udG9rZW5zID0gMDsKCQkJCQlob2xkZXJBY2NvdW50c1thXS5iYWxhbmNlID0gMDsKCQkJCX0KCQkJfQoJCX0KCQkvLyBkbyBub3QgcmVzZXQgbnVtQWNjb3VudHMhCgoJCXRvdGFsVG9rZW5zTWludGVkID0gMDsgLy8gdGhpcyB3aWxsIGVyYXNlCgkJdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgPSAwOyAvLyB0aGlzIHdpbGwgZXJhc2UuCgkJcGFydG5lckNyZWRpdHMgPSAwOyAvLyByZXNldCBhbGwgcGFydG5lciBjcmVkaXRzCgoJCWZ1bmRpbmdTdGFydCA9ICBfc2FsZVN0YXJ0OwoJCWZ1bmRpbmdEZWFkbGluZSA9IF9zYWxlRW5kOwoJCXVzYWdlRGVhZGxpbmUgPSBfdXNhZ2VFbmQ7CgkJbWluVXNhZ2VHb2FsID0gX21pblVzYWdlOwoJCW1pbkljb1Rva2VuR29hbCA9IF90b2tHb2FsOwoJCW1heE1pbnRhYmxlVG9rZW5zID0gX21heE1pbnRhYmxlOwoJCXRva2VuUHJpY2UgPSBfcHJpY2U7CgoJCXZlc3RUaW1lID0gZnVuZGluZ1N0YXJ0ICsgKDM2NSBkYXlzKTsKCQludW1EZXZUb2tlbnMgPSAwOwoJCQoJCWhvbGRvdmVyQmFsYW5jZSA9IDA7CgkJcGF5b3V0QmFsYW5jZSA9IDA7CgkJY3VyUGF5b3V0SWQgPSAxOwoJCWxhc3RQYXlvdXRJbmRleCA9IDA7CgkJcmVtdW5lcmF0aW9uU3RhZ2UgPSAwOwoJCXJlbXVuZXJhdGlvbkJhbGFuY2UgPSAwOwoJCWF1eFBhcnRuZXJCYWxhbmNlID0gMDsKCQlkZXZlbG9wZXJzR3JhbnRlZCA9IGZhbHNlOwoJCWxhc3RQYXlvdXRUaW1lID0gMDsKCgkJaWYgKHRoaXMuYmFsYW5jZSA+IDApIHsKCQkJaWYgKCFvd25lci5jYWxsLmdhcyhyZkdhcykudmFsdWUodGhpcy5iYWxhbmNlKSgpKQoJCQkJU3RhdEV2ZW50KCJFUlJPUiEiKTsKCQl9CgkJU3RhdEV2ZW50KCJvayIpOwoKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyB0b2tlbnMgaGVsZCByZXNlcnZlIHRoZSB0b3AgdHdvIGJ5dGVzIGZvciB0aGUgcGF5aWQgbGFzdCBwYWlkLgoJLy8gdGhpcyBpcyBzbyBob2xkZXJzIGF0IHRoZSB0b3Agb2YgdGhlIGxpc3QgZG9udCB0cmFuc2ZlciB0b2tlbnMgCgkvLyB0byB0aGVtc2VsdmVzIG9uIHRoZSBib3R0b20gb2YgdGhlIGxpc3QgdGh1cyBzY2FtbWluZyB0aGUgCgkvLyBzeXN0ZW0uIHRoaXMgZnVuY3Rpb24gZGVjb25zdHJ1Y3RzIHRoZSB0b2tlbmhlbGQgdmFsdWUuCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGdldFBheUlkQW5kSGVsZCh1aW50IF90b2tIZWxkKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9wYXlJZCwgdWludCBfaGVsZCkKCXsKCQlfcGF5SWQgPSAoX3Rva0hlbGQgLyAoMiAqKiA0OCkpICYgMHhmZmZmOwoJCV9oZWxkID0gX3Rva0hlbGQgJiAweGZmZmZmZmZmZmZmZjsKCX0KCWZ1bmN0aW9uIGdldEhlbGQodWludCBfdG9rSGVsZCkgaW50ZXJuYWwgIHJldHVybnMgKHVpbnQgX2hlbGQpCgl7CgkJX2hlbGQgPSBfdG9rSGVsZCAmIDB4ZmZmZmZmZmZmZmZmOwoJfQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBhbGxvY2F0ZSBhIG5ldyBhY2NvdW50IGJ5IHNldHRpbmcgYWxsb2MgdG8gdHJ1ZQoJLy8gc2V0IHRoZSB0b3AgdG8gYnl0ZXMgb2YgdG9rZW5zIHRvIGN1ciBwYXkgaWQgdG8gbGVhdmUgb3V0IG9mIGN1cnJlbnQgcm91bmQKCS8vIGFkZCBob2xkZXIgaW5kZXgsIGJ1bXAgdGhlIG51bSBhY2NvdW50cwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBhZGRBY2NvdW50KGFkZHJlc3MgX2FkZHIpIGludGVybmFsICB7CgkJaG9sZGVyQWNjb3VudHNbX2FkZHJdLmFsbG9jZWQgPSB0cnVlOwoJCWhvbGRlckFjY291bnRzW19hZGRyXS50b2tlbnMgPSAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpOwoJCWhvbGRlckluZGV4ZXNbbnVtQWNjb3VudHMrK10gPSBfYWRkcjsKCX0KCQoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gQkVHSU4gRVJDLTIwIGZyb20gU3RhbmRhcmRUb2tlbgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSkKCXsKCQlpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuCgkJCXx8IGljb1N0YXR1cyA9PSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudCkKCQkJc3VwcGx5ID0gbWF4TWludGFibGVUb2tlbnM7CgkJZWxzZQoJCQlzdXBwbHkgPSB0b3RhbFRva2Vuc01pbnRlZDsKCX0KCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKCQlpZiAoKG1zZy5zZW5kZXIgPT0gZGV2ZWxvcGVycykgCgkJCSYmICAobm93IDwgdmVzdFRpbWUpKSB7CgkJCS8vc3RhdEV2ZW50KCJUb2tlbnMgbm90IHlldCB2ZXN0ZWQuIik7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoKCSAgICAgICAgLy9EZWZhdWx0IGFzc3VtZXMgdG90YWxTdXBwbHkgY2FuJ3QgYmUgb3ZlciBtYXggKDJeMjU2IC0gMSkuCgkgICAgICAgIC8vSWYgeW91ciB0b2tlbiBsZWF2ZXMgb3V0IHRvdGFsU3VwcGx5IGFuZCBjYW4gaXNzdWUgbW9yZSB0b2tlbnMgYXMgdGltZSBnb2VzIG9uLCB5b3UgbmVlZCB0byBjaGVjayBpZiBpdCBkb2Vzbid0IHdyYXAuCgkgICAgICAgIC8vUmVwbGFjZSB0aGUgaWYgd2l0aCB0aGlzIG9uZSBpbnN0ZWFkLgoJICAgICAgICAvL2lmIChob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGhvbGRlckFjY291bnRzW190b10pIHsKCgkJdmFyIChwaWRGcm9tLCBoZWxkRnJvbSkgPSBnZXRQYXlJZEFuZEhlbGQoaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0udG9rZW5zKTsKCSAgICAgICAgaWYgKGhlbGRGcm9tID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CgoJICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0udG9rZW5zIC09IF92YWx1ZTsKCgkJICAgIGlmICghaG9sZGVyQWNjb3VudHNbX3RvXS5hbGxvY2VkKSB7CgkJCWFkZEFjY291bnQoX3RvKTsKCQkgICAgfQoKCQkgICAgdWludCBuZXdIZWxkID0gX3ZhbHVlICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfdG9dLnRva2Vucyk7CgkJICAgIGlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW4pIC8vIGF2b2lkIG1jZ2VlcyBnYW1iaXQKCQkgICAgCXBpZEZyb20gPSBjdXJQYXlvdXRJZDsKCQkgICAgaG9sZGVyQWNjb3VudHNbX3RvXS50b2tlbnMgPSBuZXdIZWxkIHwgKHBpZEZyb20gKiAoMiAqKiA0OCkpOwoKCSAgICAgICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9IGVsc2UgeyAKCQkJcmV0dXJuIGZhbHNlOyAKCQl9CiAgICAJfQoKICAgIAlmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCgkJaWYgKChfZnJvbSA9PSBkZXZlbG9wZXJzKSAKCQkJJiYgIChub3cgPCB2ZXN0VGltZSkpIHsKCQkJLy9zdGF0RXZlbnQoIlRva2VucyBub3QgeWV0IHZlc3RlZC4iKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgogICAgICAgIC8vc2FtZSBhcyBhYm92ZS4gUmVwbGFjZSB0aGlzIGxpbmUgd2l0aCB0aGUgZm9sbG93aW5nIGlmIHlvdSB3YW50IHRvIHByb3RlY3QgYWdhaW5zdCB3cmFwcGluZyB1aW50cy4KICAgICAgICAvL2lmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgewoKCQl2YXIgKHBpZEZyb20sIGhlbGRGcm9tKSA9IGdldFBheUlkQW5kSGVsZChob2xkZXJBY2NvdW50c1tfZnJvbV0udG9rZW5zKTsKICAgICAgICAJaWYgKGhlbGRGcm9tID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewoJICAgICAgICAgICAgaG9sZGVyQWNjb3VudHNbX2Zyb21dLnRva2VucyAtPSBfdmFsdWU7CgoJCSAgICBpZiAoIWhvbGRlckFjY291bnRzW190b10uYWxsb2NlZCkKCQkJYWRkQWNjb3VudChfdG8pOwoKCQkgICAgdWludCBuZXdIZWxkID0gX3ZhbHVlICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfdG9dLnRva2Vucyk7CgoJCSAgICBpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuKSAvLyBhdm9pZCBtY2dlZXMgZ2FtYml0CgkJICAgIAlwaWRGcm9tID0gY3VyUGF5b3V0SWQ7CgkJICAgIGhvbGRlckFjY291bnRzW190b10udG9rZW5zID0gbmV3SGVsZCB8IChwaWRGcm9tICogKDIgKiogNDgpKTsKCgkgICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgkgICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0gZWxzZSB7IAoJCSAgICByZXR1cm4gZmFsc2U7IAoJCX0KCX0KCgogICAgCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CgkJLy8gdmFycyBkZWZhdWx0IHRvIDAKCQlpZiAoaG9sZGVyQWNjb3VudHNbX293bmVyXS5hbGxvY2VkKSB7CgkgICAgICAgIAliYWxhbmNlID0gZ2V0SGVsZChob2xkZXJBY2NvdW50c1tfb3duZXJdLnRva2Vucyk7CgkJfSAKICAgIAl9CgogICAgCWZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIAlhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICAJQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgCXJldHVybiB0cnVlOwogICAgCX0KCiAgICAJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAJCXJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgCX0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBFTkQgRVJDMjAKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAKCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGRlZmF1bHQgcGF5YWJsZSBmdW5jdGlvbi4KCS8vIGlmIHNlbmRlciBpcyBlNHJvdyAgcGFydG5lciwgdGhpcyBpcyBhIHJha2UgZmVlIHBheW1lbnQKCS8vIG90aGVyd2lzZSB0aGlzIGlzIGEgdG9rZW4gcHVyY2hhc2UuCgkvLyB0b2tlbnMgb25seSBwdXJjaGFzZWFibGUgYmV0d2VlbiB0b2tlbmZ1bmRpbmdzdGFydCBhbmQgZW5kCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiAoKSBwYXlhYmxlIHsKCQlpZiAobXNnLnNlbmRlciA9PSBlNF9wYXJ0bmVyKSB7CgkJICAgICBmZWVQYXltZW50KCk7IC8vIGZyb20gZTRyb3cgZ2FtZSBlc2Nyb3cgY29udHJhY3QKCQl9IGVsc2UgewoJCSAgICAgcHVyY2hhc2VUb2tlbigpOwoJCX0KCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcHVyY2hhc2UgdG9rZW4gZnVuY3Rpb24gLSB0b2tlbnMgb25seSBzb2xkIGR1cmluZyBzYWxlIHBlcmlvZCB1cCB1bnRpbCB0aGUgbWF4IHRva2VucwoJLy8gcHVyY2hhc2UgcHJpY2UgaXMgdG9rZW5QcmljZS4gIGFsbCB1bml0cyBpbiB3ZWkuCgkvLyBwdXJjaGFzZXIgd2lsbCBub3QgYmUgaW5jbHVkZWQgaW4gY3VycmVudCBwYXkgcnVuCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gcHVyY2hhc2VUb2tlbigpIHBheWFibGUgewoKCQl1aW50IG52YWx1ZSA9IG1zZy52YWx1ZTsgLy8gYmVpbmcgY2FyZWZ1bCB0byBwcmVzZXJ2ZSBtc2cudmFsdWUKCQlhZGRyZXNzIG5wdXJjaGFzZXIgPSBtc2cuc2VuZGVyOwoJCWlmIChudmFsdWUgPCB0b2tlblByaWNlKSAKCQkJdGhyb3c7CgoJCXVpbnQgcXR5ID0gbnZhbHVlL3Rva2VuUHJpY2U7CgkJdXBkYXRlSWNvU3RhdHVzKCk7CgkJaWYgKGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5zYWxlT3BlbikgLy8gcHVyY2hhc2UgaXMgY2xvc2VkCgkJCXRocm93OwoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCArIHF0eSA+IG1heE1pbnRhYmxlVG9rZW5zKQoJCQl0aHJvdzsKCQlpZiAoIWhvbGRlckFjY291bnRzW25wdXJjaGFzZXJdLmFsbG9jZWQpCgkJCWFkZEFjY291bnQobnB1cmNoYXNlcik7CgkJCgkJLy8gcHVyY2hhc2VyIHdhaXRzIGZvciBuZXh0IHBheXJ1bi4gb3RoZXJ3aXNlIGNhbiBkaXNydXB0IGN1ciBwYXkgcnVuCgkJdWludCBuZXdIZWxkID0gcXR5ICsgZ2V0SGVsZChob2xkZXJBY2NvdW50c1tucHVyY2hhc2VyXS50b2tlbnMpOwoJCWhvbGRlckFjY291bnRzW25wdXJjaGFzZXJdLnRva2VucyA9IG5ld0hlbGQgfCAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpOwoKCQl0b3RhbFRva2Vuc01pbnRlZCArPSBxdHk7CgkJdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgKz0gbnZhbHVlOwoKCQlpZiAodG90YWxUb2tlbnNNaW50ZWQgPT0gbWF4TWludGFibGVUb2tlbnMpIHsKCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc2FsZUNsb3NlZDsKCQkJLy90ZXN0IHVubmVjZXNzYXJ5IC0gIGlmIChnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpCgkJCWRvRGV2ZWxvcGVyR3JhbnQoKTsKCQkJU3RhdEV2ZW50SSgiUHVyY2hhc2VkLEdyYW50ZWQiLCBxdHkpOwoJCX0gZWxzZQoJCQlTdGF0RXZlbnRJKCJQdXJjaGFzZWQiLCBxdHkpOwoKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBhY2NlcHQgcGF5bWVudCBmcm9tIGU0cm93IGNvbnRyYWN0CgkvLyBXQVJOSU5HISBETyBOT1QgQ0FMTCBUSElTIEZVTkNUSU9OIExFU1QgWU9VIExPU0UgWU9VUiBNT05FWQoJLy8gSE9XRVZFUiBBREQgVEhJUyBHSUZUIFRPIFRIRSBIT0xET1ZFUkJBTEFOQ0UKCS8vIFlPVSBIQVZFIEJFRU4gV0FSTkVECgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGZlZVBheW1lbnQoKSBwYXlhYmxlICAKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBlNF9wYXJ0bmVyKSB7CgkJCWlmIChtc2cudmFsdWUgPiAwKQoJCQkJaG9sZG92ZXJCYWxhbmNlICs9IG1zZy52YWx1ZTsKCQkJU3RhdEV2ZW50KCJmb3JiaWRkZW4iKTsKCQkJcmV0dXJuOyAvLyB0aGFuayB5b3UKCQl9CgkJdWludCBuZnZhbHVlID0gbXNnLnZhbHVlOyAvLyBwcmVzZXJ2ZSB2YWx1ZSBpbiBjYXNlIGNoYW5nZWQgaW4gZGV2IGdyYW50CgoJCXVwZGF0ZUljb1N0YXR1cygpOwoKCQlob2xkb3ZlckJhbGFuY2UgKz0gbmZ2YWx1ZTsKCQlwYXJ0bmVyQ3JlZGl0cyArPSBuZnZhbHVlOwoJCVN0YXRFdmVudEkoIlBheW1lbnQiLCBuZnZhbHVlKTsKCgkJaWYgKGhvbGRvdmVyQmFsYW5jZSA+IHBheW91dFRocmVzaG9sZAoJCQl8fCBwYXlvdXRCYWxhbmNlID4gMCkKCQkJZG9QYXlvdXQobWF4UGF5c1Blcik7CgkJCgkKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHNldCB0aGUgZTRyb3cgcGFydG5lciwgdGhpcyBpcyBvbmx5IGRvbmUgb25jZQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBzZXRFNFJvd1BhcnRuZXIoYWRkcmVzcyBfYWRkcikgcHVibGljCQoJewoJLy8gT05MWSBvd25lciBjYW4gc2V0IGFuZCBPTkxZIE9OQ0UhICh1bmxlc3MgInVubG9ja2VkIiBkZWJ1ZykKCS8vIG9uY2UgaXRzIGxvY2tlZC4gT05MWSBPTkNFIQoJCWlmIChtc2cuc2VuZGVyID09IG93bmVyKSB7CgkJCWlmICgoZTRfcGFydG5lciA9PSBhZGRyZXNzKDApKSB8fCAoc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5kZWJ1ZykpIHsKCQkJCWU0X3BhcnRuZXIgPSBfYWRkcjsKCQkJCXBhcnRuZXJDcmVkaXRzID0gMDsKCQkJCS8vU3RhdEV2ZW50SSgiRTQtU2V0IiwgMCk7CgkJCX0gZWxzZSB7CgkJCQlTdGF0RXZlbnQoIkFscmVhZHkgU2V0Iik7CgkJCX0KCQl9Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcmV0dXJuIHRoZSB0b3RhbCB0b2tlbnMgcHVyY2hhc2VkCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX3B1cmNoYXNlZCkKCXsKCQlfcHVyY2hhc2VkID0gdG90YWxUb2tlbnNNaW50ZWQtbnVtRGV2VG9rZW5zOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHJldHVybiB0aGUgbnVtIGdhbWVzIGFzIHJlcG9ydGVkIGZyb20gdGhlIGU0cm93ICBjb250cmFjdAoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0TnVtR2FtZXMoKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2dhbWVzKQoJewoJCS8vX2dhbWVzID0gMDsKCQlpZiAoZTRfcGFydG5lciAhPSBhZGRyZXNzKDApKSB7CgkJCWlFNFJvd0VzY3JvdyBwZTQgPSBpRTRSb3dFc2Nyb3coZTRfcGFydG5lcik7CgkJCV9nYW1lcyA9IHVpbnQocGU0LmdldE51bUdhbWVzU3RhcnRlZCgpKTsKCQl9IAoJCS8vZWxzZQoJCS8vU3RhdEV2ZW50KCJFbXB0eSBFNCIpOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gZ2V0IHRoZSBmb3VuZGVycywgYXV4UGFydG5lciwgZGV2ZWxvcGVyCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0U3BlY2lhbEFkZHJlc3NlcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgX2ZuZHIsIGFkZHJlc3MgX2F1eCwgYWRkcmVzcyBfZGV2LCBhZGRyZXNzIF9lNCkKCXsKCQkvL2lmIChfc2VuZGVyID09IG93bmVyKSB7IC8vIG5vIG1zZy5zZW5kZXIgb24gY29uc3RhbnQgZnVuY3Rpb25zIGF0IGxlYXN0IGluIG1ldwoJCQlfZm5kciA9IGZvdW5kZXJPcmc7CgkJCV9hdXggPSBhdXhQYXJ0bmVyOwoJCQlfZGV2ID0gZGV2ZWxvcGVyczsKCQkJX2U0ICA9IGU0X3BhcnRuZXI7CgkJLy99Cgl9CgoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyB1cGRhdGUgdGhlIGljbyBzdGF0dXMKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHVwZGF0ZUljb1N0YXR1cygpIHB1YmxpYwoJewoJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc3VjY2VlZGVkIAoJCQl8fCBpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuZmFpbGVkKQoJCQlyZXR1cm47CgkJZWxzZSBpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLmFub3VuY2VtZW50KSB7CgkJCWlmIChub3cgPiBmdW5kaW5nU3RhcnQgJiYgbm93IDw9IGZ1bmRpbmdEZWFkbGluZSkgewoJCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW47CgkJCQkKCQkJfSBlbHNlIGlmIChub3cgPiBmdW5kaW5nRGVhZGxpbmUpIHsKCQkJCS8vIHNob3VsZCBub3QgYmUgaGVyZSAtIHRoaXMgd2lsbCBldmVudHVhbGx5IGZhaWwKCQkJCWljb1N0YXR1cyA9IEljb1N0YXR1c1ZhbHVlLnNhbGVDbG9zZWQ7CgkJCX0KCQl9IGVsc2UgewoJCQl1aW50IG51bVAgPSBnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKTsKCQkJdWludCBudW1HID0gZ2V0TnVtR2FtZXMoKTsKCQkJaWYgKChub3cgPiBmdW5kaW5nRGVhZGxpbmUgJiYgbnVtUCA8IG1pbkljb1Rva2VuR29hbCkKCQkJCXx8IChub3cgPiB1c2FnZURlYWRsaW5lICYmIG51bUcgPCBtaW5Vc2FnZUdvYWwpKSB7CgkJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5mYWlsZWQ7CgkJCX0gZWxzZSBpZiAoKG5vdyA+IGZ1bmRpbmdEZWFkbGluZSkgLy8gZG9udCB3YW50IHRvIHByZXZlbnQgbW9yZSB0b2tlbiBzYWxlcwoJCQkJJiYgKG51bVAgPj0gbWluSWNvVG9rZW5Hb2FsKQoJCQkJJiYgKG51bUcgPj0gbWluVXNhZ2VHb2FsKSkgewoJCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc3VjY2VlZGVkOyAvLyBob29yYXkKCQkJfQoJCQlpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuCgkJCQkmJiAoKG51bVAgPj0gbWF4TWludGFibGVUb2tlbnMpCgkJCQl8fCAobm93ID4gZnVuZGluZ0RlYWRsaW5lKSkpIHsKCQkJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zYWxlQ2xvc2VkOwoJCQkJfQoJCX0KCgkJaWYgKCFkZXZlbG9wZXJzR3JhbnRlZAoJCQkmJiBpY29TdGF0dXMgIT0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW4gCgkJCSYmIGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudAoJCQkmJiBnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpIHsKCQkJCWRvRGV2ZWxvcGVyR3JhbnQoKTsgLy8gZ3JhbnQgd2hlbmV2ZXIgc3RhdHVzIGdvZXMgZnJvbSBvcGVuIHRvIGFueXRoaW5nLi4uCgkJfQoKCQoJfQoKCQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcmVxdWVzdCByZWZ1bmQuIENhbGxlciBtdXN0IGNhbGwgdG8gcmVxdWVzdCBhbmQgcmVjZWl2ZSByZWZ1bmQgCgkvLyBXQVJOSU5HIC0gd2l0aGRyYXcgcmV3YXJkcy9kaXZpZGVuZHMgYmVmb3JlIGNhbGxpbmcuCgkvLyBZT1UgSEFWRSBCRUVOIFdBUk5FRAoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gcmVxdWVzdFJlZnVuZCgpCgl7CgkJYWRkcmVzcyBucmVxdWVzdGVyID0gbXNnLnNlbmRlcjsKCQl1cGRhdGVJY29TdGF0dXMoKTsKCgkJdWludCBudG9rZW5zID0gZ2V0SGVsZChob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS50b2tlbnMpOwoJCWlmIChpY29TdGF0dXMgIT0gSWNvU3RhdHVzVmFsdWUuZmFpbGVkKQoJCQlTdGF0RXZlbnQoIk5vIFJlZnVuZCIpOwoJCWVsc2UgaWYgKG50b2tlbnMgPT0gMCkKCQkJU3RhdEV2ZW50KCJObyBUb2tlbnMiKTsKCQllbHNlIHsKCQkJdWludCBucmVmdW5kID0gbnRva2VucyAqIHRva2VuUHJpY2U7CgkJCWlmIChnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpCgkJCQlucmVmdW5kIC09IChucmVmdW5kIC8xMCk7IC8vIG9ubHkgOTAgcGVyY2VudCBiL2MgMTAgcGVyY2VudCBwYXlvdXQKCgkJCWlmICghaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10uYWxsb2NlZCkgCgkJCQlhZGRBY2NvdW50KGRldmVsb3BlcnMpOwoJCQlob2xkZXJBY2NvdW50c1tkZXZlbG9wZXJzXS50b2tlbnMgKz0gbnRva2VuczsKCQkJaG9sZGVyQWNjb3VudHNbbnJlcXVlc3Rlcl0udG9rZW5zID0gMDsKCQkJaWYgKGhvbGRlckFjY291bnRzW25yZXF1ZXN0ZXJdLmJhbGFuY2UgPiAwKSB7CgkJCQkvLyBzZWUgYWJvdmUgd2FybmluZyEhCgkJCQlob2xkZXJBY2NvdW50c1tkZXZlbG9wZXJzXS5iYWxhbmNlICs9IGhvbGRlckFjY291bnRzW25yZXF1ZXN0ZXJdLmJhbGFuY2U7CgkJCQlob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS5iYWxhbmNlID0gMDsKCQkJfQoKCQkJaWYgKCFucmVxdWVzdGVyLmNhbGwuZ2FzKHJmR2FzKS52YWx1ZShucmVmdW5kKSgpKQoJCQkJdGhyb3c7CgkJCS8vU3RhdEV2ZW50SSgiUmVmdW5kZWQiLCBucmVmdW5kKTsKCQl9Cgl9CgoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHBheW91dCByZXdhcmRzIHRvIGFsbCB0b2tlbiBob2xkZXJzCgkvLyB1c2UgYSBzZWNvbmQgaG9sZGluZyB2YXJpYWJsZSBjYWxsZWQgUGF5b3V0QmFsYW5jZSB0byBkbyAKCS8vIHRoZSBhY3R1YWwgcGF5b3V0IGZyb20gYi9jIHRvbyBtdWNoIGdhcyB0byBpdGVyYXRlIHRocnUgCgkvLyBlYWNoIHBheWVlLiBPbmx5IHN0YXJ0IGEgbmV3IHJ1biBhdCBtb3N0IG9uY2UgcGVyICJtaW5wYXlpbnRlcnZhbCIuCgkvLyBJdHMgZG9uZSBpbiBydW5zIG9mICJfbnVtUGF5cyIKCS8vIHdlIHVzZSBzcGVjaWFsIGNvZGluZyBmb3IgdGhlIGhvbGRlckFjY291bnRzIHRvIGF2b2lkIGEgaGFjawoJLy8gb2YgZ2V0dGluZyBwYWlkIGF0IHRoZSB0b3Agb2YgdGhlIGxpc3QgdGhlbiB0cmFuc2ZlcmluZyB0b2tlbnMKCS8vIHRvIGFub3RoZXIgYWRkcmVzcyBhdCB0aGUgYm90dG9tIG9mIHRoZSBsaXN0LgoJLy8gYmVjYXVzZSBvZiB0aGF0IGVhY2ggaG9sZGVyQWNjb3VudHMgZW50cnkgZ2V0cyB0aGUgcGF5b3V0aWQgc3RhbXBlZCB1cG9uIGl0ICh0b3AgdHdvIGJ5dGVzKQoJLy8gYWxzbyBhIHRva2VuIHRyYW5zZmVyIHdpbGwgdHJhbnNmZXIgdGhlIHBheW91dCBpZC4KCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZG9QYXlvdXQodWludCBfbnVtUGF5cykgIGludGVybmFsCgl7CgkJaWYgKHRvdGFsVG9rZW5zTWludGVkID09IDApCgkJCXJldHVybjsKCgkJaWYgKChob2xkb3ZlckJhbGFuY2UgPiAwKSAKCQkJJiYgKHBheW91dEJhbGFuY2UgPT0gMCkKCQkJJiYgKG5vdyA+IChsYXN0UGF5b3V0VGltZSttaW5QYXlJbnRlcnZhbCkpKSB7CgkJCS8vIHN0YXJ0IGEgbmV3IHJ1bgoJCQljdXJQYXlvdXRJZCsrOwoJCQlpZiAoY3VyUGF5b3V0SWQgPj0gMzI3NjgpCgkJCQljdXJQYXlvdXRJZCA9IDE7CgkJCWxhc3RQYXlvdXRUaW1lID0gbm93OwoJCQlwYXlvdXRCYWxhbmNlID0gaW50KGhvbGRvdmVyQmFsYW5jZSk7CgkJCXByT3JpZ1BheW91dEJhbCA9IHBheW91dEJhbGFuY2U7CgkJCXByT3JpZ1Rva2Vuc01pbnQgPSB0b3RhbFRva2Vuc01pbnRlZDsKCQkJaG9sZG92ZXJCYWxhbmNlID0gMDsKCQkJbGFzdFBheW91dEluZGV4ID0gMDsKCQkJU3RhdEV2ZW50SSgiU3RhcnRSdW4iLCB1aW50KGN1clBheW91dElkKSk7CgkJfSBlbHNlIGlmIChwYXlvdXRCYWxhbmNlID4gMCkgewoJCQkvLyB3b3JrIGRvd24gdGhlIHAuby5iCgkJCXVpbnQgbkFtb3VudDsKCQkJdWludCBuUGVyVG9rRGlzdHJpYiA9IHVpbnQocHJPcmlnUGF5b3V0QmFsKS9wck9yaWdUb2tlbnNNaW50OwoJCQl1aW50IHBhaWRzID0gMDsKCQkJdWludCBpOyAvLyBpbnRlbnRpb25hbAoJCQlmb3IgKGkgPSBsYXN0UGF5b3V0SW5kZXg7IChwYWlkcyA8IF9udW1QYXlzKSAmJiAoaSA8IG51bUFjY291bnRzKSAmJiAocGF5b3V0QmFsYW5jZSA+IDApOyBpKysgKSB7CgkJCQlhZGRyZXNzIGEgPSBob2xkZXJJbmRleGVzW2ldOwoJCQkJaWYgKGEgPT0gYWRkcmVzcygwKSkgewoJCQkJCWNvbnRpbnVlOwoJCQkJfQoJCQkJdmFyIChwaWQsIGhlbGQpID0gZ2V0UGF5SWRBbmRIZWxkKGhvbGRlckFjY291bnRzW2FdLnRva2Vucyk7CgkJCQlpZiAoKGhlbGQgPiAwKSAmJiAocGlkICE9IGN1clBheW91dElkKSkgewoJCQkJCW5BbW91bnQgPSBuUGVyVG9rRGlzdHJpYiAqIGhlbGQ7CgkJCQkJaWYgKGludChuQW1vdW50KSA8PSBwYXlvdXRCYWxhbmNlKXsKCQkJCQkJaG9sZGVyQWNjb3VudHNbYV0uYmFsYW5jZSArPSBuQW1vdW50OyAKCQkJCQkJaG9sZGVyQWNjb3VudHNbYV0udG9rZW5zID0gKGN1clBheW91dElkICogKDIgKiogNDgpKSB8IGhlbGQ7CgkJCQkJCXBheW91dEJhbGFuY2UgLT0gaW50KG5BbW91bnQpOwkJCQkJCgkJCQkJCXBhaWRzKys7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWxhc3RQYXlvdXRJbmRleCA9IGk7CgkJCWlmIChsYXN0UGF5b3V0SW5kZXggPj0gbnVtQWNjb3VudHMgfHwgcGF5b3V0QmFsYW5jZSA8PSAwKSB7CgkJCQlsYXN0UGF5b3V0SW5kZXggPSAwOwoJCQkJaWYgKHBheW91dEJhbGFuY2UgPiAwKQoJCQkJCWhvbGRvdmVyQmFsYW5jZSArPSB1aW50KHBheW91dEJhbGFuY2UpOy8vIHB1dCBiYWNrIGFueSBsZWZ0b3ZlcnMKCQkJCXBheW91dEJhbGFuY2UgPSAwOwoJCQkJU3RhdEV2ZW50SSgiUnVuQ29tcGxldGUiLCB1aW50KHByT3JpZ1BheW91dEJhbCkgKTsKCgkJCX0gZWxzZSB7CgkJCQlTdGF0RXZlbnRJKCJQYXlSdW4iLCBwYWlkcyApOwoJCQl9CgkJfQoJCQoJfQoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBzZW5kZXIgd2l0aGRyYXcgZW50aXJlIHJld2FyZHMvZGl2aWRlbmRzCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiB3aXRoZHJhd0RpdmlkZW5kcygpIHB1YmxpYyByZXR1cm5zICh1aW50IF9hbW91bnQpCgl7CgkJaWYgKGhvbGRlckFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPT0gMCkgeyAKCQkJLy9fYW1vdW50ID0gMDsKCQkJU3RhdEV2ZW50KCIwIEJhbGFuY2UiKTsKCQkJcmV0dXJuOwoJCX0gZWxzZSB7CgkJCWlmICgobXNnLnNlbmRlciA9PSBkZXZlbG9wZXJzKSAKCQkJCSYmICAobm93IDwgdmVzdFRpbWUpKSB7CgkJCQkvL3N0YXRFdmVudCgiVG9rZW5zIG5vdCB5ZXQgdmVzdGVkLiIpOwoJCQkJLy9fYW1vdW50ID0gMDsKCQkJCXJldHVybjsKCQkJfQoKCQkJX2Ftb3VudCA9IGhvbGRlckFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2U7IAoJCQlob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXS5iYWxhbmNlID0gMDsgCgkJCWlmICghbXNnLnNlbmRlci5jYWxsLmdhcyhyd0dhcykudmFsdWUoX2Ftb3VudCkoKSkKCQkJCXRocm93OwoJCQkvL1N0YXRFdmVudEkoIlBhaWQiLCBfYW1vdW50KTsKCQoJCX0KCgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gc2V0IGdhcyBmb3Igb3BlcmF0aW9ucwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gc2V0T3BHYXModWludCBfcm0sIHVpbnQgX3JmLCB1aW50IF9ydykKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lciAmJiBtc2cuc2VuZGVyICE9IGRldmVsb3BlcnMpIHsKCQkJLy9TdGF0RXZlbnQoIm9ubHkgb3duZXIgY2FsbHMiKTsKCQkJcmV0dXJuOwoJCX0gZWxzZSB7CgkJCXJtR2FzID0gX3JtOwoJCQlyZkdhcyA9IF9yZjsKCQkJcndHYXMgPSBfcnc7CgkJfQoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGdldCBnYXMgZm9yIG9wZXJhdGlvbnMKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGdldE9wR2FzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCBfcm0sIHVpbnQgX3JmLCB1aW50IF9ydykKCXsKCQlfcm0gPSBybUdhczsKCQlfcmYgPSByZkdhczsKCQlfcncgPSByd0dhczsKCX0KIAoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGNoZWNrIHJld2FyZHMuICBwYXNzIGluIGFkZHJlc3Mgb2YgdG9rZW4gaG9sZGVyCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBjaGVja0RpdmlkZW5kcyhhZGRyZXNzIF9hZGRyKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2Ftb3VudCkKCXsKCQlpZiAoaG9sZGVyQWNjb3VudHNbX2FkZHJdLmFsbG9jZWQpCgkJCV9hbW91bnQgPSBob2xkZXJBY2NvdW50c1tfYWRkcl0uYmFsYW5jZTsKCX0JCQoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGljb0NoZWNrdXAgLSBjaGVjayB1cCBjYWxsIGZvciBhZG1pbmlzdHJhdG9ycwoJLy8gYWZ0ZXIgc2FsZSBpcyBjbG9zZWQgaWYgbWluIGljbyB0b2tlbnMgc29sZCwgMTAgcGVyY2VudCB3aWxsIGJlIGRpc3RyaWJ1dGVkIHRvIAoJLy8gY29tcGFueSB0byBjb3ZlciB2YXJpb3VzIG9wZXJhdGluZyBleHBlbnNlcwoJLy8gYWZ0ZXIgc2FsZSBhbmQgdXNhZ2UgZGVhbGluZXMgaGF2ZSBiZWVuIG1ldCwgcmVtYWluaW5nIDkwIHBlcmNlbnQgd2lsbCBiZSBkaXN0cmlidXRlZCB0bwoJLy8gY29tcGFueS4KCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gaWNvQ2hlY2t1cCgpIHB1YmxpYwoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyICYmIG1zZy5zZW5kZXIgIT0gZGV2ZWxvcGVycykKCQkJdGhyb3c7CgoJCXVpbnQgbm1zZ21hc2s7CgkJLy9ubXNnbWFzayA9IDA7CgkKCQlpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVDbG9zZWQpIHsKCQkJaWYgKChnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpCgkJCQkmJiAocmVtdW5lcmF0aW9uU3RhZ2UgPT0gMCApKSB7CgkJCQlyZW11bmVyYXRpb25TdGFnZSA9IDE7CgkJCQlyZW11bmVyYXRpb25CYWxhbmNlID0gKHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkLzEwMCkqOTsgLy8gOSBwZXJjZW50CgkJCQlhdXhQYXJ0bmVyQmFsYW5jZSA9ICAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTAwKTsgLy8gMSBwZXJjZW50CgkJCQlubXNnbWFzayB8PSAxOwoJCQl9IAoJCX0KCQlpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnN1Y2NlZWRlZCkgewoJCQoJCQlpZiAocmVtdW5lcmF0aW9uU3RhZ2UgPT0gMCApIHsKCQkJCXJlbXVuZXJhdGlvblN0YWdlID0gMTsKCQkJCXJlbXVuZXJhdGlvbkJhbGFuY2UgPSAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTAwKSo5OyAKCQkJCWF1eFBhcnRuZXJCYWxhbmNlID0gICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMDApOwoJCQkJbm1zZ21hc2sgfD0gNDsKCQkJfQoJCQlpZiAocmVtdW5lcmF0aW9uU3RhZ2UgPT0gMSkgeyAvLyB3ZSBoYXZlIGFscmVhZHkgc3VjZWVkZWQKCQkJCXJlbXVuZXJhdGlvblN0YWdlID0gMjsKCQkJCXJlbXVuZXJhdGlvbkJhbGFuY2UgKz0gdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgLSAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTApOyAvLyA5MCBwZXJjZW50CgkJCQlubXNnbWFzayB8PSA4OwoJCQl9CgoJCX0KCgkJdWludCBudG1wOwoKCQlpZiAocmVtdW5lcmF0aW9uQmFsYW5jZSA+IDApIHsgCgkJLy8gb25seSBwYXkgb25lIGVudGl0eSBwZXIgY2FsbCwgZG9udCB3YW50IHRvIHJ1biBvdXQgb2YgZ2FzCgkJCQludG1wID0gcmVtdW5lcmF0aW9uQmFsYW5jZTsKCQkJCXJlbXVuZXJhdGlvbkJhbGFuY2UgPSAwOwoJCQkJaWYgKCFmb3VuZGVyT3JnLmNhbGwuZ2FzKHJtR2FzKS52YWx1ZShudG1wKSgpKSB7CgkJCQkJcmVtdW5lcmF0aW9uQmFsYW5jZSA9IG50bXA7CgkJCQkJbm1zZ21hc2sgfD0gMzI7CgkJCQl9IGVsc2UgewoJCQkJCW5tc2dtYXNrIHw9IDY0OwoJCQkJfQkKCQl9IGVsc2UgCWlmIChhdXhQYXJ0bmVyQmFsYW5jZSA+IDApIHsKCQkvLyBub3RlIHRoZSAiZWxzZSIgb25seSBwYXkgb25lIGVudGl0eSBwZXIgY2FsbCwgZG9udCB3YW50IHRvIHJ1biBvdXQgb2YgZ2FzCgkJCW50bXAgPSBhdXhQYXJ0bmVyQmFsYW5jZTsKCQkJYXV4UGFydG5lckJhbGFuY2UgPSAwOwoJCQlpZiAoIWF1eFBhcnRuZXIuY2FsbC5nYXMocm1HYXMpLnZhbHVlKG50bXApKCkpIHsKCQkJCWF1eFBhcnRuZXJCYWxhbmNlID0gbnRtcDsKCQkJCW5tc2dtYXNrIHw9IDEyODsKCQkJfSAgZWxzZSB7CgkJCQlubXNnbWFzayB8PSAyNTY7CgkJCX0KCgkJfSAKCQkKCQlTdGF0RXZlbnRJKCJpY28tY2hlY2t1cCIsIG5tc2dtYXNrKTsKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gc3dhcCBleGVjdXRvcgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfYWRkcikgCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIKCQkJfHwgc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKQoJCQkgdGhyb3c7CgoJCW93bmVyID0gX2FkZHI7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gc3dhcCBkZXZlbG9wZXJzIGFjY291bnQKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGNoYW5nZURldmV2b3BlckFjY29udChhZGRyZXNzIF9hZGRyKSAKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcgoJCQl8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpCgkJCSB0aHJvdzsKCQlkZXZlbG9wZXJzID0gX2FkZHI7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gY2hhbmdlIGZvdW5kZXIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGNoYW5nZUZvdW5kZXIoYWRkcmVzcyBfYWRkcikgCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIKCQkJfHwgc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKQoJCQkgdGhyb3c7CgkJZm91bmRlck9yZyA9IF9hZGRyOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGNoYW5nZSBhdXhQYXJ0bmVyCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBjaGFuZ2VBdXhQYXJ0bmVyKGFkZHJlc3MgX2F1eCkgCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIKCQkJfHwgc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5sb2NrZWRSZWxlYXNlKQoJCQkgdGhyb3c7CgkJYXV4UGFydG5lciA9IF9hdXg7Cgl9CgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIERFQlVHIE9OTFkgLSBlbmQgdGhpcyBjb250cmFjdCwgc3VpY2lkZSB0byBkZXZlbG9wZXJzCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBoYXJhS2lyaSgpCgl7CgkJaWYgKHNldHRpbmdzU3RhdGUgIT0gU2V0dGluZ1N0YXRlVmFsdWUuZGVidWcpCgkJCXRocm93OwoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyKQoJCQkgdGhyb3c7CgkJc3VpY2lkZShkZXZlbG9wZXJzKTsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBnZXQgYWxsIGljbyBzdGF0dXMsIGZ1bmRpbmcgYW5kIHVzYWdlIGluZm8KCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGdldEljb0luZm8oKSBjb25zdGFudCByZXR1cm5zKEljb1N0YXR1c1ZhbHVlIF9zdGF0dXMsIHVpbnQgX3NhbGVTdGFydCwgdWludCBfc2FsZUVuZCwgdWludCBfdXNhZ2VFbmQsIHVpbnQgX3NhbGVHb2FsLCB1aW50IF91c2FnZUdvYWwsIHVpbnQgX3NvbGQsIHVpbnQgX3VzZWQsIHVpbnQgX2Z1bmRzLCB1aW50IF9jcmVkaXRzLCB1aW50IF9yZW11U3RhZ2UsIHVpbnQgX3Zlc3QpCgl7CgkJX3N0YXR1cyA9IGljb1N0YXR1czsKCQlfc2FsZVN0YXJ0ID0gZnVuZGluZ1N0YXJ0OwoJCV9zYWxlRW5kID0gZnVuZGluZ0RlYWRsaW5lOwoJCV91c2FnZUVuZCA9IHVzYWdlRGVhZGxpbmU7CgkJX3Zlc3QgPSB2ZXN0VGltZTsKCQlfc2FsZUdvYWwgPSBtaW5JY29Ub2tlbkdvYWw7CgkJX3VzYWdlR29hbCA9IG1pblVzYWdlR29hbDsKCQlfc29sZCA9IGdldE51bVRva2Vuc1B1cmNoYXNlZCgpOwoJCV91c2VkID0gZ2V0TnVtR2FtZXMoKTsKCQlfZnVuZHMgPSB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZDsKCQlfY3JlZGl0cyA9IHBhcnRuZXJDcmVkaXRzOwoJCV9yZW11U3RhZ2UgPSByZW11bmVyYXRpb25TdGFnZTsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBOT1RFISBDQUxMIEFUIFRIRSBSSVNLIE9GIFJVTk5JTkcgT1VUIE9GIEdBUy4KCS8vIEFOWU9ORSBDQU4gQ0FMTCBUSElTIEZVTkNUSU9OIEJVVCBZT1UgSEFWRSBUTyBTVVBQTFkgCgkvLyBUSEUgQ09SUkVDVCBBTU9VTlQgT0YgR0FTIFdISUNIIE1BWSBERVBFTkQgT04gCgkvLyBUSEUgX05VTVBBWVMgUEFSQU1FVEVSLiAgV0hJQ0ggTVVTVCBCRSBCRVRXRUVOIDEgQU5EIDEwMDAKCS8vIFRIRSBTVEFOREFSRCBWQUxVRSBJUyBTVE9SRUQgSU4gIm1heFBheXNQZXIiCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBmbHVzaERpdmlkZW5kcyh1aW50IF9udW1QYXlzKQoJewoJCWlmICgoX251bVBheXMgPT0gMCkgfHwgKF9udW1QYXlzID4gMTAwMCkpIHsKCQkJU3RhdEV2ZW50KCJJbnZhbGlkLiIpOwoJCX0gZWxzZSBpZiAoaG9sZG92ZXJCYWxhbmNlID4gMCB8fCBwYXlvdXRCYWxhbmNlID4gMCkgewoJCQlkb1BheW91dChfbnVtUGF5cyk7CgkJfSBlbHNlIHsKCQkJU3RhdEV2ZW50KCJOb3RoaW5nIHRvIGRvLiIpOwoJCX0KCQkJCQoJfQoKCWZ1bmN0aW9uIGRvRGV2ZWxvcGVyR3JhbnQoKSBpbnRlcm5hbAoJewoJCWlmICghZGV2ZWxvcGVyc0dyYW50ZWQpIHsKCQkJZGV2ZWxvcGVyc0dyYW50ZWQgPSB0cnVlOwoJCQludW1EZXZUb2tlbnMgPSAodG90YWxUb2tlbnNNaW50ZWQgKiAxNSkvMTAwOwoJCQl0b3RhbFRva2Vuc01pbnRlZCArPSBudW1EZXZUb2tlbnM7CgkJCWlmICghaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10uYWxsb2NlZCkgCgkJCQlhZGRBY2NvdW50KGRldmVsb3BlcnMpOwoJCQl1aW50IG5ld0hlbGQgPSBnZXRIZWxkKGhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLnRva2VucykgKyBudW1EZXZUb2tlbnM7CgkJCWhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLnRva2VucyA9IG5ld0hlbGQgfCAgKGN1clBheW91dElkICogKDIgKiogNDgpKTsKCgkJfQoJfQoKCn0='.
	

]
