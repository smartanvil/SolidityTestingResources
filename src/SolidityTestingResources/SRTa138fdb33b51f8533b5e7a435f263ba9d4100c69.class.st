Class {
	#name : #SRTa138fdb33b51f8533b5e7a435f263ba9d4100c69,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa138fdb33b51f8533b5e7a435f263ba9d4100c69 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Cgpjb250cmFjdCBTYWZlTWF0aCB7CgogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiApIHsKICAgICAgICB1aW50MjU2IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVEaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgKSB7CiAgICAgICAgYXNzZXJ0KGIgPiAwKTsKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2ICkgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2ICkgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9Cgpjb250cmFjdCBFUkMyMCB7CgogICAgLyogVGhpcyBpcyBhIHNsaWdodCBjaGFuZ2UgdG8gdGhlIEVSQzIwIGJhc2Ugc3RhbmRhcmQuCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsKICAgIGlzIHJlcGxhY2VkIHdpdGg6CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIFRoaXMgYXV0b21hdGljYWxseSBjcmVhdGVzIGEgZ2V0dGVyIGZ1bmN0aW9uIGZvciB0aGUgdG90YWxTdXBwbHkuCiAgICBUaGlzIGlzIG1vdmVkIHRvIHRoZSBiYXNlIGNvbnRyYWN0IHNpbmNlIHB1YmxpYyBnZXR0ZXIgZnVuY3Rpb25zIGFyZSBub3QKICAgIGN1cnJlbnRseSByZWNvZ25pc2VkIGFzIGFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSBtYXRjaGluZyBhYnN0cmFjdAogICAgZnVuY3Rpb24gYnkgdGhlIGNvbXBpbGVyLgogICAgKi8KICAgIC8vLyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF92YWx1ZWAgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIGFsbG93ZWQgdG8gc3BlbnQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cn0KCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIFNhZmVNYXRoIHsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vLyBAZGV2IFJldHVybnMgbnVtYmVyIG9mIHRva2VucyBvd25lZCBieSBnaXZlbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIHNlbmRlcidzIHRva2VucyB0byBhIGdpdmVuIGFkZHJlc3MuIFJldHVybnMgc3VjY2Vzcy4KICAgIC8vLyBAcGFyYW0gX3RvIEFkZHJlc3Mgb2YgdG9rZW4gcmVjZWl2ZXIuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLyBAZGV2IEFsbG93cyBhbGxvd2VkIHRoaXJkIHBhcnR5IHRvIHRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIuIFJldHVybnMgc3VjY2Vzcy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gQWRkcmVzcyBmcm9tIHdoZXJlIHRva2VucyBhcmUgd2l0aGRyYXduLgogICAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byB3aGVyZSB0b2tlbnMgYXJlIHNlbnQuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0cyBhcHByb3ZlZCBhbW91bnQgb2YgdG9rZW5zIGZvciBzcGVuZGVyLiBSZXR1cm5zIHN1Y2Nlc3MuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3Mgb2YgYWxsb3dlZCBhY2NvdW50LgogICAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIGFwcHJvdmVkIHRva2Vucy4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiBhbGxvd2VkIHRva2VucyBmb3IgZ2l2ZW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3Mgb2YgdG9rZW4gc3BlbmRlci4KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXI7CgogICAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBTYWZlIHRyYW5zZmVyIG9mIG93bmVyc2hpcCBpbiAyIHN0ZXBzLiBPbmNlIGNhbGxlZCwgYSBuZXdPd25lciBuZWVkcyB0byBjYWxsIGNsYWltT3duZXJzaGlwKCkgdG8gcHJvdmUgb3duZXJzaGlwLgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBwZW5kaW5nT3duZXIgPSBuZXdPd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBjbGFpbU93bmVyc2hpcCgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBwZW5kaW5nT3duZXIpIHsKICAgICAgICAgICAgb3duZXIgPSBwZW5kaW5nT3duZXI7CiAgICAgICAgICAgIHBlbmRpbmdPd25lciA9IDA7CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBNdWx0aU93bmFibGUgewoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgb3duZXJNYXA7CiAgICBhZGRyZXNzW10gcHVibGljIG93bmVyczsKCiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgaW5kZXhlZCBfbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3MgaW5kZXhlZCBfb2xkT3duZXIpOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gTXVsdGlPd25hYmxlKCkgewogICAgICAgIC8vIEFkZCBkZWZhdWx0IG93bmVyCiAgICAgICAgYWRkcmVzcyBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgb3duZXJNYXBbb3duZXJdID0gdHJ1ZTsKICAgICAgICBvd25lcnMucHVzaChvd25lcik7CiAgICB9CgogICAgZnVuY3Rpb24gb3duZXJDb3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG93bmVycy5sZW5ndGg7CiAgICB9CgogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIG93bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBvd25lck1hcFtvd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYWRkT3duZXIoYWRkcmVzcyBvd25lcikgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoIWlzT3duZXIob3duZXIpICYmIG93bmVyICE9IDApIHsKICAgICAgICAgICAgb3duZXJNYXBbb3duZXJdID0gdHJ1ZTsKICAgICAgICAgICAgb3duZXJzLnB1c2gob3duZXIpOwoKICAgICAgICAgICAgT3duZXJBZGRlZChvd25lcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBvd25lcikgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoaXNPd25lcihvd25lcikpIHsKICAgICAgICAgICAgb3duZXJNYXBbb3duZXJdID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG93bmVycy5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChvd25lcnNbaV0gPT0gb3duZXIpIHsKICAgICAgICAgICAgICAgICAgICBvd25lcnNbaV0gPSBvd25lcnNbb3duZXJzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG93bmVycy5sZW5ndGggLT0gMTsKCiAgICAgICAgICAgIE93bmVyUmVtb3ZlZChvd25lcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7CiAgICB9Cn0KCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewoKICAgIGJvb2wgcHVibGljIHBhdXNlZDsKCiAgICBtb2RpZmllciBpZk5vdFBhdXNlZCB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlmUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBDYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgcGF1c2VkIHN0YXRlCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBDYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICBmdW5jdGlvbiByZXN1bWUoKSBleHRlcm5hbCBvbmx5T3duZXIgaWZQYXVzZWQgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgfQp9Cgpjb250cmFjdCBUb2tlblNwZW5kZXIgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlKTsKfQoKY29udHJhY3QgQnNUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBNdWx0aU93bmFibGUgewoKICAgIGJvb2wgcHVibGljIGxvY2tlZDsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgdWludDggcHVibGljIGRlY2ltYWxzID0gMTg7CiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAndjAuMSc7CgogICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvcjsKICAgIGFkZHJlc3MgcHVibGljIHNlbGxlcjsKICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1NvbGQ7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFNhbGVzOwoKICAgIGV2ZW50IFNlbGwoYWRkcmVzcyBpbmRleGVkIF9zZWxsZXIsIGFkZHJlc3MgaW5kZXhlZCBfYnV5ZXIsIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IFNlbGxlckNoYW5nZWQoYWRkcmVzcyBpbmRleGVkIF9vbGRTZWxsZXIsIGFkZHJlc3MgaW5kZXhlZCBfbmV3U2VsbGVyKTsKCiAgICBtb2RpZmllciBvbmx5VW5sb2NrZWQoKSB7CiAgICAgICAgaWYgKCFpc093bmVyKG1zZy5zZW5kZXIpICYmIGxvY2tlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBCc1Rva2VuKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQyNTYgX3RvdGFsU3VwcGx5Tm9EZWNpbWFscywgYWRkcmVzcyBfc2VsbGVyKSBNdWx0aU93bmFibGUoKSB7CgogICAgICAgIC8vIExvY2sgdGhlIHRyYW5zZmVyIGZ1bmN0aW9uIGR1cmluZyB0aGUgcHJlc2FsZS9jcm93ZHNhbGUgdG8gcHJldmVudCBzcGVjdWxhdGlvbnMuCiAgICAgICAgbG9ja2VkID0gdHJ1ZTsKCiAgICAgICAgY3JlYXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgc2VsbGVyID0gX3NlbGxlcjsKCiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICAgICAgdG90YWxTdXBwbHkgPSBfdG90YWxTdXBwbHlOb0RlY2ltYWxzICogMWUxODsKCiAgICAgICAgYmFsYW5jZXNbc2VsbGVyXSA9IHRvdGFsU3VwcGx5OwogICAgICAgIFRyYW5zZmVyKDB4MCwgc2VsbGVyLCB0b3RhbFN1cHBseSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlU2VsbGVyKGFkZHJlc3MgbmV3U2VsbGVyKSBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobmV3U2VsbGVyICE9IDB4MCAmJiBzZWxsZXIgIT0gbmV3U2VsbGVyKTsKCiAgICAgICAgYWRkcmVzcyBvbGRTZWxsZXIgPSBzZWxsZXI7CgogICAgICAgIHVpbnQyNTYgdW5zb2xkVG9rZW5zID0gYmFsYW5jZXNbb2xkU2VsbGVyXTsKICAgICAgICBiYWxhbmNlc1tvbGRTZWxsZXJdID0gMDsKICAgICAgICBiYWxhbmNlc1tuZXdTZWxsZXJdID0gc2FmZUFkZChiYWxhbmNlc1tuZXdTZWxsZXJdLCB1bnNvbGRUb2tlbnMpOwogICAgICAgIFRyYW5zZmVyKG9sZFNlbGxlciwgbmV3U2VsbGVyLCB1bnNvbGRUb2tlbnMpOwoKICAgICAgICBzZWxsZXIgPSBuZXdTZWxsZXI7CiAgICAgICAgU2VsbGVyQ2hhbmdlZChvbGRTZWxsZXIsIG5ld1NlbGxlcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsbE5vRGVjaW1hbHMoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGwoX3RvLCBfdmFsdWUgKiAxZTE4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoYmFsYW5jZXNbc2VsbGVyXSA+PSBfdmFsdWUgJiYgX3ZhbHVlID4gMCkgewogICAgICAgICAgICBiYWxhbmNlc1tzZWxsZXJdID0gc2FmZVN1YihiYWxhbmNlc1tzZWxsZXJdLCBfdmFsdWUpOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgICAgICAgICBUcmFuc2ZlcihzZWxsZXIsIF90bywgX3ZhbHVlKTsKCiAgICAgICAgICAgIHRva2Vuc1NvbGQgPSBzYWZlQWRkKHRva2Vuc1NvbGQsIF92YWx1ZSk7CiAgICAgICAgICAgIHRvdGFsU2FsZXMgPSBzYWZlQWRkKHRvdGFsU2FsZXMsIDEpOwogICAgICAgICAgICBTZWxsKHNlbGxlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgb25seVVubG9ja2VkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIG9ubHlVbmxvY2tlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGxvY2soKSBvbmx5T3duZXIgewogICAgICAgIGxvY2tlZCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdW5sb2NrKCkgb25seU93bmVyIHsKICAgICAgICBsb2NrZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXJuKHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKSA7CiAgICAgICAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgX3ZhbHVlKTsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qIEFwcHJvdmUgYW5kIHRoZW4gY29tbXVuaWNhdGUgdGhlIGFwcHJvdmVkIGNvbnRyYWN0IGluIGEgc2luZ2xlIHR4ICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgewogICAgICAgIFRva2VuU3BlbmRlciBzcGVuZGVyID0gVG9rZW5TcGVuZGVyKF9zcGVuZGVyKTsKICAgICAgICBpZiAoYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKSkgewogICAgICAgICAgICBzcGVuZGVyLnJlY2VpdmVBcHByb3ZhbChtc2cuc2VuZGVyLCBfdmFsdWUpOwogICAgICAgIH0KICAgIH0KfQoKLyoqCiAqIEluIHRoaXMgY3Jvd2RzYWxlIFdlIGFzc3VtZSB0aGF0IEVUSCByYXRlIGlzIDMyMCBVU0QvRVRICiAqLwpjb250cmFjdCBCc0Nyb3dkc2FsZSBpcyBTYWZlTWF0aCwgT3duYWJsZSwgUGF1c2FibGUgewoKICAgIGVudW0gQ3VycmVuY3kgeyBCVEMsIExUQywgREFTSCwgWkVDLCBXQVZFUywgVVNELCBFVVIgfQoKICAgIHN0cnVjdCBCYWNrZXIgewogICAgICAgIHVpbnQyNTYgd2VpUmVjZWl2ZWQ7IC8vIEFtb3VudCBvZiB3ZWkgZ2l2ZW4gYnkgYmFja2VyCiAgICAgICAgdWludDI1NiB0b2tlbnNTZW50OyAgLy8gQW1vdW50IG9mIHRva2VucyByZWNlaXZlZCBpbiByZXR1cm4gdG8gdGhlIGdpdmVuIGFtb3VudCBvZiBFVEguCiAgICB9CgogICAgLy8gVE9ETyByZW5hbWUgdG8gYnV5ZXJzPwogICAgLy8gKGJ1eWVyX2V0aF9hZGRyZXNzIC0+IHN0cnVjdCkKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBCYWNrZXIpIHB1YmxpYyBiYWNrZXJzOwoKICAgIC8vIGN1cnJlbmN5X2NvZGUgPT4gKHR4X2hhc2ggPT4gdG9rZW5zKQogICAgbWFwcGluZyh1aW50ID0+IG1hcHBpbmcoYnl0ZXMzMiA9PiB1aW50MjU2KSkgcHVibGljIGV4dGVybmFsVHhzOwoKICAgIEJzVG9rZW4gcHVibGljIHRva2VuOyAgICAgICAgICAgLy8gVG9rZW4gY29udHJhY3QgcmVmZXJlbmNlLgogICAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7ICAgICAvLyBBZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIEVUSCByYWlzZWQgZHVyaW5nIHRoaXMgY3Jvd2RzYWxlLgogICAgYWRkcmVzcyBwdWJsaWMgbm90aWZpZXI7ICAgICAgICAvLyBBZGRyZXNzIHRoYXQgY2FuIHRoaXMgY3Jvd2RzYWxlIGFib3V0IGNoYW5nZWQgZXh0ZXJuYWwgY29uZGl0aW9ucy4KCiAgICB1aW50MjU2IHB1YmxpYyB1c2RQZXJFdGg7CiAgICB1aW50MjU2IHB1YmxpYyB1c2RQZXJFdGhNaW4gPSAyMDA7IC8vIExvd2VzdCBib3VuZGFyeSBvZiBVU0QvRVRIIHJhdGUKICAgIHVpbnQyNTYgcHVibGljIHVzZFBlckV0aE1heCA9IDUwMDsgLy8gSGlnaGVzdCBib3VuZGFyeSBvZiBVU0QvRVRIIHJhdGUKCiAgICBzdHJ1Y3QgVXNkUGVyRXRoTG9nIHsKICAgICAgICB1aW50MjU2IHJhdGU7CiAgICAgICAgdWludDI1NiB0aW1lOwogICAgICAgIGFkZHJlc3MgY2hhbmdlZEJ5OwogICAgfQoKICAgIFVzZFBlckV0aExvZ1tdIHB1YmxpYyB1c2RQZXJFdGhMb2c7IC8vIEhpc3Rvcnkgb2YgdXNlZCByYXRlcyBvZiBVU0QvRVRICgogICAgdWludDI1NiBwdWJsaWMgbWluSW52ZXN0Q2VudHMgPSAxOyAgICAgICAgICAgICAgLy8gQmVjYXVzZSAxIHRva2VuID0gMSBjZW50LgogICAgdWludDI1NiBwdWJsaWMgbWF4Q2FwSW5DZW50cyAgPSAxMCAqIDFlNiAqIDEwMDsgLy8gMTBtIFVTRCBpbiBjZW50cy4KCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlbnNQZXJDZW50cyA9IDEgKiAxZTE4OyAgICAgICAvLyBPcmRpbmFyeSBwcmljZSBpcyAxIHRva2VuID0gMSBVU0QgY2VudC4KICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1BlckNlbnRzRGF5T25lID0gMS4xICogMWUxODsKICAgIHVpbnQyNTYgcHVibGljIHRva2Vuc1BlckNlbnRzV2Vla09uZSA9IDEuMDUgKiAxZTE4OwoKICAgIC8vIFRPRE8gc2V0IHRvIGxhc3QgdmFsdWUgZnJvbSBTbm92V2hpdGVsaXN0IGNvbnRyYWN0LgogICAgdWludDI1NiBwdWJsaWMgdG90YWxJbkNlbnRzID0gNzE0ODE0MDA7IC8vIFRvdGFsIGFtb3VudCBvZiBVU0QgcmFpc2VkIGR1cmluZyB0aGlzIGNyb3dkc2FsZSBpbmNsdWRpbmcgKHdlaSAtPiBVU0QpICsgKGV4dGVybmFsIHR4cyBpbiBVU0QpLgoKICAgIC8vIFN0YXRzIGZvciBjdXJyZW50IGNyb3dkc2FsZQogICAgdWludDI1NiBwdWJsaWMgdG90YWxXZWlSZWNlaXZlZCA9IDA7ICAgLy8gVG90YWwgYW1vdW50IG9mIHdlaSByZWNlaXZlZCBkdXJpbmcgdGhpcyBjcm93ZHNhbGUgc21hcnQgY29udHJhY3QuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFRva2Vuc1NvbGQgPSAwOyAgICAvLyBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIHNvbGQgZHVyaW5nIHRoaXMgY3Jvd2RzYWxlLgogICAgdWludDI1NiBwdWJsaWMgdG90YWxFdGhTYWxlcyA9IDA7ICAgICAgLy8gVG90YWwgYW1vdW50IG9mIEVUSCBjb250cmlidXRpb25zIGR1cmluZyB0aGlzIGNyb3dkc2FsZS4KICAgIHVpbnQyNTYgcHVibGljIHRvdGFsRXh0ZXJuYWxTYWxlcyA9IDA7IC8vIFRvdGFsIGFtb3VudCBvZiBleHRlcm5hbCBjb250cmlidXRpb25zIChVU0QsIEJUQywgZXRjLikgZHVyaW5nIHRoaXMgY3Jvd2RzYWxlLgoKICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZSA9IDE1MDk0NTEyMDA7IC8vIDIwMTctMTAtMzEgMTI6MDA6MDBaCiAgICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lICAgPSAxNTEyMDQzMjAwOyAvLyAyMDE3LTExLTMwIDEyOjAwOjAwWgoKICAgIC8vIFVzZSBpbiBib251c2VzOgogICAgdWludDI1NiBvbmVEYXlUaW1lICAgICAgID0gMTUwOTUzNzYwMDsgLy8gMjAxNy0xMS0wMSAxMjowMDowMFoKICAgIHVpbnQyNTYgb25lV2Vla1RpbWUgICAgICA9IDE1MTAwNTYwMDA7IC8vIDIwMTctMTEtMDcgMTI6MDA6MDBaCgogICAgdWludDI1NiBwdWJsaWMgZmluYWxpemVkVGltZSA9IDA7ICAgICAgLy8gVW5peCB0aW1lc3RhbXAgd2hlbiBmaW5hbGl6ZSgpIHdhcyBjYWxsZWQuCgogICAgYm9vbCBwdWJsaWMgc2FsZUVuYWJsZWQgPSB0cnVlOyAgICAgICAvLyBpZiB0cnVlLCB0aGVuIGNvbnRyYWN0IHdpbGwgbm90IHNlbGwgdG9rZW5zIG9uIHBheW1lbnQgcmVjZWl2ZWQKCiAgICBldmVudCBCZW5lZmljaWFyeUNoYW5nZWQoYWRkcmVzcyBpbmRleGVkIF9vbGRBZGRyZXNzLCBhZGRyZXNzIGluZGV4ZWQgX25ld0FkZHJlc3MpOwogICAgZXZlbnQgTm90aWZpZXJDaGFuZ2VkKGFkZHJlc3MgaW5kZXhlZCBfb2xkQWRkcmVzcywgYWRkcmVzcyBpbmRleGVkIF9uZXdBZGRyZXNzKTsKICAgIGV2ZW50IFVzZFBlckV0aENoYW5nZWQodWludDI1NiBfb2xkUmF0ZSwgdWludDI1NiBfbmV3UmF0ZSk7CgogICAgZXZlbnQgRXRoUmVjZWl2ZWQoYWRkcmVzcyBpbmRleGVkIF9idXllciwgdWludDI1NiBfYW1vdW50SW5XZWkpOwogICAgZXZlbnQgRXh0ZXJuYWxTYWxlKEN1cnJlbmN5IF9jdXJyZW5jeSwgc3RyaW5nIF90eEhhc2gsIGFkZHJlc3MgaW5kZXhlZCBfYnV5ZXIsIHVpbnQyNTYgX2Ftb3VudEluQ2VudHMsIHVpbnQyNTYgX3Rva2Vuc0UxOCk7CgogICAgbW9kaWZpZXIgcmVzcGVjdFRpbWVGcmFtZSgpIHsKICAgICAgICByZXF1aXJlKGlzU2FsZU9uKCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY2FuTm90aWZ5KCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lciB8fCBtc2cuc2VuZGVyID09IG5vdGlmaWVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIEJzQ3Jvd2RzYWxlKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfdXNkUGVyRXRoKSB7CiAgICAgICAgdG9rZW4gPSBCc1Rva2VuKF90b2tlbik7CgogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBub3RpZmllciA9IDB4NzNFNUIxMjAxN0ExNDFkNDFjMWExNEZkYUI0M2E1NEE0ZjlCRDQ5MDsKICAgICAgICBiZW5lZmljaWFyeSA9IF9iZW5lZmljaWFyeTsKCiAgICAgICAgc2V0VXNkUGVyRXRoKF91c2RQZXJFdGgpOwogICAgfQoKICAgIC8vIE92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIG1vY2sgY3VycmVudCB0aW1lLgogICAgZnVuY3Rpb24gZ2V0Tm93KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNhbGVFbmFibGVkKGJvb2wgX2VuYWJsZWQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHNhbGVFbmFibGVkID0gX2VuYWJsZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QmVuZWZpY2lhcnkoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIEJlbmVmaWNpYXJ5Q2hhbmdlZChiZW5lZmljaWFyeSwgX2JlbmVmaWNpYXJ5KTsKICAgICAgICBiZW5lZmljaWFyeSA9IF9iZW5lZmljaWFyeTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXROb3RpZmllcihhZGRyZXNzIF9ub3RpZmllcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgTm90aWZpZXJDaGFuZ2VkKG5vdGlmaWVyLCBfbm90aWZpZXIpOwogICAgICAgIG5vdGlmaWVyID0gX25vdGlmaWVyOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFVzZFBlckV0aCh1aW50MjU2IF91c2RQZXJFdGgpIHB1YmxpYyBjYW5Ob3RpZnkgewogICAgICAgIGlmIChfdXNkUGVyRXRoIDwgdXNkUGVyRXRoTWluIHx8IF91c2RQZXJFdGggPiB1c2RQZXJFdGhNYXgpIHRocm93OwoKICAgICAgICBVc2RQZXJFdGhDaGFuZ2VkKHVzZFBlckV0aCwgX3VzZFBlckV0aCk7CiAgICAgICAgdXNkUGVyRXRoID0gX3VzZFBlckV0aDsKICAgICAgICB1c2RQZXJFdGhMb2cucHVzaChVc2RQZXJFdGhMb2coeyByYXRlOiB1c2RQZXJFdGgsIHRpbWU6IGdldE5vdygpLCBjaGFuZ2VkQnk6IG1zZy5zZW5kZXIgfSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVzZFBlckV0aExvZ1NpemUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB1c2RQZXJFdGhMb2cubGVuZ3RoOwogICAgfQoKICAgIC8qCiAgICAgKiBUaGUgZmFsbGJhY2sgZnVuY3Rpb24gY29ycmVzcG9uZHMgdG8gYSBkb25hdGlvbiBpbiBFVEgKICAgICAqLwogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgaWYgKHNhbGVFbmFibGVkKSBzZWxsVG9rZW5zRm9yRXRoKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsbFRva2Vuc0ZvckV0aChhZGRyZXNzIF9idXllciwgdWludDI1NiBfYW1vdW50SW5XZWkpIGludGVybmFsIGlmTm90UGF1c2VkIHJlc3BlY3RUaW1lRnJhbWUgewoKICAgICAgICB1aW50MjU2IGFtb3VudEluQ2VudHMgPSB3ZWlUb0NlbnRzKF9hbW91bnRJbldlaSk7CiAgICAgICAgcmVxdWlyZShhbW91bnRJbkNlbnRzID49IG1pbkludmVzdENlbnRzKTsKCiAgICAgICAgdG90YWxJbkNlbnRzID0gc2FmZUFkZCh0b3RhbEluQ2VudHMsIGFtb3VudEluQ2VudHMpOwogICAgICAgIHJlcXVpcmUodG90YWxJbkNlbnRzIDw9IG1heENhcEluQ2VudHMpOyAvLyBJZiBtYXggY2FwIHJlYWNoZWQuCgogICAgICAgIHVpbnQyNTYgdG9rZW5zU29sZCA9IGNlbnRzVG9Ub2tlbnMoYW1vdW50SW5DZW50cyk7CiAgICAgICAgcmVxdWlyZSh0b2tlbi5zZWxsKF9idXllciwgdG9rZW5zU29sZCkpOyAvLyBUcmFuc2ZlciB0b2tlbnMgdG8gYnV5ZXIuCgogICAgICAgIHRvdGFsV2VpUmVjZWl2ZWQgPSBzYWZlQWRkKHRvdGFsV2VpUmVjZWl2ZWQsIF9hbW91bnRJbldlaSk7CiAgICAgICAgdG90YWxUb2tlbnNTb2xkID0gc2FmZUFkZCh0b3RhbFRva2Vuc1NvbGQsIHRva2Vuc1NvbGQpOwogICAgICAgIHRvdGFsRXRoU2FsZXMrKzsKCiAgICAgICAgQmFja2VyIGJhY2tlciA9IGJhY2tlcnNbX2J1eWVyXTsKICAgICAgICBiYWNrZXIudG9rZW5zU2VudCA9IHNhZmVBZGQoYmFja2VyLnRva2Vuc1NlbnQsIHRva2Vuc1NvbGQpOwogICAgICAgIGJhY2tlci53ZWlSZWNlaXZlZCA9IHNhZmVBZGQoYmFja2VyLndlaVJlY2VpdmVkLCBfYW1vdW50SW5XZWkpOyAgLy8gVXBkYXRlIHRoZSB0b3RhbCB3ZWkgY29sbGVjdGVkIGR1cmluZyB0aGUgY3Jvd2RmdW5kaW5nIGZvciB0aGlzIGJhY2tlcgoKICAgICAgICBFdGhSZWNlaXZlZChfYnV5ZXIsIF9hbW91bnRJbldlaSk7CiAgICB9CgogICAgZnVuY3Rpb24gd2VpVG9DZW50cyh1aW50MjU2IF9hbW91bnRJbldlaSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc2FmZURpdihzYWZlTXVsKF9hbW91bnRJbldlaSwgdXNkUGVyRXRoICogMTAwKSwgMSBldGhlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2VudHNUb1Rva2Vucyh1aW50MjU2IF9hbW91bnRJbkNlbnRzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgcmF0ZSA9IHRva2Vuc1BlckNlbnRzOwogICAgICAgIHVpbnQgX25vdyA9IGdldE5vdygpOwoKICAgICAgICBpZiAoc3RhcnRUaW1lIDw9IF9ub3cgJiYgX25vdyA8IG9uZURheVRpbWUpIHJhdGUgPSB0b2tlbnNQZXJDZW50c0RheU9uZTsKICAgICAgICBlbHNlIGlmIChvbmVEYXlUaW1lIDw9IF9ub3cgJiYgX25vdyA8IG9uZVdlZWtUaW1lKSByYXRlID0gdG9rZW5zUGVyQ2VudHNXZWVrT25lOwoKICAgICAgICByZXR1cm4gc2FmZU11bChfYW1vdW50SW5DZW50cywgcmF0ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZXh0ZXJuYWxTYWxlKAogICAgICAgIEN1cnJlbmN5IF9jdXJyZW5jeSwKICAgICAgICBzdHJpbmcgX3R4SGFzaCwKICAgICAgICBhZGRyZXNzIF9idXllciwKICAgICAgICB1aW50MjU2IF9hbW91bnRJbkNlbnRzLAogICAgICAgIHVpbnQyNTYgX3Rva2Vuc0UxOAogICAgKSBpbnRlcm5hbCBpZk5vdFBhdXNlZCBjYW5Ob3RpZnkgewoKICAgICAgICByZXF1aXJlKF9idXllciA+IDAgJiYgX2Ftb3VudEluQ2VudHMgPiAwICYmIF90b2tlbnNFMTggPiAwKTsKCiAgICAgICAgdmFyIHR4c0J5Q3VyID0gZXh0ZXJuYWxUeHNbdWludChfY3VycmVuY3kpXTsKICAgICAgICBieXRlczMyIHR4S2V5ID0ga2VjY2FrMjU2KF90eEhhc2gpOwoKICAgICAgICAvLyBJZiB0aGlzIGZvcmVpZ24gdHJhbnNhY3Rpb24gaGFzIGJlZW4gYWxyZWFkeSBwcm9jZXNzZWQgaW4gdGhpcyBjb250cmFjdC4KICAgICAgICByZXF1aXJlKHR4c0J5Q3VyW3R4S2V5XSA9PSAwKTsKCiAgICAgICAgdG90YWxJbkNlbnRzID0gc2FmZUFkZCh0b3RhbEluQ2VudHMsIF9hbW91bnRJbkNlbnRzKTsKICAgICAgICByZXF1aXJlKHRvdGFsSW5DZW50cyA8IG1heENhcEluQ2VudHMpOyAvLyBNYXggY2FwIHNob3VsZCBub3QgYmUgcmVhY2hlZCB5ZXQuCgogICAgICAgIHJlcXVpcmUodG9rZW4uc2VsbChfYnV5ZXIsIF90b2tlbnNFMTgpKTsgLy8gVHJhbnNmZXIgdG9rZW5zIHRvIGJ1eWVyLgoKICAgICAgICB0b3RhbFRva2Vuc1NvbGQgPSBzYWZlQWRkKHRvdGFsVG9rZW5zU29sZCwgX3Rva2Vuc0UxOCk7CiAgICAgICAgdG90YWxFeHRlcm5hbFNhbGVzKys7CgogICAgICAgIHR4c0J5Q3VyW3R4S2V5XSA9IF90b2tlbnNFMTg7CiAgICAgICAgRXh0ZXJuYWxTYWxlKF9jdXJyZW5jeSwgX3R4SGFzaCwgX2J1eWVyLCBfYW1vdW50SW5DZW50cywgX3Rva2Vuc0UxOCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsbFRva2Vuc0ZvckJ0YyhzdHJpbmcgX3R4SGFzaCwgYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgX2Ftb3VudEluQ2VudHMsIHVpbnQyNTYgX3Rva2Vuc0UxOCkgcHVibGljIHsKICAgICAgICBleHRlcm5hbFNhbGUoQ3VycmVuY3kuQlRDLCBfdHhIYXNoLCBfYnV5ZXIsIF9hbW91bnRJbkNlbnRzLCBfdG9rZW5zRTE4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsVG9rZW5zRm9yTHRjKHN0cmluZyBfdHhIYXNoLCBhZGRyZXNzIF9idXllciwgdWludDI1NiBfYW1vdW50SW5DZW50cywgdWludDI1NiBfdG9rZW5zRTE4KSBwdWJsaWMgewogICAgICAgIGV4dGVybmFsU2FsZShDdXJyZW5jeS5MVEMsIF90eEhhc2gsIF9idXllciwgX2Ftb3VudEluQ2VudHMsIF90b2tlbnNFMTgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGxUb2tlbnNGb3JEYXNoKHN0cmluZyBfdHhIYXNoLCBhZGRyZXNzIF9idXllciwgdWludDI1NiBfYW1vdW50SW5DZW50cywgdWludDI1NiBfdG9rZW5zRTE4KSBwdWJsaWMgewogICAgICAgIGV4dGVybmFsU2FsZShDdXJyZW5jeS5EQVNILCBfdHhIYXNoLCBfYnV5ZXIsIF9hbW91bnRJbkNlbnRzLCBfdG9rZW5zRTE4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsVG9rZW5zRm9yWmVjKHN0cmluZyBfdHhIYXNoLCBhZGRyZXNzIF9idXllciwgdWludDI1NiBfYW1vdW50SW5DZW50cywgdWludDI1NiBfdG9rZW5zRTE4KSBwdWJsaWMgewogICAgICAgIGV4dGVybmFsU2FsZShDdXJyZW5jeS5aRUMsIF90eEhhc2gsIF9idXllciwgX2Ftb3VudEluQ2VudHMsIF90b2tlbnNFMTgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGxUb2tlbnNGb3JXYXZlcyhzdHJpbmcgX3R4SGFzaCwgYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgX2Ftb3VudEluQ2VudHMsIHVpbnQyNTYgX3Rva2Vuc0UxOCkgcHVibGljIHsKICAgICAgICBleHRlcm5hbFNhbGUoQ3VycmVuY3kuV0FWRVMsIF90eEhhc2gsIF9idXllciwgX2Ftb3VudEluQ2VudHMsIF90b2tlbnNFMTgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNlbGxUb2tlbnNGb3JVc2Qoc3RyaW5nIF90eEhhc2gsIGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IF9hbW91bnRJbkNlbnRzLCB1aW50MjU2IF90b2tlbnNFMTgpIHB1YmxpYyB7CiAgICAgICAgZXh0ZXJuYWxTYWxlKEN1cnJlbmN5LlVTRCwgX3R4SGFzaCwgX2J1eWVyLCBfYW1vdW50SW5DZW50cywgX3Rva2Vuc0UxOCk7CiAgICB9CgogICAgZnVuY3Rpb24gc2VsbFRva2Vuc0ZvckV1cihzdHJpbmcgX3R4SGFzaCwgYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgX2Ftb3VudEluQ2VudHMsIHVpbnQyNTYgX3Rva2Vuc0UxOCkgcHVibGljIHsKICAgICAgICBleHRlcm5hbFNhbGUoQ3VycmVuY3kuRVVSLCBfdHhIYXNoLCBfYnV5ZXIsIF9hbW91bnRJbkNlbnRzLCBfdG9rZW5zRTE4KTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b2tlbnNCeUV4dGVybmFsVHgoQ3VycmVuY3kgX2N1cnJlbmN5LCBzdHJpbmcgX3R4SGFzaCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBleHRlcm5hbFR4c1t1aW50KF9jdXJyZW5jeSldW2tlY2NhazI1NihfdHhIYXNoKV07CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5zQnlCdGNUeChzdHJpbmcgX3R4SGFzaCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG9rZW5zQnlFeHRlcm5hbFR4KEN1cnJlbmN5LkJUQywgX3R4SGFzaCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5zQnlMdGNUeChzdHJpbmcgX3R4SGFzaCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG9rZW5zQnlFeHRlcm5hbFR4KEN1cnJlbmN5LkxUQywgX3R4SGFzaCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5zQnlEYXNoVHgoc3RyaW5nIF90eEhhc2gpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRva2Vuc0J5RXh0ZXJuYWxUeChDdXJyZW5jeS5EQVNILCBfdHhIYXNoKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b2tlbnNCeVplY1R4KHN0cmluZyBfdHhIYXNoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiB0b2tlbnNCeUV4dGVybmFsVHgoQ3VycmVuY3kuWkVDLCBfdHhIYXNoKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b2tlbnNCeVdhdmVzVHgoc3RyaW5nIF90eEhhc2gpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRva2Vuc0J5RXh0ZXJuYWxUeChDdXJyZW5jeS5XQVZFUywgX3R4SGFzaCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5zQnlVc2RUeChzdHJpbmcgX3R4SGFzaCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG9rZW5zQnlFeHRlcm5hbFR4KEN1cnJlbmN5LlVTRCwgX3R4SGFzaCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5zQnlFdXJUeChzdHJpbmcgX3R4SGFzaCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG9rZW5zQnlFeHRlcm5hbFR4KEN1cnJlbmN5LkVVUiwgX3R4SGFzaCk7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxTYWxlcygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHNhZmVBZGQodG90YWxFdGhTYWxlcywgdG90YWxFeHRlcm5hbFNhbGVzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc01heENhcFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0b3RhbEluQ2VudHMgPj0gbWF4Q2FwSW5DZW50czsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1NhbGVPbigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludDI1NiBfbm93ID0gZ2V0Tm93KCk7CiAgICAgICAgcmV0dXJuIHN0YXJ0VGltZSA8PSBfbm93ICYmIF9ub3cgPD0gZW5kVGltZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1NhbGVPdmVyKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZ2V0Tm93KCkgPiBlbmRUaW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzRmluYWxpemVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZmluYWxpemVkVGltZSA+IDA7CiAgICB9CgogICAgLyoKICAgICAqIEZpbmFsaXplIHRoZSBjcm93ZHNhbGUuIFJhaXNlZCBtb25leSBjYW4gYmUgc2VudCB0byBiZW5lZmljaWFyeSBvbmx5IGlmIGNyb3dkc2FsZSBoaXQgZW5kIHRpbWUgb3IgbWF4IGNhcCAoMTVtIFVTRCkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIG9ubHlPd25lciB7CgogICAgICAgIC8vIENhbm5vdCBmaW5hbGlzZSBiZWZvcmUgZW5kIGRheSBvZiBjcm93ZHNhbGUgdW50aWwgbWF4IGNhcCBpcyByZWFjaGVkLgogICAgICAgIHJlcXVpcmUoaXNNYXhDYXBSZWFjaGVkKCkgfHwgaXNTYWxlT3ZlcigpKTsKCiAgICAgICAgYmVuZWZpY2lhcnkudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKCiAgICAgICAgZmluYWxpemVkVGltZSA9IGdldE5vdygpOwogICAgfQp9Cgpjb250cmFjdCBTbm92Q3Jvd2RzYWxlIGlzIEJzQ3Jvd2RzYWxlIHsKCiAgICBmdW5jdGlvbiBTbm92Q3Jvd2RzYWxlKCkgQnNDcm93ZHNhbGUoCiAgICAgICAgMHhCREM1YkFDMzlEYmUxMzJCMUUwMzBlODk4YUUzODMwMDE3RDdkOTY5LAogICAgICAgIDB4OTgzRjY0YTU1MENEOUQ3MzNmMjgyOTI3NWY5NEIxQTM3MjhGZTg4OCwKICAgICAgICAzMTAKICAgICkge30KfQ=='.
	

]
