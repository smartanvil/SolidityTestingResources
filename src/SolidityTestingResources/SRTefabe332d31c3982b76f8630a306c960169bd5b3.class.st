Class {
	#name : #SRTefabe332d31c3982b76f8630a306c960169bd5b3,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTefabe332d31c3982b76f8630a306c960169bd5b3 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKgogIGh0dHBzOi8vY3J5cHRvZ3MuaW8KICAtLUF1c3RpbiBUaG9tYXMgR3JpZmZpdGggZm9yIEVUSERlbnZlcgogICggUFMgdGhpcyBnYXMgZ3V6emxpbmcgYmVhc3QgaXMgc3RpbGwgdW5hdWRpdGVkICkKKi8KCgovL2FkYXB0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCi8vIHRoYW5rcyB0byBEaWV0ZXIgU2hpcmxleSAmJiBodHRwOi8vYXhpb216ZW4uY28KCmNvbnRyYWN0IE5GVCB7CgogIGZ1bmN0aW9uIE5GVCgpIHB1YmxpYyB7IH0KCiAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgdG9rZW5JbmRleFRvT3duZXI7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBvd25lcnNoaXBUb2tlbkNvdW50OwogIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHRva2VuSW5kZXhUb0FwcHJvdmVkOwoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90byx1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewogICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogIH0KICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CiAgICAgIHRva2VuSW5kZXhUb093bmVyW190b2tlbklkXSA9IF90bzsKICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX2Zyb21dLS07CiAgICAgICAgICBkZWxldGUgdG9rZW5JbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgICB9CiAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICB9CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQpOwoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSxhZGRyZXNzIF90byx1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICB9CgogIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgcmV0dXJuIHRva2VuSW5kZXhUb093bmVyW190b2tlbklkXSA9PSBfY2xhaW1hbnQ7CiAgfQogIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgIHJldHVybiB0b2tlbkluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogIH0KICBmdW5jdGlvbiBfYXBwcm92ZSh1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9hcHByb3ZlZCkgaW50ZXJuYWwgewogICAgICB0b2tlbkluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPSBfYXBwcm92ZWQ7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgX2FwcHJvdmUoX3Rva2VuSWQsIF90byk7CiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGNvdW50KSB7CiAgICAgIHJldHVybiBvd25lcnNoaXBUb2tlbkNvdW50W19vd25lcl07CiAgfQoKICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcikgewogICAgICBvd25lciA9IHRva2VuSW5kZXhUb093bmVyW190b2tlbklkXTsKICAgICAgcmVxdWlyZShvd25lciAhPSBhZGRyZXNzKDApKTsKICB9CgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICByZXR1cm4gX2FwcHJvdmVkRm9yKF9jbGFpbWFudCxfdG9rZW5JZCk7CiAgfQp9CgoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgoKY29udHJhY3QgQ3J5cHRvZ3MgaXMgTkZULCBPd25hYmxlIHsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQ3J5cHRvZ3MiOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiUE9HUyI7CgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBwdXJwb3NlID0gIkVUSERlbnZlciI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IGNvbnRhY3QgPSAiaHR0cHM6Ly9jcnlwdG9ncy5pbyI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IGF1dGhvciA9ICJBdXN0aW4gVGhvbWFzIEdyaWZmaXRoIjsKCiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgRkxJUFBJTkVTUyA9IDY0OwogICAgdWludDggcHVibGljIGNvbnN0YW50IEZMSVBQSU5FU1NST1VOREJPTlVTID0gMTY7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgVElNRU9VVEJMT0NLUyA9IDE4MDsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBCTE9DS1NVTlRJTENMRUFOVVBTVEFDSz0xOwoKICAgIHN0cmluZyBwdWJsaWMgaXBmczsKICAgIGZ1bmN0aW9uIHNldElwZnMoc3RyaW5nIF9pcGZzKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpewogICAgICBpcGZzPV9pcGZzOwogICAgICBJUEZTKGlwZnMpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGV2ZW50IElQRlMoc3RyaW5nIGlwZnMpOwoKICAgIGZ1bmN0aW9uIENyeXB0b2dzKCkgcHVibGljIHsKICAgICAgLy8wIGluZGV4IHNob3VsZCBiZSBhIGJsYW5rIGl0ZW0gb3duZWQgYnkgbm8gb25lCiAgICAgIEl0ZW0gbWVtb3J5IF9pdGVtID0gSXRlbSh7CiAgICAgICAgaW1hZ2U6ICIiCiAgICAgIH0pOwogICAgICBpdGVtcy5wdXNoKF9pdGVtKTsKICAgIH0KCiAgICBhZGRyZXNzIHB1YmxpYyBzbGFtbWVyVGltZTsKICAgIGZ1bmN0aW9uIHNldFNsYW1tZXJUaW1lKGFkZHJlc3MgX3NsYW1tZXJUaW1lKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpewogICAgICAvL2luIG9yZGVyIHRvIHRydXN0IHRoYXQgdGhpcyBjb250cmFjdCBpc24ndCBzZW5kaW5nIGEgcGxheWVyJ3MgdG9rZW5zCiAgICAgIC8vIHRvIGEgZGlmZmVyZW50IGNvbnRyYWN0LCB0aGUgc2xhbW1lcnRpbWUgY29udHJhY3QgaXMgc2V0IG9uY2UgYW5kCiAgICAgIC8vIG9ubHkgb25jZSAtLSBhdCBkZXBsb3kKICAgICAgcmVxdWlyZShzbGFtbWVyVGltZT09YWRkcmVzcygwKSk7CiAgICAgIHNsYW1tZXJUaW1lPV9zbGFtbWVyVGltZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgc3RydWN0IEl0ZW17CiAgICAgIGJ5dGVzMzIgaW1hZ2U7CiAgICAgIC8vcGVyaGFwcyBzb21lIGFyZSBoYXJkZXIgdG8gZmxpcCBvdmVyPwogICAgICAvL3BlcmhhcHMgc29tZSBoYXZlIG1hZ2ljYWwgbWV0YWRhdGE/CiAgICAgIC8vSSBkb24ndCBrbm93LCBpdCdzIGxhdGUgYW5kIEknbSB3ZWlyZAogICAgfQoKICAgIEl0ZW1bXSBwcml2YXRlIGl0ZW1zOwoKICAgIGZ1bmN0aW9uIG1pbnQoYnl0ZXMzMiBfaW1hZ2UsYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAodWludCl7CiAgICAgIHVpbnQyNTYgbmV3SWQgPSBfbWludChfaW1hZ2UpOwogICAgICBfdHJhbnNmZXIoMCwgX293bmVyLCBuZXdJZCk7CiAgICAgIE1pbnQoaXRlbXNbbmV3SWRdLmltYWdlLHRva2VuSW5kZXhUb093bmVyW25ld0lkXSxuZXdJZCk7CiAgICAgIHJldHVybiBuZXdJZDsKICAgIH0KICAgIGV2ZW50IE1pbnQoYnl0ZXMzMiBfaW1hZ2UsYWRkcmVzcyBfb3duZXIsdWludDI1NiBfaWQpOwoKICAgIGZ1bmN0aW9uIG1pbnRCYXRjaChieXRlczMyIF9pbWFnZTEsYnl0ZXMzMiBfaW1hZ2UyLGJ5dGVzMzIgX2ltYWdlMyxieXRlczMyIF9pbWFnZTQsYnl0ZXMzMiBfaW1hZ2U1LGFkZHJlc3MgX293bmVyKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpewogICAgICB1aW50MjU2IG5ld0lkID0gX21pbnQoX2ltYWdlMSk7CiAgICAgIF90cmFuc2ZlcigwLCBfb3duZXIsIG5ld0lkKTsKICAgICAgTWludChfaW1hZ2UxLHRva2VuSW5kZXhUb093bmVyW25ld0lkXSxuZXdJZCk7CiAgICAgIG5ld0lkPV9taW50KF9pbWFnZTIpOwogICAgICBfdHJhbnNmZXIoMCwgX293bmVyLCBuZXdJZCk7CiAgICAgIE1pbnQoX2ltYWdlMix0b2tlbkluZGV4VG9Pd25lcltuZXdJZF0sbmV3SWQpOwogICAgICBuZXdJZD1fbWludChfaW1hZ2UzKTsKICAgICAgX3RyYW5zZmVyKDAsIF9vd25lciwgbmV3SWQpOwogICAgICBNaW50KF9pbWFnZTMsdG9rZW5JbmRleFRvT3duZXJbbmV3SWRdLG5ld0lkKTsKICAgICAgbmV3SWQ9X21pbnQoX2ltYWdlNCk7CiAgICAgIF90cmFuc2ZlcigwLCBfb3duZXIsIG5ld0lkKTsKICAgICAgTWludChfaW1hZ2U0LHRva2VuSW5kZXhUb093bmVyW25ld0lkXSxuZXdJZCk7CiAgICAgIG5ld0lkPV9taW50KF9pbWFnZTUpOwogICAgICBfdHJhbnNmZXIoMCwgX293bmVyLCBuZXdJZCk7CiAgICAgIE1pbnQoX2ltYWdlNSx0b2tlbkluZGV4VG9Pd25lcltuZXdJZF0sbmV3SWQpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfbWludChieXRlczMyIF9pbWFnZSkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgIEl0ZW0gbWVtb3J5IF9pdGVtID0gSXRlbSh7CiAgICAgICAgaW1hZ2U6IF9pbWFnZQogICAgICB9KTsKICAgICAgdWludDI1NiBuZXdJZCA9IGl0ZW1zLnB1c2goX2l0ZW0pIC0gMTsKICAgICAgdG9rZW5zT2ZJbWFnZVtpdGVtc1tuZXdJZF0uaW1hZ2VdKys7CiAgICAgIHJldHVybiBuZXdJZDsKICAgIH0KCiAgICBQYWNrW10gcHJpdmF0ZSBwYWNrczsKICAgIHN0cnVjdCBQYWNrewogICAgICB1aW50MjU2WzEwXSB0b2tlbnM7CiAgICAgIHVpbnQyNTYgcHJpY2U7CiAgICB9CiAgICBmdW5jdGlvbiBtaW50UGFjayh1aW50MjU2IF9wcmljZSxieXRlczMyIF9pbWFnZTEsYnl0ZXMzMiBfaW1hZ2UyLGJ5dGVzMzIgX2ltYWdlMyxieXRlczMyIF9pbWFnZTQsYnl0ZXMzMiBfaW1hZ2U1LGJ5dGVzMzIgX2ltYWdlNixieXRlczMyIF9pbWFnZTcsYnl0ZXMzMiBfaW1hZ2U4LGJ5dGVzMzIgX2ltYWdlOSxieXRlczMyIF9pbWFnZTEwKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpewogICAgICB1aW50MjU2WzEwXSBtZW1vcnkgdG9rZW5zOwogICAgICB0b2tlbnNbMF0gPSBfbWludChfaW1hZ2UxKTsKICAgICAgdG9rZW5zWzFdID0gX21pbnQoX2ltYWdlMik7CiAgICAgIHRva2Vuc1syXSA9IF9taW50KF9pbWFnZTMpOwogICAgICB0b2tlbnNbM10gPSBfbWludChfaW1hZ2U0KTsKICAgICAgdG9rZW5zWzRdID0gX21pbnQoX2ltYWdlNSk7CiAgICAgIHRva2Vuc1s1XSA9IF9taW50KF9pbWFnZTYpOwogICAgICB0b2tlbnNbNl0gPSBfbWludChfaW1hZ2U3KTsKICAgICAgdG9rZW5zWzddID0gX21pbnQoX2ltYWdlOCk7CiAgICAgIHRva2Vuc1s4XSA9IF9taW50KF9pbWFnZTkpOwogICAgICB0b2tlbnNbOV0gPSBfbWludChfaW1hZ2UxMCk7CiAgICAgIFBhY2sgbWVtb3J5IF9wYWNrID0gUGFjayh7CiAgICAgICAgdG9rZW5zOiB0b2tlbnMsCiAgICAgICAgcHJpY2U6IF9wcmljZQogICAgICB9KTsKICAgICAgTWludFBhY2socGFja3MucHVzaChfcGFjaykgLSAxLCBfcHJpY2UsdG9rZW5zWzBdLHRva2Vuc1sxXSx0b2tlbnNbMl0sdG9rZW5zWzNdLHRva2Vuc1s0XSx0b2tlbnNbNV0sdG9rZW5zWzZdLHRva2Vuc1s3XSx0b2tlbnNbOF0sdG9rZW5zWzldKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBldmVudCBNaW50UGFjayh1aW50MjU2IHBhY2tJZCx1aW50MjU2IHByaWNlLHVpbnQyNTYgdG9rZW4xLHVpbnQyNTYgdG9rZW4yLHVpbnQyNTYgdG9rZW4zLHVpbnQyNTYgdG9rZW40LHVpbnQyNTYgdG9rZW41LHVpbnQyNTYgdG9rZW42LHVpbnQyNTYgdG9rZW43LHVpbnQyNTYgdG9rZW44LHVpbnQyNTYgdG9rZW45LHVpbnQyNTYgdG9rZW4xMCk7CgogICAgZnVuY3Rpb24gYnV5UGFjayh1aW50MjU2IHBhY2tJZCkgcHVibGljIHBheWFibGUgcmV0dXJucyAoYm9vbCkgewogICAgICAvL21ha2Ugc3VyZSBwYWNrIGlzIGZvciBzYWxlCiAgICAgIHJlcXVpcmUoIHBhY2tzW3BhY2tJZF0ucHJpY2UgPiAwICk7CiAgICAgIC8vbWFrZSBzdXJlIHRoZXkgc2VudCBpbiBlbm91Z2ggdmFsdWUKICAgICAgcmVxdWlyZSggbXNnLnZhbHVlID49IHBhY2tzW3BhY2tJZF0ucHJpY2UgKTsKICAgICAgLy9yaWdodCBhd2F5IHNldCBwcmljZSB0byAwIHRvIGF2b2lkIHNvbWUgc29ydCBvZiByZWVudHJhbmNlCiAgICAgIHBhY2tzW3BhY2tJZF0ucHJpY2U9MDsKICAgICAgLy9naXZlIHRva2VucyB0byBvd25lcgogICAgICBmb3IodWludDggaT0wO2k8MTA7aSsrKXsKICAgICAgICB0b2tlbkluZGV4VG9Pd25lcltwYWNrc1twYWNrSWRdLnRva2Vuc1tpXV09bXNnLnNlbmRlcjsKICAgICAgICBfdHJhbnNmZXIoMCwgbXNnLnNlbmRlciwgcGFja3NbcGFja0lkXS50b2tlbnNbaV0pOwogICAgICB9CiAgICAgIC8vY2xlYXIgdGhlIHByaWNlIHNvIGl0IGlzIG5vIGxvbmdlciBmb3Igc2FsZQogICAgICBkZWxldGUgcGFja3NbcGFja0lkXTsKICAgICAgQnV5UGFjayhtc2cuc2VuZGVyLHBhY2tJZCxtc2cudmFsdWUpOwogICAgfQogICAgZXZlbnQgQnV5UGFjayhhZGRyZXNzIHNlbmRlciwgdWludDI1NiBwYWNrSWQsIHVpbnQyNTYgcHJpY2UpOwoKICAgIC8vbGV0cyBrZWVwIGEgY291bnQgb2YgaG93IG1hbnkgb2YgYSBzcGVjaWZpYyBpbWFnZSBpcyBjcmVhdGVkIHRvbwogICAgLy90aGF0IHdpbGwgYWxsb3cgdXMgdG8gY2FsY3VsYXRlIHJhcml0eSBvbi1jaGFpbiBpZiB3ZSB3YW50CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbnNPZkltYWdlOwoKICAgIGZ1bmN0aW9uIGdldFRva2VuKHVpbnQyNTYgX2lkKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyLGJ5dGVzMzIgaW1hZ2UsdWludDI1NiBjb3BpZXMpIHsKICAgICAgaW1hZ2UgPSBpdGVtc1tfaWRdLmltYWdlOwogICAgICBjb3BpZXMgPSB0b2tlbnNPZkltYWdlW2ltYWdlXTsKICAgICAgcmV0dXJuICgKICAgICAgICB0b2tlbkluZGV4VG9Pd25lcltfaWRdLAogICAgICAgIGltYWdlLAogICAgICAgIGNvcGllcwogICAgICApOwogICAgfQoKICAgIHVpbnQyNTYgbm9uY2UgPSAwOwoKICAgIHN0cnVjdCBTdGFja3sKICAgICAgLy90aGlzIHdpbGwgYmUgYW4gYXJyYXkgb2YgaWRzIGJ1dCBmb3Igbm93IGp1c3QgZG9pbmcgb25lIGZvciBzaW1wbGljaXR5CiAgICAgIHVpbnQyNTZbNV0gaWRzOwogICAgICBhZGRyZXNzIG93bmVyOwogICAgICB1aW50MzIgYmxvY2s7CgogICAgfQoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gU3RhY2spIHB1YmxpYyBzdGFja3M7CiAgICBtYXBwaW5nIChieXRlczMyID0+IGJ5dGVzMzIpIHB1YmxpYyBzdGFja0NvdW50ZXI7CgogICAgZnVuY3Rpb24gc3RhY2tPd25lcihieXRlczMyIF9zdGFjaykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpIHsKICAgICAgcmV0dXJuIHN0YWNrc1tfc3RhY2tdLm93bmVyOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFN0YWNrKGJ5dGVzMzIgX3N0YWNrKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyBvd25lcix1aW50MzIgYmxvY2ssdWludDI1NiB0b2tlbjEsdWludDI1NiB0b2tlbjIsdWludDI1NiB0b2tlbjMsdWludDI1NiB0b2tlbjQsdWludDI1NiB0b2tlbjUpIHsKICAgICAgcmV0dXJuIChzdGFja3NbX3N0YWNrXS5vd25lcixzdGFja3NbX3N0YWNrXS5ibG9jayxzdGFja3NbX3N0YWNrXS5pZHNbMF0sc3RhY2tzW19zdGFja10uaWRzWzFdLHN0YWNrc1tfc3RhY2tdLmlkc1syXSxzdGFja3NbX3N0YWNrXS5pZHNbM10sc3RhY2tzW19zdGFja10uaWRzWzRdKTsKICAgIH0KCiAgICAvL3R4IDE6IG9mIGEgZ2FtZSwgcGxheWVyIG9uZSBhcHByb3ZlcyB0aGUgU2xhbW1lclRpbWUgY29udHJhY3QgdG8gdGFrZSB0aGVpciB0b2tlbnMKICAgIC8vdGhpcyB0cmlnZ2VycyBhbiBldmVudCB0byBicm9hZGNhc3QgdG8gb3RoZXIgcGxheWVycyB0aGF0IHRoZXJlIGlzIGFuIG9wZW4gY2hhbGxlbmdlCiAgICBmdW5jdGlvbiBzdWJtaXRTdGFjayh1aW50MjU2IF9pZCx1aW50MjU2IF9pZDIsdWludDI1NiBfaWQzLHVpbnQyNTYgX2lkNCx1aW50MjU2IF9pZDUsIGJvb2wgX3B1YmxpYykgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgLy9tYWtlIHN1cmUgc2xhbW1lclRpbWUgd2FzIHNldCBhdCBkZXBsb3kKICAgICAgcmVxdWlyZShzbGFtbWVyVGltZSE9YWRkcmVzcygwKSk7CiAgICAgIC8vdGhlIHNlbmRlciBtdXN0IG93biB0aGUgdG9rZW4KICAgICAgcmVxdWlyZSh0b2tlbkluZGV4VG9Pd25lcltfaWRdPT1tc2cuc2VuZGVyKTsKICAgICAgcmVxdWlyZSh0b2tlbkluZGV4VG9Pd25lcltfaWQyXT09bXNnLnNlbmRlcik7CiAgICAgIHJlcXVpcmUodG9rZW5JbmRleFRvT3duZXJbX2lkM109PW1zZy5zZW5kZXIpOwogICAgICByZXF1aXJlKHRva2VuSW5kZXhUb093bmVyW19pZDRdPT1tc2cuc2VuZGVyKTsKICAgICAgcmVxdWlyZSh0b2tlbkluZGV4VG9Pd25lcltfaWQ1XT09bXNnLnNlbmRlcik7CiAgICAgIC8vdGhleSBhcHByb3ZlIHRoZSBzbGFtbWVydGltZSBjb250cmFjdCB0byB0YWtlIHRoZSB0b2tlbiBhd2F5IGZyb20gdGhlbQogICAgICByZXF1aXJlKGFwcHJvdmUoc2xhbW1lclRpbWUsX2lkKSk7CiAgICAgIHJlcXVpcmUoYXBwcm92ZShzbGFtbWVyVGltZSxfaWQyKSk7CiAgICAgIHJlcXVpcmUoYXBwcm92ZShzbGFtbWVyVGltZSxfaWQzKSk7CiAgICAgIHJlcXVpcmUoYXBwcm92ZShzbGFtbWVyVGltZSxfaWQ0KSk7CiAgICAgIHJlcXVpcmUoYXBwcm92ZShzbGFtbWVyVGltZSxfaWQ1KSk7CgogICAgICBieXRlczMyIHN0YWNrID0ga2VjY2FrMjU2KG5vbmNlKyssbXNnLnNlbmRlcik7CiAgICAgIHVpbnQyNTZbNV0gbWVtb3J5IGlkcyA9IFtfaWQsX2lkMixfaWQzLF9pZDQsX2lkNV07CiAgICAgIHN0YWNrc1tzdGFja10gPSBTdGFjayhpZHMsbXNnLnNlbmRlcix1aW50MzIoYmxvY2subnVtYmVyKSk7CgogICAgICAvL3RoZSBldmVudCBpcyB0cmlnZ2VyZWQgdG8gdGhlIGZyb250ZW5kIHRvIGRpc3BsYXkgdGhlIHN0YWNrCiAgICAgIC8vdGhlIGZyb250ZW5kIHdpbGwgY2hlY2sgaWYgdGhleSB3YW50IGl0IHB1YmxpYyBvciBub3QKICAgICAgU3VibWl0U3RhY2sobXNnLnNlbmRlcixub3csc3RhY2ssX2lkLF9pZDIsX2lkMyxfaWQ0LF9pZDUsX3B1YmxpYyk7CiAgICB9CiAgICBldmVudCBTdWJtaXRTdGFjayhhZGRyZXNzIGluZGV4ZWQgX3NlbmRlcix1aW50MjU2IGluZGV4ZWQgdGltZXN0YW1wLGJ5dGVzMzIgaW5kZXhlZCBfc3RhY2ssdWludDI1NiBfdG9rZW4xLHVpbnQyNTYgX3Rva2VuMix1aW50MjU2IF90b2tlbjMsdWludDI1NiBfdG9rZW40LHVpbnQyNTYgX3Rva2VuNSxib29sIF9wdWJsaWMpOwoKICAgIC8vdHggMjogb2YgYSBnYW1lLCBwbGF5ZXIgdHdvIGFwcHJvdmVzIHRoZSBTbGFtbWVyVGltZSBjb250cmFjdCB0byB0YWtlIHRoZWlyIHRva2VucwogICAgLy90aGlzIHRyaWdnZXJzIGFuIGV2ZW50IHRvIGJyb2FkY2FzdCB0byBwbGF5ZXIgb25lIHRoYXQgdGhpcyBwbGF5ZXIgd2FudHMgdG8gcnVtYmxlCiAgICBmdW5jdGlvbiBzdWJtaXRDb3VudGVyU3RhY2soYnl0ZXMzMiBfc3RhY2ssIHVpbnQyNTYgX2lkLCB1aW50MjU2IF9pZDIsIHVpbnQyNTYgX2lkMywgdWludDI1NiBfaWQ0LCB1aW50MjU2IF9pZDUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgIC8vbWFrZSBzdXJlIHNsYW1tZXJUaW1lIHdhcyBzZXQgYXQgZGVwbG95CiAgICAgIHJlcXVpcmUoc2xhbW1lclRpbWUhPWFkZHJlc3MoMCkpOwogICAgICAvL3RoZSBzZW5kZXIgbXVzdCBvd24gdGhlIHRva2VuCiAgICAgIHJlcXVpcmUodG9rZW5JbmRleFRvT3duZXJbX2lkXT09bXNnLnNlbmRlcik7CiAgICAgIHJlcXVpcmUodG9rZW5JbmRleFRvT3duZXJbX2lkMl09PW1zZy5zZW5kZXIpOwogICAgICByZXF1aXJlKHRva2VuSW5kZXhUb093bmVyW19pZDNdPT1tc2cuc2VuZGVyKTsKICAgICAgcmVxdWlyZSh0b2tlbkluZGV4VG9Pd25lcltfaWQ0XT09bXNnLnNlbmRlcik7CiAgICAgIHJlcXVpcmUodG9rZW5JbmRleFRvT3duZXJbX2lkNV09PW1zZy5zZW5kZXIpOwogICAgICAvL3RoZXkgYXBwcm92ZSB0aGUgc2xhbW1lcnRpbWUgY29udHJhY3QgdG8gdGFrZSB0aGUgdG9rZW4gYXdheSBmcm9tIHRoZW0KICAgICAgcmVxdWlyZShhcHByb3ZlKHNsYW1tZXJUaW1lLF9pZCkpOwogICAgICByZXF1aXJlKGFwcHJvdmUoc2xhbW1lclRpbWUsX2lkMikpOwogICAgICByZXF1aXJlKGFwcHJvdmUoc2xhbW1lclRpbWUsX2lkMykpOwogICAgICByZXF1aXJlKGFwcHJvdmUoc2xhbW1lclRpbWUsX2lkNCkpOwogICAgICByZXF1aXJlKGFwcHJvdmUoc2xhbW1lclRpbWUsX2lkNSkpOwogICAgICAvL3N0b3AgcGxheWluZyB3aXRoIHlvdXJzZWxmCiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciE9c3RhY2tzW19zdGFja10ub3duZXIpOwoKICAgICAgYnl0ZXMzMiBjb3VudGVyc3RhY2sgPSBrZWNjYWsyNTYobm9uY2UrKyxtc2cuc2VuZGVyLF9pZCk7CiAgICAgIHVpbnQyNTZbNV0gbWVtb3J5IGlkcyA9IFtfaWQsX2lkMixfaWQzLF9pZDQsX2lkNV07CiAgICAgIHN0YWNrc1tjb3VudGVyc3RhY2tdID0gU3RhY2soaWRzLG1zZy5zZW5kZXIsdWludDMyKGJsb2NrLm51bWJlcikpOwogICAgICBzdGFja0NvdW50ZXJbY291bnRlcnN0YWNrXSA9IF9zdGFjazsKCiAgICAgIC8vdGhlIGV2ZW50IGlzIHRyaWdnZXJlZCB0byB0aGUgZnJvbnRlbmQgdG8gZGlzcGxheSB0aGUgc3RhY2sKICAgICAgLy90aGUgZnJvbnRlbmQgd2lsbCBjaGVjayBpZiB0aGV5IHdhbnQgaXQgcHVibGljIG9yIG5vdAogICAgICBDb3VudGVyU3RhY2sobXNnLnNlbmRlcixub3csX3N0YWNrLGNvdW50ZXJzdGFjayxfaWQsX2lkMixfaWQzLF9pZDQsX2lkNSk7CiAgICB9CiAgICBldmVudCBDb3VudGVyU3RhY2soYWRkcmVzcyBpbmRleGVkIF9zZW5kZXIsdWludDI1NiBpbmRleGVkIHRpbWVzdGFtcCxieXRlczMyIGluZGV4ZWQgX3N0YWNrLCBieXRlczMyIF9jb3VudGVyU3RhY2ssIHVpbnQyNTYgX3Rva2VuMSwgdWludDI1NiBfdG9rZW4yLCB1aW50MjU2IF90b2tlbjMsIHVpbnQyNTYgX3Rva2VuNCwgdWludDI1NiBfdG9rZW41KTsKCiAgICAvLyBpZiBzb21lb25lIGNyZWF0ZXMgYSBzdGFjayB0aGV5IHNob3VsZCBiZSBhYmxlIHRvIGNsZWFuIGl0IHVwCiAgICAvLyBpdHMgbm90IHJlYWxseSB0aGF0IGJpZyBvZiBhIGRlYWwgYmVjYXVzZSB3ZSB3aWxsIGhhdmUgYSB0aW1lb3V0CiAgICAvLyBpbiB0aGUgZnJvbnRlbnQsIGJ1dCBzdGlsbC4uLgogICAgZnVuY3Rpb24gY2FuY2VsU3RhY2soYnl0ZXMzMiBfc3RhY2spIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgIC8vaXQgbXVzdCBiZSB5b3VyIHN0YWNrCiAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09c3RhY2tzW19zdGFja10ub3duZXIpOwogICAgICAvL21ha2Ugc3VyZSB0aGVyZSBpcyBubyBtb2RlIHNldCB5ZXQKICAgICAgcmVxdWlyZShtb2RlW19zdGFja109PTApOwogICAgICAvL21ha2Ugc3VyZSB0aGV5IGFyZW4ndCB0cnlpbmcgdG8gY2FuY2VsIGEgY291bnRlcnN0YWNrIHVzaW5nIHRoaXMgZnVuY3Rpb24KICAgICAgcmVxdWlyZShzdGFja0NvdW50ZXJbX3N0YWNrXT09MHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7CgogICAgICBkZWxldGUgc3RhY2tzW19zdGFja107CgogICAgICBDYW5jZWxTdGFjayhtc2cuc2VuZGVyLG5vdyxfc3RhY2spOwogICAgfQogICAgZXZlbnQgQ2FuY2VsU3RhY2soYWRkcmVzcyBpbmRleGVkIF9zZW5kZXIsdWludDI1NiBpbmRleGVkIHRpbWVzdGFtcCxieXRlczMyIGluZGV4ZWQgX3N0YWNrKTsKCiAgICBmdW5jdGlvbiBjYW5jZWxDb3VudGVyU3RhY2soYnl0ZXMzMiBfc3RhY2ssYnl0ZXMzMiBfY291bnRlcnN0YWNrKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAvL2l0IG11c3QgYmUgeW91ciBzdGFjawogICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PXN0YWNrc1tfY291bnRlcnN0YWNrXS5vd25lcik7CiAgICAgIC8vdGhlIGNvdW50ZXIgbXVzdCBiZSBhIGNvdW50ZXIgb2Ygc3RhY2sgMQogICAgICByZXF1aXJlKHN0YWNrQ291bnRlcltfY291bnRlcnN0YWNrXT09X3N0YWNrKTsKICAgICAgLy9tYWtlIHN1cmUgdGhlcmUgaXMgbm8gbW9kZSBzZXQgeWV0CiAgICAgIHJlcXVpcmUobW9kZVtfc3RhY2tdPT0wKTsKCiAgICAgIGRlbGV0ZSBzdGFja3NbX2NvdW50ZXJzdGFja107CiAgICAgIGRlbGV0ZSBzdGFja0NvdW50ZXJbX2NvdW50ZXJzdGFja107CgogICAgICBDYW5jZWxDb3VudGVyU3RhY2sobXNnLnNlbmRlcixub3csX3N0YWNrLF9jb3VudGVyc3RhY2spOwogICAgfQogICAgZXZlbnQgQ2FuY2VsQ291bnRlclN0YWNrKGFkZHJlc3MgaW5kZXhlZCBfc2VuZGVyLHVpbnQyNTYgaW5kZXhlZCB0aW1lc3RhbXAsYnl0ZXMzMiBpbmRleGVkIF9zdGFjayxieXRlczMyIF9jb3VudGVyc3RhY2spOwoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYnl0ZXMzMikgcHVibGljIGNvdW50ZXJPZlN0YWNrOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50OCkgcHVibGljIG1vZGU7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQ4KSBwdWJsaWMgcm91bmQ7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQzMikgcHVibGljIGxhc3RCbG9jazsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDMyKSBwdWJsaWMgY29tbWl0QmxvY2s7CiAgICBtYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHB1YmxpYyBsYXN0QWN0b3I7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQyNTZbMTBdKSBwdWJsaWMgbWl4ZWRTdGFjazsKCiAgICAvL3R4IDM6IG9mIGEgZ2FtZSwgcGxheWVyIG9uZSBhcHByb3ZlcyBjb3VudGVyIHN0YWNrIGFuZCB0cmFuc2ZlcnMgZXZlcnl0aGluZyBpbgogICAgZnVuY3Rpb24gYWNjZXB0Q291bnRlclN0YWNrKGJ5dGVzMzIgX3N0YWNrLCBieXRlczMyIF9jb3VudGVyU3RhY2spIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgIC8vc2VuZGVyIG11c3QgYmUgb3duZXIgb2Ygc3RhY2sgMQogICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PXN0YWNrc1tfc3RhY2tdLm93bmVyKTsKICAgICAgLy90aGUgY291bnRlciBtdXN0IGJlIGEgY291bnRlciBvZiBzdGFjayAxCiAgICAgIHJlcXVpcmUoc3RhY2tDb3VudGVyW19jb3VudGVyU3RhY2tdPT1fc3RhY2spOwogICAgICAvL21ha2Ugc3VyZSB0aGVyZSBpcyBubyBtb2RlIHNldCB5ZXQKICAgICAgcmVxdWlyZShtb2RlW19zdGFja109PTApOwoKICAgICAgLy9kbyB0aGUgdHJhbnNmZXIKICAgICAgU2xhbW1lclRpbWUgc2xhbW1lclRpbWVDb250cmFjdCA9IFNsYW1tZXJUaW1lKHNsYW1tZXJUaW1lKTsKICAgICAgcmVxdWlyZSggc2xhbW1lclRpbWVDb250cmFjdC5zdGFydFNsYW1tZXJUaW1lKG1zZy5zZW5kZXIsc3RhY2tzW19zdGFja10uaWRzLHN0YWNrc1tfY291bnRlclN0YWNrXS5vd25lcixzdGFja3NbX2NvdW50ZXJTdGFja10uaWRzKSApOwoKICAgICAgLy9zYXZlIHRoZSBibG9jayBmb3IgYSB0aW1lb3V0CiAgICAgIGxhc3RCbG9ja1tfc3RhY2tdPXVpbnQzMihibG9jay5udW1iZXIpOwogICAgICBsYXN0QWN0b3JbX3N0YWNrXT1zdGFja3NbX2NvdW50ZXJTdGFja10ub3duZXI7CiAgICAgIG1vZGVbX3N0YWNrXT0xOwogICAgICBjb3VudGVyT2ZTdGFja1tfc3RhY2tdPV9jb3VudGVyU3RhY2s7CgogICAgICAvLy8vIExPTCBACiAgICAgIG1peGVkU3RhY2tbX3N0YWNrXVswXSA9IHN0YWNrc1tfc3RhY2tdLmlkc1swXTsKICAgICAgbWl4ZWRTdGFja1tfc3RhY2tdWzFdID0gc3RhY2tzW19jb3VudGVyU3RhY2tdLmlkc1swXTsKICAgICAgbWl4ZWRTdGFja1tfc3RhY2tdWzJdID0gc3RhY2tzW19zdGFja10uaWRzWzFdOwogICAgICBtaXhlZFN0YWNrW19zdGFja11bM10gPSBzdGFja3NbX2NvdW50ZXJTdGFja10uaWRzWzFdOwogICAgICBtaXhlZFN0YWNrW19zdGFja11bNF0gPSBzdGFja3NbX3N0YWNrXS5pZHNbMl07CiAgICAgIG1peGVkU3RhY2tbX3N0YWNrXVs1XSA9IHN0YWNrc1tfY291bnRlclN0YWNrXS5pZHNbMl07CiAgICAgIG1peGVkU3RhY2tbX3N0YWNrXVs2XSA9IHN0YWNrc1tfc3RhY2tdLmlkc1szXTsKICAgICAgbWl4ZWRTdGFja1tfc3RhY2tdWzddID0gc3RhY2tzW19jb3VudGVyU3RhY2tdLmlkc1szXTsKICAgICAgbWl4ZWRTdGFja1tfc3RhY2tdWzhdID0gc3RhY2tzW19zdGFja10uaWRzWzRdOwogICAgICBtaXhlZFN0YWNrW19zdGFja11bOV0gPSBzdGFja3NbX2NvdW50ZXJTdGFja10uaWRzWzRdOwoKICAgICAgLy9sZXQgdGhlIGZyb250IGVuZCBrbm93IHRoYXQgdGhlIHRyYW5zZmVyIGlzIGdvb2QgYW5kIHdlIGFyZSByZWFkeSBmb3IgdGhlIGNvaW4gZmxpcAogICAgICBBY2NlcHRDb3VudGVyU3RhY2sobXNnLnNlbmRlcixfc3RhY2ssX2NvdW50ZXJTdGFjayk7CiAgICB9CiAgICBldmVudCBBY2NlcHRDb3VudGVyU3RhY2soYWRkcmVzcyBpbmRleGVkIF9zZW5kZXIsYnl0ZXMzMiBpbmRleGVkIF9zdGFjaywgYnl0ZXMzMiBpbmRleGVkIF9jb3VudGVyU3RhY2spOwoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gYnl0ZXMzMikgcHVibGljIGNvbW1pdDsKCiAgICBmdW5jdGlvbiBnZXRNaXhlZFN0YWNrKGJ5dGVzMzIgX3N0YWNrKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nix1aW50MjU2LHVpbnQyNTYsdWludDI1Nil7CiAgICAgIHVpbnQyNTZbMTBdIHRoaXNTdGFjayA9IG1peGVkU3RhY2tbX3N0YWNrXTsKICAgICAgcmV0dXJuICh0aGlzU3RhY2tbMF0sdGhpc1N0YWNrWzFdLHRoaXNTdGFja1syXSx0aGlzU3RhY2tbM10sdGhpc1N0YWNrWzRdLHRoaXNTdGFja1s1XSx0aGlzU3RhY2tbNl0sdGhpc1N0YWNrWzddLHRoaXNTdGFja1s4XSx0aGlzU3RhY2tbOV0pOwogICAgfQoKICAgIC8vdHggNDogcGxheWVyIG9uZSBjb21taXRzIGFuZCBmbGlwcyBjb2luIHVwCiAgICAvL2F0IHRoaXMgcG9pbnQsIHRoZSB0aW1lb3V0IGdvZXMgaW50byBlZmZlY3QgYW5kIGlmIGFueSB0cmFuc2FjdGlvbiBpbmNsdWRpbmcKICAgIC8vdGhlIGNvaW4gZmxpcCBkb24ndCBjb21lIGJhY2sgaW4gdGltZSwgd2UgbmVlZCB0byBhbGxvdyB0aGUgb3RoZXIgcGFydHkKICAgIC8vdG8gd2l0aGRyYXcgYWxsIHRva2Vucy4uLiB0aGlzIGtlZXBzIGVpdGhlciBwbGF5ZXIgZnJvbSByZWZ1c2luZyB0bwogICAgLy9yZXZlYWwgdGhlaXIgY29tbWl0LiAoZXZlcnkgdHggZnJvbSBoZXJlIG9uIG91dCBuZWVkcyB0byB1cGRhdGUgdGhlIGxhc3RCbG9jayBhbmQgbGFzdEFjdG9yKQogICAgLy9hbmQgaW4gdGhlIHdpdGhkcmF3IGZ1bmN0aW9uIHlvdSBjaGVjayBjdXJyZW50YmxvY2stbGFzdEJsb2NrID4gdGltZW91dCA9IHJlZnVuZCB0byBsYXN0QWN0b3IKICAgIC8vYW5kIGJ5IHJlZnVuZCBJIG1lYW4gbGV0IHRoZW0gd2l0aGRyYXcgaWYgdGhleSB3YW50CiAgICAvL3dlIGNvdWxkIGV2ZW4gaGF2ZSBhIGxpdHRsZSB0aW1lciBvbiB0aGUgZnJvbnQgZW5kIHRoYXQgdGVsbHMgeW91IGhvdyBsb25nIHlvdXIgb3Bwb25uZXQgaGFzCiAgICAvL2JlZm9yZSB0aGV5IHdpbGwgZm9yZmV0CiAgICBmdW5jdGlvbiBzdGFydENvaW5GbGlwKGJ5dGVzMzIgX3N0YWNrLCBieXRlczMyIF9jb3VudGVyU3RhY2ssIGJ5dGVzMzIgX2NvbW1pdCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgLy9tYWtlIHN1cmUgaXQncyB0aGUgb3duZXIgb2YgdGhlIGZpcnN0IHN0YWNrIChwbGF5ZXIgb25lKSBkb2luZyB0aGUgZmxpcAogICAgICByZXF1aXJlKHN0YWNrc1tfc3RhY2tdLm93bmVyPT1tc2cuc2VuZGVyKTsKICAgICAgLy90aGUgY291bnRlciBtdXN0IGJlIGEgY291bnRlciBvZiBzdGFjayAxCiAgICAgIHJlcXVpcmUoc3RhY2tDb3VudGVyW19jb3VudGVyU3RhY2tdPT1fc3RhY2spOwogICAgICByZXF1aXJlKGNvdW50ZXJPZlN0YWNrW19zdGFja109PV9jb3VudGVyU3RhY2spOwogICAgICAvL21ha2Ugc3VyZSB0aGF0IHdlIGFyZSBpbiBtb2RlIDEKICAgICAgcmVxdWlyZShtb2RlW19zdGFja109PTEpOwogICAgICAvL3N0b3JlIHRoZSBjb21taXQgZm9yIHRoZSBuZXh0IHR4CiAgICAgIGNvbW1pdFtfc3RhY2tdPV9jb21taXQ7CiAgICAgIGNvbW1pdEJsb2NrW19zdGFja109dWludDMyKGJsb2NrLm51bWJlcik7CiAgICAgIC8vaW5jIHRoZSBtb2RlIHRvIDIKICAgICAgbW9kZVtfc3RhY2tdPTI7CiAgICAgIFN0YXJ0Q29pbkZsaXAoX3N0YWNrLF9jb21taXQpOwogICAgfQogICAgZXZlbnQgU3RhcnRDb2luRmxpcChieXRlczMyIHN0YWNrLCBieXRlczMyIGNvbW1pdCk7CgogICAgLy90eDU6IHBsYXllciBvbmUgZW5kcyBjb2luIGZsaXAgd2l0aCByZXZlYWwKICAgIGZ1bmN0aW9uIGVuZENvaW5GbGlwKGJ5dGVzMzIgX3N0YWNrLCBieXRlczMyIF9jb3VudGVyU3RhY2ssIGJ5dGVzMzIgX3JldmVhbCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgLy9tYWtlIHN1cmUgaXQncyB0aGUgb3duZXIgb2YgdGhlIGZpcnN0IHN0YWNrIChwbGF5ZXIgb25lKSBkb2luZyB0aGUgZmxpcAogICAgICByZXF1aXJlKHN0YWNrc1tfc3RhY2tdLm93bmVyPT1tc2cuc2VuZGVyKTsKICAgICAgLy90aGUgY291bnRlciBtdXN0IGJlIGEgY291bnRlciBvZiBzdGFjayAxCiAgICAgIHJlcXVpcmUoc3RhY2tDb3VudGVyW19jb3VudGVyU3RhY2tdPT1fc3RhY2spOwogICAgICByZXF1aXJlKGNvdW50ZXJPZlN0YWNrW19zdGFja109PV9jb3VudGVyU3RhY2spOwogICAgICAvL21ha2Ugc3VyZSB0aGF0IHdlIGFyZSBpbiBtb2RlIDIKICAgICAgcmVxdWlyZShtb2RlW19zdGFja109PTIpOwoKICAgICAgLy9tYWtlIHN1cmUgdGhhdCB3ZSBhcmUgb24gYSBsYXRlciBibG9jayB0aGFuIHRoZSBjb21taXQgYmxvY2sKICAgICAgcmVxdWlyZSh1aW50MzIoYmxvY2subnVtYmVyKT5jb21taXRCbG9ja1tfc3RhY2tdKTsKCiAgICAgIC8vbWFrZSBzdXJlIGhhc2ggb2YgcmV2ZWFsID09IGNvbW1pdAogICAgICBpZihrZWNjYWsyNTYoX3JldmVhbCkhPWNvbW1pdFtfc3RhY2tdKXsKICAgICAgICAvL2NvbW1pdC9yZXZlYWwgZmFpbGVkLi4gdGhpcyBjYW4gaGFwcGVuIGlmIHRoZXkKICAgICAgICAvL3JlbG9hZCwgc28gZG9uJ3QgcHVuaXNoLCBqdXN0IGdvIGJhY2sgdG8gdGhlCiAgICAgICAgLy9zdGFydCBvZiB0aGUgY29pbiBmbGlwIHN0YWdlCiAgICAgICAgbW9kZVtfc3RhY2tdPTE7CiAgICAgICAgQ29pbkZsaXBGYWlsKF9zdGFjayk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9ZWxzZXsKICAgICAgICAvL3N1Y2Nlc3NmdWwgY29pbiBmbGlwLCByZWFkeSB0byBnZXQgcmFuZG9tCiAgICAgICAgbW9kZVtfc3RhY2tdPTM7CiAgICAgICAgcm91bmRbX3N0YWNrXT0xOwogICAgICAgIGJ5dGVzMzIgcHNldWRvUmFuZG9tSGFzaCA9IGtlY2NhazI1NihfcmV2ZWFsLGJsb2NrLmJsb2NraGFzaChjb21taXRCbG9ja1tfc3RhY2tdKSk7CiAgICAgICAgaWYodWludDI1Nihwc2V1ZG9SYW5kb21IYXNoKSUyPT0wKXsKICAgICAgICAgIC8vcGxheWVyMSBnb2VzIGZpcnN0CiAgICAgICAgICBsYXN0QmxvY2tbX3N0YWNrXT11aW50MzIoYmxvY2subnVtYmVyKTsKICAgICAgICAgIGxhc3RBY3Rvcltfc3RhY2tdPXN0YWNrc1tfY291bnRlclN0YWNrXS5vd25lcjsKICAgICAgICAgIENvaW5GbGlwU3VjY2Vzcyhfc3RhY2ssc3RhY2tzW19zdGFja10ub3duZXIsdHJ1ZSk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAvL3BsYXllcjIgZ29lcyBmaXJzdAogICAgICAgICAgbGFzdEJsb2NrW19zdGFja109dWludDMyKGJsb2NrLm51bWJlcik7CiAgICAgICAgICBsYXN0QWN0b3JbX3N0YWNrXT1zdGFja3NbX3N0YWNrXS5vd25lcjsKICAgICAgICAgIENvaW5GbGlwU3VjY2Vzcyhfc3RhY2ssc3RhY2tzW19jb3VudGVyU3RhY2tdLm93bmVyLGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICB9CiAgICBldmVudCBDb2luRmxpcFN1Y2Nlc3MoYnl0ZXMzMiBpbmRleGVkIHN0YWNrLGFkZHJlc3Mgd2hvc1R1cm4sYm9vbCBoZWFkcyk7CiAgICBldmVudCBDb2luRmxpcEZhaWwoYnl0ZXMzMiBzdGFjayk7CgoKICAgIC8vdHg2IG5leHQgcGxheWVyIHJhaXNlcyBzbGFtbWVyCiAgICBmdW5jdGlvbiByYWlzZVNsYW1tZXIoYnl0ZXMzMiBfc3RhY2ssIGJ5dGVzMzIgX2NvdW50ZXJTdGFjaywgYnl0ZXMzMiBfY29tbWl0KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICBpZihsYXN0QWN0b3JbX3N0YWNrXT09c3RhY2tzW19zdGFja10ub3duZXIpewogICAgICAgIC8vaXQgaXMgcGxheWVyMidzIHR1cm4KICAgICAgICByZXF1aXJlKHN0YWNrc1tfY291bnRlclN0YWNrXS5vd25lcj09bXNnLnNlbmRlcik7CiAgICAgIH1lbHNlewogICAgICAgIC8vaXQgaXMgcGxheWVyMSdzIHR1cm4KICAgICAgICByZXF1aXJlKHN0YWNrc1tfc3RhY2tdLm93bmVyPT1tc2cuc2VuZGVyKTsKICAgICAgfQogICAgICAvL3RoZSBjb3VudGVyIG11c3QgYmUgYSBjb3VudGVyIG9mIHN0YWNrIDEKICAgICAgcmVxdWlyZShzdGFja0NvdW50ZXJbX2NvdW50ZXJTdGFja109PV9zdGFjayk7CiAgICAgIHJlcXVpcmUoY291bnRlck9mU3RhY2tbX3N0YWNrXT09X2NvdW50ZXJTdGFjayk7CiAgICAgIC8vbWFrZSBzdXJlIHRoYXQgd2UgYXJlIGluIG1vZGUgMwogICAgICByZXF1aXJlKG1vZGVbX3N0YWNrXT09Myk7CiAgICAgIC8vc3RvcmUgdGhlIGNvbW1pdCBmb3IgdGhlIG5leHQgdHgKICAgICAgY29tbWl0W19zdGFja109X2NvbW1pdDsKICAgICAgY29tbWl0QmxvY2tbX3N0YWNrXT11aW50MzIoYmxvY2subnVtYmVyKTsKICAgICAgLy9pbmMgdGhlIG1vZGUgdG8gMgogICAgICBtb2RlW19zdGFja109NDsKICAgICAgUmFpc2VTbGFtbWVyKF9zdGFjayxfY29tbWl0KTsKICAgIH0KICAgIGV2ZW50IFJhaXNlU2xhbW1lcihieXRlczMyIHN0YWNrLCBieXRlczMyIGNvbW1pdCk7CgoKICAgIC8vdHg3IHBsYXllciB0aHJvd3Mgc2xhbW1lcgogICAgZnVuY3Rpb24gdGhyb3dTbGFtbWVyKGJ5dGVzMzIgX3N0YWNrLCBieXRlczMyIF9jb3VudGVyU3RhY2ssIGJ5dGVzMzIgX3JldmVhbCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgaWYobGFzdEFjdG9yW19zdGFja109PXN0YWNrc1tfc3RhY2tdLm93bmVyKXsKICAgICAgICAvL2l0IGlzIHBsYXllcjIncyB0dXJuCiAgICAgICAgcmVxdWlyZShzdGFja3NbX2NvdW50ZXJTdGFja10ub3duZXI9PW1zZy5zZW5kZXIpOwogICAgICB9ZWxzZXsKICAgICAgICAvL2l0IGlzIHBsYXllcjEncyB0dXJuCiAgICAgICAgcmVxdWlyZShzdGFja3NbX3N0YWNrXS5vd25lcj09bXNnLnNlbmRlcik7CiAgICAgIH0KICAgICAgLy90aGUgY291bnRlciBtdXN0IGJlIGEgY291bnRlciBvZiBzdGFjayAxCiAgICAgIHJlcXVpcmUoc3RhY2tDb3VudGVyW19jb3VudGVyU3RhY2tdPT1fc3RhY2spOwogICAgICByZXF1aXJlKGNvdW50ZXJPZlN0YWNrW19zdGFja109PV9jb3VudGVyU3RhY2spOwogICAgICAvL21ha2Ugc3VyZSB0aGF0IHdlIGFyZSBpbiBtb2RlIDQKICAgICAgcmVxdWlyZShtb2RlW19zdGFja109PTQpOwoKICAgICAgLy9tYWtlIHN1cmUgdGhhdCB3ZSBhcmUgb24gYSBsYXRlciBibG9jayB0aGFuIHRoZSBjb21taXQgYmxvY2sKICAgICAgcmVxdWlyZSh1aW50MzIoYmxvY2subnVtYmVyKT5jb21taXRCbG9ja1tfc3RhY2tdKTsKCiAgICAgIHVpbnQyNTZbMTBdIG1lbW9yeSBmbGlwcGVkOwogICAgICBpZihrZWNjYWsyNTYoX3JldmVhbCkhPWNvbW1pdFtfc3RhY2tdKXsKICAgICAgICAvL2NvbW1pdC9yZXZlYWwgZmFpbGVkLi4gdGhpcyBjYW4gaGFwcGVuIGlmIHRoZXkKICAgICAgICAvL3JlbG9hZCwgc28gZG9uJ3QgcHVuaXNoLCBqdXN0IGdvIGJhY2sgdG8gdGhlCiAgICAgICAgLy9zdGFydCBvZiB0aGUgc2xhbW1lciByYWlzZQogICAgICAgIG1vZGVbX3N0YWNrXT0zOwogICAgICAgIHRocm93U2xhbW1lckV2ZW50KF9zdGFjayxtc2cuc2VuZGVyLGFkZHJlc3MoMCksZmxpcHBlZCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9ZWxzZXsKICAgICAgICAvL3N1Y2Nlc3NmdWwgc2xhbSEhISEhISEhISEhISBBdCB0aGlzIHBvaW50IEkgaGF2ZSBvZmZpY2lhbGx5IGJlZW4gYXdha2UgZm9yIDI0IGhvdXJzICEhISEhISEhISEKICAgICAgICBtb2RlW19zdGFja109MzsKCiAgICAgICAgYWRkcmVzcyBwcmV2aW91c0xhc3RBY3RvciA9IGxhc3RBY3Rvcltfc3RhY2tdOwoKICAgICAgICBieXRlczMyIHBzZXVkb1JhbmRvbUhhc2ggPSBrZWNjYWsyNTYoX3JldmVhbCxibG9jay5ibG9ja2hhc2goY29tbWl0QmxvY2tbX3N0YWNrXSkpOwogICAgICAgIC8vRGVidWcoX3JldmVhbCxibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpLHBzZXVkb1JhbmRvbUhhc2gpOwogICAgICAgIGlmKGxhc3RBY3Rvcltfc3RhY2tdPT1zdGFja3NbX3N0YWNrXS5vd25lcil7CiAgICAgICAgICAvL3BsYXllcjEgZ29lcyBuZXh0CiAgICAgICAgICBsYXN0QmxvY2tbX3N0YWNrXT11aW50MzIoYmxvY2subnVtYmVyKTsKICAgICAgICAgIGxhc3RBY3Rvcltfc3RhY2tdPXN0YWNrc1tfY291bnRlclN0YWNrXS5vd25lcjsKICAgICAgICB9ZWxzZXsKICAgICAgICAgIC8vcGxheWVyMiBnb2VzIG5leHQKICAgICAgICAgIGxhc3RCbG9ja1tfc3RhY2tdPXVpbnQzMihibG9jay5udW1iZXIpOwogICAgICAgICAgbGFzdEFjdG9yW19zdGFja109c3RhY2tzW19zdGFja10ub3duZXI7CiAgICAgICAgfQoKICAgICAgICAvL2xvb2sgdGhyb3VnaCB0aGUgc3RhY2sgb2YgcmVtYWluaW5nIHBvZ3MgYW5kIGNvbXBhcmUgdG8gYnl0ZSB0byBzZWUgaWYgbGVzcyB0aGFuIEZMSVBQSU5FU1MgYW5kIHRyYW5zZmVyIGJhY2sgdG8gY29ycmVjdCBvd25lcgogICAgICAgIC8vIG9oIG1hbiwgdGhhdCBzbWVsbHMgbGlrZSByZWVudHJhbmNlIC0tICBJIHRoaW5rIHRoZSBtb2RlIHdvdWxkIGFjdHVhbGx5IGJyZWFrIHRoYXQgcmlnaHQ/CiAgICAgICAgYm9vbCBkb25lPXRydWU7CiAgICAgICAgdWludDggcmFuZEluZGV4ID0gMDsKICAgICAgICBmb3IodWludDggaT0wO2k8MTA7aSsrKXsKICAgICAgICAgIGlmKG1peGVkU3RhY2tbX3N0YWNrXVtpXT4wKXsKICAgICAgICAgICAgLy90aGVyZSBpcyBzdGlsbCBhIHBvZyBoZXJlLCBjaGVjayBmb3IgZmxpcAogICAgICAgICAgICB1aW50OCB0aGlzRmxpcHBlciA9IHVpbnQ4KHBzZXVkb1JhbmRvbUhhc2hbcmFuZEluZGV4KytdKTsKICAgICAgICAgICAgLy9EZWJ1Z0ZsaXAocHNldWRvUmFuZG9tSGFzaCxpLHJhbmRJbmRleCx0aGlzRmxpcHBlcixGTElQUElORVNTKTsKICAgICAgICAgICAgaWYodGhpc0ZsaXBwZXI8KEZMSVBQSU5FU1Mrcm91bmRbX3N0YWNrXSpGTElQUElORVNTUk9VTkRCT05VUykpewogICAgICAgICAgICAgIC8vSVRTIEEgRkxJUCEKICAgICAgICAgICAgICAgdWludDI1NiB0ZW1wSWQgPSBtaXhlZFN0YWNrW19zdGFja11baV07CiAgICAgICAgICAgICAgIGZsaXBwZWRbaV09dGVtcElkOwogICAgICAgICAgICAgICBtaXhlZFN0YWNrW19zdGFja11baV09MDsKICAgICAgICAgICAgICAgU2xhbW1lclRpbWUgc2xhbW1lclRpbWVDb250cmFjdCA9IFNsYW1tZXJUaW1lKHNsYW1tZXJUaW1lKTsKICAgICAgICAgICAgICAgLy9yZXF1aXJlKCBzbGFtbWVyVGltZUNvbnRyYWN0LnRyYW5zZmVyQmFjayhtc2cuc2VuZGVyLHRlbXBJZCkgKTsKICAgICAgICAgICAgICAgc2xhbW1lclRpbWVDb250cmFjdC50cmFuc2ZlckJhY2sobXNnLnNlbmRlcix0ZW1wSWQpOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICBkb25lPWZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aHJvd1NsYW1tZXJFdmVudChfc3RhY2ssbXNnLnNlbmRlcixwcmV2aW91c0xhc3RBY3RvcixmbGlwcGVkKTsKCiAgICAgICAgaWYoZG9uZSl7CiAgICAgICAgICBGaW5pc2hHYW1lKF9zdGFjayk7CiAgICAgICAgICBtb2RlW19zdGFja109OTsKICAgICAgICAgIGRlbGV0ZSBtaXhlZFN0YWNrW19zdGFja107CiAgICAgICAgICBkZWxldGUgc3RhY2tzW19zdGFja107CiAgICAgICAgICBkZWxldGUgc3RhY2tDb3VudGVyW19jb3VudGVyU3RhY2tdOwogICAgICAgICAgZGVsZXRlIHN0YWNrc1tfY291bnRlclN0YWNrXTsKICAgICAgICAgIGRlbGV0ZSBsYXN0QmxvY2tbX3N0YWNrXTsKICAgICAgICAgIGRlbGV0ZSBsYXN0QWN0b3JbX3N0YWNrXTsKICAgICAgICAgIGRlbGV0ZSBjb3VudGVyT2ZTdGFja1tfc3RhY2tdOwogICAgICAgICAgZGVsZXRlIHJvdW5kW19zdGFja107CiAgICAgICAgICBkZWxldGUgY29tbWl0QmxvY2tbX3N0YWNrXTsKICAgICAgICAgIGRlbGV0ZSBjb21taXRbX3N0YWNrXTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgIHJvdW5kW19zdGFja10rKzsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICBldmVudCBUaHJvd1NsYW1tZXIoYnl0ZXMzMiBpbmRleGVkIHN0YWNrLCBhZGRyZXNzIGluZGV4ZWQgd2hvRG9uZUl0LCBhZGRyZXNzIGluZGV4ZWQgb3RoZXJQbGF5ZXIsIHVpbnQyNTYgdG9rZW4xRmxpcHBlZCwgdWludDI1NiB0b2tlbjJGbGlwcGVkLCB1aW50MjU2IHRva2VuM0ZsaXBwZWQsIHVpbnQyNTYgdG9rZW40RmxpcHBlZCwgdWludDI1NiB0b2tlbjVGbGlwcGVkLCB1aW50MjU2IHRva2VuNkZsaXBwZWQsIHVpbnQyNTYgdG9rZW43RmxpcHBlZCwgdWludDI1NiB0b2tlbjhGbGlwcGVkLCB1aW50MjU2IHRva2VuOUZsaXBwZWQsIHVpbnQyNTYgdG9rZW4xMEZsaXBwZWQpOwogICAgZXZlbnQgRmluaXNoR2FtZShieXRlczMyIHN0YWNrKTsKCiAgICBmdW5jdGlvbiB0aHJvd1NsYW1tZXJFdmVudChieXRlczMyIHN0YWNrLGFkZHJlc3Mgd2hvRG9uZUl0LGFkZHJlc3Mgb3RoZXJBY2NvdW50LCB1aW50MjU2WzEwXSBmbGlwQXJyYXkpIGludGVybmFsIHsKICAgICAgVGhyb3dTbGFtbWVyKHN0YWNrLHdob0RvbmVJdCxvdGhlckFjY291bnQsZmxpcEFycmF5WzBdLGZsaXBBcnJheVsxXSxmbGlwQXJyYXlbMl0sZmxpcEFycmF5WzNdLGZsaXBBcnJheVs0XSxmbGlwQXJyYXlbNV0sZmxpcEFycmF5WzZdLGZsaXBBcnJheVs3XSxmbGlwQXJyYXlbOF0sZmxpcEFycmF5WzldKTsKICAgIH0KCgogICAgZnVuY3Rpb24gZHJhaW5TdGFjayhieXRlczMyIF9zdGFjaywgYnl0ZXMzMiBfY291bnRlclN0YWNrKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAvL3RoaXMgZnVuY3Rpb24gaXMgZm9yIHRoZSBjYXNlIG9mIGEgdGltZW91dCBpbiB0aGUgY29tbWl0IC8gcmV2ZWFsCiAgICAgIC8vIGlmIGEgcGxheWVyIHJlYWxpemVzIHRoZXkgYXJlIGdvaW5nIHRvIGxvc2UsIHRoZXkgY2FuIHJlZnVzZSB0byByZXZlYWwKICAgICAgLy8gdGhlcmVmb3JlIHdlIG11c3QgaGF2ZSBhIHRpbWVvdXQgb2YgVElNRU9VVEJMT0NLUyBhbmQgaWYgdGhhdCB0aW1lIGlzIHJlYWNoZWQKICAgICAgLy8gdGhlIG90aGVyIHBsYXllciBjYW4gZ2V0IGluIGFuZCBkcmFpbiB0aGUgcmVtYWluaW5nIHRva2VucyBmcm9tIHRoZSBnYW1lCiAgICAgIHJlcXVpcmUoIHN0YWNrc1tfc3RhY2tdLm93bmVyPT1tc2cuc2VuZGVyIHx8IHN0YWNrc1tfY291bnRlclN0YWNrXS5vd25lcj09bXNnLnNlbmRlciApOwogICAgICAvL3RoZSBjb3VudGVyIG11c3QgYmUgYSBjb3VudGVyIG9mIHN0YWNrIDEKICAgICAgcmVxdWlyZSggc3RhY2tDb3VudGVyW19jb3VudGVyU3RhY2tdPT1fc3RhY2sgKTsKICAgICAgcmVxdWlyZSggY291bnRlck9mU3RhY2tbX3N0YWNrXT09X2NvdW50ZXJTdGFjayApOwogICAgICAvL3RoZSBiYWQgZ3V5IHNob3VsZG4ndCBiZSBhYmxlIHRvIGRyYWluCiAgICAgIHJlcXVpcmUoIGxhc3RBY3Rvcltfc3RhY2tdPT1tc2cuc2VuZGVyICk7CiAgICAgIC8vbXVzdCBiZSBhZnRlciB0aW1lb3V0IHBlcmlvZAogICAgICByZXF1aXJlKCBibG9jay5udW1iZXIgLSBsYXN0QmxvY2tbX3N0YWNrXSA+PSBUSU1FT1VUQkxPQ0tTKTsKICAgICAgLy9nYW1lIG11c3Qgc3RpbGwgYmUgZ29pbmcKICAgICAgcmVxdWlyZSggbW9kZVtfc3RhY2tdPDkgKTsKCiAgICAgIGZvcih1aW50OCBpPTA7aTwxMDtpKyspewogICAgICAgIGlmKG1peGVkU3RhY2tbX3N0YWNrXVtpXT4wKXsKICAgICAgICAgIHVpbnQyNTYgdGVtcElkID0gbWl4ZWRTdGFja1tfc3RhY2tdW2ldOwogICAgICAgICAgbWl4ZWRTdGFja1tfc3RhY2tdW2ldPTA7CiAgICAgICAgICBTbGFtbWVyVGltZSBzbGFtbWVyVGltZUNvbnRyYWN0ID0gU2xhbW1lclRpbWUoc2xhbW1lclRpbWUpOwogICAgICAgICAgc2xhbW1lclRpbWVDb250cmFjdC50cmFuc2ZlckJhY2sobXNnLnNlbmRlcix0ZW1wSWQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgRmluaXNoR2FtZShfc3RhY2spOwogICAgICBtb2RlW19zdGFja109OTsKCiAgICAgIGRlbGV0ZSBtaXhlZFN0YWNrW19zdGFja107CiAgICAgIGRlbGV0ZSBzdGFja3NbX3N0YWNrXTsKICAgICAgZGVsZXRlIHN0YWNrQ291bnRlcltfY291bnRlclN0YWNrXTsKICAgICAgZGVsZXRlIHN0YWNrc1tfY291bnRlclN0YWNrXTsKICAgICAgZGVsZXRlIGxhc3RCbG9ja1tfc3RhY2tdOwogICAgICBkZWxldGUgbGFzdEFjdG9yW19zdGFja107CiAgICAgIGRlbGV0ZSBjb3VudGVyT2ZTdGFja1tfc3RhY2tdOwogICAgICBkZWxldGUgcm91bmRbX3N0YWNrXTsKICAgICAgZGVsZXRlIGNvbW1pdEJsb2NrW19zdGFja107CiAgICAgIGRlbGV0ZSBjb21taXRbX3N0YWNrXTsKCiAgICAgIERyYWluU3RhY2soX3N0YWNrLF9jb3VudGVyU3RhY2ssbXNnLnNlbmRlcik7CiAgICB9CiAgICBldmVudCBEcmFpblN0YWNrKGJ5dGVzMzIgc3RhY2ssYnl0ZXMzMiBjb3VudGVyU3RhY2ssYWRkcmVzcyBzZW5kZXIpOwoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBpdGVtcy5sZW5ndGggLSAxOwogICAgfQoKICAgIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10pIHsKICAgICAgICB1aW50MjU2IHRva2VuQ291bnQgPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbCA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwogICAgICAgICAgICB1aW50MjU2IGlkOwogICAgICAgICAgICBmb3IgKGlkID0gMTsgaWQgPD0gdG90YWw7IGlkKyspIHsKICAgICAgICAgICAgICAgIGlmICh0b2tlbkluZGV4VG9Pd25lcltpZF0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IGlkOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gX2Ftb3VudCk7CiAgICAgIGFzc2VydChvd25lci5zZW5kKF9hbW91bnQpKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbihhZGRyZXNzIF90b2tlbix1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICBTdGFuZGFyZFRva2VuIHRva2VuID0gU3RhbmRhcmRUb2tlbihfdG9rZW4pOwogICAgICB0b2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLF9hbW91bnQpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy9hZGFwdGVkIGZyb20gRVJDLTY3NyBmcm9tIG15IGR1ZGUgU3RldmUgRWxsaXMgLSB0aGFua3MgbWFuIQogICAgZnVuY3Rpb24gdHJhbnNmZXJTdGFja0FuZENhbGwoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuMSwgdWludCBfdG9rZW4yLCB1aW50IF90b2tlbjMsIHVpbnQgX3Rva2VuNCwgdWludCBfdG9rZW41LCBieXRlczMyIF9kYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICB0cmFuc2ZlcihfdG8sIF90b2tlbjEpOwogICAgICB0cmFuc2ZlcihfdG8sIF90b2tlbjIpOwogICAgICB0cmFuc2ZlcihfdG8sIF90b2tlbjMpOwogICAgICB0cmFuc2ZlcihfdG8sIF90b2tlbjQpOwogICAgICB0cmFuc2ZlcihfdG8sIF90b2tlbjUpOwoKICAgICAgaWYgKGlzQ29udHJhY3QoX3RvKSkgewogICAgICAgIGNvbnRyYWN0RmFsbGJhY2soX3RvLF90b2tlbjEsX3Rva2VuMixfdG9rZW4zLF90b2tlbjQsX3Rva2VuNSxfZGF0YSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY29udHJhY3RGYWxsYmFjayhhZGRyZXNzIF90bywgdWludCBfdG9rZW4xLCB1aW50IF90b2tlbjIsIHVpbnQgX3Rva2VuMywgdWludCBfdG9rZW40LCB1aW50IF90b2tlbjUsIGJ5dGVzMzIgX2RhdGEpIHByaXZhdGUgewogICAgICBTdGFja1JlY2VpdmVyIHJlY2VpdmVyID0gU3RhY2tSZWNlaXZlcihfdG8pOwogICAgICByZWNlaXZlci5vblRyYW5zZmVyU3RhY2sobXNnLnNlbmRlcixfdG9rZW4xLF90b2tlbjIsX3Rva2VuMyxfdG9rZW40LF90b2tlbjUsX2RhdGEpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgcHJpdmF0ZSByZXR1cm5zIChib29sIGhhc0NvZGUpIHsKICAgICAgdWludCBsZW5ndGg7CiAgICAgIGFzc2VtYmx5IHsgbGVuZ3RoIDo9IGV4dGNvZGVzaXplKF9hZGRyKSB9CiAgICAgIHJldHVybiBsZW5ndGggPiAwOwogICAgfQoKfQoKY29udHJhY3QgU3RhY2tSZWNlaXZlciB7CiAgZnVuY3Rpb24gb25UcmFuc2ZlclN0YWNrKGFkZHJlc3MgX3NlbmRlciwgdWludCBfdG9rZW4xLCB1aW50IF90b2tlbjIsIHVpbnQgX3Rva2VuMywgdWludCBfdG9rZW40LCB1aW50IF90b2tlbjUsIGJ5dGVzMzIgX2RhdGEpOwp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIHsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7IH0KfQoKY29udHJhY3QgU2xhbW1lclRpbWUgewogIGZ1bmN0aW9uIHN0YXJ0U2xhbW1lclRpbWUoYWRkcmVzcyBfcGxheWVyMSx1aW50MjU2WzVdIF9pZDEsYWRkcmVzcyBfcGxheWVyMix1aW50MjU2WzVdIF9pZDIpIHB1YmxpYyByZXR1cm5zIChib29sKSB7IH0KICBmdW5jdGlvbiB0cmFuc2ZlckJhY2soYWRkcmVzcyBfdG9XaG9tLCB1aW50MjU2IF9pZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsgfQp9'.
	

]
