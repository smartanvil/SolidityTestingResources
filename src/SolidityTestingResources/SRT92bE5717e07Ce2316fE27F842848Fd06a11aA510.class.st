Class {
	#name : #SRT92bE5717e07Ce2316fE27F842848Fd06a11aA510,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT92bE5717e07Ce2316fE27F842848Fd06a11aA510 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgppbnRlcmZhY2UgQ29udmVyc2lvblJhdGVzSW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiByZWNvcmRJbWJhbGFuY2UoCiAgICAgICAgRVJDMjAgdG9rZW4sCiAgICAgICAgaW50IGJ1eUFtb3VudCwKICAgICAgICB1aW50IHJhdGVVcGRhdGVCbG9jaywKICAgICAgICB1aW50IGN1cnJlbnRCbG9jawogICAgKQogICAgICAgIHB1YmxpYzsKCiAgICBmdW5jdGlvbiBnZXRSYXRlKEVSQzIwIHRva2VuLCB1aW50IGN1cnJlbnRCbG9ja051bWJlciwgYm9vbCBidXksIHVpbnQgcXR5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwp9Cgpjb250cmFjdCBVdGlscyB7CgogICAgRVJDMjAgY29uc3RhbnQgaW50ZXJuYWwgRVRIX1RPS0VOX0FERFJFU1MgPSBFUkMyMCgweDAwZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZSk7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBQUkVDSVNJT04gPSAoMTAqKjE4KTsKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9RVFkgICA9ICgxMCoqMjgpOyAvLyAxMEIgdG9rZW5zCiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfUkFURSAgPSAoUFJFQ0lTSU9OICogMTAqKjYpOyAvLyB1cCB0byAxTSB0b2tlbnMgcGVyIEVUSAogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgTUFYX0RFQ0lNQUxTID0gMTg7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBFVEhfREVDSU1BTFMgPSAxODsKICAgIG1hcHBpbmcoYWRkcmVzcz0+dWludCkgaW50ZXJuYWwgZGVjaW1hbHM7CgogICAgZnVuY3Rpb24gc2V0RGVjaW1hbHMoRVJDMjAgdG9rZW4pIGludGVybmFsIHsKICAgICAgICBpZiAodG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpIGRlY2ltYWxzW3Rva2VuXSA9IEVUSF9ERUNJTUFMUzsKICAgICAgICBlbHNlIGRlY2ltYWxzW3Rva2VuXSA9IHRva2VuLmRlY2ltYWxzKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGVjaW1hbHMoRVJDMjAgdG9rZW4pIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKHRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTKSByZXR1cm4gRVRIX0RFQ0lNQUxTOyAvLyBzYXZlIHN0b3JhZ2UgYWNjZXNzCiAgICAgICAgdWludCB0b2tlbkRlY2ltYWxzID0gZGVjaW1hbHNbdG9rZW5dOwogICAgICAgIC8vIHRlY2huaWNhbGx5LCB0aGVyZSBtaWdodCBiZSB0b2tlbiB3aXRoIGRlY2ltYWxzIDAKICAgICAgICAvLyBtb3Jlb3ZlciwgdmVyeSBwb3NzaWJsZSB0aGF0IG9sZCB0b2tlbnMgaGF2ZSBkZWNpbWFscyAwCiAgICAgICAgLy8gdGhlc2UgdG9rZW5zIHdpbGwganVzdCBoYXZlIGhpZ2hlciBnYXMgZmVlcy4KICAgICAgICBpZih0b2tlbkRlY2ltYWxzID09IDApIHJldHVybiB0b2tlbi5kZWNpbWFscygpOwoKICAgICAgICByZXR1cm4gdG9rZW5EZWNpbWFsczsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjRHN0UXR5KHVpbnQgc3JjUXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShzcmNRdHkgPD0gTUFYX1FUWSk7CiAgICAgICAgcmVxdWlyZShyYXRlIDw9IE1BWF9SQVRFKTsKCiAgICAgICAgaWYgKGRzdERlY2ltYWxzID49IHNyY0RlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIHJldHVybiAoc3JjUXR5ICogcmF0ZSAqICgxMCoqKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpKSkgLyBQUkVDSVNJT047CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgcmV0dXJuIChzcmNRdHkgKiByYXRlKSAvIChQUkVDSVNJT04gKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjU3JjUXR5KHVpbnQgZHN0UXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShkc3RRdHkgPD0gTUFYX1FUWSk7CiAgICAgICAgcmVxdWlyZShyYXRlIDw9IE1BWF9SQVRFKTsKCiAgICAgICAgLy9zb3VyY2UgcXVhbnRpdHkgaXMgcm91bmRlZCB1cC4gdG8gYXZvaWQgZGVzdCBxdWFudGl0eSBiZWluZyB0b28gbG93LgogICAgICAgIHVpbnQgbnVtZXJhdG9yOwogICAgICAgIHVpbnQgZGVub21pbmF0b3I7CiAgICAgICAgaWYgKHNyY0RlY2ltYWxzID49IGRzdERlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIG51bWVyYXRvciA9IChQUkVDSVNJT04gKiBkc3RRdHkgKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgICAgICBkZW5vbWluYXRvciA9IHJhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgbnVtZXJhdG9yID0gKFBSRUNJU0lPTiAqIGRzdFF0eSk7CiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gKHJhdGUgKiAoMTAqKihkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKG51bWVyYXRvciArIGRlbm9taW5hdG9yIC0gMSkgLyBkZW5vbWluYXRvcjsgLy9hdm9pZCByb3VuZGluZyBkb3duIGVycm9ycwogICAgfQp9Cgpjb250cmFjdCBQZXJtaXNzaW9uR3JvdXBzIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbjsKICAgIGFkZHJlc3MgcHVibGljIHBlbmRpbmdBZG1pbjsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgaW50ZXJuYWwgb3BlcmF0b3JzOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBhbGVydGVyczsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBvcGVyYXRvcnNHcm91cDsKICAgIGFkZHJlc3NbXSBpbnRlcm5hbCBhbGVydGVyc0dyb3VwOwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBNQVhfR1JPVVBfU0laRSA9IDUwOwoKICAgIGZ1bmN0aW9uIFBlcm1pc3Npb25Hcm91cHMoKSBwdWJsaWMgewogICAgICAgIGFkbWluID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPcGVyYXRvcigpIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWxlcnRlcigpIHsKICAgICAgICByZXF1aXJlKGFsZXJ0ZXJzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9wZXJhdG9ycyAoKSBleHRlcm5hbCB2aWV3IHJldHVybnMoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG9wZXJhdG9yc0dyb3VwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFsZXJ0ZXJzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gYWxlcnRlcnNHcm91cDsKICAgIH0KCiAgICBldmVudCBUcmFuc2ZlckFkbWluUGVuZGluZyhhZGRyZXNzIHBlbmRpbmdBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBhZG1pbiB0byBzZXQgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzLgogICAgICogQHBhcmFtIG5ld0FkbWluIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBZG1pbihhZGRyZXNzIG5ld0FkbWluKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG5ld0FkbWluICE9IGFkZHJlc3MoMCkpOwogICAgICAgIFRyYW5zZmVyQWRtaW5QZW5kaW5nKHBlbmRpbmdBZG1pbik7CiAgICAgICAgcGVuZGluZ0FkbWluID0gbmV3QWRtaW47CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBhZG1pbiB0byBzZXQgdGhlIGFkbWluIGluIG9uZSB0eC4gVXNlZnVsIGluaXRpYWwgZGVwbG95bWVudC4KICAgICAqIEBwYXJhbSBuZXdBZG1pbiBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyQWRtaW5RdWlja2x5KGFkZHJlc3MgbmV3QWRtaW4pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUobmV3QWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgVHJhbnNmZXJBZG1pblBlbmRpbmcobmV3QWRtaW4pOwogICAgICAgIEFkbWluQ2xhaW1lZChuZXdBZG1pbiwgYWRtaW4pOwogICAgICAgIGFkbWluID0gbmV3QWRtaW47CiAgICB9CgogICAgZXZlbnQgQWRtaW5DbGFpbWVkKCBhZGRyZXNzIG5ld0FkbWluLCBhZGRyZXNzIHByZXZpb3VzQWRtaW4pOwoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgdGhlIHBlbmRpbmdBZG1pbiBhZGRyZXNzIHRvIGZpbmFsaXplIHRoZSBjaGFuZ2UgYWRtaW4gcHJvY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BZG1pbigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShwZW5kaW5nQWRtaW4gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgQWRtaW5DbGFpbWVkKHBlbmRpbmdBZG1pbiwgYWRtaW4pOwogICAgICAgIGFkbWluID0gcGVuZGluZ0FkbWluOwogICAgICAgIHBlbmRpbmdBZG1pbiA9IGFkZHJlc3MoMCk7CiAgICB9CgogICAgZXZlbnQgQWxlcnRlckFkZGVkIChhZGRyZXNzIG5ld0FsZXJ0ZXIsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZEFsZXJ0ZXIoYWRkcmVzcyBuZXdBbGVydGVyKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFhbGVydGVyc1tuZXdBbGVydGVyXSk7IC8vIHByZXZlbnQgZHVwbGljYXRlcy4KICAgICAgICByZXF1aXJlKGFsZXJ0ZXJzR3JvdXAubGVuZ3RoIDwgTUFYX0dST1VQX1NJWkUpOwoKICAgICAgICBBbGVydGVyQWRkZWQobmV3QWxlcnRlciwgdHJ1ZSk7CiAgICAgICAgYWxlcnRlcnNbbmV3QWxlcnRlcl0gPSB0cnVlOwogICAgICAgIGFsZXJ0ZXJzR3JvdXAucHVzaChuZXdBbGVydGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVBbGVydGVyIChhZGRyZXNzIGFsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbYWxlcnRlcl0pOwogICAgICAgIGFsZXJ0ZXJzW2FsZXJ0ZXJdID0gZmFsc2U7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsZXJ0ZXJzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKGFsZXJ0ZXJzR3JvdXBbaV0gPT0gYWxlcnRlcikgewogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cFtpXSA9IGFsZXJ0ZXJzR3JvdXBbYWxlcnRlcnNHcm91cC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIGFsZXJ0ZXJzR3JvdXAubGVuZ3RoLS07CiAgICAgICAgICAgICAgICBBbGVydGVyQWRkZWQoYWxlcnRlciwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZXZlbnQgT3BlcmF0b3JBZGRlZChhZGRyZXNzIG5ld09wZXJhdG9yLCBib29sIGlzQWRkKTsKCiAgICBmdW5jdGlvbiBhZGRPcGVyYXRvcihhZGRyZXNzIG5ld09wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKCFvcGVyYXRvcnNbbmV3T3BlcmF0b3JdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIHJlcXVpcmUob3BlcmF0b3JzR3JvdXAubGVuZ3RoIDwgTUFYX0dST1VQX1NJWkUpOwoKICAgICAgICBPcGVyYXRvckFkZGVkKG5ld09wZXJhdG9yLCB0cnVlKTsKICAgICAgICBvcGVyYXRvcnNbbmV3T3BlcmF0b3JdID0gdHJ1ZTsKICAgICAgICBvcGVyYXRvcnNHcm91cC5wdXNoKG5ld09wZXJhdG9yKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVPcGVyYXRvciAoYWRkcmVzcyBvcGVyYXRvcikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShvcGVyYXRvcnNbb3BlcmF0b3JdKTsKICAgICAgICBvcGVyYXRvcnNbb3BlcmF0b3JdID0gZmFsc2U7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG9wZXJhdG9yc0dyb3VwLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChvcGVyYXRvcnNHcm91cFtpXSA9PSBvcGVyYXRvcikgewogICAgICAgICAgICAgICAgb3BlcmF0b3JzR3JvdXBbaV0gPSBvcGVyYXRvcnNHcm91cFtvcGVyYXRvcnNHcm91cC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIG9wZXJhdG9yc0dyb3VwLmxlbmd0aCAtPSAxOwogICAgICAgICAgICAgICAgT3BlcmF0b3JBZGRlZChvcGVyYXRvciwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IFdpdGhkcmF3YWJsZSBpcyBQZXJtaXNzaW9uR3JvdXBzIHsKCiAgICBldmVudCBUb2tlbldpdGhkcmF3KEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pOwoKICAgIC8qKgogICAgICogQGRldiBXaXRoZHJhdyBhbGwgRVJDMjAgY29tcGF0aWJsZSB0b2tlbnMKICAgICAqIEBwYXJhbSB0b2tlbiBFUkMyMCBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbihFUkMyMCB0b2tlbiwgdWludCBhbW91bnQsIGFkZHJlc3Mgc2VuZFRvKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIoc2VuZFRvLCBhbW91bnQpKTsKICAgICAgICBUb2tlbldpdGhkcmF3KHRva2VuLCBhbW91bnQsIHNlbmRUbyk7CiAgICB9CgogICAgZXZlbnQgRXRoZXJXaXRoZHJhdyh1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pOwoKICAgIC8qKgogICAgICogQGRldiBXaXRoZHJhdyBFdGhlcnMKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcih1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgc2VuZFRvLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgRXRoZXJXaXRoZHJhdyhhbW91bnQsIHNlbmRUbyk7CiAgICB9Cn0KCmNvbnRyYWN0IFZvbHVtZUltYmFsYW5jZVJlY29yZGVyIGlzIFdpdGhkcmF3YWJsZSB7CgogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBTTElESU5HX1dJTkRPV19TSVpFID0gNTsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgUE9XXzJfNjQgPSAyICoqIDY0OwoKICAgIHN0cnVjdCBUb2tlbkNvbnRyb2xJbmZvIHsKICAgICAgICB1aW50IG1pbmltYWxSZWNvcmRSZXNvbHV0aW9uOyAvLyBjYW4gYmUgcm91Z2hseSAxIGNlbnQKICAgICAgICB1aW50IG1heFBlckJsb2NrSW1iYWxhbmNlOyAvLyBpbiB0d2VpIHJlc29sdXRpb24KICAgICAgICB1aW50IG1heFRvdGFsSW1iYWxhbmNlOyAvLyBtYXggdG90YWwgaW1iYWxhbmNlIChiZXR3ZWVuIHJhdGUgdXBkYXRlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBoYWx0aW5nIHRyYWRlCiAgICB9CgogICAgbWFwcGluZyhhZGRyZXNzID0+IFRva2VuQ29udHJvbEluZm8pIGludGVybmFsIHRva2VuQ29udHJvbEluZm87CgogICAgc3RydWN0IFRva2VuSW1iYWxhbmNlRGF0YSB7CiAgICAgICAgaW50ICBsYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICB1aW50IGxhc3RCbG9jazsKCiAgICAgICAgaW50ICB0b3RhbEJ1eVVuaXRzSW1iYWxhbmNlOwogICAgICAgIHVpbnQgbGFzdFJhdGVVcGRhdGVCbG9jazsKICAgIH0KCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyh1aW50PT51aW50KSkgcHVibGljIHRva2VuSW1iYWxhbmNlRGF0YTsKCiAgICBmdW5jdGlvbiBWb2x1bWVJbWJhbGFuY2VSZWNvcmRlcihhZGRyZXNzIF9hZG1pbikgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9hZG1pbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICBhZG1pbiA9IF9hZG1pbjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRUb2tlbkNvbnRyb2xJbmZvKAogICAgICAgIEVSQzIwIHRva2VuLAogICAgICAgIHVpbnQgbWluaW1hbFJlY29yZFJlc29sdXRpb24sCiAgICAgICAgdWludCBtYXhQZXJCbG9ja0ltYmFsYW5jZSwKICAgICAgICB1aW50IG1heFRvdGFsSW1iYWxhbmNlCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUFkbWluCiAgICB7CiAgICAgICAgdG9rZW5Db250cm9sSW5mb1t0b2tlbl0gPQogICAgICAgICAgICBUb2tlbkNvbnRyb2xJbmZvKAogICAgICAgICAgICAgICAgbWluaW1hbFJlY29yZFJlc29sdXRpb24sCiAgICAgICAgICAgICAgICBtYXhQZXJCbG9ja0ltYmFsYW5jZSwKICAgICAgICAgICAgICAgIG1heFRvdGFsSW1iYWxhbmNlCiAgICAgICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9rZW5Db250cm9sSW5mbyhFUkMyMCB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50LCB1aW50LCB1aW50KSB7CiAgICAgICAgcmV0dXJuICh0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5taW5pbWFsUmVjb3JkUmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgIHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1heFBlckJsb2NrSW1iYWxhbmNlLAogICAgICAgICAgICAgICAgdG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWF4VG90YWxJbWJhbGFuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEltYmFsYW5jZSgKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICBpbnQgYnV5QW1vdW50LAogICAgICAgIHVpbnQgcmF0ZVVwZGF0ZUJsb2NrLAogICAgICAgIHVpbnQgY3VycmVudEJsb2NrCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICB1aW50IGN1cnJlbnRCbG9ja0luZGV4ID0gY3VycmVudEJsb2NrICUgU0xJRElOR19XSU5ET1dfU0laRTsKICAgICAgICBpbnQgcmVjb3JkZWRCdXlBbW91bnQgPSBpbnQoYnV5QW1vdW50IC8gaW50KHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uKSk7CgogICAgICAgIGludCBwcmV2SW1iYWxhbmNlID0gMDsKCiAgICAgICAgVG9rZW5JbWJhbGFuY2VEYXRhIG1lbW9yeSBjdXJyZW50QmxvY2tEYXRhID0KICAgICAgICAgICAgZGVjb2RlVG9rZW5JbWJhbGFuY2VEYXRhKHRva2VuSW1iYWxhbmNlRGF0YVt0b2tlbl1bY3VycmVudEJsb2NrSW5kZXhdKTsKCiAgICAgICAgLy8gZmlyc3Qgc2NlbmFyaW8gLSB0aGlzIGlzIG5vdCB0aGUgZmlyc3QgdHggaW4gdGhlIGN1cnJlbnQgYmxvY2sKICAgICAgICBpZiAoY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2sgPT0gY3VycmVudEJsb2NrKSB7CiAgICAgICAgICAgIGlmICh1aW50KGN1cnJlbnRCbG9ja0RhdGEubGFzdFJhdGVVcGRhdGVCbG9jaykgPT0gcmF0ZVVwZGF0ZUJsb2NrKSB7CiAgICAgICAgICAgICAgICAvLyBqdXN0IGluY3JlYXNlIGltYmFsYW5jZQogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSArPSByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSArPSByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGltYmFsYW5jZSB3YXMgY2hhbmdlZCBpbiB0aGUgbWlkZGxlIG9mIHRoZSBibG9jawogICAgICAgICAgICAgICAgcHJldkltYmFsYW5jZSA9IGdldEltYmFsYW5jZUluUmFuZ2UodG9rZW4sIHJhdGVVcGRhdGVCbG9jaywgY3VycmVudEJsb2NrKTsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSA9IGludChwcmV2SW1iYWxhbmNlKSArIHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgICAgICAgICAgY3VycmVudEJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSArPSByZWNvcmRlZEJ1eUFtb3VudDsKICAgICAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdFJhdGVVcGRhdGVCbG9jayA9IHVpbnQocmF0ZVVwZGF0ZUJsb2NrKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGZpcnN0IHR4IGluIHRoZSBjdXJyZW50IGJsb2NrCiAgICAgICAgICAgIGludCBjdXJyZW50QmxvY2tJbWJhbGFuY2U7CiAgICAgICAgICAgIChwcmV2SW1iYWxhbmNlLCBjdXJyZW50QmxvY2tJbWJhbGFuY2UpID0gZ2V0SW1iYWxhbmNlU2luY2VSYXRlVXBkYXRlKHRva2VuLCByYXRlVXBkYXRlQmxvY2ssIGN1cnJlbnRCbG9jayk7CgogICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlID0gcmVjb3JkZWRCdXlBbW91bnQ7CiAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEubGFzdEJsb2NrID0gdWludChjdXJyZW50QmxvY2spOwogICAgICAgICAgICBjdXJyZW50QmxvY2tEYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgPSB1aW50KHJhdGVVcGRhdGVCbG9jayk7CiAgICAgICAgICAgIGN1cnJlbnRCbG9ja0RhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSA9IGludChwcmV2SW1iYWxhbmNlKSArIHJlY29yZGVkQnV5QW1vdW50OwogICAgICAgIH0KCiAgICAgICAgdG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVtjdXJyZW50QmxvY2tJbmRleF0gPSBlbmNvZGVUb2tlbkltYmFsYW5jZURhdGEoY3VycmVudEJsb2NrRGF0YSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0R2FyYmFnZVRvVm9sdW1lUmVjb3JkZXIoRVJDMjAgdG9rZW4pIGludGVybmFsIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBTTElESU5HX1dJTkRPV19TSVpFOyBpKyspIHsKICAgICAgICAgICAgdG9rZW5JbWJhbGFuY2VEYXRhW3Rva2VuXVtpXSA9IDB4MTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SW1iYWxhbmNlSW5SYW5nZShFUkMyMCB0b2tlbiwgdWludCBzdGFydEJsb2NrLCB1aW50IGVuZEJsb2NrKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoaW50IGJ1eUltYmFsYW5jZSkgewogICAgICAgIC8vIGNoZWNrIHRoZSBpbWJhbGFuY2UgaW4gdGhlIHNsaWRpbmcgd2luZG93CiAgICAgICAgcmVxdWlyZShzdGFydEJsb2NrIDw9IGVuZEJsb2NrKTsKCiAgICAgICAgYnV5SW1iYWxhbmNlID0gMDsKCiAgICAgICAgZm9yICh1aW50IHdpbmRvd0luZCA9IDA7IHdpbmRvd0luZCA8IFNMSURJTkdfV0lORE9XX1NJWkU7IHdpbmRvd0luZCsrKSB7CiAgICAgICAgICAgIFRva2VuSW1iYWxhbmNlRGF0YSBtZW1vcnkgcGVyQmxvY2tEYXRhID0gZGVjb2RlVG9rZW5JbWJhbGFuY2VEYXRhKHRva2VuSW1iYWxhbmNlRGF0YVt0b2tlbl1bd2luZG93SW5kXSk7CgogICAgICAgICAgICBpZiAocGVyQmxvY2tEYXRhLmxhc3RCbG9jayA8PSBlbmRCbG9jayAmJiBwZXJCbG9ja0RhdGEubGFzdEJsb2NrID49IHN0YXJ0QmxvY2spIHsKICAgICAgICAgICAgICAgIGJ1eUltYmFsYW5jZSArPSBpbnQocGVyQmxvY2tEYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJbWJhbGFuY2VTaW5jZVJhdGVVcGRhdGUoRVJDMjAgdG9rZW4sIHVpbnQgcmF0ZVVwZGF0ZUJsb2NrLCB1aW50IGN1cnJlbnRCbG9jaykKICAgICAgICBpbnRlcm5hbCB2aWV3CiAgICAgICAgcmV0dXJucyhpbnQgYnV5SW1iYWxhbmNlLCBpbnQgY3VycmVudEJsb2NrSW1iYWxhbmNlKQogICAgewogICAgICAgIGJ1eUltYmFsYW5jZSA9IDA7CiAgICAgICAgY3VycmVudEJsb2NrSW1iYWxhbmNlID0gMDsKICAgICAgICB1aW50IGxhdGVzdEJsb2NrID0gMDsKICAgICAgICBpbnQgaW1iYWxhbmNlSW5SYW5nZSA9IDA7CiAgICAgICAgdWludCBzdGFydEJsb2NrID0gcmF0ZVVwZGF0ZUJsb2NrOwogICAgICAgIHVpbnQgZW5kQmxvY2sgPSBjdXJyZW50QmxvY2s7CgogICAgICAgIGZvciAodWludCB3aW5kb3dJbmQgPSAwOyB3aW5kb3dJbmQgPCBTTElESU5HX1dJTkRPV19TSVpFOyB3aW5kb3dJbmQrKykgewogICAgICAgICAgICBUb2tlbkltYmFsYW5jZURhdGEgbWVtb3J5IHBlckJsb2NrRGF0YSA9IGRlY29kZVRva2VuSW1iYWxhbmNlRGF0YSh0b2tlbkltYmFsYW5jZURhdGFbdG9rZW5dW3dpbmRvd0luZF0pOwoKICAgICAgICAgICAgaWYgKHBlckJsb2NrRGF0YS5sYXN0QmxvY2sgPD0gZW5kQmxvY2sgJiYgcGVyQmxvY2tEYXRhLmxhc3RCbG9jayA+PSBzdGFydEJsb2NrKSB7CiAgICAgICAgICAgICAgICBpbWJhbGFuY2VJblJhbmdlICs9IHBlckJsb2NrRGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBlckJsb2NrRGF0YS5sYXN0UmF0ZVVwZGF0ZUJsb2NrICE9IHJhdGVVcGRhdGVCbG9jaykgY29udGludWU7CiAgICAgICAgICAgIGlmIChwZXJCbG9ja0RhdGEubGFzdEJsb2NrIDwgbGF0ZXN0QmxvY2spIGNvbnRpbnVlOwoKICAgICAgICAgICAgbGF0ZXN0QmxvY2sgPSBwZXJCbG9ja0RhdGEubGFzdEJsb2NrOwogICAgICAgICAgICBidXlJbWJhbGFuY2UgPSBwZXJCbG9ja0RhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZTsKICAgICAgICAgICAgaWYgKHVpbnQocGVyQmxvY2tEYXRhLmxhc3RCbG9jaykgPT0gY3VycmVudEJsb2NrKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2tJbWJhbGFuY2UgPSBwZXJCbG9ja0RhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChidXlJbWJhbGFuY2UgPT0gMCkgewogICAgICAgICAgICBidXlJbWJhbGFuY2UgPSBpbWJhbGFuY2VJblJhbmdlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJbWJhbGFuY2UoRVJDMjAgdG9rZW4sIHVpbnQgcmF0ZVVwZGF0ZUJsb2NrLCB1aW50IGN1cnJlbnRCbG9jaykKICAgICAgICBpbnRlcm5hbCB2aWV3CiAgICAgICAgcmV0dXJucyhpbnQgdG90YWxJbWJhbGFuY2UsIGludCBjdXJyZW50QmxvY2tJbWJhbGFuY2UpCiAgICB7CgogICAgICAgIGludCByZXNvbHV0aW9uID0gaW50KHRva2VuQ29udHJvbEluZm9bdG9rZW5dLm1pbmltYWxSZWNvcmRSZXNvbHV0aW9uKTsKCiAgICAgICAgKHRvdGFsSW1iYWxhbmNlLCBjdXJyZW50QmxvY2tJbWJhbGFuY2UpID0KICAgICAgICAgICAgZ2V0SW1iYWxhbmNlU2luY2VSYXRlVXBkYXRlKAogICAgICAgICAgICAgICAgdG9rZW4sCiAgICAgICAgICAgICAgICByYXRlVXBkYXRlQmxvY2ssCiAgICAgICAgICAgICAgICBjdXJyZW50QmxvY2spOwoKICAgICAgICB0b3RhbEltYmFsYW5jZSAqPSByZXNvbHV0aW9uOwogICAgICAgIGN1cnJlbnRCbG9ja0ltYmFsYW5jZSAqPSByZXNvbHV0aW9uOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE1heFBlckJsb2NrSW1iYWxhbmNlKEVSQzIwIHRva2VuKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiB0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5tYXhQZXJCbG9ja0ltYmFsYW5jZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNYXhUb3RhbEltYmFsYW5jZShFUkMyMCB0b2tlbikgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWF4VG90YWxJbWJhbGFuY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZW5jb2RlVG9rZW5JbWJhbGFuY2VEYXRhKFRva2VuSW1iYWxhbmNlRGF0YSBkYXRhKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIC8vIGNoZWNrIGZvciBvdmVyZmxvd3MKICAgICAgICByZXF1aXJlKGRhdGEubGFzdEJsb2NrQnV5VW5pdHNJbWJhbGFuY2UgPCBpbnQoUE9XXzJfNjQgLyAyKSk7CiAgICAgICAgcmVxdWlyZShkYXRhLmxhc3RCbG9ja0J1eVVuaXRzSW1iYWxhbmNlID4gaW50KC0xICogaW50KFBPV18yXzY0KSAvIDIpKTsKICAgICAgICByZXF1aXJlKGRhdGEubGFzdEJsb2NrIDwgUE9XXzJfNjQpOwogICAgICAgIHJlcXVpcmUoZGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlIDwgaW50KFBPV18yXzY0IC8gMikpOwogICAgICAgIHJlcXVpcmUoZGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlID4gaW50KC0xICogaW50KFBPV18yXzY0KSAvIDIpKTsKICAgICAgICByZXF1aXJlKGRhdGEubGFzdFJhdGVVcGRhdGVCbG9jayA8IFBPV18yXzY0KTsKCiAgICAgICAgLy8gZG8gZW5jb2RpbmcKICAgICAgICB1aW50IHJlc3VsdCA9IHVpbnQoZGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSkgJiAoUE9XXzJfNjQgLSAxKTsKICAgICAgICByZXN1bHQgfD0gZGF0YS5sYXN0QmxvY2sgKiBQT1dfMl82NDsKICAgICAgICByZXN1bHQgfD0gKHVpbnQoZGF0YS50b3RhbEJ1eVVuaXRzSW1iYWxhbmNlKSAmIChQT1dfMl82NCAtIDEpKSAqIFBPV18yXzY0ICogUE9XXzJfNjQ7CiAgICAgICAgcmVzdWx0IHw9IGRhdGEubGFzdFJhdGVVcGRhdGVCbG9jayAqIFBPV18yXzY0ICogUE9XXzJfNjQgKiBQT1dfMl82NDsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNvZGVUb2tlbkltYmFsYW5jZURhdGEodWludCBpbnB1dCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKFRva2VuSW1iYWxhbmNlRGF0YSkgewogICAgICAgIFRva2VuSW1iYWxhbmNlRGF0YSBtZW1vcnkgZGF0YTsKCiAgICAgICAgZGF0YS5sYXN0QmxvY2tCdXlVbml0c0ltYmFsYW5jZSA9IGludChpbnQ2NChpbnB1dCAmIChQT1dfMl82NCAtIDEpKSk7CiAgICAgICAgZGF0YS5sYXN0QmxvY2sgPSB1aW50KHVpbnQ2NCgoaW5wdXQgLyBQT1dfMl82NCkgJiAoUE9XXzJfNjQgLSAxKSkpOwogICAgICAgIGRhdGEudG90YWxCdXlVbml0c0ltYmFsYW5jZSA9IGludChpbnQ2NCgoaW5wdXQgLyAoUE9XXzJfNjQgKiBQT1dfMl82NCkpICYgKFBPV18yXzY0IC0gMSkpKTsKICAgICAgICBkYXRhLmxhc3RSYXRlVXBkYXRlQmxvY2sgPSB1aW50KHVpbnQ2NCgoaW5wdXQgLyAoUE9XXzJfNjQgKiBQT1dfMl82NCAqIFBPV18yXzY0KSkpKTsKCiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9Cn0KCmNvbnRyYWN0IENvbnZlcnNpb25SYXRlcyBpcyBDb252ZXJzaW9uUmF0ZXNJbnRlcmZhY2UsIFZvbHVtZUltYmFsYW5jZVJlY29yZGVyLCBVdGlscyB7CgogICAgLy8gYnBzIC0gYmFzaWMgcmF0ZSBzdGVwcy4gb25lIHN0ZXAgaXMgMSAvIDEwMDAwIG9mIHRoZSByYXRlLgogICAgc3RydWN0IFN0ZXBGdW5jdGlvbiB7CiAgICAgICAgaW50W10geDsgLy8gcXVhbnRpdHkgZm9yIGVhY2ggc3RlcC4gUXVhbnRpdHkgb2YgZWFjaCBzdGVwIGluY2x1ZGVzIHByZXZpb3VzIHN0ZXBzLgogICAgICAgIGludFtdIHk7IC8vIHJhdGUgY2hhbmdlIHBlciBxdWFudGl0eSBzdGVwICBpbiBicHMuCiAgICB9CgogICAgc3RydWN0IFRva2VuRGF0YSB7CiAgICAgICAgYm9vbCBsaXN0ZWQ7ICAvLyB3YXMgYWRkZWQgdG8gcmVzZXJ2ZQogICAgICAgIGJvb2wgZW5hYmxlZDsgLy8gd2hldGhlciB0cmFkZSBpcyBlbmFibGVkCgogICAgICAgIC8vIHBvc2l0aW9uIGluIHRoZSBjb21wYWN0IGRhdGEKICAgICAgICB1aW50IGNvbXBhY3REYXRhQXJyYXlJbmRleDsKICAgICAgICB1aW50IGNvbXBhY3REYXRhRmllbGRJbmRleDsKCiAgICAgICAgLy8gcmF0ZSBkYXRhLiBiYXNlIGFuZCBjaGFuZ2VzIGFjY29yZGluZyB0byBxdWFudGl0eSBhbmQgcmVzZXJ2ZSBiYWxhbmNlLgogICAgICAgIC8vIGdlbmVyYWxseSBzcGVha2luZy4gU2VsbCByYXRlIGlzIDEgLyBidXkgcmF0ZSBpLmUuIHRoZSBidXkgaW4gdGhlIG90aGVyIGRpcmVjdGlvbi4KICAgICAgICB1aW50IGJhc2VCdXlSYXRlOyAgLy8gaW4gUFJFQ0lTSU9OIHVuaXRzLiBzZWUgS3liZXJDb25zdGFudHMKICAgICAgICB1aW50IGJhc2VTZWxsUmF0ZTsgLy8gUFJFQ0lTSU9OIHVuaXRzLiB3aXRob3V0IChzZWxsIC8gYnV5KSBzcHJlYWQgaXQgaXMgMSAvIGJhc2VCdXlSYXRlCiAgICAgICAgU3RlcEZ1bmN0aW9uIGJ1eVJhdGVRdHlTdGVwRnVuY3Rpb247IC8vIGluIGJwcy4gaGlnaGVyIHF1YW50aXR5IC0gYmlnZ2VyIHRoZSByYXRlLgogICAgICAgIFN0ZXBGdW5jdGlvbiBzZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbjsvLyBpbiBicHMuIGhpZ2hlciB0aGUgcXVhCiAgICAgICAgU3RlcEZ1bmN0aW9uIGJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb247IC8vIGluIEJQUy4gaGlnaGVyIHJlc2VydmUgaW1iYWxhbmNlIC0gYmlnZ2VyIHRoZSByYXRlLgogICAgICAgIFN0ZXBGdW5jdGlvbiBzZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbjsKICAgIH0KCiAgICAvKgogICAgdGhpcyBpcyB0aGUgZGF0YSBmb3IgdG9rZW5SYXRlc0NvbXBhY3REYXRhCiAgICBidXQgc29saWRpdHkgY29tcGlsZXIgb3B0aW1pemVyIGlzIHN1Yi1vcHRpbWFsLCBhbmQgY2Fubm90IHdyaXRlIHRoaXMgc3RydWN0dXJlIGluIGEgc2luZ2xlIHN0b3JhZ2Ugd3JpdGUKICAgIHNvIHdlIHJlcHJlc2VudCBpdCBhcyBieXRlczMyIGFuZCBkbyB0aGUgYnl0ZSB0cmlja3Mgb3Vyc2VsdmVzLgogICAgc3RydWN0IFRva2VuUmF0ZXNDb21wYWN0RGF0YSB7CiAgICAgICAgYnl0ZXMxNCBidXk7ICAvLyBjaGFuZ2UgYnV5IHJhdGUgb2YgdG9rZW4gZnJvbSBiYXNlQnV5UmF0ZSBpbiAxMCBicHMKICAgICAgICBieXRlczE0IHNlbGw7IC8vIGNoYW5nZSBzZWxsIHJhdGUgb2YgdG9rZW4gZnJvbSBiYXNlU2VsbFJhdGUgaW4gMTAgYnBzCgogICAgICAgIHVpbnQzMiBibG9ja051bWJlcjsKICAgIH0gKi8KICAgIHVpbnQgcHVibGljIHZhbGlkUmF0ZUR1cmF0aW9uSW5CbG9ja3MgPSAxMDsgLy8gcmF0ZXMgYXJlIHZhbGlkIGZvciB0aGlzIGFtb3VudCBvZiBibG9ja3MKICAgIEVSQzIwW10gaW50ZXJuYWwgbGlzdGVkVG9rZW5zOwogICAgbWFwcGluZyhhZGRyZXNzPT5Ub2tlbkRhdGEpIGludGVybmFsIHRva2VuRGF0YTsKICAgIGJ5dGVzMzJbXSBpbnRlcm5hbCB0b2tlblJhdGVzQ29tcGFjdERhdGE7CiAgICB1aW50IHB1YmxpYyBudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSA9IDA7CiAgICBhZGRyZXNzIHB1YmxpYyByZXNlcnZlQ29udHJhY3Q7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIE5VTV9UT0tFTlNfSU5fQ09NUEFDVF9EQVRBID0gMTQ7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEJZVEVTXzE0X09GRlNFVCA9ICgyICoqICg4ICogTlVNX1RPS0VOU19JTl9DT01QQUNUX0RBVEEpKTsKCiAgICBmdW5jdGlvbiBDb252ZXJzaW9uUmF0ZXMoYWRkcmVzcyBfYWRtaW4pIHB1YmxpYyBWb2x1bWVJbWJhbGFuY2VSZWNvcmRlcihfYWRtaW4pCiAgICAgICAgeyB9IC8vIHNvbGhpbnQtZGlzYWJsZS1saW5lIG5vLWVtcHR5LWJsb2NrcwoKICAgIGZ1bmN0aW9uIGFkZFRva2VuKEVSQzIwIHRva2VuKSBwdWJsaWMgb25seUFkbWluIHsKCiAgICAgICAgcmVxdWlyZSghdG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwogICAgICAgIHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkID0gdHJ1ZTsKICAgICAgICBsaXN0ZWRUb2tlbnMucHVzaCh0b2tlbik7CgogICAgICAgIGlmIChudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YSA9PSAwKSB7CiAgICAgICAgICAgIHRva2VuUmF0ZXNDb21wYWN0RGF0YS5sZW5ndGgrKzsgLy8gYWRkIG5ldyBzdHJ1Y3R1cmUKICAgICAgICB9CgogICAgICAgIHRva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFBcnJheUluZGV4ID0gdG9rZW5SYXRlc0NvbXBhY3REYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUZpZWxkSW5kZXggPSBudW1Ub2tlbnNJbkN1cnJlbnRDb21wYWN0RGF0YTsKCiAgICAgICAgbnVtVG9rZW5zSW5DdXJyZW50Q29tcGFjdERhdGEgPSAobnVtVG9rZW5zSW5DdXJyZW50Q29tcGFjdERhdGEgKyAxKSAlIE5VTV9UT0tFTlNfSU5fQ09NUEFDVF9EQVRBOwoKICAgICAgICBzZXRHYXJiYWdlVG9Wb2x1bWVSZWNvcmRlcih0b2tlbik7CgogICAgICAgIHNldERlY2ltYWxzKHRva2VuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDb21wYWN0RGF0YShieXRlczE0W10gYnV5LCBieXRlczE0W10gc2VsbCwgdWludCBibG9ja051bWJlciwgdWludFtdIGluZGljZXMpIHB1YmxpYyBvbmx5T3BlcmF0b3IgewoKICAgICAgICByZXF1aXJlKGJ1eS5sZW5ndGggPT0gc2VsbC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoaW5kaWNlcy5sZW5ndGggPT0gYnV5Lmxlbmd0aCk7CiAgICAgICAgcmVxdWlyZShibG9ja051bWJlciA8PSAweEZGRkZGRkZGKTsKCiAgICAgICAgdWludCBieXRlczE0T2Zmc2V0ID0gQllURVNfMTRfT0ZGU0VUOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBpbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHJlcXVpcmUoaW5kaWNlc1tpXSA8IHRva2VuUmF0ZXNDb21wYWN0RGF0YS5sZW5ndGgpOwogICAgICAgICAgICB1aW50IGRhdGEgPSB1aW50KGJ1eVtpXSkgfCB1aW50KHNlbGxbaV0pICogYnl0ZXMxNE9mZnNldCB8IChibG9ja051bWJlciAqIChieXRlczE0T2Zmc2V0ICogYnl0ZXMxNE9mZnNldCkpOwogICAgICAgICAgICB0b2tlblJhdGVzQ29tcGFjdERhdGFbaW5kaWNlc1tpXV0gPSBieXRlczMyKGRhdGEpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCYXNlUmF0ZSgKICAgICAgICBFUkMyMFtdIHRva2VucywKICAgICAgICB1aW50W10gYmFzZUJ1eSwKICAgICAgICB1aW50W10gYmFzZVNlbGwsCiAgICAgICAgYnl0ZXMxNFtdIGJ1eSwKICAgICAgICBieXRlczE0W10gc2VsbCwKICAgICAgICB1aW50IGJsb2NrTnVtYmVyLAogICAgICAgIHVpbnRbXSBpbmRpY2VzCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU9wZXJhdG9yCiAgICB7CiAgICAgICAgcmVxdWlyZSh0b2tlbnMubGVuZ3RoID09IGJhc2VCdXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHRva2Vucy5sZW5ndGggPT0gYmFzZVNlbGwubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHNlbGwubGVuZ3RoID09IGJ1eS5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoc2VsbC5sZW5ndGggPT0gaW5kaWNlcy5sZW5ndGgpOwoKICAgICAgICBmb3IgKHVpbnQgaW5kID0gMDsgaW5kIDwgdG9rZW5zLmxlbmd0aDsgaW5kKyspIHsKICAgICAgICAgICAgcmVxdWlyZSh0b2tlbkRhdGFbdG9rZW5zW2luZF1dLmxpc3RlZCk7CiAgICAgICAgICAgIHRva2VuRGF0YVt0b2tlbnNbaW5kXV0uYmFzZUJ1eVJhdGUgPSBiYXNlQnV5W2luZF07CiAgICAgICAgICAgIHRva2VuRGF0YVt0b2tlbnNbaW5kXV0uYmFzZVNlbGxSYXRlID0gYmFzZVNlbGxbaW5kXTsKICAgICAgICB9CgogICAgICAgIHNldENvbXBhY3REYXRhKGJ1eSwgc2VsbCwgYmxvY2tOdW1iZXIsIGluZGljZXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFF0eVN0ZXBGdW5jdGlvbigKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICBpbnRbXSB4QnV5LAogICAgICAgIGludFtdIHlCdXksCiAgICAgICAgaW50W10geFNlbGwsCiAgICAgICAgaW50W10geVNlbGwKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3BlcmF0b3IKICAgIHsKICAgICAgICByZXF1aXJlKHhCdXkubGVuZ3RoID09IHlCdXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHhTZWxsLmxlbmd0aCA9PSB5U2VsbC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwoKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24gPSBTdGVwRnVuY3Rpb24oeEJ1eSwgeUJ1eSk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbiA9IFN0ZXBGdW5jdGlvbih4U2VsbCwgeVNlbGwpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEltYmFsYW5jZVN0ZXBGdW5jdGlvbigKICAgICAgICBFUkMyMCB0b2tlbiwKICAgICAgICBpbnRbXSB4QnV5LAogICAgICAgIGludFtdIHlCdXksCiAgICAgICAgaW50W10geFNlbGwsCiAgICAgICAgaW50W10geVNlbGwKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3BlcmF0b3IKICAgIHsKICAgICAgICByZXF1aXJlKHhCdXkubGVuZ3RoID09IHlCdXkubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKHhTZWxsLmxlbmd0aCA9PSB5U2VsbC5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwoKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24gPSBTdGVwRnVuY3Rpb24oeEJ1eSwgeUJ1eSk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbiA9IFN0ZXBGdW5jdGlvbih4U2VsbCwgeVNlbGwpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbGlkUmF0ZUR1cmF0aW9uSW5CbG9ja3ModWludCBkdXJhdGlvbikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgdmFsaWRSYXRlRHVyYXRpb25JbkJsb2NrcyA9IGR1cmF0aW9uOwogICAgfQoKICAgIGZ1bmN0aW9uIGVuYWJsZVRva2VuVHJhZGUoRVJDMjAgdG9rZW4pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwogICAgICAgIHJlcXVpcmUodG9rZW5Db250cm9sSW5mb1t0b2tlbl0ubWluaW1hbFJlY29yZFJlc29sdXRpb24gIT0gMCk7CiAgICAgICAgdG9rZW5EYXRhW3Rva2VuXS5lbmFibGVkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXNhYmxlVG9rZW5UcmFkZShFUkMyMCB0b2tlbikgcHVibGljIG9ubHlBbGVydGVyIHsKICAgICAgICByZXF1aXJlKHRva2VuRGF0YVt0b2tlbl0ubGlzdGVkKTsKICAgICAgICB0b2tlbkRhdGFbdG9rZW5dLmVuYWJsZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRSZXNlcnZlQWRkcmVzcyhhZGRyZXNzIHJlc2VydmUpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlc2VydmVDb250cmFjdCA9IHJlc2VydmU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVjb3JkSW1iYWxhbmNlKAogICAgICAgIEVSQzIwIHRva2VuLAogICAgICAgIGludCBidXlBbW91bnQsCiAgICAgICAgdWludCByYXRlVXBkYXRlQmxvY2ssCiAgICAgICAgdWludCBjdXJyZW50QmxvY2sKICAgICkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcmVzZXJ2ZUNvbnRyYWN0KTsKCiAgICAgICAgaWYgKHJhdGVVcGRhdGVCbG9jayA9PSAwKSByYXRlVXBkYXRlQmxvY2sgPSBnZXRSYXRlVXBkYXRlQmxvY2sodG9rZW4pOwoKICAgICAgICByZXR1cm4gYWRkSW1iYWxhbmNlKHRva2VuLCBidXlBbW91bnQsIHJhdGVVcGRhdGVCbG9jaywgY3VycmVudEJsb2NrKTsKICAgIH0KCiAgICAvKiBzb2xoaW50LWRpc2FibGUgZnVuY3Rpb24tbWF4LWxpbmVzICovCiAgICBmdW5jdGlvbiBnZXRSYXRlKEVSQzIwIHRva2VuLCB1aW50IGN1cnJlbnRCbG9ja051bWJlciwgYm9vbCBidXksIHVpbnQgcXR5KSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICAvLyBjaGVjayBpZiB0cmFkZSBpcyBlbmFibGVkCiAgICAgICAgaWYgKCF0b2tlbkRhdGFbdG9rZW5dLmVuYWJsZWQpIHJldHVybiAwOwogICAgICAgIGlmICh0b2tlbkNvbnRyb2xJbmZvW3Rva2VuXS5taW5pbWFsUmVjb3JkUmVzb2x1dGlvbiA9PSAwKSByZXR1cm4gMDsgLy8gdG9rZW4gY29udHJvbCBpbmZvIG5vdCBzZXQKCiAgICAgICAgLy8gZ2V0IHJhdGUgdXBkYXRlIGJsb2NrCiAgICAgICAgYnl0ZXMzMiBjb21wYWN0RGF0YSA9IHRva2VuUmF0ZXNDb21wYWN0RGF0YVt0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhQXJyYXlJbmRleF07CgogICAgICAgIHVpbnQgdXBkYXRlUmF0ZUJsb2NrID0gZ2V0TGFzdDRCeXRlcyhjb21wYWN0RGF0YSk7CiAgICAgICAgaWYgKGN1cnJlbnRCbG9ja051bWJlciA+PSB1cGRhdGVSYXRlQmxvY2sgKyB2YWxpZFJhdGVEdXJhdGlvbkluQmxvY2tzKSByZXR1cm4gMDsgLy8gcmF0ZSBpcyBleHBpcmVkCiAgICAgICAgLy8gY2hlY2sgaW1iYWxhbmNlCiAgICAgICAgaW50IHRvdGFsSW1iYWxhbmNlOwogICAgICAgIGludCBibG9ja0ltYmFsYW5jZTsKICAgICAgICAodG90YWxJbWJhbGFuY2UsIGJsb2NrSW1iYWxhbmNlKSA9IGdldEltYmFsYW5jZSh0b2tlbiwgdXBkYXRlUmF0ZUJsb2NrLCBjdXJyZW50QmxvY2tOdW1iZXIpOwoKICAgICAgICAvLyBjYWxjdWxhdGUgYWN0dWFsIHJhdGUKICAgICAgICBpbnQgaW1iYWxhbmNlUXR5OwogICAgICAgIGludCBleHRyYUJwczsKICAgICAgICBpbnQ4IHJhdGVVcGRhdGU7CiAgICAgICAgdWludCByYXRlOwoKICAgICAgICBpZiAoYnV5KSB7CiAgICAgICAgICAgIC8vIHN0YXJ0IHdpdGggYmFzZSByYXRlCiAgICAgICAgICAgIHJhdGUgPSB0b2tlbkRhdGFbdG9rZW5dLmJhc2VCdXlSYXRlOwoKICAgICAgICAgICAgLy8gYWRkIHJhdGUgdXBkYXRlCiAgICAgICAgICAgIHJhdGVVcGRhdGUgPSBnZXRSYXRlQnl0ZUZyb21Db21wYWN0RGF0YShjb21wYWN0RGF0YSwgdG9rZW4sIHRydWUpOwogICAgICAgICAgICBleHRyYUJwcyA9IGludChyYXRlVXBkYXRlKSAqIDEwOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKCiAgICAgICAgICAgIC8vIGNvbXB1dGUgdG9rZW4gcXR5CiAgICAgICAgICAgIHF0eSA9IGdldFRva2VuUXR5KHRva2VuLCByYXRlLCBxdHkpOwogICAgICAgICAgICBpbWJhbGFuY2VRdHkgPSBpbnQocXR5KTsKICAgICAgICAgICAgdG90YWxJbWJhbGFuY2UgKz0gaW1iYWxhbmNlUXR5OwoKICAgICAgICAgICAgLy8gYWRkIHF0eSBvdmVyaGVhZAogICAgICAgICAgICBleHRyYUJwcyA9IGV4ZWN1dGVTdGVwRnVuY3Rpb24odG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlUXR5U3RlcEZ1bmN0aW9uLCBpbnQocXR5KSk7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwoKICAgICAgICAgICAgLy8gYWRkIGltYmFsYW5jZSBvdmVyaGVhZAogICAgICAgICAgICBleHRyYUJwcyA9IGV4ZWN1dGVTdGVwRnVuY3Rpb24odG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLCB0b3RhbEltYmFsYW5jZSk7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHN0YXJ0IHdpdGggYmFzZSByYXRlCiAgICAgICAgICAgIHJhdGUgPSB0b2tlbkRhdGFbdG9rZW5dLmJhc2VTZWxsUmF0ZTsKCiAgICAgICAgICAgIC8vIGFkZCByYXRlIHVwZGF0ZQogICAgICAgICAgICByYXRlVXBkYXRlID0gZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEoY29tcGFjdERhdGEsIHRva2VuLCBmYWxzZSk7CiAgICAgICAgICAgIGV4dHJhQnBzID0gaW50KHJhdGVVcGRhdGUpICogMTA7CiAgICAgICAgICAgIHJhdGUgPSBhZGRCcHMocmF0ZSwgZXh0cmFCcHMpOwoKICAgICAgICAgICAgLy8gY29tcHV0ZSB0b2tlbiBxdHkKICAgICAgICAgICAgaW1iYWxhbmNlUXR5ID0gLTEgKiBpbnQocXR5KTsKICAgICAgICAgICAgdG90YWxJbWJhbGFuY2UgKz0gaW1iYWxhbmNlUXR5OwoKICAgICAgICAgICAgLy8gYWRkIHF0eSBvdmVyaGVhZAogICAgICAgICAgICBleHRyYUJwcyA9IGV4ZWN1dGVTdGVwRnVuY3Rpb24odG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbiwgaW50KHF0eSkpOwogICAgICAgICAgICByYXRlID0gYWRkQnBzKHJhdGUsIGV4dHJhQnBzKTsKCiAgICAgICAgICAgIC8vIGFkZCBpbWJhbGFuY2Ugb3ZlcmhlYWQKICAgICAgICAgICAgZXh0cmFCcHMgPSBleGVjdXRlU3RlcEZ1bmN0aW9uKHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24sIHRvdGFsSW1iYWxhbmNlKTsKICAgICAgICAgICAgcmF0ZSA9IGFkZEJwcyhyYXRlLCBleHRyYUJwcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYWJzKHRvdGFsSW1iYWxhbmNlICsgaW1iYWxhbmNlUXR5KSA+PSBnZXRNYXhUb3RhbEltYmFsYW5jZSh0b2tlbikpIHJldHVybiAwOwogICAgICAgIGlmIChhYnMoYmxvY2tJbWJhbGFuY2UgKyBpbWJhbGFuY2VRdHkpID49IGdldE1heFBlckJsb2NrSW1iYWxhbmNlKHRva2VuKSkgcmV0dXJuIDA7CgogICAgICAgIHJldHVybiByYXRlOwogICAgfQogICAgLyogc29saGludC1lbmFibGUgZnVuY3Rpb24tbWF4LWxpbmVzICovCgogICAgZnVuY3Rpb24gZ2V0QmFzaWNSYXRlKEVSQzIwIHRva2VuLCBib29sIGJ1eSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKGJ1eSkKICAgICAgICAgICAgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYmFzZUJ1eVJhdGU7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5iYXNlU2VsbFJhdGU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29tcGFjdERhdGEoRVJDMjAgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnModWludCwgdWludCwgYnl0ZSwgYnl0ZSkgewogICAgICAgIHJlcXVpcmUodG9rZW5EYXRhW3Rva2VuXS5saXN0ZWQpOwoKICAgICAgICB1aW50IGFycmF5SW5kZXggPSB0b2tlbkRhdGFbdG9rZW5dLmNvbXBhY3REYXRhQXJyYXlJbmRleDsKICAgICAgICB1aW50IGZpZWxkT2Zmc2V0ID0gdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUZpZWxkSW5kZXg7CgogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGFycmF5SW5kZXgsCiAgICAgICAgICAgIGZpZWxkT2Zmc2V0LAogICAgICAgICAgICBieXRlKGdldFJhdGVCeXRlRnJvbUNvbXBhY3REYXRhKHRva2VuUmF0ZXNDb21wYWN0RGF0YVthcnJheUluZGV4XSwgdG9rZW4sIHRydWUpKSwKICAgICAgICAgICAgYnl0ZShnZXRSYXRlQnl0ZUZyb21Db21wYWN0RGF0YSh0b2tlblJhdGVzQ29tcGFjdERhdGFbYXJyYXlJbmRleF0sIHRva2VuLCBmYWxzZSkpCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlbkJhc2ljRGF0YShFUkMyMCB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyhib29sLCBib29sKSB7CiAgICAgICAgcmV0dXJuICh0b2tlbkRhdGFbdG9rZW5dLmxpc3RlZCwgdG9rZW5EYXRhW3Rva2VuXS5lbmFibGVkKTsKICAgIH0KCiAgICAvKiBzb2xoaW50LWRpc2FibGUgY29kZS1jb21wbGV4aXR5ICovCiAgICBmdW5jdGlvbiBnZXRTdGVwRnVuY3Rpb25EYXRhKEVSQzIwIHRva2VuLCB1aW50IGNvbW1hbmQsIHVpbnQgcGFyYW0pIHB1YmxpYyB2aWV3IHJldHVybnMoaW50KSB7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24ueC5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDEpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24ueFtwYXJhbV07CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMikgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24ueS5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDMpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVRdHlTdGVwRnVuY3Rpb24ueVtwYXJhbV07CgogICAgICAgIGlmIChjb21tYW5kID09IDQpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbi54Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gNSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVRdHlTdGVwRnVuY3Rpb24ueFtwYXJhbV07CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gNikgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlUXR5U3RlcEZ1bmN0aW9uLnkubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSA3KSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZVF0eVN0ZXBGdW5jdGlvbi55W3BhcmFtXTsKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gOCkgcmV0dXJuIGludCh0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueC5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDkpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLmJ1eVJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueFtwYXJhbV07CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTApIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5idXlSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnkubGVuZ3RoKTsKICAgICAgICBpZiAoY29tbWFuZCA9PSAxMSkgcmV0dXJuIHRva2VuRGF0YVt0b2tlbl0uYnV5UmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi55W3BhcmFtXTsKCiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTIpIHJldHVybiBpbnQodG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi54Lmxlbmd0aCk7CiAgICAgICAgaWYgKGNvbW1hbmQgPT0gMTMpIHJldHVybiB0b2tlbkRhdGFbdG9rZW5dLnNlbGxSYXRlSW1iYWxhbmNlU3RlcEZ1bmN0aW9uLnhbcGFyYW1dOwogICAgICAgIGlmIChjb21tYW5kID09IDE0KSByZXR1cm4gaW50KHRva2VuRGF0YVt0b2tlbl0uc2VsbFJhdGVJbWJhbGFuY2VTdGVwRnVuY3Rpb24ueS5sZW5ndGgpOwogICAgICAgIGlmIChjb21tYW5kID09IDE1KSByZXR1cm4gdG9rZW5EYXRhW3Rva2VuXS5zZWxsUmF0ZUltYmFsYW5jZVN0ZXBGdW5jdGlvbi55W3BhcmFtXTsKCiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CiAgICAvKiBzb2xoaW50LWVuYWJsZSBjb2RlLWNvbXBsZXhpdHkgKi8KCiAgICBmdW5jdGlvbiBnZXRSYXRlVXBkYXRlQmxvY2soRVJDMjAgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIGJ5dGVzMzIgY29tcGFjdERhdGEgPSB0b2tlblJhdGVzQ29tcGFjdERhdGFbdG9rZW5EYXRhW3Rva2VuXS5jb21wYWN0RGF0YUFycmF5SW5kZXhdOwogICAgICAgIHJldHVybiBnZXRMYXN0NEJ5dGVzKGNvbXBhY3REYXRhKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRMaXN0ZWRUb2tlbnMoKSBwdWJsaWMgdmlldyByZXR1cm5zKEVSQzIwW10pIHsKICAgICAgICByZXR1cm4gbGlzdGVkVG9rZW5zOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRva2VuUXR5KEVSQzIwIHRva2VuLCB1aW50IGV0aFF0eSwgdWludCByYXRlKSBpbnRlcm5hbCB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHVpbnQgZHN0RGVjaW1hbHMgPSBnZXREZWNpbWFscyh0b2tlbik7CiAgICAgICAgdWludCBzcmNEZWNpbWFscyA9IEVUSF9ERUNJTUFMUzsKCiAgICAgICAgcmV0dXJuIGNhbGNEc3RRdHkoZXRoUXR5LCBzcmNEZWNpbWFscywgZHN0RGVjaW1hbHMsIHJhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExhc3Q0Qnl0ZXMoYnl0ZXMzMiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludCkgewogICAgICAgIC8vIGNhbm5vdCB0cnVzdCBjb21waWxlciB3aXRoIG5vdCB0dXJuaW5nIGJpdCBvcGVyYXRpb25zIGludG8gRVhQIG9wY29kZQogICAgICAgIHJldHVybiB1aW50KGIpIC8gKEJZVEVTXzE0X09GRlNFVCAqIEJZVEVTXzE0X09GRlNFVCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UmF0ZUJ5dGVGcm9tQ29tcGFjdERhdGEoYnl0ZXMzMiBkYXRhLCBFUkMyMCB0b2tlbiwgYm9vbCBidXkpIGludGVybmFsIHZpZXcgcmV0dXJucyhpbnQ4KSB7CiAgICAgICAgdWludCBmaWVsZE9mZnNldCA9IHRva2VuRGF0YVt0b2tlbl0uY29tcGFjdERhdGFGaWVsZEluZGV4OwogICAgICAgIHVpbnQgYnl0ZU9mZnNldDsKICAgICAgICBpZiAoYnV5KQogICAgICAgICAgICBieXRlT2Zmc2V0ID0gMzIgLSBOVU1fVE9LRU5TX0lOX0NPTVBBQ1RfREFUQSArIGZpZWxkT2Zmc2V0OwogICAgICAgIGVsc2UKICAgICAgICAgICAgYnl0ZU9mZnNldCA9IDQgKyBmaWVsZE9mZnNldDsKCiAgICAgICAgcmV0dXJuIGludDgoZGF0YVtieXRlT2Zmc2V0XSk7CiAgICB9CgogICAgZnVuY3Rpb24gZXhlY3V0ZVN0ZXBGdW5jdGlvbihTdGVwRnVuY3Rpb24gZiwgaW50IHgpIGludGVybmFsIHB1cmUgcmV0dXJucyhpbnQpIHsKICAgICAgICB1aW50IGxlbiA9IGYueS5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGluZCA9IDA7IGluZCA8IGxlbjsgaW5kKyspIHsKICAgICAgICAgICAgaWYgKHggPD0gZi54W2luZF0pIHJldHVybiBmLnlbaW5kXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmLnlbbGVuLTFdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEJwcyh1aW50IHJhdGUsIGludCBicHMpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBtYXhCcHMgPSAxMDAgKiAxMDA7CiAgICAgICAgcmV0dXJuIChyYXRlICogdWludChpbnQobWF4QnBzKSArIGJwcykpIC8gbWF4QnBzOwogICAgfQoKICAgIGZ1bmN0aW9uIGFicyhpbnQgeCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAoeCA8IDApCiAgICAgICAgICAgIHJldHVybiB1aW50KC0xICogeCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdWludCh4KTsKICAgIH0KfQoKaW50ZXJmYWNlIEVSQzIwIHsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBzdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50IGRpZ2l0cyk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKfQ=='.
	

]
