Class {
	#name : #SRT510a71bd8a3ee739b099d433f5492d3f7b3fdd57,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT510a71bd8a3ee739b099d433f5492d3f7b3fdd57 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgpjb250cmFjdCBFUkMyMCB7CglmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG90YWxTdXBwbHkpOwoJZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpOwoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCWZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CglmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKICAgIC8vIFRoaXMgZ2VuZXJhdGVzIGEgcHVibGljIGV2ZW50IG9uIHRoZSBibG9ja2NoYWluIHRoYXQgd2lsbCBub3RpZnkgY2xpZW50cwoJZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CglldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKfQoKLy9Ub2tlbiB3aXRoIG93bmVyIChhZG1pbikKY29udHJhY3QgT3duZWRUb2tlbiB7CglhZGRyZXNzIHB1YmxpYyBvd25lcjsgLy9jb250cmFjdCBvd25lciAoYWRtaW4pIGFkZHJlc3MKCWZ1bmN0aW9uIE93bmVkVG9rZW4gKCkgcHVibGljIHsKCQlvd25lciA9IG1zZy5zZW5kZXI7Cgl9CgkvL0NoZWNrIGlmIG93bmVyIGluaXRpYXRlIGNhbGwKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmZXIgb3duZXJzaGlwCiAgICAgKgogICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgY29udHJhY3Qgb3duZXIKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KfQoKLy9Db250cmFjdCB3aXRoIG5hbWUKY29udHJhY3QgTmFtZWRPd25lZFRva2VuIGlzIE93bmVkVG9rZW4gewoJc3RyaW5nIHB1YmxpYyBuYW1lOyAvL3RoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCglzdHJpbmcgcHVibGljIHN5bWJvbDsgLy90aGUgc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2VzCglmdW5jdGlvbiBOYW1lZE93bmVkVG9rZW4oc3RyaW5nIHRva2VuTmFtZSwgc3RyaW5nIHRva2VuU3ltYm9sKSBwdWJsaWMKCXsKICAgICAgICBuYW1lID0gdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2VzCgl9CgogICAgLyoqCiAgICAgKiBDaGFuZ2UgbmFtZSBhbmQgc3ltYm9sCiAgICAgKgogICAgICogQHBhcmFtIG5ld05hbWUgVGhlIG5ldyBjb250cmFjdCBuYW1lCiAgICAgKiBAcGFyYW0gbmV3U3ltYm9sIFRoZSBuZXcgY29udHJhY3Qgc3ltYm9sIAogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VOYW1lKHN0cmluZyBuZXdOYW1lLCBzdHJpbmcgbmV3U3ltYm9sKXB1YmxpYyBvbmx5T3duZXIgewoJCW5hbWUgPSBuZXdOYW1lOwoJCXN5bWJvbCA9IG5ld1N5bWJvbDsKICAgIH0KfQoKY29udHJhY3QgVFNCVG9rZW4gaXMgRVJDMjAsIE5hbWVkT3duZWRUb2tlbiB7Cgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLyBQdWJsaWMgdmFyaWFibGVzIG9mIHRoZSB0b2tlbgoKICAgIHVpbnQyNTYgcHVibGljIF90b3RhbFN1cHBseSA9IDA7IC8vVG90YWwgbnVtYmVyIG9mIHRva2VuIGlzc3VlZCAoMSB0b2tlbiA9IDEwXmRlY2ltYWxzKQoJdWludDggcHVibGljIGRlY2ltYWxzID0gMTg7IC8vRGVjaW1hbHMsIGVhY2ggMSB0b2tlbiA9IDEwXmRlY2ltYWxzCgogICAgCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlczsgLy8gQSBtYXAgd2l0aCBhbGwgYmFsYW5jZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIGFsbG93ZWQ7IC8vSW1wbGVtZW50IGFsbG93ZW5jZSB0byBzdXBwb3J0IEVSQzIwCgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcGFpZEVUSDsgLy9UaGUgc3VtIGhhdmUgYWxyZWFkeSBiZWVuIHBhaWQgdG8gdG9rZW4gb3duZXIKCXVpbnQyNTYgcHVibGljIGFjY3J1ZURpdmlkZW5kc1BlclhUb2tlbkVUSCA9IDA7Cgl1aW50MjU2IHB1YmxpYyB0b2tlblByaWNlRVRIID0gMDsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwYXlkQ291cG9uc0VUSDsKCXVpbnQyNTYgcHVibGljIGFjY3J1ZUNvdXBvbnNQZXJYVG9rZW5FVEggPSAwOwoJdWludDI1NiBwdWJsaWMgdG90YWxDb3Vwb25zVVNEID0gMDsKCXVpbnQyNTYgcHVibGljIE1heENvdXBvbnNQYXltZW50VVNEID0gMTUwMDAwOwoKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlYnV5U3VtOwoJbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcmVidXlJbmZvcm1UaW1lOwoKCgl1aW50MjU2IHB1YmxpYyBlbmRTYWxlVGltZTsKCXVpbnQyNTYgcHVibGljIHN0YXJ0UmVidXlUaW1lOwoJdWludDI1NiBwdWJsaWMgcmVzZXJ2ZWRTdW07Cglib29sIHB1YmxpYyByZWJ1eVN0YXJ0ZWQgPSBmYWxzZTsKCgl1aW50IHB1YmxpYyB0b2tlbkRlY2ltYWxzOwoJdWludCBwdWJsaWMgdG9rZW5EZWNpbWFsc0xlZnQ7CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvciBmdW5jdGlvbgogICAgICoKICAgICAqIEluaXRpYWxpemVzIGNvbnRyYWN0CiAgICAgKi8KICAgIGZ1bmN0aW9uIFRTQlRva2VuKAogICAgICAgIHN0cmluZyB0b2tlbk5hbWUsCiAgICAgICAgc3RyaW5nIHRva2VuU3ltYm9sCiAgICApIE5hbWVkT3duZWRUb2tlbih0b2tlbk5hbWUsIHRva2VuU3ltYm9sKSBwdWJsaWMgewoJCXRva2VuRGVjaW1hbHMgPSAxMCoqdWludDI1NihkZWNpbWFscyAtIDUpOwoJCXRva2VuRGVjaW1hbHNMZWZ0ID0gMTAqKjU7CgkJc3RhcnRSZWJ1eVRpbWUgPSBub3cgKyAxIHllYXJzOwoJCWVuZFNhbGVUaW1lID0gbm93OwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZnVuY3Rpb24sIGNhbGMgZGl2aWRlbmRzIHRvIHRyYW5zZmVyIHdoZW4gdG9rZW5zIGFyZSB0cmFuc2ZlcmluZyB0byBhbm90aGVyIHdhbGxldAogICAgICovCglmdW5jdGlvbiB0cmFuc2ZlckRpdih1aW50IHN0YXJ0VG9rZW5zLCB1aW50IGZyb21Ub2tlbnMsIHVpbnQgdG9Ub2tlbnMsIHVpbnQgc3VtUGF5ZEZyb20sIHVpbnQgc3VtUGF5ZFRvLCB1aW50IGFjcnVlZCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCwgdWludCkgewoJCXVpbnQgc3VtVG9QYXlEaXZpZGVuZHNGcm9tID0gZnJvbVRva2Vucy5tdWwoYWNydWVkKTsKCQl1aW50IHN1bVRvUGF5RGl2aWRlbmRzVG8gPSB0b1Rva2Vucy5tdWwoYWNydWVkKTsKCQl1aW50IHN1bVRyYW5zZmVyID0gc3VtUGF5ZEZyb20uZGl2KHN0YXJ0VG9rZW5zKTsKCQlzdW1UcmFuc2ZlciA9IHN1bVRyYW5zZmVyLm11bChzdGFydFRva2Vucy1mcm9tVG9rZW5zKTsKCQlpZiAoc3VtUGF5ZEZyb20gPiBzdW1UcmFuc2ZlcikgewoJCQlzdW1QYXlkRnJvbSAtPSBzdW1UcmFuc2ZlcjsKCQkJaWYgKHN1bVBheWRGcm9tID4gc3VtVG9QYXlEaXZpZGVuZHNGcm9tKSB7CgkJCQlzdW1UcmFuc2ZlciArPSBzdW1QYXlkRnJvbSAtIHN1bVRvUGF5RGl2aWRlbmRzRnJvbTsKCQkJCXN1bVBheWRGcm9tID0gc3VtVG9QYXlEaXZpZGVuZHNGcm9tOwoJCQl9CgkJfSBlbHNlIHsKCQkJc3VtVHJhbnNmZXIgPSBzdW1QYXlkRnJvbTsKCQkJc3VtUGF5ZEZyb20gPSAwOwoJCX0KCQlzdW1QYXlkVG8gPSBzdW1QYXlkVG8uYWRkKHN1bVRyYW5zZmVyKTsKCQlpZiAoc3VtUGF5ZFRvID4gc3VtVG9QYXlEaXZpZGVuZHNUbykgewoJCQl1aW50IGRpZmZlciA9IHN1bVBheWRUbyAtIHN1bVRvUGF5RGl2aWRlbmRzVG87CgkJCXN1bVBheWRUbyA9IHN1bVRvUGF5RGl2aWRlbmRzVG87CgkJCXN1bVBheWRGcm9tID0gc3VtUGF5ZEZyb20uYWRkKGRpZmZlcik7CgkJCWlmIChzdW1QYXlkRnJvbSA+IHN1bVRvUGF5RGl2aWRlbmRzRnJvbSkgewoJCQkJc3VtUGF5ZEZyb20gPSBzdW1Ub1BheURpdmlkZW5kc0Zyb207CgkJCX0gCgkJfQoJCXJldHVybiAoc3VtUGF5ZEZyb20sIHN1bVBheWRUbyk7Cgl9CgoKCiAgICAvKioKICAgICAqIEludGVybmFsIHRyYW5zZmVyLCBvbmx5IGNhbiBiZSBjYWxsZWQgYnkgdGhpcyBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXZlbnQgdHJhbnNmZXIgdG8gMHgwIGFkZHJlc3MuIFVzZSBidXJuKCkgaW5zdGVhZAogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7ICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaAogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3dzCgkJdWludCBzdGFydFRva2VucyA9IGJhbGFuY2VzW19mcm9tXS5kaXYodG9rZW5EZWNpbWFscyk7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3VidHJhY3QgZnJvbSB0aGUgc2VuZGVyCiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBzYW1lIHRvIHRoZSByZWNpcGllbnQKCgkJaWYgKGJhbGFuY2VzW19mcm9tXSA9PSAwKSB7CgkJCXBhaWRFVEhbX3RvXSA9IHBhaWRFVEhbX3RvXS5hZGQocGFpZEVUSFtfZnJvbV0pOwoJCX0gZWxzZSB7CgkJCXVpbnQgZnJvbVRva2VucyA9IGJhbGFuY2VzW19mcm9tXS5kaXYodG9rZW5EZWNpbWFscyk7CgkJCXVpbnQgdG9Ub2tlbnMgPSBiYWxhbmNlc1tfdG9dLmRpdih0b2tlbkRlY2ltYWxzKTsKCQkJKHBhaWRFVEhbX2Zyb21dLCBwYWlkRVRIW190b10pID0gdHJhbnNmZXJEaXYoc3RhcnRUb2tlbnMsIGZyb21Ub2tlbnMsIHRvVG9rZW5zLCBwYWlkRVRIW19mcm9tXSwgcGFpZEVUSFtfdG9dLCBhY2NydWVEaXZpZGVuZHNQZXJYVG9rZW5FVEgrYWNjcnVlQ291cG9uc1BlclhUb2tlbkVUSCk7CgkJfQogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlciB0b2tlbnMKICAgICAqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBmcm9tIHlvdXIgYWNjb3VudAogICAgICoKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IHRvIHNlbmQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEJhbGFuY2Ugb2YgdG9rZW5zCiAgICAgKgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0b2tlbiB3YWxsZXQKICAgICAqLwoJZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CgkJcmV0dXJuIGJhbGFuY2VzW19vd25lcl07Cgl9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRvdGFsIGlzc3VlZCB0b2tlbnMgbnVtYmVyCiAgICAgKgoJKi8KCWZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG90YWxTdXBwbHkpIHsKCQlyZXR1cm4gX3RvdGFsU3VwcGx5OwoJfQoKCiAgICAvKioKICAgICAqIFRyYW5zZmVyIHRva2VucyBmcm9tIG90aGVyIGFkZHJlc3MKICAgICAqCiAgICAgKiBTZW5kIGBfdmFsdWVgIHRva2VucyB0byBgX3RvYCBpbiBiZWhhbGYgb2YgYF9mcm9tYAogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAqIEBwYXJhbSBfdmFsdWUgdGhlIGFtb3VudCB0byBzZW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7ICAgICAvLyBDaGVjayBhbGxvd2FuY2UKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYWxsb3dhbmNlIGZvciBvdGhlciBhZGRyZXNzCiAgICAgKgogICAgICogQWxsb3dzIGBfc3BlbmRlcmAgdG8gc3BlbmQgbm8gbW9yZSB0aGFuIGBfdmFsdWVgIHRva2VucyBpbiB5b3VyIGJlaGFsZgogICAgICoKICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBhdXRob3JpemVkIHRvIHNwZW5kCiAgICAgKiBAcGFyYW0gX3ZhbHVlIHRoZSBtYXggYW1vdW50IHRoZXkgY2FuIHNwZW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgYWxsb3dhbmNlIGZvciBhZGRyZXNzCiAgICAgKgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB3aG8gYXV0aG9yaXplIHRvIHNwZW5kCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3MgYXV0aG9yaXplZCB0byBzcGVuZAogICAgICovCglmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewoJCXJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwoJfQoKCgkvLyBUaGlzIG5vdGlmaWVzIGNsaWVudHMgYWJvdXQgdGhlIGFtb3VudCBidXJudAogICAgZXZlbnQgQnVybihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgdWludDI1NiB2YWx1ZSk7CgogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBmdW5jdGlvbiBkZXN0cm95IHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBidXJuVG8odWludDI1NiBfdmFsdWUsIGFkZHJlc3MgYWRyKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW2Fkcl0gPj0gX3ZhbHVlKTsgICAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2gKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOyAgIC8vIENoZWNrIGlmIHRoZSBzZW5kZXIgaGFzIGVub3VnaAoJCXVpbnQgc3RhcnRUb2tlbnMgPSBiYWxhbmNlc1thZHJdLmRpdih0b2tlbkRlY2ltYWxzKTsKICAgICAgICBiYWxhbmNlc1thZHJdIC09IF92YWx1ZTsgICAgICAgICAgICAvLyBTdWJ0cmFjdCBmcm9tIHRoZSBzZW5kZXIKCQl1aW50IGVuZFRva2VucyA9IGJhbGFuY2VzW2Fkcl0uZGl2KHRva2VuRGVjaW1hbHMpOwoKCQl1aW50IHN1bVRvUGF5RnJvbSA9IGVuZFRva2Vucy5tdWwoYWNjcnVlRGl2aWRlbmRzUGVyWFRva2VuRVRIICsgYWNjcnVlQ291cG9uc1BlclhUb2tlbkVUSCk7CgkJdWludCBkaXZFVEggPSBwYWlkRVRIW2Fkcl0uZGl2KHN0YXJ0VG9rZW5zKTsKCQlkaXZFVEggPSBkaXZFVEgubXVsKGVuZFRva2Vucyk7CgkJaWYgKGRpdkVUSCA+IHN1bVRvUGF5RnJvbSkgewoJCQlwYWlkRVRIW2Fkcl0gPSBzdW1Ub1BheUZyb207CgkJfSBlbHNlIHsKCQkJcGFpZEVUSFthZHJdID0gZGl2RVRIOwoJCX0KCgkJX3RvdGFsU3VwcGx5IC09IF92YWx1ZTsgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlcyB0b3RhbFN1cHBseQogICAgICAgIEJ1cm4oYWRyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRGVsZXRlIHRva2VucyB0b2tlbnMgZHVyaW5nIHRoZSBlbmQgb2YgY3JvdWRmdW5kaW5nIAogICAgICogKGluIGNhc2Ugb2YgZXJyb3JzIG1hZGUgYnkgY3Jvd2RmbnVkaW5nIHBhcnRpY2lwYW50cykKICAgICAqIE9ubHkgb3duZXIgY291bGQgY2FsbAogICAgICovCiAgICBmdW5jdGlvbiBkZWxldGVUb2tlbnMoYWRkcmVzcyBhZHIsIHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgb25seU93bmVyIGNhbk1pbnQgewogICAgICAgIGJ1cm5UbyhhbW91bnQsIGFkcik7CiAgICB9CgoJYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CglldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwoJZXZlbnQgTWludEZpbmlzaGVkKCk7CgoJLy9DaGVjayBpZiBpdCBpcyBwb3NzaWJsZSB0byBtaW50IG5ldyB0b2tlbnMgKG1pbnQgYWxsb3dlZCBvbmx5IGR1cmluZyBjcm91ZGZ1bmRpbmcpCgltb2RpZmllciBjYW5NaW50KCkgewoJCXJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CgkJXzsKCX0KCQoJZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewoJfQoKCS8vV2l0aGRyYXcgdW51c2VkIEVUSCBmcm9tIGNvbnRyYWN0IHRvIG93bmVyCglmdW5jdGlvbiBXaXRoZHJhd0xlZnRUb093bmVyKHVpbnQgc3VtKSBwdWJsaWMgb25seU93bmVyIHsKCSAgICBvd25lci50cmFuc2ZlcihzdW0pOwoJfQoJCiAgICAvKioKICAgICAqIE1pbnQgYWRkaXRpb25hbCB0b2tlbnMgYXQgdGhlIGVuZCBvZiBjcm91ZGZ1bmRpbmcKICAgICAqLwoJZnVuY3Rpb24gbWludFRva2VuKGFkZHJlc3MgdGFyZ2V0LCB1aW50MjU2IG1pbnRlZEFtb3VudCkgcHVibGljIG9ubHlPd25lciBjYW5NaW50ICB7CgkJYmFsYW5jZXNbdGFyZ2V0XSArPSBtaW50ZWRBbW91bnQ7CgkJdWludCB0b2tlbnNJblggPSBtaW50ZWRBbW91bnQuZGl2KHRva2VuRGVjaW1hbHMpOwoJCXBhaWRFVEhbdGFyZ2V0XSArPSB0b2tlbnNJblgubXVsKGFjY3J1ZURpdmlkZW5kc1BlclhUb2tlbkVUSCArIGFjY3J1ZUNvdXBvbnNQZXJYVG9rZW5FVEgpOwoJCV90b3RhbFN1cHBseSArPSBtaW50ZWRBbW91bnQ7CgkJTWludChvd25lciwgbWludGVkQW1vdW50KTsKCQlUcmFuc2ZlcigweDAsIHRhcmdldCwgbWludGVkQW1vdW50KTsKCX0KCiAgICAvKioKICAgICAqIEZpbmlzaCBtaW50aW5nCiAgICAgKi8KCWZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBwdWJsaWMgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKCQltaW50aW5nRmluaXNoZWQgPSB0cnVlOwoJCWVuZFNhbGVUaW1lID0gbm93OwoJCXN0YXJ0UmVidXlUaW1lID0gZW5kU2FsZVRpbWUgKyAoMTgwICogMSBkYXlzKTsKCQlNaW50RmluaXNoZWQoKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCiAgICAvKioKICAgICAqIFdpdGhkcmF3IGFjY3J1ZWQgZGl2aWRlbmRzIGFuZCBjb3Vwb25zCiAgICAgKi8KCWZ1bmN0aW9uIFdpdGhkcmF3RGl2aWRlbmRzQW5kQ291cG9ucygpIHB1YmxpYyB7CgkJd2l0aGRyYXdUbyhtc2cuc2VuZGVyLDApOwoJfQoKICAgIC8qKgogICAgICogT3duZXIgY291bGQgaW5pdGlhdGUgYSB3aXRoZHJhd2FsIG9mIGFjY3J1ZWQgZGl2aWRlbmRzIGFuZCBjb3Vwb25zIHRvIHNvbWUgYWRkcmVzcyAoaW4gcHVycG9zZSB0byBoZWxwIHVzZXJzKQogICAgICovCglmdW5jdGlvbiBXaXRoZHJhd0RpdmlkZW5kc0FuZENvdXBvbnNUbyhhZGRyZXNzIF9zZW5kYWRyKSBwdWJsaWMgb25seU93bmVyIHsKCQl3aXRoZHJhd1RvKF9zZW5kYWRyLCB0eC5nYXNwcmljZSAqIGJsb2NrLmdhc2xpbWl0KTsKCX0KCiAgICAvKioKICAgICAqIEludGVybmFsIGZ1bmN0aW9uIHRvIHdpdGhkcmF3IGFjY3J1ZWQgZGl2aWRlbmRzIGFuZCBjb3Vwb25zCiAgICAgKi8KCWZ1bmN0aW9uIHdpdGhkcmF3VG8oYWRkcmVzcyBfc2VuZGFkciwgdWludCBjb21pc3MpIGludGVybmFsIHsKCQl1aW50IHRva2Vuc1BlclggPSBiYWxhbmNlc1tfc2VuZGFkcl0uZGl2KHRva2VuRGVjaW1hbHMpOwoJCXVpbnQgc3VtUGF5ZCA9IHBhaWRFVEhbX3NlbmRhZHJdOwoJCXVpbnQgc3VtVG9QYXlSZXMgPSB0b2tlbnNQZXJYLm11bChhY2NydWVDb3Vwb25zUGVyWFRva2VuRVRIK2FjY3J1ZURpdmlkZW5kc1BlclhUb2tlbkVUSCk7CgkJdWludCBzdW1Ub1BheSA9IHN1bVRvUGF5UmVzLnN1Yihjb21pc3MpOwoJCXJlcXVpcmUoc3VtVG9QYXk+c3VtUGF5ZCk7CgkJc3VtVG9QYXkgPSBzdW1Ub1BheS5zdWIoc3VtUGF5ZCk7CgkJX3NlbmRhZHIudHJhbnNmZXIoc3VtVG9QYXkpOwoJCXBhaWRFVEhbX3NlbmRhZHJdID0gc3VtVG9QYXlSZXM7Cgl9CgogICAgLyoqCiAgICAgKiBPd25lciBhY2NydWUgbmV3IHN1bSBvZiBkaXZpZGVuZHMgYW5kIGNvdXBvbnMgKG9uY2UgcGVyIG1vbnRoKQogICAgICovCglmdW5jdGlvbiBhY2NydWVEaXZpZGVuZGFuZENvdXBvbnModWludCBzdW1EaXZGaW5uZXksIHVpbnQgc3VtRmlubmV5Q291cCkgcHVibGljIG9ubHlPd25lciB7CgkJc3VtRGl2RmlubmV5ID0gc3VtRGl2RmlubmV5ICogMSBmaW5uZXk7CgkJc3VtRmlubmV5Q291cCA9IHN1bUZpbm5leUNvdXAgKiAxIGZpbm5leTsKCQl1aW50IHRva2VucyA9IF90b3RhbFN1cHBseS5kaXYodG9rZW5EZWNpbWFscyk7CgkJYWNjcnVlRGl2aWRlbmRzUGVyWFRva2VuRVRIID0gYWNjcnVlRGl2aWRlbmRzUGVyWFRva2VuRVRILmFkZChzdW1EaXZGaW5uZXkuZGl2KHRva2VucykpOwoJCWFjY3J1ZUNvdXBvbnNQZXJYVG9rZW5FVEggPSBhY2NydWVDb3Vwb25zUGVyWFRva2VuRVRILmFkZChzdW1GaW5uZXlDb3VwLmRpdih0b2tlbnMpKTsKCX0KCiAgICAvKioKICAgICAqIFNldCBhIHByaWNlIG9mIHRva2VuIHRvIHJlYnV5CiAgICAgKi8KCWZ1bmN0aW9uIHNldFRva2VuUHJpY2UodWludCBwcmljZUZpbm5leSkgcHVibGljIG9ubHlPd25lciB7CgkJdG9rZW5QcmljZUVUSCA9IHByaWNlRmlubmV5ICogMSBmaW5uZXk7Cgl9CgoJZXZlbnQgUmVidXlJbmZvcm1FdmVudChhZGRyZXNzIGluZGV4ZWQgYWRyLCB1aW50MjU2IGFtb3VudCk7CgogICAgLyoqCiAgICAgKiBJbmZvcm0gb3duZXIgdGhhdCBzb21lb25lIHdoYW50IHRvIHNlbGwgdG9rZW5zCiAgICAgKiBUaGUgcmVidXkgcHJvY2Nlc3MgYWxsb3dlZCBpbiAyIHdlZWtzIGFmdGVyIGluZm9ybQogICAgICogT25seSBhZnRlciBoYWxmIGEgeWVhciBhZnRlciBjcm91ZGZ1bmRpbmcKICAgICAqLwoJZnVuY3Rpb24gSW5mb3JtUmVidXkodWludCBzdW0pIHB1YmxpYyB7CgkJX2luZm9ybVJlYnV5VG8oc3VtLCBtc2cuc2VuZGVyKTsKCX0KCglmdW5jdGlvbiBJbmZvcm1SZWJ1eVRvKHVpbnQgc3VtLCBhZGRyZXNzIGFkcikgcHVibGljIG9ubHlPd25lcnsKCQlfaW5mb3JtUmVidXlUbyhzdW0sIGFkcik7Cgl9CgoJZnVuY3Rpb24gX2luZm9ybVJlYnV5VG8odWludCBzdW0sIGFkZHJlc3MgYWRyKSBpbnRlcm5hbHsKCQlyZXF1aXJlIChyZWJ1eVN0YXJ0ZWQgfHwgKG5vdyA+PSBzdGFydFJlYnV5VGltZSkpOwoJCXJlcXVpcmUgKHN1bSA8PSBiYWxhbmNlc1thZHJdKTsKCQlyZWJ1eUluZm9ybVRpbWVbYWRyXSA9IG5vdzsKCQlyZWJ1eVN1bVthZHJdID0gc3VtOwoJCVJlYnV5SW5mb3JtRXZlbnQoYWRyLCBzdW0pOwoJfQoKICAgIC8qKgogICAgICogT3duZXIgY291bGQgYWxsb3cgcmVidXkgcHJvY2Nlc3MgZWFybHkKICAgICAqLwoJZnVuY3Rpb24gU3RhcnRSZWJ1eSgpIHB1YmxpYyBvbmx5T3duZXJ7CgkJcmVidXlTdGFydGVkID0gdHJ1ZTsKCX0KCiAgICAvKioKICAgICogU2VsbCB0b2tlbnMgYWZ0ZXIgMiB3ZWVrcyBmcm9tIGluZm9ybWF0aW9uCiAgICAqLwoJZnVuY3Rpb24gZG9SZWJ1eSgpIHB1YmxpYyB7CgkJX2RvUmVidXlUbyhtc2cuc2VuZGVyLCAwKTsKCX0KICAgIC8qKgogICAgKiBDb250cmFjdCBvd25lciB3b3VsZCBwZXJmb3JtIHRva2VucyByZWJ1eSBhZnRlciAyIHdlZWtzIGZyb20gaW5mb3JtYXRpb24KICAgICovCglmdW5jdGlvbiBkb1JlYnV5VG8oYWRkcmVzcyBhZHIpIHB1YmxpYyBvbmx5T3duZXIgewoJCV9kb1JlYnV5VG8oYWRyLCB0eC5nYXNwcmljZSAqIGJsb2NrLmdhc2xpbWl0KTsKCX0KCWZ1bmN0aW9uIF9kb1JlYnV5VG8oYWRkcmVzcyBhZHIsIHVpbnQgY29taXNzKSBpbnRlcm5hbCB7CgkJcmVxdWlyZSAocmVidXlTdGFydGVkIHx8IChub3cgPj0gc3RhcnRSZWJ1eVRpbWUpKTsKCQlyZXF1aXJlIChub3cgPj0gcmVidXlJbmZvcm1UaW1lW2Fkcl0uYWRkKDE0IGRheXMpKTsKCQl1aW50IHN1bSA9IHJlYnV5U3VtW2Fkcl07CgkJcmVxdWlyZSAoc3VtIDw9IGJhbGFuY2VzW2Fkcl0pOwoJCXdpdGhkcmF3VG8oYWRyLCAwKTsKCQlpZiAoYnVyblRvKHN1bSwgYWRyKSkgewoJCQlzdW0gPSBzdW0uZGl2KHRva2VuRGVjaW1hbHMpOwoJCQlzdW0gPSBzdW0ubXVsKHRva2VuUHJpY2VFVEgpOwoJCQlzdW0gPSBzdW0uZGl2KHRva2VuRGVjaW1hbHNMZWZ0KTsKCQkJc3VtID0gc3VtLnN1Yihjb21pc3MpOwoJCQlhZHIudHJhbnNmZXIoc3VtKTsKCQkJcmVidXlTdW1bYWRyXSA9IDA7CgkJfQoJfQoKfQoKY29udHJhY3QgVFNCQ3Jvd2RGdW5kaW5nQ29udHJhY3QgaXMgTmFtZWRPd25lZFRva2VuewoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoKCWVudW0gQ3Jvd2RTYWxlU3RhdGUge05vdEZpbmlzaGVkLCBTdWNjZXNzLCBGYWlsdXJlfQoJQ3Jvd2RTYWxlU3RhdGUgcHVibGljIGNyb3dkU2FsZVN0YXRlID0gQ3Jvd2RTYWxlU3RhdGUuTm90RmluaXNoZWQ7CgoKICAgIHVpbnQgcHVibGljIGZ1bmRpbmdHb2FsVVNEID0gMjAwMDAwOyAvL01pbiBjYXAKICAgIHVpbnQgcHVibGljIGZ1bmRpbmdNYXhDYXBVU0QgPSA1MDAwMDA7IC8vTWF4IGNhcAogICAgdWludCBwdWJsaWMgcHJpY2VVU0QgPSAxOyAvL1ByaWNlIGluIFVTRCBwZXIgMSB0b2tlbgoJdWludCBwdWJsaWMgVVNERGVjaW1hbHMgPSAxIGV0aGVyOwoKCXVpbnQgcHVibGljIHN0YXJ0VGltZTsgLy9jcm93ZGZ1bmRpbmcgc3RhcnQgdGltZQogICAgdWludCBwdWJsaWMgZW5kVGltZTsgLy9jcm93ZGZ1bmRpbmcgZW5kIHRpbWUKICAgIHVpbnQgcHVibGljIGJvbnVzRW5kVGltZTsgLy9jcm93ZGZ1bmRpbmcgZW5kIG9mIGJvbnVzIHRpbWUKICAgIHVpbnQgcHVibGljIHNlbGZEZXN0cm95VGltZSA9IDIgd2Vla3M7CiAgICBUU0JUb2tlbiBwdWJsaWMgdG9rZW5SZXdhcmQ7IC8vVFNCIFRva2VuIHRvIHNlbmQKCQoJdWludCBwdWJsaWMgRVRIUHJpY2UgPSAzMDAwMDsgLy9DdXJyZW50IHByaWNlIG9mIG9uZSBFVEggaW4gVVNEIGNlbnRzCgl1aW50IHB1YmxpYyBCVENQcmljZSA9IDQwMDAwMDsgLy9DdXJyZW50IHByaWNlIG9mIG9uZSBCVEMgaW4gVVNEIGNlbnRzCgl1aW50IHB1YmxpYyBQcmljZURlY2ltYWxzID0gMTAwOwoKCXVpbnQgcHVibGljIEVUSENvbGxlY3RlZCA9IDA7IC8vQ29sbGVjdGVkIHN1bSBvZiBFVEgKCXVpbnQgcHVibGljIEJUQ0NvbGxlY3RlZCA9IDA7IC8vQ29sbGVjdGVkIHN1bSBvZiBCVEMKCXVpbnQgcHVibGljIGFtb3VudFJhaXNlZFVTRCA9IDA7IC8vQ29sbGVjdGVkIHN1bSBpbiBVU0QKCXVpbnQgcHVibGljIFRva2VuQW1vdW50VG9QYXkgPSAwOyAvL051bWJlciBvZiB0b2tlbnMgdG8gZGlzdHJpYnV0ZSAoZXhjbHVkaW5nIGJvbnVzIHRva2VucykKCgltYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VNYXBQb3M7CglzdHJ1Y3QgbWFwU3RydWN0IHsKCQlhZGRyZXNzIG1hcEFkZHJlc3M7CgkJdWludCBtYXBCYWxhbmNlRVRIOwoJCXVpbnQgbWFwQmFsYW5jZUJUQzsKCQl1aW50IGJvbnVzVG9rZW5zOwoJfQoJbWFwU3RydWN0W10gcHVibGljIGJhbGFuY2VMaXN0OyAvL0FycmF5IG9mIHN0cnVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IGludmVzdGVkIHN1bXMKCiAgICB1aW50IHB1YmxpYyBib251c0NhcFVTRCA9IDEwMDAwMDsgLy9Cb251cyBjYXAKCW1hcHBpbmcoYnl0ZXMzMiA9PiB1aW50MjU2KSBwdWJsaWMgYm9udXNlc01hcFBvczsKCXN0cnVjdCBib251c1N0cnVjdCB7CgkJdWludCBiYWxhbmNlUG9zOwoJCWJvb2wgbm90ZW1wdHk7CgkJdWludCBtYXhCb251c0VUSDsKCQl1aW50IG1heEJvbnVzQlRDOwoJCXVpbnQgYm9udXNFVEg7CgkJdWludCBib251c0JUQzsKCQl1aW50OCBib251c1BlcmNlbnQ7Cgl9Cglib251c1N0cnVjdFtdIHB1YmxpYyBib251c2VzTGlzdDsgLy9BcnJheSBvZiBzdHJ1Y3Qgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCBib251c2VzCgkKICAgIGJvb2wgcHVibGljIGZ1bmRpbmdHb2FsUmVhY2hlZCA9IGZhbHNlOyAKICAgIGJvb2wgcHVibGljIGNyb3dkc2FsZUNsb3NlZCA9IGZhbHNlOwoKICAgIGV2ZW50IEdvYWxSZWFjaGVkKGFkZHJlc3MgYmVuZWZpY2lhcnksIHVpbnQgYW1vdW50UmFpc2VkKTsKICAgIGV2ZW50IEZ1bmRUcmFuc2ZlcihhZGRyZXNzIGJhY2tlciwgdWludCBhbW91bnQsIGJvb2wgaXNDb250cmlidXRpb24pOwoKCWZ1bmN0aW9uIFRTQkNyb3dkRnVuZGluZ0NvbnRyYWN0KCAKCQl1aW50IF9zdGFydFRpbWUsCiAgICAgICAgdWludCBkdXJhdGlvbkluSG91cnMsCiAgICAgICAgc3RyaW5nIHRva2VuTmFtZSwKICAgICAgICBzdHJpbmcgdG9rZW5TeW1ib2wKCSkgTmFtZWRPd25lZFRva2VuKHRva2VuTmFtZSwgdG9rZW5TeW1ib2wpIHB1YmxpYyB7CgkvLwlyZXF1aXJlKF9zdGFydFRpbWUgPj0gbm93KTsKCSAgICBTZXRTdGFydFRpbWUoX3N0YXJ0VGltZSwgZHVyYXRpb25JbkhvdXJzKTsKCQlib251c0NhcFVTRCA9IGJvbnVzQ2FwVVNEICogVVNERGVjaW1hbHM7Cgl9CgogICAgZnVuY3Rpb24gU2V0U3RhcnRUaW1lKHVpbnQgc3RhcnRULCB1aW50IGR1cmF0aW9uSW5Ib3VycykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc3RhcnRUaW1lID0gc3RhcnRUOwogICAgICAgIGJvbnVzRW5kVGltZSA9IHN0YXJ0VCsgMjQgaG91cnM7CiAgICAgICAgZW5kVGltZSA9IHN0YXJ0VCArIChkdXJhdGlvbkluSG91cnMgKiAxIGhvdXJzKTsKICAgIH0KCglmdW5jdGlvbiBhc3NpZ25Ub2tlbkNvbnRyYWN0KGFkZHJlc3MgdG9rKSBwdWJsaWMgb25seU93bmVyICAgewoJCXRva2VuUmV3YXJkID0gVFNCVG9rZW4odG9rKTsKCQl0b2tlblJld2FyZC50cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzKHRoaXMpKTsKCX0KCglmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CgkJYm9vbCB3aXRoaW5QZXJpb2QgPSBub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lOwoJCWJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CgkJcmVxdWlyZSggd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZSAmJiAoY3Jvd2RTYWxlU3RhdGUgPT0gQ3Jvd2RTYWxlU3RhdGUuTm90RmluaXNoZWQpKTsKCQl1aW50IGJvbnVzcG9zID0gMDsKCQlpZiAobm93IDw9IGJvbnVzRW5kVGltZSkgewovLwkJICAgIGxhc3RkYXRhID0gbXNnLmRhdGE7CgkJCWJ5dGVzMzIgY29kZSA9IHNoYTMobXNnLmRhdGEpOwoJCQlib251c3BvcyA9IGJvbnVzZXNNYXBQb3NbY29kZV07CgkJfQoJCVJlY2VpdmVBbW91bnQobXNnLnNlbmRlciwgbXNnLnZhbHVlLCAwLCBub3csIGJvbnVzcG9zKTsKCgl9CgoJZnVuY3Rpb24gQ2hlY2tCVEN0cmFuc2FjdGlvbigpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiBBZGRCVENUcmFuc2FjdGlvbkZyb21BcnJheSAoYWRkcmVzc1tdIEVUSGFkcmVzcywgdWludFtdIEJUQ251bSwgdWludFtdIFRyYW5zVGltZSwgYnl0ZXM0W10gYm9udXNkYXRhKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKEVUSGFkcmVzcy5sZW5ndGggPT0gQlRDbnVtLmxlbmd0aCk7IAogICAgICAgIHJlcXVpcmUoVHJhbnNUaW1lLmxlbmd0aCA9PSBib251c2RhdGEubGVuZ3RoKTsKICAgICAgICByZXF1aXJlKEVUSGFkcmVzcy5sZW5ndGggPT0gYm9udXNkYXRhLmxlbmd0aCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgRVRIYWRyZXNzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIEFkZEJUQ1RyYW5zYWN0aW9uKEVUSGFkcmVzc1tpXSwgQlRDbnVtW2ldLCBUcmFuc1RpbWVbaV0sIGJvbnVzZGF0YVtpXSk7CiAgICAgICAgfQoJfQogICAgLyoqCiAgICAgKiBBZGQgdHJhbnNmZXJlZCBCVEMsIG9ubHkgb3duZXIgY291bGQgY2FsbAogICAgICoKICAgICAqIEBwYXJhbSBFVEhhZHJlc3MgVGhlIGFkZHJlc3Mgb2YgZXRoZXJldW0gd2FsbGV0IG9mIHNlbmRlciAKICAgICAqIEBwYXJhbSBCVENudW0gdGhlIHJlY2VpdmVkIGFtb3VudCBpbiBCVEMgKiAxMF4xOAogICAgICogQHBhcmFtIFRyYW5zVGltZSB0aGUgb3JpZ2luYWwgKEJUQykgdHJhbnNhY3Rpb24gdGltZQogICAgICovCglmdW5jdGlvbiBBZGRCVENUcmFuc2FjdGlvbiAoYWRkcmVzcyBFVEhhZHJlc3MsIHVpbnQgQlRDbnVtLCB1aW50IFRyYW5zVGltZSwgYnl0ZXM0IGJvbnVzZGF0YSkgcHVibGljIG9ubHlPd25lciB7CgkJcmVxdWlyZShDaGVja0JUQ3RyYW5zYWN0aW9uKCkpOwoJCXJlcXVpcmUoKFRyYW5zVGltZSA+PSBzdGFydFRpbWUpICYmIChUcmFuc1RpbWUgPD0gZW5kVGltZSkpOwoJCXJlcXVpcmUoQlRDbnVtICE9IDApOwoJCXVpbnQgYm9udXNwb3MgPSAwOwoJCWlmIChUcmFuc1RpbWUgPD0gYm9udXNFbmRUaW1lKSB7Ci8vCQkgICAgbGFzdGRhdGEgPSBib251c2RhdGE7CgkJCWJ5dGVzMzIgY29kZSA9IHNoYTMoYm9udXNkYXRhKTsKCQkJYm9udXNwb3MgPSBib251c2VzTWFwUG9zW2NvZGVdOwoJCX0KCQlSZWNlaXZlQW1vdW50KEVUSGFkcmVzcywgMCwgQlRDbnVtLCBUcmFuc1RpbWUsIGJvbnVzcG9zKTsKCX0KCgltb2RpZmllciBhZnRlckRlYWRsaW5lKCkgeyBpZiAobm93ID49IGVuZFRpbWUpIF87IH0KCiAgICAvKioKICAgICAqIFNldCBwcmljZSBmb3IgRVRIIGFuZCBCVEMsIG9ubHkgb3duZXIgY291bGQgY2FsbAogICAgICoKICAgICAqIEBwYXJhbSBfRVRIUHJpY2UgRVRIIHByaWNlIGluIFVTRCBjZW50cwogICAgICogQHBhcmFtIF9CVENQcmljZSBCVEMgcHJpY2UgaW4gVVNEIGNlbnRzCiAgICAgKi8KCWZ1bmN0aW9uIFNldENyeXB0b1ByaWNlKHVpbnQgX0VUSFByaWNlLCB1aW50IF9CVENQcmljZSkgcHVibGljIG9ubHlPd25lciB7CgkJRVRIUHJpY2UgPSBfRVRIUHJpY2U7CgkJQlRDUHJpY2UgPSBfQlRDUHJpY2U7Cgl9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHN1bSBpbiBFVEggcGx1cyBCVEMgdG8gVVNECiAgICAgKgogICAgICogQHBhcmFtIEVUSCBFVEggc3VtIGluIHdlaQogICAgICogQHBhcmFtIEJUQyBCVEMgc3VtIGluIDEwXjE4CiAgICAgKi8KCWZ1bmN0aW9uIGNvbnZlcnRUb1VTRCh1aW50IEVUSCwgdWludCBCVEMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CgkJdWludCBfRVRIID0gRVRILm11bChFVEhQcmljZSk7CgkJdWludCBfQlRDID0gQlRDLm11bChCVENQcmljZSk7CgkJcmV0dXJuIChfRVRIK19CVEMpLmRpdihQcmljZURlY2ltYWxzKTsKCX0KCiAgICAvKioKICAgICAqIENhbGMgY29sbGVjdGVkIHN1bSBpbiBVU0QKICAgICAqLwoJZnVuY3Rpb24gY29sbGVjdGVkU3VtKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKCQlyZXR1cm4gY29udmVydFRvVVNEKEVUSENvbGxlY3RlZCxCVENDb2xsZWN0ZWQpOwoJfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgbWluIGNhcCB3YXMgcmVhY2hlZCAob25seSBhZnRlciBmaW5pc2ggb2YgY3Jvd2RmdW5kaW5nKQogICAgICovCiAgICBmdW5jdGlvbiBjaGVja0dvYWxSZWFjaGVkKCkgcHVibGljIGFmdGVyRGVhZGxpbmUgewoJCWFtb3VudFJhaXNlZFVTRCA9IGNvbGxlY3RlZFN1bSgpOwogICAgICAgIGlmIChhbW91bnRSYWlzZWRVU0QgPj0gKGZ1bmRpbmdHb2FsVVNEICogVVNERGVjaW1hbHMpICl7CgkJCWNyb3dkU2FsZVN0YXRlID0gQ3Jvd2RTYWxlU3RhdGUuU3VjY2VzczsKCQkJVG9rZW5BbW91bnRUb1BheSA9IGFtb3VudFJhaXNlZFVTRDsKICAgICAgICAgICAgR29hbFJlYWNoZWQob3duZXIsIGFtb3VudFJhaXNlZFVTRCk7CiAgICAgICAgfSBlbHNlIHsKCQkJY3Jvd2RTYWxlU3RhdGUgPSBDcm93ZFNhbGVTdGF0ZS5GYWlsdXJlOwoJCX0KICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIG1heCBjYXAgd2FzIHJlYWNoZWQKICAgICAqLwogICAgZnVuY3Rpb24gY2hlY2tNYXhDYXBSZWFjaGVkKCkgcHVibGljIHsKCQlhbW91bnRSYWlzZWRVU0QgPSBjb2xsZWN0ZWRTdW0oKTsKICAgICAgICBpZiAoYW1vdW50UmFpc2VkVVNEID49IChmdW5kaW5nTWF4Q2FwVVNEICogVVNERGVjaW1hbHMpICl7CgkgICAgICAgIGNyb3dkU2FsZVN0YXRlID0gQ3Jvd2RTYWxlU3RhdGUuU3VjY2VzczsKCQkJVG9rZW5BbW91bnRUb1BheSA9IGFtb3VudFJhaXNlZFVTRDsKICAgICAgICAgICAgR29hbFJlYWNoZWQob3duZXIsIGFtb3VudFJhaXNlZFVTRCk7CiAgICAgICAgfQogICAgfQoKCWZ1bmN0aW9uIFJlY2VpdmVBbW91bnQoYWRkcmVzcyBpbnZlc3RvciwgdWludCBzdW1FVEgsIHVpbnQgc3VtQlRDLCB1aW50IFRyYW5zVGltZSwgdWludCBib251c3BvcykgaW50ZXJuYWwgewoJCXJlcXVpcmUoaW52ZXN0b3IgIT0gMHgwKTsKCgkJdWludCBwb3MgPSBiYWxhbmNlTWFwUG9zW2ludmVzdG9yXTsKCQlpZiAocG9zPjApIHsKCQkJcG9zLS07CgkJCWFzc2VydChwb3MgPCBiYWxhbmNlTGlzdC5sZW5ndGgpOwoJCQlhc3NlcnQoYmFsYW5jZUxpc3RbcG9zXS5tYXBBZGRyZXNzID09IGludmVzdG9yKTsKCQkJYmFsYW5jZUxpc3RbcG9zXS5tYXBCYWxhbmNlRVRIID0gYmFsYW5jZUxpc3RbcG9zXS5tYXBCYWxhbmNlRVRILmFkZChzdW1FVEgpOwoJCQliYWxhbmNlTGlzdFtwb3NdLm1hcEJhbGFuY2VCVEMgPSBiYWxhbmNlTGlzdFtwb3NdLm1hcEJhbGFuY2VCVEMuYWRkKHN1bUJUQyk7CgkJfSBlbHNlIHsKCQkJbWFwU3RydWN0IG1lbW9yeSBuZXdTdHJ1Y3Q7CgkJCW5ld1N0cnVjdC5tYXBBZGRyZXNzID0gaW52ZXN0b3I7CgkJCW5ld1N0cnVjdC5tYXBCYWxhbmNlRVRIID0gc3VtRVRIOwoJCQluZXdTdHJ1Y3QubWFwQmFsYW5jZUJUQyA9IHN1bUJUQzsKCQkJbmV3U3RydWN0LmJvbnVzVG9rZW5zID0gMDsKCQkJcG9zID0gYmFsYW5jZUxpc3QucHVzaChuZXdTdHJ1Y3QpOwkJCgkJCWJhbGFuY2VNYXBQb3NbaW52ZXN0b3JdID0gcG9zOwoJCQlwb3MtLTsKCQl9CgkJCgkJLy8gdXBkYXRlIHN0YXRlCgkJRVRIQ29sbGVjdGVkID0gRVRIQ29sbGVjdGVkLmFkZChzdW1FVEgpOwoJCUJUQ0NvbGxlY3RlZCA9IEJUQ0NvbGxlY3RlZC5hZGQoc3VtQlRDKTsKCQkKCQljaGVja0JvbnVzKHBvcywgc3VtRVRILCBzdW1CVEMsIFRyYW5zVGltZSwgYm9udXNwb3MpOwoJCWNoZWNrTWF4Q2FwUmVhY2hlZCgpOwoJfQoKCXVpbnQgcHVibGljIERpc3RyaWJ1dGlvbk5leHRQb3MgPSAwOwoKICAgIC8qKgogICAgICogRGlzdHJpYnV0ZSB0b2tlbnMgdG8gbmV4dCBOIHBhcnRpY2lwYW50cywgb25seSBvd25lciBjb3VsZCBjYWxsCiAgICAgKi8KCWZ1bmN0aW9uIERpc3RyaWJ1dGVOZXh0TlRva2Vucyh1aW50IG4pIHB1YmxpYyBwYXlhYmxlIG9ubHlPd25lciB7CgkJcmVxdWlyZShCb251c2VzRGlzdHJpYnV0ZWQpOwoJCXJlcXVpcmUoRGlzdHJpYnV0aW9uTmV4dFBvczxiYWxhbmNlTGlzdC5sZW5ndGgpOwoJCXVpbnQgbmV4dHBvczsKCQlpZiAobiA9PSAwKSB7CgkJICAgIG5leHRwb3MgPSBiYWxhbmNlTGlzdC5sZW5ndGg7CgkJfSBlbHNlIHsKICAgIAkJbmV4dHBvcyA9IERpc3RyaWJ1dGlvbk5leHRQb3MuYWRkKG4pOwogICAgCQlpZiAobmV4dHBvcyA+IGJhbGFuY2VMaXN0Lmxlbmd0aCkgewogICAgCQkJbmV4dHBvcyA9IGJhbGFuY2VMaXN0Lmxlbmd0aDsKICAgIAkJfQoJCX0KCQl1aW50IFRva2VuQW1vdW50VG9QYXlfbG9jYWwgPSBUb2tlbkFtb3VudFRvUGF5OwoJCWZvciAodWludCBpID0gRGlzdHJpYnV0aW9uTmV4dFBvczsgaSA8IG5leHRwb3M7IGkrKykgewoJCQl1aW50IFVTRGJhbGFuY2UgPSBjb252ZXJ0VG9VU0QoYmFsYW5jZUxpc3RbaV0ubWFwQmFsYW5jZUVUSCwgYmFsYW5jZUxpc3RbaV0ubWFwQmFsYW5jZUJUQyk7CgkJCXVpbnQgdG9rZW5zQ291bnQgPSBVU0RiYWxhbmNlLm11bChwcmljZVVTRCk7CgkJCXRva2VuUmV3YXJkLm1pbnRUb2tlbihiYWxhbmNlTGlzdFtpXS5tYXBBZGRyZXNzLCB0b2tlbnNDb3VudCArIGJhbGFuY2VMaXN0W2ldLmJvbnVzVG9rZW5zKTsKCQkJVG9rZW5BbW91bnRUb1BheV9sb2NhbCA9IFRva2VuQW1vdW50VG9QYXlfbG9jYWwuc3ViKHRva2Vuc0NvdW50KTsKCQkJYmFsYW5jZUxpc3RbaV0ubWFwQmFsYW5jZUVUSCA9IDA7CgkJCWJhbGFuY2VMaXN0W2ldLm1hcEJhbGFuY2VCVEMgPSAwOwoJCX0KCQlUb2tlbkFtb3VudFRvUGF5ID0gVG9rZW5BbW91bnRUb1BheV9sb2NhbDsKCQlEaXN0cmlidXRpb25OZXh0UG9zID0gbmV4dHBvczsKCX0KCglmdW5jdGlvbiBmaW5pc2hEaXN0cmlidXRpb24oKSAgb25seU93bmVyIHsKCQlyZXF1aXJlICgoVG9rZW5BbW91bnRUb1BheSA9PSAwKXx8KERpc3RyaWJ1dGlvbk5leHRQb3MgPj0gYmFsYW5jZUxpc3QubGVuZ3RoKSk7Ci8vCQl0b2tlblJld2FyZC5maW5pc2hNaW50aW5nKCk7CgkJdG9rZW5SZXdhcmQudHJhbnNmZXJPd25lcnNoaXAob3duZXIpOwoJCXNlbGZkZXN0cnVjdChvd25lcik7Cgl9CgogICAgLyoqCiAgICAgKiBXaXRoZHJhdyB0aGUgZnVuZHMKICAgICAqCiAgICAgKiBDaGVja3MgdG8gc2VlIGlmIGdvYWwgd2FzIG5vdCByZWFjaGVkLCBlYWNoIGNvbnRyaWJ1dG9yIGNhbiB3aXRoZHJhdwogICAgICogdGhlIGFtb3VudCB0aGV5IGNvbnRyaWJ1dGVkLgogICAgICovCiAgICBmdW5jdGlvbiBzYWZlV2l0aGRyYXdhbCgpIHB1YmxpYyBhZnRlckRlYWRsaW5lIHsKICAgICAgICByZXF1aXJlKGNyb3dkU2FsZVN0YXRlID09IENyb3dkU2FsZVN0YXRlLkZhaWx1cmUpOwoJCXVpbnQgcG9zID0gYmFsYW5jZU1hcFBvc1ttc2cuc2VuZGVyXTsKCQlyZXF1aXJlKChwb3M+MCkmJihwb3M8PWJhbGFuY2VMaXN0Lmxlbmd0aCkpOwoJCXBvcy0tOwogICAgICAgIHVpbnQgYW1vdW50ID0gYmFsYW5jZUxpc3RbcG9zXS5tYXBCYWxhbmNlRVRIOwogICAgICAgIGJhbGFuY2VMaXN0W3Bvc10ubWFwQmFsYW5jZUVUSCA9IDA7CiAgICAgICAgaWYgKGFtb3VudCA+IDApIHsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihhbW91bnQpOwogICAgICAgICAgICBGdW5kVHJhbnNmZXIobXNnLnNlbmRlciwgYW1vdW50LCBmYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgc29tZXRoaW5nIGdvZXMgd3Jvbmcgb3duZXIgY291bGQgZGVzdHJveSB0aGUgY29udHJhY3QgYWZ0ZXIgMiB3ZWVrcyBmcm9tIHRoZSBjcm93ZGZ1bmRpbmcgZW5kCiAgICAgKiBJbiB0aGlzIGNhc2UgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBvciBzdW0gcmVmdW5kIHdpbGwgYmUgcGVyZm9ybWVkIGluIG1hbm51YWwKICAgICAqLwoJZnVuY3Rpb24ga2lsbENvbnRyYWN0KCkgcHVibGljIG9ubHlPd25lciB7CgkJcmVxdWlyZShub3cgPj0gZW5kVGltZSArIHNlbGZEZXN0cm95VGltZSk7CgkJdG9rZW5SZXdhcmQudHJhbnNmZXJPd25lcnNoaXAob3duZXIpOwogICAgICAgIHNlbGZkZXN0cnVjdChvd25lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgYm9udXMgY29kZSwgb25seSBvd25lciBjb3VsZCBjYWxsCiAgICAgKi8KCWZ1bmN0aW9uIEFkZEJvbnVzVG9MaXN0RnJvbUFycmF5KGJ5dGVzMzJbXSBib251c0NvZGUsIHVpbnRbXSBFVEhzdW1JbkZpbm5leSwgdWludFtdIEJUQ3N1bUluRmlubmV5KSBwdWJsaWMgb25seU93bmVyIHsKCSAgICByZXF1aXJlKGJvbnVzQ29kZS5sZW5ndGggPT0gRVRIc3VtSW5GaW5uZXkubGVuZ3RoKTsKCSAgICByZXF1aXJlKGJvbnVzQ29kZS5sZW5ndGggPT0gQlRDc3VtSW5GaW5uZXkubGVuZ3RoKTsKCSAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBib251c0NvZGUubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgQWRkQm9udXNUb0xpc3QoYm9udXNDb2RlW2ldLCBFVEhzdW1JbkZpbm5leVtpXSwgQlRDc3VtSW5GaW5uZXlbaV0gKTsKCSAgICB9Cgl9CiAgICAvKioKICAgICAqIEFkZCBhIG5ldyBib251cyBjb2RlLCBvbmx5IG93bmVyIGNvdWxkIGNhbGwKICAgICAqLwoJZnVuY3Rpb24gQWRkQm9udXNUb0xpc3QoYnl0ZXMzMiBib251c0NvZGUsIHVpbnQgRVRIc3VtSW5GaW5uZXksIHVpbnQgQlRDc3VtSW5GaW5uZXkpIHB1YmxpYyBvbmx5T3duZXIgewoJCXVpbnQgcG9zID0gYm9udXNlc01hcFBvc1tib251c0NvZGVdOwoKCQlpZiAocG9zID4gMCkgewoJCQlwb3MgLT0gMTsKCQkJYm9udXNlc0xpc3RbcG9zXS5tYXhCb251c0VUSCA9IEVUSHN1bUluRmlubmV5ICogMSBmaW5uZXk7CgkJCWJvbnVzZXNMaXN0W3Bvc10ubWF4Qm9udXNCVEMgPSBCVENzdW1JbkZpbm5leSAqIDEgZmlubmV5OwoJCX0gZWxzZSB7CgkJCWJvbnVzU3RydWN0IG1lbW9yeSBuZXdTdHJ1Y3Q7CgkJCW5ld1N0cnVjdC5iYWxhbmNlUG9zID0gMDsKCQkJbmV3U3RydWN0Lm5vdGVtcHR5ID0gZmFsc2U7CgkJCW5ld1N0cnVjdC5tYXhCb251c0VUSCA9IEVUSHN1bUluRmlubmV5ICogMSBmaW5uZXk7CgkJCW5ld1N0cnVjdC5tYXhCb251c0JUQyA9IEJUQ3N1bUluRmlubmV5ICogMSBmaW5uZXk7CgkJCW5ld1N0cnVjdC5ib251c0VUSCA9IDA7CgkJCW5ld1N0cnVjdC5ib251c0JUQyA9IDA7CgkJCW5ld1N0cnVjdC5ib251c1BlcmNlbnQgPSAyMDsKCQkJcG9zID0gYm9udXNlc0xpc3QucHVzaChuZXdTdHJ1Y3QpOwkJCgkJCWJvbnVzZXNNYXBQb3NbYm9udXNDb2RlXSA9IHBvczsKCQl9Cgl9Cglib29sIHB1YmxpYyBCb251c2VzRGlzdHJpYnV0ZWQgPSBmYWxzZTsKCXVpbnQgcHVibGljIEJvbnVzQ2FsY1BvcyA9IDA7Ci8vICAgIGJ5dGVzIHB1YmxpYyBsYXN0ZGF0YTsKCWZ1bmN0aW9uIGNoZWNrQm9udXModWludCBuZXdCYWxhbmNlUG9zLCB1aW50IHN1bUVUSCwgdWludCBzdW1CVEMsIHVpbnQgVHJhbnNUaW1lLCB1aW50IHBvcykgaW50ZXJuYWwgewoJCQlpZiAocG9zID4gMCkgewoJCQkJcG9zLS07CgkJCQlpZiAoIWJvbnVzZXNMaXN0W3Bvc10ubm90ZW1wdHkpIHsKCQkJCQlib251c2VzTGlzdFtwb3NdLmJhbGFuY2VQb3MgPSBuZXdCYWxhbmNlUG9zOwoJCQkJCWJvbnVzZXNMaXN0W3Bvc10ubm90ZW1wdHkgPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCSAgICBpZiAoYm9udXNlc0xpc3RbcG9zXS5iYWxhbmNlUG9zICE9IG5ld0JhbGFuY2VQb3MpIHJldHVybjsKCQkJCX0KCQkJCWJvbnVzZXNMaXN0W3Bvc10uYm9udXNFVEggPSBib251c2VzTGlzdFtwb3NdLmJvbnVzRVRILmFkZChzdW1FVEgpOwoJCQkJLy8gaWYgKGJvbnVzZXNMaXN0W3Bvc10uYm9udXNFVEggPiBib251c2VzTGlzdFtwb3NdLm1heEJvbnVzRVRIKQoJCQkJLy8gCWJvbnVzZXNMaXN0W3Bvc10uYm9udXNFVEggPSBib251c2VzTGlzdFtwb3NdLm1heEJvbnVzRVRIOwoJCQkJYm9udXNlc0xpc3RbcG9zXS5ib251c0JUQyA9IGJvbnVzZXNMaXN0W3Bvc10uYm9udXNCVEMuYWRkKHN1bUJUQyk7CgkJCQkvLyBpZiAoYm9udXNlc0xpc3RbcG9zXS5ib251c0JUQyA+IGJvbnVzZXNMaXN0W3Bvc10ubWF4Qm9udXNCVEMpCgkJCQkvLyAJYm9udXNlc0xpc3RbcG9zXS5ib251c0JUQyA9IGJvbnVzZXNMaXN0W3Bvc10ubWF4Qm9udXNCVEM7CgkJCX0KCX0KCiAgICAvKioKICAgICAqIENhbGMgdGhlIG51bWJlciBvZiBib251cyB0b2tlbnMgZm9yIE4gbmV4dCBib251cyBwYXJ0aWNpcGFudHMsIG9ubHkgb3duZXIgY291bGQgY2FsbAogICAgICovCglmdW5jdGlvbiBjYWxjTmV4dE5Cb251c2VzKHVpbnQgTikgcHVibGljIG9ubHlPd25lciB7CgkJcmVxdWlyZShjcm93ZFNhbGVTdGF0ZSA9PSBDcm93ZFNhbGVTdGF0ZS5TdWNjZXNzKTsKCQlyZXF1aXJlKCFCb251c2VzRGlzdHJpYnV0ZWQpOwoJCXVpbnQgbmV4dFBvcyA9IEJvbnVzQ2FsY1BvcyArIE47CgkJaWYgKG5leHRQb3MgPiBib251c2VzTGlzdC5sZW5ndGgpIAoJCQluZXh0UG9zID0gYm9udXNlc0xpc3QubGVuZ3RoOwogICAgICAgIHVpbnQgYm9udXNDYXBVU0RfbG9jYWwgPSBib251c0NhcFVTRDsgICAgCgkJZm9yICh1aW50IGkgPSBCb251c0NhbGNQb3M7IGkgPCBuZXh0UG9zOyBpKyspIHsKCQkJaWYgICgoYm9udXNlc0xpc3RbaV0ubm90ZW1wdHkpICYmIChib251c2VzTGlzdFtpXS5iYWxhbmNlUG9zIDwgYmFsYW5jZUxpc3QubGVuZ3RoKSkgewoJCQkJdWludCBtYXhib251cyA9IGNvbnZlcnRUb1VTRChib251c2VzTGlzdFtpXS5tYXhCb251c0VUSCwgYm9udXNlc0xpc3RbaV0ubWF4Qm9udXNCVEMpOwoJCQkJdWludCBib251cyA9IGNvbnZlcnRUb1VTRChib251c2VzTGlzdFtpXS5ib251c0VUSCwgYm9udXNlc0xpc3RbaV0uYm9udXNCVEMpOwoJCQkJaWYgKG1heGJvbnVzIDwgYm9udXMpCgkJCQkgICAgYm9udXMgPSBtYXhib251czsKCQkJCWJvbnVzID0gYm9udXMubXVsKHByaWNlVVNEKTsKCQkJCWlmIChib251c0NhcFVTRF9sb2NhbCA+PSBib251cykgewoJCQkJCWJvbnVzQ2FwVVNEX2xvY2FsID0gYm9udXNDYXBVU0RfbG9jYWwgLSBib251czsKCQkJCX0gZWxzZSB7CgkJCQkJYm9udXMgPSBib251c0NhcFVTRF9sb2NhbDsKCQkJCQlib251c0NhcFVTRF9sb2NhbCA9IDA7CgkJCQl9CgkJCQlib251cyA9IGJvbnVzLm11bChib251c2VzTGlzdFtpXS5ib251c1BlcmNlbnQpIC8gMTAwOwoJCQkJYmFsYW5jZUxpc3RbYm9udXNlc0xpc3RbaV0uYmFsYW5jZVBvc10uYm9udXNUb2tlbnMgPSBib251czsKCQkJCWlmIChib251c0NhcFVTRF9sb2NhbCA9PSAwKSB7CgkJCQkJQm9udXNlc0Rpc3RyaWJ1dGVkID0gdHJ1ZTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0KICAgICAgICBib251c0NhcFVTRCA9IGJvbnVzQ2FwVVNEX2xvY2FsOyAgICAKCQlCb251c0NhbGNQb3MgPSBuZXh0UG9zOwoJCWlmIChuZXh0UG9zID49IGJvbnVzZXNMaXN0Lmxlbmd0aCkgewoJCQlCb251c2VzRGlzdHJpYnV0ZWQgPSB0cnVlOwoJCX0KCX0KCn0='.
	

]
