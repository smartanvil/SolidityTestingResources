Class {
	#name : #SRT5b1c4bf42ac96187a1a19ee7b9d17825079d8e8a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5b1c4bf42ac96187a1a19ee7b9d17825079d8e8a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgpsaWJyYXJ5IElkZWFVaW50IHsKCiAgICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICAgICAgdWludCBjID0gYSArIGI7CgogICAgICAgIGFzc2VydChjID49IGEpOwoKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICAgICAgdWludCBjID0gYSAtIGI7CgogICAgICAgIGFzc2VydChiIDw9IGEpOwoKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICAgICAgdWludCBjID0gYSAqIGI7CgogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CgogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgICAgICB1aW50IGMgPSBhIC8gYjsKCiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCmNvbnRyYWN0IElkZWFCYXNpY0NvaW4gewogICAgdXNpbmcgSWRlYVVpbnQgZm9yIHVpbnQ7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CiAgICBhZGRyZXNzW10gcHVibGljIGFjY291bnRzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIGludGVybmFsIGFjY291bnRzTWFwOwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgdHJ5Q3JlYXRlQWNjb3VudChfdG8pOwoKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgICAgICB0cnlDcmVhdGVBY2NvdW50KF90byk7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CgogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CgogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJ5Q3JlYXRlQWNjb3VudChhZGRyZXNzIF9hY2NvdW50KSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKCFhY2NvdW50c01hcFtfYWNjb3VudF0pIHsKICAgICAgICAgICAgYWNjb3VudHMucHVzaChfYWNjb3VudCk7CiAgICAgICAgICAgIGFjY291bnRzTWFwW19hY2NvdW50XSA9IHRydWU7CiAgICAgICAgfQogICAgfQp9Cgpjb250cmFjdCBJZGVhQ29pbiBpcyBJZGVhQmFzaWNDb2luIHsKCiAgICB1aW50IHB1YmxpYyBlYXJuZWRFdGhXZWk7CiAgICB1aW50IHB1YmxpYyBzb2xkSWRlYVdlaTsKICAgIHVpbnQgcHVibGljIHNvbGRJZGVhV2VpUHJlSWNvOwogICAgdWludCBwdWJsaWMgc29sZElkZWFXZWlJY287CiAgICB1aW50IHB1YmxpYyBzb2xkSWRlYVdlaVBvc3RJY287CiAgICB1aW50IHB1YmxpYyBpY29TdGFydFRpbWVzdGFtcDsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgcGllQmFsYW5jZXM7CiAgICBhZGRyZXNzW10gcHVibGljIHBpZUFjY291bnRzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIGludGVybmFsIHBpZUFjY291bnRzTWFwOwogICAgdWludCBwdWJsaWMgbmV4dFJvdW5kUmVzZXJ2ZTsKICAgIGFkZHJlc3NbXSBwdWJsaWMgcHJvamVjdHM7CiAgICBhZGRyZXNzIHB1YmxpYyBwcm9qZWN0QWdlbnQ7CiAgICBhZGRyZXNzIHB1YmxpYyBiYW5rMTsKICAgIGFkZHJlc3MgcHVibGljIGJhbmsyOwogICAgdWludCBwdWJsaWMgYmFuazFWYWw7CiAgICB1aW50IHB1YmxpYyBiYW5rMlZhbDsKICAgIHVpbnQgcHVibGljIGJhbmtWYWxSZXNlcnZlOwoKICAgIGVudW0gSWNvU3RhdGVzIHsKICAgIENvbWluZywKICAgIFByZUljbywKICAgIEljbywKICAgIFBvc3RJY28sCiAgICBEb25lCiAgICB9CgogICAgSWNvU3RhdGVzIHB1YmxpYyBpY29TdGF0ZTsKCiAgICBmdW5jdGlvbiBJZGVhQ29pbigpIHsKICAgICAgICBuYW1lID0gJ0lkZWFDb2luJzsKICAgICAgICBzeW1ib2wgPSAnSURFQSc7CiAgICAgICAgZGVjaW1hbHMgPSAxODsKICAgICAgICB0b3RhbFN1cHBseSA9IDEwMDAwMDAwMCBldGhlcjsKCiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIHRyeUNyZWF0ZUFjY291bnQobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICB1aW50IHRva2VuczsKICAgICAgICBib29sIG1vcmVUaGVuUHJlSWNvTWluID0gbXNnLnZhbHVlID49IDIwIGV0aGVyOwogICAgICAgIHVpbnQgdG90YWxWYWwgPSBtc2cudmFsdWUgKyBiYW5rVmFsUmVzZXJ2ZTsKICAgICAgICB1aW50IGhhbGZWYWwgPSB0b3RhbFZhbCAvIDI7CgogICAgICAgIGlmIChpY29TdGF0ZSA9PSBJY29TdGF0ZXMuUHJlSWNvICYmIG1vcmVUaGVuUHJlSWNvTWluICYmIHNvbGRJZGVhV2VpUHJlSWNvIDw9IDI1MDAwMDAgZXRoZXIpIHsKCiAgICAgICAgICAgIHRva2VucyA9IG1zZy52YWx1ZSAqIDE1MDA7CiAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IHRva2VuczsKICAgICAgICAgICAgc29sZElkZWFXZWlQcmVJY28gKz0gdG9rZW5zOwoKICAgICAgICB9IGVsc2UgaWYgKGljb1N0YXRlID09IEljb1N0YXRlcy5JY28gJiYgc29sZElkZWFXZWlJY28gPD0gMzUwMDAwMDAgZXRoZXIpIHsKICAgICAgICAgICAgdWludCBlbGFwc2VkID0gbm93IC0gaWNvU3RhcnRUaW1lc3RhbXA7CgogICAgICAgICAgICBpZiAoZWxhcHNlZCA8PSAxIGRheXMpIHsKCiAgICAgICAgICAgICAgICB0b2tlbnMgPSBtc2cudmFsdWUgKiAxMjUwOwogICAgICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdG9rZW5zOwoKICAgICAgICAgICAgfSBlbHNlIGlmIChlbGFwc2VkIDw9IDYgZGF5cyAmJiBlbGFwc2VkID4gMSBkYXlzKSB7CgogICAgICAgICAgICAgICAgdG9rZW5zID0gbXNnLnZhbHVlICogMTE1MDsKICAgICAgICAgICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IHRva2VuczsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxhcHNlZCA8PSAxMSBkYXlzICYmIGVsYXBzZWQgPiA2IGRheXMpIHsKCiAgICAgICAgICAgICAgICB0b2tlbnMgPSBtc2cudmFsdWUgKiAxMTAwOwogICAgICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdG9rZW5zOwoKICAgICAgICAgICAgfSBlbHNlIGlmIChlbGFwc2VkIDw9IDE2IGRheXMgJiYgZWxhcHNlZCA+IDExIGRheXMpIHsKCiAgICAgICAgICAgICAgICB0b2tlbnMgPSBtc2cudmFsdWUgKiAxMDUwOwogICAgICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdG9rZW5zOwoKICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICB0b2tlbnMgPSBtc2cudmFsdWUgKiAxMDAwOwogICAgICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdG9rZW5zOwoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc29sZElkZWFXZWlJY28gKz0gdG9rZW5zOwoKICAgICAgICB9IGVsc2UgaWYgKGljb1N0YXRlID09IEljb1N0YXRlcy5Qb3N0SWNvICYmIHNvbGRJZGVhV2VpUG9zdEljbyA8PSAxMjAwMDAwMCBldGhlcikgewoKICAgICAgICAgICAgdG9rZW5zID0gbXNnLnZhbHVlICogNTAwOwogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSArPSB0b2tlbnM7CiAgICAgICAgICAgIHNvbGRJZGVhV2VpUG9zdEljbyArPSB0b2tlbnM7CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgZWFybmVkRXRoV2VpICs9IG1zZy52YWx1ZTsKICAgICAgICBzb2xkSWRlYVdlaSArPSB0b2tlbnM7CgogICAgICAgIGJhbmsxVmFsICs9IGhhbGZWYWw7CiAgICAgICAgYmFuazJWYWwgKz0gaGFsZlZhbDsKICAgICAgICBiYW5rVmFsUmVzZXJ2ZSA9IHRvdGFsVmFsIC0gKGhhbGZWYWwgKiAyKTsKCiAgICAgICAgdHJ5Q3JlYXRlQWNjb3VudChtc2cuc2VuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCYW5rKGFkZHJlc3MgX2JhbmsxLCBhZGRyZXNzIF9iYW5rMikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShiYW5rMSA9PSBhZGRyZXNzKDB4MCkpOwogICAgICAgIHJlcXVpcmUoYmFuazIgPT0gYWRkcmVzcygweDApKTsKICAgICAgICByZXF1aXJlKF9iYW5rMSAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIHJlcXVpcmUoX2JhbmsyICE9IGFkZHJlc3MoMHgwKSk7CgogICAgICAgIGJhbmsxID0gX2JhbmsxOwogICAgICAgIGJhbmsyID0gX2JhbmsyOwoKICAgICAgICBiYWxhbmNlc1tiYW5rMV0gPSA1MDAwMDAgZXRoZXI7CiAgICAgICAgYmFsYW5jZXNbYmFuazJdID0gNTAwMDAwIGV0aGVyOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0YXJ0UHJlSWNvKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWNvU3RhdGUgPSBJY29TdGF0ZXMuUHJlSWNvOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0b3BQcmVJY29BbmRCdXJuKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc3RvcEFueUljb0FuZEJ1cm4oCiAgICAgICAgKDI1MDAwMDAgZXRoZXIgLSBzb2xkSWRlYVdlaVByZUljbykgKiAyCiAgICAgICAgKTsKICAgICAgICBiYWxhbmNlc1tiYW5rMV0gKz0gc29sZElkZWFXZWlQcmVJY28gLyAyOwogICAgICAgIGJhbGFuY2VzW2JhbmsyXSArPSBzb2xkSWRlYVdlaVByZUljbyAvIDI7CiAgICB9CgogICAgZnVuY3Rpb24gc3RhcnRJY28oKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBpY29TdGF0ZSA9IEljb1N0YXRlcy5JY287CiAgICAgICAgaWNvU3RhcnRUaW1lc3RhbXAgPSBub3c7CiAgICB9CgogICAgZnVuY3Rpb24gc3RvcEljb0FuZEJ1cm4oKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBzdG9wQW55SWNvQW5kQnVybigKICAgICAgICAoMzUwMDAwMDAgZXRoZXIgLSBzb2xkSWRlYVdlaUljbykgKiAyCiAgICAgICAgKTsKICAgICAgICBiYWxhbmNlc1tiYW5rMV0gKz0gc29sZElkZWFXZWlJY28gLyAyOwogICAgICAgIGJhbGFuY2VzW2JhbmsyXSArPSBzb2xkSWRlYVdlaUljbyAvIDI7CiAgICB9CgogICAgZnVuY3Rpb24gc3RhcnRQb3N0SWNvKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWNvU3RhdGUgPSBJY29TdGF0ZXMuUG9zdEljbzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdG9wUG9zdEljb0FuZEJ1cm4oKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBzdG9wQW55SWNvQW5kQnVybigKICAgICAgICAoMTIwMDAwMDAgZXRoZXIgLSBzb2xkSWRlYVdlaVBvc3RJY28pICogMgogICAgICAgICk7CiAgICAgICAgYmFsYW5jZXNbYmFuazFdICs9IHNvbGRJZGVhV2VpUG9zdEljbyAvIDI7CiAgICAgICAgYmFsYW5jZXNbYmFuazJdICs9IHNvbGRJZGVhV2VpUG9zdEljbyAvIDI7CiAgICB9CgogICAgZnVuY3Rpb24gc3RvcEFueUljb0FuZEJ1cm4odWludCBfYnVybikgaW50ZXJuYWwgewogICAgICAgIGljb1N0YXRlID0gSWNvU3RhdGVzLkNvbWluZzsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfYnVybik7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcigpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGJhbmsxIHx8IG1zZy5zZW5kZXIgPT0gYmFuazIpOwoKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBiYW5rMSkgewogICAgICAgICAgICBiYW5rMS50cmFuc2ZlcihiYW5rMVZhbCk7CiAgICAgICAgICAgIGJhbmsxVmFsID0gMDsKICAgICAgICB9CgogICAgICAgIGlmIChtc2cuc2VuZGVyID09IGJhbmsyKSB7CiAgICAgICAgICAgIGJhbmsyLnRyYW5zZmVyKGJhbmsyVmFsKTsKICAgICAgICAgICAgYmFuazJWYWwgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJhbmsxVmFsID09IDAgJiYgYmFuazJWYWwgPT0gMCAmJiB0aGlzLmJhbGFuY2UgIT0gMCkgewogICAgICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBwaWVCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gcGllQmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRvUGllKHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF9hbW91bnQpOwogICAgICAgIHBpZUJhbGFuY2VzW21zZy5zZW5kZXJdID0gcGllQmFsYW5jZXNbbXNnLnNlbmRlcl0uYWRkKF9hbW91bnQpOwogICAgICAgIHRyeUNyZWF0ZVBpZUFjY291bnQobXNnLnNlbmRlcik7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbVBpZSh1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBwaWVCYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHBpZUJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChfYW1vdW50KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVjZWl2ZURpdmlkZW5kcyh1aW50IF9hbW91bnQpIGludGVybmFsIHsKICAgICAgICB1aW50IG1pbkJhbGFuY2UgPSAxMDAwMCBldGhlcjsKICAgICAgICB1aW50IHBpZVNpemUgPSBjYWxjUGllU2l6ZShtaW5CYWxhbmNlKTsKICAgICAgICB1aW50IGFtb3VudCA9IG5leHRSb3VuZFJlc2VydmUgKyBfYW1vdW50OwoKICAgICAgICBhY2NydWVEaXZpZGVuZHMobWluQmFsYW5jZSwgcGllU2l6ZSwgYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjUGllU2l6ZSh1aW50IF9taW5CYWxhbmNlKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50IF9waWVTaXplKSB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcGllQWNjb3VudHMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgdmFyIGJhbGFuY2UgPSBwaWVCYWxhbmNlc1twaWVBY2NvdW50c1tpXV07CgogICAgICAgICAgICBpZiAoYmFsYW5jZSA+PSBfbWluQmFsYW5jZSkgewogICAgICAgICAgICAgICAgX3BpZVNpemUgPSBfcGllU2l6ZS5hZGQoYmFsYW5jZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYWNjcnVlRGl2aWRlbmRzKHVpbnQgX21pbkJhbGFuY2UsIHVpbnQgX3BpZVNpemUsIHVpbnQgX2Ftb3VudCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgYWNjcnVlZDsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcGllQWNjb3VudHMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgYWRkcmVzcyBhY2NvdW50ID0gcGllQWNjb3VudHNbaV07CiAgICAgICAgICAgIHVpbnQgYmFsYW5jZSA9IHBpZUJhbGFuY2VzW2FjY291bnRdOwoKICAgICAgICAgICAgaWYgKGJhbGFuY2UgPj0gX21pbkJhbGFuY2UpIHsKICAgICAgICAgICAgICAgIHVpbnQgZGl2aWRlbmRzID0gKGJhbGFuY2UgKiBfYW1vdW50KSAvIF9waWVTaXplOwoKICAgICAgICAgICAgICAgIGFjY3J1ZWQgPSBhY2NydWVkLmFkZChkaXZpZGVuZHMpOwogICAgICAgICAgICAgICAgcGllQmFsYW5jZXNbYWNjb3VudF0gPSBiYWxhbmNlLmFkZChkaXZpZGVuZHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBuZXh0Um91bmRSZXNlcnZlID0gX2Ftb3VudC5zdWIoYWNjcnVlZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJ5Q3JlYXRlUGllQWNjb3VudChhZGRyZXNzIF9hY2NvdW50KSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKCFwaWVBY2NvdW50c01hcFtfYWNjb3VudF0pIHsKICAgICAgICAgICAgcGllQWNjb3VudHMucHVzaChfYWNjb3VudCk7CiAgICAgICAgICAgIHBpZUFjY291bnRzTWFwW19hY2NvdW50XSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldFByb2plY3RBZ2VudChhZGRyZXNzIF9wcm9qZWN0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwcm9qZWN0QWdlbnQgPSBfcHJvamVjdDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlUHJvamVjdChzdHJpbmcgX25hbWUsIHVpbnQgX3JlcXVpcmVkLCB1aW50IF9yZXF1aXJlZERheXMpIHB1YmxpYyByZXR1cm5zIChhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgX2FkZHJlc3MgPSBQcm9qZWN0QWdlbnQocHJvamVjdEFnZW50KS5tYWtlUHJvamVjdChtc2cuc2VuZGVyLCBfbmFtZSwgX3JlcXVpcmVkLCBfcmVxdWlyZWREYXlzKTsKCiAgICAgICAgcHJvamVjdHMucHVzaChfYWRkcmVzcyk7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdGcm9tUHJvamVjdChhZGRyZXNzIF9wcm9qZWN0LCB1aW50IF9zdGFnZSkgcHVibGljIHJldHVybnMgKGJvb2wgX3N1Y2Nlc3MpIHsKICAgICAgICB1aW50IF92YWx1ZTsKICAgICAgICAoX3N1Y2Nlc3MsIF92YWx1ZSkgPSBQcm9qZWN0QWdlbnQocHJvamVjdEFnZW50KS53aXRoZHJhd0Zyb21Qcm9qZWN0KG1zZy5zZW5kZXIsIF9wcm9qZWN0LCBfc3RhZ2UpOwoKICAgICAgICBpZiAoX3N1Y2Nlc3MpIHsKICAgICAgICAgICAgcmVjZWl2ZVRyYW5jaGVBbmREaXZpZGVuZHMoX3ZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2FzaEJhY2tGcm9tUHJvamVjdChhZGRyZXNzIF9wcm9qZWN0KSBwdWJsaWMgcmV0dXJucyAoYm9vbCBfc3VjY2VzcykgewogICAgICAgIHVpbnQgX3ZhbHVlOwogICAgICAgIChfc3VjY2VzcywgX3ZhbHVlKSA9IFByb2plY3RBZ2VudChwcm9qZWN0QWdlbnQpLmNhc2hCYWNrRnJvbVByb2plY3QobXNnLnNlbmRlciwgX3Byb2plY3QpOwoKICAgICAgICBpZiAoX3N1Y2Nlc3MpIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQoX3ZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVjZWl2ZVRyYW5jaGVBbmREaXZpZGVuZHModWludCBfc3VtKSBpbnRlcm5hbCB7CiAgICAgICAgdWludCByYXcgPSBfc3VtICogOTY1OwogICAgICAgIHVpbnQgcmVzZXJ2ZSA9IHJhdyAlIDEwMDA7CiAgICAgICAgdWludCB0cmFuY2hlID0gKHJhdyAtIHJlc2VydmUpIC8gMTAwMDsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQodHJhbmNoZSk7CiAgICAgICAgcmVjZWl2ZURpdmlkZW5kcyhfc3VtIC0gdHJhbmNoZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5UHJvZHVjdChhZGRyZXNzIF9wcm9kdWN0LCB1aW50IF9hbW91bnQpIHB1YmxpYyB7CiAgICAgICAgUHJvamVjdEFnZW50IF9hZ2VudCA9IFByb2plY3RBZ2VudChwcm9qZWN0QWdlbnQpOwoKICAgICAgICB1aW50IF9wcmljZSA9IElkZWFTdWJDb2luKF9wcm9kdWN0KS5wcmljZSgpOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfcHJpY2UgKiBfYW1vdW50KTsKICAgICAgICBfYWdlbnQuYnV5UHJvZHVjdChfcHJvZHVjdCwgbXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICB9Cn0KCmNvbnRyYWN0IElkZWFQcm9qZWN0IHsKICAgIHVzaW5nIElkZWFVaW50IGZvciB1aW50OwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIGFkZHJlc3MgcHVibGljIGVuZ2luZTsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgdWludCBwdWJsaWMgcmVxdWlyZWQ7CiAgICB1aW50IHB1YmxpYyByZXF1aXJlZERheXM7CiAgICB1aW50IHB1YmxpYyBmdW5kaW5nRW5kVGltZTsKICAgIHVpbnQgcHVibGljIGVhcm5lZDsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNDYXNoQmFjazsKICAgIHVpbnQgcHVibGljIGN1cnJlbnRXb3JrU3RhZ2VQZXJjZW50OwogICAgdWludCBpbnRlcm5hbCBsYXN0V29ya1N0YWdlU3RhcnRUaW1lc3RhbXA7CiAgICBpbnQ4IHB1YmxpYyBmYWlsU3RhZ2UgPSAtMTsKICAgIHVpbnQgcHVibGljIGZhaWxJbnZlc3RQZXJjZW50czsKICAgIGFkZHJlc3NbXSBwdWJsaWMgcHJvZHVjdHM7CiAgICB1aW50IHB1YmxpYyBjYXNoQmFja1ZvdGVzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBjYXNoQmFja1dlaWdodDsKCiAgICBlbnVtIFN0YXRlcyB7CiAgICBJbml0aWFsLAogICAgQ29taW5nLAogICAgRnVuZGluZywKICAgIFdvcmtmbG93LAogICAgU3VjY2Vzc0RvbmUsCiAgICBGdW5kaW5nRmFpbCwKICAgIFdvcmtGYWlsCiAgICB9CgogICAgU3RhdGVzIHB1YmxpYyBzdGF0ZSA9IFN0YXRlcy5Jbml0aWFsOwoKICAgIHN0cnVjdCBXb3JrU3RhZ2UgewogICAgdWludCBwZXJjZW50OwogICAgdWludCBzdGFnZURheXM7CiAgICB1aW50IHN1bTsKICAgIHVpbnQgd2l0aGRyYXdUaW1lOwogICAgfQoKICAgIFdvcmtTdGFnZVtdIHB1YmxpYyB3b3JrU3RhZ2VzOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUVuZ2luZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZW5naW5lKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlTdGF0ZShTdGF0ZXMgX3N0YXRlKSB7CiAgICAgICAgcmVxdWlyZShzdGF0ZSA9PSBfc3RhdGUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVByb2R1Y3QoKSB7CiAgICAgICAgYm9vbCBwZXJtaXNzaW9uR3JhbnRlZDsKCiAgICAgICAgZm9yICh1aW50OCBpOyBpIDwgcHJvZHVjdHMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gcHJvZHVjdHNbaV0pIHsKICAgICAgICAgICAgICAgIHBlcm1pc3Npb25HcmFudGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHBlcm1pc3Npb25HcmFudGVkKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIElkZWFQcm9qZWN0KAogICAgYWRkcmVzcyBfb3duZXIsCiAgICBzdHJpbmcgX25hbWUsCiAgICB1aW50IF9yZXF1aXJlZCwKICAgIHVpbnQgX3JlcXVpcmVkRGF5cwogICAgKSB7CiAgICAgICAgcmVxdWlyZShieXRlcyhfbmFtZSkubGVuZ3RoID4gMCk7CiAgICAgICAgcmVxdWlyZShfcmVxdWlyZWQgIT0gMCk7CgogICAgICAgIHJlcXVpcmUoX3JlcXVpcmVkRGF5cyA+PSAxMCk7CiAgICAgICAgcmVxdWlyZShfcmVxdWlyZWREYXlzIDw9IDEwMCk7CgogICAgICAgIGVuZ2luZSA9IG1zZy5zZW5kZXI7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHJlcXVpcmVkID0gX3JlcXVpcmVkOwogICAgICAgIHJlcXVpcmVkRGF5cyA9IF9yZXF1aXJlZERheXM7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkRWFybmVkKHVpbnQgX2Vhcm5lZCkgcHVibGljIG9ubHlFbmdpbmUgewogICAgICAgIGVhcm5lZCA9IGVhcm5lZC5hZGQoX2Vhcm5lZCk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNGdW5kaW5nU3RhdGUoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCBfcmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIHN0YXRlID09IFN0YXRlcy5GdW5kaW5nOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzV29ya2Zsb3dTdGF0ZSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sIF9yZXN1bHQpIHsKICAgICAgICByZXR1cm4gc3RhdGUgPT0gU3RhdGVzLldvcmtmbG93OwogICAgfQoKICAgIGZ1bmN0aW9uIGlzU3VjY2Vzc0RvbmVTdGF0ZSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sIF9yZXN1bHQpIHsKICAgICAgICByZXR1cm4gc3RhdGUgPT0gU3RhdGVzLlN1Y2Nlc3NEb25lOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzRnVuZGluZ0ZhaWxTdGF0ZSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sIF9yZXN1bHQpIHsKICAgICAgICByZXR1cm4gc3RhdGUgPT0gU3RhdGVzLkZ1bmRpbmdGYWlsOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzV29ya0ZhaWxTdGF0ZSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sIF9yZXN1bHQpIHsKICAgICAgICByZXR1cm4gc3RhdGUgPT0gU3RhdGVzLldvcmtGYWlsOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hcmtBc0NvbWluZ0FuZEZyZWV6ZSgpIHB1YmxpYyBvbmx5U3RhdGUoU3RhdGVzLkluaXRpYWwpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShwcm9kdWN0cy5sZW5ndGggPiAwKTsKICAgICAgICByZXF1aXJlKGN1cnJlbnRXb3JrU3RhZ2VQZXJjZW50ID09IDEwMCk7CgogICAgICAgIHN0YXRlID0gU3RhdGVzLkNvbWluZzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdGFydEZ1bmRpbmcoKSBwdWJsaWMgb25seVN0YXRlKFN0YXRlcy5Db21pbmcpIG9ubHlPd25lciB7CiAgICAgICAgc3RhdGUgPSBTdGF0ZXMuRnVuZGluZzsKCiAgICAgICAgZnVuZGluZ0VuZFRpbWUgPSB1aW50NjQobm93ICsgcmVxdWlyZWREYXlzICogMSBkYXlzKTsKICAgICAgICBjYWxjTGFzdFdvcmtTdGFnZVN0YXJ0KCk7CiAgICAgICAgY2FsY1dpdGhkcmF3VGltZSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb2plY3RXb3JrU3RhcnRlZCgpIHB1YmxpYyBvbmx5U3RhdGUoU3RhdGVzLkZ1bmRpbmcpIG9ubHlFbmdpbmUgewogICAgICAgIHN0YXJ0V29ya2Zsb3coKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdGFydFdvcmtmbG93KCkgaW50ZXJuYWwgewogICAgICAgIHVpbnQgdXNlZDsKICAgICAgICB1aW50IGN1cnJlbnQ7CiAgICAgICAgdWludCBsZW4gPSB3b3JrU3RhZ2VzLmxlbmd0aDsKCiAgICAgICAgc3RhdGUgPSBTdGF0ZXMuV29ya2Zsb3c7CgogICAgICAgIGZvciAodWludDggaTsgaSA8IGxlbjsgaSArPSAxKSB7CiAgICAgICAgICAgIGN1cnJlbnQgPSBlYXJuZWQubXVsKHdvcmtTdGFnZXNbaV0ucGVyY2VudCkuZGl2KDEwMCk7CiAgICAgICAgICAgIHdvcmtTdGFnZXNbaV0uc3VtID0gY3VycmVudDsKICAgICAgICAgICAgdXNlZCA9IHVzZWQuYWRkKGN1cnJlbnQpOwogICAgICAgIH0KCiAgICAgICAgd29ya1N0YWdlc1tsZW4gLSAxXS5zdW0gPSB3b3JrU3RhZ2VzW2xlbiAtIDFdLnN1bS5hZGQoZWFybmVkLnN1Yih1c2VkKSk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvamVjdERvbmUoKSBwdWJsaWMgb25seVN0YXRlKFN0YXRlcy5Xb3JrZmxvdykgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG5vdyA+IGxhc3RXb3JrU3RhZ2VTdGFydFRpbWVzdGFtcCk7CgogICAgICAgIHN0YXRlID0gU3RhdGVzLlN1Y2Nlc3NEb25lOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb2plY3RGdW5kaW5nRmFpbCgpIHB1YmxpYyBvbmx5U3RhdGUoU3RhdGVzLkZ1bmRpbmcpIG9ubHlFbmdpbmUgewogICAgICAgIHN0YXRlID0gU3RhdGVzLkZ1bmRpbmdGYWlsOwogICAgfQoKICAgIGZ1bmN0aW9uIHByb2plY3RXb3JrRmFpbCgpIGludGVybmFsIHsKICAgICAgICBzdGF0ZSA9IFN0YXRlcy5Xb3JrRmFpbDsKCiAgICAgICAgZm9yICh1aW50OCBpID0gMTsgaSA8IHdvcmtTdGFnZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgZmFpbEludmVzdFBlcmNlbnRzICs9IHdvcmtTdGFnZXNbaSAtIDFdLnBlcmNlbnQ7CgogICAgICAgICAgICBpZiAod29ya1N0YWdlc1tpXS53aXRoZHJhd1RpbWUgPiBub3cpIHsKICAgICAgICAgICAgICAgIGZhaWxTdGFnZSA9IGludDgoaSAtIDEpOwoKICAgICAgICAgICAgICAgIGkgPSB1aW50OCh3b3JrU3RhZ2VzLmxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChmYWlsU3RhZ2UgPT0gLTEpIHsKICAgICAgICAgICAgZmFpbFN0YWdlID0gaW50OCh3b3JrU3RhZ2VzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICBmYWlsSW52ZXN0UGVyY2VudHMgPSAxMDA7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VXb3JrU3RhZ2UoCiAgICB1aW50IF9wZXJjZW50LAogICAgdWludCBfc3RhZ2VEYXlzCiAgICApIHB1YmxpYyBvbmx5U3RhdGUoU3RhdGVzLkluaXRpYWwpIHsKICAgICAgICByZXF1aXJlKHdvcmtTdGFnZXMubGVuZ3RoIDw9IDEwKTsKICAgICAgICByZXF1aXJlKF9zdGFnZURheXMgPj0gMTApOwogICAgICAgIHJlcXVpcmUoX3N0YWdlRGF5cyA8PSAxMDApOwoKICAgICAgICBpZiAoY3VycmVudFdvcmtTdGFnZVBlcmNlbnQuYWRkKF9wZXJjZW50KSA+IDEwMCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdXJyZW50V29ya1N0YWdlUGVyY2VudCA9IGN1cnJlbnRXb3JrU3RhZ2VQZXJjZW50LmFkZChfcGVyY2VudCk7CiAgICAgICAgfQoKICAgICAgICB3b3JrU3RhZ2VzLnB1c2goV29ya1N0YWdlKAogICAgICAgIF9wZXJjZW50LAogICAgICAgIF9zdGFnZURheXMsCiAgICAgICAgMCwKICAgICAgICAwCiAgICAgICAgKSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY0xhc3RXb3JrU3RhZ2VTdGFydCgpIGludGVybmFsIHsKICAgICAgICBsYXN0V29ya1N0YWdlU3RhcnRUaW1lc3RhbXAgPSBmdW5kaW5nRW5kVGltZTsKCiAgICAgICAgZm9yICh1aW50OCBpOyBpIDwgd29ya1N0YWdlcy5sZW5ndGggLSAxOyBpICs9IDEpIHsKICAgICAgICAgICAgbGFzdFdvcmtTdGFnZVN0YXJ0VGltZXN0YW1wICs9IHdvcmtTdGFnZXNbaV0uc3RhZ2VEYXlzICogMSBkYXlzOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjV2l0aGRyYXdUaW1lKCkgaW50ZXJuYWwgewogICAgICAgIGZvciAodWludDggaTsgaSA8IHdvcmtTdGFnZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAgICAgICAgICAgd29ya1N0YWdlc1tpXS53aXRoZHJhd1RpbWUgPSBub3cgKyByZXF1aXJlZERheXMgKiAxIGRheXM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3b3JrU3RhZ2VzW2ldLndpdGhkcmF3VGltZSA9IHdvcmtTdGFnZXNbaSAtIDFdLndpdGhkcmF3VGltZSArIHdvcmtTdGFnZXNbaSAtIDFdLnN0YWdlRGF5cyAqIDEgZGF5czsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50IF9zdGFnZSkgcHVibGljIG9ubHlFbmdpbmUgcmV0dXJucyAodWludCBfc3VtKSB7CiAgICAgICAgV29ya1N0YWdlIG1lbW9yeSBzdGFnZVN0cnVjdCA9IHdvcmtTdGFnZXNbX3N0YWdlXTsKCiAgICAgICAgaWYgKHN0YWdlU3RydWN0LndpdGhkcmF3VGltZSA8PSBub3cpIHsKICAgICAgICAgICAgX3N1bSA9IHN0YWdlU3RydWN0LnN1bTsKCiAgICAgICAgICAgIHdvcmtTdGFnZXNbX3N0YWdlXS5zdW0gPSAwOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB2b3RlRm9yQ2FzaEJhY2soKSBwdWJsaWMgewogICAgICAgIHZvdGVGb3JDYXNoQmFja0luUGVyY2VudE9mV2VpZ2h0KDEwMCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuY2VsVm90ZUZvckNhc2hCYWNrKCkgcHVibGljIHsKICAgICAgICB2b3RlRm9yQ2FzaEJhY2tJblBlcmNlbnRPZldlaWdodCgwKTsKICAgIH0KCiAgICBmdW5jdGlvbiB2b3RlRm9yQ2FzaEJhY2tJblBlcmNlbnRPZldlaWdodCh1aW50IF9wZXJjZW50KSBwdWJsaWMgewogICAgICAgIHZvdGVGb3JDYXNoQmFja0luUGVyY2VudE9mV2VpZ2h0Rm9yQWNjb3VudChtc2cuc2VuZGVyLCBfcGVyY2VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gdm90ZUZvckNhc2hCYWNrSW5QZXJjZW50T2ZXZWlnaHRGb3JBY2NvdW50KGFkZHJlc3MgX2FjY291bnQsIHVpbnQgX3BlcmNlbnQpIGludGVybmFsIHsKICAgICAgICByZXF1aXJlKF9wZXJjZW50IDw9IDEwMCk7CgogICAgICAgIHVwZGF0ZUZ1bmRpbmdTdGF0ZUlmTmVlZCgpOwoKICAgICAgICBpZiAoc3RhdGUgPT0gU3RhdGVzLldvcmtmbG93KSB7CiAgICAgICAgICAgIHVpbnQgY3VycmVudFdlaWdodCA9IGNhc2hCYWNrV2VpZ2h0W19hY2NvdW50XTsKICAgICAgICAgICAgdWludCBzdXBwbHk7CiAgICAgICAgICAgIHVpbnQgcGFydDsKCiAgICAgICAgICAgIGZvciAodWludDggaTsgaSA8IHByb2R1Y3RzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICBzdXBwbHkgKz0gSWRlYVN1YkNvaW4ocHJvZHVjdHNbaV0pLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgICAgICBwYXJ0ICs9IElkZWFTdWJDb2luKHByb2R1Y3RzW2ldKS5iYWxhbmNlT2YoX2FjY291bnQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNoQmFja1ZvdGVzICs9ICgocGFydCAqICgxMCAqKiAxMCkpIC8gc3VwcGx5KSAqIChfcGVyY2VudCAtIGN1cnJlbnRXZWlnaHQpOwogICAgICAgICAgICBjYXNoQmFja1dlaWdodFtfYWNjb3VudF0gPSBfcGVyY2VudDsKCiAgICAgICAgICAgIGlmIChjYXNoQmFja1ZvdGVzID4gNTAgKiAoMTAgKiogMTApKSB7CiAgICAgICAgICAgICAgICBwcm9qZWN0V29ya0ZhaWwoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVWb3Rlc09uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIHB1YmxpYyBvbmx5UHJvZHVjdCB7CiAgICAgICAgaWYgKGlzV29ya2Zsb3dTdGF0ZSgpKSB7CiAgICAgICAgICAgIHZvdGVGb3JDYXNoQmFja0luUGVyY2VudE9mV2VpZ2h0Rm9yQWNjb3VudChfZnJvbSwgMCk7CiAgICAgICAgICAgIHZvdGVGb3JDYXNoQmFja0luUGVyY2VudE9mV2VpZ2h0Rm9yQWNjb3VudChfdG8sIDApOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlUHJvZHVjdCgKICAgIHN0cmluZyBfbmFtZSwKICAgIHN0cmluZyBfc3ltYm9sLAogICAgdWludCBfcHJpY2UsCiAgICB1aW50IF9saW1pdAogICAgKSBwdWJsaWMgb25seVN0YXRlKFN0YXRlcy5Jbml0aWFsKSBvbmx5T3duZXIgcmV0dXJucyAoYWRkcmVzcyBfcHJvZHVjdEFkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKHByb2R1Y3RzLmxlbmd0aCA8PSAyNSk7CgogICAgICAgIElkZWFTdWJDb2luIHByb2R1Y3QgPSBuZXcgSWRlYVN1YkNvaW4obXNnLnNlbmRlciwgX25hbWUsIF9zeW1ib2wsIF9wcmljZSwgX2xpbWl0LCBlbmdpbmUpOwoKICAgICAgICBwcm9kdWN0cy5wdXNoKGFkZHJlc3MocHJvZHVjdCkpOwoKICAgICAgICByZXR1cm4gYWRkcmVzcyhwcm9kdWN0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjSW52ZXN0aW5nKGFkZHJlc3MgX2FjY291bnQpIHB1YmxpYyBvbmx5RW5naW5lIHJldHVybnMgKHVpbnQgX3N1bSkgewogICAgICAgIHJlcXVpcmUoIWlzQ2FzaEJhY2tbX2FjY291bnRdKTsKCiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IHByb2R1Y3RzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgIElkZWFTdWJDb2luIHByb2R1Y3QgPSBJZGVhU3ViQ29pbihwcm9kdWN0c1tpXSk7CgogICAgICAgICAgICBfc3VtID0gX3N1bS5hZGQocHJvZHVjdC5iYWxhbmNlT2YoX2FjY291bnQpICogcHJvZHVjdC5wcmljZSgpKTsKICAgICAgICB9CgogICAgICAgIGlmIChpc1dvcmtGYWlsU3RhdGUoKSkgewogICAgICAgICAgICBfc3VtID0gX3N1bS5tdWwoMTAwIC0gZmFpbEludmVzdFBlcmNlbnRzKS5kaXYoMTAwKTsKICAgICAgICB9CgogICAgICAgIGlzQ2FzaEJhY2tbX2FjY291bnRdID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVGdW5kaW5nU3RhdGVJZk5lZWQoKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGlzRnVuZGluZ1N0YXRlKCkgJiYgbm93ID4gZnVuZGluZ0VuZFRpbWUpIHsKICAgICAgICAgICAgaWYgKGVhcm5lZCA+PSByZXF1aXJlZCkgewogICAgICAgICAgICAgICAgc3RhcnRXb3JrZmxvdygpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RhdGUgPSBTdGF0ZXMuRnVuZGluZ0ZhaWw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IFByb2plY3RBZ2VudCB7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBjb2luOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUNvaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvaW4pOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gUHJvamVjdEFnZW50KCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlUHJvamVjdCgKICAgIGFkZHJlc3MgX293bmVyLAogICAgc3RyaW5nIF9uYW1lLAogICAgdWludCBfcmVxdWlyZWQsCiAgICB1aW50IF9yZXF1aXJlZERheXMKICAgICkgcHVibGljIHJldHVybnMgKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXR1cm4gYWRkcmVzcygKICAgICAgICBuZXcgSWRlYVByb2plY3QoCiAgICAgICAgX293bmVyLAogICAgICAgIF9uYW1lLAogICAgICAgIF9yZXF1aXJlZCwKICAgICAgICBfcmVxdWlyZWREYXlzCiAgICAgICAgKQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q29pbihhZGRyZXNzIF9jb2luKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBjb2luID0gX2NvaW47CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdGcm9tUHJvamVjdCgKICAgIGFkZHJlc3MgX293bmVyLAogICAgYWRkcmVzcyBfcHJvamVjdCwKICAgIHVpbnQgX3N0YWdlCiAgICApIHB1YmxpYyBvbmx5Q29pbiByZXR1cm5zIChib29sIF9zdWNjZXNzLCB1aW50IF92YWx1ZSkgewogICAgICAgIHJlcXVpcmUoX293bmVyID09IElkZWFQcm9qZWN0KF9wcm9qZWN0KS5vd25lcigpKTsKCiAgICAgICAgSWRlYVByb2plY3QgcHJvamVjdCA9IElkZWFQcm9qZWN0KF9wcm9qZWN0KTsKICAgICAgICB1cGRhdGVGdW5kaW5nU3RhdGVJZk5lZWQoX3Byb2plY3QpOwoKICAgICAgICBpZiAocHJvamVjdC5pc1dvcmtmbG93U3RhdGUoKSB8fCBwcm9qZWN0LmlzU3VjY2Vzc0RvbmVTdGF0ZSgpKSB7CiAgICAgICAgICAgIF92YWx1ZSA9IHByb2plY3Qud2l0aGRyYXcoX3N0YWdlKTsKCiAgICAgICAgICAgIGlmIChfdmFsdWUgPiAwKSB7CiAgICAgICAgICAgICAgICBfc3VjY2VzcyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfc3VjY2VzcyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3N1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2FzaEJhY2tGcm9tUHJvamVjdCgKICAgIGFkZHJlc3MgX293bmVyLAogICAgYWRkcmVzcyBfcHJvamVjdAogICAgKSBwdWJsaWMgb25seUNvaW4gcmV0dXJucyAoYm9vbCBfc3VjY2VzcywgdWludCBfdmFsdWUpIHsKICAgICAgICBJZGVhUHJvamVjdCBwcm9qZWN0ID0gSWRlYVByb2plY3QoX3Byb2plY3QpOwoKICAgICAgICB1cGRhdGVGdW5kaW5nU3RhdGVJZk5lZWQoX3Byb2plY3QpOwoKICAgICAgICBpZiAoCiAgICAgICAgcHJvamVjdC5pc0Z1bmRpbmdGYWlsU3RhdGUoKSB8fAogICAgICAgIHByb2plY3QuaXNXb3JrRmFpbFN0YXRlKCkKICAgICAgICApIHsKICAgICAgICAgICAgX3ZhbHVlID0gcHJvamVjdC5jYWxjSW52ZXN0aW5nKF9vd25lcik7CiAgICAgICAgICAgIF9zdWNjZXNzID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfc3VjY2VzcyA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVGdW5kaW5nU3RhdGVJZk5lZWQoYWRkcmVzcyBfcHJvamVjdCkgaW50ZXJuYWwgewogICAgICAgIElkZWFQcm9qZWN0IHByb2plY3QgPSBJZGVhUHJvamVjdChfcHJvamVjdCk7CgogICAgICAgIGlmICgKICAgICAgICBwcm9qZWN0LmlzRnVuZGluZ1N0YXRlKCkgJiYKICAgICAgICBub3cgPiBwcm9qZWN0LmZ1bmRpbmdFbmRUaW1lKCkKICAgICAgICApIHsKICAgICAgICAgICAgaWYgKHByb2plY3QuZWFybmVkKCkgPj0gcHJvamVjdC5yZXF1aXJlZCgpKSB7CiAgICAgICAgICAgICAgICBwcm9qZWN0LnByb2plY3RXb3JrU3RhcnRlZCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHJvamVjdC5wcm9qZWN0RnVuZGluZ0ZhaWwoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBidXlQcm9kdWN0KGFkZHJlc3MgX3Byb2R1Y3QsIGFkZHJlc3MgX2FjY291bnQsIHVpbnQgX2Ftb3VudCkgcHVibGljIG9ubHlDb2luIHsKICAgICAgICBJZGVhU3ViQ29pbiBfcHJvZHVjdENvbnRyYWN0ID0gSWRlYVN1YkNvaW4oX3Byb2R1Y3QpOwogICAgICAgIGFkZHJlc3MgX3Byb2plY3QgPSBfcHJvZHVjdENvbnRyYWN0LnByb2plY3QoKTsKICAgICAgICBJZGVhUHJvamVjdCBfcHJvamVjdENvbnRyYWN0ID0gSWRlYVByb2plY3QoX3Byb2plY3QpOwoKICAgICAgICB1cGRhdGVGdW5kaW5nU3RhdGVJZk5lZWQoX3Byb2plY3QpOwogICAgICAgIHJlcXVpcmUoX3Byb2plY3RDb250cmFjdC5pc0Z1bmRpbmdTdGF0ZSgpKTsKCiAgICAgICAgX3Byb2R1Y3RDb250cmFjdC5idXkoX2FjY291bnQsIF9hbW91bnQpOwogICAgICAgIF9wcm9qZWN0Q29udHJhY3QuYWRkRWFybmVkKF9hbW91bnQgKiBfcHJvZHVjdENvbnRyYWN0LnByaWNlKCkpOwogICAgfQp9Cgpjb250cmFjdCBJZGVhU3ViQ29pbiBpcyBJZGVhQmFzaWNDb2luIHsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDA7CiAgICB1aW50IHB1YmxpYyBsaW1pdDsKICAgIHVpbnQgcHVibGljIHByaWNlOwogICAgYWRkcmVzcyBwdWJsaWMgcHJvamVjdDsKICAgIGFkZHJlc3MgcHVibGljIGVuZ2luZTsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBzdHJpbmcpIHB1YmxpYyBzaGlwcGluZzsKCiAgICBtb2RpZmllciBvbmx5UHJvamVjdCgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcHJvamVjdCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RW5naW5lKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBlbmdpbmUpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gSWRlYVN1YkNvaW4oCiAgICBhZGRyZXNzIF9vd25lciwKICAgIHN0cmluZyBfbmFtZSwKICAgIHN0cmluZyBfc3ltYm9sLAogICAgdWludCBfcHJpY2UsCiAgICB1aW50IF9saW1pdCwKICAgIGFkZHJlc3MgX2VuZ2luZQogICAgKSB7CiAgICAgICAgcmVxdWlyZShfcHJpY2UgIT0gMCk7CgogICAgICAgIG93bmVyID0gX293bmVyOwogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBzeW1ib2wgPSBfc3ltYm9sOwogICAgICAgIHByaWNlID0gX3ByaWNlOwogICAgICAgIGxpbWl0ID0gX2xpbWl0OwogICAgICAgIHByb2plY3QgPSBtc2cuc2VuZGVyOwogICAgICAgIGVuZ2luZSA9IF9lbmdpbmU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZSghSWRlYVByb2plY3QocHJvamVjdCkuaXNDYXNoQmFjayhtc2cuc2VuZGVyKSk7CiAgICAgICAgcmVxdWlyZSghSWRlYVByb2plY3QocHJvamVjdCkuaXNDYXNoQmFjayhfdG8pKTsKCiAgICAgICAgSWRlYVByb2plY3QocHJvamVjdCkudXBkYXRlVm90ZXNPblRyYW5zZmVyKG1zZy5zZW5kZXIsIF90byk7CgogICAgICAgIGJvb2wgcmVzdWx0ID0gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwoKICAgICAgICBpZiAoIXJlc3VsdCkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoIUlkZWFQcm9qZWN0KHByb2plY3QpLmlzQ2FzaEJhY2soX2Zyb20pKTsKICAgICAgICByZXF1aXJlKCFJZGVhUHJvamVjdChwcm9qZWN0KS5pc0Nhc2hCYWNrKF90bykpOwoKICAgICAgICBJZGVhUHJvamVjdChwcm9qZWN0KS51cGRhdGVWb3Rlc09uVHJhbnNmZXIoX2Zyb20sIF90byk7CgogICAgICAgIGJvb2wgcmVzdWx0ID0gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIGlmICghcmVzdWx0KSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBmdW5jdGlvbiBidXkoYWRkcmVzcyBfYWNjb3VudCwgdWludCBfYW1vdW50KSBwdWJsaWMgb25seUVuZ2luZSB7CiAgICAgICAgdWludCB0b3RhbCA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKCiAgICAgICAgaWYgKGxpbWl0ICE9IDApIHsKICAgICAgICAgICAgcmVxdWlyZSh0b3RhbCA8PSBsaW1pdCk7CiAgICAgICAgfQoKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tfYWNjb3VudF0gPSBiYWxhbmNlc1tfYWNjb3VudF0uYWRkKF9hbW91bnQpOwogICAgICAgIHRyeUNyZWF0ZUFjY291bnQoX2FjY291bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNoaXBwaW5nKHN0cmluZyBfc2hpcHBpbmcpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShieXRlcyhfc2hpcHBpbmcpLmxlbmd0aCA+IDApOwoKICAgICAgICBzaGlwcGluZ1ttc2cuc2VuZGVyXSA9IF9zaGlwcGluZzsKICAgIH0KCn0='.
	

]
