Class {
	#name : #SRT67119bbdc1683df2ad85ccea4304619f5d62e000,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT67119bbdc1683df2ad85ccea4304619f5d62e000 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBPcmFjbGl6ZSBBUEkgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovLyBUaGUgT3JhY2xpemUgQVBJIGhhcyBiZWVuIHB1dCBpbnRvIHRoZSBzYW1lIGZpbGUgdG8gbWFrZSBFdGhlcnNjYW4gdmVyaWZpY2F0aW9uIGVhc2llci4KLy8gRk9SIFRIRSBUT0tFTiBDT05UUkFDVFMgU0NST0xMIERPV04gVE8gQUJPVVQgTElORSAxMDAwCgoKLy8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKICAgIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeV93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CiAgICBmdW5jdGlvbiBzZXRQcm9vZlR5cGUoYnl0ZSBfcHJvb2ZUeXBlKTsKICAgIGZ1bmN0aW9uIHNldENvbmZpZyhieXRlczMyIF9jb25maWcpOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSByZXR1cm5zKGJ5dGVzMzIpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcmV0dXJucyAoYWRkcmVzcyBfYWRkcik7Cn0KY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwKjYwKjI0OwogICAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCo2MCoyNCozMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05PTkUgPSAweDAwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTGVkZ2VyID0gMHgzMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9hdXRvID0gMDsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tb3JkZW4gPSAyOwogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgICBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgT0FSOwoKICAgIE9yYWNsaXplSSBvcmFjbGl6ZTsKICAgIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgICAgICBpZigoYWRkcmVzcyhPQVIpPT0wKXx8KGdldENvZGVTaXplKGFkZHJlc3MoT0FSKSk9PTApKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk+MCl7IC8va292YW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9rb3ZhbiIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfdXNlQ291cG9uKHN0cmluZyBjb2RlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogICAgfQoKICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJhMmNib3Ioc3RyaW5nW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKICAgIGZ1bmN0aW9uIGJhMmNib3IoYnl0ZXNbXSBhcnIpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgoKICAgIHN0cmluZyBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZShzdHJpbmcgX25ldHdvcmtfbmFtZSkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX25ldHdvcmtfbmFtZSA9IF9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkodWludCBfZGVsYXksIHVpbnQgX25ieXRlcywgdWludCBfY3VzdG9tR2FzTGltaXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIGlmICgoX25ieXRlcyA9PSAwKXx8KF9uYnl0ZXMgPiAzMikpIHRocm93OwogICAgICAgIGJ5dGVzIG1lbW9yeSBuYnl0ZXMgPSBuZXcgYnl0ZXMoMSk7CiAgICAgICAgbmJ5dGVzWzBdID0gYnl0ZShfbmJ5dGVzKTsKICAgICAgICBieXRlcyBtZW1vcnkgdW5vbmNlID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvbktleUhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzMzIgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMiA9IG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBtc3RvcmUodW5vbmNlLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHVub25jZSwgMHgyMCksIHhvcihibG9ja2hhc2goc3ViKG51bWJlciwgMSkpLCB4b3IoY29pbmJhc2UsIHRpbWVzdGFtcCkpKQogICAgICAgICAgICBtc3RvcmUoc2Vzc2lvbktleUhhc2gsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2Vzc2lvbktleUhhc2gsIDB4MjApLCBzZXNzaW9uS2V5SGFzaF9ieXRlczMyKQogICAgICAgIH0KICAgICAgICBieXRlc1szXSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2hdOwogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KF9kZWxheSwgInJhbmRvbSIsIGFyZ3MsIF9jdXN0b21HYXNMaW1pdCk7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBzaGEzKGJ5dGVzOChfZGVsYXkpLCBhcmdzWzFdLCBzaGEyNTYoYXJnc1swXSksIGFyZ3NbMl0pKTsKICAgICAgICByZXR1cm4gcXVlcnlJZDsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9IGNvbW1pdG1lbnQ7CiAgICB9CgogICAgbWFwcGluZyhieXRlczMyPT5ieXRlczMyKSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzOwogICAgbWFwcGluZyhieXRlczMyPT5ib29sKSBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZDsKCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWcoYnl0ZXMzMiB0b3NpZ25oLCBieXRlcyBkZXJzaWcsIGJ5dGVzIHB1YmtleSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBzaWdvazsKICAgICAgICBhZGRyZXNzIHNpZ25lcjsKCiAgICAgICAgYnl0ZXMzMiBzaWdyOwogICAgICAgIGJ5dGVzMzIgc2lnczsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3JfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IG9mZnNldCA9IDQrKHVpbnQoZGVyc2lnWzNdKSAtIDB4MjApOwogICAgICAgIHNpZ3JfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0LCAzMiwgc2lncl8sIDApOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdzXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgb2Zmc2V0ICs9IDMyICsgMjsKICAgICAgICBzaWdzXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCsodWludChkZXJzaWdbb2Zmc2V0LTFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpZ3IgOj0gbWxvYWQoYWRkKHNpZ3JfLCAzMikpCiAgICAgICAgICAgIHNpZ3MgOj0gbWxvYWQoYWRkKHNpZ3NfLCAzMikpCiAgICAgICAgfQoKCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsKICAgICAgICBpZiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcikgcmV0dXJuIHRydWU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyOCwgc2lnciwgc2lncyk7CiAgICAgICAgICAgIHJldHVybiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkoYnl0ZXMgcHJvb2YsIHVpbnQgc2lnMm9mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc2lnb2s7CgogICAgICAgIC8vIFN0ZXAgNjogdmVyaWZ5IHRoZSBhdHRlc3RhdGlvbiBzaWduYXR1cmUsIEFQUEtFWTEgbXVzdCBzaWduIHRoZSBzZXNzaW9uS2V5IGZyb20gdGhlIGNvcnJlY3QgbGVkZ2VyIGFwcCAoQ09ERUhBU0gpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzIgPSBuZXcgYnl0ZXModWludChwcm9vZltzaWcyb2Zmc2V0KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQsIHNpZzIubGVuZ3RoLCBzaWcyLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFwcGtleTFfcHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrMSwgNjQsIGFwcGtleTFfcHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSs2NSszMik7CiAgICAgICAgdG9zaWduMlswXSA9IDE7IC8vcm9sZQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NSwgNjUsIHRvc2lnbjIsIDEpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsKICAgICAgICBjb3B5Qnl0ZXMoQ09ERUhBU0gsIDAsIDMyLCB0b3NpZ24yLCAxKzY1KTsKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMiksIHNpZzIsIGFwcGtleTFfcHVia2V5KTsKCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpCiAgICAgICAgYnl0ZXMgbWVtb3J5IExFREdFUktFWSA9IGhleCI3ZmI5NTY0NjljNWM5Yjg5ODQwZDU1YjQzNTM3ZTY2YTk4ZGQ0ODExZWEwYTI3MjI0MjcyYzJlNTYyMjkxMWU4NTM3YTJmOGU4NmE0NmJhZWM4Mjg2NGU5OGRkMDFlOWNjYzJmOGJjNWRmYzljYmU1YTkxYTI5MDQ5OGRkOTZlNCI7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDErNjUpOwogICAgICAgIHRvc2lnbjNbMF0gPSAweEZFOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMywgNjUsIHRvc2lnbjMsIDEpOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMyA9IG5ldyBieXRlcyh1aW50KHByb29mWzMrNjUrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMys2NSwgc2lnMy5sZW5ndGgsIHNpZzMsIDApOwoKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMyksIHNpZzMsIExFREdFUktFWSk7CgogICAgICAgIHJldHVybiBzaWdvazsKICAgIH0KCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHRocm93OwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHRocm93OwoKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoQnl0ZXMzMlByZWZpeChieXRlczMyIGNvbnRlbnQsIGJ5dGVzIHByZWZpeCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBtYXRjaF8gPSB0cnVlOwoKICAgICAgICBmb3IgKHZhciBpPTA7IGk8cHJlZml4Lmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYgKGNvbnRlbnRbaV0gIT0gcHJlZml4W2ldKSBtYXRjaF8gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIGNoZWNrb2s7CgoKICAgICAgICAvLyBTdGVwIDI6IHRoZSB1bmlxdWUga2V5aGFzaCBoYXMgdG8gbWF0Y2ggd2l0aCB0aGUgc2hhMjU2IG9mIChjb250ZXh0IG5hbWUgKyBxdWVyeUlkKQogICAgICAgIHVpbnQgbGVkZ2VyUHJvb2ZMZW5ndGggPSAzKzY1Kyh1aW50KHByb29mWzMrNjUrMV0pKzIpKzMyOwogICAgICAgIGJ5dGVzIG1lbW9yeSBrZXloYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMiwga2V5aGFzaCwgMCk7CiAgICAgICAgY2hlY2tvayA9IChzaGEzKGtleWhhc2gpID09IHNoYTMoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpKzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CgoKICAgICAgICAvLyBTdGVwIDM6IHdlIGFzc3VtZSBzaWcxIGlzIHZhbGlkIChpdCB3aWxsIGJlIHZlcmlmaWVkIGR1cmluZyBzdGVwIDUpIGFuZCB3ZSB2ZXJpZnkgaWYgJ3Jlc3VsdCcgaXMgdGhlIHByZWZpeCBvZiBzaGEyNTYoc2lnMSkKICAgICAgICBjaGVja29rID0gbWF0Y2hCeXRlczMyUHJlZml4KHNoYTI1NihzaWcxKSwgcmVzdWx0KTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA0OiBjb21taXRtZW50IG1hdGNoIHZlcmlmaWNhdGlvbiwgc2hhMyhkZWxheSwgbmJ5dGVzLCB1bm9uY2UsIHNlc3Npb25LZXlIYXNoKSA9PSBjb21taXRtZW50IGluIHN0b3JhZ2UuCiAgICAgICAgLy8gVGhpcyBpcyB0byB2ZXJpZnkgdGhhdCB0aGUgY29tcHV0ZWQgYXJncyBtYXRjaCB3aXRoIHRoZSBvbmVzIHNwZWNpZmllZCBpbiB0aGUgcXVlcnkuCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbW1pdG1lbnRTbGljZTEgPSBuZXcgYnl0ZXMoOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKzMyLCA4KzErMzIsIGNvbW1pdG1lbnRTbGljZTEsIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvblB1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgdWludCBzaWcyb2Zmc2V0ID0gbGVkZ2VyUHJvb2ZMZW5ndGgrMzIrKDgrMSszMikrc2lnMS5sZW5ndGgrNjU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LTY0LCA2NCwgc2Vzc2lvblB1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzMzIgc2Vzc2lvblB1YmtleUhhc2ggPSBzaGEyNTYoc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPT0gc2hhMyhjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpeyAvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA1OiB2YWxpZGl0eSB2ZXJpZmljYXRpb24gZm9yIHNpZzEgKGtleWhhc2ggYW5kIGFyZ3Mgc2lnbmVkIHdpdGggdGhlIHNlc3Npb25LZXkpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjEgPSBuZXcgYnl0ZXMoMzIrOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMis4KzErMzIsIHRvc2lnbjEsIDApOwogICAgICAgIGNoZWNrb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjEpLCBzaWcxLCBzZXNzaW9uUHVia2V5KTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB2ZXJpZnkgaWYgc2Vzc2lvblB1YmtleUhhc2ggd2FzIHZlcmlmaWVkIGFscmVhZHksIGlmIG5vdC4uIGxldCdzIGRvIGl0IQogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPT0gZmFsc2UpewogICAgICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KHByb29mLCBzaWcyb2Zmc2V0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF07CiAgICB9CgoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgaWYgKHRvLmxlbmd0aCA8IG1pbkxlbmd0aCkgewogICAgICAgICAgICAvLyBCdWZmZXIgdG9vIHNtYWxsCiAgICAgICAgICAgIHRocm93OyAvLyBTaG91bGQgYmUgYSBiZXR0ZXIgd2F5PwogICAgICAgIH0KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgdG1wIDo9IG1sb2FkKGFkZChmcm9tLCBpKSkKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgLy8gRHVwbGljYXRlIFNvbGlkaXR5J3MgZWNyZWNvdmVyLCBidXQgY2F0Y2hpbmcgdGhlIENBTEwgcmV0dXJuIHZhbHVlCiAgICBmdW5jdGlvbiBzYWZlcl9lY3JlY292ZXIoYnl0ZXMzMiBoYXNoLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgewogICAgICAgIC8vIFdlIGRvIG91ciBvd24gbWVtb3J5IG1hbmFnZW1lbnQgaGVyZS4gU29saWRpdHkgdXNlcyBtZW1vcnkgb2Zmc2V0CiAgICAgICAgLy8gMHg0MCB0byBzdG9yZSB0aGUgY3VycmVudCBlbmQgb2YgbWVtb3J5LiBXZSB3cml0ZSBwYXN0IGl0IChhcwogICAgICAgIC8vIHdyaXRlcyBhcmUgbWVtb3J5IGV4dGVuc2lvbnMpLCBidXQgZG9uJ3QgdXBkYXRlIHRoZSBvZmZzZXQgc28KICAgICAgICAvLyBTb2xpZGl0eSB3aWxsIHJldXNlIGl0LiBUaGUgbWVtb3J5IHVzZWQgaGVyZSBpcyBvbmx5IG5lZWRlZCBmb3IKICAgICAgICAvLyB0aGlzIGNvbnRleHQuCgogICAgICAgIC8vIEZJWE1FOiBpbmxpbmUgYXNzZW1ibHkgY2FuJ3QgYWNjZXNzIHJldHVybiB2YWx1ZXMKICAgICAgICBib29sIHJldDsKICAgICAgICBhZGRyZXNzIGFkZHI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNpemUgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKHNpemUsIGhhc2gpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgMzIpLCB2KQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDY0KSwgcikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA5NiksIHMpCgogICAgICAgICAgICAvLyBOT1RFOiB3ZSBjYW4gcmV1c2UgdGhlIHJlcXVlc3QgbWVtb3J5IGJlY2F1c2Ugd2UgZGVhbCB3aXRoCiAgICAgICAgICAgIC8vICAgICAgIHRoZSByZXR1cm4gY29kZQogICAgICAgICAgICByZXQgOj0gY2FsbCgzMDAwLCAxLCAwLCBzaXplLCAxMjgsIHNpemUsIDMyKQogICAgICAgICAgICBhZGRyIDo9IG1sb2FkKHNpemUpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CgogICAgICAgIC8vIFRoZSBzaWduYXR1cmUgZm9ybWF0IGlzIGEgY29tcGFjdCBmb3JtIG9mOgogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQogICAgICAgIC8vIENvbXBhY3QgbWVhbnMsIHVpbnQ4IGlzIG5vdCBwYWRkZWQgdG8gMzIgYnl0ZXMuCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCgogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQKICAgICAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQoKICAgICAgICAgICAgLy8gQWx0ZXJuYXRpdmUgc29sdXRpb246CiAgICAgICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cwogICAgICAgICAgICAvLyB1c2UgdGhlIHNlY29uZCBiZXN0IG9wdGlvbiwgJ2FuZCcKICAgICAgICAgICAgLy8gdiA6PSBhbmQobWxvYWQoYWRkKHNpZywgNjUpKSwgMjU1KQogICAgICAgIH0KCiAgICAgICAgLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0CiAgICAgICAgLy8gdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdCiAgICAgICAgLy8KICAgICAgICAvLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzCiAgICAgICAgaWYgKHYgPCAyNykKICAgICAgICAgIHYgKz0gMjc7CgogICAgICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICByZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwogICAgfQoKfQovLyA8L09SQUNMSVpFX0FQST4KCgoKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogVHJ1bXAgVG9rZW4gQ29udHJhY3RzICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCi8qIFRoaXMgaXMgdGhlIGZ1bGwgVHJ1bXBJbXBlYWNobWVudFRva2VuIGNvbnRyYWN0LgoKQ29weXJpZ2h0IDIwMTcgYnkgdGhlIGhvbGRlcnMgb2YgdGhpcyBFdGhlcmV1bSBhZGRyZXNzOgoweDQ1NGRERDk1QjBCYzNEMzAyMjRiZEE1NjM5RjI5ZDdmYTE2Q0ZhMGIKCgpUaGlzIGNvbnRyYWN0IGlzIGJhc2VkIG9uIHN1YnN0YW50aWFsIGFtb3VudCBvZiBpbmhlcml0YW5jZSwgZWFjaCBuZXcgc3ViY2xhc3MKYWRkaW5nIG9uZSBwYXJ0aWN1bGFyIHBlYWNlIG9mIGZ1bmN0aW9uYWxpdHkuCgpUaGUgaW5oZXJpdGFuY2UgZ3JhcGggbG9va3MgbGlrZSB0aGlzOgoKCiAgICAgICAgICAgIEVSQzIwSW50ZXJmYWNlCiAgICAgICAgICAgICAgICAgfAogICAgICAgICAgICAgICAgIHwKICAgICAgICAgICAgRVJDMjBJbXBsZW1lbnRhdGlvbgogICAgICAgICAgICAgICAgIHwKICAgICAgICAgICAgICAgICB8CiAgICAgICAgICAgIExpdHRsZVNpc3RlclRva2VuCiAgICAgICAgICAgICAgIC8gICAgICAgICAgXAogICAgICAgICAgICAgIC8gICAgICAgICAgICBcCiAgICAgICAgICAgICAvICAgICAgICAgIEJpZ1Npc3RlclRva2VuCiAgICAgICAgICAgIC8gICAgICAgICAgICAgICAgIHwKICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgfAogICBQcmljZUluY3JlYXNpbmdMU1QgICAgIFByaWNlSW5jcmVhc2luZ1Rva2VuICAgICAgICAgICAgICAgICB1c2luZ09yYWNsaXplCiAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwgICAgICAgICAgICAgICAgICAgICAgfAogICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICAgICAgICAgICAgICAgICAgICAgIHwKICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVkRXZpZGVuY2VUb2tlbiAgVHJ1bXBPcmFsY2UgICBTdGluZ09wcwogICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICAgICAgICAgIC8gICAgICAgLwogICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcICAgICAgICAgLyAgICAgICAvCiAgICBUdW1wRnVsbFRlcm1Ub2tlbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJ1bXBJbXBlYWNobWVudFRva2VuCgoKCiBFUkMyMFRva2VuOiBTZW5kaW5nIGFuZCByZWNlaXZpbmcgVG9rZW5zIGJldHdlZW4gaG9sZGVycwoKIExpdHRsZS9CaWdTaXN0ZXJUb2tlbjogQnV5aW5nIGFuZCBTZWxsaW5nIHRva2VucyBmcm9tIGFuZCB0byBjb250cmFjdAoKIFByaWNlSW5jcmVhc2luZ1Rva2VuL1ByaWNlSW5jcmVhc2luZ0xTVDogSW5jcmVhc2UgYnV5UHJpY2Ugb3ZlciB0aW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIG1ha2UgdGhlIHRva2VuIG1vcmUgZXhwZW5zaXZlCgpUaW1lZEV2aWRlbmNlVG9rZW46IENoZWNrcyBmb3Igd2lubmluZyBjb25kaXRpb25zIGFuZCBzdXNwZW5kcyBhbmQKICAgICAgICAgICAgICAgICAgICBhY3RpdmF0ZXMgYnV5aW5nIGFuZCBzZWxsaW5nCgpUcnVtcE9yYWNsZTogVXNlIG9yYWNsaXplIHRvIGFuc3dlciB3aG8gaXMgUHJlc2lkZW50IG9mIHRoZSBVbml0ZWQgU3RhdGVzPwoKU3RyaW5nT3BzOiBTdHJpbmcgY29tcGFyaXNvbiwgY2hlY2sgaWYgb25lIHN0cmluZyBlbmRzIHdpdGggYW5vdGhlcgoKVHJ1bXBJbXBlYWNobWVudFRva2VuOiBDb21iaW5lcyBUaW1lZEV2aWRlbmNlVG9rZW4gYW5kIE9yYWNsaXplCgpUdW1wRnVsbFRlcm1Ub2tlbjogTGl0dGxlU2lzdGVyIG9mIFRydW1wSW1wZWFjaG1lbnRUb2tlbgoKKi8KCgovLyBDb250cmFjdCB3aXRoIGp1c3Qgb25lIHN0cmluZyBmdW5jdGlvbiBlbmRzd2l0aApjb250cmFjdCBTdHJpbmdPcHMgewoKICAgIC8vIHJldHVybnMgdHJ1ZSBpZiBzdHJpbmcgX2EgZW5kcyB3aXRoIHN0cmluZyBfYgogICAgZnVuY3Rpb24gc3RyaW5nRW5kc1dpdGgoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBjb252ZXJ0IHRvIGJ5dGVzIGJlY2F1c2Ugc3RyaW5ncyBhcmUgcmF0aGVyIHBvd2VybGVzcyBpbiBTb2xpZGl0eSBhcyBvZiAwLjQueAogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoX2IpOwoKICAgICAgICAvLyBpbiBjYXNlIGEgaXMgc2hvcnRlciB0aGFuIGIsIGEgbW9zdCBjZXJ0YWlubHkgY2Fubm90IGVuZCB3aXRoIGIKICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCl7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIERpZmZlcmVuY2UgaW4gbGVuZ3RoIGJldHdlZW4gYSBhbmQgYiwgYWxzbyBvZmZzZXQgZm9yIGEKICAgICAgICB1aW50IGxlbmd0aF9kaWZmID0gYS5sZW5ndGggLSBiLmxlbmd0aDsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYi5sZW5ndGg7IGkgKyspCiAgICAgICAgICAgIC8vIENoZWNrIGxldHRlciBieSBsZXR0ZXIsIHdpdGggYW4gb2Zmc2V0IGJ5IGxlbmd0aF9kaWZmCiAgICAgICAgICAgIGlmIChhW2kgKyBsZW5ndGhfZGlmZl0gIT0gYltpXSl7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCgovLyBFUkMgVG9rZW4gc3RhbmRhcmQgIzIwIEludGVyZmFjZQovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKY29udHJhY3QgRVJDMjBJbnRlcmZhY2UgewoKICAgIC8vIEdldCB0aGUgdG90YWwgdG9rZW4gc3VwcGx5CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CgogICAgLy8gR2V0IHRoZSBhY2NvdW50IGJhbGFuY2Ugb2YgYW5vdGhlciBhY2NvdW50IHdpdGggYWRkcmVzcyBfb3duZXIKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8gU2VuZCBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBhZGRyZXNzIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLyBTZW5kIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIGZyb20gYWRkcmVzcyBfZnJvbSB0byBhZGRyZXNzIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8gQWxsb3cgX3NwZW5kZXIgdG8gd2l0aGRyYXcgZnJvbSB5b3VyIGFjY291bnQsIG11bHRpcGxlIHRpbWVzLCB1cCB0byB0aGUgX3ZhbHVlIGFtb3VudC4KICAgIC8vIElmIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGFnYWluIGl0IG92ZXJ3cml0ZXMgdGhlIGN1cnJlbnQgYWxsb3dhbmNlIHdpdGggX3ZhbHVlLgogICAgLy8gdGhpcyBmdW5jdGlvbiBpcyByZXF1aXJlZCBmb3Igc29tZSBERVggZnVuY3Rpb25hbGl0eQogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8gUmV0dXJucyB0aGUgYW1vdW50IHdoaWNoIF9zcGVuZGVyIGlzIHN0aWxsIGFsbG93ZWQgdG8gd2l0aGRyYXcgZnJvbSBfb3duZXIKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0b2tlbnMgYXJlIHRyYW5zZmVycmVkLgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLy8gVHJpZ2dlcmVkIHdoZW5ldmVyIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIGlzIGNhbGxlZC4KICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgoKLy8gSW1wbGVtZW50YXRpb24gb2YgdGhlIG1vc3QgaW50cmljYXRlIHBhcnRzIG9mIHRoZSBFUkMyMEludGVyZmFjZSB0aGF0Ci8vIGFsbG93cyB0byBzZW5kIHRva2VucyBhcm91bmQKY29udHJhY3QgRVJDMjBUb2tlbiBpcyBFUkMyMEludGVyZmFjZXsKCiAgICAvLyBUaGUgdGhyZWUgbGV0dGVyIHN5bWJvbCB0byBkZWZpbmUgdGhlIHRva2VuLCBzaG91bGQgYmUgb3ZlcndyaXR0ZW4gaW4gc3ViY2xhc3MKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlRCQSI7CgogICAgLy8gTmFtZSBvZiB0b2tlbiBzaG91bGQgYmUgb3ZlcndyaXR0ZW4gaW4gY2hpbGQKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJUQkEiOwoKICAgIC8vIFRoZSBudW1iZXIgb2YgZGVjaW1hbHMsIDYgc2hvdWxkIGJlIGVub3VnaCAoc3JzbHkgd2hvIG5lZWRzIDE4Pz8pCiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSA2OwoKICAgIC8vIFdpdGggNiBkZWNpbWFscywgYSBzaW5nbGUgdW5pdCBpcyAxMCoqNgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdW5pdCA9IDEwMDAwMDA7CgogICAgLy8gQmFsYW5jZXMgZm9yIGVhY2ggYWNjb3VudAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAgIC8vIE93bmVyIG9mIGFjY291bnQgYXBwcm92ZXMgdGhlIHRyYW5zZmVyIG9mIGFtb3VudCB0byBhbm90aGVyIGFjY291bnQKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIFdoYXQgaXMgdGhlIGJhbGFuY2Ugb2YgYSBwYXJ0aWN1bGFyIGFjY291bnQ/CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLy8gVHJhbnNmZXIgdGhlIGJhbGFuY2UgZnJvbSBvd25lcidzIGFjY291bnQgdG8gYW5vdGhlciBhY2NvdW50CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfYW1vdW50ICYmIF9hbW91bnQgPiAwCiAgICAgICAgICAgICAgICAmJiBiYWxhbmNlc1tfdG9dICsgX2Ftb3VudCA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfYW1vdW50OwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFNlbmQgX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgZnJvbSBhZGRyZXNzIF9mcm9tIHRvIGFkZHJlc3MgX3RvCiAgICAvLyBUaGUgdHJhbnNmZXJGcm9tIG1ldGhvZCBpcyB1c2VkIGZvciBhIHdpdGhkcmF3IHdvcmtmbG93LCBhbGxvd2luZyBjb250cmFjdHMgdG8gc2VuZAogICAgLy8gdG9rZW5zIG9uIHlvdXIgYmVoYWxmLCBmb3IgZXhhbXBsZSB0byAiZGVwb3NpdCIgdG8gYSBjb250cmFjdCBhZGRyZXNzIGFuZC9vciB0byBjaGFyZ2UKICAgIC8vIGZlZXMgaW4gc3ViLWN1cnJlbmNpZXM7IHRoZSBjb21tYW5kIHNob3VsZCBmYWlsIHVubGVzcyB0aGUgX2Zyb20gYWNjb3VudCBoYXMKICAgIC8vIGRlbGliZXJhdGVseSBhdXRob3JpemVkIHRoZSBzZW5kZXIgb2YgdGhlIG1lc3NhZ2UgdmlhIHNvbWUgbWVjaGFuaXNtOyB3ZSBwcm9wb3NlCiAgICAvLyB0aGVzZSBzdGFuZGFyZGl6ZWQgQVBJcyBmb3IgYXBwcm92YWw6CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dID49IF9hbW91bnQKICAgICAgICAgICAgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX2Ftb3VudCAmJiBfYW1vdW50ID4gMAogICAgICAgICAgICAgICAgJiYgYmFsYW5jZXNbX3RvXSArIF9hbW91bnQgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfYW1vdW50OwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF9hbW91bnQ7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEFsbG93IF9zcGVuZGVyIHRvIHdpdGhkcmF3IGZyb20geW91ciBhY2NvdW50LCBtdWx0aXBsZSB0aW1lcywgdXAgdG8gdGhlIF92YWx1ZSBhbW91bnQuCiAgICAvLyBJZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpbiBpdCBvdmVyd3JpdGVzIHRoZSBjdXJyZW50IGFsbG93YW5jZSB3aXRoIF92YWx1ZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdG8gc3BlY2lmeSBob3cgbXVjaCBfc3BlbmRlciBpcyBhbGxvd2VkIHRvIHRyYW5zZmVyIG9uIF9vd25lcidzIGJlaGFsZgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKfQoKCi8qCgpUaGUgTGl0dGxlU2lzdGVyIGFsbG93cyBzZWxsaW5nIGFuZCBidXlpbmcgb2YgdG9rZW5zIHdoaWxlIHBheWluZyBhIHZpZyB0byB0aGUgb3duZXIuCgpIb3dldmVyLCB0aGUgTGl0dGxlU2lzdGVyVG9rZW4gaXMgZmVlbGluZyBpbnNlY3VyZSBhbG9uZSBhbmQgbmVlZHMgdG8gYmUgZ3VpZGVkIGJ5IGhlcgpCaWdTaXN0ZXJzVG9rZW4gdGhhdCB0ZWxscyBoZXIgaG93IG11Y2ggc3R1ZmYgaXMgd29ydGguCgpCb3RoIGNvbnRyYWN0cyBhcmUgdXNlbGVzcyB1bmxlc3MgdGhleSBrbm93IG9mIGVhY2ggb3RoZXIgdmlhIHJlZ2lzdGVyU2lzdGVyIG9mIHRoZQpCaWdTaXN0ZXJUb2tlbi4KCiovCmNvbnRyYWN0IExpdHRsZVNpc3RlclRva2VuIGlzIEVSQzIwVG9rZW57CgogICAgLy8gVGhlIHZpZyBzZW50IHRvIHRoZSBvd25lciBmb3IgZWFjaCBidXlpbmcgdHJhbnNhY3Rpb24KICAgIC8vIGUuZy4gdmlnID0gNDAgLT4gYW1vdW50IC8gNDAgLT4gMi41JSBhcmUgZGVkdWN0ZWQKICAgIHVpbnQ4IHB1YmxpYyB2aWc7CgogICAgLy8gTWF4aW11bSBTdXBwbHkgb2YgdG9rZW5zLCBzYW1lIGFzIGZvciB0aGUgQmlnU2lzdGVyVG9rZW4KICAgIC8vIE5vdGUgdGhhdCB0b3RhbFN1cHBseV9CaWdTaXN0ZXIgKyB0b3RhbFN1cHBseV9MaXR0bGVTaXN0ZXIgPD0gbWF4U3VwcGx5CiAgICB1aW50MjU2IHB1YmxpYyBtYXhTdXBwbHk7CgogICAgLy8gY3VycmVudGx5IGNpcmN1bGF0aW5nIFN1cHBseSBib3VuZGVkIGJ5IG1heFN1cHBseSAoc2VlIGFib3ZlKQogICAgdWludDI1NiB0b3RhbFN1cHBseV87CgogICAgLy8gTWF4aW11bSBkYXRlIGNvbnRyYWN0IGxpdmVzIG9uIGl0cyBvd24sIGFmdGVyd2FyZHMgY29udHJhY3QgY2FuIGJlIGRlc3Ryb3llZAogICAgLy8gU2hvdWxkIGJlIGEgcGlja2VkIGZhciwgZmFyIGluIHRoZSBmdXR1cmUgdG8gYWxsb3cgVG9rZW4gaG9sZGVycyBlbm91Z2ggdGltZSB0byByZWRlZW0gdGhlaXIKICAgIC8vIHdpbm5pbmdzCiAgICB1aW50IHB1YmxpYyB2YWxpZGl0eURhdGU7CgogICAgLy8gTWF4aW11bSBkYXRlIHVuaXRsIGJ1eWluZyBpcyBzdGlsbCBwb3NzaWJsZQogICAgdWludCBwdWJsaWMgbWF4QnV5aW5nRGF0ZTsKCiAgICAvLyBBZGRyZXNzIG9mIHRoZSAoYmlnKSBzaXN0ZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBhZGRyZXNzIHB1YmxpYyBzaXN0ZXI7CgogICAgLy8gT3duZXJzIG9mIHRoaXMgY29udHJhY3QsIGF3ZXNvbWUgcGVvcGxlIQogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgLy8gQWRkcmVzcyB0byBzZW5kIHZpZyB0bwogICAgYWRkcmVzcyBwdWJsaWMgdmlnQWRkcmVzczsKCiAgICAvLyBJZiBjb250cmFjdCBoYXMgbG9zdCwgaS5lLiBpZiBzbywgdGhlIG90aGVyIGNvbnRyYWN0IGhhcyB3b24gKG9idmlvdXNseSkKICAgIGJvb2wgcHVibGljIGxvc3Q7CgogICAgLy8gQ29uc3RydWN0b3Igb25seSBzZXRzIG93bmVyIGFuZCB0b3RhbFN1cHBseSwgb3RoZXIgcHJvcGVydGllcyBhcmUgZWl0aGVyCiAgICAvLyB0YWtlbiBmcm9tIHRoZSBiaWcgc2lzdGVyIG9yIHNldCBkdXJpbmcgcmVnaXN0ZXJpbmcKICAgIGZ1bmN0aW9uIExpdHRsZVNpc3RlclRva2VuKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB2aWdBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICB0b3RhbFN1cHBseV8gPSAwOwogICAgICAgIGxvc3QgPSBmYWxzZTsKICAgIH0KCiAgICAvLyBmYWxsYmFjayBmdW5jdGlvbiwgbm90ZSBvbmx5IHRoZSBiaWcgc2lzdGVyIGNhbiBzZW5kIGZ1bmRzIHRvIHRoaXMgY29udHJhY3QKICAgIC8vIHdpdGhvdXQgYnV5aW5nLCBvdGhlciBwZW9wbGUganVzdCBidXkgdGhlIHRva2VucwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gc2lzdGVyKXsKICAgICAgICAgICAgYnV5KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIENoYW5nZXMgdGhlIHZpZyBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXRWaWdBZGRyZXNzKGFkZHJlc3MgX25ld1ZpZ0FkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICB2aWdBZGRyZXNzID0gX25ld1ZpZ0FkZHJlc3M7CiAgICB9CgogICAgLy8gV2hhdCBpcyB0b3RhbCBjaXJjdWxhdGluZyBzdXBwbHk/CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5XzsKICAgIH0KCiAgICAvLyBmdW5jdGlvbiB0byBsaW5rIGJpZyBhbmQgbGl0dGxlIHNpc3RlciwgdGhpcyBvbmUgY2FuIG9ubHkgYmUKICAgIC8vIGNhbGxlZCBieSB0aGUgYmlnIHNpc3RlciBhbmQgb25seSBvbmNlCiAgICAvLyBPbmNlIGxpbmtlZCBjb250cmFjdHMgQ0FOTk9UIGJlIHVubGlua2VkIG9yIHJlcGxhY2VkIQogICAgZnVuY3Rpb24gcmVnaXN0ZXJTaXN0ZXIoYWRkcmVzcyBfc2lzdGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIEJpZ1Npc3RlclRva2VuIHNpc3RlckNvbnRyYWN0OwoKICAgICAgICAvLyB0YWtlIGNhcmUgdGhhdCByZWdpc3RlcmluZyBjYW4gb25seSBiZSBjYWxsZWQgb25jZSBhbmQgdGhlIHNpc3RlcgogICAgICAgIC8vIGNhbm5vdCBiZSBjaGFuZ2VkIGFmdGVyd2FyZHMKICAgICAgICByZXF1aXJlKHNpc3RlciA9PSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBjYW4gb25seSBiZSBjYWxsZWQgZnJvbSB0aGUgYmlnIHNpc3RlciwgbGlua2luZyBjYW4gYmUgaW52b2tlZCB0aGVyZSBieSB0aGUgb3duZXIKICAgICAgICByZXF1aXJlKF9zaXN0ZXIgIT0gYWRkcmVzcyh0aGlzKSk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGJpZyBzaXN0ZXIgaXMgd2hvIHNoZSBjbGFpbXMgdG8gYmUKICAgICAgICBzaXN0ZXJDb250cmFjdCA9IEJpZ1Npc3RlclRva2VuKF9zaXN0ZXIpOwogICAgICAgIHJlcXVpcmUoc2lzdGVyQ29udHJhY3Qub3duZXIoKSA9PSBvd25lcik7CiAgICAgICAgcmVxdWlyZShzaXN0ZXJDb250cmFjdC5zaXN0ZXIoKSA9PSBhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgLy8gc2hlIGNhbiBiZSB0cnVzdGVkIGFuZCBpcyBhY2NlcHRlZCBhcyB0aGUgbmV3IGJpZyBzaXN0ZXIKICAgICAgICBzaXN0ZXIgPSBfc2lzdGVyOwoKICAgICAgICAvLyBtYXhTdXBwbHksIHZpZyBhbmQgdmFsaWRpdHkgYW5kIG1heCBidXlpbmcgZGF0ZSBzaG91bGQgYmUgZXF1YWwgdG8gdGhlIGJpZyBzaXN0ZXIncwogICAgICAgIG1heFN1cHBseSA9IHNpc3RlckNvbnRyYWN0Lm1heFN1cHBseSgpOwogICAgICAgIHZpZyA9IHNpc3RlckNvbnRyYWN0LnZpZygpOwogICAgICAgIHZhbGlkaXR5RGF0ZSA9IHNpc3RlckNvbnRyYWN0LnZhbGlkaXR5RGF0ZSgpOwogICAgICAgIG1heEJ1eWluZ0RhdGUgPSBzaXN0ZXJDb250cmFjdC5tYXhCdXlpbmdEYXRlKCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFRoZSBzZWxsaW5nIHByaWNlIGlzIGFsc28gZGV0ZXJtaW5lZCBieSB0aGUgYmlnIHNpc3RlcgogICAgLy8gcmV0dXJucyBhbiB1aW50MjU2IHNlbGwgcHJpY2UKICAgIGZ1bmN0aW9uIHNlbGxQcmljZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICBCaWdTaXN0ZXJUb2tlbiBzaXN0ZXJDb250cmFjdCA9IEJpZ1Npc3RlclRva2VuKHNpc3Rlcik7CiAgICAgICAgcmV0dXJuIHNpc3RlckNvbnRyYWN0LnNlbGxQcmljZSgpOwogICAgfQoKICAgIC8vIExpa2V3aXNlIHRoZSBiaWcgc2lzdGVyIGRpY3RhdGVzIHRoZSBidXlpbmcgcHJpY2UKICAgIGZ1bmN0aW9uIGJ1eVByaWNlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIEJpZ1Npc3RlclRva2VuIHNpc3RlckNvbnRyYWN0ID0gQmlnU2lzdGVyVG9rZW4oc2lzdGVyKTsKICAgICAgICByZXR1cm4gc2lzdGVyQ29udHJhY3QuYnV5UHJpY2UoKTsKICAgIH0KCiAgICAvLyBTZW5kcyBhbGwgdGhlIGZ1bmRzIHRvIHRoZSBiaWcgc2lzdGVyLCBjYW4gb25seSBiZSBpbnZva2VkIGJ5IGhlcgogICAgZnVuY3Rpb24gc2VuZEZ1bmRzKCkgcHVibGljIHJldHVybnMoYm9vbCl7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNpc3Rlcik7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyLnNlbmQodGhpcy5iYWxhbmNlKSk7CiAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHRoZSBzaXN0ZXIgd29uIGFuZCB0aGlzIGNvbnRyYWN0IGxvc3QKICAgICAgICBsb3N0ID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBLaWxscyB0aGUgY29udHJhY3QgYW5kIHNlbmRzIGZ1bmRzIHRvIG93bmVyCiAgICAvLyBIb3dldmVyLCBvbmx5IGlmIHZhbGlkaXR5RGF0ZSBoYXMgYmVlbiBzdXJwYXNzZWQgKHNob3VsZCBiZSBjaG9zZW4gZmFyLCBmYXIgaW4gdGhlIGZ1dHVyZSkKICAgIGZ1bmN0aW9uIHJlbGVhc2VDb250cmFjdCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShub3cgPiB2YWxpZGl0eURhdGUpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzaXN0ZXIpOwogICAgICAgIHNlbGZkZXN0cnVjdChvd25lcik7CiAgICB9CgogICAgLy8gV2hhdCBpcyB0aGUgdmFsdWUgb2YgdGhpcyB0b2tlbiBpbiBjYXNlIHRoaXMgdG9rZW4gd2lucz8KICAgIC8vIFZhbHVlIGlzIGJhbGFuY2Ugb2YgdGhpcyBwbHVzIGJhbGFuY2Ugb2Ygc2lzdGVyIGFjY291bnQgcGVyIHRva2VuCiAgICBmdW5jdGlvbiB3aW5uaW5nVmFsdWUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB2YWx1ZSl7CiAgICAgICAgTGl0dGxlU2lzdGVyVG9rZW4gc2lzdGVyQ29udHJhY3QgPSBMaXR0bGVTaXN0ZXJUb2tlbihzaXN0ZXIpOwoKICAgICAgICBpZiAodG90YWxTdXBwbHlfID4gMCl7CiAgICAgICAgICAgIHZhbHVlID0gKHRoaXMuYmFsYW5jZSArIHNpc3RlckNvbnRyYWN0LmJhbGFuY2UpIC8gdG90YWxTdXBwbHlfOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQoKICAgIC8vIFN1cHBseSB0aGF0IHN0aWxsIGNhbiBiZSBib3VnaHQKICAgIGZ1bmN0aW9uIGF2YWlsYWJsZVN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSl7CiAgICAgICAgTGl0dGxlU2lzdGVyVG9rZW4gc2lzdGVyQ29udHJhY3Q7CiAgICAgICAgdWludDI1NiBzaXN0ZXJTdXBwbHk7CgogICAgICAgIGlmICgoYnV5UHJpY2UoKSkgPT0gMCB8fCAobm93ID4gbWF4QnV5aW5nRGF0ZSkpewogICAgICAgICAgICAvLyB0aGVyZSBjYW4gb25seSBiZSBzdXBwbHkgaW4gY2FzZSBidXlpbmcgaXMgYWxsb3dlZAogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgc2lzdGVyQ29udHJhY3QgPSBMaXR0bGVTaXN0ZXJUb2tlbihzaXN0ZXIpOwogICAgICAgICAgICBzaXN0ZXJTdXBwbHkgPSBzaXN0ZXJDb250cmFjdC50b3RhbFN1cHBseSgpOwogICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBtb3N0IGltcG9ydGFudCBhc3NlcnRpb24gZXZlciA7LSkKICAgICAgICAgICAgYXNzZXJ0KG1heFN1cHBseSA+PSB0b3RhbFN1cHBseV8gKyBzaXN0ZXJTdXBwbHkpOwogICAgICAgICAgICBzdXBwbHkgPSBtYXhTdXBwbHkgLSB0b3RhbFN1cHBseV8gLSBzaXN0ZXJTdXBwbHk7CiAgICAgICAgICAgIHJldHVybiBzdXBwbHk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIEJ1eSB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QgZGVwZW5kaW5nIG9uIGhvdyBtdWNoIG1vbmV5IGhhcyBiZWVuIHNlbnQKICAgIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQgYW1vdW50KXsKICAgICAgICB1aW50MjU2IGhvdXNlOwogICAgICAgIHVpbnQyNTYgc3VwcGx5OwogICAgICAgIHVpbnQyNTYgcHJpY2U7CgogICAgICAgIC8vIGNoZWNrIHRoYXQgYnV5aW5nIGlzIHN0aWxsIGFsbG93ZWQKICAgICAgICByZXF1aXJlKG5vdyA8PSBtYXhCdXlpbmdEYXRlKTsKICAgICAgICAvLyBnZXQgdGhlIHByaWNlCiAgICAgICAgcHJpY2UgPSBidXlQcmljZSgpOwogICAgICAgIC8vIFN0dWZmIGNhbiBvbmx5IGJlIHNvbGQgaWYgdGhlIHByaWNlIGlzIG5vbnplcm8KICAgICAgICAvLyBpLmUuIHNldHRpbmcgdGhlIHByaWNlIHRvIDAgY2FuIHN1c3BlbmQgdGhlIFRva2VuIHNhbGUKICAgICAgICByZXF1aXJlKHByaWNlID4gMCk7CiAgICAgICAgaG91c2UgPSBtc2cudmFsdWUgLyB2aWc7CiAgICAgICAgLy8gQydtb24geW91IGdvdHRhIHBheSB0aGUgaG91c2UhCiAgICAgICAgcmVxdWlyZShob3VzZSA+IDApOwogICAgICAgIGFtb3VudCA9IG1zZy52YWx1ZSAvIHByaWNlOwogICAgICAgIHN1cHBseSA9IGF2YWlsYWJsZVN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoYW1vdW50IDw9IHN1cHBseSk7CiAgICAgICAgLy8gU2VuZCB0aGUgY29tbWlzc2lvbiB0byB0aGUgdmlnQWRkcmVzcyBvZiB0aGlzIGNvbnRyYWN0CiAgICAgICAgdmlnQWRkcmVzcy50cmFuc2Zlcihob3VzZSk7CiAgICAgICAgdG90YWxTdXBwbHlfICs9IGFtb3VudDsKICAgICAgICAvLyBJbmNyZWFzZSB0aGUgc2VuZGVyJ3MgYmFsYW5jZSBieSB0aGUgYXBwcm9wcmlhdGUgYW1vdW50CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gYW1vdW50OwogICAgICAgIFRyYW5zZmVyKHRoaXMsIG1zZy5zZW5kZXIsIGFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICAvLyBVc2VycyBjYW4gcmVkZWVtIHRoZWlyIGNhc2ggYW5kIHNlbGwgdGhlaXIgdG9rZW5zIGJhY2sgdG8gdGhlIGNvbnRyYWN0CiAgICAvLyBOb3RlIHRoYXQgdGhpcyB1c3VhbGx5IHJlcXVpcmVzIHRoYXQgZWl0aGVyIHRoZSBsaXR0bGUgb3IgdGhlIGJpZyBzaXN0ZXIKICAgIC8vIGhhcyB0cmFuc2ZlcnJlZCBhbGwgdGhlaXIgZnVuZHMgdG8gdGhlIG90aGVyIGNvbnRyYWN0IGFuZCBzZXQgc2VsbCBwcmljZSBub256ZXJvCiAgICBmdW5jdGlvbiBzZWxsKHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKHVpbnQyNTYgcmV2ZW51ZSl7CiAgICAgICAgLy8gVG9rZW5zIGNhbiBvbmx5IGJlIHNvbGQgYmFjayB0byB0aGUgY29udHJhY3QgaWYgdGhlIHByaWNlIGlzIG5vbnplcm8KICAgICAgICAvLyBpLmUuIHRoZSBzZWxsUHJpY2UgY2FuIGFsc28gYWN0IGFzIGEgc3dpdGNoLCB1c3VhbGx5IGl0IGlzIG9mZiBieSBkZWZhdWx0CiAgICAgICAgLy8gYW5kIG9ubHkgdHVybmVkIG9uIGJ5IHNvbWUgZXZlbnQgKGkuZS4gb25lIG9mIHRoZSB0d28gdG9rZW5zIHdpbm5pbmcpCiAgICAgICAgcmVxdWlyZShzZWxsUHJpY2UoKSA+IDApOwogICAgICAgIHJlcXVpcmUoIWxvc3QpOwogICAgICAgIC8vIGNoZWNrIGlmIHRoZSB1c2VyIGhhcyBzdWZmaWNpZW50IGFtb3VudCBvZiB0b2tlbnMKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF9hbW91bnQpOwogICAgICAgIHJldmVudWUgPSBfYW1vdW50ICogc2VsbFByaWNlKCk7CiAgICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gcmV2ZW51ZSk7CiAgICAgICAgLy8gZmlyc3QgZGVkdWN0IHRva2VucyBmcm9tIHVzZXIKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwogICAgICAgIHRvdGFsU3VwcGx5XyAtPSBfYW1vdW50OwogICAgICAgIC8vIGZpbmFsbHkgdHJhbnNmZXIgdGhlIGV0aGVyLCB0aGlzIHdpdGhkcmF3YWwgcGF0dGVybiBwcmV2ZW50cyByZS1lbnRyeSBhdHRhY2tzCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihyZXZlbnVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0aGlzLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gcmV2ZW51ZTsKICAgIH0KCiAgICAvLyBTZWxscyBhbGwgdG9rZW5zIG9mIGEgdXNlcgogICAgZnVuY3Rpb24gc2VsbEFsbCgpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwogICAgICAgIHJldHVybiBzZWxsKGFtb3VudCk7CiAgICB9Cgp9CgoKLyoKClRoaXMgaXMgdGhlIGJpZyBzaXN0ZXIgb2YgdGhlIExpdHRsZVNpc3RlclRva2VuLCBpdCBnb3Zlcm5zIHRoZSBsaXR0bGUgc2lzdGVyLgpJdCBrbm93cyBhYm91dCB0aGUgc2VsbCBhbmQgYnV5aW5nIHByaWNlcy4KCiovCmNvbnRyYWN0IEJpZ1Npc3RlclRva2VuIGlzIExpdHRsZVNpc3RlclRva2VuIHsKCiAgICAvLyBUaGUgYnV5aW5nIHByaWNlLCAwIG1lYW5zIGJ1eWluZyBpcyBzdXNwZW5kZWQKICAgIHVpbnQyNTYgYnV5UHJpY2VfOwoKICAgIC8vIFRoZSBzZWxsIHByaWNlLCAwIHN1c3BlbmRzIHNlbGxpbmcKICAgIHVpbnQyNTYgc2VsbFByaWNlXzsKCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gQmlnU2lzdGVyVG9rZW4odWludDI1NiBfbWF4U3VwcGx5LCB1aW50MjU2IF9idXlQcmljZSwgdWludDI1NiBfc2VsbFByaWNlLCB1aW50OCBfdmlnLAogICAgICAgICAgICB1aW50IF9idXlpbmdIb3Jpem9uLCB1aW50IF9tYXhpbXVtTGlmZXRpbWUpIHsKICAgICAgICBtYXhTdXBwbHkgPSBfbWF4U3VwcGx5OwogICAgICAgIHZpZyA9IF92aWc7CiAgICAgICAgYnV5UHJpY2VfID0gX2J1eVByaWNlOwogICAgICAgIHNlbGxQcmljZV8gPSBfc2VsbFByaWNlOwogICAgICAgIC8vIE1heGltdW0gbGlmZXRpbWUgaXMgbm90IGEgZGF0ZSwgYnV0IGEgdGltZSBpbnRlcnZhbAogICAgICAgIHZhbGlkaXR5RGF0ZSA9IG5vdyArIF9tYXhpbXVtTGlmZXRpbWU7CiAgICAgICAgLy8gSG9yaXpvbiBhZnRlciB3aGljaCBidXlpbmcgaXMgZGVmaW5pdGVseSBzdXNwZW5kZWQKICAgICAgICBtYXhCdXlpbmdEYXRlID0gbm93ICsgX2J1eWluZ0hvcml6b247CiAgICB9CgogICAgZnVuY3Rpb24gYnV5UHJpY2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgcmV0dXJuIGJ1eVByaWNlXzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxsUHJpY2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgcmV0dXJuIHNlbGxQcmljZV87CiAgICB9CgogICAgLy8gRGVzdHJveXMgdGhlIGNvbnRyYWN0IGFzIHdlbGwgYXMgdGhlIGxpdHRsZSBzaXN0ZXIuCiAgICAvLyBJbXBvcnRhbnQgX21heGltdW1MaWZldGltZSBzaG91bGQgYmUgc2V0IGdlbmVyb3VzbHkgdG8gZ2l2ZSB0b2tlbiBob2xkZXJzCiAgICAvLyBwbGVudHkgZm8gdGltZSB0byB3aXRoZHJhdyB0aGVpciBtb25leSBpbiBjYXNlIHRoZXkgd2luCiAgICAvLyBvbmx5IHRoZSBvd25lciBjYW4gaW52b2tlIHRoaXMgY29tbWFuZAogICAgZnVuY3Rpb24gcmVsZWFzZUNvbnRyYWN0KCkgcHVibGljIHsKICAgICAgICBMaXR0bGVTaXN0ZXJUb2tlbiBzaXN0ZXJDb250cmFjdCA9IExpdHRsZVNpc3RlclRva2VuKHNpc3Rlcik7CgogICAgICAgIHJlcXVpcmUobm93ID4gdmFsaWRpdHlEYXRlKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIC8vIGFsc28gZGVzdHJveSB0aGUgbGl0dGxlIHNpc3RlcgogICAgICAgIHNpc3RlckNvbnRyYWN0LnJlbGVhc2VDb250cmFjdCgpOwogICAgICAgIHNlbGZkZXN0cnVjdChvd25lcik7CiAgICB9CgogICAgLy8gTGlua3MgYSBsaXR0bGUgYW5kIGEgYmlnIHNpc3RlciB0b2dldGhlciwgY2FuIG9ubHkgYmUgaW52b2tlZCBieSBvd25lci4KICAgIC8vIElNUE9SVEFOVCBjb250cmFjdHMgY2FuIG9ubHkgYmUgcmVnaXN0ZXJlZCBvbmNlLCBsaW5raW5nIENBTk5PVCBiZSBjaGFuZ2VkIG9yIG1vZGlmaWVkLgogICAgZnVuY3Rpb24gcmVnaXN0ZXJTaXN0ZXIoYWRkcmVzcyBfc2lzdGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIExpdHRsZVNpc3RlclRva2VuIHNpc3RlckNvbnRyYWN0OwoKICAgICAgICAvLyBtYWtlIHN1cmUgdGhhdCBjb250cmFjdCByZWdpc3RyYXRpb24gd29ya3Mgb25seSBvbmNlCiAgICAgICAgcmVxdWlyZShzaXN0ZXIgPT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gY2FuIG9ueWwgYmUgY2FsbGVkIGJ5IG93bmVyCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICByZXF1aXJlKF9zaXN0ZXIgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgc2lzdGVyQ29udHJhY3QgPSBMaXR0bGVTaXN0ZXJUb2tlbihfc2lzdGVyKTsKICAgICAgICByZXF1aXJlKHNpc3RlckNvbnRyYWN0LnNpc3RlcigpID09IGFkZHJlc3MoMCkpOwogICAgICAgIHNpc3RlciA9IF9zaXN0ZXI7CiAgICAgICAgLy8gZmluYWxseSBhbHNvIHJlZ2lzdGVyIHRoaXMgYmlnIHNpc3RlciB3aXRoIGl0cyBuZXcgbGl0dGxlIHNpc3RlcgogICAgICAgIHJlcXVpcmUoc2lzdGVyQ29udHJhY3QucmVnaXN0ZXJTaXN0ZXIoYWRkcmVzcyh0aGlzKSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKfQoKCi8qCgpUaGlzIHRva2VuIGFsbG93cyBmb3IgcHJpY2UgaW5jcmVhc2VzIGFmdGVyIGEgY2VydGFpbiBhbW91bnQgb2YgcHVyY2hhc2VzLgpOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbmFsaXR5IGlzIGFjdHVhbGx5IHByb3ZpZGVkIGJ5IGl0cyBiaWcgc2lzdGVyIGNhbGxlZApQcmljZUluY3JlYXNpbmdUb2tlbi4KCiovCmNvbnRyYWN0IFByaWNlSW5jcmVhc2luZ0xpdHRsZVNpc3RlclRva2VuIGlzIExpdHRsZVNpc3RlclRva2VuewoKICAgIC8vIGZhbGxiYWNrIGZ1bmN0aW9uLCBub3RlIG9ubHkgdGhlIGJpZyBzaXN0ZXIgY2FuIHNlbmQgZnVuZHMgdG8gdGhpcyBjb250cmFjdAogICAgLy8gd2l0aG91dCBidXlpbmcsIG90aGVyIHBlb3BsZSBqdXN0IGJ1eSB0aGUgdG9rZW5zCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBzaXN0ZXIpewogICAgICAgICAgICBidXkoKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQnV5IHRva2VucyBmcm9tIHRoZSBjb250cmFjdCwgYXMgaW4gcGFyZW50IGNsYXNzLCBidXQKICAgIC8vIGFzayB0aGUgc2lzdGVyIGlmIHByaWNlIG5lZWRzIHRvIGJlIGluY3JlYXNlZCBmb3IgZnV0dXJlIHB1cmNoYXNlcwogICAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludCBhbW91bnQpewogICAgICAgIFByaWNlSW5jcmVhc2luZ1Rva2VuIHNpc3RlckNvbnRyYWN0ID0gUHJpY2VJbmNyZWFzaW5nVG9rZW4oc2lzdGVyKTsKCiAgICAgICAgLy8gYnV5IHRva2VucwogICAgICAgIGFtb3VudCA9IHN1cGVyLmJ1eSgpOwogICAgICAgIC8vIG5vdGlmeSB0aGUgc2lzdGVyIGFib3V0IHRoZSBzb2xkIGFtb3VudCBhbmQgbWF5YmUgdXBkYXRlIHByaWNlcwogICAgICAgIHNpc3RlckNvbnRyYWN0LnNpc3RlckNoZWNrUHJpY2UoYW1vdW50KTsKICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKfQoKCi8qCgpUaGlzIGlzIHRoZSBiaWcgc2lzdGVyIGZvciBwcmljZSBpbmNyZWFzZXMuCk5lZWRzIHRvIGJlIGxpbmtlZCB0byBhIFByaWNlSW5jcmVhc2luZ0xpdHRsZVNpc3RlclRva2VuLgpOb3RlIHRoYXQgcHJpY2UgaW5jcmVhc2UgYWx3YXlzIGhhcHBlbnMgYWZ0ZXIgc29tZW9uZSBib3VnaHQgdG9rZW5zLCBuZXZlciBiZWZvcmUuCgoqLwpjb250cmFjdCBQcmljZUluY3JlYXNpbmdUb2tlbiBpcyBCaWdTaXN0ZXJUb2tlbnsKCiAgICAvLyBIZWxwZXIgdmFyaWFibGUgdG8gc3RvcmUgbnVtYmVyIG9mIHRva2VucyBwdXJjaGFzZXMgc2luY2UgbGFzdCBwcmljZSBpbmNyZWFzZQogICAgdWludDI1NiBwdWJsaWMgY3VycmVudEJhdGNoOwoKICAgIC8vIE51bWJlciBvZiB0b2tlbnMgdGhhdCBuZWVkIHRvIGJlIGJvdWdodCB0byB0cmlnZ2VyIGEgcHJpY2UgaW5jcmVhc2UKICAgIHVpbnQyNTYgcHVibGljIHRocmVzaG9sZEFtb3VudDsKCiAgICAvLyBJbmNyZWFzZSBvZiBwcmljZSBpZiB0aHJlc2hvbGRBbW91bnQgaXMgbWV0CiAgICB1aW50MjU2IHB1YmxpYyBwcmljZUluY3JlYXNlOwoKICAgIGZ1bmN0aW9uIFByaWNlSW5jcmVhc2luZ1Rva2VuKHVpbnQyNTYgX21heFN1cHBseSwgdWludDI1NiBfYnV5UHJpY2UsIHVpbnQyNTYgc2VsbFByaWNlXywgdWludDggX3ZpZywKICAgICAgICB1aW50MjU2IF90aHJlc2hvbGRBbW91bnQsIHVpbnQyNTYgX3ByaWNlSW5jcmVhc2UsIHVpbnQgX2J1eWluZ0hvcml6b24sIHVpbnQgX21heGltdW1MaWZldGltZSkKICAgICAgICAgICAgQmlnU2lzdGVyVG9rZW4oIF9tYXhTdXBwbHksIF9idXlQcmljZSwgc2VsbFByaWNlXywgX3ZpZywgX2J1eWluZ0hvcml6b24sIF9tYXhpbXVtTGlmZXRpbWUpewogICAgICAgIGN1cnJlbnRCYXRjaCA9IDA7CiAgICAgICAgdGhyZXNob2xkQW1vdW50ID0gX3RocmVzaG9sZEFtb3VudDsKICAgICAgICBwcmljZUluY3JlYXNlID0gX3ByaWNlSW5jcmVhc2U7CiAgICB9CgogICAgLy8gZmFsbGJhY2sgZnVuY3Rpb24sIG5vdGUgb25seSB0aGUgYmlnIHNpc3RlciBjYW4gc2VuZCBmdW5kcyB0byB0aGlzIGNvbnRyYWN0CiAgICAvLyB3aXRob3V0IGJ1eWluZywgb3RoZXIgcGVvcGxlIGp1c3QgYnV5IHRoZSB0b2tlbnMKICAgIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHNpc3Rlcil7CiAgICAgICAgICAgIGJ1eSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBCdXkgdG9rZW5zIGZyb20gdGhlIGNvbnRyYWN0IGFuZCBjaGVja3MgcHJpY2UgYW5kIHBvdGVudGlhbGx5IGluY3JlYXNlcwogICAgLy8gdGhlIHByaWNlIGFmdGVyd2FyZHMKICAgIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQgYW1vdW50KXsKICAgICAgICBhbW91bnQgPSBzdXBlci5idXkoKTsKICAgICAgICAvLyBjaGVjayBmb3IgcHJpY2UgaW5jcmVhc2UKICAgICAgICBfY2hlY2tQcmljZShhbW91bnQpOwogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgLy8gRnVuY3Rpb24gdGhhdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIHNpc3RlciB0byBjaGVjayBhbmQgaW5jcmVhc2UgcHJpY2VzCiAgICAvLyBUaGlzIGlzIG5lZWRlZCBiZWNhdXNlIHRoZSBfY2hlY2tQcmljZSBmdW5jdGlvbiBpcyBpbnRlcm5hbCBhbmQgY2Fubm90CiAgICAvLyBiZSBjYWxsZWQgYnkgdGhlIHNpc3RlciBkaXJlY3RseQogICAgZnVuY3Rpb24gc2lzdGVyQ2hlY2tQcmljZSh1aW50MjU2IGFtb3VudCkgcHVibGljewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzaXN0ZXIpOwogICAgICAgIF9jaGVja1ByaWNlKGFtb3VudCk7CiAgICB9CgogICAgLy8gaW50ZXJuYWwgZnVuY3Rpb24gdG8gY2hlY2sgYW5kIG1heWJlIGluY3JlYXNlIHRoZSBidXlpbmcgcHJpY2UKICAgIC8vIGV2ZXJ5IHRpbWUgdGhlIHRocmVzaG9sZEFtb3VudCBpcyBtZXQsIHRoZSBwcmljZSBpcyBpbmNyZWFzZWQKICAgIGZ1bmN0aW9uIF9jaGVja1ByaWNlKHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbHsKICAgICAgICBjdXJyZW50QmF0Y2ggKz0gYW1vdW50OwogICAgICAgIGlmIChjdXJyZW50QmF0Y2ggPj0gdGhyZXNob2xkQW1vdW50KXsKICAgICAgICAgICAgYnV5UHJpY2VfICs9IHByaWNlSW5jcmVhc2U7CiAgICAgICAgICAgIC8vIGl0IGlzIGltcG9ydGFudCB0byBzdWJ0cmFjdCB0aGUgdGhyZXNob2xkQW1vdW50CiAgICAgICAgICAgIC8vIGFuZCBub3Qgc2V0IGN1cnJlbnRCYXRjaCA9IDAgaW5zdGVhZC4gVGhpcyBlbnN1cmVzIHRoYXQKICAgICAgICAgICAgLy8gYSBodWdlIG9yZGVyIGNyb3NzaW5nIG11bHRpcGxlIHRocmVzaG9sZHMgd2lsbCB0cmlnZ2VyIHByaWNlCiAgICAgICAgICAgIC8vIGluY3JlYXNlcyBpbiBxdWljayBzdWNjZXNzaW9ucwogICAgICAgICAgICBjdXJyZW50QmF0Y2ggLT0gdGhyZXNob2xkQW1vdW50OwogICAgICAgIH0KICAgIH0KCn0KCgovKgoKVGhpcyBjb250cmFjdCBhZGRzIHRoZSBhYmlsaXR5IHRvIGNoZWNrIGZvciBldmlkZW5jZSB0byBlbmFibGUgdGhlIGNvbnRyYWN0J3Mgd2lubmluZy4KVGhlcmUgYXJlIHR3byBjb25kaXRpb25zLCBlaXRoZXIgYSBjZXJ0YWluIGZpeGVkIGRhdGUgaGFzIHBhc3NlZCAoZGF0ZVNpc3RlcldpbnMpIGFuZCwKaW4gdGhpcyBjYXNlLCB0aGUgbGl0dGUgc2lzdGVyIHdpbnMsIG9yIHNvbWUgZXZpZGVuY2UgaXMgZ2F0aGVyZWQgcHJvdmluZyB0aGUgb3Bwb3NpdGUuCgpIb3cgdGhpcyBldmlkZW5jZSBpcyBnYXRoZXJlZCBuZWVkcyB0byBiZSBpbXBsZW1lbnRlZCBpbiB0aGUgc3ViY2xhc3MuIE5vdGUgdGhhdAp0aGlzIGV2aWRlbmNlIG5lZWRzIHRvIGJlIGFjcXVpcmVkIGEgY291cGxlIG9mIHRpbWVzIHRvIGJlIGNlcnRhaW4uIE1vcmVvdmVyLCBpbiBiZXR3ZWVuCmRpZmZlcmVudCBmaW5kaW5ncyBvZiByZXBlYXRpbmcgZXZpZGVuY2UgdGhlcmUgbmVlZHMgdG8gcGFzcyBhIGNlcnRhaW4gZXZpZGVuY2VJbnRlcnZhbC4KCiovCgpjb250cmFjdCBUaW1lZEV2aWRlbmNlVG9rZW4gaXMgUHJpY2VJbmNyZWFzaW5nVG9rZW57CgogICAgLy8gZml4ZWQgZGF0ZSB0aGF0IHNwZWNpZmllcyB3aGVuIHRoZSBsaXR0bGUgc2lzdGVyIHdpbGwgd2luICh1bml4IHRpbWVzdGFtcCkKICAgIHVpbnQgcHVibGljIGRhdGVTaXN0ZXJXaW5zOwoKICAgIC8vIGFtb3VudCBvZiBldmlkZW5jZSBmb3VuZAogICAgdWludDggcHVibGljIGZvdW5kRXZpZGVuY2U7CgogICAgLy8gYW1vdW50IG9mIGV2aWRlbmNlIHJlcXVpcmVkIGZvciB2aWN0b3J5LAogICAgLy8gdGhlIGJpZyBzaXN0ZXIgd2lucyBpZiBmb3VuZEV2aWRlbmNlID49IHJlcXVpcmVkRXZpZGVuY2UKICAgIHVpbnQ4IHB1YmxpYyByZXF1aXJlZEV2aWRlbmNlOwoKICAgIC8vIFRpbWUgaW50ZXJ2YWwgYmV0d2VlbiB0d28gY29uc2VjdXRpdmUgZXZpZGVuY2UgY2hlY2tzCiAgICB1aW50IHB1YmxpYyBldmlkZW5jZUludGVydmFsOwoKICAgIC8vIExhc3QgdGltZSBldmlkZW5jZSB3YXMgY2hlY2tlZAogICAgdWludCBwdWJsaWMgbGFzdEV2aWRlbmNlQ2hlY2s7CgogICAgLy8gSGVscGVyIHZhcmlhYmxlIHRvIHN0b3JlIHRoZSBsYXN0IHByaWNlLgogICAgLy8gSWYgdGhlIGNvbnRyYWN0IG5lZWRzIHRvIHN1c3BlbmQgYnV5aW5nIGltbWVkaWF0ZWx5IGluIGNhc2UKICAgIC8vIG9mIGV2aWRlbmNlLCB0aGlzIGNhbiByZXN0b3JlIGJ1eWluZyBpZiBldmlkZW5jZSBjYW5ub3QgYmUgZm91bmQgc3Vic2VxdWVudGx5CiAgICB1aW50MjU2IGxhc3RCdXlQcmljZTsKCiAgICBmdW5jdGlvbiBUaW1lZEV2aWRlbmNlVG9rZW4odWludDI1NiBfbWF4U3VwcGx5LCB1aW50MjU2IF9idXlQcmljZSwgdWludDggX3ZpZywKICAgICAgICB1aW50MjU2IF90aHJlc2hvbGRBbW91bnQsIHVpbnQyNTYgX3ByaWNlSW5jcmVhc2UsIHVpbnQgX2V2aWRlbmNlSW50ZXJ2YWwsCiAgICAgICAgdWludDggX3JlcXVpcmVkRXZpZGVuY2UsIHVpbnQgX2RhdGVTaXN0ZXJXaW5zLAogICAgICAgIHVpbnQgX2J1eWluZ0hvcml6b24sIHVpbnQgX21heGltdW1MaWZldGltZSkKICAgICAgICBQcmljZUluY3JlYXNpbmdUb2tlbihfbWF4U3VwcGx5LCBfYnV5UHJpY2UsIDAsX3ZpZywKICAgICAgICBfdGhyZXNob2xkQW1vdW50LCBfcHJpY2VJbmNyZWFzZSwgX2J1eWluZ0hvcml6b24sIF9tYXhpbXVtTGlmZXRpbWUpewogICAgZXZpZGVuY2VJbnRlcnZhbCA9IF9ldmlkZW5jZUludGVydmFsOwogICAgbGFzdEV2aWRlbmNlQ2hlY2sgPSAwOwogICAgZm91bmRFdmlkZW5jZSA9IDA7CiAgICBsYXN0QnV5UHJpY2UgPSAwOwogICAgZGF0ZVNpc3RlcldpbnMgPSBfZGF0ZVNpc3RlcldpbnM7CiAgICByZXF1aXJlZEV2aWRlbmNlID0gX3JlcXVpcmVkRXZpZGVuY2U7CiAgICB9CgogICAgLy8gQ2hlY2tzIGFuZCBpbml0aWF0ZXMgcGF5b3V0LCBpLmUuIHVzZXJzIGNhbiBzZWxsIHRoZWlyIHRva2VucyBiYWNrIHRvIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gY2hlY2tGb3JQYXlvdXQoKSBwdWJsaWMgcmV0dXJucyhib29sKXsKICAgICAgICBMaXR0bGVTaXN0ZXJUb2tlbiBzaXN0ZXJDb250cmFjdCA9IExpdHRsZVNpc3RlclRva2VuKHNpc3Rlcik7CgogICAgICAgIC8vIGlmIHdlIGFscmVhZHkgc2VsbCwgcGF5b3V0IGlzIGRlZmluaXRlbHkgdHJ1ZQogICAgICAgIGlmIChzZWxsUHJpY2VfID4gMCkgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIENoZWNrIGlmIHRoZSBmaXhlZCBkYXRlIGhhcyBwYXNzZWQ6CiAgICAgICAgaWYgKG5vdyA+IGRhdGVTaXN0ZXJXaW5zKXsKICAgICAgICAgICAgLy8gU2lzdGVyIHdpbnMgYW5kIHRoaXMgdG9rZW4gYmVjb21lcyB3b3J0aGxlc3MKICAgICAgICAgICAgcmVxdWlyZShzaXN0ZXJDb250cmFjdC5zZW5kKHRoaXMuYmFsYW5jZSkpOwogICAgICAgICAgICAvLyB0aGlzIGNvbnRyYWN0IGxvc3QKICAgICAgICAgICAgbG9zdCA9IHRydWU7CiAgICAgICAgICAgIC8vIGJ1eWluZyBpcyBubyBtb3JlIHBvc3NpYmxlCiAgICAgICAgICAgIGJ1eVByaWNlXyA9IDA7CiAgICAgICAgICAgIC8vIG5vdyBzZXQgdGhlIHNlbGwgcHJpY2UKICAgICAgICAgICAgc2VsbFByaWNlXyA9IHNpc3RlckNvbnRyYWN0LmJhbGFuY2UgLyBzaXN0ZXJDb250cmFjdC50b3RhbFN1cHBseSgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGlmIGVub3VnaCBldmlkZW5jZSB3YXMgZm91bmQKICAgICAgICBpZiAoZm91bmRFdmlkZW5jZSA+PSByZXF1aXJlZEV2aWRlbmNlKXsKICAgICAgICAgICAgLy8gVHJ1bXAgaXMgaW1wZWFjaGVkIHRoaXMgdG9rZW4gaXMgZ2FpbmluZyBpbiB2YWx1ZSEKICAgICAgICAgICAgLy8gU2lzdGVyIGxvc3QgYW5kIG5lZWRzIHRvIHNlbmQgaGVyIGZ1bmRzCiAgICAgICAgICAgIHJlcXVpcmUoc2lzdGVyQ29udHJhY3Quc2VuZEZ1bmRzKCkpOwogICAgICAgICAgICAvLyBidXlpbmcgaXMgbm8gbW9yZSBwb3NzaWJsZQogICAgICAgICAgICBidXlQcmljZV8gPSAwOwogICAgICAgICAgICAvLyBub3cgc2V0IHRoZSBzZWxsIHByaWNlCiAgICAgICAgICAgIHNlbGxQcmljZV8gPSB0aGlzLmJhbGFuY2UgLyB0b3RhbFN1cHBseSgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgfQoKICAgICAgICAvLyBJZiBib3RoIGNhc2VzIGFyZSBub3QgdHJ1ZSwgdGhlbiB1bmZvcnR1bmF0ZWx5LCB3ZSBjYW5ub3QgcGF5IHlvdSAoeWV0KQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBpbnRlcm5hbCBmdW5jdGlvbiBuZWVkcyB0byBiZSBjYWxsZWQgYnkgdGhlIGV2aWRlbmNlIGdhdGhlcmluZyBpbXBsZW1lbnRhdGlvbgogICAgLy8gaW4gc3ViY2xhc3MKICAgIGZ1bmN0aW9uIF9hY2N1bXVsYXRlRXZpZGVuY2UoYm9vbCBldmlkZW5jZSkgaW50ZXJuYWx7CiAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgZW5vdWdoIHRpbWUgaGFzIHBhc3NlZCBzaW5jZSB0aGUgbGFzdCBldmlkZW5jZSBjaGVjawogICAgICAgIHJlcXVpcmUobm93ID4gbGFzdEV2aWRlbmNlQ2hlY2sgKyBldmlkZW5jZUludGVydmFsKTsKICAgICAgICBsYXN0RXZpZGVuY2VDaGVjayA9IG5vdzsKCiAgICAgICAgaWYgKGV2aWRlbmNlKXsKICAgICAgICAgICAgaWYgKGJ1eVByaWNlXyA+IDApewogICAgICAgICAgICAgICAgLy8gc3VzcGVuZCBidXlpbmcgYXMgc29vbiBhcyB0aGVyZSBpcyBldmlkZW5jZQogICAgICAgICAgICAgICAgbGFzdEJ1eVByaWNlID0gYnV5UHJpY2VfOwogICAgICAgICAgICAgICAgYnV5UHJpY2VfID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBpbmNyZWFzZSBldmlkZW5jZQogICAgICAgICAgICBmb3VuZEV2aWRlbmNlICs9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gcmVzdW1lIGJ1eWluZyBpbiBjYXNlIGZvdW5kRXZpZGVuY2UgaXMgcmVkdWNlZC4KICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHJlc3VtaW5nIGJ1eWluZyBuZWVkcyB0byBmaW5kIG9uZSBtb3JlIGV2aWRlbmNlIGFnYWluc3QgdGhhbiBwcm8uCiAgICAgICAgICAgIC8vIFRoaXMgc2hvdWxkIHN0b3AgYW4gYXR0YWNrZXIgdG8gcmVkdWNlIGV2aWRlbmNlIHRvIDAgYW5kIHN1YnNlcXVlbnRseSBidXkKICAgICAgICAgICAgLy8gdG9rZW5zIHF1aWNrbHkKICAgICAgICAgICAgaWYgKChsYXN0QnV5UHJpY2UgPiAwKSAmJiAoZm91bmRFdmlkZW5jZSA9PSAwKSl7CiAgICAgICAgICAgICAgICBidXlQcmljZV8gPSBsYXN0QnV5UHJpY2U7CiAgICAgICAgICAgICAgICBsYXN0QnV5UHJpY2UgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiBldmlkZW5jZSBpcyBub3QgZm91bmQgY29uc2VjdXRpdmVseSBpdCBpcyBkZWNyZWFzZWQKICAgICAgICAgICAgLy8gYnV5aW5nIGNhbiBvbmx5IGJlIGVuYWJsZWQgYWdhaW4gaWYgZm91bmQgZXZpZGVuY2UgaXMgMCBmb3IgYSBjb25zZWN1dGl2ZSBpbnRlcnZhbAogICAgICAgICAgICBpZiAoZm91bmRFdmlkZW5jZSA+IDApIGZvdW5kRXZpZGVuY2UgLT0gMTsKICAgICAgICB9CiAgICB9Cgp9CgoKLy8gRHVtbXkgTGl0dGxlU2lzdGVyQ29udHJhY3QgdGhhdCBqdXN0IHNwZWNpZmllcyB0aGUgbmFtZXMKLy8gSGFzIGEgVHJ1bXBJbXBlYWNobWVudFRva2VuIGJpZyBzaXN0ZXIKY29udHJhY3QgVHJ1bXBGdWxsVGVybVRva2VuIGlzIFByaWNlSW5jcmVhc2luZ0xpdHRsZVNpc3RlclRva2VuewoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlRGVCI7CgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlRydW1wIEZ1bGwgVGVybSBUb2tlbiI7Cgp9CgoKLy9JbXBsZW1lbnRzIHRoZSBPcmFjbGl6ZSBVc2FnZSB0byBxdWVyeSBmb3IgdGhlIFByZXNpZGVudCBvZiB0aGUgVW5pdGVkIFN0YXRlcwpjb250cmFjdCBUcnVtcE9yYWNsZSBpcyB1c2luZ09yYWNsaXplewoKICAgIC8vIEtlZXBzIHF1ZXJ5IGlkcyB0byBtYWtlIHN1cmUgdGhlIGNhbGxiYWNrIGlzIHZhbGlkCiAgICBtYXBwaW5nKGJ5dGVzMzI9PmJvb2wpIHZhbGlkSWRzOwoKICAgIC8vIGxvZ3MgYW4gb3JhY2xpemUgcXVlcnkKICAgIGV2ZW50IG5ld09yYWNsaXplUXVlcnkoc3RyaW5nIGRlc2NyaXB0aW9uKTsKCiAgICAvLyBsb2dzIHRoZSBxdWVyeSByZXN1bHQKICAgIGV2ZW50IG5ld09yYWNsaXplUmVzdWx0KGJ5dGVzMzIgaWQsIHN0cmluZyByZXN1bHQpOwoKICAgIC8vIHF1ZXN0aW9uIGFza2VkIHRvIG9yYWNsZQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBxdWVzdGlvbiA9ICJQcmVzaWRlbnQgb2YgdGhlIFVuaXRlZCBTdGF0ZXMiOwoKICAgIC8vIHByaWNlIG9mIChsYXN0KSBPcmFjbGl6ZSBxdWVyeQogICAgdWludCBwdWJsaWMgb3JhY2xpemVQcmljZTsKCiAgICAvLyBjYWxsYmFjayBmdW5jdGlvbiB1c2VkIGJ5IG9yYWNsaXplIHRvIHByb3ZpZGUgdGhlIHJlc3VsdAogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgcmVzdWx0KSBwdWJsaWMgewogICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgcmVxdWVzdCBjb21lcyBmcm9tIG9yYWNsaXplCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG9yYWNsaXplX2NiQWRkcmVzcygpKTsKICAgICAgICAvLyBhbmQgbWF0Y2hlcyBhIHByZXZpb3VzIHF1ZXJ5CiAgICAgICAgcmVxdWlyZSh2YWxpZElkc1tfcXVlcnlJZF0pOwogICAgICAgIGRlbGV0ZSB2YWxpZElkc1tfcXVlcnlJZF07CiAgICAgICAgbmV3T3JhY2xpemVSZXN1bHQoX3F1ZXJ5SWQsIHJlc3VsdCk7CiAgICB9CgogICAgLy8gQ2FuIGJlIGNhbGxlZCBieSB1c2VycyBhbmQgdG9rZW4gaG9sZGVycyB0byBjaGVjayBpZiBUcnVtcCBpcyBzdGlsbCBwcmVzaWRlbnQKICAgIGZ1bmN0aW9uIHJlcXVlc3RFdmlkZW5jZSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBpZiAoZ2V0T3JhY2xpemVQcmljZSgpID4gbXNnLnZhbHVlKSB7CiAgICAgICAgICAgIC8vIG5vdGUgdGhhdCBvcmFjbGl6ZSBkZWR1Y3RzIHRoZSBxdWVyeSBjb3N0cyBmcm9tIHRoZSBjb250cmFjdCwgc28gdGhlCiAgICAgICAgICAgIC8vIHVzZXJzIHNob3VsZCBjb21wZW5zYXRlIGZvciB0aGF0IQogICAgICAgICAgICBuZXdPcmFjbGl6ZVF1ZXJ5KCJPcmFjbGl6ZSBxdWVyeSB3YXMgTk9UIHNlbnQsIHBsZWFzZSBhZGQgc29tZSBFVEggdG8gY292ZXIgZm9yIHRoZSBxdWVyeSBmZWUiKTsKICAgICAgICAgICAgLy8gc2VuZCBtb25leSBiYWNrIHRvIHVzZXIgYW5kIHJldmVydCB0cmFuc2FjdGlvbgogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPcmFjbGl6ZVF1ZXJ5KCJPcmFjbGl6ZSBxdWVyeSB3YXMgc2VudCwgc3RhbmRpbmcgYnkgZm9yIHRoZSBhbnN3ZXIuLi4iKTsKICAgICAgICAgICAgLy8gVEhFIE1PU1QgSU1QT1JUQU5UIFFVRVJZIQogICAgICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeSgiV29sZnJhbUFscGhhIiwgcXVlc3Rpb24pOwogICAgICAgICAgICAvLyBLZWVwIHRyYWNrIG9mIGlkIGZvciBjYWxsYmFjayBjaGVjawogICAgICAgICAgICB2YWxpZElkc1txdWVyeUlkXSA9IHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8vIHJldHVybnMgdGhlIHByaWNlIG9mIG9yYWNsZSBjYWxsIGluIHdlaQogICAgZnVuY3Rpb24gZ2V0T3JhY2xpemVQcmljZSgpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgb3JhY2xpemVQcmljZSA9IG9yYWNsaXplX2dldFByaWNlKCJXb2xmcmFtQWxwaGEiKTsKICAgICAgICByZXR1cm4gb3JhY2xpemVQcmljZTsKICAgIH0KCn0KCgovLyBUaGUgYmlnIHNpc3RlciBjb250cmFjdCBvZiBUcnVtcEZ1bGxUZXJtVG9rZW4KY29udHJhY3QgVHJ1bXBJbXBlYWNobWVudFRva2VuIGlzIFRydW1wT3JhY2xlLCBUaW1lZEV2aWRlbmNlVG9rZW4sIFN0cmluZ09wc3sKCiAgICAvLyAzIGxldHRlciBzeW1ib2wKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlRJVCI7CgogICAgLy8gTmFtZSBvZiB0b2tlbgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIlRydW1wIEltcGVhY2htZW50IFRva2VuIjsKCiAgICAvLyBMYXN0IFN0cmluZyByZXR1cm5lZCBieSBvcmFjbGUgcXVlcnkKICAgIHN0cmluZyBwdWJsaWMgbGFzdEV2aWRlbmNlOwoKICAgIC8vIGV4cGVjdGVkIGFuc3dlcgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBhbnN3ZXIgPSAiVHJ1bXAiOwoKICAgIGZ1bmN0aW9uIFRydW1wSW1wZWFjaG1lbnRUb2tlbigpCiAgICAgICAgICAgICBUaW1lZEV2aWRlbmNlVG9rZW4oMjAwMDAwMCAqIHVuaXQsIC8vIGFtb3VudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDY5IGZpbm5leSAvIHVuaXQsIC8vIGJ1eSBwcmljZSAwLjA2OSBFdGhlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQwLCAvLyB2aWcgPT4gMi41JQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDY2MDAgKiB1bml0LCAvL3RocmVzaG9sZCBhbW91bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMDAgc3phYm8gLyB1bml0LCAvLyBwcmljZSBpbmNyZWFzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDIgZGF5cywgLy9ldmlkZW5jZSBpbnRlcnZhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsIC8vIHJlcXVpcmVkIGV2aWRlbmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTYxMTAxNDQwMCwgLy8gZGF0ZSBzaXN0ZXIgd2lucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL29uZSBkYXkgYmVmb3JlIFRydW1wYHMgdGVybSBlbmRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMjIyIGRheXMsIC8vIGJ1eWluZyBob3Jpem9uIHdoZXJlIGJ1eWluZyB0b2tlbnMgaXMgYWxsb3dlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDcgeWVhcnMgLy9tYXhpbXVtIExpZmV0aW1lIGZyb20gZGVwbG95bWVudCBvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWZ0ZXIgd2hpY2ggY29udHJhY3QgY2FuIGJlIGRlc3Ryb3llZAogICAgICAgICAgICAgKXsKICAgICAgICAgICAgbGFzdEV2aWRlbmNlID0gIk4vQSI7CiAgICAgICAgICAgIC8vIGZvciB2ZXJ5IGZhc3QgY29uZmlybWF0aW9ucyBzZXQgdGhlIGdhcyBQcmljZSB0byAzMEdXZWkKICAgICAgICAgICAgb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UoMzAwMDAwMDAwMDApOwogICAgICAgIH0KCiAgICAvLyBjYWxsYmFjayB1c2VkIGJ5IG9yYWNsaXplCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyByZXN1bHQpIHB1YmxpY3sKICAgICAgICBib29sIGV2aWRlbmNlOwoKICAgICAgICBzdXBlci5fX2NhbGxiYWNrKF9xdWVyeUlkLCByZXN1bHQpOwogICAgICAgIHJlcXVpcmUoYnl0ZXMocmVzdWx0KS5sZW5ndGggPiAwKTsKICAgICAgICBsYXN0RXZpZGVuY2UgPSByZXN1bHQ7CiAgICAgICAgZXZpZGVuY2UgPSAhc3RyaW5nRW5kc1dpdGgocmVzdWx0LCBhbnN3ZXIpOwogICAgICAgIC8vIGFjY3VtdWxhdGVzIGV2aWRlbmNlIG92ZXIgdGltZSwgYWxzbyBjaGVja3MgZm9yIHN1ZmZpY2llbnQgaW50ZXJ2YWwgYmV0d2VlbgogICAgICAgIC8vIGV2aWRlbmNlIGdhdGhlcmluZ3MKICAgICAgICBfYWNjdW11bGF0ZUV2aWRlbmNlKGV2aWRlbmNlKTsKICAgIH0KCiAgICAvLyBjYW4gYmUgY2FsbGVkIGJ5IHVzZXIgdG8gcmVxdWVzdCBldmlkZW5jZSBmcm9tIG9yYWNsaXplCiAgICBmdW5jdGlvbiByZXF1ZXN0RXZpZGVuY2UoKSBwYXlhYmxlewogICAgICAgIC8vIGNoZWNrIGlmIGVub3VnaCB0aW1lIGhhcyBwYXN0IGJlZm9yZSBxdWVyeWluZyBvcmFjbGl6ZQogICAgICAgIHJlcXVpcmUobm93ID4gbGFzdEV2aWRlbmNlQ2hlY2sgKyBldmlkZW5jZUludGVydmFsKTsKICAgICAgICBzdXBlci5yZXF1ZXN0RXZpZGVuY2UoKTsKICAgIH0KCiAgICAvLyBXZSBhcyBvd25lcnMgY2FuIChvbmx5KSBpbmNyZWFzZSBvciBrZWVwIHRoZSBwcmljZSBpbiBjYXNlIHRoZXJlIGlzIGEgZ2FzIHByaWNlIHN1cmdlCiAgICAvLyB3aXRoaW4gdGhlIHJhbmdlIG9mIDMwIHRvIDMwMCBHV2VpLgogICAgLy8gVGhpcyBjYW5ub3QgZG8gYW55IGhhcm0gKHdlbGwgZXhjZXB0IG1ha2luZyB0aGUgY29uZmlybWF0aW9ucyBhIGJpdCBleHBlbnNpdmUpCiAgICAvLyBidXQgaXQgY2FuIGJlIGhlbHBmdWwgaW4gY2FzZSBvZiBzdXJnaW5nIHByaWNlcwogICAgZnVuY3Rpb24gc2V0T3JhY2xpemVHYXNQcmljZSh1aW50IGdhc1ByaWNlKXsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIC8vIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgb3JpZ2luYWwgZ2FzUHJpY2UgMzAgR1dlaQogICAgICAgIHJlcXVpcmUoZ2FzUHJpY2UgPj0gMzAwMDAwMDAwMDApOwogICAgICAgIC8vIGFuZCBsZXRzIGtlZXAgaXQgd2l0aGluIHJlYXNvbmFibGUgYm91bmRzIG1heGltdW0gaXMgMzAwIEdXZWksIGkuZS4gMTAgZm9sZAogICAgICAgIC8vIHRoaXMgc2hvdWxkIGJlIGEgcmVhc29uYWJsZSByYW5nZSwgZm9yIHJlYWN0aW5nIHRvIHByaWNlIHN1cmdlcyBhbmQKICAgICAgICAvLyBpbXBlYWNobWVudCB0b2tlbiBob2xkZXJzIG5vdCBmZWFyaW5nIHRvIHBheSBhIHRvbyBoaWdoIHByaWNlIGZvciBjb25maXJtYXRpb25zCiAgICAgICAgcmVxdWlyZShnYXNQcmljZSA8PSAzMDAwMDAwMDAwMDApOwogICAgICAgIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KCn0='.
	

]
