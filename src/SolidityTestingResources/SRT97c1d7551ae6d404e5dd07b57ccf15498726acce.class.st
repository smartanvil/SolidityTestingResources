Class {
	#name : #SRT97c1d7551ae6d404e5dd07b57ccf15498726acce,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT97c1d7551ae6d404e5dd07b57ccf15498726acce >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4gMC40LjE3OwoKCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSAmJiBjID49IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgoKLyoqCiogQHRpdGxlIE93bmFibGUKKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIAogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogICAgLyoqCiAgICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAgKiBhY2NvdW50LgogICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewkKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKfQoKY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgICBib29sIHB1YmxpYyBzdG9wcGVkOwoKICAgIG1vZGlmaWVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICAgICAgaWYgKHN0b3BwZWQpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUluRW1lcmdlbmN5IHsKICAgICAgICBpZiAoIXN0b3BwZWQpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIF87CiAgICB9CgogICAgLy8gQG5vdGljZSBDYWxsZWQgYnkgdGhlIG93bmVyIGluIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAgZnVuY3Rpb24gZW1lcmdlbmN5U3RvcCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgc3RvcHBlZCA9IHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2FsbGVkIGJ5IHRoZSBvd25lciB0byBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAgZnVuY3Rpb24gcmVsZWFzZSgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgICAgIHN0b3BwZWQgPSBmYWxzZTsKICAgIH0KfQoKCmNvbnRyYWN0IEVSQzIwIHsKICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KTsKCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wgb2spOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wgb2spOwoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyhib29sIG9rKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgoKLy8gQG5vdGljZSBNaWdyYXRpb24gQWdlbnQgaW50ZXJmYWNlCgpjb250cmFjdCBNaWdyYXRpb25BZ2VudCB7CiAgICBmdW5jdGlvbiBtaWdyYXRlRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgcHVibGljOwp9CgoKLy8gQG5vdGljZSAgV2hpdGVsaXN0IGludGVyZmFjZSB3aGljaCB3aWxsIGhvbGQgd2hpdGVsaXN0ZWQgdXNlcnMKY29udHJhY3QgV2hpdGVMaXN0IGlzIE93bmFibGUgewoKICAgIGZ1bmN0aW9uIGlzV2hpdGVMaXN0ZWQoYWRkcmVzcyBfdXNlcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsgICAgICAgIAp9CgovLyBAbm90aWNlIGNvbnRyYWN0IHRvIGNvbnRyb2wgdmVzdGluZyBzY2hlZHVsZSBmb3IgY29tcGFueSBhbmQgdGVhbSB0b2tlbnMKY29udHJhY3QgVmVzdGluZyBpcyBPd25hYmxlIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICB1aW50IHB1YmxpYyB0ZWFtVG9rZW5zSW5pdGlhbCA9IDJlMjU7ICAgICAgLy8gbWF4IHRva2VucyBhbW91bnQgZm9yIHRoZSB0ZWFtIDIwLDAwMCwwMDAKICAgIHVpbnQgcHVibGljIHRlYW1Ub2tlbnNDdXJyZW50ID0gMDsgICAgICAgICAvLyB0byBrZWVwIHJlY29yZCBvZiBkaXN0cmlidXRlZCB0b2tlbnMgc28gZmFyIHRvIHRoZSB0ZWFtCiAgICB1aW50IHB1YmxpYyBjb21wYW55VG9rZW5zSW5pdGlhbCA9IDE1ZTI0OyAgLy8gbWF4IHRva2VucyBhbW91bnQgZm9yIHRoZSBjb21wYW55IDE1LDAwMCwwMDAKICAgIHVpbnQgcHVibGljIGNvbXBhbnlUb2tlbnNDdXJyZW50ID0gMDsgICAgICAvLyB0byBrZWVwIHJlY29yZCBvZiBkaXN0cmlidXRlZCB0b2tlbnMgc28gZmFyIHRvIHRoZSBjb21wYW55CiAgICBUb2tlbiBwdWJsaWMgdG9rZW47ICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG9rZW4gY29udHJhY3QKICAgIHVpbnQgcHVibGljIGRhdGVJQ09FbmRlZDsgICAgICAgICAgICAgICAgICAvLyBkYXRlIHdoZW4gSUNPIGVuZGVkIHVwZGF0ZWQgZnJvbSB0aGUgZmluYWxpemVTYWxlKCkgZnVuY3Rpb24KICAgIHVpbnQgcHVibGljIGRhdGVQcm9kdWN0Q29tcGxldGVkOyAgICAgICAgICAvLyBkYXRlIHdoZW4gcHJvZHVjdCBoYXMgYmVlbiBjb21wbGV0ZWQKCgogICAgZXZlbnQgTG9nVGVhbVRva2Vuc1RyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCByZWNlaXBpZW50LCB1aW50IGFtb3VvbnRPZlRva2Vucyk7CiAgICBldmVudCBMb2dDb21wYW55VG9rZW5zVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHJlY2VpcGllbnQsIHVpbnQgYW1vdW9udE9mVG9rZW5zKTsKCgogICAgLy8gQG5vdGljZSBzZXQgdGhlIGhhbmRsZSBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgIC8vIEBwYXJhbSBfdG9rZW4gIHtUb2tlbn0gYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgIC8vIEByZXR1cm4gIHtib29sfSB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHNldFRva2VuKFRva2VuIF90b2tlbikgcHVibGljIG9ubHlPd25lcigpIHJldHVybnMoYm9vbCkgewogICAgICAgIHJlcXVpcmUgKHRva2VuID09IGFkZHJlc3MoMCkpOyAgCiAgICAgICAgdG9rZW4gPSBfdG9rZW47CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQG5vdGljZSBzZXQgdGhlIHByb2R1Y3QgY29tcGxldGlvbiBkYXRlIGZvciByZWxlYXNlIG9mIGRldiB0b2tlbnMKICAgIGZ1bmN0aW9uIHNldFByb2R1Y3RDb21wbGV0aW9uRGF0ZSgpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgICAgICBkYXRlUHJvZHVjdENvbXBsZXRlZCA9IG5vdzsKICAgIH0KCiAgICAvLyBAbm90aWNlICB0byByZWxlYXNlIHRva2VucyBvZiB0aGUgdGVhbSBhY2NvcmRpbmcgdG8gdmVzdGluZyBzY2hlZHVsZQogICAgLy8gQHBhcmFtIF9yZWNpcGllbnQge2FkZHJlc3N9IG9mIHRoZSByZWNpcGllbnQgb2YgdG9rZW4gdHJhbnNmZXIKICAgIC8vIEBwYXJhbSBfdG9rZW5zVG9UcmFuc2ZlciB7dWludH0gYW1vdW50IG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgZnVuY3Rpb24gdHJhbnNmZXJUZWFtVG9rZW5zKGFkZHJlc3MgX3JlY2lwaWVudCwgdWludCBfdG9rZW5zVG9UcmFuc2ZlcikgZXh0ZXJuYWwgb25seU93bmVyKCkgewoKICAgICAgICByZXF1aXJlKF9yZWNpcGllbnQgIT0gMCk7ICAgICAgIAogICAgICAgIHJlcXVpcmUobm93ID49IDE1MzMwODE2MDApOyAgLy8gYmVmb3JlIEF1ZyAxLCAyMDE4IDAwOjAwIEdNVCBkb24ndCBhbGxvdyBvbiBkaXN0cmlidXRpb24gdG9rZW5zIHRvIHRoZSB0ZWFtLgoKICAgICAgICByZXF1aXJlKGRhdGVQcm9kdWN0Q29tcGxldGVkID4gMCk7CiAgICAgICAgaWYgKG5vdyA8IGRhdGVQcm9kdWN0Q29tcGxldGVkICsgMSB5ZWFycykgICAgICAgICAgICAvLyBmaXJzdCB5ZWFyIGFmdGVyIHByb2R1Y3QgcmVsZWFzZQogICAgICAgICAgICByZXF1aXJlKHRlYW1Ub2tlbnNDdXJyZW50LmFkZChfdG9rZW5zVG9UcmFuc2ZlcikgPD0gKHRlYW1Ub2tlbnNJbml0aWFsICogMzApIC8gMTAwKTsKICAgICAgICBlbHNlIGlmIChub3cgPCBkYXRlUHJvZHVjdENvbXBsZXRlZCArIDIgeWVhcnMpICAgICAgIC8vIHNlY29uZCB5ZWFyIGFmdGVyIHByb2R1Y3QgcmVsZWFzZQogICAgICAgICAgICByZXF1aXJlKHRlYW1Ub2tlbnNDdXJyZW50LmFkZChfdG9rZW5zVG9UcmFuc2ZlcikgPD0gKHRlYW1Ub2tlbnNJbml0aWFsICogNjApIC8gMTAwKTsKICAgICAgICBlbHNlIGlmIChub3cgPCBkYXRlUHJvZHVjdENvbXBsZXRlZCArIDMgeWVhcnMpICAgICAgIC8vIHRoaXJkIHllYXIgYWZ0ZXIgcHJvZHVjdCByZWxlYXNlCiAgICAgICAgICAgIHJlcXVpcmUodGVhbVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKSA8PSAodGVhbVRva2Vuc0luaXRpYWwgKiA4MCkgLyAxMDApOwogICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZm91cnRoIHllYXIgYWZ0ZXIgcHJvZHVjdCByZWxlYXNlCiAgICAgICAgICAgIHJlcXVpcmUodGVhbVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKSA8PSB0ZWFtVG9rZW5zSW5pdGlhbCk7CgogICAgICAgIHRlYW1Ub2tlbnNDdXJyZW50ID0gdGVhbVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKTsgIC8vIHVwZGF0ZSByZWxlYXNlZCB0b2tlbiBhbW91bnQKICAgICAgICAKICAgICAgICBpZiAoIXRva2VuLnRyYW5zZmVyKF9yZWNpcGllbnQsIF90b2tlbnNUb1RyYW5zZmVyKSkKICAgICAgICAgICAgICAgIHJldmVydCgpOwoKICAgICAgICBMb2dUZWFtVG9rZW5zVHJhbnNmZXJyZWQoX3JlY2lwaWVudCwgX3Rva2Vuc1RvVHJhbnNmZXIpOwogICAgfQoKICAgIC8vIEBub3RpY2UgIHRvIHJlbGVhc2UgdG9rZW5zIG9mIHRoZSBjb21wYW55IGFjY29yZGluZyB0byB2ZXN0aW5nIHNjaGVkdWxlCiAgICAvLyBAcGFyYW0gX3JlY2lwaWVudCB7YWRkcmVzc30gb2YgdGhlIHJlY2lwaWVudCBvZiB0b2tlbiB0cmFuc2ZlcgogICAgLy8gQHBhcmFtIF90b2tlbnNUb1RyYW5zZmVyIHt1aW50fSBhbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICBmdW5jdGlvbiB0cmFuc2ZlckNvbXBhbnlUb2tlbnMoYWRkcmVzcyBfcmVjaXBpZW50LCB1aW50IF90b2tlbnNUb1RyYW5zZmVyKSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CgogICAgICAgIHJlcXVpcmUoX3JlY2lwaWVudCAhPSAwKTsKICAgICAgICByZXF1aXJlKGRhdGVJQ09FbmRlZCA+IDApOyAgICAgICAKCiAgICAgICAgaWYgKG5vdyA8IGRhdGVJQ09FbmRlZCArIDEgeWVhcnMpICAgLy8gZmlyc3QgeWVhcgogICAgICAgICAgICByZXF1aXJlKGNvbXBhbnlUb2tlbnNDdXJyZW50LmFkZChfdG9rZW5zVG9UcmFuc2ZlcikgPD0gKGNvbXBhbnlUb2tlbnNJbml0aWFsICogNTApIC8gMTAwKTsKICAgICAgICBlbHNlIGlmIChub3cgPCBkYXRlSUNPRW5kZWQgKyAyIHllYXJzKSAvLyBzZWNvbmQgeWVhcgogICAgICAgICAgICByZXF1aXJlKGNvbXBhbnlUb2tlbnNDdXJyZW50LmFkZChfdG9rZW5zVG9UcmFuc2ZlcikgPD0gKGNvbXBhbnlUb2tlbnNJbml0aWFsICogNzUpIC8gMTAwKTsKICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcmQgeWVhciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJlcXVpcmUoY29tcGFueVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKSA8PSBjb21wYW55VG9rZW5zSW5pdGlhbCk7CgogICAgICAgIGNvbXBhbnlUb2tlbnNDdXJyZW50ID0gY29tcGFueVRva2Vuc0N1cnJlbnQuYWRkKF90b2tlbnNUb1RyYW5zZmVyKTsgIC8vIHVwZGF0ZSByZWxlYXNlZCB0b2tlbiBhbW91bnQKCiAgICAgICAgaWYgKCF0b2tlbi50cmFuc2ZlcihfcmVjaXBpZW50LCBfdG9rZW5zVG9UcmFuc2ZlcikpCiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBMb2dDb21wYW55VG9rZW5zVHJhbnNmZXJyZWQoX3JlY2lwaWVudCwgX3Rva2Vuc1RvVHJhbnNmZXIpOwogICAgfQp9CgovLyBQcmVzYWxlIFNtYXJ0IENvbnRyYWN0Ci8vIFRoaXMgc21hcnQgY29udHJhY3QgY29sbGVjdHMgRVRIIGFuZCBpbiByZXR1cm4gc2VuZHMgdG9rZW5zIHRvIHRoZSBiYWNrZXJzLgpjb250cmFjdCBDcm93ZFNhbGUgaXMgIFBhdXNhYmxlLCBWZXN0aW5nIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBzdHJ1Y3QgQmFja2VyIHsKICAgICAgICB1aW50IHdlaVJlY2VpdmVkT25lOyAvLyBhbW91bnQgb2YgRVRIIGNvbnRyaWJ1dGVkIGR1cmluZyBmaXJzdCBwcmVzYWxlCiAgICAgICAgdWludCB3ZWlSZWNlaXZlZFR3bzsgIC8vIGFtb3VudCBvZiBFVEggY29udHJpYnV0ZWQgZHVyaW5nIHNlY29uZCBwcmVzYWxlCiAgICAgICAgdWludCB3ZWlSZWNlaXZlZE1haW47IC8vIGFtb3VudCBvZiBFVEggY29udHJpYnV0ZWQgZHVyaW5nIG1haW4gc2FsZQogICAgICAgIHVpbnQgdG9rZW5zU2VudDsgLy8gYW1vdW50IG9mIHRva2VucyAgc2VudAogICAgICAgIGJvb2wgY2xhaW1lZDsKICAgICAgICBib29sIHJlZnVuZGVkOwogICAgfQoKICAgIGFkZHJlc3MgcHVibGljIG11bHRpc2lnOyAvLyBNdWx0aXNpZyBjb250cmFjdCB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgRVRICiAgICB1aW50IHB1YmxpYyBldGhSZWNlaXZlZFByZXNhbGVPbmU7IC8vIEFtb3VudCBvZiBFVEggcmVjZWl2ZWQgaW4gcHJlc2FsZSBvbmUKICAgIHVpbnQgcHVibGljIGV0aFJlY2VpdmVkUHJlc2FsZVR3bzsgLy8gQW1vdW50IG9mIEVUSCByZWNlaXZlZCBpbiBwcmVzYWxlIHR3bwogICAgdWludCBwdWJsaWMgZXRoUmVjZWl2ZU1haW5TYWxlOyAvLyBBbW91bnQgb2YgRVRIIHJlY2VpdmVkIGluIG1haW4gc2FsZQogICAgdWludCBwdWJsaWMgdG90YWxUb2tlbnNTb2xkOyAvLyBOdW1iZXIgb2YgdG9rZW5zIHNvbGQgdG8gY29udHJpYnV0b3JzIGluIGFsbCBjYW1wYWlnbnMKICAgIHVpbnQgcHVibGljIHN0YXJ0QmxvY2s7IC8vIFByZXNhbGUgc3RhcnQgYmxvY2sKICAgIHVpbnQgcHVibGljIGVuZEJsb2NrOyAvLyBQcmVzYWxlIGVuZCBibG9jawoKICAgIHVpbnQgcHVibGljIG1pbkludmVzdG1lbnQ7IC8vIE1pbmltdW0gYW1vdW50IHRvIGludmVzdCAgICAKICAgIFdoaXRlTGlzdCBwdWJsaWMgd2hpdGVMaXN0OyAvLyB3aGl0ZWxpc3QgY29udHJhY3QKICAgIHVpbnQgcHVibGljIGRvbGxhclBlckV0aGVyUmF0aW87IC8vIGRvbGxhciB0byBldGhlciByYXRpbyBzZXQgYXQgdGhlIGJlZ2lubmluZyBvZiBtYWluIHNhbGUKICAgIHVpbnQgcHVibGljIHJldHVyblBlcmNlbnRhZ2U7ICAvLyBwZXJjZW50YWdlIHRvIGJlIHJldHVybmVkIGZyb20gZmlyc3QgcHJlc2FsZSBpbiBjYXNlIGNhbXBhaWduIGlzIGNhbmNlbGxlZAogICAgU3RlcCBwdWJsaWMgY3VycmVudFN0ZXA7ICAvLyB0byBtb3ZlIHRocm91Z2ggY2FtcGFpZ25zIGFuZCBzZXQgZGVmYXVsdCB2YWx1ZXMKICAgIHVpbnQgcHVibGljIG1pbkNhcFRva2VuczsgIC8vIG1pbmltdW0gYW1vdW50IG9mIHRva2VucyB0byByYWlzZSBmb3IgY2FtcGFpZ24gdG8gYmUgc3VjY2Vzc2Z1bAoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBCYWNrZXIpIHB1YmxpYyBiYWNrZXJzOyAvL2JhY2tlciBsaXN0CiAgICBhZGRyZXNzW10gcHVibGljIGJhY2tlcnNJbmRleDsgIC8vIHRvIGJlIGFibGUgdG8gaXRlcmF0ZSB0aHJvdWdoIGJhY2tlciBsaXN0CiAgICB1aW50IHB1YmxpYyBtYXhDYXBFdGg7ICAvLyBtYXggY2FwIGV0aAogICAgdWludCBwdWJsaWMgbWF4Q2FwVG9rZW5zOyAvLyBtYXggY2FwIHRva2VucwogICAgdWludCBwdWJsaWMgY2xhaW1Db3VudDsgIC8vIG51bWJlciBvZiBjb250cmlidXRvcnMgY2xhaW1pbmcgdG9rZW5zCiAgICB1aW50IHB1YmxpYyByZWZ1bmRDb3VudDsgIC8vIG51bWJlciBvZiBjb250cmlidXRvcnMgcmVjZWl2aW5nIHJlZnVuZHMKICAgIHVpbnQgcHVibGljIHRvdGFsQ2xhaW1lZDsgIC8vIHRvdGFsIG9mIHRva2VucyBjbGFpbWVkCiAgICB1aW50IHB1YmxpYyB0b3RhbFJlZnVuZGVkOyAgLy8gdG90YWwgb2YgdG9rZW5zIHJlZnVuZGVkCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGNsYWltZWQ7IC8vIHRva2VucyBjbGFpbWVkIGJ5IGNvbnRyaWJ1dG9ycwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyByZWZ1bmRlZDsgLy8gdG9rZW5zIHJlZnVuZGVkIHRvIGNvbnRyaWJ1dG9ycwoKCgogICAgLy8gQG5vdGljZSB0byBzZXQgYW5kIGRldGVybWluZSBzdGVwcyBvZiBjcm93ZHNhbGUKICAgIGVudW0gU3RlcCB7CiAgICAgICAgRnVuZGluZ1ByZXNhbGVPbmUsICAvLyBwcmVzYWxlIDEgbW9kZQogICAgICAgIEZ1bmRpbmdQcmVzYWxlVHdvLCAgLy8gcHJlc2FsZSAyIG1vZGUKICAgICAgICBGdW5kaW5nTWFpblNhbGUsICAgIC8vIG1haW4gSUNPCiAgICAgICAgUmVmdW5kaW5nICAgICAgICAgICAvLyByZWZ1bmRpbmcKICAgIH0KCgogICAgLy8gQG5vdGljZSB0byB2ZXJpZnkgaWYgYWN0aW9uIGlzIG5vdCBwZXJmb3JtZWQgb3V0IG9mIHRoZSBjYW1wYWlnbiByYW5nZQogICAgbW9kaWZpZXIgcmVzcGVjdFRpbWVGcmFtZSgpIHsKICAgICAgICBpZiAoKGJsb2NrLm51bWJlciA8IHN0YXJ0QmxvY2spIHx8IChibG9jay5udW1iZXIgPiBlbmRCbG9jaykpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBSZWNlaXZlZEVUSChhZGRyZXNzIGluZGV4ZWQgYmFja2VyLCBTdGVwIGluZGV4ZWQgc3RlcCwgdWludCBhbW91bnQpOwogICAgZXZlbnQgVG9rZW5zQ2xhaW1lZChhZGRyZXNzIGluZGV4ZWQgYmFja2VyLCB1aW50IGNvdW50KTsKICAgIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiYWNrZXIsIHVpbnQgYW1vdW50KTsKCgoKICAgIC8vIENyb3dkRnVuZGluZyAgIHtjb25zdHJ1Y3Rvcn0KICAgIC8vIEBub3RpY2UgZmlyZWQgd2hlbiBjb250cmFjdCBpcyBjcmF0ZWQuIEluaXRpYWxpemVzIGFsbCBuZWVkZWQgdmFyaWFibGVzIGZvciBwcmVzYWxlIDEuCiAgICBmdW5jdGlvbiBDcm93ZFNhbGUoV2hpdGVMaXN0IF93aGl0ZUxpc3QsIGFkZHJlc3MgX211bHRpc2lnKSBwdWJsaWMgewoKICAgICAgICByZXF1aXJlKF93aGl0ZUxpc3QgIT0gYWRkcmVzcygweDApKTsKICAgICAgICBtdWx0aXNpZyA9IF9tdWx0aXNpZzsKICAgICAgICBtaW5JbnZlc3RtZW50ID0gMTAgZXRoZXI7CiAgICAgICAgbWF4Q2FwRXRoID0gOTAwMCBldGhlcjsKICAgICAgICBzdGFydEJsb2NrID0gMDsgLy8gU3RhcnRpbmcgYmxvY2sgb2YgdGhlIGNhbXBhaWduCiAgICAgICAgZW5kQmxvY2sgPSAwOyAvLyBFbmRpbmcgYmxvY2sgb2YgdGhlIGNhbXBhaWduCiAgICAgICAgY3VycmVudFN0ZXAgPSBTdGVwLkZ1bmRpbmdQcmVzYWxlT25lOyAgLy8gaW5pdGlhbGl6ZSB0byBmaXJzdCBwcmVzYWxlCiAgICAgICAgd2hpdGVMaXN0ID0gX3doaXRlTGlzdDsgLy8gYWRkcmVzcyBvZiB3aGl0ZSBsaXN0IGNvbnRyYWN0CiAgICAgICAgbWluQ2FwVG9rZW5zID0gNi41ZTI0OyAgLy8gMTAlIG9mIG1heENhcFRva2VucwogICAgfQoKCiAgICAvLyBAbm90aWNlIHJldHVybiBudW1iZXIgb2YgIGNvbnRyaWJ1dG9ycyBmb3IgYWxsIGNhbXBhaWducwogICAgLy8gQHJldHVybiB7dWludH0gbnVtYmVyIG9mIGNvbnRyaWJ1dG9ycyBpbiBlYWNoIGNhbXBhaWduIGFuZCB0b3RhbCBudW1iZXIKICAgIGZ1bmN0aW9uIG51bWJlck9mQmFja2VycygpIHB1YmxpYyB2aWV3IHJldHVybnModWludCwgdWludCwgdWludCwgdWludCkgewoKICAgICAgICB1aW50IG51bU9mQmFja2Vyc09uZTsKICAgICAgICB1aW50IG51bU9mQmFja2Vyc1R3bzsKICAgICAgICB1aW50IG51bU9mQmFja2Vyc01haW47CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGJhY2tlcnNJbmRleC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBCYWNrZXIgc3RvcmFnZSBiYWNrZXIgPSBiYWNrZXJzW2JhY2tlcnNJbmRleFtpXV07CiAgICAgICAgICAgIGlmIChiYWNrZXIud2VpUmVjZWl2ZWRPbmUgPiAwKQogICAgICAgICAgICAgICAgbnVtT2ZCYWNrZXJzT25lICsrOwogICAgICAgICAgICBpZiAoYmFja2VyLndlaVJlY2VpdmVkVHdvID4gMCkKICAgICAgICAgICAgICAgIG51bU9mQmFja2Vyc1R3byArKzsKICAgICAgICAgICAgaWYgKGJhY2tlci53ZWlSZWNlaXZlZE1haW4gPiAwKQogICAgICAgICAgICAgICAgbnVtT2ZCYWNrZXJzTWFpbiArKzsKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiAoIG51bU9mQmFja2Vyc09uZSwgbnVtT2ZCYWNrZXJzVHdvLCBudW1PZkJhY2tlcnNNYWluLCBiYWNrZXJzSW5kZXgubGVuZ3RoKTsKICAgIH0KCgoKICAgIC8vIEBub3RpY2UgYWR2YW5jZXMgdGhlIHN0ZXAgb2YgY2FtcGFpZ24gdG8gcHJlc2FsZSAyCiAgICAvLyBjb250cmFjdCBpcyBkZXBsb3llZCBpbiBwcmVzYWxlIDEgbW9kZQogICAgZnVuY3Rpb24gc2V0UHJlc2FsZVR3bygpIHB1YmxpYyBvbmx5T3duZXIoKSB7CiAgICAgICAgY3VycmVudFN0ZXAgPSBTdGVwLkZ1bmRpbmdQcmVzYWxlVHdvOwogICAgICAgIG1heENhcEV0aCA9IDYwMDAwIGV0aGVyOwogICAgICAgIG1pbkludmVzdG1lbnQgPSA1IGV0aGVyOwogICAgfQoKICAgIC8vIEBub3RpY2UgYWR2YW5jZXMgc3RlcCBvZiBjYW1wYWlnbiB0byBtYWluIHNhbGUKICAgIC8vIEBwYXJhbSBfcmF0aW8gICAtIGl0IHdpbGwgYmUgYW1vdW50IG9mIGRvbGxhcnMgZm9yIG9uZSBldGhlciB3aXRoIHR3byBkZWNpbWFscy4KICAgIC8vIHR3byBkZWNpbWFscyB3aWxsIGJlIHBhc3NlZCBhcyBuZXh0IHNldHMgb2YgZGlnaXRzLiBlZy4gJDMwMC4yNSB3aWxsIGJlIHBhc3NlZCBhcyAzMDAyNQogICAgZnVuY3Rpb24gc2V0TWFpblNhbGUodWludCBfcmF0aW8pIHB1YmxpYyBvbmx5T3duZXIoKSB7CgogICAgICAgIHJlcXVpcmUoX3JhdGlvID4gMCk7CiAgICAgICAgY3VycmVudFN0ZXAgPSBTdGVwLkZ1bmRpbmdNYWluU2FsZTsKICAgICAgICBkb2xsYXJQZXJFdGhlclJhdGlvID0gX3JhdGlvOwogICAgICAgIG1heENhcFRva2VucyA9IDY1ZTI0OwogICAgICAgIG1pbkludmVzdG1lbnQgPSAxIGV0aGVyIC8gNTsgIC8vIDAuMiBldGgKICAgICAgICB0b3RhbFRva2Vuc1NvbGQgPSAoZG9sbGFyUGVyRXRoZXJSYXRpbyAqIGV0aFJlY2VpdmVkUHJlc2FsZU9uZSkgLyA0ODsgIC8vIGRldGVybWluZSBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbmQgZnJvbSBmaXJzdCBwcmVzYWxlCiAgICAgICAgdG90YWxUb2tlbnNTb2xkICs9IChkb2xsYXJQZXJFdGhlclJhdGlvICogZXRoUmVjZWl2ZWRQcmVzYWxlVHdvKSAvIDU4OyAgLy8gZGV0ZXJtaW5lIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZCBmcm9tIHNlY29uZCBwcmVzYWxlIGFuZCB0b3RhbCBpdC4KICAgIH0KCgogICAgLy8gQG5vdGljZSB0byBwb3B1bGF0ZSB3ZWJzaXRlIHdpdGggc3RhdHVzIG9mIHRoZSBzYWxlCiAgICBmdW5jdGlvbiByZXR1cm5XZWJzaXRlRGF0YSgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCAgYm9vbCkgewoKICAgICAgICByZXR1cm4gKHN0YXJ0QmxvY2ssIGVuZEJsb2NrLCBiYWNrZXJzSW5kZXgubGVuZ3RoLCBldGhSZWNlaXZlZFByZXNhbGVPbmUsIGV0aFJlY2VpdmVkUHJlc2FsZVR3bywgZXRoUmVjZWl2ZU1haW5TYWxlLCBtYXhDYXBUb2tlbnMsICAgbWluSW52ZXN0bWVudCwgIHN0b3BwZWQpOwogICAgfQoKCiAgICAvLyB7ZmFsbGJhY2sgZnVuY3Rpb259CiAgICAvLyBAbm90aWNlIEl0IHdpbGwgY2FsbCBpbnRlcm5hbCBmdW5jdGlvbiB3aGljaCBoYW5kbGVzIGFsbG9jYXRpb24gb2YgRXRoZXIgYW5kIGNhbGN1bGF0ZXMgdG9rZW5zLgogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIGNvbnRyaWJ1dGUobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8gQG5vdGljZSBpbiBjYXNlIHJlZnVuZHMgYXJlIG5lZWRlZCwgbW9uZXkgY2FuIGJlIHJldHVybmVkIHRvIHRoZSBjb250cmFjdAogICAgLy8gQHBhcmFtIF9yZXR1cm5QZXJjZW50YWdlIHt1aW50fSBwZXJjZW50YWdlIG9mIHJldHVybiBpbiByZXNwZWN0IHRvIGZpcnN0IHByZXNhbGUuIGUuZyA3NSUgd291bGQgYmUgcGFzc2VkIGFzIDc1CiAgICBmdW5jdGlvbiBmdW5kQ29udHJhY3QodWludCBfcmV0dXJuUGVyY2VudGFnZSkgZXh0ZXJuYWwgcGF5YWJsZSBvbmx5T3duZXIoKSB7CgogICAgICAgIHJlcXVpcmUoX3JldHVyblBlcmNlbnRhZ2UgPiAwKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAoZXRoUmVjZWl2ZWRQcmVzYWxlT25lLm11bChfcmV0dXJuUGVyY2VudGFnZSkgLyAxMDApICsgZXRoUmVjZWl2ZWRQcmVzYWxlVHdvICsgZXRoUmVjZWl2ZU1haW5TYWxlKTsKICAgICAgICByZXR1cm5QZXJjZW50YWdlID0gX3JldHVyblBlcmNlbnRhZ2U7CiAgICAgICAgY3VycmVudFN0ZXAgPSBTdGVwLlJlZnVuZGluZzsKICAgIH0KCiAgICAvLyBAbm90aWNlIEl0IHdpbGwgYmUgY2FsbGVkIGJ5IG93bmVyIHRvIHN0YXJ0IHRoZSBzYWxlCiAgICAvLyBibG9jayBudW1iZXJzIHdpbGwgYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiBjdXJyZW50IGJsb2NrIHRpbWUgYXZlcmFnZS4gICAgCiAgICBmdW5jdGlvbiBzdGFydCgpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgICAgICBzdGFydEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIGVuZEJsb2NrID0gc3RhcnRCbG9jayArIDM4MzkwNDsgLy8gNC4zKjYwKjI0KjYyIGRheXMKICAgIH0KCiAgICAvLyBAbm90aWNlIER1ZSB0byBjaGFuZ2luZyBhdmVyYWdlIG9mIGJsb2NrIHRpbWUKICAgIC8vIHRoaXMgZnVuY3Rpb24gd2lsbCBhbGxvdyBvbiBhZGp1c3RpbmcgZHVyYXRpb24gb2YgY2FtcGFpZ24gY2xvc2VyIHRvIHRoZSBlbmQKICAgIC8vIGFsbG93IGFkanVzdGluZyBjYW1wYWlnbiBsZW5ndGggdG8gNzAgZGF5cywgZXF1aXZhbGVudCBvZiA0MzM0NDAgYmxvY2tzIGF0IDQuMyBibG9ja3MgcGVyIG1pbnV0ZQogICAgLy8gQHBhcmFtIF9ibG9jayAgbnVtYmVyIG9mIGJsb2NrcyByZXByZXNlbnRpbmcgZHVyYXRpb24KICAgIGZ1bmN0aW9uIGFkanVzdER1cmF0aW9uKHVpbnQgX2Jsb2NrKSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CgogICAgICAgIHJlcXVpcmUoX2Jsb2NrIDw9IDQzMzQ0MCk7ICAvLyA0LjMmIzIxNTs2MCYjMjE1OzI0JiMyMTU7NzAgZGF5cyAKICAgICAgICByZXF1aXJlKF9ibG9jayA+IGJsb2NrLm51bWJlci5zdWIoc3RhcnRCbG9jaykpOyAvLyBlbnN1cmUgdGhhdCBlbmRCbG9jayBpcyBub3Qgc2V0IGluIHRoZSBwYXN0CiAgICAgICAgZW5kQmxvY2sgPSBzdGFydEJsb2NrLmFkZChfYmxvY2spOwogICAgfQoKCiAgICAvLyBAbm90aWNlIEl0IHdpbGwgYmUgY2FsbGVkIGJ5IGZhbGxiYWNrIGZ1bmN0aW9uIHdoZW5ldmVyIGV0aGVyIGlzIHNlbnQgdG8gaXQKICAgIC8vIEBwYXJhbSAgX2NvbnRyaWJ1dG9yIHthZGRyZXNzfSBhZGRyZXNzIG9mIGNvbnRyaWJ1dG9yCiAgICAvLyBAcmV0dXJuIHJlcyB7Ym9vbH0gdHJ1ZSBpZiB0cmFuc2FjdGlvbiB3YXMgc3VjY2Vzc2Z1bAoKICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGUoYWRkcmVzcyBfY29udHJpYnV0b3IpIGludGVybmFsIHN0b3BJbkVtZXJnZW5jeSByZXNwZWN0VGltZUZyYW1lIHJldHVybnMoYm9vbCByZXMpIHsKCgogICAgICAgIHJlcXVpcmUod2hpdGVMaXN0LmlzV2hpdGVMaXN0ZWQoX2NvbnRyaWJ1dG9yKSk7ICAvLyBlbnN1cmUgdGhhdCB1c2VyIGlzIHdoaXRlbGlzdGVkCiAgICAgICAgQmFja2VyIHN0b3JhZ2UgYmFja2VyID0gYmFja2Vyc1tfY29udHJpYnV0b3JdOwogICAgICAgIHJlcXVpcmUgKG1zZy52YWx1ZSA+PSBtaW5JbnZlc3RtZW50KTsgIC8vIGVuc3VyZSB0aGF0IG1pbiBjb250cmlidXRpb25zIGFtb3VudCBpcyBtZXQKCiAgICAgICAgaWYgKGJhY2tlci53ZWlSZWNlaXZlZE9uZSA9PSAwICYmIGJhY2tlci53ZWlSZWNlaXZlZFR3byA9PSAwICYmIGJhY2tlci53ZWlSZWNlaXZlZE1haW4gPT0gMCkKICAgICAgICAgICAgYmFja2Vyc0luZGV4LnB1c2goX2NvbnRyaWJ1dG9yKTsKCiAgICAgICAgaWYgKGN1cnJlbnRTdGVwID09IFN0ZXAuRnVuZGluZ1ByZXNhbGVPbmUpIHsgICAgICAgICAgCiAgICAgICAgICAgIGJhY2tlci53ZWlSZWNlaXZlZE9uZSA9IGJhY2tlci53ZWlSZWNlaXZlZE9uZS5hZGQobXNnLnZhbHVlKTsKICAgICAgICAgICAgZXRoUmVjZWl2ZWRQcmVzYWxlT25lID0gZXRoUmVjZWl2ZWRQcmVzYWxlT25lLmFkZChtc2cudmFsdWUpOyAvLyBVcGRhdGUgdGhlIHRvdGFsIEV0aGVyIHJlY2VpdmVkIGluIHByZXNhbGUgMQogICAgICAgICAgICByZXF1aXJlKGV0aFJlY2VpdmVkUHJlc2FsZU9uZSA8PSBtYXhDYXBFdGgpOyAgLy8gZW5zdXJlIHRoYXQgbWF4IGNhcCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgICAgICAgfWVsc2UgaWYgKGN1cnJlbnRTdGVwID09IFN0ZXAuRnVuZGluZ1ByZXNhbGVUd28pIHsgICAgICAgICAgIAogICAgICAgICAgICBiYWNrZXIud2VpUmVjZWl2ZWRUd28gPSBiYWNrZXIud2VpUmVjZWl2ZWRUd28uYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIGV0aFJlY2VpdmVkUHJlc2FsZVR3byA9IGV0aFJlY2VpdmVkUHJlc2FsZVR3by5hZGQobXNnLnZhbHVlKTsgIC8vIFVwZGF0ZSB0aGUgdG90YWwgRXRoZXIgcmVjZWl2ZWQgaW4gcHJlc2FsZSAyCiAgICAgICAgICAgIHJlcXVpcmUoZXRoUmVjZWl2ZWRQcmVzYWxlT25lICsgZXRoUmVjZWl2ZWRQcmVzYWxlVHdvIDw9IG1heENhcEV0aCk7ICAvLyBlbnN1cmUgdGhhdCBtYXggY2FwIGhhc24ndCBiZWVuIHJlYWNoZWQKICAgICAgICB9ZWxzZSBpZiAoY3VycmVudFN0ZXAgPT0gU3RlcC5GdW5kaW5nTWFpblNhbGUpIHsKICAgICAgICAgICAgYmFja2VyLndlaVJlY2VpdmVkTWFpbiA9IGJhY2tlci53ZWlSZWNlaXZlZE1haW4uYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgICAgIGV0aFJlY2VpdmVNYWluU2FsZSA9IGV0aFJlY2VpdmVNYWluU2FsZS5hZGQobXNnLnZhbHVlKTsgIC8vIFVwZGF0ZSB0aGUgdG90YWwgRXRoZXIgcmVjZWl2ZWQgaW4gcHJlc2FsZSAyCiAgICAgICAgICAgIHVpbnQgdG9rZW5zVG9TZW5kID0gZG9sbGFyUGVyRXRoZXJSYXRpby5tdWwobXNnLnZhbHVlKSAvIDYyOyAgLy8gY2FsY3VsYXRlIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZCBmb3IgdGhpcyB1c2VyIAogICAgICAgICAgICB0b3RhbFRva2Vuc1NvbGQgKz0gdG9rZW5zVG9TZW5kOwogICAgICAgICAgICByZXF1aXJlKHRvdGFsVG9rZW5zU29sZCA8PSBtYXhDYXBUb2tlbnMpOyAgLy8gZW5zdXJlIHRoYXQgbWF4IGNhcCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgICAgICAgfQogICAgICAgIG11bHRpc2lnLnRyYW5zZmVyKG1zZy52YWx1ZSk7ICAvLyBzZW5kIG1vbmV5IHRvIG11bHRpc2lnbmF0dXJlIHdhbGxldAoKICAgICAgICBSZWNlaXZlZEVUSChfY29udHJpYnV0b3IsIGN1cnJlbnRTdGVwLCBtc2cudmFsdWUpOyAvLyBSZWdpc3RlciBldmVudAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLyBAbm90aWNlIFRoaXMgZnVuY3Rpb24gd2lsbCBmaW5hbGl6ZSB0aGUgc2FsZS4KICAgIC8vIEl0IHdpbGwgb25seSBleGVjdXRlIGlmIHByZWRldGVybWluZWQgc2FsZSB0aW1lIHBhc3NlZCBvciBhbGwgdG9rZW5zIHdlcmUgc29sZAoKICAgIGZ1bmN0aW9uIGZpbmFsaXplU2FsZSgpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKGRhdGVJQ09FbmRlZCA9PSAwKTsKICAgICAgICByZXF1aXJlKGN1cnJlbnRTdGVwID09IFN0ZXAuRnVuZGluZ01haW5TYWxlKTsKICAgICAgICAvLyBwdXJjaGFzaW5nIHByZWNpc2UgbnVtYmVyIG9mIHRva2VucyBtaWdodCBiZSBpbXByYWN0aWNhbCwgdGh1cyBzdWJ0cmFjdCAxMDAwIHRva2VucyBzbyBmaW5hbGl6YXRpb24gaXMgcG9zc2libGUKICAgICAgICAvLyBuZWFyIHRoZSBlbmQKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+PSBlbmRCbG9jayB8fCB0b3RhbFRva2Vuc1NvbGQgPj0gbWF4Q2FwVG9rZW5zLnN1YigxMDAwKSk7CiAgICAgICAgcmVxdWlyZSh0b3RhbFRva2Vuc1NvbGQgPj0gbWluQ2FwVG9rZW5zKTsKICAgICAgICAKICAgICAgICBjb21wYW55VG9rZW5zSW5pdGlhbCArPSBtYXhDYXBUb2tlbnMgLSB0b3RhbFRva2Vuc1NvbGQ7IC8vIGFsbG9jYXRlIHVuc29sZCB0b2tlbnMgdG8gdGhlIGNvbXBhbnkgICAgICAgIAogICAgICAgIGRhdGVJQ09FbmRlZCA9IG5vdzsKICAgICAgICB0b2tlbi51bmxvY2soKTsKICAgIH0KCgogICAgLy8gQG5vdGljZSB0aGlzIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIGJ5IG93bmVyIHRvIHVwZGF0ZSBjb250cmlidXRpb24gYWRkcmVzcyBpbiBjYXNlIG9mIHVzaW5nIGFkZHJlc3MgZnJvbSBleGNoYW5nZSBvciBpbmNvbXBhdGlibGUgd2FsbGV0CiAgICAvLyBAcGFyYW0gX2NvbnRyaWJ1dG9yT2xkIC0gb2xkIGNvbnRyaWJ1dG9yIGFkZHJlc3MKICAgIC8vIEBwYXJhbSBfY29udHJpYnV0b3JOZXcgLSBuZXcgY29udHJpYnV0b3IgYWRkcmVzcwogICAgZnVuY3Rpb24gdXBkYXRlQ29udHJpYnV0b3JBZGRyZXNzKGFkZHJlc3MgX2NvbnRyaWJ1dG9yT2xkLCBhZGRyZXNzIF9jb250cmlidXRvck5ldykgcHVibGljIG9ubHlPd25lcigpIHsKCiAgICAgICAgQmFja2VyIHN0b3JhZ2UgYmFja2VyT2xkID0gYmFja2Vyc1tfY29udHJpYnV0b3JPbGRdOwogICAgICAgIEJhY2tlciBzdG9yYWdlIGJhY2tlck5ldyA9IGJhY2tlcnNbX2NvbnRyaWJ1dG9yTmV3XTsKCiAgICAgICAgcmVxdWlyZShiYWNrZXJPbGQud2VpUmVjZWl2ZWRPbmUgPiAwIHx8IGJhY2tlck9sZC53ZWlSZWNlaXZlZFR3byA+IDAgfHwgYmFja2VyT2xkLndlaVJlY2VpdmVkTWFpbiA+IDApOyAvLyBtYWtlIHN1cmUgdGhhdCBjb250cmlidXRpb24gaGFzIGJlZW4gbWFkZSB0byB0aGUgb2xkIGFkZHJlc3MKICAgICAgICByZXF1aXJlKGJhY2tlck5ldy53ZWlSZWNlaXZlZE9uZSA9PSAwICYmIGJhY2tlck5ldy53ZWlSZWNlaXZlZFR3byA9PSAwICYmIGJhY2tlck5ldy53ZWlSZWNlaXZlZE1haW4gPT0gMCk7IC8vIG1ha2Ugc3VyZSB0aGF0IGV4aXN0aW5nIGFkZHJlc3MgaXMgbm90IHVzZWQKICAgICAgICByZXF1aXJlKGJhY2tlck9sZC5jbGFpbWVkID09IGZhbHNlICYmIGJhY2tlck9sZC5yZWZ1bmRlZCA9PSBmYWxzZSk7ICAvLyBlbnN1cmUgdGhhdCBjb250cmlidXRvciBoYXNuJ3QgYmUgcmVmdW5kZWQgb3IgY2xhaW1lZCB0aGUgdG9rZW5zIHlldAoKICAgICAgICAvLyBpbnZhbGlkYXRlIG9sZCBhZGRyZXNzCiAgICAgICAgYmFja2VyT2xkLmNsYWltZWQgPSB0cnVlOwogICAgICAgIGJhY2tlck9sZC5yZWZ1bmRlZCA9IHRydWU7CgogICAgICAgIC8vIGluaXRpYWxpemUgbmV3IGFkZHJlc3MKICAgICAgICBiYWNrZXJOZXcud2VpUmVjZWl2ZWRPbmUgPSBiYWNrZXJPbGQud2VpUmVjZWl2ZWRPbmU7CiAgICAgICAgYmFja2VyTmV3LndlaVJlY2VpdmVkVHdvID0gYmFja2VyT2xkLndlaVJlY2VpdmVkVHdvOwogICAgICAgIGJhY2tlck5ldy53ZWlSZWNlaXZlZE1haW4gPSBiYWNrZXJPbGQud2VpUmVjZWl2ZWRNYWluOwogICAgICAgIGJhY2tlcnNJbmRleC5wdXNoKF9jb250cmlidXRvck5ldyk7CiAgICB9CgogICAgLy8gQG5vdGljZSBjYWxsZWQgdG8gc2VuZCB0b2tlbnMgdG8gY29udHJpYnV0b3JzIGFmdGVyIElDTy4KICAgIC8vIEBwYXJhbSBfYmFja2VyIHthZGRyZXNzfSBhZGRyZXNzIG9mIGJlbmVmaWNpYXJ5CiAgICAvLyBAcmV0dXJuIHRydWUgaWYgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnNGb3JVc2VyKGFkZHJlc3MgX2JhY2tlcikgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7ICAgICAgICAKCiAgICAgICAgcmVxdWlyZShkYXRlSUNPRW5kZWQgPiAwKTsgLy8gYWxsb3cgb24gY2xhaW1pbmcgb2YgdG9rZW5zIGlmIElDTyB3YXMgc3VjY2Vzc2Z1bCAgICAgICAgICAgICAKCiAgICAgICAgQmFja2VyIHN0b3JhZ2UgYmFja2VyID0gYmFja2Vyc1tfYmFja2VyXTsKCiAgICAgICAgcmVxdWlyZSAoIWJhY2tlci5yZWZ1bmRlZCk7IC8vIGlmIHJlZnVuZGVkLCBkb24ndCBhbGxvdyB0byBjbGFpbSB0b2tlbnMKICAgICAgICByZXF1aXJlICghYmFja2VyLmNsYWltZWQpOyAvLyBpZiB0b2tlbnMgY2xhaW1lZCwgZG9uJ3QgYWxsb3cgdG8gY2xhaW0gYWdhaW4KICAgICAgICByZXF1aXJlIChiYWNrZXIud2VpUmVjZWl2ZWRPbmUgPiAwIHx8IGJhY2tlci53ZWlSZWNlaXZlZFR3byA+IDAgfHwgYmFja2VyLndlaVJlY2VpdmVkTWFpbiA+IDApOyAgIC8vIG9ubHkgY29udGludWUgaWYgdGhlcmUgaXMgYW55IGNvbnRyaWJ1dGlvbgoKICAgICAgICBjbGFpbUNvdW50Kys7CiAgICAgICAgdWludCB0b2tlbnNUb1NlbmQgPSAoZG9sbGFyUGVyRXRoZXJSYXRpbyAqIGJhY2tlci53ZWlSZWNlaXZlZE9uZSkgLyA0ODsgIC8vIGRldGVybWluZSBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbmQgZnJvbSBmaXJzdCBwcmVzYWxlCiAgICAgICAgdG9rZW5zVG9TZW5kID0gdG9rZW5zVG9TZW5kICsgKGRvbGxhclBlckV0aGVyUmF0aW8gKiBiYWNrZXIud2VpUmVjZWl2ZWRUd28pIC8gNTg7ICAvLyBkZXRlcm1pbmUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kIGZyb20gc2Vjb25kIHByZXNhbGUKICAgICAgICB0b2tlbnNUb1NlbmQgPSB0b2tlbnNUb1NlbmQgKyAoZG9sbGFyUGVyRXRoZXJSYXRpbyAqIGJhY2tlci53ZWlSZWNlaXZlZE1haW4pIC8gNjI7ICAvLyBkZXRlcm1pbmUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kIGZyb20gbWFpbiBzYWxlCgogICAgICAgIGNsYWltZWRbX2JhY2tlcl0gPSB0b2tlbnNUb1NlbmQ7ICAvLyBzYXZlIGNsYWltZWQgdG9rZW5zCiAgICAgICAgYmFja2VyLmNsYWltZWQgPSB0cnVlOwogICAgICAgIGJhY2tlci50b2tlbnNTZW50ID0gdG9rZW5zVG9TZW5kOwogICAgICAgIHRvdGFsQ2xhaW1lZCArPSB0b2tlbnNUb1NlbmQ7CgogICAgICAgIGlmICghdG9rZW4udHJhbnNmZXIoX2JhY2tlciwgdG9rZW5zVG9TZW5kKSkKICAgICAgICAgICAgcmV2ZXJ0KCk7IC8vIHNlbmQgY2xhaW1lZCB0b2tlbnMgdG8gY29udHJpYnV0b3IgYWNjb3VudAoKICAgICAgICBUb2tlbnNDbGFpbWVkKF9iYWNrZXIsdG9rZW5zVG9TZW5kKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8gQG5vdGljZSBjb250cmlidXRvcnMgY2FuIGNsYWltIHRva2VucyBhZnRlciBwdWJsaWMgSUNPIGlzIGZpbmlzaGVkCiAgICAvLyB0b2tlbnMgYXJlIG9ubHkgY2xhaW1hYmxlIHdoZW4gdG9rZW4gYWRkcmVzcyBpcyBhdmFpbGFibGUuCgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoKSBleHRlcm5hbCB7CiAgICAgICAgY2xhaW1Ub2tlbnNGb3JVc2VyKG1zZy5zZW5kZXIpOwogICAgfQoKCiAgICAvLyBAbm90aWNlIHRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBieSBhZG1pbiB0byBjbGFpbSB1c2VyJ3MgdG9rZW4gaW4gY2FzZSBvZiBkaWZmaWN1bHRpZXMKICAgIC8vIEBwYXJhbSBfYmFja2VyIHthZGRyZXNzfSB1c2VyIGFkZHJlc3MgdG8gY2xhaW0gdG9rZW5zIGZvcgogICAgZnVuY3Rpb24gYWRtaW5DbGFpbVRva2VuRm9yVXNlcihhZGRyZXNzIF9iYWNrZXIpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgICAgICBjbGFpbVRva2Vuc0ZvclVzZXIoX2JhY2tlcik7CiAgICB9CgogICAgLy8gQG5vdGljZSBhbGxvdyByZWZ1bmQgd2hlbiBJQ08gZmFpbGVkCiAgICAvLyBJbiBzdWNoIGEgY2FzZSBjb250cmFjdCB3aWxsIG5lZWQgdG8gYmUgZnVuZGVkLgogICAgLy8gVW50aWwgY29udHJhY3QgaXMgZnVuZGVkIHRoaXMgZnVuY3Rpb24gd2lsbCB0aHJvdwoKICAgIGZ1bmN0aW9uIHJlZnVuZCgpIGV4dGVybmFsIHsKCiAgICAgICAgcmVxdWlyZShjdXJyZW50U3RlcCA9PSBTdGVwLlJlZnVuZGluZyk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIHJlcXVpcmUodG90YWxUb2tlbnNTb2xkIDwgbWF4Q2FwVG9rZW5zLzIpOyAvLyBlbnN1cmUgdGhhdCByZWZ1bmQgaXMgaW1wb3NzaWJsZSB3aGVuIG1vcmUgdGhhbiBoYWxmIG9mIHRoZSB0b2tlbnMgYXJlIHNvbGQKCiAgICAgICAgQmFja2VyIHN0b3JhZ2UgYmFja2VyID0gYmFja2Vyc1ttc2cuc2VuZGVyXTsKCiAgICAgICAgcmVxdWlyZSAoIWJhY2tlci5jbGFpbWVkKTsgLy8gY2hlY2sgaWYgdG9rZW5zIGhhdmUgYmVlbiBhbGxvY2F0ZWQgYWxyZWFkeQogICAgICAgIHJlcXVpcmUgKCFiYWNrZXIucmVmdW5kZWQpOyAvLyBjaGVjayBpZiB1c2VyIGhhcyBiZWVuIGFscmVhZHkgcmVmdW5kZWQKCiAgICAgICAgdWludCB0b3RhbEV0aGVyUmVjZWl2ZWQgPSAoKGJhY2tlci53ZWlSZWNlaXZlZE9uZSAqIHJldHVyblBlcmNlbnRhZ2UpIC8gMTAwKSArIGJhY2tlci53ZWlSZWNlaXZlZFR3byArIGJhY2tlci53ZWlSZWNlaXZlZE1haW47ICAvLyByZXR1cm4gb25seSBlLmcuIDc1JSBmcm9tIHByZXNhbGUgb25lLgogICAgICAgIGFzc2VydCh0b3RhbEV0aGVyUmVjZWl2ZWQgPiAwKTsKCiAgICAgICAgYmFja2VyLnJlZnVuZGVkID0gdHJ1ZTsgLy8gbWFyayBjb250cmlidXRvciBhcyByZWZ1bmRlZC4KICAgICAgICB0b3RhbFJlZnVuZGVkICs9IHRvdGFsRXRoZXJSZWNlaXZlZDsKICAgICAgICByZWZ1bmRDb3VudCArKzsKICAgICAgICByZWZ1bmRlZFttc2cuc2VuZGVyXSA9IHRvdGFsUmVmdW5kZWQ7CgogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodG90YWxFdGhlclJlY2VpdmVkKTsgIC8vIHJlZnVuZCBjb250cmlidXRpb24KICAgICAgICBSZWZ1bmRlZChtc2cuc2VuZGVyLCB0b3RhbEV0aGVyUmVjZWl2ZWQpOyAvLyBsb2cgZXZlbnQKICAgIH0KCgoKICAgIC8vIEBub3RpY2UgcmVmdW5kIG5vbiBjb21wbGlhbnQgbWVtYmVyIAogICAgLy8gQHBhcmFtIF9jb250cmlidXRvciB7YWRkcmVzc30gb2YgcmVmdW5kZWQgY29udHJpYnV0b3IKICAgIGZ1bmN0aW9uIHJlZnVuZE5vbkNvbXBsaWFudChhZGRyZXNzIF9jb250cmlidXRvcikgcGF5YWJsZSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CiAgICAKICAgICAgICBCYWNrZXIgc3RvcmFnZSBiYWNrZXIgPSBiYWNrZXJzW19jb250cmlidXRvcl07CgogICAgICAgIHJlcXVpcmUgKCFiYWNrZXIuY2xhaW1lZCk7IC8vIGNoZWNrIGlmIHRva2VucyBoYXZlIGJlZW4gYWxsb2NhdGVkIGFscmVhZHkKICAgICAgICByZXF1aXJlICghYmFja2VyLnJlZnVuZGVkKTsgLy8gY2hlY2sgaWYgdXNlciBoYXMgYmVlbiBhbHJlYWR5IHJlZnVuZGVkCiAgICAgICAgYmFja2VyLnJlZnVuZGVkID0gdHJ1ZTsgLy8gbWFyayBjb250cmlidXRvciBhcyByZWZ1bmRlZC4gICAgICAgICAgICAKCiAgICAgICAgdWludCB0b3RhbEV0aGVyUmVjZWl2ZWQgPSBiYWNrZXIud2VpUmVjZWl2ZWRPbmUgKyBiYWNrZXIud2VpUmVjZWl2ZWRUd28gKyBiYWNrZXIud2VpUmVjZWl2ZWRNYWluOwoKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSB0b3RhbEV0aGVyUmVjZWl2ZWQpOyAvLyBlbnN1cmUgdGhhdCBleGFjdCBhbW91bnQgaXMgc2VudAogICAgICAgIGFzc2VydCh0b3RhbEV0aGVyUmVjZWl2ZWQgPiAwKTsKCiAgICAgICAgLy9hZGp1c3QgYW1vdW50cyByZWNlaXZlZAogICAgICAgIGV0aFJlY2VpdmVkUHJlc2FsZU9uZSAtPSBiYWNrZXIud2VpUmVjZWl2ZWRPbmU7CiAgICAgICAgZXRoUmVjZWl2ZWRQcmVzYWxlVHdvIC09IGJhY2tlci53ZWlSZWNlaXZlZFR3bzsKICAgICAgICBldGhSZWNlaXZlTWFpblNhbGUgLT0gYmFja2VyLndlaVJlY2VpdmVkTWFpbjsKICAgICAgICAKICAgICAgICB0b3RhbFJlZnVuZGVkICs9IHRvdGFsRXRoZXJSZWNlaXZlZDsKICAgICAgICByZWZ1bmRDb3VudCArKzsKICAgICAgICByZWZ1bmRlZFtfY29udHJpYnV0b3JdID0gdG90YWxSZWZ1bmRlZDsgICAgICAKCiAgICAgICAgdWludCB0b2tlbnNUb1NlbmQgPSAoZG9sbGFyUGVyRXRoZXJSYXRpbyAqIGJhY2tlci53ZWlSZWNlaXZlZE9uZSkgLyA0ODsgIC8vIGRldGVybWluZSBhbW91bnQgb2YgdG9rZW5zIHRvIHNlbmQgZnJvbSBmaXJzdCBwcmVzYWxlCiAgICAgICAgdG9rZW5zVG9TZW5kID0gdG9rZW5zVG9TZW5kICsgKGRvbGxhclBlckV0aGVyUmF0aW8gKiBiYWNrZXIud2VpUmVjZWl2ZWRUd28pIC8gNTg7ICAvLyBkZXRlcm1pbmUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kIGZyb20gc2Vjb25kIHByZXNhbGUKICAgICAgICB0b2tlbnNUb1NlbmQgPSB0b2tlbnNUb1NlbmQgKyAoZG9sbGFyUGVyRXRoZXJSYXRpbyAqIGJhY2tlci53ZWlSZWNlaXZlZE1haW4pIC8gNjI7ICAvLyBkZXRlcm1pbmUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kIGZyb20gbWFpbiBzYWxlCgogICAgICAgIGlmKGRhdGVJQ09FbmRlZCA9PSAwKSB7CiAgICAgICAgICAgIHRvdGFsVG9rZW5zU29sZCAtPSB0b2tlbnNUb1NlbmQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29tcGFueVRva2Vuc0luaXRpYWwgKz0gdG9rZW5zVG9TZW5kOwogICAgICAgIH0KCiAgICAgICAgX2NvbnRyaWJ1dG9yLnRyYW5zZmVyKHRvdGFsRXRoZXJSZWNlaXZlZCk7ICAvLyByZWZ1bmQgY29udHJpYnV0aW9uCiAgICAgICAgUmVmdW5kZWQoX2NvbnRyaWJ1dG9yLCB0b3RhbEV0aGVyUmVjZWl2ZWQpOyAvLyBsb2cgZXZlbnQKICAgIH0KCiAgICAvLyBAbm90aWNlIEZhaWxzYWZlIGRyYWluIHRvIGluZGl2aWR1YWwgd2FsbGV0CiAgICBmdW5jdGlvbiBkcmFpbigpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKICAgICAgICBtdWx0aXNpZy50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwoKICAgIH0KCiAgICAvLyBAbm90aWNlIEZhaWxzYWZlIHRva2VuIHRyYW5zZmVyCiAgICBmdW5jdGlvbiB0b2tlbkRyYWluKCkgZXh0ZXJuYWwgb25seU93bmVyKCkgewogICAgaWYgKGJsb2NrLm51bWJlciA+IGVuZEJsb2NrKSB7CiAgICAgICAgaWYgKCF0b2tlbi50cmFuc2ZlcihtdWx0aXNpZywgdG9rZW4uYmFsYW5jZU9mKHRoaXMpKSkKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KfQoKCgoKCi8vIEBub3RpY2UgVGhlIHRva2VuIGNvbnRyYWN0CmNvbnRyYWN0IFRva2VuIGlzIEVSQzIwLCAgT3duYWJsZSB7CgogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CiAgICAvLyBQdWJsaWMgdmFyaWFibGVzIG9mIHRoZSB0b2tlbgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7IC8vIEhvdyBtYW55IGRlY2ltYWxzIHRvIHNob3cuCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAidjAuMSI7CiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIHVpbnQgcHVibGljIGluaXRpYWxTdXBwbHk7CiAgICBib29sIHB1YmxpYyBsb2NrZWQ7CiAgICBhZGRyZXNzIHB1YmxpYyBjcm93ZFNhbGVBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgbWlncmF0aW9uTWFzdGVyOwogICAgYWRkcmVzcyBwdWJsaWMgbWlncmF0aW9uQWdlbnQ7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbE1pZ3JhdGVkOwogICAgYWRkcmVzcyBwdWJsaWMgYXV0aG9yaXplZDsKCgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlczsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkpIHB1YmxpYyBhbGxvd2VkOwoKICAgIC8vIEBub3RpY2UgdG9rZW5zIGFyZSBsb2NrZWQgZHVyaW5nIHRoZSBJQ08uIEFsbG93IHRyYW5zZmVyIG9mIHRva2VucyBhZnRlciBJQ08uCiAgICBtb2RpZmllciBvbmx5VW5sb2NrZWQoKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY3Jvd2RTYWxlQWRkcmVzcyAmJiBsb2NrZWQpCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8vIEBOb3RpY2UgYWxsb3cgbWludGluZyBvZiB0b2tlbnMgb25seSBieSBhdXRob3JpemVkIHVzZXJzCiAgICBtb2RpZmllciBvbmx5QXV0aG9yaXplZCgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lciAmJiBtc2cuc2VuZGVyICE9IGF1dGhvcml6ZWQgKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBAbm90aWNlIFRoZSBUb2tlbiBjb25zdHJ1Y3RvcgogICAgLy8gQHBhcmFtIF9jcm93ZFNhbGVBZGRyZXNzIHthZGRyZXNzfSBhZGRyZXNzIG9mIGNyb3dkc2FsZSBjb250cmFjdAogICAgLy8gQHBhcmFtIF9taWdyYXRpb25NYXN0ZXIge2FkZHJlc3N9IGFkZHJlc3Mgb2YgYXV0aG9yaXplZCBtaWdyYXRpb24gcGVyc29uCiAgICBmdW5jdGlvbiBUb2tlbihhZGRyZXNzIF9jcm93ZFNhbGVBZGRyZXNzKSBwdWJsaWMgewoKICAgICAgICByZXF1aXJlKF9jcm93ZFNhbGVBZGRyZXNzICE9IDApOwoKICAgICAgICBsb2NrZWQgPSB0cnVlOyAgLy8gTG9jayB0aGUgdHJhbnNmZXIgZnVuY3Rpb24gZHVyaW5nIHRoZSBjcm93ZHNhbGUKICAgICAgICBpbml0aWFsU3VwcGx5ID0gMWUyNjsKICAgICAgICB0b3RhbFN1cHBseSA9IGluaXRpYWxTdXBwbHk7CiAgICAgICAgbmFtZSA9ICJOYXJyYXRpdmUiOyAvLyBTZXQgdGhlIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBzeW1ib2wgPSAiTlJWIjsgLy8gU2V0IHRoZSBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBkZWNpbWFscyA9IDE4OyAvLyBBbW91bnQgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBjcm93ZFNhbGVBZGRyZXNzID0gX2Nyb3dkU2FsZUFkZHJlc3M7CiAgICAgICAgYmFsYW5jZXNbY3Jvd2RTYWxlQWRkcmVzc10gPSBpbml0aWFsU3VwcGx5OwogICAgICAgIG1pZ3JhdGlvbk1hc3RlciA9IG93bmVyOwogICAgICAgIGF1dGhvcml6ZWQgPSBfY3Jvd2RTYWxlQWRkcmVzczsKICAgIH0KCiAgICAvLyBAbm90aWNlIHVubG9jayB0b2tlbnMgZm9yIHRyYWRpbmcKICAgIGZ1bmN0aW9uIHVubG9jaygpIHB1YmxpYyBvbmx5QXV0aG9yaXplZCB7CiAgICAgICAgbG9ja2VkID0gZmFsc2U7CiAgICB9CgogICAgLy8gQG5vdGljZSBsb2NrIHRva2VucyBpbiBjYXNlIG9mIHByb2JsZW1zCiAgICBmdW5jdGlvbiBsb2NrKCkgcHVibGljIG9ubHlBdXRob3JpemVkIHsKICAgICAgICBsb2NrZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIEBub3RpY2Ugc2V0IGF1dGhvcml6ZWQgcGFydHkKICAgIC8vIEBwYXJhbSBfYXV0aG9yaXplZCB7YWRkcmVzc30gb2YgYW4gaW5kaXZpZHVhbCB0byBnZXQgYXV0aG9yaXphdGlvbgogICAgZnVuY3Rpb24gc2V0QXV0aG9yaXplZChhZGRyZXNzIF9hdXRob3JpemVkKSBwdWJsaWMgb25seU93bmVyIHsKCiAgICAgICAgYXV0aG9yaXplZCA9IF9hdXRob3JpemVkOwogICAgfQoKCiAgICAvLyBUb2tlbiBtaWdyYXRpb24gc3VwcG9ydDogYXMgaW1wbGVtZW50ZWQgYnkgR29sZW0KICAgIGV2ZW50IE1pZ3JhdGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLy8vIEBub3RpY2UgTWlncmF0ZSB0b2tlbnMgdG8gdGhlIG5ldyB0b2tlbiBjb250cmFjdC4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIHN0YXRlOiBPcGVyYXRpb25hbCBNaWdyYXRpb24KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgbWlncmF0ZWQKICAgIGZ1bmN0aW9uIG1pZ3JhdGUodWludDI1NiBfdmFsdWUpICBleHRlcm5hbCB7CiAgICAgICAgLy8gQWJvcnQgaWYgbm90IGluIE9wZXJhdGlvbmFsIE1pZ3JhdGlvbiBzdGF0ZS4KCiAgICAgICAgcmVxdWlyZSAobWlncmF0aW9uQWdlbnQgIT0gMCk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CiAgICAgICAgdG90YWxNaWdyYXRlZCA9IHRvdGFsTWlncmF0ZWQuYWRkKF92YWx1ZSk7CiAgICAgICAgTWlncmF0aW9uQWdlbnQobWlncmF0aW9uQWdlbnQpLm1pZ3JhdGVGcm9tKG1zZy5zZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgTWlncmF0ZShtc2cuc2VuZGVyLCBtaWdyYXRpb25BZ2VudCwgX3ZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgYWRkcmVzcyBvZiBtaWdyYXRpb24gdGFyZ2V0IGNvbnRyYWN0IGFuZCBlbmFibGUgbWlncmF0aW9uCiAgICAvLy8gcHJvY2Vzcy4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIHN0YXRlOiBPcGVyYXRpb25hbCBOb3JtYWwKICAgIC8vLyBAZGV2IFN0YXRlIHRyYW5zaXRpb246IC0+IE9wZXJhdGlvbmFsIE1pZ3JhdGlvbgogICAgLy8vIEBwYXJhbSBfYWdlbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pZ3JhdGlvbkFnZW50IGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXRNaWdyYXRpb25BZ2VudChhZGRyZXNzIF9hZ2VudCkgIGV4dGVybmFsIHsKICAgICAgICAvLyBBYm9ydCBpZiBub3QgaW4gT3BlcmF0aW9uYWwgTm9ybWFsIHN0YXRlLgoKICAgICAgICByZXF1aXJlKG1pZ3JhdGlvbkFnZW50ID09IDApOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtaWdyYXRpb25NYXN0ZXIpOwogICAgICAgIG1pZ3JhdGlvbkFnZW50ID0gX2FnZW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE1pZ3JhdGlvbk1hc3RlcihhZGRyZXNzIF9tYXN0ZXIpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbWlncmF0aW9uTWFzdGVyKTsKICAgICAgICByZXF1aXJlKF9tYXN0ZXIgIT0gMCk7CiAgICAgICAgbWlncmF0aW9uTWFzdGVyID0gX21hc3RlcjsKICAgIH0KCiAgICAvLyBAbm90aWNlIG1pbnQgbmV3IHRva2VucyB3aXRoIG1heCBvZiAxOTcuNSBtaWxsaW9ucwogICAgLy8gQHBhcmFtIF90YXJnZXQge2FkZHJlc3N9IG9mIHJlY2VpcHQKICAgIC8vIEBwYXJhbSBfbWludGVkQW1vdW50IHt1aW50fSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIG1pbnRlZAogICAgLy8gQHJldHVybiAge2Jvb2x9IHRydWUgaWYgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90YXJnZXQsIHVpbnQyNTYgX21pbnRlZEFtb3VudCkgcHVibGljIG9ubHlBdXRob3JpemVkKCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgYXNzZXJ0KHRvdGFsU3VwcGx5LmFkZChfbWludGVkQW1vdW50KSA8PSAxOTc1ZTIzKTsgIC8vIGVuc3VyZSB0aGF0IG1heCBhbW91bnQgZXZlciBtaW50ZWQgc2hvdWxkIG5vdCBleGNlZWQgMTk3LjUgbWlsbGlvbiB0b2tlbnMgd2l0aCAxOCBkZWNpbWFscwogICAgICAgIGJhbGFuY2VzW190YXJnZXRdID0gYmFsYW5jZXNbX3RhcmdldF0uYWRkKF9taW50ZWRBbW91bnQpOwogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9taW50ZWRBbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF90YXJnZXQsIF9taW50ZWRBbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEBub3RpY2UgdHJhbnNmZXIgdG9rZW5zIHRvIGdpdmVuIGFkZHJlc3MKICAgIC8vIEBwYXJhbSBfdG8ge2FkZHJlc3N9IGFkZHJlc3Mgb3IgcmVjaXBpZW50CiAgICAvLyBAcGFyYW0gX3ZhbHVlIHt1aW50fSBhbW91bnQgdG8gdHJhbnNmZXIKICAgIC8vIEByZXR1cm4gIHtib29sfSB0cnVlIGlmIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIG9ubHlVbmxvY2tlZCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vIEBub3RpY2UgdHJhbnNmZXIgdG9rZW5zIGZyb20gZ2l2ZW4gYWRkcmVzcyB0byBhbm90aGVyIGFkZHJlc3MKICAgIC8vIEBwYXJhbSBfZnJvbSB7YWRkcmVzc30gZnJvbSB3aG9tIHRva2VucyBhcmUgdHJhbnNmZXJyZWQKICAgIC8vIEBwYXJhbSBfdG8ge2FkZHJlc3N9IHRvIHdob20gdG9rZW5zIGFyZSB0cmFuc2ZlcnJlZAogICAgLy8gQHBhcmFtIF92YWx1ZSB7dWludH0gYW1vdW50IG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgLy8gQHJldHVybiAge2Jvb2x9IHRydWUgaWYgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlVbmxvY2tlZCByZXR1cm5zKGJvb2wgc3VjY2VzcykgewoKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOyAvLyBDaGVjayBpZiB0aGUgc2VuZGVyIGhhcyBlbm91Z2gKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7IC8vIENoZWNrIGlmIGFsbG93ZWQgaXMgZ3JlYXRlciBvciBlcXVhbAogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7IC8vIFN1YnRyYWN0IGZyb20gdGhlIHNlbmRlcgogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOyAvLyBBZGQgdGhlIHNhbWUgdG8gdGhlIHJlY2lwaWVudAogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsgIC8vIGFkanVzdCBhbGxvd2VkCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIHRvIHF1ZXJ5IGJhbGFuY2Ugb2YgYWNjb3VudAogICAgLy8gQHJldHVybiBfb3duZXIge2FkZHJlc3N9IGFkZHJlc3Mgb2YgdXNlciB0byBxdWVyeSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludCBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgoKICAgIC8qKgogICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgICoKICAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8gQG5vdGljZSB0byBxdWVyeSBvZiBhbGxvd2FuY2Ugb2Ygb25lIHVzZXIgdG8gdGhlIG90aGVyCiAgICAvLyBAcGFyYW0gX293bmVyIHthZGRyZXNzfSBvZiB0aGUgb3duZXIgb2YgdGhlIGFjY291bnQKICAgIC8vIEBwYXJhbSBfc3BlbmRlciB7YWRkcmVzc30gb2YgdGhlIHNwZW5kZXIgb2YgdGhlIGFjY291bnQKICAgIC8vIEByZXR1cm4gcmVtYWluaW5nIHt1aW50fSBhbW91bnQgb2YgcmVtYWluaW5nIGFsbG93YW5jZQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLyoqCiAgICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICAqLwogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgICAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgICAgICB9CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgp9'.
	

]
