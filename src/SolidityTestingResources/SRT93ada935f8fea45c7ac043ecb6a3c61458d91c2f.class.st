Class {
	#name : #SRT93ada935f8fea45c7ac043ecb6a3c61458d91c2f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT93ada935f8fea45c7ac043ecb6a3c61458d91c2f >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CmxpYnJhcnkgU2FmZU1hdGggeyAgICAKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIHJldHVybiBjOwogIH0gCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0gCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9ICAKfQoKY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICAKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICBib29sIHB1YmxpYyB0ZWFtU3Rha2VzRnJvemVuID0gdHJ1ZTsKICBib29sIHB1YmxpYyBmdW5kYXJpYVN0YWtlc0Zyb3plbiA9IHRydWU7CiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIGFkZHJlc3MgcHVibGljIGZ1bmRhcmlhID0gMHgxODgyNDY0NTMzMDcyZTlmQ2Q4QzZEM2M1YzViNTg4NTQ4Qjk1Mjk2OyAvLyBpbml0aWFsIEZ1bmRhcmlhIHBvb2wgYWRkcmVzcyAgCiAgCiAgZnVuY3Rpb24gQmFzaWNUb2tlbigpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQogIAogIG1vZGlmaWVyIG5vdEZyb3plbigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBvd25lciB8fCAobXNnLnNlbmRlciA9PSBvd25lciAmJiAhdGVhbVN0YWtlc0Zyb3plbikgfHwgKG1zZy5zZW5kZXIgPT0gZnVuZGFyaWEgJiYgIWZ1bmRhcmlhU3Rha2VzRnJvemVuKSk7CiAgICBfOwogIH0KCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgbm90RnJvemVuIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBpbnRlcm5hbCBhbGxvd2VkOwogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICoKICAgKiBCZXdhcmUgdGhhdCBjaGFuZ2luZyBhbiBhbGxvd2FuY2Ugd2l0aCB0aGlzIG1ldGhvZCBicmluZ3MgdGhlIHJpc2sgdGhhdCBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkCiAgICogYW5kIHRoZSBuZXcgYWxsb3dhbmNlIGJ5IHVuZm9ydHVuYXRlIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcwogICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgKiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBub3RGcm96ZW4gcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgbm90RnJvemVuIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KfQoKY29udHJhY3QgU0FVUiBpcyBTdGFuZGFyZFRva2VuIHsKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQ2FyZG9zYXVyIFN0YWtlIjsKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJTQVVSIjsKICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAwOwp9Cgpjb250cmFjdCBTYWxlIGlzIFNBVVIgewoKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKLyoqKioqKioqKiogCiAqIENvbW1vbiAqCiAqKioqKioqKioqLwoKICAgIC8vIFRISVMgSVMgS0VZIFZBUklBQkxFIEFORCBERUZJTkVEIEFDQ09SRElORyBUTyBWQUxVRSBPRiBQTEFOTkVEIENPU1RTIE9OIFRIRSBQQUdFIGh0dHBzOi8vYnVzaW5lc3MuZnVuZGFyaWEuY29tCiAgICB1aW50IHB1YmxpYyBwb29sQ2FwVVNEID0gNzAwMDA7IC8vIDcwMDAwIGluaXRpYWxseQogICAgLy8gVVNEIHBlciAxIGV0aGVyLCBhZGRlZCAxMCUgYXByb3hpbWF0ZWxseSB0byBzZWN1cmUgZnJvbSB3cm9uZyBsb3cgcHJpY2UuIFdlIG5lZWQgYWRkIDEwJSBvZiBTdGFrZXMgdG8gc3VwcGx5IHRvIGNvdmVyIHN1Y2ggcHJpY2UuCiAgICB1aW50IHB1YmxpYyB1c2RQZXJFdGhlciA9IDgwMDsKICAgIHVpbnQgcHVibGljIHN1cHBseUNhcDsgLy8gQ3VycmVudCB0b3RhbCBzdXBwbHkgY2FwIGFjY29yZGluZyB0byBsYXN0U3Rha2VQcmljZVVTQ2VudHMgYW5kIHBvb2xDYXBVU0QgCiAgICB1aW50IHB1YmxpYyBidXNpbmVzc1BsYW5uZWRQZXJpb2REdXJhdGlvbiA9IDE4MyBkYXlzOyAvLyB0b3RhbCBwZXJpb2QgcGxhbm5lZCBmb3IgYnVzaW5lc3MgYWN0aXZpdHkgMzY1IGRheXMKICAgIHVpbnQgcHVibGljIGJ1c2luZXNzUGxhbm5lZFBlcmlvZEVuZFRpbWVzdGFtcDsKICAgIHVpbnQgcHVibGljIHRlYW1DYXA7IC8vIHRlYW0gU3Rha2VzIGNhcGFjaXR5CiAgICB1aW50OCBwdWJsaWMgdGVhbVNoYXJlID0gNTU7IC8vIHNoYXJlIGZvciB0ZWFtCiAgICB1aW50IHB1YmxpYyBkaXN0cmlidXRlZFRlYW1TdGFrZXM7IC8vIGRpc3RyaWJ1dGVkIFN0YWtlcyB0byB0ZWFtICAgIAogICAgdWludCBwdWJsaWMgZnVuZGFyaWFDYXA7IC8vIEZ1bmRhcmlhIFN0YWtlcyBjYXBhY2l0eQogICAgdWludDggcHVibGljIGZ1bmRhcmlhU2hhcmUgPSAyMDsgLy8gc2hhcmUgZm9yIEZ1bmRhcmlhCiAgICB1aW50IHB1YmxpYyBkaXN0cmlidXRlZEZ1bmRhcmlhU3Rha2VzOyAvLyBkaXN0cmlidXRlZCBTdGFrZXMgdG8gRnVuZGFyaWEKICAgIHVpbnQgcHVibGljIGNvbnRyYWN0Q3JlYXRlZFRpbWVzdGFtcDsgLy8gd2hlbiB0aGlzIGNvbnRyYWN0IHdhcyBjcmVhdGVkCiAgICBhZGRyZXNzIHB1YmxpYyBwb29sID0gMHgyOEMxOWNFYjU5OGZkYjE3MTA0OEM2MjREQjhiOTFDNTZBZjI5YUEyOyAvLyBpbml0aWFsIHBvb2wgd2FsbGV0IGFkZHJlc3MgIAogICAgbWFwcGluZyAoYWRkcmVzcz0+Ym9vbCkgcHVibGljIHJlamVjdGVkSW52ZXN0bWVudFdpdGhkcmF3YWxzOwogICAgdWludCBwdWJsaWMgYWxsb3dlZEFtb3VudFRvVHJhbnNmZXJUb1Bvb2w7IC8vIHRoaXMgYW1vdW50IGlzIGluY3JlYXNlZCB3aGVuIGludmVzdG9yIHJlamVjdHMgdG8gd2l0aGRyYXcgaGlzL2hlciBpbnZlc3RtZW50CiAgICB1aW50IHB1YmxpYyBhbGxvd2VkQW1vdW50VHJhbnNmZXJlZFRvUG9vbFRvdGFsOyAvLyBzdW0gb2YgYWxsIGFsbG93ZWRBbW91bnRUb1RyYW5zZmVyVG9Qb29sIHVzZWQgCiAgICB1aW50IHB1YmxpYyBpbnZlc3RtZW50R3VpZGVzUmV3YXJkc1dpdGhkcmF3bjsgLy8gdG90YWwgYW1vdW50IG9mIHJld2FyZHMgd2VpIHdpdGhkcmF3biBieSBHdWlkZXMgIAoKLyoqKioqKioqKiogCiAqIEJvdW50eSAqCiAqKioqKioqKioqLwogCiAgICB1aW50IHB1YmxpYyBkaXN0cmlidXRlZEJvdW50eVN0YWtlczsgLy8gYm91bnR5IGFkdmlzb3JzIFN0YWtlcyBkaXN0cmlidXRlZCB0b3RhbCAgICAKICAgIHVpbnQgcHVibGljIGJvdW50eUNhcDsgLy8gYm91bnR5IGFkdmlzb3JzIFN0YWtlcyBjYXBhY2l0eSAgICAKICAgIHVpbnQ4IHB1YmxpYyBib3VudHlTaGFyZSA9IDQ7IC8vIHNoYXJlIGZvciBib3VudHkgICAgCiAgICAKLyoqKioqKioqKioqIAogKiBTYWxlICoKICoqKioqKioqKioqLwogICAgYWRkcmVzcyBzdXBwbGllciA9IDB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDsgLy8gYWRkcmVzcyBvZiBTdGFrZXMgaW5pdGlhbCBzdXBwbGllciAoYWJzdHJhY3QpCiAgICAvLyBkYXRhIHRvIHN0b3JlIGludmVzdGVkIHdlaSB2YWx1ZSAmIFN0YWtlcyBmb3IgSW52ZXN0b3IKICAgIHN0cnVjdCBzYWxlRGF0YSB7CiAgICAgIHVpbnQgc3Rha2VzOyAvLyBob3cgbWFueSBTdGFrZXMgd2hlcmUgcmVjaWV2ZWQgYnkgdGhpcyBJbnZlc3RvciB0b3RhbAogICAgICB1aW50IGludmVzdGVkOyAvLyBob3cgbXVjaCB3ZWkgdGhpcyBJbnZlc3RvciBpbnZlc3RlZCB0b3RhbAogICAgICB1aW50IGJvbnVzU3Rha2VzOyAvLyBob3cgbWFueSBib251cyBTdGFrZXMgd2hlcmUgcmVjaWV2ZWQgYnkgdGhpcyBJbnZlc3RvcgogICAgICB1aW50IGd1aWRlUmV3YXJkOyAvLyBJbnZlc3RtZW50IEd1aWRlIHJld2FyZCBhbW91bnQKICAgICAgYWRkcmVzcyBndWlkZTsgLy8gYWRkcmVzcyBvZiBJbnZlc3RtZW50IEd1aWRlCiAgICB9CiAgICBtYXBwaW5nIChhZGRyZXNzPT5zYWxlRGF0YSkgcHVibGljIHNhbGVTdGF0OyAvLyBpbnZlc3RlZCB2YWx1ZSArIFN0YWtlcyBkYXRhIGZvciBldmVyeSBJbnZlc3RvciAgICAgICAgCiAgICB1aW50IHB1YmxpYyBzYWxlU3RhcnRUaW1lc3RhbXAgPSAxNTI0ODUyMDAwOyAvLyByZWd1bGFyIFN0YWtlcyBzYWxlIHN0YXJ0IGRhdGUgICAgICAgICAgICAKICAgIHVpbnQgcHVibGljIHNhbGVFbmRUaW1lc3RhbXAgPSAxNTI3NDQ0MDAwOyAKICAgIHVpbnQgcHVibGljIGRpc3RyaWJ1dGVkU2FsZVN0YWtlczsgLy8gZGlzdHJpYnV0ZWQgc3Rha2VzIHRvIGFsbCBJbnZlc3RvcnMKICAgIHVpbnQgcHVibGljIHRvdGFsSW52ZXN0ZWQ7IC8vaG93IG1hbnkgaW52ZXN0ZWQgdG90YWwKICAgIHVpbnQgcHVibGljIHRvdGFsV2l0aGRyYXduOyAvL2hvdyBtYW55IHdpdGhkcmF3biB0b3RhbAogICAgdWludCBwdWJsaWMgc2FsZUNhcDsgLy8gcmVndWxhciBzYWxlIFN0YWtlcyBjYXBhY2l0eSAgIAogICAgdWludDggcHVibGljIHNhbGVTaGFyZSA9IDIwOyAvLyBzaGFyZSBmb3IgcmVndWxhciBzYWxlCiAgICB1aW50IHB1YmxpYyBsYXN0U3Rha2VQcmljZVVTQ2VudHM7IC8vIFN0YWtlIHByaWNlIGluIFUuUy4gY2VudHMgaXMgZGV0ZXJtaW5lZCBhY2NvcmRpbmcgdG8gY3VycmVudCB0aW1lc3RhbXAgKHRoZSBmdXJ0aGVyIC0gdGhlIGhpZ2hlciBwcmljZSkgICAgCiAgICB1aW50W10gcHVibGljIHRhcmdldFByaWNlOyAgICAKICAgIGJvb2wgcHVibGljIHByaWNlSXNGcm96ZW4gPSBmYWxzZTsgLy8gc3RvcCBpbmNyZWFzaW5nIHRoZSBwcmljZSB0ZW1wb3JhcnkgKGluIGNhc2Ugb2YgbG93IGRlbWFuZC4gQ2FuIGJlIGNhbGxlZCBvbmx5IGFmdGVyIHNhbGVFbmRUaW1lc3RhbXApICAgICAgIAogICAgCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogCiAqIEJvbnVzIFN0YWtlcyAmIEludmVzdG1lbnQgR3VpZGVzICoKICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8gICAgCiAgICAvLyBkYXRhIHRvIHN0b3JlIEludmVzdG1lbnQgR3VpZGUgcmV3YXJkCiAgICBzdHJ1Y3QgZ3VpZGVEYXRhIHsKICAgICAgYm9vbCByZWdpc3RlcmVkOyAvLyBpcyB0aGlzIEludmVzdG1lbnQgR3VpZGUgcmVnaXN0ZXJlZAogICAgICB1aW50IGFjY3VtdWxhdGVkUG90ZW50aWFsUmV3YXJkOyAvLyBob3cgbWFueSByZXdhcmQgd2VpIGFyZSBwb3RlbnRpYWxseSBhdmFpbGFibGUKICAgICAgdWludCByZXdhcmRUb1dpdGhkcmF3OyAvLyBhdmFpbGFiZSByZXdhcmQgdG8gd2l0aGRyYXcgbm93CiAgICAgIHVpbnQgcGVyaW9kaWNhbGx5V2l0aGRyYXduUmV3YXJkOyAvLyBob3cgbXVjaCByZXdhcmQgd2VpIHdoZXJlIHdpdGhkcmF3biBieSB0aGlzIEludmVzdG1lbnQgR3VpZGUgYWxyZWFkeQogICAgfQogICAgbWFwcGluZyAoYWRkcmVzcz0+Z3VpZGVEYXRhKSBwdWJsaWMgZ3VpZGVzU3RhdDsgLy8gbWFwcGluZyBvZiBJbnZlc3RtZW50IEd1aWRlcyBkYXRhcyAgICAKICAgIHVpbnQgcHVibGljIGJvbnVzQ2FwOyAvLyBtYXggYW1vdW50IG9mIGJvbnVzIFN0YWtlcyBhdmFpbGFiZQogICAgdWludCBwdWJsaWMgZGlzdHJpYnV0ZWRCb251c1N0YWtlczsgLy8gaG93IG1hbnkgYm9udXMgU3Rha2VzIGFyZSBhbHJlYWR5IGRpc3RyaWJ1dGVkCiAgICB1aW50IHB1YmxpYyBib251c1NoYXJlID0gMTsgLy8gc2hhcmUgb2YgYm9udXMgU3Rha2VzIGluIHN1cHBseUNhcAogICAgdWludDggcHVibGljIGd1aWRlSW52ZXN0bWVudEF0dHJhY3RlZFNoYXJlVG9QYXkgPSAxMDsgLy8gcmV3YXJkIGZvciB0aGUgSW52ZXN0bWVudCBHdWlkZQoKLyoKICBXQU5UIFRPIEVBUk4gT04gU1RBS0VTIFNBTEUgPwogIEJFQ09NRSBJTlZFU1RNRU5UIEdVSURFIEFORCBSRUNJRVZFIDEwJSBPRiBBVFRSQUNURUQgSU5WRVNUTUVOVCAhCiAgSU5UUk9EVUNFIFlPVVJTRUxGIE9OIDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNTAxNjA1MWUxNDExMDIxOTExN2UxMzFmMWQxMDE3MWQxMTE5MWM3ZTEzMWYxZCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvc3Bhbj4gJiBHSVZFIFlPVVIgV0FMTEVUIEFERFJFU1MKKi8gICAgCgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIAogKiBUbyBQb29sIHRyYW5zZmVycyAmIEludmVzdG1lbnQgd2l0aGRyYXdhbCAqCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgdWludDggcHVibGljIGZpbmFuY2VQZXJpb2RzQ291bnQgPSA2OyAvLyBIb3cgbWFueSBmaW5hbmNlIHBlcmlvZHMgaW4gcGxhbm5lZCBwZXJpb2QKICAgIHVpbnRbXSBwdWJsaWMgZmluYW5jZVBlcmlvZHNUaW1lc3RhbXBzOyAvLyBTdXBwb3J0aXZlIGFycmF5IGZvciBzZWFyY2hpbmcgY3VycmVudCBmaW5hbmNlIHBlcmlvZAogICAgdWludCBwdWJsaWMgdHJhbnNmZXJlZFRvUG9vbDsgLy8gaG93IG11Y2ggd2VpIHRyYW5zZmVyZWQgdG8gcG9vbCBhbHJlYWR5CgovKiBFVkVOVFMgKi8KCiAgICBldmVudCBTdGFrZXNTYWxlKGFkZHJlc3MgdG8sIHVpbnQgd2VpSW52ZXN0ZWQsIHVpbnQgc3Rha2VzUmVjaWV2ZWQsIHVpbnQgdGVhbVN0YWtlc1JlY2lldmVkLCB1aW50IHN0YWtlX3ByaWNlX3VzX2NlbnRzKTsKICAgIGV2ZW50IEJvdW50eURpc3RyaWJ1dGVkKGFkZHJlc3MgdG8sIHVpbnQgYm91bnR5U3Rha2VzKTsKICAgIGV2ZW50IFRyYW5zZmVyZWRUb1Bvb2wodWludCB3ZWlBbW91bnQsIHVpbnQ4IGN1cnJlbnRGaW5hbmNpYWxQZXJpb2RObyk7CiAgICBldmVudCBJbnZlc3RtZW50V2l0aGRyYXduKGFkZHJlc3MgdG8sIHVpbnQgd2l0aGRyYXduV2VpQW1vdW50LCB1aW50IHN0YWtlc0J1cm5lZCwgdWludDggcmVtYWluZWRGdWxsRmluYW5jaWFsUGVyaW9kcyk7CiAgICBldmVudCBVc2RQZXJFdGhlckNoYW5nZWQodWludCBvbGRVc2RQZXJFdGhlciwgdWludCBuZXdVc2RQZXJFdGhlcik7CiAgICBldmVudCBCb251c0Rpc3RyaWJ1dGVkKGFkZHJlc3MgdG8sIHVpbnQgYm9udXNTdGFrZXMsIGFkZHJlc3MgZ3VpZGUsIHVpbnQgYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQpOwogICAgZXZlbnQgUG9vbENhcENoYW5nZWQodWludCBvbGRDYXBVU0QsIHVpbnQgbmV3Q2FwVVNEKTsKICAgIGV2ZW50IFJlZ2lzdGVyR3VpZGUoYWRkcmVzcyBpbnZlc3RtZW50R3VpZGUpOwogICAgZXZlbnQgVGFyZ2V0UHJpY2VDaGFuZ2VkKHVpbnQ4IE4sIHVpbnQgb2xkVGFyZ2V0UHJpY2UsIHVpbnQgbmV3VGFyZ2V0UHJpY2UpOwogICAgZXZlbnQgSW52ZXN0bWVudEd1aWRlV2l0aGRyYXdSZXdhcmQoYWRkcmVzcyBpbnZlc3RtZW50R3VpZGUsIHVpbnQgd2l0aGRyYXduUmV3YXJkV2VpKTsKICAgIAogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PW93bmVyKTsKICAgICAgXzsKICAgIH0KICAvKioKICAgKiBAZGV2IERldGVybWluZSBkdXJhdGlvbiBvZiBmaW5hbmNlIHBlcmlvZCwgZmlsbCBhcnJheSB3aXRoIGZpbmFuY2UgcGVyaW9kcyB0aW1lc3RhbXBzLAogICAqICAgICAgc2V0IGJ1c2luZXNzUGxhbm5lZFBlcmlvZEVuZFRpbWVzdGFtcCBhbmQgY29udHJhY3RDcmVhdGVkVGltZXN0YW1wLCAgICAKICAgKi8gICAgICAKICAgIGZ1bmN0aW9uIFNhbGUoKSBwdWJsaWMgeyAgICAgCiAgICAgIHVpbnQgZmluYW5jZVBlcmlvZER1cmF0aW9uID0gYnVzaW5lc3NQbGFubmVkUGVyaW9kRHVyYXRpb24vZmluYW5jZVBlcmlvZHNDb3VudDsgLy8gcXVhbnRpdHkgb2Ygc2Vjb25kcyBpbiBjaG9zZW4gZmluYW5jZSBwZXJpb2QKICAgICAgLy8gbWFraW5nIGFycmF5IHdpdGggdGltZXN0YW1wcyBvZiBldmVyeSBmaW5hbmNlIHBlcmlvZCBlbmQgZGF0ZQogICAgICBmaW5hbmNlUGVyaW9kc1RpbWVzdGFtcHMucHVzaChzYWxlRW5kVGltZXN0YW1wKTsgLy8gZmlyc3QgZmluYW5jZSBwZXJpb2QgaXMgd2hvbGUgc2FsZSBwZXJpb2QKICAgICAgZm9yKHVpbnQ4IGk9MTsgaTw9ZmluYW5jZVBlcmlvZHNDb3VudDsgaSsrKSB7CiAgICAgICAgZmluYW5jZVBlcmlvZHNUaW1lc3RhbXBzLnB1c2goc2FsZUVuZFRpbWVzdGFtcCtmaW5hbmNlUGVyaW9kRHVyYXRpb24qaSk7ICAKICAgICAgfQogICAgICBidXNpbmVzc1BsYW5uZWRQZXJpb2RFbmRUaW1lc3RhbXAgPSBzYWxlRW5kVGltZXN0YW1wK2J1c2luZXNzUGxhbm5lZFBlcmlvZER1cmF0aW9uOyAKICAgICAgY29udHJhY3RDcmVhdGVkVGltZXN0YW1wID0gbm93OwogICAgICB0YXJnZXRQcmljZS5wdXNoKDEpOyAvLyBJbml0aWFsIFN0YWtlIHByaWNlIG1hcmsgaW4gVS5TLiBjZW50cyAoMSBjZW50ID0gJDAuMDEpICAKICAgICAgdGFyZ2V0UHJpY2UucHVzaCgxMCk7IC8vIHByaWNlIG1hcmsgYXQgdGhlIHNhbGUgcGVyaW9kIHN0YXJ0IHRpbWVzdGFtcCAgICAgIAogICAgICB0YXJnZXRQcmljZS5wdXNoKDEwMCk7IC8vIHByaWNlIG1hcmsgYXQgdGhlIHNhbGUgcGVyaW9kIGVuZCB0aW1lc3RhbXAgICAgICAgCiAgICAgIHRhcmdldFByaWNlLnB1c2goMTAwMCk7IC8vIHByaWNlIG1hcmsgYXQgdGhlIGVuZCBvZiBidXNpbmVzcyBwbGFubmVkIHBlcmlvZAogICAgICBiYWxhbmNlc1tzdXBwbGllcl0gPSAwOyAvLyBudWxsaWZ5IFN0YWtlcyBmb3JtYWwgc3VwcGxpZXIgYmFsYW5jZSAgICAgICAgIAogICAgfQogIC8qKgogICAqIEBkZXYgSG93IG1hbnkgaW52ZXN0bWVudCByZW1haW5lZD8gTWF4aW11bSBpbnZlc3RtZW50IGlzIHBvb2xDYXBVU0QKICAgKiBAcmV0dXJuIHJlbWFpbmluZ0ludmVzdG1lbnQgaW4gd2VpICAgCiAgICovICAgICAKICAgIGZ1bmN0aW9uIHJlbWFpbmluZ0ludmVzdG1lbnQoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgcmV0dXJuIHBvb2xDYXBVU0QuZGl2KHVzZFBlckV0aGVyKS5tdWwoMSBldGhlcikuc3ViKHRvdGFsSW52ZXN0ZWQpOyAgCiAgICB9CiAgLyoqCiAgICogQGRldiBEeW5hbWljYWxseSBzZXQgY2FwcwogICAqLyAgICAgICAKICAgIGZ1bmN0aW9uIHNldENhcHMoKSBpbnRlcm5hbCB7CiAgICAgIC8vIHJlbWFpbmluZyBTdGFrZXMgYXJlIGRldGVybWluZWQgb25seSBmcm9tIHJlbWFpbmluZ0ludmVzdG1lbnQKICAgICAgc2FsZUNhcCA9IGRpc3RyaWJ1dGVkU2FsZVN0YWtlcytzdGFrZUZvcldlaShyZW1haW5pbmdJbnZlc3RtZW50KCkpOyAvLyBtYXggYXZhaWxhYmxlIFN0YWtlcyBmb3Igc2FsZSBpbmNsdWRpbmcgYWxyZWFkeSBkaXN0cmlidXRlZAogICAgICBzdXBwbHlDYXAgPSBzYWxlQ2FwLm11bCgxMDApLmRpdihzYWxlU2hhcmUpOyAvLyBtYXggYXZhaWxhYmxlIFN0YWtlcyBmb3Igc3VwcGx5aW5nCiAgICAgIHRlYW1DYXAgPSBzdXBwbHlDYXAubXVsKHRlYW1TaGFyZSkuZGl2KDEwMCk7IC8vIG1heCBhdmFpbGFibGUgdGVhbSBTdGFrZXMKICAgICAgZnVuZGFyaWFDYXAgPSBzdXBwbHlDYXAubXVsKGZ1bmRhcmlhU2hhcmUpLmRpdigxMDApOyAvLyBtYXggYXZhaWxhYmxlIHRlYW0gU3Rha2VzCiAgICAgIGJvbnVzQ2FwID0gc3VwcGx5Q2FwLm11bChib251c1NoYXJlKS5kaXYoMTAwKTsgLy8gbWF4IGF2YWlsYWJsZSBTdGFrZXMgZm9yIGJvbnVzCiAgICAgIGJvdW50eUNhcCA9IHN1cHBseUNhcC5zdWIoc2FsZUNhcCkuc3ViKHRlYW1DYXApLnN1Yihib251c0NhcCk7IC8vIG1heCBhdmFpbGFibGUgU3Rha2VzIGZvciBib3VudHkgICAgICAgIAogICAgfQogIC8qKgogICAqIEBkZXYgRHluYW1pY2FsbHkgc2V0IHRoZSBwcmljZSBvZiBTdGFrZSBpbiBVU0QgY2VudHMsIHdoaWNoIGRlcGVuZHMgb24gY3VycmVudCB0aW1lc3RhbXAgKHByaWNlIGdyb3dzIHdpdGggdGltZSkKICAgKi8gICAgICAgCiAgICBmdW5jdGlvbiBzZXRTdGFrZVByaWNlVVNDZW50cygpIGludGVybmFsIHsKICAgICAgICB1aW50IHRhcmdldFByaWNlRnJvbTsKICAgICAgICB1aW50IHRhcmdldFByaWNlVG87CiAgICAgICAgdWludCBzdGFydFRpbWVzdGFtcDsKICAgICAgICB1aW50IGVuZFRpbWVzdGFtcDsKICAgICAgLy8gc2V0IHByaWNlIGZvciBwcmUgc2FsZSBwZXJpb2QgICAgICAKICAgICAgaWYobm93IDwgc2FsZVN0YXJ0VGltZXN0YW1wKSB7CiAgICAgICAgdGFyZ2V0UHJpY2VGcm9tID0gdGFyZ2V0UHJpY2VbMF07CiAgICAgICAgdGFyZ2V0UHJpY2VUbyA9IHRhcmdldFByaWNlWzFdOwogICAgICAgIHN0YXJ0VGltZXN0YW1wID0gY29udHJhY3RDcmVhdGVkVGltZXN0YW1wOwogICAgICAgIGVuZFRpbWVzdGFtcCA9IHNhbGVTdGFydFRpbWVzdGFtcDsgICAgICAgIAogICAgICAvLyBzZXQgcHJpY2UgZm9yIHNhbGUgcGVyaW9kCiAgICAgIH0gZWxzZSBpZihub3cgPj0gc2FsZVN0YXJ0VGltZXN0YW1wICYmIG5vdyA8IHNhbGVFbmRUaW1lc3RhbXApIHsKICAgICAgICB0YXJnZXRQcmljZUZyb20gPSB0YXJnZXRQcmljZVsxXTsKICAgICAgICB0YXJnZXRQcmljZVRvID0gdGFyZ2V0UHJpY2VbMl07CiAgICAgICAgc3RhcnRUaW1lc3RhbXAgPSBzYWxlU3RhcnRUaW1lc3RhbXA7CiAgICAgICAgZW5kVGltZXN0YW1wID0gc2FsZUVuZFRpbWVzdGFtcDsgICAgCiAgICAgIC8vIHNldCBwcmljZSBmb3IgcG9zdCBzYWxlIHBlcmlvZAogICAgICB9IGVsc2UgaWYobm93ID49IHNhbGVFbmRUaW1lc3RhbXAgJiYgbm93IDwgYnVzaW5lc3NQbGFubmVkUGVyaW9kRW5kVGltZXN0YW1wKSB7CiAgICAgICAgdGFyZ2V0UHJpY2VGcm9tID0gdGFyZ2V0UHJpY2VbMl07CiAgICAgICAgdGFyZ2V0UHJpY2VUbyA9IHRhcmdldFByaWNlWzNdOwogICAgICAgIHN0YXJ0VGltZXN0YW1wID0gc2FsZUVuZFRpbWVzdGFtcDsKICAgICAgICBlbmRUaW1lc3RhbXAgPSBidXNpbmVzc1BsYW5uZWRQZXJpb2RFbmRUaW1lc3RhbXA7ICAgIAogICAgICB9ICAgICAKICAgICAgbGFzdFN0YWtlUHJpY2VVU0NlbnRzID0gdGFyZ2V0UHJpY2VGcm9tICsgKChub3ctc3RhcnRUaW1lc3RhbXApKih0YXJnZXRQcmljZVRvLXRhcmdldFByaWNlRnJvbSkpLyhlbmRUaW1lc3RhbXAtc3RhcnRUaW1lc3RhbXApOyAgICAgICAKICAgIH0gIAogIC8qKgogICAqIEBkZXYgUmVjaWV2ZSB3ZWkgYW5kIHByb2Nlc3MgU3Rha2VzIHNhbGUKICAgKi8gICAgCiAgICBmdW5jdGlvbigpIHBheWFibGUgcHVibGljIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOyAvLyBwcm9jZXNzIG9ubHkgcmVxdWVzdHMgd2l0aCB3ZWkKICAgICAgcmVxdWlyZShub3cgPCBidXNpbmVzc1BsYW5uZWRQZXJpb2RFbmRUaW1lc3RhbXApOyAvLyBubyBsYXRlciB0aGVuIGF0IHRoZSBlbmQgb2YgcGxhbm5lZCBwZXJpb2QKICAgICAgcHJvY2Vzc1NhbGUoKTsgICAgICAgCiAgICB9CiAgLyoqCiAgICogQGRldiBQcm9jZXNzIFN0YWtlcyBzYWxlCiAgICovICAgICAgIAogICAgZnVuY3Rpb24gcHJvY2Vzc1NhbGUoKSBpbnRlcm5hbCB7CiAgICAgIGlmKCFwcmljZUlzRnJvemVuKSB7IC8vIHJlZnJlc2ggcHJpY2Ugb25seSBpZiBwcmljZSBpcyBub3QgZnJvemVuCiAgICAgICAgc2V0U3Rha2VQcmljZVVTQ2VudHMoKTsKICAgICAgfQogICAgICBzZXRDYXBzKCk7ICAgIAoKICAgICAgICB1aW50IHRlYW1TdGFrZXM7IC8vIFN0YWtlcyBmb3IgdGhlIHRlYW0gYWNjb3JkaW5nIHRvIHRlYW1TaGFyZQogICAgICAgIHVpbnQgZnVuZGFyaWFTdGFrZXM7IC8vIFN0YWtlcyBmb3IgdGhlIEZ1bmRhcmlhIGFjY29yZGluZyB0byB0ZWFtU2hhcmUKICAgICAgICB1aW50IHNhbGVTdGFrZXM7IC8vIFN0YWtlcyBmb3IgdGhlIFNhbGUKICAgICAgICB1aW50IHdlaUludmVzdGVkOyAvLyB3ZWlJbnZlc3RlZCBub3cgYnkgdGhpcyBJbnZlc3RvcgogICAgICAgIHVpbnQgdHJ5U2FsZVN0YWtlcyA9IHN0YWtlRm9yV2VpKG1zZy52YWx1ZSk7IC8vIHRyeSB0byBnZXQgdGhpcyBxdWFudGl0eSBvZiBTdGFrZXMKCiAgICAgIGlmKHRyeVNhbGVTdGFrZXMgPiAxKSB7CiAgICAgICAgdWludCB0cnlEaXN0cmlidXRlID0gZGlzdHJpYnV0ZWRTYWxlU3Rha2VzK3RyeVNhbGVTdGFrZXM7IC8vIHRyeSB0byBkaXN0cmlidXRlIHRoaXMgdHJ5U3Rha2VzICAgICAgICAKICAgICAgICBpZih0cnlEaXN0cmlidXRlIDw9IHNhbGVDYXApIHsgLy8gc2FsZUNhcCBub3QgcmVhY2hlZAogICAgICAgICAgc2FsZVN0YWtlcyA9IHRyeVNhbGVTdGFrZXM7IC8vIGFsbCB0cnlTdGFrZXMgY2FuIGJlIHNvbGQKICAgICAgICAgIHdlaUludmVzdGVkID0gbXNnLnZhbHVlOyAvLyBhbGwgY3VycmVudCB3ZWkgYXJlIGFjY2VwdGVkICAgICAgICAgICAgICAgICAgICAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2FsZVN0YWtlcyA9IHNhbGVDYXAtZGlzdHJpYnV0ZWRTYWxlU3Rha2VzOyAvLyBvbmx5IHJlbW5hbnQgb2YgU3Rha2VzIGFyZSBhdmFpbGFibGUKICAgICAgICAgIHdlaUludmVzdGVkID0gd2VpRm9yU3Rha2Uoc2FsZVN0YWtlcyk7IC8vIHdlaSBmb3IgYXZhaWxhYmxlIHJlbW5hbnQgb2YgU3Rha2VzIAogICAgICAgIH0KICAgICAgICB0ZWFtU3Rha2VzID0gKHNhbGVTdGFrZXMqdGVhbVNoYXJlKS5kaXYoc2FsZVNoYXJlKTsgLy8gcGFydCBvZiBTdGFrZXMgZm9yIGEgdGVhbQogICAgICAgIGZ1bmRhcmlhU3Rha2VzID0gKHNhbGVTdGFrZXMqZnVuZGFyaWFTaGFyZSkuZGl2KHNhbGVTaGFyZSk7IC8vIHBhcnQgb2YgU3Rha2VzIGZvciBhIHRlYW0gICAgICAgIAogICAgICAgIGlmKHNhbGVTdGFrZXMgPiAwKSB7ICAgICAgICAgIAogICAgICAgICAgYmFsYW5jZXNbb3duZXJdICs9IHRlYW1TdGFrZXM7IC8vIHJld2FyZGluZyB0ZWFtIGFjY29yZGluZyB0byB0ZWFtU2hhcmUKICAgICAgICAgIHRvdGFsU3VwcGx5ICs9IHRlYW1TdGFrZXM7IC8vIHN1cHBseWluZyB0ZWFtIFN0YWtlcwogICAgICAgICAgZGlzdHJpYnV0ZWRUZWFtU3Rha2VzICs9IHRlYW1TdGFrZXM7IC8vIHNhdmluZyBkaXN0cmlidXRlZCB0ZWFtIFN0YWtlcwogICAgICAgICAgVHJhbnNmZXIoc3VwcGxpZXIsIG93bmVyLCB0ZWFtU3Rha2VzKTsgICAgICAgICAKICAgICAgICAgIGJhbGFuY2VzW2Z1bmRhcmlhXSArPSBmdW5kYXJpYVN0YWtlczsgLy8gcmV3YXJkaW5nIHRlYW0gYWNjb3JkaW5nIHRvIGZ1bmRhcmlhU2hhcmUKICAgICAgICAgIHRvdGFsU3VwcGx5ICs9IGZ1bmRhcmlhU3Rha2VzOyAvLyBzdXBwbHlpbmcgRnVuZGFyaWEgU3Rha2VzCiAgICAgICAgICBkaXN0cmlidXRlZEZ1bmRhcmlhU3Rha2VzICs9IGZ1bmRhcmlhU3Rha2VzOyAvLyBzYXZpbmcgZGlzdHJpYnV0ZWQgdGVhbSBTdGFrZXMKICAgICAgICAgIFRyYW5zZmVyKHN1cHBsaWVyLCBmdW5kYXJpYSwgZnVuZGFyaWFTdGFrZXMpOyAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgc2FsZVN1cHBseShtc2cuc2VuZGVyLCBzYWxlU3Rha2VzLCB3ZWlJbnZlc3RlZCk7IC8vIHByb2Nlc3Mgc2FsZVN1cHBseQogICAgICAgICAgaWYoc2FsZVN0YXRbbXNnLnNlbmRlcl0uZ3VpZGUgIT0gYWRkcmVzcygwKSkgeyAvLyB3ZSBoYXZlIEludmVzdG1lbnQgR3VpZGUgdG8gcmV3YXJkIGFuZCBkaXN0cmlidXRlIGJvbnVzIFN0YWtlcwogICAgICAgICAgICBkaXN0cmlidXRlQm9udXNTdGFrZXMobXNnLnNlbmRlciwgc2FsZVN0YWtlcywgd2VpSW52ZXN0ZWQpOyAgCiAgICAgICAgICB9ICAgICAgICAgIAogICAgICAgIH0gICAgICAgIAogICAgICAgIGlmKHRyeURpc3RyaWJ1dGUgPiBzYWxlQ2FwKSB7CiAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZS13ZWlJbnZlc3RlZCk7IC8vIHJldHVybiByZW1uYW50CiAgICAgICAgfSAgICAgICAgCiAgICAgIH0gZWxzZSB7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOyAvLyByZXR1cm4gaW5jb3JyZWN0IHdlaQogICAgICB9CiAgICB9CiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciBTdGFrZXMgZnJvbSBvd25lciBiYWxhbmNlIHRvIGJ1eWVyIGJhbGFuY2UgJiBzYXZpbmcgZGF0YSB0byBzYWxlU3RhdCBzdG9yYWdlCiAgICogQHBhcmFtIF90byBpcyBhZGRyZXNzIG9mIGJ1eWVyIAogICAqIEBwYXJhbSBfc3Rha2VzIGlzIHF1YW50aXR5IG9mIFN0YWtlcyB0cmFuc2ZlcmVkIAogICAqIEBwYXJhbSBfd2VpIGlzIHZhbHVlIGludmVzdGVkICAgICAgICAKICAgKi8gCiAgICBmdW5jdGlvbiBzYWxlU3VwcGx5KGFkZHJlc3MgX3RvLCB1aW50IF9zdGFrZXMsIHVpbnQgX3dlaSkgaW50ZXJuYWwgewogICAgICByZXF1aXJlKF9zdGFrZXMgPiAwKTsgIAogICAgICBiYWxhbmNlc1tfdG9dICs9IF9zdGFrZXM7IC8vIHN1cHBseSBzb2xkIFN0YWtlcyBkaXJlY3RseSB0byBidXllcgogICAgICB0b3RhbFN1cHBseSArPSBfc3Rha2VzOwogICAgICBkaXN0cmlidXRlZFNhbGVTdGFrZXMgKz0gX3N0YWtlczsKICAgICAgdG90YWxJbnZlc3RlZCA9IHRvdGFsSW52ZXN0ZWQuYWRkKF93ZWkpOyAvLyBhZGRpbmcgdG8gdG90YWwgaW52ZXN0bWVudAogICAgICAvLyBzYXZpbmcgc3RhdAogICAgICBzYWxlU3RhdFtfdG9dLnN0YWtlcyArPSBfc3Rha2VzOyAvLyBzdGF0aW5nIFN0YWtlcyBib3VnaHQgICAgICAgCiAgICAgIHNhbGVTdGF0W190b10uaW52ZXN0ZWQgPSBzYWxlU3RhdFtfdG9dLmludmVzdGVkLmFkZChfd2VpKTsgLy8gc3RhdGluZyB3ZWkgaW52ZXN0ZWQKICAgICAgVHJhbnNmZXIoc3VwcGxpZXIsIF90bywgX3N0YWtlcyk7CiAgICB9ICAgICAgCiAgLyoqCiAgICogQGRldiBTZXQgbmV3IG93bmVyCiAgICogQHBhcmFtIG5ld19vd25lciBuZXcgb3duZXIgIAogICAqLyAgICAKICAgIGZ1bmN0aW9uIHNldE5ld093bmVyKGFkZHJlc3MgbmV3X293bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgb3duZXIgPSBuZXdfb3duZXI7IAogICAgfQogIC8qKgogICAqIEBkZXYgU2V0IG5ldyBGdW5kYXJpYSBhZGRyZXNzCiAgICogQHBhcmFtIG5ld19mdW5kYXJpYSBuZXcgZnVuZGFyaWEgIAogICAqLyAgICAKICAgIGZ1bmN0aW9uIHNldE5ld0Z1bmRhcmlhKGFkZHJlc3MgbmV3X2Z1bmRhcmlhKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgZnVuZGFyaWEgPSBuZXdfZnVuZGFyaWE7IAogICAgfSAgICAKICAvKioKICAgKiBAZGV2IFNldCBuZXcgZXRoZXIgcHJpY2UgaW4gVVNELiBTaG91bGQgYmUgY2hhbmdlZCB3aGVuIHByaWNlIGdyb3ctZmFsbCA1JS0xMCUKICAgKiBAcGFyYW0gbmV3X3VzZF9wZXJfZXRoZXIgbmV3IHByaWNlICAKICAgKi8gICAgCiAgICBmdW5jdGlvbiBzZXRVc2RQZXJFdGhlcih1aW50IG5ld191c2RfcGVyX2V0aGVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgVXNkUGVyRXRoZXJDaGFuZ2VkKHVzZFBlckV0aGVyLCBuZXdfdXNkX3Blcl9ldGhlcik7CiAgICAgIHVzZFBlckV0aGVyID0gbmV3X3VzZF9wZXJfZXRoZXI7IAogICAgfQogIC8qKgogICAqIEBkZXYgU2V0IGFkZHJlc3Mgb2Ygd2FsbGV0IHdoZXJlIGludmVzdG1lbnQgd2lsbCBiZSB0cmFuc2ZlcmVkIGZvciBmdXJ0aGVyIHVzaW5nIGluIGJ1c2luZXNzIHRyYW5zYWN0aW9ucwogICAqIEBwYXJhbSBfcG9vbCBuZXcgYWRkcmVzcyBvZiB0aGUgUG9vbCAgIAogICAqLyAgICAgICAgIAogICAgZnVuY3Rpb24gc2V0UG9vbEFkZHJlc3MoYWRkcmVzcyBfcG9vbCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgIHBvb2wgPSBfcG9vbDsgIAogICAgfQogIC8qKgogICAqIEBkZXYgQ2hhbmdlIFBvb2wgY2FwYWNpdHkgaW4gVVNECiAgICogQHBhcmFtIG5ld19wb29sX2NhcF91c2QgbmV3IFBvb2wgY2FwIGluICQgICAKICAgKi8gICAgCiAgICBmdW5jdGlvbiBzZXRQb29sQ2FwVVNEKHVpbnQgbmV3X3Bvb2xfY2FwX3VzZCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgIFBvb2xDYXBDaGFuZ2VkKHBvb2xDYXBVU0QsIG5ld19wb29sX2NhcF91c2QpOwogICAgICBwb29sQ2FwVVNEID0gbmV3X3Bvb2xfY2FwX3VzZDsgCiAgICB9CiAgLyoqCiAgICogQGRldiBSZWdpc3RlciBJbnZlc3RtZW50IEd1aWRlCiAgICogQHBhcmFtIGludmVzdG1lbnRfZ3VpZGUgYWRkcmVzcyBvZiBJbnZlc3RtZW50IEd1aWRlICAgCiAgICovICAgICAKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyR3VpZGUoYWRkcmVzcyBpbnZlc3RtZW50X2d1aWRlKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgZ3VpZGVzU3RhdFtpbnZlc3RtZW50X2d1aWRlXS5yZWdpc3RlcmVkID0gdHJ1ZTsKICAgICAgUmVnaXN0ZXJHdWlkZShpbnZlc3RtZW50X2d1aWRlKTsKICAgIH0KICAvKioKICAgKiBAZGV2IFN0b3AgaW5jcmVhc2luZyBwcmljZSBkeW5hbWljYWxseS4gU2V0IGl0IGFzIHN0YXRpYyB0ZW1wb3JhcnkuIAogICAqLyAgIAogICAgZnVuY3Rpb24gZnJlZXplUHJpY2UoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgcHJpY2VJc0Zyb3plbiA9IHRydWU7IAogICAgfQogIC8qKgogICAqIEBkZXYgQ29udGludWUgaW5jcmVhc2luZyBwcmljZSBkeW5hbWljYWxseSAodGhlIHN0YW5kYXJkLCB1c3VhbCBhbGdvcml0aG0pLgogICAqLyAgICAgICAKICAgIGZ1bmN0aW9uIHVuZnJlZXplUHJpY2UoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgcHJpY2VJc0Zyb3plbiA9IGZhbHNlOyAvLyB0aGlzIG1lYW5zIHRoYXQgcHJpY2UgaXMgdW5mcm96ZW4gIAogICAgfQogIC8qKgogICAqIEBkZXYgQWJpbGl0eSB0byB0dW5lIGR5bmFtaWMgcHJpY2UgY2hhbmdpbmcgd2l0aCB0aW1lLgogICAqLyAgICAgICAKICAgIGZ1bmN0aW9uIHNldFRhcmdldFByaWNlKHVpbnQ4IG4sIHVpbnQgc3Rha2VfcHJpY2VfdXNfY2VudHMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICBUYXJnZXRQcmljZUNoYW5nZWQobiwgdGFyZ2V0UHJpY2Vbbl0sIHN0YWtlX3ByaWNlX3VzX2NlbnRzKTsKICAgICAgdGFyZ2V0UHJpY2Vbbl0gPSBzdGFrZV9wcmljZV91c19jZW50czsKICAgIH0gIAogIC8qKgogICAqIEBkZXYgR2V0IGFuZCBzZXQgYWRkcmVzcyBvZiBJbnZlc3RtZW50IEd1aWRlIGFuZCBkaXN0cmlidXRlIGJvbnVzIFN0YWtlcyBhbmQgR3VpZGUgcmV3YXJkCiAgICogQHBhcmFtIGtleSBhZGRyZXNzIG9mIEludmVzdG1lbnQgR3VpZGUgICAKICAgKi8gICAgIAogICAgZnVuY3Rpb24gZ2V0Qm9udXNTdGFrZXNQZXJtYW5lbnRseShhZGRyZXNzIGtleSkgcHVibGljIHsKICAgICAgcmVxdWlyZShndWlkZXNTdGF0W2tleV0ucmVnaXN0ZXJlZCk7CiAgICAgIHJlcXVpcmUoc2FsZVN0YXRbbXNnLnNlbmRlcl0uZ3VpZGUgPT0gYWRkcmVzcygwKSk7IC8vIEludmVzdG1lbnQgR3VpZGUgaXMgbm90IGFwcGxpZWQgeWV0IGZvciB0aGlzIEludmVzdG9yCiAgICAgIHNhbGVTdGF0W21zZy5zZW5kZXJdLmd1aWRlID0ga2V5OyAvLyBhcHBseSBJbnYuIEd1aWRlIAogICAgICBpZihzYWxlU3RhdFttc2cuc2VuZGVyXS5pbnZlc3RlZCA+IDApIHsgLy8gd2UgaGF2ZSBpbnZlc3RlZCB2YWx1ZSwgcHJvY2VzcyBkaXN0cmlidXRpb24gb2YgYm9udXMgU3Rha2VzIGFuZCByZXdhcmRpbmcgYSBHdWlkZSAgICAgCiAgICAgICAgZGlzdHJpYnV0ZUJvbnVzU3Rha2VzKG1zZy5zZW5kZXIsIHNhbGVTdGF0W21zZy5zZW5kZXJdLnN0YWtlcywgc2FsZVN0YXRbbXNnLnNlbmRlcl0uaW52ZXN0ZWQpOwogICAgICB9CiAgICB9CiAgLyoqCiAgICogQGRldiBEaXN0cmlidXRlIGJvbnVzIFN0YWtlcyB0byBJbnZlc3RvciBhY2NvcmRpbmcgdG8gYm9udXNTaGFyZQogICAqIEBwYXJhbSBfdG8gdG8gd2hpY2ggSW52ZXN0b3IgdG8gZGlzdHJpYnV0ZQogICAqIEBwYXJhbSBhZGRlZF9zdGFrZXMgaG93IG1hbnkgU3Rha2VzIGFyZSBhZGRlZCBieSB0aGlzIEludmVzdG9yICAgIAogICAqIEBwYXJhbSBhZGRlZF93ZWkgaG93IG11Y2ggd2VpIGFyZSBpbnZlc3RlZCBieSB0aGlzIEludmVzdG9yIAogICAqIEByZXR1cm4gd2VpIHF1YW50aXR5ICAgICAgICAKICAgKi8gICAgICAgCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlQm9udXNTdGFrZXMoYWRkcmVzcyBfdG8sIHVpbnQgYWRkZWRfc3Rha2VzLCB1aW50IGFkZGVkX3dlaSkgaW50ZXJuYWwgewogICAgICB1aW50IGFkZGVkX2JvbnVzX3N0YWtlcyA9IChhZGRlZF9zdGFrZXMqKChib251c1NoYXJlKjEwMCkuZGl2KHNhbGVTaGFyZSkpKS8xMDA7IC8vIGhvdyBtYW55IGJvbnVzIFN0YWtlcyB0byBhZGQKICAgICAgcmVxdWlyZShkaXN0cmlidXRlZEJvbnVzU3Rha2VzK2FkZGVkX2JvbnVzX3N0YWtlcyA8PSBib251c0NhcCk7IC8vIGNoZWNrIGlzIGJvbnVzIGNhcCBpcyBub3Qgb3ZlcmZsb3dlZAogICAgICB1aW50IGFkZGVkX3BvdGVudGlhbF9yZXdhcmQgPSAoYWRkZWRfd2VpKmd1aWRlSW52ZXN0bWVudEF0dHJhY3RlZFNoYXJlVG9QYXkpLzEwMDsgLy8gcmV3YXJkIGZvciB0aGUgR3VpZGUKICAgICAgaWYoIXJlamVjdGVkSW52ZXN0bWVudFdpdGhkcmF3YWxzW190b10pIHsKICAgICAgICBndWlkZXNTdGF0W3NhbGVTdGF0W190b10uZ3VpZGVdLmFjY3VtdWxhdGVkUG90ZW50aWFsUmV3YXJkICs9IGFkZGVkX3BvdGVudGlhbF9yZXdhcmQ7IC8vIHNhdmUgcG90ZW50aWFsIHJld2FyZCBmb3IgdGhlIEd1aWRlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgZ3VpZGVzU3RhdFtzYWxlU3RhdFtfdG9dLmd1aWRlXS5yZXdhcmRUb1dpdGhkcmF3ICs9IGFkZGVkX3BvdGVudGlhbF9yZXdhcmQ7IC8vIGxldCBsaW5rZWQgSW52ZXN0bWVudCBHdWlkZSB0byB3aXRoZHJhdyBhbGwgdGhpcyByZXdhcmQgICAKICAgICAgfSAgICAgIAogICAgICBzYWxlU3RhdFtfdG9dLmd1aWRlUmV3YXJkICs9IGFkZGVkX3BvdGVudGlhbF9yZXdhcmQ7IC8vIGFkZCBndWlkZVJld2FyZCB3ZWkgdmFsdWUgZm9yIHN0YXQKICAgICAgc2FsZVN0YXRbX3RvXS5ib251c1N0YWtlcyArPSBhZGRlZF9ib251c19zdGFrZXM7IC8vIGFkZCBib251c1N0YWtlcyBmb3Igc3RhdCAgICAKICAgICAgYmFsYW5jZXNbX3RvXSArPSBhZGRlZF9ib251c19zdGFrZXM7IC8vIHRyYW5zZmVyIGJvbnVzIFN0YWtlcwogICAgICBkaXN0cmlidXRlZEJvbnVzU3Rha2VzICs9IGFkZGVkX2JvbnVzX3N0YWtlczsgLy8gc2F2ZSBib251cyBTdGFrZXMgZGlzdHJpYnV0aW9uCiAgICAgIHRvdGFsU3VwcGx5ICs9IGFkZGVkX2JvbnVzX3N0YWtlczsgLy8gaW5jcmVhc2UgdG90YWxTdXBwbHkKICAgICAgQm9udXNEaXN0cmlidXRlZChfdG8sIGFkZGVkX2JvbnVzX3N0YWtlcywgc2FsZVN0YXRbX3RvXS5ndWlkZSwgYWRkZWRfcG90ZW50aWFsX3Jld2FyZCk7CiAgICAgIFRyYW5zZmVyKHN1cHBsaWVyLCBfdG8sIGFkZGVkX2JvbnVzX3N0YWtlcyk7ICAgICAgICAgIAogICAgfQogIAogIC8qCiAgICB3ZWlGb3JTdGFrZSAmIHN0YWtlRm9yV2VpIGZ1bmN0aW9ucyBzb21ldGltZXMgc2hvdyBub3QgY29ycmVjdCB0cmFuc2xhdGVkIHZhbHVlIGZyb20gZGFwcCBpbnRlcmZhY2UgKHZpZXcpIAogICAgYmVjYXVzZSBsYXN0U3Rha2VQcmljZVVTQ2VudHMgc29tZXRpbWVzIHRlbXBvcmFyeSBvdXRkYXRlZCAoaW4gdmlldyBtb2RlKQogICAgYnV0IGl0IGRvZXNuJ3QgbWVhbiB0aGF0IGV4ZWN1dGlvbiBpdHNlbGYgaXMgbm90IGNvcnJlY3QgIAogICovICAKICAKICAvKioKICAgKiBAZGV2IFRyYW5zbGF0ZSB3ZWkgdG8gU3Rha2VzCiAgICogQHBhcmFtIGlucHV0X3dlaSBpcyB3ZWkgdG8gdHJhbnNsYXRlIGludG8gc3Rha2VzLCAKICAgKiBAcmV0dXJuIFN0YWtlcyBxdWFudGl0eSAgICAgICAgCiAgICovIAogICAgZnVuY3Rpb24gc3Rha2VGb3JXZWkodWludCBpbnB1dF93ZWkpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICByZXR1cm4gKChpbnB1dF93ZWkqdXNkUGVyRXRoZXIqMTAwKS8xIGV0aGVyKS9sYXN0U3Rha2VQcmljZVVTQ2VudHM7ICAgIAogICAgfSAgCiAgLyoqCiAgICogQGRldiBUcmFuc2xhdGUgU3Rha2VzIHRvIHdlaQogICAqIEBwYXJhbSBpbnB1dF9zdGFrZSBpcyBzdGFrZXMgdG8gdHJhbnNsYXRlIGludG8gd2VpCiAgICogQHJldHVybiB3ZWkgcXVhbnRpdHkgICAgICAgIAogICAqLyAKICAgIGZ1bmN0aW9uIHdlaUZvclN0YWtlKHVpbnQgaW5wdXRfc3Rha2UpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICByZXR1cm4gKGlucHV0X3N0YWtlKmxhc3RTdGFrZVByaWNlVVNDZW50cyoxIGV0aGVyKS8odXNkUGVyRXRoZXIqMTAwKTsgICAgCiAgICB9IAogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgd2VpIGZyb20gdGhpcyBjb250cmFjdCB0byBwb29sIHdhbGxldCBwYXJ0aWFsbHkgb25seSwgCiAgICogICAgICAxKSBmb3IgZnVuZGluZyBwcm9tb3Rpb24gb2YgU3Rha2VzIHNhbGUgICAKICAgKiAgICAgIDIpIGFjY29yZGluZyB0byBzaGFyZSAoZmluYW5jZV9wZXJpb2RzX2xhc3QgKyBjdXJyZW50X2ZpbmFuY2VfcGVyaW9kKSAvIGJ1c2luZXNzX3BsYW5uZWRfcGVyaW9kCiAgICovICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXJUb1Bvb2woKSBwdWJsaWMgb25seU93bmVyIHsgICAgICAKICAgICAgdWludCBtYXhfYXZhaWxhYmxlOyAvLyBtYXhfYXZhaWxhYmxlIGZ1bmRzIGZvciB0cmFuc2ZlcmluZyB0byBwb29sICAgIAogICAgICB1aW50IGFtb3VudFRvVHJhbnNmZXI7IC8vIGFtb3VudCB0byB0cmFuc2ZlciB0byBwb29sCiAgICAgICAgLy8gc2VhcmNoIGVuZCB0aW1lc3RhbXAgb2YgY3VycmVudCBmaW5hbmNpYWwgcGVyaW9kCiAgICAgICAgZm9yKHVpbnQ4IGk9MDsgaSA8PSBmaW5hbmNlUGVyaW9kc0NvdW50OyBpKyspIHsKICAgICAgICAgIC8vIGZvdW5kIGVuZCB0aW1lc3RhbXAgb2YgY3VycmVudCBmaW5hbmNpYWwgcGVyaW9kIE9SIG5vdyBpcyBsYXRlciB0aGVuIGJ1c2luZXNzIHBsYW5uZWQgZW5kIGRhdGUgKHRyYW5zZmVyIHdlaSByZW1uYW50KQogICAgICAgICAgaWYobm93IDwgZmluYW5jZVBlcmlvZHNUaW1lc3RhbXBzW2ldIHx8IChpID09IGZpbmFuY2VQZXJpb2RzQ291bnQgJiYgbm93ID4gZmluYW5jZVBlcmlvZHNUaW1lc3RhbXBzW2ldKSkgeyAgIAogICAgICAgICAgICAvLyBhdmFpYWxiZSBvbmx5IHBhcnQgb2YgdG90YWwgdmFsdWUgb2YgdG90YWwgaW52ZXN0ZWQgZnVuZHMgd2l0aCBzdWJzdHJhY3RlZCB0b3RhbCBhbGxvd2VkIGFtb3VudCB0cmFuc2ZlcmVkCiAgICAgICAgICAgIG1heF9hdmFpbGFibGUgPSAoKGkrMSkqKHRvdGFsSW52ZXN0ZWQrdG90YWxXaXRoZHJhd24tYWxsb3dlZEFtb3VudFRyYW5zZmVyZWRUb1Bvb2xUb3RhbCkpLyhmaW5hbmNlUGVyaW9kc0NvdW50KzEpOyAKICAgICAgICAgICAgLy8gbm90IGFsbCBtYXhfYXZhaWxhYmxlIGZ1bmRzIGFyZSB0cmFuc2ZlcmVkIGF0IHRoZSBtb21lbnQgT1Igd2UgaGF2ZSBhbGxvd2VkIGFtb3VudCB0byB0cmFuc2ZlcgogICAgICAgICAgICBpZihtYXhfYXZhaWxhYmxlID4gdHJhbnNmZXJlZFRvUG9vbC1hbGxvd2VkQW1vdW50VHJhbnNmZXJlZFRvUG9vbFRvdGFsIHx8IGFsbG93ZWRBbW91bnRUb1RyYW5zZmVyVG9Qb29sID4gMCkgewogICAgICAgICAgICAgIGlmKGFsbG93ZWRBbW91bnRUb1RyYW5zZmVyVG9Qb29sID4gMCkgeyAvLyB3ZSBoYXZlIGFsbG93ZWQgYnkgSW52ZXN0b3IgKHJlamVjdGVkIHRvIHdpdGhkcmF3KSBhbW91bnQKICAgICAgICAgICAgICAgIGFtb3VudFRvVHJhbnNmZXIgPSBhbGxvd2VkQW1vdW50VG9UcmFuc2ZlclRvUG9vbDsgLy8gdG8gdHJhbnNmZXIgdGhpcyBhbGxvd2VkIGFtb3VudCAKICAgICAgICAgICAgICAgIGFsbG93ZWRBbW91bnRUcmFuc2ZlcmVkVG9Qb29sVG90YWwgKz0gYWxsb3dlZEFtb3VudFRvVHJhbnNmZXJUb1Bvb2w7IC8vIGFkZCBhbGxvd2VkIGFtb3VudCB0byB0b3RhbCBhbGxvd2VkIGFtb3VudAogICAgICAgICAgICAgICAgYWxsb3dlZEFtb3VudFRvVHJhbnNmZXJUb1Bvb2wgPSAwOyAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhbW91bnRUb1RyYW5zZmVyID0gbWF4X2F2YWlsYWJsZS10cmFuc2ZlcmVkVG9Qb29sOyAvLyBvbmx5IHJlbWFpbmVkIGFtb3VudCBpcyBhdmFpbGFibGUgdG8gdHJhbnNmZXIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYoYW1vdW50VG9UcmFuc2ZlciA+IHRoaXMuYmFsYW5jZSB8fCBub3cgPiBmaW5hbmNlUGVyaW9kc1RpbWVzdGFtcHNbaV0pIHsgLy8gcmVtYWluZWQgYW1vdW50IHRvIHRyYW5zZmVyIG1vcmUgdGhlbiBjdXJyZW50IGJhbGFuY2UKICAgICAgICAgICAgICAgIGFtb3VudFRvVHJhbnNmZXIgPSB0aGlzLmJhbGFuY2U7IC8vIGNvcnJlY3QgYW1vdW50IHRvIHRyYW5zZmVyICAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdHJhbnNmZXJlZFRvUG9vbCArPSBhbW91bnRUb1RyYW5zZmVyOyAvLyBpbmNyZWFzZSB0cmFuc2ZlcmVkIHRvIHBvb2wgYW1vdW50ICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgcG9vbC50cmFuc2ZlcihhbW91bnRUb1RyYW5zZmVyKTsgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICBUcmFuc2ZlcmVkVG9Qb29sKGFtb3VudFRvVHJhbnNmZXIsIGkrMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxsb3dlZEFtb3VudFRvVHJhbnNmZXJUb1Bvb2w9MDsKICAgICAgICAgICAgYnJlYWs7ICAgIAogICAgICAgICAgfQogICAgICAgIH0gICAgIAogICAgfSAgCiAgLyoqCiAgICogQGRldiBJbnZlc3RvciBjYW4gd2l0aGRyYXcgcGFydCBvZiBoaXMvaGVyIGludmVzdG1lbnQuCiAgICogICAgICBBIHNpemUgb2YgdGhpcyBwYXJ0IGRlcGVuZHMgb24gaG93IG1hbnkgZmluYW5jaWFsIHBlcmlvZHMgbGFzdCBhbmQgaG93IG1hbnkgcmVtYWluZWQuCiAgICogICAgICBJbnZlc3RvciBnaXZlcyBiYWNrIGFsbCBzdGFrZXMgd2hpY2ggaGUvc2hlIGdvdCBmb3IgaGlzL2hlciBpbnZlc3RtZW50LiAgICAgCiAgICovICAgICAgIAogICAgZnVuY3Rpb24gd2l0aGRyYXdJbnZlc3RtZW50KCkgcHVibGljIHsKICAgICAgcmVxdWlyZSghcmVqZWN0ZWRJbnZlc3RtZW50V2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0pOyAvLyB0aGlzIEludmVzdG9yIG5vdCByZWplY3RlZCB0byB3aXRoZHJhdyB0aGVpciBpbnZlc3RtZW50CiAgICAgIHJlcXVpcmUoc2FsZVN0YXRbbXNnLnNlbmRlcl0uc3Rha2VzID4gMCk7CiAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gc2FsZVN0YXRbbXNnLnNlbmRlcl0uc3Rha2VzK3NhbGVTdGF0W21zZy5zZW5kZXJdLmJvbnVzU3Rha2VzKTsgLy8gSW52ZXN0b3IgaGFzIG5lZWRlZCBzdGFrZXMgdG8gcmV0dXJuCiAgICAgIHVpbnQgcmVtYWluZWQ7IC8vIGFsbCBpbnZlc3RtZW50IHdoaWNoIGFyZSBhdmFpbGFibGUgdG8gd2l0aGRyYXcgYnkgYWxsIEludmVzdG9ycwogICAgICB1aW50IHRvX3dpdGhkcmF3OyAvLyBhdmFpbGFibGUgZnVuZHMgdG8gd2l0aGRyYXcgZm9yIHRoaXMgcGFydGljdWxhciBJbnZlc3RvcgogICAgICBmb3IodWludDggaT0wOyBpIDwgZmluYW5jZVBlcmlvZHNDb3VudDsgaSsrKSB7IC8vIGxhc3QgZmluLiBwZXJpb2QgaXMgbm90IGF2YWlsYWJsZQogICAgICAgIGlmKG5vdzxmaW5hbmNlUGVyaW9kc1RpbWVzdGFtcHNbaV0pIHsgLy8gZmluZCBlbmQgdGltZXN0YW1wIG9mIGN1cnJlbnQgZmluYW5jaWFsIHBlcmlvZCAgICAgICAgICAKICAgICAgICAgIHJlbWFpbmVkID0gdG90YWxJbnZlc3RlZCAtICgoaSsxKSp0b3RhbEludmVzdGVkKS8oZmluYW5jZVBlcmlvZHNDb3VudCsxKTsgLy8gcmVtYWluZWQgaW52ZXN0bWVudCB0byB3aXRoZHJhdyBieSBhbGwgSW52ZXN0b3JzIAogICAgICAgICAgdG9fd2l0aGRyYXcgPSAoc2FsZVN0YXRbbXNnLnNlbmRlcl0uaW52ZXN0ZWQqcmVtYWluZWQpL3RvdGFsSW52ZXN0ZWQ7IC8vIGludmVzdG1lbnQgdG8gd2l0aGRyYXcgYnkgdGhpcyBJbnZlc3RvcgogICAgICAgICAgdWludCBzYWxlX3N0YWtlc190b19idXJuID0gc2FsZVN0YXRbbXNnLnNlbmRlcl0uc3Rha2VzK3NhbGVTdGF0W21zZy5zZW5kZXJdLmJvbnVzU3Rha2VzOyAvLyByZXR1cm5pbmcgYWxsIFN0YWtlcyBzYXZlZCBpbiBzYWxlU3RhdFttc2cuc2VuZGVyXQogICAgICAgICAgdWludCB0ZWFtX3N0YWtlc190b19idXJuID0gKHNhbGVTdGF0W21zZy5zZW5kZXJdLnN0YWtlcyp0ZWFtU2hhcmUpL3NhbGVTaGFyZTsgLy8gYXBwcm9wcmlhdGUgaXNzdWVkIHRlYW0gU3Rha2VzIGFyZSBhbHNvIGJ1cm5lZAogICAgICAgICAgdWludCBmdW5kYXJpYV9zdGFrZXNfdG9fYnVybiA9IChzYWxlU3RhdFttc2cuc2VuZGVyXS5zdGFrZXMqZnVuZGFyaWFTaGFyZSkvc2FsZVNoYXJlOyAvLyBhcHByb3ByaWF0ZSBpc3N1ZWQgRnVuZGFyaWEgU3Rha2VzIGFyZSBhbHNvIGJ1cm5lZAogICAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gYmFsYW5jZXNbb3duZXJdLnN1Yih0ZWFtX3N0YWtlc190b19idXJuKTsgLy8gYnVybiBhcHByb3ByaWF0ZSB0ZWFtIFN0YWtlcwogICAgICAgICAgYmFsYW5jZXNbZnVuZGFyaWFdID0gYmFsYW5jZXNbZnVuZGFyaWFdLnN1YihmdW5kYXJpYV9zdGFrZXNfdG9fYnVybik7IC8vIGJ1cm4gYXBwcm9wcmlhdGUgRnVuZGFyaWEgU3Rha2VzCiAgICAgICAgICBCdXJuKG93bmVyLHRlYW1fc3Rha2VzX3RvX2J1cm4pOwogICAgICAgICAgQnVybihmdW5kYXJpYSxmdW5kYXJpYV9zdGFrZXNfdG9fYnVybik7CiAgICAgICAgICBkaXN0cmlidXRlZFRlYW1TdGFrZXMgLT0gdGVhbV9zdGFrZXNfdG9fYnVybjsgLy8gcmVtb3ZlIHRlYW0gU3Rha2VzIGZyb20gZGlzdHJpYnV0aW9uCiAgICAgICAgICBkaXN0cmlidXRlZEZ1bmRhcmlhU3Rha2VzIC09IGZ1bmRhcmlhX3N0YWtlc190b19idXJuOyAvLyByZW1vdmUgRnVuZGFyaWEgU3Rha2VzIGZyb20gZGlzdHJpYnV0aW9uICAgICAgICAgCiAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihzYWxlX3N0YWtlc190b19idXJuKTsgLy8gYnVybiBzdGFrZXMgZ290IGZvciBpbnZlc3RlZCB3ZWkKICAgICAgICAgIGRpc3RyaWJ1dGVkU2FsZVN0YWtlcyAtPSBzYWxlU3RhdFttc2cuc2VuZGVyXS5zdGFrZXM7IC8vIHJlbW92ZSB0aGVzZSBzYWxlIFN0YWtlcyBmcm9tIGRpc3RyaWJ1dGlvbiAgICAgICAgICAKICAgICAgICAgIEJ1cm4obXNnLnNlbmRlcixzYWxlX3N0YWtlc190b19idXJuKTsKICAgICAgICAgIHRvdGFsSW52ZXN0ZWQgPSB0b3RhbEludmVzdGVkLnN1Yih0b193aXRoZHJhdyk7IC8vIGRlY3JlYXNlIGludmVzdGVkIHRvdGFsIHZhbHVlCiAgICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihzYWxlX3N0YWtlc190b19idXJuKS5zdWIodGVhbV9zdGFrZXNfdG9fYnVybikuc3ViKGZ1bmRhcmlhX3N0YWtlc190b19idXJuKTsgLy8gdG90YWxTdXBwbHkgaXMgZGVjcmVhc2VkCiAgICAgICAgICBpZihzYWxlU3RhdFttc2cuc2VuZGVyXS5ndWlkZSAhPSBhZGRyZXNzKDApKSB7IC8vIHdlIGhhdmUgR3VpZGUgYW5kIGJvbnVzU3Rha2VzCiAgICAgICAgICAgIC8vIHBvdGVudGlhbCByZXdhcmQgZm9yIHRoZSBHdWlkZSBpcyBkZWNyZWFzZWQgcHJvcG9ydGlvbmFsbHkKICAgICAgICAgICAgZ3VpZGVzU3RhdFtzYWxlU3RhdFttc2cuc2VuZGVyXS5ndWlkZV0uYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQgLT0gKHNhbGVTdGF0W21zZy5zZW5kZXJdLmd1aWRlUmV3YXJkIC0gKChpKzEpKnNhbGVTdGF0W21zZy5zZW5kZXJdLmd1aWRlUmV3YXJkKS8oZmluYW5jZVBlcmlvZHNDb3VudCsxKSk7IAogICAgICAgICAgICBkaXN0cmlidXRlZEJvbnVzU3Rha2VzIC09IHNhbGVTdGF0W21zZy5zZW5kZXJdLmJvbnVzU3Rha2VzOwogICAgICAgICAgICBzYWxlU3RhdFttc2cuc2VuZGVyXS5ib251c1N0YWtlcyA9IDA7CiAgICAgICAgICAgIHNhbGVTdGF0W21zZy5zZW5kZXJdLmd1aWRlUmV3YXJkID0gMDsgICAgICAgICAgCiAgICAgICAgICB9CiAgICAgICAgICBzYWxlU3RhdFttc2cuc2VuZGVyXS5zdGFrZXMgPSAwOyAvLyBudWxsaWZ5IFN0YWtlcyByZWNpZXZlZCB2YWx1ZSAgICAgICAgICAKICAgICAgICAgIHNhbGVTdGF0W21zZy5zZW5kZXJdLmludmVzdGVkID0gMDsgLy8gbnVsbGlmeSB3ZWkgaW52ZXN0ZWQgdmFsdWUKICAgICAgICAgIHRvdGFsV2l0aGRyYXduICs9IHRvX3dpdGhkcmF3OwogICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih0b193aXRoZHJhdyk7IC8vIHdpdGRyYXcgaW52ZXN0bWVudAogICAgICAgICAgSW52ZXN0bWVudFdpdGhkcmF3bihtc2cuc2VuZGVyLCB0b193aXRoZHJhdywgc2FsZV9zdGFrZXNfdG9fYnVybiwgZmluYW5jZVBlcmlvZHNDb3VudC1pKTsgICAgICAgICAgCiAgICAgICAgICBicmVhazsgIAogICAgICAgIH0KICAgICAgfSAgICAgIAogICAgfQogIC8qKgogICAqIEBkZXYgSW52ZXN0b3IgcmVqZWN0cyB3aXRoZHJhdyBpbnZlc3RtZW50LiBUaGlzIGxldHMgSW52ZXN0bWVudCBHdWlkZSB3aXRoZHJhdyBhbGwgaGlzL2hlciByZXdhcmQgcmVsYXRlZCB0byB0aGlzIEludmVzdG9yICAgCiAgICovICAgICAKICAgIGZ1bmN0aW9uIHJlamVjdEludmVzdG1lbnRXaXRoZHJhd2FsKCkgcHVibGljIHsKICAgICAgcmVqZWN0ZWRJbnZlc3RtZW50V2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICBhZGRyZXNzIGd1aWRlID0gc2FsZVN0YXRbbXNnLnNlbmRlcl0uZ3VpZGU7CiAgICAgIGlmKGd1aWRlICE9IGFkZHJlc3MoMCkpIHsgLy8gSW52LiBHdWlkZSBleGlzdHMKICAgICAgICBpZihzYWxlU3RhdFttc2cuc2VuZGVyXS5ndWlkZVJld2FyZCA+PSBndWlkZXNTdGF0W2d1aWRlXS5wZXJpb2RpY2FsbHlXaXRoZHJhd25SZXdhcmQpIHsgLy8gYWxyZWFkeSB3aXRoZHJhd2VkIGxlc3MgdGhlbiB0byB3aXRoZHJhdyBmb3IgdGhpcyBJbnZlc3RvcgogICAgICAgICAgdWludCByZW1haW5lZFJld2FyZFRvV2l0aGRyYXcgPSBzYWxlU3RhdFttc2cuc2VuZGVyXS5ndWlkZVJld2FyZC1ndWlkZXNTdGF0W2d1aWRlXS5wZXJpb2RpY2FsbHlXaXRoZHJhd25SZXdhcmQ7CiAgICAgICAgICBndWlkZXNTdGF0W2d1aWRlXS5wZXJpb2RpY2FsbHlXaXRoZHJhd25SZXdhcmQgPSAwOyAvLyB3aXRoZHJhd24gcmV3YXJkIGlzIGNvdW50ZWQgYXMgd2l0aGRyYXduIG9mIHRoaXMgSW52ZXN0b3IgcmV3YXJkIAogICAgICAgICAgaWYoZ3VpZGVzU3RhdFtndWlkZV0uYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQgPj0gcmVtYWluZWRSZXdhcmRUb1dpdGhkcmF3KSB7IC8vIHdlIGhhdmUgZW5vdWdoIHBvdGVudGlhbCByZXdhcmQKICAgICAgICAgICAgZ3VpZGVzU3RhdFtndWlkZV0uYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQgLT0gcmVtYWluZWRSZXdhcmRUb1dpdGhkcmF3OyAvLyBkZWNyZWFzZSBwb3RlbnRpYWwgcmV3YXJkCiAgICAgICAgICAgIGd1aWRlc1N0YXRbZ3VpZGVdLnJld2FyZFRvV2l0aGRyYXcgKz0gcmVtYWluZWRSZXdhcmRUb1dpdGhkcmF3OyAgLy8gaW5jcmVhc2UgdG90YWwgYW1vdW50IHRvIHdpdGhkcmF3IHJpZ2h0IG5vdwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ3VpZGVzU3RhdFtndWlkZV0uYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQgPSAwOyAvLyBzb21ldGhpbmcgd3Jvbmcgc28gbnVsbGlmeQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBzdWJzdHJhY3QgY3VycmVudCBJbnZlc3RvcidzIHJld2FyZCBmcm9tIHBlcmlvZGljYWxseSB3aXRoZHJhd24gcmV3YXJkIHRvIHJlbW92ZSBpdCBmcm9tIHdpdGhkcmF3bmVkCiAgICAgICAgICBndWlkZXNTdGF0W2d1aWRlXS5wZXJpb2RpY2FsbHlXaXRoZHJhd25SZXdhcmQgLT0gc2FsZVN0YXRbbXNnLnNlbmRlcl0uZ3VpZGVSZXdhcmQ7CiAgICAgICAgICAvLyB3ZSBoYXZlIGVub3VnaCBwb3RlbnRpYWwgcmV3YXJkIC0gYWxsIG9rIAogICAgICAgICAgaWYoZ3VpZGVzU3RhdFtndWlkZV0uYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQgPj0gc2FsZVN0YXRbbXNnLnNlbmRlcl0uZ3VpZGVSZXdhcmQpIHsKICAgICAgICAgICAgLy8gd2UgZG8gbm90IGNvdW50IHRoaXMgSW52ZXN0b3IgZ3VpZGVSZXdhcmQgaW4gcG90ZW50aWFsIHJld2FyZAogICAgICAgICAgICBndWlkZXNTdGF0W2d1aWRlXS5hY2N1bXVsYXRlZFBvdGVudGlhbFJld2FyZCAtPSBzYWxlU3RhdFttc2cuc2VuZGVyXS5ndWlkZVJld2FyZDsKICAgICAgICAgICAgZ3VpZGVzU3RhdFtndWlkZV0ucmV3YXJkVG9XaXRoZHJhdyArPSBzYWxlU3RhdFttc2cuc2VuZGVyXS5ndWlkZVJld2FyZDsgIC8vIGluY3JlYXNlIHRvdGFsIGFtb3VudCB0byB3aXRoZHJhdyByaWdodCBub3cgIAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ3VpZGVzU3RhdFtndWlkZV0uYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQgPSAwOyAvLyBzb21ldGhpbmcgd3Jvbmcgc28gbnVsbGlmeSAgCiAgICAgICAgICB9ICAgCiAgICAgICAgfQogICAgICB9CiAgICAgIGFsbG93ZWRBbW91bnRUb1RyYW5zZmVyVG9Qb29sICs9IHNhbGVTdGF0W21zZy5zZW5kZXJdLmludmVzdGVkOwogICAgfQogIAogIC8qKgogICAqIEBkZXYgRGlzdHJpYnV0ZSBib3VudHkgcmV3YXJkcyBmb3IgYm91bnR5IHRhc2tzCiAgICogQHBhcmFtIF90byBpcyBhZGRyZXNzIG9mIGJvdW50eSBodW50ZXIKICAgKiBAcGFyYW0gX3N0YWtlcyBpcyBxdWFudGl0eSBvZiBTdGFrZXMgdHJhbnNmZXJlZCAgICAgICAKICAgKi8gICAgIAogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZUJvdW50eShhZGRyZXNzIF90bywgdWludCBfc3Rha2VzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgcmVxdWlyZShkaXN0cmlidXRlZEJvdW50eVN0YWtlcytfc3Rha2VzIDw9IGJvdW50eUNhcCk7IC8vIG5vIG1vcmUgdGhlbiBtYXhpbXVtIGNhcGFjaXR5IGNhbiBiZSBkaXN0cmlidXRlZAogICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3N0YWtlcyk7IC8vIHRvCiAgICAgIHRvdGFsU3VwcGx5ICs9IF9zdGFrZXM7IAogICAgICBkaXN0cmlidXRlZEJvdW50eVN0YWtlcyArPSBfc3Rha2VzOyAvLyBhZGRpbmcgdG8gdG90YWwgYm91bnR5IGRpc3RyaWJ1dGVkCiAgICAgIEJvdW50eURpc3RyaWJ1dGVkKF90bywgX3N0YWtlcyk7CiAgICAgIFRyYW5zZmVyKHN1cHBsaWVyLCBfdG8sIF9zdGFrZXMpOyAgICAKICAgIH0gCiAgLyoqCiAgICogQGRldiBVbmZyZWV6ZSB0ZWFtICYgRnVuZGFyaWEgU3Rha2VzLgogICAqLyAgICAgIAogICAgZnVuY3Rpb24gdW5GcmVlemUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgLy8gb25seSBhZnRlciBwbGFubmVkIHBlcmlvZAogICAgICBpZihub3cgPiBidXNpbmVzc1BsYW5uZWRQZXJpb2RFbmRUaW1lc3RhbXApIHsKICAgICAgICB0ZWFtU3Rha2VzRnJvemVuID0gZmFsc2U7IC8vIG1ha2UgdGVhbSBzdGFrZXMgYXZhaWxhYmxlIGZvciB0cmFuc2ZlcmluZwogICAgICAgIGZ1bmRhcmlhU3Rha2VzRnJvemVuID0gZmFsc2U7IC8vIG1ha2UgRnVuZGFyaWEgc3Rha2VzIGF2YWlsYWJsZSBmb3IgdHJhbnNmZXJpbmcKICAgICAgfSAgCiAgICB9ICAgICAKfQ=='.
	

]
