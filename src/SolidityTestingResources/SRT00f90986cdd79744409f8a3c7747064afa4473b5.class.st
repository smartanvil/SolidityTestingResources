Class {
	#name : #SRT00f90986cdd79744409f8a3c7747064afa4473b5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT00f90986cdd79744409f8a3c7747064afa4473b5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwogIGFkZHJlc3MgcHVibGljIG93bmVyOyAvL293bmVyCiAgYWRkcmVzcyBwdWJsaWMgYW5pbWF0b3I7IC8vYW5pbWF0b3IKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGZ1bmN0aW9uIGNvbW1pdERpdmlkZW5kKGFkZHJlc3Mgd2hvKSBpbnRlcm5hbDsgLy8gcGF5cyByZW1haW5pbmcgZGl2aWRlbmQKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKCiAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgc2l6ZSkgewogICAgIGFzc2VydChtc2cuZGF0YS5sZW5ndGggPj0gc2l6ZSArIDQpOwogICAgIF87CiAgfQogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgewogICAgY29tbWl0RGl2aWRlbmQobXNnLnNlbmRlcik7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgaWYoX3RvID09IGFkZHJlc3ModGhpcykpIHsKICAgICAgICBjb21taXREaXZpZGVuZChvd25lcik7CiAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gYmFsYW5jZXNbb3duZXJdLmFkZChfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIG93bmVyLCBfdmFsdWUpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgY29tbWl0RGl2aWRlbmQoX3RvKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICB9CiAgfQogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEJhc2ljVG9rZW4sIEVSQzIwIHsKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDMgKiAzMikgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKICAgIGNvbW1pdERpdmlkZW5kKF9mcm9tKTsKICAgIGNvbW1pdERpdmlkZW5kKF90byk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVhaGxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgewogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICBhc3NlcnQoISgoX3ZhbHVlICE9IDApICYmIChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAhPSAwKSkpOwogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICB9CiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQp9CgovKioKICogQHRpdGxlIFNtYXJ0QmlsbGlvbnMgY29udHJhY3QKICovCmNvbnRyYWN0IFNtYXJ0QmlsbGlvbnMgaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgLy8gbWV0YWRhdGEKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJTbWFydEJpbGxpb25zIFRva2VuIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlBMQVkiOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAwOwoKICAgIC8vIGNvbnRyYWN0IHN0YXRlCiAgICBzdHJ1Y3QgV2FsbGV0IHsKICAgICAgICB1aW50MjA4IGJhbGFuY2U7IC8vIGN1cnJlbnQgYmFsYW5jZSBvZiB1c2VyCiAgICAJdWludDE2IGxhc3REaXZpZGVuZFBlcmlvZDsgLy8gbGFzdCBwcm9jZXNzZWQgZGl2aWRlbmQgcGVyaW9kIG9mIHVzZXIncyB0b2tlbnMKICAgIAl1aW50MzIgbmV4dFdpdGhkcmF3QmxvY2s7IC8vIG5leHQgd2l0aGRyYXdhbCBwb3NzaWJsZSBhZnRlciB0aGlzIGJsb2NrIG51bWJlcgogICAgfQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBXYWxsZXQpIHdhbGxldHM7CiAgICBzdHJ1Y3QgQmV0IHsKICAgICAgICB1aW50MTkyIHZhbHVlOyAvLyBiZXQgc2l6ZQogICAgICAgIHVpbnQzMiBiZXRIYXNoOyAvLyBzZWxlY3RlZCBudW1iZXJzCiAgICAgICAgdWludDMyIGJsb2NrTnVtOyAvLyBibG9ja251bWJlciB3aGVuIGxvdHRlcnkgcnVucwogICAgfQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBCZXQpIGJldHM7CgogICAgdWludCBwdWJsaWMgd2FsbGV0QmFsYW5jZSA9IDA7IC8vIHN1bSBvZiBmdW5kcyBpbiB3YWxsZXRzCgogICAgLy8gaW52ZXN0bWVudCBwYXJhbWV0ZXJzCiAgICB1aW50IHB1YmxpYyBpbnZlc3RTdGFydCA9IDE7IC8vIGludmVzdG1lbnQgc3RhcnQgYmxvY2ssIDA6IGNsb3NlZCwgMTogcHJlcGFyYXRpb24KICAgIHVpbnQgcHVibGljIGludmVzdEJhbGFuY2UgPSAwOyAvLyBmdW5kaW5nIGZyb20gaW52ZXN0b3JzCiAgICB1aW50IHB1YmxpYyBpbnZlc3RCYWxhbmNlTWF4ID0gMjAwMDAwIGV0aGVyOyAvLyBtYXhpbXVtIGZ1bmRpbmcKICAgIHVpbnQgcHVibGljIGRpdmlkZW5kUGVyaW9kID0gMTsKICAgIHVpbnRbXSBwdWJsaWMgZGl2aWRlbmRzOyAvLyBkaXZpZGVucyBjb2xsZWN0ZWQgcGVyIHBlcmlvZCwgZ3Jvd2luZyBhcnJheQoKICAgIC8vIGJldHRpbmcgcGFyYW1ldGVycwogICAgdWludCBwdWJsaWMgbWF4V2luID0gMDsgLy8gbWF4aW11bSBwcml6ZSB3b24KICAgIHVpbnQgcHVibGljIGhhc2hGaXJzdCA9IDA7IC8vIHN0YXJ0IHRpbWUgb2YgYnVpbGRpbmcgaGFzaGVzIGRhdGFiYXNlCiAgICB1aW50IHB1YmxpYyBoYXNoTGFzdCA9IDA7IC8vIGxhc3Qgc2F2ZWQgYmxvY2sgb2YgaGFzaGVzCiAgICB1aW50IHB1YmxpYyBoYXNoTmV4dCA9IDA7IC8vIG5leHQgYXZhaWxhYmxlIGJldCBibG9jay5udW1iZXIKICAgIHVpbnQgcHVibGljIGhhc2hCZXRTdW0gPSAwOyAvLyB1c2VkIGJldCB2b2x1bWUgb2YgbmV4dCBibG9jawogICAgdWludCBwdWJsaWMgaGFzaEJldE1heCA9IDUgZXRoZXI7IC8vIG1heGltdW0gYmV0IHNpemUgcGVyIGJsb2NrCiAgICB1aW50W10gcHVibGljIGhhc2hlczsgLy8gc3BhY2UgZm9yIHN0b3JpbmcgbG90dGVyeSByZXN1bHRzCgogICAgLy8gY29uc3RhbnRzCiAgICAvL3VpbnQgcHVibGljIGNvbnN0YW50IGhhc2hlc1NpemUgPSAxMDI0IDsgLy8gREVCVUcgT05MWSAhISEKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IGhhc2hlc1NpemUgPSAxNjM4NCA7IC8vIDMwIGRheXMgb2YgYmxvY2tzCiAgICB1aW50IHB1YmxpYyBjb2xkU3RvcmVMYXN0ID0gMCA7IC8vIGJsb2NrIG9mIGxhc3QgY29sZCBzdG9yZSB0cmFuc2ZlcgoKICAgIC8vIGV2ZW50cwogICAgZXZlbnQgTG9nQmV0KGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsIHVpbnQgYmV0aGFzaCwgdWludCBibG9ja251bWJlciwgdWludCBiZXRzaXplKTsKICAgIGV2ZW50IExvZ0xvc3MoYWRkcmVzcyBpbmRleGVkIHBsYXllciwgdWludCBiZXRoYXNoLCB1aW50IGhhc2gpOwogICAgZXZlbnQgTG9nV2luKGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsIHVpbnQgYmV0aGFzaCwgdWludCBoYXNoLCB1aW50IHByaXplKTsKICAgIGV2ZW50IExvZ0ludmVzdG1lbnQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCBhZGRyZXNzIGluZGV4ZWQgcGFydG5lciwgdWludCBhbW91bnQpOwogICAgZXZlbnQgTG9nUmVjb3JkV2luKGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXIsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExvZ0xhdGUoYWRkcmVzcyBpbmRleGVkIHBsYXllcix1aW50IHBsYXllckJsb2NrTnVtYmVyLHVpbnQgY3VycmVudEJsb2NrTnVtYmVyKTsKICAgIC8vZXZlbnQgTG9nV2l0aGRyYXcoYWRkcmVzcyBpbmRleGVkIHdobywgdWludCBhbW91bnQpOwoKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QW5pbWF0b3IoKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gYW5pbWF0b3IpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNtYXJ0QmlsbGlvbnMoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGFuaW1hdG9yID0gbXNnLnNlbmRlcjsKICAgICAgICB3YWxsZXRzW293bmVyXS5sYXN0RGl2aWRlbmRQZXJpb2QgPSB1aW50MTYoZGl2aWRlbmRQZXJpb2QpOwogICAgICAgIC8vd2FsbGV0c1thbmltYXRvcl0ubGFzdERpdmlkZW5kUGVyaW9kID0gdWludDE2KGRpdmlkZW5kUGVyaW9kKTsKICAgICAgICBkaXZpZGVuZHMucHVzaCgwKTsgLy8gbm90IHVzZWQKICAgICAgICBkaXZpZGVuZHMucHVzaCgwKTsgLy8gY3VycmVudCBkaXZpZGVuZAogICAgfQoKLyogZ2V0dGVycyAqLwogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBsZW5ndGggb2YgYWxsb2NhdGVkIHN3YXAgc3BhY2UKICAgICAqLwogICAgZnVuY3Rpb24gaGFzaGVzTGVuZ3RoKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KGhhc2hlcy5sZW5ndGgpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBiYWxhbmNlIG9mIHdhbGxldAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gd2FsbGV0QmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQod2FsbGV0c1tfb3duZXJdLmJhbGFuY2UpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgU2hvdyBsYXN0IGRpdmlkZW5kIHBlcmlvZCBwcm9jZXNzZWQKICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdhbGxldFBlcmlvZE9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQod2FsbGV0c1tfb3duZXJdLmxhc3REaXZpZGVuZFBlcmlvZCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJsb2NrIG51bWJlciB3aGVuIHdpdGhkcmF3IGNhbiBjb250aW51ZQogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudC4KICAgICAqLwogICAgZnVuY3Rpb24gd2FsbGV0QmxvY2tPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KHdhbGxldHNbX293bmVyXS5uZXh0V2l0aGRyYXdCbG9jayk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJldCBzaXplLgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgcGxheWVyLgogICAgICovCiAgICBmdW5jdGlvbiBiZXRWYWx1ZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQoYmV0c1tfb3duZXJdLnZhbHVlKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFNob3cgYmxvY2sgbnVtYmVyIG9mIGxvdHRlcnkgcnVuIGZvciB0aGUgYmV0LgogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgcGxheWVyLgogICAgICovCiAgICBmdW5jdGlvbiBiZXRIYXNoT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdWludChiZXRzW19vd25lcl0uYmV0SGFzaCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTaG93IGJsb2NrIG51bWJlciBvZiBsb3R0ZXJ5IHJ1biBmb3IgdGhlIGJldC4KICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHBsYXllci4KICAgICAqLwogICAgZnVuY3Rpb24gYmV0QmxvY2tOdW1iZXJPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB1aW50KGJldHNbX293bmVyXS5ibG9ja051bSk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBQcmludCBudW1iZXIgb2YgYmxvY2sgdGlsbCBuZXh0IGV4cGVjdGVkIGRpdmlkZW5kIHBheW1lbnQKICAgICAqLwogICAgZnVuY3Rpb24gZGl2aWRlbmRzQmxvY2tzKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGlmKGludmVzdFN0YXJ0ID4gMCkgewogICAgICAgICAgICByZXR1cm4oMCk7CiAgICAgICAgfQogICAgICAgIHVpbnQgcGVyaW9kID0gKGJsb2NrLm51bWJlciAtIGhhc2hGaXJzdCkgLyAoMTAgKiBoYXNoZXNTaXplKTsKICAgICAgICBpZihwZXJpb2QgPiBkaXZpZGVuZFBlcmlvZCkgewogICAgICAgICAgICByZXR1cm4oMCk7CiAgICAgICAgfQogICAgICAgIHJldHVybigoMTAgKiBoYXNoZXNTaXplKSAtICgoYmxvY2subnVtYmVyIC0gaGFzaEZpcnN0KSAlICgxMCAqIGhhc2hlc1NpemUpKSk7CiAgICB9CgovKiBhZG1pbmlzdHJhdGl2ZSBmdW5jdGlvbnMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgQ2hhbmdlIG93bmVyLgogICAgICogQHBhcmFtIF93aG8gVGhlIGFkZHJlc3Mgb2YgbmV3IG93bmVyLgogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF93aG8pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgYXNzZXJ0KF93aG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgY29tbWl0RGl2aWRlbmQobXNnLnNlbmRlcik7CiAgICAgICAgY29tbWl0RGl2aWRlbmQoX3dobyk7CiAgICAgICAgb3duZXIgPSBfd2hvOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDaGFuZ2UgYW5pbWF0b3IuCiAgICAgKiBAcGFyYW0gX3dobyBUaGUgYWRkcmVzcyBvZiBuZXcgYW5pbWF0b3IuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZUFuaW1hdG9yKGFkZHJlc3MgX3dobykgZXh0ZXJuYWwgb25seUFuaW1hdG9yIHsKICAgICAgICBhc3NlcnQoX3dobyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjb21taXREaXZpZGVuZChtc2cuc2VuZGVyKTsKICAgICAgICBjb21taXREaXZpZGVuZChfd2hvKTsKICAgICAgICBhbmltYXRvciA9IF93aG87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCBJQ08gU3RhcnQgYmxvY2suCiAgICAgKiBAcGFyYW0gX3doZW4gVGhlIGJsb2NrIG51bWJlciBvZiB0aGUgSUNPLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRJbnZlc3RTdGFydCh1aW50IF93aGVuKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoaW52ZXN0U3RhcnQgPT0gMSAmJiBoYXNoRmlyc3QgPiAwICYmIGJsb2NrLm51bWJlciA8IF93aGVuKTsKICAgICAgICBpbnZlc3RTdGFydCA9IF93aGVuOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXQgbWF4aW11bSBiZXQgc2l6ZSBwZXIgYmxvY2sKICAgICAqIEBwYXJhbSBfbWF4c3VtIFRoZSBtYXhpbXVtIGJldCBzaXplIGluIHdlaS4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0QmV0TWF4KHVpbnQgX21heHN1bSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBoYXNoQmV0TWF4ID0gX21heHN1bTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmVzZXQgYmV0IHNpemUgYWNjb3VudGluZywgdG8gaW5jcmVhc2UgYmV0IHZvbHVtZSBhYm92ZSBzYWZlIGxpbWl0cwogICAgICovCiAgICBmdW5jdGlvbiByZXNldEJldCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgaGFzaE5leHQgPSBibG9jay5udW1iZXIgKyAzOwogICAgICAgIGhhc2hCZXRTdW0gPSAwOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBNb3ZlIGZ1bmRzIHRvIGNvbGQgc3RvcmFnZQogICAgICogQGRldiBpbnZlc3RCYWxhbmNlIGFuZCB3YWxsZXRCYWxhbmNlIGlzIHByb3RlY3RlZCBmcm9tIHdpdGhkcmF3IGJ5IG93bmVyCiAgICAgKiBAZGV2IGlmIGZ1bmRpbmcgaXMgPiA1MCUgYWRtaW4gY2FuIHdpdGhkcmF3IG9ubHkgMC4yNSUgb2YgYmFsYW5jZSB3ZWFrbHkKICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2Ygd2VpIHRvIG1vdmUgdG8gY29sZCBzdG9yYWdlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbGRTdG9yZSh1aW50IF9hbW91bnQpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgaG91c2VLZWVwaW5nKCk7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCAmJiB0aGlzLmJhbGFuY2UgPj0gKGludmVzdEJhbGFuY2UgKiA5IC8gMTApICsgd2FsbGV0QmFsYW5jZSArIF9hbW91bnQpOwogICAgICAgIGlmKGludmVzdEJhbGFuY2UgPj0gaW52ZXN0QmFsYW5jZU1heCAvIDIpeyAvLyBhZGRpdGlvbmFsIGphY2twb3QgcHJvdGVjdGlvbgogICAgICAgICAgICByZXF1aXJlKChfYW1vdW50IDw9IHRoaXMuYmFsYW5jZSAvIDQwMCkgJiYgY29sZFN0b3JlTGFzdCArIDQgKiA2MCAqIDI0ICogNyA8PSBibG9jay5udW1iZXIpOwogICAgICAgIH0KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKF9hbW91bnQpOwogICAgICAgIGNvbGRTdG9yZUxhc3QgPSBibG9jay5udW1iZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1vdmUgZnVuZHMgdG8gY29udHJhY3QKICAgICAqLwogICAgZnVuY3Rpb24gaG90U3RvcmUoKSBwYXlhYmxlIGV4dGVybmFsIHsgLy8gbm90IG5lZWRlZCBiZWNhdXNlIGphY2twb3QgaXMgcHJvdGVjdGVkCiAgICAgICAgaG91c2VLZWVwaW5nKCk7CiAgICB9CgovKiBob3VzZWtlZXBpbmcgZnVuY3Rpb25zICovCgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZSBhY2NvdW50aW5nCiAgICAgKi8KICAgIGZ1bmN0aW9uIGhvdXNlS2VlcGluZygpIHB1YmxpYyB7CiAgICAgICAgaWYoaW52ZXN0U3RhcnQgPiAxICYmIGJsb2NrLm51bWJlciA+PSBpbnZlc3RTdGFydCArIChoYXNoZXNTaXplICogNSkpeyAvLyBjYS4gMTQgZGF5cwogICAgICAgICAgICBpbnZlc3RTdGFydCA9IDA7IC8vIHN0YXJ0IGRpdmlkZW5kIHBheW1lbnRzCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZihoYXNoRmlyc3QgPiAwKXsKCQkgICAgICAgIHVpbnQgcGVyaW9kID0gKGJsb2NrLm51bWJlciAtIGhhc2hGaXJzdCkgLyAoMTAgKiBoYXNoZXNTaXplICk7CiAgICAgICAgICAgICAgICBpZihwZXJpb2QgPiBkaXZpZGVuZHMubGVuZ3RoIC0gMikgewogICAgICAgICAgICAgICAgICAgIGRpdmlkZW5kcy5wdXNoKDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYocGVyaW9kID4gZGl2aWRlbmRQZXJpb2QgJiYgaW52ZXN0U3RhcnQgPT0gMCAmJiBkaXZpZGVuZFBlcmlvZCA8IGRpdmlkZW5kcy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgZGl2aWRlbmRQZXJpb2QrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCi8qIHBheW1lbnRzICovCgogICAgLyoqCiAgICAgKiBAZGV2IFBheSBiYWxhbmNlIGZyb20gd2FsbGV0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHBheVdhbGxldCgpIHB1YmxpYyB7CiAgICAgICAgaWYod2FsbGV0c1ttc2cuc2VuZGVyXS5iYWxhbmNlID4gMCAmJiB3YWxsZXRzW21zZy5zZW5kZXJdLm5leHRXaXRoZHJhd0Jsb2NrIDw9IGJsb2NrLm51bWJlcil7CiAgICAgICAgICAgIHVpbnQgYmFsYW5jZSA9IHdhbGxldHNbbXNnLnNlbmRlcl0uYmFsYW5jZTsKICAgICAgICAgICAgd2FsbGV0c1ttc2cuc2VuZGVyXS5iYWxhbmNlID0gMDsKICAgICAgICAgICAgd2FsbGV0QmFsYW5jZSAtPSBiYWxhbmNlOwogICAgICAgICAgICBwYXkoYmFsYW5jZSk7CiAgICAgICAgICAgIC8vTG9nV2l0aGRyYXcobXNnLnNlbmRlcixiYWxhbmNlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGF5KHVpbnQgX2Ftb3VudCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCBtYXhwYXkgPSB0aGlzLmJhbGFuY2UgLyAyOwogICAgICAgIGlmKG1heHBheSA+PSBfYW1vdW50KSB7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoX2Ftb3VudCk7CiAgICAgICAgICAgIGlmKF9hbW91bnQgPiAxIGZpbm5leSkgewogICAgICAgICAgICAgICAgaG91c2VLZWVwaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHVpbnQga2VlcGJhbGFuY2UgPSBfYW1vdW50IC0gbWF4cGF5OwogICAgICAgICAgICB3YWxsZXRCYWxhbmNlICs9IGtlZXBiYWxhbmNlOwogICAgICAgICAgICB3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2UgKz0gdWludDIwOChrZWVwYmFsYW5jZSk7CiAgICAgICAgICAgIHdhbGxldHNbbXNnLnNlbmRlcl0ubmV4dFdpdGhkcmF3QmxvY2sgPSB1aW50MzIoYmxvY2subnVtYmVyICsgNCAqIDYwICogMjQgKiAzMCk7IC8vIHdhaXQgMSBtb250aCBmb3IgbW9yZSBmdW5kcwogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1heHBheSk7CiAgICAgICAgfQogICAgfQoKLyogaW52ZXN0bWVudCBmdW5jdGlvbnMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgQnV5IHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBpbnZlc3REaXJlY3QoKSBwYXlhYmxlIGV4dGVybmFsIHsKICAgICAgICBpbnZlc3Qob3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBCdXkgdG9rZW5zIHdpdGggYWZmaWxpYXRlIHBhcnRuZXIKICAgICAqIEBwYXJhbSBfcGFydG5lciBBZmZpbGlhdGUgcGFydG5lcgogICAgICovCiAgICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBfcGFydG5lcikgcGF5YWJsZSBwdWJsaWMgewogICAgICAgIC8vcmVxdWlyZShmcm9tVVNBKCk9PWZhbHNlKTsgLy8gZnJvbVVTQSgpIG5vdCB5ZXQgaW1wbGVtZW50ZWQgOi0oCiAgICAgICAgcmVxdWlyZShpbnZlc3RTdGFydCA+IDEgJiYgYmxvY2subnVtYmVyIDwgaW52ZXN0U3RhcnQgKyAoaGFzaGVzU2l6ZSAqIDUpICYmIGludmVzdEJhbGFuY2UgPCBpbnZlc3RCYWxhbmNlTWF4KTsKICAgICAgICB1aW50IGludmVzdGluZyA9IG1zZy52YWx1ZTsKICAgICAgICBpZihpbnZlc3RpbmcgPiBpbnZlc3RCYWxhbmNlTWF4IC0gaW52ZXN0QmFsYW5jZSkgewogICAgICAgICAgICBpbnZlc3RpbmcgPSBpbnZlc3RCYWxhbmNlTWF4IC0gaW52ZXN0QmFsYW5jZTsKICAgICAgICAgICAgaW52ZXN0QmFsYW5jZSA9IGludmVzdEJhbGFuY2VNYXg7CiAgICAgICAgICAgIGludmVzdFN0YXJ0ID0gMDsgLy8gY2xvc2UgaW52ZXN0bWVudCByb3VuZAogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZS5zdWIoaW52ZXN0aW5nKSk7IC8vIHNlbmQgYmFjayBmdW5kcyBpbW1lZGlhdGVseQogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBpbnZlc3RCYWxhbmNlICs9IGludmVzdGluZzsKICAgICAgICB9CiAgICAgICAgaWYoX3BhcnRuZXIgPT0gYWRkcmVzcygwKSB8fCBfcGFydG5lciA9PSBvd25lcil7CiAgICAgICAgICAgIHdhbGxldEJhbGFuY2UgKz0gaW52ZXN0aW5nIC8gMTA7CiAgICAgICAgICAgIHdhbGxldHNbb3duZXJdLmJhbGFuY2UgKz0gdWludDIwOChpbnZlc3RpbmcgLyAxMCk7fSAvLyAxMCUgZm9yIG1hcmtldGluZyBpZiBubyBhZmZpbGlhdGVzCiAgICAgICAgZWxzZXsKICAgICAgICAgICAgd2FsbGV0QmFsYW5jZSArPSAoaW52ZXN0aW5nICogNSAvIDEwMCkgKiAyOwogICAgICAgICAgICB3YWxsZXRzW293bmVyXS5iYWxhbmNlICs9IHVpbnQyMDgoaW52ZXN0aW5nICogNSAvIDEwMCk7IC8vIDUlIGluaXRpYWwgbWFya2V0aW5nIGZ1bmRzCiAgICAgICAgICAgIC8vd2FsbGV0c1tfcGFydG5lcl0ubGFzdERpdmlkZW5kUGVyaW9kID0gdWludDE2KGRpdmlkZW5kUGVyaW9kKTsgLy8gYXNzZXJ0KGRpdmlkZW5kUGVyaW9kID09IDEpOwogICAgICAgICAgICB3YWxsZXRzW19wYXJ0bmVyXS5iYWxhbmNlICs9IHVpbnQyMDgoaW52ZXN0aW5nICogNSAvIDEwMCk7fSAvLyA1JSBmb3IgYWZmaWxpYXRlcwogICAgICAgIHdhbGxldHNbbXNnLnNlbmRlcl0ubGFzdERpdmlkZW5kUGVyaW9kID0gdWludDE2KGRpdmlkZW5kUGVyaW9kKTsgLy8gYXNzZXJ0KGRpdmlkZW5kUGVyaW9kID09IDEpOwogICAgICAgIHVpbnQgc2VuZGVyQmFsYW5jZSA9IGludmVzdGluZyAvIDEwKioxNTsKICAgICAgICB1aW50IG93bmVyQmFsYW5jZSA9IGludmVzdGluZyAqIDE2IC8gMTAqKjE3ICA7CiAgICAgICAgdWludCBhbmltYXRvckJhbGFuY2UgPSBpbnZlc3RpbmcgKiAxMCAvIDEwKioxNyAgOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdICs9IHNlbmRlckJhbGFuY2U7CiAgICAgICAgYmFsYW5jZXNbb3duZXJdICs9IG93bmVyQmFsYW5jZSA7IC8vIDEzJSBvZiBzaGFyZXMgZ28gdG8gZGV2ZWxvcGVycwogICAgICAgIGJhbGFuY2VzW2FuaW1hdG9yXSArPSBhbmltYXRvckJhbGFuY2UgOyAvLyA4JSBvZiBzaGFyZXMgZ28gdG8gYW5pbWF0b3IKICAgICAgICB0b3RhbFN1cHBseSArPSBzZW5kZXJCYWxhbmNlICsgb3duZXJCYWxhbmNlICsgYW5pbWF0b3JCYWxhbmNlOwogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksbXNnLnNlbmRlcixzZW5kZXJCYWxhbmNlKTsgLy8gZm9yIGV0aGVyc2NhbgogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksb3duZXIsb3duZXJCYWxhbmNlKTsgLy8gZm9yIGV0aGVyc2NhbgogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMCksYW5pbWF0b3IsYW5pbWF0b3JCYWxhbmNlKTsgLy8gZm9yIGV0aGVyc2NhbgogICAgICAgIExvZ0ludmVzdG1lbnQobXNnLnNlbmRlcixfcGFydG5lcixpbnZlc3RpbmcpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWxldGUgYWxsIHRva2VucyBvd25lZCBieSBzZW5kZXIgYW5kIHJldHVybiB1bnBhaWQgZGl2aWRlbmRzIGFuZCA5MCUgb2YgaW5pdGlhbCBpbnZlc3RtZW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGRpc2ludmVzdCgpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGludmVzdFN0YXJ0ID09IDApOwogICAgICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpOwogICAgICAgIHVpbnQgaW5pdGlhbEludmVzdG1lbnQgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXSAqIDEwKioxNTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLGFkZHJlc3MoMCksYmFsYW5jZXNbbXNnLnNlbmRlcl0pOyAvLyBmb3IgZXRoZXJzY2FuCiAgICAgICAgZGVsZXRlIGJhbGFuY2VzW21zZy5zZW5kZXJdOyAvLyB0b3RhbFN1cHBseSBzdGF5cyB0aGUgc2FtZSwgaW52ZXN0QmFsYW5jZSBpcyByZWR1Y2VkCiAgICAgICAgaW52ZXN0QmFsYW5jZSAtPSBpbml0aWFsSW52ZXN0bWVudDsKICAgICAgICB3YWxsZXRzW21zZy5zZW5kZXJdLmJhbGFuY2UgKz0gdWludDIwOChpbml0aWFsSW52ZXN0bWVudCAqIDkgLyAxMCk7CiAgICAgICAgcGF5V2FsbGV0KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFBheSB1bnBhaWQgZGl2aWRlbmRzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBheURpdmlkZW5kcygpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGludmVzdFN0YXJ0ID09IDApOwogICAgICAgIGNvbW1pdERpdmlkZW5kKG1zZy5zZW5kZXIpOwogICAgICAgIHBheVdhbGxldCgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDb21taXQgcmVtYWluaW5nIGRpdmlkZW5kcyBiZWZvcmUgdHJhbnNmZXIgb2YgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbW1pdERpdmlkZW5kKGFkZHJlc3MgX3dobykgaW50ZXJuYWwgewogICAgICAgIHVpbnQgbGFzdCA9IHdhbGxldHNbX3dob10ubGFzdERpdmlkZW5kUGVyaW9kOwogICAgICAgIGlmKChiYWxhbmNlc1tfd2hvXT09MCkgfHwgKGxhc3Q9PTApKXsKICAgICAgICAgICAgd2FsbGV0c1tfd2hvXS5sYXN0RGl2aWRlbmRQZXJpb2Q9dWludDE2KGRpdmlkZW5kUGVyaW9kKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZihsYXN0PT1kaXZpZGVuZFBlcmlvZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHVpbnQgc2hhcmUgPSBiYWxhbmNlc1tfd2hvXSAqIDB4ZmZmZmZmZmYgLyB0b3RhbFN1cHBseTsKICAgICAgICB1aW50IGJhbGFuY2UgPSAwOwogICAgICAgIGZvcig7bGFzdDxkaXZpZGVuZFBlcmlvZDtsYXN0KyspIHsKICAgICAgICAgICAgYmFsYW5jZSArPSBzaGFyZSAqIGRpdmlkZW5kc1tsYXN0XTsKICAgICAgICB9CiAgICAgICAgYmFsYW5jZSA9IChiYWxhbmNlIC8gMHhmZmZmZmZmZik7CiAgICAgICAgd2FsbGV0QmFsYW5jZSArPSBiYWxhbmNlOwogICAgICAgIHdhbGxldHNbX3dob10uYmFsYW5jZSArPSB1aW50MjA4KGJhbGFuY2UpOwogICAgICAgIHdhbGxldHNbX3dob10ubGFzdERpdmlkZW5kUGVyaW9kID0gdWludDE2KGxhc3QpOwogICAgfQoKLyogbG90dGVyeSBmdW5jdGlvbnMgKi8KCiAgICBmdW5jdGlvbiBiZXRQcml6ZShCZXQgX3BsYXllciwgdWludDI0IF9oYXNoKSBjb25zdGFudCBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsgLy8gaG91c2UgZmVlIDEzLjg1JQogICAgICAgIHVpbnQyNCBiZXRoYXNoID0gdWludDI0KF9wbGF5ZXIuYmV0SGFzaCk7CiAgICAgICAgdWludDI0IGhpdCA9IGJldGhhc2ggXiBfaGFzaDsKICAgICAgICB1aW50MjQgbWF0Y2hlcyA9CiAgICAgICAgICAgICgoaGl0ICYgMHhGKSA9PSAwID8gMSA6IDAgKSArCiAgICAgICAgICAgICgoaGl0ICYgMHhGMCkgPT0gMCA/IDEgOiAwICkgKwogICAgICAgICAgICAoKGhpdCAmIDB4RjAwKSA9PSAwID8gMSA6IDAgKSArCiAgICAgICAgICAgICgoaGl0ICYgMHhGMDAwKSA9PSAwID8gMSA6IDAgKSArCiAgICAgICAgICAgICgoaGl0ICYgMHhGMDAwMCkgPT0gMCA/IDEgOiAwICkgKwogICAgICAgICAgICAoKGhpdCAmIDB4RjAwMDAwKSA9PSAwID8gMSA6IDAgKTsKICAgICAgICBpZihtYXRjaGVzID09IDYpewogICAgICAgICAgICByZXR1cm4odWludChfcGxheWVyLnZhbHVlKSAqIDcwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZihtYXRjaGVzID09IDUpewogICAgICAgICAgICByZXR1cm4odWludChfcGxheWVyLnZhbHVlKSAqIDIwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYobWF0Y2hlcyA9PSA0KXsKICAgICAgICAgICAgcmV0dXJuKHVpbnQoX3BsYXllci52YWx1ZSkgKiA1MDApOwogICAgICAgIH0KICAgICAgICBpZihtYXRjaGVzID09IDMpewogICAgICAgICAgICByZXR1cm4odWludChfcGxheWVyLnZhbHVlKSAqIDI1KTsKICAgICAgICB9CiAgICAgICAgaWYobWF0Y2hlcyA9PSAyKXsKICAgICAgICAgICAgcmV0dXJuKHVpbnQoX3BsYXllci52YWx1ZSkgKiAzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuKDApOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgQ2hlY2sgaWYgd29uIGluIGxvdHRlcnkKICAgICAqLwogICAgZnVuY3Rpb24gYmV0T2YoYWRkcmVzcyBfd2hvKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSAgewogICAgICAgIEJldCBtZW1vcnkgcGxheWVyID0gYmV0c1tfd2hvXTsKICAgICAgICBpZiggKHBsYXllci52YWx1ZT09MCkgfHwKICAgICAgICAgICAgKHBsYXllci5ibG9ja051bTw9MSkgfHwKICAgICAgICAgICAgKGJsb2NrLm51bWJlcjxwbGF5ZXIuYmxvY2tOdW0pIHx8CiAgICAgICAgICAgIChibG9jay5udW1iZXI+PXBsYXllci5ibG9ja051bSArICgxMCAqIGhhc2hlc1NpemUpKSl7CiAgICAgICAgICAgIHJldHVybigwKTsKICAgICAgICB9CiAgICAgICAgaWYoYmxvY2subnVtYmVyPHBsYXllci5ibG9ja051bSsyNTYpewogICAgICAgICAgICByZXR1cm4oYmV0UHJpemUocGxheWVyLHVpbnQyNChibG9jay5ibG9ja2hhc2gocGxheWVyLmJsb2NrTnVtKSkpKTsKICAgICAgICB9CiAgICAgICAgaWYoaGFzaEZpcnN0PjApewogICAgICAgICAgICB1aW50MzIgaGFzaCA9IGdldEhhc2gocGxheWVyLmJsb2NrTnVtKTsKICAgICAgICAgICAgaWYoaGFzaCA9PSAweDEwMDAwMDApIHsgLy8gbG9hZCBoYXNoIGZhaWxlZCA6LSgsIHJldHVybiBmdW5kcwogICAgICAgICAgICAgICAgcmV0dXJuKHVpbnQocGxheWVyLnZhbHVlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIHJldHVybihiZXRQcml6ZShwbGF5ZXIsdWludDI0KGhhc2gpKSk7CiAgICAgICAgICAgIH0KCX0KICAgICAgICByZXR1cm4oMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrIGlmIHdvbiBpbiBsb3R0ZXJ5CiAgICAgKi8KICAgIGZ1bmN0aW9uIHdvbigpIHB1YmxpYyB7CiAgICAgICAgQmV0IG1lbW9yeSBwbGF5ZXIgPSBiZXRzW21zZy5zZW5kZXJdOwogICAgICAgIGlmKHBsYXllci5ibG9ja051bT09MCl7IC8vIGNyZWF0ZSBhIG5ldyBwbGF5ZXIKICAgICAgICAgICAgYmV0c1ttc2cuc2VuZGVyXSA9IEJldCh7dmFsdWU6IDAsIGJldEhhc2g6IDAsIGJsb2NrTnVtOiAxfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYoKHBsYXllci52YWx1ZT09MCkgfHwgKHBsYXllci5ibG9ja051bT09MSkpewogICAgICAgICAgICBwYXlXYWxsZXQoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlcj5wbGF5ZXIuYmxvY2tOdW0pOyAvLyBpZiB0aGVyZSBpcyBhbiBhY3RpdmUgYmV0LCB0aHJvdygpCiAgICAgICAgaWYocGxheWVyLmJsb2NrTnVtICsgKDEwICogaGFzaGVzU2l6ZSkgPD0gYmxvY2subnVtYmVyKXsgLy8gbGFzdCBiZXQgdG9vIGxvbmcgYWdvLCBsb3N0ICEKICAgICAgICAgICAgTG9nTGF0ZShtc2cuc2VuZGVyLHBsYXllci5ibG9ja051bSxibG9jay5udW1iZXIpOwogICAgICAgICAgICBiZXRzW21zZy5zZW5kZXJdID0gQmV0KHt2YWx1ZTogMCwgYmV0SGFzaDogMCwgYmxvY2tOdW06IDF9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB1aW50IHByaXplID0gMDsKICAgICAgICB1aW50MzIgaGFzaCA9IDA7CiAgICAgICAgaWYoYmxvY2subnVtYmVyPHBsYXllci5ibG9ja051bSsyNTYpewogICAgICAgICAgICBoYXNoID0gdWludDI0KGJsb2NrLmJsb2NraGFzaChwbGF5ZXIuYmxvY2tOdW0pKTsKICAgICAgICAgICAgcHJpemUgPSBiZXRQcml6ZShwbGF5ZXIsdWludDI0KGhhc2gpKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKGhhc2hGaXJzdD4wKXsgLy8gbG90dGVyeSBpcyBvcGVuIGV2ZW4gYmVmb3JlIHN3YXAgc3BhY2UgKGhhc2hlcykgaXMgcmVhZHksIGJ1dCBwbGF5ZXIgbXVzdCBjb2xsZWN0IHJlc3VsdHMgd2l0aGluIDI1NiBibG9ja3MgYWZ0ZXIgcnVuCiAgICAgICAgICAgICAgICBoYXNoID0gZ2V0SGFzaChwbGF5ZXIuYmxvY2tOdW0pOwogICAgICAgICAgICAgICAgaWYoaGFzaCA9PSAweDEwMDAwMDApIHsgLy8gbG9hZCBoYXNoIGZhaWxlZCA6LSgsIHJldHVybiBmdW5kcwogICAgICAgICAgICAgICAgICAgIHByaXplID0gdWludChwbGF5ZXIudmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICBwcml6ZSA9IGJldFByaXplKHBsYXllcix1aW50MjQoaGFzaCkpOwogICAgICAgICAgICAgICAgfQoJICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIExvZ0xhdGUobXNnLnNlbmRlcixwbGF5ZXIuYmxvY2tOdW0sYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiAwLCBiZXRIYXNoOiAwLCBibG9ja051bTogMX0pOwogICAgICAgICAgICAgICAgcmV0dXJuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYmV0c1ttc2cuc2VuZGVyXSA9IEJldCh7dmFsdWU6IDAsIGJldEhhc2g6IDAsIGJsb2NrTnVtOiAxfSk7CiAgICAgICAgaWYocHJpemU+MCkgewogICAgICAgICAgICBMb2dXaW4obXNnLnNlbmRlcix1aW50KHBsYXllci5iZXRIYXNoKSx1aW50KGhhc2gpLHByaXplKTsKICAgICAgICAgICAgaWYocHJpemUgPiBtYXhXaW4pewogICAgICAgICAgICAgICAgbWF4V2luID0gcHJpemU7CiAgICAgICAgICAgICAgICBMb2dSZWNvcmRXaW4obXNnLnNlbmRlcixwcml6ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGF5KHByaXplKTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgTG9nTG9zcyhtc2cuc2VuZGVyLHVpbnQocGxheWVyLmJldEhhc2gpLHVpbnQoaGFzaCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2VuZCBsZXNzIHRoYW4gMSBldGhlciB0byBjb250cmFjdCB0byBwbGF5IG9yIHNlbmQgMCB0byByZXRyaWV2ZSBmdW5kcwogICAgICovCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIGV4dGVybmFsIHsKICAgICAgICBpZihtc2cudmFsdWUgPiAwKXsKICAgICAgICAgICAgcGxheSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vY2hlY2sgZm9yIGRpdmlkZW5kcyBhbmQgb3RoZXIgYXNzZXRzCiAgICAgICAgaWYoaW52ZXN0U3RhcnQgPT0gMCAmJiBiYWxhbmNlc1ttc2cuc2VuZGVyXT4wKXsKICAgICAgICAgICAgY29tbWl0RGl2aWRlbmQobXNnLnNlbmRlcik7fQogICAgICAgIHdvbigpOyAvLyB3aWxsIHJ1biBwYXlXYWxsZXQoKSBpZiBub3RoaW5nIGVsc2UgYXZhaWxhYmxlCiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFBsYXkgaW4gbG90dGVyeQogICAgICovCiAgICBmdW5jdGlvbiBwbGF5KCkgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwbGF5U3lzdGVtKHVpbnQoc2hhMyhtc2cuc2VuZGVyLGJsb2NrLm51bWJlcikpLCBhZGRyZXNzKDApKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUGxheSBpbiBsb3R0ZXJ5IHdpdGggcmFuZG9tIG51bWJlcnMKICAgICAqIEBwYXJhbSBfcGFydG5lciBBZmZpbGlhdGUgcGFydG5lcgogICAgICovCiAgICBmdW5jdGlvbiBwbGF5UmFuZG9tKGFkZHJlc3MgX3BhcnRuZXIpIHBheWFibGUgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGxheVN5c3RlbSh1aW50KHNoYTMobXNnLnNlbmRlcixibG9jay5udW1iZXIpKSwgX3BhcnRuZXIpOwogICAgfQoKICAgIC8vZnVuY3Rpb24gcGxheVN5c3RlbSh1aW50OCBudW0xLCB1aW50OCBudW0yLCB1aW50OCBudW0zLCBhZGRyZXNzIF9wYXJ0bmVyKSBwYXlhYmxlIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAvLyAgICByZXR1cm4gcGxheUhhc2godWludDI0KG51bTEpfCh1aW50MjQobnVtMik8PDgpfCh1aW50MjQobnVtMyk8PDE2KSwgX3BhcnRuZXIpOwogICAgLy99CiAgICAKICAgIC8qKgogICAgICogQGRldiBQbGF5IGluIGxvdHRlcnkgd2l0aCBvd24gbnVtYmVycwogICAgICogQHBhcmFtIF9wYXJ0bmVyIEFmZmlsaWF0ZSBwYXJ0bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBsYXlTeXN0ZW0odWludCBfaGFzaCwgYWRkcmVzcyBfcGFydG5lcikgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHdvbigpOyAvLyBjaGVjayBpZiBwbGF5ZXIgZGlkIG5vdCB3aW4gCiAgICAgICAgdWludDI0IGJldGhhc2ggPSB1aW50MjQoX2hhc2gpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlIDw9IDEgZXRoZXIgJiYgbXNnLnZhbHVlIDwgaGFzaEJldE1heCk7CiAgICAgICAgaWYobXNnLnZhbHVlID4gMCl7CiAgICAgICAgICAgIGlmKGludmVzdFN0YXJ0PT0wKSB7IC8vIGRpdmlkZW5kcyBvbmx5IGFmdGVyIGludmVzdG1lbnQgZmluaXNoZWQKICAgICAgICAgICAgICAgIGRpdmlkZW5kc1tkaXZpZGVuZFBlcmlvZF0gKz0gbXNnLnZhbHVlIC8gMzQ7IC8vIDMlIGRpdmlkZW5kCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoX3BhcnRuZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAgICAgdWludCBmZWUgPSBtc2cudmFsdWUgLyAxMDA7CiAgICAgICAgICAgICAgICB3YWxsZXRCYWxhbmNlICs9IGZlZTsKICAgICAgICAgICAgICAgIHdhbGxldHNbX3BhcnRuZXJdLmJhbGFuY2UgKz0gdWludDIwOChmZWUpOyAvLyAxJSBmb3IgYWZmaWxpYXRlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGhhc2hOZXh0IDwgYmxvY2subnVtYmVyICsgMykgewogICAgICAgICAgICAgICAgaGFzaE5leHQgPSBibG9jay5udW1iZXIgKyAzOwogICAgICAgICAgICAgICAgaGFzaEJldFN1bSA9IG1zZy52YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgaWYoaGFzaEJldFN1bSA+IGhhc2hCZXRNYXgpIHsKICAgICAgICAgICAgICAgICAgICBoYXNoTmV4dCsrOwogICAgICAgICAgICAgICAgICAgIGhhc2hCZXRTdW0gPSBtc2cudmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgIGhhc2hCZXRTdW0gKz0gbXNnLnZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJldHNbbXNnLnNlbmRlcl0gPSBCZXQoe3ZhbHVlOiB1aW50MTkyKG1zZy52YWx1ZSksIGJldEhhc2g6IHVpbnQzMihiZXRoYXNoKSwgYmxvY2tOdW06IHVpbnQzMihoYXNoTmV4dCl9KTsKICAgICAgICAgICAgTG9nQmV0KG1zZy5zZW5kZXIsdWludChiZXRoYXNoKSxoYXNoTmV4dCxtc2cudmFsdWUpOwogICAgICAgIH0KICAgICAgICBwdXRIYXNoKCk7IC8vIHBsYXllcnMgaGVscCBjb2xsZWNpbmcgZGF0YQogICAgICAgIHJldHVybihoYXNoTmV4dCk7CiAgICB9CgovKiBkYXRhYmFzZSBmdW5jdGlvbnMgKi8KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlIGhhc2ggZGF0YSBzd2FwIHNwYWNlCiAgICAgKiBAcGFyYW0gX3NhZGQgTnVtYmVyIG9mIGhhc2hlcyB0byBhZGQgKDw9MjU2KQogICAgICovCiAgICBmdW5jdGlvbiBhZGRIYXNoZXModWludCBfc2FkZCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXF1aXJlKGhhc2hlcy5sZW5ndGggKyBfc2FkZDw9aGFzaGVzU2l6ZSk7CiAgICAgICAgdWludCBuID0gaGFzaGVzLmxlbmd0aDsKICAgICAgICBoYXNoZXMubGVuZ3RoICs9IF9zYWRkOwogICAgICAgIGZvcig7bjxoYXNoZXMubGVuZ3RoO24rKyl7IC8vIG1ha2Ugc3VyZSB0byBidXJuIGdhcwogICAgICAgICAgICBoYXNoZXNbbl0gPSAxOwogICAgICAgIH0KICAgICAgICBpZihoYXNoZXMubGVuZ3RoPj1oYXNoZXNTaXplKSB7IC8vIGFzc3VtZSBibG9jay5udW1iZXIgPiAxMAogICAgICAgICAgICBoYXNoRmlyc3QgPSBibG9jay5udW1iZXIgLSAoIGJsb2NrLm51bWJlciAlIDEwKTsKICAgICAgICAgICAgaGFzaExhc3QgPSBoYXNoRmlyc3Q7CiAgICAgICAgfQogICAgICAgIHJldHVybihoYXNoZXMubGVuZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlIGhhc2ggZGF0YSBzd2FwIHNwYWNlLCBhZGQgMTI4IGhhc2hlcwogICAgICovCiAgICBmdW5jdGlvbiBhZGRIYXNoZXMxMjgoKSBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuKGFkZEhhc2hlcygxMjgpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjSGFzaGVzKHVpbnQzMiBfbGFzdGIsIHVpbnQzMiBfZGVsdGEpIGNvbnN0YW50IHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIgICkpICYgMHhGRkZGRkYgKQogICAgICAgICAgICB8ICggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIrMSkpICYgMHhGRkZGRkYgKSA8PCAyNCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0YisyKSkgJiAweEZGRkZGRiApIDw8IDQ4ICkKICAgICAgICAgICAgfCAoICggdWludChibG9jay5ibG9ja2hhc2goX2xhc3RiKzMpKSAmIDB4RkZGRkZGICkgPDwgNzIgKQogICAgICAgICAgICB8ICggKCB1aW50KGJsb2NrLmJsb2NraGFzaChfbGFzdGIrNCkpICYgMHhGRkZGRkYgKSA8PCA5NiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis1KSkgJiAweEZGRkZGRiApIDw8IDEyMCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis2KSkgJiAweEZGRkZGRiApIDw8IDE0NCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis3KSkgJiAweEZGRkZGRiApIDw8IDE2OCApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis4KSkgJiAweEZGRkZGRiApIDw8IDE5MiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoYmxvY2suYmxvY2toYXNoKF9sYXN0Yis5KSkgJiAweEZGRkZGRiApIDw8IDIxNiApCiAgICAgICAgICAgIHwgKCAoIHVpbnQoX2RlbHRhKSAvIGhhc2hlc1NpemUpIDw8IDI0MCkpOyAKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRIYXNoKHVpbnQgX2Jsb2NrKSBjb25zdGFudCBwcml2YXRlIHJldHVybnMgKHVpbnQzMikgewogICAgICAgIHVpbnQgZGVsdGEgPSAoX2Jsb2NrIC0gaGFzaEZpcnN0KSAvIDEwOwogICAgICAgIHVpbnQgaGFzaCA9IGhhc2hlc1tkZWx0YSAlIGhhc2hlc1NpemVdOwogICAgICAgIGlmKGRlbHRhIC8gaGFzaGVzU2l6ZSAhPSBoYXNoID4+IDI0MCkgewogICAgICAgICAgICByZXR1cm4oMHgxMDAwMDAwKTsgLy8gbG9hZCBmYWlsZWQsIGluY29ycmVjdCBkYXRhIGluIGhhc2hlcwogICAgICAgIH0KICAgICAgICB1aW50IHNsb3RwID0gKF9ibG9jayAtIGhhc2hGaXJzdCkgJSAxMDsgCiAgICAgICAgcmV0dXJuKHVpbnQzMigoaGFzaCA+PiAoMjQgKiBzbG90cCkpICYgMHhGRkZGRkYpKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEZpbGwgaGFzaCBkYXRhCiAgICAgKi8KICAgIGZ1bmN0aW9uIHB1dEhhc2goKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgbGFzdGIgPSBoYXNoTGFzdDsKICAgICAgICBpZihsYXN0YiA9PSAwIHx8IGJsb2NrLm51bWJlciA8PSBsYXN0YiArIDEwKSB7CiAgICAgICAgICAgIHJldHVybihmYWxzZSk7CiAgICAgICAgfQogICAgICAgIHVpbnQgYmxvY2tuMjU2OwogICAgICAgIGlmKGJsb2NrLm51bWJlcjwyNTYpIHsgLy8gdXNlbGVzcyB0ZXN0IGZvciB0ZXN0bmV0IDotKAogICAgICAgICAgICBibG9ja24yNTYgPSAwOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBibG9ja24yNTYgPSBibG9jay5udW1iZXIgLSAyNTY7CiAgICAgICAgfQogICAgICAgIGlmKGxhc3RiIDwgYmxvY2tuMjU2KSB7CiAgICAgICAgICAgIHVpbnQgbnVtID0gYmxvY2tuMjU2OwogICAgICAgICAgICBudW0gKz0gbnVtICUgMTA7CiAgICAgICAgICAgIGxhc3RiID0gbnVtOyAKICAgICAgICB9CiAgICAgICAgdWludCBkZWx0YSA9IChsYXN0YiAtIGhhc2hGaXJzdCkgLyAxMDsKICAgICAgICBoYXNoZXNbZGVsdGEgJSBoYXNoZXNTaXplXSA9IGNhbGNIYXNoZXModWludDMyKGxhc3RiKSx1aW50MzIoZGVsdGEpKTsKICAgICAgICBoYXNoTGFzdCA9IGxhc3RiICsgMTA7CiAgICAgICAgcmV0dXJuKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGaWxsIGhhc2ggZGF0YSBtYW55IHRpbWVzCiAgICAgKiBAcGFyYW0gX251bSBOdW1iZXIgb2YgaXRlcmF0aW9ucwogICAgICovCiAgICBmdW5jdGlvbiBwdXRIYXNoZXModWludCBfbnVtKSBleHRlcm5hbCB7CiAgICAgICAgdWludCBuPTA7CiAgICAgICAgZm9yKDtuPF9udW07bisrKXsKICAgICAgICAgICAgaWYoIXB1dEhhc2goKSl7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKfQ=='.
	

]
