Class {
	#name : #SRT291ff49cb930caa6d8e3ea0702fc6cf3409c87aa,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT291ff49cb930caa6d8e3ea0702fc6cf3409c87aa >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogVHJhZGVUb2tlbiBDcm93ZHNhbGUgQ29udHJhY3QKICoKICogVGhpcyBpcyB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IGZvciB0aGUgUkJJVCBUb2tlbi4gSXQgdXRpbGl6ZXMgTWFqb29scidzCiAqIENyb3dkc2FsZUxpYiBsaWJyYXJ5IHRvIHJlZHVjZSBjdXN0b20gc291cmNlIGNvZGUgc3VyZmFjZSBhcmVhIGFuZCBpbmNyZWFzZQogKiBvdmVyYWxsIHNlY3VyaXR5Lk1ham9vbHIgcHJvdmlkZXMgc21hcnQgY29udHJhY3Qgc2VydmljZXMgYW5kIHNlY3VyaXR5IHJldmlld3MKICogZm9yIGNvbnRyYWN0IGRlcGxveW1lbnRzIGluIGFkZGl0aW9uIHRvIHdvcmtpbmcgb24gb3BlbiBzb3VyY2UgcHJvamVjdHMgaW4gdGhlCiAqIEV0aGVyZXVtIGNvbW11bml0eS4KICogRm9yIGZ1cnRoZXIgaW5mb3JtYXRpb246IHJob3ZpdC5pbmZvLCBtYWpvb2xyLmlvCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTCiAqIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YKICogTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULgogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQogKiBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULAogKiBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgpjb250cmFjdCBSQklUQ3Jvd2RzYWxlIHsKICB1c2luZyBEaXJlY3RDcm93ZHNhbGVMaWIgZm9yIERpcmVjdENyb3dkc2FsZUxpYi5EaXJlY3RDcm93ZHNhbGVTdG9yYWdlOwoKICBEaXJlY3RDcm93ZHNhbGVMaWIuRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzYWxlOwoKICBmdW5jdGlvbiBSQklUQ3Jvd2RzYWxlKAogICAgICAgICAgICAgICAgYWRkcmVzcyBvd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTZbXSBzYWxlRGF0YSwgICAgICAgICAgIC8vIFsxNTExOTEzNjAwLCAxODUsIDBdCiAgICAgICAgICAgICAgICB1aW50MjU2IGZhbGxiYWNrRXhjaGFuZ2VSYXRlLCAvLyAyODUwMAogICAgICAgICAgICAgICAgdWludDI1NiBjYXBBbW91bnRJbkNlbnRzLCAgICAgLy8gMTY2NTAwMDAwMDAKICAgICAgICAgICAgICAgIHVpbnQyNTYgZW5kVGltZSwgICAgICAgICAgICAgIC8vIDE1MTQzMzI4MDAKICAgICAgICAgICAgICAgIHVpbnQ4IHBlcmNlbnRCdXJuLCAgICAgICAgICAgIC8vIDEwMAogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlVG9rZW4gdG9rZW4pICAgICAgICAgLy8gMHg2ZTVkM2U5Y2U4OGEwZmJhNGUwOTZlMmViOGQyYjNkYzU0Njg1ZGQyCiAgewogIAlzYWxlLmluaXQob3duZXIsIHNhbGVEYXRhLCBmYWxsYmFja0V4Y2hhbmdlUmF0ZSwgY2FwQW1vdW50SW5DZW50cywgZW5kVGltZSwgcGVyY2VudEJ1cm4sIHRva2VuKTsKICB9CgogIC8vRXZlbnRzCiAgZXZlbnQgTG9nVG9rZW5zQm91Z2h0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IExvZ0FkZHJlc3NDYXBFeGNlZWRlZChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKICBldmVudCBMb2dFcnJvck1zZyh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nVG9rZW5QcmljZUNoYW5nZSh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nVG9rZW5zV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfYmlkZGVyLCB1aW50MjU2IEFtb3VudCk7CiAgZXZlbnQgTG9nV2VpV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfYmlkZGVyLCB1aW50MjU2IEFtb3VudCk7CiAgZXZlbnQgTG9nT3duZXJFdGhXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nTm90aWNlTXNnKGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IHZhbHVlLCBzdHJpbmcgTXNnKTsKCiAgLy8gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gYnV5IHRva2VucwogIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgc2VuZFB1cmNoYXNlKCk7CiAgfQoKICBmdW5jdGlvbiBzZW5kUHVyY2hhc2UoKSBwYXlhYmxlIHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIHNhbGUucmVjZWl2ZVB1cmNoYXNlKG1zZy52YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucygpIHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIHNhbGUud2l0aGRyYXdUb2tlbnMoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3TGVmdG92ZXJXZWkoKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZS53aXRoZHJhd0xlZnRvdmVyV2VpKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd093bmVyRXRoKCkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNhbGUud2l0aGRyYXdPd25lckV0aCgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlQWN0aXZlKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNhbGUuY3Jvd2RzYWxlQWN0aXZlKCk7CiAgfQoKICBmdW5jdGlvbiBjcm93ZHNhbGVFbmRlZCgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLmNyb3dkc2FsZUVuZGVkKCk7CiAgfQoKICBmdW5jdGlvbiBzZXRUb2tlbkV4Y2hhbmdlUmF0ZSh1aW50MjU2IF9leGNoYW5nZVJhdGUpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLnNldFRva2VuRXhjaGFuZ2VSYXRlKF9leGNoYW5nZVJhdGUpOwogIH0KCiAgZnVuY3Rpb24gc2V0VG9rZW5zKCkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNhbGUuc2V0VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiBnZXRPd25lcigpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uub3duZXI7CiAgfQoKICBmdW5jdGlvbiBnZXRUb2tlbnNQZXJFdGgoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gc2FsZS5iYXNlLnRva2Vuc1BlckV0aDsKICB9CgogIGZ1bmN0aW9uIGdldEV4Y2hhbmdlUmF0ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2UuZXhjaGFuZ2VSYXRlOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q2FwQW1vdW50KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICByZXR1cm4gc2FsZS5iYXNlLmNhcEFtb3VudDsKICB9CgogIGZ1bmN0aW9uIGdldFN0YXJ0VGltZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uuc3RhcnRUaW1lOwogIH0KCiAgZnVuY3Rpb24gZ2V0RW5kVGltZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2UuZW5kVGltZTsKICB9CgogIGZ1bmN0aW9uIGdldEV0aFJhaXNlZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uub3duZXJCYWxhbmNlOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0aW9uKGFkZHJlc3MgX2J1eWVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgCXJldHVybiBzYWxlLmJhc2UuaGFzQ29udHJpYnV0ZWRbX2J1eWVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2VuUHVyY2hhc2UoYWRkcmVzcyBfYnV5ZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAJcmV0dXJuIHNhbGUuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFtfYnV5ZXJdOwogIH0KCiAgZnVuY3Rpb24gZ2V0TGVmdG92ZXJXZWkoYWRkcmVzcyBfYnV5ZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2UubGVmdG92ZXJXZWlbX2J1eWVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFNhbGVEYXRhKHVpbnQyNTYgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2WzNdKSB7CiAgICByZXR1cm4gc2FsZS5nZXRTYWxlRGF0YSh0aW1lc3RhbXApOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uuc3RhcnRpbmdUb2tlbkJhbGFuY2UgLSBzYWxlLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2FsZS5iYXNlLm93bmVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFBlcmNlbnRCdXJuKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5wZXJjZW50QnVybjsKICB9Cn0KCmxpYnJhcnkgQ3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CgogIHN0cnVjdCBDcm93ZHNhbGVTdG9yYWdlIHsKICAJYWRkcmVzcyBvd25lcjsgICAgIC8vb3duZXIgb2YgdGhlIGNyb3dkc2FsZQoKICAJdWludDI1NiB0b2tlbnNQZXJFdGg7ICAvL251bWJlciBvZiB0b2tlbnMgcmVjZWl2ZWQgcGVyIGV0aGVyCiAgCXVpbnQyNTYgY2FwQW1vdW50OyAvL01heGltdW0gYW1vdW50IHRvIGJlIHJhaXNlZCBpbiB3ZWkKICAJdWludDI1NiBzdGFydFRpbWU7IC8vSUNPIHN0YXJ0IHRpbWUsIHRpbWVzdGFtcAogIAl1aW50MjU2IGVuZFRpbWU7IC8vSUNPIGVuZCB0aW1lLCB0aW1lc3RhbXAgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkCiAgICB1aW50MjU2IGV4Y2hhbmdlUmF0ZTsgLy9jZW50cy9FVEggZXhjaGFuZ2UgcmF0ZSBhdCB0aGUgdGltZSBvZiB0aGUgc2FsZQogICAgdWludDI1NiBvd25lckJhbGFuY2U7IC8vb3duZXIgd2VpIEJhbGFuY2UKICAgIHVpbnQyNTYgc3RhcnRpbmdUb2tlbkJhbGFuY2U7IC8vaW5pdGlhbCBhbW91bnQgb2YgdG9rZW5zIGZvciBzYWxlCiAgICB1aW50MjU2W10gbWlsZXN0b25lVGltZXM7IC8vQXJyYXkgb2YgdGltZXN0YW1wcyB3aGVuIHRva2VuIHByaWNlIGFuZCBhZGRyZXNzIGNhcCBjaGFuZ2VzCiAgICB1aW50OCBjdXJyZW50TWlsZXN0b25lOyAvL1BvaW50ZXIgdG8gdGhlIGN1cnJlbnQgbWlsZXN0b25lCiAgICB1aW50OCB0b2tlbkRlY2ltYWxzOyAvL3N0b3JlZCB0b2tlbiBkZWNpbWFscyBmb3IgY2FsY3VsYXRpb24gbGF0ZXIKICAgIHVpbnQ4IHBlcmNlbnRCdXJuOyAvL3BlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAgIGJvb2wgdG9rZW5zU2V0OyAvL3RydWUgaWYgdG9rZW5zIGhhdmUgYmVlbiBwcmVwYXJlZCBmb3IgY3Jvd2RzYWxlCiAgICBib29sIHJhdGVTZXQ7IC8vdHJ1ZSBpZiBleGNoYW5nZSByYXRlIGhhcyBiZWVuIHNldAoKICAgIC8vTWFwcyB0aW1lc3RhbXAgdG8gdG9rZW4gcHJpY2UgYW5kIGFkZHJlc3MgcHVyY2hhc2UgY2FwIHN0YXJ0aW5nIGF0IHRoYXQgdGltZQogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2WzJdKSBzYWxlRGF0YTsKCiAgICAvL3Nob3dzIGhvdyBtdWNoIHdlaSBhbiBhZGRyZXNzIGhhcyBjb250cmlidXRlZAogIAltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGhhc0NvbnRyaWJ1dGVkOwoKICAgIC8vRm9yIHRva2VuIHdpdGhkcmF3IGZ1bmN0aW9uLCBtYXBzIGEgdXNlciBhZGRyZXNzIHRvIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoZXkgY2FuIHdpdGhkcmF3CiAgCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgd2l0aGRyYXdUb2tlbnNNYXA7CgogICAgLy8gYW55IGxlZnRvdmVyIHdlaSB0aGF0IGJ1eWVycyBjb250cmlidXRlZCB0aGF0IGRpZG4ndCBhZGQgdXAgdG8gYSB3aG9sZSB0b2tlbiBhbW91bnQKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgbGVmdG92ZXJXZWk7CgogIAlDcm93ZHNhbGVUb2tlbiB0b2tlbjsgLy90b2tlbiBiZWluZyBzb2xkCiAgfQoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBhZGRyZXNzIGhhcyB3aXRoZHJhd24gdGhlaXIgc3VwcGx5IG9mIHRva2VucwogIGV2ZW50IExvZ1Rva2Vuc1dpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgX2JpZGRlciwgdWludDI1NiBBbW91bnQpOwoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBhZGRyZXNzIGhhcyB3aXRoZHJhd24gdGhlaXIgc3VwcGx5IG9mIGV4dHJhIHdlaQogIGV2ZW50IExvZ1dlaVdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgX2JpZGRlciwgdWludDI1NiBBbW91bnQpOwoKICAvLyBMb2dzIHdoZW4gb3duZXIgaGFzIHB1bGxlZCBldGgKICBldmVudCBMb2dPd25lckV0aFdpdGhkcmF3bihhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKCiAgLy8gR2VuZXJpYyBOb3RpY2UgbWVzc2FnZSB0aGF0IGluY2x1ZGVzIGFuZCBhZGRyZXNzIGFuZCBudW1iZXIKICBldmVudCBMb2dOb3RpY2VNc2coYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgdmFsdWUsIHN0cmluZyBNc2cpOwoKICAvLyBJbmRpY2F0ZXMgd2hlbiBhbiBlcnJvciBoYXMgb2NjdXJyZWQgaW4gdGhlIGV4ZWN1dGlvbiBvZiBhIGZ1bmN0aW9uCiAgZXZlbnQgTG9nRXJyb3JNc2coc3RyaW5nIE1zZyk7CgogIC8vLyBAZGV2IENhbGxlZCBieSBhIGNyb3dkc2FsZSBjb250cmFjdCB1cG9uIGNyZWF0aW9uLgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiBjcm93ZHNhbGUgb3duZXIKICAvLy8gQHBhcmFtIF9zYWxlRGF0YSBBcnJheSBvZiAzIGl0ZW0gc2V0cyBzdWNoIHRoYXQsIGluIGVhY2ggMyBlbGVtZW50CiAgLy8vIHNldCwgMSBpcyB0aW1lc3RhbXAsIDIgaXMgcHJpY2UgaW4gY2VudHMgYXQgdGhhdCB0aW1lLAogIC8vLyAzIGlzIGFkZHJlc3MgdG9rZW4gcHVyY2hhc2UgY2FwIGF0IHRoYXQgdGltZSwgMCBpZiBubyBhZGRyZXNzIGNhcAogIC8vLyBAcGFyYW0gX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlIEV4Y2hhbmdlIHJhdGUgb2YgY2VudHMvRVRICiAgLy8vIEBwYXJhbSBfY2FwQW1vdW50SW5DZW50cyBUb3RhbCB0byBiZSByYWlzZWQgaW4gY2VudHMKICAvLy8gQHBhcmFtIF9lbmRUaW1lIFRpbWVzdGFtcCBvZiBzYWxlIGVuZCB0aW1lCiAgLy8vIEBwYXJhbSBfcGVyY2VudEJ1cm4gUGVyY2VudGFnZSBvZiBleHRyYSB0b2tlbnMgdG8gYnVybgogIC8vLyBAcGFyYW0gX3Rva2VuIFRva2VuIGJlaW5nIHNvbGQKICBmdW5jdGlvbiBpbml0KENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLAogICAgICAgICAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgICAgICAgICB1aW50MjU2W10gX3NhbGVEYXRhLAogICAgICAgICAgICAgICAgdWludDI1NiBfZmFsbGJhY2tFeGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9jYXBBbW91bnRJbkNlbnRzLAogICAgICAgICAgICAgICAgdWludDI1NiBfZW5kVGltZSwKICAgICAgICAgICAgICAgIHVpbnQ4IF9wZXJjZW50QnVybiwKICAgICAgICAgICAgICAgIENyb3dkc2FsZVRva2VuIF90b2tlbikKICB7CiAgCXJlcXVpcmUoc2VsZi5jYXBBbW91bnQgPT0gMCk7CiAgCXJlcXVpcmUoc2VsZi5vd25lciA9PSAwKTsKICAgIHJlcXVpcmUoX3NhbGVEYXRhLmxlbmd0aCA+IDApOwogICAgcmVxdWlyZSgoX3NhbGVEYXRhLmxlbmd0aCUzKSA9PSAwKTsgLy8gZW5zdXJlIHNhbGVEYXRhIGlzIDMtaXRlbSBzZXRzCiAgICByZXF1aXJlKF9zYWxlRGF0YVswXSA+IChub3cgKyAzIGRheXMpKTsKICAgIHJlcXVpcmUoX2VuZFRpbWUgPiBfc2FsZURhdGFbMF0pOwogICAgcmVxdWlyZShfY2FwQW1vdW50SW5DZW50cyA+IDApOwogICAgcmVxdWlyZShfb3duZXIgPiAwKTsKICAgIHJlcXVpcmUoX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlID4gMCk7CiAgICByZXF1aXJlKF9wZXJjZW50QnVybiA8PSAxMDApOwogICAgc2VsZi5vd25lciA9IF9vd25lcjsKICAgIHNlbGYuY2FwQW1vdW50ID0gKChfY2FwQW1vdW50SW5DZW50cy9fZmFsbGJhY2tFeGNoYW5nZVJhdGUpICsgMSkqKDEwKioxOCk7CiAgICBzZWxmLnN0YXJ0VGltZSA9IF9zYWxlRGF0YVswXTsKICAgIHNlbGYuZW5kVGltZSA9IF9lbmRUaW1lOwogICAgc2VsZi50b2tlbiA9IF90b2tlbjsKICAgIHNlbGYudG9rZW5EZWNpbWFscyA9IF90b2tlbi5kZWNpbWFscygpOwogICAgc2VsZi5wZXJjZW50QnVybiA9IF9wZXJjZW50QnVybjsKICAgIHNlbGYuZXhjaGFuZ2VSYXRlID0gX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlOwoKICAgIHVpbnQyNTYgX3RlbXBUaW1lOwogICAgZm9yKHVpbnQyNTYgaSA9IDA7IGkgPCBfc2FsZURhdGEubGVuZ3RoOyBpICs9IDMpewogICAgICByZXF1aXJlKF9zYWxlRGF0YVtpXSA+IF90ZW1wVGltZSk7CiAgICAgIHJlcXVpcmUoX3NhbGVEYXRhW2kgKyAxXSA+IDApOwogICAgICByZXF1aXJlKChfc2FsZURhdGFbaSArIDJdID09IDApIHx8IChfc2FsZURhdGFbaSArIDJdID49IDEwMCkpOwogICAgICBzZWxmLm1pbGVzdG9uZVRpbWVzLnB1c2goX3NhbGVEYXRhW2ldKTsKICAgICAgc2VsZi5zYWxlRGF0YVtfc2FsZURhdGFbaV1dWzBdID0gX3NhbGVEYXRhW2kgKyAxXTsKICAgICAgc2VsZi5zYWxlRGF0YVtfc2FsZURhdGFbaV1dWzFdID0gX3NhbGVEYXRhW2kgKyAyXTsKICAgICAgX3RlbXBUaW1lID0gX3NhbGVEYXRhW2ldOwogICAgfQogICAgY2hhbmdlVG9rZW5QcmljZShzZWxmLCBfc2FsZURhdGFbMV0pOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBpcyBjdXJyZW50bHkgYWN0aXZlCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiBzdWNjZXNzCiAgZnVuY3Rpb24gY3Jvd2RzYWxlQWN0aXZlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiAobm93ID49IHNlbGYuc3RhcnRUaW1lICYmIG5vdyA8PSBzZWxmLmVuZFRpbWUpOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHN1Y2Nlc3MKICBmdW5jdGlvbiBjcm93ZHNhbGVFbmRlZChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogIAlyZXR1cm4gbm93ID4gc2VsZi5lbmRUaW1lOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdG8gY2hlY2sgaWYgYSBwdXJjaGFzZSBpcyB2YWxpZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdHJhbnNhY3Rpb24gY2FuIGJ1eSB0b2tlbnMKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgaWYgKGNyb3dkc2FsZUFjdGl2ZShzZWxmKSAmJiBub25aZXJvUHVyY2hhc2UpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICBMb2dFcnJvck1zZygiSW52YWxpZCBQdXJjaGFzZSEgQ2hlY2sgc2VuZCB0aW1lIGFuZCBhbW91bnQgb2YgZXRoZXIuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIGNhbGxlZCBieSBwdXJjaGFzZXJzIHRvIHB1bGwgdG9rZW5zCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRva2VucyB3ZXJlIHdpdGhkcmF3bgogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICBib29sIG9rOwoKICAgIGlmIChzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID09IDApIHsKICAgICAgTG9nRXJyb3JNc2coIlNlbmRlciBoYXMgbm8gdG9rZW5zIHRvIHdpdGhkcmF3ISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcikgewogICAgICBpZighY3Jvd2RzYWxlRW5kZWQoc2VsZikpewogICAgICAgIExvZ0Vycm9yTXNnKCJPd25lciBjYW5ub3Qgd2l0aGRyYXcgZXh0cmEgdG9rZW5zIHVudGlsIGFmdGVyIHRoZSBzYWxlISIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZihzZWxmLnBlcmNlbnRCdXJuID4gMCl7CiAgICAgICAgICB1aW50MjU2IF9idXJuQW1vdW50ID0gKHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gKiBzZWxmLnBlcmNlbnRCdXJuKS8xMDA7CiAgICAgICAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSAtIF9idXJuQW1vdW50OwogICAgICAgICAgb2sgPSBzZWxmLnRva2VuLmJ1cm5Ub2tlbihfYnVybkFtb3VudCk7CiAgICAgICAgICByZXF1aXJlKG9rKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICB2YXIgdG90YWwgPSBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IDA7CiAgICBvayA9IHNlbGYudG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgdG90YWwpOwogICAgcmVxdWlyZShvayk7CiAgICBMb2dUb2tlbnNXaXRoZHJhd24obXNnLnNlbmRlciwgdG90YWwpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBGdW5jdGlvbiBjYWxsZWQgYnkgcHVyY2hhc2VycyB0byBwdWxsIGxlZnRvdmVyIHdlaSBmcm9tIHRoZWlyIHB1cmNoYXNlcwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB3ZWkgd2FzIHdpdGhkcmF3bgogIGZ1bmN0aW9uIHdpdGhkcmF3TGVmdG92ZXJXZWkoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoc2VsZi5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXSA+IDApOwogICAgaWYgKHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gPT0gMCkgewogICAgICBMb2dFcnJvck1zZygiU2VuZGVyIGhhcyBubyBleHRyYSB3ZWkgdG8gd2l0aGRyYXchIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICB2YXIgdG90YWwgPSBzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdOwogICAgc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSA9IDA7CiAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvdGFsKTsKICAgIExvZ1dlaVdpdGhkcmF3bihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IHNlbmQgZXRoZXIgZnJvbSB0aGUgY29tcGxldGVkIGNyb3dkc2FsZSB0byB0aGUgb3duZXJzIHdhbGxldCBhZGRyZXNzCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIG93bmVyIHdpdGhkcmV3IGV0aAogIGZ1bmN0aW9uIHdpdGhkcmF3T3duZXJFdGgoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIGlmICgoIWNyb3dkc2FsZUVuZGVkKHNlbGYpKSAmJiAoc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk+MCkpIHsKICAgICAgTG9nRXJyb3JNc2coIkNhbm5vdCB3aXRoZHJhdyBvd25lciBldGhlciB1bnRpbCBhZnRlciB0aGUgc2FsZSEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoc2VsZi5vd25lckJhbGFuY2UgPiAwKTsKCiAgICB1aW50MjU2IGFtb3VudCA9IHNlbGYub3duZXJCYWxhbmNlOwogICAgc2VsZi5vd25lckJhbGFuY2UgPSAwOwogICAgc2VsZi5vd25lci50cmFuc2ZlcihhbW91bnQpOwogICAgTG9nT3duZXJFdGhXaXRoZHJhd24obXNnLnNlbmRlcixhbW91bnQsIkNyb3dkc2FsZSBvd25lciBoYXMgd2l0aGRyYXduIGFsbCBmdW5kcyEiKTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIHRvIGNoYW5nZSB0aGUgcHJpY2Ugb2YgdGhlIHRva2VuCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9uZXdQcmljZSBuZXcgdG9rZW4gcHJpY2UgKGFtb3VudCBvZiB0b2tlbnMgcGVyIGV0aGVyKQogIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRva2VuIHByaWNlIGNoYW5nZWQgc3VjY2Vzc2Z1bGx5CiAgZnVuY3Rpb24gY2hhbmdlVG9rZW5QcmljZShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZix1aW50MjU2IF9uZXdQcmljZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogIAlyZXF1aXJlKF9uZXdQcmljZSA+IDApOwoKICAgIHVpbnQyNTYgcmVzdWx0OwogICAgdWludDI1NiByZW1haW5kZXI7CgogICAgcmVzdWx0ID0gc2VsZi5leGNoYW5nZVJhdGUgLyBfbmV3UHJpY2U7CiAgICByZW1haW5kZXIgPSBzZWxmLmV4Y2hhbmdlUmF0ZSAlIF9uZXdQcmljZTsKICAgIGlmKHJlbWFpbmRlciA+IDApIHsKICAgICAgc2VsZi50b2tlbnNQZXJFdGggPSByZXN1bHQgKyAxOwogICAgfSBlbHNlIHsKICAgICAgc2VsZi50b2tlbnNQZXJFdGggPSByZXN1bHQ7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHRocmVlIGRheXMgYmVmb3JlIHRoZSBzYWxlIHRvIHNldCB0aGUgdG9rZW4gYW5kIHByaWNlCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9leGNoYW5nZVJhdGUgIEVUSCBleGNoYW5nZSByYXRlIGV4cHJlc3NlZCBpbiBjZW50cy9FVEgKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSBleGNoYW5nZSByYXRlIGhhcyBiZWVuIHNldAogIGZ1bmN0aW9uIHNldFRva2VuRXhjaGFuZ2VSYXRlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9leGNoYW5nZVJhdGUpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoKG5vdyA+IChzZWxmLnN0YXJ0VGltZSAtIDMgZGF5cykpICYmIChub3cgPCAoc2VsZi5zdGFydFRpbWUpKSk7CiAgICByZXF1aXJlKCFzZWxmLnJhdGVTZXQpOyAgIC8vIHRoZSBleGNoYW5nZSByYXRlIGNhbiBvbmx5IGJlIHNldCBvbmNlIQogICAgcmVxdWlyZShzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKSA+IDApOwogICAgcmVxdWlyZShfZXhjaGFuZ2VSYXRlID4gMCk7CgogICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50czsKICAgIHVpbnQyNTYgX3Rva2VuQmFsYW5jZTsKICAgIGJvb2wgZXJyOwoKICAgIChlcnIsIF9jYXBBbW91bnRJbkNlbnRzKSA9IHNlbGYuZXhjaGFuZ2VSYXRlLnRpbWVzKHNlbGYuY2FwQW1vdW50KTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgX3Rva2VuQmFsYW5jZSA9IHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IF90b2tlbkJhbGFuY2U7CiAgICBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYudG9rZW5zU2V0ID0gdHJ1ZTsKCiAgICBzZWxmLmV4Y2hhbmdlUmF0ZSA9IF9leGNoYW5nZVJhdGU7CiAgICBzZWxmLmNhcEFtb3VudCA9IChfY2FwQW1vdW50SW5DZW50cy9fZXhjaGFuZ2VSYXRlKSArIDE7CiAgICBjaGFuZ2VUb2tlblByaWNlKHNlbGYsc2VsZi5zYWxlRGF0YVtzZWxmLm1pbGVzdG9uZVRpbWVzWzBdXVswXSk7CiAgICBzZWxmLnJhdGVTZXQgPSB0cnVlOwoKICAgIExvZ05vdGljZU1zZyhtc2cuc2VuZGVyLHNlbGYudG9rZW5zUGVyRXRoLCJPd25lciBoYXMgc2VudCB0aGUgZXhjaGFuZ2UgUmF0ZSBhbmQgdG9rZW5zIGJvdWdodCBwZXIgRVRIISIpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBmYWxsYmFjayBmdW5jdGlvbiB0byBzZXQgdG9rZW5zIGlmIHRoZSBleGNoYW5nZSByYXRlIGZ1bmN0aW9uIHdhcyBub3QgY2FsbGVkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRva2VucyBzZXQgc3VjY2Vzc2Z1bGx5CiAgZnVuY3Rpb24gc2V0VG9rZW5zKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsZi5vd25lcik7CiAgICByZXF1aXJlKCFzZWxmLnRva2Vuc1NldCk7CgogICAgdWludDI1NiBfdG9rZW5CYWxhbmNlOwoKICAgIF90b2tlbkJhbGFuY2UgPSBzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPSBfdG9rZW5CYWxhbmNlOwogICAgc2VsZi5zdGFydGluZ1Rva2VuQmFsYW5jZSA9IF90b2tlbkJhbGFuY2U7CiAgICBzZWxmLnRva2Vuc1NldCA9IHRydWU7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBHZXRzIHRoZSBwcmljZSBhbmQgYnV5IGNhcCBmb3IgaW5kaXZpZHVhbCBhZGRyZXNzZXMgYXQgdGhlIGdpdmVuIG1pbGVzdG9uZSBpbmRleAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgQ3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSB0aW1lc3RhbXAgVGltZSBkdXJpbmcgc2FsZSBmb3Igd2hpY2ggZGF0YSBpcyByZXF1ZXN0ZWQKICAvLy8gQHJldHVybiBBIDMtZWxlbWVudCBhcnJheSB3aXRoIDAgdGhlIHRpbWVzdGFtcCwgMSB0aGUgcHJpY2UgaW4gY2VudHMsIDIgdGhlIGFkZHJlc3MgY2FwCiAgZnVuY3Rpb24gZ2V0U2FsZURhdGEoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2WzNdKSB7CiAgICB1aW50MjU2WzNdIG1lbW9yeSBfdGhpc0RhdGE7CiAgICB1aW50MjU2IGluZGV4OwoKICAgIHdoaWxlKChpbmRleCA8IHNlbGYubWlsZXN0b25lVGltZXMubGVuZ3RoKSAmJiAoc2VsZi5taWxlc3RvbmVUaW1lc1tpbmRleF0gPCB0aW1lc3RhbXApKSB7CiAgICAgIGluZGV4Kys7CiAgICB9CiAgICBpZihpbmRleCA9PSAwKQogICAgICBpbmRleCsrOwoKICAgIF90aGlzRGF0YVswXSA9IHNlbGYubWlsZXN0b25lVGltZXNbaW5kZXggLSAxXTsKICAgIF90aGlzRGF0YVsxXSA9IHNlbGYuc2FsZURhdGFbX3RoaXNEYXRhWzBdXVswXTsKICAgIF90aGlzRGF0YVsyXSA9IHNlbGYuc2FsZURhdGFbX3RoaXNEYXRhWzBdXVsxXTsKICAgIHJldHVybiBfdGhpc0RhdGE7CiAgfQoKICAvLy8gQGRldiBHZXRzIHRoZSBudW1iZXIgb2YgdG9rZW5zIHNvbGQgdGh1cyBmYXIKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIE51bWJlciBvZiB0b2tlbnMgc29sZAogIGZ1bmN0aW9uIGdldFRva2Vuc1NvbGQoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlIC0gc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgfQp9CgpsaWJyYXJ5IERpcmVjdENyb3dkc2FsZUxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwogIHVzaW5nIENyb3dkc2FsZUxpYiBmb3IgQ3Jvd2RzYWxlTGliLkNyb3dkc2FsZVN0b3JhZ2U7CgogIHN0cnVjdCBEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHsKCiAgCUNyb3dkc2FsZUxpYi5Dcm93ZHNhbGVTdG9yYWdlIGJhc2U7IC8vIGJhc2Ugc3RvcmFnZSBmcm9tIENyb3dkc2FsZUxpYgoKICB9CgogIGV2ZW50IExvZ1Rva2Vuc0JvdWdodChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBMb2dBZGRyZXNzQ2FwRXhjZWVkZWQoYWRkcmVzcyBpbmRleGVkIGJ1eWVyLCB1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nRXJyb3JNc2codWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwogIGV2ZW50IExvZ1Rva2VuUHJpY2VDaGFuZ2UodWludDI1NiBhbW91bnQsIHN0cmluZyBNc2cpOwoKCiAgLy8vIEBkZXYgQ2FsbGVkIGJ5IGEgY3Jvd2RzYWxlIGNvbnRyYWN0IHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9vd25lciBBZGRyZXNzIG9mIGNyb3dkc2FsZSBvd25lcgogIC8vLyBAcGFyYW0gX3NhbGVEYXRhIEFycmF5IG9mIDMgaXRlbSBzZXRzIHN1Y2ggdGhhdCwgaW4gZWFjaCAzIGVsZW1lbnQKICAvLy8gc2V0LCAxIGlzIHRpbWVzdGFtcCwgMiBpcyBwcmljZSBpbiBjZW50cyBhdCB0aGF0IHRpbWUsCiAgLy8vIDMgaXMgYWRkcmVzcyBwdXJjaGFzZSBjYXAgYXQgdGhhdCB0aW1lLCAwIGlmIG5vIGFkZHJlc3MgY2FwCiAgLy8vIEBwYXJhbSBfZmFsbGJhY2tFeGNoYW5nZVJhdGUgRXhjaGFuZ2UgcmF0ZSBvZiBjZW50cy9FVEgKICAvLy8gQHBhcmFtIF9jYXBBbW91bnRJbkNlbnRzIFRvdGFsIHRvIGJlIHJhaXNlZCBpbiBjZW50cwogIC8vLyBAcGFyYW0gX2VuZFRpbWUgVGltZXN0YW1wIG9mIHNhbGUgZW5kIHRpbWUKICAvLy8gQHBhcmFtIF9wZXJjZW50QnVybiBQZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgLy8vIEBwYXJhbSBfdG9rZW4gVG9rZW4gYmVpbmcgc29sZAogIGZ1bmN0aW9uIGluaXQoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICBhZGRyZXNzIF9vd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTZbXSBfc2FsZURhdGEsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2NhcEFtb3VudEluQ2VudHMsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9lbmRUaW1lLAogICAgICAgICAgICAgICAgdWludDggX3BlcmNlbnRCdXJuLAogICAgICAgICAgICAgICAgQ3Jvd2RzYWxlVG9rZW4gX3Rva2VuKQogIHsKICAJc2VsZi5iYXNlLmluaXQoX293bmVyLAogICAgICAgICAgICAgICAgX3NhbGVEYXRhLAogICAgICAgICAgICAgICAgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgX2NhcEFtb3VudEluQ2VudHMsCiAgICAgICAgICAgICAgICBfZW5kVGltZSwKICAgICAgICAgICAgICAgIF9wZXJjZW50QnVybiwKICAgICAgICAgICAgICAgIF90b2tlbik7CiAgfQoKICAvLy8gQGRldiBDYWxsZWQgd2hlbiBhbiBhZGRyZXNzIHdhbnRzIHRvIHB1cmNoYXNlIHRva2VucwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfYW1vdW50IGFtb3VudCBvZiB3ZWkgdGhhdCB0aGUgYnV5ZXIgaXMgc2VuZGluZwogIC8vLyBAcmV0dXJuIHRydWUgb24gc3VjY2VzZnVsIHB1cmNoYXNlCiAgZnVuY3Rpb24gcmVjZWl2ZVB1cmNoYXNlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBzZWxmLmJhc2Uub3duZXIpOwogIAlyZXF1aXJlKHNlbGYuYmFzZS52YWxpZFB1cmNoYXNlKCkpOwoKICAgIHJlcXVpcmUoKHNlbGYuYmFzZS5vd25lckJhbGFuY2UgKyBfYW1vdW50KSA8PSBzZWxmLmJhc2UuY2FwQW1vdW50KTsKCiAgCS8vIGlmIHRoZSB0b2tlbiBwcmljZSBpbmNyZWFzZSBpbnRlcnZhbCBoYXMgcGFzc2VkLCB1cGRhdGUgdGhlIGN1cnJlbnQgZGF5IGFuZCBjaGFuZ2UgdGhlIHRva2VuIHByaWNlCiAgCWlmICgoc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzLmxlbmd0aCA+IHNlbGYuYmFzZS5jdXJyZW50TWlsZXN0b25lICsgMSkgJiYKICAgICAgICAobm93ID4gc2VsZi5iYXNlLm1pbGVzdG9uZVRpbWVzW3NlbGYuYmFzZS5jdXJyZW50TWlsZXN0b25lICsgMV0pKQogICAgewogICAgICAgIHdoaWxlKChzZWxmLmJhc2UubWlsZXN0b25lVGltZXMubGVuZ3RoID4gc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxKSAmJgogICAgICAgICAgICAgIChub3cgPiBzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxXSkpCiAgICAgICAgewogICAgICAgICAgc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKz0gMTsKICAgICAgICB9CgogICAgICAgIHNlbGYuYmFzZS5jaGFuZ2VUb2tlblByaWNlKHNlbGYuYmFzZS5zYWxlRGF0YVtzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmVdXVswXSk7CiAgICAgICAgTG9nVG9rZW5QcmljZUNoYW5nZShzZWxmLmJhc2UudG9rZW5zUGVyRXRoLCJUb2tlbiBQcmljZSBoYXMgY2hhbmdlZCEiKTsKICAgIH0KCiAgCXVpbnQyNTYgX251bVRva2VuczsgLy9udW1iZXIgb2YgdG9rZW5zIHRoYXQgd2lsbCBiZSBwdXJjaGFzZWQKICAgIHVpbnQyNTYgX25ld0JhbGFuY2U7IC8vdGhlIG5ldyBiYWxhbmNlIG9mIHRoZSBvd25lciBvZiB0aGUgY3Jvd2RzYWxlCiAgICB1aW50MjU2IF93ZWlUb2tlbnM7IC8vdGVtcCBjYWxjIGhvbGRlcgogICAgdWludDI1NiBfemVyb3M7IC8vZm9yIGNhbGN1bGF0aW5nIHRva2VuCiAgICB1aW50MjU2IF9sZWZ0b3ZlcldlaTsgLy93ZWkgY2hhbmdlIGZvciBwdXJjaGFzZXIKICAgIHVpbnQyNTYgX3JlbWFpbmRlcjsgLy90ZW1wIGNhbGMgaG9sZGVyCiAgICBib29sIGVycjsKCiAgICAvLyBGaW5kIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFzIGEgZnVuY3Rpb24gaW4gd2VpCiAgICAoZXJyLF93ZWlUb2tlbnMpID0gX2Ftb3VudC50aW1lcyhzZWxmLmJhc2UudG9rZW5zUGVyRXRoKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgaWYoc2VsZi5iYXNlLnRva2VuRGVjaW1hbHMgPD0gMTgpewogICAgICBfemVyb3MgPSAxMCoqKDE4LXVpbnQyNTYoc2VsZi5iYXNlLnRva2VuRGVjaW1hbHMpKTsKICAgICAgX251bVRva2VucyA9IF93ZWlUb2tlbnMvX3plcm9zOwogICAgICBfbGVmdG92ZXJXZWkgPSBfd2VpVG9rZW5zICUgX3plcm9zOwogICAgICBzZWxmLmJhc2UubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl0gKz0gX2xlZnRvdmVyV2VpOwogICAgfSBlbHNlIHsKICAgICAgX3plcm9zID0gMTAqKih1aW50MjU2KHNlbGYuYmFzZS50b2tlbkRlY2ltYWxzKS0xOCk7CiAgICAgIF9udW1Ub2tlbnMgPSBfd2VpVG9rZW5zKl96ZXJvczsKICAgIH0KCiAgICAvLyBjYW4ndCBvdmVyZmxvdyBiZWNhdXNlIGl0IGlzIHVuZGVyIHRoZSBjYXAKICAgIHNlbGYuYmFzZS5oYXNDb250cmlidXRlZFttc2cuc2VuZGVyXSArPSBfYW1vdW50IC0gX2xlZnRvdmVyV2VpOwoKICAgIHJlcXVpcmUoX251bVRva2VucyA8PSBzZWxmLmJhc2UudG9rZW4uYmFsYW5jZU9mKHRoaXMpKTsKCiAgICAvLyBjYWxjdWxhdGUgdGhlIGFtb3VudCBvZiBldGhlciBpbiB0aGUgb3duZXJzIGJhbGFuY2UKICAgIChlcnIsX25ld0JhbGFuY2UpID0gc2VsZi5iYXNlLm93bmVyQmFsYW5jZS5wbHVzKF9hbW91bnQtX2xlZnRvdmVyV2VpKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi5iYXNlLm93bmVyQmFsYW5jZSA9IF9uZXdCYWxhbmNlOyAgIC8vICJkZXBvc2l0IiB0aGUgYW1vdW50CgogICAgLy8gY2FuJ3Qgb3ZlcmZsb3cgYmVjYXVzZSBpdCB3aWxsIGJlIHVuZGVyIHRoZSBjYXAKCSAgc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdICs9IF9udW1Ub2tlbnM7CgogICAgLy9zdWJ0cmFjdCB0b2tlbnMgZnJvbSBvd25lcidzIHNoYXJlCiAgICAoZXJyLF9yZW1haW5kZXIpID0gc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW3NlbGYuYmFzZS5vd25lcl0ubWludXMoX251bVRva2Vucyk7CiAgICBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2VsZi5iYXNlLm93bmVyXSA9IF9yZW1haW5kZXI7CgoJICBMb2dUb2tlbnNCb3VnaHQobXNnLnNlbmRlciwgX251bVRva2Vucyk7CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKkZ1bmN0aW9ucyAiaW5oZXJpdGVkIiBmcm9tIENyb3dkc2FsZUxpYiBsaWJyYXJ5Ki8KCiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2V4Y2hhbmdlUmF0ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5zZXRUb2tlbkV4Y2hhbmdlUmF0ZShfZXhjaGFuZ2VSYXRlKTsKICB9CgogIGZ1bmN0aW9uIHNldFRva2VucyhEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5zZXRUb2tlbnMoKTsKICB9CgogIGZ1bmN0aW9uIGdldFNhbGVEYXRhKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IHRpbWVzdGFtcCkgcmV0dXJucyAodWludDI1NlszXSkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5nZXRTYWxlRGF0YSh0aW1lc3RhbXApOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYuYmFzZS5nZXRUb2tlbnNTb2xkKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd1Rva2VucygpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdMZWZ0b3ZlcldlaShEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd0xlZnRvdmVyV2VpKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd093bmVyRXRoKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLndpdGhkcmF3T3duZXJFdGgoKTsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUFjdGl2ZShEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5jcm93ZHNhbGVBY3RpdmUoKTsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUVuZGVkKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLmNyb3dkc2FsZUVuZGVkKCk7CiAgfQoKICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2VsZi5iYXNlLnZhbGlkUHVyY2hhc2UoKTsKICB9Cn0KCmxpYnJhcnkgVG9rZW5MaWIgewogIHVzaW5nIEJhc2ljTWF0aExpYiBmb3IgdWludDI1NjsKCiAgc3RydWN0IFRva2VuU3RvcmFnZSB7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIHN0cmluZyBuYW1lOwogICAgc3RyaW5nIHN5bWJvbDsKICAgIHVpbnQyNTYgdG90YWxTdXBwbHk7CiAgICB1aW50MjU2IElOSVRJQUxfU1VQUExZOwogICAgYWRkcmVzcyBvd25lcjsKICAgIHVpbnQ4IGRlY2ltYWxzOwogICAgYm9vbCBzdGlsbE1pbnRpbmc7CiAgfQoKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBPd25lckNoYW5nZShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8pOwogIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgTWludGluZ0Nsb3NlZChib29sIG1pbnRpbmdDbG9zZWQpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgdGhlIFN0YW5kYXJkIFRva2VuIHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfbmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAvLy8gQHBhcmFtIF9zeW1ib2wgU3ltYm9sIG9mIHRoZSBuZXcgdG9rZW4KICAvLy8gQHBhcmFtIF9kZWNpbWFscyBEZWNpbWFsIHBsYWNlcyBmb3IgdGhlIHRva2VuIHJlcHJlc2VudGVkCiAgLy8vIEBwYXJhbSBfaW5pdGlhbF9zdXBwbHkgVGhlIGluaXRpYWwgdG9rZW4gc3VwcGx5CiAgLy8vIEBwYXJhbSBfYWxsb3dNaW50aW5nIFRydWUgaWYgYWRkaXRpb25hbCB0b2tlbnMgY2FuIGJlIGNyZWF0ZWQsIGZhbHNlIG90aGVyd2lzZQogIGZ1bmN0aW9uIGluaXQoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgc3RyaW5nIF9uYW1lLAogICAgICAgICAgICAgICAgc3RyaW5nIF9zeW1ib2wsCiAgICAgICAgICAgICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9pbml0aWFsX3N1cHBseSwKICAgICAgICAgICAgICAgIGJvb2wgX2FsbG93TWludGluZykKICB7CiAgICByZXF1aXJlKHNlbGYuSU5JVElBTF9TVVBQTFkgPT0gMCk7CiAgICBzZWxmLm5hbWUgPSBfbmFtZTsKICAgIHNlbGYuc3ltYm9sID0gX3N5bWJvbDsKICAgIHNlbGYudG90YWxTdXBwbHkgPSBfaW5pdGlhbF9zdXBwbHk7CiAgICBzZWxmLklOSVRJQUxfU1VQUExZID0gX2luaXRpYWxfc3VwcGx5OwogICAgc2VsZi5kZWNpbWFscyA9IF9kZWNpbWFsczsKICAgIHNlbGYub3duZXIgPSBfb3duZXI7CiAgICBzZWxmLnN0aWxsTWludGluZyA9IF9hbGxvd01pbnRpbmc7CiAgICBzZWxmLmJhbGFuY2VzW19vd25lcl0gPSBfaW5pdGlhbF9zdXBwbHk7CiAgfQoKICAvLy8gQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBjYWxsZXIncyBhY2NvdW50IHRvIGFub3RoZXIgYWNjb3VudC4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiB0cmFuc2ZlcihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiBiYWxhbmNlOwoKICAgIChlcnIsYmFsYW5jZSkgPSBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwogICAgc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2U7CiAgICAvL0l0J3Mgbm90IHBvc3NpYmxlIHRvIG92ZXJmbG93IHRva2VuIHN1cHBseQogICAgc2VsZi5iYWxhbmNlc1tfdG9dID0gc2VsZi5iYWxhbmNlc1tfdG9dICsgX3ZhbHVlOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemVkIGNhbGxlciB0cmFuc2ZlcnMgdG9rZW5zIGZyb20gb25lIGFjY291bnQgdG8gYW5vdGhlcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Zyb20gQWRkcmVzcyB0byBzZW5kIHRva2VucyBmcm9tCiAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBzZW5kIHRva2VucyB0bwogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF92YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICB2YXIgX2FsbG93YW5jZSA9IHNlbGYuYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgYmFsYW5jZU93bmVyOwogICAgdWludDI1NiBiYWxhbmNlU3BlbmRlcjsKCiAgICAoZXJyLGJhbGFuY2VPd25lcikgPSBzZWxmLmJhbGFuY2VzW19mcm9tXS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICAoZXJyLGJhbGFuY2VTcGVuZGVyKSA9IF9hbGxvd2FuY2UubWludXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi5iYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlT3duZXI7CiAgICBzZWxmLmFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYmFsYW5jZVNwZW5kZXI7CiAgICBzZWxmLmJhbGFuY2VzW190b10gPSBzZWxmLmJhbGFuY2VzW190b10gKyBfdmFsdWU7CgogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUmV0cmlldmUgdG9rZW4gYmFsYW5jZSBmb3IgYW4gYWNjb3VudAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3MgdG8gcmV0cmlldmUgYmFsYW5jZSBvZgogIC8vLyBAcmV0dXJuIGJhbGFuY2UgVGhlIG51bWJlciBvZiB0b2tlbnMgaW4gdGhlIHN1YmplY3QgYWNjb3VudAogIGZ1bmN0aW9uIGJhbGFuY2VPZihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gc2VsZi5iYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgLy8vIEBkZXYgQXV0aG9yaXplIGFuIGFjY291bnQgdG8gc2VuZCB0b2tlbnMgb24gY2FsbGVyJ3MgYmVoYWxmCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGF1dGhvcml6ZQogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgYXV0aG9yaXplZCBhY2NvdW50IG1heSBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBhcHByb3ZlKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFJlbWFpbmluZyB0b2tlbnMgdGhpcmQgcGFydHkgc3BlbmRlciBoYXMgdG8gc2VuZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gaG9sZGVyCiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGF1dGhvcml6ZWQgc3BlbmRlcgogIC8vLyBAcmV0dXJuIHJlbWFpbmluZyBOdW1iZXIgb2YgdG9rZW5zIHNwZW5kZXIgaGFzIGxlZnQgaW4gb3duZXIncyBhY2NvdW50CiAgZnVuY3Rpb24gYWxsb3dhbmNlKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIHNlbGYuYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZSB0aGlyZCBwYXJ0eSB0cmFuc2ZlciBieSBpbmNyZWFzaW5nL2RlY3JlYXNpbmcgYWxsb3dlZCByYXRoZXIgdGhhbiBzZXR0aW5nIGl0CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGF1dGhvcml6ZQogIC8vLyBAcGFyYW0gX3ZhbHVlQ2hhbmdlIEluY3JlYXNlIG9yIGRlY3JlYXNlIGluIG51bWJlciBvZiB0b2tlbnMgYXV0aG9yaXplZCBhY2NvdW50IG1heSBzZW5kCiAgLy8vIEBwYXJhbSBfaW5jcmVhc2UgVHJ1ZSBpZiBpbmNyZWFzaW5nIGFsbG93YW5jZSwgZmFsc2UgaWYgZGVjcmVhc2luZyBhbGxvd2FuY2UKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGFwcHJvdmVDaGFuZ2UgKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlQ2hhbmdlLCBib29sIF9pbmNyZWFzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHVpbnQyNTYgX25ld0FsbG93ZWQ7CiAgICBib29sIGVycjsKCiAgICBpZihfaW5jcmVhc2UpIHsKICAgICAgKGVyciwgX25ld0FsbG93ZWQpID0gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5wbHVzKF92YWx1ZUNoYW5nZSk7CiAgICAgIHJlcXVpcmUoIWVycik7CgogICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX25ld0FsbG93ZWQ7CiAgICB9IGVsc2UgewogICAgICBpZiAoX3ZhbHVlQ2hhbmdlID4gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSkgewogICAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIF9uZXdBbGxvd2VkID0gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAtIF92YWx1ZUNoYW5nZTsKICAgICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX25ld0FsbG93ZWQ7CiAgICAgIH0KICAgIH0KCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX25ld0FsbG93ZWQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBDaGFuZ2Ugb3duaW5nIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0LCBzcGVjaWZpY2FsbHkgZm9yIG1pbnRpbmcKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9uZXdPd25lciBBZGRyZXNzIGZvciB0aGUgbmV3IG93bmVyCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBjaGFuZ2VPd25lcihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9uZXdPd25lcikgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSgoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKSAmJiAoX25ld093bmVyID4gMCkpOwoKICAgIHNlbGYub3duZXIgPSBfbmV3T3duZXI7CiAgICBPd25lckNoYW5nZShtc2cuc2VuZGVyLCBfbmV3T3duZXIpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBNaW50cyBhZGRpdGlvbmFsIHRva2VucywgbmV3IHRva2VucyBnbyB0byBvd25lcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBOdW1iZXIgb2YgdG9rZW5zIHRvIG1pbnQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIG1pbnRUb2tlbihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcikgJiYgc2VsZi5zdGlsbE1pbnRpbmcpOwogICAgdWludDI1NiBfbmV3QW1vdW50OwogICAgYm9vbCBlcnI7CgogICAgKGVyciwgX25ld0Ftb3VudCkgPSBzZWxmLnRvdGFsU3VwcGx5LnBsdXMoX2Ftb3VudCk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYudG90YWxTdXBwbHkgPSAgX25ld0Ftb3VudDsKICAgIHNlbGYuYmFsYW5jZXNbc2VsZi5vd25lcl0gPSBzZWxmLmJhbGFuY2VzW3NlbGYub3duZXJdICsgX2Ftb3VudDsKICAgIFRyYW5zZmVyKDB4MCwgc2VsZi5vd25lciwgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFBlcm1hbmVudCBzdG9wcyBtaW50aW5nCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBjbG9zZU1pbnQoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpOwoKICAgIHNlbGYuc3RpbGxNaW50aW5nID0gZmFsc2U7CiAgICBNaW50aW5nQ2xvc2VkKHRydWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBQZXJtYW5lbnRseSBidXJuIHRva2VucwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBBbW91bnQgb2YgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGJ1cm5Ub2tlbihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wpIHsKICAgICAgdWludDI1NiBfbmV3QmFsYW5jZTsKICAgICAgYm9vbCBlcnI7CgogICAgICAoZXJyLCBfbmV3QmFsYW5jZSkgPSBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdLm1pbnVzKF9hbW91bnQpOwogICAgICByZXF1aXJlKCFlcnIpOwoKICAgICAgc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IF9uZXdCYWxhbmNlOwogICAgICBzZWxmLnRvdGFsU3VwcGx5ID0gc2VsZi50b3RhbFN1cHBseSAtIF9hbW91bnQ7CiAgICAgIEJ1cm4obXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgX2Ftb3VudCk7CiAgICAgIHJldHVybiB0cnVlOwogIH0KfQoKbGlicmFyeSBCYXNpY01hdGhMaWIgewogIGV2ZW50IEVycihzdHJpbmcgdHlwZUVycik7CgogIC8vLyBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyBvdmVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHByb2R1Y3Qgb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHRpbWVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBtdWwoYSxiKQogICAgICBzd2l0Y2ggb3IoaXN6ZXJvKGIpLCBlcShkaXYocmVzLGIpLCBhKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICAgIGlmIChlcnIpCiAgICAgIEVycigidGltZXMgZnVuYyBvdmVyZmxvdyIpOwogIH0KCiAgLy8vIEBkZXYgRGl2aWRlcyB0d28gbnVtYmVycyBidXQgY2hlY2tzIGZvciAwIGluIHRoZSBkaXZpc29yIGZpcnN0LgogIC8vLyBEb2VzIG5vdCB0aHJvdyBidXQgcmF0aGVyIGxvZ3MgYW4gRXJyIGV2ZW50IGlmIDAgaXMgaW4gdGhlIGRpdmlzb3IuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIGBiYCBpcyAwCiAgLy8vIEByZXR1cm4gcmVzIFRoZSBxdW90aWVudCBvZiBhIGFuZCBiLCBvciAwIGlmIGBiYCBpcyAwCiAgZnVuY3Rpb24gZGl2aWRlZEJ5KHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHN3aXRjaCBpc3plcm8oYikKICAgICAgY2FzZSAwIHsKICAgICAgICByZXMgOj0gZGl2KGEsYikKICAgICAgICBtc3RvcmUoYWRkKG1sb2FkKDB4NDApLDB4MjApLHJlcykKICAgICAgICByZXR1cm4obWxvYWQoMHg0MCksMHg0MCkKICAgICAgfQogICAgfQogICAgRXJyKCJ0cmllZCB0byBkaXZpZGUgYnkgemVybyIpOwogICAgcmV0dXJuICh0cnVlLCAwKTsKICB9CgogIC8vLyBAZGV2IEFkZHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyBvdmVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHN1bSBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gcGx1cyh1aW50MjU2IGEsIHVpbnQyNTYgYikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBlcnIsIHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IGFkZChhLGIpCiAgICAgIHN3aXRjaCBhbmQoZXEoc3ViKHJlcyxiKSwgYSksIG9yKGd0KHJlcyxiKSxlcShyZXMsYikpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogICAgaWYgKGVycikKICAgICAgRXJyKCJwbHVzIGZ1bmMgb3ZlcmZsb3ciKTsKICB9CgogIC8vLyBAZGV2IFN1YnRyYWN0cyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciB1bmRlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgZnVuY3Rpb24gbWludXModWludDI1NiBhLCB1aW50MjU2IGIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IHN1YihhLGIpCiAgICAgIHN3aXRjaCBlcShhbmQoZXEoYWRkKHJlcyxiKSwgYSksIG9yKGx0KHJlcyxhKSwgZXEocmVzLGEpKSksIDEpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgICBpZiAoZXJyKQogICAgICBFcnIoIm1pbnVzIGZ1bmMgdW5kZXJmbG93Iik7CiAgfQp9Cgpjb250cmFjdCBDcm93ZHNhbGVUb2tlbiB7CiAgdXNpbmcgVG9rZW5MaWIgZm9yIFRva2VuTGliLlRva2VuU3RvcmFnZTsKCiAgVG9rZW5MaWIuVG9rZW5TdG9yYWdlIHB1YmxpYyB0b2tlbjsKCiAgZnVuY3Rpb24gQ3Jvd2RzYWxlVG9rZW4oYWRkcmVzcyBvd25lciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgc3ltYm9sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ4IGRlY2ltYWxzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgaW5pdGlhbFN1cHBseSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGFsbG93TWludGluZykKICB7CiAgICB0b2tlbi5pbml0KG93bmVyLCBuYW1lLCBzeW1ib2wsIGRlY2ltYWxzLCBpbml0aWFsU3VwcGx5LCBhbGxvd01pbnRpbmcpOwogIH0KCiAgZnVuY3Rpb24gbmFtZSgpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIHRva2VuLm5hbWU7CiAgfQoKICBmdW5jdGlvbiBzeW1ib2woKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiB0b2tlbi5zeW1ib2w7CiAgfQoKICBmdW5jdGlvbiBkZWNpbWFscygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICByZXR1cm4gdG9rZW4uZGVjaW1hbHM7CiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi50b3RhbFN1cHBseTsKICB9CgogIGZ1bmN0aW9uIGluaXRpYWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uSU5JVElBTF9TVVBQTFk7CiAgfQoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2Yod2hvKTsKICB9CgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiB0b2tlbi5hbGxvd2FuY2Uob3duZXIsIHNwZW5kZXIpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLnRyYW5zZmVyKHRvLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKSB7CiAgICByZXR1cm4gdG9rZW4udHJhbnNmZXJGcm9tKGZyb20sIHRvLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmFwcHJvdmUoc3BlbmRlciwgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBuZXdPd25lcikgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmNoYW5nZU93bmVyKG5ld093bmVyKTsKICB9CgogIGZ1bmN0aW9uIGJ1cm5Ub2tlbih1aW50MjU2IGFtb3VudCkgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLmJ1cm5Ub2tlbihhbW91bnQpOwogIH0KfQ=='.
	

]
