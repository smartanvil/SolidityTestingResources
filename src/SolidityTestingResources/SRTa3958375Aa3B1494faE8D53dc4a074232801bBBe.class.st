Class {
	#name : #SRTa3958375Aa3B1494faE8D53dc4a074232801bBBe,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa3958375Aa3B1494faE8D53dc4a074232801bBBe >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBCYXNpYyB0b2tlbgogKiBAZGV2IEJhc2ljIHZlcnNpb24gb2YgU3RhbmRhcmRUb2tlbiwgd2l0aCBubyBhbGxvd2FuY2VzLiAKICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLiAKICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3V0IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewogICAgdmFyIF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXByb3ZlIHRoZSBwYXNzZWQgYWRkcmVzcyB0byBzcGVuZCB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiB0b2tlbnMgb24gYmVoYWxmIG9mIG1zZy5zZW5kZXIuCiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCkgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgIHJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmaW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCi8vLyBub3RlOiBkdXJpbmcgYW55IG93bmVyc2hpcCBjaGFuZ2VzIGFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgKHdhaXRpbmcgZm9yIG1vcmUgc2lnbmF0dXJlcykgYXJlIGNhbmNlbGxlZAovLyBUT0RPIGFjY2VwdE93bmVyc2hpcApjb250cmFjdCBtdWx0aW93bmVkIHsKCgkvLyBUWVBFUwoKICAgIC8vIHN0cnVjdCBmb3IgdGhlIHN0YXR1cyBvZiBhIHBlbmRpbmcgb3BlcmF0aW9uLgogICAgc3RydWN0IE11bHRpT3duZWRPcGVyYXRpb25QZW5kaW5nU3RhdGUgewogICAgICAgIC8vIGNvdW50IG9mIGNvbmZpcm1hdGlvbnMgbmVlZGVkCiAgICAgICAgdWludCB5ZXROZWVkZWQ7CgogICAgICAgIC8vIGJpdG1hcCBvZiBjb25maXJtYXRpb25zIHdoZXJlIG93bmVyICNvd25lckluZGV4J3MgZGVjaXNpb24gY29ycmVzcG9uZHMgdG8gMioqb3duZXJJbmRleCBiaXQKICAgICAgICB1aW50IG93bmVyc0RvbmU7CgogICAgICAgIC8vIHBvc2l0aW9uIG9mIHRoaXMgb3BlcmF0aW9uIGtleSBpbiBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgKICAgICAgICB1aW50IGluZGV4OwogICAgfQoKCS8vIEVWRU5UUwoKICAgIGV2ZW50IENvbmZpcm1hdGlvbihhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbik7CiAgICBldmVudCBSZXZva2UoYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwogICAgZXZlbnQgRmluYWxDb25maXJtYXRpb24oYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwoKICAgIC8vIHNvbWUgb3RoZXJzIGFyZSBpbiB0aGUgY2FzZSBvZiBhbiBvd25lciBjaGFuZ2luZy4KICAgIGV2ZW50IE93bmVyQ2hhbmdlZChhZGRyZXNzIG9sZE93bmVyLCBhZGRyZXNzIG5ld093bmVyKTsKICAgIGV2ZW50IE93bmVyQWRkZWQoYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lclJlbW92ZWQoYWRkcmVzcyBvbGRPd25lcik7CgogICAgLy8gdGhlIGxhc3Qgb25lIGlzIGVtaXR0ZWQgaWYgdGhlIHJlcXVpcmVkIHNpZ25hdHVyZXMgY2hhbmdlCiAgICBldmVudCBSZXF1aXJlbWVudENoYW5nZWQodWludCBuZXdSZXF1aXJlbWVudCk7CgoJLy8gTU9ESUZJRVJTCgogICAgLy8gc2ltcGxlIHNpbmdsZS1zaWcgZnVuY3Rpb24gbW9kaWZpZXIuCiAgICBtb2RpZmllciBvbmx5b3duZXIgewogICAgICAgIHJlcXVpcmUoaXNPd25lcihtc2cuc2VuZGVyKSk7CiAgICAgICAgXzsKICAgIH0KICAgIC8vIG11bHRpLXNpZyBmdW5jdGlvbiBtb2RpZmllcjogdGhlIG9wZXJhdGlvbiBtdXN0IGhhdmUgYW4gaW50cmluc2ljIGhhc2ggaW4gb3JkZXIKICAgIC8vIHRoYXQgbGF0ZXIgYXR0ZW1wdHMgY2FuIGJlIHJlYWxpc2VkIGFzIHRoZSBzYW1lIHVuZGVybHlpbmcgb3BlcmF0aW9uIGFuZAogICAgLy8gdGh1cyBjb3VudCBhcyBjb25maXJtYXRpb25zLgogICAgbW9kaWZpZXIgb25seW1hbnlvd25lcnMoYnl0ZXMzMiBfb3BlcmF0aW9uKSB7CiAgICAgICAgaWYgKGNvbmZpcm1BbmRDaGVjayhfb3BlcmF0aW9uKSkgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgICAgICAvLyBFdmVuIGlmIHJlcXVpcmVkIG51bWJlciBvZiBjb25maXJtYXRpb25zIGhhcyd0IGJlZW4gY29sbGVjdGVkIHlldCwKICAgICAgICAvLyB3ZSBjYW4ndCB0aHJvdyBoZXJlIC0gYmVjYXVzZSBjaGFuZ2VzIHRvIHRoZSBzdGF0ZSBoYXZlIHRvIGJlIHByZXNlcnZlZC4KICAgICAgICAvLyBCdXQsIGNvbmZpcm1BbmRDaGVjayBpdHNlbGYgd2lsbCB0aHJvdyBpbiBjYXNlIHNlbmRlciBpcyBub3QgYW4gb3duZXIuCiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWROdW1Pd25lcnModWludCBfbnVtT3duZXJzKSB7CiAgICAgICAgcmVxdWlyZShfbnVtT3duZXJzID4gMCAmJiBfbnVtT3duZXJzIDw9IGNfbWF4T3duZXJzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KHVpbnQgX3JlcXVpcmVkLCB1aW50IF9udW1Pd25lcnMpIHsKICAgICAgICByZXF1aXJlKF9yZXF1aXJlZCA+IDAgJiYgX3JlcXVpcmVkIDw9IF9udW1Pd25lcnMpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJFeGlzdHMoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoaXNPd25lcihfYWRkcmVzcykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJEb2VzTm90RXhpc3QoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoIWlzT3duZXIoX2FkZHJlc3MpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG11bHRpT3duZWRPcGVyYXRpb25Jc0FjdGl2ZShieXRlczMyIF9vcGVyYXRpb24pIHsKICAgICAgICByZXF1aXJlKGlzT3BlcmF0aW9uQWN0aXZlKF9vcGVyYXRpb24pKTsKICAgICAgICBfOwogICAgfQoKCS8vIE1FVEhPRFMKCiAgICAvLyBjb25zdHJ1Y3RvciBpcyBnaXZlbiBudW1iZXIgb2Ygc2lncyByZXF1aXJlZCB0byBkbyBwcm90ZWN0ZWQgIm9ubHltYW55b3duZXJzIiB0cmFuc2FjdGlvbnMKICAgIC8vIGFzIHdlbGwgYXMgdGhlIHNlbGVjdGlvbiBvZiBhZGRyZXNzZXMgY2FwYWJsZSBvZiBjb25maXJtaW5nIHRoZW0gKG1zZy5zZW5kZXIgaXMgbm90IGFkZGVkIHRvIHRoZSBvd25lcnMhKS4KICAgIGZ1bmN0aW9uIG11bHRpb3duZWQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3JlcXVpcmVkKQogICAgICAgIHZhbGlkTnVtT3duZXJzKF9vd25lcnMubGVuZ3RoKQogICAgICAgIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KF9yZXF1aXJlZCwgX293bmVycy5sZW5ndGgpCiAgICB7CiAgICAgICAgYXNzZXJ0KGNfbWF4T3duZXJzIDw9IDI1NSk7CgogICAgICAgIG1fbnVtT3duZXJzID0gX293bmVycy5sZW5ndGg7CiAgICAgICAgbV9tdWx0aU93bmVkUmVxdWlyZWQgPSBfcmVxdWlyZWQ7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9vd25lcnMubGVuZ3RoOyArK2kpCiAgICAgICAgewogICAgICAgICAgICBhZGRyZXNzIG93bmVyID0gX293bmVyc1tpXTsKICAgICAgICAgICAgLy8gaW52YWxpZCBhbmQgZHVwbGljYXRlIGFkZHJlc3NlcyBhcmUgbm90IGFsbG93ZWQKICAgICAgICAgICAgcmVxdWlyZSgwICE9IG93bmVyICYmICFpc093bmVyKG93bmVyKSAvKiBub3QgaXNPd25lciB5ZXQhICovKTsKCiAgICAgICAgICAgIHVpbnQgY3VycmVudE93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgoaSArIDEgLyogZmlyc3Qgc2xvdCBpcyB1bnVzZWQgKi8pOwogICAgICAgICAgICBtX293bmVyc1tjdXJyZW50T3duZXJJbmRleF0gPSBvd25lcjsKICAgICAgICAgICAgbV9vd25lckluZGV4W293bmVyXSA9IGN1cnJlbnRPd25lckluZGV4OwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHJlcGxhY2VzIGFuIG93bmVyIGBfZnJvbWAgd2l0aCBhbm90aGVyIGBfdG9gLgogICAgLy8vIEBwYXJhbSBfZnJvbSBhZGRyZXNzIG9mIG93bmVyIHRvIHJlcGxhY2UKICAgIC8vLyBAcGFyYW0gX3RvIGFkZHJlc3Mgb2YgbmV3IG93bmVyCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykKICAgICAgICBleHRlcm5hbAogICAgICAgIG93bmVyRXhpc3RzKF9mcm9tKQogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KF90bykKICAgICAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IGNoZWNrT3duZXJJbmRleChtX293bmVySW5kZXhbX2Zyb21dKTsKICAgICAgICBtX293bmVyc1tvd25lckluZGV4XSA9IF90bzsKICAgICAgICBtX293bmVySW5kZXhbX2Zyb21dID0gMDsKICAgICAgICBtX293bmVySW5kZXhbX3RvXSA9IG93bmVySW5kZXg7CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgICAgICBPd25lckNoYW5nZWQoX2Zyb20sIF90byk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYWRkcyBhbiBvd25lcgogICAgLy8vIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBvZiBuZXcgb3duZXIKICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIGFkZE93bmVyKGFkZHJlc3MgX293bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb3duZXJEb2VzTm90RXhpc3QoX293bmVyKQogICAgICAgIHZhbGlkTnVtT3duZXJzKG1fbnVtT3duZXJzICsgMSkKICAgICAgICBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBhc3NlcnRPd25lcnNBcmVDb25zaXN0ZW50KCk7CgogICAgICAgIGNsZWFyUGVuZGluZygpOwogICAgICAgIG1fbnVtT3duZXJzKys7CiAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gX293bmVyOwogICAgICAgIG1fb3duZXJJbmRleFtfb3duZXJdID0gY2hlY2tPd25lckluZGV4KG1fbnVtT3duZXJzKTsKCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgICAgIE93bmVyQWRkZWQoX293bmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSByZW1vdmVzIGFuIG93bmVyCiAgICAvLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIG9mIG93bmVyIHRvIHJlbW92ZQogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBfb3duZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvd25lckV4aXN0cyhfb3duZXIpCiAgICAgICAgdmFsaWROdW1Pd25lcnMobV9udW1Pd25lcnMgLSAxKQogICAgICAgIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KG1fbXVsdGlPd25lZFJlcXVpcmVkLCBtX251bU93bmVycyAtIDEpCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgobV9vd25lckluZGV4W19vd25lcl0pOwogICAgICAgIG1fb3duZXJzW293bmVySW5kZXhdID0gMDsKICAgICAgICBtX293bmVySW5kZXhbX293bmVyXSA9IDA7CiAgICAgICAgLy9tYWtlIHN1cmUgbV9udW1Pd25lcnMgaXMgZXF1YWwgdG8gdGhlIG51bWJlciBvZiBvd25lcnMgYW5kIGFsd2F5cyBwb2ludHMgdG8gdGhlIGxhc3Qgb3duZXIKICAgICAgICByZW9yZ2FuaXplT3duZXJzKCk7CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgICAgICBPd25lclJlbW92ZWQoX293bmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjaGFuZ2VzIHRoZSByZXF1aXJlZCBudW1iZXIgb2Ygb3duZXIgc2lnbmF0dXJlcwogICAgLy8vIEBwYXJhbSBfbmV3UmVxdWlyZWQgbmV3IG51bWJlciBvZiBzaWduYXR1cmVzIHJlcXVpcmVkCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9uZXdSZXF1aXJlZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KF9uZXdSZXF1aXJlZCwgbV9udW1Pd25lcnMpCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgbV9tdWx0aU93bmVkUmVxdWlyZWQgPSBfbmV3UmVxdWlyZWQ7CiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2VkKF9uZXdSZXF1aXJlZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0cyBhbiBvd25lciBieSAwLWluZGV4ZWQgcG9zaXRpb24KICAgIC8vLyBAcGFyYW0gb3duZXJJbmRleCAwLWluZGV4ZWQgb3duZXIgcG9zaXRpb24KICAgIGZ1bmN0aW9uIGdldE93bmVyKHVpbnQgb3duZXJJbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gbV9vd25lcnNbb3duZXJJbmRleCArIDFdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdldHMgb3duZXJzCiAgICAvLy8gQHJldHVybiBtZW1vcnkgYXJyYXkgb2Ygb3duZXJzCiAgICBmdW5jdGlvbiBnZXRPd25lcnMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzc1tdKSB7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSByZXN1bHQgPSBuZXcgYWRkcmVzc1tdKG1fbnVtT3duZXJzKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtX251bU93bmVyczsgaSsrKQogICAgICAgICAgICByZXN1bHRbaV0gPSBnZXRPd25lcihpKTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjaGVja3MgaWYgcHJvdmlkZWQgYWRkcmVzcyBpcyBhbiBvd25lciBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9hZGRyIGFkZHJlc3MgdG8gY2hlY2sKICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgaXQncyBhbiBvd25lcgogICAgZnVuY3Rpb24gaXNPd25lcihhZGRyZXNzIF9hZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtX293bmVySW5kZXhbX2FkZHJdID4gMDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUZXN0cyBvd25lcnNoaXAgb2YgdGhlIGN1cnJlbnQgY2FsbGVyLgogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIGFuIG93bmVyCiAgICAvLyBJdCdzIGFkdmlzYWJsZSB0byBjYWxsIGl0IGJ5IG5ldyBvd25lciB0byBtYWtlIHN1cmUgdGhhdCB0aGUgc2FtZSBlcnJvbmVvdXMgYWRkcmVzcyBpcyBub3QgY29weS1wYXN0ZWQgdG8KICAgIC8vIGFkZE93bmVyL2NoYW5nZU93bmVyIGFuZCB0byBpc093bmVyLgogICAgZnVuY3Rpb24gYW1JT3duZXIoKSBleHRlcm5hbCBjb25zdGFudCBvbmx5b3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldm9rZXMgYSBwcmlvciBjb25maXJtYXRpb24gb2YgdGhlIGdpdmVuIG9wZXJhdGlvbgogICAgLy8vIEBwYXJhbSBfb3BlcmF0aW9uIG9wZXJhdGlvbiB2YWx1ZSwgdHlwaWNhbGx5IHNoYTMobXNnLmRhdGEpCiAgICBmdW5jdGlvbiByZXZva2UoYnl0ZXMzMiBfb3BlcmF0aW9uKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbXVsdGlPd25lZE9wZXJhdGlvbklzQWN0aXZlKF9vcGVyYXRpb24pCiAgICAgICAgb25seW93bmVyCiAgICB7CiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gbWFrZU93bmVyQml0bWFwQml0KG1zZy5zZW5kZXIpOwogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICByZXF1aXJlKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPiAwKTsKCiAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwoKICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCsrOwogICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSAtPSBvd25lckluZGV4Qml0OwoKICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgUmV2b2tlKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyBpZiBvd25lciBjb25maXJtZWQgZ2l2ZW4gb3BlcmF0aW9uCiAgICAvLy8gQHBhcmFtIF9vcGVyYXRpb24gb3BlcmF0aW9uIHZhbHVlLCB0eXBpY2FsbHkgc2hhMyhtc2cuZGF0YSkKICAgIC8vLyBAcGFyYW0gX293bmVyIGFuIG93bmVyIGFkZHJlc3MKICAgIGZ1bmN0aW9uIGhhc0NvbmZpcm1lZChieXRlczMyIF9vcGVyYXRpb24sIGFkZHJlc3MgX293bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoX29wZXJhdGlvbikKICAgICAgICBvd25lckV4aXN0cyhfb3duZXIpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gIShtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLm93bmVyc0RvbmUgJiBtYWtlT3duZXJCaXRtYXBCaXQoX293bmVyKSA9PSAwKTsKICAgIH0KCiAgICAvLyBJTlRFUk5BTCBNRVRIT0RTCgogICAgZnVuY3Rpb24gY29uZmlybUFuZENoZWNrKGJ5dGVzMzIgX29wZXJhdGlvbikKICAgICAgICBwcml2YXRlCiAgICAgICAgb25seW93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoNTEyID09IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGgpCiAgICAgICAgICAgIC8vIEluIGNhc2UgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4IGdyb3dzIHRvbyBtdWNoIHdlIGhhdmUgdG8gc2hyaW5rIGl0OiBvdGhlcndpc2UgYXQgc29tZSBwb2ludAogICAgICAgICAgICAvLyB3ZSB3b24ndCBiZSBhYmxlIHRvIGRvIGl0IGJlY2F1c2Ugb2YgYmxvY2sgZ2FzIGxpbWl0LgogICAgICAgICAgICAvLyBZZXMsIHBlbmRpbmcgY29uZmlybWF0aW9ucyB3aWxsIGJlIGxvc3QuIERvbnQgc2VlIGFueSBzZWN1cml0eSBvciBzdGFiaWxpdHkgaW1wbGljYXRpb25zLgogICAgICAgICAgICAvLyBUT0RPIHVzZSBtb3JlIGdyYWNlZnVsIGFwcHJvYWNoIGxpa2UgY29tcGFjdCBvciByZW1vdmFsIG9mIGNsZWFyUGVuZGluZyBjb21wbGV0ZWx5CiAgICAgICAgICAgIGNsZWFyUGVuZGluZygpOwoKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CgogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCB5ZXQgd29ya2luZyBvbiB0aGlzIG9wZXJhdGlvbiwgc3dpdGNoIG92ZXIgYW5kIHJlc2V0IHRoZSBjb25maXJtYXRpb24gc3RhdHVzLgogICAgICAgIGlmICghIGlzT3BlcmF0aW9uQWN0aXZlKF9vcGVyYXRpb24pKSB7CiAgICAgICAgICAgIC8vIHJlc2V0IGNvdW50IG9mIGNvbmZpcm1hdGlvbnMgbmVlZGVkLgogICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCA9IG1fbXVsdGlPd25lZFJlcXVpcmVkOwogICAgICAgICAgICAvLyByZXNldCB3aGljaCBvd25lcnMgaGF2ZSBjb25maXJtZWQgKG5vbmUpIC0gc2V0IG91ciBiaXRtYXAgdG8gMC4KICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lID0gMDsKICAgICAgICAgICAgcGVuZGluZy5pbmRleCA9IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGgrKzsKICAgICAgICAgICAgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W3BlbmRpbmcuaW5kZXhdID0gX29wZXJhdGlvbjsKICAgICAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwogICAgICAgIH0KCiAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBiaXQgdG8gc2V0IGZvciB0aGlzIG93bmVyLgogICAgICAgIHVpbnQgb3duZXJJbmRleEJpdCA9IG1ha2VPd25lckJpdG1hcEJpdChtc2cuc2VuZGVyKTsKICAgICAgICAvLyBtYWtlIHN1cmUgd2UgKHRoZSBtZXNzYWdlIHNlbmRlcikgaGF2ZW4ndCBjb25maXJtZWQgdGhpcyBvcGVyYXRpb24gcHJldmlvdXNseS4KICAgICAgICBpZiAocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA9PSAwKSB7CiAgICAgICAgICAgIC8vIG9rIC0gY2hlY2sgaWYgY291bnQgaXMgZW5vdWdoIHRvIGdvIGFoZWFkLgogICAgICAgICAgICBhc3NlcnQocGVuZGluZy55ZXROZWVkZWQgPiAwKTsKICAgICAgICAgICAgaWYgKHBlbmRpbmcueWV0TmVlZGVkID09IDEpIHsKICAgICAgICAgICAgICAgIC8vIGVub3VnaCBjb25maXJtYXRpb25zOiByZXNldCBhbmQgcnVuIGludGVyaW9yLgogICAgICAgICAgICAgICAgZGVsZXRlIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleFttX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLmluZGV4XTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dOwogICAgICAgICAgICAgICAgRmluYWxDb25maXJtYXRpb24obXNnLnNlbmRlciwgX29wZXJhdGlvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIG5vdCBlbm91Z2g6IHJlY29yZCB0aGF0IHRoaXMgb3duZXIgaW4gcGFydGljdWxhciBjb25maXJtZWQuCiAgICAgICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZC0tOwogICAgICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lIHw9IG93bmVySW5kZXhCaXQ7CiAgICAgICAgICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgICAgICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgX29wZXJhdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gUmVjbGFpbXMgZnJlZSBzbG90cyBiZXR3ZWVuIHZhbGlkIG93bmVycyBpbiBtX293bmVycy4KICAgIC8vIFRPRE8gZ2l2ZW4gdGhhdCBpdHMgY2FsbGVkIGFmdGVyIGVhY2ggcmVtb3ZhbCwgaXQgY291bGQgYmUgc2ltcGxpZmllZC4KICAgIGZ1bmN0aW9uIHJlb3JnYW5pemVPd25lcnMoKSBwcml2YXRlIHsKICAgICAgICB1aW50IGZyZWUgPSAxOwogICAgICAgIHdoaWxlIChmcmVlIDwgbV9udW1Pd25lcnMpCiAgICAgICAgewogICAgICAgICAgICAvLyBpdGVyYXRpbmcgdG8gdGhlIGZpcnN0IGZyZWUgc2xvdCBmcm9tIHRoZSBiZWdpbm5pbmcKICAgICAgICAgICAgd2hpbGUgKGZyZWUgPCBtX251bU93bmVycyAmJiBtX293bmVyc1tmcmVlXSAhPSAwKSBmcmVlKys7CgogICAgICAgICAgICAvLyBpdGVyYXRpbmcgdG8gdGhlIGZpcnN0IG9jY3VwaWVkIHNsb3QgZnJvbSB0aGUgZW5kCiAgICAgICAgICAgIHdoaWxlIChtX251bU93bmVycyA+IDEgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdID09IDApIG1fbnVtT3duZXJzLS07CgogICAgICAgICAgICAvLyBzd2FwLCBpZiBwb3NzaWJsZSwgc28gZnJlZSBzbG90IGlzIGxvY2F0ZWQgYXQgdGhlIGVuZCBhZnRlciB0aGUgc3dhcAogICAgICAgICAgICBpZiAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW21fbnVtT3duZXJzXSAhPSAwICYmIG1fb3duZXJzW2ZyZWVdID09IDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIG93bmVycyBiZXR3ZWVuIHN3YXBwZWQgc2xvdHMgc2hvdWxkJ3QgYmUgcmVudW1iZXJlZCAtIHRoYXQgc2F2ZXMgYSBsb3Qgb2YgZ2FzCiAgICAgICAgICAgICAgICBtX293bmVyc1tmcmVlXSA9IG1fb3duZXJzW21fbnVtT3duZXJzXTsKICAgICAgICAgICAgICAgIG1fb3duZXJJbmRleFttX293bmVyc1tmcmVlXV0gPSBmcmVlOwogICAgICAgICAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjbGVhclBlbmRpbmcoKSBwcml2YXRlIG9ubHlvd25lciB7CiAgICAgICAgdWludCBsZW5ndGggPSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbaV0gIT0gMCkKICAgICAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nW21fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtpXV07CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tPd25lckluZGV4KHVpbnQgb3duZXJJbmRleCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KDAgIT0gb3duZXJJbmRleCAmJiBvd25lckluZGV4IDw9IGNfbWF4T3duZXJzKTsKICAgICAgICByZXR1cm4gb3duZXJJbmRleDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlT3duZXJCaXRtYXBCaXQoYWRkcmVzcyBvd25lcikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtvd25lcl0pOwogICAgICAgIHJldHVybiAyICoqIG93bmVySW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gaXNPcGVyYXRpb25BY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gMCAhPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLnlldE5lZWRlZDsKICAgIH0KCgogICAgZnVuY3Rpb24gYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpIHByaXZhdGUgY29uc3RhbnQgewogICAgICAgIGFzc2VydChtX251bU93bmVycyA+IDApOwogICAgICAgIGFzc2VydChtX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgYXNzZXJ0KG1fb3duZXJzWzBdID09IDApOwogICAgICAgIGFzc2VydCgwICE9IG1fbXVsdGlPd25lZFJlcXVpcmVkICYmIG1fbXVsdGlPd25lZFJlcXVpcmVkIDw9IG1fbnVtT3duZXJzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgYXNzZXJ0KDAgIT0gcGVuZGluZy55ZXROZWVkZWQpOwogICAgICAgIGFzc2VydChtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPT0gX29wZXJhdGlvbik7CiAgICAgICAgYXNzZXJ0KHBlbmRpbmcueWV0TmVlZGVkIDw9IG1fbXVsdGlPd25lZFJlcXVpcmVkKTsKICAgIH0KCgogICAJLy8gRklFTERTCgogICAgdWludCBjb25zdGFudCBjX21heE93bmVycyA9IDI1MDsKCiAgICAvLyB0aGUgbnVtYmVyIG9mIG93bmVycyB0aGF0IG11c3QgY29uZmlybSB0aGUgc2FtZSBvcGVyYXRpb24gYmVmb3JlIGl0IGlzIHJ1bi4KICAgIHVpbnQgcHVibGljIG1fbXVsdGlPd25lZFJlcXVpcmVkOwoKCiAgICAvLyBwb2ludGVyIHVzZWQgdG8gZmluZCBhIGZyZWUgc2xvdCBpbiBtX293bmVycwogICAgdWludCBwdWJsaWMgbV9udW1Pd25lcnM7CgogICAgLy8gbGlzdCBvZiBvd25lcnMgKGFkZHJlc3NlcyksCiAgICAvLyBzbG90IDAgaXMgdW51c2VkIHNvIHRoZXJlIGFyZSBubyBvd25lciB3aGljaCBpbmRleCBpcyAwLgogICAgLy8gVE9ETyBjb3VsZCB3ZSBzYXZlIHNwYWNlIGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5IGZvciB0aGUgY29tbW9uIGNhc2Ugb2YgPDEwIG93bmVycz8gYW5kIHNob3VsZCB3ZT8KICAgIGFkZHJlc3NbMjU2XSBpbnRlcm5hbCBtX293bmVyczsKCiAgICAvLyBpbmRleCBvbiB0aGUgbGlzdCBvZiBvd25lcnMgdG8gYWxsb3cgcmV2ZXJzZSBsb29rdXA6IG93bmVyIGFkZHJlc3MgPT4gaW5kZXggaW4gbV9vd25lcnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBpbnRlcm5hbCBtX293bmVySW5kZXg7CgoKICAgIC8vIHRoZSBvbmdvaW5nIG9wZXJhdGlvbnMuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gTXVsdGlPd25lZE9wZXJhdGlvblBlbmRpbmdTdGF0ZSkgaW50ZXJuYWwgbV9tdWx0aU93bmVkUGVuZGluZzsKICAgIGJ5dGVzMzJbXSBpbnRlcm5hbCBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7Cn0KCgovKioKICogQHRpdGxlIENvbnRyYWN0IHdoaWNoIGlzIG93bmVkIGJ5IG93bmVycyBhbmQgb3BlcmF0ZWQgYnkgY29udHJvbGxlci4KICoKICogQG5vdGljZSBQcm92aWRlcyBhIHdheSB0byBzZXQgdXAgYW4gZW50aXR5ICh0eXBpY2FsbHkgb3RoZXIgY29udHJhY3QpIGVudGl0bGVkIHRvIGNvbnRyb2wgYWN0aW9ucyBvZiB0aGlzIGNvbnRyYWN0LgogKiBDb250cm9sbGVyIGlzIHNldCB1cCBieSBvd25lcnMgb3IgZHVyaW5nIGNvbnN0cnVjdGlvbi4KICoKICogQGRldiBjb250cm9sbGVyIGNoZWNrIGlzIHBlcmZvcm1lZCBieSBvbmx5Q29udHJvbGxlciBtb2RpZmllci4KICovCmNvbnRyYWN0IE11bHRpb3duZWRDb250cm9sbGVkIGlzIG11bHRpb3duZWQgewoKICAgIGV2ZW50IENvbnRyb2xsZXJTZXQoYWRkcmVzcyBjb250cm9sbGVyKTsKICAgIGV2ZW50IENvbnRyb2xsZXJSZXRpcmVkKGFkZHJlc3Mgd2FzKTsKCgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtX2NvbnRyb2xsZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8vIFBVQkxJQyBpbnRlcmZhY2UKCiAgICBmdW5jdGlvbiBNdWx0aW93bmVkQ29udHJvbGxlZChhZGRyZXNzW10gX293bmVycywgdWludCBfc2lnbmF0dXJlc1JlcXVpcmVkLCBhZGRyZXNzIF9jb250cm9sbGVyKQogICAgICAgIG11bHRpb3duZWQoX293bmVycywgX3NpZ25hdHVyZXNSZXF1aXJlZCkKICAgIHsKICAgICAgICBtX2NvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsKICAgICAgICBDb250cm9sbGVyU2V0KG1fY29udHJvbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgc2V0cyB0aGUgY29udHJvbGxlcgogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSBleHRlcm5hbCBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgewogICAgICAgIG1fY29udHJvbGxlciA9IF9jb250cm9sbGVyOwogICAgICAgIENvbnRyb2xsZXJTZXQobV9jb250cm9sbGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBhYmlsaXR5IGZvciBjb250cm9sbGVyIHRvIHN0ZXAgZG93bgogICAgZnVuY3Rpb24gZGV0YWNoQ29udHJvbGxlcigpIGV4dGVybmFsIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBhZGRyZXNzIHdhcyA9IG1fY29udHJvbGxlcjsKICAgICAgICBtX2NvbnRyb2xsZXIgPSBhZGRyZXNzKDApOwogICAgICAgIENvbnRyb2xsZXJSZXRpcmVkKHdhcyk7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIGFkZHJlc3Mgb2YgZW50aXR5IGVudGl0bGVkIHRvIG1pbnQgbmV3IHRva2VucwogICAgYWRkcmVzcyBwdWJsaWMgbV9jb250cm9sbGVyOwp9CgoKLy8vIEB0aXRsZSBTdGFuZGFyZFRva2VuIHdoaWNoIGNhbiBiZSBtaW50ZWQgYnkgYW5vdGhlciBjb250cmFjdC4KY29udHJhY3QgTWludGFibGVNdWx0aW93bmVkVG9rZW4gaXMgTXVsdGlvd25lZENvbnRyb2xsZWQsIFN0YW5kYXJkVG9rZW4gewoKICAgIC8vLyBAZGV2IHBhcmFtZXRlcnMgb2YgYW4gZXh0cmEgdG9rZW4gZW1pc3Npb24KICAgIHN0cnVjdCBFbWlzc2lvbkluZm8gewogICAgICAgIC8vIHRva2VucyBjcmVhdGVkCiAgICAgICAgdWludDI1NiBjcmVhdGVkOwoKICAgICAgICAvLyB0b3RhbFN1cHBseSBhdCB0aGUgbW9tZW50IG9mIGVtaXNzaW9uIChleGNsdWRpbmcgY3JlYXRlZCB0b2tlbnMpCiAgICAgICAgdWludDI1NiB0b3RhbFN1cHBseVdhczsKICAgIH0KCiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgRW1pc3Npb24odWludDI1NiB0b2tlbnNDcmVhdGVkLCB1aW50MjU2IHRvdGFsU3VwcGx5V2FzLCB1aW50MjU2IHRpbWUpOwogICAgZXZlbnQgRGl2aWRlbmQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CgoKICAgIC8vIFBVQkxJQyBpbnRlcmZhY2UKCiAgICBmdW5jdGlvbiBNaW50YWJsZU11bHRpb3duZWRUb2tlbihhZGRyZXNzW10gX293bmVycywgdWludCBfc2lnbmF0dXJlc1JlcXVpcmVkLCBhZGRyZXNzIF9taW50ZXIpCiAgICAgICAgTXVsdGlvd25lZENvbnRyb2xsZWQoX293bmVycywgX3NpZ25hdHVyZXNSZXF1aXJlZCwgX21pbnRlcikKICAgIHsKICAgICAgICBkaXZpZGVuZHNQb29sID0gdGhpczsgICAvLyBvciBhbnkgb3RoZXIgc3BlY2lhbCB1bmZvcmdlYWJsZSB2YWx1ZSwgYWN0dWFsbHkKCiAgICAgICAgLy8gZW1pc3Npb24gIzAgaXMgYSBkdW1teTogYmVjYXVzZSBvZiBkZWZhdWx0IHZhbHVlIDAgaW4gbV9sYXN0QWNjb3VudEVtaXNzaW9uCiAgICAgICAgbV9lbWlzc2lvbnMucHVzaChFbWlzc2lvbkluZm8oe2NyZWF0ZWQ6IDAsIHRvdGFsU3VwcGx5V2FzOiAwfSkpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJlcXVlc3QgZGl2aWRlbmRzIGZvciBjdXJyZW50IGFjY291bnQuCiAgICBmdW5jdGlvbiByZXF1ZXN0RGl2aWRlbmRzKCkgZXh0ZXJuYWwgewogICAgICAgIHBheURpdmlkZW5kc1RvKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGhvb2sgb24gc3RhbmRhcmQgRVJDMjAjdHJhbnNmZXIgdG8gcGF5IGRpdmlkZW5kcwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcGF5RGl2aWRlbmRzVG8obXNnLnNlbmRlcik7CiAgICAgICAgcGF5RGl2aWRlbmRzVG8oX3RvKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGhvb2sgb24gc3RhbmRhcmQgRVJDMjAjdHJhbnNmZXJGcm9tIHRvIHBheSBkaXZpZGVuZHMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBwYXlEaXZpZGVuZHNUbyhfZnJvbSk7CiAgICAgICAgcGF5RGl2aWRlbmRzVG8oX3RvKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgLy8gRGlzYWJsZWQ6IHRoaXMgY291bGQgYmUgdW5kZXNpcmFibGUgYmVjYXVzZSBzdW0gb2YgKGJhbGFuY2VPZigpIGZvciBlYWNoIHRva2VuIG93bmVyKSAhPSB0b3RhbFN1cHBseQogICAgLy8gKGJ1dDogc3VtIG9mIChiYWxhbmNlc1tvd25lcl0gZm9yIGVhY2ggdG9rZW4gb3duZXIpID09IHRvdGFsU3VwcGx5ISkuCiAgICAvLwogICAgLy8gQG5vdGljZSBob29rIG9uIHN0YW5kYXJkIEVSQzIwI2JhbGFuY2VPZiB0byB0YWtlIGRpdmlkZW5kcyBpbnRvIGNvbnNpZGVyYXRpb24KICAgIC8vIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gICAgIHZhciAoaGFzTmV3RGl2aWRlbmRzLCBkaXZpZGVuZHMpID0gY2FsY3VsYXRlRGl2aWRlbmRzRm9yKF9vd25lcik7CiAgICAvLyAgICAgcmV0dXJuIGhhc05ld0RpdmlkZW5kcyA/IHN1cGVyLmJhbGFuY2VPZihfb3duZXIpLmFkZChkaXZpZGVuZHMpIDogc3VwZXIuYmFsYW5jZU9mKF9vd25lcik7CiAgICAvLyB9CgoKICAgIC8vLyBAZGV2IG1pbnRzIG5ldyB0b2tlbnMKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgZXh0ZXJuYWwgb25seUNvbnRyb2xsZXIgewogICAgICAgIHJlcXVpcmUobV9leHRlcm5hbE1pbnRpbmdFbmFibGVkKTsKICAgICAgICBwYXlEaXZpZGVuZHNUbyhfdG8pOwogICAgICAgIG1pbnRJbnRlcm5hbChfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IGRpc2FibGVzIG1pbnQoKSwgaXJyZXZlcnNpYmxlIQogICAgZnVuY3Rpb24gZGlzYWJsZU1pbnRpbmcoKSBleHRlcm5hbCBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgcmVxdWlyZShtX2V4dGVybmFsTWludGluZ0VuYWJsZWQpOwogICAgICAgIG1fZXh0ZXJuYWxNaW50aW5nRW5hYmxlZCA9IGZhbHNlOwogICAgfQoKCiAgICAvLyBJTlRFUk5BTCBmdW5jdGlvbnMKCiAgICAvKioKICAgICAqIEBub3RpY2UgU3RhcnRzIG5ldyB0b2tlbiBlbWlzc2lvbgogICAgICogQHBhcmFtIF90b2tlbnNDcmVhdGVkIEFtb3VudCBvZiB0b2tlbnMgdG8gY3JlYXRlCiAgICAgKiBAZGV2IERpdmlkZW5kcyBhcmUgbm90IGRpc3RyaWJ1dGVkIGltbWVkaWF0ZWx5IGFzIGl0IGNvdWxkIHJlcXVpcmUgYmlsbGlvbnMgb2YgZ2FzLAogICAgICogaW5zdGVhZCB0aGV5IGFyZSBgcHVsbGVkYCBieSBhIGhvbGRlciBmcm9tIGRpdmlkZW5kcyBwb29sIGFjY291bnQgYmVmb3JlIGFueSB1cGRhdGUgdG8gdGhlIGhvbGRlciBhY2NvdW50IG9jY3Vycy4KICAgICAqLwogICAgZnVuY3Rpb24gZW1pc3Npb25JbnRlcm5hbCh1aW50MjU2IF90b2tlbnNDcmVhdGVkKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSgwICE9IF90b2tlbnNDcmVhdGVkKTsKICAgICAgICByZXF1aXJlKF90b2tlbnNDcmVhdGVkIDwgdG90YWxTdXBwbHkgLyAyKTsgIC8vIG90aGVyd2lzZSBpdCBsb29rcyBsaWtlIGFuIGVycm9yCgogICAgICAgIHVpbnQyNTYgdG90YWxTdXBwbHlXYXMgPSB0b3RhbFN1cHBseTsKCiAgICAgICAgbV9lbWlzc2lvbnMucHVzaChFbWlzc2lvbkluZm8oe2NyZWF0ZWQ6IF90b2tlbnNDcmVhdGVkLCB0b3RhbFN1cHBseVdhczogdG90YWxTdXBwbHlXYXN9KSk7CiAgICAgICAgbWludEludGVybmFsKGRpdmlkZW5kc1Bvb2wsIF90b2tlbnNDcmVhdGVkKTsKCiAgICAgICAgRW1pc3Npb24oX3Rva2Vuc0NyZWF0ZWQsIHRvdGFsU3VwcGx5V2FzLCBub3cpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbnRJbnRlcm5hbChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKHRoaXMsIF90bywgX2Ftb3VudCk7CiAgICAgICAgTWludChfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IGFkZHMgZGl2aWRlbmRzIHRvIHRoZSBhY2NvdW50IF90bwogICAgZnVuY3Rpb24gcGF5RGl2aWRlbmRzVG8oYWRkcmVzcyBfdG8pIGludGVybmFsIHsKICAgICAgICB2YXIgKGhhc05ld0RpdmlkZW5kcywgZGl2aWRlbmRzKSA9IGNhbGN1bGF0ZURpdmlkZW5kc0ZvcihfdG8pOwogICAgICAgIGlmICghaGFzTmV3RGl2aWRlbmRzKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmICgwICE9IGRpdmlkZW5kcykgewogICAgICAgICAgICBiYWxhbmNlc1tkaXZpZGVuZHNQb29sXSA9IGJhbGFuY2VzW2RpdmlkZW5kc1Bvb2xdLnN1YihkaXZpZGVuZHMpOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoZGl2aWRlbmRzKTsKICAgICAgICAgICAgVHJhbnNmZXIoZGl2aWRlbmRzUG9vbCwgX3RvLCBkaXZpZGVuZHMpOwogICAgICAgIH0KICAgICAgICBtX2xhc3RBY2NvdW50RW1pc3Npb25bX3RvXSA9IGdldExhc3RFbWlzc2lvbk51bSgpOwogICAgfQoKICAgIC8vLyBAZGV2IGNhbGN1bGF0ZXMgZGl2aWRlbmRzIGZvciB0aGUgYWNjb3VudCBfZm9yCiAgICAvLy8gQHJldHVybiAodHJ1ZSBpZiBzdGF0ZSBoYXMgdG8gYmUgdXBkYXRlZCwgZGl2aWRlbmQgYW1vdW50IChjb3VsZCBiZSAwISkpCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVEaXZpZGVuZHNGb3IoYWRkcmVzcyBfZm9yKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sIGhhc05ld0RpdmlkZW5kcywgdWludCBkaXZpZGVuZHMpIHsKICAgICAgICBhc3NlcnQoX2ZvciAhPSBkaXZpZGVuZHNQb29sKTsgIC8vIG5vIGRpdmlkZW5kcyBmb3IgdGhlIHBvb2whCgogICAgICAgIHVpbnQyNTYgbGFzdEVtaXNzaW9uTnVtID0gZ2V0TGFzdEVtaXNzaW9uTnVtKCk7CiAgICAgICAgdWludDI1NiBsYXN0QWNjb3VudEVtaXNzaW9uTnVtID0gbV9sYXN0QWNjb3VudEVtaXNzaW9uW19mb3JdOwogICAgICAgIGFzc2VydChsYXN0QWNjb3VudEVtaXNzaW9uTnVtIDw9IGxhc3RFbWlzc2lvbk51bSk7CiAgICAgICAgaWYgKGxhc3RBY2NvdW50RW1pc3Npb25OdW0gPT0gbGFzdEVtaXNzaW9uTnVtKQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgdWludDI1NiBpbml0aWFsQmFsYW5jZSA9IGJhbGFuY2VzW19mb3JdOyAgICAvLyBiZXdhcmUgb2YgcmVjdXJzaW9uIQogICAgICAgIGlmICgwID09IGluaXRpYWxCYWxhbmNlKQogICAgICAgICAgICByZXR1cm4gKHRydWUsIDApOwoKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBpbml0aWFsQmFsYW5jZTsKICAgICAgICBmb3IgKHVpbnQyNTYgZW1pc3Npb25Ub1Byb2Nlc3MgPSBsYXN0QWNjb3VudEVtaXNzaW9uTnVtICsgMTsgZW1pc3Npb25Ub1Byb2Nlc3MgPD0gbGFzdEVtaXNzaW9uTnVtOyBlbWlzc2lvblRvUHJvY2VzcysrKSB7CiAgICAgICAgICAgIEVtaXNzaW9uSW5mbyBzdG9yYWdlIGVtaXNzaW9uID0gbV9lbWlzc2lvbnNbZW1pc3Npb25Ub1Byb2Nlc3NdOwogICAgICAgICAgICBhc3NlcnQoMCAhPSBlbWlzc2lvbi5jcmVhdGVkICYmIDAgIT0gZW1pc3Npb24udG90YWxTdXBwbHlXYXMpOwoKICAgICAgICAgICAgdWludDI1NiBkaXZpZGVuZCA9IGJhbGFuY2UubXVsKGVtaXNzaW9uLmNyZWF0ZWQpLmRpdihlbWlzc2lvbi50b3RhbFN1cHBseVdhcyk7CiAgICAgICAgICAgIERpdmlkZW5kKF9mb3IsIGRpdmlkZW5kKTsKCiAgICAgICAgICAgIGJhbGFuY2UgPSBiYWxhbmNlLmFkZChkaXZpZGVuZCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHRydWUsIGJhbGFuY2Uuc3ViKGluaXRpYWxCYWxhbmNlKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TGFzdEVtaXNzaW9uTnVtKCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG1fZW1pc3Npb25zLmxlbmd0aCAtIDE7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIGlmIHRoaXMgdHJ1ZSB0aGVuIHRva2VuIGlzIHN0aWxsIGV4dGVybmFsbHkgbWludGFibGUgKGJ1dCB0aGlzIGZsYWcgZG9lcyd0IGFmZmVjdCBlbWlzc2lvbnMhKQogICAgYm9vbCBwdWJsaWMgbV9leHRlcm5hbE1pbnRpbmdFbmFibGVkID0gdHJ1ZTsKCiAgICAvLy8gQGRldiBpbnRlcm5hbCBhZGRyZXNzIG9mIGRpdmlkZW5kcyBpbiBiYWxhbmNlcyBtYXBwaW5nLgogICAgYWRkcmVzcyBkaXZpZGVuZHNQb29sOwoKICAgIC8vLyBAbm90aWNlIHJlY29yZCBvZiBpc3N1ZWQgZGl2aWRlbmQgZW1pc3Npb25zCiAgICBFbWlzc2lvbkluZm9bXSBwdWJsaWMgbV9lbWlzc2lvbnM7CgogICAgLy8vIEBkZXYgZm9yIGVhY2ggdG9rZW4gaG9sZGVyOiBsYXN0IGVtaXNzaW9uIChpbmRleCBpbiBtX2VtaXNzaW9ucykgd2hpY2ggd2FzIHByb2Nlc3NlZCBmb3IgdGhpcyBob2xkZXIKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBtX2xhc3RBY2NvdW50RW1pc3Npb247Cn0KCi8vLyBAdGl0bGUgdXRpbGl0eSBtZXRob2RzIGFuZCBtb2RpZmllcnMgb2YgYXJndW1lbnRzIHZhbGlkYXRpb24KY29udHJhY3QgQXJndW1lbnRzQ2hlY2tlciB7CgogICAgLy8vIEBkZXYgY2hlY2sgd2hpY2ggcHJldmVudHMgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICAgIG1vZGlmaWVyIHBheWxvYWRTaXplSXModWludCBzaXplKSB7CiAgICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA9PSBzaXplICsgNCAvKiBmdW5jdGlvbiBzZWxlY3RvciAqLyk7CiAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IGNoZWNrIHRoYXQgYWRkcmVzcyBpcyB2YWxpZAogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKGFkZHJlc3MgYWRkcikgewogICAgICAgIHJlcXVpcmUoYWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBJbnRlcmZhY2UgZm9yIGNvZGUgd2hpY2ggcHJvY2Vzc2VzIGFuZCBzdG9yZXMgaW52ZXN0bWVudHMuCiAqIEBhdXRob3IgRWVuYWUKICovCmNvbnRyYWN0IElJbnZlc3RtZW50c1dhbGxldENvbm5lY3RvciB7CiAgICAvLy8gQGRldiBwcm9jZXNzIGFuZCBmb3J3YXJkIGludmVzdG1lbnQKICAgIGZ1bmN0aW9uIHN0b3JlSW52ZXN0bWVudChhZGRyZXNzIGludmVzdG9yLCB1aW50IHBheW1lbnQpIGludGVybmFsOwoKICAgIC8vLyBAZGV2IHRvdGFsIGludmVzdG1lbnRzIGFtb3VudCBzdG9yZWQgdXNpbmcgc3RvcmVJbnZlc3RtZW50KCkKICAgIGZ1bmN0aW9uIGdldFRvdGFsSW52ZXN0bWVudHNTdG9yZWQoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgICAvLy8gQGRldiBjYWxsZWQgaW4gY2FzZSBjcm93ZHNhbGUgc3VjY2VlZGVkCiAgICBmdW5jdGlvbiB3Y09uQ3Jvd2RzYWxlU3VjY2VzcygpIGludGVybmFsOwoKICAgIC8vLyBAZGV2IGNhbGxlZCBpbiBjYXNlIGNyb3dkc2FsZSBmYWlsZWQKICAgIGZ1bmN0aW9uIHdjT25Dcm93ZHNhbGVGYWlsdXJlKCkgaW50ZXJuYWw7Cn0KCi8qKgogKiBAdGl0bGUgU3RvcmVzIGludmVzdG1lbnRzIGluIHNwZWNpZmllZCBleHRlcm5hbCBhY2NvdW50LgogKiBAYXV0aG9yIEVlbmFlCiAqLwpjb250cmFjdCBFeHRlcm5hbEFjY291bnRXYWxsZXRDb25uZWN0b3IgaXMgQXJndW1lbnRzQ2hlY2tlciwgSUludmVzdG1lbnRzV2FsbGV0Q29ubmVjdG9yIHsKCiAgICBmdW5jdGlvbiBFeHRlcm5hbEFjY291bnRXYWxsZXRDb25uZWN0b3IoYWRkcmVzcyBhY2NvdW50QWRkcmVzcykKICAgICAgICB2YWxpZEFkZHJlc3MoYWNjb3VudEFkZHJlc3MpCiAgICB7CiAgICAgICAgbV93YWxsZXRBZGRyZXNzID0gYWNjb3VudEFkZHJlc3M7CiAgICB9CgogICAgLy8vIEBkZXYgcHJvY2VzcyBhbmQgZm9yd2FyZCBpbnZlc3RtZW50CiAgICBmdW5jdGlvbiBzdG9yZUludmVzdG1lbnQoYWRkcmVzcyAvKmludmVzdG9yKi8sIHVpbnQgcGF5bWVudCkgaW50ZXJuYWwKICAgIHsKICAgICAgICBtX3djU3RvcmVkICs9IHBheW1lbnQ7CiAgICAgICAgbV93YWxsZXRBZGRyZXNzLnRyYW5zZmVyKHBheW1lbnQpOwogICAgfQoKICAgIC8vLyBAZGV2IHRvdGFsIGludmVzdG1lbnRzIGFtb3VudCBzdG9yZWQgdXNpbmcgc3RvcmVJbnZlc3RtZW50KCkKICAgIGZ1bmN0aW9uIGdldFRvdGFsSW52ZXN0bWVudHNTdG9yZWQoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBtX3djU3RvcmVkOwogICAgfQoKICAgIC8vLyBAZGV2IGNhbGxlZCBpbiBjYXNlIGNyb3dkc2FsZSBzdWNjZWVkZWQKICAgIGZ1bmN0aW9uIHdjT25Dcm93ZHNhbGVTdWNjZXNzKCkgaW50ZXJuYWwgewogICAgfQoKICAgIC8vLyBAZGV2IGNhbGxlZCBpbiBjYXNlIGNyb3dkc2FsZSBmYWlsZWQKICAgIGZ1bmN0aW9uIHdjT25Dcm93ZHNhbGVGYWlsdXJlKCkgaW50ZXJuYWwgewogICAgfQoKICAgIC8vLyBAbm90aWNlIGFkZHJlc3Mgb2Ygd2FsbGV0IHdoaWNoIHN0b3JlcyBmdW5kcwogICAgYWRkcmVzcyBwdWJsaWMgbV93YWxsZXRBZGRyZXNzOwoKICAgIC8vLyBAbm90aWNlIHRvdGFsIGludmVzdG1lbnRzIHN0b3JlZCB0byB3YWxsZXQKICAgIHVpbnQgcHVibGljIG1fd2NTdG9yZWQ7Cn0KCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qCiAqIEB0aXRsZSBUaGlzIGlzIHByb3h5IGZvciBhbmFseXRpY3MuIFRhcmdldCBjb250cmFjdCBjYW4gYmUgZm91bmQgYXQgZmllbGQgbV9hbmFseXRpY3MgKHNlZSAicmVhZCBjb250cmFjdCIpLgogKiBAYXV0aG9yIEVlbmFlCgogKiBGSVhNRSBhZnRlciBmaXggb2YgdHJ1ZmZsZSBpc3N1ZSAjNTYwOiByZWZhY3RvciB0byBhIHNlcGFyYXRlIGNvbnRyYWN0IGZpbGUgd2hpY2ggdXNlcyBJbnZlc3RtZW50QW5hbHl0aWNzIGludGVyZmFjZQogKi8KY29udHJhY3QgQW5hbHl0aWNQcm94eSB7CgogICAgZnVuY3Rpb24gQW5hbHl0aWNQcm94eSgpIHsKICAgICAgICBtX2FuYWx5dGljcyA9IEludmVzdG1lbnRBbmFseXRpY3MobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgZm9yd2FyZCBwYXltZW50IHRvIGFuYWx5dGljcy1jYXBhYmxlIGNvbnRyYWN0CiAgICBmdW5jdGlvbigpIHBheWFibGUgewogICAgICAgIG1fYW5hbHl0aWNzLmlhSW52ZXN0ZWRCeS52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIEludmVzdG1lbnRBbmFseXRpY3MgcHVibGljIG1fYW5hbHl0aWNzOwp9CgoKLyoKICogQHRpdGxlIE1peGluIGNvbnRyYWN0IHdoaWNoIHN1cHBvcnRzIGRpZmZlcmVudCBwYXltZW50IGNoYW5uZWxzIGFuZCBwcm92aWRlcyBhbmFseXRpY2FsIHBlci1jaGFubmVsIGRhdGEuCiAqIEBhdXRob3IgRWVuYWUKICovCmNvbnRyYWN0IEludmVzdG1lbnRBbmFseXRpY3MgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgZnVuY3Rpb24gSW52ZXN0bWVudEFuYWx5dGljcygpewogICAgfQoKICAgIC8vLyBAZGV2IGNyZWF0ZXMgbW9yZSBwYXltZW50IGNoYW5uZWxzLCB1cCB0byB0aGUgbGltaXQgYnV0IG5vdCBleGNlZWRpbmcgZ2FzIHN0aXBlbmQKICAgIGZ1bmN0aW9uIGNyZWF0ZU1vcmVQYXltZW50Q2hhbm5lbHNJbnRlcm5hbCh1aW50IGxpbWl0KSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwYXltZW50Q2hhbm5lbHNDcmVhdGVkOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxpbWl0OyBpKyspIHsKICAgICAgICAgICAgdWludCBzdGFydGluZ0dhcyA9IG1zZy5nYXM7CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIH4xNzBrIG9mIGdhcyBwZXIgcGF5bWVudENoYW5uZWwsCiAgICAgICAgICAgICAqIHVzaW5nIGdhcyBwcmljZSA9IDRHd2VpIDJrIHBheW1lbnRDaGFubmVscyB3aWxsIGNvc3QgfjEuNCBFVEguCiAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgYWRkcmVzcyBwYXltZW50Q2hhbm5lbCA9IG5ldyBBbmFseXRpY1Byb3h5KCk7CiAgICAgICAgICAgIG1fdmFsaWRQYXltZW50Q2hhbm5lbHNbcGF5bWVudENoYW5uZWxdID0gdHJ1ZTsKICAgICAgICAgICAgbV9wYXltZW50Q2hhbm5lbHMucHVzaChwYXltZW50Q2hhbm5lbCk7CiAgICAgICAgICAgIHBheW1lbnRDaGFubmVsc0NyZWF0ZWQrKzsKCiAgICAgICAgICAgIC8vIGNvc3Qgb2YgY3JlYXRpbmcgb25lIGNoYW5uZWwKICAgICAgICAgICAgdWludCBnYXNQZXJDaGFubmVsID0gc3RhcnRpbmdHYXMuc3ViKG1zZy5nYXMpOwogICAgICAgICAgICBpZiAoZ2FzUGVyQ2hhbm5lbC5hZGQoNTAwMDApID4gbXNnLmdhcykKICAgICAgICAgICAgICAgIGJyZWFrOyAgLy8gZW5vdWdoIHByb3hpZXMgZm9yIHRoaXMgY2FsbAogICAgICAgIH0KICAgICAgICByZXR1cm4gcGF5bWVudENoYW5uZWxzQ3JlYXRlZDsKICAgIH0KCgogICAgLy8vIEBkZXYgcHJvY2VzcyBwYXltZW50cyAtIHJlY29yZCBhbmFseXRpY3MgYW5kIHBhc3MgY29udHJvbCB0byBpYU9uSW52ZXN0ZWQgY2FsbGJhY2sKICAgIGZ1bmN0aW9uIGlhSW52ZXN0ZWRCeShhZGRyZXNzIGludmVzdG9yKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBhZGRyZXNzIHBheW1lbnRDaGFubmVsID0gbXNnLnNlbmRlcjsKICAgICAgICBpZiAobV92YWxpZFBheW1lbnRDaGFubmVsc1twYXltZW50Q2hhbm5lbF0pIHsKICAgICAgICAgICAgLy8gcGF5bWVudCByZWNlaXZlZCBieSBvbmUgb2Ygb3VyIGNoYW5uZWxzCiAgICAgICAgICAgIHVpbnQgdmFsdWUgPSBtc2cudmFsdWU7CiAgICAgICAgICAgIG1faW52ZXN0bWVudHNCeVBheW1lbnRDaGFubmVsW3BheW1lbnRDaGFubmVsXSA9IG1faW52ZXN0bWVudHNCeVBheW1lbnRDaGFubmVsW3BheW1lbnRDaGFubmVsXS5hZGQodmFsdWUpOwogICAgICAgICAgICAvLyBXZSBrbm93IGZvciBzdXJlIHRoYXQgaW52ZXN0bWVudCBjYW1lIGZyb20gc3BlY2lmaWVkIGludmVzdG9yIChzZWUgQW5hbHl0aWNQcm94eSkuCiAgICAgICAgICAgIGlhT25JbnZlc3RlZChpbnZlc3RvciwgdmFsdWUsIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIExvb2tzIGxpa2Ugc29tZSB1c2VyIGhhcyBwYWlkIHRvIHRoaXMgbWV0aG9kLCB0aGlzIHBheW1lbnQgaXMgbm90IGluY2x1ZGVkIGluIHRoZSBhbmFseXRpY3MsCiAgICAgICAgICAgIC8vIGJ1dCwgb2YgY291cnNlLCBwcm9jZXNzZWQuCiAgICAgICAgICAgIGlhT25JbnZlc3RlZChtc2cuc2VuZGVyLCBtc2cudmFsdWUsIGZhbHNlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgY2FsbGJhY2sKICAgIGZ1bmN0aW9uIGlhT25JbnZlc3RlZChhZGRyZXNzIC8qaW52ZXN0b3IqLywgdWludCAvKnBheW1lbnQqLywgYm9vbCAvKnVzaW5nUGF5bWVudENoYW5uZWwqLykgaW50ZXJuYWwgewogICAgfQoKCiAgICBmdW5jdGlvbiBwYXltZW50Q2hhbm5lbHNDb3VudCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbV9wYXltZW50Q2hhbm5lbHMubGVuZ3RoOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlYWRBbmFseXRpY3NNYXAoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzW10sIHVpbnRbXSkgewogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkga2V5cyA9IG5ldyBhZGRyZXNzW10obV9wYXltZW50Q2hhbm5lbHMubGVuZ3RoKTsKICAgICAgICB1aW50W10gbWVtb3J5IHZhbHVlcyA9IG5ldyB1aW50W10obV9wYXltZW50Q2hhbm5lbHMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbV9wYXltZW50Q2hhbm5lbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyBrZXkgPSBtX3BheW1lbnRDaGFubmVsc1tpXTsKICAgICAgICAgICAga2V5c1tpXSA9IGtleTsKICAgICAgICAgICAgdmFsdWVzW2ldID0gbV9pbnZlc3RtZW50c0J5UGF5bWVudENoYW5uZWxba2V5XTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAoa2V5cywgdmFsdWVzKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWFkUGF5bWVudENoYW5uZWxzKCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzc1tdKSB7CiAgICAgICAgcmV0dXJuIG1fcGF5bWVudENoYW5uZWxzOwogICAgfQoKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG1faW52ZXN0bWVudHNCeVBheW1lbnRDaGFubmVsOwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIG1fdmFsaWRQYXltZW50Q2hhbm5lbHM7CgogICAgYWRkcmVzc1tdIHB1YmxpYyBtX3BheW1lbnRDaGFubmVsczsKfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCgovKioKICogQHRpdGxlIEJhc2ljIGNyb3dkc2FsZSBzdGF0CiAqIEBhdXRob3IgRWVuYWUKICovCmNvbnRyYWN0IElDcm93ZHNhbGVTdGF0IHsKCiAgICAvLy8gQG5vdGljZSBhbW91bnQgb2YgZnVuZHMgY29sbGVjdGVkIGluIHdlaQogICAgZnVuY3Rpb24gZ2V0V2VpQ29sbGVjdGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAbm90aWNlIGFtb3VudCBvZiB0b2tlbnMgbWludGVkIChOT1QgZXF1YWwgdG8gdG90YWxTdXBwbHkoKSBpbiBjYXNlIHRva2VuIGlzIHJldXNlZCEpCiAgICBmdW5jdGlvbiBnZXRUb2tlbk1pbnRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKfQoKCgoKCgovKioKICogQHRpdGxlIEhlbHBzIGNvbnRyYWN0cyBndWFyZCBhZ2FpbnMgcmVudHJhbmN5IGF0dGFja3MuCiAqIEBhdXRob3IgUmVtY28gQmxvZW1lbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjgyZjBlN2VmZTFlZGMyYjAiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+z4AuY29tPgogKiBAbm90aWNlIElmIHlvdSBtYXJrIGEgZnVuY3Rpb24gYG5vblJlZW50cmFudGAsIHlvdSBzaG91bGQgYWxzbwogKiBtYXJrIGl0IGBleHRlcm5hbGAuCiAqLwpjb250cmFjdCBSZWVudHJhbmN5R3VhcmQgewoKICAvKioKICAgKiBAZGV2IFdlIHVzZSBhIHNpbmdsZSBsb2NrIGZvciB0aGUgd2hvbGUgY29udHJhY3QuCiAgICovCiAgYm9vbCBwcml2YXRlIHJlbnRyYW5jeV9sb2NrID0gZmFsc2U7CgogIC8qKgogICAqIEBkZXYgUHJldmVudHMgYSBjb250cmFjdCBmcm9tIGNhbGxpbmcgaXRzZWxmLCBkaXJlY3RseSBvciBpbmRpcmVjdGx5LgogICAqIEBub3RpY2UgSWYgeW91IG1hcmsgYSBmdW5jdGlvbiBgbm9uUmVlbnRyYW50YCwgeW91IHNob3VsZCBhbHNvCiAgICogbWFyayBpdCBgZXh0ZXJuYWxgLiBDYWxsaW5nIG9uZSBub25SZWVudHJhbnQgZnVuY3Rpb24gZnJvbQogICAqIGFub3RoZXIgaXMgbm90IHN1cHBvcnRlZC4gSW5zdGVhZCwgeW91IGNhbiBpbXBsZW1lbnQgYQogICAqIGBwcml2YXRlYCBmdW5jdGlvbiBkb2luZyB0aGUgYWN0dWFsIHdvcmssIGFuZCBhIGBleHRlcm5hbGAKICAgKiB3cmFwcGVyIG1hcmtlZCBhcyBgbm9uUmVlbnRyYW50YC4KICAgKi8KICBtb2RpZmllciBub25SZWVudHJhbnQoKSB7CiAgICByZXF1aXJlKCFyZW50cmFuY3lfbG9jayk7CiAgICByZW50cmFuY3lfbG9jayA9IHRydWU7CiAgICBfOwogICAgcmVudHJhbmN5X2xvY2sgPSBmYWxzZTsKICB9Cgp9CgoKCgoKLy8vIEB0aXRsZSBCYXNlIGNvbnRyYWN0IGZvciBzaW1wbGUgY3Jvd2RzYWxlcwpjb250cmFjdCBTaW1wbGVDcm93ZHNhbGVCYXNlIGlzIEFyZ3VtZW50c0NoZWNrZXIsIFJlZW50cmFuY3lHdWFyZCwgSUludmVzdG1lbnRzV2FsbGV0Q29ubmVjdG9yLCBJQ3Jvd2RzYWxlU3RhdCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBldmVudCBGdW5kVHJhbnNmZXIoYWRkcmVzcyBiYWNrZXIsIHVpbnQgYW1vdW50LCBib29sIGlzQ29udHJpYnV0aW9uKTsKCiAgICBmdW5jdGlvbiBTaW1wbGVDcm93ZHNhbGVCYXNlKGFkZHJlc3MgdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKHRva2VuKQogICAgewogICAgICAgIG1fdG9rZW4gPSBNaW50YWJsZU11bHRpb3duZWRUb2tlbih0b2tlbik7CiAgICB9CgoKICAgIC8vIFBVQkxJQyBpbnRlcmZhY2U6IHBheW1lbnRzCgogICAgLy8gZmFsbGJhY2sgZnVuY3Rpb24gYXMgYSBzaG9ydGN1dAogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKDAgPT0gbXNnLmRhdGEubGVuZ3RoKTsKICAgICAgICBidXkoKTsgIC8vIG9ubHkgaW50ZXJuYWwgY2FsbCBoZXJlIQogICAgfQoKICAgIC8vLyBAbm90aWNlIGNyb3dkc2FsZSBwYXJ0aWNpcGF0aW9uCiAgICBmdW5jdGlvbiBidXkoKSBwdWJsaWMgcGF5YWJsZSB7ICAgICAvLyBkb250IG1hcmsgYXMgZXh0ZXJuYWwhCiAgICAgICAgYnV5SW50ZXJuYWwobXNnLnNlbmRlciwgbXNnLnZhbHVlLCAwKTsKICAgIH0KCgogICAgLy8gSU5URVJOQUwKCiAgICAvLy8gQGRldiBwYXltZW50IHByb2Nlc3NpbmcKICAgIGZ1bmN0aW9uIGJ1eUludGVybmFsKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgcGF5bWVudCwgdWludCBleHRyYUJvbnVzZXMpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBub25SZWVudHJhbnQKICAgIHsKICAgICAgICByZXF1aXJlKHBheW1lbnQgPj0gZ2V0TWluSW52ZXN0bWVudCgpKTsKICAgICAgICByZXF1aXJlKGdldEN1cnJlbnRUaW1lKCkgPj0gZ2V0U3RhcnRUaW1lKCkgfHwgISBtdXN0QXBwbHlUaW1lQ2hlY2soaW52ZXN0b3IsIHBheW1lbnQpIC8qIGZvciBmaW5hbCBjaGVjayAqLyk7CiAgICAgICAgaWYgKGdldEN1cnJlbnRUaW1lKCkgPj0gZ2V0RW5kVGltZSgpKQogICAgICAgICAgICBmaW5pc2goKTsKCiAgICAgICAgaWYgKG1fZmluaXNoZWQpIHsKICAgICAgICAgICAgLy8gc2F2aW5nIHByb3ZpZGVkIGdhcwogICAgICAgICAgICBpbnZlc3Rvci50cmFuc2ZlcihwYXltZW50KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdWludCBzdGFydGluZ1dlaUNvbGxlY3RlZCA9IGdldFdlaUNvbGxlY3RlZCgpOwogICAgICAgIHVpbnQgc3RhcnRpbmdJbnZhcmlhbnQgPSB0aGlzLmJhbGFuY2UuYWRkKHN0YXJ0aW5nV2VpQ29sbGVjdGVkKTsKCiAgICAgICAgLy8gcmV0dXJuIG9yIHVwZGF0ZSBwYXltZW50IGlmIG5lZWRlZAogICAgICAgIHVpbnQgcGF5bWVudEFsbG93ZWQgPSBnZXRNYXhpbXVtRnVuZHMoKS5zdWIoZ2V0V2VpQ29sbGVjdGVkKCkpOwogICAgICAgIGFzc2VydCgwICE9IHBheW1lbnRBbGxvd2VkKTsKCiAgICAgICAgdWludCBjaGFuZ2U7CiAgICAgICAgaWYgKHBheW1lbnRBbGxvd2VkIDwgcGF5bWVudCkgewogICAgICAgICAgICBjaGFuZ2UgPSBwYXltZW50LnN1YihwYXltZW50QWxsb3dlZCk7CiAgICAgICAgICAgIHBheW1lbnQgPSBwYXltZW50QWxsb3dlZDsKICAgICAgICB9CgogICAgICAgIC8vIGlzc3VlIHRva2VucwogICAgICAgIHVpbnQgdG9rZW5zID0gY2FsY3VsYXRlVG9rZW5zKGludmVzdG9yLCBwYXltZW50LCBleHRyYUJvbnVzZXMpOwogICAgICAgIG1fdG9rZW4ubWludChpbnZlc3RvciwgdG9rZW5zKTsKICAgICAgICBtX3Rva2Vuc01pbnRlZCArPSB0b2tlbnM7CgogICAgICAgIC8vIHJlY29yZCBwYXltZW50CiAgICAgICAgc3RvcmVJbnZlc3RtZW50KGludmVzdG9yLCBwYXltZW50KTsKICAgICAgICBhc3NlcnQoZ2V0V2VpQ29sbGVjdGVkKCkgPD0gZ2V0TWF4aW11bUZ1bmRzKCkgJiYgZ2V0V2VpQ29sbGVjdGVkKCkgPiBzdGFydGluZ1dlaUNvbGxlY3RlZCk7CiAgICAgICAgRnVuZFRyYW5zZmVyKGludmVzdG9yLCBwYXltZW50LCB0cnVlKTsKCiAgICAgICAgaWYgKGdldFdlaUNvbGxlY3RlZCgpID09IGdldE1heGltdW1GdW5kcygpKQogICAgICAgICAgICBmaW5pc2goKTsKCiAgICAgICAgaWYgKGNoYW5nZSA+IDApCiAgICAgICAgICAgIGludmVzdG9yLnRyYW5zZmVyKGNoYW5nZSk7CgogICAgICAgIGFzc2VydChzdGFydGluZ0ludmFyaWFudCA9PSB0aGlzLmJhbGFuY2UuYWRkKGdldFdlaUNvbGxlY3RlZCgpKS5hZGQoY2hhbmdlKSk7CiAgICB9CgogICAgZnVuY3Rpb24gZmluaXNoKCkgaW50ZXJuYWwgewogICAgICAgIGlmIChtX2ZpbmlzaGVkKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIGlmIChnZXRXZWlDb2xsZWN0ZWQoKSA+PSBnZXRNaW5pbXVtRnVuZHMoKSkKICAgICAgICAgICAgd2NPbkNyb3dkc2FsZVN1Y2Nlc3MoKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHdjT25Dcm93ZHNhbGVGYWlsdXJlKCk7CgogICAgICAgIG1fZmluaXNoZWQgPSB0cnVlOwogICAgfQoKCiAgICAvLyBPdGhlciBwbHVnZ2FibGVzCgogICAgLy8vIEBkZXYgc2F5cyBpZiBjcm93ZHNhbGUgdGltZSBib3VuZHMgbXVzdCBiZSBjaGVja2VkCiAgICBmdW5jdGlvbiBtdXN0QXBwbHlUaW1lQ2hlY2soYWRkcmVzcyAvKmludmVzdG9yKi8sIHVpbnQgLypwYXltZW50Ki8pIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiB0byBiZSBvdmVycmlkZGVuIGluIHRlc3RzCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50VGltZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICAgIC8vLyBAbm90aWNlIG1heGltdW0gaW52ZXN0bWVudHMgdG8gYmUgYWNjZXB0ZWQgZHVyaW5nIHByZS1JQ08KICAgIGZ1bmN0aW9uIGdldE1heGltdW1GdW5kcygpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAbm90aWNlIG1pbmltdW0gYW1vdW50IG9mIGZ1bmRpbmcgdG8gY29uc2lkZXIgY3Jvd2RzYWxlIGFzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGdldE1pbmltdW1GdW5kcygpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAbm90aWNlIHN0YXJ0IHRpbWUgb2YgdGhlIHByZS1JQ08KICAgIGZ1bmN0aW9uIGdldFN0YXJ0VGltZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAbm90aWNlIGVuZCB0aW1lIG9mIHRoZSBwcmUtSUNPCiAgICBmdW5jdGlvbiBnZXRFbmRUaW1lKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBub3RpY2UgbWluaW1hbCBhbW91bnQgb2YgaW52ZXN0bWVudAogICAgZnVuY3Rpb24gZ2V0TWluSW52ZXN0bWVudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIDEwIGZpbm5leTsKICAgIH0KCiAgICAvLy8gQGRldiBjYWxjdWxhdGVzIHRva2VuIGFtb3VudCBmb3IgZ2l2ZW4gaW52ZXN0bWVudAogICAgZnVuY3Rpb24gY2FsY3VsYXRlVG9rZW5zKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgcGF5bWVudCwgdWludCBleHRyYUJvbnVzZXMpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKCiAgICAvLyBJQ3Jvd2RzYWxlU3RhdAoKICAgIGZ1bmN0aW9uIGdldFdlaUNvbGxlY3RlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGdldFRvdGFsSW52ZXN0bWVudHNTdG9yZWQoKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBhbW91bnQgb2YgdG9rZW5zIG1pbnRlZCAoTk9UIGVxdWFsIHRvIHRvdGFsU3VwcGx5KCkgaW4gY2FzZSB0b2tlbiBpcyByZXVzZWQhKQogICAgZnVuY3Rpb24gZ2V0VG9rZW5NaW50ZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBtX3Rva2Vuc01pbnRlZDsKICAgIH0KCgogICAgLy8gRklFTERTCgogICAgLy8vIEBkZXYgY29udHJhY3QgcmVzcG9uc2libGUgZm9yIHRva2VuIGFjY291bnRpbmcKICAgIE1pbnRhYmxlTXVsdGlvd25lZFRva2VuIHB1YmxpYyBtX3Rva2VuOwoKICAgIHVpbnQgbV90b2tlbnNNaW50ZWQ7CgogICAgYm9vbCBtX2ZpbmlzaGVkID0gZmFsc2U7Cn0KCgoKLy8vIEB0aXRsZSBCYXNlIGNvbnRyYWN0IGZvciBTdG9yaXFhIHByZS1JQ08KY29udHJhY3QgU1RRUHJlSUNPQmFzZSBpcyBTaW1wbGVDcm93ZHNhbGVCYXNlLCBPd25hYmxlLCBJbnZlc3RtZW50QW5hbHl0aWNzIHsKCiAgICBmdW5jdGlvbiBTVFFQcmVJQ09CYXNlKGFkZHJlc3MgdG9rZW4pCiAgICAgICAgU2ltcGxlQ3Jvd2RzYWxlQmFzZSh0b2tlbikKICAgIHsKICAgIH0KCgogICAgLy8gUFVCTElDIGludGVyZmFjZTogbWFpbnRlbmFuY2UKCiAgICBmdW5jdGlvbiBjcmVhdGVNb3JlUGF5bWVudENoYW5uZWxzKHVpbnQgbGltaXQpIGV4dGVybmFsIG9ubHlPd25lciByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZU1vcmVQYXltZW50Q2hhbm5lbHNJbnRlcm5hbChsaW1pdCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGVzdHMgb3duZXJzaGlwIG9mIHRoZSBjdXJyZW50IGNhbGxlci4KICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgaXQncyBhbiBvd25lcgogICAgLy8gSXQncyBhZHZpc2FibGUgdG8gY2FsbCBpdCBieSBuZXcgb3duZXIgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHNhbWUgZXJyb25lb3VzIGFkZHJlc3MgaXMgbm90IGNvcHktcGFzdGVkIHRvCiAgICAvLyBhZGRPd25lci9jaGFuZ2VPd25lciBhbmQgdG8gaXNPd25lci4KICAgIGZ1bmN0aW9uIGFtSU93bmVyKCkgZXh0ZXJuYWwgY29uc3RhbnQgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8gSU5URVJOQUwKCiAgICAvLy8gQGRldiBwYXltZW50IGNhbGxiYWNrCiAgICBmdW5jdGlvbiBpYU9uSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCBwYXltZW50LCBib29sIHVzaW5nUGF5bWVudENoYW5uZWwpIGludGVybmFsIHsKICAgICAgICBidXlJbnRlcm5hbChpbnZlc3RvciwgcGF5bWVudCwgdXNpbmdQYXltZW50Q2hhbm5lbCA/IGNfcGF5bWVudENoYW5uZWxCb251c1BlcmNlbnQgOiAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbnMoYWRkcmVzcyAvKmludmVzdG9yKi8sIHVpbnQgcGF5bWVudCwgdWludCBleHRyYUJvbnVzZXMpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGJvbnVzUGVyY2VudCA9IGdldFByZUlDT0JvbnVzKCkuYWRkKGdldExhcmdlUGF5bWVudEJvbnVzKHBheW1lbnQpKS5hZGQoZXh0cmFCb251c2VzKTsKICAgICAgICB1aW50IHJhdGUgPSBjX1NUUXBlckVUSC5tdWwoYm9udXNQZXJjZW50LmFkZCgxMDApKS5kaXYoMTAwKTsKCiAgICAgICAgcmV0dXJuIHBheW1lbnQubXVsKHJhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExhcmdlUGF5bWVudEJvbnVzKHVpbnQgcGF5bWVudCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKHBheW1lbnQgPj0gNTAwMCBldGhlcikgcmV0dXJuIDIwOwogICAgICAgIGlmIChwYXltZW50ID49IDMwMDAgZXRoZXIpIHJldHVybiAxNTsKICAgICAgICBpZiAocGF5bWVudCA+PSAxMDAwIGV0aGVyKSByZXR1cm4gMTA7CiAgICAgICAgaWYgKHBheW1lbnQgPj0gODAwIGV0aGVyKSByZXR1cm4gODsKICAgICAgICBpZiAocGF5bWVudCA+PSA1MDAgZXRoZXIpIHJldHVybiA1OwogICAgICAgIGlmIChwYXltZW50ID49IDIwMCBldGhlcikgcmV0dXJuIDI7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gbXVzdEFwcGx5VGltZUNoZWNrKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgLypwYXltZW50Ki8pIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gaW52ZXN0b3IgIT0gb3duZXI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgcHJlLUlDTyBib251cwogICAgZnVuY3Rpb24gZ2V0UHJlSUNPQm9udXMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCgogICAgLy8gRklFTERTCgogICAgLy8vIEBub3RpY2Ugc3RhcnRpbmcgZXhjaGFuZ2UgcmF0ZSBvZiBTVFEKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IGNfU1RRcGVyRVRIID0gMTAwMDAwOwoKICAgIC8vLyBAbm90aWNlIGF1dGhvcmlzZWQgcGF5bWVudCBib251cwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgY19wYXltZW50Q2hhbm5lbEJvbnVzUGVyY2VudCA9IDI7Cn0KCgoKCi8vLyBAdGl0bGUgU3RvcmlxYSBwcmUtSUNPIGNvbnRyYWN0CmNvbnRyYWN0IFNUUVByZUlDTzMgaXMgU1RRUHJlSUNPQmFzZSwgRXh0ZXJuYWxBY2NvdW50V2FsbGV0Q29ubmVjdG9yIHsKCiAgICBmdW5jdGlvbiBTVFFQcmVJQ08zKGFkZHJlc3MgdG9rZW4sIGFkZHJlc3Mgd2FsbGV0KQogICAgICAgIFNUUVByZUlDT0Jhc2UodG9rZW4pCiAgICAgICAgRXh0ZXJuYWxBY2NvdW50V2FsbGV0Q29ubmVjdG9yKHdhbGxldCkKICAgIHsKCiAgICB9CgoKICAgIC8vIElOVEVSTkFMCgogICAgZnVuY3Rpb24gZ2V0V2VpQ29sbGVjdGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gZ2V0VG90YWxJbnZlc3RtZW50c1N0b3JlZCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIG1pbmltdW0gYW1vdW50IG9mIGZ1bmRpbmcgdG8gY29uc2lkZXIgY3Jvd2RzYWxlIGFzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGdldE1pbmltdW1GdW5kcygpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBtYXhpbXVtIGludmVzdG1lbnRzIHRvIGJlIGFjY2VwdGVkIGR1cmluZyBwcmUtSUNPCiAgICBmdW5jdGlvbiBnZXRNYXhpbXVtRnVuZHMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIDEwMDAwMDAwMCBldGhlcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBzdGFydCB0aW1lIG9mIHRoZSBwcmUtSUNPCiAgICBmdW5jdGlvbiBnZXRTdGFydFRpbWUoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIDE1MDg5NTgwMDA7IC8vIDIwMTctMTAtMjUgMTk6MDA6MDAKICAgIH0KCiAgICAvLy8gQG5vdGljZSBlbmQgdGltZSBvZiB0aGUgcHJlLUlDTwogICAgZnVuY3Rpb24gZ2V0RW5kVGltZSgpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gMTUxMTU2ODAwMDsgLy8yMDE3LTExLTI1IDAwOjAwOjAwCiAgICB9CgogICAgLy8vIEBub3RpY2UgcHJlLUlDTyBib251cwogICAgZnVuY3Rpb24gZ2V0UHJlSUNPQm9udXMoKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIDMzOwogICAgfQp9'.
	

]
