Class {
	#name : #SRT6090a6e47849629b7245dfa1ca21d94cd15878ef,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6090a6e47849629b7245dfa1ca21d94cd15878ef >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCgovKgoKVGVtcG9yYXJ5IEhhc2ggUmVnaXN0cmFyCj09PT09PT09PT09PT09PT09PT09PT09PQoKVGhpcyBpcyBhIHNpbXBsaWZpZWQgdmVyc2lvbiBvZiBhIGhhc2ggcmVnaXN0cmFyLiBJdCBpcyBwdXJwb3JzZWZ1bGx5IGxpbWl0ZWQ6Cm5hbWVzIGNhbm5vdCBiZSBzaXggbGV0dGVycyBvciBzaG9ydGVyLCBuZXcgYXVjdGlvbnMgd2lsbCBzdG9wIGFmdGVyIDQgeWVhcnMuCgpUaGUgcGxhbiBpcyB0byB0ZXN0IHRoZSBiYXNpYyBmZWF0dXJlcyBhbmQgdGhlbiBtb3ZlIHRvIGEgbmV3IGNvbnRyYWN0IGluIGF0IG1vc3QKMiB5ZWFycywgd2hlbiBzb21lIHNvcnQgb2YgcmVuZXdhbCBtZWNoYW5pc20gd2lsbCBiZSBlbmFibGVkLgoqLwoKY29udHJhY3QgQWJzdHJhY3RFTlMgewogICAgZnVuY3Rpb24gb3duZXIoYnl0ZXMzMiBub2RlKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gcmVzb2x2ZXIoYnl0ZXMzMiBub2RlKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gdHRsKGJ5dGVzMzIgbm9kZSkgY29uc3RhbnQgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gc2V0T3duZXIoYnl0ZXMzMiBub2RlLCBhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIHNldFN1Ym5vZGVPd25lcihieXRlczMyIG5vZGUsIGJ5dGVzMzIgbGFiZWwsIGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gc2V0UmVzb2x2ZXIoYnl0ZXMzMiBub2RlLCBhZGRyZXNzIHJlc29sdmVyKTsKICAgIGZ1bmN0aW9uIHNldFRUTChieXRlczMyIG5vZGUsIHVpbnQ2NCB0dGwpOwoKICAgIC8vIExvZ2dlZCB3aGVuIHRoZSBvd25lciBvZiBhIG5vZGUgYXNzaWducyBhIG5ldyBvd25lciB0byBhIHN1Ym5vZGUuCiAgICBldmVudCBOZXdPd25lcihieXRlczMyIGluZGV4ZWQgbm9kZSwgYnl0ZXMzMiBpbmRleGVkIGxhYmVsLCBhZGRyZXNzIG93bmVyKTsKCiAgICAvLyBMb2dnZWQgd2hlbiB0aGUgb3duZXIgb2YgYSBub2RlIHRyYW5zZmVycyBvd25lcnNoaXAgdG8gYSBuZXcgYWNjb3VudC4KICAgIGV2ZW50IFRyYW5zZmVyKGJ5dGVzMzIgaW5kZXhlZCBub2RlLCBhZGRyZXNzIG93bmVyKTsKCiAgICAvLyBMb2dnZWQgd2hlbiB0aGUgcmVzb2x2ZXIgZm9yIGEgbm9kZSBjaGFuZ2VzLgogICAgZXZlbnQgTmV3UmVzb2x2ZXIoYnl0ZXMzMiBpbmRleGVkIG5vZGUsIGFkZHJlc3MgcmVzb2x2ZXIpOwoKICAgIC8vIExvZ2dlZCB3aGVuIHRoZSBUVEwgb2YgYSBub2RlIGNoYW5nZXMKICAgIGV2ZW50IE5ld1RUTChieXRlczMyIGluZGV4ZWQgbm9kZSwgdWludDY0IHR0bCk7Cn0KCi8qKgogKiBAdGl0bGUgRGVlZCB0byBob2xkIGV0aGVyIGluIGV4Y2hhbmdlIGZvciBvd25lcnNoaXAgb2YgYSBub2RlCiAqIEBkZXYgVGhlIGRlZWQgY2FuIGJlIGNvbnRyb2xsZWQgb25seSBieSB0aGUgcmVnaXN0cmFyIGFuZCBjYW4gb25seSBzZW5kIGV0aGVyIGJhY2sgdG8gdGhlIG93bmVyLgogKi8KY29udHJhY3QgRGVlZCB7CiAgICBhZGRyZXNzIHB1YmxpYyByZWdpc3RyYXI7CiAgICBhZGRyZXNzIGNvbnN0YW50IGJ1cm4gPSAweGRlYWQ7CiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkRhdGU7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIHByZXZpb3VzT3duZXI7CiAgICB1aW50IHB1YmxpYyB2YWx1ZTsKICAgIGV2ZW50IE93bmVyQ2hhbmdlZChhZGRyZXNzIG5ld093bmVyKTsKICAgIGV2ZW50IERlZWRDbG9zZWQoKTsKICAgIGJvb2wgYWN0aXZlOwoKCiAgICBtb2RpZmllciBvbmx5UmVnaXN0cmFyIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSByZWdpc3RyYXIpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFjdGl2ZSB7CiAgICAgICAgaWYgKCFhY3RpdmUpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gRGVlZChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSB7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgcmVnaXN0cmFyID0gbXNnLnNlbmRlcjsKICAgICAgICBjcmVhdGlvbkRhdGUgPSBub3c7CiAgICAgICAgYWN0aXZlID0gdHJ1ZTsKICAgICAgICB2YWx1ZSA9IG1zZy52YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRPd25lcihhZGRyZXNzIG5ld093bmVyKSBvbmx5UmVnaXN0cmFyIHsKICAgICAgICBpZiAobmV3T3duZXIgPT0gMCkgdGhyb3c7CiAgICAgICAgcHJldmlvdXNPd25lciA9IG93bmVyOyAgLy8gVGhpcyBhbGxvd3MgY29udHJhY3RzIHRvIGNoZWNrIHdobyBzZW50IHRoZW0gdGhlIG93bmVyc2hpcAogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgT3duZXJDaGFuZ2VkKG5ld093bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRSZWdpc3RyYXIoYWRkcmVzcyBuZXdSZWdpc3RyYXIpIG9ubHlSZWdpc3RyYXIgewogICAgICAgIHJlZ2lzdHJhciA9IG5ld1JlZ2lzdHJhcjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCYWxhbmNlKHVpbnQgbmV3VmFsdWUsIGJvb2wgdGhyb3dPbkZhaWx1cmUpIG9ubHlSZWdpc3RyYXIgb25seUFjdGl2ZSB7CiAgICAgICAgLy8gQ2hlY2sgaWYgaXQgaGFzIGVub3VnaCBiYWxhbmNlIHRvIHNldCB0aGUgdmFsdWUKICAgICAgICBpZiAodmFsdWUgPCBuZXdWYWx1ZSkgdGhyb3c7CiAgICAgICAgdmFsdWUgPSBuZXdWYWx1ZTsKICAgICAgICAvLyBTZW5kIHRoZSBkaWZmZXJlbmNlIHRvIHRoZSBvd25lcgogICAgICAgIGlmICghb3duZXIuc2VuZCh0aGlzLmJhbGFuY2UgLSBuZXdWYWx1ZSkgJiYgdGhyb3dPbkZhaWx1cmUpIHRocm93OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDbG9zZSBhIGRlZWQgYW5kIHJlZnVuZCBhIHNwZWNpZmllZCBmcmFjdGlvbiBvZiB0aGUgYmlkIHZhbHVlCiAgICAgKiBAcGFyYW0gcmVmdW5kUmF0aW8gVGhlIGFtb3VudCoxLzEwMDAgdG8gcmVmdW5kCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsb3NlRGVlZCh1aW50IHJlZnVuZFJhdGlvKSBvbmx5UmVnaXN0cmFyIG9ubHlBY3RpdmUgewogICAgICAgIGFjdGl2ZSA9IGZhbHNlOwogICAgICAgIGlmICghIGJ1cm4uc2VuZCgoKDEwMDAgLSByZWZ1bmRSYXRpbykgKiB0aGlzLmJhbGFuY2UpLzEwMDApKSB0aHJvdzsKICAgICAgICBEZWVkQ2xvc2VkKCk7CiAgICAgICAgZGVzdHJveURlZWQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2xvc2UgYSBkZWVkIGFuZCByZWZ1bmQgYSBzcGVjaWZpZWQgZnJhY3Rpb24gb2YgdGhlIGJpZCB2YWx1ZQogICAgICovCiAgICBmdW5jdGlvbiBkZXN0cm95RGVlZCgpIHsKICAgICAgICBpZiAoYWN0aXZlKSB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBJbnN0ZWFkIG9mIHNlbGZkZXN0cnVjdChvd25lciksIGludm9rZSBvd25lciBmYWxsYmFjayBmdW5jdGlvbiB0byBhbGxvdwogICAgICAgIC8vIG93bmVyIHRvIGxvZyBhbiBldmVudCBpZiBkZXNpcmVkOyBidXQgb3duZXIgc2hvdWxkIGFsc28gYmUgYXdhcmUgdGhhdAogICAgICAgIC8vIGl0cyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYWxzbyBiZSBpbnZva2VkIGJ5IHNldEJhbGFuY2UKICAgICAgICBpZihvd25lci5zZW5kKHRoaXMuYmFsYW5jZSkpIHsKICAgICAgICAgICAgc2VsZmRlc3RydWN0KGJ1cm4pOwogICAgICAgIH0KICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBSZWdpc3RyYXIKICogQGRldiBUaGUgcmVnaXN0cmFyIGhhbmRsZXMgdGhlIGF1Y3Rpb24gcHJvY2VzcyBmb3IgZWFjaCBzdWJub2RlIG9mIHRoZSBub2RlIGl0IG93bnMuCiAqLwpjb250cmFjdCBSZWdpc3RyYXIgewogICAgQWJzdHJhY3RFTlMgcHVibGljIGVuczsKICAgIGJ5dGVzMzIgcHVibGljIHJvb3ROb2RlOwoKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gZW50cnkpIF9lbnRyaWVzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nKGJ5dGVzMzIgPT4gRGVlZCkpIHB1YmxpYyBzZWFsZWRCaWRzOwogICAgCiAgICBlbnVtIE1vZGUgeyBPcGVuLCBBdWN0aW9uLCBPd25lZCwgRm9yYmlkZGVuLCBSZXZlYWwsIE5vdFlldEF2YWlsYWJsZSB9CgogICAgdWludDMyIGNvbnN0YW50IHRvdGFsQXVjdGlvbkxlbmd0aCA9IDUgZGF5czsKICAgIHVpbnQzMiBjb25zdGFudCByZXZlYWxQZXJpb2QgPSA0OCBob3VyczsKICAgIHVpbnQzMiBwdWJsaWMgY29uc3RhbnQgbGF1bmNoTGVuZ3RoID0gOCB3ZWVrczsKCiAgICB1aW50IGNvbnN0YW50IG1pblByaWNlID0gMC4wMSBldGhlcjsKICAgIHVpbnQgcHVibGljIHJlZ2lzdHJ5U3RhcnRlZDsKCiAgICBldmVudCBBdWN0aW9uU3RhcnRlZChieXRlczMyIGluZGV4ZWQgaGFzaCwgdWludCByZWdpc3RyYXRpb25EYXRlKTsKICAgIGV2ZW50IE5ld0JpZChieXRlczMyIGluZGV4ZWQgaGFzaCwgYWRkcmVzcyBpbmRleGVkIGJpZGRlciwgdWludCBkZXBvc2l0KTsKICAgIGV2ZW50IEJpZFJldmVhbGVkKGJ5dGVzMzIgaW5kZXhlZCBoYXNoLCBhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgdmFsdWUsIHVpbnQ4IHN0YXR1cyk7CiAgICBldmVudCBIYXNoUmVnaXN0ZXJlZChieXRlczMyIGluZGV4ZWQgaGFzaCwgYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IHZhbHVlLCB1aW50IHJlZ2lzdHJhdGlvbkRhdGUpOwogICAgZXZlbnQgSGFzaFJlbGVhc2VkKGJ5dGVzMzIgaW5kZXhlZCBoYXNoLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IEhhc2hJbnZhbGlkYXRlZChieXRlczMyIGluZGV4ZWQgaGFzaCwgc3RyaW5nIGluZGV4ZWQgbmFtZSwgdWludCB2YWx1ZSwgdWludCByZWdpc3RyYXRpb25EYXRlKTsKCiAgICBzdHJ1Y3QgZW50cnkgewogICAgICAgIERlZWQgZGVlZDsKICAgICAgICB1aW50IHJlZ2lzdHJhdGlvbkRhdGU7CiAgICAgICAgdWludCB2YWx1ZTsKICAgICAgICB1aW50IGhpZ2hlc3RCaWQ7CiAgICB9CgogICAgLy8gU3RhdGUgdHJhbnNpdGlvbnMgZm9yIG5hbWVzOgogICAgLy8gICBPcGVuIC0+IEF1Y3Rpb24gKHN0YXJ0QXVjdGlvbikKICAgIC8vICAgQXVjdGlvbiAtPiBSZXZlYWwKICAgIC8vICAgUmV2ZWFsIC0+IE93bmVkCiAgICAvLyAgIFJldmVhbCAtPiBPcGVuIChpZiBub2JvZHkgYmlkKQogICAgLy8gICBPd25lZCAtPiBPcGVuIChyZWxlYXNlRGVlZCBvciBpbnZhbGlkYXRlTmFtZSkKICAgIGZ1bmN0aW9uIHN0YXRlKGJ5dGVzMzIgX2hhc2gpIGNvbnN0YW50IHJldHVybnMgKE1vZGUpIHsKICAgICAgICB2YXIgZW50cnkgPSBfZW50cmllc1tfaGFzaF07CiAgICAgICAgCiAgICAgICAgaWYoIWlzQWxsb3dlZChfaGFzaCwgbm93KSkgewogICAgICAgICAgICByZXR1cm4gTW9kZS5Ob3RZZXRBdmFpbGFibGU7CiAgICAgICAgfSBlbHNlIGlmKG5vdyA8IGVudHJ5LnJlZ2lzdHJhdGlvbkRhdGUpIHsKICAgICAgICAgICAgaWYgKG5vdyA8IGVudHJ5LnJlZ2lzdHJhdGlvbkRhdGUgLSByZXZlYWxQZXJpb2QpIHsKICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLkF1Y3Rpb247CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTW9kZS5SZXZlYWw7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZihlbnRyeS5oaWdoZXN0QmlkID09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBNb2RlLk9wZW47CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTW9kZS5Pd25lZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBtb2RpZmllciBpblN0YXRlKGJ5dGVzMzIgX2hhc2gsIE1vZGUgX3N0YXRlKSB7CiAgICAgICAgaWYoc3RhdGUoX2hhc2gpICE9IF9zdGF0ZSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoYnl0ZXMzMiBfaGFzaCkgewogICAgICAgIGlmIChzdGF0ZShfaGFzaCkgIT0gTW9kZS5Pd25lZCB8fCBtc2cuc2VuZGVyICE9IF9lbnRyaWVzW19oYXNoXS5kZWVkLm93bmVyKCkpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcmVnaXN0cnlPcGVuKCkgewogICAgICAgIGlmKG5vdyA8IHJlZ2lzdHJ5U3RhcnRlZCAgfHwgbm93ID4gcmVnaXN0cnlTdGFydGVkICsgNCB5ZWFycyB8fCBlbnMub3duZXIocm9vdE5vZGUpICE9IGFkZHJlc3ModGhpcykpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gZW50cmllcyhieXRlczMyIF9oYXNoKSBjb25zdGFudCByZXR1cm5zIChNb2RlLCBhZGRyZXNzLCB1aW50LCB1aW50LCB1aW50KSB7CiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsKICAgICAgICByZXR1cm4gKHN0YXRlKF9oYXNoKSwgaC5kZWVkLCBoLnJlZ2lzdHJhdGlvbkRhdGUsIGgudmFsdWUsIGguaGlnaGVzdEJpZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENvbnN0cnVjdHMgYSBuZXcgUmVnaXN0cmFyLCB3aXRoIHRoZSBwcm92aWRlZCBhZGRyZXNzIGFzIHRoZSBvd25lciBvZiB0aGUgcm9vdCBub2RlLgogICAgICogQHBhcmFtIF9lbnMgVGhlIGFkZHJlc3Mgb2YgdGhlIEVOUwogICAgICogQHBhcmFtIF9yb290Tm9kZSBUaGUgaGFzaCBvZiB0aGUgcm9vdG5vZGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIFJlZ2lzdHJhcihBYnN0cmFjdEVOUyBfZW5zLCBieXRlczMyIF9yb290Tm9kZSwgdWludCBfc3RhcnREYXRlKSB7CiAgICAgICAgZW5zID0gX2VuczsKICAgICAgICByb290Tm9kZSA9IF9yb290Tm9kZTsKICAgICAgICByZWdpc3RyeVN0YXJ0ZWQgPSBfc3RhcnREYXRlID4gMCA/IF9zdGFydERhdGUgOiBub3c7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIG1heGltdW0gb2YgdHdvIHVuc2lnbmVkIGludGVnZXJzCiAgICAgKiBAcGFyYW0gYSBBIG51bWJlciB0byBjb21wYXJlCiAgICAgKiBAcGFyYW0gYiBBIG51bWJlciB0byBjb21wYXJlCiAgICAgKiBAcmV0dXJuIFRoZSBtYXhpbXVtIG9mIHR3byB1bnNpZ25lZCBpbnRlZ2VycwogICAgICovCiAgICBmdW5jdGlvbiBtYXgodWludCBhLCB1aW50IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgbWF4KSB7CiAgICAgICAgaWYgKGEgPiBiKQogICAgICAgICAgICByZXR1cm4gYTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBiOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBtaW5pbXVtIG9mIHR3byB1bnNpZ25lZCBpbnRlZ2VycwogICAgICogQHBhcmFtIGEgQSBudW1iZXIgdG8gY29tcGFyZQogICAgICogQHBhcmFtIGIgQSBudW1iZXIgdG8gY29tcGFyZQogICAgICogQHJldHVybiBUaGUgbWluaW11bSBvZiB0d28gdW5zaWduZWQgaW50ZWdlcnMKICAgICAqLwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IG1pbikgewogICAgICAgIGlmIChhIDwgYikKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gYjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIG9mIGEgZ2l2ZW4gc3RyaW5nCiAgICAgKiBAcGFyYW0gcyBUaGUgc3RyaW5nIHRvIG1lYXN1cmUgdGhlIGxlbmd0aCBvZgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBpbnB1dCBzdHJpbmcKICAgICAqLwogICAgZnVuY3Rpb24gc3RybGVuKHN0cmluZyBzKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gU3RhcnRpbmcgaGVyZSBtZWFucyB0aGUgTFNCIHdpbGwgYmUgdGhlIGJ5dGUgd2UgY2FyZSBhYm91dAogICAgICAgIHVpbnQgcHRyOwogICAgICAgIHVpbnQgZW5kOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcHRyIDo9IGFkZChzLCAxKQogICAgICAgICAgICBlbmQgOj0gYWRkKG1sb2FkKHMpLCBwdHIpCiAgICAgICAgfQogICAgICAgIGZvciAodWludCBsZW4gPSAwOyBwdHIgPCBlbmQ7IGxlbisrKSB7CiAgICAgICAgICAgIHVpbnQ4IGI7CiAgICAgICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQocHRyKSwgMHhGRikgfQogICAgICAgICAgICBpZiAoYiA8IDB4ODApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAxOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RTApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAyOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgICAgIHB0ciArPSAzOwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjgpIHsKICAgICAgICAgICAgICAgIHB0ciArPSA0OwogICAgICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RkMpIHsKICAgICAgICAgICAgICAgIHB0ciArPSA1OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHRyICs9IDY7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxlbjsKICAgIH0KICAgIAogICAgLyoqIAogICAgICogQGRldiBEZXRlcm1pbmVzIGlmIGEgbmFtZSBpcyBhdmFpbGFibGUgZm9yIHJlZ2lzdHJhdGlvbiB5ZXQKICAgICAqIAogICAgICogRWFjaCBuYW1lIHdpbGwgYmUgYXNzaWduZWQgYSByYW5kb20gZGF0ZSBpbiB3aGljaCBpdHMgYXVjdGlvbiAKICAgICAqIGNhbiBiZSBzdGFydGVkLCBmcm9tIDAgdG8gMTMgd2Vla3MKICAgICAqIAogICAgICogQHBhcmFtIF9oYXNoIFRoZSBoYXNoIHRvIHN0YXJ0IGFuIGF1Y3Rpb24gb24KICAgICAqIEBwYXJhbSBfdGltZXN0YW1wIFRoZSB0aW1lc3RhbXAgdG8gcXVlcnkgYWJvdXQKICAgICAqLwogICAgIAogICAgZnVuY3Rpb24gaXNBbGxvd2VkKGJ5dGVzMzIgX2hhc2gsIHVpbnQgX3RpbWVzdGFtcCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBhbGxvd2VkKXsKICAgICAgICByZXR1cm4gX3RpbWVzdGFtcCA+IGdldEFsbG93ZWRUaW1lKF9oYXNoKTsKICAgIH0KCiAgICAvKiogCiAgICAgKiBAZGV2IFJldHVybnMgYXZhaWxhYmxlIGRhdGUgZm9yIGhhc2gKICAgICAqIAogICAgICogQHBhcmFtIF9oYXNoIFRoZSBoYXNoIHRvIHN0YXJ0IGFuIGF1Y3Rpb24gb24KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0QWxsb3dlZFRpbWUoYnl0ZXMzMiBfaGFzaCkgY29uc3RhbnQgcmV0dXJucyAodWludCB0aW1lc3RhbXApIHsKICAgICAgICByZXR1cm4gcmVnaXN0cnlTdGFydGVkICsgKGxhdW5jaExlbmd0aCoodWludChfaGFzaCk+PjEyOCk+PjEyOCk7CiAgICAgICAgLy8gcmlnaHQgc2hpZnQgb3BlcmF0b3I6IGEgPj4gYiA9PSBhIC8gMioqYgogICAgfQogICAgLyoqCiAgICAgKiBAZGV2IEFzc2lnbiB0aGUgb3duZXIgaW4gRU5TLCBpZiB3ZSdyZSBzdGlsbCB0aGUgcmVnaXN0cmFyCiAgICAgKiBAcGFyYW0gX2hhc2ggaGFzaCB0byBjaGFuZ2Ugb3duZXIKICAgICAqIEBwYXJhbSBfbmV3T3duZXIgbmV3IG93bmVyIHRvIHRyYW5zZmVyIHRvCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyeVNldFN1Ym5vZGVPd25lcihieXRlczMyIF9oYXNoLCBhZGRyZXNzIF9uZXdPd25lcikgaW50ZXJuYWwgewogICAgICAgIGlmKGVucy5vd25lcihyb290Tm9kZSkgPT0gYWRkcmVzcyh0aGlzKSkKICAgICAgICAgICAgZW5zLnNldFN1Ym5vZGVPd25lcihyb290Tm9kZSwgX2hhc2gsIF9uZXdPd25lcik7ICAgICAgICAKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU3RhcnQgYW4gYXVjdGlvbiBmb3IgYW4gYXZhaWxhYmxlIGhhc2gKICAgICAqCiAgICAgKiBBbnlvbmUgY2FuIHN0YXJ0IGFuIGF1Y3Rpb24gYnkgc2VuZGluZyBhbiBhcnJheSBvZiBoYXNoZXMgdGhhdCB0aGV5IHdhbnQgdG8gYmlkIGZvci4KICAgICAqIEFycmF5cyBhcmUgc2VudCBzbyB0aGF0IHNvbWVvbmUgY2FuIG9wZW4gdXAgYW4gYXVjdGlvbiBmb3IgWCBkdW1teSBoYXNoZXMgd2hlbiB0aGV5CiAgICAgKiBhcmUgb25seSByZWFsbHkgaW50ZXJlc3RlZCBpbiBiaWRkaW5nIGZvciBvbmUuIFRoaXMgd2lsbCBpbmNyZWFzZSB0aGUgY29zdCBmb3IgYW4KICAgICAqIGF0dGFja2VyIHRvIHNpbXBseSBiaWQgYmxpbmRseSBvbiBhbGwgbmV3IGF1Y3Rpb25zLiBEdW1teSBhdWN0aW9ucyB0aGF0IGFyZQogICAgICogb3BlbiBidXQgbm90IGJpZCBvbiBhcmUgY2xvc2VkIGFmdGVyIGEgd2Vlay4KICAgICAqCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIGhhc2ggdG8gc3RhcnQgYW4gYXVjdGlvbiBvbgogICAgICovCiAgICBmdW5jdGlvbiBzdGFydEF1Y3Rpb24oYnl0ZXMzMiBfaGFzaCkgcmVnaXN0cnlPcGVuKCkgewogICAgICAgIHZhciBtb2RlID0gc3RhdGUoX2hhc2gpOwogICAgICAgIGlmKG1vZGUgPT0gTW9kZS5BdWN0aW9uKSByZXR1cm47CiAgICAgICAgaWYobW9kZSAhPSBNb2RlLk9wZW4pIHRocm93OwoKICAgICAgICBlbnRyeSBuZXdBdWN0aW9uID0gX2VudHJpZXNbX2hhc2hdOwogICAgICAgIG5ld0F1Y3Rpb24ucmVnaXN0cmF0aW9uRGF0ZSA9IG5vdyArIHRvdGFsQXVjdGlvbkxlbmd0aDsKICAgICAgICBuZXdBdWN0aW9uLnZhbHVlID0gMDsKICAgICAgICBuZXdBdWN0aW9uLmhpZ2hlc3RCaWQgPSAwOwogICAgICAgIEF1Y3Rpb25TdGFydGVkKF9oYXNoLCBuZXdBdWN0aW9uLnJlZ2lzdHJhdGlvbkRhdGUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTdGFydCBtdWx0aXBsZSBhdWN0aW9ucyBmb3IgYmV0dGVyIGFub255bWl0eQogICAgICogQHBhcmFtIF9oYXNoZXMgQW4gYXJyYXkgb2YgaGFzaGVzLCBhdCBsZWFzdCBvbmUgb2Ygd2hpY2ggeW91IHByZXN1bWFibHkgd2FudCB0byBiaWQgb24KICAgICAqLwogICAgZnVuY3Rpb24gc3RhcnRBdWN0aW9ucyhieXRlczMyW10gX2hhc2hlcykgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfaGFzaGVzLmxlbmd0aDsgaSArKyApIHsKICAgICAgICAgICAgc3RhcnRBdWN0aW9uKF9oYXNoZXNbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSGFzaCB0aGUgdmFsdWVzIHJlcXVpcmVkIGZvciBhIHNlY3JldCBiaWQKICAgICAqIEBwYXJhbSBoYXNoIFRoZSBub2RlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGRlc2lyZWQgbmFtZWhhc2gKICAgICAqIEBwYXJhbSB2YWx1ZSBUaGUgYmlkIGFtb3VudAogICAgICogQHBhcmFtIHNhbHQgQSByYW5kb20gdmFsdWUgdG8gZW5zdXJlIHNlY3JlY3kgb2YgdGhlIGJpZAogICAgICogQHJldHVybiBUaGUgaGFzaCBvZiB0aGUgYmlkIHZhbHVlcwogICAgICovCiAgICBmdW5jdGlvbiBzaGFCaWQoYnl0ZXMzMiBoYXNoLCBhZGRyZXNzIG93bmVyLCB1aW50IHZhbHVlLCBieXRlczMyIHNhbHQpIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIgc2VhbGVkQmlkKSB7CiAgICAgICAgcmV0dXJuIHNoYTMoaGFzaCwgb3duZXIsIHZhbHVlLCBzYWx0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU3VibWl0IGEgbmV3IHNlYWxlZCBiaWQgb24gYSBkZXNpcmVkIGhhc2ggaW4gYSBibGluZCBhdWN0aW9uCiAgICAgKgogICAgICogQmlkcyBhcmUgc2VudCBieSBzZW5kaW5nIGEgbWVzc2FnZSB0byB0aGUgbWFpbiBjb250cmFjdCB3aXRoIGEgaGFzaCBhbmQgYW4gYW1vdW50LiBUaGUgaGFzaAogICAgICogY29udGFpbnMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGJpZCwgaW5jbHVkaW5nIHRoZSBiaWRkZWQgaGFzaCwgdGhlIGJpZCBhbW91bnQsIGFuZCBhIHJhbmRvbQogICAgICogc2FsdC4gQmlkcyBhcmUgbm90IHRpZWQgdG8gYW55IG9uZSBhdWN0aW9uIHVudGlsIHRoZXkgYXJlIHJldmVhbGVkLiBUaGUgdmFsdWUgb2YgdGhlIGJpZAogICAgICogaXRzZWxmIGNhbiBiZSBtYXNxdWVyYWRlZCBieSBzZW5kaW5nIG1vcmUgdGhhbiB0aGUgdmFsdWUgb2YgeW91ciBhY3R1YWwgYmlkLiBUaGlzIGlzCiAgICAgKiBmb2xsb3dlZCBieSBhIDQ4aCByZXZlYWwgcGVyaW9kLiBCaWRzIHJldmVhbGVkIGFmdGVyIHRoaXMgcGVyaW9kIHdpbGwgYmUgYnVybmVkIGFuZCB0aGUgZXRoZXIgdW5yZWNvdmVyYWJsZS4KICAgICAqIFNpbmNlIHRoaXMgaXMgYW4gYXVjdGlvbiwgaXQgaXMgZXhwZWN0ZWQgdGhhdCBtb3N0IHB1YmxpYyBoYXNoZXMsIGxpa2Uga25vd24gZG9tYWlucyBhbmQgY29tbW9uIGRpY3Rpb25hcnkKICAgICAqIHdvcmRzLCB3aWxsIGhhdmUgbXVsdGlwbGUgYmlkZGVycyBwdXNoaW5nIHRoZSBwcmljZSB1cC4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VhbGVkQmlkIEEgc2VhbGVkQmlkLCBjcmVhdGVkIGJ5IHRoZSBzaGFCaWQgZnVuY3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24gbmV3QmlkKGJ5dGVzMzIgc2VhbGVkQmlkKSBwYXlhYmxlIHsKICAgICAgICBpZiAoYWRkcmVzcyhzZWFsZWRCaWRzW21zZy5zZW5kZXJdW3NlYWxlZEJpZF0pID4gMCApIHRocm93OwogICAgICAgIGlmIChtc2cudmFsdWUgPCBtaW5QcmljZSkgdGhyb3c7CiAgICAgICAgLy8gY3JlYXRlcyBhIG5ldyBoYXNoIGNvbnRyYWN0IHdpdGggdGhlIG93bmVyCiAgICAgICAgRGVlZCBuZXdCaWQgPSAobmV3IERlZWQpLnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcik7CiAgICAgICAgc2VhbGVkQmlkc1ttc2cuc2VuZGVyXVtzZWFsZWRCaWRdID0gbmV3QmlkOwogICAgICAgIE5ld0JpZChzZWFsZWRCaWQsIG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFN0YXJ0IGEgc2V0IG9mIGF1Y3Rpb25zIGFuZCBiaWQgb24gb25lIG9mIHRoZW0KICAgICAqCiAgICAgKiBUaGlzIG1ldGhvZCBmdW5jdGlvbnMgaWRlbnRpY2FsbHkgdG8gY2FsbGluZyBgc3RhcnRBdWN0aW9uc2AgZm9sbG93ZWQgYnkgYG5ld0JpZGAsCiAgICAgKiBidXQgYWxsIGluIG9uZSB0cmFuc2FjdGlvbi4KICAgICAqIEBwYXJhbSBoYXNoZXMgQSBsaXN0IG9mIGhhc2hlcyB0byBzdGFydCBhdWN0aW9ucyBvbi4KICAgICAqIEBwYXJhbSBzZWFsZWRCaWQgQSBzZWFsZWQgYmlkIGZvciBvbmUgb2YgdGhlIGF1Y3Rpb25zLgogICAgICovCiAgICBmdW5jdGlvbiBzdGFydEF1Y3Rpb25zQW5kQmlkKGJ5dGVzMzJbXSBoYXNoZXMsIGJ5dGVzMzIgc2VhbGVkQmlkKSBwYXlhYmxlIHsKICAgICAgICBzdGFydEF1Y3Rpb25zKGhhc2hlcyk7CiAgICAgICAgbmV3QmlkKHNlYWxlZEJpZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFN1Ym1pdCB0aGUgcHJvcGVydGllcyBvZiBhIGJpZCB0byByZXZlYWwgdGhlbQogICAgICogQHBhcmFtIF9oYXNoIFRoZSBub2RlIGluIHRoZSBzZWFsZWRCaWQKICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGJpZCBhbW91bnQgaW4gdGhlIHNlYWxlZEJpZAogICAgICogQHBhcmFtIF9zYWx0IFRoZSBzYWxlIGluIHRoZSBzZWFsZWRCaWQKICAgICAqLwogICAgZnVuY3Rpb24gdW5zZWFsQmlkKGJ5dGVzMzIgX2hhc2gsIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zYWx0KSB7CiAgICAgICAgYnl0ZXMzMiBzZWFsID0gc2hhQmlkKF9oYXNoLCBtc2cuc2VuZGVyLCBfdmFsdWUsIF9zYWx0KTsKICAgICAgICBEZWVkIGJpZCA9IHNlYWxlZEJpZHNbbXNnLnNlbmRlcl1bc2VhbF07CiAgICAgICAgaWYgKGFkZHJlc3MoYmlkKSA9PSAwICkgdGhyb3c7CiAgICAgICAgc2VhbGVkQmlkc1ttc2cuc2VuZGVyXVtzZWFsXSA9IERlZWQoMCk7CiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsKICAgICAgICB1aW50IHZhbHVlID0gbWluKF92YWx1ZSwgYmlkLnZhbHVlKCkpOwogICAgICAgIGJpZC5zZXRCYWxhbmNlKHZhbHVlLCB0cnVlKTsKCiAgICAgICAgdmFyIGF1Y3Rpb25TdGF0ZSA9IHN0YXRlKF9oYXNoKTsKICAgICAgICBpZihhdWN0aW9uU3RhdGUgPT0gTW9kZS5Pd25lZCkgewogICAgICAgICAgICAvLyBUb28gbGF0ZSEgQmlkZGVyIGxvc2VzIHRoZWlyIGJpZC4gR2V0J3MgMC41JSBiYWNrLgogICAgICAgICAgICBiaWQuY2xvc2VEZWVkKDUpOwogICAgICAgICAgICBCaWRSZXZlYWxlZChfaGFzaCwgbXNnLnNlbmRlciwgdmFsdWUsIDEpOwogICAgICAgIH0gZWxzZSBpZihhdWN0aW9uU3RhdGUgIT0gTW9kZS5SZXZlYWwpIHsKICAgICAgICAgICAgLy8gSW52YWxpZCBwaGFzZQogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIDwgbWluUHJpY2UgfHwgYmlkLmNyZWF0aW9uRGF0ZSgpID4gaC5yZWdpc3RyYXRpb25EYXRlIC0gcmV2ZWFsUGVyaW9kKSB7CiAgICAgICAgICAgIC8vIEJpZCB0b28gbG93IG9yIHRvbyBsYXRlLCByZWZ1bmQgOTkuNSUKICAgICAgICAgICAgYmlkLmNsb3NlRGVlZCg5OTUpOwogICAgICAgICAgICBCaWRSZXZlYWxlZChfaGFzaCwgbXNnLnNlbmRlciwgdmFsdWUsIDApOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPiBoLmhpZ2hlc3RCaWQpIHsKICAgICAgICAgICAgLy8gbmV3IHdpbm5lcgogICAgICAgICAgICAvLyBjYW5jZWwgdGhlIG90aGVyIGJpZCwgcmVmdW5kIDk5LjUlCiAgICAgICAgICAgIGlmKGFkZHJlc3MoaC5kZWVkKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBEZWVkIHByZXZpb3VzV2lubmVyID0gaC5kZWVkOwogICAgICAgICAgICAgICAgcHJldmlvdXNXaW5uZXIuY2xvc2VEZWVkKDk5NSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHNldCBuZXcgd2lubmVyCiAgICAgICAgICAgIC8vIHBlciB0aGUgcnVsZXMgb2YgYSB2aWNrZXJ5IGF1Y3Rpb24sIHRoZSB2YWx1ZSBiZWNvbWVzIHRoZSBwcmV2aW91cyBoaWdoZXN0QmlkCiAgICAgICAgICAgIGgudmFsdWUgPSBoLmhpZ2hlc3RCaWQ7ICAvLyB3aWxsIGJlIHplcm8gaWYgdGhlcmUncyBvbmx5IDEgYmlkZGVyCiAgICAgICAgICAgIGguaGlnaGVzdEJpZCA9IHZhbHVlOwogICAgICAgICAgICBoLmRlZWQgPSBiaWQ7CiAgICAgICAgICAgIEJpZFJldmVhbGVkKF9oYXNoLCBtc2cuc2VuZGVyLCB2YWx1ZSwgMik7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+IGgudmFsdWUpIHsKICAgICAgICAgICAgLy8gbm90IHdpbm5lciwgYnV0IGFmZmVjdHMgc2Vjb25kIHBsYWNlCiAgICAgICAgICAgIGgudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgYmlkLmNsb3NlRGVlZCg5OTUpOwogICAgICAgICAgICBCaWRSZXZlYWxlZChfaGFzaCwgbXNnLnNlbmRlciwgdmFsdWUsIDMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGJpZCBkb2Vzbid0IGFmZmVjdCBhdWN0aW9uCiAgICAgICAgICAgIGJpZC5jbG9zZURlZWQoOTk1KTsKICAgICAgICAgICAgQmlkUmV2ZWFsZWQoX2hhc2gsIG1zZy5zZW5kZXIsIHZhbHVlLCA0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbmNlbCBhIGJpZAogICAgICogQHBhcmFtIHNlYWwgVGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoZSBzaGFCaWQgZnVuY3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24gY2FuY2VsQmlkKGFkZHJlc3MgYmlkZGVyLCBieXRlczMyIHNlYWwpIHsKICAgICAgICBEZWVkIGJpZCA9IHNlYWxlZEJpZHNbYmlkZGVyXVtzZWFsXTsKICAgICAgICAKICAgICAgICAvLyBJZiBhIHNvbGUgYmlkZGVyIGRvZXMgbm90IGB1bnNlYWxCaWRgIGluIHRpbWUsIHRoZXkgaGF2ZSBhIGZldyBtb3JlIGRheXMKICAgICAgICAvLyB3aGVyZSB0aGV5IGNhbiBjYWxsIGBzdGFydEF1Y3Rpb25gIChhZ2FpbikgYW5kIHRoZW4gYHVuc2VhbEJpZGAgZHVyaW5nCiAgICAgICAgLy8gdGhlIHJldmVhbFBlcmlvZCB0byBnZXQgYmFjayB0aGVpciBiaWQgdmFsdWUuCiAgICAgICAgLy8gRm9yIHNpbXBsaWNpdHksIHRoZXkgc2hvdWxkIGNhbGwgYHN0YXJ0QXVjdGlvbmAgd2l0aGluCiAgICAgICAgLy8gOSBkYXlzICgyIHdlZWtzIC0gdG90YWxBdWN0aW9uTGVuZ3RoKSwgb3RoZXJ3aXNlIHRoZWlyIGJpZCB3aWxsIGJlCiAgICAgICAgLy8gY2FuY2VsbGFibGUgYnkgYW55b25lLgogICAgICAgIGlmIChhZGRyZXNzKGJpZCkgPT0gMAogICAgICAgICAgICB8fCBub3cgPCBiaWQuY3JlYXRpb25EYXRlKCkgKyB0b3RhbEF1Y3Rpb25MZW5ndGggKyAyIHdlZWtzKSB0aHJvdzsKCiAgICAgICAgLy8gU2VuZCB0aGUgY2FuY2VsbGVyIDAuNSUgb2YgdGhlIGJpZCwgYW5kIGJ1cm4gdGhlIHJlc3QuCiAgICAgICAgYmlkLnNldE93bmVyKG1zZy5zZW5kZXIpOwogICAgICAgIGJpZC5jbG9zZURlZWQoNSk7CiAgICAgICAgc2VhbGVkQmlkc1tiaWRkZXJdW3NlYWxdID0gRGVlZCgwKTsKICAgICAgICBCaWRSZXZlYWxlZChzZWFsLCBiaWRkZXIsIDAsIDUpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGaW5hbGl6ZSBhbiBhdWN0aW9uIGFmdGVyIHRoZSByZWdpc3RyYXRpb24gZGF0ZSBoYXMgcGFzc2VkCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIGhhc2ggb2YgdGhlIG5hbWUgdGhlIGF1Y3Rpb24gaXMgZm9yCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmFsaXplQXVjdGlvbihieXRlczMyIF9oYXNoKSBvbmx5T3duZXIoX2hhc2gpIHsKICAgICAgICBlbnRyeSBoID0gX2VudHJpZXNbX2hhc2hdOwogICAgICAgIAogICAgICAgIC8vIGhhbmRsZXMgdGhlIGNhc2Ugd2hlbiB0aGVyZSdzIG9ubHkgYSBzaW5nbGUgYmlkZGVyIChoLnZhbHVlIGlzIHplcm8pCiAgICAgICAgaC52YWx1ZSA9ICBtYXgoaC52YWx1ZSwgbWluUHJpY2UpOwogICAgICAgIGguZGVlZC5zZXRCYWxhbmNlKGgudmFsdWUsIHRydWUpOwoKICAgICAgICB0cnlTZXRTdWJub2RlT3duZXIoX2hhc2gsIGguZGVlZC5vd25lcigpKTsKICAgICAgICBIYXNoUmVnaXN0ZXJlZChfaGFzaCwgaC5kZWVkLm93bmVyKCksIGgudmFsdWUsIGgucmVnaXN0cmF0aW9uRGF0ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBvd25lciBvZiBhIGRvbWFpbiBtYXkgdHJhbnNmZXIgaXQgdG8gc29tZW9uZSBlbHNlIGF0IGFueSB0aW1lLgogICAgICogQHBhcmFtIF9oYXNoIFRoZSBub2RlIHRvIHRyYW5zZmVyCiAgICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGJ5dGVzMzIgX2hhc2gsIGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lcihfaGFzaCkgewogICAgICAgIGlmIChuZXdPd25lciA9PSAwKSB0aHJvdzsKCiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsKICAgICAgICBoLmRlZWQuc2V0T3duZXIobmV3T3duZXIpOwogICAgICAgIHRyeVNldFN1Ym5vZGVPd25lcihfaGFzaCwgbmV3T3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBZnRlciBzb21lIHRpbWUsIG9yIGlmIHdlJ3JlIG5vIGxvbmdlciB0aGUgcmVnaXN0cmFyLCB0aGUgb3duZXIgY2FuIHJlbGVhc2UKICAgICAqICAgICAgdGhlIG5hbWUgYW5kIGdldCB0aGVpciBldGhlciBiYWNrLgogICAgICogQHBhcmFtIF9oYXNoIFRoZSBub2RlIHRvIHJlbGVhc2UKICAgICAqLwogICAgZnVuY3Rpb24gcmVsZWFzZURlZWQoYnl0ZXMzMiBfaGFzaCkgb25seU93bmVyKF9oYXNoKSB7CiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW19oYXNoXTsKICAgICAgICBEZWVkIGRlZWRDb250cmFjdCA9IGguZGVlZDsKICAgICAgICBpZihub3cgPCBoLnJlZ2lzdHJhdGlvbkRhdGUgKyAxIHllYXJzICYmIGVucy5vd25lcihyb290Tm9kZSkgPT0gYWRkcmVzcyh0aGlzKSkgdGhyb3c7CgogICAgICAgIGgudmFsdWUgPSAwOwogICAgICAgIGguaGlnaGVzdEJpZCA9IDA7CiAgICAgICAgaC5kZWVkID0gRGVlZCgwKTsKCiAgICAgICAgX3RyeUVyYXNlU2luZ2xlTm9kZShfaGFzaCk7CiAgICAgICAgZGVlZENvbnRyYWN0LmNsb3NlRGVlZCgxMDAwKTsKICAgICAgICBIYXNoUmVsZWFzZWQoX2hhc2gsIGgudmFsdWUpOyAgICAgICAgCiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFN1Ym1pdCBhIG5hbWUgNiBjaGFyYWN0ZXJzIGxvbmcgb3IgbGVzcy4gSWYgaXQgaGFzIGJlZW4gcmVnaXN0ZXJlZCwKICAgICAqIHRoZSBzdWJtaXR0ZXIgd2lsbCBlYXJuIDUwJSBvZiB0aGUgZGVlZCB2YWx1ZS4gV2UgYXJlIHB1cnBvc2VmdWxseQogICAgICogaGFuZGljYXBwaW5nIHRoZSBzaW1wbGlmaWVkIHJlZ2lzdHJhciBhcyBhIHdheSB0byBmb3JjZSBpdCBpbnRvIGJlaW5nIHJlc3RydWN0dXJlZAogICAgICogaW4gYSBmZXcgeWVhcnMuCiAgICAgKiBAcGFyYW0gdW5oYXNoZWROYW1lIEFuIGludmFsaWQgbmFtZSB0byBzZWFyY2ggZm9yIGluIHRoZSByZWdpc3RyeS4KICAgICAqCiAgICAgKi8KICAgIGZ1bmN0aW9uIGludmFsaWRhdGVOYW1lKHN0cmluZyB1bmhhc2hlZE5hbWUpIGluU3RhdGUoc2hhMyh1bmhhc2hlZE5hbWUpLCBNb2RlLk93bmVkKSB7CiAgICAgICAgaWYgKHN0cmxlbih1bmhhc2hlZE5hbWUpID4gNiApIHRocm93OwogICAgICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTModW5oYXNoZWROYW1lKTsKCiAgICAgICAgZW50cnkgaCA9IF9lbnRyaWVzW2hhc2hdOwoKICAgICAgICBfdHJ5RXJhc2VTaW5nbGVOb2RlKGhhc2gpOwoKICAgICAgICBpZihhZGRyZXNzKGguZGVlZCkgIT0gMCkgewogICAgICAgICAgICAvLyBSZXdhcmQgdGhlIGRpc2NvdmVyZXIgd2l0aCA1MCUgb2YgdGhlIGRlZWQKICAgICAgICAgICAgLy8gVGhlIHByZXZpb3VzIG93bmVyIGdldHMgNTAlCiAgICAgICAgICAgIGgudmFsdWUgPSBtYXgoaC52YWx1ZSwgbWluUHJpY2UpOwogICAgICAgICAgICBoLmRlZWQuc2V0QmFsYW5jZShoLnZhbHVlLzIsIGZhbHNlKTsKICAgICAgICAgICAgaC5kZWVkLnNldE93bmVyKG1zZy5zZW5kZXIpOwogICAgICAgICAgICBoLmRlZWQuY2xvc2VEZWVkKDEwMDApOwogICAgICAgIH0KCiAgICAgICAgSGFzaEludmFsaWRhdGVkKGhhc2gsIHVuaGFzaGVkTmFtZSwgaC52YWx1ZSwgaC5yZWdpc3RyYXRpb25EYXRlKTsKCiAgICAgICAgaC52YWx1ZSA9IDA7CiAgICAgICAgaC5oaWdoZXN0QmlkID0gMDsKICAgICAgICBoLmRlZWQgPSBEZWVkKDApOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbGxvd3MgYW55b25lIHRvIGRlbGV0ZSB0aGUgb3duZXIgYW5kIHJlc29sdmVyIHJlY29yZHMgZm9yIGEgKHN1YmRvbWFpbiBvZikgYQogICAgICogICAgICBuYW1lIHRoYXQgaXMgbm90IGN1cnJlbnRseSBvd25lZCBpbiB0aGUgcmVnaXN0cmFyLiBJZiBwYXNzaW5nLCBlZywgJ2Zvby5iYXIuZXRoJywKICAgICAqICAgICAgdGhlIG93bmVyIGFuZCByZXNvbHZlciBmaWVsZHMgb24gJ2Zvby5iYXIuZXRoJyBhbmQgJ2Jhci5ldGgnIHdpbGwgYWxsIGJlIGNsZWFyZWQuCiAgICAgKiBAcGFyYW0gbGFiZWxzIEEgc2VyaWVzIG9mIGxhYmVsIGhhc2hlcyBpZGVudGlmeWluZyB0aGUgbmFtZSB0byB6ZXJvIG91dCwgcm9vdGVkIGF0IHRoZQogICAgICogICAgICAgIHJlZ2lzdHJhcidzIHJvb3QuIE11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgZWxlbWVudC4gRm9yIGluc3RhbmNlLCB0byB6ZXJvIAogICAgICogICAgICAgICdmb28uYmFyLmV0aCcgb24gYSByZWdpc3RyYXIgdGhhdCBvd25zICcuZXRoJywgcGFzcyBhbiBhcnJheSBjb250YWluaW5nCiAgICAgKiAgICAgICAgW3NoYTMoJ2ZvbycpLCBzaGEzKCdiYXInKV0uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVyYXNlTm9kZShieXRlczMyW10gbGFiZWxzKSB7CiAgICAgICAgaWYobGFiZWxzLmxlbmd0aCA9PSAwKSB0aHJvdzsKICAgICAgICBpZihzdGF0ZShsYWJlbHNbbGFiZWxzLmxlbmd0aCAtIDFdKSA9PSBNb2RlLk93bmVkKSB0aHJvdzsKCiAgICAgICAgX2VyYXNlTm9kZUhpZXJhcmNoeShsYWJlbHMubGVuZ3RoIC0gMSwgbGFiZWxzLCByb290Tm9kZSk7CiAgICB9CgogICAgZnVuY3Rpb24gX3RyeUVyYXNlU2luZ2xlTm9kZShieXRlczMyIGxhYmVsKSBpbnRlcm5hbCB7CiAgICAgICAgaWYoZW5zLm93bmVyKHJvb3ROb2RlKSA9PSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgICAgIGVucy5zZXRTdWJub2RlT3duZXIocm9vdE5vZGUsIGxhYmVsLCBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAgICAgdmFyIG5vZGUgPSBzaGEzKHJvb3ROb2RlLCBsYWJlbCk7CiAgICAgICAgICAgIGVucy5zZXRSZXNvbHZlcihub2RlLCAwKTsKICAgICAgICAgICAgZW5zLnNldE93bmVyKG5vZGUsIDApOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfZXJhc2VOb2RlSGllcmFyY2h5KHVpbnQgaWR4LCBieXRlczMyW10gbGFiZWxzLCBieXRlczMyIG5vZGUpIGludGVybmFsIHsKICAgICAgICAvLyBUYWtlIG93bmVyc2hpcCBvZiB0aGUgbm9kZQogICAgICAgIGVucy5zZXRTdWJub2RlT3duZXIobm9kZSwgbGFiZWxzW2lkeF0sIGFkZHJlc3ModGhpcykpOwogICAgICAgIG5vZGUgPSBzaGEzKG5vZGUsIGxhYmVsc1tpZHhdKTsKICAgICAgICAKICAgICAgICAvLyBSZWN1cnNlIGlmIHRoZXJlJ3MgbW9yZSBsYWJlbHMKICAgICAgICBpZihpZHggPiAwKQogICAgICAgICAgICBfZXJhc2VOb2RlSGllcmFyY2h5KGlkeCAtIDEsIGxhYmVscywgbm9kZSk7CgogICAgICAgIC8vIEVyYXNlIHRoZSByZXNvbHZlciBhbmQgb3duZXIgcmVjb3JkcwogICAgICAgIGVucy5zZXRSZXNvbHZlcihub2RlLCAwKTsKICAgICAgICBlbnMuc2V0T3duZXIobm9kZSwgMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVycyB0aGUgZGVlZCB0byB0aGUgY3VycmVudCByZWdpc3RyYXIsIGlmIGRpZmZlcmVudCBmcm9tIHRoaXMgb25lLgogICAgICogVXNlZCBkdXJpbmcgdGhlIHVwZ3JhZGUgcHJvY2VzcyB0byBhIHBlcm1hbmVudCByZWdpc3RyYXIuCiAgICAgKiBAcGFyYW0gX2hhc2ggVGhlIG5hbWUgaGFzaCB0byB0cmFuc2Zlci4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJSZWdpc3RyYXJzKGJ5dGVzMzIgX2hhc2gpIG9ubHlPd25lcihfaGFzaCkgewogICAgICAgIHZhciByZWdpc3RyYXIgPSBlbnMub3duZXIocm9vdE5vZGUpOwogICAgICAgIGlmKHJlZ2lzdHJhciA9PSBhZGRyZXNzKHRoaXMpKQogICAgICAgICAgICB0aHJvdzsKCiAgICAgICAgLy8gTWlncmF0ZSB0aGUgZGVlZAogICAgICAgIGVudHJ5IGggPSBfZW50cmllc1tfaGFzaF07CiAgICAgICAgaC5kZWVkLnNldFJlZ2lzdHJhcihyZWdpc3RyYXIpOwoKICAgICAgICAvLyBDYWxsIHRoZSBuZXcgcmVnaXN0cmFyIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIKICAgICAgICBSZWdpc3RyYXIocmVnaXN0cmFyKS5hY2NlcHRSZWdpc3RyYXJUcmFuc2ZlcihfaGFzaCwgaC5kZWVkLCBoLnJlZ2lzdHJhdGlvbkRhdGUpOwoKICAgICAgICAvLyBaZXJvIG91dCB0aGUgZW50cnkKICAgICAgICBoLmRlZWQgPSBEZWVkKDApOwogICAgICAgIGgucmVnaXN0cmF0aW9uRGF0ZSA9IDA7CiAgICAgICAgaC52YWx1ZSA9IDA7CiAgICAgICAgaC5oaWdoZXN0QmlkID0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWNjZXB0cyBhIHRyYW5zZmVyIGZyb20gYSBwcmV2aW91cyByZWdpc3RyYXI7IHN0dWJiZWQgb3V0IGhlcmUgc2luY2UgdGhlcmUKICAgICAqICAgICAgaXMgbm8gcHJldmlvdXMgcmVnaXN0cmFyIGltcGxlbWVudGluZyB0aGlzIGludGVyZmFjZS4KICAgICAqIEBwYXJhbSBoYXNoIFRoZSBzaGEzIGhhc2ggb2YgdGhlIGxhYmVsIHRvIHRyYW5zZmVyLgogICAgICogQHBhcmFtIGRlZWQgVGhlIERlZWQgb2JqZWN0IGZvciB0aGUgbmFtZSBiZWluZyB0cmFuc2ZlcnJlZCBpbi4KICAgICAqIEBwYXJhbSByZWdpc3RyYXRpb25EYXRlIFRoZSBkYXRlIGF0IHdoaWNoIHRoZSBuYW1lIHdhcyBvcmlnaW5hbGx5IHJlZ2lzdGVyZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFjY2VwdFJlZ2lzdHJhclRyYW5zZmVyKGJ5dGVzMzIgaGFzaCwgRGVlZCBkZWVkLCB1aW50IHJlZ2lzdHJhdGlvbkRhdGUpIHt9Cgp9'.
	

]
