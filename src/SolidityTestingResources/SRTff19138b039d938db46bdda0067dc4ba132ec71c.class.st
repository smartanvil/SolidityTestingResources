Class {
	#name : #SRTff19138b039d938db46bdda0067dc4ba132ec71c,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTff19138b039d938db46bdda0067dc4ba132ec71c >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IFJlZW50cmFuY3lHdWFyZCB7CgogIC8qKgogICAqIEBkZXYgV2UgdXNlIGEgc2luZ2xlIGxvY2sgZm9yIHRoZSB3aG9sZSBjb250cmFjdC4KICAgKi8KICBib29sIHByaXZhdGUgcmVudHJhbmN5X2xvY2sgPSBmYWxzZTsKCiAgLyoqCiAgICogQGRldiBQcmV2ZW50cyBhIGNvbnRyYWN0IGZyb20gY2FsbGluZyBpdHNlbGYsIGRpcmVjdGx5IG9yIGluZGlyZWN0bHkuCiAgICogQG5vdGljZSBJZiB5b3UgbWFyayBhIGZ1bmN0aW9uIGBub25SZWVudHJhbnRgLCB5b3Ugc2hvdWxkIGFsc28KICAgKiBtYXJrIGl0IGBleHRlcm5hbGAuIENhbGxpbmcgb25lIG5vblJlZW50cmFudCBmdW5jdGlvbiBmcm9tCiAgICogYW5vdGhlciBpcyBub3Qgc3VwcG9ydGVkLiBJbnN0ZWFkLCB5b3UgY2FuIGltcGxlbWVudCBhCiAgICogYHByaXZhdGVgIGZ1bmN0aW9uIGRvaW5nIHRoZSBhY3R1YWwgd29yaywgYW5kIGEgYGV4dGVybmFsYAogICAqIHdyYXBwZXIgbWFya2VkIGFzIGBub25SZWVudHJhbnRgLgogICAqLwogIG1vZGlmaWVyIG5vblJlZW50cmFudCgpIHsKICAgIHJlcXVpcmUoIXJlbnRyYW5jeV9sb2NrKTsKICAgIHJlbnRyYW5jeV9sb2NrID0gdHJ1ZTsKICAgIF87CiAgICByZW50cmFuY3lfbG9jayA9IGZhbHNlOwogIH0KCn0KCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCmNvbnRyYWN0IENsYWltYWJsZSBpcyBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nT3duZXI7CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBwZW5kaW5nT3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seVBlbmRpbmdPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwZW5kaW5nT3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHNldCB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgcGVuZGluZ093bmVyID0gbmV3T3duZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgcGVuZGluZ093bmVyIGFkZHJlc3MgdG8gZmluYWxpemUgdGhlIHRyYW5zZmVyLgogICAqLwogIGZ1bmN0aW9uIGNsYWltT3duZXJzaGlwKCkgb25seVBlbmRpbmdPd25lciB7CiAgICBvd25lciA9IHBlbmRpbmdPd25lcjsKICAgIHBlbmRpbmdPd25lciA9IDB4MDsKICB9Cn0KCmNvbnRyYWN0IE9wZXJhdGlvbmFsIGlzIENsYWltYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvcGVyYXRvcjsKCiAgICBmdW5jdGlvbiBPcGVyYXRpb25hbChhZGRyZXNzIF9vcGVyYXRvcikgewogICAgICBvcGVyYXRvciA9IF9vcGVyYXRvcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3BlcmF0b3IoKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcGVyYXRvcik7CiAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPcGVyYXRvcihhZGRyZXNzIG5ld09wZXJhdG9yKSBvbmx5T3duZXIgewogICAgICByZXF1aXJlKG5ld09wZXJhdG9yICE9IGFkZHJlc3MoMCkpOwogICAgICBvcGVyYXRvciA9IG5ld09wZXJhdG9yOwogICAgfQoKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYmF0Y2hUcmFuc2ZlcihhZGRyZXNzW10gX3RvLCB1aW50MjU2W10gX2JvbnVzKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IF90by5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIHJlcXVpcmUodHJhbnNmZXIoX3RvW2ldLCBfYm9udXNbaV0pKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKCiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZmluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCmNvbnRyYWN0IExvY2thYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgUmVlbnRyYW5jeUd1YXJkIHsKCiAgICBzdHJ1Y3QgTG9ja2VkQmFsYW5jZSB7CiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICB1aW50MjU2IHZhbHVlOwogICAgICAgIHVpbnQyNTYgcmVsZWFzZVRpbWU7CiAgICB9CgogICAgbWFwcGluZyAodWludCA9PiBMb2NrZWRCYWxhbmNlKSBwdWJsaWMgbG9ja2VkQmFsYW5jZXM7CiAgICB1aW50IHB1YmxpYyBsb2NrZWRCYWxhbmNlQ291bnQ7CgogICAgZXZlbnQgVHJhbnNmZXJMb2NrZWRUb2tlbihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHJlbGVhc2VUaW1lKTsKICAgIGV2ZW50IFJlbGVhc2VMb2NrZWRCYWxhbmNlKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiByZWxlYXNlVGltZSk7CgogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlckxvY2tlZFRva2VuKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSwgdWludDI1NiBfcmVsZWFzZVRpbWUpIG5vblJlZW50cmFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfcmVsZWFzZVRpbWUgPiBub3cpOwogICAgICAgIHJlcXVpcmUoX3JlbGVhc2VUaW1lLnN1YigxIHllYXJzKSA8IG5vdyk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBsb2NrZWRCYWxhbmNlc1tsb2NrZWRCYWxhbmNlQ291bnRdID0gTG9ja2VkQmFsYW5jZSh7b3duZXI6IF90bywgdmFsdWU6IF92YWx1ZSwgcmVsZWFzZVRpbWU6IF9yZWxlYXNlVGltZX0pOwogICAgICAgIGxvY2tlZEJhbGFuY2VDb3VudCsrOwogICAgICAgIFRyYW5zZmVyTG9ja2VkVG9rZW4obXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIF9yZWxlYXNlVGltZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgCiAgICBmdW5jdGlvbiBsb2NrZWRCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdmFsdWUpIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsb2NrZWRCYWxhbmNlQ291bnQ7IGkrKykgewogICAgICAgICAgICBMb2NrZWRCYWxhbmNlIGxvY2tlZEJhbGFuY2UgPSBsb2NrZWRCYWxhbmNlc1tpXTsKICAgICAgICAgICAgaWYgKF9vd25lciA9PSBsb2NrZWRCYWxhbmNlLm93bmVyKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmFkZChsb2NrZWRCYWxhbmNlLnZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CgogICAgCiAgICBmdW5jdGlvbiByZWxlYXNlTG9ja2VkQmFsYW5jZSAoKSByZXR1cm5zICh1aW50MjU2IHJlbGVhc2VBbW91bnQpIHsKICAgICAgICB1aW50IGluZGV4ID0gMDsKICAgICAgICB3aGlsZSAoaW5kZXggPCBsb2NrZWRCYWxhbmNlQ291bnQpIHsKICAgICAgICAgICAgaWYgKG5vdyA+PSBsb2NrZWRCYWxhbmNlc1tpbmRleF0ucmVsZWFzZVRpbWUpIHsKICAgICAgICAgICAgICAgIHJlbGVhc2VBbW91bnQgKz0gbG9ja2VkQmFsYW5jZXNbaW5kZXhdLnZhbHVlOwogICAgICAgICAgICAgICAgdW5sb2NrQmFsYW5jZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVsZWFzZUFtb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiB1bmxvY2tCYWxhbmNlQnlJbmRleCAodWludCBpbmRleCkgaW50ZXJuYWwgewogICAgICAgIExvY2tlZEJhbGFuY2UgbG9ja2VkQmFsYW5jZSA9IGxvY2tlZEJhbGFuY2VzW2luZGV4XTsKICAgICAgICBiYWxhbmNlc1tsb2NrZWRCYWxhbmNlLm93bmVyXSA9IGJhbGFuY2VzW2xvY2tlZEJhbGFuY2Uub3duZXJdLmFkZChsb2NrZWRCYWxhbmNlLnZhbHVlKTsKICAgICAgICBSZWxlYXNlTG9ja2VkQmFsYW5jZShsb2NrZWRCYWxhbmNlLm93bmVyLCBsb2NrZWRCYWxhbmNlLnZhbHVlLCBsb2NrZWRCYWxhbmNlLnJlbGVhc2VUaW1lKTsKICAgICAgICBsb2NrZWRCYWxhbmNlc1tpbmRleF0gPSBsb2NrZWRCYWxhbmNlc1tsb2NrZWRCYWxhbmNlQ291bnQgLSAxXTsKICAgICAgICBkZWxldGUgbG9ja2VkQmFsYW5jZXNbbG9ja2VkQmFsYW5jZUNvdW50IC0gMV07CiAgICAgICAgbG9ja2VkQmFsYW5jZUNvdW50LS07CiAgICB9Cgp9CgpsaWJyYXJ5IERhdGVUaW1lIHsKICAgICAgICAvKgogICAgICAgICAqICBEYXRlIGFuZCBUaW1lIHV0aWxpdGllcyBmb3IgZXRoZXJldW0gY29udHJhY3RzCiAgICAgICAgICoKICAgICAgICAgKi8KICAgICAgICBzdHJ1Y3QgRGF0ZVRpbWUgewogICAgICAgICAgICAgICAgdWludDE2IHllYXI7CiAgICAgICAgICAgICAgICB1aW50OCBtb250aDsKICAgICAgICAgICAgICAgIHVpbnQ4IGRheTsKICAgICAgICAgICAgICAgIHVpbnQ4IGhvdXI7CiAgICAgICAgICAgICAgICB1aW50OCBtaW51dGU7CiAgICAgICAgICAgICAgICB1aW50OCBzZWNvbmQ7CiAgICAgICAgICAgICAgICB1aW50OCB3ZWVrZGF5OwogICAgICAgIH0KCiAgICAgICAgdWludCBjb25zdGFudCBEQVlfSU5fU0VDT05EUyA9IDg2NDAwOwogICAgICAgIHVpbnQgY29uc3RhbnQgWUVBUl9JTl9TRUNPTkRTID0gMzE1MzYwMDA7CiAgICAgICAgdWludCBjb25zdGFudCBMRUFQX1lFQVJfSU5fU0VDT05EUyA9IDMxNjIyNDAwOwoKICAgICAgICB1aW50IGNvbnN0YW50IEhPVVJfSU5fU0VDT05EUyA9IDM2MDA7CiAgICAgICAgdWludCBjb25zdGFudCBNSU5VVEVfSU5fU0VDT05EUyA9IDYwOwoKICAgICAgICB1aW50MTYgY29uc3RhbnQgT1JJR0lOX1lFQVIgPSAxOTcwOwoKICAgICAgICBmdW5jdGlvbiBpc0xlYXBZZWFyKHVpbnQxNiB5ZWFyKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgICAgICAgICBpZiAoeWVhciAlIDQgIT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoeWVhciAlIDEwMCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHllYXIgJSA0MDAgIT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxlYXBZZWFyc0JlZm9yZSh1aW50IHllYXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgICAgICAgIHllYXIgLT0gMTsKICAgICAgICAgICAgICAgIHJldHVybiB5ZWFyIC8gNCAtIHllYXIgLyAxMDAgKyB5ZWFyIC8gNDAwOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0RGF5c0luTW9udGgodWludDggbW9udGgsIHVpbnQxNiB5ZWFyKSBjb25zdGFudCByZXR1cm5zICh1aW50OCkgewogICAgICAgICAgICAgICAgaWYgKG1vbnRoID09IDEgfHwgbW9udGggPT0gMyB8fCBtb250aCA9PSA1IHx8IG1vbnRoID09IDcgfHwgbW9udGggPT0gOCB8fCBtb250aCA9PSAxMCB8fCBtb250aCA9PSAxMikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMzE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtb250aCA9PSA0IHx8IG1vbnRoID09IDYgfHwgbW9udGggPT0gOSB8fCBtb250aCA9PSAxMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMzA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChpc0xlYXBZZWFyKHllYXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyOTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwYXJzZVRpbWVzdGFtcCh1aW50IHRpbWVzdGFtcCkgaW50ZXJuYWwgcmV0dXJucyAoRGF0ZVRpbWUgZHQpIHsKICAgICAgICAgICAgICAgIHVpbnQgc2Vjb25kc0FjY291bnRlZEZvciA9IDA7CiAgICAgICAgICAgICAgICB1aW50IGJ1ZjsKICAgICAgICAgICAgICAgIHVpbnQ4IGk7CgogICAgICAgICAgICAgICAgLy8gWWVhcgogICAgICAgICAgICAgICAgZHQueWVhciA9IGdldFllYXIodGltZXN0YW1wKTsKICAgICAgICAgICAgICAgIGJ1ZiA9IGxlYXBZZWFyc0JlZm9yZShkdC55ZWFyKSAtIGxlYXBZZWFyc0JlZm9yZShPUklHSU5fWUVBUik7CgogICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBMRUFQX1lFQVJfSU5fU0VDT05EUyAqIGJ1ZjsKICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgKz0gWUVBUl9JTl9TRUNPTkRTICogKGR0LnllYXIgLSBPUklHSU5fWUVBUiAtIGJ1Zik7CgogICAgICAgICAgICAgICAgLy8gTW9udGgKICAgICAgICAgICAgICAgIHVpbnQgc2Vjb25kc0luTW9udGg7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IDEyOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kc0luTW9udGggPSBEQVlfSU5fU0VDT05EUyAqIGdldERheXNJbk1vbnRoKGksIGR0LnllYXIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kc0luTW9udGggKyBzZWNvbmRzQWNjb3VudGVkRm9yID4gdGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHQubW9udGggPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgKz0gc2Vjb25kc0luTW9udGg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRGF5CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IGdldERheXNJbk1vbnRoKGR0Lm1vbnRoLCBkdC55ZWFyKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChEQVlfSU5fU0VDT05EUyArIHNlY29uZHNBY2NvdW50ZWRGb3IgPiB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdC5kYXkgPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgKz0gREFZX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gSG91cgogICAgICAgICAgICAgICAgZHQuaG91ciA9IDA7Ly9nZXRIb3VyKHRpbWVzdGFtcCk7CgogICAgICAgICAgICAgICAgLy8gTWludXRlCiAgICAgICAgICAgICAgICBkdC5taW51dGUgPSAwOy8vZ2V0TWludXRlKHRpbWVzdGFtcCk7CgogICAgICAgICAgICAgICAgLy8gU2Vjb25kCiAgICAgICAgICAgICAgICBkdC5zZWNvbmQgPSAwOy8vZ2V0U2Vjb25kKHRpbWVzdGFtcCk7CgogICAgICAgICAgICAgICAgLy8gRGF5IG9mIHdlZWsuCiAgICAgICAgICAgICAgICBkdC53ZWVrZGF5ID0gMDsvL2dldFdlZWtkYXkodGltZXN0YW1wKTsKCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRZZWFyKHVpbnQgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50MTYpIHsKICAgICAgICAgICAgICAgIHVpbnQgc2Vjb25kc0FjY291bnRlZEZvciA9IDA7CiAgICAgICAgICAgICAgICB1aW50MTYgeWVhcjsKICAgICAgICAgICAgICAgIHVpbnQgbnVtTGVhcFllYXJzOwoKICAgICAgICAgICAgICAgIC8vIFllYXIKICAgICAgICAgICAgICAgIHllYXIgPSB1aW50MTYoT1JJR0lOX1lFQVIgKyB0aW1lc3RhbXAgLyBZRUFSX0lOX1NFQ09ORFMpOwogICAgICAgICAgICAgICAgbnVtTGVhcFllYXJzID0gbGVhcFllYXJzQmVmb3JlKHllYXIpIC0gbGVhcFllYXJzQmVmb3JlKE9SSUdJTl9ZRUFSKTsKCiAgICAgICAgICAgICAgICBzZWNvbmRzQWNjb3VudGVkRm9yICs9IExFQVBfWUVBUl9JTl9TRUNPTkRTICogbnVtTGVhcFllYXJzOwogICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBZRUFSX0lOX1NFQ09ORFMgKiAoeWVhciAtIE9SSUdJTl9ZRUFSIC0gbnVtTGVhcFllYXJzKTsKCiAgICAgICAgICAgICAgICB3aGlsZSAoc2Vjb25kc0FjY291bnRlZEZvciA+IHRpbWVzdGFtcCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNMZWFwWWVhcih1aW50MTYoeWVhciAtIDEpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgLT0gTEVBUF9ZRUFSX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciAtPSBZRUFSX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgeWVhciAtPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHllYXI7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRNb250aCh1aW50IHRpbWVzdGFtcCkgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZVRpbWVzdGFtcCh0aW1lc3RhbXApLm1vbnRoOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0RGF5KHVpbnQgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50OCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlVGltZXN0YW1wKHRpbWVzdGFtcCkuZGF5OwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0SG91cih1aW50IHRpbWVzdGFtcCkgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1aW50OCgodGltZXN0YW1wIC8gNjAgLyA2MCkgJSAyNCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRNaW51dGUodWludCB0aW1lc3RhbXApIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdWludDgoKHRpbWVzdGFtcCAvIDYwKSAlIDYwKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldFNlY29uZCh1aW50IHRpbWVzdGFtcCkgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1aW50OCh0aW1lc3RhbXAgJSA2MCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b1RpbWVzdGFtcCh1aW50MTYgeWVhciwgdWludDggbW9udGgsIHVpbnQ4IGRheSkgY29uc3RhbnQgcmV0dXJucyAodWludCB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b1RpbWVzdGFtcCh5ZWFyLCBtb250aCwgZGF5LCAwLCAwLCAwKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRvVGltZXN0YW1wKHVpbnQxNiB5ZWFyLCB1aW50OCBtb250aCwgdWludDggZGF5LCB1aW50OCBob3VyLCB1aW50OCBtaW51dGUsIHVpbnQ4IHNlY29uZCkgY29uc3RhbnQgcmV0dXJucyAodWludCB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgIHVpbnQxNiBpOwoKICAgICAgICAgICAgICAgIC8vIFllYXIKICAgICAgICAgICAgICAgIGZvciAoaSA9IE9SSUdJTl9ZRUFSOyBpIDwgeWVhcjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0xlYXBZZWFyKGkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IExFQVBfWUVBUl9JTl9TRUNPTkRTOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCArPSBZRUFSX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBNb250aAogICAgICAgICAgICAgICAgdWludDhbMTJdIG1lbW9yeSBtb250aERheUNvdW50czsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzBdID0gMzE7CiAgICAgICAgICAgICAgICBpZiAoaXNMZWFwWWVhcih5ZWFyKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1sxXSA9IDI5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzFdID0gMjg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1syXSA9IDMxOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbM10gPSAzMDsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzRdID0gMzE7CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1s1XSA9IDMwOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbNl0gPSAzMTsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzddID0gMzE7CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1s4XSA9IDMwOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbOV0gPSAzMTsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzEwXSA9IDMwOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbMTFdID0gMzE7CgogICAgICAgICAgICAgICAgZm9yIChpID0gMTsgaSA8IG1vbnRoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IERBWV9JTl9TRUNPTkRTICogbW9udGhEYXlDb3VudHNbaSAtIDFdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIERheQogICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IERBWV9JTl9TRUNPTkRTICogKGRheSAtIDEpOwoKICAgICAgICAgICAgICAgIC8vIEhvdXIKICAgICAgICAgICAgICAgIHRpbWVzdGFtcCArPSBIT1VSX0lOX1NFQ09ORFMgKiAoaG91cik7CgogICAgICAgICAgICAgICAgLy8gTWludXRlCiAgICAgICAgICAgICAgICB0aW1lc3RhbXAgKz0gTUlOVVRFX0lOX1NFQ09ORFMgKiAobWludXRlKTsKCiAgICAgICAgICAgICAgICAvLyBTZWNvbmQKICAgICAgICAgICAgICAgIHRpbWVzdGFtcCArPSBzZWNvbmQ7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVzdGFtcDsKICAgICAgICB9Cn0KCmNvbnRyYWN0IFJlbGVhc2VhYmxlVG9rZW4gaXMgT3BlcmF0aW9uYWwsIExvY2thYmxlVG9rZW4gewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CiAgICB1c2luZyBEYXRlVGltZSBmb3IgdWludDI1NjsKICAgIGJvb2wgc2Vjb25kWWVhclVwZGF0ZSA9IGZhbHNlOyAKICAgIHVpbnQyNTYgcHVibGljIHJlbGVhc2VkU3VwcGx5OyAKICAgIHVpbnQyNTYgcHVibGljIGNyZWF0ZVRpbWU7IAogICAgdWludDI1NiBzdGFuZGFyZERlY2ltYWxzID0gMTAwMDAwMDAwOyAKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5ID0gc3RhbmRhcmREZWNpbWFscy5tdWwoMTAwMDAwMDAwMCk7CiAgICB1aW50MjU2IHB1YmxpYyBsaW1pdFN1cHBseVBlclllYXIgPSBzdGFuZGFyZERlY2ltYWxzLm11bCg2MDAwMDAwMCk7CiAgICB1aW50MjU2IHB1YmxpYyBkYWlseUxpbWl0ID0gc3RhbmRhcmREZWNpbWFscy5tdWwoMTAwMDAwMCk7CgogICAgZXZlbnQgUmVsZWFzZVN1cHBseShhZGRyZXNzIHJlY2VpdmVyLCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IHJlbGVhc2VUaW1lKTsKICAgIGV2ZW50IFVuZnJlZXplQW1vdW50KGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHVuZnJlZXplVGltZSk7CgogICAgc3RydWN0IEZyb3plblJlY29yZCB7CiAgICAgICAgdWludDI1NiBhbW91bnQ7IAogICAgICAgIHVpbnQyNTYgdW5mcmVlemVUaW1lOyAKICAgIH0KCiAgICBtYXBwaW5nICh1aW50ID0+IEZyb3plblJlY29yZCkgcHVibGljIGZyb3plblJlY29yZHM7CiAgICB1aW50IHB1YmxpYyBmcm96ZW5SZWNvcmRzQ291bnQgPSAwOwoKICAgIGZ1bmN0aW9uIFJlbGVhc2VhYmxlVG9rZW4oCiAgICAgICAgICAgICAgICAgICAgdWludDI1NiBpbml0aWFsU3VwcGx5LAogICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgaW5pdFJlbGVhc2VkU3VwcGx5LAogICAgICAgICAgICAgICAgICAgIGFkZHJlc3Mgb3BlcmF0b3IKICAgICAgICAgICAgICAgICkgT3BlcmF0aW9uYWwob3BlcmF0b3IpIHsKICAgICAgICB0b3RhbFN1cHBseSA9IGluaXRpYWxTdXBwbHk7CiAgICAgICAgcmVsZWFzZWRTdXBwbHkgPSBpbml0UmVsZWFzZWRTdXBwbHk7CiAgICAgICAgY3JlYXRlVGltZSA9IG5vdzsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGluaXRSZWxlYXNlZFN1cHBseTsKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIHJlbGVhc2VTdXBwbHkodWludDI1NiByZWxlYXNlQW1vdW50LCB1aW50MjU2IHRpbWVzdGFtcCkgb25seU9wZXJhdG9yIHJldHVybnModWludDI1NiBfYWN0dWFsUmVsZWFzZSkgewogICAgICAgIHJlcXVpcmUodGltZXN0YW1wID49IGNyZWF0ZVRpbWUgJiYgdGltZXN0YW1wIDw9IG5vdyk7CiAgICAgICAgcmVxdWlyZSghanVkZ2VSZWxlYXNlUmVjb3JkRXhpc3QodGltZXN0YW1wKSk7CiAgICAgICAgcmVxdWlyZShyZWxlYXNlQW1vdW50IDw9IGRhaWx5TGltaXQpOwogICAgICAgIHVwZGF0ZUxpbWl0KCk7CiAgICAgICAgcmVxdWlyZShsaW1pdFN1cHBseVBlclllYXIgPiAwKTsKICAgICAgICBpZiAocmVsZWFzZUFtb3VudCA+IGxpbWl0U3VwcGx5UGVyWWVhcikgewogICAgICAgICAgICBpZiAocmVsZWFzZWRTdXBwbHkuYWRkKGxpbWl0U3VwcGx5UGVyWWVhcikgPiB0b3RhbFN1cHBseSkgewogICAgICAgICAgICAgICAgcmVsZWFzZWRTdXBwbHkgPSB0b3RhbFN1cHBseTsKICAgICAgICAgICAgICAgIHJlbGVhc2VBbW91bnQgPSB0b3RhbFN1cHBseS5zdWIocmVsZWFzZWRTdXBwbHkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVsZWFzZWRTdXBwbHkgPSByZWxlYXNlZFN1cHBseS5hZGQobGltaXRTdXBwbHlQZXJZZWFyKTsKICAgICAgICAgICAgICAgIHJlbGVhc2VBbW91bnQgPSBsaW1pdFN1cHBseVBlclllYXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGltaXRTdXBwbHlQZXJZZWFyID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAocmVsZWFzZWRTdXBwbHkuYWRkKHJlbGVhc2VBbW91bnQpID4gdG90YWxTdXBwbHkpIHsKICAgICAgICAgICAgICAgIHJlbGVhc2VkU3VwcGx5ID0gdG90YWxTdXBwbHk7CiAgICAgICAgICAgICAgICByZWxlYXNlQW1vdW50ID0gdG90YWxTdXBwbHkuc3ViKHJlbGVhc2VkU3VwcGx5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbGVhc2VkU3VwcGx5ID0gcmVsZWFzZWRTdXBwbHkuYWRkKHJlbGVhc2VBbW91bnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbWl0U3VwcGx5UGVyWWVhciA9IGxpbWl0U3VwcGx5UGVyWWVhci5zdWIocmVsZWFzZUFtb3VudCk7CiAgICAgICAgfQogICAgICAgIGZyb3plblJlY29yZHNbZnJvemVuUmVjb3Jkc0NvdW50XSA9IEZyb3plblJlY29yZChyZWxlYXNlQW1vdW50LCB0aW1lc3RhbXAuYWRkKDI2ICogMSB3ZWVrcykpOwogICAgICAgIGZyb3plblJlY29yZHNDb3VudCsrOwogICAgICAgIFJlbGVhc2VTdXBwbHkobXNnLnNlbmRlciwgcmVsZWFzZUFtb3VudCwgdGltZXN0YW1wKTsKICAgICAgICByZXR1cm4gcmVsZWFzZUFtb3VudDsKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIGp1ZGdlUmVsZWFzZVJlY29yZEV4aXN0KHVpbnQyNTYgdGltZXN0YW1wKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wgX2V4aXN0KSB7CiAgICAgICAgYm9vbCBleGlzdCA9IGZhbHNlOwogICAgICAgIGlmIChmcm96ZW5SZWNvcmRzQ291bnQgPiAwKSB7CiAgICAgICAgICAgIGZvciAodWludCBpbmRleCA9IDA7IGluZGV4IDwgZnJvemVuUmVjb3Jkc0NvdW50OyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoKGZyb3plblJlY29yZHNbaW5kZXhdLnVuZnJlZXplVGltZS5wYXJzZVRpbWVzdGFtcCgpLnllYXIgPT0gKHRpbWVzdGFtcC5hZGQoMjYgKiAxIHdlZWtzKSkucGFyc2VUaW1lc3RhbXAoKS55ZWFyKQogICAgICAgICAgICAgICAgICAgICYmIChmcm96ZW5SZWNvcmRzW2luZGV4XS51bmZyZWV6ZVRpbWUucGFyc2VUaW1lc3RhbXAoKS5tb250aCA9PSAodGltZXN0YW1wLmFkZCgyNiAqIDEgd2Vla3MpKS5wYXJzZVRpbWVzdGFtcCgpLm1vbnRoKQogICAgICAgICAgICAgICAgICAgICYmIChmcm96ZW5SZWNvcmRzW2luZGV4XS51bmZyZWV6ZVRpbWUucGFyc2VUaW1lc3RhbXAoKS5kYXkgPT0gKHRpbWVzdGFtcC5hZGQoMjYgKiAxIHdlZWtzKSkucGFyc2VUaW1lc3RhbXAoKS5kYXkpKSB7CiAgICAgICAgICAgICAgICAgICAgZXhpc3QgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBleGlzdDsKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIHVwZGF0ZUxpbWl0KCkgaW50ZXJuYWwgewogICAgICAgIGlmIChjcmVhdGVUaW1lLmFkZCgxIHllYXJzKSA8IG5vdyAmJiAhc2Vjb25kWWVhclVwZGF0ZSkgewogICAgICAgICAgICBsaW1pdFN1cHBseVBlclllYXIgPSBzdGFuZGFyZERlY2ltYWxzLm11bCgxMjAwMDAwMDApOwogICAgICAgICAgICBzZWNvbmRZZWFyVXBkYXRlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGNyZWF0ZVRpbWUuYWRkKDIgKiAxIHllYXJzKSA8IG5vdykgewogICAgICAgICAgICBpZiAocmVsZWFzZWRTdXBwbHkgPCB0b3RhbFN1cHBseSkgewogICAgICAgICAgICAgICAgbGltaXRTdXBwbHlQZXJZZWFyID0gdG90YWxTdXBwbHkuc3ViKHJlbGVhc2VkU3VwcGx5KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIHVuZnJlZXplKCkgb25seU9wZXJhdG9yIHJldHVybnModWludDI1NiBfdW5mcmVlemVBbW91bnQpIHsKICAgICAgICB1aW50MjU2IHVuZnJlZXplQW1vdW50ID0gMDsKICAgICAgICB1aW50IGluZGV4ID0gMDsKICAgICAgICB3aGlsZSAoaW5kZXggPCBmcm96ZW5SZWNvcmRzQ291bnQpIHsKICAgICAgICAgICAgaWYgKGZyb3plblJlY29yZHNbaW5kZXhdLnVuZnJlZXplVGltZSA8IG5vdykgewogICAgICAgICAgICAgICAgdW5mcmVlemVBbW91bnQgKz0gZnJvemVuUmVjb3Jkc1tpbmRleF0uYW1vdW50OwogICAgICAgICAgICAgICAgdW5mcmVlemVCeUluZGV4KGluZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGluZGV4Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVuZnJlZXplQW1vdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHVuZnJlZXplQnlJbmRleCAodWludCBpbmRleCkgaW50ZXJuYWwgewogICAgICAgIEZyb3plblJlY29yZCB1bmZyZWV6ZVJlY29yZCA9IGZyb3plblJlY29yZHNbaW5kZXhdOwogICAgICAgIGJhbGFuY2VzW293bmVyXSA9IGJhbGFuY2VzW293bmVyXS5hZGQodW5mcmVlemVSZWNvcmQuYW1vdW50KTsKICAgICAgICBVbmZyZWV6ZUFtb3VudChvd25lciwgdW5mcmVlemVSZWNvcmQuYW1vdW50LCB1bmZyZWV6ZVJlY29yZC51bmZyZWV6ZVRpbWUpOwogICAgICAgIGZyb3plblJlY29yZHNbaW5kZXhdID0gZnJvemVuUmVjb3Jkc1tmcm96ZW5SZWNvcmRzQ291bnQgLSAxXTsKICAgICAgICBkZWxldGUgZnJvemVuUmVjb3Jkc1tmcm96ZW5SZWNvcmRzQ291bnQgLSAxXTsKICAgICAgICBmcm96ZW5SZWNvcmRzQ291bnQtLTsKICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIHNldERhaWx5TGltaXQodWludDI1NiBfZGFpbHlMaW1pdCkgb25seU93bmVyIHsKICAgICAgICBkYWlseUxpbWl0ID0gX2RhaWx5TGltaXQ7CiAgICB9Cn0KCmNvbnRyYWN0IFNuZXR3b3JrIGlzIFJlbGVhc2VhYmxlVG9rZW4gewogICAgc3RyaW5nIHB1YmxpYyBzdGFuZGFyZCA9ICcyMDE4MDExNzAxJzsKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICdTbmV0d29yayc7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICdTTkVUJzsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFscyA9IDg7CgogICAgZnVuY3Rpb24gU25ldHdvcmsoCiAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgaW5pdGlhbFN1cHBseSwKICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBpbml0UmVsZWFzZWRTdXBwbHksCiAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3Mgb3BlcmF0b3IKICAgICAgICAgICAgICAgICAgICAgKSBSZWxlYXNlYWJsZVRva2VuKGluaXRpYWxTdXBwbHksIGluaXRSZWxlYXNlZFN1cHBseSwgb3BlcmF0b3IpIHt9Cn0='.
	

]
