Class {
	#name : #SRTcfaafdd4ec90985108c3f4847b14e7c733eaf575,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTcfaafdd4ec90985108c3f4847b14e7c733eaf575 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KICB9Cn0KCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gcGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCmNvbnRyYWN0IFRydWVsb3ZlQWNjZXNzQ29udHJvbCB7CiAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwoKICBhZGRyZXNzIHB1YmxpYyBjZW9BZGRyZXNzOwogIGFkZHJlc3MgcHVibGljIGNmb0FkZHJlc3M7CiAgYWRkcmVzcyBwdWJsaWMgY29vQWRkcmVzczsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIG1vZGlmaWVyIG9ubHlDRU8oKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICBfOwogIH0KCiAgbW9kaWZpZXIgb25seUNGTygpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjZm9BZGRyZXNzKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5Q09PKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICByZXF1aXJlKAogICAgICBtc2cuc2VuZGVyID09IGNvb0FkZHJlc3MgfHwKICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgIG1zZy5zZW5kZXIgPT0gY2ZvQWRkcmVzcwogICAgKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKCiAgICBjZW9BZGRyZXNzID0gX25ld0NFTzsKICB9CgogIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgcmVxdWlyZShfbmV3Q0ZPICE9IGFkZHJlc3MoMCkpOwoKICAgIGNmb0FkZHJlc3MgPSBfbmV3Q0ZPOwogIH0KCiAgZnVuY3Rpb24gc2V0Q09PKGFkZHJlc3MgX25ld0NPTykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICByZXF1aXJlKF9uZXdDT08gIT0gYWRkcmVzcygwKSk7CgogICAgY29vQWRkcmVzcyA9IF9uZXdDT087CiAgfQoKICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlDTGV2ZWwgd2hlbk5vdFBhdXNlZCB7CiAgICBwYXVzZWQgPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgcGF1c2VkID0gZmFsc2U7CiAgfQp9Cgpjb250cmFjdCBUcnVlbG92ZUJhc2UgaXMgVHJ1ZWxvdmVBY2Nlc3NDb250cm9sIHsKCURpYW1vbmRbXSBkaWFtb25kczsKCW1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGRpYW1vbmRJbmRleFRvT3duZXI7CgltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVyc2hpcFRva2VuQ291bnQ7CgltYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBkaWFtb25kSW5kZXhUb0FwcHJvdmVkOwoKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGZsb3dlckJhbGFuY2VzOwoKCXN0cnVjdCBEaWFtb25kIHsKCQlieXRlczI0IG1vZGVsOwoJCXVpbnQxNiB5ZWFyOwoJCXVpbnQxNiBubzsKCQl1aW50IGFjdGl2YXRlQXQ7Cgl9CgoJc3RydWN0IE1vZGVsIHsKCQlieXRlczI0IG1vZGVsOwoJCXVpbnQgY3VycmVudDsKCQl1aW50IHRvdGFsOwoJCXVpbnQxNiB5ZWFyOwoJCXVpbnQyNTYgcHJpY2U7Cgl9CgoJTW9kZWwgZGlhbW9uZDE7CglNb2RlbCBkaWFtb25kMjsKCU1vZGVsIGRpYW1vbmQzOwoJTW9kZWwgZmxvd2VyOwoKCXVpbnQgc2VuZEdpZnRQcmljZTsKCXVpbnQgYmVnaW5TYWxlVGltZTsKCXVpbnQgbmV4dFNhbGVUaW1lOwoJdWludCByZWdpc3RlclByaWNlOwoKCURpYW1vbmRBdWN0aW9uIHB1YmxpYyBkaWFtb25kQXVjdGlvbjsKCUZsb3dlckF1Y3Rpb24gcHVibGljIGZsb3dlckF1Y3Rpb247CgoJZnVuY3Rpb24gVHJ1ZWxvdmVCYXNlKCkgaW50ZXJuYWwgewoJCXNlbmRHaWZ0UHJpY2UgPSAwLjAwMSBldGhlcjsgLy8gTUFSSzogTW9kaWZ5IGl0CgkJcmVnaXN0ZXJQcmljZSA9IDAuMDEgZXRoZXI7IC8vIE1BUks6IE1vZGlmeSBpdAoJCV9zZXRWYXJzKCk7CgoJCWRpYW1vbmQxID0gTW9kZWwoe21vZGVsOiAiT25seU9uZSIsIGN1cnJlbnQ6IDAsIHRvdGFsOiAxLCB5ZWFyOiAyMDE4LCBwcmljZTogMTAwMCBldGhlcn0pOyAvLyBNQVJLOiBNb2RpZnkgaXQKCQlkaWFtb25kMiA9IE1vZGVsKHttb2RlbDogIkV0ZXJuaXR5MjAxOCIsIGN1cnJlbnQ6IDAsIHRvdGFsOiA1LCB5ZWFyOiAyMDE4LCBwcmljZTogNTAgZXRoZXJ9KTsgLy8gTUFSSzogTW9kaWZ5IGl0CgkJZGlhbW9uZDMgPSBNb2RlbCh7bW9kZWw6ICJNZW1vcmlhbCIsIGN1cnJlbnQ6IDAsIHRvdGFsOiAxMDAwLCB5ZWFyOiAyMDE4LCBwcmljZTogMSBldGhlcn0pOyAvLyBNQVJLOiBNb2RpZnkgaXQKCQlmbG93ZXIgPSBNb2RlbCh7bW9kZWw6ICJNeVNhc3N5R2lybCIsIGN1cnJlbnQ6IDAsIHRvdGFsOiAxMDAwMDAwMCwgeWVhcjogMjAxOCwgcHJpY2U6IDAuMDEgZXRoZXJ9KTsgLy8gTUFSSzogTW9kaWZ5IGl0Cgl9CgoJZnVuY3Rpb24gX3NldFZhcnMoKSBpbnRlcm5hbCB7CgkJYmVnaW5TYWxlVGltZSA9IG5vdzsKCQluZXh0U2FsZVRpbWUgPSBiZWdpblNhbGVUaW1lICsgMzAwIGRheXM7IC8vIE1BUks6IE1vZGlmeSBpdAoJfQoKCWZ1bmN0aW9uIHNldFNlbmRHaWZ0UHJpY2UodWludCBfc2VuZEdpZnRQcmljZSkgZXh0ZXJuYWwgb25seUNPTyB7CgkJc2VuZEdpZnRQcmljZSA9IF9zZW5kR2lmdFByaWNlOwoJfQoKCWZ1bmN0aW9uIHNldFJlZ2lzdGVyUHJpY2UodWludCBfcmVnaXN0ZXJQcmljZSkgZXh0ZXJuYWwgb25seUNPTyB7CgkJcmVnaXN0ZXJQcmljZSA9IF9yZWdpc3RlclByaWNlOwoJfQoKCWZ1bmN0aW9uIF9nZXRNb2RlbCh1aW50IF9pbmRleCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKE1vZGVsIHN0b3JhZ2UpIHsKCQlpZiAoX2luZGV4ID09IDEpIHsKCQkJcmV0dXJuIGRpYW1vbmQxOwoJCX0gZWxzZSBpZiAoX2luZGV4ID09IDIpIHsKCQkJcmV0dXJuIGRpYW1vbmQyOwoJCX0gZWxzZSBpZiAoX2luZGV4ID09IDMpIHsKCQkJcmV0dXJuIGRpYW1vbmQzOwoJCX0gZWxzZSBpZiAoX2luZGV4ID09IDQpIHsKCQkJcmV0dXJuIGZsb3dlcjsKCQl9CgkJcmV2ZXJ0KCk7Cgl9CglmdW5jdGlvbiBnZXRNb2RlbCh1aW50IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKAoJCWJ5dGVzMjQgbW9kZWwsCgkJdWludCBjdXJyZW50LAoJCXVpbnQgdG90YWwsCgkJdWludDE2IHllYXIsCgkJdWludDI1NiBwcmljZQoJKSB7CgkJTW9kZWwgc3RvcmFnZSBfbW9kZWwgPSBfZ2V0TW9kZWwoX2luZGV4KTsKCQltb2RlbCA9IF9tb2RlbC5tb2RlbDsKCQljdXJyZW50ID0gX21vZGVsLmN1cnJlbnQ7CgkJdG90YWwgPSBfbW9kZWwudG90YWw7CgkJeWVhciA9IF9tb2RlbC55ZWFyOwoJCXByaWNlID0gX21vZGVsLnByaWNlOwoJfQp9Cgpjb250cmFjdCBFSVAyMEludGVyZmFjZSB7CiAgICAvKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgaXMgcmVwbGFjZWQgd2l0aDoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4KICAgIFRoaXMgaXMgbW92ZWQgdG8gdGhlIGJhc2UgY29udHJhY3Qgc2luY2UgcHVibGljIGdldHRlciBmdW5jdGlvbnMgYXJlIG5vdAogICAgY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0CiAgICBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuCiAgICAqLwogICAgLy8vIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgcHVibGljIGZsb3dlclRvdGFsU3VwcGx5OwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZGbG93ZXIoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZsb3dlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgc2VuZGVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VuIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbUZsb3dlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlRmxvd2VyKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgZnVuY3Rpb24gYWxsb3dhbmNlRmxvd2VyKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgLy8gc29saGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zaW1wbGUtZXZlbnQtZnVuYy1uYW1lICAKICAgIGV2ZW50IFRyYW5zZmVyRmxvd2VyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSk7IAogICAgZXZlbnQgQXBwcm92YWxGbG93ZXIoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKCiAgICBmdW5jdGlvbiBzdXBwb3J0c0VJUDIwSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KY29udHJhY3QgRVJDNzIxIHsKICAgIC8vIFJlcXVpcmVkIG1ldGhvZHMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiB0b3RhbCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSB0b2tlbklkcyk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogICAgLy8gRVJDLTE2NSBDb21wYXRpYmlsaXR5IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKY29udHJhY3QgRVJDNzIxTWV0YWRhdGEgewoJZnVuY3Rpb24gZ2V0TWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nKSBwdWJsaWMgcHVyZSByZXR1cm5zIChieXRlczMyWzRdIGJ1ZmZlciwgdWludDI1NiBjb3VudCkgewoJCWlmIChfdG9rZW5JZCA9PSAxKSB7CgkJCWJ1ZmZlclswXSA9ICJIZWxsbyBXb3JsZCEgOkQiOwoJCQljb3VudCA9IDE1OwoJCX0gZWxzZSBpZiAoX3Rva2VuSWQgPT0gMikgewoJCQlidWZmZXJbMF0gPSAiSSB3b3VsZCBkZWZpbml0ZWx5IGNob29zZSBhIG1lZGkiOwoJCQlidWZmZXJbMV0gPSAidW0gbGVuZ3RoIHN0cmluZy4iOwoJCQljb3VudCA9IDQ5OwoJCX0gZWxzZSBpZiAoX3Rva2VuSWQgPT0gMykgewoJCQlidWZmZXJbMF0gPSAiTG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIG1pIGUiOwoJCQlidWZmZXJbMV0gPSAic3QgYWNjdW1zYW4gZGFwaWJ1cyBhdWd1ZSBsb3JlbSwiOwoJCQlidWZmZXJbMl0gPSAiIHRyaXN0aXF1ZSB2ZXN0aWJ1bHVtIGlkLCBsaWJlcm8iOwoJCQlidWZmZXJbM10gPSAiIHN1c2NpcGl0IHZhcml1cyBzYXBpZW4gYWxpcXVhbS4iOwoJCQljb3VudCA9IDEyODsKCQl9Cgl9Cn0KCmNvbnRyYWN0IFRydWVsb3ZlT3duZXJzaGlwIGlzIFRydWVsb3ZlQmFzZSwgRVJDNzIxIHsKCXN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJDcnlwdG9UcnVlbG92ZSI7CglzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJDVCI7CgoJLy8gVGhlIGNvbnRyYWN0IHRoYXQgd2lsbCByZXR1cm4ga2l0dHkgbWV0YWRhdGEKCUVSQzcyMU1ldGFkYXRhIHB1YmxpYyBlcmM3MjFNZXRhZGF0YTsKCglieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCQkJLy8gYnl0ZXM0KGtlY2NhazI1Nigic3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KSIpKTsKCglieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCQkJLy8gYnl0ZXM0KGtlY2NhazI1NigibmFtZSgpIikpIF4KCQkJLy8gYnl0ZXM0KGtlY2NhazI1Nigic3ltYm9sKCkiKSkgXgoJCQkvLyBieXRlczQoa2VjY2FrMjU2KCJ0b3RhbFN1cHBseSgpIikpIF4KCQkJLy8gYnl0ZXM0KGtlY2NhazI1NigiYmFsYW5jZU9mKGFkZHJlc3MpIikpIF4KCQkJLy8gYnl0ZXM0KGtlY2NhazI1Nigib3duZXJPZih1aW50MjU2KSIpKSBeCgkJCS8vIGJ5dGVzNChrZWNjYWsyNTYoImFwcHJvdmUoYWRkcmVzcyx1aW50MjU2KSIpKSBeCgkJCS8vIGJ5dGVzNChrZWNjYWsyNTYoInRyYW5zZmVyKGFkZHJlc3MsdWludDI1NikiKSkgXgoJCQkvLyBieXRlczQoa2VjY2FrMjU2KCJ0cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpIikpIF4KCQkJLy8gYnl0ZXM0KGtlY2NhazI1NigidG9rZW5zT2ZPd25lcihhZGRyZXNzKSIpKSBeCgkJCS8vIGJ5dGVzNChrZWNjYWsyNTYoInRva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpIikpOwoKCS8vLyBAbm90aWNlIEludHJvc3BlY3Rpb24gaW50ZXJmYWNlIGFzIHBlciBFUkMtMTY1IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KS4KCS8vLyAgUmV0dXJucyB0cnVlIGZvciBhbnkgc3RhbmRhcmRpemVkIGludGVyZmFjZXMgaW1wbGVtZW50ZWQgYnkgdGhpcyBjb250cmFjdC4gV2UgaW1wbGVtZW50CgkvLy8gIEVSQy0xNjUgKG9idmlvdXNseSEpIGFuZCBFUkMtNzIxLgoJZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CgkJLy8gREVCVUcgT05MWQoJCS8vcmVxdWlyZSgoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9PSAweDAxZmZjOWE3KSAmJiAoSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9PSAweDlhMjA0ODNkKSk7CgoJCXJldHVybiAoKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1KSB8fCAoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKCX0KCglmdW5jdGlvbiBzZXRNZXRhZGF0YUFkZHJlc3MoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzKSBwdWJsaWMgb25seUNFTyB7CgkJZXJjNzIxTWV0YWRhdGEgPSBFUkM3MjFNZXRhZGF0YShfY29udHJhY3RBZGRyZXNzKTsKCX0KCglmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CgkJCXJldHVybiBkaWFtb25kSW5kZXhUb093bmVyW190b2tlbklkXSA9PSBfY2xhaW1hbnQ7Cgl9CgoJZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CgkJb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CgkJZGlhbW9uZEluZGV4VG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CgkJaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKCQkJb3duZXJzaGlwVG9rZW5Db3VudFtfZnJvbV0tLTsKCQkJZGVsZXRlIGRpYW1vbmRJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdOwoJCX0KCQlUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7Cgl9CgoJZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKCQkJcmV0dXJuIGRpYW1vbmRJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKCX0KCglmdW5jdGlvbiBfYXBwcm92ZSh1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9hcHByb3ZlZCkgaW50ZXJuYWwgewoJCQlkaWFtb25kSW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKCX0KCgkvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgS2l0dGllcyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCgkvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KCS8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewoJCQlyZXR1cm4gb3duZXJzaGlwVG9rZW5Db3VudFtfb3duZXJdOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyKAoJCQlhZGRyZXNzIF90bywKCQkJdWludDI1NiBfdG9rZW5JZAoJKQoJCQlleHRlcm5hbAoJCQl3aGVuTm90UGF1c2VkCgl7CgkJCXJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoJCQlyZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKCQkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhkaWFtb25kQXVjdGlvbikpOwoJCQlyZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgoJCQlfdHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7Cgl9CgoJZnVuY3Rpb24gYXBwcm92ZSgKCQkJYWRkcmVzcyBfdG8sCgkJCXVpbnQyNTYgX3Rva2VuSWQKCSkKCQkJZXh0ZXJuYWwKCQkJd2hlbk5vdFBhdXNlZAoJewoJCQlyZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgoJCQlfYXBwcm92ZShfdG9rZW5JZCwgX3RvKTsKCgkJCUFwcHJvdmFsKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKCQkJYWRkcmVzcyBfZnJvbSwKCQkJYWRkcmVzcyBfdG8sCgkJCXVpbnQyNTYgX3Rva2VuSWQKCSkKCQkJZXh0ZXJuYWwKCQkJd2hlbk5vdFBhdXNlZAoJewoJCQlyZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCQkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CgkJCXJlcXVpcmUoX2FwcHJvdmVkRm9yKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgkJCXJlcXVpcmUoX293bnMoX2Zyb20sIF90b2tlbklkKSk7CgoJCQlfdHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwoJfQoKCWZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewoJCQlyZXR1cm4gZGlhbW9uZHMubGVuZ3RoIC0gMTsKCX0KCglmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpCgkJCWV4dGVybmFsCgkJCXZpZXcKCQkJcmV0dXJucyAoYWRkcmVzcyBvd25lcikKCXsKCQkJb3duZXIgPSBkaWFtb25kSW5kZXhUb093bmVyW190b2tlbklkXTsKCgkJCXJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7Cgl9CgoJLy8vIEBkZXYgVGhpcyBtZXRob2QgTVVTVCBORVZFUiBiZSBjYWxsZWQgYnkgc21hcnQgY29udHJhY3QgY29kZS4gRmlyc3QsIGl0J3MgZmFpcmx5CgkvLy8gIGV4cGVuc2l2ZSAoaXQgd2Fsa3MgdGhlIGVudGlyZSBLaXR0eSBhcnJheSBsb29raW5nIGZvciBjYXRzIGJlbG9uZ2luZyB0byBvd25lciksCgkvLy8gIGJ1dCBpdCBhbHNvIHJldHVybnMgYSBkeW5hbWljIGFycmF5LCB3aGljaCBpcyBvbmx5IHN1cHBvcnRlZCBmb3Igd2ViMyBjYWxscywgYW5kCgkvLy8gIG5vdCBjb250cmFjdC10by1jb250cmFjdCBjYWxscy4KCWZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10gb3duZXJUb2tlbnMpIHsKCQkJdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgoJCQlpZiAodG9rZW5Db3VudCA9PSAwKSB7CgkJCQkJLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CgkJCQkJcmV0dXJuIG5ldyB1aW50MjU2W10oMCk7CgkJCX0gZWxzZSB7CgkJCQkJdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKHRva2VuQ291bnQpOwoJCQkJCXVpbnQyNTYgdG90YWxEaWFtb25kcyA9IHRvdGFsU3VwcGx5KCk7CgkJCQkJdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgoJCQkJCXVpbnQyNTYgZGlhbW9uZElkOwoKCQkJCQlmb3IgKGRpYW1vbmRJZCA9IDE7IGRpYW1vbmRJZCA8PSB0b3RhbERpYW1vbmRzOyBkaWFtb25kSWQrKykgewoJCQkJCQkJaWYgKGRpYW1vbmRJbmRleFRvT3duZXJbZGlhbW9uZElkXSA9PSBfb3duZXIpIHsKCQkJCQkJCQkJcmVzdWx0W3Jlc3VsdEluZGV4XSA9IGRpYW1vbmRJZDsKCQkJCQkJCQkJcmVzdWx0SW5kZXgrKzsKCQkJCQkJCX0KCQkJCQl9CgoJCQkJCXJldHVybiByZXN1bHQ7CgkJCX0KCX0KCglmdW5jdGlvbiBfbWVtY3B5KHVpbnQgX2Rlc3QsIHVpbnQgX3NyYywgdWludCBfbGVuKSBwcml2YXRlIHB1cmUgewoJCQkvLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQoJCQlmb3IoOyBfbGVuID49IDMyOyBfbGVuIC09IDMyKSB7CgkJCQkJYXNzZW1ibHkgewoJCQkJCQkJbXN0b3JlKF9kZXN0LCBtbG9hZChfc3JjKSkKCQkJCQl9CgkJCQkJX2Rlc3QgKz0gMzI7CgkJCQkJX3NyYyArPSAzMjsKCQkJfQoKCQkJLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKCQkJdWludDI1NiBtYXNrID0gMjU2ICoqICgzMiAtIF9sZW4pIC0gMTsKCQkJYXNzZW1ibHkgewoJCQkJCWxldCBzcmNwYXJ0IDo9IGFuZChtbG9hZChfc3JjKSwgbm90KG1hc2spKQoJCQkJCWxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoX2Rlc3QpLCBtYXNrKQoJCQkJCW1zdG9yZShfZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQoJCQl9Cgl9CgoJZnVuY3Rpb24gX3RvU3RyaW5nKGJ5dGVzMzJbNF0gX3Jhd0J5dGVzLCB1aW50MjU2IF9zdHJpbmdMZW5ndGgpIHByaXZhdGUgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKCQkJdmFyIG91dHB1dFN0cmluZyA9IG5ldyBzdHJpbmcoX3N0cmluZ0xlbmd0aCk7CgkJCXVpbnQyNTYgb3V0cHV0UHRyOwoJCQl1aW50MjU2IGJ5dGVzUHRyOwoKCQkJYXNzZW1ibHkgewoJCQkJCW91dHB1dFB0ciA6PSBhZGQob3V0cHV0U3RyaW5nLCAzMikKCQkJCQlieXRlc1B0ciA6PSBfcmF3Qnl0ZXMKCQkJfQoKCQkJX21lbWNweShvdXRwdXRQdHIsIGJ5dGVzUHRyLCBfc3RyaW5nTGVuZ3RoKTsKCgkJCXJldHVybiBvdXRwdXRTdHJpbmc7Cgl9CgoJZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCkgewoJCQlyZXF1aXJlKGVyYzcyMU1ldGFkYXRhICE9IGFkZHJlc3MoMCkpOwoJCQlieXRlczMyWzRdIG1lbW9yeSBidWZmZXI7CgkJCXVpbnQyNTYgY291bnQ7CgkJCShidWZmZXIsIGNvdW50KSA9IGVyYzcyMU1ldGFkYXRhLmdldE1ldGFkYXRhKF90b2tlbklkLCBfcHJlZmVycmVkVHJhbnNwb3J0KTsKCgkJCXJldHVybiBfdG9TdHJpbmcoYnVmZmVyLCBjb3VudCk7Cgl9CgoJZnVuY3Rpb24gZ2V0RGlhbW9uZCh1aW50MjU2IF9pZCkKCQlleHRlcm5hbAoJCXZpZXcKCQlyZXR1cm5zICgKCQlieXRlczI0IG1vZGVsLAoJCXVpbnQxNiB5ZWFyLAoJCXVpbnQxNiBubywKCQl1aW50IGFjdGl2YXRlQXQKCSkgewoJCURpYW1vbmQgc3RvcmFnZSBkaWFtb25kID0gZGlhbW9uZHNbX2lkXTsKCgkJbW9kZWwgPSBkaWFtb25kLm1vZGVsOwoJCXllYXIgPSBkaWFtb25kLnllYXI7CgkJbm8gPSBkaWFtb25kLm5vOwoJCWFjdGl2YXRlQXQgPSBkaWFtb25kLmFjdGl2YXRlQXQ7Cgl9Cn0KCmNvbnRyYWN0IFRydWVsb3ZlRmxvd2VyT3duZXJzaGlwIGlzIFRydWVsb3ZlQmFzZSwgRUlQMjBJbnRlcmZhY2UgewoJdWludDI1NiBjb25zdGFudCBwcml2YXRlIE1BWF9VSU5UMjU2ID0gMioqMjU2IC0gMTsKCW1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIGZsb3dlckFsbG93ZWQ7CgoJYnl0ZXM0IGNvbnN0YW50IEVJUDIwSW50ZXJmYWNlU2lnbmF0dXJlID0gYnl0ZXM0KDB4OTg0NzQxMDkpOwoJCS8vIGJ5dGVzNChrZWNjYWsyNTYoImJhbGFuY2VPZkZsb3dlcihhZGRyZXNzKSIpKSBeCgkJLy8gYnl0ZXM0KGtlY2NhazI1NigiYXBwcm92ZUZsb3dlcihhZGRyZXNzLHVpbnQyNTYpIikpIF4KCQkvLyBieXRlczQoa2VjY2FrMjU2KCJ0cmFuc2ZlckZsb3dlcihhZGRyZXNzLHVpbnQyNTYpIikpIF4KCQkvLyBieXRlczQoa2VjY2FrMjU2KCJ0cmFuc2ZlckZyb21GbG93ZXIoYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpIikpOwoKCWZ1bmN0aW9uIHN1cHBvcnRzRUlQMjBJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CgkJcmV0dXJuIF9pbnRlcmZhY2VJRCA9PSBFSVAyMEludGVyZmFjZVNpZ25hdHVyZTsKCX0KCglmdW5jdGlvbiBfdHJhbnNmZXJGbG93ZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQlpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewoJCQlyZXF1aXJlKGZsb3dlckJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUpOwoJCQlmbG93ZXJCYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwoJCX0KCQlmbG93ZXJCYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKCQlUcmFuc2ZlckZsb3dlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoJCXJldHVybiB0cnVlOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyRmxvd2VyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCXJlcXVpcmUoZmxvd2VyQmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKCQlmbG93ZXJCYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgkJZmxvd2VyQmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CgkJVHJhbnNmZXJGbG93ZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoJCXJldHVybiB0cnVlOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbUZsb3dlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCQl1aW50MjU2IGFsbG93YW5jZSA9IGZsb3dlckFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoJCXJlcXVpcmUoZmxvd2VyQmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2FuY2UgPj0gX3ZhbHVlKTsKCQlmbG93ZXJCYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKCQlmbG93ZXJCYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwoJCWlmIChhbGxvd2FuY2UgPCBNQVhfVUlOVDI1NikgewoJCQlmbG93ZXJBbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CgkJfQoJCVRyYW5zZmVyRmxvd2VyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJZnVuY3Rpb24gYmFsYW5jZU9mRmxvd2VyKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKCQlyZXR1cm4gZmxvd2VyQmFsYW5jZXNbX293bmVyXTsKCX0KCglmdW5jdGlvbiBhcHByb3ZlRmxvd2VyKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgkJZmxvd2VyQWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CgkJQXBwcm92YWxGbG93ZXIobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJZnVuY3Rpb24gYWxsb3dhbmNlRmxvd2VyKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewoJCXJldHVybiBmbG93ZXJBbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwoJfQoKCWZ1bmN0aW9uIF9hZGRGbG93ZXIodWludDI1NiBfYW1vdW50KSBpbnRlcm5hbCB7CgkJZmxvd2VyLmN1cnJlbnQgKz0gX2Ftb3VudDsKCQlmbG93ZXJUb3RhbFN1cHBseSArPSBfYW1vdW50OwoJfQp9Cgpjb250cmFjdCBUcnVlbG92ZU5leHRTYWxlIGlzIFRydWVsb3ZlT3duZXJzaGlwLCBUcnVlbG92ZUZsb3dlck93bmVyc2hpcCB7Cgl1aW50MjU2IGNvbnN0YW50IFJFTUFJTklOR19BTU9VTlQgPSA1MDAwMDsgLy8gTUFSSzogTW9kaWZ5IGl0CgoJZnVuY3Rpb24gVHJ1ZWxvdmVOZXh0U2FsZSgpIGludGVybmFsIHsKCQlfZ2l2ZVJlbWFpbmluZ0Zsb3dlcigpOwoJfQoKCWZ1bmN0aW9uIG9wZW5OZXh0U2FsZSh1aW50MjU2IF9kaWFtb25kMVByaWNlLCBieXRlczI0IF9kaWFtb25kMk1vZGVsLCB1aW50MjU2IF9kaWFtb25kMlByaWNlLCBieXRlczI0IF9mbG93ZXJNb2RlbCwgdWludDI1NiBfZmxvd2VyUHJpY2UpCgkJZXh0ZXJuYWwgb25seUNPTwoJCXsKCQlyZXF1aXJlKG5vdyA+PSBuZXh0U2FsZVRpbWUpOwoKCQlfc2V0VmFycygpOwoJCWRpYW1vbmQxLnByaWNlID0gX2RpYW1vbmQxUHJpY2U7CgkJX29wZW5TYWxlRGlhbW9uZDIoX2RpYW1vbmQyTW9kZWwsIF9kaWFtb25kMlByaWNlKTsKCQlfb3BlblNhbGVGbG93ZXIoX2Zsb3dlck1vZGVsLCBfZmxvd2VyUHJpY2UpOwoJCV9naXZlUmVtYWluaW5nRmxvd2VyKCk7Cgl9CgoJZnVuY3Rpb24gX29wZW5TYWxlRGlhbW9uZDIoYnl0ZXMyNCBfZGlhbW9uZDJNb2RlbCwgdWludDI1NiBfZGlhbW9uZDJQcmljZSkgcHJpdmF0ZSB7CgkJZGlhbW9uZDIubW9kZWwgPSBfZGlhbW9uZDJNb2RlbDsKCQlkaWFtb25kMi5jdXJyZW50ID0gMDsKCQlkaWFtb25kMi55ZWFyKys7CgkJZGlhbW9uZDIucHJpY2UgPSBfZGlhbW9uZDJQcmljZTsKCX0KCglmdW5jdGlvbiBfb3BlblNhbGVGbG93ZXIoYnl0ZXMyNCBfZmxvd2VyTW9kZWwsIHVpbnQyNTYgX2Zsb3dlclByaWNlKSBwcml2YXRlIHsKCQlmbG93ZXIubW9kZWwgPSBfZmxvd2VyTW9kZWw7CgkJZmxvd2VyLmN1cnJlbnQgPSAwOwoJCWZsb3dlci55ZWFyKys7CgkJZmxvd2VyLnByaWNlID0gX2Zsb3dlclByaWNlOwoJCWZsb3dlci50b3RhbCA9IDEwMDAwMDA7IC8vIE1BUks6IE1vZGlmeSBpdAoJfQoKCWZ1bmN0aW9uIF9naXZlUmVtYWluaW5nRmxvd2VyKCkgaW50ZXJuYWwgewoJCV90cmFuc2ZlckZsb3dlcigwLCBtc2cuc2VuZGVyLCBSRU1BSU5JTkdfQU1PVU5UKTsKCQlfYWRkRmxvd2VyKFJFTUFJTklOR19BTU9VTlQpOwoJfQp9Cgpjb250cmFjdCBUcnVlbG92ZVJlZ2lzdHJhdGlvbiBpcyBUcnVlbG92ZU5leHRTYWxlIHsKCW1hcHBpbmcgKGFkZHJlc3MgPT4gUmVnaXN0cmF0aW9uUmlnaHQpIHB1YmxpYyByZWdpc3RyYXRpb25SaWdodHM7CgltYXBwaW5nIChieXRlczMyID0+IFJlZ2lzdHJhdGlvbikgcHVibGljIHJlZ2lzdHJhdGlvbnM7CgoJc3RydWN0IFJlZ2lzdHJhdGlvblJpZ2h0IHsKCQlib29sIGFibGU7CgkJYm9vbCB1c2VkOwoJfQoKCXN0cnVjdCBSZWdpc3RyYXRpb24gewoJCWJvb2wgc2lnbmVkOwoJCXN0cmluZyBzZWNyZXQ7IC8vIGluY2x1ZGluZyBib3RoIG5hbWVzCgkJc3RyaW5nIHRvcFNlY3JldDsgLy8gaW5jbHVkaW5nIFNTTiBhbmQgYmlydGhkYXRlCgl9CgoJZnVuY3Rpb24gZ2l2ZVJlZ2lzdHJhdGlvbihhZGRyZXNzIF9hZGRyKSBleHRlcm5hbCBvbmx5Q09PIHsKCQlpZiAocmVnaXN0cmF0aW9uUmlnaHRzW19hZGRyXS5hYmxlID09IGZhbHNlKSB7CgkJCXJlZ2lzdHJhdGlvblJpZ2h0c1tfYWRkcl0uYWJsZSA9IHRydWU7CgkJfSBlbHNlIHsKCQkJcmV2ZXJ0KCk7CgkJfQoJfQoKCWZ1bmN0aW9uIGJ1eVJlZ2lzdHJhdGlvbigpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CgkJcmVxdWlyZShyZWdpc3RlclByaWNlIDw9IG1zZy52YWx1ZSk7CgkJaWYgKHJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID09IGZhbHNlKSB7CgkJCXJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID0gdHJ1ZTsKCQl9IGVsc2UgewoJCQlyZXZlcnQoKTsKCQl9Cgl9CgoJZnVuY3Rpb24gX2dpdmVTZW5kZXJSZWdpc3RyYXRpb24oKSBpbnRlcm5hbCB7CgkJaWYgKHJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID09IGZhbHNlKSB7CgkJCXJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID0gdHJ1ZTsKCQl9Cgl9CgoJZnVuY3Rpb24gZ2V0UmVnaXN0cmF0aW9uUmlnaHQoYWRkcmVzcyBfYWRkcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sIGFibGUsIGJvb2wgdXNlZCkgewoJCWFibGUgPSByZWdpc3RyYXRpb25SaWdodHNbX2FkZHJdLmFibGU7CgkJdXNlZCA9IHJlZ2lzdHJhdGlvblJpZ2h0c1tfYWRkcl0udXNlZDsKCX0KCglmdW5jdGlvbiBnZXRSZWdpc3RyYXRpb24oYnl0ZXMzMiBfdW5pcXVlKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgc2lnbmVkLCBzdHJpbmcgc2VjcmV0LCBzdHJpbmcgdG9wU2VjcmV0KSB7CgkJc2lnbmVkID0gcmVnaXN0cmF0aW9uc1tfdW5pcXVlXS5zaWduZWQ7CgkJc2VjcmV0ID0gcmVnaXN0cmF0aW9uc1tfdW5pcXVlXS5zZWNyZXQ7CgkJdG9wU2VjcmV0ID0gcmVnaXN0cmF0aW9uc1tfdW5pcXVlXS50b3BTZWNyZXQ7Cgl9CgoJZnVuY3Rpb24gc2lnblRydWVsb3ZlKGJ5dGVzMzIgX3JlZ2lzdGVySUQsIHN0cmluZyBfc2VjcmV0LCBzdHJpbmcgX3RvcFNlY3JldCkgcHVibGljIHsKCQlyZXF1aXJlKHJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS5hYmxlID09IHRydWUpOwoJCXJlcXVpcmUocmVnaXN0cmF0aW9uUmlnaHRzW21zZy5zZW5kZXJdLnVzZWQgPT0gZmFsc2UpOwoJCXJlZ2lzdHJhdGlvblJpZ2h0c1ttc2cuc2VuZGVyXS51c2VkID0gdHJ1ZTsKCQlfc2lnblRydWVsb3ZlKF9yZWdpc3RlcklELCBfc2VjcmV0LCBfdG9wU2VjcmV0KTsKCX0KCglmdW5jdGlvbiBzaWduVHJ1ZWxvdmVCeUNPTyhieXRlczMyIF9yZWdpc3RlcklELCBzdHJpbmcgX3NlY3JldCwgc3RyaW5nIF90b3BTZWNyZXQpIGV4dGVybmFsIG9ubHlDT08gewoJCV9zaWduVHJ1ZWxvdmUoX3JlZ2lzdGVySUQsIF9zZWNyZXQsIF90b3BTZWNyZXQpOwoJfQoKCWZ1bmN0aW9uIF9zaWduVHJ1ZWxvdmUoYnl0ZXMzMiBfcmVnaXN0ZXJJRCwgc3RyaW5nIF9zZWNyZXQsIHN0cmluZyBfdG9wU2VjcmV0KSBpbnRlcm5hbCB7CgkJcmVxdWlyZShyZWdpc3RyYXRpb25zW19yZWdpc3RlcklEXS5zaWduZWQgPT0gZmFsc2UpOwoKCQlyZWdpc3RyYXRpb25zW19yZWdpc3RlcklEXS5zaWduZWQgPSB0cnVlOwoJCXJlZ2lzdHJhdGlvbnNbX3JlZ2lzdGVySURdLnNlY3JldCA9IF9zZWNyZXQ7CgkJcmVnaXN0cmF0aW9uc1tfcmVnaXN0ZXJJRF0udG9wU2VjcmV0ID0gX3RvcFNlY3JldDsKCX0KfQoKY29udHJhY3QgVHJ1ZWxvdmVTaG9wIGlzIFRydWVsb3ZlUmVnaXN0cmF0aW9uIHsKCWZ1bmN0aW9uIGJ1eURpYW1vbmQodWludCBfaW5kZXgpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCByZXR1cm5zKHVpbnQyNTYpIHsKCQlyZXF1aXJlKF9pbmRleCA9PSAxIHx8IF9pbmRleCA9PSAyIHx8IF9pbmRleCA9PSAzKTsKCQlNb2RlbCBzdG9yYWdlIG1vZGVsID0gX2dldE1vZGVsKF9pbmRleCk7CgoJCXJlcXVpcmUobW9kZWwuY3VycmVudCA8IG1vZGVsLnRvdGFsKTsKCQlyZXF1aXJlKG1vZGVsLnByaWNlIDw9IG1zZy52YWx1ZSk7CgkJX2dpdmVTZW5kZXJSZWdpc3RyYXRpb24oKTsKCgkJdWludDI1NiBuZXdEaWFtb25kSWQgPSBkaWFtb25kcy5wdXNoKERpYW1vbmQoe21vZGVsOiBtb2RlbC5tb2RlbCwgeWVhcjogbW9kZWwueWVhciwgbm86IHVpbnQxNihtb2RlbC5jdXJyZW50ICsgMSksIGFjdGl2YXRlQXQ6IDB9KSkgLSAxOwoJCV90cmFuc2ZlcigwLCBtc2cuc2VuZGVyLCBuZXdEaWFtb25kSWQpOwoJCQoJCW1vZGVsLmN1cnJlbnQrKzsKCQlyZXR1cm4gbmV3RGlhbW9uZElkOwoJfQoKCWZ1bmN0aW9uIGJ1eUZsb3dlcih1aW50IF9hbW91bnQpIGV4dGVybmFsIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CgkJcmVxdWlyZShmbG93ZXIuY3VycmVudCArIF9hbW91bnQgPCBmbG93ZXIudG90YWwpOwoJCXVpbnQyNTYgcHJpY2UgPSBjdXJyZW50Rmxvd2VyUHJpY2UoKTsKCQlyZXF1aXJlKHByaWNlICogX2Ftb3VudCA8PSBtc2cudmFsdWUpOwoJCV9naXZlU2VuZGVyUmVnaXN0cmF0aW9uKCk7CgoJCV90cmFuc2ZlckZsb3dlcigwLCBtc2cuc2VuZGVyLCBfYW1vdW50KTsKCQlfYWRkRmxvd2VyKF9hbW91bnQpOwoJfQoKCWZ1bmN0aW9uIGN1cnJlbnRGbG93ZXJQcmljZSgpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1NikgewoJCWlmIChmbG93ZXIuY3VycmVudCA8IDEwICsgUkVNQUlOSU5HX0FNT1VOVCkgeyAvLyBNQVJLOiBNb2RpZnkgaXQKCQkJcmV0dXJuIGZsb3dlci5wcmljZTsKCQl9IGVsc2UgaWYgKGZsb3dlci5jdXJyZW50IDwgMzAgKyBSRU1BSU5JTkdfQU1PVU5UKSB7IC8vIE1BUks6IE1vZGlmeSBpdAoJCQlyZXR1cm4gZmxvd2VyLnByaWNlICogNDsKCQl9IGVsc2UgewoJCQlyZXR1cm4gZmxvd2VyLnByaWNlICogMTA7CgkJfQoJfQp9CmNvbnRyYWN0IFRydWVsb3ZlRGVsaXZlcnkgaXMgVHJ1ZWxvdmVTaG9wIHsKCWVudW0gR2lmdFR5cGUgeyBEaWFtb25kLCBGbG93ZXIgfQoKCWV2ZW50IEdpZnRTZW5kKHVpbnQgaW5kZXhlZCBpbmRleCwgYWRkcmVzcyBpbmRleGVkIHJlY2VpdmVyLCBhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYnl0ZXMzMiByZWdpc3RlcklELCBzdHJpbmcgbGV0dGVyLCBieXRlczE2IGRhdGUsCgkJR2lmdFR5cGUgZ3R5cGUsCgkJYnl0ZXMyNCBtb2RlbCwKCQl1aW50MTYgeWVhciwKCQl1aW50MTYgbm8sCgkJdWludCBhbW91bnQKCQkpOwoKCXVpbnQgcHVibGljIGdpZnRTZW5kSW5kZXggPSAxOwoJCgltb2RpZmllciBzZW5kQ2hlY2soYnl0ZXMzMiBfcmVnaXN0ZXJJRCkgewogICAgcmVxdWlyZShzZW5kR2lmdFByaWNlIDw9IG1zZy52YWx1ZSk7CgkJcmVxdWlyZShyZWdpc3RyYXRpb25zW19yZWdpc3RlcklEXS5zaWduZWQpOwogICAgXzsKICB9CgoJZnVuY3Rpb24gc2lnblNlbmREaWFtb25kKGJ5dGVzMzIgX3JlZ2lzdGVySUQsIHN0cmluZyBfc2VjcmV0LCBzdHJpbmcgX3RvcFNlY3JldCwgYWRkcmVzcyBfdHJ1ZWxvdmUsIHN0cmluZyBfbGV0dGVyLCBieXRlczE2IF9kYXRlLCB1aW50IF90b2tlbklkKSBleHRlcm5hbCBwYXlhYmxlIHsKCQlzaWduVHJ1ZWxvdmUoX3JlZ2lzdGVySUQsIF9zZWNyZXQsIF90b3BTZWNyZXQpOwoJCXNlbmREaWFtb25kKF90cnVlbG92ZSwgX3JlZ2lzdGVySUQsIF9sZXR0ZXIsIF9kYXRlLCBfdG9rZW5JZCk7Cgl9CgoJZnVuY3Rpb24gc2VuZERpYW1vbmQoYWRkcmVzcyBfdHJ1ZWxvdmUsIGJ5dGVzMzIgX3JlZ2lzdGVySUQsIHN0cmluZyBfbGV0dGVyLCBieXRlczE2IF9kYXRlLCB1aW50IF90b2tlbklkKSBwdWJsaWMgcGF5YWJsZSBzZW5kQ2hlY2soX3JlZ2lzdGVySUQpIHsKCQlyZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgkJcmVxdWlyZShub3cgPiBkaWFtb25kc1tfdG9rZW5JZF0uYWN0aXZhdGVBdCk7CgkJCgkJX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90cnVlbG92ZSwgX3Rva2VuSWQpOwoJCQoJCWRpYW1vbmRzW190b2tlbklkXS5hY3RpdmF0ZUF0ID0gbm93ICsgMyBkYXlzOwoKCQlHaWZ0U2VuZChnaWZ0U2VuZEluZGV4LCBfdHJ1ZWxvdmUsIG1zZy5zZW5kZXIsIF9yZWdpc3RlcklELCBfbGV0dGVyLCBfZGF0ZSwKCQkJR2lmdFR5cGUuRGlhbW9uZCwKCQkJZGlhbW9uZHNbX3Rva2VuSWRdLm1vZGVsLAoJCQlkaWFtb25kc1tfdG9rZW5JZF0ueWVhciwKCQkJZGlhbW9uZHNbX3Rva2VuSWRdLm5vLAoJCQkxCgkJCSk7CgkJZ2lmdFNlbmRJbmRleCsrOwoJfQoKCWZ1bmN0aW9uIHNpZ25TZW5kRmxvd2VyKGJ5dGVzMzIgX3JlZ2lzdGVySUQsIHN0cmluZyBfc2VjcmV0LCBzdHJpbmcgX3RvcFNlY3JldCwgYWRkcmVzcyBfdHJ1ZWxvdmUsIHN0cmluZyBfbGV0dGVyLCBieXRlczE2IF9kYXRlLCB1aW50IF9hbW91bnQpIGV4dGVybmFsIHBheWFibGUgewoJCXNpZ25UcnVlbG92ZShfcmVnaXN0ZXJJRCwgX3NlY3JldCwgX3RvcFNlY3JldCk7CgkJc2VuZEZsb3dlcihfdHJ1ZWxvdmUsIF9yZWdpc3RlcklELCBfbGV0dGVyLCBfZGF0ZSwgX2Ftb3VudCk7Cgl9CgoJZnVuY3Rpb24gc2VuZEZsb3dlcihhZGRyZXNzIF90cnVlbG92ZSwgYnl0ZXMzMiBfcmVnaXN0ZXJJRCwgc3RyaW5nIF9sZXR0ZXIsIGJ5dGVzMTYgX2RhdGUsIHVpbnQgX2Ftb3VudCkgcHVibGljIHBheWFibGUgc2VuZENoZWNrKF9yZWdpc3RlcklEKSB7CgkJcmVxdWlyZShmbG93ZXJCYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfYW1vdW50KTsKCgkJZmxvd2VyQmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKCQlmbG93ZXJCYWxhbmNlc1tfdHJ1ZWxvdmVdICs9IChfYW1vdW50ICogOSAvIDEwKTsKCgkJR2lmdFNlbmQoZ2lmdFNlbmRJbmRleCwgX3RydWVsb3ZlLCBtc2cuc2VuZGVyLCBfcmVnaXN0ZXJJRCwgX2xldHRlciwgX2RhdGUsCgkJCUdpZnRUeXBlLkZsb3dlciwKCQkJZmxvd2VyLm1vZGVsLAoJCQlmbG93ZXIueWVhciwKCQkJMCwKCQkJX2Ftb3VudAoJCQkpOwoJCWdpZnRTZW5kSW5kZXgrKzsKCX0KfQoKY29udHJhY3QgVHJ1ZWxvdmVBdWN0aW9uIGlzIFRydWVsb3ZlRGVsaXZlcnkgewoJZnVuY3Rpb24gc2V0RGlhbW9uZEF1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewoJCURpYW1vbmRBdWN0aW9uIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRGlhbW9uZEF1Y3Rpb24oX2FkZHJlc3MpOwoKCQkvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0gaHR0cHM6Ly9naXRodWIuY29tL0x1bnlyL2Nyb3dkc2FsZS1jb250cmFjdHMvYmxvYi9jZmFkZDE1OTg2YzMwNTIxZDhiYTdkNWI2ZjU3YjRmZWZjYzdhYzM4L2NvbnRyYWN0cy9MdW55clRva2VuLnNvbCNMMTE3CgkJcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc0RpYW1vbmRBdWN0aW9uKCkpOwoJCWRpYW1vbmRBdWN0aW9uID0gY2FuZGlkYXRlQ29udHJhY3Q7Cgl9CgoJZnVuY3Rpb24gY3JlYXRlRGlhbW9uZEF1Y3Rpb24oCgkJdWludDI1NiBfdG9rZW5JZCwKCQl1aW50MjU2IF9zdGFydGluZ1ByaWNlLAoJCXVpbnQyNTYgX2VuZGluZ1ByaWNlLAoJCXVpbnQyNTYgX2R1cmF0aW9uCgkpCgkJZXh0ZXJuYWwKCQl3aGVuTm90UGF1c2VkCgl7CgkJcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoJCS8vIHJlcXVpcmUoIWlzUHJlZ25hbnQoX3Rva2VuSWQpKTsKCQlfYXBwcm92ZShfdG9rZW5JZCwgZGlhbW9uZEF1Y3Rpb24pOwoJCWRpYW1vbmRBdWN0aW9uLmNyZWF0ZUF1Y3Rpb24oCgkJCV90b2tlbklkLAoJCQlfc3RhcnRpbmdQcmljZSwKCQkJX2VuZGluZ1ByaWNlLAoJCQlfZHVyYXRpb24sCgkJCW1zZy5zZW5kZXIKCQkpOwoJfQoKCWZ1bmN0aW9uIHNldEZsb3dlckF1Y3Rpb25BZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gewoJCUZsb3dlckF1Y3Rpb24gY2FuZGlkYXRlQ29udHJhY3QgPSBGbG93ZXJBdWN0aW9uKF9hZGRyZXNzKTsKCgkJLy8gTk9URTogdmVyaWZ5IHRoYXQgYSBjb250cmFjdCBpcyB3aGF0IHdlIGV4cGVjdCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9MdW55ci9jcm93ZHNhbGUtY29udHJhY3RzL2Jsb2IvY2ZhZGQxNTk4NmMzMDUyMWQ4YmE3ZDViNmY1N2I0ZmVmY2M3YWMzOC9jb250cmFjdHMvTHVueXJUb2tlbi5zb2wjTDExNwoJCXJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNGbG93ZXJBdWN0aW9uKCkpOwoJCWZsb3dlckF1Y3Rpb24gPSBjYW5kaWRhdGVDb250cmFjdDsKCX0KCglmdW5jdGlvbiBjcmVhdGVGbG93ZXJBdWN0aW9uKAoJCXVpbnQyNTYgX2Ftb3VudCwKCQl1aW50MjU2IF9zdGFydGluZ1ByaWNlLAoJCXVpbnQyNTYgX2VuZGluZ1ByaWNlLAoJCXVpbnQyNTYgX2R1cmF0aW9uCgkpCgkJZXh0ZXJuYWwKCQl3aGVuTm90UGF1c2VkCgl7CgkJYXBwcm92ZUZsb3dlcihmbG93ZXJBdWN0aW9uLCBfYW1vdW50KTsKCQlmbG93ZXJBdWN0aW9uLmNyZWF0ZUF1Y3Rpb24oCgkJCV9hbW91bnQsCgkJCV9zdGFydGluZ1ByaWNlLAoJCQlfZW5kaW5nUHJpY2UsCgkJCV9kdXJhdGlvbiwKCQkJbXNnLnNlbmRlcgoJCSk7Cgl9CgoJZnVuY3Rpb24gd2l0aGRyYXdBdWN0aW9uQmFsYW5jZXMoKSBleHRlcm5hbCBvbmx5Q0xldmVsIHsKCQlkaWFtb25kQXVjdGlvbi53aXRoZHJhd0JhbGFuY2UoKTsKCQlmbG93ZXJBdWN0aW9uLndpdGhkcmF3QmFsYW5jZSgpOwoJfQp9Cgpjb250cmFjdCBUcnVlbG92ZUNvcmUgaXMgVHJ1ZWxvdmVBdWN0aW9uIHsKCWFkZHJlc3MgcHVibGljIG5ld0NvbnRyYWN0QWRkcmVzczsKCglldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CglldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKCWV2ZW50IFRyYW5zZmVyRmxvd2VyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSk7IAoJZXZlbnQgQXBwcm92YWxGbG93ZXIoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKCglldmVudCBHaWZ0U2VuZCh1aW50IGluZGV4ZWQgaW5kZXgsIGFkZHJlc3MgaW5kZXhlZCByZWNlaXZlciwgYWRkcmVzcyBpbmRleGVkIGZyb20sIGJ5dGVzMzIgcmVnaXN0ZXJJRCwgc3RyaW5nIGxldHRlciwgYnl0ZXMxNiBkYXRlLAoJCUdpZnRUeXBlIGd0eXBlLAoJCWJ5dGVzMjQgbW9kZWwsCgkJdWludDE2IHllYXIsCgkJdWludDE2IG5vLAoJCXVpbnQgYW1vdW50CgkJKTsKCQkKCWZ1bmN0aW9uIFRydWVsb3ZlQ29yZSgpIHB1YmxpYyB7CgkJcGF1c2VkID0gdHJ1ZTsKCgkJY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7Cgl9CgoJZnVuY3Rpb24gc2V0TmV3QWRkcmVzcyhhZGRyZXNzIF92MkFkZHJlc3MpIGV4dGVybmFsIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICBuZXdDb250cmFjdEFkZHJlc3MgPSBfdjJBZGRyZXNzOwogICAgQ29udHJhY3RVcGdyYWRlKF92MkFkZHJlc3MpOwogIH0KCiAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgIHJlcXVpcmUoCiAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhkaWFtb25kQXVjdGlvbikgfHwKICAgICAgbXNnLnNlbmRlciA9PSBhZGRyZXNzKGZsb3dlckF1Y3Rpb24pCiAgICApOwogIH0KCWZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSh1aW50MjU2IGFtb3VudCkgZXh0ZXJuYWwgb25seUNGTyB7CgkJY2ZvQWRkcmVzcy50cmFuc2ZlcihhbW91bnQpOwoJfQp9Cgpjb250cmFjdCBDbG9ja0F1Y3Rpb25CYXNlIHsKCiAgICAvLyBSZXByZXNlbnRzIGFuIGF1Y3Rpb24gb24gYW4gTkZUCiAgICBzdHJ1Y3QgQXVjdGlvbiB7CiAgICAgICAgLy8gQ3VycmVudCBvd25lciBvZiBORlQKICAgICAgICBhZGRyZXNzIHNlbGxlcjsKICAgICAgICAvLyBQcmljZSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbgogICAgICAgIHVpbnQxMjggc3RhcnRpbmdQcmljZTsKICAgICAgICAvLyBQcmljZSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbgogICAgICAgIHVpbnQxMjggZW5kaW5nUHJpY2U7CiAgICAgICAgLy8gRHVyYXRpb24gKGluIHNlY29uZHMpIG9mIGF1Y3Rpb24KICAgICAgICB1aW50NjQgZHVyYXRpb247CiAgICAgICAgLy8gVGltZSB3aGVuIGF1Y3Rpb24gc3RhcnRlZAogICAgICAgIC8vIE5PVEU6IDAgaWYgdGhpcyBhdWN0aW9uIGhhcyBiZWVuIGNvbmNsdWRlZAogICAgICAgIHVpbnQ2NCBzdGFydGVkQXQ7CiAgICB9CgogICAgLy8gUmVmZXJlbmNlIHRvIGNvbnRyYWN0IHRyYWNraW5nIE5GVCBvd25lcnNoaXAKICAgIEVSQzcyMSBwdWJsaWMgbm9uRnVuZ2libGVDb250cmFjdDsKCiAgICAvLyBDdXQgb3duZXIgdGFrZXMgb24gZWFjaCBhdWN0aW9uLCBtZWFzdXJlZCBpbiBiYXNpcyBwb2ludHMgKDEvMTAwIG9mIGEgcGVyY2VudCkuCiAgICAvLyBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUKICAgIHVpbnQyNTYgcHVibGljIG93bmVyQ3V0OwoKICAgIC8vIE1hcCBmcm9tIHRva2VuIElEIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmcgYXVjdGlvbi4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gQXVjdGlvbikgdG9rZW5JZFRvQXVjdGlvbjsKCiAgICBldmVudCBBdWN0aW9uQ3JlYXRlZCh1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCwgYWRkcmVzcyBpbmRleGVkIHNlbGxlciwgdWludDI1NiBzdGFydGluZ1ByaWNlLCB1aW50MjU2IGVuZGluZ1ByaWNlLCB1aW50MjU2IGR1cmF0aW9uKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkLCB1aW50MjU2IHRvdGFsUHJpY2UsIGFkZHJlc3Mgd2lubmVyKTsKICAgIGV2ZW50IEF1Y3Rpb25DYW5jZWxsZWQodWludDI1NiBpbmRleGVkIHRva2VuSWQpOwoKICAgIC8vLyBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgY2xhaW1hbnQgb3ducyB0aGUgdG9rZW4uCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCAtIEFkZHJlc3MgY2xhaW1pbmcgdG8gb3duIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB3aG9zZSBvd25lcnNoaXAgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAobm9uRnVuZ2libGVDb250cmFjdC5vd25lck9mKF90b2tlbklkKSA9PSBfY2xhaW1hbnQpOwogICAgfQoKICAgIC8vLyBAZGV2IEVzY3Jvd3MgdGhlIE5GVCwgYXNzaWduaW5nIG93bmVyc2hpcCB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIFRocm93cyBpZiB0aGUgZXNjcm93IGZhaWxzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgLSBDdXJyZW50IG93bmVyIGFkZHJlc3Mgb2YgdG9rZW4gdG8gZXNjcm93LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHdob3NlIGFwcHJvdmFsIHRvIHZlcmlmeS4KICAgIGZ1bmN0aW9uIF9lc2Nyb3coYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBpdCB3aWxsIHRocm93IGlmIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2ZlckZyb20oX293bmVyLCB0aGlzLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIGFuIE5GVCBvd25lZCBieSB0aGlzIGNvbnRyYWN0IHRvIGFub3RoZXIgYWRkcmVzcy4KICAgIC8vLyBSZXR1cm5zIHRydWUgaWYgdGhlIHRyYW5zZmVyIHN1Y2NlZWRzLgogICAgLy8vIEBwYXJhbSBfcmVjZWl2ZXIgLSBBZGRyZXNzIHRvIHRyYW5zZmVyIE5GVCB0by4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9yZWNlaXZlciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0LnRyYW5zZmVyKF9yZWNlaXZlciwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAZGV2IEFkZHMgYW4gYXVjdGlvbiB0byB0aGUgbGlzdCBvZiBvcGVuIGF1Y3Rpb25zLiBBbHNvIGZpcmVzIHRoZQogICAgLy8vICBBdWN0aW9uQ3JlYXRlZCBldmVudC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSB0b2tlbiB0byBiZSBwdXQgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2F1Y3Rpb24gQXVjdGlvbiB0byBhZGQuCiAgICBmdW5jdGlvbiBfYWRkQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBBdWN0aW9uIF9hdWN0aW9uKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gUmVxdWlyZSB0aGF0IGFsbCBhdWN0aW9ucyBoYXZlIGEgZHVyYXRpb24gb2YKICAgICAgICAvLyBhdCBsZWFzdCBvbmUgbWludXRlLiAoS2VlcHMgb3VyIG1hdGggZnJvbSBnZXR0aW5nIGhhaXJ5ISkKICAgICAgICByZXF1aXJlKF9hdWN0aW9uLmR1cmF0aW9uID49IDEgbWludXRlcyk7CgogICAgICAgIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdID0gX2F1Y3Rpb247CgogICAgICAgIEF1Y3Rpb25DcmVhdGVkKAogICAgICAgICAgICB1aW50MjU2KF90b2tlbklkKSwKICAgICAgICAgICAgX2F1Y3Rpb24uc2VsbGVyLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5kdXJhdGlvbikKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB1bmNvbmRpdGlvbmFsbHkuCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgcHJpY2UgYW5kIHRyYW5zZmVycyB3aW5uaW5ncy4KICAgIC8vLyBEb2VzIE5PVCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgdG9rZW4uCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CgogICAgICAgIC8vIEV4cGxpY2l0bHkgY2hlY2sgdGhhdCB0aGlzIGF1Y3Rpb24gaXMgY3VycmVudGx5IGxpdmUuCiAgICAgICAgLy8gKEJlY2F1c2Ugb2YgaG93IEV0aGVyZXVtIG1hcHBpbmdzIHdvcmssIHdlIGNhbid0IGp1c3QgY291bnQKICAgICAgICAvLyBvbiB0aGUgbG9va3VwIGFib3ZlIGZhaWxpbmcuIEFuIGludmFsaWQgX3Rva2VuSWQgd2lsbCBqdXN0CiAgICAgICAgLy8gcmV0dXJuIGFuIGF1Y3Rpb24gb2JqZWN0IHRoYXQgaXMgYWxsIHplcm9zLikKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGJpZCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGN1cnJlbnQgcHJpY2UKICAgICAgICB1aW50MjU2IHByaWNlID0gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgICAgICByZXF1aXJlKF9iaWRBbW91bnQgPj0gcHJpY2UpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzZWxsZXIgYmVmb3JlIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIC8vIGdldHMgZGVsZXRlZC4KICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwoKICAgICAgICAvLyBUaGUgYmlkIGlzIGdvb2QhIFJlbW92ZSB0aGUgYXVjdGlvbiBiZWZvcmUgc2VuZGluZyB0aGUgZmVlcwogICAgICAgIC8vIHRvIHRoZSBzZW5kZXIgc28gd2UgY2FuJ3QgaGF2ZSBhIHJlZW50cmFuY3kgYXR0YWNrLgogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgcHJvY2VlZHMgdG8gc2VsbGVyIChpZiB0aGVyZSBhcmUgYW55ISkKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYXVjdGlvbmVlcidzIGN1dC4KICAgICAgICAgICAgLy8gKE5PVEU6IF9jb21wdXRlQ3V0KCkgaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gYQogICAgICAgICAgICAvLyB2YWx1ZSA8PSBwcmljZSwgc28gdGhpcyBzdWJ0cmFjdGlvbiBjYW4ndCBnbyBuZWdhdGl2ZS4pCiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbmVlckN1dCA9IF9jb21wdXRlQ3V0KHByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gYXVjdGlvbmVlckN1dDsKCiAgICAgICAgICAgIC8vIE5PVEU6IERvaW5nIGEgdHJhbnNmZXIoKSBpbiB0aGUgbWlkZGxlIG9mIGEgY29tcGxleAogICAgICAgICAgICAvLyBtZXRob2QgbGlrZSB0aGlzIGlzIGdlbmVyYWxseSBkaXNjb3VyYWdlZCBiZWNhdXNlIG9mCiAgICAgICAgICAgIC8vIHJlZW50cmFuY3kgYXR0YWNrcyBhbmQgRG9TIGF0dGFja3MgaWYgdGhlIHNlbGxlciBpcwogICAgICAgICAgICAvLyBhIGNvbnRyYWN0IHdpdGggYW4gaW52YWxpZCBmYWxsYmFjayBmdW5jdGlvbi4gV2UgZXhwbGljaXRseQogICAgICAgICAgICAvLyBndWFyZCBhZ2FpbnN0IHJlZW50cmFuY3kgYXR0YWNrcyBieSByZW1vdmluZyB0aGUgYXVjdGlvbgogICAgICAgICAgICAvLyBiZWZvcmUgY2FsbGluZyB0cmFuc2ZlcigpLCBhbmQgdGhlIG9ubHkgdGhpbmcgdGhlIHNlbGxlcgogICAgICAgICAgICAvLyBjYW4gRG9TIGlzIHRoZSBzYWxlIG9mIHRoZWlyIG93biBhc3NldCEgKEFuZCBpZiBpdCdzIGFuCiAgICAgICAgICAgIC8vIGFjY2lkZW50LCB0aGV5IGNhbiBjYWxsIGNhbmNlbEF1Y3Rpb24oKS4gKQogICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgaW5jbHVkZWQgd2l0aCB0aGUgYmlkLiBJZiB0aGUgZXhjZXNzCiAgICAgICAgLy8gaXMgYW55dGhpbmcgd29ydGggd29ycnlpbmcgYWJvdXQsIHRyYW5zZmVyIGl0IGJhY2sgdG8gYmlkZGVyLgogICAgICAgIC8vIE5PVEU6IFdlIGNoZWNrZWQgYWJvdmUgdGhhdCB0aGUgYmlkIGFtb3VudCBpcyBncmVhdGVyIHRoYW4gb3IKICAgICAgICAvLyBlcXVhbCB0byB0aGUgcHJpY2Ugc28gdGhpcyBjYW5ub3QgdW5kZXJmbG93LgogICAgICAgIHVpbnQyNTYgYmlkRXhjZXNzID0gX2JpZEFtb3VudCAtIHByaWNlOwoKICAgICAgICAvLyBSZXR1cm4gdGhlIGZ1bmRzLiBTaW1pbGFyIHRvIHRoZSBwcmV2aW91cyB0cmFuc2ZlciwgdGhpcyBpcwogICAgICAgIC8vIG5vdCBzdXNjZXB0aWJsZSB0byBhIHJlLWVudHJ5IGF0dGFjayBiZWNhdXNlIHRoZSBhdWN0aW9uIGlzCiAgICAgICAgLy8gcmVtb3ZlZCBiZWZvcmUgYW55IHRyYW5zZmVycyBvY2N1ci4KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGJpZEV4Y2Vzcyk7CgogICAgICAgIC8vIFRlbGwgdGhlIHdvcmxkIQogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF90b2tlbklkLCBwcmljZSwgbXNnLnNlbmRlcik7CgogICAgICAgIHJldHVybiBwcmljZTsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmVzIGFuIGF1Y3Rpb24gZnJvbSB0aGUgbGlzdCBvZiBvcGVuIGF1Y3Rpb25zLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gX3JlbW92ZUF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIE5GVCBpcyBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiAtIEF1Y3Rpb24gdG8gY2hlY2suCiAgICBmdW5jdGlvbiBfaXNPbkF1Y3Rpb24oQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9hdWN0aW9uLnN0YXJ0ZWRBdCA+IDApOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgY3VycmVudCBwcmljZSBvZiBhbiBORlQgb24gYXVjdGlvbi4gQnJva2VuIGludG8gdHdvCiAgICAvLy8gIGZ1bmN0aW9ucyAodGhpcyBvbmUsIHRoYXQgY29tcHV0ZXMgdGhlIGR1cmF0aW9uIGZyb20gdGhlIGF1Y3Rpb24KICAgIC8vLyAgc3RydWN0dXJlLCBhbmQgdGhlIG90aGVyIHRoYXQgZG9lcyB0aGUgcHJpY2UgY29tcHV0YXRpb24pIHNvIHdlCiAgICAvLy8gIGNhbiBlYXNpbHkgdGVzdCB0aGF0IHRoZSBwcmljZSBjb21wdXRhdGlvbiB3b3JrcyBjb3JyZWN0bHkuCiAgICBmdW5jdGlvbiBfY3VycmVudFByaWNlKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHVpbnQyNTYgc2Vjb25kc1Bhc3NlZCA9IDA7CgogICAgICAgIC8vIEEgYml0IG9mIGluc3VyYW5jZSBhZ2FpbnN0IG5lZ2F0aXZlIHZhbHVlcyAob3Igd3JhcGFyb3VuZCkuCiAgICAgICAgLy8gUHJvYmFibHkgbm90IG5lY2Vzc2FyeSAoc2luY2UgRXRoZXJldW0gZ3Vhcm5hdGVlcyB0aGF0IHRoZQogICAgICAgIC8vIG5vdyB2YXJpYWJsZSBkb2Vzbid0IGV2ZXIgZ28gYmFja3dhcmRzKS4KICAgICAgICBpZiAobm93ID4gX2F1Y3Rpb24uc3RhcnRlZEF0KSB7CiAgICAgICAgICAgIHNlY29uZHNQYXNzZWQgPSBub3cgLSBfYXVjdGlvbi5zdGFydGVkQXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgICAgIF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4gRmFjdG9yZWQgb3V0CiAgICAvLy8gIGZyb20gX2N1cnJlbnRQcmljZSBzbyB3ZSBjYW4gcnVuIGV4dGVuc2l2ZSB1bml0IHRlc3RzLgogICAgLy8vICBXaGVuIHRlc3RpbmcsIG1ha2UgdGhpcyBmdW5jdGlvbiBwdWJsaWMgYW5kIHR1cm4gb24KICAgIC8vLyAgYEN1cnJlbnQgcHJpY2UgY29tcHV0YXRpb25gIHRlc3Qgc3VpdGUuCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgX3NlY29uZHNQYXNzZWQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgcHVibGljIGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgdGltZSAoYXQgNjQtYml0cykgYW5kIGN1cnJlbmN5IChhdCAxMjgtYml0cykuIF9kdXJhdGlvbiBpcwogICAgICAgIC8vICBhbHNvIGtub3duIHRvIGJlIG5vbi16ZXJvIChzZWUgdGhlIHJlcXVpcmUoKSBzdGF0ZW1lbnQgaW4KICAgICAgICAvLyAgX2FkZEF1Y3Rpb24oKSkKICAgICAgICBpZiAoX3NlY29uZHNQYXNzZWQgPj0gX2R1cmF0aW9uKSB7CiAgICAgICAgICAgIC8vIFdlJ3ZlIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgZHluYW1pYyBwcmljaW5nIHBvcnRpb24KICAgICAgICAgICAgLy8gb2YgdGhlIGF1Y3Rpb24sIGp1c3QgcmV0dXJuIHRoZSBlbmQgcHJpY2UuCiAgICAgICAgICAgIHJldHVybiBfZW5kaW5nUHJpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU3RhcnRpbmcgcHJpY2UgY2FuIGJlIGhpZ2hlciB0aGFuIGVuZGluZyBwcmljZSAoYW5kIG9mdGVuIGlzISksIHNvCiAgICAgICAgICAgIC8vIHRoaXMgZGVsdGEgY2FuIGJlIG5lZ2F0aXZlLgogICAgICAgICAgICBpbnQyNTYgdG90YWxQcmljZUNoYW5nZSA9IGludDI1NihfZW5kaW5nUHJpY2UpIC0gaW50MjU2KF9zdGFydGluZ1ByaWNlKTsKCiAgICAgICAgICAgIC8vIFRoaXMgbXVsdGlwbGljYXRpb24gY2FuJ3Qgb3ZlcmZsb3csIF9zZWNvbmRzUGFzc2VkIHdpbGwgZWFzaWx5IGZpdCB3aXRoaW4KICAgICAgICAgICAgLy8gNjQtYml0cywgYW5kIHRvdGFsUHJpY2VDaGFuZ2Ugd2lsbCBlYXNpbHkgZml0IHdpdGhpbiAxMjgtYml0cywgdGhlaXIgcHJvZHVjdAogICAgICAgICAgICAvLyB3aWxsIGFsd2F5cyBmaXQgd2l0aGluIDI1Ni1iaXRzLgogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlQ2hhbmdlID0gdG90YWxQcmljZUNoYW5nZSAqIGludDI1Nihfc2Vjb25kc1Bhc3NlZCkgLyBpbnQyNTYoX2R1cmF0aW9uKTsKCiAgICAgICAgICAgIC8vIGN1cnJlbnRQcmljZUNoYW5nZSBjYW4gYmUgbmVnYXRpdmUsIGJ1dCBpZiBzbywgd2lsbCBoYXZlIGEgbWFnbml0dWRlCiAgICAgICAgICAgIC8vIGxlc3MgdGhhdCBfc3RhcnRpbmdQcmljZS4gVGh1cywgdGhpcyByZXN1bHQgd2lsbCBhbHdheXMgZW5kIHVwIHBvc2l0aXZlLgogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlID0gaW50MjU2KF9zdGFydGluZ1ByaWNlKSArIGN1cnJlbnRQcmljZUNoYW5nZTsKCiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KGN1cnJlbnRQcmljZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIG93bmVyJ3MgY3V0IG9mIGEgc2FsZS4KICAgIC8vLyBAcGFyYW0gX3ByaWNlIC0gU2FsZSBwcmljZSBvZiBORlQuCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1dCh1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyAgYWxsIG9mIG91ciBlbnRyeSBmdW5jdGlvbnMgY2FyZWZ1bGx5IGNhcCB0aGUgbWF4aW11bSB2YWx1ZXMgZm9yCiAgICAgICAgLy8gIGN1cnJlbmN5IChhdCAxMjgtYml0cyksIGFuZCBvd25lckN1dCA8PSAxMDAwMCAoc2VlIHRoZSByZXF1aXJlKCkKICAgICAgICAvLyAgc3RhdGVtZW50IGluIHRoZSBDbG9ja0F1Y3Rpb24gY29uc3RydWN0b3IpLiBUaGUgcmVzdWx0IG9mIHRoaXMKICAgICAgICAvLyAgZnVuY3Rpb24gaXMgYWx3YXlzIGd1YXJhbnRlZWQgdG8gYmUgPD0gX3ByaWNlLgogICAgICAgIHJldHVybiBfcHJpY2UgKiBvd25lckN1dCAvIDEwMDAwOwogICAgfQoKfQoKCgpjb250cmFjdCBDbG9ja0F1Y3Rpb24gaXMgUGF1c2FibGUsIENsb2NrQXVjdGlvbkJhc2UgewoKICAgIC8vLyBAZGV2IFRoZSBFUkMtMTY1IGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQy03MjEuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NQogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0gYnl0ZXM0KDB4OWEyMDQ4M2QpOwoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yIGNyZWF0ZXMgYSByZWZlcmVuY2UgdG8gdGhlIE5GVCBvd25lcnNoaXAgY29udHJhY3QKICAgIC8vLyAgYW5kIHZlcmlmaWVzIHRoZSBvd25lciBjdXQgaXMgaW4gdGhlIHZhbGlkIHJhbmdlLgogICAgLy8vIEBwYXJhbSBfbmZ0QWRkcmVzcyAtIGFkZHJlc3Mgb2YgYSBkZXBsb3llZCBjb250cmFjdCBpbXBsZW1lbnRpbmcKICAgIC8vLyAgdGhlIE5vbmZ1bmdpYmxlIEludGVyZmFjZS4KICAgIC8vLyBAcGFyYW0gX2N1dCAtIHBlcmNlbnQgY3V0IHRoZSBvd25lciB0YWtlcyBvbiBlYWNoIGF1Y3Rpb24sIG11c3QgYmUKICAgIC8vLyAgYmV0d2VlbiAwLTEwLDAwMC4KICAgIGZ1bmN0aW9uIENsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyZXNzLCB1aW50MjU2IF9jdXQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfY3V0IDw9IDEwMDAwKTsKICAgICAgICBvd25lckN1dCA9IF9jdXQ7CgogICAgICAgIEVSQzcyMSBjYW5kaWRhdGVDb250cmFjdCA9IEVSQzcyMShfbmZ0QWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5zdXBwb3J0c0ludGVyZmFjZShJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxKSk7CiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdCA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IFJlbW92ZSBhbGwgRXRoZXIgZnJvbSB0aGUgY29udHJhY3QsIHdoaWNoIGlzIHRoZSBvd25lcidzIGN1dHMKICAgIC8vLyAgYXMgd2VsbCBhcyBhbnkgRXRoZXIgc2VudCBkaXJlY3RseSB0byB0aGUgY29udHJhY3QgYWRkcmVzcy4KICAgIC8vLyAgQWx3YXlzIHRyYW5zZmVycyB0byB0aGUgTkZUIGNvbnRyYWN0LCBidXQgY2FuIGJlIGNhbGxlZCBlaXRoZXIgYnkKICAgIC8vLyAgdGhlIG93bmVyIG9yIHRoZSBORlQgY29udHJhY3QuCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JhbGFuY2UoKSBleHRlcm5hbCB7CiAgICAgICAgYWRkcmVzcyBuZnRBZGRyZXNzID0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KTsKCiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBvd25lciB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IG5mdEFkZHJlc3MKICAgICAgICApOwogICAgICAgIC8vIFdlIGFyZSB1c2luZyB0aGlzIGJvb2xlYW4gbWV0aG9kIHRvIG1ha2Ugc3VyZSB0aGF0IGV2ZW4gaWYgb25lIGZhaWxzIGl0IHdpbGwgc3RpbGwgd29yawogICAgICAgIC8vIGJvb2wgcmVzID0gbmZ0QWRkcmVzcy5zZW5kKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgbmZ0QWRkcmVzcy5zZW5kKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhbmQgYmVnaW5zIGEgbmV3IGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIHRpbWUgdG8gbW92ZSBiZXR3ZWVuIHN0YXJ0aW5nCiAgICAvLy8gIHByaWNlIGFuZCBlbmRpbmcgcHJpY2UgKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBTYW5pdHkgY2hlY2sgdGhhdCBubyBpbnB1dHMgb3ZlcmZsb3cgaG93IG1hbnkgYml0cyB3ZSd2ZSBhbGxvY2F0ZWQKICAgICAgICAvLyB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIF9lc2Nyb3cobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgICAgIEF1Y3Rpb24gbWVtb3J5IGF1Y3Rpb24gPSBBdWN0aW9uKAogICAgICAgICAgICBfc2VsbGVyLAogICAgICAgICAgICB1aW50MTI4KF9zdGFydGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDEyOChfZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50NjQoX2R1cmF0aW9uKSwKICAgICAgICAgICAgdWludDY0KG5vdykKICAgICAgICApOwogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvLy8gQGRldiBCaWRzIG9uIGFuIG9wZW4gYXVjdGlvbiwgY29tcGxldGluZyB0aGUgYXVjdGlvbiBhbmQgdHJhbnNmZXJyaW5nCiAgICAvLy8gIG93bmVyc2hpcCBvZiB0aGUgTkZUIGlmIGVub3VnaCBFdGhlciBpcyBzdXBwbGllZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBiaWQgb24uCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gX2JpZCB3aWxsIHRocm93IGlmIHRoZSBiaWQgb3IgZnVuZHMgdHJhbnNmZXIgZmFpbHMKICAgICAgICBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHRoYXQgaGFzbid0IGJlZW4gd29uIHlldC4KICAgIC8vLyAgUmV0dXJucyB0aGUgTkZUIHRvIG9yaWdpbmFsIG93bmVyLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBhIHN0YXRlLW1vZGlmeWluZyBmdW5jdGlvbiB0aGF0IGNhbgogICAgLy8vICBiZSBjYWxsZWQgd2hpbGUgdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiBvbiBhdWN0aW9uCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxsZXIpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBzZWxsZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICAvLy8gIE9ubHkgdGhlIG93bmVyIG1heSBkbyB0aGlzLCBhbmQgTkZUcyBhcmUgcmV0dXJuZWQgdG8KICAgIC8vLyAgdGhlIHNlbGxlci4gVGhpcyBzaG91bGQgb25seSBiZSB1c2VkIGluIGVtZXJnZW5jaWVzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSBORlQgb24gYXVjdGlvbiB0byBjYW5jZWwuCiAgICBmdW5jdGlvbiBjYW5jZWxBdWN0aW9uV2hlblBhdXNlZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIHdoZW5QYXVzZWQKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uLnNlbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBhdWN0aW9uIGluZm8gZm9yIGFuIE5GVCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMKICAgICgKICAgICAgICBhZGRyZXNzIHNlbGxlciwKICAgICAgICB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBlbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGR1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgc3RhcnRlZEF0CiAgICApIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyB0aGUgY3VycmVudCBwcmljZSBvZiBhbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSB0b2tlbiBwcmljZSB3ZSBhcmUgY2hlY2tpbmcuCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiBfY3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgfQoKfQoKY29udHJhY3QgRGlhbW9uZEF1Y3Rpb24gaXMgQ2xvY2tBdWN0aW9uIHsKCiAgICAvLyBAZGV2IFNhbml0eSBjaGVjayB0aGF0IGFsbG93cyB1cyB0byBlbnN1cmUgdGhhdCB3ZSBhcmUgcG9pbnRpbmcgdG8gdGhlCiAgICAvLyAgcmlnaHQgYXVjdGlvbiBpbiBvdXIgc2V0U2FsZUF1Y3Rpb25BZGRyZXNzKCkgY2FsbC4KICAgIGJvb2wgcHVibGljIGlzRGlhbW9uZEF1Y3Rpb24gPSB0cnVlOwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsIHVpbnQyNTYgZW5kaW5nUHJpY2UsIHVpbnQyNTYgZHVyYXRpb24pOwogICAgZXZlbnQgQXVjdGlvblN1Y2Nlc3NmdWwodWludDI1NiBpbmRleGVkIHRva2VuSWQsIHVpbnQyNTYgdG90YWxQcmljZSwgYWRkcmVzcyB3aW5uZXIpOwogICAgZXZlbnQgQXVjdGlvbkNhbmNlbGxlZCh1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCk7CiAgICAKICAgIC8vIERlbGVnYXRlIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBEaWFtb25kQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyKSBwdWJsaWMKICAgICAgICBDbG9ja0F1Y3Rpb24oX25mdEFkZHIsIDApIHt9CgogICAgLy8vIEBkZXYgQ3JlYXRlcyBhbmQgYmVnaW5zIGEgbmV3IGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYXVjdGlvbiwgc2VuZGVyIG11c3QgYmUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zdGFydGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBiZWdpbm5pbmcgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIC0gTGVuZ3RoIG9mIGF1Y3Rpb24gKGluIHNlY29uZHMpLgogICAgLy8vIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICBmdW5jdGlvbiBjcmVhdGVBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIC8vIFNhbml0eSBjaGVjayB0aGF0IG5vIGlucHV0cyBvdmVyZmxvdyBob3cgbWFueSBiaXRzIHdlJ3ZlIGFsbG9jYXRlZAogICAgICAgIC8vIHRvIHN0b3JlIHRoZW0gaW4gdGhlIGF1Y3Rpb24gc3RydWN0LgogICAgICAgIHJlcXVpcmUoX3N0YXJ0aW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9zdGFydGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2VuZGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kaW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZHVyYXRpb24gPT0gdWludDI1Nih1aW50NjQoX2R1cmF0aW9uKSkpOwoKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KSk7CiAgICAgICAgX2VzY3Jvdyhfc2VsbGVyLCBfdG9rZW5JZCk7CiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MTI4KF9lbmRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChfZHVyYXRpb24pLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgX2FkZEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24pOwogICAgfQoKICAgIC8vLyBAZGV2IFVwZGF0ZXMgbGFzdFNhbGVQcmljZSBpZiBzZWxsZXIgaXMgdGhlIG5mdCBjb250cmFjdAogICAgLy8vIE90aGVyd2lzZSwgd29ya3MgdGhlIHNhbWUgYXMgZGVmYXVsdCBiaWQgbWV0aG9kLgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgLy8gX2JpZCB2ZXJpZmllcyB0b2tlbiBJRCBzaXplCiAgICAgICAgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0uc2VsbGVyOwogICAgICAgIF9iaWQoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIH0KCn0KCmNvbnRyYWN0IEZsb3dlckF1Y3Rpb24gaXMgUGF1c2FibGUgewogICAgc3RydWN0IEF1Y3Rpb24gewogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwogICAgICAgIHVpbnQyNTYgYW1vdW50OwogICAgICAgIHVpbnQxMjggc3RhcnRpbmdQcmljZTsKICAgICAgICB1aW50MTI4IGVuZGluZ1ByaWNlOwogICAgICAgIHVpbnQ2NCBkdXJhdGlvbjsKICAgICAgICB1aW50NjQgc3RhcnRlZEF0OwogICAgfQoKICAgIEVJUDIwSW50ZXJmYWNlIHB1YmxpYyB0b2tlbkNvbnRyYWN0OwoKICAgIHVpbnQyNTYgcHVibGljIG93bmVyQ3V0OwoKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gQXVjdGlvbikgYXVjdGlvbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHNlbGxlclRvQXVjdGlvbjsKICAgIHVpbnQyNTYgcHVibGljIGN1cnJlbnRBdWN0aW9uSWQ7CgogICAgZXZlbnQgQXVjdGlvbkNyZWF0ZWQodWludDI1NiBpbmRleGVkIGF1Y3Rpb25JZCwgYWRkcmVzcyBpbmRleGVkIHNlbGxlciwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwgdWludDI1NiBlbmRpbmdQcmljZSwgdWludDI1NiBkdXJhdGlvbik7CiAgICBldmVudCBBdWN0aW9uU3VjY2Vzc2Z1bCh1aW50MjU2IGluZGV4ZWQgYXVjdGlvbklkLCB1aW50MjU2IGFtb3VudCwgYWRkcmVzcyB3aW5uZXIpOwogICAgZXZlbnQgQXVjdGlvblNvbGRPdXQodWludDI1NiBpbmRleGVkIGF1Y3Rpb25JZCk7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgaW5kZXhlZCBhdWN0aW9uSWQpOwoKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRUlQMjAgPSBieXRlczQoMHg5ODQ3NDEwOSk7CgogICAgYm9vbCBwdWJsaWMgaXNGbG93ZXJBdWN0aW9uID0gdHJ1ZTsKCiAgICBmdW5jdGlvbiBGbG93ZXJBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgb3duZXJDdXQgPSAwOwoKICAgICAgICBFSVAyMEludGVyZmFjZSBjYW5kaWRhdGVDb250cmFjdCA9IEVJUDIwSW50ZXJmYWNlKF9uZnRBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LnN1cHBvcnRzRUlQMjBJbnRlcmZhY2UoSW50ZXJmYWNlU2lnbmF0dXJlX0VJUDIwKSk7CiAgICAgICAgdG9rZW5Db250cmFjdCA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfYW1vdW50LAogICAgICAgIHVpbnQyNTYgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sCiAgICAgICAgYWRkcmVzcyBfc2VsbGVyCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQyNTYodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModG9rZW5Db250cmFjdCkpOwogICAgICAgIF9lc2Nyb3coX3NlbGxlciwgX2Ftb3VudCk7CiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICAgIF9hbW91bnQsCiAgICAgICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MTI4KF9lbmRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChfZHVyYXRpb24pLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgX2FkZEF1Y3Rpb24oYXVjdGlvbik7CiAgICB9CgogICAgZnVuY3Rpb24gYmlkKHVpbnQyNTYgX2F1Y3Rpb25JZCwgdWludDI1NiBfYW1vdW50KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgewogICAgICAgIF9iaWQoX2F1Y3Rpb25JZCwgX2Ftb3VudCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICB9CgoKCgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgewogICAgICAgIGFkZHJlc3MgbmZ0QWRkcmVzcyA9IGFkZHJlc3ModG9rZW5Db250cmFjdCk7CgogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gb3duZXIgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBuZnRBZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBuZnRBZGRyZXNzLnNlbmQodGhpcy5iYWxhbmNlKTsKICAgIH0KCgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50MjU2IF9hdWN0aW9uSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGF1Y3Rpb25zW19hdWN0aW9uSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxsZXIpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF9hdWN0aW9uSWQsIHNlbGxlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbldoZW5QYXVzZWQodWludDI1NiBfYXVjdGlvbklkKQogICAgICAgIHdoZW5QYXVzZWQKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gYXVjdGlvbnNbX2F1Y3Rpb25JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIF9jYW5jZWxBdWN0aW9uKF9hdWN0aW9uSWQsIGF1Y3Rpb24uc2VsbGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBdWN0aW9uKHVpbnQyNTYgX2F1Y3Rpb25JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zCiAgICAoCiAgICAgICAgYWRkcmVzcyBzZWxsZXIsCiAgICAgICAgdWludDI1NiBhbW91bnQsCiAgICAgICAgdWludDI1NiBzdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgZW5kaW5nUHJpY2UsCiAgICAgICAgdWludDI1NiBkdXJhdGlvbiwKICAgICAgICB1aW50MjU2IHN0YXJ0ZWRBdAogICAgKSB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBhdWN0aW9uc1tfYXVjdGlvbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgYXVjdGlvbi5zZWxsZXIsCiAgICAgICAgICAgIGF1Y3Rpb24uYW1vdW50LAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIGF1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIGF1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgICAgIGF1Y3Rpb24uc3RhcnRlZEF0CiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludDI1NiBfYXVjdGlvbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSBhdWN0aW9uc1tfYXVjdGlvbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgcmV0dXJuIF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICB9CgoKCgoKICAgIGZ1bmN0aW9uIF9lc2Nyb3coYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2Ftb3VudCkgaW50ZXJuYWwgewogICAgICAgIHRva2VuQ29udHJhY3QudHJhbnNmZXJGcm9tRmxvd2VyKF9vd25lciwgdGhpcywgX2Ftb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF9hbW91bnQpIGludGVybmFsIHsKICAgICAgICB0b2tlbkNvbnRyYWN0LnRyYW5zZmVyRmxvd2VyKF9yZWNlaXZlciwgX2Ftb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2FkZEF1Y3Rpb24oQXVjdGlvbiBfYXVjdGlvbikgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKCiAgICAgICAgY3VycmVudEF1Y3Rpb25JZCsrOwogICAgICAgIGF1Y3Rpb25zW2N1cnJlbnRBdWN0aW9uSWRdID0gX2F1Y3Rpb247CiAgICAgICAgc2VsbGVyVG9BdWN0aW9uW19hdWN0aW9uLnNlbGxlcl0gPSBjdXJyZW50QXVjdGlvbklkOwoKICAgICAgICBBdWN0aW9uQ3JlYXRlZCgKICAgICAgICAgICAgY3VycmVudEF1Y3Rpb25JZCwKICAgICAgICAgICAgX2F1Y3Rpb24uc2VsbGVyLAogICAgICAgICAgICBfYXVjdGlvbi5hbW91bnQsCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uZW5kaW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmR1cmF0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gX2NhbmNlbEF1Y3Rpb24odWludDI1NiBfYXVjdGlvbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGF1Y3Rpb25zW19hdWN0aW9uSWRdLmFtb3VudDsKICAgICAgICBkZWxldGUgc2VsbGVyVG9BdWN0aW9uW2F1Y3Rpb25zW19hdWN0aW9uSWRdLnNlbGxlcl07CiAgICAgICAgZGVsZXRlIGF1Y3Rpb25zW19hdWN0aW9uSWRdOwogICAgICAgIF90cmFuc2Zlcihfc2VsbGVyLCBhbW91bnQpOwogICAgICAgIEF1Y3Rpb25DYW5jZWxsZWQoX2F1Y3Rpb25JZCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2JpZCh1aW50MjU2IF9hdWN0aW9uSWQsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfYmlkQW1vdW50KQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IGF1Y3Rpb25zW19hdWN0aW9uSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKICAgICAgICB1aW50MjU2IHByaWNlID0gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgICAgICB1aW50MjU2IHRvdGFsUHJpY2UgPSBwcmljZSAqIF9hbW91bnQ7CiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHRvdGFsUHJpY2UpOwogICAgICAgIGF1Y3Rpb24uYW1vdW50IC09IF9hbW91bnQ7CgogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CgogICAgICAgIGlmICh0b3RhbFByaWNlID4gMCkgewogICAgICAgICAgICB1aW50MjU2IGF1Y3Rpb25lZXJDdXQgPSBfY29tcHV0ZUN1dCh0b3RhbFByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHRvdGFsUHJpY2UgLSBhdWN0aW9uZWVyQ3V0OwogICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgIH0KICAgICAgICB1aW50MjU2IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSB0b3RhbFByaWNlOwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYmlkRXhjZXNzKTsKCiAgICAgICAgaWYgKGF1Y3Rpb24uYW1vdW50ID09IDApIHsKICAgICAgICAgICAgQXVjdGlvblNvbGRPdXQoX2F1Y3Rpb25JZCk7CiAgICAgICAgICAgIGRlbGV0ZSBhdWN0aW9uc1tfYXVjdGlvbklkXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBBdWN0aW9uU3VjY2Vzc2Z1bChfYXVjdGlvbklkLCBfYW1vdW50LCBtc2cuc2VuZGVyKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3RhbFByaWNlOwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc09uQXVjdGlvbihBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX2F1Y3Rpb24uc3RhcnRlZEF0ID4gMCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2N1cnJlbnRQcmljZShBdWN0aW9uIHN0b3JhZ2UgX2F1Y3Rpb24pCiAgICAgICAgaW50ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IHNlY29uZHNQYXNzZWQgPSAwOwoKICAgICAgICBpZiAobm93ID4gX2F1Y3Rpb24uc3RhcnRlZEF0KSB7CiAgICAgICAgICAgIHNlY29uZHNQYXNzZWQgPSBub3cgLSBfYXVjdGlvbi5zdGFydGVkQXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgICAgIF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZAogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgdWludDI1NiBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9zZWNvbmRzUGFzc2VkCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBpZiAoX3NlY29uZHNQYXNzZWQgPj0gX2R1cmF0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiBfZW5kaW5nUHJpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW50MjU2IHRvdGFsUHJpY2VDaGFuZ2UgPSBpbnQyNTYoX2VuZGluZ1ByaWNlKSAtIGludDI1Nihfc3RhcnRpbmdQcmljZSk7CiAgICAgICAgICAgIGludDI1NiBjdXJyZW50UHJpY2VDaGFuZ2UgPSB0b3RhbFByaWNlQ2hhbmdlICogaW50MjU2KF9zZWNvbmRzUGFzc2VkKSAvIGludDI1NihfZHVyYXRpb24pOwogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlID0gaW50MjU2KF9zdGFydGluZ1ByaWNlKSArIGN1cnJlbnRQcmljZUNoYW5nZTsKICAgICAgICAgICAgcmV0dXJuIHVpbnQyNTYoY3VycmVudFByaWNlKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX2NvbXB1dGVDdXQodWludDI1NiBfcHJpY2UpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBfcHJpY2UgKiBvd25lckN1dCAvIDEwMDAwOwogICAgfQoKfQ=='.
	

]
