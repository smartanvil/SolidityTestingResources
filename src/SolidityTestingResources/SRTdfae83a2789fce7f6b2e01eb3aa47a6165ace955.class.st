Class {
	#name : #SRTdfae83a2789fce7f6b2e01eb3aa47a6165ace955,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTdfae83a2789fce7f6b2e01eb3aa47a6165ace955 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CmxpYnJhcnkgU2FmZU1hdGggeyAgICAKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIHJldHVybiBjOwogIH0gCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0gCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9ICAKfQoKY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgYm9vbCBwdWJsaWMgdGVhbVN0YWtlc0Zyb3plbiA9IHRydWU7CiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIAogIGZ1bmN0aW9uIEJhc2ljVG9rZW4oKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KICAKICBtb2RpZmllciBub3RGcm96ZW4oKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgIT0gb3duZXIgfHwgKG1zZy5zZW5kZXIgPT0gb3duZXIgJiYgIXRlYW1TdGFrZXNGcm96ZW4pKTsKICAgIF87CiAgfQoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBub3RGcm96ZW4gcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CiAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICogQGRldiBHZXRzIHRoZSBiYWxhbmNlIG9mIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdG8gcXVlcnkgdGhlIHRoZSBiYWxhbmNlIG9mLgogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQp9Cgpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG5vdEZyb3plbiByZXR1cm5zIChib29sKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIGNoZWNrIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICogQHBhcmFtIF9vd25lciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIG93bnMgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfc3BlbmRlciBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEByZXR1cm4gQSB1aW50MjU2IHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWxhYmxlIGZvciB0aGUgc3BlbmRlci4KICAgKi8KICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwgKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2FkZGVkVmFsdWUpIHB1YmxpYyBub3RGcm96ZW4gcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Cgpjb250cmFjdCBSSSBpcyBTdGFuZGFyZFRva2VuIHsKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiRnVuZGFyaWEgU3Rha2UiOwogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlJJIjsKICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAwOwp9Cgpjb250cmFjdCBTYWxlIGlzIFJJIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCi8qKioqKioqKioqIAogKiBDb21tb24gKgogKioqKioqKioqKi8KCiAgICAvLyBUSElTIElTIEtFWSBWQVJJQUJMRSBBTkQgREVGSU5FRCBBQ0NPUkRJTkcgVE8gVkFMVUUgT0YgUExBTk5FRCBDT1NUUyBPTiBUSEUgUEFHRSBodHRwczovL2J1c2luZXNzLmZ1bmRhcmlhLmNvbQogICAgdWludCBwdWJsaWMgcG9vbENhcFVTRCA9IDEwMDI3NTA7CiAgICAvLyBVU0QgcGVyIDEgZXRoZXIsIGFkZGVkIDEwJSBhcHJveGltYXRlbGx5IHRvIHNlY3VyZSBmcm9tIHdyb25nIGxvdyBwcmljZS4gV2UgbmVlZCBhZGQgMTAlIG9mIFN0YWtlcyB0byBzdXBwbHkgdG8gY292ZXIgc3VjaCBwcmljZS4KICAgIHVpbnQgcHVibGljIHVzZFBlckV0aGVyID0gMzYwOwogICAgdWludCBwdWJsaWMgc3VwcGx5Q2FwOyAvLyBDdXJyZW50IHRvdGFsIHN1cHBseSBjYXAgYWNjb3JkaW5nIHRvIGxhc3RTdGFrZVByaWNlVVNDZW50cyBhbmQgcG9vbENhcFVTRCAKICAgIHVpbnQgcHVibGljIGJ1c2luZXNzUGxhbm5lZFBlcmlvZER1cmF0aW9uID0gMzY1IGRheXM7IC8vIHRvdGFsIHBlcmlvZCBwbGFubmVkIGZvciBidXNpbmVzcyBhY3Rpdml0eQogICAgdWludCBwdWJsaWMgYnVzaW5lc3NQbGFubmVkUGVyaW9kRW5kVGltZXN0YW1wOwogICAgdWludCBwdWJsaWMgdGVhbUNhcDsgLy8gdGVhbSBTdGFrZXMgY2FwYWNpdHkKICAgIHVpbnQ4IHB1YmxpYyB0ZWFtU2hhcmUgPSA0NTsgLy8gc2hhcmUgZm9yIHRlYW0KICAgIHVpbnQgcHVibGljIGRpc3RyaWJ1dGVkVGVhbVN0YWtlczsgLy8gZGlzdHJpYnV0ZWQgU3Rha2VzIHRvIHRlYW0gICAKICAgIHVpbnQgcHVibGljIGNvbnRyYWN0Q3JlYXRlZFRpbWVzdGFtcDsgLy8gd2hlbiB0aGlzIGNvbnRyYWN0IHdhcyBjcmVhdGVkICAKICAgIGFkZHJlc3MgcHVibGljIHBvb2wgPSAweDMzNUM0MTVENzg5N0IyY2IyYTI1NjIwNzk0MDBGYjZlRGY1NGE3YWI7IC8vIGluaXRpYWwgcG9vbCB3YWxsZXQgYWRkcmVzcyAgICAKCi8qKioqKioqKioqIAogKiBCb3VudHkgKgogKioqKioqKioqKi8KIAogICAgdWludCBwdWJsaWMgZGlzdHJpYnV0ZWRCb3VudHlTdGFrZXM7IC8vIGJvdW50eSBhZHZpc29ycyBTdGFrZXMgZGlzdHJpYnV0ZWQgdG90YWwgICAgCiAgICB1aW50IHB1YmxpYyBib3VudHlDYXA7IC8vIGJvdW50eSBhZHZpc29ycyBTdGFrZXMgY2FwYWNpdHkgICAgCiAgICB1aW50OCBwdWJsaWMgYm91bnR5U2hhcmUgPSA3OyAvLyBzaGFyZSBmb3IgYm91bnR5ICAgIAogICAgCi8qKioqKioqKioqKiAKICogU2FsZSAqCiAqKioqKioqKioqKi8KICAgIC8vIGRhdGEgdG8gc3RvcmUgaW52ZXN0ZWQgd2VpIHZhbHVlICYgU3Rha2VzIGZvciBJbnZlc3RvcgogICAgc3RydWN0IHNhbGVEYXRhIHsKICAgICAgdWludCBzdGFrZXM7IC8vIGhvdyBtYW55IFN0YWtlcyB3aGVyZSByZWNpZXZlZCBieSB0aGlzIEludmVzdG9yIHRvdGFsCiAgICAgIHVpbnQgaW52ZXN0ZWQ7IC8vIGhvdyBtdWNoIHdlaSB0aGlzIEludmVzdG9yIGludmVzdGVkIHRvdGFsCiAgICAgIHVpbnQgYm9udXNTdGFrZXM7IC8vIGhvdyBtYW55IGJvbnVzIFN0YWtlcyB3aGVyZSByZWNpZXZlZCBieSB0aGlzIEludmVzdG9yCiAgICAgIHVpbnQgZ3VpZGVSZXdhcmQ7IC8vIEludmVzdG1lbnQgR3VpZGUgcmV3YXJkIGFtb3VudAogICAgICBhZGRyZXNzIGd1aWRlOyAvLyBhZGRyZXNzIG9mIEludmVzdG1lbnQgR3VpZGUKICAgIH0KICAgIG1hcHBpbmcgKGFkZHJlc3M9PnNhbGVEYXRhKSBwdWJsaWMgc2FsZVN0YXQ7IC8vIGludmVzdGVkIHZhbHVlICsgU3Rha2VzIGRhdGEgZm9yIGV2ZXJ5IEludmVzdG9yICAgICAgICAKICAgIHVpbnQgcHVibGljIHNhbGVTdGFydFRpbWVzdGFtcCA9IDE1MTE1NDY0MDA7IC8vIDE1MTE1NDY0MDAgcmVndWxhciBTdGFrZXMgc2FsZSBzdGFydCBkYXRlICAgICAgICAgICAgCiAgICB1aW50IHB1YmxpYyBzYWxlRW5kVGltZXN0YW1wID0gMTUxMzk2NTYwMDsgLy8gMTUxMzk2NTYwMAogICAgdWludCBwdWJsaWMgZGlzdHJpYnV0ZWRTYWxlU3Rha2VzOyAvLyBkaXN0cmlidXRlZCBzdGFrZXMgdG8gYWxsIEludmVzdG9ycwogICAgdWludCBwdWJsaWMgdG90YWxJbnZlc3RlZDsgLy9ob3cgbWFueSBpbnZlc3RlZCB0b3RhbAogICAgdWludCBwdWJsaWMgdG90YWxXaXRoZHJhd247IC8vaG93IG1hbnkgd2l0aGRyYXduIHRvdGFsCiAgICB1aW50IHB1YmxpYyBzYWxlQ2FwOyAvLyByZWd1bGFyIHNhbGUgU3Rha2VzIGNhcGFjaXR5ICAgCiAgICB1aW50OCBwdWJsaWMgc2FsZVNoYXJlID0gNDU7IC8vIHNoYXJlIGZvciByZWd1bGFyIHNhbGUKICAgIHVpbnQgcHVibGljIGxhc3RTdGFrZVByaWNlVVNDZW50czsgLy8gU3Rha2UgcHJpY2UgaW4gVS5TLiBjZW50cyBpcyBkZXRlcm1pbmVkIGFjY29yZGluZyB0byBjdXJyZW50IHRpbWVzdGFtcCAodGhlIGZ1cnRoZXIgLSB0aGUgaGlnaGVyIHByaWNlKSAgICAKICAgIHVpbnRbXSBwdWJsaWMgdGFyZ2V0UHJpY2U7ICAgIAogICAgYm9vbCBwdWJsaWMgcHJpY2VJc0Zyb3plbiA9IGZhbHNlOyAvLyBzdG9wIGluY3JlYXNpbmcgdGhlIHByaWNlIHRlbXBvcmFyeSAoaW4gY2FzZSBvZiBsb3cgZGVtYW5kLiBDYW4gYmUgY2FsbGVkIG9ubHkgYWZ0ZXIgc2FsZUVuZFRpbWVzdGFtcCkgICAgICAgCiAgICAKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAKICogQm9udXMgU3Rha2VzICYgSW52ZXN0bWVudCBHdWlkZXMgKgogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLyAgICAKICAgIC8vIGRhdGEgdG8gc3RvcmUgSW52ZXN0bWVudCBHdWlkZSByZXdhcmQKICAgIHN0cnVjdCBndWlkZURhdGEgewogICAgICBib29sIHJlZ2lzdGVyZWQ7IC8vIGlzIHRoaXMgSW52ZXN0bWVudCBHdWlkZSByZWdpc3RlcmVkCiAgICAgIHVpbnQgYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQ7IC8vIGhvdyBtYW55IHJld2FyZCB3ZWkgYXJlIHBvdGVudGlhbGx5IGF2YWlsYWJsZQogICAgICB1aW50IHdpdGhkcmF3blJld2FyZDsgLy8gaG93IG11Y2ggcmV3YXJkIHdlaSB3aGVyZSB3aXRoZHJhd24gYnkgdGhpcyBJbnZlc3RtZW50IEd1aWRlIGFscmVhZHkKICAgIH0KICAgIG1hcHBpbmcgKGFkZHJlc3M9Pmd1aWRlRGF0YSkgcHVibGljIGd1aWRlc1N0YXQ7IC8vIG1hcHBpbmcgb2YgSW52ZXN0bWVudCBHdWlkZXMgZGF0YXMgICAgCiAgICB1aW50IHB1YmxpYyBib251c0NhcDsgLy8gbWF4IGFtb3VudCBvZiBib251cyBTdGFrZXMgYXZhaWxhYmUKICAgIHVpbnQgcHVibGljIGRpc3RyaWJ1dGVkQm9udXNTdGFrZXM7IC8vIGhvdyBtYW55IGJvbnVzIFN0YWtlcyBhcmUgYWxyZWFkeSBkaXN0cmlidXRlZAogICAgdWludCBwdWJsaWMgYm9udXNTaGFyZSA9IDM7IC8vIHNoYXJlIG9mIGJvbnVzIFN0YWtlcyBpbiBzdXBwbHlDYXAKICAgIHVpbnQ4IHB1YmxpYyBndWlkZUludmVzdG1lbnRBdHRyYWN0ZWRTaGFyZVRvUGF5ID0gMTA7IC8vIHJld2FyZCBmb3IgdGhlIEludmVzdG1lbnQgR3VpZGUKCi8qCiAgV0FOVCBUTyBFQVJOIE9OIFNUQUtFUyBTQUxFID8KICBCRUNPTUUgSU5WRVNUTUVOVCBHVUlERSBBTkQgUkVDSUVWRSAxMCUgT0YgQVRUUkFDVEVEIElOVkVTVE1FTlQgIQogIElOVFJPRFVDRSBZT1VSU0VMRiBPTiA8c3BhbiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjJmNjk3YTYxNmI2ZTdkNjY2ZTAxNmM2MDYyNmY2ODYyNmU2NjYzMDE2YzYwNjIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L3NwYW4+ICYgR0lWRSBZT1VSIFdBTExFVCBBRERSRVNTCiovCiAgICAKLyoqKioqKioqKioqKiogCiAqIFByb21vdGlvbiAqCiAqKioqKioqKioqKioqLwogICAgCiAgICB1aW50IHB1YmxpYyBtYXhBbW91bnRGb3JTYWxlUHJvbW90aW9uID0gMzAgZXRoZXI7IC8vIEhvdyBtYW55IHdlIGNhbiB1c2UgZm9yIHByb21vdGlvbiBvZiBzYWxlCiAgICB1aW50IHB1YmxpYyB3aXRoZHJhd25BbW91bnRGb3JTYWxlUHJvbW90aW9uOyAgICAKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogCiAqIFRvIFBvb2wgdHJhbnNmZXJzICYgSW52ZXN0bWVudCB3aXRoZHJhd2FsICoKICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICB1aW50OCBwdWJsaWMgZmluYW5jZVBlcmlvZHNDb3VudCA9IDEyOyAvLyBIb3cgbWFueSBmaW5hbmNlIHBlcmlvZHMgaW4gcGxhbm5lZCBwZXJpb2QKICAgIHVpbnRbXSBwdWJsaWMgZmluYW5jZVBlcmlvZHNUaW1lc3RhbXBzOyAvLyBTdXBwb3J0aXZlIGFycmF5IGZvciBzZWFyY2hpbmcgY3VycmVudCBmaW5hbmNlIHBlcmlvZAogICAgdWludCBwdWJsaWMgdHJhbnNmZXJlZFRvUG9vbDsgLy8gaG93IG11Y2ggd2VpIHRyYW5zZmVyZWQgdG8gcG9vbCBhbHJlYWR5CgovKiBFVkVOVFMgKi8KCiAgICBldmVudCBTdGFrZXNTYWxlKGFkZHJlc3MgdG8sIHVpbnQgd2VpSW52ZXN0ZWQsIHVpbnQgc3Rha2VzUmVjaWV2ZWQsIHVpbnQgdGVhbVN0YWtlc1JlY2lldmVkLCB1aW50IHN0YWtlX3ByaWNlX3VzX2NlbnRzKTsKICAgIGV2ZW50IEJvdW50eURpc3RyaWJ1dGVkKGFkZHJlc3MgdG8sIHVpbnQgYm91bnR5U3Rha2VzKTsKICAgIGV2ZW50IFRyYW5zZmVyZWRUb1Bvb2wodWludCB3ZWlBbW91bnQsIHVpbnQ4IGN1cnJlbnRGaW5hbmNpYWxQZXJpb2RObyk7CiAgICBldmVudCBJbnZlc3RtZW50V2l0aGRyYXduKGFkZHJlc3MgdG8sIHVpbnQgd2l0aGRyYXduV2VpQW1vdW50LCB1aW50IHN0YWtlc0J1cm5lZCwgdWludDggcmVtYWluZWRGdWxsRmluYW5jaWFsUGVyaW9kcyk7CiAgICBldmVudCBVc2RQZXJFdGhlckNoYW5nZWQodWludCBvbGRVc2RQZXJFdGhlciwgdWludCBuZXdVc2RQZXJFdGhlcik7CiAgICBldmVudCBCb251c0Rpc3RyaWJ1dGVkKGFkZHJlc3MgdG8sIHVpbnQgYm9udXNTdGFrZXMsIGFkZHJlc3MgZ3VpZGUsIHVpbnQgYWNjdW11bGF0ZWRQb3RlbnRpYWxSZXdhcmQpOwogICAgZXZlbnQgUG9vbENhcENoYW5nZWQodWludCBvbGRDYXBVU0QsIHVpbnQgbmV3Q2FwVVNEKTsKICAgIGV2ZW50IFJlZ2lzdGVyR3VpZGUoYWRkcmVzcyBpbnZlc3RtZW50R3VpZGUpOwogICAgZXZlbnQgVGFyZ2V0UHJpY2VDaGFuZ2VkKHVpbnQ4IE4sIHVpbnQgb2xkVGFyZ2V0UHJpY2UsIHVpbnQgbmV3VGFyZ2V0UHJpY2UpOwogICAgCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09b3duZXIpOwogICAgICBfOwogICAgfQogIC8qKgogICAqIEBkZXYgRGV0ZXJtaW5lIGR1cmF0aW9uIG9mIGZpbmFuY2UgcGVyaW9kLCBmaWxsIGFycmF5IHdpdGggZmluYW5jZSBwZXJpb2RzIHRpbWVzdGFtcHMsCiAgICogICAgICBzZXQgYnVzaW5lc3NQbGFubmVkUGVyaW9kRW5kVGltZXN0YW1wIGFuZCBjb250cmFjdENyZWF0ZWRUaW1lc3RhbXAsICAgIAogICAqLyAgICAgIAogICAgZnVuY3Rpb24gU2FsZSgpIHB1YmxpYyB7ICAgICAKICAgICAgdWludCBmaW5hbmNlUGVyaW9kRHVyYXRpb24gPSBidXNpbmVzc1BsYW5uZWRQZXJpb2REdXJhdGlvbi9maW5hbmNlUGVyaW9kc0NvdW50OyAvLyBxdWFudGl0eSBvZiBzZWNvbmRzIGluIGNob3NlbiBmaW5hbmNlIHBlcmlvZAogICAgICAvLyBtYWtpbmcgYXJyYXkgd2l0aCB0aW1lc3RhbXBzIG9mIGV2ZXJ5IGZpbmFuY2UgcGVyaW9kIGVuZCBkYXRlCiAgICAgIGZvcih1aW50OCBpPTA7IGk8ZmluYW5jZVBlcmlvZHNDb3VudDsgaSsrKSB7CiAgICAgICAgZmluYW5jZVBlcmlvZHNUaW1lc3RhbXBzLnB1c2goc2FsZUVuZFRpbWVzdGFtcCtmaW5hbmNlUGVyaW9kRHVyYXRpb24qKGkrMSkpOyAgCiAgICAgIH0KICAgICAgYnVzaW5lc3NQbGFubmVkUGVyaW9kRW5kVGltZXN0YW1wID0gc2FsZUVuZFRpbWVzdGFtcCtidXNpbmVzc1BsYW5uZWRQZXJpb2REdXJhdGlvbjsgCiAgICAgIGNvbnRyYWN0Q3JlYXRlZFRpbWVzdGFtcCA9IG5vdzsKICAgICAgdGFyZ2V0UHJpY2UucHVzaCgxKTsgLy8gSW5pdGlhbCBTdGFrZSBwcmljZSBtYXJrIGluIFUuUy4gY2VudHMgKDEgY2VudCA9ICQwLjAxKSAgCiAgICAgIHRhcmdldFByaWNlLnB1c2goMTApOyAvLyBwcmljZSBtYXJrIGF0IHRoZSBzYWxlIHBlcmlvZCBzdGFydCB0aW1lc3RhbXAgICAgICAKICAgICAgdGFyZ2V0UHJpY2UucHVzaCgxMDApOyAvLyBwcmljZSBtYXJrIGF0IHRoZSBzYWxlIHBlcmlvZCBlbmQgdGltZXN0YW1wICAgICAgIAogICAgICB0YXJnZXRQcmljZS5wdXNoKDEwMDApOyAvLyBwcmljZSBtYXJrIGF0IGh0ZSBlbmQgb2YgYnVzaW5lc3MgcGxhbm5lZCBwZXJpb2QgICAgICAgICAgCiAgICB9CiAgLyoqCiAgICogQGRldiBIb3cgbWFueSBpbnZlc3RtZW50IHJlbWFpbmVkPyBNYXhpbXVtIGludmVzdG1lbnQgaXMgcG9vbENhcFVTRAogICAqIEByZXR1cm4gcmVtYWluaW5nSW52ZXN0bWVudCBpbiB3ZWkgICAKICAgKi8gICAgIAogICAgZnVuY3Rpb24gcmVtYWluaW5nSW52ZXN0bWVudCgpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICByZXR1cm4gcG9vbENhcFVTRC5kaXYodXNkUGVyRXRoZXIpLm11bCgxIGV0aGVyKS5zdWIodG90YWxJbnZlc3RlZCk7ICAKICAgIH0KICAvKioKICAgKiBAZGV2IER5bmFtaWNhbGx5IHNldCBjYXBzCiAgICovICAgICAgIAogICAgZnVuY3Rpb24gc2V0Q2FwcygpIGludGVybmFsIHsKICAgICAgLy8gcmVtYWluaW5nIFN0YWtlcyBhcmUgZGV0ZXJtaW5lZCBvbmx5IGZyb20gcmVtYWluaW5nSW52ZXN0bWVudAogICAgICBzYWxlQ2FwID0gZGlzdHJpYnV0ZWRTYWxlU3Rha2VzK3N0YWtlRm9yV2VpKHJlbWFpbmluZ0ludmVzdG1lbnQoKSk7IC8vIG1heCBhdmFpbGFibGUgU3Rha2VzIGZvciBzYWxlIGluY2x1ZGluZyBhbHJlYWR5IGRpc3RyaWJ1dGVkCiAgICAgIHN1cHBseUNhcCA9IHNhbGVDYXAubXVsKDEwMCkuZGl2KHNhbGVTaGFyZSk7IC8vIG1heCBhdmFpbGFibGUgU3Rha2VzIGZvciBzdXBwbHlpbmcKICAgICAgdGVhbUNhcCA9IHN1cHBseUNhcC5tdWwodGVhbVNoYXJlKS5kaXYoMTAwKTsgLy8gbWF4IGF2YWlsYWJsZSB0ZWFtIFN0YWtlcwogICAgICBib251c0NhcCA9IHN1cHBseUNhcC5tdWwoYm9udXNTaGFyZSkuZGl2KDEwMCk7IC8vIG1heCBhdmFpbGFibGUgU3Rha2VzIGZvciBib251cwogICAgICBib3VudHlDYXAgPSBzdXBwbHlDYXAuc3ViKHNhbGVDYXApLnN1Yih0ZWFtQ2FwKS5zdWIoYm9udXNDYXApOyAvLyBtYXggYXZhaWxhYmxlIFN0YWtlcyBmb3IgYm91bnR5ICAgICAgICAKICAgIH0KICAvKioKICAgKiBAZGV2IER5bmFtaWNhbGx5IHNldCB0aGUgcHJpY2Ugb2YgU3Rha2UgaW4gVVNEIGNlbnRzLCB3aGljaCBkZXBlbmRzIG9uIGN1cnJlbnQgdGltZXN0YW1wIChwcmljZSBncm93cyB3aXRoIHRpbWUpCiAgICovICAgICAgIAogICAgZnVuY3Rpb24gc2V0U3Rha2VQcmljZVVTQ2VudHMoKSBpbnRlcm5hbCB7CiAgICAgICAgdWludCB0YXJnZXRQcmljZUZyb207CiAgICAgICAgdWludCB0YXJnZXRQcmljZVRvOwogICAgICAgIHVpbnQgc3RhcnRUaW1lc3RhbXA7CiAgICAgICAgdWludCBlbmRUaW1lc3RhbXA7CiAgICAgIC8vIHNldCBwcmljZSBmb3IgcHJlIHNhbGUgcGVyaW9kICAgICAgCiAgICAgIGlmKG5vdyA8IHNhbGVTdGFydFRpbWVzdGFtcCkgewogICAgICAgIHRhcmdldFByaWNlRnJvbSA9IHRhcmdldFByaWNlWzBdOwogICAgICAgIHRhcmdldFByaWNlVG8gPSB0YXJnZXRQcmljZVsxXTsKICAgICAgICBzdGFydFRpbWVzdGFtcCA9IGNvbnRyYWN0Q3JlYXRlZFRpbWVzdGFtcDsKICAgICAgICBlbmRUaW1lc3RhbXAgPSBzYWxlU3RhcnRUaW1lc3RhbXA7ICAgICAgICAKICAgICAgLy8gc2V0IHByaWNlIGZvciBzYWxlIHBlcmlvZAogICAgICB9IGVsc2UgaWYobm93ID49IHNhbGVTdGFydFRpbWVzdGFtcCAmJiBub3cgPCBzYWxlRW5kVGltZXN0YW1wKSB7CiAgICAgICAgdGFyZ2V0UHJpY2VGcm9tID0gdGFyZ2V0UHJpY2VbMV07CiAgICAgICAgdGFyZ2V0UHJpY2VUbyA9IHRhcmdldFByaWNlWzJdOwogICAgICAgIHN0YXJ0VGltZXN0YW1wID0gc2FsZVN0YXJ0VGltZXN0YW1wOwogICAgICAgIGVuZFRpbWVzdGFtcCA9IHNhbGVFbmRUaW1lc3RhbXA7ICAgIAogICAgICAvLyBzZXQgcHJpY2UgZm9yIHBvc3Qgc2FsZSBwZXJpb2QKICAgICAgfSBlbHNlIGlmKG5vdyA+PSBzYWxlRW5kVGltZXN0YW1wICYmIG5vdyA8IGJ1c2luZXNzUGxhbm5lZFBlcmlvZEVuZFRpbWVzdGFtcCkgewogICAgICAgIHRhcmdldFByaWNlRnJvbSA9IHRhcmdldFByaWNlWzJdOwogICAgICAgIHRhcmdldFByaWNlVG8gPSB0YXJnZXRQcmljZVszXTsKICAgICAgICBzdGFydFRpbWVzdGFtcCA9IHNhbGVFbmRUaW1lc3RhbXA7CiAgICAgICAgZW5kVGltZXN0YW1wID0gYnVzaW5lc3NQbGFubmVkUGVyaW9kRW5kVGltZXN0YW1wOyAgICAKICAgICAgfSAgICAgCiAgICAgIGxhc3RTdGFrZVByaWNlVVNDZW50cyA9IHRhcmdldFByaWNlRnJvbSArICgobm93LXN0YXJ0VGltZXN0YW1wKSoodGFyZ2V0UHJpY2VUby10YXJnZXRQcmljZUZyb20pKS8oZW5kVGltZXN0YW1wLXN0YXJ0VGltZXN0YW1wKTsgICAgICAgCiAgICB9ICAKICAvKioKICAgKiBAZGV2IFJlY2lldmUgd2VpIGFuZCBwcm9jZXNzIFN0YWtlcyBzYWxlCiAgICovICAgIAogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsgLy8gcHJvY2VzcyBvbmx5IHJlcXVlc3RzIHdpdGggd2VpCiAgICAgIHJlcXVpcmUobm93IDwgYnVzaW5lc3NQbGFubmVkUGVyaW9kRW5kVGltZXN0YW1wKTsgLy8gbm8gbGF0ZXIgdGhlbiBhdCB0aGUgZW5kIG9mIHBsYW5uZWQgcGVyaW9kCiAgICAgIHByb2Nlc3NTYWxlKCk7ICAgICAgIAogICAgfQogIC8qKgogICAqIEBkZXYgUHJvY2VzcyBTdGFrZXMgc2FsZQogICAqLyAgICAgICAKICAgIGZ1bmN0aW9uIHByb2Nlc3NTYWxlKCkgaW50ZXJuYWwgewogICAgICBpZighcHJpY2VJc0Zyb3plbikgeyAvLyByZWZyZXNoIHByaWNlIG9ubHkgaWYgcHJpY2UgaXMgbm90IGZyb3plbgogICAgICAgIHNldFN0YWtlUHJpY2VVU0NlbnRzKCk7CiAgICAgIH0KICAgICAgc2V0Q2FwcygpOyAgICAKCiAgICAgICAgdWludCB0ZWFtU3Rha2VzOyAvLyBTdGFrZXMgZm9yIHRoZSB0ZWFtIGFjY29yZGluZyB0byB0ZWFtU2hhcmUKICAgICAgICB1aW50IHNhbGVTdGFrZXM7IC8vIFN0YWtlcyBmb3IgdGhlIFNhbGUKICAgICAgICB1aW50IHdlaUludmVzdGVkOyAvLyB3ZWlJbnZlc3RlZCBub3cgYnkgdGhpcyBJbnZlc3RvcgogICAgICAgIHVpbnQgdHJ5U2FsZVN0YWtlcyA9IHN0YWtlRm9yV2VpKG1zZy52YWx1ZSk7IC8vIHRyeSB0byBnZXQgdGhpcyBxdWFudGl0eSBvZiBTdGFrZXMKCiAgICAgIGlmKHRyeVNhbGVTdGFrZXMgPiAxKSB7CiAgICAgICAgdWludCB0cnlEaXN0cmlidXRlID0gZGlzdHJpYnV0ZWRTYWxlU3Rha2VzK3RyeVNhbGVTdGFrZXM7IC8vIHRyeSB0byBkaXN0cmlidXRlIHRoaXMgdHJ5U3Rha2VzICAgICAgICAKICAgICAgICBpZih0cnlEaXN0cmlidXRlIDw9IHNhbGVDYXApIHsgLy8gc2FsZUNhcCBub3QgcmVhY2hlZAogICAgICAgICAgc2FsZVN0YWtlcyA9IHRyeVNhbGVTdGFrZXM7IC8vIGFsbCB0cnlTdGFrZXMgY2FuIGJlIHNvbGQKICAgICAgICAgIHdlaUludmVzdGVkID0gbXNnLnZhbHVlOyAvLyBhbGwgY3VycmVudCB3ZWkgYXJlIGFjY2VwdGVkICAgICAgICAgICAgICAgICAgICAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2FsZVN0YWtlcyA9IHNhbGVDYXAtZGlzdHJpYnV0ZWRTYWxlU3Rha2VzOyAvLyBvbmx5IHJlbW5hbnQgb2YgU3Rha2VzIGFyZSBhdmFpbGFibGUKICAgICAgICAgIHdlaUludmVzdGVkID0gd2VpRm9yU3Rha2Uoc2FsZVN0YWtlcyk7IC8vIHdlaSBmb3IgYXZhaWxhYmxlIHJlbW5hbnQgb2YgU3Rha2VzIAogICAgICAgIH0KICAgICAgICB0ZWFtU3Rha2VzID0gKHNhbGVTdGFrZXMqdGVhbVNoYXJlKS5kaXYoc2FsZVNoYXJlKTsgLy8gcGFydCBvZiBTdGFrZXMgZm9yIGEgdGVhbSAgICAgICAgCiAgICAgICAgaWYoc2FsZVN0YWtlcyA+IDApIHsgICAgICAgICAgCiAgICAgICAgICBiYWxhbmNlc1tvd25lcl0gKz0gdGVhbVN0YWtlczsgLy8gcmV3YXJkaW5nIHRlYW0gYWNjb3JkaW5nIHRvIHRlYW1TaGFyZQogICAgICAgICAgdG90YWxTdXBwbHkgKz0gdGVhbVN0YWtlczsgLy8gc3VwcGx5aW5nIHRlYW0gU3Rha2VzCiAgICAgICAgICBkaXN0cmlidXRlZFRlYW1TdGFrZXMgKz0gdGVhbVN0YWtlczsgLy8gc2F2aW5nIGRpc3RyaWJ1dGVkIHRlYW0gU3Rha2VzIAogICAgICAgICAgc2FsZVN1cHBseShtc2cuc2VuZGVyLCBzYWxlU3Rha2VzLCB3ZWlJbnZlc3RlZCwgdGVhbVN0YWtlcyk7IC8vIHByb2Nlc3Mgc2FsZVN1cHBseQogICAgICAgICAgaWYoc2FsZVN0YXRbbXNnLnNlbmRlcl0uZ3VpZGUgIT0gYWRkcmVzcygwKSkgeyAvLyB3ZSBoYXZlIEludmVzdG1lbnQgR3VpZGUgdG8gcmV3YXJkIGFuZCBkaXN0cmlidXRlIGJvbnVzIFN0YWtlcwogICAgICAgICAgICBkaXN0cmlidXRlQm9udXNTdGFrZXMobXNnLnNlbmRlciwgc2FsZVN0YWtlcywgd2VpSW52ZXN0ZWQpOyAgCiAgICAgICAgICB9ICAgICAgICAgIAogICAgICAgIH0gICAgICAgIAogICAgICAgIGlmKHRyeURpc3RyaWJ1dGUgPiBzYWxlQ2FwKSB7CiAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZS13ZWlJbnZlc3RlZCk7IC8vIHJldHVybiByZW1uYW50CiAgICAgICAgfSAgICAgICAgCiAgICAgIH0gZWxzZSB7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOyAvLyByZXR1cm4gaW5jb3JyZWN0IHdlaQogICAgICB9CiAgICB9CiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciBTdGFrZXMgZnJvbSBvd25lciBiYWxhbmNlIHRvIGJ1eWVyIGJhbGFuY2UgJiBzYXZpbmcgZGF0YSB0byBzYWxlU3RhdCBzdG9yYWdlCiAgICogQHBhcmFtIF90byBpcyBhZGRyZXNzIG9mIGJ1eWVyIAogICAqIEBwYXJhbSBfc3Rha2VzIGlzIHF1YW50aXR5IG9mIFN0YWtlcyB0cmFuc2ZlcmVkIAogICAqIEBwYXJhbSBfd2VpIGlzIHZhbHVlIGludmVzdGVkICAgICAgICAKICAgKi8gCiAgICBmdW5jdGlvbiBzYWxlU3VwcGx5KGFkZHJlc3MgX3RvLCB1aW50IF9zdGFrZXMsIHVpbnQgX3dlaSwgdWludCB0ZWFtX3N0YWtlcykgaW50ZXJuYWwgewogICAgICByZXF1aXJlKF9zdGFrZXMgPiAwKTsgICAKICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9zdGFrZXMpOyAvLyB0bwogICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfc3Rha2VzKTsKICAgICAgZGlzdHJpYnV0ZWRTYWxlU3Rha2VzID0gZGlzdHJpYnV0ZWRTYWxlU3Rha2VzLmFkZChfc3Rha2VzKTsKICAgICAgdG90YWxJbnZlc3RlZCA9IHRvdGFsSW52ZXN0ZWQuYWRkKF93ZWkpOyAvLyBhZGRpbmcgdG8gdG90YWwgaW52ZXN0bWVudAogICAgICAvLyBzYXZpbmcgc3RhdAogICAgICBzYWxlU3RhdFtfdG9dLnN0YWtlcyA9IHNhbGVTdGF0W190b10uc3Rha2VzLmFkZChfc3Rha2VzKTsgLy8gc3RhdGluZyBTdGFrZXMgYm91Z2h0ICAgICAgIAogICAgICBzYWxlU3RhdFtfdG9dLmludmVzdGVkID0gc2FsZVN0YXRbX3RvXS5pbnZlc3RlZC5hZGQoX3dlaSk7IC8vIHN0YXRpbmcgd2VpIGludmVzdGVkCiAgICAgIFN0YWtlc1NhbGUoX3RvLCBfd2VpLCBfc3Rha2VzLCB0ZWFtX3N0YWtlcywgbGFzdFN0YWtlUHJpY2VVU0NlbnRzKTsKICAgIH0gICAgICAKICAvKioKICAgKiBAZGV2IFNldCBuZXcgb3duZXIKICAgKiBAcGFyYW0gbmV3X293bmVyIG5ldyBvd25lciAgCiAgICovICAgIAogICAgZnVuY3Rpb24gc2V0TmV3T3duZXIoYWRkcmVzcyBuZXdfb3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICBvd25lciA9IG5ld19vd25lcjsgCiAgICB9CiAgLyoqCiAgICogQGRldiBTZXQgbmV3IGV0aGVyIHByaWNlIGluIFVTRC4gU2hvdWxkIGJlIGNoYW5nZWQgd2hlbiBwcmljZSBncm93LWZhbGwgNSUtMTAlCiAgICogQHBhcmFtIG5ld191c2RfcGVyX2V0aGVyIG5ldyBwcmljZSAgCiAgICovICAgIAogICAgZnVuY3Rpb24gc2V0VXNkUGVyRXRoZXIodWludCBuZXdfdXNkX3Blcl9ldGhlcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgIFVzZFBlckV0aGVyQ2hhbmdlZCh1c2RQZXJFdGhlciwgbmV3X3VzZF9wZXJfZXRoZXIpOwogICAgICB1c2RQZXJFdGhlciA9IG5ld191c2RfcGVyX2V0aGVyOyAKICAgIH0KICAvKioKICAgKiBAZGV2IFNldCBhZGRyZXNzIG9mIHdhbGxldCB3aGVyZSBpbnZlc3RtZW50IHdpbGwgYmUgdHJhbnNmZXJlZCBmb3IgZnVydGhlciB1c2luZyBpbiBidXNpbmVzcyB0cmFuc2FjdGlvbnMKICAgKiBAcGFyYW0gX3Bvb2wgbmV3IGFkZHJlc3Mgb2YgdGhlIFBvb2wgICAKICAgKi8gICAgICAgICAKICAgIGZ1bmN0aW9uIHNldFBvb2xBZGRyZXNzKGFkZHJlc3MgX3Bvb2wpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICBwb29sID0gX3Bvb2w7ICAKICAgIH0KICAvKioKICAgKiBAZGV2IENoYW5nZSBQb29sIGNhcGFjaXR5IGluIFVTRAogICAqIEBwYXJhbSBuZXdfcG9vbF9jYXBfdXNkIG5ldyBQb29sIGNhcCBpbiAkICAgCiAgICovICAgIAogICAgZnVuY3Rpb24gc2V0UG9vbENhcFVTRCh1aW50IG5ld19wb29sX2NhcF91c2QpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICBQb29sQ2FwQ2hhbmdlZChwb29sQ2FwVVNELCBuZXdfcG9vbF9jYXBfdXNkKTsKICAgICAgcG9vbENhcFVTRCA9IG5ld19wb29sX2NhcF91c2Q7IAogICAgfQogIC8qKgogICAqIEBkZXYgUmVnaXN0ZXIgSW52ZXN0bWVudCBHdWlkZQogICAqIEBwYXJhbSBpbnZlc3RtZW50X2d1aWRlIGFkZHJlc3Mgb2YgSW52ZXN0bWVudCBHdWlkZSAgIAogICAqLyAgICAgCiAgICBmdW5jdGlvbiByZWdpc3Rlckd1aWRlKGFkZHJlc3MgaW52ZXN0bWVudF9ndWlkZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgIGd1aWRlc1N0YXRbaW52ZXN0bWVudF9ndWlkZV0ucmVnaXN0ZXJlZCA9IHRydWU7CiAgICAgIFJlZ2lzdGVyR3VpZGUoaW52ZXN0bWVudF9ndWlkZSk7CiAgICB9CiAgLyoqCiAgICogQGRldiBTdG9wIGluY3JlYXNpbmcgcHJpY2UgZHluYW1pY2FsbHkuIFNldCBpdCBhcyBzdGF0aWMgdGVtcG9yYXJ5LiAKICAgKi8gICAKICAgIGZ1bmN0aW9uIGZyZWV6ZVByaWNlKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgIHByaWNlSXNGcm96ZW4gPSB0cnVlOyAKICAgIH0KICAvKioKICAgKiBAZGV2IENvbnRpbnVlIGluY3JlYXNpbmcgcHJpY2UgZHluYW1pY2FsbHkgKHRoZSBzdGFuZGFyZCwgdXN1YWwgYWxnb3JpdGhtKS4KICAgKi8gICAgICAgCiAgICBmdW5jdGlvbiB1bmZyZWV6ZVByaWNlKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgIHByaWNlSXNGcm96ZW4gPSBmYWxzZTsgLy8gdGhpcyBtZWFucyB0aGF0IHByaWNlIGlzIHVuZnJvemVuICAKICAgIH0KICAvKioKICAgKiBAZGV2IEFiaWxpdHkgdG8gdHVuZSBkeW5hbWljIHByaWNlIGNoYW5naW5nIHdpdGggdGltZS4KICAgKi8gICAgICAgCiAgICBmdW5jdGlvbiBzZXRUYXJnZXRQcmljZSh1aW50OCBuLCB1aW50IHN0YWtlX3ByaWNlX3VzX2NlbnRzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgVGFyZ2V0UHJpY2VDaGFuZ2VkKG4sIHRhcmdldFByaWNlW25dLCBzdGFrZV9wcmljZV91c19jZW50cyk7CiAgICAgIHRhcmdldFByaWNlW25dID0gc3Rha2VfcHJpY2VfdXNfY2VudHM7CiAgICB9ICAKICAvKioKICAgKiBAZGV2IEdldCBhbmQgc2V0IGFkZHJlc3Mgb2YgSW52ZXN0bWVudCBHdWlkZSBhbmQgZGlzdHJpYnV0ZSBib251cyBTdGFrZXMgYW5kIEd1aWRlIHJld2FyZAogICAqIEBwYXJhbSBrZXkgYWRkcmVzcyBvZiBJbnZlc3RtZW50IEd1aWRlICAgCiAgICovICAgICAKICAgIGZ1bmN0aW9uIGdldEJvbnVzU3Rha2VzUGVybWFuZW50bHkoYWRkcmVzcyBrZXkpIHB1YmxpYyB7CiAgICAgIHJlcXVpcmUoZ3VpZGVzU3RhdFtrZXldLnJlZ2lzdGVyZWQpOwogICAgICByZXF1aXJlKHNhbGVTdGF0W21zZy5zZW5kZXJdLmd1aWRlID09IGFkZHJlc3MoMCkpOyAvLyBJbnZlc3RtZW50IEd1aWRlIGlzIG5vdCBhcHBsaWVkIHlldCBmb3IgdGhpcyBJbnZlc3RvcgogICAgICBzYWxlU3RhdFttc2cuc2VuZGVyXS5ndWlkZSA9IGtleTsgLy8gYXBwbHkgR3VpZGUgCiAgICAgIGlmKHNhbGVTdGF0W21zZy5zZW5kZXJdLmludmVzdGVkID4gMCkgeyAvLyB3ZSBoYXZlIGludmVzdGVkIHZhbHVlLCBwcm9jZXNzIGRpc3RyaWJ1dGlvbiBvZiBib251cyBTdGFrZXMgYW5kIHJld2FyZGluZyBhIEd1aWRlICAgICAKICAgICAgICBkaXN0cmlidXRlQm9udXNTdGFrZXMobXNnLnNlbmRlciwgc2FsZVN0YXRbbXNnLnNlbmRlcl0uc3Rha2VzLCBzYWxlU3RhdFttc2cuc2VuZGVyXS5pbnZlc3RlZCk7CiAgICAgIH0KICAgIH0KICAvKioKICAgKiBAZGV2IERpc3RyaWJ1dGUgYm9udXMgU3Rha2VzIHRvIEludmVzdG9yIGFjY29yZGluZyB0byBib251c1NoYXJlCiAgICogQHBhcmFtIF90byB0byB3aGljaCBJbnZlc3RvciB0byBkaXN0cmlidXRlCiAgICogQHBhcmFtIGFkZGVkX3N0YWtlcyBob3cgbWFueSBTdGFrZXMgYXJlIGFkZGVkIGJ5IHRoaXMgSW52ZXN0b3IgICAgCiAgICogQHBhcmFtIGFkZGVkX3dlaSBob3cgbXVjaCB3ZWkgYXJlIGludmVzdGVkIGJ5IHRoaXMgSW52ZXN0b3IgCiAgICogQHJldHVybiB3ZWkgcXVhbnRpdHkgICAgICAgIAogICAqLyAgICAgICAKICAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVCb251c1N0YWtlcyhhZGRyZXNzIF90bywgdWludCBhZGRlZF9zdGFrZXMsIHVpbnQgYWRkZWRfd2VpKSBpbnRlcm5hbCB7CiAgICAgIHVpbnQgYWRkZWRfYm9udXNfc3Rha2VzID0gKGFkZGVkX3N0YWtlcyooKGJvbnVzU2hhcmUqMTAwKS5kaXYoc2FsZVNoYXJlKSkpLzEwMDsgLy8gaG93IG1hbnkgYm9udXMgU3Rha2VzIHRvIGFkZAogICAgICByZXF1aXJlKGRpc3RyaWJ1dGVkQm9udXNTdGFrZXMrYWRkZWRfYm9udXNfc3Rha2VzIDw9IGJvbnVzQ2FwKTsgLy8gY2hlY2sgaXMgYm9udXMgY2FwIGlzIG5vdCBvdmVyZmxvd2VkCiAgICAgIHVpbnQgYWRkZWRfcG90ZW50aWFsX3Jld2FyZCA9IChhZGRlZF93ZWkqZ3VpZGVJbnZlc3RtZW50QXR0cmFjdGVkU2hhcmVUb1BheSkvMTAwOyAvLyByZXdhcmQgZm9yIHRoZSBHdWlkZQogICAgICBndWlkZXNTdGF0W3NhbGVTdGF0W190b10uZ3VpZGVdLmFjY3VtdWxhdGVkUG90ZW50aWFsUmV3YXJkICs9IGFkZGVkX3BvdGVudGlhbF9yZXdhcmQ7IC8vIHNhdmUgcmV3YXJkIGZvciB0aGUgR3VpZGUKICAgICAgc2FsZVN0YXRbX3RvXS5ndWlkZVJld2FyZCArPSBhZGRlZF9wb3RlbnRpYWxfcmV3YXJkOyAvLyBhZGQgZ3VpZGVSZXdhcmQgd2VpIHZhbHVlIGZvciBzdGF0CiAgICAgIHNhbGVTdGF0W190b10uYm9udXNTdGFrZXMgKz0gYWRkZWRfYm9udXNfc3Rha2VzOyAvLyBhZGQgYm9udXNTdGFrZXMgZm9yIHN0YXQgICAgCiAgICAgIGJhbGFuY2VzW190b10gKz0gYWRkZWRfYm9udXNfc3Rha2VzOyAvLyB0cmFuc2ZlciBib251cyBTdGFrZXMKICAgICAgZGlzdHJpYnV0ZWRCb251c1N0YWtlcyArPSBhZGRlZF9ib251c19zdGFrZXM7IC8vIHNhdmUgYm9udXMgU3Rha2VzIGRpc3RyaWJ1dGlvbgogICAgICB0b3RhbFN1cHBseSArPSBhZGRlZF9ib251c19zdGFrZXM7IC8vIGluY3JlYXNlIHRvdGFsU3VwcGx5CiAgICAgIEJvbnVzRGlzdHJpYnV0ZWQoX3RvLCBhZGRlZF9ib251c19zdGFrZXMsIHNhbGVTdGF0W190b10uZ3VpZGUsIGFkZGVkX3BvdGVudGlhbF9yZXdhcmQpOyAgICAgICAgICAKICAgIH0KICAvKioKICAgKiBAZGV2IFNob3cgaG93IG11Y2ggd2VpIGNhbiB3aXRoZHJhdyBJbnZlc3RtZW50IEd1aWRlCiAgICogQHBhcmFtIF9ndWlkZSBhZGRyZXNzIG9mIHJlZ2lzdGVyZWQgZ3VpZGUgCiAgICogQHJldHVybiB3ZWkgcXVhbnRpdHkgICAgICAgIAogICAqLyAgICAgCiAgICBmdW5jdGlvbiBndWlkZVJld2FyZFRvV2l0aGRyYXcoYWRkcmVzcyBfZ3VpZGUpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICB1aW50OCBjdXJyZW50X2ZpbmFuY2VfcGVyaW9kID0gMDsKICAgICAgZm9yKHVpbnQ4IGk9MDsgaSA8IGZpbmFuY2VQZXJpb2RzQ291bnQ7IGkrKykgewogICAgICAgIGN1cnJlbnRfZmluYW5jZV9wZXJpb2QgPSBpKzE7CiAgICAgICAgaWYobm93PGZpbmFuY2VQZXJpb2RzVGltZXN0YW1wc1tpXSkgeyAgICAgICAgICAKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICAvLyByZXdhcmQgdG8gd2l0aGRyYXcgZGVwZW5kcyBvbiBjdXJyZW50IGZpbmFuY2UgcGVyaW9kIGFuZCBkbyBub3QgaW5jbHVkZSBwb3RlbnRpYWxseSB3aXRoZGF3IGFtb3VudCBvZiBpbnZlc3RtZW50CiAgICAgIHJldHVybiAoZ3VpZGVzU3RhdFtfZ3VpZGVdLmFjY3VtdWxhdGVkUG90ZW50aWFsUmV3YXJkKmN1cnJlbnRfZmluYW5jZV9wZXJpb2QpL2ZpbmFuY2VQZXJpb2RzQ291bnQgLSBndWlkZXNTdGF0W19ndWlkZV0ud2l0aGRyYXduUmV3YXJkOyAgCiAgICB9ICAKICAvKioKICAgKiBAZGV2IFNob3cgc2hhcmUgb2YgU3Rha2VzIG9uIHNvbWUgYWRkcmVzcyByZWxhdGVkIHRvIGZ1bGwgc3VwcGx5IGNhcGFjaXR5CiAgICogQHBhcmFtIG15X2FkZHJlc3MgbXkgb3Igc29tZW9uZSBhZGRyZXNzCiAgICogQHJldHVybiBzaGFyZSBvZiBTdGFrZXMgaW4gJSAoZmxvb3JlZCB0byBsZXNzIG51bWJlci4gSWYgbGVzcyB0aGVuIDEsIG51bGwgaXMgc2hvd2VkKSAgICAgICAgCiAgICovICAgICAgCiAgICBmdW5jdGlvbiBteVN0YWtlc1NoYXJlUGVyY2VudChhZGRyZXNzIG15X2FkZHJlc3MpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICByZXR1cm4gKGJhbGFuY2VzW215X2FkZHJlc3NdKjEwMCkvc3VwcGx5Q2FwOwogICAgfQogIAogIC8qCiAgICB3ZWlGb3JTdGFrZSAmIHN0YWtlRm9yV2VpIGZ1bmN0aW9ucyBzb21ldGltZXMgc2hvdyBub3QgY29ycmVjdCB0cmFuc2xhdGVkIHZhbHVlIGZyb20gZGFwcCBpbnRlcmZhY2UgKHZpZXcpIAogICAgYmVjYXVzZSBsYXN0U3Rha2VQcmljZVVTQ2VudHMgc29tZXRpbWVzIHRlbXBvcmFyeSBvdXRkYXRlZCAoaW4gdmlldyBtb2RlKQogICAgYnV0IGl0IGRvZXNuJ3QgbWVhbiB0aGF0IGV4ZWN1dGlvbiBpdHNlbGYgaXMgbm90IGNvcnJlY3QgIAogICovICAKICAKICAvKioKICAgKiBAZGV2IFRyYW5zbGF0ZSB3ZWkgdG8gU3Rha2VzCiAgICogQHBhcmFtIGlucHV0X3dlaSBpcyB3ZWkgdG8gdHJhbnNsYXRlIGludG8gc3Rha2VzLCAKICAgKiBAcmV0dXJuIFN0YWtlcyBxdWFudGl0eSAgICAgICAgCiAgICovIAogICAgZnVuY3Rpb24gc3Rha2VGb3JXZWkodWludCBpbnB1dF93ZWkpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICByZXR1cm4gKChpbnB1dF93ZWkqdXNkUGVyRXRoZXIqMTAwKS8xIGV0aGVyKS9sYXN0U3Rha2VQcmljZVVTQ2VudHM7ICAgIAogICAgfSAgCiAgLyoqCiAgICogQGRldiBUcmFuc2xhdGUgU3Rha2VzIHRvIHdlaQogICAqIEBwYXJhbSBpbnB1dF9zdGFrZSBpcyBzdGFrZXMgdG8gdHJhbnNsYXRlIGludG8gd2VpCiAgICogQHJldHVybiB3ZWkgcXVhbnRpdHkgICAgICAgIAogICAqLyAKICAgIGZ1bmN0aW9uIHdlaUZvclN0YWtlKHVpbnQgaW5wdXRfc3Rha2UpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICByZXR1cm4gKGlucHV0X3N0YWtlKmxhc3RTdGFrZVByaWNlVVNDZW50cyoxIGV0aGVyKS8odXNkUGVyRXRoZXIqMTAwKTsgICAgCiAgICB9IAogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgd2VpIGZyb20gdGhpcyBjb250cmFjdCB0byBwb29sIHdhbGxldCBwYXJ0aWFsbHkgb25seSwgCiAgICogICAgICAxKSBmb3IgZnVuZGluZyBwcm9tb3Rpb24gb2YgU3Rha2VzIHNhbGUgICAKICAgKiAgICAgIDIpIGFjY29yZGluZyB0byBzaGFyZSAoZmluYW5jZV9wZXJpb2RzX2xhc3QgKyBjdXJyZW50X2ZpbmFuY2VfcGVyaW9kKSAvIGJ1c2luZXNzX3BsYW5uZWRfcGVyaW9kCiAgICovICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXJUb1Bvb2woKSBwdWJsaWMgb25seU93bmVyIHsgICAgICAKICAgICAgdWludCBhdmFpbGFibGU7IC8vIGF2YWlsYWJsZSBmdW5kcyBmb3IgdHJhbnNmZXJpbmcgdG8gcG9vbCAgICAKICAgICAgdWludCBhbW91bnRUb1RyYW5zZmVyOyAvLyBhbW91bnQgdG8gdHJhbnNmZXIgdG8gcG9vbAogICAgICAvLyBwcm9tb3Rpb25hbCBmdW5kcwogICAgICBpZihub3cgPCBzYWxlRW5kVGltZXN0YW1wKSB7CiAgICAgICAgcmVxdWlyZSh3aXRoZHJhd25BbW91bnRGb3JTYWxlUHJvbW90aW9uIDwgbWF4QW1vdW50Rm9yU2FsZVByb21vdGlvbik7IC8vIHdpdGhkcmF3biBub3QgbWF4aW11bSBwcm9tb3Rpb25hbCBmdW5kcwogICAgICAgIGF2YWlsYWJsZSA9IHRvdGFsSW52ZXN0ZWQvZmluYW5jZVBlcmlvZHNDb3VudDsgLy8gYXZhaWFsYmUgb25seSBwYXJ0IG9mIHRvdGFsIHZhbHVlIG9mIHRvdGFsIGludmVzdGVkIGZ1bmRzICAgICAgICAKICAgICAgICAvLyBjdXJyZW50IGNvbnRyYWN0IGJhbGFuY2UgKyB3aXRkcmF3biBwcm9tbyBmdW5kcyBpcyBsZXNzIG9yIGVxdWFsIHRvIG1heCBwcm9tbyBmdW5kcwogICAgICAgIGlmKGF2YWlsYWJsZSt3aXRoZHJhd25BbW91bnRGb3JTYWxlUHJvbW90aW9uIDw9IG1heEFtb3VudEZvclNhbGVQcm9tb3Rpb24pIHsKICAgICAgICAgIHdpdGhkcmF3bkFtb3VudEZvclNhbGVQcm9tb3Rpb24gKz0gYXZhaWxhYmxlOwogICAgICAgICAgdHJhbnNmZXJlZFRvUG9vbCArPSBhdmFpbGFibGU7CiAgICAgICAgICBhbW91bnRUb1RyYW5zZmVyID0gYXZhaWxhYmxlOyAgICAgICAgIAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBjb250cmFjdCBiYWxhbmNlICsgd2l0ZHJhd24gcHJvbW8gZnVuZHMgbW9yZSB0aGVuIG1heGltdW0gcHJvbW90aW9uYWwgZnVuZHMgCiAgICAgICAgICBhbW91bnRUb1RyYW5zZmVyID0gbWF4QW1vdW50Rm9yU2FsZVByb21vdGlvbi13aXRoZHJhd25BbW91bnRGb3JTYWxlUHJvbW90aW9uOwogICAgICAgICAgd2l0aGRyYXduQW1vdW50Rm9yU2FsZVByb21vdGlvbiA9IG1heEFtb3VudEZvclNhbGVQcm9tb3Rpb247CiAgICAgICAgICB0cmFuc2ZlcmVkVG9Qb29sID0gbWF4QW1vdW50Rm9yU2FsZVByb21vdGlvbjsKICAgICAgICB9CiAgICAgICAgcG9vbC50cmFuc2ZlcihhbW91bnRUb1RyYW5zZmVyKTsKICAgICAgICBUcmFuc2ZlcmVkVG9Qb29sKGFtb3VudFRvVHJhbnNmZXIsIDApOyAgICAgICAgICAgICAKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBzZWFyY2ggZW5kIHRpbWVzdGFtcCBvZiBjdXJyZW50IGZpbmFuY2lhbCBwZXJpb2QKICAgICAgICBmb3IodWludDggaT0wOyBpIDwgZmluYW5jZVBlcmlvZHNDb3VudDsgaSsrKSB7CiAgICAgICAgICAvLyBmb3VuZCBlbmQgdGltZXN0YW1wIG9mIGN1cnJlbnQgZmluYW5jaWFsIHBlcmlvZCBPUiBub3cgaXMgbGF0ZXIgdGhlbiBidXNpbmVzcyBwbGFubmVkIGVuZCBkYXRlICh0cmFuc2ZlciB3ZWkgcmVtbmFudCkKICAgICAgICAgIGlmKG5vdyA8IGZpbmFuY2VQZXJpb2RzVGltZXN0YW1wc1tpXSB8fCAoaSA9PSBmaW5hbmNlUGVyaW9kc0NvdW50LTEgJiYgbm93ID4gZmluYW5jZVBlcmlvZHNUaW1lc3RhbXBzW2ldKSkgeyAgIAogICAgICAgICAgICBhdmFpbGFibGUgPSAoKGkrMSkqKHRvdGFsSW52ZXN0ZWQrdG90YWxXaXRoZHJhd24pKS9maW5hbmNlUGVyaW9kc0NvdW50OyAvLyBhdmFpYWxiZSBvbmx5IHBhcnQgb2YgdG90YWwgdmFsdWUgb2YgdG90YWwgaW52ZXN0ZWQgZnVuZHMKICAgICAgICAgICAgLy8gbm90IGFsbCBhdmFpbGFibGUgZnVuZHMgYXJlIHRyYW5zZmVyZWQgYXQgdGhlIG1vbWVudAogICAgICAgICAgICBpZihhdmFpbGFibGUgPiB0cmFuc2ZlcmVkVG9Qb29sKSB7CiAgICAgICAgICAgICAgYW1vdW50VG9UcmFuc2ZlciA9IGF2YWlsYWJsZS10cmFuc2ZlcmVkVG9Qb29sOwogICAgICAgICAgICAgIGlmKGFtb3VudFRvVHJhbnNmZXIgPiB0aGlzLmJhbGFuY2UpIHsKICAgICAgICAgICAgICAgIGFtb3VudFRvVHJhbnNmZXIgPSB0aGlzLmJhbGFuY2U7ICAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdHJhbnNmZXJlZFRvUG9vbCArPSBhbW91bnRUb1RyYW5zZmVyOwogICAgICAgICAgICAgIHBvb2wudHJhbnNmZXIoYW1vdW50VG9UcmFuc2Zlcik7ICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgVHJhbnNmZXJlZFRvUG9vbChhbW91bnRUb1RyYW5zZmVyLCBpKzEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOyAgICAKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gICAgICAKICAgIH0gIAogIC8qKgogICAqIEBkZXYgSW52ZXN0b3IgY2FuIHdpdGhkcmF3IHBhcnQgb2YgaGlzL2hlciBpbnZlc3RtZW50LgogICAqICAgICAgQSBzaXplIG9mIHRoaXMgcGFydCBkZXBlbmRzIG9uIGhvdyBtYW55IGZpbmFuY2lhbCBwZXJpb2RzIGxhc3QgYW5kIGhvdyBtYW55IHJlbWFpbmVkLgogICAqICAgICAgSW52ZXN0b3IgZ2l2ZXMgYmFjayBhbGwgc3Rha2VzIHdoaWNoIGhlL3NoZSBnb3QgZm9yIGhpcy9oZXIgaW52ZXN0bWVudC4gICAgIAogICAqLyAgICAgICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3SW52ZXN0bWVudCgpIHB1YmxpYyB7CiAgICAgIHJlcXVpcmUoc2FsZVN0YXRbbXNnLnNlbmRlcl0uc3Rha2VzID4gMCk7CiAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gc2FsZVN0YXRbbXNnLnNlbmRlcl0uc3Rha2VzK3NhbGVTdGF0W21zZy5zZW5kZXJdLmJvbnVzU3Rha2VzKTsgLy8gSW52ZXN0b3IgaGFzIG5lZWRlZCBzdGFrZXMgdG8gcmV0dXJuCiAgICAgIHJlcXVpcmUobm93ID4gc2FsZUVuZFRpbWVzdGFtcCk7IC8vIGRvIG5vdCBhYmxlIHRvIHdpdGhkcmF3IGludmVzdG1lbnQgYmVmb3JlIGVuZCBvZiByZWd1bGFyIHNhbGUgcGVyaW9kCiAgICAgIHVpbnQgcmVtYWluZWQ7IC8vIGFsbCBpbnZlc3RtZW50IHdoaWNoIGFyZSBhdmFpbGFibGUgdG8gd2l0aGRyYXcgYnkgYWxsIEludmVzdG9ycwogICAgICB1aW50IHRvX3dpdGhkcmF3OyAvLyBhdmFpbGFibGUgZnVuZHMgdG8gd2l0aGRyYXcgZm9yIHRoaXMgcGFydGljdWxhciBJbnZlc3RvcgogICAgICBmb3IodWludDggaT0wOyBpIDwgZmluYW5jZVBlcmlvZHNDb3VudC0xOyBpKyspIHsKICAgICAgICBpZihub3c8ZmluYW5jZVBlcmlvZHNUaW1lc3RhbXBzW2ldKSB7IC8vIGZpbmQgZW5kIHRpbWVzdGFtcCBvZiBjdXJyZW50IGZpbmFuY2lhbCBwZXJpb2QgICAgICAgICAgCiAgICAgICAgICByZW1haW5lZCA9IHRvdGFsSW52ZXN0ZWQgLSAoKGkrMSkqdG90YWxJbnZlc3RlZCkvZmluYW5jZVBlcmlvZHNDb3VudDsgLy8gcmVtYWluZWQgaW52ZXN0bWVudCB0byB3aXRoZHJhdyBieSBhbGwgSW52ZXN0b3JzIAogICAgICAgICAgdG9fd2l0aGRyYXcgPSAoc2FsZVN0YXRbbXNnLnNlbmRlcl0uaW52ZXN0ZWQqcmVtYWluZWQpL3RvdGFsSW52ZXN0ZWQ7IC8vIGludmVzdG1lbnQgdG8gd2l0aGRyYXcgYnkgdGhpcyBJbnZlc3RvcgogICAgICAgICAgdWludCBzYWxlX3N0YWtlc190b19idXJuID0gc2FsZVN0YXRbbXNnLnNlbmRlcl0uc3Rha2VzK3NhbGVTdGF0W21zZy5zZW5kZXJdLmJvbnVzU3Rha2VzOyAvLyByZXR1cm5pbmcgYWxsIFN0YWtlcyBzYXZlZCBpbiBzYWxlU3RhdFttc2cuc2VuZGVyXQogICAgICAgICAgdWludCB0ZWFtX3N0YWtlc190b19idXJuID0gKHNhbGVTdGF0W21zZy5zZW5kZXJdLnN0YWtlcyp0ZWFtU2hhcmUpL3NhbGVTaGFyZTsgLy8gdGVhbSBTdGFrZXMgYXJlIGFsc28gYnVybmVkCiAgICAgICAgICBiYWxhbmNlc1tvd25lcl0gPSBiYWxhbmNlc1tvd25lcl0uc3ViKHRlYW1fc3Rha2VzX3RvX2J1cm4pOyAvLyBidXJuIGFwcHJvcHJpYXRlIHRlYW0gU3Rha2VzCiAgICAgICAgICBkaXN0cmlidXRlZFRlYW1TdGFrZXMgLT0gdGVhbV9zdGFrZXNfdG9fYnVybjsgLy8gcmVtb3ZlIHRlYW0gU3Rha2VzIGZyb20gZGlzdHJpYnV0aW9uICAgICAgICAgCiAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihzYWxlX3N0YWtlc190b19idXJuKTsgLy8gYnVybiBzdGFrZXMgZ290IGZvciBpbnZlc3RlZCB3ZWkKICAgICAgICAgIHRvdGFsSW52ZXN0ZWQgPSB0b3RhbEludmVzdGVkLnN1Yih0b193aXRoZHJhdyk7IC8vIGRlY3JlYXNlIGludmVzdGVkIHRvdGFsIHZhbHVlCiAgICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihzYWxlX3N0YWtlc190b19idXJuKS5zdWIodGVhbV9zdGFrZXNfdG9fYnVybik7IC8vIHRvdGFsU3VwcGx5IGlzIGRlY3JlYXNlZAogICAgICAgICAgZGlzdHJpYnV0ZWRTYWxlU3Rha2VzIC09IHNhbGVTdGF0W21zZy5zZW5kZXJdLnN0YWtlczsKICAgICAgICAgIGlmKHNhbGVTdGF0W21zZy5zZW5kZXJdLmd1aWRlICE9IGFkZHJlc3MoMCkpIHsgLy8gd2UgaGF2ZSBHdWlkZSBhbmQgYm9udXNTdGFrZXMKICAgICAgICAgICAgLy8gcG90ZW50aWFsIHJld2FyZCBmb3IgdGhlIEd1aWRlIGlzIGRlY3JlYXNlZCBwcm9wb3J0aW9uYWxseQogICAgICAgICAgICBndWlkZXNTdGF0W3NhbGVTdGF0W21zZy5zZW5kZXJdLmd1aWRlXS5hY2N1bXVsYXRlZFBvdGVudGlhbFJld2FyZCAtPSAoc2FsZVN0YXRbbXNnLnNlbmRlcl0uZ3VpZGVSZXdhcmQgLSAoKGkrMSkqc2FsZVN0YXRbbXNnLnNlbmRlcl0uZ3VpZGVSZXdhcmQpL2ZpbmFuY2VQZXJpb2RzQ291bnQpOyAKICAgICAgICAgICAgZGlzdHJpYnV0ZWRCb251c1N0YWtlcyAtPSBzYWxlU3RhdFttc2cuc2VuZGVyXS5ib251c1N0YWtlczsKICAgICAgICAgICAgc2FsZVN0YXRbbXNnLnNlbmRlcl0uYm9udXNTdGFrZXMgPSAwOwogICAgICAgICAgICBzYWxlU3RhdFttc2cuc2VuZGVyXS5ndWlkZVJld2FyZCA9IDA7ICAgICAgICAgIAogICAgICAgICAgfQogICAgICAgICAgc2FsZVN0YXRbbXNnLnNlbmRlcl0uc3Rha2VzID0gMDsgLy8gbnVsbGlmeSBTdGFrZXMgcmVjaWV2ZWQgdmFsdWUgICAgICAgICAgCiAgICAgICAgICBzYWxlU3RhdFttc2cuc2VuZGVyXS5pbnZlc3RlZCA9IDA7IC8vIG51bGxpZnkgd2VpIGludmVzdGVkIHZhbHVlCiAgICAgICAgICB0b3RhbFdpdGhkcmF3biArPSB0b193aXRoZHJhdzsKICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodG9fd2l0aGRyYXcpOyAvLyB3aXRkcmF3IGludmVzdG1lbnQKICAgICAgICAgIEludmVzdG1lbnRXaXRoZHJhd24obXNnLnNlbmRlciwgdG9fd2l0aGRyYXcsIHNhbGVfc3Rha2VzX3RvX2J1cm4sIGZpbmFuY2VQZXJpb2RzQ291bnQtaS0xKTsgICAgICAgICAgCiAgICAgICAgICBicmVhazsgIAogICAgICAgIH0KICAgICAgfSAgICAgIAogICAgfQogIC8qKgogICAqIEBkZXYgRGlzdHJpYnV0ZSBib3VudHkgcmV3YXJkcyBmb3IgYm91bnR5IHRhc2tzCiAgICogQHBhcmFtIF90byBpcyBhZGRyZXNzIG9mIGJvdW50eSBodW50ZXIKICAgKiBAcGFyYW0gX3N0YWtlcyBpcyBxdWFudGl0eSBvZiBTdGFrZXMgdHJhbnNmZXJlZCAgICAgICAKICAgKi8gICAgIAogICAgZnVuY3Rpb24gZGlzdHJpYnV0ZUJvdW50eShhZGRyZXNzIF90bywgdWludCBfc3Rha2VzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgcmVxdWlyZShkaXN0cmlidXRlZEJvdW50eVN0YWtlcytfc3Rha2VzIDw9IGJvdW50eUNhcCk7IC8vIG5vIG1vcmUgdGhlbiBtYXhpbXVtIGNhcGFjaXR5IGNhbiBiZSBkaXN0cmlidXRlZAogICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3N0YWtlcyk7IC8vIHRvCiAgICAgIHRvdGFsU3VwcGx5ICs9IF9zdGFrZXM7IAogICAgICBkaXN0cmlidXRlZEJvdW50eVN0YWtlcyArPSBfc3Rha2VzOyAvLyBhZGRpbmcgdG8gdG90YWwgYm91bnR5IGRpc3RyaWJ1dGVkCiAgICAgIEJvdW50eURpc3RyaWJ1dGVkKF90bywgX3N0YWtlcyk7ICAgIAogICAgfSAgCiAgLyoqCiAgICogQGRldiBVbmZyZWV6ZSB0ZWFtIFN0YWtlcy4gT25seSBhZnRlciBleGNlc3NlZCBTdGFrZXMgaGF2ZSBidXJuZWQuCiAgICovICAgICAgCiAgICBmdW5jdGlvbiB1bkZyZWV6ZSgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAvLyBvbmx5IGFmdGVyIHBsYW5uZWQgcGVyaW9kCiAgICAgIGlmKG5vdyA+IGJ1c2luZXNzUGxhbm5lZFBlcmlvZEVuZFRpbWVzdGFtcCkgewogICAgICAgIHRlYW1TdGFrZXNGcm96ZW4gPSBmYWxzZTsgLy8gbWFrZSB0ZWFtIHN0YWtlcyBhdmFpbGFibGUgZm9yIHRyYW5zZmVyaW5nCiAgICAgIH0gIAogICAgfQp9'.
	

]
