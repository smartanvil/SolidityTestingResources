Class {
	#name : #SRT5936d34a49aaa7bbaeffba2cf7f7c191bd96477d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5936d34a49aaa7bbaeffba2cf7f7c191bd96477d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjsKCgovLyA8T1JBQ0xJWkVfQVBJPgovKgpDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNiBPcmFjbGl6ZSBTUkwKQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURAoKCgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5Cm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbApjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCgoKVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgoKClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwgVEhFCkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgpUSEUgU09GVFdBUkUuCiovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4wOwoKCi8vcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIHdoZW4gc29saWRpdHkgPCAwLjQuMAoKY29udHJhY3QgT3JhY2xpemVJIHsKICAgIGFkZHJlc3MgcHVibGljIGNiQWRkcmVzczsKCiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwoKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKCiAgICBmdW5jdGlvbiBxdWVyeTIodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKCiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwoKICAgIGZ1bmN0aW9uIHF1ZXJ5Tih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04pIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwoKICAgIGZ1bmN0aW9uIHF1ZXJ5Tl93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOLCB1aW50IF9nYXNsaW1pdCkgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CgogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKCiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwoKICAgIGZ1bmN0aW9uIHVzZUNvdXBvbihzdHJpbmcgX2NvdXBvbik7CgogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSk7CgogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7CgogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpOwoKICAgIGZ1bmN0aW9uIHJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgcmV0dXJucyAoYnl0ZXMzMik7Cn0KCgpjb250cmFjdCBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgewogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOwp9CgoKY29udHJhY3QgdXNpbmdPcmFjbGl6ZSB7CiAgICB1aW50IGNvbnN0YW50IGRheSA9IDYwICogNjAgKiAyNDsKCiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCAqIDYwICogMjQgKiA3OwoKICAgIHVpbnQgY29uc3RhbnQgbW9udGggPSA2MCAqIDYwICogMjQgKiAzMDsKCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsKCiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOwoKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0FuZHJvaWQgPSAweDIwOwoKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0xlZGdlciA9IDB4MzA7CgogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTmF0aXZlID0gMHhGMDsKCiAgICBieXRlIGNvbnN0YW50IHByb29mU3RvcmFnZV9JUEZTID0gMHgwMTsKCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CgogICAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21haW5uZXQgPSAxOwoKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF90ZXN0bmV0ID0gMjsKCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKCiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfY29uc2Vuc3lzID0gMTYxOwoKICAgIE9yYWNsaXplQWRkclJlc29sdmVySSBPQVI7CgogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmICgoYWRkcmVzcyhPQVIpID09IDApIHx8IChnZXRDb2RlU2l6ZShhZGRyZXNzKE9BUikpID09IDApKSBvcmFjbGl6ZV9zZXROZXR3b3JrKG5ldHdvcmtJRF9hdXRvKTsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCkgPiAwKSB7Ly9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpID4gMCkgey8vcm9wc3RlbiB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JvcHN0ZW4zIik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKSA+IDApIHsvL2tvdmFuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpID4gMCkgey8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpID4gMCkgey8vZXRoZXJldW0tYnJpZGdlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MjBlMTJBMUY4NTlCM0ZlYUU1RmIyQTBBMzJDMThGNWE2NTU1NWJCRikgPiAwKSB7Ly9ldGhlci5jYW1wIGlkZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpID4gMCkgey8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgewogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3VzZUNvdXBvbihzdHJpbmcgY29kZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplLnVzZUNvdXBvbihjb2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9nZXRQcmljZShzdHJpbmcgZGF0YXNvdXJjZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAodWludCl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogZ2FzbGltaXQpIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIDIwMDAwMCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIDIwMDAwMCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gc3RyYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiAyMDAwMDApIHJldHVybiAwOwogICAgICAgIC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlICogMjAwMDAwKSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSAqIGdhc2xpbWl0KSByZXR1cm4gMDsKICAgICAgICAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UgKiBnYXNsaW1pdCkgcmV0dXJuIDA7CiAgICAgICAgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IGJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzNdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzRdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9jYkFkZHJlc3MoKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UodWludCBnYXNQcmljZSkgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0Q29uZmlnKGJ5dGVzMzIgY29uZmlnKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldENvbmZpZyhjb25maWcpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29kZVNpemUoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VBZGRyKHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50MTYwIGlhZGRyID0gMDsKICAgICAgICB1aW50MTYwIGIxOwogICAgICAgIHVpbnQxNjAgYjI7CiAgICAgICAgZm9yICh1aW50IGkgPSAyOyBpIDwgMiArIDIgKiAyMDsgaSArPSAyKSB7CiAgICAgICAgICAgIGlhZGRyICo9IDI1NjsKICAgICAgICAgICAgYjEgPSB1aW50MTYwKHRtcFtpXSk7CiAgICAgICAgICAgIGIyID0gdWludDE2MCh0bXBbaSArIDFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykgJiYgKGIxIDw9IDEwMikpIGIxIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNjUpICYmIChiMSA8PSA3MCkpIGIxIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNDgpICYmIChiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSAmJiAoYjIgPD0gMTAyKSkgYjIgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA2NSkgJiYgKGIyIDw9IDcwKSkgYjIgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkgJiYgKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSAqIDE2ICsgYjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29tcGFyZShzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykKICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgcmV0dXJuIC0gMTsKICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkKICAgICAgICByZXR1cm4gMTsKICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkKICAgICAgICByZXR1cm4gLSAxOwogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpCiAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgZWxzZQogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmIChoLmxlbmd0aCA8IDEgfHwgbi5sZW5ndGggPCAxIHx8IChuLmxlbmd0aCA+IGgubGVuZ3RoKSkKICAgICAgICByZXR1cm4gLSAxOwogICAgICAgIGVsc2UgaWYgKGgubGVuZ3RoID4gKDIgKiogMTI4IC0gMSkpCiAgICAgICAgcmV0dXJuIC0gMTsKICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaC5sZW5ndGg7IGkgKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPSAxOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YmluZGV4ID09IG4ubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0gMTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCwgc3RyaW5nIF9lKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgIiIsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCAiIiwgIiIsICIiKTsKICAgIH0KCiAgICAvLyBwYXJzZUludAogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICAgICAgdWludCBtaW50ID0gMDsKICAgICAgICBib29sIGRlY2ltYWxzID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYnJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpICYmIChicmVzdWx0W2ldIDw9IDU3KSkgewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGVsc2UgX2ItLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7CiAgICAgICAgICAgICAgICBtaW50ICs9IHVpbnQoYnJlc3VsdFtpXSkgLSA0ODsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChfYiA+IDApIG1pbnQgKj0gMTAgKiogX2I7CiAgICAgICAgcmV0dXJuIG1pbnQ7CiAgICB9CgogICAgZnVuY3Rpb24gdWludDJzdHIodWludCBpKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpewogICAgICAgIGlmIChpID09IDApIHJldHVybiAiMCI7CiAgICAgICAgdWludCBqID0gaTsKICAgICAgICB1aW50IGxlbjsKICAgICAgICB3aGlsZSAoaiAhPSAwKSB7CiAgICAgICAgICAgIGxlbisrOwogICAgICAgICAgICBqIC89IDEwOwogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYnN0ciA9IG5ldyBieXRlcyhsZW4pOwogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7CiAgICAgICAgd2hpbGUgKGkgIT0gMCkgewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJhMmNib3Ioc3RyaW5nW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkgLyAyMyArIDM7CiAgICAgICAgICAgIC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgfQogICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgY3RyKys7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgIGN0cisrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhMmNib3IoYnl0ZXNbXSBhcnIpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKSAvIDIzICsgMzsKICAgICAgICAgICAgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICB9CiAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICBjdHIrKzsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgY3RyKys7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXM7CiAgICB9CgoKICAgIHN0cmluZyBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29ya05hbWUoc3RyaW5nIF9uZXR3b3JrX25hbWUpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9uZXR3b3JrX25hbWUgPSBfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KHVpbnQgX2RlbGF5LCB1aW50IF9uYnl0ZXMsIHVpbnQgX2N1c3RvbUdhc0xpbWl0KSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyKXsKICAgICAgICBpZiAoKF9uYnl0ZXMgPT0gMCkgfHwgKF9uYnl0ZXMgPiAzMikpIHRocm93OwogICAgICAgIGJ5dGVzIG1lbW9yeSBuYnl0ZXMgPSBuZXcgYnl0ZXMoMSk7CiAgICAgICAgbmJ5dGVzWzBdID0gYnl0ZShfbmJ5dGVzKTsKICAgICAgICBieXRlcyBtZW1vcnkgdW5vbmNlID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvbktleUhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzMzIgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMiA9IG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgIG1zdG9yZSh1bm9uY2UsIDB4MjApCiAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkKICAgICAgICBtc3RvcmUoc2Vzc2lvbktleUhhc2gsIDB4MjApCiAgICAgICAgbXN0b3JlKGFkZChzZXNzaW9uS2V5SGFzaCwgMHgyMCksIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIpCiAgICAgICAgfQogICAgICAgIGJ5dGVzWzNdIG1lbW9yeSBhcmdzID0gW3Vub25jZSwgbmJ5dGVzLCBzZXNzaW9uS2V5SGFzaF07CiAgICAgICAgYnl0ZXMzMiBxdWVyeUlkID0gb3JhY2xpemVfcXVlcnkoX2RlbGF5LCAicmFuZG9tIiwgYXJncywgX2N1c3RvbUdhc0xpbWl0KTsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KHF1ZXJ5SWQsIHNoYTMoYnl0ZXM4KF9kZWxheSksIGFyZ3NbMV0sIHNoYTI1NihhcmdzWzBdKSwgYXJnc1syXSkpOwogICAgICAgIHJldHVybiBxdWVyeUlkOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3NldENvbW1pdG1lbnQoYnl0ZXMzMiBxdWVyeUlkLCBieXRlczMyIGNvbW1pdG1lbnQpIGludGVybmFsIHsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID0gY29tbWl0bWVudDsKICAgIH0KCiAgICBtYXBwaW5nIChieXRlczMyID0+IGJ5dGVzMzIpIG9yYWNsaXplX3JhbmRvbURTX2FyZ3M7CgogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBib29sKSBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZDsKCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWcoYnl0ZXMzMiB0b3NpZ25oLCBieXRlcyBkZXJzaWcsIGJ5dGVzIHB1YmtleSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBzaWdvazsKICAgICAgICBhZGRyZXNzIHNpZ25lcjsKCiAgICAgICAgYnl0ZXMzMiBzaWdyOwogICAgICAgIGJ5dGVzMzIgc2lnczsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3JfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IG9mZnNldCA9IDQgKyAodWludChkZXJzaWdbM10pIC0gMHgyMCk7CiAgICAgICAgc2lncl8gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQsIDMyLCBzaWdyXywgMCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3NfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBvZmZzZXQgKz0gMzIgKyAyOwogICAgICAgIHNpZ3NfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0ICsgKHVpbnQoZGVyc2lnW29mZnNldCAtIDFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgc2lnciA6PSBtbG9hZChhZGQoc2lncl8sIDMyKSkKICAgICAgICBzaWdzIDo9IG1sb2FkKGFkZChzaWdzXywgMzIpKQogICAgICAgIH0KCgogICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyNywgc2lnciwgc2lncyk7CiAgICAgICAgaWYgKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICAoc2lnb2ssIHNpZ25lcikgPSBzYWZlcl9lY3JlY292ZXIodG9zaWduaCwgMjgsIHNpZ3IsIHNpZ3MpOwogICAgICAgICAgICByZXR1cm4gKGFkZHJlc3Moc2hhMyhwdWJrZXkpKSA9PSBzaWduZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KGJ5dGVzIHByb29mLCB1aW50IHNpZzJvZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHNpZ29rOwoKICAgICAgICAvLyBTdGVwIDY6IHZlcmlmeSB0aGUgYXR0ZXN0YXRpb24gc2lnbmF0dXJlLCBBUFBLRVkxIG11c3Qgc2lnbiB0aGUgc2Vzc2lvbktleSBmcm9tIHRoZSBjb3JyZWN0IGxlZGdlciBhcHAgKENPREVIQVNIKQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcyID0gbmV3IGJ5dGVzKHVpbnQocHJvb2Zbc2lnMm9mZnNldCArIDFdKSArIDIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCwgc2lnMi5sZW5ndGgsIHNpZzIsIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgYXBwa2V5MV9wdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMyArIDEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24yID0gbmV3IGJ5dGVzKDEgKyA2NSArIDMyKTsKICAgICAgICB0b3NpZ24yWzBdID0gMTsKICAgICAgICAvL3JvbGUKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQgLSA2NSwgNjUsIHRvc2lnbjIsIDEpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsKICAgICAgICBjb3B5Qnl0ZXMoQ09ERUhBU0gsIDAsIDMyLCB0b3NpZ24yLCAxICsgNjUpOwogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24yKSwgc2lnMiwgYXBwa2V5MV9wdWJrZXkpOwoKICAgICAgICBpZiAoc2lnb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNzogdmVyaWZ5IHRoZSBBUFBLRVkxIHByb3ZlbmFuY2UgKG11c3QgYmUgc2lnbmVkIGJ5IExlZGdlcikKICAgICAgICBieXRlcyBtZW1vcnkgTEVER0VSS0VZID0gaGV4IjdmYjk1NjQ2OWM1YzliODk4NDBkNTViNDM1MzdlNjZhOThkZDQ4MTFlYTBhMjcyMjQyNzJjMmU1NjIyOTExZTg1MzdhMmY4ZTg2YTQ2YmFlYzgyODY0ZTk4ZGQwMWU5Y2NjMmY4YmM1ZGZjOWNiZTVhOTFhMjkwNDk4ZGQ5NmU0IjsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjMgPSBuZXcgYnl0ZXMoMSArIDY1KTsKICAgICAgICB0b3NpZ24zWzBdID0gMHhGRTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMsIDY1LCB0b3NpZ24zLCAxKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzMgPSBuZXcgYnl0ZXModWludChwcm9vZlszICsgNjUgKyAxXSkgKyAyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMgKyA2NSwgc2lnMy5sZW5ndGgsIHNpZzMsIDApOwoKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMyksIHNpZzMsIExFREdFUktFWSk7CgogICAgICAgIHJldHVybiBzaWdvazsKICAgIH0KCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpIHx8IChfcHJvb2ZbMV0gIT0gIlAiKSB8fCAoX3Byb29mWzJdICE9IDEpKSB0aHJvdzsKCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOwogICAgICAgIGlmIChwcm9vZlZlcmlmaWVkID09IGZhbHNlKSB0aHJvdzsKCiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXRjaEJ5dGVzMzJQcmVmaXgoYnl0ZXMzMiBjb250ZW50LCBieXRlcyBwcmVmaXgpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgbWF0Y2hfID0gdHJ1ZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmVmaXgubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbnRlbnRbaV0gIT0gcHJlZml4W2ldKSBtYXRjaF8gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKICAgICAgICBib29sIGNoZWNrb2s7CgoKICAgICAgICAvLyBTdGVwIDI6IHRoZSB1bmlxdWUga2V5aGFzaCBoYXMgdG8gbWF0Y2ggd2l0aCB0aGUgc2hhMjU2IG9mIChjb250ZXh0IG5hbWUgKyBxdWVyeUlkKQogICAgICAgIHVpbnQgbGVkZ2VyUHJvb2ZMZW5ndGggPSAzICsgNjUgKyAodWludChwcm9vZlszICsgNjUgKyAxXSkgKyAyKSArIDMyOwogICAgICAgIGJ5dGVzIG1lbW9yeSBrZXloYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMiwga2V5aGFzaCwgMCk7CiAgICAgICAgY2hlY2tvayA9IChzaGEzKGtleWhhc2gpID09IHNoYTMoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKTsKICAgICAgICBpZiAoY2hlY2tvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoICsgKDMyICsgOCArIDEgKyAzMikgKyAxXSkgKyAyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoICsgKDMyICsgOCArIDEgKyAzMiksIHNpZzEubGVuZ3RoLCBzaWcxLCAwKTsKCgogICAgICAgIC8vIFN0ZXAgMzogd2UgYXNzdW1lIHNpZzEgaXMgdmFsaWQgKGl0IHdpbGwgYmUgdmVyaWZpZWQgZHVyaW5nIHN0ZXAgNSkgYW5kIHdlIHZlcmlmeSBpZiAncmVzdWx0JyBpcyB0aGUgcHJlZml4IG9mIHNoYTI1NihzaWcxKQogICAgICAgIGNoZWNrb2sgPSBtYXRjaEJ5dGVzMzJQcmVmaXgoc2hhMjU2KHNpZzEpLCByZXN1bHQpOwogICAgICAgIGlmIChjaGVja29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDQ6IGNvbW1pdG1lbnQgbWF0Y2ggdmVyaWZpY2F0aW9uLCBzaGEzKGRlbGF5LCBuYnl0ZXMsIHVub25jZSwgc2Vzc2lvbktleUhhc2gpID09IGNvbW1pdG1lbnQgaW4gc3RvcmFnZS4KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4KICAgICAgICBieXRlcyBtZW1vcnkgY29tbWl0bWVudFNsaWNlMSA9IG5ldyBieXRlcyg4ICsgMSArIDMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoICsgMzIsIDggKyAxICsgMzIsIGNvbW1pdG1lbnRTbGljZTEsIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvblB1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgdWludCBzaWcyb2Zmc2V0ID0gbGVkZ2VyUHJvb2ZMZW5ndGggKyAzMiArICg4ICsgMSArIDMyKSArIHNpZzEubGVuZ3RoICsgNjU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0IC0gNjQsIDY0LCBzZXNzaW9uUHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uUHVia2V5SGFzaCA9IHNoYTI1NihzZXNzaW9uUHVia2V5KTsKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9PSBzaGEzKGNvbW1pdG1lbnRTbGljZTEsIHNlc3Npb25QdWJrZXlIYXNoKSkgey8vdW5vbmNlLCBuYnl0ZXMgYW5kIHNlc3Npb25LZXlIYXNoIG1hdGNoCiAgICAgICAgICAgIGRlbGV0ZSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdOwogICAgICAgIH0KICAgICAgICBlbHNlIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyICsgOCArIDEgKyAzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIgKyA4ICsgMSArIDMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBjaGVja29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSk7CiAgICAgICAgaWYgKGNoZWNrb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gdmVyaWZ5IGlmIHNlc3Npb25QdWJrZXlIYXNoIHdhcyB2ZXJpZmllZCBhbHJlYWR5LCBpZiBub3QuLiBsZXQncyBkbyBpdCEKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID09IGZhbHNlKSB7CiAgICAgICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkocHJvb2YsIHNpZzJvZmZzZXQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXTsKICAgIH0KCgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGNvcHlCeXRlcyhieXRlcyBmcm9tLCB1aW50IGZyb21PZmZzZXQsIHVpbnQgbGVuZ3RoLCBieXRlcyB0bywgdWludCB0b09mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGxlbmd0aCArIHRvT2Zmc2V0OwoKICAgICAgICBpZiAodG8ubGVuZ3RoIDwgbWluTGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIEJ1ZmZlciB0b28gc21hbGwKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgICAgIC8vIFNob3VsZCBiZSBhIGJldHRlciB3YXk/CiAgICAgICAgfQoKICAgICAgICAvLyBOT1RFOiB0aGUgb2Zmc2V0IDMyIGlzIGFkZGVkIHRvIHNraXAgdGhlIGBzaXplYCBmaWVsZCBvZiBib3RoIGJ5dGVzIHZhcmlhYmxlcwogICAgICAgIHVpbnQgaSA9IDMyICsgZnJvbU9mZnNldDsKICAgICAgICB1aW50IGogPSAzMiArIHRvT2Zmc2V0OwoKICAgICAgICB3aGlsZSAoaSA8ICgzMiArIGZyb21PZmZzZXQgKyBsZW5ndGgpKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHRtcCA6PSBtbG9hZChhZGQoZnJvbSwgaSkpCiAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgLy8gRHVwbGljYXRlIFNvbGlkaXR5J3MgZWNyZWNvdmVyLCBidXQgY2F0Y2hpbmcgdGhlIENBTEwgcmV0dXJuIHZhbHVlCiAgICBmdW5jdGlvbiBzYWZlcl9lY3JlY292ZXIoYnl0ZXMzMiBoYXNoLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgewogICAgICAgIC8vIFdlIGRvIG91ciBvd24gbWVtb3J5IG1hbmFnZW1lbnQgaGVyZS4gU29saWRpdHkgdXNlcyBtZW1vcnkgb2Zmc2V0CiAgICAgICAgLy8gMHg0MCB0byBzdG9yZSB0aGUgY3VycmVudCBlbmQgb2YgbWVtb3J5LiBXZSB3cml0ZSBwYXN0IGl0IChhcwogICAgICAgIC8vIHdyaXRlcyBhcmUgbWVtb3J5IGV4dGVuc2lvbnMpLCBidXQgZG9uJ3QgdXBkYXRlIHRoZSBvZmZzZXQgc28KICAgICAgICAvLyBTb2xpZGl0eSB3aWxsIHJldXNlIGl0LiBUaGUgbWVtb3J5IHVzZWQgaGVyZSBpcyBvbmx5IG5lZWRlZCBmb3IKICAgICAgICAvLyB0aGlzIGNvbnRleHQuCgogICAgICAgIC8vIEZJWE1FOiBpbmxpbmUgYXNzZW1ibHkgY2FuJ3QgYWNjZXNzIHJldHVybiB2YWx1ZXMKICAgICAgICBib29sIHJldDsKICAgICAgICBhZGRyZXNzIGFkZHI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICBsZXQgc2l6ZSA6PSBtbG9hZCgweDQwKQogICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgMzIpLCB2KQogICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgNjQpLCByKQogICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAvLyBOT1RFOiB3ZSBjYW4gcmV1c2UgdGhlIHJlcXVlc3QgbWVtb3J5IGJlY2F1c2Ugd2UgZGVhbCB3aXRoCiAgICAgICAgLy8gICAgICAgdGhlIHJldHVybiBjb2RlCiAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICBhZGRyIDo9IG1sb2FkKHNpemUpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICBzIDo9IG1sb2FkKGFkZChzaWcsIDY0KSkKCiAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAvLyBUaGVyZSBpcyBubyAnbWxvYWQ4JyB0byBkbyB0aGlzLCBidXQgdGhhdCB3b3VsZCBiZSBuaWNlci4KICAgICAgICB2CiAgICAgICAgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQoKICAgICAgICAvLyBBbHRlcm5hdGl2ZSBzb2x1dGlvbjoKICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMKICAgICAgICAvLyB1c2UgdGhlIHNlY29uZCBiZXN0IG9wdGlvbiwgJ2FuZCcKICAgICAgICAvLyB2IDo9IGFuZChtbG9hZChhZGQoc2lnLCA2NSkpLCAyNTUpCiAgICB9CgoKLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0Ci8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQovLwovLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToKLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwppZiAodiA8IDI3KQp2ICs9IDI3OwoKaWYgKHYgIT0gMjcgJiYgdiAhPSAyOCkKcmV0dXJuIChmYWxzZSwgMCk7CgpyZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwp9Cgp9Ci8vIDwvT1JBQ0xJWkVfQVBJPgoKLyoKICogQHRpdGxlIFN0cmluZyAmIHNsaWNlIHV0aWxpdHkgbGlicmFyeSBmb3IgU29saWRpdHkgY29udHJhY3RzLgogKiBAYXV0aG9yIE5pY2sgSm9obnNvbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjkzZjJlMWYyZjBmYmZkZmFmN2QzZmRmY2U3ZjdmY2U3YmRmZGY2ZTciPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgogKgogKiBAZGV2IEZ1bmN0aW9uYWxpdHkgaW4gdGhpcyBsaWJyYXJ5IGlzIGxhcmdlbHkgaW1wbGVtZW50ZWQgdXNpbmcgYW4KICogICAgICBhYnN0cmFjdGlvbiBjYWxsZWQgYSAnc2xpY2UnLiBBIHNsaWNlIHJlcHJlc2VudHMgYSBwYXJ0IG9mIGEgc3RyaW5nIC0KICogICAgICBhbnl0aGluZyBmcm9tIHRoZSBlbnRpcmUgc3RyaW5nIHRvIGEgc2luZ2xlIGNoYXJhY3Rlciwgb3IgZXZlbiBubwogKiAgICAgIGNoYXJhY3RlcnMgYXQgYWxsIChhIDAtbGVuZ3RoIHNsaWNlKS4gU2luY2UgYSBzbGljZSBvbmx5IGhhcyB0byBzcGVjaWZ5CiAqICAgICAgYW4gb2Zmc2V0IGFuZCBhIGxlbmd0aCwgY29weWluZyBhbmQgbWFuaXB1bGF0aW5nIHNsaWNlcyBpcyBhIGxvdCBsZXNzCiAqICAgICAgZXhwZW5zaXZlIHRoYW4gY29weWluZyBhbmQgbWFuaXB1bGF0aW5nIHRoZSBzdHJpbmdzIHRoZXkgcmVmZXJlbmNlLgogKgogKiAgICAgIFRvIGZ1cnRoZXIgcmVkdWNlIGdhcyBjb3N0cywgbW9zdCBmdW5jdGlvbnMgb24gc2xpY2UgdGhhdCBuZWVkIHRvIHJldHVybgogKiAgICAgIGEgc2xpY2UgbW9kaWZ5IHRoZSBvcmlnaW5hbCBvbmUgaW5zdGVhZCBvZiBhbGxvY2F0aW5nIGEgbmV3IG9uZTsgZm9yCiAqICAgICAgaW5zdGFuY2UsIGBzLnNwbGl0KCIuIilgIHdpbGwgcmV0dXJuIHRoZSB0ZXh0IHVwIHRvIHRoZSBmaXJzdCAnLicsCiAqICAgICAgbW9kaWZ5aW5nIHMgdG8gb25seSBjb250YWluIHRoZSByZW1haW5kZXIgb2YgdGhlIHN0cmluZyBhZnRlciB0aGUgJy4nLgogKiAgICAgIEluIHNpdHVhdGlvbnMgd2hlcmUgeW91IGRvIG5vdCB3YW50IHRvIG1vZGlmeSB0aGUgb3JpZ2luYWwgc2xpY2UsIHlvdQogKiAgICAgIGNhbiBtYWtlIGEgY29weSBmaXJzdCB3aXRoIGAuY29weSgpYCwgZm9yIGV4YW1wbGU6CiAqICAgICAgYHMuY29weSgpLnNwbGl0KCIuIilgLiBUcnkgYW5kIGF2b2lkIHVzaW5nIHRoaXMgaWRpb20gaW4gbG9vcHM7IHNpbmNlCiAqICAgICAgU29saWRpdHkgaGFzIG5vIG1lbW9yeSBtYW5hZ2VtZW50LCBpdCB3aWxsIHJlc3VsdCBpbiBhbGxvY2F0aW5nIG1hbnkKICogICAgICBzaG9ydC1saXZlZCBzbGljZXMgdGhhdCBhcmUgbGF0ZXIgZGlzY2FyZGVkLgogKgogKiAgICAgIEZ1bmN0aW9ucyB0aGF0IHJldHVybiB0d28gc2xpY2VzIGNvbWUgaW4gdHdvIHZlcnNpb25zOiBhIG5vbi1hbGxvY2F0aW5nCiAqICAgICAgdmVyc2lvbiB0aGF0IHRha2VzIHRoZSBzZWNvbmQgc2xpY2UgYXMgYW4gYXJndW1lbnQsIG1vZGlmeWluZyBpdCBpbgogKiAgICAgIHBsYWNlLCBhbmQgYW4gYWxsb2NhdGluZyB2ZXJzaW9uIHRoYXQgYWxsb2NhdGVzIGFuZCByZXR1cm5zIHRoZSBzZWNvbmQKICogICAgICBzbGljZTsgc2VlIGBuZXh0UnVuZWAgZm9yIGV4YW1wbGUuCiAqCiAqICAgICAgRnVuY3Rpb25zIHRoYXQgaGF2ZSB0byBjb3B5IHN0cmluZyBkYXRhIHdpbGwgcmV0dXJuIHN0cmluZ3MgcmF0aGVyIHRoYW4KICogICAgICBzbGljZXM7IHRoZXNlIGNhbiBiZSBjYXN0IGJhY2sgdG8gc2xpY2VzIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcgaWYKICogICAgICByZXF1aXJlZC4KICoKICogICAgICBGb3IgY29udmVuaWVuY2UsIHNvbWUgZnVuY3Rpb25zIGFyZSBwcm92aWRlZCB3aXRoIG5vbi1tb2RpZnlpbmcKICogICAgICB2YXJpYW50cyB0aGF0IGNyZWF0ZSBhIG5ldyBzbGljZSBhbmQgcmV0dXJuIGJvdGg7IGZvciBpbnN0YW5jZSwKICogICAgICBgcy5zcGxpdE5ldygnLicpYCBsZWF2ZXMgcyB1bm1vZGlmaWVkLCBhbmQgcmV0dXJucyB0d28gdmFsdWVzCiAqICAgICAgY29ycmVzcG9uZGluZyB0byB0aGUgbGVmdCBhbmQgcmlnaHQgcGFydHMgb2YgdGhlIHN0cmluZy4KICovCmxpYnJhcnkgc3RyaW5ncyB7CnN0cnVjdCBzbGljZSB7CnVpbnQgX2xlbjsKdWludCBfcHRyOwp9CgpmdW5jdGlvbiBtZW1jcHkodWludCBkZXN0LCB1aW50IHNyYywgdWludCBsZW4pIHByaXZhdGUgewovLyBDb3B5IHdvcmQtbGVuZ3RoIGNodW5rcyB3aGlsZSBwb3NzaWJsZQpmb3IgKDsgbGVuID49IDMyOyBsZW4gLT0gMzIpIHsKYXNzZW1ibHkgewptc3RvcmUoZGVzdCwgbWxvYWQoc3JjKSkKfQpkZXN0ICs9IDMyOwpzcmMgKz0gMzI7Cn0KCi8vIENvcHkgcmVtYWluaW5nIGJ5dGVzCnVpbnQgbWFzayA9IDI1NiAqKiAoMzIgLSBsZW4pIC0gMTsKYXNzZW1ibHkgewpsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQpsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKGRlc3QpLCBtYXNrKQptc3RvcmUoZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQp9Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuCiAqIEBwYXJhbSBzZWxmIFRoZSBzdHJpbmcgdG8gbWFrZSBhIHNsaWNlIGZyb20uCiAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICovCmZ1bmN0aW9uIHRvU2xpY2Uoc3RyaW5nIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CnVpbnQgcHRyOwphc3NlbWJseSB7CnB0ciA6PSBhZGQoc2VsZiwgMHgyMCkKfQpyZXR1cm4gc2xpY2UoYnl0ZXMoc2VsZikubGVuZ3RoLCBwdHIpOwp9CgovKgogKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBvZiBhIG51bGwtdGVybWluYXRlZCBieXRlczMyIHN0cmluZy4KICogQHBhcmFtIHNlbGYgVGhlIHZhbHVlIHRvIGZpbmQgdGhlIGxlbmd0aCBvZi4KICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcsIGZyb20gMCB0byAzMi4KICovCmZ1bmN0aW9uIGxlbihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKdWludCByZXQ7CmlmIChzZWxmID09IDApCnJldHVybiAwOwppZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewpyZXQgKz0gMTY7CnNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCk7Cn0KaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewpyZXQgKz0gODsKc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDApOwp9CmlmIChzZWxmICYgMHhmZmZmZmZmZiA9PSAwKSB7CnJldCArPSA0OwpzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDApOwp9CmlmIChzZWxmICYgMHhmZmZmID09IDApIHsKcmV0ICs9IDI7CnNlbGYgPSBieXRlczMyKHVpbnQoc2VsZikgLyAweDEwMDAwKTsKfQppZiAoc2VsZiAmIDB4ZmYgPT0gMCkgewpyZXQgKz0gMTsKfQpyZXR1cm4gMzIgLSByZXQ7Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBieXRlczMyLCBpbnRlcnByZXRlZCBhcyBhCiAqICAgICAgbnVsbC10ZXJtaW50YWVkIHV0Zi04IHN0cmluZy4KICogQHBhcmFtIHNlbGYgVGhlIGJ5dGVzMzIgdmFsdWUgdG8gY29udmVydCB0byBhIHNsaWNlLgogKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHZhbHVlIG9mIHRoZSBpbnB1dCBhcmd1bWVudCB1cCB0byB0aGUKICogICAgICAgICBmaXJzdCBudWxsLgogKi8KZnVuY3Rpb24gdG9TbGljZUIzMihieXRlczMyIHNlbGYpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHJldCkgewovLyBBbGxvY2F0ZSBzcGFjZSBmb3IgYHNlbGZgIGluIG1lbW9yeSwgY29weSBpdCB0aGVyZSwgYW5kIHBvaW50IHJldCBhdCBpdAphc3NlbWJseSB7CmxldCBwdHIgOj0gbWxvYWQoMHg0MCkKbXN0b3JlKDB4NDAsIGFkZChwdHIsIDB4MjApKQptc3RvcmUocHRyLCBzZWxmKQptc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikKfQpyZXQuX2xlbiA9IGxlbihzZWxmKTsKfQoKLyoKICogQGRldiBSZXR1cm5zIGEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyB0aGUgY3VycmVudCBzbGljZS4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuCiAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIGBzZWxmYC4KICovCmZ1bmN0aW9uIGNvcHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKcmV0dXJuIHNsaWNlKHNlbGYuX2xlbiwgc2VsZi5fcHRyKTsKfQoKLyoKICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBjb3B5LgogKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHN0cmluZyBjb250YWluaW5nIHRoZSBzbGljZSdzIHRleHQuCiAqLwpmdW5jdGlvbiB0b1N0cmluZyhzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuKTsKdWludCByZXRwdHI7CmFzc2VtYmx5IHtyZXRwdHIgOj0gYWRkKHJldCwgMzIpfQoKbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwpyZXR1cm4gcmV0Owp9CgovKgogKiBAZGV2IFJldHVybnMgdGhlIGxlbmd0aCBpbiBydW5lcyBvZiB0aGUgc2xpY2UuIE5vdGUgdGhhdCB0aGlzIG9wZXJhdGlvbgogKiAgICAgIHRha2VzIHRpbWUgcHJvcG9ydGlvbmFsIHRvIHRoZSBsZW5ndGggb2YgdGhlIHNsaWNlOyBhdm9pZCB1c2luZyBpdAogKiAgICAgIGluIGxvb3BzLCBhbmQgY2FsbCBgc2xpY2UuZW1wdHkoKWAgaWYgeW91IG9ubHkgbmVlZCB0byBrbm93IHdoZXRoZXIKICogICAgICB0aGUgc2xpY2UgaXMgZW1wdHkgb3Igbm90LgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzbGljZSBpbiBydW5lcy4KICovCmZ1bmN0aW9uIGxlbihzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7Ci8vIFN0YXJ0aW5nIGF0IHB0ci0zMSBtZWFucyB0aGUgTFNCIHdpbGwgYmUgdGhlIGJ5dGUgd2UgY2FyZSBhYm91dAp2YXIgcHRyID0gc2VsZi5fcHRyIC0gMzE7CnZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47CmZvciAodWludCBsZW4gPSAwOyBwdHIgPCBlbmQ7IGxlbisrKSB7CnVpbnQ4IGI7CmFzc2VtYmx5IHtiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKX0KaWYgKGIgPCAweDgwKSB7CnB0ciArPSAxOwp9IGVsc2UgaWYgKGIgPCAweEUwKSB7CnB0ciArPSAyOwp9IGVsc2UgaWYgKGIgPCAweEYwKSB7CnB0ciArPSAzOwp9IGVsc2UgaWYgKGIgPCAweEY4KSB7CnB0ciArPSA0Owp9IGVsc2UgaWYgKGIgPCAweEZDKSB7CnB0ciArPSA1Owp9IGVsc2UgewpwdHIgKz0gNjsKfQp9CnJldHVybiBsZW47Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSAoaGFzIGEgbGVuZ3RoIG9mIDApLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSwgRmFsc2Ugb3RoZXJ3aXNlLgogKi8KZnVuY3Rpb24gZW1wdHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewpyZXR1cm4gc2VsZi5fbGVuID09IDA7Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyBhIHBvc2l0aXZlIG51bWJlciBpZiBgb3RoZXJgIGNvbWVzIGxleGljb2dyYXBoaWNhbGx5IGFmdGVyCiAqICAgICAgYHNlbGZgLCBhIG5lZ2F0aXZlIG51bWJlciBpZiBpdCBjb21lcyBiZWZvcmUsIG9yIHplcm8gaWYgdGhlCiAqICAgICAgY29udGVudHMgb2YgdGhlIHR3byBzbGljZXMgYXJlIGVxdWFsLiBDb21wYXJpc29uIGlzIGRvbmUgcGVyLXJ1bmUsCiAqICAgICAgb24gdW5pY29kZSBjb2RlcG9pbnRzLgogKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4KICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4KICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uLgogKi8KZnVuY3Rpb24gY29tcGFyZShzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoaW50KSB7CnVpbnQgc2hvcnRlc3QgPSBzZWxmLl9sZW47CmlmIChvdGhlci5fbGVuIDwgc2VsZi5fbGVuKQpzaG9ydGVzdCA9IG90aGVyLl9sZW47Cgp2YXIgc2VsZnB0ciA9IHNlbGYuX3B0cjsKdmFyIG90aGVycHRyID0gb3RoZXIuX3B0cjsKZm9yICh1aW50IGlkeCA9IDA7IGlkeCA8IHNob3J0ZXN0OyBpZHggKz0gMzIpIHsKdWludCBhOwp1aW50IGI7CmFzc2VtYmx5IHsKYSA6PSBtbG9hZChzZWxmcHRyKQpiIDo9IG1sb2FkKG90aGVycHRyKQp9CmlmIChhICE9IGIpIHsKLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4KdWludCBtYXNrID0gfigyICoqICg4ICogKDMyIC0gc2hvcnRlc3QgKyBpZHgpKSAtIDEpOwp2YXIgZGlmZiA9IChhICYgbWFzaykgLSAoYiAmIG1hc2spOwppZiAoZGlmZiAhPSAwKQpyZXR1cm4gaW50KGRpZmYpOwp9CnNlbGZwdHIgKz0gMzI7Cm90aGVycHRyICs9IDMyOwp9CnJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsKfQoKLyoKICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHR3byBzbGljZXMgY29udGFpbiB0aGUgc2FtZSB0ZXh0LgogKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4KICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlcyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZS4KICovCmZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewpyZXR1cm4gY29tcGFyZShzZWxmLCBvdGhlcikgPT0gMDsKfQoKLyoKICogQGRldiBFeHRyYWN0cyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UgaW50byBgcnVuZWAsIGFkdmFuY2luZyB0aGUKICogICAgICBzbGljZSB0byBwb2ludCB0byB0aGUgbmV4dCBydW5lIGFuZCByZXR1cm5pbmcgYHNlbGZgLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICogQHBhcmFtIHJ1bmUgVGhlIHNsaWNlIHRoYXQgd2lsbCBjb250YWluIHRoZSBmaXJzdCBydW5lLgogKiBAcmV0dXJuIGBydW5lYC4KICovCmZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYsIHNsaWNlIHJ1bmUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CnJ1bmUuX3B0ciA9IHNlbGYuX3B0cjsKCmlmIChzZWxmLl9sZW4gPT0gMCkgewpydW5lLl9sZW4gPSAwOwpyZXR1cm4gcnVuZTsKfQoKdWludCBsZW47CnVpbnQgYjsKLy8gTG9hZCB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgcnVuZSBpbnRvIHRoZSBMU0JzIG9mIGIKYXNzZW1ibHkge2IgOj0gYW5kKG1sb2FkKHN1YihtbG9hZChhZGQoc2VsZiwgMzIpKSwgMzEpKSwgMHhGRil9CmlmIChiIDwgMHg4MCkgewpsZW4gPSAxOwp9IGVsc2UgaWYgKGIgPCAweEUwKSB7CmxlbiA9IDI7Cn0gZWxzZSBpZiAoYiA8IDB4RjApIHsKbGVuID0gMzsKfSBlbHNlIHsKbGVuID0gNDsKfQoKLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzCmlmIChsZW4gPiBzZWxmLl9sZW4pIHsKcnVuZS5fbGVuID0gc2VsZi5fbGVuOwpzZWxmLl9wdHIgKz0gc2VsZi5fbGVuOwpzZWxmLl9sZW4gPSAwOwpyZXR1cm4gcnVuZTsKfQoKc2VsZi5fcHRyICs9IGxlbjsKc2VsZi5fbGVuIC09IGxlbjsKcnVuZS5fbGVuID0gbGVuOwpyZXR1cm4gcnVuZTsKfQoKLyoKICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludAogKiAgICAgIHRvIHRoZSBuZXh0IHJ1bmUuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLgogKi8KZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7Cm5leHRSdW5lKHNlbGYsIHJldCk7Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICogQHJldHVybiBUaGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLgogKi8KZnVuY3Rpb24gb3JkKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQgcmV0KSB7CmlmIChzZWxmLl9sZW4gPT0gMCkgewpyZXR1cm4gMDsKfQoKdWludCB3b3JkOwp1aW50IGxlbjsKdWludCBkaXZpc29yID0gMiAqKiAyNDg7CgovLyBMb2FkIHRoZSBydW5lIGludG8gdGhlIE1TQnMgb2YgYgphc3NlbWJseSB7d29yZCA6PSBtbG9hZChtbG9hZChhZGQoc2VsZiwgMzIpKSl9CnZhciBiID0gd29yZCAvIGRpdmlzb3I7CmlmIChiIDwgMHg4MCkgewpyZXQgPSBiOwpsZW4gPSAxOwp9IGVsc2UgaWYgKGIgPCAweEUwKSB7CnJldCA9IGIgJiAweDFGOwpsZW4gPSAyOwp9IGVsc2UgaWYgKGIgPCAweEYwKSB7CnJldCA9IGIgJiAweDBGOwpsZW4gPSAzOwp9IGVsc2UgewpyZXQgPSBiICYgMHgwNzsKbGVuID0gNDsKfQoKLy8gQ2hlY2sgZm9yIHRydW5jYXRlZCBjb2RlcG9pbnRzCmlmIChsZW4gPiBzZWxmLl9sZW4pIHsKcmV0dXJuIDA7Cn0KCmZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CmRpdmlzb3IgPSBkaXZpc29yIC8gMjU2OwpiID0gKHdvcmQgLyBkaXZpc29yKSAmIDB4RkY7CmlmIChiICYgMHhDMCAhPSAweDgwKSB7Ci8vIEludmFsaWQgVVRGLTggc2VxdWVuY2UKcmV0dXJuIDA7Cn0KcmV0ID0gKHJldCAqIDY0KSB8IChiICYgMHgzRik7Cn0KCnJldHVybiByZXQ7Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyB0aGUga2VjY2FrLTI1NiBoYXNoIG9mIHRoZSBzbGljZS4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGhhc2guCiAqIEByZXR1cm4gVGhlIGhhc2ggb2YgdGhlIHNsaWNlLgogKi8KZnVuY3Rpb24ga2VjY2FrKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7CmFzc2VtYmx5IHsKcmV0IDo9IHNoYTMobWxvYWQoYWRkKHNlbGYsIDMyKSksIG1sb2FkKHNlbGYpKQp9Cn0KCi8qCiAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYC4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2Ugc3RhcnRzIHdpdGggdGhlIHByb3ZpZGVkIHRleHQsIGZhbHNlIG90aGVyd2lzZS4KICovCmZ1bmN0aW9uIHN0YXJ0c1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CmlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewpyZXR1cm4gZmFsc2U7Cn0KCmlmIChzZWxmLl9wdHIgPT0gbmVlZGxlLl9wdHIpIHsKcmV0dXJuIHRydWU7Cn0KCmJvb2wgZXF1YWw7CmFzc2VtYmx5IHsKbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCmxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkKbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKfQpyZXR1cm4gZXF1YWw7Cn0KCi8qCiAqIEBkZXYgSWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLCBgbmVlZGxlYCBpcyByZW1vdmVkIGZyb20gdGhlCiAqICAgICAgYmVnaW5uaW5nIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAqIEByZXR1cm4gYHNlbGZgCiAqLwpmdW5jdGlvbiBiZXlvbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewppZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKcmV0dXJuIHNlbGY7Cn0KCmJvb2wgZXF1YWwgPSB0cnVlOwppZiAoc2VsZi5fcHRyICE9IG5lZWRsZS5fcHRyKSB7CmFzc2VtYmx5IHsKbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCmxldCBzZWxmcHRyIDo9IG1sb2FkKGFkZChzZWxmLCAweDIwKSkKbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKfQp9CgppZiAoZXF1YWwpIHsKc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwpzZWxmLl9wdHIgKz0gbmVlZGxlLl9sZW47Cn0KCnJldHVybiBzZWxmOwp9CgovKgogKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgZW5kcyB3aXRoIGBuZWVkbGVgLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLgogKi8KZnVuY3Rpb24gZW5kc1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CmlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewpyZXR1cm4gZmFsc2U7Cn0KCnZhciBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47CgppZiAoc2VsZnB0ciA9PSBuZWVkbGUuX3B0cikgewpyZXR1cm4gdHJ1ZTsKfQoKYm9vbCBlcXVhbDsKYXNzZW1ibHkgewpsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKfQoKcmV0dXJuIGVxdWFsOwp9CgovKgogKiBAZGV2IElmIGBzZWxmYCBlbmRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICogICAgICBlbmQgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICogQHJldHVybiBgc2VsZmAKICovCmZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CnJldHVybiBzZWxmOwp9Cgp2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwpib29sIGVxdWFsID0gdHJ1ZTsKaWYgKHNlbGZwdHIgIT0gbmVlZGxlLl9wdHIpIHsKYXNzZW1ibHkgewpsZXQgbGVuIDo9IG1sb2FkKG5lZWRsZSkKbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKfQp9CgppZiAoZXF1YWwpIHsKc2VsZi5fbGVuIC09IG5lZWRsZS5fbGVuOwp9CgpyZXR1cm4gc2VsZjsKfQoKLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YKLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgZmlyc3QgYnl0ZSBhZnRlciBgc2VsZmAgaWYgbm90IGZvdW5kLgpmdW5jdGlvbiBmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgewp1aW50IHB0cjsKdWludCBpZHg7CgppZiAobmVlZGxlbGVuIDw9IHNlbGZsZW4pIHsKaWYgKG5lZWRsZWxlbiA8PSAzMikgewovLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY4IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCmFzc2VtYmx5IHsKbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKbGV0IG5lZWRsZWRhdGEgOj0gYW5kKG1sb2FkKG5lZWRsZXB0ciksIG1hc2spCmxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQpwdHIgOj0gc2VsZnB0cgpsb29wIDoKanVtcGkoZXhpdCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKcHRyIDo9IGFkZChwdHIsIDEpCmp1bXBpKGxvb3AsIGx0KHN1YihwdHIsIDEpLCBlbmQpKQpwdHIgOj0gYWRkKHNlbGZwdHIsIHNlbGZsZW4pCmV4aXQ6Cn0KcmV0dXJuIHB0cjsKfSBlbHNlIHsKLy8gRm9yIGxvbmcgbmVlZGxlcywgdXNlIGhhc2hpbmcKYnl0ZXMzMiBoYXNoOwphc3NlbWJseSB7aGFzaCA6PSBzaGEzKG5lZWRsZXB0ciwgbmVlZGxlbGVuKX0KcHRyID0gc2VsZnB0cjsKZm9yIChpZHggPSAwOyBpZHggPD0gc2VsZmxlbiAtIG5lZWRsZWxlbjsgaWR4KyspIHsKYnl0ZXMzMiB0ZXN0SGFzaDsKYXNzZW1ibHkge3Rlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pfQppZiAoaGFzaCA9PSB0ZXN0SGFzaCkKcmV0dXJuIHB0cjsKcHRyICs9IDE7Cn0KfQp9CnJldHVybiBzZWxmcHRyICsgc2VsZmxlbjsKfQoKLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZgovLyBgbmVlZGxlYCBpbiBgc2VsZmAsIG9yIHRoZSBhZGRyZXNzIG9mIGBzZWxmYCBpZiBub3QgZm91bmQuCmZ1bmN0aW9uIHJmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcmV0dXJucyAodWludCkgewp1aW50IHB0cjsKCmlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewppZiAobmVlZGxlbGVuIDw9IDMyKSB7Ci8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjkgZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MKYXNzZW1ibHkgewpsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQpsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKcHRyIDo9IGFkZChzZWxmcHRyLCBzdWIoc2VsZmxlbiwgbmVlZGxlbGVuKSkKbG9vcCA6Cmp1bXBpKHJldCwgZXEoYW5kKG1sb2FkKHB0ciksIG1hc2spLCBuZWVkbGVkYXRhKSkKcHRyIDo9IHN1YihwdHIsIDEpCmp1bXBpKGxvb3AsIGd0KGFkZChwdHIsIDEpLCBzZWxmcHRyKSkKcHRyIDo9IHNlbGZwdHIKanVtcChleGl0KQpyZXQgOgpwdHIgOj0gYWRkKHB0ciwgbmVlZGxlbGVuKQpleGl0IDoKfQpyZXR1cm4gcHRyOwp9IGVsc2UgewovLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwpieXRlczMyIGhhc2g7CmFzc2VtYmx5IHtoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pfQpwdHIgPSBzZWxmcHRyICsgKHNlbGZsZW4gLSBuZWVkbGVsZW4pOwp3aGlsZSAocHRyID49IHNlbGZwdHIpIHsKYnl0ZXMzMiB0ZXN0SGFzaDsKYXNzZW1ibHkge3Rlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pfQppZiAoaGFzaCA9PSB0ZXN0SGFzaCkKcmV0dXJuIHB0ciArIG5lZWRsZWxlbjsKcHRyIC09IDE7Cn0KfQp9CnJldHVybiBzZWxmcHRyOwp9CgovKgogKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogKiAgICAgIGBuZWVkbGVgIHRvIHRoZSBlbmQgb2YgdGhlIHNsaWNlLiBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZQogKiAgICAgIGlmIGBuZWVkbGVgIGlzIG5vdCBmb3VuZC4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuCiAqIEByZXR1cm4gYHNlbGZgLgogKi8KZnVuY3Rpb24gZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CnVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKc2VsZi5fbGVuIC09IHB0ciAtIHNlbGYuX3B0cjsKc2VsZi5fcHRyID0gcHRyOwpyZXR1cm4gc2VsZjsKfQoKLyoKICogQGRldiBNb2RpZmllcyBgc2VsZmAgdG8gY29udGFpbiB0aGUgcGFydCBvZiB0aGUgc3RyaW5nIGZyb20gdGhlIHN0YXJ0IG9mCiAqICAgICAgYHNlbGZgIHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAuIElmIGBuZWVkbGVgCiAqICAgICAgaXMgbm90IGZvdW5kLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZS4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuCiAqIEByZXR1cm4gYHNlbGZgLgogKi8KZnVuY3Rpb24gcmZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewp1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwpzZWxmLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7CnJldHVybiBzZWxmOwp9CgovKgogKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmCiAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICogQHJldHVybiBgdG9rZW5gLgogKi8KZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwp0b2tlbi5fcHRyID0gc2VsZi5fcHRyOwp0b2tlbi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwppZiAocHRyID09IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgewovLyBOb3QgZm91bmQKc2VsZi5fbGVuID0gMDsKfSBlbHNlIHsKc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsKc2VsZi5fcHRyID0gcHRyICsgbmVlZGxlLl9sZW47Cn0KcmV0dXJuIHRva2VuOwp9CgovKgogKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIHVwIHRvIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAqLwpmdW5jdGlvbiBzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlIHRva2VuKSB7CnNwbGl0KHNlbGYsIG5lZWRsZSwgdG9rZW4pOwp9CgovKgogKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIHRoZSBsYXN0CiAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBhZnRlciBpdC4gSWYKICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogKiAgICAgIGFuZCBgdG9rZW5gIGlzIHNldCB0byB0aGUgZW50aXJldHkgb2YgYHNlbGZgLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAqIEBwYXJhbSB0b2tlbiBBbiBvdXRwdXQgcGFyYW1ldGVyIHRvIHdoaWNoIHRoZSBmaXJzdCB0b2tlbiBpcyB3cml0dGVuLgogKiBAcmV0dXJuIGB0b2tlbmAuCiAqLwpmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKdG9rZW4uX3B0ciA9IHB0cjsKdG9rZW4uX2xlbiA9IHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpOwppZiAocHRyID09IHNlbGYuX3B0cikgewovLyBOb3QgZm91bmQKc2VsZi5fbGVuID0gMDsKfSBlbHNlIHsKc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsKfQpyZXR1cm4gdG9rZW47Cn0KCi8qCiAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmCiAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4KICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAqLwpmdW5jdGlvbiByc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSB0b2tlbikgewpyc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7Cn0KCi8qCiAqIEBkZXYgQ291bnRzIHRoZSBudW1iZXIgb2Ygbm9ub3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgaW4gYHNlbGZgLgogKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLgogKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogKiBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgZm91bmQgaW4gYHNlbGZgLgogKi8KZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNvdW50KSB7CnVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSArIG5lZWRsZS5fbGVuOwp3aGlsZSAocHRyIDw9IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgewpjb3VudCsrOwpwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiAtIChwdHIgLSBzZWxmLl9wdHIpLCBwdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKfQp9CgovKgogKiBAZGV2IFJldHVybnMgVHJ1ZSBpZiBgc2VsZmAgY29udGFpbnMgYG5lZWRsZWAuCiAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAqIEByZXR1cm4gVHJ1ZSBpZiBgbmVlZGxlYCBpcyBmb3VuZCBpbiBgc2VsZmAsIGZhbHNlIG90aGVyd2lzZS4KICovCmZ1bmN0aW9uIGNvbnRhaW5zKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewpyZXR1cm4gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgIT0gc2VsZi5fcHRyOwp9CgovKgogKiBAZGV2IFJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGNvbmNhdGVuYXRpb24gb2YKICogICAgICBgc2VsZmAgYW5kIGBvdGhlcmAuCiAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb25jYXRlbmF0ZS4KICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29uY2F0ZW5hdGUuCiAqIEByZXR1cm4gVGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlIHR3byBzdHJpbmdzLgogKi8KZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuICsgb3RoZXIuX2xlbik7CnVpbnQgcmV0cHRyOwphc3NlbWJseSB7cmV0cHRyIDo9IGFkZChyZXQsIDMyKX0KbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwptZW1jcHkocmV0cHRyICsgc2VsZi5fbGVuLCBvdGhlci5fcHRyLCBvdGhlci5fbGVuKTsKcmV0dXJuIHJldDsKfQoKLyoKICogQGRldiBKb2lucyBhbiBhcnJheSBvZiBzbGljZXMsIHVzaW5nIGBzZWxmYCBhcyBhIGRlbGltaXRlciwgcmV0dXJuaW5nIGEKICogICAgICBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nLgogKiBAcGFyYW0gc2VsZiBUaGUgZGVsaW1pdGVyIHRvIHVzZS4KICogQHBhcmFtIHBhcnRzIEEgbGlzdCBvZiBzbGljZXMgdG8gam9pbi4KICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyBhbGwgdGhlIHNsaWNlcyBpbiBgcGFydHNgLAogKiAgICAgICAgIGpvaW5lZCB3aXRoIGBzZWxmYC4KICovCmZ1bmN0aW9uIGpvaW4oc2xpY2Ugc2VsZiwgc2xpY2VbXSBwYXJ0cykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CmlmIChwYXJ0cy5sZW5ndGggPT0gMCkKcmV0dXJuICIiOwoKdWludCBsZW4gPSBzZWxmLl9sZW4gKiAocGFydHMubGVuZ3RoIC0gMSk7CmZvciAodWludCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKQpsZW4gKz0gcGFydHNbaV0uX2xlbjsKCnZhciByZXQgPSBuZXcgc3RyaW5nKGxlbik7CnVpbnQgcmV0cHRyOwphc3NlbWJseSB7cmV0cHRyIDo9IGFkZChyZXQsIDMyKX0KCmZvciAoaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewptZW1jcHkocmV0cHRyLCBwYXJ0c1tpXS5fcHRyLCBwYXJ0c1tpXS5fbGVuKTsKcmV0cHRyICs9IHBhcnRzW2ldLl9sZW47CmlmIChpIDwgcGFydHMubGVuZ3RoIC0gMSkgewptZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CnJldHB0ciArPSBzZWxmLl9sZW47Cn0KfQoKcmV0dXJuIHJldDsKfQp9CgoKY29udHJhY3QgRFNTYWZlQWRkU3ViIHsKZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewpyZXF1aXJlKGEgKyBiID49IGEpOwpyZXR1cm4gYSArIGI7Cn0KCmZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKcmVxdWlyZShiIDw9IGEpOwpyZXR1cm4gYSAtIGI7Cn0KfQoKCgpjb250cmFjdCBTd2Fucm9sbCBpcyB1c2luZ09yYWNsaXplLCBEU1NhZmVBZGRTdWIgewoKdXNpbmcgc3RyaW5ncyBmb3IgKjsKCi8qCiAqIGNoZWNrcyBwbGF5ZXIgcHJvZml0LCBiZXQgc2l6ZSBhbmQgcGxheWVyIG51bWJlciBpcyB3aXRoaW4gcmFuZ2UKKi8KbW9kaWZpZXIgYmV0SXNWYWxpZCh1aW50IF9iZXRTaXplLCB1aW50IF9wbGF5ZXJOdW1iZXIpIHsKaWYgKCgoKChfYmV0U2l6ZSAqICgxMDAtIChzYWZlU3ViKF9wbGF5ZXJOdW1iZXIsIDEpKSkpIC8gKHNhZmVTdWIoX3BsYXllck51bWJlciwgMSkpKyBfYmV0U2l6ZSkpICogaG91c2VFZGdlIC8gaG91c2VFZGdlRGl2aXNvcikgLV9iZXRTaXplID4gbWF4UHJvZml0IHx8IF9iZXRTaXplIDwgbWluQmV0IHx8IF9wbGF5ZXJOdW1iZXIgPCBtaW5OdW1iZXIgfHwgX3BsYXllck51bWJlciA+IG1heE51bWJlcikgcmVxdWlyZShmYWxzZSk7Cl87Cn0KCi8qCiAqIGNoZWNrcyBnYW1lIGlzIGN1cnJlbnRseSBhY3RpdmUKKi8KbW9kaWZpZXIgZ2FtZUlzQWN0aXZlIHsKcmVxdWlyZShnYW1lUGF1c2VkICE9IHRydWUpOwpfOwp9CgovKgogKiBjaGVja3MgcGF5b3V0cyBhcmUgY3VycmVudGx5IGFjdGl2ZQoqLwptb2RpZmllciBwYXlvdXRzQXJlQWN0aXZlIHsKcmVxdWlyZShwYXlvdXRzUGF1c2VkICE9IHRydWUpOwpfOwp9CgovKgogKiBjaGVja3Mgb25seSBPcmFjbGl6ZSBhZGRyZXNzIGlzIGNhbGxpbmcKKi8KbW9kaWZpZXIgb25seU9yYWNsaXplIHsKcmVxdWlyZShtc2cuc2VuZGVyID09IG9yYWNsaXplX2NiQWRkcmVzcygpKTsKXzsKfQoKLyoKICogY2hlY2tzIG9ubHkgb3duZXIgYWRkcmVzcyBpcyBjYWxsaW5nCiovCm1vZGlmaWVyIG9ubHlPd25lciB7CnJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7Cl87Cn0KCi8qCiAqIGNoZWNrcyBvbmx5IHRyZWFzdXJ5IGFkZHJlc3MgaXMgY2FsbGluZwoqLwptb2RpZmllciBvbmx5VHJlYXN1cnkgewpyZXF1aXJlKG1zZy5zZW5kZXIgPT0gdHJlYXN1cnkpOwpfOwp9CgovKgogKiBnYW1lIHZhcnMKKi8KdWludCBjb25zdGFudCBwdWJsaWMgbWF4UHJvZml0RGl2aXNvciA9IDEwMDAwMDA7CnVpbnQgY29uc3RhbnQgcHVibGljIGhvdXNlRWRnZURpdmlzb3IgPSAxMDAwOwp1aW50IGNvbnN0YW50IHB1YmxpYyBtYXhOdW1iZXIgPSA5OTsKdWludCBjb25zdGFudCBwdWJsaWMgbWluTnVtYmVyID0gMjsKYm9vbCBwdWJsaWMgZ2FtZVBhdXNlZDsKdWludDMyIHB1YmxpYyBnYXNGb3JPcmFjbGl6ZTsKYWRkcmVzcyBwdWJsaWMgb3duZXI7CmJvb2wgcHVibGljIHBheW91dHNQYXVzZWQ7CmFkZHJlc3MgcHVibGljIHRyZWFzdXJ5Owp1aW50IHB1YmxpYyBjb250cmFjdEJhbGFuY2U7CnVpbnQgcHVibGljIGhvdXNlRWRnZTsKdWludCBwdWJsaWMgbWF4UHJvZml0Owp1aW50IHB1YmxpYyBtYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlOwp1aW50IHB1YmxpYyBtaW5CZXQ7Ci8vaW5pdCBkaWNvbnRpbnVlZCBjb250cmFjdCBkYXRhCmludCBwdWJsaWMgdG90YWxCZXRzID0gMDsKdWludCBwdWJsaWMgbWF4UGVuZGluZ1BheW91dHM7Ci8vaW5pdCBkaWNvbnRpbnVlZCBjb250cmFjdCBkYXRhCnVpbnQgcHVibGljIHRvdGFsV2VpV29uID0gMDsKLy9pbml0IGRpY29udGludWVkIGNvbnRyYWN0IGRhdGEKdWludCBwdWJsaWMgdG90YWxXZWlXYWdlcmVkID0gMDsKCi8qCiAqIHBsYXllciB2YXJzCiovCm1hcHBpbmcgKGJ5dGVzMzIgPT4gYWRkcmVzcykgcGxheWVyQWRkcmVzczsKbWFwcGluZyAoYnl0ZXMzMiA9PiBhZGRyZXNzKSBwbGF5ZXJUZW1wQWRkcmVzczsKbWFwcGluZyAoYnl0ZXMzMiA9PiBieXRlczMyKSBwbGF5ZXJCZXRJZDsKbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJCZXRWYWx1ZTsKbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50KSBwbGF5ZXJUZW1wQmV0VmFsdWU7Cm1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyRGllUmVzdWx0OwptYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllck51bWJlcjsKbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHM7Cm1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludCkgcGxheWVyUHJvZml0OwptYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHBsYXllclRlbXBSZXdhcmQ7CgovKgogKiBldmVudHMKKi8KLyogbG9nIGJldHMgKyBvdXRwdXQgdG8gd2ViMyBmb3IgcHJlY2lzZSAncGF5b3V0IG9uIHdpbicgZmllbGQgaW4gVUkgKi8KZXZlbnQgTG9nQmV0KGJ5dGVzMzIgaW5kZXhlZCBCZXRJRCwgYWRkcmVzcyBpbmRleGVkIFBsYXllckFkZHJlc3MsIHVpbnQgaW5kZXhlZCBSZXdhcmRWYWx1ZSwgdWludCBQcm9maXRWYWx1ZSwgdWludCBCZXRWYWx1ZSwgdWludCBQbGF5ZXJOdW1iZXIpOwovKiBvdXRwdXQgdG8gd2ViMyBVSSBvbiBiZXQgcmVzdWx0Ki8KLyogU3RhdHVzOiAwPWxvc2UsIDE9d2luLCAyPXdpbiArIGZhaWxlZCBzZW5kLCAzPXJlZnVuZCwgND1yZWZ1bmQgKyBmYWlsZWQgc2VuZCovCmV2ZW50IExvZ1Jlc3VsdCh1aW50IGluZGV4ZWQgUmVzdWx0U2VyaWFsTnVtYmVyLCBieXRlczMyIGluZGV4ZWQgQmV0SUQsIGFkZHJlc3MgaW5kZXhlZCBQbGF5ZXJBZGRyZXNzLCB1aW50IFBsYXllck51bWJlciwgdWludCBEaWNlUmVzdWx0LCB1aW50IFZhbHVlLCBpbnQgU3RhdHVzLCBieXRlcyBQcm9vZik7Ci8qIGxvZyBtYW51YWwgcmVmdW5kcyAqLwpldmVudCBMb2dSZWZ1bmQoYnl0ZXMzMiBpbmRleGVkIEJldElELCBhZGRyZXNzIGluZGV4ZWQgUGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIFJlZnVuZFZhbHVlKTsKLyogbG9nIG93bmVyIHRyYW5zZmVycyAqLwpldmVudCBMb2dPd25lclRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBTZW50VG9BZGRyZXNzLCB1aW50IGluZGV4ZWQgQW1vdW50VHJhbnNmZXJyZWQpOwoKCi8qCiAqIGluaXQKKi8KZnVuY3Rpb24gU3dhbnJvbGwoKSB7Cgpvd25lciA9IG1zZy5zZW5kZXI7CnRyZWFzdXJ5ID0gbXNnLnNlbmRlcjsKCm9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOwovKiB1c2UgVExTTm90YXJ5IGZvciBvcmFjbGl6ZSBjYWxsICovCm9yYWNsaXplX3NldFByb29mKHByb29mVHlwZV9UTFNOb3RhcnkgfCBwcm9vZlN0b3JhZ2VfSVBGUyk7Ci8qIGluaXQgOTkwID0gOTklICgxJSBob3VzZUVkZ2UpKi8Kb3duZXJTZXRIb3VzZUVkZ2UoOTkwKTsKLyogaW5pdCAxMCwwMDAgPSAxJSAgKi8Kb3duZXJTZXRNYXhQcm9maXRBc1BlcmNlbnRPZkhvdXNlKDEwMDAwMCk7Ci8qIGluaXQgbWluIGJldCAoMC4xIGV0aGVyKSAqLwpvd25lclNldE1pbkJldCgxMDAwMDAwMDAwMDAwMDAwMDApOwovKiBpbml0IGdhcyBmb3Igb3JhY2xpemUgKi8KZ2FzRm9yT3JhY2xpemUgPSAyNTAwMDA7Cgp9CgovKgogKiBwdWJsaWMgZnVuY3Rpb24KICogcGxheWVyIHN1Ym1pdCBiZXQKICogb25seSBpZiBnYW1lIGlzIGFjdGl2ZSAmIGJldCBpcyB2YWxpZCBjYW4gcXVlcnkgb3JhY2xpemUgYW5kIHNldCBwbGF5ZXIgdmFycwoqLwpmdW5jdGlvbiBwbGF5ZXJSb2xsRGljZSh1aW50IHJvbGxVbmRlcikgcHVibGljCnBheWFibGUKZ2FtZUlzQWN0aXZlCmJldElzVmFsaWQobXNnLnZhbHVlLCByb2xsVW5kZXIpCnsKCgovKiBzYWZlbHkgdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgdG8gYWNjb3VudCBmb3IgY29zdCB0byBjYWxsIG9yYWNsaXplKi8KY29udHJhY3RCYWxhbmNlID0gc2FmZVN1Yihjb250cmFjdEJhbGFuY2UsIG9yYWNsaXplX2dldFByaWNlKCJVUkwiLCBnYXNGb3JPcmFjbGl6ZSkpOwoKLyogdG90YWwgbnVtYmVyIG9mIGJldHMgKi8KdG90YWxCZXRzICs9IDE7CgovKiB0b3RhbCB3YWdlcmVkICovCnRvdGFsV2VpV2FnZXJlZCArPSBtc2cudmFsdWU7CgovKgoqIGFzc2lnbiBwYXJ0aWFsbHkgZW5jcnlwdGVkIHF1ZXJ5IHRvIG9yYWNsaXplCiogb25seSB0aGUgYXBpS2V5IGlzIGVuY3J5cHRlZAoqIGludGVnZXIgcXVlcnkgaXMgaW4gcGxhaW4gdGV4dAoqLwpieXRlczMyIHJuZ0lkID0gb3JhY2xpemVfcXVlcnkoIm5lc3RlZCIsICJbVVJMXSBbJ2pzb24oaHR0cHM6Ly9hcGkucmFuZG9tLm9yZy9qc29uLXJwYy8xL2ludm9rZSkucmVzdWx0LnJhbmRvbVtcInNlcmlhbE51bWJlclwiLFwiZGF0YVwiXScsICdcXG57XCJqc29ucnBjXCI6XCIyLjBcIixcIm1ldGhvZFwiOlwiZ2VuZXJhdGVTaWduZWRJbnRlZ2Vyc1wiLFwicGFyYW1zXCI6e1wiYXBpS2V5XCI6JHtbZGVjcnlwdF0gQkdyRXlUQkJicXluY2lPRGxPU2ZjdmhRdHErcHM0a0hYY2p5WVlnR2FmdkcxbmhJM3BVQmROb0pwR2hnSzZvNStOTHRoVkZmWUFEbzJVeVNSV014Z0JRbWN4VEMwd3hRWHFKbG9QQ1BuT3FaeENsVm43RERyUnUzQlpCQUQ5TUI1VUZlR0c3eTVpMmNPS2xlODUxQTVXWDNUMCtxfSxcIm5cIjoxLFwibWluXCI6MSxcIm1heFwiOjEwMCxcInJlcGxhY2VtZW50XCI6dHJ1ZSxcImJhc2VcIjoxMCR7W2lkZW50aXR5XSBcIn1cIn0sXCJpZFwiOjEke1tpZGVudGl0eV0gXCJ9XCJ9J10iLCBnYXNGb3JPcmFjbGl6ZSk7CgovKiBtYXAgYmV0IGlkIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8KcGxheWVyQmV0SWRbcm5nSWRdID0gcm5nSWQ7Ci8qIG1hcCBwbGF5ZXIgbHVja3kgbnVtYmVyIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8KcGxheWVyTnVtYmVyW3JuZ0lkXSA9IHJvbGxVbmRlcjsKLyogbWFwIHZhbHVlIG9mIHdhZ2VyIHRvIHRoaXMgb3JhY2xpemUgcXVlcnkgKi8KcGxheWVyQmV0VmFsdWVbcm5nSWRdID0gbXNnLnZhbHVlOwovKiBtYXAgcGxheWVyIGFkZHJlc3MgdG8gdGhpcyBvcmFjbGl6ZSBxdWVyeSAqLwpwbGF5ZXJBZGRyZXNzW3JuZ0lkXSA9IG1zZy5zZW5kZXI7Ci8qIHNhZmVseSBtYXAgcGxheWVyIHByb2ZpdCB0byB0aGlzIG9yYWNsaXplIHF1ZXJ5ICovCnBsYXllclByb2ZpdFtybmdJZF0gPSAoKCgobXNnLnZhbHVlICogKDEwMCAtIChzYWZlU3ViKHJvbGxVbmRlciwgMSkpKSkgLyAoc2FmZVN1Yihyb2xsVW5kZXIsMSkpICsgbXNnLnZhbHVlKSkgKmhvdXNlRWRnZSAvIGhvdXNlRWRnZURpdmlzb3IpIC0gbXNnLnZhbHVlOwovKiBzYWZlbHkgaW5jcmVhc2UgbWF4UGVuZGluZ1BheW91dHMgbGlhYmlsaXR5IC0gY2FsYyBhbGwgcGVuZGluZyBwYXlvdXRzIHVuZGVyIGFzc3VtcHRpb24gdGhleSB3aW4gKi8KbWF4UGVuZGluZ1BheW91dHMgPSBzYWZlQWRkKG1heFBlbmRpbmdQYXlvdXRzLCBwbGF5ZXJQcm9maXRbcm5nSWRdKTsKLyogY2hlY2sgY29udHJhY3QgY2FuIHBheW91dCBvbiB3aW4gKi8KcmVxdWlyZShtYXhQZW5kaW5nUGF5b3V0cyA8IGNvbnRyYWN0QmFsYW5jZSk7Ci8qIHByb3ZpZGVzIGFjY3VyYXRlIG51bWJlcnMgZm9yIHdlYjMgYW5kIGFsbG93cyBmb3IgbWFudWFsIHJlZnVuZHMgaW4gY2FzZSBvZiBubyBvcmFjbGl6ZSBfX2NhbGxiYWNrICovCkxvZ0JldChwbGF5ZXJCZXRJZFtybmdJZF0sIHBsYXllckFkZHJlc3Nbcm5nSWRdLCBzYWZlQWRkKHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyUHJvZml0W3JuZ0lkXSksIHBsYXllclByb2ZpdFtybmdJZF0sIHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyTnVtYmVyW3JuZ0lkXSk7Cgp9CgoKLyoKKiBzZW1pLXB1YmxpYyBmdW5jdGlvbiAtIG9ubHkgb3JhY2xpemUgY2FuIGNhbGwKKi8KLypUTFNOb3RhcnkgZm9yIG9yYWNsaXplIGNhbGwgKi8KZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSBwdWJsaWMKb25seU9yYWNsaXplCnBheW91dHNBcmVBY3RpdmUKewoKLyogcGxheWVyIGFkZHJlc3MgbWFwcGVkIHRvIHF1ZXJ5IGlkIGRvZXMgbm90IGV4aXN0ICovCnJlcXVpcmUocGxheWVyQWRkcmVzc1tteWlkXSAhPSAweDApOwoKLyoga2VlcCBvcmFjbGl6ZSBob25lc3QgYnkgcmV0cmlldmluZyB0aGUgc2VyaWFsTnVtYmVyIGZyb20gcmFuZG9tLm9yZyByZXN1bHQgKi8KdmFyIHNsX3Jlc3VsdCA9IHJlc3VsdC50b1NsaWNlKCk7CnNsX3Jlc3VsdC5iZXlvbmQoIlsiLnRvU2xpY2UoKSkudW50aWwoIl0iLnRvU2xpY2UoKSk7CnVpbnQgc2VyaWFsTnVtYmVyT2ZSZXN1bHQgPSBwYXJzZUludChzbF9yZXN1bHQuc3BsaXQoJywgJy50b1NsaWNlKCkpLnRvU3RyaW5nKCkpOwoKLyogbWFwIHJlc3VsdCB0byBwbGF5ZXIgKi8KcGxheWVyRGllUmVzdWx0W215aWRdID0gcGFyc2VJbnQoc2xfcmVzdWx0LmJleW9uZCgiWyIudG9TbGljZSgpKS51bnRpbCgiXSIudG9TbGljZSgpKS50b1N0cmluZygpKTsKCi8qIGdldCB0aGUgcGxheWVyQWRkcmVzcyBmb3IgdGhpcyBxdWVyeSBpZCAqLwpwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSA9IHBsYXllckFkZHJlc3NbbXlpZF07Ci8qIGRlbGV0ZSBwbGF5ZXJBZGRyZXNzIGZvciB0aGlzIHF1ZXJ5IGlkICovCmRlbGV0ZSBwbGF5ZXJBZGRyZXNzW215aWRdOwoKLyogbWFwIHRoZSBwbGF5ZXJQcm9maXQgZm9yIHRoaXMgcXVlcnkgaWQgKi8KcGxheWVyVGVtcFJld2FyZFtteWlkXSA9IHBsYXllclByb2ZpdFtteWlkXTsKLyogc2V0ICBwbGF5ZXJQcm9maXQgZm9yIHRoaXMgcXVlcnkgaWQgdG8gMCAqLwpwbGF5ZXJQcm9maXRbbXlpZF0gPSAwOwoKLyogc2FmZWx5IHJlZHVjZSBtYXhQZW5kaW5nUGF5b3V0cyBsaWFiaWxpdHkgKi8KbWF4UGVuZGluZ1BheW91dHMgPSBzYWZlU3ViKG1heFBlbmRpbmdQYXlvdXRzLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdKTsKCi8qIG1hcCB0aGUgcGxheWVyQmV0VmFsdWUgZm9yIHRoaXMgcXVlcnkgaWQgKi8KcGxheWVyVGVtcEJldFZhbHVlW215aWRdID0gcGxheWVyQmV0VmFsdWVbbXlpZF07Ci8qIHNldCAgcGxheWVyQmV0VmFsdWUgZm9yIHRoaXMgcXVlcnkgaWQgdG8gMCAqLwpwbGF5ZXJCZXRWYWx1ZVtteWlkXSA9IDA7CgovKgoqIHJlZnVuZAoqIGlmIHJlc3VsdCBpcyAwIHJlc3VsdCBpcyBlbXB0eSBvciBubyBwcm9vZiByZWZ1bmQgb3JpZ2luYWwgYmV0IHZhbHVlCiogaWYgcmVmdW5kIGZhaWxzIHNhdmUgcmVmdW5kIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2FscwoqLwppZiAocGxheWVyRGllUmVzdWx0W215aWRdPT0gMCB8fCBieXRlcyhyZXN1bHQpLmxlbmd0aCA9PSAwIHx8IGJ5dGVzKHByb29mKS5sZW5ndGggPT0gMCl7CgpMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgMywgcHJvb2YpOwoKLyoKKiBzZW5kIHJlZnVuZCAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0CiogaWYgc2VuZCBmYWlscyBtYXAgcmVmdW5kIHZhbHVlIHRvIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzXQoqIGZvciB3aXRoZHJhd2FsIGxhdGVyIHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMKKi8KaWYgKCFwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXS5zZW5kKHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSkpewpMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSwgNCwgcHJvb2YpOwovKiBpZiBzZW5kIGZhaWxlZCBsZXQgcGxheWVyIHdpdGhkcmF3IHZpYSBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMgKi8KcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSA9IHNhZmVBZGQocGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW3BsYXllclRlbXBBZGRyZXNzW215aWRdXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdKTsKfQoKcmV0dXJuOwp9CgovKgoqIHBheSB3aW5uZXIKKiB1cGRhdGUgY29udHJhY3QgYmFsYW5jZSB0byBjYWxjdWxhdGUgbmV3IG1heCBiZXQKKiBzZW5kIHJld2FyZAoqIGlmIHNlbmQgb2YgcmV3YXJkIGZhaWxzIHNhdmUgdmFsdWUgdG8gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzCiovCmlmIChwbGF5ZXJEaWVSZXN1bHRbbXlpZF0gPCBwbGF5ZXJOdW1iZXJbbXlpZF0pewoKLyogc2FmZWx5IHJlZHVjZSBjb250cmFjdCBiYWxhbmNlIGJ5IHBsYXllciBwcm9maXQgKi8KY29udHJhY3RCYWxhbmNlID0gc2FmZVN1Yihjb250cmFjdEJhbGFuY2UsIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOwoKLyogdXBkYXRlIHRvdGFsIHdlaSB3b24gKi8KdG90YWxXZWlXb24gPSBzYWZlQWRkKHRvdGFsV2VpV29uLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdKTsKCi8qIHNhZmVseSBjYWxjdWxhdGUgcGF5b3V0IHZpYSBwcm9maXQgcGx1cyBvcmlnaW5hbCB3YWdlciAqLwpwbGF5ZXJUZW1wUmV3YXJkW215aWRdID0gc2FmZUFkZChwbGF5ZXJUZW1wUmV3YXJkW215aWRdLCBwbGF5ZXJUZW1wQmV0VmFsdWVbbXlpZF0pOwoKTG9nUmVzdWx0KHNlcmlhbE51bWJlck9mUmVzdWx0LCBwbGF5ZXJCZXRJZFtteWlkXSwgcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0sIHBsYXllck51bWJlcltteWlkXSwgcGxheWVyRGllUmVzdWx0W215aWRdLCBwbGF5ZXJUZW1wUmV3YXJkW215aWRdLCAxLCBwcm9vZik7CgovKiB1cGRhdGUgbWF4aW11bSBwcm9maXQgKi8Kc2V0TWF4UHJvZml0KCk7CgovKgoqIHNlbmQgd2luIC0gZXh0ZXJuYWwgY2FsbCB0byBhbiB1bnRydXN0ZWQgY29udHJhY3QKKiBpZiBzZW5kIGZhaWxzIG1hcCByZXdhcmQgdmFsdWUgdG8gcGxheWVyUGVuZGluZ1dpdGhkcmF3YWxzW2FkZHJlc3NdCiogZm9yIHdpdGhkcmF3YWwgbGF0ZXIgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucwoqLwppZiAoIXBsYXllclRlbXBBZGRyZXNzW215aWRdLnNlbmQocGxheWVyVGVtcFJld2FyZFtteWlkXSkpewpMb2dSZXN1bHQoc2VyaWFsTnVtYmVyT2ZSZXN1bHQsIHBsYXllckJldElkW215aWRdLCBwbGF5ZXJUZW1wQWRkcmVzc1tteWlkXSwgcGxheWVyTnVtYmVyW215aWRdLCBwbGF5ZXJEaWVSZXN1bHRbbXlpZF0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0sIDIsIHByb29mKTsKLyogaWYgc2VuZCBmYWlsZWQgbGV0IHBsYXllciB3aXRoZHJhdyB2aWEgcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zICovCnBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0gPSBzYWZlQWRkKHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1twbGF5ZXJUZW1wQWRkcmVzc1tteWlkXV0sIHBsYXllclRlbXBSZXdhcmRbbXlpZF0pOwp9CgpyZXR1cm47Cgp9CgovKgoqIG5vIHdpbgoqIHNlbmQgMSB3ZWkgdG8gYSBsb3NpbmcgYmV0CiogdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgdG8gY2FsY3VsYXRlIG5ldyBtYXggYmV0CiovCmlmIChwbGF5ZXJEaWVSZXN1bHRbbXlpZF0gPj0gcGxheWVyTnVtYmVyW215aWRdKXsKCkxvZ1Jlc3VsdChzZXJpYWxOdW1iZXJPZlJlc3VsdCwgcGxheWVyQmV0SWRbbXlpZF0sIHBsYXllclRlbXBBZGRyZXNzW215aWRdLCBwbGF5ZXJOdW1iZXJbbXlpZF0sIHBsYXllckRpZVJlc3VsdFtteWlkXSwgcGxheWVyVGVtcEJldFZhbHVlW215aWRdLCAwLCBwcm9vZik7CgovKgoqICBzYWZlIGFkanVzdCBjb250cmFjdEJhbGFuY2UKKiAgc2V0TWF4UHJvZml0CiogIHNlbmQgMSB3ZWkgdG8gbG9zaW5nIGJldAoqLwpjb250cmFjdEJhbGFuY2UgPSBzYWZlQWRkKGNvbnRyYWN0QmFsYW5jZSwgKHBsYXllclRlbXBCZXRWYWx1ZVtteWlkXSAtIDEpKTsKCi8qIHVwZGF0ZSBtYXhpbXVtIHByb2ZpdCAqLwpzZXRNYXhQcm9maXQoKTsKCi8qCiogc2VuZCAxIHdlaSAtIGV4dGVybmFsIGNhbGwgdG8gYW4gdW50cnVzdGVkIGNvbnRyYWN0CiovCmlmICghcGxheWVyVGVtcEFkZHJlc3NbbXlpZF0uc2VuZCgxKSl7Ci8qIGlmIHNlbmQgZmFpbGVkIGxldCBwbGF5ZXIgd2l0aGRyYXcgdmlhIHBsYXllcldpdGhkcmF3UGVuZGluZ1RyYW5zYWN0aW9ucyAqLwpwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dID0gc2FmZUFkZChwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbcGxheWVyVGVtcEFkZHJlc3NbbXlpZF1dLCAxKTsKfQoKcmV0dXJuOwoKfQoKfQoKLyoKKiBwdWJsaWMgZnVuY3Rpb24KKiBpbiBjYXNlIG9mIGEgZmFpbGVkIHJlZnVuZCBvciB3aW4gc2VuZAoqLwpmdW5jdGlvbiBwbGF5ZXJXaXRoZHJhd1BlbmRpbmdUcmFuc2FjdGlvbnMoKSBwdWJsaWMKcGF5b3V0c0FyZUFjdGl2ZQpyZXR1cm5zIChib29sKQp7CnVpbnQgd2l0aGRyYXdBbW91bnQgPSBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl07CnBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSA9IDA7Ci8qIGV4dGVybmFsIGNhbGwgdG8gdW50cnVzdGVkIGNvbnRyYWN0ICovCmlmIChtc2cuc2VuZGVyLmNhbGwudmFsdWUod2l0aGRyYXdBbW91bnQpKCkpIHsKcmV0dXJuIHRydWU7Cn0gZWxzZSB7Ci8qIGlmIHNlbmQgZmFpbGVkIHJldmVydCBwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSAwOyAqLwovKiBwbGF5ZXIgY2FuIHRyeSB0byB3aXRoZHJhdyBhZ2FpbiBsYXRlciAqLwpwbGF5ZXJQZW5kaW5nV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSB3aXRoZHJhd0Ftb3VudDsKcmV0dXJuIGZhbHNlOwp9Cn0KCi8qIGNoZWNrIGZvciBwZW5kaW5nIHdpdGhkcmF3YWxzICAqLwpmdW5jdGlvbiBwbGF5ZXJHZXRQZW5kaW5nVHhCeUFkZHJlc3MoYWRkcmVzcyBhZGRyZXNzVG9DaGVjaykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKcmV0dXJuIHBsYXllclBlbmRpbmdXaXRoZHJhd2Fsc1thZGRyZXNzVG9DaGVja107Cn0KCi8qCiogaW50ZXJuYWwgZnVuY3Rpb24KKiBzZXRzIG1heCBwcm9maXQKKi8KZnVuY3Rpb24gc2V0TWF4UHJvZml0KCkgaW50ZXJuYWwgewptYXhQcm9maXQgPSAoY29udHJhY3RCYWxhbmNlICogbWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSkgLyBtYXhQcm9maXREaXZpc29yOwp9CgovKgoqIG93bmVyL3RyZWFzdXJ5IGFkZHJlc3Mgb25seSBmdW5jdGlvbnMKKi8KZnVuY3Rpb24gKCkKcGF5YWJsZQpvbmx5VHJlYXN1cnkKewovKiBzYWZlbHkgdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2UgKi8KY29udHJhY3RCYWxhbmNlID0gc2FmZUFkZChjb250cmFjdEJhbGFuY2UsIG1zZy52YWx1ZSk7Ci8qIHVwZGF0ZSB0aGUgbWF4aW11bSBwcm9maXQgKi8Kc2V0TWF4UHJvZml0KCk7Cn0KCi8qIHNldCBnYXMgZm9yIG9yYWNsaXplIHF1ZXJ5ICovCmZ1bmN0aW9uIG93bmVyU2V0T3JhY2xpemVTYWZlR2FzKHVpbnQzMiBuZXdTYWZlR2FzVG9PcmFjbGl6ZSkgcHVibGljCm9ubHlPd25lcgp7Cmdhc0Zvck9yYWNsaXplID0gbmV3U2FmZUdhc1RvT3JhY2xpemU7Cn0KCi8qIG9ubHkgb3duZXIgYWRqdXN0IGNvbnRyYWN0IGJhbGFuY2UgdmFyaWFibGUgKG9ubHkgdXNlZCBmb3IgbWF4IHByb2ZpdCBjYWxjKSAqLwpmdW5jdGlvbiBvd25lclVwZGF0ZUNvbnRyYWN0QmFsYW5jZSh1aW50IG5ld0NvbnRyYWN0QmFsYW5jZUluV2VpKSBwdWJsaWMKb25seU93bmVyCnsKY29udHJhY3RCYWxhbmNlID0gbmV3Q29udHJhY3RCYWxhbmNlSW5XZWk7Cn0KCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IGhvdXNlRWRnZSAqLwpmdW5jdGlvbiBvd25lclNldEhvdXNlRWRnZSh1aW50IG5ld0hvdXNlRWRnZSkgcHVibGljCm9ubHlPd25lcgp7CmhvdXNlRWRnZSA9IG5ld0hvdXNlRWRnZTsKfQoKLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzZXQgbWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSAqLwpmdW5jdGlvbiBvd25lclNldE1heFByb2ZpdEFzUGVyY2VudE9mSG91c2UodWludCBuZXdNYXhQcm9maXRBc1BlcmNlbnQpIHB1YmxpYwpvbmx5T3duZXIKewovKiByZXN0cmljdCBlYWNoIGJldCB0byBhIG1heGltdW0gcHJvZml0IG9mIDEwJSBjb250cmFjdEJhbGFuY2UgKi8KcmVxdWlyZShuZXdNYXhQcm9maXRBc1BlcmNlbnQgPD0gMTAwMDAwKTsKbWF4UHJvZml0QXNQZXJjZW50T2ZIb3VzZSA9IG5ld01heFByb2ZpdEFzUGVyY2VudDsKc2V0TWF4UHJvZml0KCk7Cn0KCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IG1pbkJldCAqLwpmdW5jdGlvbiBvd25lclNldE1pbkJldCh1aW50IG5ld01pbmltdW1CZXQpIHB1YmxpYwpvbmx5T3duZXIKewptaW5CZXQgPSBuZXdNaW5pbXVtQmV0Owp9CgovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHRyYW5zZmVyIGV0aGVyICovCmZ1bmN0aW9uIG93bmVyVHJhbnNmZXJFdGhlcihhZGRyZXNzIHNlbmRUbywgdWludCBhbW91bnQpIHB1YmxpYwpvbmx5T3duZXIKewovKiBzYWZlbHkgdXBkYXRlIGNvbnRyYWN0IGJhbGFuY2Ugd2hlbiBzZW5kaW5nIG91dCBmdW5kcyovCmNvbnRyYWN0QmFsYW5jZSA9IHNhZmVTdWIoY29udHJhY3RCYWxhbmNlLCBhbW91bnQpOwovKiB1cGRhdGUgbWF4IHByb2ZpdCAqLwpzZXRNYXhQcm9maXQoKTsKcmVxdWlyZShzZW5kVG8uc2VuZChhbW91bnQpKTsKTG9nT3duZXJUcmFuc2ZlcihzZW5kVG8sIGFtb3VudCk7Cn0KCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gZG8gbWFudWFsIHJlZnVuZAoqIHVzZWQgb25seSBpZiBiZXQgcGxhY2VkICsgb3JhY2xpemUgZmFpbGVkIHRvIF9fY2FsbGJhY2sKKiBmaWx0ZXIgTG9nQmV0IGJ5IGFkZHJlc3MgYW5kL29yIHBsYXllckJldElkOgoqIExvZ0JldChwbGF5ZXJCZXRJZFtybmdJZF0sIHBsYXllckFkZHJlc3Nbcm5nSWRdLCBzYWZlQWRkKHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyUHJvZml0W3JuZ0lkXSksIHBsYXllclByb2ZpdFtybmdJZF0sIHBsYXllckJldFZhbHVlW3JuZ0lkXSwgcGxheWVyTnVtYmVyW3JuZ0lkXSk7CiogY2hlY2sgdGhlIGZvbGxvd2luZyBsb2dzIGRvIG5vdCBleGlzdCBmb3IgcGxheWVyQmV0SWQgYW5kL29yIHBsYXllckFkZHJlc3Nbcm5nSWRdIGJlZm9yZSByZWZ1bmRpbmc6CiogTG9nUmVzdWx0IG9yIExvZ1JlZnVuZAoqIGlmIExvZ1Jlc3VsdCBleGlzdHMgcGxheWVyIHNob3VsZCB1c2UgdGhlIHdpdGhkcmF3IHBhdHRlcm4gcGxheWVyV2l0aGRyYXdQZW5kaW5nVHJhbnNhY3Rpb25zCiovCmZ1bmN0aW9uIG93bmVyUmVmdW5kUGxheWVyKGJ5dGVzMzIgb3JpZ2luYWxQbGF5ZXJCZXRJZCwgYWRkcmVzcyBzZW5kVG8sIHVpbnQgb3JpZ2luYWxQbGF5ZXJQcm9maXQsIHVpbnQgb3JpZ2luYWxQbGF5ZXJCZXRWYWx1ZSkgcHVibGljCm9ubHlPd25lcgp7Ci8qIHNhZmVseSByZWR1Y2UgcGVuZGluZ1BheW91dHMgYnkgcGxheWVyUHJvZml0W3JuZ0lkXSAqLwptYXhQZW5kaW5nUGF5b3V0cyA9IHNhZmVTdWIobWF4UGVuZGluZ1BheW91dHMsIG9yaWdpbmFsUGxheWVyUHJvZml0KTsKLyogc2VuZCByZWZ1bmQgKi8KcmVxdWlyZShzZW5kVG8uc2VuZChvcmlnaW5hbFBsYXllckJldFZhbHVlKSk7Ci8qIGxvZyByZWZ1bmRzICovCkxvZ1JlZnVuZChvcmlnaW5hbFBsYXllckJldElkLCBzZW5kVG8sIG9yaWdpbmFsUGxheWVyQmV0VmFsdWUpOwp9CgovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBlbWVyZ2VuY3kgcGF1c2UgIzEgKi8KZnVuY3Rpb24gb3duZXJQYXVzZUdhbWUoYm9vbCBuZXdTdGF0dXMpIHB1YmxpYwpvbmx5T3duZXIKewpnYW1lUGF1c2VkID0gbmV3U3RhdHVzOwp9CgovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCBlbWVyZ2VuY3kgcGF1c2UgIzIgKi8KZnVuY3Rpb24gb3duZXJQYXVzZVBheW91dHMoYm9vbCBuZXdQYXlvdXRTdGF0dXMpIHB1YmxpYwpvbmx5T3duZXIKewpwYXlvdXRzUGF1c2VkID0gbmV3UGF5b3V0U3RhdHVzOwp9CgovKiBvbmx5IG93bmVyIGFkZHJlc3MgY2FuIHNldCB0cmVhc3VyeSBhZGRyZXNzICovCmZ1bmN0aW9uIG93bmVyU2V0VHJlYXN1cnkoYWRkcmVzcyBuZXdUcmVhc3VyeSkgcHVibGljCm9ubHlPd25lcgp7CnRyZWFzdXJ5ID0gbmV3VHJlYXN1cnk7Cn0KCi8qIG9ubHkgb3duZXIgYWRkcmVzcyBjYW4gc2V0IG93bmVyIGFkZHJlc3MgKi8KZnVuY3Rpb24gb3duZXJDaGFuZ2VPd25lcihhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMKb25seU93bmVyCnsKb3duZXIgPSBuZXdPd25lcjsKfQoKLyogb25seSBvd25lciBhZGRyZXNzIGNhbiBzdWljaWRlIC0gZW1lcmdlbmN5ICovCmZ1bmN0aW9uIG93bmVya2lsbCgpIHB1YmxpYwpvbmx5T3duZXIKewpzdWljaWRlKG93bmVyKTsKfQoKCn0='.
	

]
