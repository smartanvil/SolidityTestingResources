Class {
	#name : #SRTf7eD56c1AC4d038e367a987258b86FC883b960a1,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf7eD56c1AC4d038e367a987258b86FC883b960a1 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICAKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgRWplY3RhYmxlT3duYWJsZQogKiBAZGV2IFRoZSBFamVjdGFibGVPd25hYmxlIGNvbnRyYWN0IHByb3ZpZGVzIHRoZSBmdW5jdGlvbiB0byByZW1vdmUgdGhlIG93bmVyc2hpcCBvZiB0aGUgY29udHJhY3QuCiAqLwpjb250cmFjdCBFamVjdGFibGVPd25hYmxlIGlzIE93bmFibGUgewogICAgCiAgICAvKioKICAgICAqIEBkZXYgUmVtb3ZlIHRoZSBvd25lcnNoaXAgYnkgc2V0dGluZyB0aGUgb3duZXIgYWRkcmVzcyB0byBudWxsLCAKICAgICAqIGFmdGVyIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiwgYWxsIG9ubHlPd25lciBmdW5jdGlvbiB3aWxsIGJlIGJlIGFibGUgdG8gYmUgY2FsbGVkIGJ5IGFueW9uZSBhbnltb3JlLCAKICAgICAqIHRoZSBjb250cmFjdCB3aWxsIGFjaGlldmUgdHJ1bHkgZGVjZW50cmFsaXNhdGlvbi4KICAgICovCiAgICBmdW5jdGlvbiByZW1vdmVPd25lcnNoaXAoKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICBvd25lciA9IDB4MDsKICAgIH0KICAgIAp9CgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICAgIAogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogIH0KICAKfQoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewoKICAvKioKICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICovCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQogIAp9CgoKLyoqCiAqIEB0aXRsZSBQdWxsUGF5bWVudAogKiBAZGV2IEJhc2UgY29udHJhY3Qgc3VwcG9ydGluZyBhc3luYyBzZW5kIGZvciBwdWxsIHBheW1lbnRzLiBJbmhlcml0IGZyb20gdGhpcwogKiBjb250cmFjdCBhbmQgdXNlIGFzeW5jU2VuZCBpbnN0ZWFkIG9mIHNlbmQuCiAqLwpjb250cmFjdCBQdWxsUGF5bWVudCB7CiAgICAKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwYXltZW50czsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFBheW1lbnRzOwoKICAvKioKICAgKiBAZGV2IHdpdGhkcmF3IGFjY3VtdWxhdGVkIGJhbGFuY2UsIGNhbGxlZCBieSBwYXllZS4KICAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkgcHVibGljIHsKICAgIGFkZHJlc3MgcGF5ZWUgPSBtc2cuc2VuZGVyOwogICAgdWludDI1NiBwYXltZW50ID0gcGF5bWVudHNbcGF5ZWVdOwoKICAgIHJlcXVpcmUocGF5bWVudCAhPSAwKTsKICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IHBheW1lbnQpOwoKICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLnN1YihwYXltZW50KTsKICAgIHBheW1lbnRzW3BheWVlXSA9IDA7CgogICAgYXNzZXJ0KHBheWVlLnNlbmQocGF5bWVudCkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxsZWQgYnkgdGhlIHBheWVyIHRvIHN0b3JlIHRoZSBzZW50IGFtb3VudCBhcyBjcmVkaXQgdG8gYmUgcHVsbGVkLgogICAqIEBwYXJhbSBkZXN0IFRoZSBkZXN0aW5hdGlvbiBhZGRyZXNzIG9mIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICovCiAgZnVuY3Rpb24gYXN5bmNTZW5kKGFkZHJlc3MgZGVzdCwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgIHBheW1lbnRzW2Rlc3RdID0gcGF5bWVudHNbZGVzdF0uYWRkKGFtb3VudCk7CiAgICB0b3RhbFBheW1lbnRzID0gdG90YWxQYXltZW50cy5hZGQoYW1vdW50KTsKICB9CiAgCn0KCgovKioKICogQHRpdGxlIERlc3RydWN0aWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3QgdGhhdCBjYW4gYmUgZGVzdHJveWVkIGJ5IG93bmVyLiBBbGwgZnVuZHMgaW4gY29udHJhY3Qgd2lsbCBiZSBzZW50IHRvIHRoZSBvd25lci4KICovCmNvbnRyYWN0IERlc3RydWN0aWJsZSBpcyBPd25hYmxlIHsKCiAgZnVuY3Rpb24gRGVzdHJ1Y3RpYmxlKCkgcHVibGljIHBheWFibGUgeyB9CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXJzIHRoZSBjdXJyZW50IGJhbGFuY2UgdG8gdGhlIG93bmVyIGFuZCB0ZXJtaW5hdGVzIHRoZSBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBkZXN0cm95KCkgb25seU93bmVyIHB1YmxpYyB7CiAgICBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogIH0KCiAgZnVuY3Rpb24gZGVzdHJveUFuZFNlbmQoYWRkcmVzcyBfcmVjaXBpZW50KSBvbmx5T3duZXIgcHVibGljIHsKICAgIHNlbGZkZXN0cnVjdChfcmVjaXBpZW50KTsKICB9CiAgCn0KCgpjb250cmFjdCBFRFN0cnVjdHMgewogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhlIG1haW4gRHVuZ2VvbiBzdHJ1Y3QuIEV2ZXJ5IGR1bmdlb24gaW4gdGhlIGdhbWUgaXMgcmVwcmVzZW50ZWQgYnkgdGhpcyBzdHJ1Y3R1cmUuCiAgICAgKiBBIGR1bmdlb24gaXMgY29uc2lzdHMgb2YgYW4gdW5saW1pdGVkIG51bWJlciBvZiBmbG9vcnMgZm9yIHlvdXIgaGVyb2VzIHRvIGNoYWxsZW5nZSwgCiAgICAgKiB0aGUgcG93ZXIgbGV2ZWwgb2YgYSBkdW5nZW9uIGlzIGVuY29kZWQgaW4gdGhlIGZsb29yR2VuZXMuIFNvbWUgZHVuZ2VvbnMgYXJlIGluIGZhY3QgbW9yZSAiY2hhbGxlbmdpbmciIHRoYW4gb3RoZXJzLAogICAgICogdGhlIHNlY3JldCBmb3JtdWxhIGZvciB0aGF0IGlzIGxlZnQgZm9yIHVzZXIgdG8gZmluZCBvdXQuCiAgICAgKiAKICAgICAqIEVhY2ggZHVuZ2VvbiBhbHNvIGhhcyBhICJ0cmFpbmluZyBhcmVhIiwgaGVyb2VzIGNhbiBwZXJmb3JtIHRyYWluaW5ncyBhbmQgdXBncmFkZSB0aGVpciBzdGF0LAogICAgICogYW5kIHNvbWUgZHVuZ2VvbnMgYXJlIG1vcmUgZWZmZWN0aXZlIGluIHRoZSB0cmFpbmluZywgd2hpY2ggaXMgYWxzbyBhIHNlY3JldCBmb3JtdWxhIQogICAgICogCiAgICAgKiBXaGVuIHBsYXllciBjaGFsbGVuZ2Ugb3IgZG8gdHJhaW5pbmcgaW4gYSBkdW5nZW9uLCB0aGUgZmVlIHdpbGwgYmUgY29sbGVjdGVkIGFzIHRoZSBkdW5nZW9uIHJld2FyZHMsCiAgICAgKiB3aGljaCB3aWxsIGJlIHJld2FyZGVkIHRvIHRoZSBwbGF5ZXIgd2hvIHN1Y2Nlc3NmdWxseSBjaGFsbGVuZ2VkIHRoZSBjdXJyZW50IGZsb29yLgogICAgICogCiAgICAgKiBFYWNoIGR1bmdlb24gZml0cyBpbiBmaXRzIGludG8gdGhyZWUgMjU2LWJpdCB3b3Jkcy4KICAgICAqLwogICAgc3RydWN0IER1bmdlb24gewogICAgICAgIAogICAgICAgIC8vIEVhY2ggZHVuZ2VvbiBoYXMgYW4gSUQgd2hpY2ggaXMgdGhlIGluZGV4IGluIHRoZSBzdG9yYWdlIGFycmF5LgoKICAgICAgICAvLyBUaGUgdGltZXN0YW1wIG9mIHRoZSBibG9jayB3aGVuIHRoaXMgZHVuZ2VvbiBpcyBjcmVhdGVkLgogICAgICAgIHVpbnQzMiBjcmVhdGlvblRpbWU7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIHN0YXR1cyBvZiB0aGUgZHVuZ2VvbiwgZWFjaCBkdW5nZW9uIGNhbiBoYXZlIDUgc3RhdHVzLCBuYW1lbHk6CiAgICAgICAgLy8gMDogQWN0aXZlIHwgMTogVHJhbnNwb3J0IE9ubHkgfCAyOiBDaGFsbGVuZ2UgT25seSB8IDM6IFRyYWluIE9ubHkgfCA0OiBJbkFjdGl2ZQogICAgICAgIHVpbnQ4IHN0YXR1czsKICAgICAgICAKICAgICAgICAvLyBUaGUgZHVuZ2VvbidzIGRpZmZpY3VsdHksIHRoZSBoaWdoZXIgdGhlIGRpZmZpY3VsdHksIAogICAgICAgIC8vIG5vcm1hbGx5LCB0aGUgInJhcmVyIiB0aGUgc2VlZEdlbmVzLCB0aGUgaGlnaGVyIHRoZSBkaWZmY3VsdHksCiAgICAgICAgLy8gYW5kIHRoZSBoaWdoZXIgdGhlIGNvbnRyaWJ1dGlvbiBmZWUgaXQgaXMgdG8gY2hhbGxlbmdlLCB0cmFpbiwgYW5kIHRyYW5zcG9ydCB0byB0aGUgZHVuZ2VvbiwKICAgICAgICAvLyB0aGUgZm9ybXVsYSBmb3IgdGhlIGNvbnRyaWJ1dGlvbiBmZWUgaXMgaW4gRHVuZ2VvbkNoYWxsZW5nZSBhbmQgRHVuZ2VvblRyYWluaW5nIGNvbnRyYWN0cy4KICAgICAgICAvLyBBIGR1bmdlb24ncyBkaWZmaWN1bHR5IG5ldmVyIGNoYW5nZS4KICAgICAgICB1aW50OCBkaWZmaWN1bHR5OwogICAgICAgIAogICAgICAgIC8vIFRoZSBkdW5nZW9uJ3MgY2FwYWNpdHksIG1heGltdW0gbnVtYmVyIG9mIHBsYXllcnMgYWxsb3dlZCB0byBzdGF5IG9uIHRoaXMgZHVuZ2Vvbi4KICAgICAgICAvLyBUaGUgY2FwYWNpdHkgb2YgdGhlIG5ld2JpZSBkdW5nZW9uIChIb2x5bGFuZCkgaXMgc2V0IGF0IDAgKHdoaWNoIGlzIGluZmluaXR5KS4KICAgICAgICAvLyBVc2luZyAxNi1iaXQgdW5zaWduZWQgaW50ZWdlcnMgY2FuIGhhdmUgYSBtYXhpbXVtIG9mIDY1NTM1IGluIGNhcGFjaXR5LgogICAgICAgIC8vIEEgZHVuZ2VvbidzIGNhcGFjaXR5IG5ldmVyIGNoYW5nZS4KICAgICAgICB1aW50MTYgY2FwYWNpdHk7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGN1cnJlbnQgZmxvb3IgbnVtYmVyLCBhIGR1bmdlb24gaXMgY29uc2lzdHMgb2YgYW4gdW1saW1pdGVkIG51bWJlciBvZiBmbG9vcnMsCiAgICAgICAgLy8gd2hlbiB0aGVyZSBpcyBoZXJvZXMgc3VjY2Vzc2Z1bGx5IGNoYWxsZW5nZWQgYSBmbG9vciwgdGhlIG5leHQgZmxvb3Igd2lsbCBiZQogICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkLiBVc2luZyAzMi1iaXQgdW5zaWduZWQgaW50ZWdlciBjYW4gaGF2ZSBhIG1heGltdW0gb2YgNCBiaWxsaW9uIGZsb29ycy4KICAgICAgICB1aW50MzIgZmxvb3JOdW1iZXI7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIHRpbWVzdGFtcCBvZiB0aGUgYmxvY2sgd2hlbiB0aGUgY3VycmVudCBmbG9vciBpcyBnZW5lcmF0ZWQuCiAgICAgICAgdWludDMyIGZsb29yQ3JlYXRpb25UaW1lOwogICAgICAgIAogICAgICAgIC8vIEN1cnJlbnQgYWNjdW11bGF0ZWQgcmV3YXJkcywgc3VjY2Vzc2Z1bCBjaGFsbGVuZ2VyIHdpbGwgZ2V0IGEgbGFyZ2UgcHJvcG9ydGlvbiBvZiBpdC4KICAgICAgICB1aW50MTI4IHJld2FyZHM7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIHNlZWQgZ2VuZXMgb2YgdGhlIGR1bmdlb24sIGl0IGlzIHVzZWQgYXMgdGhlIGJhc2UgZ2VuZSBmb3IgZmlyc3QgZmxvb3IsIAogICAgICAgIC8vIHNvbWUgZHVuZ2VvbnMgYXJlIHJhcmVyIGFuZCBzb21lIGFyZSBtb3JlIGNvbW1vbiwgdGhlIGV4YWN0IGRldGFpbHMgYXJlLCAKICAgICAgICAvLyBvZiBjb3Vyc2UsIHRvcCBzZWNyZXQgb2YgdGhlIGdhbWUhIAogICAgICAgIC8vIEEgZHVuZ2VvbidzIHNlZWRHZW5lcyBuZXZlciBjaGFuZ2UuCiAgICAgICAgdWludCBzZWVkR2VuZXM7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIGdlbmVzIGZvciBjdXJyZW50IGZsb29yLCBpdCBlbmNvZGVzIHRoZSBkaWZmaWN1bHR5IGxldmVsIG9mIHRoZSBjdXJyZW50IGZsb29yLgogICAgICAgIC8vIFdlIGNvbnNpZGVyZWQgd2hldGhlciB0byBzdG9yZSB0aGUgZW50aXJlIGFycmF5IG9mIGdlbmVzIGZvciBhbGwgZmxvb3JzLCBidXQKICAgICAgICAvLyBpbiBvcmRlciB0byBzYXZlIHNvbWUgcHJlY2lvdXMgZ2FzIHdlJ3JlIHdpbGxpbmcgdG8gc2FjcmlmaWNlIHNvbWUgZnVuY3Rpb25hbGl0aWVzIHdpdGggdGhhdC4KICAgICAgICB1aW50IGZsb29yR2VuZXM7CiAgICAgICAgCiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBUaGUgbWFpbiBIZXJvIHN0cnVjdC4gRXZlcnkgaGVybyBpbiB0aGUgZ2FtZSBpcyByZXByZXNlbnRlZCBieSB0aGlzIHN0cnVjdHVyZS4KICAgICAqLwogICAgc3RydWN0IEhlcm8gewoKICAgICAgICAvLyBFYWNoIGhlcm8gaGFzIGFuIElEIHdoaWNoIGlzIHRoZSBpbmRleCBpbiB0aGUgc3RvcmFnZSBhcnJheS4KICAgICAgICAKICAgICAgICAvLyBUaGUgdGltZXN0YW1wIG9mIHRoZSBibG9jayB3aGVuIHRoaXMgZHVuZ2VvbiBpcyBjcmVhdGVkLgogICAgICAgIHVpbnQ2NCBjcmVhdGlvblRpbWU7CiAgICAgICAgCiAgICAgICAgLy8gVGhlIHRpbWVzdGFtcCBvZiB0aGUgYmxvY2sgd2hlcmUgYSBjaGFsbGVuZ2UgaXMgcGVyZm9ybWVkLCB1c2VkIHRvIGNhbGN1bGF0ZSB3aGVuIGEgaGVybyBpcyBhbGxvd2VkIHRvIGVuZ2FnZSBpbiBhbm90aGVyIGNoYWxsZW5nZS4KICAgICAgICB1aW50NjQgY29vbGRvd25TdGFydFRpbWU7CiAgICAgICAgCiAgICAgICAgLy8gRXZlcnkgdGltZSBhIGhlcm8gY2hhbGxlbmdlIGEgZHVuZ2VvbiwgaXRzIGNvb2xkb3duIGluZGV4IHdpbGwgYmUgaW5jcmVtZW50ZWQgYnkgb25lLgogICAgICAgIHVpbnQzMiBjb29sZG93bkluZGV4OwogICAgICAgIAogICAgICAgIC8vIFRoZSBzZWVkIG9mIHRoZSBoZXJvLCB0aGUgZ2VuZSBlbmNvZGVzIHRoZSBwb3dlciBsZXZlbCBvZiB0aGUgaGVyby4KICAgICAgICAvLyBUaGlzIGlzIGFub3RoZXIgdG9wIHNlY3JldCBvZiB0aGUgZ2FtZSEgSGVybydzIGdlbmUgY2FuIGJlIHVwZ3JhZGVkIHZpYQogICAgICAgIC8vIHRyYWluaW5nIGluIGEgZHVuZ2Vvbi4KICAgICAgICB1aW50IGdlbmVzOwogICAgICAgIAogICAgfQogICAgCn0KCgovKioKICogQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2Vucy4KICovCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCBpbmRleGVkIHRva2VuSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQgaW5kZXhlZCB0b2tlbklkKTsKICAgIAogICAgLy8gRVJDMjAgY29tcGF0aWJsZSBmdW5jdGlvbnMuCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyk7CiAgICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgCiAgICAvLyBGdW5jdGlvbnMgdGhhdCBkZWZpbmUgb3duZXJzaGlwLgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgCiAgICAvLyBBcHByb3ZhbCByZWxhdGVkIGZ1bmN0aW9ucywgbWFpbmx5IHVzZWQgaW4gYXVjdGlvbiBjb250cmFjdHMuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbklkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGFwcHJvdmVkRm9yKHVpbnQgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgCiAgICAvKioKICAgICAqIEBkZXYgRWFjaCBub24tZnVuZ2libGUgdG9rZW4gb3duZXIgY2FuIG93biBtb3JlIHRoYW4gb25lIHRva2VuIGF0IG9uZSB0aW1lLiAKICAgICAqIEJlY2F1c2UgZWFjaCB0b2tlbiBpcyByZWZlcmVuY2VkIGJ5IGl0cyB1bmlxdWUgSUQsIGhvd2V2ZXIsIAogICAgICogaXQgY2FuIGdldCBkaWZmaWN1bHQgdG8ga2VlcCB0cmFjayBvZiB0aGUgaW5kaXZpZHVhbCB0b2tlbnMgdGhhdCBhIHVzZXIgbWF5IG93bi4gCiAgICAgKiBUbyBkbyB0aGlzLCB0aGUgY29udHJhY3Qga2VlcHMgYSByZWNvcmQgb2YgdGhlIElEcyBvZiBlYWNoIHRva2VuIHRoYXQgZWFjaCB1c2VyIG93bnMuCiAgICAgKi8KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50W10pIHB1YmxpYyBvd25lclRva2VuczsKCn0KCgpjb250cmFjdCBEdW5nZW9uVG9rZW5JbnRlcmZhY2UgaXMgRVJDNzIxLCBFRFN0cnVjdHMgewoKICAgIC8qKgogICAgICogQG5vdGljZSBMaW1pdHMgdGhlIG51bWJlciBvZiBkdW5nZW9ucyB0aGUgY29udHJhY3Qgb3duZXIgY2FuIGV2ZXIgY3JlYXRlLgogICAgICovCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBEVU5HRU9OX0NSRUFUSU9OX0xJTUlUID0gMTAyNDsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IE5hbWUgb2YgdG9rZW4uCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJEdW5nZW9uIjsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFN5bWJvbCBvZiB0b2tlbi4KICAgICAqLwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiRFVORyI7CiAgICAKICAgIC8qKgogICAgICogQGRldiBBbiBhcnJheSBjb250YWluaW5nIHRoZSBEdW5nZW9uIHN0cnVjdCwgd2hpY2ggY29udGFpbnMgYWxsIHRoZSBkdW5nZW9ucyBpbiBleGlzdGFuY2UuCiAgICAgKiAgVGhlIElEIGZvciBlYWNoIGR1bmdlb24gaXMgdGhlIGluZGV4IG9mIHRoaXMgYXJyYXkuCiAgICAgKi8gCiAgICBEdW5nZW9uW10gcHVibGljIGR1bmdlb25zOwoKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgbmV3IGR1bmdlb24gYW5kIHN0b3JlcyBpdCwgb25seSBjb250cmFjdCBvd25lcnMKICAgICAqICBjYW4gY3JlYXRlIG5ldyB0b2tlbiwgYW5kIHdpbGwgYmUgcmVzdHJpY3RlZCBieSB0aGUgRFVOR0VPTl9DUkVBVElPTl9MSU1JVC4KICAgICAqICBXaWxsIGdlbmVyYXRlIGEgTWludCBldmVudCwgYSAgTmV3RHVuZ2VvbkZsb29yIGV2ZW50LCBhbmQgYSBUcmFuc2ZlciBldmVudC4KICAgICAqLyAKICAgIGZ1bmN0aW9uIGNyZWF0ZUR1bmdlb24odWludCBfZGlmZmljdWx0eSwgdWludCBfY2FwYWNpdHksIHVpbnQgX2Zsb29yTnVtYmVyLCB1aW50IF9zZWVkR2VuZXMsIHVpbnQgX2Zsb29yR2VuZXMsIGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBleHRlcm5hbCBmdW5jdGlvbiB0byBzZXQgZHVuZ2VvbiBzdGF0dXMgYnkgaXRzIElELCAKICAgICAqICByZWZlciB0byBEdW5nZW9uU3RydWN0cyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBhYm91dCBkdW5nZW9uIHN0YXR1cy4KICAgICAqICBPbmx5IGNvbnRyYWN0IG93bmVycyBjYW4gYWx0ZXIgZHVuZ2VvbiBzdGF0ZS4KICAgICAqLyAKICAgIGZ1bmN0aW9uIHNldER1bmdlb25TdGF0dXModWludCBfaWQsIHVpbnQgX25ld1N0YXR1cykgZXh0ZXJuYWw7CiAgICAKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gYWRkIGFkZGl0aW9uYWwgZHVuZ2VvbiByZXdhcmRzIGJ5IGl0cyBJRCwgCiAgICAgKiAgb25seSBjb250cmFjdCBvd25lcnMgY2FuIGFsdGVyIGR1bmdlb24gc3RhdGUuCiAgICAgKi8gCiAgICBmdW5jdGlvbiBhZGREdW5nZW9uUmV3YXJkcyh1aW50IF9pZCwgdWludCBfYWRkaXRpbmFsUmV3YXJkcykgZXh0ZXJuYWw7CiAgICAKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gYWRkIGFub3RoZXIgZHVuZ2VvbiBmbG9vciBieSBpdHMgSUQsIAogICAgICogIG9ubHkgY29udHJhY3Qgb3duZXJzIGNhbiBhbHRlciBkdW5nZW9uIHN0YXRlLgogICAgICovIAogICAgZnVuY3Rpb24gYWRkRHVuZ2Vvbk5ld0Zsb29yKHVpbnQgX2lkLCB1aW50IF9uZXdSZXdhcmRzLCB1aW50IF9uZXdGbG9vckdlbmVzKSBleHRlcm5hbDsKICAgIAp9CgoKY29udHJhY3QgSGVyb1Rva2VuSW50ZXJmYWNlIGlzIEVSQzcyMSwgRURTdHJ1Y3RzIHsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IE5hbWUgb2YgdG9rZW4uCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJIZXJvIjsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFN5bWJvbCBvZiB0b2tlbi4KICAgICAqLwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiSEVSTyI7CgogICAgLyoqCiAgICAgKiBAZGV2IEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIEhlcm8gc3RydWN0LCB3aGljaCBjb250YWlucyBhbGwgdGhlIGhlcm9lcyBpbiBleGlzdGFuY2UuCiAgICAgKiAgVGhlIElEIGZvciBlYWNoIGhlcm8gaXMgdGhlIGluZGV4IG9mIHRoaXMgYXJyYXkuCiAgICAgKi8gCiAgICBIZXJvW10gcHVibGljIGhlcm9lczsKCiAgICAvKioKICAgICAqIEBkZXYgQW4gZXh0ZXJuYWwgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgbmV3IGhlcm8gYW5kIHN0b3JlcyBpdCwKICAgICAqICBvbmx5IGNvbnRyYWN0IG93bmVycyBjYW4gY3JlYXRlIG5ldyB0b2tlbi4KICAgICAqICBtZXRob2QgZG9lc24ndCBkbyBhbnkgY2hlY2tpbmcgYW5kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIHRoZQogICAgICogIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuCiAgICAgKiBAcGFyYW0gX2dlbmVzIFRoZSBnZW5lIG9mIHRoZSBuZXcgaGVyby4KICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGluaXRhbCBvd25lciBvZiB0aGlzIGhlcm8uCiAgICAgKiBAcmV0dXJuIFRoZSBoZXJvIElEIG9mIHRoZSBuZXcgaGVyby4KICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlSGVybyh1aW50IF9nZW5lcywgYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhlIGV4dGVybmFsIGZ1bmN0aW9uIHRvIHNldCB0aGUgaGVybyBnZW5lcyBieSBpdHMgSUQsIAogICAgICogIG9ubHkgY29udHJhY3Qgb3duZXJzIGNhbiBhbHRlciBoZXJvIHN0YXRlLgogICAgICovIAogICAgZnVuY3Rpb24gc2V0SGVyb0dlbmVzKHVpbnQgX2lkLCB1aW50IF9uZXdHZW5lcykgZXh0ZXJuYWw7CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCB0aGUgY29vbGRvd25TdGFydFRpbWUgZm9yIHRoZSBnaXZlbiBoZXJvLiBBbHNvIGluY3JlbWVudHMgdGhlIGNvb2xkb3duSW5kZXguCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyaWdnZXJDb29sZG93bih1aW50IF9pZCkgZXh0ZXJuYWw7CiAgICAKfQoKCi8qKgogKiBTRUNSRVQKICovCmNvbnRyYWN0IENoYWxsZW5nZUZvcm11bGFJbnRlcmZhY2UgewogICAgCiAgICAvKioKICAgICAqIEBkZXYgZ2l2ZW4gZ2VuZXMgb2YgY3VycmVudCBmbG9vciBhbmQgZHVuZ2VvbiBzZWVkLCByZXR1cm4gYSBnZW5ldGljIGNvbWJpbmF0aW9uIC0gbWF5IGhhdmUgYSByYW5kb20gZmFjdG9yLgogICAgICogQHBhcmFtIF9mbG9vckdlbmVzIEdlbmVzIG9mIGZsb29yLgogICAgICogQHBhcmFtIF9zZWVkR2VuZXMgU2VlZCBnZW5lcyBvZiBkdW5nZW9uLgogICAgICogQHJldHVybiBUaGUgcmVzdWx0aW5nIGdlbmVzLgogICAgICovCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVSZXN1bHQodWludCBfZmxvb3JHZW5lcywgdWludCBfc2VlZEdlbmVzKSBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgIAp9CgoKLyoqCiAqIFNFQ1JFVAogKi8KY29udHJhY3QgVHJhaW5pbmdGb3JtdWxhSW50ZXJmYWNlIHsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IGdpdmVuIGdlbmVzIG9mIGhlcm8gYW5kIGN1cnJlbnQgZmxvb3IsIHJldHVybiBhIGdlbmV0aWMgY29tYmluYXRpb24gLSBtYXkgaGF2ZSBhIHJhbmRvbSBmYWN0b3IuCiAgICAgKiBAcGFyYW0gX2hlcm9HZW5lcyBHZW5lcyBvZiBoZXJvLgogICAgICogQHBhcmFtIF9mbG9vckdlbmVzIEdlbmVzIG9mIGN1cnJlbnQgZmxvb3IuCiAgICAgKiBAcGFyYW0gX2VxdWlwbWVudElkIEVxdWlwbWVudCBpbmRleCB0byB0cmFpbiBmb3IsIDAgaXMgdHJhaW4gYWxsIGF0dHJpYnV0ZXMuCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgZ2VuZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJlc3VsdCh1aW50IF9oZXJvR2VuZXMsIHVpbnQgX2Zsb29yR2VuZXMsIHVpbnQgX2VxdWlwbWVudElkKSBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgIAp9CgoKLyoqCiAqIEB0aXRsZSBFREJhc2UKICogQGRldiBCYXNlIGNvbnRyYWN0IGZvciBFdGhlciBEdW5nZW9uLiBJdCBpbXBsZW1lbnRzIGFsbCBuZWNlc3Nhcnkgc3ViLWNsYXNzZXMsCiAqICBob2xkcyBhbGwgdGhlIGNvbnRyYWN0cywgY29uc3RhbnRzLCBnYW1lIHNldHRpbmdzLCBzdG9yYWdlIHZhcmlhYmxlcywgZXZlbnRzLCBhbmQgc29tZSBjb21tb25seSB1c2VkIGZ1bmN0aW9ucy4KICovCmNvbnRyYWN0IEVEQmFzZSBpcyBFamVjdGFibGVPd25hYmxlLCBQYXVzYWJsZSwgUHVsbFBheW1lbnQsIEVEU3RydWN0cyB7CiAgICAKICAgIC8qID09PT09PT09IENPTlRSQUNUUyA9PT09PT09PSAqLwogICAgCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiB0aGUgRVJDNzIxIHRva2VuIGNvbnRyYWN0IG1hbmFnaW5nIGFsbCBEdW5nZW9uIHRva2Vucy4KICAgIER1bmdlb25Ub2tlbkludGVyZmFjZSBwdWJsaWMgZHVuZ2VvblRva2VuQ29udHJhY3Q7CiAgICAKICAgIC8vLyBAZGV2IFRoZSBhZGRyZXNzIG9mIHRoZSBFUkM3MjEgdG9rZW4gY29udHJhY3QgbWFuYWdpbmcgYWxsIEhlcm8gdG9rZW5zLgogICAgSGVyb1Rva2VuSW50ZXJmYWNlIHB1YmxpYyBoZXJvVG9rZW5Db250cmFjdDsKICAgIAogICAgLy8vIEBkZXYgVGhlIGFkZHJlc3Mgb2YgdGhlIENoYWxsZW5nZUZvcm11bGEgY29udHJhY3QgdGhhdCBoYW5kbGVzIHRoZSBmbG9vciBnZW5lcmF0aW9uIG1lY2hhbmljcyBhZnRlciBjaGFsbGVuZ2Ugc3VjY2Vzcy4KICAgIENoYWxsZW5nZUZvcm11bGFJbnRlcmZhY2UgY2hhbGxlbmdlRm9ybXVsYUNvbnRyYWN0OwogICAgCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiB0aGUgVHJhaW5pbmdGb3JtdWxhIGNvbnRyYWN0IHRoYXQgaGFuZGxlcyB0aGUgaGVybyB0cmFpbmluZyBtZWNoYW5pY3MuCiAgICBUcmFpbmluZ0Zvcm11bGFJbnRlcmZhY2UgdHJhaW5pbmdGb3JtdWxhQ29udHJhY3Q7CiAgICAKICAgIAogICAgLyogPT09PT09PT0gQ09OU1RBTlRTIC8gR0FNRSBTRVRUSU5HUyAoYWxsIHZhcmlhYmxlcyBhcmUgc2V0IHRvIGNvbnN0YW50IGluIG9yZGVyIHRvIHNhdmUgZ2FzKSA9PT09PT09PSAqLwogICAgCiAgICAvLyAxIGZpbm5leSA9IDAuMDAxIGV0aGVyCiAgICAvLyAxIHN6YWJvID0gMC4wMDEgZmlubmV5CiAgICAKICAgIC8vLyBAZGV2IFN1cGVyIEhlcm8gKGZ1bGwgc2V0IG9mIHNhbWUtdGhlbWVkIFJhcmUgRXF1aXBtZW50cywgdGhlcmUgYXJlIDggaW4gdG90YWwpCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBTVVBFUl9IRVJPX01VTFRJUExJRVIgPSAzMjsKICAgIAogICAgLy8vIEBkZXYgVWx0cmEgSGVybyAoZnVsbCBzZXQgb2Ygc2FtZS10aGVtZWQgRXBpYyBFcXVpcG1lbnRzLCB0aGVyZSBhcmUgNCBpbiB0b3RhbCkKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFVMVFJBX0hFUk9fTVVMVElQTElFUiA9IDY0OwogICAgCiAgICAvKioKICAgICAqIEBkZXYgTWVnYSBIZXJvIChmdWxsIHNldCBvZiBzYW1lLXRoZW1lZCBMZWdlbmRhcnkgRXF1aXBtZW50cywgdGhlcmUgYXJlIDIgaW4gdG90YWwpCiAgICAgKiAgVGhlcmUgYXJlIGFsc28gMiBVbHRpbWF0ZSBIZXJvL0RlbW9uLCBQYW5ndSBhbmQgQ2hhb3MsIHdoaWNoIHdpbGwgdXNlIHRoZSBNRUdBX0hFUk9fTVVMVElQTElFUi4KICAgICAqLwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgTUVHQV9IRVJPX01VTFRJUExJRVIgPSA5NjsKICAgIAogICAgLy8vIEBkZXYgVGhlIGZlZSBmb3IgcmVjcnVpdGluZyBhIGhlcm8uIFRoZSBwYXltZW50IGlzIGFjY3VtdWxhdGVkIHRvIHRoZSByZXdhcmRzIG9mIHRoZSBvcmlnaW4gZHVuZ2Vvbi4KICAgIHVpbnQgcHVibGljIHJlY3J1aXRIZXJvRmVlID0gMiBmaW5uZXk7CiAgICAKICAgIC8qKgogICAgICogQGRldiBUaGUgYWN0dWFsIGZlZSBjb250cmlidXRpb24gcmVxdWlyZWQgdG8gY2FsbCB0cmFuc3BvcnQoKSBpcyBjYWxjdWxhdGVkIGJ5IHRoaXMgZmVlTXVsdGlwbGllciwKICAgICAqICB0aW1lcyB0aGUgZHVuZ2VvbiBkaWZmaWN1bHR5IG9mIGRlc3RpbmF0aW9uIGR1bmdlb24uIFRoZSBwYXltZW50IGlzIGFjY3VtdWxhdGVkIHRvIHRoZSByZXdhcmRzIG9mIHRoZSBvcmlnaW4gZHVuZ2VvbiwKICAgICAqICBhbmQgYSBsYXJnZSBwcm9wb3J0aW9uIHdpbGwgYmUgY2xhaW1lZCBieSB3aG9ldmVyIHN1Y2Nlc3NmdWxseSBjaGFsbGVuZ2VkIHRoZSBmbG9vci4KICAgICAqLwogICAgdWludCBwdWJsaWMgdHJhbnNwb3J0YXRpb25GZWVNdWx0aXBsaWVyID0gMjUwIHN6YWJvOwogICAgCiAgICAvLy9AZGV2IEFsbCBoZXJvIHN0YXJ0cyBpbiB0aGUgbm92aWNlIGR1bmdlb24sIGFsc28gaGVybyBjYW4gb25seSBiZSByZWNydWl0ZWQgaW4gbm92aWNlIGR1bmdvZW4uCiAgICB1aW50IHB1YmxpYyBub3ZpY2VEdW5nZW9uSWQgPSAzMTsgLy8gPCBkdW5nZW9uIElEIDMxID0gQWJ5c3MKICAgIAogICAgLy8vIEBkZXYgQW1vdW50IG9mIGZhaXRoIHJlcXVpcmVkIHRvIGNsYWltIGEgcG9ydGlvbiBvZiB0aGUgZ3JhbmRDb25zb2xhdGlvblJld2FyZHMuCiAgICB1aW50IHB1YmxpYyBjb25zb2xhdGlvblJld2FyZHNSZXF1aXJlZEZhaXRoID0gMTAwOwogICAgCiAgICAvLy8gQGRldiBUaGUgcGVyY2VudGFnZSBmb3Igd2hpY2ggd2hlbiBhIHBsYXllciBjYW4gZ2V0IGZyb20gdGhlIGdyYW5kQ29uc29sYXRpb25SZXdhcmRzIHdoZW4gbWVldGluZyB0aGUgZmFpdGggcmVxdWlyZW1lbnQuCiAgICB1aW50IHB1YmxpYyBjb25zb2xhdGlvblJld2FyZHNDbGFpbVBlcmNlbnQgPSA1MDsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBhY3R1YWwgZmVlIGNvbnRyaWJ1dGlvbiByZXF1aXJlZCB0byBjYWxsIGNoYWxsZW5nZSgpIGlzIGNhbGN1bGF0ZWQgYnkgdGhpcyBmZWVNdWx0aXBsaWVyLAogICAgICogIHRpbWVzIHRoZSBkdW5nZW9uIGRpZmZpY3VsdHkuIFRoZSBwYXltZW50IGlzIGFjY3VtdWxhdGVkIHRvIHRoZSBkdW5nZW9uIHJld2FyZHMsIAogICAgICogIGFuZCBhIGxhcmdlIHByb3BvcnRpb24gd2lsbCBiZSBjbGFpbWVkIGJ5IHdob2V2ZXIgc3VjY2Vzc2Z1bGx5IGNoYWxsZW5nZWQgdGhlIGZsb29yLgogICAgICovCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBjaGFsbGVuZ2VGZWVNdWx0aXBsaWVyID0gMSBmaW5uZXk7CiAgICAKICAgIC8qKgogICAgICogQGRldiBUaGUgcGVyY2VudGFnZSBmb3Igd2hpY2ggc3VjY2Vzc2Z1bCBjaGFsbGVuZ2VyIGJlIHJld2FyZGVkIG9mIHRoZSBkdW5nZW9ucycgYWNjdW11bGF0ZWQgcmV3YXJkcy4KICAgICAqICBUaGUgcmVtYWluaW5nIHJld2FyZHMgc3VidHJhY3QgZHVuZ2VvbiBtYXN0ZXIgcmV3YXJkcyBhbmQgY29uc29sYXRpb24gcmV3YXJkcyB3aWxsIGJlIHVzZWQgYXMgdGhlIGJhc2UgcmV3YXJkcyBmb3IgbmV3IGZsb29yLgogICAgICovCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBjaGFsbGVuZ2VSZXdhcmRzUGVyY2VudCA9IDQ1OwogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhlIGRldmVsb3BlciBmZWUgZm9yIGR1bmdlb24gbWFzdGVyIChvd25lciBvZiB0aGUgZHVuZ2VvbiB0b2tlbikuCiAgICAgKiAgTm90ZSB0aGF0IHdoZW4gRXRoZXIgRHVuZ2VvbiBiZWNvbWVzIHRydWx5IGRlY2VudHJhbGlzZWQsIGNvbnRyYWN0IG93bmVyc2hpcCB3aWxsIGJlIGVqZWN0ZWQsCiAgICAgKiAgYW5kIHRoZSBtYXN0ZXIgcmV3YXJkcyB3aWxsIGJlIHJld2FyZGVkIHRvIHRoZSBkdW5nZW9uIG93bmVyIChEdW5nZW9uIE1hc3RlcnMpLgogICAgICovCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBtYXN0ZXJSZXdhcmRzUGVyY2VudCA9IDg7CiAgICAKICAgIC8vLyBAZGV2IFRoZSBwZXJjZW50YWdlIGZvciB3aGljaCB0aGUgY2hhbGxlbmdlIHJld2FyZHMgaXMgYWRkZWQgdG8gdGhlIGdyYW5kQ29uc29sYXRpb25SZXdhcmRzLgogICAgdWludCBwdWJsaWMgY29uc29sYXRpb25SZXdhcmRzUGVyY2VudCA9IDI7CiAgICAKICAgIC8vLyBAZGV2IFRoZSBwcmVwYXJhdGlvbiB0aW1lIHBlcmlvZCB3aGVyZSBhIG5ldyBkdW5nZW9uIGlzIGNyZWF0ZWQsIGJlZm9yZSBpdCBjYW4gYmUgY2hhbGxlbmdlZC4KICAgIHVpbnQgcHVibGljIGR1bmdlb25QcmVwYXJhdGlvblRpbWUgPSA2MCBtaW51dGVzOwogICAgCiAgICAvLy8gQGRldiBUaGUgY2hhbGxlbmdlIHJld2FyZHMgcGVyY2VudGFnZSB1c2VkIHJpZ2h0IGFmdGVyIHRoZSBwcmVwYXJhdGlvbiBwZXJpb2QuCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBydXNoVGltZUNoYWxsZW5nZVJld2FyZHNQZXJjZW50ID0gMjI7CiAgICAKICAgIC8vLyBAZGV2IFRoZSBudW1iZXIgb2YgZmxvb3IgaW4gd2hpY2ggdGhlIHJ1c2hUaW1lQ2hhbGxlbmdlUmV3YXJkc1BlcmNlbnQgYmUgYXBwbGllZC4KICAgIHVpbnQgcHVibGljIGNvbnN0YW50IHJ1c2hUaW1lRmxvb3JDb3VudCA9IDMwOwogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhlIGFjdHVhbCBmZWUgY29udHJpYnV0aW9uIHJlcXVpcmVkIHRvIGNhbGwgdHJhaW5YKCkgaXMgY2FsY3VsYXRlZCBieSB0aGlzIGZlZU11bHRpcGxpZXIsCiAgICAgKiAgdGltZXMgdGhlIGR1bmdlb24gZGlmZmljdWx0eSwgdGltZXMgdHJhaW5pbmcgdGltZXMuIFRoZSBwYXltZW50IGlzIGFjY3VtdWxhdGVkIHRvIHRoZSBkdW5nZW9uIHJld2FyZHMsIAogICAgICogIGFuZCBhIGxhcmdlIHByb3BvcnRpb24gd2lsbCBiZSBjbGFpbWVkIGJ5IHdob2V2ZXIgc3VjY2Vzc2Z1bGx5IGNoYWxsZW5nZWQgdGhlIGZsb29yLgogICAgICovCiAgICB1aW50IHB1YmxpYyB0cmFpbmluZ0ZlZU11bHRpcGxpZXIgPSAyIGZpbm5leTsKICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBhY3R1YWwgZmVlIGNvbnRyaWJ1dGlvbiByZXF1aXJlZCB0byBjYWxsIHRyYWluRXF1aXBtZW50KCkgaXMgY2FsY3VsYXRlZCBieSB0aGlzIGZlZU11bHRpcGxpZXIsCiAgICAgKiAgdGltZXMgdGhlIGR1bmdlb24gZGlmZmljdWx0eS4gVGhlIHBheW1lbnQgaXMgYWNjdW11bGF0ZWQgdG8gdGhlIGR1bmdlb24gcmV3YXJkcy4KICAgICAqICAoTm8gcHJlcGFyYXRpb24gcGVyaW9kIGRpc2NvdW50IG9uIGVxdWlwbWVudCB0cmFpbmluZy4pCiAgICAgKi8KICAgIHVpbnQgcHVibGljIGVxdWlwbWVudFRyYWluaW5nRmVlTXVsdGlwbGllciA9IDggZmlubmV5OwogICAgCiAgICAvLy8gQGRldiBUaGUgZGlzY291bnRlZCB0cmFpbmluZyBmZWUgbXVsdGlwbGllciB0byBiZSB1c2VkIGR1cmluZyBwcmVwYXJhdGlvbiBwZXJpb2QuCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBwcmVwYXJhdGlvblBlcmlvZFRyYWluaW5nRmVlTXVsdGlwbGllciA9IDE2MDAgc3phYm87CiAgICAKICAgIC8vLyBAZGV2IFRoZSBkaXNjb3VudGVkIGVxdWlwbWVudCB0cmFpbmluZyBmZWUgbXVsdGlwbGllciB0byBiZSB1c2VkIGR1cmluZyBwcmVwYXJhdGlvbiBwZXJpb2QuCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBwcmVwYXJhdGlvblBlcmlvZEVxdWlwbWVudFRyYWluaW5nRmVlTXVsdGlwbGllciA9IDY0MDAgc3phYm87CiAgICAKICAgIAogICAgLyogPT09PT09PT0gU1RBVEUgVkFSSUFCTEVTID09PT09PT09ICovCiAgICAKICAgIC8qKgogICAgICogQGRldiBBZnRlciBlYWNoIHN1Y2Nlc3NmdWwgdHJhaW5pbmcsIGRvIG5vdCB1cGRhdGUgSGVybyBpbW1lZGlhdGVseSB0byBhdm9pZCBleHBsb2l0LgogICAgICogIFRoZSBoZXJvIHBvd2VyIHdpbGwgYmUgYXV0byB1cGRhdGVkIGR1cmluZyBuZXh0IGNoYWxsZW5nZS90cmFpbmluZyBmb3IgYW55IHBsYXllci4KICAgICAqICBPciBjYWxsaW5nIHRoZSBzZXRUZW1wSGVyb1Bvd2VyKCkgcHVibGljIGZ1bmN0aW9uIGRpcmVjdGx5LgogICAgICovCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcGxheWVyVG9MYXN0QWN0aW9uQmxvY2tOdW1iZXI7CiAgICB1aW50IHRlbXBTdWNjZXNzVHJhaW5pbmdIZXJvSWQ7CiAgICB1aW50IHRlbXBTdWNjZXNzVHJhaW5pbmdOZXdIZXJvR2VuZXMgPSAxOyAvLyB2YWx1ZSAxIGlzIHVzZWQgYXMgbm8gcGVuZGluZyB1cGRhdGUKICAgIAogICAgLy8vIEBkZXYgVGhlIHRvdGFsIGFjY3VtdWxhdGVkIGNvbnNvbGlkYXRpb24gamFja3BvdCAvIHJld2FyZHMgYW1vdW50LgogICAgdWludCBwdWJsaWMgZ3JhbmRDb25zb2xhdGlvblJld2FyZHMgPSAxNjgyMDMwMTA5NjQ2OTM1NTk7IC8vIDwgbWlncmF0ZWQgZnJvbSBwcmV2aW91cyBjb250cmFjdAogICAgCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSB0b2tlbiBJRHMgdG8gdGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZW0sIHRoZSB2YWx1ZSBjYW4gZ2V0IGJ5IGdldFBsYXllckRldGFpbHMuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcGxheWVyVG9EdW5nZW9uSUQ7CiAgICAKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIHBsYXllciBhZGRyZXNzIHRvIHRoZSBwbGF5ZXIncyBmYWl0aCB2YWx1ZSwgdGhlIHZhbHVlIGNhbiBnZXQgYnkgZ2V0UGxheWVyRGV0YWlscy4KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwbGF5ZXJUb0ZhaXRoOwoKICAgIC8qKgogICAgICogQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGEgYm9vbGVhbiBmbGFnIG9mIHdoZXRoZXIgdGhlIHBsYXllciByZWNydWl0ZWQgdGhlIGZpcnN0IGhlcm8uCiAgICAgKiAgTm90ZSB0aGF0IHRyYW5zZmVycmluZyBhIGhlcm8gZnJvbSBvdGhlciBhZGRyZXNzIGRvIG5vdCBjb3VudCwgdGhlIHZhbHVlIGNhbiBnZXQgYnkgZ2V0UGxheWVyRGV0YWlscy4KICAgICAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHBsYXllclRvRmlyc3RIZXJvUmVjcnVpdGVkOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIG93bmVyIGFkZHJlc3MgdG8gY291bnQgb2YgdG9rZW5zIHRoYXQgYWRkcmVzcyBvd25zLCB0aGUgdmFsdWUgY2FuIGdldCBieSBnZXREdW5nZW9uRGV0YWlscy4KICAgIG1hcHBpbmcodWludCA9PiB1aW50KSBkdW5nZW9uSWRUb1BsYXllckNvdW50OwogICAgCiAgICAKICAgIC8qID09PT09PT09IEVWRU5UUyA9PT09PT09PSAqLwogICAgCiAgICAvLy8gQGRldiBUaGUgUGxheWVyVHJhbnNwb3J0ZWQgZXZlbnQgaXMgZmlyZWQgd2hlbiB1c2VyIHRyYW5zcG9ydGVkIHRvIGFub3RoZXIgZHVuZ2Vvbi4KICAgIGV2ZW50IFBsYXllclRyYW5zcG9ydGVkKHVpbnQgdGltZXN0YW1wLCBhZGRyZXNzIGluZGV4ZWQgcGxheWVyQWRkcmVzcywgdWludCBpbmRleGVkIG9yaWdpbkR1bmdlb25JZCwgdWludCBpbmRleGVkIGRlc3RpbmF0aW9uRHVuZ2VvbklkKTsKICAgIAogICAgLy8vIEBkZXYgVGhlIER1bmdlb25DaGFsbGVuZ2VkIGV2ZW50IGlzIGZpcmVkIHdoZW4gdXNlciBmaW5pc2hlZCBhIGR1bmdlb24gY2hhbGxlbmdlLgogICAgZXZlbnQgRHVuZ2VvbkNoYWxsZW5nZWQodWludCB0aW1lc3RhbXAsIGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXJBZGRyZXNzLCB1aW50IGluZGV4ZWQgZHVuZ2VvbklkLCB1aW50IGluZGV4ZWQgaGVyb0lkLCB1aW50IGhlcm9HZW5lcywgdWludCBmbG9vck51bWJlciwgdWludCBmbG9vckdlbmVzLCBib29sIHN1Y2Nlc3MsIHVpbnQgbmV3Rmxvb3JHZW5lcywgdWludCBzdWNjZXNzUmV3YXJkcywgdWludCBtYXN0ZXJSZXdhcmRzKTsKICAKICAgIC8vLyBAZGV2IFRoZSBEdW5nZW9uQ2hhbGxlbmdlZCBldmVudCBpcyBmaXJlZCB3aGVuIHVzZXIgZmluaXNoZWQgYSBkdW5nZW9uIGNoYWxsZW5nZS4KICAgIGV2ZW50IENvbnNvbGF0aW9uUmV3YXJkc0NsYWltZWQodWludCB0aW1lc3RhbXAsIGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXJBZGRyZXNzLCB1aW50IGNvbnNvbGF0aW9uUmV3YXJkcyk7CiAgCiAgICAvLy8gQGRldiBUaGUgSGVyb1RyYWluZWQgZXZlbnQgaXMgZmlyZWQgd2hlbiB1c2VyIGZpbmlzaGVkIGEgdHJhaW5pbmcuCiAgICBldmVudCBIZXJvVHJhaW5lZCh1aW50IHRpbWVzdGFtcCwgYWRkcmVzcyBpbmRleGVkIHBsYXllckFkZHJlc3MsIHVpbnQgaW5kZXhlZCBkdW5nZW9uSWQsIHVpbnQgaW5kZXhlZCBoZXJvSWQsIHVpbnQgaGVyb0dlbmVzLCB1aW50IGZsb29yTnVtYmVyLCB1aW50IGZsb29yR2VuZXMsIGJvb2wgc3VjY2VzcywgdWludCBuZXdIZXJvR2VuZXMpOwogICAgCiAgICAKICAgIC8qID09PT09PT09IFBVQkxJQy9FWFRFUk5BTCBGVU5DVElPTlMgPT09PT09PT0gKi8KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEdldCB0aGUgYXR0cmlidXRlcyAoZXF1aXBtZW50cyArIHN0YXRzKSBvZiBhIGhlcm8gZnJvbSBpdHMgZ2VuZS4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0SGVyb0F0dHJpYnV0ZXModWludCBfZ2VuZXMpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnRbXSkgewogICAgICAgIHVpbnRbXSBtZW1vcnkgYXR0cmlidXRlcyA9IG5ldyB1aW50W10oMTIpOwogICAgICAgIAogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IDEyOyBpKyspIHsKICAgICAgICAgICAgYXR0cmlidXRlc1sxMSAtIGldID0gX2dlbmVzICUgMzI7CiAgICAgICAgICAgIF9nZW5lcyAvPSAzMiAqKiA0OwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gYXR0cmlidXRlczsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IENhbGN1bGF0ZSB0aGUgcG93ZXIgb2YgYSBoZXJvIGZyb20gaXRzIGdlbmUsCiAgICAgKiAgaXQgY2FsY3VsYXRlcyB0aGUgZXF1aXBtZW50IHBvd2VyLCBzdGF0cyBwb3dlciwgYW5kIHN1cGVyIGhlcm8gYm9vc3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEhlcm9Qb3dlcih1aW50IF9nZW5lcywgdWludCBfZHVuZ2VvbkRpZmZpY3VsdHkpIHB1YmxpYyBwdXJlIHJldHVybnMgKAogICAgICAgIHVpbnQgdG90YWxQb3dlciwgCiAgICAgICAgdWludCBlcXVpcG1lbnRQb3dlciwgCiAgICAgICAgdWludCBzdGF0c1Bvd2VyLCAKICAgICAgICBib29sIGlzU3VwZXIsIAogICAgICAgIHVpbnQgc3VwZXJSYW5rLAogICAgICAgIHVpbnQgc3VwZXJCb29zdAogICAgKSB7CiAgICAgICAgLy8gSW5kaXZpZHVhbCBwb3dlciBvZiBlYWNoIGVxdWlwbWVudC4KICAgICAgICAvLyBEVVBMSUNBVEUgQ09ERSB3aXRoIF9nZXREdW5nZW9uUG93ZXI6IENvbnN0YW50IGFycmF5IHZhcmlhYmxlIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQsCiAgICAgICAgLy8gc28gbmVlZCB0byBwdXQgaXQgaGVyZSBpbiBvcmRlciB0byBzYXZlIGdhcy4KICAgICAgICB1aW50MTZbMzJdIG1lbW9yeSBFUVVJUE1FTlRfUE9XRVJTID0gWwogICAgICAgICAgICAxLCAyLCA0LCA1LCAxNiwgMTcsIDMyLCAzMywgLy8gW0hvbHldIE5vcm1hbCBFcXVpcG1lbnRzCiAgICAgICAgICAgIDgsIDE2LCAxNiwgMzIsIDMyLCA0OCwgNjQsIDk2LCAvLyBbTXl0aF0gTm9ybWFsIEVxdWlwbWVudHMKICAgICAgICAgICAgCiAgICAgICAgICAgIDQsIDE2LCAzMiwgNjQsIC8vIFtIb2x5XSBSYXJlIEVxdWlwbWVudHMKICAgICAgICAgICAgMzIsIDQ4LCA4MCwgMTI4LCAvLyBbTXl0aF0gUmFyZSBFcXVpcG1lbnRzCiAgICAgICAgICAgIAogICAgICAgICAgICAzMiwgOTYsIC8vIFtIb2x5XSBFcGljIEVxdWlwbWVudHMKICAgICAgICAgICAgODAsIDE5MiwgLy8gW015dGhdIEVwaWMgRXF1aXBtZW50cwogICAgICAgICAgICAKICAgICAgICAgICAgMTkyLCAvLyBbSG9seV0gTGVnZW5kYXJ5IEVxdWlwbWVudHMKICAgICAgICAgICAgMjg4LCAvLyBbTXl0aF0gTGVnZW5kYXJ5IEVxdWlwbWVudHMKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFBhbmd1IC8gQ2hhb3MgTGVnZW5kYXJ5IEVxdWlwbWVudHMgYXJlIHJlc2VydmVkIGZvciBmYXIgZnV0dXJlIHVzZS4KICAgICAgICAgICAgLy8gVGhlaXIgZXhpc3RlbmNlIGlzIHN0aWxsIGEgbXlzdGVyeS4KICAgICAgICAgICAgMzg0LCAvLyBbUGFuZ3VdIExlZ2VuZGFyeSBFcXVpcG1lbnRzCiAgICAgICAgICAgIDUxMiAvLyBbQ2hhb3NdIExlZ2VuZGFyeSBFcXVpcG1lbnRzCiAgICAgICAgXTsKICAgICAgICAKICAgICAgICB1aW50W10gbWVtb3J5IGF0dHJpYnV0ZXMgPSBnZXRIZXJvQXR0cmlidXRlcyhfZ2VuZXMpOwogICAgICAgIAogICAgICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBlcXVpcG1lbnQgcG93ZXIuCiAgICAgICAgc3VwZXJSYW5rID0gYXR0cmlidXRlc1swXTsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgICAgICAgICAgdWludCBlcXVpcG1lbnQgPSBhdHRyaWJ1dGVzW2ldOwogICAgICAgICAgICBlcXVpcG1lbnRQb3dlciArPSBFUVVJUE1FTlRfUE9XRVJTW2VxdWlwbWVudF07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJZiBhbnkgZXF1aXBtZW50IGlzIG9mIGRpZmZlcmVuY2UgaW5kZXgsIHNldCBzdXBlclJhbmsgdG8gMC4KICAgICAgICAgICAgaWYgKHN1cGVyUmFuayAhPSBlcXVpcG1lbnQpIHsKICAgICAgICAgICAgICAgIHN1cGVyUmFuayA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHN0YXRzIHBvd2VyLgogICAgICAgIGZvciAodWludCBqID0gODsgaiA8IDEyOyBqKyspIHsKICAgICAgICAgICAgLy8gU3RhdCBwb3dlciBpcyBnZW5lIG51bWJlciArIDEuCiAgICAgICAgICAgIHN0YXRzUG93ZXIgKz0gYXR0cmlidXRlc1tqXSArIDE7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIENhbGN1bGF0ZSBTdXBlci9VbHRyYS9NZWdhIFBvd2VyIEJvb3N0LgogICAgICAgIGlzU3VwZXIgPSBzdXBlclJhbmsgPj0gMTY7CiAgICAgICAgCiAgICAgICAgaWYgKHN1cGVyUmFuayA+PSAyOCkgeyAvLyBNZWdhIEhlcm8KICAgICAgICAgICAgc3VwZXJCb29zdCA9IChfZHVuZ2VvbkRpZmZpY3VsdHkgLSAxKSAqIE1FR0FfSEVST19NVUxUSVBMSUVSOwogICAgICAgIH0gZWxzZSBpZiAoc3VwZXJSYW5rID49IDI0KSB7IC8vIFVsdHJhIEhlcm8KICAgICAgICAgICAgc3VwZXJCb29zdCA9IChfZHVuZ2VvbkRpZmZpY3VsdHkgLSAxKSAqIFVMVFJBX0hFUk9fTVVMVElQTElFUjsKICAgICAgICB9IGVsc2UgaWYgKHN1cGVyUmFuayA+PSAxNikgeyAvLyBTdXBlciBIZXJvCiAgICAgICAgICAgIHN1cGVyQm9vc3QgPSAoX2R1bmdlb25EaWZmaWN1bHR5IC0gMSkgKiBTVVBFUl9IRVJPX01VTFRJUExJRVI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRvdGFsUG93ZXIgPSBzdGF0c1Bvd2VyICsgZXF1aXBtZW50UG93ZXIgKyBzdXBlckJvb3N0OwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgQ2FsY3VsYXRlIHRoZSBwb3dlciBvZiBhIGR1bmdlb24gZmxvb3IuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldER1bmdlb25Qb3dlcih1aW50IF9nZW5lcykgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIEluZGl2aWR1YWwgcG93ZXIgb2YgZWFjaCBlcXVpcG1lbnQuCiAgICAgICAgLy8gRFVQTElDQVRFIENPREUgd2l0aCBnZXRIZXJvUG93ZXIKICAgICAgICB1aW50MTZbMzJdIG1lbW9yeSBFUVVJUE1FTlRfUE9XRVJTID0gWwogICAgICAgICAgICAxLCAyLCA0LCA1LCAxNiwgMTcsIDMyLCAzMywgLy8gW0hvbHldIE5vcm1hbCBFcXVpcG1lbnRzCiAgICAgICAgICAgIDgsIDE2LCAxNiwgMzIsIDMyLCA0OCwgNjQsIDk2LCAvLyBbTXl0aF0gTm9ybWFsIEVxdWlwbWVudHMKICAgICAgICAgICAgCiAgICAgICAgICAgIDQsIDE2LCAzMiwgNjQsIC8vIFtIb2x5XSBSYXJlIEVxdWlwbWVudHMKICAgICAgICAgICAgMzIsIDQ4LCA4MCwgMTI4LCAvLyBbTXl0aF0gUmFyZSBFcXVpcG1lbnRzCiAgICAgICAgICAgIAogICAgICAgICAgICAzMiwgOTYsIC8vIFtIb2x5XSBFcGljIEVxdWlwbWVudHMKICAgICAgICAgICAgODAsIDE5MiwgLy8gW015dGhdIEVwaWMgRXF1aXBtZW50cwogICAgICAgICAgICAKICAgICAgICAgICAgMTkyLCAvLyBbSG9seV0gTGVnZW5kYXJ5IEVxdWlwbWVudHMKICAgICAgICAgICAgMjg4LCAvLyBbTXl0aF0gTGVnZW5kYXJ5IEVxdWlwbWVudHMKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFBhbmd1IC8gQ2hhb3MgTGVnZW5kYXJ5IEVxdWlwbWVudHMgYXJlIHJlc2VydmVkIGZvciBmYXIgZnV0dXJlIHVzZS4KICAgICAgICAgICAgLy8gVGhlaXIgZXhpc3RlbmNlIGlzIHN0aWxsIGEgbXlzdGVyeS4KICAgICAgICAgICAgMzg0LCAvLyBbUGFuZ3VdIExlZ2VuZGFyeSBFcXVpcG1lbnRzCiAgICAgICAgICAgIDUxMiAvLyBbQ2hhb3NdIExlZ2VuZGFyeSBFcXVpcG1lbnRzCiAgICAgICAgXTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdG90YWwgZHVuZ2VvbiBwb3dlci4KICAgICAgICB1aW50IGR1bmdlb25Qb3dlcjsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCAxMjsgaisrKSB7CiAgICAgICAgICAgIGR1bmdlb25Qb3dlciArPSBFUVVJUE1FTlRfUE9XRVJTW19nZW5lcyAlIDMyXTsKICAgICAgICAgICAgX2dlbmVzIC89IDMyICoqIDQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBkdW5nZW9uUG93ZXI7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBDYWxjdWxhdGUgdGhlIHN1bSBvZiB0b3AgNSBoZXJvZXMgcG93ZXIgYSBwbGF5ZXIgb3ducy4KICAgICAqICBUaGUgZ2FzIHVzYWdlIGluY3JlYXNlZCB3aXRoIHRoZSBudW1iZXIgb2YgaGVyb2VzIGEgcGxheWVyIG93bmVkLCByb3VnaGx5IDUwMCB4IGhlcm8gY291bnQuCiAgICAgKiAgVGhpcyBpcyB1c2VkIGluIHRyYW5zcG9ydCBmdW5jdGlvbiBvbmx5IHRvIGNhbGN1bGF0ZSB0aGUgcmVxdWlyZWQgdHJhbnBvcnQgZmVlLgogICAgICovCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVUb3A1SGVyb2VzUG93ZXIoYWRkcmVzcyBfYWRkcmVzcywgdWludCBfZHVuZ2VvbklkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBoZXJvQ291bnQgPSBoZXJvVG9rZW5Db250cmFjdC5iYWxhbmNlT2YoX2FkZHJlc3MpOwogICAgICAgIAogICAgICAgIGlmIChoZXJvQ291bnQgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gR2V0IHRoZSBkdW5nZW9uIGRpZmZpY3VsdHkgdG8gZmFjdG9yIGluIHRoZSBzdXBlciBwb3dlciBib29zdCB3aGVuIGNhbGN1bGF0aW5nIGhlcm8gcG93ZXIuCiAgICAgICAgdWludCBkaWZmaWN1bHR5OwogICAgICAgICgsLCBkaWZmaWN1bHR5LCwsLCwsKSA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0LmR1bmdlb25zKF9kdW5nZW9uSWQpOwogICAgICAgIAogICAgICAgIC8vIENvbXB1dGUgYWxsIGhlcm8gcG93ZXJzIGZvciBmdXJ0aGVyIGNhbGN1bGF0aW9uLgogICAgICAgIHVpbnRbXSBtZW1vcnkgaGVyb1Bvd2VycyA9IG5ldyB1aW50W10oaGVyb0NvdW50KTsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBoZXJvQ291bnQ7IGkrKykgewogICAgICAgICAgICB1aW50IGhlcm9JZCA9IGhlcm9Ub2tlbkNvbnRyYWN0Lm93bmVyVG9rZW5zKF9hZGRyZXNzLCBpKTsKICAgICAgICAgICAgdWludCBnZW5lczsKICAgICAgICAgICAgKCwsLCBnZW5lcykgPSBoZXJvVG9rZW5Db250cmFjdC5oZXJvZXMoaGVyb0lkKTsKICAgICAgICAgICAgKGhlcm9Qb3dlcnNbaV0sLCwsLCkgPSBnZXRIZXJvUG93ZXIoZ2VuZXMsIGRpZmZpY3VsdHkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHRvcCA1IGhlcm9lcyBwb3dlci4KICAgICAgICB1aW50IHJlc3VsdDsKICAgICAgICB1aW50IGN1ck1heDsKICAgICAgICB1aW50IGN1ck1heEluZGV4OwogICAgICAgIAogICAgICAgIGZvciAodWludCBqOyBqIDwgNTsgaisrKSB7CiAgICAgICAgICAgIGZvciAodWludCBrID0gMDsgayA8IGhlcm9Qb3dlcnMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgICAgIGlmIChoZXJvUG93ZXJzW2tdID4gY3VyTWF4KSB7CiAgICAgICAgICAgICAgICAgICAgY3VyTWF4ID0gaGVyb1Bvd2Vyc1trXTsKICAgICAgICAgICAgICAgICAgICBjdXJNYXhJbmRleCA9IGs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3VsdCArPSBjdXJNYXg7CiAgICAgICAgICAgIGhlcm9Qb3dlcnNbY3VyTWF4SW5kZXhdID0gMDsKICAgICAgICAgICAgY3VyTWF4ID0gMDsKICAgICAgICAgICAgY3VyTWF4SW5kZXggPSAwOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAvLy8gQGRldiBTZXQgdGhlIHByZXZpb3VzbHkgdGVtcCBzdG9yZWQgdXBncmFkZWQgaGVybyBnZW5lcy4gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGNvbnRyYWN0IG93bmVyLgogICAgZnVuY3Rpb24gc2V0VGVtcEhlcm9Qb3dlcigpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgX3NldFRlbXBIZXJvUG93ZXIoKTsKICAgIH0KICAgIAogICAgCiAgICAvKiA9PT09PT09PSBTRVRURVIgRlVOQ1RJT05TID09PT09PT09ICovCiAgICAKICAgIC8vLyBAZGV2IFNldCB0aGUgYWRkcmVzcyBvZiB0aGUgZHVuZ2VvbiB0b2tlbiBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHNldER1bmdlb25Ub2tlbkNvbnRyYWN0KGFkZHJlc3MgX25ld0R1bmdlb25Ub2tlbkNvbnRyYWN0KSBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIGR1bmdlb25Ub2tlbkNvbnRyYWN0ID0gRHVuZ2VvblRva2VuSW50ZXJmYWNlKF9uZXdEdW5nZW9uVG9rZW5Db250cmFjdCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFNldCB0aGUgYWRkcmVzcyBvZiB0aGUgaGVybyB0b2tlbiBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHNldEhlcm9Ub2tlbkNvbnRyYWN0KGFkZHJlc3MgX25ld0hlcm9Ub2tlbkNvbnRyYWN0KSBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIGhlcm9Ub2tlbkNvbnRyYWN0ID0gSGVyb1Rva2VuSW50ZXJmYWNlKF9uZXdIZXJvVG9rZW5Db250cmFjdCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFNldCB0aGUgYWRkcmVzcyBvZiB0aGUgc2VjcmV0IGR1bmdlb24gY2hhbGxlbmdlIGZvcm11bGEgY29udHJhY3QuCiAgICBmdW5jdGlvbiBzZXRDaGFsbGVuZ2VGb3JtdWxhQ29udHJhY3QoYWRkcmVzcyBfbmV3Q2hhbGxlbmdlRm9ybXVsYUFkZHJlc3MpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgY2hhbGxlbmdlRm9ybXVsYUNvbnRyYWN0ID0gQ2hhbGxlbmdlRm9ybXVsYUludGVyZmFjZShfbmV3Q2hhbGxlbmdlRm9ybXVsYUFkZHJlc3MpOwogICAgfQogICAgCiAgICAvLy8gQGRldiBTZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIHNlY3JldCBoZXJvIHRyYWluaW5nIGZvcm11bGEgY29udHJhY3QuCiAgICBmdW5jdGlvbiBzZXRUcmFpbmluZ0Zvcm11bGFDb250cmFjdChhZGRyZXNzIF9uZXdUcmFpbmluZ0Zvcm11bGFBZGRyZXNzKSBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIHRyYWluaW5nRm9ybXVsYUNvbnRyYWN0ID0gVHJhaW5pbmdGb3JtdWxhSW50ZXJmYWNlKF9uZXdUcmFpbmluZ0Zvcm11bGFBZGRyZXNzKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgVXBkYXRlcyB0aGUgZmVlIGZvciBjYWxsaW5nIHJlY3J1aXRIZXJvKCkuCiAgICBmdW5jdGlvbiBzZXRSZWNydWl0SGVyb0ZlZSh1aW50IF9uZXdSZWNydWl0SGVyb0ZlZSkgb25seU93bmVyIGV4dGVybmFsIHsKICAgICAgICByZWNydWl0SGVyb0ZlZSA9IF9uZXdSZWNydWl0SGVyb0ZlZTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgVXBkYXRlcyB0aGUgZmVlIGNvbnRyaWJ1dGlvbiBtdWx0aXBsaWVyIHJlcXVpcmVkIGZvciBjYWxsaW5nIHRyYW5zcG9ydCgpLgogICAgZnVuY3Rpb24gc2V0VHJhbnNwb3J0YXRpb25GZWVNdWx0aXBsaWVyKHVpbnQgX25ld1RyYW5zcG9ydGF0aW9uRmVlTXVsdGlwbGllcikgb25seU93bmVyIGV4dGVybmFsIHsKICAgICAgICB0cmFuc3BvcnRhdGlvbkZlZU11bHRpcGxpZXIgPSBfbmV3VHJhbnNwb3J0YXRpb25GZWVNdWx0aXBsaWVyOwogICAgfQogICAgCiAgICAvLy8gQGRldiBVcGRhdGVzIHRoZSBub3ZpY2UgZHVuZ2VvbiBJRC4KICAgIGZ1bmN0aW9uIHNldE5vdmljZUR1bmdlb25JZCh1aW50IF9uZXdOb3ZpY2VEdW5nZW9uSWQpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgbm92aWNlRHVuZ2VvbklkID0gX25ld05vdmljZUR1bmdlb25JZDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgVXBkYXRlcyB0aGUgcmVxdWlyZWQgYW1vdW50IG9mIGZhaXRoIHRvIGdldCBhIHBvcnRpb24gb2YgdGhlIGNvbnNvbGF0aW9uIHJld2FyZHMuCiAgICBmdW5jdGlvbiBzZXRDb25zb2xhdGlvblJld2FyZHNSZXF1aXJlZEZhaXRoKHVpbnQgX25ld0NvbnNvbGF0aW9uUmV3YXJkc1JlcXVpcmVkRmFpdGgpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgY29uc29sYXRpb25SZXdhcmRzUmVxdWlyZWRGYWl0aCA9IF9uZXdDb25zb2xhdGlvblJld2FyZHNSZXF1aXJlZEZhaXRoOwogICAgfQogICAgCiAgICAvLy8gQGRldiBVcGRhdGVzIHRoZSBwZXJjZW50YWdlIHBvcnRpb24gb2YgY29uc29sYXRpb24gcmV3YXJkcyBhIHBsYXllciBnZXQgd2hlbiBtZWV0aW5nIHRoZSBmYWl0aCByZXF1aXJlbWVudC4KICAgIGZ1bmN0aW9uIHNldENvbnNvbGF0aW9uUmV3YXJkc0NsYWltUGVyY2VudCh1aW50IF9uZXdDb25zb2xhdGlvblJld2FyZHNDbGFpbVBlcmNlbnQpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgY29uc29sYXRpb25SZXdhcmRzQ2xhaW1QZXJjZW50ID0gX25ld0NvbnNvbGF0aW9uUmV3YXJkc0NsYWltUGVyY2VudDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgVXBkYXRlcyB0aGUgY29uc29sYXRpb24gcmV3YXJkcyBwZXJjZW50YWdlLgogICAgZnVuY3Rpb24gc2V0Q29uc29sYXRpb25SZXdhcmRzUGVyY2VudCh1aW50IF9uZXdDb25zb2xhdGlvblJld2FyZHNQZXJjZW50KSBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIGNvbnNvbGF0aW9uUmV3YXJkc1BlcmNlbnQgPSBfbmV3Q29uc29sYXRpb25SZXdhcmRzUGVyY2VudDsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgVXBkYXRlcyB0aGUgY2hhbGxlbmdlIGNvb2xkb3duIHRpbWUuCiAgICBmdW5jdGlvbiBzZXREdW5nZW9uUHJlcGFyYXRpb25UaW1lKHVpbnQgX25ld0R1bmdlb25QcmVwYXJhdGlvblRpbWUpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgZHVuZ2VvblByZXBhcmF0aW9uVGltZSA9IF9uZXdEdW5nZW9uUHJlcGFyYXRpb25UaW1lOwogICAgfQogICAgCiAgICAvLy8gQGRldiBVcGRhdGVzIHRoZSBmZWUgY29udHJpYnV0aW9uIG11bHRpcGxpZXIgcmVxdWlyZWQgZm9yIGNhbGxpbmcgdHJhaW5YKCkuCiAgICBmdW5jdGlvbiBzZXRUcmFpbmluZ0ZlZU11bHRpcGxpZXIodWludCBfbmV3VHJhaW5pbmdGZWVNdWx0aXBsaWVyKSBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIHRyYWluaW5nRmVlTXVsdGlwbGllciA9IF9uZXdUcmFpbmluZ0ZlZU11bHRpcGxpZXI7CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlcyB0aGUgZmVlIGNvbnRyaWJ1dGlvbiBtdWx0aXBsaWVyIHJlcXVpcmVkIGZvciBjYWxsaW5nIHRyYWluRXF1aXBtZW50KCkuCiAgICBmdW5jdGlvbiBzZXRFcXVpcG1lbnRUcmFpbmluZ0ZlZU11bHRpcGxpZXIodWludCBfbmV3RXF1aXBtZW50VHJhaW5pbmdGZWVNdWx0aXBsaWVyKSBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIGVxdWlwbWVudFRyYWluaW5nRmVlTXVsdGlwbGllciA9IF9uZXdFcXVpcG1lbnRUcmFpbmluZ0ZlZU11bHRpcGxpZXI7CiAgICB9CiAgICAKICAgIAogICAgLyogPT09PT09PT0gSU5URVJOQUwvUFJJVkFURSBGVU5DVElPTlMgPT09PT09PT0gKi8KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIHNldCB0aGUgcHJldmlvdXNseSB0ZW1wIHN0b3JlZCB1cGdyYWRlZCBoZXJvIGdlbmVzLiAKICAgICAqIEV2ZXJ5IGNoYWxsZW5nZS90cmFpbmluZyB3aWxsIGZpcnN0IGNhbGwgdGhpcyBmdW5jdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gX3NldFRlbXBIZXJvUG93ZXIoKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gR2VuZXMgb2YgMSBpcyB1c2VkIGFzIG5vIHBlbmRpbmcgdXBkYXRlLgogICAgICAgIGlmICh0ZW1wU3VjY2Vzc1RyYWluaW5nTmV3SGVyb0dlbmVzICE9IDEpIHsKICAgICAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAgICAgaGVyb1Rva2VuQ29udHJhY3Quc2V0SGVyb0dlbmVzKHRlbXBTdWNjZXNzVHJhaW5pbmdIZXJvSWQsIHRlbXBTdWNjZXNzVHJhaW5pbmdOZXdIZXJvR2VuZXMpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVzZXQgdGhlIHZhcmlhYmxlcyB0byBpbmRpY2F0ZSBubyBwZW5kaW5nIHVwZGF0ZS4KICAgICAgICAgICAgdGVtcFN1Y2Nlc3NUcmFpbmluZ05ld0hlcm9HZW5lcyA9IDE7CiAgICAgICAgfQogICAgfQogICAgCiAgICAKICAgIC8qID09PT09PT09IE1PRElGSUVSUyA9PT09PT09PSAqLwogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIF9kdW5nZW9uSWQgaXMgbm90IGNyZWF0ZWQgeWV0LgogICAgICovCiAgICBtb2RpZmllciBkdW5nZW9uRXhpc3RzKHVpbnQgX2R1bmdlb25JZCkgewogICAgICAgIHJlcXVpcmUoX2R1bmdlb25JZCA8IGR1bmdlb25Ub2tlbkNvbnRyYWN0LnRvdGFsU3VwcGx5KCkpOwogICAgICAgIF87CiAgICB9CiAgICAKfQoKCmNvbnRyYWN0IEVEVHJhbnNwb3J0YXRpb24gaXMgRURCYXNlIHsKCiAgICAvKiA9PT09PT09PSBQVUJMSUMvRVhURVJOQUwgRlVOQ1RJT05TID09PT09PT09ICovCiAgICAKICAgIC8vLyBAZGV2IFJlY3J1aXQgYSBuZXcgbm92aWNlIGhlcm8gd2l0aCBubyBhdHRyaWJ1dGVzIChnZW5lID0gMCkuCiAgICBmdW5jdGlvbiByZWNydWl0SGVybygpIHdoZW5Ob3RQYXVzZWQgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gT25seSBhbGxvdyByZWNydWl0aW5nIGhlcm8gaW4gdGhlIG5vdmljZSBkdW5nZW9uLCBvciBmaXJzdCB0aW1lIHJlY3J1aXRpbmcgaGVyby4KICAgICAgICByZXF1aXJlKHBsYXllclRvRHVuZ2VvbklEW21zZy5zZW5kZXJdID09IG5vdmljZUR1bmdlb25JZCB8fCAhcGxheWVyVG9GaXJzdEhlcm9SZWNydWl0ZWRbbXNnLnNlbmRlcl0pOwogICAgICAgIAogICAgICAgIC8vIENoZWNrcyBmb3IgcGF5bWVudCwgYW55IGV4Y2VlZGluZyBmdW5kcyB3aWxsIGJlIHRyYW5zZmVycmVkIGJhY2sgdG8gdGhlIHBsYXllci4KICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSByZWNydWl0SGVyb0ZlZSk7CiAgICAgICAgCiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGFjY3VtdWxhdGVkIHJld2FyZHMgZm9yIHRoZSBkdW5nZW9uLCAKICAgICAgICAvLyBzaW5jZSBwbGF5ZXIgY2FuIG9ubHkgcmVjcnVpdCBoZXJvIGluIHRoZSBub3ZpY2UgZHVuZ2VvbiwgcmV3YXJkcyBpcyBhZGRlZCB0aGVyZS4KICAgICAgICBkdW5nZW9uVG9rZW5Db250cmFjdC5hZGREdW5nZW9uUmV3YXJkcyhub3ZpY2VEdW5nZW9uSWQsIHJlY3J1aXRIZXJvRmVlKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgYW5kIG1ha2UgaXQgYXZhaWxhYmxlIHRvIGJlIHdpdGhkcmF3ZWQgYnkgdGhlIHBsYXllci4KICAgICAgICBhc3luY1NlbmQobXNnLnNlbmRlciwgbXNnLnZhbHVlIC0gcmVjcnVpdEhlcm9GZWUpOwogICAgICAgIAogICAgICAgIC8vIElmIGl0IGlzIHRoZSBmaXJzdCB0aW1lIHJlY3J1aXRpbmcgYSBoZXJvLCBzZXQgdGhlIHBsYXllcidzIGxvY2F0aW9uIHRvIHRoZSBub3ZpY2UgZHVuZ2Vvbi4KICAgICAgICBpZiAoIXBsYXllclRvRmlyc3RIZXJvUmVjcnVpdGVkW21zZy5zZW5kZXJdKSB7CiAgICAgICAgICAgIC8vICoqIFNUT1JBR0UgVVBEQVRFICoqCiAgICAgICAgICAgIGR1bmdlb25JZFRvUGxheWVyQ291bnRbbm92aWNlRHVuZ2VvbklkXSsrOwogICAgICAgICAgICBwbGF5ZXJUb0R1bmdlb25JRFttc2cuc2VuZGVyXSA9IG5vdmljZUR1bmdlb25JZDsKICAgICAgICAgICAgcGxheWVyVG9GaXJzdEhlcm9SZWNydWl0ZWRbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gaGVyb1Rva2VuQ29udHJhY3QuY3JlYXRlSGVybygwLCBtc2cuc2VuZGVyKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBtYWluIGV4dGVybmFsIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiBhIHBsYXllciB0cmFuc3BvcnQgdG8gYW5vdGhlciBkdW5nZW9uLgogICAgICogIFdpbGwgZ2VuZXJhdGUgYSBQbGF5ZXJUcmFuc3BvcnRlZCBldmVudC4KICAgICAqICBQbGF5ZXIgbXVzdCBoYXZlIGF0IGxlYXN0IG9uZSBoZXJvIGluIG9yZGVyIHRvIHBlcmZvcm0KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNwb3J0KHVpbnQgX2Rlc3RpbmF0aW9uRHVuZ2VvbklkKSB3aGVuTm90UGF1c2VkIGR1bmdlb25DYW5UcmFuc3BvcnQoX2Rlc3RpbmF0aW9uRHVuZ2VvbklkKSBwbGF5ZXJBbGxvd2VkVG9UcmFuc3BvcnQoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICB1aW50IG9yaWdpbkR1bmdlb25JZCA9IHBsYXllclRvRHVuZ2VvbklEW21zZy5zZW5kZXJdOwogICAgICAgIAogICAgICAgIC8vIERpc2FsbG93IHRyYW5zcG9ydCB0byB0aGUgc2FtZSBkdW5nZW9uLgogICAgICAgIHJlcXVpcmUoX2Rlc3RpbmF0aW9uRHVuZ2VvbklkICE9IG9yaWdpbkR1bmdlb25JZCk7CiAgICAgICAgCiAgICAgICAgLy8gR2V0IHRoZSBkdW5nZW9uIGRldGFpbHMgZnJvbSB0aGUgdG9rZW4gY29udHJhY3QuCiAgICAgICAgdWludCBkaWZmaWN1bHR5OwogICAgICAgICgsLCBkaWZmaWN1bHR5LCwsLCwsKSA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0LmR1bmdlb25zKF9kZXN0aW5hdGlvbkR1bmdlb25JZCk7CiAgICAgICAgCiAgICAgICAgLy8gRGlzYWxsb3cgd2Vha2VyIHVzZXIgdG8gdHJhbnNwb3J0IHRvICJkaWZmaWN1bHQiIGR1bmdlb24uCiAgICAgICAgdWludCB0b3A1SGVyb2VzUG93ZXIgPSBjYWxjdWxhdGVUb3A1SGVyb2VzUG93ZXIobXNnLnNlbmRlciwgX2Rlc3RpbmF0aW9uRHVuZ2VvbklkKTsKICAgICAgICByZXF1aXJlKHRvcDVIZXJvZXNQb3dlciA+PSBkaWZmaWN1bHR5ICogMTIpOwogICAgICAgIAogICAgICAgIC8vIENoZWNrcyBmb3IgcGF5bWVudCwgYW55IGV4Y2VlZGluZyBmdW5kcyB3aWxsIGJlIHRyYW5zZmVycmVkIGJhY2sgdG8gdGhlIHBsYXllci4KICAgICAgICAvLyBUaGUgdHJhbnNwb3J0YXRpb24gZmVlIGlzIGNhbGN1bGF0ZWQgYnkgYSBiYXNlIGZlZSBmcm9tIHRyYW5zcG9ydGF0aW9uRmVlTXVsdGlwbGllciwKICAgICAgICAvLyBwbHVzIGFuIGFkZGl0aW9uYWwgZmVlIGluY3JlYXNlZCB3aXRoIHRoZSB0b3RhbCBwb3dlciBvZiB0b3AgNSBoZXJvZXMgb3duZWQuCiAgICAgICAgdWludCBiYXNlRmVlID0gZGlmZmljdWx0eSAqIHRyYW5zcG9ydGF0aW9uRmVlTXVsdGlwbGllcjsKICAgICAgICB1aW50IGFkZGl0aW9uYWxGZWUgPSB0b3A1SGVyb2VzUG93ZXIgLyA2NCAqIHRyYW5zcG9ydGF0aW9uRmVlTXVsdGlwbGllcjsKICAgICAgICB1aW50IHJlcXVpcmVkRmVlID0gYmFzZUZlZSArIGFkZGl0aW9uYWxGZWU7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcmVxdWlyZWRGZWUpOwogICAgICAgIAogICAgICAgIC8vICoqIFNUT1JBR0UgVVBEQVRFICoqCiAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBhY2N1bXVsYXRlZCByZXdhcmRzIGZvciB0aGUgZHVuZ2Vvbi4KICAgICAgICBkdW5nZW9uVG9rZW5Db250cmFjdC5hZGREdW5nZW9uUmV3YXJkcyhvcmlnaW5EdW5nZW9uSWQsIHJlcXVpcmVkRmVlKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgYW5kIG1ha2UgaXQgYXZhaWxhYmxlIHRvIGJlIHdpdGhkcmF3ZWQgYnkgdGhlIHBsYXllci4KICAgICAgICBhc3luY1NlbmQobXNnLnNlbmRlciwgbXNnLnZhbHVlIC0gcmVxdWlyZWRGZWUpOwoKICAgICAgICBfdHJhbnNwb3J0KG9yaWdpbkR1bmdlb25JZCwgX2Rlc3RpbmF0aW9uRHVuZ2VvbklkKTsKICAgIH0KICAgIAogICAgCiAgICAvKiA9PT09PT09PSBJTlRFUk5BTC9QUklWQVRFIEZVTkNUSU9OUyA9PT09PT09PSAqLwogICAgCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBhc3NpZ25zIGxvY2F0aW9uIG9mIGEgcGxheWVyLgogICAgZnVuY3Rpb24gX3RyYW5zcG9ydCh1aW50IF9vcmlnaW5EdW5nZW9uSWQsIHVpbnQgX2Rlc3RpbmF0aW9uRHVuZ2VvbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAvLyBVcGRhdGUgdGhlIGR1bmdlb25zJyBwbGF5ZXIgY291bnQuCiAgICAgICAgLy8gTm9ybWFsbHkgdGhlIHBsYXllciBjb3VudCBvZiBvcmlnaW5hbCBkdW5nZW9uIHdpbGwgYWxyZWFkeSBiZSA+IDAsCiAgICAgICAgLy8gcGVyZm9ybSBjaGVja2luZyB0byBhdm9pZCB1bmV4cGVjdGVkIG92ZXJmbG93CiAgICAgICAgaWYgKGR1bmdlb25JZFRvUGxheWVyQ291bnRbX29yaWdpbkR1bmdlb25JZF0gPiAwKSB7CiAgICAgICAgICAgIGR1bmdlb25JZFRvUGxheWVyQ291bnRbX29yaWdpbkR1bmdlb25JZF0tLTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZHVuZ2VvbklkVG9QbGF5ZXJDb3VudFtfZGVzdGluYXRpb25EdW5nZW9uSWRdKys7CiAgICAgICAgCiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAvLyBVcGRhdGUgcGxheWVyIGxvY2F0aW9uLgogICAgICAgIHBsYXllclRvRHVuZ2VvbklEW21zZy5zZW5kZXJdID0gX2Rlc3RpbmF0aW9uRHVuZ2VvbklkOwogICAgICAgICAgICAKICAgICAgICAvLyBFbWl0IHRoZSBEdW5nZW9uQ2hhbGxlbmdlZCBldmVudC4KICAgICAgICBQbGF5ZXJUcmFuc3BvcnRlZChub3csIG1zZy5zZW5kZXIsIF9vcmlnaW5EdW5nZW9uSWQsIF9kZXN0aW5hdGlvbkR1bmdlb25JZCk7CiAgICB9CiAgICAKICAgIAogICAgLyogPT09PT09PT0gTU9ESUZJRVJTID09PT09PT09ICovCiAgICAKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgZHVuZ2VvbiBzdGF0dXMgZG8gbm90IGFsbG93IHRyYW5zcG9ydGF0aW9uLCBhbHNvIGNoZWNrIGZvciBkdW5nZW9uIGV4aXN0ZW5jZS4KICAgICAqICBBbHNvIGNoZWNrIGlmIHRoZSBjYXBhY2l0eSBvZiB0aGUgZGVzdGluYXRpb24gZHVuZ2VvbiBpcyByZWFjaGVkLgogICAgICovCiAgICBtb2RpZmllciBkdW5nZW9uQ2FuVHJhbnNwb3J0KHVpbnQgX2Rlc3RpbmF0aW9uRHVuZ2VvbklkKSB7CiAgICAgICAgcmVxdWlyZShfZGVzdGluYXRpb25EdW5nZW9uSWQgPCBkdW5nZW9uVG9rZW5Db250cmFjdC50b3RhbFN1cHBseSgpKTsKICAgICAgICAKICAgICAgICB1aW50IHN0YXR1czsKICAgICAgICB1aW50IGNhcGFjaXR5OwogICAgICAgICgsIHN0YXR1cywsIGNhcGFjaXR5LCwsLCwpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2Rlc3RpbmF0aW9uRHVuZ2VvbklkKTsKICAgICAgICByZXF1aXJlKHN0YXR1cyA9PSAwIHx8IHN0YXR1cyA9PSAxKTsKICAgICAgICAKICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2FwYWNpdHkgb2YgdGhlIGRlc3RpbmF0aW9uIGR1bmdlb24gaXMgcmVhY2hlZC4KICAgICAgICAvLyBDYXBhY2l0eSAwID0gSW5maW5pdHkKICAgICAgICByZXF1aXJlKGNhcGFjaXR5ID09IDAgfHwgZHVuZ2VvbklkVG9QbGF5ZXJDb3VudFtfZGVzdGluYXRpb25EdW5nZW9uSWRdIDwgY2FwYWNpdHkpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFRocm93cyBpZiBwbGF5ZXIgZGlkIHJlY3J1aXQgZmlyc3QgaGVybyB5ZXQuCiAgICBtb2RpZmllciBwbGF5ZXJBbGxvd2VkVG9UcmFuc3BvcnQoKSB7CiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGNoZWNrIHBsYXllclRvRmlyc3RIZXJvUmVjcnVpdGVkIGluc3RlYWQgb2YgaGVyb1Rva2VuQ29udHJhY3QuYmFsYW5jZU9mCiAgICAgICAgLy8gaW4gb3JkZXIgdG8gcHJldmVudCAiY2FwYWNpdHkgYXR0YWNrIi4KICAgICAgICByZXF1aXJlKHBsYXllclRvRmlyc3RIZXJvUmVjcnVpdGVkW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQogICAgCn0KCgpjb250cmFjdCBFRENoYWxsZW5nZSBpcyBFRFRyYW5zcG9ydGF0aW9uIHsKICAgIAogICAgLyogPT09PT09PT0gUFVCTElDL0VYVEVSTkFMIEZVTkNUSU9OUyA9PT09PT09PSAqLwogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhlIG1haW4gZXh0ZXJuYWwgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIGEgcGxheWVyIGNoYWxsZW5nZSBhIGR1bmdlb24sCiAgICAgKiAgaXQgZGV0ZXJtaW5lcyB3aGV0aGVyIGlmIHRoZSBwbGF5ZXIgc3VjY2Vzc2Z1bGx5IGNoYWxsZW5nZWQgdGhlIGN1cnJlbnQgZmxvb3IuCiAgICAgKiAgV2lsbCBnZW5lcmF0ZSBhIER1bmdlb25DaGFsbGVuZ2VkIGV2ZW50LgogICAgICovCiAgICBmdW5jdGlvbiBjaGFsbGVuZ2UodWludCBfZHVuZ2VvbklkLCB1aW50IF9oZXJvSWQpIHdoZW5Ob3RQYXVzZWQgZHVuZ2VvbkNhbkNoYWxsZW5nZShfZHVuZ2VvbklkKSBoZXJvQWxsb3dlZFRvQ2hhbGxlbmdlKF9oZXJvSWQpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIC8vIFNldCB0aGUgbGFzdCBhY3Rpb24gYmxvY2sgbnVtYmVyLCBkaXNhbGxvdyBwbGF5ZXIgdG8gcGVyZm9ybSBhbm90aGVyIHRyYWluIG9yIGNoYWxsZW5nZSBpbiB0aGUgc2FtZSBibG9jay4KICAgICAgICBwbGF5ZXJUb0xhc3RBY3Rpb25CbG9ja051bWJlclttc2cuc2VuZGVyXSA9IGJsb2NrLm51bWJlcjsKICAgICAgICAKICAgICAgICAvLyBTZXQgdGhlIHByZXZpb3VzbHkgdGVtcCBzdG9yZWQgdXBncmFkZWQgaGVybyBnZW5lcy4KICAgICAgICBfc2V0VGVtcEhlcm9Qb3dlcigpOwogICAgICAgIAogICAgICAgIC8vIEdldCB0aGUgZHVuZ2VvbiBkZXRhaWxzIGZyb20gdGhlIHRva2VuIGNvbnRyYWN0LgogICAgICAgIHVpbnQgZGlmZmljdWx0eTsKICAgICAgICB1aW50IHNlZWRHZW5lczsKICAgICAgICAoLCwgZGlmZmljdWx0eSwsLCwsIHNlZWRHZW5lcywpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2R1bmdlb25JZCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2hlY2tzIGZvciBwYXltZW50LCBhbnkgZXhjZWVkaW5nIGZ1bmRzIHdpbGwgYmUgdHJhbnNmZXJyZWQgYmFjayB0byB0aGUgcGxheWVyLgogICAgICAgIHVpbnQgcmVxdWlyZWRGZWUgPSBkaWZmaWN1bHR5ICogY2hhbGxlbmdlRmVlTXVsdGlwbGllcjsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSByZXF1aXJlZEZlZSk7CiAgICAgICAgCiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGFjY3VtdWxhdGVkIHJld2FyZHMgZm9yIHRoZSBkdW5nZW9uLgogICAgICAgIGR1bmdlb25Ub2tlbkNvbnRyYWN0LmFkZER1bmdlb25SZXdhcmRzKF9kdW5nZW9uSWQsIHJlcXVpcmVkRmVlKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgYW5kIG1ha2UgaXQgYXZhaWxhYmxlIHRvIGJlIHdpdGhkcmF3ZWQgYnkgdGhlIHBsYXllci4KICAgICAgICBhc3luY1NlbmQobXNnLnNlbmRlciwgbXNnLnZhbHVlIC0gcmVxdWlyZWRGZWUpOwogICAgICAgIAogICAgICAgIC8vIFNwbGl0IHRoZSBjaGFsbGVuZ2UgZnVuY3Rpb24gaW50byBtdWx0aXBsZSBwYXJ0cyBiZWNhdXNlIG9mIHN0YWNrIHRvbyBkZWVwIGVycm9yLgogICAgICAgIF9jaGFsbGVuZ2VQYXJ0MihfZHVuZ2VvbklkLCBkaWZmaWN1bHR5LCBfaGVyb0lkKTsKICAgIH0KICAgIAogICAgCiAgICAvKiA9PT09PT09PSBJTlRFUk5BTC9QUklWQVRFIEZVTkNUSU9OUyA9PT09PT09PSAqLwogICAgCiAgICAvLy8gQGRldiBDb21wdXRlIHRoZSByZW1haW5pbmcgdGltZSBmb3Igd2hpY2ggdGhlIGhlcm8gY2FuIHBlcmZvcm0gYSBjaGFsbGVuZ2UgYWdhaW4uCiAgICBmdW5jdGlvbiBfY29tcHV0ZUNvb2xkb3duUmVtYWluaW5nVGltZSh1aW50IF9oZXJvSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgY29vbGRvd25TdGFydFRpbWU7CiAgICAgICAgdWludCBjb29sZG93bkluZGV4OwogICAgICAgICgsIGNvb2xkb3duU3RhcnRUaW1lLCBjb29sZG93bkluZGV4LCkgPSBoZXJvVG9rZW5Db250cmFjdC5oZXJvZXMoX2hlcm9JZCk7CiAgICAgICAgCiAgICAgICAgLy8gQ29vbGRvd24gcGVyaW9kIGlzIEZMT09SKGNoYWxsZW5nZSBjb3VudCAvIDIpIF4gMiBtaW51dGVzCiAgICAgICAgdWludCBjb29sZG93blBlcmlvZCA9IChjb29sZG93bkluZGV4IC8gMikgKiogMiAqIDEgbWludXRlczsKICAgICAgICAKICAgICAgICBpZiAoY29vbGRvd25QZXJpb2QgPiAxMDAgbWludXRlcykgewogICAgICAgICAgICBjb29sZG93blBlcmlvZCA9IDEwMCBtaW51dGVzOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1aW50IGNvb2xkb3duRW5kVGltZSA9IGNvb2xkb3duU3RhcnRUaW1lICsgY29vbGRvd25QZXJpb2Q7CiAgICAgICAgCiAgICAgICAgaWYgKGNvb2xkb3duRW5kVGltZSA8PSBub3cpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGNvb2xkb3duRW5kVGltZSAtIG5vdzsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFNwbGl0IHRoZSBjaGFsbGVuZ2UgZnVuY3Rpb24gaW50byBtdWx0aXBsZSBwYXJ0cyBiZWNhdXNlIG9mIHN0YWNrIHRvbyBkZWVwIGVycm9yLgogICAgZnVuY3Rpb24gX2NoYWxsZW5nZVBhcnQyKHVpbnQgX2R1bmdlb25JZCwgdWludCBfZHVuZ2VvbkRpZmZpY3VsdHksIHVpbnQgX2hlcm9JZCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCBmbG9vck51bWJlcjsKICAgICAgICB1aW50IHJld2FyZHM7CiAgICAgICAgdWludCBmbG9vckdlbmVzOwogICAgICAgICgsLCwsIGZsb29yTnVtYmVyLCwgcmV3YXJkcywsIGZsb29yR2VuZXMpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2R1bmdlb25JZCk7CiAgICAgICAgCiAgICAgICAgLy8gR2V0IHRoZSBoZXJvIGdlbmUuCiAgICAgICAgdWludCBoZXJvR2VuZXM7CiAgICAgICAgKCwsLCBoZXJvR2VuZXMpID0gaGVyb1Rva2VuQ29udHJhY3QuaGVyb2VzKF9oZXJvSWQpOwogICAgICAgIAogICAgICAgIGJvb2wgc3VjY2VzcyA9IF9nZXRDaGFsbGVuZ2VTdWNjZXNzKGhlcm9HZW5lcywgX2R1bmdlb25EaWZmaWN1bHR5LCBmbG9vckdlbmVzKTsKICAgICAgICAKICAgICAgICB1aW50IG5ld0Zsb29yR2VuZXM7CiAgICAgICAgdWludCBtYXN0ZXJSZXdhcmRzOwogICAgICAgIHVpbnQgY29uc29sYXRpb25SZXdhcmRzOwogICAgICAgIHVpbnQgc3VjY2Vzc1Jld2FyZHM7CiAgICAgICAgdWludCBuZXdSZXdhcmRzOwogICAgICAgIAogICAgICAgIC8vIFdoZXRoZXIgYSBjaGFsbGVuZ2UgaXMgc3VjY2VzcyBvciBub3QgaXMgZGV0ZXJtaW5lZCBieSBhIHNpbXBsZSBjb21wYXJpc29uIGJldHdlZW4gaGVybyBwb3dlciBhbmQgZmxvb3IgcG93ZXIuCiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgbmV3Rmxvb3JHZW5lcyA9IF9nZXROZXdGbG9vckdlbmUoX2R1bmdlb25JZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBtYXN0ZXJSZXdhcmRzID0gcmV3YXJkcyAqIG1hc3RlclJld2FyZHNQZXJjZW50IC8gMTAwOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sYXRpb25SZXdhcmRzID0gcmV3YXJkcyAqIGNvbnNvbGF0aW9uUmV3YXJkc1BlcmNlbnQgLyAxMDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoZmxvb3JOdW1iZXIgPCBydXNoVGltZUZsb29yQ291bnQpIHsgLy8gcnVzaCB0aW1lIHJpZ2h0IGFmdGVyIHByZXByYXRpb24gcGVyaW9kCiAgICAgICAgICAgICAgICBzdWNjZXNzUmV3YXJkcyA9IHJld2FyZHMgKiBydXNoVGltZUNoYWxsZW5nZVJld2FyZHNQZXJjZW50IC8gMTAwOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUaGUgZHVuZ2VvbiByZXdhcmRzIGZvciBuZXcgZmxvb3IgYXMgdG90YWwgcmV3YXJkcyAtIGNoYWxsZW5nZSByZXdhcmRzIC0gZGV2bGVvcGVyIGZlZS4KICAgICAgICAgICAgICAgIG5ld1Jld2FyZHMgPSByZXdhcmRzICogKDEwMCAtIHJ1c2hUaW1lQ2hhbGxlbmdlUmV3YXJkc1BlcmNlbnQgLSBtYXN0ZXJSZXdhcmRzUGVyY2VudCAtIGNvbnNvbGF0aW9uUmV3YXJkc1BlcmNlbnQpIC8gMTAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3VjY2Vzc1Jld2FyZHMgPSByZXdhcmRzICogY2hhbGxlbmdlUmV3YXJkc1BlcmNlbnQgLyAxMDA7CiAgICAgICAgICAgICAgICBuZXdSZXdhcmRzID0gcmV3YXJkcyAqICgxMDAgLSBjaGFsbGVuZ2VSZXdhcmRzUGVyY2VudCAtIG1hc3RlclJld2FyZHNQZXJjZW50IC0gY29uc29sYXRpb25SZXdhcmRzUGVyY2VudCkgLyAxMDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRSSVBMRSBDT05GSVJNIHNhbml0eSBjaGVjay4KICAgICAgICAgICAgcmVxdWlyZShzdWNjZXNzUmV3YXJkcyArIG1hc3RlclJld2FyZHMgKyBjb25zb2xhdGlvblJld2FyZHMgKyBuZXdSZXdhcmRzIDw9IHJld2FyZHMpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAgICAgLy8gQWRkIHRoZSBjb25zb2xhdGlvbiByZXdhcmRzIHRvIGdyYW5kQ29uc29sYXRpb25SZXdhcmRzLgogICAgICAgICAgICBncmFuZENvbnNvbGF0aW9uUmV3YXJkcyArPSBjb25zb2xhdGlvblJld2FyZHM7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBZGQgbmV3IGZsb29yIHdpdGggdGhlIG5ldyBmbG9vciBnZW5lcyBhbmQgbmV3IHJld2FyZHMuCiAgICAgICAgICAgIGR1bmdlb25Ub2tlbkNvbnRyYWN0LmFkZER1bmdlb25OZXdGbG9vcihfZHVuZ2VvbklkLCBuZXdSZXdhcmRzLCBuZXdGbG9vckdlbmVzKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE1hcmsgdGhlIGNoYWxsZW5nZSByZXdhcmRzIGF2YWlsYWJsZSB0byBiZSB3aXRoZHJhd2VkIGJ5IHRoZSBwbGF5ZXIuCiAgICAgICAgICAgIGFzeW5jU2VuZChtc2cuc2VuZGVyLCBzdWNjZXNzUmV3YXJkcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNYXJrIHRoZSBtYXN0ZXIgcmV3YXJkcyBhdmFpbGFibGUgdG8gYmUgd2l0aGRyYXdlZCBieSB0aGUgZHVuZ2VvbiBtYXN0ZXIuCiAgICAgICAgICAgIGFzeW5jU2VuZChkdW5nZW9uVG9rZW5Db250cmFjdC5vd25lck9mKF9kdW5nZW9uSWQpLCBtYXN0ZXJSZXdhcmRzKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAvLyBUcmlnZ2VyIHRoZSBjb29sZG93biBmb3IgdGhlIGhlcm8uCiAgICAgICAgaGVyb1Rva2VuQ29udHJhY3QudHJpZ2dlckNvb2xkb3duKF9oZXJvSWQpOwogICAgICAgICAgICAKICAgICAgICAvLyBFbWl0IHRoZSBEdW5nZW9uQ2hhbGxlbmdlZCBldmVudC4KICAgICAgICBEdW5nZW9uQ2hhbGxlbmdlZChub3csIG1zZy5zZW5kZXIsIF9kdW5nZW9uSWQsIF9oZXJvSWQsIGhlcm9HZW5lcywgZmxvb3JOdW1iZXIsIGZsb29yR2VuZXMsIHN1Y2Nlc3MsIG5ld0Zsb29yR2VuZXMsIHN1Y2Nlc3NSZXdhcmRzLCBtYXN0ZXJSZXdhcmRzKTsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgU3BsaXQgdGhlIGNoYWxsZW5nZSBmdW5jdGlvbiBpbnRvIG11bHRpcGxlIHBhcnRzIGJlY2F1c2Ugb2Ygc3RhY2sgdG9vIGRlZXAgZXJyb3IuCiAgICBmdW5jdGlvbiBfZ2V0Q2hhbGxlbmdlU3VjY2Vzcyh1aW50IF9oZXJvR2VuZXMsIHVpbnQgX2R1bmdlb25EaWZmaWN1bHR5LCB1aW50IF9mbG9vckdlbmVzKSBwcml2YXRlIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIERldGVybWluZSBpZiB0aGUgcGxheWVyIGNoYWxsZW5nZSBzdWNjZXNzZnVseSB0aGUgZHVuZ2VvbiBvciBub3QuCiAgICAgICAgdWludCBoZXJvUG93ZXI7CiAgICAgICAgKGhlcm9Qb3dlciwsLCwsKSA9IGdldEhlcm9Qb3dlcihfaGVyb0dlbmVzLCBfZHVuZ2VvbkRpZmZpY3VsdHkpOwogICAgICAgIAogICAgICAgIHVpbnQgZmxvb3JQb3dlciA9IGdldER1bmdlb25Qb3dlcihfZmxvb3JHZW5lcyk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIGhlcm9Qb3dlciA+IGZsb29yUG93ZXI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFNwbGl0IHRoZSBjaGFsbGVuZ2UgZnVuY3Rpb24gaW50byBtdWx0aXBsZSBwYXJ0cyBiZWNhdXNlIG9mIHN0YWNrIHRvbyBkZWVwIGVycm9yLgogICAgZnVuY3Rpb24gX2dldE5ld0Zsb29yR2VuZSh1aW50IF9kdW5nZW9uSWQpIHByaXZhdGUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgc2VlZEdlbmVzOwogICAgICAgIHVpbnQgZmxvb3JHZW5lczsKICAgICAgICAoLCwsLCwsIHNlZWRHZW5lcywgZmxvb3JHZW5lcykgPSBkdW5nZW9uVG9rZW5Db250cmFjdC5kdW5nZW9ucyhfZHVuZ2VvbklkKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIG5ldyBmbG9vciBnZW5lLgogICAgICAgIHVpbnQgZmxvb3JQb3dlciA9IGdldER1bmdlb25Qb3dlcihmbG9vckdlbmVzKTsKICAgICAgICAKICAgICAgICAvLyBDYWxsIHRoZSBleHRlcm5hbCBjbG9zZWQgc291cmNlIHNlY3JldCBmdW5jdGlvbiB0aGF0IGRldGVybWluZXMgdGhlIHJlc3VsdGluZyBmbG9vciAiZ2VuZXMiLgogICAgICAgIHVpbnQgbmV3Rmxvb3JHZW5lcyA9IGNoYWxsZW5nZUZvcm11bGFDb250cmFjdC5jYWxjdWxhdGVSZXN1bHQoZmxvb3JHZW5lcywgc2VlZEdlbmVzKTsKICAgICAgICB1aW50IG5ld0Zsb29yUG93ZXIgPSBnZXREdW5nZW9uUG93ZXIobmV3Rmxvb3JHZW5lcyk7CiAgICAgICAgCiAgICAgICAgLy8gSWYgdGhlIHBvd2VyIGRlY3JlYXNlZCwgcm9sbGJhY2sgdG8gdGhlIGN1cnJlbnQgZmxvb3IgZ2VuZXMuCiAgICAgICAgaWYgKG5ld0Zsb29yUG93ZXIgPCBmbG9vclBvd2VyKSB7CiAgICAgICAgICAgIG5ld0Zsb29yR2VuZXMgPSBmbG9vckdlbmVzOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gbmV3Rmxvb3JHZW5lczsKICAgIH0KICAgIAogICAgCiAgICAvKiA9PT09PT09PSBNT0RJRklFUlMgPT09PT09PT0gKi8KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBkdW5nZW9uIHN0YXR1cyBkbyBub3QgYWxsb3cgY2hhbGxlbmdlLCBhbHNvIGNoZWNrIGZvciBkdW5nZW9uIGV4aXN0ZW5jZS4KICAgICAqICBBbHNvIGNoZWNrIGlmIHRoZSB1c2VyIGlzIGluIHRoZSBkdW5nZW9uLgogICAgICogIEFsc28gY2hlY2sgaWYgdGhlIGR1bmdlb24gaXMgbm90IGluIHByZXBhcmF0aW9uIHBlcmlvZC4KICAgICAqLwogICAgbW9kaWZpZXIgZHVuZ2VvbkNhbkNoYWxsZW5nZSh1aW50IF9kdW5nZW9uSWQpIHsKICAgICAgICByZXF1aXJlKF9kdW5nZW9uSWQgPCBkdW5nZW9uVG9rZW5Db250cmFjdC50b3RhbFN1cHBseSgpKTsKICAgICAgICAKICAgICAgICB1aW50IGNyZWF0aW9uVGltZTsKICAgICAgICB1aW50IHN0YXR1czsKICAgICAgICAoY3JlYXRpb25UaW1lLCBzdGF0dXMsLCwsLCwsKSA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0LmR1bmdlb25zKF9kdW5nZW9uSWQpOwogICAgICAgIHJlcXVpcmUoc3RhdHVzID09IDAgfHwgc3RhdHVzID09IDIpOwogICAgICAgIAogICAgICAgIC8vIENoZWNrIGlmIHRoZSB1c2VyIGlzIGluIHRoZSBkdW5nZW9uLgogICAgICAgIHJlcXVpcmUocGxheWVyVG9EdW5nZW9uSURbbXNnLnNlbmRlcl0gPT0gX2R1bmdlb25JZCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGR1bmdlb24gaXMgbm90IGluIHByZXBhcmF0aW9uIHBlcmlvZC4KICAgICAgICByZXF1aXJlKGNyZWF0aW9uVGltZSArIGR1bmdlb25QcmVwYXJhdGlvblRpbWUgPD0gbm93KTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIHBsYXllciBkb2VzIG5vdCBvd24gdGhlIGhlcm8sIG9yIHRoZSBoZXJvIGlzIHN0aWxsIGluIGNvb2xkb3duIHBlcmlvZCwKICAgICAqICBhbmQgbm8gcGVuZGluZyBwb3dlciB1cGRhdGUuCiAgICAgKi8KICAgIG1vZGlmaWVyIGhlcm9BbGxvd2VkVG9DaGFsbGVuZ2UodWludCBfaGVyb0lkKSB7CiAgICAgICAgLy8gWW91IGNhbiBvbmx5IGNoYWxsZW5nZSB3aXRoIHlvdXIgb3duIGhlcm8uCiAgICAgICAgcmVxdWlyZShoZXJvVG9rZW5Db250cmFjdC5vd25lck9mKF9oZXJvSWQpID09IG1zZy5zZW5kZXIpOwogICAgICAgIAogICAgICAgIC8vIEhlcm8gbXVzdCBub3QgYmUgaW4gY29vbGRvd24gcGVyaW9kCiAgICAgICAgdWludCBjb29sZG93blJlbWFpbmluZ1RpbWUgPSBfY29tcHV0ZUNvb2xkb3duUmVtYWluaW5nVGltZShfaGVyb0lkKTsKICAgICAgICByZXF1aXJlKGNvb2xkb3duUmVtYWluaW5nVGltZSA9PSAwKTsKICAgICAgICAKICAgICAgICAvLyBQcmV2ZW50IHBsYXllciB0byBwZXJmb3JtIHRyYWluaW5nIGFuZCBjaGFsbGVuZ2UgaW4gdGhlIHNhbWUgYmxvY2sgdG8gYXZvaWQgYm90IGV4cGxvaXQuCiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPiBwbGF5ZXJUb0xhc3RBY3Rpb25CbG9ja051bWJlclttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KICAgIAp9CgoKY29udHJhY3QgRURUcmFpbmluZyBpcyBFRENoYWxsZW5nZSB7CiAgICAKICAgIC8qID09PT09PT09IFBVQkxJQy9FWFRFUk5BTCBGVU5DVElPTlMgPT09PT09PT0gKi8KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBleHRlcm5hbCBmdW5jdGlvbiB0byBjYWxsIHdoZW4gYSBoZXJvIHRyYWluIHdpdGggYSBkdW5nZW9uLAogICAgICogIGl0IGRldGVybWluZXMgd2hldGhlciB3aGV0aGVyIGEgdHJhaW5pbmcgaXMgc3VjY2Vzc2Z1bGx5LCBhbmQgdGhlIHJlc3VsdGluZyBnZW5lcy4KICAgICAqICBXaWxsIGdlbmVyYXRlIGEgRHVuZ2VvbkNoYWxsZW5nZWQgZXZlbnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYWluMSh1aW50IF9kdW5nZW9uSWQsIHVpbnQgX2hlcm9JZCkgd2hlbk5vdFBhdXNlZCBkdW5nZW9uQ2FuVHJhaW4oX2R1bmdlb25JZCkgaGVyb0FsbG93ZWRUb1RyYWluKF9oZXJvSWQpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIF90cmFpbihfZHVuZ2VvbklkLCBfaGVyb0lkLCAwLCAxKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhaW4yKHVpbnQgX2R1bmdlb25JZCwgdWludCBfaGVyb0lkKSB3aGVuTm90UGF1c2VkIGR1bmdlb25DYW5UcmFpbihfZHVuZ2VvbklkKSBoZXJvQWxsb3dlZFRvVHJhaW4oX2hlcm9JZCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgX3RyYWluKF9kdW5nZW9uSWQsIF9oZXJvSWQsIDAsIDIpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0cmFpbjModWludCBfZHVuZ2VvbklkLCB1aW50IF9oZXJvSWQpIHdoZW5Ob3RQYXVzZWQgZHVuZ2VvbkNhblRyYWluKF9kdW5nZW9uSWQpIGhlcm9BbGxvd2VkVG9UcmFpbihfaGVyb0lkKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBfdHJhaW4oX2R1bmdlb25JZCwgX2hlcm9JZCwgMCwgMyk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIGEgaGVybyB0cmFpbiBhIHBhcnRpY3VsYXIgZXF1aXBtZW50IHdpdGggYSBkdW5nZW9uLAogICAgICogIGl0IGRldGVybWluZXMgd2hldGhlciB3aGV0aGVyIGEgdHJhaW5pbmcgaXMgc3VjY2Vzc2Z1bGx5LCBhbmQgdGhlIHJlc3VsdGluZyBnZW5lcy4KICAgICAqICBXaWxsIGdlbmVyYXRlIGEgRHVuZ2VvbkNoYWxsZW5nZWQgZXZlbnQuCiAgICAgKiAgX2VxdWlwbWVudEluZGV4IGlzIHRoZSBpbmRleCBvZiBlcXVpcG1lbnQ6IDAgaXMgdHJhaW4gYWxsIGF0dHJpYnV0ZXMsIGluY2x1ZGluZyBlcXVpcG1lbnRzIGFuZCBzdGF0cy4KICAgICAqICAxOiB3ZWFwb24gfCAyOiBzaGllbGQgfCAzOiBhcm1vciB8IDQ6IHNob2UgfCA1OiBoZWxtZXQgfCA2OiBnbG92ZXMgfCA3OiBiZWx0IHwgODogc2hhd2wKICAgICAqLwogICAgZnVuY3Rpb24gdHJhaW5FcXVpcG1lbnQodWludCBfZHVuZ2VvbklkLCB1aW50IF9oZXJvSWQsIHVpbnQgX2VxdWlwbWVudEluZGV4KSB3aGVuTm90UGF1c2VkIGR1bmdlb25DYW5UcmFpbihfZHVuZ2VvbklkKSBoZXJvQWxsb3dlZFRvVHJhaW4oX2hlcm9JZCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgcmVxdWlyZShfZXF1aXBtZW50SW5kZXggPD0gOCk7CiAgICAgICAgCiAgICAgICAgX3RyYWluKF9kdW5nZW9uSWQsIF9oZXJvSWQsIF9lcXVpcG1lbnRJbmRleCwgMSk7CiAgICB9CiAgICAKICAgIAogICAgLyogPT09PT09PT0gSU5URVJOQUwvUFJJVkFURSBGVU5DVElPTlMgPT09PT09PT0gKi8KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEFuIGludGVybmFsIGZ1bmN0aW9uIG9mIGEgaGVybyB0cmFpbiB3aXRoIGR1bmdlb24sCiAgICAgKiAgaXQgZGV0ZXJtaW5lcyB3aGV0aGVyIHdoZXRoZXIgYSB0cmFpbmluZyBpcyBzdWNjZXNzZnVsbHksIGFuZCB0aGUgcmVzdWx0aW5nIGdlbmVzLgogICAgICogIFdpbGwgZ2VuZXJhdGUgYSBEdW5nZW9uQ2hhbGxlbmdlZCBldmVudC4KICAgICAqLwogICAgZnVuY3Rpb24gX3RyYWluKHVpbnQgX2R1bmdlb25JZCwgdWludCBfaGVyb0lkLCB1aW50IF9lcXVpcG1lbnRJbmRleCwgdWludCBfdHJhaW5pbmdUaW1lcykgcHJpdmF0ZSB7CiAgICAgICAgLy8gU2V0IHRoZSBsYXN0IGFjdGlvbiBibG9jayBudW1iZXIsIGRpc2FsbG93IHBsYXllciB0byBwZXJmb3JtIGFub3RoZXIgdHJhaW4gb3IgY2hhbGxlbmdlIGluIHRoZSBzYW1lIGJsb2NrLgogICAgICAgIHBsYXllclRvTGFzdEFjdGlvbkJsb2NrTnVtYmVyW21zZy5zZW5kZXJdID0gYmxvY2subnVtYmVyOwogICAgICAgIAogICAgICAgIC8vIFNldCB0aGUgcHJldmlvdXNseSB0ZW1wIHN0b3JlZCB1cGdyYWRlZCBoZXJvIGdlbmVzLgogICAgICAgIF9zZXRUZW1wSGVyb1Bvd2VyKCk7CiAgICAgICAgCiAgICAgICAgLy8gR2V0IHRoZSBkdW5nZW9uIGRldGFpbHMgZnJvbSB0aGUgdG9rZW4gY29udHJhY3QuCiAgICAgICAgdWludCBjcmVhdGlvblRpbWU7CiAgICAgICAgdWludCBkaWZmaWN1bHR5OwogICAgICAgIHVpbnQgZmxvb3JOdW1iZXI7CiAgICAgICAgdWludCByZXdhcmRzOwogICAgICAgIHVpbnQgc2VlZEdlbmVzOwogICAgICAgIHVpbnQgZmxvb3JHZW5lczsKICAgICAgICAoY3JlYXRpb25UaW1lLCwgZGlmZmljdWx0eSwsIGZsb29yTnVtYmVyLCwgcmV3YXJkcywgc2VlZEdlbmVzLCBmbG9vckdlbmVzKSA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0LmR1bmdlb25zKF9kdW5nZW9uSWQpOwogICAgICAgIAogICAgICAgIC8vIENoZWNrIGZvciBfdHJhaW5pbmdUaW1lcyBhYm5vcm1hbGl0eSwgd2UgcHJvYmFibHkgd29uJ3QgaGF2ZSBhbnkgZmVhdHVyZSB0aGF0IHRyYWluIGEgaGVybyAxMCB0aW1lcyB3aXRoIGEgc2luZ2xlIGNhbGwuCiAgICAgICAgcmVxdWlyZShfdHJhaW5pbmdUaW1lcyA8IDEwKTsKICAgICAgICAKICAgICAgICAvLyBDaGVja3MgZm9yIHBheW1lbnQsIGFueSBleGNlZWRpbmcgZnVuZHMgd2lsbCBiZSB0cmFuc2ZlcnJlZCBiYWNrIHRvIHRoZSBwbGF5ZXIuCiAgICAgICAgdWludCByZXF1aXJlZEZlZTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHJlcXVpcmVkIHRyYWluaW5nIGZlZS4KICAgICAgICBpZiAobm93IDwgY3JlYXRpb25UaW1lICsgZHVuZ2VvblByZXBhcmF0aW9uVGltZSkgewogICAgICAgICAgICAvLyBBcHBseSBwcmVwYXJhdGlvbiBwZXJpb2QgZGlzY291bnQuIAogICAgICAgICAgICBpZiAoX2VxdWlwbWVudEluZGV4ID4gMCkgeyAvLyB0cmFpbiBzcGVjaWZpYyBlcXVpcG1lbnRzCiAgICAgICAgICAgICAgICByZXF1aXJlZEZlZSA9IGRpZmZpY3VsdHkgKiBwcmVwYXJhdGlvblBlcmlvZEVxdWlwbWVudFRyYWluaW5nRmVlTXVsdGlwbGllciAqIF90cmFpbmluZ1RpbWVzOwogICAgICAgICAgICB9IGVsc2UgeyAvLyB0cmFpbiBhbGwgYXR0cmlidXRlcwogICAgICAgICAgICAgICAgcmVxdWlyZWRGZWUgPSBkaWZmaWN1bHR5ICogcHJlcGFyYXRpb25QZXJpb2RUcmFpbmluZ0ZlZU11bHRpcGxpZXIgKiBfdHJhaW5pbmdUaW1lczsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChfZXF1aXBtZW50SW5kZXggPiAwKSB7IC8vIHRyYWluIHNwZWNpZmljIGVxdWlwbWVudHMKICAgICAgICAgICAgICAgIHJlcXVpcmVkRmVlID0gZGlmZmljdWx0eSAqIGVxdWlwbWVudFRyYWluaW5nRmVlTXVsdGlwbGllciAqIF90cmFpbmluZ1RpbWVzOwogICAgICAgICAgICB9IGVsc2UgeyAvLyB0cmFpbiBhbGwgYXR0cmlidXRlcwogICAgICAgICAgICAgICAgcmVxdWlyZWRGZWUgPSBkaWZmaWN1bHR5ICogdHJhaW5pbmdGZWVNdWx0aXBsaWVyICogX3RyYWluaW5nVGltZXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcmVxdWlyZWRGZWUpOwogICAgICAgIAogICAgICAgIC8vIEdldCB0aGUgaGVybyBnZW5lLgogICAgICAgIHVpbnQgaGVyb0dlbmVzOwogICAgICAgICgsLCwgaGVyb0dlbmVzKSA9IGhlcm9Ub2tlbkNvbnRyYWN0Lmhlcm9lcyhfaGVyb0lkKTsKICAgICAgICAKICAgICAgICAvLyAqKiBTVE9SQUdFIFVQREFURSAqKgogICAgICAgIC8vIEluY3JlbWVudCB0aGUgYWNjdW11bGF0ZWQgcmV3YXJkcyBmb3IgdGhlIGR1bmdlb24uCiAgICAgICAgZHVuZ2VvblRva2VuQ29udHJhY3QuYWRkRHVuZ2VvblJld2FyZHMoX2R1bmdlb25JZCwgcmVxdWlyZWRGZWUpOwoKICAgICAgICAvLyBDYWxjdWxhdGUgYW55IGV4Y2VzcyBmdW5kcyBhbmQgbWFrZSBpdCBhdmFpbGFibGUgdG8gYmUgd2l0aGRyYXdlZCBieSB0aGUgcGxheWVyLgogICAgICAgIGFzeW5jU2VuZChtc2cuc2VuZGVyLCBtc2cudmFsdWUgLSByZXF1aXJlZEZlZSk7CiAgICAgICAgCiAgICAgICAgLy8gU3BsaXQgdGhlIF90cmFpbiBmdW5jdGlvbiBpbnRvIG11bHRpcGxlIHBhcnRzIGJlY2F1c2Ugb2Ygc3RhY2sgdG9vIGRlZXAgZXJyb3IuCiAgICAgICAgX3RyYWluUGFydDIoX2R1bmdlb25JZCwgX2hlcm9JZCwgX2VxdWlwbWVudEluZGV4LCBfdHJhaW5pbmdUaW1lcywgZGlmZmljdWx0eSwgZmxvb3JOdW1iZXIsIGZsb29yR2VuZXMsIGhlcm9HZW5lcyk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFNwbGl0IHRoZSBfdHJhaW4gZnVuY3Rpb24gaW50byBtdWx0aXBsZSBwYXJ0cyBiZWNhdXNlIG9mIFN0YWNrIFRvbyBEZWVwIGVycm9yLgogICAgZnVuY3Rpb24gX3RyYWluUGFydDIoCiAgICAgICAgdWludCBfZHVuZ2VvbklkLAogICAgICAgIHVpbnQgX2hlcm9JZCwKICAgICAgICB1aW50IF9lcXVpcG1lbnRJbmRleCwKICAgICAgICB1aW50IF90cmFpbmluZ1RpbWVzLAogICAgICAgIHVpbnQgX2R1bmdlb25EaWZmaWN1bHR5LAogICAgICAgIHVpbnQgX2Zsb29yTnVtYmVyLAogICAgICAgIHVpbnQgX2Zsb29yR2VuZXMsCiAgICAgICAgdWludCBfaGVyb0dlbmVzCiAgICApIHByaXZhdGUgewogICAgICAgIC8vIERldGVybWluZSBpZiB0aGUgaGVybyB0cmFpbmluZyBpcyBzdWNjZXNzZnVsIG9yIG5vdCwgYW5kIHRoZSByZXN1bHRpbmcgZ2VuZXMuCiAgICAgICAgdWludCBoZXJvUG93ZXI7CiAgICAgICAgYm9vbCBpc1N1cGVyOwogICAgICAgIChoZXJvUG93ZXIsLCwgaXNTdXBlciwsKSA9IGdldEhlcm9Qb3dlcihfaGVyb0dlbmVzLCBfZHVuZ2VvbkRpZmZpY3VsdHkpOwogICAgICAgIAogICAgICAgIHVpbnQgbmV3SGVyb0dlbmVzOwogICAgICAgIHVpbnQgbmV3SGVyb1Bvd2VyOwogICAgICAgIChuZXdIZXJvR2VuZXMsIG5ld0hlcm9Qb3dlcikgPSBfY2FsY3VsYXRlTmV3SGVyb1Bvd2VyKF9kdW5nZW9uRGlmZmljdWx0eSwgX2hlcm9HZW5lcywgX2VxdWlwbWVudEluZGV4LCBfdHJhaW5pbmdUaW1lcywgaGVyb1Bvd2VyLCBpc1N1cGVyLCBfZmxvb3JHZW5lcyk7CgogICAgICAgIC8vIFNldCB0aGUgbmV3IGhlcm8gZ2VuZXMgaWYgdXBkYXRlZCAoc29tZXRpbWVzIHRoZXJlIGlzIG5vIHBvd2VyIGluY3JlYXNlIGR1cmluZyBlcXVpcG1lbnQgZm9yZ2luZykuCiAgICAgICAgaWYgKG5ld0hlcm9HZW5lcyAhPSBfaGVyb0dlbmVzKSB7CiAgICAgICAgICAgIGlmIChuZXdIZXJvUG93ZXIgPj0gMjU2KSB7CiAgICAgICAgICAgICAgICAvLyBEbyBub3QgdXBkYXRlIGltbWVkaWF0ZWx5IHRvIHByZXZlbnQgZGV0ZXJtaW5pc3RpYyB0cmFpbmluZyBleHBsb2l0LgogICAgICAgICAgICAgICAgdGVtcFN1Y2Nlc3NUcmFpbmluZ0hlcm9JZCA9IF9oZXJvSWQ7CiAgICAgICAgICAgICAgICB0ZW1wU3VjY2Vzc1RyYWluaW5nTmV3SGVyb0dlbmVzID0gbmV3SGVyb0dlbmVzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSW1tZWRpYXRlbHkgdXBkYXRlIHRoZSBnZW5lcyBmb3Igc21hbGwgcG93ZXIgaGVyby4KICAgICAgICAgICAgICAgIC8vICoqIFNUT1JBR0UgVVBEQVRFICoqCiAgICAgICAgICAgICAgICBoZXJvVG9rZW5Db250cmFjdC5zZXRIZXJvR2VuZXMoX2hlcm9JZCwgbmV3SGVyb0dlbmVzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBUcmFpbmluZyBpcyBzdWNjZXNzZnVsIG9ubHkgd2hlbiBwb3dlciBpbmNyZWFzZSwgY2hhbmdpbmcgYW5vdGhlciBlcXVpcG1lbnQgd2l0aCBzYW1lIHBvd2VyIGlzIGNvbnNpZGVyZWQgZmFpbHVyZQogICAgICAgIC8vIGFuZCBmYWl0aCB3aWxsIGJlIGdpdmVuIGFjY29yZGluZ2x5LgogICAgICAgIGJvb2wgc3VjY2VzcyA9IG5ld0hlcm9Qb3dlciA+IGhlcm9Qb3dlcjsKICAgICAgICAKICAgICAgICBpZiAoIXN1Y2Nlc3MpIHsKICAgICAgICAgICAgLy8gSGFuZGxlIHRyYWluaW5nIGZhaWx1cmUgLSBjb25zb2xhdGlvbiByZXdhcmRzIG1lY2hhbmljcy4KICAgICAgICAgICAgX2hhbmRsZVRyYWluaW5nRmFpbHVyZShfZXF1aXBtZW50SW5kZXgsIF90cmFpbmluZ1RpbWVzLCBfZHVuZ2VvbkRpZmZpY3VsdHkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBFbWl0IHRoZSBIZXJvVHJhaW5lZCBldmVudC4KICAgICAgICBIZXJvVHJhaW5lZChub3csIG1zZy5zZW5kZXIsIF9kdW5nZW9uSWQsIF9oZXJvSWQsIF9oZXJvR2VuZXMsIF9mbG9vck51bWJlciwgX2Zsb29yR2VuZXMsIHN1Y2Nlc3MsIG5ld0hlcm9HZW5lcyk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IERldGVybWluZSBpZiB0aGUgaGVybyB0cmFpbmluZyBpcyBzdWNjZXNzZnVsIG9yIG5vdCwgYW5kIHRoZSByZXN1bHRpbmcgZ2VuZXMgYW5kIHBvd2VyLgogICAgZnVuY3Rpb24gX2NhbGN1bGF0ZU5ld0hlcm9Qb3dlcigKICAgICAgICB1aW50IF9kdW5nZW9uRGlmZmljdWx0eSwgCiAgICAgICAgdWludCBfaGVyb0dlbmVzLCAKICAgICAgICB1aW50IF9lcXVpcG1lbnRJbmRleCwgCiAgICAgICAgdWludCBfdHJhaW5pbmdUaW1lcywgCiAgICAgICAgdWludCBfaGVyb1Bvd2VyLCAKICAgICAgICBib29sIF9pc1N1cGVyLCAKICAgICAgICB1aW50IF9mbG9vckdlbmVzCiAgICApIHByaXZhdGUgcmV0dXJucyAodWludCBuZXdIZXJvR2VuZXMsIHVpbnQgbmV3SGVyb1Bvd2VyKSB7CiAgICAgICAgbmV3SGVyb0dlbmVzID0gX2hlcm9HZW5lczsKICAgICAgICBuZXdIZXJvUG93ZXIgPSBfaGVyb1Bvd2VyOwogICAgICAgIGJvb2wgbmV3SXNTdXBlciA9IF9pc1N1cGVyOwogICAgICAgIAogICAgICAgIC8vIFRyYWluIHRoZSBoZXJvIG11bHRpcGxlIHRpbWVzIGFjY29yZGluZyB0byBfdHJhaW5pbmdUaW1lcywgCiAgICAgICAgLy8gZWFjaCB0aW1lIGlmIHRoZSByZXN1bHRpbmcgcG93ZXIgaXMgbGFyZ2VyLCB1cGRhdGUgbmV3IGhlcm8gcG93ZXIuCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3RyYWluaW5nVGltZXM7IGkrKykgewogICAgICAgICAgICAvLyBDYWxsIHRoZSBleHRlcm5hbCBjbG9zZWQgc291cmNlIHNlY3JldCBmdW5jdGlvbiB0aGF0IGRldGVybWluZXMgdGhlIHJlc3VsdGluZyBoZXJvICJnZW5lcyIuCiAgICAgICAgICAgIHVpbnQgdG1wSGVyb0dlbmVzID0gdHJhaW5pbmdGb3JtdWxhQ29udHJhY3QuY2FsY3VsYXRlUmVzdWx0KG5ld0hlcm9HZW5lcywgX2Zsb29yR2VuZXMsIF9lcXVpcG1lbnRJbmRleCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50IHRtcEhlcm9Qb3dlcjsKICAgICAgICAgICAgYm9vbCB0bXBJc1N1cGVyOwogICAgICAgICAgICAodG1wSGVyb1Bvd2VyLCwsIHRtcElzU3VwZXIsLCkgPSBnZXRIZXJvUG93ZXIodG1wSGVyb0dlbmVzLCBfZHVuZ2VvbkRpZmZpY3VsdHkpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRtcEhlcm9Qb3dlciA+IG5ld0hlcm9Qb3dlcikgewogICAgICAgICAgICAgICAgLy8gUHJldmVudCBTdXBlciBIZXJvIGRvd25ncmFkZS4KICAgICAgICAgICAgICAgIGlmICghKG5ld0lzU3VwZXIgJiYgIXRtcElzU3VwZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3SGVyb0dlbmVzID0gdG1wSGVyb0dlbmVzOwogICAgICAgICAgICAgICAgICAgIG5ld0hlcm9Qb3dlciA9IHRtcEhlcm9Qb3dlcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChfZXF1aXBtZW50SW5kZXggPiAwICYmIHRtcEhlcm9Qb3dlciA9PSBuZXdIZXJvUG93ZXIgJiYgdG1wSGVyb0dlbmVzICE9IG5ld0hlcm9HZW5lcykgewogICAgICAgICAgICAgICAgLy8gQWxsb3cgRXF1aXBtZW50IEZvcmdpbmcgdG8gcmVwbGFjZSBjdXJyZW50IHJlcXVpcGVtbnQgd2l0aCBhIHNhbWUgcG93ZXIgZXF1aXBtZW50LgogICAgICAgICAgICAgICAgLy8gVGhlIHRyYWluaW5nIGlzIGNvbnNpZGVyZWQgZmFpbGVkIChmYWl0aCB3aWxsIGJlIGdpdmVuLCBidXQgdGhlIGVxdWlwbWVudCB3aWxsIGNoYW5nZSkuCiAgICAgICAgICAgICAgICBuZXdIZXJvR2VuZXMgPSB0bXBIZXJvR2VuZXM7CiAgICAgICAgICAgICAgICBuZXdIZXJvUG93ZXIgPSB0bXBIZXJvUG93ZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSBhbmQgYXNzaWduIHRoZSBhcHByb3ByaWF0ZSBmYWl0aCB2YWx1ZSB0byB0aGUgcGxheWVyLgogICAgZnVuY3Rpb24gX2hhbmRsZVRyYWluaW5nRmFpbHVyZSh1aW50IF9lcXVpcG1lbnRJbmRleCwgdWludCBfdHJhaW5pbmdUaW1lcywgdWludCBfZHVuZ2VvbkRpZmZpY3VsdHkpIHByaXZhdGUgewogICAgICAgIC8vIEZhaWxlZCB0cmFpbmluZyBpbiBhIGR1bmdlb24gd2lsbCBhZGQgdG8gcGxheWVyJ3MgZmFpdGggdmFsdWUuCiAgICAgICAgdWludCBmYWl0aCA9IHBsYXllclRvRmFpdGhbbXNnLnNlbmRlcl07CiAgICAgICAgdWludCBmYWl0aEVhcm5lZDsKICAgICAgICAKICAgICAgICBpZiAoX2VxdWlwbWVudEluZGV4ID09IDApIHsgLy8gSGVybyBUcmFpbmluZwogICAgICAgICAgICAvLyBUaGUgZmFpdGggZWFybmVkIGlzIHByb3BvcnRpb25hbCB0byB0aGUgdHJhaW5pbmcgZmVlLCBpLmUuIF9kaWZmaWN1bHR5ICogX3RyYWluaW5nVGltZXMuCiAgICAgICAgICAgIGZhaXRoRWFybmVkID0gX2R1bmdlb25EaWZmaWN1bHR5ICogX3RyYWluaW5nVGltZXM7CiAgICAgICAgfSBlbHNlIHsgLy8gRXF1aXBtZW50IEZvcmdpbmcKICAgICAgICAgICAgLy8gRXF1aXBtZW50IEZvcmdpbmcgZmFpdGggZWFybmVkIGlzIG9ubHkgMiB0aW1lcyBub3JtYWwgdHJhaW5pbmcsIG5vdCBwcm9wb3J0aW9uYWwgdG8gZm9yZ2luZyBmZWUuCiAgICAgICAgICAgIGZhaXRoRWFybmVkID0gX2R1bmdlb25EaWZmaWN1bHR5ICogX3RyYWluaW5nVGltZXMgKiAyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB1aW50IG5ld0ZhaXRoID0gZmFpdGggKyBmYWl0aEVhcm5lZDsKICAgICAgICAKICAgICAgICAvLyBIaXR0aW5nIHRoZSByZXF1aXJlZCBhbW91bnQgaW4gZmFpdGggd2lsbCBnZXQgYSBwcm9wb3J0aW9uIG9mIGdyYW5kQ29uc29sYXRpb25SZXdhcmRzCiAgICAgICAgaWYgKG5ld0ZhaXRoID49IGNvbnNvbGF0aW9uUmV3YXJkc1JlcXVpcmVkRmFpdGgpIHsKICAgICAgICAgICAgdWludCBjb25zb2xhdGlvblJld2FyZHMgPSBncmFuZENvbnNvbGF0aW9uUmV3YXJkcyAqIGNvbnNvbGF0aW9uUmV3YXJkc0NsYWltUGVyY2VudCAvIDEwMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vICoqIFNUT1JBR0UgVVBEQVRFICoqCiAgICAgICAgICAgIGdyYW5kQ29uc29sYXRpb25SZXdhcmRzIC09IGNvbnNvbGF0aW9uUmV3YXJkczsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE1hcmsgdGhlIGNvbnNvbGF0aW9uIHJld2FyZHMgYXZhaWxhYmxlIHRvIGJlIHdpdGhkcmF3ZWQgYnkgdGhlIHBsYXllci4KICAgICAgICAgICAgYXN5bmNTZW5kKG1zZy5zZW5kZXIsIGNvbnNvbGF0aW9uUmV3YXJkcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZXNldCB0aGUgZmFpdGggdmFsdWUuCiAgICAgICAgICAgIG5ld0ZhaXRoIC09IGNvbnNvbGF0aW9uUmV3YXJkc1JlcXVpcmVkRmFpdGg7CiAgICAgICAgICAgIAogICAgICAgICAgICBDb25zb2xhdGlvblJld2FyZHNDbGFpbWVkKG5vdywgbXNnLnNlbmRlciwgY29uc29sYXRpb25SZXdhcmRzKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICBwbGF5ZXJUb0ZhaXRoW21zZy5zZW5kZXJdID0gbmV3RmFpdGg7CiAgICB9CiAgICAKICAgIAogICAgLyogPT09PT09PT0gTU9ESUZJRVJTID09PT09PT09ICovCiAgICAKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgZHVuZ2VvbiBzdGF0dXMgZG8gbm90IGFsbG93IHRyYWluaW5nLCBhbHNvIGNoZWNrIGZvciBkdW5nZW9uIGV4aXN0ZW5jZS4KICAgICAqICBBbHNvIGNoZWNrIGlmIHRoZSB1c2VyIGlzIGluIHRoZSBkdW5nZW9uLgogICAgICovCiAgICBtb2RpZmllciBkdW5nZW9uQ2FuVHJhaW4odWludCBfZHVuZ2VvbklkKSB7CiAgICAgICAgcmVxdWlyZShfZHVuZ2VvbklkIDwgZHVuZ2VvblRva2VuQ29udHJhY3QudG90YWxTdXBwbHkoKSk7CiAgICAgICAgdWludCBzdGF0dXM7CiAgICAgICAgKCxzdGF0dXMsLCwsLCwsKSA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0LmR1bmdlb25zKF9kdW5nZW9uSWQpOwogICAgICAgIHJlcXVpcmUoc3RhdHVzID09IDAgfHwgc3RhdHVzID09IDMpOwogICAgICAgIAogICAgICAgIC8vIEFsc28gY2hlY2sgaWYgdGhlIHVzZXIgaXMgaW4gdGhlIGR1bmdlb24uCiAgICAgICAgcmVxdWlyZShwbGF5ZXJUb0R1bmdlb25JRFttc2cuc2VuZGVyXSA9PSBfZHVuZ2VvbklkKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIHBsYXllciBkb2VzIG5vdCBvd24gdGhlIGhlcm8sIGFuZCBubyBwZW5kaW5nIHBvd2VyIHVwZGF0ZS4KICAgICAqLwogICAgbW9kaWZpZXIgaGVyb0FsbG93ZWRUb1RyYWluKHVpbnQgX2hlcm9JZCkgewogICAgICAgIHJlcXVpcmUoaGVyb1Rva2VuQ29udHJhY3Qub3duZXJPZihfaGVyb0lkKSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAKICAgICAgICAvLyBQcmV2ZW50IHBsYXllciB0byBwZXJmb3JtIHRyYWluaW5nIGFuZCBjaGFsbGVuZ2UgaW4gdGhlIHNhbWUgYmxvY2sgdG8gYXZvaWQgYm90IGV4cGxvaXQuCiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPiBwbGF5ZXJUb0xhc3RBY3Rpb25CbG9ja051bWJlclttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KICAgIAp9CgoKLyoqCiAqIEB0aXRsZSBFRENvcmVWZXJzaW9uMQogKiBAZGV2IENvcmUgQ29udHJhY3Qgb2YgRXRoZXIgRHVuZ2Vvbi4KICogIFdoZW4gVmVyc2lvbiAyIGxhdW5jaGVzLCBFRENvcmVWZXJzaW9uMiBjb250cmFjdCB3aWxsIGJlIGRlcGxveWVkIGFuZCBFRENvcmVWZXJzaW9uMSB3aWxsIGJlIGRlc3Ryb3llZC4KICogIFNpbmNlIGFsbCBkdW5nZW9ucyBhbmQgaGVyb2VzIGFyZSBzdG9yZWQgYXMgdG9rZW5zIGluIGV4dGVybmFsIGNvbnRyYWN0cywgdGhleSByZW1haW5zIGltbXV0YWJsZS4KICovCmNvbnRyYWN0IEVEQ29yZVZlcnNpb24xIGlzIERlc3RydWN0aWJsZSwgRURUcmFpbmluZyB7CiAgICAKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSB0aGUgRURDb3JlIGNvbnRyYWN0IHdpdGggYWxsIHRoZSByZXF1aXJlZCBjb250cmFjdCBhZGRyZXNzZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIEVEQ29yZVZlcnNpb24xKAogICAgICAgIGFkZHJlc3MgX2R1bmdlb25Ub2tlbkFkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfaGVyb1Rva2VuQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9jaGFsbGVuZ2VGb3JtdWxhQWRkcmVzcywgCiAgICAgICAgYWRkcmVzcyBfdHJhaW5pbmdGb3JtdWxhQWRkcmVzcwogICAgKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgZHVuZ2VvblRva2VuQ29udHJhY3QgPSBEdW5nZW9uVG9rZW5JbnRlcmZhY2UoX2R1bmdlb25Ub2tlbkFkZHJlc3MpOwogICAgICAgIGhlcm9Ub2tlbkNvbnRyYWN0ID0gSGVyb1Rva2VuSW50ZXJmYWNlKF9oZXJvVG9rZW5BZGRyZXNzKTsKICAgICAgICBjaGFsbGVuZ2VGb3JtdWxhQ29udHJhY3QgPSBDaGFsbGVuZ2VGb3JtdWxhSW50ZXJmYWNlKF9jaGFsbGVuZ2VGb3JtdWxhQWRkcmVzcyk7CiAgICAgICAgdHJhaW5pbmdGb3JtdWxhQ29udHJhY3QgPSBUcmFpbmluZ0Zvcm11bGFJbnRlcmZhY2UoX3RyYWluaW5nRm9ybXVsYUFkZHJlc3MpOwogICAgfQoKICAgIAogICAgLyogPT09PT09PT0gUFVCTElDL0VYVEVSTkFMIEZVTkNUSU9OUyA9PT09PT09PSAqLwogICAgCiAgICAvLy8gQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gZ2V0IGFsbCB0aGUgZ2FtZSBzZXR0aW5ncyBpbiBvbmUgY2FsbC4KICAgIGZ1bmN0aW9uIGdldEdhbWVTZXR0aW5ncygpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgdWludCBfcmVjcnVpdEhlcm9GZWUsCiAgICAgICAgdWludCBfdHJhbnNwb3J0YXRpb25GZWVNdWx0aXBsaWVyLAogICAgICAgIHVpbnQgX25vdmljZUR1bmdlb25JZCwKICAgICAgICB1aW50IF9jb25zb2xhdGlvblJld2FyZHNSZXF1aXJlZEZhaXRoLAogICAgICAgIHVpbnQgX2NoYWxsZW5nZUZlZU11bHRpcGxpZXIsCiAgICAgICAgdWludCBfZHVuZ2VvblByZXBhcmF0aW9uVGltZSwKICAgICAgICB1aW50IF90cmFpbmluZ0ZlZU11bHRpcGxpZXIsCiAgICAgICAgdWludCBfZXF1aXBtZW50VHJhaW5pbmdGZWVNdWx0aXBsaWVyLAogICAgICAgIHVpbnQgX3ByZXBhcmF0aW9uUGVyaW9kVHJhaW5pbmdGZWVNdWx0aXBsaWVyLAogICAgICAgIHVpbnQgX3ByZXBhcmF0aW9uUGVyaW9kRXF1aXBtZW50VHJhaW5pbmdGZWVNdWx0aXBsaWVyCiAgICApIHsKICAgICAgICBfcmVjcnVpdEhlcm9GZWUgPSByZWNydWl0SGVyb0ZlZTsKICAgICAgICBfdHJhbnNwb3J0YXRpb25GZWVNdWx0aXBsaWVyID0gdHJhbnNwb3J0YXRpb25GZWVNdWx0aXBsaWVyOwogICAgICAgIF9ub3ZpY2VEdW5nZW9uSWQgPSBub3ZpY2VEdW5nZW9uSWQ7CiAgICAgICAgX2NvbnNvbGF0aW9uUmV3YXJkc1JlcXVpcmVkRmFpdGggPSBjb25zb2xhdGlvblJld2FyZHNSZXF1aXJlZEZhaXRoOwogICAgICAgIF9jaGFsbGVuZ2VGZWVNdWx0aXBsaWVyID0gY2hhbGxlbmdlRmVlTXVsdGlwbGllcjsKICAgICAgICBfZHVuZ2VvblByZXBhcmF0aW9uVGltZSA9IGR1bmdlb25QcmVwYXJhdGlvblRpbWU7CiAgICAgICAgX3RyYWluaW5nRmVlTXVsdGlwbGllciA9IHRyYWluaW5nRmVlTXVsdGlwbGllcjsKICAgICAgICBfZXF1aXBtZW50VHJhaW5pbmdGZWVNdWx0aXBsaWVyID0gZXF1aXBtZW50VHJhaW5pbmdGZWVNdWx0aXBsaWVyOwogICAgICAgIF9wcmVwYXJhdGlvblBlcmlvZFRyYWluaW5nRmVlTXVsdGlwbGllciA9IHByZXBhcmF0aW9uUGVyaW9kVHJhaW5pbmdGZWVNdWx0aXBsaWVyOwogICAgICAgIF9wcmVwYXJhdGlvblBlcmlvZEVxdWlwbWVudFRyYWluaW5nRmVlTXVsdGlwbGllciA9IHByZXBhcmF0aW9uUGVyaW9kRXF1aXBtZW50VHJhaW5pbmdGZWVNdWx0aXBsaWVyOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgVGhlIGV4dGVybmFsIGZ1bmN0aW9uIHRvIGdldCBhbGwgdGhlIHJlbGV2YW50IGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmaWMgcGxheWVyIGJ5IGl0cyBhZGRyZXNzLgogICAgICogQHBhcmFtIF9hZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBwbGF5ZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFBsYXllckRldGFpbHMoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICB1aW50IGR1bmdlb25JZCwgCiAgICAgICAgdWludCBwYXltZW50LCAKICAgICAgICB1aW50IGR1bmdlb25Db3VudCwgCiAgICAgICAgdWludCBoZXJvQ291bnQsIAogICAgICAgIHVpbnQgZmFpdGgsCiAgICAgICAgYm9vbCBmaXJzdEhlcm9SZWNydWl0ZWQKICAgICkgewogICAgICAgIHBheW1lbnQgPSBwYXltZW50c1tfYWRkcmVzc107CiAgICAgICAgZHVuZ2VvbkNvdW50ID0gZHVuZ2VvblRva2VuQ29udHJhY3QuYmFsYW5jZU9mKF9hZGRyZXNzKTsKICAgICAgICBoZXJvQ291bnQgPSBoZXJvVG9rZW5Db250cmFjdC5iYWxhbmNlT2YoX2FkZHJlc3MpOwogICAgICAgIGZhaXRoID0gcGxheWVyVG9GYWl0aFtfYWRkcmVzc107CiAgICAgICAgZmlyc3RIZXJvUmVjcnVpdGVkID0gcGxheWVyVG9GaXJzdEhlcm9SZWNydWl0ZWRbX2FkZHJlc3NdOwogICAgICAgIAogICAgICAgIC8vIElmIGEgcGxheWVyIGRpZG4ndCByZWNydWl0IGFueSBoZXJvIHlldCwgY29uc2lkZXIgdGhlIHBsYXllciBpcyBpbiBub3ZpY2UgZHVuZ2VvbgogICAgICAgIGlmIChmaXJzdEhlcm9SZWNydWl0ZWQpIHsKICAgICAgICAgICAgZHVuZ2VvbklkID0gcGxheWVyVG9EdW5nZW9uSURbX2FkZHJlc3NdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGR1bmdlb25JZCA9IG5vdmljZUR1bmdlb25JZDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gZ2V0IGFsbCB0aGUgcmVsZXZhbnQgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZpYyBkdW5nZW9uIGJ5IGl0cyBJRC4KICAgICAqIEBwYXJhbSBfaWQgVGhlIElEIG9mIHRoZSBkdW5nZW9uLgogICAgICovCiAgICBmdW5jdGlvbiBnZXREdW5nZW9uRGV0YWlscyh1aW50IF9pZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICB1aW50IGNyZWF0aW9uVGltZSwgCiAgICAgICAgdWludCBzdGF0dXMsIAogICAgICAgIHVpbnQgZGlmZmljdWx0eSwgCiAgICAgICAgdWludCBjYXBhY2l0eSwgCiAgICAgICAgYWRkcmVzcyBvd25lciwgCiAgICAgICAgYm9vbCBpc1JlYWR5LCAKICAgICAgICB1aW50IHBsYXllckNvdW50CiAgICApIHsKICAgICAgICByZXF1aXJlKF9pZCA8IGR1bmdlb25Ub2tlbkNvbnRyYWN0LnRvdGFsU3VwcGx5KCkpOwogICAgICAgIAogICAgICAgIC8vIERpZG4ndCBnZXQgdGhlICJmbG9vckNyZWF0aW9uVGltZSIgYmVjYXVzZSBvZiBTdGFjayBUb28gRGVlcCBlcnJvci4KICAgICAgICAoY3JlYXRpb25UaW1lLCBzdGF0dXMsIGRpZmZpY3VsdHksIGNhcGFjaXR5LCwsLCwpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2lkKTsKICAgICAgICAKICAgICAgICAvLyBEdW5nZW9uIGlzIHJlYWR5IHRvIGJlIGNoYWxsZW5nZWQgKG5vdCBpbiBwcmVwYXJhdGlvbiBtb2RlKS4KICAgICAgICBvd25lciA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0Lm93bmVyT2YoX2lkKTsKICAgICAgICBpc1JlYWR5ID0gY3JlYXRpb25UaW1lICsgZHVuZ2VvblByZXBhcmF0aW9uVGltZSA8PSBub3c7CiAgICAgICAgcGxheWVyQ291bnQgPSBkdW5nZW9uSWRUb1BsYXllckNvdW50W19pZF07CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBTcGxpdCBmbG9vciByZWxhdGVkIGRldGFpbHMgb3V0IG9mIGdldER1bmdlb25EZXRhaWxzLCBqdXN0IHRvIGF2b2lkIFN0YWNrIFRvbyBEZWVwIGVycm9yLgogICAgICogQHBhcmFtIF9pZCBUaGUgSUQgb2YgdGhlIGR1bmdlb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldER1bmdlb25GbG9vckRldGFpbHModWludCBfaWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgdWludCBmbG9vck51bWJlciwgCiAgICAgICAgdWludCBmbG9vckNyZWF0aW9uVGltZSwgCiAgICAgICAgdWludCByZXdhcmRzLCAKICAgICAgICB1aW50IHNlZWRHZW5lcywgCiAgICAgICAgdWludCBmbG9vckdlbmVzCiAgICApIHsKICAgICAgICByZXF1aXJlKF9pZCA8IGR1bmdlb25Ub2tlbkNvbnRyYWN0LnRvdGFsU3VwcGx5KCkpOwogICAgICAgIAogICAgICAgIC8vIERpZG4ndCBnZXQgdGhlICJmbG9vckNyZWF0aW9uVGltZSIgYmVjYXVzZSBvZiBTdGFjayBUb28gRGVlcCBlcnJvci4KICAgICAgICAoLCwsLCBmbG9vck51bWJlciwgZmxvb3JDcmVhdGlvblRpbWUsIHJld2FyZHMsIHNlZWRHZW5lcywgZmxvb3JHZW5lcykgPSBkdW5nZW9uVG9rZW5Db250cmFjdC5kdW5nZW9ucyhfaWQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gZ2V0IGFsbCB0aGUgcmVsZXZhbnQgaW5mb3JtYXRpb24gYWJvdXQgYSBzcGVjaWZpYyBoZXJvIGJ5IGl0cyBJRC4KICAgICAqIEBwYXJhbSBfaWQgVGhlIElEIG9mIHRoZSBoZXJvLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRIZXJvRGV0YWlscyh1aW50IF9pZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICgKICAgICAgICB1aW50IGNyZWF0aW9uVGltZSwgCiAgICAgICAgdWludCBjb29sZG93blN0YXJ0VGltZSwgCiAgICAgICAgdWludCBjb29sZG93bkluZGV4LCAKICAgICAgICB1aW50IGdlbmVzLCAKICAgICAgICBhZGRyZXNzIG93bmVyLCAKICAgICAgICBib29sIGlzUmVhZHksIAogICAgICAgIHVpbnQgY29vbGRvd25SZW1haW5pbmdUaW1lCiAgICApIHsKICAgICAgICByZXF1aXJlKF9pZCA8IGhlcm9Ub2tlbkNvbnRyYWN0LnRvdGFsU3VwcGx5KCkpOwoKICAgICAgICAoY3JlYXRpb25UaW1lLCBjb29sZG93blN0YXJ0VGltZSwgY29vbGRvd25JbmRleCwgZ2VuZXMpID0gaGVyb1Rva2VuQ29udHJhY3QuaGVyb2VzKF9pZCk7CiAgICAgICAgCiAgICAgICAgLy8gSGVybyBpcyByZWFkeSB0byBjaGFsbGVuZ2UgKG5vdCBpbiBjb29sZG93biBtb2RlKS4KICAgICAgICBvd25lciA9IGhlcm9Ub2tlbkNvbnRyYWN0Lm93bmVyT2YoX2lkKTsKICAgICAgICBjb29sZG93blJlbWFpbmluZ1RpbWUgPSBfY29tcHV0ZUNvb2xkb3duUmVtYWluaW5nVGltZShfaWQpOwogICAgICAgIGlzUmVhZHkgPSBjb29sZG93blJlbWFpbmluZ1RpbWUgPT0gMDsKICAgIH0KICAgIAogICAgCiAgICAvKiA9PT09PT09PSBNSUdSQVRJT04gRlVOQ1RJT05TID09PT09PT09ICovCiAgICAKICAgIC8qKgogICAgICogQGRldiBTaW5jZSB0aGUgRHVuZ2VvblRva2VuIGNvbnRyYWN0IGlzIHJlLWRlcGxveWVkIGR1ZSB0byBvcHRpbWl6YXRpb24uCiAgICAgKiAgV2UgbmVlZCB0byBtaWdyYXRlIGFsbCBkdW5nZW9ucyBmcm9tIEJldGEgdG9rZW4gY29udHJhY3QgdG8gVmVyc2lvbiAxLgogICAgICovCiAgICBmdW5jdGlvbiBtaWdyYXRlRHVuZ2Vvbih1aW50IF9pZCwgdWludCBfcGxheWVyQ291bnQpIGV4dGVybmFsIHsKICAgICAgICAvLyBNaWdyYXRpb24gd2lsbCBiZSBmaW5pc2hlZCBiZWZvcmUgbWFpbnRlbmFuY2UgcGVyaW9kIGVuZHMsIHR4Lm9yaWdpbiBpcyB1c2VkIHdpdGhpbiBhIHNob3J0IHBlcmlvZCBvbmx5LgogICAgICAgIHJlcXVpcmUobm93IDwgMTUyMDY5NDAwMCAmJiB0eC5vcmlnaW4gPT0gMHg0NzE2OWY3ODc1MEJlMWU2ZWMyREViMjk3NDQ1OGFjNEY4NzUxNzE0KTsKICAgICAgICAKICAgICAgICBkdW5nZW9uSWRUb1BsYXllckNvdW50W19pZF0gPSBfcGxheWVyQ291bnQ7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBXZSBuZWVkIHRvIG1pZ3JhdGUgYWxsIHBsYXllciBsb2NhdGlvbiBmcm9tIEJldGEgdG9rZW4gY29udHJhY3QgdG8gVmVyc2lvbiAxLgogICAgICovCiAgICBmdW5jdGlvbiBtaWdyYXRlUGxheWVyKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQgX293bmVyRHVuZ2VvbklkLCB1aW50IF9wYXltZW50LCB1aW50IF9mYWl0aCkgZXh0ZXJuYWwgewogICAgICAgIC8vIE1pZ3JhdGlvbiB3aWxsIGJlIGZpbmlzaGVkIGJlZm9yZSBtYWludGVuYW5jZSBwZXJpb2QgZW5kcywgdHgub3JpZ2luIGlzIHVzZWQgd2l0aGluIGEgc2hvcnQgcGVyaW9kIG9ubHkuCiAgICAgICAgcmVxdWlyZShub3cgPCAxNTIwNjk0MDAwICYmIHR4Lm9yaWdpbiA9PSAweDQ3MTY5Zjc4NzUwQmUxZTZlYzJERWIyOTc0NDU4YWM0Rjg3NTE3MTQpOwogICAgICAgIAogICAgICAgIHBsYXllclRvRHVuZ2VvbklEW19hZGRyZXNzXSA9IF9vd25lckR1bmdlb25JZDsKICAgICAgICAKICAgICAgICBpZiAoX3BheW1lbnQgPiAwKSB7CiAgICAgICAgICAgIGFzeW5jU2VuZChfYWRkcmVzcywgX3BheW1lbnQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoX2ZhaXRoID4gMCkgewogICAgICAgICAgICBwbGF5ZXJUb0ZhaXRoW19hZGRyZXNzXSA9IF9mYWl0aDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcGxheWVyVG9GaXJzdEhlcm9SZWNydWl0ZWRbX2FkZHJlc3NdID0gdHJ1ZTsKICAgIH0KICAgIAp9'.
	

]
