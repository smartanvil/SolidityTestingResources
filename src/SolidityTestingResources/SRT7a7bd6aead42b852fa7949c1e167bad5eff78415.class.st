Class {
	#name : #SRT7a7bd6aead42b852fa7949c1e167bad5eff78415,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT7a7bd6aead42b852fa7949c1e167bad5eff78415 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Cgpjb250cmFjdCBCYXNlIHsKCiAgICBmdW5jdGlvbiBtYXgodWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOyB9CiAgICBmdW5jdGlvbiBtaW4odWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIGEgPD0gYiA/IGEgOiBiOyB9CgogICAgbW9kaWZpZXIgb25seShhZGRyZXNzIGFsbG93ZWQpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhbGxvd2VkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKCiAgICAvLy9AcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiAoc2l6ZSA+IDApOwogICAgfQoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgcmVlbnRyYW5jeSBoYW5kbGluZyAgICAgICAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvL0BkZXYgcHJlZGVmaW5lZCBsb2NrcyAodXAgdG8gdWludCBiaXQgbGVuZ3RoLCBpLmUuIDI1NiBwb3NzaWJsZSkKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAwID0gMiAqKiAwOwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDEgPSAyICoqIDE7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMiA9IDIgKiogMjsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAzID0gMiAqKiAzOwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDQgPSAyICoqIDQ7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwNSA9IDIgKiogNTsKCiAgICAvL3ByZXZlbnRzIHJlZW50cmFuY3kgYXR0YWNzOiBzcGVjaWZpYyBsb2NrcwogICAgdWludCBwcml2YXRlIGJpdGxvY2tzID0gMDsKICAgIG1vZGlmaWVyIG5vUmVlbnRyYW5jeSh1aW50IG0pIHsKICAgICAgICB2YXIgX2xvY2tzID0gYml0bG9ja3M7CiAgICAgICAgaWYgKF9sb2NrcyAmIG0gPiAwKSB0aHJvdzsKICAgICAgICBiaXRsb2NrcyB8PSBtOwogICAgICAgIF87CiAgICAgICAgYml0bG9ja3MgPSBfbG9ja3M7CiAgICB9CgogICAgbW9kaWZpZXIgbm9BbnlSZWVudHJhbmN5IHsKICAgICAgICB2YXIgX2xvY2tzID0gYml0bG9ja3M7CiAgICAgICAgaWYgKF9sb2NrcyA+IDApIHRocm93OwogICAgICAgIGJpdGxvY2tzID0gdWludCgtMSk7CiAgICAgICAgXzsKICAgICAgICBiaXRsb2NrcyA9IF9sb2NrczsKICAgIH0KCiAgICAvLy9AZGV2IGVtcHR5IG1hcmtpbmcgbW9kaWZpZXIgc2lnbmFsaW5nIHRvIHVzZXIgb2YgdGhlIG1hcmtlZCBmdW5jdGlvbiAsIHRoYXQgaXQgY2FuIGNhdXNlIGFuIHJlZW50cmFudCBjYWxsLgogICAgLy8vICAgICBkZXZlbG9wZXIgc2hvdWxkIG1ha2UgdGhlIGNhbGxlciBmdW5jdGlvbiByZWVudHJhbnQtc2FmZSBpZiBpdCB1c2UgYSByZWVudHJhbnQgZnVuY3Rpb24uCiAgICBtb2RpZmllciByZWVudHJhbnQgeyBfOyB9Cgp9Cgpjb250cmFjdCBPd25lZCBpcyBCYXNlIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgb25seShvd25lcikgewogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOwogICAgfQoKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIG9ubHkobmV3T3duZXIpIHsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsKCn0KCgpjb250cmFjdCBFUkMyMCBpcyBPd25lZCB7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgewogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgaXNTdGFydGVkT25seSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIGJvb2wgICAgcHVibGljIGlzU3RhcnRlZCA9IGZhbHNlOwoKICAgIG1vZGlmaWVyIG9ubHlIb2xkZXIoYWRkcmVzcyBob2xkZXIpIHsKICAgICAgICBpZiAoYmFsYW5jZU9mKGhvbGRlcikgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1N0YXJ0ZWRPbmx5KCkgewogICAgICAgIGlmICghaXNTdGFydGVkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKfQoKLy9EZWNpc2lvbiBtYWRlLgovLyAxIC0gUHJvdmlkZXIgaXMgc29sZWx5IHJlc3BvbnNpYmxlIHRvIGNvbnNpZGVyIGZhaWxlZCBzdWIgY2hhcmdlIGFzIGFuIGVycm9yIGFuZCBzdG9wIHRoZSBzZXJ2aWNlLAovLyAgICB0aGVyZWZvcmUgdGhlcmUgaXMgbm8gc2VwYXJhdGUgZXJyb3Igc3RhdGUgb3IgY291bnRlciBmb3IgdGhhdCBpbiB0aGlzIFRva2VuIENvbnRyYWN0LgovLwovLyAyIC0gQSBjYWxsIG9yaWdpbmF0ZWQgZnJvbSB0aGUgdXNlciAoaXNDb250cmFjdChtc2cuc2VuZGVyKT09ZmFsc2UpIHNob3VsZCB0aHJvdyBhbiBleGNlcHRpb24gb24gZXJyb3IsCi8vICAgICBidXQgaXQgc2hvdWxkIHJldHVybiAiZmFsc2UiIG9uIGVycm9yIGlmIGNhbGxlZCBmcm9tIG90aGVyIGNvbnRyYWN0IChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpPT10cnVlKS4KLy8gICAgIFJlYXNvbjogdGhyb3duIGV4Y2VwdGlvbiBhcmUgZWFzaWVyIHRvIHNlZSBpbiB3YWxsZXRzLCByZXR1cm5lZCBib29sZWFuIHZhbHVlcyBhcmUgZWFzaWVyIHRvIGV2YWx1YXRlIGluIHRoZSBjb2RlIG9mIHRoZSBjYWxsaW5nIGNvbnRyYWN0LgovLwovLyAzIC0gU2VydmljZSBwcm92aWRlcnMgYXJlIHJlc3BvbnNpYmxlIGZvciBmaXJpbmcgZXZlbnRzIGluIGNhc2Ugb2Ygb2ZmZXIgY2hhbmdlczsKLy8gICAgIGl0IGlzIHRoZWlycyBkZWNpc2lvbiB0byBpbmZvcm0gREFwcHMgYWJvdXQgb2ZmZXIgY2hhbmdlcyBvciBub3QuCi8vCi8vVG9EbzoKLy8gOCAtIHZhbGlkYXRlIGxpbmtpbmcgbW9kdWxlcyBhbmQgZGVwbG95bWVudCBwcm9jZXNzOiBhdHRhY2hUb2tlbihhZGRyZXNzIHRva2VuKSBwdWJsaWMKCgovLy9AZGV2IGFuIGJhc2UgY2xhc3MgdG8gaW1wbGVtZW50IGJ5IFNlcnZpY2UgUHJvdmlkZXIgY29udHJhY3QgdG8gYmUgbm90aWZpZWQgYWJvdXQgc3Vic2NyaXB0aW9uIGNoYW5nZXMgKGluLVR4IG5vdGlmaWNhdGlvbikuCi8vLyAgICAgQWRkaXRpb25hbGx5IGl0IGNvbnRhaW5zIHN0YW5kYXJkIGV2ZW50cyB0byBiZSBmaXJlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIG9uIG9mZmVyIGNoYW5nZXMuCi8vLyAgICAgc2VlIGFsc2UgRVZNIGV2ZW50cyBsb2dnZWQgYnkgc3Vic2NyaXB0aW9uIG1vZHVsZS4KLy8KY29udHJhY3QgU2VydmljZVByb3ZpZGVyIHsKCiAgICAvLy9AZGV2IGdldCBodW1hbiByZWFkYWJsZSBkZXNjcmlwdG9yIChvciB1cmwpIGZvciB0aGlzIFNlcnZpY2UgcHJvdmlkZXIKICAgIC8vCiAgICBmdW5jdGlvbiBpbmZvKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMoc3RyaW5nKTsKCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IGluY29taW5nIHNpbmdsZSBwYXltZW50LgogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIHBheW1lbnQuCiAgICAvLwogICAgZnVuY3Rpb24gb25QYXltZW50KGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IHN1YnNjcmlwdGlvbiBjaGFyZ2UuCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgb3BlcmF0aW9uLgogICAgLy8KICAgIGZ1bmN0aW9uIG9uU3ViRXhlY3V0ZWQodWludCBzdWJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKICAgIC8vL0BkZXYgY2FsbGVkIHRvIHBvc3QtYXBwcm92ZS9yZWplY3QgYSBjcmVhdGlvbiBvZiB0aGUgc3Vic2NyaXB0aW9uLgogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4KICAgIC8vCiAgICBmdW5jdGlvbiBvblN1Yk5ldyh1aW50IG5ld1N1YklkLCB1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCiAgICAvLy9AZGV2IGNhbGxlZCB0byBub3RpZnkgc2VydmljZSBwcm92aWRlciBhYm91dCBzdWJzY3JpcHRpb24gY2FuY2VsbGF0aW9uLgogICAgLy8vICAgICBQcm92aWRlciBpcyBub3QgYWJsZSB0byBwcmV2ZW50IHRoZSBjYW5jZWxsYXRpb24uCiAgICAvLy9AcmV0dXJuIDw8cmVzZXJ2ZWQgZm9yIGZ1dHVyZSBpbXBsZW1lbnRhdGlvbj4+CiAgICAvLwogICAgZnVuY3Rpb24gb25TdWJDYW5jZWxlZCh1aW50IHN1YklkLCBhZGRyZXNzIGNhbGxlcikgcHVibGljIHJldHVybnMgKGJvb2wpOwoKICAgIC8vL0BkZXYgY2FsbGVkIHRvIG5vdGlmeSBzZXJ2aWNlIHByb3ZpZGVyIGFib3V0IHN1YnNjcmlwdGlvbiBnb3QgaG9sZC91bmhvbGQuCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgb3BlcmF0aW9uLgogICAgLy8KICAgIGZ1bmN0aW9uIG9uU3ViVW5Ib2xkKHVpbnQgc3ViSWQsIGFkZHJlc3MgY2FsbGVyLCBib29sIGlzT25Ib2xkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8vL0BkZXYgZm9sbG93aW5nIGV2ZW50cyBzaG91bGQgYmUgdXNlZCBieSBTZXJ2aWNlUHJvdmlkZXIgY29udHJhY3QgdG8gbm90aWZ5IERBcHBzIGFib3V0IG9mZmVyIGNoYW5nZXMuCiAgICAvLy8gICAgIFN1YnNjcmlwdGlvbk1vZHVsZSBkbyBub3QgdGhpcyBub3RpZmljYXRpb24gYW5kIGV4cGVjdHMgaXQgZnJvbSBTZXJ2aWNlIFByb3ZpZGVyIGlmIGRlc2lyZWQuCiAgICAvLy8KICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIG5ldyBPZmZlciBjcmVhdGVkIGluIGEgcGxhdGZvcm0uCiAgICBldmVudCBPZmZlckNyZWF0ZWQodWludCBvZmZlcklkLCAgYnl0ZXMgZGVzY3JpcHRvciwgYWRkcmVzcyBwcm92aWRlcik7CgogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgdXBkYXRlZC4KICAgIGV2ZW50IE9mZmVyVXBkYXRlZCh1aW50IG9mZmVySWQsICBieXRlcyBkZXNjcmlwdG9yLCB1aW50IG9sZEV4ZWNDb3VudGVyLCBhZGRyZXNzIHByb3ZpZGVyKTsKCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBPZmZlciBjYW5jZWxlZC4KICAgIGV2ZW50IE9mZmVyQ2FuY2VsZWQodWludCBvZmZlcklkLCBieXRlcyBkZXNjcmlwdG9yLCBhZGRyZXNzIHByb3ZpZGVyKTsKCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBPZmZlciBob2xkL3VuaG9sZCBzdGF0dXMgY2hhbmdlZC4KICAgIGV2ZW50IE9mZmVyVW5Ib2xkKHVpbnQgb2ZmZXJJZCwgICBieXRlcyBkZXNjcmlwdG9yLCBib29sIGlzT25Ib2xkTm93LCBhZGRyZXNzIHByb3ZpZGVyKTsKfSAvL1NlcnZpY2VQcm92aWRlcgoKLy8vQG5vdGljZSBYUmF0ZVByb3ZpZGVyIGlzIGFuIGV4dGVybmFsIHNlcnZpY2UgcHJvdmlkaW5nIGFuIGV4Y2hhbmdlIHJhdGUgZnJvbSBleHRlcm5hbCBjdXJyZW5jeSB0byBTQU4gdG9rZW4uCi8vLyBpdCB1c2VkIGZvciBzdWJzY3JpcHRpb25zIHByaWNlZCBpbiBvdGhlciBjdXJyZW5jeSB0aGFuIFNBTiAoZXZlbiBjYWxjdWxhdGVkIGFuZCBwYWlkIGZvcm1hbGx5IGluIFNBTikuCi8vLyBpZiBub24tZGVmYXVsdCBYUmF0ZVByb3ZpZGVyIGlzIHNldCBmb3Igc29tZSBzdWJzY3JpcHRpb24sIHRoZW4gdGhlIGFtb3VudCBpbiBTQU4gZm9yIGV2ZXJ5IHBlcmlvZGljIHBheW1lbnQKLy8vIHdpbGwgYmUgcmVjYWxjdWxhdGVkIHVzaW5nIHByb3ZpZGVkIGV4Y2hhbmdlIHJhdGUuCi8vLwovLy8gUGxlYXNlIG5vdGUsIHRoYXQgdGhlIGV4Y2hhbmdlIHJhdGUgZnJhY3Rpb24gaXMgKHVpbnQzMix1aW50MzIpIG51bWJlci4gSXQgc2hvdWxkIGJlIGVub3VnaCB0byBleHByZXNzCi8vLyBhbnkgcmVhbCBleGNoYW5nZSByYXRlIHZvbGF0aWxpdHkuIE5ldmVydGhlbGVzcyB5b3UgYXJlIGFkdmlzZWQgdG8gYXZvaWQgdG9vIGJpZyBudW1iZXJzIGluIHRoZSBmcmFjdGlvbi4KLy8vIFBvc3NpaWJseSB5b3UgY291bGQgaW1wbGVtZW50IHRoZSByYXRpbyBvZiBtdWx0aXBsZSB0b2tlbiBwZXIgU0FOIGluIG9yZGVyIHRvIGtlZXAgdGhlIGF2ZXJhZ2UgcmF0aW8gYXJvdW5kIDE6MS4KLy8vCi8vLyBUaGUgZGVmYXVsdCBYUmF0ZVByb3ZpZGVyICh3aXRoIGlkPT0wKSBkZWZpbmVzIGV4Y2hhbmdlIHJhdGUgMToxIGFuZCByZXByZXNlbnRzIGV4Y2hhbmdlIHJhdGUgb2YgU0FOIHRva2VuIHRvIGl0c2VsZi4KLy8vIHRoaXMgcHJvdmlkZXIgaXMgc2V0IGJ5IGRlZmFsdWx0IGFuZCB0aHVzIHRoZSBzdWJzY3JpcHRpb24gYmVjb21lcyBub21pbmF0ZWQgaW4gU0FOLgovLwpjb250cmFjdCBYUmF0ZVByb3ZpZGVyIHsKCiAgICAvL0BkZXYgcmV0dXJucyBjdXJyZW50IGV4Y2hhbmdlIHJhdGUgKGluIGZvcm0gb2YgYSBzaW1wbGUgZnJhY3Rpb24pIGZyb20gb3RoZXIgY3VycmVuY3kgdG8gU0FOIChmLmUuIEVUSDpTQU4pLgogICAgLy9AZGV2IGZyYWN0aW9uIG51bWJlcnMgYXJlIHJlc3RyaWN0ZWQgdG8gdWludDE2IHRvIHByZXZlbnQgb3ZlcmZsb3cgaW4gY2FsY3VsYXRpb25zOwogICAgZnVuY3Rpb24gZ2V0UmF0ZSgpIHB1YmxpYyByZXR1cm5zICh1aW50MzIgLypub21pbmF0b3IqLywgdWludDMyIC8qZGVub21pbmF0b3IqLyk7CgogICAgLy9AZGV2IHByb3ZpZGVzIGEgY29kZSBmb3IgYW5vdGhlciBjdXJyZW5jeSwgZi5lLiAiRVRIIiBvciAiVVNEIgogICAgZnVuY3Rpb24gZ2V0Q29kZSgpIHB1YmxpYyByZXR1cm5zIChzdHJpbmcpOwp9CgoKLy9AZGV2IGRhdGEgc3RydWN0dXJlIGZvciBTdWJzY3JpcHRpb25Nb2R1bGUKY29udHJhY3QgU3Vic2NyaXB0aW9uQmFzZSB7CgogICAgZW51bSBTdWJTdGF0ZSAgIHtOT1RfRVhJU1QsIEJFRk9SRV9TVEFSVCwgUEFJRCwgQ0hBUkdFQUJMRSwgT05fSE9MRCwgQ0FOQ0VMRUQsIEVYUElSRUQsIEZJTkFMSVpFRH0KICAgIGVudW0gT2ZmZXJTdGF0ZSB7Tk9UX0VYSVNULCBCRUZPUkVfU1RBUlQsIEFDVElWRSwgU09MRF9PVVQsIE9OX0hPTEQsIEVYUElSRUR9CgogICAgc3RyaW5nW10gaW50ZXJuYWwgU1VCX1NUQVRFUyAgID0gWyJOT1RfRVhJU1QiLCAiQkVGT1JFX1NUQVJUIiwgIlBBSUQiLCAiQ0hBUkdFQUJMRSIsICJPTl9IT0xEIiwgIkNBTkNFTEVEIiwgIkVYUElSRUQiLCAiRklOQUxJWkVEIiBdOwogICAgc3RyaW5nW10gaW50ZXJuYWwgT0ZGRVJfU1RBVEVTID0gWyJOT1RfRVhJU1QiLCAiQkVGT1JFX1NUQVJUIiwgIkFDVElWRSIsICJTT0xEX09VVCIsICJPTl9IT0xEIiwgIkVYUElSRUQiXTsKCiAgICAvL0BkZXYgc3Vic2NyaXB0aW9uIGFuZCBzdWJzY3JpcHRpb24gb2ZmZXIgdXNlIHRoZSBzYW1lIHN0cnVjdHVyZS4gT2ZmZXIgaXMgdGVjaG5pY2FsbHkgYSB0ZW1wbGF0ZSBmb3Igc3Vic2NyaXB0aW9uLgogICAgc3RydWN0IFN1YnNjcmlwdGlvbiB7CiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlckZyb207ICAgLy8gY3VzdG9tZXIgKHVuc2V0IGluIHN1YnNjcmlwdGlvbiBvZmZlcikKICAgICAgICBhZGRyZXNzIHRyYW5zZmVyVG87ICAgICAvLyBzZXJ2aWNlIHByb3ZpZGVyCiAgICAgICAgdWludCBwcmljZVBlckhvdXI7ICAgICAgLy8gcHJpY2UgaW4gU0FOIHBlciBob3VyIChwb3NzaWJseSByZWNhbGN1bGF0ZWQgdXNpbmcgZXhjaGFuZ2UgcmF0ZSkKICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX247ICAvLyBub21pbmF0b3IKICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2Q7ICAvLyBkZW5vbWluYXRvcgogICAgICAgIHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQ7IC8vIGlkIG9mIGEgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVyCiAgICAgICAgdWludCBwYWlkVW50aWw7ICAgICAgICAgLy8gc3Vic2NyaXB0aW9uIGlzIHBhaWQgdW50aWwgdGltZQogICAgICAgIHVpbnQgY2hhcmdlUGVyaW9kOyAgICAgIC8vIHN1YnNjcmlwdGlvbiBjYW4ndCBiZSBjaGFyZ2VkIG1vcmUgb2Z0ZW4gdGhhbiB0aGlzIHBlcmlvZAogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudDsgICAgIC8vIHVwZnJvbnQgZGVwb3NpdCBvbiBjcmVhdGluZyBzdWJzY3JpcHRpb24gKHBvc3NpYmx5IHJlY2FsY3VsYXRlZCB1c2luZyBleGNoYW5nZSByYXRlKQoKICAgICAgICB1aW50IHN0YXJ0T247ICAgICAgICAgICAvLyBmb3Igb2ZmZXI6IGNhbid0IGJlIGFjY2VwdGVkIGJlZm9yZSAgPHN0YXJ0T24+IDsgZm9yIHN1YnNjcmlwdGlvbjogY2FuJ3QgYmUgY2hhcmdlZCBiZWZvcmUgPHN0YXJ0T24+CiAgICAgICAgdWludCBleHBpcmVPbjsgICAgICAgICAgLy8gZm9yIG9mZmVyOiBjYW4ndCBiZSBhY2NlcHRlZCBhZnRlciAgPGV4cGlyZU9uPiA7IGZvciBzdWJzY3JpcHRpb246IGNhbid0IGJlIGNoYXJnZWQgYWZ0ZXIgIDxleHBpcmVPbj4KICAgICAgICB1aW50IGV4ZWNDb3VudGVyOyAgICAgICAvLyBmb3Igb2ZmZXI6IG1heCBudW0gb2Ygc3Vic2NyaXB0aW9ucyBhdmFpbGFibGUgIDsgZm9yIHN1YnNjcmlwdGlvbjogbnVtIG9mIGNoYXJnZXMgbWFkZS4KICAgICAgICBieXRlcyBkZXNjcmlwdG9yOyAgICAgICAvLyBzdWJzY3JpcHRpb24gcGF5bG9hZCAoc3ViamVjdCk6IGV2YWx1YXRlZCBieSBzZXJ2aWNlIHByb3ZpZGVyLgogICAgICAgIHVpbnQgb25Ib2xkU2luY2U7ICAgICAgIC8vIHN1YnNjcmlwdGlvbjogb24taG9sZCBzaW5jZSB0aW1lIG9yIDAgaWYgbm90IG9uSG9sZC4gb2ZmZXI6IHVudXNlZDogLy9Ub0RvOiB0byBiZSBpbXBsZW1lbnRlZAogICAgfQoKICAgIHN0cnVjdCBEZXBvc2l0IHsKICAgICAgICB1aW50IHZhbHVlOyAgICAgICAgIC8vIHZhbHVlIG9uIGRlcG9zaXQKICAgICAgICBhZGRyZXNzIG93bmVyOyAgICAgIC8vIHVzdWFsbHkgYSBjdXN0b21lcgogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3I7ICAgLy8gc2VydmljZSByZWxhdGVkIGRlc2NyaXB0b3IgdG8gYmUgZXZhbHVhdGVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIKICAgIH0KCiAgICBldmVudCBOZXdTdWJzY3JpcHRpb24oYWRkcmVzcyBjdXN0b21lciwgYWRkcmVzcyBzZXJ2aWNlLCB1aW50IG9mZmVySWQsIHVpbnQgc3ViSWQpOwogICAgZXZlbnQgTmV3RGVwb3NpdCh1aW50IGRlcG9zaXRJZCwgdWludCB2YWx1ZSwgYWRkcmVzcyBzZW5kZXIpOwogICAgZXZlbnQgTmV3WFJhdGVQcm92aWRlcihhZGRyZXNzIGFkZHIsIHVpbnQxNiB4UmF0ZVByb3ZpZGVySWQsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IERlcG9zaXRSZXR1cm5lZCh1aW50IGRlcG9zaXRJZCwgYWRkcmVzcyByZXR1cm5lZFRvKTsKICAgIGV2ZW50IFN1YnNjcmlwdGlvbkRlcG9zaXRSZXR1cm5lZCh1aW50IHN1YklkLCB1aW50IGFtb3VudCwgYWRkcmVzcyByZXR1cm5lZFRvLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBPZmZlck9uSG9sZCh1aW50IG9mZmVySWQsIGJvb2wgb25Ib2xkLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBPZmZlckNhbmNlbGVkKHVpbnQgb2ZmZXJJZCwgYWRkcmVzcyBzZW5kZXIpOwogICAgZXZlbnQgU3ViT25Ib2xkKHVpbnQgb2ZmZXJJZCwgYm9vbCBvbkhvbGQsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IFN1YkNhbmNlbGVkKHVpbnQgc3ViSWQsIGFkZHJlc3Mgc2VuZGVyKTsKCn0KCi8vL0BkZXYgYW4gSW50ZXJmYWNlIGZvciBTdWJzY3JpcHRpb25Nb2R1bGUuCi8vLyAgICAgZXh0cmFjdGVkIGhlcmUgZm9yIGJldHRlciBvdmVydmlldy4KLy8vICAgICBzZWUgZGV0YWlsZWQgZG9jdW1lbnRhdGlvbiBpbiBpbXBsZW1lbnRhdGlvbiBtb2R1bGUuCmNvbnRyYWN0IFN1YnNjcmlwdGlvbk1vZHVsZSBpcyBTdWJzY3JpcHRpb25CYXNlLCBCYXNlIHsKCiAgICAvLy9AZGV2ICoqKioqIG1vZHVsZSBjb25maWd1cmF0aW9uICoqKioqCiAgICBmdW5jdGlvbiBhdHRhY2hUb2tlbihhZGRyZXNzIHRva2VuKSBwdWJsaWM7CgogICAgLy8vQGRldiAqKioqKiBzaW5nbGUgcGF5bWVudCBoYW5kbGluZyAqKioqKgogICAgZnVuY3Rpb24gcGF5bWVudFRvKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHBheW1lbnRGcm9tKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIGFkZHJlc3MgX2Zyb20sIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy9AZGV2ICoqKioqIHN1YnNjcmlwdGlvbiBoYW5kbGluZyAqKioqKgogICAgLy8vQGRldiBzb21lIGZ1bmN0aW9ucyBhcmUgbWFya2VkIGFzIHJlZW50cmFudCwgZXZlbiB0aGVpcnMgaW1wbGVtZW50YXRpb24gaXMgbWFya2VkIHdpdGggbm9SZWVudHJhbmN5KExPQ0spLgogICAgLy8vICAgICBUaGlzIGlzIGludGVudGlvbmFsbHkgYmVjYXVzZSB0aGVzZSBub1JlZW50cmFuY3koTE9DSykgcmVzdHJpY3Rpb25zIGNhbiBiZSBsaWZ0ZWQgaW4gdGhlIGZ1dHVyZS4KICAgIC8vICAgICAgRnVuY3Rpb25zIHdvdWxkIGJlY29tZSByZWVudHJhbnQuCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb24odWludCBfb2ZmZXJJZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX3N0YXJ0T24pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAodWludCBuZXdTdWJJZCk7CiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcmVlbnRyYW50IHB1YmxpYzsKICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpIHJlZW50cmFudCBwdWJsaWM7CiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBleGVjdXRlU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHBvc3Rwb25lRHVlRGF0ZSh1aW50IHN1YklkLCB1aW50IG5ld0R1ZURhdGUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQodWludCBzdWJJZCkgcHVibGljOwogICAgZnVuY3Rpb24gY2xhaW1TdWJzY3JpcHRpb25EZXBvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHN0YXRlKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHN0cmluZyBzdGF0ZSk7CiAgICBmdW5jdGlvbiBzdGF0ZUNvZGUodWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCBzdGF0ZUNvZGUpOwoKICAgIC8vL0BkZXYgKioqKiogc3Vic2NyaXB0aW9uIG9mZmVyIGhhbmRsaW5nICoqKioqCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb25PZmZlcih1aW50IF9wcmljZSwgdWludDE2IF94cmF0ZVByb3ZpZGVySWQsIHVpbnQgX2NoYXJnZVBlcmlvZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX29mZmVyTGltaXQsIHVpbnQgX2RlcG9zaXRWYWx1ZSwgdWludCBfc3RhcnRPbiwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAodWludCBzdWJJZCk7CiAgICBmdW5jdGlvbiB1cGRhdGVTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQsIHVpbnQgX29mZmVyTGltaXQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdW5ob2xkU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKICAgIC8vL0BkZXYgKioqKiogc2ltcGxlIGRlcG9zaXQgaGFuZGxpbmcgKioqKioKICAgIGZ1bmN0aW9uIGNyZWF0ZURlcG9zaXQodWludCBfdmFsdWUsIGJ5dGVzIF9kZXNjcmlwdG9yKSBwdWJsaWMgcmV0dXJucyAodWludCBzdWJJZCk7CiAgICBmdW5jdGlvbiBjbGFpbURlcG9zaXQodWludCBkZXBvc2l0SWQpIHB1YmxpYzsKCiAgICAvLy9AZGV2ICoqKioqIEV4Y2hhbmdlUmF0ZSBwcm92aWRlciAqKioqKgogICAgZnVuY3Rpb24gcmVnaXN0ZXJYUmF0ZVByb3ZpZGVyKFhSYXRlUHJvdmlkZXIgYWRkcikgcHVibGljIHJldHVybnMgKHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQpOwoKICAgIC8vL0BkZXYgKioqKiogU2VydmljZSBwcm92aWRlciAocGF5bWVudCByZWNlaXZlcikgKioqKioKICAgIGZ1bmN0aW9uIGVuYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGRpc2FibGVTZXJ2aWNlUHJvdmlkZXIoU2VydmljZVByb3ZpZGVyIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKSBwdWJsaWM7CgoKICAgIC8vL0BkZXYgKioqKiogY29udmVuaWVuY2Ugc3Vic2NyaXB0aW9uIGdldHRlciAqKioqKgogICAgZnVuY3Rpb24gc3Vic2NyaXB0aW9uRGV0YWlscyh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucygKICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbSwKICAgICAgICBhZGRyZXNzIHRyYW5zZmVyVG8sCiAgICAgICAgdWludCBwcmljZVBlckhvdXIsCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9uLCAvL25vbWluYXRvcgogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfZCwgLy9kZW5vbWluYXRvcgogICAgICAgIHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQsCiAgICAgICAgdWludCBjaGFyZ2VQZXJpb2QsCiAgICAgICAgdWludCBzdGFydE9uLAogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3IKICAgICk7CgogICAgZnVuY3Rpb24gc3Vic2NyaXB0aW9uU3RhdHVzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKAogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudCwKICAgICAgICB1aW50IGV4cGlyZU9uLAogICAgICAgIHVpbnQgZXhlY0NvdW50ZXIsCiAgICAgICAgdWludCBwYWlkVW50aWwsCiAgICAgICAgdWludCBvbkhvbGRTaW5jZQogICAgKTsKCiAgICBlbnVtIFBheW1lbnRTdGF0dXMge09LLCBCQUxBTkNFX0VSUk9SLCBBUFBST1ZBTF9FUlJPUn0KICAgIGV2ZW50IFBheW1lbnQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCB1aW50IF9mZWUsIGFkZHJlc3Mgc2VuZGVyLCBQYXltZW50U3RhdHVzIHN0YXR1cywgdWludCBzdWJJZCk7CiAgICBldmVudCBTZXJ2aWNlUHJvdmlkZXJFbmFibGVkKGFkZHJlc3MgYWRkciwgYnl0ZXMgbW9yZUluZm8pOwogICAgZXZlbnQgU2VydmljZVByb3ZpZGVyRGlzYWJsZWQoYWRkcmVzcyBhZGRyLCBieXRlcyBtb3JlSW5mbyk7Cgp9IC8vU3Vic2NyaXB0aW9uTW9kdWxlCgpjb250cmFjdCBFUkMyME1vZHVsZVN1cHBvcnQgewogICAgZnVuY3Rpb24gX2Z1bGZpbGxQcmVhcHByb3ZlZFBheW1lbnQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIG1zZ19zZW5kZXIpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBfZnVsZmlsbFBheW1lbnQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCB1aW50IHN1YklkLCBhZGRyZXNzIG1zZ19zZW5kZXIpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gX21pbnRGcm9tRGVwb3NpdChhZGRyZXNzIG93bmVyLCB1aW50IGFtb3VudCkgcHVibGljOwogICAgZnVuY3Rpb24gX2J1cm5Gb3JEZXBvc2l0KGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1vdW50KSBwdWJsaWMgcmV0dXJucyhib29sIHN1Y2Nlc3MpOwp9CgovL0BkZXYgaW1wbGVtZW50YXRpb24KY29udHJhY3QgU3Vic2NyaXB0aW9uTW9kdWxlSW1wbCBpcyBTdWJzY3JpcHRpb25Nb2R1bGUsIE93bmVkICB7CgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBWRVJTSU9OID0gIjAuMS4wIjsKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgICAgICBjb250cmFjdCBzdGF0ZXMgICAgICAgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy8vQGRldiBsaXN0IG9mIGFsbCByZWdpc3RlcmVkIHNlcnZpY2UgcHJvdmlkZXIgY29udHJhY3RzIGltcGxlbWVudGVkIGFzIGEgbWFwIGZvciBiZXR0ZXIgbG9va3VwLgogICAgbWFwcGluZyAoYWRkcmVzcz0+Ym9vbCkgcHVibGljIHByb3ZpZGVyUmVnaXN0cnk7CgogICAgLy8vQGRldiBhbGwgc3Vic2NyaXB0aW9ucyBhbmQgb2ZmZXJzIChpbmNsLiBGSU5BTElaRUQpLgogICAgbWFwcGluZyAodWludCA9PiBTdWJzY3JpcHRpb24pIHB1YmxpYyBzdWJzY3JpcHRpb25zOwoKICAgIC8vL0BkZXYgYWxsIGFjdGl2ZSBzaW1wbGUgZGVwb3NpdHMgZ2l2ZWQgYnkgZGVwb3NpdElkLgogICAgbWFwcGluZyAodWludCA9PiBEZXBvc2l0KSBwdWJsaWMgZGVwb3NpdHM7CgogICAgLy8vQGRldiBhZGRyZXNzZXMgb2YgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVycy4KICAgIFhSYXRlUHJvdmlkZXJbXSBwdWJsaWMgeHJhdGVQcm92aWRlcnM7CgogICAgLy8vQGRldiBvbmdvaW5nIGNvdW50ZXIgZm9yIHN1YnNjcmlwdGlvbiBpZHMgc3RhcnRpbmcgZnJvbSAxLgogICAgLy8vICAgICBDdXJyZW50IHZhbHVlIHJlcHJlc2VudHMgYW4gaWQgb2YgbGFzdCBjcmVhdGVkIHN1YnNjcmlwdGlvbi4KICAgIHVpbnQgcHVibGljIHN1YnNjcmlwdGlvbkNvdW50ZXIgPSAwOwoKICAgIC8vL0BkZXYgb25nb2luZyBjb3VudGVyIGZvciBzaW1wbGUgZGVwb3NpdCBpZHMgc3RhcnRpbmcgZnJvbSAxLgogICAgLy8vICAgICBDdXJyZW50IHZhbHVlIHJlcHJlc2VudHMgYW4gaWQgb2YgbGFzdCBjcmVhdGVkIGRlcG9zaXQuCiAgICB1aW50IHB1YmxpYyBkZXBvc2l0Q291bnRlciA9IDA7CgogICAgLy8vQGRldiBUb2tlbiBjb250cmFjdCB3aXRoIEVSQzIwTW9kdWxlU3VwcG9ydCBhZGRvbi4KICAgIC8vLyAgICAgU3Vic2NyaXB0aW9uIE1vZHVsZSBvcGVyYXRlcyBvbiBpdHMgYmFsYW5jZXMgdmlhIEVSQzIwTW9kdWxlU3VwcG9ydCBpbnRlcmZhY2UgYXMgdHJ1c3RlZCBtb2R1bGUuCiAgICBFUkMyME1vZHVsZVN1cHBvcnQgcHVibGljIHNhbjsKCgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgIHJlamVjdCBhbGwgZXRoZXIgc2VudCB0byB0aGlzIGNvbnRyYWN0ICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgICBzZXR1cCBhbmQgY29uZmlndXJhdGlvbiAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvLy9AZGV2IGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBTdWJzY3JpcHRpb25Nb2R1bGVJbXBsKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB4cmF0ZVByb3ZpZGVycy5wdXNoKFhSYXRlUHJvdmlkZXIodGhpcykpOyAvL3RoaXMgaXMgYSBkZWZhdWx0IFNBTjpTQU4gKDE6MSkgcHJvdmlkZXIgd2l0aCBkZWZhdWx0IGlkID09IDAKICAgIH0KCgogICAgLy8vQGRldiBhdHRhY2ggU0FOIHRva2VuIHRvIHdvcmsgd2l0aDsgY2FuIGJlIGRvbmUgb25seSBvbmNlLgogICAgZnVuY3Rpb24gYXR0YWNoVG9rZW4oYWRkcmVzcyB0b2tlbikgcHVibGljIHsKICAgICAgICBhc3NlcnQoYWRkcmVzcyhzYW4pID09IDApOyAvL29ubHkgaW4gbmV3IGRlcGxveWVkIHN0YXRlCiAgICAgICAgc2FuID0gRVJDMjBNb2R1bGVTdXBwb3J0KHRva2VuKTsKICAgIH0KCgogICAgLy8vQGRldiByZWdpc3RlciBhIG5ldyBzZXJ2aWNlIHByb3ZpZGVyIHRvIHRoZSBwbGF0Zm9ybS4KICAgIGZ1bmN0aW9uIGVuYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYyBvbmx5KG93bmVyKSB7CiAgICAgICAgcHJvdmlkZXJSZWdpc3RyeVthZGRyXSA9IHRydWU7CiAgICAgICAgU2VydmljZVByb3ZpZGVyRW5hYmxlZChhZGRyLCBtb3JlSW5mbyk7CiAgICB9CgoKICAgIC8vL0BkZXYgZGUtcmVnaXN0ZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgd2l0aCBnaXZlbiBgYWRkcmAuCiAgICBmdW5jdGlvbiBkaXNhYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljIG9ubHkob3duZXIpIHsKICAgICAgICBkZWxldGUgcHJvdmlkZXJSZWdpc3RyeVthZGRyXTsKICAgICAgICBTZXJ2aWNlUHJvdmlkZXJEaXNhYmxlZChhZGRyLCBtb3JlSW5mbyk7CiAgICB9CgoKICAgIC8vL0BkZXYgcmVnaXN0ZXIgbmV3IGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIuCiAgICAvLy8gICAgIFhSYXRlUHJvdmlkZXIgY2FuJ3QgYmUgZGUtcmVnaXN0ZXJlZCwgYmVjYXVzZSB0aGV5IGNvdWxkIGJlIHN0aWxsIGluIHVzZSBieSBzb21lIHN1YnNjcmlwdGlvbi4KICAgIGZ1bmN0aW9uIHJlZ2lzdGVyWFJhdGVQcm92aWRlcihYUmF0ZVByb3ZpZGVyIGFkZHIpIHB1YmxpYyBvbmx5KG93bmVyKSByZXR1cm5zICh1aW50MTYgeHJhdGVQcm92aWRlcklkKSB7CiAgICAgICAgeHJhdGVQcm92aWRlcklkID0gdWludDE2KHhyYXRlUHJvdmlkZXJzLmxlbmd0aCk7CiAgICAgICAgeHJhdGVQcm92aWRlcnMucHVzaChhZGRyKTsKICAgICAgICBOZXdYUmF0ZVByb3ZpZGVyKGFkZHIsIHhyYXRlUHJvdmlkZXJJZCwgbXNnLnNlbmRlcik7CiAgICB9CgoKICAgIC8vL0BkZXYgeHJhdGVQcm92aWRlcnMgbGVuZ3RoIGFjY2Vzc29yLgogICAgZnVuY3Rpb24gZ2V0WFJhdGVQcm92aWRlckxlbmd0aCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHhyYXRlUHJvdmlkZXJzLmxlbmd0aDsKICAgIH0KCgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgICAgICAgc2luZ2xlIHBheW1lbnQgbWV0aG9kcyAgICAgICAgICAgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vL0Bub3RpY2UgbWFrZXMgc2luZ2xlIHBheW1lbnQgdG8gc2VydmljZSBwcm92aWRlci4KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgU0FOIHRva2VuIHRvIHNlbnQKICAgIC8vL0BwYXJhbSBfcGF5bWVudERhdGEgLSAncGF5bWVudCBwdXJwb3NlJyBjb2RlIHVzdWFsbHkgaXNzdWVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gY3VzdG9tZXIgYmVmb3JlIHBheW1lbnQuCiAgICAvLy9AcGFyYW0gX3RvIC0gc2VydmljZSBwcm92aWRlciBjb250cmFjdAogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gcGF5bWVudFRvKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKHNhbi5fZnVsZmlsbFBheW1lbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIDAsIG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgIC8vIGEgU2VydmljZVByb3ZpZGVyIChhIFNlcnZpY2VQcm92aWRlcikgaGFzIGhlcmUgYW4gb3Bwb3J0dW5pdHkgdmVyaWZ5IGFuZCByZWplY3QgdGhlIHBheW1lbnQKICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblBheW1lbnQobXNnLnNlbmRlciwgX3ZhbHVlLCBfcGF5bWVudERhdGEpKTsgICAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBtYWtlcyBzaW5nbGUgcHJlYXBwcm92ZWQgcGF5bWVudCB0byBzZXJ2aWNlIHByb3ZpZGVyLiBBbiBhbW91bnQgbXVzdCBiZSBhbHJlYWR5IHByZWFwcHJvdmVkIGJ5IHBheW1lbnQgc2VuZGVyIHRvIHJlY2VwaWVudC4KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgU0FOIHRva2VuIHRvIHNlbnQKICAgIC8vL0BwYXJhbSBfcGF5bWVudERhdGEgLSAncGF5bWVudCBwdXJwb3NlJyBjb2RlIHVzdWFsbHkgaXNzdWVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gY3VzdG9tZXIgYmVmb3JlIHBheW1lbnQuCiAgICAvLy9AcGFyYW0gX2Zyb20gLSBzZW5kZXIgb2YgdGhlIHBheW1lbnQgKG90aGVyIHRoYW4gbXNnLnNlbmRlcikKICAgIC8vL0BwYXJhbSBfdG8gLSBzZXJ2aWNlIHByb3ZpZGVyIGNvbnRyYWN0CiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBwYXltZW50RnJvbSh1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhLCBhZGRyZXNzIF9mcm9tLCBTZXJ2aWNlUHJvdmlkZXIgX3RvKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChzYW4uX2Z1bGZpbGxQcmVhcHByb3ZlZFBheW1lbnQoX2Zyb20sIF90bywgX3ZhbHVlLCBtc2cuc2VuZGVyKSkgewogICAgICAgICAgICAvLyBhIFNlcnZpY2VQcm92aWRlciAoYSBTZXJ2aWNlUHJvdmlkZXIpIGhhcyBoZXJlIGFuIG9wcG9ydHVuaXR5IHZlcmlmeSBhbmQgcmVqZWN0IHRoZSBwYXltZW50CiAgICAgICAgICAgIGFzc2VydCAoU2VydmljZVByb3ZpZGVyKF90bykub25QYXltZW50KF9mcm9tLCBfdmFsdWUsIF9wYXltZW50RGF0YSkpOyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgICBzdWJzY3JpcHRpb24gaGFuZGxpbmcgICAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvLy9AZGV2IGNvbnZlbmllbmNlIGdldHRlciBmb3Igc29tZSBzdWJzY3JpcHRpb24gZmllbGRzCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25EZXRhaWxzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICgKICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbSwKICAgICAgICBhZGRyZXNzIHRyYW5zZmVyVG8sCiAgICAgICAgdWludCBwcmljZVBlckhvdXIsCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9uLCAvL25vbWluYXRvcgogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfZCwgLy9kZW5vbWluYXRvcgogICAgICAgIHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQsCiAgICAgICAgdWludCBjaGFyZ2VQZXJpb2QsCiAgICAgICAgdWludCBzdGFydE9uLAogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3IKICAgICkgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICByZXR1cm4gKHN1Yi50cmFuc2ZlckZyb20sIHN1Yi50cmFuc2ZlclRvLCBzdWIucHJpY2VQZXJIb3VyLCBzdWIuaW5pdGlhbFhyYXRlX24sIHN1Yi5pbml0aWFsWHJhdGVfZCwgc3ViLnhyYXRlUHJvdmlkZXJJZCwgc3ViLmNoYXJnZVBlcmlvZCwgc3ViLnN0YXJ0T24sIHN1Yi5kZXNjcmlwdG9yKTsKICAgIH0KCgogICAgLy8vQGRldiBjb252ZW5pZW5jZSBnZXR0ZXIgZm9yIHNvbWUgc3Vic2NyaXB0aW9uIGZpZWxkcwogICAgLy8vICAgICBhIGNhbGxlciBtdXN0IGtub3csIHRoYXQgdGhlIHN1YnNjcmlwdGlvbiB3aXRoIGdpdmVuIGlkIGV4aXN0cywgYmVjYXVzZSBhbGwgdGhlc2UgZmllbGRzIGNhbiBiZSAwIGV2ZW4gdGhlIHN1YnNjcmlwdGlvbiB3aXRoIGdpdmVuIGlkIGV4aXN0cy4KICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvblN0YXR1cyh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucygKICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQsCiAgICAgICAgdWludCBleHBpcmVPbiwKICAgICAgICB1aW50IGV4ZWNDb3VudGVyLAogICAgICAgIHVpbnQgcGFpZFVudGlsLAogICAgICAgIHVpbnQgb25Ib2xkU2luY2UKICAgICkgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICByZXR1cm4gKHN1Yi5kZXBvc2l0QW1vdW50LCBzdWIuZXhwaXJlT24sIHN1Yi5leGVjQ291bnRlciwgc3ViLnBhaWRVbnRpbCwgc3ViLm9uSG9sZFNpbmNlKTsKICAgIH0KCgogICAgLy8vQG5vdGljZSBleGVjdXRlIHBlcmlvZGljIHN1YnNjcmlwdGlvbiBwYXltZW50LgogICAgLy8vICAgICAgICBBbnkgb2YgY3VzdG9tZXIsIHNlcnZpY2UgcHJvdmlkZXIgYW5kIHBsYXRmb3JtIG93bmVyIGNhbiBleGVjdXRlIHRoaXMgZnVuY3Rpb24uCiAgICAvLy8gICAgICAgIFRoaXMgZW5zdXJlcywgdGhhdCB0aGUgc3Vic2NyaXB0aW9uIGNoYXJnZSBkb2Vzbid0IGJlY29tZSBkZWxheWVkLgogICAgLy8vICAgICAgICBBdCBsZWFzdCB0aGUgcGxhdGZvcm0gb3duZXIgaGFzIGFuIGluY2VudGl2ZSB0byBnZXQgZmVlIGFuZCB0aHVzIGNhbiB0cmlnZ2VyIHRoZSBmdW5jdGlvbi4KICAgIC8vLyAgICAgICAgQW4gZXhlY3V0aW9uIGZhaWxzIGlmIHN1YnNjcmlwdGlvbiBpcyBub3QgaW4gc3RhdHVzIGBDSEFSR0VBQkxFYC4KICAgIC8vL0BwYXJhbSBzdWJJZCAtIHN1YnNjcmlwdGlvbiB0byBiZSBjaGFyZ2VkLgogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gZXhlY3V0ZVN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgbm9SZWVudHJhbmN5KEwwMCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAobXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJGcm9tIHx8IG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyVG8gfHwgbXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgaWYgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpPT1TdWJTdGF0ZS5DSEFSR0VBQkxFKSB7CiAgICAgICAgICAgIHZhciBfZnJvbSA9IHN1Yi50cmFuc2ZlckZyb207CiAgICAgICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsKICAgICAgICAgICAgdmFyIF92YWx1ZSA9IF9hbW91bnRUb0NoYXJnZShzdWIpOwogICAgICAgICAgICBpZiAoc2FuLl9mdWxmaWxsUGF5bWVudChfZnJvbSwgX3RvLCBfdmFsdWUsIHN1YklkLCBtc2cuc2VuZGVyKSkgewogICAgICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCAgPSBtYXgoc3ViLnBhaWRVbnRpbCwgc3ViLnN0YXJ0T24pICsgc3ViLmNoYXJnZVBlcmlvZDsKICAgICAgICAgICAgICAgICsrc3ViLmV4ZWNDb3VudGVyOwogICAgICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB0byB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudAogICAgICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblN1YkV4ZWN1dGVkKHN1YklkKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBtb3ZlIGBwYWlkVW50aWxgIGZvcndhcmQgdG8gZ2l2ZW4gYG5ld0R1ZURhdGVgLiBJdCB3YWl2ZXMgcGF5bWVudHMgZm9yIGdpdmVuIHRpbWUuCiAgICAvLy8gICAgICAgIFRoaXMgZnVuY3Rpb24gY2FuIGJlIHVzZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBgZ2l2ZSBhd2F5YCBzb21lIHNlcnZpY2UgdGltZSBmb3IgZnJlZS4KICAgIC8vL0BwYXJhbSBzdWJJZCAtIGlkIG9mIHN1YnNjcmlwdGlvbiB0byBiZSBwb3N0cG9uZWQuCiAgICAvLy9AcGFyYW0gbmV3RHVlRGF0ZSAtIG5ldyBgcGFpZFVudGlsYCBkYXRldGltZTsgcmVxdWlyZSBgbmV3RHVlRGF0ZSA+IHBhaWRVbnRpbGAuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBwb3N0cG9uZUR1ZURhdGUodWludCBzdWJJZCwgdWludCBuZXdEdWVEYXRlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKXsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsKICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIpOyAvL29ubHkgU2VydmljZSBQcm92aWRlciBpcyBhbGxvd2VkIHRvIHBvc3Rwb25lIHRoZSBEdWVEYXRlCiAgICAgICAgaWYgKHN1Yi5wYWlkVW50aWwgPCBuZXdEdWVEYXRlKSB7CiAgICAgICAgICAgIHN1Yi5wYWlkVW50aWwgPSBuZXdEdWVEYXRlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQGRldiByZXR1cm4gY3VycmVudCBzdGF0dXMgYXMgYSBuYW1lIG9mIGEgc3Vic2NyaXB0aW9uIChvciBhbiBvZmZlcikgd2l0aCBnaXZlbiBpZDsKICAgIGZ1bmN0aW9uIHN0YXRlKHVpbnQgc3ViT3JPZmZlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcgc3RhdGUpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3ViT3JPZmZlciA9IHN1YnNjcmlwdGlvbnNbc3ViT3JPZmZlcklkXTsKICAgICAgICByZXR1cm4gX2lzT2ZmZXIoc3ViT3JPZmZlcikKICAgICAgICAgICAgICA/IE9GRkVSX1NUQVRFU1t1aW50KF9vZmZlclN0YXRlKHN1Yk9yT2ZmZXIpKV0KICAgICAgICAgICAgICA6IFNVQl9TVEFURVNbdWludChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViT3JPZmZlcikpXTsKICAgIH0KCgogICAgLy8vQGRldiByZXR1cm4gY3VycmVudCBzdGF0dXMgYXMgYSBjb2RlIG9mIGEgc3Vic2NyaXB0aW9uIChvciBhbiBvZmZlcikgd2l0aCBnaXZlbiBpZDsKICAgIGZ1bmN0aW9uIHN0YXRlQ29kZSh1aW50IHN1Yk9yT2ZmZXJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCBzdGF0ZUNvZGUpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3ViT3JPZmZlciA9IHN1YnNjcmlwdGlvbnNbc3ViT3JPZmZlcklkXTsKICAgICAgICByZXR1cm4gX2lzT2ZmZXIoc3ViT3JPZmZlcikKICAgICAgICAgICAgICA/IHVpbnQoX29mZmVyU3RhdGUoc3ViT3JPZmZlcikpCiAgICAgICAgICAgICAgOiB1aW50KF9zdWJzY3JpcHRpb25TdGF0ZShzdWJPck9mZmVyKSk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9vZmZlclN0YXRlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhPZmZlclN0YXRlIHN0YXR1cykgewogICAgICAgIGlmICghX2lzT2ZmZXIoc3ViKSkgewogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5OT1RfRVhJU1Q7CiAgICAgICAgfSBlbHNlIGlmIChzdWIuc3RhcnRPbiA+IG5vdykgewogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5CRUZPUkVfU1RBUlQ7CiAgICAgICAgfSBlbHNlIGlmIChzdWIub25Ib2xkU2luY2UgPiAwKSB7CiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLk9OX0hPTEQ7CiAgICAgICAgfSBlbHNlIGlmIChub3cgPD0gc3ViLmV4cGlyZU9uKSB7CiAgICAgICAgICAgIHJldHVybiBzdWIuZXhlY0NvdW50ZXIgPiAwCiAgICAgICAgICAgICAgICA/IE9mZmVyU3RhdGUuQUNUSVZFCiAgICAgICAgICAgICAgICA6IE9mZmVyU3RhdGUuU09MRF9PVVQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuRVhQSVJFRDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX3N1YnNjcmlwdGlvblN0YXRlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhTdWJTdGF0ZSBzdGF0dXMpIHsKICAgICAgICBpZiAoIV9pc1N1YnNjcmlwdGlvbihzdWIpKSB7CiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5OT1RfRVhJU1Q7CiAgICAgICAgfSBlbHNlIGlmIChzdWIuc3RhcnRPbiA+IG5vdykgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuQkVGT1JFX1NUQVJUOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuT05fSE9MRDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi5wYWlkVW50aWwgPj0gc3ViLmV4cGlyZU9uKSB7CiAgICAgICAgICAgIHJldHVybiBub3cgPCBzdWIuZXhwaXJlT24KICAgICAgICAgICAgICAgID8gU3ViU3RhdGUuQ0FOQ0VMRUQKICAgICAgICAgICAgICAgIDogc3ViLmRlcG9zaXRBbW91bnQgPiAwCiAgICAgICAgICAgICAgICAgICAgPyBTdWJTdGF0ZS5FWFBJUkVECiAgICAgICAgICAgICAgICAgICAgOiBTdWJTdGF0ZS5GSU5BTElaRUQ7CiAgICAgICAgfSBlbHNlIGlmIChzdWIucGFpZFVudGlsIDw9IG5vdykgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuQ0hBUkdFQUJMRTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuUEFJRDsKICAgICAgICB9CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY3JlYXRlIGEgbmV3IHN1YnNjcmlwdGlvbiBvZmZlci4KICAgIC8vL0BkZXYgb25seSByZWdpc3RlcmVkIHNlcnZpY2UgcHJvdmlkZXIgaXMgYWxsb3dlZCB0byBjcmVhdGUgb2ZmZXJzLgogICAgLy8vQGRldiBzdWJzY3JpcHRpb24gdXNlcyBTQU4gdG9rZW4gZm9yIHBheW1lbnQsIGJ1dCBhbiBleGFjdCBhbW91bnQgdG8gYmUgcGFpZCBvciBkZXBvc2l0IGlzIGNhbGN1bGF0ZWQgdXNpbmcgZXhjaGFuZ2UgcmF0ZSBmcm9tIGV4dGVybmFsIHhyYXRlUHJvdmlkZXIgKHByZXZpb3NseSByZWdpc3RlcmVkIG9uIHBsYXRmb3JtKS4KICAgIC8vLyAgICBUaGlzIGFsbG93cyB0byBjcmVhdGUgYSBzdWJzY3JpcHRpb24gYm91bmQgdG8gYW5vdGhlciB0b2tlbiBvciBldmVuIGZpYXQgY3VycmVuY3kuCiAgICAvLy9AcGFyYW0gX3ByaWNlUGVySG91ciAtIHN1YnNjcmlwdGlvbiBwcmljZSBwZXIgaG91ciBpbiBTQU4KICAgIC8vL0BwYXJhbSBfeHJhdGVQcm92aWRlcklkIC0gaWQgb2YgZXh0ZXJuYWwgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlciBmcm9tIHN1YnNjcmlwdGlvbiBjdXJyZW5jeSB0byBTQU47ICIwIiBtZWFucyBzdWJzY3JpcHRpb24gaXMgcHJpY2VkIGluIFNBTiBuYXRpdmVseS4KICAgIC8vL0BwYXJhbSBfY2hhcmdlUGVyaW9kIC0gdGltZSBwZXJpb2QgdG8gY2hhcmdlOyBzdWJzY3JpcHRpb24gY2FuJ3QgYmUgY2hhcmdlZCBtb3JlIG9mdGVuIHRoYW4gdGhpcyBwZXJpb2QuIFRpbWUgdW5pdHMgYXJlIG5hdGl2ZSBldGhlcmV1bSB0aW1lLCByZXR1cm5pbmcgYnkgYG5vd2AsIGkuZS4gc2Vjb25kcy4KICAgIC8vL0BwYXJhbSBfZXhwaXJlT24gLSBvZmZlciBjYW4ndCBiZSBhY2NlcHRlZCBhZnRlciB0aGlzIHRpbWUuCiAgICAvLy9AcGFyYW0gX29mZmVyTGltaXQgLSBob3cgbWFueSBzdWJzY3JpcHRpb24gYXJlIGF2YWlsYWJsZSB0byBjcmVhdGVkIGZyb20gdGhpcyBvZmZlcjsgdGhlcmUgaXMgbm8gbWFnaWMgbnVtYmVyIGZvciB1bmxpbWl0ZWQgb2ZmZXIgLS0gdXNlIGJpZyBudW1iZXIgaW5zdGVhZC4KICAgIC8vL0BwYXJhbSBfZGVwb3NpdEFtb3VudCAtIHVwZnJvbnQgZGVwb3NpdCByZXF1aXJlZCBmb3IgY3JlYXRpbmcgYSBzdWJzY3JpcHRpb247IHRoaXMgZGVwb3NpdCBiZWNvbWVzIGZ1bGx5IHJldHVybmVkIG9uIHN1YnNjcmlwdGlvbiBpcyBvdmVyLgogICAgLy8vICAgICAgIGN1cnJlbnRseSB0aGlzIGRlcG9zaXQgaXMgbm90IHN1YmplY3Qgb2YgcGxhdGZvcm0gZmVlcyBhbmQgd2lsbCBiZSByZWZ1bmRlZCBpbiBmdWxsLiBOZXh0IHZlcnNpb25zIG9mIHRoaXMgbW9kdWxlIGNhbiB1c2UgZGVwb3NpdCBpbiBjYXNlIG9mIG91dHN0YW5kaW5nIHBheW1lbnRzLgogICAgLy8vQHBhcmFtIF9zdGFydE9uIC0gYSBzdWJzY3JpcHRpb24gZnJvbSB0aGlzIG9mZmVyIGNhbid0IGJlIGNyZWF0ZWQgYmVmb3JlIHRoaXMgdGltZS4gVGltZSB1bml0cyBhcmUgbmF0aXZlIGV0aGVyZXVtIHRpbWUsIHJldHVybmluZyBieSBgbm93YCwgaS5lLiBzZWNvbmRzLgogICAgLy8vQHBhcmFtIF9kZXNjcmlwdG9yIC0gYXJiaXRyYXJ5IGJ5dGVzIGFzIGFuIG9mZmVyIGRlc2NyaXB0b3IuIFRoaXMgZGVzY3JpcHRvciBpcyBjb3BpZWQgaW50byBzdWJzY3JpcHRpb24gYW5kIHRoZW4gc2VydmljZSBwcm92aWRlciBiZWNvbWVzIGl0IHBhc3NlZCBpbiBub3RpZmljYXRpb25zLgogICAgLy8KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX3ByaWNlUGVySG91ciwgdWludDE2IF94cmF0ZVByb3ZpZGVySWQsIHVpbnQgX2NoYXJnZVBlcmlvZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX29mZmVyTGltaXQsIHVpbnQgX2RlcG9zaXRBbW91bnQsIHVpbnQgX3N0YXJ0T24sIGJ5dGVzIF9kZXNjcmlwdG9yKQogICAgcHVibGljCiAgICBub1JlZW50cmFuY3koTDAxKQogICAgb25seVJlZ2lzdGVyZWRQcm92aWRlcgogICAgcmV0dXJucyAodWludCBzdWJJZCkgewogICAgICAgIGFzc2VydCAoX3N0YXJ0T24gPCBfZXhwaXJlT24pOwogICAgICAgIGFzc2VydCAoX2NoYXJnZVBlcmlvZCA8PSAxMCB5ZWFycyk7IC8vc2FuaXR5IGNoZWNrCiAgICAgICAgdmFyIChfeHJhdGVfbiwgX3hyYXRlX2QpID0gX3hyYXRlUHJvdmlkZXJJZCA9PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gKDEsMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBYUmF0ZVByb3ZpZGVyKHhyYXRlUHJvdmlkZXJzW194cmF0ZVByb3ZpZGVySWRdKS5nZXRSYXRlKCk7IC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgIGFzc2VydCAoX3hyYXRlX24gPiAwICYmIF94cmF0ZV9kID4gMCk7CiAgICAgICAgc3Vic2NyaXB0aW9uc1srK3N1YnNjcmlwdGlvbkNvdW50ZXJdID0gU3Vic2NyaXB0aW9uICh7CiAgICAgICAgICAgIHRyYW5zZmVyRnJvbSAgICA6IDAsICAgICAgICAgICAgICAgICAgLy8gZW1wdHkgdHJhbnNmZXJGcm9tIGZpZWxkIG1lYW5zIHdlIGhhdmUgYW4gb2ZmZXIsIG5vdCBhIHN1YnNjcmlwdGlvbgogICAgICAgICAgICB0cmFuc2ZlclRvICAgICAgOiBtc2cuc2VuZGVyLCAgICAgICAgIC8vIHNlcnZpY2UgcHJvdmlkZXIgaXMgYSBiZW5lZmljaWFyeSBvZiBzdWJzY3JpcHRvbiBwYXltZW50cwogICAgICAgICAgICBwcmljZVBlckhvdXIgICAgOiBfcHJpY2VQZXJIb3VyLCAgICAgIC8vIHByaWNlIHBlciBob3VyIGluIFNBTiAocmVjYWxjdWxhdGVkIGZyb20gYmFzZSBjdXJyZW5jeSBpZiBuZWVkZWQpCiAgICAgICAgICAgIHhyYXRlUHJvdmlkZXJJZCA6IF94cmF0ZVByb3ZpZGVySWQsICAgLy8gaWQgb2YgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVyIG9yIHplcm8gaWYgYW4gb2ZmZXIgaXMgbm9taW5hdGVkIGluIFNBTi4KICAgICAgICAgICAgaW5pdGlhbFhyYXRlX24gIDogX3hyYXRlX24sICAgICAgICAgICAvLyBmcmFjdGlvbiBub21pbmF0b3Igb2YgdGhlIGluaXRpYWwgZXhjaGFuZ2UgcmF0ZQogICAgICAgICAgICBpbml0aWFsWHJhdGVfZCAgOiBfeHJhdGVfZCwgICAgICAgICAgIC8vIGZyYWN0aW9uIGRlbm9taW5hdG9yIG9mIHRoZSBpbml0aWFsIGV4Y2hhbmdlIHJhdGUKICAgICAgICAgICAgcGFpZFVudGlsICAgICAgIDogMCwgICAgICAgICAgICAgICAgICAvLyBzZXJ2aWNlIGlzIGNvbnNpZGVyZWQgdG8gYmUgcGFpZCB1bnRpbCB0aGlzIHRpbWU7IG5vIGNoYXJnZSBpcyBwb3NzaWJsZSB3aGlsZSBzdWJzY3JpcHRpb24gaXMgcGFpZCBmb3Igbm93LgogICAgICAgICAgICBjaGFyZ2VQZXJpb2QgICAgOiBfY2hhcmdlUGVyaW9kLCAgICAgIC8vIHBlcmlvZCBpbiBzZWNvbmRzIChldGhlcmV1bSBibG9jayB0aW1lIHVuaXQpIHRvIGNoYXJnZS4KICAgICAgICAgICAgZGVwb3NpdEFtb3VudCAgIDogX2RlcG9zaXRBbW91bnQsICAgICAvLyBkZXBvc2l0IHJlcXVpcmVkIGZvciBzdWJzY3JpcHRpb24gYWNjZXB0LgogICAgICAgICAgICBzdGFydE9uICAgICAgICAgOiBfc3RhcnRPbiwKICAgICAgICAgICAgZXhwaXJlT24gICAgICAgIDogX2V4cGlyZU9uLAogICAgICAgICAgICBleGVjQ291bnRlciAgICAgOiBfb2ZmZXJMaW1pdCwKICAgICAgICAgICAgZGVzY3JpcHRvciAgICAgIDogX2Rlc2NyaXB0b3IsCiAgICAgICAgICAgIG9uSG9sZFNpbmNlICAgICA6IDAgICAgICAgICAgICAgICAgICAgLy8gb2ZmZXIgaXMgbm90IG9uIGhvbGQgYnkgZGVmYXVsdC4KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uQ291bnRlcjsgICAgICAgICAgICAgICAvLyByZXR1cm5zIGFuIGlkIG9mIHRoZSBuZXcgb2ZmZXIuCiAgICB9CgoKICAgIC8vL0Bub3RpY2UgdXBkYXRlcyBjdXJyZW50bHkgYXZhaWxhYmxlIG51bWJlciBvZiBzdWJzY3JpcHRpb24gZm9yIHRoaXMgb2ZmZXIuCiAgICAvLy8gICAgICAgIE90aGVyIG9mZmVyJ3MgcGFyYW1ldGVyIGNhbid0IGJlIHVwZGF0ZWQgYmVjYXVzZSB0aGV5IGFyZSBjb25zaWRlcmVkIHRvIGJlIGEgcHVibGljIG9mZmVyIHJldmlld2VkIGJ5IGN1c3RvbWVycy4KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgc2hvdWxkIHJlY3JlYXRlIHRoZSBvZmZlciBhcyBhIG5ldyBvbmUgaW4gY2FzZSBvZiBvdGhlciBjaGFuZ2VzLgogICAgLy8KICAgIGZ1bmN0aW9uIHVwZGF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX29mZmVySWQsIHVpbnQgX29mZmVyTGltaXQpIHB1YmxpYyB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW19vZmZlcklkXTsKICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7CiAgICAgICAgYXNzZXJ0IChvZmZlci50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIpOyAvL29ubHkgUHJvdmlkZXIgaXMgYWxsb3dlZCB0byB1cGRhdGUgdGhlIG9mZmVyLgogICAgICAgIG9mZmVyLmV4ZWNDb3VudGVyID0gX29mZmVyTGltaXQ7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgYWNjZXB0IGdpdmVuIG9mZmVyIGFuZCBjcmVhdGUgYSBuZXcgc3Vic2NyaXB0aW9uIG9uIHRoZSBiYXNlIG9mIGl0LgogICAgLy8vCiAgICAvLy9AZGV2IHRoZSBzZXJ2aWNlIHByb3ZpZGVyIChvZmZlci5gdHJhbnNmZXJUb2ApIGJlY29tZXMgbm90aWZpZWQgYWJvdXQgbmV3IHN1YnNjcmlwdGlvbiBieSBjYWxsIGBvblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpYC4KICAgIC8vLyAgICAgSXQgaXMgcHJvdmlkZXIncyByZXNwb25zaWJpbGl0eSB0byByZXRyaWV2ZSBhbmQgc3RvcmUgYW55IG5lY2Vzc2FyeSBpbmZvcm1hdGlvbiBhYm91dCBvZmZlciBhbmQgdGhpcyBuZXcgc3Vic2NyaXB0aW9uLiBTb21lIG9mIGluZm8gaXMgb25seSBhdmFpbGFibGUgYXQgdGhpcyBwb2ludC4KICAgIC8vLyAgICAgVGhlIFNlcnZpY2UgUHJvdmlkZXIgY2FuIGFsc28gcmVqZWN0IHRoZSBuZXcgc3Vic2NyaXB0aW9uIGJ5IHRocm93aW5nIGFuIGV4Y2VwdGlvbiBvciByZXR1cm5pbmcgYGZhbHNlYCBmcm9tIGBvblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpYCBldmVudCBoYW5kbGVyLgogICAgLy8vQHBhcmFtIF9vZmZlcklkICAgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgYWNjZXB0ZWQKICAgIC8vL0BwYXJhbSBfZXhwaXJlT24gIC0gc3Vic2NyaXB0aW9uIGV4cGlyYXRpb24gdGltZTsgbm8gY2hhcmdlcyBhcmUgcG9zc2libGUgYmVoaW5kIHRoaXMgdGltZS4KICAgIC8vL0BwYXJhbSBfc3RhcnRPbiAgIC0gc3Vic2NyaXB0aW9uIHN0YXJ0IHRpbWU7IG5vIGNoYXJnZXMgYXJlIHBvc3NpYmxlIGJlZm9yZSB0aGlzIHRpbWUuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgIElmIHRoZSBgX3N0YXJ0T25gIGlzIGluIHRoZSBwYXN0IG9yIGlzIHplcm8sIGl0IG1lYW5zIHN0YXJ0IHRoZSBzdWJzY3JpcHRpb24gQVNBUC4KICAgIC8vCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb24odWludCBfb2ZmZXJJZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX3N0YXJ0T24pIHB1YmxpYyBub1JlZW50cmFuY3koTDAyKSByZXR1cm5zICh1aW50IG5ld1N1YklkKSB7CiAgICAgICAgYXNzZXJ0IChfc3RhcnRPbiA8IF9leHBpcmVPbik7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW19vZmZlcklkXTsKICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7CiAgICAgICAgYXNzZXJ0IChvZmZlci5zdGFydE9uID09IDAgICAgIHx8IG9mZmVyLnN0YXJ0T24gIDw9IG5vdyk7CiAgICAgICAgYXNzZXJ0IChvZmZlci5leHBpcmVPbiA9PSAwICAgIHx8IG9mZmVyLmV4cGlyZU9uID49IG5vdyk7CiAgICAgICAgYXNzZXJ0IChvZmZlci5vbkhvbGRTaW5jZSA9PSAwKTsKICAgICAgICBhc3NlcnQgKG9mZmVyLmV4ZWNDb3VudGVyID4gMCk7CiAgICAgICAgLS1vZmZlci5leGVjQ291bnRlcjsKICAgICAgICBuZXdTdWJJZCA9ICsrc3Vic2NyaXB0aW9uQ291bnRlcjsKICAgICAgICAvL2NyZWF0ZSBhIGNsb25lIG9mIHRoZSBvZmZlci4uLgogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG5ld1N1YiA9IHN1YnNjcmlwdGlvbnNbbmV3U3ViSWRdID0gb2ZmZXI7CiAgICAgICAgLy8uLi4gYW5kIGFkanVzdCBzb21lIGZpZWxkcyBzcGVjaWZpYyB0byBzdWJzY3JpcHRpb24KICAgICAgICBuZXdTdWIudHJhbnNmZXJGcm9tID0gbXNnLnNlbmRlcjsKICAgICAgICBuZXdTdWIuZXhlY0NvdW50ZXIgPSAwOwogICAgICAgIG5ld1N1Yi5wYWlkVW50aWwgPSBuZXdTdWIuc3RhcnRPbiA9IG1heChfc3RhcnRPbiwgbm93KTsgICAgIC8vbm8gZGVidHMgYmVmb3JlIGFjdHVhbCBjcmVhdGlvbiB0aW1lIQogICAgICAgIG5ld1N1Yi5leHBpcmVPbiA9IF9leHBpcmVPbjsKICAgICAgICBuZXdTdWIuZGVwb3NpdEFtb3VudCA9IF9hcHBseVhjaGFuZ2VSYXRlKG5ld1N1Yi5kZXBvc2l0QW1vdW50LCBuZXdTdWIpOyAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgLy9kZXBvc2l0QW1vdW50IGlzIG5vdyBzdG9yZWQgaW4gdGhlIHN1Yiwgc28gYnVybiB0aGUgc2FtZSBhbW91bnQgZnJvbSBjdXN0b21lcidzIGFjY291bnQuCiAgICAgICAgYXNzZXJ0IChzYW4uX2J1cm5Gb3JEZXBvc2l0KG1zZy5zZW5kZXIsIG5ld1N1Yi5kZXBvc2l0QW1vdW50KSk7CiAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIobmV3U3ViLnRyYW5zZmVyVG8pLm9uU3ViTmV3KG5ld1N1YklkLCBfb2ZmZXJJZCkpOyAgICAgICAgICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeTsgc2VydmljZSBwcm92aWRlciBjYW4gc3RpbGwgcmVqZWN0IHRoZSBuZXcgc3Vic2NyaXB0aW9uIGhlcmUKCiAgICAgICAgTmV3U3Vic2NyaXB0aW9uKG5ld1N1Yi50cmFuc2ZlckZyb20sIG5ld1N1Yi50cmFuc2ZlclRvLCBfb2ZmZXJJZCwgbmV3U3ViSWQpOwogICAgICAgIHJldHVybiBuZXdTdWJJZDsKICAgIH0KCgogICAgLy8vQG5vdGljZSBjYW5jZWwgYW4gb2ZmZXIgZ2l2ZW4gYnkgYG9mZmVySWRgLgogICAgLy8vQGRldiBzZXRzIG9mZmVyLmBleHBpcmVPbmAgdG8gYGV4cGlyZU9uYC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOwogICAgICAgIGFzc2VydCAob2ZmZXIudHJhbnNmZXJUbyA9PSBtc2cuc2VuZGVyIHx8IG93bmVyID09IG1zZy5zZW5kZXIpOyAvL29ubHkgc2VydmljZSBwcm92aWRlciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIGNhbmNlbCB0aGUgb2ZmZXIKICAgICAgICBpZiAob2ZmZXIuZXhwaXJlT24+bm93KXsKICAgICAgICAgICAgb2ZmZXIuZXhwaXJlT24gPSBub3c7CiAgICAgICAgICAgIE9mZmVyQ2FuY2VsZWQob2ZmZXJJZCwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBjYW5jZWwgYW4gc3Vic2NyaXB0aW9uIGdpdmVuIGJ5IGBzdWJJZGAgKGEgZ3JhY2VmdWwgdmVyc2lvbikuCiAgICAvLy9Abm90aWNlIElNUE9SVEFOVDogYSBtYWxpY2lvdXMgc2VydmljZSBwcm92aWRlciBjYW4gY29uc3VtZSBhbGwgZ2FzIGFuZCBwcmV2ZW50aW5nIHN1YnNjcmlwdGlvbiBmcm9tIGNhbmNlbGxhdGlvbi4KICAgIC8vLyAgICAgICAgSWYgc28sIHVzZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGFzIHRoZSBmb3JjZWQgdmVyc2lvbi4KICAgIC8vLyAgICAgICAgIHNlZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGZvciBtb3JlIGRvY3VtZW50YXRpb24uCiAgICAvLwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyB7CiAgICAgICAgcmV0dXJuIGNhbmNlbFN1YnNjcmlwdGlvbihzdWJJZCwgMCk7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY2FuY2VsIGFuIHN1YnNjcmlwdGlvbiBnaXZlbiBieSBgc3ViSWRgIChhIGZvcmNlZCB2ZXJzaW9uKS4KICAgIC8vLyAgICAgICAgQ2FuY2VsbGF0aW9uIG1lYW5zIG5vIGZ1cnRoZXIgY2hhcmdlcyB0byB0aGlzIHN1YnNjcmlwdGlvbiBhcmUgcG9zc2libGUuIFRoZSBwcm92aWRlZCBzdWJzY3JpcHRpb24gZGVwb3NpdCBjYW4gYmUgd2l0aGRyYXduIG9ubHkgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIuCiAgICAvLy8gICAgICAgIERlcGVuZGluZyBvbiBuYXR1cmUgb2YgdGhlIHNlcnZpY2UgcHJvdmlkZWQsIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBhbGxvdyBhbiBpbW1lZGlhdGUgZGVwb3NpdCB3aXRoZHJhd2FsIGJ5IGByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKWAgY2FsbCwgYnV0IGl0cyBvbiBoaXMgb3duLgogICAgLy8vICAgICAgICBJbiBzb21lIGJ1c2luZXNzIGNhc2VzIGEgZGVwb3NpdCBtdXN0IHJlbWFpbiBsb2NrZWQgdW50aWwgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIgZXZlbiwgdGhlIHN1YnNjcmlwdGlvbiBpcyBhbHJlYWR5IGNhbmNlbGVkLgogICAgLy8vQG5vdGljZSBnYXNSZXNlcnZlIGlzIGEgZ2FzIGFtb3VudCByZXNlcnZlZCBmb3IgY29udHJhY3QgZXhlY3V0aW9uIEFGVEVSIHNlcnZpY2UgcHJvdmlkZXIgYmVjb21lcyBgb25TdWJDYW5jZWxlZCh1aW50MjU2LGFkZHJlc3MpYCBub3RpZmljYXRpb24uCiAgICAvLy8gICAgICAgIEl0IGd1YXJhbnRlZXMsIHRoYXQgY2FuY2VsbGF0aW9uIGJlY29tZXMgZXhlY3V0ZWQgZXZlbiBhIChtYWxpY2lvdXMpIHNlcnZpY2UgcHJvdmlkZXIgY29uc3VtZXMgYWxsIGdhcyBwcm92aWRlZC4KICAgIC8vLyAgICAgICAgSWYgc28sIHVzZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGFzIHRoZSBmb3JjZWQgdmVyc2lvbi4KICAgIC8vLyAgICAgICAgVGhpcyBkaWZmZXJlbmNlIGlzIGJlY2F1c2UgdGhlIGN1c3RvbWVyIG11c3QgYWx3YXlzIGhhdmUgYSBwb3NzaWJpbGl0eSB0byBjYW5jZWwgaGlzIGNvbnRyYWN0IGV2ZW4gdGhlIHNlcnZpY2UgcHJvdmlkZXIgZGlzYWdyZWUgb24gY2FuY2VsbGF0aW9uLgogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIHRvIGJlIGNhbmNlbGxlZAogICAgLy8vQHBhcmFtIGdhc1Jlc2VydmUgLSBnYXMgcmVzZXJ2ZWQgZm9yIGNhbGwgZmluYWxpemF0aW9uIChtaW5pbXVtIHJlc2VydmF0aW9uIGlzIDEwMDAwIGdhcykKICAgIC8vCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKSBwdWJsaWMgbm9SZWVudHJhbmN5KEwwMykgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyRnJvbSA9PSBtc2cuc2VuZGVyIHx8IG93bmVyID09IG1zZy5zZW5kZXIpOyAvL29ubHkgc3Vic2NyaXB0aW9uIG93bmVyIG9yIHBsYXRmb3JtIG93bmVyIGlzIGFsbG93ZWQgdG8gY2FuY2VsIGl0CiAgICAgICAgYXNzZXJ0IChfaXNTdWJzY3JpcHRpb24oc3ViKSk7CiAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOwogICAgICAgIHN1Yi5leHBpcmVPbiA9IG1heChub3csIHN1Yi5wYWlkVW50aWwpOwogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IF90bykgewogICAgICAgICAgICAvL3N1cHJlc3MgcmUtdGhyb3dpbmcgb2YgZXhjZXB0aW9uczsgcmVzZXJ2ZSBlbm91Z2ggZ2FzIHRvIGZpbmlzaCB0aGlzIGZ1bmN0aW9uCiAgICAgICAgICAgIGdhc1Jlc2VydmUgPSBtYXgoZ2FzUmVzZXJ2ZSwxMDAwMCk7ICAvL3Jlc2VydmUgbWluaW11bSAxMDAwMCBnYXMKICAgICAgICAgICAgYXNzZXJ0IChtc2cuZ2FzID4gZ2FzUmVzZXJ2ZSk7ICAgICAgIC8vc2FuaXR5IGNoZWNrCiAgICAgICAgICAgIGlmIChfdG8uY2FsbC5nYXMobXNnLmdhcy1nYXNSZXNlcnZlKShieXRlczQoc2hhMygib25TdWJDYW5jZWxlZCh1aW50MjU2LGFkZHJlc3MpIikpLCBzdWJJZCwgbXNnLnNlbmRlcikpIHsgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgICAgICAgICAgLy9kbyBub3RoaW5nLiBpdCBpcyBub3RpZmljYXRpb24gb25seS4KICAgICAgICAgICAgICAgIC8vTGF0ZXI6IGlzIGl0IHBvc3NpYmxlIHRvIGV2YWx1YXRlIHJldHVybiB2YWx1ZSBoZXJlPyBJZiBpcyBiZXR0ZXIgdG8gcmV0dXJuIHRoZSBzdWJzY3JpcHRpb24gZGVwb3NpdCBoZXJlLgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFN1YkNhbmNlbGVkKHN1YklkLCBtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLy8vQG5vdGljZSBwbGFjZSBhbiBhY3RpdmUgb2ZmZXIgb24gaG9sZDsgaXQgbWVhbnMgbm8gc3Vic2NyaXB0aW9ucyBjYW4gYmUgY3JlYXRlZCBmcm9tIHRoaXMgb2ZmZXIuCiAgICAvLy8gICAgICAgIE9ubHkgc2VydmljZSBwcm92aWRlciAob3IgcGxhdGZvcm0gb3duZXIpIGlzIGFsbG93ZWQgdG8gaG9sZC91bmhvbGQgYSBzdWJzY3JpcHRpb24gb2ZmZXIuCiAgICAvLy9AcGFyYW0gb2ZmZXJJZCAtIGlkIG9mIHRoZSBvZmZlciB0byBiZSBwbGFjZWQgb24gaG9sZC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOwogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb2ZmZXIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsgLy9vbmx5IG93bmVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBvZmZlciBvbiBob2xkLgogICAgICAgIGlmIChvZmZlci5vbkhvbGRTaW5jZSA9PSAwKSB7CiAgICAgICAgICAgIG9mZmVyLm9uSG9sZFNpbmNlID0gbm93OwogICAgICAgICAgICBPZmZlck9uSG9sZChvZmZlcklkLCB0cnVlLCBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIHJlc3VtZSBvbi1ob2xkIG9mZmVyOyBzdWJzY3JpcHRpb25zIGNhbiBiZSBjcmVhdGVkIGZyb20gdGhpcyBvZmZlciBhZ2FpbiAoaWYgb3RoZXIgY29uZGl0aW9ucyBhcmUgbWV0KS4KICAgIC8vLyAgICAgICAgT25seSBzZXJ2aWNlIHByb3ZpZGVyIChvciBwbGF0Zm9ybSBvd25lcikgaXMgYWxsb3dlZCB0byBob2xkL3VuaG9sZCBhIHN1YnNjcmlwdGlvbiBvZmZlci4KICAgIC8vL0BwYXJhbSBvZmZlcklkIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIHJlc3VtZWQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOwogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb2ZmZXIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsgLy9vbmx5IG93bmVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlYWN0aXZhdGUgdGhlIG9mZmVyLgogICAgICAgIGlmIChvZmZlci5vbkhvbGRTaW5jZSA+IDApIHsKICAgICAgICAgICAgb2ZmZXIub25Ib2xkU2luY2UgPSAwOwogICAgICAgICAgICBPZmZlck9uSG9sZChvZmZlcklkLCBmYWxzZSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb3Igc2VydmljZSBwcm92aWRlciB0byBwbGFjZSBhIHN1YnNjcmlwdGlvbiBvbiBob2xkLgogICAgLy8vICAgICAgICBJZiBjYWxsIGlzIG9yaWdpbmF0ZWQgYnkgY3VzdG9tZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlamVjdCB0aGUgcmVxdWVzdC4KICAgIC8vLyAgICAgICAgQSBzdWJzY3JpcHRpb24gb24gaG9sZCB3aWxsIG5vdCBiZSBjaGFyZ2VkLiBUaGUgc2VydmljZSBpcyB1c3VhbGx5IG5vdCBwcm92aWRlZCBhcyB3ZWxsLgogICAgLy8vICAgICAgICBEdXJpbmcgaG9sZCB0aW1lIGEgc3Vic2NyaXB0aW9uIHByZXNlcnZlIHJlbWFpbmluZyBwYWlkIHRpbWUgcGVyaW9kLCB3aGljaCBiZWNvbWVzIGF2YWlsYWJsZSBhZnRlciB1bmhvbGQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub1JlZW50cmFuY3koTDA0KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsKICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBfdG8gfHwgbXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJGcm9tKTsgLy9vbmx5IGN1c3RvbWVyIG9yIHByb3ZpZGVyIGNhbiBwbGFjZSB0aGUgc3Vic2NyaXB0aW9uIG9uIGhvbGQuCiAgICAgICAgaWYgKHN1Yi5vbkhvbGRTaW5jZSA9PSAwKSB7CiAgICAgICAgICAgIGlmIChtc2cuc2VuZGVyID09IF90byB8fCBTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblN1YlVuSG9sZChzdWJJZCwgbXNnLnNlbmRlciwgdHJ1ZSkpIHsgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgICAgICBzdWIub25Ib2xkU2luY2UgPSBub3c7CiAgICAgICAgICAgICAgICBTdWJPbkhvbGQoc3ViSWQsIHRydWUsIG1zZy5zZW5kZXIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY2FsbGVkIGJ5IGN1c3RvbWVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgdG8gdW5ob2xkIHN1YnNjcmlwdGlvbi4KICAgIC8vLyAgICAgICAgSWYgY2FsbCBpcyBvcmlnaW5hdGVkIGJ5IGN1c3RvbWVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWplY3QgdGhlIHJlcXVlc3QuCiAgICAvLy8gICAgICAgIEEgc3Vic2NyaXB0aW9uIG9uIGhvbGQgd2lsbCBub3QgYmUgY2hhcmdlZC4gVGhlIHNlcnZpY2UgaXMgdXN1YWxseSBub3QgcHJvdmlkZWQgYXMgd2VsbC4KICAgIC8vLyAgICAgICAgRHVyaW5nIGhvbGQgdGltZSBhIHN1YnNjcmlwdGlvbiBwcmVzZXJ2ZSByZW1haW5pbmcgcGFpZCB0aW1lIHBlcmlvZCwgd2hpY2ggYmVjb21lcyBhdmFpbGFibGUgYWZ0ZXIgdW5ob2xkLgogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gdW5ob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub1JlZW50cmFuY3koTDA1KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsKICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBfdG8gfHwgbXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJGcm9tKTsgLy9vbmx5IGN1c3RvbWVyIG9yIHByb3ZpZGVyIGNhbiBwbGFjZSB0aGUgc3Vic2NyaXB0aW9uIG9uIGhvbGQuCiAgICAgICAgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsKICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViVW5Ib2xkKHN1YklkLCBtc2cuc2VuZGVyLCBmYWxzZSkpIHsgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAgICAgICAgIHN1Yi5wYWlkVW50aWwgKz0gbm93IC0gc3ViLm9uSG9sZFNpbmNlOwogICAgICAgICAgICAgICAgc3ViLm9uSG9sZFNpbmNlID0gMDsKICAgICAgICAgICAgICAgIFN1Yk9uSG9sZChzdWJJZCwgZmFsc2UsIG1zZy5zZW5kZXIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgICAgICBkZXBvc2l0IGhhbmRsaW5nICAgICAgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy8vQG5vdGljZSBjYW4gYmUgY2FsbGVkIGJ5IHByb3ZpZGVyIG9uIENBTkNFTEVEIHN1YnNjcmlwdGlvbiB0byByZXR1cm4gYSBzdWJzY3JpcHRpb24gZGVwb3NpdCB0byBjdXN0b21lciBpbW1lZGlhdGVseS4KICAgIC8vLyAgICAgICAgQ3VzdG9tZXIgY2FuIGFueXdheSBjb2xsZWN0IGhpcyBkZXBvc2l0IGFmdGVyIGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyLgogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIGhvbGRpbmcgdGhlIGRlcG9zaXQKICAgIC8vCiAgICBmdW5jdGlvbiByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKSBwdWJsaWMgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoX3N1YnNjcmlwdGlvblN0YXRlKHN1YikgPT0gU3ViU3RhdGUuQ0FOQ0VMRUQpOwogICAgICAgIGFzc2VydCAoc3ViLmRlcG9zaXRBbW91bnQgPiAwKTsgLy9zYW5pdHkgY2hlY2sKICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzdWJzY3JpcHRpb24gb3duZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byByZWxlYXNlIGRlcG9zaXQuCiAgICAgICAgc3ViLmV4cGlyZU9uID0gbm93OwogICAgICAgIF9yZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdChzdWJJZCwgc3ViKTsKICAgIH0KCgogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb24gRVhQSVJFRCBzdWJzY3JpcHRpb24gKGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyKSB0byBjb2xsZWN0IGEgc3Vic2NyaXB0aW9uIGRlcG9zaXQuCiAgICAvLy8gICAgICAgIEN1c3RvbWVyIGNhbiBhbnl3YXkgY29sbGVjdCBoaXMgZGVwb3NpdCBhZnRlciBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4KICAgIC8vL0BwYXJhbSBzdWJJZCAtIHN1YnNjcmlwdGlvbiBob2xkaW5nIHRoZSBkZXBvc2l0CiAgICAvLwogICAgZnVuY3Rpb24gY2xhaW1TdWJzY3JpcHRpb25EZXBvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYyB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgYXNzZXJ0IChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViKSA9PSBTdWJTdGF0ZS5FWFBJUkVEKTsKICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlckZyb20gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgYXNzZXJ0IChzdWIuZGVwb3NpdEFtb3VudCA+IDApOwogICAgICAgIF9yZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdChzdWJJZCwgc3ViKTsKICAgIH0KCgogICAgLy9AZGV2IHJldHVybnMgc3Vic2NyaXB0aW9uIGRlcG9zaXQgdG8gY3VzdG9tZXIKICAgIGZ1bmN0aW9uIF9yZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkLCBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIHsKICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQgPSBzdWIuZGVwb3NpdEFtb3VudDsKICAgICAgICBzdWIuZGVwb3NpdEFtb3VudCA9IDA7CiAgICAgICAgc2FuLl9taW50RnJvbURlcG9zaXQoc3ViLnRyYW5zZmVyRnJvbSwgZGVwb3NpdEFtb3VudCk7CiAgICAgICAgU3Vic2NyaXB0aW9uRGVwb3NpdFJldHVybmVkKHN1YklkLCBkZXBvc2l0QW1vdW50LCBzdWIudHJhbnNmZXJGcm9tLCBtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLy8vQG5vdGljZSBjcmVhdGUgc2ltcGxlIHVubG9ja2VkIGRlcG9zaXQsIHJlcXVpcmVkIGJ5IHNvbWUgc2VydmljZXMuIEl0IGNhbiBiZSBjb25zaWRlcmVkIGFzIHByb3ZlIG9mIGN1c3RvbWVyJ3Mgc3Rha2UuCiAgICAvLy8gICAgICAgIFRoaXMgZGVzcG9zaXQgY2FuIGJlIGNsYWltZWQgYmFjayBieSB0aGUgY3VzdG9tZXIgYXQgYW55dGltZS4KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgaXMgcmVzcG9uc2libGUgdG8gY2hlY2sgdGhlIGRlcG9zaXQgYmVmb3JlIHByb3ZpZGluZyB0aGUgc2VydmljZS4KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBub24gemVybyBkZXBvc2l0IGFtb3VudC4KICAgIC8vL0BwYXJhbSBfZGVzY3JpcHRvciAtIGlzIGEgdW5pcSBrZXksIHVzdWFsbHkgZ2l2ZW4gYnkgc2VydmljZSBwcm92aWRlciB0byB0aGUgY3VzdG9tZXIgaW4gb3JkZXIgdG8gbWFrZSB0aGlzIGRlcG9zaXQgdW5pcXVlLgogICAgLy8vICAgICAgICBTZXJ2aWNlIFByb3ZpZGVyIHNob3VsZCByZWplY3QgZGVwb3NpdCB3aXRoIHVua25vd24gZGVzY3JpcHRvciwgYmVjYXVzZSBtb3N0IHByb2JhYmx5IGl0IGlzIGluIHVzZSBmb3Igc29tZSBhbm90aGVyIHNlcnZpY2UuCiAgICAvLy9AcmV0dXJuIGRlcG9zaXRJZCAtIGEgaGFuZGxlIHRvIGNsYWltIGJhY2sgdGhlIGRlcG9zaXQgbGF0ZXIuCiAgICAvLwogICAgZnVuY3Rpb24gY3JlYXRlRGVwb3NpdCh1aW50IF92YWx1ZSwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZXR1cm5zICh1aW50IGRlcG9zaXRJZCkgewogICAgICAgIHJlcXVpcmUgKF92YWx1ZSA+IDApOwogICAgICAgIGFzc2VydCAoc2FuLl9idXJuRm9yRGVwb3NpdChtc2cuc2VuZGVyLF92YWx1ZSkpOwogICAgICAgIGRlcG9zaXRzWysrZGVwb3NpdENvdW50ZXJdID0gRGVwb3NpdCAoewogICAgICAgICAgICBvd25lciA6IG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHZhbHVlIDogX3ZhbHVlLAogICAgICAgICAgICBkZXNjcmlwdG9yIDogX2Rlc2NyaXB0b3IKICAgICAgICB9KTsKICAgICAgICBOZXdEZXBvc2l0KGRlcG9zaXRDb3VudGVyLCBfdmFsdWUsIG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBkZXBvc2l0Q291bnRlcjsKICAgIH0KCgogICAgLy8vQG5vdGljZSByZXR1cm4gcHJldmlvdXNseSBjcmVhdGVkIGRlcG9zaXQgdG8gdGhlIHVzZXIuIFVzZXIgY2FuIGNvbGxlY3Qgb25seSBvd24gZGVwb3NpdC4KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgaXMgcmVzcG9uc2libGUgdG8gY2hlY2sgdGhlIGRlcG9zaXQgYmVmb3JlIHByb3ZpZGluZyB0aGUgc2VydmljZS4KICAgIC8vL0BwYXJhbSBfZGVwb3NpdElkIC0gYW4gaWQgb2YgdGhlIGRlcG9zaXQgdG8gYmUgY29sbGVjdGVkLgogICAgLy8KICAgIGZ1bmN0aW9uIGNsYWltRGVwb3NpdCh1aW50IF9kZXBvc2l0SWQpIHB1YmxpYyB7CiAgICAgICAgdmFyIGRlcG9zaXQgPSBkZXBvc2l0c1tfZGVwb3NpdElkXTsKICAgICAgICByZXF1aXJlIChkZXBvc2l0Lm93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIHZhciB2YWx1ZSA9IGRlcG9zaXRzW19kZXBvc2l0SWRdLnZhbHVlOwogICAgICAgIGRlbGV0ZSBkZXBvc2l0c1tfZGVwb3NpdElkXTsKICAgICAgICBzYW4uX21pbnRGcm9tRGVwb3NpdChtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAgICAgRGVwb3NpdFJldHVybmVkKF9kZXBvc2l0SWQsIG1zZy5zZW5kZXIpOwogICAgfQoKCgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgICAgICAgIHNvbWUgaW50ZXJuYWwgZnVuY3Rpb25zICAgICAgICAgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIGZ1bmN0aW9uIF9hbW91bnRUb0NoYXJnZShTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIHJlZW50cmFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9hcHBseVhjaGFuZ2VSYXRlKHN1Yi5wcmljZVBlckhvdXIgKiBzdWIuY2hhcmdlUGVyaW9kLCBzdWIpIC8gMSBob3VyczsgICAgICAgLy8gPD09PT0gcmVlbnRyYW50IGZ1bmN0aW9uIHVzYWdlCiAgICB9CgogICAgZnVuY3Rpb24gX2FwcGx5WGNoYW5nZVJhdGUodWludCBhbW91bnQsIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgcmVlbnRyYW50IHJldHVybnMgKHVpbnQpIHsgIC8vIDw9PSBhY3R1YWxseSBjYWxsZWQgZnJvbSByZWVudHJhbmN5IGd1YXJkZWQgY29udGV4dCBvbmx5IChpLmUuIGV4dGVybmFsbHkgc2VjdXJlZCkKICAgICAgICBpZiAoc3ViLnhyYXRlUHJvdmlkZXJJZCA+IDApIHsKICAgICAgICAgICAgLy8geHJhdGVfbjogbm9taW5hdG9yCiAgICAgICAgICAgIC8vIHhyYXRlX2Q6IGRlbm9taW5hdG9yIG9mIHRoZSBleGNoYW5nZSByYXRlIGZyYWN0aW9uLgogICAgICAgICAgICB2YXIgKHhyYXRlX24sIHhyYXRlX2QpID0gWFJhdGVQcm92aWRlcih4cmF0ZVByb3ZpZGVyc1tzdWIueHJhdGVQcm92aWRlcklkXSkuZ2V0UmF0ZSgpOyAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgIGFtb3VudCA9IGFtb3VudCAqIHN1Yi5pbml0aWFsWHJhdGVfbiAqIHhyYXRlX2QgLyBzdWIuaW5pdGlhbFhyYXRlX2QgLyB4cmF0ZV9uOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc09mZmVyKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlckZyb20gPT0gMCAmJiBzdWIudHJhbnNmZXJUbyAhPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc1N1YnNjcmlwdGlvbihTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpewogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJGcm9tICE9IDAgJiYgc3ViLnRyYW5zZmVyVG8gIT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBfZXhpc3RzKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlclRvICE9IDA7ICAgLy9leGlzdGluZyBzdWJzY3JpcHRpb24gb3Igb2ZmZXIgaGFzIGFsd2F5cyB0cmFuc2ZlclRvIHNldC4KICAgIH0KCiAgICBtb2RpZmllciBvbmx5UmVnaXN0ZXJlZFByb3ZpZGVyKCl7CiAgICAgICAgaWYgKCFwcm92aWRlclJlZ2lzdHJ5W21zZy5zZW5kZXJdKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKfSAvL1N1YnNjcmlwdGlvbk1vZHVsZUltcGw='.
	

]
