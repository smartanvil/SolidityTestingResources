Class {
	#name : #SRTa5b02488e9a827ff52d765e03683688cfb64d4c9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa5b02488e9a827ff52d765e03683688cfb64d4c9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsKCi8qCiAqIFRva2VuIC0gaXMgYSBzbWFydCBjb250cmFjdCBpbnRlcmZhY2UgCiAqIGZvciBtYW5hZ2luZyBjb21tb24gZnVuY3Rpb25hbGl0eSBvZiAKICogYSB0b2tlbi4KICoKICogRVJDLjIwIFRva2VuIHN0YW5kYXJkOiBodHRwczovL2dpdGh1Yi5jb20vZXRoIGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBUb2tlbkludGVyZmFjZSB7CgogICAgICAgIAogICAgLy8gdG90YWwgYW1vdW50IG9mIHRva2VucwogICAgdWludCB0b3RhbFN1cHBseTsKCiAgICAKICAgIC8qKgogICAgICoKICAgICAqIGJhbGFuY2VPZigpIC0gY29uc3RhbnQgZnVuY3Rpb24gY2hlY2sgY29uY3JldGUgdG9rZW5zIGJhbGFuY2UgIAogICAgICoKICAgICAqICBAcGFyYW0gb3duZXIgLSBhY2NvdW50IG93bmVyCiAgICAgKiAgCiAgICAgKiAgQHJldHVybiB0aGUgdmFsdWUgb2YgYmFsYW5jZSAKICAgICAqLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLyoqCiAgICAgKgogICAgICogYXBwcm92ZSgpIC0gZnVuY3Rpb24gYXBwcm92ZXMgdG8gYSBwZXJzb24gdG8gc3BlbmQgc29tZSB0b2tlbnMgZnJvbSAKICAgICAqICAgICAgICAgICBvd25lciBiYWxhbmNlLiAKICAgICAqCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJzb24gd2hvbSB0aGlzIHJpZ2h0IGJlZW4gZ3JhbnRlZC4KICAgICAqICBAcGFyYW0gdmFsdWUgICAtIHZhbHVlIHRvIHNwZW5kLgogICAgICogCiAgICAgKiAgQHJldHVybiB0cnVlIGluIGNhc2Ugb2Ygc3VjY2VzLCBvdGhlcndpc2UgZmFpbHVyZQogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8qKgogICAgICoKICAgICAqIGFsbG93YW5jZSgpIC0gY29uc3RhbnQgZnVuY3Rpb24gdG8gY2hlY2sgaG93IG11Y2ggaXMgCiAgICAgKiAgICAgICAgICAgICAgIHBlcm1pdHRlZCB0byBzcGVuZCB0byAzcmQgcGVyc29uIGZyb20gb3duZXIgYmFsYW5jZQogICAgICoKICAgICAqICBAcGFyYW0gb3duZXIgICAtIG93bmVyIG9mIHRoZSBiYWxhbmNlCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJtaXR0ZWQgdG8gc3BlbmQgZnJvbSB0aGlzIGJhbGFuY2UgcGVyc29uIAogICAgICogIAogICAgICogIEByZXR1cm4gLSByZW1haW5pbmcgcmlnaHQgdG8gc3BlbmQgCiAgICAgKiAKICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIC8vIGV2ZW50cyBub3RpZmljYXRpb25zCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoKICogU3RhbmRhcmRUb2tlbiAtIGlzIGEgc21hcnQgY29udHJhY3QgIAogKiBmb3IgbWFuYWdpbmcgY29tbW9uIGZ1bmN0aW9uYWxpdHkgb2YgCiAqIGEgdG9rZW4uCiAqCiAqIEVSQy4yMCBUb2tlbiBzdGFuZGFyZDogCiAqICAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2V0aCBlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBUb2tlbkludGVyZmFjZSB7CgoKICAgIC8vIHRva2VuIG93bmVyc2hpcAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICAvLyBzcGVuZGluZyBwZXJtaXNpb24gbWFuYWdlbWVudAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwogICAgCiAgICAKICAgIAogICAgZnVuY3Rpb24gU3RhbmRhcmRUb2tlbigpewogICAgfQogICAgCiAgICAKICAgIC8qKgogICAgICogdHJhbnNmZXIoKSAtIHRyYW5zZmVyIHRva2VucyBmcm9tIG1zZy5zZW5kZXIgYmFsYW5jZSAKICAgICAqICAgICAgICAgICAgICB0byByZXF1ZXN0ZWQgYWNjb3VudAogICAgICoKICAgICAqICBAcGFyYW0gdG8gICAgLSB0YXJnZXQgYWRkcmVzcyB0byB0cmFuc2ZlciB0b2tlbnMKICAgICAqICBAcGFyYW0gdmFsdWUgLSBhbW1vdW50IG9mIHRva2VucyB0byB0cmFuc2ZlcgogICAgICoKICAgICAqICBAcmV0dXJuIC0gc3VjY2VzcyAvIGZhaWx1cmUgb2YgdGhlIHRyYW5zYWN0aW9uCiAgICAgKi8gICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAKICAgICAgICAKICAgICAgICBpZiAoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gdmFsdWUgJiYgdmFsdWUgPiAwKSB7CgogICAgICAgICAgICAvLyBkbyBhY3R1YWwgdG9rZW5zIHRyYW5zZmVyICAgICAgIAogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSB2YWx1ZTsKICAgICAgICAgICAgYmFsYW5jZXNbdG9dICAgICAgICAgKz0gdmFsdWU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyByaXNlIHRoZSBUcmFuc2ZlciBldmVudAogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAKICAgICAgICB9CiAgICB9CiAgICAKICAgIAoKICAgIAogICAgLyoqCiAgICAgKiB0cmFuc2ZlckZyb20oKSAtIAogICAgICoKICAgICAqICBAcGFyYW0gZnJvbSAgLSAKICAgICAqICBAcGFyYW0gdG8gICAgLSAKICAgICAqICBAcGFyYW0gdmFsdWUgLSAKICAgICAqCiAgICAgKiAgQHJldHVybiAKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAKICAgICAgICBpZiAoIGJhbGFuY2VzW2Zyb21dID49IHZhbHVlICYmIAogICAgICAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSA+PSB2YWx1ZSAmJiAKICAgICAgICAgICAgIHZhbHVlID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIAogICAgICAgICAgICAvLyBkbyB0aGUgYWN0dWFsIHRyYW5zZmVyCiAgICAgICAgICAgIGJhbGFuY2VzW2Zyb21dIC09IHZhbHVlOyAgICAKICAgICAgICAgICAgYmFsYW5jZXNbdG9dID0rIHZhbHVlOyAgICAgICAgICAgIAogICAgICAgICAgICAKCiAgICAgICAgICAgIC8vIGFkZGp1c3QgdGhlIHBlcm1pc2lvbiwgYWZ0ZXIgcGFydCBvZiAKICAgICAgICAgICAgLy8gcGVybWl0ZWQgdG8gc3BlbmQgdmFsdWUgd2FzIHVzZWQKICAgICAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSAtPSB2YWx1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHJpc2UgdGhlIFRyYW5zZmVyIGV2ZW50CiAgICAgICAgICAgIFRyYW5zZmVyKGZyb20sIHRvLCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAKICAgICAgICB9CiAgICB9CgogICAgCgogICAgCiAgICAvKioKICAgICAqCiAgICAgKiBiYWxhbmNlT2YoKSAtIGNvbnN0YW50IGZ1bmN0aW9uIGNoZWNrIGNvbmNyZXRlIHRva2VucyBiYWxhbmNlICAKICAgICAqCiAgICAgKiAgQHBhcmFtIG93bmVyIC0gYWNjb3VudCBvd25lcgogICAgICogIAogICAgICogIEByZXR1cm4gdGhlIHZhbHVlIG9mIGJhbGFuY2UgCiAgICAgKi8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBvd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW293bmVyXTsKICAgIH0KCiAgICAKICAgIAogICAgLyoqCiAgICAgKgogICAgICogYXBwcm92ZSgpIC0gZnVuY3Rpb24gYXBwcm92ZXMgdG8gYSBwZXJzb24gdG8gc3BlbmQgc29tZSB0b2tlbnMgZnJvbSAKICAgICAqICAgICAgICAgICBvd25lciBiYWxhbmNlLiAKICAgICAqCiAgICAgKiAgQHBhcmFtIHNwZW5kZXIgLSBwZXJzb24gd2hvbSB0aGlzIHJpZ2h0IGJlZW4gZ3JhbnRlZC4KICAgICAqICBAcGFyYW0gdmFsdWUgICAtIHZhbHVlIHRvIHNwZW5kLgogICAgICogCiAgICAgKiAgQHJldHVybiB0cnVlIGluIGNhc2Ugb2Ygc3VjY2VzLCBvdGhlcndpc2UgZmFpbHVyZQogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAKICAgICAgICAvLyBub3cgc3BlbmRlciBjYW4gdXNlIGJhbGFuY2UgaW4gCiAgICAgICAgLy8gYW1tb3VudCBvZiB2YWx1ZSBmcm9tIG93bmVyIGJhbGFuY2UKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdmFsdWU7CiAgICAgICAgCiAgICAgICAgLy8gcmlzZSBldmVudCBhYm91dCB0aGUgdHJhbnNhY3Rpb24KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCB2YWx1ZSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKgogICAgICogYWxsb3dhbmNlKCkgLSBjb25zdGFudCBmdW5jdGlvbiB0byBjaGVjayBob3cgbW91Y2ggaXMgCiAgICAgKiAgICAgICAgICAgICAgIHBlcm1pdGVkIHRvIHNwZW5kIHRvIDNyZCBwZXJzb24gZnJvbSBvd25lciBiYWxhbmNlCiAgICAgKgogICAgICogIEBwYXJhbSBvd25lciAgIC0gb3duZXIgb2YgdGhlIGJhbGFuY2UKICAgICAqICBAcGFyYW0gc3BlbmRlciAtIHBlcm1pdGVkIHRvIHNwZW5kIGZyb20gdGhpcyBiYWxhbmNlIHBlcnNvbiAKICAgICAqICAKICAgICAqICBAcmV0dXJuIC0gcmVtYWluaW5nIHJpZ2h0IHRvIHNwZW5kIAogICAgICogCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgIHJldHVybiBhbGxvd2VkW293bmVyXVtzcGVuZGVyXTsKICAgIH0KCn0KCi8qKgogKgogKiBAdGl0bGUgSGFja2VyIEdvbGQKICogCiAqIFRoZSBvZmZpY2lhbCB0b2tlbiBwb3dlcmluZyB0aGUgaGFjay5ldGhlci5jYW1wIHZpcnR1YWwgYWNjZWxlcmF0b3IuCiAqIFRoaXMgaXMgdGhlIG9ubHkgd2F5IHRvIGFjcXVpcmUgdG9rZW5zIGZyb20gc3RhcnR1cHMgZHVyaW5nIHRoZSBldmVudC4KICoKICogV2hpdGVwYXBlciBodHRwczovL2hhY2suZXRoZXIuY2FtcC93aGl0ZXBhcGVyCiAqCiAqLwpjb250cmFjdCBIYWNrZXJHb2xkIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIC8vIE5hbWUgb2YgdGhlIHRva2VuICAgIAogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIkhhY2tlckdvbGQiOwoKICAgIC8vIERlY2ltYWwgcGxhY2VzCiAgICB1aW50OCAgcHVibGljIGRlY2ltYWxzID0gMzsKICAgIC8vIFRva2VuIGFiYnJldmlhdGlvbiAgICAgICAgCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJIS0ciOwogICAgCiAgICAvLyAxIGV0aGVyID0gMjAwIGhrZwogICAgdWludCBCQVNFX1BSSUNFID0gMjAwOwogICAgLy8gMSBldGhlciA9IDE1MCBoa2cKICAgIHVpbnQgTUlEX1BSSUNFID0gMTUwOwogICAgLy8gMSBldGhlciA9IDEwMCBoa2cKICAgIHVpbnQgRklOX1BSSUNFID0gMTAwOwogICAgLy8gU2FmZXR5IGNhcAogICAgdWludCBTQUZFVFlfTElNSVQgPSA0MDAwMDAwIGV0aGVyOwogICAgLy8gWmVyb3MgYWZ0ZXIgdGhlIHBvaW50CiAgICB1aW50IERFQ0lNQUxfWkVST1MgPSAxMDAwOwogICAgCiAgICAvLyBUb3RhbCB2YWx1ZSBpbiB3ZWkKICAgIHVpbnQgdG90YWxWYWx1ZTsKICAgIAogICAgLy8gQWRkcmVzcyBvZiBtdWx0aXNpZyB3YWxsZXQgaG9sZGluZyBldGhlciBmcm9tIHNhbGUKICAgIGFkZHJlc3Mgd2FsbGV0OwoKICAgIC8vIFN0cnVjdHVyZSBvZiBzYWxlIGluY3JlYXNlIG1pbGVzdG9uZXMKICAgIHN0cnVjdCBtaWxlc3RvbmVzX3N0cnVjdCB7CiAgICAgIHVpbnQgcDE7CiAgICAgIHVpbnQgcDI7IAogICAgICB1aW50IHAzOwogICAgICB1aW50IHA0OwogICAgICB1aW50IHA1OwogICAgICB1aW50IHA2OwogICAgfQogICAgLy8gTWlsZXN0b25lcyBpbnN0YW5jZQogICAgbWlsZXN0b25lc19zdHJ1Y3QgbWlsZXN0b25lczsKICAgIAogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvciBvZiB0aGUgY29udHJhY3QuCiAgICAgKiAKICAgICAqIFBhc3NlcyBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGhvbGRpbmcgdGhlIHZhbHVlLgogICAgICogSGFja2VyR29sZCBjb250cmFjdCBpdHNlbGYgZG9lcyBub3QgaG9sZCBhbnkgdmFsdWUKICAgICAqIAogICAgICogQHBhcmFtIG11bHRpc2lnIGFkZHJlc3Mgb2YgTXVsdGlTaWcgd2FsbGV0IHdoaWNoIHdpbGwgaG9sZCB0aGUgdmFsdWUKICAgICAqLwogICAgZnVuY3Rpb24gSGFja2VyR29sZChhZGRyZXNzIG11bHRpc2lnKSB7CiAgICAgICAgCiAgICAgICAgd2FsbGV0ID0gbXVsdGlzaWc7CgogICAgICAgIC8vIHNldCB0aW1lIHBlcmlvZHMgZm9yIHNhbGUKICAgICAgICBtaWxlc3RvbmVzID0gbWlsZXN0b25lc19zdHJ1Y3QoCiAgICAgICAgCiAgICAgICAgICAxNDc2OTcyMDAwLCAgLy8gUDE6IEdNVDogMjAtT2N0LTIwMTYgMTQ6MDAgID0+IFRoZSBTYWxlIFN0YXJ0cwogICAgICAgICAgMTQ3ODE4MTYwMCwgIC8vIFAyOiBHTVQ6IDAzLU5vdi0yMDE2IDE0OjAwICA9PiAxc3QgUHJpY2UgTGFkZGVyIAogICAgICAgICAgMTQ3OTM5MTIwMCwgIC8vIFAzOiBHTVQ6IDE3LU5vdi0yMDE2IDE0OjAwICA9PiBQcmljZSBTdGFibGUsIAogICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIYWNrYXRob24gU3RhcnRzCiAgICAgICAgICAxNDgwNjAwODAwLCAgLy8gUDQ6IEdNVDogMDEtRGVjLTIwMTYgMTQ6MDAgID0+IDJuZCBQcmljZSBMYWRkZXIKICAgICAgICAgIDE0ODE4MTA0MDAsICAvLyBQNTogR01UOiAxNS1EZWMtMjAxNiAxNDowMCAgPT4gUHJpY2UgU3RhYmxlCiAgICAgICAgICAxNDgyNDE1MjAwICAgLy8gUDY6IEdNVDogMjItRGVjLTIwMTYgMTQ6MDAgID0+IFNhbGUgRW5kcywgSGFja2F0aG9uIEVuZHMKICAgICAgICApOwogICAgICAgICAgICAgICAgCiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiBGYWxsYmFjayBmdW5jdGlvbjogY2FsbGVkIG9uIGV0aGVyIHNlbnQuCiAgICAgKiAKICAgICAqIEl0IGNhbGxzIHRvIGNyZWF0ZUhLRyBmdW5jdGlvbiB3aXRoIG1zZy5zZW5kZXIgCiAgICAgKiBhcyBhIHZhbHVlIGZvciBob2xkZXIgYXJndW1lbnQKICAgICAqLwogICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgICAgY3JlYXRlSEtHKG1zZy5zZW5kZXIpOwogICAgfQogICAgCiAgICAvKioKICAgICAqIENyZWF0ZXMgSEtHIHRva2Vucy4KICAgICAqIAogICAgICogUnVucyBzYW5pdHkgY2hlY2tzIGluY2x1ZGluZyBzYWZldHkgY2FwCiAgICAgKiBUaGVuIGNhbGN1bGF0ZXMgY3VycmVudCBwcmljZSBieSBnZXRQcmljZSgpIGZ1bmN0aW9uLCBjcmVhdGVzIEhLRyB0b2tlbnMKICAgICAqIEZpbmFsbHkgc2VuZHMgYSB2YWx1ZSBvZiB0cmFuc2FjdGlvbiB0byB0aGUgd2FsbGV0CiAgICAgKiAKICAgICAqIE5vdGU6IGR1ZSB0byBsYWNrIG9mIGZsb2F0aW5nIHBvaW50IHR5cGVzIGluIFNvbGlkaXR5LAogICAgICogY29udHJhY3QgYXNzdW1lcyB0aGF0IGxhc3QgMyBkaWdpdHMgaW4gdG9rZW5zIGFtb3VudCBhcmUgc3Rvb2QgYWZ0ZXIgdGhlIHBvaW50LgogICAgICogSXQgbWVhbnMgdGhhdCBpZiBzdG9yZWQgSEtHIGJhbGFuY2UgaXMgMTAwMDAwLCB0aGVuIGl0cyByZWFsIHZhbHVlIGlzIDEwMCBIS0cKICAgICAqIAogICAgICogQHBhcmFtIGhvbGRlciB0b2tlbiBob2xkZXIKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlSEtHKGFkZHJlc3MgaG9sZGVyKSBwYXlhYmxlIHsKICAgICAgICAKICAgICAgICBpZiAobm93IDwgbWlsZXN0b25lcy5wMSkgdGhyb3c7CiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnA2KSB0aHJvdzsKICAgICAgICBpZiAobXNnLnZhbHVlID09IDApIHRocm93OwogICAgCiAgICAgICAgLy8gc2FmZXR5IGNhcAogICAgICAgIGlmIChnZXRUb3RhbFZhbHVlKCkgKyBtc2cudmFsdWUgPiBTQUZFVFlfTElNSVQpIHRocm93OyAKICAgIAogICAgICAgIHVpbnQgdG9rZW5zID0gbXNnLnZhbHVlICogZ2V0UHJpY2UoKSAqIERFQ0lNQUxfWkVST1MgLyAxIGV0aGVyOwoKICAgICAgICB0b3RhbFN1cHBseSArPSB0b2tlbnM7CiAgICAgICAgYmFsYW5jZXNbaG9sZGVyXSArPSB0b2tlbnM7CiAgICAgICAgdG90YWxWYWx1ZSArPSBtc2cudmFsdWU7CiAgICAgICAgCiAgICAgICAgaWYgKCF3YWxsZXQuc2VuZChtc2cudmFsdWUpKSB0aHJvdzsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBEZW5vdGVzIGNvbXBsZXRlIHByaWNlIHN0cnVjdHVyZSBkdXJpbmcgdGhlIHNhbGUuCiAgICAgKgogICAgICogQHJldHVybiBIS0cgYW1vdW50IHBlciAxIEVUSCBmb3IgdGhlIGN1cnJlbnQgbW9tZW50IGluIHRpbWUKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UHJpY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIAogICAgICAgIGlmIChub3cgPCBtaWxlc3RvbmVzLnAxKSByZXR1cm4gMDsKICAgICAgICAKICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDEgJiYgbm93IDwgbWlsZXN0b25lcy5wMikgewogICAgICAgIAogICAgICAgICAgICByZXR1cm4gQkFTRV9QUklDRTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA+PSBtaWxlc3RvbmVzLnAyICYmIG5vdyA8IG1pbGVzdG9uZXMucDMpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVpbnQgZGF5c19pbiA9IDEgKyAobm93IC0gbWlsZXN0b25lcy5wMikgLyAxIGRheXM7IAogICAgICAgICAgICByZXR1cm4gQkFTRV9QUklDRSAtIGRheXNfaW4gKiAyNSAvIDc7ICAvLyBkYWlseSBkZWNyZWFzZSAzLjUKICAgICAgICB9CgogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wMyAmJiBub3cgPCBtaWxlc3RvbmVzLnA0KSB7CiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBNSURfUFJJQ0U7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChub3cgPj0gbWlsZXN0b25lcy5wNCAmJiBub3cgPCBtaWxlc3RvbmVzLnA1KSB7CiAgICAgICAgICAgIAogICAgICAgICAgICBkYXlzX2luID0gMSArIChub3cgLSBtaWxlc3RvbmVzLnA0KSAvIDEgZGF5czsgCiAgICAgICAgICAgIHJldHVybiBNSURfUFJJQ0UgLSBkYXlzX2luICogMjUgLyA3OyAgLy8gZGFpbHkgZGVjcmVhc2UgMy41CiAgICAgICAgfQoKICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDUgJiYgbm93IDwgbWlsZXN0b25lcy5wNikgewogICAgICAgIAogICAgICAgICAgICByZXR1cm4gRklOX1BSSUNFOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAobm93ID49IG1pbGVzdG9uZXMucDYpewoKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICB9CiAgICAKICAgIC8qKgogICAgICogUmV0dXJucyB0b3RhbCBzdG9yZWQgSEtHIGFtb3VudC4KICAgICAqIAogICAgICogQ29udHJhY3QgYXNzdW1lcyB0aGF0IGxhc3QgMyBkaWdpdHMgb2YgdGhpcyB2YWx1ZSBhcmUgYmVoaW5kIHRoZSBkZWNpbWFsIHBsYWNlLiBpLmUuIDEwMDAxIGlzIDEwLjAwMQogICAgICogVGh1cywgcmVzdWx0IG9mIHRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGRpdmlkZWQgYnkgMTAwMCB0byBnZXQgSEtHIHZhbHVlCiAgICAgKiAKICAgICAqIEByZXR1cm4gcmVzdWx0IHN0b3JlZCBIS0cgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHk7CiAgICB9IAoKICAgIC8qKgogICAgICogSXQgaXMgdXNlZCBmb3IgdGVzdCBwdXJwb3Nlcy4KICAgICAqIAogICAgICogUmV0dXJucyB0aGUgcmVzdWx0IG9mICdub3cnIHN0YXRlbWVudCBvZiBTb2xpZGl0eSBsYW5ndWFnZQogICAgICogCiAgICAgKiBAcmV0dXJuIHVuaXggdGltZXN0YW1wIGZvciBjdXJyZW50IG1vbWVudCBpbiB0aW1lCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE5vdygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgdG90YWwgdmFsdWUgcGFzc2VkIHRocm91Z2ggdGhlIGNvbnRyYWN0CiAgICAgKiAKICAgICAqIEByZXR1cm4gcmVzdWx0IHRvdGFsIHZhbHVlIGluIHdlaQogICAgICovCiAgICBmdW5jdGlvbiBnZXRUb3RhbFZhbHVlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpIHsKICAgICAgICByZXR1cm4gdG90YWxWYWx1ZTsgIAogICAgfQp9CgovKioKICogCiAqIEV2ZW50SW5mbyAtIGltdXRhYmxlIGNsYXNzIHRoYXQgZGVub3RlcwogKiB0aGUgdGltZSBvZiB0aGUgdmlydHVhbCBhY2NlbGVyYXRvciBoYWNrCiAqIGV2ZW50CiAqIAogKi8KY29udHJhY3QgRXZlbnRJbmZvewogICAgCiAgICAKICAgIHVpbnQgY29uc3RhbnQgSEFDS0FUSE9OXzVfV0VFS1MgPSA2MCAqIDYwICogMjQgKiA3ICogNTsKICAgIHVpbnQgY29uc3RhbnQgVF8xX1dFRUsgPSA2MCAqIDYwICogMjQgKiA3OwoKICAgIHVpbnQgZXZlbnRTdGFydCA9IDE0NzkzOTEyMDA7IC8vIFRodSwgMTcgTm92IDIwMTYgMTQ6MDA6MDAgR01UCiAgICB1aW50IGV2ZW50RW5kID0gZXZlbnRTdGFydCArIEhBQ0tBVEhPTl81X1dFRUtTOwogICAgCiAgICAKICAgIC8qKgogICAgICogZ2V0RXZlbnRTdGFydCAtIHJldHVybiB0aGUgc3RhcnQgb2YgdGhlIGV2ZW50IHRpbWUKICAgICAqLyAKICAgIGZ1bmN0aW9uIGdldEV2ZW50U3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7ICAgICAgICAKICAgICAgIHJldHVybiBldmVudFN0YXJ0OwogICAgfSAKICAgIAogICAgLyoqCiAgICAgKiBnZXRFdmVudEVuZCAtIHJldHVybiB0aGUgZW5kIG9mIHRoZSBldmVudCB0aW1lCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRFdmVudEVuZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsgICAgICAgIAogICAgICAgcmV0dXJuIGV2ZW50RW5kOwogICAgfSAKICAgIAogICAgCiAgICAvKioKICAgICAqIGdldFZvdGluZ1N0YXJ0IC0gdGhlIHZvdGluZyBzdGFydHMgMSB3ZWVrIGFmdGVyIHRoZSAKICAgICAqICAgICAgICAgICAgICAgICAgZXZlbnQgc3RhcnRzCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRWb3RpbmdTdGFydCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gZXZlbnRTdGFydCsgVF8xX1dFRUs7CiAgICB9CgogICAgLyoqCiAgICAgKiBnZXRUcmFkaW5nU3RhcnQgLSB0aGUgRFNUIHRva2VucyB0cmFkaW5nIHN0YXJ0cyAxIHdlZWsgCiAgICAgKiAgICAgICAgICAgICAgICAgICBhZnRlciB0aGUgZXZlbnQgc3RhcnRzCiAgICAgKi8gCiAgICBmdW5jdGlvbiBnZXRUcmFkaW5nU3RhcnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGV2ZW50U3RhcnQrIFRfMV9XRUVLOwogICAgfQoKICAgIC8qKgogICAgICogZ2V0Tm93IC0gaGVscGVyIGNsYXNzIHRvIGNoZWNrIHdoYXQgdGltZSB0aGUgY29udHJhY3Qgc2VlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE5vdygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsgICAgICAgIAogICAgICAgcmV0dXJuIG5vdzsKICAgIH0gCiAgICAKfQoKLyoKICogRFNUQ29udHJhY3QgLSBEU1Qgc3RhbmRzIGZvciBkZWNlbnRyYWxpemVkIHN0YXJ0dXAgdGVhbS4KICogICAgICAgICAgICAgICB0aGUgY29udHJhY3QgZW5zdXJlcyBmdW5kaW5nIGZvciBhIGRlY2VudHJhbGl6ZWQKICogICAgICAgICAgICAgICB0ZWFtIGluIDIgcGhhc2VzOiAKICoKICogICAgICAgICAgICAgICAgKy4gRnVuZGluZyBieSBIS0cgZHVyaW5nIHRoZSBoYWNrYXRob24gZXZlbnQuIAogKiAgICAgICAgICAgICAgICArLiBGdW5kaW5nIGJ5IEV0aGVyIGFmdGVyIHRoZSBldmVudCBpcyBvdmVyLiAKICoKICogICAgICAgICAgICAgICBBZnRlciB0aGUgZnVuZHMgYmVlbiBjb2xsZWN0ZWQgdGhlcmUgaXMgYSBnb3Zlcm5lbmNlCiAqICAgICAgICAgICAgICAgbWVjaGFuaXNtIG1hbmFnZWQgYnkgcHJvcG9zaXRpb24gdG8gd2l0aGRyYXcgZnVuZHMKICogICAgICAgICAgICAgICBmb3IgZGV2ZWxvcG1lbnQgdXNhZ2UuIAogKgogKiAgICAgICAgICAgICAgIFRoZSBEU1QgZW5zdXJlcyB0aGF0IGJhY2tlcnMgb2YgdGhlIHByb2plY3RzIGtlZXBzCiAqICAgICAgICAgICAgICAgc29tZSBpbmZsdWVuY2Ugb24gdGhlIHByb2plY3QgYnkgYWJpbGl0eSB0byByZWplY3QKICogICAgICAgICAgICAgICBwcm9wb3NpdGlvbnMgdGhleSBmaW5kIGFzIG5vbiBlZmZlY3RpdmUuIAogKgogKiAgICAgICAgICAgICAgIEluIHZlcnkgcmFkaWNhbCBvY2Nhc2lvbnMgdGhlIGJhY2tlcnMgbWF5IGxvb3NlIAogKiAgICAgICAgICAgICAgIHRoZSB0cnVzdCBpbiB0aGUgdGVhbSBjb21wbGV0ZWxseSwgaW4gdGhhdCBjYXNlIAogKiAgICAgICAgICAgICAgIHRoZXJlIGlzIGFuIG9wdGlvbiB0byBwcm9wb3NlIGltcGVhY2htZW50IHByb2Nlc3MKICogICAgICAgICAgICAgICBjb21wbGV0ZWxseSByZW1vdmluZyB0aGUgZXhlY3V0ZSBhbmQgYXNzaWduaW5nIG5ldwogKiAgICAgICAgICAgICAgIHBlcnNvbiB0byBtYW5hZ2UgdGhlIGZ1bmRzLiAKICoKICovCmNvbnRyYWN0IERTVENvbnRyYWN0IGlzIFN0YW5kYXJkVG9rZW57CgogICAgLy8gWmVyb3MgYWZ0ZXIgdGhlIHBvaW50CiAgICB1aW50IERFQ0lNQUxfWkVST1MgPSAxMDAwOwogICAgLy8gUHJvcG9zYWwgbGlmZXRpbWUKICAgIHVpbnQgUFJPUE9TQUxfTElGRVRJTUUgPSAxMCBkYXlzOwogICAgLy8gUHJvcG9zYWwgZnVuZHMgdGhyZXNob2xkLCBpbiBwZXJjZW50cwogICAgdWludCBQUk9QT1NBTF9GVU5EU19USCA9IDIwOwoKICAgIGFkZHJlc3MgICBleGVjdXRpdmU7IAogICAgICAgIAogICAgRXZlbnRJbmZvIGV2ZW50SW5mbzsKICAgIAogICAgLy8gSW5kaWNhdGVkIHdoZXJlIHRoZSBEU1QgaXMgdHJhZGVkCiAgICBhZGRyZXNzIHZpcnR1YWxFeGNoYW5nZUFkZHJlc3M7CiAgICAKICAgIEhhY2tlckdvbGQgaGFja2VyR29sZDsKICAgICAgICAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgdm90aW5nUmlnaHRzOwoKCiAgICAvLyAxIC0gSEtHID0+IERTVCBxdHk7IHRva2VucyBmb3IgMSBIS0cKICAgIHVpbnQgaGtnUHJpY2U7CiAgICAKICAgIC8vIDEgLSBFdGhlciA9PiBEU1QgcXR5OyB0b2tlbnMgZm9yIDEgRXRoZXIKICAgIHVpbnQgZXRoZXJQcmljZTsKICAgIAogICAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIi4uLiI7ICAgICAgICAgICAgICAgICAgIAogICAgdWludDggIHB1YmxpYyBkZWNpbWFscyA9IDM7ICAgICAgICAgICAgICAgICAKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gIi4uLiI7CiAgICAKICAgIGJvb2wgYWJsZVRvSXNzdWVUb2tlbnMgPSB0cnVlOyAKICAgIAogICAgdWludCBwcmVmZXJlZFF0eVNvbGQ7CgogICAgdWludCBjb2xsZWN0ZWRIS0c7IAogICAgdWludCBjb2xsZWN0ZWRFdGhlcjsgICAgCiAgICAKICAgIC8vIFByb3Bvc2FsIG9mIHRoZSBmdW5kcyBzcGVuZGluZwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBQcm9wb3NhbCkgcHJvcG9zYWxzOwoKICAgIGVudW0gUHJvcG9zYWxDdXJyZW5jeSB7IEhLRywgRVRIRVIgfQogICAgUHJvcG9zYWxDdXJyZW5jeSBlbnVtRGVjbGFyYXRpb247CiAgICAgICAgICAgICAgICAgIAogICAgICAgCiAgICBzdHJ1Y3QgUHJvcG9zYWx7CiAgICAgICAgCiAgICAgICAgYnl0ZXMzMiBpZDsKICAgICAgICB1aW50IHZhbHVlOwoKICAgICAgICBzdHJpbmcgdXJsRGV0YWlsczsKCiAgICAgICAgdWludCB2b3RpbmRFbmRUUzsKICAgICAgICAgICAgICAgIAogICAgICAgIHVpbnQgdm90ZXNPYmplY3Rpbmc7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBzdWJtaXR0ZXI7CiAgICAgICAgYm9vbCByZWRlZW1lZDsKCiAgICAgICAgUHJvcG9zYWxDdXJyZW5jeSBwcm9wb3NhbEN1cnJlbmN5OwogICAgICAgIAogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgdm90ZWQ7CiAgICB9CiAgICB1aW50IGNvdW50ZXJQcm9wb3NhbHM7CiAgICB1aW50IHRpbWVPZkxhc3RQcm9wb3NhbDsKICAgIAogICAgUHJvcG9zYWxbXSBsaXN0UHJvcG9zYWxzOwogICAgCgogICAgLyoqCiAgICAgKiBJbXBlYWNobWVudCBwcm9jZXNzIHByb3Bvc2FscwogICAgICovICAgIAogICAgc3RydWN0IEltcGVhY2htZW50UHJvcG9zYWx7CiAgICAgICAgCiAgICAgICAgc3RyaW5nIHVybERldGFpbHM7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBuZXdFeGVjdXRpdmU7CgogICAgICAgIHVpbnQgdm90aW5kRW5kVFM7ICAgICAgICAKICAgICAgICB1aW50IHZvdGVzU3VwcG9ydGluZzsKICAgICAgICAKICAgICAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHZvdGVkOyAgICAgICAgCiAgICB9CiAgICBJbXBlYWNobWVudFByb3Bvc2FsIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsOwoKICAgICAgICAKICAgIC8qKgogICAgICogCiAgICAgKiAgRFNUQ29udHJhY3Q6IGN0b3IgZm9yIERTVCB0b2tlbiBhbmQgZ292ZXJuZW5jZSBjb250cmFjdAogICAgICoKICAgICAqICBAcGFyYW0gZXZlbnRJbmZvQWRkciBFdmVudEluZm86IGFkZHJlc3Mgb2Ygb2JqZWN0IGRlbm90ZXMgZXZlbnRzIAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWlsZXN0b25lcyAgICAgIAogICAgICogIEBwYXJhbSBoYWNrZXJHb2xkQWRkciBIYWNrZXJHb2xkOiBhZGRyZXNzIG9mIEhhY2tlckdvbGQgdG9rZW4KICAgICAqCiAgICAgKiAgQHBhcmFtIGRzdE5hbWUgc3RyaW5nOiBkc3ROYW1lOiByZWFsIG5hbWUgb2YgdGhlIHRlYW0KICAgICAqCiAgICAgKiAgQHBhcmFtIGRzdFN5bWJvbCBzdHJpbmc6IDMgbGV0dGVyIHN5bWJvbGQgb2YgdGhlIHRlYW0KICAgICAqCiAgICAgKi8gCiAgICBmdW5jdGlvbiBEU1RDb250cmFjdChFdmVudEluZm8gZXZlbnRJbmZvQWRkciwgSGFja2VyR29sZCBoYWNrZXJHb2xkQWRkciwgc3RyaW5nIGRzdE5hbWUsIHN0cmluZyBkc3RTeW1ib2wpewogICAgCiAgICAgIGV4ZWN1dGl2ZSAgID0gbXNnLnNlbmRlcjsgIAogICAgICBuYW1lICAgICAgICA9IGRzdE5hbWU7CiAgICAgIHN5bWJvbCAgICAgID0gZHN0U3ltYm9sOwoKICAgICAgaGFja2VyR29sZCA9IEhhY2tlckdvbGQoaGFja2VyR29sZEFkZHIpOwogICAgICBldmVudEluZm8gID0gRXZlbnRJbmZvKGV2ZW50SW5mb0FkZHIpOwogICAgfQogICAgCgogICAgZnVuY3Rpb24oKSBwYXlhYmxlCiAgICAgICAgICAgICAgIG9ubHlBZnRlckVuZCB7CiAgICAgICAgCiAgICAgICAgLy8gdGhlcmUgaXMgdG9rZW5zIGxlZnQgZnJvbSBoYWNrYXRob24gCiAgICAgICAgaWYgKGV0aGVyUHJpY2UgPT0gMCkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgdWludCB0b2tlbnMgPSBtc2cudmFsdWUgKiBldGhlclByaWNlICogREVDSU1BTF9aRVJPUyAvICgxIGV0aGVyKTsKICAgICAgICAKICAgICAgICAvLyBjaGVjayBpZiBkZW1hbmQgb2YgdG9rZW5zIGlzIAogICAgICAgIC8vIG92ZXJmbG93IHRoZSBzdXBwbHkgCiAgICAgICAgdWludCByZXRFdGhlciA9IDA7CiAgICAgICAgaWYgKGJhbGFuY2VzW3RoaXNdIDwgdG9rZW5zKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICB0b2tlbnMgPSBiYWxhbmNlc1t0aGlzXTsKICAgICAgICAgICAgcmV0RXRoZXIgPSBtc2cudmFsdWUgLSB0b2tlbnMgLyBldGhlclByaWNlICogKDEgZmlubmV5KTsKICAgICAgICAKICAgICAgICAgICAgLy8gcmV0dXJuIGxlZnQgZXRoZXIgCiAgICAgICAgICAgIGlmICghbXNnLnNlbmRlci5zZW5kKHJldEV0aGVyKSkgdGhyb3c7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIC8vIGRvIHRyYW5zZmVyCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gKz0gdG9rZW5zOwogICAgICAgIGJhbGFuY2VzW3RoaXNdIC09IHRva2VuczsKICAgICAgICAKICAgICAgICAvLyBjb3VudCBjb2xsZWN0ZWQgZXRoZXIgCiAgICAgICAgY29sbGVjdGVkRXRoZXIgKz0gbXNnLnZhbHVlIC0gcmV0RXRoZXI7IAogICAgICAgIAogICAgICAgIC8vIHJpc2UgZXZlbnQKICAgICAgICBCdXlGb3JFdGhlclRyYW5zYWN0aW9uKG1zZy5zZW5kZXIsIGNvbGxlY3RlZEV0aGVyLCB0b3RhbFN1cHBseSwgZXRoZXJQcmljZSwgdG9rZW5zKTsKICAgICAgICAKICAgIH0KCiAgICAKICAgIAogICAgLyoqCiAgICAgKiBzZXRIS0dQcmljZSAtIHNldCBwcmljZTogMUhLRyA9PiBEU1QgdG9rZW5zIHF0eQogICAgICoKICAgICAqICBAcGFyYW0gcXR5Rm9yT25lSEtHIHVpbnQ6IERTVCB0b2tlbnMgZm9yIDEgSEtHCiAgICAgKiAKICAgICAqLyAgICAKICAgICBmdW5jdGlvbiBzZXRIS0dQcmljZSh1aW50IHF0eUZvck9uZUhLRykgb25seUV4ZWN1dGl2ZSAgewogICAgICAgICAKICAgICAgICAgaGtnUHJpY2UgPSBxdHlGb3JPbmVIS0c7CiAgICAgICAgIFByaWNlSEtHQ2hhbmdlKHF0eUZvck9uZUhLRywgcHJlZmVyZWRRdHlTb2xkLCB0b3RhbFN1cHBseSk7CiAgICAgfQogICAgIAogICAgIAogICAgCiAgICAvKioKICAgICAqIAogICAgICogaXNzdWVQcmVmZXJlZFRva2VucyAtIHByZWZlcmVkIHRva2VucyBpc3N1ZWQgb24gdGhlIGhhY2thdGhvbiBldmVudAogICAgICogICAgICAgICAgICAgICAgICAgICAgIGdyYW50IHNwZWNpYWwgcmlnaHRzCiAgICAgKgogICAgICogIEBwYXJhbSBxdHlGb3JPbmVIS0cgdWludDogcHJpY2UgRFNUIHRva2VucyBmb3Igb25lIDEgSEtHCiAgICAgKiAgQHBhcmFtIHF0eVRvRW1pdCB1aW50OiBuZXcgc3VwcGx5IG9mIHRva2VucyAKICAgICAqIAogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZVByZWZlcmVkVG9rZW5zKHVpbnQgcXR5Rm9yT25lSEtHLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBxdHlUb0VtaXQpIG9ubHlFeGVjdXRpdmUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5SWZBYmxlVG9Jc3N1ZVRva2VucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUJlZm9yZUVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUFmdGVyVHJhZGluZ1N0YXJ0IHsKICAgICAgICAgICAgICAgIAogICAgICAgIC8vIG5vIGlzc3VlbmNlIGlzIGFsbG93ZWQgYmVmb3JlIGVubGlzdGVkIG9uIHRoZQogICAgICAgIC8vIGV4Y2hhbmdlIAogICAgICAgIGlmICh2aXJ0dWFsRXhjaGFuZ2VBZGRyZXNzID09IDB4MCkgdGhyb3c7CiAgICAgICAgICAgIAogICAgICAgIHRvdGFsU3VwcGx5ICAgICs9IHF0eVRvRW1pdDsKICAgICAgICBiYWxhbmNlc1t0aGlzXSArPSBxdHlUb0VtaXQ7CiAgICAgICAgaGtnUHJpY2UgPSBxdHlGb3JPbmVIS0c7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gbm93IHNwZW5kZXIgY2FuIHVzZSBiYWxhbmNlIGluIAogICAgICAgIC8vIGFtb3VudCBvZiB2YWx1ZSBmcm9tIG93bmVyIGJhbGFuY2UKICAgICAgICBhbGxvd2VkW3RoaXNdW3ZpcnR1YWxFeGNoYW5nZUFkZHJlc3NdICs9IHF0eVRvRW1pdDsKICAgICAgICAKICAgICAgICAvLyByaXNlIGV2ZW50IGFib3V0IHRoZSB0cmFuc2FjdGlvbgogICAgICAgIEFwcHJvdmFsKHRoaXMsIHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MsIHF0eVRvRW1pdCk7CiAgICAgICAgCiAgICAgICAgLy8gcmlzZSBldmVudCAKICAgICAgICBEc3RUb2tlbnNJc3N1ZWQoaGtnUHJpY2UsIHByZWZlcmVkUXR5U29sZCwgdG90YWxTdXBwbHksIHF0eVRvRW1pdCk7CiAgICB9CgogICAgCiAgICAKICAgIAogICAgLyoqCiAgICAgKiAKICAgICAqIGJ1eUZvckhhY2tlckdvbGQgLSBvbiB0aGUgaGFjayBldmVudCB0aGlzIGZ1bmN0aW9uIGlzIGF2YWlsYWJsZSAKICAgICAqICAgICAgICAgICAgICAgICAgICB0aGUgYnV5ZXIgZm9yIGhhY2tlciBnb2xkIHdpbGwgZ2FpbiB2b3RlcyB0byAKICAgICAqICAgICAgICAgICAgICAgICAgICBpbmZsdWVuY2UgZnV0dXJlIHByb3Bvc2FscyBvbiB0aGUgRFNUCiAgICAgKiAgICAKICAgICAqICBAcGFyYW0gaGtnVmFsdWUgLSBxdHkgb2YgdGhpcyBEU1QgdG9rZW5zIGZvciAxIEhLRyAgICAgCiAgICAgKiAKICAgICAqLwogICAgZnVuY3Rpb24gYnV5Rm9ySGFja2VyR29sZCh1aW50IGhrZ1ZhbHVlKSBvbmx5QmVmb3JlRW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIAogICAgICAvLyB2YWxpZGF0ZSB0aGF0IHRoZSBjYWxsZXIgaXMgb2ZmaWNpYWwgYWNjZWxlcmF0b3IgSEtHIEV4Y2hhbmdlCiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHZpcnR1YWxFeGNoYW5nZUFkZHJlc3MpIHRocm93OwogICAgICAKICAgICAgCiAgICAgIC8vIHRyYW5zZmVyIHRva2VuIAogICAgICBhZGRyZXNzIHNlbmRlciA9IHR4Lm9yaWdpbjsKICAgICAgdWludCB0b2tlbnNRdHkgPSBoa2dWYWx1ZSAqIGhrZ1ByaWNlOwoKICAgICAgLy8gZ2FpbiB2b3RpbmcgcmlnaHRzCiAgICAgIHZvdGluZ1JpZ2h0c1tzZW5kZXJdICs9dG9rZW5zUXR5OwogICAgICBwcmVmZXJlZFF0eVNvbGQgKz0gdG9rZW5zUXR5OwogICAgICBjb2xsZWN0ZWRIS0cgKz0gaGtnVmFsdWU7CgogICAgICAvLyBkbyBhY3R1YWwgdHJhbnNmZXIKICAgICAgdHJhbnNmZXJGcm9tKHRoaXMsIAogICAgICAgICAgICAgICAgICAgdmlydHVhbEV4Y2hhbmdlQWRkcmVzcywgdG9rZW5zUXR5KTsKICAgICAgdHJhbnNmZXIoc2VuZGVyLCB0b2tlbnNRdHkpOyAgICAgICAgCiAgICAgICAgICAgIAogICAgICAvLyByaXNlIGV2ZW50ICAgICAgIAogICAgICBCdXlGb3JIS0dUcmFuc2FjdGlvbihzZW5kZXIsIHByZWZlcmVkUXR5U29sZCwgdG90YWxTdXBwbHksIGhrZ1ByaWNlLCB0b2tlbnNRdHkpOwogICAgICAgIAogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgICAgICAKICAgIAogICAgLyoqCiAgICAgKiAKICAgICAqIGlzc3VlVG9rZW5zIC0gZnVuY3Rpb24gd2lsbCBpc3N1ZSB0b2tlbnMgYWZ0ZXIgdGhlIAogICAgICogICAgICAgICAgICAgICBldmVudCwgYWJsZSB0byBzZWxsIGZvciAxIGV0aGVyIAogICAgICogCiAgICAgKiAgQHBhcmFtIHF0eUZvck9uZUV0aGVyIHVpbnQ6IERTVCB0b2tlbnMgZm9yIDEgRVRICiAgICAgKiAgQHBhcmFtIHF0eVRvRW1pdCB1aW50OiBuZXcgdG9rZW5zIHN1cHBseQogICAgICoKICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWVUb2tlbnModWludCBxdHlGb3JPbmVFdGhlciwgCiAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IHF0eVRvRW1pdCkgb25seUFmdGVyRW5kIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlFeGVjdXRpdmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5SWZBYmxlVG9Jc3N1ZVRva2VucyB7CiAgICAgICAgIAogICAgICAgICBiYWxhbmNlc1t0aGlzXSArPSBxdHlUb0VtaXQ7CiAgICAgICAgIGV0aGVyUHJpY2UgPSBxdHlGb3JPbmVFdGhlcjsKICAgICAgICAgdG90YWxTdXBwbHkgICAgKz0gcXR5VG9FbWl0OwogICAgICAgICAKICAgICAgICAgLy8gcmlzZSBldmVudCAgCiAgICAgICAgIERzdFRva2Vuc0lzc3VlZChxdHlGb3JPbmVFdGhlciwgdG90YWxTdXBwbHksIHRvdGFsU3VwcGx5LCBxdHlUb0VtaXQpOwogICAgfQogICAgIAogICAgCiAgICAvKioKICAgICAqIHNldEV0aGVyUHJpY2UgLSBjaGFuZ2UgdGhlIHRva2VuIHByaWNlCiAgICAgKgogICAgICogIEBwYXJhbSBxdHlGb3JPbmVFdGhlciB1aW50OiBuZXcgcHJpY2UgLSBEU1QgdG9rZW5zIGZvciAxIEVUSAogICAgICovICAgICAKICAgIGZ1bmN0aW9uIHNldEV0aGVyUHJpY2UodWludCBxdHlGb3JPbmVFdGhlcikgb25seUFmdGVyRW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlFeGVjdXRpdmUgewogICAgICAgICBldGhlclByaWNlID0gcXR5Rm9yT25lRXRoZXI7IAoKICAgICAgICAgLy8gcmlzZSBldmVudCBmb3IgdGhpcwogICAgICAgICBOZXdFdGhlclByaWNlKHF0eUZvck9uZUV0aGVyKTsKICAgIH0gICAgCiAgICAKCiAgICAvKioKICAgICAqICBkaXNhYmxlVG9rZW5Jc3N1YW5jZSAtIGZ1bmN0aW9uIHdpbGwgZGlzYWJsZSBhbnkgCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24gZm9yIGZ1dHVyZSB0b2tlbiAKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgIGlzc3VlbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRpc2FibGVUb2tlbklzc3VhbmNlKCkgb25seUV4ZWN1dGl2ZSB7CiAgICAgICAgYWJsZVRvSXNzdWVUb2tlbnMgPSBmYWxzZTsKICAgICAgICAKICAgICAgICBEaXNhYmxlVG9rZW5Jc3N1YW5jZSgpOwogICAgfQoKICAgIAogICAgLyoqCiAgICAgKiAgYnVyblJlbWFpblRva2VuIC0gIGVsaW1pbmF0ZWQgYWxsIGF2YWlsYWJsZSBmb3Igc2FsZQogICAgICogICAgICAgICAgICAgICAgICAgICB0b2tlbnMuIAogICAgICovCiAgICBmdW5jdGlvbiBidXJuUmVtYWluVG9rZW4oKSBvbmx5RXhlY3V0aXZlIHsKICAgIAogICAgICAgIHRvdGFsU3VwcGx5IC09IGJhbGFuY2VzW3RoaXNdOwogICAgICAgIGJhbGFuY2VzW3RoaXNdID0gMDsKICAgICAgICAKICAgICAgICAvLyByaXNlIGV2ZW50IGZvciB0aGlzCiAgICAgICAgQnVybmVkQWxsUmVtYWluZWRUb2tlbnMoKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiAgc3VibWl0RXRoZXJQcm9wb3NhbDogc3VibWl0IHByb3Bvc2FsIHRvIHVzZSBwYXJ0IG9mIHRoZSAKICAgICAqICAgICAgICAgICAgICAgICAgICAgICBjb2xsZWN0ZWQgZXRoZXIgZnVuZHMKICAgICAqCiAgICAgKiAgIEBwYXJhbSByZXF1ZXN0VmFsdWUgdWludDogdmFsdWUgaW4gd2VpIAogICAgICogICBAcGFyYW0gdXJsIHN0cmluZzogZGV0YWlscyBvZiB0aGUgcHJvcG9zYWwgCiAgICAgKi8gCiAgICBmdW5jdGlvbiBzdWJtaXRFdGhlclByb3Bvc2FsKHVpbnQgcmVxdWVzdFZhbHVlLCBzdHJpbmcgdXJsKSBvbmx5QWZ0ZXJFbmQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmx5RXhlY3V0aXZlIHJldHVybnMgKGJ5dGVzMzIgcmVzdWx0SWQsIGJvb2wgcmVzdWx0U3VjY2VzKSB7ICAgICAgIAogICAgCiAgICAgICAgLy8gZW5zdXJlIHRoZXJlIGlzIG5vIG1vcmUgaXNzdWVuY2UgYXZhaWxhYmxlIAogICAgICAgIGlmIChhYmxlVG9Jc3N1ZVRva2VucykgdGhyb3c7CiAgICAgICAgICAgIAogICAgICAgIC8vIGVuc3VyZSB0aGVyZSBpcyBubyBtb3JlIHRva2VucyBhdmFpbGFibGUgCiAgICAgICAgaWYgKGJhbGFuY2VPZih0aGlzKSA+IDApIHRocm93OwoKICAgICAgICAvLyBQb3NzaWJsZSB0byBzdWJtaXQgYSBwcm9wb3NhbCBvbmNlIDIgd2Vla3MgCiAgICAgICAgaWYgKG5vdyA8ICh0aW1lT2ZMYXN0UHJvcG9zYWwgKyAyIHdlZWtzKSkgdGhyb3c7CiAgICAgICAgICAgIAogICAgICAgIHVpbnQgcGVyY2VudCA9IGNvbGxlY3RlZEV0aGVyIC8gMTAwOwogICAgICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdFZhbHVlID4gUFJPUE9TQUxfRlVORFNfVEggKiBwZXJjZW50KSB0aHJvdzsKCiAgICAgICAgLy8gaWYgcmVtYWluZWQgdmFsdWUgaXMgbGVzcyB0aGFuIHJlcXVlc3RlZCBnYWluIGFsbC4KICAgICAgICBpZiAocmVxdWVzdFZhbHVlID4gdGhpcy5iYWxhbmNlKSAKICAgICAgICAgICAgcmVxdWVzdFZhbHVlID0gdGhpcy5iYWxhbmNlOyAgICAKICAgICAgICAgICAgCiAgICAgICAgLy8gc2V0IGlkIG9mIHRoZSBwcm9wb3NhbAogICAgICAgIC8vIHN1Ym1pdCBwcm9wb3NhbCB0byB0aGUgbWFwCiAgICAgICAgYnl0ZXMzMiBpZCA9IHNoYTMobXNnLmRhdGEsIG5vdyk7CiAgICAgICAgdWludCB0aW1lRW5kcyA9IG5vdyArIFBST1BPU0FMX0xJRkVUSU1FOyAKICAgICAgICAgICAgCiAgICAgICAgUHJvcG9zYWwgbWVtb3J5IG5ld1Byb3Bvc2FsID0gUHJvcG9zYWwoaWQsIHJlcXVlc3RWYWx1ZSwgdXJsLCB0aW1lRW5kcywgMCwgbXNnLnNlbmRlciwgZmFsc2UsIFByb3Bvc2FsQ3VycmVuY3kuRVRIRVIpOwogICAgICAgIHByb3Bvc2Fsc1tpZF0gPSBuZXdQcm9wb3NhbDsKICAgICAgICBsaXN0UHJvcG9zYWxzLnB1c2gobmV3UHJvcG9zYWwpOwogICAgICAgICAgICAKICAgICAgICB0aW1lT2ZMYXN0UHJvcG9zYWwgPSBub3c7ICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgUHJvcG9zYWxSZXF1ZXN0U3VibWl0dGVkKGlkLCByZXF1ZXN0VmFsdWUsIHRpbWVFbmRzLCB1cmwsIG1zZy5zZW5kZXIpOwogICAgICAgIAogICAgICAgIHJldHVybiAoaWQsIHRydWUpOwogICAgfQogICAgCiAgICAKICAgICAKICAgIC8qKgogICAgICogCiAgICAgKiBzdWJtaXRIS0dQcm9wb3NhbCAtIHN1Ym1pdCBwcm9wb3NhbCB0byByZXF1ZXN0IGZvciAKICAgICAqICAgICAgICAgICAgICAgICAgICAgcGFydGlhbCBIS0cgZnVuZHMgY29sbGVjdGVkIAogICAgICogCiAgICAgKiAgQHBhcmFtIHJlcXVlc3RWYWx1ZSB1aW50OiB2YWx1ZSBpbiBIS0cgdG8gcmVxdWVzdC4gCiAgICAgKiAgQHBhcmFtIHVybCBzdHJpbmc6IHVybCB3aXRoIGRldGFpbHMgb24gdGhlIHByb3Bvc2l0aW9uIAogICAgICovCiAgICBmdW5jdGlvbiBzdWJtaXRIS0dQcm9wb3NhbCh1aW50IHJlcXVlc3RWYWx1ZSwgc3RyaW5nIHVybCkgb25seUFmdGVyRW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25seUV4ZWN1dGl2ZSByZXR1cm5zIChieXRlczMyIHJlc3VsdElkLCBib29sIHJlc3VsdFN1Y2Nlcyl7CiAgICAgICAgCgogICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIDIgbW9udGhzIG92ZXIgc2luY2UgdGhlIGxhc3QgZXZlbnQuCiAgICAgICAgLy8gVGhlcmUgaXMgbm8gcG9zaWJsZSB0byBnZXQgYW55IEhLRy4gQWZ0ZXIgMiBtb250aHMKICAgICAgICAvLyBhbGwgdGhlIEhLRyBpcyBhdmFpbGFibGUuIAogICAgICAgIGlmIChub3cgPCAoZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkgKyA4IHdlZWtzKSkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CgogICAgICAgIC8vIFBvc3NpYmxlIHRvIHN1Ym1pdCBhIHByb3Bvc2FsIG9uY2UgMiB3ZWVrcyAKICAgICAgICBpZiAobm93IDwgKHRpbWVPZkxhc3RQcm9wb3NhbCArIDIgd2Vla3MpKSB0aHJvdzsKCiAgICAgICAgdWludCBwZXJjZW50ID0gcHJlZmVyZWRRdHlTb2xkIC8gMTAwOwogICAgICAgIAogICAgICAgIC8vIHZhbGlkYXRlIHRoZSBhbW91bnQgaXMgbGVnaXQKICAgICAgICAvLyBmaXJzdCA1IHByb3Bvc2FscyBzaG91bGQgYmUgbGVzcyB0aGFuIDIwJSAKICAgICAgICBpZiAoY291bnRlclByb3Bvc2FscyA8PSA1ICYmIAogICAgICAgICAgICByZXF1ZXN0VmFsdWUgICAgID4gIFBST1BPU0FMX0ZVTkRTX1RIICogcGVyY2VudCkgdGhyb3c7CiAgICAgICAgICAgICAgICAKICAgICAgICAvLyBpZiByZW1haW5lZCB2YWx1ZSBpcyBsZXNzIHRoYW4gcmVxdWVzdGVkIAogICAgICAgIC8vIGdhaW4gYWxsLgogICAgICAgIGlmIChyZXF1ZXN0VmFsdWUgPiBnZXRIS0dPd25lZCgpKSAKICAgICAgICAgICAgcmVxdWVzdFZhbHVlID0gZ2V0SEtHT3duZWQoKTsKICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBzZXQgaWQgb2YgdGhlIHByb3Bvc2FsCiAgICAgICAgLy8gc3VibWl0IHByb3Bvc2FsIHRvIHRoZSBtYXAKICAgICAgICBieXRlczMyIGlkID0gc2hhMyhtc2cuZGF0YSwgbm93KTsKICAgICAgICB1aW50IHRpbWVFbmRzID0gbm93ICsgUFJPUE9TQUxfTElGRVRJTUU7IAogICAgICAgIAogICAgICAgIFByb3Bvc2FsIG1lbW9yeSBuZXdQcm9wb3NhbCA9IFByb3Bvc2FsKGlkLCByZXF1ZXN0VmFsdWUsIHVybCwgdGltZUVuZHMsIDAsIG1zZy5zZW5kZXIsIGZhbHNlLCBQcm9wb3NhbEN1cnJlbmN5LkhLRyk7CiAgICAgICAgcHJvcG9zYWxzW2lkXSA9IG5ld1Byb3Bvc2FsOwogICAgICAgIGxpc3RQcm9wb3NhbHMucHVzaChuZXdQcm9wb3NhbCk7CiAgICAgICAgCiAgICAgICAgKytjb3VudGVyUHJvcG9zYWxzOwogICAgICAgIHRpbWVPZkxhc3RQcm9wb3NhbCA9IG5vdzsgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICBQcm9wb3NhbFJlcXVlc3RTdWJtaXR0ZWQoaWQsIHJlcXVlc3RWYWx1ZSwgdGltZUVuZHMsIHVybCwgbXNnLnNlbmRlcik7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIChpZCwgdHJ1ZSk7ICAgICAgICAKICAgIH0gIAogICAgCiAgICAKICAgIAogICAgLyoqCiAgICAgKiBvYmplY3RQcm9wb3NhbCAtIG9iamVjdCBwcmV2aW91c2x5IHN1Ym1pdHRlZCBwcm9wb3NhbCwgCiAgICAgKiAgICAgICAgICAgICAgICAgIHRoZSBvYmplY3Rpb24gcmlnaHQgaXMgb2J0YWluZWQgYnkgCiAgICAgKiAgICAgICAgICAgICAgICAgIHB1cmNoYXNpbmcgcHJlZmVyZWQgdG9rZW5zIG9uIHRpbWUgb2YgCiAgICAgKiAgICAgICAgICAgICAgICAgIHRoZSBoYWNrYXRob24uCiAgICAgKiAKICAgICAqICBAcGFyYW0gaWQgYnl0ZXMzMiA6IHRoZSBpZCBvZiB0aGUgcHJvcG9zbGEgdG8gcmVkZWVtCiAgICAgKi8KICAgICBmdW5jdGlvbiBvYmplY3RQcm9wb3NhbChieXRlczMyIGlkKXsKICAgICAgICAgCiAgICAgICAgUHJvcG9zYWwgbWVtb3J5IHByb3Bvc2FsID0gcHJvcG9zYWxzW2lkXTsKICAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgcHJvcG9zYWwgZXhpc3QgCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0uaWQgPT0gMCkgdGhyb3c7CgogICAgICAgIC8vIGNoZWNrIGFscmVhZHkgcmVkZWVtZWQKICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS5yZWRlZW1lZCkgdGhyb3c7CiAgICAgICAgIAogICAgICAgIC8vIGVuc3VyZSBvYmplY3Rpb24gdGltZQogICAgICAgIGlmIChub3cgPj0gcHJvcG9zYWxzW2lkXS52b3RpbmRFbmRUUykgdGhyb3c7CiAgICAgICAgIAogICAgICAgIC8vIGVuc3VyZSBub3Qgdm90ZWQgIAogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnZvdGVkW21zZy5zZW5kZXJdKSB0aHJvdzsKICAgICAgICAgCiAgICAgICAgIC8vIHN1Ym1pdCB2b3RlcwogICAgICAgICB1aW50IHZvdGVzID0gdm90aW5nUmlnaHRzW21zZy5zZW5kZXJdOwogICAgICAgICBwcm9wb3NhbHNbaWRdLnZvdGVzT2JqZWN0aW5nICs9IHZvdGVzOwogICAgICAgICAKICAgICAgICAgLy8gbWFyayB2b3RlZCAKICAgICAgICAgcHJvcG9zYWxzW2lkXS52b3RlZFttc2cuc2VuZGVyXSA9IHRydWU7IAogICAgICAgICAKICAgICAgICAgdWludCBpZHggPSBnZXRJbmRleEJ5UHJvcG9zYWxJZChpZCk7CiAgICAgICAgIGxpc3RQcm9wb3NhbHNbaWR4XSA9IHByb3Bvc2Fsc1tpZF07ICAgCgogICAgICAgICBPYmplY3RlZFZvdGUoaWQsIG1zZy5zZW5kZXIsIHZvdGVzKTsgICAgICAgICAKICAgICB9CiAgICAgCiAgICAgCiAgICAgZnVuY3Rpb24gZ2V0SW5kZXhCeVByb3Bvc2FsSWQoYnl0ZXMzMiBpZCkgcmV0dXJucyAodWludCByZXN1bHQpewogICAgICAgICAKICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGlzdFByb3Bvc2Fscy5sZW5ndGg7ICsraSl7CiAgICAgICAgICAgICBpZiAoaWQgPT0gbGlzdFByb3Bvc2Fsc1tpXS5pZCkgcmV0dXJuIGk7CiAgICAgICAgIH0KICAgICB9CiAgICAKICAgIAogICAKICAgIC8qKgogICAgICogcmVkZWVtUHJvcG9zYWxGdW5kcyAtIHJlZGVlbSBmdW5kcyByZXF1ZXN0ZWQgYnkgcHJpb3IgCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0dGVkIHByb3Bvc2FsICAgICAKICAgICAqIAogICAgICogQHBhcmFtIGlkIGJ5dGVzMzI6IHRoZSBpZCBvZiB0aGUgcHJvcG9zYWwgdG8gcmVkZWVtCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZGVlbVByb3Bvc2FsRnVuZHMoYnl0ZXMzMiBpZCkgb25seUV4ZWN1dGl2ZSB7CgogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLmlkID09IDApIHRocm93OwogICAgICAgIGlmIChwcm9wb3NhbHNbaWRdLnN1Ym1pdHRlciAhPSBtc2cuc2VuZGVyKSB0aHJvdzsKCiAgICAgICAgLy8gZW5zdXJlIG9iamVjdGlvbiB0aW1lCiAgICAgICAgaWYgKG5vdyA8IHByb3Bvc2Fsc1tpZF0udm90aW5kRW5kVFMpIHRocm93OwogICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIAogICAgICAgICAgICAvLyBjaGVjayBhbHJlYWR5IHJlZGVlbWVkCiAgICAgICAgaWYgKHByb3Bvc2Fsc1tpZF0ucmVkZWVtZWQpIHRocm93OwoKICAgICAgICAvLyBjaGVjayB2b3RlcyBvYmplY3Rpb24gPT4gNTUlIG9mIHRvdGFsIHZvdGVzCiAgICAgICAgdWludCBvYmplY3Rpb25UaHJlc2hvbGQgPSBwcmVmZXJlZFF0eVNvbGQgLyAxMDAgKiA1NTsKICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS52b3Rlc09iamVjdGluZyAgPiBvYmplY3Rpb25UaHJlc2hvbGQpIHRocm93OwogICAgCiAgICAKICAgICAgICBpZiAocHJvcG9zYWxzW2lkXS5wcm9wb3NhbEN1cnJlbmN5ID09IFByb3Bvc2FsQ3VycmVuY3kuSEtHKXsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHNlbmQgaGFja2VyIGdvbGQgCiAgICAgICAgICAgIGhhY2tlckdvbGQudHJhbnNmZXIocHJvcG9zYWxzW2lkXS5zdWJtaXR0ZXIsIHByb3Bvc2Fsc1tpZF0udmFsdWUpOyAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAvLyBzZW5kIGV0aGVyICAgICAgICAgICAgICAKICAgICAgICAgICBib29sIHN1Y2Nlc3MgPSBwcm9wb3NhbHNbaWRdLnN1Ym1pdHRlci5zZW5kKHByb3Bvc2Fsc1tpZF0udmFsdWUpOyAKCiAgICAgICAgICAgLy8gcmlzZSBldmVudAogICAgICAgICAgIEV0aGVyUmVkZWVtQWNjZXB0ZWQocHJvcG9zYWxzW2lkXS5zdWJtaXR0ZXIsIHByb3Bvc2Fsc1tpZF0udmFsdWUpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBleGVjdXRlIHRoZSBwcm9wb3NhbCAKICAgICAgICBwcm9wb3NhbHNbaWRdLnJlZGVlbWVkID0gdHJ1ZTsgCiAgICB9CiAgICAKICAgIAogICAgLyoqCiAgICAgKiAgZ2V0QWxsVGhlRnVuZHMgLSB0byBlbnN1cmUgdGhlcmUgaXMgbm8gZGVhZGxvY2sgY2FuIAogICAgICogICAgICAgICAgICAgICAgICAgY2FuIGhhcHBlbiwgYW5kIG5vIGNhc2UgdGhhdCB2b3RpbmcgCiAgICAgKiAgICAgICAgICAgICAgICAgICBzdHJ1Y3R1cmUgd2lsbCBmcmVlemUgdGhlIGZ1bmRzIGZvcmV2ZXIKICAgICAqICAgICAgICAgICAgICAgICAgIHRoZSBzdGFydHVwIHdpbGwgYmUgYWJsZSB0byBnZXQgYWxsIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgZnVuZHMgd2l0aG91dCBhIHByb3Bvc2FsIHJlcXVpcmVkIGFmdGVyCiAgICAgKiAgICAgICAgICAgICAgICAgICA2IG1vbnRocy4KICAgICAqIAogICAgICogCiAgICAgKi8gICAgICAgICAgICAgCiAgICBmdW5jdGlvbiBnZXRBbGxUaGVGdW5kcygpIG9ubHlFeGVjdXRpdmUgewogICAgICAgIAogICAgICAgIC8vIElmIHRoZXJlIGlzIGEgZGVhZGxvY2sgaW4gdm90aW5nIHBhcnRpY2lwYXRlcwogICAgICAgIC8vIHRoZSBmdW5kcyBjYW4gYmUgcmVkZWVtZWQgY29tcGxldGVsbHkgaW4gNiBtb250aHMKICAgICAgICBpZiAobm93IDwgKGV2ZW50SW5mby5nZXRFdmVudEVuZCgpICsgMjQgd2Vla3MpKSB7CiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0gIAogICAgICAgIAogICAgICAgIC8vIGFsbCB0aGUgRXRoZXIKICAgICAgICBib29sIHN1Y2Nlc3MgPSBtc2cuc2VuZGVyLnNlbmQodGhpcy5iYWxhbmNlKTsgICAgICAgIAogICAgICAgIAogICAgICAgIC8vIGFsbCB0aGUgSEtHCiAgICAgICAgaGFja2VyR29sZC50cmFuc2Zlcihtc2cuc2VuZGVyLCBnZXRIS0dPd25lZCgpKTsgICAgICAgICAgICAgIAogICAgfQogICAgCiAgICAKICAgIC8qKgogICAgICogc3VibWl0SW1wZWFjaG1lbnRQcm9wb3NhbCAtIHN1Ym1pdCByZXF1ZXN0IHRvIHN3aXRjaCAKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjdXRpdmUuCiAgICAgKiAKICAgICAqICBAcGFyYW0gdXJsRGV0YWlscyAgLSBkZXRhaWxzIG9mIHRoZSBpbXBlYWNobWVudCBwcm9wb3NhbCAKICAgICAqICBAcGFyYW0gbmV3RXhlY3V0aXZlIC0gYWRkcmVzcyBvZiB0aGUgbmV3IGV4ZWN1dGl2ZSAKICAgICAqIAogICAgICovICAgICAgICAgICAgIAogICAgIGZ1bmN0aW9uIHN1Ym1pdEltcGVhY2htZW50UHJvcG9zYWwoc3RyaW5nIHVybERldGFpbHMsIGFkZHJlc3MgbmV3RXhlY3V0aXZlKXsKICAgICAgICAgCiAgICAgICAgLy8gdG8gb2ZmZXIgaW1wZWFjaG1lbnQgeW91IHNob3VsZCBoYXZlIAogICAgICAgIC8vIHZvdGluZyByaWdodHMKICAgICAgICBpZiAodm90aW5nUmlnaHRzW21zZy5zZW5kZXJdID09IDApIHRocm93OwogICAgICAgICAKICAgICAgICAvLyB0aGUgc3VibWlzc2lvbiBvZiB0aGUgZmlyc3QgaW1wZWFjaG1lbnQgCiAgICAgICAgLy8gcHJvcG9zYWwgaXMgcG9zc2libGUgb25seSBhZnRlciAzIG1vbnRocwogICAgICAgIC8vIHNpbmNlIHRoZSBoYWNrYXRob24gaXMgb3ZlcgogICAgICAgIGlmIChub3cgPCAoZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkgKyAxMiB3ZWVrcykpIHRocm93OwogICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgdGhlcmUgaXMgMSBtb250aHMgb3ZlciBzaW5jZSBsYXN0IG9uZQogICAgICAgIGlmIChsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RpbmRFbmRUUyAhPSAwICYmIAogICAgICAgICAgICBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RpbmRFbmRUUyArICAyIHdlZWtzID4gbm93KSB0aHJvdzsKCgogICAgICAgIC8vIHN1Ym1pdCBpbXBlYWNobWVudCBwcm9wb3NhbAogICAgICAgIC8vIGFkZCB0aGUgdm90ZXMgb2YgdGhlIHN1Ym1pdHRlciAKICAgICAgICAvLyB0byB0aGUgcHJvcG9zYWwgcmlnaHQgYXdheQogICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsID0gSW1wZWFjaG1lbnRQcm9wb3NhbCh1cmxEZXRhaWxzLCBuZXdFeGVjdXRpdmUsIG5vdyArIDIgd2Vla3MsIHZvdGluZ1JpZ2h0c1ttc2cuc2VuZGVyXSk7CiAgICAgICAgbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZWRbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgICAKICAgICAgICAvLyByaXNlIGV2ZW50CiAgICAgICAgSW1wZWFjaG1lbnRQcm9wb3NlZChtc2cuc2VuZGVyLCB1cmxEZXRhaWxzLCBub3cgKyAyIHdlZWtzLCBuZXdFeGVjdXRpdmUpOwogICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIHN1cHBvcnRJbXBlYWNobWVudCAtIHZvdGUgZm9yIGltcGVhY2htZW50IHByb3Bvc2FsIAogICAgICogICAgICAgICAgICAgICAgICAgICAgdGhhdCBpcyBjdXJyZW50bHkgaW4gcHJvZ3Jlc3MKICAgICAqCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN1cHBvcnRJbXBlYWNobWVudCgpewoKICAgICAgICAvLyBlbnN1cmUgdGhhdCBzdXBwb3J0IGlzIGZvciBleGlzdCBwcm9wb3NhbCAKICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwubmV3RXhlY3V0aXZlID09IDB4MCkgdGhyb3c7CiAgICAKICAgICAgICAvLyB0byBvZmZlciBpbXBlYWNobWVudCB5b3Ugc2hvdWxkIGhhdmUgCiAgICAgICAgLy8gdm90aW5nIHJpZ2h0cwogICAgICAgIGlmICh2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl0gPT0gMCkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgaWYgbm90IHZvdGVkIGFscmVhZHkgCiAgICAgICAgaWYgKGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVkW21zZy5zZW5kZXJdKSB0aHJvdzsKICAgICAgICAKICAgICAgICAvLyBjaGVjayBpZiBub3QgZmluaXNoZWQgdGhlIDIgd2Vla3Mgb2Ygdm90aW5nIAogICAgICAgIGlmIChsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC52b3RpbmRFbmRUUyArIDIgd2Vla3MgPD0gbm93KSB0aHJvdzsKICAgICAgICAgICAgICAgIAogICAgICAgIC8vIHN1cHBvcnQgdGhlIGltcGVhY2htZW50CiAgICAgICAgbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZWRbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLnZvdGVzU3VwcG9ydGluZyArPSB2b3RpbmdSaWdodHNbbXNnLnNlbmRlcl07CgogICAgICAgIC8vIHJpc2UgaW1wZWFjaG1lbnQgc3VwcHBvcnRpbmcgZXZlbnQKICAgICAgICBJbXBlYWNobWVudFN1cHBvcnQobXNnLnNlbmRlciwgdm90aW5nUmlnaHRzW21zZy5zZW5kZXJdKTsKICAgICAgICAKICAgICAgICAvLyBpZiB0aGUgdm90ZSBpcyBvdmVyIDcwJSBleGVjdXRlIHRoZSBzd2l0Y2ggCiAgICAgICAgdWludCBwZXJjZW50ID0gcHJlZmVyZWRRdHlTb2xkIC8gMTAwOyAKICAgICAgICAKICAgICAgICBpZiAobGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZXNTdXBwb3J0aW5nID49IDcwICogcGVyY2VudCl7CiAgICAgICAgICAgIGV4ZWN1dGl2ZSA9IGxhc3RJbXBlYWNobWVudFByb3Bvc2FsLm5ld0V4ZWN1dGl2ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGltcGVhY2htZW50IGV2ZW50CiAgICAgICAgICAgIEltcGVhY2htZW50QWNjZXB0ZWQoZXhlY3V0aXZlKTsKICAgICAgICB9CiAgICAgICAgCiAgICB9IAogICAgCiAgICAgIAogICAgCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqIC8vCiAgICAvLyAqICAgICBDb25zdGFudCBHZXR0ZXJzICAgICAqIC8vCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqIC8vCiAgICAKICAgIGZ1bmN0aW9uIHZvdGluZ1JpZ2h0c09mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlc3VsdCkgewogICAgICAgIHJlc3VsdCA9IHZvdGluZ1JpZ2h0c1tfb3duZXJdOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRQcmVmZXJlZFF0eVNvbGQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIHByZWZlcmVkUXR5U29sZDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0VmlydHVhbEV4Y2hhbmdlKGFkZHJlc3MgdmlydHVhbEV4Y2hhbmdlQWRkcil7CiAgICAgICAgdmlydHVhbEV4Y2hhbmdlQWRkcmVzcyA9IHZpcnR1YWxFeGNoYW5nZUFkZHI7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SEtHT3duZWQoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGhhY2tlckdvbGQuYmFsYW5jZU9mKHRoaXMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRFdGhlclZhbHVlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpewogICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldEV4ZWN1dGl2ZSgpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgcmVzdWx0KXsKICAgICAgICByZXR1cm4gZXhlY3V0aXZlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRIS0dQcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gaGtnUHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXRoZXJQcmljZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gZXRoZXJQcmljZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0RFNUTmFtZSgpIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9ICAgIAogICAgCiAgICBmdW5jdGlvbiBnZXREU1ROYW1lQnl0ZXMoKSBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIgcmVzdWx0KXsKICAgICAgICByZXR1cm4gY29udmVydChuYW1lKTsKICAgIH0gICAgCgogICAgZnVuY3Rpb24gZ2V0RFNUU3ltYm9sKCkgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcgcmVzdWx0KXsKICAgICAgICByZXR1cm4gc3ltYm9sOwogICAgfSAgICAKICAgIAogICAgZnVuY3Rpb24gZ2V0RFNUU3ltYm9sQnl0ZXMoKSBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIgcmVzdWx0KXsKICAgICAgICByZXR1cm4gY29udmVydChzeW1ib2wpOwogICAgfSAgICAKCiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyByZXN1bHQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0VG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlc3VsdCkgewogICAgICAgIHJldHVybiB0b3RhbFN1cHBseTsKICAgIH0gCiAgICAgICAgCiAgICBmdW5jdGlvbiBnZXRDb2xsZWN0ZWRFdGhlcigpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0cykgeyAgICAgICAgCiAgICAgICAgcmV0dXJuIGNvbGxlY3RlZEV0aGVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRDb3VudGVyUHJvcG9zYWxzKCkgY29uc3RhbnQgcmV0dXJucyAodWludCByZXN1bHQpewogICAgICAgIHJldHVybiBjb3VudGVyUHJvcG9zYWxzOwogICAgfQogICAgICAgIAogICAgZnVuY3Rpb24gZ2V0UHJvcG9zYWxJZEJ5SW5kZXgodWludCBpKSBjb25zdGFudCByZXR1cm5zIChieXRlczMyIHJlc3VsdCl7CiAgICAgICAgcmV0dXJuIGxpc3RQcm9wb3NhbHNbaV0uaWQ7CiAgICB9ICAgIAoKICAgIGZ1bmN0aW9uIGdldFByb3Bvc2FsT2JqZWN0aW9uQnlJbmRleCh1aW50IGkpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gbGlzdFByb3Bvc2Fsc1tpXS52b3Rlc09iamVjdGluZzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQcm9wb3NhbFZhbHVlQnlJbmRleCh1aW50IGkpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gbGlzdFByb3Bvc2Fsc1tpXS52YWx1ZTsKICAgIH0gICAgICAgICAgICAgICAgICAKICAgIAogICAgZnVuY3Rpb24gZ2V0Q3VycmVudEltcGVhY2htZW50VXJsRGV0YWlscygpIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyByZXN1bHQpewogICAgICAgIHJldHVybiBsYXN0SW1wZWFjaG1lbnRQcm9wb3NhbC51cmxEZXRhaWxzOwogICAgfQogICAgCiAgICAKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRJbXBlYWNobWVudFZvdGVzU3VwcG9ydGluZygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gbGFzdEltcGVhY2htZW50UHJvcG9zYWwudm90ZXNTdXBwb3J0aW5nOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjb252ZXJ0KHN0cmluZyBrZXkpIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7CiAgICAgICAgICAgIGlmIChieXRlcyhrZXkpLmxlbmd0aCA+IDMyKSB7CiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgfSAgICAgIAoKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgcmV0IDo9IG1sb2FkKGFkZChrZXksIDMyKSkKICAgICAgICAgICAgfQogICAgfSAgICAKICAgIAogICAgCiAgICAKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKiAvLwogICAgLy8gKiAgICAgTW9kaWZpZXJzICAgICAqIC8vCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKiogLy8gICAgCiAKICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVFbmQoKSB7IGlmIChub3cgID49ICBldmVudEluZm8uZ2V0RXZlbnRFbmQoKSkgdGhyb3c7IF87IH0KICAgIG1vZGlmaWVyIG9ubHlBZnRlckVuZCgpICB7IGlmIChub3cgIDwgICBldmVudEluZm8uZ2V0RXZlbnRFbmQoKSkgdGhyb3c7IF87IH0KICAgIAogICAgbW9kaWZpZXIgb25seUFmdGVyVHJhZGluZ1N0YXJ0KCkgIHsgaWYgKG5vdyAgPCBldmVudEluZm8uZ2V0VHJhZGluZ1N0YXJ0KCkpIHRocm93OyBfOyB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlFeGVjdXRpdmUoKSAgICAgeyBpZiAobXNnLnNlbmRlciAhPSBleGVjdXRpdmUpIHRocm93OyBfOyB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgbW9kaWZpZXIgb25seUlmQWJsZVRvSXNzdWVUb2tlbnMoKSAgeyBpZiAoIWFibGVUb0lzc3VlVG9rZW5zKSB0aHJvdzsgXzsgfSAKICAgIAoKICAgIC8vICoqKioqKioqKioqKioqKioqKiAvLwogICAgLy8gKiAgICAgRXZlbnRzICAgICAqIC8vCiAgICAvLyAqKioqKioqKioqKioqKioqKiogLy8gICAgICAgIAoKICAgIAogICAgZXZlbnQgUHJpY2VIS0dDaGFuZ2UodWludCBpbmRleGVkIHF0eUZvck9uZUhLRywgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSk7CiAgICBldmVudCBCdXlGb3JIS0dUcmFuc2FjdGlvbihhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQgaW5kZXhlZCB0b2tlbnNTb2xkLCB1aW50IGluZGV4ZWQgdG90YWxTdXBwbHksIHVpbnQgcXR5Rm9yT25lSEtHLCB1aW50IHRva2Vuc0Ftb3VudCk7CiAgICBldmVudCBCdXlGb3JFdGhlclRyYW5zYWN0aW9uKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludCBpbmRleGVkIHRva2Vuc1NvbGQsIHVpbnQgaW5kZXhlZCB0b3RhbFN1cHBseSwgdWludCBxdHlGb3JPbmVFdGhlciwgdWludCB0b2tlbnNBbW91bnQpOwoKICAgIGV2ZW50IERzdFRva2Vuc0lzc3VlZCh1aW50IGluZGV4ZWQgcXR5Rm9yT25lSEtHLCB1aW50IGluZGV4ZWQgdG9rZW5zU29sZCwgdWludCBpbmRleGVkIHRvdGFsU3VwcGx5LCB1aW50IHF0eVRvRW1pdCk7CiAgICAKICAgIGV2ZW50IFByb3Bvc2FsUmVxdWVzdFN1Ym1pdHRlZChieXRlczMyIGlkLCB1aW50IHZhbHVlLCB1aW50IHRpbWVFbmRzLCBzdHJpbmcgdXJsLCBhZGRyZXNzIHNlbmRlcik7CiAgICAKICAgIGV2ZW50IEV0aGVyUmVkZWVtQWNjZXB0ZWQoYWRkcmVzcyBzZW5kZXIsIHVpbnQgdmFsdWUpOwogICAgCiAgICBldmVudCBPYmplY3RlZFZvdGUoYnl0ZXMzMiBpZCwgYWRkcmVzcyB2b3RlciwgdWludCB2b3Rlcyk7CiAgICAKICAgIGV2ZW50IEltcGVhY2htZW50UHJvcG9zZWQoYWRkcmVzcyBzdWJtaXR0ZXIsIHN0cmluZyB1cmxEZXRhaWxzLCB1aW50IHZvdGluZEVuZFRTLCBhZGRyZXNzIG5ld0V4ZWN1dGl2ZSk7CiAgICBldmVudCBJbXBlYWNobWVudFN1cHBvcnQoYWRkcmVzcyBzdXBwb3J0dGVyLCB1aW50IHZvdGVzKTsKICAgIAogICAgZXZlbnQgSW1wZWFjaG1lbnRBY2NlcHRlZChhZGRyZXNzIG5ld0V4ZWN1dGl2ZSk7CgogICAgZXZlbnQgTmV3RXRoZXJQcmljZSh1aW50IG5ld1F0eUZvck9uZUV0aGVyKTsKICAgIGV2ZW50IERpc2FibGVUb2tlbklzc3VhbmNlKCk7CiAgICAKICAgIGV2ZW50IEJ1cm5lZEFsbFJlbWFpbmVkVG9rZW5zKCk7CiAgICAKfQoKCiAKCi8qKgogKiAgVmlydHVhbEV4Y2hhbmdlIC0gIFRoZSBleGNoYW5nZSBpcyBhIHRyYWRpbmcgc3lzdGVtIHVzZWQKICogICAgICAgICAgICAgICAgICAgICBvbiBoYWNrLmV0aGVyLmNhbXAgaGFja2F0aG9uIGV2ZW50IHRvIAogKiAgICAgICAgICAgICAgICAgICAgIHN1cHBvcnQgdHJhZGluZyBhIERTVCB0b2tlbnMgZm9yIEhLRy4gCiAqICAgICAgICAgICAgICAgICAgICAKICovCmNvbnRyYWN0IFZpcnR1YWxFeGNoYW5nZXsKCiAgICBhZGRyZXNzIG93bmVyOyAgCiAgICBFdmVudEluZm8gZXZlbnRJbmZvOwogCiAgICBtYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIGRzdExpc3RlZDsKICAgIAogICAgSGFja2VyR29sZCBoYWNrZXJHb2xkOwogICAgCiAgICBmdW5jdGlvbiBWaXJ0dWFsRXhjaGFuZ2UoYWRkcmVzcyBoYWNrZXJHb2xkQWRkciwgYWRkcmVzcyBldmVudEluZm9BZGRyKXsKICAgIAogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBoYWNrZXJHb2xkID0gSGFja2VyR29sZChoYWNrZXJHb2xkQWRkcik7CiAgICAgICAgZXZlbnRJbmZvICA9IEV2ZW50SW5mbyhldmVudEluZm9BZGRyKTsKICAgIH0KICAgIAogICAgCiAgICAvKioKICAgICAqIGVubGlzdCAtIGVubGlzdGluZyBvbmUgZGVjZW50cmFsaXplZCBzdGFydHVwIHRlYW0gdG8gCiAgICAgKiAgICAgICAgICB0aGUgaGFjayBldmVudCB2aXJ0dWFsIGV4Y2hhbmdlLCBtYWtpbmcgdGhlIAogICAgICogICAgICAgICAgRFNUIGluaXRhdGVkIHRva2VucyBhdmFpbGFibGUgZm9yIGFjcXVpc2l0aW9uLgogICAgICogCiAgICAgKiAgQHBhcmFtIGRzdEFkZHJlc3MgLSBhZGRyZXNzIG9mIHRoZSBEU1RDb250cmFjdCAKICAgICAqIAogICAgICovIAogICAgZnVuY3Rpb24gZW5saXN0KGFkZHJlc3MgZHN0QWRkcmVzcykgb25seUJlZm9yZUVuZCB7CgogICAgICAgIERTVENvbnRyYWN0IGRzdENvbnRyYWN0ID0gRFNUQ29udHJhY3QoZHN0QWRkcmVzcyk7CgogICAgICAgIGJ5dGVzMzIgc3ltYm9sQnl0ZXMgPSBkc3RDb250cmFjdC5nZXREU1RTeW1ib2xCeXRlcygpOwoKICAgICAgICAvKiBEb24ndCBlbmxpc3QgMiB3aXRoIHRoZSBzYW1lIG5hbWUgKi8KICAgICAgICBpZiAoaXNFeGlzdEJ5Qnl0ZXMoc3ltYm9sQnl0ZXMpKSB0aHJvdzsKCiAgICAgICAgLy8gT25seSBvd25lciBvZiB0aGUgRFNUIGNhbiBkZXBsb3kgdGhlIERTVCAKICAgICAgICBpZiAoZHN0Q29udHJhY3QuZ2V0RXhlY3V0aXZlKCkgIT0gbXNnLnNlbmRlcikgdGhyb3c7CgogICAgICAgIC8vIEFsbCBnb29kIGVubGlzdCB0aGUgY29tcGFueQogICAgICAgIGRzdExpc3RlZFtzeW1ib2xCeXRlc10gPSBkc3RBZGRyZXNzOwogICAgICAgIAogICAgICAgIC8vIEluZGljYXRlIHRvIERTVCB3aGljaCBWaXJ0dWFsIEV4Y2hhbmdlIGlzIGVubGlzdGVkCiAgICAgICAgZHN0Q29udHJhY3Quc2V0VmlydHVhbEV4Y2hhbmdlKGFkZHJlc3ModGhpcykpOwogICAgICAgIAogICAgICAgIC8vIHJpc2UgRW5saXN0ZWQgZXZlbnQKICAgICAgICBFbmxpc3RlZChkc3RBZGRyZXNzKTsKICAgIH0KICAgIAogICAKCiAgICAvKioKICAgICAqCiAgICAgKiBidXkgLSBvbiB0aGUgaGFja2F0aG9uIHRpbWVmcmFtZSB0aGF0IGlzIHRoZSBmdW5jdGlvbiAKICAgICAqICAgICAgIHRoYXQgd2lsbCBiZSB0aGUgd2F5IHRvIGJ1eSBzcGVjaWZpYyB0b2tlbnMgZm9yIAogICAgICogICAgICAgc3RhcnR1cC4KICAgICAqIAogICAgICogQHBhcmFtIGNvbXBhbnlOYW1lQnl0ZXMgLSB0aGUgY29tcGFueSB0aGF0IGlzIGVubGlzdGVkIG9uIHRoZSBleGNoYW5nZSAKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kIHRoZSB0b2tlbnMgYXJlIGF2YWlsYWJsZQogICAgICogCiAgICAgKiBAcGFyYW0gaGtnIC0gdGhlIGFtbW91bnQgb2YgaGtnIHRvIHNwZW5kIGZvciBhcXVhc3Rpb24gCiAgICAgKgogICAgICovCiAgICBmdW5jdGlvbiBidXkoYnl0ZXMzMiBjb21wYW55TmFtZUJ5dGVzLCB1aW50IGhrZykgb25seUJlZm9yZUVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgIAogICAgICAgIC8vIGNoZWNrIERTVCBleGlzdCAKICAgICAgICBpZiAoIWlzRXhpc3RCeUJ5dGVzKGNvbXBhbnlOYW1lQnl0ZXMpKSB0aHJvdzsKCiAgICAgICAgLy8gdmFsaWRhdGUgYXZhaWxhYmlsaXR5ICAKICAgICAgICBEU1RDb250cmFjdCBkc3RDb250cmFjdCA9IERTVENvbnRyYWN0KGRzdExpc3RlZFtjb21wYW55TmFtZUJ5dGVzXSk7CiAgICAgICAgdWludCB0b2tlbnNRdHkgPSBoa2cgKiBkc3RDb250cmFjdC5nZXRIS0dQcmljZSgpOwoKICAgICAgICBhZGRyZXNzIHZlQWRkcmVzcyA9IGFkZHJlc3ModGhpcyk7ICAgICAgICAKICAgICAgICAKICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGVyZSBpcyBIS0cgYmFsYW5jZQogICAgICAgIHVpbnQgdmFsdWVIS0dPd25lZCA9IGhhY2tlckdvbGQuYmFsYW5jZU9mKG1zZy5zZW5kZXIpOyAgICAgICAgCiAgICAgICAgaWYgKHZhbHVlSEtHT3duZWQgPCBoa2cpIHRocm93OyAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlcmUgaXMgSEtHIHRva2VuIGFsbG93ZWQgdG8gYmUgc3BlbmQKICAgICAgICB1aW50IHZhbHVlQXZhaWxiZU9uRXhjaGFuZ2UgPSBoYWNrZXJHb2xkLmFsbG93YW5jZShtc2cuc2VuZGVyLCB2ZUFkZHJlc3MpOwogICAgICAgIGlmICh2YWx1ZUF2YWlsYmVPbkV4Y2hhbmdlIDwgaGtnKSB0aHJvdzsKCiAgICAgICAgLy8gZW5zdXJlIHRoZXJlIGlzIERTVCB0b2tlbnMgZm9yIHNhbGUKICAgICAgICB1aW50IGRzdFRva2VucyA9IGRzdENvbnRyYWN0LmFsbG93YW5jZShkc3RDb250cmFjdCwgdmVBZGRyZXNzKTsKICAgICAgICBpZiAoZHN0VG9rZW5zIDwgaGtnICogZHN0Q29udHJhY3QuZ2V0SEtHUHJpY2UoKSkgdGhyb3c7ICAgIAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAvLyBUcmFuc2ZlciBIS0cgdG8gVmlydHVhbCBFeGNoYW5nZSBhY2NvdW50ICAKICAgICAgICBoYWNrZXJHb2xkLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB2ZUFkZHJlc3MsIGhrZyk7CgogICAgICAgIC8vIFRyYW5zZmVyIHRvIGRzdENvdHJhY3Qgb3duZXJzaGlwCiAgICAgICAgaGFja2VyR29sZC50cmFuc2Zlcihkc3RDb250cmFjdC5nZXRBZGRyZXNzKCksIGhrZyk7ICAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gQ2FsbCBEU1QgdG8gdHJhbnNmZXIgdG9rZW5zIAogICAgICAgIGRzdENvbnRyYWN0LmJ1eUZvckhhY2tlckdvbGQoaGtnKTsgICAgICAgICAgICAKICAgIH0KICAgICAgICAKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqIC8vCiAgICAvLyAqICAgICBDb25zdGFudCBHZXR0ZXJzICAgICAqIC8vCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqIC8vICAgICAgICAKICAgIAoKICAgIGZ1bmN0aW9uIGlzRXhpc3RCeUJ5dGVzKGJ5dGVzMzIgY29tcGFueU5hbWVCeXRlcykgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXN1bHQpIHsKICAgICAgICAgICAgCiAgICAgICAgaWYgKGRzdExpc3RlZFtjb21wYW55TmFtZUJ5dGVzXSA9PSAweDApIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgZWxzZSAKICAgICAgICAgICAgcmV0dXJuIHRydWU7ICAgICAgICAgICAgICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldEV2ZW50U3RhcnQoKSBjb25zdGFudCBldmVudEluZm9TZXQgcmV0dXJucyAodWludCByZXN1bHQpewogICAgICAgIHJldHVybiBldmVudEluZm8uZ2V0RXZlbnRTdGFydCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV2ZW50RW5kKCkgY29uc3RhbnQgZXZlbnRJbmZvU2V0IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gZXZlbnRJbmZvLmdldEV2ZW50RW5kKCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGdldE5vdygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVzdWx0KXsKICAgICAgICByZXR1cm4gbm93OwogICAgfQogICAgCgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKiAvLwogICAgLy8gKiAgICAgTW9kaWZpZXJzICAgICAqIC8vCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKiogLy8gICAgICAgIAogICAgCgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgICAgeyBpZiAobXNnLnNlbmRlciAhPSBvd25lcikgICAgICAgIHRocm93OyBfOyB9CiAgICBtb2RpZmllciBldmVudEluZm9TZXQoKSB7IGlmIChldmVudEluZm8gID09IGFkZHJlc3MoMCkpICAgdGhyb3c7IF87IH0KICAgIAogICAgbW9kaWZpZXIgb25seUJlZm9yZUVuZCgpIHsgaWYgKG5vdyAgPj0gZXZlbnRJbmZvLmdldEV2ZW50RW5kKCkpIHRocm93OyBfOyB9CiAgICBtb2RpZmllciBvbmx5QWZ0ZXJFbmQoKSAgeyBpZiAobm93ICA8ICBldmVudEluZm8uZ2V0RXZlbnRFbmQoKSkgdGhyb3c7IF87IH0KICAgIAoKICAgIC8vICoqKioqKioqKioqKioqKioqKiAvLwogICAgLy8gKiAgICAgRXZlbnRzICAgICAqIC8vCiAgICAvLyAqKioqKioqKioqKioqKioqKiogLy8gICAgICAgIAogICAgCiAgICBldmVudCBFbmxpc3RlZChhZGRyZXNzIGluZGV4ZWQgZHN0Q29udHJhY3QpOwogICAgCiAgICAKfQ=='.
	

]
