Class {
	#name : #SRT939c0304e9033761e4b510a93386ba3bebc983ba,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT939c0304e9033761e4b510a93386ba3bebc983ba >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIE93bmVkIGNvbnRyYWN0IHdpdGggc2FmZSBvd25lcnNoaXAgcGFzcy4KICoKICogTm90ZTogYWxsIHRoZSBub24gY29uc3RhbnQgZnVuY3Rpb25zIHJldHVybiBmYWxzZSBpbnN0ZWFkIG9mIHRocm93aW5nIGluIGNhc2UgaWYgc3RhdGUgY2hhbmdlCiAqIGRpZG4ndCBoYXBwZW4geWV0LgogKi8KY29udHJhY3QgT3duZWQgewogICAgLyoqCiAgICAgKiBDb250cmFjdCBvd25lciBhZGRyZXNzCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIGNvbnRyYWN0T3duZXI7CgogICAgLyoqCiAgICAgKiBDb250cmFjdCBvd25lciBhZGRyZXNzCiAgICAgKi8KICAgIGFkZHJlc3MgcHVibGljIHBlbmRpbmdDb250cmFjdE93bmVyOwoKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIGNvbnRyYWN0T3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IE93bmVyIGNoZWNrIG1vZGlmaWVyCiAgICAqLwogICAgbW9kaWZpZXIgb25seUNvbnRyYWN0T3duZXIoKSB7CiAgICAgICAgaWYgKGNvbnRyYWN0T3duZXIgPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRGVzdHJveSBjb250cmFjdCBhbmQgc2NydWIgYSBkYXRhCiAgICAgKiBAbm90aWNlIE9ubHkgb3duZXIgY2FuIGNhbGwgaXQKICAgICAqLwogICAgZnVuY3Rpb24gZGVzdHJveSgpIG9ubHlDb250cmFjdE93bmVyIHsKICAgICAgICBzdWljaWRlKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8qKgogICAgICogUHJlcGFyZXMgb3duZXJzaGlwIHBhc3MuCiAgICAgKgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGN1cnJlbnQgb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF90byBhZGRyZXNzIG9mIHRoZSBuZXh0IG93bmVyLiAweDAgaXMgbm90IGFsbG93ZWQuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cmFjdE93bmVyc2hpcChhZGRyZXNzIF90bykgb25seUNvbnRyYWN0T3duZXIoKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAoX3RvICA9PSAweDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcGVuZGluZ0NvbnRyYWN0T3duZXIgPSBfdG87CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5hbGl6ZSBvd25lcnNoaXAgcGFzcy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgcGVuZGluZyBvd25lci4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsYWltQ29udHJhY3RPd25lcnNoaXAoKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAocGVuZGluZ0NvbnRyYWN0T3duZXIgIT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBjb250cmFjdE93bmVyID0gcGVuZGluZ0NvbnRyYWN0T3duZXI7CiAgICAgICAgZGVsZXRlIHBlbmRpbmdDb250cmFjdE93bmVyOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKCmNvbnRyYWN0IEVSQzIwSW50ZXJmYWNlIHsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKfQoKLyoqCiAqIEB0aXRsZSBHZW5lcmljIG93bmVkIGRlc3Ryb3lhYmxlIGNvbnRyYWN0CiAqLwpjb250cmFjdCBPYmplY3QgaXMgT3duZWQgewogICAgLyoqCiAgICAqICBDb21tb24gcmVzdWx0IGNvZGUuIE1lYW5zIGV2ZXJ5dGhpbmcgaXMgZmluZS4KICAgICovCiAgICB1aW50IGNvbnN0YW50IE9LID0gMTsKICAgIHVpbnQgY29uc3RhbnQgT1dORURfQUNDRVNTX0RFTklFRF9PTkxZX0NPTlRSQUNUX09XTkVSID0gODsKCiAgICBmdW5jdGlvbiB3aXRoZHJhd25Ub2tlbnMoYWRkcmVzc1tdIHRva2VucywgYWRkcmVzcyBfdG8pIG9ubHlDb250cmFjdE93bmVyIHJldHVybnModWludCkgewogICAgICAgIGZvcih1aW50IGk9MDtpPHRva2Vucy5sZW5ndGg7aSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgdG9rZW4gPSB0b2tlbnNbaV07CiAgICAgICAgICAgIHVpbnQgYmFsYW5jZSA9IEVSQzIwSW50ZXJmYWNlKHRva2VuKS5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgICAgIGlmKGJhbGFuY2UgIT0gMCkKICAgICAgICAgICAgICAgIEVSQzIwSW50ZXJmYWNlKHRva2VuKS50cmFuc2ZlcihfdG8sYmFsYW5jZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGVja09ubHlDb250cmFjdE93bmVyKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKGNvbnRyYWN0T3duZXIgPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICByZXR1cm4gT0s7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gT1dORURfQUNDRVNTX0RFTklFRF9PTkxZX0NPTlRSQUNUX09XTkVSOwogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBHZW5lcmFsIE11bHRpRXZlbnRzSGlzdG9yeSB1c2VyLgogKgogKi8KY29udHJhY3QgTXVsdGlFdmVudHNIaXN0b3J5QWRhcHRlciB7CgogICAgLyoqCiAgICAqICAgQGRldiBJdCBpcyBhZGRyZXNzIG9mIE11bHRpRXZlbnRzSGlzdG9yeSBjYWxsZXIgYXNzdW1pbmcgd2UgYXJlIGluc2lkZSBvZiBkZWxlZ2F0ZSBjYWxsLgogICAgKi8KICAgIGZ1bmN0aW9uIF9zZWxmKCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBtc2cuc2VuZGVyOwogICAgfQp9CgovKioKICogQHRpdGxlIEJNQyBQbGF0Zm9ybSBFbWl0dGVyLgogKgogKiBDb250YWlucyBhbGwgdGhlIG9yaWdpbmFsIGV2ZW50IGVtaXR0aW5nIGZ1bmN0aW9uIGRlZmluaXRpb25zIGFuZCBldmVudHMuCiAqIEluIGNhc2Ugb2YgbmV3IGV2ZW50cyBuZWVkZWQgbGF0ZXIsIGFkZGl0aW9uYWwgZW1pdHRlcnMgY2FuIGJlIGRldmVsb3BlZC4KICogQWxsIHRoZSBmdW5jdGlvbnMgaXMgbWVhbnQgdG8gYmUgY2FsbGVkIHVzaW5nIGRlbGVnYXRlY2FsbC4KICovCgpjb250cmFjdCBCTUNQbGF0Zm9ybUVtaXR0ZXIgaXMgTXVsdGlFdmVudHNIaXN0b3J5QWRhcHRlciB7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCBieXRlczMyIGluZGV4ZWQgc3ltYm9sLCB1aW50IHZhbHVlLCBzdHJpbmcgcmVmZXJlbmNlKTsKICAgIGV2ZW50IElzc3VlKGJ5dGVzMzIgaW5kZXhlZCBzeW1ib2wsIHVpbnQgdmFsdWUsIGFkZHJlc3MgYnkpOwogICAgZXZlbnQgUmV2b2tlKGJ5dGVzMzIgaW5kZXhlZCBzeW1ib2wsIHVpbnQgdmFsdWUsIGFkZHJlc3MgYnkpOwogICAgZXZlbnQgT3duZXJzaGlwQ2hhbmdlKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIGJ5dGVzMzIgaW5kZXhlZCBzeW1ib2wpOwogICAgZXZlbnQgQXBwcm92ZShhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIGJ5dGVzMzIgaW5kZXhlZCBzeW1ib2wsIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgUmVjb3ZlcnkoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgYWRkcmVzcyBieSk7CiAgICBldmVudCBFcnJvcihieXRlczMyIG1lc3NhZ2UpOwoKICAgIGZ1bmN0aW9uIGVtaXRUcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSwgc3RyaW5nIF9yZWZlcmVuY2UpIHsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfc3ltYm9sLCBfdmFsdWUsIF9yZWZlcmVuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVtaXRJc3N1ZShieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIF9ieSkgewogICAgICAgIElzc3VlKF9zeW1ib2wsIF92YWx1ZSwgX2J5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbWl0UmV2b2tlKGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUsIGFkZHJlc3MgX2J5KSB7CiAgICAgICAgUmV2b2tlKF9zeW1ib2wsIF92YWx1ZSwgX2J5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbWl0T3duZXJzaGlwQ2hhbmdlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCBieXRlczMyIF9zeW1ib2wpIHsKICAgICAgICBPd25lcnNoaXBDaGFuZ2UoX2Zyb20sIF90bywgX3N5bWJvbCk7CiAgICB9CgogICAgZnVuY3Rpb24gZW1pdEFwcHJvdmUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfc3BlbmRlciwgYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSkgewogICAgICAgIEFwcHJvdmUoX2Zyb20sIF9zcGVuZGVyLCBfc3ltYm9sLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVtaXRSZWNvdmVyeShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgYWRkcmVzcyBfYnkpIHsKICAgICAgICBSZWNvdmVyeShfZnJvbSwgX3RvLCBfYnkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVtaXRFcnJvcihieXRlczMyIF9tZXNzYWdlKSB7CiAgICAgICAgRXJyb3IoX21lc3NhZ2UpOwogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IFByb3h5IHsKICAgIGZ1bmN0aW9uIGVtaXRUcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpOwogICAgZnVuY3Rpb24gZW1pdEFwcHJvdmUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEJNQyBQbGF0Zm9ybS4KICoKICogVGhlIG9mZmljaWFsIEJNQyBhc3NldHMgcGxhdGZvcm0gcG93ZXJpbmcgQk1DIHRva2VuLCBhbmQgcG9zc2libHkKICogb3RoZXIgdW5rbm93biB0b2tlbnMgbmVlZGVkIGxhdGVyLgogKiBQbGF0Zm9ybSB1c2VzIE11bHRpRXZlbnRzSGlzdG9yeSBjb250cmFjdCB0byBrZWVwIGV2ZW50cywgc28gdGhhdCBpbiBjYXNlIGl0IG5lZWRzIHRvIGJlIHJlZGVwbG95ZWQKICogYXQgc29tZSBwb2ludCwgYWxsIHRoZSBldmVudHMga2VlcCBhcHBlYXJpbmcgYXQgdGhlIHNhbWUgcGxhY2UuCiAqCiAqIEV2ZXJ5IGFzc2V0IGlzIG1lYW50IHRvIGJlIHVzZWQgdGhyb3VnaCBhIHByb3h5IGNvbnRyYWN0LiBPbmx5IG9uZSBwcm94eSBjb250cmFjdCBoYXZlIGFjY2VzcwogKiByaWdodHMgZm9yIGEgcGFydGljdWxhciBhc3NldC4KICoKICogRmVhdHVyZXM6IHRyYW5zZmVycywgYWxsb3dhbmNlcywgc3VwcGx5IGFkanVzdG1lbnRzLCBsb3N0IHdhbGxldCBhY2Nlc3MgcmVjb3ZlcnkuCiAqCiAqIE5vdGU6IGFsbCB0aGUgbm9uIGNvbnN0YW50IGZ1bmN0aW9ucyByZXR1cm4gZmFsc2UgaW5zdGVhZCBvZiB0aHJvd2luZyBpbiBjYXNlIGlmIHN0YXRlIGNoYW5nZQogKiBkaWRuJ3QgaGFwcGVuIHlldC4KICovCmNvbnRyYWN0IEJNQ1BsYXRmb3JtIGlzIE9iamVjdCwgQk1DUGxhdGZvcm1FbWl0dGVyIHsKCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9TQ09QRSA9IDE1MDAwOwogICAgdWludCBjb25zdGFudCBCTUNfUExBVEZPUk1fUFJPWFlfQUxSRUFEWV9FWElTVFMgPSBCTUNfUExBVEZPUk1fU0NPUEUgKyAwOwogICAgdWludCBjb25zdGFudCBCTUNfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYgPSBCTUNfUExBVEZPUk1fU0NPUEUgKyAxOwogICAgdWludCBjb25zdGFudCBCTUNfUExBVEZPUk1fSU5WQUxJRF9WQUxVRSA9IEJNQ19QTEFURk9STV9TQ09QRSArIDI7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9JTlNVRkZJQ0lFTlRfQkFMQU5DRSA9IEJNQ19QTEFURk9STV9TQ09QRSArIDM7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9OT1RfRU5PVUdIX0FMTE9XQU5DRSA9IEJNQ19QTEFURk9STV9TQ09QRSArIDQ7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9BU1NFVF9BTFJFQURZX0lTU1VFRCA9IEJNQ19QTEFURk9STV9TQ09QRSArIDU7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9DQU5OT1RfSVNTVUVfRklYRURfQVNTRVRfV0lUSF9JTlZBTElEX1ZBTFVFID0gQk1DX1BMQVRGT1JNX1NDT1BFICsgNjsKICAgIHVpbnQgY29uc3RhbnQgQk1DX1BMQVRGT1JNX0NBTk5PVF9SRUlTU1VFX0ZJWEVEX0FTU0VUID0gQk1DX1BMQVRGT1JNX1NDT1BFICsgNzsKICAgIHVpbnQgY29uc3RhbnQgQk1DX1BMQVRGT1JNX1NVUFBMWV9PVkVSRkxPVyA9IEJNQ19QTEFURk9STV9TQ09QRSArIDg7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9OT1RfRU5PVUdIX1RPS0VOUyA9IEJNQ19QTEFURk9STV9TQ09QRSArIDk7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9JTlZBTElEX05FV19PV05FUiA9IEJNQ19QTEFURk9STV9TQ09QRSArIDEwOwogICAgdWludCBjb25zdGFudCBCTUNfUExBVEZPUk1fQUxSRUFEWV9UUlVTVEVEID0gQk1DX1BMQVRGT1JNX1NDT1BFICsgMTE7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9TSE9VTERfUkVDT1ZFUl9UT19ORVdfQUREUkVTUyA9IEJNQ19QTEFURk9STV9TQ09QRSArIDEyOwogICAgdWludCBjb25zdGFudCBCTUNfUExBVEZPUk1fQVNTRVRfSVNfTk9UX0lTU1VFRCA9IEJNQ19QTEFURk9STV9TQ09QRSArIDEzOwogICAgdWludCBjb25zdGFudCBCTUNfUExBVEZPUk1fQUNDRVNTX0RFTklFRF9PTkxZX09XTkVSID0gQk1DX1BMQVRGT1JNX1NDT1BFICsgMTQ7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9BQ0NFU1NfREVOSUVEX09OTFlfUFJPWFkgPSBCTUNfUExBVEZPUk1fU0NPUEUgKyAxNTsKICAgIHVpbnQgY29uc3RhbnQgQk1DX1BMQVRGT1JNX0FDQ0VTU19ERU5JRURfT05MWV9UUlVTVEVEID0gQk1DX1BMQVRGT1JNX1NDT1BFICsgMTY7CiAgICB1aW50IGNvbnN0YW50IEJNQ19QTEFURk9STV9JTlZBTElEX0lOVk9DQVRJT04gPSBCTUNfUExBVEZPUk1fU0NPUEUgKyAxNzsKICAgIHVpbnQgY29uc3RhbnQgQk1DX1BMQVRGT1JNX0hPTERFUl9FWElTVFMgPSBCTUNfUExBVEZPUk1fU0NPUEUgKyAxODsKCiAgICAvLyBTdHJ1Y3R1cmUgb2YgYSBwYXJ0aWN1bGFyIGFzc2V0LgogICAgc3RydWN0IEFzc2V0IHsKICAgICAgICB1aW50IG93bmVyOyAgICAgICAgICAgICAgICAgICAgICAgLy8gQXNzZXQncyBvd25lciBpZC4KICAgICAgICB1aW50IHRvdGFsU3VwcGx5OyAgICAgICAgICAgICAgICAgLy8gQXNzZXQncyB0b3RhbCBzdXBwbHkuCiAgICAgICAgc3RyaW5nIG5hbWU7ICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc2V0J3MgbmFtZSwgZm9yIGluZm9ybWF0aW9uIHB1cnBvc2VzLgogICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbjsgICAgICAgICAgICAgICAvLyBBc3NldCdzIGRlc2NyaXB0aW9uLCBmb3IgaW5mb3JtYXRpb24gcHVycG9zZXMuCiAgICAgICAgYm9vbCBpc1JlaXNzdWFibGU7ICAgICAgICAgICAgICAgIC8vIEluZGljYXRlcyBpZiBhc3NldCBoYXZlIGR5bmFtaWMgb3IgZml4ZWQgc3VwcGx5LgogICAgICAgIHVpbnQ4IGJhc2VVbml0OyAgICAgICAgICAgICAgICAgICAvLyBQcm9wb3NlZCBudW1iZXIgb2YgZGVjaW1hbHMuCiAgICAgICAgbWFwcGluZyh1aW50ID0+IFdhbGxldCkgd2FsbGV0czsgIC8vIEhvbGRlcnMgd2FsbGV0cy4KICAgIH0KCiAgICAvLyBTdHJ1Y3R1cmUgb2YgYW4gYXNzZXQgaG9sZGVyIHdhbGxldCBmb3IgcGFydGljdWxhciBhc3NldC4KICAgIHN0cnVjdCBXYWxsZXQgewogICAgICAgIHVpbnQgYmFsYW5jZTsKICAgICAgICBtYXBwaW5nKHVpbnQgPT4gdWludCkgYWxsb3dhbmNlOwogICAgfQoKICAgIC8vIFN0cnVjdHVyZSBvZiBhbiBhc3NldCBob2xkZXIuCiAgICBzdHJ1Y3QgSG9sZGVyIHsKICAgICAgICBhZGRyZXNzIGFkZHI7ICAgICAgICAgICAgICAgICAgICAvLyBDdXJyZW50IGFkZHJlc3Mgb2YgdGhlIGhvbGRlci4KICAgICAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgdHJ1c3Q7ICAvLyBBZGRyZXNzZXMgdGhhdCBhcmUgdHJ1c3RlZCB3aXRoIHJlY292ZXJ5IHByb29jZWR1cmUuCiAgICB9CgogICAgLy8gSXRlcmFibGUgbWFwcGluZyBwYXR0ZXJuIGlzIHVzZWQgZm9yIGhvbGRlcnMuCiAgICB1aW50IHB1YmxpYyBob2xkZXJzQ291bnQ7CiAgICBtYXBwaW5nKHVpbnQgPT4gSG9sZGVyKSBwdWJsaWMgaG9sZGVyczsKCiAgICAvLyBUaGlzIGlzIGFuIGFjY2VzcyBhZGRyZXNzIG1hcHBpbmcuIE1hbnkgYWRkcmVzc2VzIG1heSBoYXZlIGFjY2VzcyB0byBhIHNpbmdsZSBob2xkZXIuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgaG9sZGVySW5kZXg7CgogICAgLy8gQXNzZXQgc3ltYm9sIHRvIGFzc2V0IG1hcHBpbmcuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gQXNzZXQpIHB1YmxpYyBhc3NldHM7CgogICAgLy8gQXNzZXQgc3ltYm9sIHRvIGFzc2V0IHByb3h5IG1hcHBpbmcuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gYWRkcmVzcykgcHVibGljIHByb3hpZXM7CgogICAgLy8gU2hvdWxkIHVzZSBpbnRlcmZhY2Ugb2YgdGhlIGVtaXR0ZXIsIGJ1dCBhZGRyZXNzIG9mIGV2ZW50cyBoaXN0b3J5LgogICAgYWRkcmVzcyBwdWJsaWMgZXZlbnRzSGlzdG9yeTsKCiAgICAvKioKICAgICAqIEVtaXRzIEVycm9yIGV2ZW50IHdpdGggc3BlY2lmaWVkIGVycm9yIG1lc3NhZ2UuCiAgICAgKgogICAgICogU2hvdWxkIG9ubHkgYmUgdXNlZCBpZiBubyBzdGF0ZSBjaGFuZ2VzIGhhcHBlbmVkLgogICAgICoKICAgICAqIEBwYXJhbSBfZXJyb3JDb2RlIGNvZGUgb2YgYW4gZXJyb3IKICAgICAqIEBwYXJhbSBfbWVzc2FnZSBlcnJvciBtZXNzYWdlLgogICAgICovCiAgICBmdW5jdGlvbiBfZXJyb3IodWludCBfZXJyb3JDb2RlLCBieXRlczMyIF9tZXNzYWdlKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICBCTUNQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdEVycm9yKF9tZXNzYWdlKTsKICAgICAgICByZXR1cm4gX2Vycm9yQ29kZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgRXZlbnRzSHN0b3J5IGNvbnRyYWN0IGFkZHJlc3MuCiAgICAgKgogICAgICogQ2FuIGJlIHNldCBvbmx5IG9uY2UsIGFuZCBvbmx5IGJ5IGNvbnRyYWN0IG93bmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfZXZlbnRzSGlzdG9yeSBNdWx0aUV2ZW50c0hpc3RvcnkgY29udHJhY3QgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwRXZlbnRzSGlzdG9yeShhZGRyZXNzIF9ldmVudHNIaXN0b3J5KSByZXR1cm5zKHVpbnQgZXJyb3JDb2RlKSB7CiAgICAgICAgZXJyb3JDb2RlID0gY2hlY2tPbmx5Q29udHJhY3RPd25lcigpOwogICAgICAgIGlmIChlcnJvckNvZGUgIT0gT0spIHsKICAgICAgICAgICAgcmV0dXJuIGVycm9yQ29kZTsKICAgICAgICB9CiAgICAgICAgaWYgKGV2ZW50c0hpc3RvcnkgIT0gMHgwICYmIGV2ZW50c0hpc3RvcnkgIT0gX2V2ZW50c0hpc3RvcnkpIHsKICAgICAgICAgICAgcmV0dXJuIEJNQ19QTEFURk9STV9JTlZBTElEX0lOVk9DQVRJT047CiAgICAgICAgfQogICAgICAgIGV2ZW50c0hpc3RvcnkgPSBfZXZlbnRzSGlzdG9yeTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbWl0cyBFcnJvciBpZiBjYWxsZWQgbm90IGJ5IGFzc2V0IG93bmVyLgogICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoYnl0ZXMzMiBfc3ltYm9sKSB7CiAgICAgICAgaWYgKGNoZWNrSXNPbmx5T3duZXIoX3N5bWJvbCkgPT0gT0spIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbWl0cyBFcnJvciBpZiBjYWxsZWQgbm90IGJ5IGFzc2V0IHByb3h5LgogICAgICovCiAgICBtb2RpZmllciBvbmx5UHJveHkoYnl0ZXMzMiBfc3ltYm9sKSB7CiAgICAgICAgaWYgKGNoZWNrSXNPbmx5UHJveHkoX3N5bWJvbCkgPT0gT0spIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbWl0cyBFcnJvciBpZiBfZnJvbSBkb2Vzbid0IHRydXN0IF90by4KICAgICAqLwogICAgbW9kaWZpZXIgY2hlY2tUcnVzdChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgewogICAgICAgIGlmIChzaG91bGRCZVRydXN0ZWQoX2Zyb20sIF90bykgPT0gT0spIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tJc09ubHlPd25lcihieXRlczMyIF9zeW1ib2wpIGludGVybmFsIGNvbnN0YW50IHJldHVybnModWludCBlcnJvckNvZGUpIHsKICAgICAgICBpZiAoaXNPd25lcihtc2cuc2VuZGVyLCBfc3ltYm9sKSkgewogICAgICAgICAgICByZXR1cm4gT0s7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZXJyb3IoQk1DX1BMQVRGT1JNX0FDQ0VTU19ERU5JRURfT05MWV9PV05FUiwgIk9ubHkgb3duZXI6IGFjY2VzcyBkZW5pZWQiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGVja0lzT25seVByb3h5KGJ5dGVzMzIgX3N5bWJvbCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyh1aW50IGVycm9yQ29kZSkgewogICAgICAgIGlmIChwcm94aWVzW19zeW1ib2xdID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgcmV0dXJuIE9LOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9BQ0NFU1NfREVOSUVEX09OTFlfUFJPWFksICJPbmx5IHByb3h5OiBhY2Nlc3MgZGVuaWVkIik7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvdWxkQmVUcnVzdGVkKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQgZXJyb3JDb2RlKSB7CiAgICAgICAgaWYgKGlzVHJ1c3RlZChfZnJvbSwgX3RvKSkgewogICAgICAgICAgICByZXR1cm4gT0s7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfZXJyb3IoQk1DX1BMQVRGT1JNX0FDQ0VTU19ERU5JRURfT05MWV9UUlVTVEVELCAiT25seSB0cnVzdGVkOiBhY2Nlc3MgZGVuaWVkIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBhc3NldCBleGlzdGFuY2UuCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gYXNzZXQgZXhpc3RhbmNlLgogICAgICovCiAgICBmdW5jdGlvbiBpc0NyZWF0ZWQoYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLm93bmVyICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGRlY2ltYWxzLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IGRlY2ltYWxzLgogICAgICovCiAgICBmdW5jdGlvbiBiYXNlVW5pdChieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnModWludDgpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLmJhc2VVbml0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBuYW1lLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IG5hbWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5hbWUoYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKHN0cmluZykgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0ubmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgZGVzY3JpcHRpb24uCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gYXNzZXQgZGVzY3JpcHRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlc2NyaXB0aW9uKGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLmRlc2NyaXB0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCByZWlzc3VhYmlsaXR5LgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IHJlaXNzdWFiaWxpdHkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzUmVpc3N1YWJsZShieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0uaXNSZWlzc3VhYmxlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBvd25lciBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IG93bmVyIGFkZHJlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyKGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGhvbGRlcnNbYXNzZXRzW19zeW1ib2xdLm93bmVyXS5hZGRyOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgc3BlY2lmaWVkIGFkZHJlc3MgaGFzIGFzc2V0IG93bmVyIHJpZ2h0cy4KICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBvd25lciByaWdodHMgYXZhaWxhYmlsaXR5LgogICAgICovCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX293bmVyLCBieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBpc0NyZWF0ZWQoX3N5bWJvbCkgJiYgKGFzc2V0c1tfc3ltYm9sXS5vd25lciA9PSBnZXRIb2xkZXJJZChfb3duZXIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgdG90YWwgc3VwcGx5LgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IHRvdGFsIHN1cHBseS4KICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLnRvdGFsU3VwcGx5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBiYWxhbmNlIGZvciBhIHBhcnRpY3VsYXIgaG9sZGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfaG9sZGVyIGhvbGRlciBhZGRyZXNzLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIGJhbGFuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9ob2xkZXIsIGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9iYWxhbmNlT2YoZ2V0SG9sZGVySWQoX2hvbGRlciksIF9zeW1ib2wpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBiYWxhbmNlIGZvciBhIHBhcnRpY3VsYXIgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEBwYXJhbSBfaG9sZGVySWQgaG9sZGVyIGlkLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIGJhbGFuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9iYWxhbmNlT2YodWludCBfaG9sZGVySWQsIGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19ob2xkZXJJZF0uYmFsYW5jZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgY3VycmVudCBhZGRyZXNzIGZvciBhIHBhcnRpY3VsYXIgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEBwYXJhbSBfaG9sZGVySWQgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIGFkZHJlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9hZGRyZXNzKHVpbnQgX2hvbGRlcklkKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gaG9sZGVyc1tfaG9sZGVySWRdLmFkZHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIFByb3h5IGNvbnRyYWN0IGFkZHJlc3MgZm9yIGEgcGFydGljdWxhciBhc3NldC4KICAgICAqCiAgICAgKiBDYW4gYmUgc2V0IG9ubHkgb25jZSBmb3IgZWFjaCBhc3NldCwgYW5kIG9ubHkgYnkgY29udHJhY3Qgb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9hZGRyZXNzIFByb3h5IGNvbnRyYWN0IGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRQcm94eShhZGRyZXNzIF9hZGRyZXNzLCBieXRlczMyIF9zeW1ib2wpIHJldHVybnModWludCBlcnJvckNvZGUpIHsKICAgICAgICBlcnJvckNvZGUgPSBjaGVja09ubHlDb250cmFjdE93bmVyKCk7CiAgICAgICAgaWYgKGVycm9yQ29kZSAhPSBPSykgewogICAgICAgICAgICByZXR1cm4gZXJyb3JDb2RlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHByb3hpZXNbX3N5bWJvbF0gIT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBCTUNfUExBVEZPUk1fUFJPWFlfQUxSRUFEWV9FWElTVFM7CiAgICAgICAgfQogICAgICAgIHByb3hpZXNbX3N5bWJvbF0gPSBfYWRkcmVzczsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgZnVuY3Rpb24gbWFzc1RyYW5zZmVyKGFkZHJlc3NbXSBhZGRyZXNzZXMsIHVpbnRbXSB2YWx1ZXMsIGJ5dGVzMzIgX3N5bWJvbCkgZXh0ZXJuYWwKICAgIHJldHVybnMgKHVpbnQgZXJyb3JDb2RlLCB1aW50IGNvdW50KQogICAgewogICAgICAgIHJlcXVpcmUoY2hlY2tJc09ubHlPd25lcihfc3ltYm9sKSA9PSBPSyk7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzZXMubGVuZ3RoID09IHZhbHVlcy5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoX3N5bWJvbCAhPSAweDApOwoKICAgICAgICAvLyBUT0RPOiBhaGlhdHNldmljaCBjaGVja0lzT25seVByb3h5CgogICAgICAgIHVpbnQgc2VuZGVySWQgPSBfY3JlYXRlSG9sZGVySWQobXNnLnNlbmRlcik7CgogICAgICAgIHVpbnQgc3VjY2VzcyA9IDA7CiAgICAgICAgZm9yKHVpbnQgaWR4ID0gMDsgaWR4IDwgYWRkcmVzc2VzLmxlbmd0aCAmJiBtc2cuZ2FzID4gMTEwMDAwOyBpZHgrKykgewogICAgICAgICAgICB1aW50IHZhbHVlID0gdmFsdWVzW2lkeF07CgogICAgICAgICAgICBpZiAodmFsdWUgPT0gMCkgewogICAgICAgICAgICAgICAgX2Vycm9yKEJNQ19QTEFURk9STV9JTlZBTElEX1ZBTFVFLCAiQ2Fubm90IHNlbmQgMCB2YWx1ZSIpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChnZXRIb2xkZXJJZChhZGRyZXNzZXNbaWR4XSkgPiAwKSB7CiAgICAgICAgICAgICAgICBfZXJyb3IoQk1DX1BMQVRGT1JNX0hPTERFUl9FWElTVFMsICJBbHJlYWR5IHRyYW5zZmVyZWQiKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX2JhbGFuY2VPZihzZW5kZXJJZCwgX3N5bWJvbCkgPCB2YWx1ZSkgewogICAgICAgICAgICAgICAgX2Vycm9yKEJNQ19QTEFURk9STV9JTlNVRkZJQ0lFTlRfQkFMQU5DRSwgIkluc3VmZmljaWVudCBiYWxhbmNlIik7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYWRkcmVzc2VzW2lkeF0pIHsKICAgICAgICAgICAgICAgIF9lcnJvcihCTUNfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYsICJDYW5ub3Qgc2VuZCB0byBvbmVzZWxmIik7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdWludCBob2xkZXJJZCA9IF9jcmVhdGVIb2xkZXJJZChhZGRyZXNzZXNbaWR4XSk7CgogICAgICAgICAgICBfdHJhbnNmZXJEaXJlY3Qoc2VuZGVySWQsIGhvbGRlcklkLCB2YWx1ZSwgX3N5bWJvbCk7CiAgICAgICAgICAgIEJNQ1BsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0VHJhbnNmZXIobXNnLnNlbmRlciwgYWRkcmVzc2VzW2lkeF0sIF9zeW1ib2wsIHZhbHVlLCAiIik7CiAgICAgICAgICAgIAogICAgICAgICAgICBzdWNjZXNzKys7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKE9LLCBzdWNjZXNzKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZmVycyBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycyB3YWxsZXRzLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbUlkIGhvbGRlciBpZCB0byB0YWtlIGZyb20uCiAgICAgKiBAcGFyYW0gX3RvSWQgaG9sZGVyIGlkIHRvIGdpdmUgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqLwogICAgZnVuY3Rpb24gX3RyYW5zZmVyRGlyZWN0KHVpbnQgX2Zyb21JZCwgdWludCBfdG9JZCwgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3N5bWJvbCkgaW50ZXJuYWwgewogICAgICAgIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19mcm9tSWRdLmJhbGFuY2UgPSBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfZnJvbUlkXS5iYWxhbmNlLnN1YihfdmFsdWUpOwogICAgICAgIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW190b0lkXS5iYWxhbmNlID0gYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX3RvSWRdLmJhbGFuY2UuYWRkKF92YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYXNzZXQgYmFsYW5jZSBiZXR3ZWVuIGhvbGRlcnMgd2FsbGV0cy4KICAgICAqCiAgICAgKiBQZXJmb3JtcyBzYW5pdHkgY2hlY2tzIGFuZCB0YWtlcyBjYXJlIG9mIGFsbG93YW5jZXMgYWRqdXN0bWVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb21JZCBob2xkZXIgaWQgdG8gdGFrZSBmcm9tLgogICAgICogQHBhcmFtIF90b0lkIGhvbGRlciBpZCB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKiBAcGFyYW0gX3JlZmVyZW5jZSB0cmFuc2ZlciBjb21tZW50IHRvIGJlIGluY2x1ZGVkIGluIGEgVHJhbnNmZXIgZXZlbnQuCiAgICAgKiBAcGFyYW0gX3NlbmRlcklkIHRyYW5zZmVyIGluaXRpYXRvciBob2xkZXIgaWQuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIodWludCBfZnJvbUlkLCB1aW50IF90b0lkLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCBzdHJpbmcgX3JlZmVyZW5jZSwgdWludCBfc2VuZGVySWQpIGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIC8vIFNob3VsZCBub3QgYWxsb3cgdG8gc2VuZCB0byBvbmVzZWxmLgogICAgICAgIGlmIChfZnJvbUlkID09IF90b0lkKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQk1DX1BMQVRGT1JNX0NBTk5PVF9BUFBMWV9UT19PTkVTRUxGLCAiQ2Fubm90IHNlbmQgdG8gb25lc2VsZiIpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgaGF2ZSBwb3NpdGl2ZSB2YWx1ZS4KICAgICAgICBpZiAoX3ZhbHVlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihCTUNfUExBVEZPUk1fSU5WQUxJRF9WQUxVRSwgIkNhbm5vdCBzZW5kIDAgdmFsdWUiKTsKICAgICAgICB9CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgZW5vdWdoIGJhbGFuY2UuCiAgICAgICAgaWYgKF9iYWxhbmNlT2YoX2Zyb21JZCwgX3N5bWJvbCkgPCBfdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihCTUNfUExBVEZPUk1fSU5TVUZGSUNJRU5UX0JBTEFOQ0UsICJJbnN1ZmZpY2llbnQgYmFsYW5jZSIpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgaGF2ZSBlbm91Z2ggYWxsb3dhbmNlLgogICAgICAgIGlmIChfZnJvbUlkICE9IF9zZW5kZXJJZCAmJiBfYWxsb3dhbmNlKF9mcm9tSWQsIF9zZW5kZXJJZCwgX3N5bWJvbCkgPCBfdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihCTUNfUExBVEZPUk1fTk9UX0VOT1VHSF9BTExPV0FOQ0UsICJOb3QgZW5vdWdoIGFsbG93YW5jZSIpOwogICAgICAgIH0KCiAgICAgICAgX3RyYW5zZmVyRGlyZWN0KF9mcm9tSWQsIF90b0lkLCBfdmFsdWUsIF9zeW1ib2wpOwogICAgICAgIC8vIEFkanVzdCBhbGxvd2FuY2UuCiAgICAgICAgaWYgKF9mcm9tSWQgIT0gX3NlbmRlcklkKSB7CiAgICAgICAgICAgIHVpbnQgc2VuZGVyQWxsb3dhbmNlID0gYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX2Zyb21JZF0uYWxsb3dhbmNlW19zZW5kZXJJZF07CiAgICAgICAgICAgIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19mcm9tSWRdLmFsbG93YW5jZVtfc2VuZGVySWRdID0gc2VuZGVyQWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgICAgIH0KICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIEJNQ1BsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0VHJhbnNmZXIoX2FkZHJlc3MoX2Zyb21JZCksIF9hZGRyZXNzKF90b0lkKSwgX3N5bWJvbCwgX3ZhbHVlLCBfcmVmZXJlbmNlKTsKICAgICAgICBfcHJveHlUcmFuc2ZlckV2ZW50KF9mcm9tSWQsIF90b0lkLCBfdmFsdWUsIF9zeW1ib2wpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zZmVycyBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycyB3YWxsZXRzLgogICAgICoKICAgICAqIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhc3NldCBwcm94eS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIGhvbGRlciBhZGRyZXNzIHRvIGdpdmUgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfcmVmZXJlbmNlIHRyYW5zZmVyIGNvbW1lbnQgdG8gYmUgaW5jbHVkZWQgaW4gYSBUcmFuc2ZlciBldmVudC4KICAgICAqIEBwYXJhbSBfc2VuZGVyIHRyYW5zZmVyIGluaXRpYXRvciBhZGRyZXNzLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gcHJveHlUcmFuc2ZlcldpdGhSZWZlcmVuY2UoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zeW1ib2wsIHN0cmluZyBfcmVmZXJlbmNlLCBhZGRyZXNzIF9zZW5kZXIpIHJldHVybnModWludCBlcnJvckNvZGUpIHsKICAgICAgICBlcnJvckNvZGUgPSBjaGVja0lzT25seVByb3h5KF9zeW1ib2wpOwogICAgICAgIGlmIChlcnJvckNvZGUgIT0gT0spIHsKICAgICAgICAgICAgcmV0dXJuIGVycm9yQ29kZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfdHJhbnNmZXIoZ2V0SG9sZGVySWQoX3NlbmRlciksIF9jcmVhdGVIb2xkZXJJZChfdG8pLCBfdmFsdWUsIF9zeW1ib2wsIF9yZWZlcmVuY2UsIGdldEhvbGRlcklkKF9zZW5kZXIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzayBhc3NldCBQcm94eSBjb250cmFjdCB0byBlbWl0IEVSQzIwIGNvbXBsaWFudCBUcmFuc2ZlciBldmVudC4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb21JZCBob2xkZXIgaWQgdG8gdGFrZSBmcm9tLgogICAgICogQHBhcmFtIF90b0lkIGhvbGRlciBpZCB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9wcm94eVRyYW5zZmVyRXZlbnQodWludCBfZnJvbUlkLCB1aW50IF90b0lkLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKHByb3hpZXNbX3N5bWJvbF0gIT0gMHgwKSB7CiAgICAgICAgICAgIC8vIEludGVybmFsIE91dCBPZiBHYXMvVGhyb3c6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICAgICAgUHJveHkocHJveGllc1tfc3ltYm9sXSkuZW1pdFRyYW5zZmVyKF9hZGRyZXNzKF9mcm9tSWQpLCBfYWRkcmVzcyhfdG9JZCksIF92YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBob2xkZXIgaWQgZm9yIHRoZSBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gX2hvbGRlciBob2xkZXIgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhvbGRlciBpZC4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0SG9sZGVySWQoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gaG9sZGVySW5kZXhbX2hvbGRlcl07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGhvbGRlciBpZCBmb3IgdGhlIHNwZWNpZmllZCBhZGRyZXNzLCBjcmVhdGVzIGl0IGlmIG5lZWRlZC4KICAgICAqCiAgICAgKiBAcGFyYW0gX2hvbGRlciBob2xkZXIgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhvbGRlciBpZC4KICAgICAqLwogICAgZnVuY3Rpb24gX2NyZWF0ZUhvbGRlcklkKGFkZHJlc3MgX2hvbGRlcikgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgdWludCBob2xkZXJJZCA9IGhvbGRlckluZGV4W19ob2xkZXJdOwogICAgICAgIGlmIChob2xkZXJJZCA9PSAwKSB7CiAgICAgICAgICAgIGhvbGRlcklkID0gKytob2xkZXJzQ291bnQ7CiAgICAgICAgICAgIGhvbGRlcnNbaG9sZGVySWRdLmFkZHIgPSBfaG9sZGVyOwogICAgICAgICAgICBob2xkZXJJbmRleFtfaG9sZGVyXSA9IGhvbGRlcklkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaG9sZGVySWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBJc3N1ZXMgbmV3IGFzc2V0IHRva2VuIG9uIHRoZSBwbGF0Zm9ybS4KICAgICAqCiAgICAgKiBUb2tlbnMgaXNzdWVkIHdpdGggdGhpcyBjYWxsIGdvIHN0cmFpZ2h0IHRvIGNvbnRyYWN0IG93bmVyLgogICAgICogRWFjaCBzeW1ib2wgY2FuIGJlIGlzc3VlZCBvbmx5IG9uY2UsIGFuZCBvbmx5IGJ5IGNvbnRyYWN0IG93bmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBpc3N1ZSBpbW1lZGlhdGVseS4KICAgICAqIEBwYXJhbSBfbmFtZSBuYW1lIG9mIHRoZSBhc3NldC4KICAgICAqIEBwYXJhbSBfZGVzY3JpcHRpb24gZGVzY3JpcHRpb24gZm9yIHRoZSBhc3NldC4KICAgICAqIEBwYXJhbSBfYmFzZVVuaXQgbnVtYmVyIG9mIGRlY2ltYWxzLgogICAgICogQHBhcmFtIF9pc1JlaXNzdWFibGUgZHluYW1pYyBvciBmaXhlZCBzdXBwbHkuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBpc3N1ZUFzc2V0KGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUsIHN0cmluZyBfbmFtZSwgc3RyaW5nIF9kZXNjcmlwdGlvbiwgdWludDggX2Jhc2VVbml0LCBib29sIF9pc1JlaXNzdWFibGUpIHJldHVybnModWludCBlcnJvckNvZGUpIHsKICAgICAgICBlcnJvckNvZGUgPSBjaGVja09ubHlDb250cmFjdE93bmVyKCk7CiAgICAgICAgaWYgKGVycm9yQ29kZSAhPSBPSykgewogICAgICAgICAgICByZXR1cm4gZXJyb3JDb2RlOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgaGF2ZSBwb3NpdGl2ZSB2YWx1ZSBpZiBzdXBwbHkgaXMgZ29pbmcgdG8gYmUgZml4ZWQuCiAgICAgICAgaWYgKF92YWx1ZSA9PSAwICYmICFfaXNSZWlzc3VhYmxlKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQk1DX1BMQVRGT1JNX0NBTk5PVF9JU1NVRV9GSVhFRF9BU1NFVF9XSVRIX0lOVkFMSURfVkFMVUUsICJDYW5ub3QgaXNzdWUgMCB2YWx1ZSBmaXhlZCBhc3NldCIpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgbm90IGJlIGlzc3VlZCB5ZXQuCiAgICAgICAgaWYgKGlzQ3JlYXRlZChfc3ltYm9sKSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9BU1NFVF9BTFJFQURZX0lTU1VFRCwgIkFzc2V0IGFscmVhZHkgaXNzdWVkIik7CiAgICAgICAgfQogICAgICAgIHVpbnQgaG9sZGVySWQgPSBfY3JlYXRlSG9sZGVySWQobXNnLnNlbmRlcik7CgogICAgICAgIGFzc2V0c1tfc3ltYm9sXSA9IEFzc2V0KGhvbGRlcklkLCBfdmFsdWUsIF9uYW1lLCBfZGVzY3JpcHRpb24sIF9pc1JlaXNzdWFibGUsIF9iYXNlVW5pdCk7CiAgICAgICAgYXNzZXRzW19zeW1ib2xdLndhbGxldHNbaG9sZGVySWRdLmJhbGFuY2UgPSBfdmFsdWU7CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBCTUNQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdElzc3VlKF9zeW1ib2wsIF92YWx1ZSwgX2FkZHJlc3MoaG9sZGVySWQpKTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBJc3N1ZXMgYWRkaXRpb25hbCBhc3NldCB0b2tlbnMgaWYgdGhlIGFzc2V0IGhhdmUgZHluYW1pYyBzdXBwbHkuCiAgICAgKgogICAgICogVG9rZW5zIGlzc3VlZCB3aXRoIHRoaXMgY2FsbCBnbyBzdHJhaWdodCB0byBhc3NldCBvd25lci4KICAgICAqIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhc3NldCBvd25lci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCBvZiBhZGRpdGlvbmFsIHRva2VucyB0byBpc3N1ZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlaXNzdWVBc3NldChieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlKSByZXR1cm5zKHVpbnQgZXJyb3JDb2RlKSB7CiAgICAgICAgZXJyb3JDb2RlID0gY2hlY2tJc09ubHlPd25lcihfc3ltYm9sKTsKICAgICAgICBpZiAoZXJyb3JDb2RlICE9IE9LKSB7CiAgICAgICAgICAgIHJldHVybiBlcnJvckNvZGU7CiAgICAgICAgfQogICAgICAgIC8vIFNob3VsZCBoYXZlIHBvc2l0aXZlIHZhbHVlLgogICAgICAgIGlmIChfdmFsdWUgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9JTlZBTElEX1ZBTFVFLCAiQ2Fubm90IHJlaXNzdWUgMCB2YWx1ZSIpOwogICAgICAgIH0KICAgICAgICBBc3NldCBhc3NldCA9IGFzc2V0c1tfc3ltYm9sXTsKICAgICAgICAvLyBTaG91bGQgaGF2ZSBkeW5hbWljIHN1cHBseS4KICAgICAgICBpZiAoIWFzc2V0LmlzUmVpc3N1YWJsZSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9DQU5OT1RfUkVJU1NVRV9GSVhFRF9BU1NFVCwgIkNhbm5vdCByZWlzc3VlIGZpeGVkIGFzc2V0Iik7CiAgICAgICAgfQogICAgICAgIC8vIFJlc3VsdGluZyB0b3RhbCBzdXBwbHkgc2hvdWxkIG5vdCBvdmVyZmxvdy4KICAgICAgICBpZiAoYXNzZXQudG90YWxTdXBwbHkgKyBfdmFsdWUgPCBhc3NldC50b3RhbFN1cHBseSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9TVVBQTFlfT1ZFUkZMT1csICJUb3RhbCBzdXBwbHkgb3ZlcmZsb3ciKTsKICAgICAgICB9CiAgICAgICAgdWludCBob2xkZXJJZCA9IGdldEhvbGRlcklkKG1zZy5zZW5kZXIpOwogICAgICAgIGFzc2V0LndhbGxldHNbaG9sZGVySWRdLmJhbGFuY2UgPSBhc3NldC53YWxsZXRzW2hvbGRlcklkXS5iYWxhbmNlLmFkZChfdmFsdWUpOwogICAgICAgIGFzc2V0LnRvdGFsU3VwcGx5ID0gYXNzZXQudG90YWxTdXBwbHkuYWRkKF92YWx1ZSk7CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBCTUNQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdElzc3VlKF9zeW1ib2wsIF92YWx1ZSwgX2FkZHJlc3MoaG9sZGVySWQpKTsKICAgICAgICBfcHJveHlUcmFuc2ZlckV2ZW50KDAsIGhvbGRlcklkLCBfdmFsdWUsIF9zeW1ib2wpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIERlc3Ryb3lzIHNwZWNpZmllZCBhbW91bnQgb2Ygc2VuZGVycyBhc3NldCB0b2tlbnMuCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlc3Ryb3kuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiByZXZva2VBc3NldChieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlKSByZXR1cm5zKHVpbnQpIHsKICAgICAgICAvLyBTaG91bGQgaGF2ZSBwb3NpdGl2ZSB2YWx1ZS4KICAgICAgICBpZiAoX3ZhbHVlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihCTUNfUExBVEZPUk1fSU5WQUxJRF9WQUxVRSwgIkNhbm5vdCByZXZva2UgMCB2YWx1ZSIpOwogICAgICAgIH0KICAgICAgICBBc3NldCBhc3NldCA9IGFzc2V0c1tfc3ltYm9sXTsKICAgICAgICB1aW50IGhvbGRlcklkID0gZ2V0SG9sZGVySWQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgZW5vdWdoIHRva2Vucy4KICAgICAgICBpZiAoYXNzZXQud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZSA8IF92YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9OT1RfRU5PVUdIX1RPS0VOUywgIk5vdCBlbm91Z2ggdG9rZW5zIHRvIHJldm9rZSIpOwogICAgICAgIH0KICAgICAgICBhc3NldC53YWxsZXRzW2hvbGRlcklkXS5iYWxhbmNlID0gYXNzZXQud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZS5zdWIoX3ZhbHVlKTsKICAgICAgICBhc3NldC50b3RhbFN1cHBseSA9IGFzc2V0LnRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIC8vIEludGVybmFsIE91dCBPZiBHYXMvVGhyb3c6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgIC8vIFJlY3Vyc2l2ZSBDYWxsOiBzYWZlLCBhbGwgY2hhbmdlcyBhbHJlYWR5IG1hZGUuCiAgICAgICAgQk1DUGxhdGZvcm1FbWl0dGVyKGV2ZW50c0hpc3RvcnkpLmVtaXRSZXZva2UoX3N5bWJvbCwgX3ZhbHVlLCBfYWRkcmVzcyhob2xkZXJJZCkpOwogICAgICAgIF9wcm94eVRyYW5zZmVyRXZlbnQoaG9sZGVySWQsIDAsIF92YWx1ZSwgX3N5bWJvbCk7CiAgICAgICAgcmV0dXJuIE9LOwogICAgfQoKICAgIC8qKgogICAgICogUGFzc2VzIGFzc2V0IG93bmVyc2hpcCB0byBzcGVjaWZpZWQgYWRkcmVzcy4KICAgICAqCiAgICAgKiBPbmx5IG93bmVyc2hpcCBpcyBjaGFuZ2VkLCBiYWxhbmNlcyBhcmUgbm90IHRvdWNoZWQuCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXNzZXQgb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF9uZXdPd25lciBhZGRyZXNzIHRvIGJlY29tZSBhIG5ldyBvd25lci4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyc2hpcChieXRlczMyIF9zeW1ib2wsIGFkZHJlc3MgX25ld093bmVyKSByZXR1cm5zKHVpbnQgZXJyb3JDb2RlKSB7CiAgICAgICAgZXJyb3JDb2RlID0gY2hlY2tJc09ubHlPd25lcihfc3ltYm9sKTsKICAgICAgICBpZiAoZXJyb3JDb2RlICE9IE9LKSB7CiAgICAgICAgICAgIHJldHVybiBlcnJvckNvZGU7CiAgICAgICAgfQoKICAgICAgICBpZiAoX25ld093bmVyID09IDB4MCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9JTlZBTElEX05FV19PV05FUiwgIkNhbid0IGNoYW5nZSBvd25lcnNoaXAgdG8gMHgwIik7CiAgICAgICAgfQoKICAgICAgICBBc3NldCBhc3NldCA9IGFzc2V0c1tfc3ltYm9sXTsKICAgICAgICB1aW50IG5ld093bmVySWQgPSBfY3JlYXRlSG9sZGVySWQoX25ld093bmVyKTsKICAgICAgICAvLyBTaG91bGQgcGFzcyBvd25lcnNoaXAgdG8gYW5vdGhlciBob2xkZXIuCiAgICAgICAgaWYgKGFzc2V0Lm93bmVyID09IG5ld093bmVySWQpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihCTUNfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYsICJDYW5ub3QgcGFzcyBvd25lcnNoaXAgdG8gb25lc2VsZiIpOwogICAgICAgIH0KICAgICAgICBhZGRyZXNzIG9sZE93bmVyID0gX2FkZHJlc3MoYXNzZXQub3duZXIpOwogICAgICAgIGFzc2V0Lm93bmVyID0gbmV3T3duZXJJZDsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIEJNQ1BsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0T3duZXJzaGlwQ2hhbmdlKG9sZE93bmVyLCBfYWRkcmVzcyhuZXdPd25lcklkKSwgX3N5bWJvbCk7CiAgICAgICAgcmV0dXJuIE9LOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgc3BlY2lmaWVkIGhvbGRlciB0cnVzdHMgYW4gYWRkcmVzcyB3aXRoIHJlY292ZXJ5IHByb2NlZHVyZS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gdHJ1c3Rlci4KICAgICAqIEBwYXJhbSBfdG8gdHJ1c3RlZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydXN0IGV4aXN0YW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gaXNUcnVzdGVkKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gaG9sZGVyc1tnZXRIb2xkZXJJZChfZnJvbSldLnRydXN0W190b107CiAgICB9CgogICAgLyoqCiAgICAgKiBUcnVzdCBhbiBhZGRyZXNzIHRvIHBlcmZvcm0gcmVjb3ZlcnkgcHJvY2VkdXJlIGZvciB0aGUgY2FsbGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfdG8gdHJ1c3RlZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRydXN0KGFkZHJlc3MgX3RvKSByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IGZyb21JZCA9IF9jcmVhdGVIb2xkZXJJZChtc2cuc2VuZGVyKTsKICAgICAgICAvLyBTaG91bGQgdHJ1c3QgdG8gYW5vdGhlciBhZGRyZXNzLgogICAgICAgIGlmIChmcm9tSWQgPT0gZ2V0SG9sZGVySWQoX3RvKSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9DQU5OT1RfQVBQTFlfVE9fT05FU0VMRiwgIkNhbm5vdCB0cnVzdCB0byBvbmVzZWxmIik7CiAgICAgICAgfQogICAgICAgIC8vIFNob3VsZCB0cnVzdCB0byB5ZXQgdW50cnVzdGVkLgogICAgICAgIGlmIChpc1RydXN0ZWQobXNnLnNlbmRlciwgX3RvKSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9BTFJFQURZX1RSVVNURUQsICJBbHJlYWR5IHRydXN0ZWQiKTsKICAgICAgICB9CgogICAgICAgIGhvbGRlcnNbZnJvbUlkXS50cnVzdFtfdG9dID0gdHJ1ZTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXZva2UgdHJ1c3QgdG8gcGVyZm9ybSByZWNvdmVyeSBwcm9jZWR1cmUgZnJvbSBhbiBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBfdG8gdHJ1c3RlZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRpc3RydXN0KGFkZHJlc3MgX3RvKSByZXR1cm5zKHVpbnQgZXJyb3JDb2RlKSB7CiAgICAgICAgZXJyb3JDb2RlID0gc2hvdWxkQmVUcnVzdGVkKG1zZy5zZW5kZXIsIF90byk7CiAgICAgICAgaWYgKGVycm9yQ29kZSAhPSBPSykgewogICAgICAgICAgICByZXR1cm4gZXJyb3JDb2RlOwogICAgICAgIH0KICAgICAgICBob2xkZXJzW2dldEhvbGRlcklkKG1zZy5zZW5kZXIpXS50cnVzdFtfdG9dID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIE9LOwogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSByZWNvdmVyeSBwcm9jZWR1cmUuCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBsb2dpYyBpcyBhY3R1YWxseSBtb3JlIG9mIGFuIGFkZEFjY2Vzcyh1aW50IF9ob2xkZXJJZCwgYWRkcmVzcyBfdG8pLgogICAgICogSXQgZ3JhbnRzIGFub3RoZXIgYWRkcmVzcyBhY2Nlc3MgdG8gcmVjb3Zlcnkgc3ViamVjdCB3YWxsZXRzLgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRydXN0ZWUgb2YgcmVjb3Zlcnkgc3ViamVjdC4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gaG9sZGVyIGFkZHJlc3MgdG8gcmVjb3ZlciBmcm9tLgogICAgICogQHBhcmFtIF90byBhZGRyZXNzIHRvIGdyYW50IGFjY2VzcyB0by4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlY292ZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIHJldHVybnModWludCBlcnJvckNvZGUpIHsKICAgICAgICBlcnJvckNvZGUgPSBzaG91bGRCZVRydXN0ZWQoX2Zyb20sIG1zZy5zZW5kZXIpOwogICAgICAgIGlmIChlcnJvckNvZGUgIT0gT0spIHsKICAgICAgICAgICAgcmV0dXJuIGVycm9yQ29kZTsKICAgICAgICB9CiAgICAgICAgLy8gU2hvdWxkIHJlY292ZXIgdG8gcHJldmlvdXNseSB1bnVzZWQgYWRkcmVzcy4KICAgICAgICBpZiAoZ2V0SG9sZGVySWQoX3RvKSAhPSAwKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQk1DX1BMQVRGT1JNX1NIT1VMRF9SRUNPVkVSX1RPX05FV19BRERSRVNTLCAiU2hvdWxkIHJlY292ZXIgdG8gbmV3IGFkZHJlc3MiKTsKICAgICAgICB9CiAgICAgICAgLy8gV2UgdGFrZSBjdXJyZW50IGhvbGRlciBhZGRyZXNzIGJlY2F1c2UgaXQgbWlnaHQgbm90IGVxdWFsIF9mcm9tLgogICAgICAgIC8vIEl0IGlzIHBvc3NpYmxlIHRvIHJlY292ZXIgZnJvbSBhbnkgb2xkIGhvbGRlciBhZGRyZXNzLCBidXQgZXZlbnQgc2hvdWxkIGhhdmUgdGhlIGN1cnJlbnQgb25lLgogICAgICAgIGFkZHJlc3MgZnJvbSA9IGhvbGRlcnNbZ2V0SG9sZGVySWQoX2Zyb20pXS5hZGRyOwogICAgICAgIGhvbGRlcnNbZ2V0SG9sZGVySWQoX2Zyb20pXS5hZGRyID0gX3RvOwogICAgICAgIGhvbGRlckluZGV4W190b10gPSBnZXRIb2xkZXJJZChfZnJvbSk7CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIFJlY3Vyc2l2ZSBDYWxsOiBzYWZlLCBhbGwgY2hhbmdlcyBhbHJlYWR5IG1hZGUuCiAgICAgICAgQk1DUGxhdGZvcm1FbWl0dGVyKGV2ZW50c0hpc3RvcnkpLmVtaXRSZWNvdmVyeShmcm9tLCBfdG8sIG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgYXNzZXQgc3BlbmRpbmcgYWxsb3dhbmNlIGZvciBhIHNwZWNpZmllZCBzcGVuZGVyLgogICAgICoKICAgICAqIE5vdGU6IHRvIHJldm9rZSBhbGxvd2FuY2UsIG9uZSBuZWVkcyB0byBzZXQgYWxsb3dhbmNlIHRvIDAuCiAgICAgKgogICAgICogQHBhcmFtIF9zcGVuZGVySWQgaG9sZGVyIGlkIHRvIHNldCBhbGxvd2FuY2UgZm9yLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gYWxsb3cuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKiBAcGFyYW0gX3NlbmRlcklkIGFwcHJvdmUgaW5pdGlhdG9yIGhvbGRlciBpZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQgX3NwZW5kZXJJZCwgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfc2VuZGVySWQpIGludGVybmFsIHJldHVybnModWludCkgewogICAgICAgIC8vIEFzc2V0IHNob3VsZCBleGlzdC4KICAgICAgICBpZiAoIWlzQ3JlYXRlZChfc3ltYm9sKSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKEJNQ19QTEFURk9STV9BU1NFVF9JU19OT1RfSVNTVUVELCAiQXNzZXQgaXMgbm90IGlzc3VlZCIpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgYWxsb3cgdG8gYW5vdGhlciBob2xkZXIuCiAgICAgICAgaWYgKF9zZW5kZXJJZCA9PSBfc3BlbmRlcklkKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQk1DX1BMQVRGT1JNX0NBTk5PVF9BUFBMWV9UT19PTkVTRUxGLCAiQ2Fubm90IGFwcHJvdmUgdG8gb25lc2VsZiIpOwogICAgICAgIH0KICAgICAgICBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfc2VuZGVySWRdLmFsbG93YW5jZVtfc3BlbmRlcklkXSA9IF92YWx1ZTsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBCTUNQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdEFwcHJvdmUoX2FkZHJlc3MoX3NlbmRlcklkKSwgX2FkZHJlc3MoX3NwZW5kZXJJZCksIF9zeW1ib2wsIF92YWx1ZSk7CiAgICAgICAgaWYgKHByb3hpZXNbX3N5bWJvbF0gIT0gMHgwKSB7CiAgICAgICAgICAgIC8vIEludGVybmFsIE91dCBPZiBHYXMvVGhyb3c6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICAgICAgUHJveHkocHJveGllc1tfc3ltYm9sXSkuZW1pdEFwcHJvdmUoX2FkZHJlc3MoX3NlbmRlcklkKSwgX2FkZHJlc3MoX3NwZW5kZXJJZCksIF92YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvKioKICAgICAqIFNldHMgYXNzZXQgc3BlbmRpbmcgYWxsb3dhbmNlIGZvciBhIHNwZWNpZmllZCBzcGVuZGVyLgogICAgICoKICAgICAqIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhc3NldCBwcm94eS4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgaG9sZGVyIGFkZHJlc3MgdG8gc2V0IGFsbG93YW5jZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIGFsbG93LgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF9zZW5kZXIgYXBwcm92ZSBpbml0aWF0b3IgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3h5QXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9zZW5kZXIpIHJldHVybnModWludCBlcnJvckNvZGUpIHsKICAgICAgICBlcnJvckNvZGUgPSBjaGVja0lzT25seVByb3h5KF9zeW1ib2wpOwogICAgICAgIGlmIChlcnJvckNvZGUgIT0gT0spIHsKICAgICAgICAgICAgcmV0dXJuIGVycm9yQ29kZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hcHByb3ZlKF9jcmVhdGVIb2xkZXJJZChfc3BlbmRlciksIF92YWx1ZSwgX3N5bWJvbCwgX2NyZWF0ZUhvbGRlcklkKF9zZW5kZXIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgYWxsb3dhbmNlIGZyb20gb25lIGhvbGRlciB0byBhbm90aGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBob2xkZXIgdGhhdCBhbGxvd2VkIHNwZW5kaW5nLgogICAgICogQHBhcmFtIF9zcGVuZGVyIGhvbGRlciB0aGF0IGlzIGFsbG93ZWQgdG8gc3BlbmQuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBob2xkZXIgdG8gc3BlbmRlciBhbGxvd2FuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF9zcGVuZGVyLCBieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBfYWxsb3dhbmNlKGdldEhvbGRlcklkKF9mcm9tKSwgZ2V0SG9sZGVySWQoX3NwZW5kZXIpLCBfc3ltYm9sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgYWxsb3dhbmNlIGZyb20gb25lIGhvbGRlciB0byBhbm90aGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbUlkIGhvbGRlciBpZCB0aGF0IGFsbG93ZWQgc3BlbmRpbmcuCiAgICAgKiBAcGFyYW0gX3RvSWQgaG9sZGVyIGlkIHRoYXQgaXMgYWxsb3dlZCB0byBzcGVuZC4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhvbGRlciB0byBzcGVuZGVyIGFsbG93YW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gX2FsbG93YW5jZSh1aW50IF9mcm9tSWQsIHVpbnQgX3RvSWQsIGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19mcm9tSWRdLmFsbG93YW5jZVtfdG9JZF07CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmZvcm1zIGFsbG93YW5jZSB0cmFuc2ZlciBvZiBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycyB3YWxsZXRzLgogICAgICoKICAgICAqIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhc3NldCBwcm94eS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gaG9sZGVyIGFkZHJlc3MgdG8gdGFrZSBmcm9tLgogICAgICogQHBhcmFtIF90byBob2xkZXIgYWRkcmVzcyB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKiBAcGFyYW0gX3JlZmVyZW5jZSB0cmFuc2ZlciBjb21tZW50IHRvIGJlIGluY2x1ZGVkIGluIGEgVHJhbnNmZXIgZXZlbnQuCiAgICAgKiBAcGFyYW0gX3NlbmRlciBhbGxvd2FuY2UgdHJhbnNmZXIgaW5pdGlhdG9yIGFkZHJlc3MuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBwcm94eVRyYW5zZmVyRnJvbVdpdGhSZWZlcmVuY2UoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zeW1ib2wsIHN0cmluZyBfcmVmZXJlbmNlLCBhZGRyZXNzIF9zZW5kZXIpIHJldHVybnModWludCBlcnJvckNvZGUpIHsKICAgICAgICBlcnJvckNvZGUgPSBjaGVja0lzT25seVByb3h5KF9zeW1ib2wpOwogICAgICAgIGlmIChlcnJvckNvZGUgIT0gT0spIHsKICAgICAgICAgICAgcmV0dXJuIGVycm9yQ29kZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF90cmFuc2ZlcihnZXRIb2xkZXJJZChfZnJvbSksIF9jcmVhdGVIb2xkZXJJZChfdG8pLCBfdmFsdWUsIF9zeW1ib2wsIF9yZWZlcmVuY2UsIGdldEhvbGRlcklkKF9zZW5kZXIpKTsKICAgIH0KfQ=='.
	

]
