Class {
	#name : #SRT348cf59f2cbcc9efc21a1157fe345daea29e8adb,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT348cf59f2cbcc9efc21a1157fe345daea29e8adb >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7Cgpjb250cmFjdCBTYWZlTWF0aCB7CiAgICAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgICAgdWludCBjID0gYSAqIGI7CiAgICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgICAgcmV0dXJuIGM7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICAgIHJldHVybiBhIC0gYjsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgIHVpbnQgYyA9IGEgKyBiOwogICAgICAgICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICAgICAgICByZXR1cm4gYzsKICAgICB9Cn0KCi8vIFN0YW5kYXJkIHRva2VuIGludGVyZmFjZSAoRVJDIDIwKQovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKY29udHJhY3QgVG9rZW4gaXMgU2FmZU1hdGggewogICAgIC8vIEZ1bmN0aW9uczoKICAgICAvLy8gQHJldHVybiB0b3RhbCBhbW91bnQgb2YgdG9rZW5zCiAgICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSkge30KCiAgICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHt9CgogICAgIC8vLyBAbm90aWNlIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAKICAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyhib29sKSB7fQoKICAgICAvLy8gQG5vdGljZSBzZW5kIGBfdmFsdWVgIHRva2VuIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0IGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpcmV0dXJucyhib29sKXt9CgogICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX2FkZHJgIHRvIHNwZW5kIGBfdmFsdWVgIHRva2VucwogICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB3ZWkgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7fQoKICAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VucyBhbGxvd2VkIHRvIHNwZW50CiAgICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykge30KCiAgICAgLy8gRXZlbnRzOgogICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9Cgpjb250cmFjdCBTdGRUb2tlbiBpcyBUb2tlbiB7CiAgICAgLy8gRmllbGRzOgogICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHkgPSAwOwoKICAgICAvLyBGdW5jdGlvbnM6CiAgICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zKGJvb2wpewogICAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSk7CgogICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLF92YWx1ZSk7CiAgICAgICAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLF92YWx1ZSk7CgogICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgfQoKICAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zKGJvb2wpewogICAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlKTsKICAgICAgICAgIHJlcXVpcmUoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pOwoKICAgICAgICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sX3ZhbHVlKTsKICAgICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IHNhZmVTdWIoYmFsYW5jZXNbX2Zyb21dLF92YWx1ZSk7CiAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sX3ZhbHVlKTsKCiAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgfQoKICAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICAgfQoKICAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgIH0KCiAgICAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgX3NpemUpIHsKICAgICAgICAgIHJlcXVpcmUobXNnLmRhdGEubGVuZ3RoID49IF9zaXplICsgNCk7CiAgICAgICAgICBfOwogICAgIH0KfQoKY29udHJhY3QgTU5UUCBpcyBTdGRUb2tlbiB7Ci8vLyBGaWVsZHM6CiAgICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkdvbGRtaW50IE1OVCBQcmVsYXVuY2ggVG9rZW4iOwogICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIk1OVFAiOwogICAgIHVpbnQgcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgogICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3IgPSAweDA7CiAgICAgYWRkcmVzcyBwdWJsaWMgaWNvQ29udHJhY3RBZGRyZXNzID0gMHgwOwogICAgIGJvb2wgcHVibGljIGxvY2tUcmFuc2ZlcnMgPSBmYWxzZTsKCiAgICAgLy8gMTAgbWxuCiAgICAgdWludCBwdWJsaWMgY29uc3RhbnQgVE9UQUxfVE9LRU5fU1VQUExZID0gMTAwMDAwMDAgKiAoMSBldGhlciAvIDEgd2VpKTsKCi8vLyBNb2RpZmllcnM6CiAgICAgbW9kaWZpZXIgb25seUNyZWF0b3IoKSB7IAogICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyZWF0b3IpOyAKICAgICAgICAgIF87IAogICAgIH0KCiAgICAgbW9kaWZpZXIgYnlDcmVhdG9yT3JJY29Db250cmFjdCgpIHsgCiAgICAgICAgICByZXF1aXJlKChtc2cuc2VuZGVyID09IGNyZWF0b3IpIHx8IChtc2cuc2VuZGVyID09IGljb0NvbnRyYWN0QWRkcmVzcykpOyAKICAgICAgICAgIF87IAogICAgIH0KCiAgICAgZnVuY3Rpb24gc2V0Q3JlYXRvcihhZGRyZXNzIF9jcmVhdG9yKSBvbmx5Q3JlYXRvciB7CiAgICAgICAgICBjcmVhdG9yID0gX2NyZWF0b3I7CiAgICAgfQoKLy8vIFNldHRlcnMvR2V0dGVycwogICAgIGZ1bmN0aW9uIHNldEljb0NvbnRyYWN0QWRkcmVzcyhhZGRyZXNzIF9pY29Db250cmFjdEFkZHJlc3MpIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIGljb0NvbnRyYWN0QWRkcmVzcyA9IF9pY29Db250cmFjdEFkZHJlc3M7CiAgICAgfQoKLy8vIEZ1bmN0aW9uczoKICAgICAvLy8gQGRldiBDb25zdHJ1Y3RvcgogICAgIGZ1bmN0aW9uIE1OVFAoKSB7CiAgICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKCiAgICAgICAgICAvLyAxMCBtbG4gdG9rZW5zIHRvdGFsCiAgICAgICAgICBhc3NlcnQoVE9UQUxfVE9LRU5fU1VQUExZID09ICgxMDAwMDAwMCAqICgxIGV0aGVyIC8gMSB3ZWkpKSk7CiAgICAgfQoKICAgICAvLy8gQGRldiBPdmVycmlkZQogICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMoYm9vbCl7CiAgICAgICAgICByZXF1aXJlKCFsb2NrVHJhbnNmZXJzKTsKICAgICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sX3ZhbHVlKTsKICAgICB9CgogICAgIC8vLyBAZGV2IE92ZXJyaWRlCiAgICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMoYm9vbCl7CiAgICAgICAgICByZXF1aXJlKCFsb2NrVHJhbnNmZXJzKTsKICAgICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sX3RvLF92YWx1ZSk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBpc3N1ZVRva2VucyhhZGRyZXNzIF93aG8sIHVpbnQgX3Rva2VucykgYnlDcmVhdG9yT3JJY29Db250cmFjdCB7CiAgICAgICAgICByZXF1aXJlKCh0b3RhbFN1cHBseSArIF90b2tlbnMpIDw9IFRPVEFMX1RPS0VOX1NVUFBMWSk7CgogICAgICAgICAgYmFsYW5jZXNbX3dob10gPSBzYWZlQWRkKGJhbGFuY2VzW193aG9dLF90b2tlbnMpOwogICAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlQWRkKHRvdGFsU3VwcGx5LF90b2tlbnMpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIF93aG8sIHVpbnQgX3Rva2VucykgYnlDcmVhdG9yT3JJY29Db250cmFjdCB7CiAgICAgICAgICBiYWxhbmNlc1tfd2hvXSA9IHNhZmVTdWIoYmFsYW5jZXNbX3dob10sIF90b2tlbnMpOwogICAgICAgICAgdG90YWxTdXBwbHkgPSBzYWZlU3ViKHRvdGFsU3VwcGx5LCBfdG9rZW5zKTsKICAgICB9CgogICAgIGZ1bmN0aW9uIGxvY2tUcmFuc2Zlcihib29sIF9sb2NrKSBieUNyZWF0b3JPckljb0NvbnRyYWN0IHsKICAgICAgICAgIGxvY2tUcmFuc2ZlcnMgPSBfbG9jazsKICAgICB9CgogICAgIC8vIERvIG5vdCBhbGxvdyB0byBzZW5kIG1vbmV5IGRpcmVjdGx5IHRvIHRoaXMgY29udHJhY3QKICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldmVydCgpOwogICAgIH0KfQoKLy8gVGhpcyBjb250cmFjdCB3aWxsIGhvbGQgYWxsIHRva2VucyB0aGF0IHdlcmUgdW5zb2xkIGR1cmluZyBJQ08KLy8gKEdvbGRtaW50IHNob3VsZCBiZSBhYmxlIHRvIHdpdGhkcmF3IHRoZW0gYW5kIHNvbGQgb25seSAxIHllYXIgcG9zdC1JQ08pCmNvbnRyYWN0IEdvbGRtaW50VW5zb2xkIGlzIFNhZmVNYXRoIHsKICAgICBhZGRyZXNzIHB1YmxpYyBjcmVhdG9yOwogICAgIGFkZHJlc3MgcHVibGljIHRlYW1BY2NvdW50QWRkcmVzczsKICAgICBhZGRyZXNzIHB1YmxpYyBpY29Db250cmFjdEFkZHJlc3M7CiAgICAgdWludDY0IHB1YmxpYyBpY29Jc0ZpbmlzaGVkRGF0ZTsKCiAgICAgTU5UUCBwdWJsaWMgbW50VG9rZW47CgogICAgIGZ1bmN0aW9uIEdvbGRtaW50VW5zb2xkKGFkZHJlc3MgX3RlYW1BY2NvdW50QWRkcmVzcyxhZGRyZXNzIF9tbnRUb2tlbkFkZHJlc3MpewogICAgICAgICAgY3JlYXRvciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICB0ZWFtQWNjb3VudEFkZHJlc3MgPSBfdGVhbUFjY291bnRBZGRyZXNzOwoKICAgICAgICAgIG1udFRva2VuID0gTU5UUChfbW50VG9rZW5BZGRyZXNzKTsgICAgICAgICAgCiAgICAgfQoKICAgICBtb2RpZmllciBvbmx5Q3JlYXRvcigpIHsgCiAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PWNyZWF0b3IpOyAKICAgICAgICAgIF87IAogICAgIH0KCiAgICAgbW9kaWZpZXIgb25seUljb0NvbnRyYWN0KCkgeyAKICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09aWNvQ29udHJhY3RBZGRyZXNzKTsgCiAgICAgICAgICBfOyAKICAgICB9CgovLy8gU2V0dGVycy9HZXR0ZXJzCiAgICAgZnVuY3Rpb24gc2V0SWNvQ29udHJhY3RBZGRyZXNzKGFkZHJlc3MgX2ljb0NvbnRyYWN0QWRkcmVzcykgb25seUNyZWF0b3IgewogICAgICAgICAgaWNvQ29udHJhY3RBZGRyZXNzID0gX2ljb0NvbnRyYWN0QWRkcmVzczsKICAgICB9CgogICAgIC8vIG9ubHkgYnkgR29sZG1pbnQgY29udHJhY3QgCiAgICAgZnVuY3Rpb24gZmluaXNoSWNvKCkgcHVibGljIG9ubHlJY29Db250cmFjdCB7CiAgICAgICAgICBpY29Jc0ZpbmlzaGVkRGF0ZSA9IHVpbnQ2NChub3cpOwogICAgIH0KCiAgICAgLy8gY2FuIGJlIGNhbGxlZCBieSBhbnlvbmUuLi4KICAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucygpIHB1YmxpYyB7CiAgICAgICAgICAvLyB3YWl0IGZvciAxIHllYXIhCiAgICAgICAgICB1aW50NjQgb25lWWVhclBhc3NlZCA9IGljb0lzRmluaXNoZWREYXRlICsgMzY1IGRheXM7ICAKICAgICAgICAgIHJlcXVpcmUodWludChub3cpID49IG9uZVllYXJQYXNzZWQpOwoKICAgICAgICAgIC8vIHRyYW5zZmVyIGFsbCB0b2tlbnMgZnJvbSB0aGlzIGNvbnRyYWN0IHRvIHRoZSB0ZWFtQWNjb3VudEFkZHJlc3MKICAgICAgICAgIHVpbnQgdG90YWwgPSBtbnRUb2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgICBtbnRUb2tlbi50cmFuc2Zlcih0ZWFtQWNjb3VudEFkZHJlc3MsdG90YWwpOwogICAgIH0KCiAgICAgLy8gRGVmYXVsdCBmYWxsYmFjayBmdW5jdGlvbgogICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgICByZXZlcnQoKTsKICAgICB9Cn0KCmNvbnRyYWN0IEZvdW5kZXJzVmVzdGluZyBpcyBTYWZlTWF0aCB7CiAgICAgYWRkcmVzcyBwdWJsaWMgdGVhbUFjY291bnRBZGRyZXNzOwogICAgIHVpbnQ2NCBwdWJsaWMgbGFzdFdpdGhkcmF3VGltZTsKCiAgICAgdWludCBwdWJsaWMgd2l0aGRyYXdzQ291bnQgPSAwOwogICAgIHVpbnQgcHVibGljIGFtb3VudFRvU2VuZCA9IDA7CgogICAgIE1OVFAgcHVibGljIG1udFRva2VuOwoKICAgICBmdW5jdGlvbiBGb3VuZGVyc1Zlc3RpbmcoYWRkcmVzcyBfdGVhbUFjY291bnRBZGRyZXNzLGFkZHJlc3MgX21udFRva2VuQWRkcmVzcyl7CiAgICAgICAgICB0ZWFtQWNjb3VudEFkZHJlc3MgPSBfdGVhbUFjY291bnRBZGRyZXNzOwogICAgICAgICAgbGFzdFdpdGhkcmF3VGltZSA9IHVpbnQ2NChub3cpOwoKICAgICAgICAgIG1udFRva2VuID0gTU5UUChfbW50VG9rZW5BZGRyZXNzKTsgICAgICAgICAgCiAgICAgfQoKICAgICAvLyBjYW4gYmUgY2FsbGVkIGJ5IGFueW9uZS4uLgogICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKCkgcHVibGljIHsKICAgICAgICAgIC8vIDEgLSB3YWl0IGZvciBuZXh0IG1vbnRoIQogICAgICAgICAgdWludDY0IG9uZU1vbnRoID0gbGFzdFdpdGhkcmF3VGltZSArIDMwIGRheXM7ICAKICAgICAgICAgIHJlcXVpcmUodWludChub3cpID49IG9uZU1vbnRoKTsKCiAgICAgICAgICAvLyAyIC0gY2FsY3VsYXRlIGFtb3VudCAob25seSBmaXJzdCB0aW1lKQogICAgICAgICAgaWYod2l0aGRyYXdzQ291bnQ9PTApewogICAgICAgICAgICAgICBhbW91bnRUb1NlbmQgPSBtbnRUb2tlbi5iYWxhbmNlT2YodGhpcykgLyAxMDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXF1aXJlKGFtb3VudFRvU2VuZCE9MCk7CgogICAgICAgICAgLy8gMyAtIHNlbmQgMS8xMHRoCiAgICAgICAgICB1aW50IGN1cnJlbnRCYWxhbmNlID0gbW50VG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgICAgaWYoY3VycmVudEJhbGFuY2U8YW1vdW50VG9TZW5kKXsKICAgICAgICAgICAgIGFtb3VudFRvU2VuZCA9IGN1cnJlbnRCYWxhbmNlOyAgCiAgICAgICAgICB9CiAgICAgICAgICBtbnRUb2tlbi50cmFuc2Zlcih0ZWFtQWNjb3VudEFkZHJlc3MsYW1vdW50VG9TZW5kKTsKCiAgICAgICAgICAvLyA0IC0gdXBkYXRlIGNvdW50ZXIKICAgICAgICAgIHdpdGhkcmF3c0NvdW50Kys7CiAgICAgICAgICBsYXN0V2l0aGRyYXdUaW1lID0gdWludDY0KG5vdyk7CiAgICAgfQoKICAgICAvLyBEZWZhdWx0IGZhbGxiYWNrIGZ1bmN0aW9uCiAgICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICAgIHJlcXVpcmUoZmFsc2UpOwogICAgIH0KfQoKY29udHJhY3QgR29sZG1pbnQgaXMgU2FmZU1hdGggewogICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3IgPSAweDA7CiAgICAgYWRkcmVzcyBwdWJsaWMgdG9rZW5NYW5hZ2VyID0gMHgwOwogICAgIGFkZHJlc3MgcHVibGljIG11bHRpc2lnQWRkcmVzcyA9IDB4MDsKICAgICBhZGRyZXNzIHB1YmxpYyBvdGhlckN1cnJlbmNpZXNDaGVja2VyID0gMHgwOwoKICAgICB1aW50NjQgcHVibGljIGljb1N0YXJ0ZWRUaW1lID0gMDsKCiAgICAgTU5UUCBwdWJsaWMgbW50VG9rZW47IAogICAgIEdvbGRtaW50VW5zb2xkIHB1YmxpYyB1bnNvbGRDb250cmFjdDsKCiAgICAgc3RydWN0IFRva2VuQnV5ZXIgewogICAgICAgICAgdWludCB3ZWlTZW50OwogICAgICAgICAgdWludCB0b2tlbnNHb3Q7CiAgICAgfQogICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBUb2tlbkJ1eWVyKSBidXllcnM7CgogICAgIC8vIFRoZXNlIGNhbiBiZSBjaGFuZ2VkIGJlZm9yZSBJQ08gc3RhcnQgKCQ3VVNEL01OVFApCiAgICAgdWludCBjb25zdGFudCBTVERfUFJJQ0VfVVNEX1BFUl8xMDAwX1RPS0VOUyA9IDcwMDA7CiAgICAgLy8gY29pbm1hcmtldGNhcC5jb20gMTQuMDguMjAxNwogICAgIHVpbnQgY29uc3RhbnQgRVRIX1BSSUNFX0lOX1VTRCA9IDMwMDsKICAgICAvLyBwcmljZSBjaGFuZ2VzIGZyb20gYmxvY2sgdG8gYmxvY2sKICAgICAvL3VpbnQgcHVibGljIGNvbnN0YW50IFNJTkdMRV9CTE9DS19MRU4gPSA3MDAwMDA7CgogICAgIC8vIFRPRE86IG9ubHkgZm9yIHRlc3RzLiBETyBOT1QgbWVyZ2UgdGhpcyB0byBtYXN0ZXIhISEKICAgICB1aW50IHB1YmxpYyBjb25zdGFudCBTSU5HTEVfQkxPQ0tfTEVOID0gMTAwOwoKLy8vLy8vLyAgICAgCiAgICAgLy8gMSAwMDAgMDAwIHRva2VucwogICAgIHVpbnQgcHVibGljIGNvbnN0YW50IEJPTlVTX1JFV0FSRCA9IDEwMDAwMDAgKiAoMSBldGhlci8gMSB3ZWkpOwogICAgIC8vIDIgMDAwIDAwMCB0b2tlbnMKICAgICB1aW50IHB1YmxpYyBjb25zdGFudCBGT1VOREVSU19SRVdBUkQgPSAyMDAwMDAwICogKDEgZXRoZXIgLyAxIHdlaSk7CiAgICAgLy8gNyAwMDAgMDAwIHdlIHNlbGwgb25seSB0aGlzIGFtb3VudCBvZiB0b2tlbnMgZHVyaW5nIHRoZSBJQ08KICAgICAvL3VpbnQgcHVibGljIGNvbnN0YW50IElDT19UT0tFTl9TVVBQTFlfTElNSVQgPSA3MDAwMDAwICogKDEgZXRoZXIgLyAxIHdlaSk7IAoKICAgICAvLyBUT0RPOiBvbmx5IGZvciB0ZXN0cy4gRE8gTk9UIG1lcmdlIHRoaXMgdG8gbWFzdGVyISEhCiAgICAgLy8gMTUwIC0gd2Ugc2VsbCBvbmx5IHRoaXMgYW1vdW50IG9mIHRva2VucyBkdXJpbmcgdGhlIElDTwogICAgIHVpbnQgcHVibGljIGNvbnN0YW50IElDT19UT0tFTl9TVVBQTFlfTElNSVQgPSAxNTAgKiAoMSBldGhlciAvIDEgd2VpKTsgCgogICAgIC8vIDE1MCAwMDAgdG9rZW5zIHNvZnQgY2FwCiAgICAgdWludCBwdWJsaWMgY29uc3RhbnQgSUNPX1RPS0VOX1NPRlRfQ0FQID0gMTUwMDAwICogKDEgZXRoZXIgLyAxIHdlaSk7CiAgICAgCiAgICAgLy8gdGhpcyBpcyB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIHNvbGQgZHVyaW5nIElDTwogICAgIHVpbnQgcHVibGljIGljb1Rva2Vuc1NvbGQgPSAwOwogICAgIC8vIHRoaXMgaXMgdG90YWwgbnVtYmVyIG9mIHRva2VucyBzZW50IHRvIEdvbGRtaW50VW5zb2xkIGNvbnRyYWN0IGFmdGVyIElDTyBpcyBmaW5pc2hlZAogICAgIHVpbnQgcHVibGljIGljb1Rva2Vuc1Vuc29sZCA9IDA7CgogICAgIC8vIHRoaXMgaXMgdG90YWwgbnVtYmVyIG9mIHRva2VucyB0aGF0IHdlcmUgaXNzdWVkIGJ5IGEgc2NyaXB0cwogICAgIHVpbnQgcHVibGljIGlzc3VlZEV4dGVybmFsbHlUb2tlbnMgPSAwOwoKICAgICBib29sIHB1YmxpYyBmb3VuZGVyc1Jld2FyZHNNaW50ZWQgPSBmYWxzZTsKICAgICBib29sIHB1YmxpYyByZXN0VG9rZW5zTW92ZWQgPSBmYWxzZTsKCiAgICAgLy8gdGhpcyBpcyB3aGVyZSBGT1VOREVSU19SRVdBUkQgd2lsbCBiZSBhbGxvY2F0ZWQKICAgICBhZGRyZXNzIHB1YmxpYyBmb3VuZGVyc1Jld2FyZHNBY2NvdW50ID0gMHgwOwoKICAgICBlbnVtIFN0YXRlewogICAgICAgICAgSW5pdCwKCiAgICAgICAgICBJQ09SdW5uaW5nLAogICAgICAgICAgSUNPUGF1c2VkLAogICAgICAgICAKICAgICAgICAgIElDT0ZpbmlzaGVkLAoKICAgICAgICAgIFJlZnVuZGluZwogICAgIH0KICAgICBTdGF0ZSBwdWJsaWMgY3VycmVudFN0YXRlID0gU3RhdGUuSW5pdDsKCi8vLyBNb2RpZmllcnM6CiAgICAgbW9kaWZpZXIgb25seUNyZWF0b3IoKSB7IAogICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyPT1jcmVhdG9yKTsgCiAgICAgICAgICBfOyAKICAgICB9CiAgICAgbW9kaWZpZXIgb25seVRva2VuTWFuYWdlcigpIHsgCiAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXI9PXRva2VuTWFuYWdlcik7IAogICAgICAgICAgXzsgCiAgICAgfQogICAgIG1vZGlmaWVyIG9ubHlPdGhlckN1cnJlbmNpZXNDaGVja2VyKCkgeyAKICAgICAgICAgIHJlcXVpcmUobXNnLnNlbmRlcj09b3RoZXJDdXJyZW5jaWVzQ2hlY2tlcik7IAogICAgICAgICAgXzsgCiAgICAgfQogICAgIG1vZGlmaWVyIG9ubHlJblN0YXRlKFN0YXRlIHN0YXRlKXsgCiAgICAgICAgICByZXF1aXJlKHN0YXRlPT1jdXJyZW50U3RhdGUpOyAKICAgICAgICAgIF87IAogICAgIH0KCi8vLyBFdmVudHM6CiAgICAgZXZlbnQgTG9nU3RhdGVTd2l0Y2goU3RhdGUgbmV3U3RhdGUpOwogICAgIGV2ZW50IExvZ0J1eShhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgdmFsdWUpOwogICAgIGV2ZW50IExvZ0J1cm4oYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IHZhbHVlKTsKICAgICAKLy8vIEZ1bmN0aW9uczoKICAgICAvLy8gQGRldiBDb25zdHJ1Y3RvcgogICAgIGZ1bmN0aW9uIEdvbGRtaW50KAogICAgICAgICAgYWRkcmVzcyBfbXVsdGlzaWdBZGRyZXNzLAogICAgICAgICAgYWRkcmVzcyBfdG9rZW5NYW5hZ2VyLAogICAgICAgICAgYWRkcmVzcyBfb3RoZXJDdXJyZW5jaWVzQ2hlY2tlciwKCiAgICAgICAgICBhZGRyZXNzIF9tbnRUb2tlbkFkZHJlc3MsCiAgICAgICAgICBhZGRyZXNzIF91bnNvbGRDb250cmFjdEFkZHJlc3MsCiAgICAgICAgICBhZGRyZXNzIF9mb3VuZGVyc1Zlc3RpbmdBZGRyZXNzKQogICAgIHsKICAgICAgICAgIGNyZWF0b3IgPSBtc2cuc2VuZGVyOwoKICAgICAgICAgIG11bHRpc2lnQWRkcmVzcyA9IF9tdWx0aXNpZ0FkZHJlc3M7CiAgICAgICAgICB0b2tlbk1hbmFnZXIgPSBfdG9rZW5NYW5hZ2VyOwogICAgICAgICAgb3RoZXJDdXJyZW5jaWVzQ2hlY2tlciA9IF9vdGhlckN1cnJlbmNpZXNDaGVja2VyOyAKCiAgICAgICAgICBtbnRUb2tlbiA9IE1OVFAoX21udFRva2VuQWRkcmVzcyk7CiAgICAgICAgICB1bnNvbGRDb250cmFjdCA9IEdvbGRtaW50VW5zb2xkKF91bnNvbGRDb250cmFjdEFkZHJlc3MpOwoKICAgICAgICAgIC8vIHNsaWdodCByZW5hbWUKICAgICAgICAgIGZvdW5kZXJzUmV3YXJkc0FjY291bnQgPSBfZm91bmRlcnNWZXN0aW5nQWRkcmVzczsKICAgICB9CgogICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gaXMgYXV0b21hdGljYWxseSBjYWxsZWQgd2hlbiBJQ08gaXMgc3RhcnRlZAogICAgIC8vLyBXQVJOSU5HOiBjYW4gYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzIQogICAgIGZ1bmN0aW9uIHN0YXJ0SUNPKCkgaW50ZXJuYWwgb25seUNyZWF0b3IgewogICAgICAgICAgbWludEZvdW5kZXJzUmV3YXJkcyhmb3VuZGVyc1Jld2FyZHNBY2NvdW50KTsKCiAgICAgICAgICBtbnRUb2tlbi5sb2NrVHJhbnNmZXIodHJ1ZSk7CgogICAgICAgICAgaWYoaWNvU3RhcnRlZFRpbWU9PTApewogICAgICAgICAgICAgICBpY29TdGFydGVkVGltZSA9IHVpbnQ2NChub3cpOwogICAgICAgICAgfQogICAgIH0KCiAgICAgZnVuY3Rpb24gcGF1c2VJQ08oKSBpbnRlcm5hbCBvbmx5Q3JlYXRvciB7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzdGFydFJlZnVuZGluZygpIGludGVybmFsIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIC8vIG9ubHkgc3dpdGNoIHRvIHRoaXMgc3RhdGUgaWYgbGVzcyB0aGFuIElDT19UT0tFTl9TT0ZUX0NBUCBzb2xkCiAgICAgICAgICByZXF1aXJlKGljb1Rva2Vuc1NvbGQ8SUNPX1RPS0VOX1NPRlRfQ0FQKTsKCiAgICAgICAgICAvLyBpbiB0aGlzIHN0YXRlIHRva2VucyBzdGlsbCBzaG91bGRuJ3QgYmUgdHJhbnNmZXJyZWQKICAgICAgICAgIGFzc2VydChtbnRUb2tlbi5sb2NrVHJhbnNmZXJzKCkpOwogICAgIH0KCiAgICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGNhbGxlZCB3aGVuIElDTyBpcyBmaW5pc2hlZCAKICAgICAvLy8gV0FSTklORzogY2FuIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyEKICAgICBmdW5jdGlvbiBmaW5pc2hJQ08oKSBpbnRlcm5hbCB7CiAgICAgICAgICBtbnRUb2tlbi5sb2NrVHJhbnNmZXIoZmFsc2UpOwoKICAgICAgICAgIGlmKCFyZXN0VG9rZW5zTW92ZWQpewogICAgICAgICAgICAgICByZXN0VG9rZW5zTW92ZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgLy8gbW92ZSBhbGwgdW5zb2xkIHRva2VucyB0byB1bnNvbGRUb2tlbnMgY29udHJhY3QKICAgICAgICAgICAgICAgaWNvVG9rZW5zVW5zb2xkID0gc2FmZVN1YihJQ09fVE9LRU5fU1VQUExZX0xJTUlULGljb1Rva2Vuc1NvbGQpOwogICAgICAgICAgICAgICBpZihpY29Ub2tlbnNVbnNvbGQ+MCl7CiAgICAgICAgICAgICAgICAgICAgbW50VG9rZW4uaXNzdWVUb2tlbnModW5zb2xkQ29udHJhY3QsaWNvVG9rZW5zVW5zb2xkKTsKICAgICAgICAgICAgICAgICAgICB1bnNvbGRDb250cmFjdC5maW5pc2hJY28oKTsKICAgICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIHNlbmQgYWxsIEVUSCB0byBtdWx0aXNpZwogICAgICAgICAgaWYodGhpcy5iYWxhbmNlPjApewogICAgICAgICAgICAgICBtdWx0aXNpZ0FkZHJlc3MudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgIH0KICAgICB9CgogICAgIGZ1bmN0aW9uIG1pbnRGb3VuZGVyc1Jld2FyZHMoYWRkcmVzcyBfd2hlcmVUb01pbnQpIGludGVybmFsIG9ubHlDcmVhdG9yIHsKICAgICAgICAgIGlmKCFmb3VuZGVyc1Jld2FyZHNNaW50ZWQpewogICAgICAgICAgICAgICBmb3VuZGVyc1Jld2FyZHNNaW50ZWQgPSB0cnVlOwogICAgICAgICAgICAgICBtbnRUb2tlbi5pc3N1ZVRva2Vucyhfd2hlcmVUb01pbnQsRk9VTkRFUlNfUkVXQVJEKTsKICAgICAgICAgIH0KICAgICB9CgovLy8gQWNjZXNzIG1ldGhvZHM6CiAgICAgZnVuY3Rpb24gc2V0VG9rZW5NYW5hZ2VyKGFkZHJlc3MgX25ldykgcHVibGljIG9ubHlUb2tlbk1hbmFnZXIgewogICAgICAgICAgdG9rZW5NYW5hZ2VyID0gX25ldzsKICAgICB9CgogICAgIGZ1bmN0aW9uIHNldE90aGVyQ3VycmVuY2llc0NoZWNrZXIoYWRkcmVzcyBfbmV3KSBwdWJsaWMgb25seUNyZWF0b3IgewogICAgICAgICAgb3RoZXJDdXJyZW5jaWVzQ2hlY2tlciA9IF9uZXc7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRUb2tlbnNJY29Tb2xkKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpewogICAgICAgICAgcmV0dXJuIGljb1Rva2Vuc1NvbGQ7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRUb3RhbEljb1Rva2VucygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KXsKICAgICAgICAgIHJldHVybiBJQ09fVE9LRU5fU1VQUExZX0xJTUlUOwogICAgIH0KCiAgICAgZnVuY3Rpb24gZ2V0TW50VG9rZW5CYWxhbmNlKGFkZHJlc3MgX29mKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCl7CiAgICAgICAgICByZXR1cm4gbW50VG9rZW4uYmFsYW5jZU9mKF9vZik7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UoKWNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KXsKICAgICAgICAgIHJldHVybiBnZXRNbnRUb2tlbnNQZXJFdGgoaWNvVG9rZW5zU29sZCk7CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRCbG9ja0xlbmd0aCgpY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpewogICAgICAgICAgcmV0dXJuIFNJTkdMRV9CTE9DS19MRU47CiAgICAgfQoKLy8vLwogICAgIGZ1bmN0aW9uIGlzSWNvRmluaXNoZWQoKSBwdWJsaWMgcmV0dXJucyhib29sKXsKICAgICAgICAgIGlmKGljb1N0YXJ0ZWRUaW1lPT0wKXtyZXR1cm4gZmFsc2U7fSAgICAgICAgICAKCiAgICAgICAgICAvLyAxIC0gaWYgdGltZSBlbGFwc2VkCiAgICAgICAgICB1aW50NjQgb25lTW9udGggPSBpY29TdGFydGVkVGltZSArIDMwIGRheXM7ICAKICAgICAgICAgIGlmKHVpbnQobm93KSA+IG9uZU1vbnRoKXtyZXR1cm4gdHJ1ZTt9CgogICAgICAgICAgLy8gMiAtIGlmIGFsbCB0b2tlbnMgYXJlIHNvbGQKICAgICAgICAgIGlmKGljb1Rva2Vuc1NvbGQ+PUlDT19UT0tFTl9TVVBQTFlfTElNSVQpewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgfQoKICAgICBmdW5jdGlvbiBzZXRTdGF0ZShTdGF0ZSBfbmV4dFN0YXRlKSBwdWJsaWMgewogICAgICAgICAgLy8gb25seSBjcmVhdG9yIGNhbiBjaGFuZ2Ugc3RhdGUKICAgICAgICAgIC8vIGJ1dCBpbiBjYXNlIElDT0ZpbmlzaGVkIC0+IGFueW9uZSBjYW4gZG8gdGhhdCBhZnRlciBhbGwgdGltZSBpcyBlbGFwc2VkCiAgICAgICAgICBib29sIGljb1Nob3VsZEJlRmluaXNoZWQgPSBpc0ljb0ZpbmlzaGVkKCk7CiAgICAgICAgICBib29sIGFsbG93ID0gKG1zZy5zZW5kZXI9PWNyZWF0b3IpIHx8IChpY29TaG91bGRCZUZpbmlzaGVkICYmIChTdGF0ZS5JQ09GaW5pc2hlZD09X25leHRTdGF0ZSkpOwogICAgICAgICAgcmVxdWlyZShhbGxvdyk7CgogICAgICAgICAgYm9vbCBjYW5Td2l0Y2hTdGF0ZQogICAgICAgICAgICAgICA9ICAoY3VycmVudFN0YXRlID09IFN0YXRlLkluaXQgJiYgX25leHRTdGF0ZSA9PSBTdGF0ZS5JQ09SdW5uaW5nKQogICAgICAgICAgICAgICB8fCAoY3VycmVudFN0YXRlID09IFN0YXRlLklDT1J1bm5pbmcgJiYgX25leHRTdGF0ZSA9PSBTdGF0ZS5JQ09QYXVzZWQpCiAgICAgICAgICAgICAgIHx8IChjdXJyZW50U3RhdGUgPT0gU3RhdGUuSUNPUGF1c2VkICYmIF9uZXh0U3RhdGUgPT0gU3RhdGUuSUNPUnVubmluZykKICAgICAgICAgICAgICAgfHwgKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5JQ09SdW5uaW5nICYmIF9uZXh0U3RhdGUgPT0gU3RhdGUuSUNPRmluaXNoZWQpCiAgICAgICAgICAgICAgIHx8IChjdXJyZW50U3RhdGUgPT0gU3RhdGUuSUNPUnVubmluZyAmJiBfbmV4dFN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CgogICAgICAgICAgcmVxdWlyZShjYW5Td2l0Y2hTdGF0ZSk7CgogICAgICAgICAgY3VycmVudFN0YXRlID0gX25leHRTdGF0ZTsKICAgICAgICAgIExvZ1N0YXRlU3dpdGNoKF9uZXh0U3RhdGUpOwoKICAgICAgICAgIGlmKGN1cnJlbnRTdGF0ZT09U3RhdGUuSUNPUnVubmluZyl7CiAgICAgICAgICAgICAgIHN0YXJ0SUNPKCk7CiAgICAgICAgICB9ZWxzZSBpZihjdXJyZW50U3RhdGU9PVN0YXRlLklDT0ZpbmlzaGVkKXsKICAgICAgICAgICAgICAgZmluaXNoSUNPKCk7CiAgICAgICAgICB9ZWxzZSBpZihjdXJyZW50U3RhdGU9PVN0YXRlLklDT1BhdXNlZCl7CiAgICAgICAgICAgICAgIHBhdXNlSUNPKCk7CiAgICAgICAgICB9ZWxzZSBpZihjdXJyZW50U3RhdGU9PVN0YXRlLlJlZnVuZGluZyl7CiAgICAgICAgICAgICAgIHN0YXJ0UmVmdW5kaW5nKCk7CiAgICAgICAgICB9CiAgICAgfQoKICAgICBmdW5jdGlvbiBnZXRNbnRUb2tlbnNQZXJFdGgodWludCB0b2tlbnNTb2xkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCl7CiAgICAgICAgICAvLyAxMCBidWNrZXRzCiAgICAgICAgICB1aW50IHByaWNlSW5kZXggPSAodG9rZW5zU29sZCAvICgxIGV0aGVyLyAxIHdlaSkpIC8gU0lOR0xFX0JMT0NLX0xFTjsKICAgICAgICAgIGFzc2VydChwcmljZUluZGV4Pj0wICYmIChwcmljZUluZGV4PD05KSk7CiAgICAgICAgICAKICAgICAgICAgIHVpbnQ4WzEwXSBtZW1vcnkgZGlzY291bnRQZXJjZW50cyA9IFsyMCwxNSwxMCw4LDYsNCwyLDAsMCwwXTsKCiAgICAgICAgICAvLyBXZSBoYXZlIHRvIG11bHRpcGx5IGJ5ICcxIGV0aGVyJyB0byBhdm9pZCBmbG9hdCB0cnVuY2F0aW9ucwogICAgICAgICAgLy8gRXhhbXBsZTogKCQ3MDAwICogMTAwKSAvIDEyMCA9ICQ1ODMzLjMzMzMzCiAgICAgICAgICB1aW50IHByaWNlUGVyMTAwMHRva2Vuc1VzZCA9IAogICAgICAgICAgICAgICAoKFNURF9QUklDRV9VU0RfUEVSXzEwMDBfVE9LRU5TICogMTAwKSAqICgxIGV0aGVyIC8gMSB3ZWkpKSAvICgxMDAgKyBkaXNjb3VudFBlcmNlbnRzW3ByaWNlSW5kZXhdKTsKCiAgICAgICAgICAvLyBDb3JyZWN0OiAzMDAwMDAgLyA1ODMzLjMzMzMzMzMzID0gNTEuNDI4NTcxNDIKICAgICAgICAgIC8vIFdlIGhhdmUgdG8gbXVsdGlwbHkgYnkgJzEgZXRoZXInIHRvIGF2b2lkIGZsb2F0IHRydW5jYXRpb25zCiAgICAgICAgICB1aW50IG1udFBlckV0aCA9IChFVEhfUFJJQ0VfSU5fVVNEICogMTAwMCAqICgxIGV0aGVyIC8gMSB3ZWkpICogKDEgZXRoZXIgLyAxIHdlaSkpIC8gcHJpY2VQZXIxMDAwdG9rZW5zVXNkOwogICAgICAgICAgcmV0dXJuIG1udFBlckV0aDsKICAgICB9CgogICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIF9idXllcikgcHVibGljIHBheWFibGUgb25seUluU3RhdGUoU3RhdGUuSUNPUnVubmluZykgewogICAgICAgICAgcmVxdWlyZShtc2cudmFsdWUhPTApOwoKICAgICAgICAgIC8vIFRoZSBwcmljZSBpcyBzZWxlY3RlZCBiYXNlZCBvbiBjdXJyZW50IHNvbGQgdG9rZW5zLgogICAgICAgICAgLy8gUHJpY2UgY2FuICdvdmVybGFwJy4gRm9yIGV4YW1wbGU6CiAgICAgICAgICAvLyAgIDEuIGlmIGN1cnJlbnRseSB3ZSBzb2xkIDY5OTk1MCB0b2tlbnMgKHRoZSBwcmljZSBpcyAxMCUgZGlzY291bnQpCiAgICAgICAgICAvLyAgIDIuIGJ1eWVyIGJ1eXMgMTAwMCB0b2tlbnMKICAgICAgICAgIC8vICAgMy4gdGhlIHByaWNlIG9mIGFsbCAxMDAwIHRva2VucyB3b3VsZCBiZSB3aXRoIDEwJSBkaXNjb3VudCEhIQogICAgICAgICAgdWludCBuZXdUb2tlbnMgPSAobXNnLnZhbHVlICogZ2V0TW50VG9rZW5zUGVyRXRoKGljb1Rva2Vuc1NvbGQpKSAvICgxIGV0aGVyIC8gMSB3ZWkpOwoKICAgICAgICAgIGlzc3VlVG9rZW5zSW50ZXJuYWwoX2J1eWVyLG5ld1Rva2Vucyk7CgogICAgICAgICAgLy8gdXBkYXRlICdidXllcnMnIG1hcAogICAgICAgICAgLy8gKG9ubHkgd2hlbiBidXlpbmcgZnJvbSBFVEgpCiAgICAgICAgICBUb2tlbkJ1eWVyIG1lbW9yeSBiID0gYnV5ZXJzW21zZy5zZW5kZXJdOwogICAgICAgICAgYi53ZWlTZW50ID0gc2FmZUFkZChiLndlaVNlbnQsIG1zZy52YWx1ZSk7CiAgICAgICAgICBiLnRva2Vuc0dvdCA9IHNhZmVBZGQoYi50b2tlbnNHb3QsIG5ld1Rva2Vucyk7CiAgICAgICAgICBidXllcnNbbXNnLnNlbmRlcl0gPSBiOwogICAgIH0KCiAgICAgLy8vIEBkZXYgVGhpcyBpcyBjYWxsZWQgYnkgb3RoZXIgY3VycmVuY3kgcHJvY2Vzc29ycyB0byBpc3N1ZSBuZXcgdG9rZW5zIAogICAgIGZ1bmN0aW9uIGlzc3VlVG9rZW5zRnJvbU90aGVyQ3VycmVuY3koYWRkcmVzcyBfdG8sIHVpbnQgX3dlaV9jb3VudCkgb25seUluU3RhdGUoU3RhdGUuSUNPUnVubmluZykgcHVibGljIG9ubHlPdGhlckN1cnJlbmNpZXNDaGVja2VyIHsKICAgICAgICAgIHJlcXVpcmUoX3dlaV9jb3VudCE9MCk7CgogICAgICAgICAgdWludCBuZXdUb2tlbnMgPSAoX3dlaV9jb3VudCAqIGdldE1udFRva2Vuc1BlckV0aChpY29Ub2tlbnNTb2xkKSkgLyAoMSBldGhlciAvIDEgd2VpKTsKICAgICAgICAgIGlzc3VlVG9rZW5zSW50ZXJuYWwoX3RvLG5ld1Rva2Vucyk7CiAgICAgfQoKICAgICAvLy8gQGRldiBUaGlzIGNhbiBiZSBjYWxsZWQgdG8gbWFudWFsbHkgaXNzdWUgbmV3IHRva2VucyAKICAgICAvLy8gZnJvbSB0aGUgYm9udXMgcmV3YXJkCiAgICAgZnVuY3Rpb24gaXNzdWVUb2tlbnNFeHRlcm5hbChhZGRyZXNzIF90bywgdWludCBfdG9rZW5zKSBwdWJsaWMgb25seUluU3RhdGUoU3RhdGUuSUNPRmluaXNoZWQpIG9ubHlUb2tlbk1hbmFnZXIgewogICAgICAgICAgLy8gY2FuIG5vdCBpc3N1ZSBtb3JlIHRoYW4gQk9OVVNfUkVXQVJECiAgICAgICAgICByZXF1aXJlKChpc3N1ZWRFeHRlcm5hbGx5VG9rZW5zICsgX3Rva2Vucyk8PUJPTlVTX1JFV0FSRCk7CgogICAgICAgICAgbW50VG9rZW4uaXNzdWVUb2tlbnMoX3RvLF90b2tlbnMpOwoKICAgICAgICAgIGlzc3VlZEV4dGVybmFsbHlUb2tlbnMgPSBpc3N1ZWRFeHRlcm5hbGx5VG9rZW5zICsgX3Rva2VuczsKICAgICB9CgogICAgIGZ1bmN0aW9uIGlzc3VlVG9rZW5zSW50ZXJuYWwoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VucykgaW50ZXJuYWwgewogICAgICAgICAgcmVxdWlyZSgoaWNvVG9rZW5zU29sZCArIF90b2tlbnMpPD1JQ09fVE9LRU5fU1VQUExZX0xJTUlUKTsKCiAgICAgICAgICBtbnRUb2tlbi5pc3N1ZVRva2VucyhfdG8sX3Rva2Vucyk7CgogICAgICAgICAgaWNvVG9rZW5zU29sZCs9X3Rva2VuczsKCiAgICAgICAgICBMb2dCdXkoX3RvLF90b2tlbnMpOwogICAgIH0KCiAgICAgZnVuY3Rpb24gYnVyblRva2VucyhhZGRyZXNzIF9mcm9tLCB1aW50IF90b2tlbnMpIHB1YmxpYyBvbmx5SW5TdGF0ZShTdGF0ZS5JQ09GaW5pc2hlZCkgb25seVRva2VuTWFuYWdlciB7CiAgICAgICAgICBtbnRUb2tlbi5idXJuVG9rZW5zKF9mcm9tLF90b2tlbnMpOwoKICAgICAgICAgIExvZ0J1cm4oX2Zyb20sX3Rva2Vucyk7CiAgICAgfQoKICAgICAvLyBhbnlvbmUgY2FuIGNhbGwgdGhpcyBhbmQgZ2V0IGhpcyBtb25leSBiYWNrCiAgICAgZnVuY3Rpb24gZ2V0TXlSZWZ1bmQoKSBwdWJsaWMgb25seUluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7CiAgICAgICAgICBhZGRyZXNzIHNlbmRlciA9IG1zZy5zZW5kZXI7CgogICAgICAgICAgcmVxdWlyZSgwIT1idXllcnNbc2VuZGVyXS53ZWlTZW50KTsKICAgICAgICAgIHJlcXVpcmUoMCE9YnV5ZXJzW3NlbmRlcl0udG9rZW5zR290KTsKCiAgICAgICAgICAvLyAxIC0gc2VuZCBtb25leSBiYWNrCiAgICAgICAgICBzZW5kZXIudHJhbnNmZXIoYnV5ZXJzW3NlbmRlcl0ud2VpU2VudCk7CgogICAgICAgICAgLy8gMiAtIGJ1cm4gdG9rZW5zCiAgICAgICAgICBtbnRUb2tlbi5idXJuVG9rZW5zKHNlbmRlcixidXllcnNbc2VuZGVyXS50b2tlbnNHb3QpOwogICAgIH0KCiAgICAgLy8gRGVmYXVsdCBmYWxsYmFjayBmdW5jdGlvbgogICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgICAvLyBidXlUb2tlbnMgLT4gaXNzdWVUb2tlbnNJbnRlcm5hbAogICAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogICAgIH0KfQ=='.
	

]
