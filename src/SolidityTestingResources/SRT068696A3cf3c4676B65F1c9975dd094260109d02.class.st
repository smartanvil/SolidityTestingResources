Class {
	#name : #SRT068696A3cf3c4676B65F1c9975dd094260109d02,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT068696A3cf3c4676B65F1c9975dd094260109d02 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogVGhpcyBjb250cmFjdCBoYW5kbGVzIHRoZSBhY3Rpb25zIGZvciBldmVyeSBjb2xsZWN0aWJsZSBvbiBEQURBLi4uCiAqLwoKY29udHJhY3QgRGFkYUNvbGxlY3RpYmxlIHsKCiAgLy8gREFEQSdzIGFjY291bnQKICBhZGRyZXNzIG93bmVyOwoKCiAgLy8gc3RhcnRzIHR1cm5lZCBvZmYgdG8gcHJlcGFyZSB0aGUgZHJhd2luZ3MgYmVmb3JlIGdvaW5nIHB1YmxpYwogIGJvb2wgaXNFeGVjdXRpb25BbGxvd2VkID0gZmFsc2U7CgogIC8vIEVSQzIwIHRva2VuIHN0YW5kYXJkIGF0dHJpYnV0ZXMKICBzdHJpbmcgcHVibGljIG5hbWU7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgdWludDggcHVibGljIGRlY2ltYWxzOwogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICBzdHJ1Y3QgT2ZmZXIgewogICAgICBib29sIGlzRm9yU2FsZTsKICAgICAgdWludCBkcmF3aW5nSWQ7CiAgICAgIHVpbnQgcHJpbnRJbmRleDsKICAgICAgYWRkcmVzcyBzZWxsZXI7IAogICAgICB1aW50IG1pblZhbHVlOyAgICAgICAgICAvLyBpbiBldGhlcgogICAgICBhZGRyZXNzIG9ubHlTZWxsVG87ICAgICAvLyBzcGVjaWZ5IHRvIHNlbGwgb25seSB0byBhIHNwZWNpZmljIHBlcnNvbgogICAgICB1aW50IGxhc3RTZWxsVmFsdWU7CiAgfQoKICBzdHJ1Y3QgQmlkIHsKICAgICAgYm9vbCBoYXNCaWQ7CiAgICAgIHVpbnQgZHJhd2luZ0lkOwogICAgICB1aW50IHByaW50SW5kZXg7CiAgICAgIGFkZHJlc3MgYmlkZGVyOwogICAgICB1aW50IHZhbHVlOwogIH0KCiAgc3RydWN0IENvbGxlY3RpYmxlewogICAgdWludCBkcmF3aW5nSWQ7CiAgICBzdHJpbmcgY2hlY2tTdW07IC8vIGRpZ2VzdCBvZiB0aGUgZHJhd2luZywgY3JlYXRlZCB1c2luZyAgU0hBMgogICAgdWludCB0b3RhbFN1cHBseTsKICAgIHVpbnQgbmV4dFByaW50SW5kZXhUb0Fzc2lnbjsKICAgIGJvb2wgYWxsUHJpbnRzQXNzaWduZWQ7CiAgICB1aW50IGluaXRpYWxQcmljZTsKICAgIHVpbnQgaW5pdGlhbFByaW50SW5kZXg7CiAgICBzdHJpbmcgY29sbGVjdGlvbk5hbWU7CiAgICB1aW50IGF1dGhvclVJZDsgLy8gZHJhd2luZyBjcmVhdG9yIGlkIAogICAgc3RyaW5nIHNjYXJjaXR5OyAvLyBkZW5vdGVzIGhvdyBzY2FyY2UgaXMgdGhlIGRyYXdpbmcKICB9ICAgIAoKICAvLyBrZXk6IHByaW50SW5kZXgKICAvLyB0aGUgdmFsdWUgaXMgdGhlIHVzZXIgd2hvIG93bnMgdGhhdCBzcGVjaWZpYyBwcmludAogIG1hcHBpbmcgKHVpbnQgPT4gYWRkcmVzcykgcHVibGljIERyYXdpbmdQcmludFRvQWRkcmVzczsKICAKICAvLyBBIHJlY29yZCBvZiBjb2xsZWN0aWJsZXMgdGhhdCBhcmUgb2ZmZXJlZCBmb3Igc2FsZSBhdCBhIHNwZWNpZmljIG1pbmltdW0gdmFsdWUsIAogIC8vIGFuZCBwZXJoYXBzIHRvIGEgc3BlY2lmaWMgcGVyc29uLCB0aGUga2V5IHRvIGFjY2VzcyBhbmQgb2ZmZXIgaXMgdGhlIHByaW50SW5kZXguCiAgLy8gc2luY2UgZXZlcnkgc2luZ2xlIG9mZmVyIGluc2lkZSB0aGUgQ29sbGVjdGlibGUgc3RydWN0IHdpbGwgYmUgdGllZCB0byB0aGUgbWFpbgogIC8vIGRyYXdpbmdJZCB0aGF0IGlkZW50aWZpZXMgdGhhdCBjb2xsZWN0aWJsZS4KICBtYXBwaW5nICh1aW50ID0+IE9mZmVyKSBwdWJsaWMgT2ZmZXJlZEZvclNhbGU7CgogIC8vIEEgcmVjb3JkIG9mIHRoZSBoaWdoZXN0IGNvbGxlY3RpYmxlIGJpZCwgdGhlIGtleSB0byBhY2Nlc3MgYSBiaWQgaXMgdGhlIHByaW50SW5kZXgKICBtYXBwaW5nICh1aW50ID0+IEJpZCkgcHVibGljIEJpZHM7CgoKICAvLyAiSGFzaCIgbGlzdCBvZiB0aGUgZGlmZmVyZW50IENvbGxlY3RpYmxlcyBhdmFpbGFibGUgaW4gdGhlIG1hcmtldCBwbGFjZQogIG1hcHBpbmcgKHVpbnQgPT4gQ29sbGVjdGlibGUpIHB1YmxpYyBkcmF3aW5nSWRUb0NvbGxlY3RpYmxlczsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgcGVuZGluZ1dpdGhkcmF3YWxzOwoKICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBiYWxhbmNlczsKCiAgLy8gcmV0dXJucyB0aGUgYmFsYW5jZSBvZiBhIHBhcnRpY3VsYXIgYWNjb3VudAogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9IAoKICAvLyBFdmVudHMKICBldmVudCBBc3NpZ25lZChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgY29sbGVjdGlibGVJbmRleCwgdWludDI1NiBwcmludEluZGV4KTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBDb2xsZWN0aWJsZVRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgY29sbGVjdGlibGVJbmRleCwgdWludDI1NiBwcmludEluZGV4KTsKICBldmVudCBDb2xsZWN0aWJsZU9mZmVyZWQodWludCBpbmRleGVkIGNvbGxlY3RpYmxlSW5kZXgsIHVpbnQgaW5kZXhlZCBwcmludEluZGV4LCB1aW50IG1pblZhbHVlLCBhZGRyZXNzIGluZGV4ZWQgdG9BZGRyZXNzLCB1aW50IGxhc3RTZWxsVmFsdWUpOwogIGV2ZW50IENvbGxlY3RpYmxlQmlkRW50ZXJlZCh1aW50IGluZGV4ZWQgY29sbGVjdGlibGVJbmRleCwgdWludCBpbmRleGVkIHByaW50SW5kZXgsIHVpbnQgdmFsdWUsIGFkZHJlc3MgaW5kZXhlZCBmcm9tQWRkcmVzcyk7CiAgZXZlbnQgQ29sbGVjdGlibGVCaWRXaXRoZHJhd24odWludCBpbmRleGVkIGNvbGxlY3RpYmxlSW5kZXgsIHVpbnQgaW5kZXhlZCBwcmludEluZGV4LCB1aW50IHZhbHVlLCBhZGRyZXNzIGluZGV4ZWQgZnJvbUFkZHJlc3MpOwogIGV2ZW50IENvbGxlY3RpYmxlQm91Z2h0KHVpbnQgaW5kZXhlZCBjb2xsZWN0aWJsZUluZGV4LCB1aW50IHByaW50SW5kZXgsIHVpbnQgdmFsdWUsIGFkZHJlc3MgaW5kZXhlZCBmcm9tQWRkcmVzcywgYWRkcmVzcyBpbmRleGVkIHRvQWRkcmVzcyk7CiAgZXZlbnQgQ29sbGVjdGlibGVOb0xvbmdlckZvclNhbGUodWludCBpbmRleGVkIGNvbGxlY3RpYmxlSW5kZXgsIHVpbnQgaW5kZXhlZCBwcmludEluZGV4KTsKCiAgLy8gVGhlIGNvbnN0cnVjdG9yIGlzIGV4ZWN1dGVkIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgY3JlYXRlZCBpbiB0aGUgYmxvY2tjaGFpbi4KICBmdW5jdGlvbiBEYWRhQ29sbGVjdGlibGUgKCkgeyAKICAgIC8vIGFzc2lnbnMgdGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgY3JlYXRpbmcgdGhlIGNvbnRyYWN0IGFzIHRoZSAKICAgIC8vICJvd25lciIgb2YgdGhlIGNvbnRyYWN0LiBTaW5jZSB0aGUgY29udHJhY3QgZG9lc24ndCBoYXZlIAogICAgLy8gYSAic2V0IiBmdW5jdGlvbiBmb3IgdGhlIG93bmVyIGF0dHJpYnV0ZSB0aGlzIHZhbHVlIHdpbGwgYmUgaW1tdXRhYmxlLiAKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICAvLyBVcGRhdGUgdG90YWwgc3VwcGx5CiAgICB0b3RhbFN1cHBseSA9IDE2NjAwOwogICAgLy8gR2l2ZSB0byBEQURBIGFsbCBpbml0aWFsIGRyYXdpbmdzCiAgICBiYWxhbmNlc1tvd25lcl0gPSB0b3RhbFN1cHBseTsKCiAgICAvLyBTZXQgdGhlIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgIG5hbWUgPSAiREFEQSBDb2xsZWN0aWJsZSI7CiAgICAvLyBTZXQgdGhlIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgc3ltYm9sID0gIsaJIjsKICAgIC8vIEFtb3VudCBvZiBkZWNpbWFscyBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgZGVjaW1hbHMgPSAwOwogIH0KCiAgLy8gbWFpbiBidXNpbmVzcyBsb2dpYyBmdW5jdGlvbnMKICAKICAvLyBidXllcidzIGZ1bmN0aW9ucwogIGZ1bmN0aW9uIGJ1eUNvbGxlY3RpYmxlKHVpbnQgZHJhd2luZ0lkLCB1aW50IHByaW50SW5kZXgpIHBheWFibGUgewogICAgcmVxdWlyZShpc0V4ZWN1dGlvbkFsbG93ZWQpOwogICAgLy8gcmVxdWlyZXMgdGhlIGRyYXdpbmcgaWQgdG8gYWN0dWFsbHkgZXhpc3QKICAgIHJlcXVpcmUoZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXS5kcmF3aW5nSWQgIT0gMCk7CiAgICBDb2xsZWN0aWJsZSBzdG9yYWdlIGNvbGxlY3RpYmxlID0gZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXTsKICAgIHJlcXVpcmUoKHByaW50SW5kZXggPCAoY29sbGVjdGlibGUudG90YWxTdXBwbHkrY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKSAmJiAgKHByaW50SW5kZXggPj0gY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKTsKICAgIE9mZmVyIHN0b3JhZ2Ugb2ZmZXIgPSBPZmZlcmVkRm9yU2FsZVtwcmludEluZGV4XTsKICAgIHJlcXVpcmUob2ZmZXIuZHJhd2luZ0lkICE9IDApOwogICAgcmVxdWlyZShvZmZlci5pc0ZvclNhbGUpOyAvLyBkcmF3aW5nIGFjdHVhbGx5IGZvciBzYWxlCiAgICByZXF1aXJlKG9mZmVyLm9ubHlTZWxsVG8gPT0gMHgwIHx8IG9mZmVyLm9ubHlTZWxsVG8gPT0gbXNnLnNlbmRlcik7ICAvLyBkcmF3aW5nIGNhbiBiZSBzb2xkIHRvIHRoaXMgdXNlcgogICAgcmVxdWlyZShtc2cudmFsdWUgPj0gb2ZmZXIubWluVmFsdWUpOyAvLyBEaWRuJ3Qgc2VuZCBlbm91Z2ggRVRICiAgICByZXF1aXJlKG9mZmVyLnNlbGxlciA9PSBEcmF3aW5nUHJpbnRUb0FkZHJlc3NbcHJpbnRJbmRleF0pOyAvLyBTZWxsZXIgc3RpbGwgb3duZXIgb2YgdGhlIGRyYXdpbmcKICAgIHJlcXVpcmUoRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdICE9IG1zZy5zZW5kZXIpOwoKICAgIGFkZHJlc3Mgc2VsbGVyID0gb2ZmZXIuc2VsbGVyOwogICAgYWRkcmVzcyBidXllciA9IG1zZy5zZW5kZXI7CgogICAgRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdID0gYnV5ZXI7IC8vICJnaXZlcyIgdGhlIHByaW50IHRvIHRoZSBidXllcgoKICAgIC8vIGRlY3JlYXNlIGJ5IG9uZSB0aGUgYW1vdW50IG9mIHByaW50cyB0aGUgc2VsbGVyIGhhcyBvZiB0aGlzIHBhcnRpY3VsbGFyIGRyYXdpbmcKICAgIGJhbGFuY2VzW3NlbGxlcl0tLTsKICAgIC8vIGluY3JlYXNlIGJ5IG9uZSB0aGUgYW1vdW50IG9mIHByaW50cyB0aGUgYnV5ZXIgaGFzIG9mIHRoaXMgcGFydGljdWxsYXIgZHJhd2luZwogICAgYmFsYW5jZXNbYnV5ZXJdKys7CgogICAgLy8gbGF1bmNoIHRoZSBUcmFuc2ZlcmVkIGV2ZW50CiAgICBUcmFuc2ZlcihzZWxsZXIsIGJ1eWVyLCAxKTsKCiAgICAvLyB0cmFuc2ZlciBFVEggdG8gdGhlIHNlbGxlcgogICAgLy8gcHJvZml0IGRlbHRhIG11c3QgYmUgZXF1YWwgb3IgZ3JlYXRlciB0aGFuIDFlLTE2IHRvIGJlIGFibGUgdG8gZGl2aWRlIGl0CiAgICAvLyBiZXR3ZWVuIHRoZSBpbnZvbHZlZCBlbnRpdGllcyAoYXJ0IGNyZWF0b3IgLT4gMzAlLCBzZWxsZXIgLT4gNjAlIGFuZCBkYWRhIC0+IDEwJSkKICAgIC8vIHByb2ZpdCBwZXJjZW50YWdlcyBjYW4ndCBiZSBsb3dlciB0aGFuIDFlLTE4IHdoaWNoIGlzIHRoZSBsb3dlc3QgdW5pdCBpbiBFVEgKICAgIC8vIGVxdWl2YWxlbnQgdG8gMSB3ZWkuCiAgICAvLyBpZihvZmZlci5sYXN0U2VsbFZhbHVlIDwgbXNnLnZhbHVlICYmIChtc2cudmFsdWUgLSBvZmZlci5sYXN0U2VsbFZhbHVlKSA+PSB1aW50KDAuMDAwMDAwMDAwMDAwMDAwMSkgKXsgY29tbWVudGVkIGJlY2F1c2Ugd2UncmUgYXNzdW1pbmcgdmFsdWVzIGFyZSBleHByZXNzZWQgaW4gICJ3ZWlzIiwgYWRqdXN0aW5nIGluIHJlbGF0aW9uIHRvIHRoYXQKICAgIGlmKG9mZmVyLmxhc3RTZWxsVmFsdWUgPCBtc2cudmFsdWUgJiYgKG1zZy52YWx1ZSAtIG9mZmVyLmxhc3RTZWxsVmFsdWUpID49IDEwMCApeyAvLyBhc3N1bWluZyAxMDAgKHdlaXMpIHdpY2ggaXMgZXF1aXZhbGVudCB0byAxZS0xNgogICAgICB1aW50IHByb2ZpdCA9IG1zZy52YWx1ZSAtIG9mZmVyLmxhc3RTZWxsVmFsdWU7CiAgICAgIC8vIHNlbGxlciBnZXRzIGJhc2UgdmFsdWUgcGx1cyA2MCUgb2YgdGhlIHByb2ZpdAogICAgICBwZW5kaW5nV2l0aGRyYXdhbHNbc2VsbGVyXSArPSBvZmZlci5sYXN0U2VsbFZhbHVlICsgKHByb2ZpdCo2MC8xMDApOyAKICAgICAgLy8gZGFkYSBnZXRzIDEwJSBvZiB0aGUgcHJvZml0CiAgICAgIC8vIHBlbmRpbmdXaXRoZHJhd2Fsc1tvd25lcl0gKz0gKHByb2ZpdCoxMC8xMDApOwogICAgICAvLyBkYWRhIHJlY2VpdmVzIDMwJSBvZiB0aGUgcHJvZml0IHRvIGdpdmUgdG8gdGhlIGFydGlzdAogICAgICAvLyBwZW5kaW5nV2l0aGRyYXdhbHNbb3duZXJdICs9IChwcm9maXQqMzAvMTAwKTsKICAgICAgLy8gZ29pbmcgbWFudWFsIGZvciBhcnRpc3QgYW5kIGRhZGEgcGVyY2VudGFnZXMgKDMwICsgMTApCiAgICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1tvd25lcl0gKz0gKHByb2ZpdCo0MC8xMDApOwogICAgfWVsc2V7CiAgICAgIC8vIGlmIHRoZSBzZWxsZXIgZG9lc24ndCBtYWtlIGEgcHJvZml0IG9mIHRoZSBzZWxsIGhlIGdldHMgdGhlIDEwMCUgb2YgdGhlIHRyYWRlZAogICAgICAvLyB2YWx1ZS4KICAgICAgcGVuZGluZ1dpdGhkcmF3YWxzW3NlbGxlcl0gKz0gbXNnLnZhbHVlOwogICAgfQogICAgbWFrZUNvbGxlY3RpYmxlVW5hdmFpbGFibGVUb1NhbGUoYnV5ZXIsIGRyYXdpbmdJZCwgcHJpbnRJbmRleCwgbXNnLnZhbHVlKTsKCiAgICAvLyBsYXVuY2ggdGhlIENvbGxlY3RpYmxlQm91Z2h0IGV2ZW50ICAgIAogICAgQ29sbGVjdGlibGVCb3VnaHQoZHJhd2luZ0lkLCBwcmludEluZGV4LCBtc2cudmFsdWUsIHNlbGxlciwgYnV5ZXIpOwoKICAgIC8vIENoZWNrIGZvciB0aGUgY2FzZSB3aGVyZSB0aGVyZSBpcyBhIGJpZCBmcm9tIHRoZSBuZXcgb3duZXIgYW5kIHJlZnVuZCBpdC4KICAgIC8vIEFueSBvdGhlciBiaWQgY2FuIHN0YXkgaW4gcGxhY2UuCiAgICBCaWQgc3RvcmFnZSBiaWQgPSBCaWRzW3ByaW50SW5kZXhdOwogICAgaWYgKGJpZC5iaWRkZXIgPT0gYnV5ZXIpIHsKICAgICAgLy8gS2lsbCBiaWQgYW5kIHJlZnVuZCB2YWx1ZQogICAgICBwZW5kaW5nV2l0aGRyYXdhbHNbYnV5ZXJdICs9IGJpZC52YWx1ZTsKICAgICAgQmlkc1twcmludEluZGV4XSA9IEJpZChmYWxzZSwgY29sbGVjdGlibGUuZHJhd2luZ0lkLCBwcmludEluZGV4LCAweDAsIDApOwogICAgfQogIH0KCiAgZnVuY3Rpb24gYWx0X2J1eUNvbGxlY3RpYmxlKHVpbnQgZHJhd2luZ0lkLCB1aW50IHByaW50SW5kZXgpIHBheWFibGUgewogICAgcmVxdWlyZShpc0V4ZWN1dGlvbkFsbG93ZWQpOwogICAgLy8gcmVxdWlyZXMgdGhlIGRyYXdpbmcgaWQgdG8gYWN0dWFsbHkgZXhpc3QKICAgIHJlcXVpcmUoZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXS5kcmF3aW5nSWQgIT0gMCk7CiAgICBDb2xsZWN0aWJsZSBzdG9yYWdlIGNvbGxlY3RpYmxlID0gZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXTsKICAgIHJlcXVpcmUoKHByaW50SW5kZXggPCAoY29sbGVjdGlibGUudG90YWxTdXBwbHkrY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKSAmJiAgKHByaW50SW5kZXggPj0gY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKTsKICAgIE9mZmVyIHN0b3JhZ2Ugb2ZmZXIgPSBPZmZlcmVkRm9yU2FsZVtwcmludEluZGV4XTsKICAgIHJlcXVpcmUob2ZmZXIuZHJhd2luZ0lkID09IDApOwogICAgCiAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBjb2xsZWN0aWJsZS5pbml0aWFsUHJpY2UpOyAvLyBEaWRuJ3Qgc2VuZCBlbm91Z2ggRVRICiAgICByZXF1aXJlKERyYXdpbmdQcmludFRvQWRkcmVzc1twcmludEluZGV4XSA9PSAweDApOyAvLyBzaG91bGQgYmUgZXF1YWwgdG8gYSAibnVsbCIgYWRkcmVzcyAoMHgwKSBzaW5jZSBpdCBzaG91bGRuJ3QgaGF2ZSBhbiBvd25lciB5ZXQKCiAgICBhZGRyZXNzIHNlbGxlciA9IG93bmVyOwogICAgYWRkcmVzcyBidXllciA9IG1zZy5zZW5kZXI7CgogICAgRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdID0gYnV5ZXI7IC8vICJnaXZlcyIgdGhlIHByaW50IHRvIHRoZSBidXllcgoKICAgIC8vIGRlY3JlYXNlIGJ5IG9uZSB0aGUgYW1vdW50IG9mIHByaW50cyB0aGUgc2VsbGVyIGhhcyBvZiB0aGlzIHBhcnRpY3VsbGFyIGRyYXdpbmcKICAgIC8vIGNvbW1lbnRlZCB3aGlsZSB3ZSBkZWNpZGUgd2hhdCB0byBkbyB3aXRoIGJhbGFuY2VzIGZvciBEQURBCiAgICBiYWxhbmNlc1tzZWxsZXJdLS07CiAgICAvLyBpbmNyZWFzZSBieSBvbmUgdGhlIGFtb3VudCBvZiBwcmludHMgdGhlIGJ1eWVyIGhhcyBvZiB0aGlzIHBhcnRpY3VsbGFyIGRyYXdpbmcKICAgIGJhbGFuY2VzW2J1eWVyXSsrOwoKICAgIC8vIGxhdW5jaCB0aGUgVHJhbnNmZXJlZCBldmVudAogICAgVHJhbnNmZXIoc2VsbGVyLCBidXllciwgMSk7CgogICAgLy8gdHJhbnNmZXIgRVRIIHRvIHRoZSBzZWxsZXIKICAgIC8vIHByb2ZpdCBkZWx0YSBtdXN0IGJlIGVxdWFsIG9yIGdyZWF0ZXIgdGhhbiAxZS0xNiB0byBiZSBhYmxlIHRvIGRpdmlkZSBpdAogICAgLy8gYmV0d2VlbiB0aGUgaW52b2x2ZWQgZW50aXRpZXMgKGFydCBjcmVhdG9yIC0+IDMwJSwgc2VsbGVyIC0+IDYwJSBhbmQgZGFkYSAtPiAxMCUpCiAgICAvLyBwcm9maXQgcGVyY2VudGFnZXMgY2FuJ3QgYmUgbG93ZXIgdGhhbiAxZS0xOCB3aGljaCBpcyB0aGUgbG93ZXN0IHVuaXQgaW4gRVRICiAgICAvLyBlcXVpdmFsZW50IHRvIDEgd2VpLgoKICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1tvd25lcl0gKz0gbXNnLnZhbHVlOwogICAgCiAgICBPZmZlcmVkRm9yU2FsZVtwcmludEluZGV4XSA9IE9mZmVyKGZhbHNlLCBjb2xsZWN0aWJsZS5kcmF3aW5nSWQsIHByaW50SW5kZXgsIGJ1eWVyLCBtc2cudmFsdWUsIDB4MCwgbXNnLnZhbHVlKTsKCiAgICAvLyBsYXVuY2ggdGhlIENvbGxlY3RpYmxlQm91Z2h0IGV2ZW50ICAgIAogICAgQ29sbGVjdGlibGVCb3VnaHQoZHJhd2luZ0lkLCBwcmludEluZGV4LCBtc2cudmFsdWUsIHNlbGxlciwgYnV5ZXIpOwoKICAgIC8vIENoZWNrIGZvciB0aGUgY2FzZSB3aGVyZSB0aGVyZSBpcyBhIGJpZCBmcm9tIHRoZSBuZXcgb3duZXIgYW5kIHJlZnVuZCBpdC4KICAgIC8vIEFueSBvdGhlciBiaWQgY2FuIHN0YXkgaW4gcGxhY2UuCiAgICBCaWQgc3RvcmFnZSBiaWQgPSBCaWRzW3ByaW50SW5kZXhdOwogICAgaWYgKGJpZC5iaWRkZXIgPT0gYnV5ZXIpIHsKICAgICAgLy8gS2lsbCBiaWQgYW5kIHJlZnVuZCB2YWx1ZQogICAgICBwZW5kaW5nV2l0aGRyYXdhbHNbYnV5ZXJdICs9IGJpZC52YWx1ZTsKICAgICAgQmlkc1twcmludEluZGV4XSA9IEJpZChmYWxzZSwgY29sbGVjdGlibGUuZHJhd2luZ0lkLCBwcmludEluZGV4LCAweDAsIDApOwogICAgfQogIH0KICAKICBmdW5jdGlvbiBlbnRlckJpZEZvckNvbGxlY3RpYmxlKHVpbnQgZHJhd2luZ0lkLCB1aW50IHByaW50SW5kZXgpIHBheWFibGUgewogICAgcmVxdWlyZShpc0V4ZWN1dGlvbkFsbG93ZWQpOwogICAgcmVxdWlyZShkcmF3aW5nSWRUb0NvbGxlY3RpYmxlc1tkcmF3aW5nSWRdLmRyYXdpbmdJZCAhPSAwKTsKICAgIENvbGxlY3RpYmxlIHN0b3JhZ2UgY29sbGVjdGlibGUgPSBkcmF3aW5nSWRUb0NvbGxlY3RpYmxlc1tkcmF3aW5nSWRdOwogICAgcmVxdWlyZShEcmF3aW5nUHJpbnRUb0FkZHJlc3NbcHJpbnRJbmRleF0gIT0gMHgwKTsgLy8gUHJpbnQgaXMgb3duZWQgYnkgc29tZWJvZHkKICAgIHJlcXVpcmUoRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdICE9IG1zZy5zZW5kZXIpOyAvLyBQcmludCBpcyBub3Qgb3duZWQgYnkgYmlkZGVyCiAgICByZXF1aXJlKChwcmludEluZGV4IDwgKGNvbGxlY3RpYmxlLnRvdGFsU3VwcGx5K2NvbGxlY3RpYmxlLmluaXRpYWxQcmludEluZGV4KSkgJiYgKHByaW50SW5kZXggPj0gY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKTsKCiAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOyAvLyBCaWQgbXVzdCBiZSBncmVhdGVyIHRoYW4gMAogICAgLy8gZ2V0IHRoZSBjdXJyZW50IGJpZCBmb3IgdGhhdCBwcmludCBpZiBhbnkKICAgIEJpZCBzdG9yYWdlIGV4aXN0aW5nID0gQmlkc1twcmludEluZGV4XTsKICAgIC8vIE11c3Qgb3V0YmlkIHByZXZpb3VzIGJpZCBieSBhdCBsZWFzdCA1JS4gQXBwYXJlbnRseSBpcyBub3QgcG9zc2libGUgdG8gCiAgICAvLyBtdWx0aXBseSBieSAxLjA1LCB0aGF0J3Mgd2h5IHdlIGRvIGl0IG1hbnVhbGx5LgogICAgcmVxdWlyZShtc2cudmFsdWUgPj0gZXhpc3RpbmcudmFsdWUrKGV4aXN0aW5nLnZhbHVlKjUvMTAwKSk7CiAgICBpZiAoZXhpc3RpbmcudmFsdWUgPiAwKSB7CiAgICAgICAgLy8gUmVmdW5kIHRoZSBmYWlsaW5nIGJpZCBmcm9tIHRoZSBwcmV2aW91cyBiaWRkZXIKICAgICAgICBwZW5kaW5nV2l0aGRyYXdhbHNbZXhpc3RpbmcuYmlkZGVyXSArPSBleGlzdGluZy52YWx1ZTsKICAgIH0KICAgIC8vIGFkZCB0aGUgbmV3IGJpZAogICAgQmlkc1twcmludEluZGV4XSA9IEJpZCh0cnVlLCBjb2xsZWN0aWJsZS5kcmF3aW5nSWQsIHByaW50SW5kZXgsIG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICBDb2xsZWN0aWJsZUJpZEVudGVyZWQoY29sbGVjdGlibGUuZHJhd2luZ0lkLCBwcmludEluZGV4LCBtc2cudmFsdWUsIG1zZy5zZW5kZXIpOwogIH0KCiAgLy8gdXNlZCBieSBhIHVzZXIgd2hvIHdhbnRzIHRvIGNhbmNlbGwgYSBiaWQgcGxhY2VkIGJ5IGhlci9oaW0KICBmdW5jdGlvbiB3aXRoZHJhd0JpZEZvckNvbGxlY3RpYmxlKHVpbnQgZHJhd2luZ0lkLCB1aW50IHByaW50SW5kZXgpIHsKICAgIHJlcXVpcmUoaXNFeGVjdXRpb25BbGxvd2VkKTsKICAgIHJlcXVpcmUoZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXS5kcmF3aW5nSWQgIT0gMCk7CiAgICBDb2xsZWN0aWJsZSBzdG9yYWdlIGNvbGxlY3RpYmxlID0gZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXTsKICAgIHJlcXVpcmUoKHByaW50SW5kZXggPCAoY29sbGVjdGlibGUudG90YWxTdXBwbHkrY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKSAmJiAocHJpbnRJbmRleCA+PSBjb2xsZWN0aWJsZS5pbml0aWFsUHJpbnRJbmRleCkpOwogICAgcmVxdWlyZShEcmF3aW5nUHJpbnRUb0FkZHJlc3NbcHJpbnRJbmRleF0gIT0gMHgwKTsgLy8gUHJpbnQgaXMgb3duZWQgYnkgc29tZWJvZHkKICAgIHJlcXVpcmUoRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdICE9IG1zZy5zZW5kZXIpOyAvLyBQcmludCBpcyBub3Qgb3duZWQgYnkgYmlkZGVyCiAgICBCaWQgc3RvcmFnZSBiaWQgPSBCaWRzW3ByaW50SW5kZXhdOwogICAgcmVxdWlyZShiaWQuYmlkZGVyID09IG1zZy5zZW5kZXIpOwogICAgQ29sbGVjdGlibGVCaWRXaXRoZHJhd24oZHJhd2luZ0lkLCBwcmludEluZGV4LCBiaWQudmFsdWUsIG1zZy5zZW5kZXIpOwoKICAgIHVpbnQgYW1vdW50ID0gYmlkLnZhbHVlOwogICAgQmlkc1twcmludEluZGV4XSA9IEJpZChmYWxzZSwgY29sbGVjdGlibGUuZHJhd2luZ0lkLCBwcmludEluZGV4LCAweDAsIDApOwogICAgLy8gUmVmdW5kIHRoZSBiaWQgbW9uZXkKICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYW1vdW50KTsKICB9CgogIC8vIHNlbGxlcidzIGZ1bmN0aW9ucwogIGZ1bmN0aW9uIG9mZmVyQ29sbGVjdGlibGVGb3JTYWxlKHVpbnQgZHJhd2luZ0lkLCB1aW50IHByaW50SW5kZXgsIHVpbnQgbWluU2FsZVByaWNlSW5XZWkpIHsKICAgIHJlcXVpcmUoaXNFeGVjdXRpb25BbGxvd2VkKTsKICAgIHJlcXVpcmUoZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXS5kcmF3aW5nSWQgIT0gMCk7CiAgICBDb2xsZWN0aWJsZSBzdG9yYWdlIGNvbGxlY3RpYmxlID0gZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXTsKICAgIHJlcXVpcmUoRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdID09IG1zZy5zZW5kZXIpOwogICAgcmVxdWlyZSgocHJpbnRJbmRleCA8IChjb2xsZWN0aWJsZS50b3RhbFN1cHBseStjb2xsZWN0aWJsZS5pbml0aWFsUHJpbnRJbmRleCkpICYmIChwcmludEluZGV4ID49IGNvbGxlY3RpYmxlLmluaXRpYWxQcmludEluZGV4KSk7CiAgICB1aW50IGxhc3RTZWxsVmFsdWUgPSBPZmZlcmVkRm9yU2FsZVtwcmludEluZGV4XS5sYXN0U2VsbFZhbHVlOwogICAgT2ZmZXJlZEZvclNhbGVbcHJpbnRJbmRleF0gPSBPZmZlcih0cnVlLCBjb2xsZWN0aWJsZS5kcmF3aW5nSWQsIHByaW50SW5kZXgsIG1zZy5zZW5kZXIsIG1pblNhbGVQcmljZUluV2VpLCAweDAsIGxhc3RTZWxsVmFsdWUpOwogICAgQ29sbGVjdGlibGVPZmZlcmVkKGRyYXdpbmdJZCwgcHJpbnRJbmRleCwgbWluU2FsZVByaWNlSW5XZWksIDB4MCwgbGFzdFNlbGxWYWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd09mZmVyRm9yQ29sbGVjdGlibGUodWludCBkcmF3aW5nSWQsIHVpbnQgcHJpbnRJbmRleCl7CiAgICByZXF1aXJlKGlzRXhlY3V0aW9uQWxsb3dlZCk7CiAgICByZXF1aXJlKGRyYXdpbmdJZFRvQ29sbGVjdGlibGVzW2RyYXdpbmdJZF0uZHJhd2luZ0lkICE9IDApOwogICAgQ29sbGVjdGlibGUgc3RvcmFnZSBjb2xsZWN0aWJsZSA9IGRyYXdpbmdJZFRvQ29sbGVjdGlibGVzW2RyYXdpbmdJZF07CiAgICByZXF1aXJlKERyYXdpbmdQcmludFRvQWRkcmVzc1twcmludEluZGV4XSA9PSBtc2cuc2VuZGVyKTsKICAgIHJlcXVpcmUoKHByaW50SW5kZXggPCAoY29sbGVjdGlibGUudG90YWxTdXBwbHkrY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKSAmJiAocHJpbnRJbmRleCA+PSBjb2xsZWN0aWJsZS5pbml0aWFsUHJpbnRJbmRleCkpOwoKICAgIHVpbnQgbGFzdFNlbGxWYWx1ZSA9IE9mZmVyZWRGb3JTYWxlW3ByaW50SW5kZXhdLmxhc3RTZWxsVmFsdWU7CgogICAgT2ZmZXJlZEZvclNhbGVbcHJpbnRJbmRleF0gPSBPZmZlcihmYWxzZSwgY29sbGVjdGlibGUuZHJhd2luZ0lkLCBwcmludEluZGV4LCBtc2cuc2VuZGVyLCAwLCAweDAsIGxhc3RTZWxsVmFsdWUpOwogICAgLy8gbGF1bmNoIHRoZSBDb2xsZWN0aWJsZU5vTG9uZ2VyRm9yU2FsZSBldmVudCAKICAgIENvbGxlY3RpYmxlTm9Mb25nZXJGb3JTYWxlKGNvbGxlY3RpYmxlLmRyYXdpbmdJZCwgcHJpbnRJbmRleCk7CgogIH0KCiAgZnVuY3Rpb24gb2ZmZXJDb2xsZWN0aWJsZUZvclNhbGVUb0FkZHJlc3ModWludCBkcmF3aW5nSWQsIHVpbnQgcHJpbnRJbmRleCwgdWludCBtaW5TYWxlUHJpY2VJbldlaSwgYWRkcmVzcyB0b0FkZHJlc3MpIHsKICAgIHJlcXVpcmUoaXNFeGVjdXRpb25BbGxvd2VkKTsKICAgIHJlcXVpcmUoZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXS5kcmF3aW5nSWQgIT0gMCk7CiAgICBDb2xsZWN0aWJsZSBzdG9yYWdlIGNvbGxlY3RpYmxlID0gZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXTsKICAgIHJlcXVpcmUoRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdID09IG1zZy5zZW5kZXIpOwogICAgcmVxdWlyZSgocHJpbnRJbmRleCA8IChjb2xsZWN0aWJsZS50b3RhbFN1cHBseStjb2xsZWN0aWJsZS5pbml0aWFsUHJpbnRJbmRleCkpICYmIChwcmludEluZGV4ID49IGNvbGxlY3RpYmxlLmluaXRpYWxQcmludEluZGV4KSk7CiAgICB1aW50IGxhc3RTZWxsVmFsdWUgPSBPZmZlcmVkRm9yU2FsZVtwcmludEluZGV4XS5sYXN0U2VsbFZhbHVlOwogICAgT2ZmZXJlZEZvclNhbGVbcHJpbnRJbmRleF0gPSBPZmZlcih0cnVlLCBjb2xsZWN0aWJsZS5kcmF3aW5nSWQsIHByaW50SW5kZXgsIG1zZy5zZW5kZXIsIG1pblNhbGVQcmljZUluV2VpLCB0b0FkZHJlc3MsIGxhc3RTZWxsVmFsdWUpOwogICAgQ29sbGVjdGlibGVPZmZlcmVkKGRyYXdpbmdJZCwgcHJpbnRJbmRleCwgbWluU2FsZVByaWNlSW5XZWksIHRvQWRkcmVzcywgbGFzdFNlbGxWYWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBhY2NlcHRCaWRGb3JDb2xsZWN0aWJsZSh1aW50IGRyYXdpbmdJZCwgdWludCBtaW5QcmljZSwgdWludCBwcmludEluZGV4KSB7CiAgICByZXF1aXJlKGlzRXhlY3V0aW9uQWxsb3dlZCk7CiAgICByZXF1aXJlKGRyYXdpbmdJZFRvQ29sbGVjdGlibGVzW2RyYXdpbmdJZF0uZHJhd2luZ0lkICE9IDApOwogICAgQ29sbGVjdGlibGUgc3RvcmFnZSBjb2xsZWN0aWJsZSA9IGRyYXdpbmdJZFRvQ29sbGVjdGlibGVzW2RyYXdpbmdJZF07CiAgICByZXF1aXJlKChwcmludEluZGV4IDwgKGNvbGxlY3RpYmxlLnRvdGFsU3VwcGx5K2NvbGxlY3RpYmxlLmluaXRpYWxQcmludEluZGV4KSkgJiYgKHByaW50SW5kZXggPj0gY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKTsKICAgIHJlcXVpcmUoRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdID09IG1zZy5zZW5kZXIpOwogICAgYWRkcmVzcyBzZWxsZXIgPSBtc2cuc2VuZGVyOwoKICAgIEJpZCBzdG9yYWdlIGJpZCA9IEJpZHNbcHJpbnRJbmRleF07CiAgICByZXF1aXJlKGJpZC52YWx1ZSA+IDApOyAvLyBXaWxsIGJlIHplcm8gaWYgdGhlcmUgaXMgbm8gYWN0dWFsIGJpZAogICAgcmVxdWlyZShiaWQudmFsdWUgPj0gbWluUHJpY2UpOyAvLyBQcmV2ZW50IGEgY29uZGl0aW9uIHdoZXJlIGEgYmlkIGlzIHdpdGhkcmF3biBhbmQgcmVwbGFjZWQgd2l0aCBhIGxvd2VyIGJpZCBidXQgc2VsbGVyIGRvZXNuJ3Qga25vdwoKICAgIERyYXdpbmdQcmludFRvQWRkcmVzc1twcmludEluZGV4XSA9IGJpZC5iaWRkZXI7CiAgICBiYWxhbmNlc1tzZWxsZXJdLS07CiAgICBiYWxhbmNlc1tiaWQuYmlkZGVyXSsrOwogICAgVHJhbnNmZXIoc2VsbGVyLCBiaWQuYmlkZGVyLCAxKTsKICAgIHVpbnQgYW1vdW50ID0gYmlkLnZhbHVlOwoKICAgIE9mZmVyIHN0b3JhZ2Ugb2ZmZXIgPSBPZmZlcmVkRm9yU2FsZVtwcmludEluZGV4XTsKICAgIC8vIHRyYW5zZmVyIEVUSCB0byB0aGUgc2VsbGVyCiAgICAvLyBwcm9maXQgZGVsdGEgbXVzdCBiZSBlcXVhbCBvciBncmVhdGVyIHRoYW4gMWUtMTYgdG8gYmUgYWJsZSB0byBkaXZpZGUgaXQKICAgIC8vIGJldHdlZW4gdGhlIGludm9sdmVkIGVudGl0aWVzIChhcnQgY3JlYXRvciAtPiAzMCUsIHNlbGxlciAtPiA2MCUgYW5kIGRhZGEgLT4gMTAlKQogICAgLy8gcHJvZml0IHBlcmNlbnRhZ2VzIGNhbid0IGJlIGxvd2VyIHRoYW4gMWUtMTggd2hpY2ggaXMgdGhlIGxvd2VzdCB1bml0IGluIEVUSAogICAgLy8gZXF1aXZhbGVudCB0byAxIHdlaS4KICAgIC8vIGlmKG9mZmVyLmxhc3RTZWxsVmFsdWUgPiBtc2cudmFsdWUgJiYgKG1zZy52YWx1ZSAtIG9mZmVyLmxhc3RTZWxsVmFsdWUpID49IHVpbnQoMC4wMDAwMDAwMDAwMDAwMDAxKSApeyBjb21tZW50ZWQgYmVjYXVzZSB3ZSdyZSBhc3N1bWluZyB2YWx1ZXMgYXJlIGV4cHJlc3NlZCBpbiAgIndlaXMiLCBhZGp1c3RpbmcgaW4gcmVsYXRpb24gdG8gdGhhdAogICAgaWYob2ZmZXIubGFzdFNlbGxWYWx1ZSA8IGFtb3VudCAmJiAoYW1vdW50IC0gb2ZmZXIubGFzdFNlbGxWYWx1ZSkgPj0gMTAwICl7IC8vIGFzc3VtaW5nIDEwMCAod2Vpcykgd2ljaCBpcyBlcXVpdmFsZW50IHRvIDFlLTE2CiAgICAgIHVpbnQgcHJvZml0ID0gYW1vdW50IC0gb2ZmZXIubGFzdFNlbGxWYWx1ZTsKICAgICAgLy8gc2VsbGVyIGdldHMgYmFzZSB2YWx1ZSBwbHVzIDYwJSBvZiB0aGUgcHJvZml0CiAgICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1tzZWxsZXJdICs9IG9mZmVyLmxhc3RTZWxsVmFsdWUgKyAocHJvZml0KjYwLzEwMCk7IAogICAgICAvLyBkYWRhIGdldHMgMTAlIG9mIHRoZSBwcm9maXQKICAgICAgLy8gcGVuZGluZ1dpdGhkcmF3YWxzW293bmVyXSArPSAocHJvZml0KjEwLzEwMCk7CiAgICAgIC8vIGRhZGEgcmVjZWl2ZXMgMzAlIG9mIHRoZSBwcm9maXQgdG8gZ2l2ZSB0byB0aGUgYXJ0aXN0CiAgICAgIC8vIHBlbmRpbmdXaXRoZHJhd2Fsc1tvd25lcl0gKz0gKHByb2ZpdCozMC8xMDApOwogICAgICBwZW5kaW5nV2l0aGRyYXdhbHNbb3duZXJdICs9IChwcm9maXQqNDAvMTAwKTsKCiAgICB9ZWxzZXsKICAgICAgLy8gaWYgdGhlIHNlbGxlciBkb2Vzbid0IG1ha2UgYSBwcm9maXQgb2YgdGhlIHNlbGwgaGUgZ2V0cyB0aGUgMTAwJSBvZiB0aGUgdHJhZGVkCiAgICAgIC8vIHZhbHVlLgogICAgICBwZW5kaW5nV2l0aGRyYXdhbHNbc2VsbGVyXSArPSBhbW91bnQ7CiAgICB9CiAgICAvLyBkb2VzIHRoZSBzYW1lIGFzIHRoZSBmdW5jdGlvbiBtYWtlQ29sbGVjdGlibGVVbmF2YWlsYWJsZVRvU2FsZQogICAgT2ZmZXJlZEZvclNhbGVbcHJpbnRJbmRleF0gPSBPZmZlcihmYWxzZSwgY29sbGVjdGlibGUuZHJhd2luZ0lkLCBwcmludEluZGV4LCBiaWQuYmlkZGVyLCAwLCAweDAsIGFtb3VudCk7CiAgICBDb2xsZWN0aWJsZUJvdWdodChjb2xsZWN0aWJsZS5kcmF3aW5nSWQsIHByaW50SW5kZXgsIGJpZC52YWx1ZSwgc2VsbGVyLCBiaWQuYmlkZGVyKTsKICAgIEJpZHNbcHJpbnRJbmRleF0gPSBCaWQoZmFsc2UsIGNvbGxlY3RpYmxlLmRyYXdpbmdJZCwgcHJpbnRJbmRleCwgMHgwLCAwKTsKCiAgfQoKICAvLyB1c2VkIGJ5IGEgdXNlciB3aG8gd2FudHMgdG8gY2FzaG91dCBoaXMgbW9uZXkKICBmdW5jdGlvbiB3aXRoZHJhdygpIHsKICAgIHJlcXVpcmUoaXNFeGVjdXRpb25BbGxvd2VkKTsKICAgIHVpbnQgYW1vdW50ID0gcGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdOwogICAgLy8gUmVtZW1iZXIgdG8gemVybyB0aGUgcGVuZGluZyByZWZ1bmQgYmVmb3JlCiAgICAvLyBzZW5kaW5nIHRvIHByZXZlbnQgcmUtZW50cmFuY3kgYXR0YWNrcwogICAgcGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gMDsKICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoYW1vdW50KTsKICB9CgogIC8vIFRyYW5zZmVyIG93bmVyc2hpcCBvZiBhIHB1bmsgdG8gYW5vdGhlciB1c2VyIHdpdGhvdXQgcmVxdWlyaW5nIHBheW1lbnQKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IGRyYXdpbmdJZCwgdWludCBwcmludEluZGV4KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpewogICAgcmVxdWlyZShpc0V4ZWN1dGlvbkFsbG93ZWQpOwogICAgcmVxdWlyZShkcmF3aW5nSWRUb0NvbGxlY3RpYmxlc1tkcmF3aW5nSWRdLmRyYXdpbmdJZCAhPSAwKTsKICAgIENvbGxlY3RpYmxlIHN0b3JhZ2UgY29sbGVjdGlibGUgPSBkcmF3aW5nSWRUb0NvbGxlY3RpYmxlc1tkcmF3aW5nSWRdOwogICAgLy8gY2hlY2tzIHRoYXQgdGhlIHVzZXIgbWFraW5nIHRoZSB0cmFuc2ZlciBpcyB0aGUgYWN0dWFsIG93bmVyIG9mIHRoZSBwcmludAogICAgcmVxdWlyZShEcmF3aW5nUHJpbnRUb0FkZHJlc3NbcHJpbnRJbmRleF0gPT0gbXNnLnNlbmRlcik7CiAgICByZXF1aXJlKChwcmludEluZGV4IDwgKGNvbGxlY3RpYmxlLnRvdGFsU3VwcGx5K2NvbGxlY3RpYmxlLmluaXRpYWxQcmludEluZGV4KSkgJiYgKHByaW50SW5kZXggPj0gY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKTsKICAgIG1ha2VDb2xsZWN0aWJsZVVuYXZhaWxhYmxlVG9TYWxlKHRvLCBkcmF3aW5nSWQsIHByaW50SW5kZXgsIE9mZmVyZWRGb3JTYWxlW3ByaW50SW5kZXhdLmxhc3RTZWxsVmFsdWUpOwogICAgLy8gc2V0cyB0aGUgbmV3IG93bmVyIG9mIHRoZSBwcmludAogICAgRHJhd2luZ1ByaW50VG9BZGRyZXNzW3ByaW50SW5kZXhdID0gdG87CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXS0tOwogICAgYmFsYW5jZXNbdG9dKys7CiAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgMSk7CiAgICBDb2xsZWN0aWJsZVRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCBkcmF3aW5nSWQsIHByaW50SW5kZXgpOwogICAgLy8gQ2hlY2sgZm9yIHRoZSBjYXNlIHdoZXJlIHRoZXJlIGlzIGEgYmlkIGZyb20gdGhlIG5ldyBvd25lciBhbmQgcmVmdW5kIGl0LgogICAgLy8gQW55IG90aGVyIGJpZCBjYW4gc3RheSBpbiBwbGFjZS4KICAgIEJpZCBzdG9yYWdlIGJpZCA9IEJpZHNbcHJpbnRJbmRleF07CiAgICBpZiAoYmlkLmJpZGRlciA9PSB0bykgewogICAgICAvLyBLaWxsIGJpZCBhbmQgcmVmdW5kIHZhbHVlCiAgICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1t0b10gKz0gYmlkLnZhbHVlOwogICAgICBCaWRzW3ByaW50SW5kZXhdID0gQmlkKGZhbHNlLCBkcmF3aW5nSWQsIHByaW50SW5kZXgsIDB4MCwgMCk7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vIHV0aWxpdHkgZnVuY3Rpb25zCiAgZnVuY3Rpb24gbWFrZUNvbGxlY3RpYmxlVW5hdmFpbGFibGVUb1NhbGUoYWRkcmVzcyB0bywgdWludCBkcmF3aW5nSWQsIHVpbnQgcHJpbnRJbmRleCwgdWludCBsYXN0U2VsbFZhbHVlKSB7CiAgICByZXF1aXJlKGlzRXhlY3V0aW9uQWxsb3dlZCk7CiAgICByZXF1aXJlKGRyYXdpbmdJZFRvQ29sbGVjdGlibGVzW2RyYXdpbmdJZF0uZHJhd2luZ0lkICE9IDApOwogICAgQ29sbGVjdGlibGUgc3RvcmFnZSBjb2xsZWN0aWJsZSA9IGRyYXdpbmdJZFRvQ29sbGVjdGlibGVzW2RyYXdpbmdJZF07CiAgICByZXF1aXJlKERyYXdpbmdQcmludFRvQWRkcmVzc1twcmludEluZGV4XSA9PSBtc2cuc2VuZGVyKTsKICAgIHJlcXVpcmUoKHByaW50SW5kZXggPCAoY29sbGVjdGlibGUudG90YWxTdXBwbHkrY29sbGVjdGlibGUuaW5pdGlhbFByaW50SW5kZXgpKSAmJiAocHJpbnRJbmRleCA+PSBjb2xsZWN0aWJsZS5pbml0aWFsUHJpbnRJbmRleCkpOwogICAgT2ZmZXJlZEZvclNhbGVbcHJpbnRJbmRleF0gPSBPZmZlcihmYWxzZSwgY29sbGVjdGlibGUuZHJhd2luZ0lkLCBwcmludEluZGV4LCB0bywgMCwgMHgwLCBsYXN0U2VsbFZhbHVlKTsKICAgIC8vIGxhdW5jaCB0aGUgQ29sbGVjdGlibGVOb0xvbmdlckZvclNhbGUgZXZlbnQgCiAgICBDb2xsZWN0aWJsZU5vTG9uZ2VyRm9yU2FsZShjb2xsZWN0aWJsZS5kcmF3aW5nSWQsIHByaW50SW5kZXgpOwogIH0KCiAgZnVuY3Rpb24gbmV3Q29sbGVjdGlibGUodWludCBkcmF3aW5nSWQsIHN0cmluZyBjaGVja1N1bSwgdWludDI1NiBfdG90YWxTdXBwbHksIHVpbnQgaW5pdGlhbFByaWNlLCB1aW50IGluaXRpYWxQcmludEluZGV4LCBzdHJpbmcgY29sbGVjdGlvbk5hbWUsIHVpbnQgYXV0aG9yVUlkLCBzdHJpbmcgc2NhcmNpdHkpewogICAgLy8gcmVxdWlyZXMgdGhlIHNlbmRlciB0byBiZSB0aGUgc2FtZSBhZGRyZXNzIHRoYXQgY29tcGlsZWQgdGhlIGNvbnRyYWN0LAogICAgLy8gdGhpcyBpcyBlbnN1cmVkIGJ5IHN0b3JpbmcgdGhlIHNlbmRlciBhZGRyZXNzCiAgICAvLyByZXF1aXJlKG93bmVyID09IG1zZy5zZW5kZXIpOwogICAgcmVxdWlyZShvd25lciA9PSBtc2cuc2VuZGVyKTsKICAgIC8vIHJlcXVpcmVzIHRoZSBkcmF3aW5nIHRvIG5vdCBleGlzdCBhbHJlYWR5IGluIHRoZSBzY29wZSBvZiB0aGUgY29udHJhY3QKICAgIHJlcXVpcmUoZHJhd2luZ0lkVG9Db2xsZWN0aWJsZXNbZHJhd2luZ0lkXS5kcmF3aW5nSWQgPT0gMCk7CiAgICBkcmF3aW5nSWRUb0NvbGxlY3RpYmxlc1tkcmF3aW5nSWRdID0gQ29sbGVjdGlibGUoZHJhd2luZ0lkLCBjaGVja1N1bSwgX3RvdGFsU3VwcGx5LCBpbml0aWFsUHJpbnRJbmRleCwgZmFsc2UsIGluaXRpYWxQcmljZSwgaW5pdGlhbFByaW50SW5kZXgsIGNvbGxlY3Rpb25OYW1lLCBhdXRob3JVSWQsIHNjYXJjaXR5KTsKICB9CgogIGZ1bmN0aW9uIGZsaXBTd2l0Y2hUbyhib29sIHN0YXRlKXsKICAgIC8vIHJlcXVpcmUob3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICByZXF1aXJlKG93bmVyID09IG1zZy5zZW5kZXIpOwogICAgaXNFeGVjdXRpb25BbGxvd2VkID0gc3RhdGU7CiAgfQoKICBmdW5jdGlvbiBtaW50TmV3RHJhd2luZ3ModWludCBhbW91bnQpewogICAgcmVxdWlyZShvd25lciA9PSBtc2cuc2VuZGVyKTsKICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkgKyBhbW91bnQ7CiAgICBiYWxhbmNlc1tvd25lcl0gPSBiYWxhbmNlc1tvd25lcl0gKyBhbW91bnQ7CgogICAgVHJhbnNmZXIoMCwgb3duZXIsIGFtb3VudCk7CiAgfQoKfQ=='.
	

]
