Class {
	#name : #SRT708352cd28ea06e6bbd5c1a9408b4966ac1226e4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT708352cd28ea06e6bbd5c1a9408b4966ac1226e4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQSByZWZlcnJhbCB0cmVlIGlzIGEgZGlmZnVzaW9uIGdyYXBoIG9mIGFsbCBub2RlcyByZXByZXNlbnRpbmcgY2FtcGFpZ24gcGFydGljaXBhbnRzLgogKiBFYWNoIGludml0ZWUgaXMgYXNzaWduZWQgYSByZWZlcnJhbCB0cmVlIGFmdGVyIGFjY2VwdGluZyBhbiBpbnZpdGF0aW9uLiBGb2xsb3dpbmcgaXMKICogYW4gZXhhbXBsZSBkaWZ1c3Npb24gZ3JhcGguCiAqCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKy0tLSsKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKy0tPiB8IDkgfAogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICstLS0rCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICArLS0tKwogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArLS0tKyAgICAgICArLS0+IHwxMCB8CiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArLS0+IHwgNCB8ICAgICAgIHwgICAgKy0tLSsKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgKy0tLSsgICAgKy0tKwogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgKGluYWN0aXZlKSB8ICB8ICAgICstLS0rCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgIHwgICstLT4gfDExIHwKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgKy0tLSsgICAgfCAgfCAgICArLS0tKwogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICstLS0tLS0tPiB8IDUgKy0tLS0rICB8CiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICB8ICAgICstLS0rICAgICAgIHwgICAgKy0tLSsKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArLS0tLSAgICB8ICAgIHwgICAgICAgICAgICAgICAgKy0tPiB8MTIgfAogKiAgICAgICAgICAgICAgICAgICAgICAgICstLT4gIHwgMSArLS0tLSsgICAgfCAgICAgICAgICAgICAgICAgICAgICstLS0rCiAqICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgKy0tLSsgICAgICAgICB8ICAgICstLS0rCiAqICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICArLS0+IHwgNiB8ICstLS0tLS0tLS0tLS0tLS0tLS0+CiAqICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICstLS0rCiAqICAgICAgICAgICAgICAgKy0tLSsgICAgfCAgICAgKy0tLSsKICogICAgICAgICAgICAgICB8IDAgfCArLS0tLS0+ICB8IDIgfAogKiAgICAgICAgICAgICAgICstLS0rICAgIHwgICAgICstLS0rCiAqICAgICAgICAgICAgICAgICAgICAgICAgfCAgIChpbmFjdGl2ZSkKICogICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgKy0tLSsKICogICAgICAgICAgICAgICAgICAgICAgICB8ICAgICArLS0tKyAgICAgICAgICstLT4gfCA3IHwKICogICAgICAgICAgICAgICAgICAgICAgICArLS0+ICB8IDMgKy0tLS0tLS0tLSsgICAgKy0tLSsKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArLS0tKyAgICAgICAgIHwKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgKy0tLSsKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICstLT4gfCA4IHwKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKy0tLSsKICoKICovCmxpYnJhcnkgUmVmZXJyYWwgewoKICAgIC8qKgogICAgICogQGRldiBBIHVzZXIgaW4gYSByZWZlcnJhbCBncmFwaAogICAgICovCiAgICBzdHJ1Y3QgTm9kZSB7CiAgICAgICAgLy8vIFRoaXMgbm9kZSB3YXMgcmVmZXJyZWQgYnkuLi4KICAgICAgICBhZGRyZXNzIHJlZmVycmVyOwogICAgICAgIC8vLyBJbnZpdGVlcyAoYW5kIHRoZWlyIHNoYXJlcykgb2YgdGhpcyBub2RlCiAgICAgICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBpbnZpdGVlczsKICAgICAgICAvLy8gU3RvcmUga2V5cyBzZXBhcmF0ZWx5CiAgICAgICAgYWRkcmVzc1tdIGludml0ZWVJbmRleDsKICAgICAgICAvLy8gUmV3YXJkIGFjY3VtdWxhdGVkCiAgICAgICAgdWludCBzaGFyZXM7CiAgICAgICAgLy8vIFVzZWQgZm9yIG1lbWJlcnNoaXAgY2hlY2sKICAgICAgICBib29sIGV4aXN0czsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQSByZWZlcnJhbCB0cmVlIGlzIGEgY29sbGVjdGlvbiBvZiBOb2Rlcy4KICAgICAqLwogICAgc3RydWN0IFRyZWUgewogICAgICAgIC8vLyBOb2RlcwogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gUmVmZXJyYWwuTm9kZSkgbm9kZXM7CiAgICAgICAgLy8vIHN0b3JlcyBrZXlzIHNlcGFyYXRlbHkKICAgICAgICBhZGRyZXNzW10gdHJlZUluZGV4OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGaW5kIHJlZmVycmVyIG9mIHRoZSBnaXZlbiBpbnZpdGVlLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRSZWZlcnJlciAoCiAgICAgICAgVHJlZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgYWRkcmVzcyBfaW52aXRlZQogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYWRkcmVzcyBfcmVmZXJyZXIpCiAgICB7CiAgICAgICAgX3JlZmVycmVyID0gc2VsZi5ub2Rlc1tfaW52aXRlZV0ucmVmZXJyZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE51bWJlciBvZiBlbnRyaWVzIGluIHJlZmVycmFsIHRyZWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRyZWVTaXplICgKICAgICAgICBUcmVlIHN0b3JhZ2Ugc2VsZgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCBfc2l6ZSkKICAgIHsKICAgICAgICBfc2l6ZSA9IHNlbGYudHJlZUluZGV4Lmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlcyBhIG5ldyBub2RlIHJlcHJlc2VudGluZyBhbiBpbnZpdGVlIGFuZCBhZGRzIHRvIGEgbm9kZSdzIGxpc3Qgb2YgaW52aXRlZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZEludml0ZWUgKAogICAgICAgIFRyZWUgc3RvcmFnZSBzZWxmLAogICAgICAgIGFkZHJlc3MgX3JlZmVycmVyLAogICAgICAgIGFkZHJlc3MgX2ludml0ZWUsCiAgICAgICAgdWludCBfc2hhcmVzCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICBOb2RlIG1lbW9yeSBpbnZpdGVlTm9kZTsKICAgICAgICBpbnZpdGVlTm9kZS5yZWZlcnJlciA9IF9yZWZlcnJlcjsKICAgICAgICBpbnZpdGVlTm9kZS5zaGFyZXMgPSBfc2hhcmVzOwogICAgICAgIGludml0ZWVOb2RlLmV4aXN0cyA9IHRydWU7CiAgICAgICAgc2VsZi5ub2Rlc1tfaW52aXRlZV0gPSBpbnZpdGVlTm9kZTsKICAgICAgICBzZWxmLnRyZWVJbmRleC5wdXNoKF9pbnZpdGVlKTsKCiAgICAgICAgaWYgKHNlbGYubm9kZXNbX3JlZmVycmVyXS5leGlzdHMgPT0gdHJ1ZSkgewogICAgICAgICAgICBzZWxmLm5vZGVzW19yZWZlcnJlcl0uaW52aXRlZXNbX2ludml0ZWVdID0gX3NoYXJlczsKICAgICAgICAgICAgc2VsZi5ub2Rlc1tfcmVmZXJyZXJdLmludml0ZWVJbmRleC5wdXNoKF9pbnZpdGVlKTsKICAgICAgICB9CiAgICB9Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKLyoqCiAqIEJvbnVzIHRpZXJzCiAqICAxIFZ5cmFsIFJlZmVycmFsIC0gNyUgYm9udXMKICogIDIgVnlyYWwgUmVmZXJyYWxzIC0gOCUgYm9udXMKICogIDMgVnlyYWwgUmVmZXJyYWxzIC0gOSUgYm9udXMKICogIDQgVnlyYWwgUmVmZXJyYWxzIC0gMTAlIGJvbnVzCiAqICA1IFZ5cmFsIFJlZmVycmFscyAtIDExJSBib251cwogKiAgNiBWeXJhbCBSZWZlcnJhbHMgLSAxMiUgYm9udXMKICogIDcgVnlyYWwgUmVmZXJyYWxzIC0gMTMlIGJvbnVzCiAqICA4IFZ5cmFsIFJlZmVycmFscyAtIDE0JSBib251cwogKiAgOSBWeXJhbCBSZWZlcnJhbHMgLSAxNSUgYm9udXMKICogMTAgVnlyYWwgUmVmZXJyYWxzIC0gMTYlIGJvbnVzCiAqIDExIFZ5cmFsIFJlZmVycmFscyAtIDE3JSBib251cwogKiAxMiBWeXJhbCBSZWZlcnJhbHMgLSAxOCUgYm9udXMKICogMTMgVnlyYWwgUmVmZXJyYWxzIC0gMTklIGJvbnVzCiAqIDE0IFZ5cmFsIFJlZmVycmFscyAtIDIwJSBib251cwogKiAxNSBWeXJhbCBSZWZlcnJhbHMgLSAyMSUgYm9udXMKICogMTYgVnlyYWwgUmVmZXJyYWxzIC0gMjIlIGJvbnVzCiAqIDE3IFZ5cmFsIFJlZmVycmFscyAtIDIzJSBib251cwogKiAxOCBWeXJhbCBSZWZlcnJhbHMgLSAyNCUgYm9udXMKICogMTkgVnlyYWwgUmVmZXJyYWxzIC0gMjUlIGJvbnVzCiAqIDIwIFZ5cmFsIFJlZmVycmFscyAtIDI2JSBib251cwogKiAyMSBWeXJhbCBSZWZlcnJhbHMgLSAyNyUgYm9udXMKICogMjIgVnlyYWwgUmVmZXJyYWxzIC0gMjglIGJvbnVzCiAqIDIzIFZ5cmFsIFJlZmVycmFscyAtIDI5JSBib251cwogKiAyNCBWeXJhbCBSZWZlcnJhbHMgLSAzMCUgYm9udXMKICogMjUgVnlyYWwgUmVmZXJyYWxzIC0gMzElIGJvbnVzCiAqIDI2IFZ5cmFsIFJlZmVycmFscyAtIDMyJSBib251cwogKiAyNyBWeXJhbCBSZWZlcnJhbHMgLSAzMyUgYm9udXMKICovCmxpYnJhcnkgVGllcmVkUGF5b2ZmIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIC8qKgogICAgICogVGllcmVkIHBheW9mZiBjb21wdXRlcyByZXdhcmQgYmFzZWQgb24gbnVtYmVyIG9mIGludml0ZWVzIGEgcmVmZXJyZXIgaGFzIGJyb3VnaHQgaW4uCiAgICAgKiBSZXR1cm5zIHRoZSByZXdhcmQgb3IgdGhlIG51bWJlciBvZiB0b2tlbnMgcmVmZXJyZXIgc2hvdWxkIGJlIGF3YXJkZWQuCiAgICAgKgogICAgICogRm9yIGRlZ3JlZSA9PSAxOgogICAgICogdGllciUgb2Ygc2hhcmVzIG9mIG5ld2x5IGpvaW5lZCBub2RlCiAgICAgKgogICAgICogRm9yIDIgPD0gZGVncmVlIDwgMjc6CiAgICAgKiAgIGstMQogICAgICogKCAg4oiRICAxJSBvZiBzaGFyZXMobm9kZV9pKSApICArIHRpZXIlIG9mIHNoYXJlcyBvZiBub2RlX2sKICAgICAqICAgaT0xCiAgICAgKgogICAgICogRm9yIGRlZ3JlZSA+IDI3OgogICAgICogdGllciUgb2Ygc2hhcmVzIG9mIG5ld2x5IGpvaW5lZCBub2RlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHBheW9mZigKICAgICAgICBSZWZlcnJhbC5UcmVlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICBhZGRyZXNzIF9yZWZlcnJlcgogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIFJlZmVycmFsLk5vZGUgbm9kZSA9IHNlbGYubm9kZXNbX3JlZmVycmVyXTsKCiAgICAgICAgaWYoIW5vZGUuZXhpc3RzKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgdWludCByZXdhcmQgPSAwOwogICAgICAgIHVpbnQgc2hhcmVzID0gMDsKICAgICAgICB1aW50IGRlZ3JlZSA9IG5vZGUuaW52aXRlZUluZGV4Lmxlbmd0aDsKICAgICAgICB1aW50IHRpZXJQZXJjZW50YWdlID0gZ2V0Qm9udXNQZXJjZW50YWdlKG5vZGUuaW52aXRlZUluZGV4Lmxlbmd0aCk7CgogICAgICAgIC8vIE5vIGJvbnVzIGlmIHRoZXJlIGFyZSBubyBpbnZpdGVlcwogICAgICAgIGlmKGRlZ3JlZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0KHRpZXJQZXJjZW50YWdlID4gMCk7CgogICAgICAgIGlmKGRlZ3JlZSA9PSAxKSB7CiAgICAgICAgICAgIHNoYXJlcyA9IG5vZGUuaW52aXRlZXNbbm9kZS5pbnZpdGVlSW5kZXhbMF1dOwogICAgICAgICAgICByZXdhcmQgPSByZXdhcmQuYWRkKHNoYXJlcy5tdWwodGllclBlcmNlbnRhZ2UpLmRpdigxMDApKTsKICAgICAgICAgICAgcmV0dXJuIHJld2FyZDsKICAgICAgICB9CgoKICAgICAgICAvLyBGb3IgMiA8PSBkZWdyZWUgPD0gMjcKICAgICAgICAvLyAgICBhZGQgMSUgZnJvbSB0aGUgZmlyc3Qgay0xIG5vZGVzCiAgICAgICAgLy8gICAgYWRkIHRpZXIlIGZyb20gdGhlIGxhc3Qgbm9kZQogICAgICAgIGlmKGRlZ3JlZSA+PSAyICYmIGRlZ3JlZSA8PSAyNykgewogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCAoZGVncmVlIC0gMSk7IGkrKykgewogICAgICAgICAgICAgICAgc2hhcmVzID0gbm9kZS5pbnZpdGVlc1tub2RlLmludml0ZWVJbmRleFtpXV07CiAgICAgICAgICAgICAgICByZXdhcmQgPSByZXdhcmQuYWRkKHNoYXJlcy5tdWwoMSkuZGl2KDEwMCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBGb3IgZGVncmVlID4gMjcsIHJlZmVycmVyIGJvbnVzIHJlbWFpbnMgY29uc3RhbnQgYXQgdGllciUKICAgICAgICBzaGFyZXMgPSBub2RlLmludml0ZWVzW25vZGUuaW52aXRlZUluZGV4W2RlZ3JlZSAtIDFdXTsKICAgICAgICByZXdhcmQgPSByZXdhcmQuYWRkKHNoYXJlcy5tdWwodGllclBlcmNlbnRhZ2UpLmRpdigxMDApKTsKCiAgICAgICAgcmV0dXJuIHJld2FyZDsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYm9udXMgcGVyY2VudGFnZSBmb3IgYSBnaXZlbiBudW1iZXIgb2YgcmVmZXJyYWxzCiAgICAgKiBiYXNlZCBvbiBjb21tZW50cyBhYm92ZS4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Qm9udXNQZXJjZW50YWdlKAogICAgICAgIHVpbnQgX3JlZmVycmFscwogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIGlmIChfcmVmZXJyYWxzID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGlmIChfcmVmZXJyYWxzID49IDI3KSB7CiAgICAgICAgICAgIHJldHVybiAzMzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9yZWZlcnJhbHMgKyA2OwogICAgfQp9CgoKY29udHJhY3QgRGF0ZVRpbWVBUEkgewogICAgICAgIC8qCiAgICAgICAgICogIEFic3RyYWN0IGNvbnRyYWN0IGZvciBpbnRlcmZhY2luZyB3aXRoIHRoZSBEYXRlVGltZSBjb250cmFjdC4KICAgICAgICAgKgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGlzTGVhcFllYXIodWludDE2IHllYXIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwogICAgICAgIGZ1bmN0aW9uIGdldFllYXIodWludCB0aW1lc3RhbXApIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNik7CiAgICAgICAgZnVuY3Rpb24gZ2V0TW9udGgodWludCB0aW1lc3RhbXApIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KTsKICAgICAgICBmdW5jdGlvbiBnZXREYXkodWludCB0aW1lc3RhbXApIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KTsKICAgICAgICBmdW5jdGlvbiBnZXRIb3VyKHVpbnQgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50OCk7CiAgICAgICAgZnVuY3Rpb24gZ2V0TWludXRlKHVpbnQgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50OCk7CiAgICAgICAgZnVuY3Rpb24gZ2V0U2Vjb25kKHVpbnQgdGltZXN0YW1wKSBjb25zdGFudCByZXR1cm5zICh1aW50OCk7CiAgICAgICAgZnVuY3Rpb24gZ2V0V2Vla2RheSh1aW50IHRpbWVzdGFtcCkgY29uc3RhbnQgcmV0dXJucyAodWludDgpOwogICAgICAgIGZ1bmN0aW9uIHRvVGltZXN0YW1wKHVpbnQxNiB5ZWFyLCB1aW50OCBtb250aCwgdWludDggZGF5KSBjb25zdGFudCByZXR1cm5zICh1aW50IHRpbWVzdGFtcCk7CiAgICAgICAgZnVuY3Rpb24gdG9UaW1lc3RhbXAodWludDE2IHllYXIsIHVpbnQ4IG1vbnRoLCB1aW50OCBkYXksIHVpbnQ4IGhvdXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdGltZXN0YW1wKTsKICAgICAgICBmdW5jdGlvbiB0b1RpbWVzdGFtcCh1aW50MTYgeWVhciwgdWludDggbW9udGgsIHVpbnQ4IGRheSwgdWludDggaG91ciwgdWludDggbWludXRlKSBjb25zdGFudCByZXR1cm5zICh1aW50IHRpbWVzdGFtcCk7CiAgICAgICAgZnVuY3Rpb24gdG9UaW1lc3RhbXAodWludDE2IHllYXIsIHVpbnQ4IG1vbnRoLCB1aW50OCBkYXksIHVpbnQ4IGhvdXIsIHVpbnQ4IG1pbnV0ZSwgdWludDggc2Vjb25kKSBjb25zdGFudCByZXR1cm5zICh1aW50IHRpbWVzdGFtcCk7Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE2OwoKY29udHJhY3QgRGF0ZVRpbWUgewogICAgICAgIC8qCiAgICAgICAgICogIERhdGUgYW5kIFRpbWUgdXRpbGl0aWVzIGZvciBldGhlcmV1bSBjb250cmFjdHMKICAgICAgICAgKgogICAgICAgICAqLwogICAgICAgIHN0cnVjdCBfRGF0ZVRpbWUgewogICAgICAgICAgICAgICAgdWludDE2IHllYXI7CiAgICAgICAgICAgICAgICB1aW50OCBtb250aDsKICAgICAgICAgICAgICAgIHVpbnQ4IGRheTsKICAgICAgICAgICAgICAgIHVpbnQ4IGhvdXI7CiAgICAgICAgICAgICAgICB1aW50OCBtaW51dGU7CiAgICAgICAgICAgICAgICB1aW50OCBzZWNvbmQ7CiAgICAgICAgICAgICAgICB1aW50OCB3ZWVrZGF5OwogICAgICAgIH0KCiAgICAgICAgdWludCBjb25zdGFudCBEQVlfSU5fU0VDT05EUyA9IDg2NDAwOwogICAgICAgIHVpbnQgY29uc3RhbnQgWUVBUl9JTl9TRUNPTkRTID0gMzE1MzYwMDA7CiAgICAgICAgdWludCBjb25zdGFudCBMRUFQX1lFQVJfSU5fU0VDT05EUyA9IDMxNjIyNDAwOwoKICAgICAgICB1aW50IGNvbnN0YW50IEhPVVJfSU5fU0VDT05EUyA9IDM2MDA7CiAgICAgICAgdWludCBjb25zdGFudCBNSU5VVEVfSU5fU0VDT05EUyA9IDYwOwoKICAgICAgICB1aW50MTYgY29uc3RhbnQgT1JJR0lOX1lFQVIgPSAxOTcwOwoKICAgICAgICBmdW5jdGlvbiBpc0xlYXBZZWFyKHVpbnQxNiB5ZWFyKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgICAgICAgICBpZiAoeWVhciAlIDQgIT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoeWVhciAlIDEwMCAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHllYXIgJSA0MDAgIT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxlYXBZZWFyc0JlZm9yZSh1aW50IHllYXIpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAgICAgICAgIHllYXIgLT0gMTsKICAgICAgICAgICAgICAgIHJldHVybiB5ZWFyIC8gNCAtIHllYXIgLyAxMDAgKyB5ZWFyIC8gNDAwOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0RGF5c0luTW9udGgodWludDggbW9udGgsIHVpbnQxNiB5ZWFyKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgICAgICAgICAgaWYgKG1vbnRoID09IDEgfHwgbW9udGggPT0gMyB8fCBtb250aCA9PSA1IHx8IG1vbnRoID09IDcgfHwgbW9udGggPT0gOCB8fCBtb250aCA9PSAxMCB8fCBtb250aCA9PSAxMikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMzE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtb250aCA9PSA0IHx8IG1vbnRoID09IDYgfHwgbW9udGggPT0gOSB8fCBtb250aCA9PSAxMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMzA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChpc0xlYXBZZWFyKHllYXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyOTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwYXJzZVRpbWVzdGFtcCh1aW50IHRpbWVzdGFtcCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChfRGF0ZVRpbWUgZHQpIHsKICAgICAgICAgICAgICAgIHVpbnQgc2Vjb25kc0FjY291bnRlZEZvciA9IDA7CiAgICAgICAgICAgICAgICB1aW50IGJ1ZjsKICAgICAgICAgICAgICAgIHVpbnQ4IGk7CgogICAgICAgICAgICAgICAgLy8gWWVhcgogICAgICAgICAgICAgICAgZHQueWVhciA9IGdldFllYXIodGltZXN0YW1wKTsKICAgICAgICAgICAgICAgIGJ1ZiA9IGxlYXBZZWFyc0JlZm9yZShkdC55ZWFyKSAtIGxlYXBZZWFyc0JlZm9yZShPUklHSU5fWUVBUik7CgogICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBMRUFQX1lFQVJfSU5fU0VDT05EUyAqIGJ1ZjsKICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgKz0gWUVBUl9JTl9TRUNPTkRTICogKGR0LnllYXIgLSBPUklHSU5fWUVBUiAtIGJ1Zik7CgogICAgICAgICAgICAgICAgLy8gTW9udGgKICAgICAgICAgICAgICAgIHVpbnQgc2Vjb25kc0luTW9udGg7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IDEyOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kc0luTW9udGggPSBEQVlfSU5fU0VDT05EUyAqIGdldERheXNJbk1vbnRoKGksIGR0LnllYXIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kc0luTW9udGggKyBzZWNvbmRzQWNjb3VudGVkRm9yID4gdGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHQubW9udGggPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgKz0gc2Vjb25kc0luTW9udGg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRGF5CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IGdldERheXNJbk1vbnRoKGR0Lm1vbnRoLCBkdC55ZWFyKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChEQVlfSU5fU0VDT05EUyArIHNlY29uZHNBY2NvdW50ZWRGb3IgPiB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdC5kYXkgPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgKz0gREFZX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gSG91cgogICAgICAgICAgICAgICAgZHQuaG91ciA9IGdldEhvdXIodGltZXN0YW1wKTsKCiAgICAgICAgICAgICAgICAvLyBNaW51dGUKICAgICAgICAgICAgICAgIGR0Lm1pbnV0ZSA9IGdldE1pbnV0ZSh0aW1lc3RhbXApOwoKICAgICAgICAgICAgICAgIC8vIFNlY29uZAogICAgICAgICAgICAgICAgZHQuc2Vjb25kID0gZ2V0U2Vjb25kKHRpbWVzdGFtcCk7CgogICAgICAgICAgICAgICAgLy8gRGF5IG9mIHdlZWsuCiAgICAgICAgICAgICAgICBkdC53ZWVrZGF5ID0gZ2V0V2Vla2RheSh0aW1lc3RhbXApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0WWVhcih1aW50IHRpbWVzdGFtcCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDE2KSB7CiAgICAgICAgICAgICAgICB1aW50IHNlY29uZHNBY2NvdW50ZWRGb3IgPSAwOwogICAgICAgICAgICAgICAgdWludDE2IHllYXI7CiAgICAgICAgICAgICAgICB1aW50IG51bUxlYXBZZWFyczsKCiAgICAgICAgICAgICAgICAvLyBZZWFyCiAgICAgICAgICAgICAgICB5ZWFyID0gdWludDE2KE9SSUdJTl9ZRUFSICsgdGltZXN0YW1wIC8gWUVBUl9JTl9TRUNPTkRTKTsKICAgICAgICAgICAgICAgIG51bUxlYXBZZWFycyA9IGxlYXBZZWFyc0JlZm9yZSh5ZWFyKSAtIGxlYXBZZWFyc0JlZm9yZShPUklHSU5fWUVBUik7CgogICAgICAgICAgICAgICAgc2Vjb25kc0FjY291bnRlZEZvciArPSBMRUFQX1lFQVJfSU5fU0VDT05EUyAqIG51bUxlYXBZZWFyczsKICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgKz0gWUVBUl9JTl9TRUNPTkRTICogKHllYXIgLSBPUklHSU5fWUVBUiAtIG51bUxlYXBZZWFycyk7CgogICAgICAgICAgICAgICAgd2hpbGUgKHNlY29uZHNBY2NvdW50ZWRGb3IgPiB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGVhcFllYXIodWludDE2KHllYXIgLSAxKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzQWNjb3VudGVkRm9yIC09IExFQVBfWUVBUl9JTl9TRUNPTkRTOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHNBY2NvdW50ZWRGb3IgLT0gWUVBUl9JTl9TRUNPTkRTOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHllYXIgLT0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB5ZWFyOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0TW9udGgodWludCB0aW1lc3RhbXApIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VUaW1lc3RhbXAodGltZXN0YW1wKS5tb250aDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldERheSh1aW50IHRpbWVzdGFtcCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZVRpbWVzdGFtcCh0aW1lc3RhbXApLmRheTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEhvdXIodWludCB0aW1lc3RhbXApIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdWludDgoKHRpbWVzdGFtcCAvIDYwIC8gNjApICUgMjQpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0TWludXRlKHVpbnQgdGltZXN0YW1wKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVpbnQ4KCh0aW1lc3RhbXAgLyA2MCkgJSA2MCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRTZWNvbmQodWludCB0aW1lc3RhbXApIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdWludDgodGltZXN0YW1wICUgNjApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0V2Vla2RheSh1aW50IHRpbWVzdGFtcCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1aW50OCgodGltZXN0YW1wIC8gREFZX0lOX1NFQ09ORFMgKyA0KSAlIDcpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdG9UaW1lc3RhbXAodWludDE2IHllYXIsIHVpbnQ4IG1vbnRoLCB1aW50OCBkYXkpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQgdGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdG9UaW1lc3RhbXAoeWVhciwgbW9udGgsIGRheSwgMCwgMCwgMCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0b1RpbWVzdGFtcCh1aW50MTYgeWVhciwgdWludDggbW9udGgsIHVpbnQ4IGRheSwgdWludDggaG91cikgcHVibGljIHB1cmUgcmV0dXJucyAodWludCB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b1RpbWVzdGFtcCh5ZWFyLCBtb250aCwgZGF5LCBob3VyLCAwLCAwKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRvVGltZXN0YW1wKHVpbnQxNiB5ZWFyLCB1aW50OCBtb250aCwgdWludDggZGF5LCB1aW50OCBob3VyLCB1aW50OCBtaW51dGUpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQgdGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdG9UaW1lc3RhbXAoeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCAwKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRvVGltZXN0YW1wKHVpbnQxNiB5ZWFyLCB1aW50OCBtb250aCwgdWludDggZGF5LCB1aW50OCBob3VyLCB1aW50OCBtaW51dGUsIHVpbnQ4IHNlY29uZCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCB0aW1lc3RhbXApIHsKICAgICAgICAgICAgICAgIHVpbnQxNiBpOwoKICAgICAgICAgICAgICAgIC8vIFllYXIKICAgICAgICAgICAgICAgIGZvciAoaSA9IE9SSUdJTl9ZRUFSOyBpIDwgeWVhcjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0xlYXBZZWFyKGkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IExFQVBfWUVBUl9JTl9TRUNPTkRTOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcCArPSBZRUFSX0lOX1NFQ09ORFM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBNb250aAogICAgICAgICAgICAgICAgdWludDhbMTJdIG1lbW9yeSBtb250aERheUNvdW50czsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzBdID0gMzE7CiAgICAgICAgICAgICAgICBpZiAoaXNMZWFwWWVhcih5ZWFyKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1sxXSA9IDI5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzFdID0gMjg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1syXSA9IDMxOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbM10gPSAzMDsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzRdID0gMzE7CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1s1XSA9IDMwOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbNl0gPSAzMTsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzddID0gMzE7CiAgICAgICAgICAgICAgICBtb250aERheUNvdW50c1s4XSA9IDMwOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbOV0gPSAzMTsKICAgICAgICAgICAgICAgIG1vbnRoRGF5Q291bnRzWzEwXSA9IDMwOwogICAgICAgICAgICAgICAgbW9udGhEYXlDb3VudHNbMTFdID0gMzE7CgogICAgICAgICAgICAgICAgZm9yIChpID0gMTsgaSA8IG1vbnRoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IERBWV9JTl9TRUNPTkRTICogbW9udGhEYXlDb3VudHNbaSAtIDFdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIERheQogICAgICAgICAgICAgICAgdGltZXN0YW1wICs9IERBWV9JTl9TRUNPTkRTICogKGRheSAtIDEpOwoKICAgICAgICAgICAgICAgIC8vIEhvdXIKICAgICAgICAgICAgICAgIHRpbWVzdGFtcCArPSBIT1VSX0lOX1NFQ09ORFMgKiAoaG91cik7CgogICAgICAgICAgICAgICAgLy8gTWludXRlCiAgICAgICAgICAgICAgICB0aW1lc3RhbXAgKz0gTUlOVVRFX0lOX1NFQ09ORFMgKiAobWludXRlKTsKCiAgICAgICAgICAgICAgICAvLyBTZWNvbmQKICAgICAgICAgICAgICAgIHRpbWVzdGFtcCArPSBzZWNvbmQ7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVzdGFtcDsKICAgICAgICB9Cn0KCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKCi8qKgogKiBAYXV0aG9yIE9wZW5aZXBwZWxpbgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICogYjsKICAgICAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICAgICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAgICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xODsKbGlicmFyeSBQcmVzYWxlQm9udXNlcyB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBmdW5jdGlvbiBwcmVzYWxlQm9udXNBcHBsaWNhdG9yKHVpbnQgX3B1cmNoYXNlZCwgYWRkcmVzcyBfZGF0ZVRpbWVMaWIpCiAgICAgICAgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IHJld2FyZCkKICAgIHsKICAgICAgICBEYXRlVGltZUFQSSBkYXRlVGltZSA9IERhdGVUaW1lQVBJKF9kYXRlVGltZUxpYik7CiAgICAgICAgdWludCBob3VyID0gZGF0ZVRpbWUuZ2V0SG91cihibG9jay50aW1lc3RhbXApOwogICAgICAgIHVpbnQgZGF5ID0gZGF0ZVRpbWUuZ2V0RGF5KGJsb2NrLnRpbWVzdGFtcCk7CgogICAgICAgIC8vLyBGaXJzdCA0IGhvdXJzIGJvbnVzCiAgICAgICAgaWYgKGRheSA9PSAyICYmIGhvdXIgPj0gMTYgJiYgaG91ciA8IDIwKSB7CiAgICAgICAgICAgIHJldHVybiBhcHBseVBlcmNlbnRhZ2UoX3B1cmNoYXNlZCwgNzApOwogICAgICAgIH0KCiAgICAgICAgLy8vIEZpcnN0IGRheSBib251cwogICAgICAgIGlmICgoZGF5ID09IDIgJiYgaG91ciA+PSAyMCkgfHwgKGRheSA9PSAzICYmIGhvdXIgPCA1KSkgewogICAgICAgICAgICByZXR1cm4gYXBwbHlQZXJjZW50YWdlKF9wdXJjaGFzZWQsIDUwKTsKICAgICAgICB9CgogICAgICAgIC8vLyBTZWNvbmQgZGF5IGJvbnVzCiAgICAgICAgaWYgKChkYXkgPT0gMyAmJiBob3VyID49IDUpIHx8IChkYXkgPT0gNCAmJiBob3VyIDwgNSkpIHsKICAgICAgICAgICAgcmV0dXJuIGFwcGx5UGVyY2VudGFnZShfcHVyY2hhc2VkLCA0NSk7CiAgICAgICAgfSAKCiAgICAgICAgLy8vIERheXMgMyAtIDIwIGJvbnVzCiAgICAgICAgaWYgKGRheSA8IDIyKSB7CiAgICAgICAgICAgIHVpbnQgbnVtRGF5cyA9IGRheSAtIDM7CiAgICAgICAgICAgIGlmIChob3VyIDwgNSkgewogICAgICAgICAgICAgICAgbnVtRGF5cy0tOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYXBwbHlQZXJjZW50YWdlKF9wdXJjaGFzZWQsICg0NSAtIG51bURheXMpKTsKICAgICAgICB9CgogICAgICAgIC8vLyBGaWxsIHRoZSBnYXAKICAgICAgICBpZiAoZGF5ID09IDIyICYmIGhvdXIgPCA1KSB7CiAgICAgICAgICAgIHJldHVybiBhcHBseVBlcmNlbnRhZ2UoX3B1cmNoYXNlZCwgMjcpOwogICAgICAgIH0KCiAgICAgICAgLy8vIERheSAyMSBib251cwogICAgICAgIGlmICgoZGF5ID09IDIyICYmIGhvdXIgPj0gNSkgfHwgKGRheSA9PSAyMyAmJiBob3VyIDwgNSkpIHsKICAgICAgICAgICAgcmV0dXJuIGFwcGx5UGVyY2VudGFnZShfcHVyY2hhc2VkLCAyNSk7CiAgICAgICAgfQoKICAgICAgICAvLy8gRGF5IDIyIGJvbnVzCiAgICAgICAgaWYgKChkYXkgPT0gMjMgJiYgaG91ciA+PSA1KSB8fCAoZGF5ID09IDI0ICYmIGhvdXIgPCA1KSkgewogICAgICAgICAgICByZXR1cm4gYXBwbHlQZXJjZW50YWdlKF9wdXJjaGFzZWQsIDIwKTsKICAgICAgICB9CgogICAgICAgIC8vLyBEYXkgMjMgYm9udXMKICAgICAgICBpZiAoKGRheSA9PSAyNCAmJiBob3VyID49IDUpIHx8IChkYXkgPT0gMjUgJiYgaG91ciA8IDUpKSB7CiAgICAgICAgICAgIHJldHVybiBhcHBseVBlcmNlbnRhZ2UoX3B1cmNoYXNlZCwgMTUpOwogICAgICAgIH0KCiAgICAgICAgLy9lbHNlCiAgICAgICAgcmV2ZXJ0KCk7CiAgICB9CgogICAgLy8vIEludGVybmFsIGZ1bmN0aW9uIHRvIGFwcGx5IGEgc3BlY2lmaWVkIHBlcmNlbnRhZ2UgYW1vdW50IHRvIGFuIGludGVnZXIuCiAgICBmdW5jdGlvbiBhcHBseVBlcmNlbnRhZ2UodWludCBfYmFzZSwgdWludCBfcGVyY2VudGFnZSkKICAgICAgICBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgbnVtKQogICAgewogICAgICAgIG51bSA9IF9iYXNlLm11bChfcGVyY2VudGFnZSkuZGl2KDEwMCk7CiAgICB9CiAgICAKfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAgIC8qKgogICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAgKiBhY2NvdW50LgogICAgICovCiAgICBmdW5jdGlvbiBPd25hYmxlKCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgoKICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgICovCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcCgKICAgICAgICBhZGRyZXNzIG5ld093bmVyCiAgICApCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9Cgp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC44Owpjb250cmFjdCBUb2tlbiB7CiAgICAvKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgaXMgcmVwbGFjZWQgd2l0aDoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4KICAgIFRoaXMgaXMgbW92ZWQgdG8gdGhlIGJhc2UgY29udHJhY3Qgc2luY2UgcHVibGljIGdldHRlciBmdW5jdGlvbnMgYXJlIG5vdAogICAgY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0CiAgICBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuCiAgICAqLwogICAgLy8vIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBUb2tlbiB7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICAvL0RlZmF1bHQgYXNzdW1lcyB0b3RhbFN1cHBseSBjYW4ndCBiZSBvdmVyIG1heCAoMl4yNTYgLSAxKS4KICAgICAgICAvL0lmIHlvdXIgdG9rZW4gbGVhdmVzIG91dCB0b3RhbFN1cHBseSBhbmQgY2FuIGlzc3VlIG1vcmUgdG9rZW5zIGFzIHRpbWUgZ29lcyBvbiwgeW91IG5lZWQgdG8gY2hlY2sgaWYgaXQgZG9lc24ndCB3cmFwLgogICAgICAgIC8vUmVwbGFjZSB0aGUgaWYgd2l0aCB0aGlzIG9uZSBpbnN0ZWFkLgogICAgICAgIC8vcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfdmFsdWU7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIC8vc2FtZSBhcyBhYm92ZS4gUmVwbGFjZSB0aGlzIGxpbmUgd2l0aCB0aGUgZm9sbG93aW5nIGlmIHlvdSB3YW50IHRvIHByb3RlY3QgYWdhaW5zdCB3cmFwcGluZyB1aW50cy4KICAgICAgICAvL3JlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfdmFsdWU7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40Ljg7CmNvbnRyYWN0IEh1bWFuU3RhbmRhcmRUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgICAvKiBQdWJsaWMgdmFyaWFibGVzIG9mIHRoZSB0b2tlbiAqLwoKICAgIC8qCiAgICBOT1RFOgogICAgVGhlIGZvbGxvd2luZyB2YXJpYWJsZXMgYXJlIE9QVElPTkFMIHZhbml0aWVzLiBPbmUgZG9lcyBub3QgaGF2ZSB0byBpbmNsdWRlIHRoZW0uCiAgICBUaGV5IGFsbG93IG9uZSB0byBjdXN0b21pc2UgdGhlIHRva2VuIGNvbnRyYWN0ICYgaW4gbm8gd2F5IGluZmx1ZW5jZXMgdGhlIGNvcmUgZnVuY3Rpb25hbGl0eS4KICAgIFNvbWUgd2FsbGV0cy9pbnRlcmZhY2VzIG1pZ2h0IG5vdCBldmVuIGJvdGhlciB0byBsb29rIGF0IHRoaXMgaW5mb3JtYXRpb24uCiAgICAqLwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOyAgICAgICAgICAgICAgICAgICAvL2ZhbmN5IG5hbWU6IGVnIFNpbW9uIEJ1Y2tzCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7ICAgICAgICAgICAgICAgIC8vSG93IG1hbnkgZGVjaW1hbHMgdG8gc2hvdy4gaWUuIFRoZXJlIGNvdWxkIDEwMDAgYmFzZSB1bml0cyB3aXRoIDMgZGVjaW1hbHMuIE1lYW5pbmcgMC45ODAgU0JYID0gOTgwIGJhc2UgdW5pdHMuIEl0J3MgbGlrZSBjb21wYXJpbmcgMSB3ZWkgdG8gMSBldGhlci4KICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlZyBTQlgKICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICdIMC4xJzsgICAgICAgLy9odW1hbiAwLjEgc3RhbmRhcmQuIEp1c3QgYW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lLgoKICAgIGZ1bmN0aW9uIEh1bWFuU3RhbmRhcmRUb2tlbigKICAgICAgICB1aW50MjU2IF9pbml0aWFsQW1vdW50LAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbAogICAgICAgICkgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gX2luaXRpYWxBbW91bnQ7ICAgICAgICAgICAgICAgLy8gR2l2ZSB0aGUgY3JlYXRvciBhbGwgaW5pdGlhbCB0b2tlbnMKICAgICAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsQW1vdW50OyAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0b3RhbCBzdXBwbHkKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZSBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW1vdW50IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgfQoKICAgIC8qIEFwcHJvdmVzIGFuZCB0aGVuIGNhbGxzIHRoZSByZWNlaXZpbmcgY29udHJhY3QgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZXh0cmFEYXRhKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCiAgICAgICAgLy9jYWxsIHRoZSByZWNlaXZlQXBwcm92YWwgZnVuY3Rpb24gb24gdGhlIGNvbnRyYWN0IHlvdSB3YW50IHRvIGJlIG5vdGlmaWVkLiBUaGlzIGNyYWZ0cyB0aGUgZnVuY3Rpb24gc2lnbmF0dXJlIG1hbnVhbGx5IHNvIG9uZSBkb2Vzbid0IGhhdmUgdG8gaW5jbHVkZSBhIGNvbnRyYWN0IGluIGhlcmUganVzdCBmb3IgdGhpcy4KICAgICAgICAvL3JlY2VpdmVBcHByb3ZhbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYWRkcmVzcyBfdG9rZW5Db250cmFjdCwgYnl0ZXMgX2V4dHJhRGF0YSkKICAgICAgICAvL2l0IGlzIGFzc3VtZWQgdGhhdCB3aGVuIGRvZXMgdGhpcyB0aGF0IHRoZSBjYWxsICpzaG91bGQqIHN1Y2NlZWQsIG90aGVyd2lzZSBvbmUgd291bGQgdXNlIHZhbmlsbGEgYXBwcm92ZSBpbnN0ZWFkLgogICAgICAgIHJlcXVpcmUoX3NwZW5kZXIuY2FsbChieXRlczQoYnl0ZXMzMihzaGEzKCJyZWNlaXZlQXBwcm92YWwoYWRkcmVzcyx1aW50MjU2LGFkZHJlc3MsYnl0ZXMpIikpKSwgbXNnLnNlbmRlciwgX3ZhbHVlLCB0aGlzLCBfZXh0cmFEYXRhKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE3OwovKioKICogU0hBUkUgdG9rZW4gaXMgYW4gRVJDMjAgdG9rZW4uCiAqLwpjb250cmFjdCBTaGFyZSBpcyBIdW1hblN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBUT0tFTl9OQU1FID0gIlZ5cmFsIFRva2VuIjsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFRPS0VOX1NZTUJPTCA9ICJTSEFSRSI7CgogICAgdWludDggcHVibGljIGNvbnN0YW50IFRPS0VOX0RFQ0lNQUxTID0gMTg7CgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgVE9UQUxfU1VQUExZID0gNzc3Nzc3Nzc3ICogKDEwICoqIHVpbnQoVE9LRU5fREVDSU1BTFMpKTsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGxvY2tlZEJhbGFuY2VzOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVycmVyczsKCiAgICAvKioKICAgICAqIEluaXQgdGhpcyBjb250cmFjdCB3aXRoIHRoZSBzYW1lIHBhcmFtcyBhcyBhIEhTVC4KICAgICAqLwogICAgZnVuY3Rpb24gU2hhcmUoKSBIdW1hblN0YW5kYXJkVG9rZW4oVE9UQUxfU1VQUExZLCBUT0tFTl9OQU1FLCBUT0tFTl9ERUNJTUFMUywgVE9LRU5fU1lNQk9MKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIHRyYW5zZmVycmVyc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICB9CgogICAgLy8vLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vLyBPdmVycmlkZXMKICAgIC8vLy0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8vIE9mZiBvbiBkZXBsb3ltZW50LgogICAgYm9vbCBpc1RyYW5zZmVyYWJsZSA9IGZhbHNlOwoKICAgIC8vLyBCb251cyB0b2tlbnMgYXJlIGxvY2tlZCBvbiBkZXBsb3ltZW50CiAgICBib29sIGlzQm9udXNMb2NrZWQgPSB0cnVlOwoKICAgIC8vLyBBbGxvd3MgdGhlIG93bmVyIHRvIHRyYW5zZmVyIHRva2VucyB3aGVuZXZlciwgYnV0IG90aGVycyB0byBvbmx5IHRyYW5zZmVyIGFmdGVyIG93bmVyIHNheXMgc28uCiAgICBtb2RpZmllciBjYW5CZVRyYW5zZmVycmVkIHsKICAgICAgICByZXF1aXJlKHRyYW5zZmVycmVyc1ttc2cuc2VuZGVyXSB8fCBpc1RyYW5zZmVyYWJsZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlclJld2FyZCgKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50IF92YWx1ZQogICAgKQogICAgICAgIGNhbkJlVHJhbnNmZXJyZWQKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKCiAgICAgICAgbG9ja2VkQmFsYW5jZXNbX3RvXSA9IGxvY2tlZEJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CgogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcigKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50IF92YWx1ZQogICAgKQogICAgICAgIGNhbkJlVHJhbnNmZXJyZWQKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsKCiAgICAgICAgLy8vIE9ubHkgdHJhbnNmZXIgdW5sb2NrZWQgYmFsYW5jZQogICAgICAgIGlmKGlzQm9udXNMb2NrZWQpIHsKICAgICAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIobG9ja2VkQmFsYW5jZXNbbXNnLnNlbmRlcl0pID49IF92YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50IF92YWx1ZQogICAgKQogICAgICAgIGNhbkJlVHJhbnNmZXJyZWQKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwoKICAgICAgICAvLy8gT25seSB0cmFuc2ZlciB1bmxvY2tlZCBiYWxhbmNlCiAgICAgICAgaWYoaXNCb251c0xvY2tlZCkgewogICAgICAgICAgICByZXF1aXJlKGJhbGFuY2VzW19mcm9tXS5zdWIobG9ja2VkQmFsYW5jZXNbX2Zyb21dKSA+PSBfdmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVtfdG9dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGxvY2tlZEJhbGFuY2VPZigKICAgICAgICBhZGRyZXNzIF9vd25lcgogICAgKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gbG9ja2VkQmFsYW5jZXNbX293bmVyXTsKICAgIH0KCiAgICAvLy8tLS0tLS0tLS0tLS0tLS0tLQogICAgLy8vIEFkbWluCiAgICAvLy8tLS0tLS0tLS0tLS0tLS0tLQoKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycygpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlzVHJhbnNmZXJhYmxlID0gdHJ1ZTsKCiAgICAgICAgcmV0dXJuIGlzVHJhbnNmZXJhYmxlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZFRyYW5zZmVycmVyKAogICAgICAgIGFkZHJlc3MgX3RyYW5zZmVycmVyCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgdHJhbnNmZXJyZXJzW190cmFuc2ZlcnJlcl0gPSB0cnVlOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3cgYm9udXMgdG9rZW5zIHRvIGJlIHdpdGhkcmF3bgogICAgICovCiAgICBmdW5jdGlvbiByZWxlYXNlQm9udXMoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGlzQm9udXNMb2NrZWQgPSBmYWxzZTsKICAgIH0KCn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKLyoqCiAqIEEge0NhbXBhaWdufSByZXByZXNlbnRzIGFuIGFkdmVydGlzaW5nIGNhbXBhaWduLgogKi8KY29udHJhY3QgQ2FtcGFpZ24gaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKICAgIHVzaW5nIFJlZmVycmFsIGZvciBSZWZlcnJhbC5UcmVlOwogICAgdXNpbmcgVGllcmVkUGF5b2ZmIGZvciBSZWZlcnJhbC5UcmVlOwoKICAgIC8vLyBUaGUgcmVmZXJyYWwgdHJlZSAoay1hcnkgdHJlZSkKICAgIFJlZmVycmFsLlRyZWUgdnlyYWxUcmVlOwoKICAgIC8vLyBUb2tlbiBpbiB1c2UKICAgIFNoYXJlIHB1YmxpYyB0b2tlbjsKCiAgICAvLy8gQnVkZ2V0IG9mIHRoZSBjYW1wYWlnbgogICAgdWludCBwdWJsaWMgYnVkZ2V0OwoKICAgIC8vLyBUb2tlbnMgc3BlbnQKICAgIHVpbnQgcHVibGljIGNvc3Q7CgogICAgLyoKICAgICAqIE1vZGlmaWVycwogICAgICovCgogICAgbW9kaWZpZXIgb25seU5vblplcm9BZGRyZXNzKGFkZHJlc3MgX2EpIHsKICAgICAgICByZXF1aXJlKF9hICE9IDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU5vblNlbGZSZWZlcnJhbChhZGRyZXNzIF9yZWZlcnJlciwgYWRkcmVzcyBfaW52aXRlZSkgewogICAgICAgIHJlcXVpcmUoX3JlZmVycmVyICE9IF9pbnZpdGVlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlPblJlZmVycmFsKGFkZHJlc3MgX2ludml0ZWUpIHsKICAgICAgICByZXF1aXJlKGdldFJlZmVycmVyKF9pbnZpdGVlKSAhPSAweDApOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUlmRnVuZHNBdmFpbGFibGUoKSB7CiAgICAgICAgcmVxdWlyZShnZXRBdmFpbGFibGVCYWxhbmNlKCkgPj0gMCk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoKICAgICAqIEV2ZW50cwogICAgICovCgogICAgLy8vIEEgbmV3IGNhbXBhaWduIHdhcyBjcmVhdGVkCiAgICBldmVudCBMb2dDYW1wYWlnbkNyZWF0ZWQoYWRkcmVzcyBjYW1wYWlnbik7CgogICAgLy8vIFJld2FyZCBhbGxvY2F0ZWQKICAgIGV2ZW50IExvZ1Jld2FyZEFsbG9jYXRlZChhZGRyZXNzIHJlZmVycmVyLCB1aW50IGludml0ZWVTaGFyZXMsIHVpbnQgcmVmZXJyYWxSZXdhcmQpOwoKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBjYW1wYWlnbi4KICAgICAqLwogICAgZnVuY3Rpb24gQ2FtcGFpZ24oCiAgICAgICAgYWRkcmVzcyBfdG9rZW4sCiAgICAgICAgdWludDI1NiBfYnVkZ2V0QW1vdW50CiAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgdG9rZW4gPSBTaGFyZShfdG9rZW4pOwogICAgICAgIGJ1ZGdldCA9IF9idWRnZXRBbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFjY2VwdCBpbnZpdGF0aW9uIGFuZCBqb2luIGNvbnRyYWN0LiBJZiByZWZlcnJlciBhZGRyZXNzIGlzIG5vbi16ZXJvLAogICAgICogY2FsY3VsYXRlIHJld2FyZCBhbmQgdHJhbnNmZXIgdG9rZW5zIHRvIHJlZmVycmVyLiBSZWZlcnJlciBhZGRyZXNzIHdpbGwgYmUKICAgICAqIHplcm8gaWYgcmVmZXJyZXIgaXMgbm90IGZvdW5kIGluIHRoZSByZWZlcnJhbCB0cmVlLiBEb24ndCB0aHJvdyBpbiBzdWNoIGEKICAgICAqIHNjZW5hcmlvLgogICAgICovCiAgICBmdW5jdGlvbiBqb2luKAogICAgICAgIGFkZHJlc3MgX3JlZmVycmVyLAogICAgICAgIGFkZHJlc3MgX2ludml0ZWUsCiAgICAgICAgdWludCBfc2hhcmVzCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seU5vblplcm9BZGRyZXNzKF9pbnZpdGVlKQogICAgICAgIG9ubHlOb25TZWxmUmVmZXJyYWwoX3JlZmVycmVyLCBfaW52aXRlZSkKICAgICAgICBvbmx5SWZGdW5kc0F2YWlsYWJsZSgpCiAgICAgICAgcmV0dXJucyh1aW50IHJld2FyZCkKICAgIHsKICAgICAgICBSZWZlcnJhbC5Ob2RlIG1lbW9yeSByZWZlcnJlck5vZGUgPSB2eXJhbFRyZWUubm9kZXNbX3JlZmVycmVyXTsKCiAgICAgICAgLy8gUmVmZXJyZXIgd2FzIG5vdCBmb3VuZCwgYWRkIHJlZmVycmVyIGFzIGEgbmV3IG5vZGUKICAgICAgICBpZihyZWZlcnJlck5vZGUuZXhpc3RzID09IGZhbHNlKSB7CiAgICAgICAgICAgIHZ5cmFsVHJlZS5hZGRJbnZpdGVlKG93bmVyLCBfcmVmZXJyZXIsIDApOwogICAgICAgIH0KCiAgICAgICAgLy8gQWRkIGludml0ZWUgdG8gdGhlIHRyZWUKICAgICAgICB2eXJhbFRyZWUuYWRkSW52aXRlZShfcmVmZXJyZXIsIF9pbnZpdGVlLCBfc2hhcmVzKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIHJlZmVycmVyJ3MgcmV3YXJkCiAgICAgICAgcmV3YXJkID0gdnlyYWxUcmVlLnBheW9mZihfcmVmZXJyZXIpOwoKICAgICAgICAvLyBMb2cgZXZlbnQKICAgICAgICBMb2dSZXdhcmRBbGxvY2F0ZWQoX3JlZmVycmVyLCBfc2hhcmVzLCByZXdhcmQpOwogICAgfQoKICAgIC8qKgogICAgICogVnlyYWxTYWxlIChvd25lcikgdHJhbnNmZXJzIHJld2FyZHMgb24gYmVoYWxmIG9mIHRoaXMgY29udHJhY3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNlbmRSZXdhcmQoYWRkcmVzcyBfd2hvLCB1aW50IF9hbW91bnQpCiAgICAgICAgb25seU93bmVyIC8vKGllLCBWeXJhbFNhbGUpCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZihnZXRBdmFpbGFibGVCYWxhbmNlKCkgPj0gX2Ftb3VudCkgewogICAgICAgICAgICB0b2tlbi50cmFuc2ZlclJld2FyZChfd2hvLCBfYW1vdW50KTsKICAgICAgICAgICAgY29zdCA9IGNvc3QuYWRkKF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHJlZmVycmFsIGtleSBvZiBjYWxsZXIuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFJlZmVycmVyKAogICAgICAgIGFkZHJlc3MgX2ludml0ZWUKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGFkZHJlc3MgX3JlZmVycmVyKQogICAgewogICAgICAgIF9yZWZlcnJlciA9IHZ5cmFsVHJlZS5nZXRSZWZlcnJlcihfaW52aXRlZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIHNpemUgb2YgdGhlIFJlZmVycmFsIFRyZWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFRyZWVTaXplKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQgX3NpemUpCiAgICB7CiAgICAgICAgX3NpemUgPSB2eXJhbFRyZWUuZ2V0VHJlZVNpemUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgYnVkZ2V0IGFzIGEgdHVwbGUsICh0b2tlbiBhZGRyZXNzLCBhbW91bnQpCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEJ1ZGdldCgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChhZGRyZXNzIF90b2tlbiwgdWludCBfYW1vdW50KQogICAgewogICAgICAgIF90b2tlbiA9IHRva2VuOwogICAgICAgIF9hbW91bnQgPSBidWRnZXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybiAoYnVkZ2V0IC0gY29zdCkKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlQmFsYW5jZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50IF9iYWxhbmNlKQogICAgewogICAgICAgIF9iYWxhbmNlID0gKGJ1ZGdldCAtIGNvc3QpOwogICAgfQoKICAgIC8qKgogICAgICogRmFsbGJhY2suIERvbid0IHNlbmQgRVRIIHRvIGEgY2FtcGFpZ24uCiAgICAgKi8KICAgIGZ1bmN0aW9uKCkgcHVibGljIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CmNvbnRyYWN0IFZlc3RpbmcgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBUb2tlbiBwdWJsaWMgdmVzdGluZ1Rva2VuOyAgICAgICAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgdmVzdGluZyB0b2tlbi4KCiAgICBzdHJ1Y3QgVmVzdGluZ1NjaGVkdWxlIHsKICAgICAgICB1aW50IHN0YXJ0VGltZXN0YW1wOyAgICAgICAgICAgIC8vIFRpbWVzdGFtcCBvZiB3aGVuIHZlc3RpbmcgYmVnaW5zLgogICAgICAgIHVpbnQgY2xpZmZUaW1lc3RhbXA7ICAgICAgICAgICAgLy8gVGltZXN0YW1wIG9mIHdoZW4gdGhlIGNsaWZmIGJlZ2lucy4KICAgICAgICB1aW50IGxvY2tQZXJpb2Q7ICAgICAgICAgICAgICAgIC8vIEFtb3VudCBvZiB0aW1lIGluIHNlY29uZHMgYmV0d2VlbiB3aXRoZHJhd2FsIHBlcmlvZHMuIChFRy4gNiBtb250aHMgb3IgMSBtb250aCkKICAgICAgICB1aW50IGVuZFRpbWVzdGFtcDsgICAgICAgICAgICAgIC8vIFRpbWVzdGFtcCBvZiB3aGVuIHZlc3RpbmcgZW5kcyBhbmQgdG9rZW5zIGFyZSBjb21wbGV0ZWx5IGF2YWlsYWJsZS4KICAgICAgICB1aW50IHRvdGFsQW1vdW50OyAgICAgICAgICAgICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdmVzdGVkLgogICAgICAgIHVpbnQgYW1vdW50V2l0aGRyYXduOyAgICAgICAgICAgLy8gVGhlIGFtb3VudCB0aGF0IGhhcyBiZWVuIHdpdGhkcmF3bi4KICAgICAgICBhZGRyZXNzIGRlcG9zaXRvcjsgICAgICAgICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIGRlcG9zaXRvciBvZiB0aGUgdG9rZW5zIHRvIGJlIHZlc3RlZC4gKENyb3dkc2FsZSBjb250cmFjdCkKICAgICAgICBib29sIGlzQ29uZmlybWVkOyAgICAgICAgICAgICAgIC8vIFRydWUgaWYgdGhlIHJlZ2lzdGVyZWQgYWRkcmVzcyBoYXMgY29uZmlybWVkIHRoZSB2ZXN0aW5nIHNjaGVkdWxlLgogICAgfQoKICAgIC8vIFRoZSB2ZXN0aW5nIHNjaGVkdWxlIGF0dGFjaGVkIHRvIGEgc3BlY2lmaWMgYWRkcmVzcy4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gVmVzdGluZ1NjaGVkdWxlKSB2ZXN0aW5nU2NoZWR1bGVzOwoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSB0b2tlbiB0byBiZSB2ZXN0ZWQgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIHRvIGJlIHZlc3RlZC4KICAgIGZ1bmN0aW9uIFZlc3RpbmcoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyB7CiAgICAgICAgdmVzdGluZ1Rva2VuID0gVG9rZW4oX3Rva2VuKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlclZlc3RpbmdTY2hlZHVsZShhZGRyZXNzIF9uZXdBZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzIF9kZXBvc2l0b3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgX3N0YXJ0VGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9jbGlmZlRpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfbG9ja1BlcmlvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfZW5kVGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IF90b3RhbEFtb3VudCkKICAgICAgICBwdWJsaWMgb25seU93bmVyCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgdGhhdCB3ZSBhcmUgcmVnaXN0ZXJpbmcgYSBkZXBvc2l0b3IgYW5kIHRoZSBhZGRyZXNzIHdlIHJlZ2lzdGVyIHRvIHZlc3QgdG8gCiAgICAgICAgLy8gIGRvZXMgbm90IGFscmVhZHkgaGF2ZSBhIGRlcG9zaXRvci4KICAgICAgICByZXF1aXJlKCBfZGVwb3NpdG9yICE9IDB4MCApOwogICAgICAgIHJlcXVpcmUoIHZlc3RpbmdTY2hlZHVsZXNbX25ld0FkZHJlc3NdLmRlcG9zaXRvciA9PSAweDAgKTsKCiAgICAgICAgLy8gVmFsaWRhdGUgdGhhdCB0aGUgdGltZXMgbWFrZSBzZW5zZS4KICAgICAgICByZXF1aXJlKCBfY2xpZmZUaW1lc3RhbXAgPj0gX3N0YXJ0VGltZXN0YW1wICk7CiAgICAgICAgcmVxdWlyZSggX2VuZFRpbWVzdGFtcCA+IF9jbGlmZlRpbWVzdGFtcCApOwoKICAgICAgICAvLyBTb21lIGxvY2sgcGVyaW9kIHNhbml0eSBjaGVja3MuCiAgICAgICAgcmVxdWlyZSggX2xvY2tQZXJpb2QgIT0gMCApOyAKICAgICAgICByZXF1aXJlKCBfZW5kVGltZXN0YW1wLnN1Yihfc3RhcnRUaW1lc3RhbXApID4gX2xvY2tQZXJpb2QgKTsKCiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIG5ldyBhZGRyZXNzLgogICAgICAgIHZlc3RpbmdTY2hlZHVsZXNbX25ld0FkZHJlc3NdID0gVmVzdGluZ1NjaGVkdWxlKHsKICAgICAgICAgICAgc3RhcnRUaW1lc3RhbXA6IF9zdGFydFRpbWVzdGFtcCwKICAgICAgICAgICAgY2xpZmZUaW1lc3RhbXA6IF9jbGlmZlRpbWVzdGFtcCwKICAgICAgICAgICAgbG9ja1BlcmlvZDogX2xvY2tQZXJpb2QsCiAgICAgICAgICAgIGVuZFRpbWVzdGFtcDogX2VuZFRpbWVzdGFtcCwKICAgICAgICAgICAgdG90YWxBbW91bnQ6IF90b3RhbEFtb3VudCwKICAgICAgICAgICAgYW1vdW50V2l0aGRyYXduOiAwLAogICAgICAgICAgICBkZXBvc2l0b3I6IF9kZXBvc2l0b3IsCiAgICAgICAgICAgIGlzQ29uZmlybWVkOiBmYWxzZQogICAgICAgIH0pOwoKICAgICAgICAvLyBMb2cgdGhhdCB3ZSByZWdpc3RlcmVkIGEgbmV3IGFkZHJlc3MuCiAgICAgICAgVmVzdGluZ1NjaGVkdWxlUmVnaXN0ZXJlZCgKICAgICAgICAgICAgX25ld0FkZHJlc3MsCiAgICAgICAgICAgIF9kZXBvc2l0b3IsCiAgICAgICAgICAgIF9zdGFydFRpbWVzdGFtcCwKICAgICAgICAgICAgX2xvY2tQZXJpb2QsCiAgICAgICAgICAgIF9jbGlmZlRpbWVzdGFtcCwKICAgICAgICAgICAgX2VuZFRpbWVzdGFtcCwKICAgICAgICAgICAgX3RvdGFsQW1vdW50CiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb25maXJtVmVzdGluZ1NjaGVkdWxlKHVpbnQgX3N0YXJ0VGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9jbGlmZlRpbWVzdGFtcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfbG9ja1BlcmlvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludCBfZW5kVGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IF90b3RhbEFtb3VudCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICBWZXN0aW5nU2NoZWR1bGUgc3RvcmFnZSB2ZXN0aW5nU2NoZWR1bGUgPSB2ZXN0aW5nU2NoZWR1bGVzW21zZy5zZW5kZXJdOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBtc2cuc2VuZGVyIGhhcyBiZWVuIHJlZ2lzdGVyZWQgYnV0IG5vdCBjb25maXJtZWQgeWV0LgogICAgICAgIHJlcXVpcmUoIHZlc3RpbmdTY2hlZHVsZS5kZXBvc2l0b3IgIT0gMHgwICk7CiAgICAgICAgcmVxdWlyZSggdmVzdGluZ1NjaGVkdWxlLmlzQ29uZmlybWVkID09IGZhbHNlICk7CgogICAgICAgIC8vIFZhbGlkYXRlIHRoZSBzYW1lIGluZm9ybWF0aW9uIHdhcyByZWdpc3RlcmVkIHRoYXQgaXMgYmVpbmcgY29uZmlybWVkLgogICAgICAgIHJlcXVpcmUoIHZlc3RpbmdTY2hlZHVsZS5zdGFydFRpbWVzdGFtcCA9PSBfc3RhcnRUaW1lc3RhbXAgKTsKICAgICAgICByZXF1aXJlKCB2ZXN0aW5nU2NoZWR1bGUuY2xpZmZUaW1lc3RhbXAgPT0gX2NsaWZmVGltZXN0YW1wICk7CiAgICAgICAgcmVxdWlyZSggdmVzdGluZ1NjaGVkdWxlLmxvY2tQZXJpb2QgPT0gX2xvY2tQZXJpb2QgKTsKICAgICAgICByZXF1aXJlKCB2ZXN0aW5nU2NoZWR1bGUuZW5kVGltZXN0YW1wID09IF9lbmRUaW1lc3RhbXAgKTsKICAgICAgICByZXF1aXJlKCB2ZXN0aW5nU2NoZWR1bGUudG90YWxBbW91bnQgPT0gX3RvdGFsQW1vdW50ICk7CgogICAgICAgIC8vIENvbmZpcm0gdGhlIHNjaGVkdWxlIGFuZCBtb3ZlIHRoZSB0b2tlbnMgaGVyZS4KICAgICAgICB2ZXN0aW5nU2NoZWR1bGUuaXNDb25maXJtZWQgPSB0cnVlOwogICAgICAgIHJlcXVpcmUodmVzdGluZ1Rva2VuLnRyYW5zZmVyRnJvbSh2ZXN0aW5nU2NoZWR1bGUuZGVwb3NpdG9yLCBhZGRyZXNzKHRoaXMpLCBfdG90YWxBbW91bnQpKTsKCiAgICAgICAgLy8gTG9nIHRoYXQgdGhlIHZlc3Rpbmcgc2NoZWR1bGUgd2FzIGNvbmZpcm1lZC4KICAgICAgICBWZXN0aW5nU2NoZWR1bGVDb25maXJtZWQoCiAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHZlc3RpbmdTY2hlZHVsZS5kZXBvc2l0b3IsCiAgICAgICAgICAgIHZlc3RpbmdTY2hlZHVsZS5zdGFydFRpbWVzdGFtcCwKICAgICAgICAgICAgdmVzdGluZ1NjaGVkdWxlLmNsaWZmVGltZXN0YW1wLAogICAgICAgICAgICB2ZXN0aW5nU2NoZWR1bGUubG9ja1BlcmlvZCwKICAgICAgICAgICAgdmVzdGluZ1NjaGVkdWxlLmVuZFRpbWVzdGFtcCwKICAgICAgICAgICAgdmVzdGluZ1NjaGVkdWxlLnRvdGFsQW1vdW50CiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Zlc3RlZFRva2VucygpCiAgICAgICAgcHVibGljIAogICAgewogICAgICAgIFZlc3RpbmdTY2hlZHVsZSBzdG9yYWdlIHZlc3RpbmdTY2hlZHVsZSA9IHZlc3RpbmdTY2hlZHVsZXNbbXNnLnNlbmRlcl07CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHZlc3Rpbmcgc2NoZWR1bGUgd2FzIHJlZ2lzdGVyZWQgYW5kIGl0J3MgYWZ0ZXIgY2xpZmYgdGltZS4KICAgICAgICByZXF1aXJlKCB2ZXN0aW5nU2NoZWR1bGUuaXNDb25maXJtZWQgPT0gdHJ1ZSApOwogICAgICAgIHJlcXVpcmUoIHZlc3RpbmdTY2hlZHVsZS5jbGlmZlRpbWVzdGFtcCA8PSBub3cgKTsKCiAgICAgICAgdWludCB0b3RhbEFtb3VudFZlc3RlZCA9IGNhbGN1bGF0ZVRvdGFsQW1vdW50VmVzdGVkKHZlc3RpbmdTY2hlZHVsZSk7CiAgICAgICAgdWludCBhbW91bnRXaXRoZHJhd2FibGUgPSB0b3RhbEFtb3VudFZlc3RlZC5zdWIodmVzdGluZ1NjaGVkdWxlLmFtb3VudFdpdGhkcmF3bik7CiAgICAgICAgdmVzdGluZ1NjaGVkdWxlLmFtb3VudFdpdGhkcmF3biA9IHRvdGFsQW1vdW50VmVzdGVkOwoKICAgICAgICBpZiAoYW1vdW50V2l0aGRyYXdhYmxlID4gMCkgewogICAgICAgICAgICBjYW5XaXRoZHJhdyh2ZXN0aW5nU2NoZWR1bGUsIGFtb3VudFdpdGhkcmF3YWJsZSk7CiAgICAgICAgICAgIHJlcXVpcmUoIHZlc3RpbmdUb2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCBhbW91bnRXaXRoZHJhd2FibGUpICk7CiAgICAgICAgICAgIFdpdGhkcmF3KG1zZy5zZW5kZXIsIGFtb3VudFdpdGhkcmF3YWJsZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVRvdGFsQW1vdW50VmVzdGVkKFZlc3RpbmdTY2hlZHVsZSBfdmVzdGluZ1NjaGVkdWxlKQogICAgICAgIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludCBfYW1vdW50VmVzdGVkKQogICAgewogICAgICAgIC8vIElmIGl0J3MgcGFzdCB0aGUgZW5kIHRpbWUsIHRoZSB3aG9sZSBhbW91bnQgaXMgYXZhaWxhYmxlLgogICAgICAgIGlmIChub3cgPj0gX3Zlc3RpbmdTY2hlZHVsZS5lbmRUaW1lc3RhbXApIHsKICAgICAgICAgICAgcmV0dXJuIF92ZXN0aW5nU2NoZWR1bGUudG90YWxBbW91bnQ7CiAgICAgICAgfQoKICAgICAgICAvLyBPdGhlcndpc2UsIG1hdGgKICAgICAgICB1aW50IGR1cmF0aW9uU2luY2VTdGFydCA9IG5vdy5zdWIoX3Zlc3RpbmdTY2hlZHVsZS5zdGFydFRpbWVzdGFtcCk7CiAgICAgICAgdWludCB0b3RhbFZlc3RpbmdUaW1lID0gU2FmZU1hdGguc3ViKF92ZXN0aW5nU2NoZWR1bGUuZW5kVGltZXN0YW1wLCBfdmVzdGluZ1NjaGVkdWxlLnN0YXJ0VGltZXN0YW1wKTsKICAgICAgICB1aW50IHZlc3RlZEFtb3VudCA9IFNhZmVNYXRoLmRpdigKICAgICAgICAgICAgU2FmZU1hdGgubXVsKGR1cmF0aW9uU2luY2VTdGFydCwgX3Zlc3RpbmdTY2hlZHVsZS50b3RhbEFtb3VudCksCiAgICAgICAgICAgIHRvdGFsVmVzdGluZ1RpbWUKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdmVzdGVkQW1vdW50OwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyB0byBzZWUgaWYgdGhlIGFtb3VudCBpcyBncmVhdGVyIHRoYW4gdGhlIHRvdGFsIGFtb3VudCBkaXZpZGVkIGJ5IHRoZSBsb2NrIHBlcmlvZHMuCiAgICBmdW5jdGlvbiBjYW5XaXRoZHJhdyhWZXN0aW5nU2NoZWR1bGUgX3Zlc3RpbmdTY2hlZHVsZSwgdWludCBfYW1vdW50V2l0aGRyYXdhYmxlKQogICAgICAgIGludGVybmFsIHZpZXcKICAgIHsKICAgICAgICB1aW50IGxvY2tQZXJpb2RzID0gKF92ZXN0aW5nU2NoZWR1bGUuZW5kVGltZXN0YW1wLnN1YihfdmVzdGluZ1NjaGVkdWxlLnN0YXJ0VGltZXN0YW1wKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRpdihfdmVzdGluZ1NjaGVkdWxlLmxvY2tQZXJpb2QpOwoKICAgICAgICBpZiAobm93IDwgX3Zlc3RpbmdTY2hlZHVsZS5lbmRUaW1lc3RhbXApIHsKICAgICAgICAgICAgcmVxdWlyZSggX2Ftb3VudFdpdGhkcmF3YWJsZSA+PSBfdmVzdGluZ1NjaGVkdWxlLnRvdGFsQW1vdW50LmRpdihsb2NrUGVyaW9kcykgKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqIEFETUlOIEZVTkNUSU9OUyAqLwoKICAgIGZ1bmN0aW9uIHJldm9rZVNjaGVkdWxlKGFkZHJlc3MgX2FkZHJlc3NUb1Jldm9rZSwgYWRkcmVzcyBfYWRkcmVzc1RvUmVmdW5kKQogICAgICAgIHB1YmxpYyBvbmx5T3duZXIKICAgIHsKICAgICAgICBWZXN0aW5nU2NoZWR1bGUgc3RvcmFnZSB2ZXN0aW5nU2NoZWR1bGUgPSB2ZXN0aW5nU2NoZWR1bGVzW19hZGRyZXNzVG9SZXZva2VdOwoKICAgICAgICByZXF1aXJlKCB2ZXN0aW5nU2NoZWR1bGUuaXNDb25maXJtZWQgPT0gdHJ1ZSApOwogICAgICAgIHJlcXVpcmUoIF9hZGRyZXNzVG9SZWZ1bmQgIT0gMHgwICk7CgogICAgICAgIHVpbnQgYW1vdW50V2l0aGRyYXdhYmxlOwogICAgICAgIHVpbnQgYW1vdW50UmVmdW5kYWJsZTsKCiAgICAgICAgaWYgKG5vdyA8IHZlc3RpbmdTY2hlZHVsZS5jbGlmZlRpbWVzdGFtcCkgewogICAgICAgICAgICAvLyBWZXN0aW5nIGhhc24ndCBzdGFydGVkIHlldCwgcmV0dXJuIHRoZSB3aG9sZSBhbW91bnQKICAgICAgICAgICAgYW1vdW50UmVmdW5kYWJsZSA9IHZlc3RpbmdTY2hlZHVsZS50b3RhbEFtb3VudDsKCiAgICAgICAgICAgIGRlbGV0ZSB2ZXN0aW5nU2NoZWR1bGVzW19hZGRyZXNzVG9SZXZva2VdOwogICAgICAgICAgICByZXF1aXJlKCB2ZXN0aW5nVG9rZW4udHJhbnNmZXIoX2FkZHJlc3NUb1JlZnVuZCwgYW1vdW50UmVmdW5kYWJsZSkgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBWZXN0aW5nIGhhcyBzdGFydGVkLCBuZWVkIHRvIGZpZ3VyZSBvdXQgaG93IG11Y2ggaGFzbid0IGJlZW4gdmVzdGVkIHlldAogICAgICAgICAgICB1aW50IHRvdGFsQW1vdW50VmVzdGVkID0gY2FsY3VsYXRlVG90YWxBbW91bnRWZXN0ZWQodmVzdGluZ1NjaGVkdWxlKTsKICAgICAgICAgICAgYW1vdW50V2l0aGRyYXdhYmxlID0gdG90YWxBbW91bnRWZXN0ZWQuc3ViKHZlc3RpbmdTY2hlZHVsZS5hbW91bnRXaXRoZHJhd24pOwogICAgICAgICAgICBhbW91bnRSZWZ1bmRhYmxlID0gdG90YWxBbW91bnRWZXN0ZWQuc3ViKHZlc3RpbmdTY2hlZHVsZS5hbW91bnRXaXRoZHJhd24pOwoKICAgICAgICAgICAgZGVsZXRlIHZlc3RpbmdTY2hlZHVsZXNbX2FkZHJlc3NUb1Jldm9rZV07CiAgICAgICAgICAgIHJlcXVpcmUoIHZlc3RpbmdUb2tlbi50cmFuc2ZlcihfYWRkcmVzc1RvUmV2b2tlLCBhbW91bnRXaXRoZHJhd2FibGUpICk7CiAgICAgICAgICAgIHJlcXVpcmUoIHZlc3RpbmdUb2tlbi50cmFuc2ZlcihfYWRkcmVzc1RvUmVmdW5kLCBhbW91bnRSZWZ1bmRhYmxlKSApOwogICAgICAgIH0KCiAgICAgICAgVmVzdGluZ1Jldm9rZWQoX2FkZHJlc3NUb1Jldm9rZSwgYW1vdW50V2l0aGRyYXdhYmxlLCBhbW91bnRSZWZ1bmRhYmxlKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGFuZ2VzIHRoZSBhZGRyZXNzIGZvciBhIHNjaGVkdWxlIGluIHRoZSBjYXNlIG9mIGxvc3Qga2V5cyBvciBvdGhlciBlbWVyZ2VuY3kgZXZlbnRzLgogICAgZnVuY3Rpb24gY2hhbmdlVmVzdGluZ0FkZHJlc3MoYWRkcmVzcyBfb2xkQWRkcmVzcywgYWRkcmVzcyBfbmV3QWRkcmVzcykKICAgICAgICBwdWJsaWMgb25seU93bmVyCiAgICB7CiAgICAgICAgVmVzdGluZ1NjaGVkdWxlIHN0b3JhZ2UgdmVzdGluZ1NjaGVkdWxlID0gdmVzdGluZ1NjaGVkdWxlc1tfb2xkQWRkcmVzc107CgogICAgICAgIHJlcXVpcmUoIHZlc3RpbmdTY2hlZHVsZS5pc0NvbmZpcm1lZCA9PSB0cnVlICk7CiAgICAgICAgcmVxdWlyZSggX25ld0FkZHJlc3MgIT0gMHgwICk7CiAgICAgICAgcmVxdWlyZSggdmVzdGluZ1NjaGVkdWxlc1tfbmV3QWRkcmVzc10uZGVwb3NpdG9yID09IDB4MCApOwoKICAgICAgICBWZXN0aW5nU2NoZWR1bGUgbWVtb3J5IG5ld1Zlc3RpbmdTY2hlZHVsZSA9IHZlc3RpbmdTY2hlZHVsZTsKICAgICAgICBkZWxldGUgdmVzdGluZ1NjaGVkdWxlc1tfb2xkQWRkcmVzc107CiAgICAgICAgdmVzdGluZ1NjaGVkdWxlc1tfbmV3QWRkcmVzc10gPSBuZXdWZXN0aW5nU2NoZWR1bGU7CgogICAgICAgIFZlc3RpbmdBZGRyZXNzQ2hhbmdlZChfb2xkQWRkcmVzcywgX25ld0FkZHJlc3MpOwogICAgfQoKICAgIGV2ZW50IFZlc3RpbmdTY2hlZHVsZVJlZ2lzdGVyZWQoCiAgICAgICAgYWRkcmVzcyByZWdpc3RlcmVkQWRkcmVzcywKICAgICAgICBhZGRyZXNzIGRlcG9zaXRvciwKICAgICAgICB1aW50IHN0YXJ0VGltZXN0YW1wLAogICAgICAgIHVpbnQgY2xpZmZUaW1lc3RhbXAsCiAgICAgICAgdWludCBsb2NrUGVyaW9kLAogICAgICAgIHVpbnQgZW5kVGltZXN0YW1wLAogICAgICAgIHVpbnQgdG90YWxBbW91bnQKICAgICk7CiAgICBldmVudCBWZXN0aW5nU2NoZWR1bGVDb25maXJtZWQoCiAgICAgICAgYWRkcmVzcyByZWdpc3RlcmVkQWRkcmVzcywKICAgICAgICBhZGRyZXNzIGRlcG9zaXRvciwKICAgICAgICB1aW50IHN0YXJ0VGltZXN0YW1wLAogICAgICAgIHVpbnQgY2xpZmZUaW1lc3RhbXAsCiAgICAgICAgdWludCBsb2NrUGVyaW9kLAogICAgICAgIHVpbnQgZW5kVGltZXN0YW1wLAogICAgICAgIHVpbnQgdG90YWxBbW91bnQKICAgICk7CiAgICBldmVudCBXaXRoZHJhdyhhZGRyZXNzIHJlZ2lzdGVyZWRBZGRyZXNzLCB1aW50IGFtb3VudFdpdGhkcmF3bik7CiAgICBldmVudCBWZXN0aW5nUmV2b2tlZChhZGRyZXNzIHJldm9rZWRBZGRyZXNzLCB1aW50IGFtb3VudFdpdGhkcmF3biwgdWludCBhbW91bnRSZWZ1bmRlZCk7CiAgICBldmVudCBWZXN0aW5nQWRkcmVzc0NoYW5nZWQoYWRkcmVzcyBvbGRBZGRyZXNzLCBhZGRyZXNzIG5ld0FkZHJlc3MpOwp9CgoKLy8gVmVzdGluZyBTY2hlZHVsZXMKLy8gLi4uLi4uLi4uLi4uLi4uLi4uLgovLyBUZWFtIHRva2VucyB3aWxsIGJlIHZlc3RlZCBvdmVyIDE4IG1vbnRocyB3aXRoIGEgMS8zIHZlc3RlZCBhZnRlciA2IG1vbnRocywgMS8zIHZlc3RlZCBhZnRlciAxMiBtb250aHMgYW5kIDEvMyB2ZXN0ZWQgCi8vIGFmdGVyIDE4IG1vbnRocy4gCi8vIFBhcnRuZXJzaGlwIGFuZCBEZXZlbG9wbWVudCArIFNoYXJpbmcgQm91bnRpZXMgKyBSZXNlcnZlcyB0b2tlbnMgd2lsbCBiZSB2ZXN0ZWQgb3ZlciB0d28geWVhcnMgd2l0aCAxLzI0IAovLyBhdmFpbGFibGUgdXBmcm9udCBhbmQgMS8yNCBhdmFpbGFibGUgZWFjaCBtb250aCBhZnRlcgoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CmNvbnRyYWN0IFZ5cmFsU2FsZSBpcyBPd25hYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IE1JTl9DT05UUklCVVRJT04gPSAxIGV0aGVyOwoKICAgIGVudW0gUGhhc2UgewogICAgICAgIERlcGxveWVkLCAgICAgICAvLzAKICAgICAgICBJbml0aWFsaXplZCwgICAgLy8xCiAgICAgICAgUHJlc2FsZSwgICAgICAgIC8vMgogICAgICAgIEZyZWV6ZSwgICAgICAgICAvLzMKICAgICAgICBSZWFkeSwgICAgICAgICAgLy80CiAgICAgICAgQ3Jvd2RzYWxlLCAgICAgIC8vNQogICAgICAgIEZpbmFsaXplZCwgICAgICAvLzYKICAgICAgICBEZWNvbWlzc2lvbmVkICAgLy83CiAgICB9CgogICAgUGhhc2UgcHVibGljIHBoYXNlOwoKICAgIC8qKgogICAgICogUFJFU0FMRSBQQVJBTVMKICAgICAqLwoKICAgIHVpbnQgcHVibGljIHByZXNhbGVTdGFydFRpbWVzdGFtcDsKCiAgICB1aW50IHB1YmxpYyBwcmVzYWxlRW5kVGltZXN0YW1wOwoKICAgIHVpbnQgcHVibGljIHByZXNhbGVSYXRlOwoKICAgIHVpbnQgcHVibGljIHByZXNhbGVDYXA7CgogICAgYm9vbCBwdWJsaWMgcHJlc2FsZUNhcFJlYWNoZWQ7CgogICAgdWludCBwdWJsaWMgc29sZFByZXNhbGU7CgogICAgLyoqCiAgICAgKiBDUk9XRFNBTEUgUEFSQU1TCiAgICAgKi8KCiAgICB1aW50IHB1YmxpYyBzYWxlU3RhcnRUaW1lc3RhbXA7CgogICAgdWludCBwdWJsaWMgc2FsZUVuZFRpbWVzdGFtcDsKCiAgICB1aW50IHB1YmxpYyBzYWxlUmF0ZTsKCiAgICB1aW50IHB1YmxpYyBzYWxlQ2FwOwoKICAgIGJvb2wgcHVibGljIHNhbGVDYXBSZWFjaGVkOwoKICAgIHVpbnQgcHVibGljIHNvbGRTYWxlOwoKICAgIC8qKgogICAgICogR0xPQkFMIFBBUkFNUwogICAgICovCiAgICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CgogICAgYWRkcmVzcyBwdWJsaWMgdmVzdGluZ1dhbGxldDsKCiAgICBTaGFyZSBwdWJsaWMgc2hhcmVUb2tlbjsKCiAgICBDYW1wYWlnbiBwdWJsaWMgY2FtcGFpZ247CgogICAgRGF0ZVRpbWUgcHVibGljIGRhdGVUaW1lOwoKICAgIGJvb2wgcHVibGljIHZlc3RpbmdSZWdpc3RlcmVkOwoKICAgIC8qKgogICAgICogVG9rZW4gYW5kIGJ1ZGdldCBhbGxvY2F0aW9uIGNvbnN0YW50cwogICAgICovCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBUT1RBTF9TVVBQTFkgPSA3Nzc3Nzc3NzcgKiAoMTAgKiogdWludCgxOCkpOwoKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFRFQU0gPSBUT1RBTF9TVVBQTFkuZGl2KDcpOwoKICAgIHVpbnQgcHVibGljIGNvbnN0YW50IFBBUlRORVJTID0gVE9UQUxfU1VQUExZLmRpdig3KTsKCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBWWVJBTF9SRVdBUkRTID0gVE9UQUxfU1VQUExZLmRpdig3KS5tdWwoMik7CgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgU0FMRV9BTExPQ0FUSU9OID0gVE9UQUxfU1VQUExZLmRpdig3KS5tdWwoMyk7CgogICAgLyoqCiAgICAgKiBNT0RJRklFUlMKICAgICAqLwoKICAgIG1vZGlmaWVyIGluUGhhc2UoUGhhc2UgX3BoYXNlKSB7CiAgICAgICAgcmVxdWlyZShwaGFzZSA9PSBfcGhhc2UpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY2FuQnV5KFBoYXNlIF9waGFzZSkgewogICAgICAgIHJlcXVpcmUocGhhc2UgPT0gUGhhc2UuUHJlc2FsZSB8fCBwaGFzZSA9PSBQaGFzZS5Dcm93ZHNhbGUpOwoKICAgICAgICBpZiAoX3BoYXNlID09IFBoYXNlLlByZXNhbGUpIHsKICAgICAgICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPj0gcHJlc2FsZVN0YXJ0VGltZXN0YW1wKTsKICAgICAgICB9CiAgICAgICAgaWYgKF9waGFzZSA9PSBQaGFzZS5Dcm93ZHNhbGUpIHsKICAgICAgICAgICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPj0gc2FsZVN0YXJ0VGltZXN0YW1wKTsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgICAgIHJlcXVpcmUoIUhBTFQpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBQSEFTRVMKICAgICAqLwoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSBWeXJhbCBzYWxlcy4KICAgICAqLwogICAgZnVuY3Rpb24gVnlyYWxTYWxlKAogICAgICAgIGFkZHJlc3MgX3NoYXJlLAogICAgICAgIGFkZHJlc3MgX2RhdGV0aW1lCiAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcGhhc2UgPSBQaGFzZS5EZXBsb3llZDsKCiAgICAgICAgc2hhcmVUb2tlbiA9IFNoYXJlKF9zaGFyZSk7CiAgICAgICAgZGF0ZVRpbWUgPSBEYXRlVGltZShfZGF0ZXRpbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRQcmVzYWxlKAogICAgICAgIGFkZHJlc3MgX3dhbGxldCwKICAgICAgICB1aW50IF9wcmVzYWxlU3RhcnRUaW1lc3RhbXAsCiAgICAgICAgdWludCBfcHJlc2FsZUVuZFRpbWVzdGFtcCwKICAgICAgICB1aW50IF9wcmVzYWxlQ2FwLAogICAgICAgIHVpbnQgX3ByZXNhbGVSYXRlCiAgICApCiAgICAgICAgaW5QaGFzZShQaGFzZS5EZXBsb3llZCkKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbCByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3ByZXNhbGVTdGFydFRpbWVzdGFtcCA+PSBibG9jay50aW1lc3RhbXApOwogICAgICAgIHJlcXVpcmUoX3ByZXNhbGVFbmRUaW1lc3RhbXAgPiBfcHJlc2FsZVN0YXJ0VGltZXN0YW1wKTsKICAgICAgICByZXF1aXJlKF9wcmVzYWxlQ2FwIDwgU0FMRV9BTExPQ0FUSU9OLmRpdihfcHJlc2FsZVJhdGUpKTsKCiAgICAgICAgLy8vIENhbXBhaWduIG11c3QgYmUgc2V0IGZpcnN0LgogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhjYW1wYWlnbikgIT0gMHgwKTsKCiAgICAgICAgd2FsbGV0ID0gX3dhbGxldDsKICAgICAgICBwcmVzYWxlU3RhcnRUaW1lc3RhbXAgPSBfcHJlc2FsZVN0YXJ0VGltZXN0YW1wOwogICAgICAgIHByZXNhbGVFbmRUaW1lc3RhbXAgPSBfcHJlc2FsZUVuZFRpbWVzdGFtcDsKICAgICAgICBwcmVzYWxlQ2FwID0gX3ByZXNhbGVDYXA7CiAgICAgICAgcHJlc2FsZVJhdGUgPSBfcHJlc2FsZVJhdGU7CgogICAgICAgIHNoYXJlVG9rZW4udHJhbnNmZXIoYWRkcmVzcyhjYW1wYWlnbiksIFZZUkFMX1JFV0FSRFMpOwoKICAgICAgICBwaGFzZSA9IFBoYXNlLkluaXRpYWxpemVkOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBTdGVwIDEuNSAtIFJlZ2lzdGVyIFZlc3RpbmcgU2NoZWR1bGVzCgogICAgZnVuY3Rpb24gc3RhcnRQcmVzYWxlKCkKICAgICAgICBpblBoYXNlKFBoYXNlLkluaXRpYWxpemVkKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcGhhc2UgPSBQaGFzZS5QcmVzYWxlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGVuZFByZXNhbGUoKQogICAgICAgIGluUGhhc2UoUGhhc2UuUHJlc2FsZSkKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbCByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHBoYXNlID0gUGhhc2UuRnJlZXplOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRTYWxlKAogICAgICAgIHVpbnQgX3NhbGVTdGFydFRpbWVzdGFtcCwKICAgICAgICB1aW50IF9zYWxlRW5kVGltZXN0YW1wLAogICAgICAgIHVpbnQgX3NhbGVSYXRlCiAgICApCiAgICAgICAgaW5QaGFzZShQaGFzZS5GcmVlemUpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9zYWxlU3RhcnRUaW1lc3RhbXAgPj0gYmxvY2sudGltZXN0YW1wKTsKICAgICAgICByZXF1aXJlKF9zYWxlRW5kVGltZXN0YW1wID4gX3NhbGVTdGFydFRpbWVzdGFtcCk7CgogICAgICAgIHNhbGVTdGFydFRpbWVzdGFtcCA9IF9zYWxlU3RhcnRUaW1lc3RhbXA7CiAgICAgICAgc2FsZUVuZFRpbWVzdGFtcCA9IF9zYWxlRW5kVGltZXN0YW1wOwogICAgICAgIHNhbGVSYXRlID0gX3NhbGVSYXRlOwogICAgICAgIHNhbGVDYXAgPSAoU0FMRV9BTExPQ0FUSU9OLmRpdihfc2FsZVJhdGUpKS5zdWIocHJlc2FsZUNhcCk7CiAgICAgICAgcGhhc2UgPSBQaGFzZS5SZWFkeTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdGFydFNhbGUoKQogICAgICAgIGluUGhhc2UoUGhhc2UuUmVhZHkpCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBwaGFzZSA9IFBoYXNlLkNyb3dkc2FsZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5hbGl6ZVNhbGUoKQogICAgICAgIGluUGhhc2UoUGhhc2UuQ3Jvd2RzYWxlKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcGhhc2UgPSBQaGFzZS5GaW5hbGl6ZWQ7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVjb21pc3Npb24oKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcGhhc2UgPSBQaGFzZS5EZWNvbWlzc2lvbmVkOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKiBCVVkgVE9LRU5TICovCgogICAgZnVuY3Rpb24oKQogICAgICAgIHN0b3BJbkVtZXJnZW5jeQogICAgICAgIHB1YmxpYyBwYXlhYmxlCiAgICB7CiAgICAgICAgaWYgKHBoYXNlID09IFBoYXNlLlByZXNhbGUpIHsKICAgICAgICAgICAgYnV5UHJlc2FsZSgweDApOwogICAgICAgIH0gZWxzZSBpZiAocGhhc2UgPT0gUGhhc2UuQ3Jvd2RzYWxlKSB7CiAgICAgICAgICAgIGJ1eVNhbGUoMHgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYnV5UHJlc2FsZShhZGRyZXNzIF9yZWZlcnJlcikKICAgICAgICBpblBoYXNlKFBoYXNlLlByZXNhbGUpCiAgICAgICAgY2FuQnV5KFBoYXNlLlByZXNhbGUpCiAgICAgICAgc3RvcEluRW1lcmdlbmN5CiAgICAgICAgcHVibGljIHBheWFibGUKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBNSU5fQ09OVFJJQlVUSU9OKTsKICAgICAgICByZXF1aXJlKCFwcmVzYWxlQ2FwUmVhY2hlZCk7CgogICAgICAgIHVpbnQgY29udHJpYnV0aW9uID0gbXNnLnZhbHVlOwogICAgICAgIHVpbnQgcHVyY2hhc2VkID0gY29udHJpYnV0aW9uLm11bChwcmVzYWxlUmF0ZSk7CiAgICAgICAgdWludCB0b3RhbFNvbGQgPSBzb2xkUHJlc2FsZS5hZGQoY29udHJpYnV0aW9uKTsKCiAgICAgICAgdWludCBleGNlc3M7CgogICAgICAgIC8vIGV4dHJhIGV0aGVyIHNlbnQKICAgICAgICBpZiAodG90YWxTb2xkID49IHByZXNhbGVDYXApIHsKICAgICAgICAgICAgZXhjZXNzID0gdG90YWxTb2xkLnN1YihwcmVzYWxlQ2FwKTsKICAgICAgICAgICAgaWYgKGV4Y2VzcyA+IDApIHsKICAgICAgICAgICAgICAgIHB1cmNoYXNlZCA9IHB1cmNoYXNlZC5zdWIoZXhjZXNzLm11bChwcmVzYWxlUmF0ZSkpOwogICAgICAgICAgICAgICAgY29udHJpYnV0aW9uID0gY29udHJpYnV0aW9uLnN1YihleGNlc3MpOwogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHByZXNhbGVDYXBSZWFjaGVkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHNvbGRQcmVzYWxlID0gdG90YWxTb2xkOwogICAgICAgIHdhbGxldC50cmFuc2Zlcihjb250cmlidXRpb24pOwogICAgICAgIHNoYXJlVG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgcHVyY2hhc2VkKTsKCiAgICAgICAgLy8vIENhbGN1bGF0ZSByZXdhcmQgYW5kIHNlbmQgaXQgZnJvbSBjYW1wYWlnbi4KICAgICAgICB1aW50IHJld2FyZCA9IFByZXNhbGVCb251c2VzLnByZXNhbGVCb251c0FwcGxpY2F0b3IocHVyY2hhc2VkLCBhZGRyZXNzKGRhdGVUaW1lKSk7CiAgICAgICAgY2FtcGFpZ24uc2VuZFJld2FyZChtc2cuc2VuZGVyLCByZXdhcmQpOwoKICAgICAgICBpZiAoX3JlZmVycmVyICE9IGFkZHJlc3MoMHgwKSkgewogICAgICAgICAgICB1aW50IHJlZmVycmFsUmV3YXJkID0gY2FtcGFpZ24uam9pbihfcmVmZXJyZXIsIG1zZy5zZW5kZXIsIHB1cmNoYXNlZCk7CiAgICAgICAgICAgIGNhbXBhaWduLnNlbmRSZXdhcmQoX3JlZmVycmVyLCByZWZlcnJhbFJld2FyZCk7CiAgICAgICAgICAgIExvZ1JlZmVycmFsKF9yZWZlcnJlciwgbXNnLnNlbmRlciwgcmVmZXJyYWxSZXdhcmQpOwogICAgICAgIH0KCiAgICAgICAgTG9nQ29udHJpYnV0aW9uKHBoYXNlLCBtc2cuc2VuZGVyLCBjb250cmlidXRpb24pOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eVNhbGUoYWRkcmVzcyBfcmVmZXJyZXIpCiAgICAgICAgaW5QaGFzZShQaGFzZS5Dcm93ZHNhbGUpCiAgICAgICAgY2FuQnV5KFBoYXNlLkNyb3dkc2FsZSkKICAgICAgICBzdG9wSW5FbWVyZ2VuY3kKICAgICAgICBwdWJsaWMgcGF5YWJsZQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IE1JTl9DT05UUklCVVRJT04pOwogICAgICAgIHJlcXVpcmUoIXNhbGVDYXBSZWFjaGVkKTsKCiAgICAgICAgdWludCBjb250cmlidXRpb24gPSBtc2cudmFsdWU7CiAgICAgICAgdWludCBwdXJjaGFzZWQgPSBjb250cmlidXRpb24ubXVsKHNhbGVSYXRlKTsKICAgICAgICB1aW50IHRvdGFsU29sZCA9IHNvbGRTYWxlLmFkZChjb250cmlidXRpb24pOwoKICAgICAgICB1aW50IGV4Y2VzczsKCiAgICAgICAgLy8gZXh0cmEgZXRoZXIgc2VudAogICAgICAgIGlmICh0b3RhbFNvbGQgPj0gc2FsZUNhcCkgewogICAgICAgICAgICBleGNlc3MgPSB0b3RhbFNvbGQuc3ViKHNhbGVDYXApOwogICAgICAgICAgICBpZiAoZXhjZXNzID4gMCkgewogICAgICAgICAgICAgICAgcHVyY2hhc2VkID0gcHVyY2hhc2VkLnN1YihleGNlc3MubXVsKHNhbGVSYXRlKSk7CiAgICAgICAgICAgICAgICBjb250cmlidXRpb24gPSBjb250cmlidXRpb24uc3ViKGV4Y2Vzcyk7CiAgICAgICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV4Y2Vzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2FsZUNhcFJlYWNoZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgc29sZFNhbGUgPSB0b3RhbFNvbGQ7CiAgICAgICAgd2FsbGV0LnRyYW5zZmVyKGNvbnRyaWJ1dGlvbik7CiAgICAgICAgc2hhcmVUb2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCBwdXJjaGFzZWQpOwoKICAgICAgICBpZiAoX3JlZmVycmVyICE9IGFkZHJlc3MoMHgwKSkgewogICAgICAgICAgICB1aW50IHJlZmVycmFsUmV3YXJkID0gY2FtcGFpZ24uam9pbihfcmVmZXJyZXIsIG1zZy5zZW5kZXIsIHB1cmNoYXNlZCk7CiAgICAgICAgICAgIGNhbXBhaWduLnNlbmRSZXdhcmQoX3JlZmVycmVyLCByZWZlcnJhbFJld2FyZCk7CiAgICAgICAgICAgIExvZ1JlZmVycmFsKF9yZWZlcnJlciwgbXNnLnNlbmRlciwgcmVmZXJyYWxSZXdhcmQpOwogICAgICAgIH0KCiAgICAgICAgTG9nQ29udHJpYnV0aW9uKHBoYXNlLCBtc2cuc2VuZGVyLCBjb250cmlidXRpb24pOwogICAgfQoKICAgIC8qKgogICAgICogQURNSU4gU0VUVEVSUwogICAgICovCgogICAgZnVuY3Rpb24gc2V0UHJlc2FsZVBhcmFtcygKICAgICAgICB1aW50IF9wcmVzYWxlU3RhcnRUaW1lc3RhbXAsCiAgICAgICAgdWludCBfcHJlc2FsZUVuZFRpbWVzdGFtcCwKICAgICAgICB1aW50IF9wcmVzYWxlUmF0ZSwKICAgICAgICB1aW50IF9wcmVzYWxlQ2FwCiAgICApCiAgICAgICAgb25seU93bmVyCiAgICAgICAgaW5QaGFzZShQaGFzZS5Jbml0aWFsaXplZCkKICAgICAgICBleHRlcm5hbCByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX3ByZXNhbGVTdGFydFRpbWVzdGFtcCA+PSBibG9jay50aW1lc3RhbXApOwogICAgICAgIHJlcXVpcmUoX3ByZXNhbGVFbmRUaW1lc3RhbXAgPiBfcHJlc2FsZVN0YXJ0VGltZXN0YW1wKTsKICAgICAgICByZXF1aXJlKF9wcmVzYWxlQ2FwIDwgU0FMRV9BTExPQ0FUSU9OLmRpdihfcHJlc2FsZVJhdGUpKTsKCiAgICAgICAgcHJlc2FsZVN0YXJ0VGltZXN0YW1wID0gX3ByZXNhbGVTdGFydFRpbWVzdGFtcDsKICAgICAgICBwcmVzYWxlRW5kVGltZXN0YW1wID0gX3ByZXNhbGVFbmRUaW1lc3RhbXA7CiAgICAgICAgcHJlc2FsZVJhdGUgPSBfcHJlc2FsZVJhdGU7CiAgICAgICAgcHJlc2FsZUNhcCA9IF9wcmVzYWxlQ2FwOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENyb3dkc2FsZVBhcmFtcygKICAgICAgICB1aW50IF9zYWxlU3RhcnRUaW1lc3RhbXAsCiAgICAgICAgdWludCBfc2FsZUVuZFRpbWVzdGFtcCwKICAgICAgICB1aW50IF9zYWxlUmF0ZQogICAgKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGluUGhhc2UoUGhhc2UuUmVhZHkpCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9zYWxlU3RhcnRUaW1lc3RhbXAgPj0gYmxvY2sudGltZXN0YW1wKTsKICAgICAgICByZXF1aXJlKF9zYWxlRW5kVGltZXN0YW1wID4gX3NhbGVTdGFydFRpbWVzdGFtcCk7CgogICAgICAgIHNhbGVTdGFydFRpbWVzdGFtcCA9IF9zYWxlU3RhcnRUaW1lc3RhbXA7CiAgICAgICAgc2FsZUVuZFRpbWVzdGFtcCA9IF9zYWxlRW5kVGltZXN0YW1wOwogICAgICAgIHNhbGVSYXRlID0gX3NhbGVSYXRlOwogICAgICAgIHNhbGVDYXAgPSAoU0FMRV9BTExPQ0FUSU9OLmRpdihfc2FsZVJhdGUpKS5zdWIocHJlc2FsZUNhcCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmV3YXJkQmVuZWZpY2lhcnkoCiAgICAgICAgYWRkcmVzcyBfYmVuZWZpY2lhcnksCiAgICAgICAgdWludCBfdG9rZW5zCiAgICApCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gY2FtcGFpZ24uc2VuZFJld2FyZChfYmVuZWZpY2lhcnksIF90b2tlbnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVUaW1lbG9ja2VkVG9rZW5zKAogICAgICAgIGFkZHJlc3MgX2JlbmVmaWNpYXJ5LAogICAgICAgIHVpbnQgX3Rva2VucwogICAgKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIHNoYXJlVG9rZW4udHJhbnNmZXIoX2JlbmVmaWNpYXJ5LCBfdG9rZW5zKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZXBsYWNlRGVjb21pc3Npb25lZChhZGRyZXNzIF9uZXdBZGRyZXNzKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGluUGhhc2UoUGhhc2UuRGVjb21pc3Npb25lZCkKICAgICAgICBleHRlcm5hbCByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgYWxsVG9rZW5zID0gc2hhcmVUb2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgc2hhcmVUb2tlbi50cmFuc2ZlcihfbmV3QWRkcmVzcywgYWxsVG9rZW5zKTsKICAgICAgICBjYW1wYWlnbi50cmFuc2Zlck93bmVyc2hpcChfbmV3QWRkcmVzcyk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldENhbXBhaWduKAogICAgICAgIGFkZHJlc3MgX25ld0NhbXBhaWduCiAgICApCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoY2FtcGFpZ24pICE9IF9uZXdDYW1wYWlnbiAmJiBfbmV3Q2FtcGFpZ24gIT0gMHgwKTsKICAgICAgICBjYW1wYWlnbiA9IENhbXBhaWduKF9uZXdDYW1wYWlnbik7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZlc3RpbmcoCiAgICAgICAgYWRkcmVzcyBfbmV3VmVzdGluZwogICAgKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKHZlc3RpbmdXYWxsZXQpICE9IF9uZXdWZXN0aW5nICYmIF9uZXdWZXN0aW5nICE9IDB4MCk7CiAgICAgICAgdmVzdGluZ1dhbGxldCA9IFZlc3RpbmcoX25ld1Zlc3RpbmcpOwogICAgICAgIHNoYXJlVG9rZW4uYXBwcm92ZShhZGRyZXNzKHZlc3RpbmdXYWxsZXQpLCBURUFNLmFkZChQQVJUTkVSUykpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEVNRVJHRU5DWSBTV0lUQ0gKICAgICAqLwogICAgYm9vbCBwdWJsaWMgSEFMVCA9IGZhbHNlOwoKICAgIGZ1bmN0aW9uIHRvZ2dsZUhBTFQoYm9vbCBfb24pCiAgICAgICAgb25seU93bmVyCiAgICAgICAgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBIQUxUID0gX29uOwogICAgICAgIHJldHVybiBIQUxUOwogICAgfQoKICAgIC8qKgogICAgICogTE9HUwogICAgICovCiAgICBldmVudCBMb2dDb250cmlidXRpb24oUGhhc2UgcGhhc2UsIGFkZHJlc3MgYnV5ZXIsIHVpbnQgY29udHJpYnV0aW9uKTsKCiAgICBldmVudCBMb2dSZWZlcnJhbChhZGRyZXNzIHJlZmVycmVyLCBhZGRyZXNzIGludml0ZWUsIHVpbnQgcmVmZXJyYWxSZXdhcmQpOwp9'.
	

]
