Class {
	#name : #SRT0a0e40db3bc35ea2242d4475a67454078f83a9bf,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0a0e40db3bc35ea2242d4475a67454078f83a9bf >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQXV0aG9yZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogRW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4KICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wgCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuIAogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKiogCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgaW50ZXJuYWwgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4gCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLiAKICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8qKgogKiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLgogKgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBldmVudCBIYWx0ZWQoYm9vbCBoYWx0ZWQpOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZSghaGFsdGVkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5SW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZShoYWx0ZWQpOwogICAgXzsKICB9CgogIC8vIGNhbGxlZCBieSB0aGUgb3duZXIgb24gZW1lcmdlbmN5LCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgZnVuY3Rpb24gaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBoYWx0ZWQgPSB0cnVlOwogICAgSGFsdGVkKHRydWUpOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgICBIYWx0ZWQoZmFsc2UpOwogIH0KfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCi8qKgogKiBPcmlnaW5hbGx5IGZyb20gIGh0dHBzOi8vZ2l0aHViLmNvbS9PcGVuWmVwcGVsaW4vemVwcGVsaW4tc29saWRpdHkKICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKLyoqCiAqIE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MKICovCmxpYnJhcnkgU2FmZU1hdGggewogIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cn0KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vT3BlblplcHBlbGluL3plcHBlbGluLXNvbGlkaXR5CiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIEludGVyZmFjZSBmb3IgdGhlIHN0YW5kYXJkIHRva2VuLgogKiBCYXNlZCBvbiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9ibG9iL21hc3Rlci9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogKi8KY29udHJhY3QgRUlQMjBUb2tlbiB7CgogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwoKICAvKioKICAqKiBPcHRpb25hbCBmdW5jdGlvbnMKICAqCiAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgc3ltYm9sKTsKICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4IGRlY2ltYWxzKTsKICAqCiAgKiovCgp9CnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLy8gSW50ZXJmYWNlIGZvciBidXJuaW5nIHRva2Vucwpjb250cmFjdCBCdXJuYWJsZSB7CiAgLy8gQGRldiBEZXN0cm95cyB0b2tlbnMgZm9yIGFuIGFjY291bnQKICAvLyBAcGFyYW0gYWNjb3VudCBBY2NvdW50IHdob3NlIHRva2VucyBhcmUgZGVzdHJveWVkCiAgLy8gQHBhcmFtIHZhbHVlIEFtb3VudCBvZiB0b2tlbnMgdG8gZGVzdHJveQogIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKSBpbnRlcm5hbDsKICBldmVudCBCdXJuZWQoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKTsKfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCi8qKgogKiBBdXRob3JlZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgoKLyoqCiAqIEludGVybmFsIGludGVyZmFjZSBmb3IgdGhlIG1pbnRpbmcgb2YgdG9rZW5zLgogKi8KY29udHJhY3QgTWludGFibGUgewoKICAvKioKICAgKiBAZGV2IE1pbnRzIHRva2VucyBmb3IgYW4gYWNjb3VudAogICAqIFRoaXMgZnVuY3Rpb24gc2hvdWxkIHRoZSBNaW50ZWQgZXZlbnQuCiAgICovCiAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBpbnRlcm5hbDsKCiAgLyoqIFRva2VuIHN1cHBseSBnb3QgaW5jcmVhc2VkIGFuZCBhIG5ldyBvd25lciByZWNlaXZlZCB0aGVzZSB0b2tlbnMgKi8KICBldmVudCBNaW50ZWQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpOwp9CgovKioKICogQHRpdGxlIFN0YW5kYXJkIHRva2VuCiAqIEBkZXYgQmFzaWMgaW1wbGVtZW50YXRpb24gb2YgdGhlIEVJUDIwIHN0YW5kYXJkIHRva2VuIChhbHNvIGtub3duIGFzIEVSQzIwIHRva2VuKS4KICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRUlQMjBUb2tlbiwgQnVybmFibGUsIE1pbnRhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgdWludCBwcml2YXRlIHRvdGFsX3N1cHBseTsKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHJpdmF0ZSBiYWxhbmNlczsKICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgcHJpdmF0ZSBhbGxvd2VkOwoKCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gdG90YWxfc3VwcGx5OwogIH0KCiAgLyoqCiAgICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICAqIEBwYXJhbSB0byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgKiBAcGFyYW0gdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1Yih2YWx1ZSk7CiAgICBiYWxhbmNlc1t0b10gPSBiYWxhbmNlc1t0b10uYWRkKHZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCB2YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICogQHBhcmFtIGFjY291bnQgVGhlIGFkZHJlc3Mgd2hvc2UgYmFsYW5jZSBpcyB0byBiZSBxdWVyaWVkLgogICAqIEByZXR1cm4gQW4gdWludCByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgYWNjb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbYWNjb3VudF07CiAgfQoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSB2YWx1ZSB1aW50IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgYWxsb3dhbmNlID0gYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKGFsbG93YW5jZSwgdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlKHZhbHVlIDw9IGFsbG93YW5jZSk7CiAgICAvLyBTYWZlTWF0aCB1c2VzIGFzc2VydCBpbnN0ZWFkIG9mIHJlcXVpcmUgdGhvdWdoLCBiZXdhcmUgd2hlbiB1c2luZyBhbiBhbmFseXNpcyB0b29sCgogICAgYmFsYW5jZXNbZnJvbV0gPSBiYWxhbmNlc1tmcm9tXS5zdWIodmFsdWUpOwogICAgYmFsYW5jZXNbdG9dID0gYmFsYW5jZXNbdG9dLmFkZCh2YWx1ZSk7CiAgICBhbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dhbmNlLnN1Yih2YWx1ZSk7CiAgICBUcmFuc2Zlcihmcm9tLCB0bywgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqIEBwYXJhbSBzcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSB2YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXMnCiAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShzcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSAodmFsdWUgPT0gMCB8fCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID09IDApOwoKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0gPSB2YWx1ZTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIHZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGFuIGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBhY2NvdW50IGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIHNwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludCBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgYWNjb3VudCwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbYWNjb3VudF1bc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBBdG9taWMgaW5jcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nCiAgICoKICAgKiBXb3JrcyBhcm91bmQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKgogICAqLwogIGZ1bmN0aW9uIGFkZEFwcHJvdmFsKGFkZHJlc3Mgc3BlbmRlciwgdWludCBhZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdOwogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gb2xkVmFsdWUuYWRkKGFkZGVkVmFsdWUpOwogICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdKTsKICAgICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBBdG9taWMgZGVjcmVtZW50IG9mIGFwcHJvdmVkIHNwZW5kaW5nLgogICAqCiAgICogV29ya3MgYXJvdW5kIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICovCiAgZnVuY3Rpb24gc3ViQXBwcm92YWwoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHN1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgdWludCBvbGRWYWwgPSBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdOwoKICAgICAgaWYgKHN1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbCkgewogICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gb2xkVmFsLnN1YihzdWJ0cmFjdGVkVmFsdWUpOwogICAgICB9CiAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bc3BlbmRlcl0pOwogICAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgUHJvdmlkZXMgYW4gaW50ZXJuYWwgZnVuY3Rpb24gZm9yIGRlc3Ryb3lpbmcgdG9rZW5zLiBVc2VmdWwgZm9yIHVwZ3JhZGVzLgogICAqLwogIGZ1bmN0aW9uIGJ1cm5Ub2tlbnMoYWRkcmVzcyBhY2NvdW50LCB1aW50IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBiYWxhbmNlc1thY2NvdW50XSA9IGJhbGFuY2VzW2FjY291bnRdLnN1Yih2YWx1ZSk7CiAgICB0b3RhbF9zdXBwbHkgPSB0b3RhbF9zdXBwbHkuc3ViKHZhbHVlKTsKICAgIFRyYW5zZmVyKGFjY291bnQsIDAsIHZhbHVlKTsKICAgIEJ1cm5lZChhY2NvdW50LCB2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBAZGV2IFByb3ZpZGVzIGFuIGludGVybmFsIG1pbnRpbmcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gbWludEludGVybmFsKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7CiAgICB0b3RhbF9zdXBwbHkgPSB0b3RhbF9zdXBwbHkuYWRkKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0uYWRkKGFtb3VudCk7CiAgICBNaW50ZWQocmVjZWl2ZXIsIGFtb3VudCk7CgogICAgLy8gQmV3YXJlOiBBZGRyZXNzIHplcm8gbWF5IGJlIHVzZWQgZm9yIHNwZWNpYWwgdHJhbnNhY3Rpb25zIGluIGEgZnV0dXJlIGZvcmsuCiAgICAvLyBUaGlzIHdpbGwgbWFrZSB0aGUgbWludCB0cmFuc2FjdGlvbiBhcHBlYXIgaW4gRXRoZXJTY2FuLmlvCiAgICAvLyBXZSBjYW4gcmVtb3ZlIHRoaXMgYWZ0ZXIgdGhlcmUgaXMgYSBzdGFuZGFyZGl6ZWQgbWludGluZyBldmVudAogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7CiAgfQogIAp9CgovKioKICogRGVmaW5lIGludGVyZmFjZSBmb3IgcmVsZWFzaW5nIHRoZSB0b2tlbiB0cmFuc2ZlciBhZnRlciBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLgogKi8KY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewoKICAvKiBUaGUgZmluYWxpemVyIGNvbnRyYWN0IHRoYXQgYWxsb3dzIGxpZnRpbmcgdGhlIHRyYW5zZmVyIGxpbWl0cyBvbiB0aGlzIHRva2VuICovCiAgYWRkcmVzcyBwdWJsaWMgcmVsZWFzZUFnZW50OwoKICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOwoKICAvKiogTWFwIG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2VucyByZWdhcmRsZXNzIG9mIHRoZSBsb2NrIGRvd24gcGVyaW9kLiBUaGVzZSBhcmUgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhbmQgcG9zc2libGUgdGhlIHRlYW0gbXVsdGlzaWcgaXRzZWxmLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOwoKICAvKioKICAgKiBTZXQgdGhlIGNvbnRyYWN0IHRoYXQgY2FuIGNhbGwgcmVsZWFzZSBhbmQgbWFrZSB0aGUgdG9rZW4gdHJhbnNmZXJhYmxlLgogICAqCiAgICogU2luY2UgdGhlIG93bmVyIG9mIHRoaXMgY29udHJhY3QgaXMgKG9yIHNob3VsZCBiZSkgdGhlIGNyb3dkc2FsZSwKICAgKiBpdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgYSBjb3JyZXNwb25kaW5nIGV4cG9zZWQgQVBJIGluIHRoZSBjcm93ZHNhbGUgY29udHJhY3QgaW4gY2FzZSBvZiBpbnB1dCBlcnJvci4KICAgKi8KICBmdW5jdGlvbiBzZXRSZWxlYXNlQWdlbnQoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgaW5SZWxlYXNlU3RhdGUoZmFsc2UpIHB1YmxpYyB7CiAgICAvLyBXZSBkb24ndCBkbyBpbnRlcmZhY2UgY2hlY2sgaGVyZSBhcyB3ZSBtaWdodCB3YW50IHRvIGhhdmUgYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudC4KICAgIHJlbGVhc2VBZ2VudCA9IGFkZHI7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBwYXJ0aWN1bGFyIGFkZHJlc3MgKGUuZy4gYSBjcm93ZHNhbGUgY29udHJhY3QpIHRvIHRyYW5zZmVyIHRva2VucyBkZXNwaXRlIHRoZSBsb2NrIHVwIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgdHJhbnNmZXJBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICB9CgogIC8qKgogICAqIE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIGludG8gdGhlIHdpbGQuCiAgICoKICAgKiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IHNob3VsZCB0eXBpY2FsbHkgYmUgdGhlIGZpbmFsaXplIGFnZW50IElDTyBjb250cmFjdC4KICAgKiBJbiB0aGUgc2NvcGUgb2YgdGhlIGNyb3dkc2FsZSwgaXQgaXMgb25seSBjYWxsZWQgaWYgdGhlIGNyb3dkc2FsZSBoYXMgYmVlbiBhIHN1Y2Nlc3MgKGZpcnN0IG1pbGVzdG9uZSByZWFjaGVkKS4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIHJlbGVhc2VkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIExpbWl0IHRva2VuIHRyYW5zZmVyIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3Zlci4KICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIHNlbmRlcikgewogICAgcmVxdWlyZShyZWxlYXNlZCB8fCB0cmFuc2ZlckFnZW50c1tzZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBiZWZvcmUgb3IgYWZ0ZXIgdGhlIHRva2VucyBoYXZlIGJlZW4gcmVsZWFzZWQgKi8KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgewogICAgcmVxdWlyZShyZWxlYXNlU3RhdGUgPT0gcmVsZWFzZWQpOwogICAgXzsKICB9CgogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGEgd2hpdGVsaXN0ZWQgcmVsZWFzZSBhZ2VudC4gKi8KICBtb2RpZmllciBvbmx5UmVsZWFzZUFnZW50KCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHJlbGVhc2VBZ2VudCk7CiAgICBfOwogIH0KCiAgLyoqIFdlIHJlc3RyaWN0IHRyYW5zZmVyIGJ5IG92ZXJyaWRpbmcgaXQgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIodG8sIHZhbHVlKTsKICB9CgogIC8qKiBXZSByZXN0cmljdCB0cmFuc2ZlckZyb20gYnkgb3ZlcnJpZGluZyBpdCAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2Zlcihmcm9tKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIC8vIENhbGwgU3RhbmRhcmRUb2tlbi50cmFuc2ZlckZvcm0oKQogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogIH0KCn0KCgoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogRmlyc3QgZW52aXNpb25lZCBieSBHb2xlbSBhbmQgTHVueXIgcHJvamVjdHMuCiAqIE9yaWdpbmFsbHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvCiAqIE1vZGlmaWVkIGJ5IGh0dHBzOi8vd3d3LmNvaW5mYWJyaWsuY29tLwogKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE5OwoKLyoqCiAqIEluc3BpcmVkIGJ5IEx1bnlyLgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljbwogKi8KCi8qKgogKiBVcGdyYWRlIGFnZW50IHRyYW5zZmVycyB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAqIFVwZ3JhZGUgYWdlbnQgaXRzZWxmIGNhbiBiZSB0aGUgdG9rZW4gY29udHJhY3QsIG9yIGp1c3QgYSBtaWRkbGUgbWFuIGNvbnRyYWN0IGRvaW5nIHRoZSBoZWF2eSBsaWZ0aW5nLgogKgogKiBUaGUgVXBncmFkZSBhZ2VudCBpcyB0aGUgaW50ZXJmYWNlIHVzZWQgdG8gaW1wbGVtZW50IGEgdG9rZW4KICogbWlncmF0aW9uIGluIHRoZSBjYXNlIG9mIGFuIGVtZXJnZW5jeS4KICogVGhlIGZ1bmN0aW9uIHVwZ3JhZGVGcm9tIGhhcyB0byBpbXBsZW1lbnQgdGhlIHBhcnQgb2YgdGhlIGNyZWF0aW9uCiAqIG9mIG5ldyB0b2tlbnMgb24gYmVoYWxmIG9mIHRoZSB1c2VyIGRvaW5nIHRoZSB1cGdyYWRlLgogKgogKiBUaGUgbmV3IHRva2VuIGNhbiBpbXBsZW1lbnQgdGhpcyBpbnRlcmZhY2UgZGlyZWN0bHksIG9yIHVzZS4KICovCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCB7CgogIC8qKiBUaGlzIHZhbHVlIHNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGUgb3JpZ2luYWwgdG9rZW4ncyB0b3RhbCBzdXBwbHkgKi8KICB1aW50IHB1YmxpYyBvcmlnaW5hbFN1cHBseTsKCiAgLyoqIEludGVyZmFjZSB0byBlbnN1cmUgdGhlIGNvbnRyYWN0IGlzIGNvcnJlY3RseSBjb25maWd1cmVkICovCiAgZnVuY3Rpb24gaXNVcGdyYWRlQWdlbnQoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogIFVwZ3JhZGUgYW4gYWNjb3VudAoKICBXaGVuIHRoZSB0b2tlbiBjb250cmFjdCBpcyBpbiB0aGUgdXBncmFkZSBzdGF0dXMgdGhlIGVhY2ggdXNlciB3aWxsCiAgaGF2ZSB0byBjYWxsIGB1cGdyYWRlKHZhbHVlKWAgZnVuY3Rpb24gZnJvbSBVcGdyYWRlYWJsZVRva2VuLgoKICBUaGUgdXBncmFkZSBmdW5jdGlvbiBhZGp1c3QgdGhlIGJhbGFuY2Ugb2YgdGhlIHVzZXIgYW5kIHRoZSBzdXBwbHkKICBvZiB0aGUgcHJldmlvdXMgdG9rZW4gYW5kIHRoZW4gY2FsbCBgdXBncmFkZUZyb20odmFsdWUpYC4KCiAgVGhlIFVwZ3JhZGVBZ2VudCBpcyB0aGUgcmVzcG9uc2libGUgdG8gY3JlYXRlIHRoZSB0b2tlbnMgZm9yIHRoZSB1c2VyCiAgaW4gdGhlIG5ldyBjb250cmFjdC4KCiAgKiBAcGFyYW0gZnJvbSBBY2NvdW50IHRvIHVwZ3JhZGUuCiAgKiBAcGFyYW0gdmFsdWUgVG9rZW5zIHRvIHVwZ3JhZGUuCgogICovCiAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBmcm9tLCB1aW50IHZhbHVlKSBwdWJsaWM7Cgp9CgoKLyoqCiAqIEEgdG9rZW4gdXBncmFkZSBtZWNoYW5pc20gd2hlcmUgdXNlcnMgY2FuIG9wdC1pbiBhbW91bnQgb2YgdG9rZW5zIHRvIHRoZSBuZXh0IHNtYXJ0IGNvbnRyYWN0IHJldmlzaW9uLgogKgogKi8KY29udHJhY3QgVXBncmFkZWFibGVUb2tlbiBpcyBFSVAyMFRva2VuLCBCdXJuYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qKiBDb250cmFjdCAvIHBlcnNvbiB3aG8gY2FuIHNldCB0aGUgdXBncmFkZSBwYXRoLiBUaGlzIGNhbiBiZSB0aGUgc2FtZSBhcyB0ZWFtIG11bHRpc2lnIHdhbGxldCwgYXMgd2hhdCBpdCBpcyB3aXRoIGl0cyBkZWZhdWx0IHZhbHVlLiAqLwogIGFkZHJlc3MgcHVibGljIHVwZ3JhZGVNYXN0ZXI7CgogIC8qKiBUaGUgbmV4dCBjb250cmFjdCB3aGVyZSB0aGUgdG9rZW5zIHdpbGwgYmUgbWlncmF0ZWQuICovCiAgVXBncmFkZUFnZW50IHB1YmxpYyB1cGdyYWRlQWdlbnQ7CgogIC8qKiBIb3cgbWFueSB0b2tlbnMgd2UgaGF2ZSB1cGdyYWRlZCBieSBub3cuICovCiAgdWludCBwdWJsaWMgdG90YWxVcGdyYWRlZCA9IDA7CgogIC8qKgogICAqIFVwZ3JhZGUgc3RhdGVzLgogICAqCiAgICogLSBOb3RBbGxvd2VkOiBUaGUgY2hpbGQgY29udHJhY3QgaGFzIG5vdCByZWFjaGVkIGEgY29uZGl0aW9uIHdoZXJlIHRoZSB1cGdyYWRlIGNhbiBiZ3VuCiAgICogLSBXYWl0aW5nRm9yQWdlbnQ6IFRva2VuIGFsbG93cyB1cGdyYWRlLCBidXQgd2UgZG9uJ3QgaGF2ZSBhIG5ldyBhZ2VudCB5ZXQKICAgKiAtIFJlYWR5VG9VcGdyYWRlOiBUaGUgYWdlbnQgaXMgc2V0LCBidXQgbm90IGEgc2luZ2xlIHRva2VuIGhhcyBiZWVuIHVwZ3JhZGVkIHlldC4gVGhpcyBhbGxvd3MgY2hhbmdpbmcgdGhlIHVwZ3JhZGUgYWdlbnQgd2hpbGUgdGhlcmUgaXMgdGltZS4KICAgKiAtIFVwZ3JhZGluZzogVXBncmFkZSBhZ2VudCBpcyBzZXQgYW5kIHRoZSBiYWxhbmNlIGhvbGRlcnMgY2FuIHVwZ3JhZGUgdGhlaXIgdG9rZW5zCiAgICoKICAgKi8KICBlbnVtIFVwZ3JhZGVTdGF0ZSB7VW5rbm93biwgTm90QWxsb3dlZCwgV2FpdGluZ0ZvckFnZW50LCBSZWFkeVRvVXBncmFkZSwgVXBncmFkaW5nfQoKICAvKioKICAgKiBTb21lYm9keSBoYXMgdXBncmFkZWQgc29tZSBvZiBoaXMgdG9rZW5zLgogICAqLwogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpOwoKICAvKioKICAgKiBOZXcgdXBncmFkZSBhZ2VudCBhdmFpbGFibGUuCiAgICovCiAgZXZlbnQgVXBncmFkZUFnZW50U2V0KGFkZHJlc3MgYWdlbnQpOwoKICAvKioKICAgKiBEbyBub3QgYWxsb3cgY29uc3RydWN0aW9uIHdpdGhvdXQgdXBncmFkZSBtYXN0ZXIgc2V0LgogICAqLwogIGZ1bmN0aW9uIFVwZ3JhZGVhYmxlVG9rZW4oYWRkcmVzcyBtYXN0ZXIpIGludGVybmFsIHsKICAgIHNldFVwZ3JhZGVNYXN0ZXIobWFzdGVyKTsKICB9CgogIC8qKgogICAqIEFsbG93IHRoZSB0b2tlbiBob2xkZXIgdG8gdXBncmFkZSBzb21lIG9mIHRoZWlyIHRva2VucyB0byBhIG5ldyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiB1cGdyYWRlKHVpbnQgdmFsdWUpIHB1YmxpYyB7CiAgICBVcGdyYWRlU3RhdGUgc3RhdGUgPSBnZXRVcGdyYWRlU3RhdGUoKTsKICAgIC8vIEVuc3VyZSBpdCdzIG5vdCBjYWxsZWQgaW4gYSBiYWQgc3RhdGUKICAgIHJlcXVpcmUoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLgogICAgcmVxdWlyZSh2YWx1ZSAhPSAwKTsKCiAgICAvLyBVcGdyYWRlIGFnZW50IHJlaXNzdWVzIHRoZSB0b2tlbnMKICAgIHVwZ3JhZGVBZ2VudC51cGdyYWRlRnJvbShtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAKICAgIC8vIFRha2UgdG9rZW5zIG91dCBmcm9tIGNpcmN1bGF0aW9uCiAgICBidXJuVG9rZW5zKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgIHRvdGFsVXBncmFkZWQgPSB0b3RhbFVwZ3JhZGVkLmFkZCh2YWx1ZSk7CgogICAgVXBncmFkZShtc2cuc2VuZGVyLCB1cGdyYWRlQWdlbnQsIHZhbHVlKTsKICB9CgogIC8qKgogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcyB0aGUgdXBncmFkZSBwcm9jZXNzCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZUFnZW50KGFkZHJlc3MgYWdlbnQpIG9ubHlNYXN0ZXIgZXh0ZXJuYWwgewogICAgLy8gQ2hlY2sgd2hldGhlciB0aGUgdG9rZW4gaXMgaW4gYSBzdGF0ZSB0aGF0IHdlIGNvdWxkIHRoaW5rIG9mIHVwZ3JhZGluZwogICAgcmVxdWlyZShjYW5VcGdyYWRlKCkpOwoKICAgIHJlcXVpcmUoYWdlbnQgIT0gMHgwKTsKICAgIC8vIFVwZ3JhZGUgaGFzIGFscmVhZHkgYmVndW4gZm9yIGFuIGFnZW50CiAgICByZXF1aXJlKGdldFVwZ3JhZGVTdGF0ZSgpICE9IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpOwoKICAgIHVwZ3JhZGVBZ2VudCA9IFVwZ3JhZGVBZ2VudChhZ2VudCk7CgogICAgLy8gQmFkIGludGVyZmFjZQogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQuaXNVcGdyYWRlQWdlbnQoKSk7CiAgICAvLyBNYWtlIHN1cmUgdGhhdCB0b2tlbiBzdXBwbGllcyBtYXRjaCBpbiBzb3VyY2UgYW5kIHRhcmdldAogICAgcmVxdWlyZSh1cGdyYWRlQWdlbnQub3JpZ2luYWxTdXBwbHkoKSA9PSB0b3RhbFN1cHBseSgpKTsKCiAgICBVcGdyYWRlQWdlbnRTZXQodXBncmFkZUFnZW50KTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgc3RhdGUgb2YgdGhlIHRva2VuIHVwZ3JhZGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VXBncmFkZVN0YXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhVcGdyYWRlU3RhdGUpIHsKICAgIGlmICghY2FuVXBncmFkZSgpKSByZXR1cm4gVXBncmFkZVN0YXRlLk5vdEFsbG93ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7CiAgICBlbHNlIGlmICh0b3RhbFVwZ3JhZGVkID09IDApIHJldHVybiBVcGdyYWRlU3RhdGUuUmVhZHlUb1VwZ3JhZGU7CiAgICBlbHNlIHJldHVybiBVcGdyYWRlU3RhdGUuVXBncmFkaW5nOwogIH0KCiAgLyoqCiAgICogQ2hhbmdlIHRoZSB1cGdyYWRlIG1hc3Rlci4KICAgKgogICAqIFRoaXMgYWxsb3dzIHVzIHRvIHNldCBhIG5ldyBvd25lciBmb3IgdGhlIHVwZ3JhZGUgbWVjaGFuaXNtLgogICAqLwogIGZ1bmN0aW9uIGNoYW5nZVVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBvbmx5TWFzdGVyIHB1YmxpYyB7CiAgICBzZXRVcGdyYWRlTWFzdGVyKG5ld19tYXN0ZXIpOwogIH0KCiAgLyoqCiAgICogSW50ZXJuYWwgdXBncmFkZSBtYXN0ZXIgc2V0dGVyLgogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVNYXN0ZXIoYWRkcmVzcyBuZXdfbWFzdGVyKSBwcml2YXRlIHsKICAgIHJlcXVpcmUobmV3X21hc3RlciAhPSAweDApOwogICAgdXBncmFkZU1hc3RlciA9IG5ld19tYXN0ZXI7CiAgfQoKICAvKioKICAgKiBDaGlsZCBjb250cmFjdCBjYW4gb3ZlcnJpZGUgdG8gcHJvdmlkZSB0aGUgY29uZGl0aW9uIGluIHdoaWNoIHRoZSB1cGdyYWRlIGNhbiBiZWdpbi4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgcmV0dXJuIHRydWU7CiAgfQoKCiAgbW9kaWZpZXIgb25seU1hc3RlcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB1cGdyYWRlTWFzdGVyKTsKICAgIF87CiAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCi8qKgogKiBBdXRob3JlZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgoKLy8gVGhpcyBjb250cmFjdCBhaW1zIHRvIHByb3ZpZGUgYW4gaW5oZXJpdGFibGUgd2F5IHRvIHJlY292ZXIgdG9rZW5zIGZyb20gYSBjb250cmFjdCBub3QgbWVhbnQgdG8gaG9sZCB0b2tlbnMKLy8gVG8gdXNlIHRoaXMgY29udHJhY3QsIGhhdmUgeW91ciB0b2tlbi1pZ25vcmluZyBjb250cmFjdCBpbmhlcml0IHRoaXMgb25lIGFuZCBpbXBsZW1lbnQgZ2V0TG9zdEFuZEZvdW5kTWFzdGVyIHRvIGRlY2lkZSB3aG8gY2FuIG1vdmUgbG9zdCB0b2tlbnMuCi8vIE9mIGNvdXJzZSwgdGhpcyBjb250cmFjdCBpbXBvc2VzIHN1cHBvcnQgY29zdHMgdXBvbiB3aG9ldmVyIGlzIHRoZSBsb3N0IGFuZCBmb3VuZCBtYXN0ZXIuCmNvbnRyYWN0IExvc3RBbmRGb3VuZFRva2VuIHsKICAvKioKICAgKiBAcmV0dXJuIEFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBoYW5kbGVzIG1vdmVtZW50cy4KICAgKi8KICBmdW5jdGlvbiBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwoKICAvKioKICAgKiBAcGFyYW0gYWdlbnQgQWRkcmVzcyB0aGF0IHdpbGwgYmUgYWJsZSB0byBtb3ZlIHRva2VucyB3aXRoIHRyYW5zZmVyRnJvbQogICAqIEBwYXJhbSB0b2tlbnMgQW1vdW50IG9mIHRva2VucyBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgKiBAcGFyYW0gdG9rZW5fY29udHJhY3QgQ29udHJhY3Qgb2YgdGhlIHRva2VuCiAgICovCiAgZnVuY3Rpb24gZW5hYmxlTG9zdEFuZEZvdW5kKGFkZHJlc3MgYWdlbnQsIHVpbnQgdG9rZW5zLCBFSVAyMFRva2VuIHRva2VuX2NvbnRyYWN0KSBwdWJsaWMgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGdldExvc3RBbmRGb3VuZE1hc3RlcigpKTsKICAgIC8vIFdlIHVzZSBhcHByb3ZlIGluc3RlYWQgb2YgdHJhbnNmZXIgdG8gbWluaW1pemUgdGhlIHBvc3NpYmlsaXR5IG9mIHRoZSBsb3N0IGFuZCBmb3VuZCBtYXN0ZXIKICAgIC8vICBnZXR0aW5nIHRoZW0gc3R1Y2sgaW4gYW5vdGhlciBhZGRyZXNzIGJ5IGFjY2lkZW50LgogICAgdG9rZW5fY29udHJhY3QuYXBwcm92ZShhZ2VudCwgdG9rZW5zKTsKICB9Cn0KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogT3JpZ2luYWxseSBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28KICogTW9kaWZpZWQgYnkgaHR0cHM6Ly93d3cuY29pbmZhYnJpay5jb20vCiAqLwoKCi8qKgogKiBBIHB1YmxpYyBpbnRlcmZhY2UgdG8gaW5jcmVhc2UgdGhlIHN1cHBseSBvZiBhIHRva2VuLgogKgogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uCiAqIE9ubHkgbWludCBhZ2VudHMsIHVzdWFsbHkgY29udHJhY3RzIHdoaXRlbGlzdGVkIGJ5IHRoZSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4KICoKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgTWludGFibGUsIE93bmFibGUgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgogIC8qKiBMaXN0IG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgdG9rZW5zICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgbWludEFnZW50czsKCiAgZXZlbnQgTWludGluZ0FnZW50Q2hhbmdlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpOwoKCiAgZnVuY3Rpb24gTWludGFibGVUb2tlbih1aW50IGluaXRpYWxTdXBwbHksIGFkZHJlc3MgbXVsdGlzaWcsIGJvb2wgbWludGFibGUpIGludGVybmFsIHsKICAgIHJlcXVpcmUobXVsdGlzaWcgIT0gYWRkcmVzcygwKSk7CiAgICAvLyBDYW5ub3QgY3JlYXRlIGEgdG9rZW4gd2l0aG91dCBzdXBwbHkgYW5kIG5vIG1pbnRpbmcKICAgIHJlcXVpcmUobWludGFibGUgfHwgaW5pdGlhbFN1cHBseSAhPSAwKTsKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGlmIChpbml0aWFsU3VwcGx5ID4gMCkKICAgICAgbWludEludGVybmFsKG11bHRpc2lnLCBpbml0aWFsU3VwcGx5KTsKICAgIC8vIE5vIG1vcmUgbmV3IHN1cHBseSBhbGxvd2VkIGFmdGVyIHRoZSB0b2tlbiBjcmVhdGlvbgogICAgbWludGluZ0ZpbmlzaGVkID0gIW1pbnRhYmxlOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgYW5kIGFsbG9jYXRlIHRoZW0gdG8gYW4gYWRkcmVzcy4KICAgKgogICAqIE9ubHkgY2FsbGFibGUgYnkgYSBtaW50IGFnZW50IChlLmcuIGNyb3dkc2FsZSBjb250cmFjdCkuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgb25seU1pbnRBZ2VudCBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50SW50ZXJuYWwocmVjZWl2ZXIsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgICBNaW50aW5nQWdlbnRDaGFuZ2VkKGFkZHIsIHN0YXRlKTsKICB9CgogIG1vZGlmaWVyIG9ubHlNaW50QWdlbnQoKSB7CiAgICAvLyBPbmx5IG1pbnQgYWdlbnRzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgcmVxdWlyZShtaW50QWdlbnRzW21zZy5zZW5kZXJdKTsKICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIHJlcXVpcmUoIW1pbnRpbmdGaW5pc2hlZCk7CiAgICBfOwogIH0KfQoKLyoqCiAqIEEgY3Jvd2RzYWxlIHRva2VuLgogKgogKiBBbiBFUkMtMjAgdG9rZW4gZGVzaWduZWQgc3BlY2lmaWNhbGx5IGZvciBjcm93ZHNhbGVzIHdpdGggaW52ZXN0b3IgcHJvdGVjdGlvbiBhbmQgZnVydGhlciBkZXZlbG9wbWVudCBwYXRoLgogKgogKiAtIFRoZSB0b2tlbiB0cmFuc2ZlcigpIGlzIGRpc2FibGVkIHVudGlsIHRoZSBjcm93ZHNhbGUgaXMgb3ZlcgogKiAtIFRoZSB0b2tlbiBjb250cmFjdCBnaXZlcyBhbiBvcHQtaW4gdXBncmFkZSBwYXRoIHRvIGEgbmV3IGNvbnRyYWN0CiAqIC0gVGhlIHNhbWUgdG9rZW4gY2FuIGJlIHBhcnQgb2Ygc2V2ZXJhbCBjcm93ZHNhbGVzIHRocm91Z2ggdGhlIGFwcHJvdmUoKSBtZWNoYW5pc20KICogLSBUaGUgdG9rZW4gY2FuIGJlIGNhcHBlZCAoc3VwcGx5IHNldCBpbiB0aGUgY29uc3RydWN0b3IpIG9yIHVuY2FwcGVkIChjcm93ZHNhbGUgY29udHJhY3QgY2FuIG1pbnQgbmV3IHRva2VucykKICogLSBFUkMyMCB0b2tlbnMgdHJhbnNmZXJyZWQgdG8gdGhpcyBjb250cmFjdCBjYW4gYmUgcmVjb3ZlcmVkIGJ5IGEgbG9zdCBhbmQgZm91bmQgbWFzdGVyCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGVUb2tlbiBpcyBSZWxlYXNhYmxlVG9rZW4sIE1pbnRhYmxlVG9rZW4sIFVwZ3JhZGVhYmxlVG9rZW4sIExvc3RBbmRGb3VuZFRva2VuIHsKCiAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIlRva2VuSG9tZSI7CgogIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gIlRIIjsKCiAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICBhZGRyZXNzIHB1YmxpYyBsb3N0X2FuZF9mb3VuZF9tYXN0ZXI7CgogIC8qKgogICAqIENvbnN0cnVjdCB0aGUgdG9rZW4uCiAgICoKICAgKiBUaGlzIHRva2VuIG11c3QgYmUgY3JlYXRlZCB0aHJvdWdoIGEgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIHNvIHRoYXQgaXQgaXMgb3duZWQgYnkgdGhhdCB3YWxsZXQuCiAgICoKICAgKiBAcGFyYW0gaW5pdGlhbF9zdXBwbHkgSG93IG1hbnkgdG9rZW5zIHdlIHN0YXJ0IHdpdGguCiAgICogQHBhcmFtIHRva2VuX2RlY2ltYWxzIE51bWJlciBvZiBkZWNpbWFsIHBsYWNlcy4KICAgKiBAcGFyYW0gdGVhbV9tdWx0aXNpZyBBZGRyZXNzIG9mIHRoZSBtdWx0aXNpZyB0aGF0IHJlY2VpdmVzIHRoZSBpbml0aWFsIHN1cHBseSBhbmQgaXMgc2V0IGFzIHRoZSB1cGdyYWRlIG1hc3Rlci4KICAgKiBAcGFyYW0gdG9rZW5fcmV0cmlldmVyIEFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBoYW5kbGVzIEVSQzIwIHRva2VucyB0aGF0IHdlcmUgYWNjaWRlbnRhbGx5IHNlbnQgdG8gdGhpcyBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBDcm93ZHNhbGVUb2tlbih1aW50IGluaXRpYWxfc3VwcGx5LCB1aW50OCB0b2tlbl9kZWNpbWFscywgYWRkcmVzcyB0ZWFtX211bHRpc2lnLCBhZGRyZXNzIHRva2VuX3JldHJpZXZlcikgcHVibGljCiAgVXBncmFkZWFibGVUb2tlbih0ZWFtX211bHRpc2lnKSBNaW50YWJsZVRva2VuKGluaXRpYWxfc3VwcGx5LCB0ZWFtX211bHRpc2lnLCB0cnVlKSB7CiAgICByZXF1aXJlKHRva2VuX3JldHJpZXZlciAhPSBhZGRyZXNzKDApKTsKICAgIGRlY2ltYWxzID0gdG9rZW5fZGVjaW1hbHM7CiAgICBsb3N0X2FuZF9mb3VuZF9tYXN0ZXIgPSB0b2tlbl9yZXRyaWV2ZXI7CiAgfQoKICAvKioKICAgKiBXaGVuIHRva2VuIGlzIHJlbGVhc2VkIHRvIGJlIHRyYW5zZmVyYWJsZSwgcHJvaGliaXQgbmV3IHRva2VuIGNyZWF0aW9uLgogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlSZWxlYXNlQWdlbnQgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIHN1cGVyLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyB1cGdyYWRlIGFnZW50IGZ1bmN0aW9uYWxpdHkgdG8ga2ljayBpbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgd2FzIGEgc3VjY2Vzcy4KICAgKi8KICBmdW5jdGlvbiBjYW5VcGdyYWRlKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gcmVsZWFzZWQgJiYgc3VwZXIuY2FuVXBncmFkZSgpOwogIH0KCiAgZnVuY3Rpb24gYnVybih1aW50IHZhbHVlKSBwdWJsaWMgewogICAgYnVyblRva2Vucyhtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBnZXRMb3N0QW5kRm91bmRNYXN0ZXIoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYWRkcmVzcykgewogICAgcmV0dXJuIGxvc3RfYW5kX2ZvdW5kX21hc3RlcjsKICB9Cn0KCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNvbnRyYWN0IGZvciB0b2tlbiBzYWxlcy4KICoKICogSGFuZGxlcwogKiAtIHN0YXJ0IGFuZCBlbmQgZGF0ZXMKICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMKICogLSB2YXJpb3VzIHN0YXRpc3RpY3MgZHVyaW5nIHRoZSBjcm93ZGZ1bmQKICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpCiAqCiAqLwpjb250cmFjdCBHZW5lcmljQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlIHsKCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIENyb3dkc2FsZVRva2VuIHB1YmxpYyB0b2tlbjsKCiAgLyogZXRoZXIgd2lsbCBiZSB0cmFuc2ZlcnJlZCB0byB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKCiAgLyogdGhlIHN0YXJ0aW5nIHRpbWVzdGFtcCBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgc3RhcnRzQXQ7CgogIC8qIHRoZSBlbmRpbmcgdGltZXN0YW1wIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBlbmRzQXQ7CgogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLwogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOwoKICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLwogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CgogIC8qIEhhcyB0aGlzIGNyb3dkc2FsZSBiZWVuIGZpbmFsaXplZCAqLwogIGJvb2wgcHVibGljIGZpbmFsaXplZCA9IGZhbHNlOwoKICAvKiBEbyB3ZSBuZWVkIHRvIGhhdmUgYSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8KICBib29sIHB1YmxpYyByZXF1aXJlQ3VzdG9tZXJJZCA9IGZhbHNlOwoKICAvKiBIYXMgdGhpcyBjcm93ZHNhbGUgYmVlbiBjb25maWd1cmVkICovCiAgYm9vbCBwdWJsaWMgY29uZmlndXJlZCA9IGZhbHNlOwoKICAvKioKICAgKiBEbyB3ZSB2ZXJpZnkgdGhhdCBjb250cmlidXRvciBoYXMgYmVlbiBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWNjcmVkaXRlZCBpbnZlc3RvcnMgb25seSkuCiAgICogVGhpcyBtZXRob2Qgd2FzIGZpcnN0IHVzZWQgaW4gdGhlIEZpcnN0Qmxvb2QgY3Jvd2RzYWxlIHRvIGVuc3VyZSBhbGwgY29udHJpYnV0b3JzIGhhZCBhY2NlcHRlZCB0ZXJtcyBvZiBzYWxlIChvbiB0aGUgd2ViKS4KICAgKi8KICBib29sIHB1YmxpYyByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSBmYWxzZTsKCiAgLyoqIFNlcnZlciBzaWRlIGFkZHJlc3MgdGhhdCBzaWduZWQgYWxsb3dlZCBjb250cmlidXRvcnMgKEV0aGVyZXVtIGFkZHJlc3NlcykgdGhhdCBjYW4gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSAqLwogIGFkZHJlc3MgcHVibGljIHNpZ25lckFkZHJlc3M7CgogIC8qKiBIb3cgbWFueSBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCBpbiB0aGlzIGNyb3dkc2FsZSAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGludmVzdGVkQW1vdW50T2Y7CgogIC8qKiBIb3cgbWFueSB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB0b2tlbkFtb3VudE9mOwoKICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gaW52ZXN0IGV2ZW4gYmVmb3JlIElDTyBvZmZpY2lhbGx5IG9wZW5zLiBGb3IgdGVzdGluZywgZm9yIElDTyBwYXJ0bmVycywgZXRjLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3Q7CgogIC8qKiBTdGF0ZSBtYWNoaW5lCiAgICoKICAgKiAtIFBlbmRpbmdDb25maWd1cmF0aW9uOiBDcm93ZHNhbGUgbm90IHlldCBjb25maWd1cmVkCiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCByZWFjaGVkIHRoZSBzdGFydGluZyB0aW1lc3RhbXAgeWV0CiAgICogLSBGdW5kaW5nOiBBY3RpdmUgY3Jvd2RzYWxlCiAgICogLSBTdWNjZXNzOiBDcm93ZHNhbGUgZW5kZWQKICAgKiAtIEZpbmFsaXplZDogVGhlIGZpbmFsaXplIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZCBhbmQgc3VjY2Vzc2Z1bGx5IGV4ZWN1dGVkCiAgICovCiAgZW51bSBTdGF0ZXtVbmtub3duLCBQZW5kaW5nQ29uZmlndXJhdGlvbiwgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmluYWxpemVkfQoKCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50LCB1aW50MTI4IGN1c3RvbWVySWQpOwoKICAvLyBUaGUgcnVsZXMgYWJvdXQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdCB3ZXJlIGNoYW5nZWQKICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDSWQsIGJvb2wgcmVxdWlyZVNpZ25lZEFkZHJlc3MsIGFkZHJlc3Mgc2lnbmVyKTsKCiAgLy8gQWRkcmVzcyBlYXJseSBwYXJ0aWNpcGF0aW9uIHdoaXRlbGlzdCBzdGF0dXMgY2hhbmdlZAogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOwoKICAvLyBDcm93ZHNhbGUncyBmaW5hbGl6ZSBmdW5jdGlvbiBoYXMgYmVlbiBjYWxsZWQKICBldmVudCBGaW5hbGl6ZWQoKTsKCiAgLyoKICAgKiBUaGUgY29uZmlndXJhdGlvbiBmcm9tIHRoZSBjb25zdHJ1Y3RvciB3YXMgbW92ZWQgdG8gdGhlIGNvbmZpZ3VyYXRpb25HZW5lcmljQ3Jvd2RzYWxlIGZ1bmN0aW9uLgogICAqCiAgICogQHBhcmFtIHRlYW1fbXVsdGlzaWcgQWRkcmVzcyBvZiB0aGUgbXVsdGlzaWduYXR1cmUgd2FsbGV0IG9mIHRoZSB0ZWFtIHRoYXQgd2lsbCByZWNlaXZlIGFsbCB0aGUgZnVuZHMgY29udHJpYnV0ZWQgaW4gdGhlIGNyb3dkc2FsZS4KICAgKiBAcGFyYW0gc3RhcnQgVGltZXN0YW1wIHdoZXJlIHRoZSBjcm93ZHNhbGUgd2lsbCBiZSBvZmZpY2lhbGx5IHN0YXJ0ZWQuIEl0IHNob3VsZCBiZSBncmVhdGVyIHRoYW4gdGhlIHRpbWVzdGFtcCBpbiB3aGljaCB0aGUgY29udHJhY3QgaXMgZGVwbG95ZWQuCiAgICogQHBhcmFtIGVuZCBUaW1lc3RhbXAgd2hlcmUgdGhlIGNyb3dkc2FsZSBmaW5pc2hlcy4gTm8gdG9rZW5zIGNhbiBiZSBzb2xkIHRocm91Z2ggdGhpcyBjb250cmFjdCBhZnRlciB0aGlzIHRpbWVzdGFtcC4KICAgKgogICAqIGNvbmZpZ3VyYXRpb25HZW5lcmljQ3Jvd2RzYWxlIGNhbiBvbmx5IGJlIGNhbGxlZCB3aGVuIGluIFN0YXRlLlBlbmRpbmdDb25maWd1cmF0aW9uIGJlY2F1c2Ugb2YgdGhlIGluU3RhdGUgbW9kaWZpZXIuCiAgICovCiAgZnVuY3Rpb24gY29uZmlndXJhdGlvbkdlbmVyaWNDcm93ZHNhbGUoYWRkcmVzcyB0ZWFtX211bHRpc2lnLCB1aW50IHN0YXJ0LCB1aW50IGVuZCkgaW50ZXJuYWwgaW5TdGF0ZShTdGF0ZS5QZW5kaW5nQ29uZmlndXJhdGlvbikgewogICAgc2V0TXVsdGlzaWcodGVhbV9tdWx0aXNpZyk7CgogICAgLy8gRG9uJ3QgbWVzcyB0aGUgZGF0ZXMKICAgIHJlcXVpcmUoc3RhcnQgIT0gMCAmJiBlbmQgIT0gMCk7CiAgICByZXF1aXJlKG5vdyA8IHN0YXJ0ICYmIHN0YXJ0IDwgZW5kKTsKICAgIHN0YXJ0c0F0ID0gc3RhcnQ7CiAgICBlbmRzQXQgPSBlbmQ7CiAgICBjb25maWd1cmVkID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIERlZmF1bHQgZmFsbGJhY2sgYmVoYXZpb3VyIGlzIHRvIGNhbGwgYnV5LgogICAqIElkZWFsbHksIG5vIGNvbnRyYWN0IGNhbGxzIHRoaXMgY3Jvd2RzYWxlIHdpdGhvdXQgc3VwcG9ydGluZyBFUkMyMC4KICAgKiBIb3dldmVyLCBzb21lIHNvcnQgb2YgcmVmdW5kaW5nIGZ1bmN0aW9uIG1heSBiZSBkZXNpcmVkIHRvIGNvdmVyIHN1Y2ggc2l0dWF0aW9ucy4KICAgKi8KICBmdW5jdGlvbigpIHBheWFibGUgcHVibGljIHsKICAgIGJ1eSgpOwogIH0KCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogVGhlIGNyb3dkc2FsZSBtdXN0IGJlIHJ1bm5pbmcgZm9yIG9uZSB0byBpbnZlc3QuCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuCiAgICoKICAgKiBAcGFyYW0gcmVjZWl2ZXIgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgd2hvIHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlCiAgICoKICAgKi8KICBmdW5jdGlvbiBpbnZlc3RJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHN0b3BJbkVtZXJnZW5jeSBub3RGaW5pc2hlZCBwcml2YXRlIHsKICAgIC8vIERldGVybWluZSBpZiBpdCdzIGEgZ29vZCB0aW1lIHRvIGFjY2VwdCBpbnZlc3RtZW50IGZyb20gdGhpcyBwYXJ0aWNpcGFudAogICAgaWYgKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgewogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQKICAgICAgcmVxdWlyZShlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W21zZy5zZW5kZXJdKTsKICAgIH0KCiAgICB1aW50IHdlaUFtb3VudDsKICAgIHVpbnQgdG9rZW5BbW91bnQ7CiAgICAod2VpQW1vdW50LCB0b2tlbkFtb3VudCkgPSBjYWxjdWxhdGVUb2tlbkFtb3VudChtc2cudmFsdWUsIHJlY2VpdmVyKTsKICAgIC8vIFNhbml0eSBjaGVjayBhZ2FpbnN0IGJhZCBpbXBsZW1lbnRhdGlvbi4KICAgIGFzc2VydCh3ZWlBbW91bnQgPD0gbXNnLnZhbHVlKTsKICAgIAogICAgLy8gRHVzdCB0cmFuc2FjdGlvbiBpZiBubyB0b2tlbnMgY2FuIGJlIGdpdmVuCiAgICByZXF1aXJlKHRva2VuQW1vdW50ICE9IDApOwoKICAgIGlmIChpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9PSAwKSB7CiAgICAgIC8vIEEgbmV3IGludmVzdG9yCiAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KICAgIHVwZGF0ZUludmVzdG9yRnVuZHModG9rZW5BbW91bnQsIHdlaUFtb3VudCwgcmVjZWl2ZXIsIGN1c3RvbWVySWQpOwoKICAgIC8vIFBvY2tldCB0aGUgbW9uZXkKICAgIG11bHRpc2lnV2FsbGV0LnRyYW5zZmVyKHdlaUFtb3VudCk7CgogICAgLy8gUmV0dXJuIGV4Y2VzcyBvZiBtb25leQogICAgcmV0dXJuRXhjZWRlbnQobXNnLnZhbHVlLnN1Yih3ZWlBbW91bnQpLCBtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAqIFByZWFsbG9jYXRlIHRva2VucyBmb3IgdGhlIGVhcmx5IGludmVzdG9ycy4KICAgKgogICAqIFByZWFsbG9jYXRlZCB0b2tlbnMgaGF2ZSBiZWVuIHNvbGQgYmVmb3JlIHRoZSBhY3R1YWwgY3Jvd2RzYWxlIG9wZW5zLgogICAqIFRoaXMgZnVuY3Rpb24gbWludHMgdGhlIHRva2VucyBhbmQgbW92ZXMgdGhlIGNyb3dkc2FsZSBuZWVkbGUuCiAgICoKICAgKiBObyBtb25leSBpcyBleGNoYW5nZWQsIGFzIHRoZSBjcm93ZHNhbGUgdGVhbSBhbHJlYWR5IGhhdmUgcmVjZWl2ZWQgdGhlIHBheW1lbnQuCiAgICoKICAgKiBAcGFyYW0gcmVjZWl2ZXIgQWNjb3VudCB0aGF0IHJlY2VpdmVzIHRoZSB0b2tlbnMuCiAgICogQHBhcmFtIGZ1bGxUb2tlbnMgdG9rZW5zIGFzIGZ1bGwgdG9rZW5zIC0gZGVjaW1hbCBwbGFjZXMgYXJlIGFkZGVkIGludGVybmFsbHkuCiAgICogQHBhcmFtIHdlaVByaWNlIFByaWNlIG9mIGEgc2luZ2xlIGluZGl2aXNpYmxlIHRva2VuIGluIHdlaS4KICAgKgogICAqLwogIGZ1bmN0aW9uIHByZWFsbG9jYXRlKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgZnVsbFRva2VucywgdWludCB3ZWlQcmljZSkgcHVibGljIG9ubHlPd25lciBub3RGaW5pc2hlZCB7CiAgICByZXF1aXJlKHJlY2VpdmVyICE9IGFkZHJlc3MoMCkpOwogICAgdWludCB0b2tlbkFtb3VudCA9IGZ1bGxUb2tlbnMubXVsKDEwKip1aW50KHRva2VuLmRlY2ltYWxzKCkpKTsKICAgIHJlcXVpcmUodG9rZW5BbW91bnQgIT0gMCk7CiAgICB1aW50IHdlaUFtb3VudCA9IHdlaVByaWNlLm11bCh0b2tlbkFtb3VudCk7IC8vIFRoaXMgY2FuIGFsc28gYmUgMCwgaW4gd2hpY2ggY2FzZSB3ZSBnaXZlIG91dCB0b2tlbnMgZm9yIGZyZWUKICAgIHVwZGF0ZUludmVzdG9yRnVuZHModG9rZW5BbW91bnQsIHdlaUFtb3VudCwgcmVjZWl2ZXIgLCAwKTsKICB9CgogIC8qKgogICAqIFByaXZhdGUgZnVuY3Rpb24gdG8gdXBkYXRlIGFjY291bnRpbmcgaW4gdGhlIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiB1cGRhdGVJbnZlc3RvckZ1bmRzKHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpQW1vdW50LCBhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHByaXZhdGUgewogICAgLy8gVXBkYXRlIGludmVzdG9yCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLmFkZCh3ZWlBbW91bnQpOwogICAgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPSB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXS5hZGQodG9rZW5BbW91bnQpOwoKICAgIC8vIFVwZGF0ZSB0b3RhbHMKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLmFkZCh0b2tlbkFtb3VudCk7CgogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CiAgICAvLyBUZWxsIHVzIHRoYXQgdGhlIGludmVzdG1lbnQgd2FzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkKICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIEludmVzdGluZyBmdW5jdGlvbiB0aGF0IHJlY29nbml6ZXMgdGhlIHJlY2VpdmVyIGFuZCB2ZXJpZmllcyBoZSBpcyBhbGxvd2VkIHRvIGludmVzdC4KICAgKgogICAqIEBwYXJhbSBjdXN0b21lcklkIFVVSUR2NCB0aGF0IGlkZW50aWZpZXMgdGhpcyBjb250cmlidXRvcgogICAqLwogIGZ1bmN0aW9uIGJ1eU9uQmVoYWxmV2l0aFNpZ25lZEFkZHJlc3MoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgdmFsaWRDdXN0b21lcklkKGN1c3RvbWVySWQpIHsKICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTI1NihyZWNlaXZlcik7CiAgICByZXF1aXJlKGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKSA9PSBzaWduZXJBZGRyZXNzKTsKICAgIGludmVzdEludGVybmFsKHJlY2VpdmVyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIEludmVzdGluZyBmdW5jdGlvbiB0aGF0IHJlY29nbml6ZXMgdGhlIHJlY2VpdmVyLgogICAqIAogICAqIEBwYXJhbSBjdXN0b21lcklkIFVVSUR2NCB0aGF0IGlkZW50aWZpZXMgdGhpcyBjb250cmlidXRvcgogICAqLwogIGZ1bmN0aW9uIGJ1eU9uQmVoYWxmV2l0aEN1c3RvbWVySWQoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB2YWxpZEN1c3RvbWVySWQoY3VzdG9tZXJJZCkgdW5zaWduZWRCdXlBbGxvd2VkIHsKICAgIGludmVzdEludGVybmFsKHJlY2VpdmVyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIEJ1eXMgdG9rZW5zIG9uIGJlaGFsZiBvZiBhbiBhZGRyZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHJlY2VpdmVyIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYnV5T25CZWhhbGYoYWRkcmVzcyByZWNlaXZlcikgcHVibGljIHBheWFibGUgdW5zaWduZWRCdXlBbGxvd2VkIHsKICAgIHJlcXVpcmUoIXJlcXVpcmVDdXN0b21lcklkKTsgLy8gQ3Jvd2RzYWxlIG5lZWRzIHRvIHRyYWNrIHBhcnRpY2lwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsCiAgICBpbnZlc3RJbnRlcm5hbChyZWNlaXZlciwgMCk7CiAgfQoKICAvKioKICAgKiBJbnZlc3RpbmcgZnVuY3Rpb24gdGhhdCByZWNvZ25pemVzIHRoZSBwYXllciBhbmQgdmVyaWZpZXMgaGUgaXMgYWxsb3dlZCB0byBpbnZlc3QuCiAgICoKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCBVVUlEdjQgdGhhdCBpZGVudGlmaWVzIHRoaXMgY29udHJpYnV0b3IKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoU2lnbmVkQWRkcmVzcyh1aW50MTI4IGN1c3RvbWVySWQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBidXlPbkJlaGFsZldpdGhTaWduZWRBZGRyZXNzKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQsIHYsIHIsIHMpOwogIH0KCgogIC8qKgogICAqIEludmVzdGluZyBmdW5jdGlvbiB0aGF0IHJlY29nbml6ZXMgdGhlIHBheWVyLgogICAqIAogICAqIEBwYXJhbSBjdXN0b21lcklkIFVVSUR2NCB0aGF0IGlkZW50aWZpZXMgdGhpcyBjb250cmlidXRvcgogICAqLwogIGZ1bmN0aW9uIGJ1eVdpdGhDdXN0b21lcklkKHVpbnQxMjggY3VzdG9tZXJJZCkgcHVibGljIHBheWFibGUgewogICAgYnV5T25CZWhhbGZXaXRoQ3VzdG9tZXJJZChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNpYyBlbnRyeSBwb2ludCB0byBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlIHByb2Nlc3MuCiAgICoKICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgewogICAgYnV5T25CZWhhbGYobXNnLnNlbmRlcik7CiAgfQoKICAvKioKICAgKiBGaW5hbGl6ZSBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLgogICAqCiAgICogVGhlIG93bmVyIGNhbiB0cmlnZ2VyIHBvc3QtY3Jvd2RzYWxlIGFjdGlvbnMsIGxpa2UgcmVsZWFzaW5nIHRoZSB0b2tlbnMuCiAgICogTm90ZSB0aGF0IGJ5IGRlZmF1bHQgdG9rZW5zIGFyZSBub3QgaW4gYSByZWxlYXNlZCBzdGF0ZS4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewogICAgZmluYWxpemVkID0gdHJ1ZTsKICAgIEZpbmFsaXplZCgpOwogIH0KCiAgLyoqCiAgICogU2V0IHBvbGljeSBkbyB3ZSBuZWVkIHRvIGhhdmUgc2VydmVyLXNpZGUgY3VzdG9tZXIgaWRzIGZvciB0aGUgaW52ZXN0bWVudHMuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlQ3VzdG9tZXJJZChib29sIHZhbHVlKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmVDdXN0b21lcklkID0gdmFsdWU7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIFNldCBwb2xpY3kgaWYgYWxsIGludmVzdG9ycyBtdXN0IGJlIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIGZpcnN0LgogICAqCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3Mgc2lnbmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmVkU2lnbmVkQWRkcmVzcyA9IHZhbHVlOwogICAgc2lnbmVyQWRkcmVzcyA9IHNpZ25lcjsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgYWRkcmVzc2VzIHRvIGRvIGVhcmx5IHBhcnRpY2lwYXRpb24uCiAgICovCiAgZnVuY3Rpb24gc2V0RWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKSBwdWJsaWMgb25seU93bmVyIG5vdEZpbmlzaGVkIHN0b3BJbkVtZXJnZW5jeSB7CiAgICBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOwogICAgV2hpdGVsaXN0ZWQoYWRkciwgc3RhdHVzKTsKICB9CgogIC8qKgogICAqIEludGVybmFsIHNldHRlciBmb3IgdGhlIG11bHRpc2lnIHdhbGxldAogICAqLwogIGZ1bmN0aW9uIHNldE11bHRpc2lnKGFkZHJlc3MgYWRkcikgaW50ZXJuYWwgewogICAgcmVxdWlyZShhZGRyICE9IDApOwogICAgbXVsdGlzaWdXYWxsZXQgPSBhZGRyOwogIH0KCiAgLyoqCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4KICAgKgogICAqIFRoaXMgZnVuY3Rpb24gaGFzIHRoZSB0aW1lZCB0cmFuc2l0aW9uIGJ1aWx0aW4uCiAgICogU28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKFN0YXRlKSB7CiAgICBpZiAoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOwogICAgZWxzZSBpZiAoIWNvbmZpZ3VyZWQpIHJldHVybiBTdGF0ZS5QZW5kaW5nQ29uZmlndXJhdGlvbjsKICAgIGVsc2UgaWYgKG5vdyA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKG5vdyA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLlN1Y2Nlc3M7CiAgfQoKICAvKiogSW50ZXJuYWwgZnVuY3Rpb25zIHRoYXQgZXhpc3QgdG8gcHJvdmlkZSBpbnZlcnNpb24gb2YgY29udHJvbCBzaG91bGQgdGhleSBiZSBvdmVycmlkZW4gKi8KCiAgLyoqIEludGVyZmFjZSBmb3IgdGhlIGNvbmNyZXRlIGluc3RhbmNlIHRvIGludGVyYWN0IHdpdGggdGhlIHRva2VuIGNvbnRyYWN0IGluIGEgY3VzdG9taXphYmxlIHdheSAqLwogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBpbnRlcm5hbDsKCiAgLyoqCiAgICogIERldGVybWluZSBpZiB0aGUgZ29hbCB3YXMgYWxyZWFkeSByZWFjaGVkIGluIHRoZSBjdXJyZW50IGNyb3dkc2FsZQogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCBmdWxsKTsKCiAgLyoqCiAgICogUmV0dXJucyBhbnkgZXhjZXNzIHdlaSByZWNlaXZlZAogICAqIAogICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIG92ZXJyaWRlbiB0byBwcm92aWRlIGEgZGlmZmVyZW50IHJlZnVuZGluZyBtZXRob2QuCiAgICovCiAgZnVuY3Rpb24gcmV0dXJuRXhjZWRlbnQodWludCBleGNlZGVudCwgYWRkcmVzcyByZWNlaXZlcikgaW50ZXJuYWwgewogICAgaWYgKGV4Y2VkZW50ID4gMCkgewogICAgICByZWNlaXZlci50cmFuc2ZlcihleGNlZGVudCk7CiAgICB9CiAgfQoKICAvKiogCiAgICogIENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSByZWNlaXZlZCBhbW91bnQuCiAgICogIFRoZSB3ZWkgYW1vdW50IGlzIHJldHVybmVkIHRvbyBpbiBjYXNlIG5vdCBhbGwgb2YgaXQgY2FuIGJlIGludmVzdGVkLgogICAqCiAgICogIE5vdGU6IFdoZW4gdGhlcmUncyBhbiBleGNlZGVudCBkdWUgdG8gcm91bmRpbmcgZXJyb3IsIGl0IHNob3VsZCBiZSByZXR1cm5lZCB0byBhbGxvdyByZWZ1bmRpbmcuCiAgICogIFRoaXMgaXMgd29ya2VkIGFyb3VuZCBpbiB0aGUgY3VycmVudCBkZXNpZ24gdXNpbmcgYW4gYXBwcm9wcmlhdGUgYW1vdW50IG9mIGRlY2ltYWxzIGluIHRoZSBGcmFjdGlvbmFsRVJDMjAgc3RhbmRhcmQuCiAgICogIFRoZSB3b3JrYXJvdW5kIGlzIGdvb2QgZW5vdWdoIGZvciBtb3N0IHVzZSBjYXNlcywgaGVuY2UgdGhlIHNpbXBsaWZpZWQgZnVuY3Rpb24gc2lnbmF0dXJlLgogICAqICBAcmV0dXJuIHdlaUFsbG93ZWQgVGhlIGFtb3VudCBvZiB3ZWkgYWNjZXB0ZWQgaW4gdGhpcyB0cmFuc2FjdGlvbi4KICAgKiAgQHJldHVybiB0b2tlbkFtb3VudCBUaGUgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIHRoZSByZWNlaXZlciBpbiB0aGlzIHRyYW5zYWN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuQW1vdW50KHVpbnQgd2VpQW1vdW50LCBhZGRyZXNzIHJlY2VpdmVyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgd2VpQWxsb3dlZCwgdWludCB0b2tlbkFtb3VudCk7CgogIC8vCiAgLy8gTW9kaWZpZXJzCiAgLy8KCiAgbW9kaWZpZXIgaW5TdGF0ZShTdGF0ZSBzdGF0ZSkgewogICAgcmVxdWlyZShnZXRTdGF0ZSgpID09IHN0YXRlKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB1bnNpZ25lZEJ1eUFsbG93ZWQoKSB7CiAgICByZXF1aXJlKCFyZXF1aXJlZFNpZ25lZEFkZHJlc3MpOwogICAgXzsKICB9CgogIC8qKiBNb2RpZmllciBhbGxvd2luZyBleGVjdXRpb24gb25seSBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBydW5uaW5nLiAgKi8KICBtb2RpZmllciBub3RGaW5pc2hlZCgpIHsKICAgIFN0YXRlIGN1cnJlbnRfc3RhdGUgPSBnZXRTdGF0ZSgpOwogICAgcmVxdWlyZShjdXJyZW50X3N0YXRlID09IFN0YXRlLlByZUZ1bmRpbmcgfHwgY3VycmVudF9zdGF0ZSA9PSBTdGF0ZS5GdW5kaW5nKTsKICAgIF87CiAgfQoKICBtb2RpZmllciB2YWxpZEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSB7CiAgICByZXF1aXJlKGN1c3RvbWVySWQgIT0gMCk7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICBfOwogIH0KfQpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCi8vIFNpbXBsZSBkZXBsb3ltZW50IGluZm9ybWF0aW9uIHN0b3JlIGluc2lkZSBjb250cmFjdCBzdG9yYWdlLgpjb250cmFjdCBEZXBsb3ltZW50SW5mbyB7CiAgdWludCBwcml2YXRlIGRlcGxveWVkX29uOwoKICBmdW5jdGlvbiBEZXBsb3ltZW50SW5mbygpIHB1YmxpYyB7CiAgICBkZXBsb3llZF9vbiA9IGJsb2NrLm51bWJlcjsKICB9CgoKICBmdW5jdGlvbiBnZXREZXBsb3ltZW50QmxvY2soKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gZGVwbG95ZWRfb247CiAgfQp9CgovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICoKICogSGVhdmlseSBtb2RpZmllZCBieSBodHRwczovL3d3dy5jb2luZmFicmlrLmNvbS8KICovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCgovLy8gQGRldiBUcmFuY2hlIGJhc2VkIHByaWNpbmcuCi8vLyAgICAgIEltcGxlbWVudGluZyAiZmlyc3QgcHJpY2UiIHRyYW5jaGVzLCBtZWFuaW5nLCB0aGF0IGlmIGEgYnV5ZXIncyBvcmRlciBpcwovLy8gICAgICBjb3ZlcmluZyBtb3JlIHRoYW4gb25lIHRyYW5jaGUsIHRoZSBwcmljZSBvZiB0aGUgbG93ZXN0IHRyYW5jaGUgd2lsbCBhcHBseQovLy8gICAgICB0byB0aGUgd2hvbGUgb3JkZXIuCmNvbnRyYWN0IFRva2VuVHJhbmNoZVByaWNpbmcgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgLyoqCiAgICogRGVmaW5lIHByaWNpbmcgc2NoZWR1bGUgdXNpbmcgdHJhbmNoZXMuCiAgICovCiAgc3RydWN0IFRyYW5jaGUgewogICAgICAvLyBBbW91bnQgaW4gdG9rZW5zIHdoZW4gdGhpcyB0cmFuY2hlIGJlY29tZXMgaW5hY3RpdmUKICAgICAgdWludCBhbW91bnQ7CiAgICAgIC8vIFRpbWVzdGFtcCBpbnRlcnZhbCBbc3RhcnQsIGVuZCkKICAgICAgLy8gU3RhcnRpbmcgdGltZXN0YW1wIChpbmNsdWRlZCBpbiB0aGUgaW50ZXJ2YWwpCiAgICAgIHVpbnQgc3RhcnQ7CiAgICAgIC8vIEVuZGluZyB0aW1lc3RhbXAgKGV4Y2x1ZGVkIGZyb20gdGhlIGludGVydmFsKQogICAgICB1aW50IGVuZDsKICAgICAgLy8gSG93IG1hbnkgdG9rZW5zIHBlciB3ZWkgeW91IHdpbGwgZ2V0IHdoaWxlIHRoaXMgdHJhbmNoZSBpcyBhY3RpdmUKICAgICAgdWludCBwcmljZTsKICB9CiAgLy8gV2UgZGVmaW5lIG9mZnNldHMgYW5kIHNpemUgZm9yIHRoZSBkZXNlcmlhbGl6YXRpb24gb2Ygb3JkZXJlZCB0dXBsZXMgaW4gcmF3IGFycmF5cwogIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBhbW91bnRfb2Zmc2V0ID0gMDsKICB1aW50IHByaXZhdGUgY29uc3RhbnQgc3RhcnRfb2Zmc2V0ID0gMTsKICB1aW50IHByaXZhdGUgY29uc3RhbnQgZW5kX29mZnNldCA9IDI7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHByaWNlX29mZnNldCA9IDM7CiAgdWludCBwcml2YXRlIGNvbnN0YW50IHRyYW5jaGVfc2l6ZSA9IDQ7CgogIFRyYW5jaGVbXSBwdWJsaWMgdHJhbmNoZXM7CgogIGZ1bmN0aW9uIGdldFRyYW5jaGVzTGVuZ3RoKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRyYW5jaGVzLmxlbmd0aDsKICB9CiAgCiAgLy8gVGhlIGNvbmZpZ3VyYXRpb24gZnJvbSB0aGUgY29uc3RydWN0b3Igd2FzIG1vdmVkIHRvIHRoZSBjb25maWd1cmF0aW9uVG9rZW5UcmFuY2hlUHJpY2luZyBmdW5jdGlvbi4KICAvLwogIC8vLyBAZGV2IENvbnN0cnVjdGlvbiwgY3JlYXRpbmcgYSBsaXN0IG9mIHRyYW5jaGVzCiAgLyogQHBhcmFtIGluaXRfdHJhbmNoZXMgUmF3IGFycmF5IG9mIG9yZGVyZWQgdHVwbGVzOiAoc3RhcnQgYW1vdW50LCBzdGFydCB0aW1lc3RhbXAsIGVuZCB0aW1lc3RhbXAsIHByaWNlKSAqLwogIC8vCiAgZnVuY3Rpb24gY29uZmlndXJhdGlvblRva2VuVHJhbmNoZVByaWNpbmcodWludFtdIGluaXRfdHJhbmNoZXMpIGludGVybmFsIHsKICAgIC8vIE5lZWQgdG8gaGF2ZSB0dXBsZXMsIGxlbmd0aCBjaGVjawogICAgcmVxdWlyZShpbml0X3RyYW5jaGVzLmxlbmd0aCAlIHRyYW5jaGVfc2l6ZSA9PSAwKTsKICAgIC8vIEEgdHJhbmNoZSB3aXRoIGFtb3VudCB6ZXJvIGNhbiBuZXZlciBiZSBzZWxlY3RlZCBhbmQgaXMgdGhlcmVmb3JlIHVzZWxlc3MuCiAgICAvLyBUaGlzIGNoZWNrIGFuZCB0aGUgb25lIGluc2lkZSB0aGUgbG9vcCBlbnN1cmUgbm8gdHJhbmNoZSBjYW4gaGF2ZSBhbiBhbW91bnQgZXF1YWwgdG8gemVyby4KICAgIHJlcXVpcmUoaW5pdF90cmFuY2hlc1thbW91bnRfb2Zmc2V0XSA+IDApOwoKICAgIHVpbnQgaW5wdXRfdHJhbmNoZXNfbGVuZ3RoID0gaW5pdF90cmFuY2hlcy5sZW5ndGguZGl2KHRyYW5jaGVfc2l6ZSk7CiAgICBUcmFuY2hlIG1lbW9yeSBsYXN0X3RyYW5jaGU7CiAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBpbnB1dF90cmFuY2hlc19sZW5ndGg7IGkrKykgewogICAgICB1aW50IHRyYW5jaGVfb2Zmc2V0ID0gaS5tdWwodHJhbmNoZV9zaXplKTsKICAgICAgdWludCBhbW91bnQgPSBpbml0X3RyYW5jaGVzW3RyYW5jaGVfb2Zmc2V0LmFkZChhbW91bnRfb2Zmc2V0KV07CiAgICAgIHVpbnQgc3RhcnQgPSBpbml0X3RyYW5jaGVzW3RyYW5jaGVfb2Zmc2V0LmFkZChzdGFydF9vZmZzZXQpXTsKICAgICAgdWludCBlbmQgPSBpbml0X3RyYW5jaGVzW3RyYW5jaGVfb2Zmc2V0LmFkZChlbmRfb2Zmc2V0KV07CiAgICAgIHVpbnQgcHJpY2UgPSBpbml0X3RyYW5jaGVzW3RyYW5jaGVfb2Zmc2V0LmFkZChwcmljZV9vZmZzZXQpXTsKICAgICAgLy8gTm8gaW52YWxpZCBzdGVwcwogICAgICByZXF1aXJlKHN0YXJ0IDwgZW5kICYmIG5vdyA8IGVuZCk7CiAgICAgIC8vIEJhaWwgb3V0IHdoZW4gZW50ZXJpbmcgdW5uZWNlc3NhcnkgdHJhbmNoZXMKICAgICAgLy8gVGhpcyBpcyBwcmVmZXJhYmx5IGNoZWNrZWQgYmVmb3JlIGRlcGxveWluZyBjb250cmFjdCBpbnRvIGFueSBibG9ja2NoYWluLgogICAgICByZXF1aXJlKGkgPT0gMCB8fCAoZW5kID49IGxhc3RfdHJhbmNoZS5lbmQgJiYgYW1vdW50ID4gbGFzdF90cmFuY2hlLmFtb3VudCkgfHwKICAgICAgICAgICAgICAoZW5kID4gbGFzdF90cmFuY2hlLmVuZCAmJiBhbW91bnQgPj0gbGFzdF90cmFuY2hlLmFtb3VudCkpOwoKICAgICAgbGFzdF90cmFuY2hlID0gVHJhbmNoZShhbW91bnQsIHN0YXJ0LCBlbmQsIHByaWNlKTsKICAgICAgdHJhbmNoZXMucHVzaChsYXN0X3RyYW5jaGUpOwogICAgfQogIH0KCiAgLy8vIEBkZXYgR2V0IHRoZSBjdXJyZW50IHRyYW5jaGUgb3IgYmFpbCBvdXQgaWYgdGhlcmUgaXMgbm8gdHJhbmNoZSBkZWZpbmVkIGZvciB0aGUgY3VycmVudCB0aW1lc3RhbXAuCiAgLy8vIEBwYXJhbSB0b2tlbnNTb2xkIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgc29sZCwgZm9yIGNhbGN1bGF0aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUKICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSBzdHJ1Y3QgcmVwcmVzZW50aW5nIHRoZSBjdXJyZW50IHRyYW5jaGUKICBmdW5jdGlvbiBnZXRDdXJyZW50VHJhbmNoZSh1aW50IHRva2Vuc1NvbGQpIHByaXZhdGUgdmlldyByZXR1cm5zIChUcmFuY2hlIHN0b3JhZ2UpIHsKICAgIGZvciAodWludCBpID0gMDsgaSA8IHRyYW5jaGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh0cmFuY2hlc1tpXS5zdGFydCA8PSBub3cgJiYgbm93IDwgdHJhbmNoZXNbaV0uZW5kICYmIHRva2Vuc1NvbGQgPCB0cmFuY2hlc1tpXS5hbW91bnQpIHsKICAgICAgICByZXR1cm4gdHJhbmNoZXNbaV07CiAgICAgIH0KICAgIH0KICAgIC8vIE5vIHRyYW5jaGUgaXMgY3VycmVudGx5IGFjdGl2ZQogICAgcmV2ZXJ0KCk7CiAgfQoKICAvLy8gQGRldiBHZXQgdGhlIGN1cnJlbnQgcHJpY2UuIE1heSByZXZlcnQgaWYgdGhlcmUgaXMgbm8gdHJhbmNoZSBjdXJyZW50bHkgYWN0aXZlLgogIC8vLyBAcGFyYW0gdG9rZW5zU29sZCB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHNvbGQsIGZvciBjYWxjdWxhdGluZyB0aGUgY3VycmVudCB0cmFuY2hlCiAgLy8vIEByZXR1cm4gVGhlIGN1cnJlbnQgcHJpY2UKICBmdW5jdGlvbiBnZXRDdXJyZW50UHJpY2UodWludCB0b2tlbnNTb2xkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgcmVzdWx0KSB7CiAgICByZXR1cm4gZ2V0Q3VycmVudFRyYW5jaGUodG9rZW5zU29sZCkucHJpY2U7CiAgfQoKfQoKLy8gVGhpcyBjb250cmFjdCBoYXMgdGhlIHNvbGUgb2JqZWN0aXZlIG9mIHByb3ZpZGluZyBhIHNhbmUgY29uY3JldGUgaW5zdGFuY2Ugb2YgdGhlIENyb3dkc2FsZSBjb250cmFjdC4KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIEdlbmVyaWNDcm93ZHNhbGUsIExvc3RBbmRGb3VuZFRva2VuLCBEZXBsb3ltZW50SW5mbywgVG9rZW5UcmFuY2hlUHJpY2luZyB7CiAgdWludCBwdWJsaWMgc2VsbGFibGVfdG9rZW5zOwogIHVpbnQgcHVibGljIGluaXRpYWxfdG9rZW5zOwogIHVpbnQgcHVibGljIG1pbGlldXJzX3Blcl9ldGg7IAoKICAvKgogICAqIFRoZSBjb25zdHJ1Y3RvciBmb3IgdGhlIGNyb3dkc2FsZSB3YXMgcmVtb3ZlZCBnaXZlbiBpdCBkaWRuJ3QgcmVjZWl2ZSBhbnkgYXJndW1lbnRzIG5vciBoYWQgYW55IGJvZHkuCiAgICoKICAgKiBUaGUgY29uZmlndXJhdGlvbiBmcm9tIHRoZSBjb25zdHJ1Y3RvciB3YXMgbW92ZWQgdG8gdGhlIGNvbmZpZ3VyYXRpb25Dcm93ZHNhbGUgZnVuY3Rpb24gd2hpY2ggY3JlYXRlcyB0aGUgdG9rZW4gY29udHJhY3QgYW5kIGFsc28gY2FsbHMgdGhlIGNvbmZpZ3VyYXRpb24gZnVuY3Rpb25zIGZyb20gR2VuZXJpY0Nyb3dkc2FsZSBhbmQgVG9rZW5UcmFuY2hlUHJpY2luZy4KICAgKiAKICAgKgogICAqIEBwYXJhbSB0ZWFtX211bHRpc2lnIEFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnbmF0dXJlIHdhbGxldCBvZiB0aGUgdGVhbSB0aGF0IHdpbGwgcmVjZWl2ZSBhbGwgdGhlIGZ1bmRzIGNvbnRyaWJ1dGVkIGluIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHN0YXJ0IFRpbWVzdGFtcCB3aGVyZSB0aGUgY3Jvd2RzYWxlIHdpbGwgYmUgb2ZmaWNpYWxseSBzdGFydGVkLiBJdCBzaG91bGQgYmUgZ3JlYXRlciB0aGFuIHRoZSB0aW1lc3RhbXAgaW4gd2hpY2ggdGhlIGNvbnRyYWN0IGlzIGRlcGxveWVkLgogICAqIEBwYXJhbSBlbmQgVGltZXN0YW1wIHdoZXJlIHRoZSBjcm93ZHNhbGUgZmluaXNoZXMuIE5vIHRva2VucyBjYW4gYmUgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QgYWZ0ZXIgdGhpcyB0aW1lc3RhbXAuCiAgICogQHBhcmFtIHRva2VuX3JldHJpZXZlciBBZGRyZXNzIHRoYXQgd2lsbCBoYW5kbGUgdG9rZW5zIGFjY2lkZW50YWxseSBzZW50IHRvIHRoZSB0b2tlbiBjb250cmFjdC4gU2VlIHRoZSBMb3N0QW5kRm91bmRUb2tlbiBhbmQgQ3Jvd2RzYWxlVG9rZW4gY29udHJhY3RzIGZvciBmdXJ0aGVyIGRldGFpbHMuCiAgICovCgogIGZ1bmN0aW9uIGNvbmZpZ3VyYXRpb25Dcm93ZHNhbGUoYWRkcmVzcyB0ZWFtX211bHRpc2lnLCB1aW50IHN0YXJ0LCB1aW50IGVuZCwgYWRkcmVzcyB0b2tlbl9yZXRyaWV2ZXIsIHVpbnRbXSBpbml0X3RyYW5jaGVzLCB1aW50IG11bHRpc2lnX3N1cHBseSwgdWludCBjcm93ZHNhbGVfc3VwcGx5LCB1aW50OCB0b2tlbl9kZWNpbWFscywgdWludCBtYXhfdG9rZW5zX3RvX3NlbGwpIHB1YmxpYyBvbmx5T3duZXIgewoKICAgICAgCiAgICAgIGluaXRpYWxfdG9rZW5zID0gbXVsdGlzaWdfc3VwcGx5OyAgCiAgICAgIHRva2VuID0gbmV3IENyb3dkc2FsZVRva2VuKG11bHRpc2lnX3N1cHBseSwgdG9rZW5fZGVjaW1hbHMsIHRlYW1fbXVsdGlzaWcsIHRva2VuX3JldHJpZXZlcik7CiAgICAgIC8vIE5lY2Vzc2FyeSBpZiBhc3NpZ25Ub2tlbnMgbWludHMKICAgICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIHRydWUpOwogICAgICAvLyBOZWNlc3NhcnkgaWYgZmluYWxpemUgaXMgb3ZlcnJpZGVuIHRvIHJlbGVhc2UgdGhlIHRva2VucyBmb3IgcHVibGljIHRyYWRpbmcuCiAgICAgIHRva2VuLnNldFJlbGVhc2VBZ2VudChhZGRyZXNzKHRoaXMpKTsKICAgICAgLy8gTmVjZXNzYXJ5IGZvciB0aGUgZXhlY3V0aW9uIG9mIGJ1eSBmdW5jdGlvbiBhbmQgb2YgdGhlIHN1YnNlcXVlbnQgQ3Jvd2RzYWxlVG9rZW4ncyB0cmFuc2ZlciBmdW5jdGlvbi4gCiAgICAgIHRva2VuLnNldFRyYW5zZmVyQWdlbnQoYWRkcmVzcyh0aGlzKSwgdHJ1ZSk7CiAgICAgIC8vIENyb3dkc2FsZSBtaW50cyB0byBoaW1zZWxmIHRoZSBpbml0aWFsIHN1cHBseQogICAgICB0b2tlbi5taW50KGFkZHJlc3ModGhpcyksIGNyb3dkc2FsZV9zdXBwbHkpOwoKICAgICAgc2VsbGFibGVfdG9rZW5zID0gbWF4X3Rva2Vuc190b19zZWxsOwoKICAgICAgLy8gQ29uZmlndXJhdGlvbiBmdW5jdGlvbmFsaXR5IGZvciBHZW5lcmljQ3Jvd2RzYWxlLgogICAgICBjb25maWd1cmF0aW9uR2VuZXJpY0Nyb3dkc2FsZSh0ZWFtX211bHRpc2lnLCBzdGFydCwgZW5kKTsKCiAgICAgIC8vIENvbmZpZ3VyYXRpb24gZnVuY3Rpb25hbGl0eSBmb3IgVG9rZW5UcmFuY2hlUHJpY2luZy4KICAgICAgY29uZmlndXJhdGlvblRva2VuVHJhbmNoZVByaWNpbmcoaW5pdF90cmFuY2hlcyk7CiAgfQoKICAvL3Rva2VuIGFzc2lnbmF0aW9uCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIGludGVybmFsIHsKICAgIHRva2VuLnRyYW5zZmVyKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CiAgfQoKICAvL3Rva2VuIGFtb3VudCBjYWxjdWxhdGlvbgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuQW1vdW50KHVpbnQgd2VpQW1vdW50LCBhZGRyZXNzIHJlY2VpdmVyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgd2VpQWxsb3dlZCwgdWludCB0b2tlbkFtb3VudCkgewogICAgdWludCB0b2tlbnNQZXJFdGggPSBnZXRDdXJyZW50UHJpY2UodG9rZW5zU29sZCkubXVsKG1pbGlldXJzX3Blcl9ldGgpLmRpdigxMDAwKTsKICAgIHVpbnQgbWF4V2VpQWxsb3dlZCA9IHNlbGxhYmxlX3Rva2Vucy5zdWIodG9rZW5zU29sZCkubXVsKDEgZXRoZXIpLmRpdih0b2tlbnNQZXJFdGgpOwogICAgd2VpQWxsb3dlZCA9IG1heFdlaUFsbG93ZWQubWluMjU2KHdlaUFtb3VudCk7CgogICAgcmVxdWlyZSh0b2tlbi5iYWxhbmNlT2YocmVjZWl2ZXIpLmFkZCh3ZWlBbGxvd2VkKSA+PSAxMDApOwogICAgCiAgICBpZiAod2VpQW1vdW50IDwgbWF4V2VpQWxsb3dlZCkgewogICAgICAvL0RpdmlkZWQgYnkgMTAwMCBiZWNhdXNlIGV0aCBldGhfcHJpY2VfaW5fZXVycyBpcyBtdWx0aXBsaWVkIGJ5IDEwMDAKICAgICAgdG9rZW5BbW91bnQgPSB0b2tlbnNQZXJFdGgubXVsKHdlaUFtb3VudCkuZGl2KDEgZXRoZXIpOwogICAgfQogICAgLy8gV2l0aCB0aGlzIGNhc2Ugd2UgbGV0IHRoZSBjcm93ZHNhbGUgZW5kIGV2ZW4gd2hlbiB0aGVyZSBhcmUgcm91bmRpbmcgZXJyb3JzIGR1ZSB0byB0aGUgdG9rZW5zIHRvIHdlaSByYXRpbwogICAgZWxzZSB7CiAgICAgIHRva2VuQW1vdW50ID0gc2VsbGFibGVfdG9rZW5zLnN1Yih0b2tlbnNTb2xkKTsKICAgIH0KICB9CgogIC8vVE9ETzogaW1wbGVtZW50IHRvIGNvbnRyb2wgZnVuZGluZyBzdGF0ZSBjcml0ZXJpb24KICBmdW5jdGlvbiBpc0Nyb3dkc2FsZUZ1bGwoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgZnVsbCkgewogICAgcmV0dXJuIHRva2Vuc1NvbGQgPj0gc2VsbGFibGVfdG9rZW5zOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjZXNzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dlciBwb3N0LWNyb3dkc2FsZSBhY3Rpb25zLCBsaWtlIHJlbGVhc2luZyB0aGUgdG9rZW5zLgogICAqIE5vdGUgdGhhdCBieSBkZWZhdWx0IHRva2VucyBhcmUgbm90IGluIGEgcmVsZWFzZWQgc3RhdGUuCiAgICovCiAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5TdWNjZXNzKSBvbmx5T3duZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIC8vVG9rZW5zIHNvbGQgKyBib3VudGllcyByZXByZXNlbnQgNzUlIG9mIHRoZSB0b3RhbCwgdGhlIG90aGVyIDI1JSBnb2VzIHRpIHRoZSBtdWx0aXNpZyB0byB0aGUgcGFydG5lcnMgYW5kIHRvIHJlZ3VsYXRlIG1hcmtldCAKICAgIHVpbnQgc29sZCA9IHRva2Vuc1NvbGQuYWRkKCAgaW5pdGlhbF90b2tlbnMpOwogICAgdWludCB0b1NoYXJlID0gc29sZC5tdWwoMjUpLmRpdig3NSkubXVsKDEwKip1aW50KHRva2VuLmRlY2ltYWxzKCkpKTsKICAgIHRva2VuLnNldE1pbnRBZ2VudChhZGRyZXNzKHRoaXMpLCB0cnVlKTsKICAgIHRva2VuLm1pbnQobXVsdGlzaWdXYWxsZXQsIHRvU2hhcmUpOwogICAgdG9rZW4uc2V0TWludEFnZW50KGFkZHJlc3ModGhpcyksIGZhbHNlKTsKICAgIHRva2VuLnJlbGVhc2VUb2tlblRyYW5zZmVyKCk7CiAgICB0b2tlbi5idXJuKHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSk7CiAgICBzdXBlci5maW5hbGl6ZSgpOwogIH0KCiAgLyoqCiAgICogVGhpcyBmdW5jdGlvbiBkZWNpZGVzIHdobyBoYW5kbGVzIGxvc3QgdG9rZW5zLgogICAqIERvIG5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIGlzIE5PVCBtZWFudCB0byBiZSB1c2VkIGluIGEgdG9rZW4gcmVmdW5kIG1lY2FobmlzbS4KICAgKiBJdHMgc29sZSBwdXJwb3NlIGlzIGRldGVybWluaW5nIHdobyBjYW4gbW92ZSBhcm91bmQgRVJDMjAgdG9rZW5zIGFjY2lkZW50YWxseSBzZW50IHRvIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gZ2V0TG9zdEFuZEZvdW5kTWFzdGVyKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gb3duZXI7CgogIH0KCiAgLy8gVGhlc2UgdHdvIHNldHRlcnMgYXJlIHByZXNlbnQgb25seSB0byBjb3JyZWN0IHRpbWVzdGFtcHMgaWYgdGhleSBhcmUgb2ZmIGZyb20gdGhlaXIgdGFyZ2V0IGRhdGUgYnkgbW9yZSB0aGFuLCBzYXksIGEgZGF5CiAgZnVuY3Rpb24gc2V0U3RhcnRpbmdUaW1lKHVpbnQgc3RhcnRpbmdUaW1lKSBwdWJsaWMgb25seU93bmVyIGluU3RhdGUoU3RhdGUuUHJlRnVuZGluZykgewogICAgICByZXF1aXJlKHN0YXJ0aW5nVGltZSA+IG5vdyAmJiBzdGFydGluZ1RpbWUgPCBlbmRzQXQpOwogICAgICBzdGFydHNBdCA9IHN0YXJ0aW5nVGltZTsKICB9CgogIGZ1bmN0aW9uIHNldEVuZGluZ1RpbWUodWludCBlbmRpbmdUaW1lKSBwdWJsaWMgb25seU93bmVyIG5vdEZpbmlzaGVkIHsKICAgICAgIHJlcXVpcmUoZW5kaW5nVGltZSA+IG5vdyAmJiBlbmRpbmdUaW1lID4gc3RhcnRzQXQpOwogICAgICAgZW5kc0F0ID0gZW5kaW5nVGltZTsKICB9CgoKCiAgZnVuY3Rpb24gdXBkYXRlRXVyc1BlckV0aCAodWludCBtaWxpZXVyc19hbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShtaWxpZXVyc19hbW91bnQgPj0gMTAwKTsKICAgIG1pbGlldXJzX3Blcl9ldGggPSBtaWxpZXVyc19hbW91bnQ7CiAgfQp9'.
	

]
