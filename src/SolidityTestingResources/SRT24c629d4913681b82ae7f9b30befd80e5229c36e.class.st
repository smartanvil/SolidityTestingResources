Class {
	#name : #SRT24c629d4913681b82ae7f9b30befd80e5229c36e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT24c629d4913681b82ae7f9b30befd80e5229c36e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogSU93bmVyc2hpcAogKgogKiBQZXJtaW5lbnQgb3duZXJzaGlwCiAqCiAqICNjcmVhdGVkIDAxLzEwLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJT3duZXJzaGlwIHsKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBgX2FjY291bnRgIGlzIHRoZSBjdXJyZW50IG93bmVyCiAgICAgKgogICAgICogQHBhcmFtIF9hY2NvdW50IFRoZSBhZGRyZXNzIHRvIHRlc3QgYWdhaW5zdAogICAgICovCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwoKCiAgICAvKioKICAgICAqIEdldHMgdGhlIGN1cnJlbnQgb3duZXIKICAgICAqCiAgICAgKiBAcmV0dXJuIGFkZHJlc3MgVGhlIGN1cnJlbnQgb3duZXIKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0T3duZXIoKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKfQoKCi8qKgogKiBPd25lcnNoaXAKICoKICogUGVybWluZW50IG93bmVyc2hpcAogKgogKiAjY3JlYXRlZCAwMS8xMC8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBPd25lcnNoaXAgaXMgSU93bmVyc2hpcCB7CgogICAgLy8gT3duZXIKICAgIGFkZHJlc3MgaW50ZXJuYWwgb3duZXI7CgoKICAgIC8qKgogICAgICogQWNjZXNzIGlzIHJlc3RyaWN0ZWQgdG8gdGhlIGN1cnJlbnQgb3duZXIKICAgICAqLwogICAgbW9kaWZpZXIgb25seV9vd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogVGhlIHB1Ymxpc2hlciBpcyB0aGUgaW5pdGFsIG93bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIE93bmVyc2hpcCgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBgX2FjY291bnRgIGlzIHRoZSBjdXJyZW50IG93bmVyCiAgICAgKgogICAgICogQHBhcmFtIF9hY2NvdW50IFRoZSBhZGRyZXNzIHRvIHRlc3QgYWdhaW5zdAogICAgICovCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FjY291bnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gX2FjY291bnQgPT0gb3duZXI7CiAgICB9CgoKICAgIC8qKgogICAgICogR2V0cyB0aGUgY3VycmVudCBvd25lcgogICAgICoKICAgICAqIEByZXR1cm4gYWRkcmVzcyBUaGUgY3VycmVudCBvd25lcgogICAgICovCiAgICBmdW5jdGlvbiBnZXRPd25lcigpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gb3duZXI7CiAgICB9Cn0KCgovKioKICogRVJDMjAgY29tcGF0aWJsZSB0b2tlbiBpbnRlcmZhY2UKICoKICogLSBJbXBsZW1lbnRzIEVSQyAyMCBUb2tlbiBzdGFuZGFyZAogKiAtIEltcGxlbWVudHMgc2hvcnQgYWRkcmVzcyBhdHRhY2sgZml4CiAqCiAqICNjcmVhdGVkIDI5LzA5LzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJVG9rZW4geyAKCiAgICAvKiogCiAgICAgKiBHZXQgdGhlIHRvdGFsIHN1cHBseSBvZiB0b2tlbnMKICAgICAqIAogICAgICogQHJldHVybiBUaGUgdG90YWwgc3VwcGx5CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgoKICAgIC8qKiAKICAgICAqIEdldCBiYWxhbmNlIG9mIGBfb3duZXJgIAogICAgICogCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCgogICAgLyoqIAogICAgICogU2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgICogCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgICogQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKiAKICAgICAqIFNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgICogCiAgICAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgb2YgdGhlIHNlbmRlcgogICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCgogICAgLyoqIAogICAgICogYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF92YWx1ZWAgdG9rZW5zCiAgICAgKiAKICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKiAKICAgICAqIEdldCB0aGUgYW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgdGhhdCBgX3NwZW5kZXJgIGlzIGFsbG93ZWQgdG8gc3BlbmQgZnJvbSBgX293bmVyYAogICAgICogCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IG93bmluZyB0b2tlbnMKICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgICAqIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgICovCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwp9CgoKLyoqCiAqIElNYW5hZ2VkVG9rZW4KICoKICogQWRkcyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uYWxpdHkgdG8gdGhlIGJhc2ljIEVSQzIwIHRva2VuCiAqIC0gTG9ja2luZwogKiAtIElzc3VpbmcKICogLSBCdXJuaW5nIAogKgogKiAjY3JlYXRlZCAyOS8wOS8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwppbnRlcmZhY2UgSU1hbmFnZWRUb2tlbiB7IAoKICAgIC8qKiAKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdG9rZW4gaXMgbG9ja2VkCiAgICAgKiAKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdG9rZW4gaXMgbG9ja2VkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzTG9ja2VkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogTG9ja3MgdGhlIHRva2VuIHNvIHRoYXQgdGhlIHRyYW5zZmVyaW5nIG9mIHZhbHVlIGlzIGRpc2FibGVkIAogICAgICoKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdW5sb2NraW5nIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBsb2NrKCkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKCiAgICAvKioKICAgICAqIFVubG9ja3MgdGhlIHRva2VuIHNvIHRoYXQgdGhlIHRyYW5zZmVyaW5nIG9mIHZhbHVlIGlzIGVuYWJsZWQgCiAgICAgKgogICAgICogQHJldHVybiBXaGV0aGVyIHRoZSB1bmxvY2tpbmcgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIHVubG9jaygpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCgogICAgLyoqCiAgICAgKiBJc3N1ZXMgYF92YWx1ZWAgbmV3IHRva2VucyB0byBgX3RvYAogICAgICoKICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gd2hpY2ggdGhlIHRva2VucyB3aWxsIGJlIGlzc3VlZAogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIG5ldyB0b2tlbnMgdG8gaXNzdWUKICAgICAqIEByZXR1cm4gV2hldGhlciB0aGUgdG9rZW5zIHdoZXJlIHN1Y2Vzc2Z1bGx5IGlzc3VlZCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gaXNzdWUoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogQnVybnMgYF92YWx1ZWAgdG9rZW5zIG9mIGBfZnJvbWAKICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZSB0b2tlbnMgdG8gYmUgYnVybmVkCiAgICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGJ1cm5lZAogICAgICogQHJldHVybiBXaGV0aGVyIHRoZSB0b2tlbnMgd2hlcmUgc3VjZXNzZnVsbHkgYnVybmVkIG9yIG5vdCAKICAgICAqLwogICAgZnVuY3Rpb24gYnVybihhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CgoKLyoqCiAqIElUb2tlblJldHJpZXZlcgogKgogKiBBbGxvd3MgdG9rZW5zIHRvIGJlIHJldHJpZXZlZCBmcm9tIGEgY29udHJhY3QKICoKICogI2NyZWF0ZWQgMjkvMDkvMjAxNwogKiAjYXV0aG9yIEZyYW5rIEJvbm5ldAogKi8KaW50ZXJmYWNlIElUb2tlblJldHJpZXZlciB7CgogICAgLyoqCiAgICAgKiBFeHRyYWN0cyB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QKICAgICAqCiAgICAgKiBAcGFyYW0gX3Rva2VuQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgRVJDMjAgY29tcGF0aWJsZSB0b2tlbgogICAgICovCiAgICBmdW5jdGlvbiByZXRyaWV2ZVRva2VucyhhZGRyZXNzIF90b2tlbkNvbnRyYWN0KSBwdWJsaWM7Cn0KCgovKioKICogVG9rZW5SZXRyaWV2ZXIKICoKICogQWxsb3dzIHRva2VucyB0byBiZSByZXRyaWV2ZWQgZnJvbSBhIGNvbnRyYWN0CiAqCiAqICNjcmVhdGVkIDE4LzEwLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmNvbnRyYWN0IFRva2VuUmV0cmlldmVyIGlzIElUb2tlblJldHJpZXZlciB7CgogICAgLyoqCiAgICAgKiBFeHRyYWN0cyB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QKICAgICAqCiAgICAgKiBAcGFyYW0gX3Rva2VuQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgRVJDMjAgY29tcGF0aWJsZSB0b2tlbgogICAgICovCiAgICBmdW5jdGlvbiByZXRyaWV2ZVRva2VucyhhZGRyZXNzIF90b2tlbkNvbnRyYWN0KSBwdWJsaWMgewogICAgICAgIElUb2tlbiB0b2tlbkluc3RhbmNlID0gSVRva2VuKF90b2tlbkNvbnRyYWN0KTsKICAgICAgICB1aW50IHRva2VuQmFsYW5jZSA9IHRva2VuSW5zdGFuY2UuYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIGlmICh0b2tlbkJhbGFuY2UgPiAwKSB7CiAgICAgICAgICAgIHRva2VuSW5zdGFuY2UudHJhbnNmZXIobXNnLnNlbmRlciwgdG9rZW5CYWxhbmNlKTsKICAgICAgICB9CiAgICB9Cn0KCgovKioKICogSUF1dGhlbnRpY2F0b3IgCiAqCiAqIEF1dGhlbnRpY2F0b3IgaW50ZXJmYWNlCiAqCiAqICNjcmVhdGVkIDE1LzEwLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJQXV0aGVudGljYXRvciB7CiAgICAKCiAgICAvKioKICAgICAqIEF1dGhlbnRpY2F0ZSAKICAgICAqCiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgYF9hY2NvdW50YCBpcyBhdXRoZW50aWNhdGVkIG9yIG5vdAogICAgICoKICAgICAqIEBwYXJhbSBfYWNjb3VudCBUaGUgYWNjb3VudCB0byBhdXRoZW50aWNhdGUKICAgICAqIEByZXR1cm4gd2hldGhlciBgX2FjY291bnRgIGlzIHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZShhZGRyZXNzIF9hY2NvdW50KSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKfQoKCi8qKgogKiBJQXV0aGVudGljYXRpb25NYW5hZ2VyIAogKgogKiBBbGxvd3MgdGhlIGF1dGhlbnRpY2F0aW9uIHByb2Nlc3MgdG8gYmUgZW5hYmxlZCBhbmQgZGlzYWJsZWQKICoKICogI2NyZWF0ZWQgMTUvMTAvMjAxNwogKiAjYXV0aG9yIEZyYW5rIEJvbm5ldAogKi8KaW50ZXJmYWNlIElBdXRoZW50aWNhdGlvbk1hbmFnZXIgewogICAgCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYXV0aGVudGljYXRpb24gaXMgZW5hYmxlZCBhbmQgZmFsc2UgCiAgICAgKiBvdGhlcndpc2UKICAgICAqCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIGNvbnZlcnRlciBpcyBjdXJyZW50bHkgYXV0aGVudGljYXRpbmcgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzQXV0aGVudGljYXRpbmcoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKCgogICAgLyoqCiAgICAgKiBFbmFibGUgYXV0aGVudGljYXRpb24KICAgICAqLwogICAgZnVuY3Rpb24gZW5hYmxlQXV0aGVudGljYXRpb24oKSBwdWJsaWM7CgoKICAgIC8qKgogICAgICogRGlzYWJsZSBhdXRoZW50aWNhdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlQXV0aGVudGljYXRpb24oKSBwdWJsaWM7Cn0KCgovKioKICogSVdpbmdzQWRhcHRlcgogKiAKICogV0lOR1MgREFPIFByaWNlIERpc2NvdmVyeSAmIFByb21vdGlvbiBQcmUtQmV0YSBodHRwczovL3d3dy53aW5ncy5haQogKgogKiAjY3JlYXRlZCAwNC8xMC8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwppbnRlcmZhY2UgSVdpbmdzQWRhcHRlciB7CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRvdGFsIHJhaXNlZCBhbW91bnQgb2YgRXRoZXIKICAgICAqCiAgICAgKiBDYW4gb25seSBpbmNyZWFzZSwgbWVhbmluZyBpZiB5b3Ugd2l0aGRyYXcgRVRIIGZyb20gdGhlIHdhbGxldCwgaXQgc2hvdWxkIGJlIG5vdCBtb2RpZmllZCAoeW91IGNhbiB1c2UgdHdvIGZpZWxkcyAKICAgICAqIHRvIGtlZXAgb25lIHdpdGggYSB0b3RhbCBhY2N1bXVsYXRlZCBhbW91bnQpIGFtb3VudCBvZiBFVEggaW4gY29udHJhY3QgYW5kIHRvdGFsQ29sbGVjdGVkIGZvciB0b3RhbCBhbW91bnQgb2YgRVRIIGNvbGxlY3RlZAogICAgICoKICAgICAqIEByZXR1cm4gVG90YWwgcmFpc2VkIEV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbENvbGxlY3RlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwp9CgoKLyoqCiAqIElQZXJzb25hbENyb3dkc2FsZVByb3h5CiAqCiAqICNjcmVhdGVkIDIyLzExLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJUGVyc29uYWxDcm93ZHNhbGVQcm94eSB7CgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMKICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyB0aGF0IG1zZy5zZW5kZXIgaXMgbm90IGEgY29udHJhY3QuIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSBpdCdzIAogICAgICogbm90IHBvc3NpYmxlIGZvciBhIGNvbnRyYWN0IHRvIHNwZWNpZnkgYSBnYXMgYW1vdW50IHdoZW4gY2FsbGluZyB0aGUgKGludGVybmFsKSBzZW5kKCkgCiAgICAgKiBmdW5jdGlvbi4gU29saWRpdHkgaW1wb3NlcyBhIG1heGltdW0gYW1vdW50IG9mIGdhcyAoMjMwMCBnYXMgYXQgdGhlIHRpbWUgb2Ygd3JpdGluZykKICAgICAqIAogICAgICogQ29udHJhY3RzIGNhbiBjYWxsIHRoZSBjb250cmlidXRlKCkgZnVuY3Rpb24gaW5zdGVhZAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZTsKfQoKCi8qKgogKiBQZXJzb25hbENyb3dkc2FsZVByb3h5CiAqCiAqICNjcmVhdGVkIDIyLzExLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmNvbnRyYWN0IFBlcnNvbmFsQ3Jvd2RzYWxlUHJveHkgaXMgSVBlcnNvbmFsQ3Jvd2RzYWxlUHJveHkgewoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgSUNyb3dkc2FsZSBwdWJsaWMgdGFyZ2V0OwogICAgCgogICAgLyoqCiAgICAgKiBEZXBsb3kgcHJveHkKICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIE93bmVyIG9mIHRoZSBwcm94eQogICAgICogQHBhcmFtIF90YXJnZXQgVGFyZ2V0IGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBQZXJzb25hbENyb3dkc2FsZVByb3h5KGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF90YXJnZXQpIHB1YmxpYyB7CiAgICAgICAgdGFyZ2V0ID0gSUNyb3dkc2FsZShfdGFyZ2V0KTsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGNvbnRyaWJ1dGlvbiBhbmQgZm9yd2FyZCB0byB0aGUgdGFyZ2V0IGNyb3dkc2FsZQogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIHRoYXQgbXNnLnNlbmRlciBpcyBub3QgYSBjb250cmFjdC4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIGl0J3MgCiAgICAgKiBub3QgcG9zc2libGUgZm9yIGEgY29udHJhY3QgdG8gc3BlY2lmeSBhIGdhcyBhbW91bnQgd2hlbiBjYWxsaW5nIHRoZSAoaW50ZXJuYWwpIHNlbmQoKSAKICAgICAqIGZ1bmN0aW9uLiBTb2xpZGl0eSBpbXBvc2VzIGEgbWF4aW11bSBhbW91bnQgb2YgZ2FzICgyMzAwIGdhcyBhdCB0aGUgdGltZSBvZiB3cml0aW5nKQogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgdGFyZ2V0LmNvbnRyaWJ1dGVGb3IudmFsdWUobXNnLnZhbHVlKShvd25lcik7CiAgICB9Cn0KCgovKioKICogSUNyb3dkc2FsZVByb3h5CiAqCiAqICNjcmVhdGVkIDIzLzExLzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmludGVyZmFjZSBJQ3Jvd2RzYWxlUHJveHkgewoKICAgIC8qKgogICAgICogUmVjZWl2ZSBldGhlciBhbmQgaXNzdWUgdG9rZW5zIHRvIHRoZSBzZW5kZXIKICAgICAqIAogICAgICogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyB0aGF0IG1zZy5zZW5kZXIgaXMgbm90IGEgY29udHJhY3QuIFRoaXMgaXMgcmVxdWlyZWQgYmVjYXVzZSBpdCdzIAogICAgICogbm90IHBvc3NpYmxlIGZvciBhIGNvbnRyYWN0IHRvIHNwZWNpZnkgYSBnYXMgYW1vdW50IHdoZW4gY2FsbGluZyB0aGUgKGludGVybmFsKSBzZW5kKCkgCiAgICAgKiBmdW5jdGlvbi4gU29saWRpdHkgaW1wb3NlcyBhIG1heGltdW0gYW1vdW50IG9mIGdhcyAoMjMwMCBnYXMgYXQgdGhlIHRpbWUgb2Ygd3JpdGluZykKICAgICAqIAogICAgICogQ29udHJhY3RzIGNhbiBjYWxsIHRoZSBjb250cmlidXRlKCkgZnVuY3Rpb24gaW5zdGVhZAogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZTsKCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gdGhlIHNlbmRlcgogICAgICoKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlKCkgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludCk7CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBldGhlciBhbmQgaXNzdWUgdG9rZW5zIHRvIGBfYmVuZWZpY2lhcnlgCiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0aGF0IHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlRm9yKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50KTsKfQoKCi8qKgogKiBDcm93ZHNhbGVQcm94eQogKgogKiAjY3JlYXRlZCAyMi8xMS8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBDcm93ZHNhbGVQcm94eSBpcyBJQ3Jvd2RzYWxlUHJveHkgewoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgSUNyb3dkc2FsZSBwdWJsaWMgdGFyZ2V0OwogICAgCgogICAgLyoqCiAgICAgKiBEZXBsb3kgcHJveHkKICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIE93bmVyIG9mIHRoZSBwcm94eQogICAgICogQHBhcmFtIF90YXJnZXQgVGFyZ2V0IGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBDcm93ZHNhbGVQcm94eShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfdGFyZ2V0KSBwdWJsaWMgewogICAgICAgIHRhcmdldCA9IElDcm93ZHNhbGUoX3RhcmdldCk7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBjb250cmlidXRpb24gYW5kIGZvcndhcmQgdG8gdGhlIGNyb3dkc2FsZQogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIHRoYXQgbXNnLnNlbmRlciBpcyBub3QgYSBjb250cmFjdC4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIGl0J3MgCiAgICAgKiBub3QgcG9zc2libGUgZm9yIGEgY29udHJhY3QgdG8gc3BlY2lmeSBhIGdhcyBhbW91bnQgd2hlbiBjYWxsaW5nIHRoZSAoaW50ZXJuYWwpIHNlbmQoKSAKICAgICAqIGZ1bmN0aW9uLiBTb2xpZGl0eSBpbXBvc2VzIGEgbWF4aW11bSBhbW91bnQgb2YgZ2FzICgyMzAwIGdhcyBhdCB0aGUgdGltZSBvZiB3cml0aW5nKQogICAgICovCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgdGFyZ2V0LmNvbnRyaWJ1dGVGb3IudmFsdWUobXNnLnZhbHVlKShtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gdGhlIHNlbmRlcgogICAgICoKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlKCkgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludCkgewogICAgICAgIHRhcmdldC5jb250cmlidXRlRm9yLnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcik7CiAgICB9CgoKICAgIC8qKgogICAgICogUmVjZWl2ZSBldGhlciBhbmQgaXNzdWUgdG9rZW5zIHRvIGBfYmVuZWZpY2lhcnlgCiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0aGF0IHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlRm9yKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdGFyZ2V0LmNvbnRyaWJ1dGVGb3IudmFsdWUobXNnLnZhbHVlKShfYmVuZWZpY2lhcnkpOwogICAgfQp9CgoKLyoqCiAqIElDcm93ZHNhbGUKICoKICogQmFzZSBjcm93ZHNhbGUgaW50ZXJmYWNlIHRvIG1hbmFnZSB0aGUgc2FsZSBvZiAKICogYW4gRVJDMjAgdG9rZW4KICoKICogI2NyZWF0ZWQgMDkvMDkvMjAxNwogKiAjYXV0aG9yIEZyYW5rIEJvbm5ldAogKi8KaW50ZXJmYWNlIElDcm93ZHNhbGUgewoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBjb250cmFjdCBpcyBjdXJyZW50bHkgaW4gdGhlIHByZXNhbGUgcGhhc2UKICAgICAqCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgaW4gcHJlc2FsZSBwaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBpc0luUHJlc2FsZVBoYXNlKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBjb250cmFjdCBpcyBjdXJyZW50bHkgaW4gdGhlIGVuZGVkIHN0YWdlCiAgICAgKgogICAgICogQHJldHVybiBUcnVlIGlmIGVuZGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzRW5kZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYF9iZW5lZmljaWFyeWAgaGFzIGEgYmFsYW5jZSBhbGxvY2F0ZWQKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRoYXQgdGhlIGJhbGFuY2UgaXMgYWxsb2NhdGVkIGZvcgogICAgICogQHBhcmFtIF9yZWxlYXNlRGF0ZSBUaGUgZGF0ZSBhZnRlciB3aGljaCB0aGUgYmFsYW5jZSBjYW4gYmUgd2l0aGRyYXduCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlcmUgaXMgYSBiYWxhbmNlIHRoYXQgYmVsb25ncyB0byBgX2JlbmVmaWNpYXJ5YAogICAgICovCiAgICBmdW5jdGlvbiBoYXNCYWxhbmNlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9yZWxlYXNlRGF0ZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CgoKICAgIC8qKiAKICAgICAqIEdldCB0aGUgYWxsb2NhdGVkIHRva2VuIGJhbGFuY2Ugb2YgYF9vd25lcmAKICAgICAqIAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBhbGxvY2F0ZWQgdG9rZW4gYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgYWxsb2NhdGVkIHRva2VuIGJhbGFuY2UKICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCgogICAgLyoqIAogICAgICogR2V0IHRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2Ugb2YgYF9vd25lcmAKICAgICAqIAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGFsbG9jYXRlZCBldGggYmFsYW5jZQogICAgICovCiAgICBmdW5jdGlvbiBldGhCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwoKCiAgICAvKiogCiAgICAgKiBHZXQgaW52ZXN0ZWQgYW5kIHJlZnVuZGFibGUgYmFsYW5jZSBvZiBgX293bmVyYCAob25seSBjb250cmlidXRpb25zIGR1cmluZyB0aGUgSUNPIHBoYXNlIGFyZSByZWdpc3RlcmVkKQogICAgICogCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIHJlZnVuZGFibGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgICogQHJldHVybiBUaGUgaW52ZXN0ZWQgcmVmdW5kYWJsZSBiYWxhbmNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZnVuZGFibGVFdGhCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwoKCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHJhdGUgYW5kIGJvbnVzIHJlbGVhc2UgZGF0ZQogICAgICoKICAgICAqIEBwYXJhbSBfcGhhc2UgVGhlIHBoYXNlIHRvIHVzZSB3aGlsZSBkZXRlcm1pbmluZyB0aGUgcmF0ZQogICAgICogQHBhcmFtIF92b2x1bWUgVGhlIGFtb3VudCB3ZWkgdXNlZCB0byBkZXRlcm1pbmUgd2hhdCB2b2x1bWUgbXVsdGlwbGllciB0byB1c2UKICAgICAqIEByZXR1cm4gVGhlIHJhdGUgdXNlZCBpbiBgX3BoYXNlYCBtdWx0aXBsaWVkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZvbHVtZSBtdWx0aXBsaWVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFJhdGUodWludCBfcGhhc2UsIHVpbnQgX3ZvbHVtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgoKICAgIC8qKgogICAgICogQ29udmVydCBgX3dlaWAgdG8gYW4gYW1vdW50IGluIHRva2VucyB1c2luZyAKICAgICAqIHRoZSBgX3JhdGVgCiAgICAgKgogICAgICogQHBhcmFtIF93ZWkgYW1vdW50IG9mIHdlaSB0byBjb252ZXJ0CiAgICAgKiBAcGFyYW0gX3JhdGUgcmF0ZSB0byB1c2UgZm9yIHRoZSBjb252ZXJzaW9uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBpbiB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gdG9Ub2tlbnModWludCBfd2VpLCB1aW50IF9yYXRlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gdGhlIHNlbmRlcgogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIHRoYXQgbXNnLnNlbmRlciBpcyBub3QgYSBjb250cmFjdC4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIGl0J3MgCiAgICAgKiBub3QgcG9zc2libGUgZm9yIGEgY29udHJhY3QgdG8gc3BlY2lmeSBhIGdhcyBhbW91bnQgd2hlbiBjYWxsaW5nIHRoZSAoaW50ZXJuYWwpIHNlbmQoKSAKICAgICAqIGZ1bmN0aW9uLiBTb2xpZGl0eSBpbXBvc2VzIGEgbWF4aW11bSBhbW91bnQgb2YgZ2FzICgyMzAwIGdhcyBhdCB0aGUgdGltZSBvZiB3cml0aW5nKQogICAgICogCiAgICAgKiBDb250cmFjdHMgY2FuIGNhbGwgdGhlIGNvbnRyaWJ1dGUoKSBmdW5jdGlvbiBpbnN0ZWFkCiAgICAgKi8KICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlOwoKCiAgICAvKioKICAgICAqIFJlY2VpdmUgZXRoZXIgYW5kIGlzc3VlIHRva2VucyB0byB0aGUgc2VuZGVyCiAgICAgKgogICAgICogQHJldHVybiBUaGUgYWNjZXB0ZWQgZXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGUoKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50KTsKCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gYF9iZW5lZmljaWFyeWAKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRoYXQgcmVjZWl2ZXMgdGhlIHRva2VucwogICAgICogQHJldHVybiBUaGUgYWNjZXB0ZWQgZXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGVGb3IoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQpOwoKCiAgICAvKioKICAgICAqIFdpdGhkcmF3IGFsbG9jYXRlZCB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKSBwdWJsaWM7CgoKICAgIC8qKgogICAgICogV2l0aGRyYXcgYWxsb2NhdGVkIGV0aGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RXRoZXIoKSBwdWJsaWM7CgoKICAgIC8qKgogICAgICogUmVmdW5kIGluIHRoZSBjYXNlIG9mIGFuIHVuc3VjY2Vzc2Z1bCBjcm93ZHNhbGUuIFRoZSAKICAgICAqIGNyb3dkc2FsZSBpcyBjb25zaWRlcmVkIHVuc3VjY2Vzc2Z1bCBpZiBtaW5BbW91bnQgd2FzIAogICAgICogbm90IHJhaXNlZCBiZWZvcmUgZW5kIG9mIHRoZSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljOwp9CgoKLyoqCiAqIENyb3dkc2FsZQogKgogKiBBYnN0cmFjdCBiYXNlIGNyb3dkc2FsZSBjb250cmFjdCB0aGF0IG1hbmFnZXMgdGhlIHNhbGUgb2YgCiAqIGFuIEVSQzIwIHRva2VuCiAqCiAqICNjcmVhdGVkIDI5LzA5LzIwMTcKICogI2F1dGhvciBGcmFuayBCb25uZXQKICovCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBJQ3Jvd2RzYWxlLCBPd25lcnNoaXAgewoKICAgIGVudW0gU3RhZ2VzIHsKICAgICAgICBEZXBsb3lpbmcsCiAgICAgICAgRGVwbG95ZWQsCiAgICAgICAgSW5Qcm9ncmVzcywKICAgICAgICBFbmRlZAogICAgfQoKICAgIHN0cnVjdCBCYWxhbmNlIHsKICAgICAgICB1aW50IGV0aDsKICAgICAgICB1aW50IHRva2VuczsKICAgICAgICB1aW50IGluZGV4OwogICAgfQoKICAgIHN0cnVjdCBQZXJjZW50YWdlIHsKICAgICAgICB1aW50IGV0aDsKICAgICAgICB1aW50IHRva2VuczsKICAgICAgICBib29sIG92ZXJ3cml0ZVJlbGVhc2VEYXRlOwogICAgICAgIHVpbnQgZml4ZWRSZWxlYXNlRGF0ZTsKICAgICAgICB1aW50IGluZGV4OyAKICAgIH0KCiAgICBzdHJ1Y3QgUGF5b3V0IHsKICAgICAgICB1aW50IHBlcmNlbnRhZ2U7CiAgICAgICAgdWludCB2ZXN0aW5nUGVyaW9kOwogICAgfQoKICAgIHN0cnVjdCBQaGFzZSB7CiAgICAgICAgdWludCByYXRlOwogICAgICAgIHVpbnQgZW5kOwogICAgICAgIHVpbnQgYm9udXNSZWxlYXNlRGF0ZTsKICAgICAgICBib29sIHVzZVZvbHVtZU11bHRpcGxpZXI7CiAgICB9CgogICAgc3RydWN0IFZvbHVtZU11bHRpcGxpZXIgewogICAgICAgIHVpbnQgcmF0ZU11bHRpcGxpZXI7CiAgICAgICAgdWludCBib251c1JlbGVhc2VEYXRlTXVsdGlwbGllcjsKICAgIH0KCiAgICAvLyBDcm93ZHNhbGUgZGV0YWlscwogICAgdWludCBwdWJsaWMgYmFzZVJhdGU7CiAgICB1aW50IHB1YmxpYyBtaW5BbW91bnQ7IAogICAgdWludCBwdWJsaWMgbWF4QW1vdW50OyAKICAgIHVpbnQgcHVibGljIG1pbkFjY2VwdGVkQW1vdW50OwogICAgdWludCBwdWJsaWMgbWluQW1vdW50UHJlc2FsZTsgCiAgICB1aW50IHB1YmxpYyBtYXhBbW91bnRQcmVzYWxlOwogICAgdWludCBwdWJsaWMgbWluQWNjZXB0ZWRBbW91bnRQcmVzYWxlOwoKICAgIC8vIENvbXBhbnkgYWRkcmVzcwogICAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7IAoKICAgIC8vIERlbm9taW5hdG9ycwogICAgdWludCBpbnRlcm5hbCBwZXJjZW50YWdlRGVub21pbmF0b3I7CiAgICB1aW50IGludGVybmFsIHRva2VuRGVub21pbmF0b3I7CgogICAgLy8gQ3Jvd2RzYWxlIHN0YXRlCiAgICB1aW50IHB1YmxpYyBzdGFydDsKICAgIHVpbnQgcHVibGljIHByZXNhbGVFbmQ7CiAgICB1aW50IHB1YmxpYyBjcm93ZHNhbGVFbmQ7CiAgICB1aW50IHB1YmxpYyByYWlzZWQ7CiAgICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRFdGg7CiAgICB1aW50IHB1YmxpYyBhbGxvY2F0ZWRUb2tlbnM7CiAgICBTdGFnZXMgcHVibGljIHN0YWdlOwoKICAgIC8vIFRva2VuIGNvbnRyYWN0CiAgICBJTWFuYWdlZFRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICAvLyBJbnZlc3RlZCBiYWxhbmNlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwcml2YXRlIGJhbGFuY2VzOwoKICAgIC8vIEFsb2NhdGVkIGJhbGFuY2VzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcodWludCA9PiBCYWxhbmNlKSkgcHJpdmF0ZSBhbGxvY2F0ZWQ7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludFtdKSBwcml2YXRlIGFsbG9jYXRlZEluZGV4OwoKICAgIC8vIFN0YWtlaG9sZGVycwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBQZXJjZW50YWdlKSBwcml2YXRlIHN0YWtlaG9sZGVyUGVyY2VudGFnZXM7CiAgICBhZGRyZXNzW10gcHJpdmF0ZSBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXg7CiAgICBQYXlvdXRbXSBwcml2YXRlIHN0YWtlaG9sZGVyc1BheW91dHM7CgogICAgLy8gQ3Jvd2RzYWxlIHBoYXNlcwogICAgUGhhc2VbXSBwcml2YXRlIHBoYXNlczsKCiAgICAvLyBWb2x1bWUgbXVsdGlwbGllcnMKICAgIG1hcHBpbmcgKHVpbnQgPT4gVm9sdW1lTXVsdGlwbGllcikgcHJpdmF0ZSB2b2x1bWVNdWx0aXBsaWVyczsKICAgIHVpbnRbXSBwcml2YXRlIHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzOwoKICAgIAogICAgLyoqCiAgICAgKiBUaHJvdyBpZiBhdCBzdGFnZSBvdGhlciB0aGFuIGN1cnJlbnQgc3RhZ2UKICAgICAqIAogICAgICogQHBhcmFtIF9zdGFnZSBleHBlY3RlZCBzdGFnZSB0byB0ZXN0IGZvcgogICAgICovCiAgICBtb2RpZmllciBhdF9zdGFnZShTdGFnZXMgX3N0YWdlKSB7CiAgICAgICAgcmVxdWlyZShzdGFnZSA9PSBfc3RhZ2UpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qKgogICAgICogT25seSBhZnRlciBjcm93ZHNhbGVFbmQgcGx1cyBgX3RpbWVgCiAgICAgKiAKICAgICAqIEBwYXJhbSBfdGltZSBUaW1lIHRvIHBhc3MKICAgICAqLwogICAgbW9kaWZpZXIgb25seV9hZnRlcih1aW50IF90aW1lKSB7CiAgICAgICAgcmVxdWlyZShub3cgPiBjcm93ZHNhbGVFbmQgKyBfdGltZSk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBPbmx5IGFmdGVyIGNyb3dkc2FsZQogICAgICovCiAgICBtb2RpZmllciBvbmx5X2FmdGVyX2Nyb3dkc2FsZSgpIHsKICAgICAgICByZXF1aXJlKG5vdyA+IGNyb3dkc2FsZUVuZCk7CiAgICAgICAgXzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBUaHJvdyBpZiBzZW5kZXIgaXMgbm90IGJlbmVmaWNpYXJ5CiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlfYmVuZWZpY2lhcnkoKSB7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IFByb3h5Q3JlYXRlZChhZGRyZXNzIHByb3h5LCBhZGRyZXNzIGJlbmVmaWNpYXJ5KTsKCgogICAgLyoqCiAgICAgKiBBbGxvd3MgdGhlIGltcGxlbWVudGluZyBjb250cmFjdCB0byB2YWxpZGF0ZSBhIAogICAgICogY29udHJpYnV0aW5nIGFjY291bnQKICAgICAqCiAgICAgKiBAcGFyYW0gX2NvbnRyaWJ1dG9yIEFkZHJlc3MgdGhhdCBpcyBiZWluZyB2YWxpZGF0ZWQKICAgICAqIEByZXR1cm4gV2hldGVyIHRoZSBjb250cmlidXRvciBpcyBhY2NlcHRlZCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gaXNBY2NlcHRlZENvbnRyaWJ1dG9yKGFkZHJlc3MgX2NvbnRyaWJ1dG9yKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwoKCiAgICAvKioKICAgICAqIFN0YXJ0IGluIHRoZSBkZXBsb3llZCBzdGFnZQogICAgICovCiAgICBmdW5jdGlvbiBDcm93ZHNhbGUoKSBwdWJsaWMgewogICAgICAgIHN0YWdlID0gU3RhZ2VzLkRlcGxveWluZzsKICAgIH0KCgogICAgLyoqCiAgICAgKiBTZXR1cCB0aGUgY3Jvd2RzYWxlCiAgICAgKgogICAgICogQHBhcmFtIF9zdGFydCBUaGUgdGltZXN0YW1wIG9mIHRoZSBzdGFydCBkYXRlCiAgICAgKiBAcGFyYW0gX3Rva2VuIFRoZSB0b2tlbiB0aGF0IGlzIHNvbGQKICAgICAqIEBwYXJhbSBfdG9rZW5EZW5vbWluYXRvciBUaGUgdG9rZW4gYW1vdW50IG9mIGRlY2ltYWxzIHRoYXQgdGhlIHRva2VuIHVzZXMKICAgICAqIEBwYXJhbSBfcGVyY2VudGFnZURlbm9taW5hdG9yIFRoZSBwZXJjaXNpb24gb2YgcGVyY2VudGFnZXMKICAgICAqIEBwYXJhbSBfbWluQW1vdW50UHJlc2FsZSBUaGUgbWluIGNhcCBmb3IgdGhlIHByZXNhbGUKICAgICAqIEBwYXJhbSBfbWF4QW1vdW50UHJlc2FsZSBUaGUgbWF4IGNhcCBmb3IgdGhlIHByZXNhbGUKICAgICAqIEBwYXJhbSBfbWluQWNjZXB0ZWRBbW91bnRQcmVzYWxlIFRoZSBsb3dlc3QgYWNjZXB0ZWQgYW1vdW50IGR1cmluZyB0aGUgcHJlc2FsZSBwaGFzZQogICAgICogQHBhcmFtIF9taW5BbW91bnQgVGhlIG1pbiBjYXAgZm9yIHRoZSBJQ08KICAgICAqIEBwYXJhbSBfbWF4QW1vdW50IFRoZSBtYXggY2FwIGZvciB0aGUgSUNPCiAgICAgKiBAcGFyYW0gX21pbkFjY2VwdGVkQW1vdW50IFRoZSBsb3dlc3QgYWNjZXB0ZWQgYW1vdW50IGR1cmluZyB0aGUgSUNPIHBoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwKHVpbnQgX3N0YXJ0LCBhZGRyZXNzIF90b2tlbiwgdWludCBfdG9rZW5EZW5vbWluYXRvciwgdWludCBfcGVyY2VudGFnZURlbm9taW5hdG9yLCB1aW50IF9taW5BbW91bnRQcmVzYWxlLCB1aW50IF9tYXhBbW91bnRQcmVzYWxlLCB1aW50IF9taW5BY2NlcHRlZEFtb3VudFByZXNhbGUsIHVpbnQgX21pbkFtb3VudCwgdWludCBfbWF4QW1vdW50LCB1aW50IF9taW5BY2NlcHRlZEFtb3VudCkgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIHRva2VuID0gSU1hbmFnZWRUb2tlbihfdG9rZW4pOwogICAgICAgIHRva2VuRGVub21pbmF0b3IgPSBfdG9rZW5EZW5vbWluYXRvcjsKICAgICAgICBwZXJjZW50YWdlRGVub21pbmF0b3IgPSBfcGVyY2VudGFnZURlbm9taW5hdG9yOwogICAgICAgIHN0YXJ0ID0gX3N0YXJ0OwogICAgICAgIG1pbkFtb3VudFByZXNhbGUgPSBfbWluQW1vdW50UHJlc2FsZTsKICAgICAgICBtYXhBbW91bnRQcmVzYWxlID0gX21heEFtb3VudFByZXNhbGU7CiAgICAgICAgbWluQWNjZXB0ZWRBbW91bnRQcmVzYWxlID0gX21pbkFjY2VwdGVkQW1vdW50UHJlc2FsZTsKICAgICAgICBtaW5BbW91bnQgPSBfbWluQW1vdW50OwogICAgICAgIG1heEFtb3VudCA9IF9tYXhBbW91bnQ7CiAgICAgICAgbWluQWNjZXB0ZWRBbW91bnQgPSBfbWluQWNjZXB0ZWRBbW91bnQ7CiAgICB9CgoKICAgIC8qKgogICAgICogU2V0dXAgcmF0ZXMgYW5kIHBoYXNlcwogICAgICoKICAgICAqIEBwYXJhbSBfYmFzZVJhdGUgVGhlIHJhdGUgd2l0aG91dCBib251cwogICAgICogQHBhcmFtIF9waGFzZVJhdGVzIFRoZSByYXRlcyBmb3IgZWFjaCBwaGFzZQogICAgICogQHBhcmFtIF9waGFzZVBlcmlvZHMgVGhlIHBlcmlvZHMgdGhhdCBlYWNoIHBoYXNlIGxhc3RzIChmaXJzdCBwaGFzZSBpcyB0aGUgcHJlc2FsZSBwaGFzZSkKICAgICAqIEBwYXJhbSBfcGhhc2VCb251c0xvY2t1cFBlcmlvZHMgVGhlIGxvY2t1cCBwZXJpb2QgdGhhdCBlYWNoIHBoYXNlIGxhc3RzCiAgICAgKiBAcGFyYW0gX3BoYXNlVXNlc1ZvbHVtZU11bHRpcGxpZXIgV2hldGVyIG9yIG5vdCB2b2x1bWUgYm9udXNzZXMgYXJlIHVzZWQgaW4gdGhlIHJlc3BlY3RpdmUgcGhhc2UKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBQaGFzZXModWludCBfYmFzZVJhdGUsIHVpbnRbXSBfcGhhc2VSYXRlcywgdWludFtdIF9waGFzZVBlcmlvZHMsIHVpbnRbXSBfcGhhc2VCb251c0xvY2t1cFBlcmlvZHMsIGJvb2xbXSBfcGhhc2VVc2VzVm9sdW1lTXVsdGlwbGllcikgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIGJhc2VSYXRlID0gX2Jhc2VSYXRlOwogICAgICAgIHByZXNhbGVFbmQgPSBzdGFydCArIF9waGFzZVBlcmlvZHNbMF07IC8vIEZpcnN0IHBoYXNlIGlzIGV4cGVjdGVkIHRvIGJlIHRoZSBwcmVzYWxlIHBoYXNlCiAgICAgICAgY3Jvd2RzYWxlRW5kID0gc3RhcnQ7IC8vIFBsdXMgdGhlIHN1bSBvZiB0aGUgcmF0ZSBwaGFzZXMKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3BoYXNlUmF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY3Jvd2RzYWxlRW5kICs9IF9waGFzZVBlcmlvZHNbaV07CiAgICAgICAgICAgIHBoYXNlcy5wdXNoKFBoYXNlKF9waGFzZVJhdGVzW2ldLCBjcm93ZHNhbGVFbmQsIDAsIF9waGFzZVVzZXNWb2x1bWVNdWx0aXBsaWVyW2ldKSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaWkgPSAwOyBpaSA8IF9waGFzZVJhdGVzLmxlbmd0aDsgaWkrKykgewogICAgICAgICAgICBpZiAoX3BoYXNlQm9udXNMb2NrdXBQZXJpb2RzW2lpXSA+IDApIHsKICAgICAgICAgICAgICAgIHBoYXNlc1tpaV0uYm9udXNSZWxlYXNlRGF0ZSA9IGNyb3dkc2FsZUVuZCArIF9waGFzZUJvbnVzTG9ja3VwUGVyaW9kc1tpaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogU2V0dXAgc3Rha2Vob2xkZXJzCiAgICAgKgogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlcnMgVGhlIGFkZHJlc3NlcyBvZiB0aGUgc3Rha2Vob2xkZXJzIChmaXJzdCBzdGFrZWhvbGRlciBpcyB0aGUgYmVuZWZpY2lhcnkpCiAgICAgKiBAcGFyYW0gX3N0YWtlaG9sZGVyRXRoUGVyY2VudGFnZXMgVGhlIGV0aCBwZXJjZW50YWdlcyBvZiB0aGUgc3Rha2Vob2xkZXJzCiAgICAgKiBAcGFyYW0gX3N0YWtlaG9sZGVyVG9rZW5QZXJjZW50YWdlcyBUaGUgdG9rZW4gcGVyY2VudGFnZXMgb2YgdGhlIHN0YWtlaG9sZGVycwogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0T3ZlcndyaXRlUmVsZWFzZURhdGVzIFdoZXRlciB0aGUgdmVzdGluZyBwZXJpb2QgaXMgb3ZlcndyaXR0ZW4gZm9yIHRoZSByZXNwZWN0aXZlIHN0YWtlaG9sZGVyCiAgICAgKiBAcGFyYW0gX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRGaXhlZFJlbGVhc2VEYXRlcyBUaGUgdmVzdGluZyBwZXJpb2QgYWZ0ZXIgd2hpY2ggdGhlIHdob2xlIHBlcmNlbnRhZ2Ugb2YgdGhlIHRva2VucyBpcyByZWxlYXNlZCB0byB0aGUgcmVzcGVjdGl2ZSBzdGFrZWhvbGRlcgogICAgICogQHBhcmFtIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0UGVyY2VudGFnZXMgVGhlIHBlcmNlbnRhZ2Ugb2YgdGhlIHRva2VucyB0aGF0IGlzIHJlbGVhc2VkIGF0IHRoZSByZXNwZWN0aXZlIGRhdGUKICAgICAqIEBwYXJhbSBfc3Rha2Vob2xkZXJUb2tlblBheW91dFZlc3RpbmdQZXJpb2RzIFRoZSB2ZXN0aW5nIHBlcmlvZCBhZnRlciB3aGljaCB0aGUgcmVzcGVjdGl2ZSBwZXJjZW50YWdlIG9mIHRoZSB0b2tlbnMgaXMgcmVsZWFzZWQKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBTdGFrZWhvbGRlcnMoYWRkcmVzc1tdIF9zdGFrZWhvbGRlcnMsIHVpbnRbXSBfc3Rha2Vob2xkZXJFdGhQZXJjZW50YWdlcywgdWludFtdIF9zdGFrZWhvbGRlclRva2VuUGVyY2VudGFnZXMsIGJvb2xbXSBfc3Rha2Vob2xkZXJUb2tlblBheW91dE92ZXJ3cml0ZVJlbGVhc2VEYXRlcywgdWludFtdIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0Rml4ZWRSZWxlYXNlRGF0ZXMsIHVpbnRbXSBfc3Rha2Vob2xkZXJUb2tlblBheW91dFBlcmNlbnRhZ2VzLCB1aW50W10gX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRWZXN0aW5nUGVyaW9kcykgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIGJlbmVmaWNpYXJ5ID0gX3N0YWtlaG9sZGVyc1swXTsgLy8gRmlyc3Qgc3Rha2Vob2xkZXIgaXMgZXhwZWN0ZWQgdG8gYmUgdGhlIGJlbmVmaWNpYXJ5CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3N0YWtlaG9sZGVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXgucHVzaChfc3Rha2Vob2xkZXJzW2ldKTsKICAgICAgICAgICAgc3Rha2Vob2xkZXJQZXJjZW50YWdlc1tfc3Rha2Vob2xkZXJzW2ldXSA9IFBlcmNlbnRhZ2UoCiAgICAgICAgICAgICAgICBfc3Rha2Vob2xkZXJFdGhQZXJjZW50YWdlc1tpXSwgCiAgICAgICAgICAgICAgICBfc3Rha2Vob2xkZXJUb2tlblBlcmNlbnRhZ2VzW2ldLCAKICAgICAgICAgICAgICAgIF9zdGFrZWhvbGRlclRva2VuUGF5b3V0T3ZlcndyaXRlUmVsZWFzZURhdGVzW2ldLAogICAgICAgICAgICAgICAgX3N0YWtlaG9sZGVyVG9rZW5QYXlvdXRGaXhlZFJlbGVhc2VEYXRlc1tpXSwgaSk7CiAgICAgICAgfQoKICAgICAgICAvLyBQZXJjZW50YWdlcyBhZGQgdXAgdG8gMTAwCiAgICAgICAgZm9yICh1aW50IGlpID0gMDsgaWkgPCBfc3Rha2Vob2xkZXJUb2tlblBheW91dFBlcmNlbnRhZ2VzLmxlbmd0aDsgaWkrKykgewogICAgICAgICAgICBzdGFrZWhvbGRlcnNQYXlvdXRzLnB1c2goUGF5b3V0KF9zdGFrZWhvbGRlclRva2VuUGF5b3V0UGVyY2VudGFnZXNbaWldLCBfc3Rha2Vob2xkZXJUb2tlblBheW91dFZlc3RpbmdQZXJpb2RzW2lpXSkpOwogICAgICAgIH0KICAgIH0KCiAgICAKICAgIC8qKgogICAgICogU2V0dXAgdm9sdW1lIG11bHRpcGxpZXJzCiAgICAgKgogICAgICogQHBhcmFtIF92b2x1bWVNdWx0aXBsaWVyUmF0ZXMgVGhlIHJhdGVzIHdpbGwgYmUgbXVsdGlwbGllZCBieSB0aGlzIHZhbHVlIChkZW5vbWluYXRlZCBieSA0KQogICAgICogQHBhcmFtIF92b2x1bWVNdWx0aXBsaWVyTG9ja3VwUGVyaW9kcyBUaGUgbG9ja3VwIHBlcmlvZHMgd2lsbCBiZSBtdWx0aXBsaWVkIGJ5IHRoaXMgdmFsdWUgKGRlbm9taW5hdGVkIGJ5IDQpCiAgICAgKiBAcGFyYW0gX3ZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzIFRoZSB2b2x1bWUgdGhyZXNob2xkcyBmb3IgZWFjaCByZXNwZWN0aXZlIG11bHRpcGxpZXIKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBWb2x1bWVNdWx0aXBsaWVycyh1aW50W10gX3ZvbHVtZU11bHRpcGxpZXJSYXRlcywgdWludFtdIF92b2x1bWVNdWx0aXBsaWVyTG9ja3VwUGVyaW9kcywgdWludFtdIF92b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcykgcHVibGljIG9ubHlfb3duZXIgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWluZykgewogICAgICAgIHJlcXVpcmUocGhhc2VzLmxlbmd0aCA+IDApOwogICAgICAgIHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzID0gX3ZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZvbHVtZU11bHRpcGxpZXJzW3ZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzW2ldXSA9IFZvbHVtZU11bHRpcGxpZXIoX3ZvbHVtZU11bHRpcGxpZXJSYXRlc1tpXSwgX3ZvbHVtZU11bHRpcGxpZXJMb2NrdXBQZXJpb2RzW2ldKTsKICAgICAgICB9CiAgICB9CiAgICAKCiAgICAvKioKICAgICAqIEFmdGVyIGNhbGxpbmcgdGhlIGRlcGxveSBmdW5jdGlvbiB0aGUgY3Jvd2RzYWxlCiAgICAgKiBydWxlcyBiZWNvbWUgaW1tdXRhYmxlIAogICAgICovCiAgICBmdW5jdGlvbiBkZXBsb3koKSBwdWJsaWMgb25seV9vd25lciBhdF9zdGFnZShTdGFnZXMuRGVwbG95aW5nKSB7CiAgICAgICAgcmVxdWlyZShwaGFzZXMubGVuZ3RoID4gMCk7CiAgICAgICAgcmVxdWlyZShzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXgubGVuZ3RoID4gMCk7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuRGVwbG95ZWQ7CiAgICB9CgoKICAgIC8qKgogICAgICogRGVwbG95IGEgY29udHJhY3QgdGhhdCBzZXJ2ZXMgYXMgYSBwcm94eSB0byAKICAgICAqIHRoZSBjcm93ZHNhbGUKICAgICAqCiAgICAgKiBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBkZXBvc2l0IGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlRGVwb3NpdEFkZHJlc3MoKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIGFkZHJlc3MgcHJveHkgPSBuZXcgQ3Jvd2RzYWxlUHJveHkobXNnLnNlbmRlciwgdGhpcyk7CiAgICAgICAgUHJveHlDcmVhdGVkKHByb3h5LCBtc2cuc2VuZGVyKTsKICAgICAgICByZXR1cm4gcHJveHk7CiAgICB9CgoKICAgIC8qKgogICAgICogRGVwbG95IGEgY29udHJhY3QgdGhhdCBzZXJ2ZXMgYXMgYSBwcm94eSB0byAKICAgICAqIHRoZSBjcm93ZHNhbGUKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBvd25lciBvZiB0aGUgcHJveHkKICAgICAqIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIGRlcG9zaXQgYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVEZXBvc2l0QWRkcmVzc0ZvcihhZGRyZXNzIF9iZW5lZmljaWFyeSkgcHVibGljIHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICBhZGRyZXNzIHByb3h5ID0gbmV3IENyb3dkc2FsZVByb3h5KF9iZW5lZmljaWFyeSwgdGhpcyk7CiAgICAgICAgUHJveHlDcmVhdGVkKHByb3h5LCBfYmVuZWZpY2lhcnkpOwogICAgICAgIHJldHVybiBwcm94eTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBEZXBsb3kgYSBjb250cmFjdCB0aGF0IHNlcnZlcyBhcyBhIHByb3h5IHRvIAogICAgICogdGhlIGNyb3dkc2FsZQogICAgICoKICAgICAqIENvbnRyaWJ1dGlvbnMgdGhyb3VnaCB0aGlzIGFkZHJlc3Mgd2lsbCBiZSBtYWRlIAogICAgICogZm9yIG1zZy5zZW5kZXIKICAgICAqCiAgICAgKiBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBkZXBvc2l0IGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlUGVyc29uYWxEZXBvc2l0QWRkcmVzcygpIHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgYWRkcmVzcyBwcm94eSA9IG5ldyBQZXJzb25hbENyb3dkc2FsZVByb3h5KG1zZy5zZW5kZXIsIHRoaXMpOwogICAgICAgIFByb3h5Q3JlYXRlZChwcm94eSwgbXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIHByb3h5OwogICAgfQoKCiAgICAvKioKICAgICAqIERlcGxveSBhIGNvbnRyYWN0IHRoYXQgc2VydmVzIGFzIGEgcHJveHkgdG8gCiAgICAgKiB0aGUgY3Jvd2RzYWxlCiAgICAgKgogICAgICogQ29udHJpYnV0aW9ucyB0aHJvdWdoIHRoaXMgYWRkcmVzcyB3aWxsIGJlIG1hZGUgCiAgICAgKiBmb3IgYF9iZW5lZmljaWFyeWAKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBvd25lciBvZiB0aGUgcHJveHkKICAgICAqIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIGRlcG9zaXQgYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBjcmVhdGVQZXJzb25hbERlcG9zaXRBZGRyZXNzRm9yKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIGFkZHJlc3MgcHJveHkgPSBuZXcgUGVyc29uYWxDcm93ZHNhbGVQcm94eShfYmVuZWZpY2lhcnksIHRoaXMpOwogICAgICAgIFByb3h5Q3JlYXRlZChwcm94eSwgX2JlbmVmaWNpYXJ5KTsKICAgICAgICByZXR1cm4gcHJveHk7CiAgICB9CgoKICAgIC8qKgogICAgICogUHJvdmUgdGhhdCBiZW5lZmljaWFyeSBpcyBhYmxlIHRvIHNpZ24gdHJhbnNhY3Rpb25zIAogICAgICogYW5kIHN0YXJ0IHRoZSBjcm93ZHNhbGUKICAgICAqLwogICAgZnVuY3Rpb24gY29uZmlybUJlbmVmaWNpYXJ5KCkgcHVibGljIG9ubHlfYmVuZWZpY2lhcnkgYXRfc3RhZ2UoU3RhZ2VzLkRlcGxveWVkKSB7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuSW5Qcm9ncmVzczsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNvbnRyYWN0IGlzIGN1cnJlbnRseSBpbiB0aGUgcHJlc2FsZSBwaGFzZQogICAgICoKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBpbiBwcmVzYWxlIHBoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzSW5QcmVzYWxlUGhhc2UoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN0YWdlID09IFN0YWdlcy5JblByb2dyZXNzICYmIG5vdyA+PSBzdGFydCAmJiBub3cgPD0gcHJlc2FsZUVuZDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGNvbnRyYWN0IGlzIGN1cnJlbnRseSBpbiB0aGUgZW5kZWQgc3RhZ2UKICAgICAqCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgZW5kZWQKICAgICAqLwogICAgZnVuY3Rpb24gaXNFbmRlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3RhZ2UgPT0gU3RhZ2VzLkVuZGVkOwogICAgfQoKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBgX2JlbmVmaWNpYXJ5YCBoYXMgYSBiYWxhbmNlIGFsbG9jYXRlZAogICAgICoKICAgICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgVGhlIGFjY291bnQgdGhhdCB0aGUgYmFsYW5jZSBpcyBhbGxvY2F0ZWQgZm9yCiAgICAgKiBAcGFyYW0gX3JlbGVhc2VEYXRlIFRoZSBkYXRlIGFmdGVyIHdoaWNoIHRoZSBiYWxhbmNlIGNhbiBiZSB3aXRoZHJhd24KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGVyZSBpcyBhIGJhbGFuY2UgdGhhdCBiZWxvbmdzIHRvIGBfYmVuZWZpY2lhcnlgCiAgICAgKi8KICAgIGZ1bmN0aW9uIGhhc0JhbGFuY2UoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX3JlbGVhc2VEYXRlKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFsbG9jYXRlZEluZGV4W19iZW5lZmljaWFyeV0ubGVuZ3RoID4gMCAmJiBfcmVsZWFzZURhdGUgPT0gYWxsb2NhdGVkSW5kZXhbX2JlbmVmaWNpYXJ5XVthbGxvY2F0ZWRbX2JlbmVmaWNpYXJ5XVtfcmVsZWFzZURhdGVdLmluZGV4XTsKICAgIH0KCgogICAgLyoqIAogICAgICogR2V0IHRoZSBhbGxvY2F0ZWQgdG9rZW4gYmFsYW5jZSBvZiBgX293bmVyYAogICAgICogCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGFsbG9jYXRlZCB0b2tlbiBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAgKiBAcmV0dXJuIFRoZSBhbGxvY2F0ZWQgdG9rZW4gYmFsYW5jZQogICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYWxsb2NhdGVkSW5kZXhbX293bmVyXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdW0gKz0gYWxsb2NhdGVkW19vd25lcl1bYWxsb2NhdGVkSW5kZXhbX293bmVyXVtpXV0udG9rZW5zOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN1bTsKICAgIH0KCgogICAgLyoqIAogICAgICogR2V0IHRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2Ugb2YgYF9vd25lcmAKICAgICAqIAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBhbGxvY2F0ZWQgZXRoIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGFsbG9jYXRlZCBldGggYmFsYW5jZQogICAgICovCiAgICBmdW5jdGlvbiBldGhCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYWxsb2NhdGVkSW5kZXhbX293bmVyXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdW0gKz0gYWxsb2NhdGVkW19vd25lcl1bYWxsb2NhdGVkSW5kZXhbX293bmVyXVtpXV0uZXRoOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN1bTsKICAgIH0KCgogICAgLyoqIAogICAgICogR2V0IGludmVzdGVkIGFuZCByZWZ1bmRhYmxlIGJhbGFuY2Ugb2YgYF9vd25lcmAgKG9ubHkgY29udHJpYnV0aW9ucyBkdXJpbmcgdGhlIElDTyBwaGFzZSBhcmUgcmVnaXN0ZXJlZCkKICAgICAqIAogICAgICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSByZWZ1bmRhYmxlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgICAqIEByZXR1cm4gVGhlIGludmVzdGVkIHJlZnVuZGFibGUgYmFsYW5jZQogICAgICovCiAgICBmdW5jdGlvbiByZWZ1bmRhYmxlRXRoQmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG5vdyA+IGNyb3dkc2FsZUVuZCAmJiByYWlzZWQgPCBtaW5BbW91bnQgPyBiYWxhbmNlc1tfb3duZXJdIDogMDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHBoYXNlIGJhc2VkIG9uIHRoZSBjdXJyZW50IHRpbWUKICAgICAqCiAgICAgKiBAcmV0dXJuIFRoZSBpbmRleCBvZiB0aGUgY3VycmVudCBwaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBnZXRDdXJyZW50UGhhc2UoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcGhhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChub3cgPD0gcGhhc2VzW2ldLmVuZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHVpbnQoLTEpOyAvLyBEb2VzIG5vdCBleGlzdCAodW5kZXJmbG93KQogICAgfQoKCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHJhdGUgYW5kIGJvbnVzIHJlbGVhc2UgZGF0ZQogICAgICoKICAgICAqIEBwYXJhbSBfcGhhc2UgVGhlIHBoYXNlIHRvIHVzZSB3aGlsZSBkZXRlcm1pbmluZyB0aGUgcmF0ZQogICAgICogQHBhcmFtIF92b2x1bWUgVGhlIGFtb3VudCB3ZWkgdXNlZCB0byBkZXRlcm1pbiB3aGF0IHZvbHVtZSBtdWx0aXBsaWVyIHRvIHVzZQogICAgICogQHJldHVybiBUaGUgcmF0ZSB1c2VkIGluIGBfcGhhc2VgIG11bHRpcGxpZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdm9sdW1lIG11bHRpcGxpZXIKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmF0ZSh1aW50IF9waGFzZSwgdWludCBfdm9sdW1lKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCByYXRlID0gMDsKICAgICAgICBpZiAoc3RhZ2UgPT0gU3RhZ2VzLkluUHJvZ3Jlc3MgJiYgbm93ID49IHN0YXJ0KSB7CiAgICAgICAgICAgIFBoYXNlIHN0b3JhZ2UgcGhhc2UgPSBwaGFzZXNbX3BoYXNlXTsKICAgICAgICAgICAgcmF0ZSA9IHBoYXNlLnJhdGU7CgogICAgICAgICAgICAvLyBGaW5kIHZvbHVtZSBtdWx0aXBsaWVyCiAgICAgICAgICAgIGlmIChwaGFzZS51c2VWb2x1bWVNdWx0aXBsaWVyICYmIHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzLmxlbmd0aCA+IDAgJiYgX3ZvbHVtZSA+PSB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1swXSkgewogICAgICAgICAgICAgICAgZm9yICh1aW50IGkgPSB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkcy5sZW5ndGg7IGkgPiAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX3ZvbHVtZSA+PSB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1tpIC0gMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgVm9sdW1lTXVsdGlwbGllciBzdG9yYWdlIG11bHRpcGxpZXIgPSB2b2x1bWVNdWx0aXBsaWVyc1t2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1tpIC0gMV1dOwogICAgICAgICAgICAgICAgICAgICAgICByYXRlICs9IHBoYXNlLnJhdGUgKiBtdWx0aXBsaWVyLnJhdGVNdWx0aXBsaWVyIC8gcGVyY2VudGFnZURlbm9taW5hdG9yOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHJhdGU7CiAgICB9CgoKICAgIC8qKgogICAgICogR2V0IGRpc3RyaWJ1dGlvbiBkYXRhIGJhc2VkIG9uIHRoZSBjdXJyZW50IHBoYXNlIGFuZCAKICAgICAqIHRoZSB2b2x1bWUgaW4gd2VpIHRoYXQgaXMgYmVpbmcgZGlzdHJpYnV0ZWQKICAgICAqIAogICAgICogQHBhcmFtIF9waGFzZSBUaGUgY3VycmVudCBjcm93ZHNhbGUgcGhhc2UKICAgICAqIEBwYXJhbSBfdm9sdW1lIFRoZSBhbW91bnQgd2VpIHVzZWQgdG8gZGV0ZXJtaW5lIHdoYXQgdm9sdW1lIG11bHRpcGxpZXIgdG8gdXNlCiAgICAgKiBAcmV0dXJuIFZvbHVtZXMgYW5kIGNvcnJlc3BvbmRpbmcgcmVsZWFzZSBkYXRlcwogICAgICovCiAgICBmdW5jdGlvbiBnZXREaXN0cmlidXRpb25EYXRhKHVpbnQgX3BoYXNlLCB1aW50IF92b2x1bWUpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludFtdLCB1aW50W10pIHsKICAgICAgICBQaGFzZSBzdG9yYWdlIHBoYXNlID0gcGhhc2VzW19waGFzZV07CiAgICAgICAgdWludCByZW1haW5pbmdWb2x1bWUgPSBfdm9sdW1lOwoKICAgICAgICBib29sIHVzaW5nTXVsdGlwbGllciA9IGZhbHNlOwogICAgICAgIHVpbnRbXSBtZW1vcnkgdm9sdW1lcyA9IG5ldyB1aW50W10oMSk7CiAgICAgICAgdWludFtdIG1lbW9yeSByZWxlYXNlRGF0ZXMgPSBuZXcgdWludFtdKDEpOwoKICAgICAgICAvLyBGaW5kIHZvbHVtZSBtdWx0aXBsaWVycwogICAgICAgIGlmIChwaGFzZS51c2VWb2x1bWVNdWx0aXBsaWVyICYmIHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzLmxlbmd0aCA+IDAgJiYgX3ZvbHVtZSA+PSB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1swXSkgewogICAgICAgICAgICB1aW50IHBoYXNlUmVsZWFzZVBlcmlvZCA9IHBoYXNlLmJvbnVzUmVsZWFzZURhdGUgLSBjcm93ZHNhbGVFbmQ7CiAgICAgICAgICAgIGZvciAodWludCBpID0gdm9sdW1lTXVsdGlwbGllclRocmVzaG9sZHMubGVuZ3RoOyBpID4gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBpZiAoX3ZvbHVtZSA+PSB2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1tpIC0gMV0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXVzaW5nTXVsdGlwbGllcikgewogICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWVzID0gbmV3IHVpbnRbXShpICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGVhc2VEYXRlcyA9IG5ldyB1aW50W10oaSArIDEpOwogICAgICAgICAgICAgICAgICAgICAgICB1c2luZ011bHRpcGxpZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgVm9sdW1lTXVsdGlwbGllciBzdG9yYWdlIG11bHRpcGxpZXIgPSB2b2x1bWVNdWx0aXBsaWVyc1t2b2x1bWVNdWx0aXBsaWVyVGhyZXNob2xkc1tpIC0gMV1dOwogICAgICAgICAgICAgICAgICAgIHVpbnQgcmVsZWFzZURhdGUgPSBwaGFzZS5ib251c1JlbGVhc2VEYXRlICsgcGhhc2VSZWxlYXNlUGVyaW9kICogbXVsdGlwbGllci5ib251c1JlbGVhc2VEYXRlTXVsdGlwbGllciAvIHBlcmNlbnRhZ2VEZW5vbWluYXRvcjsKICAgICAgICAgICAgICAgICAgICB1aW50IHZvbHVtZSA9IHJlbWFpbmluZ1ZvbHVtZSAtIHZvbHVtZU11bHRpcGxpZXJUaHJlc2hvbGRzW2kgLSAxXTsKCiAgICAgICAgICAgICAgICAgICAgLy8gU3RvcmUgaW5jcmVtZW50CiAgICAgICAgICAgICAgICAgICAgdm9sdW1lc1tpXSA9IHZvbHVtZTsKICAgICAgICAgICAgICAgICAgICByZWxlYXNlRGF0ZXNbaV0gPSByZWxlYXNlRGF0ZTsKCiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nVm9sdW1lIC09IHZvbHVtZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gU3RvcmUgaW5jcmVtZW50CiAgICAgICAgdm9sdW1lc1swXSA9IHJlbWFpbmluZ1ZvbHVtZTsKICAgICAgICByZWxlYXNlRGF0ZXNbMF0gPSBwaGFzZS5ib251c1JlbGVhc2VEYXRlOwoKICAgICAgICByZXR1cm4gKHZvbHVtZXMsIHJlbGVhc2VEYXRlcyk7CiAgICB9CgoKICAgIC8qKgogICAgICogQ29udmVydCBgX3dlaWAgdG8gYW4gYW1vdW50IGluIHRva2VucyB1c2luZyAKICAgICAqIHRoZSBgX3JhdGVgCiAgICAgKgogICAgICogQHBhcmFtIF93ZWkgYW1vdW50IG9mIHdlaSB0byBjb252ZXJ0CiAgICAgKiBAcGFyYW0gX3JhdGUgcmF0ZSB0byB1c2UgZm9yIHRoZSBjb252ZXJzaW9uCiAgICAgKiBAcmV0dXJuIEFtb3VudCBpbiB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gdG9Ub2tlbnModWludCBfd2VpLCB1aW50IF9yYXRlKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF93ZWkgKiBfcmF0ZSAqIHRva2VuRGVub21pbmF0b3IgLyAxIGV0aGVyOwogICAgfQoKCiAgICAvKioKICAgICAqIFJlY2VpdmUgRXRoIGFuZCBpc3N1ZSB0b2tlbnMgdG8gdGhlIHNlbmRlcgogICAgICogCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIHRoYXQgbXNnLnNlbmRlciBpcyBub3QgYSBjb250cmFjdC4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIGl0J3MgCiAgICAgKiBub3QgcG9zc2libGUgZm9yIGEgY29udHJhY3QgdG8gc3BlY2lmeSBhIGdhcyBhbW91bnQgd2hlbiBjYWxsaW5nIHRoZSAoaW50ZXJuYWwpIHNlbmQoKSAKICAgICAqIGZ1bmN0aW9uLiBTb2xpZGl0eSBpbXBvc2VzIGEgbWF4aW11bSBhbW91bnQgb2YgZ2FzICgyMzAwIGdhcyBhdCB0aGUgdGltZSBvZiB3cml0aW5nKQogICAgICogCiAgICAgKiBDb250cmFjdHMgY2FuIGNhbGwgdGhlIGNvbnRyaWJ1dGUoKSBmdW5jdGlvbiBpbnN0ZWFkCiAgICAgKi8KICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdHgub3JpZ2luKTsKICAgICAgICBfaGFuZGxlVHJhbnNhY3Rpb24obXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gdGhlIHNlbmRlcgogICAgICoKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBjb250cmlidXRlKCkgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfaGFuZGxlVHJhbnNhY3Rpb24obXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGV0aGVyIGFuZCBpc3N1ZSB0b2tlbnMgdG8gYF9iZW5lZmljaWFyeWAKICAgICAqCiAgICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IFRoZSBhY2NvdW50IHRoYXQgcmVjZWl2ZXMgdGhlIHRva2VucwogICAgICogQHJldHVybiBUaGUgYWNjZXB0ZWQgZXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGVGb3IoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gX2hhbmRsZVRyYW5zYWN0aW9uKF9iZW5lZmljaWFyeSwgbXNnLnZhbHVlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0byBlbmQgdGhlIGNyb3dkc2FsZSBieSBzZXR0aW5nIAogICAgICogdGhlIHN0YWdlIHRvIEVuZGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVuZENyb3dkc2FsZSgpIHB1YmxpYyBhdF9zdGFnZShTdGFnZXMuSW5Qcm9ncmVzcykgewogICAgICAgIHJlcXVpcmUobm93ID4gY3Jvd2RzYWxlRW5kIHx8IHJhaXNlZCA+PSBtYXhBbW91bnQpOwogICAgICAgIHJlcXVpcmUocmFpc2VkID49IG1pbkFtb3VudCk7CiAgICAgICAgc3RhZ2UgPSBTdGFnZXMuRW5kZWQ7CgogICAgICAgIC8vIFVubG9jayB0b2tlbgogICAgICAgIGlmICghdG9rZW4udW5sb2NrKCkpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBBbGxvY2F0ZSB0b2tlbnMgKG5vIGFsbG9jYXRpb24gY2FuIGJlIGRvbmUgYWZ0ZXIgdGhpcyBwZXJpb2QpCiAgICAgICAgdWludCB0b3RhbFRva2VuU3VwcGx5ID0gSVRva2VuKHRva2VuKS50b3RhbFN1cHBseSgpICsgYWxsb2NhdGVkVG9rZW5zOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHN0YWtlaG9sZGVyc1BheW91dHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgUGF5b3V0IHN0b3JhZ2UgcCA9IHN0YWtlaG9sZGVyc1BheW91dHNbaV07CiAgICAgICAgICAgIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc1Rva2Vucyh0b3RhbFRva2VuU3VwcGx5ICogcC5wZXJjZW50YWdlIC8gcGVyY2VudGFnZURlbm9taW5hdG9yLCBub3cgKyBwLnZlc3RpbmdQZXJpb2QpOwogICAgICAgIH0KCiAgICAgICAgLy8gQWxsb2NhdGUgcmVtYWluaW5nIEVUSAogICAgICAgIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc0V0aCh0aGlzLmJhbGFuY2UgLSBhbGxvY2F0ZWRFdGgsIDApOwogICAgfQoKCiAgICAvKioKICAgICAqIFdpdGhkcmF3IGFsbG9jYXRlZCB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKSBwdWJsaWMgewogICAgICAgIHVpbnQgdG9rZW5zVG9TZW5kID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhbGxvY2F0ZWRJbmRleFttc2cuc2VuZGVyXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50IHJlbGVhc2VEYXRlID0gYWxsb2NhdGVkSW5kZXhbbXNnLnNlbmRlcl1baV07CiAgICAgICAgICAgIGlmIChyZWxlYXNlRGF0ZSA8PSBub3cpIHsKICAgICAgICAgICAgICAgIEJhbGFuY2Ugc3RvcmFnZSBiID0gYWxsb2NhdGVkW21zZy5zZW5kZXJdW3JlbGVhc2VEYXRlXTsKICAgICAgICAgICAgICAgIHRva2Vuc1RvU2VuZCArPSBiLnRva2VuczsKICAgICAgICAgICAgICAgIGIudG9rZW5zID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRva2Vuc1RvU2VuZCA+IDApIHsKICAgICAgICAgICAgYWxsb2NhdGVkVG9rZW5zIC09IHRva2Vuc1RvU2VuZDsKICAgICAgICAgICAgaWYgKCF0b2tlbi5pc3N1ZShtc2cuc2VuZGVyLCB0b2tlbnNUb1NlbmQpKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBXaXRoZHJhdyBhbGxvY2F0ZWQgZXRoZXIKICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcigpIHB1YmxpYyB7CiAgICAgICAgdWludCBldGhUb1NlbmQgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFsbG9jYXRlZEluZGV4W21zZy5zZW5kZXJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgcmVsZWFzZURhdGUgPSBhbGxvY2F0ZWRJbmRleFttc2cuc2VuZGVyXVtpXTsKICAgICAgICAgICAgaWYgKHJlbGVhc2VEYXRlIDw9IG5vdykgewogICAgICAgICAgICAgICAgQmFsYW5jZSBzdG9yYWdlIGIgPSBhbGxvY2F0ZWRbbXNnLnNlbmRlcl1bcmVsZWFzZURhdGVdOwogICAgICAgICAgICAgICAgZXRoVG9TZW5kICs9IGIuZXRoOwogICAgICAgICAgICAgICAgYi5ldGggPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXRoVG9TZW5kID4gMCkgewogICAgICAgICAgICBhbGxvY2F0ZWRFdGggLT0gZXRoVG9TZW5kOwogICAgICAgICAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZChldGhUb1NlbmQpKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWZ1bmQgaW4gdGhlIGNhc2Ugb2YgYW4gdW5zdWNjZXNzZnVsIGNyb3dkc2FsZS4gVGhlIAogICAgICogY3Jvd2RzYWxlIGlzIGNvbnNpZGVyZWQgdW5zdWNjZXNzZnVsIGlmIG1pbkFtb3VudCB3YXMgCiAgICAgKiBub3QgcmFpc2VkIGJlZm9yZSBlbmQgb2YgdGhlIGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiByZWZ1bmQoKSBwdWJsaWMgb25seV9hZnRlcl9jcm93ZHNhbGUgYXRfc3RhZ2UoU3RhZ2VzLkluUHJvZ3Jlc3MpIHsKICAgICAgICByZXF1aXJlKHJhaXNlZCA8IG1pbkFtb3VudCk7CgogICAgICAgIHVpbnQgcmVjZWl2ZWRBbW91bnQgPSBiYWxhbmNlc1ttc2cuc2VuZGVyXTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IDA7CgogICAgICAgIGlmIChyZWNlaXZlZEFtb3VudCA+IDAgJiYgIW1zZy5zZW5kZXIuc2VuZChyZWNlaXZlZEFtb3VudCkpIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSByZWNlaXZlZEFtb3VudDsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogRmFpbHNhZmUgYW5kIGNsZWFuLXVwIG1lY2hhbmlzbQogICAgICovCiAgICBmdW5jdGlvbiBkZXN0cm95KCkgcHVibGljIG9ubHlfYmVuZWZpY2lhcnkgb25seV9hZnRlcigyIHllYXJzKSB7CiAgICAgICAgc2VsZmRlc3RydWN0KGJlbmVmaWNpYXJ5KTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBIYW5kbGUgaW5jb21pbmcgdHJhbnNhY3Rpb24KICAgICAqIAogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUb2tlbnMgYXJlIGlzc3VlZCB0byB0aGlzIGFjY291bnQKICAgICAqIEBwYXJhbSBfcmVjZWl2ZWQgVGhlIGFtb3VudCB0aGF0IHdhcyByZWNlaXZlZAogICAgICogQHJldHVybiBUaGUgYWNjZXB0ZWQgZXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIF9oYW5kbGVUcmFuc2FjdGlvbihhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfcmVjZWl2ZWQpIGludGVybmFsIGF0X3N0YWdlKFN0YWdlcy5JblByb2dyZXNzKSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmVxdWlyZShub3cgPj0gc3RhcnQgJiYgbm93IDw9IGNyb3dkc2FsZUVuZCk7CiAgICAgICAgcmVxdWlyZShpc0FjY2VwdGVkQ29udHJpYnV0b3IoX2JlbmVmaWNpYXJ5KSk7CgogICAgICAgIGlmIChpc0luUHJlc2FsZVBoYXNlKCkpIHsKICAgICAgICAgICAgcmV0dXJuIF9oYW5kbGVQcmVzYWxlVHJhbnNhY3Rpb24oCiAgICAgICAgICAgICAgICBfYmVuZWZpY2lhcnksIF9yZWNlaXZlZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIF9oYW5kbGVQdWJsaWNzYWxlVHJhbnNhY3Rpb24oCiAgICAgICAgICAgICAgICBfYmVuZWZpY2lhcnksIF9yZWNlaXZlZCk7CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqIEhhbmRsZSBpbmNvbWluZyB0cmFuc2FjdGlvbiBkdXJpbmcgdGhlIHByZXNhbGUgcGhhc2UKICAgICAqIAogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUb2tlbnMgYXJlIGlzc3VlZCB0byB0aGlzIGFjY291bnQKICAgICAqIEBwYXJhbSBfcmVjZWl2ZWQgVGhlIGFtb3VudCB0aGF0IHdhcyByZWNlaXZlZAogICAgICogQHJldHVybiBUaGUgYWNjZXB0ZWQgZXRoZXIgYW1vdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIF9oYW5kbGVQcmVzYWxlVHJhbnNhY3Rpb24oYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQgX3JlY2VpdmVkKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXF1aXJlKF9yZWNlaXZlZCA+PSBtaW5BY2NlcHRlZEFtb3VudFByZXNhbGUpOwogICAgICAgIHJlcXVpcmUocmFpc2VkIDwgbWF4QW1vdW50UHJlc2FsZSk7CgogICAgICAgIHVpbnQgYWNjZXB0ZWRBbW91bnQ7CiAgICAgICAgaWYgKHJhaXNlZCArIF9yZWNlaXZlZCA+IG1heEFtb3VudFByZXNhbGUpIHsKICAgICAgICAgICAgYWNjZXB0ZWRBbW91bnQgPSBtYXhBbW91bnRQcmVzYWxlIC0gcmFpc2VkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFjY2VwdGVkQW1vdW50ID0gX3JlY2VpdmVkOwogICAgICAgIH0KCiAgICAgICAgcmFpc2VkICs9IGFjY2VwdGVkQW1vdW50OwoKICAgICAgICAvLyBEdXJpbmcgdGhlIHByZXNhbGUgcGhhc2UgLSBOb24gcmVmdW5kYWJsZQogICAgICAgIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc0V0aChhY2NlcHRlZEFtb3VudCwgMCk7IAoKICAgICAgICAvLyBJc3N1ZSB0b2tlbnMKICAgICAgICBfZGlzdHJpYnV0ZVRva2VucyhfYmVuZWZpY2lhcnksIF9yZWNlaXZlZCwgYWNjZXB0ZWRBbW91bnQpOwogICAgICAgIHJldHVybiBhY2NlcHRlZEFtb3VudDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBIYW5kbGUgaW5jb21pbmcgdHJhbnNhY3Rpb24gZHVyaW5nIHRoZSBwdWJsaWNzYWxlIHBoYXNlCiAgICAgKiAKICAgICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgVG9rZW5zIGFyZSBpc3N1ZWQgdG8gdGhpcyBhY2NvdW50CiAgICAgKiBAcGFyYW0gX3JlY2VpdmVkIFRoZSBhbW91bnQgdGhhdCB3YXMgcmVjZWl2ZWQKICAgICAqIEByZXR1cm4gVGhlIGFjY2VwdGVkIGV0aGVyIGFtb3VudAogICAgICovCiAgICBmdW5jdGlvbiBfaGFuZGxlUHVibGljc2FsZVRyYW5zYWN0aW9uKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9yZWNlaXZlZCkgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmVxdWlyZShfcmVjZWl2ZWQgPj0gbWluQWNjZXB0ZWRBbW91bnQpOwogICAgICAgIHJlcXVpcmUocmFpc2VkID49IG1pbkFtb3VudFByZXNhbGUpOwogICAgICAgIHJlcXVpcmUocmFpc2VkIDwgbWF4QW1vdW50KTsKCiAgICAgICAgdWludCBhY2NlcHRlZEFtb3VudDsKICAgICAgICBpZiAocmFpc2VkICsgX3JlY2VpdmVkID4gbWF4QW1vdW50KSB7CiAgICAgICAgICAgIGFjY2VwdGVkQW1vdW50ID0gbWF4QW1vdW50IC0gcmFpc2VkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFjY2VwdGVkQW1vdW50ID0gX3JlY2VpdmVkOwogICAgICAgIH0KCiAgICAgICAgcmFpc2VkICs9IGFjY2VwdGVkQW1vdW50OwogICAgICAgIAogICAgICAgIC8vIER1cmluZyB0aGUgSUNPIHBoYXNlIC0gMTAwJSByZWZ1bmRhYmxlCiAgICAgICAgYmFsYW5jZXNbX2JlbmVmaWNpYXJ5XSArPSBhY2NlcHRlZEFtb3VudDsgCgogICAgICAgIC8vIElzc3VlIHRva2VucwogICAgICAgIF9kaXN0cmlidXRlVG9rZW5zKF9iZW5lZmljaWFyeSwgX3JlY2VpdmVkLCBhY2NlcHRlZEFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFjY2VwdGVkQW1vdW50OwogICAgfQoKCiAgICAvKioKICAgICAqIERpc3RyaWJ1dGUgdG9rZW5zIAogICAgICoKICAgICAqIFRva2VucyBjYW4gYmUgaXNzdWVkIGJ5IGluc3RydWN0aW5nIHRoZSB0b2tlbiBjb250cmFjdCB0byBjcmVhdGUgbmV3IHRva2VucyBvciBieSAKICAgICAqIGFsbG9jYXRpbmcgdG9rZW5zIGFuZCBpbnN0cnVjdGluZyB0aGUgdG9rZW4gY29udHJhY3QgdG8gY3JlYXRlIHRoZSB0b2tlbnMgbGF0ZXIKICAgICAqIAogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUb2tlbnMgYXJlIGlzc3VlZCB0byB0aGlzIGFjY291bnQKICAgICAqIEBwYXJhbSBfcmVjZWl2ZWQgVGhlIGFtb3VudCB0aGF0IHdhcyByZWNlaXZlZAogICAgICogQHBhcmFtIF9hY2NlcHRlZEFtb3VudCBUaGUgYW1vdW50IHRoYXQgd2FzIGFjY2VwdGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9kaXN0cmlidXRlVG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9yZWNlaXZlZCwgdWludCBfYWNjZXB0ZWRBbW91bnQpIHByaXZhdGUgewogICAgICAgIHVpbnQgdG9rZW5zVG9Jc3N1ZSA9IDA7CiAgICAgICAgdWludCBwaGFzZSA9IGdldEN1cnJlbnRQaGFzZSgpOwogICAgICAgIHZhciByYXRlID0gZ2V0UmF0ZShwaGFzZSwgX2FjY2VwdGVkQW1vdW50KTsKICAgICAgICBpZiAocmF0ZSA9PSAwKSB7CiAgICAgICAgICAgIHJldmVydCgpOyAvLyBQYXVzZWQgcGhhc2UKICAgICAgICB9CgogICAgICAgIC8vIFZvbHVtZSBtdWx0aXBsaWVycwogICAgICAgIHZhciAodm9sdW1lcywgcmVsZWFzZURhdGVzKSA9IGdldERpc3RyaWJ1dGlvbkRhdGEoCiAgICAgICAgICAgIHBoYXNlLCBfYWNjZXB0ZWRBbW91bnQpOwogICAgICAgIAogICAgICAgIC8vIEFsbG9jYXRlIHRva2VucwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHZvbHVtZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIHRva2Vuc0F0Q3VycmVudFJhdGUgPSB0b1Rva2Vucyh2b2x1bWVzW2ldLCByYXRlKTsKICAgICAgICAgICAgaWYgKHJhdGUgPiBiYXNlUmF0ZSAmJiByZWxlYXNlRGF0ZXNbaV0gPiBub3cpIHsKICAgICAgICAgICAgICAgIHVpbnQgYm9udXNUb2tlbnMgPSB0b2tlbnNBdEN1cnJlbnRSYXRlICogKHJhdGUgLSBiYXNlUmF0ZSkgLyByYXRlOwogICAgICAgICAgICAgICAgX2FsbG9jYXRlVG9rZW5zKF9iZW5lZmljaWFyeSwgYm9udXNUb2tlbnMsIHJlbGVhc2VEYXRlc1tpXSk7CgogICAgICAgICAgICAgICAgdG9rZW5zVG9Jc3N1ZSArPSB0b2tlbnNBdEN1cnJlbnRSYXRlIC0gYm9udXNUb2tlbnM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0b2tlbnNUb0lzc3VlICs9IHRva2Vuc0F0Q3VycmVudFJhdGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIElzc3VlIHRva2VucwogICAgICAgIGlmICh0b2tlbnNUb0lzc3VlID4gMCAmJiAhdG9rZW4uaXNzdWUoX2JlbmVmaWNpYXJ5LCB0b2tlbnNUb0lzc3VlKSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CgogICAgICAgIC8vIFJlZnVuZCBkdWUgdG8gbWF4IGNhcCBoaXQKICAgICAgICBpZiAoX3JlY2VpdmVkIC0gX2FjY2VwdGVkQW1vdW50ID4gMCAmJiAhX2JlbmVmaWNpYXJ5LnNlbmQoX3JlY2VpdmVkIC0gX2FjY2VwdGVkQW1vdW50KSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQWxsb2NhdGUgRVRICiAgICAgKgogICAgICogQHBhcmFtIF9iZW5lZmljaWFyeSBUaGUgYWNjb3VudCB0byBhbG9jYXRlIHRoZSBldGggZm9yCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIEVUSCB0byBhbGxvY2F0ZQogICAgICogQHBhcmFtIF9yZWxlYXNlRGF0ZSBUaGUgZGF0ZSBhZnRlciB3aGljaCB0aGUgZXRoIGNhbiBiZSB3aXRoZHJhd24KICAgICAqLyAgICAKICAgIGZ1bmN0aW9uIF9hbGxvY2F0ZUV0aChhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludCBfYW1vdW50LCB1aW50IF9yZWxlYXNlRGF0ZSkgaW50ZXJuYWwgewogICAgICAgIGlmIChoYXNCYWxhbmNlKF9iZW5lZmljaWFyeSwgX3JlbGVhc2VEYXRlKSkgewogICAgICAgICAgICBhbGxvY2F0ZWRbX2JlbmVmaWNpYXJ5XVtfcmVsZWFzZURhdGVdLmV0aCArPSBfYW1vdW50OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG9jYXRlZFtfYmVuZWZpY2lhcnldW19yZWxlYXNlRGF0ZV0gPSBCYWxhbmNlKAogICAgICAgICAgICAgICAgX2Ftb3VudCwgMCwgYWxsb2NhdGVkSW5kZXhbX2JlbmVmaWNpYXJ5XS5wdXNoKF9yZWxlYXNlRGF0ZSkgLSAxKTsKICAgICAgICB9CgogICAgICAgIGFsbG9jYXRlZEV0aCArPSBfYW1vdW50OwogICAgfQoKCiAgICAvKioKICAgICAqIEFsbG9jYXRlIFRva2VucwogICAgICoKICAgICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgVGhlIGFjY291bnQgdG8gYWxsb2NhdGUgdGhlIHRva2VucyBmb3IKICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGFsbG9jYXRlCiAgICAgKiBAcGFyYW0gX3JlbGVhc2VEYXRlIFRoZSBkYXRlIGFmdGVyIHdoaWNoIHRoZSB0b2tlbnMgY2FuIGJlIHdpdGhkcmF3bgogICAgICovICAgIAogICAgZnVuY3Rpb24gX2FsbG9jYXRlVG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9hbW91bnQsIHVpbnQgX3JlbGVhc2VEYXRlKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGhhc0JhbGFuY2UoX2JlbmVmaWNpYXJ5LCBfcmVsZWFzZURhdGUpKSB7CiAgICAgICAgICAgIGFsbG9jYXRlZFtfYmVuZWZpY2lhcnldW19yZWxlYXNlRGF0ZV0udG9rZW5zICs9IF9hbW91bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb2NhdGVkW19iZW5lZmljaWFyeV1bX3JlbGVhc2VEYXRlXSA9IEJhbGFuY2UoCiAgICAgICAgICAgICAgICAwLCBfYW1vdW50LCBhbGxvY2F0ZWRJbmRleFtfYmVuZWZpY2lhcnldLnB1c2goX3JlbGVhc2VEYXRlKSAtIDEpOwogICAgICAgIH0KCiAgICAgICAgYWxsb2NhdGVkVG9rZW5zICs9IF9hbW91bnQ7CiAgICB9CgoKICAgIC8qKgogICAgICogQWxsb2NhdGUgRVRIIGZvciBzdGFrZWhvbGRlcnMKICAgICAqCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIEVUSCB0byBhbGxvY2F0ZQogICAgICogQHBhcmFtIF9yZWxlYXNlRGF0ZSBUaGUgZGF0ZSBhZnRlciB3aGljaCB0aGUgZXRoIGNhbiBiZSB3aXRoZHJhd24KICAgICAqLyAgICAKICAgIGZ1bmN0aW9uIF9hbGxvY2F0ZVN0YWtlaG9sZGVyc0V0aCh1aW50IF9hbW91bnQsIHVpbnQgX3JlbGVhc2VEYXRlKSBpbnRlcm5hbCB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIFBlcmNlbnRhZ2Ugc3RvcmFnZSBwID0gc3Rha2Vob2xkZXJQZXJjZW50YWdlc1tzdGFrZWhvbGRlclBlcmNlbnRhZ2VzSW5kZXhbaV1dOwogICAgICAgICAgICBpZiAocC5ldGggPiAwKSB7CiAgICAgICAgICAgICAgICBfYWxsb2NhdGVFdGgoc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4W2ldLCBfYW1vdW50ICogcC5ldGggLyBwZXJjZW50YWdlRGVub21pbmF0b3IsIF9yZWxlYXNlRGF0ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQWxsb2NhdGUgVG9rZW5zIGZvciBzdGFrZWhvbGRlcnMKICAgICAqCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyBjcmVhdGVkCiAgICAgKiBAcGFyYW0gX3JlbGVhc2VEYXRlIFRoZSBkYXRlIGFmdGVyIHdoaWNoIHRoZSB0b2tlbnMgY2FuIGJlIHdpdGhkcmF3biAodW5sZXNzIG92ZXJ3aXR0ZW4pCiAgICAgKi8gICAgCiAgICBmdW5jdGlvbiBfYWxsb2NhdGVTdGFrZWhvbGRlcnNUb2tlbnModWludCBfYW1vdW50LCB1aW50IF9yZWxlYXNlRGF0ZSkgaW50ZXJuYWwgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHN0YWtlaG9sZGVyUGVyY2VudGFnZXNJbmRleC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBQZXJjZW50YWdlIHN0b3JhZ2UgcCA9IHN0YWtlaG9sZGVyUGVyY2VudGFnZXNbc3Rha2Vob2xkZXJQZXJjZW50YWdlc0luZGV4W2ldXTsKICAgICAgICAgICAgaWYgKHAudG9rZW5zID4gMCkgewogICAgICAgICAgICAgICAgX2FsbG9jYXRlVG9rZW5zKAogICAgICAgICAgICAgICAgICAgIHN0YWtlaG9sZGVyUGVyY2VudGFnZXNJbmRleFtpXSwgCiAgICAgICAgICAgICAgICAgICAgX2Ftb3VudCAqIHAudG9rZW5zIC8gcGVyY2VudGFnZURlbm9taW5hdG9yLCAKICAgICAgICAgICAgICAgICAgICBwLm92ZXJ3cml0ZVJlbGVhc2VEYXRlID8gcC5maXhlZFJlbGVhc2VEYXRlIDogX3JlbGVhc2VEYXRlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCi8qKgogKiBLQVRYQ3Jvd2RzYWxlCiAqCiAqIEJpdGNvaW5BVE1zIGZvciBFdmVyeW9uZQogKgogKiBXaXRoIEtyaXB0b0FUTSBub3cgZXZlcnlvbmUgaGFzIGFjY2VzcyB0byBCaXRjb2luLCBFdGhlcmV1bSwgYW5kIGEgd2lkZSByYW5nZSBvZiBvdGhlciBjcnlwdG9jdXJyZW5jaWVzLiBXZSBsZXQgeW91IAogKiBicmluZyBjcnlwdG8gdG8gbmV3IHBsYWNlcyAtIHdpdGggb3VyIGlubm92YXRpdmUgbmV3IGZlYXR1cmVzLCBzdGF0ZS1vZi10aGUtYXJ0IHRlY2hub2xvZ3kgYW5kIG91ciBzaW1wbGUtdG8tdXNlIGFwcHJvYWNoLgogKgogKiAjY3JlYXRlZCAxMC8xMS8yMDE3CiAqICNhdXRob3IgRnJhbmsgQm9ubmV0CiAqLwpjb250cmFjdCBLQVRYQ3Jvd2RzYWxlIGlzIENyb3dkc2FsZSwgVG9rZW5SZXRyaWV2ZXIsIElBdXRoZW50aWNhdGlvbk1hbmFnZXIsIElXaW5nc0FkYXB0ZXIgewoKICAgIC8vIEF1dGhlbnRpY2F0aW9uCiAgICBJQXV0aGVudGljYXRvciBwcml2YXRlIGF1dGhlbnRpY2F0b3I7CiAgICBib29sIHByaXZhdGUgcmVxdWlyZUF1dGhlbnRpY2F0aW9uOwoKCiAgICAvKioKICAgICAqIFNldHVwIGF1dGhlbnRpY2F0aW9uCiAgICAgKgogICAgICogQHBhcmFtIF9hdXRoZW50aWNhdG9yIFRoZSBhZGRyZXNzIG9mIHRoZSBhdXRoZW50aWNhdG9yICh3aGl0ZWxpc3QpCiAgICAgKiBAcGFyYW0gX3JlcXVpcmVBdXRoZW50aWNhdGlvbiBXZXRoZXIgdGhlIGNyb3dkYWxlIHJlcXVpcmVzIGNvbnRyaWJ1dG9ycyB0byBiZSBhdXRoZW50aWNhdGVkCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwQXV0aGVudGljYXRpb24oYWRkcmVzcyBfYXV0aGVudGljYXRvciwgYm9vbCBfcmVxdWlyZUF1dGhlbnRpY2F0aW9uKSBwdWJsaWMgb25seV9vd25lciBhdF9zdGFnZShTdGFnZXMuRGVwbG95aW5nKSB7CiAgICAgICAgYXV0aGVudGljYXRvciA9IElBdXRoZW50aWNhdG9yKF9hdXRoZW50aWNhdG9yKTsKICAgICAgICByZXF1aXJlQXV0aGVudGljYXRpb24gPSBfcmVxdWlyZUF1dGhlbnRpY2F0aW9uOwogICAgfQoKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBgX21lbWJlcmAgaXMgYWxsb3dlZCB0byBjb250cmlidXRlCiAgICAgKgogICAgICogQHBhcmFtIF9tZW1iZXIgQWNjb3VudCB0aGF0IGlzIGJlaW5nIHZhbGlkYXRlZAogICAgICogQHJldHVybiBXaGV0ZXIgdGhlIERDT1JQIGlzIGFjY2VwdGVkIG9yIG5vdAogICAgICovCiAgICBmdW5jdGlvbiBpc0FjY2VwdGVkRGNvcnBNZW1iZXIoYWRkcmVzcyBfbWVtYmVyKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGlzQWNjZXB0ZWRDb250cmlidXRvcihfbWVtYmVyKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZWNlaXZlIGEgY29udHJpYnV0aW9uIGZyb20gYSBEQ09SUCBtZW1iZXIKICAgICAqCiAgICAgKiBAcGFyYW0gX21lbWJlciBBY2NvdW50IHRoYXQgaXMgY29udHJpYnV0aW5nCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRyaWJ1dGVGb3JEY29ycE1lbWJlcihhZGRyZXNzIF9tZW1iZXIpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBfaGFuZGxlVHJhbnNhY3Rpb24oX21lbWJlciwgbXNnLnZhbHVlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBXaW5ncyBpbnRlZ3JhdGlvbiAtIEdldCB0aGUgdG90YWwgcmFpc2VkIGFtb3VudCBvZiBFdGhlcgogICAgICoKICAgICAqIENhbiBvbmx5IGluY3JlYXNlZCwgbWVhbnMgaWYgeW91IHdpdGhkcmF3IEVUSCBmcm9tIHRoZSB3YWxsZXQsIHNob3VsZCBiZSBub3QgbW9kaWZpZWQgKHlvdSBjYW4gdXNlIHR3byBmaWVsZHMgCiAgICAgKiB0byBrZWVwIG9uZSB3aXRoIGEgdG90YWwgYWNjdW11bGF0ZWQgYW1vdW50KSBhbW91bnQgb2YgRVRIIGluIGNvbnRyYWN0IGFuZCB0b3RhbENvbGxlY3RlZCBmb3IgdG90YWwgYW1vdW50IG9mIEVUSCBjb2xsZWN0ZWQKICAgICAqCiAgICAgKiBAcmV0dXJuIFRvdGFsIHJhaXNlZCBFdGhlciBhbW91bnQKICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxDb2xsZWN0ZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHJhaXNlZDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYXV0aGVudGljYXRpb24gaXMgZW5hYmxlZCBhbmQgZmFsc2UgCiAgICAgKiBvdGhlcndpc2UKICAgICAqCiAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhlIGNvbnZlcnRlciBpcyBjdXJyZW50bHkgYXV0aGVudGljYXRpbmcgb3Igbm90CiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzQXV0aGVudGljYXRpbmcoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHJlcXVpcmVBdXRoZW50aWNhdGlvbjsKICAgIH0KCgogICAgLyoqCiAgICAgKiBFbmFibGUgYXV0aGVudGljYXRpb24KICAgICAqLwogICAgZnVuY3Rpb24gZW5hYmxlQXV0aGVudGljYXRpb24oKSBwdWJsaWMgb25seV9vd25lciB7CiAgICAgICAgcmVxdWlyZUF1dGhlbnRpY2F0aW9uID0gdHJ1ZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBEaXNhYmxlIGF1dGhlbnRpY2F0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRpc2FibGVBdXRoZW50aWNhdGlvbigpIHB1YmxpYyBvbmx5X293bmVyIHsKICAgICAgICByZXF1aXJlQXV0aGVudGljYXRpb24gPSBmYWxzZTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBBbGxvd3MgdGhlIGltcGxlbWVudGluZyBjb250cmFjdCB0byB2YWxpZGF0ZSBhIAogICAgICogY29udHJpYnV0aW5nIGFjY291bnQKICAgICAqCiAgICAgKiBAcGFyYW0gX2NvbnRyaWJ1dG9yIEFkZHJlc3MgdGhhdCBpcyBiZWluZyB2YWxpZGF0ZWQKICAgICAqIEByZXR1cm4gV2hldGVyIHRoZSBjb250cmlidXRvciBpcyBhY2NlcHRlZCBvciBub3QKICAgICAqLwogICAgZnVuY3Rpb24gaXNBY2NlcHRlZENvbnRyaWJ1dG9yKGFkZHJlc3MgX2NvbnRyaWJ1dG9yKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gIXJlcXVpcmVBdXRoZW50aWNhdGlvbiB8fCBhdXRoZW50aWNhdG9yLmF1dGhlbnRpY2F0ZShfY29udHJpYnV0b3IpOwogICAgfQoKCiAgICAvKioKICAgICAqIEZhaWxzYWZlIG1lY2hhbmlzbQogICAgICogCiAgICAgKiBBbGxvd3MgdGhlIG93bmVyIHRvIHJldHJpZXZlIHRva2VucyBmcm9tIHRoZSBjb250cmFjdCB0aGF0IAogICAgICogbWlnaHQgaGF2ZSBiZWVuIHNlbmQgdGhlcmUgYnkgYWNjaWRlbnQKICAgICAqCiAgICAgKiBAcGFyYW0gX3Rva2VuQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgRVJDMjAgY29tcGF0aWJsZSB0b2tlbgogICAgICovCiAgICBmdW5jdGlvbiByZXRyaWV2ZVRva2VucyhhZGRyZXNzIF90b2tlbkNvbnRyYWN0KSBwdWJsaWMgb25seV9vd25lciB7CiAgICAgICAgc3VwZXIucmV0cmlldmVUb2tlbnMoX3Rva2VuQ29udHJhY3QpOwoKICAgICAgICAvLyBSZXRyaWV2ZSB0b2tlbnMgZnJvbSBvdXIgdG9rZW4gY29udHJhY3QKICAgICAgICBJVG9rZW5SZXRyaWV2ZXIodG9rZW4pLnJldHJpZXZlVG9rZW5zKF90b2tlbkNvbnRyYWN0KTsKICAgIH0KfQ=='.
	

]
