Class {
	#name : #SRTf1afddbed214dba82cb98d46ad0a96e643f7f6f6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf1afddbed214dba82cb98d46ad0a96e643f7f6f6 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9Cgpjb250cmFjdCBBYnN0cmFjdFN0YXJiYXNlVG9rZW4gewogICAgZnVuY3Rpb24gaXNGdW5kcmFpc2VyKGFkZHJlc3MgZnVuZHJhaXNlckFkZHJlc3MpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGNvbXBhbnkoKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBhbGxvY2F0ZVRvQ3Jvd2RzYWxlUHVyY2hhc2VyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFsbG9jYXRlVG9NYXJrZXRpbmdTdXBwb3J0ZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHsKICAgIGZ1bmN0aW9uIHN0YXJ0RGF0ZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHt9CiAgICBmdW5jdGlvbiBlbmRlZEF0KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikge30KICAgIGZ1bmN0aW9uIGlzRW5kZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRvdGFsUmFpc2VkQW1vdW50SW5DbnkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5KGFkZHJlc3MgcHVyY2hhc2VyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VkVG9rZW5zT25FcEJ5KGFkZHJlc3MgcHVyY2hhc2VyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKfQoKLy8vIEB0aXRsZSBFYXJseVB1cmNoYXNlIGNvbnRyYWN0IC0gS2VlcCB0cmFjayBvZiBwdXJjaGFzZWQgYW1vdW50IGJ5IEVhcmx5IFB1cmNoYXNlcnMKLy8vIEBhdXRob3IgU3RhcmJhc2UgUFRFLiBMVEQuIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlYzg1ODI4YTgzYWM5Zjk4OGQ5ZThlOGQ5Zjg5YzI4ZjgzIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgU3RhcmJhc2VFYXJseVB1cmNoYXNlIHsKICAgIC8qCiAgICAgKiAgQ29uc3RhbnRzCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX1VOSVQgPSAnQ05ZJzsgICAgLy8gQ2hpbmVzZSBZdWFuCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFBVUkNIQVNFX0FNT1VOVF9SQVRFX1JFRkVSRU5DRSA9ICdodHRwOi8vd3d3LnhlLmNvbS9jdXJyZW5jeXRhYmxlcy8nOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFVSQ0hBU0VfQU1PVU5UX0NBUCA9IDkwMDAwMDA7CgogICAgLyoKICAgICAqICBUeXBlcwogICAgICovCiAgICBzdHJ1Y3QgRWFybHlQdXJjaGFzZSB7CiAgICAgICAgYWRkcmVzcyBwdXJjaGFzZXI7CiAgICAgICAgdWludDI1NiBhbW91bnQ7ICAgICAgICAvLyBDTlkgYmFzZWQgYW1vdW50CiAgICAgICAgdWludDI1NiBwdXJjaGFzZWRBdDsgICAvLyB0aW1lc3RhbXAKICAgIH0KCiAgICAvKgogICAgICogIEV4dGVybmFsIGNvbnRyYWN0cwogICAgICovCiAgICBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHB1YmxpYyBzdGFyYmFzZUNyb3dkc2FsZTsKCiAgICAvKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBFYXJseVB1cmNoYXNlW10gcHVibGljIGVhcmx5UHVyY2hhc2VzOwogICAgdWludDI1NiBwdWJsaWMgZWFybHlQdXJjaGFzZUNsb3NlZEF0OwoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG5vRXRoZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVDcm93ZHNhbGUoKSB7CiAgICAgICAgYXNzZXJ0KGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpID09IGFkZHJlc3MoMCkgfHwgc3RhcmJhc2VDcm93ZHNhbGUuc3RhcnREYXRlKCkgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RWFybHlQdXJjaGFzZVRlcm0oKSB7CiAgICAgICAgYXNzZXJ0KGVhcmx5UHVyY2hhc2VDbG9zZWRBdCA8PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgQ29udHJhY3QgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGJ5IHB1cmNoYXNlcidzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gcHVyY2hhc2VkQW1vdW50QnkoYWRkcmVzcyBwdXJjaGFzZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGVhcmx5UHVyY2hhc2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChlYXJseVB1cmNoYXNlc1tpXS5wdXJjaGFzZXIgPT0gcHVyY2hhc2VyKSB7CiAgICAgICAgICAgICAgICBhbW91bnQgKz0gZWFybHlQdXJjaGFzZXNbaV0uYW1vdW50OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIGFtb3VudCBvZiByYWlzZWQgZnVuZHMgYnkgRWFybHkgUHVyY2hhc2VycwogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYgdG90YWxBbW91bnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBlYXJseVB1cmNoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3RhbEFtb3VudCArPSBlYXJseVB1cmNoYXNlc1tpXS5hbW91bnQ7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMKICAgICAqLwogICAgZnVuY3Rpb24gbnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG5vRXRoZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBlYXJseVB1cmNoYXNlcy5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFwcGVuZCBhbiBlYXJseSBwdXJjaGFzZSBsb2cKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgUHVyY2hhc2VyIGFkZHJlc3MKICAgICAqIEBwYXJhbSBhbW91bnQgUHVyY2hhc2UgYW1vdW50CiAgICAgKiBAcGFyYW0gcHVyY2hhc2VkQXQgVGltZXN0YW1wIG9mIHB1cmNoYXNlZCBkYXRlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFwcGVuZEVhcmx5UHVyY2hhc2UoYWRkcmVzcyBwdXJjaGFzZXIsIHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IHB1cmNoYXNlZEF0KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbm9FdGhlcgogICAgICAgIG9ubHlPd25lcgogICAgICAgIG9ubHlCZWZvcmVDcm93ZHNhbGUKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZVRlcm0KICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChhbW91bnQgPT0gMCB8fAogICAgICAgICAgICB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSArIGFtb3VudCA+IFBVUkNIQVNFX0FNT1VOVF9DQVApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnQocHVyY2hhc2VkQXQgIT0gMCB8fCBwdXJjaGFzZWRBdCA8PSBub3cpOwoKICAgICAgICBlYXJseVB1cmNoYXNlcy5wdXNoKEVhcmx5UHVyY2hhc2UocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENsb3NlIGVhcmx5IHB1cmNoYXNlIHRlcm0KICAgICAqLwogICAgZnVuY3Rpb24gY2xvc2VFYXJseVB1cmNoYXNlKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGVhcmx5UHVyY2hhc2VDbG9zZWRBdCA9IG5vdzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0dXAgZnVuY3Rpb24gc2V0cyBleHRlcm5hbCBjb250cmFjdCdzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MgVG9rZW4gYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBzZXR1cChhZGRyZXNzIHN0YXJiYXNlQ3Jvd2RzYWxlQWRkcmVzcykKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChhZGRyZXNzKHN0YXJiYXNlQ3Jvd2RzYWxlKSA9PSAwKSB7CiAgICAgICAgICAgIHN0YXJiYXNlQ3Jvd2RzYWxlID0gQWJzdHJhY3RTdGFyYmFzZUNyb3dkc2FsZShzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDb250cmFjdCBjb25zdHJ1Y3RvciBmdW5jdGlvbgogICAgICovCiAgICBmdW5jdGlvbiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UoKSBub0V0aGVyIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9Cn0KCi8vLyBAdGl0bGUgRWFybHlQdXJjaGFzZUFtZW5kbWVudCBjb250cmFjdCAtIEFtZW5kIGVhcmx5IHB1cmNoYXNlIHJlY29yZHMgb2YgdGhlIG9yaWdpbmFsIGNvbnRyYWN0Ci8vLyBAYXV0aG9yIFN0YXJiYXNlIFBURS4gTFRELiAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iM2M0ZjQ5NGM0YzUzNGU0ODdjNGY0ODVkNGU1ZTVkNGY1OTEyNWY1MyI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CmNvbnRyYWN0IFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCB7CiAgICAvKgogICAgICogIEV2ZW50cwogICAgICovCiAgICBldmVudCBFYXJseVB1cmNoYXNlSW52YWxpZGF0ZWQodWludDI1NiBlcElkeCk7CiAgICBldmVudCBFYXJseVB1cmNoYXNlQW1lbmRlZCh1aW50MjU2IGVwSWR4KTsKCiAgICAvKgogICAgICogIEV4dGVybmFsIGNvbnRyYWN0cwogICAgICovCiAgICBBYnN0cmFjdFN0YXJiYXNlQ3Jvd2RzYWxlIHB1YmxpYyBzdGFyYmFzZUNyb3dkc2FsZTsKICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZSBwdWJsaWMgc3RhcmJhc2VFYXJseVB1cmNoYXNlOwoKICAgIC8qCiAgICAgKiAgU3RvcmFnZQogICAgICovCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIHVpbnQyNTZbXSBwdWJsaWMgaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzOwogICAgdWludDI1NltdIHB1YmxpYyBhbWVuZGVkRWFybHlQdXJjaGFzZUluZGV4ZXM7CiAgICBtYXBwaW5nICh1aW50MjU2ID0+IFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlKSBwdWJsaWMgYW1lbmRlZEVhcmx5UHVyY2hhc2VzOwoKICAgIC8qCiAgICAgKiAgTW9kaWZpZXJzCiAgICAgKi8KICAgIG1vZGlmaWVyIG5vRXRoZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlCZWZvcmVDcm93ZHNhbGUoKSB7CiAgICAgICAgYXNzZXJ0KGFkZHJlc3Moc3RhcmJhc2VDcm93ZHNhbGUpID09IGFkZHJlc3MoMCkgfHwgc3RhcmJhc2VDcm93ZHNhbGUuc3RhcnREYXRlKCkgPT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQoKSB7CiAgICAgICAgYXNzZXJ0KGFkZHJlc3Moc3RhcmJhc2VFYXJseVB1cmNoYXNlKSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qCiAgICAgKiAgRnVuY3Rpb25zIGJlbG93IGFyZSBjb21wYXRpYmxlIHdpdGggc3RhcmJhc2VFYXJseVB1cmNoYXNlIGNvbnRyYWN0CiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBhbiBlYXJseSBwdXJjaGFzZSByZWNvcmQKICAgICAqIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIGFuIGVhcmx5IHB1cmNoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVhcmx5UHVyY2hhc2VzKHVpbnQyNTYgZWFybHlQdXJjaGFzZUluZGV4KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQKICAgICAgICByZXR1cm5zIChhZGRyZXNzIHB1cmNoYXNlciwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgcHVyY2hhc2VkQXQpCiAgICB7CiAgICAgICAgcmV0dXJuIHN0YXJiYXNlRWFybHlQdXJjaGFzZS5lYXJseVB1cmNoYXNlcyhlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIGVhcmx5IHB1cmNoYXNlZCBhbW91bnQgYnkgcHVyY2hhc2VyJ3MgYWRkcmVzcwogICAgICogQHBhcmFtIHB1cmNoYXNlciBQdXJjaGFzZXIgYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBwdXJjaGFzZWRBbW91bnRCeShhZGRyZXNzIHB1cmNoYXNlcikKICAgICAgICBleHRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlW10gbWVtb3J5IG5vcm1hbGl6ZWRFUCA9CiAgICAgICAgICAgIG5vcm1hbGl6ZWRFYXJseVB1cmNoYXNlcygpOwogICAgICAgIGZvciAodWludDI1NiBpOyBpIDwgbm9ybWFsaXplZEVQLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChub3JtYWxpemVkRVBbaV0ucHVyY2hhc2VyID09IHB1cmNoYXNlcikgewogICAgICAgICAgICAgICAgYW1vdW50ICs9IG5vcm1hbGl6ZWRFUFtpXS5hbW91bnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdG90YWwgYW1vdW50IG9mIHJhaXNlZCBmdW5kcyBieSBFYXJseSBQdXJjaGFzZXJzCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlcygpCiAgICAgICAgY29uc3RhbnQKICAgICAgICBub0V0aGVyCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAodWludDI1NiB0b3RhbEFtb3VudCkKICAgIHsKICAgICAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdIG1lbW9yeSBub3JtYWxpemVkRVAgPQogICAgICAgICAgICBub3JtYWxpemVkRWFybHlQdXJjaGFzZXMoKTsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IG5vcm1hbGl6ZWRFUC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3RhbEFtb3VudCArPSBub3JtYWxpemVkRVBbaV0uYW1vdW50OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgZWFybHkgcHVyY2hhc2VzCiAgICAgKi8KICAgIGZ1bmN0aW9uIG51bWJlck9mRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBub0V0aGVyCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gbm9ybWFsaXplZEVhcmx5UHVyY2hhc2VzKCkubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXRzIHVwIGZ1bmN0aW9uIHNldHMgZXh0ZXJuYWwgY29udHJhY3QncyBhZGRyZXNzCiAgICAgKiBAcGFyYW0gc3RhcmJhc2VDcm93ZHNhbGVBZGRyZXNzIFRva2VuIGFkZHJlc3MKICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXAoYWRkcmVzcyBzdGFyYmFzZUNyb3dkc2FsZUFkZHJlc3MpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBub0V0aGVyCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoYWRkcmVzcyhzdGFyYmFzZUNyb3dkc2FsZSkgPT0gMCkgewogICAgICAgICAgICBzdGFyYmFzZUNyb3dkc2FsZSA9IEFic3RyYWN0U3RhcmJhc2VDcm93ZHNhbGUoc3RhcmJhc2VDcm93ZHNhbGVBZGRyZXNzKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKgogICAgICogIENvbnRyYWN0IGZ1bmN0aW9ucyB1bmlxdWUgdG8gU3RhcmJhc2VFYXJseVB1cmNoYXNlQW1lbmRtZW50CiAgICAgKi8KCiAgICAgLyoqCiAgICAgICogQGRldiBJbnZhbGlkYXRlIGVhcmx5IHB1cmNoYXNlCiAgICAgICogQHBhcmFtIGVhcmx5UHVyY2hhc2VJbmRleCBJbmRleCBudW1iZXIgb2YgdGhlIHB1cmNoYXNlCiAgICAgICovCiAgICBmdW5jdGlvbiBpbnZhbGlkYXRlRWFybHlQdXJjaGFzZSh1aW50MjU2IGVhcmx5UHVyY2hhc2VJbmRleCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQKICAgICAgICBvbmx5QmVmb3JlQ3Jvd2RzYWxlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhc3NlcnQobnVtYmVyT2ZSYXdFYXJseVB1cmNoYXNlcygpID4gZWFybHlQdXJjaGFzZUluZGV4KTsgLy8gQXJyYXkgSW5kZXggT3V0IG9mIEJvdW5kcyBFeGNlcHRpb24KCiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBpbnZhbGlkRWFybHlQdXJjaGFzZUluZGV4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYXNzZXJ0KGludmFsaWRFYXJseVB1cmNoYXNlSW5kZXhlc1tpXSAhPSBlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzLnB1c2goZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICBFYXJseVB1cmNoYXNlSW52YWxpZGF0ZWQoZWFybHlQdXJjaGFzZUluZGV4KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2hlY2tzIHdoZXRoZXIgZWFybHkgcHVyY2hhc2UgaXMgaW52YWxpZAogICAgICogQHBhcmFtIGVhcmx5UHVyY2hhc2VJbmRleCBJbmRleCBudW1iZXIgb2YgdGhlIHB1cmNoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzSW52YWxpZEVhcmx5UHVyY2hhc2UodWludDI1NiBlYXJseVB1cmNoYXNlSW5kZXgpCiAgICAgICAgY29uc3RhbnQKICAgICAgICBub0V0aGVyCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhc3NlcnQobnVtYmVyT2ZSYXdFYXJseVB1cmNoYXNlcygpID4gZWFybHlQdXJjaGFzZUluZGV4KTsgLy8gQXJyYXkgSW5kZXggT3V0IG9mIEJvdW5kcyBFeGNlcHRpb24KCgogICAgICAgIGZvciAodWludDI1NiBpOyBpIDwgaW52YWxpZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpbnZhbGlkRWFybHlQdXJjaGFzZUluZGV4ZXNbaV0gPT0gZWFybHlQdXJjaGFzZUluZGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFtZW5kcyBhIGdpdmVuIGVhcmx5IHB1cmNoYXNlIHdpdGggZGF0YQogICAgICogQHBhcmFtIGVhcmx5UHVyY2hhc2VJbmRleCBJbmRleCBudW1iZXIgb2YgdGhlIHB1cmNoYXNlCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VyIFB1cmNoYXNlcidzIGFkZHJlc3MKICAgICAqIEBwYXJhbSBhbW91bnQgVmFsdWUgb2YgcHVyY2hhc2UKICAgICAqIEBwYXJhbSBwdXJjaGFzZWRBdCBQdXJjaGFzZSB0aW1lc3RhbXAKICAgICAqLwogICAgZnVuY3Rpb24gYW1lbmRFYXJseVB1cmNoYXNlKHVpbnQyNTYgZWFybHlQdXJjaGFzZUluZGV4LCBhZGRyZXNzIHB1cmNoYXNlciwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgcHVyY2hhc2VkQXQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBub0V0aGVyCiAgICAgICAgb25seU93bmVyCiAgICAgICAgb25seUVhcmx5UHVyY2hhc2VzTG9hZGVkCiAgICAgICAgb25seUJlZm9yZUNyb3dkc2FsZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KHB1cmNoYXNlZEF0ICE9IDAgfHwgcHVyY2hhc2VkQXQgPD0gbm93KTsKCiAgICAgICAgYXNzZXJ0KG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA+IGVhcmx5UHVyY2hhc2VJbmRleCk7CgogICAgICAgIGFzc2VydCghaXNJbnZhbGlkRWFybHlQdXJjaGFzZShlYXJseVB1cmNoYXNlSW5kZXgpKTsgLy8gSW52YWxpZCBlYXJseSBwdXJjaGFzZSBjYW5ub3QgYmUgYW1lbmRlZAoKICAgICAgICBpZiAoIWlzQW1lbmRlZEVhcmx5UHVyY2hhc2UoZWFybHlQdXJjaGFzZUluZGV4KSkgewogICAgICAgICAgICBhbWVuZGVkRWFybHlQdXJjaGFzZUluZGV4ZXMucHVzaChlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgYW1lbmRlZEVhcmx5UHVyY2hhc2VzW2Vhcmx5UHVyY2hhc2VJbmRleF0gPQogICAgICAgICAgICBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZShwdXJjaGFzZXIsIGFtb3VudCwgcHVyY2hhc2VkQXQpOwogICAgICAgIEVhcmx5UHVyY2hhc2VBbWVuZGVkKGVhcmx5UHVyY2hhc2VJbmRleCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrcyB3aGV0aGVyIGVhcmx5IHB1cmNoYXNlIGlzIGFtZW5kZWQKICAgICAqIEBwYXJhbSBlYXJseVB1cmNoYXNlSW5kZXggSW5kZXggbnVtYmVyIG9mIHRoZSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiBpc0FtZW5kZWRFYXJseVB1cmNoYXNlKHVpbnQyNTYgZWFybHlQdXJjaGFzZUluZGV4KQogICAgICAgIGNvbnN0YW50CiAgICAgICAgbm9FdGhlcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKSA+IGVhcmx5UHVyY2hhc2VJbmRleCk7IC8vIEFycmF5IEluZGV4IE91dCBvZiBCb3VuZHMgRXhjZXB0aW9uCgogICAgICAgIGZvciAodWludDI1NiBpOyBpIDwgYW1lbmRlZEVhcmx5UHVyY2hhc2VJbmRleGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChhbWVuZGVkRWFybHlQdXJjaGFzZUluZGV4ZXNbaV0gPT0gZWFybHlQdXJjaGFzZUluZGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IExvYWRzIGVhcmx5IHB1cmNoYXNlcyBkYXRhIHRvIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCBjb250cmFjdAogICAgICogQHBhcmFtIHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MgQWRkcmVzcyBmcm9tIHN0YXJiYXNlIGVhcmx5IHB1cmNoYXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxvYWRTdGFyYmFzZUVhcmx5UHVyY2hhc2VzKGFkZHJlc3Mgc3RhcmJhc2VFYXJseVB1cmNoYXNlQWRkcmVzcykKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vRXRoZXIKICAgICAgICBvbmx5T3duZXIKICAgICAgICBvbmx5QmVmb3JlQ3Jvd2RzYWxlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhc3NlcnQoc3RhcmJhc2VFYXJseVB1cmNoYXNlQWRkcmVzcyAhPSAwIHx8CiAgICAgICAgICAgIGFkZHJlc3Moc3RhcmJhc2VFYXJseVB1cmNoYXNlKSA9PSAwKTsKCiAgICAgICAgc3RhcmJhc2VFYXJseVB1cmNoYXNlID0gU3RhcmJhc2VFYXJseVB1cmNoYXNlKHN0YXJiYXNlRWFybHlQdXJjaGFzZUFkZHJlc3MpOwogICAgICAgIGFzc2VydChzdGFyYmFzZUVhcmx5UHVyY2hhc2UuZWFybHlQdXJjaGFzZUNsb3NlZEF0KCkgIT0gMCk7IC8vIHRoZSBlYXJseSBwdXJjaGFzZSBtdXN0IGJlIGNsb3NlZAoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24uIEl0IHNldHMgb3duZXIKICAgICAqLwogICAgZnVuY3Rpb24gU3RhcmJhc2VFYXJseVB1cmNoYXNlQW1lbmRtZW50KCkgbm9FdGhlciB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qKgogICAgICogSW50ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgTm9ybWFsaXplcyBlYXJseSBwdXJjaGFzZXMgZGF0YQogICAgICovCiAgICBmdW5jdGlvbiBub3JtYWxpemVkRWFybHlQdXJjaGFzZXMoKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zIChTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZVtdIG5vcm1hbGl6ZWRFUCkKICAgIHsKICAgICAgICB1aW50MjU2IHJhd0VQQ291bnQgPSBudW1iZXJPZlJhd0Vhcmx5UHVyY2hhc2VzKCk7CiAgICAgICAgbm9ybWFsaXplZEVQID0gbmV3IFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlW10oCiAgICAgICAgICAgIHJhd0VQQ291bnQgLSBpbnZhbGlkRWFybHlQdXJjaGFzZUluZGV4ZXMubGVuZ3RoKTsKCiAgICAgICAgdWludDI1NiBub3JtYWxpemVkSWR4OwogICAgICAgIGZvciAodWludDI1NiBpOyBpIDwgcmF3RVBDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpc0ludmFsaWRFYXJseVB1cmNoYXNlKGkpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsgICAvLyBpbnZhbGlkIGVhcmx5IHB1cmNoYXNlIHNob3VsZCBiZSBpZ25vcmVkCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlIG1lbW9yeSBlcDsKICAgICAgICAgICAgaWYgKGlzQW1lbmRlZEVhcmx5UHVyY2hhc2UoaSkpIHsKICAgICAgICAgICAgICAgIGVwID0gYW1lbmRlZEVhcmx5UHVyY2hhc2VzW2ldOyAgLy8gYW1lbmRlZCBlYXJseSBwdXJjaGFzZSBzaG91bGQgdGFrZSBhIHByaW9yaXR5CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlcCA9IGdldEVhcmx5UHVyY2hhc2UoaSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5vcm1hbGl6ZWRFUFtub3JtYWxpemVkSWR4XSA9IGVwOwogICAgICAgICAgICBub3JtYWxpemVkSWR4Kys7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGZXRjaGVzIGVhcmx5IHB1cmNoYXNlcyBkYXRhCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEVhcmx5UHVyY2hhc2UodWludDI1NiBlYXJseVB1cmNoYXNlSW5kZXgpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIG9ubHlFYXJseVB1cmNoYXNlc0xvYWRlZAogICAgICAgIHJldHVybnMgKFN0YXJiYXNlRWFybHlQdXJjaGFzZS5FYXJseVB1cmNoYXNlKQogICAgewogICAgICAgIHZhciAocHVyY2hhc2VyLCBhbW91bnQsIHB1cmNoYXNlZEF0KSA9CiAgICAgICAgICAgIHN0YXJiYXNlRWFybHlQdXJjaGFzZS5lYXJseVB1cmNoYXNlcyhlYXJseVB1cmNoYXNlSW5kZXgpOwogICAgICAgIHJldHVybiBTdGFyYmFzZUVhcmx5UHVyY2hhc2UuRWFybHlQdXJjaGFzZShwdXJjaGFzZXIsIGFtb3VudCwgcHVyY2hhc2VkQXQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHJhdyBudW1iZXIgb2YgZWFybHkgcHVyY2hhc2VzCiAgICAgKi8KICAgIGZ1bmN0aW9uIG51bWJlck9mUmF3RWFybHlQdXJjaGFzZXMoKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBvbmx5RWFybHlQdXJjaGFzZXNMb2FkZWQKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBzdGFyYmFzZUVhcmx5UHVyY2hhc2UubnVtYmVyT2ZFYXJseVB1cmNoYXNlcygpOwogICAgfQp9CgovKioKICogQHRpdGxlIENyb3dkc2FsZSBjb250cmFjdCAtIFN0YXJiYXNlIGNyb3dkc2FsZSB0byBjcmVhdGUgU1RBUi4KICogQGF1dGhvciBTdGFyYmFzZSBQVEUuIExURC4gLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjcxMTgxZjE3MWUzMTAyMDUxMDAzMTMxMDAyMTQ1ZjEyMWUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgogKi8KY29udHJhY3QgU3RhcmJhc2VDcm93ZHNhbGUgaXMgT3duYWJsZSB7CiAgICAvKgogICAgICogIEV2ZW50cwogICAgICovCiAgICBldmVudCBDcm93ZHNhbGVFbmRlZCh1aW50MjU2IGVuZGVkQXQpOwogICAgZXZlbnQgU3RhcmJhc2VQdXJjaGFzZWRXaXRoRXRoKGFkZHJlc3MgcHVyY2hhc2VyLCB1aW50MjU2IGFtb3VudCwgdWludDI1NiByYXdBbW91bnQsIHVpbnQyNTYgY255RXRoUmF0ZSwgdWludDI1NiBib251c1Rva2Vuc1BlcmNlbnRhZ2UpOwogICAgZXZlbnQgU3RhcmJhc2VQdXJjaGFzZWRPZmZDaGFpbihhZGRyZXNzIHB1cmNoYXNlciwgdWludDI1NiBhbW91bnQsIHVpbnQyNTYgcmF3QW1vdW50LCB1aW50MjU2IGNueUJ0Y1JhdGUsIHVpbnQyNTYgYm9udXNUb2tlbnNQZXJjZW50YWdlLCBzdHJpbmcgZGF0YSk7CiAgICBldmVudCBDbnlFdGhSYXRlVXBkYXRlZCh1aW50MjU2IGNueUV0aFJhdGUpOwogICAgZXZlbnQgQ255QnRjUmF0ZVVwZGF0ZWQodWludDI1NiBjbnlCdGNSYXRlKTsKICAgIGV2ZW50IFF1YWxpZmllZFBhcnRuZXJBZGRyZXNzKGFkZHJlc3MgcXVhbGlmaWVkUGFydG5lcik7CgogICAgLyoqCiAgICAgKiAgRXh0ZXJuYWwgY29udHJhY3RzCiAgICAgKi8KICAgIEFic3RyYWN0U3RhcmJhc2VUb2tlbiBwdWJsaWMgc3RhcmJhc2VUb2tlbjsKICAgIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCBwdWJsaWMgc3RhcmJhc2VFcEFtZW5kbWVudDsKCiAgICAvKioKICAgICAqICBDb25zdGFudHMKICAgICAqLwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgY3Jvd2RzYWxlVG9rZW5BbW91bnQgPSAxMjUwMDAwMDBlMTg7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBlYXJseVB1cmNoYXNlVG9rZW5BbW91bnQgPSA1MDAwMDAwMGUxODsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1JTl9JTlZFU1RNRU5UID0gMTsgLy8gbWluIGlzIDEgV2VpCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBNQVhfQ0FQID0gNjcwMDAwMDA7IC8vIGluIENOWS4gYXBwcm94aW1hdGVseSAxME0gVVNELiAoaW5jbHVkZXMgcmFpc2VkIGFtb3VudCBmcm9tIGJvdGggRVAgYW5kIENTKQogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBQVVJDSEFTRV9BTU9VTlRfVU5JVCA9ICdDTlknOyAgLy8gQ2hpbmVzZSBZdWFuCgogICAgLyoqCiAgICAgKiBUeXBlcwogICAgICovCiAgICBzdHJ1Y3QgQ3Jvd2RzYWxlUHVyY2hhc2UgewogICAgICAgIGFkZHJlc3MgcHVyY2hhc2VyOwogICAgICAgIHVpbnQyNTYgYW1vdW50OyAgICAgICAgLy8gQ05ZIGJhc2VkIGFtb3VudCB3aXRoIGJvbnVzCiAgICAgICAgdWludDI1NiByYXdBbW91bnQ7ICAgICAvLyBDTlkgYmFzZWQgYW1vdW50IG5vIGJvbnVzCiAgICAgICAgdWludDI1NiBwdXJjaGFzZWRBdDsgICAvLyB0aW1lc3RhbXAKICAgICAgICBzdHJpbmcgZGF0YTsgICAgICAgICAgIC8vIGFkZGl0aW9uYWwgZGF0YSAoZS5nLiBUeCBJRCBvZiBCaXRjb2luKQogICAgICAgIHVpbnQyNTYgYm9udXM7CiAgICB9CgogICAgc3RydWN0IFF1YWxpZmllZFBhcnRuZXJzIHsKICAgICAgICB1aW50MjU2IGFtb3VudENhcDsKICAgICAgICB1aW50MjU2IGFtb3VudFJhaXNlZDsKICAgICAgICBib29sICAgIGJvbmFGaWRlOwogICAgICAgIHVpbnQyNTYgY29tbWlzc2lvbkZlZVBlcmNlbnRhZ2U7IC8vIGV4YW1wbGUgNSB3aWxsIGNhbGN1bGF0ZSB0aGUgcGVyY2VudGFnZSBhcyA1JQogICAgfQoKICAgIC8qKgogICAgICogIFN0b3JhZ2UKICAgICAqLwogICAgdWludCBwdWJsaWMgbnVtT2ZEZWxpdmVyZWRDcm93ZHNhbGVQdXJjaGFzZXM7ICAvLyBpbmRleCB0byBrZWVwIHRoZSBudW1iZXIgb2YgY3Jvd2RzYWxlIHB1cmNoYXNlcyBoYXZlIGFscmVhZHkgYmVlbiBwcm9jZXNzZWQgYnkgYHdpdGhkcmF3UHVyY2hhc2VkVG9rZW5zYAogICAgdWludCBwdWJsaWMgbnVtT2ZEZWxpdmVyZWRFYXJseVB1cmNoYXNlczsgIC8vIGluZGV4IHRvIGtlZXAgdGhlIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMgaGF2ZSBhbHJlYWR5IGJlZW4gcHJvY2Vzc2VkIGJ5IGB3aXRoZHJhd1B1cmNoYXNlZFRva2Vuc2AKICAgIHVpbnQyNTYgcHVibGljIG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXM7IC8vIGluZGV4IHRvIGtlZXAgdGhlIG51bWJlciBvZiBlYXJseSBwdXJjaGFzZXMgdGhhdCBoYXZlIGFscmVhZHkgYmVlbiBsb2FkZWQgYnkgYGxvYWRFYXJseVB1cmNoYXNlc2AKCiAgICAvLyBlYXJseSBwdXJjaGFzZQogICAgYWRkcmVzc1tdIHB1YmxpYyBlYXJseVB1cmNoYXNlcnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBlYXJseVB1cmNoYXNlZEFtb3VudEJ5OyAvLyBlYXJseSBwdXJjaGFzZWQgYW1vdW50IGluIENOWSBwZXIgcHVyY2hhc2VycycgYWRkcmVzcwogICAgYm9vbCBwdWJsaWMgZWFybHlQdXJjaGFzZXNMb2FkZWQgPSBmYWxzZTsgIC8vIHJldHVybnMgd2hldGhlciBhbGwgZWFybHkgcHVyY2hhc2VzIGFyZSBsb2FkZWQgaW50byB0aGlzIGNvbnRyYWN0CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXNJbkNueTsKCiAgICAvLyBjcm93ZHNhbGUKICAgIHVpbnQyNTYgcHVibGljIG1heENyb3dkc2FsZUNhcDsgICAgIC8vID0gNjdNIENOWSAtICh0b3RhbCByYWlzZWQgYW1vdW50IGZyb20gRVApCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbEFtb3VudE9mUHVyY2hhc2VzSW5Dbnk7IC8vIHRvdGFsUHJlU2FsZSArIHRvdGFsQ3Jvd2RzYWxlCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFF1YWxpZmllZFBhcnRuZXJzKSBwdWJsaWMgcXVhbGlmaWVkUGFydG5lcnM7CiAgICB1aW50MjU2IHB1YmxpYyBwdXJjaGFzZVN0YXJ0QmxvY2s7ICAvLyBjcm93ZHNhbGUgcHVyY2hhc2VzIGNhbiBiZSBhY2NlcHRlZCBmcm9tIHRoaXMgYmxvY2sgbnVtYmVyCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydERhdGU7CiAgICB1aW50MjU2IHB1YmxpYyBlbmRlZEF0OwogICAgQ3Jvd2RzYWxlUHVyY2hhc2VbXSBwdWJsaWMgY3Jvd2RzYWxlUHVyY2hhc2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgY3Jvd2RzYWxlUHVyY2hhc2VBbW91bnRCeTsgLy8gY3Jvd2RzYWxlIHB1cmNoYXNlIGFtb3VudCBpbiBDTlkgcGVyIHB1cmNoYXNlcnMnIGFkZHJlc3MKICAgIHVpbnQyNTYgcHVibGljIGNueUJ0Y1JhdGU7IC8vIHRoaXMgcmF0ZSB3b24ndCBiZSB1c2VkIGZyb20gYSBzbWFydCBjb250cmFjdCBmdW5jdGlvbiBidXQgZXh0ZXJuYWwgc3lzdGVtCiAgICB1aW50MjU2IHB1YmxpYyBjbnlFdGhSYXRlOwoKICAgIC8vIGJvbnVzIG1pbGVzdG9uZXMKICAgIHVpbnQyNTYgcHVibGljIGZpcnN0Qm9udXNTYWxlc0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRCb251c1NhbGVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIHRoaXJkQm9udXNTYWxlc0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBmb3VydGhCb251c1NhbGVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIGZpZnRoQm9udXNTYWxlc0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBmaXJzdEV4dGVuZGVkQm9udXNTYWxlc0VuZHM7CiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOwogICAgdWludDI1NiBwdWJsaWMgdGhpcmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOwogICAgdWludDI1NiBwdWJsaWMgZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIGZpZnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kczsKICAgIHVpbnQyNTYgcHVibGljIHNpeHRoRXh0ZW5kZWRCb251c1NhbGVzRW5kczsKCiAgICAvLyBhZnRlciB0aGUgY3Jvd2RzYWxlCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBudW1PZlB1cmNoYXNlZFRva2Vuc09uQ3NCeTsgICAgLy8gdGhlIG51bWJlciBvZiB0b2tlbnMgcHVyY2hhc2VkIG9uIHRoZSBjcm93ZHNhbGUgYnkgYSBwdXJjaGFzZXIKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG51bU9mUHVyY2hhc2VkVG9rZW5zT25FcEJ5OyAgICAvLyB0aGUgbnVtYmVyIG9mIHRva2VucyBlYXJseSBwdXJjaGFzZWQgYnkgYSBwdXJjaGFzZXIKCiAgICAvKioKICAgICAqICBNb2RpZmllcnMKICAgICAqLwogICAgbW9kaWZpZXIgbWluSW52ZXN0bWVudCgpIHsKICAgICAgICAvLyBVc2VyIGhhcyB0byBzZW5kIGF0IGxlYXN0IHRoZSBldGhlciB2YWx1ZSBvZiBvbmUgdG9rZW4uCiAgICAgICAgYXNzZXJ0KG1zZy52YWx1ZSA+PSBNSU5fSU5WRVNUTUVOVCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB3aGVuRW5kZWQoKSB7CiAgICAgICAgYXNzZXJ0KGlzRW5kZWQoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBoYXNCYWxhbmNlKCkgewogICAgICAgIGFzc2VydCh0aGlzLmJhbGFuY2UgPiAwKTsKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgcmF0ZUlzU2V0KHVpbnQyNTYgX3JhdGUpIHsKICAgICAgICBhc3NlcnQoX3JhdGUgIT0gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciB3aGVuTm90RW5kZWQoKSB7CiAgICAgICAgYXNzZXJ0KCFpc0VuZGVkKCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdG9rZW5zTm90RGVsaXZlcmVkKCkgewogICAgICAgIGFzc2VydChudW1PZkRlbGl2ZXJlZENyb3dkc2FsZVB1cmNoYXNlcyA9PSAwKTsKICAgICAgICBhc3NlcnQobnVtT2ZEZWxpdmVyZWRFYXJseVB1cmNoYXNlcyA9PSAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlGdW5kcmFpc2VyKCkgewogICAgICAgIGFzc2VydChhZGRyZXNzKHN0YXJiYXNlVG9rZW4pICE9IDApOwogICAgICAgIGFzc2VydChzdGFyYmFzZVRva2VuLmlzRnVuZHJhaXNlcihtc2cuc2VuZGVyKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnRyYWN0IGZ1bmN0aW9ucwogICAgICovCiAgICAvKioKICAgICAqIEBkZXYgQ29udHJhY3QgY29uc3RydWN0b3IgZnVuY3Rpb24gc2V0cyBvd25lciBhZGRyZXNzIGFuZAogICAgICogICAgICBhZGRyZXNzIG9mIFN0YXJiYXNlRWFybHlQdXJjaGFzZUFtZW5kbWVudCBjb250cmFjdC4KICAgICAqIEBwYXJhbSBzdGFyYmFzZUVwQWRkciBUaGUgYWRkcmVzcyB0aGF0IGhvbGRzIHRoZSBlYXJseSBwdXJjaGFzZXJzIFN0YXIgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIFN0YXJiYXNlQ3Jvd2RzYWxlKGFkZHJlc3Mgc3RhcmJhc2VFcEFkZHIpIHsKICAgICAgICByZXF1aXJlKHN0YXJiYXNlRXBBZGRyICE9IDApOwogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBzdGFyYmFzZUVwQW1lbmRtZW50ID0gU3RhcmJhc2VFYXJseVB1cmNoYXNlQW1lbmRtZW50KHN0YXJiYXNlRXBBZGRyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmFsbGJhY2sgYWNjZXB0cyBwYXltZW50IGZvciBTdGFyIHRva2VucyB3aXRoIEV0aAogICAgICovCiAgICBmdW5jdGlvbigpIHBheWFibGUgewogICAgICAgIHJlZGlyZWN0VG9QdXJjaGFzZSgpOwogICAgfQoKICAgIC8qKgogICAgICogRXh0ZXJuYWwgZnVuY3Rpb25zCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZXYgU2V0dXAgZnVuY3Rpb24gc2V0cyBleHRlcm5hbCBjb250cmFjdHMnIGFkZHJlc3NlcyBhbmQgc2V0IHRoZSBtYXggY3Jvd2RzYWxlIGNhcAogICAgICogQHBhcmFtIHN0YXJiYXNlVG9rZW5BZGRyZXNzIFRva2VuIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3B1cmNoYXNlU3RhcnRCbG9jayBCbG9jayBudW1iZXIgdG8gc3RhcnQgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldHVwKGFkZHJlc3Mgc3RhcmJhc2VUb2tlbkFkZHJlc3MsIHVpbnQyNTYgX3B1cmNoYXNlU3RhcnRCbG9jaykKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KGFkZHJlc3Moc3RhcmJhc2VUb2tlbikgPT0gMCk7CiAgICAgICAgc3RhcmJhc2VUb2tlbiA9IEFic3RyYWN0U3RhcmJhc2VUb2tlbihzdGFyYmFzZVRva2VuQWRkcmVzcyk7CiAgICAgICAgcHVyY2hhc2VTdGFydEJsb2NrID0gX3B1cmNoYXNlU3RhcnRCbG9jazsKCiAgICAgICAgdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzSW5DbnkgPSB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKTsKICAgICAgICAvLyBzZXQgdGhlIG1heCBjYXAgb2YgdGhpcyBjcm93ZHNhbGUKICAgICAgICBtYXhDcm93ZHNhbGVDYXAgPSBTYWZlTWF0aC5zdWIoTUFYX0NBUCwgdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzSW5DbnkpOwogICAgICAgIGFzc2VydChtYXhDcm93ZHNhbGVDYXAgPiAwKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyBvd25lciB0byByZWNvcmQgYSBwdXJjaGFzZSBtYWRlIG91dHNpZGUgb2YgRXRoZXJldW0gYmxvY2tjaGFpbgogICAgICogQHBhcmFtIHB1cmNoYXNlciBBZGRyZXNzIG9mIGEgcHVyY2hhc2VyCiAgICAgKiBAcGFyYW0gcmF3QW1vdW50IFB1cmNoYXNlZCBhbW91bnQgaW4gQ05ZCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VkQXQgVGltZXN0YW1wIGF0IHRoZSBwdXJjaGFzZSBtYWRlCiAgICAgKiBAcGFyYW0gZGF0YSBJZGVudGlmaWVyIGFzIGFuIGV2aWRlbmNlIG9mIHRoZSBwdXJjaGFzZSAoZS5nLiBidGM6MXh5enh5eikKICAgICAqLwogICAgZnVuY3Rpb24gcmVjb3JkT2ZmY2hhaW5QdXJjaGFzZSgKICAgICAgICBhZGRyZXNzIHB1cmNoYXNlciwKICAgICAgICB1aW50MjU2IHJhd0Ftb3VudCwKICAgICAgICB1aW50MjU2IHB1cmNoYXNlZEF0LAogICAgICAgIHN0cmluZyBkYXRhCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RnVuZHJhaXNlcgogICAgICAgIHdoZW5Ob3RFbmRlZAogICAgICAgIHJhdGVJc1NldChjbnlCdGNSYXRlKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShwdXJjaGFzZVN0YXJ0QmxvY2sgPiAwICYmIGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spOwogICAgICAgIGlmIChzdGFydERhdGUgPT0gMCkgewogICAgICAgICAgICBzdGFydENyb3dkc2FsZShibG9jay50aW1lc3RhbXApOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBib251c1RpZXIgPSBnZXRCb251c1RpZXIoKTsKICAgICAgICB1aW50IGFtb3VudCA9IHJlY29yZFB1cmNoYXNlKHB1cmNoYXNlciwgcmF3QW1vdW50LCBwdXJjaGFzZWRBdCwgZGF0YSwgYm9udXNUaWVyKTsKCiAgICAgICAgU3RhcmJhc2VQdXJjaGFzZWRPZmZDaGFpbihwdXJjaGFzZXIsIGFtb3VudCwgcmF3QW1vdW50LCBjbnlCdGNSYXRlLCBib251c1RpZXIsIGRhdGEpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlcnMgcmFpc2VkIGZ1bmRzIHRvIGNvbXBhbnkncyB3YWxsZXQgYWRkcmVzcyBhdCBhbnkgZ2l2ZW4gdGltZS4KICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdGb3JDb21wYW55KCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyCiAgICAgICAgaGFzQmFsYW5jZQogICAgewogICAgICAgIGFkZHJlc3MgY29tcGFueSA9IHN0YXJiYXNlVG9rZW4uY29tcGFueSgpOwogICAgICAgIHJlcXVpcmUoY29tcGFueSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjb21wYW55LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZSB0aGUgQ05ZL0VUSCByYXRlIHRvIHJlY29yZCBwdXJjaGFzZXMgaW4gQ05ZCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZUNueUV0aFJhdGUodWludDI1NiByYXRlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUZ1bmRyYWlzZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGNueUV0aFJhdGUgPSByYXRlOwogICAgICAgIENueUV0aFJhdGVVcGRhdGVkKGNueUV0aFJhdGUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBVcGRhdGUgdGhlIENOWS9CVEMgcmF0ZSB0byByZWNvcmQgcHVyY2hhc2VzIGluIENOWQogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDbnlCdGNSYXRlKHVpbnQyNTYgcmF0ZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlGdW5kcmFpc2VyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBjbnlCdGNSYXRlID0gcmF0ZTsKICAgICAgICBDbnlCdGNSYXRlVXBkYXRlZChjbnlCdGNSYXRlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3cgZm9yIHRoZSBwb3NzaWJpbGl0eSBmb3IgY29udHJhY3Qgb3duZXIgdG8gc3RhcnQgY3Jvd2RzYWxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyU3RhcnRzQ3Jvd2RzYWxlKHVpbnQyNTYgdGltZXN0YW1wKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgYXNzZXJ0KHN0YXJ0RGF0ZSA9PSAwICYmIGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spOyAgIC8vIG92ZXJ3cml0aW5nIHN0YXJ0RGF0ZSBpcyBub3QgcGVybWl0dGVkIGFuZCBpdCBzaG91bGQgYmUgYWZ0ZXIgdGhlIGNyb3dkc2FsZSBzdGFydCBibG9jawogICAgICAgIHN0YXJ0Q3Jvd2RzYWxlKHRpbWVzdGFtcCk7CgogICAgfQoKICAgIC8qKgogICAgICogQGRldiBFbmRzIGNyb3dkc2FsZQogICAgICogQHBhcmFtIHRpbWVzdGFtcCBUaW1lc3RhbXAgYXQgdGhlIGNyb3dkc2FsZSBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBlbmRDcm93ZHNhbGUodWludDI1NiB0aW1lc3RhbXApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBhc3NlcnQodGltZXN0YW1wID4gMCAmJiB0aW1lc3RhbXAgPD0gbm93KTsKICAgICAgICBhc3NlcnQoYmxvY2subnVtYmVyID4gcHVyY2hhc2VTdGFydEJsb2NrICYmIGVuZGVkQXQgPT0gMCk7ICAgLy8gY2Fubm90IGVuZCBiZWZvcmUgaXQgc3RhcnRzIGFuZCBvdmVyd3JpdGluZyB0aW1lIGlzIG5vdCBwZXJtaXR0ZWQKICAgICAgICBlbmRlZEF0ID0gdGltZXN0YW1wOwogICAgICAgIHRvdGFsQW1vdW50T2ZFYXJseVB1cmNoYXNlc0luQ255ID0gdG90YWxBbW91bnRPZkVhcmx5UHVyY2hhc2VzKCk7CiAgICAgICAgdG90YWxBbW91bnRPZlB1cmNoYXNlc0luQ255ID0gdG90YWxSYWlzZWRBbW91bnRJbkNueSgpOwogICAgICAgIENyb3dkc2FsZUVuZGVkKGVuZGVkQXQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZWxpdmVyIHRva2VucyB0byBwdXJjaGFzZXJzIGFjY29yZGluZyB0byB0aGVpciBwdXJjaGFzZSBhbW91bnQgaW4gQ05ZCiAgICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3UHVyY2hhc2VkVG9rZW5zKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5FbmRlZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYXNzZXJ0KGVhcmx5UHVyY2hhc2VzTG9hZGVkKTsKICAgICAgICBhc3NlcnQoYWRkcmVzcyhzdGFyYmFzZVRva2VuKSAhPSAwKTsKCiAgICAgICAgLyoKICAgICAgICAgKiDigJxWYWx1ZeKAnSByZWZlcnMgdG8gdGhlIGNvbnRyaWJ1dGlvbiBvZiB0aGUgVXNlcjoKICAgICAgICAgKiAge2Nyb3dkc2FsZV9wdXJjaGFzZXJfdG9rZW5fYW1vdW50fSA9CiAgICAgICAgICogIHtjcm93ZHNhbGVfdG9rZW5fYW1vdW50fSAqIHtjcm93ZHNhbGVQdXJjaGFzZV92YWx1ZX0gLyB7ZWFybHlwdXJjaGFzZV92YWx1ZX0gKyB7Y3Jvd2RzYWxlX3ZhbHVlfS4KICAgICAgICAgKgogICAgICAgICAqIEV4YW1wbGU6IElmIGEgVXNlciBjb250cmlidXRlcyBkdXJpbmcgdGhlIENvbnRyaWJ1dGlvbiBQZXJpb2QgMTAwIENOWSAoaW5jbHVkaW5nIGFwcGxpY2FibGUKICAgICAgICAgKiBCb251cywgaWYgYW55KSBhbmQgdGhlIHRvdGFsIGFtb3VudCBlYXJseSBwdXJjaGFzZXMgYW1vdW50cyB0byA24oCZMDAw4oCZMDAwIENOWQogICAgICAgICAqIGFuZCB0b3RhbCBhbW91bnQgcmFpc2VkIGR1cmluZyB0aGUgQ29udHJpYnV0aW9uIFBlcmlvZCBpcyAzMOKAmTAwMOKAmTAwMCwgdGhlbiBoZSB3aWxsIGdldAogICAgICAgICAqIDM0Ny4yMiBTVEFSID0gMTI14oCZMDAw4oCZMDAwIFNUQVIgKiAxMDAgQ05ZIC8gMzDigJkwMDDigJkwMDAgQ05ZICsgNuKAmTAwMOKAmTAwMCBDTlkuCiAgICAgICAgKi8KCiAgICAgICAgaWYgKGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl0gPiAwKSB7CiAgICAgICAgICAgIHVpbnQyNTYgY3Jvd2RzYWxlUHVyY2hhc2VWYWx1ZSA9IGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl07CiAgICAgICAgICAgIGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0KICAgICAgICAgICAgICAgIFNhZmVNYXRoLm11bChjcm93ZHNhbGVUb2tlbkFtb3VudCwgY3Jvd2RzYWxlUHVyY2hhc2VWYWx1ZSkgLwogICAgICAgICAgICAgICAgdG90YWxBbW91bnRPZlB1cmNoYXNlc0luQ255OwoKICAgICAgICAgICAgbnVtT2ZQdXJjaGFzZWRUb2tlbnNPbkNzQnlbbXNnLnNlbmRlcl0gPQogICAgICAgICAgICAgICAgU2FmZU1hdGguYWRkKG51bU9mUHVyY2hhc2VkVG9rZW5zT25Dc0J5W21zZy5zZW5kZXJdLCB0b2tlbkNvdW50KTsKICAgICAgICAgICAgYXNzZXJ0KHN0YXJiYXNlVG9rZW4uYWxsb2NhdGVUb0Nyb3dkc2FsZVB1cmNoYXNlcihtc2cuc2VuZGVyLCB0b2tlbkNvdW50KSk7CiAgICAgICAgICAgIG51bU9mRGVsaXZlcmVkQ3Jvd2RzYWxlUHVyY2hhc2VzKys7CiAgICAgICAgfQoKICAgICAgICAvKgogICAgICAgICAqIOKAnFZhbHVl4oCdIHJlZmVycyB0byB0aGUgY29udHJpYnV0aW9uIG9mIHRoZSBVc2VyOgogICAgICAgICAqIHtlYXJseXB1cmNoYXNlcl90b2tlbl9hbW91bnR9ID0KICAgICAgICAgKiB7ZWFybHlwdXJjaGFzZXJfdG9rZW5fYW1vdW50fSAqICh7ZWFybHlwdXJjaGFzZV92YWx1ZX0gLyB7dG90YWxfZWFybHlwdXJjaGFzZV92YWx1ZX0pCiAgICAgICAgICogICsge2Nyb3dkc2FsZV90b2tlbl9hbW91bnR9ICogKHtlYXJseXB1cmNoYXNlX3ZhbHVlfSAvIHtlYXJseXB1cmNoYXNlX3ZhbHVlfSArIHtjcm93ZHNhbGVfdmFsdWV9KS4KICAgICAgICAgKgogICAgICAgICAqIEV4YW1wbGU6IElmIGFuIEVhcmx5IFB1cmNoYXNlciBjb250cmlidXRlcyAxMDAgQ05ZIChpbmNsdWRpbmcgQm9udXMgb2YgMjAlKSBhbmQgdGhlCiAgICAgICAgICogdG90YWwgYW1vdW50IG9mIGVhcmx5IHB1cmNoYXNlcyBhbW91bnRzIHRvIDbigJkwMDDigJkwMDAgQ05ZIGFuZCB0aGUgdG90YWwgYW1vdW50IHJhaXNlZAogICAgICAgICAqIGR1cmluZyB0aGUgQ29udHJpYnV0aW9uIFBlcmlvZCBpcyAzMOKAmTAwMOKAmTAwMCBDTlksIHRoZW4gaGUgd2lsbCBnZXQgMTE4MC41NSBTVEFSID0KICAgICAgICAgKiA1MOKAmTAwMOKAmTAwMCBTVEFSICogMTAwIENOWSAvIDbigJkwMDDigJkwMDAgQ05ZICsgMTI14oCZMDAw4oCZMDAwIFNUQVIgKiAxMDAgQ05ZIC8KICAgICAgICAgKiAzMOKAmTAwMOKAmTAwMCBDTlkgKyA24oCZMDAw4oCZMDAwIENOWQogICAgICAgICAqLwoKICAgICAgICBpZiAoZWFybHlQdXJjaGFzZWRBbW91bnRCeVttc2cuc2VuZGVyXSA+IDApIHsgIC8vIHNraXAgaWYgaXMgbm90IGFuIGVhcmx5IHB1cmNoYXNlcgogICAgICAgICAgICB1aW50MjU2IGVhcmx5UHVyY2hhc2VyUHVyY2hhc2VWYWx1ZSA9IGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbbXNnLnNlbmRlcl07CiAgICAgICAgICAgIGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICAgICAgdWludDI1NiBlcFRva2VuQ2FsY3VsYXRpb25Gcm9tRVBUb2tlbkFtb3VudCA9IFNhZmVNYXRoLm11bChlYXJseVB1cmNoYXNlVG9rZW5BbW91bnQsIGVhcmx5UHVyY2hhc2VyUHVyY2hhc2VWYWx1ZSkgLyB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXNJbkNueTsKCiAgICAgICAgICAgIHVpbnQyNTYgZXBUb2tlbkNhbGN1bGF0aW9uRnJvbUNyb3dkc2FsZVRva2VuQW1vdW50ID0gU2FmZU1hdGgubXVsKGNyb3dkc2FsZVRva2VuQW1vdW50LCBlYXJseVB1cmNoYXNlclB1cmNoYXNlVmFsdWUpIC8gdG90YWxBbW91bnRPZlB1cmNoYXNlc0luQ255OwoKICAgICAgICAgICAgdWludDI1NiBlcFRva2VuQ291bnQgPSBTYWZlTWF0aC5hZGQoZXBUb2tlbkNhbGN1bGF0aW9uRnJvbUVQVG9rZW5BbW91bnQsIGVwVG9rZW5DYWxjdWxhdGlvbkZyb21Dcm93ZHNhbGVUb2tlbkFtb3VudCk7CgogICAgICAgICAgICBudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeVttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLmFkZChudW1PZlB1cmNoYXNlZFRva2Vuc09uRXBCeVttc2cuc2VuZGVyXSwgZXBUb2tlbkNvdW50KTsKICAgICAgICAgICAgYXNzZXJ0KHN0YXJiYXNlVG9rZW4uYWxsb2NhdGVUb0Nyb3dkc2FsZVB1cmNoYXNlcihtc2cuc2VuZGVyLCBlcFRva2VuQ291bnQpKTsKICAgICAgICAgICAgbnVtT2ZEZWxpdmVyZWRFYXJseVB1cmNoYXNlcysrOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IExvYWQgZWFybHkgcHVyY2hhc2VzIGZyb20gdGhlIGNvbnRyYWN0IGtlZXBzIHRyYWNrIG9mIHRoZW0KICAgICAqLwogICAgZnVuY3Rpb24gbG9hZEVhcmx5UHVyY2hhc2VzKCkgZXh0ZXJuYWwgb25seU93bmVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoZWFybHlQdXJjaGFzZXNMb2FkZWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAgICAvLyBhbGwgRVBzIGhhdmUgYWxyZWFkeSBiZWVuIGxvYWRlZAogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBudW1PZk9yaWdFcCA9IHN0YXJiYXNlRXBBbWVuZG1lbnQKICAgICAgICAgICAgLnN0YXJiYXNlRWFybHlQdXJjaGFzZSgpCiAgICAgICAgICAgIC5udW1iZXJPZkVhcmx5UHVyY2hhc2VzKCk7CgogICAgICAgIGZvciAodWludDI1NiBpID0gbnVtT2ZMb2FkZWRFYXJseVB1cmNoYXNlczsgaSA8IG51bU9mT3JpZ0VwICYmIG1zZy5nYXMgPiAyMDAwMDA7IGkrKykgewogICAgICAgICAgICBpZiAoc3RhcmJhc2VFcEFtZW5kbWVudC5pc0ludmFsaWRFYXJseVB1cmNoYXNlKGkpKSB7CiAgICAgICAgICAgICAgICBudW1PZkxvYWRlZEVhcmx5UHVyY2hhc2VzID0gU2FmZU1hdGguYWRkKG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMsIDEpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIChwdXJjaGFzZXIsIGFtb3VudCwpID0KICAgICAgICAgICAgICAgIHN0YXJiYXNlRXBBbWVuZG1lbnQuaXNBbWVuZGVkRWFybHlQdXJjaGFzZShpKQogICAgICAgICAgICAgICAgPyBzdGFyYmFzZUVwQW1lbmRtZW50LmFtZW5kZWRFYXJseVB1cmNoYXNlcyhpKQogICAgICAgICAgICAgICAgOiBzdGFyYmFzZUVwQW1lbmRtZW50LmVhcmx5UHVyY2hhc2VzKGkpOwogICAgICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICAgICAgaWYgKGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbcHVyY2hhc2VyXSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZWFybHlQdXJjaGFzZXJzLnB1c2gocHVyY2hhc2VyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGVhY2ggZWFybHkgcHVyY2hhc2VyIHJlY2VpdmVzIDIwJSBib251cwogICAgICAgICAgICAgICAgdWludDI1NiBib251cyA9IFNhZmVNYXRoLm11bChhbW91bnQsIDIwKSAvIDEwMDsKICAgICAgICAgICAgICAgIHVpbnQyNTYgYW1vdW50V2l0aEJvbnVzID0gU2FmZU1hdGguYWRkKGFtb3VudCwgYm9udXMpOwoKICAgICAgICAgICAgICAgIGVhcmx5UHVyY2hhc2VkQW1vdW50QnlbcHVyY2hhc2VyXSA9IFNhZmVNYXRoLmFkZChlYXJseVB1cmNoYXNlZEFtb3VudEJ5W3B1cmNoYXNlcl0sIGFtb3VudFdpdGhCb251cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMgPSBTYWZlTWF0aC5hZGQobnVtT2ZMb2FkZWRFYXJseVB1cmNoYXNlcywgMSk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnQobnVtT2ZMb2FkZWRFYXJseVB1cmNoYXNlcyA8PSBudW1PZk9yaWdFcCk7CiAgICAgICAgaWYgKG51bU9mTG9hZGVkRWFybHlQdXJjaGFzZXMgPT0gbnVtT2ZPcmlnRXApIHsKICAgICAgICAgICAgZWFybHlQdXJjaGFzZXNMb2FkZWQgPSB0cnVlOyAgICAvLyBlbmFibGUgdGhlIGZsYWcKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgICogQGRldiBTZXQgcXVhbGlmaWVkIGNyb3dkc2FsZSBwYXJ0bmVyIGkuZS4gQml0Y29pbiBTdWlzc2UgYWRkcmVzcwogICAgICAqIEBwYXJhbSBfcXVhbGlmaWVkUGFydG5lciBBZGRyZXNzIG9mIHRoZSBxdWFsaWZpZWQgcGFydG5lciB0aGF0IGNhbiBwdXJjaGFzZSBkdXJpbmcgY3Jvd2RzYWxlCiAgICAgICogQHBhcmFtIF9hbW91bnRDYXAgRXRoZXIgdmFsdWUgd2hpY2ggcGFydG5lciBpcyBhYmxlIHRvIGNvbnRyaWJ1dGUKICAgICAgKiBAcGFyYW0gX2NvbW1pc3Npb25GZWVQZXJjZW50YWdlIEludGVnZXIgdGhhdCByZXByZXNlbnRzIHRoZSBmZWUgdG8gcGF5IHF1YWxpZmllZCBwYXJ0bmVyIDUgaXMgNSUKICAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFF1YWxpZmllZFBhcnRuZXIoYWRkcmVzcyBfcXVhbGlmaWVkUGFydG5lciwgdWludDI1NiBfYW1vdW50Q2FwLCB1aW50MjU2IF9jb21taXNzaW9uRmVlUGVyY2VudGFnZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGFzc2VydCghcXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYm9uYUZpZGUgPSB0cnVlOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW19xdWFsaWZpZWRQYXJ0bmVyXS5hbW91bnRDYXAgPSBfYW1vdW50Q2FwOwogICAgICAgIHF1YWxpZmllZFBhcnRuZXJzW19xdWFsaWZpZWRQYXJ0bmVyXS5jb21taXNzaW9uRmVlUGVyY2VudGFnZSA9IF9jb21taXNzaW9uRmVlUGVyY2VudGFnZTsKICAgICAgICBRdWFsaWZpZWRQYXJ0bmVyQWRkcmVzcyhfcXVhbGlmaWVkUGFydG5lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZSBhZGRyZXNzIGZyb20gcXVhbGlmaWVkIHBhcnRuZXJzIGxpc3QuCiAgICAgKiBAcGFyYW0gX3F1YWxpZmllZFBhcnRuZXIgQWRkcmVzcyB0byBiZSByZW1vdmVkIGZyb20gdGhlIGxpc3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVubGlzdFF1YWxpZmllZFBhcnRuZXIoYWRkcmVzcyBfcXVhbGlmaWVkUGFydG5lcikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYm9uYUZpZGUgPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlIHdoaXRlbGlzdGVkIGFkZHJlc3MgYW1vdW50IGFsbG93ZWQgdG8gcmFpc2UgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICogQHBhcmFtIF9xdWFsaWZpZWRQYXJ0bmVyIFF1YWxpZmllZCBQYXJ0bmVyIGFkZHJlc3MgdG8gYmUgdXBkYXRlZC4KICAgICAqIEBwYXJhbSBfYW1vdW50Q2FwIEFtb3VudCB0aGF0IHRoZSBhZGRyZXNzIGlzIGFibGUgdG8gcmFpc2UgZHVyaW5nIHRoZSBwcmVzYWxlLgogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVRdWFsaWZpZWRQYXJ0bmVyQ2FwQW1vdW50KGFkZHJlc3MgX3F1YWxpZmllZFBhcnRuZXIsIHVpbnQyNTYgX2Ftb3VudENhcCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBhc3NlcnQocXVhbGlmaWVkUGFydG5lcnNbX3F1YWxpZmllZFBhcnRuZXJdLmJvbmFGaWRlKTsKICAgICAgICBxdWFsaWZpZWRQYXJ0bmVyc1tfcXVhbGlmaWVkUGFydG5lcl0uYW1vdW50Q2FwID0gX2Ftb3VudENhcDsKICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyBmdW5jdGlvbnMKICAgICAqLwoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIGJvb2xlYW4gZm9yIHdoZXRoZXIgY3Jvd2RzYWxlIGhhcyBlbmRlZAogICAgICovCiAgICBmdW5jdGlvbiBpc0VuZGVkKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKGVuZGVkQXQgPiAwICYmIGVuZGVkQXQgPD0gbm93KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgcHVyY2hhc2VzIHRvIGRhdGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG51bU9mUHVyY2hhc2VzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gY3Jvd2RzYWxlUHVyY2hhc2VzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2FsY3VsYXRlcyB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZCBpbmNsdWRlcyBib251cyB0b2tlbnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDI1NiBhbW91bnQpIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaTsgaSA8IGNyb3dkc2FsZVB1cmNoYXNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhbW91bnQgPSBTYWZlTWF0aC5hZGQoYW1vdW50LCBjcm93ZHNhbGVQdXJjaGFzZXNbaV0uYW1vdW50KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENhbGN1bGF0ZXMgdG90YWwgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQgd2l0aG91dCBib251cyBjb252ZXJzaW9uLgogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KSB7CiAgICAgICAgZm9yICh1aW50MjU2IGk7IGkgPCBjcm93ZHNhbGVQdXJjaGFzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgYW1vdW50ID0gU2FmZU1hdGguYWRkKGFtb3VudCwgY3Jvd2RzYWxlUHVyY2hhc2VzW2ldLnJhd0Ftb3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRvdGFsIHJhaXNlZCBhbW91bnQgaW4gQ05ZIChpbmNsdWRlcyBFUCkgYW5kIGJvbnVzZXMKICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxSYWlzZWRBbW91bnRJbkNueSgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIFNhZmVNYXRoLmFkZCh0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSwgdG90YWxBbW91bnRPZkNyb3dkc2FsZVB1cmNoYXNlcygpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0b3RhbCBhbW91bnQgb2YgZWFybHkgcHVyY2hhc2VzIGluIENOWQogICAgICovCiAgICBmdW5jdGlvbiB0b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICByZXR1cm4gc3RhcmJhc2VFcEFtZW5kbWVudC50b3RhbEFtb3VudE9mRWFybHlQdXJjaGFzZXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHF1YWxpZmllZCBjcm93ZHNhbGUgcGFydG5lciB0byBwdXJjaGFzZSBTdGFyIFRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBwdXJjaGFzZUFzUXVhbGlmaWVkUGFydG5lcigpCiAgICAgICAgcGF5YWJsZQogICAgICAgIHB1YmxpYwogICAgICAgIHJhdGVJc1NldChjbnlFdGhSYXRlKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5ib25hRmlkZSk7CiAgICAgICAgcXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYW1vdW50UmFpc2VkID0gU2FmZU1hdGguYWRkKG1zZy52YWx1ZSwgcXVhbGlmaWVkUGFydG5lcnNbbXNnLnNlbmRlcl0uYW1vdW50UmFpc2VkKTsKCiAgICAgICAgYXNzZXJ0KHF1YWxpZmllZFBhcnRuZXJzW21zZy5zZW5kZXJdLmFtb3VudFJhaXNlZCA8PSBxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5hbW91bnRDYXApOwoKICAgICAgICB1aW50MjU2IGJvbnVzVGllciA9IDMwOyAvLyBQcmUgc2FsZSBwdXJjaGFzZXJzIGdldCAzMCBwZXJjZW50IGJvbnVzCiAgICAgICAgdWludDI1NiByYXdBbW91bnQgPSBTYWZlTWF0aC5tdWwobXNnLnZhbHVlLCBjbnlFdGhSYXRlKSAvIDFlMTg7CiAgICAgICAgdWludCBhbW91bnQgPSByZWNvcmRQdXJjaGFzZShtc2cuc2VuZGVyLCByYXdBbW91bnQsIG5vdywgJycsIGJvbnVzVGllcik7CgogICAgICAgIGlmIChxdWFsaWZpZWRQYXJ0bmVyc1ttc2cuc2VuZGVyXS5jb21taXNzaW9uRmVlUGVyY2VudGFnZSA+IDApIHsKICAgICAgICAgICAgc2VuZFF1YWxpZmllZFBhcnRuZXJDb21taXNzaW9uRmVlKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICBTdGFyYmFzZVB1cmNoYXNlZFdpdGhFdGgobXNnLnNlbmRlciwgYW1vdW50LCByYXdBbW91bnQsIGNueUV0aFJhdGUsIGJvbnVzVGllcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB1c2VyIHRvIHB1cmNoYXNlIFNUQVIgdG9rZW5zIHdpdGggRXRoZXIKICAgICAqLwogICAgZnVuY3Rpb24gcHVyY2hhc2VXaXRoRXRoKCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgcHVibGljCiAgICAgICAgbWluSW52ZXN0bWVudAogICAgICAgIHdoZW5Ob3RFbmRlZAogICAgICAgIHJhdGVJc1NldChjbnlFdGhSYXRlKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShwdXJjaGFzZVN0YXJ0QmxvY2sgPiAwICYmIGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spOwogICAgICAgIGlmIChzdGFydERhdGUgPT0gMCkgewogICAgICAgICAgICBzdGFydENyb3dkc2FsZShibG9jay50aW1lc3RhbXApOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBib251c1RpZXIgPSBnZXRCb251c1RpZXIoKTsKCiAgICAgICAgdWludDI1NiByYXdBbW91bnQgPSBTYWZlTWF0aC5tdWwobXNnLnZhbHVlLCBjbnlFdGhSYXRlKSAvIDFlMTg7CiAgICAgICAgdWludCBhbW91bnQgPSByZWNvcmRQdXJjaGFzZShtc2cuc2VuZGVyLCByYXdBbW91bnQsIG5vdywgJycsIGJvbnVzVGllcik7CgogICAgICAgIFN0YXJiYXNlUHVyY2hhc2VkV2l0aEV0aChtc2cuc2VuZGVyLCBhbW91bnQsIHJhd0Ftb3VudCwgY255RXRoUmF0ZSwgYm9udXNUaWVyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAgICovCgogICAgLyoqCiAgICAgKiBAZGV2IEluaXRpYWxpemVzIFN0YXJiYXNlIGNyb3dkc2FsZQogICAgICovCiAgICBmdW5jdGlvbiBzdGFydENyb3dkc2FsZSh1aW50MjU2IHRpbWVzdGFtcCkgaW50ZXJuYWwgewogICAgICAgIHN0YXJ0RGF0ZSA9IHRpbWVzdGFtcDsKCiAgICAgICAgLy8gc2V0IHRva2VuIGJvbnVzIG1pbGVzdG9uZXMKICAgICAgICBmaXJzdEJvbnVzU2FsZXNFbmRzID0gc3RhcnREYXRlICsgNyBkYXlzOyAgICAgICAgICAgICAvLyAxLiAxc3QgfiA3dGggZGF5CiAgICAgICAgc2Vjb25kQm9udXNTYWxlc0VuZHMgPSBmaXJzdEJvbnVzU2FsZXNFbmRzICsgMTQgZGF5czsgLy8gMi4gOHRoIH4gMjFzdCBkYXkKICAgICAgICB0aGlyZEJvbnVzU2FsZXNFbmRzID0gc2Vjb25kQm9udXNTYWxlc0VuZHMgKyAxNCBkYXlzOyAvLyAzLiAyMm5kIH4gMzV0aCBkYXkKICAgICAgICBmb3VydGhCb251c1NhbGVzRW5kcyA9IHRoaXJkQm9udXNTYWxlc0VuZHMgKyA3IGRheXM7ICAvLyA0LiAzNnRoIH4gNDJuZCBkYXkKICAgICAgICBmaWZ0aEJvbnVzU2FsZXNFbmRzID0gZm91cnRoQm9udXNTYWxlc0VuZHMgKyAzIGRheXM7ICAvLyA1LiA0M3JkIH4gNDV0aCBkYXkKCiAgICAgICAgLy8gZXh0ZW5kZWQgc2FsZXMgYm9udXMgbWlsZXN0b25lcwogICAgICAgIGZpcnN0RXh0ZW5kZWRCb251c1NhbGVzRW5kcyA9IGZpZnRoQm9udXNTYWxlc0VuZHMgKyAzIGRheXM7ICAgICAgICAgLy8gMS4gNDZ0aCB+IDQ4dGggZGF5CiAgICAgICAgc2Vjb25kRXh0ZW5kZWRCb251c1NhbGVzRW5kcyA9IGZpcnN0RXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDMgZGF5czsgLy8gMi4gNDl0aCB+IDUxc3QgZGF5CiAgICAgICAgdGhpcmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzID0gc2Vjb25kRXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDMgZGF5czsgLy8gMy4gNTJuZCB+IDU0dGggZGF5CiAgICAgICAgZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyA9IHRoaXJkRXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDMgZGF5czsgLy8gNC4gNTV0aCB+IDU3dGggZGF5CiAgICAgICAgZmlmdGhFeHRlbmRlZEJvbnVzU2FsZXNFbmRzID0gZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDMgZGF5czsgIC8vIDUuIDU4dGggfiA2MHRoIGRheQogICAgICAgIHNpeHRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyA9IGZpZnRoRXh0ZW5kZWRCb251c1NhbGVzRW5kcyArIDYwIGRheXM7IC8vIDYuIDYxc3QgfiAxMjB0aCBkYXkKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWJzdHJhY3QgcmVjb3JkIG9mIGEgcHVyY2hhc2UgdG8gVG9rZW5zCiAgICAgKiBAcGFyYW0gcHVyY2hhc2VyIEFkZHJlc3Mgb2YgdGhlIGJ1eWVyCiAgICAgKiBAcGFyYW0gcmF3QW1vdW50IEFtb3VudCBpbiBDTlkgYXMgcGVyIHRoZSBDTlkvRVRIIHJhdGUgdXNlZAogICAgICogQHBhcmFtIHRpbWVzdGFtcCBUaW1lc3RhbXAgYXQgdGhlIHB1cmNoYXNlIG1hZGUKICAgICAqIEBwYXJhbSBkYXRhIElkZW50aWZpZXIgYXMgYW4gZXZpZGVuY2Ugb2YgdGhlIHB1cmNoYXNlIChlLmcuIGJ0YzoxeHl6eHl6KQogICAgICogQHBhcmFtIGJvbnVzVGllciBib251cyBtaWxlc3RvbmVzIG9mIHRoZSBwdXJjaGFzZQogICAgICovCiAgICBmdW5jdGlvbiByZWNvcmRQdXJjaGFzZSgKICAgICAgICBhZGRyZXNzIHB1cmNoYXNlciwKICAgICAgICB1aW50MjU2IHJhd0Ftb3VudCwKICAgICAgICB1aW50MjU2IHRpbWVzdGFtcCwKICAgICAgICBzdHJpbmcgZGF0YSwKICAgICAgICB1aW50MjU2IGJvbnVzVGllcgogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBhbW91bnQgPSByYXdBbW91bnQ7IC8vIGFtb3VudCB0byBjaGVjayByZWFjaCBvZiBtYXggY2FwLiBpdCBkb2VzIG5vdCBjYXJlIGZvciBib251cyB0b2tlbnMgaGVyZQoKICAgICAgICAvLyBwcmVzYWxlIHRyYW5zZmVycyB3aGljaCBvY2N1cnMgYmVmb3JlIHRoZSBjcm93ZHNhbGUgaWdub3JlcyB0aGUgY3Jvd2RzYWxlIGhhcmQgY2FwCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA+PSBwdXJjaGFzZVN0YXJ0QmxvY2spIHsKCiAgICAgICAgICAgIGFzc2VydCh0b3RhbEFtb3VudE9mQ3Jvd2RzYWxlUHVyY2hhc2VzV2l0aG91dEJvbnVzKCkgPD0gbWF4Q3Jvd2RzYWxlQ2FwKTsKCiAgICAgICAgICAgIHVpbnQyNTYgY3Jvd2RzYWxlVG90YWxBbW91bnRBZnRlclB1cmNoYXNlID0gU2FmZU1hdGguYWRkKHRvdGFsQW1vdW50T2ZDcm93ZHNhbGVQdXJjaGFzZXNXaXRob3V0Qm9udXMoKSwgYW1vdW50KTsKCiAgICAgICAgICAgIC8vIGNoZWNrIHdoZXRoZXIgcHVyY2hhc2UgZ29lcyBvdmVyIHRoZSBjYXAgYW5kIHNlbmQgdGhlIGRpZmZlcmVuY2UgYmFjayB0byB0aGUgcHVyY2hhc2VyLgogICAgICAgICAgICBpZiAoY3Jvd2RzYWxlVG90YWxBbW91bnRBZnRlclB1cmNoYXNlID4gbWF4Q3Jvd2RzYWxlQ2FwKSB7CiAgICAgICAgICAgICAgdWludDI1NiBkaWZmZXJlbmNlID0gU2FmZU1hdGguc3ViKGNyb3dkc2FsZVRvdGFsQW1vdW50QWZ0ZXJQdXJjaGFzZSwgbWF4Q3Jvd2RzYWxlQ2FwKTsKICAgICAgICAgICAgICB1aW50MjU2IGV0aFZhbHVlVG9SZXR1cm4gPSBTYWZlTWF0aC5tdWwoZGlmZmVyZW5jZSwgMWUxOCkgLyBjbnlFdGhSYXRlOwogICAgICAgICAgICAgIHB1cmNoYXNlci50cmFuc2ZlcihldGhWYWx1ZVRvUmV0dXJuKTsKICAgICAgICAgICAgICBhbW91bnQgPSBTYWZlTWF0aC5zdWIoYW1vdW50LCBkaWZmZXJlbmNlKTsKICAgICAgICAgICAgICByYXdBbW91bnQgPSBhbW91bnQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IGNvdmVydGVkQW1vdW50d1dpdGhCb251cyA9IFNhZmVNYXRoLm11bChhbW91bnQsIGJvbnVzVGllcikgLyAxMDA7CiAgICAgICAgYW1vdW50ID0gU2FmZU1hdGguYWRkKGFtb3VudCwgY292ZXJ0ZWRBbW91bnR3V2l0aEJvbnVzKTsgLy8gYXQgdGhpcyBwb2ludCBhbW91bnQgYm9udXMgaXMgY2FsY3VsYXRlZAoKICAgICAgICBDcm93ZHNhbGVQdXJjaGFzZSBtZW1vcnkgcHVyY2hhc2UgPSBDcm93ZHNhbGVQdXJjaGFzZShwdXJjaGFzZXIsIGFtb3VudCwgcmF3QW1vdW50LCB0aW1lc3RhbXAsIGRhdGEsIGJvbnVzVGllcik7CiAgICAgICAgY3Jvd2RzYWxlUHVyY2hhc2VzLnB1c2gocHVyY2hhc2UpOwogICAgICAgIGNyb3dkc2FsZVB1cmNoYXNlQW1vdW50QnlbcHVyY2hhc2VyXSA9IFNhZmVNYXRoLmFkZChjcm93ZHNhbGVQdXJjaGFzZUFtb3VudEJ5W3B1cmNoYXNlcl0sIGFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRmV0Y2hzIEJvbnVzIHRpZXIgcGVyY2VudGFnZSBwZXIgYm9udXMgbWlsZXN0b25lcwogICAgICovCiAgICBmdW5jdGlvbiBnZXRCb251c1RpZXIoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYm9vbCBmaXJzdEJvbnVzU2FsZXNQZXJpb2QgPSBub3cgPj0gc3RhcnREYXRlICYmIG5vdyA8PSBmaXJzdEJvbnVzU2FsZXNFbmRzOyAvLyAxc3QgfiA3dGggZGF5IGdldCAyMCUgYm9udXMKICAgICAgICBib29sIHNlY29uZEJvbnVzU2FsZXNQZXJpb2QgPSBub3cgPiBmaXJzdEJvbnVzU2FsZXNFbmRzICYmIG5vdyA8PSBzZWNvbmRCb251c1NhbGVzRW5kczsgLy8gOHRoIH4gMjFzdCBkYXkgZ2V0IDE1JSBib251cwogICAgICAgIGJvb2wgdGhpcmRCb251c1NhbGVzUGVyaW9kID0gbm93ID4gc2Vjb25kQm9udXNTYWxlc0VuZHMgJiYgbm93IDw9IHRoaXJkQm9udXNTYWxlc0VuZHM7IC8vIDIybmQgfiAzNXRoIGRheSBnZXQgMTAlIGJvbnVzCiAgICAgICAgYm9vbCBmb3VydGhCb251c1NhbGVzUGVyaW9kID0gbm93ID4gdGhpcmRCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gZm91cnRoQm9udXNTYWxlc0VuZHM7IC8vIDM2dGggfiA0Mm5kIGRheSBnZXQgNSUgYm9udXMKICAgICAgICBib29sIGZpZnRoQm9udXNTYWxlc1BlcmlvZCA9IG5vdyA+IGZvdXJ0aEJvbnVzU2FsZXNFbmRzICYmIG5vdyA8PSBmaWZ0aEJvbnVzU2FsZXNFbmRzOyAvLyA0M3JkIGFuZCA0NXRoIGRheSBnZXQgMCUgYm9udXMKCiAgICAgICAgLy8gZXh0ZW5kZWQgYm9udXMgc2FsZXMKICAgICAgICBib29sIGZpcnN0RXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kID0gbm93ID4gZmlmdGhCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gZmlyc3RFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOyAvLyBleHRlbmRlZCBzYWxlcyA0NnRoIH4gNDh0aCBkYXkgZ2V0IDIwJSBib251cwogICAgICAgIGJvb2wgc2Vjb25kRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kID0gbm93ID4gZmlyc3RFeHRlbmRlZEJvbnVzU2FsZXNFbmRzICYmIG5vdyA8PSBzZWNvbmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOyAvLyA0OXRoIH4gNTFzdCAxNSUgYm9udXMKICAgICAgICBib29sIHRoaXJkRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kID0gbm93ID4gc2Vjb25kRXh0ZW5kZWRCb251c1NhbGVzRW5kcyAmJiBub3cgPD0gdGhpcmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOyAvLyA1Mm5kIH4gNTR0aCBkYXkgZ2V0IDEwJSBib251cwogICAgICAgIGJvb2wgZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kID0gbm93ID4gdGhpcmRFeHRlbmRlZEJvbnVzU2FsZXNFbmRzICYmIG5vdyA8PSBmb3VydGhFeHRlbmRlZEJvbnVzU2FsZXNFbmRzOyAvLyA1NXRoIH4gNTd0aCBkYXkgZGF5IGdldCA1JSBib251cwogICAgICAgIGJvb2wgZmlmdGhFeHRlbmRlZEJvbnVzU2FsZXNQZXJpb2QgPSBub3cgPiBmb3VydGhFeHRlbmRlZEJvbnVzU2FsZXNFbmRzICYmIG5vdyA8PSBmaWZ0aEV4dGVuZGVkQm9udXNTYWxlc0VuZHM7IC8vIDU4dGggfiA2MHRoIGRheSBnZXQgMCUgYm9udXMKICAgICAgICBib29sIHNpeHRoRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kID0gbm93ID4gZmlmdGhFeHRlbmRlZEJvbnVzU2FsZXNFbmRzICYmIG5vdyA8PSBzaXh0aEV4dGVuZGVkQm9udXNTYWxlc0VuZHM7IC8vIDYxc3QgfiAxMjB0aCBkYXkgZ2V0IHtudW1iZXJfb2ZfZGF5c30gLSA2MCAqIDElIGJvbnVzCgogICAgICAgIGlmIChmaXJzdEJvbnVzU2FsZXNQZXJpb2QgfHwgZmlyc3RFeHRlbmRlZEJvbnVzU2FsZXNQZXJpb2QpIHJldHVybiAyMDsKICAgICAgICBpZiAoc2Vjb25kQm9udXNTYWxlc1BlcmlvZCB8fCBzZWNvbmRFeHRlbmRlZEJvbnVzU2FsZXNQZXJpb2QpIHJldHVybiAxNTsKICAgICAgICBpZiAodGhpcmRCb251c1NhbGVzUGVyaW9kIHx8IHRoaXJkRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kKSByZXR1cm4gMTA7CiAgICAgICAgaWYgKGZvdXJ0aEJvbnVzU2FsZXNQZXJpb2QgfHwgZm91cnRoRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kKSByZXR1cm4gNTsKICAgICAgICBpZiAoZmlmdGhCb251c1NhbGVzUGVyaW9kIHx8IGZpZnRoRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kKSByZXR1cm4gMDsKCiAgICAgICAgaWYgKHNpeHRoRXh0ZW5kZWRCb251c1NhbGVzUGVyaW9kKSB7CiAgICAgICAgICB1aW50MjU2IERBWV9JTl9TRUNPTkRTID0gODY0MDA7CiAgICAgICAgICB1aW50MjU2IHNlY29uZHNTaW5jZVN0YXJ0RGF0ZSA9IFNhZmVNYXRoLnN1Yihub3csIHN0YXJ0RGF0ZSk7CiAgICAgICAgICB1aW50MjU2IG51bWJlck9mRGF5cyA9IHNlY29uZHNTaW5jZVN0YXJ0RGF0ZSAvIERBWV9JTl9TRUNPTkRTOwoKICAgICAgICAgIHJldHVybiBTYWZlTWF0aC5zdWIobnVtYmVyT2ZEYXlzLCA2MCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBGZXRjaHMgQm9udXMgdGllciBwZXJjZW50YWdlIHBlciBib251cyBtaWxlc3RvbmVzCiAgICAgKiBAZGV2IHF1YWxpZmllZFBhcnRuZXIgQWRkcmVzcyBvZiBwYXJ0bmVycyB0aGF0IHBhcnRpY2lwYXRlZCBpbiBwcmUgc2FsZQogICAgICogQGRldiBhbW91bnRTZW50IFZhbHVlIHNlbnQgYnkgcXVhbGlmaWVkIHBhcnRuZXIKICAgICAqLwogICAgZnVuY3Rpb24gc2VuZFF1YWxpZmllZFBhcnRuZXJDb21taXNzaW9uRmVlKGFkZHJlc3MgcXVhbGlmaWVkUGFydG5lciwgdWludDI1NiBhbW91bnRTZW50KSBpbnRlcm5hbCB7CiAgICAgICAgLy9jYWxjdWxhdGUgdGhlIGNvbW1pc3Npb24gZmVlIHRvIHNlbmQgdG8gcXVhbGlmaWVkIHBhcnRuZXIKICAgICAgICB1aW50MjU2IGNvbW1pc3Npb25GZWVQZXJjZW50YWdlQ2FsY3VsYXRpb25BbW91bnQgPSBTYWZlTWF0aC5tdWwoYW1vdW50U2VudCwgcXVhbGlmaWVkUGFydG5lcnNbcXVhbGlmaWVkUGFydG5lcl0uY29tbWlzc2lvbkZlZVBlcmNlbnRhZ2UpIC8gMTAwOwoKICAgICAgICAvLyBzZW5kIGNvbW1pc3Npb24gZmVlIGFtb3VudAogICAgICAgIHF1YWxpZmllZFBhcnRuZXIudHJhbnNmZXIoY29tbWlzc2lvbkZlZVBlcmNlbnRhZ2VDYWxjdWxhdGlvbkFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHJlZGlyZWN0VG9QdXJjaGFzZSBSZWRpcmVjdCB0byBhZGVxdWF0ZSBwdXJjaGFzZSBmdW5jdGlvbiB3aXRoaW4gdGhlIHNtYXJ0IGNvbnRyYWN0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlZGlyZWN0VG9QdXJjaGFzZSgpIGludGVybmFsIHsKICAgICAgICBpZiAoYmxvY2subnVtYmVyIDwgcHVyY2hhc2VTdGFydEJsb2NrKSB7CiAgICAgICAgICAgIHB1cmNoYXNlQXNRdWFsaWZpZWRQYXJ0bmVyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHVyY2hhc2VXaXRoRXRoKCk7CiAgICAgICAgfQogICAgfQp9'.
	

]
