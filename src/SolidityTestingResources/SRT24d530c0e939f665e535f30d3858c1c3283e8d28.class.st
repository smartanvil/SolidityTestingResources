Class {
	#name : #SRT24d530c0e939f665e535f30d3858c1c3283e8d28,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT24d530c0e939f665e535f30d3858c1c3283e8d28 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CgogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIEVqZWN0YWJsZU93bmFibGUKICogQGRldiBUaGUgRWplY3RhYmxlT3duYWJsZSBjb250cmFjdCBwcm92aWRlcyB0aGUgZnVuY3Rpb24gdG8gcmVtb3ZlIHRoZSBvd25lcnNoaXAgb2YgdGhlIGNvbnRyYWN0LgogKi8KY29udHJhY3QgRWplY3RhYmxlT3duYWJsZSBpcyBPd25hYmxlIHsKCiAgICAvKioKICAgICAqIEBkZXYgUmVtb3ZlIHRoZSBvd25lcnNoaXAgYnkgc2V0dGluZyB0aGUgb3duZXIgYWRkcmVzcyB0byBudWxsLAogICAgICogYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uLCBhbGwgb25seU93bmVyIGZ1bmN0aW9uIHdpbGwgYmUgYmUgYWJsZSB0byBiZSBjYWxsZWQgYnkgYW55b25lIGFueW1vcmUsCiAgICAgKiB0aGUgY29udHJhY3Qgd2lsbCBhY2hpZXZlIHRydWx5IGRlY2VudHJhbGlzYXRpb24uCiAgICAqLwogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXJzaGlwKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSAweDA7CiAgICB9Cgp9CgovKioKICogQHRpdGxlIEpvaW50T3duYWJsZQogKiBAZGV2IEV4dGVuc2lvbiBmb3IgdGhlIE93bmFibGUgY29udHJhY3QsIHdoZXJlIHRoZSBvd25lciBjYW4gYXNzaWduIGFub3RoZXIgYWRkcmVzcwogKiAgdG8gbWFuYWdlIHNvbWUgZnVuY3Rpb25zIG9mIHRoZSBjb250cmFjdCwgdXNpbmcgdGhlIGVpdGhlck93bmVyIG1vZGlmaWVyLgogKiAgTm90ZSB0aGF0IG9ubHlPd25lciBtb2RpZmllciB3b3VsZCBzdGlsbCBiZSBhY2Nlc3NpYmxlIG9ubHkgZm9yIHRoZSBvcmlnaW5hbCBvd25lci4KICovCmNvbnRyYWN0IEpvaW50T3duYWJsZSBpcyBPd25hYmxlIHsKCiAgZXZlbnQgQW5vdGhlck93bmVyQXNzaWduZWQoYWRkcmVzcyBpbmRleGVkIGFub3RoZXJPd25lcik7CgogIGFkZHJlc3MgcHVibGljIGFub3RoZXJPd25lcjsKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyIG9yIGFub3RoZXJPd25lci4KICAgKi8KICBtb2RpZmllciBlaXRoZXJPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lciB8fCBtc2cuc2VuZGVyID09IGFub3RoZXJPd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gYXNzaWduIGFub3RoZXIgb3duZXIuCiAgICogQHBhcmFtIF9hbm90aGVyT3duZXIgVGhlIGFkZHJlc3MgdG8gYW5vdGhlciBvd25lci4KICAgKi8KICBmdW5jdGlvbiBhc3NpZ25Bbm90aGVyT3duZXIoYWRkcmVzcyBfYW5vdGhlck93bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoX2Fub3RoZXJPd25lciAhPSAwKTsKICAgIEFub3RoZXJPd25lckFzc2lnbmVkKF9hbm90aGVyT3duZXIpOwogICAgYW5vdGhlck93bmVyID0gX2Fub3RoZXJPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIERlc3RydWN0aWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3QgdGhhdCBjYW4gYmUgZGVzdHJveWVkIGJ5IG93bmVyLiBBbGwgZnVuZHMgaW4gY29udHJhY3Qgd2lsbCBiZSBzZW50IHRvIHRoZSBvd25lci4KICovCmNvbnRyYWN0IERlc3RydWN0aWJsZSBpcyBPd25hYmxlIHsKCiAgZnVuY3Rpb24gRGVzdHJ1Y3RpYmxlKCkgcHVibGljIHBheWFibGUgeyB9CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXJzIHRoZSBjdXJyZW50IGJhbGFuY2UgdG8gdGhlIG93bmVyIGFuZCB0ZXJtaW5hdGVzIHRoZSBjb250cmFjdC4KICAgKi8KICBmdW5jdGlvbiBkZXN0cm95KCkgb25seU93bmVyIHB1YmxpYyB7CiAgICBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogIH0KCiAgZnVuY3Rpb24gZGVzdHJveUFuZFNlbmQoYWRkcmVzcyBfcmVjaXBpZW50KSBvbmx5T3duZXIgcHVibGljIHsKICAgIHNlbGZkZXN0cnVjdChfcmVjaXBpZW50KTsKICB9Cgp9CgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewoKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cgp9CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgLyoqCiAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgUHVsbFBheW1lbnQKICogQGRldiBCYXNlIGNvbnRyYWN0IHN1cHBvcnRpbmcgYXN5bmMgc2VuZCBmb3IgcHVsbCBwYXltZW50cy4gSW5oZXJpdCBmcm9tIHRoaXMKICogY29udHJhY3QgYW5kIHVzZSBhc3luY1NlbmQgaW5zdGVhZCBvZiBzZW5kLgogKi8KY29udHJhY3QgUHVsbFBheW1lbnQgewoKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwYXltZW50czsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFBheW1lbnRzOwoKICAvKioKICAgKiBAZGV2IHdpdGhkcmF3IGFjY3VtdWxhdGVkIGJhbGFuY2UsIGNhbGxlZCBieSBwYXllZS4KICAgKi8KICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkgcHVibGljIHsKICAgIGFkZHJlc3MgcGF5ZWUgPSBtc2cuc2VuZGVyOwogICAgdWludDI1NiBwYXltZW50ID0gcGF5bWVudHNbcGF5ZWVdOwoKICAgIHJlcXVpcmUocGF5bWVudCAhPSAwKTsKICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IHBheW1lbnQpOwoKICAgIHRvdGFsUGF5bWVudHMgPSB0b3RhbFBheW1lbnRzLnN1YihwYXltZW50KTsKICAgIHBheW1lbnRzW3BheWVlXSA9IDA7CgogICAgYXNzZXJ0KHBheWVlLnNlbmQocGF5bWVudCkpOwogIH0KCiAgLyoqCiAgICogQGRldiBDYWxsZWQgYnkgdGhlIHBheWVyIHRvIHN0b3JlIHRoZSBzZW50IGFtb3VudCBhcyBjcmVkaXQgdG8gYmUgcHVsbGVkLgogICAqIEBwYXJhbSBkZXN0IFRoZSBkZXN0aW5hdGlvbiBhZGRyZXNzIG9mIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICovCiAgZnVuY3Rpb24gYXN5bmNTZW5kKGFkZHJlc3MgZGVzdCwgdWludDI1NiBhbW91bnQpIGludGVybmFsIHsKICAgIHBheW1lbnRzW2Rlc3RdID0gcGF5bWVudHNbZGVzdF0uYWRkKGFtb3VudCk7CiAgICB0b3RhbFBheW1lbnRzID0gdG90YWxQYXltZW50cy5hZGQoYW1vdW50KTsKICB9Cgp9Cgpjb250cmFjdCBEdW5nZW9uU3RydWN0cyB7CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBtYWluIER1bmdlb24gc3RydWN0LiBFdmVyeSBkdW5nZW9uIGluIHRoZSBnYW1lIGlzIHJlcHJlc2VudGVkIGJ5IHRoaXMgc3RydWN0dXJlLgogICAgICogQSBkdW5nZW9uIGlzIGNvbnNpc3RzIG9mIGFuIHVubGltaXRlZCBudW1iZXIgb2YgZmxvb3JzIGZvciB5b3VyIGhlcm9lcyB0byBjaGFsbGVuZ2UsCiAgICAgKiB0aGUgcG93ZXIgbGV2ZWwgb2YgYSBkdW5nZW9uIGlzIGVuY29kZWQgaW4gdGhlIGZsb29yR2VuZXMuIFNvbWUgZHVuZ2VvbnMgYXJlIGluIGZhY3QgbW9yZSAiY2hhbGxlbmdpbmciIHRoYW4gb3RoZXJzLAogICAgICogdGhlIHNlY3JldCBmb3JtdWxhIGZvciB0aGF0IGlzIGxlZnQgZm9yIHVzZXIgdG8gZmluZCBvdXQuCiAgICAgKgogICAgICogRWFjaCBkdW5nZW9uIGFsc28gaGFzIGEgInRyYWluaW5nIGFyZWEiLCBoZXJvZXMgY2FuIHBlcmZvcm0gdHJhaW5pbmdzIGFuZCB1cGdyYWRlIHRoZWlyIHN0YXQsCiAgICAgKiBhbmQgc29tZSBkdW5nZW9ucyBhcmUgbW9yZSBlZmZlY3RpdmUgaW4gdGhlIHRyYWluaW5nLCB3aGljaCBpcyBhbHNvIGEgc2VjcmV0IGZvcm11bGEhCiAgICAgKgogICAgICogV2hlbiBwbGF5ZXIgY2hhbGxlbmdlIG9yIGRvIHRyYWluaW5nIGluIGEgZHVuZ2VvbiwgdGhlIGZlZSB3aWxsIGJlIGNvbGxlY3RlZCBhcyB0aGUgZHVuZ2VvbiByZXdhcmRzLAogICAgICogd2hpY2ggd2lsbCBiZSByZXdhcmRlZCB0byB0aGUgcGxheWVyIHdobyBzdWNjZXNzZnVsbHkgY2hhbGxlbmdlZCB0aGUgY3VycmVudCBmbG9vci4KICAgICAqCiAgICAgKiBFYWNoIGR1bmdlb24gZml0cyBpbiBmaXRzIGludG8gdGhyZWUgMjU2LWJpdCB3b3Jkcy4KICAgICAqLwogICAgc3RydWN0IER1bmdlb24gewoKICAgICAgICAvLyBUaGUgdGltZXN0YW1wIGZyb20gdGhlIGJsb2NrIHdoZW4gdGhpcyBkdW5nZW9uIGlzIGNyZWF0ZWQuCiAgICAgICAgdWludDMyIGNyZWF0aW9uVGltZTsKCiAgICAgICAgLy8gVGhlIHN0YXR1cyBvZiB0aGUgZHVuZ2VvbiwgZWFjaCBkdW5nZW9uIGNhbiBoYXZlIDQgc3RhdHVzLCBuYW1lbHk6CiAgICAgICAgLy8gMDogQWN0aXZlIHwgMTogQ2hhbGxlbmdlIE9ubHkgfCAyOiBUcmFpbiBPbmx5IHwgMzogSW5BY3RpdmUKICAgICAgICB1aW50MTYgc3RhdHVzOwoKICAgICAgICAvLyBUaGUgZHVuZ2VvbidzIGRpZmZpY3VsdHksIHRoZSBoaWdoZXIgdGhlIGRpZmZpY3VsdHksCiAgICAgICAgLy8gbm9ybWFsbHksIHRoZSAicmFyZXIiIHRoZSBzZWVkR2VuZXMsIHRoZSBoaWdoZXIgdGhlIGRpZmZjdWx0eSwKICAgICAgICAvLyBhbmQgdGhlIGhpZ2hlciB0aGUgY29udHJpYnV0aW9uIGZlZSBpdCBpcyB0byBjaGFsbGVuZ2UgYW5kIHRyYWluIHdpdGggdGhlIGR1bmdlb24sCiAgICAgICAgLy8gdGhlIGZvcm11bGEgZm9yIHRoZSBjb250cmlidXRpb24gZmVlIGlzIGluIER1bmdlb25DaGFsbGVuZ2UgYW5kIER1bmdlb25UcmFpbmluZyBjb250cmFjdHMuCiAgICAgICAgLy8gQSBkdW5nZW9uJ3MgZGlmZmljdWx0eSBuZXZlciBjaGFuZ2UuCiAgICAgICAgdWludDE2IGRpZmZpY3VsdHk7CgogICAgICAgIC8vIFRoZSBjdXJyZW50IGZsb29yIG51bWJlciwgYSBkdW5nZW9uIGlzIGNvbnNpc3RzIG9mIGFuIHVtbGltaXRlZCBudW1iZXIgb2YgZmxvb3JzLAogICAgICAgIC8vIHdoZW4gdGhlcmUgaXMgaGVyb2VzIHN1Y2Nlc3NmdWxseSBjaGFsbGVuZ2VkIGEgZmxvb3IsIHRoZSBuZXh0IGZsb29yIHdpbGwgYmUKICAgICAgICAvLyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZC4gMzItYml0IHVuc2lnbmVkIGludGVnZXJzIGNhbiBoYXZlIDQgYmlsbGlvbiBmbG9vcnMuCiAgICAgICAgdWludDMyIGZsb29yTnVtYmVyOwoKICAgICAgICAvLyBUaGUgdGltZXN0YW1wIGZyb20gdGhlIGJsb2NrIHdoZW4gdGhlIGN1cnJlbnQgZmxvb3IgaXMgZ2VuZXJhdGVkLgogICAgICAgIHVpbnQzMiBmbG9vckNyZWF0aW9uVGltZTsKCiAgICAgICAgLy8gQ3VycmVudCBhY2N1bXVsYXRlZCByZXdhcmRzLCBzdWNjZXNzZnVsIGNoYWxsZW5nZXIgd2lsbCBnZXQgYSBsYXJnZSBwcm9wb3J0aW9uIG9mIGl0LgogICAgICAgIHVpbnQxMjggcmV3YXJkczsKCiAgICAgICAgLy8gVGhlIHNlZWQgZ2VuZXMgb2YgdGhlIGR1bmdlb24sIGl0IGlzIHVzZWQgYXMgdGhlIGJhc2UgZ2VuZSBmb3IgZmlyc3QgZmxvb3IsCiAgICAgICAgLy8gc29tZSBkdW5nZW9ucyBhcmUgcmFyZXIgYW5kIHNvbWUgYXJlIG1vcmUgY29tbW9uLCB0aGUgZXhhY3QgZGV0YWlscyBhcmUsCiAgICAgICAgLy8gb2YgY291cnNlLCB0b3Agc2VjcmV0IG9mIHRoZSBnYW1lIQogICAgICAgIC8vIEEgZHVuZ2VvbidzIHNlZWRHZW5lcyBuZXZlciBjaGFuZ2UuCiAgICAgICAgdWludCBzZWVkR2VuZXM7CgogICAgICAgIC8vIFRoZSBnZW5lcyBmb3IgY3VycmVudCBmbG9vciwgaXQgZW5jb2RlcyB0aGUgZGlmZmljdWx0eSBsZXZlbCBvZiB0aGUgY3VycmVudCBmbG9vci4KICAgICAgICAvLyBXZSBjb25zaWRlcmVkIHdoZXRoZXIgdG8gc3RvcmUgdGhlIGVudGlyZSBhcnJheSBvZiBnZW5lcyBmb3IgYWxsIGZsb29ycywgYnV0CiAgICAgICAgLy8gaW4gb3JkZXIgdG8gc2F2ZSBzb21lIHByZWNpb3VzIGdhcyB3ZSdyZSB3aWxsaW5nIHRvIHNhY3JpZmljZSBzb21lIGZ1bmN0aW9uYWxpdGllcyB3aXRoIHRoYXQuCiAgICAgICAgdWludCBmbG9vckdlbmVzOwoKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVGhlIG1haW4gSGVybyBzdHJ1Y3QuIEV2ZXJ5IGhlcm8gaW4gdGhlIGdhbWUgaXMgcmVwcmVzZW50ZWQgYnkgdGhpcyBzdHJ1Y3R1cmUuCiAgICAgKi8KICAgIHN0cnVjdCBIZXJvIHsKCiAgICAgICAgLy8gVGhlIHRpbWVzdGFtcCBmcm9tIHRoZSBibG9jayB3aGVuIHRoaXMgZHVuZ2VvbiBpcyBjcmVhdGVkLgogICAgICAgIHVpbnQ2NCBjcmVhdGlvblRpbWU7CgogICAgICAgIC8vIFRoZSBzZWVkIG9mIHRoZSBoZXJvLCB0aGUgZ2VuZSBlbmNvZGVzIHRoZSBwb3dlciBsZXZlbCBvZiB0aGUgaGVyby4KICAgICAgICAvLyBUaGlzIGlzIGFub3RoZXIgdG9wIHNlY3JldCBvZiB0aGUgZ2FtZSEgSGVybydzIGdlbmUgY2FuIGJlIHVwZ3JhZGVkIHZpYQogICAgICAgIC8vIHRyYWluaW5nIGluIGEgZHVuZ2Vvbi4KICAgICAgICB1aW50IGdlbmVzOwoKICAgIH0KCn0KCi8qKgogKiBAdGl0bGUgQSBzaW1wbGlmaWVkIGludGVyZmFjZSBvZiBFUkMtNzIxLCBidXQgd2l0aG91dCBhcHByb3ZhbCBmdW5jdGlvbnMKICovCmNvbnRyYWN0IEVSQzcyMSB7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHRva2VuSWQpOwoKICAgIC8vIEVSQzIwIGNvbXBhdGlibGUgZnVuY3Rpb25zCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyk7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKCiAgICAvLyBGdW5jdGlvbnMgdGhhdCBkZWZpbmUgb3duZXJzaGlwCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgZXh0ZXJuYWw7Cgp9CgovKioKICogQHRpdGxlIFRoZSBFUkMtNzIxIGNvbXBsaWFuY2UgdG9rZW4gY29udHJhY3QgZm9yIHRoZSBEdW5nZW9uIHRva2Vucy4KICogQGRldiBTZWUgdGhlIER1bmdlb25TdHJ1Y3RzIGNvbnRyYWN0IHRvIHNlZSB0aGUgZGV0YWlscyBvZiB0aGUgRHVuZ2VvbiB0b2tlbiBkYXRhIHN0cnVjdHVyZS4KICovCmNvbnRyYWN0IER1bmdlb25Ub2tlbiBpcyBFUkM3MjEsIER1bmdlb25TdHJ1Y3RzLCBQYXVzYWJsZSwgSm9pbnRPd25hYmxlIHsKCiAgICAvKioKICAgICAqIEBub3RpY2UgTGltaXRzIHRoZSBudW1iZXIgb2YgZHVuZ2VvbnMgdGhlIGNvbnRyYWN0IG93bmVyIGNhbiBldmVyIGNyZWF0ZS4KICAgICAqLwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRFVOR0VPTl9DUkVBVElPTl9MSU1JVCA9IDEwMjQ7CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBNaW50IGV2ZW50IGlzIGZpcmVkIHdoZW5ldmVyIGEgbmV3IGR1bmdlb24gaXMgY3JlYXRlZC4KICAgICAqLwogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIHVpbnQgbmV3VG9rZW5JZCwgdWludCBkaWZmaWN1bHR5LCB1aW50IHNlZWRHZW5lcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBOZXdEdW5nZW9uRmxvb3IgZXZlbnQgaXMgZmlyZWQgd2hlbmV2ZXIgYSBuZXcgZHVuZ2VvbiBmbG9vciBpcyBhZGRlZC4KICAgICAqLwogICAgZXZlbnQgTmV3RHVuZ2VvbkZsb29yKHVpbnQgdGltZXN0YW1wLCB1aW50IGluZGV4ZWQgZHVuZ2VvbklkLCB1aW50MzIgbmV3Rmxvb3JOdW1iZXIsIHVpbnQxMjggbmV3UmV3YXJkcyAsIHVpbnQgbmV3Rmxvb3JHZW5lcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVyIGV2ZW50IGFzIGRlZmluZWQgaW4gY3VycmVudCBkcmFmdCBvZiBFUkM3MjEuIEVtaXR0ZWQgZXZlcnkgdGltZSBhIHRva2VuCiAgICAgKiAgb3duZXJzaGlwIChEdW5nZW9uIE1hc3RlcikgaXMgYXNzaWduZWQsIGluY2x1ZGluZyB0b2tlbiBjcmVhdGlvbi4KICAgICAqLwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB0b2tlbklkKTsKCiAgICAvKioKICAgICAqIEBkZXYgTmFtZSBvZiB0b2tlbi4KICAgICAqLwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkR1bmdlb24iOwoKICAgIC8qKgogICAgICogQGRldiBTeW1ib2wgb2YgdG9rZW4uCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkRVTkciOwoKICAgIC8qKgogICAgICogQGRldiBBbiBhcnJheSBjb250YWluaW5nIHRoZSBEdW5nZW9uIHN0cnVjdCwgd2hpY2ggY29udGFpbnMgYWxsIHRoZSBkdW5nZW9ucyBpbiBleGlzdGFuY2UuCiAgICAgKiAgVGhlIElEIGZvciBlYWNoIGR1bmdlb24gaXMgdGhlIGluZGV4IG9mIHRoaXMgYXJyYXkuCiAgICAgKi8KICAgIER1bmdlb25bXSBwdWJsaWMgZHVuZ2VvbnM7CgogICAgLyoqCiAgICAgKiBAZGV2IEEgbWFwcGluZyBmcm9tIHRva2VuIElEcyB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlbS4KICAgICAqLwogICAgbWFwcGluZyh1aW50ID0+IGFkZHJlc3MpIHRva2VuSW5kZXhUb093bmVyOwoKICAgIC8qKgogICAgICogQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAgICAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIG93bmVyc2hpcFRva2VuQ291bnQ7CgogICAgLyoqCiAgICAgKiBFYWNoIG5vbi1mdW5naWJsZSB0b2tlbiBvd25lciBjYW4gb3duIG1vcmUgdGhhbiBvbmUgdG9rZW4gYXQgb25lIHRpbWUuCiAgICAgKiBCZWNhdXNlIGVhY2ggdG9rZW4gaXMgcmVmZXJlbmNlZCBieSBpdHMgdW5pcXVlIElELCBob3dldmVyLAogICAgICogaXQgY2FuIGdldCBkaWZmaWN1bHQgdG8ga2VlcCB0cmFjayBvZiB0aGUgaW5kaXZpZHVhbCB0b2tlbnMgdGhhdCBhIHVzZXIgbWF5IG93bi4KICAgICAqIFRvIGRvIHRoaXMsIHRoZSBjb250cmFjdCBrZWVwcyBhIHJlY29yZCBvZiB0aGUgSURzIG9mIGVhY2ggdG9rZW4gdGhhdCBlYWNoIHVzZXIgb3ducy4KICAgICAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnRbXSkgcHVibGljIG93bmVyVG9rZW5zOwoKICAgIC8qKgogICAgICogQG5vdGljZSBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBkdW5nZW9ucy5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBAbm90aWNlIFJldHVybnMgdGhlIG51bWJlciBvZiB0b2tlbnMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgICogQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQ2hlY2tzIGlmIGEgZ2l2ZW4gYWRkcmVzcyBpcyB0aGUgY3VycmVudCBvd25lciBvZiBhIHBhcnRpY3VsYXIgdG9rZW4uCiAgICAgKiBAcGFyYW0gX2NsYWltYW50IFRoZSBhZGRyZXNzIHdlIGFyZSB2YWxpZGF0aW5nIGFnYWluc3QuCiAgICAgKiBAcGFyYW0gX3Rva2VuSWQgVG9rZW4gSUQKICAgICAqLwogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiB0b2tlbkluZGV4VG9Pd25lcltfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBSZXR1cm5zIHRoZSBhZGRyZXNzIGN1cnJlbnRseSBhc3NpZ25lZCBvd25lcnNoaXAgb2YgYSBnaXZlbiB0b2tlbi4KICAgICAqLwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKHRva2VuSW5kZXhUb093bmVyW190b2tlbklkXSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgcmV0dXJuIHRva2VuSW5kZXhUb093bmVyW190b2tlbklkXTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQXNzaWducyBvd25lcnNoaXAgb2YgYSBzcGVjaWZpYyB0b2tlbiB0byBhbiBhZGRyZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIG93bmVyc2hpcFRva2VuQ291bnQuCiAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CgogICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcC4KICAgICAgICB0b2tlbkluZGV4VG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CgogICAgICAgIC8vIEFkZCB0aGUgX3Rva2VuSWQgdG8gb3duZXJUb2tlbnNbX3RvXQogICAgICAgIG93bmVyVG9rZW5zW190b10ucHVzaChfdG9rZW5JZCk7CgogICAgICAgIC8vIFdoZW4gY3JlYXRpbmcgbmV3IHRva2VuLCBfZnJvbSBpcyAweDAsIGJ1dCB3ZSBjYW4ndCBhY2NvdW50IHRoYXQgYWRkcmVzcy4KICAgICAgICBpZiAoX2Zyb20gIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W19mcm9tXS0tOwoKICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBfdG9rZW5JZCBmcm9tIG93bmVyVG9rZW5zW19mcm9tXQogICAgICAgICAgICB1aW50W10gc3RvcmFnZSBmcm9tVG9rZW5zID0gb3duZXJUb2tlbnNbX2Zyb21dOwogICAgICAgICAgICBib29sIGlGb3VuZCA9IGZhbHNlOwoKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgZnJvbVRva2Vucy5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpRm91bmQpIHsKICAgICAgICAgICAgICAgICAgICBmcm9tVG9rZW5zW2ldID0gZnJvbVRva2Vuc1tpICsgMV07CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZyb21Ub2tlbnNbaV0gPT0gX3Rva2VuSWQpIHsKICAgICAgICAgICAgICAgICAgICBpRm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBFbWl0IHRoZSBUcmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAbm90aWNlIEV4dGVybmFsIGZ1bmN0aW9uIHRvIHRyYW5zZmVycyBhIHRva2VuIHRvIGFub3RoZXIgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgICAqIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIHRyYW5zZmVyLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgd2hlbk5vdFBhdXNlZCBleHRlcm5hbCB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwoKICAgICAgICAvLyBZb3UgY2FuIG9ubHkgc2VuZCB5b3VyIG93biB0b2tlbi4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCwgY2xlYXIgcGVuZGluZyBhcHByb3ZhbHMsIGVtaXQgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgbmV3IGR1bmdlb24gYW5kIHN0b3JlcyBpdCwgb25seSBjb250cmFjdCBvd25lcnMKICAgICAqICBjYW4gY3JlYXRlIG5ldyB0b2tlbiwgYW5kIHdpbGwgYmUgcmVzdHJpY3RlZCBieSB0aGUgRFVOR0VPTl9DUkVBVElPTl9MSU1JVC4KICAgICAqICBXaWxsIGdlbmVyYXRlIGEgTWludCBldmVudCwgYSAgTmV3RHVuZ2VvbkZsb29yIGV2ZW50LCBhbmQgYSBUcmFuc2ZlciBldmVudC4KICAgICAqIEBwYXJhbSBfZGlmZmljdWx0eSBUaGUgZGlmZmljdWx0eSBvZiB0aGUgbmV3IGR1bmdlb24uCiAgICAgKiBAcGFyYW0gX3NlZWRHZW5lcyBUaGUgc2VlZCBnZW5lcyBvZiB0aGUgbmV3IGR1bmdlb24uCiAgICAgKiBAcmV0dXJuIFRoZSBkdW5nZW9uIElEIG9mIHRoZSBuZXcgZHVuZ2Vvbi4KICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlRHVuZ2Vvbih1aW50IF9kaWZmaWN1bHR5LCB1aW50IF9zZWVkR2VuZXMsIGFkZHJlc3MgX293bmVyKSBlaXRoZXJPd25lciBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gRW5zdXJlIHRoZSB0b3RhbCBzdXBwbHkgaXMgd2l0aGluIHRoZSBmaXhlZCBsaW1pdC4KICAgICAgICByZXF1aXJlKHRvdGFsU3VwcGx5KCkgPCBEVU5HRU9OX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgLy8gVVBEQVRFIFNUT1JBR0UKICAgICAgICAvLyBDcmVhdGUgYSBuZXcgZHVuZ2Vvbi4KICAgICAgICBkdW5nZW9ucy5wdXNoKER1bmdlb24odWludDMyKG5vdyksIDAsIHVpbnQxNihfZGlmZmljdWx0eSksIDAsIDAsIDAsIF9zZWVkR2VuZXMsIDApKTsKCiAgICAgICAgLy8gVG9rZW4gaWQgaXMgdGhlIGluZGV4IGluIHRoZSBzdG9yYWdlIGFycmF5LgogICAgICAgIHVpbnQgbmV3VG9rZW5JZCA9IGR1bmdlb25zLmxlbmd0aCAtIDE7CgogICAgICAgIC8vIEVtaXQgdGhlIHRva2VuIG1pbnQgZXZlbnQuCiAgICAgICAgTWludChfb3duZXIsIG5ld1Rva2VuSWQsIF9kaWZmaWN1bHR5LCBfc2VlZEdlbmVzKTsKCiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgZmlzdCBmbG9vciB3aXRoIHVzaW5nIHRoZSBzZWVkR2VuZXMsIHRoaXMgd2lsbCBlbWl0IHRoZSBOZXdEdW5nZW9uRmxvb3IgZXZlbnQuCiAgICAgICAgYWRkRHVuZ2Vvbk5ld0Zsb29yKG5ld1Rva2VuSWQsIDAsIF9zZWVkR2VuZXMpOwoKICAgICAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcCwgYW5kIGFsc28gZW1pdCB0aGUgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgX3RyYW5zZmVyKDAsIF9vd25lciwgbmV3VG9rZW5JZCk7CgogICAgICAgIHJldHVybiBuZXdUb2tlbklkOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gc2V0IGR1bmdlb24gc3RhdHVzIGJ5IGl0cyBJRCwKICAgICAqICByZWZlciB0byBEdW5nZW9uU3RydWN0cyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBhYm91dCBkdW5nZW9uIHN0YXR1cy4KICAgICAqICBPbmx5IGNvbnRyYWN0IG93bmVycyBjYW4gYWx0ZXIgZHVuZ2VvbiBzdGF0ZS4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0RHVuZ2VvblN0YXR1cyh1aW50IF9pZCwgdWludCBfbmV3U3RhdHVzKSBlaXRoZXJPd25lciBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfaWQgPCB0b3RhbFN1cHBseSgpKTsKCiAgICAgICAgZHVuZ2VvbnNbX2lkXS5zdGF0dXMgPSB1aW50MTYoX25ld1N0YXR1cyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBleHRlcm5hbCBmdW5jdGlvbiB0byBhZGQgYWRkaXRpb25hbCBkdW5nZW9uIHJld2FyZHMgYnkgaXRzIElELAogICAgICogIG9ubHkgY29udHJhY3Qgb3duZXJzIGNhbiBhbHRlciBkdW5nZW9uIHN0YXRlLgogICAgICovCiAgICBmdW5jdGlvbiBhZGREdW5nZW9uUmV3YXJkcyh1aW50IF9pZCwgdWludCBfYWRkaXRpbmFsUmV3YXJkcykgZWl0aGVyT3duZXIgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoX2lkIDwgdG90YWxTdXBwbHkoKSk7CgogICAgICAgIGR1bmdlb25zW19pZF0ucmV3YXJkcyArPSB1aW50NjQoX2FkZGl0aW5hbFJld2FyZHMpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gYWRkIGFub3RoZXIgZHVuZ2VvbiBmbG9vciBieSBpdHMgSUQsCiAgICAgKiAgb25seSBjb250cmFjdCBvd25lcnMgY2FuIGFsdGVyIGR1bmdlb24gc3RhdGUuCiAgICAgKiAgV2lsbCBnZW5lcmF0ZSBib3RoIGEgTmV3RHVuZ2VvbkZsb29yIGV2ZW50LgogICAgICovCiAgICBmdW5jdGlvbiBhZGREdW5nZW9uTmV3Rmxvb3IodWludCBfaWQsIHVpbnQgX25ld1Jld2FyZHMsIHVpbnQgX25ld0Zsb29yR2VuZXMpIGVpdGhlck93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfaWQgPCB0b3RhbFN1cHBseSgpKTsKCiAgICAgICAgRHVuZ2VvbiBzdG9yYWdlIGR1bmdlb24gPSBkdW5nZW9uc1tfaWRdOwoKICAgICAgICBkdW5nZW9uLmZsb29yTnVtYmVyKys7CiAgICAgICAgZHVuZ2Vvbi5mbG9vckNyZWF0aW9uVGltZSA9IHVpbnQzMihub3cpOwogICAgICAgIGR1bmdlb24ucmV3YXJkcyA9IHVpbnQxMjgoX25ld1Jld2FyZHMpOwogICAgICAgIGR1bmdlb24uZmxvb3JHZW5lcyA9IF9uZXdGbG9vckdlbmVzOwoKICAgICAgICAvLyBFbWl0IHRoZSBOZXdEdW5nZW9uRmxvb3IgZXZlbnQuCiAgICAgICAgTmV3RHVuZ2VvbkZsb29yKG5vdywgX2lkLCBkdW5nZW9uLmZsb29yTnVtYmVyLCBkdW5nZW9uLnJld2FyZHMsIGR1bmdlb24uZmxvb3JHZW5lcyk7CiAgICB9Cgp9CgovKioKICogQHRpdGxlIFRoZSBFUkMtNzIxIGNvbXBsaWFuY2UgdG9rZW4gY29udHJhY3QgZm9yIHRoZSBIZXJvIHRva2Vucy4KICogQGRldiBTZWUgdGhlIER1bmdlb25TdHJ1Y3RzIGNvbnRyYWN0IHRvIHNlZSB0aGUgZGV0YWlscyBvZiB0aGUgSGVybyB0b2tlbiBkYXRhIHN0cnVjdHVyZS4KICovCmNvbnRyYWN0IEhlcm9Ub2tlbiBpcyBFUkM3MjEsIER1bmdlb25TdHJ1Y3RzLCBQYXVzYWJsZSwgSm9pbnRPd25hYmxlIHsKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIE1pbnQgZXZlbnQgaXMgZmlyZWQgd2hlbmV2ZXIgYSBuZXcgaGVybyBpcyBjcmVhdGVkLgogICAgICovCiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCBvd25lciwgdWludCBuZXdUb2tlbklkLCB1aW50IF9nZW5lcyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVyIGV2ZW50IGFzIGRlZmluZWQgaW4gY3VycmVudCBkcmFmdCBvZiBFUkM3MjEuIEVtaXR0ZWQgZXZlcnkgdGltZSBhIHRva2VuCiAgICAgKiAgb3duZXJzaGlwIGlzIGFzc2lnbmVkLCBpbmNsdWRpbmcgdG9rZW4gY3JlYXRpb24uCiAgICAgKi8KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdG9rZW5JZCk7CgogICAgLyoqCiAgICAgKiBAZGV2IE5hbWUgb2YgdG9rZW4uCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJIZXJvIjsKCiAgICAvKioKICAgICAqIEBkZXYgU3ltYm9sIG9mIHRva2VuLgogICAgICovCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJIRVJPIjsKCiAgICAvKioKICAgICAqIEBkZXYgQW4gYXJyYXkgY29udGFpbmluZyB0aGUgSGVybyBzdHJ1Y3QsIHdoaWNoIGNvbnRhaW5zIGFsbCB0aGUgaGVyb2VzIGluIGV4aXN0YW5jZS4KICAgICAqICBUaGUgSUQgZm9yIGVhY2ggaGVybyBpcyB0aGUgaW5kZXggb2YgdGhpcyBhcnJheS4KICAgICAqLwogICAgSGVyb1tdIHB1YmxpYyBoZXJvZXM7CgogICAgLyoqCiAgICAgKiBAZGV2IEEgbWFwcGluZyBmcm9tIHRva2VuIElEcyB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlbS4KICAgICAqLwogICAgbWFwcGluZyh1aW50ID0+IGFkZHJlc3MpIHRva2VuSW5kZXhUb093bmVyOwoKICAgIC8qKgogICAgICogQGRldiBBIG1hcHBpbmcgZnJvbSBvd25lciBhZGRyZXNzIHRvIGNvdW50IG9mIHRva2VucyB0aGF0IGFkZHJlc3Mgb3ducy4KICAgICAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIG93bmVyc2hpcFRva2VuQ291bnQ7CgogICAgLyoqCiAgICAgKiBFYWNoIG5vbi1mdW5naWJsZSB0b2tlbiBvd25lciBjYW4gb3duIG1vcmUgdGhhbiBvbmUgdG9rZW4gYXQgb25lIHRpbWUuCiAgICAgKiBCZWNhdXNlIGVhY2ggdG9rZW4gaXMgcmVmZXJlbmNlZCBieSBpdHMgdW5pcXVlIElELCBob3dldmVyLAogICAgICogaXQgY2FuIGdldCBkaWZmaWN1bHQgdG8ga2VlcCB0cmFjayBvZiB0aGUgaW5kaXZpZHVhbCB0b2tlbnMgdGhhdCBhIHVzZXIgbWF5IG93bi4KICAgICAqIFRvIGRvIHRoaXMsIHRoZSBjb250cmFjdCBrZWVwcyBhIHJlY29yZCBvZiB0aGUgSURzIG9mIGVhY2ggdG9rZW4gdGhhdCBlYWNoIHVzZXIgb3ducy4KICAgICAqLwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnRbXSkgcHVibGljIG93bmVyVG9rZW5zOwoKICAgIC8qKgogICAgICogQG5vdGljZSBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBoZXJvZXMubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdG9rZW5zIG93bmVkIGJ5IGEgc3BlY2lmaWMgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBvd25lcnNoaXBUb2tlbkNvdW50W19vd25lcl07CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgaXMgdGhlIGN1cnJlbnQgb3duZXIgb2YgYSBwYXJ0aWN1bGFyIHRva2VuLgogICAgICogQHBhcmFtIF9jbGFpbWFudCBUaGUgYWRkcmVzcyB3ZSBhcmUgdmFsaWRhdGluZyBhZ2FpbnN0LgogICAgICogQHBhcmFtIF90b2tlbklkIFRva2VuIElECiAgICAgKi8KICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdG9rZW5JbmRleFRvT3duZXJbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvKioKICAgICAqIEBub3RpY2UgUmV0dXJucyB0aGUgYWRkcmVzcyBjdXJyZW50bHkgYXNzaWduZWQgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gdG9rZW4uCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyT2YodWludCBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZSh0b2tlbkluZGV4VG9Pd25lcltfdG9rZW5JZF0gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHJldHVybiB0b2tlbkluZGV4VG9Pd25lcltfdG9rZW5JZF07CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgdG9rZW4gdG8gYW4gYWRkcmVzcy4KICAgICAqLwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBvd25lcnNoaXBUb2tlbkNvdW50LgogICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX3RvXSsrOwoKICAgICAgICAvLyBUcmFuc2ZlciBvd25lcnNoaXAuCiAgICAgICAgdG9rZW5JbmRleFRvT3duZXJbX3Rva2VuSWRdID0gX3RvOwoKICAgICAgICAvLyBBZGQgdGhlIF90b2tlbklkIHRvIG93bmVyVG9rZW5zW190b10KICAgICAgICBvd25lclRva2Vuc1tfdG9dLnB1c2goX3Rva2VuSWQpOwoKICAgICAgICAvLyBXaGVuIGNyZWF0aW5nIG5ldyB0b2tlbiwgX2Zyb20gaXMgMHgwLCBidXQgd2UgY2FuJ3QgYWNjb3VudCB0aGF0IGFkZHJlc3MuCiAgICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfZnJvbV0tLTsKCiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgX3Rva2VuSWQgZnJvbSBvd25lclRva2Vuc1tfZnJvbV0KICAgICAgICAgICAgdWludFtdIHN0b3JhZ2UgZnJvbVRva2VucyA9IG93bmVyVG9rZW5zW19mcm9tXTsKICAgICAgICAgICAgYm9vbCBpRm91bmQgPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGZyb21Ub2tlbnMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaUZvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgZnJvbVRva2Vuc1tpXSA9IGZyb21Ub2tlbnNbaSArIDFdOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmcm9tVG9rZW5zW2ldID09IF90b2tlbklkKSB7CiAgICAgICAgICAgICAgICAgICAgaUZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gRW1pdCB0aGUgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBFeHRlcm5hbCBmdW5jdGlvbiB0byB0cmFuc2ZlcnMgYSB0b2tlbiB0byBhbm90aGVyIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAgKiBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSB0b2tlbiB0byB0cmFuc2Zlci4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3Rva2VuSWQpIHdoZW5Ob3RQYXVzZWQgZXh0ZXJuYWwgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKCiAgICAgICAgLy8gWW91IGNhbiBvbmx5IHNlbmQgeW91ciBvd24gdG9rZW4uCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAsIGNsZWFyIHBlbmRpbmcgYXBwcm92YWxzLCBlbWl0IFRyYW5zZmVyIGV2ZW50LgogICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQW4gZXh0ZXJuYWwgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgbmV3IGhlcm8gYW5kIHN0b3JlcyBpdCwKICAgICAqICBvbmx5IGNvbnRyYWN0IG93bmVycyBjYW4gY3JlYXRlIG5ldyB0b2tlbi4KICAgICAqICBtZXRob2QgZG9lc24ndCBkbyBhbnkgY2hlY2tpbmcgYW5kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuIHRoZQogICAgICogIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuCiAgICAgKiBAcGFyYW0gX2dlbmVzIFRoZSBnZW5lIG9mIHRoZSBuZXcgaGVyby4KICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGluaXRhbCBvd25lciBvZiB0aGlzIGhlcm8uCiAgICAgKiBAcmV0dXJuIFRoZSBoZXJvIElEIG9mIHRoZSBuZXcgaGVyby4KICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlSGVybyh1aW50IF9nZW5lcywgYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAvLyBVUERBVEUgU1RPUkFHRQogICAgICAgIC8vIENyZWF0ZSBhIG5ldyBoZXJvLgogICAgICAgIGhlcm9lcy5wdXNoKEhlcm8odWludDY0KG5vdyksIF9nZW5lcykpOwoKICAgICAgICAvLyBUb2tlbiBpZCBpcyB0aGUgaW5kZXggaW4gdGhlIHN0b3JhZ2UgYXJyYXkuCiAgICAgICAgdWludCBuZXdUb2tlbklkID0gaGVyb2VzLmxlbmd0aCAtIDE7CgogICAgICAgIC8vIEVtaXQgdGhlIHRva2VuIG1pbnQgZXZlbnQuCiAgICAgICAgTWludChfb3duZXIsIG5ld1Rva2VuSWQsIF9nZW5lcyk7CgogICAgICAgIC8vIFRoaXMgd2lsbCBhc3NpZ24gb3duZXJzaGlwLCBhbmQgYWxzbyBlbWl0IHRoZSBUcmFuc2ZlciBldmVudC4KICAgICAgICBfdHJhbnNmZXIoMCwgX293bmVyLCBuZXdUb2tlbklkKTsKCiAgICAgICAgcmV0dXJuIG5ld1Rva2VuSWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBleHRlcm5hbCBmdW5jdGlvbiB0byBzZXQgdGhlIGhlcm8gZ2VuZXMgYnkgaXRzIElELAogICAgICogIG9ubHkgY29udHJhY3Qgb3duZXJzIGNhbiBhbHRlciBoZXJvIHN0YXRlLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRIZXJvR2VuZXModWludCBfaWQsIHVpbnQgX25ld0dlbmVzKSBlaXRoZXJPd25lciBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShfaWQgPCB0b3RhbFN1cHBseSgpKTsKCiAgICAgICAgSGVybyBzdG9yYWdlIGhlcm8gPSBoZXJvZXNbX2lkXTsKCiAgICAgICAgaGVyby5nZW5lcyA9IF9uZXdHZW5lczsKICAgIH0KCn0KCi8qKgogKiBTRUNSRVQKICovCmNvbnRyYWN0IENoYWxsZW5nZVNjaWVuY2VJbnRlcmZhY2UgewoKICAgIC8qKgogICAgICogQGRldiBnaXZlbiBnZW5lcyBvZiBjdXJyZW50IGZsb29yIGFuZCBkdW5nZW9uIHNlZWQsIHJldHVybiBhIGdlbmV0aWMgY29tYmluYXRpb24gLSBtYXkgaGF2ZSBhIHJhbmRvbSBmYWN0b3IKICAgICAqIEBwYXJhbSBfZmxvb3JHZW5lcyBnZW5lcyBvZiBmbG9vcgogICAgICogQHBhcmFtIF9zZWVkR2VuZXMgc2VlZCBnZW5lcyBvZiBkdW5nZW9uCiAgICAgKiBAcmV0dXJuIHRoZSByZXN1bHRpbmcgZ2VuZXMKICAgICAqLwogICAgZnVuY3Rpb24gbWl4R2VuZXModWludCBfZmxvb3JHZW5lcywgdWludCBfc2VlZEdlbmVzKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpOwoKfQoKLyoqCiAqIFNFQ1JFVAogKi8KY29udHJhY3QgVHJhaW5pbmdTY2llbmNlSW50ZXJmYWNlIHsKCiAgICAvKioKICAgICAqIEBkZXYgZ2l2ZW4gZ2VuZXMgb2YgaGVybyBhbmQgY3VycmVudCBmbG9vciwgcmV0dXJuIGEgZ2VuZXRpYyBjb21iaW5hdGlvbiAtIG1heSBoYXZlIGEgcmFuZG9tIGZhY3RvcgogICAgICogQHBhcmFtIF9oZXJvR2VuZXMgZ2VuZXMgb2YgaGVybwogICAgICogQHBhcmFtIF9mbG9vckdlbmVzIGdlbmVzIG9mIGN1cnJlbnQgZmxvb3IKICAgICAqIEByZXR1cm4gdGhlIHJlc3VsdGluZyBnZW5lcwogICAgICovCiAgICBmdW5jdGlvbiBtaXhHZW5lcyh1aW50IF9oZXJvR2VuZXMsIHVpbnQgX2Zsb29yR2VuZXMpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAodWludCk7Cgp9CgovKioKICogQHRpdGxlIER1bmdlb25CYXNlCiAqIEBkZXYgQmFzZSBjb250cmFjdCBmb3IgRXRoZXIgRHVuZ2Vvbi4gSXQgaW1wbGVtZW50cyBhbGwgbmVjZXNzYXJ5IHN1Yi1jbGFzc2VzLAogKiBob2xkcyBhbGwgdGhlIGJhc2Ugc3RvcmFnZSB2YXJpYWJsZXMsIGFuZCBzb21lIGNvbW1vbmx5IHVzZWQgZnVuY3Rpb25zLgogKi8KY29udHJhY3QgRHVuZ2VvbkJhc2UgaXMgRWplY3RhYmxlT3duYWJsZSwgUGF1c2FibGUsIFB1bGxQYXltZW50LCBEdW5nZW9uU3RydWN0cyB7CgogICAgLyogPT09PT09PT0gVE9LRU4gQ09OVFJBQ1RTID09PT09PT09ICovCgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBhZGRyZXNzIG9mIHRoZSBFUkM3MjEgdG9rZW4gY29udHJhY3QgbWFuYWdpbmcgYWxsIER1bmdlb24gdG9rZW5zLgogICAgICovCiAgICBEdW5nZW9uVG9rZW4gcHVibGljIGR1bmdlb25Ub2tlbkNvbnRyYWN0OwoKICAgIC8qKgogICAgICogQGRldiBUaGUgYWRkcmVzcyBvZiB0aGUgRVJDNzIxIHRva2VuIGNvbnRyYWN0IG1hbmFnaW5nIGFsbCBIZXJvIHRva2Vucy4KICAgICAqLwogICAgSGVyb1Rva2VuIHB1YmxpYyBoZXJvVG9rZW5Db250cmFjdDsKCgogICAgLyogPT09PT09PT0gQ0xPU0VEIFNPVVJDRSBDT05UUkFDVFMgPT09PT09PT0gKi8KCiAgICAvKioKICAgICAqIEBkZXYgVGhlIGFkZHJlc3Mgb2YgdGhlIENoYWxsZW5nZVNjaWVuY2UgY29udHJhY3QgdGhhdCBoYW5kbGVzIHRoZSBmbG9vciBnZW5lcmF0aW9uIG1lY2hhbmljcyBhZnRlciBjaGFsbGVuZ2Ugc3VjY2Vzcy4KICAgICAqLwogICAgQ2hhbGxlbmdlU2NpZW5jZUludGVyZmFjZSBjaGFsbGVuZ2VTY2llbmNlQ29udHJhY3Q7CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBhZGRyZXNzIG9mIHRoZSBUcmFpbmluZ1NjaWVuY2UgY29udHJhY3QgdGhhdCBoYW5kbGVzIHRoZSBoZXJvIHRyYWluaW5nIG1lY2hhbmljcy4KICAgICAqLwogICAgVHJhaW5pbmdTY2llbmNlSW50ZXJmYWNlIHRyYWluaW5nU2NpZW5jZUNvbnRyYWN0OwoKCiAgICAvKiA9PT09PT09PSBTRVRURVIgRlVOQ1RJT05TID09PT09PT09ICovCgogICAgLyoqCiAgICAgKiBAZGV2IFNldCB0aGUgYWRkcmVzcyBvZiB0aGUgZHVuZ2VvbiB0b2tlbiBjb250cmFjdC4KICAgICAqIEBwYXJhbSBfbmV3RHVuZ2VvblRva2VuQ29udHJhY3QgQW4gYWRkcmVzcyBvZiBhIER1bmdlb25Ub2tlbiBjb250cmFjdC4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0RHVuZ2VvblRva2VuQ29udHJhY3QoYWRkcmVzcyBfbmV3RHVuZ2VvblRva2VuQ29udHJhY3QpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgZHVuZ2VvblRva2VuQ29udHJhY3QgPSBEdW5nZW9uVG9rZW4oX25ld0R1bmdlb25Ub2tlbkNvbnRyYWN0KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0IHRoZSBhZGRyZXNzIG9mIHRoZSBoZXJvIHRva2VuIGNvbnRyYWN0LgogICAgICogQHBhcmFtIF9uZXdIZXJvVG9rZW5Db250cmFjdCBBbiBhZGRyZXNzIG9mIGEgSGVyb1Rva2VuIGNvbnRyYWN0LgogICAgICovCiAgICBmdW5jdGlvbiBzZXRIZXJvVG9rZW5Db250cmFjdChhZGRyZXNzIF9uZXdIZXJvVG9rZW5Db250cmFjdCkgb25seU93bmVyIGV4dGVybmFsIHsKICAgICAgICBoZXJvVG9rZW5Db250cmFjdCA9IEhlcm9Ub2tlbihfbmV3SGVyb1Rva2VuQ29udHJhY3QpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIHNlY3JldCBkdW5nZW9uIGNoYWxsZW5nZSBmb3JtdWxhIGNvbnRyYWN0LgogICAgICogQHBhcmFtIF9uZXdDaGFsbGVuZ2VTY2llbmNlQWRkcmVzcyBBbiBhZGRyZXNzIG9mIGEgQ2hhbGxlbmdlU2NpZW5jZSBjb250cmFjdC4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0Q2hhbGxlbmdlU2NpZW5jZUNvbnRyYWN0KGFkZHJlc3MgX25ld0NoYWxsZW5nZVNjaWVuY2VBZGRyZXNzKSBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIGNoYWxsZW5nZVNjaWVuY2VDb250cmFjdCA9IENoYWxsZW5nZVNjaWVuY2VJbnRlcmZhY2UoX25ld0NoYWxsZW5nZVNjaWVuY2VBZGRyZXNzKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU2V0IHRoZSBhZGRyZXNzIG9mIHRoZSBzZWNyZXQgaGVybyB0cmFpbmluZyBmb3JtdWxhIGNvbnRyYWN0LgogICAgICogQHBhcmFtIF9uZXdUcmFpbmluZ1NjaWVuY2VBZGRyZXNzIEFuIGFkZHJlc3Mgb2YgYSBUcmFpbmluZ1NjaWVuY2UgY29udHJhY3QuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFRyYWluaW5nU2NpZW5jZUNvbnRyYWN0KGFkZHJlc3MgX25ld1RyYWluaW5nU2NpZW5jZUFkZHJlc3MpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgdHJhaW5pbmdTY2llbmNlQ29udHJhY3QgPSBUcmFpbmluZ1NjaWVuY2VJbnRlcmZhY2UoX25ld1RyYWluaW5nU2NpZW5jZUFkZHJlc3MpOwogICAgfQoKCiAgICAvKiA9PT09PT09PSBNT0RJRklFUlMgPT09PT09PT0gKi8KICAgIC8qKgogICAgICogQGRldiBUaHJvd3MgaWYgX2R1bmdlb25JZCBpcyBub3QgY3JlYXRlZCB5ZXQuCiAgICAgKi8KICAgIG1vZGlmaWVyIGR1bmdlb25FeGlzdHModWludCBfZHVuZ2VvbklkKSB7CiAgICAgICAgcmVxdWlyZShfZHVuZ2VvbklkIDwgZHVuZ2VvblRva2VuQ29udHJhY3QudG90YWxTdXBwbHkoKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIGR1bmdlb24gc3RhdHVzIGRvIG5vdCBhbGxvdyBjaGFsbGVuZ2UsIGFsc28gY2hlY2sgZm9yIGR1bmdlb24gZXhpc3RlbmNlLgogICAgICovCiAgICBtb2RpZmllciBjYW5DaGFsbGVuZ2UodWludCBfZHVuZ2VvbklkKSB7CiAgICAgICAgcmVxdWlyZShfZHVuZ2VvbklkIDwgZHVuZ2VvblRva2VuQ29udHJhY3QudG90YWxTdXBwbHkoKSk7CiAgICAgICAgdWludCBzdGF0dXM7CiAgICAgICAgKCxzdGF0dXMsLCwsLCwpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2R1bmdlb25JZCk7CiAgICAgICAgcmVxdWlyZShzdGF0dXMgPT0gMCB8fCBzdGF0dXMgPT0gMSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIGR1bmdlb24gc3RhdHVzIGRvIG5vdCBhbGxvdyB0cmFpbmluZywgYWxzbyBjaGVjayBmb3IgZHVuZ2VvbiBleGlzdGVuY2UuCiAgICAgKi8KICAgIG1vZGlmaWVyIGNhblRyYWluKHVpbnQgX2R1bmdlb25JZCkgewogICAgICAgIHJlcXVpcmUoX2R1bmdlb25JZCA8IGR1bmdlb25Ub2tlbkNvbnRyYWN0LnRvdGFsU3VwcGx5KCkpOwogICAgICAgIHVpbnQgc3RhdHVzOwogICAgICAgICgsc3RhdHVzLCwsLCwsKSA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0LmR1bmdlb25zKF9kdW5nZW9uSWQpOwogICAgICAgIHJlcXVpcmUoc3RhdHVzID09IDAgfHwgc3RhdHVzID09IDIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8qID09PT09PT09IEhFTFBFUiBGVU5DVElPTlMgPT09PT09PT0gKi8KCiAgICAvKioKICAgICAqIEBkZXYgQW4gaW50ZXJuYWwgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIHRoZSBwb3dlciBvZiBwbGF5ZXIsIG9yIGRpZmZpY3VsdHkgb2YgYSBkdW5nZW9uIGZsb29yLAogICAgICogIGlmIHRoZSB0b3RhbCBoZXJvZXMgcG93ZXIgaXMgbGFyZ2VyIHRoYW4gdGhlIGN1cnJlbnQgZHVuZ2VvbiBmbG9vciBkaWZmaWN1bHR5LCB0aGUgaGVyb2VzIHdpbiB0aGUgY2hhbGxlbmdlLgogICAgICovCiAgICBmdW5jdGlvbiBfZ2V0R2VuZXNQb3dlcih1aW50IF9nZW5lcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHN0YXRzIHBvd2VyLgogICAgICAgIHVpbnQgc3RhdHNQb3dlcjsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAgIHN0YXRzUG93ZXIgKz0gX2dlbmVzICUgMzI7CiAgICAgICAgICAgIF9nZW5lcyAvPSAzMiAqKiA0OwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHN0YXRzIHBvd2VyLgogICAgICAgIHVpbnQgZXF1aXBtZW50UG93ZXI7CiAgICAgICAgYm9vbCBpc1N1cGVyID0gdHJ1ZTsKCiAgICAgICAgZm9yICh1aW50IGogPSA0OyBqIDwgMTI7IGorKykgewogICAgICAgICAgICB1aW50IGN1ckdlbmUgPSBfZ2VuZXMgJSAzMjsKICAgICAgICAgICAgZXF1aXBtZW50UG93ZXIgKz0gY3VyR2VuZTsKICAgICAgICAgICAgX2dlbmVzIC89IDMyICoqIDQ7CgogICAgICAgICAgICBpZiAoZXF1aXBtZW50UG93ZXIgIT0gY3VyR2VuZSAqIChqIC0gMykpIHsKICAgICAgICAgICAgICAgIGlzU3VwZXIgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIHN1cGVyIHBvd2VyLgogICAgICAgIGlmIChpc1N1cGVyKSB7CiAgICAgICAgICAgIGVxdWlwbWVudFBvd2VyICo9IDI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3RhdHNQb3dlciArIGVxdWlwbWVudFBvd2VyICsgMTI7CiAgICB9Cgp9Cgpjb250cmFjdCBEdW5nZW9uQ2hhbGxlbmdlIGlzIER1bmdlb25CYXNlIHsKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIER1bmdlb25DaGFsbGVuZ2VkIGV2ZW50IGlzIGZpcmVkIHdoZW4gdXNlciBmaW5pc2hlZCBhIGR1bmdlb24gY2hhbGxlbmdlLgogICAgICovCiAgICBldmVudCBEdW5nZW9uQ2hhbGxlbmdlZCh1aW50IHRpbWVzdGFtcCwgYWRkcmVzcyBpbmRleGVkIHBsYXllckFkZHJlc3MsIHVpbnQgaW5kZXhlZCBkdW5nZW9uSWQsIHVpbnQgaGVyb0dlbmVzLCB1aW50IGZsb29yTnVtYmVyLCB1aW50IGZsb29yR2VuZXMsIGJvb2wgc3VjY2VzcywgdWludCBuZXdGbG9vckdlbmVzLCB1aW50IHN1Y2Nlc3NSZXdhcmRzLCB1aW50IG1hc3RlclJld2FyZHMpOwoKICAgIC8qKgogICAgICogQG5vdGljZSBUaGUgYWN0dWFsIGZlZSBjb250cmlidXRpb24gcmVxdWlyZWQgdG8gY2FsbCBjaGFsbGVuZ2UoKSBpcyBjYWxjdWxhdGVkIGJ5IHRoaXMgZmVlTXVsdGlwbGllciwKICAgICAqICB0aW1lcyB0aGUgZHVuZ2VvbiBkaWZmaWN1bHR5LiBUaGUgcGF5bWVudCBpcyBhY2N1bXVsYXRlZCB0byB0aGUgZHVuZ2VvbiByZXdhcmRzLAogICAgICogIGFuZCBhIGxhcmdlIHByb3BvcnRpb24gd2lsbCBiZSBjbGFpbWVkIGJ5IHdob2V2ZXIgc3VjY2Vzc2Z1bGx5IGNoYWxsZW5nZWQgdGhlIGZsb29yLgogICAgICogIDEgZmlubmV5ID0gMC4wMDEgZXRoZXIKICAgICAqLwogICAgdWludDI1NiBwdWJsaWMgY2hhbGxlbmdlRmVlTXVsdGlwbGllciA9IDEgZmlubmV5OwoKICAgIC8qKgogICAgICogQGRldiBUaGUgcGVyY2VudGFnZSBmb3Igd2hpY2ggc3VjY2Vzc2Z1bCBjaGFsbGVuZ2VyIGJlIHJld2FyZGVkIG9mIHRoZSBkdW5nZW9ucycgYWNjdW11bGF0ZWQgcmV3YXJkcy4KICAgICAqICBUaGUgcmVtYWluaW5nIHJld2FyZHMgc3VidHJhY3RlZCBieSBkZXZlbG9wZXIgZmVlIHdpbGwgYmUgdXNlZCBhcyB0aGUgYmFzZSByZXdhcmRzIGZvciBuZXcgZmxvb3IuCiAgICAgKi8KICAgIHVpbnQgcHVibGljIGNoYWxsZW5nZVJld2FyZHNQZXJjZW50ID0gNjQ7CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBkZXZlbG9wZXIgZmVlIGZvciBvd25lcgogICAgICogIE5vdGUgdGhhdCB3aGVuIEV0aGVyIER1bmdlb24gYmVjb21lcyB0cnVseSBkZWNlbnRyYWxpc2VkLCBjb250cmFjdCBvd25lcnNoaXAgd2lsbCBiZSBlamVjdGVkLAogICAgICogIGFuZCB0aGUgbWFzdGVyIHJld2FyZHMgd2lsbCBiZSByZXdhcmRlZCB0byB0aGUgZHVuZ2VvbiBvd25lciAoRHVuZ2VvbiBNYXN0ZXJzKS4KICAgICAqLwogICAgdWludCBwdWJsaWMgbWFzdGVyUmV3YXJkc1BlcmNlbnQgPSA4OwoKICAgIC8qKgogICAgICogQGRldiBUaGUgbWFpbiBwdWJsaWMgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIGEgcGxheWVyIGNoYWxsZW5nZSBhIGR1bmdlb24sCiAgICAgKiAgaXQgZGV0ZXJtaW5lcyB3aGV0aGVyIGlmIHRoZSBwbGF5ZXIgc3VjY2Vzc2Z1bGx5IGNoYWxsZW5nZWQgdGhlIGN1cnJlbnQgZmxvb3IuCiAgICAgKiAgV2lsbCBnZW5lcmF0ZSBhIER1bmdlb25DaGFsbGVuZ2VkIGV2ZW50LgogICAgICovCiAgICBmdW5jdGlvbiBjaGFsbGVuZ2UodWludCBfZHVuZ2VvbklkKSBleHRlcm5hbCBwYXlhYmxlIHdoZW5Ob3RQYXVzZWQgY2FuQ2hhbGxlbmdlKF9kdW5nZW9uSWQpIHsKICAgICAgICAvLyBHZXQgdGhlIGR1bmdlb24gZGV0YWlscyBmcm9tIHRoZSB0b2tlbiBjb250cmFjdC4KICAgICAgICB1aW50IGRpZmZpY3VsdHk7CiAgICAgICAgdWludCBzZWVkR2VuZXM7CiAgICAgICAgKCwsZGlmZmljdWx0eSwsLCxzZWVkR2VuZXMsKSA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0LmR1bmdlb25zKF9kdW5nZW9uSWQpOwoKICAgICAgICAvLyBDaGVja3MgZm9yIHBheW1lbnQsIGFueSBleGNlZWRpbmcgZnVuZHMgd2lsbCBiZSB0cmFuc2ZlcnJlZCBiYWNrIHRvIHRoZSBwbGF5ZXIuCiAgICAgICAgdWludCByZXF1aXJlZEZlZSA9IGRpZmZpY3VsdHkgKiBjaGFsbGVuZ2VGZWVNdWx0aXBsaWVyOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHJlcXVpcmVkRmVlKTsKCiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGFjY3VtdWxhdGVkIHJld2FyZHMgZm9yIHRoZSBkdW5nZW9uLgogICAgICAgIGR1bmdlb25Ub2tlbkNvbnRyYWN0LmFkZER1bmdlb25SZXdhcmRzKF9kdW5nZW9uSWQsIHJlcXVpcmVkRmVlKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgYW5kIG1ha2UgaXQgYXZhaWxhYmxlIHRvIGJlIHdpdGhkcmF3ZWQgYnkgdGhlIHBsYXllci4KICAgICAgICBhc3luY1NlbmQobXNnLnNlbmRlciwgbXNnLnZhbHVlIC0gcmVxdWlyZWRGZWUpOwoKICAgICAgICAvLyBTcGxpdCB0aGUgY2hhbGxlbmdlIGZ1bmN0aW9uIGludG8gbXVsdGlwbGUgcGFydHMgYmVjYXVzZSBvZiBzdGFjayB0b28gZGVlcCBlcnJvci4KICAgICAgICBfY2hhbGxlbmdlUGFydDIoX2R1bmdlb25JZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTcGxpdCB0aGUgY2hhbGxlbmdlIGZ1bmN0aW9uIGludG8gbXVsdGlwbGUgcGFydHMgYmVjYXVzZSBvZiBzdGFjayB0b28gZGVlcCBlcnJvci4KICAgICAqLwogICAgZnVuY3Rpb24gX2NoYWxsZW5nZVBhcnQyKHVpbnQgX2R1bmdlb25JZCkgcHJpdmF0ZSB7CiAgICAgICAgdWludCBmbG9vck51bWJlcjsKICAgICAgICB1aW50IHJld2FyZHM7CiAgICAgICAgdWludCBmbG9vckdlbmVzOwogICAgICAgICgsLCxmbG9vck51bWJlciwscmV3YXJkcywsZmxvb3JHZW5lcykgPSBkdW5nZW9uVG9rZW5Db250cmFjdC5kdW5nZW9ucyhfZHVuZ2VvbklkKTsKCiAgICAgICAgLy8gR2V0IHRoZSBmaXJzdCBoZXJvIGdlbmUsIG9yIGluaXRpYWxpemUgZmlyc3QgaGVybyB3aXRoIGN1cnJlbnQgZHVuZ2VvbidzIHNlZWQgZ2VuZXMuCiAgICAgICAgLy8gVE9ETzogaW1wbGVtZW50IG11bHRpcGxlIGhlcm9lcyBpbiBuZXh0IHBoYXNlCiAgICAgICAgdWludCBoZXJvR2VuZXMgPSBfZ2V0Rmlyc3RIZXJvR2VuZXNBbmRJbml0aWFsaXplKF9kdW5nZW9uSWQpOwoKICAgICAgICBib29sIHN1Y2Nlc3MgPSBfZ2V0Q2hhbGxlbmdlU3VjY2VzcyhoZXJvR2VuZXMsIGZsb29yR2VuZXMpOwoKICAgICAgICB1aW50IG5ld0Zsb29yR2VuZXM7CiAgICAgICAgdWludCBzdWNjZXNzUmV3YXJkczsKICAgICAgICB1aW50IG1hc3RlclJld2FyZHM7CgogICAgICAgIC8vIFdoZXRoZXIgYSBjaGFsbGVuZ2UgaXMgc3VjY2VzcyBvciBub3QgaXMgZGV0ZXJtaW5lZCBieSBhIHNpbXBsZSBjb21wYXJpc29uIGJldHdlZW4gaGVybyBwb3dlciBhbmQgZmxvb3IgcG93ZXIuCiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgbmV3Rmxvb3JHZW5lcyA9IF9nZXROZXdGbG9vckdlbmUoX2R1bmdlb25JZCk7CiAgICAgICAgICAgIHN1Y2Nlc3NSZXdhcmRzID0gcmV3YXJkcyAqIGNoYWxsZW5nZVJld2FyZHNQZXJjZW50IC8gMTAwOwogICAgICAgICAgICBtYXN0ZXJSZXdhcmRzID0gcmV3YXJkcyAqIG1hc3RlclJld2FyZHNQZXJjZW50IC8gMTAwOwoKICAgICAgICAgICAgLy8gVGhlIGR1bmdlb24gcmV3YXJkcyBmb3IgbmV3IGZsb29yIGFzIHRvdGFsIHJld2FyZHMgLSBjaGFsbGVuZ2UgcmV3YXJkcyAtIGRldmxlb3BlciBmZWUuCiAgICAgICAgICAgIHVpbnQgbmV3UmV3YXJkcyA9IHJld2FyZHMgKiAoMTAwIC0gY2hhbGxlbmdlUmV3YXJkc1BlcmNlbnQgLSBtYXN0ZXJSZXdhcmRzUGVyY2VudCkgLyAxMDA7CgogICAgICAgICAgICAvLyAqKiBTVE9SQUdFIFVQREFURSAqKgogICAgICAgICAgICAvLyBBZGQgbmV3IGZsb29yIHdpdGggdGhlIG5ldyBmbG9vciBnZW5lcyBhbmQgbmV3IHJld2FyZHMuCiAgICAgICAgICAgIGR1bmdlb25Ub2tlbkNvbnRyYWN0LmFkZER1bmdlb25OZXdGbG9vcihfZHVuZ2VvbklkLCBuZXdSZXdhcmRzLCBuZXdGbG9vckdlbmVzKTsKCiAgICAgICAgICAgIC8vIE1hcmsgdGhlIGNoYWxsZW5nZSByZXdhcmRzIGF2YWlsYWJsZSB0byBiZSB3aXRoZHJhd2VkIGJ5IHRoZSBwbGF5ZXIuCiAgICAgICAgICAgIGFzeW5jU2VuZChtc2cuc2VuZGVyLCBzdWNjZXNzUmV3YXJkcyk7CgogICAgICAgICAgICAvLyBNYXJrIHRoZSBtYXN0ZXIgcmV3YXJkcyBhdmFpbGFibGUgdG8gYmUgd2l0aGRyYXdlZCBieSB0aGUgZHVuZ2VvbiBtYXN0ZXIuCiAgICAgICAgICAgIGFzeW5jU2VuZChkdW5nZW9uVG9rZW5Db250cmFjdC5vd25lck9mKF9kdW5nZW9uSWQpLCBtYXN0ZXJSZXdhcmRzKTsKICAgICAgICB9CgogICAgICAgIC8vIEVtaXQgdGhlIER1bmdlb25DaGFsbGVuZ2VkIGV2ZW50LgogICAgICAgIER1bmdlb25DaGFsbGVuZ2VkKG5vdywgbXNnLnNlbmRlciwgX2R1bmdlb25JZCwgaGVyb0dlbmVzLCBmbG9vck51bWJlciwgZmxvb3JHZW5lcywgc3VjY2VzcywgbmV3Rmxvb3JHZW5lcywgc3VjY2Vzc1Jld2FyZHMsIG1hc3RlclJld2FyZHMpOwogICAgfQoKICAgIC8qKgogICAgICogU3BsaXQgdGhlIGNoYWxsZW5nZSBmdW5jdGlvbiBpbnRvIG11bHRpcGxlIHBhcnRzIGJlY2F1c2Ugb2Ygc3RhY2sgdG9vIGRlZXAgZXJyb3IuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9nZXRGaXJzdEhlcm9HZW5lc0FuZEluaXRpYWxpemUodWludCBfZHVuZ2VvbklkKSBwcml2YXRlIHJldHVybnMgKHVpbnQgaGVyb0dlbmVzKSB7CiAgICAgICAgdWludCBzZWVkR2VuZXM7CiAgICAgICAgKCwsLCwsLHNlZWRHZW5lcywpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2R1bmdlb25JZCk7CgogICAgICAgIC8vIEdldCB0aGUgZmlyc3QgaGVybyBvZiB0aGUgcGxheWVyLgogICAgICAgIHVpbnQgaGVyb0lkOwoKICAgICAgICBpZiAoaGVyb1Rva2VuQ29udHJhY3QuYmFsYW5jZU9mKG1zZy5zZW5kZXIpID09IDApIHsKICAgICAgICAgICAgLy8gQXNzaWduIHRoZSBmaXJzdCBoZXJvIHVzaW5nIHRoZSBzZWVkIGdlbmVzIG9mIHRoZSBkdW5nZW9uIGZvciBuZXcgcGxheWVyLgogICAgICAgICAgICBoZXJvSWQgPSBoZXJvVG9rZW5Db250cmFjdC5jcmVhdGVIZXJvKHNlZWRHZW5lcywgbXNnLnNlbmRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGVyb0lkID0gaGVyb1Rva2VuQ29udHJhY3Qub3duZXJUb2tlbnMobXNnLnNlbmRlciwgMCk7CiAgICAgICAgfQoKICAgICAgICAvLyBHZXQgdGhlIGhlcm8gZ2VuZXMgZnJvbSB0b2tlbiBzdG9yYWdlLgogICAgICAgICgsaGVyb0dlbmVzKSA9IGhlcm9Ub2tlbkNvbnRyYWN0Lmhlcm9lcyhoZXJvSWQpOwogICAgfQoKICAgIC8qKgogICAgICogU3BsaXQgdGhlIGNoYWxsZW5nZSBmdW5jdGlvbiBpbnRvIG11bHRpcGxlIHBhcnRzIGJlY2F1c2Ugb2Ygc3RhY2sgdG9vIGRlZXAgZXJyb3IuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9nZXRDaGFsbGVuZ2VTdWNjZXNzKHVpbnQgaGVyb0dlbmVzLCB1aW50IGZsb29yR2VuZXMpIHByaXZhdGUgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBwbGF5ZXIgY2hhbGxlbmdlIHN1Y2Nlc3NmdWx5IHRoZSBkdW5nZW9uIG9yIG5vdCwgYW5kIHRoZSBuZXcgZmxvb3IgZ2VuZXMuCiAgICAgICAgdWludCBoZXJvUG93ZXIgPSBfZ2V0R2VuZXNQb3dlcihoZXJvR2VuZXMpOwogICAgICAgIHVpbnQgZmxvb3JQb3dlciA9IF9nZXRHZW5lc1Bvd2VyKGZsb29yR2VuZXMpOwoKICAgICAgICByZXR1cm4gaGVyb1Bvd2VyID4gZmxvb3JQb3dlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFNwbGl0IHRoZSBjaGFsbGVuZ2UgZnVuY3Rpb24gaW50byBtdWx0aXBsZSBwYXJ0cyBiZWNhdXNlIG9mIHN0YWNrIHRvbyBkZWVwIGVycm9yLgogICAgICovCiAgICBmdW5jdGlvbiBfZ2V0TmV3Rmxvb3JHZW5lKHVpbnQgX2R1bmdlb25JZCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHNlZWRHZW5lczsKICAgICAgICB1aW50IGZsb29yR2VuZXM7CiAgICAgICAgKCwsLCwsc2VlZEdlbmVzLGZsb29yR2VuZXMpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2R1bmdlb25JZCk7CgogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgbmV3IGZsb29yIGdlbmUuCiAgICAgICAgdWludCBmbG9vclBvd2VyID0gX2dldEdlbmVzUG93ZXIoZmxvb3JHZW5lcyk7CiAgICAgICAgdWludCBuZXdGbG9vckdlbmVzID0gY2hhbGxlbmdlU2NpZW5jZUNvbnRyYWN0Lm1peEdlbmVzKGZsb29yR2VuZXMsIHNlZWRHZW5lcyk7CiAgICAgICAgdWludCBuZXdGbG9vclBvd2VyID0gX2dldEdlbmVzUG93ZXIobmV3Rmxvb3JHZW5lcyk7CgogICAgICAgIC8vIElmIHRoZSBwb3dlciBkZWNyZWFzZWQsIHJvbGxiYWNrIHRvIHRoZSBjdXJyZW50IGZsb29yIGdlbmVzLgogICAgICAgIGlmIChuZXdGbG9vclBvd2VyIDwgZmxvb3JQb3dlcikgewogICAgICAgICAgICBuZXdGbG9vckdlbmVzID0gZmxvb3JHZW5lczsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXdGbG9vckdlbmVzOwogICAgfQoKCiAgICAvKiA9PT09PT09PSBTRVRURVIgRlVOQ1RJT05TID09PT09PT09ICovCgogICAgLyoqCiAgICAgKiBAZGV2IFVwZGF0ZXMgdGhlIGZlZSBjb250cmlidXRpb24gbXVsdGlwbGllciByZXF1aXJlZCBmb3IgY2FsbGluZyBjaGFsbGVuZ2UoKS4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0Q2hhbGxlbmdlRmVlTXVsdGlwbGllcih1aW50IF9uZXdDaGFsbGVuZ2VGZWVNdWx0aXBsaWVyKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGNoYWxsZW5nZUZlZU11bHRpcGxpZXIgPSBfbmV3Q2hhbGxlbmdlRmVlTXVsdGlwbGllcjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlcyB0aGUgY2hhbGxlbmdlIHJld2FyZHMgcGVjZW50YWdlLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRDaGFsbGVuZ2VSZXdhcmRzUGVyY2VudCh1aW50IF9uZXdDaGFsbGVuZ2VSZXdhcmRzUGVyY2VudCkgb25seU93bmVyIGV4dGVybmFsIHsKICAgICAgICBjaGFsbGVuZ2VSZXdhcmRzUGVyY2VudCA9IF9uZXdDaGFsbGVuZ2VSZXdhcmRzUGVyY2VudDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXBkYXRlcyB0aGUgbWFzdGVyIHJld2FyZHMgcGVyY2VudGFnZS4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0TWFzdGVyUmV3YXJkc1BlcmNlbnQodWludCBfbmV3TWFzdGVyUmV3YXJkc1BlcmNlbnQpIG9ubHlPd25lciBleHRlcm5hbCB7CiAgICAgICAgbWFzdGVyUmV3YXJkc1BlcmNlbnQgPSBfbmV3TWFzdGVyUmV3YXJkc1BlcmNlbnQ7CiAgICB9Cgp9Cgpjb250cmFjdCBEdW5nZW9uVHJhaW5pbmcgaXMgRHVuZ2VvbkNoYWxsZW5nZSB7CgogICAgLy8vIEBkZXYgVGhlIEhlcm9UcmFpbmVkIGV2ZW50IGlzIGZpcmVkIHdoZW4gdXNlciBmaW5pc2hlZCBhIHRyYWluaW5nLgogICAgZXZlbnQgSGVyb1RyYWluZWQodWludCB0aW1lc3RhbXAsIGFkZHJlc3MgaW5kZXhlZCBwbGF5ZXJBZGRyZXNzLCB1aW50IGluZGV4ZWQgZHVuZ2VvbklkLCB1aW50IGhlcm9HZW5lcywgdWludCBmbG9vck51bWJlciwgdWludCBmbG9vckdlbmVzLCBib29sIHN1Y2Nlc3MsIHVpbnQgbmV3SGVyb0dlbmVzKTsKCiAgICAvLy8gQG5vdGljZSBUaGUgYWN0dWFsIGZlZSBjb250cmlidXRpb24gcmVxdWlyZWQgdG8gY2FsbCB0cmFpblgoKSBpcyBjYWxjdWxhdGVkIGJ5IHRoaXMgZmVlTXVsdGlwbGllciwKICAgIC8vLyAgdGltZXMgdGhlIGR1bmdlb24gZGlmZmljdWx0eSwgdGltZXMgWC4gVGhlIHBheW1lbnQgaXMgYWNjdW11bGF0ZWQgdG8gdGhlIGR1bmdlb24gcmV3YXJkcywKICAgIC8vLyAgYW5kIGEgbGFyZ2UgcHJvcG9ydGlvbiB3aWxsIGJlIGNsYWltZWQgYnkgd2hvZXZlciBzdWNjZXNzZnVsbHkgY2hhbGxlbmdlZCB0aGUgZmxvb3IuCiAgICAvLy8gIDEgZmlubmV5ID0gMC4wMDEgZXRoZXIKICAgIHVpbnQyNTYgcHVibGljIHRyYWluaW5nRmVlTXVsdGlwbGllciA9IDIgZmlubmV5OwoKICAgIC8vLyBAZGV2IFVwZGF0ZXMgdGhlIGZlZSBjb250cmlidXRpb24gbXVsdGlwbGllciByZXF1aXJlZCBmb3IgY2FsbGluZyB0cmFpblgoKS4KICAgIGZ1bmN0aW9uIHNldFRyYWluaW5nRmVlTXVsdGlwbGllcih1aW50IF9uZXdUcmFpbmluZ0ZlZU11bHRpcGxpZXIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgdHJhaW5pbmdGZWVNdWx0aXBsaWVyID0gX25ld1RyYWluaW5nRmVlTXVsdGlwbGllcjsKICAgIH0KCiAgICAvLy8gQGRldiBUaGUgcHVibGljIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiBhIGhlcm8gdHJhaW4gd2l0aCBhIGR1bmdlb24sCiAgICAvLy8gIGl0IGRldGVybWluZXMgd2hldGhlciB3aGV0aGVyIGEgdHJhaW5pbmcgaXMgc3VjY2Vzc2Z1bGx5LCBhbmQgdGhlIHJlc3VsdGluZyBnZW5lcy4KICAgIC8vLyAgV2lsbCBnZW5lcmF0ZSBhIER1bmdlb25DaGFsbGVuZ2VkIGV2ZW50LgogICAgZnVuY3Rpb24gdHJhaW4xKHVpbnQgX2R1bmdlb25JZCkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIGNhblRyYWluKF9kdW5nZW9uSWQpIHsKICAgICAgICBfdHJhaW4oX2R1bmdlb25JZCwgMSk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhaW4yKHVpbnQgX2R1bmdlb25JZCkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIGNhblRyYWluKF9kdW5nZW9uSWQpIHsKICAgICAgICBfdHJhaW4oX2R1bmdlb25JZCwgMik7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhaW4zKHVpbnQgX2R1bmdlb25JZCkgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIGNhblRyYWluKF9kdW5nZW9uSWQpIHsKICAgICAgICBfdHJhaW4oX2R1bmdlb25JZCwgMyk7CiAgICB9CgogICAgLy8vIEBkZXYgQW4gaW50ZXJuYWwgZnVuY3Rpb24gb2YgYSBoZXJvIHRyYWluIHdpdGggZHVuZ2VvbiwKICAgIC8vLyAgaXQgZGV0ZXJtaW5lcyB3aGV0aGVyIHdoZXRoZXIgYSB0cmFpbmluZyBpcyBzdWNjZXNzZnVsbHksIGFuZCB0aGUgcmVzdWx0aW5nIGdlbmVzLgogICAgLy8vICBXaWxsIGdlbmVyYXRlIGEgRHVuZ2VvbkNoYWxsZW5nZWQgZXZlbnQuCiAgICBmdW5jdGlvbiBfdHJhaW4odWludCBfZHVuZ2VvbklkLCB1aW50IF90cmFpbmluZ1RpbWVzKSBwcml2YXRlIHsKICAgICAgICAvLyBHZXQgdGhlIGR1bmdlb24gZGV0YWlscyBmcm9tIHRoZSB0b2tlbiBjb250cmFjdC4KICAgICAgICB1aW50IGRpZmZpY3VsdHk7CiAgICAgICAgdWludCBmbG9vck51bWJlcjsKICAgICAgICB1aW50IHJld2FyZHM7CiAgICAgICAgdWludCBzZWVkR2VuZXM7CiAgICAgICAgdWludCBmbG9vckdlbmVzOwogICAgICAgICgsLGRpZmZpY3VsdHksZmxvb3JOdW1iZXIsLHJld2FyZHMsc2VlZEdlbmVzLGZsb29yR2VuZXMpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2R1bmdlb25JZCk7CgogICAgICAgIC8vIENoZWNrIGZvciBfdHJhaW5pbmdUaW1lcyBhYm5vcm1hbGl0eSwgd2UgcHJvYmFibHkgd29uJ3QgaGF2ZSBhbnkgZmVhdHVyZSB0aGF0IHRyYWluIGEgaGVybyAxMCB0aW1lcyB3aXRoIGEgc2luZ2xlIGNhbGwuCiAgICAgICAgcmVxdWlyZShfdHJhaW5pbmdUaW1lcyA8IDEwKTsKCiAgICAgICAgLy8gQ2hlY2tzIGZvciBwYXltZW50LCBhbnkgZXhjZWVkaW5nIGZ1bmRzIHdpbGwgYmUgdHJhbnNmZXJyZWQgYmFjayB0byB0aGUgcGxheWVyLgogICAgICAgIHVpbnQgcmVxdWlyZWRGZWUgPSBkaWZmaWN1bHR5ICogdHJhaW5pbmdGZWVNdWx0aXBsaWVyICogX3RyYWluaW5nVGltZXM7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gcmVxdWlyZWRGZWUpOwoKICAgICAgICAvLyBHZXQgdGhlIGZpcnN0IGhlcm8gb2YgdGhlIHBsYXllci4KICAgICAgICAvLyBUT0RPOiBpbXBsZW1lbnQgbXVsdGlwbGUgaGVyb2VzIGluIG5leHQgcGhhc2UKICAgICAgICB1aW50IGhlcm9JZDsKCiAgICAgICAgaWYgKGhlcm9Ub2tlbkNvbnRyYWN0LmJhbGFuY2VPZihtc2cuc2VuZGVyKSA9PSAwKSB7CiAgICAgICAgICAgIC8vIEFzc2lnbiB0aGUgZmlyc3QgaGVybyB1c2luZyB0aGUgc2VlZCBnZW5lcyBvZiB0aGUgZHVuZ2VvbiBmb3IgbmV3IHBsYXllci4KICAgICAgICAgICAgaGVyb0lkID0gaGVyb1Rva2VuQ29udHJhY3QuY3JlYXRlSGVybyhzZWVkR2VuZXMsIG1zZy5zZW5kZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhlcm9JZCA9IGhlcm9Ub2tlbkNvbnRyYWN0Lm93bmVyVG9rZW5zKG1zZy5zZW5kZXIsIDApOwogICAgICAgIH0KCiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAvLyBJbmNyZW1lbnQgdGhlIGFjY3VtdWxhdGVkIHJld2FyZHMgZm9yIHRoZSBkdW5nZW9uLgogICAgICAgIGR1bmdlb25Ub2tlbkNvbnRyYWN0LmFkZER1bmdlb25SZXdhcmRzKF9kdW5nZW9uSWQsIHJlcXVpcmVkRmVlKTsKCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgYW5kIG1ha2UgaXQgYXZhaWxhYmxlIHRvIGJlIHdpdGhkcmF3ZWQgYnkgdGhlIHBsYXllci4KICAgICAgICBhc3luY1NlbmQobXNnLnNlbmRlciwgbXNnLnZhbHVlIC0gcmVxdWlyZWRGZWUpOwoKICAgICAgICAvLyBTcGxpdCB0aGUgX3RyYWluIGZ1bmN0aW9uIGludG8gbXVsdGlwbGUgcGFydHMgYmVjYXVzZSBvZiBzdGFjayB0b28gZGVlcCBlcnJvci4KICAgICAgICBfdHJhaW5QYXJ0MihfZHVuZ2VvbklkLCBfdHJhaW5pbmdUaW1lcywgaGVyb0lkKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNwbGl0IHRoZSBfdHJhaW4gZnVuY3Rpb24gaW50byBtdWx0aXBsZSBwYXJ0cyBiZWNhdXNlIG9mIHN0YWNrIHRvbyBkZWVwIGVycm9yLgogICAgICovCiAgICBmdW5jdGlvbiBfdHJhaW5QYXJ0Mih1aW50IF9kdW5nZW9uSWQsIHVpbnQgX3RyYWluaW5nVGltZXMsIHVpbnQgX2hlcm9JZCkgcHJpdmF0ZSB7CiAgICAgICAgLy8gR2V0IHRoZSBkdW5nZW9uIGRldGFpbHMgZnJvbSB0aGUgdG9rZW4gY29udHJhY3QuCiAgICAgICAgdWludCBmbG9vck51bWJlcjsKICAgICAgICB1aW50IGZsb29yR2VuZXM7CiAgICAgICAgKCwsLGZsb29yTnVtYmVyLCwsLGZsb29yR2VuZXMpID0gZHVuZ2VvblRva2VuQ29udHJhY3QuZHVuZ2VvbnMoX2R1bmdlb25JZCk7CgogICAgICAgIHVpbnQgaGVyb0dlbmVzOwogICAgICAgICgsaGVyb0dlbmVzKSA9IGhlcm9Ub2tlbkNvbnRyYWN0Lmhlcm9lcyhfaGVyb0lkKTsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBoZXJvIHRyYWluaW5nIGlzIHN1Y2Nlc3NmdWwgb3Igbm90LCBhbmQgdGhlIHJlc3VsdGluZyBnZW5lcy4KICAgICAgICB1aW50IGhlcm9Qb3dlciA9IF9nZXRHZW5lc1Bvd2VyKGhlcm9HZW5lcyk7CgogICAgICAgIHVpbnQgbmV3SGVyb0dlbmVzID0gaGVyb0dlbmVzOwogICAgICAgIHVpbnQgbmV3SGVyb1Bvd2VyID0gaGVyb1Bvd2VyOwoKICAgICAgICAvLyBUcmFpbiB0aGUgaGVybyBtdWx0aXBsZSB0aW1lcyBhY2NvcmRpbmcgdG8gX3RyYWluaW5nVGltZXMsCiAgICAgICAgLy8gZWFjaCB0aW1lIGlmIHRoZSByZXN1bHRpbmcgcG93ZXIgaXMgbGFyZ2VyLCB1cGRhdGUgbmV3IGhlcm8gcG93ZXIuCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX3RyYWluaW5nVGltZXM7IGkrKykgewogICAgICAgICAgICB1aW50IHRtcEhlcm9HZW5lcyA9IHRyYWluaW5nU2NpZW5jZUNvbnRyYWN0Lm1peEdlbmVzKG5ld0hlcm9HZW5lcywgZmxvb3JHZW5lcyk7CiAgICAgICAgICAgIHVpbnQgdG1wSGVyb1Bvd2VyID0gX2dldEdlbmVzUG93ZXIodG1wSGVyb0dlbmVzKTsKCiAgICAgICAgICAgIGlmICh0bXBIZXJvUG93ZXIgPiBuZXdIZXJvUG93ZXIpIHsKICAgICAgICAgICAgICAgIG5ld0hlcm9HZW5lcyA9IHRtcEhlcm9HZW5lczsKICAgICAgICAgICAgICAgIG5ld0hlcm9Qb3dlciA9IHRtcEhlcm9Qb3dlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUHJldmVudCByZWR1Y2VkIHBvd2VyLgogICAgICAgIGJvb2wgc3VjY2VzcyA9IG5ld0hlcm9Qb3dlciA+IGhlcm9Qb3dlcjsKCiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAgICAgLy8gU2V0IHRoZSB1cGdyYWRlZCBoZXJvIGdlbmVzLgogICAgICAgICAgICBoZXJvVG9rZW5Db250cmFjdC5zZXRIZXJvR2VuZXMoX2hlcm9JZCwgbmV3SGVyb0dlbmVzKTsKICAgICAgICB9CgogICAgICAgIC8vIEVtaXQgdGhlIEhlcm9UcmFpbmVkIGV2ZW50LgogICAgICAgIEhlcm9UcmFpbmVkKG5vdywgbXNnLnNlbmRlciwgX2R1bmdlb25JZCwgaGVyb0dlbmVzLCBmbG9vck51bWJlciwgZmxvb3JHZW5lcywgc3VjY2VzcywgbmV3SGVyb0dlbmVzKTsKICAgIH0KCn0KCi8qKgogKiBAdGl0bGUgRHVuZ2VvbkNvcmVBbHBoYTIgKGZpeGVkIGNoYWxsZW5nZSByZXdhcmRzIGNhbGN1bGF0aW9uIGJ1ZykKICogQGRldiBDb3JlIENvbnRyYWN0IG9mIEV0aGVyIER1bmdlb24uCiAqICBXaGVuIEJldGEgbGF1bmNoZXMsIER1bmdlb25Db3JlQmV0YSBjb250cmFjdCB3aWxsIGJlIGRlcGxveWVkIGFuZCBEdW5nZW9uQ29yZUFscGhhIHdpbGwgYmUgZGVzdHJveWVkLgogKiAgU2luY2UgYWxsIGR1bmdlb25zIGFuZCBoZXJvZXMgYXJlIHN0b3JlZCBhcyB0b2tlbnMgaW4gZXh0ZXJuYWwgY29udHJhY3RzLCB0aGV5IHJlbWFpbnMgaW1tdXRhYmxlLgogKi8KY29udHJhY3QgRHVuZ2VvbkNvcmVBbHBoYTIgaXMgRGVzdHJ1Y3RpYmxlLCBEdW5nZW9uVHJhaW5pbmcgewoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZSB0aGUgRHVuZ2VvbkNvcmUoQWxwaGEpIGNvbnRyYWN0IHdpdGggYWxsIHRoZSByZXF1aXJlZCBjb250cmFjdCBhZGRyZXNzZXMuCiAgICAgKiBUT0RPOiByZWFsbHkgcmVxdWlyZSBwYXlhYmxlIGhlcmU/IHdoeT8KICAgICAqLwogICAgZnVuY3Rpb24gRHVuZ2VvbkNvcmVBbHBoYTIoCiAgICAgICAgYWRkcmVzcyBfZHVuZ2VvblRva2VuQWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9oZXJvVG9rZW5BZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX2NoYWxsZW5nZVNjaWVuY2VBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3RyYWluaW5nU2NpZW5jZUFkZHJlc3MKICAgICkgcHVibGljIHsKICAgICAgICBkdW5nZW9uVG9rZW5Db250cmFjdCA9IER1bmdlb25Ub2tlbihfZHVuZ2VvblRva2VuQWRkcmVzcyk7CiAgICAgICAgaGVyb1Rva2VuQ29udHJhY3QgPSBIZXJvVG9rZW4oX2hlcm9Ub2tlbkFkZHJlc3MpOwogICAgICAgIGNoYWxsZW5nZVNjaWVuY2VDb250cmFjdCA9IENoYWxsZW5nZVNjaWVuY2VJbnRlcmZhY2UoX2NoYWxsZW5nZVNjaWVuY2VBZGRyZXNzKTsKICAgICAgICB0cmFpbmluZ1NjaWVuY2VDb250cmFjdCA9IFRyYWluaW5nU2NpZW5jZUludGVyZmFjZShfdHJhaW5pbmdTY2llbmNlQWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBleHRlcm5hbCBmdW5jdGlvbiB0byBnZXQgYWxsIHRoZSByZWxldmFudCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIGR1bmdlb24gYnkgaXRzIElELgogICAgICogQHBhcmFtIF9pZCBUaGUgSUQgb2YgdGhlIGR1bmdlb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldER1bmdlb25EZXRhaWxzKHVpbnQgX2lkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgY3JlYXRpb25UaW1lLCB1aW50IHN0YXR1cywgdWludCBkaWZmaWN1bHR5LCB1aW50IGZsb29yTnVtYmVyLCB1aW50IGZsb29yQ3JlYXRpb25UaW1lLCB1aW50IHJld2FyZHMsIHVpbnQgc2VlZEdlbmVzLCB1aW50IGZsb29yR2VuZXMpIHsKICAgICAgICByZXF1aXJlKF9pZCA8IGR1bmdlb25Ub2tlbkNvbnRyYWN0LnRvdGFsU3VwcGx5KCkpOwoKICAgICAgICAoY3JlYXRpb25UaW1lLCBzdGF0dXMsIGRpZmZpY3VsdHksIGZsb29yTnVtYmVyLCBmbG9vckNyZWF0aW9uVGltZSwgcmV3YXJkcywgc2VlZEdlbmVzLCBmbG9vckdlbmVzKSA9IGR1bmdlb25Ub2tlbkNvbnRyYWN0LmR1bmdlb25zKF9pZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBleHRlcm5hbCBmdW5jdGlvbiB0byBnZXQgYWxsIHRoZSByZWxldmFudCBpbmZvcm1hdGlvbiBhYm91dCBhIHNwZWNpZmljIGhlcm8gYnkgaXRzIElELgogICAgICogQHBhcmFtIF9pZCBUaGUgSUQgb2YgdGhlIGhlcm8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEhlcm9EZXRhaWxzKHVpbnQgX2lkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgY3JlYXRpb25UaW1lLCB1aW50IGdlbmVzKSB7CiAgICAgICAgcmVxdWlyZShfaWQgPCBoZXJvVG9rZW5Db250cmFjdC50b3RhbFN1cHBseSgpKTsKCiAgICAgICAgKGNyZWF0aW9uVGltZSwgZ2VuZXMpID0gaGVyb1Rva2VuQ29udHJhY3QuaGVyb2VzKF9pZCk7CiAgICB9Cgp9'.
	

]
