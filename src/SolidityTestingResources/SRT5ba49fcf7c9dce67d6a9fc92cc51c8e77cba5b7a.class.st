Class {
	#name : #SRT5ba49fcf7c9dce67d6a9fc92cc51c8e77cba5b7a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5ba49fcf7c9dce67d6a9fc92cc51c8e77cba5b7a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogICAgLy9WYXJpYWJsZXMKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICAgIC8vICAgIE1vZGlmaWVycwogICAgLyoqCiAgICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgICAqIGFjY291bnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICAgKiBAcGFyYW0gX25ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX25ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOwogICAgfQoKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYyB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gbmV3T3duZXIpIHsKICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICAgICAgbmV3T3duZXIgPSBhZGRyZXNzKDApOwogICAgICAgIH0KICAgIH0KfQoKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewogICAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBjID0gYSAqIGI7CiAgICAgICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgICAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgICAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGFzc2VydChiIDw9IGEpOwogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KfQoKY29udHJhY3QgVG9rZW5SZWNpcGllbnQgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ZhbHVlLCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2V4dHJhRGF0YSkgcHVibGljOwp9CgoKY29udHJhY3QgRVJDMjAgaXMgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvKiBQdWJsaWMgdmFyaWFibGVzIG9mIHRoZSB0b2tlbiAqLwogICAgdWludDI1NiBwdWJsaWMgaW5pdGlhbFN1cHBseTsKCiAgICB1aW50MjU2IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CgogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogICAgc3RyaW5nIHB1YmxpYyBzdGFuZGFyZDsKCiAgICBib29sIHB1YmxpYyBsb2NrZWQ7CgogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJGcm96ZW47CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZXM7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBwdWJsaWMgYWxsb3dlZDsKCiAgICAvKiBUaGlzIGdlbmVyYXRlcyBhIHB1YmxpYyBldmVudCBvbiB0aGUgYmxvY2tjaGFpbiB0aGF0IHdpbGwgbm90aWZ5IGNsaWVudHMgKi8KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50IF92YWx1ZSk7CgogICAgbW9kaWZpZXIgb25seVBheWxvYWRTaXplKHVpbnQgX251bXdvcmRzKSB7CiAgICAgICAgYXNzZXJ0KG1zZy5kYXRhLmxlbmd0aCA9PSBfbnVtd29yZHMgKiAzMiArIDQpOwogICAgICAgIF87CiAgICB9CgogICAgLyogSW5pdGlhbGl6ZXMgY29udHJhY3Qgd2l0aCBpbml0aWFsIHN1cHBseSB0b2tlbnMgdG8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0ICovCiAgICBmdW5jdGlvbiBFUkMyMCgKICAgICAgICB1aW50MjU2IF9pbml0aWFsU3VwcGx5LAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlckFsbFN1cHBseVRvT3duZXIsCiAgICAgICAgYm9vbCBfbG9ja2VkCiAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgc3RhbmRhcmQgPSAiRVJDMjAgMC4xIjsKCiAgICAgICAgaW5pdGlhbFN1cHBseSA9IF9pbml0aWFsU3VwcGx5OwoKICAgICAgICBpZiAoX3RyYW5zZmVyQWxsU3VwcGx5VG9Pd25lcikgewogICAgICAgICAgICBzZXRCYWxhbmNlKG1zZy5zZW5kZXIsIGluaXRpYWxTdXBwbHkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNldEJhbGFuY2UodGhpcywgaW5pdGlhbFN1cHBseSk7CiAgICAgICAgfQoKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsKICAgICAgICAvLyBTZXQgdGhlIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7CiAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7CiAgICAgICAgLy8gQW1vdW50IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgbG9ja2VkID0gX2xvY2tlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOwogICAgfQoKICAgIC8qIHB1YmxpYyBtZXRob2RzICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5UGF5bG9hZFNpemUoMikgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobG9ja2VkID09IGZhbHNlKTsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyRnJvemVuID09IGZhbHNlKTsKICAgIAogICAgICAgIGJvb2wgc3RhdHVzID0gdHJhbnNmZXJJbnRlcm5hbChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJlcXVpcmUoc3RhdHVzID09IHRydWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGxvY2tlZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZXh0cmFEYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGxvY2tlZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBUb2tlblJlY2lwaWVudCBzcGVuZGVyID0gVG9rZW5SZWNpcGllbnQoX3NwZW5kZXIpOwoKICAgICAgICBpZiAoYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlKSkgewogICAgICAgICAgICBzcGVuZGVyLnJlY2VpdmVBcHByb3ZhbChtc2cuc2VuZGVyLCBfdmFsdWUsIHRoaXMsIF9leHRyYURhdGEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIG9ubHlQYXlsb2FkU2l6ZSgzKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAobG9ja2VkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmICh0cmFuc2ZlckZyb3plbikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBfc3VjY2VzcyA9IHRyYW5zZmVySW50ZXJuYWwoX2Zyb20sIF90bywgX3ZhbHVlKTsKCiAgICAgICAgaWYgKF9zdWNjZXNzKSB7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfc3VjY2VzczsKICAgIH0KCiAgICAvKmNvbnN0YW50IGZ1bmN0aW9ucyovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGluaXRpYWxTdXBwbHk7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX2FkZHJlc3NdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLyogaW50ZXJuYWwgZnVuY3Rpb25zKi8KICAgIGZ1bmN0aW9uIHNldEJhbGFuY2UoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF9hbW91bnQpIGludGVybmFsIHsKICAgICAgICBiYWxhbmNlc1tfaG9sZGVyXSA9IF9hbW91bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJJbnRlcm5hbChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUobG9ja2VkID09IGZhbHNlKTsKICAgICAgICByZXF1aXJlKHRyYW5zZmVyRnJvemVuID09IGZhbHNlKTsKCiAgICAgICAgaWYgKF92YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPCBfdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgc2V0QmFsYW5jZShfZnJvbSwgYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpKTsKICAgICAgICBzZXRCYWxhbmNlKF90bywgYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKSk7CgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9Cgpjb250cmFjdCBFUkMyMjMgewogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSwgYnl0ZXMgaW5kZXhlZCBkYXRhKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEsIHN0cmluZyBjdXN0b21GYWxsYmFjaykgcHVibGljIHJldHVybnMgKGJvb2wgb2spOwp9CgoKY29udHJhY3QgQ29udHJhY3RSZWNlaXZlciB7CiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljOwp9CgovKgogICAgQmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL0RleGFyYW4vRVJDMjIzLXRva2VuLXN0YW5kYXJkL2Jsb2IvUmVjb21tZW5kZWQvRVJDMjIzX1Rva2VuLnNvbAoqLwoKY29udHJhY3QgRVJDMjIzVG9rZW4gaXMgRVJDMjIzLCBFUkMyMCB7CiAgICBmdW5jdGlvbiBFUkMyMjNUb2tlbigKICAgICAgICB1aW50MjU2IF9pbml0aWFsU3VwcGx5LAogICAgICAgIHN0cmluZyB0b2tlbk5hbWUsCiAgICAgICAgdWludDggZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyB0b2tlblN5bWJvbCwKICAgICAgICBib29sIHRyYW5zZmVyQWxsU3VwcGx5VG9Pd25lciwKICAgICAgICBib29sIF9sb2NrZWQKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBFUkMyMChfaW5pdGlhbFN1cHBseSwgdG9rZW5OYW1lLCBkZWNpbWFsVW5pdHMsIHRva2VuU3ltYm9sLCB0cmFuc2ZlckFsbFN1cHBseVRvT3duZXIsIF9sb2NrZWQpCiAgICB7CiAgICAgICAgCiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSwgYnl0ZXMgZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUobG9ja2VkID09IGZhbHNlKTsKICAgICAgICAKICAgICAgICBib29sIHN0YXR1cyA9IHRyYW5zZmVySW50ZXJuYWwobXNnLnNlbmRlciwgdG8sIHZhbHVlLCBkYXRhKTsKCiAgICAgICAgcmV0dXJuIHN0YXR1czsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhLCBzdHJpbmcgY3VzdG9tRmFsbGJhY2spIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGxvY2tlZCA9PSBmYWxzZSk7CgogICAgICAgIGJvb2wgc3RhdHVzID0gdHJhbnNmZXJJbnRlcm5hbChtc2cuc2VuZGVyLCB0bywgdmFsdWUsIGRhdGEsIHRydWUsIGN1c3RvbUZhbGxiYWNrKTsKCiAgICAgICAgcmV0dXJuIHN0YXR1czsKICAgIH0KCi8vIHJvbGxiYWNrIGNoYW5nZXMgdG8gdHJhbnNmZXJJbnRlcm5hbCBmb3IgdHJhbnNmZXJGcm9tCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seVBheWxvYWRTaXplKDMpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChsb2NrZWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRyYW5zZmVyRnJvemVuKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF92YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBib29sIF9zdWNjZXNzID0gc3VwZXIudHJhbnNmZXJJbnRlcm5hbChfZnJvbSwgX3RvLCBfdmFsdWUpOwoKICAgICAgICBpZiAoX3N1Y2Nlc3MpIHsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF9zdWNjZXNzOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVySW50ZXJuYWwoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlLCBieXRlcyBkYXRhKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJJbnRlcm5hbChmcm9tLCB0bywgdmFsdWUsIGRhdGEsIGZhbHNlLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJJbnRlcm5hbCgKICAgICAgICBhZGRyZXNzIGZyb20sCiAgICAgICAgYWRkcmVzcyB0bywKICAgICAgICB1aW50MjU2IHZhbHVlLAogICAgICAgIGJ5dGVzIGRhdGEsCiAgICAgICAgYm9vbCB1c2VDdXN0b21GYWxsYmFjaywKICAgICAgICBzdHJpbmcgY3VzdG9tRmFsbGJhY2sKICAgICkKICAgICAgICBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgYm9vbCBzdGF0dXMgPSBzdXBlci50cmFuc2ZlckludGVybmFsKGZyb20sIHRvLCB2YWx1ZSk7CgogICAgICAgIGlmIChzdGF0dXMpIHsKICAgICAgICAgICAgaWYgKGlzQ29udHJhY3QodG8pKSB7CiAgICAgICAgICAgICAgICBDb250cmFjdFJlY2VpdmVyIHJlY2VpdmVyID0gQ29udHJhY3RSZWNlaXZlcih0byk7CgogICAgICAgICAgICAgICAgaWYgKHVzZUN1c3RvbUZhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc29saGludC1kaXNhYmxlLW5leHQtbGluZSBhdm9pZC1jYWxsLXZhbHVlCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZShyZWNlaXZlci5jYWxsLnZhbHVlKDApKGJ5dGVzNChrZWNjYWsyNTYoY3VzdG9tRmFsbGJhY2spKSwgZnJvbSwgdmFsdWUsIGRhdGEpID09IHRydWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKGZyb20sIHZhbHVlLCBkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgVHJhbnNmZXIoZnJvbSwgdG8sIHZhbHVlLCBkYXRhKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJJbnRlcm5hbChhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUobG9ja2VkID09IGZhbHNlKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGRhdGE7CgogICAgICAgIHJldHVybiB0cmFuc2ZlckludGVybmFsKGZyb20sIHRvLCB2YWx1ZSwgZGF0YSwgZmFsc2UsICIiKTsKICAgIH0KCiAgICAvL2Fzc2VtYmxlIHRoZSBnaXZlbiBhZGRyZXNzIGJ5dGVjb2RlLiBJZiBieXRlY29kZSBleGlzdHMgdGhlbiB0aGUgX2FkZHIgaXMgYSBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgcHJpdmF0ZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBsZW5ndGg7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgIC8vcmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUgb24gdGFyZ2V0IGFkZHJlc3MsIHRoaXMgbmVlZHMgYXNzZW1ibHkKICAgICAgICAgICAgbGVuZ3RoIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gKGxlbmd0aCA+IDApOwogICAgfQp9CgovKgpUaGlzIGNvbnRyYWN0IG1hbmFnZXMgdGhlIG1pbnRlcnMgYW5kIHRoZSBtb2RpZmllciB0byBhbGxvdyBtaW50IHRvIGhhcHBlbiBvbmx5IGlmIGNhbGxlZCBieSBtaW50ZXJzClRoaXMgY29udHJhY3QgY29udGFpbnMgYmFzaWMgbWludGluZyBmdW5jdGlvbmFsaXR5IHRob3VnaAoqLwpjb250cmFjdCBNaW50aW5nRVJDMjAgaXMgRVJDMjIzVG9rZW4gewoKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHVpbnQyNTYgcHVibGljIG1heFN1cHBseTsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtaW50ZXJzOwoKICAgIG1vZGlmaWVyIG9ubHlNaW50ZXJzICgpIHsKICAgICAgICByZXF1aXJlKHRydWUgPT0gbWludGVyc1ttc2cuc2VuZGVyXSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBNaW50aW5nRVJDMjAoCiAgICAgICAgdWludDI1NiBfaW5pdGlhbFN1cHBseSwKICAgICAgICB1aW50MjU2IF9tYXhTdXBwbHksCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxzLAogICAgICAgIHN0cmluZyBfc3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyQWxsU3VwcGx5VG9Pd25lciwKICAgICAgICBib29sIF9sb2NrZWQKICAgICkKICAgICAgICBFUkMyMjNUb2tlbihfaW5pdGlhbFN1cHBseSwgX3Rva2VuTmFtZSwgX2RlY2ltYWxzLCBfc3ltYm9sLCBfdHJhbnNmZXJBbGxTdXBwbHlUb093bmVyLCBfbG9ja2VkKQogICAgewogICAgICAgIG1pbnRlcnNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIG1heFN1cHBseSA9IF9tYXhTdXBwbHk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkTWludGVyKGFkZHJlc3MgX25ld01pbnRlcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgbWludGVyc1tfbmV3TWludGVyXSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlTWludGVyKGFkZHJlc3MgX21pbnRlcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgbWludGVyc1tfbWludGVyXSA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfYWRkciwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seU1pbnRlcnMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBpbnRlcm5hbE1pbnQoX2FkZHIsIF9hbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGludGVybmFsTWludChhZGRyZXNzIF9hZGRyLCB1aW50MjU2IF9hbW91bnQpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBpZiAoX2Ftb3VudCA9PSB1aW50MjU2KDApKSB7CiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRvdGFsU3VwcGx5KCkuYWRkKF9hbW91bnQpID4gbWF4U3VwcGx5KSB7CiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KDApOwogICAgICAgIH0KCiAgICAgICAgaW5pdGlhbFN1cHBseSA9IGluaXRpYWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW19hZGRyXSA9IGJhbGFuY2VzW19hZGRyXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX2FkZHIsIF9hbW91bnQpOwoKICAgICAgICByZXR1cm4gX2Ftb3VudDsKICAgIH0KfQoKCmNvbnRyYWN0IEFic3RyYWN0Q2xhaW1hYmxlVG9rZW4gewogICAgZnVuY3Rpb24gY2xhaW1lZFRva2VucyhhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX3Rva2VucykgcHVibGljOwp9CgoKY29udHJhY3QgR2VuZXNpc1Rva2VuIGlzIE1pbnRpbmdFUkMyMCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvKiB2YXJpYWJsZXMgKi8KICAgIHVpbnQyNTYgcHVibGljIGVtaXRUb2tlbnNTaW5jZTsKCiAgICBUb2tlbkVtaXNzaW9uW10gcHVibGljIGVtaXNzaW9uczsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGxhc3RDbGFpbXM7CgogICAgLyogc3RydWN0cyAqLwogICAgc3RydWN0IFRva2VuRW1pc3Npb24gewogICAgICAgIHVpbnQyNTYgYmxvY2tEdXJhdGlvbjsgICAgICAvLyBkdXJhdGlvbiBvZiBibG9jayBpbiBzZWNzCiAgICAgICAgdWludDI1NiBibG9ja1Rva2VuczsgICAgICAgIC8vIHRva2VucyBwZXIgYmxvY2sKICAgICAgICB1aW50MjU2IHBlcmlvZEVuZHNBdDsgICAgIC8vIGR1cmF0aW9uIGluIHNlY3MKICAgICAgICBib29sIHJlbW92ZWQ7CiAgICB9CgogICAgLyogZXZlbnRzICovCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiBfc2luY2UsIHVpbnQyNTYgX3RpbGwsIHVpbnQyNTYgX3Rva2Vucyk7CgogICAgLyogY29uc3RydWN0b3IgKi8KICAgIGZ1bmN0aW9uIEdlbmVzaXNUb2tlbigKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseSwKICAgICAgICB1aW50OCBfcHJlY2lzaW9uLAogICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlckFsbFN1cHBseVRvT3duZXIsCiAgICAgICAgYm9vbCBfbG9ja2VkLAogICAgICAgIHVpbnQyNTYgX2VtaXRUb2tlbnNTaW5jZSwKICAgICAgICB1aW50MjU2IF9tYXhTdXBwbHkKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBNaW50aW5nRVJDMjAoX3RvdGFsU3VwcGx5LCBfbWF4U3VwcGx5LCBfbmFtZSwgX3ByZWNpc2lvbiwgX3N5bWJvbCwgX3RyYW5zZmVyQWxsU3VwcGx5VG9Pd25lciwgX2xvY2tlZCkKICAgIHsKICAgICAgICBzdGFuZGFyZCA9ICJHZW5lc2lzVG9rZW4gMC4xIjsKICAgICAgICBlbWl0VG9rZW5zU2luY2UgPSBfZW1pdFRva2Vuc1NpbmNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZFRva2VuRW1pc3Npb24odWludDI1NiBfYmxvY2tEdXJhdGlvbiwgdWludDI1NiBfYmxvY2tUb2tlbnMsIHVpbnQyNTYgX3BlcmlvZEVuZHNBdCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgZW1pc3Npb25zLnB1c2goVG9rZW5FbWlzc2lvbihfYmxvY2tEdXJhdGlvbiwgX2Jsb2NrVG9rZW5zLCBfcGVyaW9kRW5kc0F0LCBmYWxzZSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZVRva2VuRW1pc3Npb24odWludDI1NiBfaSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfaSA8IGVtaXNzaW9ucy5sZW5ndGgpOwoKICAgICAgICBlbWlzc2lvbnNbX2ldLnJlbW92ZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVRva2VuRW1pc3Npb24odWludDI1NiBfaSwgdWludDI1NiBfYmxvY2tEdXJhdGlvbiwgdWludDI1NiBfYmxvY2tUb2tlbnMsIHVpbnQyNTYgX3BlcmlvZEVuZHNBdCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICByZXF1aXJlKF9pIDwgZW1pc3Npb25zLmxlbmd0aCk7CgogICAgICAgIGVtaXNzaW9uc1tfaV0uYmxvY2tEdXJhdGlvbiA9IF9ibG9ja0R1cmF0aW9uOwogICAgICAgIGVtaXNzaW9uc1tfaV0uYmxvY2tUb2tlbnMgPSBfYmxvY2tUb2tlbnM7CiAgICAgICAgZW1pc3Npb25zW19pXS5wZXJpb2RFbmRzQXQgPSBfcGVyaW9kRW5kc0F0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNsYWltKCkgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKGZhbHNlID09IGxvY2tlZCk7CgogICAgICAgIHVpbnQyNTYgY3VycmVudEJhbGFuY2UgPSBiYWxhbmNlT2YobXNnLnNlbmRlcik7CiAgICAgICAgdWludDI1NiBjdXJyZW50VG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwoKICAgICAgICByZXR1cm4gY2xhaW1JbnRlcm5hbChibG9jay50aW1lc3RhbXAsIG1zZy5zZW5kZXIsIGN1cnJlbnRCYWxhbmNlLCBjdXJyZW50VG90YWxTdXBwbHkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gY2xhaW1hYmxlVHJhbnNmZXJGcm9tKGJsb2NrLnRpbWVzdGFtcCwgX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVFbWlzc2lvblRva2VucygKICAgICAgICB1aW50MjU2IF9sYXN0Q2xhaW1lZEF0LAogICAgICAgIHVpbnQyNTYgX2N1cnJlbnRUaW1lLAogICAgICAgIHVpbnQyNTYgX2N1cnJlbnRCYWxhbmNlLAogICAgICAgIHVpbnQyNTYgX3RvdGFsU3VwcGx5CiAgICApCiAgICAgICAgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG9rZW5zKQogICAgewogICAgICAgIHVpbnQyNTYgdG90YWxUb2tlbnMgPSAwOwoKICAgICAgICB1aW50MjU2IG5ld0N1cnJlbnRUaW1lID0gX2xhc3RDbGFpbWVkQXQ7CiAgICAgICAgdWludDI1NiByZW1haW5pbmdTZWNvbmRzID0gX2N1cnJlbnRUaW1lLnN1YihfbGFzdENsYWltZWRBdCk7CgogICAgICAgIHVpbnQyNTYgY29sbGVjdGVkVG9rZW5zUGVyUGVyaW9kOwoKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBlbWlzc2lvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgVG9rZW5FbWlzc2lvbiBzdG9yYWdlIGVtaXNzaW9uID0gZW1pc3Npb25zW2ldOwoKICAgICAgICAgICAgaWYgKGVtaXNzaW9uLnJlbW92ZWQpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobmV3Q3VycmVudFRpbWUgPCBlbWlzc2lvbi5wZXJpb2RFbmRzQXQpIHsKICAgICAgICAgICAgICAgIGlmIChuZXdDdXJyZW50VGltZS5hZGQocmVtYWluaW5nU2Vjb25kcykgPiBlbWlzc2lvbi5wZXJpb2RFbmRzQXQpIHsKICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGRpZmYgPSBlbWlzc2lvbi5wZXJpb2RFbmRzQXQuc3ViKG5ld0N1cnJlbnRUaW1lKTsKCiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGVkVG9rZW5zUGVyUGVyaW9kID0gZ2V0UGVyaW9kTWluZWRUb2tlbnMoCiAgICAgICAgICAgICAgICAgICAgZGlmZiwgX2N1cnJlbnRCYWxhbmNlLAogICAgICAgICAgICAgICAgICAgIGVtaXNzaW9uLmJsb2NrRHVyYXRpb24sIGVtaXNzaW9uLmJsb2NrVG9rZW5zLAogICAgICAgICAgICAgICAgICAgIF90b3RhbFN1cHBseSk7CgogICAgICAgICAgICAgICAgICAgIHRvdGFsVG9rZW5zICs9IGNvbGxlY3RlZFRva2Vuc1BlclBlcmlvZDsKCiAgICAgICAgICAgICAgICAgICAgbmV3Q3VycmVudFRpbWUgKz0gZGlmZjsKICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdTZWNvbmRzIC09IGRpZmY7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbGxlY3RlZFRva2Vuc1BlclBlcmlvZCA9IGdldFBlcmlvZE1pbmVkVG9rZW5zKAogICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdTZWNvbmRzLCBfY3VycmVudEJhbGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXNzaW9uLmJsb2NrRHVyYXRpb24sIGVtaXNzaW9uLmJsb2NrVG9rZW5zLAogICAgICAgICAgICAgICAgICAgICAgICBfdG90YWxTdXBwbHkKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICB0b3RhbFRva2VucyArPSBjb2xsZWN0ZWRUb2tlbnNQZXJQZXJpb2Q7CgogICAgICAgICAgICAgICAgICAgIG5ld0N1cnJlbnRUaW1lICs9IHJlbWFpbmluZ1NlY29uZHM7CiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nU2Vjb25kcyA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyZW1haW5pbmdTZWNvbmRzID09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG90YWxUb2tlbnM7CiAgICB9CgogICAgLyogaW50ZXJuYWwgbWV0aG9kcyAqLwogICAgZnVuY3Rpb24gZ2V0UGVyaW9kTWluZWRUb2tlbnMoCiAgICAgICAgdWludDI1NiBfZHVyYXRpb24sIHVpbnQyNTYgX2JhbGFuY2UsCiAgICAgICAgdWludDI1NiBfYmxvY2tEdXJhdGlvbiwgdWludDI1NiBfYmxvY2tUb2tlbnMsCiAgICAgICAgdWludDI1NgogICAgKQogICAgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IGJsb2NrcyA9IF9kdXJhdGlvbi5kaXYoX2Jsb2NrRHVyYXRpb24pOwoKICAgICAgICByZXR1cm4gYmxvY2tzLm11bChfYmxvY2tUb2tlbnMpLm11bChfYmFsYW5jZSkuZGl2KG1heFN1cHBseSk7CiAgICB9CgogICAgZnVuY3Rpb24gdG9rZW5zQ2xhaW1lZEhvb2soYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF9zaW5jZSwgdWludDI1NiBfdGlsbCwgdWludDI1NiBfdG9rZW5zKSBpbnRlcm5hbCB7CiAgICAgICAgQ2xhaW1lZFRva2VucyhfaG9sZGVyLCBfc2luY2UsIF90aWxsLCBfdG9rZW5zKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbGFpbUludGVybmFsKAogICAgICAgIHVpbnQyNTYgX3RpbWUsCiAgICAgICAgYWRkcmVzcyBfYWRkcmVzcywKICAgICAgICB1aW50MjU2IF9jdXJyZW50QmFsYW5jZSwKICAgICAgICB1aW50MjU2IF9jdXJyZW50VG90YWxTdXBwbHkKICAgICkKICAgIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgaWYgKF90aW1lIDwgZW1pdFRva2Vuc1NpbmNlKSB7CiAgICAgICAgICAgIGxhc3RDbGFpbXNbX2FkZHJlc3NdID0gZW1pdFRva2Vuc1NpbmNlOwoKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBpZiAoX2N1cnJlbnRCYWxhbmNlID09IDApIHsKICAgICAgICAgICAgbGFzdENsYWltc1tfYWRkcmVzc10gPSBfdGltZTsKCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBsYXN0Q2xhaW1BdCA9IGxhc3RDbGFpbXNbX2FkZHJlc3NdOwoKICAgICAgICBpZiAobGFzdENsYWltQXQgPT0gMCkgewogICAgICAgICAgICBsYXN0Q2xhaW1zW19hZGRyZXNzXSA9IGVtaXRUb2tlbnNTaW5jZTsKICAgICAgICAgICAgbGFzdENsYWltQXQgPSBlbWl0VG9rZW5zU2luY2U7CiAgICAgICAgfQoKICAgICAgICBpZiAobGFzdENsYWltQXQgPj0gX3RpbWUpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IHRva2VucyA9IGNhbGN1bGF0ZUVtaXNzaW9uVG9rZW5zKGxhc3RDbGFpbUF0LCBfdGltZSwgX2N1cnJlbnRCYWxhbmNlLCBfY3VycmVudFRvdGFsU3VwcGx5KTsKCiAgICAgICAgaWYgKHRva2VucyA+IDApIHsKICAgICAgICAgICAgdG9rZW5zQ2xhaW1lZEhvb2soX2FkZHJlc3MsIGxhc3RDbGFpbUF0LCBfdGltZSwgdG9rZW5zKTsKCiAgICAgICAgICAgIGxhc3RDbGFpbXNbX2FkZHJlc3NdID0gX3RpbWU7CiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB0b2tlbnM7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBjbGFpbWFibGVUcmFuc2ZlcigKICAgICAgICB1aW50MjU2IF90aW1lLAogICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdmFsdWUsCiAgICAgICAgYnl0ZXMgX2RhdGEsCiAgICAgICAgYm9vbCBfdXNlQ3VzdG9tRmFsbGJhY2ssCiAgICAgICAgc3RyaW5nIF9jdXN0b21GYWxsYmFjawogICAgKQogICAgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHVpbnQyNTYgc2VuZGVyQ3VycmVudEJhbGFuY2UgPSBiYWxhbmNlT2YoX2Zyb20pOwogICAgICAgIHVpbnQyNTYgcmVjZWl2ZXJDdXJyZW50QmFsYW5jZSA9IGJhbGFuY2VPZihfdG8pOwoKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CgogICAgICAgIGJvb2wgc3RhdHVzID0gc3VwZXIudHJhbnNmZXJJbnRlcm5hbChfZnJvbSwgX3RvLCBfdmFsdWUsIF9kYXRhLCBfdXNlQ3VzdG9tRmFsbGJhY2ssIF9jdXN0b21GYWxsYmFjayk7CgogICAgICAgIHJlcXVpcmUoc3RhdHVzKTsKCiAgICAgICAgY2xhaW1JbnRlcm5hbChfdGltZSwgX2Zyb20sIHNlbmRlckN1cnJlbnRCYWxhbmNlLCBfdG90YWxTdXBwbHkpOwogICAgICAgIGNsYWltSW50ZXJuYWwoX3RpbWUsIF90bywgcmVjZWl2ZXJDdXJyZW50QmFsYW5jZSwgX3RvdGFsU3VwcGx5KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJJbnRlcm5hbCgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3ZhbHVlLAogICAgICAgIGJ5dGVzIF9kYXRhLAogICAgICAgIGJvb2wgX3VzZUN1c3RvbUZhbGxiYWNrLAogICAgICAgIHN0cmluZyBfY3VzdG9tRmFsbGJhY2sKICAgICkKICAgIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICByZXR1cm4gY2xhaW1hYmxlVHJhbnNmZXIoYmxvY2sudGltZXN0YW1wLCBfZnJvbSwgX3RvLCBfdmFsdWUsIF9kYXRhLCBfdXNlQ3VzdG9tRmFsbGJhY2ssIF9jdXN0b21GYWxsYmFjayk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1hYmxlVHJhbnNmZXJGcm9tKAogICAgICAgIHVpbnQyNTYgX3RpbWUsCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF92YWx1ZQogICAgKQogICAgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHVpbnQyNTYgc2VuZGVyQ3VycmVudEJhbGFuY2UgPSBiYWxhbmNlT2YoX2Zyb20pOwogICAgICAgIHVpbnQyNTYgcmVjZWl2ZXJDdXJyZW50QmFsYW5jZSA9IGJhbGFuY2VPZihfdG8pOwoKICAgICAgICB1aW50MjU2IF90b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CgogICAgICAgIGJvb2wgc3RhdHVzID0gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIGlmIChzdGF0dXMpIHsKICAgICAgICAgICAgY2xhaW1JbnRlcm5hbChfdGltZSwgX2Zyb20sIHNlbmRlckN1cnJlbnRCYWxhbmNlLCBfdG90YWxTdXBwbHkpOwogICAgICAgICAgICBjbGFpbUludGVybmFsKF90aW1lLCBfdG8sIHJlY2VpdmVyQ3VycmVudEJhbGFuY2UsIF90b3RhbFN1cHBseSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9CgogICAgZnVuY3Rpb24gaW50ZXJuYWxNaW50KGFkZHJlc3MgX2FkZHIsIHVpbnQyNTYgX2Ftb3VudCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGNsYWltSW50ZXJuYWwobm93LCBfYWRkciwgYmFsYW5jZU9mKF9hZGRyKSwgdG90YWxTdXBwbHkoKSk7CgogICAgICAgIHVpbnQyNTYgbWludGVkID0gc3VwZXIuaW50ZXJuYWxNaW50KF9hZGRyLCBfYW1vdW50KTsKCiAgICAgICAgcmV0dXJuIG1pbnRlZDsKICAgIH0KfQoKY29udHJhY3QgQ0xDIGlzIE1pbnRpbmdFUkMyMCwgQWJzdHJhY3RDbGFpbWFibGVUb2tlbiB7CiAgICB1aW50MjU2IHB1YmxpYyBjcmVhdGVkQXQ7CiAgICBDbG91dCBwdWJsaWMgZ2VuZXNpc1Rva2VuOwoKICAgIGZ1bmN0aW9uIENMQyh1aW50MjU2IF9tYXhTdXBwbHksIHVpbnQ4IGRlY2ltYWxzLCBDbG91dCBfZ2VuZXNpc1Rva2VuLCBib29sIHRyYW5zZmVyQWxsU3VwcGx5VG9Pd25lcikgcHVibGljCiAgICAgICAgTWludGluZ0VSQzIwKDAsIF9tYXhTdXBwbHksICJDTEMiLCBkZWNpbWFscywgIkNMQyIsIHRyYW5zZmVyQWxsU3VwcGx5VG9Pd25lciwgZmFsc2UpCiAgICB7CiAgICAgICAgY3JlYXRlZEF0ID0gbm93OwogICAgICAgIHN0YW5kYXJkID0gIkNMQyAwLjEiOwogICAgICAgIGdlbmVzaXNUb2tlbiA9IF9nZW5lc2lzVG9rZW47CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1lZFRva2VucyhhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX3Rva2VucykgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhnZW5lc2lzVG9rZW4pKTsKCiAgICAgICAgdWludDI1NiBtaW50ZWQgPSBpbnRlcm5hbE1pbnQoX2hvbGRlciwgX3Rva2Vucyk7CgogICAgICAgIHJlcXVpcmUobWludGVkID09IF90b2tlbnMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEdlbmVzaXNUb2tlbihDbG91dCBfZ2VuZXNpc1Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBnZW5lc2lzVG9rZW4gPSBfZ2VuZXNpc1Rva2VuOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRyYW5zZmVyRnJvemVuKGJvb2wgX2Zyb3plbikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgdHJhbnNmZXJGcm96ZW4gPSBfZnJvemVuOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldExvY2tlZChib29sIF9sb2NrZWQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGxvY2tlZCA9IF9sb2NrZWQ7CiAgICB9Cn0KCgpjb250cmFjdCBDbG91dCBpcyBHZW5lc2lzVG9rZW4gewogICAgQWJzdHJhY3RDbGFpbWFibGVUb2tlbiBwdWJsaWMgY2xhaW1hYmxlVG9rZW47CiAgICB1aW50MjU2IHB1YmxpYyBjcmVhdGVkQXQ7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgaXNzdWVyczsKCiAgICBmdW5jdGlvbiBDbG91dCh1aW50MjU2IGVtaXRUb2tlbnNTaW5jZSwKICAgICAgICBib29sIGluaXQsCiAgICAgICAgdWludDI1NiBpbml0aWFsU3VwcGx5LAogICAgICAgIHVpbnQ4IGRlY2ltYWxzLAogICAgICAgIHN0cmluZyB0b2tlbk5hbWUsCiAgICAgICAgc3RyaW5nIHRva2VuU3ltYm9sLAogICAgICAgIGJvb2wgdHJhbnNmZXJBbGxTdXBwbHlUb093bmVyCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgR2VuZXNpc1Rva2VuKAogICAgICAgICAgICAwLAogICAgICAgICAgICBkZWNpbWFscywKICAgICAgICAgICAgdG9rZW5OYW1lLAogICAgICAgICAgICB0b2tlblN5bWJvbCwKICAgICAgICAgICAgdHJhbnNmZXJBbGxTdXBwbHlUb093bmVyLAogICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgZW1pdFRva2Vuc1NpbmNlLAogICAgICAgICAgICBpbml0aWFsU3VwcGx5CiAgICAgICAgKQogICAgICAgIC8vIHNvbGhpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZnVuY3Rpb24tbWF4LWxpbmVzCiAgICB7CiAgICAgICAgc3RhbmRhcmQgPSAiQ2xvdXQgMC4xIjsKCiAgICAgICAgY3JlYXRlZEF0ID0gbm93OwoKICAgICAgICAvLyBlbWlzc2lvbnMKICAgICAgICBpZiAoaW5pdCkgewovLyAgICAgICAgICAgIHVpbnQyNTYgcGVyaW9kMCA9IGNyZWF0ZWRBdDsKLy8gICAgICAgICAgICB1aW50MjU2IHBlcmlvZDEgPSAxNTE0NzY0ODAwOyAvLyAyMDE4LTAxLTAxVDAwOjAwOjAwWgovLyAgICAgICAgICAgIHVpbnQyNTYgcGVyaW9kMiA9IDE1Nzc4MzY4MDA7IC8vIDIwMjAtMDEtMDFUMDA6MDA6MDBaCi8vICAgICAgICAgICAgdWludDI1NiBwZXJpb2QzID0gMTY3MjUzMTIwMDsgLy8gMjAyMy0wMS0wMVQwMDowMDowMFoKLy8gICAgICAgICAgICB1aW50MjU2IHBlcmlvZDQgPSAxNzk4NzYxNjAwOyAvLyAyMDI3LTAxLTAxVDAwOjAwOjAwWgovLyAgICAgICAgICAgIHVpbnQyNTYgcGVyaW9kNSA9IDE5NTY1MjgwMDA7IC8vIDIwMzItMDEtMDFUMDA6MDA6MDBaCi8vICAgICAgICAgICAgdWludDI1NiBwZXJpb2Q2ID0gMjE0NTkxNjgwMDsgLy8gMjAzOC0wMS0wMVQwMDowMDowMFoKLy8gICAgICAgICAgICB1aW50MjU2IHBlcmlvZDcgPSAyMzY2ODQxNjAwOyAvLyAyMDQ1LTAxLTAxVDAwOjAwOjAwWgovLyAgICAgICAgICAgIHVpbnQyNTYgcGVyaW9kOCA9IDI2MTkzMDI0MDA7IC8vIDIwNTMtMDEtMDFUMDA6MDA6MDBaCi8vICAgICAgICAgICAgdWludDI1NiBwZXJpb2Q5ID0gMjkwMzI5OTIwMDsgLy8gMjA2Mi0wMS0wMVQwMDowMDowMFoKCiAgICAgICAgICAgIHVpbnQyNTYgYmxvY2tEdXJhdGlvbiA9IDE1OwoKICAgICAgICAgICAgLy8gYWZ0ZXIgaWNvIHRpbGwgMjAxOC0wMS0wMQogICAgICAgICAgICBlbWlzc2lvbnMucHVzaCgKICAgICAgICAgICAgICAgIFRva2VuRW1pc3Npb24oCiAgICAgICAgICAgICAgICAgICAgYmxvY2tEdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAxMDAwMDAwMDAgKiAxMCAqKiAxOCAvICgoMTUxNDc2NDgwMCAtIGVtaXRUb2tlbnNTaW5jZSkgLyBibG9ja0R1cmF0aW9uKSwgLy8gdG9rZW5zCiAgICAgICAgICAgICAgICAgICAgMTUxNDc2NDgwMCwgLy8gdGlsbAogICAgICAgICAgICAgICAgICAgIGZhbHNlIC8vIHJlbW92ZWQKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIC8vIHRpbGwgMjAyMC0wMS0wMS4gYmxvY2tzIDQsMjA0LDgwMCwgdG9rZW5zIHBlciBibG9jayAyLjM3ODIzNDM5OUUxOQogICAgICAgICAgICBlbWlzc2lvbnMucHVzaCgKICAgICAgICAgICAgICAgIFRva2VuRW1pc3Npb24oCiAgICAgICAgICAgICAgICAgICAgYmxvY2tEdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAxMDAwMDAwMDAgKiAxMCAqKiAxOCAvICgoMTU3NzgzNjgwMCAtIDE1MTQ3NjQ4MDApIC8gYmxvY2tEdXJhdGlvbiksIC8vIHRva2VucwogICAgICAgICAgICAgICAgICAgIDE1Nzc4MzY4MDAsIC8vIHRpbGwKICAgICAgICAgICAgICAgICAgICBmYWxzZSAvLyByZW1vdmVkCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAvLyB0aWxsIDIwMjMtMDEtMDEsIGJsb2NrcyA2LDMxMiw5NjAsIHRva2VucyBwZXIgYmxvY2sgMS41ODQwNDI5ODVFMTkKICAgICAgICAgICAgZW1pc3Npb25zLnB1c2goCiAgICAgICAgICAgICAgICBUb2tlbkVtaXNzaW9uKAogICAgICAgICAgICAgICAgICAgIGJsb2NrRHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgMTAwMDAwMDAwICogMTAgKiogMTggLyAoKDE2NzI1MzEyMDAgLSAxNTc3ODM2ODAwKSAvIGJsb2NrRHVyYXRpb24pLCAvLyB0b2tlbnMKICAgICAgICAgICAgICAgICAgICAxNjcyNTMxMjAwLCAvLyB0aWxsCiAgICAgICAgICAgICAgICAgICAgZmFsc2UgLy8gcmVtb3ZlZAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApOwoKICAgICAgICAgICAgLy8gdGlsbCAyMDI3LTAxLTAxLCBibG9ja3MgOCw0MTUsMzYwLCB0b2tlbnMgcGVyIGJsb2NrIDEuMTg4MzAzMjkzRTE5CiAgICAgICAgICAgIGVtaXNzaW9ucy5wdXNoKAogICAgICAgICAgICAgICAgVG9rZW5FbWlzc2lvbigKICAgICAgICAgICAgICAgICAgICBibG9ja0R1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgIDEwMDAwMDAwMCAqIDEwICoqIDE4IC8gKCgxNzk4NzYxNjAwIC0gMTY3MjUzMTIwMCkgLyBibG9ja0R1cmF0aW9uKSwgLy8gdG9rZW5zCiAgICAgICAgICAgICAgICAgICAgMTc5ODc2MTYwMCwgLy8gdGlsbAogICAgICAgICAgICAgICAgICAgIGZhbHNlIC8vIHJlbW92ZWQKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIC8vIHRpbGwgMjAzMi0wMS0wMSwgYmxvY2tzIDEwLDUxNyw3NjAsIHRva2VucyBwZXIgYmxvY2sgOS41MDc3Mjc4ODFFMTgKICAgICAgICAgICAgZW1pc3Npb25zLnB1c2goCiAgICAgICAgICAgICAgICBUb2tlbkVtaXNzaW9uKAogICAgICAgICAgICAgICAgICAgIGJsb2NrRHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgMTAwMDAwMDAwICogMTAgKiogMTggLyAoKDE5NTY1MjgwMDAgLSAxNzk4NzYxNjAwKSAvIGJsb2NrRHVyYXRpb24pLCAvLyB0b2tlbnMKICAgICAgICAgICAgICAgICAgICAxOTU2NTI4MDAwLCAvLyB0aWxsCiAgICAgICAgICAgICAgICAgICAgZmFsc2UgLy8gcmVtb3ZlZAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApOwoKICAgICAgICAgICAgLy8gdGlsbCAyMDM4LTAxLTAxLCBibG9ja3MgMTIsNjI1LDkyMCwgdG9rZW5zIHBlciBibG9jayA3LjkyMDIxNDkyM0UxOAogICAgICAgICAgICBlbWlzc2lvbnMucHVzaCgKICAgICAgICAgICAgICAgIFRva2VuRW1pc3Npb24oCiAgICAgICAgICAgICAgICAgICAgYmxvY2tEdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAxMDAwMDAwMDAgKiAxMCAqKiAxOCAvICgoMjE0NTkxNjgwMCAtIDE5NTY1MjgwMDApIC8gYmxvY2tEdXJhdGlvbiksIC8vIHRva2VucwogICAgICAgICAgICAgICAgICAgIDIxNDU5MTY4MDAsIC8vIHRpbGwKICAgICAgICAgICAgICAgICAgICBmYWxzZSAvLyByZW1vdmVkCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAvLyB0aWxsIDIwNDUtMDEtMDEsIGJsb2NrcyAxNCw3MjgsMzIwLCB0b2tlbnMgcGVyIGJsb2NrIDYuNzg5NjQwNjM4RTE4CiAgICAgICAgICAgIGVtaXNzaW9ucy5wdXNoKAogICAgICAgICAgICAgICAgVG9rZW5FbWlzc2lvbigKICAgICAgICAgICAgICAgICAgICBibG9ja0R1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgIDEwMDAwMDAwMCAqIDEwICoqIDE4IC8gKCgyMzY2ODQxNjAwIC0gMjE0NTkxNjgwMCkgLyBibG9ja0R1cmF0aW9uKSwgLy8gdG9rZW5zCiAgICAgICAgICAgICAgICAgICAgMjM2Njg0MTYwMCwgLy8gdGlsbAogICAgICAgICAgICAgICAgICAgIGZhbHNlIC8vIHJlbW92ZWQKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIC8vIHRpbGwgMjA1My0wMS0wMSwgYmxvY2tzIDE2LDgzMCw3MjAsIHRva2VucyBwZXIgYmxvY2sgNS45NDE1MTY0NjVFMTgKICAgICAgICAgICAgZW1pc3Npb25zLnB1c2goCiAgICAgICAgICAgICAgICBUb2tlbkVtaXNzaW9uKAogICAgICAgICAgICAgICAgICAgIGJsb2NrRHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgMTAwMDAwMDAwICogMTAgKiogMTggLyAoKDI2MTkzMDI0MDAgLSAyMzY2ODQxNjAwKSAvIGJsb2NrRHVyYXRpb24pLCAvLyB0b2tlbnMKICAgICAgICAgICAgICAgICAgICAyNjE5MzAyNDAwLCAvLyB0aWxsCiAgICAgICAgICAgICAgICAgICAgZmFsc2UgLy8gcmVtb3ZlZAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApOwoKICAgICAgICAgICAgLy8gdGlsbCAyMDYyLTAxLTAxLCBibG9ja3MgMTgsOTMzLDEyMCwgdG9rZW5zIHBlciBibG9jayA1LjI4MTc0OTY1NEUxOAogICAgICAgICAgICBlbWlzc2lvbnMucHVzaCgKICAgICAgICAgICAgICAgIFRva2VuRW1pc3Npb24oCiAgICAgICAgICAgICAgICAgICAgYmxvY2tEdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAxMDAwMDAwMDAgKiAxMCAqKiAxOCAvICgoMjkwMzI5OTIwMCAtIDI2MTkzMDI0MDApIC8gYmxvY2tEdXJhdGlvbiksIC8vIHRva2VucwogICAgICAgICAgICAgICAgICAgIDI5MDMyOTkyMDAsIC8vIHRpbGwKICAgICAgICAgICAgICAgICAgICBmYWxzZSAvLyByZW1vdmVkCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldEVtaXNzaW9ucyh1aW50MjU2W10gYXJyYXkpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoYXJyYXkubGVuZ3RoICUgNCA9PSAwKTsKCiAgICAgICAgZGVsZXRlIGVtaXNzaW9uczsKCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICAgICAgZW1pc3Npb25zLnB1c2goVG9rZW5FbWlzc2lvbihhcnJheVtpXSwgYXJyYXlbaSArIDFdLCBhcnJheVtpICsgMl0sIGFycmF5W2kgKyAzXSA9PSAwID8gZmFsc2UgOiB0cnVlKSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldENsYWltYWJsZVRva2VuKEFic3RyYWN0Q2xhaW1hYmxlVG9rZW4gX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBjbGFpbWFibGVUb2tlbiA9IF90b2tlbjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRUcmFuc2ZlckZyb3plbihib29sIF9mcm96ZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHRyYW5zZmVyRnJvemVuID0gX2Zyb3plbjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRMb2NrZWQoYm9vbCBfbG9ja2VkKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBsb2NrZWQgPSBfbG9ja2VkOwogICAgfQoKICAgIGZ1bmN0aW9uIHRva2Vuc0NsYWltZWRIb29rKGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiBzaW5jZSwgdWludDI1NiB0aWxsLCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIGlmIChjbGFpbWFibGVUb2tlbiAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIGNsYWltYWJsZVRva2VuLmNsYWltZWRUb2tlbnMoX2hvbGRlciwgYW1vdW50KTsKICAgICAgICB9CgogICAgICAgIENsYWltZWRUb2tlbnMoX2hvbGRlciwgc2luY2UsIHRpbGwsIGFtb3VudCk7CiAgICB9Cn0KCmNvbnRyYWN0IE11bHRpdmVzdCBpcyBPd25hYmxlIHsKICAgIC8qIHB1YmxpYyB2YXJpYWJsZXMgKi8KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGFsbG93ZWRNdWx0aXZlc3RzOwoKICAgIC8qIGV2ZW50cyAqLwogICAgZXZlbnQgTXVsdGl2ZXN0U2V0KGFkZHJlc3MgbXVsdGl2ZXN0KTsKCiAgICBldmVudCBNdWx0aXZlc3RVbnNldChhZGRyZXNzIG11bHRpdmVzdCk7CgogICAgZXZlbnQgQ29udHJpYnV0aW9uKGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiB0b2tlbnMpOwoKICAgIG1vZGlmaWVyIG9ubHlBbGxvd2VkTXVsdGl2ZXN0cygpIHsKICAgICAgICByZXF1aXJlKHRydWUgPT0gYWxsb3dlZE11bHRpdmVzdHNbbXNnLnNlbmRlcl0pOwogICAgICAgIF87CiAgICB9CgogICAgLyogY29uc3RydWN0b3IgKi8KICAgIGZ1bmN0aW9uIE11bHRpdmVzdChhZGRyZXNzIG11bHRpdmVzdCkgewogICAgICAgIGFsbG93ZWRNdWx0aXZlc3RzW211bHRpdmVzdF0gPSB0cnVlOwogICAgfQoKICAgIC8qIHB1YmxpYyBtZXRob2RzICovCiAgICBmdW5jdGlvbiBzZXRBbGxvd2VkTXVsdGl2ZXN0KGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGFsbG93ZWRNdWx0aXZlc3RzW19hZGRyZXNzXSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdW5zZXRBbGxvd2VkTXVsdGl2ZXN0KGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGFsbG93ZWRNdWx0aXZlc3RzW19hZGRyZXNzXSA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIG11bHRpdmVzdEJ1eSgKICAgICAgICBhZGRyZXNzIF9ob2xkZXIsCiAgICAgICAgdWludDI1NiBfdmFsdWUKICAgICkKICAgIHB1YmxpYwogICAgb25seUFsbG93ZWRNdWx0aXZlc3RzCiAgICB7CiAgICAgICAgYm9vbCBzdGF0dXMgPSBidXkoX2hvbGRlciwgYmxvY2sudGltZXN0YW1wLCBfdmFsdWUpOwoKICAgICAgICByZXF1aXJlKHN0YXR1cyA9PSB0cnVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtdWx0aXZlc3RCdXkoCiAgICAgICAgYnl0ZXMzMiBfaGFzaCwKICAgICAgICB1aW50OCBfdiwKICAgICAgICBieXRlczMyIF9yLAogICAgICAgIGJ5dGVzMzIgX3MKICAgICkKICAgICAgICBwdWJsaWMgcGF5YWJsZQogICAgewogICAgICAgIHJlcXVpcmUoX2hhc2ggPT0ga2VjY2FrMjU2KG1zZy5zZW5kZXIpKTsKICAgICAgICByZXF1aXJlKGFsbG93ZWRNdWx0aXZlc3RzW3ZlcmlmeShfaGFzaCwgX3YsIF9yLCBfcyldID09IHRydWUpOwogICAgICAgIGJvb2wgc3RhdHVzID0gYnV5KG1zZy5zZW5kZXIsIGJsb2NrLnRpbWVzdGFtcCwgbXNnLnZhbHVlKTsKCiAgICAgICAgcmVxdWlyZShzdGF0dXMgPT0gdHJ1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gdmVyaWZ5KGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHByZWZpeCA9ICJceDE5RXRoZXJldW0gU2lnbmVkIE1lc3NhZ2U6XG4zMiI7CgogICAgICAgIHJldHVybiBlY3JlY292ZXIoa2VjY2FrMjU2KHByZWZpeCwgaGFzaCksIHYsIHIsIHMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eShhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF90aW1lLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCk7Cn0KCgoKY29udHJhY3QgSUNPIGlzIE93bmFibGUsIE11bHRpdmVzdCB7CiAgICB1aW50MjU2IHB1YmxpYyBpY29TaW5jZTsKICAgIHVpbnQyNTYgcHVibGljIGljb1RpbGw7CgogICAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaG9sZGVyRXRoZXJzOwogICAgdWludDI1NiBwdWJsaWMgY29sbGVjdGVkRXRoZXJzOwogICAgdWludDI1NiBwdWJsaWMgc29sZFRva2VuczsKCiAgICB1aW50MjU2IHB1YmxpYyBtaW5FdGhUb0NvbnRyaWJ1dGU7CgogICAgUGhhc2VbXSBwdWJsaWMgcGhhc2VzOwoKICAgIGJvb2wgcHVibGljIGxvY2tlZDsKCiAgICBDbG91dCBwdWJsaWMgY2xvdXQ7CiAgICBDTEMgcHVibGljIGNsYzsKCiAgICBhZGRyZXNzW10gcHVibGljIGV0aGVyUmVjZWl2ZXJzOwogICAgYWRkcmVzcyBwdWJsaWMgZXRoZXJNYXN0ZXJXYWxsZXQ7CgogICAgc3RydWN0IFBoYXNlIHsKICAgICAgICB1aW50MjU2IHByaWNlOwogICAgICAgIHVpbnQyNTYgbWF4QW1vdW50OwogICAgfQoKICAgIGV2ZW50IENvbnRyaWJ1dGlvbihhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX2V0aGVycywgdWludDI1NiBfY2xvdXRzLCB1aW50MjU2IF9jbGNzKTsKCiAgICBmdW5jdGlvbiBJQ08oCiAgICAgICAgdWludDI1NiBfaWNvU2luY2UsCiAgICAgICAgdWludDI1NiBfaWNvVGlsbCwKICAgICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgICAgdWludDI1NiBwcmljZTEsCiAgICAgICAgdWludDI1NiBwcmljZTIsCiAgICAgICAgdWludDI1NiBwcmljZTMsCiAgICAgICAgQ2xvdXQgX2Nsb3V0LAogICAgICAgIENMQyBfY2xjLAogICAgICAgIHVpbnQyNTYgX21pbkV0aFRvQ29udHJpYnV0ZSwKICAgICAgICBib29sIF9sb2NrZWQKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBNdWx0aXZlc3QobXNnLnNlbmRlcikKICAgIHsKICAgICAgICBpY29TaW5jZSA9IF9pY29TaW5jZTsKICAgICAgICBpY29UaWxsID0gX2ljb1RpbGw7CiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICAgICAgbG9ja2VkID0gX2xvY2tlZDsKCiAgICAgICAgY2xvdXQgPSBfY2xvdXQ7CiAgICAgICAgY2xjID0gX2NsYzsKCiAgICAgICAgaWYgKF9taW5FdGhUb0NvbnRyaWJ1dGUgPiAwKSB7CiAgICAgICAgICAgIG1pbkV0aFRvQ29udHJpYnV0ZSA9IF9taW5FdGhUb0NvbnRyaWJ1dGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWluRXRoVG9Db250cmlidXRlID0gMDsKICAgICAgICB9CgogICAgICAgIHBoYXNlcy5wdXNoKFBoYXNlKHByaWNlMSwgNTAwMDAwMCAqICh1aW50MjU2KDEwKSAqKiBkZWNpbWFscykpKTsKICAgICAgICBwaGFzZXMucHVzaChQaGFzZShwcmljZTIsIDMwMDAwMDAgKiAodWludDI1NigxMCkgKiogZGVjaW1hbHMpKSk7CiAgICAgICAgcGhhc2VzLnB1c2goUGhhc2UocHJpY2UzLCAyMDAwMDAwICogKHVpbnQyNTYoMTApICoqIGRlY2ltYWxzKSkpOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgICAgIGJvb2wgc3RhdHVzID0gYnV5KG1zZy5zZW5kZXIsIGJsb2NrLnRpbWVzdGFtcCwgbXNnLnZhbHVlKTsKCiAgICAgICAgcmVxdWlyZShzdGF0dXMgPT0gdHJ1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0RXRoZXJSZWNlaXZlcnMoCiAgICAgICAgYWRkcmVzcyBfbWFzdGVyV2FsbGV0LAogICAgICAgIGFkZHJlc3NbXSBfZXRoZXJSZWNlaXZlcnMKICAgICkKICAgICAgICBwdWJsaWMgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZShfbWFzdGVyV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2V0aGVyUmVjZWl2ZXJzLmxlbmd0aCA9PSA0KTsKICAgICAgICByZXF1aXJlKF9ldGhlclJlY2VpdmVyc1swXSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9ldGhlclJlY2VpdmVyc1sxXSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9ldGhlclJlY2VpdmVyc1syXSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9ldGhlclJlY2VpdmVyc1szXSAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgZXRoZXJNYXN0ZXJXYWxsZXQgPSBfbWFzdGVyV2FsbGV0OwogICAgICAgIGV0aGVyUmVjZWl2ZXJzID0gX2V0aGVyUmVjZWl2ZXJzOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFByaWNlKHVpbnQyNTYgcHJpY2UxLCB1aW50MjU2IHByaWNlMiwgdWludDI1NiBwcmljZTMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHBoYXNlc1swXS5wcmljZSA9IHByaWNlMTsKICAgICAgICBwaGFzZXNbMV0ucHJpY2UgPSBwcmljZTI7CiAgICAgICAgcGhhc2VzWzJdLnByaWNlID0gcHJpY2UzOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFBlcmlvZCh1aW50MjU2IHNpbmNlLCB1aW50MjU2IHRpbGwpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGljb1NpbmNlID0gc2luY2U7CiAgICAgICAgaWNvVGlsbCA9IHRpbGw7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Q2xvdXQoQ2xvdXQgX2Nsb3V0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBjbG91dCA9IF9jbG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRDTEMoQ0xDIF9jbGMpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGNsYyA9IF9jbGM7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TG9ja2VkKGJvb2wgX2xvY2tlZCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgbG9ja2VkID0gX2xvY2tlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJY29Ub2tlbnNBbW91bnQodWludDI1NiBfc29sZFRva2VucywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBhbW91bnQ7CgogICAgICAgIHVpbnQyNTYgbmV3U29sZFRva2VucyA9IF9zb2xkVG9rZW5zOwogICAgICAgIHVpbnQyNTYgcmVtYWluaW5nVmFsdWUgPSBfdmFsdWU7CiAgICAKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwaGFzZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgUGhhc2Ugc3RvcmFnZSBwaGFzZSA9IHBoYXNlc1tpXTsKCiAgICAgICAgICAgIHVpbnQyNTYgdG9rZW5zID0gcmVtYWluaW5nVmFsdWUgKiAodWludDI1NigxMCkgKiogZGVjaW1hbHMpIC8gcGhhc2UucHJpY2U7CgogICAgICAgICAgICBpZiAocGhhc2UubWF4QW1vdW50ID4gbmV3U29sZFRva2VucykgewogICAgICAgICAgICAgICAgaWYgKG5ld1NvbGRUb2tlbnMgKyB0b2tlbnMgPiBwaGFzZS5tYXhBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGRpZmYgPSBwaGFzZS5tYXhBbW91bnQgLSB0b2tlbnM7CgogICAgICAgICAgICAgICAgICAgIGFtb3VudCArPSBkaWZmOwoKICAgICAgICAgICAgICAgICAgICAvLyBnZXQgb3B0aW1hbCBhbW91bnQgb2YgZXRoZXJzIGZvciB0aGlzIHBoYXNlCiAgICAgICAgICAgICAgICAgICAgdWludDI1NiBwaGFzZUV0aGVycyA9IGRpZmYgKiBwaGFzZS5wcmljZSAvICh1aW50MjU2KDEwKSAqKiBkZWNpbWFscyk7CgogICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ1ZhbHVlIC09IHBoYXNlRXRoZXJzOwogICAgICAgICAgICAgICAgICAgIG5ld1NvbGRUb2tlbnMgKz0gKHBoYXNlRXRoZXJzICogKHVpbnQyNTYoMTApICoqIGRlY2ltYWxzKSAvIHBoYXNlLnByaWNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYW1vdW50ICs9IHRva2VuczsKCiAgICAgICAgICAgICAgICAgICAgbmV3U29sZFRva2VucyArPSB0b2tlbnM7CgogICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ1ZhbHVlID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJlbWFpbmluZ1ZhbHVlID09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocmVtYWluaW5nVmFsdWUgPiAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICAvLyBzb2xoaW50LWRpc2FibGUtbmV4dC1saW5lIGNvZGUtY29tcGxleGl0eQogICAgZnVuY3Rpb24gdHJhbnNmZXJFdGhlcnMoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+IDApOwogICAgICAgIHJlcXVpcmUoZXRoZXJSZWNlaXZlcnMubGVuZ3RoID09IDQpOwogICAgICAgIHJlcXVpcmUoZXRoZXJNYXN0ZXJXYWxsZXQgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIGV0aGVyIGJhbGFuY2Ugb24gc21hcnQgY29udHJhY3QKICAgICAgICBpZiAodGhpcy5iYWxhbmNlID4gMCkgewogICAgICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CgogICAgICAgICAgICBldGhlclJlY2VpdmVyc1swXS50cmFuc2ZlcihiYWxhbmNlICogMTUgLyAxMDApOwoKICAgICAgICAgICAgZXRoZXJSZWNlaXZlcnNbMV0udHJhbnNmZXIoYmFsYW5jZSAqIDE1IC8gMTAwKTsKCiAgICAgICAgICAgIGV0aGVyUmVjZWl2ZXJzWzJdLnRyYW5zZmVyKGJhbGFuY2UgKiAxMCAvIDEwMCk7CgogICAgICAgICAgICBldGhlclJlY2VpdmVyc1szXS50cmFuc2ZlcihiYWxhbmNlICogMTAgLyAxMDApOwoKICAgICAgICAgICAgLy8gc2VuZCByZXN0IHRvIG1hc3RlciB3YWxsZXQKCiAgICAgICAgICAgIGV0aGVyTWFzdGVyV2FsbGV0LnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eShhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF90aW1lLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChsb2NrZWQgPT0gdHJ1ZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3RpbWUgPCBpY29TaW5jZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoX3RpbWUgPiBpY29UaWxsKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChfdmFsdWUgPCBtaW5FdGhUb0NvbnRyaWJ1dGUgfHwgX3ZhbHVlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBhbW91bnQgPSBnZXRJY29Ub2tlbnNBbW91bnQoc29sZFRva2VucywgX3ZhbHVlKTsKCiAgICAgICAgaWYgKGFtb3VudCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgY2xvdXRNaW50ZWQgPSBjbG91dC5taW50KF9hZGRyZXNzLCBhbW91bnQpOwogICAgICAgIHVpbnQyNTYgY2xjTWludGVkID0gY2xjLm1pbnQoX2FkZHJlc3MsIGFtb3VudCk7CgogICAgICAgIHJlcXVpcmUoY2xvdXRNaW50ZWQgPT0gYW1vdW50KTsKICAgICAgICByZXF1aXJlKGNsY01pbnRlZCA9PSBhbW91bnQpOwoKICAgICAgICBzb2xkVG9rZW5zICs9IGFtb3VudDsKICAgICAgICBjb2xsZWN0ZWRFdGhlcnMgKz0gX3ZhbHVlOwogICAgICAgIGhvbGRlckV0aGVyc1tfYWRkcmVzc10gKz0gX3ZhbHVlOwoKICAgICAgICBDb250cmlidXRpb24oX2FkZHJlc3MsIF92YWx1ZSwgYW1vdW50LCBhbW91bnQpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=='.
	

]
