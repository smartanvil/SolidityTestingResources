Class {
	#name : #SRT9224a19ebe5af1747351fdad29b6861c7ca6fced,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9224a19ebe5af1747351fdad29b6861c7ca6fced >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKgogICAgQ29weXJpZ2h0IDIwMTcsIEpvcmRpIEJheWxpbmEKCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQogICAgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKICAgIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCgogICAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgogKi8KCi8vLyBAdGl0bGUgTXlFdGhlcldhbGxldCBDYW1wYWlnbiBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hIGFuZCBBcnRodXIgTHVubgovLy8gQGRldiBUaGlzIGNvbnRyYWN0IGNvbnRyb2xzIHRoZSBpc3N1YW5jZSBvZiB0b2tlbnMgZm9yIHRoZSBNaW5pTWUgVG9rZW4KLy8vICBDb250cmFjdC4gVGhpcyB2ZXJzaW9uIHNwZWNpZmljYWxseSBhY3RzIGFzIGEgQ2FtcGFpZ24gbWFuYWdlciBmb3IgcmFpc2luZwovLy8gIGZ1bmRzIGZvciBub24tcHJvZml0IGNhdXNlcywgYnV0IGl0IGNhbiBiZSBjdXN0b21pemVkIGZvciBhbnkgdmFyaWV0eSBvZgovLy8gIHB1cnBvc2VzLgoKLy8vIEBkZXYgQmFzaWMgY29udHJhY3QgdG8gaW5kaXZhdGUgd2hldGhlciBhbm90aGVyIGNvbnRyYWN0IGlzIGNvbnRyb2xsZWQKY29udHJhY3QgQ29udHJvbGxlZCB7CiAgICAvLy8gQG5vdGljZSBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJvbGxlciBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwKICAgIC8vLyAgYSBmdW5jdGlvbiB3aXRoIHRoaXMgbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlDb250cm9sbGVyIHsgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyb2xsZXIpOyBfOyB9CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgcHVibGljIHsgY29udHJvbGxlciA9IG1zZy5zZW5kZXI7fQoKICAgIC8vLyBAbm90aWNlIENoYW5nZXMgdGhlIGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9uZXdDb250cm9sbGVyIFRoZSBuZXcgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyb2xsZXIoYWRkcmVzcyBfbmV3Q29udHJvbGxlcikgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCi8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucwpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0b2tlbiB0cmFuc2ZlciBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KSBwdWJsaWMKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrIHsKICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGZyb20sCiAgICAgICAgdWludDI1NiBfYW1vdW50LAogICAgICAgIGFkZHJlc3MgX3Rva2VuLAogICAgICAgIGJ5dGVzIF9kYXRhCiAgICApIHB1YmxpYzsKfQoKLy8vIEBkZXYgVGhlIGFjdHVhbCB0b2tlbiBjb250cmFjdCwgdGhlIGRlZmF1bHQgY29udHJvbGxlciBpcyB0aGUgbXNnLnNlbmRlcgovLy8gIHRoYXQgZGVwbG95cyB0aGUgY29udHJhY3QsIHNvIHVzdWFsbHkgdGhpcyB0b2tlbiB3aWxsIGJlIGRlcGxveWVkIGJ5IGEKLy8vICB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0LCB3aGljaCBHaXZldGggd2lsbCBjYWxsIGEgIkNhbXBhaWduIgpjb250cmFjdCBNaW5pTWVUb2tlbiBpcyBDb250cm9sbGVkIHsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlLmcuIFJFUAogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjInOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQoKCiAgICAvLy8gQGRldiBgQ2hlY2twb2ludGAgaXMgdGhlIHN0cnVjdHVyZSB0aGF0IGF0dGFjaGVzIGEgYmxvY2sgbnVtYmVyIHRvIGEKICAgIC8vLyAgZ2l2ZW4gdmFsdWUsIHRoZSBibG9jayBudW1iZXIgYXR0YWNoZWQgaXMgdGhlIG9uZSB0aGF0IGxhc3QgY2hhbmdlZCB0aGUKICAgIC8vLyAgdmFsdWUKICAgIHN0cnVjdCAgQ2hlY2twb2ludCB7CgogICAgICAgIC8vIGBmcm9tQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgdmFsdWUgd2FzIGdlbmVyYXRlZCBmcm9tCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7CgogICAgICAgIC8vIGB2YWx1ZWAgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBibG9jayBudW1iZXIKICAgICAgICB1aW50MTI4IHZhbHVlOwogICAgfQoKICAgIC8vIGBwYXJlbnRUb2tlbmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsKICAgIC8vICBpdCB3aWxsIGJlIDB4MCBmb3IgYSB0b2tlbiB0aGF0IHdhcyBub3QgY2xvbmVkCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgcGFyZW50VG9rZW47CgogICAgLy8gYHBhcmVudFNuYXBTaG90QmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgZnJvbSB0aGUgUGFyZW50IFRva2VuIHRoYXQgd2FzCiAgICAvLyAgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBDbG9uZSBUb2tlbgogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsKCiAgICAvLyBgY3JlYXRpb25CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBDbG9uZSBUb2tlbiB3YXMgY3JlYXRlZAogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsKCiAgICAvLyBgYmFsYW5jZXNgIGlzIHRoZSBtYXAgdGhhdCB0cmFja3MgdGhlIGJhbGFuY2Ugb2YgZWFjaCBhZGRyZXNzLCBpbiB0aGlzCiAgICAvLyAgY29udHJhY3Qgd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgY2hhbmdlCiAgICAvLyAgb2NjdXJyZWQgaXMgYWxzbyBpbmNsdWRlZCBpbiB0aGUgbWFwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IENoZWNrcG9pbnRbXSkgYmFsYW5jZXM7CgogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyBhbnkgZXh0cmEgdHJhbnNmZXIgcmlnaHRzIGFzIGluIGFsbCBFUkMyMCB0b2tlbnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvLyBUcmFja3MgdGhlIGhpc3Rvcnkgb2YgdGhlIGB0b3RhbFN1cHBseWAgb2YgdGhlIHRva2VuCiAgICBDaGVja3BvaW50W10gdG90YWxTdXBwbHlIaXN0b3J5OwoKICAgIC8vIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIHRoZSB0b2tlbiBpcyB0cmFuc2ZlcmFibGUgb3Igbm90LgogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzRW5hYmxlZDsKCiAgICAvLyBUaGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0ZSBuZXcgY2xvbmUgdG9rZW5zCiAgICBNaW5pTWVUb2tlbkZhY3RvcnkgcHVibGljIHRva2VuRmFjdG9yeTsKCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ29uc3RydWN0b3IKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIE1pbmlNZVRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbkZhY3RvcnkgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pbmlNZVRva2VuRmFjdG9yeSBjb250cmFjdCB0aGF0CiAgICAvLy8gIHdpbGwgY3JlYXRlIHRoZSBDbG9uZSB0b2tlbiBjb250cmFjdHMsIHRoZSB0b2tlbiBmYWN0b3J5IG5lZWRzIHRvIGJlCiAgICAvLy8gIGRlcGxveWVkIGZpcnN0CiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQogICAgLy8vICBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFNuYXBTaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwKICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4sIHNldCB0byAwIGlmIGl0CiAgICAvLy8gIGlzIGEgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbigKICAgICAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnksCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSBwdWJsaWMgewogICAgICAgIHRva2VuRmFjdG9yeSA9IE1pbmlNZVRva2VuRmFjdG9yeShfdG9rZW5GYWN0b3J5KTsKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIG5hbWUKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsVW5pdHM7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGRlY2ltYWxzCiAgICAgICAgc3ltYm9sID0gX3Rva2VuU3ltYm9sOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBzeW1ib2wKICAgICAgICBwYXJlbnRUb2tlbiA9IE1pbmlNZVRva2VuKF9wYXJlbnRUb2tlbik7CiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOwogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gRVJDMjAgTWV0aG9kcwovLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICAgICAgLy8gVGhlIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gbW92ZSB0b2tlbnMgYXJvdW5kIGF0IHdpbGwsCiAgICAgICAgLy8gIHRoaXMgaXMgaW1wb3J0YW50IHRvIHJlY29nbml6ZSEgQ29uZmlybSB0aGF0IHlvdSB0cnVzdCB0aGUKICAgICAgICAvLyAgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0LCB3aGljaCBpbiBtb3N0IHNpdHVhdGlvbnMgc2hvdWxkIGJlCiAgICAgICAgLy8gIGFub3RoZXIgb3BlbiBzb3VyY2Ugc21hcnQgY29udHJhY3Qgb3IgMHgwCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgewogICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyc0VuYWJsZWQpOwoKICAgICAgICAgICAgLy8gVGhlIHN0YW5kYXJkIEVSQyAyMCB0cmFuc2ZlckZyb20gZnVuY3Rpb25hbGl0eQogICAgICAgICAgICBpZiAoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPCBfYW1vdW50KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQKICAgICkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CgogICAgICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgfQoKICAgICAgICAgICByZXF1aXJlKHBhcmVudFNuYXBTaG90QmxvY2sgPCBibG9jay5udW1iZXIpOwoKICAgICAgICAgICAvLyBEbyBub3QgYWxsb3cgdHJhbnNmZXIgdG8gMHgwIG9yIHRoZSB0b2tlbiBjb250cmFjdCBpdHNlbGYKICAgICAgICAgICByZXF1aXJlKChfdG8gIT0gMCkgJiYgKF90byAhPSBhZGRyZXNzKHRoaXMpKSk7CgogICAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgYmVpbmcgdHJhbnNmZXJlZCBpcyBtb3JlIHRoYW4gdGhlIGJhbGFuY2Ugb2YgdGhlCiAgICAgICAgICAgLy8gIGFjY291bnQgdGhlIHRyYW5zZmVyIHJldHVybnMgZmFsc2UKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZkF0KF9mcm9tLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VGcm9tIDwgX2Ftb3VudCkgewogICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIHRyYW5zZmVyCiAgICAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KSk7CiAgICAgICAgICAgfQoKICAgICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19mcm9tXSwgcHJldmlvdXNCYWxhbmNlRnJvbSAtIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBUaGVuIHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHJlY2VpdmluZyB0aGUgdG9rZW5zCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mQXQoX3RvLCBibG9jay5udW1iZXIpOwogICAgICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfdG9dLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwoKICAgICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0cmFuc2ZlciBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKCiAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCdzIGJhbGFuY2UgaXMgYmVpbmcgcmVxdWVzdGVkCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCB0aGUgY3VycmVudCBibG9jawogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgYmxvY2subnVtYmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX2Ftb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uCiAgICAvLy8gIHRvIGJlIGEgbGl0dGxlIGJpdCBzYWZlcgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZnVuY3Rpb24gY2FsbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZUFuZENhbGwoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50LCBieXRlcyBfZXh0cmFEYXRhCiAgICApIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpKTsKCiAgICAgICAgQXBwcm92ZUFuZENhbGxGYWxsQmFjayhfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICBfYW1vdW50LAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfZXh0cmFEYXRhCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIGdldCB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgLy8vIEByZXR1cm4gVGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgcHVibGljIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mCiAgICAgICAgLy8gIHRoaXMgdG9rZW4KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSB0b3RhbFN1cHBseSBvZiB0aGUgdG9rZW4gaXMKICAgICAgICAvLyAgcmVxdWVzdGVkIGJlZm9yZSBhIGNoZWNrIHBvaW50IHdhcyBldmVyIGNyZWF0ZWQgZm9yIHRoaXMgdG9rZW4sIGl0CiAgICAgICAgLy8gIHJlcXVpcmVzIHRoYXQgdGhlIGBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGlzIHRva2VuIGFzIHRoYXQgY29udGFpbnMgdG90YWxTdXBwbHkgb2YgdGhpcwogICAgICAgIC8vICB0b2tlbiBhdCB0aGlzIGJsb2NrIG51bWJlci4KICAgICAgICBpZiAoKHRvdGFsU3VwcGx5SGlzdG9yeS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBleHBlY3RlZCB0b3RhbFN1cHBseSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIF9ibG9ja051bWJlcik7CiAgICAgICAgfQogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBDbG9uZSBUb2tlbiBNZXRob2QKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgYSBuZXcgY2xvbmUgdG9rZW4gd2l0aCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gYmVpbmcKICAgIC8vLyAgdGhpcyB0b2tlbiBhdCBgX3NuYXBzaG90QmxvY2tgCiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuTmFtZSBOYW1lIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfY2xvbmVEZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBzbWFsbGVzdCB1bml0CiAgICAvLy8gQHBhcmFtIF9jbG9uZVRva2VuU3ltYm9sIFN5bWJvbCBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3NuYXBzaG90QmxvY2sgQmxvY2sgd2hlbiB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBwYXJlbnQgdG9rZW4gaXMKICAgIC8vLyAgY29waWVkIHRvIHNldCB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIG5ldyBjbG9uZSB0b2tlbjsKICAgIC8vLyAgaWYgdGhlIGJsb2NrIGlzIHplcm8gdGhhbiB0aGUgYWN0dWFsIGJsb2NrLCB0aGUgY3VycmVudCBibG9jayBpcyB1c2VkCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBNaW5pTWVUb2tlbiBDb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgKSBwdWJsaWMgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHVpbnQgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHJlcXVpcmUoY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdWludCBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50ID49IHByZXZpb3VzQmFsYW5jZVRvKTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5ICsgX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKDAsIF9vd25lciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBfYW1vdW50YCB0b2tlbnMgZnJvbSBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGxvc2UgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybgogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBidXJuZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQKICAgICkgb25seUNvbnRyb2xsZXIgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ID49IF9hbW91bnQpOwogICAgICAgIHVpbnQgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlRnJvbSA+PSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgLSBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihfb3duZXIsIDAsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBFbmFibGUgdG9rZW5zIHRyYW5zZmVycwovLy8vLy8vLy8vLy8vLy8vCgoKICAgIC8vLyBAbm90aWNlIEVuYWJsZXMgdG9rZW4gaG9sZGVycyB0byB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZnJlZWx5IGlmIHRydWUKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgcHVibGljIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2Ugb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgZmFsbGJhY2sgZnVuY3Rpb246IElmIHRoZSBjb250cmFjdCdzIGNvbnRyb2xsZXIgaGFzIG5vdCBiZWVuCiAgICAvLy8gIHNldCB0byAwLCB0aGVuIHRoZSBgcHJveHlQYXltZW50YCBtZXRob2QgaXMgY2FsbGVkIHdoaWNoIHJlbGF5cyB0aGUKICAgIC8vLyAgZXRoZXIgYW5kIGNyZWF0ZXMgdG9rZW5zIGFzIGRlc2NyaWJlZCBpbiB0aGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdAogICAgZnVuY3Rpb24gKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNDb250cmFjdChjb250cm9sbGVyKSk7CiAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpOwogICAgfQoKLy8vLy8vLy8vLwovLyBTYWZldHkgTWV0aG9kcwovLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHB1YmxpYyByZXR1cm5zIChNaW5pTWVUb2tlbikgewogICAgICAgIE1pbmlNZVRva2VuIG5ld1Rva2VuID0gbmV3IE1pbmlNZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfcGFyZW50VG9rZW4sCiAgICAgICAgICAgIF9zbmFwc2hvdEJsb2NrLAogICAgICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgICAgICBfZGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfdG9rZW5TeW1ib2wsCiAgICAgICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgICAgICk7CgogICAgICAgIG5ld1Rva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIG5ld1Rva2VuOwogICAgfQp9CgovLy8gQHRpdGxlIE93bmVkCi8vLyBAYXV0aG9yIEFkcmkmIzIyNDsgTWFzc2FuZXQgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIyYjRhNGY1OTQyNGE2YjQ4NDQ0ZjRlNDg0NDQ1NWY0ZTUzNWYwNTQyNDQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgovLy8gQG5vdGljZSBUaGUgT3duZWQgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyAKLy8vICBhdXRob3JpemF0aW9uIGNvbnRyb2wgZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgJiB0aGUgaW1wbGVtZW50YXRpb24gb2YKLy8vICB1c2VyIHBlcm1pc3Npb25zOyB0aGlzIGNvbnRyYWN0IGhhcyB0aHJlZSB3b3JrIGZsb3dzIGZvciBhIGNoYW5nZSBpbgovLy8gIG93bmVyc2hpcCwgdGhlIGZpcnN0IHJlcXVpcmVzIHRoZSBuZXcgb3duZXIgdG8gdmFsaWRhdGUgdGhhdCB0aGV5IGhhdmUgdGhlCi8vLyAgYWJpbGl0eSB0byBhY2NlcHQgb3duZXJzaGlwLCB0aGUgc2Vjb25kIGFsbG93cyB0aGUgb3duZXJzaGlwIHRvIGJlCi8vLyAgZGlyZWN0bHkgdHJhbnNmZXJlZCB3aXRob3V0IHJlcXVpcmluZyBhY2NlcHRhbmNlLCBhbmQgdGhlIHRoaXJkIGFsbG93cyBmb3IKLy8vICB0aGUgb3duZXJzaGlwIHRvIGJlIHJlbW92ZWQgdG8gYWxsb3cgZm9yIGRlY2VudHJhbGl6YXRpb24gCmNvbnRyYWN0IE93bmVkIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyQ2FuZGlkYXRlOwoKICAgIGV2ZW50IE93bmVyc2hpcFJlcXVlc3RlZChhZGRyZXNzIGluZGV4ZWQgYnksIGFkZHJlc3MgaW5kZXhlZCB0byk7CiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvKTsKICAgIGV2ZW50IE93bmVyc2hpcFJlbW92ZWQoKTsKCiAgICAvLy8gQGRldiBUaGUgY29uc3RydWN0b3Igc2V0cyB0aGUgYG1zZy5zZW5kZXJgIGFzIHRoZWBvd25lcmAgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8vIEBkZXYgYG93bmVyYCBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwgYSBmdW5jdGlvbiB3aXRoIHRoaXMKICAgIC8vLyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEluIHRoaXMgMXN0IG9wdGlvbiBmb3Igb3duZXJzaGlwIHRyYW5zZmVyIGBwcm9wb3NlT3duZXJzaGlwKClgIG11c3QKICAgIC8vLyAgYmUgY2FsbGVkIGZpcnN0IGJ5IHRoZSBjdXJyZW50IGBvd25lcmAgdGhlbiBgYWNjZXB0T3duZXJzaGlwKClgIG11c3QgYmUKICAgIC8vLyAgY2FsbGVkIGJ5IHRoZSBgbmV3T3duZXJDYW5kaWRhdGVgCiAgICAvLy8gQG5vdGljZSBgb25seU93bmVyYCBQcm9wb3NlcyB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhCiAgICAvLy8gIG5ldyBvd25lcgogICAgLy8vIEBwYXJhbSBfbmV3T3duZXJDYW5kaWRhdGUgVGhlIGFkZHJlc3MgYmVpbmcgcHJvcG9zZWQgYXMgdGhlIG5ldyBvd25lcgogICAgZnVuY3Rpb24gcHJvcG9zZU93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lckNhbmRpZGF0ZSkgb25seU93bmVyIHsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IF9uZXdPd25lckNhbmRpZGF0ZTsKICAgICAgICBPd25lcnNoaXBSZXF1ZXN0ZWQobXNnLnNlbmRlciwgbmV3T3duZXJDYW5kaWRhdGUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgYG5ld093bmVyQ2FuZGlkYXRlYCwgYWNjZXB0cyB0aGUKICAgIC8vLyAgdHJhbnNmZXIgb2Ygb3duZXJzaGlwCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5ld093bmVyQ2FuZGlkYXRlKTsKCiAgICAgICAgYWRkcmVzcyBvbGRPd25lciA9IG93bmVyOwogICAgICAgIG93bmVyID0gbmV3T3duZXJDYW5kaWRhdGU7CiAgICAgICAgbmV3T3duZXJDYW5kaWRhdGUgPSAweDA7CgogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG9sZE93bmVyLCBvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgSW4gdGhpcyAybmQgb3B0aW9uIGZvciBvd25lcnNoaXAgdHJhbnNmZXIgYGNoYW5nZU93bmVyc2hpcCgpYCBjYW4KICAgIC8vLyAgYmUgY2FsbGVkIGFuZCBpdCB3aWxsIGltbWVkaWF0ZWx5IGFzc2lnbiBvd25lcnNoaXAgdG8gdGhlIGBuZXdPd25lcmAKICAgIC8vLyBAbm90aWNlIGBvd25lcmAgY2FuIHN0ZXAgZG93biBhbmQgYXNzaWduIHNvbWUgb3RoZXIgYWRkcmVzcyB0byB0aGlzIHJvbGUKICAgIC8vLyBAcGFyYW0gX25ld093bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgb3duZXIKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9uZXdPd25lciAhPSAweDApOwoKICAgICAgICBhZGRyZXNzIG9sZE93bmVyID0gb3duZXI7CiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICAgICAgbmV3T3duZXJDYW5kaWRhdGUgPSAweDA7CgogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG9sZE93bmVyLCBvd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgSW4gdGhpcyAzcmQgb3B0aW9uIGZvciBvd25lcnNoaXAgdHJhbnNmZXIgYHJlbW92ZU93bmVyc2hpcCgpYCBjYW4KICAgIC8vLyAgYmUgY2FsbGVkIGFuZCBpdCB3aWxsIGltbWVkaWF0ZWx5IGFzc2lnbiBvd25lcnNoaXAgdG8gdGhlIDB4MCBhZGRyZXNzOwogICAgLy8vICBpdCByZXF1aXJlcyBhIDB4ZGVjZSBiZSBpbnB1dCBhcyBhIHBhcmFtZXRlciB0byBwcmV2ZW50IGFjY2lkZW50YWwgdXNlCiAgICAvLy8gQG5vdGljZSBEZWNlbnRyYWxpemVzIHRoZSBjb250cmFjdCwgdGhpcyBvcGVyYXRpb24gY2Fubm90IGJlIHVuZG9uZSAKICAgIC8vLyBAcGFyYW0gX2RhYyBgMHhkYWNgIGhhcyB0byBiZSBlbnRlcmVkIGZvciB0aGlzIGZ1bmN0aW9uIHRvIHdvcmsKICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyc2hpcCh1aW50IF9kYWMpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfZGFjID09IDB4ZGFjKTsKICAgICAgICBvd25lciA9IDB4MDsKICAgICAgICBuZXdPd25lckNhbmRpZGF0ZSA9IDB4MDsKICAgICAgICBPd25lcnNoaXBSZW1vdmVkKCk7ICAgICAKICAgIH0KfSAKCgovLy8gQGRldiBgRXNjYXBhYmxlYCBpcyBhIGJhc2UgbGV2ZWwgY29udHJhY3QgYnVpbHQgb2ZmIG9mIHRoZSBgT3duZWRgCi8vLyAgY29udHJhY3Q7IGl0IGNyZWF0ZXMgYW4gZXNjYXBlIGhhdGNoIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIGNhbGxlZCBpbiBhbgovLy8gIGVtZXJnZW5jeSB0aGF0IHdpbGwgYWxsb3cgZGVzaWduYXRlZCBhZGRyZXNzZXMgdG8gc2VuZCBhbnkgZXRoZXIgb3IgdG9rZW5zCi8vLyAgaGVsZCBpbiB0aGUgY29udHJhY3QgdG8gYW4gYGVzY2FwZUhhdGNoRGVzdGluYXRpb25gIGFzIGxvbmcgYXMgdGhleSB3ZXJlCi8vLyAgbm90IGJsYWNrbGlzdGVkCmNvbnRyYWN0IEVzY2FwYWJsZSBpcyBPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBlc2NhcGVIYXRjaENhbGxlcjsKICAgIGFkZHJlc3MgcHVibGljIGVzY2FwZUhhdGNoRGVzdGluYXRpb247CiAgICBtYXBwaW5nIChhZGRyZXNzPT5ib29sKSBwcml2YXRlIGVzY2FwZUJsYWNrbGlzdDsgLy8gVG9rZW4gY29udHJhY3QgYWRkcmVzc2VzCgogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYCBhbmQgdGhlCiAgICAvLy8gIGBlc2NhcGVIYXRjaENhbGxlcmAKICAgIC8vLyBAcGFyYW0gX2VzY2FwZUhhdGNoQ2FsbGVyIFRoZSBhZGRyZXNzIG9mIGEgdHJ1c3RlZCBhY2NvdW50IG9yIGNvbnRyYWN0CiAgICAvLy8gIHRvIGNhbGwgYGVzY2FwZUhhdGNoKClgIHRvIHNlbmQgdGhlIGV0aGVyIGluIHRoaXMgY29udHJhY3QgdG8gdGhlCiAgICAvLy8gIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYCBpdCB3b3VsZCBiZSBpZGVhbCB0aGF0IGBlc2NhcGVIYXRjaENhbGxlcmAKICAgIC8vLyAgY2Fubm90IG1vdmUgZnVuZHMgb3V0IG9mIGBlc2NhcGVIYXRjaERlc3RpbmF0aW9uYAogICAgLy8vIEBwYXJhbSBfZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbiBUaGUgYWRkcmVzcyBvZiBhIHNhZmUgbG9jYXRpb24gKHVzdSBhCiAgICAvLy8gIE11bHRpc2lnKSB0byBzZW5kIHRoZSBldGhlciBoZWxkIGluIHRoaXMgY29udHJhY3Q7IGlmIGEgbmV1dHJhbCBhZGRyZXNzCiAgICAvLy8gIGlzIHJlcXVpcmVkLCB0aGUgV0hHIE11bHRpc2lnIGlzIGFuIG9wdGlvbjoKICAgIC8vLyAgMHg4RmY5MjAwMjBjOEFENjczNjYxYzgxMTdmMjg1NUMzODQ3NThDNTcyIAogICAgZnVuY3Rpb24gRXNjYXBhYmxlKGFkZHJlc3MgX2VzY2FwZUhhdGNoQ2FsbGVyLCBhZGRyZXNzIF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uKSB7CiAgICAgICAgZXNjYXBlSGF0Y2hDYWxsZXIgPSBfZXNjYXBlSGF0Y2hDYWxsZXI7CiAgICAgICAgZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbiA9IF9lc2NhcGVIYXRjaERlc3RpbmF0aW9uOwogICAgfQoKICAgIC8vLyBAZGV2IFRoZSBhZGRyZXNzZXMgcHJlYXNzaWduZWQgYXMgYGVzY2FwZUhhdGNoQ2FsbGVyYCBvciBgb3duZXJgCiAgICAvLy8gIGFyZSB0aGUgb25seSBhZGRyZXNzZXMgdGhhdCBjYW4gY2FsbCBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUVzY2FwZUhhdGNoQ2FsbGVyT3JPd25lciB7CiAgICAgICAgcmVxdWlyZSAoKG1zZy5zZW5kZXIgPT0gZXNjYXBlSGF0Y2hDYWxsZXIpfHwobXNnLnNlbmRlciA9PSBvd25lcikpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyB0aGUgYmxhY2tsaXN0IG9mIHRva2VucyB0aGF0IGFyZSBub3QgYWJsZSB0byBiZSB0YWtlbgogICAgLy8vICBvdXQgb2YgdGhlIGNvbnRyYWN0OyBjYW4gb25seSBiZSBkb25lIGF0IHRoZSBkZXBsb3ltZW50LCBhbmQgdGhlIGxvZ2ljCiAgICAvLy8gIHRvIGFkZCB0byB0aGUgYmxhY2tsaXN0IHdpbGwgYmUgaW4gdGhlIGNvbnN0cnVjdG9yIG9mIGEgY2hpbGQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX3Rva2VuIHRoZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzIHRoYXQgaXMgdG8gYmUgYmxhY2tsaXN0ZWQgCiAgICBmdW5jdGlvbiBibGFja2xpc3RFc2NhcGVUb2tlbihhZGRyZXNzIF90b2tlbikgaW50ZXJuYWwgewogICAgICAgIGVzY2FwZUJsYWNrbGlzdFtfdG9rZW5dID0gdHJ1ZTsKICAgICAgICBFc2NhcGVIYXRjaEJsYWNraXN0ZWRUb2tlbihfdG9rZW4pOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrcyB0byBzZWUgaWYgYF90b2tlbmAgaXMgaW4gdGhlIGJsYWNrbGlzdCBvZiB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3Rva2VuIHRoZSB0b2tlbiBhZGRyZXNzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIGBfdG9rZW5gIGlzIGluIHRoZSBibGFja2xpc3QgYW5kIGNhbid0IGJlIHRha2VuIG91dCBvZgogICAgLy8vICB0aGUgY29udHJhY3QgdmlhIHRoZSBgZXNjYXBlSGF0Y2goKWAKICAgIGZ1bmN0aW9uIGlzVG9rZW5Fc2NhcGFibGUoYWRkcmVzcyBfdG9rZW4pIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuICFlc2NhcGVCbGFja2xpc3RbX3Rva2VuXTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgYGVzY2FwZUhhdGNoKClgIHNob3VsZCBvbmx5IGJlIGNhbGxlZCBhcyBhIGxhc3QgcmVzb3J0IGlmIGEKICAgIC8vLyBzZWN1cml0eSBpc3N1ZSBpcyB1bmNvdmVyZWQgb3Igc29tZXRoaW5nIHVuZXhwZWN0ZWQgaGFwcGVuZWQKICAgIC8vLyBAcGFyYW0gX3Rva2VuIHRvIHRyYW5zZmVyLCB1c2UgMHgwIGZvciBldGhlcgogICAgZnVuY3Rpb24gZXNjYXBlSGF0Y2goYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5RXNjYXBlSGF0Y2hDYWxsZXJPck93bmVyIHsgICAKICAgICAgICByZXF1aXJlKGVzY2FwZUJsYWNrbGlzdFtfdG9rZW5dPT1mYWxzZSk7CgogICAgICAgIHVpbnQyNTYgYmFsYW5jZTsKCiAgICAgICAgLy8vIEBkZXYgTG9naWMgZm9yIGV0aGVyCiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgYmFsYW5jZSA9IHRoaXMuYmFsYW5jZTsKICAgICAgICAgICAgZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbi50cmFuc2ZlcihiYWxhbmNlKTsKICAgICAgICAgICAgRXNjYXBlSGF0Y2hDYWxsZWQoX3Rva2VuLCBiYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLy8gQGRldiBMb2dpYyBmb3IgdG9rZW5zCiAgICAgICAgRVJDMjAgdG9rZW4gPSBFUkMyMChfdG9rZW4pOwogICAgICAgIGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgdG9rZW4udHJhbnNmZXIoZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbiwgYmFsYW5jZSk7CiAgICAgICAgRXNjYXBlSGF0Y2hDYWxsZWQoX3Rva2VuLCBiYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBhZGRyZXNzIGFzc2lnbmVkIHRvIGNhbGwgYGVzY2FwZUhhdGNoKClgCiAgICAvLy8gQHBhcmFtIF9uZXdFc2NhcGVIYXRjaENhbGxlciBUaGUgYWRkcmVzcyBvZiBhIHRydXN0ZWQgYWNjb3VudCBvcgogICAgLy8vICBjb250cmFjdCB0byBjYWxsIGBlc2NhcGVIYXRjaCgpYCB0byBzZW5kIHRoZSB2YWx1ZSBpbiB0aGlzIGNvbnRyYWN0IHRvCiAgICAvLy8gIHRoZSBgZXNjYXBlSGF0Y2hEZXN0aW5hdGlvbmA7IGl0IHdvdWxkIGJlIGlkZWFsIHRoYXQgYGVzY2FwZUhhdGNoQ2FsbGVyYAogICAgLy8vICBjYW5ub3QgbW92ZSBmdW5kcyBvdXQgb2YgYGVzY2FwZUhhdGNoRGVzdGluYXRpb25gCiAgICBmdW5jdGlvbiBjaGFuZ2VIYXRjaEVzY2FwZUNhbGxlcihhZGRyZXNzIF9uZXdFc2NhcGVIYXRjaENhbGxlcikgb25seUVzY2FwZUhhdGNoQ2FsbGVyT3JPd25lciB7CiAgICAgICAgZXNjYXBlSGF0Y2hDYWxsZXIgPSBfbmV3RXNjYXBlSGF0Y2hDYWxsZXI7CiAgICB9CgogICAgZXZlbnQgRXNjYXBlSGF0Y2hCbGFja2lzdGVkVG9rZW4oYWRkcmVzcyB0b2tlbik7CiAgICBldmVudCBFc2NhcGVIYXRjaENhbGxlZChhZGRyZXNzIHRva2VuLCB1aW50IGFtb3VudCk7Cn0KCi8vLyBAZGV2IFRoaXMgaXMgZGVzaWduZWQgdG8gY29udHJvbCB0aGUgaXNzdWFuY2Ugb2YgYSBNaW5pTWUgVG9rZW4gZm9yIGEKLy8vICBub24tcHJvZml0IENhbXBhaWduLiBUaGlzIGNvbnRyYWN0IGVmZmVjdGl2ZWx5IGRpY3RhdGVzIHRoZSB0ZXJtcyBvZiB0aGUKLy8vICBmdW5kaW5nIHJvdW5kLgpjb250cmFjdCBHaXZldGhDYW1wYWlnbiBpcyBUb2tlbkNvbnRyb2xsZXIsIE93bmVkLCBFc2NhcGFibGUgewoKICAgIHVpbnQgcHVibGljIHN0YXJ0RnVuZGluZ1RpbWU7ICAgICAgIC8vIEluIFVOSVggVGltZSBGb3JtYXQKICAgIHVpbnQgcHVibGljIGVuZEZ1bmRpbmdUaW1lOyAgICAgICAgIC8vIEluIFVOSVggVGltZSBGb3JtYXQKICAgIHVpbnQgcHVibGljIG1heGltdW1GdW5kaW5nOyAgICAgICAgIC8vIEluIHdlaQogICAgdWludCBwdWJsaWMgdG90YWxDb2xsZWN0ZWQ7ICAgICAgICAgLy8gSW4gd2VpCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgdG9rZW5Db250cmFjdDsgICAvLyBUaGUgbmV3IHRva2VuIGZvciB0aGlzIENhbXBhaWduCiAgICBhZGRyZXNzIHB1YmxpYyB2YXVsdEFkZHJlc3M7ICAgICAgICAvLyBUaGUgYWRkcmVzcyB0byBob2xkIHRoZSBmdW5kcyBkb25hdGVkCgovLy8gQG5vdGljZSAnR2l2ZXRoQ2FtcGFpZ24oKScgaW5pdGlhdGVzIHRoZSBDYW1wYWlnbiBieSBzZXR0aW5nIGl0cyBmdW5kaW5nCi8vLyBwYXJhbWV0ZXJzCi8vLyBAZGV2IFRoZXJlIGFyZSBzZXZlcmFsIGNoZWNrcyB0byBtYWtlIHN1cmUgdGhlIHBhcmFtZXRlcnMgYXJlIGFjY2VwdGFibGUKLy8vIEBwYXJhbSBfc3RhcnRGdW5kaW5nVGltZSBUaGUgVU5JWCB0aW1lIHRoYXQgdGhlIENhbXBhaWduIHdpbGwgYmUgYWJsZSB0bwovLy8gc3RhcnQgcmVjZWl2aW5nIGZ1bmRzCi8vLyBAcGFyYW0gX2VuZEZ1bmRpbmdUaW1lIFRoZSBVTklYIHRpbWUgdGhhdCB0aGUgQ2FtcGFpZ24gd2lsbCBzdG9wIGJlaW5nIGFibGUKLy8vIHRvIHJlY2VpdmUgZnVuZHMKLy8vIEBwYXJhbSBfbWF4aW11bUZ1bmRpbmcgSW4gd2VpLCB0aGUgTWF4aW11bSBhbW91bnQgdGhhdCB0aGUgQ2FtcGFpZ24gY2FuCi8vLyByZWNlaXZlIChjdXJyZW50bHkgdGhlIG1heCBpcyBzZXQgYXQgMTAsMDAwIEVUSCBmb3IgdGhlIGJldGEpCi8vLyBAcGFyYW0gX3ZhdWx0QWRkcmVzcyBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc3RvcmUgdGhlIGRvbmF0ZWQgZnVuZHMKLy8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoaXMgY29udHJhY3QgY29udHJvbHMKICAgIGZ1bmN0aW9uIEdpdmV0aENhbXBhaWduKAogICAgICAgIGFkZHJlc3MgX2VzY2FwZUhhdGNoQ2FsbGVyLAogICAgICAgIGFkZHJlc3MgX2VzY2FwZUhhdGNoRGVzdGluYXRpb24sICAgICAgICAKICAgICAgICB1aW50IF9zdGFydEZ1bmRpbmdUaW1lLAogICAgICAgIHVpbnQgX2VuZEZ1bmRpbmdUaW1lLAogICAgICAgIHVpbnQgX21heGltdW1GdW5kaW5nLAogICAgICAgIGFkZHJlc3MgX3ZhdWx0QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF90b2tlbkFkZHJlc3MKICAgICkgRXNjYXBhYmxlKF9lc2NhcGVIYXRjaENhbGxlciwgX2VzY2FwZUhhdGNoRGVzdGluYXRpb24pIHsKICAgICAgICByZXF1aXJlKF9lbmRGdW5kaW5nVGltZSA+IG5vdyk7ICAgICAgICAgICAgICAgIC8vIENhbm5vdCBlbmQgaW4gdGhlIHBhc3QKICAgICAgICByZXF1aXJlKF9lbmRGdW5kaW5nVGltZSA+IF9zdGFydEZ1bmRpbmdUaW1lKTsKICAgICAgICByZXF1aXJlKF9tYXhpbXVtRnVuZGluZyA8PSAxMDAwMDAwIGV0aGVyKTsgICAgICAgIC8vIFRoZSBCZXRhIGlzIGxpbWl0ZWQKICAgICAgICByZXF1aXJlKF92YXVsdEFkZHJlc3MgIT0gMCk7ICAgICAgICAgICAgICAgICAgICAgLy8gVG8gcHJldmVudCBidXJuaW5nIEVUSAogICAgICAgIHN0YXJ0RnVuZGluZ1RpbWUgPSBfc3RhcnRGdW5kaW5nVGltZTsKICAgICAgICBlbmRGdW5kaW5nVGltZSA9IF9lbmRGdW5kaW5nVGltZTsKICAgICAgICBtYXhpbXVtRnVuZGluZyA9IF9tYXhpbXVtRnVuZGluZzsKICAgICAgICB0b2tlbkNvbnRyYWN0ID0gTWluaU1lVG9rZW4oX3Rva2VuQWRkcmVzcyk7Ly8gVGhlIGRlcGxveWVkIFRva2VuIENvbnRyYWN0CiAgICAgICAgdmF1bHRBZGRyZXNzID0gX3ZhdWx0QWRkcmVzczsKICAgIH0KCi8vLyBAZGV2IFRoZSBmYWxsYmFjayBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiBldGhlciBpcyBzZW50IHRvIHRoZSBjb250cmFjdCwgaXQKLy8vIHNpbXBseSBjYWxscyBgZG9QYXltZW50KClgIHdpdGggdGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciBhcyB0aGUKLy8vIGBfb3duZXJgLiBQYXlhYmxlIGlzIGEgcmVxdWlyZWQgc29saWRpdHkgbW9kaWZpZXIgZm9yIGZ1bmN0aW9ucyB0byByZWNlaXZlCi8vLyBldGhlciwgd2l0aG91dCB0aGlzIG1vZGlmaWVyIGZ1bmN0aW9ucyB3aWxsIHRocm93IGlmIGV0aGVyIGlzIHNlbnQgdG8gdGhlbQogICAgZnVuY3Rpb24gKCkgIHBheWFibGUgewogICAgICAgIGRvUGF5bWVudChtc2cuc2VuZGVyKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8vCi8vIFRva2VuQ29udHJvbGxlciBpbnRlcmZhY2UKLy8vLy8vLy8vLy8vLy8vLy8KCi8vLyBAbm90aWNlIGBwcm94eVBheW1lbnQoKWAgYWxsb3dzIHRoZSBjYWxsZXIgdG8gc2VuZCBldGhlciB0byB0aGUgQ2FtcGFpZ24gYW5kCi8vLyBoYXZlIHRoZSB0b2tlbnMgY3JlYXRlZCBpbiBhbiBhZGRyZXNzIG9mIHRoZWlyIGNob29zaW5nCi8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBuZXdseSBjcmVhdGVkIHRva2VucwogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwYXlhYmxlIHJldHVybnMoYm9vbCkgewogICAgICAgIGRvUGF5bWVudChfb3duZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0cmFuc2ZlciwgZm9yIHRoaXMgQ2FtcGFpZ24gYWxsCi8vLyAgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGJ5IGRlZmF1bHQgYW5kIG5vIGV4dHJhIG5vdGlmaWNhdGlvbnMgYXJlIG5lZWRlZAovLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCi8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCi8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCwgZm9yIHRoaXMgQ2FtcGFpZ24gYWxsCi8vLyAgYXBwcm92YWxzIGFyZSBhbGxvd2VkIGJ5IGRlZmF1bHQgYW5kIG5vIGV4dHJhIG5vdGlmaWNhdGlvbnMgYXJlIG5lZWRlZAovLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCi8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpCiAgICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCi8vLyBAZGV2IGBkb1BheW1lbnQoKWAgaXMgYW4gaW50ZXJuYWwgZnVuY3Rpb24gdGhhdCBzZW5kcyB0aGUgZXRoZXIgdGhhdCB0aGlzCi8vLyAgY29udHJhY3QgcmVjZWl2ZXMgdG8gdGhlIGB2YXVsdGAgYW5kIGNyZWF0ZXMgdG9rZW5zIGluIHRoZSBhZGRyZXNzIG9mIHRoZQovLy8gIGBfb3duZXJgIGFzc3VtaW5nIHRoZSBDYW1wYWlnbiBpcyBzdGlsbCBhY2NlcHRpbmcgZnVuZHMKLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIG5ld2x5IGNyZWF0ZWQgdG9rZW5zCiAgICBmdW5jdGlvbiBkb1BheW1lbnQoYWRkcmVzcyBfb3duZXIpIGludGVybmFsIHsKCi8vIEZpcnN0IGNoZWNrIHRoYXQgdGhlIENhbXBhaWduIGlzIGFsbG93ZWQgdG8gcmVjZWl2ZSB0aGlzIGRvbmF0aW9uCiAgICAgICAgcmVxdWlyZShub3c+PXN0YXJ0RnVuZGluZ1RpbWUpOwogICAgICAgIHJlcXVpcmUobm93PD1lbmRGdW5kaW5nVGltZSk7CiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0LmNvbnRyb2xsZXIoKSAhPSAwKTsgICAgICAgICAgIC8vIEV4dHJhIGNoZWNrCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgIT0gMCk7CiAgICAgICAgcmVxdWlyZSh0b3RhbENvbGxlY3RlZCArIG1zZy52YWx1ZSA8PSBtYXhpbXVtRnVuZGluZyk7CgovL1RyYWNrIGhvdyBtdWNoIHRoZSBDYW1wYWlnbiBoYXMgY29sbGVjdGVkCiAgICAgICAgdG90YWxDb2xsZWN0ZWQgKz0gbXNnLnZhbHVlOwoKLy9TZW5kIHRoZSBldGhlciB0byB0aGUgdmF1bHQKICAgICAgICByZXF1aXJlKHZhdWx0QWRkcmVzcy5zZW5kKG1zZy52YWx1ZSkpOwoKLy8gQ3JlYXRlcyBhbiBlcXVhbCBhbW91bnQgb2YgdG9rZW5zIGFzIGV0aGVyIHNlbnQuIFRoZSBuZXcgdG9rZW5zIGFyZSBjcmVhdGVkCi8vICBpbiB0aGUgYF9vd25lcmAgYWRkcmVzcwogICAgICAgIHJlcXVpcmUodG9rZW5Db250cmFjdC5nZW5lcmF0ZVRva2Vucyhfb3duZXIsIG1zZy52YWx1ZSkpOwoKICAgICAgICByZXR1cm47CiAgICB9CgovLy8gQG5vdGljZSBgZmluYWxpemVGdW5kaW5nKClgIGVuZHMgdGhlIENhbXBhaWduIGJ5IGNhbGxpbmcgc2V0dGluZyB0aGUKLy8vICBjb250cm9sbGVyIHRvIDAsIHRoZXJlYnkgZW5kaW5nIHRoZSBpc3N1YW5jZSBvZiBuZXcgdG9rZW5zIGFuZCBzdG9wcGluZyB0aGUKLy8vICBDYW1wYWlnbiBmcm9tIHJlY2VpdmluZyBtb3JlIGV0aGVyCi8vLyBAZGV2IGBmaW5hbGl6ZUZ1bmRpbmcoKWAgY2FuIG9ubHkgYmUgY2FsbGVkIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGZ1bmRpbmcgcGVyaW9kLgogICAgZnVuY3Rpb24gZmluYWxpemVGdW5kaW5nKCkgewogICAgICAgIHJlcXVpcmUgKG5vdyA+PSBlbmRGdW5kaW5nVGltZSk7CiAgICAgICAgdG9rZW5Db250cmFjdC5jaGFuZ2VDb250cm9sbGVyKDApOwogICAgfQoKCi8vLyBAbm90aWNlIGBvbmx5T3duZXJgIGNoYW5nZXMgdGhlIGxvY2F0aW9uIHRoYXQgZXRoZXIgaXMgc2VudAovLy8gQHBhcmFtIF9uZXdWYXVsdEFkZHJlc3MgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGV0aGVyIHNlbnQgdG8gdGhpcwovLy8gIENhbXBhaWduCiAgICBmdW5jdGlvbiBzZXRWYXVsdChhZGRyZXNzIF9uZXdWYXVsdEFkZHJlc3MpIG9ubHlPd25lciB7CiAgICAgICAgdmF1bHRBZGRyZXNzID0gX25ld1ZhdWx0QWRkcmVzczsKICAgIH0KCn0KCi8qKgogKiBAdGl0bGUgRVJDMjAKICogQGRldiBBIHN0YW5kYXJkIGludGVyZmFjZSBmb3IgdG9rZW5zLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvbWFzdGVyL0VJUFMvZWlwLTIwLXRva2VuLXN0YW5kYXJkLm1kCiAqLwpjb250cmFjdCBFUkMyMCB7CiAgCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSB0b3RhbCB0b2tlbiBzdXBwbHkKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsKCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBhY2NvdW50IGJhbGFuY2Ugb2YgdGhlIGFjY291bnQgd2l0aCBhZGRyZXNzIF9vd25lcgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgX3ZhbHVlIG51bWJlciBvZiB0b2tlbnMgdG8gYWRkcmVzcyBfdG8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBkZXYgVHJhbnNmZXJzIF92YWx1ZSBudW1iZXIgb2YgdG9rZW5zIGZyb20gYWRkcmVzcyBfZnJvbSB0byBhZGRyZXNzIF90bwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBkZXYgQWxsb3dzIF9zcGVuZGVyIHRvIHdpdGhkcmF3IGZyb20gdGhlIG1zZy5zZW5kZXIncyBhY2NvdW50IHVwIHRvIHRoZSBfdmFsdWUgYW1vdW50CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBhbW91bnQgd2hpY2ggX3NwZW5kZXIgaXMgc3RpbGwgYWxsb3dlZCB0byB3aXRoZHJhdyBmcm9tIF9vd25lcgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cgp9'.
	

]
