Class {
	#name : #SRT0ef4cb562b0ce673a9fc960e7c5743157544cbee,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT0ef4cb562b0ce673a9fc960e7c5743157544cbee >> base64 [
	^ 'LyoqCiAqIFNhZmUgdW5zaWduZWQgc2FmZSBtYXRoLgogKgogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQogKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbAogKgogKiBNYWludGFpbmVkIGhlcmUgdW50aWwgbWVyZ2VkIHRvIG1haW5saW5lIHplcHBlbGluLXNvbGlkaXR5LgogKgogKi8KbGlicmFyeSBTYWZlTWF0aExpYiB7CgogIGZ1bmN0aW9uIHRpbWVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1pbnVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEgJiYgYz49Yik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGFzc2VydChib29sIGFzc2VydGlvbikgcHJpdmF0ZSB7CiAgICBpZiAoIWFzc2VydGlvbikgdGhyb3c7CiAgfQp9CgoKCgovKgogKiBPd25hYmxlCiAqCiAqIEJhc2UgY29udHJhY3Qgd2l0aCBhbiBvd25lci4KICogUHJvdmlkZXMgb25seU93bmVyIG1vZGlmaWVyLCB3aGljaCBwcmV2ZW50cyBmdW5jdGlvbiBmcm9tIHJ1bm5pbmcgaWYgaXQgaXMgY2FsbGVkIGJ5IGFueW9uZSBvdGhlciB0aGFuIHRoZSBvd25lci4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKCi8qCiAqIEhhbHRhYmxlCiAqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqCiAqIE9yaWdpbmFsbHkgZW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4KICovCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgewogIGJvb2wgcHVibGljIGhhbHRlZDsKCiAgbW9kaWZpZXIgc3RvcEluRW1lcmdlbmN5IHsKICAgIGlmIChoYWx0ZWQpIHRocm93OwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KCiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgfQoKICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVuZCBvZiBlbWVyZ2VuY3ksIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgZnVuY3Rpb24gdW5oYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBoYWx0ZWQgPSBmYWxzZTsKICB9Cgp9CgoKLyoqCiAqIEludGVyZmFjZSBmb3IgZGVmaW5pbmcgY3Jvd2RzYWxlIHByaWNpbmcuCiAqLwpjb250cmFjdCBQcmljaW5nU3RyYXRlZ3kgewoKICAvKiogSW50ZXJmYWNlIGRlY2xhcmF0aW9uLiAqLwogIGZ1bmN0aW9uIGlzUHJpY2luZ1N0cmF0ZWd5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqIFNlbGYgY2hlY2sgaWYgYWxsIHJlZmVyZW5jZXMgYXJlIGNvcnJlY3RseSBzZXQuCiAgICoKICAgKiBDaGVja3MgdGhhdCBwcmljaW5nIHN0cmF0ZWd5IG1hdGNoZXMgY3Jvd2RzYWxlIHBhcmFtZXRlcnMuCiAgICovCiAgZnVuY3Rpb24gaXNTYW5lKGFkZHJlc3MgY3Jvd2RzYWxlKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0LgogICAqCiAgICoKICAgKiBAcGFyYW0gdmFsdWUgLSBXaGF0IGlzIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkKICAgKiBAcGFyYW0gdG9rZW5zU29sZCAtIGhvdyBtdWNoIHRva2VucyBoYXZlIGJlZW4gc29sZCB0aGlzIGZhcgogICAqIEBwYXJhbSB3ZWlSYWlzZWQgLSBob3cgbXVjaCBtb25leSBoYXMgYmVlbiByYWlzZWQgdGhpcyBmYXIKICAgKiBAcGFyYW0gbXNnU2VuZGVyIC0gd2hvIGlzIHRoZSBpbnZlc3RvciBvZiB0aGlzIHRyYW5zYWN0aW9uCiAgICogQHBhcmFtIGRlY2ltYWxzIC0gaG93IG1hbnkgZGVjaW1hbCB1bml0cyB0aGUgdG9rZW4gaGFzCiAgICogQHJldHVybiBBbW91bnQgb2YgdG9rZW5zIHRoZSBpbnZlc3RvciByZWNlaXZlcwogICAqLwogIGZ1bmN0aW9uIGNhbGN1bGF0ZVByaWNlKHVpbnQgdmFsdWUsIHVpbnQgdG9rZW5zU29sZCwgdWludCB3ZWlSYWlzZWQsIGFkZHJlc3MgbXNnU2VuZGVyLCB1aW50IGRlY2ltYWxzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCB0b2tlbkFtb3VudCk7Cn0KCgovKioKICogRmluYWxpemUgYWdlbnQgZGVmaW5lcyB3aGF0IGhhcHBlbnMgYXQgdGhlIGVuZCBvZiBzdWNjZXNlZnVsIGNyb3dkc2FsZS4KICoKICogLSBBbGxvY2F0ZSB0b2tlbnMgZm9yIGZvdW5kZXJzLCBib3VudGllcyBhbmQgY29tbXVuaXR5CiAqIC0gTWFrZSB0b2tlbnMgdHJhbnNmZXJhYmxlCiAqIC0gZXRjLgogKi8KY29udHJhY3QgRmluYWxpemVBZ2VudCB7CgogIGZ1bmN0aW9uIGlzRmluYWxpemVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqIFJldHVybiB0cnVlIGlmIHdlIGNhbiBydW4gZmluYWxpemVDcm93ZHNhbGUoKSBwcm9wZXJseS4KICAgKgogICAqIFRoaXMgaXMgYSBzYWZldHkgY2hlY2sgZnVuY3Rpb24gdGhhdCBkb2Vzbid0IGFsbG93IGNyb3dkc2FsZSB0byBiZWdpbgogICAqIHVubGVzcyB0aGUgZmluYWxpemVyIGhhcyBiZWVuIHNldCB1cCBwcm9wZXJseS4KICAgKi8KICBmdW5jdGlvbiBpc1NhbmUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCk7CgogIC8qKiBDYWxsZWQgb25jZSBieSBjcm93ZHNhbGUgZmluYWxpemUoKSBpZiB0aGUgc2FsZSB3YXMgc3VjY2Vzcy4gKi8KICBmdW5jdGlvbiBmaW5hbGl6ZUNyb3dkc2FsZSgpOwoKfQoKCgoKLyoKICogRVJDMjAgaW50ZXJmYWNlCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIHsKICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCgovKioKICogQSB0b2tlbiB0aGF0IGRlZmluZXMgZnJhY3Rpb25hbCB1bml0cyBhcyBkZWNpbWFscy4KICovCmNvbnRyYWN0IEZyYWN0aW9uYWxFUkMyMCBpcyBFUkMyMCB7CgogIHVpbnQgcHVibGljIGRlY2ltYWxzOwoKfQoKCgovKioKICogQWJzdHJhY3QgYmFzZSBjb250cmFjdCBmb3IgdG9rZW4gc2FsZXMuCiAqCiAqIEhhbmRsZQogKiAtIHN0YXJ0IGFuZCBlbmQgZGF0ZXMKICogLSBhY2NlcHRpbmcgaW52ZXN0bWVudHMKICogLSBtaW5pbXVtIGZ1bmRpbmcgZ29hbCBhbmQgcmVmdW5kCiAqIC0gdmFyaW91cyBzdGF0aXN0aWNzIGR1cmluZyB0aGUgY3Jvd2RmdW5kCiAqIC0gZGlmZmVyZW50IHByaWNpbmcgc3RyYXRlZ2llcwogKiAtIGRpZmZlcmVudCBpbnZlc3RtZW50IHBvbGljaWVzIChyZXF1aXJlIHNlcnZlciBzaWRlIGN1c3RvbWVyIGlkLCBhbGxvdyBvbmx5IHdoaXRlbGlzdGVkIGFkZHJlc3NlcykKICoKICovCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBIYWx0YWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50OwoKICAvKiBUaGUgdG9rZW4gd2UgYXJlIHNlbGxpbmcgKi8KICBGcmFjdGlvbmFsRVJDMjAgcHVibGljIHRva2VuOwoKICAvKiBIb3cgd2UgYXJlIGdvaW5nIHRvIHByaWNlIG91ciBvZmZlcmluZyAqLwogIFByaWNpbmdTdHJhdGVneSBwdWJsaWMgcHJpY2luZ1N0cmF0ZWd5OwoKICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50OwoKICAvKiB0b2tlbnMgd2lsbCBiZSB0cmFuc2ZlcmVkIGZyb20gdGhpcyBhZGRyZXNzICovCiAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWdXYWxsZXQ7CgogIC8qIGlmIHRoZSBmdW5kaW5nIGdvYWwgaXMgbm90IHJlYWNoZWQsIGludmVzdG9ycyBtYXkgd2l0aGRyYXcgdGhlaXIgZnVuZHMgKi8KICB1aW50IHB1YmxpYyBtaW5pbXVtRnVuZGluZ0dvYWw7CgogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBzdGFydHNBdDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIGVuZCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBlbmRzQXQ7CgogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLwogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOwoKICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLwogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CgogIC8qIEhvdyBtdWNoIHdlaSB3ZSBoYXZlIHJldHVybmVkIGJhY2sgdG8gdGhlIGNvbnRyYWN0IGFmdGVyIGEgZmFpbGVkIGNyb3dkZnVuZC4gKi8KICB1aW50IHB1YmxpYyBsb2FkZWRSZWZ1bmQgPSAwOwoKICAvKiBIb3cgbXVjaCB3ZWkgd2UgaGF2ZSBnaXZlbiBiYWNrIHRvIGludmVzdG9ycy4qLwogIHVpbnQgcHVibGljIHdlaVJlZnVuZGVkID0gMDsKCiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOwoKICAvKiBEbyB3ZSBuZWVkIHRvIGhhdmUgdW5pcXVlIGNvbnRyaWJ1dG9yIGlkIGZvciBlYWNoIGN1c3RvbWVyICovCiAgYm9vbCBwdWJsaWMgcmVxdWlyZUN1c3RvbWVySWQ7CgogIC8qKgogICAgKiBEbyB3ZSB2ZXJpZnkgdGhhdCBjb250cmlidXRvciBoYXMgYmVlbiBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWNjcmVkaXRlZCBpbnZlc3RvcnMgb25seSkuCiAgICAqIFRoaXMgbWV0aG9kIHdhcyBmaXJzdCB1c2VkIGluIEZpcnN0Qmxvb2QgY3Jvd2RzYWxlIHRvIGVuc3VyZSBhbGwgY29udHJpYnV0b3JzIGhhdmUgYWNjZXB0ZWQgdGVybXMgb24gc2FsZSAob24gdGhlIHdlYikuCiAgICAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzczsKCiAgLyogU2VydmVyIHNpZGUgYWRkcmVzcyB0aGF0IHNpZ25lZCBhbGxvd2VkIGNvbnRyaWJ1dG9ycyAoRXRoZXJldW0gYWRkcmVzc2VzKSB0aGF0IGNhbiBwYXJ0aWNpcGF0ZSB0aGUgY3Jvd2RzYWxlICovCiAgYWRkcmVzcyBwdWJsaWMgc2lnbmVyQWRkcmVzczsKCiAgLyoqIEhvdyBtdWNoIEVUSCBlYWNoIGFkZHJlc3MgaGFzIGludmVzdGVkIHRvIHRoaXMgY3Jvd2RzYWxlICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsKCiAgLyoqIEhvdyBtdWNoIHRva2VucyB0aGlzIGNyb3dkc2FsZSBoYXMgY3JlZGl0ZWQgZm9yIGVhY2ggaW52ZXN0b3IgYWRkcmVzcyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7CgogIC8qKiBBZGRyZXNzZXMgdGhhdCBhcmUgYWxsb3dlZCB0byBpbnZlc3QgZXZlbiBiZWZvcmUgSUNPIG9mZmljYWwgb3BlbnMuIEZvciB0ZXN0aW5nLCBmb3IgSUNPIHBhcnRuZXJzLCBldGMuICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdDsKCiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVsIHRlc3RpbmcgZm9yIHRoZSBpbnRlcmFjdGlvbiBmcm9tIG93bmVyIHdhbGxldC4gWW91IGNhbiBzZXQgaXQgdG8gYW55IHZhbHVlIGFuZCBpbnNwZWN0IHRoaXMgaW4gYmxvY2tjaGFpbiBleHBsb3JlciB0byBzZWUgdGhhdCBjcm93ZHNhbGUgaW50ZXJhY3Rpb24gd29ya3MuICovCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7CgogIC8qKiBTdGF0ZSBtYWNoaW5lCiAgICoKICAgKiAtIFByZXBhcmluZzogQWxsIGNvbnRyYWN0IGluaXRpYWxpemF0aW9uIGNhbGxzIGFuZCB2YXJpYWJsZXMgaGF2ZSBub3QgYmVlbiBzZXQgeWV0CiAgICogLSBQcmVmdW5kaW5nOiBXZSBoYXZlIG5vdCBwYXNzZWQgc3RhcnQgdGltZSB5ZXQKICAgKiAtIEZ1bmRpbmc6IEFjdGl2ZSBjcm93ZHNhbGUKICAgKiAtIFN1Y2Nlc3M6IE1pbmltdW0gZnVuZGluZyBnb2FsIHJlYWNoZWQKICAgKiAtIEZhaWx1cmU6IE1pbmltdW0gZnVuZGluZyBnb2FsIG5vdCByZWFjaGVkIGJlZm9yZSBlbmRpbmcgdGltZQogICAqIC0gRmluYWxpemVkOiBUaGUgZmluYWxpemVkIGhhcyBiZWVuIGNhbGxlZCBhbmQgc3VjY2VzZnVsbHkgZXhlY3V0ZWQKICAgKiAtIFJlZnVuZGluZzogUmVmdW5kcyBhcmUgbG9hZGVkIG9uIHRoZSBjb250cmFjdCBmb3IgcmVjbGFpbS4KICAgKi8KICBlbnVtIFN0YXRle1Vua25vd24sIFByZXBhcmluZywgUHJlRnVuZGluZywgRnVuZGluZywgU3VjY2VzcywgRmFpbHVyZSwgRmluYWxpemVkLCBSZWZ1bmRpbmd9CgogIC8vIEEgbmV3IGludmVzdG1lbnQgd2FzIG1hZGUKICBldmVudCBJbnZlc3RlZChhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCwgdWludDEyOCBjdXN0b21lcklkKTsKCiAgLy8gUmVmdW5kIHdhcyBwcm9jZXNzZWQgZm9yIGEgY29udHJpYnV0b3IKICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOwoKICAvLyBUaGUgcnVsZXMgd2VyZSBjaGFuZ2VkIHdoYXQga2luZCBvZiBpbnZlc3RtZW50cyB3ZSBhY2NlcHQKICBldmVudCBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChib29sIHJlcXVpcmVDdXN0b21lcklkLCBib29sIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgYWRkcmVzcyBzaWduZXJBZGRyZXNzKTsKCiAgLy8gQWRkcmVzcyBlYXJseSBwYXJ0aWNpcGF0aW9uIHdoaXRlbGlzdCBzdGF0dXMgY2hhbmdlZAogIGV2ZW50IFdoaXRlbGlzdGVkKGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpOwoKICAvLyBDcm93ZHNhbGUgZW5kIHRpbWUgaGFzIGJlZW4gY2hhbmdlZAogIGV2ZW50IEVuZHNBdENoYW5nZWQodWludCBlbmRzQXQpOwoKICBmdW5jdGlvbiBDcm93ZHNhbGUoYWRkcmVzcyBfdG9rZW4sIFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5LCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2VuZCwgdWludCBfbWluaW11bUZ1bmRpbmdHb2FsKSB7CgogICAgb3duZXIgPSBtc2cuc2VuZGVyOwoKICAgIHRva2VuID0gRnJhY3Rpb25hbEVSQzIwKF90b2tlbik7CgogICAgc2V0UHJpY2luZ1N0cmF0ZWd5KF9wcmljaW5nU3RyYXRlZ3kpOwoKICAgIG11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0OwogICAgaWYobXVsdGlzaWdXYWxsZXQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIGlmKF9zdGFydCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgc3RhcnRzQXQgPSBfc3RhcnQ7CgogICAgaWYoX2VuZCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgZW5kc0F0ID0gX2VuZDsKCiAgICAvLyBEb24ndCBtZXNzIHRoZSBkYXRlcwogICAgaWYoc3RhcnRzQXQgPj0gZW5kc0F0KSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gTWluaW11bSBmdW5kaW5nIGdvYWwgY2FuIGJlIHplcm8KICAgIG1pbmltdW1GdW5kaW5nR29hbCA9IF9taW5pbXVtRnVuZGluZ0dvYWw7CiAgfQoKICAvKioKICAgKiBEb24ndCBleHBlY3QgdG8ganVzdCBzZW5kIGluIG1vbmV5IGFuZCBnZXQgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICB0aHJvdzsKICB9CgogIC8qKgogICAqIE1ha2UgYW4gaW52ZXN0bWVudC4KICAgKgogICAqIENyb3dkc2FsZSBtdXN0IGJlIHJ1bm5pbmcgZm9yIG9uZSB0byBpbnZlc3QuCiAgICogV2UgbXVzdCBoYXZlIG5vdCBwcmVzc2VkIHRoZSBlbWVyZ2VuY3kgYnJha2UuCiAgICoKICAgKiBAcGFyYW0gcmVjZWl2ZXIgVGhlIEV0aGVyZXVtIGFkZHJlc3Mgd2hvIHJlY2VpdmVzIHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gY3VzdG9tZXJJZCAob3B0aW9uYWwpIFVVSUQgdjQgdG8gdHJhY2sgdGhlIHN1Y2Nlc3NmdWwgcGF5bWVudHMgb24gdGhlIHNlcnZlciBzaWRlCiAgICoKICAgKi8KICBmdW5jdGlvbiBpbnZlc3RJbnRlcm5hbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50MTI4IGN1c3RvbWVySWQpIHN0b3BJbkVtZXJnZW5jeSBwcml2YXRlIHsKCiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgewogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQKICAgICAgaWYoIWVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbcmVjZWl2ZXJdKSB7CiAgICAgICAgdGhyb3c7CiAgICAgIH0KICAgIH0gZWxzZSBpZihnZXRTdGF0ZSgpID09IFN0YXRlLkZ1bmRpbmcpIHsKICAgICAgLy8gUmV0YWlsIHBhcnRpY2lwYW50cyBjYW4gb25seSBjb21lIGluIHdoZW4gdGhlIGNyb3dkc2FsZSBpcyBydW5uaW5nCiAgICAgIC8vIHBhc3MKICAgIH0gZWxzZSB7CiAgICAgIC8vIFVud2FudGVkIHN0YXRlCiAgICAgIHRocm93OwogICAgfQoKICAgIHVpbnQgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwogICAgdWludCB0b2tlbkFtb3VudCA9IHByaWNpbmdTdHJhdGVneS5jYWxjdWxhdGVQcmljZSh3ZWlBbW91bnQsIHdlaVJhaXNlZCwgdG9rZW5zU29sZCwgbXNnLnNlbmRlciwgdG9rZW4uZGVjaW1hbHMoKSk7CgogICAgaWYodG9rZW5BbW91bnQgPT0gMCkgewogICAgICAvLyBEdXN0IHRyYW5zYWN0aW9uCiAgICAgIHRocm93OwogICAgfQoKICAgIGlmKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsKICAgICAgIC8vIEEgbmV3IGludmVzdG9yCiAgICAgICBpbnZlc3RvckNvdW50Kys7CiAgICB9CgogICAgLy8gVXBkYXRlIGludmVzdG9yCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7CgogICAgLy8gVXBkYXRlIHRvdGFscwogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOwoKICAgIC8vIENoZWNrIHRoYXQgd2UgZGlkIG5vdCBidXN0IHRoZSBjYXAKICAgIGlmKGlzQnJlYWtpbmdDYXAodG9rZW5BbW91bnQsIHdlaUFtb3VudCwgd2VpUmFpc2VkLCB0b2tlbnNTb2xkKSkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKCiAgICAvLyBQb2NrZXQgdGhlIG1vbmV5CiAgICBpZighbXVsdGlzaWdXYWxsZXQuc2VuZCh3ZWlBbW91bnQpKSB0aHJvdzsKCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOwogIH0KCiAgLyoqCiAgICogUHJlYWxsb2NhdGUgdG9rZW5zIGZvciB0aGUgZWFybHkgaW52ZXN0b3JzLgogICAqCiAgICogUHJlYWxsb2NhdGVkIHRva2VucyBoYXZlIGJlZW4gc29sZCBiZWZvcmUgdGhlIGFjdHVhbCBjcm93ZHNhbGUgb3BlbnMuCiAgICogVGhpcyBmdW5jdGlvbiBtaW50cyB0aGUgdG9rZW5zIGFuZCBtb3ZlcyB0aGUgY3Jvd2RzYWxlIG5lZWRsZS4KICAgKgogICAqIEludmVzdG9yIGNvdW50IGlzIG5vdCBoYW5kbGVkOyBpdCBpcyBhc3N1bWVkIHRoaXMgZ29lcyBmb3IgbXVsdGlwbGUgaW52ZXN0b3JzCiAgICogYW5kIHRoZSB0b2tlbiBkaXN0cmlidXRpb24gaGFwcGVucyBvdXRzaWRlIHRoZSBzbWFydCBjb250cmFjdCBmbG93LgogICAqCiAgICogTm8gbW9uZXkgaXMgZXhjaGFuZ2VkLCBhcyB0aGUgY3Jvd2RzYWxlIHRlYW0gYWxyZWFkeSBoYXZlIHJlY2VpdmVkIHRoZSBwYXltZW50LgogICAqCiAgICogQHBhcmFtIGZ1bGxUb2tlbnMgdG9rZW5zIGFzIGZ1bGwgdG9rZW5zIC0gZGVjaW1hbCBwbGFjZXMgYWRkZWQgaW50ZXJuYWxseQogICAqIEBwYXJhbSB3ZWlQcmljZSBQcmljZSBvZiBhIHNpbmdsZSBmdWxsIHRva2VuIGluIHdlaQogICAqCiAgICovCiAgZnVuY3Rpb24gcHJlYWxsb2NhdGUoYWRkcmVzcyByZWNlaXZlciwgdWludCBmdWxsVG9rZW5zLCB1aW50IHdlaVByaWNlKSBwdWJsaWMgb25seU93bmVyIHsKCiAgICB1aW50IHRva2VuQW1vdW50ID0gZnVsbFRva2VucyAqIDEwKip0b2tlbi5kZWNpbWFscygpOwogICAgdWludCB3ZWlBbW91bnQgPSB3ZWlQcmljZSAqIHRva2VuQW1vdW50OyAvLyBUaGlzIGNhbiBiZSBhbHNvIDAsIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQoKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5wbHVzKHRva2VuQW1vdW50KTsKCiAgICBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9IGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gdG9rZW5BbW91bnRPZltyZWNlaXZlcl0ucGx1cyh0b2tlbkFtb3VudCk7CgogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CgogICAgLy8gVGVsbCB1cyBpbnZlc3Qgd2FzIHN1Y2Nlc3MKICAgIEludmVzdGVkKHJlY2VpdmVyLCB3ZWlBbW91bnQsIHRva2VuQW1vdW50LCAwKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGludmVzdFdpdGhTaWduZWRBZGRyZXNzKGFkZHJlc3MgYWRkciwgdWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgIGJ5dGVzMzIgaGFzaCA9IHNoYTI1NihhZGRyKTsKICAgICBpZiAoZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpICE9IHNpZ25lckFkZHJlc3MpIHRocm93OwogICAgIGlmKGN1c3RvbWVySWQgPT0gMCkgdGhyb3c7ICAvLyBVVUlEdjQgc2FuaXR5IGNoZWNrCiAgICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0V2l0aEN1c3RvbWVySWQoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQoKICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3QoYWRkcmVzcyBhZGRyKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpZihyZXF1aXJlQ3VzdG9tZXJJZCkgdGhyb3c7IC8vIENyb3dkc2FsZSBuZWVkcyB0byB0cmFjayBwYXJ0aXBhbnRzIGZvciB0aGFuayB5b3UgZW1haWwKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpbnZlc3RJbnRlcm5hbChhZGRyLCAwKTsKICB9CgogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIgYW5kIGNsZWFyIGhpcyBhZGRyZXNzLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MobXNnLnNlbmRlciwgY3VzdG9tZXJJZCwgdiwgciwgcyk7CiAgfQoKICAvKioKICAgKiBJbnZlc3QgdG8gdG9rZW5zLCByZWNvZ25pemUgdGhlIHBheWVyLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aEN1c3RvbWVySWQodWludDEyOCBjdXN0b21lcklkKSBwdWJsaWMgcGF5YWJsZSB7CiAgICBpbnZlc3RXaXRoQ3VzdG9tZXJJZChtc2cuc2VuZGVyLCBjdXN0b21lcklkKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNpYyBlbnRyeSBwb2ludCB0byBwYXJ0aWNpcGF0ZSB0aGUgY3Jvd2RzYWxlIHByb2Nlc3MuCiAgICoKICAgKiBQYXkgZm9yIGZ1bmRpbmcsIGdldCBpbnZlc3RlZCB0b2tlbnMgYmFjayBpbiB0aGUgc2VuZGVyIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gYnV5KCkgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0KG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewoKICAgIC8vIEFscmVhZHkgZmluYWxpemVkCiAgICBpZihmaW5hbGl6ZWQpIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgLy8gRmluYWxpemluZyBpcyBvcHRpb25hbC4gV2Ugb25seSBjYWxsIGl0IGlmIHdlIGFyZSBnaXZlbiBhIGZpbmFsaXppbmcgYWdlbnQuCiAgICBpZihhZGRyZXNzKGZpbmFsaXplQWdlbnQpICE9IDApIHsKICAgICAgZmluYWxpemVBZ2VudC5maW5hbGl6ZUNyb3dkc2FsZSgpOwogICAgfQoKICAgIGZpbmFsaXplZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IGZpbmFsaXplIGFnZW50LgogICAqCiAgICogRGVzaWduIGNob2ljZTogbm8gc3RhdGUgcmVzdHJpY3Rpb25zIG9uIHNldHRpbmcgdGhpcywgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0RmluYWxpemVBZ2VudChGaW5hbGl6ZUFnZW50IGFkZHIpIG9ubHlPd25lciB7CiAgICBmaW5hbGl6ZUFnZW50ID0gYWRkcjsKCiAgICAvLyBEb24ndCBhbGxvdyBzZXR0aW5nIGJhZCBhZ2VudAogICAgaWYoIWZpbmFsaXplQWdlbnQuaXNGaW5hbGl6ZUFnZW50KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIG9ubHlPd25lciB7CiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQoKICAvKioKICAgKiBTZXQgcG9saWN5IGlmIGFsbCBpbnZlc3RvcnMgbXVzdCBiZSBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSBmaXJzdC4KICAgKgogICAqIFRoaXMgaXMgZS5nLiBmb3IgdGhlIGFjY3JlZGl0ZWQgaW52ZXN0b3IgY2xlYXJpbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRSZXF1aXJlU2lnbmVkQWRkcmVzcyhib29sIHZhbHVlLCBhZGRyZXNzIF9zaWduZXJBZGRyZXNzKSBvbmx5T3duZXIgewogICAgcmVxdWlyZWRTaWduZWRBZGRyZXNzID0gdmFsdWU7CiAgICBzaWduZXJBZGRyZXNzID0gX3NpZ25lckFkZHJlc3M7CiAgICBJbnZlc3RtZW50UG9saWN5Q2hhbmdlZChyZXF1aXJlQ3VzdG9tZXJJZCwgcmVxdWlyZWRTaWduZWRBZGRyZXNzLCBzaWduZXJBZGRyZXNzKTsKICB9CgogIC8qKgogICAqIEFsbG93IGFkZHJlc3NlcyB0byBkbyBlYXJseSBwYXJ0aWNpcGF0aW9uLgogICAqCiAgICogVE9ETzogRml4IHNwZWxsaW5nIGVycm9yIGluIHRoZSBuYW1lCiAgICovCiAgZnVuY3Rpb24gc2V0RWFybHlQYXJpY2lwYW50V2hpdGVsaXN0KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0dXMpIG9ubHlPd25lciB7CiAgICBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W2FkZHJdID0gc3RhdHVzOwogICAgV2hpdGVsaXN0ZWQoYWRkciwgc3RhdHVzKTsKICB9CgogIC8qKgogICAqIEFsbG93IGNyb3dkc2FsZSBvd25lciB0byBjbG9zZSBlYXJseSBvciBleHRlbmQgdGhlIGNyb3dkc2FsZS4KICAgKgogICAqIFRoaXMgaXMgdXNlZnVsIGUuZy4gZm9yIGEgbWFudWFsIHNvZnQgY2FwIGltcGxlbWVudGF0aW9uOgogICAqIC0gYWZ0ZXIgWCBhbW91bnQgaXMgcmVhY2hlZCBkZXRlcm1pbmUgbWFudWFsIGNsb3NpbmcKICAgKgogICAqIFRoaXMgbWF5IHB1dCB0aGUgY3Jvd2RzYWxlIHRvIGFuIGludmFsaWQgc3RhdGUsCiAgICogYnV0IHdlIHRydXN0IG93bmVycyBrbm93IHdoYXQgdGhleSBhcmUgZG9pbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRFbmRzQXQodWludCB0aW1lKSBvbmx5T3duZXIgewoKICAgIGlmKG5vdyA+IHRpbWUpIHsKICAgICAgdGhyb3c7IC8vIERvbid0IGNoYW5nZSBwYXN0CiAgICB9CgogICAgZW5kc0F0ID0gdGltZTsKICAgIEVuZHNBdENoYW5nZWQoZW5kc0F0KTsKICB9CgogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgcHJpY2luZyBzdHJhdGVneS4KICAgKgogICAqIERlc2lnbiBjaG9pY2U6IG5vIHN0YXRlIHJlc3RyaWN0aW9ucyBvbiB0aGUgc2V0LCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRQcmljaW5nU3RyYXRlZ3koUHJpY2luZ1N0cmF0ZWd5IF9wcmljaW5nU3RyYXRlZ3kpIG9ubHlPd25lciB7CiAgICBwcmljaW5nU3RyYXRlZ3kgPSBfcHJpY2luZ1N0cmF0ZWd5OwoKICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50CiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQoKICAvKioKICAgKiBBbGxvdyBsb2FkIHJlZnVuZHMgYmFjayBvbiB0aGUgY29udHJhY3QgZm9yIHRoZSByZWZ1bmRpbmcuCiAgICoKICAgKiBUaGUgdGVhbSBjYW4gdHJhbnNmZXIgdGhlIGZ1bmRzIGJhY2sgb24gdGhlIHNtYXJ0IGNvbnRyYWN0IGluIHRoZSBjYXNlIHRoZSBtaW5pbXVtIGdvYWwgd2FzIG5vdCByZWFjaGVkLi4KICAgKi8KICBmdW5jdGlvbiBsb2FkUmVmdW5kKCkgcHVibGljIHBheWFibGUgaW5TdGF0ZShTdGF0ZS5GYWlsdXJlKSB7CiAgICBpZihtc2cudmFsdWUgPT0gMCkgdGhyb3c7CiAgICBsb2FkZWRSZWZ1bmQgPSBsb2FkZWRSZWZ1bmQucGx1cyhtc2cudmFsdWUpOwogIH0KCiAgLyoqCiAgICogSW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmQuCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7CiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsKICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsKICAgIGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl0gPSAwOwogICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5wbHVzKHdlaVZhbHVlKTsKICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7CiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlWYWx1ZSkpIHRocm93OwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaGFzIHJhaXNlZCBlbm91Z2ggbW9uZXkgdG8gYmUgYSBzdWNjZXMKICAgKi8KICBmdW5jdGlvbiBpc01pbmltdW1Hb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHJlYWNoZWQpIHsKICAgIHJldHVybiB3ZWlSYWlzZWQgPj0gbWluaW11bUZ1bmRpbmdHb2FsOwogIH0KCiAgLyoqCiAgICogQ3Jvd2RmdW5kIHN0YXRlIG1hY2hpbmUgbWFuYWdlbWVudC4KICAgKgogICAqIFdlIG1ha2UgaXQgYSBmdW5jdGlvbiBhbmQgZG8gbm90IGFzc2lnbiB0aGUgcmVzdWx0IHRvIGEgdmFyaWFibGUsIHNvIHRoZXJlIGlzIG5vIGNoYW5jZSBvZiB0aGUgdmFyaWFibGUgYmVpbmcgc3RhbGUuCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpIHsKICAgIGlmKGZpbmFsaXplZCkgcmV0dXJuIFN0YXRlLkZpbmFsaXplZDsKICAgIGVsc2UgaWYgKGFkZHJlc3MoZmluYWxpemVBZ2VudCkgPT0gMCkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKCFmaW5hbGl6ZUFnZW50LmlzU2FuZSgpKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIXByaWNpbmdTdHJhdGVneS5pc1NhbmUoYWRkcmVzcyh0aGlzKSkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPCBzdGFydHNBdCkgcmV0dXJuIFN0YXRlLlByZUZ1bmRpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmICFpc0Nyb3dkc2FsZUZ1bGwoKSkgcmV0dXJuIFN0YXRlLkZ1bmRpbmc7CiAgICBlbHNlIGlmIChpc01pbmltdW1Hb2FsUmVhY2hlZCgpKSByZXR1cm4gU3RhdGUuU3VjY2VzczsKICAgIGVsc2UgaWYgKCFpc01pbmltdW1Hb2FsUmVhY2hlZCgpICYmIHdlaVJhaXNlZCA+IDAgJiYgbG9hZGVkUmVmdW5kID49IHdlaVJhaXNlZCkgcmV0dXJuIFN0YXRlLlJlZnVuZGluZzsKICAgIGVsc2UgcmV0dXJuIFN0YXRlLkZhaWx1cmU7CiAgfQoKICAvKiogVGhpcyBpcyBmb3IgbWFudWFsIHRlc3Rpbmcgb2YgbXVsdGlzaWcgd2FsbGV0IGludGVyYWN0aW9uICovCiAgZnVuY3Rpb24gc2V0T3duZXJUZXN0VmFsdWUodWludCB2YWwpIG9ubHlPd25lciB7CiAgICBvd25lclRlc3RWYWx1ZSA9IHZhbDsKICB9CgogIC8vCiAgLy8gTW9kaWZpZXJzCiAgLy8KCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLwogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93OwogICAgXzsKICB9CgoKICAvLwogIC8vIEFic3RyYWN0IGZ1bmN0aW9ucwogIC8vCgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLgogICAqCiAgICoKICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLgogICAqIFdlIGFsbG93IGEgbG90IG9mIGZsZXhpYmlsaXR5IHRocm91Z2ggZGlmZmVyZW50IGNhcHBpbmcgc3RyYXRlZ2llcyAoRVRILCB0b2tlbiBjb3VudCkKICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4KICAgKgogICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdGhlIGludmVzdG9yIHRyaWVzIHRvIGludmVzdCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcwogICAqLwogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKCiAgLyoqCiAgICogQ3JlYXRlIG5ldyB0b2tlbnMgb3IgdHJhbnNmZXIgaXNzdWVkIHRva2VucyB0byB0aGUgaW52ZXN0b3IgZGVwZW5kaW5nIG9uIHRoZSBjYXAgbW9kZWwuCiAgICovCiAgZnVuY3Rpb24gYXNzaWduVG9rZW5zKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgdG9rZW5BbW91bnQpIHByaXZhdGU7Cn0KCgoKCgoKCi8qKgogKiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzCiAqLwpjb250cmFjdCBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gc2FmZU11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA+IDApOwogICAgdWludCBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc2FmZVN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICsgYjsKICAgIGFzc2VydChjPj1hICYmIGM+PWIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBtYXg2NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluNjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWF4MjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW4yNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gYXNzZXJ0KGJvb2wgYXNzZXJ0aW9uKSBpbnRlcm5hbCB7CiAgICBpZiAoIWFzc2VydGlvbikgewogICAgICB0aHJvdzsKICAgIH0KICB9Cn0KCgoKLyoqCiAqIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGggewoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IHNhZmVBZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzYWZlU3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIGlmIChfdmFsdWUgPiBfYWxsb3dhbmNlKSB0aHJvdzsKCiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0sIF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKCgoKCi8qKgogKiBVcGdyYWRlIGFnZW50IGludGVyZmFjZSBpbnNwaXJlZCBieSBMdW55ci4KICoKICogVXBncmFkZSBhZ2VudCB0cmFuc2ZlcnMgdG9rZW5zIHRvIGEgbmV3IGNvbnRyYWN0LgogKiBVcGdyYWRlIGFnZW50IGl0c2VsZiBjYW4gYmUgdGhlIHRva2VuIGNvbnRyYWN0LCBvciBqdXN0IGEgbWlkZGxlIG1hbiBjb250cmFjdCBkb2luZyB0aGUgaGVhdnkgbGlmdGluZy4KICovCmNvbnRyYWN0IFVwZ3JhZGVBZ2VudCB7CgogIHVpbnQgcHVibGljIG9yaWdpbmFsU3VwcGx5OwoKICAvKiogSW50ZXJmYWNlIG1hcmtlciAqLwogIGZ1bmN0aW9uIGlzVXBncmFkZUFnZW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gdXBncmFkZUZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYzsKCn0KCgovKioKICogQSB0b2tlbiB1cGdyYWRlIG1lY2hhbmlzbSB3aGVyZSB1c2VycyBjYW4gb3B0LWluIGFtb3VudCBvZiB0b2tlbnMgdG8gdGhlIG5leHQgc21hcnQgY29udHJhY3QgcmV2aXNpb24uCiAqCiAqIEZpcnN0IGVudmlzaW9uZWQgYnkgR29sZW0gYW5kIEx1bnlyIHByb2plY3RzLgogKi8KY29udHJhY3QgVXBncmFkZWFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuIHsKCiAgLyoqIENvbnRyYWN0IC8gcGVyc29uIHdobyBjYW4gc2V0IHRoZSB1cGdyYWRlIHBhdGguIFRoaXMgY2FuIGJlIHRoZSBzYW1lIGFzIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBhcyB3aGF0IGl0IGlzIHdpdGggaXRzIGRlZmF1bHQgdmFsdWUuICovCiAgYWRkcmVzcyBwdWJsaWMgdXBncmFkZU1hc3RlcjsKCiAgLyoqIFRoZSBuZXh0IGNvbnRyYWN0IHdoZXJlIHRoZSB0b2tlbnMgd2lsbCBiZSBtaWdyYXRlZC4gKi8KICBVcGdyYWRlQWdlbnQgcHVibGljIHVwZ3JhZGVBZ2VudDsKCiAgLyoqIEhvdyBtYW55IHRva2VucyB3ZSBoYXZlIHVwZ3JhZGVkIGJ5IG5vdy4gKi8KICB1aW50MjU2IHB1YmxpYyB0b3RhbFVwZ3JhZGVkOwoKICAvKioKICAgKiBVcGdyYWRlIHN0YXRlcy4KICAgKgogICAqIC0gTm90QWxsb3dlZDogVGhlIGNoaWxkIGNvbnRyYWN0IGhhcyBub3QgcmVhY2hlZCBhIGNvbmRpdGlvbiB3aGVyZSB0aGUgdXBncmFkZSBjYW4gYmd1bgogICAqIC0gV2FpdGluZ0ZvckFnZW50OiBUb2tlbiBhbGxvd3MgdXBncmFkZSwgYnV0IHdlIGRvbid0IGhhdmUgYSBuZXcgYWdlbnQgeWV0CiAgICogLSBSZWFkeVRvVXBncmFkZTogVGhlIGFnZW50IGlzIHNldCwgYnV0IG5vdCBhIHNpbmdsZSB0b2tlbiBoYXMgYmVlbiB1cGdyYWRlZCB5ZXQKICAgKiAtIFVwZ3JhZGluZzogVXBncmFkZSBhZ2VudCBpcyBzZXQgYW5kIHRoZSBiYWxhbmNlIGhvbGRlcnMgY2FuIHVwZ3JhZGUgdGhlaXIgdG9rZW5zCiAgICoKICAgKi8KICBlbnVtIFVwZ3JhZGVTdGF0ZSB7VW5rbm93biwgTm90QWxsb3dlZCwgV2FpdGluZ0ZvckFnZW50LCBSZWFkeVRvVXBncmFkZSwgVXBncmFkaW5nfQoKICAvKioKICAgKiBTb21lYm9keSBoYXMgdXBncmFkZWQgc29tZSBvZiBoaXMgdG9rZW5zLgogICAqLwogIGV2ZW50IFVwZ3JhZGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CgogIC8qKgogICAqIE5ldyB1cGdyYWRlIGFnZW50IGF2YWlsYWJsZS4KICAgKi8KICBldmVudCBVcGdyYWRlQWdlbnRTZXQoYWRkcmVzcyBhZ2VudCk7CgogIC8qKgogICAqIERvIG5vdCBhbGxvdyBjb25zdHJ1Y3Rpb24gd2l0aG91dCB1cGdyYWRlIG1hc3RlciBzZXQuCiAgICovCiAgZnVuY3Rpb24gVXBncmFkZWFibGVUb2tlbihhZGRyZXNzIF91cGdyYWRlTWFzdGVyKSB7CiAgICB1cGdyYWRlTWFzdGVyID0gX3VwZ3JhZGVNYXN0ZXI7CiAgfQoKICAvKioKICAgKiBBbGxvdyB0aGUgdG9rZW4gaG9sZGVyIHRvIHVwZ3JhZGUgc29tZSBvZiB0aGVpciB0b2tlbnMgdG8gYSBuZXcgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gdXBncmFkZSh1aW50MjU2IHZhbHVlKSBwdWJsaWMgewoKICAgICAgVXBncmFkZVN0YXRlIHN0YXRlID0gZ2V0VXBncmFkZVN0YXRlKCk7CiAgICAgIGlmKCEoc3RhdGUgPT0gVXBncmFkZVN0YXRlLlJlYWR5VG9VcGdyYWRlIHx8IHN0YXRlID09IFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmcpKSB7CiAgICAgICAgLy8gQ2FsbGVkIGluIGEgYmFkIHN0YXRlCiAgICAgICAgdGhyb3c7CiAgICAgIH0KCiAgICAgIC8vIFZhbGlkYXRlIGlucHV0IHZhbHVlLgogICAgICBpZiAodmFsdWUgPT0gMCkgdGhyb3c7CgogICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIHZhbHVlKTsKCiAgICAgIC8vIFRha2UgdG9rZW5zIG91dCBmcm9tIGNpcmN1bGF0aW9uCiAgICAgIHRvdGFsU3VwcGx5ID0gc2FmZVN1Yih0b3RhbFN1cHBseSwgdmFsdWUpOwogICAgICB0b3RhbFVwZ3JhZGVkID0gc2FmZUFkZCh0b3RhbFVwZ3JhZGVkLCB2YWx1ZSk7CgogICAgICAvLyBVcGdyYWRlIGFnZW50IHJlaXNzdWVzIHRoZSB0b2tlbnMKICAgICAgdXBncmFkZUFnZW50LnVwZ3JhZGVGcm9tKG1zZy5zZW5kZXIsIHZhbHVlKTsKICAgICAgVXBncmFkZShtc2cuc2VuZGVyLCB1cGdyYWRlQWdlbnQsIHZhbHVlKTsKICB9CgogIC8qKgogICAqIFNldCBhbiB1cGdyYWRlIGFnZW50IHRoYXQgaGFuZGxlcwogICAqLwogIGZ1bmN0aW9uIHNldFVwZ3JhZGVBZ2VudChhZGRyZXNzIGFnZW50KSBleHRlcm5hbCB7CgogICAgICBpZighY2FuVXBncmFkZSgpKSB7CiAgICAgICAgLy8gVGhlIHRva2VuIGlzIG5vdCB5ZXQgaW4gYSBzdGF0ZSB0aGF0IHdlIGNvdWxkIHRoaW5rIHVwZ3JhZGluZwogICAgICAgIHRocm93OwogICAgICB9CgogICAgICBpZiAoYWdlbnQgPT0gMHgwKSB0aHJvdzsKICAgICAgLy8gT25seSBhIG1hc3RlciBjYW4gZGVzaWduYXRlIHRoZSBuZXh0IGFnZW50CiAgICAgIGlmIChtc2cuc2VuZGVyICE9IHVwZ3JhZGVNYXN0ZXIpIHRocm93OwogICAgICAvLyBVcGdyYWRlIGhhcyBhbHJlYWR5IGJlZ3VuIGZvciBhbiBhZ2VudAogICAgICBpZiAoZ2V0VXBncmFkZVN0YXRlKCkgPT0gVXBncmFkZVN0YXRlLlVwZ3JhZGluZykgdGhyb3c7CgogICAgICB1cGdyYWRlQWdlbnQgPSBVcGdyYWRlQWdlbnQoYWdlbnQpOwoKICAgICAgLy8gQmFkIGludGVyZmFjZQogICAgICBpZighdXBncmFkZUFnZW50LmlzVXBncmFkZUFnZW50KCkpIHRocm93OwogICAgICAvLyBNYWtlIHN1cmUgdGhhdCB0b2tlbiBzdXBwbGllcyBtYXRjaCBpbiBzb3VyY2UgYW5kIHRhcmdldAogICAgICBpZiAodXBncmFkZUFnZW50Lm9yaWdpbmFsU3VwcGx5KCkgIT0gdG90YWxTdXBwbHkpIHRocm93OwoKICAgICAgVXBncmFkZUFnZW50U2V0KHVwZ3JhZGVBZ2VudCk7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIHN0YXRlIG9mIHRoZSB0b2tlbiB1cGdyYWRlLgogICAqLwogIGZ1bmN0aW9uIGdldFVwZ3JhZGVTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKFVwZ3JhZGVTdGF0ZSkgewogICAgaWYoIWNhblVwZ3JhZGUoKSkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5Ob3RBbGxvd2VkOwogICAgZWxzZSBpZihhZGRyZXNzKHVwZ3JhZGVBZ2VudCkgPT0gMHgwMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5XYWl0aW5nRm9yQWdlbnQ7CiAgICBlbHNlIGlmKHRvdGFsVXBncmFkZWQgPT0gMCkgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5SZWFkeVRvVXBncmFkZTsKICAgIGVsc2UgcmV0dXJuIFVwZ3JhZGVTdGF0ZS5VcGdyYWRpbmc7CiAgfQoKICAvKioKICAgKiBDaGFuZ2UgdGhlIHVwZ3JhZGUgbWFzdGVyLgogICAqCiAgICogVGhpcyBhbGxvd3MgdXMgdG8gc2V0IGEgbmV3IG93bmVyIGZvciB0aGUgdXBncmFkZSBtZWNoYW5pc20uCiAgICovCiAgZnVuY3Rpb24gc2V0VXBncmFkZU1hc3RlcihhZGRyZXNzIG1hc3RlcikgcHVibGljIHsKICAgICAgaWYgKG1hc3RlciA9PSAweDApIHRocm93OwogICAgICBpZiAobXNnLnNlbmRlciAhPSB1cGdyYWRlTWFzdGVyKSB0aHJvdzsKICAgICAgdXBncmFkZU1hc3RlciA9IG1hc3RlcjsKICB9CgogIC8qKgogICAqIENoaWxkIGNvbnRyYWN0IGNhbiBlbmFibGUgdG8gcHJvdmlkZSB0aGUgY29uZGl0aW9uIHdoZW4gdGhlIHVwZ3JhZGUgY2FuIGJlZ3VuLgogICAqLwogIGZ1bmN0aW9uIGNhblVwZ3JhZGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKCgoKCgovKioKICogRGVmaW5lIGludGVyZmFjZSBmb3IgcmVsZWFzaW5nIHRoZSB0b2tlbiB0cmFuc2ZlciBhZnRlciBhIHN1Y2Nlc3NmdWwgY3Jvd2RzYWxlLgogKi8KY29udHJhY3QgUmVsZWFzYWJsZVRva2VuIGlzIEVSQzIwLCBPd25hYmxlIHsKCiAgLyogVGhlIGZpbmFsaXplciBjb250cmFjdCB0aGF0IGFsbG93cyB1bmxpZnQgdGhlIHRyYW5zZmVyIGxpbWl0cyBvbiB0aGlzIHRva2VuICovCiAgYWRkcmVzcyBwdWJsaWMgcmVsZWFzZUFnZW50OwoKICAvKiogQSBjcm93ZHNhbGUgY29udHJhY3QgY2FuIHJlbGVhc2UgdXMgdG8gdGhlIHdpbGQgaWYgSUNPIHN1Y2Nlc3MuIElmIGZhbHNlIHdlIGFyZSBhcmUgaW4gdHJhbnNmZXIgbG9jayB1cCBwZXJpb2QuKi8KICBib29sIHB1YmxpYyByZWxlYXNlZCA9IGZhbHNlOwoKICAvKiogTWFwIG9mIGFnZW50cyB0aGF0IGFyZSBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2VucyByZWdhcmRsZXNzIG9mIHRoZSBsb2NrIGRvd24gcGVyaW9kLiBUaGVzZSBhcmUgY3Jvd2RzYWxlIGNvbnRyYWN0cyBhbmQgcG9zc2libGUgdGhlIHRlYW0gbXVsdGlzaWcgaXRzZWxmLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHRyYW5zZmVyQWdlbnRzOwoKICAvKioKICAgKiBMaW1pdCB0b2tlbiB0cmFuc2ZlciB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIuCiAgICoKICAgKi8KICBtb2RpZmllciBjYW5UcmFuc2ZlcihhZGRyZXNzIF9zZW5kZXIpIHsKCiAgICBpZighcmVsZWFzZWQpIHsKICAgICAgICBpZighdHJhbnNmZXJBZ2VudHNbX3NlbmRlcl0pIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgfQoKICAgIF87CiAgfQoKICAvKioKICAgKiBTZXQgdGhlIGNvbnRyYWN0IHRoYXQgY2FuIGNhbGwgcmVsZWFzZSBhbmQgbWFrZSB0aGUgdG9rZW4gdHJhbnNmZXJhYmxlLgogICAqCiAgICogRGVzaWduIGNob2ljZS4gQWxsb3cgcmVzZXQgdGhlIHJlbGVhc2UgYWdlbnQgdG8gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0UmVsZWFzZUFnZW50KGFkZHJlc3MgYWRkcikgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewoKICAgIC8vIFdlIGRvbid0IGRvIGludGVyZmFjZSBjaGVjayBoZXJlIGFzIHdlIG1pZ2h0IHdhbnQgdG8gYSBub3JtYWwgd2FsbGV0IGFkZHJlc3MgdG8gYWN0IGFzIGEgcmVsZWFzZSBhZ2VudAogICAgcmVsZWFzZUFnZW50ID0gYWRkcjsKICB9CgogIC8qKgogICAqIE93bmVyIGNhbiBhbGxvdyBhIHBhcnRpY3VsYXIgYWRkcmVzcyAoYSBjcm93ZHNhbGUgY29udHJhY3QpIHRvIHRyYW5zZmVyIHRva2VucyBkZXNwaXRlIHRoZSBsb2NrIHVwIHBlcmlvZC4KICAgKi8KICBmdW5jdGlvbiBzZXRUcmFuc2ZlckFnZW50KGFkZHJlc3MgYWRkciwgYm9vbCBzdGF0ZSkgb25seU93bmVyIGluUmVsZWFzZVN0YXRlKGZhbHNlKSBwdWJsaWMgewogICAgdHJhbnNmZXJBZ2VudHNbYWRkcl0gPSBzdGF0ZTsKICB9CgogIC8qKgogICAqIE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIHRvIHRoZSB3aWxkLgogICAqCiAgICogQ2FuIGJlIGNhbGxlZCBvbmx5IGZyb20gdGhlIHJlbGVhc2UgYWdlbnQgdGhhdCBpcyB0aGUgZmluYWwgSUNPIGNvbnRyYWN0LiBJdCBpcyBvbmx5IGNhbGxlZCBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBiZWVuIHN1Y2Nlc3MgKGZpcnN0IG1pbGVzdG9uZSByZWFjaGVkKS4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIHJlbGVhc2VkID0gdHJ1ZTsKICB9CgogIC8qKiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJlZm9yZSBvciBhZnRlciB0aGUgdG9rZW5zIGhhdmUgYmVlbiByZWxlYXNlc2QgKi8KICBtb2RpZmllciBpblJlbGVhc2VTdGF0ZShib29sIHJlbGVhc2VTdGF0ZSkgewogICAgaWYocmVsZWFzZVN0YXRlICE9IHJlbGVhc2VkKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBfOwogIH0KCiAgLyoqIFRoZSBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIG9ubHkgYnkgYSB3aGl0ZWxpc3RlZCByZWxlYXNlIGFnZW50LiAqLwogIG1vZGlmaWVyIG9ubHlSZWxlYXNlQWdlbnQoKSB7CiAgICBpZihtc2cuc2VuZGVyICE9IHJlbGVhc2VBZ2VudCkgewogICAgICAgIHRocm93OwogICAgfQogICAgXzsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBDYWxsIFN0YW5kYXJkVG9rZW4udHJhbnNmZXIoKQogICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgY2FuVHJhbnNmZXIoX2Zyb20pIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgLy8gQ2FsbCBTdGFuZGFyZFRva2VuLnRyYW5zZmVyRm9ybSgpCiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgfQoKfQoKCgoKCgoKLyoqCiAqIEEgdG9rZW4gdGhhdCBjYW4gaW5jcmVhc2UgaXRzIHN1cHBseSBieSBhbm90aGVyIGNvbnRyYWN0LgogKgogKiBUaGlzIGFsbG93cyB1bmNhcHBlZCBjcm93ZHNhbGUgYnkgZHluYW1pY2FsbHkgaW5jcmVhc2luZyB0aGUgc3VwcGx5IHdoZW4gbW9uZXkgcG91cnMgaW4uCiAqIE9ubHkgbWludCBhZ2VudHMsIGNvbnRyYWN0cyB3aGl0ZWxpc3RlZCBieSBvd25lciwgY2FuIG1pbnQgbmV3IHRva2Vucy4KICoKICovCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CgogIHVzaW5nIFNhZmVNYXRoTGliIGZvciB1aW50OwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCiAgLyoqIExpc3Qgb2YgYWdlbnRzIHRoYXQgYXJlIGFsbG93ZWQgdG8gY3JlYXRlIG5ldyB0b2tlbnMgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtaW50QWdlbnRzOwoKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLi4KICAgKgogICAqIE9ubHkgY2FsbGFibHkgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgKG1pbnQgYWdlbnQpLgogICAqLwogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIG9ubHlNaW50QWdlbnQgY2FuTWludCBwdWJsaWMgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5wbHVzKGFtb3VudCk7CiAgICBiYWxhbmNlc1tyZWNlaXZlcl0gPSBiYWxhbmNlc1tyZWNlaXZlcl0ucGx1cyhhbW91bnQpOwogICAgVHJhbnNmZXIoMCwgcmVjZWl2ZXIsIGFtb3VudCk7CiAgfQoKICAvKioKICAgKiBPd25lciBjYW4gYWxsb3cgYSBjcm93ZHNhbGUgY29udHJhY3QgdG8gbWludCBuZXcgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIHNldE1pbnRBZ2VudChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdGUpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyB7CiAgICBtaW50QWdlbnRzW2FkZHJdID0gc3RhdGU7CiAgfQoKICBtb2RpZmllciBvbmx5TWludEFnZW50KCkgewogICAgLy8gT25seSBjcm93ZHNhbGUgY29udHJhY3RzIGFyZSBhbGxvd2VkIHRvIG1pbnQgbmV3IHRva2VucwogICAgaWYoIW1pbnRBZ2VudHNbbXNnLnNlbmRlcl0pIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIF87CiAgfQoKICAvKiogTWFrZSBzdXJlIHdlIGFyZSBub3QgZG9uZSB5ZXQuICovCiAgbW9kaWZpZXIgY2FuTWludCgpIHsKICAgIGlmKG1pbnRpbmdGaW5pc2hlZCkgdGhyb3c7CiAgICBfOwogIH0KfQoKCgoKLyoqCiAqIEEgY3Jvd2RzYWxlZCB0b2tlbi4KICoKICogQW4gRVJDLTIwIHRva2VuIGRlc2lnbmVkIHNwZWNpZmljYWxseSBmb3IgY3Jvd2RzYWxlcyB3aXRoIGludmVzdG9yIHByb3RlY3Rpb24gYW5kIGZ1cnRoZXIgZGV2ZWxvcG1lbnQgcGF0aC4KICoKICogLSBUaGUgdG9rZW4gdHJhbnNmZXIoKSBpcyBkaXNhYmxlZCB1bnRpbCB0aGUgY3Jvd2RzYWxlIGlzIG92ZXIKICogLSBUaGUgdG9rZW4gY29udHJhY3QgZ2l2ZXMgYW4gb3B0LWluIHVwZ3JhZGUgcGF0aCB0byBhIG5ldyBjb250cmFjdAogKiAtIFRoZSBzYW1lIHRva2VuIGNhbiBiZSBwYXJ0IG9mIHNldmVyYWwgY3Jvd2RzYWxlcyB0aHJvdWdoIGFwcHJvdmUoKSBtZWNoYW5pc20KICogLSBUaGUgdG9rZW4gY2FuIGJlIGNhcHBlZCAoc3VwcGx5IHNldCBpbiB0aGUgY29uc3RydWN0b3IpIG9yIHVuY2FwcGVkIChjcm93ZHNhbGUgY29udHJhY3QgY2FuIG1pbnQgbmV3IHRva2VucykKICoKICovCmNvbnRyYWN0IENyb3dkc2FsZVRva2VuIGlzIFJlbGVhc2FibGVUb2tlbiwgTWludGFibGVUb2tlbiwgVXBncmFkZWFibGVUb2tlbiB7CgogIHN0cmluZyBwdWJsaWMgbmFtZTsKCiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogIHVpbnQgcHVibGljIGRlY2ltYWxzOwoKICAvKioKICAgKiBDb25zdHJ1Y3QgdGhlIHRva2VuLgogICAqCiAgICogVGhpcyB0b2tlbiBtdXN0IGJlIGNyZWF0ZWQgdGhyb3VnaCBhIHRlYW0gbXVsdGlzaWcgd2FsbGV0LCBzbyB0aGF0IGl0IGlzIG93bmVkIGJ5IHRoYXQgd2FsbGV0LgogICAqLwogIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQgX2luaXRpYWxTdXBwbHksIHVpbnQgX2RlY2ltYWxzKQogICAgVXBncmFkZWFibGVUb2tlbihtc2cuc2VuZGVyKSB7CgogICAgLy8gQ3JlYXRlIGFueSBhZGRyZXNzLCBjYW4gYmUgdHJhbnNmZXJyZWQKICAgIC8vIHRvIHRlYW0gbXVsdGlzaWcgdmlhIGNoYW5nZU93bmVyKCksCiAgICAvLyBhbHNvIHJlbWVtYmVyIHRvIGNhbGwgc2V0VXBncmFkZU1hc3RlcigpCiAgICBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgbmFtZSA9IF9uYW1lOwogICAgc3ltYm9sID0gX3N5bWJvbDsKCiAgICB0b3RhbFN1cHBseSA9IF9pbml0aWFsU3VwcGx5OwoKICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwoKICAgIC8vIENyZWF0ZSBpbml0aWFsbHkgYWxsIGJhbGFuY2Ugb24gdGhlIHRlYW0gbXVsdGlzaWcKICAgIGJhbGFuY2VzW293bmVyXSA9IHRvdGFsU3VwcGx5OwogIH0KCiAgLyoqCiAgICogV2hlbiB0b2tlbiBpcyByZWxlYXNlZCB0byBiZSB0cmFuc2ZlcmFibGUsIGVuZm9yY2Ugbm8gbmV3IHRva2VucyBjYW4gYmUgY3JlYXRlZC4KICAgKi8KICBmdW5jdGlvbiByZWxlYXNlVG9rZW5UcmFuc2ZlcigpIHB1YmxpYyBvbmx5UmVsZWFzZUFnZW50IHsKICAgIG1pbnRpbmdGaW5pc2hlZCA9IHRydWU7CiAgICBzdXBlci5yZWxlYXNlVG9rZW5UcmFuc2ZlcigpOwogIH0KCiAgLyoqCiAgICogQWxsb3cgdXBncmFkZSBhZ2VudCBmdW5jdGlvbmFsaXR5IGtpY2sgaW4gb25seSBpZiB0aGUgY3Jvd2RzYWxlIHdhcyBzdWNjZXNzLgogICAqLwogIGZ1bmN0aW9uIGNhblVwZ3JhZGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gcmVsZWFzZWQ7CiAgfQoKfQoKCgovKioKICogQXQgdGhlIGVuZCBvZiB0aGUgc3VjY2Vzc2Z1bCBjcm93ZHNhbGUgYWxsb2NhdGUgJSBib251cyBvZiB0b2tlbnMgdG8gdGhlIHRlYW0uCiAqCiAqIFVubG9jayB0b2tlbnMuCiAqCiAqIEJvbnVzQWxsb2NhdGlvbkZpbmFsIG11c3QgYmUgc2V0IGFzIHRoZSBtaW50aW5nIGFnZW50IGZvciB0aGUgTWludGFibGVUb2tlbi4KICoKICovCmNvbnRyYWN0IEJvbnVzRmluYWxpemVBZ2VudCBpcyBGaW5hbGl6ZUFnZW50IHsKCiAgdXNpbmcgU2FmZU1hdGhMaWIgZm9yIHVpbnQ7CgogIENyb3dkc2FsZVRva2VuIHB1YmxpYyB0b2tlbjsKICBDcm93ZHNhbGUgcHVibGljIGNyb3dkc2FsZTsKCiAgLyoqIFRvdGFsIHBlcmNlbnQgb2YgdG9rZW5zIG1pbnRlZCB0byB0aGUgdGVhbSBhdCB0aGUgZW5kIG9mIHRoZSBzYWxlIGFzIGJhc2UgcG9pbnRzICgwLjAwMDEpICovCiAgdWludCBwdWJsaWMgYm9udXNCYXNlUG9pbnRzOwoKICAvKiogV2hlcmUgd2UgbW92ZSB0aGUgdG9rZW5zIGF0IHRoZSBlbmQgb2YgdGhlIHNhbGUuICovCiAgYWRkcmVzcyBwdWJsaWMgdGVhbU11bHRpc2lnOwoKICAvKiBIb3cgbXVjaCBib251cyB0b2tlbnMgd2UgYWxsb2NhdGVkICovCiAgdWludCBwdWJsaWMgYWxsb2NhdGVkQm9udXM7CgogIGZ1bmN0aW9uIEJvbnVzRmluYWxpemVBZ2VudChDcm93ZHNhbGVUb2tlbiBfdG9rZW4sIENyb3dkc2FsZSBfY3Jvd2RzYWxlLCB1aW50IF9ib251c0Jhc2VQb2ludHMsIGFkZHJlc3MgX3RlYW1NdWx0aXNpZykgewogICAgdG9rZW4gPSBfdG9rZW47CiAgICBjcm93ZHNhbGUgPSBfY3Jvd2RzYWxlOwogICAgaWYoYWRkcmVzcyhjcm93ZHNhbGUpID09IDApIHsKICAgICAgdGhyb3c7CiAgICB9CgogICAgdGVhbU11bHRpc2lnID0gX3RlYW1NdWx0aXNpZzsKICAgIGlmKGFkZHJlc3ModGVhbU11bHRpc2lnKSA9PSAwKSB7CiAgICAgIHRocm93OwogICAgfQoKICAgIGJvbnVzQmFzZVBvaW50cyA9IF9ib251c0Jhc2VQb2ludHM7CiAgfQoKICAvKiBDYW4gd2UgcnVuIGZpbmFsaXplIHByb3Blcmx5ICovCiAgZnVuY3Rpb24gaXNTYW5lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiAodG9rZW4ubWludEFnZW50cyhhZGRyZXNzKHRoaXMpKSA9PSB0cnVlKSAmJiAodG9rZW4ucmVsZWFzZUFnZW50KCkgPT0gYWRkcmVzcyh0aGlzKSk7CiAgfQoKICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoKSB7CiAgICBpZihtc2cuc2VuZGVyICE9IGFkZHJlc3MoY3Jvd2RzYWxlKSkgewogICAgICB0aHJvdzsKICAgIH0KCiAgICAvLyBIb3cgbWFueSAlIG9mIHRva2VucyB0aGUgZm91bmRlcnMgYW5kIG90aGVycyBnZXQKICAgIHVpbnQgdG9rZW5zU29sZCA9IGNyb3dkc2FsZS50b2tlbnNTb2xkKCk7CiAgICBhbGxvY2F0ZWRCb251cyA9IHRva2Vuc1NvbGQudGltZXMoYm9udXNCYXNlUG9pbnRzKSAvIDEwMDAwOwoKICAgIC8vIG1vdmUgdG9rZW5zIHRvIHRoZSB0ZWFtIG11bHRpc2lnIHdhbGxldAogICAgdG9rZW4ubWludCh0ZWFtTXVsdGlzaWcsIGFsbG9jYXRlZEJvbnVzKTsKCiAgICAvLyBNYWtlIHRva2VuIHRyYW5zZmVyYWJsZQogICAgdG9rZW4ucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsKICB9Cgp9'.
	

]
