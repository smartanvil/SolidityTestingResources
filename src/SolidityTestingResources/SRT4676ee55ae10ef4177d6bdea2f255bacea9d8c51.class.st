Class {
	#name : #SRT4676ee55ae10ef4177d6bdea2f255bacea9d8c51,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4676ee55ae10ef4177d6bdea2f255bacea9d8c51 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICoqLwovKiogKioqKioqKioqKioqKioqKioqKioqKioqIEFic3RyYWN0IENLIENvcmUgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICoqLwovKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICoqLwoKLyoqCiAqIEBkZXYgVGhpcyBjYW4gYmUgZXhjaGFuZ2VkIGZvciBhbnkgRVJDNzIxIGNvbnRyYWN0IGlmIHdlIGRvbid0IHdhbnQgdG8gcmVseSBvbiBDSy4KKiovCmNvbnRyYWN0IEtpdHR5Q29yZSB7CiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7Cn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKiogQ3VkZGxlIERhdGEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovIAovKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICoqLwogICAgCi8qKgogKiBAZGV2IEhvbGRzIHRoZSBkYXRhIGZvciBhbGwga2l0dHkgYWN0aW9ucyBhbmQgYWxsIGtpdHR5IGVmZmVjdHMuCiAqIEBub3RpY2UgVE8tRE86IEhhdmVuJ3QgZnVsbHkgY29udmVydGVkIHRoaXMgdG8gYSBmb3JtYXQgd2hlcmUgZWZmZWN0cyBhcmUgYWN0aW9ucyEKKiovCmNvbnRyYWN0IEN1ZGRsZURhdGEgaXMgT3duYWJsZSB7CiAgICAvLyBBY3Rpb24vRWZmZWN0IElkID0+IHN0cnVjdCBmb3IgYWN0aW9ucyBhbmQgZm9yIGVmZmVjdHMuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IEFjdGlvbikgcHVibGljIGFjdGlvbnM7CiAgICAvLyBBY3Rpb25zIHNwZWNpZmljIHRvIHBlcnNvbmFsaXR5IHR5cGVzLgogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2W10pIHR5cGVBY3Rpb25zOwogICAgLy8gQWN0aW9ucyB0aGF0IGFueSBwZXJzb25hbGl0eSBjYW4gaGF2ZS4KICAgIHVpbnQyNTZbXSBhbnlBY3Rpb25zOwoKICAgIC8vIFRoaXMgc3RydWN0IHVzZWQgZm9yIGFsbCBtb3ZlcyBhIGtpdHR5IG1heSBoYXZlLgogICAgc3RydWN0IEFjdGlvbiB7CiAgICAgICAgdWludDI1NiBlbmVyZ3k7CiAgICAgICAgdWludDhbNl0gYmFzZVBldHM7IC8vIEVhY2ggb3duZXIgaXMgYW4gaW5kZXggdGhhdCBoYXMgYSBiYXNlIGFtb3VudCBvZiBwZXRzLgogICAgICAgIHVpbnQ4WzZdIHBldHNBZGRpdGlvbjsgLy8gU3BlY2lhbCBlZmZlY3RzIG1heSBnaXZlIGV4dHJhIHBldHMuCiAgICAgICAgdWludDE2WzZdIGNyaXRDaGFuY2U7IC8vIFNwZWNpYWwgZWZmZWN0cyBtYXkgaW5jcmVhc2UgKG9yIGRlY3JlYXNlPykgY3JpdCBjaGFuY2UuCiAgICAgICAgdWludDhbNl0gbWlzc0NoYW5jZTsgLy8gU3BlY2lhbCBlZmZlY3RzIG1heSBkZWNyZWFzZSAob3IgaW5jcmVhc2U/KSBtaXNzIGNoYW5jZS4KICAgICAgICB1aW50MjU2IHR1cm5zQWZmZWN0ZWQ7IC8vIElmIGFuIGVmZmVjdCBvY2N1cnJzCiAgICB9CiAgICAKLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqIEVYVEVSTkFMIFZJRVcgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqKi8KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFVzZWQgYnkgQ3VkZGxlU2NpZW5jZSB0byBnZXQgcmVsZXZhbnQgaW5mbyBmb3IgYSBzZXF1ZW5jZSBvZiBtb3Zlcy4KICAgICAqIEBwYXJhbSBfYWN0aW9ucyBUaGUgOCBsZW5ndGggYXJyYXkgb2YgdGhlIG1vdmUgc2VxdWVuY2UuCiAgICAgKiBAcGFyYW0gX2N1ZGRsZU93bmVyIFRoZSBvd25lciBJZCB0aGF0IHdlIG5lZWQgaW5mbyBmb3IuCiAgICAqKi8KICAgIGZ1bmN0aW9uIHJldHVybkFjdGlvbnModWludDI1Nls4XSBfYWN0aW9ucywgdWludDI1NiBfY3VkZGxlT3duZXIpCiAgICAgIGV4dGVybmFsCiAgICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTZbOF0gZW5lcmd5LCB1aW50MjU2WzhdIGJhc2VQZXRzLCB1aW50MjU2WzhdIHBldHNBZGRpdGlvbiwKICAgICAgICAgICAgIHVpbnQyNTZbOF0gY3JpdENoYW5jZSwgdWludDI1Nls4XSBtaXNzQ2hhbmNlLCB1aW50MjU2WzhdIHR1cm5zQWZmZWN0ZWQpCiAgICB7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgODsgaSsrKSB7CiAgICAgICAgICAgIGlmIChfYWN0aW9uc1tpXSA9PSAwKSBicmVhazsKICAgICAgICAgICAgCiAgICAgICAgICAgIEFjdGlvbiBtZW1vcnkgYWN0aW9uID0gYWN0aW9uc1tfYWN0aW9uc1tpXV07CiAgICAgICAgICAgIGVuZXJneVtpXSA9IGFjdGlvbi5lbmVyZ3k7CiAgICAgICAgICAgIGJhc2VQZXRzW2ldID0gYWN0aW9uLmJhc2VQZXRzW19jdWRkbGVPd25lcl07CiAgICAgICAgICAgIHBldHNBZGRpdGlvbltpXSA9IGFjdGlvbi5wZXRzQWRkaXRpb25bX2N1ZGRsZU93bmVyXTsKICAgICAgICAgICAgY3JpdENoYW5jZVtpXSA9IGFjdGlvbi5jcml0Q2hhbmNlW19jdWRkbGVPd25lcl07CiAgICAgICAgICAgIG1pc3NDaGFuY2VbaV0gPSBhY3Rpb24ubWlzc0NoYW5jZVtfY3VkZGxlT3duZXJdOwogICAgICAgICAgICB0dXJuc0FmZmVjdGVkW2ldID0gYWN0aW9uLnR1cm5zQWZmZWN0ZWQ7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIEBOT1RJQ0UgVGhpcyBpcyBoYXJkY29kZWQgZm9yIGFubm91bmNlbWVudCB1bnRpbCBsYXVuY2guCiAgICAgKiBObyBwb2ludCBpbiBhZGRpbmcgYWN0aW9ucyBub3cgdGhhdCBhcmUganVzdCBnb2luZyB0byBiZSBjaGFuZ2VkLgogICAgKiovCiAgICAKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBhbW91bnQgb2Yga2l0dHkgYWN0aW9ucyBhdmFpbGFibGUuCiAgICAgKiBAcGFyYW0gX3BlcnNvbmFsaXR5IElmIHdlIHdhbnQgcGVyc29uYWxpdHkgYWN0aW9ucywgdGhpcyBpcyB0aGUgcGVyc29uYWxpdHkgaW5kZXgKICAgICoqLwogICAgZnVuY3Rpb24gZ2V0QWN0aW9uQ291bnQodWludDI1NiBfcGVyc29uYWxpdHkpCiAgICAgIGV4dGVybmFsCiAgICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTYgdG90YWxBY3Rpb25zKQogICAgewogICAgICAgIC8vaWYgKF9wZXJzb25hbGl0eSA+IDApIHRvdGFsQWN0aW9ucyA9IHR5cGVBY3Rpb25zW19wZXJzb25hbGl0eV0ubGVuZ3RoOwogICAgICAgIC8vZWxzZSB0b3RhbEFjdGlvbnMgPSBhbnlBY3Rpb25zLmxlbmd0aDsKICAgICAgICBpZiAoX3BlcnNvbmFsaXR5ID09IDApIHJldHVybiAxMDsKICAgICAgICBlbHNlIHJldHVybiA1OwogICAgfQogICAgCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIE9OTFkgT1dORVIgKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCiAgICAKICAgIC8qKgogICAgICogQGRldiBVc2VkIGJ5IHRoZSBvd25lciB0byBjcmVhdGUvZWRpdCBhIG5ldyBhY3Rpb24gdGhhdCBraXR0aWVzIG1heSBsZWFybi4KICAgICAqIEBwYXJhbSBfYWN0aW9uSWQgVGhlIGdpdmVuIElEIG9mIHRoaXMgYWN0aW9uLgogICAgICogQHBhcmFtIF9uZXdFbmVyZ3kgVGhlIGFtb3VudCBvZiBlbmVyZ3kgdGhlIGFjdGlvbiB3aWxsIGNvc3QuCiAgICAgKiBAcGFyYW0gX25ld1BldHMgVGhlIGFtb3VudCBvZiBiYXNlIHBldHMgZWFjaCBvd25lciB3aWxsIGdpdmUgdG8gdGhpcyBhY3Rpb24uCiAgICAgKiBAcGFyYW0gX3BldEFkZGl0aW9ucyBUaGUgYW1vdW50IG9mIGFkZGl0aW9uYWwgcGV0cyBlYWNoIG93bmVyIHdpbGwgZ2l2ZS4KICAgICAqIEBwYXJhbSBfY3JpdENoYW5jZSBUaGUgY3JpdCBjaGFuY2UgdGhpcyBtb3ZlIGhhcyBhZ2FpbnN0IGVhY2ggb3duZXIuCiAgICAgKiBAcGFyYW0gX21pc3NDaGFuY2UgVGhlIG1pc3MgY2hhbmNlIHRoaXMgbW92ZSBoYXMgYWdhaW5zdCBlYWNoIG93bmVyLgogICAgICogQHBhcmFtIF90dXJuc0FmZmVjdGVkIFRoZSBhbW91bnQgb2YgdHVybnMgYW4gZWZmZWN0LCBpZiBhbnksIHdpbGwgYmUgYXBwbGllZC4KICAgICAqIEBwYXJhbSBfcGVyc29uYWxpdHkgVGhlIHR5cGUvcGVyc29uYWxpdHkgdGhpcyBtb3ZlIGlzIHNwZWNpZmljIHRvICgwIGZvciBhbnkpLgogICAgKiovCiAgICBmdW5jdGlvbiBhZGRBY3Rpb24odWludDI1NiBfYWN0aW9uSWQsIHVpbnQyNTYgX25ld0VuZXJneSwgdWludDhbNl0gX25ld1BldHMsIHVpbnQ4WzZdIF9wZXRBZGRpdGlvbnMsCiAgICAgICAgICAgIHVpbnQxNls2XSBfY3JpdENoYW5jZSwgdWludDhbNl0gX21pc3NDaGFuY2UsIHVpbnQyNTYgX3R1cm5zQWZmZWN0ZWQsIHVpbnQyNTYgX3BlcnNvbmFsaXR5KQogICAgICBwdWJsaWMgLy8gVGhpcyBpcyBjYWxsZWQgaW4gcHJlcEFjdGlvbnMgZG93biBiZWxvdy4KICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgQWN0aW9uIG1lbW9yeSBuZXdBY3Rpb24gPSBBY3Rpb24oX25ld0VuZXJneSwgX25ld1BldHMsIF9wZXRBZGRpdGlvbnMsIF9jcml0Q2hhbmNlLCBfbWlzc0NoYW5jZSwgX3R1cm5zQWZmZWN0ZWQpOwogICAgICAgIGFjdGlvbnNbX2FjdGlvbklkXSA9IG5ld0FjdGlvbjsKICAgICAgICAKICAgICAgICBpZiAoX3BlcnNvbmFsaXR5ID4gMCkgdHlwZUFjdGlvbnNbX3BlcnNvbmFsaXR5XS5wdXNoKF9hY3Rpb25JZCk7CiAgICAgICAgZWxzZSBhbnlBY3Rpb25zLnB1c2goX2FjdGlvbklkKTsKICAgIH0KICAgIAp9CgovKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqKi8KLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKiogS2l0dHkgRGF0YSAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICoqLwoKLyoqCiAqIEBkZXYgS2l0dHkgZGF0YSBob2xkcyB0aGUgY29yZSBvZiBhbGwgZGF0YSBmb3Iga2l0dGllcy4gVGhpcyBpcyB0aGUgbW9zdCBwZXJtYW5lbnQKICogQGRldiBvZiBhbGwgY29udHJhY3RzIGluIHRoZSBDcnlwdG9DdWRkbGVzIHN5c3RlbS4gQXMgc2ltcGxlIGFzIHBvc3NpYmxlIGJlY2F1c2Ugb2YgdGhhdC4KKiovCmNvbnRyYWN0IEtpdHR5RGF0YSBpcyBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIGd5bUNvbnRyYWN0OyAvLyBBZGRyZXNzIG9mIHRoZSBneW0gY29udHJhY3QuCiAgICBhZGRyZXNzIHB1YmxpYyBzcGVjaWFsQ29udHJhY3Q7IC8vIEFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHVzZWQgdG8gdHJhaW4gc3BlY2lhbCBraXR0aWVzLgogICAgYWRkcmVzcyBwdWJsaWMgYXJlbmFDb250cmFjdDsgLy8gQWRkcmVzcyBvZiB0aGUgYXJlbmEgY29udHJhY3QuCiAgICAKICAgIC8vIE1hcHBpbmcgb2YgYWxsIGtpdHRpZXMgYnkgQ0sga2l0dHkgSWQKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gS2l0dHkpIHB1YmxpYyBraXR0aWVzOwogICAgCiAgICAvLyBBbGwgdHJhaW5lZCBraXR0aWVzCiAgICBzdHJ1Y3QgS2l0dHkgewogICAgICAgIHVpbnQ4WzJdIGtpdHR5VHlwZTsgLy8gUGVyc29uYWxpdHkvdHlwZSBvZiB0aGUga2l0dHkuCiAgICAgICAgdWludDMyWzEyXSBhY3Rpb25zQXJyYXk7IC8vIEFycmF5IG9mIGFsbCBtb3Zlcy4KICAgICAgICB1aW50MTYgbGV2ZWw7IC8vIEN1cnJlbnQgbGV2ZWwgb2YgdGhlIGtpdHR5LgogICAgICAgIHVpbnQxNiB0b3RhbEJhdHRsZXM7IC8vIFRvdGFsIGJhdHRsZXMgdGhhdCB0aGUga2l0dHkgaGFzICJmb3VnaHQiLgogICAgfQogICAgCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIERFRkFVTFQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCiAgICAKICAgIC8qKgogICAgICogQHBhcmFtIF9hcmVuYUNvbnRyYWN0IFRoZSBhZGRyZXNzIG9mIHRoZSBBcmVuYSBzbyB0aGF0IGl0IG1heSBsZXZlbCB1cCBraXR0aWVzLgogICAgICogQHBhcmFtIF9neW1Db250cmFjdCBUaGUgYWRkcmVzcyBvZiB0aGUgS2l0dHlHeW0gc28gdGhhdCBpdCBtYXkgdHJhaW4ga2l0dGllcy4KICAgICAqIEBwYXJhbSBfc3BlY2lhbENvbnRyYWN0IFRoZSBhZGRyZXNzIG9mIHRoZSBTcGVjaWFsR3ltIHNvIGl0IG1heSB0cmFpbiBzcGVjaWFscy4KICAgICoqLwogICAgZnVuY3Rpb24gS2l0dHlEYXRhKGFkZHJlc3MgX2FyZW5hQ29udHJhY3QsIGFkZHJlc3MgX2d5bUNvbnRyYWN0LCBhZGRyZXNzIF9zcGVjaWFsQ29udHJhY3QpCiAgICAgIHB1YmxpYwogICAgewogICAgICAgIGFyZW5hQ29udHJhY3QgPSBfYXJlbmFDb250cmFjdDsKICAgICAgICBneW1Db250cmFjdCA9IF9neW1Db250cmFjdDsKICAgICAgICBzcGVjaWFsQ29udHJhY3QgPSBfc3BlY2lhbENvbnRyYWN0OwogICAgfQogICAgCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBPTkxZIFZFUklGSUVEICoqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCiAgICAKICAgIC8qKgogICAgICogQGRldiBVc2VkIGJ5IEtpdHR5R3ltIHRvIGluaXRpYWxseSBhZGQgYSBraXR0eS4KICAgICAqIEBwYXJhbSBfa2l0dHlJZCBVbmlxdWUgQ0sgSWQgb2Yga2l0dHkgdG8gYmUgYWRkZWQuCiAgICAgKiBAcGFyYW0gX2tpdHR5VHlwZSBUaGUgcGVyc29uYWxpdHkgdHlwZSBvZiB0aGlzIGtpdHR5LgogICAgICogQHBhcmFtIF9hY3Rpb25zIEFycmF5IG9mIGFsbCBhY3Rpb25zIHRvIGJlIGFkZGVkIHRvIGtpdHR5LgogICAgKiovCiAgICBmdW5jdGlvbiBhZGRLaXR0eSh1aW50MjU2IF9raXR0eUlkLCB1aW50MjU2IF9raXR0eVR5cGUsIHVpbnQyNTZbNV0gX2FjdGlvbnMpCiAgICAgIGV4dGVybmFsCiAgICAgIG9ubHlWZXJpZmllZAogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGRlbGV0ZSBraXR0aWVzW19raXR0eUlkXTsgLy8gV2lwZSB0aGlzIGtpdHR5IGlmIGl0J3MgYWxyZWFkeSB0cmFpbmVkLgogICAgICAgIAogICAgICAgIGtpdHRpZXNbX2tpdHR5SWRdLmtpdHR5VHlwZVswXSA9IHVpbnQ4KF9raXR0eVR5cGUpOwogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IDU7IGkrKykgeyAKICAgICAgICAgICAgYWRkQWN0aW9uKF9raXR0eUlkLCBfYWN0aW9uc1tpXSwgaSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEdpdmUgdGhpcyBsZWFybmVkIGtpdHR5IHdpdGggYSB3ZWFsdGh5IG93bmVyIGEgZGVncmVlIGFuZCBuZXcgZ3JhZHVhdGUtc3BlY2lmaWMgYWN0aW9ucy4KICAgICAqIEBwYXJhbSBfa2l0dHlJZCBUaGUgdW5pcXVlIENLIElkIG9mIHRoZSBraXR0eSB0byBncmFkdWF0ZS4KICAgICAqIEBwYXJhbSBfc3BlY2lhbElkIFRoZSBJZCBvZiB0aGUgc3BlY2lhbCB0eXBlIHRoYXQgaXMgYmVpbmcgdHJhaW5lZC4KICAgICAqIEBwYXJhbSBfYWN0aW9ucyBUaGUgZ3JhZHVhdGUtc3BlY2lmaWMgYWN0aW9ucyB0aGF0IGFyZSBiZWluZyBnaXZlbiB0byB0aGlzIGtpdHR5LgogICAgICogQHBhcmFtIF9zbG90cyBUaGUgYXJyYXkgaW5kaWNlcyB3aGVyZSB0aGUgbmV3IGFjdGlvbnMgd2lsbCBnby4KICAgICoqLwogICAgZnVuY3Rpb24gdHJhaW5TcGVjaWFsKHVpbnQyNTYgX2tpdHR5SWQsIHVpbnQyNTYgX3NwZWNpYWxJZCwgdWludDI1NlsyXSBfYWN0aW9ucywgdWludDI1NlsyXSBfc2xvdHMpCiAgICAgIGV4dGVybmFsCiAgICAgIG9ubHlWZXJpZmllZAogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGtpdHRpZXNbX2tpdHR5SWRdLmtpdHR5VHlwZVsxXSA9IHVpbnQ4KF9zcGVjaWFsSWQpOwogICAgICAgIGFkZEFjdGlvbihfa2l0dHlJZCwgX2FjdGlvbnNbMF0sIF9zbG90c1swXSk7CiAgICAgICAgYWRkQWN0aW9uKF9raXR0eUlkLCBfYWN0aW9uc1sxXSwgX3Nsb3RzWzFdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXNlZCBpbnRlcm5hbGx5IGFuZCBleHRlcm5hbGx5IHRvIGFkZCBhbiBhY3Rpb24gb3IgcmVwbGFjZSBhbiBhY3Rpb24uCiAgICAgKiBAcGFyYW0gX2tpdHR5SWQgVGhlIHVuaXF1ZSBDSyBJZCBvZiB0aGUgbGVhcm5pbmcga2l0dHkuCiAgICAgKiBAcGFyYW0gX25ld0FjdGlvbiBUaGUgbmV3IGFjdGlvbiB0byBsZWFybi4KICAgICAqIEBwYXJhbSBfbW92ZVNsb3QgVGhlIGtpdHR5J3MgYWN0aW9uc0FycmF5IGluZGV4IHdoZXJlIHRoZSBtb3ZlIHNoYWxsIGdvLgogICAgKiovCiAgICBmdW5jdGlvbiBhZGRBY3Rpb24odWludDI1NiBfa2l0dHlJZCwgdWludDI1NiBfbmV3QWN0aW9uLCB1aW50MjU2IF9tb3ZlU2xvdCkKICAgICAgcHVibGljCiAgICAgIG9ubHlWZXJpZmllZAogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGtpdHRpZXNbX2tpdHR5SWRdLmFjdGlvbnNBcnJheVtfbW92ZVNsb3RdID0gdWludDMyKF9uZXdBY3Rpb24pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCgogICAgLyoqCiAgICAgKiBAZGV2IEFyZW5hIGNvbnRyYWN0IHVzZXMgdGhpcyBvbiBlaXRoZXIgYSB3aW4gb3IgbG9zZS4KICAgICAqIEBwYXJhbSBfa2l0dHlJZCBUaGUgdW5pcXVlIENLIElkIGZvciB0aGUga2l0dHkgYmVpbmcgZWRpdGVkLgogICAgICogQHBhcmFtIF93b24gV2hldGhlciBvciBub3QgdGhlIGtpdHR5IHdvbiB0aGUgYmF0dGxlLgogICAgKiovCiAgICBmdW5jdGlvbiBpbmNyZW1lbnRCYXR0bGVzKHVpbnQyNTYgX2tpdHR5SWQsIGJvb2wgX3dvbikKICAgICAgZXh0ZXJuYWwKICAgICAgb25seVZlcmlmaWVkCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgaWYgKF93b24pIGtpdHRpZXNbX2tpdHR5SWRdLmxldmVsKys7CiAgICAgICAga2l0dGllc1tfa2l0dHlJZF0udG90YWxCYXR0bGVzKys7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBDT05TVEFOVCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqKi8KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFVzZWQgb24gS2l0dHlHeW0gd2hlbiByZXJvbGxpbmcgYSBtb3ZlIHRvIGVuc3VyZSB2YWxpZGl0eS4KICAgICAqIEBwYXJhbSBfa2l0dHlJZCBVbmlxdWUgQ0sgSWQgb2YgdGhlIGtpdHR5LgogICAgICogQHBhcmFtIF9tb3ZlU2xvdCBUaGUgaW5kZXggb2YgdGhlIGtpdHR5J3MgYWN0aW9uc0FycmF5IHRvIGNoZWNrLgogICAgICogQHJldHVybiBUaGUgbW92ZSB0aGF0IG9jY3VwaWVzIHRoZSBfbW92ZVNsb3QuCiAgICAqKi8KICAgIGZ1bmN0aW9uIGZldGNoU2xvdCh1aW50MjU2IF9raXR0eUlkLCB1aW50MjU2IF9tb3ZlU2xvdCkKICAgICAgZXh0ZXJuYWwKICAgICAgdmlldwogICAgcmV0dXJucyAodWludDMyKQogICAgewogICAgICAgIHJldHVybiBraXR0aWVzW19raXR0eUlkXS5hY3Rpb25zQXJyYXlbX21vdmVTbG90XTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFVzZWQgYnkgZnJvbnRlbmQgdG8gZ2V0IGRhdGEgZm9yIGEga2l0dHkuCiAgICAgKiBAcGFyYW0gX2tpdHR5SWQgVGhlIHVuaXF1ZSBDSyBJZCB3ZSdyZSBxdWVyeWluZyBmb3IuCiAgICAqKi8KICAgIGZ1bmN0aW9uIHJldHVybktpdHR5KHVpbnQyNTYgX2tpdHR5SWQpCiAgICAgIGV4dGVybmFsCiAgICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQ4WzJdIGtpdHR5VHlwZSwgdWludDMyWzEyXSBhY3Rpb25zQXJyYXksIHVpbnQxNiBsZXZlbCwgdWludDE2IHRvdGFsQmF0dGxlcykKICAgIHsKICAgICAgICBLaXR0eSBtZW1vcnkga2l0dHkgPSBraXR0aWVzW19raXR0eUlkXTsKICAgICAgICBraXR0eVR5cGUgPSBraXR0eS5raXR0eVR5cGU7CiAgICAgICAgYWN0aW9uc0FycmF5ID0ga2l0dHkuYWN0aW9uc0FycmF5OwogICAgICAgIGxldmVsID0ga2l0dHkubGV2ZWw7CiAgICAgICAgdG90YWxCYXR0bGVzID0ga2l0dHkudG90YWxCYXR0bGVzOwogICAgfQogICAgCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBPTkxZIE9XTkVSICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCiAgICAKICAgIC8qKgogICAgICogQGRldiBPd25lciBvZiB0aGlzIGNvbnRyYWN0IG1heSBjaGFuZ2UgdGhlIGFkZHJlc3NlcyBvZiBhc3NvY2lhdGVkIGNvbnRyYWN0cy4KICAgICAqIEBwYXJhbSBfZ3ltQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBLaXR0eUd5bSBjb250cmFjdC4KICAgICAqIEBwYXJhbSBfYXJlbmFDb250cmFjdCBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IEFyZW5hIGNvbnRyYWN0LgogICAgICogQHBhcmFtIF9zcGVjaWFsQ29udHJhY3QgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBTcGVjaWFsR3ltIGNvbnRyYWN0LgogICAgKiovCiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cmFjdHMoYWRkcmVzcyBfZ3ltQ29udHJhY3QsIGFkZHJlc3MgX3NwZWNpYWxDb250cmFjdCwgYWRkcmVzcyBfYXJlbmFDb250cmFjdCkKICAgICAgZXh0ZXJuYWwKICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgaWYgKF9neW1Db250cmFjdCAhPSAwKSBneW1Db250cmFjdCA9IF9neW1Db250cmFjdDsKICAgICAgICBpZiAoX3NwZWNpYWxDb250cmFjdCAhPSAwKSBzcGVjaWFsQ29udHJhY3QgPSBfc3BlY2lhbENvbnRyYWN0OwogICAgICAgIGlmIChfYXJlbmFDb250cmFjdCAhPSAwKSBhcmVuYUNvbnRyYWN0ID0gX2FyZW5hQ29udHJhY3Q7CiAgICB9CiAgICAKLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqIE1PRElGSUVSUyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqKi8KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IE9ubHkgdGhlIEtpdHR5R3ltIGFuZCBBcmVuYSBjb250cmFjdHMgbWF5IG1ha2UgY2hhbmdlcyB0byBLaXR0eURhdGEhCiAgICAqKi8KICAgIG1vZGlmaWVyIG9ubHlWZXJpZmllZCgpCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGd5bUNvbnRyYWN0IHx8IG1zZy5zZW5kZXIgPT0gc3BlY2lhbENvbnRyYWN0IHx8IAogICAgICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBhcmVuYUNvbnRyYWN0KTsKICAgICAgICBfOwogICAgfQogICAgCn0KCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqIEtpdHR5IEd5bSAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCgovKioKICogQGRldiBBbGxvd3MgcGxheWVycyB0byB0cmFpbiBraXR0aWVzLCByZXJvbGwgdGhlIHRyYWluaW5nLCBvciByZXJvbGwgc3BlY2lmaWMgbW92ZXMuCiAqIEBkZXYgQWxzbyBob2xkcyBhbGwgc3BlY2lmaWMga2l0dHkgZGF0YSBzdWNoIGFzIHRoZWlyIGF2YWlsYWJsZSBhY3Rpb25zIChidXQgbm90IGFjdGlvbiBkYXRhISkKKiovCmNvbnRyYWN0IEtpdHR5R3ltIGlzIE93bmFibGUgewogICAgS2l0dHlDb3JlIHB1YmxpYyBjb3JlOwogICAgQ3VkZGxlRGF0YSBwdWJsaWMgY3VkZGxlRGF0YTsKICAgIEN1ZGRsZUNvaW4gcHVibGljIHRva2VuOwogICAgS2l0dHlEYXRhIHB1YmxpYyBraXR0eURhdGE7CiAgICBhZGRyZXNzIHB1YmxpYyBzcGVjaWFsR3ltOwoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsS2l0dGllcyA9IDE7IC8vIFRvdGFsIGFtb3VudCBvZiB0cmFpbmVkIGtpdHRpZXMuCiAgICB1aW50MjU2IHB1YmxpYyBwZXJzb25hbGl0eVR5cGVzOyAvLyBOdW1iZXIgb2YgcGVyc29uYWxpdHkgdHlwZXMgZm9yIHJhbmRvbWl6YXRpb24uCgogICAgdWludDI1NiBwdWJsaWMgdHJhaW5GZWU7IC8vIEluIHdlaQogICAgdWludDI1NiBwdWJsaWMgbGVhcm5GZWU7IC8vIEluIEN1ZGRsZUNvaW4gd2VpCiAgICB1aW50MjU2IHB1YmxpYyByZXJvbGxGZWU7IC8vIEluIEN1ZGRsZUNvaW4gd2VpCiAgICAKICAgIC8vIFVuaXF1ZSBDSyBJZCA9PiBhY3Rpb24gSWQgPT4gdHJ1ZSBpZiB0aGUga2l0dHkga25vd3MgdGhlIGFjdGlvbi4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gbWFwcGluZyAodWludDI1NiA9PiBib29sKSkgcHVibGljIGtpdHR5QWN0aW9uczsKCiAgICBldmVudCBLaXR0eVRyYWluZWQodWludDI1NiBpbmRleGVkIGtpdHR5SWQsIHVpbnQyNTYgaW5kZXhlZCBraXR0eU51bWJlciwKICAgICAgICAgICAgdWludDI1NiBpbmRleGVkIHBlcnNvbmFsaXR5LCB1aW50MjU2WzVdIGxlYXJuZWRBY3Rpb25zKTsKICAgIGV2ZW50IE1vdmVMZWFybmVkKHVpbnQyNTYgaW5kZXhlZCBraXR0eUlkLCB1aW50MjU2IGluZGV4ZWQgYWN0aW9uSWQpOwogICAgZXZlbnQgTW92ZVJlcm9sbGVkKHVpbnQyNTYgaW5kZXhlZCBraXR0eUlkLCB1aW50MjU2IGluZGV4ZWQgb2xkQWN0aW9uSWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgaW5kZXhlZCBuZXdBY3Rpb25JZCk7CgogICAgLyoqCiAgICAgKiBAZGV2IEluaXRpYWxpemUgY29udHJhY3QuCiAgICAqKi8KICAgIGZ1bmN0aW9uIEtpdHR5R3ltKGFkZHJlc3MgX2tpdHR5Q29yZSwgYWRkcmVzcyBfY3VkZGxlRGF0YSwgYWRkcmVzcyBfY3VkZGxlQ29pbiwgCiAgICAgICAgICAgICAgICAgICAgYWRkcmVzcyBfc3BlY2lhbEd5bSwgYWRkcmVzcyBfa2l0dHlEYXRhKQogICAgICBwdWJsaWMgCiAgICB7CiAgICAgICAgY29yZSA9IEtpdHR5Q29yZShfa2l0dHlDb3JlKTsKICAgICAgICBjdWRkbGVEYXRhID0gQ3VkZGxlRGF0YShfY3VkZGxlRGF0YSk7CiAgICAgICAgdG9rZW4gPSBDdWRkbGVDb2luKF9jdWRkbGVDb2luKTsKICAgICAgICBraXR0eURhdGEgPSBLaXR0eURhdGEoX2tpdHR5RGF0YSk7CiAgICAgICAgc3BlY2lhbEd5bSA9IF9zcGVjaWFsR3ltOwogICAgICAgIAogICAgICAgIHRyYWluRmVlID0gMDsKICAgICAgICBsZWFybkZlZSA9IDE7CiAgICAgICAgcmVyb2xsRmVlID0gMTsKICAgICAgICBwZXJzb25hbGl0eVR5cGVzID0gNTsKICAgIH0KCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBFWFRFUk5BTCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBvd25lciBvZiBhIGtpdHR5IG1heSB0cmFpbiBvciByZXRyYWluIChyZXNldCBldmVyeXRoaW5nKSBhIGtpdHR5IGhlcmUuCiAgICAgKiBAcGFyYW0gX2tpdHR5SWQgSUQgb2YgS2l0dHkgdG8gdHJhaW4gb3IgcmV0cmFpbi4KICAgICoqLwogICAgZnVuY3Rpb24gdHJhaW5LaXR0eSh1aW50MjU2IF9raXR0eUlkKQogICAgICBleHRlcm5hbAogICAgICBwYXlhYmxlCiAgICAgIGlzTm90Q29udHJhY3QKICAgIHsKICAgICAgICAvLyBNYWtlIHN1cmUgdHJhaW5lciBvd25zIHRoaXMga2l0dHkKICAgICAgICByZXF1aXJlKGNvcmUub3duZXJPZihfa2l0dHlJZCkgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gdHJhaW5GZWUpOwogICAgICAgIAogICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBkZWxldGUgYWxsIGFjdGlvbnMgaWYgdGhlIGtpdHR5IGhhcyBhbHJlYWR5IGJlZW4gdHJhaW5lZC4KICAgICAgICBpZiAoa2l0dHlEYXRhLmZldGNoU2xvdChfa2l0dHlJZCwgMCkgPiAwKSB7CiAgICAgICAgICAgIHZhciAoLGFjdGlvbnNBcnJheSwsKSA9IGtpdHR5RGF0YS5yZXR1cm5LaXR0eShfa2l0dHlJZCk7CiAgICAgICAgICAgIGRlbGV0ZUFjdGlvbnMoX2tpdHR5SWQsIGFjdGlvbnNBcnJheSk7IC8vIEEgc3BlY2lhbCBraXR0eSB3aWxsIGJlIHRocm93biBoZXJlLgogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBuZXdUeXBlID0gcmFuZG9tKHRvdGFsS2l0dGllcyAqIDExLCAxLCBwZXJzb25hbGl0eVR5cGVzKTsgLy8gdXBwZXIgaXMgaW5jbHVzaXZlIGhlcmUKICAgICAgICBraXR0eUFjdGlvbnNbX2tpdHR5SWRdWyhuZXdUeXBlICogMTAwMCkgKyAxXSA9IHRydWU7CiAgICAgICAgCiAgICAgICAgdWludDI1NlsyXSBtZW1vcnkgbmV3VHlwZUFjdGlvbnMgPSByYW5kb21pemVBY3Rpb25zKG5ld1R5cGUsIF9raXR0eUlkKTsKICAgICAgICB1aW50MjU2WzJdIG1lbW9yeSBuZXdBbnlBY3Rpb25zID0gcmFuZG9taXplQWN0aW9ucygwLCBfa2l0dHlJZCk7CgogICAgICAgIHVpbnQyNTZbNV0gbWVtb3J5IG5ld0FjdGlvbnM7CiAgICAgICAgbmV3QWN0aW9uc1swXSA9IChuZXdUeXBlICogMTAwMCkgKyAxOwogICAgICAgIG5ld0FjdGlvbnNbMV0gPSBuZXdUeXBlQWN0aW9uc1swXTsKICAgICAgICBuZXdBY3Rpb25zWzJdID0gbmV3VHlwZUFjdGlvbnNbMV07CiAgICAgICAgbmV3QWN0aW9uc1szXSA9IG5ld0FueUFjdGlvbnNbMF07CiAgICAgICAgbmV3QWN0aW9uc1s0XSA9IG5ld0FueUFjdGlvbnNbMV07CiAgICAgICAgCiAgICAgICAga2l0dHlBY3Rpb25zW19raXR0eUlkXVtuZXdBY3Rpb25zWzFdXSA9IHRydWU7CiAgICAgICAga2l0dHlBY3Rpb25zW19raXR0eUlkXVtuZXdBY3Rpb25zWzJdXSA9IHRydWU7CiAgICAgICAga2l0dHlBY3Rpb25zW19raXR0eUlkXVtuZXdBY3Rpb25zWzNdXSA9IHRydWU7CiAgICAgICAga2l0dHlBY3Rpb25zW19raXR0eUlkXVtuZXdBY3Rpb25zWzRdXSA9IHRydWU7CiAKICAgICAgICBhc3NlcnQoa2l0dHlEYXRhLmFkZEtpdHR5KF9raXR0eUlkLCBuZXdUeXBlLCBuZXdBY3Rpb25zKSk7CiAgICAgICAgS2l0dHlUcmFpbmVkKF9raXR0eUlkLCB0b3RhbEtpdHRpZXMsIG5ld1R5cGUsIG5ld0FjdGlvbnMpOwogICAgICAgIHRvdGFsS2l0dGllcysrOwogICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1heSB0ZWFjaCB5b3VyIGtpdHR5IGEgbmV3IHJhbmRvbSBtb3ZlIGZvciBhIGZlZS4KICAgICAqIEBwYXJhbSBfa2l0dHlJZCBUaGUgSUQgb2YgdGhlIGtpdHR5IHdobyBzaGFsbCBnZXQgYSBtb3ZlIGFkZGVkLgogICAgICogQHBhcmFtIF9tb3ZlU2xvdCBUaGUgYXJyYXkgaW5kZXggdGhhdCB0aGUgbW92ZSBzaGFsbCBiZSBwbGFjZWQgaW4uCiAgICAqKi8KICAgIGZ1bmN0aW9uIGxlYXJuTW92ZSh1aW50MjU2IF9raXR0eUlkLCB1aW50MjU2IF9tb3ZlU2xvdCkKICAgICAgZXh0ZXJuYWwKICAgICAgaXNOb3RDb250cmFjdAogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb3JlLm93bmVyT2YoX2tpdHR5SWQpKTsKICAgICAgICAvLyBCdXJuIHRoZSBsZWFybmluZyBmZWUgZnJvbSB0aGUgdHJhaW5lcidzIGJhbGFuY2UKICAgICAgICBhc3NlcnQodG9rZW4uYnVybihtc2cuc2VuZGVyLCBsZWFybkZlZSkpOwogICAgICAgIHJlcXVpcmUoa2l0dHlEYXRhLmZldGNoU2xvdChfa2l0dHlJZCwgMCkgPiAwKTsgLy8gQ2Fubm90IGxlYXJuIHdpdGhvdXQgdHJhaW5pbmcuCiAgICAgICAgcmVxdWlyZShraXR0eURhdGEuZmV0Y2hTbG90KF9raXR0eUlkLCBfbW92ZVNsb3QpID09IDApOyAvLyBNdXN0IGJlIHB1dCBpbiBibGFuayBzcG90LgogICAgICAgIAogICAgICAgIHVpbnQyNTYgdXBwZXIgPSBjdWRkbGVEYXRhLmdldEFjdGlvbkNvdW50KDApOwogICAgICAgIHVpbnQyNTYgYWN0aW9uSWQgPSB1bmR1cGxpY2F0ZShfa2l0dHlJZCAqIDExLCA5OTksIHVwcGVyLCAwKTsgLy8gKiAxMSBhbmQgOTkuLi5hcmUgYXJiaXRyYXJ5CiAgICAgICAgCiAgICAgICAgYXNzZXJ0KCFraXR0eUFjdGlvbnNbX2tpdHR5SWRdW2FjdGlvbklkXSk7IC8vIFRocm93IGlmIGEgbmV3IG1vdmUgc3RpbGwgd2Fzbid0IGZvdW5kLgogICAgICAgIGtpdHR5QWN0aW9uc1tfa2l0dHlJZF1bYWN0aW9uSWRdID0gdHJ1ZTsKICAgICAgICAKICAgICAgICBhc3NlcnQoa2l0dHlEYXRhLmFkZEFjdGlvbihfa2l0dHlJZCwgYWN0aW9uSWQsIF9tb3ZlU2xvdCkpOwogICAgICAgIE1vdmVMZWFybmVkKF9raXR0eUlkLCBhY3Rpb25JZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1heSByZXJvbGwgb25lIGtpdHR5IG1vdmUuIENoZWFwZXIgdGhhbiBidXlpbmcgYSBuZXcgb25lLgogICAgICogQHBhcmFtIF9raXR0eUlkIFRoZSBraXR0eSB3aG8gbmVlZHMgdG8gcmV0cmFpbiBhIG1vdmUgc2xvdC4KICAgICAqIEBwYXJhbSBfbW92ZVNsb3QgVGhlIGluZGV4IG9mIHRoZSBraXR0eSdzIGFjdGlvbnNBcnJheSB0byByZXBsYWNlLgogICAgICogQHBhcmFtIF90eXBlSWQgVGhlIHBlcnNvbmFsaXR5IElkIG9mIHRoZSBraXR5LgogICAgKiovCiAgICBmdW5jdGlvbiByZVJvbGxNb3ZlKHVpbnQyNTYgX2tpdHR5SWQsIHVpbnQyNTYgX21vdmVTbG90LCB1aW50MjU2IF90eXBlSWQpCiAgICAgIGV4dGVybmFsCiAgICAgIGlzTm90Q29udHJhY3QKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29yZS5vd25lck9mKF9raXR0eUlkKSk7CiAgICAgICAgCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBvbGQgYWN0aW9uIGV4aXN0cyBhbmQgaXMgb2YgdGhlIGNvcnJlY3QgdHlwZSAocHVycG9zZWZ1bCB1bmRlcmZsb3cpLgogICAgICAgIHVpbnQyNTYgb2xkQWN0aW9uID0ga2l0dHlEYXRhLmZldGNoU2xvdChfa2l0dHlJZCwgX21vdmVTbG90KTsKICAgICAgICByZXF1aXJlKG9sZEFjdGlvbiA+IDApOwogICAgICAgIHJlcXVpcmUob2xkQWN0aW9uIC0gKF90eXBlSWQgKiAxMDAwKSA8IDEwMDApOwogICAgICAgIAogICAgICAgIC8vIEJ1cm4gdGhlIHJlcm9sbGluZyBmZWUgZnJvbSB0aGUgdHJhaW5lcidzIGJhbGFuY2UKICAgICAgICBhc3NlcnQodG9rZW4uYnVybihtc2cuc2VuZGVyLCByZXJvbGxGZWUpKTsKCiAgICAgICAgdWludDI1NiB1cHBlciA9IGN1ZGRsZURhdGEuZ2V0QWN0aW9uQ291bnQoX3R5cGVJZCk7CiAgICAgICAgdWludDI1NiBhY3Rpb25JZCA9IHVuZHVwbGljYXRlKF9raXR0eUlkLCBvbGRBY3Rpb24sIHVwcGVyLCBfdHlwZUlkKTsKCiAgICAgICAgYXNzZXJ0KCFraXR0eUFjdGlvbnNbX2tpdHR5SWRdW2FjdGlvbklkXSk7IAogICAgICAgIGtpdHR5QWN0aW9uc1tfa2l0dHlJZF1bb2xkQWN0aW9uXSA9IGZhbHNlOwogICAgICAgIGtpdHR5QWN0aW9uc1tfa2l0dHlJZF1bYWN0aW9uSWRdID0gdHJ1ZTsKICAgICAgICAKICAgICAgICBhc3NlcnQoa2l0dHlEYXRhLmFkZEFjdGlvbihfa2l0dHlJZCwgYWN0aW9uSWQsIF9tb3ZlU2xvdCkpOwogICAgICAgIE1vdmVSZXJvbGxlZChfa2l0dHlJZCwgb2xkQWN0aW9uLCBhY3Rpb25JZCk7CiAgICB9CiAgICAKLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogSU5URVJOQUwgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCiAgICAKICAgIC8qKgogICAgICogQGRldiBSZXR1cm4gdHdvIGFjdGlvbnMgZm9yIHRyYWluaW5nIG9yIGh5YnJpZGl6aW5nIGEga2l0dHkgdXNpbmcgdGhlIGdpdmVuIHR5cGUuCiAgICAgKiBAcGFyYW0gX2FjdGlvblR5cGUgVGhlIHR5cGUgb2YgYWN0aW9ucyB0aGF0IHNoYWxsIGJlIGxlYXJuZWQuIDAgZm9yICJhbnkiIGFjdGlvbnMuCiAgICAgKiBAcGFyYW0gX2tpdHR5SWQgVGhlIHVuaXF1ZSBDSyBJZCBvZiB0aGUga2l0dHkuCiAgICAqKi8gCiAgICBmdW5jdGlvbiByYW5kb21pemVBY3Rpb25zKHVpbnQyNTYgX2FjdGlvblR5cGUsIHVpbnQyNTYgX2tpdHR5SWQpCiAgICAgIGludGVybmFsCiAgICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTZbMl0pCiAgICB7CiAgICAgICAgdWludDI1NiB1cHBlciA9IGN1ZGRsZURhdGEuZ2V0QWN0aW9uQ291bnQoX2FjdGlvblR5cGUpOwogICAgICAgIHVpbnQyNTYgYWN0aW9uMSA9IHVuZHVwbGljYXRlKF9raXR0eUlkLCA5OTksIHVwcGVyLCBfYWN0aW9uVHlwZSk7CiAgICAgICAgdWludDI1NiBhY3Rpb24yID0gdW5kdXBsaWNhdGUoX2tpdHR5SWQsIGFjdGlvbjEsIHVwcGVyLCBfYWN0aW9uVHlwZSk7CiAgICAgICAgcmV0dXJuIFthY3Rpb24xLGFjdGlvbjJdOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgVXNlZCB3aGVuIGEgbmV3IGFjdGlvbiBpcyBjaG9zZW4gYnV0IHRoZSBraXR0eSBhbHJlYWR5IGtub3dzIGl0LgogICAgICogQGRldiBJZiBubyB1bmlxdWUgYWN0aW9ucyBjYW4gYmUgZm91bmQsIHVuZHVwbGljYXRlIHRocm93cy4KICAgICAqIEBwYXJhbSBfa2l0dHlJZCBUaGUgdW5pcXVlIENLIElkIG9mIHRoZSBraXR0eS4KICAgICAqIEBwYXJhbSBfYWN0aW9uMSBUaGUgYWN0aW9uIHRoYXQgaXMgYWxyZWFkeSBrbm93bi4KICAgICAqIEBwYXJhbSBfdXBwZXIgVGhlIGFtb3VudCBvZiBhY3Rpb25zIHRoYXQgY2FuIGJlIHRyaWVkLgogICAgICogQHBhcmFtIF90eXBlIFRoZSB0eXBlIG9mIGFjdGlvbiB0aGF0IHRoZXNlIGFjdGlvbnMgYXJlLgogICAgICogQHJldHVybiBUaGUgbmV3IGFjdGlvbiB0aGF0IGlzIG5vdCBhIGR1cGxpY2F0ZS4KICAgICoqLwogICAgZnVuY3Rpb24gdW5kdXBsaWNhdGUodWludDI1NiBfa2l0dHlJZCwgdWludDI1NiBfYWN0aW9uMSwgdWludDI1NiBfdXBwZXIsIHVpbnQyNTYgX3R5cGUpCiAgICAgIGludGVybmFsCiAgICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTYgbmV3QWN0aW9uKQogICAgewogICAgICAgIHVpbnQyNTYgdHlwZUJhc2UgPSBfdHlwZSAqIDEwMDA7IC8vIFRoZSBiYXNlIHRob3VzYW5kIGZvciB0aGlzIG1vdmUncyB0eXBlLgoKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDE7IGkgPCAxMTsgaSsrKSB7CiAgICAgICAgICAgIG5ld0FjdGlvbiA9IHJhbmRvbShpICogNjY2LCAxLCBfdXBwZXIpICsgdHlwZUJhc2U7CiAgICAgICAgICAgIGlmIChuZXdBY3Rpb24gIT0gX2FjdGlvbjEgJiYgIWtpdHR5QWN0aW9uc1tfa2l0dHlJZF1bbmV3QWN0aW9uXSkgYnJlYWs7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIElmIHRoZSBraXR0eSBzdGlsbCBrbm93cyB0aGUgbW92ZSwgaW5jcmVtZW50IHRpbGwgd2UgZmluZCBvbmUgaXQgZG9lc24ndC4KICAgICAgICBpZiAobmV3QWN0aW9uID09IF9hY3Rpb24xIHx8IGtpdHR5QWN0aW9uc1tfa2l0dHlJZF1bbmV3QWN0aW9uXSkgewogICAgICAgICAgICBmb3IgKHVpbnQyNTYgaiA9IDE7IGogPCBfdXBwZXIgKyAxOyBqKyspIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgaW5jQWN0aW9uID0gKChuZXdBY3Rpb24gKyBqKSAlIF91cHBlcikgKyAxOwoKICAgICAgICAgICAgICAgIGluY0FjdGlvbiArPSB0eXBlQmFzZTsKICAgICAgICAgICAgICAgIGlmIChpbmNBY3Rpb24gIT0gX2FjdGlvbjEgJiYgIWtpdHR5QWN0aW9uc1tfa2l0dHlJZF1baW5jQWN0aW9uXSkgewogICAgICAgICAgICAgICAgICAgIG5ld0FjdGlvbiA9IGluY0FjdGlvbjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IENyZWF0ZSBhIHJhbmRvbSBudW1iZXIuCiAgICAgKiBAcGFyYW0gX3JuZCBTZWVkIHRvIGhlbHAgcmFuZG9taXplLgogICAgICogQHBhcmFtIF9sb3dlciBUaGUgbG93ZXIgYm91bmQgb2YgdGhlIHJhbmRvbSBudW1iZXIgKGluY2x1c2l2ZSkuCiAgICAgKiBAcGFyYW0gX3VwcGVyIFRoZSB1cHBlciBib3VuZCBvZiB0aGUgcmFuZG9tIG51bWJlciAoZXhjbHVzaXZlKS4KICAgICoqLyAKICAgIGZ1bmN0aW9uIHJhbmRvbSh1aW50MjU2IF9ybmQsIHVpbnQyNTYgX2xvd2VyLCB1aW50MjU2IF91cHBlcikgCiAgICAgIGludGVybmFsCiAgICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTYpIAogICAgewogICAgICAgIHVpbnQyNTYgX3NlZWQgPSB1aW50MjU2KGtlY2NhazI1NihrZWNjYWsyNTYoX3JuZCwgX3NlZWQpLCBub3cpKTsKICAgICAgICByZXR1cm4gKF9zZWVkICUgX3VwcGVyKSArIF9sb3dlcjsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFVzZWQgYnkgdHJhaW5LaXR0eSB0byBkZWxldGUgbWFwcGluZyB2YWx1ZXMgaWYgdGhlIGtpdHR5IGhhcyBhbHJlYWR5IGJlZW4gdHJhaW5lZC4KICAgICAqIEBwYXJhbSBfa2l0dHlJZCBUaGUgdW5pcXVlIENLIElkIG9mIHRoZSBraXR0eS4KICAgICAqIEBwYXJhbSBfYWN0aW9ucyBUaGUgbGlzdCBvZiBhbGwgYWN0aW9ucyB0aGUga2l0dHkgY3VycmVudGx5IGhhcy4KICAgICoqLwogICAgZnVuY3Rpb24gZGVsZXRlQWN0aW9ucyh1aW50MjU2IF9raXR0eUlkLCB1aW50MzJbMTJdIF9hY3Rpb25zKQogICAgICBpbnRlcm5hbAogICAgewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9hY3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBhIHNwZWNpYWwga2l0dHkgaXNuJ3QgcmV0cmFpbmVkLiBQdXJwb3NlZnVsIHVuZGVyZmxvdy4KICAgICAgICAgICAgcmVxdWlyZSh1aW50MjU2KF9hY3Rpb25zW2ldKSAtIDUwMDAwID4gMTAwMDAwMDApOwogICAgICAgICAgICAKICAgICAgICAgICAgZGVsZXRlIGtpdHR5QWN0aW9uc1tfa2l0dHlJZF1bdWludDI1NihfYWN0aW9uc1tpXSldOwogICAgICAgIH0KICAgIH0KICAgIAovKiogKioqKioqKioqKioqKioqKioqKioqKioqKiBFWFRFUk5BTCBDT05TVEFOVCAqKioqKioqKioqKioqKioqKioqKioqKioqKioqICoqLwogICAgCiAgICAvKioKICAgICAqIEBkZXYgQ29uZmlybXMgd2hldGhlciBhIGtpdHR5IGhhcyBjaG9zZW4gYWN0aW9ucy4KICAgICAqIEBwYXJhbSBfa2l0dHlJZCBUaGUgaWQgb2YgdGhlIGtpdHR5IHdob3NlIGFjdGlvbnMgbmVlZCB0byBiZSBjaGVja2VkLgogICAgICogQHBhcmFtIF9raXR0eUFjdGlvbnMgVGhlIGFjdGlvbnMgdG8gYmUgY2hlY2tlZC4KICAgICoqLwogICAgZnVuY3Rpb24gY29uZmlybUtpdHR5QWN0aW9ucyh1aW50MjU2IF9raXR0eUlkLCB1aW50MjU2WzhdIF9raXR0eUFjdGlvbnMpIAogICAgICBleHRlcm5hbCAKICAgICAgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgICAgICAgICAgaWYgKCFraXR0eUFjdGlvbnNbX2tpdHR5SWRdW19raXR0eUFjdGlvbnNbaV1dKSByZXR1cm4gZmFsc2U7IAogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAovKiogKioqKioqKioqKioqKioqKioqKioqKioqKiBPTkxZIFZFUklGSUVEL09XTkVSICoqKioqKioqKioqKioqKioqKioqKioqKioqICoqLwogICAgCiAgICAvKioKICAgICAqIEBkZXYgVXNlZCBieSB0aGUgU3BlY2lhbEd5bSBjb250cmFjdCB3aGVuIGEga2l0dHkgbGVhcm5zIG5ldyBzcGVjaWFsIG1vdmVzLgogICAgICogQHBhcmFtIF9raXR0eUlkIFRoZSBJZCBvZiB0aGUgbm93IHNwZWNpYWwga2l0dHkhCiAgICAgKiBAcGFyYW0gX21vdmVzIEEgMi1sZW5ndGggYXJyYXkgd2l0aCB0aGUgbmV3IHNwZWNpYWwgbW92ZXMuCiAgICAqKi8KICAgIGZ1bmN0aW9uIGFkZE1vdmVzKHVpbnQyNTYgX2tpdHR5SWQsIHVpbnQyNTZbMl0gX21vdmVzKQogICAgICBleHRlcm5hbAogICAgICBvbmx5VmVyaWZpZWQKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBraXR0eUFjdGlvbnNbX2tpdHR5SWRdW19tb3Zlc1swXV0gPSB0cnVlOwogICAgICAgIGtpdHR5QWN0aW9uc1tfa2l0dHlJZF1bX21vdmVzWzFdXSA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBVc2VkIGJ5IG93bmVyIHRvIGNoYW5nZSBhbGwgZmVlcyBvbiBLaXR0eUd5bS4KICAgICAqIEBwYXJhbSBfdHJhaW5GZWUgVGhlIG5ldyBjb3N0IChJTiBFVEhFUiBXRUkpIG9mIHRyYWluaW5nIGEgbmV3IGNhdC4KICAgICAqIEBwYXJhbSBfbGVhcm5GZWUgVGhlIG5ldyBjb3N0IChJTiBUT0tFTiBXRUkpIG9mIGxlYXJuaW5nIGEgbmV3IG1vdmUuCiAgICAgKiBAcGFyYW0gX3Jlcm9sbEZlZSBUaGUgbmV3IGNvc3QgKElOIFRPS0VOIFdFSSkgb2YgcmVyb2xsaW5nIGEgbW92ZS4KICAgICoqLwogICAgZnVuY3Rpb24gY2hhbmdlRmVlcyh1aW50MjU2IF90cmFpbkZlZSwgdWludDI1NiBfbGVhcm5GZWUsIHVpbnQyNTYgX3Jlcm9sbEZlZSkKICAgICAgZXh0ZXJuYWwKICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgdHJhaW5GZWUgPSBfdHJhaW5GZWU7CiAgICAgICAgbGVhcm5GZWUgPSBfbGVhcm5GZWU7CiAgICAgICAgcmVyb2xsRmVlID0gX3Jlcm9sbEZlZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVXNlZCBieSBvd25lciB0byBjaGFuZ2UgdGhlIGFtb3VudCBvZiBhY3Rpb25zIHRoZXJlIGFyZS4KICAgICAqIEBwYXJhbSBfbmV3VHlwZUNvdW50IFRoZSBuZXcgbnVtYmVyIG9mIHBlcnNvbmFsaXRpZXMgdGhlcmUgYXJlLgogICAgKiovCiAgICBmdW5jdGlvbiBjaGFuZ2VWYXJpYWJsZXModWludDI1NiBfbmV3VHlwZUNvdW50KQogICAgICBleHRlcm5hbAogICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBpZiAoX25ld1R5cGVDb3VudCAhPSAwKSBwZXJzb25hbGl0eVR5cGVzID0gX25ld1R5cGVDb3VudDsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IE93bmVyIG1heSB1c2UgdG8gY2hhbmdlIGFueS9ldmVyeSBjb25uZWN0ZWQgY29udHJhY3QgYWRkcmVzcy4KICAgICAqIEBkZXYgT3duZXIgbWF5IGxlYXZlIHBhcmFtcyBhcyBudWxsIGFuZCBub3RoaW5nIHdpbGwgaGFwcGVuIHRvIHRoYXQgdmFyaWFibGUuCiAgICAgKiBAcGFyYW0gX25ld0RhdGEgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBjdWRkbGUgZGF0YSBjb250cmFjdCBpZiBkZXNpcmVkLgogICAgICogQHBhcmFtIF9uZXdDb3JlIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0sgY29yZSBjb250cmFjdCBpZiBkZXNpcmVkLgogICAgICogQHBhcmFtIF9uZXdUb2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IGN1ZGRsZSB0b2tlbiBpZiBkZXNpcmVkLgogICAgICogQHBhcmFtIF9uZXdLaXR0eURhdGEgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBLaXR0eURhdGEgY29udHJhY3QuCiAgICAgKiBAcGFyYW0gX25ld1NwZWNpYWxHeW0gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBTcGVjaWFsR3ltIGNvbnRyYWN0LgogICAgKiovCiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cmFjdHMoYWRkcmVzcyBfbmV3RGF0YSwgYWRkcmVzcyBfbmV3Q29yZSwgYWRkcmVzcyBfbmV3VG9rZW4sIGFkZHJlc3MgX25ld0tpdHR5RGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX25ld1NwZWNpYWxHeW0pCiAgICAgIGV4dGVybmFsCiAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIGlmIChfbmV3RGF0YSAhPSAwKSBjdWRkbGVEYXRhID0gQ3VkZGxlRGF0YShfbmV3RGF0YSk7CiAgICAgICAgaWYgKF9uZXdDb3JlICE9IDApIGNvcmUgPSBLaXR0eUNvcmUoX25ld0NvcmUpOwogICAgICAgIGlmIChfbmV3VG9rZW4gIT0gMCkgdG9rZW4gPSBDdWRkbGVDb2luKF9uZXdUb2tlbik7CiAgICAgICAgaWYgKF9uZXdLaXR0eURhdGEgIT0gMCkga2l0dHlEYXRhID0gS2l0dHlEYXRhKF9uZXdLaXR0eURhdGEpOwogICAgICAgIGlmIChfbmV3U3BlY2lhbEd5bSAhPSAwKSBzcGVjaWFsR3ltID0gX25ld1NwZWNpYWxHeW07CiAgICB9CiAgICAKLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqIE1PRElGSUVSUyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqKi8KICAgIAogICAgLyoqCiAgICAqIEBkZXYgRW5zdXJlIG9ubHkgdGhlIGFyZW5hIGNvbnRyYWN0IGNhbiBjYWxsIHBldCBjb3VudC4KICAgICoqLwogICAgbW9kaWZpZXIgb25seVZlcmlmaWVkKCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc3BlY2lhbEd5bSk7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEVuc3VyZSB0aGUgc2VuZGVyIGlzIG5vdCBhIGNvbnRyYWN0LiBUaGlzIHJlbW92ZXMgbW9zdCBvZiAKICAgICAqIEBkZXYgdGhlIHBvc3NpYmlsaXR5IG9mIGFidXNlIG9mIG91ciB0aW1lc3RhbXAvYmxvY2toYXNoIHJhbmRvbWl6ZXJzLgogICAgKiovIAogICAgbW9kaWZpZXIgaXNOb3RDb250cmFjdCgpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgYWRkcmVzcyBhZGRyID0gbXNnLnNlbmRlcjsKICAgICAgICBhc3NlbWJseSB7IHNpemUgOj0gZXh0Y29kZXNpemUoYWRkcikgfQogICAgICAgIHJlcXVpcmUoc2l6ZSA9PSAwKTsKICAgICAgICBfOwogICAgfQogICAgCn0KCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqIFNwZWNpYWwgR3ltICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCgovKioKICogQGRldiBTcGVjaWFsIEd5bSBpcyB1c2VkIHRvIHRyYWluIGtpdHRpZXMgd2l0aCBzcGVjaWFsCiAqIEBkZXYgcGVyc29uYWxpdHkgdHlwZXMgc3VjaCBhcyBncmFkdWF0ZXMuCioqLwpjb250cmFjdCBTcGVjaWFsR3ltIGlzIE93bmFibGUgewogICAgS2l0dHlDb3JlIHB1YmxpYyBjb3JlOwogICAgS2l0dHlEYXRhIHB1YmxpYyBraXR0eURhdGE7CiAgICBDdWRkbGVEYXRhIHB1YmxpYyBjdWRkbGVEYXRhOwogICAgS2l0dHlHeW0gcHVibGljIGtpdHR5R3ltOwogICAgCiAgICAvLyBVbmlxdWUgQ0sgSWQgPT4gdHJ1ZSBpZiB0aGV5IGFscmVhZHkgaGF2ZSBhIHNwZWNpYWwuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGJvb2wpIHB1YmxpYyBzcGVjaWFsS2l0dGllczsKICAgIAogICAgLy8gU3BlY2lhbCBwZXJzb25hbGl0eSBJZCA9PiBudW1iZXIgbGVmdCB0aGF0IG1heSB0cmFpbi4gR3JhZHVhdGVzIGFyZSBJZCA1MC4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gU3BlY2lhbFBlcnNvbmFsaXR5KSBwdWJsaWMgc3BlY2lhbEluZm87CiAgICAKICAgIHN0cnVjdCBTcGVjaWFsUGVyc29uYWxpdHkgewogICAgICAgIHVpbnQxNiBwb3B1bGF0aW9uOyAvLyBUb3RhbCBhbW91bnQgb2YgdGhpcyBzcGVjaWFsIGV2ZXIgYXZhaWxhYmxlLgogICAgICAgIHVpbnQxNiBhbW91bnRMZWZ0OyAvLyBUaGUgbnVtYmVyIG9mIHNwZWNpYWwgcGVyc29uYWxpdGllcyBhdmFpbGFibGUgdG8gYnV5LgogICAgICAgIHVpbnQyNTYgcHJpY2U7IC8vIFByaWNlIG9mIHRoaXMgc3BlY2lhbC4KICAgIH0KICAgIAogICAgZXZlbnQgU3BlY2lhbFRyYWluZWQodWludDI1NiBpbmRleGVkIGtpdHR5SWQsIHVpbnQyNTYgaW5kZXhlZCBzcGVjaWFsSWQsIAogICAgICAgIHVpbnQyNTYgaW5kZXhlZCBzcGVjaWFsUmFuaywgdWludDI1NlsyXSBzcGVjaWFsTW92ZXMpOwogICAgCiAgICBmdW5jdGlvbiBTcGVjaWFsR3ltKGFkZHJlc3MgX2tpdHR5Q29yZSwgYWRkcmVzcyBfa2l0dHlEYXRhLCBhZGRyZXNzIF9jdWRkbGVEYXRhLCBhZGRyZXNzIF9raXR0eUd5bSkKICAgICAgcHVibGljCiAgICB7CiAgICAgICAgY29yZSA9IEtpdHR5Q29yZShfa2l0dHlDb3JlKTsKICAgICAgICBraXR0eURhdGEgPSBLaXR0eURhdGEoX2tpdHR5RGF0YSk7CiAgICAgICAgY3VkZGxlRGF0YSA9IEN1ZGRsZURhdGEoX2N1ZGRsZURhdGEpOwogICAgICAgIGtpdHR5R3ltID0gS2l0dHlHeW0oX2tpdHR5R3ltKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IFVzZWQgdG8gYnV5IGFuIGV4Y2x1c2l2ZSBzcGVjaWFsIHBlcnNvbmFsaXR5IHN1Y2ggYXMgZ3JhZHVhdGUuCiAgICAgKiBAcGFyYW0gX2tpdHR5SWQgVGhlIHVuaXF1ZSBDSyBJZCBvZiB0aGUga2l0dHkgdG8gdHJhaW4uCiAgICAgKiBAcGFyYW0gX3NwZWNpYWxJZCBUaGUgSWQgb2YgdGhlIHNwZWNpYWwgcGVyc29uYWxpdHkgYmVpbmcgdHJhaW5lZC4KICAgICAqIEBwYXJhbSBfc2xvdHMgVGhlIHR3byBtb3ZlIHNsb3RzIHdoZXJlIHRoZSBraXR0eSB3YW50cyB0aGVpciBuZXcgbW92ZXMuCiAgICAqKi8KICAgIGZ1bmN0aW9uIHRyYWluU3BlY2lhbCh1aW50MjU2IF9raXR0eUlkLCB1aW50MjU2IF9zcGVjaWFsSWQsIHVpbnQyNTZbMl0gX3Nsb3RzKQogICAgICBleHRlcm5hbAogICAgICBwYXlhYmxlCiAgICAgIGlzTm90Q29udHJhY3QKICAgIHsKICAgICAgICBTcGVjaWFsUGVyc29uYWxpdHkgc3RvcmFnZSBzcGVjaWFsID0gc3BlY2lhbEluZm9bX3NwZWNpYWxJZF07CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvcmUub3duZXJPZihfa2l0dHlJZCkpOwogICAgICAgIHJlcXVpcmUoa2l0dHlEYXRhLmZldGNoU2xvdChfa2l0dHlJZCwgMCkgPiAwKTsgLy8gUmVxdWlyZSBraXR0eSBoYXMgYmVlbiB0cmFpbmVkLgogICAgICAgIHJlcXVpcmUoIXNwZWNpYWxLaXR0aWVzW19raXR0eUlkXSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gc3BlY2lhbC5wcmljZSk7CiAgICAgICAgcmVxdWlyZShzcGVjaWFsLmFtb3VudExlZnQgPiAwKTsKCiAgICAgICAgLy8gR2V0IHR3byBuZXcgcmFuZG9tIHNwZWNpYWwgbW92ZXMuCiAgICAgICAgdWludDI1NlsyXSBtZW1vcnkgcmFuZG9tTW92ZXMgPSByYW5kb21pemVBY3Rpb25zKF9zcGVjaWFsSWQpOwogICAgICAgIAogICAgICAgIGFzc2VydChraXR0eURhdGEudHJhaW5TcGVjaWFsKF9raXR0eUlkLCBfc3BlY2lhbElkLCByYW5kb21Nb3ZlcywgX3Nsb3RzKSk7CiAgICAgICAgYXNzZXJ0KGtpdHR5R3ltLmFkZE1vdmVzKF9raXR0eUlkLCByYW5kb21Nb3ZlcykpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgc3BlY2lhbFJhbmsgPSBzcGVjaWFsLnBvcHVsYXRpb24gLSBzcGVjaWFsLmFtb3VudExlZnQgKyAxOwogICAgICAgIFNwZWNpYWxUcmFpbmVkKF9raXR0eUlkLCBfc3BlY2lhbElkLCBzcGVjaWFsUmFuaywgcmFuZG9tTW92ZXMpOwogICAgCiAgICAgICAgc3BlY2lhbC5hbW91bnRMZWZ0LS07CiAgICAgICAgc3BlY2lhbEtpdHRpZXNbX2tpdHR5SWRdID0gdHJ1ZTsKICAgICAgICBvd25lci50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgfQogICAgCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIElOVEVSTkFMICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCiAgICAKICAgIC8qKgogICAgICogQGRldiBSZXR1cm4gdHdvIGFjdGlvbnMgZm9yIHRyYWluaW5nIG9yIGh5YnJpZGl6aW5nIGEga2l0dHkgdXNpbmcgdGhlIGdpdmVuIHR5cGUuCiAgICAgKiBAcGFyYW0gX3NwZWNpYWxUeXBlIFRoZSB0eXBlIG9mIGFjdGlvbnMgdGhhdCBzaGFsbCBiZSBsZWFybmVkLiAwIGZvciAiYW55IiBhY3Rpb25zLgogICAgICogQHJldHVybiBUd28gbmV3IHNwZWNpYWwgbW92ZXMuCiAgICAqKi8gCiAgICBmdW5jdGlvbiByYW5kb21pemVBY3Rpb25zKHVpbnQyNTYgX3NwZWNpYWxUeXBlKQogICAgICBpbnRlcm5hbAogICAgICB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2WzJdKQogICAgewogICAgICAgIHVpbnQyNTYgdXBwZXIgPSBjdWRkbGVEYXRhLmdldEFjdGlvbkNvdW50KF9zcGVjaWFsVHlwZSk7CiAgICAgICAgCiAgICAgICAgdWludDI1NiBhY3Rpb24xID0gcmFuZG9tKF9zcGVjaWFsVHlwZSwgMSwgdXBwZXIpOwogICAgICAgIHVpbnQyNTYgYWN0aW9uMiA9IHJhbmRvbShhY3Rpb24xICsgMSwgMSwgdXBwZXIpOwogICAgICAgIGlmIChhY3Rpb24xID09IGFjdGlvbjIpIHsKICAgICAgICAgICAgYWN0aW9uMiA9IHVuZHVwbGljYXRlKGFjdGlvbjEsIHVwcGVyKTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgdHlwZUJhc2UgPSAxMDAwICogX3NwZWNpYWxUeXBlOwogICAgICAgIHJldHVybiBbYWN0aW9uMSArIHR5cGVCYXNlLCBhY3Rpb24yICsgdHlwZUJhc2VdOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgVXNlZCB0byBtYWtlIHN1cmUgdGhlIGtpdHR5IGRvZXNuJ3QgbGVhcm4gdHdvIG9mIHRoZSBzYW1lIG1vdmUuCiAgICAgKiBAZGV2IElmIG5vIHVuaXF1ZSBhY3Rpb25zIGNhbiBiZSBmb3VuZCwgdW5kdXBsaWNhdGUgdGhyb3dzLgogICAgICogQHBhcmFtIF9hY3Rpb24xIFRoZSBhY3Rpb24gdGhhdCBpcyBhbHJlYWR5IGtub3duLgogICAgICogQHBhcmFtIF91cHBlciBUaGUgYW1vdW50IG9mIGFjdGlvbnMgdGhhdCBjYW4gYmUgdHJpZWQuCiAgICAgKiBAcmV0dXJuIFRoZSBuZXcgYWN0aW9uIHRoYXQgaXMgbm90IGEgZHVwbGljYXRlLgogICAgKiovCiAgICBmdW5jdGlvbiB1bmR1cGxpY2F0ZSh1aW50MjU2IF9hY3Rpb24xLCB1aW50MjU2IF91cHBlcikKICAgICAgaW50ZXJuYWwKICAgICAgdmlldwogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICB1aW50MjU2IGFjdGlvbjI7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAxOyBpIDwgMTA7IGkrKykgeyAvLyBTdGFydCBhdCAxIHRvIG1ha2Ugc3VyZSBfcm5kIGlzIG5ldmVyIDEuCiAgICAgICAgICAgIGFjdGlvbjIgPSByYW5kb20oYWN0aW9uMiArIGksIDEsIF91cHBlcik7CiAgICAgICAgICAgIGlmIChhY3Rpb24yICE9IF9hY3Rpb24xKSBicmVhazsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gSWYgdGhlIGtpdHR5IHN0aWxsIGtub3dzIHRoZSBtb3ZlLCBzaW1wbHkgaW5jcmVtZW50LgogICAgICAgIGlmIChhY3Rpb24yID09IF9hY3Rpb24xKSB7CiAgICAgICAgICAgIGFjdGlvbjIgPSAoX2FjdGlvbjEgJSBfdXBwZXIpICsgMTsKICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiBhY3Rpb24yOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlIGEgcmFuZG9tIG51bWJlci4KICAgICAqIEBwYXJhbSBfcm5kIFNlZWQgdG8gaGVscCByYW5kb21pemUuCiAgICAgKiBAcGFyYW0gX2xvd2VyIFRoZSBsb3dlciBib3VuZCBvZiB0aGUgcmFuZG9tIG51bWJlciAoaW5jbHVzaXZlKS4KICAgICAqIEBwYXJhbSBfdXBwZXIgVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSByYW5kb20gbnVtYmVyIChleGNsdXNpdmUpLgogICAgICogQHJldHVybiBSZXR1cm5zIGEgZmFpcmx5IHJhbmRvbSBudW1iZXIuCiAgICAqKi8gCiAgICBmdW5jdGlvbiByYW5kb20odWludDI1NiBfcm5kLCB1aW50MjU2IF9sb3dlciwgdWludDI1NiBfdXBwZXIpIAogICAgICBpbnRlcm5hbAogICAgICB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2KSAKICAgIHsKICAgICAgICB1aW50MjU2IF9zZWVkID0gdWludDI1NihrZWNjYWsyNTYoa2VjY2FrMjU2KF9ybmQsIF9zZWVkKSwgbm93KSk7CiAgICAgICAgcmV0dXJuIChfc2VlZCAlIF91cHBlcikgKyBfbG93ZXI7CiAgICB9CiAgICAKLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogQ09OU1RBTlQgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICoqLwogICAgCiAgICAvKioKICAgICAqIEBkZXYgVXNlZCBieSBmcm9udGVuZCB0byBnZXQgaW5mb3JtYXRpb24gb24gYSBzcGVjaWFsLgogICAgICogQHBhcmFtIF9zcGVjaWFsSWQgVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBzcGVjaWFsIHBlcnNvbmFsaXR5LgogICAgKiovCiAgICBmdW5jdGlvbiBzcGVjaWFsc0luZm8odWludDI1NiBfc3BlY2lhbElkKSAKICAgICAgZXh0ZXJuYWwgCiAgICAgIHZpZXcgCiAgICByZXR1cm5zKHVpbnQyNTYsIHVpbnQyNTYpIAogICAgeyAKICAgICAgICByZXF1aXJlKF9zcGVjaWFsSWQgPiAwKTsgCiAgICAgICAgcmV0dXJuIChzcGVjaWFsSW5mb1tfc3BlY2lhbElkXS5hbW91bnRMZWZ0LCBzcGVjaWFsSW5mb1tfc3BlY2lhbElkXS5wcmljZSk7IAogICAgfQogICAgCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogT05MWSBPV05FUiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCiAgICAKICAgIC8qKgogICAgICogQGRldiBVc2VkIGJ5IG93bmVyIHRvIGNyZWF0ZSBhbmQgcG9wdWxhdGUgYSBuZXcgc3BlY2lhbCBwZXJzb25hbGl0eS4KICAgICAqIEBwYXJhbSBfc3BlY2lhbElkIFRoZSBzcGVjaWFsJ3MgcGVyc29uYWxpdHkgSWQtLXN0YXJ0cyBhdCA1MAogICAgICogQHBhcmFtIF9hbW91bnRBdmFpbGFibGUgVGhlIG1heGltdW0gYW1vdW50IG9mIHRoaXMgc3BlY2lhbCB0aGF0IHdpbGwgZXZlciBiZSBhdmFpbGFibGUuCiAgICAgKiBAcGFyYW0gX3ByaWNlIFRoZSBwcmljZSB0aGF0IHRoZSBzcGVjaWFsIHdpbGwgYmUgc29sZCBmb3IuCiAgICAqKi8KICAgIGZ1bmN0aW9uIGFkZFNwZWNpYWwodWludDI1NiBfc3BlY2lhbElkLCB1aW50MjU2IF9hbW91bnRBdmFpbGFibGUsIHVpbnQyNTYgX3ByaWNlKQogICAgICBleHRlcm5hbAogICAgICBvbmx5T3duZXIKICAgIHsKICAgICAgICBTcGVjaWFsUGVyc29uYWxpdHkgc3RvcmFnZSBzcGVjaWFsID0gc3BlY2lhbEluZm9bX3NwZWNpYWxJZF07CiAgICAgICAgcmVxdWlyZShzcGVjaWFsLnByaWNlID09IDApOwogICAgICAgIAogICAgICAgIHNwZWNpYWwucG9wdWxhdGlvbiA9IHVpbnQxNihfYW1vdW50QXZhaWxhYmxlKTsKICAgICAgICBzcGVjaWFsLmFtb3VudExlZnQgPSB1aW50MTYoX2Ftb3VudEF2YWlsYWJsZSk7CiAgICAgICAgc3BlY2lhbC5wcmljZSA9IF9wcmljZTsgCiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBVc2VkIGJ5IG93bmVyIHRvIGNoYW5nZSBwcmljZSBvZiBhIHNwZWNpYWwga2l0dHkgb3IgbG93ZXIgYXZhaWxhYmxlIHBvcHVsYXRpb24uCiAgICAgKiBAZGV2IE93bmVyIG1heSBOT1QgaW5jcmVhc2UgYXZhaWxhYmxlIHBvcHVsYXRpb24gdG8gZW5zdXJlIHRoZWlyIHJhcml0eSB0byBwbGF5ZXJzLgogICAgICogQHBhcmFtIF9zcGVjaWFsSWQgVGhlIHVuaXF1ZSBJZCBvZiB0aGUgc3BlY2lhbCB0byBlZGl0IChncmFkdWF0ZSBpcyA1MCkuCiAgICAgKiBAcGFyYW0gX25ld1ByaWNlIFRoZSBkZXNpcmVkIG5ldyBwcmljZSBvZiB0aGUgc3BlY2lhbC4KICAgICAqIEBwYXJhbSBfYW1vdW50VG9EZXN0cm95IFRoZSBhbW91bnQgb2YgdGhpcyBzcGVjaWFsIHRoYXQgd2Ugd2FudCB0byBsb3dlciBzdXBwbHkgZm9yLgogICAgKiovCiAgICBmdW5jdGlvbiBlZGl0U3BlY2lhbCh1aW50MjU2IF9zcGVjaWFsSWQsIHVpbnQyNTYgX25ld1ByaWNlLCB1aW50MTYgX2Ftb3VudFRvRGVzdHJveSkKICAgICAgZXh0ZXJuYWwKICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgU3BlY2lhbFBlcnNvbmFsaXR5IHN0b3JhZ2Ugc3BlY2lhbCA9IHNwZWNpYWxJbmZvW19zcGVjaWFsSWRdOwogICAgICAgIAogICAgICAgIGlmIChfbmV3UHJpY2UgIT0gMCkgc3BlY2lhbC5wcmljZSA9IF9uZXdQcmljZTsKICAgICAgICBpZiAoX2Ftb3VudFRvRGVzdHJveSAhPSAwKSB7CiAgICAgICAgICAgIHJlcXVpcmUoX2Ftb3VudFRvRGVzdHJveSA8PSBzcGVjaWFsLnBvcHVsYXRpb24gJiYgX2Ftb3VudFRvRGVzdHJveSA8PSBzcGVjaWFsLmFtb3VudExlZnQpOwogICAgICAgICAgICBzcGVjaWFsLnBvcHVsYXRpb24gLT0gX2Ftb3VudFRvRGVzdHJveTsKICAgICAgICAgICAgc3BlY2lhbC5hbW91bnRMZWZ0IC09IF9hbW91bnRUb0Rlc3Ryb3k7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgT3duZXIgbWF5IHVzZSB0byBjaGFuZ2UgYW55L2V2ZXJ5IGNvbm5lY3RlZCBjb250cmFjdCBhZGRyZXNzLgogICAgICogQGRldiBPd25lciBtYXkgbGVhdmUgcGFyYW1zIGFzIG51bGwgYW5kIG5vdGhpbmcgd2lsbCBoYXBwZW4gdG8gdGhhdCB2YXJpYWJsZS4KICAgICAqIEBwYXJhbSBfbmV3RGF0YSBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IGN1ZGRsZSBkYXRhIGNvbnRyYWN0IGlmIGRlc2lyZWQuCiAgICAgKiBAcGFyYW0gX25ld0NvcmUgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDSyBjb3JlIGNvbnRyYWN0IGlmIGRlc2lyZWQuCiAgICAgKiBAcGFyYW0gX25ld0tpdHR5R3ltIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgS2l0dHlHeW0gaWYgZGVzaXJlZC4KICAgICAqIEBwYXJhbSBfbmV3S2l0dHlEYXRhIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgS2l0dHlEYXRhIGNvbnRyYWN0LgogICAgKiovCiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cmFjdHMoYWRkcmVzcyBfbmV3RGF0YSwgYWRkcmVzcyBfbmV3Q29yZSwgYWRkcmVzcyBfbmV3S2l0dHlEYXRhLCBhZGRyZXNzIF9uZXdLaXR0eUd5bSkKICAgICAgZXh0ZXJuYWwKICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgaWYgKF9uZXdEYXRhICE9IDApIGN1ZGRsZURhdGEgPSBDdWRkbGVEYXRhKF9uZXdEYXRhKTsKICAgICAgICBpZiAoX25ld0NvcmUgIT0gMCkgY29yZSA9IEtpdHR5Q29yZShfbmV3Q29yZSk7CiAgICAgICAgaWYgKF9uZXdLaXR0eURhdGEgIT0gMCkga2l0dHlEYXRhID0gS2l0dHlEYXRhKF9uZXdLaXR0eURhdGEpOwogICAgICAgIGlmIChfbmV3S2l0dHlHeW0gIT0gMCkga2l0dHlHeW0gPSBLaXR0eUd5bShfbmV3S2l0dHlHeW0pOwogICAgfQogICAgCi8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogTU9ESUZJRVJTICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKiovCgogICAgLyoqCiAgICAgKiBAZGV2IEVuc3VyZSB0aGUgc2VuZGVyIGlzIG5vdCBhIGNvbnRyYWN0LiBUaGlzIHJlbW92ZXMgbW9zdCBvZiAKICAgICAqIEBkZXYgdGhlIHBvc3NpYmlsaXR5IG9mIGFidXNlIG9mIG91ciB0aW1lc3RhbXAvYmxvY2toYXNoIHJhbmRvbWl6ZXJzLgogICAgKiovIAogICAgbW9kaWZpZXIgaXNOb3RDb250cmFjdCgpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgYWRkcmVzcyBhZGRyID0gbXNnLnNlbmRlcjsKICAgICAgICBhc3NlbWJseSB7IHNpemUgOj0gZXh0Y29kZXNpemUoYWRkcikgfQogICAgICAgIHJlcXVpcmUoc2l6ZSA9PSAwKTsKICAgICAgICBfOwogICAgfQogICAgCn0KCi8qKgogKiBAdGl0bGUgQ3VkZGxlIENvaW4KICogQGRldiBBIHZlcnkgc3RyYWlnaHRmb3J3YXJkIEVSQzIwIGNvbnRyYWN0IHRoYXQgYWxzbyBoYXMgbWludGluZyBhYmlsaXRpZXMKICogQGRldiBmb3IgcGVvcGxlIHRvIGJlIGFibGUgdG8gd2luIGNvaW5zIGFuZCBwdXJjaGFzZSBjb2lucy4gRUZGRUNUSVZFTFkgQ0VOVFJBTElaRUQhCioqLwoKY29udHJhY3QgQ3VkZGxlQ29pbiBpcyBPd25hYmxlIHsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkNETCI7CiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAiQ3VkZGxlQ29pbiI7CgogICAgYWRkcmVzcyBhcmVuYUNvbnRyYWN0OyAvLyBOZWVkZWQgZm9yIG1pbnRpbmcuCiAgICBhZGRyZXNzIHZlbmRpbmdNYWNoaW5lOyAvLyBOZWVkZWQgZm9yIG1pbnRpbmcgYW5kIGJ1cm5pbmcuCiAgICBhZGRyZXNzIGtpdHR5R3ltOyAvLyBOZWVkZWQgZm9yIGJ1cm5pbmcuCiAgICAKICAgIC8vIFN0b3Jpbmcgc21hbGwgbnVtYmVycyBpcyBjaGVhcGVyLgogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CiAgICB1aW50MjU2IF90b3RhbFN1cHBseSA9IDEwMDAwMDAgKiAoMTAgKiogMTgpOwoKICAgIC8vIEJhbGFuY2VzIGZvciBlYWNoIGFjY291bnQKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgICAvLyBPd25lciBvZiBhY2NvdW50IGFwcHJvdmVzIHRoZSB0cmFuc2ZlciBvZiBhbiBhbW91bnQgdG8gYW5vdGhlciBhY2NvdW50CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgaW5kZXhlZCBfYW1vdW50KTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IGluZGV4ZWQgX2Ftb3VudCk7CiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgaW5kZXhlZCBfYW1vdW50KTsKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIF9mcm9tLCB1aW50MjU2IGluZGV4ZWQgX2Ftb3VudCk7CgogICAgLyoqCiAgICAgKiBAZGV2IFNldCBvd25lciBhbmQgYmVnaW5uaW5nIGJhbGFuY2UuCiAgICAqKi8KICAgIGZ1bmN0aW9uIEN1ZGRsZUNvaW4oYWRkcmVzcyBfYXJlbmFDb250cmFjdCwgYWRkcmVzcyBfdmVuZGluZ01hY2hpbmUpCiAgICAgIHB1YmxpYwogICAgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gX3RvdGFsU3VwcGx5OwogICAgICAgIGFyZW5hQ29udHJhY3QgPSBfYXJlbmFDb250cmFjdDsKICAgICAgICB2ZW5kaW5nTWFjaGluZSA9IF92ZW5kaW5nTWFjaGluZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJuIHRvdGFsIHN1cHBseSBvZiB0b2tlbgogICAgKiovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIAogICAgICBleHRlcm5hbAogICAgICBjb25zdGFudCAKICAgICByZXR1cm5zICh1aW50MjU2KSAKICAgIHsKICAgICAgICByZXR1cm4gX3RvdGFsU3VwcGx5OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm4gYmFsYW5jZSBvZiBhIGNlcnRhaW4gYWRkcmVzcy4KICAgICAqIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgd2hvc2UgYmFsYW5jZSB3ZSB3YW50IHRvIGNoZWNrLgogICAgKiovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpCiAgICAgIGV4dGVybmFsCiAgICAgIGNvbnN0YW50IAogICAgcmV0dXJucyAodWludDI1NikgCiAgICB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVycyBjb2lucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIuCiAgICAgKiBAcGFyYW0gX3RvIFRoZSByZWNpcGllbnQgb2YgdGhlIHRyYW5zZmVyIGFtb3VudC4KICAgICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgKiovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSAKICAgICAgZXh0ZXJuYWwKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICAvLyBUaHJvdyBpZiBpbnN1ZmZpY2llbnQgYmFsYW5jZQogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX2Ftb3VudCk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfYW1vdW50OwoKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBBbiBhbGxvd2VkIGFkZHJlc3MgY2FuIHRyYW5zZmVyIHRva2VucyBmcm9tIGFub3RoZXIncyBhZGRyZXNzLgogICAgICogQHBhcmFtIF9mcm9tIFRoZSBvd25lciBvZiB0aGUgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkLgogICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB3aGljaCB0aGUgdG9rZW5zIHdpbGwgYmUgdHJhbnNmZXJyZWQuCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZC4KICAgICoqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpCiAgICAgIGV4dGVybmFsCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX2Ftb3VudCAmJiBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfYW1vdW50KTsKCiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX2Ftb3VudDsKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF9hbW91bnQ7CiAgICAgICAgCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEFwcHJvdmVzIGEgd2FsbGV0IHRvIHRyYW5zZmVyIHRva2VucyBvbiBvbmUncyBiZWhhbGYuCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIHdhbGxldCBhcHByb3ZlZCB0byBzcGVuZCB0b2tlbnMuCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyBhcHByb3ZlZCB0byBzcGVuZC4KICAgICoqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIAogICAgICBleHRlcm5hbAogICAgewogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA9PSAwIHx8IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX2Ftb3VudCk7CiAgICAgICAgCiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfYW1vdW50OwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dlZCBhbW91bnQgZm9yIGEgdXNlciB0byBzcGVuZCBvZiBhbm90aGVyJ3MgdG9rZW5zLgogICAgICogQHBhcmFtIF9vd25lciBUaGUgb3duZXIgb2YgdGhlIHRva2VucyBhcHByb3ZlZCB0byBzcGVuZC4KICAgICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgdXNlciBhbGxvd2VkIHRvIHNwZW5kIHRoZSB0b2tlbnMuCiAgICAqKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgCiAgICAgIGV4dGVybmFsCiAgICAgIGNvbnN0YW50IAogICAgcmV0dXJucyAodWludDI1NikgCiAgICB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQGRldiBVc2VkIG9ubHkgYmUgdmVuZGluZyBtYWNoaW5lIGFuZCBhcmVuYSBjb250cmFjdCB0byBtaW50IHRvCiAgICAgKiBAZGV2IHRva2VuIHB1cmNoYXNlcyBhbmQgY3VkZGxlcnMgaW4gYSBiYXR0bGUuCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHdoaWNoIGNvaW5zIHdpbGwgYmUgbWludGVkLgogICAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiBjb2lucyB0byBiZSBtaW50ZWQgdG8gdGhhdCBhZGRyZXNzLgogICAgKiovCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpCiAgICAgIGV4dGVybmFsCiAgICAgIG9ubHlNaW50ZXIKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF9hbW91bnQ7CiAgICAgICAgCiAgICAgICAgTWludChfdG8sIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvKioKICAgICAqIEBkZXYgVXNlZCBieSBraXR0eSBneW0gYW5kIHZlbmRpbmcgbWFjaGluZSB0byB0YWtlIGNvaW5zIGZyb20gdXNlcnMuCiAgICAgKiBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhhdmUgY29pbnMgYnVybmVkLgogICAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiBjb2lucyB0aGF0IHdpbGwgYmUgYnVybmVkLgogICAgKiovCiAgICBmdW5jdGlvbiBidXJuKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgZXh0ZXJuYWwKICAgICAgb25seU1pbnRlcgogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX2Zyb21dID49IF9hbW91bnQpOwogICAgICAgIAogICAgICAgIGJhbGFuY2VzW19mcm9tXSAtPSBfYW1vdW50OwogICAgICAgIEJ1cm4oX2Zyb20sIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgICAKICAgIC8qKgogICAgICogQGRldiBPd25lciBteSBjaGFuZ2UgdGhlIGNvbnRyYWN0cyBhbGxvd2VkIHRvIG1pbnQuCiAgICAgKiBAZGV2IFRoaXMgZ2l2ZXMgb3duZXIgZnVsbCBjb250cm9sIG92ZXIgdGhlc2UgdG9rZW5zIGJ1dCBzaW5jZSB0aGV5IGFyZQogICAgICogQGRldiBub3QgYSBub3JtYWwgY3J5cHRvY3VycmVuY3ksIGNlbnRyYWxpemF0aW9uIGlzIG5vdCBhIHByb2JsZW0uCiAgICAgKiBAcGFyYW0gX2FyZW5hQ29udHJhY3QgVGhlIGZpcnN0IGNvbnRyYWN0IGFsbG93ZWQgdG8gbWludCBjb2lucy4KICAgICAqIEBwYXJhbSBfdmVuZGluZ01hY2hpbmUgVGhlIHNlY29uZCBjb250cmFjdCBhbGxvd2VkIHRvIG1pbnQgY29pbnMuCiAgICAqKi8KICAgIGZ1bmN0aW9uIGNoYW5nZU1pbnRlcnMoYWRkcmVzcyBfYXJlbmFDb250cmFjdCwgYWRkcmVzcyBfdmVuZGluZ01hY2hpbmUsIGFkZHJlc3MgX2tpdHR5R3ltKQogICAgICBleHRlcm5hbAogICAgICBvbmx5T3duZXIKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBpZiAoX2FyZW5hQ29udHJhY3QgIT0gMCkgYXJlbmFDb250cmFjdCA9IF9hcmVuYUNvbnRyYWN0OwogICAgICAgIGlmIChfdmVuZGluZ01hY2hpbmUgIT0gMCkgdmVuZGluZ01hY2hpbmUgPSBfdmVuZGluZ01hY2hpbmU7CiAgICAgICAgaWYgKF9raXR0eUd5bSAhPSAwKSBraXR0eUd5bSA9IF9raXR0eUd5bTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBAZGV2IEFyZW5hIGNvbnRyYWN0IGFuZCB2ZW5kaW5nIG1hY2hpbmUgY29udHJhY3QgbXVzdCBiZSBhYmxlIHRvIG1pbnQgY29pbnMuCiAgICAgKiBAZGV2IFRoaXMgbW9kaWZpZXIgZW5zdXJlcyBubyBvdGhlciBjb250cmFjdCBtYXkgYmUgYWJsZSB0byBtaW50LgogICAgICogQGRldiBPd25lciBjYW4gY2hhbmdlIHRoZXNlIHBlcm1pc3Npb25zLgogICAgKiovCiAgICBtb2RpZmllciBvbmx5TWludGVyKCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYXJlbmFDb250cmFjdCB8fCBtc2cuc2VuZGVyID09IHZlbmRpbmdNYWNoaW5lIHx8IG1zZy5zZW5kZXIgPT0ga2l0dHlHeW0pOwogICAgICAgIF87CiAgICB9Cn0='.
	

]
