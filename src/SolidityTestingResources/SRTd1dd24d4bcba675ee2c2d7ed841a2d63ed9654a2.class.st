Class {
	#name : #SRTd1dd24d4bcba675ee2c2d7ed841a2d63ed9654a2,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd1dd24d4bcba675ee2c2d7ed841a2d63ed9654a2 >> base64 [
	^ 'Ly8gVkVSU0lPTiBKCgpwcmFnbWEgc29saWRpdHkgXjAuNC44OwoKCi8vCi8vIEZPUiBSRUZFUkVOQ0UgLSBJTkNMVURFICBpRTRSb3dFc2Nyb3cgIChpbnRlcmZhY2UpIENPTlRSQUNUIGF0IHRoZSB0b3AgLi4uLi4KLy8KCmNvbnRyYWN0IGlFNFJvd0VzY3JvdyB7CglmdW5jdGlvbiBnZXROdW1HYW1lc1N0YXJ0ZWQoKSBjb25zdGFudCByZXR1cm5zIChpbnQgbmdhbWVzKTsKfQoKLy8gQWJzdHJhY3QgY29udHJhY3QgZm9yIHRoZSBmdWxsIEVSQyAyMCBUb2tlbiBzdGFuZGFyZAovLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBBQlNUUkFDVCBzdGFuZGFyZCB0b2tlbiBjbGFzcwovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KY29udHJhY3QgVG9rZW4geyAKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpOwp9CgoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gIEU0Um93UmV3YXJkcyAtIGFic3RyYWN0IGU0IGRpdmlkZW5kIGNvbnRyYWN0Ci8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmNvbnRyYWN0IEU0Um93UmV3YXJkcwp7CglmdW5jdGlvbiBjaGVja0RpdmlkZW5kcyhhZGRyZXNzIF9hZGRyKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2Ftb3VudCk7CglmdW5jdGlvbiB3aXRoZHJhd0RpdmlkZW5kcygpIHB1YmxpYyByZXR1cm5zICh1aW50IG5hbW91bnQpOwp9CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAgRmlubmV5IENoaXAgLSB0b2tlbiBjb250cmFjdAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpjb250cmFjdCBFNFRva2VuIGlzIFRva2VuLCBFNFJvd1Jld2FyZHMgewogICAgCWV2ZW50IFN0YXRFdmVudChzdHJpbmcgbXNnKTsKICAgIAlldmVudCBTdGF0RXZlbnRJKHN0cmluZyBtc2csIHVpbnQgdmFsKTsKCgllbnVtIFNldHRpbmdTdGF0ZVZhbHVlICB7ZGVidWcsIHJlbGVhc2UsIGxvY2tlZFJlbGVhc2V9CgllbnVtIEljb1N0YXR1c1ZhbHVlIHthbm91bmNlbWVudCwgc2FsZU9wZW4sIHNhbGVDbG9zZWQsIGZhaWxlZCwgc3VjY2VlZGVkfQoKCgoKCXN0cnVjdCB0b2tlbkFjY291bnQgewoJCWJvb2wgYWxsb2NlZDsgLy8gZmxhZyB0byBhc2NlcnQgcHJpb3IgYWxsb2NhdGlvbgoJCXVpbnQgdG9rZW5zOyAvLyBudW0gdG9rZW5zCgkJdWludCBiYWxhbmNlOyAvLyByZXdhcmRzIGJhbGFuY2UKCX0KLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gIGRhdGEgc3RvcmFnZQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglhZGRyZXNzIGRldmVsb3BlcnM7IC8vIGRldmVsb3BlcnMgdG9rZW4gaG9sZGluZyBhZGRyZXNzCglhZGRyZXNzIHB1YmxpYyBvd25lcjsgLy8gZGVwbG95ZXIgZXhlY3V0b3IKCWFkZHJlc3MgZm91bmRlck9yZzsgLy8gZm91bmRlciBvcmdpbmFpemF0aW9uIGNvbnRyYWN0CglhZGRyZXNzIGF1eFBhcnRuZXI7IC8vIGF1eCBwYXJ0bmVyIChwci9hdWRpdGluZykgLSAxIHBlcmNlbnQgdXBvbiBjbG9zZQoJYWRkcmVzcyBlNF9wYXJ0bmVyOyAvLyBlNHJvdyAgY29udHJhY3QgYWRkcmVzc2VzCgoKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdG9rZW5BY2NvdW50KSBob2xkZXJBY2NvdW50cyA7IC8vIHdobyBob2xkcyBob3cgbWFueSB0b2tlbnMgKGhpZ2ggdHdvIGJ5dGVzIGNvbnRhaW4gY3VyUGF5SWQpCgltYXBwaW5nICh1aW50ID0+IGFkZHJlc3MpIGhvbGRlckluZGV4ZXMgOyAvLyBmb3IgaXRlcmF0aW9uIHRocnUgaG9sZGVyCgl1aW50IG51bUFjY291bnRzOwoKCXVpbnQgcGFydG5lckNyZWRpdHM7IC8vIGFtb3VudCBwYXJ0bmVyIChlNHJvdykgIGhhcyBwYWlkCgltYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7IC8vIGFwcHJvdmFscwoKCgl1aW50IG1heE1pbnRhYmxlVG9rZW5zOyAvLyAuLi4KCXVpbnQgbWluSWNvVG9rZW5Hb2FsOy8vIHRva2VuIGdvYWwgYnkgc2FsZSBlbmQKCXVpbnQgbWluVXNhZ2VHb2FsOyAvLyAgbnVtIGdhbWVzIGdvYWwgYnkgdXNhZ2UgZGVhZGxpbmUKCXVpbnQgcHVibGljICB0b2tlblByaWNlOyAvLyBwcmljZSBwZXIgdG9rZW4KCXVpbnQgcHVibGljIHBheW91dFRocmVzaG9sZDsgLy8gdGhyZXNob2xkIHRpbGwgcGF5b3V0CgoJdWludCB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZDsgCS8vIHJ1bm5pbmcgdG90YWwgb2YgdG9rZW4gZnVuZHMgcmVjZWl2ZWQKCXVpbnQgcHVibGljIHRvdGFsVG9rZW5zTWludGVkOyAJLy8gdG90YWwgbnVtYmVyIG9mIHRva2VucyBtaW50ZWQKCXVpbnQgcHVibGljIGhvbGRvdmVyQmFsYW5jZTsgCQkvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQKCWludCBwdWJsaWMgcGF5b3V0QmFsYW5jZTsgCQkvLyBob2xkIHRoaXMgYW1vdW50IHVudGlsIHRocmVzaGhvbGQgYmVmb3JlIHJld2FyZCBwYXlvdXQKCWludCBwck9yaWdQYXlvdXRCYWw7CQkJLy8gb3JpZ2luYWwgcGF5b3V0IGJhbGFuY2UgYmVmb3JlIHJ1bgoJdWludCBwck9yaWdUb2tlbnNNaW50OyAJCQkvLyB0b2tlbnMgbWludGVkIGF0IHN0YXJ0IG9mIHBheSBydW4KCXVpbnQgcHVibGljIGN1clBheW91dElkOwkJLy8gY3VycmVudCBwYXlvdXQgaWQKCXVpbnQgcHVibGljIGxhc3RQYXlvdXRJbmRleDsJCS8vIHBheW91dCBpZHggYmV0d2VlbiBydW4gc2VnbWVudHMKCXVpbnQgcHVibGljIG1heFBheXNQZXI7CQkJLy8gbnVtIHBheXMgcGVyIHNlZ21lbnQKCXVpbnQgcHVibGljIG1pblBheUludGVydmFsOwkJLy8gbWluIGludGVydmFsIGJldHdlZW4gc3RhcnQgcGF5IHJ1bgoKCgl1aW50IGZ1bmRpbmdTdGFydDsgCQkvLyBmdW5kaW5nIHN0YXJ0IHRpbWUgaW1tZWRpYXRlbHkgYWZ0ZXIgYW5vdW5jZW1lbnQKCXVpbnQgZnVuZGluZ0RlYWRsaW5lOyAJCS8vIGZ1bmRpbmcgZW5kIHRpbWUKCXVpbnQgdXNhZ2VEZWFkbGluZTsgCQkvLyBkZWFkbGluZSB3aGVyZSBtaW5pbXVtIHVzYWdlIG5lZWRzIHRvIGJlIG1ldCBiZWZvcmUgY29uc2lkZXJlZCBzdWNjZXNzCgl1aW50IHB1YmxpYyBsYXN0UGF5b3V0VGltZTsgCS8vIHRpbWVzdGFtcCBvZiBsYXN0IHBheW91dCB0aW1lCgl1aW50IHZlc3RUaW1lOyAJCS8vIDEgeWVhciBwYXN0IHNhbGUgdmVzdCBkZXZlbG9wZXIgdG9rZW5zCgl1aW50IG51bURldlRva2VuczsgCS8vIDEwIHBlciBjZW50IG9mIHRva2VucyBhZnRlciBjbG9zZSB0byBkZXZlbG9wZXJzCglib29sIGRldmVsb3BlcnNHcmFudGVkOyAJCS8vIGZsYWcKCXVpbnQgcmVtdW5lcmF0aW9uU3RhZ2U7IAkvLyAwIGZvciBub3QgeWV0LCAxIGZvciAxMCBwZXJjZW50LCAyIGZvciByZW1haW5pbmcgIHVwb24gc3VjY2VlZGVkLgoJdWludCBwdWJsaWMgcmVtdW5lcmF0aW9uQmFsYW5jZTsgCS8vIHJlbXVuZXJhdGlvbiBiYWxhbmNlIHRvIHJlbGVhc2UgdG9rZW4gZnVuZHMKCXVpbnQgYXV4UGFydG5lckJhbGFuY2U7IAkvLyBhdXggcGFydG5lciBiYWxhbmNlIC0gMSBwZXJjZW50Cgl1aW50IHJtR2FzOyAvLyByZW11bmVyYXRpb24gZ2FzCgl1aW50IHJ3R2FzOyAvLyByZXdhcmQgZ2FzCgl1aW50IHJmR2FzOyAvLyByZWZ1bmQgZ2FzCgoJSWNvU3RhdHVzVmFsdWUgaWNvU3RhdHVzOyAgLy8gY3VycmVudCBzdGF0dXMgb2YgaWNvCglTZXR0aW5nU3RhdGVWYWx1ZSBwdWJsaWMgc2V0dGluZ3NTdGF0ZTsKCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGNvbnRyYWN0IGNvbnN0cnVjdG9yCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gRTRUb2tlbigpIAoJewoJCW93bmVyID0gbXNnLnNlbmRlcjsKCQlkZXZlbG9wZXJzID0gbXNnLnNlbmRlcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gdXNlIHRoaXMgdG8gcmVzZXQgZXZlcnl0aGluZywgd2lsbCBuZXZlciBiZSBjYWxsZWQgYWZ0ZXIgbG9ja1JlbGVhc2UKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBhcHBseVNldHRpbmdzKFNldHRpbmdTdGF0ZVZhbHVlIHFTdGF0ZSwgdWludCBfc2FsZVN0YXJ0LCB1aW50IF9zYWxlRW5kLCB1aW50IF91c2FnZUVuZCwgdWludCBfbWluVXNhZ2UsIHVpbnQgX3Rva0dvYWwsIHVpbnQgIF9tYXhNaW50YWJsZSwgdWludCBfdGhyZXNob2xkLCB1aW50IF9wcmljZSwgdWludCBfbXBwLCB1aW50IF9tcGkgKQoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyKSAKCQkJcmV0dXJuOwoKCQkvLyB0aGVzZSBzZXR0aW5ncyBhcmUgcGVybWFuZW50bHkgdHdlYWthYmxlIGZvciBwZXJmb3JtYW5jZSBhZGp1c3RtZW50cwoJCXBheW91dFRocmVzaG9sZCA9IF90aHJlc2hvbGQ7CgkJbWF4UGF5c1BlciA9IF9tcHA7CgkJbWluUGF5SW50ZXJ2YWwgPSBfbXBpOwoKCQkvLyB0aGlzIGZpcnN0IHRlc3QgY2hlY2tzIGlmIGFscmVhZHkgbG9ja2VkCgkJaWYgKHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJcmV0dXJuOwoKIAkgCXNldHRpbmdzU3RhdGUgPSBxU3RhdGU7CgoJCS8vIHRoaXMgc2Vjb25kIHRlc3QgYWxsb3dzIGxvY2tpbmcgd2l0aG91dCBjaGFuZ2luZyBvdGhlciBwZXJtYW5lbnQgc2V0dGluZ3MKCQkvLyBXQVJOSU5HLCBNQUtFIFNVUkUgWU9VUidSRSBIQVBQWSBXSVRIIEFMTCBTRVRUSU5HUyAKCQkvLyBCRUZPUkUgTE9DS0lORwoKCQlpZiAocVN0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpIHsKCQkJU3RhdEV2ZW50KCJMb2NraW5nISIpOwoJCQlyZXR1cm47CgkJfQoKCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudDsKCgkJcm1HYXMgPSAxMDAwMDA7IC8vIHJlbXVuZXJhdGlvbiBnYXMKCQlyd0dhcyA9IDEwMDAwOyAvLyByZXdhcmQgZ2FzCgkJcmZHYXMgPSAxMDAwMDsgLy8gcmVmdW5kIGdhcwoKCgkJLy8gemVybyBvdXQgYWxsIHRva2VuIGhvbGRlcnMuICAKCQkvLyBsZWF2ZSBhbGxvY2VkIG9uLCBsZWF2ZSBudW0gYWNjb3VudHMKCQkvLyBjYW50IGRlbGV0ZSB0aGVtIGFueXdheXMKCQoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCA+IDApIHsKCQkJZm9yICh1aW50IGkgPSAwOyBpIDwgbnVtQWNjb3VudHM7IGkrKyApIHsKCQkJCWFkZHJlc3MgYSA9IGhvbGRlckluZGV4ZXNbaV07CgkJCQlpZiAoYSAhPSBhZGRyZXNzKDApKSB7CgkJCQkJaG9sZGVyQWNjb3VudHNbYV0udG9rZW5zID0gMDsKCQkJCQlob2xkZXJBY2NvdW50c1thXS5iYWxhbmNlID0gMDsKCQkJCX0KCQkJfQoJCX0KCQkvLyBkbyBub3QgcmVzZXQgbnVtQWNjb3VudHMhCgoJCXRvdGFsVG9rZW5zTWludGVkID0gMDsgLy8gdGhpcyB3aWxsIGVyYXNlCgkJdG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQgPSAwOyAvLyB0aGlzIHdpbGwgZXJhc2UuCgkJZTRfcGFydG5lciA9IGFkZHJlc3MoMCk7IC8vIG11c3QgYmUgcmVzZXQgYWdhaW4KCgkJZnVuZGluZ1N0YXJ0ID0gIF9zYWxlU3RhcnQ7CgkJZnVuZGluZ0RlYWRsaW5lID0gX3NhbGVFbmQ7CgkJdXNhZ2VEZWFkbGluZSA9IF91c2FnZUVuZDsKCQltaW5Vc2FnZUdvYWwgPSBfbWluVXNhZ2U7CgkJbWluSWNvVG9rZW5Hb2FsID0gX3Rva0dvYWw7CgkJbWF4TWludGFibGVUb2tlbnMgPSBfbWF4TWludGFibGU7CgkJdG9rZW5QcmljZSA9IF9wcmljZTsKCgkJdmVzdFRpbWUgPSBmdW5kaW5nU3RhcnQgKyAoMzY1IGRheXMpOwoJCW51bURldlRva2VucyA9IDA7CgkJCgkJaG9sZG92ZXJCYWxhbmNlID0gMDsKCQlwYXlvdXRCYWxhbmNlID0gMDsKCQljdXJQYXlvdXRJZCA9IDE7CgkJbGFzdFBheW91dEluZGV4ID0gMDsKCQlyZW11bmVyYXRpb25TdGFnZSA9IDA7CgkJcmVtdW5lcmF0aW9uQmFsYW5jZSA9IDA7CgkJYXV4UGFydG5lckJhbGFuY2UgPSAwOwoJCWRldmVsb3BlcnNHcmFudGVkID0gZmFsc2U7CgkJbGFzdFBheW91dFRpbWUgPSAwOwoKCQlpZiAodGhpcy5iYWxhbmNlID4gMCkgewoJCQlpZiAoIW93bmVyLmNhbGwuZ2FzKHJmR2FzKS52YWx1ZSh0aGlzLmJhbGFuY2UpKCkpCgkJCQlTdGF0RXZlbnQoIkVSUk9SISIpOwoJCX0KCQlTdGF0RXZlbnQoIm9rIik7CgoJfQoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHRva2VucyBoZWxkIHJlc2VydmUgdGhlIHRvcCB0d28gYnl0ZXMgZm9yIHRoZSBwYXlpZCBsYXN0IHBhaWQuCgkvLyB0aGlzIGlzIHNvIGhvbGRlcnMgYXQgdGhlIHRvcCBvZiB0aGUgbGlzdCBkb250IHRyYW5zZmVyIHRva2VucyAKCS8vIHRvIHRoZW1zZWx2ZXMgb24gdGhlIGJvdHRvbSBvZiB0aGUgbGlzdCB0aHVzIHNjYW1taW5nIHRoZSAKCS8vIHN5c3RlbS4gdGhpcyBmdW5jdGlvbiBkZWNvbnN0cnVjdHMgdGhlIHRva2VuaGVsZCB2YWx1ZS4KCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0UGF5SWRBbmRIZWxkKHVpbnQgX3Rva0hlbGQpIGludGVybmFsIHJldHVybnMgKHVpbnQgX3BheUlkLCB1aW50IF9oZWxkKQoJewoJCV9wYXlJZCA9IChfdG9rSGVsZCAvICgyICoqIDQ4KSkgJiAweGZmZmY7CgkJX2hlbGQgPSBfdG9rSGVsZCAmIDB4ZmZmZmZmZmZmZmZmOwoJfQoJZnVuY3Rpb24gZ2V0SGVsZCh1aW50IF90b2tIZWxkKSBpbnRlcm5hbCAgcmV0dXJucyAodWludCBfaGVsZCkKCXsKCQlfaGVsZCA9IF90b2tIZWxkICYgMHhmZmZmZmZmZmZmZmY7Cgl9CgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGFsbG9jYXRlIGEgbmV3IGFjY291bnQgYnkgc2V0dGluZyBhbGxvYyB0byB0cnVlCgkvLyBzZXQgdGhlIHRvcCB0byBieXRlcyBvZiB0b2tlbnMgdG8gY3VyIHBheSBpZCB0byBsZWF2ZSBvdXQgb2YgY3VycmVudCByb3VuZAoJLy8gYWRkIGhvbGRlciBpbmRleCwgYnVtcCB0aGUgbnVtIGFjY291bnRzCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGFkZEFjY291bnQoYWRkcmVzcyBfYWRkcikgaW50ZXJuYWwgIHsKCQlob2xkZXJBY2NvdW50c1tfYWRkcl0uYWxsb2NlZCA9IHRydWU7CgkJaG9sZGVyQWNjb3VudHNbX2FkZHJdLnRva2VucyA9IChjdXJQYXlvdXRJZCAqICgyICoqIDQ4KSk7CgkJaG9sZGVySW5kZXhlc1tudW1BY2NvdW50cysrXSA9IF9hZGRyOwoJfQoJCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBCRUdJTiBFUkMtMjAgZnJvbSBTdGFuZGFyZFRva2VuCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KQoJewoJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW4KCQkJfHwgaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLmFub3VuY2VtZW50KQoJCQlzdXBwbHkgPSBtYXhNaW50YWJsZVRva2VuczsKCQllbHNlCgkJCXN1cHBseSA9IHRvdGFsVG9rZW5zTWludGVkOwoJfQoKCWZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgoJCWlmICgobXNnLnNlbmRlciA9PSBkZXZlbG9wZXJzKSAKCQkJJiYgIChub3cgPCB2ZXN0VGltZSkpIHsKCQkJLy9zdGF0RXZlbnQoIlRva2VucyBub3QgeWV0IHZlc3RlZC4iKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgoJICAgICAgICAvL0RlZmF1bHQgYXNzdW1lcyB0b3RhbFN1cHBseSBjYW4ndCBiZSBvdmVyIG1heCAoMl4yNTYgLSAxKS4KCSAgICAgICAgLy9JZiB5b3VyIHRva2VuIGxlYXZlcyBvdXQgdG90YWxTdXBwbHkgYW5kIGNhbiBpc3N1ZSBtb3JlIHRva2VucyBhcyB0aW1lIGdvZXMgb24sIHlvdSBuZWVkIHRvIGNoZWNrIGlmIGl0IGRvZXNuJ3Qgd3JhcC4KCSAgICAgICAgLy9SZXBsYWNlIHRoZSBpZiB3aXRoIHRoaXMgb25lIGluc3RlYWQuCgkgICAgICAgIC8vaWYgKGhvbGRlckFjY291bnRzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gaG9sZGVyQWNjb3VudHNbX3RvXSkgewoKCQl2YXIgKHBpZEZyb20sIGhlbGRGcm9tKSA9IGdldFBheUlkQW5kSGVsZChob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXS50b2tlbnMpOwoJICAgICAgICBpZiAoaGVsZEZyb20gPj0gX3ZhbHVlICYmIF92YWx1ZSA+IDApIHsKCgkgICAgICAgICAgICBob2xkZXJBY2NvdW50c1ttc2cuc2VuZGVyXS50b2tlbnMgLT0gX3ZhbHVlOwoKCQkgICAgaWYgKCFob2xkZXJBY2NvdW50c1tfdG9dLmFsbG9jZWQpIHsKCQkJYWRkQWNjb3VudChfdG8pOwoJCSAgICB9CgoJCSAgICB1aW50IG5ld0hlbGQgPSBfdmFsdWUgKyBnZXRIZWxkKGhvbGRlckFjY291bnRzW190b10udG9rZW5zKTsKCQkgICAgaG9sZGVyQWNjb3VudHNbX3RvXS50b2tlbnMgPSBuZXdIZWxkIHwgKHBpZEZyb20gKiAoMiAqKiA0OCkpOwoJICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwoJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgIH0gZWxzZSB7IAoJCQlyZXR1cm4gZmFsc2U7IAoJCX0KICAgIAl9CgogICAgCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKCQlpZiAoKF9mcm9tID09IGRldmVsb3BlcnMpIAoJCQkmJiAgKG5vdyA8IHZlc3RUaW1lKSkgewoJCQkvL3N0YXRFdmVudCgiVG9rZW5zIG5vdCB5ZXQgdmVzdGVkLiIpOwoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCiAgICAgICAgLy9zYW1lIGFzIGFib3ZlLiBSZXBsYWNlIHRoaXMgbGluZSB3aXRoIHRoZSBmb2xsb3dpbmcgaWYgeW91IHdhbnQgdG8gcHJvdGVjdCBhZ2FpbnN0IHdyYXBwaW5nIHVpbnRzLgogICAgICAgIC8vaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7CgoJCXZhciAocGlkRnJvbSwgaGVsZEZyb20pID0gZ2V0UGF5SWRBbmRIZWxkKGhvbGRlckFjY291bnRzW19mcm9tXS50b2tlbnMpOwogICAgICAgIAlpZiAoaGVsZEZyb20gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBfdmFsdWUgPiAwKSB7CgkgICAgICAgICAgICBob2xkZXJBY2NvdW50c1tfZnJvbV0udG9rZW5zIC09IF92YWx1ZTsKCgkJICAgIGlmICghaG9sZGVyQWNjb3VudHNbX3RvXS5hbGxvY2VkKQoJCQlhZGRBY2NvdW50KF90byk7CgoJCSAgICB1aW50IG5ld0hlbGQgPSBfdmFsdWUgKyBnZXRIZWxkKGhvbGRlckFjY291bnRzW190b10udG9rZW5zKTsKCgkJICAgIGhvbGRlckFjY291bnRzW190b10udG9rZW5zID0gbmV3SGVsZCB8IChwaWRGcm9tICogKDIgKiogNDgpKTsKCSAgICAgICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKCSAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgfSBlbHNlIHsgCgkJICAgIHJldHVybiBmYWxzZTsgCgkJfQoJfQoKCiAgICAJZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKCQkvLyB2YXJzIGRlZmF1bHQgdG8gMAoJCWlmIChob2xkZXJBY2NvdW50c1tfb3duZXJdLmFsbG9jZWQpIHsKCSAgICAgICAgCWJhbGFuY2UgPSBnZXRIZWxkKGhvbGRlckFjY291bnRzW19vd25lcl0udG9rZW5zKTsKCQl9IAogICAgCX0KCiAgICAJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgCWFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIAlBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICAJcmV0dXJuIHRydWU7CiAgICAJfQoKICAgIAlmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgIAkJcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICAJfQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEVORCBFUkMyMAovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIAoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gY2hlY2sgdGhlIGFsbG9jZWQKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGhvbGRlckV4aXN0cyhhZGRyZXNzIF9hZGRyKSByZXR1cm5zKGJvb2wgX2V4aXN0KQoJewoJCV9leGlzdCA9IGhvbGRlckFjY291bnRzW19hZGRyXS5hbGxvY2VkOwoJfQoKCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gZGVmYXVsdCBwYXlhYmxlIGZ1bmN0aW9uLgoJLy8gaWYgc2VuZGVyIGlzIGU0cm93ICBwYXJ0bmVyLCB0aGlzIGlzIGEgcmFrZSBmZWUgcGF5bWVudAoJLy8gb3RoZXJ3aXNlIHRoaXMgaXMgYSB0b2tlbiBwdXJjaGFzZS4KCS8vIHRva2VucyBvbmx5IHB1cmNoYXNlYWJsZSBiZXR3ZWVuIHRva2VuZnVuZGluZ3N0YXJ0IGFuZCBlbmQKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uICgpIHBheWFibGUgewoJCWlmIChtc2cuc2VuZGVyID09IGU0X3BhcnRuZXIpIHsKCQkgICAgIGZlZVBheW1lbnQoKTsgLy8gZnJvbSBlNHJvdyBnYW1lIGVzY3JvdyBjb250cmFjdAoJCX0gZWxzZSB7CgkJICAgICBwdXJjaGFzZVRva2VuKCk7CgkJfQoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBwdXJjaGFzZSB0b2tlbiBmdW5jdGlvbiAtIHRva2VucyBvbmx5IHNvbGQgZHVyaW5nIHNhbGUgcGVyaW9kIHVwIHVudGlsIHRoZSBtYXggdG9rZW5zCgkvLyBwdXJjaGFzZSBwcmljZSBpcyB0b2tlblByaWNlLiAgYWxsIHVuaXRzIGluIHdlaS4KCS8vIHB1cmNoYXNlciB3aWxsIG5vdCBiZSBpbmNsdWRlZCBpbiBjdXJyZW50IHBheSBydW4KCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBwdXJjaGFzZVRva2VuKCkgcGF5YWJsZSB7CgoJCXVpbnQgbnZhbHVlID0gbXNnLnZhbHVlOyAvLyBiZWluZyBjYXJlZnVsIHRvIHByZXNlcnZlIG1zZy52YWx1ZQoJCWFkZHJlc3MgbnB1cmNoYXNlciA9IG1zZy5zZW5kZXI7CgkJaWYgKG52YWx1ZSA8IHRva2VuUHJpY2UpIAoJCQl0aHJvdzsKCgkJdWludCBxdHkgPSBudmFsdWUvdG9rZW5QcmljZTsKCQl1cGRhdGVJY29TdGF0dXMoKTsKCQlpZiAoaWNvU3RhdHVzICE9IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuKSAvLyBwdXJjaGFzZSBpcyBjbG9zZWQKCQkJdGhyb3c7CgkJaWYgKHRvdGFsVG9rZW5zTWludGVkICsgcXR5ID4gbWF4TWludGFibGVUb2tlbnMpCgkJCXRocm93OwoJCWlmICghaG9sZGVyQWNjb3VudHNbbnB1cmNoYXNlcl0uYWxsb2NlZCkKCQkJYWRkQWNjb3VudChucHVyY2hhc2VyKTsKCQkKCQkvLyBwdXJjaGFzZXIgd2FpdHMgZm9yIG5leHQgcGF5cnVuLiBvdGhlcndpc2UgY2FuIGRpc3J1cHQgY3VyIHBheSBydW4KCQl1aW50IG5ld0hlbGQgPSBxdHkgKyBnZXRIZWxkKGhvbGRlckFjY291bnRzW25wdXJjaGFzZXJdLnRva2Vucyk7CgkJaG9sZGVyQWNjb3VudHNbbnB1cmNoYXNlcl0udG9rZW5zID0gbmV3SGVsZCB8IChjdXJQYXlvdXRJZCAqICgyICoqIDQ4KSk7CgoJCXRvdGFsVG9rZW5zTWludGVkICs9IHF0eTsKCQl0b3RhbFRva2VuRnVuZHNSZWNlaXZlZCArPSBudmFsdWU7CgoJCWlmICh0b3RhbFRva2Vuc01pbnRlZCA9PSBtYXhNaW50YWJsZVRva2VucykgewoJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zYWxlQ2xvc2VkOwoJCQkvL3Rlc3QgdW5uZWNlc3NhcnkgLSAgaWYgKGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkKCQkJZG9EZXZlbG9wZXJHcmFudCgpOwoJCQlTdGF0RXZlbnRJKCJQdXJjaGFzZWQsR3JhbnRlZCIsIHF0eSk7CgkJfSBlbHNlCgkJCVN0YXRFdmVudEkoIlB1cmNoYXNlZCIsIHF0eSk7CgoJfQoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGFjY2VwdCBwYXltZW50IGZyb20gZTRyb3cgY29udHJhY3QKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZmVlUGF5bWVudCgpIHBheWFibGUgIAoJewoJCWlmIChtc2cuc2VuZGVyICE9IGU0X3BhcnRuZXIpIHsKCQkJU3RhdEV2ZW50KCJmb3JiaWRkZW4iKTsKCQkJcmV0dXJuOyAvLyB0aGFuayB5b3UKCQl9CgkJdWludCBuZnZhbHVlID0gbXNnLnZhbHVlOyAvLyBwcmVzZXJ2ZSB2YWx1ZSBpbiBjYXNlIGNoYW5nZWQgaW4gZGV2IGdyYW50CgoJCXVwZGF0ZUljb1N0YXR1cygpOwoKCQlob2xkb3ZlckJhbGFuY2UgKz0gbmZ2YWx1ZTsKCQlwYXJ0bmVyQ3JlZGl0cyArPSBuZnZhbHVlOwoJCVN0YXRFdmVudEkoIlBheW1lbnQiLCBuZnZhbHVlKTsKCgkJaWYgKGhvbGRvdmVyQmFsYW5jZSA+IHBheW91dFRocmVzaG9sZAoJCQl8fCBwYXlvdXRCYWxhbmNlID4gMCkKCQkJZG9QYXlvdXQobWF4UGF5c1Blcik7CgkJCgkKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHNldCB0aGUgZTRyb3cgcGFydG5lciwgdGhpcyBpcyBvbmx5IGRvbmUgb25jZQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBzZXRFNFJvd1BhcnRuZXIoYWRkcmVzcyBfYWRkcikgcHVibGljCQoJewoJLy8gT05MWSBvd25lciBjYW4gc2V0IGFuZCBPTkxZIE9OQ0UhICh1bmxlc3MgInVubG9ja2VkIiBkZWJ1ZykKCS8vIG9uY2UgaXRzIGxvY2tlZC4gT05MWSBPTkNFIQoJCWlmIChtc2cuc2VuZGVyID09IG93bmVyKSB7CgkJCWlmICgoZTRfcGFydG5lciA9PSBhZGRyZXNzKDApKSB8fCAoc2V0dGluZ3NTdGF0ZSA9PSBTZXR0aW5nU3RhdGVWYWx1ZS5kZWJ1ZykpIHsKCQkJCWU0X3BhcnRuZXIgPSBfYWRkcjsKCQkJCXBhcnRuZXJDcmVkaXRzID0gMDsKCQkJCS8vU3RhdEV2ZW50SSgiRTQtU2V0IiwgMCk7CgkJCX0gZWxzZSB7CgkJCQlTdGF0RXZlbnQoIkFscmVhZHkgU2V0Iik7CgkJCX0KCQl9Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcmV0dXJuIHRoZSB0b3RhbCB0b2tlbnMgcHVyY2hhc2VkCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX3B1cmNoYXNlZCkKCXsKCQlfcHVyY2hhc2VkID0gdG90YWxUb2tlbnNNaW50ZWQtbnVtRGV2VG9rZW5zOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHJldHVybiB0aGUgbnVtIGdhbWVzIGFzIHJlcG9ydGVkIGZyb20gdGhlIGU0cm93ICBjb250cmFjdAoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0TnVtR2FtZXMoKSBjb25zdGFudCByZXR1cm5zKHVpbnQgX2dhbWVzKQoJewoJCS8vX2dhbWVzID0gMDsKCQlpZiAoZTRfcGFydG5lciAhPSBhZGRyZXNzKDApKSB7CgkJCWlFNFJvd0VzY3JvdyBwZTQgPSBpRTRSb3dFc2Nyb3coZTRfcGFydG5lcik7CgkJCV9nYW1lcyA9IHVpbnQocGU0LmdldE51bUdhbWVzU3RhcnRlZCgpKTsKCQl9IAoJCS8vZWxzZQoJCS8vU3RhdEV2ZW50KCJFbXB0eSBFNCIpOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gZ2V0IHRoZSBmb3VuZGVycywgYXV4UGFydG5lciwgZGV2ZWxvcGVyCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0U3BlY2lhbEFkZHJlc3NlcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgX2ZuZHIsIGFkZHJlc3MgX2F1eCwgYWRkcmVzcyBfZGV2LCBhZGRyZXNzIF9lNCkKCXsKCQkvL2lmIChfc2VuZGVyID09IG93bmVyKSB7IC8vIG5vIG1zZy5zZW5kZXIgb24gY29uc3RhbnQgZnVuY3Rpb25zIGF0IGxlYXN0IGluIG1ldwoJCQlfZm5kciA9IGZvdW5kZXJPcmc7CgkJCV9hdXggPSBhdXhQYXJ0bmVyOwoJCQlfZGV2ID0gZGV2ZWxvcGVyczsKCQkJX2U0ICA9IGU0X3BhcnRuZXI7CgkJLy99Cgl9CgoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyB1cGRhdGUgdGhlIGljbyBzdGF0dXMKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHVwZGF0ZUljb1N0YXR1cygpIHB1YmxpYwoJewoJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc3VjY2VlZGVkIAoJCQl8fCBpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuZmFpbGVkKQoJCQlyZXR1cm47CgkJZWxzZSBpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLmFub3VuY2VtZW50KSB7CgkJCWlmIChub3cgPiBmdW5kaW5nU3RhcnQgJiYgbm93IDw9IGZ1bmRpbmdEZWFkbGluZSkgewoJCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW47CgkJCQkKCQkJfSBlbHNlIGlmIChub3cgPiBmdW5kaW5nRGVhZGxpbmUpIHsKCQkJCS8vIHNob3VsZCBub3QgYmUgaGVyZSAtIHRoaXMgd2lsbCBldmVudHVhbGx5IGZhaWwKCQkJCWljb1N0YXR1cyA9IEljb1N0YXR1c1ZhbHVlLnNhbGVDbG9zZWQ7CgkJCX0KCQl9IGVsc2UgewoJCQl1aW50IG51bVAgPSBnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKTsKCQkJdWludCBudW1HID0gZ2V0TnVtR2FtZXMoKTsKCQkJaWYgKChub3cgPiBmdW5kaW5nRGVhZGxpbmUgJiYgbnVtUCA8IG1pbkljb1Rva2VuR29hbCkKCQkJCXx8IChub3cgPiB1c2FnZURlYWRsaW5lICYmIG51bUcgPCBtaW5Vc2FnZUdvYWwpKSB7CgkJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5mYWlsZWQ7CgkJCX0gZWxzZSBpZiAoKG5vdyA+IGZ1bmRpbmdEZWFkbGluZSkgLy8gZG9udCB3YW50IHRvIHByZXZlbnQgbW9yZSB0b2tlbiBzYWxlcwoJCQkJJiYgKG51bVAgPj0gbWluSWNvVG9rZW5Hb2FsKQoJCQkJJiYgKG51bUcgPj0gbWluVXNhZ2VHb2FsKSkgewoJCQkJaWNvU3RhdHVzID0gSWNvU3RhdHVzVmFsdWUuc3VjY2VlZGVkOyAvLyBob29yYXkKCQkJfQoJCQlpZiAoaWNvU3RhdHVzID09IEljb1N0YXR1c1ZhbHVlLnNhbGVPcGVuCgkJCQkmJiAoKG51bVAgPj0gbWF4TWludGFibGVUb2tlbnMpCgkJCQl8fCAobm93ID4gZnVuZGluZ0RlYWRsaW5lKSkpIHsKCQkJCQlpY29TdGF0dXMgPSBJY29TdGF0dXNWYWx1ZS5zYWxlQ2xvc2VkOwoJCQkJfQoJCX0KCgkJaWYgKCFkZXZlbG9wZXJzR3JhbnRlZAoJCQkmJiBpY29TdGF0dXMgIT0gSWNvU3RhdHVzVmFsdWUuc2FsZU9wZW4gCgkJCSYmIGljb1N0YXR1cyAhPSBJY29TdGF0dXNWYWx1ZS5hbm91bmNlbWVudAoJCQkmJiBnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpIHsKCQkJCWRvRGV2ZWxvcGVyR3JhbnQoKTsgLy8gZ3JhbnQgd2hlbmV2ZXIgc3RhdHVzIGdvZXMgZnJvbSBvcGVuIHRvIGFueXRoaW5nLi4uCgkJfQoKCQoJfQoKCQoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcmVxdWVzdCByZWZ1bmQuIENhbGxlciBtdXN0IGNhbGwgdG8gcmVxdWVzdCBhbmQgcmVjZWl2ZSByZWZ1bmQgCgkvLyBXQVJOSU5HIC0gd2l0aGRyYXcgcmV3YXJkcy9kaXZpZGVuZHMgYmVmb3JlIGNhbGxpbmcuCgkvLyBZT1UgSEFWRSBCRUVOIFdBUk5FRAoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gcmVxdWVzdFJlZnVuZCgpCgl7CgkJYWRkcmVzcyBucmVxdWVzdGVyID0gbXNnLnNlbmRlcjsKCQl1cGRhdGVJY29TdGF0dXMoKTsKCgkJdWludCBudG9rZW5zID0gZ2V0SGVsZChob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS50b2tlbnMpOwoJCWlmIChpY29TdGF0dXMgIT0gSWNvU3RhdHVzVmFsdWUuZmFpbGVkKQoJCQlTdGF0RXZlbnQoIk5vIFJlZnVuZCIpOwoJCWVsc2UgaWYgKG50b2tlbnMgPT0gMCkKCQkJU3RhdEV2ZW50KCJObyBUb2tlbnMiKTsKCQllbHNlIHsKCQkJdWludCBucmVmdW5kID0gbnRva2VucyAqIHRva2VuUHJpY2U7CgkJCWlmIChnZXROdW1Ub2tlbnNQdXJjaGFzZWQoKSA+PSBtaW5JY29Ub2tlbkdvYWwpCgkJCQlucmVmdW5kIC09IChucmVmdW5kIC8xMCk7IC8vIG9ubHkgOTAgcGVyY2VudCBiL2MgMTAgcGVyY2VudCBwYXlvdXQKCgkJCWhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLnRva2VucyArPSBudG9rZW5zOwoJCQlob2xkZXJBY2NvdW50c1tucmVxdWVzdGVyXS50b2tlbnMgPSAwOwoJCQlpZiAoaG9sZGVyQWNjb3VudHNbbnJlcXVlc3Rlcl0uYmFsYW5jZSA+IDApIHsKCQkJCS8vIHNlZSBhYm92ZSB3YXJuaW5nISEKCQkJCWlmICghaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10uYWxsb2NlZCkgCgkJCQkJYWRkQWNjb3VudChkZXZlbG9wZXJzKTsKCQkJCWhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLmJhbGFuY2UgKz0gaG9sZGVyQWNjb3VudHNbbnJlcXVlc3Rlcl0uYmFsYW5jZTsKCQkJCWhvbGRlckFjY291bnRzW25yZXF1ZXN0ZXJdLmJhbGFuY2UgPSAwOwoJCQl9CgoJCQlpZiAoIW5yZXF1ZXN0ZXIuY2FsbC5nYXMocmZHYXMpLnZhbHVlKG5yZWZ1bmQpKCkpCgkJCQl0aHJvdzsKCQkJLy9TdGF0RXZlbnRJKCJSZWZ1bmRlZCIsIG5yZWZ1bmQpOwoJCX0KCX0KCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gcGF5b3V0IHJld2FyZHMgdG8gYWxsIHRva2VuIGhvbGRlcnMKCS8vIHVzZSBhIHNlY29uZCBob2xkaW5nIHZhcmlhYmxlIGNhbGxlZCBQYXlvdXRCYWxhbmNlIHRvIGRvIAoJLy8gdGhlIGFjdHVhbCBwYXlvdXQgZnJvbSBiL2MgdG9vIG11Y2ggZ2FzIHRvIGl0ZXJhdGUgdGhydSAKCS8vIGVhY2ggcGF5ZWUuIE9ubHkgc3RhcnQgYSBuZXcgcnVuIGF0IG1vc3Qgb25jZSBwZXIgIm1pbnBheWludGVydmFsIi4KCS8vIEl0cyBkb25lIGluIHJ1bnMgb2YgIl9udW1QYXlzIgoJLy8gd2UgdXNlIHNwZWNpYWwgY29kaW5nIGZvciB0aGUgaG9sZGVyQWNjb3VudHMgdG8gYXZvaWQgYSBoYWNrCgkvLyBvZiBnZXR0aW5nIHBhaWQgYXQgdGhlIHRvcCBvZiB0aGUgbGlzdCB0aGVuIHRyYW5zZmVyaW5nIHRva2VucwoJLy8gdG8gYW5vdGhlciBhZGRyZXNzIGF0IHRoZSBib3R0b20gb2YgdGhlIGxpc3QuCgkvLyBiZWNhdXNlIG9mIHRoYXQgZWFjaCBob2xkZXJBY2NvdW50cyBlbnRyeSBnZXRzIHRoZSBwYXlvdXRpZCBzdGFtcGVkIHVwb24gaXQgKHRvcCB0d28gYnl0ZXMpCgkvLyBhbHNvIGEgdG9rZW4gdHJhbnNmZXIgd2lsbCB0cmFuc2ZlciB0aGUgcGF5b3V0IGlkLgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBkb1BheW91dCh1aW50IF9udW1QYXlzKSAgaW50ZXJuYWwKCXsKCQlpZiAodG90YWxUb2tlbnNNaW50ZWQgPT0gMCkKCQkJcmV0dXJuOwoKCQlpZiAoKGhvbGRvdmVyQmFsYW5jZSA+IDApIAoJCQkmJiAocGF5b3V0QmFsYW5jZSA9PSAwKQoJCQkmJiAobm93ID4gKGxhc3RQYXlvdXRUaW1lK21pblBheUludGVydmFsKSkpIHsKCQkJLy8gc3RhcnQgYSBuZXcgcnVuCgkJCWN1clBheW91dElkKys7CgkJCWlmIChjdXJQYXlvdXRJZCA+PSAzMjc2OCkKCQkJCWN1clBheW91dElkID0gMTsKCQkJbGFzdFBheW91dFRpbWUgPSBub3c7CgkJCXBheW91dEJhbGFuY2UgPSBpbnQoaG9sZG92ZXJCYWxhbmNlKTsKCQkJcHJPcmlnUGF5b3V0QmFsID0gcGF5b3V0QmFsYW5jZTsKCQkJcHJPcmlnVG9rZW5zTWludCA9IHRvdGFsVG9rZW5zTWludGVkOwoJCQlob2xkb3ZlckJhbGFuY2UgPSAwOwoJCQlsYXN0UGF5b3V0SW5kZXggPSAwOwoJCQlTdGF0RXZlbnRJKCJTdGFydFJ1biIsIHVpbnQoY3VyUGF5b3V0SWQpKTsKCQl9IGVsc2UgaWYgKHBheW91dEJhbGFuY2UgPiAwKSB7CgkJCS8vIHdvcmsgZG93biB0aGUgcC5vLmIKCQkJdWludCBuQW1vdW50OwoJCQl1aW50IG5QZXJUb2tEaXN0cmliID0gdWludChwck9yaWdQYXlvdXRCYWwpL3ByT3JpZ1Rva2Vuc01pbnQ7CgkJCXVpbnQgcGFpZHMgPSAwOwoJCQl1aW50IGk7IC8vIGludGVudGlvbmFsCgkJCWZvciAoaSA9IGxhc3RQYXlvdXRJbmRleDsgKHBhaWRzIDwgX251bVBheXMpICYmIChpIDwgbnVtQWNjb3VudHMpICYmIChwYXlvdXRCYWxhbmNlID4gMCk7IGkrKyApIHsKCQkJCWFkZHJlc3MgYSA9IGhvbGRlckluZGV4ZXNbaV07CgkJCQlpZiAoYSA9PSBhZGRyZXNzKDApKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgkJCQl2YXIgKHBpZCwgaGVsZCkgPSBnZXRQYXlJZEFuZEhlbGQoaG9sZGVyQWNjb3VudHNbYV0udG9rZW5zKTsKCQkJCWlmICgoaGVsZCA+IDApICYmIChwaWQgIT0gY3VyUGF5b3V0SWQpKSB7CgkJCQkJbkFtb3VudCA9IG5QZXJUb2tEaXN0cmliICogaGVsZDsKCQkJCQlpZiAoaW50KG5BbW91bnQpIDw9IHBheW91dEJhbGFuY2UpewoJCQkJCQlob2xkZXJBY2NvdW50c1thXS5iYWxhbmNlICs9IG5BbW91bnQ7IAoJCQkJCQlob2xkZXJBY2NvdW50c1thXS50b2tlbnMgPSAoY3VyUGF5b3V0SWQgKiAoMiAqKiA0OCkpIHwgaGVsZDsKCQkJCQkJcGF5b3V0QmFsYW5jZSAtPSBpbnQobkFtb3VudCk7CQkJCQkKCQkJCQkJcGFpZHMrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJbGFzdFBheW91dEluZGV4ID0gaTsKCQkJaWYgKGxhc3RQYXlvdXRJbmRleCA+PSBudW1BY2NvdW50cyB8fCBwYXlvdXRCYWxhbmNlIDw9IDApIHsKCQkJCWxhc3RQYXlvdXRJbmRleCA9IDA7CgkJCQlpZiAocGF5b3V0QmFsYW5jZSA+IDApCgkJCQkJaG9sZG92ZXJCYWxhbmNlICs9IHVpbnQocGF5b3V0QmFsYW5jZSk7Ly8gcHV0IGJhY2sgYW55IGxlZnRvdmVycwoJCQkJcGF5b3V0QmFsYW5jZSA9IDA7CgkJCQlTdGF0RXZlbnRJKCJSdW5Db21wbGV0ZSIsIHVpbnQocHJPcmlnUGF5b3V0QmFsKSApOwoKCQkJfSBlbHNlIHsKCQkJCVN0YXRFdmVudEkoIlBheVJ1biIsIHBhaWRzICk7CgkJCX0KCQl9CgkJCgl9CgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIHNlbmRlciB3aXRoZHJhdyBlbnRpcmUgcmV3YXJkcy9kaXZpZGVuZHMKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIHdpdGhkcmF3RGl2aWRlbmRzKCkgcHVibGljIHJldHVybnMgKHVpbnQgX2Ftb3VudCkKCXsKCQlpZiAoaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0uYmFsYW5jZSA9PSAwKSB7IAoJCQkvL19hbW91bnQgPSAwOwoJCQlTdGF0RXZlbnQoIjAgQmFsYW5jZSIpOwoJCQlyZXR1cm47CgkJfSBlbHNlIHsKCQkJaWYgKChtc2cuc2VuZGVyID09IGRldmVsb3BlcnMpIAoJCQkJJiYgIChub3cgPCB2ZXN0VGltZSkpIHsKCQkJCS8vc3RhdEV2ZW50KCJUb2tlbnMgbm90IHlldCB2ZXN0ZWQuIik7CgkJCQkvL19hbW91bnQgPSAwOwoJCQkJcmV0dXJuOwoJCQl9CgoJCQlfYW1vdW50ID0gaG9sZGVyQWNjb3VudHNbbXNnLnNlbmRlcl0uYmFsYW5jZTsgCgkJCWhvbGRlckFjY291bnRzW21zZy5zZW5kZXJdLmJhbGFuY2UgPSAwOyAKCQkJaWYgKCFtc2cuc2VuZGVyLmNhbGwuZ2FzKHJ3R2FzKS52YWx1ZShfYW1vdW50KSgpKQoJCQkJdGhyb3c7CgkJCS8vU3RhdEV2ZW50SSgiUGFpZCIsIF9hbW91bnQpOwoJCgkJfQoKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBzZXQgZ2FzIGZvciBvcGVyYXRpb25zCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBzZXRPcEdhcyh1aW50IF9ybSwgdWludCBfcmYsIHVpbnQgX3J3KQoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyICYmIG1zZy5zZW5kZXIgIT0gZGV2ZWxvcGVycykgewoJCQkvL1N0YXRFdmVudCgib25seSBvd25lciBjYWxscyIpOwoJCQlyZXR1cm47CgkJfSBlbHNlIHsKCQkJcm1HYXMgPSBfcm07CgkJCXJmR2FzID0gX3JmOwoJCQlyd0dhcyA9IF9ydzsKCQl9Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gZ2V0IGdhcyBmb3Igb3BlcmF0aW9ucwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0T3BHYXMoKSBjb25zdGFudCByZXR1cm5zICh1aW50IF9ybSwgdWludCBfcmYsIHVpbnQgX3J3KQoJewoJCV9ybSA9IHJtR2FzOwoJCV9yZiA9IHJmR2FzOwoJCV9ydyA9IHJ3R2FzOwoJfQogCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gY2hlY2sgcmV3YXJkcy4gIHBhc3MgaW4gYWRkcmVzcyBvZiB0b2tlbiBob2xkZXIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGNoZWNrRGl2aWRlbmRzKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IHJldHVybnModWludCBfYW1vdW50KQoJewoJCWlmIChob2xkZXJBY2NvdW50c1tfYWRkcl0uYWxsb2NlZCkKCQkJX2Ftb3VudCA9IGhvbGRlckFjY291bnRzW19hZGRyXS5iYWxhbmNlOwoJfQkJCgoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gaWNvQ2hlY2t1cCAtIGNoZWNrIHVwIGNhbGwgZm9yIGFkbWluaXN0cmF0b3JzCgkvLyBhZnRlciBzYWxlIGlzIGNsb3NlZCBpZiBtaW4gaWNvIHRva2VucyBzb2xkLCAxMCBwZXJjZW50IHdpbGwgYmUgZGlzdHJpYnV0ZWQgdG8gCgkvLyBjb21wYW55IHRvIGNvdmVyIHZhcmlvdXMgb3BlcmF0aW5nIGV4cGVuc2VzCgkvLyBhZnRlciBzYWxlIGFuZCB1c2FnZSBkZWFsaW5lcyBoYXZlIGJlZW4gbWV0LCByZW1haW5pbmcgOTAgcGVyY2VudCB3aWxsIGJlIGRpc3RyaWJ1dGVkIHRvCgkvLyBjb21wYW55LgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBpY29DaGVja3VwKCkgcHVibGljCgl7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIgJiYgbXNnLnNlbmRlciAhPSBkZXZlbG9wZXJzKQoJCQl0aHJvdzsKCgkJdWludCBubXNnbWFzazsKCQkvL25tc2dtYXNrID0gMDsKCQoJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc2FsZUNsb3NlZCkgewoJCQlpZiAoKGdldE51bVRva2Vuc1B1cmNoYXNlZCgpID49IG1pbkljb1Rva2VuR29hbCkKCQkJCSYmIChyZW11bmVyYXRpb25TdGFnZSA9PSAwICkpIHsKCQkJCXJlbXVuZXJhdGlvblN0YWdlID0gMTsKCQkJCXJlbXVuZXJhdGlvbkJhbGFuY2UgPSAodG90YWxUb2tlbkZ1bmRzUmVjZWl2ZWQvMTAwKSo5OyAvLyA5IHBlcmNlbnQKCQkJCWF1eFBhcnRuZXJCYWxhbmNlID0gICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMDApOyAvLyAxIHBlcmNlbnQKCQkJCW5tc2dtYXNrIHw9IDE7CgkJCX0gCgkJfQoJCWlmIChpY29TdGF0dXMgPT0gSWNvU3RhdHVzVmFsdWUuc3VjY2VlZGVkKSB7CgkJCgkJCWlmIChyZW11bmVyYXRpb25TdGFnZSA9PSAwICkgewoJCQkJcmVtdW5lcmF0aW9uU3RhZ2UgPSAxOwoJCQkJcmVtdW5lcmF0aW9uQmFsYW5jZSA9ICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMDApKjk7IAoJCQkJYXV4UGFydG5lckJhbGFuY2UgPSAgKHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkLzEwMCk7CgkJCQlubXNnbWFzayB8PSA0OwoJCQl9CgkJCWlmIChyZW11bmVyYXRpb25TdGFnZSA9PSAxKSB7IC8vIHdlIGhhdmUgYWxyZWFkeSBzdWNlZWRlZAoJCQkJcmVtdW5lcmF0aW9uU3RhZ2UgPSAyOwoJCQkJcmVtdW5lcmF0aW9uQmFsYW5jZSArPSB0b3RhbFRva2VuRnVuZHNSZWNlaXZlZCAtICh0b3RhbFRva2VuRnVuZHNSZWNlaXZlZC8xMCk7IC8vIDkwIHBlcmNlbnQKCQkJCW5tc2dtYXNrIHw9IDg7CgkJCX0KCgkJfQoKCQl1aW50IG50bXA7CgoJCWlmIChyZW11bmVyYXRpb25CYWxhbmNlID4gMCkgeyAKCQkvLyBvbmx5IHBheSBvbmUgZW50aXR5IHBlciBjYWxsLCBkb250IHdhbnQgdG8gcnVuIG91dCBvZiBnYXMKCQkJCW50bXAgPSByZW11bmVyYXRpb25CYWxhbmNlOwoJCQkJcmVtdW5lcmF0aW9uQmFsYW5jZSA9IDA7CgkJCQlpZiAoIWZvdW5kZXJPcmcuY2FsbC5nYXMocm1HYXMpLnZhbHVlKG50bXApKCkpIHsKCQkJCQlyZW11bmVyYXRpb25CYWxhbmNlID0gbnRtcDsKCQkJCQlubXNnbWFzayB8PSAzMjsKCQkJCX0gZWxzZSB7CgkJCQkJbm1zZ21hc2sgfD0gNjQ7CgkJCQl9CQoJCX0gZWxzZSAJaWYgKGF1eFBhcnRuZXJCYWxhbmNlID4gMCkgewoJCS8vIG5vdGUgdGhlICJlbHNlIiBvbmx5IHBheSBvbmUgZW50aXR5IHBlciBjYWxsLCBkb250IHdhbnQgdG8gcnVuIG91dCBvZiBnYXMKCQkJbnRtcCA9IGF1eFBhcnRuZXJCYWxhbmNlOwoJCQlhdXhQYXJ0bmVyQmFsYW5jZSA9IDA7CgkJCWlmICghYXV4UGFydG5lci5jYWxsLmdhcyhybUdhcykudmFsdWUobnRtcCkoKSkgewoJCQkJYXV4UGFydG5lckJhbGFuY2UgPSBudG1wOwoJCQkJbm1zZ21hc2sgfD0gMTI4OwoJCQl9ICBlbHNlIHsKCQkJCW5tc2dtYXNrIHw9IDI1NjsKCQkJfQoKCQl9IAoJCQoJCVN0YXRFdmVudEkoImljby1jaGVja3VwIiwgbm1zZ21hc2spOwoJfQoKCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBzd2FwIGV4ZWN1dG9yCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCglmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9hZGRyKSAKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcgoJCQl8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpCgkJCSB0aHJvdzsKCgkJb3duZXIgPSBfYWRkcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBzd2FwIGRldmVsb3BlcnMgYWNjb3VudAoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gY2hhbmdlRGV2ZXZvcGVyQWNjb250KGFkZHJlc3MgX2FkZHIpIAoJewoJCWlmIChtc2cuc2VuZGVyICE9IG93bmVyCgkJCXx8IHNldHRpbmdzU3RhdGUgPT0gU2V0dGluZ1N0YXRlVmFsdWUubG9ja2VkUmVsZWFzZSkKCQkJIHRocm93OwoJCWRldmVsb3BlcnMgPSBfYWRkcjsKCX0KCgkvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgkvLyBjaGFuZ2UgZm91bmRlcgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gY2hhbmdlRm91bmRlcihhZGRyZXNzIF9hZGRyKSAKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcgoJCQl8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpCgkJCSB0aHJvdzsKCQlmb3VuZGVyT3JnID0gX2FkZHI7Cgl9CgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gY2hhbmdlIGF1eFBhcnRuZXIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGNoYW5nZUF1eFBhcnRuZXIoYWRkcmVzcyBfYXV4KSAKCXsKCQlpZiAobXNnLnNlbmRlciAhPSBvd25lcgoJCQl8fCBzZXR0aW5nc1N0YXRlID09IFNldHRpbmdTdGF0ZVZhbHVlLmxvY2tlZFJlbGVhc2UpCgkJCSB0aHJvdzsKCQlhdXhQYXJ0bmVyID0gX2F1eDsKCX0KCgoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gREVCVUcgT05MWSAtIGVuZCB0aGlzIGNvbnRyYWN0LCBzdWljaWRlIHRvIGRldmVsb3BlcnMKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGhhcmFLaXJpKCkKCXsKCQlpZiAoc2V0dGluZ3NTdGF0ZSAhPSBTZXR0aW5nU3RhdGVWYWx1ZS5kZWJ1ZykKCQkJdGhyb3c7CgkJaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpCgkJCSB0aHJvdzsKCQlzdWljaWRlKGRldmVsb3BlcnMpOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIGdldCBhbGwgaWNvIHN0YXR1cywgZnVuZGluZyBhbmQgdXNhZ2UgaW5mbwoJLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJZnVuY3Rpb24gZ2V0SWNvSW5mbygpIGNvbnN0YW50IHJldHVybnMoSWNvU3RhdHVzVmFsdWUgX3N0YXR1cywgdWludCBfc2FsZVN0YXJ0LCB1aW50IF9zYWxlRW5kLCB1aW50IF91c2FnZUVuZCwgdWludCBfc2FsZUdvYWwsIHVpbnQgX3VzYWdlR29hbCwgdWludCBfc29sZCwgdWludCBfdXNlZCwgdWludCBfZnVuZHMsIHVpbnQgX2NyZWRpdHMsIHVpbnQgX3JlbXVTdGFnZSwgdWludCBfdmVzdCkKCXsKCQlfc3RhdHVzID0gaWNvU3RhdHVzOwoJCV9zYWxlU3RhcnQgPSBmdW5kaW5nU3RhcnQ7CgkJX3NhbGVFbmQgPSBmdW5kaW5nRGVhZGxpbmU7CgkJX3VzYWdlRW5kID0gdXNhZ2VEZWFkbGluZTsKCQlfdmVzdCA9IHZlc3RUaW1lOwoJCV9zYWxlR29hbCA9IG1pbkljb1Rva2VuR29hbDsKCQlfdXNhZ2VHb2FsID0gbWluVXNhZ2VHb2FsOwoJCV9zb2xkID0gZ2V0TnVtVG9rZW5zUHVyY2hhc2VkKCk7CgkJX3VzZWQgPSBnZXROdW1HYW1lcygpOwoJCV9mdW5kcyA9IHRvdGFsVG9rZW5GdW5kc1JlY2VpdmVkOwoJCV9jcmVkaXRzID0gcGFydG5lckNyZWRpdHM7CgkJX3JlbXVTdGFnZSA9IHJlbXVuZXJhdGlvblN0YWdlOwoJfQoKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCS8vIE5PVEUhIENBTEwgQVQgVEhFIFJJU0sgT0YgUlVOTklORyBPVVQgT0YgR0FTLgoJLy8gQU5ZT05FIENBTiBDQUxMIFRISVMgRlVOQ1RJT04gQlVUIFlPVSBIQVZFIFRPIFNVUFBMWSAKCS8vIFRIRSBDT1JSRUNUIEFNT1VOVCBPRiBHQVMgV0hJQ0ggTUFZIERFUEVORCBPTiAKCS8vIFRIRSBfTlVNUEFZUyBQQVJBTUVURVIuICBXSElDSCBNVVNUIEJFIEJFVFdFRU4gMSBBTkQgMTAwMAoJLy8gVEhFIFNUQU5EQVJEIFZBTFVFIElTIFNUT1JFRCBJTiAibWF4UGF5c1BlciIKCS8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCWZ1bmN0aW9uIGZsdXNoRGl2aWRlbmRzKHVpbnQgX251bVBheXMpCgl7CgkJaWYgKChfbnVtUGF5cyA9PSAwKSB8fCAoX251bVBheXMgPiAxMDAwKSkgewoJCQlTdGF0RXZlbnQoIkludmFsaWQuIik7CgkJfSBlbHNlIGlmIChob2xkb3ZlckJhbGFuY2UgPiAwIHx8IHBheW91dEJhbGFuY2UgPiAwKSB7CgkJCWRvUGF5b3V0KF9udW1QYXlzKTsKCQl9IGVsc2UgewoJCQlTdGF0RXZlbnQoIk5vdGhpbmcgdG8gZG8uIik7CgkJfQoJCQkJCgl9CgoJZnVuY3Rpb24gZG9EZXZlbG9wZXJHcmFudCgpIGludGVybmFsCgl7CgkJaWYgKCFkZXZlbG9wZXJzR3JhbnRlZCkgewoJCQlkZXZlbG9wZXJzR3JhbnRlZCA9IHRydWU7CgkJCW51bURldlRva2VucyA9IHRvdGFsVG9rZW5zTWludGVkLzEwOwoJCQl0b3RhbFRva2Vuc01pbnRlZCArPSBudW1EZXZUb2tlbnM7CgkJCWlmICghaG9sZGVyQWNjb3VudHNbZGV2ZWxvcGVyc10uYWxsb2NlZCkgCgkJCQlhZGRBY2NvdW50KGRldmVsb3BlcnMpOwoJCQl1aW50IG5ld0hlbGQgPSBnZXRIZWxkKGhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLnRva2VucykgKyBudW1EZXZUb2tlbnM7CgkJCWhvbGRlckFjY291bnRzW2RldmVsb3BlcnNdLnRva2VucyA9IG5ld0hlbGQgfCAgKGN1clBheW91dElkICogKDIgKiogNDgpKTsKCgkJfQoJfQoKCn0='.
	

]
