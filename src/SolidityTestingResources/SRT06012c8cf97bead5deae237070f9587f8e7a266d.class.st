Class {
	#name : #SRT06012c8cf97bead5deae237070f9587f8e7a266d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT06012c8cf97bead5deae237070f9587f8e7a266d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKCgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBEaWV0ZXIgU2hpcmxleSA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJhYmNmY2VkZmNlZWJjYWQzYzJjNGM2ZDFjZWM1ODVjOGM0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4gKGh0dHBzOi8vZ2l0aHViLmNvbS9kZXRlKQpjb250cmFjdCBFUkM3MjEgewogICAgLy8gUmVxdWlyZWQgbWV0aG9kcwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3MgYXBwcm92ZWQsIHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLy8gT3B0aW9uYWwKICAgIC8vIGZ1bmN0aW9uIG5hbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgbmFtZSk7CiAgICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgc3ltYm9sKTsKICAgIC8vIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIHRva2VuSWRzKTsKICAgIC8vIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nIF9wcmVmZXJyZWRUcmFuc3BvcnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKTsKCiAgICAvLyBFUkMtMTY1IENvbXBhdGliaWxpdHkgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwp9CgoKLy8gLy8gQXVjdGlvbiB3cmFwcGVyIGZ1bmN0aW9ucwoKCi8vIEF1Y3Rpb24gd3JhcHBlciBmdW5jdGlvbnMKCgoKCgoKCi8vLyBAdGl0bGUgU0VLUkVUT09PTwpjb250cmFjdCBHZW5lU2NpZW5jZUludGVyZmFjZSB7CiAgICAvLy8gQGRldiBzaW1wbHkgYSBib29sZWFuIHRvIGluZGljYXRlIHRoaXMgaXMgdGhlIGNvbnRyYWN0IHdlIGV4cGVjdCB0byBiZQogICAgZnVuY3Rpb24gaXNHZW5lU2NpZW5jZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAZGV2IGdpdmVuIGdlbmVzIG9mIGtpdHRlbiAxICYgMiwgcmV0dXJuIGEgZ2VuZXRpYyBjb21iaW5hdGlvbiAtIG1heSBoYXZlIGEgcmFuZG9tIGZhY3RvcgogICAgLy8vIEBwYXJhbSBnZW5lczEgZ2VuZXMgb2YgbW9tCiAgICAvLy8gQHBhcmFtIGdlbmVzMiBnZW5lcyBvZiBzaXJlCiAgICAvLy8gQHJldHVybiB0aGUgZ2VuZXMgdGhhdCBhcmUgc3VwcG9zZWQgdG8gYmUgcGFzc2VkIGRvd24gdGhlIGNoaWxkCiAgICBmdW5jdGlvbiBtaXhHZW5lcyh1aW50MjU2IGdlbmVzMSwgdWludDI1NiBnZW5lczIsIHVpbnQyNTYgdGFyZ2V0QmxvY2spIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKfQoKCgoKCgoKLy8vIEB0aXRsZSBBIGZhY2V0IG9mIEtpdHR5Q29yZSB0aGF0IG1hbmFnZXMgc3BlY2lhbCBhY2Nlc3MgcHJpdmlsZWdlcy4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgU2VlIHRoZSBLaXR0eUNvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBLaXR0eUFjY2Vzc0NvbnRyb2wgewogICAgLy8gVGhpcyBmYWNldCBjb250cm9scyBhY2Nlc3MgY29udHJvbCBmb3IgQ3J5cHRvS2l0dGllcy4gVGhlcmUgYXJlIGZvdXIgcm9sZXMgbWFuYWdlZCBoZXJlOgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDRU86IFRoZSBDRU8gY2FuIHJlYXNzaWduIG90aGVyIHJvbGVzIGFuZCBjaGFuZ2UgdGhlIGFkZHJlc3NlcyBvZiBvdXIgZGVwZW5kZW50IHNtYXJ0CiAgICAvLyAgICAgICAgIGNvbnRyYWN0cy4gSXQgaXMgYWxzbyB0aGUgb25seSByb2xlIHRoYXQgY2FuIHVucGF1c2UgdGhlIHNtYXJ0IGNvbnRyYWN0LiBJdCBpcyBpbml0aWFsbHkKICAgIC8vICAgICAgICAgc2V0IHRvIHRoZSBhZGRyZXNzIHRoYXQgY3JlYXRlZCB0aGUgc21hcnQgY29udHJhY3QgaW4gdGhlIEtpdHR5Q29yZSBjb25zdHJ1Y3Rvci4KICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ0ZPOiBUaGUgQ0ZPIGNhbiB3aXRoZHJhdyBmdW5kcyBmcm9tIEtpdHR5Q29yZSBhbmQgaXRzIGF1Y3Rpb24gY29udHJhY3RzLgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDT086IFRoZSBDT08gY2FuIHJlbGVhc2UgZ2VuMCBraXR0aWVzIHRvIGF1Y3Rpb24sIGFuZCBtaW50IHByb21vIGNhdHMuCiAgICAvLwogICAgLy8gSXQgc2hvdWxkIGJlIG5vdGVkIHRoYXQgdGhlc2Ugcm9sZXMgYXJlIGRpc3RpbmN0IHdpdGhvdXQgb3ZlcmxhcCBpbiB0aGVpciBhY2Nlc3MgYWJpbGl0aWVzLCB0aGUKICAgIC8vIGFiaWxpdGllcyBsaXN0ZWQgZm9yIGVhY2ggcm9sZSBhYm92ZSBhcmUgZXhoYXVzdGl2ZS4gSW4gcGFydGljdWxhciwgd2hpbGUgdGhlIENFTyBjYW4gYXNzaWduIGFueQogICAgLy8gYWRkcmVzcyB0byBhbnkgcm9sZSwgdGhlIENFTyBhZGRyZXNzIGl0c2VsZiBkb2Vzbid0IGhhdmUgdGhlIGFiaWxpdHkgdG8gYWN0IGluIHRob3NlIHJvbGVzLiBUaGlzCiAgICAvLyByZXN0cmljdGlvbiBpcyBpbnRlbnRpb25hbCBzbyB0aGF0IHdlIGFyZW4ndCB0ZW1wdGVkIHRvIHVzZSB0aGUgQ0VPIGFkZHJlc3MgZnJlcXVlbnRseSBvdXQgb2YKICAgIC8vIGNvbnZlbmllbmNlLiBUaGUgbGVzcyB3ZSB1c2UgYW4gYWRkcmVzcywgdGhlIGxlc3MgbGlrZWx5IGl0IGlzIHRoYXQgd2Ugc29tZWhvdyBjb21wcm9taXNlIHRoZQogICAgLy8gYWNjb3VudC4KCiAgICAvLy8gQGRldiBFbWl0ZWQgd2hlbiBjb250cmFjdCBpcyB1cGdyYWRlZCAtIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgIGV2ZW50IENvbnRyYWN0VXBncmFkZShhZGRyZXNzIG5ld0NvbnRyYWN0KTsKCiAgICAvLyBUaGUgYWRkcmVzc2VzIG9mIHRoZSBhY2NvdW50cyAob3IgY29udHJhY3RzKSB0aGF0IGNhbiBleGVjdXRlIGFjdGlvbnMgd2l0aGluIGVhY2ggcm9sZXMuCiAgICBhZGRyZXNzIHB1YmxpYyBjZW9BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgY2ZvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGNvb0FkZHJlc3M7CgogICAgLy8gQGRldiBLZWVwcyB0cmFjayB3aGV0aGVyIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuIFdoZW4gdGhhdCBpcyB0cnVlLCBtb3N0IGFjdGlvbnMgYXJlIGJsb2NrZWQKICAgIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0VPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seUNFTygpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENGTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDRk8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDT08tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5Q09PKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb29BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlDTGV2ZWwoKSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjb29BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MKICAgICAgICApOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0VPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRU8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRU8KICAgIGZ1bmN0aW9uIHNldENFTyhhZGRyZXNzIF9uZXdDRU8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NFTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2VvQWRkcmVzcyA9IF9uZXdDRU87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0ZPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDRk8gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDRk8KICAgIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NGTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY2ZvQWRkcmVzcyA9IF9uZXdDRk87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ09PLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDRU8uCiAgICAvLy8gQHBhcmFtIF9uZXdDT08gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBDT08KICAgIGZ1bmN0aW9uIHNldENPTyhhZGRyZXNzIF9uZXdDT08pIGV4dGVybmFsIG9ubHlDRU8gewogICAgICAgIHJlcXVpcmUoX25ld0NPTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY29vQWRkcmVzcyA9IF9uZXdDT087CiAgICB9CgogICAgLyoqKiBQYXVzYWJsZSBmdW5jdGlvbmFsaXR5IGFkYXB0ZWQgZnJvbSBPcGVuWmVwcGVsaW4gKioqLwoKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBNb2RpZmllciB0byBhbGxvdyBhY3Rpb25zIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgSVMgcGF1c2VkCiAgICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQGRldiBDYWxsZWQgYnkgYW55ICJDLWxldmVsIiByb2xlIHRvIHBhdXNlIHRoZSBjb250cmFjdC4gVXNlZCBvbmx5IHdoZW4KICAgIC8vLyAgYSBidWcgb3IgZXhwbG9pdCBpcyBkZXRlY3RlZCBhbmQgd2UgbmVlZCB0byBsaW1pdCBkYW1hZ2UuCiAgICBmdW5jdGlvbiBwYXVzZSgpIGV4dGVybmFsIG9ubHlDTGV2ZWwgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBVbnBhdXNlcyB0aGUgc21hcnQgY29udHJhY3QuIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgQ0VPLCBzaW5jZQogICAgLy8vICBvbmUgcmVhc29uIHdlIG1heSBwYXVzZSB0aGUgY29udHJhY3QgaXMgd2hlbiBDRk8gb3IgQ09PIGFjY291bnRzIGFyZQogICAgLy8vICBjb21wcm9taXNlZC4KICAgIC8vLyBAbm90aWNlIFRoaXMgaXMgcHVibGljIHJhdGhlciB0aGFuIGV4dGVybmFsIHNvIGl0IGNhbiBiZSBjYWxsZWQgYnkKICAgIC8vLyAgZGVyaXZlZCBjb250cmFjdHMuCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgLy8gY2FuJ3QgdW5wYXVzZSBpZiBjb250cmFjdCB3YXMgdXBncmFkZWQKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgIH0KfQoKCgoKLy8vIEB0aXRsZSBCYXNlIGNvbnRyYWN0IGZvciBDcnlwdG9LaXR0aWVzLiBIb2xkcyBhbGwgY29tbW9uIHN0cnVjdHMsIGV2ZW50cyBhbmQgYmFzZSB2YXJpYWJsZXMuCi8vLyBAYXV0aG9yIEF4aW9tIFplbiAoaHR0cHM6Ly93d3cuYXhpb216ZW4uY28pCi8vLyBAZGV2IFNlZSB0aGUgS2l0dHlDb3JlIGNvbnRyYWN0IGRvY3VtZW50YXRpb24gdG8gdW5kZXJzdGFuZCBob3cgdGhlIHZhcmlvdXMgY29udHJhY3QgZmFjZXRzIGFyZSBhcnJhbmdlZC4KY29udHJhY3QgS2l0dHlCYXNlIGlzIEtpdHR5QWNjZXNzQ29udHJvbCB7CiAgICAvKioqIEVWRU5UUyAqKiovCgogICAgLy8vIEBkZXYgVGhlIEJpcnRoIGV2ZW50IGlzIGZpcmVkIHdoZW5ldmVyIGEgbmV3IGtpdHRlbiBjb21lcyBpbnRvIGV4aXN0ZW5jZS4gVGhpcyBvYnZpb3VzbHkKICAgIC8vLyAgaW5jbHVkZXMgYW55IHRpbWUgYSBjYXQgaXMgY3JlYXRlZCB0aHJvdWdoIHRoZSBnaXZlQmlydGggbWV0aG9kLCBidXQgaXQgaXMgYWxzbyBjYWxsZWQKICAgIC8vLyAgd2hlbiBhIG5ldyBnZW4wIGNhdCBpcyBjcmVhdGVkLgogICAgZXZlbnQgQmlydGgoYWRkcmVzcyBvd25lciwgdWludDI1NiBraXR0eUlkLCB1aW50MjU2IG1hdHJvbklkLCB1aW50MjU2IHNpcmVJZCwgdWludDI1NiBnZW5lcyk7CgogICAgLy8vIEBkZXYgVHJhbnNmZXIgZXZlbnQgYXMgZGVmaW5lZCBpbiBjdXJyZW50IGRyYWZ0IG9mIEVSQzcyMS4gRW1pdHRlZCBldmVyeSB0aW1lIGEga2l0dGVuCiAgICAvLy8gIG93bmVyc2hpcCBpcyBhc3NpZ25lZCwgaW5jbHVkaW5nIGJpcnRocy4KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKCiAgICAvKioqIERBVEEgVFlQRVMgKioqLwoKICAgIC8vLyBAZGV2IFRoZSBtYWluIEtpdHR5IHN0cnVjdC4gRXZlcnkgY2F0IGluIENyeXB0b0tpdHRpZXMgaXMgcmVwcmVzZW50ZWQgYnkgYSBjb3B5CiAgICAvLy8gIG9mIHRoaXMgc3RydWN0dXJlLCBzbyBncmVhdCBjYXJlIHdhcyB0YWtlbiB0byBlbnN1cmUgdGhhdCBpdCBmaXRzIG5lYXRseSBpbnRvCiAgICAvLy8gIGV4YWN0bHkgdHdvIDI1Ni1iaXQgd29yZHMuIE5vdGUgdGhhdCB0aGUgb3JkZXIgb2YgdGhlIG1lbWJlcnMgaW4gdGhpcyBzdHJ1Y3R1cmUKICAgIC8vLyAgaXMgaW1wb3J0YW50IGJlY2F1c2Ugb2YgdGhlIGJ5dGUtcGFja2luZyBydWxlcyB1c2VkIGJ5IEV0aGVyZXVtLgogICAgLy8vICBSZWY6IGh0dHA6Ly9zb2xpZGl0eS5yZWFkdGhlZG9jcy5pby9lbi9kZXZlbG9wL21pc2NlbGxhbmVvdXMuaHRtbAogICAgc3RydWN0IEtpdHR5IHsKICAgICAgICAvLyBUaGUgS2l0dHkncyBnZW5ldGljIGNvZGUgaXMgcGFja2VkIGludG8gdGhlc2UgMjU2LWJpdHMsIHRoZSBmb3JtYXQgaXMKICAgICAgICAvLyBzb29wZXItc2VrcmV0ISBBIGNhdCdzIGdlbmVzIG5ldmVyIGNoYW5nZS4KICAgICAgICB1aW50MjU2IGdlbmVzOwoKICAgICAgICAvLyBUaGUgdGltZXN0YW1wIGZyb20gdGhlIGJsb2NrIHdoZW4gdGhpcyBjYXQgY2FtZSBpbnRvIGV4aXN0ZW5jZS4KICAgICAgICB1aW50NjQgYmlydGhUaW1lOwoKICAgICAgICAvLyBUaGUgbWluaW11bSB0aW1lc3RhbXAgYWZ0ZXIgd2hpY2ggdGhpcyBjYXQgY2FuIGVuZ2FnZSBpbiBicmVlZGluZwogICAgICAgIC8vIGFjdGl2aXRpZXMgYWdhaW4uIFRoaXMgc2FtZSB0aW1lc3RhbXAgaXMgdXNlZCBmb3IgdGhlIHByZWduYW5jeQogICAgICAgIC8vIHRpbWVyIChmb3IgbWF0cm9ucykgYXMgd2VsbCBhcyB0aGUgc2lyaW5nIGNvb2xkb3duLgogICAgICAgIHVpbnQ2NCBjb29sZG93bkVuZEJsb2NrOwoKICAgICAgICAvLyBUaGUgSUQgb2YgdGhlIHBhcmVudHMgb2YgdGhpcyBraXR0eSwgc2V0IHRvIDAgZm9yIGdlbjAgY2F0cy4KICAgICAgICAvLyBOb3RlIHRoYXQgdXNpbmcgMzItYml0IHVuc2lnbmVkIGludGVnZXJzIGxpbWl0cyB1cyB0byBhICJtZXJlIgogICAgICAgIC8vIDQgYmlsbGlvbiBjYXRzLiBUaGlzIG51bWJlciBtaWdodCBzZWVtIHNtYWxsIHVudGlsIHlvdSByZWFsaXplCiAgICAgICAgLy8gdGhhdCBFdGhlcmV1bSBjdXJyZW50bHkgaGFzIGEgbGltaXQgb2YgYWJvdXQgNTAwIG1pbGxpb24KICAgICAgICAvLyB0cmFuc2FjdGlvbnMgcGVyIHllYXIhIFNvLCB0aGlzIGRlZmluaXRlbHkgd29uJ3QgYmUgYSBwcm9ibGVtCiAgICAgICAgLy8gZm9yIHNldmVyYWwgeWVhcnMgKGV2ZW4gYXMgRXRoZXJldW0gbGVhcm5zIHRvIHNjYWxlKS4KICAgICAgICB1aW50MzIgbWF0cm9uSWQ7CiAgICAgICAgdWludDMyIHNpcmVJZDsKCiAgICAgICAgLy8gU2V0IHRvIHRoZSBJRCBvZiB0aGUgc2lyZSBjYXQgZm9yIG1hdHJvbnMgdGhhdCBhcmUgcHJlZ25hbnQsCiAgICAgICAgLy8gemVybyBvdGhlcndpc2UuIEEgbm9uLXplcm8gdmFsdWUgaGVyZSBpcyBob3cgd2Uga25vdyBhIGNhdAogICAgICAgIC8vIGlzIHByZWduYW50LiBVc2VkIHRvIHJldHJpZXZlIHRoZSBnZW5ldGljIG1hdGVyaWFsIGZvciB0aGUgbmV3CiAgICAgICAgLy8ga2l0dGVuIHdoZW4gdGhlIGJpcnRoIHRyYW5zcGlyZXMuCiAgICAgICAgdWludDMyIHNpcmluZ1dpdGhJZDsKCiAgICAgICAgLy8gU2V0IHRvIHRoZSBpbmRleCBpbiB0aGUgY29vbGRvd24gYXJyYXkgKHNlZSBiZWxvdykgdGhhdCByZXByZXNlbnRzCiAgICAgICAgLy8gdGhlIGN1cnJlbnQgY29vbGRvd24gZHVyYXRpb24gZm9yIHRoaXMgS2l0dHkuIFRoaXMgc3RhcnRzIGF0IHplcm8KICAgICAgICAvLyBmb3IgZ2VuMCBjYXRzLCBhbmQgaXMgaW5pdGlhbGl6ZWQgdG8gZmxvb3IoZ2VuZXJhdGlvbi8yKSBmb3Igb3RoZXJzLgogICAgICAgIC8vIEluY3JlbWVudGVkIGJ5IG9uZSBmb3IgZWFjaCBzdWNjZXNzZnVsIGJyZWVkaW5nIGFjdGlvbiwgcmVnYXJkbGVzcwogICAgICAgIC8vIG9mIHdoZXRoZXIgdGhpcyBjYXQgaXMgYWN0aW5nIGFzIG1hdHJvbiBvciBzaXJlLgogICAgICAgIHVpbnQxNiBjb29sZG93bkluZGV4OwoKICAgICAgICAvLyBUaGUgImdlbmVyYXRpb24gbnVtYmVyIiBvZiB0aGlzIGNhdC4gQ2F0cyBtaW50ZWQgYnkgdGhlIENLIGNvbnRyYWN0CiAgICAgICAgLy8gZm9yIHNhbGUgYXJlIGNhbGxlZCAiZ2VuMCIgYW5kIGhhdmUgYSBnZW5lcmF0aW9uIG51bWJlciBvZiAwLiBUaGUKICAgICAgICAvLyBnZW5lcmF0aW9uIG51bWJlciBvZiBhbGwgb3RoZXIgY2F0cyBpcyB0aGUgbGFyZ2VyIG9mIHRoZSB0d28gZ2VuZXJhdGlvbgogICAgICAgIC8vIG51bWJlcnMgb2YgdGhlaXIgcGFyZW50cywgcGx1cyBvbmUuCiAgICAgICAgLy8gKGkuZS4gbWF4KG1hdHJvbi5nZW5lcmF0aW9uLCBzaXJlLmdlbmVyYXRpb24pICsgMSkKICAgICAgICB1aW50MTYgZ2VuZXJhdGlvbjsKICAgIH0KCiAgICAvKioqIENPTlNUQU5UUyAqKiovCgogICAgLy8vIEBkZXYgQSBsb29rdXAgdGFibGUgaW5kaWNhdGluZyB0aGUgY29vbGRvd24gZHVyYXRpb24gYWZ0ZXIgYW55IHN1Y2Nlc3NmdWwKICAgIC8vLyAgYnJlZWRpbmcgYWN0aW9uLCBjYWxsZWQgInByZWduYW5jeSB0aW1lIiBmb3IgbWF0cm9ucyBhbmQgInNpcmluZyBjb29sZG93biIKICAgIC8vLyAgZm9yIHNpcmVzLiBEZXNpZ25lZCBzdWNoIHRoYXQgdGhlIGNvb2xkb3duIHJvdWdobHkgZG91YmxlcyBlYWNoIHRpbWUgYSBjYXQKICAgIC8vLyAgaXMgYnJlZCwgZW5jb3VyYWdpbmcgb3duZXJzIG5vdCB0byBqdXN0IGtlZXAgYnJlZWRpbmcgdGhlIHNhbWUgY2F0IG92ZXIKICAgIC8vLyAgYW5kIG92ZXIgYWdhaW4uIENhcHMgb3V0IGF0IG9uZSB3ZWVrIChhIGNhdCBjYW4gYnJlZWQgYW4gdW5ib3VuZGVkIG51bWJlcgogICAgLy8vICBvZiB0aW1lcywgYW5kIHRoZSBtYXhpbXVtIGNvb2xkb3duIGlzIGFsd2F5cyBzZXZlbiBkYXlzKS4KICAgIHVpbnQzMlsxNF0gcHVibGljIGNvb2xkb3ducyA9IFsKICAgICAgICB1aW50MzIoMSBtaW51dGVzKSwKICAgICAgICB1aW50MzIoMiBtaW51dGVzKSwKICAgICAgICB1aW50MzIoNSBtaW51dGVzKSwKICAgICAgICB1aW50MzIoMTAgbWludXRlcyksCiAgICAgICAgdWludDMyKDMwIG1pbnV0ZXMpLAogICAgICAgIHVpbnQzMigxIGhvdXJzKSwKICAgICAgICB1aW50MzIoMiBob3VycyksCiAgICAgICAgdWludDMyKDQgaG91cnMpLAogICAgICAgIHVpbnQzMig4IGhvdXJzKSwKICAgICAgICB1aW50MzIoMTYgaG91cnMpLAogICAgICAgIHVpbnQzMigxIGRheXMpLAogICAgICAgIHVpbnQzMigyIGRheXMpLAogICAgICAgIHVpbnQzMig0IGRheXMpLAogICAgICAgIHVpbnQzMig3IGRheXMpCiAgICBdOwoKICAgIC8vIEFuIGFwcHJveGltYXRpb24gb2YgY3VycmVudGx5IGhvdyBtYW55IHNlY29uZHMgYXJlIGluIGJldHdlZW4gYmxvY2tzLgogICAgdWludDI1NiBwdWJsaWMgc2Vjb25kc1BlckJsb2NrID0gMTU7CgogICAgLyoqKiBTVE9SQUdFICoqKi8KCiAgICAvLy8gQGRldiBBbiBhcnJheSBjb250YWluaW5nIHRoZSBLaXR0eSBzdHJ1Y3QgZm9yIGFsbCBLaXR0aWVzIGluIGV4aXN0ZW5jZS4gVGhlIElECiAgICAvLy8gIG9mIGVhY2ggY2F0IGlzIGFjdHVhbGx5IGFuIGluZGV4IGludG8gdGhpcyBhcnJheS4gTm90ZSB0aGF0IElEIDAgaXMgYSBuZWdhY2F0LAogICAgLy8vICB0aGUgdW5LaXR0eSwgdGhlIG15dGhpY2FsIGJlYXN0IHRoYXQgaXMgdGhlIHBhcmVudCBvZiBhbGwgZ2VuMCBjYXRzLiBBIGJpemFycmUKICAgIC8vLyAgY3JlYXR1cmUgdGhhdCBpcyBib3RoIG1hdHJvbiBhbmQgc2lyZS4uLiB0byBpdHNlbGYhIEhhcyBhbiBpbnZhbGlkIGdlbmV0aWMgY29kZS4KICAgIC8vLyAgSW4gb3RoZXIgd29yZHMsIGNhdCBJRCAwIGlzIGludmFsaWQuLi4gOy0pCiAgICBLaXR0eVtdIGtpdHRpZXM7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gY2F0IElEcyB0byB0aGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlbS4gQWxsIGNhdHMgaGF2ZQogICAgLy8vICBzb21lIHZhbGlkIG93bmVyIGFkZHJlc3MsIGV2ZW4gZ2VuMCBjYXRzIGFyZSBjcmVhdGVkIHdpdGggYSBub24temVybyBvd25lci4KICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIGtpdHR5SW5kZXhUb093bmVyOwoKICAgIC8vIEBkZXYgQSBtYXBwaW5nIGZyb20gb3duZXIgYWRkcmVzcyB0byBjb3VudCBvZiB0b2tlbnMgdGhhdCBhZGRyZXNzIG93bnMuCiAgICAvLyAgVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgb3duZXJzaGlwVG9rZW5Db3VudDsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBLaXR0eUlEcyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gY2FsbAogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gRWFjaCBLaXR0eSBjYW4gb25seSBoYXZlIG9uZSBhcHByb3ZlZCBhZGRyZXNzIGZvciB0cmFuc2ZlcgogICAgLy8vICBhdCBhbnkgdGltZS4gQSB6ZXJvIHZhbHVlIG1lYW5zIG5vIGFwcHJvdmFsIGlzIG91dHN0YW5kaW5nLgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMga2l0dHlJbmRleFRvQXBwcm92ZWQ7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gS2l0dHlJRHMgdG8gYW4gYWRkcmVzcyB0aGF0IGhhcyBiZWVuIGFwcHJvdmVkIHRvIHVzZQogICAgLy8vICB0aGlzIEtpdHR5IGZvciBzaXJpbmcgdmlhIGJyZWVkV2l0aCgpLiBFYWNoIEtpdHR5IGNhbiBvbmx5IGhhdmUgb25lIGFwcHJvdmVkCiAgICAvLy8gIGFkZHJlc3MgZm9yIHNpcmluZyBhdCBhbnkgdGltZS4gQSB6ZXJvIHZhbHVlIG1lYW5zIG5vIGFwcHJvdmFsIGlzIG91dHN0YW5kaW5nLgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgc2lyZUFsbG93ZWRUb0FkZHJlc3M7CgogICAgLy8vIEBkZXYgVGhlIGFkZHJlc3Mgb2YgdGhlIENsb2NrQXVjdGlvbiBjb250cmFjdCB0aGF0IGhhbmRsZXMgc2FsZXMgb2YgS2l0dGllcy4gVGhpcwogICAgLy8vICBzYW1lIGNvbnRyYWN0IGhhbmRsZXMgYm90aCBwZWVyLXRvLXBlZXIgc2FsZXMgYXMgd2VsbCBhcyB0aGUgZ2VuMCBzYWxlcyB3aGljaCBhcmUKICAgIC8vLyAgaW5pdGlhdGVkIGV2ZXJ5IDE1IG1pbnV0ZXMuCiAgICBTYWxlQ2xvY2tBdWN0aW9uIHB1YmxpYyBzYWxlQXVjdGlvbjsKCiAgICAvLy8gQGRldiBUaGUgYWRkcmVzcyBvZiBhIGN1c3RvbSBDbG9ja0F1Y3Rpb24gc3ViY2xhc3NlZCBjb250cmFjdCB0aGF0IGhhbmRsZXMgc2lyaW5nCiAgICAvLy8gIGF1Y3Rpb25zLiBOZWVkcyB0byBiZSBzZXBhcmF0ZSBmcm9tIHNhbGVBdWN0aW9uIGJlY2F1c2UgdGhlIGFjdGlvbnMgdGFrZW4gb24gc3VjY2VzcwogICAgLy8vICBhZnRlciBhIHNhbGVzIGFuZCBzaXJpbmcgYXVjdGlvbiBhcmUgcXVpdGUgZGlmZmVyZW50LgogICAgU2lyaW5nQ2xvY2tBdWN0aW9uIHB1YmxpYyBzaXJpbmdBdWN0aW9uOwoKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgS2l0dHkgdG8gYW4gYWRkcmVzcy4KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFNpbmNlIHRoZSBudW1iZXIgb2Yga2l0dGVucyBpcyBjYXBwZWQgdG8gMl4zMiB3ZSBjYW4ndCBvdmVyZmxvdyB0aGlzCiAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfdG9dKys7CiAgICAgICAgLy8gdHJhbnNmZXIgb3duZXJzaGlwCiAgICAgICAga2l0dHlJbmRleFRvT3duZXJbX3Rva2VuSWRdID0gX3RvOwogICAgICAgIC8vIFdoZW4gY3JlYXRpbmcgbmV3IGtpdHRlbnMgX2Zyb20gaXMgMHgwLCBidXQgd2UgY2FuJ3QgYWNjb3VudCB0aGF0IGFkZHJlc3MuCiAgICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfZnJvbV0tLTsKICAgICAgICAgICAgLy8gb25jZSB0aGUga2l0dGVuIGlzIHRyYW5zZmVycmVkIGFsc28gY2xlYXIgc2lyZSBhbGxvd2FuY2VzCiAgICAgICAgICAgIGRlbGV0ZSBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfdG9rZW5JZF07CiAgICAgICAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICAgICAgICBkZWxldGUga2l0dHlJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgICAgIH0KICAgICAgICAvLyBFbWl0IHRoZSB0cmFuc2ZlciBldmVudC4KICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQW4gaW50ZXJuYWwgbWV0aG9kIHRoYXQgY3JlYXRlcyBhIG5ldyBraXR0eSBhbmQgc3RvcmVzIGl0LiBUaGlzCiAgICAvLy8gIG1ldGhvZCBkb2Vzbid0IGRvIGFueSBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIHdoZW4gdGhlCiAgICAvLy8gIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuIFdpbGwgZ2VuZXJhdGUgYm90aCBhIEJpcnRoIGV2ZW50CiAgICAvLy8gIGFuZCBhIFRyYW5zZmVyIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgVGhlIGtpdHR5IElEIG9mIHRoZSBtYXRyb24gb2YgdGhpcyBjYXQgKHplcm8gZm9yIGdlbjApCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgVGhlIGtpdHR5IElEIG9mIHRoZSBzaXJlIG9mIHRoaXMgY2F0ICh6ZXJvIGZvciBnZW4wKQogICAgLy8vIEBwYXJhbSBfZ2VuZXJhdGlvbiBUaGUgZ2VuZXJhdGlvbiBudW1iZXIgb2YgdGhpcyBjYXQsIG11c3QgYmUgY29tcHV0ZWQgYnkgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfZ2VuZXMgVGhlIGtpdHR5J3MgZ2VuZXRpYyBjb2RlLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGluaXRhbCBvd25lciBvZiB0aGlzIGNhdCwgbXVzdCBiZSBub24temVybyAoZXhjZXB0IGZvciB0aGUgdW5LaXR0eSwgSUQgMCkKICAgIGZ1bmN0aW9uIF9jcmVhdGVLaXR0eSgKICAgICAgICB1aW50MjU2IF9tYXRyb25JZCwKICAgICAgICB1aW50MjU2IF9zaXJlSWQsCiAgICAgICAgdWludDI1NiBfZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9nZW5lcywKICAgICAgICBhZGRyZXNzIF9vd25lcgogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICAvLyBUaGVzZSByZXF1aXJlcyBhcmUgbm90IHN0cmljdGx5IG5lY2Vzc2FyeSwgb3VyIGNhbGxpbmcgY29kZSBzaG91bGQgbWFrZQogICAgICAgIC8vIHN1cmUgdGhhdCB0aGVzZSBjb25kaXRpb25zIGFyZSBuZXZlciBicm9rZW4uIEhvd2V2ZXIhIF9jcmVhdGVLaXR0eSgpIGlzIGFscmVhZHkKICAgICAgICAvLyBhbiBleHBlbnNpdmUgY2FsbCAoZm9yIHN0b3JhZ2UpLCBhbmQgaXQgZG9lc24ndCBodXJ0IHRvIGJlIGVzcGVjaWFsbHkgY2FyZWZ1bAogICAgICAgIC8vIHRvIGVuc3VyZSBvdXIgZGF0YSBzdHJ1Y3R1cmVzIGFyZSBhbHdheXMgdmFsaWQuCiAgICAgICAgcmVxdWlyZShfbWF0cm9uSWQgPT0gdWludDI1Nih1aW50MzIoX21hdHJvbklkKSkpOwogICAgICAgIHJlcXVpcmUoX3NpcmVJZCA9PSB1aW50MjU2KHVpbnQzMihfc2lyZUlkKSkpOwogICAgICAgIHJlcXVpcmUoX2dlbmVyYXRpb24gPT0gdWludDI1Nih1aW50MTYoX2dlbmVyYXRpb24pKSk7CgogICAgICAgIC8vIE5ldyBraXR0eSBzdGFydHMgd2l0aCB0aGUgc2FtZSBjb29sZG93biBhcyBwYXJlbnQgZ2VuLzIKICAgICAgICB1aW50MTYgY29vbGRvd25JbmRleCA9IHVpbnQxNihfZ2VuZXJhdGlvbiAvIDIpOwogICAgICAgIGlmIChjb29sZG93bkluZGV4ID4gMTMpIHsKICAgICAgICAgICAgY29vbGRvd25JbmRleCA9IDEzOwogICAgICAgIH0KCiAgICAgICAgS2l0dHkgbWVtb3J5IF9raXR0eSA9IEtpdHR5KHsKICAgICAgICAgICAgZ2VuZXM6IF9nZW5lcywKICAgICAgICAgICAgYmlydGhUaW1lOiB1aW50NjQobm93KSwKICAgICAgICAgICAgY29vbGRvd25FbmRCbG9jazogMCwKICAgICAgICAgICAgbWF0cm9uSWQ6IHVpbnQzMihfbWF0cm9uSWQpLAogICAgICAgICAgICBzaXJlSWQ6IHVpbnQzMihfc2lyZUlkKSwKICAgICAgICAgICAgc2lyaW5nV2l0aElkOiAwLAogICAgICAgICAgICBjb29sZG93bkluZGV4OiBjb29sZG93bkluZGV4LAogICAgICAgICAgICBnZW5lcmF0aW9uOiB1aW50MTYoX2dlbmVyYXRpb24pCiAgICAgICAgfSk7CiAgICAgICAgdWludDI1NiBuZXdLaXR0ZW5JZCA9IGtpdHRpZXMucHVzaChfa2l0dHkpIC0gMTsKCiAgICAgICAgLy8gSXQncyBwcm9iYWJseSBuZXZlciBnb2luZyB0byBoYXBwZW4sIDQgYmlsbGlvbiBjYXRzIGlzIEEgTE9ULCBidXQKICAgICAgICAvLyBsZXQncyBqdXN0IGJlIDEwMCUgc3VyZSB3ZSBuZXZlciBsZXQgdGhpcyBoYXBwZW4uCiAgICAgICAgcmVxdWlyZShuZXdLaXR0ZW5JZCA9PSB1aW50MjU2KHVpbnQzMihuZXdLaXR0ZW5JZCkpKTsKCiAgICAgICAgLy8gZW1pdCB0aGUgYmlydGggZXZlbnQKICAgICAgICBCaXJ0aCgKICAgICAgICAgICAgX293bmVyLAogICAgICAgICAgICBuZXdLaXR0ZW5JZCwKICAgICAgICAgICAgdWludDI1Nihfa2l0dHkubWF0cm9uSWQpLAogICAgICAgICAgICB1aW50MjU2KF9raXR0eS5zaXJlSWQpLAogICAgICAgICAgICBfa2l0dHkuZ2VuZXMKICAgICAgICApOwoKICAgICAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcCwgYW5kIGFsc28gZW1pdCB0aGUgVHJhbnNmZXIgZXZlbnQgYXMKICAgICAgICAvLyBwZXIgRVJDNzIxIGRyYWZ0CiAgICAgICAgX3RyYW5zZmVyKDAsIF9vd25lciwgbmV3S2l0dGVuSWQpOwoKICAgICAgICByZXR1cm4gbmV3S2l0dGVuSWQ7CiAgICB9CgogICAgLy8gQW55IEMtbGV2ZWwgY2FuIGZpeCBob3cgbWFueSBzZWNvbmRzIHBlciBibG9ja3MgYXJlIGN1cnJlbnRseSBvYnNlcnZlZC4KICAgIGZ1bmN0aW9uIHNldFNlY29uZHNQZXJCbG9jayh1aW50MjU2IHNlY3MpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIHJlcXVpcmUoc2VjcyA8IGNvb2xkb3duc1swXSk7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gc2VjczsKICAgIH0KfQoKCgoKCi8vLyBAdGl0bGUgVGhlIGV4dGVybmFsIGNvbnRyYWN0IHRoYXQgaXMgcmVzcG9uc2libGUgZm9yIGdlbmVyYXRpbmcgbWV0YWRhdGEgZm9yIHRoZSBraXR0aWVzLAovLy8gIGl0IGhhcyBvbmUgZnVuY3Rpb24gdGhhdCB3aWxsIHJldHVybiB0aGUgZGF0YSBhcyBieXRlcy4KY29udHJhY3QgRVJDNzIxTWV0YWRhdGEgewogICAgLy8vIEBkZXYgR2l2ZW4gYSB0b2tlbiBJZCwgcmV0dXJucyBhIGJ5dGUgYXJyYXkgdGhhdCBpcyBzdXBwb3NlZCB0byBiZSBjb252ZXJ0ZWQgaW50byBzdHJpbmcuCiAgICBmdW5jdGlvbiBnZXRNZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzJbNF0gYnVmZmVyLCB1aW50MjU2IGNvdW50KSB7CiAgICAgICAgaWYgKF90b2tlbklkID09IDEpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkhlbGxvIFdvcmxkISA6RCI7CiAgICAgICAgICAgIGNvdW50ID0gMTU7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAyKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJJIHdvdWxkIGRlZmluaXRlbHkgY2hvb3NlIGEgbWVkaSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJ1bSBsZW5ndGggc3RyaW5nLiI7CiAgICAgICAgICAgIGNvdW50ID0gNDk7CiAgICAgICAgfSBlbHNlIGlmIChfdG9rZW5JZCA9PSAzKSB7CiAgICAgICAgICAgIGJ1ZmZlclswXSA9ICJMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwgbWkgZSI7CiAgICAgICAgICAgIGJ1ZmZlclsxXSA9ICJzdCBhY2N1bXNhbiBkYXBpYnVzIGF1Z3VlIGxvcmVtLCI7CiAgICAgICAgICAgIGJ1ZmZlclsyXSA9ICIgdHJpc3RpcXVlIHZlc3RpYnVsdW0gaWQsIGxpYmVybyI7CiAgICAgICAgICAgIGJ1ZmZlclszXSA9ICIgc3VzY2lwaXQgdmFyaXVzIHNhcGllbiBhbGlxdWFtLiI7CiAgICAgICAgICAgIGNvdW50ID0gMTI4OwogICAgICAgIH0KICAgIH0KfQoKCi8vLyBAdGl0bGUgVGhlIGZhY2V0IG9mIHRoZSBDcnlwdG9LaXR0aWVzIGNvcmUgY29udHJhY3QgdGhhdCBtYW5hZ2VzIG93bmVyc2hpcCwgRVJDLTcyMSAoZHJhZnQpIGNvbXBsaWFudC4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCi8vLyAgU2VlIHRoZSBLaXR0eUNvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBLaXR0eU93bmVyc2hpcCBpcyBLaXR0eUJhc2UsIEVSQzcyMSB7CgogICAgLy8vIEBub3RpY2UgTmFtZSBhbmQgc3ltYm9sIG9mIHRoZSBub24gZnVuZ2libGUgdG9rZW4sIGFzIGRlZmluZWQgaW4gRVJDNzIxLgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkNyeXB0b0tpdHRpZXMiOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiQ0siOwoKICAgIC8vIFRoZSBjb250cmFjdCB0aGF0IHdpbGwgcmV0dXJuIGtpdHR5IG1ldGFkYXRhCiAgICBFUkM3MjFNZXRhZGF0YSBwdWJsaWMgZXJjNzIxTWV0YWRhdGE7CgogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUgPQogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCknKSk7CgogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPQogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3ltYm9sKCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RvdGFsU3VwcGx5KCknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2JhbGFuY2VPZihhZGRyZXNzKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignb3duZXJPZih1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignYXBwcm92ZShhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlckZyb20oYWRkcmVzcyxhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbnNPZk93bmVyKGFkZHJlc3MpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbk1ldGFkYXRhKHVpbnQyNTYsc3RyaW5nKScpKTsKCiAgICAvLy8gQG5vdGljZSBJbnRyb3NwZWN0aW9uIGludGVyZmFjZSBhcyBwZXIgRVJDLTE2NSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkuCiAgICAvLy8gIFJldHVybnMgdHJ1ZSBmb3IgYW55IHN0YW5kYXJkaXplZCBpbnRlcmZhY2VzIGltcGxlbWVudGVkIGJ5IHRoaXMgY29udHJhY3QuIFdlIGltcGxlbWVudAogICAgLy8vICBFUkMtMTY1IChvYnZpb3VzbHkhKSBhbmQgRVJDLTcyMS4KICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvLyBERUJVRyBPTkxZCiAgICAgICAgLy9yZXF1aXJlKChJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1ID09IDB4MDFmZmM5YTcpICYmIChJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID09IDB4OWEyMDQ4M2QpKTsKCiAgICAgICAgcmV0dXJuICgoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUpIHx8IChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgfQoKICAgIC8vLyBAZGV2IFNldCB0aGUgYWRkcmVzcyBvZiB0aGUgc2libGluZyBjb250cmFjdCB0aGF0IHRyYWNrcyBtZXRhZGF0YS4KICAgIC8vLyAgQ0VPIG9ubHkuCiAgICBmdW5jdGlvbiBzZXRNZXRhZGF0YUFkZHJlc3MoYWRkcmVzcyBfY29udHJhY3RBZGRyZXNzKSBwdWJsaWMgb25seUNFTyB7CiAgICAgICAgZXJjNzIxTWV0YWRhdGEgPSBFUkM3MjFNZXRhZGF0YShfY29udHJhY3RBZGRyZXNzKTsKICAgIH0KCiAgICAvLyBJbnRlcm5hbCB1dGlsaXR5IGZ1bmN0aW9uczogVGhlc2UgZnVuY3Rpb25zIGFsbCBhc3N1bWUgdGhhdCB0aGVpciBpbnB1dCBhcmd1bWVudHMKICAgIC8vIGFyZSB2YWxpZC4gV2UgbGVhdmUgaXQgdG8gcHVibGljIG1ldGhvZHMgdG8gc2FuaXRpemUgdGhlaXIgaW5wdXRzIGFuZCBmb2xsb3cKICAgIC8vIHRoZSByZXF1aXJlZCBsb2dpYy4KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGlzIHRoZSBjdXJyZW50IG93bmVyIG9mIGEgcGFydGljdWxhciBLaXR0eS4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IHRoZSBhZGRyZXNzIHdlIGFyZSB2YWxpZGF0aW5nIGFnYWluc3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGtpdHRlbiBpZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBraXR0eUluZGV4VG9Pd25lcltfdG9rZW5JZF0gPT0gX2NsYWltYW50OwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgY3VycmVudGx5IGhhcyB0cmFuc2ZlckFwcHJvdmFsIGZvciBhIHBhcnRpY3VsYXIgS2l0dHkuCiAgICAvLy8gQHBhcmFtIF9jbGFpbWFudCB0aGUgYWRkcmVzcyB3ZSBhcmUgY29uZmlybWluZyBraXR0ZW4gaXMgYXBwcm92ZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBraXR0ZW4gaWQsIG9ubHkgdmFsaWQgd2hlbiA+IDAKICAgIGZ1bmN0aW9uIF9hcHByb3ZlZEZvcihhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGtpdHR5SW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9PSBfY2xhaW1hbnQ7CiAgICB9CgogICAgLy8vIEBkZXYgTWFya3MgYW4gYWRkcmVzcyBhcyBiZWluZyBhcHByb3ZlZCBmb3IgdHJhbnNmZXJGcm9tKCksIG92ZXJ3cml0aW5nIGFueSBwcmV2aW91cwogICAgLy8vICBhcHByb3ZhbC4gU2V0dGluZyBfYXBwcm92ZWQgdG8gYWRkcmVzcygwKSBjbGVhcnMgYWxsIHRyYW5zZmVyIGFwcHJvdmFsLgogICAgLy8vICBOT1RFOiBfYXBwcm92ZSgpIGRvZXMgTk9UIHNlbmQgdGhlIEFwcHJvdmFsIGV2ZW50LiBUaGlzIGlzIGludGVudGlvbmFsIGJlY2F1c2UKICAgIC8vLyAgX2FwcHJvdmUoKSBhbmQgdHJhbnNmZXJGcm9tKCkgYXJlIHVzZWQgdG9nZXRoZXIgZm9yIHB1dHRpbmcgS2l0dGllcyBvbiBhdWN0aW9uLCBhbmQKICAgIC8vLyAgdGhlcmUgaXMgbm8gdmFsdWUgaW4gc3BhbW1pbmcgdGhlIGxvZyB3aXRoIEFwcHJvdmFsIGV2ZW50cyBpbiB0aGF0IGNhc2UuCiAgICBmdW5jdGlvbiBfYXBwcm92ZSh1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9hcHByb3ZlZCkgaW50ZXJuYWwgewogICAgICAgIGtpdHR5SW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgS2l0dGllcyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBjb3VudCkgewogICAgICAgIHJldHVybiBvd25lcnNoaXBUb2tlbkNvdW50W19vd25lcl07CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIGEgS2l0dHkgdG8gYW5vdGhlciBhZGRyZXNzLiBJZiB0cmFuc2ZlcnJpbmcgdG8gYSBzbWFydAogICAgLy8vICBjb250cmFjdCBiZSBWRVJZIENBUkVGVUwgdG8gZW5zdXJlIHRoYXQgaXQgaXMgYXdhcmUgb2YgRVJDLTcyMSAob3IKICAgIC8vLyAgQ3J5cHRvS2l0dGllcyBzcGVjaWZpY2FsbHkpIG9yIHlvdXIgS2l0dHkgbWF5IGJlIGxvc3QgZm9yZXZlci4gU2VyaW91c2x5LgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBLaXR0eSB0byB0cmFuc2Zlci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcigKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IGtpdHRpZXMgKGV4Y2VwdCB2ZXJ5IGJyaWVmbHkKICAgICAgICAvLyBhZnRlciBhIGdlbjAgY2F0IGlzIGNyZWF0ZWQgYW5kIGJlZm9yZSBpdCBnb2VzIG9uIGF1Y3Rpb24pLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGUgYXVjdGlvbiBjb250cmFjdHMgdG8gcHJldmVudCBhY2NpZGVudGFsCiAgICAgICAgLy8gbWlzdXNlLiBBdWN0aW9uIGNvbnRyYWN0cyBzaG91bGQgb25seSB0YWtlIG93bmVyc2hpcCBvZiBraXR0aWVzCiAgICAgICAgLy8gdGhyb3VnaCB0aGUgYWxsb3cgKyB0cmFuc2ZlckZyb20gZmxvdy4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHNhbGVBdWN0aW9uKSk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhzaXJpbmdBdWN0aW9uKSk7CgogICAgICAgIC8vIFlvdSBjYW4gb25seSBzZW5kIHlvdXIgb3duIGNhdC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCwgY2xlYXIgcGVuZGluZyBhcHByb3ZhbHMsIGVtaXQgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEdyYW50IGFub3RoZXIgYWRkcmVzcyB0aGUgcmlnaHQgdG8gdHJhbnNmZXIgYSBzcGVjaWZpYyBLaXR0eSB2aWEKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIFRoaXMgaXMgdGhlIHByZWZlcnJlZCBmbG93IGZvciB0cmFuc2ZlcmluZyBORlRzIHRvIGNvbnRyYWN0cy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGJlIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwuIFBhc3MgYWRkcmVzcygwKSB0bwogICAgLy8vICBjbGVhciBhbGwgYXBwcm92YWxzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIEtpdHR5IHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBhcHByb3ZlKAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBPbmx5IGFuIG93bmVyIGNhbiBncmFudCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlZ2lzdGVyIHRoZSBhcHByb3ZhbCAocmVwbGFjaW5nIGFueSBwcmV2aW91cyBhcHByb3ZhbCkuCiAgICAgICAgX2FwcHJvdmUoX3Rva2VuSWQsIF90byk7CgogICAgICAgIC8vIEVtaXQgYXBwcm92YWwgZXZlbnQuCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBLaXR0eSBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUgY2FsbGluZyBhZGRyZXNzCiAgICAvLy8gIGhhcyBwcmV2aW91c2x5IGJlZW4gZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbCBieSB0aGUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGUgS2l0dHkgdG8gYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgc2hvdWxkIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBLaXR0eS4gQ2FuIGJlIGFueSBhZGRyZXNzLAogICAgLy8vICBpbmNsdWRpbmcgdGhlIGNhbGxlci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBLaXR0eSB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IGtpdHRpZXMgKGV4Y2VwdCB2ZXJ5IGJyaWVmbHkKICAgICAgICAvLyBhZnRlciBhIGdlbjAgY2F0IGlzIGNyZWF0ZWQgYW5kIGJlZm9yZSBpdCBnb2VzIG9uIGF1Y3Rpb24pLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIC8vIENoZWNrIGZvciBhcHByb3ZhbCBhbmQgdmFsaWQgb3duZXJzaGlwCiAgICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICByZXF1aXJlKF9vd25zKF9mcm9tLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWFzc2lnbiBvd25lcnNoaXAgKGFsc28gY2xlYXJzIHBlbmRpbmcgYXBwcm92YWxzIGFuZCBlbWl0cyBUcmFuc2ZlciBldmVudCkuCiAgICAgICAgX3RyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSB0b3RhbCBudW1iZXIgb2YgS2l0dGllcyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBraXR0aWVzLmxlbmd0aCAtIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgYWRkcmVzcyBjdXJyZW50bHkgYXNzaWduZWQgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gS2l0dHkuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGFkZHJlc3Mgb3duZXIpCiAgICB7CiAgICAgICAgb3duZXIgPSBraXR0eUluZGV4VG9Pd25lcltfdG9rZW5JZF07CgogICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhIGxpc3Qgb2YgYWxsIEtpdHR5IElEcyBhc3NpZ25lZCB0byBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIHdob3NlIEtpdHRpZXMgd2UgYXJlIGludGVyZXN0ZWQgaW4uCiAgICAvLy8gQGRldiBUaGlzIG1ldGhvZCBNVVNUIE5FVkVSIGJlIGNhbGxlZCBieSBzbWFydCBjb250cmFjdCBjb2RlLiBGaXJzdCwgaXQncyBmYWlybHkKICAgIC8vLyAgZXhwZW5zaXZlIChpdCB3YWxrcyB0aGUgZW50aXJlIEtpdHR5IGFycmF5IGxvb2tpbmcgZm9yIGNhdHMgYmVsb25naW5nIHRvIG93bmVyKSwKICAgIC8vLyAgYnV0IGl0IGFsc28gcmV0dXJucyBhIGR5bmFtaWMgYXJyYXksIHdoaWNoIGlzIG9ubHkgc3VwcG9ydGVkIGZvciB3ZWIzIGNhbGxzLCBhbmQKICAgIC8vLyAgbm90IGNvbnRyYWN0LXRvLWNvbnRyYWN0IGNhbGxzLgogICAgZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSBvd25lclRva2VucykgewogICAgICAgIHVpbnQyNTYgdG9rZW5Db3VudCA9IGJhbGFuY2VPZihfb3duZXIpOwoKICAgICAgICBpZiAodG9rZW5Db3VudCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10odG9rZW5Db3VudCk7CiAgICAgICAgICAgIHVpbnQyNTYgdG90YWxDYXRzID0gdG90YWxTdXBwbHkoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICAgICAgICAvLyBXZSBjb3VudCBvbiB0aGUgZmFjdCB0aGF0IGFsbCBjYXRzIGhhdmUgSURzIHN0YXJ0aW5nIGF0IDEgYW5kIGluY3JlYXNpbmcKICAgICAgICAgICAgLy8gc2VxdWVudGlhbGx5IHVwIHRvIHRoZSB0b3RhbENhdCBjb3VudC4KICAgICAgICAgICAgdWludDI1NiBjYXRJZDsKCiAgICAgICAgICAgIGZvciAoY2F0SWQgPSAxOyBjYXRJZCA8PSB0b3RhbENhdHM7IGNhdElkKyspIHsKICAgICAgICAgICAgICAgIGlmIChraXR0eUluZGV4VG9Pd25lcltjYXRJZF0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IGNhdElkOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IEFkYXB0ZWQgZnJvbSBtZW1jcHkoKSBieSBAYXJhY2huaWQgKE5pY2sgSm9obnNvbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIwOTY4N2I2ODZhNjE2NzYwNmQ0OTY3NjY3ZDZkNjY3ZDI3Njc2YzdkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4pCiAgICAvLy8gIFRoaXMgbWV0aG9kIGlzIGxpY2VuY2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vQXJhY2huaWQvc29saWRpdHktc3RyaW5ndXRpbHMvYmxvYi8yZjZjYTlhY2NiNDhhZTE0YzY2ZjE0MzdlYzUwZWQxOWEwNjE2Zjc4L3N0cmluZ3Muc29sCiAgICBmdW5jdGlvbiBfbWVtY3B5KHVpbnQgX2Rlc3QsIHVpbnQgX3NyYywgdWludCBfbGVuKSBwcml2YXRlIHZpZXcgewogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlCiAgICAgICAgZm9yKDsgX2xlbiA+PSAzMjsgX2xlbiAtPSAzMikgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBtc3RvcmUoX2Rlc3QsIG1sb2FkKF9zcmMpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9kZXN0ICs9IDMyOwogICAgICAgICAgICBfc3JjICs9IDMyOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKICAgICAgICB1aW50MjU2IG1hc2sgPSAyNTYgKiogKDMyIC0gX2xlbikgLSAxOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNyY3BhcnQgOj0gYW5kKG1sb2FkKF9zcmMpLCBub3QobWFzaykpCiAgICAgICAgICAgIGxldCBkZXN0cGFydCA6PSBhbmQobWxvYWQoX2Rlc3QpLCBtYXNrKQogICAgICAgICAgICBtc3RvcmUoX2Rlc3QsIG9yKGRlc3RwYXJ0LCBzcmNwYXJ0KSkKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgQWRhcHRlZCBmcm9tIHRvU3RyaW5nKHNsaWNlKSBieSBAYXJhY2huaWQgKE5pY2sgSm9obnNvbiA8PHNwYW4gY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1MzMyMjEzMjMwM2IzZDNhMzcxMzNkM2MyNzM3M2MyNzdkM2QzNjI3Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPj4pCiAgICAvLy8gIFRoaXMgbWV0aG9kIGlzIGxpY2VuY2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vQXJhY2huaWQvc29saWRpdHktc3RyaW5ndXRpbHMvYmxvYi8yZjZjYTlhY2NiNDhhZTE0YzY2ZjE0MzdlYzUwZWQxOWEwNjE2Zjc4L3N0cmluZ3Muc29sCiAgICBmdW5jdGlvbiBfdG9TdHJpbmcoYnl0ZXMzMls0XSBfcmF3Qnl0ZXMsIHVpbnQyNTYgX3N0cmluZ0xlbmd0aCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHZhciBvdXRwdXRTdHJpbmcgPSBuZXcgc3RyaW5nKF9zdHJpbmdMZW5ndGgpOwogICAgICAgIHVpbnQyNTYgb3V0cHV0UHRyOwogICAgICAgIHVpbnQyNTYgYnl0ZXNQdHI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgb3V0cHV0UHRyIDo9IGFkZChvdXRwdXRTdHJpbmcsIDMyKQogICAgICAgICAgICBieXRlc1B0ciA6PSBfcmF3Qnl0ZXMKICAgICAgICB9CgogICAgICAgIF9tZW1jcHkob3V0cHV0UHRyLCBieXRlc1B0ciwgX3N0cmluZ0xlbmd0aCk7CgogICAgICAgIHJldHVybiBvdXRwdXRTdHJpbmc7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhIFVSSSBwb2ludGluZyB0byBhIG1ldGFkYXRhIHBhY2thZ2UgZm9yIHRoaXMgdG9rZW4gY29uZm9ybWluZyB0bwogICAgLy8vICBFUkMtNzIxIChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxKQogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgbnVtYmVyIG9mIHRoZSBLaXR0eSB3aG9zZSBtZXRhZGF0YSBzaG91bGQgYmUgcmV0dXJuZWQuCiAgICBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKSB7CiAgICAgICAgcmVxdWlyZShlcmM3MjFNZXRhZGF0YSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBieXRlczMyWzRdIG1lbW9yeSBidWZmZXI7CiAgICAgICAgdWludDI1NiBjb3VudDsKICAgICAgICAoYnVmZmVyLCBjb3VudCkgPSBlcmM3MjFNZXRhZGF0YS5nZXRNZXRhZGF0YShfdG9rZW5JZCwgX3ByZWZlcnJlZFRyYW5zcG9ydCk7CgogICAgICAgIHJldHVybiBfdG9TdHJpbmcoYnVmZmVyLCBjb3VudCk7CiAgICB9Cn0KCgoKLy8vIEB0aXRsZSBBIGZhY2V0IG9mIEtpdHR5Q29yZSB0aGF0IG1hbmFnZXMgS2l0dHkgc2lyaW5nLCBnZXN0YXRpb24sIGFuZCBiaXJ0aC4KLy8vIEBhdXRob3IgQXhpb20gWmVuIChodHRwczovL3d3dy5heGlvbXplbi5jbykKLy8vIEBkZXYgU2VlIHRoZSBLaXR0eUNvcmUgY29udHJhY3QgZG9jdW1lbnRhdGlvbiB0byB1bmRlcnN0YW5kIGhvdyB0aGUgdmFyaW91cyBjb250cmFjdCBmYWNldHMgYXJlIGFycmFuZ2VkLgpjb250cmFjdCBLaXR0eUJyZWVkaW5nIGlzIEtpdHR5T3duZXJzaGlwIHsKCiAgICAvLy8gQGRldiBUaGUgUHJlZ25hbnQgZXZlbnQgaXMgZmlyZWQgd2hlbiB0d28gY2F0cyBzdWNjZXNzZnVsbHkgYnJlZWQgYW5kIHRoZSBwcmVnbmFuY3kKICAgIC8vLyAgdGltZXIgYmVnaW5zIGZvciB0aGUgbWF0cm9uLgogICAgZXZlbnQgUHJlZ25hbnQoYWRkcmVzcyBvd25lciwgdWludDI1NiBtYXRyb25JZCwgdWludDI1NiBzaXJlSWQsIHVpbnQyNTYgY29vbGRvd25FbmRCbG9jayk7CgogICAgLy8vIEBub3RpY2UgVGhlIG1pbmltdW0gcGF5bWVudCByZXF1aXJlZCB0byB1c2UgYnJlZWRXaXRoQXV0bygpLiBUaGlzIGZlZSBnb2VzIHRvd2FyZHMKICAgIC8vLyAgdGhlIGdhcyBjb3N0IHBhaWQgYnkgd2hhdGV2ZXIgY2FsbHMgZ2l2ZUJpcnRoKCksIGFuZCBjYW4gYmUgZHluYW1pY2FsbHkgdXBkYXRlZCBieQogICAgLy8vICB0aGUgQ09PIHJvbGUgYXMgdGhlIGdhcyBwcmljZSBjaGFuZ2VzLgogICAgdWludDI1NiBwdWJsaWMgYXV0b0JpcnRoRmVlID0gMiBmaW5uZXk7CgogICAgLy8gS2VlcHMgdHJhY2sgb2YgbnVtYmVyIG9mIHByZWduYW50IGtpdHRpZXMuCiAgICB1aW50MjU2IHB1YmxpYyBwcmVnbmFudEtpdHRpZXM7CgogICAgLy8vIEBkZXYgVGhlIGFkZHJlc3Mgb2YgdGhlIHNpYmxpbmcgY29udHJhY3QgdGhhdCBpcyB1c2VkIHRvIGltcGxlbWVudCB0aGUgc29vcGVyLXNla3JldAogICAgLy8vICBnZW5ldGljIGNvbWJpbmF0aW9uIGFsZ29yaXRobS4KICAgIEdlbmVTY2llbmNlSW50ZXJmYWNlIHB1YmxpYyBnZW5lU2NpZW5jZTsKCiAgICAvLy8gQGRldiBVcGRhdGUgdGhlIGFkZHJlc3Mgb2YgdGhlIGdlbmV0aWMgY29udHJhY3QsIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgQ0VPLgogICAgLy8vIEBwYXJhbSBfYWRkcmVzcyBBbiBhZGRyZXNzIG9mIGEgR2VuZVNjaWVuY2UgY29udHJhY3QgaW5zdGFuY2UgdG8gYmUgdXNlZCBmcm9tIHRoaXMgcG9pbnQgZm9yd2FyZC4KICAgIGZ1bmN0aW9uIHNldEdlbmVTY2llbmNlQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICBHZW5lU2NpZW5jZUludGVyZmFjZSBjYW5kaWRhdGVDb250cmFjdCA9IEdlbmVTY2llbmNlSW50ZXJmYWNlKF9hZGRyZXNzKTsKCiAgICAgICAgLy8gTk9URTogdmVyaWZ5IHRoYXQgYSBjb250cmFjdCBpcyB3aGF0IHdlIGV4cGVjdCAtIGh0dHBzOi8vZ2l0aHViLmNvbS9MdW55ci9jcm93ZHNhbGUtY29udHJhY3RzL2Jsb2IvY2ZhZGQxNTk4NmMzMDUyMWQ4YmE3ZDViNmY1N2I0ZmVmY2M3YWMzOC9jb250cmFjdHMvTHVueXJUb2tlbi5zb2wjTDExNwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNHZW5lU2NpZW5jZSgpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIGdlbmVTY2llbmNlID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgQ2hlY2tzIHRoYXQgYSBnaXZlbiBraXR0ZW4gaXMgYWJsZSB0byBicmVlZC4gUmVxdWlyZXMgdGhhdCB0aGUKICAgIC8vLyAgY3VycmVudCBjb29sZG93biBpcyBmaW5pc2hlZCAoZm9yIHNpcmVzKSBhbmQgYWxzbyBjaGVja3MgdGhhdCB0aGVyZSBpcwogICAgLy8vICBubyBwZW5kaW5nIHByZWduYW5jeS4KICAgIGZ1bmN0aW9uIF9pc1JlYWR5VG9CcmVlZChLaXR0eSBfa2l0KSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBJbiBhZGRpdGlvbiB0byBjaGVja2luZyB0aGUgY29vbGRvd25FbmRCbG9jaywgd2UgYWxzbyBuZWVkIHRvIGNoZWNrIHRvIHNlZSBpZgogICAgICAgIC8vIHRoZSBjYXQgaGFzIGEgcGVuZGluZyBiaXJ0aDsgdGhlcmUgY2FuIGJlIHNvbWUgcGVyaW9kIG9mIHRpbWUgYmV0d2VlbiB0aGUgZW5kCiAgICAgICAgLy8gb2YgdGhlIHByZWduYWN5IHRpbWVyIGFuZCB0aGUgYmlydGggZXZlbnQuCiAgICAgICAgcmV0dXJuIChfa2l0LnNpcmluZ1dpdGhJZCA9PSAwKSAmJiAoX2tpdC5jb29sZG93bkVuZEJsb2NrIDw9IHVpbnQ2NChibG9jay5udW1iZXIpKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVjayBpZiBhIHNpcmUgaGFzIGF1dGhvcml6ZWQgYnJlZWRpbmcgd2l0aCB0aGlzIG1hdHJvbi4gVHJ1ZSBpZiBib3RoIHNpcmUKICAgIC8vLyAgYW5kIG1hdHJvbiBoYXZlIHRoZSBzYW1lIG93bmVyLCBvciBpZiB0aGUgc2lyZSBoYXMgZ2l2ZW4gc2lyaW5nIHBlcm1pc3Npb24gdG8KICAgIC8vLyAgdGhlIG1hdHJvbidzIG93bmVyICh2aWEgYXBwcm92ZVNpcmluZygpKS4KICAgIGZ1bmN0aW9uIF9pc1NpcmluZ1Blcm1pdHRlZCh1aW50MjU2IF9zaXJlSWQsIHVpbnQyNTYgX21hdHJvbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhZGRyZXNzIG1hdHJvbk93bmVyID0ga2l0dHlJbmRleFRvT3duZXJbX21hdHJvbklkXTsKICAgICAgICBhZGRyZXNzIHNpcmVPd25lciA9IGtpdHR5SW5kZXhUb093bmVyW19zaXJlSWRdOwoKICAgICAgICAvLyBTaXJpbmcgaXMgb2theSBpZiB0aGV5IGhhdmUgc2FtZSBvd25lciwgb3IgaWYgdGhlIG1hdHJvbidzIG93bmVyIHdhcyBnaXZlbgogICAgICAgIC8vIHBlcm1pc3Npb24gdG8gYnJlZWQgd2l0aCB0aGlzIHNpcmUuCiAgICAgICAgcmV0dXJuIChtYXRyb25Pd25lciA9PSBzaXJlT3duZXIgfHwgc2lyZUFsbG93ZWRUb0FkZHJlc3NbX3NpcmVJZF0gPT0gbWF0cm9uT3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IFNldCB0aGUgY29vbGRvd25FbmRUaW1lIGZvciB0aGUgZ2l2ZW4gS2l0dHksIGJhc2VkIG9uIGl0cyBjdXJyZW50IGNvb2xkb3duSW5kZXguCiAgICAvLy8gIEFsc28gaW5jcmVtZW50cyB0aGUgY29vbGRvd25JbmRleCAodW5sZXNzIGl0IGhhcyBoaXQgdGhlIGNhcCkuCiAgICAvLy8gQHBhcmFtIF9raXR0ZW4gQSByZWZlcmVuY2UgdG8gdGhlIEtpdHR5IGluIHN0b3JhZ2Ugd2hpY2ggbmVlZHMgaXRzIHRpbWVyIHN0YXJ0ZWQuCiAgICBmdW5jdGlvbiBfdHJpZ2dlckNvb2xkb3duKEtpdHR5IHN0b3JhZ2UgX2tpdHRlbikgaW50ZXJuYWwgewogICAgICAgIC8vIENvbXB1dGUgYW4gZXN0aW1hdGlvbiBvZiB0aGUgY29vbGRvd24gdGltZSBpbiBibG9ja3MgKGJhc2VkIG9uIGN1cnJlbnQgY29vbGRvd25JbmRleCkuCiAgICAgICAgX2tpdHRlbi5jb29sZG93bkVuZEJsb2NrID0gdWludDY0KChjb29sZG93bnNbX2tpdHRlbi5jb29sZG93bkluZGV4XS9zZWNvbmRzUGVyQmxvY2spICsgYmxvY2subnVtYmVyKTsKCiAgICAgICAgLy8gSW5jcmVtZW50IHRoZSBicmVlZGluZyBjb3VudCwgY2xhbXBpbmcgaXQgYXQgMTMsIHdoaWNoIGlzIHRoZSBsZW5ndGggb2YgdGhlCiAgICAgICAgLy8gY29vbGRvd25zIGFycmF5LiBXZSBjb3VsZCBjaGVjayB0aGUgYXJyYXkgc2l6ZSBkeW5hbWljYWxseSwgYnV0IGhhcmQtY29kaW5nCiAgICAgICAgLy8gdGhpcyBhcyBhIGNvbnN0YW50IHNhdmVzIGdhcy4gWWF5LCBTb2xpZGl0eSEKICAgICAgICBpZiAoX2tpdHRlbi5jb29sZG93bkluZGV4IDwgMTMpIHsKICAgICAgICAgICAgX2tpdHRlbi5jb29sZG93bkluZGV4ICs9IDE7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIEdyYW50cyBhcHByb3ZhbCB0byBhbm90aGVyIHVzZXIgdG8gc2lyZSB3aXRoIG9uZSBvZiB5b3VyIEtpdHRpZXMuCiAgICAvLy8gQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBiZSBhYmxlIHRvIHNpcmUgd2l0aCB5b3VyIEtpdHR5LiBTZXQgdG8KICAgIC8vLyAgYWRkcmVzcygwKSB0byBjbGVhciBhbGwgc2lyaW5nIGFwcHJvdmFscyBmb3IgdGhpcyBLaXR0eS4KICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBBIEtpdHR5IHRoYXQgeW91IG93biB0aGF0IF9hZGRyIHdpbGwgbm93IGJlIGFibGUgdG8gc2lyZSB3aXRoLgogICAgZnVuY3Rpb24gYXBwcm92ZVNpcmluZyhhZGRyZXNzIF9hZGRyLCB1aW50MjU2IF9zaXJlSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfc2lyZUlkKSk7CiAgICAgICAgc2lyZUFsbG93ZWRUb0FkZHJlc3NbX3NpcmVJZF0gPSBfYWRkcjsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGVzIHRoZSBtaW5pbXVtIHBheW1lbnQgcmVxdWlyZWQgZm9yIGNhbGxpbmcgZ2l2ZUJpcnRoQXV0bygpLiBDYW4gb25seQogICAgLy8vICBiZSBjYWxsZWQgYnkgdGhlIENPTyBhZGRyZXNzLiAoVGhpcyBmZWUgaXMgdXNlZCB0byBvZmZzZXQgdGhlIGdhcyBjb3N0IGluY3VycmVkCiAgICAvLy8gIGJ5IHRoZSBhdXRvYmlydGggZGFlbW9uKS4KICAgIGZ1bmN0aW9uIHNldEF1dG9CaXJ0aEZlZSh1aW50MjU2IHZhbCkgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYXV0b0JpcnRoRmVlID0gdmFsOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyB0byBzZWUgaWYgYSBnaXZlbiBLaXR0eSBpcyBwcmVnbmFudCBhbmQgKGlmIHNvKSBpZiB0aGUgZ2VzdGF0aW9uCiAgICAvLy8gIHBlcmlvZCBoYXMgcGFzc2VkLgogICAgZnVuY3Rpb24gX2lzUmVhZHlUb0dpdmVCaXJ0aChLaXR0eSBfbWF0cm9uKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAoX21hdHJvbi5zaXJpbmdXaXRoSWQgIT0gMCkgJiYgKF9tYXRyb24uY29vbGRvd25FbmRCbG9jayA8PSB1aW50NjQoYmxvY2subnVtYmVyKSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIHRoYXQgYSBnaXZlbiBraXR0ZW4gaXMgYWJsZSB0byBicmVlZCAoaS5lLiBpdCBpcyBub3QgcHJlZ25hbnQgb3IKICAgIC8vLyAgaW4gdGhlIG1pZGRsZSBvZiBhIHNpcmluZyBjb29sZG93bikuCiAgICAvLy8gQHBhcmFtIF9raXR0eUlkIHJlZmVyZW5jZSB0aGUgaWQgb2YgdGhlIGtpdHRlbiwgYW55IHVzZXIgY2FuIGlucXVpcmUgYWJvdXQgaXQKICAgIGZ1bmN0aW9uIGlzUmVhZHlUb0JyZWVkKHVpbnQyNTYgX2tpdHR5SWQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfa2l0dHlJZCA+IDApOwogICAgICAgIEtpdHR5IHN0b3JhZ2Uga2l0ID0ga2l0dGllc1tfa2l0dHlJZF07CiAgICAgICAgcmV0dXJuIF9pc1JlYWR5VG9CcmVlZChraXQpOwogICAgfQoKICAgIC8vLyBAZGV2IENoZWNrcyB3aGV0aGVyIGEga2l0dHkgaXMgY3VycmVudGx5IHByZWduYW50LgogICAgLy8vIEBwYXJhbSBfa2l0dHlJZCByZWZlcmVuY2UgdGhlIGlkIG9mIHRoZSBraXR0ZW4sIGFueSB1c2VyIGNhbiBpbnF1aXJlIGFib3V0IGl0CiAgICBmdW5jdGlvbiBpc1ByZWduYW50KHVpbnQyNTYgX2tpdHR5SWQpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfa2l0dHlJZCA+IDApOwogICAgICAgIC8vIEEga2l0dHkgaXMgcHJlZ25hbnQgaWYgYW5kIG9ubHkgaWYgdGhpcyBmaWVsZCBpcyBzZXQKICAgICAgICByZXR1cm4ga2l0dGllc1tfa2l0dHlJZF0uc2lyaW5nV2l0aElkICE9IDA7CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgY2hlY2sgdG8gc2VlIGlmIGEgZ2l2ZW4gc2lyZSBhbmQgbWF0cm9uIGFyZSBhIHZhbGlkIG1hdGluZyBwYWlyLiBET0VTIE5PVAogICAgLy8vICBjaGVjayBvd25lcnNoaXAgcGVybWlzc2lvbnMgKHRoYXQgaXMgdXAgdG8gdGhlIGNhbGxlcikuCiAgICAvLy8gQHBhcmFtIF9tYXRyb24gQSByZWZlcmVuY2UgdG8gdGhlIEtpdHR5IHN0cnVjdCBvZiB0aGUgcG90ZW50aWFsIG1hdHJvbi4KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIFRoZSBtYXRyb24ncyBJRC4KICAgIC8vLyBAcGFyYW0gX3NpcmUgQSByZWZlcmVuY2UgdG8gdGhlIEtpdHR5IHN0cnVjdCBvZiB0aGUgcG90ZW50aWFsIHNpcmUuCiAgICAvLy8gQHBhcmFtIF9zaXJlSWQgVGhlIHNpcmUncyBJRAogICAgZnVuY3Rpb24gX2lzVmFsaWRNYXRpbmdQYWlyKAogICAgICAgIEtpdHR5IHN0b3JhZ2UgX21hdHJvbiwKICAgICAgICB1aW50MjU2IF9tYXRyb25JZCwKICAgICAgICBLaXR0eSBzdG9yYWdlIF9zaXJlLAogICAgICAgIHVpbnQyNTYgX3NpcmVJZAogICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIC8vIEEgS2l0dHkgY2FuJ3QgYnJlZWQgd2l0aCBpdHNlbGYhCiAgICAgICAgaWYgKF9tYXRyb25JZCA9PSBfc2lyZUlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIEtpdHRpZXMgY2FuJ3QgYnJlZWQgd2l0aCB0aGVpciBwYXJlbnRzLgogICAgICAgIGlmIChfbWF0cm9uLm1hdHJvbklkID09IF9zaXJlSWQgfHwgX21hdHJvbi5zaXJlSWQgPT0gX3NpcmVJZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChfc2lyZS5tYXRyb25JZCA9PSBfbWF0cm9uSWQgfHwgX3NpcmUuc2lyZUlkID09IF9tYXRyb25JZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBXZSBjYW4gc2hvcnQgY2lyY3VpdCB0aGUgc2libGluZyBjaGVjayAoYmVsb3cpIGlmIGVpdGhlciBjYXQgaXMKICAgICAgICAvLyBnZW4gemVybyAoaGFzIGEgbWF0cm9uIElEIG9mIHplcm8pLgogICAgICAgIGlmIChfc2lyZS5tYXRyb25JZCA9PSAwIHx8IF9tYXRyb24ubWF0cm9uSWQgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIEtpdHRpZXMgY2FuJ3QgYnJlZWQgd2l0aCBmdWxsIG9yIGhhbGYgc2libGluZ3MuCiAgICAgICAgaWYgKF9zaXJlLm1hdHJvbklkID09IF9tYXRyb24ubWF0cm9uSWQgfHwgX3NpcmUubWF0cm9uSWQgPT0gX21hdHJvbi5zaXJlSWQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoX3NpcmUuc2lyZUlkID09IF9tYXRyb24ubWF0cm9uSWQgfHwgX3NpcmUuc2lyZUlkID09IF9tYXRyb24uc2lyZUlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIEV2ZXJ5dGhpbmcgc2VlbXMgY29vbCEgTGV0J3MgZ2V0IERURi4KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBJbnRlcm5hbCBjaGVjayB0byBzZWUgaWYgYSBnaXZlbiBzaXJlIGFuZCBtYXRyb24gYXJlIGEgdmFsaWQgbWF0aW5nIHBhaXIgZm9yCiAgICAvLy8gIGJyZWVkaW5nIHZpYSBhdWN0aW9uIChpLmUuIHNraXBzIG93bmVyc2hpcCBhbmQgc2lyaW5nIGFwcHJvdmFsIGNoZWNrcykuCiAgICBmdW5jdGlvbiBfY2FuQnJlZWRXaXRoVmlhQXVjdGlvbih1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKQogICAgICAgIGludGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgS2l0dHkgc3RvcmFnZSBtYXRyb24gPSBraXR0aWVzW19tYXRyb25JZF07CiAgICAgICAgS2l0dHkgc3RvcmFnZSBzaXJlID0ga2l0dGllc1tfc2lyZUlkXTsKICAgICAgICByZXR1cm4gX2lzVmFsaWRNYXRpbmdQYWlyKG1hdHJvbiwgX21hdHJvbklkLCBzaXJlLCBfc2lyZUlkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVja3MgdG8gc2VlIGlmIHR3byBjYXRzIGNhbiBicmVlZCB0b2dldGhlciwgaW5jbHVkaW5nIGNoZWNrcyBmb3IKICAgIC8vLyAgb3duZXJzaGlwIGFuZCBzaXJpbmcgYXBwcm92YWxzLiBEb2VzIE5PVCBjaGVjayB0aGF0IGJvdGggY2F0cyBhcmUgcmVhZHkgZm9yCiAgICAvLy8gIGJyZWVkaW5nIChpLmUuIGJyZWVkV2l0aCBjb3VsZCBzdGlsbCBmYWlsIHVudGlsIHRoZSBjb29sZG93bnMgYXJlIGZpbmlzaGVkKS4KICAgIC8vLyAgVE9ETzogU2hvdWxkbid0IHRoaXMgY2hlY2sgcHJlZ25hbmN5IGFuZCBjb29sZG93bnM/IT8KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIFRoZSBJRCBvZiB0aGUgcHJvcG9zZWQgbWF0cm9uLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIFRoZSBJRCBvZiB0aGUgcHJvcG9zZWQgc2lyZS4KICAgIGZ1bmN0aW9uIGNhbkJyZWVkV2l0aCh1aW50MjU2IF9tYXRyb25JZCwgdWludDI1NiBfc2lyZUlkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKF9tYXRyb25JZCA+IDApOwogICAgICAgIHJlcXVpcmUoX3NpcmVJZCA+IDApOwogICAgICAgIEtpdHR5IHN0b3JhZ2UgbWF0cm9uID0ga2l0dGllc1tfbWF0cm9uSWRdOwogICAgICAgIEtpdHR5IHN0b3JhZ2Ugc2lyZSA9IGtpdHRpZXNbX3NpcmVJZF07CiAgICAgICAgcmV0dXJuIF9pc1ZhbGlkTWF0aW5nUGFpcihtYXRyb24sIF9tYXRyb25JZCwgc2lyZSwgX3NpcmVJZCkgJiYKICAgICAgICAgICAgX2lzU2lyaW5nUGVybWl0dGVkKF9zaXJlSWQsIF9tYXRyb25JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgdXRpbGl0eSBmdW5jdGlvbiB0byBpbml0aWF0ZSBicmVlZGluZywgYXNzdW1lcyB0aGF0IGFsbCBicmVlZGluZwogICAgLy8vICByZXF1aXJlbWVudHMgaGF2ZSBiZWVuIGNoZWNrZWQuCiAgICBmdW5jdGlvbiBfYnJlZWRXaXRoKHVpbnQyNTYgX21hdHJvbklkLCB1aW50MjU2IF9zaXJlSWQpIGludGVybmFsIHsKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBLaXR0aWVzIGZyb20gc3RvcmFnZS4KICAgICAgICBLaXR0eSBzdG9yYWdlIHNpcmUgPSBraXR0aWVzW19zaXJlSWRdOwogICAgICAgIEtpdHR5IHN0b3JhZ2UgbWF0cm9uID0ga2l0dGllc1tfbWF0cm9uSWRdOwoKICAgICAgICAvLyBNYXJrIHRoZSBtYXRyb24gYXMgcHJlZ25hbnQsIGtlZXBpbmcgdHJhY2sgb2Ygd2hvIHRoZSBzaXJlIGlzLgogICAgICAgIG1hdHJvbi5zaXJpbmdXaXRoSWQgPSB1aW50MzIoX3NpcmVJZCk7CgogICAgICAgIC8vIFRyaWdnZXIgdGhlIGNvb2xkb3duIGZvciBib3RoIHBhcmVudHMuCiAgICAgICAgX3RyaWdnZXJDb29sZG93bihzaXJlKTsKICAgICAgICBfdHJpZ2dlckNvb2xkb3duKG1hdHJvbik7CgogICAgICAgIC8vIENsZWFyIHNpcmluZyBwZXJtaXNzaW9uIGZvciBib3RoIHBhcmVudHMuIFRoaXMgbWF5IG5vdCBiZSBzdHJpY3RseSBuZWNlc3NhcnkKICAgICAgICAvLyBidXQgaXQncyBsaWtlbHkgdG8gYXZvaWQgY29uZnVzaW9uIQogICAgICAgIGRlbGV0ZSBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfbWF0cm9uSWRdOwogICAgICAgIGRlbGV0ZSBzaXJlQWxsb3dlZFRvQWRkcmVzc1tfc2lyZUlkXTsKCiAgICAgICAgLy8gRXZlcnkgdGltZSBhIGtpdHR5IGdldHMgcHJlZ25hbnQsIGNvdW50ZXIgaXMgaW5jcmVtZW50ZWQuCiAgICAgICAgcHJlZ25hbnRLaXR0aWVzKys7CgogICAgICAgIC8vIEVtaXQgdGhlIHByZWduYW5jeSBldmVudC4KICAgICAgICBQcmVnbmFudChraXR0eUluZGV4VG9Pd25lcltfbWF0cm9uSWRdLCBfbWF0cm9uSWQsIF9zaXJlSWQsIG1hdHJvbi5jb29sZG93bkVuZEJsb2NrKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBCcmVlZCBhIEtpdHR5IHlvdSBvd24gKGFzIG1hdHJvbikgd2l0aCBhIHNpcmUgdGhhdCB5b3Ugb3duLCBvciBmb3Igd2hpY2ggeW91CiAgICAvLy8gIGhhdmUgcHJldmlvdXNseSBiZWVuIGdpdmVuIFNpcmluZyBhcHByb3ZhbC4gV2lsbCBlaXRoZXIgbWFrZSB5b3VyIGNhdCBwcmVnbmFudCwgb3Igd2lsbAogICAgLy8vICBmYWlsIGVudGlyZWx5LiBSZXF1aXJlcyBhIHByZS1wYXltZW50IG9mIHRoZSBmZWUgZ2l2ZW4gb3V0IHRvIHRoZSBmaXJzdCBjYWxsZXIgb2YgZ2l2ZUJpcnRoKCkKICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIFRoZSBJRCBvZiB0aGUgS2l0dHkgYWN0aW5nIGFzIG1hdHJvbiAod2lsbCBlbmQgdXAgcHJlZ25hbnQgaWYgc3VjY2Vzc2Z1bCkKICAgIC8vLyBAcGFyYW0gX3NpcmVJZCBUaGUgSUQgb2YgdGhlIEtpdHR5IGFjdGluZyBhcyBzaXJlICh3aWxsIGJlZ2luIGl0cyBzaXJpbmcgY29vbGRvd24gaWYgc3VjY2Vzc2Z1bCkKICAgIGZ1bmN0aW9uIGJyZWVkV2l0aEF1dG8odWludDI1NiBfbWF0cm9uSWQsIHVpbnQyNTYgX3NpcmVJZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQ2hlY2tzIGZvciBwYXltZW50LgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IGF1dG9CaXJ0aEZlZSk7CgogICAgICAgIC8vIENhbGxlciBtdXN0IG93biB0aGUgbWF0cm9uLgogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX21hdHJvbklkKSk7CgogICAgICAgIC8vIE5laXRoZXIgc2lyZSBub3IgbWF0cm9uIGFyZSBhbGxvd2VkIHRvIGJlIG9uIGF1Y3Rpb24gZHVyaW5nIGEgbm9ybWFsCiAgICAgICAgLy8gYnJlZWRpbmcgb3BlcmF0aW9uLCBidXQgd2UgZG9uJ3QgbmVlZCB0byBjaGVjayB0aGF0IGV4cGxpY2l0bHkuCiAgICAgICAgLy8gRm9yIG1hdHJvbjogVGhlIGNhbGxlciBvZiB0aGlzIGZ1bmN0aW9uIGNhbid0IGJlIHRoZSBvd25lciBvZiB0aGUgbWF0cm9uCiAgICAgICAgLy8gICBiZWNhdXNlIHRoZSBvd25lciBvZiBhIEtpdHR5IG9uIGF1Y3Rpb24gaXMgdGhlIGF1Y3Rpb24gaG91c2UsIGFuZCB0aGUKICAgICAgICAvLyAgIGF1Y3Rpb24gaG91c2Ugd2lsbCBuZXZlciBjYWxsIGJyZWVkV2l0aCgpLgogICAgICAgIC8vIEZvciBzaXJlOiBTaW1pbGFybHksIGEgc2lyZSBvbiBhdWN0aW9uIHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gaG91c2UKICAgICAgICAvLyAgIGFuZCB0aGUgYWN0IG9mIHRyYW5zZmVycmluZyBvd25lcnNoaXAgd2lsbCBoYXZlIGNsZWFyZWQgYW55IG91c3RhbmRpbmcKICAgICAgICAvLyAgIHNpcmluZyBhcHByb3ZhbC4KICAgICAgICAvLyBUaHVzIHdlIGRvbid0IG5lZWQgdG8gc3BlbmQgZ2FzIGV4cGxpY2l0bHkgY2hlY2tpbmcgdG8gc2VlIGlmIGVpdGhlciBjYXQKICAgICAgICAvLyBpcyBvbiBhdWN0aW9uLgoKICAgICAgICAvLyBDaGVjayB0aGF0IG1hdHJvbiBhbmQgc2lyZSBhcmUgYm90aCBvd25lZCBieSBjYWxsZXIsIG9yIHRoYXQgdGhlIHNpcmUKICAgICAgICAvLyBoYXMgZ2l2ZW4gc2lyaW5nIHBlcm1pc3Npb24gdG8gY2FsbGVyIChpLmUuIG1hdHJvbidzIG93bmVyKS4KICAgICAgICAvLyBXaWxsIGZhaWwgZm9yIF9zaXJlSWQgPSAwCiAgICAgICAgcmVxdWlyZShfaXNTaXJpbmdQZXJtaXR0ZWQoX3NpcmVJZCwgX21hdHJvbklkKSk7CgogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIHBvdGVudGlhbCBtYXRyb24KICAgICAgICBLaXR0eSBzdG9yYWdlIG1hdHJvbiA9IGtpdHRpZXNbX21hdHJvbklkXTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIG1hdHJvbiBpc24ndCBwcmVnbmFudCwgb3IgaW4gdGhlIG1pZGRsZSBvZiBhIHNpcmluZyBjb29sZG93bgogICAgICAgIHJlcXVpcmUoX2lzUmVhZHlUb0JyZWVkKG1hdHJvbikpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBwb3RlbnRpYWwgc2lyZQogICAgICAgIEtpdHR5IHN0b3JhZ2Ugc2lyZSA9IGtpdHRpZXNbX3NpcmVJZF07CgogICAgICAgIC8vIE1ha2Ugc3VyZSBzaXJlIGlzbid0IHByZWduYW50LCBvciBpbiB0aGUgbWlkZGxlIG9mIGEgc2lyaW5nIGNvb2xkb3duCiAgICAgICAgcmVxdWlyZShfaXNSZWFkeVRvQnJlZWQoc2lyZSkpOwoKICAgICAgICAvLyBUZXN0IHRoYXQgdGhlc2UgY2F0cyBhcmUgYSB2YWxpZCBtYXRpbmcgcGFpci4KICAgICAgICByZXF1aXJlKF9pc1ZhbGlkTWF0aW5nUGFpcigKICAgICAgICAgICAgbWF0cm9uLAogICAgICAgICAgICBfbWF0cm9uSWQsCiAgICAgICAgICAgIHNpcmUsCiAgICAgICAgICAgIF9zaXJlSWQKICAgICAgICApKTsKCiAgICAgICAgLy8gQWxsIGNoZWNrcyBwYXNzZWQsIGtpdHR5IGdldHMgcHJlZ25hbnQhCiAgICAgICAgX2JyZWVkV2l0aChfbWF0cm9uSWQsIF9zaXJlSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEhhdmUgYSBwcmVnbmFudCBLaXR0eSBnaXZlIGJpcnRoIQogICAgLy8vIEBwYXJhbSBfbWF0cm9uSWQgQSBLaXR0eSByZWFkeSB0byBnaXZlIGJpcnRoLgogICAgLy8vIEByZXR1cm4gVGhlIEtpdHR5IElEIG9mIHRoZSBuZXcga2l0dGVuLgogICAgLy8vIEBkZXYgTG9va3MgYXQgYSBnaXZlbiBLaXR0eSBhbmQsIGlmIHByZWduYW50IGFuZCBpZiB0aGUgZ2VzdGF0aW9uIHBlcmlvZCBoYXMgcGFzc2VkLAogICAgLy8vICBjb21iaW5lcyB0aGUgZ2VuZXMgb2YgdGhlIHR3byBwYXJlbnRzIHRvIGNyZWF0ZSBhIG5ldyBraXR0ZW4uIFRoZSBuZXcgS2l0dHkgaXMgYXNzaWduZWQKICAgIC8vLyAgdG8gdGhlIGN1cnJlbnQgb3duZXIgb2YgdGhlIG1hdHJvbi4gVXBvbiBzdWNjZXNzZnVsIGNvbXBsZXRpb24sIGJvdGggdGhlIG1hdHJvbiBhbmQgdGhlCiAgICAvLy8gIG5ldyBraXR0ZW4gd2lsbCBiZSByZWFkeSB0byBicmVlZCBhZ2Fpbi4gTm90ZSB0aGF0IGFueW9uZSBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uIChpZiB0aGV5CiAgICAvLy8gIGFyZSB3aWxsaW5nIHRvIHBheSB0aGUgZ2FzISksIGJ1dCB0aGUgbmV3IGtpdHRlbiBhbHdheXMgZ29lcyB0byB0aGUgbW90aGVyJ3Mgb3duZXIuCiAgICBmdW5jdGlvbiBnaXZlQmlydGgodWludDI1NiBfbWF0cm9uSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICAgICAgcmV0dXJucyh1aW50MjU2KQogICAgewogICAgICAgIC8vIEdyYWIgYSByZWZlcmVuY2UgdG8gdGhlIG1hdHJvbiBpbiBzdG9yYWdlLgogICAgICAgIEtpdHR5IHN0b3JhZ2UgbWF0cm9uID0ga2l0dGllc1tfbWF0cm9uSWRdOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBtYXRyb24gaXMgYSB2YWxpZCBjYXQuCiAgICAgICAgcmVxdWlyZShtYXRyb24uYmlydGhUaW1lICE9IDApOwoKICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBtYXRyb24gaXMgcHJlZ25hbnQsIGFuZCB0aGF0IGl0cyB0aW1lIGhhcyBjb21lIQogICAgICAgIHJlcXVpcmUoX2lzUmVhZHlUb0dpdmVCaXJ0aChtYXRyb24pKTsKCiAgICAgICAgLy8gR3JhYiBhIHJlZmVyZW5jZSB0byB0aGUgc2lyZSBpbiBzdG9yYWdlLgogICAgICAgIHVpbnQyNTYgc2lyZUlkID0gbWF0cm9uLnNpcmluZ1dpdGhJZDsKICAgICAgICBLaXR0eSBzdG9yYWdlIHNpcmUgPSBraXR0aWVzW3NpcmVJZF07CgogICAgICAgIC8vIERldGVybWluZSB0aGUgaGlnaGVyIGdlbmVyYXRpb24gbnVtYmVyIG9mIHRoZSB0d28gcGFyZW50cwogICAgICAgIHVpbnQxNiBwYXJlbnRHZW4gPSBtYXRyb24uZ2VuZXJhdGlvbjsKICAgICAgICBpZiAoc2lyZS5nZW5lcmF0aW9uID4gbWF0cm9uLmdlbmVyYXRpb24pIHsKICAgICAgICAgICAgcGFyZW50R2VuID0gc2lyZS5nZW5lcmF0aW9uOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsbCB0aGUgc29vcGVyLXNla3JldCBnZW5lIG1peGluZyBvcGVyYXRpb24uCiAgICAgICAgdWludDI1NiBjaGlsZEdlbmVzID0gZ2VuZVNjaWVuY2UubWl4R2VuZXMobWF0cm9uLmdlbmVzLCBzaXJlLmdlbmVzLCBtYXRyb24uY29vbGRvd25FbmRCbG9jayAtIDEpOwoKICAgICAgICAvLyBNYWtlIHRoZSBuZXcga2l0dGVuIQogICAgICAgIGFkZHJlc3Mgb3duZXIgPSBraXR0eUluZGV4VG9Pd25lcltfbWF0cm9uSWRdOwogICAgICAgIHVpbnQyNTYga2l0dGVuSWQgPSBfY3JlYXRlS2l0dHkoX21hdHJvbklkLCBtYXRyb24uc2lyaW5nV2l0aElkLCBwYXJlbnRHZW4gKyAxLCBjaGlsZEdlbmVzLCBvd25lcik7CgogICAgICAgIC8vIENsZWFyIHRoZSByZWZlcmVuY2UgdG8gc2lyZSBmcm9tIHRoZSBtYXRyb24gKFJFUVVJUkVEISBIYXZpbmcgc2lyaW5nV2l0aElkCiAgICAgICAgLy8gc2V0IGlzIHdoYXQgbWFya3MgYSBtYXRyb24gYXMgYmVpbmcgcHJlZ25hbnQuKQogICAgICAgIGRlbGV0ZSBtYXRyb24uc2lyaW5nV2l0aElkOwoKICAgICAgICAvLyBFdmVyeSB0aW1lIGEga2l0dHkgZ2l2ZXMgYmlydGggY291bnRlciBpcyBkZWNyZW1lbnRlZC4KICAgICAgICBwcmVnbmFudEtpdHRpZXMtLTsKCiAgICAgICAgLy8gU2VuZCB0aGUgYmFsYW5jZSBmZWUgdG8gdGhlIHBlcnNvbiB3aG8gbWFkZSBiaXJ0aCBoYXBwZW4uCiAgICAgICAgbXNnLnNlbmRlci5zZW5kKGF1dG9CaXJ0aEZlZSk7CgogICAgICAgIC8vIHJldHVybiB0aGUgbmV3IGtpdHRlbidzIElECiAgICAgICAgcmV0dXJuIGtpdHRlbklkOwogICAgfQp9CgoKCgoKCgoKCgovLy8gQHRpdGxlIEF1Y3Rpb24gQ29yZQovLy8gQGRldiBDb250YWlucyBtb2RlbHMsIHZhcmlhYmxlcywgYW5kIGludGVybmFsIG1ldGhvZHMgZm9yIHRoZSBhdWN0aW9uLgovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IENsb2NrQXVjdGlvbkJhc2UgewoKICAgIC8vIFJlcHJlc2VudHMgYW4gYXVjdGlvbiBvbiBhbiBORlQKICAgIHN0cnVjdCBBdWN0aW9uIHsKICAgICAgICAvLyBDdXJyZW50IG93bmVyIG9mIE5GVAogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uCiAgICAgICAgdWludDEyOCBzdGFydGluZ1ByaWNlOwogICAgICAgIC8vIFByaWNlIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uCiAgICAgICAgdWludDEyOCBlbmRpbmdQcmljZTsKICAgICAgICAvLyBEdXJhdGlvbiAoaW4gc2Vjb25kcykgb2YgYXVjdGlvbgogICAgICAgIHVpbnQ2NCBkdXJhdGlvbjsKICAgICAgICAvLyBUaW1lIHdoZW4gYXVjdGlvbiBzdGFydGVkCiAgICAgICAgLy8gTk9URTogMCBpZiB0aGlzIGF1Y3Rpb24gaGFzIGJlZW4gY29uY2x1ZGVkCiAgICAgICAgdWludDY0IHN0YXJ0ZWRBdDsKICAgIH0KCiAgICAvLyBSZWZlcmVuY2UgdG8gY29udHJhY3QgdHJhY2tpbmcgTkZUIG93bmVyc2hpcAogICAgRVJDNzIxIHB1YmxpYyBub25GdW5naWJsZUNvbnRyYWN0OwoKICAgIC8vIEN1dCBvd25lciB0YWtlcyBvbiBlYWNoIGF1Y3Rpb24sIG1lYXN1cmVkIGluIGJhc2lzIHBvaW50cyAoMS8xMDAgb2YgYSBwZXJjZW50KS4KICAgIC8vIFZhbHVlcyAwLTEwLDAwMCBtYXAgdG8gMCUtMTAwJQogICAgdWludDI1NiBwdWJsaWMgb3duZXJDdXQ7CgogICAgLy8gTWFwIGZyb20gdG9rZW4gSUQgdG8gdGhlaXIgY29ycmVzcG9uZGluZyBhdWN0aW9uLgogICAgbWFwcGluZyAodWludDI1NiA9PiBBdWN0aW9uKSB0b2tlbklkVG9BdWN0aW9uOwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiBzdGFydGluZ1ByaWNlLCB1aW50MjU2IGVuZGluZ1ByaWNlLCB1aW50MjU2IGR1cmF0aW9uKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiB0b3RhbFByaWNlLCBhZGRyZXNzIHdpbm5lcik7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgdG9rZW5JZCk7CgogICAgLy8vIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBjbGFpbWFudCBvd25zIHRoZSB0b2tlbi4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IC0gQWRkcmVzcyBjbGFpbWluZyB0byBvd24gdGhlIHRva2VuLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHdob3NlIG93bmVyc2hpcCB0byB2ZXJpZnkuCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChub25GdW5naWJsZUNvbnRyYWN0Lm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudCk7CiAgICB9CgogICAgLy8vIEBkZXYgRXNjcm93cyB0aGUgTkZULCBhc3NpZ25pbmcgb3duZXJzaGlwIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gVGhyb3dzIGlmIHRoZSBlc2Nyb3cgZmFpbHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciAtIEN1cnJlbnQgb3duZXIgYWRkcmVzcyBvZiB0b2tlbiB0byBlc2Nyb3cuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gd2hvc2UgYXBwcm92YWwgdG8gdmVyaWZ5LgogICAgZnVuY3Rpb24gX2VzY3JvdyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIC8vIGl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0LnRyYW5zZmVyRnJvbShfb3duZXIsIHRoaXMsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBUcmFuc2ZlcnMgYW4gTkZUIG93bmVkIGJ5IHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciBhZGRyZXNzLgogICAgLy8vIFJldHVybnMgdHJ1ZSBpZiB0aGUgdHJhbnNmZXIgc3VjY2VlZHMuCiAgICAvLy8gQHBhcmFtIF9yZWNlaXZlciAtIEFkZHJlc3MgdG8gdHJhbnNmZXIgTkZUIHRvLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX3JlY2VpdmVyLCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gaXQgd2lsbCB0aHJvdyBpZiB0cmFuc2ZlciBmYWlscwogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIoX3JlY2VpdmVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgQWRkcyBhbiBhdWN0aW9uIHRvIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuIEFsc28gZmlyZXMgdGhlCiAgICAvLy8gIEF1Y3Rpb25DcmVhdGVkIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIGJlIHB1dCBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiBBdWN0aW9uIHRvIGFkZC4KICAgIGZ1bmN0aW9uIF9hZGRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIEF1Y3Rpb24gX2F1Y3Rpb24pIGludGVybmFsIHsKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgYWxsIGF1Y3Rpb25zIGhhdmUgYSBkdXJhdGlvbiBvZgogICAgICAgIC8vIGF0IGxlYXN0IG9uZSBtaW51dGUuIChLZWVwcyBvdXIgbWF0aCBmcm9tIGdldHRpbmcgaGFpcnkhKQogICAgICAgIHJlcXVpcmUoX2F1Y3Rpb24uZHVyYXRpb24gPj0gMSBtaW51dGVzKTsKCiAgICAgICAgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF0gPSBfYXVjdGlvbjsKCiAgICAgICAgQXVjdGlvbkNyZWF0ZWQoCiAgICAgICAgICAgIHVpbnQyNTYoX3Rva2VuSWQpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MjU2KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5kdXJhdGlvbikKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENhbmNlbHMgYW4gYXVjdGlvbiB1bmNvbmRpdGlvbmFsbHkuCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CiAgICAgICAgX3RyYW5zZmVyKF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uQ2FuY2VsbGVkKF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDb21wdXRlcyB0aGUgcHJpY2UgYW5kIHRyYW5zZmVycyB3aW5uaW5ncy4KICAgIC8vLyBEb2VzIE5PVCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgdG9rZW4uCiAgICBmdW5jdGlvbiBfYmlkKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2JpZEFtb3VudCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgLy8gR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CgogICAgICAgIC8vIEV4cGxpY2l0bHkgY2hlY2sgdGhhdCB0aGlzIGF1Y3Rpb24gaXMgY3VycmVudGx5IGxpdmUuCiAgICAgICAgLy8gKEJlY2F1c2Ugb2YgaG93IEV0aGVyZXVtIG1hcHBpbmdzIHdvcmssIHdlIGNhbid0IGp1c3QgY291bnQKICAgICAgICAvLyBvbiB0aGUgbG9va3VwIGFib3ZlIGZhaWxpbmcuIEFuIGludmFsaWQgX3Rva2VuSWQgd2lsbCBqdXN0CiAgICAgICAgLy8gcmV0dXJuIGFuIGF1Y3Rpb24gb2JqZWN0IHRoYXQgaXMgYWxsIHplcm9zLikKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGJpZCBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGN1cnJlbnQgcHJpY2UKICAgICAgICB1aW50MjU2IHByaWNlID0gX2N1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgICAgICByZXF1aXJlKF9iaWRBbW91bnQgPj0gcHJpY2UpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzZWxsZXIgYmVmb3JlIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIC8vIGdldHMgZGVsZXRlZC4KICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwoKICAgICAgICAvLyBUaGUgYmlkIGlzIGdvb2QhIFJlbW92ZSB0aGUgYXVjdGlvbiBiZWZvcmUgc2VuZGluZyB0aGUgZmVlcwogICAgICAgIC8vIHRvIHRoZSBzZW5kZXIgc28gd2UgY2FuJ3QgaGF2ZSBhIHJlZW50cmFuY3kgYXR0YWNrLgogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgcHJvY2VlZHMgdG8gc2VsbGVyIChpZiB0aGVyZSBhcmUgYW55ISkKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYXVjdGlvbmVlcidzIGN1dC4KICAgICAgICAgICAgLy8gKE5PVEU6IF9jb21wdXRlQ3V0KCkgaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gYQogICAgICAgICAgICAvLyB2YWx1ZSA8PSBwcmljZSwgc28gdGhpcyBzdWJ0cmFjdGlvbiBjYW4ndCBnbyBuZWdhdGl2ZS4pCiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbmVlckN1dCA9IF9jb21wdXRlQ3V0KHByaWNlKTsKICAgICAgICAgICAgdWludDI1NiBzZWxsZXJQcm9jZWVkcyA9IHByaWNlIC0gYXVjdGlvbmVlckN1dDsKCiAgICAgICAgICAgIC8vIE5PVEU6IERvaW5nIGEgdHJhbnNmZXIoKSBpbiB0aGUgbWlkZGxlIG9mIGEgY29tcGxleAogICAgICAgICAgICAvLyBtZXRob2QgbGlrZSB0aGlzIGlzIGdlbmVyYWxseSBkaXNjb3VyYWdlZCBiZWNhdXNlIG9mCiAgICAgICAgICAgIC8vIHJlZW50cmFuY3kgYXR0YWNrcyBhbmQgRG9TIGF0dGFja3MgaWYgdGhlIHNlbGxlciBpcwogICAgICAgICAgICAvLyBhIGNvbnRyYWN0IHdpdGggYW4gaW52YWxpZCBmYWxsYmFjayBmdW5jdGlvbi4gV2UgZXhwbGljaXRseQogICAgICAgICAgICAvLyBndWFyZCBhZ2FpbnN0IHJlZW50cmFuY3kgYXR0YWNrcyBieSByZW1vdmluZyB0aGUgYXVjdGlvbgogICAgICAgICAgICAvLyBiZWZvcmUgY2FsbGluZyB0cmFuc2ZlcigpLCBhbmQgdGhlIG9ubHkgdGhpbmcgdGhlIHNlbGxlcgogICAgICAgICAgICAvLyBjYW4gRG9TIGlzIHRoZSBzYWxlIG9mIHRoZWlyIG93biBhc3NldCEgKEFuZCBpZiBpdCdzIGFuCiAgICAgICAgICAgIC8vIGFjY2lkZW50LCB0aGV5IGNhbiBjYWxsIGNhbmNlbEF1Y3Rpb24oKS4gKQogICAgICAgICAgICBzZWxsZXIudHJhbnNmZXIoc2VsbGVyUHJvY2VlZHMpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2FsY3VsYXRlIGFueSBleGNlc3MgZnVuZHMgaW5jbHVkZWQgd2l0aCB0aGUgYmlkLiBJZiB0aGUgZXhjZXNzCiAgICAgICAgLy8gaXMgYW55dGhpbmcgd29ydGggd29ycnlpbmcgYWJvdXQsIHRyYW5zZmVyIGl0IGJhY2sgdG8gYmlkZGVyLgogICAgICAgIC8vIE5PVEU6IFdlIGNoZWNrZWQgYWJvdmUgdGhhdCB0aGUgYmlkIGFtb3VudCBpcyBncmVhdGVyIHRoYW4gb3IKICAgICAgICAvLyBlcXVhbCB0byB0aGUgcHJpY2Ugc28gdGhpcyBjYW5ub3QgdW5kZXJmbG93LgogICAgICAgIHVpbnQyNTYgYmlkRXhjZXNzID0gX2JpZEFtb3VudCAtIHByaWNlOwoKICAgICAgICAvLyBSZXR1cm4gdGhlIGZ1bmRzLiBTaW1pbGFyIHRvIHRoZSBwcmV2aW91cyB0cmFuc2ZlciwgdGhpcyBpcwogICAgICAgIC8vIG5vdCBzdXNjZXB0aWJsZSB0byBhIHJlLWVudHJ5IGF0dGFjayBiZWNhdXNlIHRoZSBhdWN0aW9uIGlzCiAgICAgICAgLy8gcmVtb3ZlZCBiZWZvcmUgYW55IHRyYW5zZmVycyBvY2N1ci4KICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGJpZEV4Y2Vzcyk7CgogICAgICAgIC8vIFRlbGwgdGhlIHdvcmxkIQogICAgICAgIEF1Y3Rpb25TdWNjZXNzZnVsKF90b2tlbklkLCBwcmljZSwgbXNnLnNlbmRlcik7CgogICAgICAgIHJldHVybiBwcmljZTsKICAgIH0KCiAgICAvLy8gQGRldiBSZW1vdmVzIGFuIGF1Y3Rpb24gZnJvbSB0aGUgbGlzdCBvZiBvcGVuIGF1Y3Rpb25zLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIE5GVCBvbiBhdWN0aW9uLgogICAgZnVuY3Rpb24gX3JlbW92ZUF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgewogICAgICAgIGRlbGV0ZSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIE5GVCBpcyBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfYXVjdGlvbiAtIEF1Y3Rpb24gdG8gY2hlY2suCiAgICBmdW5jdGlvbiBfaXNPbkF1Y3Rpb24oQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9hdWN0aW9uLnN0YXJ0ZWRBdCA+IDApOwogICAgfQoKICAgIC8vLyBAZGV2IFJldHVybnMgY3VycmVudCBwcmljZSBvZiBhbiBORlQgb24gYXVjdGlvbi4gQnJva2VuIGludG8gdHdvCiAgICAvLy8gIGZ1bmN0aW9ucyAodGhpcyBvbmUsIHRoYXQgY29tcHV0ZXMgdGhlIGR1cmF0aW9uIGZyb20gdGhlIGF1Y3Rpb24KICAgIC8vLyAgc3RydWN0dXJlLCBhbmQgdGhlIG90aGVyIHRoYXQgZG9lcyB0aGUgcHJpY2UgY29tcHV0YXRpb24pIHNvIHdlCiAgICAvLy8gIGNhbiBlYXNpbHkgdGVzdCB0aGF0IHRoZSBwcmljZSBjb21wdXRhdGlvbiB3b3JrcyBjb3JyZWN0bHkuCiAgICBmdW5jdGlvbiBfY3VycmVudFByaWNlKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikKICAgICAgICBpbnRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHVpbnQyNTYgc2Vjb25kc1Bhc3NlZCA9IDA7CgogICAgICAgIC8vIEEgYml0IG9mIGluc3VyYW5jZSBhZ2FpbnN0IG5lZ2F0aXZlIHZhbHVlcyAob3Igd3JhcGFyb3VuZCkuCiAgICAgICAgLy8gUHJvYmFibHkgbm90IG5lY2Vzc2FyeSAoc2luY2UgRXRoZXJldW0gZ3Vhcm5hdGVlcyB0aGF0IHRoZQogICAgICAgIC8vIG5vdyB2YXJpYWJsZSBkb2Vzbid0IGV2ZXIgZ28gYmFja3dhcmRzKS4KICAgICAgICBpZiAobm93ID4gX2F1Y3Rpb24uc3RhcnRlZEF0KSB7CiAgICAgICAgICAgIHNlY29uZHNQYXNzZWQgPSBub3cgLSBfYXVjdGlvbi5zdGFydGVkQXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2NvbXB1dGVDdXJyZW50UHJpY2UoCiAgICAgICAgICAgIF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5kdXJhdGlvbiwKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZAogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBkZXYgQ29tcHV0ZXMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4gRmFjdG9yZWQgb3V0CiAgICAvLy8gIGZyb20gX2N1cnJlbnRQcmljZSBzbyB3ZSBjYW4gcnVuIGV4dGVuc2l2ZSB1bml0IHRlc3RzLgogICAgLy8vICBXaGVuIHRlc3RpbmcsIG1ha2UgdGhpcyBmdW5jdGlvbiBwdWJsaWMgYW5kIHR1cm4gb24KICAgIC8vLyAgYEN1cnJlbnQgcHJpY2UgY29tcHV0YXRpb25gIHRlc3Qgc3VpdGUuCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1cnJlbnRQcmljZSgKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIHVpbnQyNTYgX3NlY29uZHNQYXNzZWQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgcHVibGljIGZ1bmN0aW9ucyBjYXJlZnVsbHkgY2FwIHRoZSBtYXhpbXVtIHZhbHVlcyBmb3IKICAgICAgICAvLyAgdGltZSAoYXQgNjQtYml0cykgYW5kIGN1cnJlbmN5IChhdCAxMjgtYml0cykuIF9kdXJhdGlvbiBpcwogICAgICAgIC8vICBhbHNvIGtub3duIHRvIGJlIG5vbi16ZXJvIChzZWUgdGhlIHJlcXVpcmUoKSBzdGF0ZW1lbnQgaW4KICAgICAgICAvLyAgX2FkZEF1Y3Rpb24oKSkKICAgICAgICBpZiAoX3NlY29uZHNQYXNzZWQgPj0gX2R1cmF0aW9uKSB7CiAgICAgICAgICAgIC8vIFdlJ3ZlIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgZHluYW1pYyBwcmljaW5nIHBvcnRpb24KICAgICAgICAgICAgLy8gb2YgdGhlIGF1Y3Rpb24sIGp1c3QgcmV0dXJuIHRoZSBlbmQgcHJpY2UuCiAgICAgICAgICAgIHJldHVybiBfZW5kaW5nUHJpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gU3RhcnRpbmcgcHJpY2UgY2FuIGJlIGhpZ2hlciB0aGFuIGVuZGluZyBwcmljZSAoYW5kIG9mdGVuIGlzISksIHNvCiAgICAgICAgICAgIC8vIHRoaXMgZGVsdGEgY2FuIGJlIG5lZ2F0aXZlLgogICAgICAgICAgICBpbnQyNTYgdG90YWxQcmljZUNoYW5nZSA9IGludDI1NihfZW5kaW5nUHJpY2UpIC0gaW50MjU2KF9zdGFydGluZ1ByaWNlKTsKCiAgICAgICAgICAgIC8vIFRoaXMgbXVsdGlwbGljYXRpb24gY2FuJ3Qgb3ZlcmZsb3csIF9zZWNvbmRzUGFzc2VkIHdpbGwgZWFzaWx5IGZpdCB3aXRoaW4KICAgICAgICAgICAgLy8gNjQtYml0cywgYW5kIHRvdGFsUHJpY2VDaGFuZ2Ugd2lsbCBlYXNpbHkgZml0IHdpdGhpbiAxMjgtYml0cywgdGhlaXIgcHJvZHVjdAogICAgICAgICAgICAvLyB3aWxsIGFsd2F5cyBmaXQgd2l0aGluIDI1Ni1iaXRzLgogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlQ2hhbmdlID0gdG90YWxQcmljZUNoYW5nZSAqIGludDI1Nihfc2Vjb25kc1Bhc3NlZCkgLyBpbnQyNTYoX2R1cmF0aW9uKTsKCiAgICAgICAgICAgIC8vIGN1cnJlbnRQcmljZUNoYW5nZSBjYW4gYmUgbmVnYXRpdmUsIGJ1dCBpZiBzbywgd2lsbCBoYXZlIGEgbWFnbml0dWRlCiAgICAgICAgICAgIC8vIGxlc3MgdGhhdCBfc3RhcnRpbmdQcmljZS4gVGh1cywgdGhpcyByZXN1bHQgd2lsbCBhbHdheXMgZW5kIHVwIHBvc2l0aXZlLgogICAgICAgICAgICBpbnQyNTYgY3VycmVudFByaWNlID0gaW50MjU2KF9zdGFydGluZ1ByaWNlKSArIGN1cnJlbnRQcmljZUNoYW5nZTsKCiAgICAgICAgICAgIHJldHVybiB1aW50MjU2KGN1cnJlbnRQcmljZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIG93bmVyJ3MgY3V0IG9mIGEgc2FsZS4KICAgIC8vLyBAcGFyYW0gX3ByaWNlIC0gU2FsZSBwcmljZSBvZiBORlQuCiAgICBmdW5jdGlvbiBfY29tcHV0ZUN1dCh1aW50MjU2IF9wcmljZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIFNhZmVNYXRoIChvciBzaW1pbGFyKSBpbiB0aGlzIGZ1bmN0aW9uIGJlY2F1c2UKICAgICAgICAvLyAgYWxsIG9mIG91ciBlbnRyeSBmdW5jdGlvbnMgY2FyZWZ1bGx5IGNhcCB0aGUgbWF4aW11bSB2YWx1ZXMgZm9yCiAgICAgICAgLy8gIGN1cnJlbmN5IChhdCAxMjgtYml0cyksIGFuZCBvd25lckN1dCA8PSAxMDAwMCAoc2VlIHRoZSByZXF1aXJlKCkKICAgICAgICAvLyAgc3RhdGVtZW50IGluIHRoZSBDbG9ja0F1Y3Rpb24gY29uc3RydWN0b3IpLiBUaGUgcmVzdWx0IG9mIHRoaXMKICAgICAgICAvLyAgZnVuY3Rpb24gaXMgYWx3YXlzIGd1YXJhbnRlZWQgdG8gYmUgPD0gX3ByaWNlLgogICAgICAgIHJldHVybiBfcHJpY2UgKiBvd25lckN1dCAvIDEwMDAwOwogICAgfQoKfQoKCgoKCgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9CgoKLy8vIEB0aXRsZSBDbG9jayBhdWN0aW9uIGZvciBub24tZnVuZ2libGUgdG9rZW5zLgovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IENsb2NrQXVjdGlvbiBpcyBQYXVzYWJsZSwgQ2xvY2tBdWN0aW9uQmFzZSB7CgogICAgLy8vIEBkZXYgVGhlIEVSQy0xNjUgaW50ZXJmYWNlIHNpZ25hdHVyZSBmb3IgRVJDLTcyMS4KICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1CiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMQogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPSBieXRlczQoMHg5YTIwNDgzZCk7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgY3JlYXRlcyBhIHJlZmVyZW5jZSB0byB0aGUgTkZUIG93bmVyc2hpcCBjb250cmFjdAogICAgLy8vICBhbmQgdmVyaWZpZXMgdGhlIG93bmVyIGN1dCBpcyBpbiB0aGUgdmFsaWQgcmFuZ2UuCiAgICAvLy8gQHBhcmFtIF9uZnRBZGRyZXNzIC0gYWRkcmVzcyBvZiBhIGRlcGxveWVkIGNvbnRyYWN0IGltcGxlbWVudGluZwogICAgLy8vICB0aGUgTm9uZnVuZ2libGUgSW50ZXJmYWNlLgogICAgLy8vIEBwYXJhbSBfY3V0IC0gcGVyY2VudCBjdXQgdGhlIG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbXVzdCBiZQogICAgLy8vICBiZXR3ZWVuIDAtMTAsMDAwLgogICAgZnVuY3Rpb24gQ2xvY2tBdWN0aW9uKGFkZHJlc3MgX25mdEFkZHJlc3MsIHVpbnQyNTYgX2N1dCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9jdXQgPD0gMTAwMDApOwogICAgICAgIG93bmVyQ3V0ID0gX2N1dDsKCiAgICAgICAgRVJDNzIxIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRVJDNzIxKF9uZnRBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LnN1cHBvcnRzSW50ZXJmYWNlKEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgICAgICBub25GdW5naWJsZUNvbnRyYWN0ID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8vIEBkZXYgUmVtb3ZlIGFsbCBFdGhlciBmcm9tIHRoZSBjb250cmFjdCwgd2hpY2ggaXMgdGhlIG93bmVyJ3MgY3V0cwogICAgLy8vICBhcyB3ZWxsIGFzIGFueSBFdGhlciBzZW50IGRpcmVjdGx5IHRvIHRoZSBjb250cmFjdCBhZGRyZXNzLgogICAgLy8vICBBbHdheXMgdHJhbnNmZXJzIHRvIHRoZSBORlQgY29udHJhY3QsIGJ1dCBjYW4gYmUgY2FsbGVkIGVpdGhlciBieQogICAgLy8vICB0aGUgb3duZXIgb3IgdGhlIE5GVCBjb250cmFjdC4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIHsKICAgICAgICBhZGRyZXNzIG5mdEFkZHJlc3MgPSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpOwoKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IG93bmVyIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gbmZ0QWRkcmVzcwogICAgICAgICk7CiAgICAgICAgLy8gV2UgYXJlIHVzaW5nIHRoaXMgYm9vbGVhbiBtZXRob2QgdG8gbWFrZSBzdXJlIHRoYXQgZXZlbiBpZiBvbmUgZmFpbHMgaXQgd2lsbCBzdGlsbCB3b3JrCiAgICAgICAgYm9vbCByZXMgPSBuZnRBZGRyZXNzLnNlbmQodGhpcy5iYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgdGltZSB0byBtb3ZlIGJldHdlZW4gc3RhcnRpbmcKICAgIC8vLyAgcHJpY2UgYW5kIGVuZGluZyBwcmljZSAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhbml0eSBjaGVjayB0aGF0IG5vIGlucHV0cyBvdmVyZmxvdyBob3cgbWFueSBiaXRzIHdlJ3ZlIGFsbG9jYXRlZAogICAgICAgIC8vIHRvIHN0b3JlIHRoZW0gaW4gdGhlIGF1Y3Rpb24gc3RydWN0LgogICAgICAgIHJlcXVpcmUoX3N0YXJ0aW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9zdGFydGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2VuZGluZ1ByaWNlID09IHVpbnQyNTYodWludDEyOChfZW5kaW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZHVyYXRpb24gPT0gdWludDI1Nih1aW50NjQoX2R1cmF0aW9uKSkpOwoKICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CiAgICAgICAgX2VzY3Jvdyhtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MTI4KF9lbmRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChfZHVyYXRpb24pLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CiAgICAgICAgX2FkZEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24pOwogICAgfQoKICAgIC8vLyBAZGV2IEJpZHMgb24gYW4gb3BlbiBhdWN0aW9uLCBjb21wbGV0aW5nIHRoZSBhdWN0aW9uIGFuZCB0cmFuc2ZlcnJpbmcKICAgIC8vLyAgb3duZXJzaGlwIG9mIHRoZSBORlQgaWYgZW5vdWdoIEV0aGVyIGlzIHN1cHBsaWVkLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIHRvIGJpZCBvbi4KICAgIGZ1bmN0aW9uIGJpZCh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBfYmlkIHdpbGwgdGhyb3cgaWYgdGhlIGJpZCBvciBmdW5kcyB0cmFuc2ZlciBmYWlscwogICAgICAgIF9iaWQoX3Rva2VuSWQsIG1zZy52YWx1ZSk7CiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gdGhhdCBoYXNuJ3QgYmVlbiB3b24geWV0LgogICAgLy8vICBSZXR1cm5zIHRoZSBORlQgdG8gb3JpZ2luYWwgb3duZXIuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIGEgc3RhdGUtbW9kaWZ5aW5nIGZ1bmN0aW9uIHRoYXQgY2FuCiAgICAvLy8gIGJlIGNhbGxlZCB3aGlsZSB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIG9uIGF1Y3Rpb24KICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGxlcik7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIHNlbGxlcik7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FuY2VscyBhbiBhdWN0aW9uIHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgIC8vLyAgT25seSB0aGUgb3duZXIgbWF5IGRvIHRoaXMsIGFuZCBORlRzIGFyZSByZXR1cm5lZCB0bwogICAgLy8vICB0aGUgc2VsbGVyLiBUaGlzIHNob3VsZCBvbmx5IGJlIHVzZWQgaW4gZW1lcmdlbmNpZXMuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdGhlIE5GVCBvbiBhdWN0aW9uIHRvIGNhbmNlbC4KICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb25XaGVuUGF1c2VkKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgd2hlblBhdXNlZAogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgX2NhbmNlbEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24uc2VsbGVyKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIGF1Y3Rpb24gaW5mbyBmb3IgYW4gTkZUIG9uIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgTkZUIG9uIGF1Y3Rpb24uCiAgICBmdW5jdGlvbiBnZXRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucwogICAgKAogICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgIHVpbnQyNTYgc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50MjU2IGVuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgZHVyYXRpb24sCiAgICAgICAgdWludDI1NiBzdGFydGVkQXQKICAgICkgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGF1Y3Rpb24uc2VsbGVyLAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIGF1Y3Rpb24uZW5kaW5nUHJpY2UsCiAgICAgICAgICAgIGF1Y3Rpb24uZHVyYXRpb24sCiAgICAgICAgICAgIGF1Y3Rpb24uc3RhcnRlZEF0CiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXR1cm5zIHRoZSBjdXJyZW50IHByaWNlIG9mIGFuIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdGhlIHRva2VuIHByaWNlIHdlIGFyZSBjaGVja2luZy4KICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50MjU2IF90b2tlbklkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CiAgICAgICAgcmV0dXJuIF9jdXJyZW50UHJpY2UoYXVjdGlvbik7CiAgICB9Cgp9CgoKLy8vIEB0aXRsZSBSZXZlcnNlIGF1Y3Rpb24gbW9kaWZpZWQgZm9yIHNpcmluZwovLy8gQG5vdGljZSBXZSBvbWl0IGEgZmFsbGJhY2sgZnVuY3Rpb24gdG8gcHJldmVudCBhY2NpZGVudGFsIHNlbmRzIHRvIHRoaXMgY29udHJhY3QuCmNvbnRyYWN0IFNpcmluZ0Nsb2NrQXVjdGlvbiBpcyBDbG9ja0F1Y3Rpb24gewoKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vICByaWdodCBhdWN0aW9uIGluIG91ciBzZXRTaXJpbmdBdWN0aW9uQWRkcmVzcygpIGNhbGwuCiAgICBib29sIHB1YmxpYyBpc1NpcmluZ0Nsb2NrQXVjdGlvbiA9IHRydWU7CgogICAgLy8gRGVsZWdhdGUgY29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIFNpcmluZ0Nsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyLCB1aW50MjU2IF9jdXQpIHB1YmxpYwogICAgICAgIENsb2NrQXVjdGlvbihfbmZ0QWRkciwgX2N1dCkge30KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4gU2luY2UgdGhpcyBmdW5jdGlvbiBpcyB3cmFwcGVkLAogICAgLy8vIHJlcXVpcmUgc2VuZGVyIHRvIGJlIEtpdHR5Q29yZSBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgYXVjdGlvbiAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgUGxhY2VzIGEgYmlkIGZvciBzaXJpbmcuIFJlcXVpcmVzIHRoZSBzZW5kZXIKICAgIC8vLyBpcyB0aGUgS2l0dHlDb3JlIGNvbnRyYWN0IGJlY2F1c2UgYWxsIGJpZCBtZXRob2RzCiAgICAvLy8gc2hvdWxkIGJlIHdyYXBwZWQuIEFsc28gcmV0dXJucyB0aGUga2l0dHkgdG8gdGhlCiAgICAvLy8gc2VsbGVyIHJhdGhlciB0aGFuIHRoZSB3aW5uZXIuCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhub25GdW5naWJsZUNvbnRyYWN0KSk7CiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXS5zZWxsZXI7CiAgICAgICAgLy8gX2JpZCBjaGVja3MgdGhhdCB0b2tlbiBJRCBpcyB2YWxpZCBhbmQgd2lsbCB0aHJvdyBpZiBiaWQgZmFpbHMKICAgICAgICBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwogICAgICAgIC8vIFdlIHRyYW5zZmVyIHRoZSBraXR0eSBiYWNrIHRvIHRoZSBzZWxsZXIsIHRoZSB3aW5uZXIgd2lsbCBnZXQKICAgICAgICAvLyB0aGUgb2Zmc3ByaW5nCiAgICAgICAgX3RyYW5zZmVyKHNlbGxlciwgX3Rva2VuSWQpOwogICAgfQoKfQoKCgoKCi8vLyBAdGl0bGUgQ2xvY2sgYXVjdGlvbiBtb2RpZmllZCBmb3Igc2FsZSBvZiBraXR0aWVzCi8vLyBAbm90aWNlIFdlIG9taXQgYSBmYWxsYmFjayBmdW5jdGlvbiB0byBwcmV2ZW50IGFjY2lkZW50YWwgc2VuZHMgdG8gdGhpcyBjb250cmFjdC4KY29udHJhY3QgU2FsZUNsb2NrQXVjdGlvbiBpcyBDbG9ja0F1Y3Rpb24gewoKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vICByaWdodCBhdWN0aW9uIGluIG91ciBzZXRTYWxlQXVjdGlvbkFkZHJlc3MoKSBjYWxsLgogICAgYm9vbCBwdWJsaWMgaXNTYWxlQ2xvY2tBdWN0aW9uID0gdHJ1ZTsKCiAgICAvLyBUcmFja3MgbGFzdCA1IHNhbGUgcHJpY2Ugb2YgZ2VuMCBraXR0eSBzYWxlcwogICAgdWludDI1NiBwdWJsaWMgZ2VuMFNhbGVDb3VudDsKICAgIHVpbnQyNTZbNV0gcHVibGljIGxhc3RHZW4wU2FsZVByaWNlczsKCiAgICAvLyBEZWxlZ2F0ZSBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU2FsZUNsb2NrQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyLCB1aW50MjU2IF9jdXQpIHB1YmxpYwogICAgICAgIENsb2NrQXVjdGlvbihfbmZ0QWRkciwgX2N1dCkge30KCiAgICAvLy8gQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0aW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGJlZ2lubmluZyBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZW5kaW5nUHJpY2UgLSBQcmljZSBvZiBpdGVtIChpbiB3ZWkpIGF0IGVuZCBvZiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgYXVjdGlvbiAoaW4gc2Vjb25kcykuCiAgICAvLy8gQHBhcmFtIF9zZWxsZXIgLSBTZWxsZXIsIGlmIG5vdCB0aGUgbWVzc2FnZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfdG9rZW5JZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uLAogICAgICAgIGFkZHJlc3MgX3NlbGxlcgogICAgKQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRoYXQgbm8gaW5wdXRzIG92ZXJmbG93IGhvdyBtYW55IGJpdHMgd2UndmUgYWxsb2NhdGVkCiAgICAgICAgLy8gdG8gc3RvcmUgdGhlbSBpbiB0aGUgYXVjdGlvbiBzdHJ1Y3QuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpKSk7CiAgICAgICAgcmVxdWlyZShfZW5kaW5nUHJpY2UgPT0gdWludDI1Nih1aW50MTI4KF9lbmRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9kdXJhdGlvbiA9PSB1aW50MjU2KHVpbnQ2NChfZHVyYXRpb24pKSk7CgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKG5vbkZ1bmdpYmxlQ29udHJhY3QpKTsKICAgICAgICBfZXNjcm93KF9zZWxsZXIsIF90b2tlbklkKTsKICAgICAgICBBdWN0aW9uIG1lbW9yeSBhdWN0aW9uID0gQXVjdGlvbigKICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgdWludDEyOChfc3RhcnRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQxMjgoX2VuZGluZ1ByaWNlKSwKICAgICAgICAgICAgdWludDY0KF9kdXJhdGlvbiksCiAgICAgICAgICAgIHVpbnQ2NChub3cpCiAgICAgICAgKTsKICAgICAgICBfYWRkQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbik7CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlcyBsYXN0U2FsZVByaWNlIGlmIHNlbGxlciBpcyB0aGUgbmZ0IGNvbnRyYWN0CiAgICAvLy8gT3RoZXJ3aXNlLCB3b3JrcyB0aGUgc2FtZSBhcyBkZWZhdWx0IGJpZCBtZXRob2QuCiAgICBmdW5jdGlvbiBiaWQodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICAvLyBfYmlkIHZlcmlmaWVzIHRva2VuIElEIHNpemUKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdLnNlbGxlcjsKICAgICAgICB1aW50MjU2IHByaWNlID0gX2JpZChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICBfdHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwoKICAgICAgICAvLyBJZiBub3QgYSBnZW4wIGF1Y3Rpb24sIGV4aXQKICAgICAgICBpZiAoc2VsbGVyID09IGFkZHJlc3Mobm9uRnVuZ2libGVDb250cmFjdCkpIHsKICAgICAgICAgICAgLy8gVHJhY2sgZ2VuMCBzYWxlIHByaWNlcwogICAgICAgICAgICBsYXN0R2VuMFNhbGVQcmljZXNbZ2VuMFNhbGVDb3VudCAlIDVdID0gcHJpY2U7CiAgICAgICAgICAgIGdlbjBTYWxlQ291bnQrKzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXZlcmFnZUdlbjBTYWxlUHJpY2UoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IHN1bSA9IDA7CiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgICAgIHN1bSArPSBsYXN0R2VuMFNhbGVQcmljZXNbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdW0gLyA1OwogICAgfQoKfQoKCi8vLyBAdGl0bGUgSGFuZGxlcyBjcmVhdGluZyBhdWN0aW9ucyBmb3Igc2FsZSBhbmQgc2lyaW5nIG9mIGtpdHRpZXMuCi8vLyAgVGhpcyB3cmFwcGVyIG9mIFJldmVyc2VBdWN0aW9uIGV4aXN0cyBvbmx5IHNvIHRoYXQgdXNlcnMgY2FuIGNyZWF0ZQovLy8gIGF1Y3Rpb25zIHdpdGggb25seSBvbmUgdHJhbnNhY3Rpb24uCmNvbnRyYWN0IEtpdHR5QXVjdGlvbiBpcyBLaXR0eUJyZWVkaW5nIHsKCiAgICAvLyBAbm90aWNlIFRoZSBhdWN0aW9uIGNvbnRyYWN0IHZhcmlhYmxlcyBhcmUgZGVmaW5lZCBpbiBLaXR0eUJhc2UgdG8gYWxsb3cKICAgIC8vICB1cyB0byByZWZlciB0byB0aGVtIGluIEtpdHR5T3duZXJzaGlwIHRvIHByZXZlbnQgYWNjaWRlbnRhbCB0cmFuc2ZlcnMuCiAgICAvLyBgc2FsZUF1Y3Rpb25gIHJlZmVycyB0byB0aGUgYXVjdGlvbiBmb3IgZ2VuMCBhbmQgcDJwIHNhbGUgb2Yga2l0dGllcy4KICAgIC8vIGBzaXJpbmdBdWN0aW9uYCByZWZlcnMgdG8gdGhlIGF1Y3Rpb24gZm9yIHNpcmluZyByaWdodHMgb2Yga2l0dGllcy4KCiAgICAvLy8gQGRldiBTZXRzIHRoZSByZWZlcmVuY2UgdG8gdGhlIHNhbGUgYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX2FkZHJlc3MgLSBBZGRyZXNzIG9mIHNhbGUgY29udHJhY3QuCiAgICBmdW5jdGlvbiBzZXRTYWxlQXVjdGlvbkFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgZXh0ZXJuYWwgb25seUNFTyB7CiAgICAgICAgU2FsZUNsb2NrQXVjdGlvbiBjYW5kaWRhdGVDb250cmFjdCA9IFNhbGVDbG9ja0F1Y3Rpb24oX2FkZHJlc3MpOwoKICAgICAgICAvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0gaHR0cHM6Ly9naXRodWIuY29tL0x1bnlyL2Nyb3dkc2FsZS1jb250cmFjdHMvYmxvYi9jZmFkZDE1OTg2YzMwNTIxZDhiYTdkNWI2ZjU3YjRmZWZjYzdhYzM4L2NvbnRyYWN0cy9MdW55clRva2VuLnNvbCNMMTE3CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc1NhbGVDbG9ja0F1Y3Rpb24oKSk7CgogICAgICAgIC8vIFNldCB0aGUgbmV3IGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBzYWxlQXVjdGlvbiA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IFNldHMgdGhlIHJlZmVyZW5jZSB0byB0aGUgc2lyaW5nIGF1Y3Rpb24uCiAgICAvLy8gQHBhcmFtIF9hZGRyZXNzIC0gQWRkcmVzcyBvZiBzaXJpbmcgY29udHJhY3QuCiAgICBmdW5jdGlvbiBzZXRTaXJpbmdBdWN0aW9uQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICBTaXJpbmdDbG9ja0F1Y3Rpb24gY2FuZGlkYXRlQ29udHJhY3QgPSBTaXJpbmdDbG9ja0F1Y3Rpb24oX2FkZHJlc3MpOwoKICAgICAgICAvLyBOT1RFOiB2ZXJpZnkgdGhhdCBhIGNvbnRyYWN0IGlzIHdoYXQgd2UgZXhwZWN0IC0gaHR0cHM6Ly9naXRodWIuY29tL0x1bnlyL2Nyb3dkc2FsZS1jb250cmFjdHMvYmxvYi9jZmFkZDE1OTg2YzMwNTIxZDhiYTdkNWI2ZjU3YjRmZWZjYzdhYzM4L2NvbnRyYWN0cy9MdW55clRva2VuLnNvbCNMMTE3CiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc1NpcmluZ0Nsb2NrQXVjdGlvbigpKTsKCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcwogICAgICAgIHNpcmluZ0F1Y3Rpb24gPSBjYW5kaWRhdGVDb250cmFjdDsKICAgIH0KCiAgICAvLy8gQGRldiBQdXQgYSBraXR0eSB1cCBmb3IgYXVjdGlvbi4KICAgIC8vLyAgRG9lcyBzb21lIG93bmVyc2hpcCB0cmlja2VyeSB0byBjcmVhdGUgYXVjdGlvbnMgaW4gb25lIHR4LgogICAgZnVuY3Rpb24gY3JlYXRlU2FsZUF1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfa2l0dHlJZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQXVjdGlvbiBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBraXR0eSBpcyBhbHJlYWR5IG9uIGFueSBhdWN0aW9uLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfa2l0dHlJZCkpOwogICAgICAgIC8vIEVuc3VyZSB0aGUga2l0dHkgaXMgbm90IHByZWduYW50IHRvIHByZXZlbnQgdGhlIGF1Y3Rpb24KICAgICAgICAvLyBjb250cmFjdCBhY2NpZGVudGFsbHkgcmVjZWl2aW5nIG93bmVyc2hpcCBvZiB0aGUgY2hpbGQuCiAgICAgICAgLy8gTk9URTogdGhlIGtpdHR5IElTIGFsbG93ZWQgdG8gYmUgaW4gYSBjb29sZG93bi4KICAgICAgICByZXF1aXJlKCFpc1ByZWduYW50KF9raXR0eUlkKSk7CiAgICAgICAgX2FwcHJvdmUoX2tpdHR5SWQsIHNhbGVBdWN0aW9uKTsKICAgICAgICAvLyBTYWxlIGF1Y3Rpb24gdGhyb3dzIGlmIGlucHV0cyBhcmUgaW52YWxpZCBhbmQgY2xlYXJzCiAgICAgICAgLy8gdHJhbnNmZXIgYW5kIHNpcmUgYXBwcm92YWwgYWZ0ZXIgZXNjcm93aW5nIHRoZSBraXR0eS4KICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBfa2l0dHlJZCwKICAgICAgICAgICAgX3N0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9lbmRpbmdQcmljZSwKICAgICAgICAgICAgX2R1cmF0aW9uLAogICAgICAgICAgICBtc2cuc2VuZGVyCiAgICAgICAgKTsKICAgIH0KCiAgICAvLy8gQGRldiBQdXQgYSBraXR0eSB1cCBmb3IgYXVjdGlvbiB0byBiZSBzaXJlLgogICAgLy8vICBQZXJmb3JtcyBjaGVja3MgdG8gZW5zdXJlIHRoZSBraXR0eSBjYW4gYmUgc2lyZWQsIHRoZW4KICAgIC8vLyAgZGVsZWdhdGVzIHRvIHJldmVyc2UgYXVjdGlvbi4KICAgIGZ1bmN0aW9uIGNyZWF0ZVNpcmluZ0F1Y3Rpb24oCiAgICAgICAgdWludDI1NiBfa2l0dHlJZCwKICAgICAgICB1aW50MjU2IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQyNTYgX2R1cmF0aW9uCiAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgLy8gQXVjdGlvbiBjb250cmFjdCBjaGVja3MgaW5wdXQgc2l6ZXMKICAgICAgICAvLyBJZiBraXR0eSBpcyBhbHJlYWR5IG9uIGFueSBhdWN0aW9uLCB0aGlzIHdpbGwgdGhyb3cKICAgICAgICAvLyBiZWNhdXNlIGl0IHdpbGwgYmUgb3duZWQgYnkgdGhlIGF1Y3Rpb24gY29udHJhY3QuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfa2l0dHlJZCkpOwogICAgICAgIHJlcXVpcmUoaXNSZWFkeVRvQnJlZWQoX2tpdHR5SWQpKTsKICAgICAgICBfYXBwcm92ZShfa2l0dHlJZCwgc2lyaW5nQXVjdGlvbik7CiAgICAgICAgLy8gU2lyaW5nIGF1Y3Rpb24gdGhyb3dzIGlmIGlucHV0cyBhcmUgaW52YWxpZCBhbmQgY2xlYXJzCiAgICAgICAgLy8gdHJhbnNmZXIgYW5kIHNpcmUgYXBwcm92YWwgYWZ0ZXIgZXNjcm93aW5nIHRoZSBraXR0eS4KICAgICAgICBzaXJpbmdBdWN0aW9uLmNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgICAgIF9raXR0eUlkLAogICAgICAgICAgICBfc3RhcnRpbmdQcmljZSwKICAgICAgICAgICAgX2VuZGluZ1ByaWNlLAogICAgICAgICAgICBfZHVyYXRpb24sCiAgICAgICAgICAgIG1zZy5zZW5kZXIKICAgICAgICApOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXBsZXRlcyBhIHNpcmluZyBhdWN0aW9uIGJ5IGJpZGRpbmcuCiAgICAvLy8gIEltbWVkaWF0ZWx5IGJyZWVkcyB0aGUgd2lubmluZyBtYXRyb24gd2l0aCB0aGUgc2lyZSBvbiBhdWN0aW9uLgogICAgLy8vIEBwYXJhbSBfc2lyZUlkIC0gSUQgb2YgdGhlIHNpcmUgb24gYXVjdGlvbi4KICAgIC8vLyBAcGFyYW0gX21hdHJvbklkIC0gSUQgb2YgdGhlIG1hdHJvbiBvd25lZCBieSB0aGUgYmlkZGVyLgogICAgZnVuY3Rpb24gYmlkT25TaXJpbmdBdWN0aW9uKAogICAgICAgIHVpbnQyNTYgX3NpcmVJZCwKICAgICAgICB1aW50MjU2IF9tYXRyb25JZAogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcGF5YWJsZQogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBBdWN0aW9uIGNvbnRyYWN0IGNoZWNrcyBpbnB1dCBzaXplcwogICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX21hdHJvbklkKSk7CiAgICAgICAgcmVxdWlyZShpc1JlYWR5VG9CcmVlZChfbWF0cm9uSWQpKTsKICAgICAgICByZXF1aXJlKF9jYW5CcmVlZFdpdGhWaWFBdWN0aW9uKF9tYXRyb25JZCwgX3NpcmVJZCkpOwoKICAgICAgICAvLyBEZWZpbmUgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgdGhlIGF1Y3Rpb24uCiAgICAgICAgdWludDI1NiBjdXJyZW50UHJpY2UgPSBzaXJpbmdBdWN0aW9uLmdldEN1cnJlbnRQcmljZShfc2lyZUlkKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBjdXJyZW50UHJpY2UgKyBhdXRvQmlydGhGZWUpOwoKICAgICAgICAvLyBTaXJpbmcgYXVjdGlvbiB3aWxsIHRocm93IGlmIHRoZSBiaWQgZmFpbHMuCiAgICAgICAgc2lyaW5nQXVjdGlvbi5iaWQudmFsdWUobXNnLnZhbHVlIC0gYXV0b0JpcnRoRmVlKShfc2lyZUlkKTsKICAgICAgICBfYnJlZWRXaXRoKHVpbnQzMihfbWF0cm9uSWQpLCB1aW50MzIoX3NpcmVJZCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFRyYW5zZmVycyB0aGUgYmFsYW5jZSBvZiB0aGUgc2FsZSBhdWN0aW9uIGNvbnRyYWN0CiAgICAvLy8gdG8gdGhlIEtpdHR5Q29yZSBjb250cmFjdC4gV2UgdXNlIHR3by1zdGVwIHdpdGhkcmF3YWwgdG8KICAgIC8vLyBwcmV2ZW50IHR3byB0cmFuc2ZlciBjYWxscyBpbiB0aGUgYXVjdGlvbiBiaWQgZnVuY3Rpb24uCiAgICBmdW5jdGlvbiB3aXRoZHJhd0F1Y3Rpb25CYWxhbmNlcygpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIHNhbGVBdWN0aW9uLndpdGhkcmF3QmFsYW5jZSgpOwogICAgICAgIHNpcmluZ0F1Y3Rpb24ud2l0aGRyYXdCYWxhbmNlKCk7CiAgICB9Cn0KCgovLy8gQHRpdGxlIGFsbCBmdW5jdGlvbnMgcmVsYXRlZCB0byBjcmVhdGluZyBraXR0ZW5zCmNvbnRyYWN0IEtpdHR5TWludGluZyBpcyBLaXR0eUF1Y3Rpb24gewoKICAgIC8vIExpbWl0cyB0aGUgbnVtYmVyIG9mIGNhdHMgdGhlIGNvbnRyYWN0IG93bmVyIGNhbiBldmVyIGNyZWF0ZS4KICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFBST01PX0NSRUFUSU9OX0xJTUlUID0gNTAwMDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEdFTjBfQ1JFQVRJT05fTElNSVQgPSA0NTAwMDsKCiAgICAvLyBDb25zdGFudHMgZm9yIGdlbjAgYXVjdGlvbnMuCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBHRU4wX1NUQVJUSU5HX1BSSUNFID0gMTAgZmlubmV5OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR0VOMF9BVUNUSU9OX0RVUkFUSU9OID0gMSBkYXlzOwoKICAgIC8vIENvdW50cyB0aGUgbnVtYmVyIG9mIGNhdHMgdGhlIGNvbnRyYWN0IG93bmVyIGhhcyBjcmVhdGVkLgogICAgdWludDI1NiBwdWJsaWMgcHJvbW9DcmVhdGVkQ291bnQ7CiAgICB1aW50MjU2IHB1YmxpYyBnZW4wQ3JlYXRlZENvdW50OwoKICAgIC8vLyBAZGV2IHdlIGNhbiBjcmVhdGUgcHJvbW8ga2l0dGVucywgdXAgdG8gYSBsaW1pdC4gT25seSBjYWxsYWJsZSBieSBDT08KICAgIC8vLyBAcGFyYW0gX2dlbmVzIHRoZSBlbmNvZGVkIGdlbmVzIG9mIHRoZSBraXR0ZW4gdG8gYmUgY3JlYXRlZCwgYW55IHZhbHVlIGlzIGFjY2VwdGVkCiAgICAvLy8gQHBhcmFtIF9vd25lciB0aGUgZnV0dXJlIG93bmVyIG9mIHRoZSBjcmVhdGVkIGtpdHRlbnMuIERlZmF1bHQgdG8gY29udHJhY3QgQ09PCiAgICBmdW5jdGlvbiBjcmVhdGVQcm9tb0tpdHR5KHVpbnQyNTYgX2dlbmVzLCBhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgb25seUNPTyB7CiAgICAgICAgYWRkcmVzcyBraXR0eU93bmVyID0gX293bmVyOwogICAgICAgIGlmIChraXR0eU93bmVyID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgIGtpdHR5T3duZXIgPSBjb29BZGRyZXNzOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKHByb21vQ3JlYXRlZENvdW50IDwgUFJPTU9fQ1JFQVRJT05fTElNSVQpOwoKICAgICAgICBwcm9tb0NyZWF0ZWRDb3VudCsrOwogICAgICAgIF9jcmVhdGVLaXR0eSgwLCAwLCAwLCBfZ2VuZXMsIGtpdHR5T3duZXIpOwogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYSBuZXcgZ2VuMCBraXR0eSB3aXRoIHRoZSBnaXZlbiBnZW5lcyBhbmQKICAgIC8vLyAgY3JlYXRlcyBhbiBhdWN0aW9uIGZvciBpdC4KICAgIGZ1bmN0aW9uIGNyZWF0ZUdlbjBBdWN0aW9uKHVpbnQyNTYgX2dlbmVzKSBleHRlcm5hbCBvbmx5Q09PIHsKICAgICAgICByZXF1aXJlKGdlbjBDcmVhdGVkQ291bnQgPCBHRU4wX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgdWludDI1NiBraXR0eUlkID0gX2NyZWF0ZUtpdHR5KDAsIDAsIDAsIF9nZW5lcywgYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgX2FwcHJvdmUoa2l0dHlJZCwgc2FsZUF1Y3Rpb24pOwoKICAgICAgICBzYWxlQXVjdGlvbi5jcmVhdGVBdWN0aW9uKAogICAgICAgICAgICBraXR0eUlkLAogICAgICAgICAgICBfY29tcHV0ZU5leHRHZW4wUHJpY2UoKSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgR0VOMF9BVUNUSU9OX0RVUkFUSU9OLAogICAgICAgICAgICBhZGRyZXNzKHRoaXMpCiAgICAgICAgKTsKCiAgICAgICAgZ2VuMENyZWF0ZWRDb3VudCsrOwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSBuZXh0IGdlbjAgYXVjdGlvbiBzdGFydGluZyBwcmljZSwgZ2l2ZW4KICAgIC8vLyAgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHBhc3QgNSBwcmljZXMgKyA1MCUuCiAgICBmdW5jdGlvbiBfY29tcHV0ZU5leHRHZW4wUHJpY2UoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGF2ZVByaWNlID0gc2FsZUF1Y3Rpb24uYXZlcmFnZUdlbjBTYWxlUHJpY2UoKTsKCiAgICAgICAgLy8gU2FuaXR5IGNoZWNrIHRvIGVuc3VyZSB3ZSBkb24ndCBvdmVyZmxvdyBhcml0aG1ldGljCiAgICAgICAgcmVxdWlyZShhdmVQcmljZSA9PSB1aW50MjU2KHVpbnQxMjgoYXZlUHJpY2UpKSk7CgogICAgICAgIHVpbnQyNTYgbmV4dFByaWNlID0gYXZlUHJpY2UgKyAoYXZlUHJpY2UgLyAyKTsKCiAgICAgICAgLy8gV2UgbmV2ZXIgYXVjdGlvbiBmb3IgbGVzcyB0aGFuIHN0YXJ0aW5nIHByaWNlCiAgICAgICAgaWYgKG5leHRQcmljZSA8IEdFTjBfU1RBUlRJTkdfUFJJQ0UpIHsKICAgICAgICAgICAgbmV4dFByaWNlID0gR0VOMF9TVEFSVElOR19QUklDRTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXh0UHJpY2U7CiAgICB9Cn0KCgovLy8gQHRpdGxlIENyeXB0b0tpdHRpZXM6IENvbGxlY3RpYmxlLCBicmVlZGFibGUsIGFuZCBvaC1zby1hZG9yYWJsZSBjYXRzIG9uIHRoZSBFdGhlcmV1bSBibG9ja2NoYWluLgovLy8gQGF1dGhvciBBeGlvbSBaZW4gKGh0dHBzOi8vd3d3LmF4aW9temVuLmNvKQovLy8gQGRldiBUaGUgbWFpbiBDcnlwdG9LaXR0aWVzIGNvbnRyYWN0LCBrZWVwcyB0cmFjayBvZiBraXR0ZW5zIHNvIHRoZXkgZG9uJ3Qgd2FuZGVyIGFyb3VuZCBhbmQgZ2V0IGxvc3QuCmNvbnRyYWN0IEtpdHR5Q29yZSBpcyBLaXR0eU1pbnRpbmcgewoKICAgIC8vIFRoaXMgaXMgdGhlIG1haW4gQ3J5cHRvS2l0dGllcyBjb250cmFjdC4gSW4gb3JkZXIgdG8ga2VlcCBvdXIgY29kZSBzZXBlcmF0ZWQgaW50byBsb2dpY2FsIHNlY3Rpb25zLAogICAgLy8gd2UndmUgYnJva2VuIGl0IHVwIGluIHR3byB3YXlzLiBGaXJzdCwgd2UgaGF2ZSBzZXZlcmFsIHNlcGVyYXRlbHktaW5zdGFudGlhdGVkIHNpYmxpbmcgY29udHJhY3RzCiAgICAvLyB0aGF0IGhhbmRsZSBhdWN0aW9ucyBhbmQgb3VyIHN1cGVyLXRvcC1zZWNyZXQgZ2VuZXRpYyBjb21iaW5hdGlvbiBhbGdvcml0aG0uIFRoZSBhdWN0aW9ucyBhcmUKICAgIC8vIHNlcGVyYXRlIHNpbmNlIHRoZWlyIGxvZ2ljIGlzIHNvbWV3aGF0IGNvbXBsZXggYW5kIHRoZXJlJ3MgYWx3YXlzIGEgcmlzayBvZiBzdWJ0bGUgYnVncy4gQnkga2VlcGluZwogICAgLy8gdGhlbSBpbiB0aGVpciBvd24gY29udHJhY3RzLCB3ZSBjYW4gdXBncmFkZSB0aGVtIHdpdGhvdXQgZGlzcnVwdGluZyB0aGUgbWFpbiBjb250cmFjdCB0aGF0IHRyYWNrcwogICAgLy8ga2l0dHkgb3duZXJzaGlwLiBUaGUgZ2VuZXRpYyBjb21iaW5hdGlvbiBhbGdvcml0aG0gaXMga2VwdCBzZXBlcmF0ZSBzbyB3ZSBjYW4gb3Blbi1zb3VyY2UgYWxsIG9mCiAgICAvLyB0aGUgcmVzdCBvZiBvdXIgY29kZSB3aXRob3V0IG1ha2luZyBpdCBfdG9vXyBlYXN5IGZvciBmb2xrcyB0byBmaWd1cmUgb3V0IGhvdyB0aGUgZ2VuZXRpY3Mgd29yay4KICAgIC8vIERvbid0IHdvcnJ5LCBJJ20gc3VyZSBzb21lb25lIHdpbGwgcmV2ZXJzZSBlbmdpbmVlciBpdCBzb29uIGVub3VnaCEKICAgIC8vCiAgICAvLyBTZWNvbmRseSwgd2UgYnJlYWsgdGhlIGNvcmUgY29udHJhY3QgaW50byBtdWx0aXBsZSBmaWxlcyB1c2luZyBpbmhlcml0ZW5jZSwgb25lIGZvciBlYWNoIG1ham9yCiAgICAvLyBmYWNldCBvZiBmdW5jdGlvbmFsaXR5IG9mIENLLiBUaGlzIGFsbG93cyB1cyB0byBrZWVwIHJlbGF0ZWQgY29kZSBidW5kbGVkIHRvZ2V0aGVyIHdoaWxlIHN0aWxsCiAgICAvLyBhdm9pZGluZyBhIHNpbmdsZSBnaWFudCBmaWxlIHdpdGggZXZlcnl0aGluZyBpbiBpdC4gVGhlIGJyZWFrZG93biBpcyBhcyBmb2xsb3dzOgogICAgLy8KICAgIC8vICAgICAgLSBLaXR0eUJhc2U6IFRoaXMgaXMgd2hlcmUgd2UgZGVmaW5lIHRoZSBtb3N0IGZ1bmRhbWVudGFsIGNvZGUgc2hhcmVkIHRocm91Z2hvdXQgdGhlIGNvcmUKICAgIC8vICAgICAgICAgICAgIGZ1bmN0aW9uYWxpdHkuIFRoaXMgaW5jbHVkZXMgb3VyIG1haW4gZGF0YSBzdG9yYWdlLCBjb25zdGFudHMgYW5kIGRhdGEgdHlwZXMsIHBsdXMKICAgIC8vICAgICAgICAgICAgIGludGVybmFsIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgdGhlc2UgaXRlbXMuCiAgICAvLwogICAgLy8gICAgICAtIEtpdHR5QWNjZXNzQ29udHJvbDogVGhpcyBjb250cmFjdCBtYW5hZ2VzIHRoZSB2YXJpb3VzIGFkZHJlc3NlcyBhbmQgY29uc3RyYWludHMgZm9yIG9wZXJhdGlvbnMKICAgIC8vICAgICAgICAgICAgIHRoYXQgY2FuIGJlIGV4ZWN1dGVkIG9ubHkgYnkgc3BlY2lmaWMgcm9sZXMuIE5hbWVseSBDRU8sIENGTyBhbmQgQ09PLgogICAgLy8KICAgIC8vICAgICAgLSBLaXR0eU93bmVyc2hpcDogVGhpcyBwcm92aWRlcyB0aGUgbWV0aG9kcyByZXF1aXJlZCBmb3IgYmFzaWMgbm9uLWZ1bmdpYmxlIHRva2VuCiAgICAvLyAgICAgICAgICAgICB0cmFuc2FjdGlvbnMsIGZvbGxvd2luZyB0aGUgZHJhZnQgRVJDLTcyMSBzcGVjIChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxKS4KICAgIC8vCiAgICAvLyAgICAgIC0gS2l0dHlCcmVlZGluZzogVGhpcyBmaWxlIGNvbnRhaW5zIHRoZSBtZXRob2RzIG5lY2Vzc2FyeSB0byBicmVlZCBjYXRzIHRvZ2V0aGVyLCBpbmNsdWRpbmcKICAgIC8vICAgICAgICAgICAgIGtlZXBpbmcgdHJhY2sgb2Ygc2lyaW5nIG9mZmVycywgYW5kIHJlbGllcyBvbiBhbiBleHRlcm5hbCBnZW5ldGljIGNvbWJpbmF0aW9uIGNvbnRyYWN0LgogICAgLy8KICAgIC8vICAgICAgLSBLaXR0eUF1Y3Rpb25zOiBIZXJlIHdlIGhhdmUgdGhlIHB1YmxpYyBtZXRob2RzIGZvciBhdWN0aW9uaW5nIG9yIGJpZGRpbmcgb24gY2F0cyBvciBzaXJpbmcKICAgIC8vICAgICAgICAgICAgIHNlcnZpY2VzLiBUaGUgYWN0dWFsIGF1Y3Rpb24gZnVuY3Rpb25hbGl0eSBpcyBoYW5kbGVkIGluIHR3byBzaWJsaW5nIGNvbnRyYWN0cyAob25lCiAgICAvLyAgICAgICAgICAgICBmb3Igc2FsZXMgYW5kIG9uZSBmb3Igc2lyaW5nKSwgd2hpbGUgYXVjdGlvbiBjcmVhdGlvbiBhbmQgYmlkZGluZyBpcyBtb3N0bHkgbWVkaWF0ZWQKICAgIC8vICAgICAgICAgICAgIHRocm91Z2ggdGhpcyBmYWNldCBvZiB0aGUgY29yZSBjb250cmFjdC4KICAgIC8vCiAgICAvLyAgICAgIC0gS2l0dHlNaW50aW5nOiBUaGlzIGZpbmFsIGZhY2V0IGNvbnRhaW5zIHRoZSBmdW5jdGlvbmFsaXR5IHdlIHVzZSBmb3IgY3JlYXRpbmcgbmV3IGdlbjAgY2F0cy4KICAgIC8vICAgICAgICAgICAgIFdlIGNhbiBtYWtlIHVwIHRvIDUwMDAgInByb21vIiBjYXRzIHRoYXQgY2FuIGJlIGdpdmVuIGF3YXkgKGVzcGVjaWFsbHkgaW1wb3J0YW50IHdoZW4KICAgIC8vICAgICAgICAgICAgIHRoZSBjb21tdW5pdHkgaXMgbmV3KSwgYW5kIGFsbCBvdGhlcnMgY2FuIG9ubHkgYmUgY3JlYXRlZCBhbmQgdGhlbiBpbW1lZGlhdGVseSBwdXQgdXAKICAgIC8vICAgICAgICAgICAgIGZvciBhdWN0aW9uIHZpYSBhbiBhbGdvcml0aG1pY2FsbHkgZGV0ZXJtaW5lZCBzdGFydGluZyBwcmljZS4gUmVnYXJkbGVzcyBvZiBob3cgdGhleQogICAgLy8gICAgICAgICAgICAgYXJlIGNyZWF0ZWQsIHRoZXJlIGlzIGEgaGFyZCBsaW1pdCBvZiA1MGsgZ2VuMCBjYXRzLiBBZnRlciB0aGF0LCBpdCdzIGFsbCB1cCB0byB0aGUKICAgIC8vICAgICAgICAgICAgIGNvbW11bml0eSB0byBicmVlZCwgYnJlZWQsIGJyZWVkIQoKICAgIC8vIFNldCBpbiBjYXNlIHRoZSBjb3JlIGNvbnRyYWN0IGlzIGJyb2tlbiBhbmQgYW4gdXBncmFkZSBpcyByZXF1aXJlZAogICAgYWRkcmVzcyBwdWJsaWMgbmV3Q29udHJhY3RBZGRyZXNzOwoKICAgIC8vLyBAbm90aWNlIENyZWF0ZXMgdGhlIG1haW4gQ3J5cHRvS2l0dGllcyBzbWFydCBjb250cmFjdCBpbnN0YW5jZS4KICAgIGZ1bmN0aW9uIEtpdHR5Q29yZSgpIHB1YmxpYyB7CiAgICAgICAgLy8gU3RhcnRzIHBhdXNlZC4KICAgICAgICBwYXVzZWQgPSB0cnVlOwoKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ0VPCiAgICAgICAgY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyBhbHNvIHRoZSBpbml0aWFsIENPTwogICAgICAgIGNvb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyBzdGFydCB3aXRoIHRoZSBteXRoaWNhbCBraXR0ZW4gMCAtIHNvIHdlIGRvbid0IGhhdmUgZ2VuZXJhdGlvbi0wIHBhcmVudCBpc3N1ZXMKICAgICAgICBfY3JlYXRlS2l0dHkoMCwgMCwgMCwgdWludDI1NigtMSksIGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFVzZWQgdG8gbWFyayB0aGUgc21hcnQgY29udHJhY3QgYXMgdXBncmFkZWQsIGluIGNhc2UgdGhlcmUgaXMgYSBzZXJpb3VzCiAgICAvLy8gIGJyZWFraW5nIGJ1Zy4gVGhpcyBtZXRob2QgZG9lcyBub3RoaW5nIGJ1dCBrZWVwIHRyYWNrIG9mIHRoZSBuZXcgY29udHJhY3QgYW5kCiAgICAvLy8gIGVtaXQgYSBtZXNzYWdlIGluZGljYXRpbmcgdGhhdCB0aGUgbmV3IGFkZHJlc3MgaXMgc2V0LiBJdCdzIHVwIHRvIGNsaWVudHMgb2YgdGhpcwogICAgLy8vICBjb250cmFjdCB0byB1cGRhdGUgdG8gdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzIGluIHRoYXQgY2FzZS4gKFRoaXMgY29udHJhY3Qgd2lsbAogICAgLy8vICBiZSBwYXVzZWQgaW5kZWZpbml0ZWx5IGlmIHN1Y2ggYW4gdXBncmFkZSB0YWtlcyBwbGFjZS4pCiAgICAvLy8gQHBhcmFtIF92MkFkZHJlc3MgbmV3IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldE5ld0FkZHJlc3MoYWRkcmVzcyBfdjJBZGRyZXNzKSBleHRlcm5hbCBvbmx5Q0VPIHdoZW5QYXVzZWQgewogICAgICAgIC8vIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgICAgICBuZXdDb250cmFjdEFkZHJlc3MgPSBfdjJBZGRyZXNzOwogICAgICAgIENvbnRyYWN0VXBncmFkZShfdjJBZGRyZXNzKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBObyB0aXBwaW5nIQogICAgLy8vIEBkZXYgUmVqZWN0IGFsbCBFdGhlciBmcm9tIGJlaW5nIHNlbnQgaGVyZSwgdW5sZXNzIGl0J3MgZnJvbSBvbmUgb2YgdGhlCiAgICAvLy8gIHR3byBhdWN0aW9uIGNvbnRyYWN0cy4gKEhvcGVmdWxseSwgd2UgY2FuIHByZXZlbnQgdXNlciBhY2NpZGVudHMuKQogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGFkZHJlc3Moc2FsZUF1Y3Rpb24pIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhzaXJpbmdBdWN0aW9uKQogICAgICAgICk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhbGwgdGhlIHJlbGV2YW50IGluZm9ybWF0aW9uIGFib3V0IGEgc3BlY2lmaWMga2l0dHkuCiAgICAvLy8gQHBhcmFtIF9pZCBUaGUgSUQgb2YgdGhlIGtpdHR5IG9mIGludGVyZXN0LgogICAgZnVuY3Rpb24gZ2V0S2l0dHkodWludDI1NiBfaWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoCiAgICAgICAgYm9vbCBpc0dlc3RhdGluZywKICAgICAgICBib29sIGlzUmVhZHksCiAgICAgICAgdWludDI1NiBjb29sZG93bkluZGV4LAogICAgICAgIHVpbnQyNTYgbmV4dEFjdGlvbkF0LAogICAgICAgIHVpbnQyNTYgc2lyaW5nV2l0aElkLAogICAgICAgIHVpbnQyNTYgYmlydGhUaW1lLAogICAgICAgIHVpbnQyNTYgbWF0cm9uSWQsCiAgICAgICAgdWludDI1NiBzaXJlSWQsCiAgICAgICAgdWludDI1NiBnZW5lcmF0aW9uLAogICAgICAgIHVpbnQyNTYgZ2VuZXMKICAgICkgewogICAgICAgIEtpdHR5IHN0b3JhZ2Uga2l0ID0ga2l0dGllc1tfaWRdOwoKICAgICAgICAvLyBpZiB0aGlzIHZhcmlhYmxlIGlzIDAgdGhlbiBpdCdzIG5vdCBnZXN0YXRpbmcKICAgICAgICBpc0dlc3RhdGluZyA9IChraXQuc2lyaW5nV2l0aElkICE9IDApOwogICAgICAgIGlzUmVhZHkgPSAoa2l0LmNvb2xkb3duRW5kQmxvY2sgPD0gYmxvY2subnVtYmVyKTsKICAgICAgICBjb29sZG93bkluZGV4ID0gdWludDI1NihraXQuY29vbGRvd25JbmRleCk7CiAgICAgICAgbmV4dEFjdGlvbkF0ID0gdWludDI1NihraXQuY29vbGRvd25FbmRCbG9jayk7CiAgICAgICAgc2lyaW5nV2l0aElkID0gdWludDI1NihraXQuc2lyaW5nV2l0aElkKTsKICAgICAgICBiaXJ0aFRpbWUgPSB1aW50MjU2KGtpdC5iaXJ0aFRpbWUpOwogICAgICAgIG1hdHJvbklkID0gdWludDI1NihraXQubWF0cm9uSWQpOwogICAgICAgIHNpcmVJZCA9IHVpbnQyNTYoa2l0LnNpcmVJZCk7CiAgICAgICAgZ2VuZXJhdGlvbiA9IHVpbnQyNTYoa2l0LmdlbmVyYXRpb24pOwogICAgICAgIGdlbmVzID0ga2l0LmdlbmVzOwogICAgfQoKICAgIC8vLyBAZGV2IE92ZXJyaWRlIHVucGF1c2Ugc28gaXQgcmVxdWlyZXMgYWxsIGV4dGVybmFsIGNvbnRyYWN0IGFkZHJlc3NlcwogICAgLy8vICB0byBiZSBzZXQgYmVmb3JlIGNvbnRyYWN0IGNhbiBiZSB1bnBhdXNlZC4gQWxzbywgd2UgY2FuJ3QgaGF2ZQogICAgLy8vICBuZXdDb250cmFjdEFkZHJlc3Mgc2V0IGVpdGhlciwgYmVjYXVzZSB0aGVuIHRoZSBjb250cmFjdCB3YXMgdXBncmFkZWQuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyB3ZSBjYW4gY2FsbCBzdXBlci51bnBhdXNlCiAgICAvLy8gIHdpdGhvdXQgdXNpbmcgYW4gZXhwZW5zaXZlIENBTEwuCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShzYWxlQXVjdGlvbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKHNpcmluZ0F1Y3Rpb24gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShnZW5lU2NpZW5jZSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG5ld0NvbnRyYWN0QWRkcmVzcyA9PSBhZGRyZXNzKDApKTsKCiAgICAgICAgLy8gQWN0dWFsbHkgdW5wYXVzZSB0aGUgY29udHJhY3QuCiAgICAgICAgc3VwZXIudW5wYXVzZSgpOwogICAgfQoKICAgIC8vIEBkZXYgQWxsb3dzIHRoZSBDRk8gdG8gY2FwdHVyZSB0aGUgYmFsYW5jZSBhdmFpbGFibGUgdG8gdGhlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdGhpcy5iYWxhbmNlOwogICAgICAgIC8vIFN1YnRyYWN0IGFsbCB0aGUgY3VycmVudGx5IHByZWduYW50IGtpdHRlbnMgd2UgaGF2ZSwgcGx1cyAxIG9mIG1hcmdpbi4KICAgICAgICB1aW50MjU2IHN1YnRyYWN0RmVlcyA9IChwcmVnbmFudEtpdHRpZXMgKyAxKSAqIGF1dG9CaXJ0aEZlZTsKCiAgICAgICAgaWYgKGJhbGFuY2UgPiBzdWJ0cmFjdEZlZXMpIHsKICAgICAgICAgICAgY2ZvQWRkcmVzcy5zZW5kKGJhbGFuY2UgLSBzdWJ0cmFjdEZlZXMpOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
