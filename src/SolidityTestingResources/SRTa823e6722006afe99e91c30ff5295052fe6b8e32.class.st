Class {
	#name : #SRTa823e6722006afe99e91c30ff5295052fe6b8e32,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa823e6722006afe99e91c30ff5295052fe6b8e32 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLy8gQHRpdGxlIHByb3ZpZGVzIHN1YmplY3QgdG8gcm9sZSBjaGVja2luZyBsb2dpYwpjb250cmFjdCBJQWNjZXNzUG9saWN5IHsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFdlIGRvbid0IG1ha2UgdGhpcyBmdW5jdGlvbiBjb25zdGFudCB0byBhbGxvdyBmb3Igc3RhdGUtdXBkYXRpbmcgYWNjZXNzIGNvbnRyb2xzIHN1Y2ggYXMgcmF0ZSBsaW1pdGluZy4KICAgIC8vLyBAZGV2IGNoZWNrcyBpZiBzdWJqZWN0IGJlbG9uZ3MgdG8gcmVxdWVzdGVkIHJvbGUgZm9yIHBhcnRpY3VsYXIgb2JqZWN0CiAgICAvLy8gQHBhcmFtIHN1YmplY3QgYWRkcmVzcyB0byBiZSBjaGVja2VkIGFnYWluc3Qgcm9sZSwgdHlwaWNhbGx5IG1zZy5zZW5kZXIKICAgIC8vLyBAcGFyYW0gcm9sZSBpZGVudGlmaWVyIG9mIHJlcXVpcmVkIHJvbGUKICAgIC8vLyBAcGFyYW0gb2JqZWN0IGNvbnRyYWN0IGluc3RhbmNlIGNvbnRleHQgZm9yIHJvbGUgY2hlY2tpbmcsIHR5cGljYWxseSBjb250cmFjdCByZXF1ZXN0aW5nIHRoZSBjaGVjawogICAgLy8vIEBwYXJhbSB2ZXJiIGFkZGl0aW9uYWwgZGF0YSwgaW4gY3VycmVudCBBY2Nlc3NDb250cm9sbCBpbXBsZW1lbnRhdGlvbiBtc2cuc2lnCiAgICAvLy8gQHJldHVybiBpZiBzdWJqZWN0IGJlbG9uZ3MgdG8gYSByb2xlCiAgICBmdW5jdGlvbiBhbGxvd2VkKAogICAgICAgIGFkZHJlc3Mgc3ViamVjdCwKICAgICAgICBieXRlczMyIHJvbGUsCiAgICAgICAgYWRkcmVzcyBvYmplY3QsCiAgICAgICAgYnl0ZXM0IHZlcmIKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKTsKfQoKLy8vIEB0aXRsZSBlbmFibGVzIGFjY2VzcyBjb250cm9sIGluIGltcGxlbWVudGluZyBjb250cmFjdAovLy8gQGRldiBzZWUgQWNjZXNzQ29udHJvbGxlZCBmb3IgaW1wbGVtZW50YXRpb24KY29udHJhY3QgSUFjY2Vzc0NvbnRyb2xsZWQgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRXZlbnRzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBtdXN0IGxvZyBvbiBhY2Nlc3MgcG9saWN5IGNoYW5nZQogICAgZXZlbnQgTG9nQWNjZXNzUG9saWN5Q2hhbmdlZCgKICAgICAgICBhZGRyZXNzIGNvbnRyb2xsZXIsCiAgICAgICAgSUFjY2Vzc1BvbGljeSBvbGRQb2xpY3ksCiAgICAgICAgSUFjY2Vzc1BvbGljeSBuZXdQb2xpY3kKICAgICk7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBhbGxvd3MgdG8gY2hhbmdlIGFjY2VzcyBjb250cm9sIG1lY2hhbmlzbSBmb3IgdGhpcyBjb250cmFjdAogICAgLy8vICAgICB0aGlzIG1ldGhvZCBtdXN0IGJlIGl0c2VsZiBhY2Nlc3MgY29udHJvbGxlZCwgc2VlIEFjY2Vzc0NvbnRyb2xsZWQgaW1wbGVtZW50YXRpb24gYW5kIG5vdGljZSBiZWxvdwogICAgLy8vIEBub3RpY2UgaXQgaXMgYSBodWdlIGlzc3VlIGZvciBTb2xpZGl0eSB0aGF0IG1vZGlmaWVycyBhcmUgbm90IHBhcnQgb2YgZnVuY3Rpb24gc2lnbmF0dXJlCiAgICAvLy8gICAgIHRoZW4gaW50ZXJmYWNlcyBjb3VsZCBiZSB1c2VkIGZvciBleGFtcGxlIHRvIGNvbnRyb2wgYWNjZXNzIHNlbWFudGljcwogICAgLy8vIEBwYXJhbSBuZXdQb2xpY3kgbmV3IGFjY2VzcyBwb2xpY3kgdG8gY29udHJvbGwgdGhpcyBjb250cmFjdAogICAgLy8vIEBwYXJhbSBuZXdBY2Nlc3NDb250cm9sbGVyIGFkZHJlc3Mgb2YgUk9MRV9BQ0NFU1NfQ09OVFJPTExFUiBvZiBuZXcgcG9saWN5IHRoYXQgY2FuIHNldCBhY2Nlc3MgdG8gdGhpcyBjb250cmFjdAogICAgZnVuY3Rpb24gc2V0QWNjZXNzUG9saWN5KElBY2Nlc3NQb2xpY3kgbmV3UG9saWN5LCBhZGRyZXNzIG5ld0FjY2Vzc0NvbnRyb2xsZXIpCiAgICAgICAgcHVibGljOwoKICAgIGZ1bmN0aW9uIGFjY2Vzc1BvbGljeSgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChJQWNjZXNzUG9saWN5KTsKCn0KCmNvbnRyYWN0IFN0YW5kYXJkUm9sZXMgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RhbnRzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLyBAbm90aWNlIFNvbGRpdHkgc29tZWhvdyBkb2Vzbid0IGV2YWx1YXRlIHRoaXMgY29tcGlsZSB0aW1lCiAgICAvLyBAZGV2IHJvbGUgd2hpY2ggaGFzIHJpZ2h0cyB0byBjaGFuZ2UgcGVybWlzc2lvbnMgYW5kIHNldCBuZXcgcG9saWN5IGluIGNvbnRyYWN0LCBrZWNjYWsyNTYoIkFjY2Vzc0NvbnRyb2xsZXIiKQogICAgYnl0ZXMzMiBpbnRlcm5hbCBjb25zdGFudCBST0xFX0FDQ0VTU19DT05UUk9MTEVSID0gMHhhYzQyZjhiZWIxNzk3NWVkMDYyZGNiODBjNjNlNmQyMDNlZjFjMmMzMzVjZWQxNDlkYzU2NjRjYzY3MWNiN2RhOwp9CgovLy8gQHRpdGxlIEdyYW51bGFyIGNvZGUgZXhlY3V0aW9uIHBlcm1pc3Npb25zCi8vLyBAbm90aWNlIEludGVuZGVkIHRvIHJlcGxhY2UgZXhpc3RpbmcgT3duYWJsZSBwYXR0ZXJuIHdpdGggbW9yZSBncmFudWxhciBwZXJtaXNzaW9ucyBzZXQgdG8gZXhlY3V0ZSBzbWFydCBjb250cmFjdCBmdW5jdGlvbnMKLy8vICAgICBmb3IgZWFjaCBmdW5jdGlvbiB3aGVyZSAnb25seScgbW9kaWZpZXIgaXMgYXBwbGllZCwgSUFjY2Vzc1BvbGljeSBpbXBsZW1lbnRhdGlvbiBpcyBjYWxsZWQgdG8gZXZhbHVhdGUgaWYgbXNnLnNlbmRlciBiZWxvbmdzIHRvIHJlcXVpcmVkIHJvbGUgZm9yIGNvbnRyYWN0IGJlaW5nIGNhbGxlZC4KLy8vICAgICBBY2Nlc3MgZXZhbHVhdGlvbiBzcGVjaWZpYyBiZWxvbmcgdG8gSUFjY2Vzc1BvbGljeSBpbXBsZW1lbnRhdGlvbiwgc2VlIFJvbGVCYXNlZEFjY2Vzc1BvbGljeSBmb3IgZGV0YWlscy4KLy8vIEBkZXYgU2hvdWxkIGJlIGluaGVyaXRlZCBieSBhIGNvbnRyYWN0IHJlcXVpcmluZyBzdWNoIHBlcm1pc3Npb25zIGNvbnRyb2xsLiBJQWNjZXNzUG9saWN5IG11c3QgYmUgcHJvdmlkZWQgaW4gY29uc3RydWN0b3IuIEFjY2VzcyBwb2xpY3kgbWF5IGJlIHJlcGxhY2VkIHRvIGEgZGlmZmVyZW50IG9uZQovLy8gICAgIGJ5IG1zZy5zZW5kZXIgd2l0aCBST0xFX0FDQ0VTU19DT05UUk9MTEVSIHJvbGUKY29udHJhY3QgQWNjZXNzQ29udHJvbGxlZCBpcyBJQWNjZXNzQ29udHJvbGxlZCwgU3RhbmRhcmRSb2xlcyB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBNdXRhYmxlIHN0YXRlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBJQWNjZXNzUG9saWN5IHByaXZhdGUgX2FjY2Vzc1BvbGljeTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE1vZGlmaWVycwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgbGltaXRzIGZ1bmN0aW9uIGV4ZWN1dGlvbiBvbmx5IHRvIHNlbmRlcnMgYXNzaWduZWQgdG8gcmVxdWlyZWQgJ3JvbGUnCiAgICBtb2RpZmllciBvbmx5KGJ5dGVzMzIgcm9sZSkgewogICAgICAgIHJlcXVpcmUoX2FjY2Vzc1BvbGljeS5hbGxvd2VkKG1zZy5zZW5kZXIsIHJvbGUsIHRoaXMsIG1zZy5zaWcpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RydWN0b3IKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIEFjY2Vzc0NvbnRyb2xsZWQoSUFjY2Vzc1BvbGljeSBwb2xpY3kpIGludGVybmFsIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3MocG9saWN5KSAhPSAweDApOwogICAgICAgIF9hY2Nlc3NQb2xpY3kgPSBwb2xpY3k7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLwogICAgLy8gSW1wbGVtZW50cyBJQWNjZXNzQ29udHJvbGxlZAogICAgLy8KCiAgICBmdW5jdGlvbiBzZXRBY2Nlc3NQb2xpY3koSUFjY2Vzc1BvbGljeSBuZXdQb2xpY3ksIGFkZHJlc3MgbmV3QWNjZXNzQ29udHJvbGxlcikKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5KFJPTEVfQUNDRVNTX0NPTlRST0xMRVIpCiAgICB7CiAgICAgICAgLy8gUk9MRV9BQ0NFU1NfQ09OVFJPTExFUiBtdXN0IGJlIHByZXNlbnQKICAgICAgICAvLyB1bmRlciB0aGUgbmV3IHBvbGljeS4gVGhpcyBwcm92aWRlcyBzb21lCiAgICAgICAgLy8gcHJvdGVjdGlvbiBhZ2FpbnN0IGxvY2tpbmcgeW91cnNlbGYgb3V0LgogICAgICAgIHJlcXVpcmUobmV3UG9saWN5LmFsbG93ZWQobmV3QWNjZXNzQ29udHJvbGxlciwgUk9MRV9BQ0NFU1NfQ09OVFJPTExFUiwgdGhpcywgbXNnLnNpZykpOwoKICAgICAgICAvLyBXZSBjYW4gbm93IHNhZmVseSBzZXQgdGhlIG5ldyBwb2xpY3kgd2l0aG91dCBmb290IHNob290aW5nLgogICAgICAgIElBY2Nlc3NQb2xpY3kgb2xkUG9saWN5ID0gX2FjY2Vzc1BvbGljeTsKICAgICAgICBfYWNjZXNzUG9saWN5ID0gbmV3UG9saWN5OwoKICAgICAgICAvLyBMb2cgZXZlbnQKICAgICAgICBMb2dBY2Nlc3NQb2xpY3lDaGFuZ2VkKG1zZy5zZW5kZXIsIG9sZFBvbGljeSwgbmV3UG9saWN5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBhY2Nlc3NQb2xpY3koKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoSUFjY2Vzc1BvbGljeSkKICAgIHsKICAgICAgICByZXR1cm4gX2FjY2Vzc1BvbGljeTsKICAgIH0KfQoKY29udHJhY3QgQWNjZXNzUm9sZXMgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RhbnRzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLyBOT1RFOiBBbGwgcm9sZXMgYXJlIHNldCB0byB0aGUga2VjY2FrMjU2IGhhc2ggb2YgdGhlCiAgICAvLyBDYW1lbENhc2VkIHJvbGUgbmFtZSwgaS5lLgogICAgLy8gUk9MRV9MT0NLRURfQUNDT1VOVF9BRE1JTiA9IGtlY2NhazI1NigiTG9ja2VkQWNjb3VudEFkbWluIikKCiAgICAvLyBtYXkgc2V0dXAgTG9ja2VkQWNjb3VudCwgY2hhbmdlIGRpc2J1cnNhbCBtZWNoYW5pc20gYW5kIHNldCBtaWdyYXRpb24KICAgIGJ5dGVzMzIgaW50ZXJuYWwgY29uc3RhbnQgUk9MRV9MT0NLRURfQUNDT1VOVF9BRE1JTiA9IDB4NDY3NWRhNTQ2ZDJkOTJjNWI4NmM0ZjcyNmE5ZTYxMDEwZGNlOTFjY2NjMjQ5MWNlNjAxOWU3OGIwOWQyNTcyZTsKCiAgICAvLyBtYXkgc2V0dXAgd2hpdGVsaXN0cyBhbmQgYWJvcnQgd2hpdGVsaXN0aW5nIGNvbnRyYWN0IHdpdGggY3VydmUgcm9sbGJhY2sKICAgIGJ5dGVzMzIgaW50ZXJuYWwgY29uc3RhbnQgUk9MRV9XSElURUxJU1RfQURNSU4gPSAweGFlZjQ1NmU3Yzg2NDQxOGUxZDJhNDBkOTk2Y2E0ZmViZjNhN2UzMTdmZTNhZjVhN2VhNGRkYTU5MDMzYmJlNWM7CgogICAgLy8gTWF5IGlzc3VlIChnZW5lcmF0ZSkgTmV1bWFya3MKICAgIGJ5dGVzMzIgaW50ZXJuYWwgY29uc3RhbnQgUk9MRV9ORVVNQVJLX0lTU1VFUiA9IDB4OTIxYzNhZmExZjFmZmY3MDdhNzg1Zjk1M2ExZTE5N2JkMjhjOWM1MGUzMDA0MjRlMDE1OTUzY2JmMTIwYzA2YzsKCiAgICAvLyBNYXkgYnVybiBOZXVtYXJrcyBpdCBvd25zCiAgICBieXRlczMyIGludGVybmFsIGNvbnN0YW50IFJPTEVfTkVVTUFSS19CVVJORVIgPSAweDE5Y2UzMzEyODVmNDE3MzljZDMzNjJhM2VjMTc2ZWRmZmUwMTQzMTFjMGY4MDc1ODM0ZmRkMTlkNjcxOGU2OWY7CgogICAgLy8gTWF5IGNyZWF0ZSBuZXcgc25hcHNob3RzIG9uIE5ldW1hcmsKICAgIGJ5dGVzMzIgaW50ZXJuYWwgY29uc3RhbnQgUk9MRV9TTkFQU0hPVF9DUkVBVE9SID0gMHgwOGMxNzg1YWZjNTdmOTMzNTIzYmM1MjU4M2E3MmNlOWUxOWIyMjQxMzU0ZTA0ZGQ4NmY0MWY4ODdlM2Q4MTc0OwoKICAgIC8vIE1heSBlbmFibGUvZGlzYWJsZSB0cmFuc2ZlcnMgb24gTmV1bWFyawogICAgYnl0ZXMzMiBpbnRlcm5hbCBjb25zdGFudCBST0xFX1RSQU5TRkVSX0FETUlOID0gMHhiNjUyN2U5NDRjYWNhM2QxNTFiMWY5NGU0OWFjNWUyMjMxNDI2OTQ4NjA3NDNlNjYxNjQ3MjBlMDM0ZWM5YjE5OwoKICAgIC8vIG1heSByZWNsYWltIHRva2Vucy9ldGhlciBmcm9tIGNvbnRyYWN0cyBzdXBwb3J0aW5nIElSZWNsYWltYWJsZSBpbnRlcmZhY2UKICAgIGJ5dGVzMzIgaW50ZXJuYWwgY29uc3RhbnQgUk9MRV9SRUNMQUlNRVIgPSAweDA1NDJiYmQwYzY3MjU3ODk2NmRjYzUyNWIzMGFhMTY3MjNiYjA0MjY3NTU1NGFjNWIwMzYyZjg2YjZlOTdkYzU7CgogICAgLy8gcmVwcmVzZW50cyBsZWdhbGx5IHBsYXRmb3JtIG9wZXJhdG9yIGluIGNhc2Ugb2YgZm9ya3MgYW5kIGNvbnRyYWN0cyB3aXRoIGxlZ2FsIGFncmVlbWVudCBhdHRhY2hlZC4ga2VjY2FrMjU2KCJQbGF0Zm9ybU9wZXJhdG9yUmVwcmVzZW50YXRpdmUiKQogICAgYnl0ZXMzMiBpbnRlcm5hbCBjb25zdGFudCBST0xFX1BMQVRGT1JNX09QRVJBVE9SX1JFUFJFU0VOVEFUSVZFID0gMHhiMmIzMjEzNzc2NTNmNjU1MjA2ZjcxNTE0ZmY5ZjE1MGQwODIyZDA2MmE1YWJjZjIyMGQ1NDllMWRhNzk5OWYwOwoKICAgIC8vIGFsbG93cyB0byBkZXBvc2l0IEVVUi1UIGFuZCBhbGxvdyBhZGRyZXNzZXMgdG8gc2VuZCBhbmQgcmVjZWl2ZSBFVVItVC4ga2VjY2FrMjU2KCJFdXJ0RGVwb3NpdE1hbmFnZXIiKQogICAgYnl0ZXMzMiBpbnRlcm5hbCBjb25zdGFudCBST0xFX0VVUlRfREVQT1NJVF9NQU5BR0VSID0gMHg3YzhlY2RjYmE4MGNlODc4NDhkMTZhZDc3ZWY1N2NjMTk2YzIwOGZjOTVjNTYzOGU0YTQ4YzY4MWEzNGQ0ZmU3Owp9Cgpjb250cmFjdCBJRXRoZXJldW1Gb3JrQXJiaXRlciB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFdmVudHMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGV2ZW50IExvZ0ZvcmtBbm5vdW5jZWQoCiAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgc3RyaW5nIHVybCwKICAgICAgICB1aW50MjU2IGJsb2NrTnVtYmVyCiAgICApOwoKICAgIGV2ZW50IExvZ0ZvcmtTaWduZWQoCiAgICAgICAgdWludDI1NiBibG9ja051bWJlciwKICAgICAgICBieXRlczMyIGJsb2NrSGFzaAogICAgKTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIG5leHRGb3JrTmFtZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChzdHJpbmcpOwoKICAgIGZ1bmN0aW9uIG5leHRGb3JrVXJsKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHN0cmluZyk7CgogICAgZnVuY3Rpb24gbmV4dEZvcmtCbG9ja051bWJlcigpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KTsKCiAgICBmdW5jdGlvbiBsYXN0U2lnbmVkQmxvY2tOdW1iZXIoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1Nik7CgogICAgZnVuY3Rpb24gbGFzdFNpZ25lZEJsb2NrSGFzaCgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChieXRlczMyKTsKCiAgICBmdW5jdGlvbiBsYXN0U2lnbmVkVGltZXN0YW1wKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpOwoKfQoKLyoqCiAqIEB0aXRsZSBsZWdhbGx5IGJpbmRpbmcgc21hcnQgY29udHJhY3QKICogQGRldiBHZW5lcmFsIGFwcHJvYWNoIHRvIHBhcmluZyBsZWdhbCBhbmQgc21hcnQgY29udHJhY3RzOgogKiAxLiBBbGwgdGVybXMgYW5kIGFncmVlbWVudCBhcmUgYmV0d2VlbiB0d28gcGFydGllczogaGVyZSBiZXR3ZWVuIGxlZ2FsIHJlcHJlc2VudGF0aW9uIG9mIHBsYXRmb3JtIG9wZXJhdG9yIHJlcHJlc2VudGF0aXZlIGFuZCBwbGF0Zm9ybSBpbnZlc3Rvci4KICogMi4gUGFydGllcyBhcmUgcmVwcmVzZW50ZWQgYnkgcHVibGljIEV0aGVyZXVtIGFkZHJlc3Nlcy4gUGxhdGZvcm0gaW52ZXN0b3IgaXMgYW5kIGFkZHJlc3MgdGhhdCBob2xkcyBhbmQgY29udHJvbHMgZnVuZHMgYW5kIHJlY2VpdmVzIGFuZCBjb250cm9scyBOZXVtYXJrIHRva2VuCiAqIDMuIExlZ2FsIGFncmVlbWVudCBoYXMgaW1tdXRhYmxlIHBhcnQgdGhhdCBjb3JyZXNwb25kcyB0byBzbWFydCBjb250cmFjdCBjb2RlIGFuZCBtdXRhYmxlIHBhcnQgdGhhdCBtYXkgY2hhbmdlIGZvciBleGFtcGxlIGR1ZSB0byBjaGFuZ2luZyByZWd1bGF0aW9ucyBvciBvdGhlciBleHRlcm5hbGl0aWVzIHRoYXQgc21hcnQgY29udHJhY3QgZG9lcyBub3QgY29udHJvbC4KICogNC4gVGhlcmUgc2hvdWxkIGJlIGEgcHJvdmlzaW9uIGluIGxlZ2FsIGRvY3VtZW50IHRoYXQgZnV0dXJlIGNoYW5nZXMgaW4gbXV0YWJsZSBwYXJ0IGNhbm5vdCBjaGFuZ2UgdGVybXMgb2YgaW1tdXRhYmxlIHBhcnQuCiAqIDUuIEltbXV0YWJsZSBwYXJ0IGxpbmtzIHRvIGNvcnJlc3BvbmRpbmcgc21hcnQgY29udHJhY3QgdmlhIGl0cyBhZGRyZXNzLgogKiA2LiBBZGRpdGlvbmFsIHByb3Zpc2lvbiBzaG91bGQgYmUgYWRkZWQgaWYgc21hcnQgY29udHJhY3Qgc3VwcG9ydHMgaXQKICogIGEuIEZvcmsgcHJvdmlzaW9uCiAqICBiLiBCdWdmaXhpbmcgcHJvdmlzaW9uICh1bmlsYXRlcmFsIGNvZGUgdXBkYXRlIG1lY2hhbmlzbSkKICogIGMuIE1pZ3JhdGlvbiBwcm92aXNpb24gKGJpbGF0ZXJhbCBjb2RlIHVwZGF0ZSBtZWNoYW5pc20pCiAqCiAqIERldGFpbHMgb24gQWdyZWVtZW50IGJhc2UgY2xhc3M6CiAqIDEuIFdlIGJpbmQgc21hcnQgY29udHJhY3QgdG8gbGVnYWwgY29udHJhY3QgYnkgc3RvcmluZyB1cmkgKHByZWZlcmFibHkgaXBmcyBvciBoYXNoKSBvZiB0aGUgbGVnYWwgY29udHJhY3QgaW4gdGhlIHNtYXJ0IGNvbnRyYWN0LiBJdCBpcyBob3dldmVyIGNydWNpYWwgdGhhdCBzdWNoIGJpbmRpbmcgaXMgZG9uZSBieSBwbGF0Zm9ybSBvcGVyYXRvciByZXByZXNlbnRhdGlvbiBzbyB0cmFuc2FjdGlvbiBlc3RhYmxpc2hpbmcgdGhlIGxpbmsgbXVzdCBiZSBzaWduZWQgYnkgcmVzcGVjdGl2ZSB3YWxsZXQgKCdhbWVuZEFncmVlbWVudCcpCiAqIDIuIE11dGFibGUgcGFydCBvZiBhZ3JlZW1lbnQgbWF5IGNoYW5nZS4gV2Ugc2hvdWxkIGJlIGFibGUgdG8gYW1lbmQgdGhlIHVyaSBsYXRlci4gUHJldmlvdXMgYW1lbmRtZW50cyBzaG91bGQgbm90IGJlIGxvc3QgYW5kIHNob3VsZCBiZSByZXRyaWV2YWJsZSAoYGFtZW5kQWdyZWVtZW50YCBhbmQgJ3Bhc3RBZ3JlZW1lbnQnIGZ1bmN0aW9ucykuCiAqIDMuIEl0IGlzIHVwIHRvIGRlcml2aW5nIGNvbnRyYWN0IHRvIGRlY2lkZSB3aGVyZSB0byBwdXQgJ2FjY2VwdEFncmVlbWVudCcgbW9kaWZpZXIuIEhvd2V2ZXIgc2l0dWF0aW9uIHdoZXJlIHRoZXJlIGlzIG5vIGNyeXB0b2dyYXBoaWMgcHJvb2YgdGhhdCBnaXZlbiBhZGRyZXNzIHdhcyByZWFsbHkgYWN0aW5nIGluIHRoZSB0cmFuc2FjdGlvbiBzaG91bGQgYmUgYXZvaWRlZCwgc2ltcGxlc3QgZXhhbXBsZSBiZWluZyAndG8nIGFkZHJlc3MgaW4gYHRyYW5zZmVyYCBmdW5jdGlvbiBvZiBFUkMyMC4KICoKKiovCmNvbnRyYWN0IEFncmVlbWVudCBpcwogICAgQWNjZXNzQ29udHJvbGxlZCwKICAgIEFjY2Vzc1JvbGVzCnsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFR5cGUgZGVjbGFyYXRpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBhZ3JlZW1lbnQgd2l0aCBzaWduYXR1cmUgb2YgdGhlIHBsYXRmb3JtIG9wZXJhdG9yIHJlcHJlc2VudGF0aXZlCiAgICBzdHJ1Y3QgU2lnbmVkQWdyZWVtZW50IHsKICAgICAgICBhZGRyZXNzIHBsYXRmb3JtT3BlcmF0b3JSZXByZXNlbnRhdGl2ZTsKICAgICAgICB1aW50MjU2IHNpZ25lZEJsb2NrVGltZXN0YW1wOwogICAgICAgIHN0cmluZyBhZ3JlZW1lbnRVcmk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbW11dGFibGUgc3RhdGUKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIElFdGhlcmV1bUZvcmtBcmJpdGVyIHByaXZhdGUgRVRIRVJFVU1fRk9SS19BUkJJVEVSOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTXV0YWJsZSBzdGF0ZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gc3RvcmVzIGFsbCBhbWVuZG1lbnRzIHRvIHRoZSBhZ3JlZW1lbnQsIGZpcnN0IGFtZW5kbWVudCBpcyB0aGUgb3JpZ2luYWwKICAgIFNpZ25lZEFncmVlbWVudFtdIHByaXZhdGUgX2FtZW5kbWVudHM7CgogICAgLy8gc3RvcmVzIGJsb2NrIG51bWJlcnMgb2YgYWxsIGFkZHJlc3NlcyB0aGF0IHNpZ25lZCB0aGUgYWdyZWVtZW50IChzaWduYXRvcnkgPT4gYmxvY2sgbnVtYmVyKQogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgX3NpZ25hdG9yaWVzOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRXZlbnRzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBldmVudCBMb2dBZ3JlZW1lbnRBY2NlcHRlZCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgYWNjZXB0ZXIKICAgICk7CgogICAgZXZlbnQgTG9nQWdyZWVtZW50QW1lbmRlZCgKICAgICAgICBhZGRyZXNzIHBsYXRmb3JtT3BlcmF0b3JSZXByZXNlbnRhdGl2ZSwKICAgICAgICBzdHJpbmcgYWdyZWVtZW50VXJpCiAgICApOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTW9kaWZpZXJzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBsb2dzIHRoYXQgYWdyZWVtZW50IHdhcyBhY2NlcHRlZCBieSBwbGF0Zm9ybSB1c2VyCiAgICAvLy8gQGRldiBpbnRlbmRlZCB0byBiZSBhZGRlZCB0byBmdW5jdGlvbnMgdGhhdCBpZiB1c2VkIG1ha2UgJ2FjY2VwdGVyJyBvcmlnaW4gdG8gZW50ZXIgbGVnYWxseSBiaW5kaW5nIGFncmVlbWVudAogICAgbW9kaWZpZXIgYWNjZXB0QWdyZWVtZW50KGFkZHJlc3MgYWNjZXB0ZXIpIHsKICAgICAgICBpZihfc2lnbmF0b3JpZXNbYWNjZXB0ZXJdID09IDApIHsKICAgICAgICAgICAgcmVxdWlyZShfYW1lbmRtZW50cy5sZW5ndGggPiAwKTsKICAgICAgICAgICAgX3NpZ25hdG9yaWVzW2FjY2VwdGVyXSA9IGJsb2NrLm51bWJlcjsKICAgICAgICAgICAgTG9nQWdyZWVtZW50QWNjZXB0ZWQoYWNjZXB0ZXIpOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RydWN0b3IKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIEFncmVlbWVudChJQWNjZXNzUG9saWN5IGFjY2Vzc1BvbGljeSwgSUV0aGVyZXVtRm9ya0FyYml0ZXIgZm9ya0FyYml0ZXIpCiAgICAgICAgQWNjZXNzQ29udHJvbGxlZChhY2Nlc3NQb2xpY3kpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICByZXF1aXJlKGZvcmtBcmJpdGVyICE9IElFdGhlcmV1bUZvcmtBcmJpdGVyKDB4MCkpOwogICAgICAgIEVUSEVSRVVNX0ZPUktfQVJCSVRFUiA9IGZvcmtBcmJpdGVyOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUHVibGljIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gYW1lbmRBZ3JlZW1lbnQoc3RyaW5nIGFncmVlbWVudFVyaSkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5KFJPTEVfUExBVEZPUk1fT1BFUkFUT1JfUkVQUkVTRU5UQVRJVkUpCiAgICB7CiAgICAgICAgU2lnbmVkQWdyZWVtZW50IG1lbW9yeSBhbWVuZG1lbnQgPSBTaWduZWRBZ3JlZW1lbnQoewogICAgICAgICAgICBwbGF0Zm9ybU9wZXJhdG9yUmVwcmVzZW50YXRpdmU6IG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHNpZ25lZEJsb2NrVGltZXN0YW1wOiBibG9jay50aW1lc3RhbXAsCiAgICAgICAgICAgIGFncmVlbWVudFVyaTogYWdyZWVtZW50VXJpCiAgICAgICAgfSk7CiAgICAgICAgX2FtZW5kbWVudHMucHVzaChhbWVuZG1lbnQpOwogICAgICAgIExvZ0FncmVlbWVudEFtZW5kZWQobXNnLnNlbmRlciwgYWdyZWVtZW50VXJpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBldGhlcmV1bUZvcmtBcmJpdGVyKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKElFdGhlcmV1bUZvcmtBcmJpdGVyKQogICAgewogICAgICAgIHJldHVybiBFVEhFUkVVTV9GT1JLX0FSQklURVI7CiAgICB9CgogICAgZnVuY3Rpb24gY3VycmVudEFncmVlbWVudCgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zCiAgICAgICAgKAogICAgICAgICAgICBhZGRyZXNzIHBsYXRmb3JtT3BlcmF0b3JSZXByZXNlbnRhdGl2ZSwKICAgICAgICAgICAgdWludDI1NiBzaWduZWRCbG9ja1RpbWVzdGFtcCwKICAgICAgICAgICAgc3RyaW5nIGFncmVlbWVudFVyaSwKICAgICAgICAgICAgdWludDI1NiBpbmRleAogICAgICAgICkKICAgIHsKICAgICAgICByZXF1aXJlKF9hbWVuZG1lbnRzLmxlbmd0aCA+IDApOwogICAgICAgIHVpbnQyNTYgbGFzdCA9IF9hbWVuZG1lbnRzLmxlbmd0aCAtIDE7CiAgICAgICAgU2lnbmVkQWdyZWVtZW50IHN0b3JhZ2UgYW1lbmRtZW50ID0gX2FtZW5kbWVudHNbbGFzdF07CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgYW1lbmRtZW50LnBsYXRmb3JtT3BlcmF0b3JSZXByZXNlbnRhdGl2ZSwKICAgICAgICAgICAgYW1lbmRtZW50LnNpZ25lZEJsb2NrVGltZXN0YW1wLAogICAgICAgICAgICBhbWVuZG1lbnQuYWdyZWVtZW50VXJpLAogICAgICAgICAgICBsYXN0CiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXN0QWdyZWVtZW50KHVpbnQyNTYgYW1lbmRtZW50SW5kZXgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zCiAgICAgICAgKAogICAgICAgICAgICBhZGRyZXNzIHBsYXRmb3JtT3BlcmF0b3JSZXByZXNlbnRhdGl2ZSwKICAgICAgICAgICAgdWludDI1NiBzaWduZWRCbG9ja1RpbWVzdGFtcCwKICAgICAgICAgICAgc3RyaW5nIGFncmVlbWVudFVyaSwKICAgICAgICAgICAgdWludDI1NiBpbmRleAogICAgICAgICkKICAgIHsKICAgICAgICBTaWduZWRBZ3JlZW1lbnQgc3RvcmFnZSBhbWVuZG1lbnQgPSBfYW1lbmRtZW50c1thbWVuZG1lbnRJbmRleF07CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgYW1lbmRtZW50LnBsYXRmb3JtT3BlcmF0b3JSZXByZXNlbnRhdGl2ZSwKICAgICAgICAgICAgYW1lbmRtZW50LnNpZ25lZEJsb2NrVGltZXN0YW1wLAogICAgICAgICAgICBhbWVuZG1lbnQuYWdyZWVtZW50VXJpLAogICAgICAgICAgICBhbWVuZG1lbnRJbmRleAogICAgICAgICk7CiAgICB9CgogICAgZnVuY3Rpb24gYWdyZWVtZW50U2lnbmVkQXRCbG9jayhhZGRyZXNzIHNpZ25hdG9yeSkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIF9zaWduYXRvcmllc1tzaWduYXRvcnldOwogICAgfQp9Cgpjb250cmFjdCBOZXVtYXJrSXNzdWFuY2VDdXJ2ZSB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25zdGFudHMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vIG1heGltdW0gbnVtYmVyIG9mIG5ldW1hcmtzIHRoYXQgbWF5IGJlIGNyZWF0ZWQKICAgIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBORVVNQVJLX0NBUCA9IDE1MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA7CgogICAgLy8gaW5pdGlhbCBuZXVtYXJrIHJld2FyZCBmcmFjdGlvbiAoY29udHJvbHMgY3VydmUgc3RlZXBuZXNzKQogICAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IElOSVRJQUxfUkVXQVJEX0ZSQUNUSU9OID0gNjUwMDAwMDAwMDAwMDAwMDAwMDsKCiAgICAvLyBzdG9wIGlzc3VpbmcgbmV3IE5ldW1hcmtzIGFib3ZlIHRoaXMgRXVybyB2YWx1ZSAoYXMgaXQgZ29lcyBxdWlja2x5IHRvIHplcm8pCiAgICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgSVNTVUFOQ0VfTElNSVRfRVVSX1VMUFMgPSA4MzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwoKICAgIC8vIGFwcHJveGltYXRlIGN1cnZlIGxpbmVhcmx5IGFib3ZlIHRoaXMgRXVybyB2YWx1ZQogICAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IExJTkVBUl9BUFBST1hfTElNSVRfRVVSX1VMUFMgPSAyMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgdWludDI1NiBwcml2YXRlIGNvbnN0YW50IE5FVU1BUktTX0FUX0xJTkVBUl9MSU1JVF9VTFBTID0gMTQ5OTgzMjUwMTI4NzI2NDgyNzg5NjUzOTg3MTsKCiAgICB1aW50MjU2IHByaXZhdGUgY29uc3RhbnQgVE9UX0xJTkVBUl9ORVVNQVJLU19VTFBTID0gTkVVTUFSS19DQVAgLSBORVVNQVJLU19BVF9MSU5FQVJfTElNSVRfVUxQUzsKICAgIHVpbnQyNTYgcHJpdmF0ZSBjb25zdGFudCBUT1RfTElORUFSX0VVUl9VTFBTID0gSVNTVUFOQ0VfTElNSVRfRVVSX1VMUFMgLSBMSU5FQVJfQVBQUk9YX0xJTUlUX0VVUl9VTFBTOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUHVibGljIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgcmV0dXJucyBhZGRpdGlvbmFsIGFtb3VudCBvZiBuZXVtYXJrcyBpc3N1ZWQgZm9yIGV1cm9VbHBzIGF0IHRvdGFsRXVyb1VscHMKICAgIC8vLyBAcGFyYW0gdG90YWxFdXJvVWxwcyBhY3R1YWwgY3VydmUgcG9zaXRpb24gZnJvbSB3aGljaCBuZXVtYXJrcyB3aWxsIGJlIGlzc3VlZAogICAgLy8vIEBwYXJhbSBldXJvVWxwcyBhbW91bnQgYWdhaW5zdCB3aGljaCBuZXVtYXJrcyB3aWxsIGJlIGlzc3VlZAogICAgZnVuY3Rpb24gaW5jcmVtZW50YWwodWludDI1NiB0b3RhbEV1cm9VbHBzLCB1aW50MjU2IGV1cm9VbHBzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NiBuZXVtYXJrVWxwcykKICAgIHsKICAgICAgICByZXF1aXJlKHRvdGFsRXVyb1VscHMgKyBldXJvVWxwcyA+PSB0b3RhbEV1cm9VbHBzKTsKICAgICAgICB1aW50MjU2IGZyb20gPSBjdW11bGF0aXZlKHRvdGFsRXVyb1VscHMpOwogICAgICAgIHVpbnQyNTYgdG8gPSBjdW11bGF0aXZlKHRvdGFsRXVyb1VscHMgKyBldXJvVWxwcyk7CiAgICAgICAgLy8gYXMgZXhwYW5zaW9uIGlzIG5vdCBtb25vdG9uaWMgZm9yIGxhcmdlIHRvdGFsRXVyb1VscHMsIGFzc2VydCBiZWxvdyBtYXkgZmFpbAogICAgICAgIC8vIGV4YW1wbGU6IHRvdGFsRXVyb1VscHM9MS45OTk5OTk5OTk5OTk5OTk5OTk5OTkwMDAwMDBlKzI3IGFuZCBldXJvVWxwcz01MAogICAgICAgIGFzc2VydCh0byA+PSBmcm9tKTsKICAgICAgICByZXR1cm4gdG8gLSBmcm9tOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHJldHVybnMgYW1vdW50IG9mIGV1cm8gY29ycmVzcG9uZGluZyB0byBidXJuZWQgbmV1bWFya3MKICAgIC8vLyBAcGFyYW0gdG90YWxFdXJvVWxwcyBhY3R1YWwgY3VydmUgcG9zaXRpb24gZnJvbSB3aGljaCBuZXVtYXJrcyB3aWxsIGJlIGJ1cm5lZAogICAgLy8vIEBwYXJhbSBidXJuTmV1bWFya1VscHMgYW1vdW50IG9mIG5ldW1hcmtzIHRvIGJ1cm4KICAgIGZ1bmN0aW9uIGluY3JlbWVudGFsSW52ZXJzZSh1aW50MjU2IHRvdGFsRXVyb1VscHMsIHVpbnQyNTYgYnVybk5ldW1hcmtVbHBzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NiBldXJvVWxwcykKICAgIHsKICAgICAgICB1aW50MjU2IHRvdGFsTmV1bWFya1VscHMgPSBjdW11bGF0aXZlKHRvdGFsRXVyb1VscHMpOwogICAgICAgIHJlcXVpcmUodG90YWxOZXVtYXJrVWxwcyA+PSBidXJuTmV1bWFya1VscHMpOwogICAgICAgIHVpbnQyNTYgZnJvbU5tayA9IHRvdGFsTmV1bWFya1VscHMgLSBidXJuTmV1bWFya1VscHM7CiAgICAgICAgdWludCBuZXdUb3RhbEV1cm9VbHBzID0gY3VtdWxhdGl2ZUludmVyc2UoZnJvbU5taywgMCwgdG90YWxFdXJvVWxwcyk7CiAgICAgICAgLy8geWVzLCB0aGlzIG1heSBvdmVyZmxvdyBkdWUgdG8gbm9uIG1vbm90b25pYyBpbnZlcnNlIGZ1bmN0aW9uCiAgICAgICAgYXNzZXJ0KHRvdGFsRXVyb1VscHMgPj0gbmV3VG90YWxFdXJvVWxwcyk7CiAgICAgICAgcmV0dXJuIHRvdGFsRXVyb1VscHMgLSBuZXdUb3RhbEV1cm9VbHBzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHJldHVybnMgYW1vdW50IG9mIGV1cm8gY29ycmVzcG9uZGluZyB0byBidXJuZWQgbmV1bWFya3MKICAgIC8vLyBAcGFyYW0gdG90YWxFdXJvVWxwcyBhY3R1YWwgY3VydmUgcG9zaXRpb24gZnJvbSB3aGljaCBuZXVtYXJrcyB3aWxsIGJlIGJ1cm5lZAogICAgLy8vIEBwYXJhbSBidXJuTmV1bWFya1VscHMgYW1vdW50IG9mIG5ldW1hcmtzIHRvIGJ1cm4KICAgIC8vLyBAcGFyYW0gbWluRXVyVWxwcyBldXJvIGFtb3VudCB0byBzdGFydCBpbnZlcnNlIHNlYXJjaCBmcm9tLCBpbmNsdXNpdmUKICAgIC8vLyBAcGFyYW0gbWF4RXVyVWxwcyBldXJvIGFtb3VudCB0byBlbmQgaW52ZXJzZSBzZWFyY2ggdG8sIGluY2x1c2l2ZQogICAgZnVuY3Rpb24gaW5jcmVtZW50YWxJbnZlcnNlKHVpbnQyNTYgdG90YWxFdXJvVWxwcywgdWludDI1NiBidXJuTmV1bWFya1VscHMsIHVpbnQyNTYgbWluRXVyVWxwcywgdWludDI1NiBtYXhFdXJVbHBzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NiBldXJvVWxwcykKICAgIHsKICAgICAgICB1aW50MjU2IHRvdGFsTmV1bWFya1VscHMgPSBjdW11bGF0aXZlKHRvdGFsRXVyb1VscHMpOwogICAgICAgIHJlcXVpcmUodG90YWxOZXVtYXJrVWxwcyA+PSBidXJuTmV1bWFya1VscHMpOwogICAgICAgIHVpbnQyNTYgZnJvbU5tayA9IHRvdGFsTmV1bWFya1VscHMgLSBidXJuTmV1bWFya1VscHM7CiAgICAgICAgdWludCBuZXdUb3RhbEV1cm9VbHBzID0gY3VtdWxhdGl2ZUludmVyc2UoZnJvbU5taywgbWluRXVyVWxwcywgbWF4RXVyVWxwcyk7CiAgICAgICAgLy8geWVzLCB0aGlzIG1heSBvdmVyZmxvdyBkdWUgdG8gbm9uIG1vbm90b25pYyBpbnZlcnNlIGZ1bmN0aW9uCiAgICAgICAgYXNzZXJ0KHRvdGFsRXVyb1VscHMgPj0gbmV3VG90YWxFdXJvVWxwcyk7CiAgICAgICAgcmV0dXJuIHRvdGFsRXVyb1VscHMgLSBuZXdUb3RhbEV1cm9VbHBzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGZpbmRzIHRvdGFsIGFtb3VudCBvZiBuZXVtYXJrcyBpc3N1ZWQgZm9yIGdpdmVuIGFtb3VudCBvZiBFdXJvCiAgICAvLy8gQGRldiBiaW5vbWlhbCBleHBhbnNpb24gZG9lcyBub3QgZ3VhcmFudGVlIG1vbm90b25pY2l0eSBvbiB1aW50MjU2IHByZWNpc2lvbiBmb3IgbGFyZ2UgZXVyb1VscHMKICAgIC8vLyAgICAgZnVuY3Rpb24gYmVsb3cgaXMgbm90IG1vbm90b25pYwogICAgZnVuY3Rpb24gY3VtdWxhdGl2ZSh1aW50MjU2IGV1cm9VbHBzKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50MjU2IG5ldW1hcmtVbHBzKQogICAgewogICAgICAgIC8vIFJldHVybiB0aGUgY2FwIGlmIGV1cm9VbHBzIGlzIGFib3ZlIHRoZSBsaW1pdC4KICAgICAgICBpZiAoZXVyb1VscHMgPj0gSVNTVUFOQ0VfTElNSVRfRVVSX1VMUFMpIHsKICAgICAgICAgICAgcmV0dXJuIE5FVU1BUktfQ0FQOwogICAgICAgIH0KICAgICAgICAvLyB1c2UgbGluZWFyIGFwcHJveGltYXRpb24gYWJvdmUgbGltaXQgYmVsb3cKICAgICAgICAvLyBiaW5vbWlhbCBleHBhbnNpb24gZG9lcyBub3QgZ3VhcmFudGVlIG1vbm90b25pY2l0eSBvbiB1aW50MjU2IHByZWNpc2lvbiBmb3IgbGFyZ2UgZXVyb1VscHMKICAgICAgICBpZiAoZXVyb1VscHMgPj0gTElORUFSX0FQUFJPWF9MSU1JVF9FVVJfVUxQUykgewogICAgICAgICAgICAvLyAoZXVyb1VscHMgLSBMSU5FQVJfQVBQUk9YX0xJTUlUX0VVUl9VTFBTKSBpcyBzbWFsbCBzbyBleHByZXNzaW9uIGRvZXMgbm90IG92ZXJmbG93CiAgICAgICAgICAgIHJldHVybiBORVVNQVJLU19BVF9MSU5FQVJfTElNSVRfVUxQUyArIChUT1RfTElORUFSX05FVU1BUktTX1VMUFMgKiAoZXVyb1VscHMgLSBMSU5FQVJfQVBQUk9YX0xJTUlUX0VVUl9VTFBTKSkgLyBUT1RfTElORUFSX0VVUl9VTFBTOwogICAgICAgIH0KCiAgICAgICAgLy8gQXBwcm94aW1hdGUgY2FwLWNhcCYjMTgzOygxLTEvRClebiB1c2luZyB0aGUgQmlub21pYWwgZXhwYW5zaW9uCiAgICAgICAgLy8gaHR0cDovL2dhbGlsZW8ucGh5cy52aXJnaW5pYS5lZHUvY2xhc3Nlcy8xNTIubWYxaS5zcHJpbmcwMi9FeHBvbmVudGlhbF9GdW5jdGlvbi5odG0KICAgICAgICAvLyBGdW5jdGlvbltpbWF4LCAtQ0FQKlN1bVsoLUlSKkVVUi9DQVApXmkvRmFjdG9yaWFsW2ldLCB7aSwgaW1heH1dXQogICAgICAgIC8vIHdoaWNoIG1heSBiZSBzaW1wbGlmaWVkIHRvCiAgICAgICAgLy8gRnVuY3Rpb25baW1heCwgLUNBUCpTdW1bKEVVUileaS8oRmFjdG9yaWFsW2ldKigtZCleaSksIHtpLCAxLCBpbWF4fV1dCiAgICAgICAgLy8gd2hlcmUgZCA9IGNhcC9pbml0aWFsX3Jld2FyZAogICAgICAgIHVpbnQyNTYgZCA9IDIzMDc2OTIzMDc2OTIzMDc2OTIzMDc2OTIzMTsgLy8gTkVVTUFSS19DQVAgLyBJTklUSUFMX1JFV0FSRF9GUkFDVElPTgogICAgICAgIHVpbnQyNTYgdGVybSA9IE5FVU1BUktfQ0FQOwogICAgICAgIHVpbnQyNTYgc3VtID0gMDsKICAgICAgICB1aW50MjU2IGRlbm9tID0gZDsKICAgICAgICBkbyBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIFdlIHVzZSBhc3NlbWJsZXIgcHJpbWFyaWx5IHRvIGF2b2lkIHRoZSBleHBlbnNpdmUKICAgICAgICAgICAgLy8gZGl2aWRlLWJ5LXplcm8gY2hlY2sgc29sYyBpbnNlcnRzIGZvciB0aGUgLyBvcGVyYXRvci4KICAgICAgICAgICAgdGVybSAgOj0gZGl2KG11bCh0ZXJtLCBldXJvVWxwcyksIGRlbm9tKQogICAgICAgICAgICBzdW0gICA6PSBhZGQoc3VtLCB0ZXJtKQogICAgICAgICAgICBkZW5vbSA6PSBhZGQoZGVub20sIGQpCiAgICAgICAgICAgIC8vIHN1YiBuZXh0IHRlcm0gYXMgd2UgaGF2ZSBwb3dlciBvZiBuZWdhdGl2ZSB2YWx1ZSBpbiB0aGUgYmlub21pYWwgZXhwYW5zaW9uCiAgICAgICAgICAgIHRlcm0gIDo9IGRpdihtdWwodGVybSwgZXVyb1VscHMpLCBkZW5vbSkKICAgICAgICAgICAgc3VtICAgOj0gc3ViKHN1bSwgdGVybSkKICAgICAgICAgICAgZGVub20gOj0gYWRkKGRlbm9tLCBkKQogICAgICAgIH0gd2hpbGUgKHRlcm0gIT0gMCk7CiAgICAgICAgcmV0dXJuIHN1bTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBmaW5kIGlzc3VhbmNlIGN1cnZlIGludmVyc2UgYnkgYmluYXJ5IHNlYXJjaAogICAgLy8vIEBwYXJhbSBuZXVtYXJrVWxwcyBuZXVtYXJrIGFtb3VudCB0byBjb21wdXRlIGludmVyc2UgZm9yCiAgICAvLy8gQHBhcmFtIG1pbkV1clVscHMgbWluaW11bSBzZWFyY2ggcmFuZ2UgZm9yIHRoZSBpbnZlcnNlLCBpbmNsdXNpdmUKICAgIC8vLyBAcGFyYW0gbWF4RXVyVWxwcyBtYXhpdW0gc2VhcmNoIHJhbmdlIGZvciB0aGUgaW52ZXJzZSwgaW5jbHVzaXZlCiAgICAvLy8gQGRldiBpbiBjYXNlIG9mIGFwcHJveGltYXRlIHNlYXJjaCAobm8gZXhhY3QgaW52ZXJzZSkgdXBwZXIgZWxlbWVudCBvZiBtaW5pbWFsIHNlYXJjaCByYW5nZSBpcyByZXR1cm5lZAogICAgLy8vIEBkZXYgaW4gY2FzZSBvZiBtYW55IHBvc3NpYmxlIGludmVyc2VzLCB0aGUgbG93ZXN0IG9uZSB3aWxsIGJlIHVzZWQgKGlmIHJhbmdlIHBlcm1pdHMpCiAgICAvLy8gQGRldiBjb3JyZXNwb25kcyB0byBhIGxpbmVhciBzZWFyY2ggdGhhdCByZXR1cm5zIGZpcnN0IGV1cm9VbHAgdmFsdWUgdGhhdCBoYXMgY3VtdWxhdGl2ZSgpIGVxdWFsIG9yIGdyZWF0ZXIgdGhhbiBuZXVtYXJrVWxwcwogICAgZnVuY3Rpb24gY3VtdWxhdGl2ZUludmVyc2UodWludDI1NiBuZXVtYXJrVWxwcywgdWludDI1NiBtaW5FdXJVbHBzLCB1aW50MjU2IG1heEV1clVscHMpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2IGV1cm9VbHBzKQogICAgewogICAgICAgIHJlcXVpcmUobWF4RXVyVWxwcyA+PSBtaW5FdXJVbHBzKTsKICAgICAgICByZXF1aXJlKGN1bXVsYXRpdmUobWluRXVyVWxwcykgPD0gbmV1bWFya1VscHMpOwogICAgICAgIHJlcXVpcmUoY3VtdWxhdGl2ZShtYXhFdXJVbHBzKSA+PSBuZXVtYXJrVWxwcyk7CiAgICAgICAgdWludDI1NiBtaW4gPSBtaW5FdXJVbHBzOwogICAgICAgIHVpbnQyNTYgbWF4ID0gbWF4RXVyVWxwczsKCiAgICAgICAgLy8gQmluYXJ5IHNlYXJjaAogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludDI1NiBtaWQgPSAobWF4ICsgbWluKSAvIDI7CiAgICAgICAgICAgIHVpbnQyNTYgdmFsID0gY3VtdWxhdGl2ZShtaWQpOwogICAgICAgICAgICAvLyBleGFjdCBzb2x1dGlvbiBzaG91bGQgbm90IGJlIHVzZWQsIGEgbGF0ZSBwb2ludHMgb2YgdGhlIGN1cnZlIHdoZW4gbWFueSBldXJvVWxwcyBhcmUgbmVlZGVkIHRvCiAgICAgICAgICAgIC8vIGluY3JlYXNlIGJ5IG9uZSBubWtVbHAgdGhpcyB3aWxsIGxlYWQgdG8gICJpbmRldGVybWluaXN0aWMiIGludmVyc2UgdmFsdWVzIHRoYXQgZGVwZW5kIG9uIHRoZSBpbml0aWFsIG1pbiBhbmQgbWF4CiAgICAgICAgICAgIC8vIGFuZCBmdXJ0aGVyIGJpbmFyeSBkaXZpc2lvbiAtPiB5b3UgY2FuIGxhbmQgYXQgYW55IG9mIHRoZSBldXJvIHZhbHVlIHRoYXQgaXMgbWFwcGVkIHRvIHRoZSBzYW1lIG5tayB2YWx1ZQogICAgICAgICAgICAvLyB3aXRoIGNvbmRpdGlvbiBiZWxvdyByZW1vdmVkLCBiaW5hcnkgc2VhcmNoIHdpbGwgcG9pbnQgdG8gdGhlIGxvd2VzdCBldXIgdmFsdWUgcG9zc2libGUgd2hpY2ggaXMgZ29vZCBiZWNhdXNlIGl0IGNhbm5vdCBiZSBleHBsb2l0ZWQgZXZlbiB3aXRoIDAgZ2FzIGNvc3RzCiAgICAgICAgICAgIC8qIGlmICh2YWwgPT0gbmV1bWFya1VscHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtaWQ7CiAgICAgICAgICAgIH0qLwogICAgICAgICAgICAvLyBOT1RFOiBhcHByb3hpbWF0ZSBzZWFyY2ggKG5vIGludmVyc2UpIG11c3QgcmV0dXJuIHVwcGVyIGVsZW1lbnQgb2YgdGhlIGZpbmFsIHJhbmdlCiAgICAgICAgICAgIC8vICBsYXN0IHN0ZXAgb2YgYXBwcm94aW1hdGUgc2VhcmNoIGlzIGFsd2F5cyAobWluLCBtaW4rMSkgc28gbmV3IG1pZCBpcyAoMiptaW4rMSkvMiA9PiBtaW4KICAgICAgICAgICAgLy8gIHNvIG5ldyBtaW4gPSBtaWQgKyAxID0gbWF4IHdoaWNoIHdhcyB1cHBlciByYW5nZS4gYW5kIHRoYXQgZW5kcyB0aGUgc2VhcmNoCiAgICAgICAgICAgIC8vIE5PVEU6IHdoZW4gdGhlcmUgYXJlIG11bHRpcGxlIGludmVyc2VzIGZvciB0aGUgc2FtZSBuZXVtYXJrVWxwcywgdGhlIGBtYXhgIHdpbGwgYmUgZHJhZ2dlZCBkb3duCiAgICAgICAgICAgIC8vICBieSBgbWF4ID0gbWlkYCBleHByZXNzaW9uIHRvIHRoZSBsb3dlc3QgZXVyIHZhbHVlIG9mIGludmVyc2UuIHdvcmtzIG9ubHkgZm9yIHJhbmdlcyB0aGF0IGNvdmVyIGFsbCBwb2ludHMgb2YgbXVsdGlwbGUgaW52ZXJzZQogICAgICAgICAgICBpZiAodmFsIDwgbmV1bWFya1VscHMpIHsKICAgICAgICAgICAgICAgIG1pbiA9IG1pZCArIDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gTk9URTogSXQgaXMgcG9zc2libGUgdGhhdCB0aGVyZSBpcyBubyBpbnZlcnNlCiAgICAgICAgLy8gIGZvciBleGFtcGxlIGN1cnZlKDApID0gMCBhbmQgY3VydmUoMSkgPSA2LCBzbwogICAgICAgIC8vICB0aGVyZSBpcyBubyB2YWx1ZSB5IHN1Y2ggdGhhdCBjdXJ2ZSh5KSA9IDUuCiAgICAgICAgLy8gIFdoZW4gdGhlcmUgaXMgbm8gaW52ZXJzZSwgd2UgbXVzdCByZXR1cm4gdXBwZXIgZWxlbWVudCBvZiBsYXN0IHNlYXJjaCByYW5nZS4KICAgICAgICAvLyAgVGhpcyBoYXMgdGhlIGVmZmVjdCBvZiByZXZlcnNpbmcgdGhlIGN1cnZlIGxlc3Mgd2hlbgogICAgICAgIC8vICBidXJuaW5nIE5ldW1hcmtzLiBUaGlzIGVuc3VyZXMgdGhhdCBOZXVtYXJrcyBjYW4gYWx3YXlzCiAgICAgICAgLy8gIGJlIGJ1cm5lZC4gSXQgYWxzbyBlbnN1cmUgdGhhdCB0aGUgdG90YWwgc3VwcGx5IG9mIE5ldW1hcmtzCiAgICAgICAgLy8gIHJlbWFpbnMgYmVsb3cgdGhlIGNhcC4KICAgICAgICByZXR1cm4gbWF4OwogICAgfQoKICAgIGZ1bmN0aW9uIG5ldW1hcmtDYXAoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gTkVVTUFSS19DQVA7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdGlhbFJld2FyZEZyYWN0aW9uKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIElOSVRJQUxfUkVXQVJEX0ZSQUNUSU9OOwogICAgfQp9Cgpjb250cmFjdCBJQmFzaWNUb2tlbiB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFdmVudHMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGV2ZW50IFRyYW5zZmVyKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBmcm9tLAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCB0bywKICAgICAgICB1aW50MjU2IGFtb3VudCk7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1Nik7CgogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBvd25lcmAgYXQgdGhlIGN1cnJlbnQgYmxvY2sKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKCiAgICAvLy8gQG5vdGljZSBTZW5kIGBhbW91bnRgIHRva2VucyB0byBgdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIHRvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cgp9CgovLy8gQHRpdGxlIGFsbG93cyBkZXJpdmluZyBjb250cmFjdCB0byByZWNvdmVyIGFueSB0b2tlbiBvciBldGhlciB0aGF0IGl0IGhhcyBiYWxhbmNlIG9mCi8vLyBAbm90aWNlIG5vdGUgdGhhdCB0aGlzIG9wZW5zIHlvdXIgY29udHJhY3RzIHRvIGNsYWltcyBmcm9tIHZhcmlvdXMgcGVvcGxlIHNheWluZyB0aGV5IGxvc3QgdG9rZW5zIGFuZCB0aGV5IHdhbnQgdGhlbSBiYWNrCi8vLyAgICAgYmUgcmVhZHkgdG8gaGFuZGxlIHN1Y2ggY2xhaW1zCi8vLyBAZGV2IHVzZSB3aXRoIGNhcmUhCi8vLyAgICAgMS4gUk9MRV9SRUNMQUlNRVIgaXMgYWxsb3dlZCB0byBjbGFpbSB0b2tlbnMsIGl0J3Mgbm90IHJldHVybmluZyB0b2tlbnMgdG8gb3JpZ2luYWwgb3duZXIKLy8vICAgICAyLiBpbiBkZXJpdmVkIGNvbnRyYWN0IHRoYXQgaG9sZHMgYW55IHRva2VuIGJ5IGRlc2lnbiB5b3UgbXVzdCBvdmVycmlkZSBgcmVjbGFpbWAgYW5kIGJsb2NrIHN1Y2ggcG9zc2liaWxpdHkuCi8vLyAgICAgICAgIHNlZSBMb2NrZWRBY2NvdW50IGFzIGFuIGV4YW1wbGUKY29udHJhY3QgUmVjbGFpbWFibGUgaXMgQWNjZXNzQ29udHJvbGxlZCwgQWNjZXNzUm9sZXMgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RhbnRzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBJQmFzaWNUb2tlbiBjb25zdGFudCBpbnRlcm5hbCBSRUNMQUlNX0VUSEVSID0gSUJhc2ljVG9rZW4oMHgwKTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIHJlY2xhaW0oSUJhc2ljVG9rZW4gdG9rZW4pCiAgICAgICAgcHVibGljCiAgICAgICAgb25seShST0xFX1JFQ0xBSU1FUikKICAgIHsKICAgICAgICBhZGRyZXNzIHJlY2xhaW1lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgaWYodG9rZW4gPT0gUkVDTEFJTV9FVEhFUikgewogICAgICAgICAgICByZWNsYWltZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgICAgIHJlcXVpcmUodG9rZW4udHJhbnNmZXIocmVjbGFpbWVyLCBiYWxhbmNlKSk7CiAgICAgICAgfQogICAgfQp9CgovLy8gQHRpdGxlIGFkdmFuY2VzIHNuYXBzaG90IGlkIG9uIGRlbWFuZAovLy8gQGRldiBzZWUgU25hcHNob3QgZm9sZGVyIGZvciBpbXBsZW1lbnRhdGlvbiBleGFtcGxlcyBpZS4gRGFpbHlBbmRTbmFwc2hvdGFibGUgY29udHJhY3QKY29udHJhY3QgSVNuYXBzaG90YWJsZSB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFdmVudHMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IHNob3VsZCBsb2cgZWFjaCBuZXcgc25hcHNob3QgaWQgY3JlYXRlZCwgaW5jbHVkaW5nIHNuYXBzaG90cyBjcmVhdGVkIGF1dG9tYXRpY2FsbHkgdmlhIE1TbmFwc2hvdFBvbGljeQogICAgZXZlbnQgTG9nU25hcHNob3RDcmVhdGVkKHVpbnQyNTYgc25hcHNob3RJZCk7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gYWx3YXlzIGNyZWF0ZXMgbmV3IHNuYXBzaG90IGlkIHdoaWNoIGdldHMgcmV0dXJuZWQKICAgIC8vLyBob3dldmVyLCB0aGVyZSBpcyBubyBndWFyYW50ZWUgdGhhdCBhbnkgc25hcHNob3Qgd2lsbCBiZSBjcmVhdGVkIHdpdGggdGhpcyBpZCwgdGhpcyBkZXBlbmRzIG9uIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBNU25hcGhvdFBvbGljeQogICAgZnVuY3Rpb24gY3JlYXRlU25hcHNob3QoKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpOwoKICAgIC8vLyB1cHBlciBib3VuZCBvZiBzZXJpZXMgc25hcHNob3RJZHMgZm9yIHdoaWNoIHRoZXJlJ3MgYSB2YWx1ZQogICAgZnVuY3Rpb24gY3VycmVudFNuYXBzaG90SWQoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1Nik7Cn0KCi8vLyBAdGl0bGUgQWJzdHJhY3RzIHNuYXBzaG90IGlkIGNyZWF0aW9uIGxvZ2ljcwovLy8gQGRldiBNaXhpbiAoaW50ZXJuYWwgaW50ZXJmYWNlKSBvZiB0aGUgc25hcHNob3QgcG9saWN5IHdoaWNoIGFic3RyYWN0cyBzbmFwc2hvdCBpZCBjcmVhdGlvbiBsb2dpY3MgZnJvbSBTbmFwc2hvdCBjb250cmFjdAovLy8gQGRldiB0byBiZSBpbXBsZW1lbnRlZCBhbmQgc3VjaCBpbXBsZW1lbnRhdGlvbiBzaG91bGQgYmUgbWl4ZWQgd2l0aCBTbmFwc2hvdC1kZXJpdmVkIGNvbnRyYWN0LCBzZWUgRXZlcnlCbG9jayBmb3Igc2ltcGxlc3QgZXhhbXBsZSBvZiBpbXBsZW1lbnRhdGlvbiBhbmQgU3RhbmRhcmRTbmFwc2hvdFRva2VuCmNvbnRyYWN0IE1TbmFwc2hvdFBvbGljeSB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbnRlcm5hbCBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vIFRoZSBzbmFwc2hvdCBJZHMgbmVlZCB0byBiZSBzdHJpY3RseSBpbmNyZWFzaW5nLgogICAgLy8gV2hlbmV2ZXIgdGhlIHNuYXNwc2hvdCBpZCBjaGFuZ2VzLCBhIG5ldyBzbmFwc2hvdCB3aWxsIGJlIGNyZWF0ZWQuCiAgICAvLyBBcyBsb25nIGFzIHRoZSBzYW1lIHNuYXBzaG90IGlkIGlzIGJlaW5nIHJldHVybmVkLCBsYXN0IHNuYXBzaG90IHdpbGwgYmUgdXBkYXRlZCBhcyB0aGlzIGluZGljYXRlcyB0aGF0IHNuYXBzaG90IGlkIGRpZG4ndCBjaGFuZ2UKICAgIC8vCiAgICAvLyBWYWx1ZXMgcGFzc2VkIHRvIGBoYXNWYWx1ZUF0YCBhbmQgYHZhbHV0ZUF0YCBhcmUgcmVxdWlyZWQKICAgIC8vIHRvIGJlIGxlc3Mgb3IgZXF1YWwgdG8gYG1DdXJyZW50U25hcHNob3RJZCgpYC4KICAgIGZ1bmN0aW9uIG1DdXJyZW50U25hcHNob3RJZCgpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50MjU2KTsKfQoKLy8vIEB0aXRsZSBjcmVhdGVzIHNuYXBzaG90IGlkIG9uIGVhY2ggZGF5IGJvdW5kYXJ5IGFuZCBhbGxvd3MgdG8gY3JlYXRlIGFkZGl0aW9uYWwgc25hcHNob3RzIHdpdGhpbiBhIGdpdmVuIGRheQovLy8gQGRldiBzbmFwc2hvdHMgYXJlIGVuY29kZWQgaW4gc2luZ2xlIHVpbnQyNTYsIHdoZXJlIGhpZ2ggMTI4IGJpdHMgcmVwcmVzZW50cyBhIGRheSBudW1iZXIgKGZyb20gdW5peCBlcG9jaCkgYW5kIGxvdyAxMjggYml0cyByZXByZXNlbnRzIGFkZGl0aW9uYWwgc25hcHNob3RzIHdpdGhpbiBnaXZlbiBkYXkgY3JlYXRlIHZpYSBJU25hcHNob3RhYmxlCmNvbnRyYWN0IERhaWx5QW5kU25hcHNob3RhYmxlIGlzCiAgICBNU25hcHNob3RQb2xpY3ksCiAgICBJU25hcHNob3RhYmxlCnsKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RhbnRzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLyBGbG9vclsyKioxMjggLyAxIGRheXNdCiAgICB1aW50MjU2IHByaXZhdGUgTUFYX1RJTUVTVEFNUCA9IDM5Mzg0NTMzMjA4NDQxOTUxNzg5NzQyNDMxNDE1NzEzOTE7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBNdXRhYmxlIHN0YXRlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICB1aW50MjU2IHByaXZhdGUgX2N1cnJlbnRTbmFwc2hvdElkOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RydWN0b3IKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAcGFyYW0gc3RhcnQgc25hcHNob3RJZCBmcm9tIHdoaWNoIHRvIHN0YXJ0IGdlbmVyYXRpbmcgdmFsdWVzCiAgICAvLy8gQGRldiBzdGFydCBtdXN0IGJlIGZvciB0aGUgc2FtZSBkYXkgb3IgMCwgcmVxdWlyZWQgZm9yIHRva2VuIGNsb25pbmcKICAgIGZ1bmN0aW9uIERhaWx5QW5kU25hcHNob3RhYmxlKHVpbnQyNTYgc3RhcnQpIGludGVybmFsIHsKICAgICAgICAvLyAwIGlzIGludmFsaWQgdmFsdWUgYXMgd2UgYXJlIHBhc3QgdW5peCBlcG9jaAogICAgICAgIGlmIChzdGFydCA+IDApIHsKICAgICAgICAgICAgdWludDI1NiBkYXlCYXNlID0gc25hcHNob3RBdChibG9jay50aW1lc3RhbXApOwogICAgICAgICAgICByZXF1aXJlKHN0YXJ0ID49IGRheUJhc2UpOwogICAgICAgICAgICAvLyBkYXlCYXNlICsgMioqMTI4IHdpbGwgbm90IG92ZXJmbG93IGFzIGl0IGlzIGJhc2VkIG9uIGJsb2NrLnRpbWVzdGFtcAogICAgICAgICAgICByZXF1aXJlKHN0YXJ0IDwgZGF5QmFzZSArIDIqKjEyOCk7CiAgICAgICAgICAgIF9jdXJyZW50U25hcHNob3RJZCA9IHN0YXJ0OwogICAgICAgIH0KICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIHNuYXBzaG90QXQodWludDI1NiB0aW1lc3RhbXApCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJlcXVpcmUodGltZXN0YW1wIDwgTUFYX1RJTUVTVEFNUCk7CgogICAgICAgIHVpbnQyNTYgZGF5QmFzZSA9IDIqKjEyOCAqICh0aW1lc3RhbXAgLyAxIGRheXMpOwogICAgICAgIHJldHVybiBkYXlCYXNlOwogICAgfQoKICAgIC8vCiAgICAvLyBJbXBsZW1lbnRzIElTbmFwc2hvdGFibGUKICAgIC8vCgogICAgZnVuY3Rpb24gY3JlYXRlU25hcHNob3QoKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgdWludDI1NiBkYXlCYXNlID0gMioqMTI4ICogKGJsb2NrLnRpbWVzdGFtcCAvIDEgZGF5cyk7CgogICAgICAgIGlmIChkYXlCYXNlID4gX2N1cnJlbnRTbmFwc2hvdElkKSB7CiAgICAgICAgICAgIC8vIE5ldyBkYXkgaGFzIHN0YXJ0ZWQsIGNyZWF0ZSBzbmFwc2hvdCBmb3IgbWlkbmlnaHQKICAgICAgICAgICAgX2N1cnJlbnRTbmFwc2hvdElkID0gZGF5QmFzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB3aXRoaW4gc2luZ2xlIGRheSwgaW5jcmVhc2UgY291bnRlciAoYXNzdW1lIDIqKjEyOCB3aWxsIG5vdCBiZSBjcm9zc2VkKQogICAgICAgICAgICBfY3VycmVudFNuYXBzaG90SWQgKz0gMTsKICAgICAgICB9CgogICAgICAgIC8vIExvZyBhbmQgcmV0dXJuCiAgICAgICAgTG9nU25hcHNob3RDcmVhdGVkKF9jdXJyZW50U25hcHNob3RJZCk7CiAgICAgICAgcmV0dXJuIF9jdXJyZW50U25hcHNob3RJZDsKICAgIH0KCiAgICBmdW5jdGlvbiBjdXJyZW50U25hcHNob3RJZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBtQ3VycmVudFNuYXBzaG90SWQoKTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEludGVybmFsIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8KICAgIC8vIEltcGxlbWVudHMgTVNuYXBzaG90UG9saWN5CiAgICAvLwoKICAgIGZ1bmN0aW9uIG1DdXJyZW50U25hcHNob3RJZCgpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHVpbnQyNTYgZGF5QmFzZSA9IDIqKjEyOCAqIChibG9jay50aW1lc3RhbXAgLyAxIGRheXMpOwoKICAgICAgICAvLyBOZXcgZGF5IGhhcyBzdGFydGVkCiAgICAgICAgaWYgKGRheUJhc2UgPiBfY3VycmVudFNuYXBzaG90SWQpIHsKICAgICAgICAgICAgX2N1cnJlbnRTbmFwc2hvdElkID0gZGF5QmFzZTsKICAgICAgICAgICAgTG9nU25hcHNob3RDcmVhdGVkKGRheUJhc2UpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF9jdXJyZW50U25hcHNob3RJZDsKICAgIH0KfQoKY29udHJhY3QgSVRva2VuTWV0YWRhdGEgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUHVibGljIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gc3ltYm9sKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHN0cmluZyk7CgogICAgZnVuY3Rpb24gbmFtZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChzdHJpbmcpOwoKICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQ4KTsKfQoKLy8vIEB0aXRsZSBhZGRzIHRva2VuIG1ldGFkYXRhIHRvIHRva2VuIGNvbnRyYWN0Ci8vLyBAZGV2IHNlZSBOZXVtYXJrIGZvciBleGFtcGxlIGltcGxlbWVudGF0aW9uCmNvbnRyYWN0IFRva2VuTWV0YWRhdGEgaXMgSVRva2VuTWV0YWRhdGEgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW1tdXRhYmxlIHN0YXRlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLyBUaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2VucwogICAgc3RyaW5nIHByaXZhdGUgTkFNRTsKCiAgICAvLyBBbiBpZGVudGlmaWVyOiBlLmcuIFJFUAogICAgc3RyaW5nIHByaXZhdGUgU1lNQk9MOwoKICAgIC8vIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgdWludDggcHJpdmF0ZSBERUNJTUFMUzsKCiAgICAvLyBBbiBhcmJpdHJhcnkgdmVyc2lvbmluZyBzY2hlbWUKICAgIHN0cmluZyBwcml2YXRlIFZFUlNJT047CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gc2V0IG1ldGFkYXRhCiAgICAvLy8gQHBhcmFtIHRva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIHRva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSB2ZXJzaW9uIFRva2VuIHZlcnNpb24gaWUuIHdoZW4gY2xvbmluZyBpcyB1c2VkCiAgICBmdW5jdGlvbiBUb2tlbk1ldGFkYXRhKAogICAgICAgIHN0cmluZyB0b2tlbk5hbWUsCiAgICAgICAgdWludDggZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyB0b2tlblN5bWJvbCwKICAgICAgICBzdHJpbmcgdmVyc2lvbgogICAgKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIE5BTUUgPSB0b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgU1lNQk9MID0gdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbAogICAgICAgIERFQ0lNQUxTID0gZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIFZFUlNJT04gPSB2ZXJzaW9uOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUHVibGljIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gbmFtZSgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChzdHJpbmcpCiAgICB7CiAgICAgICAgcmV0dXJuIE5BTUU7CiAgICB9CgogICAgZnVuY3Rpb24gc3ltYm9sKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHN0cmluZykKICAgIHsKICAgICAgICByZXR1cm4gU1lNQk9MOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQ4KQogICAgewogICAgICAgIHJldHVybiBERUNJTUFMUzsKICAgIH0KCiAgICBmdW5jdGlvbiB2ZXJzaW9uKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHN0cmluZykKICAgIHsKICAgICAgICByZXR1cm4gVkVSU0lPTjsKICAgIH0KfQoKY29udHJhY3QgSXNDb250cmFjdCB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbnRlcm5hbCBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBhZGRyKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQyNTYgc2l6ZTsKICAgICAgICAvLyB0YWtlcyA3MDAgZ2FzCiAgICAgICAgYXNzZW1ibHkgeyBzaXplIDo9IGV4dGNvZGVzaXplKGFkZHIpIH0KICAgICAgICByZXR1cm4gc2l6ZSA+IDA7CiAgICB9Cn0KCmNvbnRyYWN0IElFUkMyMEFsbG93YW5jZSB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBFdmVudHMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBvd25lciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwKICAgICAgICB1aW50MjU2IGFtb3VudCk7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gcmVhZCB0aGUgYGFsbG93ZWRbXWAgbWFwCiAgICAvLy8gQHBhcmFtIG93bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIG93bmVyIHRoYXQgc3BlbmRlciBpcyBhbGxvd2VkCiAgICAvLy8gIHRvIHNwZW5kCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgc3BlbmRlcmAgdG8gc3BlbmQgYGFtb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYuIFRoaXMgaXMgYSBtb2RpZmllZCB2ZXJzaW9uIG9mIHRoZSBFUkMyMCBhcHByb3ZlIGZ1bmN0aW9uCiAgICAvLy8gIHRvIGJlIGEgbGl0dGxlIGJpdCBzYWZlcgogICAgLy8vIEBwYXJhbSBzcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2UgU2VuZCBgYW1vdW50YCB0b2tlbnMgdG8gYHRvYCBmcm9tIGBmcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0CiAgICAvLy8gIGlzIGFwcHJvdmVkIGJ5IGBmcm9tYAogICAgLy8vIEBwYXJhbSBmcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSB0byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cgp9Cgpjb250cmFjdCBJRVJDMjBUb2tlbiBpcyBJQmFzaWNUb2tlbiwgSUVSQzIwQWxsb3dhbmNlIHsKCn0KCmNvbnRyYWN0IElFUkMyMjNDYWxsYmFjayB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiBvblRva2VuVHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBmcm9tLAogICAgICAgIHVpbnQyNTYgYW1vdW50LAogICAgICAgIGJ5dGVzIGRhdGEKICAgICkKICAgICAgICBwdWJsaWM7Cgp9Cgpjb250cmFjdCBJRVJDMjIzVG9rZW4gaXMgSUJhc2ljVG9rZW4gewoKICAgIC8vLyBAZGV2IERlcGFydHVyZTogV2UgZG8gbm90IGxvZyBkYXRhLCBpdCBoYXMgbm8gYWR2YW50YWdlIG92ZXIgYSBzdGFuZGFyZAogICAgLy8vICAgICBsb2cgZXZlbnQuIEJ5IHN0aWNraW5nIHRvIHRoZSBzdGFuZGFyZCBsb2cgZXZlbnQgd2UKICAgIC8vLyAgICAgc3RheSBjb21wYXRpYmxlIHdpdGggY29uc3RyYWN0cyB0aGF0IGV4cGVjdCBhbmQgRVJDMjAgdG9rZW4uCgogICAgLy8gZXZlbnQgVHJhbnNmZXIoCiAgICAvLyAgICBhZGRyZXNzIGluZGV4ZWQgZnJvbSwKICAgIC8vICAgIGFkZHJlc3MgaW5kZXhlZCB0bywKICAgIC8vICAgIHVpbnQyNTYgYW1vdW50LAogICAgLy8gICAgYnl0ZXMgZGF0YSk7CgoKICAgIC8vLyBAZGV2IERlcGFydHVyZTogV2UgZG8gbm90IHVzZSB0aGUgY2FsbGJhY2sgb24gcmVndWxhciB0cmFuc2ZlciBjYWxscyB0bwogICAgLy8vICAgICBzdGF5IGNvbXBhdGlibGUgd2l0aCBjb25zdHJhY3RzIHRoYXQgZXhwZWN0IGFuZCBFUkMyMCB0b2tlbi4KCiAgICAvLyBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCkKICAgIC8vICAgICBwdWJsaWMKICAgIC8vICAgICByZXR1cm5zIChib29sKTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgYW1vdW50LCBieXRlcyBkYXRhKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpOwp9CgovLy8gQHRpdGxlIGNvbnRyb2xzIHNwZW5kaW5nIGFwcHJvdmFscwovLy8gQGRldiBUb2tlbkFsbG93YW5jZSBvYnNlcnZlcyB0aGlzIGludGVyZmFjZSwgTmV1bWFyayBjb250cmFjdCBpbXBsZW1lbnRzIGl0CmNvbnRyYWN0IE1Ub2tlbkFsbG93YW5jZUNvbnRyb2xsZXIgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW50ZXJuYWwgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIG93bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gbU9uQXBwcm92ZSgKICAgICAgICBhZGRyZXNzIG93bmVyLAogICAgICAgIGFkZHJlc3Mgc3BlbmRlciwKICAgICAgICB1aW50MjU2IGFtb3VudAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAoYm9vbCBhbGxvdyk7Cgp9CgovLy8gQHRpdGxlIGNvbnRyb2xzIHRva2VuIHRyYW5zZmVycwovLy8gQGRldiBCYXNpY1NuYXBzaG90VG9rZW4gb2JzZXJ2ZXMgdGhpcyBpbnRlcmZhY2UsIE5ldW1hcmsgY29udHJhY3QgaW1wbGVtZW50cyBpdApjb250cmFjdCBNVG9rZW5UcmFuc2ZlckNvbnRyb2xsZXIgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW50ZXJuYWwgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSB0byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gbU9uVHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBmcm9tLAogICAgICAgIGFkZHJlc3MgdG8sCiAgICAgICAgdWludDI1NiBhbW91bnQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKGJvb2wgYWxsb3cpOwoKfQoKLy8vIEB0aXRsZSBjb250cm9scyBhcHByb3ZhbHMgYW5kIHRyYW5zZmVycwovLy8gQGRldiBUaGUgdG9rZW4gY29udHJvbGxlciBjb250cmFjdCBtdXN0IGltcGxlbWVudCB0aGVzZSBmdW5jdGlvbnMsIHNlZSBOZXVtYXJrIGFzIGV4YW1wbGUKLy8vIEBkZXYgcGxlYXNlIG5vdGUgdGhhdCBjb250cm9sbGVyIG1heSBiZSBhIHNlcGFyYXRlIGNvbnRyYWN0IHRoYXQgaXMgY2FsbGVkIGZyb20gbU9uVHJhbnNmZXIgYW5kIG1PbkFwcHJvdmUgZnVuY3Rpb25zCmNvbnRyYWN0IE1Ub2tlbkNvbnRyb2xsZXIgaXMgTVRva2VuVHJhbnNmZXJDb250cm9sbGVyLCBNVG9rZW5BbGxvd2FuY2VDb250cm9sbGVyIHsKfQoKLy8vIEB0aXRsZSBpbnRlcm5hbCB0b2tlbiB0cmFuc2ZlciBmdW5jdGlvbgovLy8gQGRldiBzZWUgQmFzaWNTbmFwc2hvdFRva2VuIGZvciBpbXBsZW1lbnRhdGlvbgpjb250cmFjdCBNVG9rZW5UcmFuc2ZlciB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbnRlcm5hbCBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFRoaXMgaXMgdGhlIGFjdHVhbCB0cmFuc2ZlciBmdW5jdGlvbiBpbiB0aGUgdG9rZW4gY29udHJhY3QsIGl0IGNhbgogICAgLy8vICBvbmx5IGJlIGNhbGxlZCBieSBvdGhlciBmdW5jdGlvbnMgaW4gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAZGV2ICByZXZlcnRzIGlmIHRyYW5zZmVyIHdhcyBub3Qgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gbVRyYW5zZmVyKAogICAgICAgIGFkZHJlc3MgZnJvbSwKICAgICAgICBhZGRyZXNzIHRvLAogICAgICAgIHVpbnQyNTYgYW1vdW50CiAgICApCiAgICAgICAgaW50ZXJuYWw7Cn0KCmNvbnRyYWN0IElFUkM2NzdDYWxsYmFjayB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLyBOT1RFOiBUaGlzIGNhbGwgY2FuIGJlIGluaXRpYXRlZCBieSBhbnlvbmUuIFlvdSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0CiAgICAvLyBpdCBpcyBzZW5kIGJ5IHRoZSB0b2tlbiAoYHJlcXVpcmUobXNnLnNlbmRlciA9PSB0b2tlbilgKSBvciBtYWtlIHN1cmUKICAgIC8vIGFtb3VudCBpcyB2YWxpZCAoYHJlcXVpcmUodG9rZW4uYWxsb3dhbmNlKHRoaXMpID49IGFtb3VudClgKS4KICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbCgKICAgICAgICBhZGRyZXNzIGZyb20sCiAgICAgICAgdWludDI1NiBhbW91bnQsCiAgICAgICAgYWRkcmVzcyB0b2tlbiwgLy8gSUVSQzY2N1Rva2VuCiAgICAgICAgYnl0ZXMgZGF0YQogICAgKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cgp9Cgpjb250cmFjdCBJRVJDNjc3QWxsb3dhbmNlIGlzIElFUkMyMEFsbG93YW5jZSB7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYHNwZW5kZXJgIHRvIHNlbmQgYGFtb3VudGAgdG9rZW5zIG9uCiAgICAvLy8gIGl0cyBiZWhhbGYsIGFuZCB0aGVuIGEgZnVuY3Rpb24gaXMgdHJpZ2dlcmVkIGluIHRoZSBjb250cmFjdCB0aGF0IGlzCiAgICAvLy8gIGJlaW5nIGFwcHJvdmVkLCBgc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGZ1bmN0aW9uIGNhbGwgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQsIGJ5dGVzIGV4dHJhRGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKfQoKY29udHJhY3QgSUVSQzY3N1Rva2VuIGlzIElFUkMyMFRva2VuLCBJRVJDNjc3QWxsb3dhbmNlIHsKfQoKLy8vIEB0aXRsZSB0b2tlbiBzcGVuZGluZyBhcHByb3ZhbCBhbmQgdHJhbnNmZXIKLy8vIEBkZXYgaW1wbGVtZW50cyB0b2tlbiBhcHByb3ZhbCBhbmQgdHJhbnNmZXJzIGFuZCBleHBvc2VzIHJlbGV2YW50IHBhcnQgb2YgRVJDMjAgYW5kIEVSQzY3NyBhcHByb3ZlQW5kQ2FsbAovLy8gICAgIG1heSBiZSBtaXhlZCBpbiB3aXRoIGFueSBiYXNpYyB0b2tlbiAoaW1wbGVtZW50aW5nIG1UcmFuc2ZlcikgbGlrZSBCYXNpY1NuYXBzaG90VG9rZW4gb3IgTWludGFibGVTbmFwc2hvdFRva2VuIHRvIGFkZCBhcHByb3ZhbCBtZWNoYW5pc20KLy8vICAgICBvYnNlcnZlcyBNVG9rZW5BbGxvd2FuY2VDb250cm9sbGVyIGludGVyZmFjZQovLy8gICAgIG9ic2VydmVzIE1Ub2tlblRyYW5zZmVyCmNvbnRyYWN0IFRva2VuQWxsb3dhbmNlIGlzCiAgICBNVG9rZW5UcmFuc2ZlciwKICAgIE1Ub2tlbkFsbG93YW5jZUNvbnRyb2xsZXIsCiAgICBJRVJDMjBBbGxvd2FuY2UsCiAgICBJRVJDNjc3VG9rZW4KewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTXV0YWJsZSBzdGF0ZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyByaWdodHMgdG8gc3BlbmRzIG90aGVycyB0b2tlbnMgYXMgcGVyIEVSQzIwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIHByaXZhdGUgX2FsbG93ZWQ7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gVG9rZW5BbGxvd2FuY2UoKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLwogICAgLy8gSW1wbGVtZW50cyBJRVJDMjBUb2tlbgogICAgLy8KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gcmVhZCB0aGUgYGFsbG93ZWRbXWAgbWFwCiAgICAvLy8gQHBhcmFtIG93bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IHRoYXQgb3ducyB0aGUgdG9rZW4KICAgIC8vLyBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykKICAgIHsKICAgICAgICByZXR1cm4gX2FsbG93ZWRbb3duZXJdW3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZi4gVGhpcyBpcyBhIG1vZGlmaWVkIHZlcnNpb24gb2YgdGhlIEVSQzIwIGFwcHJvdmUgZnVuY3Rpb24KICAgIC8vLyAgd2hlcmUgYWxsb3dhbmNlIHBlciBzcGVuZGVyIG11c3QgYmUgMCB0byBhbGxvdyBjaGFuZ2Ugb2Ygc3VjaCBhbGxvd2FuY2UKICAgIC8vLyBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gVHJ1ZSBvciByZXZlcnRzLCBGYWxzZSBpcyBuZXZlciByZXR1cm5lZAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIGFwcHJvdmUgZnVuY3Rpb24gY2FsbAogICAgICAgIHJlcXVpcmUobU9uQXBwcm92ZShtc2cuc2VuZGVyLCBzcGVuZGVyLCBhbW91bnQpKTsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAvLyAgYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICAgICAgcmVxdWlyZSgoYW1vdW50ID09IDApIHx8IChfYWxsb3dlZFttc2cuc2VuZGVyXVtzcGVuZGVyXSA9PSAwKSk7CgogICAgICAgIF9hbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gYW1vdW50OwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIHNwZW5kZXIsIGFtb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYF9mcm9tYCBvbiB0aGUgY29uZGl0aW9uIGl0CiAgICAvLy8gIGlzIGFwcHJvdmVkIGJ5IGBfZnJvbWAKICAgIC8vLyBAcGFyYW0gZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsLCByZXZlcnRzIGluIGFueSBvdGhlciBjYXNlCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgLy8gVGhlIHN0YW5kYXJkIEVSQyAyMCB0cmFuc2ZlckZyb20gZnVuY3Rpb25hbGl0eQogICAgICAgIGJvb2wgYW1vdW50QXBwcm92ZWQgPSBfYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSA+PSBhbW91bnQ7CiAgICAgICAgcmVxdWlyZShhbW91bnRBcHByb3ZlZCk7CgogICAgICAgIF9hbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdIC09IGFtb3VudDsKICAgICAgICBtVHJhbnNmZXIoZnJvbSwgdG8sIGFtb3VudCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vCiAgICAvLyBJbXBsZW1lbnRzIElFUkM2NzdUb2tlbgogICAgLy8KCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzZW5kIGBfYW1vdW50YCB0b2tlbnMgb24KICAgIC8vLyAgaXRzIGJlaGFsZiwgYW5kIHRoZW4gYSBmdW5jdGlvbiBpcyB0cmlnZ2VyZWQgaW4gdGhlIGNvbnRyYWN0IHRoYXQgaXMKICAgIC8vLyAgYmVpbmcgYXBwcm92ZWQsIGBfc3BlbmRlcmAuIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHVzZSB0aGVpciB0b2tlbnMgdG8KICAgIC8vLyAgaW50ZXJhY3Qgd2l0aCBjb250cmFjdHMgaW4gb25lIGZ1bmN0aW9uIGNhbGwgaW5zdGVhZCBvZiB0d28KICAgIC8vLyBAcGFyYW0gc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFRydWUgb3IgcmV2ZXJ0cywgRmFsc2UgaXMgbmV2ZXIgcmV0dXJuZWQKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKAogICAgICAgIGFkZHJlc3Mgc3BlbmRlciwKICAgICAgICB1aW50MjU2IGFtb3VudCwKICAgICAgICBieXRlcyBleHRyYURhdGEKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlKHNwZW5kZXIsIGFtb3VudCkpOwoKICAgICAgICBzdWNjZXNzID0gSUVSQzY3N0NhbGxiYWNrKHNwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgYW1vdW50LAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBleHRyYURhdGEKICAgICAgICApOwogICAgICAgIHJlcXVpcmUoc3VjY2Vzcyk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgovLy8gQHRpdGxlIFJlYWRzIGFuZCB3cml0ZXMgc25hcHNob3RzCi8vLyBAZGV2IE1hbmFnZXMgcmVhZGluZyBhbmQgd3JpdGluZyBhIHNlcmllcyBvZiB2YWx1ZXMsIHdoZXJlIGVhY2ggdmFsdWUgaGFzIGFzc2lnbmVkIGEgc25hcHNob3QgaWQgZm9yIGFjY2VzcyB0byBoaXN0b3JpY2FsIGRhdGEKLy8vIEBkZXYgbWF5IGJlIGFkZGVkIHRvIGFueSBjb250cmFjdCB0byBwcm92aWRlIHNuYXBzaG90dGluZyBtZWNoYW5pc20uIHNob3VsZCBiZSBtaXhlZCBpbiB3aXRoIGFueSBvZiBNU25hcHNob3RQb2xpY3kgaW1wbGVtZW50YXRpb25zIHRvIGN1c3RvbWl6ZSBzbmFwc2hvdCBjcmVhdGlvbiBtZWNoYW5pY3MKLy8vICAgICBvYnNlcnZlcyBNU25hcHNob3RQb2xpY3kKLy8vIGJhc2VkIG9uIE1pbmlNZSB0b2tlbgpjb250cmFjdCBTbmFwc2hvdCBpcyBNU25hcHNob3RQb2xpY3kgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gVHlwZXMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBWYWx1ZXNgIGlzIHRoZSBzdHJ1Y3R1cmUgdGhhdCBhdHRhY2hlcyBhIHNuYXBzaG90IGlkIHRvIGEKICAgIC8vLyAgZ2l2ZW4gdmFsdWUsIHRoZSBzbmFwc2hvdCBpZCBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0IFZhbHVlcyB7CgogICAgICAgIC8vIGBzbmFwc2hvdElkYCBpcyB0aGUgc25hcHNob3QgaWQgdGhhdCB0aGUgdmFsdWUgd2FzIGdlbmVyYXRlZCBhdAogICAgICAgIHVpbnQyNTYgc25hcHNob3RJZDsKCiAgICAgICAgLy8gYHZhbHVlYCBhdCBhIHNwZWNpZmljIHNuYXBzaG90IGlkCiAgICAgICAgdWludDI1NiB2YWx1ZTsKICAgIH0KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEludGVybmFsIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gaGFzVmFsdWUoCiAgICAgICAgVmFsdWVzW10gc3RvcmFnZSB2YWx1ZXMKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gdmFsdWVzLmxlbmd0aCA+IDA7CiAgICB9CgogICAgLy8vIEBkZXYgbWFrZXMgc3VyZSB0aGF0ICdzbmFwc2hvdElkJyBiZXR3ZWVuIGN1cnJlbnQgc25hcHNob3QgaWQgKG1DdXJyZW50U25hcHNob3RJZCkgYW5kIGZpcnN0IHNuYXBzaG90IGlkLiB0aGlzIGd1YXJhbnRlZXMgdGhhdCBnZXRWYWx1ZUF0IHJldHVybnMgdmFsdWUgZnJvbSBvbmUgb2YgdGhlIHNuYXBzaG90cy4KICAgIGZ1bmN0aW9uIGhhc1ZhbHVlQXQoCiAgICAgICAgVmFsdWVzW10gc3RvcmFnZSB2YWx1ZXMsCiAgICAgICAgdWludDI1NiBzbmFwc2hvdElkCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShzbmFwc2hvdElkIDw9IG1DdXJyZW50U25hcHNob3RJZCgpKTsKICAgICAgICByZXR1cm4gdmFsdWVzLmxlbmd0aCA+IDAgJiYgdmFsdWVzWzBdLnNuYXBzaG90SWQgPD0gc25hcHNob3RJZDsKICAgIH0KCiAgICAvLy8gZ2V0cyBsYXN0IHZhbHVlIGluIHRoZSBzZXJpZXMKICAgIGZ1bmN0aW9uIGdldFZhbHVlKAogICAgICAgIFZhbHVlc1tdIHN0b3JhZ2UgdmFsdWVzLAogICAgICAgIHVpbnQyNTYgZGVmYXVsdFZhbHVlCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgaWYgKHZhbHVlcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTYgbGFzdCA9IHZhbHVlcy5sZW5ndGggLSAxOwogICAgICAgICAgICByZXR1cm4gdmFsdWVzW2xhc3RdLnZhbHVlOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBgZ2V0VmFsdWVBdGAgcmV0cmlldmVzIHZhbHVlIGF0IGEgZ2l2ZW4gc25hcHNob3QgaWQKICAgIC8vLyBAcGFyYW0gdmFsdWVzIFRoZSBzZXJpZXMgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gc25hcHNob3RJZCBTbmFwc2hvdCBpZCB0byByZXRyaWV2ZSB0aGUgdmFsdWUgYXQKICAgIC8vLyBAcmV0dXJuIFZhbHVlIGluIHNlcmllcyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KAogICAgICAgIFZhbHVlc1tdIHN0b3JhZ2UgdmFsdWVzLAogICAgICAgIHVpbnQyNTYgc25hcHNob3RJZCwKICAgICAgICB1aW50MjU2IGRlZmF1bHRWYWx1ZQogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJlcXVpcmUoc25hcHNob3RJZCA8PSBtQ3VycmVudFNuYXBzaG90SWQoKSk7CgogICAgICAgIC8vIEVtcHR5IHZhbHVlCiAgICAgICAgaWYgKHZhbHVlcy5sZW5ndGggPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogICAgICAgIH0KCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBvdXQgb2YgYm91bmRzIHNuYXBzaG90cwogICAgICAgIHVpbnQyNTYgbGFzdCA9IHZhbHVlcy5sZW5ndGggLSAxOwogICAgICAgIHVpbnQyNTYgbGFzdFNuYXBzaG90ID0gdmFsdWVzW2xhc3RdLnNuYXBzaG90SWQ7CiAgICAgICAgaWYgKHNuYXBzaG90SWQgPj0gbGFzdFNuYXBzaG90KSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZXNbbGFzdF0udmFsdWU7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgZmlyc3RTbmFwc2hvdCA9IHZhbHVlc1swXS5zbmFwc2hvdElkOwogICAgICAgIGlmIChzbmFwc2hvdElkIDwgZmlyc3RTbmFwc2hvdCkgewogICAgICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogICAgICAgIH0KICAgICAgICAvLyBCaW5hcnkgc2VhcmNoIG9mIHRoZSB2YWx1ZSBpbiB0aGUgYXJyYXkKICAgICAgICB1aW50MjU2IG1pbiA9IDA7CiAgICAgICAgdWludDI1NiBtYXggPSBsYXN0OwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludDI1NiBtaWQgPSAobWF4ICsgbWluICsgMSkgLyAyOwogICAgICAgICAgICAvLyBtdXN0IGFsd2F5cyByZXR1cm4gbG93ZXIgaW5kaWNlIGZvciBhcHByb3hpbWF0ZSBzZWFyY2hlcwogICAgICAgICAgICBpZiAodmFsdWVzW21pZF0uc25hcHNob3RJZCA8PSBzbmFwc2hvdElkKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQgLSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWx1ZXNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgc2V0VmFsdWVgIHVzZWQgdG8gdXBkYXRlIHNlcXVlbmNlIGF0IG5leHQgc25hcHNob3QKICAgIC8vLyBAcGFyYW0gdmFsdWVzIFRoZSBzZXF1ZW5jZSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIHZhbHVlIFRoZSBuZXcgbGFzdCB2YWx1ZSBvZiBzZXF1ZW5jZQogICAgZnVuY3Rpb24gc2V0VmFsdWUoCiAgICAgICAgVmFsdWVzW10gc3RvcmFnZSB2YWx1ZXMsCiAgICAgICAgdWludDI1NiB2YWx1ZQogICAgKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgLy8gVE9ETzogc2ltcGxpZnkgb3IgYnJlYWsgaW50byBzbWFsbGVyIGZ1bmN0aW9ucwoKICAgICAgICB1aW50MjU2IGN1cnJlbnRTbmFwc2hvdElkID0gbUN1cnJlbnRTbmFwc2hvdElkKCk7CiAgICAgICAgLy8gQWx3YXlzIGNyZWF0ZSBhIG5ldyBlbnRyeSBpZiB0aGVyZSBjdXJyZW50bHkgaXMgbm8gdmFsdWUKICAgICAgICBib29sIGVtcHR5ID0gdmFsdWVzLmxlbmd0aCA9PSAwOwogICAgICAgIGlmIChlbXB0eSkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBuZXcgZW50cnkKICAgICAgICAgICAgdmFsdWVzLnB1c2goCiAgICAgICAgICAgICAgICBWYWx1ZXMoewogICAgICAgICAgICAgICAgICAgIHNuYXBzaG90SWQ6IGN1cnJlbnRTbmFwc2hvdElkLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdWludDI1NiBsYXN0ID0gdmFsdWVzLmxlbmd0aCAtIDE7CiAgICAgICAgYm9vbCBoYXNOZXdTbmFwc2hvdCA9IHZhbHVlc1tsYXN0XS5zbmFwc2hvdElkIDwgY3VycmVudFNuYXBzaG90SWQ7CiAgICAgICAgaWYgKGhhc05ld1NuYXBzaG90KSB7CgogICAgICAgICAgICAvLyBEbyBub3RoaW5nIGlmIHRoZSB2YWx1ZSB3YXMgbm90IG1vZGlmaWVkCiAgICAgICAgICAgIGJvb2wgdW5tb2RpZmllZCA9IHZhbHVlc1tsYXN0XS52YWx1ZSA9PSB2YWx1ZTsKICAgICAgICAgICAgaWYgKHVubW9kaWZpZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBlbnRyeQogICAgICAgICAgICB2YWx1ZXMucHVzaCgKICAgICAgICAgICAgICAgIFZhbHVlcyh7CiAgICAgICAgICAgICAgICAgICAgc25hcHNob3RJZDogY3VycmVudFNuYXBzaG90SWQsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAvLyBXZSBhcmUgdXBkYXRpbmcgdGhlIGN1cnJlbnRTbmFwc2hvdElkCiAgICAgICAgICAgIGJvb2wgcHJldmlvdXNVbm1vZGlmaWVkID0gbGFzdCA+IDAgJiYgdmFsdWVzW2xhc3QgLSAxXS52YWx1ZSA9PSB2YWx1ZTsKICAgICAgICAgICAgaWYgKHByZXZpb3VzVW5tb2RpZmllZCkgewogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGN1cnJlbnQgc25hcHNob3QgaWYgY3VycmVudCB2YWx1ZSB3YXMgc2V0IHRvIHByZXZpb3VzIHZhbHVlCiAgICAgICAgICAgICAgICBkZWxldGUgdmFsdWVzW2xhc3RdOwogICAgICAgICAgICAgICAgdmFsdWVzLmxlbmd0aC0tOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBPdmVyd3JpdGUgbmV4dCBzbmFwc2hvdCBlbnRyeQogICAgICAgICAgICB2YWx1ZXNbbGFzdF0udmFsdWUgPSB2YWx1ZTsKICAgICAgICB9CiAgICB9Cn0KCi8vLyBAdGl0bGUgYWNjZXNzIHRvIHNuYXBzaG90cyBvZiBhIHRva2VuCi8vLyBAbm90aWNlIGFsbG93cyB0byBpbXBsZW1lbnQgY29tcGxleCB0b2tlbiBob2xkZXIgcmlnaHRzIGxpa2UgcmV2ZW51ZSBkaXNidXJzYWwgb3Igdm90aW5nCi8vLyBAbm90aWNlIHNuYXBzaG90cyBhcmUgc2VyaWVzIG9mIHZhbHVlcyB3aXRoIGFzc2lnbmVkIGlkcy4gaWRzIGluY3JlYXNlIHN0cmljdGx5LiBwYXJ0aWN1bGFyIGlkIG1lY2hhbmlzbSBpcyBub3QgYXNzdW1lZApjb250cmFjdCBJVG9rZW5TbmFwc2hvdHMgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUHVibGljIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBzbmFwc2hvdElkYC4KICAgIC8vLyBAcGFyYW0gc25hcHNob3RJZCBvZiBzbmFwc2hvdCBhdCB3aGljaCB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgc25hcHNob3RJZGAKICAgIC8vLyBAZGV2IHJldmVydHMgb24gc25hcHNob3RJZHMgZ3JlYXRlciB0aGFuIGN1cnJlbnRTbmFwc2hvdElkKCkKICAgIC8vLyBAZGV2IHJldHVybnMgMCBmb3Igc25hcHNob3RJZHMgbGVzcyB0aGFuIHNuYXBzaG90SWQgb2YgZmlyc3QgdmFsdWUKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXQodWludDI1NiBzbmFwc2hvdElkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyh1aW50MjU2KTsKCiAgICAvLy8gQGRldiBRdWVyaWVzIHRoZSBiYWxhbmNlIG9mIGBvd25lcmAgYXQgYSBzcGVjaWZpYyBgc25hcHNob3RJZGAKICAgIC8vLyBAcGFyYW0gb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEBwYXJhbSBzbmFwc2hvdElkIG9mIHNuYXBzaG90IGF0IHdoaWNoIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBzbmFwc2hvdElkYAogICAgZnVuY3Rpb24gYmFsYW5jZU9mQXQoYWRkcmVzcyBvd25lciwgdWludDI1NiBzbmFwc2hvdElkKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1Nik7CgogICAgLy8vIEBub3RpY2UgdXBwZXIgYm91bmQgb2Ygc2VyaWVzIG9mIHNuYXBzaG90SWRzIGZvciB3aGljaCB0aGVyZSdzIGEgdmFsdWUgaW4gc2VyaWVzCiAgICAvLy8gQHJldHVybiBzbmFwc2hvdElkCiAgICBmdW5jdGlvbiBjdXJyZW50U25hcHNob3RJZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KTsKfQoKLy8vIEB0aXRsZSByZXByZXNlbnRzIGxpbmsgYmV0d2VlbiBjbG9uZWQgYW5kIHBhcmVudCB0b2tlbgovLy8gQGRldiB3aGVuIHRva2VuIGlzIGNsb25lIGZyb20gb3RoZXIgdG9rZW4sIGluaXRpYWwgYmFsYW5jZXMgb2YgdGhlIGNsb25lZCB0b2tlbgovLy8gICAgIGNvcnJlc3BvbmQgdG8gYmFsYW5jZXMgb2YgcGFyZW50IHRva2VuIGF0IHRoZSBtb21lbnQgb2YgcGFyZW50IHNuYXBzaG90IGlkIHNwZWNpZmllZAovLy8gQG5vdGljZSBwbGVhc2Ugbm90ZSB0aGF0IG90aGVyIHRva2VucyBiZXNpZGUgc25hcHNob3QgdG9rZW4gbWF5IGJlIGNsb25lZApjb250cmFjdCBJQ2xvbmVkVG9rZW5QYXJlbnQgaXMgSVRva2VuU25hcHNob3RzIHsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQHJldHVybiBhZGRyZXNzIG9mIHBhcmVudCB0b2tlbiwgYWRkcmVzcygwKSBpZiByb290CiAgICAvLy8gQGRldiBwYXJlbnQgdG9rZW4gZG9lcyBub3QgbmVlZCB0byBjbG9uYWJsZSwgbm9yIHNuYXBzaG90dGFibGUsIGp1c3QgYSBub3JtYWwgdG9rZW4KICAgIGZ1bmN0aW9uIHBhcmVudFRva2VuKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMoSUNsb25lZFRva2VuUGFyZW50IHBhcmVudCk7CgogICAgLy8vIEByZXR1cm4gc25hcHNob3QgYXQgd2NoaWNoIGluaXRpYWwgdG9rZW4gZGlzdHJpYnV0aW9uIHdhcyB0YWtlbgogICAgZnVuY3Rpb24gcGFyZW50U25hcHNob3RJZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQyNTYgc25hcHNob3RJZCk7Cn0KCi8vLyBAdGl0bGUgdG9rZW4gd2l0aCBzbmFwc2hvdHMgYW5kIHRyYW5zZmVyIGZ1bmN0aW9uYWxpdHkKLy8vIEBkZXYgb2JzZXJ2ZXMgTVRva2VuVHJhbnNmZXJDb250cm9sbGVyIGludGVyZmFjZQovLy8gICAgIG9ic2VydmVzIElTbmFwc2hvdFRva2VuIGludGVyZmFjZQovLy8gICAgIGltcGxlbWVudGVzIE1Ub2tlblRyYW5zZmVyIGludGVyZmFjZQpjb250cmFjdCBCYXNpY1NuYXBzaG90VG9rZW4gaXMKICAgIE1Ub2tlblRyYW5zZmVyLAogICAgTVRva2VuVHJhbnNmZXJDb250cm9sbGVyLAogICAgSUJhc2ljVG9rZW4sCiAgICBJQ2xvbmVkVG9rZW5QYXJlbnQsCiAgICBTbmFwc2hvdAp7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEltbXV0YWJsZSBzdGF0ZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gYFBBUkVOVF9UT0tFTmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsKICAgIC8vICBpdCB3aWxsIGJlIDB4MCBmb3IgYSB0b2tlbiB0aGF0IHdhcyBub3QgY2xvbmVkCiAgICBJQ2xvbmVkVG9rZW5QYXJlbnQgcHJpdmF0ZSBQQVJFTlRfVE9LRU47CgogICAgLy8gYFBBUkVOVF9TTkFQU0hPVF9JRGAgaXMgdGhlIHNuYXBzaG90IGlkIGZyb20gdGhlIFBhcmVudCBUb2tlbiB0aGF0IHdhcwogICAgLy8gIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmVkIHRva2VuCiAgICB1aW50MjU2IHByaXZhdGUgUEFSRU5UX1NOQVBTSE9UX0lEOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gTXV0YWJsZSBzdGF0ZQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8gYGJhbGFuY2VzYCBpcyB0aGUgbWFwIHRoYXQgdHJhY2tzIHRoZSBiYWxhbmNlIG9mIGVhY2ggYWRkcmVzcywgaW4gdGhpcwogICAgLy8gIGNvbnRyYWN0IHdoZW4gdGhlIGJhbGFuY2UgY2hhbmdlcyB0aGUgc25hcHNob3QgaWQgdGhhdCB0aGUgY2hhbmdlCiAgICAvLyAgb2NjdXJyZWQgaXMgYWxzbyBpbmNsdWRlZCBpbiB0aGUgbWFwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFZhbHVlc1tdKSBpbnRlcm5hbCBfYmFsYW5jZXM7CgogICAgLy8gVHJhY2tzIHRoZSBoaXN0b3J5IG9mIHRoZSBgdG90YWxTdXBwbHlgIG9mIHRoZSB0b2tlbgogICAgVmFsdWVzW10gaW50ZXJuYWwgX3RvdGFsU3VwcGx5VmFsdWVzOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RydWN0b3IKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBzbmFwc2hvdCB0b2tlbgogICAgLy8vIEBwYXJhbSBwYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQogICAgLy8vICBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gcGFyZW50U25hcHNob3RJZCBhdCB3aGljaCBzbmFwc2hvdCBpZCBjbG9uZSB3YXMgY3JlYXRlZCwgc2V0IHRvIDAgdG8gY2xvbmUgYXQgdXBwZXIgYm91bmQKICAgIC8vLyBAZGV2IHBsZWFzZSBub3QgdGhhdCBhcyBsb25nIGFzIGNsb25lZCB0b2tlbiBkb2VzIG5vdCBvdmVyd3JpdGUgdmFsdWUgYXQgY3VycmVudCBzbmFwc2hvdCBpZCwgaXQgd2lsbCByZWZlcgogICAgLy8vICAgICB0byBwYXJlbnQgdG9rZW4gYXQgd2hpY2ggdGhpcyBzbmFwc2hvdCBzdGlsbCBtYXkgY2hhbmdlIHVudGlsIHNuYXBzaG90IGlkIGluY3JlYXNlcy4gZm9yIHRoYXQgdGltZSB0b2tlbnMgYXJlIGNvdXBsZWQKICAgIC8vLyAgICAgdGhpcyBpcyBwcmV2ZW50ZWQgYnkgcGFyZW50U25hcHNob3RJZCB2YWx1ZSBvZiBwYXJlbnRUb2tlbi5jdXJyZW50U25hcHNob3RJZCgpIC0gMSBiZWluZyB0aGUgbWF4aXVtdW0KICAgIC8vLyAgICAgc2VlIFNuYXBzaG90VG9rZW4uanMgdGVzdCB0byBsZWFybiBjb25zZXF1ZW5jZXMgY291cGxpbmcgaGFzLgogICAgZnVuY3Rpb24gQmFzaWNTbmFwc2hvdFRva2VuKAogICAgICAgIElDbG9uZWRUb2tlblBhcmVudCBwYXJlbnRUb2tlbiwKICAgICAgICB1aW50MjU2IHBhcmVudFNuYXBzaG90SWQKICAgICkKICAgICAgICBTbmFwc2hvdCgpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICBQQVJFTlRfVE9LRU4gPSBwYXJlbnRUb2tlbjsKICAgICAgICBpZiAocGFyZW50VG9rZW4gPT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICByZXF1aXJlKHBhcmVudFNuYXBzaG90SWQgPT0gMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHBhcmVudFNuYXBzaG90SWQgPT0gMCkgewogICAgICAgICAgICAgICAgcmVxdWlyZShwYXJlbnRUb2tlbi5jdXJyZW50U25hcHNob3RJZCgpID4gMCk7CiAgICAgICAgICAgICAgICBQQVJFTlRfU05BUFNIT1RfSUQgPSBwYXJlbnRUb2tlbi5jdXJyZW50U25hcHNob3RJZCgpIC0gMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFBBUkVOVF9TTkFQU0hPVF9JRCA9IHBhcmVudFNuYXBzaG90SWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLwogICAgLy8gSW1wbGVtZW50cyBJQmFzaWNUb2tlbgogICAgLy8KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIG1ha2VzIGl0IGVhc3kgdG8gZ2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdEludGVybmFsKG1DdXJyZW50U25hcHNob3RJZCgpKTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIG93bmVyIFRoZSBhZGRyZXNzIHRoYXQncyBiYWxhbmNlIGlzIGJlaW5nIHJlcXVlc3RlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2Ugb2YgYG93bmVyYCBhdCB0aGUgY3VycmVudCBibG9jawogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgb3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpCiAgICB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0SW50ZXJuYWwob3duZXIsIG1DdXJyZW50U25hcHNob3RJZCgpKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBhbW91bnRgIHRva2VucyB0byBgdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIHRvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgcmV2ZXJ0cyBpbiBhbnkgb3RoZXIgY2FzZQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIG1UcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLwogICAgLy8gSW1wbGVtZW50cyBJVG9rZW5TbmFwc2hvdHMKICAgIC8vCgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50MjU2IHNuYXBzaG90SWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIHRvdGFsU3VwcGx5QXRJbnRlcm5hbChzbmFwc2hvdElkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIG93bmVyLCB1aW50MjU2IHNuYXBzaG90SWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdEludGVybmFsKG93bmVyLCBzbmFwc2hvdElkKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjdXJyZW50U25hcHNob3RJZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBtQ3VycmVudFNuYXBzaG90SWQoKTsKICAgIH0KCiAgICAvLwogICAgLy8gSW1wbGVtZW50cyBJQ2xvbmVkVG9rZW5QYXJlbnQKICAgIC8vCgogICAgZnVuY3Rpb24gcGFyZW50VG9rZW4oKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyhJQ2xvbmVkVG9rZW5QYXJlbnQgcGFyZW50KQogICAgewogICAgICAgIHJldHVybiBQQVJFTlRfVE9LRU47CiAgICB9CgogICAgLy8vIEByZXR1cm4gc25hcHNob3QgYXQgd2NoaWNoIGluaXRpYWwgdG9rZW4gZGlzdHJpYnV0aW9uIHdhcyB0YWtlbgogICAgZnVuY3Rpb24gcGFyZW50U25hcHNob3RJZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQyNTYgc25hcHNob3RJZCkKICAgIHsKICAgICAgICByZXR1cm4gUEFSRU5UX1NOQVBTSE9UX0lEOwogICAgfQoKICAgIC8vCiAgICAvLyBPdGhlciBwdWJsaWMgZnVuY3Rpb25zCiAgICAvLwoKICAgIC8vLyBAbm90aWNlIGdldHMgYWxsIHRva2VuIGJhbGFuY2VzIG9mICdvd25lcicKICAgIC8vLyBAZGV2IGludGVuZGVkIHRvIGJlIGNhbGxlZCB2aWEgZXRoX2NhbGwgd2hlcmUgZ2FzIGxpbWl0IGlzIG5vdCBhbiBpc3N1ZQogICAgZnVuY3Rpb24gYWxsQmFsYW5jZXNPZihhZGRyZXNzIG93bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2WzJdW10pCiAgICB7CiAgICAgICAgLyogdmVyeSBuaWNlIGFuZCB3b3JraW5nIGltcGxlbWVudGF0aW9uIGJlbG93LAogICAgICAgIC8vIGNvcHkgdG8gbWVtb3J5CiAgICAgICAgVmFsdWVzW10gbWVtb3J5IHZhbHVlcyA9IF9iYWxhbmNlc1tvd25lcl07CiAgICAgICAgZG8gYXNzZW1ibHkgewogICAgICAgICAgICAvLyBpbiBtZW1vcnkgc3RydWN0cyBoYXZlIHNpbXBsZSBsYXlvdXQgd2hlcmUgZXZlcnkgaXRlbSBvY2N1cGllcyB1aW50MjU2CiAgICAgICAgICAgIGJhbGFuY2VzIDo9IHZhbHVlcwogICAgICAgIH0gd2hpbGUgKGZhbHNlKTsqLwoKICAgICAgICBWYWx1ZXNbXSBzdG9yYWdlIHZhbHVlcyA9IF9iYWxhbmNlc1tvd25lcl07CiAgICAgICAgdWludDI1NlsyXVtdIG1lbW9yeSBiYWxhbmNlcyA9IG5ldyB1aW50MjU2WzJdW10odmFsdWVzLmxlbmd0aCk7CiAgICAgICAgZm9yKHVpbnQyNTYgaWkgPSAwOyBpaSA8IHZhbHVlcy5sZW5ndGg7ICsraWkpIHsKICAgICAgICAgICAgYmFsYW5jZXNbaWldID0gW3ZhbHVlc1tpaV0uc25hcHNob3RJZCwgdmFsdWVzW2lpXS52YWx1ZV07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYmFsYW5jZXM7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbnRlcm5hbCBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5QXRJbnRlcm5hbCh1aW50MjU2IHNuYXBzaG90SWQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CiAgICAgICAgVmFsdWVzW10gc3RvcmFnZSB2YWx1ZXMgPSBfdG90YWxTdXBwbHlWYWx1ZXM7CgogICAgICAgIC8vIElmIHRoZXJlIGlzIGEgdmFsdWUsIHJldHVybiBpdCwgcmV2ZXJ0cyBpZiB2YWx1ZSBpcyBpbiB0aGUgZnV0dXJlCiAgICAgICAgaWYgKGhhc1ZhbHVlQXQodmFsdWVzLCBzbmFwc2hvdElkKSkgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh2YWx1ZXMsIHNuYXBzaG90SWQsIDApOwogICAgICAgIH0KCiAgICAgICAgLy8gVHJ5IHBhcmVudCBjb250cmFjdCBhdCBvciBiZWZvcmUgdGhlIGZvcmsKICAgICAgICBpZiAoYWRkcmVzcyhQQVJFTlRfVE9LRU4pICE9IDApIHsKICAgICAgICAgICAgdWludDI1NiBlYXJsaWVyU25hcHNob3RJZCA9IFBBUkVOVF9TTkFQU0hPVF9JRCA+IHNuYXBzaG90SWQgPyBzbmFwc2hvdElkIDogUEFSRU5UX1NOQVBTSE9UX0lEOwogICAgICAgICAgICByZXR1cm4gUEFSRU5UX1RPS0VOLnRvdGFsU3VwcGx5QXQoZWFybGllclNuYXBzaG90SWQpOwogICAgICAgIH0KCiAgICAgICAgLy8gRGVmYXVsdCB0byBhbiBlbXB0eSBiYWxhbmNlCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLy8gZ2V0IGJhbGFuY2UgYXQgc25hcHNob3QgaWYgd2l0aCBjb250aW51YXRpb24gaW4gcGFyZW50IHRva2VuCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdEludGVybmFsKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgc25hcHNob3RJZCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBWYWx1ZXNbXSBzdG9yYWdlIHZhbHVlcyA9IF9iYWxhbmNlc1tvd25lcl07CgogICAgICAgIC8vIElmIHRoZXJlIGlzIGEgdmFsdWUsIHJldHVybiBpdCwgcmV2ZXJ0cyBpZiB2YWx1ZSBpcyBpbiB0aGUgZnV0dXJlCiAgICAgICAgaWYgKGhhc1ZhbHVlQXQodmFsdWVzLCBzbmFwc2hvdElkKSkgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdCh2YWx1ZXMsIHNuYXBzaG90SWQsIDApOwogICAgICAgIH0KCiAgICAgICAgLy8gVHJ5IHBhcmVudCBjb250cmFjdCBhdCBvciBiZWZvcmUgdGhlIGZvcmsKICAgICAgICBpZiAoUEFSRU5UX1RPS0VOICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgdWludDI1NiBlYXJsaWVyU25hcHNob3RJZCA9IFBBUkVOVF9TTkFQU0hPVF9JRCA+IHNuYXBzaG90SWQgPyBzbmFwc2hvdElkIDogUEFSRU5UX1NOQVBTSE9UX0lEOwogICAgICAgICAgICByZXR1cm4gUEFSRU5UX1RPS0VOLmJhbGFuY2VPZkF0KG93bmVyLCBlYXJsaWVyU25hcHNob3RJZCk7CiAgICAgICAgfQoKICAgICAgICAvLyBEZWZhdWx0IHRvIGFuIGVtcHR5IGJhbGFuY2UKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLwogICAgLy8gSW1wbGVtZW50cyBNVG9rZW5UcmFuc2ZlcgogICAgLy8KCiAgICAvLy8gQGRldiBUaGlzIGlzIHRoZSBhY3R1YWwgdHJhbnNmZXIgZnVuY3Rpb24gaW4gdGhlIHRva2VuIGNvbnRyYWN0LCBpdCBjYW4KICAgIC8vLyAgb25seSBiZSBjYWxsZWQgYnkgb3RoZXIgZnVuY3Rpb25zIGluIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIGZyb20gVGhlIGFkZHJlc3MgaG9sZGluZyB0aGUgdG9rZW5zIGJlaW5nIHRyYW5zZmVycmVkCiAgICAvLy8gQHBhcmFtIHRvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCwgcmV2ZXJ0cyBpbiBhbnkgb3RoZXIgY2FzZQogICAgZnVuY3Rpb24gbVRyYW5zZmVyKAogICAgICAgIGFkZHJlc3MgZnJvbSwKICAgICAgICBhZGRyZXNzIHRvLAogICAgICAgIHVpbnQyNTYgYW1vdW50CiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICAvLyBuZXZlciBzZW5kIHRvIGFkZHJlc3MgMAogICAgICAgIHJlcXVpcmUodG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gYmxvY2sgdHJhbnNmZXJzIGluIGNsb25lIHRoYXQgcG9pbnRzIHRvIGZ1dHVyZS9jdXJyZW50IHNuYXBzaG90cyBvZiBwYXRlbnQgdG9rZW4KICAgICAgICByZXF1aXJlKHBhcmVudFRva2VuKCkgPT0gYWRkcmVzcygwKSB8fCBwYXJlbnRTbmFwc2hvdElkKCkgPCBwYXJlbnRUb2tlbigpLmN1cnJlbnRTbmFwc2hvdElkKCkpOwogICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXIKICAgICAgICByZXF1aXJlKG1PblRyYW5zZmVyKGZyb20sIHRvLCBhbW91bnQpKTsKCiAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV2ZXJ0cwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKGZyb20pOwogICAgICAgIHJlcXVpcmUocHJldmlvdXNCYWxhbmNlRnJvbSA+PSBhbW91bnQpOwoKICAgICAgICAvLyBGaXJzdCB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgIC8vICBzZW5kaW5nIHRoZSB0b2tlbnMKICAgICAgICB1aW50MjU2IG5ld0JhbGFuY2VGcm9tID0gcHJldmlvdXNCYWxhbmNlRnJvbSAtIGFtb3VudDsKICAgICAgICBzZXRWYWx1ZShfYmFsYW5jZXNbZnJvbV0sIG5ld0JhbGFuY2VGcm9tKTsKCiAgICAgICAgLy8gVGhlbiB1cGRhdGUgdGhlIGJhbGFuY2UgYXJyYXkgd2l0aCB0aGUgbmV3IHZhbHVlIGZvciB0aGUgYWRkcmVzcwogICAgICAgIC8vICByZWNlaXZpbmcgdGhlIHRva2VucwogICAgICAgIHVpbnQyNTYgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2YodG8pOwogICAgICAgIHVpbnQyNTYgbmV3QmFsYW5jZVRvID0gcHJldmlvdXNCYWxhbmNlVG8gKyBhbW91bnQ7CiAgICAgICAgYXNzZXJ0KG5ld0JhbGFuY2VUbyA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHNldFZhbHVlKF9iYWxhbmNlc1t0b10sIG5ld0JhbGFuY2VUbyk7CgogICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgIFRyYW5zZmVyKGZyb20sIHRvLCBhbW91bnQpOwogICAgfQp9CgovLy8gQHRpdGxlIHRva2VuIGdlbmVyYXRpb24gYW5kIGRlc3RydWN0aW9uCi8vLyBAZGV2IGludGVybmFsIGludGVyZmFjZSBwcm92aWRpbmcgdG9rZW4gZ2VuZXJhdGlvbiBhbmQgZGVzdHJ1Y3Rpb24sIHNlZSBNaW50YWJsZVNuYXBzaG90VG9rZW4gZm9yIGltcGxlbWVudGF0aW9uCmNvbnRyYWN0IE1Ub2tlbk1pbnQgewoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gSW50ZXJuYWwgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYGFtb3VudGAgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIGBvd25lcmAKICAgIC8vLyBAcGFyYW0gb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIGdlbmVyYXRlZAogICAgLy8vIEBkZXYgcmV2ZXJ0cyBpZiB0b2tlbnMgY291bGQgbm90IGJlIGdlbmVyYXRlZAogICAgZnVuY3Rpb24gbUdlbmVyYXRlVG9rZW5zKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgYW1vdW50KQogICAgICAgIGludGVybmFsOwoKICAgIC8vLyBAbm90aWNlIEJ1cm5zIGBhbW91bnRgIHRva2VucyBmcm9tIGBvd25lcmAKICAgIC8vLyBAcGFyYW0gb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGxvc2UgdGhlIHRva2VucwogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuCiAgICAvLy8gQGRldiByZXZlcnRzIGlmIHRva2VucyBjb3VsZCBub3QgYmUgZGVzdHJveWVkCiAgICBmdW5jdGlvbiBtRGVzdHJveVRva2VucyhhZGRyZXNzIG93bmVyLCB1aW50MjU2IGFtb3VudCkKICAgICAgICBpbnRlcm5hbDsKfQoKLy8vIEB0aXRsZSBiYXNpYyBzbmFwc2hvdCB0b2tlbiB3aXRoIGZhY2l0aWxpdGVzIHRvIGdlbmVyYXRlIGFuZCBkZXN0cm95IHRva2VucwovLy8gQGRldiBpbXBsZW1lbnRlcyBNVG9rZW5NaW50LCBkb2VzIG5vdCBleHBvc2UgYW55IHB1YmxpYyBmdW5jdGlvbnMgdGhhdCBjcmVhdGUvZGVzdHJveSB0b2tlbnMKY29udHJhY3QgTWludGFibGVTbmFwc2hvdFRva2VuIGlzCiAgICBCYXNpY1NuYXBzaG90VG9rZW4sCiAgICBNVG9rZW5NaW50CnsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbnN0cnVjdG9yCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW50YWJsZVNuYXBzaG90VG9rZW4KICAgIC8vLyBAcGFyYW0gcGFyZW50VG9rZW4gQWRkcmVzcyBvZiB0aGUgcGFyZW50IHRva2VuLCBzZXQgdG8gMHgwIGlmIGl0IGlzIGEKICAgIC8vLyAgbmV3IHRva2VuCiAgICBmdW5jdGlvbiBNaW50YWJsZVNuYXBzaG90VG9rZW4oCiAgICAgICAgSUNsb25lZFRva2VuUGFyZW50IHBhcmVudFRva2VuLAogICAgICAgIHVpbnQyNTYgcGFyZW50U25hcHNob3RJZAogICAgKQogICAgICAgIEJhc2ljU25hcHNob3RUb2tlbihwYXJlbnRUb2tlbiwgcGFyZW50U25hcHNob3RJZCkKICAgICAgICBpbnRlcm5hbAogICAge30KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYGFtb3VudGAgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIGBvd25lcmAKICAgIC8vLyBAcGFyYW0gb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIGdlbmVyYXRlZAogICAgZnVuY3Rpb24gbUdlbmVyYXRlVG9rZW5zKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgYW1vdW50KQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgLy8gbmV2ZXIgY3JlYXRlIGZvciBhZGRyZXNzIDAKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIGJsb2NrIGNoYW5nZXMgaW4gY2xvbmUgdGhhdCBwb2ludHMgdG8gZnV0dXJlL2N1cnJlbnQgc25hcHNob3RzIG9mIHBhdGVudCB0b2tlbgogICAgICAgIHJlcXVpcmUocGFyZW50VG9rZW4oKSA9PSBhZGRyZXNzKDApIHx8IHBhcmVudFNuYXBzaG90SWQoKSA8IHBhcmVudFRva2VuKCkuY3VycmVudFNuYXBzaG90SWQoKSk7CgogICAgICAgIHVpbnQyNTYgY3VyVG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseSgpOwogICAgICAgIHVpbnQyNTYgbmV3VG90YWxTdXBwbHkgPSBjdXJUb3RhbFN1cHBseSArIGFtb3VudDsKICAgICAgICByZXF1aXJlKG5ld1RvdGFsU3VwcGx5ID49IGN1clRvdGFsU3VwcGx5KTsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CgogICAgICAgIHVpbnQyNTYgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2Yob3duZXIpOwogICAgICAgIHVpbnQyNTYgbmV3QmFsYW5jZVRvID0gcHJldmlvdXNCYWxhbmNlVG8gKyBhbW91bnQ7CiAgICAgICAgYXNzZXJ0KG5ld0JhbGFuY2VUbyA+PSBwcmV2aW91c0JhbGFuY2VUbyk7IC8vIENoZWNrIGZvciBvdmVyZmxvdwoKICAgICAgICBzZXRWYWx1ZShfdG90YWxTdXBwbHlWYWx1ZXMsIG5ld1RvdGFsU3VwcGx5KTsKICAgICAgICBzZXRWYWx1ZShfYmFsYW5jZXNbb3duZXJdLCBuZXdCYWxhbmNlVG8pOwoKICAgICAgICBUcmFuc2ZlcigwLCBvd25lciwgYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBCdXJucyBgYW1vdW50YCB0b2tlbnMgZnJvbSBgb3duZXJgCiAgICAvLy8gQHBhcmFtIG93bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gYW1vdW50IFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgdG8gYnVybgogICAgZnVuY3Rpb24gbURlc3Ryb3lUb2tlbnMoYWRkcmVzcyBvd25lciwgdWludDI1NiBhbW91bnQpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICAvLyBibG9jayBjaGFuZ2VzIGluIGNsb25lIHRoYXQgcG9pbnRzIHRvIGZ1dHVyZS9jdXJyZW50IHNuYXBzaG90cyBvZiBwYXRlbnQgdG9rZW4KICAgICAgICByZXF1aXJlKHBhcmVudFRva2VuKCkgPT0gYWRkcmVzcygwKSB8fCBwYXJlbnRTbmFwc2hvdElkKCkgPCBwYXJlbnRUb2tlbigpLmN1cnJlbnRTbmFwc2hvdElkKCkpOwoKICAgICAgICB1aW50MjU2IGN1clRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkoKTsKICAgICAgICByZXF1aXJlKGN1clRvdGFsU3VwcGx5ID49IGFtb3VudCk7CgogICAgICAgIHVpbnQyNTYgcHJldmlvdXNCYWxhbmNlRnJvbSA9IGJhbGFuY2VPZihvd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VGcm9tID49IGFtb3VudCk7CgogICAgICAgIHVpbnQyNTYgbmV3VG90YWxTdXBwbHkgPSBjdXJUb3RhbFN1cHBseSAtIGFtb3VudDsKICAgICAgICB1aW50MjU2IG5ld0JhbGFuY2VGcm9tID0gcHJldmlvdXNCYWxhbmNlRnJvbSAtIGFtb3VudDsKICAgICAgICBzZXRWYWx1ZShfdG90YWxTdXBwbHlWYWx1ZXMsIG5ld1RvdGFsU3VwcGx5KTsKICAgICAgICBzZXRWYWx1ZShfYmFsYW5jZXNbb3duZXJdLCBuZXdCYWxhbmNlRnJvbSk7CgogICAgICAgIFRyYW5zZmVyKG93bmVyLCAwLCBhbW91bnQpOwogICAgfQp9CgovKgogICAgQ29weXJpZ2h0IDIwMTYsIEpvcmRpIEJheWxpbmEKICAgIENvcHlyaWdodCAyMDE3LCBSZW1jbyBCbG9lbWVuLCBNYXJjaW4gUnVkb2xmCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCi8vLyBAdGl0bGUgU3RhbmRhcmRTbmFwc2hvdFRva2VuIENvbnRyYWN0Ci8vLyBAYXV0aG9yIEpvcmRpIEJheWxpbmEsIFJlbWNvIEJsb2VtZW4sIE1hcmNpbiBSdWRvbGYKLy8vIEBkZXYgVGhpcyB0b2tlbiBjb250cmFjdCdzIGdvYWwgaXMgdG8gbWFrZSBpdCBlYXN5IGZvciBhbnlvbmUgdG8gY2xvbmUgdGhpcwovLy8gIHRva2VuIHVzaW5nIHRoZSB0b2tlbiBkaXN0cmlidXRpb24gYXQgYSBnaXZlbiBibG9jaywgdGhpcyB3aWxsIGFsbG93IERBTydzCi8vLyAgYW5kIERBcHBzIHRvIHVwZ3JhZGUgdGhlaXIgZmVhdHVyZXMgaW4gYSBkZWNlbnRyYWxpemVkIG1hbm5lciB3aXRob3V0Ci8vLyAgYWZmZWN0aW5nIHRoZSBvcmlnaW5hbCB0b2tlbgovLy8gQGRldiBJdCBpcyBFUkMyMCBjb21wbGlhbnQsIGJ1dCBzdGlsbCBuZWVkcyB0byB1bmRlciBnbyBmdXJ0aGVyIHRlc3RpbmcuCi8vLyBAZGV2IFZhcmlvdXMgY29udHJhY3RzIGFyZSBjb21wb3NlZCB0byBwcm92aWRlIHJlcXVpcmVkIGZ1bmN0aW9uYWxpdHkgb2YgdGhpcyB0b2tlbiwgZGlmZmVyZW50IGNvbXBvc2l0aW9ucyBhcmUgcG9zc2libGUKLy8vICAgICBNaW50YWJsZVNuYXBzaG90VG9rZW4gcHJvdmlkZXMgdHJhbnNmZXIsIG1pbml0aW5nIGFuZCBzbmFwc2hvdHRpbmcgZnVuY3Rpb25zCi8vLyAgICAgVG9rZW5BbGxvd2FuY2UgcHJvdmlkZXMgYXBwcm92ZS90cmFuc2ZlckZyb20gZnVuY3Rpb25zCi8vLyAgICAgVG9rZW5NZXRhZGF0YSBhZGRzIG5hbWUsIHN5bWJvbCBhbmQgb3RoZXIgdG9rZW4gbWV0YWRhdGEKLy8vIEBkZXYgVGhpcyB0b2tlbiBpcyBzdGlsbCBhYnN0cmFjdCwgU25hcHNob3QsIEJhc2ljU25hcHNob3RUb2tlbiBhbmQgVG9rZW5BbGxvd2FuY2Ugb2JzZXJ2ZSBpbnRlcmZhY2VzIHRoYXQgbXVzdCBiZSBpbXBsZW1lbnRlZAovLy8gICAgIE1TbmFwc2hvdFBvbGljeSAtIHBhcnRpY3VsYXIgc25hcHNob3QgaWQgY3JlYXRpb24gbWVjaGFuaXNtCi8vLyAgICAgTVRva2VuQ29udHJvbGxlciAtIGNvbnRyb2xscyBhcHByb3ZhbHMgYW5kIHRyYW5zZmVycwovLy8gICAgIHNlZSBOZXVtYXJrIGFzIGFuIGV4YW1wbGUKLy8vIEBkZXYgaW1wbGVtZW50cyBFUkMyMjMgdG9rZW4gdHJhbnNmZXIKY29udHJhY3QgU3RhbmRhcmRTbmFwc2hvdFRva2VuIGlzCiAgICBJRVJDMjBUb2tlbiwKICAgIE1pbnRhYmxlU25hcHNob3RUb2tlbiwKICAgIFRva2VuQWxsb3dhbmNlLAogICAgSUVSQzIyM1Rva2VuLAogICAgSXNDb250cmFjdAp7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbnN0cnVjdG9yCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvciB0byBjcmVhdGUgYSBNaW5pTWVUb2tlbgogICAgLy8vICBpcyBhIG5ldyB0b2tlbgogICAgLy8vIHBhcmFtIHRva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBwYXJhbSBkZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBwYXJhbSB0b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIGZ1bmN0aW9uIFN0YW5kYXJkU25hcHNob3RUb2tlbigKICAgICAgICBJQ2xvbmVkVG9rZW5QYXJlbnQgcGFyZW50VG9rZW4sCiAgICAgICAgdWludDI1NiBwYXJlbnRTbmFwc2hvdElkCiAgICApCiAgICAgICAgTWludGFibGVTbmFwc2hvdFRva2VuKHBhcmVudFRva2VuLCBwYXJlbnRTbmFwc2hvdElkKQogICAgICAgIFRva2VuQWxsb3dhbmNlKCkKICAgICAgICBpbnRlcm5hbAogICAge30KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vCiAgICAvLyBJbXBsZW1lbnRzIElFUkMyMjNUb2tlbgogICAgLy8KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IGFtb3VudCwgYnl0ZXMgZGF0YSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIGl0IGlzIG5lY2Vzc2FyeSB0byBwb2ludCBvdXQgaW1wbGVtZW50YXRpb24gdG8gYmUgY2FsbGVkCiAgICAgICAgQmFzaWNTbmFwc2hvdFRva2VuLm1UcmFuc2Zlcihtc2cuc2VuZGVyLCB0bywgYW1vdW50KTsKCiAgICAgICAgLy8gTm90aWZ5IHRoZSByZWNlaXZpbmcgY29udHJhY3QuCiAgICAgICAgaWYgKGlzQ29udHJhY3QodG8pKSB7CiAgICAgICAgICAgIElFUkMyMjNDYWxsYmFjayh0bykub25Ub2tlblRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudCwgZGF0YSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9Cgpjb250cmFjdCBOZXVtYXJrIGlzCiAgICBBY2Nlc3NDb250cm9sbGVkLAogICAgQWNjZXNzUm9sZXMsCiAgICBBZ3JlZW1lbnQsCiAgICBEYWlseUFuZFNuYXBzaG90YWJsZSwKICAgIFN0YW5kYXJkU25hcHNob3RUb2tlbiwKICAgIFRva2VuTWV0YWRhdGEsCiAgICBOZXVtYXJrSXNzdWFuY2VDdXJ2ZSwKICAgIFJlY2xhaW1hYmxlCnsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIENvbnN0YW50cwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgc3RyaW5nIHByaXZhdGUgY29uc3RhbnQgVE9LRU5fTkFNRSA9ICJOZXVtYXJrIjsKCiAgICB1aW50OCAgcHJpdmF0ZSBjb25zdGFudCBUT0tFTl9ERUNJTUFMUyA9IDE4OwoKICAgIHN0cmluZyBwcml2YXRlIGNvbnN0YW50IFRPS0VOX1NZTUJPTCA9ICJORVUiOwoKICAgIHN0cmluZyBwcml2YXRlIGNvbnN0YW50IFZFUlNJT04gPSAiTk1LXzEuMCI7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBNdXRhYmxlIHN0YXRlCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLyBkaXNhYmxlIHRyYW5zZmVycyB3aGVuIE5ldW1hcmsgaXMgY3JlYXRlZAogICAgYm9vbCBwcml2YXRlIF90cmFuc2ZlckVuYWJsZWQgPSBmYWxzZTsKCiAgICAvLyBhdCB3aGljaCBwb2ludCBvbiBjdXJ2ZSBuZXcgTmV1bWFya3Mgd2lsbCBiZSBjcmVhdGVkLCBzZWUgTmV1bWFya0lzc3VhbmNlQ3VydmUgY29udHJhY3QKICAgIC8vIGRvIG5vdCB1c2UgdG8gZ2V0IHRvdGFsIGludmVzdGVkIGZ1bmRzLiBzZWUgYnVybigpLiB0aGlzIGlzIGp1c3QgYSBjYWNoZSBmb3IgZXhwZW5zaXZlIGludmVyc2UgZnVuY3Rpb24KICAgIHVpbnQyNTYgcHJpdmF0ZSBfdG90YWxFdXJVbHBzOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gRXZlbnRzCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBldmVudCBMb2dOZXVtYXJrc0lzc3VlZCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgb3duZXIsCiAgICAgICAgdWludDI1NiBldXJvVWxwcywKICAgICAgICB1aW50MjU2IG5ldW1hcmtVbHBzCiAgICApOwoKICAgIGV2ZW50IExvZ05ldW1hcmtzQnVybmVkKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBvd25lciwKICAgICAgICB1aW50MjU2IGV1cm9VbHBzLAogICAgICAgIHVpbnQyNTYgbmV1bWFya1VscHMKICAgICk7CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gTmV1bWFyaygKICAgICAgICBJQWNjZXNzUG9saWN5IGFjY2Vzc1BvbGljeSwKICAgICAgICBJRXRoZXJldW1Gb3JrQXJiaXRlciBmb3JrQXJiaXRlcgogICAgKQogICAgICAgIEFjY2Vzc0NvbnRyb2xsZWQoYWNjZXNzUG9saWN5KQogICAgICAgIEFjY2Vzc1JvbGVzKCkKICAgICAgICBBZ3JlZW1lbnQoYWNjZXNzUG9saWN5LCBmb3JrQXJiaXRlcikKICAgICAgICBTdGFuZGFyZFNuYXBzaG90VG9rZW4oCiAgICAgICAgICAgIElDbG9uZWRUb2tlblBhcmVudCgweDApLAogICAgICAgICAgICAwCiAgICAgICAgKQogICAgICAgIFRva2VuTWV0YWRhdGEoCiAgICAgICAgICAgIFRPS0VOX05BTUUsCiAgICAgICAgICAgIFRPS0VOX0RFQ0lNQUxTLAogICAgICAgICAgICBUT0tFTl9TWU1CT0wsCiAgICAgICAgICAgIFZFUlNJT04KICAgICAgICApCiAgICAgICAgRGFpbHlBbmRTbmFwc2hvdGFibGUoMCkKICAgICAgICBOZXVtYXJrSXNzdWFuY2VDdXJ2ZSgpCiAgICAgICAgUmVjbGFpbWFibGUoKQogICAgICAgIHB1YmxpYwogICAge30KCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIFB1YmxpYyBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIGlzc3VlcyBuZXcgTmV1bWFya3MgdG8gbXNnLnNlbmRlciB3aXRoIHJld2FyZCBhdCBjdXJyZW50IGN1cnZlIHBvc2l0aW9uCiAgICAvLy8gICAgIG1vdmVzIGN1cnZlIHBvc2l0aW9uIGJ5IGV1cm9VbHBzCiAgICAvLy8gICAgIGNhbGxhYmxlIG9ubHkgYnkgUk9MRV9ORVVNQVJLX0lTU1VFUgogICAgZnVuY3Rpb24gaXNzdWVGb3JFdXJvKHVpbnQyNTYgZXVyb1VscHMpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seShST0xFX05FVU1BUktfSVNTVUVSKQogICAgICAgIGFjY2VwdEFncmVlbWVudChtc2cuc2VuZGVyKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmVxdWlyZShfdG90YWxFdXJVbHBzICsgZXVyb1VscHMgPj0gX3RvdGFsRXVyVWxwcyk7CiAgICAgICAgdWludDI1NiBuZXVtYXJrVWxwcyA9IGluY3JlbWVudGFsKF90b3RhbEV1clVscHMsIGV1cm9VbHBzKTsKICAgICAgICBfdG90YWxFdXJVbHBzICs9IGV1cm9VbHBzOwogICAgICAgIG1HZW5lcmF0ZVRva2Vucyhtc2cuc2VuZGVyLCBuZXVtYXJrVWxwcyk7CiAgICAgICAgTG9nTmV1bWFya3NJc3N1ZWQobXNnLnNlbmRlciwgZXVyb1VscHMsIG5ldW1hcmtVbHBzKTsKICAgICAgICByZXR1cm4gbmV1bWFya1VscHM7CiAgICB9CgogICAgLy8vIEBub3RpY2UgdXNlZCBieSBST0xFX05FVU1BUktfSVNTVUVSIHRvIHRyYW5zZXIgbmV3bHkgaXNzdWVkIG5ldW1hcmtzCiAgICAvLy8gICAgIHR5cGljYWxseSB0byB0aGUgaW52ZXN0b3IgYW5kIHBsYXRmb3JtIG9wZXJhdG9yCiAgICBmdW5jdGlvbiBkaXN0cmlidXRlKGFkZHJlc3MgdG8sIHVpbnQyNTYgbmV1bWFya1VscHMpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seShST0xFX05FVU1BUktfSVNTVUVSKQogICAgICAgIGFjY2VwdEFncmVlbWVudCh0bykKICAgIHsKICAgICAgICBtVHJhbnNmZXIobXNnLnNlbmRlciwgdG8sIG5ldW1hcmtVbHBzKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBtc2cuc2VuZGVyIGNhbiBidXJuIHRoZWlyIE5ldW1hcmtzLCBjdXJ2ZSBpcyByb2xsZWQgYmFjayB1c2luZyBpbnZlcnNlCiAgICAvLy8gICAgIGN1cnZlLiBhcyBhIHJlc3VsdCBjb3N0IG9mIE5ldW1hcmsgZ2V0cyBsb3dlciAocmV3YXJkIGlzIGhpZ2hlcikKICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBuZXVtYXJrVWxwcykKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5KFJPTEVfTkVVTUFSS19CVVJORVIpCiAgICB7CiAgICAgICAgYnVyblByaXZhdGUobmV1bWFya1VscHMsIDAsIF90b3RhbEV1clVscHMpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGV4ZWN1dGVzIGFzIGZ1bmN0aW9uIGFib3ZlIGJ1dCBhbGxvd3MgdG8gcHJvdmlkZSBzZWFyY2ggcmFuZ2UgZm9yIGxvdyBnYXMgYnVybmluZwogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IG5ldW1hcmtVbHBzLCB1aW50MjU2IG1pbkV1clVscHMsIHVpbnQyNTYgbWF4RXVyVWxwcykKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5KFJPTEVfTkVVTUFSS19CVVJORVIpCiAgICB7CiAgICAgICAgYnVyblByaXZhdGUobmV1bWFya1VscHMsIG1pbkV1clVscHMsIG1heEV1clVscHMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVyKGJvb2wgZW5hYmxlZCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5KFJPTEVfVFJBTlNGRVJfQURNSU4pCiAgICB7CiAgICAgICAgX3RyYW5zZmVyRW5hYmxlZCA9IGVuYWJsZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlU25hcHNob3QoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHkoUk9MRV9TTkFQU0hPVF9DUkVBVE9SKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIERhaWx5QW5kU25hcHNob3RhYmxlLmNyZWF0ZVNuYXBzaG90KCk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJFbmFibGVkKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIF90cmFuc2ZlckVuYWJsZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gdG90YWxFdXJvVWxwcygpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBfdG90YWxFdXJVbHBzOwogICAgfQoKICAgIGZ1bmN0aW9uIGluY3JlbWVudGFsKHVpbnQyNTYgZXVyb1VscHMpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50MjU2IG5ldW1hcmtVbHBzKQogICAgewogICAgICAgIHJldHVybiBpbmNyZW1lbnRhbChfdG90YWxFdXJVbHBzLCBldXJvVWxwcyk7CiAgICB9CgogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBJbnRlcm5hbCBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vCiAgICAvLyBJbXBsZW1lbnRzIE1Ub2tlbkNvbnRyb2xsZXIKICAgIC8vCgogICAgZnVuY3Rpb24gbU9uVHJhbnNmZXIoCiAgICAgICAgYWRkcmVzcyBmcm9tLAogICAgICAgIGFkZHJlc3MsIC8vIHRvCiAgICAgICAgdWludDI1NiAvLyBhbW91bnQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGFjY2VwdEFncmVlbWVudChmcm9tKQogICAgICAgIHJldHVybnMgKGJvb2wgYWxsb3cpCiAgICB7CiAgICAgICAgLy8gbXVzdCBoYXZlIHRyYW5zZmVyIGVuYWJsZWQgb3IgbXNnLnNlbmRlciBpcyBOZXVtYXJrIGlzc3VlcgogICAgICAgIHJldHVybiBfdHJhbnNmZXJFbmFibGVkIHx8IGFjY2Vzc1BvbGljeSgpLmFsbG93ZWQobXNnLnNlbmRlciwgUk9MRV9ORVVNQVJLX0lTU1VFUiwgdGhpcywgbXNnLnNpZyk7CiAgICB9CgogICAgZnVuY3Rpb24gbU9uQXBwcm92ZSgKICAgICAgICBhZGRyZXNzIG93bmVyLAogICAgICAgIGFkZHJlc3MsIC8vIHNwZW5kZXIsCiAgICAgICAgdWludDI1NiAvLyBhbW91bnQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGFjY2VwdEFncmVlbWVudChvd25lcikKICAgICAgICByZXR1cm5zIChib29sIGFsbG93KQogICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gUHJpdmF0ZSBmdW5jdGlvbnMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIGJ1cm5Qcml2YXRlKHVpbnQyNTYgYnVybk5ldW1hcmtVbHBzLCB1aW50MjU2IG1pbkV1clVscHMsIHVpbnQyNTYgbWF4RXVyVWxwcykKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgdWludDI1NiBwcmV2RXVyb1VscHMgPSBfdG90YWxFdXJVbHBzOwogICAgICAgIC8vIGJ1cm4gZmlyc3QgaW4gdGhlIHRva2VuIHRvIG1ha2Ugc3VyZSBiYWxhbmNlL3RvdGFsU3VwcGx5IGlzIG5vdCBjcm9zc2VkCiAgICAgICAgbURlc3Ryb3lUb2tlbnMobXNnLnNlbmRlciwgYnVybk5ldW1hcmtVbHBzKTsKICAgICAgICBfdG90YWxFdXJVbHBzID0gY3VtdWxhdGl2ZUludmVyc2UodG90YWxTdXBwbHkoKSwgbWluRXVyVWxwcywgbWF4RXVyVWxwcyk7CiAgICAgICAgLy8gYWN0dWFsbHkgbWF5IG92ZXJmbG93IG9uIG5vbi1tb25vdG9uaWMgaW52ZXJzZQogICAgICAgIGFzc2VydChwcmV2RXVyb1VscHMgPj0gX3RvdGFsRXVyVWxwcyk7CiAgICAgICAgdWludDI1NiBldXJvVWxwcyA9IHByZXZFdXJvVWxwcyAtIF90b3RhbEV1clVscHM7CiAgICAgICAgTG9nTmV1bWFya3NCdXJuZWQobXNnLnNlbmRlciwgZXVyb1VscHMsIGJ1cm5OZXVtYXJrVWxwcyk7CiAgICB9Cn0='.
	

]
