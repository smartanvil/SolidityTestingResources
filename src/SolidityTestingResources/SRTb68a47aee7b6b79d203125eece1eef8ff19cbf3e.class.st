Class {
	#name : #SRTb68a47aee7b6b79d203125eece1eef8ff19cbf3e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb68a47aee7b6b79d203125eece1eef8ff19cbf3e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgLyoqCiAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBSZWZ1bmRWYXVsdAogKiBAZGV2IFRoaXMgY29udHJhY3QgaXMgdXNlZCBmb3Igc3RvcmluZyBmdW5kcyB3aGlsZSBhIGNyb3dkc2FsZQogKiBpcyBpbiBwcm9ncmVzcy4gU3VwcG9ydHMgcmVmdW5kaW5nIHRoZSBtb25leSBpZiBjcm93ZHNhbGUgZmFpbHMsCiAqIGFuZCBmb3J3YXJkaW5nIGl0IGlmIGNyb3dkc2FsZSBpcyBzdWNjZXNzZnVsLgogKi8KY29udHJhY3QgUmVmdW5kVmF1bHQgaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIGVudW0gU3RhdGUgeyBBY3RpdmUsIFJlZnVuZGluZywgQ2xvc2VkIH0KCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdGVkOwogIGFkZHJlc3MgcHVibGljIHdhbGxldDsKICBTdGF0ZSBwdWJsaWMgc3RhdGU7CgogIGV2ZW50IENsb3NlZCgpOwogIGV2ZW50IFJlZnVuZHNFbmFibGVkKCk7CiAgZXZlbnQgUmVmdW5kZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHdlaUFtb3VudCk7CgogIC8qKgogICAqIEBwYXJhbSBfd2FsbGV0IFZhdWx0IGFkZHJlc3MKICAgKi8KICBmdW5jdGlvbiBSZWZ1bmRWYXVsdChhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyB7CiAgICByZXF1aXJlKF93YWxsZXQgIT0gYWRkcmVzcygwKSk7CiAgICB3YWxsZXQgPSBfd2FsbGV0OwogICAgc3RhdGUgPSBTdGF0ZS5BY3RpdmU7CiAgfQoKICAvKioKICAgKiBAcGFyYW0gaW52ZXN0b3IgSW52ZXN0b3IgYWRkcmVzcwogICAqLwogIGZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyBpbnZlc3Rvcikgb25seU93bmVyIHB1YmxpYyBwYXlhYmxlIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRbaW52ZXN0b3JdLmFkZChtc2cudmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gY2xvc2UoKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuQ2xvc2VkOwogICAgQ2xvc2VkKCk7CiAgICB3YWxsZXQudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICB9CgogIGZ1bmN0aW9uIGVuYWJsZVJlZnVuZHMoKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKICAgIHN0YXRlID0gU3RhdGUuUmVmdW5kaW5nOwogICAgUmVmdW5kc0VuYWJsZWQoKTsKICB9CgogIC8qKgogICAqIEBwYXJhbSBpbnZlc3RvciBJbnZlc3RvciBhZGRyZXNzCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKGFkZHJlc3MgaW52ZXN0b3IpIHB1YmxpYyB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CiAgICB1aW50MjU2IGRlcG9zaXRlZFZhbHVlID0gZGVwb3NpdGVkW2ludmVzdG9yXTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSAwOwogICAgaW52ZXN0b3IudHJhbnNmZXIoZGVwb3NpdGVkVmFsdWUpOwogICAgUmVmdW5kZWQoaW52ZXN0b3IsIGRlcG9zaXRlZFZhbHVlKTsKICB9Cn0KCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Cgpjb250cmFjdCBBQ0FUb2tlbiBpcyBFUkMyMCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIGFkbWluOwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJBQ0EgTmV0d29yayBUb2tlbiI7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJBQ0EiOwogICAgdWludDggcHVibGljIGRlY2ltYWxzID0gMTg7CgogICAgdWludDI1NiB0b3RhbFN1cHBseV87CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAgIGJvb2wgdHJhbnNmZXJhYmxlID0gZmFsc2U7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIGludGVybmFsIHRyYW5zZmVyTG9ja2VkOwoKICAgIGV2ZW50IEdlbmVzaXMoYWRkcmVzcyBvd25lciwgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKICAgIGV2ZW50IEFkbWluVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzQWRtaW4sIGFkZHJlc3MgaW5kZXhlZCBuZXdBZG1pbik7CiAgICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBidXJuZXIsIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgTG9nQWRkcmVzcyhhZGRyZXNzIGluZGV4ZWQgYWRkcik7CiAgICBldmVudCBMb2dVaW50MjU2KHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgVHJhbnNmZXJMb2NrKGFkZHJlc3MgaW5kZXhlZCB0YXJnZXQsIGJvb2wgdmFsdWUpOwoKICAgIC8vIG1vZGlmaWVycwogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyIHx8IG1zZy5zZW5kZXIgPT0gYWRtaW4pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY2FuVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwoKICAgICAgICBpZiAoIF9mcm9tICE9IG93bmVyICYmIF9mcm9tICE9IGFkbWluICkgewogICAgICAgICAgICByZXF1aXJlKHRyYW5zZmVyYWJsZSk7CiAgICAgICAgICAgIHJlcXVpcmUgKCF0cmFuc2ZlckxvY2tlZFtfZnJvbV0pOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIC8vIGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBBQ0FUb2tlbih1aW50MjU2IF90b3RhbFN1cHBseSwgYWRkcmVzcyBfbmV3QWRtaW4pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdG90YWxTdXBwbHkgPiAwKTsKICAgICAgICByZXF1aXJlKF9uZXdBZG1pbiAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIHJlcXVpcmUoX25ld0FkbWluICE9IG1zZy5zZW5kZXIpOwoKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgYWRtaW4gPSBfbmV3QWRtaW47CgogICAgICAgIHRvdGFsU3VwcGx5XyA9IF90b3RhbFN1cHBseTsKCiAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gdG90YWxTdXBwbHlfOwogICAgICAgIGFwcHJvdmUoYWRtaW4sIHRvdGFsU3VwcGx5Xyk7CiAgICAgICAgR2VuZXNpcyhvd25lciwgdG90YWxTdXBwbHlfKTsKICAgIH0KCiAgICAvLyBwZXJtaXNzaW9uIHJlbGF0ZWQKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSBhZG1pbik7CgogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckFkbWluKGFkZHJlc3MgX25ld0FkbWluKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9uZXdBZG1pbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9uZXdBZG1pbiAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKF9uZXdBZG1pbiAhPSBvd25lcik7CgogICAgICAgIGFkbWluID0gX25ld0FkbWluOwogICAgICAgIEFkbWluVHJhbnNmZXJyZWQoYWRtaW4sIF9uZXdBZG1pbik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0VHJhbnNmZXJhYmxlKGJvb2wgX3RyYW5zZmVyYWJsZSkgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgdHJhbnNmZXJhYmxlID0gX3RyYW5zZmVyYWJsZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1RyYW5zZmVyYWJsZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJhYmxlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyTG9jaygpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdHJhbnNmZXJMb2NrZWRbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgICAgIFRyYW5zZmVyTG9jayhtc2cuc2VuZGVyLCB0cnVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYW5hZ2VUcmFuc2ZlckxvY2soYWRkcmVzcyBfdGFyZ2V0LCBib29sIF92YWx1ZSkgcHVibGljIG9ubHlPd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdHJhbnNmZXJMb2NrZWRbX3RhcmdldF0gPSBfdmFsdWU7CiAgICAgICAgVHJhbnNmZXJMb2NrKF90YXJnZXQsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJBbGxvd2VkKGFkZHJlc3MgX3RhcmdldCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiAodHJhbnNmZXJhYmxlICYmIHRyYW5zZmVyTG9ja2VkW190YXJnZXRdID09IGZhbHNlKTsKICAgIH0KCiAgICAvLyB0b2tlbiByZWxhdGVkCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlfOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW21zZy5zZW5kZXJdKTsKCiAgICAgICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mT3duZXIoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2ZlcihfZnJvbSwgX3RvKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSk7CgogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF9zcGVuZGVyKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIobXNnLnNlbmRlciwgX3NwZW5kZXIpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIGNhblRyYW5zZmVyKG1zZy5zZW5kZXIsIF9zcGVuZGVyKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgICAgIH0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwogICAgICAgIC8vIG5vIG5lZWQgdG8gcmVxdWlyZSB2YWx1ZSA8PSB0b3RhbFN1cHBseSwgc2luY2UgdGhhdCB3b3VsZCBpbXBseSB0aGUKICAgICAgICAvLyBzZW5kZXIncyBiYWxhbmNlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgdG90YWxTdXBwbHksIHdoaWNoICpzaG91bGQqIGJlIGFuIGFzc2VydGlvbiBmYWlsdXJlCgogICAgICAgIGFkZHJlc3MgYnVybmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBiYWxhbmNlc1tidXJuZXJdID0gYmFsYW5jZXNbYnVybmVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseV8gPSB0b3RhbFN1cHBseV8uc3ViKF92YWx1ZSk7CiAgICAgICAgQnVybihidXJuZXIsIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZW1lcmdlbmN5RVJDMjBEcmFpbihFUkMyMCBfdG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgX3Rva2VuLnRyYW5zZmVyKG93bmVyLCBfYW1vdW50KTsKICAgIH0KfQoKY29udHJhY3QgQUNBVG9rZW5TYWxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgYWRtaW47CgogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwogICAgQUNBVG9rZW4gcHVibGljIHRva2VuOwoKICAgIHVpbnQyNTYgdG90YWxTdXBwbHk7CgogICAgc3RydWN0IFN0YWdlSW5mbyB7CiAgICAgICAgdWludDI1NiBvcGVuaW5nOwogICAgICAgIHVpbnQyNTYgY2xvc2luZzsKICAgICAgICB1aW50MjU2IGNhcGFjaXR5OwogICAgICAgIHVpbnQyNTYgbWluaW11bVdlaTsKICAgICAgICB1aW50MjU2IG1heGltdW1XZWk7CiAgICAgICAgdWludDI1NiByYXRlOwogICAgICAgIHVpbnQyNTYgc29sZDsKICAgIH0KICAgIGJvb2wgcHVibGljIHRva2VuU2FsZUVuYWJsZWQgPSBmYWxzZTsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHdoaXRlbGlzdDsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMga3ljbGlzdDsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgd2hpdGVsaXN0Qm9udXM7CgogICAgdWludDI1NiBwdWJsaWMgd2hpdGVsaXN0Qm9udXNDbG9zaW5nVGltZTsKICAgIHVpbnQyNTYgcHVibGljIHdoaXRlbGlzdEJvbnVzU2VudCA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyB3aGl0ZWxpc3RCb251c1JhdGU7CiAgICB1aW50MjU2IHB1YmxpYyB3aGl0ZWxpc3RCb251c0Ftb3VudDsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBzYWxlczsKICAgIHVpbnQyNTYgcHVibGljIHNvZnRDYXA7CiAgICB1aW50MjU2IHB1YmxpYyBoYXJkQ2FwOwogICAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkID0gMDsKCiAgICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBhZGRyZXNzKSBwdWJsaWMgcmVmZXJyYWxzOwogICAgdWludDI1NiBwdWJsaWMgcmVmZXJyYWxBbW91bnQ7CiAgICB1aW50MjU2IHB1YmxpYyByZWZlcnJhbFJhdGVJbnZpdGVyOwogICAgdWludDI1NiBwdWJsaWMgcmVmZXJyYWxSYXRlSW52aXRlZTsKICAgIHVpbnQyNTYgcHVibGljIHJlZmVycmFsU2VudCA9IDA7CiAgICBib29sIHB1YmxpYyByZWZlcnJhbERvbmUgPSBmYWxzZTsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBib3VudGllczsKICAgIHVpbnQyNTYgcHVibGljIGJvdW50eUFtb3VudDsKICAgIHVpbnQyNTYgcHVibGljIGJvdW50eVNlbnQgPSAwOwoKICAgIFN0YWdlSW5mb1tdIHB1YmxpYyBzdGFnZXM7CiAgICB1aW50MjU2IHB1YmxpYyBjdXJyZW50U3RhZ2UgPSAwOwogICAgdWludDI1NiBwdWJsaWMgbWF4U3RhZ2UgPSAwOwoKICAgIGJvb2wgcHVibGljIGlzRmluYWxpemVkID0gZmFsc2U7CgogICAgLy8gZXZlbnRzCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKICAgIGV2ZW50IFRva2VuU2FsZUNyZWF0ZWQoYWRkcmVzcyBpbmRleGVkIHdhbGxldCwgdWludDI1NiB0b3RhbFN1cHBseSk7CiAgICBldmVudCBTdGFnZUFkZGVkKHVpbnQyNTYgb3BlbmluZ1RpbWUsIHVpbnQyNTYgY2xvc2luZ1RpbWUsIHVpbnQyNTYgY2FwYWNpdHksIHVpbnQyNTYgbWluaW11bVdlaSwgdWludDI1NiBtYXhpbXVtV2VpLCB1aW50MjU2IHJhdGUpOwogICAgZXZlbnQgVG9rZW5TYWxlRW5hYmxlZCgpOwoKICAgIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHZhbHVlLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBUb2tlbkNsYWltZWQoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBGaW5hbGl6ZWQoKTsKICAgIGV2ZW50IEJvdW50eVNldHVwRG9uZSgpOwogICAgZXZlbnQgQm91bnR5VXBkYXRlZChhZGRyZXNzIGluZGV4ZWQgdGFyZ2V0LCBib29sIGZsYWcsIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IFB1cmNoYXNlUmVmZXJyYWwoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBTdGFnZVVwZGF0ZWQodWludDI1NiBzdGFnZSk7CiAgICBldmVudCBTdGFnZUNhcFJlYWNoZWQodWludDI1NiBzdGFnZSk7CiAgICBldmVudCBSZWZlcnJhbENhcFJlYWNoZWQoKTsKCiAgICAvLyBkbyBub3QgdXNlIHRoaXMgb24gbWFpbm5ldCEKICAgIGV2ZW50IExvZ0FkZHJlc3MoYWRkcmVzcyBpbmRleGVkIGFkZHIpOwogICAgZXZlbnQgTG9nVWludDI1Nih1aW50MjU2IHZhbHVlKTsKCiAgICAvLyBtb2RpZmllcnMKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFkbWluKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lciB8fCBtc2cuc2VuZGVyID09IGFkbWluKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlXaGlsZU9wZW4gewogICAgICAgIHJlcXVpcmUodG9rZW5TYWxlRW5hYmxlZCA9PSB0cnVlKTsKICAgICAgICByZXF1aXJlKG5vdyA+PSBzdGFnZXNbY3VycmVudFN0YWdlXS5vcGVuaW5nICYmIG5vdyA8PSBzdGFnZXNbY3VycmVudFN0YWdlXS5jbG9zaW5nKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzVmVyaWZpZWQoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHsKICAgICAgICByZXF1aXJlKHdoaXRlbGlzdFtfYmVuZWZpY2lhcnldID09IHRydWUpOwogICAgICAgIHJlcXVpcmUoa3ljbGlzdFtfYmVuZWZpY2lhcnldID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgY2xhaW1hYmxlIHsKICAgICAgICByZXF1aXJlKGlzRmluYWxpemVkID09IHRydWUpOwogICAgICAgIHJlcXVpcmUoaXNHb2FsUmVhY2hlZCgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGdldHRlcnMKICAgIGZ1bmN0aW9uIGlzRW5hYmxlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdG9rZW5TYWxlRW5hYmxlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0Nsb3NlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbm93ID4gc3RhZ2VzW21heFN0YWdlIC0gMV0uY2xvc2luZzsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0dvYWxSZWFjaGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBnZXRUb3RhbFRva2VuU29sZCgpID49IHNvZnRDYXA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG90YWxUb2tlblNvbGQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBzb2xkID0gMDsKICAgICAgICBmb3IgKCB1aW50IGkgPSAwOyBpIDwgbWF4U3RhZ2U7ICsraSApIHsKICAgICAgICAgICAgc29sZCA9IHNvbGQuYWRkKHN0YWdlc1tpXS5zb2xkKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzb2xkOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9wZW5pbmdUaW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBzdGFnZXNbY3VycmVudFN0YWdlXS5vcGVuaW5nOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE9wZW5pbmdUaW1lQnlTdGFnZSh1aW50IF9pbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2luZGV4IDwgbWF4U3RhZ2UpOwogICAgICAgIHJldHVybiBzdGFnZXNbX2luZGV4XS5vcGVuaW5nOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENsb3NpbmdUaW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBzdGFnZXNbY3VycmVudFN0YWdlXS5jbG9zaW5nOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENsb3NpbmdUaW1lQnlTdGFnZSh1aW50IF9pbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2luZGV4IDwgbWF4U3RhZ2UpOwogICAgICAgIHJldHVybiBzdGFnZXNbX2luZGV4XS5jbG9zaW5nOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRDYXBhY2l0eSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc3RhZ2VzW2N1cnJlbnRTdGFnZV0uY2FwYWNpdHk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q2FwYWNpdHkodWludCBfaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IG1heFN0YWdlKTsKICAgICAgICByZXR1cm4gc3RhZ2VzW19pbmRleF0uY2FwYWNpdHk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFNvbGQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHN0YWdlc1tjdXJyZW50U3RhZ2VdLnNvbGQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0U29sZCh1aW50IF9pbmRleCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2luZGV4IDwgbWF4U3RhZ2UpOwogICAgICAgIHJldHVybiBzdGFnZXNbX2luZGV4XS5zb2xkOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRSYXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBzdGFnZXNbY3VycmVudFN0YWdlXS5yYXRlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJhdGUodWludCBfaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IG1heFN0YWdlKTsKICAgICAgICByZXR1cm4gc3RhZ2VzW19pbmRleF0ucmF0ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSYXRlV2l0aG91dEJvbnVzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBzdGFnZXNbbWF4U3RhZ2UgLSAxXS5yYXRlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFNhbGVzKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHNhbGVzW19iZW5lZmljaWFyeV07CiAgICB9CiAgICAKICAgIC8vIHNldHRlcgogICAgZnVuY3Rpb24gc2V0U2FsZVBlcmlvZCh1aW50IF9pbmRleCwgdWludDI1NiBfb3BlbmluZ1RpbWUsIHVpbnQyNTYgX2Nsb3NpbmdUaW1lKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9vcGVuaW5nVGltZSA+IG5vdyk7CiAgICAgICAgcmVxdWlyZShfY2xvc2luZ1RpbWUgPiBfb3BlbmluZ1RpbWUpOwoKICAgICAgICByZXF1aXJlKF9pbmRleCA+IGN1cnJlbnRTdGFnZSApOwogICAgICAgIHJlcXVpcmUoX2luZGV4IDwgc3RhZ2VzLmxlbmd0aCApOwoKICAgICAgICBzdGFnZXNbX2luZGV4XS5vcGVuaW5nID0gX29wZW5pbmdUaW1lOyAgICAgICAgCiAgICAgICAgc3RhZ2VzW19pbmRleF0uY2xvc2luZyA9IF9jbG9zaW5nVGltZTsgICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIHNldFJhdGUodWludCBfaW5kZXgsIHVpbnQyNTYgX3JhdGUpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2luZGV4ID4gY3VycmVudFN0YWdlICk7CiAgICAgICAgcmVxdWlyZShfaW5kZXggPCBzdGFnZXMubGVuZ3RoICk7CgogICAgICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKCiAgICAgICAgc3RhZ2VzW19pbmRleF0ucmF0ZSA9IF9yYXRlOwogICAgfQoKICAgIAogICAgLy8gcGVybWlzc2lvbgogICAgZnVuY3Rpb24gc2V0QWRtaW4oYWRkcmVzcyBfbmV3QWRtaW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX25ld0FkbWluICE9IGFkZHJlc3MoMHgwKSk7CiAgICAgICAgcmVxdWlyZShfbmV3QWRtaW4gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShfbmV3QWRtaW4gIT0gb3duZXIpOwoKICAgICAgICBhZG1pbiA9IF9uZXdBZG1pbjsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KCiAgICAvLyBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gQUNBVG9rZW5TYWxlKAogICAgICAgIGFkZHJlc3MgX3dhbGxldCwgCiAgICAgICAgdWludDI1NiBfdG90YWxTdXBwbHksCiAgICAgICAgdWludDI1NiBfc29mdENhcCwKICAgICAgICB1aW50MjU2IF9oYXJkQ2FwLAogICAgICAgIGFkZHJlc3MgX2FkbWluKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICAgICAgcmVxdWlyZShfYWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICByZXF1aXJlKF90b3RhbFN1cHBseSA+IDApOwogICAgICAgIHJlcXVpcmUoX3NvZnRDYXAgPiAwKTsKICAgICAgICByZXF1aXJlKF9oYXJkQ2FwID4gX3NvZnRDYXApOwoKICAgICAgICBhZG1pbiA9IF9hZG1pbjsKICAgICAgICB3YWxsZXQgPSBfd2FsbGV0OwoKICAgICAgICB0b3RhbFN1cHBseSA9IF90b3RhbFN1cHBseTsKICAgICAgICBzb2Z0Q2FwID0gX3NvZnRDYXA7CiAgICAgICAgaGFyZENhcCA9IF9oYXJkQ2FwOwoKICAgICAgICBUb2tlblNhbGVDcmVhdGVkKHdhbGxldCwgX3RvdGFsU3VwcGx5KTsKICAgIH0KCiAgICAvLyBzdGF0ZSByZWxhdGVkCiAgICBmdW5jdGlvbiBzZXR1cEJvdW50eSgKICAgICAgICB1aW50MjU2IF9yZWZlcnJhbEFtb3VudCwKICAgICAgICB1aW50MjU2IF9yZWZlcnJhbFJhdGVJbnZpdGVyLAogICAgICAgIHVpbnQyNTYgX3JlZmVycmFsUmF0ZUludml0ZWUsCiAgICAgICAgdWludDI1NiBfYm91bnR5QW1vdW50LAogICAgICAgIHVpbnQyNTYgX3doaXRlbGlzdEJvbnVzQ2xvc2luZ1RpbWUsCiAgICAgICAgdWludDI1NiBfd2hpdGVsaXN0Qm9udXNSYXRlLAogICAgICAgIHVpbnQyNTYgX3doaXRlbGlzdEJvbnVzQW1vdW50CiAgICApIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIAogICAgICAgIHJlcXVpcmUoX3JlZmVycmFsQW1vdW50ID4gMCk7CgogICAgICAgIHJlcXVpcmUoX3JlZmVycmFsUmF0ZUludml0ZXIgPiAwICYmIF9yZWZlcnJhbFJhdGVJbnZpdGVyIDwgMTAwMCk7CiAgICAgICAgcmVxdWlyZShfcmVmZXJyYWxSYXRlSW52aXRlZSA+IDAgJiYgX3JlZmVycmFsUmF0ZUludml0ZWUgPCAxMDAwKTsKCiAgICAgICAgcmVxdWlyZShfd2hpdGVsaXN0Qm9udXNDbG9zaW5nVGltZSA+IG5vdyk7CiAgICAgICAgcmVxdWlyZShfd2hpdGVsaXN0Qm9udXNSYXRlID4gMCk7CiAgICAgICAgcmVxdWlyZShfd2hpdGVsaXN0Qm9udXNBbW91bnQgPiBfd2hpdGVsaXN0Qm9udXNSYXRlKTsKICAgICAgICByZXF1aXJlKF9ib3VudHlBbW91bnQgPiAwKTsKCiAgICAgICAgcmVmZXJyYWxBbW91bnQgPSBfcmVmZXJyYWxBbW91bnQ7CiAgICAgICAgcmVmZXJyYWxSYXRlSW52aXRlciA9IF9yZWZlcnJhbFJhdGVJbnZpdGVyOwogICAgICAgIHJlZmVycmFsUmF0ZUludml0ZWUgPSBfcmVmZXJyYWxSYXRlSW52aXRlZTsKICAgICAgICBib3VudHlBbW91bnQgPSBfYm91bnR5QW1vdW50OwogICAgICAgIHdoaXRlbGlzdEJvbnVzQ2xvc2luZ1RpbWUgPSBfd2hpdGVsaXN0Qm9udXNDbG9zaW5nVGltZTsKICAgICAgICB3aGl0ZWxpc3RCb251c1JhdGUgPSBfd2hpdGVsaXN0Qm9udXNSYXRlOwogICAgICAgIHdoaXRlbGlzdEJvbnVzQW1vdW50ID0gX3doaXRlbGlzdEJvbnVzQW1vdW50OwoKICAgICAgICBCb3VudHlTZXR1cERvbmUoKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZFN0YWdlKAogICAgICAgIHVpbnQyNTYgX29wZW5pbmdUaW1lLCAKICAgICAgICB1aW50MjU2IF9jbG9zaW5nVGltZSwgCiAgICAgICAgdWludDI1NiBfY2FwYWNpdHksIAogICAgICAgIHVpbnQyNTYgX21pbmltdW1XZWksIAogICAgICAgIHVpbnQyNTYgX21heGltdW1XZWksIAogICAgICAgIHVpbnQyNTYgX3JhdGUpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUodG9rZW5TYWxlRW5hYmxlZCA9PSBmYWxzZSk7CgogICAgICAgIHJlcXVpcmUoX29wZW5pbmdUaW1lID4gbm93KTsKICAgICAgICByZXF1aXJlKF9jbG9zaW5nVGltZSA+IF9vcGVuaW5nVGltZSk7CgogICAgICAgIHJlcXVpcmUoX2NhcGFjaXR5ID4gMCk7CiAgICAgICAgcmVxdWlyZShfY2FwYWNpdHkgPCBoYXJkQ2FwKTsKCiAgICAgICAgcmVxdWlyZShfbWluaW11bVdlaSA+IDApOwogICAgICAgIHJlcXVpcmUoX21heGltdW1XZWkgPj0gX21pbmltdW1XZWkpOwoKICAgICAgICByZXF1aXJlKF9yYXRlID4gMCk7CgogICAgICAgIHJlcXVpcmUoX21pbmltdW1XZWkubXVsKF9yYXRlKSA8IF9jYXBhY2l0eSk7CiAgICAgICAgcmVxdWlyZShfbWF4aW11bVdlaS5tdWwoX3JhdGUpIDwgX2NhcGFjaXR5KTsKICAgICAgICBpZiAoIHN0YWdlcy5sZW5ndGggPiAwICkgewogICAgICAgICAgICBTdGFnZUluZm8gbWVtb3J5IHByZXZTdGFnZSA9IHN0YWdlc1tzdGFnZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHJlcXVpcmUoX29wZW5pbmdUaW1lID4gcHJldlN0YWdlLmNsb3NpbmcpOwogICAgICAgIH0KCiAgICAgICAgc3RhZ2VzLnB1c2goU3RhZ2VJbmZvKF9vcGVuaW5nVGltZSwgX2Nsb3NpbmdUaW1lLCBfY2FwYWNpdHksIF9taW5pbXVtV2VpLCBfbWF4aW11bVdlaSwgX3JhdGUsIDApKTsKICAgICAgICBTdGFnZUFkZGVkKF9vcGVuaW5nVGltZSwgX2Nsb3NpbmdUaW1lLCBfY2FwYWNpdHksIF9taW5pbXVtV2VpLCBfbWF4aW11bVdlaSwgX3JhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRva2VuKEFDQVRva2VuIF90b2tlbikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgdG9rZW4gPSBfdG9rZW47CiAgICB9CgogICAgZnVuY3Rpb24gZW5hYmxlVG9rZW5TYWxlKCkgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShzdGFnZXMubGVuZ3RoID4gMCk7CiAgICAgICAgbWF4U3RhZ2UgPSBzdGFnZXMubGVuZ3RoOwoKICAgICAgICB0b2tlblNhbGVFbmFibGVkID0gdHJ1ZTsKCiAgICAgICAgdmF1bHQgPSBuZXcgUmVmdW5kVmF1bHQod2FsbGV0KTsKCiAgICAgICAgVG9rZW5TYWxlRW5hYmxlZCgpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVTdGFnZSgpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZSh0b2tlblNhbGVFbmFibGVkID09IHRydWUpOwogICAgICAgIHJlcXVpcmUoY3VycmVudFN0YWdlIDwgbWF4U3RhZ2UpOwogICAgICAgIHJlcXVpcmUobm93ID49IHN0YWdlc1tjdXJyZW50U3RhZ2VdLm9wZW5pbmcpOwoKICAgICAgICB1aW50MjU2IHJlbWFpbnMgPSBzdGFnZXNbY3VycmVudFN0YWdlXS5jYXBhY2l0eS5zdWIoc3RhZ2VzW2N1cnJlbnRTdGFnZV0uc29sZCk7CiAgICAgICAgaWYgKCBub3cgPiBzdGFnZXNbY3VycmVudFN0YWdlXS5jbG9zaW5nICkgewogICAgICAgICAgICB1aW50MjU2IG5leHRTdGFnZSA9IGN1cnJlbnRTdGFnZS5hZGQoMSk7CiAgICAgICAgICAgIGlmICggcmVtYWlucyA+IDAgJiYgbmV4dFN0YWdlIDwgbWF4U3RhZ2UgKSB7CiAgICAgICAgICAgICAgICBzdGFnZXNbbmV4dFN0YWdlXS5jYXBhY2l0eSA9IHN0YWdlc1tuZXh0U3RhZ2VdLmNhcGFjaXR5LmFkZChyZW1haW5zKTsKICAgICAgICAgICAgICAgIHJlbWFpbnMgPSBzdGFnZXNbbmV4dFN0YWdlXS5jYXBhY2l0eTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3VycmVudFN0YWdlID0gbmV4dFN0YWdlOwogICAgICAgICAgICBTdGFnZVVwZGF0ZWQobmV4dFN0YWdlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZW1haW5zOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXplKCkgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShpc0ZpbmFsaXplZCA9PSBmYWxzZSk7CiAgICAgICAgcmVxdWlyZShpc0Nsb3NlZCgpKTsKCiAgICAgICAgZmluYWxpemF0aW9uKCk7CiAgICAgICAgRmluYWxpemVkKCk7CgogICAgICAgIGlzRmluYWxpemVkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5hbGl6YXRpb24oKSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKGlzR29hbFJlYWNoZWQoKSkgewogICAgICAgICAgICB2YXVsdC5jbG9zZSgpOwogICAgICAgICAgICAvLyB0b2tlbi5zZXRUcmFuc2ZlcmFibGUodHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmF1bHQuZW5hYmxlUmVmdW5kcygpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyB0cmFuc2FjdGlvbgogICAgZnVuY3Rpb24gKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIF9iZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgICAgIHVpbnQyNTYgd2VpQW1vdW50ID0gbXNnLnZhbHVlOwoKICAgICAgICBfcHJlVmFsaWRhdGVQdXJjaGFzZShfYmVuZWZpY2lhcnksIHdlaUFtb3VudCk7CiAgICAgICAgLy8gY2FsY3VsYXRlIHRva2VuIGFtb3VudCB0byBiZSBjcmVhdGVkCiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBfZ2V0VG9rZW5BbW91bnQod2VpQW1vdW50KTsKCiAgICAgICAgLy8gdXBkYXRlIHN0YXRlCiAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwoKICAgICAgICBfcHJvY2Vzc1B1cmNoYXNlKF9iZW5lZmljaWFyeSwgdG9rZW5zKTsKICAgICAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIF9iZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwoKICAgICAgICBfdXBkYXRlUHVyY2hhc2luZ1N0YXRlKF9iZW5lZmljaWFyeSwgd2VpQW1vdW50KTsKCiAgICAgICAgX2ZvcndhcmRGdW5kcygpOwogICAgICAgIF9wb3N0VmFsaWRhdGVQdXJjaGFzZShfYmVuZWZpY2lhcnksIHdlaUFtb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gX2dldFRva2VuQW1vdW50KHVpbnQyNTYgX3dlaUFtb3VudCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIF93ZWlBbW91bnQubXVsKGdldEN1cnJlbnRSYXRlKCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRUb2tlbkFtb3VudFdpdGhvdXRCb251cyh1aW50MjU2IF93ZWlBbW91bnQpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBfd2VpQW1vdW50Lm11bChnZXRSYXRlV2l0aG91dEJvbnVzKCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9wcmVWYWxpZGF0ZVB1cmNoYXNlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF93ZWlBbW91bnQpIGludGVybmFsIGlzVmVyaWZpZWQoX2JlbmVmaWNpYXJ5KSB7CiAgICAgICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfd2VpQW1vdW50ICE9IDApOwoKICAgICAgICByZXF1aXJlKHRva2VuU2FsZUVuYWJsZWQgPT0gdHJ1ZSk7CgogICAgICAgIHJlcXVpcmUobm93ID49IHN0YWdlc1tjdXJyZW50U3RhZ2VdLm9wZW5pbmcpOwoKICAgICAgICAvLyBsYXp5IGV4ZWN1dGlvbgogICAgICAgIHVpbnQyNTYgcmVtYWlucyA9IHVwZGF0ZVN0YWdlKCk7CgogICAgICAgIHJlcXVpcmUoY3VycmVudFN0YWdlIDwgbWF4U3RhZ2UpOwogICAgICAgIHJlcXVpcmUobm93ID49IHN0YWdlc1tjdXJyZW50U3RhZ2VdLm9wZW5pbmcgJiYgbm93IDw9IHN0YWdlc1tjdXJyZW50U3RhZ2VdLmNsb3NpbmcpOwoKICAgICAgICByZXF1aXJlKF93ZWlBbW91bnQgPj0gc3RhZ2VzW2N1cnJlbnRTdGFnZV0ubWluaW11bVdlaSk7CiAgICAgICAgcmVxdWlyZShfd2VpQW1vdW50IDw9IHN0YWdlc1tjdXJyZW50U3RhZ2VdLm1heGltdW1XZWkpOwoKICAgICAgICB1aW50MjU2IGFtb3VudCA9IF9nZXRUb2tlbkFtb3VudChfd2VpQW1vdW50KTsKCiAgICAgICAgcmVxdWlyZShyZW1haW5zID4gYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBfcG9zdFZhbGlkYXRlUHVyY2hhc2UoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3dlaUFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIGlmICggZ2V0Q3VycmVudFNvbGQoKSA9PSBnZXRDdXJyZW50Q2FwYWNpdHkoKSApIHsKICAgICAgICAgICAgY3VycmVudFN0YWdlID0gY3VycmVudFN0YWdlLmFkZCgxKTsKICAgICAgICAgICAgU3RhZ2VVcGRhdGVkKGN1cnJlbnRTdGFnZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9kZWxpdmVyVG9rZW5zKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF90b2tlbkFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIHNhbGVzW19iZW5lZmljaWFyeV0gPSBzYWxlc1tfYmVuZWZpY2lhcnldLmFkZChfdG9rZW5BbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9wcm9jZXNzUHVyY2hhc2UoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3Rva2VuQW1vdW50KSBpbnRlcm5hbCB7CgogICAgICAgIHN0YWdlc1tjdXJyZW50U3RhZ2VdLnNvbGQgPSBzdGFnZXNbY3VycmVudFN0YWdlXS5zb2xkLmFkZChfdG9rZW5BbW91bnQpOwogICAgICAgIF9kZWxpdmVyVG9rZW5zKF9iZW5lZmljaWFyeSwgX3Rva2VuQW1vdW50KTsKCiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgYWRkcmVzcyBpbnZpdGVyID0gcmVmZXJyYWxzW19iZW5lZmljaWFyeV07CiAgICAgICAgaWYgKCBpbnZpdGVyICE9IGFkZHJlc3MoMHgwKSAmJiByZWZlcnJhbERvbmUgPT0gZmFsc2UgKSB7CiAgICAgICAgICAgIHVpbnQyNTYgYmFzZVJhdGUgPSBfZ2V0VG9rZW5BbW91bnQod2VpQW1vdW50KTsvL19nZXRUb2tlbkFtb3VudFdpdGhvdXRCb251cyh3ZWlBbW91bnQpOwogICAgICAgICAgICBMb2dVaW50MjU2KGJhc2VSYXRlKTsKICAgICAgICAgICAgdWludDI1NiByZWZlcnJhbEFtb3VudEludml0ZXIgPSBiYXNlUmF0ZS5kaXYoMTAwKS5tdWwocmVmZXJyYWxSYXRlSW52aXRlcik7CiAgICAgICAgICAgIExvZ1VpbnQyNTYocmVmZXJyYWxBbW91bnRJbnZpdGVyKTsKICAgICAgICAgICAgdWludDI1NiByZWZlcnJhbEFtb3VudEludml0ZWUgPSBiYXNlUmF0ZS5kaXYoMTAwKS5tdWwocmVmZXJyYWxSYXRlSW52aXRlZSk7CiAgICAgICAgICAgIExvZ1VpbnQyNTYocmVmZXJyYWxBbW91bnRJbnZpdGVlKTsKICAgICAgICAgICAgdWludDI1NiByZWZlcnJhbFJlbWFpbnMgPSByZWZlcnJhbEFtb3VudC5zdWIocmVmZXJyYWxTZW50KTsKICAgICAgICAgICAgTG9nVWludDI1NihyZWZlcnJhbFNlbnQpOwogICAgICAgICAgICBMb2dVaW50MjU2KHJlZmVycmFsUmVtYWlucyk7CiAgICAgICAgICAgIGlmICggcmVmZXJyYWxSZW1haW5zID09IDAgKSB7CiAgICAgICAgICAgICAgICByZWZlcnJhbERvbmUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCByZWZlcnJhbEFtb3VudEludml0ZXIgPj0gcmVmZXJyYWxSZW1haW5zICkgewogICAgICAgICAgICAgICAgICAgIHJlZmVycmFsQW1vdW50SW52aXRlciA9IHJlZmVycmFsUmVtYWluczsKICAgICAgICAgICAgICAgICAgICByZWZlcnJhbEFtb3VudEludml0ZWUgPSAwOyAvLyBwcmlvcml0eSB0byBpbnZpdGVyCiAgICAgICAgICAgICAgICAgICAgUmVmZXJyYWxDYXBSZWFjaGVkKCk7CiAgICAgICAgICAgICAgICAgICAgcmVmZXJyYWxEb25lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICggcmVmZXJyYWxEb25lID09IGZhbHNlICYmIHJlZmVycmFsQW1vdW50SW52aXRlciA+PSByZWZlcnJhbFJlbWFpbnMgKSB7CiAgICAgICAgICAgICAgICAgICAgcmVmZXJyYWxBbW91bnRJbnZpdGVlID0gcmVmZXJyYWxSZW1haW5zLnN1YihyZWZlcnJhbEFtb3VudEludml0ZXIpOwogICAgICAgICAgICAgICAgICAgIFJlZmVycmFsQ2FwUmVhY2hlZCgpOwogICAgICAgICAgICAgICAgICAgIHJlZmVycmFsRG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdWludDI1NiByZWZlcnJhbEFtb3VudFRvdGFsID0gcmVmZXJyYWxBbW91bnRJbnZpdGVyLmFkZChyZWZlcnJhbEFtb3VudEludml0ZWUpOwogICAgICAgICAgICAgICAgcmVmZXJyYWxTZW50ID0gcmVmZXJyYWxTZW50LmFkZChyZWZlcnJhbEFtb3VudFRvdGFsKTsKCiAgICAgICAgICAgICAgICBpZiAoIHJlZmVycmFsQW1vdW50SW52aXRlciA+IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgX2RlbGl2ZXJUb2tlbnMoaW52aXRlciwgcmVmZXJyYWxBbW91bnRJbnZpdGVyKTsKICAgICAgICAgICAgICAgICAgICBQdXJjaGFzZVJlZmVycmFsKGludml0ZXIsIHJlZmVycmFsQW1vdW50SW52aXRlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIHJlZmVycmFsQW1vdW50SW52aXRlZSA+IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgX2RlbGl2ZXJUb2tlbnMoX2JlbmVmaWNpYXJ5LCByZWZlcnJhbEFtb3VudEludml0ZWUpOwogICAgICAgICAgICAgICAgICAgIFB1cmNoYXNlUmVmZXJyYWwoX2JlbmVmaWNpYXJ5LCByZWZlcnJhbEFtb3VudEludml0ZWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF91cGRhdGVQdXJjaGFzaW5nU3RhdGUoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3dlaUFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIC8vIG9wdGlvbmFsIG92ZXJyaWRlCiAgICB9CgogICAgZnVuY3Rpb24gX2ZvcndhcmRGdW5kcygpIGludGVybmFsIHsKICAgICAgICB2YXVsdC5kZXBvc2l0LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8gY2xhaW0KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW4oKSBwdWJsaWMgY2xhaW1hYmxlIGlzVmVyaWZpZWQobXNnLnNlbmRlcikgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFkZHJlc3MgYmVuZWZpY2lhcnkgPSBtc2cuc2VuZGVyOwogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gc2FsZXNbYmVuZWZpY2lhcnldOwoKICAgICAgICBUb2tlbkNsYWltZWQoYmVuZWZpY2lhcnksIGFtb3VudCk7CgogICAgICAgIHNhbGVzW2JlbmVmaWNpYXJ5XSA9IDA7CiAgICAgICAgcmV0dXJuIHRva2VuLnRyYW5zZmVyRnJvbShvd25lciwgYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoKSBpc1ZlcmlmaWVkKG1zZy5zZW5kZXIpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShpc0ZpbmFsaXplZCA9PSB0cnVlKTsKICAgICAgICByZXF1aXJlKCFpc0dvYWxSZWFjaGVkKCkpOwoKICAgICAgICB2YXVsdC5yZWZ1bmQobXNnLnNlbmRlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY2xhaW1Cb3VudHlUb2tlbigpIHB1YmxpYyBjbGFpbWFibGUgaXNWZXJpZmllZChtc2cuc2VuZGVyKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWRkcmVzcyBiZW5lZmljaWFyeSA9IG1zZy5zZW5kZXI7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBib3VudGllc1tiZW5lZmljaWFyeV07CgogICAgICAgIFRva2VuQ2xhaW1lZChiZW5lZmljaWFyeSwgYW1vdW50KTsKCiAgICAgICAgYm91bnRpZXNbYmVuZWZpY2lhcnldID0gMDsKICAgICAgICByZXR1cm4gdG9rZW4udHJhbnNmZXJGcm9tKG93bmVyLCBiZW5lZmljaWFyeSwgYW1vdW50KTsKICAgIH0KCiAgICAvLyBib3VudHkKICAgIGZ1bmN0aW9uIGFkZEJvdW50eShhZGRyZXNzIF9hZGRyZXNzLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5QWRtaW4gaXNWZXJpZmllZChfYWRkcmVzcykgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoYm91bnR5QW1vdW50LnN1Yihib3VudHlTZW50KSA+PSBfYW1vdW50KTsKCiAgICAgICAgYm91bnR5U2VudCA9IGJvdW50eVNlbnQuYWRkKF9hbW91bnQpOwogICAgICAgIGJvdW50aWVzW19hZGRyZXNzXSA9IGJvdW50aWVzW19hZGRyZXNzXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgQm91bnR5VXBkYXRlZChfYWRkcmVzcywgdHJ1ZSwgX2Ftb3VudCk7CiAgICB9CiAgICBmdW5jdGlvbiBkZWxCb3VudHkoYWRkcmVzcyBfYWRkcmVzcywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seUFkbWluIGlzVmVyaWZpZWQoX2FkZHJlc3MpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXF1aXJlKGJvdW50aWVzW19hZGRyZXNzXSA+PSBfYW1vdW50KTsKICAgICAgICByZXF1aXJlKF9hbW91bnQgPj0gYm91bnR5U2VudCk7CgogICAgICAgIGJvdW50eVNlbnQgPSBib3VudHlTZW50LnN1YihfYW1vdW50KTsKICAgICAgICBib3VudGllc1tfYWRkcmVzc10gPSBib3VudGllc1tfYWRkcmVzc10uc3ViKF9hbW91bnQpOwogICAgICAgIEJvdW50eVVwZGF0ZWQoX2FkZHJlc3MsIGZhbHNlLCBfYW1vdW50KTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldEJvdW50eUFtb3VudChhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGJvdW50aWVzW19hZGRyZXNzXTsKICAgIH0KCiAgICAvLyByZWZlcnJhbAogICAgZnVuY3Rpb24gYWRkUmVmZXJyYWwoYWRkcmVzcyBfaW52aXRlciwgYWRkcmVzcyBfaW52aXRlZSkgcHVibGljIG9ubHlBZG1pbiBpc1ZlcmlmaWVkKF9pbnZpdGVyKSBpc1ZlcmlmaWVkKF9pbnZpdGVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVmZXJyYWxzW19pbnZpdGVlXSA9IF9pbnZpdGVyOwogICAgfQogICAgZnVuY3Rpb24gZGVsUmVmZXJyYWwoYWRkcmVzcyBfaW52aXRlciwgYWRkcmVzcyBfaW52aXRlZSkgcHVibGljIG9ubHlBZG1pbiBpc1ZlcmlmaWVkKF9pbnZpdGVyKSBpc1ZlcmlmaWVkKF9pbnZpdGVlKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgZGVsZXRlIHJlZmVycmFsc1tfaW52aXRlZV07CiAgICB9CiAgICBmdW5jdGlvbiBnZXRSZWZlcnJhbChhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIHJlZmVycmFsc1tfYWRkcmVzc107CiAgICB9CgogICAgLy8gd2hpdGVsaXN0CiAgICBmdW5jdGlvbiBfZGVsaXZlcldoaXRlbGlzdEJvbnVzKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBpbnRlcm5hbCB7CiAgICAgICAgaWYgKCBfYmVuZWZpY2lhcnkgPT0gYWRkcmVzcygweDApICkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIHdoaXRlbGlzdEJvbnVzW19iZW5lZmljaWFyeV0gPT0gdHJ1ZSApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAod2hpdGVsaXN0Qm9udXNBbW91bnQuc3ViKHdoaXRlbGlzdEJvbnVzU2VudCkgPiB3aGl0ZWxpc3RCb251c1JhdGUgKSB7CiAgICAgICAgICAgIHdoaXRlbGlzdEJvbnVzW19iZW5lZmljaWFyeV0gPSB0cnVlOwoKICAgICAgICAgICAgd2hpdGVsaXN0Qm9udXNTZW50ID0gd2hpdGVsaXN0Qm9udXNTZW50LmFkZCh3aGl0ZWxpc3RCb251c1JhdGUpOwogICAgICAgICAgICBib3VudGllc1tfYmVuZWZpY2lhcnldID0gYm91bnRpZXNbX2JlbmVmaWNpYXJ5XS5hZGQod2hpdGVsaXN0Qm9udXNSYXRlKTsKICAgICAgICAgICAgQm91bnR5VXBkYXRlZChfYmVuZWZpY2lhcnksIHRydWUsIHdoaXRlbGlzdEJvbnVzUmF0ZSk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaXNBY2NvdW50V2hpdGVsaXN0ZWQoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gd2hpdGVsaXN0W19iZW5lZmljaWFyeV07CiAgICB9CgogICAgZnVuY3Rpb24gYWRkVG9XaGl0ZWxpc3QoYWRkcmVzcyBfYmVuZWZpY2lhcnkpIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgd2hpdGVsaXN0W19iZW5lZmljaWFyeV0gPSB0cnVlOwoKICAgICAgICBpZiAoIHdoaXRlbGlzdEJvbnVzW19iZW5lZmljaWFyeV0gPT0gZmFsc2UgJiYgbm93IDwgd2hpdGVsaXN0Qm9udXNDbG9zaW5nVGltZSApIHsKICAgICAgICAgICAgX2RlbGl2ZXJXaGl0ZWxpc3RCb251cyhfYmVuZWZpY2lhcnkpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhZGRNYW55VG9XaGl0ZWxpc3QoYWRkcmVzc1tdIF9iZW5lZmljaWFyaWVzKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIHVpbnQyNTYgaSA9IDA7CiAgICAgICAgaWYgKCBub3cgPCB3aGl0ZWxpc3RCb251c0Nsb3NpbmdUaW1lICkgewogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JlbmVmaWNpYXJpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHdoaXRlbGlzdFtfYmVuZWZpY2lhcmllc1tpXV0gPSB0cnVlOwogICAgICAgICAgICAgICAgX2RlbGl2ZXJXaGl0ZWxpc3RCb251cyhfYmVuZWZpY2lhcmllc1tpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZW5lZmljaWFyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHdoaXRlbGlzdFtfYmVuZWZpY2lhcmllc1tpXV0gPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVGcm9tV2hpdGVsaXN0KGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIHdoaXRlbGlzdFtfYmVuZWZpY2lhcnldID0gZmFsc2U7CiAgICB9CgogICAgLy8ga3ljCiAgICBmdW5jdGlvbiBpc0FjY291bnRWZXJpZmllZChhZGRyZXNzIF9iZW5lZmljaWFyeSkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBreWNsaXN0W19iZW5lZmljaWFyeV07CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QWNjb3VudFZlcmlmaWVkKGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIGt5Y2xpc3RbX2JlbmVmaWNpYXJ5XSA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0TWFueUFjY291bnRzVmVyaWZpZWQoYWRkcmVzc1tdIF9iZW5lZmljaWFyaWVzKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9iZW5lZmljaWFyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGt5Y2xpc3RbX2JlbmVmaWNpYXJpZXNbaV1dID0gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdW52ZXJpZnlBY2NvdW50KGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIGt5Y2xpc3RbX2JlbmVmaWNpYXJ5XSA9IGZhbHNlOwogICAgfQp9'.
	

]
