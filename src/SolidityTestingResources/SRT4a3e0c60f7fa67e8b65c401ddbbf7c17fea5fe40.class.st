Class {
	#name : #SRT4a3e0c60f7fa67e8b65c401ddbbf7c17fea5fe40,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT4a3e0c60f7fa67e8b65c401ddbbf7c17fea5fe40 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjE7Cgpjb250cmFjdCBPcmFjbGl6ZUkgewogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSBwdWJsaWMgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHB1YmxpYyByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcHVibGljIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOwp9CmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgewogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsKICAgIHVpbnQgY29uc3RhbnQgd2VlayA9IDYwKjYwKjI0Kjc7CiAgICB1aW50IGNvbnN0YW50IG1vbnRoID0gNjAqNjAqMjQqMzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX1RMU05vdGFyeSA9IDB4MTA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9BbmRyb2lkID0gMHgyMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0xlZGdlciA9IDB4MzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OYXRpdmUgPSAweEYwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7CgogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKCiAgICBPcmFjbGl6ZUkgb3JhY2xpemU7CiAgICBtb2RpZmllciBvcmFjbGl6ZUFQSSB7CiAgICAgICAgaWYoKGFkZHJlc3MoT0FSKT09MCl8fChnZXRDb2RlU2l6ZShhZGRyZXNzKE9BUikpPT0wKSkKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CgogICAgICAgIGlmKGFkZHJlc3Mob3JhY2xpemUpICE9IE9BUi5nZXRBZGRyZXNzKCkpCiAgICAgICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwoKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpewogICAgICByZXR1cm4gb3JhY2xpemVfc2V0TmV0d29yaygpOwogICAgICBuZXR3b3JrSUQ7IC8vIHNpbGVuY2UgdGhlIHdhcm5pbmcgYW5kIHJlbWFpbiBiYWNrd2FyZHMgY29tcGF0aWJsZQogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yaygpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk+MCl7IC8vbWFpbm5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9tYWlubmV0Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKT4wKXsgLy9yb3BzdGVuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcm9wc3RlbjMiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpPjApeyAvL2tvdmFuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpPjApeyAvL3JpbmtlYnkgdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yaW5rZWJ5Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KT4wKXsgLy9ldGhlcmV1bS1icmlkZ2UKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKT4wKXsgLy9ldGhlci5jYW1wIGlkZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQpIHB1YmxpYyB7CiAgICAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQsIG5ldyBieXRlcygwKSk7CiAgICB9CiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHB1YmxpYyB7CiAgICAgIHJldHVybjsKICAgICAgbXlpZDsgcmVzdWx0OyBwcm9vZjsgLy8gU2lsZW5jZSBjb21waWxlciB3YXJuaW5ncwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50MTYwIGlhZGRyID0gMDsKICAgICAgICB1aW50MTYwIGIxOwogICAgICAgIHVpbnQxNjAgYjI7CiAgICAgICAgZm9yICh1aW50IGk9MjsgaTwyKzIqMjA7IGkrPTIpewogICAgICAgICAgICBpYWRkciAqPSAyNTY7CiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOwogICAgICAgICAgICBiMiA9IHVpbnQxNjAodG1wW2krMV0pOwogICAgICAgICAgICBpZiAoKGIxID49IDk3KSYmKGIxIDw9IDEwMikpIGIxIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNjUpJiYoYjEgPD0gNzApKSBiMSAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSYmKGIxIDw9IDU3KSkgYjEgLT0gNDg7CiAgICAgICAgICAgIGlmICgoYjIgPj0gOTcpJiYoYjIgPD0gMTAyKSkgYjIgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA2NSkmJihiMiA8PSA3MCkpIGIyIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNDgpJiYoYjIgPD0gNTcpKSBiMiAtPSA0ODsKICAgICAgICAgICAgaWFkZHIgKz0gKGIxKjE2K2IyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoaWFkZHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykKICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChhLmxlbmd0aCA8IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JiID0gYnl0ZXMoX2IpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmMgPSBieXRlcyhfYyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZCA9IGJ5dGVzKF9kKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JlID0gYnl0ZXMoX2UpOwogICAgICAgIHN0cmluZyBtZW1vcnkgYWJjZGUgPSBuZXcgc3RyaW5nKF9iYS5sZW5ndGggKyBfYmIubGVuZ3RoICsgX2JjLmxlbmd0aCArIF9iZC5sZW5ndGggKyBfYmUubGVuZ3RoKTsKICAgICAgICBieXRlcyBtZW1vcnkgYmFiY2RlID0gYnl0ZXMoYWJjZGUpOwogICAgICAgIHVpbnQgayA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2JhLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYVtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JiLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYltpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JjLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iY1tpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JkLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZFtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JlLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZVtpXTsKICAgICAgICByZXR1cm4gc3RyaW5nKGJhYmNkZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7CiAgICB9CgogICAgLy8gcGFyc2VJbnQKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOwogICAgICAgIHVpbnQgaiA9IGk7CiAgICAgICAgdWludCBsZW47CiAgICAgICAgd2hpbGUgKGogIT0gMCl7CiAgICAgICAgICAgIGxlbisrOwogICAgICAgICAgICBqIC89IDEwOwogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYnN0ciA9IG5ldyBieXRlcyhsZW4pOwogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7CiAgICAgICAgd2hpbGUgKGkgIT0gMCl7CiAgICAgICAgICAgIGJzdHJbay0tXSA9IGJ5dGUoNDggKyBpICUgMTApOwogICAgICAgICAgICBpIC89IDEwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nKGJzdHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0cmEyY2JvcihzdHJpbmdbXSBhcnIpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgoKICAgIHN0cmluZyBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZShzdHJpbmcgX25ldHdvcmtfbmFtZSkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX25ldHdvcmtfbmFtZSA9IF9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfbmV3UmFuZG9tRFNRdWVyeSh1aW50IF9kZWxheSwgdWludCBfbmJ5dGVzLCB1aW50IF9jdXN0b21HYXNMaW1pdCkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7CiAgICAgICAgcmVxdWlyZSgoX25ieXRlcyA+IDApICYmIChfbmJ5dGVzIDw9IDMyKSk7CiAgICAgICAgLy8gQ29udmVydCBmcm9tIHNlY29uZHMgdG8gbGVkZ2VyIHRpbWVyIHRpY2tzCiAgICAgICAgX2RlbGF5ICo9IDEwOyAKICAgICAgICBieXRlcyBtZW1vcnkgbmJ5dGVzID0gbmV3IGJ5dGVzKDEpOwogICAgICAgIG5ieXRlc1swXSA9IGJ5dGUoX25ieXRlcyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHVub25jZSA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25LZXlIYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlczMyIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIgPSBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbXN0b3JlKHVub25jZSwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZCh1bm9uY2UsIDB4MjApLCB4b3IoYmxvY2toYXNoKHN1YihudW1iZXIsIDEpKSwgeG9yKGNvaW5iYXNlLCB0aW1lc3RhbXApKSkKICAgICAgICAgICAgbXN0b3JlKHNlc3Npb25LZXlIYXNoLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNlc3Npb25LZXlIYXNoLCAweDIwKSwgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMikKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGRlbGF5ID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBhc3NlbWJseSB7IAogICAgICAgICAgICBtc3RvcmUoYWRkKGRlbGF5LCAweDIwKSwgX2RlbGF5KSAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYnl0ZXMgbWVtb3J5IGRlbGF5X2J5dGVzOCA9IG5ldyBieXRlcyg4KTsKICAgICAgICBjb3B5Qnl0ZXMoZGVsYXksIDI0LCA4LCBkZWxheV9ieXRlczgsIDApOwoKICAgICAgICBieXRlc1s0XSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2gsIGRlbGF5XTsKICAgICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeSgicmFuZG9tIiwgYXJncywgX2N1c3RvbUdhc0xpbWl0KTsKICAgICAgICAKICAgICAgICBieXRlcyBtZW1vcnkgZGVsYXlfYnl0ZXM4X2xlZnQgPSBuZXcgYnl0ZXMoOCk7CiAgICAgICAgCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgeCA6PSBtbG9hZChhZGQoZGVsYXlfYnl0ZXM4LCAweDIwKSkKICAgICAgICAgICAgbXN0b3JlOChhZGQoZGVsYXlfYnl0ZXM4X2xlZnQsIDB4MjcpLCBkaXYoeCwgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyNiksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyNSksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICAgICAgbXN0b3JlOChhZGQoZGVsYXlfYnl0ZXM4X2xlZnQsIDB4MjQpLCBkaXYoeCwgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyMyksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyMiksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSkKICAgICAgICAgICAgbXN0b3JlOChhZGQoZGVsYXlfYnl0ZXM4X2xlZnQsIDB4MjEpLCBkaXYoeCwgMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQogICAgICAgICAgICBtc3RvcmU4KGFkZChkZWxheV9ieXRlczhfbGVmdCwgMHgyMCksIGRpdih4LCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApKQoKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBrZWNjYWsyNTYoZGVsYXlfYnl0ZXM4X2xlZnQsIGFyZ3NbMV0sIHNoYTI1NihhcmdzWzBdKSwgYXJnc1syXSkpOwogICAgICAgIHJldHVybiBxdWVyeUlkOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9IGNvbW1pdG1lbnQ7CiAgICB9CgogICAgbWFwcGluZyhieXRlczMyPT5ieXRlczMyKSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzOwogICAgbWFwcGluZyhieXRlczMyPT5ib29sKSBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZDsKCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWcoYnl0ZXMzMiB0b3NpZ25oLCBieXRlcyBkZXJzaWcsIGJ5dGVzIHB1YmtleSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBzaWdvazsKICAgICAgICBhZGRyZXNzIHNpZ25lcjsKCiAgICAgICAgYnl0ZXMzMiBzaWdyOwogICAgICAgIGJ5dGVzMzIgc2lnczsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3JfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IG9mZnNldCA9IDQrKHVpbnQoZGVyc2lnWzNdKSAtIDB4MjApOwogICAgICAgIHNpZ3JfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0LCAzMiwgc2lncl8sIDApOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdzXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgb2Zmc2V0ICs9IDMyICsgMjsKICAgICAgICBzaWdzXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCsodWludChkZXJzaWdbb2Zmc2V0LTFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpZ3IgOj0gbWxvYWQoYWRkKHNpZ3JfLCAzMikpCiAgICAgICAgICAgIHNpZ3MgOj0gbWxvYWQoYWRkKHNpZ3NfLCAzMikpCiAgICAgICAgfQoKCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsKICAgICAgICBpZiAoYWRkcmVzcyhrZWNjYWsyNTYocHVia2V5KSkgPT0gc2lnbmVyKSByZXR1cm4gdHJ1ZTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI4LCBzaWdyLCBzaWdzKTsKICAgICAgICAgICAgcmV0dXJuIChhZGRyZXNzKGtlY2NhazI1NihwdWJrZXkpKSA9PSBzaWduZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KGJ5dGVzIHByb29mLCB1aW50IHNpZzJvZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBib29sIHNpZ29rOwoKICAgICAgICAvLyBTdGVwIDY6IHZlcmlmeSB0aGUgYXR0ZXN0YXRpb24gc2lnbmF0dXJlLCBBUFBLRVkxIG11c3Qgc2lnbiB0aGUgc2Vzc2lvbktleSBmcm9tIHRoZSBjb3JyZWN0IGxlZGdlciBhcHAgKENPREVIQVNIKQogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcyID0gbmV3IGJ5dGVzKHVpbnQocHJvb2Zbc2lnMm9mZnNldCsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LCBzaWcyLmxlbmd0aCwgc2lnMiwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBhcHBrZXkxX3B1YmtleSA9IG5ldyBieXRlcyg2NCk7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzEsIDY0LCBhcHBrZXkxX3B1YmtleSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24yID0gbmV3IGJ5dGVzKDErNjUrMzIpOwogICAgICAgIHRvc2lnbjJbMF0gPSBieXRlKDEpOyAvL3JvbGUKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjUsIDY1LCB0b3NpZ24yLCAxKTsKICAgICAgICBieXRlcyBtZW1vcnkgQ09ERUhBU0ggPSBoZXgiZmQ5NGZhNzFiYzBiYTEwZDM5ZDQ2NGQwZDhmNDY1ZWZlZWYwYTI3NjRlMzg4N2ZjYzlkZjQxZGVkMjBmNTA1YyI7CiAgICAgICAgY29weUJ5dGVzKENPREVIQVNILCAwLCAzMiwgdG9zaWduMiwgMSs2NSk7CiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjIpLCBzaWcyLCBhcHBrZXkxX3B1YmtleSk7CgogICAgICAgIGlmIChzaWdvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA3OiB2ZXJpZnkgdGhlIEFQUEtFWTEgcHJvdmVuYW5jZSAobXVzdCBiZSBzaWduZWQgYnkgTGVkZ2VyKQogICAgICAgIGJ5dGVzIG1lbW9yeSBMRURHRVJLRVkgPSBoZXgiN2ZiOTU2NDY5YzVjOWI4OTg0MGQ1NWI0MzUzN2U2NmE5OGRkNDgxMWVhMGEyNzIyNDI3MmMyZTU2MjI5MTFlODUzN2EyZjhlODZhNDZiYWVjODI4NjRlOThkZDAxZTljY2MyZjhiYzVkZmM5Y2JlNWE5MWEyOTA0OThkZDk2ZTQiOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMyA9IG5ldyBieXRlcygxKzY1KTsKICAgICAgICB0b3NpZ24zWzBdID0gMHhGRTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMsIDY1LCB0b3NpZ24zLCAxKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzMgPSBuZXcgYnl0ZXModWludChwcm9vZlszKzY1KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrNjUsIHNpZzMubGVuZ3RoLCBzaWczLCAwKTsKCiAgICAgICAgc2lnb2sgPSB2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjMpLCBzaWczLCBMRURHRVJLRVkpOwoKICAgICAgICByZXR1cm4gc2lnb2s7CiAgICB9CgogICAgbW9kaWZpZXIgb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnkoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgcmVxdWlyZSgoX3Byb29mWzBdID09ICJMIikgJiYgKF9wcm9vZlsxXSA9PSAiUCIpICYmIChfcHJvb2ZbMl0gPT0gMSkpOwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgcmVxdWlyZShwcm9vZlZlcmlmaWVkKTsKCiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fcmV0dXJuQ29kZShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSBpbnRlcm5hbCByZXR1cm5zICh1aW50OCl7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHJldHVybiAxOwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHJldHVybiAyOwoKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXRjaEJ5dGVzMzJQcmVmaXgoYnl0ZXMzMiBjb250ZW50LCBieXRlcyBwcmVmaXgsIHVpbnQgbl9yYW5kb21fYnl0ZXMpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBtYXRjaF8gPSB0cnVlOwogICAgICAgIAogICAgICAgIHJlcXVpcmUocHJlZml4Lmxlbmd0aCA9PSBuX3JhbmRvbV9ieXRlcyk7CgogICAgICAgIGZvciAodWludDI1NiBpPTA7IGk8IG5fcmFuZG9tX2J5dGVzOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbnRlbnRbaV0gIT0gcHJlZml4W2ldKSBtYXRjaF8gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMys2NSsodWludChwcm9vZlszKzY1KzFdKSsyKSszMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGlmICghKGtlY2NhazI1NihrZXloYXNoKSA9PSBrZWNjYWsyNTYoc2hhMjU2KGNvbnRleHRfbmFtZSwgcXVlcnlJZCkpKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMSA9IG5ldyBieXRlcyh1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpKzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoKygzMis4KzErMzIpLCBzaWcxLmxlbmd0aCwgc2lnMSwgMCk7CgogICAgICAgIC8vIFN0ZXAgMzogd2UgYXNzdW1lIHNpZzEgaXMgdmFsaWQgKGl0IHdpbGwgYmUgdmVyaWZpZWQgZHVyaW5nIHN0ZXAgNSkgYW5kIHdlIHZlcmlmeSBpZiAncmVzdWx0JyBpcyB0aGUgcHJlZml4IG9mIHNoYTI1NihzaWcxKQogICAgICAgIGlmICghbWF0Y2hCeXRlczMyUHJlZml4KHNoYTI1NihzaWcxKSwgcmVzdWx0LCB1aW50KHByb29mW2xlZGdlclByb29mTGVuZ3RoKzMyKzhdKSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gU3RlcCA0OiBjb21taXRtZW50IG1hdGNoIHZlcmlmaWNhdGlvbiwga2VjY2FrMjU2KGRlbGF5LCBuYnl0ZXMsIHVub25jZSwgc2Vzc2lvbktleUhhc2gpID09IGNvbW1pdG1lbnQgaW4gc3RvcmFnZS4KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4KICAgICAgICBieXRlcyBtZW1vcnkgY29tbWl0bWVudFNsaWNlMSA9IG5ldyBieXRlcyg4KzErMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrMzIsIDgrMSszMiwgY29tbWl0bWVudFNsaWNlMSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uUHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICB1aW50IHNpZzJvZmZzZXQgPSBsZWRnZXJQcm9vZkxlbmd0aCszMisoOCsxKzMyKStzaWcxLmxlbmd0aCs2NTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjQsIDY0LCBzZXNzaW9uUHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uUHVia2V5SGFzaCA9IHNoYTI1NihzZXNzaW9uUHVia2V5KTsKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9PSBrZWNjYWsyNTYoY29tbWl0bWVudFNsaWNlMSwgc2Vzc2lvblB1YmtleUhhc2gpKXsgLy91bm9uY2UsIG5ieXRlcyBhbmQgc2Vzc2lvbktleUhhc2ggbWF0Y2gKICAgICAgICAgICAgZGVsZXRlIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF07CiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNTogdmFsaWRpdHkgdmVyaWZpY2F0aW9uIGZvciBzaWcxIChrZXloYXNoIGFuZCBhcmdzIHNpZ25lZCB3aXRoIHRoZSBzZXNzaW9uS2V5KQogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24xID0gbmV3IGJ5dGVzKDMyKzgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIrOCsxKzMyLCB0b3NpZ24xLCAwKTsKICAgICAgICBpZiAoIXZlcmlmeVNpZyhzaGEyNTYodG9zaWduMSksIHNpZzEsIHNlc3Npb25QdWJrZXkpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIC8vIHZlcmlmeSBpZiBzZXNzaW9uUHVia2V5SGFzaCB3YXMgdmVyaWZpZWQgYWxyZWFkeSwgaWYgbm90Li4gbGV0J3MgZG8gaXQhCiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9PSBmYWxzZSl7CiAgICAgICAgICAgIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXSA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkocHJvb2YsIHNpZzJvZmZzZXQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3JhbmRvbURTX3Nlc3Npb25LZXlzSGFzaFZlcmlmaWVkW3Nlc3Npb25QdWJrZXlIYXNoXTsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgZnVuY3Rpb24gY29weUJ5dGVzKGJ5dGVzIGZyb20sIHVpbnQgZnJvbU9mZnNldCwgdWludCBsZW5ndGgsIGJ5dGVzIHRvLCB1aW50IHRvT2Zmc2V0KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgLy8gQnVmZmVyIHRvbyBzbWFsbAogICAgICAgIHJlcXVpcmUodG8ubGVuZ3RoID49IG1pbkxlbmd0aCk7IC8vIFNob3VsZCBiZSBhIGJldHRlciB3YXk/CgogICAgICAgIC8vIE5PVEU6IHRoZSBvZmZzZXQgMzIgaXMgYWRkZWQgdG8gc2tpcCB0aGUgYHNpemVgIGZpZWxkIG9mIGJvdGggYnl0ZXMgdmFyaWFibGVzCiAgICAgICAgdWludCBpID0gMzIgKyBmcm9tT2Zmc2V0OwogICAgICAgIHVpbnQgaiA9IDMyICsgdG9PZmZzZXQ7CgogICAgICAgIHdoaWxlIChpIDwgKDMyICsgZnJvbU9mZnNldCArIGxlbmd0aCkpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IHRtcCA6PSBtbG9hZChhZGQoZnJvbSwgaSkpCiAgICAgICAgICAgICAgICBtc3RvcmUoYWRkKHRvLCBqKSwgdG1wKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMzI7CiAgICAgICAgICAgIGogKz0gMzI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdG87CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIC8vIER1cGxpY2F0ZSBTb2xpZGl0eSdzIGVjcmVjb3ZlciwgYnV0IGNhdGNoaW5nIHRoZSBDQUxMIHJldHVybiB2YWx1ZQogICAgZnVuY3Rpb24gc2FmZXJfZWNyZWNvdmVyKGJ5dGVzMzIgaGFzaCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICAvLyBXZSBkbyBvdXIgb3duIG1lbW9yeSBtYW5hZ2VtZW50IGhlcmUuIFNvbGlkaXR5IHVzZXMgbWVtb3J5IG9mZnNldAogICAgICAgIC8vIDB4NDAgdG8gc3RvcmUgdGhlIGN1cnJlbnQgZW5kIG9mIG1lbW9yeS4gV2Ugd3JpdGUgcGFzdCBpdCAoYXMKICAgICAgICAvLyB3cml0ZXMgYXJlIG1lbW9yeSBleHRlbnNpb25zKSwgYnV0IGRvbid0IHVwZGF0ZSB0aGUgb2Zmc2V0IHNvCiAgICAgICAgLy8gU29saWRpdHkgd2lsbCByZXVzZSBpdC4gVGhlIG1lbW9yeSB1c2VkIGhlcmUgaXMgb25seSBuZWVkZWQgZm9yCiAgICAgICAgLy8gdGhpcyBjb250ZXh0LgoKICAgICAgICAvLyBGSVhNRTogaW5saW5lIGFzc2VtYmx5IGNhbid0IGFjY2VzcyByZXR1cm4gdmFsdWVzCiAgICAgICAgYm9vbCByZXQ7CiAgICAgICAgYWRkcmVzcyBhZGRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBzaXplIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIG1zdG9yZShzaXplLCBoYXNoKQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDMyKSwgdikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA2NCksIHIpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgOTYpLCBzKQoKICAgICAgICAgICAgLy8gTk9URTogd2UgY2FuIHJldXNlIHRoZSByZXF1ZXN0IG1lbW9yeSBiZWNhdXNlIHdlIGRlYWwgd2l0aAogICAgICAgICAgICAvLyAgICAgICB0aGUgcmV0dXJuIGNvZGUKICAgICAgICAgICAgcmV0IDo9IGNhbGwoMzAwMCwgMSwgMCwgc2l6ZSwgMTI4LCBzaXplLCAzMikKICAgICAgICAgICAgYWRkciA6PSBtbG9hZChzaXplKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChyZXQsIGFkZHIpOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBlY3JlY292ZXJ5KGJ5dGVzMzIgaGFzaCwgYnl0ZXMgc2lnKSBpbnRlcm5hbCByZXR1cm5zIChib29sLCBhZGRyZXNzKSB7CiAgICAgICAgYnl0ZXMzMiByOwogICAgICAgIGJ5dGVzMzIgczsKICAgICAgICB1aW50OCB2OwoKICAgICAgICBpZiAoc2lnLmxlbmd0aCAhPSA2NSkKICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICAvLyBUaGUgc2lnbmF0dXJlIGZvcm1hdCBpcyBhIGNvbXBhY3QgZm9ybSBvZjoKICAgICAgICAvLyAgIHtieXRlczMyIHJ9e2J5dGVzMzIgc317dWludDggdn0KICAgICAgICAvLyBDb21wYWN0IG1lYW5zLCB1aW50OCBpcyBub3QgcGFkZGVkIHRvIDMyIGJ5dGVzLgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQoKICAgICAgICAgICAgLy8gSGVyZSB3ZSBhcmUgbG9hZGluZyB0aGUgbGFzdCAzMiBieXRlcy4gV2UgZXhwbG9pdCB0aGUgZmFjdCB0aGF0CiAgICAgICAgICAgIC8vICdtbG9hZCcgd2lsbCBwYWQgd2l0aCB6ZXJvZXMgaWYgd2Ugb3ZlcnJlYWQuCiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vICdtbG9hZDgnIHRvIGRvIHRoaXMsIGJ1dCB0aGF0IHdvdWxkIGJlIG5pY2VyLgogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKCiAgICAgICAgICAgIC8vIEFsdGVybmF0aXZlIHNvbHV0aW9uOgogICAgICAgICAgICAvLyAnYnl0ZScgaXMgbm90IHdvcmtpbmcgZHVlIHRvIHRoZSBTb2xpZGl0eSBwYXJzZXIsIHNvIGxldHMKICAgICAgICAgICAgLy8gdXNlIHRoZSBzZWNvbmQgYmVzdCBvcHRpb24sICdhbmQnCiAgICAgICAgICAgIC8vIHYgOj0gYW5kKG1sb2FkKGFkZChzaWcsIDY1KSksIDI1NSkKICAgICAgICB9CgogICAgICAgIC8vIGFsYmVpdCBub24tdHJhbnNhY3Rpb25hbCBzaWduYXR1cmVzIGFyZSBub3Qgc3BlY2lmaWVkIGJ5IHRoZSBZUCwgb25lIHdvdWxkIGV4cGVjdCBpdAogICAgICAgIC8vIHRvIG1hdGNoIHRoZSBZUCByYW5nZSBvZiBbMjcsIDI4XQogICAgICAgIC8vCiAgICAgICAgLy8gZ2V0aCB1c2VzIFswLCAxXSBhbmQgc29tZSBjbGllbnRzIGhhdmUgZm9sbG93ZWQuIFRoaXMgbWlnaHQgY2hhbmdlLCBzZWU6CiAgICAgICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9nby1ldGhlcmV1bS9pc3N1ZXMvMjA1MwogICAgICAgIGlmICh2IDwgMjcpCiAgICAgICAgICB2ICs9IDI3OwoKICAgICAgICBpZiAodiAhPSAyNyAmJiB2ICE9IDI4KQogICAgICAgICAgICByZXR1cm4gKGZhbHNlLCAwKTsKCiAgICAgICAgcmV0dXJuIHNhZmVyX2VjcmVjb3ZlcihoYXNoLCB2LCByLCBzKTsKICAgIH0KCn0KLy8gPC9PUkFDTElaRV9BUEk+Cgpjb250cmFjdCBFT1NCZXRHYW1lSW50ZXJmYWNlIHsKCXVpbnQyNTYgcHVibGljIERFVkVMT1BFUlNGVU5EOwoJdWludDI1NiBwdWJsaWMgTElBQklMSVRJRVM7CglmdW5jdGlvbiBwYXlEZXZlbG9wZXJzRnVuZChhZGRyZXNzIGRldmVsb3BlcikgcHVibGljOwoJZnVuY3Rpb24gcmVjZWl2ZVBheW1lbnRGb3JPcmFjbGl6ZSgpIHBheWFibGUgcHVibGljOwoJZnVuY3Rpb24gZ2V0TWF4V2luKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2KTsKfQoKY29udHJhY3QgRU9TQmV0QmFua3JvbGxJbnRlcmZhY2UgewoJZnVuY3Rpb24gcGF5RXRoZXJUb1dpbm5lcih1aW50MjU2IGFtdEV0aGVyLCBhZGRyZXNzIHdpbm5lcikgcHVibGljOwoJZnVuY3Rpb24gcmVjZWl2ZUV0aGVyRnJvbUdhbWVBZGRyZXNzKCkgcGF5YWJsZSBwdWJsaWM7CglmdW5jdGlvbiBwYXlPcmFjbGl6ZSh1aW50MjU2IGFtb3VudFRvUGF5KSBwdWJsaWM7CglmdW5jdGlvbiBnZXRCYW5rcm9sbCgpIHB1YmxpYyB2aWV3IHJldHVybnModWludDI1Nik7Cn0KCmNvbnRyYWN0IEVSQzIwIHsKCWZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgc3VwcGx5KTsKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoJZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CglmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCWZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKCWV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludCBfdmFsdWUpOwoJZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50IF92YWx1ZSk7Cn0KCmNvbnRyYWN0IEVPU0JldEJhbmtyb2xsIGlzIEVSQzIwLCBFT1NCZXRCYW5rcm9sbEludGVyZmFjZSB7CgoJdXNpbmcgU2FmZU1hdGggZm9yICo7CgoJLy8gY29uc3RhbnRzIGZvciBFT1NCZXQgQmFua3JvbGwKCglhZGRyZXNzIHB1YmxpYyBPV05FUjsKCXVpbnQyNTYgcHVibGljIE1BWElNVU1JTlZFU1RNRU5UU0FMTE9XRUQ7Cgl1aW50MjU2IHB1YmxpYyBXQUlUVElNRVVOVElMV0lUSERSQVdPUlRSQU5TRkVSOwoJdWludDI1NiBwdWJsaWMgREVWRUxPUEVSU0ZVTkQ7CgoJLy8gdGhpcyB3aWxsIGJlIGluaXRpYWxpemVkIGFzIHRoZSB0cnVzdGVkIGdhbWUgYWRkcmVzc2VzIHdoaWNoIHdpbGwgZm9yd2FyZCB0aGVpciBldGhlcgoJLy8gdG8gdGhlIGJhbmtyb2xsIGNvbnRyYWN0LCBhbmQgd2hlbiBwbGF5ZXJzIHdpbiwgdGhleSB3aWxsIHJlcXVlc3QgdGhlIGJhbmtyb2xsIGNvbnRyYWN0IAoJLy8gdG8gc2VuZCB0aGVzZSBwbGF5ZXJzIHRoZWlyIHdpbm5pbmdzLgoJLy8gRmVlbCBmcmVlIHRvIGF1ZGl0IHRoZXNlIGNvbnRyYWN0cyBvbiBldGhlcnNjYW4uLi4KCW1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgVFJVU1RFREFERFJFU1NFUzsKCglhZGRyZXNzIHB1YmxpYyBESUNFOwoJYWRkcmVzcyBwdWJsaWMgU0xPVFM7CgoJLy8gbWFwcGluZyB0byBsb2cgdGhlIGxhc3QgdGltZSBhIHVzZXIgY29udHJpYnV0ZWQgdG8gdGhlIGJhbmtyb2xsIAoJbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGNvbnRyaWJ1dGlvblRpbWU7CgoJLy8gY29uc3RhbnRzIGZvciBFUkMyMCBzdGFuZGFyZAoJc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkVPU0JldCBTdGFrZSBUb2tlbnMiOwoJc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiRU9TQkVUU1QiOwoJdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTg7CgkvLyB2YXJpYWJsZSB0b3RhbCBzdXBwbHkKCXVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKCS8vIG1hcHBpbmcgdG8gc3RvcmUgdG9rZW5zCgltYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGJhbGFuY2VzOwoJbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSkgcHVibGljIGFsbG93ZWQ7CgoJLy8gZXZlbnRzCglldmVudCBGdW5kQmFua3JvbGwoYWRkcmVzcyBjb250cmlidXRvciwgdWludDI1NiBldGhlckNvbnRyaWJ1dGVkLCB1aW50MjU2IHRva2Vuc1JlY2VpdmVkKTsKCWV2ZW50IENhc2hPdXQoYWRkcmVzcyBjb250cmlidXRvciwgdWludDI1NiBldGhlcldpdGhkcmF3biwgdWludDI1NiB0b2tlbnNDYXNoZWRJbik7CglldmVudCBGYWlsZWRTZW5kKGFkZHJlc3Mgc2VuZFRvLCB1aW50MjU2IGFtdCk7CgoJLy8gY2hlY2tzIHRoYXQgYW4gYWRkcmVzcyBpcyBhICJ0cnVzdGVkIGFkZHJlc3Mgb2YgYSBsZWdpdGltYXRlIEVPU0JldCBnYW1lIgoJbW9kaWZpZXIgYWRkcmVzc0luVHJ1c3RlZEFkZHJlc3NlcyhhZGRyZXNzIHRoaXNBZGRyZXNzKXsKCgkJcmVxdWlyZShUUlVTVEVEQUREUkVTU0VTW3RoaXNBZGRyZXNzXSk7CgkJXzsKCX0KCgkvLyBpbml0aWFsaXphdGlvbiBmdW5jdGlvbiAKCWZ1bmN0aW9uIEVPU0JldEJhbmtyb2xsKGFkZHJlc3MgZGljZSwgYWRkcmVzcyBzbG90cykgcHVibGljIHBheWFibGUgewoJCS8vIGZ1bmN0aW9uIGlzIHBheWFibGUsIG93bmVyIG9mIGNvbnRyYWN0IE1VU1QgInNlZWQiIGNvbnRyYWN0IHdpdGggc29tZSBldGhlciwgCgkJLy8gc28gdGhhdCB0aGUgcmF0aW9zIGFyZSBjb3JyZWN0IHdoZW4gdG9rZW5zIGFyZSBiZWluZyBtaW50ZWQKCQlyZXF1aXJlIChtc2cudmFsdWUgPiAwKTsKCgkJT1dORVIgPSBtc2cuc2VuZGVyOwoKCQkvLyAxMDAgdG9rZW5zL2V0aGVyIGlzIHRoZSBpbml0YWwgc2VlZCBhbW91bnQsIHNvOgoJCXVpbnQyNTYgaW5pdGlhbFRva2VucyA9IG1zZy52YWx1ZSAqIDEwMDsKCQliYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGluaXRpYWxUb2tlbnM7CgkJdG90YWxTdXBwbHkgPSBpbml0aWFsVG9rZW5zOwoKCQkvLyBsb2cgYSBtaW50IHRva2VucyBldmVudAoJCWVtaXQgVHJhbnNmZXIoMHgwLCBtc2cuc2VuZGVyLCBpbml0aWFsVG9rZW5zKTsKCgkJLy8gaW5zZXJ0IGdpdmVuIGdhbWUgYWRkcmVzc2VzIGludG8gdGhlIFRSVVNURURBRERSRVNTRVMgbWFwcGluZywgYW5kIHNhdmUgdGhlIGFkZHJlc3NlcyBhcyBnbG9iYWwgdmFyaWFibGVzCgkJVFJVU1RFREFERFJFU1NFU1tkaWNlXSA9IHRydWU7CgkJVFJVU1RFREFERFJFU1NFU1tzbG90c10gPSB0cnVlOwoKCQlESUNFID0gZGljZTsKCQlTTE9UUyA9IHNsb3RzOwoKCQlXQUlUVElNRVVOVElMV0lUSERSQVdPUlRSQU5TRkVSID0gNiBob3VyczsKCQlNQVhJTVVNSU5WRVNUTUVOVFNBTExPV0VEID0gNTAwIGV0aGVyOwoJfQoKCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgkvLyBWSUVXIEZVTkNUSU9OUwoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gCgoJZnVuY3Rpb24gY2hlY2tXaGVuQ29udHJpYnV0b3JDYW5UcmFuc2Zlck9yV2l0aGRyYXcoYWRkcmVzcyBiYW5rcm9sbGVyQWRkcmVzcykgdmlldyBwdWJsaWMgcmV0dXJucyh1aW50MjU2KXsKCQlyZXR1cm4gY29udHJpYnV0aW9uVGltZVtiYW5rcm9sbGVyQWRkcmVzc107Cgl9CgoJZnVuY3Rpb24gZ2V0QmFua3JvbGwoKSB2aWV3IHB1YmxpYyByZXR1cm5zKHVpbnQyNTYpewoJCS8vIHJldHVybnMgdGhlIHRvdGFsIGJhbGFuY2UgbWludXMgdGhlIGRldmVsb3BlcnMgZnVuZCwgYXMgdGhlIGFtb3VudCBvZiBhY3RpdmUgYmFua3JvbGwKCQlyZXR1cm4gU2FmZU1hdGguc3ViKGFkZHJlc3ModGhpcykuYmFsYW5jZSwgREVWRUxPUEVSU0ZVTkQpOwoJfQoKCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgkvLyBCQU5LUk9MTCBDT05UUkFDVCA8LT4gR0FNRSBDT05UUkFDVFMgZnVuY3Rpb25zCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLyAKCglmdW5jdGlvbiBwYXlFdGhlclRvV2lubmVyKHVpbnQyNTYgYW10RXRoZXIsIGFkZHJlc3Mgd2lubmVyKSBwdWJsaWMgYWRkcmVzc0luVHJ1c3RlZEFkZHJlc3Nlcyhtc2cuc2VuZGVyKXsKCQkvLyB0aGlzIGZ1bmN0aW9uIHdpbGwgZ2V0IGNhbGxlZCBieSBhIGdhbWUgY29udHJhY3Qgd2hlbiBzb21lb25lIHdpbnMgYSBnYW1lCgkJLy8gdHJ5IHRvIHNlbmQsIGlmIGl0IGZhaWxzLCB0aGVuIHNlbmQgdGhlIGFtb3VudCB0byB0aGUgb3duZXIKCQkvLyBub3RlLCB0aGlzIHdpbGwgb25seSBoYXBwZW4gaWYgc29tZW9uZSBpcyBjYWxsaW5nIHRoZSBiZXR0aW5nIGZ1bmN0aW9ucyB3aXRoCgkJLy8gYSBjb250cmFjdC4gVGhleSBhcmUgY2xlYXJseSB1cCB0byBubyBnb29kLCBzbyB0aGV5IGNhbiBjb250YWN0IHVzIHRvIHJldHJlaXZlIAoJCS8vIHRoZWlyIGV0aGVyCgkJLy8gaWYgdGhlIGV0aGVyIGNhbm5vdCBiZSBzZW50IHRvIHVzLCB0aGUgT1dORVIsIHRoYXQgbWVhbnMgd2UgYXJlIHVwIHRvIG5vIGdvb2QsIAoJCS8vIGFuZCB0aGUgZXRoZXIgd2lsbCBqdXN0IGJlIGdpdmVuIHRvIHRoZSBiYW5rcm9sbGVycyBhcyBpZiB0aGUgcGxheWVyL293bmVyIGxvc3QgCgoJCWlmICghIHdpbm5lci5zZW5kKGFtdEV0aGVyKSl7CgoJCQllbWl0IEZhaWxlZFNlbmQod2lubmVyLCBhbXRFdGhlcik7CgoJCQlpZiAoISBPV05FUi5zZW5kKGFtdEV0aGVyKSl7CgoJCQkJZW1pdCBGYWlsZWRTZW5kKE9XTkVSLCBhbXRFdGhlcik7CgkJCX0KCQl9Cgl9CgoJZnVuY3Rpb24gcmVjZWl2ZUV0aGVyRnJvbUdhbWVBZGRyZXNzKCkgcGF5YWJsZSBwdWJsaWMgYWRkcmVzc0luVHJ1c3RlZEFkZHJlc3Nlcyhtc2cuc2VuZGVyKXsKCQkvLyB0aGlzIGZ1bmN0aW9uIHdpbGwgZ2V0IGNhbGxlZCBmcm9tIHRoZSBnYW1lIGNvbnRyYWN0cyB3aGVuIHNvbWVvbmUgc3RhcnRzIGEgZ2FtZS4KCX0KCglmdW5jdGlvbiBwYXlPcmFjbGl6ZSh1aW50MjU2IGFtb3VudFRvUGF5KSBwdWJsaWMgYWRkcmVzc0luVHJ1c3RlZEFkZHJlc3Nlcyhtc2cuc2VuZGVyKXsKCQkvLyB0aGlzIGZ1bmN0aW9uIHdpbGwgZ2V0IGNhbGxlZCB3aGVuIGEgZ2FtZSBjb250cmFjdCBtdXN0IHBheSBwYXlPcmFjbGl6ZQoJCUVPU0JldEdhbWVJbnRlcmZhY2UobXNnLnNlbmRlcikucmVjZWl2ZVBheW1lbnRGb3JPcmFjbGl6ZS52YWx1ZShhbW91bnRUb1BheSkoKTsKCX0KCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJLy8gQkFOS1JPTEwgQ09OVFJBQ1QgTUFJTiBGVU5DVElPTlMKCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKCS8vIHRoaXMgZnVuY3Rpb24gQUREUyB0byB0aGUgYmFua3JvbGwgb2YgRU9TQmV0LCBhbmQgY3JlZGl0cyB0aGUgYmFua3JvbGxlciBhIHByb3BvcnRpb25hbAoJLy8gYW1vdW50IG9mIHRva2VucyBzbyB0aGV5IG1heSB3aXRoZHJhdyB0aGVpciB0b2tlbnMgbGF0ZXIKCS8vIGFsc28gaWYgdGhlcmUgaXMgb25seSBhIGxpbWl0ZWQgYW1vdW50IG9mIHNwYWNlIGxlZnQgaW4gdGhlIGJhbmtyb2xsLCBhIHVzZXIgY2FuIGp1c3Qgc2VuZCBhcyBtdWNoIAoJLy8gZXRoZXIgYXMgdGhleSB3YW50LCBiZWNhdXNlIHRoZXkgd2lsbCBiZSBhYmxlIHRvIGNvbnRyaWJ1dGUgdXAgdG8gdGhlIG1heGltdW0sIGFuZCB0aGVuIGdldCByZWZ1bmRlZCB0aGUgcmVzdC4KCWZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKCgkJLy8gc2F2ZSBpbiBtZW1vcnkgZm9yIGNoZWFwIGFjY2Vzcy4KCQkvLyB0aGlzIHJlcHJlc2VudHMgdGhlIHRvdGFsIGJhbmtyb2xsIGJhbGFuY2UgYmVmb3JlIHRoZSBmdW5jdGlvbiB3YXMgY2FsbGVkLgoJCXVpbnQyNTYgY3VycmVudFRvdGFsQmFua3JvbGwgPSBTYWZlTWF0aC5zdWIoZ2V0QmFua3JvbGwoKSwgbXNnLnZhbHVlKTsKCQl1aW50MjU2IG1heEludmVzdG1lbnRzQWxsb3dlZCA9IE1BWElNVU1JTlZFU1RNRU5UU0FMTE9XRUQ7CgoJCXJlcXVpcmUoY3VycmVudFRvdGFsQmFua3JvbGwgPCBtYXhJbnZlc3RtZW50c0FsbG93ZWQgJiYgbXNnLnZhbHVlICE9IDApOwoKCQl1aW50MjU2IGN1cnJlbnRTdXBwbHlPZlRva2VucyA9IHRvdGFsU3VwcGx5OwoJCXVpbnQyNTYgY29udHJpYnV0ZWRFdGhlcjsKCgkJYm9vbCBjb250cmlidXRpb25UYWtlc0Jhbmtyb2xsT3ZlckxpbWl0OwoJCXVpbnQyNTYgaWZDb250cmlidXRpb25UYWtlc0Jhbmtyb2xsT3ZlckxpbWl0X1JlZnVuZDsKCgkJdWludDI1NiBjcmVkaXRlZFRva2VuczsKCgkJaWYgKFNhZmVNYXRoLmFkZChjdXJyZW50VG90YWxCYW5rcm9sbCwgbXNnLnZhbHVlKSA+IG1heEludmVzdG1lbnRzQWxsb3dlZCl7CgkJCS8vIGFsbG93IHRoZSBiYW5rcm9sbGVyIHRvIGNvbnRyaWJ1dGUgdXAgdG8gdGhlIGFsbG93ZWQgYW1vdW50IG9mIGV0aGVyLCBhbmQgcmVmdW5kIHRoZSByZXN0LgoJCQljb250cmlidXRpb25UYWtlc0Jhbmtyb2xsT3ZlckxpbWl0ID0gdHJ1ZTsKCQkJLy8gc2V0IGNvbnRyaWJ1dGVkIGV0aGVyIGFzIChNQVhJTVVNSU5WRVNUTUVOVFNBTExPV0VEIC0gQkFOS1JPTEwpCgkJCWNvbnRyaWJ1dGVkRXRoZXIgPSBTYWZlTWF0aC5zdWIobWF4SW52ZXN0bWVudHNBbGxvd2VkLCBjdXJyZW50VG90YWxCYW5rcm9sbCk7CgkJCS8vIHJlZnVuZCB0aGUgcmVzdCBvZiB0aGUgZXRoZXIsIHdoaWNoIGlzIChvcmlnaW5hbCBhbW91bnQgc2VudCAtIChtYXhpbXVtIGFtb3VudCBhbGxvd2VkIC0gYmFua3JvbGwpKQoJCQlpZkNvbnRyaWJ1dGlvblRha2VzQmFua3JvbGxPdmVyTGltaXRfUmVmdW5kID0gU2FmZU1hdGguc3ViKG1zZy52YWx1ZSwgY29udHJpYnV0ZWRFdGhlcik7CgkJfQoJCWVsc2UgewoJCQljb250cmlidXRlZEV0aGVyID0gbXNnLnZhbHVlOwoJCX0KICAgICAgICAKCQlpZiAoY3VycmVudFN1cHBseU9mVG9rZW5zICE9IDApewoJCQkvLyBkZXRlcm1pbmUgdGhlIHJhdGlvIG9mIGNvbnRyaWJ1dGlvbiB2ZXJzdXMgdG90YWwgQkFOS1JPTEwuCgkJCWNyZWRpdGVkVG9rZW5zID0gU2FmZU1hdGgubXVsKGNvbnRyaWJ1dGVkRXRoZXIsIGN1cnJlbnRTdXBwbHlPZlRva2VucykgLyBjdXJyZW50VG90YWxCYW5rcm9sbDsKCQl9CgkJZWxzZSB7CgkJCS8vIGVkZ2UgY2FzZSB3aGVyZSBBTEwgbW9uZXkgd2FzIGNhc2hlZCBvdXQgZnJvbSBiYW5rcm9sbAoJCQkvLyBzbyBjdXJyZW50U3VwcGx5T2ZUb2tlbnMgPT0gMAoJCQkvLyBjdXJyZW50VG90YWxCYW5rcm9sbCBjYW4gPT0gMCBvciBub3QsIGlmIHNvbWVvbmUgbWluZXMvc2VsZmRlc3RydWN0J3MgdG8gdGhlIGNvbnRyYWN0CgkJCS8vIGJ1dCBlaXRoZXIgd2F5LCBnaXZlIGFsbCB0aGUgYmFua3JvbGwgdG8gcGVyc29uIHdobyBkZXBvc2l0cyBldGhlcgoJCQljcmVkaXRlZFRva2VucyA9IFNhZmVNYXRoLm11bChjb250cmlidXRlZEV0aGVyLCAxMDApOwoJCX0KCQkKCQkvLyBub3cgdXBkYXRlIHRoZSB0b3RhbCBzdXBwbHkgb2YgdG9rZW5zIGFuZCBiYW5rcm9sbCBhbW91bnQKCQl0b3RhbFN1cHBseSA9IFNhZmVNYXRoLmFkZChjdXJyZW50U3VwcGx5T2ZUb2tlbnMsIGNyZWRpdGVkVG9rZW5zKTsKCgkJLy8gbm93IGNyZWRpdCB0aGUgdXNlciB3aXRoIGhpcyBhbW91bnQgb2YgY29udHJpYnV0ZWQgdG9rZW5zIAoJCWJhbGFuY2VzW21zZy5zZW5kZXJdID0gU2FmZU1hdGguYWRkKGJhbGFuY2VzW21zZy5zZW5kZXJdLCBjcmVkaXRlZFRva2Vucyk7CgoJCS8vIHVwZGF0ZSBoaXMgY29udHJpYnV0aW9uIHRpbWUgZm9yIHN0YWtlIHRpbWUgbG9ja2luZwoJCWNvbnRyaWJ1dGlvblRpbWVbbXNnLnNlbmRlcl0gPSBibG9jay50aW1lc3RhbXA7CgoJCS8vIG5vdyBsb29rIGlmIHRoZSBhdHRlbXB0ZWQgY29udHJpYnV0aW9uIHdvdWxkIGhhdmUgdGFrZW4gdGhlIEJBTktST0xMIG92ZXIgdGhlIGxpbWl0LCAKCQkvLyBhbmQgaWYgdHJ1ZSwgcmVmdW5kIHRoZSBleGNlc3MgZXRoZXIuCgkJaWYgKGNvbnRyaWJ1dGlvblRha2VzQmFua3JvbGxPdmVyTGltaXQpewoJCQltc2cuc2VuZGVyLnRyYW5zZmVyKGlmQ29udHJpYnV0aW9uVGFrZXNCYW5rcm9sbE92ZXJMaW1pdF9SZWZ1bmQpOwoJCX0KCgkJLy8gbG9nIGFuIGV2ZW50IGFib3V0IGZ1bmRpbmcgYmFua3JvbGwKCQllbWl0IEZ1bmRCYW5rcm9sbChtc2cuc2VuZGVyLCBjb250cmlidXRlZEV0aGVyLCBjcmVkaXRlZFRva2Vucyk7CgoJCS8vIGxvZyBhIG1pbnQgdG9rZW5zIGV2ZW50CgkJZW1pdCBUcmFuc2ZlcigweDAsIG1zZy5zZW5kZXIsIGNyZWRpdGVkVG9rZW5zKTsKCX0KCglmdW5jdGlvbiBjYXNob3V0RU9TQmV0U3Rha2VUb2tlbnModWludDI1NiBfYW1vdW50VG9rZW5zKSBwdWJsaWMgewoJCS8vIEluIGVmZmVjdCwgdGhpcyBmdW5jdGlvbiBpcyB0aGUgT1BQT1NJVEUgb2YgdGhlIHVuLW5hbWVkIHBheWFibGUgZnVuY3Rpb24gYWJvdmVeXl4KCQkvLyB0aGlzIGFsbG93cyBiYW5rcm9sbGVycyB0byAiY2FzaCBvdXQiIGF0IGFueSB0aW1lLCBhbmQgcmVjZWl2ZSB0aGUgZXRoZXIgdGhhdCB0aGV5IGNvbnRyaWJ1dGVkLCBQTFVTCgkJLy8gYSBwcm9wb3J0aW9uIG9mIGFueSBldGhlciB0aGF0IHdhcyBlYXJuZWQgYnkgdGhlIHNtYXJ0IGNvbnRhY3Qgd2hlbiB0aGVpciBldGhlciB3YXMgInN0YWtpbmciLCBIb3dldmVyCgkJLy8gdGhpcyB3b3JrcyBpbiByZXZlcnNlIGFzIHdlbGwuIEFueSBuZXQgbG9zc2VzIG9mIHRoZSBzbWFydCBjb250cmFjdCB3aWxsIGJlIGFic29yYmVkIGJ5IHRoZSBwbGF5ZXIgaW4gbGlrZSBtYW5uZXIuCgkJLy8gT2YgY291cnNlLCBkdWUgdG8gdGhlIGNvbnN0YW50IGhvdXNlIGVkZ2UsIGEgYmFua3JvbGxlciB0aGF0IGxlYXZlcyB0aGVpciBldGhlciBpbiB0aGUgY29udHJhY3QgbG9uZyBlbm91Z2gKCQkvLyBpcyBlZmZlY3RpdmVseSBndWFyYW50ZWVkIHRvIHdpdGhkcmF3IG1vcmUgZXRoZXIgdGhhbiB0aGV5IG9yaWdpbmFsbHkgInN0YWtlZCIKCgkJLy8gc2F2ZSBpbiBtZW1vcnkgZm9yIGNoZWFwIGFjY2Vzcy4KCQl1aW50MjU2IHRva2VuQmFsYW5jZSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdOwoJCS8vIHZlcmlmeSB0aGF0IHRoZSBjb250cmlidXRvciBoYXMgZW5vdWdoIHRva2VucyB0byBjYXNoIG91dCB0aGlzIG1hbnksIGFuZCBoYXMgd2FpdGVkIHRoZSByZXF1aXJlZCB0aW1lLgoJCXJlcXVpcmUoX2Ftb3VudFRva2VucyA8PSB0b2tlbkJhbGFuY2UgCgkJCSYmIGNvbnRyaWJ1dGlvblRpbWVbbXNnLnNlbmRlcl0gKyBXQUlUVElNRVVOVElMV0lUSERSQVdPUlRSQU5TRkVSIDw9IGJsb2NrLnRpbWVzdGFtcAoJCQkmJiBfYW1vdW50VG9rZW5zID4gMCk7CgoJCS8vIHNhdmUgaW4gbWVtb3J5IGZvciBjaGVhcCBhY2Nlc3MuCgkJLy8gYWdhaW4sIHJlcHJlc2VudHMgdGhlIHRvdGFsIGJhbGFuY2Ugb2YgdGhlIGNvbnRyYWN0IGJlZm9yZSB0aGUgZnVuY3Rpb24gd2FzIGNhbGxlZC4KCQl1aW50MjU2IGN1cnJlbnRUb3RhbEJhbmtyb2xsID0gZ2V0QmFua3JvbGwoKTsKCQl1aW50MjU2IGN1cnJlbnRTdXBwbHlPZlRva2VucyA9IHRvdGFsU3VwcGx5OwoKCQkvLyBjYWxjdWxhdGUgdGhlIHRva2VuIHdpdGhkcmF3IHJhdGlvIGJhc2VkIG9uIGN1cnJlbnQgc3VwcGx5IAoJCXVpbnQyNTYgd2l0aGRyYXdFdGhlciA9IFNhZmVNYXRoLm11bChfYW1vdW50VG9rZW5zLCBjdXJyZW50VG90YWxCYW5rcm9sbCkgLyBjdXJyZW50U3VwcGx5T2ZUb2tlbnM7CgoJCS8vIGRldmVsb3BlcnMgdGFrZSAxJSBvZiB3aXRoZHJhd2xzIAoJCXVpbnQyNTYgZGV2ZWxvcGVyc0N1dCA9IHdpdGhkcmF3RXRoZXIgLyAxMDA7CgkJdWludDI1NiBjb250cmlidXRvckFtb3VudCA9IFNhZmVNYXRoLnN1Yih3aXRoZHJhd0V0aGVyLCBkZXZlbG9wZXJzQ3V0KTsKCgkJLy8gbm93IHVwZGF0ZSB0aGUgdG90YWwgc3VwcGx5IG9mIHRva2VucyBieSBzdWJ0cmFjdGluZyB0aGUgdG9rZW5zIHRoYXQgYXJlIGJlaW5nICJjYXNoZWQgaW4iCgkJdG90YWxTdXBwbHkgPSBTYWZlTWF0aC5zdWIoY3VycmVudFN1cHBseU9mVG9rZW5zLCBfYW1vdW50VG9rZW5zKTsKCgkJLy8gYW5kIHVwZGF0ZSB0aGUgdXNlcnMgc3VwcGx5IG9mIHRva2VucyAKCQliYWxhbmNlc1ttc2cuc2VuZGVyXSA9IFNhZmVNYXRoLnN1Yih0b2tlbkJhbGFuY2UsIF9hbW91bnRUb2tlbnMpOwoKCQkvLyB1cGRhdGUgdGhlIGRldmVsb3BlcnMgZnVuZCBiYXNlZCBvbiB0aGlzIGNhbGN1bGF0ZWQgYW1vdW50IAoJCURFVkVMT1BFUlNGVU5EID0gU2FmZU1hdGguYWRkKERFVkVMT1BFUlNGVU5ELCBkZXZlbG9wZXJzQ3V0KTsKCgkJLy8gbGFzdGx5LCB0cmFuc2ZlciB0aGUgZXRoZXIgYmFjayB0byB0aGUgYmFua3JvbGxlci4gVGhhbmtzIGZvciB5b3VyIGNvbnRyaWJ1dGlvbiEKCQltc2cuc2VuZGVyLnRyYW5zZmVyKGNvbnRyaWJ1dG9yQW1vdW50KTsKCgkJLy8gbG9nIGFuIGV2ZW50IGFib3V0IGNhc2hvdXQKCQllbWl0IENhc2hPdXQobXNnLnNlbmRlciwgY29udHJpYnV0b3JBbW91bnQsIF9hbW91bnRUb2tlbnMpOwoKCQkvLyBsb2cgYSBkZXN0cm95IHRva2VucyBldmVudAoJCWVtaXQgVHJhbnNmZXIobXNnLnNlbmRlciwgMHgwLCBfYW1vdW50VG9rZW5zKTsKCX0KCgkvLyBUTyBDQUxMIFRISVMgRlVOQ1RJT04gRUFTSUxZLCBTRU5EIEEgMCBFVEhFUiBUUkFOU0FDVElPTiBUTyBUSElTIENPTlRSQUNUIFdJVEggRVhUUkEgREFUQTogMHg3YTA5NTg4YgoJZnVuY3Rpb24gY2FzaG91dEVPU0JldFN0YWtlVG9rZW5zX0FMTCgpIHB1YmxpYyB7CgoJCS8vIGp1c3QgZm9yd2FyZCB0byBjYXNob3V0RU9TQmV0U3Rha2VUb2tlbnMgd2l0aCBpbnB1dCBhcyB0aGUgc2VuZGVycyBlbnRpcmUgYmFsYW5jZQoJCWNhc2hvdXRFT1NCZXRTdGFrZVRva2VucyhiYWxhbmNlc1ttc2cuc2VuZGVyXSk7Cgl9CgoJLy8vLy8vLy8vLy8vLy8vLy8vLy8KCS8vIE9XTkVSIEZVTkNUSU9OUzoKCS8vLy8vLy8vLy8vLy8vLy8vLy8vCgkvLyBQbGVhc2UsIGJlIGF3YXJlIHRoYXQgdGhlIG93bmVyIE9OTFkgY2FuIGNoYW5nZToKCQkvLyAxLiBUaGUgb3duZXIgY2FuIGluY3JlYXNlIG9yIGRlY3JlYXNlIHRoZSB0YXJnZXQgYW1vdW50IGZvciBhIGdhbWUuIFRoZXkgY2FuIHRoZW4gY2FsbCB0aGUgdXBkYXRlciBmdW5jdGlvbiB0byBnaXZlL3JlY2VpdmUgdGhlIGV0aGVyIGZyb20gdGhlIGdhbWUuCgkJLy8gMS4gVGhlIHdhaXQgdGltZSB1bnRpbCBhIHVzZXIgY2FuIHdpdGhkcmF3IG9yIHRyYW5zZmVyIHRoZWlyIHRva2VucyBhZnRlciBwdXJjaGFzZSB0aHJvdWdoIHRoZSBkZWZhdWx0IGZ1bmN0aW9uIGFib3ZlIF5eXgoJCS8vIDIuIFRoZSBvd25lciBjYW4gY2hhbmdlIHRoZSBtYXhpbXVtIGFtb3VudCBvZiBpbnZlc3RtZW50cyBhbGxvd2VkLiBUaGlzIGFsbG93cyBmb3IgZWFybHkgY29udHJpYnV0b3JzIHRvIGd1YXJhbnRlZQoJCS8vIAkJYSBjZXJ0YWluIHBlcmNlbnRhZ2Ugb2YgdGhlIGJhbmtyb2xsIHNvIHRoYXQgdGhlaXIgc3Rha2UgY2Fubm90IGJlIGRpbHV0ZWQgaW1tZWRpYXRlbHkuIEhvd2V2ZXIsIGJlIGF3YXJlIHRoYXQgdGhlIAoJCS8vCQltYXhpbXVtIGFtb3VudCBvZiBpbnZlc3RtZW50cyBhbGxvd2VkIHdpbGwgYmUgcmFpc2VkIG92ZXIgdGltZS4gVGhpcyB3aWxsIGFsbG93IGZvciBoaWdoZXIgYmV0cyBieSBnYW1ibGVycywgcmVzdWx0aW5nCgkJLy8gCQlpbiBoaWdoZXIgZGl2aWRlbmRzIGZvciB0aGUgYmFua3JvbGxlcnMKCQkvLyAzLiBUaGUgb3duZXIgY2FuIGZyZWV6ZSBwYXlvdXRzIHRvIGJldHRvcnMuIFRoaXMgd2lsbCBiZSB1c2VkIGluIGNhc2Ugb2YgYW4gZW1lcmdlbmN5LCBhbmQgdGhlIGNvbnRyYWN0IHdpbGwgcmVqZWN0IGFsbAoJCS8vCQluZXcgYmV0cyBhcyB3ZWxsLiBUaGlzIGRvZXMgbm90IG1lYW4gdGhhdCBiZXR0b3JzIHdpbGwgbG9zZSB0aGVpciBtb25leSB3aXRob3V0IHJlY29tcGVuc2UuIFRoZXkgd2lsbCBiZSBhbGxvd2VkIHRvIGNhbGwgdGhlIAoJCS8vIAkJInJlZnVuZCIgZnVuY3Rpb24gaW4gdGhlIHJlc3BlY3RpdmUgZ2FtZSBzbWFydCBjb250cmFjdCBvbmNlIHBheW91dHMgYXJlIHVuLWZyb3plbi4KCQkvLyA0LiBGaW5hbGx5LCB0aGUgb3duZXIgY2FuIG1vZGlmeSBhbmQgd2l0aGRyYXcgdGhlIGRldmVsb3BlcnMgcmV3YXJkLCB3aGljaCB3aWxsIGZ1bmQgZnV0dXJlIGRldmVsb3BtZW50LCBpbmNsdWRpbmcgbmV3IGdhbWVzLCBhIHNleGllciBmcm9udGVuZCwKCQkvLyAJCWFuZCBUUlVFIERBTyBnb3Zlcm5hbmNlIHNvIHRoYXQgb25seU93bmVyIGZ1bmN0aW9ucyBkb24ndCBoYXZlIHRvIGV4aXN0IGFueW1vcmUgOykgYW5kIGluIG9yZGVyIHRvIGVmZmVjdGl2ZWx5IHJlYWN0IHRvIGNoYW5nZXMgCgkJLy8gCQlpbiB0aGUgbWFya2V0IChsb3dlciB0aGUgcGVyY2VudGFnZSBiZWNhdXNlIG9mIGluY3JlYXNlZCBjb21wZXRpdGlvbiBpbiB0aGUgYmxvY2tjaGFpbiBjYXNpbm8gc3BhY2UsIGV0Yy4pCgoJZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gT1dORVIpOwoKCQlPV05FUiA9IG5ld093bmVyOwoJfQoKCWZ1bmN0aW9uIGNoYW5nZVdhaXRUaW1lVW50aWxXaXRoZHJhd09yVHJhbnNmZXIodWludDI1NiB3YWl0VGltZSkgcHVibGljIHsKCQkvLyB3YWl0VGltZSBNVVNUIGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byAxMCB3ZWVrcwoJCXJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gT1dORVIgJiYgd2FpdFRpbWUgPD0gNjA0ODAwMCk7CgoJCVdBSVRUSU1FVU5USUxXSVRIRFJBV09SVFJBTlNGRVIgPSB3YWl0VGltZTsKCX0KCglmdW5jdGlvbiBjaGFuZ2VNYXhpbXVtSW52ZXN0bWVudHNBbGxvd2VkKHVpbnQyNTYgbWF4QW1vdW50KSBwdWJsaWMgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBPV05FUik7CgoJCU1BWElNVU1JTlZFU1RNRU5UU0FMTE9XRUQgPSBtYXhBbW91bnQ7Cgl9CgoKCWZ1bmN0aW9uIHdpdGhkcmF3RGV2ZWxvcGVyc0Z1bmQoYWRkcmVzcyByZWNlaXZlcikgcHVibGljIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gT1dORVIpOwoKCQkvLyBmaXJzdCBnZXQgZGV2ZWxvcGVycyBmdW5kIGZyb20gZWFjaCBnYW1lIAogICAgICAgIEVPU0JldEdhbWVJbnRlcmZhY2UoRElDRSkucGF5RGV2ZWxvcGVyc0Z1bmQocmVjZWl2ZXIpOwoJCUVPU0JldEdhbWVJbnRlcmZhY2UoU0xPVFMpLnBheURldmVsb3BlcnNGdW5kKHJlY2VpdmVyKTsKCgkJLy8gbm93IHNlbmQgdGhlIGRldmVsb3BlcnMgZnVuZCBmcm9tIHRoZSBtYWluIGNvbnRyYWN0LgoJCXVpbnQyNTYgZGV2ZWxvcGVyc0Z1bmQgPSBERVZFTE9QRVJTRlVORDsKCgkJLy8gc2V0IGRldmVsb3BlcnMgZnVuZCB0byB6ZXJvCgkJREVWRUxPUEVSU0ZVTkQgPSAwOwoKCQkvLyB0cmFuc2ZlciB0aGlzIGFtb3VudCB0byB0aGUgb3duZXIhCgkJcmVjZWl2ZXIudHJhbnNmZXIoZGV2ZWxvcGVyc0Z1bmQpOwoJfQoKCS8vIHJlc2N1ZSB0b2tlbnMgaW5hZHZlcnRlbnRseSBzZW50IHRvIHRoZSBjb250cmFjdCBhZGRyZXNzIAoJZnVuY3Rpb24gRVJDMjBSZXNjdWUoYWRkcmVzcyB0b2tlbkFkZHJlc3MsIHVpbnQyNTYgYW10VG9rZW5zKSBwdWJsaWMgewoJCXJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gT1dORVIpOwoKCQlFUkMyMCh0b2tlbkFkZHJlc3MpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtdFRva2Vucyk7Cgl9CgoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJLy8gQkFTSUMgRVJDMjAgVE9LRU4gT1BFUkFUSU9OUwoJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCWZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCl7CgkJcmV0dXJuIHRvdGFsU3VwcGx5OwoJfQoKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnModWludCl7CgkJcmV0dXJuIGJhbGFuY2VzW19vd25lcl07Cgl9CgoJLy8gZG9uJ3QgYWxsb3cgdHJhbnNmZXJzIGJlZm9yZSB0aGUgcmVxdWlyZWQgd2FpdC10aW1lCgkvLyBhbmQgZG9uJ3QgYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgYWRkciwgaXQnbGwganVzdCBraWxsIHRva2VucwoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKXsKCQlyZXF1aXJlKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAKCQkJJiYgY29udHJpYnV0aW9uVGltZVttc2cuc2VuZGVyXSArIFdBSVRUSU1FVU5USUxXSVRIRFJBV09SVFJBTlNGRVIgPD0gYmxvY2sudGltZXN0YW1wCgkJCSYmIF90byAhPSBhZGRyZXNzKHRoaXMpCgkJCSYmIF90byAhPSBhZGRyZXNzKDApKTsKCgkJLy8gc2FmZWx5IHN1YnRyYWN0CgkJYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBTYWZlTWF0aC5zdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CgkJYmFsYW5jZXNbX3RvXSA9IFNhZmVNYXRoLmFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwoKCQkvLyBsb2cgZXZlbnQgCgkJZW1pdCBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLy8gZG9uJ3QgYWxsb3cgdHJhbnNmZXJzIGJlZm9yZSB0aGUgcmVxdWlyZWQgd2FpdC10aW1lCgkvLyBhbmQgZG9uJ3QgYWxsb3cgdHJhbnNmZXJzIHRvIHRoZSBjb250cmFjdCBhZGRyLCBpdCdsbCBqdXN0IGtpbGwgdG9rZW5zCglmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyhib29sKXsKCQlyZXF1aXJlKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAKCQkJJiYgYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSAKCQkJJiYgY29udHJpYnV0aW9uVGltZVtfZnJvbV0gKyBXQUlUVElNRVVOVElMV0lUSERSQVdPUlRSQU5TRkVSIDw9IGJsb2NrLnRpbWVzdGFtcAoJCQkmJiBfdG8gIT0gYWRkcmVzcyh0aGlzKQoJCQkmJiBfdG8gIT0gYWRkcmVzcygwKSk7CgoJCS8vIHNhZmVseSBhZGQgdG8gX3RvIGFuZCBzdWJ0cmFjdCBmcm9tIF9mcm9tLCBhbmQgc3VidHJhY3QgZnJvbSBhbGxvd2VkIGJhbGFuY2VzLgoJCWJhbGFuY2VzW190b10gPSBTYWZlTWF0aC5hZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgCQliYWxhbmNlc1tfZnJvbV0gPSBTYWZlTWF0aC5zdWIoYmFsYW5jZXNbX2Zyb21dLCBfdmFsdWUpOwogIAkJYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBTYWZlTWF0aC5zdWIoYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0sIF92YWx1ZSk7CgogIAkJLy8gbG9nIGV2ZW50CgkJZW1pdCBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoJCXJldHVybiB0cnVlOwogICAJCQoJfQoJCglmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyhib29sKXsKCgkJYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CgkJZW1pdCBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKCQkvLyBsb2cgZXZlbnQKCQlyZXR1cm4gdHJ1ZTsKCX0KCQoJZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50KXsKCQlyZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKCX0KfQoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJ0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgRU9TQmV0U2xvdHMgaXMgdXNpbmdPcmFjbGl6ZSwgRU9TQmV0R2FtZUludGVyZmFjZSB7CgoJdXNpbmcgU2FmZU1hdGggZm9yICo7CgoJLy8gZXZlbnRzCglldmVudCBCdXlDcmVkaXRzKGJ5dGVzMzIgaW5kZXhlZCBvcmFjbGl6ZVF1ZXJ5SWQpOwoJZXZlbnQgTGVkZ2VyUHJvb2ZGYWlsZWQoYnl0ZXMzMiBpbmRleGVkIG9yYWNsaXplUXVlcnlJZCk7CglldmVudCBSZWZ1bmQoYnl0ZXMzMiBpbmRleGVkIG9yYWNsaXplUXVlcnlJZCwgdWludDI1NiBhbW91bnQpOwoJZXZlbnQgU2xvdHNMYXJnZUJldChieXRlczMyIGluZGV4ZWQgb3JhY2xpemVRdWVyeUlkLCB1aW50MjU2IGRhdGExLCB1aW50MjU2IGRhdGEyLCB1aW50MjU2IGRhdGEzLCB1aW50MjU2IGRhdGE0LCB1aW50MjU2IGRhdGE1LCB1aW50MjU2IGRhdGE2LCB1aW50MjU2IGRhdGE3LCB1aW50MjU2IGRhdGE4KTsKCWV2ZW50IFNsb3RzU21hbGxCZXQodWludDI1NiBkYXRhMSwgdWludDI1NiBkYXRhMiwgdWludDI1NiBkYXRhMywgdWludDI1NiBkYXRhNCwgdWludDI1NiBkYXRhNSwgdWludDI1NiBkYXRhNiwgdWludDI1NiBkYXRhNywgdWludDI1NiBkYXRhOCk7CgoJLy8gc2xvdHMgZ2FtZSBzdHJ1Y3R1cmUKCXN0cnVjdCBTbG90c0dhbWVEYXRhIHsKCQlhZGRyZXNzIHBsYXllcjsKCQlib29sIHBhaWRPdXQ7CgkJdWludDI1NiBzdGFydDsKCQl1aW50MjU2IGV0aGVyUmVjZWl2ZWQ7CgkJdWludDggY3JlZGl0czsKCX0KCgltYXBwaW5nIChieXRlczMyID0+IFNsb3RzR2FtZURhdGEpIHB1YmxpYyBzbG90c0RhdGE7CgoJLy8gZXRoZXIgaW4gdGhpcyBjb250cmFjdCBjYW4gYmUgaW4gb25lIG9mIHR3byBsb2NhdGlvbnM6Cgl1aW50MjU2IHB1YmxpYyBMSUFCSUxJVElFUzsKCXVpbnQyNTYgcHVibGljIERFVkVMT1BFUlNGVU5EOwoKCS8vIGNvdW50ZXJzIGZvciBmcm9udGVuZCBzdGF0aXN0aWNzCgl1aW50MjU2IHB1YmxpYyBBTU9VTlRXQUdFUkVEOwoJdWludDI1NiBwdWJsaWMgRElBTFNTUFVOOwoJCgkvLyB0b2dnbGFibGUgdmFsdWVzCgl1aW50MjU2IHB1YmxpYyBPUkFDTElaRVFVRVJZTUFYVElNRTsKCXVpbnQyNTYgcHVibGljIE1JTkJFVF9wZXJTUElOOwoJdWludDI1NiBwdWJsaWMgTUlOQkVUX3BlclRYOwoJdWludDI1NiBwdWJsaWMgT1JBQ0xJWkVHQVNQUklDRTsKCXVpbnQyNTYgcHVibGljIElOSVRJQUxHQVNGT1JPUkFDTElaRTsKCXVpbnQxNiBwdWJsaWMgTUFYV0lOX2luVEhPVVNBTkRUSFBFUkNFTlRTOwoKCS8vIHRvZ2dsYWJsZSBmdW5jdGlvbmFsaXR5IG9mIGNvbnRyYWN0Cglib29sIHB1YmxpYyBHQU1FUEFVU0VEOwoJYm9vbCBwdWJsaWMgUkVGVU5EU0FDVElWRTsKCgkvLyBvd25lciBvZiBjb250cmFjdAoJYWRkcmVzcyBwdWJsaWMgT1dORVI7CgoJLy8gYmFua3JvbGxlciBhZGRyZXNzCglhZGRyZXNzIHB1YmxpYyBCQU5LUk9MTEVSOwoKCS8vIGNvbnN0cnVjdG9yCglmdW5jdGlvbiBFT1NCZXRTbG90cygpIHB1YmxpYyB7CgkJLy8gbGVkZ2VyIHByb29mIGlzIEFMV0FZUyB2ZXJpZmllZCBvbi1jaGFpbgoJCW9yYWNsaXplX3NldFByb29mKHByb29mVHlwZV9MZWRnZXIpOwoKCQkvLyBnYXMgcHJpY2VzIGZvciBvcmFjbGl6ZSBjYWxsIGJhY2ssIGNhbiBiZSBjaGFuZ2VkCgkJb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UoODAwMDAwMDAwMCk7CgkJT1JBQ0xJWkVHQVNQUklDRSA9IDgwMDAwMDAwMDA7CgkJSU5JVElBTEdBU0ZPUk9SQUNMSVpFID0gMjI1MDAwOwoKCQlBTU9VTlRXQUdFUkVEID0gMDsKCQlESUFMU1NQVU4gPSAwOwoKCQlHQU1FUEFVU0VEID0gZmFsc2U7CgkJUkVGVU5EU0FDVElWRSA9IHRydWU7CgoJCU9SQUNMSVpFUVVFUllNQVhUSU1FID0gNiBob3VyczsKCQlNSU5CRVRfcGVyU1BJTiA9IDIgZmlubmV5OyAvLyBjdXJyZW50bHksIHRoaXMgaXMgfjQwLTUwYyBhIHNwaW4sIHdoaWNoIGlzIHByZXR0eSBhdmVyYWdlIHNsb3RzLiBUaGlzIGlzIGNoYW5nZWFibGUgYnkgT1dORVIgCgkJTUlOQkVUX3BlclRYID0gMTAgZmlubmV5OwogICAgICAgIE1BWFdJTl9pblRIT1VTQU5EVEhQRVJDRU5UUyA9IDMzMzsgLy8gMzMzLzEwMDAgc28gYSBqYWNrcG90IGNhbiB0YWtlIDMzJSBvZiBiYW5rcm9sbCAoZXh0cmVtZWx5IHJhcmUpCiAgICAgICAgT1dORVIgPSBtc2cuc2VuZGVyOwoJfQoKCS8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJLy8gSU5URVJGQUNFIENPTlRBQ1QgRlVOQ1RJT05TCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCglmdW5jdGlvbiBwYXlEZXZlbG9wZXJzRnVuZChhZGRyZXNzIGRldmVsb3BlcikgcHVibGljIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gQkFOS1JPTExFUik7CgoJCXVpbnQyNTYgZGV2RnVuZCA9IERFVkVMT1BFUlNGVU5EOwoKCQlERVZFTE9QRVJTRlVORCA9IDA7CgoJCWRldmVsb3Blci50cmFuc2ZlcihkZXZGdW5kKTsKCX0KCgkvLyBqdXN0IGEgZnVuY3Rpb24gdG8gcmVjZWl2ZSBldGgsIG9ubHkgYWxsb3cgdGhlIGJhbmtyb2xsIHRvIHVzZSB0aGlzCglmdW5jdGlvbiByZWNlaXZlUGF5bWVudEZvck9yYWNsaXplKCkgcGF5YWJsZSBwdWJsaWMgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBCQU5LUk9MTEVSKTsKCX0KCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCS8vIFZJRVcgRlVOQ1RJT05TCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCglmdW5jdGlvbiBnZXRNYXhXaW4oKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpewoJCXJldHVybiAoU2FmZU1hdGgubXVsKEVPU0JldEJhbmtyb2xsSW50ZXJmYWNlKEJBTktST0xMRVIpLmdldEJhbmtyb2xsKCksIE1BWFdJTl9pblRIT1VTQU5EVEhQRVJDRU5UUykgLyAxMDAwKTsKCX0KCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCS8vIE9XTkVSIE9OTFkgRlVOQ1RJT05TCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgkvLyBXQVJOSU5HISEhISEgQ2FuIG9ubHkgc2V0IHRoaXMgZnVuY3Rpb24gb25jZSEKCWZ1bmN0aW9uIHNldEJhbmtyb2xsZXJDb250cmFjdE9uY2UoYWRkcmVzcyBiYW5rcm9sbEFkZHJlc3MpIHB1YmxpYyB7CgkJLy8gcmVxdWlyZSB0aGF0IEJBTktST0xMRVIgYWRkcmVzcyA9PSAweDAgKGFkZHJlc3Mgbm90IHNldCB5ZXQpLCBhbmQgY29taW5nIGZyb20gb3duZXIuCgkJcmVxdWlyZShtc2cuc2VuZGVyID09IE9XTkVSICYmIEJBTktST0xMRVIgPT0gYWRkcmVzcygwKSk7CgoJCS8vIGNoZWNrIGhlcmUgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIGJhbmtyb2xsIGNvbnRyYWN0IGlzIGxlZ2l0aW1hdGUKCQkvLyBqdXN0IG1ha2Ugc3VyZSB0aGF0IGNhbGxpbmcgdGhlIGJhbmtyb2xsIGNvbnRyYWN0IGdldEJhbmtyb2xsKCkgcmV0dXJucyBub24temVybwoKCQlyZXF1aXJlKEVPU0JldEJhbmtyb2xsSW50ZXJmYWNlKGJhbmtyb2xsQWRkcmVzcykuZ2V0QmFua3JvbGwoKSAhPSAwKTsKCgkJQkFOS1JPTExFUiA9IGJhbmtyb2xsQWRkcmVzczsKCX0KCglmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBPV05FUik7CgoJCU9XTkVSID0gbmV3T3duZXI7Cgl9CgoJZnVuY3Rpb24gc2V0T3JhY2xpemVRdWVyeU1heFRpbWUodWludDI1NiBuZXdUaW1lKSBwdWJsaWMgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBPV05FUik7CgoJCU9SQUNMSVpFUVVFUllNQVhUSU1FID0gbmV3VGltZTsKCX0KCgkvLyBzdG9yZSB0aGUgZ2FzIHByaWNlIGFzIGEgc3RvcmFnZSB2YXJpYWJsZSBmb3IgZWFzeSByZWZlcmVuY2UsCgkvLyBhbmQgdGhuZSBjaGFuZ2UgdGhlIGdhcyBwcmljZSB1c2luZyB0aGUgcHJvcGVyIG9yYWNsaXplIGZ1bmN0aW9uCglmdW5jdGlvbiBzZXRPcmFjbGl6ZVF1ZXJ5R2FzUHJpY2UodWludDI1NiBnYXNQcmljZSkgcHVibGljIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gT1dORVIpOwoKCQlPUkFDTElaRUdBU1BSSUNFID0gZ2FzUHJpY2U7CgkJb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UoZ2FzUHJpY2UpOwoJfQoKCS8vIHNob3VsZCBiZSB+MTYwLDAwMCB0byBzYXZlIGV0aAoJZnVuY3Rpb24gc2V0SW5pdGlhbEdhc0Zvck9yYWNsaXplKHVpbnQyNTYgZ2FzQW10KSBwdWJsaWMgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBPV05FUik7CgoJCUlOSVRJQUxHQVNGT1JPUkFDTElaRSA9IGdhc0FtdDsKCX0KCglmdW5jdGlvbiBzZXRHYW1lUGF1c2VkKGJvb2wgcGF1c2VkKSBwdWJsaWMgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBPV05FUik7CgoJCUdBTUVQQVVTRUQgPSBwYXVzZWQ7Cgl9CgoJZnVuY3Rpb24gc2V0UmVmdW5kc0FjdGl2ZShib29sIGFjdGl2ZSkgcHVibGljIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gT1dORVIpOwoKCQlSRUZVTkRTQUNUSVZFID0gYWN0aXZlOwoJfQoKCWZ1bmN0aW9uIHNldE1pbkJldFBlclNwaW4odWludDI1NiBtaW5CZXQpIHB1YmxpYyB7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IE9XTkVSICYmIG1pbkJldCA+IDEwMDApOwoKCQlNSU5CRVRfcGVyU1BJTiA9IG1pbkJldDsKCX0KCglmdW5jdGlvbiBzZXRNaW5CZXRQZXJUeCh1aW50MjU2IG1pbkJldCkgcHVibGljIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gT1dORVIgJiYgbWluQmV0ID4gMTAwMCk7CgoJCU1JTkJFVF9wZXJUWCA9IG1pbkJldDsKCX0KCglmdW5jdGlvbiBzZXRNYXh3aW4odWludDE2IG5ld01heFdpbkluVGhvdXNhbmR0aFBlcmNlbnRzKSBwdWJsaWMgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBPV05FUiAmJiBuZXdNYXhXaW5JblRob3VzYW5kdGhQZXJjZW50cyA8PSAzMzMpOyAvLyBjYW5ub3Qgc2V0IG1heCB3aW4gZ3JlYXRlciB0aGFuIDEvMyBvZiB0aGUgYmFua3JvbGwgKGEgamFja3BvdCBpcyB2ZXJ5IHJhcmUpCgoJCU1BWFdJTl9pblRIT1VTQU5EVEhQRVJDRU5UUyA9IG5ld01heFdpbkluVGhvdXNhbmR0aFBlcmNlbnRzOwoJfQoKCS8vIHJlc2N1ZSB0b2tlbnMgaW5hZHZlcnRlbnRseSBzZW50IHRvIHRoZSBjb250cmFjdCBhZGRyZXNzIAoJZnVuY3Rpb24gRVJDMjBSZXNjdWUoYWRkcmVzcyB0b2tlbkFkZHJlc3MsIHVpbnQyNTYgYW10VG9rZW5zKSBwdWJsaWMgewoJCXJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gT1dORVIpOwoKCQlFUkMyMCh0b2tlbkFkZHJlc3MpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtdFRva2Vucyk7Cgl9CgoJZnVuY3Rpb24gcmVmdW5kKGJ5dGVzMzIgb3JhY2xpemVRdWVyeUlkKSBwdWJsaWMgewoJCS8vIHNhdmUgaW50byBtZW1vcnkgZm9yIGNoZWFwIGFjY2VzcwoJCVNsb3RzR2FtZURhdGEgbWVtb3J5IGRhdGEgPSBzbG90c0RhdGFbb3JhY2xpemVRdWVyeUlkXTsKCgkJLy9yZXF1aXJlIHRoYXQgdGhlIHF1ZXJ5IHRpbWUgaXMgdG9vIHNsb3csIGJldCBoYXMgbm90IGJlZW4gcGFpZCBvdXQsIGFuZCBlaXRoZXIgY29udHJhY3Qgb3duZXIgb3IgcGxheWVyIGlzIGNhbGxpbmcgdGhpcyBmdW5jdGlvbi4KCQlyZXF1aXJlKFNhZmVNYXRoLnN1YihibG9jay50aW1lc3RhbXAsIGRhdGEuc3RhcnQpID49IE9SQUNMSVpFUVVFUllNQVhUSU1FCgkJCSYmIChtc2cuc2VuZGVyID09IE9XTkVSIHx8IG1zZy5zZW5kZXIgPT0gZGF0YS5wbGF5ZXIpCgkJCSYmICghZGF0YS5wYWlkT3V0KQoJCQkmJiBkYXRhLmV0aGVyUmVjZWl2ZWQgPD0gTElBQklMSVRJRVMKCQkJJiYgZGF0YS5ldGhlclJlY2VpdmVkID4gMAoJCQkmJiBSRUZVTkRTQUNUSVZFKTsKCgkJLy8gc2V0IGNvbnRyYWN0IGRhdGEKCQlzbG90c0RhdGFbb3JhY2xpemVRdWVyeUlkXS5wYWlkT3V0ID0gdHJ1ZTsKCgkJLy8gc3VidHJhY3QgZXRoZXJSZWNlaXZlZCBmcm9tIHRoZXNlIHR3byB2YWx1ZXMgYmVjYXVzZSB0aGUgYmV0IGlzIGJlaW5nIHJlZnVuZGVkCgkJTElBQklMSVRJRVMgPSBTYWZlTWF0aC5zdWIoTElBQklMSVRJRVMsIGRhdGEuZXRoZXJSZWNlaXZlZCk7CgoJCS8vIHRoZW4gdHJhbnNmZXIgdGhlIG9yaWdpbmFsIGJldCB0byB0aGUgcGxheWVyLgoJCWRhdGEucGxheWVyLnRyYW5zZmVyKGRhdGEuZXRoZXJSZWNlaXZlZCk7CgoJCS8vIGZpbmFsbHksIGxvZyBhbiBldmVudCBzYXlpbmcgdGhhdCB0aGUgcmVmdW5kIGhhcyBwcm9jZXNzZWQuCgkJZW1pdCBSZWZ1bmQob3JhY2xpemVRdWVyeUlkLCBkYXRhLmV0aGVyUmVjZWl2ZWQpOwoJfQoKCWZ1bmN0aW9uIHBsYXkodWludDggY3JlZGl0cykgcHVibGljIHBheWFibGUgewoJCS8vIHNhdmUgZm9yIGZ1dHVyZSB1c2UgLyBnYXMgZWZmaWNpZW5jeQoJCXVpbnQyNTYgYmV0UGVyQ3JlZGl0ID0gbXNnLnZhbHVlIC8gY3JlZGl0czsKCgkJLy8gcmVxdWlyZSB0aGF0IHRoZSBnYW1lIGlzIHVucGF1c2VkLCBhbmQgdGhhdCB0aGUgY3JlZGl0cyBiZWluZyBwdXJjaGFzZWQgYXJlIGdyZWF0ZXIgdGhhbiAwIGFuZCBsZXNzIHRoYW4gdGhlIGFsbG93ZWQgYW1vdW50LCBkZWZhdWx0OiAxMDAgc3BpbnMgCgkJLy8gdmVyaWZ5IHRoYXQgdGhlIGJldCBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGJldCBsaW1pdCwgc28gd2UgZG9uJ3QgZ28gYmFua3J1cHQsIGFuZCB0aGF0IHRoZSBldGhlcnJlY2VpdmVkIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWluYmV0LgoJCXJlcXVpcmUoIUdBTUVQQVVTRUQKCQkJJiYgbXNnLnZhbHVlID49IE1JTkJFVF9wZXJUWAoJCQkmJiBiZXRQZXJDcmVkaXQgPj0gTUlOQkVUX3BlclNQSU4KCQkJJiYgY3JlZGl0cyA+IDAgCgkJCSYmIGNyZWRpdHMgPD0gMjI0CgkJCSYmIFNhZmVNYXRoLm11bChiZXRQZXJDcmVkaXQsIDUwMDApIDw9IGdldE1heFdpbigpKTsgLy8gNTAwMCBpcyB0aGUgamFja3BvdCBwYXlvdXQgKG1heCB3aW4gb24gYSByb2xsKQoKCQkvLyBlcXVhdGlvbiBmb3IgZ2FzIHRvIG9yYWNsaXplIGlzOgoJCS8vIGdhcyA9IChzb21lIGZpeGVkIGdhcyBhbXQpICsgMzI3MCAqIGNyZWRpdHMKCgkJdWludDI1NiBnYXNUb1NlbmQgPSBJTklUSUFMR0FTRk9ST1JBQ0xJWkUgKyAodWludDI1NigzMjcwKSAqIGNyZWRpdHMpOwoKCQlFT1NCZXRCYW5rcm9sbEludGVyZmFjZShCQU5LUk9MTEVSKS5wYXlPcmFjbGl6ZShvcmFjbGl6ZV9nZXRQcmljZSgncmFuZG9tJywgZ2FzVG9TZW5kKSk7CgoJCS8vIG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkoZGVsYXkgaW4gc2Vjb25kcywgYnl0ZXMgb2YgcmFuZG9tIGRhdGEsIGdhcyBmb3IgY2FsbGJhY2sgZnVuY3Rpb24pCgkJYnl0ZXMzMiBvcmFjbGl6ZVF1ZXJ5SWQgPSBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KDAsIDMwLCBnYXNUb1NlbmQpOwoKCQkvLyBhZGQgdGhlIG5ldyBzbG90cyBkYXRhIHRvIGEgbWFwcGluZyBzbyB0aGF0IHRoZSBvcmFjbGl6ZSBfX2NhbGxiYWNrIGNhbiB1c2UgaXQgbGF0ZXIKCQlzbG90c0RhdGFbb3JhY2xpemVRdWVyeUlkXSA9IFNsb3RzR2FtZURhdGEoewoJCQlwbGF5ZXIgOiBtc2cuc2VuZGVyLAoJCQlwYWlkT3V0IDogZmFsc2UsCgkJCXN0YXJ0IDogYmxvY2sudGltZXN0YW1wLAoJCQlldGhlclJlY2VpdmVkIDogbXNnLnZhbHVlLAoJCQljcmVkaXRzIDogY3JlZGl0cwoJCX0pOwoKCQkvLyBhZGQgdGhlIHNlbnQgdmFsdWUgaW50byBsaWFiaWxpdGllcy4gdGhpcyBzaG91bGQgTk9UIGdvIGludG8gdGhlIGJhbmtyb2xsIHlldAoJCS8vIGFuZCBtdXN0IGJlIHF1YXJhbnRpbmVkIGhlcmUgdG8gcHJldmVudCB0aW1pbmcgYXR0YWNrcwoJCUxJQUJJTElUSUVTID0gU2FmZU1hdGguYWRkKExJQUJJTElUSUVTLCBtc2cudmFsdWUpOwoKCQllbWl0IEJ1eUNyZWRpdHMob3JhY2xpemVRdWVyeUlkKTsKCX0KCglmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIHB1YmxpYyB7CgkJLy8gZ2V0IHRoZSBnYW1lIGRhdGEgYW5kIHB1dCBpbnRvIG1lbW9yeQoJCVNsb3RzR2FtZURhdGEgbWVtb3J5IGRhdGEgPSBzbG90c0RhdGFbX3F1ZXJ5SWRdOwoKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3JhY2xpemVfY2JBZGRyZXNzKCkgCgkJCSYmICFkYXRhLnBhaWRPdXQgCgkJCSYmIGRhdGEucGxheWVyICE9IGFkZHJlc3MoMCkgCgkJCSYmIExJQUJJTElUSUVTID49IGRhdGEuZXRoZXJSZWNlaXZlZCk7CgoJCS8vIGlmIHRoZSBwcm9vZiBoYXMgZmFpbGVkLCBpbW1lZGlhdGVseSByZWZ1bmQgdGhlIHBsYXllciB0aGUgb3JpZ2luYWwgYmV0LgoJCWlmIChvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fcmV0dXJuQ29kZShfcXVlcnlJZCwgX3Jlc3VsdCwgX3Byb29mKSAhPSAwKXsKCgkJCWlmIChSRUZVTkRTQUNUSVZFKXsKCQkJCS8vIHNldCBjb250cmFjdCBkYXRhCgkJCQlzbG90c0RhdGFbX3F1ZXJ5SWRdLnBhaWRPdXQgPSB0cnVlOwoKCQkJCS8vIHN1YnRyYWN0IGZyb20gbGlhYmlsaXRpZXMgYW5kIGFtb3VudCB3YWdlcmVkLCBiZWNhdXNlIHRoaXMgYmV0IGlzIGJlaW5nIHJlZnVuZGVkLgoJCQkJTElBQklMSVRJRVMgPSBTYWZlTWF0aC5zdWIoTElBQklMSVRJRVMsIGRhdGEuZXRoZXJSZWNlaXZlZCk7CgoJCQkJLy8gdHJhbnNmZXIgdGhlIG9yaWdpbmFsIGJldCBiYWNrCgkJCQlkYXRhLnBsYXllci50cmFuc2ZlcihkYXRhLmV0aGVyUmVjZWl2ZWQpOwoKCQkJCS8vIGxvZyB0aGUgcmVmdW5kCgkJCQllbWl0IFJlZnVuZChfcXVlcnlJZCwgZGF0YS5ldGhlclJlY2VpdmVkKTsKCQkJfQoJCQkvLyBsb2cgdGhlIGxlZGdlciBwcm9vZiBmYWlsIAoJCQllbWl0IExlZGdlclByb29mRmFpbGVkKF9xdWVyeUlkKTsKCQkJCgkJfQoJCWVsc2UgewoJCQkvLyBhZ2FpbiwgdGhpcyBibG9jayBpcyBhbG1vc3QgaWRlbnRpY2FsIHRvIHRoZSBwcmV2aW91cyBibG9jayBpbiB0aGUgcGxheSguLi4pIGZ1bmN0aW9uIAoJCQkvLyBpbnN0ZWFkIG9mIGR1cGxpY2F0aW5nIGRvY3VtZW50YXRpb24sIHdlIHdpbGwganVzdCBwb2ludCBvdXQgdGhlIGNoYW5nZXMgZnJvbSB0aGUgb3RoZXIgYmxvY2sgCgkJCXVpbnQyNTYgZGlhbHNTcHVuOwoJCQkKCQkJdWludDggZGlhbDE7CgkJCXVpbnQ4IGRpYWwyOwoJCQl1aW50OCBkaWFsMzsKCQkJCgkJCXVpbnQyNTZbXSBtZW1vcnkgbG9nc0RhdGEgPSBuZXcgdWludDI1NltdKDgpOwoJCQkKCQkJdWludDI1NiBwYXlvdXQ7CgkJCQoJCQkvLyBtdXN0IHVzZSBkYXRhLmNyZWRpdHMgaW5zdGVhZCBvZiBjcmVkaXRzLgoJCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgZGF0YS5jcmVkaXRzOyBpKyspewoKCQkJCS8vIGFsbCBkaWFscyBub3cgdXNlIF9yZXN1bHQsIGluc3RlYWQgb2YgYmxvY2toYXNoLCB0aGlzIGlzIHRoZSBtYWluIGNoYW5nZSwgYW5kIGFsbG93cyBTbG90cyB0byAKCQkJCS8vIGFjY29tb2RhdGUgYmV0cyBvZiBhbnkgc2l6ZSwgZnJlZSBvZiBwb3NzaWJsZSBtaW5lciBpbnRlcmZlcmVuY2UgCgkJCQlkaWFsc1NwdW4gKz0gMTsKCQkJCWRpYWwxID0gdWludDgodWludChrZWNjYWsyNTYoX3Jlc3VsdCwgZGlhbHNTcHVuKSkgJSA2NCk7CgkJCQkKCQkJCWRpYWxzU3B1biArPSAxOwoJCQkJZGlhbDIgPSB1aW50OCh1aW50KGtlY2NhazI1NihfcmVzdWx0LCBkaWFsc1NwdW4pKSAlIDY0KTsKCQkJCQoJCQkJZGlhbHNTcHVuICs9IDE7CgkJCQlkaWFsMyA9IHVpbnQ4KHVpbnQoa2VjY2FrMjU2KF9yZXN1bHQsIGRpYWxzU3B1bikpICUgNjQpOwoKCQkJCS8vIGRpYWwgMQoJCQkJZGlhbDEgPSBnZXREaWFsMVR5cGUoZGlhbDEpOwoKCQkJCS8vIGRpYWwgMgoJCQkJZGlhbDIgPSBnZXREaWFsMlR5cGUoZGlhbDIpOwoKCQkJCS8vIGRpYWwgMwoJCQkJZGlhbDMgPSBnZXREaWFsM1R5cGUoZGlhbDMpOwoKCQkJCS8vIGRldGVybWluZSB0aGUgcGF5b3V0CgkJCQlwYXlvdXQgKz0gZGV0ZXJtaW5lUGF5b3V0KGRpYWwxLCBkaWFsMiwgZGlhbDMpOwoJCQkJCgkJCQkvLyBhc3NlbWJsaW5nIGxvZyBkYXRhCgkJCQlpZiAoaSA8PSAyNyl7CgkJCQkJLy8gaW4gbG9nc0RhdGEwCgkJCQkJbG9nc0RhdGFbMF0gKz0gdWludDI1NihkaWFsMSkgKiB1aW50MjU2KDIpICoqICgzICogKCgzICogKDI3IC0gaSkpICsgMikpOwoJCQkJCWxvZ3NEYXRhWzBdICs9IHVpbnQyNTYoZGlhbDIpICogdWludDI1NigyKSAqKiAoMyAqICgoMyAqICgyNyAtIGkpKSArIDEpKTsKCQkJCQlsb2dzRGF0YVswXSArPSB1aW50MjU2KGRpYWwzKSAqIHVpbnQyNTYoMikgKiogKDMgKiAoKDMgKiAoMjcgLSBpKSkpKTsKCQkJCX0KCQkJCWVsc2UgaWYgKGkgPD0gNTUpewoJCQkJCS8vIGluIGxvZ3NEYXRhMQoJCQkJCWxvZ3NEYXRhWzFdICs9IHVpbnQyNTYoZGlhbDEpICogdWludDI1NigyKSAqKiAoMyAqICgoMyAqICg1NSAtIGkpKSArIDIpKTsKCQkJCQlsb2dzRGF0YVsxXSArPSB1aW50MjU2KGRpYWwyKSAqIHVpbnQyNTYoMikgKiogKDMgKiAoKDMgKiAoNTUgLSBpKSkgKyAxKSk7CgkJCQkJbG9nc0RhdGFbMV0gKz0gdWludDI1NihkaWFsMykgKiB1aW50MjU2KDIpICoqICgzICogKCgzICogKDU1IC0gaSkpKSk7CgkJCQl9CgkJCQllbHNlIGlmIChpIDw9IDgzKSB7CgkJCQkJLy8gaW4gbG9nc0RhdGEyCgkJCQkJbG9nc0RhdGFbMl0gKz0gdWludDI1NihkaWFsMSkgKiB1aW50MjU2KDIpICoqICgzICogKCgzICogKDgzIC0gaSkpICsgMikpOwoJCQkJCWxvZ3NEYXRhWzJdICs9IHVpbnQyNTYoZGlhbDIpICogdWludDI1NigyKSAqKiAoMyAqICgoMyAqICg4MyAtIGkpKSArIDEpKTsKCQkJCQlsb2dzRGF0YVsyXSArPSB1aW50MjU2KGRpYWwzKSAqIHVpbnQyNTYoMikgKiogKDMgKiAoKDMgKiAoODMgLSBpKSkpKTsKCQkJCX0KCQkJCWVsc2UgaWYgKGkgPD0gMTExKSB7CgkJCQkJLy8gaW4gbG9nc0RhdGEzCgkJCQkJbG9nc0RhdGFbM10gKz0gdWludDI1NihkaWFsMSkgKiB1aW50MjU2KDIpICoqICgzICogKCgzICogKDExMSAtIGkpKSArIDIpKTsKCQkJCQlsb2dzRGF0YVszXSArPSB1aW50MjU2KGRpYWwyKSAqIHVpbnQyNTYoMikgKiogKDMgKiAoKDMgKiAoMTExIC0gaSkpICsgMSkpOwoJCQkJCWxvZ3NEYXRhWzNdICs9IHVpbnQyNTYoZGlhbDMpICogdWludDI1NigyKSAqKiAoMyAqICgoMyAqICgxMTEgLSBpKSkpKTsKCQkJCX0KCQkJCWVsc2UgaWYgKGkgPD0gMTM5KXsKCQkJCQkvLyBpbiBsb2dzRGF0YTQKCQkJCQlsb2dzRGF0YVs0XSArPSB1aW50MjU2KGRpYWwxKSAqIHVpbnQyNTYoMikgKiogKDMgKiAoKDMgKiAoMTM5IC0gaSkpICsgMikpOwoJCQkJCWxvZ3NEYXRhWzRdICs9IHVpbnQyNTYoZGlhbDIpICogdWludDI1NigyKSAqKiAoMyAqICgoMyAqICgxMzkgLSBpKSkgKyAxKSk7CgkJCQkJbG9nc0RhdGFbNF0gKz0gdWludDI1NihkaWFsMykgKiB1aW50MjU2KDIpICoqICgzICogKCgzICogKDEzOSAtIGkpKSkpOwoJCQkJfQoJCQkJZWxzZSBpZiAoaSA8PSAxNjcpewoJCQkJCS8vIGluIGxvZ3NEYXRhNQoJCQkJCWxvZ3NEYXRhWzVdICs9IHVpbnQyNTYoZGlhbDEpICogdWludDI1NigyKSAqKiAoMyAqICgoMyAqICgxNjcgLSBpKSkgKyAyKSk7CgkJCQkJbG9nc0RhdGFbNV0gKz0gdWludDI1NihkaWFsMikgKiB1aW50MjU2KDIpICoqICgzICogKCgzICogKDE2NyAtIGkpKSArIDEpKTsKCQkJCQlsb2dzRGF0YVs1XSArPSB1aW50MjU2KGRpYWwzKSAqIHVpbnQyNTYoMikgKiogKDMgKiAoKDMgKiAoMTY3IC0gaSkpKSk7CgkJCQl9CgkJCQllbHNlIGlmIChpIDw9IDE5NSl7CgkJCQkJLy8gaW4gbG9nc0RhdGE2CgkJCQkJbG9nc0RhdGFbNl0gKz0gdWludDI1NihkaWFsMSkgKiB1aW50MjU2KDIpICoqICgzICogKCgzICogKDE5NSAtIGkpKSArIDIpKTsKCQkJCQlsb2dzRGF0YVs2XSArPSB1aW50MjU2KGRpYWwyKSAqIHVpbnQyNTYoMikgKiogKDMgKiAoKDMgKiAoMTk1IC0gaSkpICsgMSkpOwoJCQkJCWxvZ3NEYXRhWzZdICs9IHVpbnQyNTYoZGlhbDMpICogdWludDI1NigyKSAqKiAoMyAqICgoMyAqICgxOTUgLSBpKSkpKTsKCQkJCX0KCQkJCWVsc2UgaWYgKGkgPD0gMjIzKXsKCQkJCQkvLyBpbiBsb2dzRGF0YTcKCQkJCQlsb2dzRGF0YVs3XSArPSB1aW50MjU2KGRpYWwxKSAqIHVpbnQyNTYoMikgKiogKDMgKiAoKDMgKiAoMjIzIC0gaSkpICsgMikpOwoJCQkJCWxvZ3NEYXRhWzddICs9IHVpbnQyNTYoZGlhbDIpICogdWludDI1NigyKSAqKiAoMyAqICgoMyAqICgyMjMgLSBpKSkgKyAxKSk7CgkJCQkJbG9nc0RhdGFbN10gKz0gdWludDI1NihkaWFsMykgKiB1aW50MjU2KDIpICoqICgzICogKCgzICogKDIyMyAtIGkpKSkpOwoJCQkJfQoJCQl9CgoJCQkvLyB0cmFjayB0aGF0IHRoZXNlIHNwaW5zIHdlcmUgbWFkZQoJCQlESUFMU1NQVU4gKz0gZGlhbHNTcHVuOwoKCQkJLy8gYW5kIGFkZCB0aGUgYW1vdW50IHdhZ2VyZWQKCQkJQU1PVU5UV0FHRVJFRCA9IFNhZmVNYXRoLmFkZChBTU9VTlRXQUdFUkVELCBkYXRhLmV0aGVyUmVjZWl2ZWQpOwoKCQkJLy8gSU1QT1JUQU5UOiB3ZSBtdXN0IGNoYW5nZSB0aGUgInBhaWRPdXQiIHRvIFRSVUUgaGVyZSB0byBwcmV2ZW50IHJlZW50cmFuY3kvb3RoZXIgbmFzdHkgZWZmZWN0cy4KCQkJLy8gdGhpcyB3YXMgbm90IG5lZWRlZCB3aXRoIHRoZSBwcmV2aW91cyBsb29wL2NvZGUgYmxvY2ssIGFuZCBpcyB1c2VkIGJlY2F1c2UgdmFyaWFibGVzIG11c3QgYmUgd3JpdHRlbiBpbnRvIHN0b3JhZ2UKCQkJc2xvdHNEYXRhW19xdWVyeUlkXS5wYWlkT3V0ID0gdHJ1ZTsKCgkJCS8vIGRlY3JlYXNlIExJQUJJTElUSUVTIHdoZW4gdGhlIHNwaW5zIGFyZSBtYWRlCgkJCUxJQUJJTElUSUVTID0gU2FmZU1hdGguc3ViKExJQUJJTElUSUVTLCBkYXRhLmV0aGVyUmVjZWl2ZWQpOwoKCQkJLy8gZ2V0IHRoZSBkZXZlbG9wZXJzIGN1dCwgYW5kIHNlbmQgdGhlIHJlc3Qgb2YgdGhlIGV0aGVyIHJlY2VpdmVkIHRvIHRoZSBiYW5rcm9sbGVyIGNvbnRyYWN0CgkJCXVpbnQyNTYgZGV2ZWxvcGVyc0N1dCA9IGRhdGEuZXRoZXJSZWNlaXZlZCAvIDEwMDsKCgkJCURFVkVMT1BFUlNGVU5EID0gU2FmZU1hdGguYWRkKERFVkVMT1BFUlNGVU5ELCBkZXZlbG9wZXJzQ3V0KTsKCgkJCUVPU0JldEJhbmtyb2xsSW50ZXJmYWNlKEJBTktST0xMRVIpLnJlY2VpdmVFdGhlckZyb21HYW1lQWRkcmVzcy52YWx1ZShTYWZlTWF0aC5zdWIoZGF0YS5ldGhlclJlY2VpdmVkLCBkZXZlbG9wZXJzQ3V0KSkoKTsKCgkJCS8vIGdldCB0aGUgZXRoZXIgdG8gYmUgcGFpZCBvdXQsIGFuZCBmb3JjZSB0aGUgYmFua3JvbGxlciBjb250cmFjdCB0byBwYXkgb3V0IHRoZSBwbGF5ZXIKCQkJdWludDI1NiBldGhlclBhaWRvdXQgPSBTYWZlTWF0aC5tdWwoKGRhdGEuZXRoZXJSZWNlaXZlZCAvIGRhdGEuY3JlZGl0cyksIHBheW91dCk7CgoJCQlFT1NCZXRCYW5rcm9sbEludGVyZmFjZShCQU5LUk9MTEVSKS5wYXlFdGhlclRvV2lubmVyKGV0aGVyUGFpZG91dCwgZGF0YS5wbGF5ZXIpOwoKCQkJLy8gbG9nIGVuIGV2ZW50IHdpdGggaW5kZXhlZCBxdWVyeSBpZAoJCQllbWl0IFNsb3RzTGFyZ2VCZXQoX3F1ZXJ5SWQsIGxvZ3NEYXRhWzBdLCBsb2dzRGF0YVsxXSwgbG9nc0RhdGFbMl0sIGxvZ3NEYXRhWzNdLCBsb2dzRGF0YVs0XSwgbG9nc0RhdGFbNV0sIGxvZ3NEYXRhWzZdLCBsb2dzRGF0YVs3XSk7CgkJfQoJfQoJCgkvLyBIRUxQRVIgRlVOQ1RJT05TIFRPOgoJLy8gY2FsY3VsYXRlIHRoZSByZXN1bHQgb2YgdGhlIGRpYWxzIGJhc2VkIG9uIHRoZSBoYXJkY29kZWQgc2xvdCBkYXRhOiAKCgkvLyBTVE9QUwkJCVJFRUwjMQlSRUVMIzIJUkVFTCMzCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgkvLyBnb2xkIGV0aGVyIAkwIC8vICAxICAvLyAgMyAgIC8vICAgMSAgLy8JCgkvLyBzaWx2ZXIgZXRoZXIgMSAvLyAgNyAgLy8gIDEgICAvLyAgIDYgIC8vCgkvLyBicm9uemUgZXRoZXIgMiAvLyAgMSAgLy8gIDcgICAvLyAgIDYgIC8vCgkvLyBnb2xkIHBsYW5ldCAgMyAvLyAgNSAgLy8gIDcgICAvLyAgIDYgIC8vCgkvLyBzaWx2ZXJwbGFuZXQgNCAvLyAgOSAgLy8gIDYgICAvLyAgIDcgIC8vCgkvLyBicm9uemVwbGFuZXQgNSAvLyAgOSAgLy8gIDggICAvLyAgIDYgIC8vCgkvLyAtLS1ibGFuay0tLSAgNiAvLyAgMzIgLy8gIDMyICAvLyAgIDMyIC8vCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoJLy8gbm90ZSB0aGF0IGRpYWwxIC8gMiAvIDMgd2lsbCBnbyBmcm9tIG1vZCA2NCB0byBtb2QgNyBpbiB0aGlzIG1hbm5lcgoJCglmdW5jdGlvbiBnZXREaWFsMVR5cGUodWludDggZGlhbDFMb2NhdGlvbikgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQ4KSB7CgkgICAgaWYgKGRpYWwxTG9jYXRpb24gPT0gMCkgCQkJCQkJCSAgICAgICAgeyByZXR1cm4gMDsgfQoJCWVsc2UgaWYgKGRpYWwxTG9jYXRpb24gPj0gMSAmJiBkaWFsMUxvY2F0aW9uIDw9IDcpIAkJCXsgcmV0dXJuIDE7IH0KCQllbHNlIGlmIChkaWFsMUxvY2F0aW9uID09IDgpIAkJCQkJCSAgICAgICAgeyByZXR1cm4gMjsgfQoJCWVsc2UgaWYgKGRpYWwxTG9jYXRpb24gPj0gOSAmJiBkaWFsMUxvY2F0aW9uIDw9IDEzKSAJCXsgcmV0dXJuIDM7IH0KCQllbHNlIGlmIChkaWFsMUxvY2F0aW9uID49IDE0ICYmIGRpYWwxTG9jYXRpb24gPD0gMjIpIAkJeyByZXR1cm4gNDsgfQoJCWVsc2UgaWYgKGRpYWwxTG9jYXRpb24gPj0gMjMgJiYgZGlhbDFMb2NhdGlvbiA8PSAzMSkgCQl7IHJldHVybiA1OyB9CgkJZWxzZSAJCQkJCQkJCQkJICAgICAgICAgICAgICAgIHsgcmV0dXJuIDY7IH0KCX0KCQoJZnVuY3Rpb24gZ2V0RGlhbDJUeXBlKHVpbnQ4IGRpYWwyTG9jYXRpb24pIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50OCkgewoJICAgIGlmIChkaWFsMkxvY2F0aW9uID49IDAgJiYgZGlhbDJMb2NhdGlvbiA8PSAyKSAJCQkJeyByZXR1cm4gMDsgfQoJCWVsc2UgaWYgKGRpYWwyTG9jYXRpb24gPT0gMykgCQkJCQkJICAgICAgICB7IHJldHVybiAxOyB9CgkJZWxzZSBpZiAoZGlhbDJMb2NhdGlvbiA+PSA0ICYmIGRpYWwyTG9jYXRpb24gPD0gMTApCQkJeyByZXR1cm4gMjsgfQoJCWVsc2UgaWYgKGRpYWwyTG9jYXRpb24gPj0gMTEgJiYgZGlhbDJMb2NhdGlvbiA8PSAxNykgCQl7IHJldHVybiAzOyB9CgkJZWxzZSBpZiAoZGlhbDJMb2NhdGlvbiA+PSAxOCAmJiBkaWFsMkxvY2F0aW9uIDw9IDIzKSAJCXsgcmV0dXJuIDQ7IH0KCQllbHNlIGlmIChkaWFsMkxvY2F0aW9uID49IDI0ICYmIGRpYWwyTG9jYXRpb24gPD0gMzEpIAkJeyByZXR1cm4gNTsgfQoJCWVsc2UgCQkJCQkJCQkJCSAgICAgICAgICAgICAgICB7IHJldHVybiA2OyB9Cgl9CgkKCWZ1bmN0aW9uIGdldERpYWwzVHlwZSh1aW50OCBkaWFsM0xvY2F0aW9uKSBpbnRlcm5hbCBwdXJlIHJldHVybnModWludDgpIHsKCSAgICBpZiAoZGlhbDNMb2NhdGlvbiA9PSAwKSAJCQkJCQkJICAgICAgICB7IHJldHVybiAwOyB9CgkJZWxzZSBpZiAoZGlhbDNMb2NhdGlvbiA+PSAxICYmIGRpYWwzTG9jYXRpb24gPD0gNikJCQl7IHJldHVybiAxOyB9CgkJZWxzZSBpZiAoZGlhbDNMb2NhdGlvbiA+PSA3ICYmIGRpYWwzTG9jYXRpb24gPD0gMTIpIAkJeyByZXR1cm4gMjsgfQoJCWVsc2UgaWYgKGRpYWwzTG9jYXRpb24gPj0gMTMgJiYgZGlhbDNMb2NhdGlvbiA8PSAxOCkJCXsgcmV0dXJuIDM7IH0KCQllbHNlIGlmIChkaWFsM0xvY2F0aW9uID49IDE5ICYmIGRpYWwzTG9jYXRpb24gPD0gMjUpIAkJeyByZXR1cm4gNDsgfQoJCWVsc2UgaWYgKGRpYWwzTG9jYXRpb24gPj0gMjYgJiYgZGlhbDNMb2NhdGlvbiA8PSAzMSkgCQl7IHJldHVybiA1OyB9CgkJZWxzZSAJCQkJCQkJCQkJICAgICAgICAgICAgICAgIHsgcmV0dXJuIDY7IH0KCX0KCQoJLy8gSEVMUEVSIEZVTkNUSU9OIFRPOgoJLy8gZGV0ZXJtaW5lIHRoZSBwYXlvdXQgZ2l2ZW4gZGlhbCBsb2NhdGlvbnMgYmFzZWQgb24gdGhpcyB0YWJsZQoJCgkvLyBoYXJkY29kZWQgcGF5b3V0cyBkYXRhOgoJLy8gCQkJTEFORFMgT04gCQkJCS8vCVBBWVMgIC8vCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCS8vIEJyb256ZSBFIC0+IFNpbHZlciBFIC0+IEdvbGQgRQkvLwk1MDAwICAvLwoJLy8gM3ggR29sZCBFdGhlcgkJCQkJLy8JMTc3NyAgLy8KCS8vIDN4IFNpbHZlciBFdGhlcgkJCQkJLy8JMjUwICAgLy8KCS8vIDN4IEJyb256ZSBFdGhlcgkJCQkJLy8JMjUwICAgLy8KCS8vIEJyb256ZSBQIC0+IFNpbHZlciBQIC0+IEdvbGQgUAkvLwk5MCAgICAvLwoJLy8gM3ggYW55IEV0aGVyIAkJCQkJLy8JNzAgICAgLy8KCS8vIDN4IEdvbGQgUGxhbmV0IAkJCQkJLy8JNTAgICAgLy8KCS8vIDN4IFNpbHZlciBQbGFuZXQJCQkJCS8vCTI1ICAgIC8vCgkvLyBBbnkgR29sZCBQICYgU2lsdmVyIFAgJiBCcm9uemUgUCAvLwkxNSAgICAvLwoJLy8gM3ggQnJvbnplIFBsYW5ldAkJCQkJLy8JMTAgICAgLy8KCS8vIEFueSAzIHBsYW5ldCB0eXBlCQkJCS8vCTMgICAgIC8vCgkvLyBBbnkgMyBnb2xkCQkJCQkJLy8JMyAgICAgLy8KCS8vIEFueSAzIHNpbHZlcgkJCQkJCS8vCTIgICAgIC8vCgkvLyBBbnkgMyBicm9uemUJCQkJCQkvLwkyICAgICAvLwoJLy8gQmxhbmssIGJsYW5rLCBibGFuawkJCQkvLwkxICAgICAvLwoJLy8gZWxzZQkJCQkJCQkJLy8gIDAgICAgIC8vCgkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCQoJZnVuY3Rpb24gZGV0ZXJtaW5lUGF5b3V0KHVpbnQ4IGRpYWwxLCB1aW50OCBkaWFsMiwgdWludDggZGlhbDMpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CgkJaWYgKGRpYWwxID09IDYgfHwgZGlhbDIgPT0gNiB8fCBkaWFsMyA9PSA2KXsKCQkJLy8gYWxsIGJsYW5rCgkJCWlmIChkaWFsMSA9PSA2ICYmIGRpYWwyID09IDYgJiYgZGlhbDMgPT0gNikKCQkJCXJldHVybiAxOwoJCX0KCQllbHNlIGlmIChkaWFsMSA9PSA1KXsKCQkJLy8gYnJvbnplIHBsYW5ldCAtPiBzaWx2ZXIgcGxhbmV0IC0+IGdvbGQgcGxhbmV0CgkJCWlmIChkaWFsMiA9PSA0ICYmIGRpYWwzID09IDMpIAoJCQkJcmV0dXJuIDkwOwoKCQkJLy8gb25lIGdvbGQgcGxhbmV0LCBvbmUgc2lsdmVyIHBsYW5ldCwgb25lIGJyb256ZSBwbGFuZXQsIGFueSBvcmRlciEKCQkJLy8gbm90ZTogb3RoZXIgb3JkZXIgY292ZXJlZCBhYm92ZSwgcmV0dXJuIDkwCgkJCWVsc2UgaWYgKGRpYWwyID09IDMgJiYgZGlhbDMgPT0gNCkKCQkJCXJldHVybiAxNTsKCgkJCS8vIGFsbCBicm9uemUgcGxhbmV0IAoJCQllbHNlIGlmIChkaWFsMiA9PSA1ICYmIGRpYWwzID09IDUpIAoJCQkJcmV0dXJuIDEwOwoKCQkJLy8gYW55IHRocmVlIHBsYW5ldCB0eXBlIAoJCQllbHNlIGlmIChkaWFsMiA+PSAzICYmIGRpYWwyIDw9IDUgJiYgZGlhbDMgPj0gMyAmJiBkaWFsMyA8PSA1KQoJCQkJcmV0dXJuIDM7CgoJCQkvLyBhbnkgdGhyZWUgYnJvbnplIAoJCQllbHNlIGlmICgoZGlhbDIgPT0gMiB8fCBkaWFsMiA9PSA1KSAmJiAoZGlhbDMgPT0gMiB8fCBkaWFsMyA9PSA1KSkKCQkJCXJldHVybiAyOwoJCX0KCQllbHNlIGlmIChkaWFsMSA9PSA0KXsKCQkJLy8gYWxsIHNpbHZlciBwbGFuZXQKCQkJaWYgKGRpYWwyID09IDQgJiYgZGlhbDMgPT0gNCkKCQkJCXJldHVybiAyNTsKCgkJCS8vIG9uZSBnb2xkIHBsYW5ldCwgb25lIHNpbHZlciBwbGFuZXQsIG9uZSBicm9uemUgcGxhbmV0LCBhbnkgb3JkZXIhCgkJCWVsc2UgaWYgKChkaWFsMiA9PSAzICYmIGRpYWwzID09IDUpIHx8IChkaWFsMiA9PSA1ICYmIGRpYWwzID09IDMpKQoJCQkJcmV0dXJuIDE1OwoKCQkJLy8gYW55IHRocmVlIHBsYW5ldCB0eXBlIAoJCQllbHNlIGlmIChkaWFsMiA+PSAzICYmIGRpYWwyIDw9IDUgJiYgZGlhbDMgPj0gMyAmJiBkaWFsMyA8PSA1KQoJCQkJcmV0dXJuIDM7CgoJCQkvLyBhbnkgdGhyZWUgc2lsdmVyCgkJCWVsc2UgaWYgKChkaWFsMiA9PSAxIHx8IGRpYWwyID09IDQpICYmIChkaWFsMyA9PSAxIHx8IGRpYWwzID09IDQpKQoJCQkJcmV0dXJuIDI7CgkJfQoJCWVsc2UgaWYgKGRpYWwxID09IDMpewoJCQkvLyBhbGwgZ29sZCBwbGFuZXQKCQkJaWYgKGRpYWwyID09IDMgJiYgZGlhbDMgPT0gMykKCQkJCXJldHVybiA1MDsKCgkJCS8vIG9uZSBnb2xkIHBsYW5ldCwgb25lIHNpbHZlciBwbGFuZXQsIG9uZSBicm9uemUgcGxhbmV0LCBhbnkgb3JkZXIhCgkJCWVsc2UgaWYgKChkaWFsMiA9PSA0ICYmIGRpYWwzID09IDUpIHx8IChkaWFsMiA9PSA1ICYmIGRpYWwzID09IDQpKQoJCQkJcmV0dXJuIDE1OwoKCQkJLy8gYW55IHRocmVlIHBsYW5ldCB0eXBlIAoJCQllbHNlIGlmIChkaWFsMiA+PSAzICYmIGRpYWwyIDw9IDUgJiYgZGlhbDMgPj0gMyAmJiBkaWFsMyA8PSA1KQoJCQkJcmV0dXJuIDM7CgoJCQkvLyBhbnkgdGhyZWUgZ29sZAoJCQllbHNlIGlmICgoZGlhbDIgPT0gMCB8fCBkaWFsMiA9PSAzKSAmJiAoZGlhbDMgPT0gMCB8fCBkaWFsMyA9PSAzKSkKCQkJCXJldHVybiAzOwoJCX0KCQllbHNlIGlmIChkaWFsMSA9PSAyKXsKCQkJaWYgKGRpYWwyID09IDEgJiYgZGlhbDMgPT0gMCkKCQkJCXJldHVybiA1MDAwOyAvLyBqYWNrcG90ISEhIQoKCQkJLy8gYWxsIGJyb256ZSBldGhlcgoJCQllbHNlIGlmIChkaWFsMiA9PSAyICYmIGRpYWwzID09IDIpCgkJCQlyZXR1cm4gMjUwOwoKCQkJLy8gYWxsIHNvbWUgdHlwZSBvZiBldGhlcgoJCQllbHNlIGlmIChkaWFsMiA+PSAwICYmIGRpYWwyIDw9IDIgJiYgZGlhbDMgPj0gMCAmJiBkaWFsMyA8PSAyKQoJCQkJcmV0dXJuIDcwOwoKCQkJLy8gYW55IHRocmVlIGJyb256ZQoJCQllbHNlIGlmICgoZGlhbDIgPT0gMiB8fCBkaWFsMiA9PSA1KSAmJiAoZGlhbDMgPT0gMiB8fCBkaWFsMyA9PSA1KSkKCQkJCXJldHVybiAyOwoJCX0KCQllbHNlIGlmIChkaWFsMSA9PSAxKXsKCQkJLy8gYWxsIHNpbHZlciBldGhlciAKCQkJaWYgKGRpYWwyID09IDEgJiYgZGlhbDMgPT0gMSkKCQkJCXJldHVybiAyNTA7CgoJCQkvLyBhbGwgc29tZSB0eXBlIG9mIGV0aGVyCgkJCWVsc2UgaWYgKGRpYWwyID49IDAgJiYgZGlhbDIgPD0gMiAmJiBkaWFsMyA+PSAwICYmIGRpYWwzIDw9IDIpCgkJCQlyZXR1cm4gNzA7CgoJCQkvLyBhbnkgdGhyZWUgc2lsdmVyCgkJCWVsc2UgaWYgKChkaWFsMiA9PSAxIHx8IGRpYWwyID09IDQpICYmIChkaWFsMyA9PSAxIHx8IGRpYWwzID09IDQpKQoJCQkJcmV0dXJuIDM7CgkJfQoJCWVsc2UgaWYgKGRpYWwxID09IDApewoJCQkvLyBhbGwgZ29sZCBldGhlcgoJCQlpZiAoZGlhbDIgPT0gMCAmJiBkaWFsMyA9PSAwKQoJCQkJcmV0dXJuIDE3Nzc7CgoJCQkvLyBhbGwgc29tZSB0eXBlIG9mIGV0aGVyCgkJCWVsc2UgaWYgKGRpYWwyID49IDAgJiYgZGlhbDIgPD0gMiAmJiBkaWFsMyA+PSAwICYmIGRpYWwzIDw9IDIpCgkJCQlyZXR1cm4gNzA7CgoJCQkvLyBhbnkgdGhyZWUgZ29sZAoJCQllbHNlIGlmICgoZGlhbDIgPT0gMCB8fCBkaWFsMiA9PSAzKSAmJiAoZGlhbDMgPT0gMCB8fCBkaWFsMyA9PSAzKSkKCQkJCXJldHVybiAzOwoJCX0KCQlyZXR1cm4gMDsKCX0KCn0='.
	

]
