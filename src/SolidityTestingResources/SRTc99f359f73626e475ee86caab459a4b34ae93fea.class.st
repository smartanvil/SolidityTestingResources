Class {
	#name : #SRTc99f359f73626e475ee86caab459a4b34ae93fea,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc99f359f73626e475ee86caab459a4b34ae93fea >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CgogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBKb2ludE93bmFibGUKICogQGRldiBFeHRlbnNpb24gZm9yIHRoZSBPd25hYmxlIGNvbnRyYWN0LCB3aGVyZSB0aGUgb3duZXIgY2FuIGFzc2lnbiBhdCBtb3N0IDIgb3RoZXIgYWRkcmVzc2VzCiAqICB0byBtYW5hZ2Ugc29tZSBmdW5jdGlvbnMgb2YgdGhlIGNvbnRyYWN0LCB1c2luZyB0aGUgZWl0aGVyT3duZXIgbW9kaWZpZXIuCiAqICBOb3RlIHRoYXQgb25seU93bmVyIG1vZGlmaWVyIHdvdWxkIHN0aWxsIGJlIGFjY2Vzc2libGUgb25seSBmb3IgdGhlIG9yaWdpbmFsIG93bmVyLgogKi8KY29udHJhY3QgSm9pbnRPd25hYmxlIGlzIE93bmFibGUgewoKICBldmVudCBBbm90aGVyT3duZXJBc3NpZ25lZChhZGRyZXNzIGluZGV4ZWQgYW5vdGhlck93bmVyKTsKCiAgYWRkcmVzcyBwdWJsaWMgYW5vdGhlck93bmVyMTsKICBhZGRyZXNzIHB1YmxpYyBhbm90aGVyT3duZXIyOwoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIgb3IgYW5vdGhlck93bmVyLgogICAqLwogIG1vZGlmaWVyIGVpdGhlck93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyIHx8IG1zZy5zZW5kZXIgPT0gYW5vdGhlck93bmVyMSB8fCBtc2cuc2VuZGVyID09IGFub3RoZXJPd25lcjIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIGFzc2lnbiBhbm90aGVyIG93bmVyLgogICAqIEBwYXJhbSBfYW5vdGhlck93bmVyIFRoZSBhZGRyZXNzIHRvIGFub3RoZXIgb3duZXIuCiAgICovCiAgZnVuY3Rpb24gYXNzaWduQW5vdGhlck93bmVyMShhZGRyZXNzIF9hbm90aGVyT3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShfYW5vdGhlck93bmVyICE9IDApOwogICAgQW5vdGhlck93bmVyQXNzaWduZWQoX2Fub3RoZXJPd25lcik7CiAgICBhbm90aGVyT3duZXIxID0gX2Fub3RoZXJPd25lcjsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIGFzc2lnbiBhbm90aGVyIG93bmVyLgogICAqIEBwYXJhbSBfYW5vdGhlck93bmVyIFRoZSBhZGRyZXNzIHRvIGFub3RoZXIgb3duZXIuCiAgICovCiAgZnVuY3Rpb24gYXNzaWduQW5vdGhlck93bmVyMihhZGRyZXNzIF9hbm90aGVyT3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShfYW5vdGhlck93bmVyICE9IDApOwogICAgQW5vdGhlck93bmVyQXNzaWduZWQoX2Fub3RoZXJPd25lcik7CiAgICBhbm90aGVyT3duZXIyID0gX2Fub3RoZXJPd25lcjsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKCiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgSW50ZXJmYWNlIGZvciBjb250cmFjdHMgY29uZm9ybWluZyB0byBFUkMtNzIxOiBOb24tRnVuZ2libGUgVG9rZW5zLgogKi8KY29udHJhY3QgRVJDNzIxIHsKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgaW5kZXhlZCB0b2tlbklkKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIGFwcHJvdmVkLCB1aW50IGluZGV4ZWQgdG9rZW5JZCk7CgogICAgLy8gRVJDMjAgY29tcGF0aWJsZSBmdW5jdGlvbnMuCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyk7CiAgICAvLyBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpOwoKICAgIC8vIEZ1bmN0aW9ucyB0aGF0IGRlZmluZSBvd25lcnNoaXAuCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgZXh0ZXJuYWw7CgogICAgLy8gQXBwcm92YWwgcmVsYXRlZCBmdW5jdGlvbnMsIG1haW5seSB1c2VkIGluIGF1Y3Rpb24gY29udHJhY3RzLgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhcHByb3ZlZEZvcih1aW50IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbklkKSBleHRlcm5hbDsKCiAgICAvKioKICAgICAqIEBkZXYgRWFjaCBub24tZnVuZ2libGUgdG9rZW4gb3duZXIgY2FuIG93biBtb3JlIHRoYW4gb25lIHRva2VuIGF0IG9uZSB0aW1lLgogICAgICogQmVjYXVzZSBlYWNoIHRva2VuIGlzIHJlZmVyZW5jZWQgYnkgaXRzIHVuaXF1ZSBJRCwgaG93ZXZlciwKICAgICAqIGl0IGNhbiBnZXQgZGlmZmljdWx0IHRvIGtlZXAgdHJhY2sgb2YgdGhlIGluZGl2aWR1YWwgdG9rZW5zIHRoYXQgYSB1c2VyIG1heSBvd24uCiAgICAgKiBUbyBkbyB0aGlzLCB0aGUgY29udHJhY3Qga2VlcHMgYSByZWNvcmQgb2YgdGhlIElEcyBvZiBlYWNoIHRva2VuIHRoYXQgZWFjaCB1c2VyIG93bnMuCiAgICAgKi8KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50W10pIHB1YmxpYyBvd25lclRva2VuczsKCn0KCgovKioKICogQHRpdGxlIFRoZSBFUkMtNzIxIGNvbXBsaWFuY2UgdG9rZW4gY29udHJhY3QuCiAqLwpjb250cmFjdCBFUkM3MjFUb2tlbiBpcyBFUkM3MjEsIFBhdXNhYmxlIHsKCiAgICAvKiA9PT09PT09PSBTVEFURSBWQVJJQUJMRVMgPT09PT09PT0gKi8KCiAgICAvKioKICAgICAqIEBkZXYgQSBtYXBwaW5nIGZyb20gdG9rZW4gSURzIHRvIHRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGVtLgogICAgICovCiAgICBtYXBwaW5nKHVpbnQgPT4gYWRkcmVzcykgdG9rZW5JZFRvT3duZXI7CgogICAgLyoqCiAgICAgKiBAZGV2IEEgbWFwcGluZyBmcm9tIHRva2VuIGlkcyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gY2FsbAogICAgICogIHRyYW5zZmVyRnJvbSgpLiBFYWNoIHRva2VuIGNhbiBvbmx5IGhhdmUgb25lIGFwcHJvdmVkIGFkZHJlc3MgZm9yIHRyYW5zZmVyCiAgICAgKiAgYXQgYW55IHRpbWUuIEEgemVybyB2YWx1ZSBtZWFucyBubyBhcHByb3ZhbCBpcyBvdXRzdGFuZGluZy4KICAgICAqLwogICAgbWFwcGluZyAodWludCA9PiBhZGRyZXNzKSB0b2tlbklkVG9BcHByb3ZlZDsKCiAgICAvKioKICAgICAqIEBkZXYgQSBtYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gaW5kZXggb2YgdGhlIG93bmVyVG9rZW5zJyB0b2tlbnMgbGlzdC4KICAgICAqLwogICAgbWFwcGluZyh1aW50ID0+IHVpbnQpIHRva2VuSWRUb093bmVyVG9rZW5zSW5kZXg7CgoKICAgIC8qID09PT09PT09IFBVQkxJQy9FWFRFUk5BTCBGVU5DVElPTlMgPT09PT09PT0gKi8KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRva2VucyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gb3duZXJUb2tlbnNbX293bmVyXS5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGFkZHJlc3MgY3VycmVudGx5IGFzc2lnbmVkIG93bmVyc2hpcCBvZiBhIGdpdmVuIHRva2VuLgogICAgICovCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQgX3Rva2VuSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUodG9rZW5JZFRvT3duZXJbX3Rva2VuSWRdICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICByZXR1cm4gdG9rZW5JZFRvT3duZXJbX3Rva2VuSWRdOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IFJldHVybnMgdGhlIGFwcHJvdmVkIGFkZHJlc3Mgb2YgYSBnaXZlbiB0b2tlbi4KICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlZEZvcih1aW50IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gdG9rZW5JZFRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBHZXQgYW4gYXJyYXkgb2YgSURzIG9mIGVhY2ggdG9rZW4gdGhhdCBhbiB1c2VyIG93bnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldE93bmVyVG9rZW5zKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludFtdKSB7CiAgICAgICAgcmV0dXJuIG93bmVyVG9rZW5zW19vd25lcl07CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IEV4dGVybmFsIGZ1bmN0aW9uIHRvIHRyYW5zZmVycyBhIHRva2VuIHRvIGFub3RoZXIgYWRkcmVzcy4KICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgICAqIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIHRva2VuIHRvIHRyYW5zZmVyLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgd2hlbk5vdFBhdXNlZCBleHRlcm5hbCB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwoKICAgICAgICAvLyBZb3UgY2FuIG9ubHkgc2VuZCB5b3VyIG93biB0b2tlbi4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCwgY2xlYXIgcGVuZGluZyBhcHByb3ZhbHMsIGVtaXQgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBHcmFudCBhbm90aGVyIGFkZHJlc3MgdGhlIHJpZ2h0IHRvIHRyYW5zZmVyIGEgc3BlY2lmaWMgS2l0dHkgdmlhCiAgICAgKiAgdHJhbnNmZXJGcm9tKCkuIFRoaXMgaXMgdGhlIHByZWZlcnJlZCBmbG93IGZvciB0cmFuc2ZlcmluZyBORlRzIHRvIGNvbnRyYWN0cy4KICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYmUgZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbC4gUGFzcyBhZGRyZXNzKDApIHRvCiAgICAgKiAgY2xlYXIgYWxsIGFwcHJvdmFscy4KICAgICAqIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIEtpdHR5IHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludCBfdG9rZW5JZCkgd2hlbk5vdFBhdXNlZCBleHRlcm5hbCB7CiAgICAgICAgLy8gT25seSBhbiBvd25lciBjYW4gZ3JhbnQgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWdpc3RlciB0aGUgYXBwcm92YWwgKHJlcGxhY2luZyBhbnkgcHJldmlvdXMgYXBwcm92YWwpLgogICAgICAgIF9hcHByb3ZlKF90b2tlbklkLCBfdG8pOwoKICAgICAgICAvLyBFbWl0IGFwcHJvdmFsIGV2ZW50LgogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUcmFuc2ZlciBhIEtpdHR5IG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nIGFkZHJlc3MKICAgICAqICBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGUgS2l0dHkgdG8gYmUgdHJhbnNmZXJlZC4KICAgICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCBzaG91bGQgdGFrZSBvd25lcnNoaXAgb2YgdGhlIEtpdHR5LiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAgKiAgaW5jbHVkaW5nIHRoZSBjYWxsZXIuCiAgICAgKiBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBLaXR0eSB0byBiZSB0cmFuc2ZlcnJlZC4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbklkKSB3aGVuTm90UGF1c2VkIGV4dGVybmFsIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIC8vIENoZWNrIGZvciBhcHByb3ZhbCBhbmQgdmFsaWQgb3duZXJzaGlwCiAgICAgICAgcmVxdWlyZSh0b2tlbklkVG9BcHByb3ZlZFtfdG9rZW5JZF0gPT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgoKICAgIC8qID09PT09PT09IElOVEVSTkFML1BSSVZBVEUgRlVOQ1RJT05TID09PT09PT09ICovCgogICAgLyoqCiAgICAgKiBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgdG9rZW4gdG8gYW4gYWRkcmVzcy4KICAgICAqLwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gU3RlcCAxOiBSZW1vdmUgdG9rZW4gZnJvbSBfZm9ybSBhZGRyZXNzLgogICAgICAgIC8vIFdoZW4gY3JlYXRpbmcgbmV3IHRva2VuLCBfZnJvbSBpcyAweDAuCiAgICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgdWludFtdIHN0b3JhZ2UgZnJvbVRva2VucyA9IG93bmVyVG9rZW5zW19mcm9tXTsKICAgICAgICAgICAgdWludCB0b2tlbkluZGV4ID0gdG9rZW5JZFRvT3duZXJUb2tlbnNJbmRleFtfdG9rZW5JZF07CgogICAgICAgICAgICAvLyBQdXQgdGhlIGxhc3QgdG9rZW4gdG8gdGhlIHRyYW5zZmVycmVkIHRva2VuIGluZGV4IGFuZCB1cGRhdGUgaXRzIGluZGV4IGluIG93bmVyVG9rZW5zSW5kZXhlcy4KICAgICAgICAgICAgdWludCBsYXN0VG9rZW5JZCA9IGZyb21Ub2tlbnNbZnJvbVRva2Vucy5sZW5ndGggLSAxXTsKCiAgICAgICAgICAgIC8vIERvIG5vdGhpbmcgaWYgdGhlIHRyYW5zZmVycmluZyB0b2tlbiBpcyB0aGUgbGFzdCBpdGVtLgogICAgICAgICAgICBpZiAoX3Rva2VuSWQgIT0gbGFzdFRva2VuSWQpIHsKICAgICAgICAgICAgICAgIGZyb21Ub2tlbnNbdG9rZW5JbmRleF0gPSBsYXN0VG9rZW5JZDsKICAgICAgICAgICAgICAgIHRva2VuSWRUb093bmVyVG9rZW5zSW5kZXhbbGFzdFRva2VuSWRdID0gdG9rZW5JbmRleDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnJvbVRva2Vucy5sZW5ndGgtLTsKICAgICAgICB9CgogICAgICAgIC8vIFN0ZXAgMjogQWRkIHRva2VuIHRvIF90byBhZGRyZXNzLgogICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcC4KICAgICAgICB0b2tlbklkVG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CgogICAgICAgIC8vIEFkZCB0aGUgX3Rva2VuSWQgdG8gb3duZXJUb2tlbnNbX3RvXSBhbmQgcmVtZW1iZXIgdGhlIGluZGV4IGluIG93bmVyVG9rZW5zSW5kZXhlcy4KICAgICAgICB0b2tlbklkVG9Pd25lclRva2Vuc0luZGV4W190b2tlbklkXSA9IG93bmVyVG9rZW5zW190b10ubGVuZ3RoOwogICAgICAgIG93bmVyVG9rZW5zW190b10ucHVzaChfdG9rZW5JZCk7CgogICAgICAgIC8vIEVtaXQgdGhlIFRyYW5zZmVyIGV2ZW50LgogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTWFya3MgYW4gYWRkcmVzcyBhcyBiZWluZyBhcHByb3ZlZCBmb3IgdHJhbnNmZXJGcm9tKCksIG92ZXJ3cml0aW5nIGFueSBwcmV2aW91cwogICAgICogIGFwcHJvdmFsLiBTZXR0aW5nIF9hcHByb3ZlZCB0byBhZGRyZXNzKDApIGNsZWFycyBhbGwgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9hcHByb3ZlKHVpbnQgX3Rva2VuSWQsIGFkZHJlc3MgX2FwcHJvdmVkKSBpbnRlcm5hbCB7CiAgICAgICAgdG9rZW5JZFRvQXBwcm92ZWRbX3Rva2VuSWRdID0gX2FwcHJvdmVkOwogICAgfQoKCiAgICAvKiA9PT09PT09PSBNT0RJRklFUlMgPT09PT09PT0gKi8KCiAgICAvKioKICAgICAqIEBkZXYgVGhyb3dzIGlmIF9kdW5nZW9uSWQgaXMgbm90IGNyZWF0ZWQgeWV0LgogICAgICovCiAgICBtb2RpZmllciB0b2tlbkV4aXN0cyh1aW50IF90b2tlbklkKSB7CiAgICAgICAgcmVxdWlyZShfdG9rZW5JZCA8IHRvdGFsU3VwcGx5KCkpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgaXMgdGhlIGN1cnJlbnQgb3duZXIgb2YgYSBwYXJ0aWN1bGFyIHRva2VuLgogICAgICogQHBhcmFtIF9jbGFpbWFudCBUaGUgYWRkcmVzcyB3ZSBhcmUgdmFsaWRhdGluZyBhZ2FpbnN0LgogICAgICogQHBhcmFtIF90b2tlbklkIFRva2VuIElECiAgICAgKi8KICAgIGZ1bmN0aW9uIF9vd25zKGFkZHJlc3MgX2NsYWltYW50LCB1aW50IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdG9rZW5JZFRvT3duZXJbX3Rva2VuSWRdID09IF9jbGFpbWFudDsKICAgIH0KCn0KCgpjb250cmFjdCBFRFN0cnVjdHMgewoKICAgIC8qKgogICAgICogQGRldiBUaGUgbWFpbiBEdW5nZW9uIHN0cnVjdC4gRXZlcnkgZHVuZ2VvbiBpbiB0aGUgZ2FtZSBpcyByZXByZXNlbnRlZCBieSB0aGlzIHN0cnVjdHVyZS4KICAgICAqIEEgZHVuZ2VvbiBpcyBjb25zaXN0cyBvZiBhbiB1bmxpbWl0ZWQgbnVtYmVyIG9mIGZsb29ycyBmb3IgeW91ciBoZXJvZXMgdG8gY2hhbGxlbmdlLAogICAgICogdGhlIHBvd2VyIGxldmVsIG9mIGEgZHVuZ2VvbiBpcyBlbmNvZGVkIGluIHRoZSBmbG9vckdlbmVzLiBTb21lIGR1bmdlb25zIGFyZSBpbiBmYWN0IG1vcmUgImNoYWxsZW5naW5nIiB0aGFuIG90aGVycywKICAgICAqIHRoZSBzZWNyZXQgZm9ybXVsYSBmb3IgdGhhdCBpcyBsZWZ0IGZvciB1c2VyIHRvIGZpbmQgb3V0LgogICAgICoKICAgICAqIEVhY2ggZHVuZ2VvbiBhbHNvIGhhcyBhICJ0cmFpbmluZyBhcmVhIiwgaGVyb2VzIGNhbiBwZXJmb3JtIHRyYWluaW5ncyBhbmQgdXBncmFkZSB0aGVpciBzdGF0LAogICAgICogYW5kIHNvbWUgZHVuZ2VvbnMgYXJlIG1vcmUgZWZmZWN0aXZlIGluIHRoZSB0cmFpbmluZywgd2hpY2ggaXMgYWxzbyBhIHNlY3JldCBmb3JtdWxhIQogICAgICoKICAgICAqIFdoZW4gcGxheWVyIGNoYWxsZW5nZSBvciBkbyB0cmFpbmluZyBpbiBhIGR1bmdlb24sIHRoZSBmZWUgd2lsbCBiZSBjb2xsZWN0ZWQgYXMgdGhlIGR1bmdlb24gcmV3YXJkcywKICAgICAqIHdoaWNoIHdpbGwgYmUgcmV3YXJkZWQgdG8gdGhlIHBsYXllciB3aG8gc3VjY2Vzc2Z1bGx5IGNoYWxsZW5nZWQgdGhlIGN1cnJlbnQgZmxvb3IuCiAgICAgKgogICAgICogRWFjaCBkdW5nZW9uIGZpdHMgaW4gZml0cyBpbnRvIHRocmVlIDI1Ni1iaXQgd29yZHMuCiAgICAgKi8KICAgIHN0cnVjdCBEdW5nZW9uIHsKCiAgICAgICAgLy8gRWFjaCBkdW5nZW9uIGhhcyBhbiBJRCB3aGljaCBpcyB0aGUgaW5kZXggaW4gdGhlIHN0b3JhZ2UgYXJyYXkuCgogICAgICAgIC8vIFRoZSB0aW1lc3RhbXAgb2YgdGhlIGJsb2NrIHdoZW4gdGhpcyBkdW5nZW9uIGlzIGNyZWF0ZWQuCiAgICAgICAgdWludDMyIGNyZWF0aW9uVGltZTsKCiAgICAgICAgLy8gVGhlIHN0YXR1cyBvZiB0aGUgZHVuZ2VvbiwgZWFjaCBkdW5nZW9uIGNhbiBoYXZlIDUgc3RhdHVzLCBuYW1lbHk6CiAgICAgICAgLy8gMDogQWN0aXZlIHwgMTogVHJhbnNwb3J0IE9ubHkgfCAyOiBDaGFsbGVuZ2UgT25seSB8IDM6IFRyYWluIE9ubHkgfCA0OiBJbkFjdGl2ZQogICAgICAgIHVpbnQ4IHN0YXR1czsKCiAgICAgICAgLy8gVGhlIGR1bmdlb24ncyBkaWZmaWN1bHR5LCB0aGUgaGlnaGVyIHRoZSBkaWZmaWN1bHR5LAogICAgICAgIC8vIG5vcm1hbGx5LCB0aGUgInJhcmVyIiB0aGUgc2VlZEdlbmVzLCB0aGUgaGlnaGVyIHRoZSBkaWZmY3VsdHksCiAgICAgICAgLy8gYW5kIHRoZSBoaWdoZXIgdGhlIGNvbnRyaWJ1dGlvbiBmZWUgaXQgaXMgdG8gY2hhbGxlbmdlLCB0cmFpbiwgYW5kIHRyYW5zcG9ydCB0byB0aGUgZHVuZ2VvbiwKICAgICAgICAvLyB0aGUgZm9ybXVsYSBmb3IgdGhlIGNvbnRyaWJ1dGlvbiBmZWUgaXMgaW4gRHVuZ2VvbkNoYWxsZW5nZSBhbmQgRHVuZ2VvblRyYWluaW5nIGNvbnRyYWN0cy4KICAgICAgICAvLyBBIGR1bmdlb24ncyBkaWZmaWN1bHR5IG5ldmVyIGNoYW5nZS4KICAgICAgICB1aW50OCBkaWZmaWN1bHR5OwoKICAgICAgICAvLyBUaGUgZHVuZ2VvbidzIGNhcGFjaXR5LCBtYXhpbXVtIG51bWJlciBvZiBwbGF5ZXJzIGFsbG93ZWQgdG8gc3RheSBvbiB0aGlzIGR1bmdlb24uCiAgICAgICAgLy8gVGhlIGNhcGFjaXR5IG9mIHRoZSBuZXdiaWUgZHVuZ2VvbiAoSG9seWxhbmQpIGlzIHNldCBhdCAwICh3aGljaCBpcyBpbmZpbml0eSkuCiAgICAgICAgLy8gVXNpbmcgMTYtYml0IHVuc2lnbmVkIGludGVnZXJzIGNhbiBoYXZlIGEgbWF4aW11bSBvZiA2NTUzNSBpbiBjYXBhY2l0eS4KICAgICAgICAvLyBBIGR1bmdlb24ncyBjYXBhY2l0eSBuZXZlciBjaGFuZ2UuCiAgICAgICAgdWludDE2IGNhcGFjaXR5OwoKICAgICAgICAvLyBUaGUgY3VycmVudCBmbG9vciBudW1iZXIsIGEgZHVuZ2VvbiBpcyBjb25zaXN0cyBvZiBhbiB1bWxpbWl0ZWQgbnVtYmVyIG9mIGZsb29ycywKICAgICAgICAvLyB3aGVuIHRoZXJlIGlzIGhlcm9lcyBzdWNjZXNzZnVsbHkgY2hhbGxlbmdlZCBhIGZsb29yLCB0aGUgbmV4dCBmbG9vciB3aWxsIGJlCiAgICAgICAgLy8gYXV0b21hdGljYWxseSBnZW5lcmF0ZWQuIFVzaW5nIDMyLWJpdCB1bnNpZ25lZCBpbnRlZ2VyIGNhbiBoYXZlIGEgbWF4aW11bSBvZiA0IGJpbGxpb24gZmxvb3JzLgogICAgICAgIHVpbnQzMiBmbG9vck51bWJlcjsKCiAgICAgICAgLy8gVGhlIHRpbWVzdGFtcCBvZiB0aGUgYmxvY2sgd2hlbiB0aGUgY3VycmVudCBmbG9vciBpcyBnZW5lcmF0ZWQuCiAgICAgICAgdWludDMyIGZsb29yQ3JlYXRpb25UaW1lOwoKICAgICAgICAvLyBDdXJyZW50IGFjY3VtdWxhdGVkIHJld2FyZHMsIHN1Y2Nlc3NmdWwgY2hhbGxlbmdlciB3aWxsIGdldCBhIGxhcmdlIHByb3BvcnRpb24gb2YgaXQuCiAgICAgICAgdWludDEyOCByZXdhcmRzOwoKICAgICAgICAvLyBUaGUgc2VlZCBnZW5lcyBvZiB0aGUgZHVuZ2VvbiwgaXQgaXMgdXNlZCBhcyB0aGUgYmFzZSBnZW5lIGZvciBmaXJzdCBmbG9vciwKICAgICAgICAvLyBzb21lIGR1bmdlb25zIGFyZSByYXJlciBhbmQgc29tZSBhcmUgbW9yZSBjb21tb24sIHRoZSBleGFjdCBkZXRhaWxzIGFyZSwKICAgICAgICAvLyBvZiBjb3Vyc2UsIHRvcCBzZWNyZXQgb2YgdGhlIGdhbWUhCiAgICAgICAgLy8gQSBkdW5nZW9uJ3Mgc2VlZEdlbmVzIG5ldmVyIGNoYW5nZS4KICAgICAgICB1aW50IHNlZWRHZW5lczsKCiAgICAgICAgLy8gVGhlIGdlbmVzIGZvciBjdXJyZW50IGZsb29yLCBpdCBlbmNvZGVzIHRoZSBkaWZmaWN1bHR5IGxldmVsIG9mIHRoZSBjdXJyZW50IGZsb29yLgogICAgICAgIC8vIFdlIGNvbnNpZGVyZWQgd2hldGhlciB0byBzdG9yZSB0aGUgZW50aXJlIGFycmF5IG9mIGdlbmVzIGZvciBhbGwgZmxvb3JzLCBidXQKICAgICAgICAvLyBpbiBvcmRlciB0byBzYXZlIHNvbWUgcHJlY2lvdXMgZ2FzIHdlJ3JlIHdpbGxpbmcgdG8gc2FjcmlmaWNlIHNvbWUgZnVuY3Rpb25hbGl0aWVzIHdpdGggdGhhdC4KICAgICAgICB1aW50IGZsb29yR2VuZXM7CgogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaGUgbWFpbiBIZXJvIHN0cnVjdC4gRXZlcnkgaGVybyBpbiB0aGUgZ2FtZSBpcyByZXByZXNlbnRlZCBieSB0aGlzIHN0cnVjdHVyZS4KICAgICAqLwogICAgc3RydWN0IEhlcm8gewoKICAgICAgICAvLyBFYWNoIGhlcm8gaGFzIGFuIElEIHdoaWNoIGlzIHRoZSBpbmRleCBpbiB0aGUgc3RvcmFnZSBhcnJheS4KCiAgICAgICAgLy8gVGhlIHRpbWVzdGFtcCBvZiB0aGUgYmxvY2sgd2hlbiB0aGlzIGR1bmdlb24gaXMgY3JlYXRlZC4KICAgICAgICB1aW50NjQgY3JlYXRpb25UaW1lOwoKICAgICAgICAvLyBUaGUgdGltZXN0YW1wIG9mIHRoZSBibG9jayB3aGVyZSBhIGNoYWxsZW5nZSBpcyBwZXJmb3JtZWQsIHVzZWQgdG8gY2FsY3VsYXRlIHdoZW4gYSBoZXJvIGlzIGFsbG93ZWQgdG8gZW5nYWdlIGluIGFub3RoZXIgY2hhbGxlbmdlLgogICAgICAgIHVpbnQ2NCBjb29sZG93blN0YXJ0VGltZTsKCiAgICAgICAgLy8gRXZlcnkgdGltZSBhIGhlcm8gY2hhbGxlbmdlIGEgZHVuZ2VvbiwgaXRzIGNvb2xkb3duIGluZGV4IHdpbGwgYmUgaW5jcmVtZW50ZWQgYnkgb25lLgogICAgICAgIHVpbnQzMiBjb29sZG93bkluZGV4OwoKICAgICAgICAvLyBUaGUgc2VlZCBvZiB0aGUgaGVybywgdGhlIGdlbmUgZW5jb2RlcyB0aGUgcG93ZXIgbGV2ZWwgb2YgdGhlIGhlcm8uCiAgICAgICAgLy8gVGhpcyBpcyBhbm90aGVyIHRvcCBzZWNyZXQgb2YgdGhlIGdhbWUhIEhlcm8ncyBnZW5lIGNhbiBiZSB1cGdyYWRlZCB2aWEKICAgICAgICAvLyB0cmFpbmluZyBpbiBhIGR1bmdlb24uCiAgICAgICAgdWludCBnZW5lczsKCiAgICB9Cgp9CgoKY29udHJhY3QgRHVuZ2VvblRva2VuSW50ZXJmYWNlIGlzIEVSQzcyMSwgRURTdHJ1Y3RzIHsKCiAgICAvKioKICAgICAqIEBub3RpY2UgTGltaXRzIHRoZSBudW1iZXIgb2YgZHVuZ2VvbnMgdGhlIGNvbnRyYWN0IG93bmVyIGNhbiBldmVyIGNyZWF0ZS4KICAgICAqLwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRFVOR0VPTl9DUkVBVElPTl9MSU1JVCA9IDEwMjQ7CgogICAgLyoqCiAgICAgKiBAZGV2IE5hbWUgb2YgdG9rZW4uCiAgICAgKi8KICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJEdW5nZW9uIjsKCiAgICAvKioKICAgICAqIEBkZXYgU3ltYm9sIG9mIHRva2VuLgogICAgICovCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IHN5bWJvbCA9ICJEVU5HIjsKCiAgICAvKioKICAgICAqIEBkZXYgQW4gYXJyYXkgY29udGFpbmluZyB0aGUgRHVuZ2VvbiBzdHJ1Y3QsIHdoaWNoIGNvbnRhaW5zIGFsbCB0aGUgZHVuZ2VvbnMgaW4gZXhpc3RhbmNlLgogICAgICogIFRoZSBJRCBmb3IgZWFjaCBkdW5nZW9uIGlzIHRoZSBpbmRleCBvZiB0aGlzIGFycmF5LgogICAgICovCiAgICBEdW5nZW9uW10gcHVibGljIGR1bmdlb25zOwoKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgbmV3IGR1bmdlb24gYW5kIHN0b3JlcyBpdCwgb25seSBjb250cmFjdCBvd25lcnMKICAgICAqICBjYW4gY3JlYXRlIG5ldyB0b2tlbiwgYW5kIHdpbGwgYmUgcmVzdHJpY3RlZCBieSB0aGUgRFVOR0VPTl9DUkVBVElPTl9MSU1JVC4KICAgICAqICBXaWxsIGdlbmVyYXRlIGEgTWludCBldmVudCwgYSAgTmV3RHVuZ2VvbkZsb29yIGV2ZW50LCBhbmQgYSBUcmFuc2ZlciBldmVudC4KICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlRHVuZ2Vvbih1aW50IF9kaWZmaWN1bHR5LCB1aW50IF9jYXBhY2l0eSwgdWludCBfZmxvb3JOdW1iZXIsIHVpbnQgX3NlZWRHZW5lcywgdWludCBfZmxvb3JHZW5lcywgYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gc2V0IGR1bmdlb24gc3RhdHVzIGJ5IGl0cyBJRCwKICAgICAqICByZWZlciB0byBEdW5nZW9uU3RydWN0cyBmb3IgbW9yZSBpbmZvcm1hdGlvbiBhYm91dCBkdW5nZW9uIHN0YXR1cy4KICAgICAqICBPbmx5IGNvbnRyYWN0IG93bmVycyBjYW4gYWx0ZXIgZHVuZ2VvbiBzdGF0ZS4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0RHVuZ2VvblN0YXR1cyh1aW50IF9pZCwgdWludCBfbmV3U3RhdHVzKSBleHRlcm5hbDsKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIGV4dGVybmFsIGZ1bmN0aW9uIHRvIGFkZCBhZGRpdGlvbmFsIGR1bmdlb24gcmV3YXJkcyBieSBpdHMgSUQsCiAgICAgKiAgb25seSBjb250cmFjdCBvd25lcnMgY2FuIGFsdGVyIGR1bmdlb24gc3RhdGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZER1bmdlb25SZXdhcmRzKHVpbnQgX2lkLCB1aW50IF9hZGRpdGluYWxSZXdhcmRzKSBleHRlcm5hbDsKCiAgICAvKioKICAgICAqIEBkZXYgVGhlIGV4dGVybmFsIGZ1bmN0aW9uIHRvIGFkZCBhbm90aGVyIGR1bmdlb24gZmxvb3IgYnkgaXRzIElELAogICAgICogIG9ubHkgY29udHJhY3Qgb3duZXJzIGNhbiBhbHRlciBkdW5nZW9uIHN0YXRlLgogICAgICovCiAgICBmdW5jdGlvbiBhZGREdW5nZW9uTmV3Rmxvb3IodWludCBfaWQsIHVpbnQgX25ld1Jld2FyZHMsIHVpbnQgX25ld0Zsb29yR2VuZXMpIGV4dGVybmFsOwoKfQoKCi8qKgogKiBAdGl0bGUgVGhlIEVSQy03MjEgY29tcGxpYW5jZSB0b2tlbiBjb250cmFjdCBmb3IgdGhlIER1bmdlb24gdG9rZW5zLgogKiBAZGV2IFNlZSB0aGUgRHVuZ2VvblN0cnVjdHMgY29udHJhY3QgdG8gc2VlIHRoZSBkZXRhaWxzIG9mIHRoZSBEdW5nZW9uIHRva2VuIGRhdGEgc3RydWN0dXJlLgogKi8KY29udHJhY3QgRHVuZ2VvblRva2VuIGlzIER1bmdlb25Ub2tlbkludGVyZmFjZSwgRVJDNzIxVG9rZW4sIEpvaW50T3duYWJsZSB7CgoKICAgIC8qID09PT09PT09IEVWRU5UUyA9PT09PT09PSAqLwoKICAgIC8qKgogICAgICogQGRldiBUaGUgTWludCBldmVudCBpcyBmaXJlZCB3aGVuZXZlciBhIG5ldyBkdW5nZW9uIGlzIGNyZWF0ZWQuCiAgICAgKi8KICAgIGV2ZW50IE1pbnQoYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50IG5ld1Rva2VuSWQsIHVpbnQgZGlmZmljdWx0eSwgdWludCBjYXBhY2l0eSwgdWludCBzZWVkR2VuZXMpOwoKCiAgICAvKiA9PT09PT09PSBQVUJMSUMvRVhURVJOQUwgRlVOQ1RJT05TID09PT09PT09ICovCgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMgY3VycmVudGx5IGluIGV4aXN0ZW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGR1bmdlb25zLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVGhlIGV4dGVybmFsIGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIG5ldyBkdW5nZW9uIGFuZCBzdG9yZXMgaXQsIG9ubHkgY29udHJhY3Qgb3duZXJzCiAgICAgKiAgY2FuIGNyZWF0ZSBuZXcgdG9rZW4sIGFuZCB3aWxsIGJlIHJlc3RyaWN0ZWQgYnkgdGhlIERVTkdFT05fQ1JFQVRJT05fTElNSVQuCiAgICAgKiAgV2lsbCBnZW5lcmF0ZSBhIE1pbnQgZXZlbnQsIGEgIE5ld0R1bmdlb25GbG9vciBldmVudCwgYW5kIGEgVHJhbnNmZXIgZXZlbnQuCiAgICAgKiBAcGFyYW0gX2RpZmZpY3VsdHkgVGhlIGRpZmZpY3VsdHkgb2YgdGhlIG5ldyBkdW5nZW9uLgogICAgICogQHBhcmFtIF9jYXBhY2l0eSBUaGUgY2FwYWNpdHkgb2YgdGhlIG5ldyBkdW5nZW9uLgogICAgICogQHBhcmFtIF9mbG9vck51bWJlciBUaGUgaW5pdGlhbCBmbG9vciBudW1iZXIgb2YgdGhlIG5ldyBkdW5nZW9uLgogICAgICogQHBhcmFtIF9zZWVkR2VuZXMgVGhlIHNlZWQgZ2VuZXMgb2YgdGhlIG5ldyBkdW5nZW9uLgogICAgICogQHBhcmFtIF9mbG9vckdlbmVzIFRoZSBpbml0aWFsIGdlbmVzIG9mIHRoZSBkdW5nZW9uIGZsb29yLgogICAgICogQHJldHVybiBUaGUgZHVuZ2VvbiBJRCBvZiB0aGUgbmV3IGR1bmdlb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZUR1bmdlb24odWludCBfZGlmZmljdWx0eSwgdWludCBfY2FwYWNpdHksIHVpbnQgX2Zsb29yTnVtYmVyLCB1aW50IF9zZWVkR2VuZXMsIHVpbnQgX2Zsb29yR2VuZXMsIGFkZHJlc3MgX293bmVyKSBlaXRoZXJPd25lciBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9jcmVhdGVEdW5nZW9uKF9kaWZmaWN1bHR5LCBfY2FwYWNpdHksIF9mbG9vck51bWJlciwgMCwgX3NlZWRHZW5lcywgX2Zsb29yR2VuZXMsIF9vd25lcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBleHRlcm5hbCBmdW5jdGlvbiB0byBzZXQgZHVuZ2VvbiBzdGF0dXMgYnkgaXRzIElELAogICAgICogIHJlZmVyIHRvIER1bmdlb25TdHJ1Y3RzIGZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0IGR1bmdlb24gc3RhdHVzLgogICAgICogIE9ubHkgY29udHJhY3Qgb3duZXJzIGNhbiBhbHRlciBkdW5nZW9uIHN0YXRlLgogICAgICovCiAgICBmdW5jdGlvbiBzZXREdW5nZW9uU3RhdHVzKHVpbnQgX2lkLCB1aW50IF9uZXdTdGF0dXMpIGVpdGhlck93bmVyIHRva2VuRXhpc3RzKF9pZCkgZXh0ZXJuYWwgewogICAgICAgIGR1bmdlb25zW19pZF0uc3RhdHVzID0gdWludDgoX25ld1N0YXR1cyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRoZSBleHRlcm5hbCBmdW5jdGlvbiB0byBhZGQgYWRkaXRpb25hbCBkdW5nZW9uIHJld2FyZHMgYnkgaXRzIElELAogICAgICogIG9ubHkgY29udHJhY3Qgb3duZXJzIGNhbiBhbHRlciBkdW5nZW9uIHN0YXRlLgogICAgICovCiAgICBmdW5jdGlvbiBhZGREdW5nZW9uUmV3YXJkcyh1aW50IF9pZCwgdWludCBfYWRkaXRpbmFsUmV3YXJkcykgZWl0aGVyT3duZXIgdG9rZW5FeGlzdHMoX2lkKSBleHRlcm5hbCB7CiAgICAgICAgZHVuZ2VvbnNbX2lkXS5yZXdhcmRzICs9IHVpbnQxMjgoX2FkZGl0aW5hbFJld2FyZHMpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBUaGUgZXh0ZXJuYWwgZnVuY3Rpb24gdG8gYWRkIGFub3RoZXIgZHVuZ2VvbiBmbG9vciBieSBpdHMgSUQsCiAgICAgKiAgb25seSBjb250cmFjdCBvd25lcnMgY2FuIGFsdGVyIGR1bmdlb24gc3RhdGUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFkZER1bmdlb25OZXdGbG9vcih1aW50IF9pZCwgdWludCBfbmV3UmV3YXJkcywgdWludCBfbmV3Rmxvb3JHZW5lcykgZWl0aGVyT3duZXIgdG9rZW5FeGlzdHMoX2lkKSBleHRlcm5hbCB7CiAgICAgICAgRHVuZ2VvbiBzdG9yYWdlIGR1bmdlb24gPSBkdW5nZW9uc1tfaWRdOwoKICAgICAgICBkdW5nZW9uLmZsb29yTnVtYmVyKys7CiAgICAgICAgZHVuZ2Vvbi5mbG9vckNyZWF0aW9uVGltZSA9IHVpbnQzMihub3cpOwogICAgICAgIGR1bmdlb24ucmV3YXJkcyA9IHVpbnQxMjgoX25ld1Jld2FyZHMpOwogICAgICAgIGR1bmdlb24uZmxvb3JHZW5lcyA9IF9uZXdGbG9vckdlbmVzOwogICAgfQoKCiAgICAvKiA9PT09PT09PSBQUklWQVRFL0lOVEVSTkFMIEZVTkNUSU9OUyA9PT09PT09PSAqLwoKICAgIGZ1bmN0aW9uIF9jcmVhdGVEdW5nZW9uKHVpbnQgX2RpZmZpY3VsdHksIHVpbnQgX2NhcGFjaXR5LCB1aW50IF9mbG9vck51bWJlciwgdWludCBfcmV3YXJkcywgdWludCBfc2VlZEdlbmVzLCB1aW50IF9mbG9vckdlbmVzLCBhZGRyZXNzIF9vd25lcikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gRW5zdXJlIHRoZSB0b3RhbCBzdXBwbHkgaXMgd2l0aGluIHRoZSBmaXhlZCBsaW1pdC4KICAgICAgICByZXF1aXJlKHRvdGFsU3VwcGx5KCkgPCBEVU5HRU9OX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgLy8gKiogU1RPUkFHRSBVUERBVEUgKioKICAgICAgICAvLyBDcmVhdGUgYSBuZXcgZHVuZ2Vvbi4KICAgICAgICBkdW5nZW9ucy5wdXNoKER1bmdlb24odWludDMyKG5vdyksIDAsIHVpbnQ4KF9kaWZmaWN1bHR5KSwgdWludDE2KF9jYXBhY2l0eSksIHVpbnQzMihfZmxvb3JOdW1iZXIpLCB1aW50MzIobm93KSwgdWludDEyOChfcmV3YXJkcyksIF9zZWVkR2VuZXMsIF9mbG9vckdlbmVzKSk7CgogICAgICAgIC8vIFRva2VuIGlkIGlzIHRoZSBpbmRleCBpbiB0aGUgc3RvcmFnZSBhcnJheS4KICAgICAgICB1aW50IG5ld1Rva2VuSWQgPSBkdW5nZW9ucy5sZW5ndGggLSAxOwoKICAgICAgICAvLyBFbWl0IHRoZSB0b2tlbiBtaW50IGV2ZW50LgogICAgICAgIE1pbnQoX293bmVyLCBuZXdUb2tlbklkLCBfZGlmZmljdWx0eSwgX2NhcGFjaXR5LCBfc2VlZEdlbmVzKTsKCiAgICAgICAgLy8gVGhpcyB3aWxsIGFzc2lnbiBvd25lcnNoaXAsIGFuZCBhbHNvIGVtaXQgdGhlIFRyYW5zZmVyIGV2ZW50LgogICAgICAgIF90cmFuc2ZlcigwLCBfb3duZXIsIG5ld1Rva2VuSWQpOwoKICAgICAgICByZXR1cm4gbmV3VG9rZW5JZDsKICAgIH0KCgogICAgLyogPT09PT09PT0gTUlHUkFUSU9OIEZVTkNUSU9OUyA9PT09PT09PSAqLwoKCiAgICAvKioKICAgICAqIEBkZXYgU2luY2UgdGhlIER1bmdlb25Ub2tlbiBjb250cmFjdCBpcyByZS1kZXBsb3llZCBkdWUgdG8gb3B0aW1pemF0aW9uLgogICAgICogIFdlIG5lZWQgdG8gbWlncmF0ZSBhbGwgZHVuZ2VvbnMgZnJvbSBCZXRhIHRva2VuIGNvbnRyYWN0IHRvIFZlcnNpb24gMS4KICAgICAqLwogICAgZnVuY3Rpb24gbWlncmF0ZUR1bmdlb24odWludCBfZGlmZmljdWx0eSwgdWludCBfY2FwYWNpdHksIHVpbnQgX2Zsb29yTnVtYmVyLCB1aW50IF9yZXdhcmRzLCB1aW50IF9zZWVkR2VuZXMsIHVpbnQgX2Zsb29yR2VuZXMsIGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB7CiAgICAgICAgLy8gTWlncmF0aW9uIHdpbGwgYmUgZmluaXNoZWQgYmVmb3JlIG1haW50ZW5hbmNlIHBlcmlvZCBlbmRzLCB0eC5vcmlnaW4gaXMgdXNlZCB3aXRoaW4gYSBzaG9ydCBwZXJpb2Qgb25seS4KICAgICAgICByZXF1aXJlKG5vdyA8IDE1MjA2OTQwMDAgJiYgdHgub3JpZ2luID09IDB4NDcxNjlmNzg3NTBCZTFlNmVjMkRFYjI5NzQ0NThhYzRGODc1MTcxNCk7CgogICAgICAgIF9jcmVhdGVEdW5nZW9uKF9kaWZmaWN1bHR5LCBfY2FwYWNpdHksIF9mbG9vck51bWJlciwgX3Jld2FyZHMsIF9zZWVkR2VuZXMsIF9mbG9vckdlbmVzLCBfb3duZXIpOwogICAgfQoKfQoKCi8qKgogKiBAdGl0bGUgRVJDNzIxRHV0Y2hBdWN0aW9uCiAqIEBkZXYgRHV0Y2ggYXVjdGlvbiAvIERlY3JlYXNpbmcgY2xvY2sgYXVjdGlvbiBmb3IgRVJDNzIxIHRva2Vucy4KICovCmNvbnRyYWN0IEVSQzcyMUR1dGNoQXVjdGlvbiBpcyBPd25hYmxlLCBQYXVzYWJsZSB7CgogICAgLyogPT09PT09PT0gU1RSVUNUUy9FTlVNUyA9PT09PT09PSAqLwoKICAgIC8vIFJlcHJlc2VudHMgYW4gYXVjdGlvbiBvZiBhbiBFUkM3MjEgdG9rZW4uCiAgICBzdHJ1Y3QgQXVjdGlvbiB7CgogICAgICAgIC8vIEN1cnJlbnQgb3duZXIgb2YgdGhlIEVSQzcyMSB0b2tlbi4KICAgICAgICBhZGRyZXNzIHNlbGxlcjsKCiAgICAgICAgLy8gUHJpY2UgKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24uCiAgICAgICAgdWludDEyOCBzdGFydGluZ1ByaWNlOwoKICAgICAgICAvLyBQcmljZSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgICAgICB1aW50MTI4IGVuZGluZ1ByaWNlOwoKICAgICAgICAvLyBEdXJhdGlvbiAoaW4gc2Vjb25kcykgb2YgYXVjdGlvbi4KICAgICAgICB1aW50NjQgZHVyYXRpb247CgogICAgICAgIC8vIFRpbWUgd2hlbiBhdWN0aW9uIHN0YXJ0ZWQuCiAgICAgICAgLy8gTk9URTogMCBpZiB0aGlzIGF1Y3Rpb24gaGFzIGJlZW4gY29uY2x1ZGVkLgogICAgICAgIHVpbnQ2NCBzdGFydGVkQXQ7CgogICAgfQoKCiAgICAvKiA9PT09PT09PSBDT05UUkFDVFMgPT09PT09PT0gKi8KCiAgICAvLyBSZWZlcmVuY2UgdG8gY29udHJhY3QgdHJhY2tpbmcgRVJDNzIxIHRva2VuIG93bmVyc2hpcC4KICAgIEVSQzcyMSBwdWJsaWMgbm9uRnVuZ2libGVDb250cmFjdDsKCgogICAgLyogPT09PT09PT0gU1RBVEUgVkFSSUFCTEVTID09PT09PT09ICovCgogICAgLy8gQ3V0IG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbWVhc3VyZWQgaW4gYmFzaXMgcG9pbnRzICgxLzEwMCBvZiBhIHBlcmNlbnQpLgogICAgLy8gVmFsdWVzIDAtMTAsMDAwIG1hcCB0byAwJS0xMDAlCiAgICB1aW50IHB1YmxpYyBvd25lckN1dDsKCiAgICAvLyBNYXAgZnJvbSB0b2tlbiBJRCB0byB0aGVpciBjb3JyZXNwb25kaW5nIGF1Y3Rpb24uCiAgICBtYXBwaW5nICh1aW50ID0+IEF1Y3Rpb24pIHRva2VuSWRUb0F1Y3Rpb247CgoKICAgIC8qID09PT09PT09IEVWRU5UUyA9PT09PT09PSAqLwoKICAgIGV2ZW50IEF1Y3Rpb25DcmVhdGVkKHVpbnQgdGltZXN0YW1wLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50IGluZGV4ZWQgdG9rZW5JZCwgdWludCBzdGFydGluZ1ByaWNlLCB1aW50IGVuZGluZ1ByaWNlLCB1aW50IGR1cmF0aW9uKTsKICAgIGV2ZW50IEF1Y3Rpb25TdWNjZXNzZnVsKHVpbnQgdGltZXN0YW1wLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50IGluZGV4ZWQgdG9rZW5JZCwgdWludCB0b3RhbFByaWNlLCBhZGRyZXNzIHdpbm5lcik7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQgdGltZXN0YW1wLCBhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50IGluZGV4ZWQgdG9rZW5JZCk7CgogICAgLyoqCiAgICAgKiBAZGV2IENvbnN0cnVjdG9yIGNyZWF0ZXMgYSByZWZlcmVuY2UgdG8gdGhlIEVSQzcyMSB0b2tlbiBvd25lcnNoaXAgY29udHJhY3QgYW5kIHZlcmlmaWVzIHRoZSBvd25lciBjdXQgaXMgaW4gdGhlIHZhbGlkIHJhbmdlLgogICAgICogQHBhcmFtIF90b2tlbkFkZHJlc3MgLSBhZGRyZXNzIG9mIGEgZGVwbG95ZWQgY29udHJhY3QgaW1wbGVtZW50aW5nIHRoZSBOb25mdW5naWJsZSBJbnRlcmZhY2UuCiAgICAgKiBAcGFyYW0gX293bmVyQ3V0IC0gcGVyY2VudCBjdXQgdGhlIG93bmVyIHRha2VzIG9uIGVhY2ggYXVjdGlvbiwgbXVzdCBiZSBiZXR3ZWVuIDAtMTAsMDAwLgogICAgICovCiAgICBmdW5jdGlvbiBFUkM3MjFEdXRjaEF1Y3Rpb24oYWRkcmVzcyBfdG9rZW5BZGRyZXNzLCB1aW50IF9vd25lckN1dCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKF9vd25lckN1dCA8PSAxMDAwMCk7CgogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QgPSBFUkM3MjEoX3Rva2VuQWRkcmVzcyk7CiAgICAgICAgb3duZXJDdXQgPSBfb3duZXJDdXQ7CiAgICB9CgoKICAgIC8qID09PT09PT09IFBVQkxJQy9FWFRFUk5BTCBGVU5DVElPTlMgPT09PT09PT0gKi8KCiAgICAvKioKICAgICAqIEBkZXYgQmlkcyBvbiBhbiBvcGVuIGF1Y3Rpb24sIGNvbXBsZXRpbmcgdGhlIGF1Y3Rpb24gYW5kIHRyYW5zZmVycmluZwogICAgICogIG93bmVyc2hpcCBvZiB0aGUgdG9rZW4gaWYgZW5vdWdoIEV0aGVyIGlzIHN1cHBsaWVkLgogICAgICogQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gdG8gYmlkIG9uLgogICAgICovCiAgICBmdW5jdGlvbiBiaWQodWludCBfdG9rZW5JZCkgd2hlbk5vdFBhdXNlZCBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAvLyBfYmlkIHdpbGwgdGhyb3cgaWYgdGhlIGJpZCBvciBmdW5kcyB0cmFuc2ZlciBmYWlscy4KICAgICAgICBfYmlkKF90b2tlbklkLCBtc2cudmFsdWUpOwoKICAgICAgICAvLyBUcmFuc2ZlcnMgdGhlIHRva2VuIG93bmVkIGJ5IHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciBhZGRyZXNzLiBJdCB3aWxsIHRocm93IGlmIHRyYW5zZmVyIGZhaWxzLgogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuSWQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gdGhhdCBoYXNuJ3QgYmVlbiB3b24geWV0LiBSZXR1cm5zIHRoZSB0b2tlbiB0byBvcmlnaW5hbCBvd25lci4KICAgICAqIEBub3RpY2UgVGhpcyBpcyBhIHN0YXRlLW1vZGlmeWluZyBmdW5jdGlvbiB0aGF0IGNhbiBiZSBjYWxsZWQgd2hpbGUgdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgICAqIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRva2VuIG9uIGF1Y3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbih1aW50IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgIGFkZHJlc3Mgc2VsbGVyID0gYXVjdGlvbi5zZWxsZXI7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGxlcik7CgogICAgICAgIF9jYW5jZWxBdWN0aW9uKF90b2tlbklkLCBzZWxsZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAgICogIE9ubHkgdGhlIG93bmVyIG1heSBkbyB0aGlzLCBhbmQgdG9rZW5zIGFyZSByZXR1cm5lZCB0bwogICAgICogIHRoZSBzZWxsZXIuIFRoaXMgc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiBlbWVyZ2VuY2llcy4KICAgICAqIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSB0b2tlbiBvbiBhdWN0aW9uIHRvIGNhbmNlbC4KICAgICAqLwogICAgZnVuY3Rpb24gY2FuY2VsQXVjdGlvbldoZW5QYXVzZWQodWludCBfdG9rZW5JZCkgd2hlblBhdXNlZCBvbmx5T3duZXIgZXh0ZXJuYWwgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwoKICAgICAgICBfY2FuY2VsQXVjdGlvbihfdG9rZW5JZCwgYXVjdGlvbi5zZWxsZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZW1vdmUgYWxsIEV0aGVyIGZyb20gdGhlIGNvbnRyYWN0LCB3aGljaCBpcyB0aGUgb3duZXIncyBjdXRzCiAgICAgKiAgYXMgd2VsbCBhcyBhbnkgRXRoZXIgc2VudCBkaXJlY3RseSB0byB0aGUgY29udHJhY3QgYWRkcmVzcy4KICAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgb25seU93bmVyIGV4dGVybmFsIHsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgYXVjdGlvbiBpbmZvIGZvciBhbiB0b2tlbiBvbiBhdWN0aW9uLgogICAgICogQHBhcmFtIF90b2tlbklkIC0gSUQgb2YgdG9rZW4gb24gYXVjdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgIGFkZHJlc3Mgc2VsbGVyLAogICAgICAgIHVpbnQgc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50IGVuZGluZ1ByaWNlLAogICAgICAgIHVpbnQgZHVyYXRpb24sCiAgICAgICAgdWludCBzdGFydGVkQXQKICAgICkgewogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwoKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBhdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgYXVjdGlvbi5zdGFydGluZ1ByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBhdWN0aW9uLmR1cmF0aW9uLAogICAgICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXVjdGlvbi4KICAgICAqIEBwYXJhbSBfdG9rZW5JZCAtIElEIG9mIHRoZSB0b2tlbiBwcmljZSB3ZSBhcmUgY2hlY2tpbmcuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSh1aW50IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKCiAgICAgICAgcmV0dXJuIF9jb21wdXRlQ3VycmVudFByaWNlKGF1Y3Rpb24pOwogICAgfQoKCiAgICAvKiA9PT09PT09PSBJTlRFUk5BTC9QUklWQVRFIEZVTkNUSU9OUyA9PT09PT09PSAqLwoKICAgIC8qKgogICAgICogQGRldiBDcmVhdGVzIGFuZCBiZWdpbnMgYSBuZXcgYXVjdGlvbi4gUGVyZm9ybSBhbGwgdGhlIGNoZWNraW5ncyBuZWNlc3NhcnkuCiAgICAgKiBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgICAqIEBwYXJhbSBfc3RhcnRpbmdQcmljZSAtIFByaWNlIG9mIGl0ZW0gKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24uCiAgICAgKiBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgICAqIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgdGltZSB0byBtb3ZlIGJldHdlZW4gc3RhcnRpbmcKICAgICAqICBwcmljZSBhbmQgZW5kaW5nIHByaWNlIChpbiBzZWNvbmRzKS4KICAgICAqIEBwYXJhbSBfc2VsbGVyIC0gU2VsbGVyLCBpZiBub3QgdGhlIG1lc3NhZ2Ugc2VuZGVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9jcmVhdGVBdWN0aW9uKAogICAgICAgIHVpbnQgX3Rva2VuSWQsCiAgICAgICAgdWludCBfc3RhcnRpbmdQcmljZSwKICAgICAgICB1aW50IF9lbmRpbmdQcmljZSwKICAgICAgICB1aW50IF9kdXJhdGlvbiwKICAgICAgICBhZGRyZXNzIF9zZWxsZXIKICAgICkgaW50ZXJuYWwgewogICAgICAgIC8vIFNhbml0eSBjaGVjayB0aGF0IG5vIGlucHV0cyBvdmVyZmxvdyBob3cgbWFueSBiaXRzIHdlJ3ZlIGFsbG9jYXRlZCB0byBzdG9yZSB0aGVtIGluIHRoZSBhdWN0aW9uIHN0cnVjdC4KICAgICAgICByZXF1aXJlKF9zdGFydGluZ1ByaWNlID09IHVpbnQodWludDEyOChfc3RhcnRpbmdQcmljZSkpKTsKICAgICAgICByZXF1aXJlKF9lbmRpbmdQcmljZSA9PSB1aW50KHVpbnQxMjgoX2VuZGluZ1ByaWNlKSkpOwogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID09IHVpbnQodWludDY0KF9kdXJhdGlvbikpKTsKCiAgICAgICAgLy8gSWYgdGhlIHRva2VuIGlzIGFscmVhZHkgb24gYW55IGF1Y3Rpb24sIHRoaXMgd2lsbCB0aHJvdwogICAgICAgIC8vIGJlY2F1c2UgaXQgd2lsbCBiZSBvd25lZCBieSB0aGUgYXVjdGlvbiBjb250cmFjdC4KICAgICAgICByZXF1aXJlKG5vbkZ1bmdpYmxlQ29udHJhY3Qub3duZXJPZihfdG9rZW5JZCkgPT0gbXNnLnNlbmRlcik7CgogICAgICAgIC8vIFRocm93IGlmIHRoZSBfZW5kaW5nUHJpY2UgaXMgbGFyZ2VyIHRoYW4gX3N0YXJ0aW5nUHJpY2UuCiAgICAgICAgcmVxdWlyZShfc3RhcnRpbmdQcmljZSA+PSBfZW5kaW5nUHJpY2UpOwoKICAgICAgICAvLyBSZXF1aXJlIHRoYXQgYWxsIGF1Y3Rpb25zIGhhdmUgYSBkdXJhdGlvbiBvZiBhdCBsZWFzdCBvbmUgbWludXRlLgogICAgICAgIHJlcXVpcmUoX2R1cmF0aW9uID49IDEgbWludXRlcyk7CgogICAgICAgIC8vIFRyYW5zZmVyIHRoZSB0b2tlbiBmcm9tIGl0cyBvd25lciB0byB0aGlzIGNvbnRyYWN0LiBJdCB3aWxsIHRocm93IGlmIHRyYW5zZmVyIGZhaWxzLgogICAgICAgIG5vbkZ1bmdpYmxlQ29udHJhY3QudHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF90b2tlbklkKTsKCiAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgICAgIF9zZWxsZXIsCiAgICAgICAgICAgIHVpbnQxMjgoX3N0YXJ0aW5nUHJpY2UpLAogICAgICAgICAgICB1aW50MTI4KF9lbmRpbmdQcmljZSksCiAgICAgICAgICAgIHVpbnQ2NChfZHVyYXRpb24pLAogICAgICAgICAgICB1aW50NjQobm93KQogICAgICAgICk7CgogICAgICAgIF9hZGRBdWN0aW9uKF90b2tlbklkLCBhdWN0aW9uKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWRkcyBhbiBhdWN0aW9uIHRvIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuIEFsc28gZmlyZXMgdGhlCiAgICAgKiAgQXVjdGlvbkNyZWF0ZWQgZXZlbnQuCiAgICAgKiBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSB0b2tlbiB0byBiZSBwdXQgb24gYXVjdGlvbi4KICAgICAqIEBwYXJhbSBfYXVjdGlvbiBBdWN0aW9uIHRvIGFkZC4KICAgICAqLwogICAgZnVuY3Rpb24gX2FkZEF1Y3Rpb24odWludCBfdG9rZW5JZCwgQXVjdGlvbiBfYXVjdGlvbikgaW50ZXJuYWwgewogICAgICAgIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdID0gX2F1Y3Rpb247CgogICAgICAgIEF1Y3Rpb25DcmVhdGVkKAogICAgICAgICAgICBub3csCiAgICAgICAgICAgIF9hdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgX3Rva2VuSWQsCiAgICAgICAgICAgIF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UsCiAgICAgICAgICAgIF9hdWN0aW9uLmVuZGluZ1ByaWNlLAogICAgICAgICAgICBfYXVjdGlvbi5kdXJhdGlvbgogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENvbXB1dGVzIHRoZSBwcmljZSBhbmQgdHJhbnNmZXJzIHdpbm5pbmdzLgogICAgICogIERvZXMgTk9UIHRyYW5zZmVyIG93bmVyc2hpcCBvZiB0b2tlbi4KICAgICAqLwogICAgZnVuY3Rpb24gX2JpZCh1aW50IF90b2tlbklkLCB1aW50IF9iaWRBbW91bnQpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICAvLyBHZXQgYSByZWZlcmVuY2UgdG8gdGhlIGF1Y3Rpb24gc3RydWN0CiAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKCiAgICAgICAgLy8gRXhwbGljaXRseSBjaGVjayB0aGF0IHRoaXMgYXVjdGlvbiBpcyBjdXJyZW50bHkgbGl2ZS4KICAgICAgICAvLyAoQmVjYXVzZSBvZiBob3cgRXRoZXJldW0gbWFwcGluZ3Mgd29yaywgd2UgY2FuJ3QganVzdCBjb3VudAogICAgICAgIC8vIG9uIHRoZSBsb29rdXAgYWJvdmUgZmFpbGluZy4gQW4gaW52YWxpZCBfdG9rZW5JZCB3aWxsIGp1c3QKICAgICAgICAvLyByZXR1cm4gYW4gYXVjdGlvbiBvYmplY3QgdGhhdCBpcyBhbGwgemVyb3MuKQogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgYmlkIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgY3VycmVudCBwcmljZQogICAgICAgIHVpbnQgcHJpY2UgPSBfY29tcHV0ZUN1cnJlbnRQcmljZShhdWN0aW9uKTsKICAgICAgICByZXF1aXJlKF9iaWRBbW91bnQgPj0gcHJpY2UpOwoKICAgICAgICAvLyBHcmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBzZWxsZXIgYmVmb3JlIHRoZSBhdWN0aW9uIHN0cnVjdAogICAgICAgIC8vIGdldHMgZGVsZXRlZC4KICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwoKICAgICAgICAvLyBUaGUgYmlkIGlzIGdvb2QhIFJlbW92ZSB0aGUgYXVjdGlvbiBiZWZvcmUgc2VuZGluZyB0aGUgZmVlcwogICAgICAgIC8vIHRvIHRoZSBzZW5kZXIgc28gd2UgY2FuJ3QgaGF2ZSBhIHJlZW50cmFuY3kgYXR0YWNrLgogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKCiAgICAgICAgLy8gVHJhbnNmZXIgcHJvY2VlZHMgdG8gc2VsbGVyIChpZiB0aGVyZSBhcmUgYW55ISkKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYXVjdGlvbmVlcidzIGN1dC4KICAgICAgICAgICAgdWludCBhdWN0aW9uZWVyQ3V0ID0gcHJpY2UgKiBvd25lckN1dCAvIDEwMDAwOwogICAgICAgICAgICB1aW50IHNlbGxlclByb2NlZWRzID0gcHJpY2UgLSBhdWN0aW9uZWVyQ3V0OwoKICAgICAgICAgICAgc2VsbGVyLnRyYW5zZmVyKHNlbGxlclByb2NlZWRzKTsKICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbnkgZXhjZXNzIGZ1bmRzIGluY2x1ZGVkIHdpdGggdGhlIGJpZC4gSWYgdGhlIGV4Y2VzcwogICAgICAgIC8vIGlzIGFueXRoaW5nIHdvcnRoIHdvcnJ5aW5nIGFib3V0LCB0cmFuc2ZlciBpdCBiYWNrIHRvIGJpZGRlci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIGJpZCBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAgICAgLy8gZXF1YWwgdG8gdGhlIHByaWNlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSBwcmljZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgdHJhbnNmZXIsIHRoaXMgaXMKICAgICAgICAvLyBub3Qgc3VzY2VwdGlibGUgdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSB0aGUgYXVjdGlvbiBpcwogICAgICAgIC8vIHJlbW92ZWQgYmVmb3JlIGFueSB0cmFuc2ZlcnMgb2NjdXIuCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwoKICAgICAgICAvLyBUZWxsIHRoZSB3b3JsZCEKICAgICAgICBBdWN0aW9uU3VjY2Vzc2Z1bChub3csIHNlbGxlciwgX3Rva2VuSWQsIHByaWNlLCBtc2cuc2VuZGVyKTsKCiAgICAgICAgcmV0dXJuIHByaWNlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDYW5jZWxzIGFuIGF1Y3Rpb24gdW5jb25kaXRpb25hbGx5LgogICAgICovCiAgICBmdW5jdGlvbiBfY2FuY2VsQXVjdGlvbih1aW50IF90b2tlbklkLCBhZGRyZXNzIF9zZWxsZXIpIGludGVybmFsIHsKICAgICAgICBfcmVtb3ZlQXVjdGlvbihfdG9rZW5JZCk7CgogICAgICAgIC8vIFRyYW5zZmVycyB0aGUgdG9rZW4gb3duZWQgYnkgdGhpcyBjb250cmFjdCB0byBpdHMgb3JpZ2luYWwgb3duZXIuIEl0IHdpbGwgdGhyb3cgaWYgdHJhbnNmZXIgZmFpbHMuCiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2Zlcihfc2VsbGVyLCBfdG9rZW5JZCk7CgogICAgICAgIEF1Y3Rpb25DYW5jZWxsZWQobm93LCBfc2VsbGVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJlbW92ZXMgYW4gYXVjdGlvbiBmcm9tIHRoZSBsaXN0IG9mIG9wZW4gYXVjdGlvbnMuCiAgICAgKiBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiBvbiBhdWN0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBfcmVtb3ZlQXVjdGlvbih1aW50IF90b2tlbklkKSBpbnRlcm5hbCB7CiAgICAgICAgZGVsZXRlIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIGN1cnJlbnQgcHJpY2Ugb2YgYW4gdG9rZW4gb24gYXVjdGlvbi4gQnJva2VuIGludG8gdHdvCiAgICAgKiAgZnVuY3Rpb25zICh0aGlzIG9uZSwgdGhhdCBjb21wdXRlcyB0aGUgZHVyYXRpb24gZnJvbSB0aGUgYXVjdGlvbgogICAgICogIHN0cnVjdHVyZSwgYW5kIHRoZSBvdGhlciB0aGF0IGRvZXMgdGhlIHByaWNlIGNvbXB1dGF0aW9uKSBzbyB3ZQogICAgICogIGNhbiBlYXNpbHkgdGVzdCB0aGF0IHRoZSBwcmljZSBjb21wdXRhdGlvbiB3b3JrcyBjb3JyZWN0bHkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9jb21wdXRlQ3VycmVudFByaWNlKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBzZWNvbmRzUGFzc2VkID0gMDsKCiAgICAgICAgLy8gQSBiaXQgb2YgaW5zdXJhbmNlIGFnYWluc3QgbmVnYXRpdmUgdmFsdWVzIChvciB3cmFwYXJvdW5kKS4KICAgICAgICAvLyBQcm9iYWJseSBub3QgbmVjZXNzYXJ5IChzaW5jZSBFdGhlcmV1bSBndWFybmF0ZWVzIHRoYXQgdGhlCiAgICAgICAgLy8gbm93IHZhcmlhYmxlIGRvZXNuJ3QgZXZlciBnbyBiYWNrd2FyZHMpLgogICAgICAgIGlmIChub3cgPiBfYXVjdGlvbi5zdGFydGVkQXQpIHsKICAgICAgICAgICAgc2Vjb25kc1Bhc3NlZCA9IG5vdyAtIF9hdWN0aW9uLnN0YXJ0ZWRBdDsKICAgICAgICB9CgogICAgICAgIGlmIChzZWNvbmRzUGFzc2VkID49IF9hdWN0aW9uLmR1cmF0aW9uKSB7CiAgICAgICAgICAgIC8vIFdlJ3ZlIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgZHluYW1pYyBwcmljaW5nIHBvcnRpb24KICAgICAgICAgICAgLy8gb2YgdGhlIGF1Y3Rpb24sIGp1c3QgcmV0dXJuIHRoZSBlbmQgcHJpY2UuCiAgICAgICAgICAgIHJldHVybiBfYXVjdGlvbi5lbmRpbmdQcmljZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTdGFydGluZyBwcmljZSBjYW4gYmUgaGlnaGVyIHRoYW4gZW5kaW5nIHByaWNlIChhbmQgb2Z0ZW4gaXMhKSwgc28KICAgICAgICAgICAgLy8gdGhpcyBkZWx0YSBjYW4gYmUgbmVnYXRpdmUuCiAgICAgICAgICAgIGludCB0b3RhbFByaWNlQ2hhbmdlID0gaW50KF9hdWN0aW9uLmVuZGluZ1ByaWNlKSAtIGludChfYXVjdGlvbi5zdGFydGluZ1ByaWNlKTsKCiAgICAgICAgICAgIC8vIFRoaXMgbXVsdGlwbGljYXRpb24gY2FuJ3Qgb3ZlcmZsb3csIF9zZWNvbmRzUGFzc2VkIHdpbGwgZWFzaWx5IGZpdCB3aXRoaW4KICAgICAgICAgICAgLy8gNjQtYml0cywgYW5kIHRvdGFsUHJpY2VDaGFuZ2Ugd2lsbCBlYXNpbHkgZml0IHdpdGhpbiAxMjgtYml0cywgdGhlaXIgcHJvZHVjdAogICAgICAgICAgICAvLyB3aWxsIGFsd2F5cyBmaXQgd2l0aGluIDI1Ni1iaXRzLgogICAgICAgICAgICBpbnQgY3VycmVudFByaWNlQ2hhbmdlID0gdG90YWxQcmljZUNoYW5nZSAqIGludChzZWNvbmRzUGFzc2VkKSAvIGludChfYXVjdGlvbi5kdXJhdGlvbik7CgogICAgICAgICAgICAvLyBjdXJyZW50UHJpY2VDaGFuZ2UgY2FuIGJlIG5lZ2F0aXZlLCBidXQgaWYgc28sIHdpbGwgaGF2ZSBhIG1hZ25pdHVkZQogICAgICAgICAgICAvLyBsZXNzIHRoYXQgc3RhcnRpbmdQcmljZS4gVGh1cywgdGhpcyByZXN1bHQgd2lsbCBhbHdheXMgZW5kIHVwIHBvc2l0aXZlLgogICAgICAgICAgICBpbnQgY3VycmVudFByaWNlID0gaW50KF9hdWN0aW9uLnN0YXJ0aW5nUHJpY2UpICsgY3VycmVudFByaWNlQ2hhbmdlOwoKICAgICAgICAgICAgcmV0dXJuIHVpbnQoY3VycmVudFByaWNlKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qID09PT09PT09IE1PRElGSUVSUyA9PT09PT09PSAqLwoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHRva2VuIGlzIG9uIGF1Y3Rpb24uCiAgICAgKiBAcGFyYW0gX2F1Y3Rpb24gLSBBdWN0aW9uIHRvIGNoZWNrLgogICAgICovCiAgICBmdW5jdGlvbiBfaXNPbkF1Y3Rpb24oQXVjdGlvbiBzdG9yYWdlIF9hdWN0aW9uKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gKF9hdWN0aW9uLnN0YXJ0ZWRBdCA+IDApOwogICAgfQoKfQoKCmNvbnRyYWN0IER1bmdlb25Ub2tlbkF1Y3Rpb24gaXMgRHVuZ2VvblRva2VuLCBFUkM3MjFEdXRjaEF1Y3Rpb24gewoKICAgIGZ1bmN0aW9uIER1bmdlb25Ub2tlbkF1Y3Rpb24odWludCBfb3duZXJDdXQpIEVSQzcyMUR1dGNoQXVjdGlvbih0aGlzLCBfb3duZXJDdXQpIHB1YmxpYyB7IH0KCiAgICAvKioKICAgICAqIEBkZXYgQ3JlYXRlcyBhbmQgYmVnaW5zIGEgbmV3IGF1Y3Rpb24uCiAgICAgKiBAcGFyYW0gX3Rva2VuSWQgLSBJRCBvZiB0b2tlbiB0byBhdWN0aW9uLCBzZW5kZXIgbXVzdCBiZSBvd25lci4KICAgICAqIEBwYXJhbSBfc3RhcnRpbmdQcmljZSAtIFByaWNlIG9mIGl0ZW0gKGluIHdlaSkgYXQgYmVnaW5uaW5nIG9mIGF1Y3Rpb24uCiAgICAgKiBAcGFyYW0gX2VuZGluZ1ByaWNlIC0gUHJpY2Ugb2YgaXRlbSAoaW4gd2VpKSBhdCBlbmQgb2YgYXVjdGlvbi4KICAgICAqIEBwYXJhbSBfZHVyYXRpb24gLSBMZW5ndGggb2YgdGltZSB0byBtb3ZlIGJldHdlZW4gc3RhcnRpbmcgcHJpY2UgYW5kIGVuZGluZyBwcmljZSAoaW4gc2Vjb25kcykuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24oCiAgICAgICAgdWludCBfdG9rZW5JZCwKICAgICAgICB1aW50IF9zdGFydGluZ1ByaWNlLAogICAgICAgIHVpbnQgX2VuZGluZ1ByaWNlLAogICAgICAgIHVpbnQgX2R1cmF0aW9uCiAgICApIHdoZW5Ob3RQYXVzZWQgZXh0ZXJuYWwgewogICAgICAgIF9hcHByb3ZlKF90b2tlbklkLCB0aGlzKTsKCiAgICAgICAgLy8gVGhpcyB3aWxsIHBlcmZvcm0gYWxsIHRoZSBjaGVja2luZ3MgbmVjZXNzYXJ5LgogICAgICAgIF9jcmVhdGVBdWN0aW9uKF90b2tlbklkLCBfc3RhcnRpbmdQcmljZSwgX2VuZGluZ1ByaWNlLCBfZHVyYXRpb24sIG1zZy5zZW5kZXIpOwogICAgfQoKfQ=='.
	

]
