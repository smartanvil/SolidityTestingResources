Class {
	#name : #SRT587c549c4113127340ac0f5e996cab7a4f35bb49,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT587c549c4113127340ac0f5e996cab7a4f35bb49 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgoKbGlicmFyeSBTYWZlTWF0aCB7CiAgICBmdW5jdGlvbiBtdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgIHJldHVybnModWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gc3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlICByZXR1cm5zKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlICByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IGMgPSBhICsgYjsKICAgICAgICBhc3NlcnQoYyA+PSBhICYmIGMgPj0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCmNvbnRyYWN0IEVSQzIwIHsKICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KTsKCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wgb2spOwoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wgb2spOwoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyhib29sIG9rKTsKCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCiAgICAvKioKICAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICAqIGFjY291bnQuCiAgICAqLwogICAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICAqLwogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgICAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KCn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogICAgZXZlbnQgUGF1c2UoKTsKICAgIGV2ZW50IFVucGF1c2UoKTsKCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogICAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAqLwogICAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKHBhdXNlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgICBmdW5jdGlvbiBwYXVzZSgpIHB1YmxpYyBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBQYXVzZSgpOwogICAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5QYXVzZWQgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgICAgIFVucGF1c2UoKTsKICAgIH0KfQoKCi8vLyBAdGl0bGUgTWlncmF0aW9uIEFnZW50IGludGVyZmFjZQpjb250cmFjdCBNaWdyYXRpb25BZ2VudCB7CgogICAgZnVuY3Rpb24gbWlncmF0ZUZyb20oYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfdmFsdWUpIHB1YmxpYzsKfQoKCi8vIENyb3dkc2FsZSBTbWFydCBDb250cmFjdAovLyBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvbGxlY3RzIEVUSCBhbmQgaW4gcmV0dXJuIHNlbmRzIHRva2VucyB0byB0aGUgQmFja2Vycwpjb250cmFjdCBDcm93ZHNhbGUgaXMgUGF1c2FibGUgewoKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIHN0cnVjdCBCYWNrZXIgewogICAgICAgIHVpbnQgd2VpUmVjZWl2ZWQ7IC8vIGFtb3VudCBvZiBFVEggY29udHJpYnV0ZWQKICAgICAgICB1aW50IHRva2Vuc1NlbnQ7IC8vIGFtb3VudCBvZiB0b2tlbnMgIHNlbnQgIAogICAgICAgIGJvb2wgcmVmdW5kZWQ7IC8vIHRydWUgaWYgdXNlciBoYXMgYmVlbiByZWZ1bmRlZCAgICAgICAKICAgIH0KCiAgICBUb2tlbiBwdWJsaWMgdG9rZW47IC8vIFRva2VuIGNvbnRyYWN0IHJlZmVyZW5jZSAgIAogICAgYWRkcmVzcyBwdWJsaWMgbXVsdGlzaWc7IC8vIE11bHRpc2lnIGNvbnRyYWN0IHRoYXQgd2lsbCByZWNlaXZlIHRoZSBFVEggICAgCiAgICBhZGRyZXNzIHB1YmxpYyB0ZWFtOyAvLyBBZGRyZXNzIHRvIHdoaWNoIHRoZSB0ZWFtIHRva2VucyB3aWxsIGJlIHNlbnQgICAKICAgIGFkZHJlc3MgcHVibGljIHplbjsgLy8gQWRkcmVzcyB0byB3aGljaCB6ZW4gdGVhbSB0b2tlbnMgd2lsbCBiZSBzZW50CiAgICB1aW50IHB1YmxpYyBldGhSZWNlaXZlZDsgLy8gTnVtYmVyIG9mIEVUSCByZWNlaXZlZAogICAgdWludCBwdWJsaWMgdG90YWxUb2tlbnNTZW50OyAvLyBOdW1iZXIgb2YgdG9rZW5zIHNlbnQgdG8gRVRIIGNvbnRyaWJ1dG9ycwogICAgdWludCBwdWJsaWMgc3RhcnRCbG9jazsgLy8gQ3Jvd2RzYWxlIHN0YXJ0IGJsb2NrCiAgICB1aW50IHB1YmxpYyBlbmRCbG9jazsgLy8gQ3Jvd2RzYWxlIGVuZCBibG9jawogICAgdWludCBwdWJsaWMgbWF4Q2FwOyAvLyBNYXhpbXVtIG51bWJlciBvZiB0b2tlbnMgdG8gc2VsbAogICAgdWludCBwdWJsaWMgbWluQ2FwOyAvLyBNaW5pbXVtIG51bWJlciBvZiB0b2tlbnMgdG8gc2VsbCAgICAKICAgIGJvb2wgcHVibGljIGNyb3dkc2FsZUNsb3NlZDsgLy8gSXMgY3Jvd2RzYWxlIHN0aWxsIGluIHByb2dyZXNzCiAgICB1aW50IHB1YmxpYyByZWZ1bmRDb3VudDsgIC8vIG51bWJlciBvZiByZWZ1bmRzCiAgICB1aW50IHB1YmxpYyB0b3RhbFJlZnVuZGVkOyAvLyB0b3RhbCBhbW91bnQgb2YgcmVmdW5kcyBpbiB3ZWkKICAgIHVpbnQgcHVibGljIHRva2VuUHJpY2VXZWk7IC8vIHRva24gcHJpY2UgaW4gd2VpCiAgICB1aW50IHB1YmxpYyBtaW5JbnZlc3RFVEg7IC8vIE1pbmltdW0gYW1vdW50IHRvIGludmVzdAogICAgdWludCBwdWJsaWMgcHJlc2FsZVRva2VuczsKICAgIHVpbnQgcHVibGljIHRvdGFsV2hpdGVMaXN0ZWQ7IAogICAgdWludCBwdWJsaWMgY2xhaW1Db3VudDsKICAgIHVpbnQgcHVibGljIHRvdGFsQ2xhaW1lZDsKICAgIHVpbnQgcHVibGljIG51bU9mQmxvY2tzSW5NaW51dGU7IC8vIG51bWJlciBvZiBibG9ja3MgaW4gb25lIG1pbnV0ZSAqIDEwMC4gZWcuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgb25lIGJsb2NrIHRha2VzIDEzLjM0IHNlY29uZHMsIHRoZSBudW1iZXIgd2lsbCBiZSA2MC8xMy4zNCogMTAwPSA0NDkKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gQmFja2VyKSBwdWJsaWMgYmFja2VyczsgLy9iYWNrZXIgbGlzdAogICAgYWRkcmVzc1tdIHB1YmxpYyBiYWNrZXJzSW5kZXg7IC8vIHRvIGJlIGFibGUgdG8gaXRhcmF0ZSB0aHJvdWdoIGJhY2tlcnMgZm9yIHZlcmlmaWNhdGlvbi4gIAogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyB3aGl0ZUxpc3Q7CgogICAgLy8gQG5vdGljZSB0byB2ZXJpZnkgaWYgYWN0aW9uIGlzIG5vdCBwZXJmb3JtZWQgb3V0IG9mIHRoZSBjYW1wYWluZyByYW5nZQogICAgbW9kaWZpZXIgcmVzcGVjdFRpbWVGcmFtZSgpIHsKCiAgICAgICAgcmVxdWlyZShibG9jay5udW1iZXIgPj0gc3RhcnRCbG9jayAmJiBibG9jay5udW1iZXIgPD0gZW5kQmxvY2spOyAgICAgICAgICAgCiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IExvZ1JlY2VpdmVkRVRIKGFkZHJlc3MgYmFja2VyLCB1aW50IGFtb3VudCwgdWludCB0b2tlbkFtb3VudCk7CiAgICBldmVudCBMb2dSZWZ1bmRFVEgoYWRkcmVzcyBiYWNrZXIsIHVpbnQgYW1vdW50KTsKICAgIGV2ZW50IExvZ1doaXRlTGlzdGVkKGFkZHJlc3MgdXNlciwgdWludCB3aGl0ZUxpc3RlZE51bSk7CiAgICBldmVudCBMb2dXaGl0ZUxpc3RlZE11bHRpcGxlKHVpbnQgd2hpdGVMaXN0ZWROdW0pOyAgIAoKICAgIC8vIENyb3dkc2FsZSAge2NvbnN0cnVjdG9yfQogICAgLy8gQG5vdGljZSBmaXJlZCB3aGVuIGNvbnRyYWN0IGlzIGNyYXRlZC4gSW5pdGlsaXplcyBhbGwgY29uc3RhbnQgYW5kIGluaXRpYWwgdmFyaWFibGVzLgogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKCkgcHVibGljIHsKCiAgICAgICAgbXVsdGlzaWcgPSAweEU4MDRBZDcyZTYwNTAzZUQ0N2QyNjczNTFCZGQzNDQxYUMxY2NiMDM7IAogICAgICAgIHRlYW0gPSAweDg2QWI2ZEI5OTMyMzMyZTMzNTAxNDFjMUQyRTM0M0M0NzgxNTdkMDQ7IAogICAgICAgIHplbiA9IDB4MzMzNGYxZkJmNzhlNGYwQ0ZFMGY1MDI1NDEwMzI2RmUwMjYyZWRlOTsgCiAgICAgICAgcHJlc2FsZVRva2VucyA9IDQ2OTIwMDBlODsgICAgICAvL1RPRE86IGVuc3VyZSB0aGF0IHRoaXMgaXMgY29ycmVjdCBhbW91bnQKICAgICAgICB0b3RhbFRva2Vuc1NlbnQgPSBwcmVzYWxlVG9rZW5zOyAgCiAgICAgICAgbWluSW52ZXN0RVRIID0gMSBldGhlci8xMDsgLy8gMC4xIGV0aAogICAgICAgIHN0YXJ0QmxvY2sgPSAwOyAvLyBJQ08gc3RhcnQgYmxvY2sKICAgICAgICBlbmRCbG9jayA9IDA7IC8vIElDTyBlbmQgYmxvY2sgICAgICAgICAgICAgICAgICAgIAogICAgICAgIG1heENhcCA9IDQyMDAwMDAwZTg7IC8vIHRha2VzIGludG8gY29uc2lkZXJhdGlvbiB6ZW4gdGVhbSB0b2tlbnMgYW5kIHRlYW0gdG9rZW5zLiAgIAogICAgICAgIG1pbkNhcCA9IDg0NDIwMDBlODsgICAgICAgIAogICAgICAgIHRva2VuUHJpY2VXZWkgPSA4MDAwMDAwMDAwMDAwMDsgIC8vIFByaWNlIGlzIDAuMDAwMDggZXRoICAgIAogICAgICAgIG51bU9mQmxvY2tzSW5NaW51dGUgPSA0MDA7ICAvLyAgVE9ETzogdXBkdGUgdGhpcyB2YWx1ZSBiZWZvcmUgZGVwbG95aW5nLiBFLmcuIDQuMDAgYmxvY2svcGVyIG1pbnV0ZSB3b2xkIGJlIGVudGVyZWQgYXMgNDAwICAgICAgICAgICAKICAgIH0KCiAgICAgLy8gQG5vdGljZSB0byBwb3B1bGF0ZSB3ZWJzaXRlIHdpdGggc3RhdHVzIG9mIHRoZSBzYWxlIAogICAgZnVuY3Rpb24gcmV0dXJuV2Vic2l0ZURhdGEoKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgdWludCwgYm9vbCwgYm9vbCkgewogICAgCiAgICAgICAgcmV0dXJuIChzdGFydEJsb2NrLCBlbmRCbG9jaywgbnVtYmVyT2ZCYWNrZXJzKCksIGV0aFJlY2VpdmVkLCBtYXhDYXAsIG1pbkNhcCwgdG90YWxUb2tlbnNTZW50LCB0b2tlblByaWNlV2VpLCBwYXVzZWQsIGNyb3dkc2FsZUNsb3NlZCk7CiAgICB9CgogICAgLy8gQG5vdGljZSBpbiBjYXNlIHJlZnVuZHMgYXJlIG5lZWRlZCwgbW9uZXkgY2FuIGJlIHJldHVybmVkIHRvIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gZnVuZENvbnRyYWN0KCkgZXh0ZXJuYWwgcGF5YWJsZSBvbmx5T3duZXIoKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkVG9XaGl0ZUxpc3QoYWRkcmVzcyBfdXNlcikgZXh0ZXJuYWwgb25seU93bmVyKCkgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICBpZiAod2hpdGVMaXN0W191c2VyXSAhPSB0cnVlKSB7CiAgICAgICAgICAgIHdoaXRlTGlzdFtfdXNlcl0gPSB0cnVlOwogICAgICAgICAgICB0b3RhbFdoaXRlTGlzdGVkKys7CiAgICAgICAgICAgIExvZ1doaXRlTGlzdGVkKF91c2VyLCB0b3RhbFdoaXRlTGlzdGVkKTsgICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkVG9XaGl0ZUxpc3RNdWx0aXBsZShhZGRyZXNzW10gX3VzZXJzKSBleHRlcm5hbCBvbmx5T3duZXIoKSAgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfdXNlcnMubGVuZ3RoOyArK2kpIHsKCiAgICAgICAgICAgIGlmICh3aGl0ZUxpc3RbX3VzZXJzW2ldXSAhPSB0cnVlKSB7CiAgICAgICAgICAgICAgICB3aGl0ZUxpc3RbX3VzZXJzW2ldXSA9IHRydWU7CiAgICAgICAgICAgICAgICB0b3RhbFdoaXRlTGlzdGVkKys7ICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIExvZ1doaXRlTGlzdGVkTXVsdGlwbGUodG90YWxXaGl0ZUxpc3RlZCk7IAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEBub3RpY2UgTW92ZSBmdW5kcyBmcm9tIHByZSBJQ08gc2FsZSBpZiBuZWVkZWQuIAogICAgZnVuY3Rpb24gdHJhbnNmZXJQcmVJQ09GdW5kcygpIGV4dGVybmFsIHBheWFibGUgb25seU93bmVyKCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGV0aFJlY2VpdmVkID0gZXRoUmVjZWl2ZWQuYWRkKG1zZy52YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQG5vdGljZSBTcGVjaWZ5IGFkZHJlc3Mgb2YgdG9rZW4gY29udHJhY3QKICAgIC8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIHthZGRyZXNzfSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAgLy8gQHJldHVybiByZXMge2Jvb2x9CiAgICBmdW5jdGlvbiB1cGRhdGVUb2tlbkFkZHJlc3MoVG9rZW4gX3Rva2VuQWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyKCkgcmV0dXJucyhib29sIHJlcykgewogICAgICAgIHRva2VuID0gX3Rva2VuQWRkcmVzczsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyB7ZmFsbGJhY2sgZnVuY3Rpb259CiAgICAvLyBAbm90aWNlIEl0IHdpbGwgY2FsbCBpbnRlcm5hbCBmdW5jdGlvbiB3aGljaCBoYW5kZWxzIGFsbG9jYXRpb24gb2YgRXRoZXIgYW5kIGNhbGN1bGF0ZXMgYW1vdXQgb2YgdG9rZW5zLgogICAgZnVuY3Rpb24gKCkgZXh0ZXJuYWwgcGF5YWJsZSB7ICAgICAgICAgICAKICAgICAgICBjb250cmlidXRlKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIEBub3RpY2UgSXQgd2lsbCBiZSBjYWxsZWQgYnkgb3duZXIgdG8gc3RhcnQgdGhlIHNhbGUgICAgCiAgICBmdW5jdGlvbiBzdGFydCh1aW50IF9ibG9jaykgZXh0ZXJuYWwgb25seU93bmVyKCkgeyAgIAoKICAgICAgICByZXF1aXJlKF9ibG9jayA8IChudW1PZkJsb2Nrc0luTWludXRlICogNjAgKiAyNCAqIDYwKS8xMDApOyAgLy8gYWxsb3cgbWF4IDYwIGRheXMgZm9yIGNhbXBhaWduCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIHN0YXJ0QmxvY2sgPSBibG9jay5udW1iZXI7CiAgICAgICAgZW5kQmxvY2sgPSBzdGFydEJsb2NrLmFkZChfYmxvY2spOyAKICAgIH0KCiAgICAvLyBAbm90aWNlIER1ZSB0byBjaGFuZ2luZyBhdmVyYWdlIG9mIGJsb2NrIHRpbWUKICAgIC8vIHRoaXMgZnVuY3Rpb24gd2lsbCBhbGxvdyBvbiBhZGp1c3RpbmcgZHVyYXRpb24gb2YgY2FtcGFpZ24gY2xvc2VyIHRvIHRoZSBlbmQgCiAgICBmdW5jdGlvbiBhZGp1c3REdXJhdGlvbih1aW50IF9ibG9jaykgZXh0ZXJuYWwgb25seU93bmVyKCkgewoKICAgICAgICByZXF1aXJlKF9ibG9jayA8IChudW1PZkJsb2Nrc0luTWludXRlICogNjAgKiAyNCAqIDgwKS8xMDApOyAvLyBhbGxvdyBmb3IgbWF4IG9mIDgwIGRheXMgZm9yIGNhbXBhaWduCiAgICAgICAgcmVxdWlyZShfYmxvY2sgPiBibG9jay5udW1iZXIuc3ViKHN0YXJ0QmxvY2spKTsgLy8gZW5zdXJlIHRoYXQgZW5kQmxvY2sgaXMgbm90IHNldCBpbiB0aGUgcGFzdAogICAgICAgIGVuZEJsb2NrID0gc3RhcnRCbG9jay5hZGQoX2Jsb2NrKTsgCiAgICB9CiAgICAKICAgIC8vIEBub3RpY2UgVGhpcyBmdW5jdGlvbiB3aWxsIGZpbmFsaXplIHRoZSBzYWxlLgogICAgLy8gSXQgd2lsbCBvbmx5IGV4ZWN1dGUgaWYgcHJlZGV0ZXJtaW5lZCBzYWxlIHRpbWUgcGFzc2VkIG9yIGFsbCB0b2tlbnMgYXJlIHNvbGQuCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIGV4dGVybmFsIG9ubHlPd25lcigpIHsKCiAgICAgICAgcmVxdWlyZSghY3Jvd2RzYWxlQ2xvc2VkKTsgICAgICAgIAogICAgICAgIC8vIHB1cmNoYXNpbmcgcHJlY2lzZSBudW1iZXIgb2YgdG9rZW5zIG1pZ2h0IGJlIGltcHJhY3RpY2FsLCAKICAgICAgICAvL3RodXMgc3VidHJhY3QgMTAwMCB0b2tlbnMgc28gZmluYWxpeml0aW9uIGlzIHBvc3NpYmxlIG5lYXIgdGhlIGVuZCAKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+IGVuZEJsb2NrIHx8IHRvdGFsVG9rZW5zU2VudCA+PSBtYXhDYXAgLSAxMDAwKTsgCiAgICAgICAgcmVxdWlyZSh0b3RhbFRva2Vuc1NlbnQgPj0gbWluQ2FwKTsgIC8vIGVuc3VyZSB0aGF0IGNhbXBhaWduIHdhcyBzdWNjZXNzZnVsICAgICAgICAgCiAgICAgICAgY3Jvd2RzYWxlQ2xvc2VkID0gdHJ1ZTsgCgogICAgICAgIGlmICghdG9rZW4udHJhbnNmZXIodGVhbSwgNDUwMDAwMDBlOCArIHByZXNhbGVUb2tlbnMpKQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBpZiAoIXRva2VuLnRyYW5zZmVyKHplbiwgMzAwMDAwMGU4KSkgCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIHRva2VuLnVubG9jaygpOyAgICAgICAgICAgICAgICAgICAgICAgCiAgICB9CgogICAgLy8gQG5vdGljZQogICAgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGFsbG93IHRvIHRyYW5zZmVyIHVuc29sZCB0b2tlbnMgdG8gYSBuZXcKICAgIC8vIGNvbnRyYWN0L3dhbGxldCBhZGRyZXNzIHRvIHN0YXJ0IG5ldyBJQ08gaW4gdGhlIGZ1dHVyZQogICAgZnVuY3Rpb24gdHJhbnNmZXJSZW1haW5pbmdUb2tlbnMoYWRkcmVzcyBfbmV3QWRkcmVzcykgZXh0ZXJuYWwgb25seU93bmVyKCkgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICByZXF1aXJlKF9uZXdBZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIDE4MCBkYXlzIGFmdGVyIElDTyBlbmRzICAgCiAgICAgICAgYXNzZXJ0KGJsb2NrLm51bWJlciA+IGVuZEJsb2NrICsgKG51bU9mQmxvY2tzSW5NaW51dGUgKiA2MCAqIDI0ICogMTgwKS8xMDApOyAgICAgICAgIAogICAgICAgIGlmICghdG9rZW4udHJhbnNmZXIoX25ld0FkZHJlc3MsIHRva2VuLmJhbGFuY2VPZih0aGlzKSkpIAogICAgICAgICAgICByZXZlcnQoKTsgLy8gdHJhbnNmZXIgdG9rZW5zIHRvIGFkbWluIGFjY291bnQgb3IgbXVsdGlzaWcgd2FsbGV0CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQG5vdGljZSBGYWlsc2FmZSBkcmFpbgogICAgZnVuY3Rpb24gZHJhaW4oKSBleHRlcm5hbCBvbmx5T3duZXIoKSB7CiAgICAgICAgbXVsdGlzaWcudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsgICAgICAKICAgIH0KCiAgICAvLyBAbm90aWNlIGl0IHdpbGwgYWxsb3cgY29udHJpYnV0b3JzIHRvIGdldCByZWZ1bmQgaW4gY2FzZSBjYW1wYWlnbiBmYWlsZWQKICAgIGZ1bmN0aW9uIHJlZnVuZCgpICBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKCgogICAgICAgIHJlcXVpcmUoYmxvY2subnVtYmVyID4gZW5kQmxvY2spOyAvLyBlbnN1cmUgdGhhdCBjYW1wYWlnbiBpcyBvdmVyCiAgICAgICAgcmVxdWlyZSh0b3RhbFRva2Vuc1NlbnQgPCBtaW5DYXApOyAvLyBlbnN1cmUgdGhhdCBjYW1wYWlnbiBmYWlsZWQKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+IDApOyAgLy8gY29udHJhY3Qgd2lsbCBob2xkIDAgZXRoZXIgYXQgdGhlIGVuZCBvZiB0aGUgY2FtcGFpZ24uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb250cmFjdCBuZWVkcyB0byBiZSBmdW5kZWQgdGhyb3VnaCBmdW5kQ29udHJhY3QoKSBmb3IgdGhpcyBhY3Rpb24KCiAgICAgICAgQmFja2VyIHN0b3JhZ2UgYmFja2VyID0gYmFja2Vyc1ttc2cuc2VuZGVyXTsKCiAgICAgICAgcmVxdWlyZShiYWNrZXIud2VpUmVjZWl2ZWQgPiAwKTsgICAgICAgICAgIAogICAgICAgIHJlcXVpcmUoIWJhY2tlci5yZWZ1bmRlZCk7ICAgICAgCgogICAgICAgIGJhY2tlci5yZWZ1bmRlZCA9IHRydWU7ICAgICAgCiAgICAgICAgcmVmdW5kQ291bnQrKzsKICAgICAgICB0b3RhbFJlZnVuZGVkID0gdG90YWxSZWZ1bmRlZCArIGJhY2tlci53ZWlSZWNlaXZlZDsKCiAgICAgICAgaWYgKCF0b2tlbi5idXJuKG1zZy5zZW5kZXIsIGJhY2tlci50b2tlbnNTZW50KSkKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiYWNrZXIud2VpUmVjZWl2ZWQpOwogICAgICAgIExvZ1JlZnVuZEVUSChtc2cuc2VuZGVyLCBiYWNrZXIud2VpUmVjZWl2ZWQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAKCiAgICAvLyBAbm90aWNlIHJldHVybiBudW1iZXIgb2YgY29udHJpYnV0b3JzCiAgICAvLyBAcmV0dXJuICB7dWludH0gbnVtYmVyIG9mIGNvbnRyaWJ1dG9ycwogICAgZnVuY3Rpb24gbnVtYmVyT2ZCYWNrZXJzKCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGJhY2tlcnNJbmRleC5sZW5ndGg7CiAgICB9CgogICAgLy8gQG5vdGljZSBJdCB3aWxsIGJlIGNhbGxlZCBieSBmYWxsYmFjayBmdW5jdGlvbiB3aGVuZXZlciBldGhlciBpcyBzZW50IHRvIGl0CiAgICAvLyBAcGFyYW0gIF9iYWNrZXIge2FkZHJlc3N9IGFkZHJlc3Mgb2YgYmVuZWZpY2lhcnkKICAgIC8vIEByZXR1cm4gcmVzIHtib29sfSB0cnVlIGlmIHRyYW5zYWN0aW9uIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBjb250cmlidXRlKGFkZHJlc3MgX2JhY2tlcikgaW50ZXJuYWwgd2hlbk5vdFBhdXNlZCByZXNwZWN0VGltZUZyYW1lIHJldHVybnMoYm9vbCByZXMpIHsKCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gbWluSW52ZXN0RVRIKTsgICAvLyBzdG9wIHdoZW4gcmVxdWlyZWQgbWluaW11bSBpcyBub3Qgc2VudAogICAgICAgIHJlcXVpcmUod2hpdGVMaXN0W19iYWNrZXJdKTsKICAgICAgICB1aW50IHRva2Vuc1RvU2VuZCA9IGNhbGN1bGF0ZU5vT2ZUb2tlbnNUb1NlbmQoKTsKICAgICAgICByZXF1aXJlKHRvdGFsVG9rZW5zU2VudC5hZGQodG9rZW5zVG9TZW5kKSA8PSBtYXhDYXApOyAgLy8gRW5zdXJlIHRoYXQgbWF4IGNhcCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgICAgICAgICAgCiAgICAgICAgQmFja2VyIHN0b3JhZ2UgYmFja2VyID0gYmFja2Vyc1tfYmFja2VyXTsKCiAgICAgICAgaWYgKGJhY2tlci53ZWlSZWNlaXZlZCA9PSAwKQogICAgICAgICAgICBiYWNrZXJzSW5kZXgucHVzaChfYmFja2VyKTsKICAgICAgICAKICAgICAgICBiYWNrZXIudG9rZW5zU2VudCA9IGJhY2tlci50b2tlbnNTZW50LmFkZCh0b2tlbnNUb1NlbmQpOwogICAgICAgIGJhY2tlci53ZWlSZWNlaXZlZCA9IGJhY2tlci53ZWlSZWNlaXZlZC5hZGQobXNnLnZhbHVlKTsKICAgICAgICBldGhSZWNlaXZlZCA9IGV0aFJlY2VpdmVkLmFkZChtc2cudmFsdWUpOyAvLyBVcGRhdGUgdGhlIHRvdGFsIEV0aGVyIHJlY2l2ZWQKICAgICAgICB0b3RhbFRva2Vuc1NlbnQgPSB0b3RhbFRva2Vuc1NlbnQuYWRkKHRva2Vuc1RvU2VuZCk7CgogICAgICAgIGlmICghdG9rZW4udHJhbnNmZXIoX2JhY2tlciwgdG9rZW5zVG9TZW5kKSkgCiAgICAgICAgICAgIHJldmVydCgpOyAvLyBUcmFuc2ZlciBTT0NYIHRva2VucwoKICAgICAgICBtdWx0aXNpZy50cmFuc2Zlcihtc2cudmFsdWUpOyAgLy8gc2VuZCBtb25leSB0byBtdWx0aXNpZ25hdHVyZSB3YWxsZXQKICAgICAgICBMb2dSZWNlaXZlZEVUSChfYmFja2VyLCBtc2cudmFsdWUsIHRva2Vuc1RvU2VuZCk7IC8vIFJlZ2lzdGVyIGV2ZW50CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIG51bWJlciBvZiB0b2tlbnMgYmFzZWQgb24gdGltZSBpbnRlcnZhbHMgaW4gdGhlIGNhbXBhaWduCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVOb09mVG9rZW5zVG9TZW5kKCkgaW50ZXJuYWwgY29uc3RhbnQgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgdWludCB0b2tlbkFtb3VudCA9IG1zZy52YWx1ZS5tdWwoMWU4KSAvIHRva2VuUHJpY2VXZWk7ICAgICAgICAKCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8PSBzdGFydEJsb2NrICsgKG51bU9mQmxvY2tzSW5NaW51dGUgKiA2MCkgLyAxMDApICAvLyBsZXNzIHRoZW4gb25lIGhvdXIKICAgICAgICAgICAgcmV0dXJuICB0b2tlbkFtb3VudCArICh0b2tlbkFtb3VudCAqIDUwKSAvIDEwMDsKICAgICAgICBlbHNlIGlmIChibG9jay5udW1iZXIgPD0gc3RhcnRCbG9jayArIChudW1PZkJsb2Nrc0luTWludXRlICogNjAgKiAyNCkgLyAxMDApICAvLyBsZXNzIHRoYW4gb25lIGRheQogICAgICAgICAgICByZXR1cm4gIHRva2VuQW1vdW50ICsgKHRva2VuQW1vdW50ICogMjUpIC8gMTAwOyAKICAgICAgICBlbHNlIGlmIChibG9jay5udW1iZXIgPD0gc3RhcnRCbG9jayArIChudW1PZkJsb2Nrc0luTWludXRlICogNjAgKiAyNCAqIDIpIC8gMTAwKSAgLy8gbGVzcyB0aGFuIHR3byBkYXlzCiAgICAgICAgICAgIHJldHVybiAgdG9rZW5BbW91bnQgKyAodG9rZW5BbW91bnQgKiAxMCkgLyAxMDA7IAogICAgICAgIGVsc2UgaWYgKGJsb2NrLm51bWJlciA8PSBzdGFydEJsb2NrICsgKG51bU9mQmxvY2tzSW5NaW51dGUgKiA2MCAqIDI0ICogMykgLyAxMDApICAvLyBsZXNzIHRoYW4gdGhyZWUgZGF5cwogICAgICAgICAgICByZXR1cm4gIHRva2VuQW1vdW50ICsgKHRva2VuQW1vdW50ICogNSkgLyAxMDA7CiAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZnRlciAzIGRheXMKICAgICAgICAgICAgcmV0dXJuICB0b2tlbkFtb3VudDsgICAgIAogICAgfQp9CgoKCi8vIFRoZSBTT0NYIHRva2VuCmNvbnRyYWN0IFRva2VuIGlzIEVSQzIwLCBPd25hYmxlIHsKICAgIAogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CiAgICAKICAgIC8vIFB1YmxpYyB2YXJpYWJsZXMgb2YgdGhlIHRva2VuCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgLy8gSG93IG1hbnkgZGVjaW1hbHMgdG8gc2hvdy4KICAgIHN0cmluZyBwdWJsaWMgdmVyc2lvbiA9ICJ2MC4xIjsKICAgIHVpbnQgcHVibGljIGluaXRpYWxTdXBwbHk7CiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIGJvb2wgcHVibGljIGxvY2tlZDsgICAgICAgICAgIAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKICAgIGFkZHJlc3MgcHVibGljIG1pZ3JhdGlvbk1hc3RlcjsKICAgIGFkZHJlc3MgcHVibGljIG1pZ3JhdGlvbkFnZW50OwogICAgYWRkcmVzcyBwdWJsaWMgY3Jvd2RTYWxlQWRkcmVzczsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsTWlncmF0ZWQ7CgogICAgLy8gTG9jayB0cmFuc2ZlciBmb3IgY29udHJpYnV0b3JzIGR1cmluZyB0aGUgSUNPIAogICAgbW9kaWZpZXIgb25seVVubG9ja2VkKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNyb3dkU2FsZUFkZHJlc3MgJiYgbG9ja2VkKSAKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QXV0aG9yaXplZCgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lciAmJiBtc2cuc2VuZGVyICE9IGNyb3dkU2FsZUFkZHJlc3MpIAogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIFRoZSBTT0NYIFRva2VuIGNyZWF0ZWQgd2l0aCB0aGUgdGltZSBhdCB3aGljaCB0aGUgY3Jvd2RzYWxlIGVuZHMKICAgIGZ1bmN0aW9uIFRva2VuKGFkZHJlc3MgX2Nyb3dkU2FsZUFkZHJlc3MsIGFkZHJlc3MgX21pZ3JhdGlvbk1hc3RlcikgcHVibGljIHsKICAgICAgICAvLyBMb2NrIHRoZSB0cmFuc2ZDcm93ZHNhbGVlciBmdW5jdGlvbiBkdXJpbmcgdGhlIGNyb3dkc2FsZQogICAgICAgIGxvY2tlZCA9IHRydWU7IC8vIExvY2sgdGhlIHRyYW5zZmVyIG9mIHRva2VucyBkdXJpbmcgdGhlIGNyb3dkc2FsZQogICAgICAgIGluaXRpYWxTdXBwbHkgPSA5MDAwMDAwMGU4OwogICAgICAgIHRvdGFsU3VwcGx5ID0gaW5pdGlhbFN1cHBseTsKICAgICAgICBuYW1lID0gIlNvY2lhbFgiOyAvLyBTZXQgdGhlIG5hbWUgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBzeW1ib2wgPSAiU09DWCI7IC8vIFNldCB0aGUgc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgZGVjaW1hbHMgPSA4OyAvLyBBbW91bnQgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZXMKICAgICAgICBjcm93ZFNhbGVBZGRyZXNzID0gX2Nyb3dkU2FsZUFkZHJlc3M7ICAgICAgICAgICAgICAKICAgICAgICBiYWxhbmNlc1tjcm93ZFNhbGVBZGRyZXNzXSA9IHRvdGFsU3VwcGx5OwogICAgICAgIG1pZ3JhdGlvbk1hc3RlciA9IF9taWdyYXRpb25NYXN0ZXI7CiAgICB9CgogICAgZnVuY3Rpb24gdW5sb2NrKCkgcHVibGljIG9ubHlBdXRob3JpemVkIHsKICAgICAgICBsb2NrZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2NrKCkgcHVibGljIG9ubHlBdXRob3JpemVkIHsKICAgICAgICBsb2NrZWQgPSB0cnVlOwogICAgfQoKICAgIGV2ZW50IE1pZ3JhdGUoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLy8gVG9rZW4gbWlncmF0aW9uIHN1cHBvcnQ6CgogICAgLy8vIEBub3RpY2UgTWlncmF0ZSB0b2tlbnMgdG8gdGhlIG5ldyB0b2tlbiBjb250cmFjdC4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIHN0YXRlOiBPcGVyYXRpb25hbCBNaWdyYXRpb24KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgbWlncmF0ZWQKICAgIGZ1bmN0aW9uIG1pZ3JhdGUodWludDI1NiBfdmFsdWUpIGV4dGVybmFsIG9ubHlVbmxvY2tlZCgpIHsKICAgICAgICAvLyBBYm9ydCBpZiBub3QgaW4gT3BlcmF0aW9uYWwgTWlncmF0aW9uIHN0YXRlLgogICAgICAgIAogICAgICAgIGlmIChtaWdyYXRpb25BZ2VudCA9PSAwKSAKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgCiAgICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdmFsdWUuCiAgICAgICAgaWYgKF92YWx1ZSA9PSAwKSAKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgaWYgKF92YWx1ZSA+IGJhbGFuY2VzW21zZy5zZW5kZXJdKSAKICAgICAgICAgICAgcmV2ZXJ0KCk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKICAgICAgICB0b3RhbFN1cHBseSAtPSBfdmFsdWU7CiAgICAgICAgdG90YWxNaWdyYXRlZCArPSBfdmFsdWU7CiAgICAgICAgTWlncmF0aW9uQWdlbnQobWlncmF0aW9uQWdlbnQpLm1pZ3JhdGVGcm9tKG1zZy5zZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgTWlncmF0ZShtc2cuc2VuZGVyLCBtaWdyYXRpb25BZ2VudCwgX3ZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXQgYWRkcmVzcyBvZiBtaWdyYXRpb24gdGFyZ2V0IGNvbnRyYWN0IGFuZCBlbmFibGUgbWlncmF0aW9uCiAgICAvLy8gcHJvY2Vzcy4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIHN0YXRlOiBPcGVyYXRpb25hbCBOb3JtYWwKICAgIC8vLyBAZGV2IFN0YXRlIHRyYW5zaXRpb246IC0+IE9wZXJhdGlvbmFsIE1pZ3JhdGlvbgogICAgLy8vIEBwYXJhbSBfYWdlbnQgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pZ3JhdGlvbkFnZW50IGNvbnRyYWN0CiAgICBmdW5jdGlvbiBzZXRNaWdyYXRpb25BZ2VudChhZGRyZXNzIF9hZ2VudCkgZXh0ZXJuYWwgb25seVVubG9ja2VkKCkgewogICAgICAgIC8vIEFib3J0IGlmIG5vdCBpbiBPcGVyYXRpb25hbCBOb3JtYWwgc3RhdGUuCiAgICAgICAgCiAgICAgICAgcmVxdWlyZShtaWdyYXRpb25BZ2VudCA9PSAwKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbWlncmF0aW9uTWFzdGVyKTsKICAgICAgICBtaWdyYXRpb25BZ2VudCA9IF9hZ2VudDsKICAgIH0KCiAgICBmdW5jdGlvbiByZXNldENyb3dkU2FsZUFkZHJlc3MoYWRkcmVzcyBfbmV3Q3Jvd2RTYWxlQWRkcmVzcykgZXh0ZXJuYWwgb25seUF1dGhvcml6ZWQoKSB7CiAgICAgICAgY3Jvd2RTYWxlQWRkcmVzcyA9IF9uZXdDcm93ZFNhbGVBZGRyZXNzOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRNaWdyYXRpb25NYXN0ZXIoYWRkcmVzcyBfbWFzdGVyKSBleHRlcm5hbCB7ICAgICAgIAogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtaWdyYXRpb25NYXN0ZXIpOwogICAgICAgIHJlcXVpcmUoX21hc3RlciAhPSAwKTsKICAgICAgICBtaWdyYXRpb25NYXN0ZXIgPSBfbWFzdGVyOwogICAgfQoKICAgLy8gQG5vdGljZSBidXJuIHRva2VucyBpbiBjYXNlIGNhbXBhaWduIGZhaWxlZAogICAgLy8gQHBhcmFtIF9tZW1iZXIge2FkZHJlc3N9IG9mIG1lbWJlcgogICAgLy8gQHBhcmFtIF92YWx1ZSB7dWludH0gYW1vdW50IG9mIHRva2VucyB0byBidXJuCiAgICAvLyBAcmV0dXJuICB7Ym9vbH0gdHJ1ZSBpZiBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBidXJuKCBhZGRyZXNzIF9tZW1iZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seUF1dGhvcml6ZWQgcmV0dXJucyhib29sKSB7CiAgICAgICAgYmFsYW5jZXNbX21lbWJlcl0gPSBiYWxhbmNlc1tfbWVtYmVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKF9tZW1iZXIsIDB4MCwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIHRyYW5zZmVyIHRva2VucyB0byBnaXZlbiBhZGRyZXNzIAogICAgLy8gQHBhcmFtIF90byB7YWRkcmVzc30gYWRkcmVzcyBvciByZWNpcGllbnQKICAgIC8vIEBwYXJhbSBfdmFsdWUge3VpbnR9IGFtb3VudCB0byB0cmFuc2ZlcgogICAgLy8gQHJldHVybiAge2Jvb2x9IHRydWUgaWYgc3VjY2Vzc2Z1bCAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyBvbmx5VW5sb2NrZWQgcmV0dXJucyhib29sKSB7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gQG5vdGljZSB0cmFuc2ZlciB0b2tlbnMgZnJvbSBnaXZlbiBhZGRyZXNzIHRvIGFub3RoZXIgYWRkcmVzcwogICAgLy8gQHBhcmFtIF9mcm9tIHthZGRyZXNzfSBmcm9tIHdob20gdG9rZW5zIGFyZSB0cmFuc2ZlcnJlZCAKICAgIC8vIEBwYXJhbSBfdG8ge2FkZHJlc3N9IHRvIHdob20gdG9rZW5zIGFyZSB0cmFuc2ZlcnJlZAogICAgLy8gQHBhcm0gX3ZhbHVlIHt1aW50fSBhbW91bnQgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLyBAcmV0dXJuICB7Ym9vbH0gdHJ1ZSBpZiBzdWNjZXNzZnVsICAgCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgb25seVVubG9ja2VkIHJldHVybnMoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlKTsgLy8gQ2hlY2sgaWYgdGhlIHNlbmRlciBoYXMgZW5vdWdoICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsgLy8gQ2hlY2sgaWYgYWxsb3dlZCBpcyBncmVhdGVyIG9yIGVxdWFsICAgICAgICAKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7IC8vIFN1YnRyYWN0IGZyb20gdGhlIHNlbmRlcgogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOyAvLyBBZGQgdGhlIHNhbWUgdG8gdGhlIHJlY2lwaWVudAogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIHRvIHF1ZXJ5IGJhbGFuY2Ugb2YgYWNjb3VudAogICAgLy8gQHJldHVybiBfb3duZXIge2FkZHJlc3N9IGFkZHJlc3Mgb2YgdXNlciB0byBxdWVyeSBiYWxhbmNlIAogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgICoKICAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICAqIHJhY2UgY29uZGl0aW9uIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUgYWZ0ZXJ3YXJkczoKICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHNwZW50LgogICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBAbm90aWNlIHRvIHF1ZXJ5IG9mIGFsbG93YW5jZSBvZiBvbmUgdXNlciB0byB0aGUgb3RoZXIKICAgIC8vIEBwYXJhbSBfb3duZXIge2FkZHJlc3N9IG9mIHRoZSBvd25lciBvZiB0aGUgYWNjb3VudAogICAgLy8gQHBhcmFtIF9zcGVuZGVyIHthZGRyZXNzfSBvZiB0aGUgc3BlbmRlciBvZiB0aGUgYWNjb3VudAogICAgLy8gQHJldHVybiByZW1haW5pbmcge3VpbnR9IGFtb3VudCBvZiByZW1haW5pbmcgYWxsb3dhbmNlCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnModWludCByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICAvKioKICAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgICovCiAgICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgICAgIH0KICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKfQ=='.
	

]
