Class {
	#name : #SRT812849100450a393c86ab8aa3fbb62119ee383c9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT812849100450a393c86ab8aa3fbb62119ee383c9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyA9PT09IERJU0NMQUlNRVIgPT09PQovLwovLyBFVEhFUkVVTSBJUyBTVElMTCBBTiBFWFBFUkVNRU5UQUwgVEVDSE5PTE9HWS4KLy8gQUxUSE9VR0ggVEhJUyBTTUFSVCBDT05UUkFDVCBXQVMgQ1JFQVRFRCBXSVRIIEdSRUFUIENBUkUgQU5EIElOIFRIRSBIT1BFIE9GIEJFSU5HIFVTRUZVTCwgTk8gR1VBUkFOVEVFUyBPRiBGTEFXTEVTUyBPUEVSQVRJT04gQ0FOIEJFIEdJVkVOLgovLyBJTiBQQVJUSUNVTEFSIC0gU1VCVElMRSBCVUdTLCBIQUNLRVIgQVRUQUNLUyBPUiBNQUxGVU5DVElPTiBPRiBVTkRFUkxZSU5HIFRFQ0hOT0xPR1kgQ0FOIENBVVNFIFVOSU5URU5USU9OQUwgQkVIQVZJT1VSLgovLyBZT1UgQVJFIFNUUk9OR0xZIEVOQ09VUkFHRUQgVE8gU1RVRFkgVEhJUyBTTUFSVCBDT05UUkFDVCBDQVJFRlVMTFkgSU4gT1JERVIgVE8gVU5ERVJTVEFORCBQT1NTSUJMRSBFREdFIENBU0VTIEFORCBSSVNLUy4KLy8gRE9OJ1QgVVNFIFRISVMgU01BUlQgQ09OVFJBQ1QgSUYgWU9VIEhBVkUgU1VCU1RBTlRJQUwgRE9VQlRTIE9SIElGIFlPVSBET04nVCBLTk9XIFdIQVQgWU9VIEFSRSBET0lORy4KLy8KLy8gVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQovLyBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsCi8vIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsCi8vIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLAovLyBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgovLyA9PT09Ci8vCgovLy8gQGF1dGhvciBTYW50aW1lbnQgTExDCi8vLyBAdGl0bGUgIFN1YnNjcmlwdGlvbiBNb2R1bGUgZm9yIFNBTiAtIHNhbnRpbWVudCB0b2tlbgoKY29udHJhY3QgQmFzZSB7CgogICAgZnVuY3Rpb24gbWF4KHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7IHJldHVybiBhID49IGIgPyBhIDogYjsgfQogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7IHJldHVybiBhIDw9IGIgPyBhIDogYjsgfQoKICAgIG1vZGlmaWVyIG9ubHkoYWRkcmVzcyBhbGxvd2VkKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWxsb3dlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCgogICAgLy8vQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaXplIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgICAgIH0KICAgICAgICByZXR1cm4gKHNpemUgPiAwKTsKICAgIH0KCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgIHJlZW50cmFuY3kgaGFuZGxpbmcgICAgICAgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy9AZGV2IHByZWRlZmluZWQgbG9ja3MgKHVwIHRvIHVpbnQgYml0IGxlbmd0aCwgaS5lLiAyNTYgcG9zc2libGUpCiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMCA9IDIgKiogMDsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAxID0gMiAqKiAxOwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDIgPSAyICoqIDI7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMyA9IDIgKiogMzsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDA0ID0gMiAqKiA0OwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDUgPSAyICoqIDU7CgogICAgLy9wcmV2ZW50cyByZWVudHJhbmN5IGF0dGFjczogc3BlY2lmaWMgbG9ja3MKICAgIHVpbnQgcHJpdmF0ZSBiaXRsb2NrcyA9IDA7CiAgICBtb2RpZmllciBub1JlZW50cmFuY3kodWludCBtKSB7CiAgICAgICAgdmFyIF9sb2NrcyA9IGJpdGxvY2tzOwogICAgICAgIGlmIChfbG9ja3MgJiBtID4gMCkgdGhyb3c7CiAgICAgICAgYml0bG9ja3MgfD0gbTsKICAgICAgICBfOwogICAgICAgIGJpdGxvY2tzID0gX2xvY2tzOwogICAgfQoKICAgIG1vZGlmaWVyIG5vQW55UmVlbnRyYW5jeSB7CiAgICAgICAgdmFyIF9sb2NrcyA9IGJpdGxvY2tzOwogICAgICAgIGlmIChfbG9ja3MgPiAwKSB0aHJvdzsKICAgICAgICBiaXRsb2NrcyA9IHVpbnQoLTEpOwogICAgICAgIF87CiAgICAgICAgYml0bG9ja3MgPSBfbG9ja3M7CiAgICB9CgogICAgLy8vQGRldiBlbXB0eSBtYXJraW5nIG1vZGlmaWVyIHNpZ25hbGluZyB0byB1c2VyIG9mIHRoZSBtYXJrZWQgZnVuY3Rpb24gLCB0aGF0IGl0IGNhbiBjYXVzZSBhbiByZWVudHJhbnQgY2FsbC4KICAgIC8vLyAgICAgZGV2ZWxvcGVyIHNob3VsZCBtYWtlIHRoZSBjYWxsZXIgZnVuY3Rpb24gcmVlbnRyYW50LXNhZmUgaWYgaXQgdXNlIGEgcmVlbnRyYW50IGZ1bmN0aW9uLgogICAgbW9kaWZpZXIgcmVlbnRyYW50IHsgXzsgfQoKfQoKY29udHJhY3QgT3duZWQgaXMgQmFzZSB7CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIG9ubHkob3duZXIpIHsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KCiAgICBmdW5jdGlvbiBhY2NlcHRPd25lcnNoaXAoKSBvbmx5KG5ld093bmVyKSB7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90byk7Cgp9CgoKY29udHJhY3QgRVJDMjAgaXMgT3duZWQgewoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUgJiYgYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+IGJhbGFuY2VzW190b10pIHsKICAgICAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0KICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlICYmIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgewogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgeyByZXR1cm4gZmFsc2U7IH0KICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBib29sICAgIHB1YmxpYyBpc1N0YXJ0ZWQgPSBmYWxzZTsKCiAgICBtb2RpZmllciBvbmx5SG9sZGVyKGFkZHJlc3MgaG9sZGVyKSB7CiAgICAgICAgaWYgKGJhbGFuY2VPZihob2xkZXIpID09IDApIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNTdGFydGVkT25seSgpIHsKICAgICAgICBpZiAoIWlzU3RhcnRlZCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCn0KCi8vRGVjaXNpb24gbWFkZS4KLy8gMSAtIFByb3ZpZGVyIGlzIHNvbGVseSByZXNwb25zaWJsZSB0byBjb25zaWRlciBmYWlsZWQgc3ViIGNoYXJnZSBhcyBhbiBlcnJvciBhbmQgc3RvcCB0aGUgc2VydmljZSwKLy8gICAgdGhlcmVmb3JlIHRoZXJlIGlzIG5vIHNlcGFyYXRlIGVycm9yIHN0YXRlIG9yIGNvdW50ZXIgZm9yIHRoYXQgaW4gdGhpcyBUb2tlbiBDb250cmFjdC4KLy8KLy8gMiAtIEEgY2FsbCBvcmlnaW5hdGVkIGZyb20gdGhlIHVzZXIgKGlzQ29udHJhY3QobXNnLnNlbmRlcik9PWZhbHNlKSBzaG91bGQgdGhyb3cgYW4gZXhjZXB0aW9uIG9uIGVycm9yLAovLyAgICAgYnV0IGl0IHNob3VsZCByZXR1cm4gImZhbHNlIiBvbiBlcnJvciBpZiBjYWxsZWQgZnJvbSBvdGhlciBjb250cmFjdCAoaXNDb250cmFjdChtc2cuc2VuZGVyKT09dHJ1ZSkuCi8vICAgICBSZWFzb246IHRocm93biBleGNlcHRpb24gYXJlIGVhc2llciB0byBzZWUgaW4gd2FsbGV0cywgcmV0dXJuZWQgYm9vbGVhbiB2YWx1ZXMgYXJlIGVhc2llciB0byBldmFsdWF0ZSBpbiB0aGUgY29kZSBvZiB0aGUgY2FsbGluZyBjb250cmFjdC4KLy8KLy8gMyAtIFNlcnZpY2UgcHJvdmlkZXJzIGFyZSByZXNwb25zaWJsZSBmb3IgZmlyaW5nIGV2ZW50cyBpbiBjYXNlIG9mIG9mZmVyIGNoYW5nZXM7Ci8vICAgICBpdCBpcyB0aGVpcnMgZGVjaXNpb24gdG8gaW5mb3JtIERBcHBzIGFib3V0IG9mZmVyIGNoYW5nZXMgb3Igbm90LgovLwoKCi8vL0BkZXYgYW4gYmFzZSBjbGFzcyB0byBpbXBsZW1lbnQgYnkgU2VydmljZSBQcm92aWRlciBjb250cmFjdCB0byBiZSBub3RpZmllZCBhYm91dCBzdWJzY3JpcHRpb24gY2hhbmdlcyAoaW4tVHggbm90aWZpY2F0aW9uKS4KLy8vICAgICBBZGRpdGlvbmFsbHkgaXQgY29udGFpbnMgc3RhbmRhcmQgZXZlbnRzIHRvIGJlIGZpcmVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgb24gb2ZmZXIgY2hhbmdlcy4KLy8vICAgICBzZWUgYWxzZSBFVk0gZXZlbnRzIGxvZ2dlZCBieSBzdWJzY3JpcHRpb24gbW9kdWxlLgovLwpjb250cmFjdCBTZXJ2aWNlUHJvdmlkZXIgewoKICAgIC8vL0BkZXYgZ2V0IGh1bWFuIHJlYWRhYmxlIGRlc2NyaXB0b3IgKG9yIHVybCkgZm9yIHRoaXMgU2VydmljZSBwcm92aWRlcgogICAgLy8KICAgIGZ1bmN0aW9uIGluZm8oKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyhzdHJpbmcpOwoKICAgIC8vL0BkZXYgY2FsbGVkIHRvIHBvc3QtYXBwcm92ZS9yZWplY3QgaW5jb21pbmcgc2luZ2xlIHBheW1lbnQuCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgcGF5bWVudC4KICAgIC8vCiAgICBmdW5jdGlvbiBvblBheW1lbnQoYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKICAgIC8vL0BkZXYgY2FsbGVkIHRvIHBvc3QtYXBwcm92ZS9yZWplY3Qgc3Vic2NyaXB0aW9uIGNoYXJnZS4KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBvcGVyYXRpb24uCiAgICAvLwogICAgZnVuY3Rpb24gb25TdWJFeGVjdXRlZCh1aW50IHN1YklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vQGRldiBjYWxsZWQgdG8gcG9zdC1hcHByb3ZlL3JlamVjdCBhIGNyZWF0aW9uIG9mIHRoZSBzdWJzY3JpcHRpb24uCiAgICAvLy9AcmV0dXJuIGBmYWxzZWAgY2F1c2VzIGFuIGV4Y2VwdGlvbiBhbmQgcmV2ZXJ0cyB0aGUgb3BlcmF0aW9uLgogICAgLy8KICAgIGZ1bmN0aW9uIG9uU3ViTmV3KHVpbnQgbmV3U3ViSWQsIHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKICAgIC8vL0BkZXYgY2FsbGVkIHRvIG5vdGlmeSBzZXJ2aWNlIHByb3ZpZGVyIGFib3V0IHN1YnNjcmlwdGlvbiBjYW5jZWxsYXRpb24uCiAgICAvLy8gICAgIFByb3ZpZGVyIGlzIG5vdCBhYmxlIHRvIHByZXZlbnQgdGhlIGNhbmNlbGxhdGlvbi4KICAgIC8vL0ByZXR1cm4gPDxyZXNlcnZlZCBmb3IgZnV0dXJlIGltcGxlbWVudGF0aW9uPj4KICAgIC8vCiAgICBmdW5jdGlvbiBvblN1YkNhbmNlbGVkKHVpbnQgc3ViSWQsIGFkZHJlc3MgY2FsbGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vQGRldiBjYWxsZWQgdG8gbm90aWZ5IHNlcnZpY2UgcHJvdmlkZXIgYWJvdXQgc3Vic2NyaXB0aW9uIGdvdCBob2xkL3VuaG9sZC4KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBvcGVyYXRpb24uCiAgICAvLwogICAgZnVuY3Rpb24gb25TdWJVbkhvbGQodWludCBzdWJJZCwgYWRkcmVzcyBjYWxsZXIsIGJvb2wgaXNPbkhvbGQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCgogICAgLy8vQGRldiBmb2xsb3dpbmcgZXZlbnRzIHNob3VsZCBiZSB1c2VkIGJ5IFNlcnZpY2VQcm92aWRlciBjb250cmFjdCB0byBub3RpZnkgREFwcHMgYWJvdXQgb2ZmZXIgY2hhbmdlcy4KICAgIC8vLyAgICAgU3Vic2NyaXB0aW9uTW9kdWxlIGRvIG5vdCB0aGlzIG5vdGlmaWNhdGlvbiBhbmQgZXhwZWN0cyBpdCBmcm9tIFNlcnZpY2UgUHJvdmlkZXIgaWYgZGVzaXJlZC4KICAgIC8vLwogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gbmV3IE9mZmVyIGNyZWF0ZWQgaW4gYSBwbGF0Zm9ybS4KICAgIGV2ZW50IE9mZmVyQ3JlYXRlZCh1aW50IG9mZmVySWQsICBieXRlcyBkZXNjcmlwdG9yLCBhZGRyZXNzIHByb3ZpZGVyKTsKCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBPZmZlciB1cGRhdGVkLgogICAgZXZlbnQgT2ZmZXJVcGRhdGVkKHVpbnQgb2ZmZXJJZCwgIGJ5dGVzIGRlc2NyaXB0b3IsIHVpbnQgb2xkRXhlY0NvdW50ZXIsIGFkZHJlc3MgcHJvdmlkZXIpOwoKICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIE9mZmVyIGNhbmNlbGVkLgogICAgZXZlbnQgT2ZmZXJDYW5jZWxlZCh1aW50IG9mZmVySWQsIGJ5dGVzIGRlc2NyaXB0b3IsIGFkZHJlc3MgcHJvdmlkZXIpOwoKICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIE9mZmVyIGhvbGQvdW5ob2xkIHN0YXR1cyBjaGFuZ2VkLgogICAgZXZlbnQgT2ZmZXJVbkhvbGQodWludCBvZmZlcklkLCAgIGJ5dGVzIGRlc2NyaXB0b3IsIGJvb2wgaXNPbkhvbGROb3csIGFkZHJlc3MgcHJvdmlkZXIpOwp9IC8vU2VydmljZVByb3ZpZGVyCgovLy9Abm90aWNlIFhSYXRlUHJvdmlkZXIgaXMgYW4gZXh0ZXJuYWwgc2VydmljZSBwcm92aWRpbmcgYW4gZXhjaGFuZ2UgcmF0ZSBmcm9tIGV4dGVybmFsIGN1cnJlbmN5IHRvIFNBTiB0b2tlbi4KLy8vIGl0IHVzZWQgZm9yIHN1YnNjcmlwdGlvbnMgcHJpY2VkIGluIG90aGVyIGN1cnJlbmN5IHRoYW4gU0FOIChldmVuIGNhbGN1bGF0ZWQgYW5kIHBhaWQgZm9ybWFsbHkgaW4gU0FOKS4KLy8vIGlmIG5vbi1kZWZhdWx0IFhSYXRlUHJvdmlkZXIgaXMgc2V0IGZvciBzb21lIHN1YnNjcmlwdGlvbiwgdGhlbiB0aGUgYW1vdW50IGluIFNBTiBmb3IgZXZlcnkgcGVyaW9kaWMgcGF5bWVudAovLy8gd2lsbCBiZSByZWNhbGN1bGF0ZWQgdXNpbmcgcHJvdmlkZWQgZXhjaGFuZ2UgcmF0ZS4KLy8vCi8vLyBQbGVhc2Ugbm90ZSwgdGhhdCB0aGUgZXhjaGFuZ2UgcmF0ZSBmcmFjdGlvbiBpcyAodWludDMyLHVpbnQzMikgbnVtYmVyLiBJdCBzaG91bGQgYmUgZW5vdWdoIHRvIGV4cHJlc3MKLy8vIGFueSByZWFsIGV4Y2hhbmdlIHJhdGUgdm9sYXRpbGl0eS4gTmV2ZXJ0aGVsZXNzIHlvdSBhcmUgYWR2aXNlZCB0byBhdm9pZCB0b28gYmlnIG51bWJlcnMgaW4gdGhlIGZyYWN0aW9uLgovLy8gUG9zc2lpYmx5IHlvdSBjb3VsZCBpbXBsZW1lbnQgdGhlIHJhdGlvIG9mIG11bHRpcGxlIHRva2VuIHBlciBTQU4gaW4gb3JkZXIgdG8ga2VlcCB0aGUgYXZlcmFnZSByYXRpbyBhcm91bmQgMToxLgovLy8KLy8vIFRoZSBkZWZhdWx0IFhSYXRlUHJvdmlkZXIgKHdpdGggaWQ9PTApIGRlZmluZXMgZXhjaGFuZ2UgcmF0ZSAxOjEgYW5kIHJlcHJlc2VudHMgZXhjaGFuZ2UgcmF0ZSBvZiBTQU4gdG9rZW4gdG8gaXRzZWxmLgovLy8gdGhpcyBwcm92aWRlciBpcyBzZXQgYnkgZGVmYWx1bHQgYW5kIHRodXMgdGhlIHN1YnNjcmlwdGlvbiBiZWNvbWVzIG5vbWluYXRlZCBpbiBTQU4uCi8vCmNvbnRyYWN0IFhSYXRlUHJvdmlkZXIgewoKICAgIC8vQGRldiByZXR1cm5zIGN1cnJlbnQgZXhjaGFuZ2UgcmF0ZSAoaW4gZm9ybSBvZiBhIHNpbXBsZSBmcmFjdGlvbikgZnJvbSBvdGhlciBjdXJyZW5jeSB0byBTQU4gKGYuZS4gRVRIOlNBTikuCiAgICAvL0BkZXYgZnJhY3Rpb24gbnVtYmVycyBhcmUgcmVzdHJpY3RlZCB0byB1aW50MTYgdG8gcHJldmVudCBvdmVyZmxvdyBpbiBjYWxjdWxhdGlvbnM7CiAgICBmdW5jdGlvbiBnZXRSYXRlKCkgcHVibGljIHJldHVybnMgKHVpbnQzMiAvKm5vbWluYXRvciovLCB1aW50MzIgLypkZW5vbWluYXRvciovKTsKCiAgICAvL0BkZXYgcHJvdmlkZXMgYSBjb2RlIGZvciBhbm90aGVyIGN1cnJlbmN5LCBmLmUuICJFVEgiIG9yICJVU0QiCiAgICBmdW5jdGlvbiBnZXRDb2RlKCkgcHVibGljIHJldHVybnMgKHN0cmluZyk7Cn0KCgovL0BkZXYgZGF0YSBzdHJ1Y3R1cmUgZm9yIFN1YnNjcmlwdGlvbk1vZHVsZQpjb250cmFjdCBTdWJzY3JpcHRpb25CYXNlIHsKCiAgICBlbnVtIFN1YlN0YXRlICAge05PVF9FWElTVCwgQkVGT1JFX1NUQVJULCBQQUlELCBDSEFSR0VBQkxFLCBPTl9IT0xELCBDQU5DRUxFRCwgRVhQSVJFRCwgRklOQUxJWkVEfQogICAgZW51bSBPZmZlclN0YXRlIHtOT1RfRVhJU1QsIEJFRk9SRV9TVEFSVCwgQUNUSVZFLCBTT0xEX09VVCwgT05fSE9MRCwgRVhQSVJFRH0KCiAgICBzdHJpbmdbXSBpbnRlcm5hbCBTVUJfU1RBVEVTICAgPSBbIk5PVF9FWElTVCIsICJCRUZPUkVfU1RBUlQiLCAiUEFJRCIsICJDSEFSR0VBQkxFIiwgIk9OX0hPTEQiLCAiQ0FOQ0VMRUQiLCAiRVhQSVJFRCIsICJGSU5BTElaRUQiIF07CiAgICBzdHJpbmdbXSBpbnRlcm5hbCBPRkZFUl9TVEFURVMgPSBbIk5PVF9FWElTVCIsICJCRUZPUkVfU1RBUlQiLCAiQUNUSVZFIiwgIlNPTERfT1VUIiwgIk9OX0hPTEQiLCAiRVhQSVJFRCJdOwoKICAgIC8vQGRldiBzdWJzY3JpcHRpb24gYW5kIHN1YnNjcmlwdGlvbiBvZmZlciB1c2UgdGhlIHNhbWUgc3RydWN0dXJlLiBPZmZlciBpcyB0ZWNobmljYWxseSBhIHRlbXBsYXRlIGZvciBzdWJzY3JpcHRpb24uCiAgICBzdHJ1Y3QgU3Vic2NyaXB0aW9uIHsKICAgICAgICBhZGRyZXNzIHRyYW5zZmVyRnJvbTsgICAvLyBjdXN0b21lciAodW5zZXQgaW4gc3Vic2NyaXB0aW9uIG9mZmVyKQogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJUbzsgICAgIC8vIHNlcnZpY2UgcHJvdmlkZXIKICAgICAgICB1aW50IHByaWNlUGVySG91cjsgICAgICAvLyBwcmljZSBpbiBTQU4gcGVyIGhvdXIgKHBvc3NpYmx5IHJlY2FsY3VsYXRlZCB1c2luZyBleGNoYW5nZSByYXRlKQogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfbjsgIC8vIG5vbWluYXRvcgogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfZDsgIC8vIGRlbm9taW5hdG9yCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZDsgLy8gaWQgb2YgYSByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIKICAgICAgICB1aW50IHBhaWRVbnRpbDsgICAgICAgICAvLyBzdWJzY3JpcHRpb24gaXMgcGFpZCB1bnRpbCB0aW1lCiAgICAgICAgdWludCBjaGFyZ2VQZXJpb2Q7ICAgICAgLy8gc3Vic2NyaXB0aW9uIGNhbid0IGJlIGNoYXJnZWQgbW9yZSBvZnRlbiB0aGFuIHRoaXMgcGVyaW9kCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50OyAgICAgLy8gdXBmcm9udCBkZXBvc2l0IG9uIGNyZWF0aW5nIHN1YnNjcmlwdGlvbiAocG9zc2libHkgcmVjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUpCgogICAgICAgIHVpbnQgc3RhcnRPbjsgICAgICAgICAgIC8vIGZvciBvZmZlcjogY2FuJ3QgYmUgYWNjZXB0ZWQgYmVmb3JlICA8c3RhcnRPbj4gOyBmb3Igc3Vic2NyaXB0aW9uOiBjYW4ndCBiZSBjaGFyZ2VkIGJlZm9yZSA8c3RhcnRPbj4KICAgICAgICB1aW50IGV4cGlyZU9uOyAgICAgICAgICAvLyBmb3Igb2ZmZXI6IGNhbid0IGJlIGFjY2VwdGVkIGFmdGVyICA8ZXhwaXJlT24+IDsgZm9yIHN1YnNjcmlwdGlvbjogY2FuJ3QgYmUgY2hhcmdlZCBhZnRlciAgPGV4cGlyZU9uPgogICAgICAgIHVpbnQgZXhlY0NvdW50ZXI7ICAgICAgIC8vIGZvciBvZmZlcjogbWF4IG51bSBvZiBzdWJzY3JpcHRpb25zIGF2YWlsYWJsZSAgOyBmb3Igc3Vic2NyaXB0aW9uOiBudW0gb2YgY2hhcmdlcyBtYWRlLgogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3I7ICAgICAgIC8vIHN1YnNjcmlwdGlvbiBwYXlsb2FkIChzdWJqZWN0KTogZXZhbHVhdGVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIuCiAgICAgICAgdWludCBvbkhvbGRTaW5jZTsgICAgICAgLy8gc3Vic2NyaXB0aW9uOiBvbi1ob2xkIHNpbmNlIHRpbWUgb3IgMCBpZiBub3Qgb25Ib2xkLiBvZmZlcjogdW51c2VkOiAvL1RvRG86IHRvIGJlIGltcGxlbWVudGVkCiAgICB9CgogICAgc3RydWN0IERlcG9zaXQgewogICAgICAgIHVpbnQgdmFsdWU7ICAgICAgICAgLy8gdmFsdWUgb24gZGVwb3NpdAogICAgICAgIGFkZHJlc3Mgb3duZXI7ICAgICAgLy8gdXN1YWxseSBhIGN1c3RvbWVyCiAgICAgICAgdWludCBjcmVhdGVkT247ICAgICAvLyBkZXBvc2l0IGNyZWF0ZWQgdGltZXN0YW1wCiAgICAgICAgdWludCBsb2NrVGltZTsgICAgICAvLyBkZXBvc2l0IGxvY2tlZCBmb3IgdGltZSBwZXJpb2QKICAgICAgICBieXRlcyBkZXNjcmlwdG9yOyAgIC8vIHNlcnZpY2UgcmVsYXRlZCBkZXNjcmlwdG9yIHRvIGJlIGV2YWx1YXRlZCBieSBzZXJ2aWNlIHByb3ZpZGVyCiAgICB9CgogICAgZXZlbnQgTmV3U3Vic2NyaXB0aW9uKGFkZHJlc3MgY3VzdG9tZXIsIGFkZHJlc3Mgc2VydmljZSwgdWludCBvZmZlcklkLCB1aW50IHN1YklkKTsKICAgIGV2ZW50IE5ld0RlcG9zaXQodWludCBkZXBvc2l0SWQsIHVpbnQgdmFsdWUsIHVpbnQgbG9ja1RpbWUsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IE5ld1hSYXRlUHJvdmlkZXIoYWRkcmVzcyBhZGRyLCB1aW50MTYgeFJhdGVQcm92aWRlcklkLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBEZXBvc2l0UmV0dXJuZWQodWludCBkZXBvc2l0SWQsIGFkZHJlc3MgcmV0dXJuZWRUbyk7CiAgICBldmVudCBTdWJzY3JpcHRpb25EZXBvc2l0UmV0dXJuZWQodWludCBzdWJJZCwgdWludCBhbW91bnQsIGFkZHJlc3MgcmV0dXJuZWRUbywgYWRkcmVzcyBzZW5kZXIpOwogICAgZXZlbnQgT2ZmZXJPbkhvbGQodWludCBvZmZlcklkLCBib29sIG9uSG9sZCwgYWRkcmVzcyBzZW5kZXIpOwogICAgZXZlbnQgT2ZmZXJDYW5jZWxlZCh1aW50IG9mZmVySWQsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IFN1Yk9uSG9sZCh1aW50IG9mZmVySWQsIGJvb2wgb25Ib2xkLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBTdWJDYW5jZWxlZCh1aW50IHN1YklkLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBTdWJNb2R1bGVTdXNwZW5kZWQodWludCBzdXNwZW5kVW50aWwpOwoKfQoKLy8vQGRldiBhbiBJbnRlcmZhY2UgZm9yIFN1YnNjcmlwdGlvbk1vZHVsZS4KLy8vICAgICBleHRyYWN0ZWQgaGVyZSBmb3IgYmV0dGVyIG92ZXJ2aWV3LgovLy8gICAgIHNlZSBkZXRhaWxlZCBkb2N1bWVudGF0aW9uIGluIGltcGxlbWVudGF0aW9uIG1vZHVsZS4KY29udHJhY3QgU3Vic2NyaXB0aW9uTW9kdWxlIGlzIFN1YnNjcmlwdGlvbkJhc2UsIEJhc2UgewoKICAgIC8vL0BkZXYgKioqKiogbW9kdWxlIGNvbmZpZ3VyYXRpb24gKioqKioKICAgIGZ1bmN0aW9uIGF0dGFjaFRva2VuKGFkZHJlc3MgdG9rZW4pIHB1YmxpYzsKCiAgICAvLy9AZGV2ICoqKioqIHNpbmdsZSBwYXltZW50IGhhbmRsaW5nICoqKioqCiAgICBmdW5jdGlvbiBwYXltZW50VG8odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gcGF5bWVudEZyb20odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgYWRkcmVzcyBfZnJvbSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vL0BkZXYgKioqKiogc3Vic2NyaXB0aW9uIGhhbmRsaW5nICoqKioqCiAgICAvLy9AZGV2IHNvbWUgZnVuY3Rpb25zIGFyZSBtYXJrZWQgYXMgcmVlbnRyYW50LCBldmVuIHRoZWlycyBpbXBsZW1lbnRhdGlvbiBpcyBtYXJrZWQgd2l0aCBub1JlZW50cmFuY3koTE9DSykuCiAgICAvLy8gICAgIFRoaXMgaXMgaW50ZW50aW9uYWxseSBiZWNhdXNlIHRoZXNlIG5vUmVlbnRyYW5jeShMT0NLKSByZXN0cmljdGlvbnMgY2FuIGJlIGxpZnRlZCBpbiB0aGUgZnV0dXJlLgogICAgLy8gICAgICBGdW5jdGlvbnMgd291bGQgYmVjb21lIHJlZW50cmFudC4KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbih1aW50IF9vZmZlcklkLCB1aW50IF9leHBpcmVPbiwgdWludCBfc3RhcnRPbikgcHVibGljIHJlZW50cmFudCByZXR1cm5zICh1aW50IG5ld1N1YklkKTsKICAgIGZ1bmN0aW9uIGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSByZWVudHJhbnQgcHVibGljOwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSkgcmVlbnRyYW50IHB1YmxpYzsKICAgIGZ1bmN0aW9uIGhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdW5ob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGV4ZWN1dGVTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gcG9zdHBvbmVEdWVEYXRlKHVpbnQgc3ViSWQsIHVpbnQgbmV3RHVlRGF0ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBjbGFpbVN1YnNjcmlwdGlvbkRlcG9zaXQodWludCBzdWJJZCkgcHVibGljOwogICAgZnVuY3Rpb24gc3RhdGUodWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHN0YXRlKTsKICAgIGZ1bmN0aW9uIHN0YXRlQ29kZSh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50IHN0YXRlQ29kZSk7CgogICAgLy8vQGRldiAqKioqKiBzdWJzY3JpcHRpb24gb2ZmZXIgaGFuZGxpbmcgKioqKioKICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX3ByaWNlLCB1aW50MTYgX3hyYXRlUHJvdmlkZXJJZCwgdWludCBfY2hhcmdlUGVyaW9kLCB1aW50IF9leHBpcmVPbiwgdWludCBfb2ZmZXJMaW1pdCwgdWludCBfZGVwb3NpdFZhbHVlLCB1aW50IF9zdGFydE9uLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIHJlZW50cmFudCByZXR1cm5zICh1aW50IHN1YklkKTsKICAgIGZ1bmN0aW9uIHVwZGF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCwgdWludCBfb2ZmZXJMaW1pdCkgcHVibGljOwogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vQGRldiAqKioqKiBzaW1wbGUgZGVwb3NpdCBoYW5kbGluZyAqKioqKgogICAgZnVuY3Rpb24gY3JlYXRlRGVwb3NpdCh1aW50IF92YWx1ZSwgdWludCBsb2NrVGltZSwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyByZXR1cm5zICh1aW50IHN1YklkKTsKICAgIGZ1bmN0aW9uIGNsYWltRGVwb3NpdCh1aW50IGRlcG9zaXRJZCkgcHVibGljOwoKICAgIC8vL0BkZXYgKioqKiogRXhjaGFuZ2VSYXRlIHByb3ZpZGVyICoqKioqCiAgICBmdW5jdGlvbiByZWdpc3RlclhSYXRlUHJvdmlkZXIoWFJhdGVQcm92aWRlciBhZGRyKSBwdWJsaWMgcmV0dXJucyAodWludDE2IHhyYXRlUHJvdmlkZXJJZCk7CgogICAgLy8vQGRldiAqKioqKiBTZXJ2aWNlIHByb3ZpZGVyIChwYXltZW50IHJlY2VpdmVyKSAqKioqKgogICAgZnVuY3Rpb24gZW5hYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljOwogICAgZnVuY3Rpb24gZGlzYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYzsKCgogICAgLy8vQGRldiAqKioqKiBjb252ZW5pZW5jZSBzdWJzY3JpcHRpb24gZ2V0dGVyICoqKioqCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25EZXRhaWxzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKAogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJGcm9tLAogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJUbywKICAgICAgICB1aW50IHByaWNlUGVySG91ciwKICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX24sIC8vbm9taW5hdG9yCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kLCAvL2Rlbm9taW5hdG9yCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZCwKICAgICAgICB1aW50IGNoYXJnZVBlcmlvZCwKICAgICAgICB1aW50IHN0YXJ0T24sCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcgogICAgKTsKCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25TdGF0dXModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50LAogICAgICAgIHVpbnQgZXhwaXJlT24sCiAgICAgICAgdWludCBleGVjQ291bnRlciwKICAgICAgICB1aW50IHBhaWRVbnRpbCwKICAgICAgICB1aW50IG9uSG9sZFNpbmNlCiAgICApOwoKICAgIGVudW0gUGF5bWVudFN0YXR1cyB7T0ssIEJBTEFOQ0VfRVJST1IsIEFQUFJPVkFMX0VSUk9SfQogICAgZXZlbnQgUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHVpbnQgX2ZlZSwgYWRkcmVzcyBzZW5kZXIsIFBheW1lbnRTdGF0dXMgc3RhdHVzLCB1aW50IHN1YklkKTsKICAgIGV2ZW50IFNlcnZpY2VQcm92aWRlckVuYWJsZWQoYWRkcmVzcyBhZGRyLCBieXRlcyBtb3JlSW5mbyk7CiAgICBldmVudCBTZXJ2aWNlUHJvdmlkZXJEaXNhYmxlZChhZGRyZXNzIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKTsKCn0gLy9TdWJzY3JpcHRpb25Nb2R1bGUKCmNvbnRyYWN0IEVSQzIwTW9kdWxlU3VwcG9ydCB7CiAgICBmdW5jdGlvbiBfZnVsZmlsbFByZWFwcHJvdmVkUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGFkZHJlc3MgbXNnX3NlbmRlcikgcHVibGljIHJldHVybnMoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIF9mdWxmaWxsUGF5bWVudChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHVpbnQgc3ViSWQsIGFkZHJlc3MgbXNnX3NlbmRlcikgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBfbWludEZyb21EZXBvc2l0KGFkZHJlc3Mgb3duZXIsIHVpbnQgYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBfYnVybkZvckRlcG9zaXQoYWRkcmVzcyBvd25lciwgdWludCBhbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2Vzcyk7Cn0KCi8vQGRldiBpbXBsZW1lbnRhdGlvbgpjb250cmFjdCBTdWJzY3JpcHRpb25Nb2R1bGVJbXBsIGlzIFN1YnNjcmlwdGlvbk1vZHVsZSwgT3duZWQgIHsKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFZFUlNJT04gPSAiMC4yLjAiOwoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgICAgIGNvbnRyYWN0IHN0YXRlcyAgICAgICAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvLy9AZGV2IHN1c3BlbmQgYWxsIG1vZHVsZSBvcGVyYXRpb24gdW50aWwgdGhpcyB0aW1lIChpZiBpbiBmdXR1cmUpOyBpZiB0aGUgdGltZSBpcyBpbiBwYXN0IChvciB6ZXJvKSAtIG9wZXJhdGVzIG5vcm1hbGx5LgogICAgdWludCBwdWJsaWMgc3VzcGVuZGVkVW50aWwgPSAwOwogICAgZnVuY3Rpb24gaXNTdXNwZW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7IHJldHVybiBzdXNwZW5kZWRVbnRpbCA+IG5vdzsgfQoKICAgIC8vL0BkZXYgbGlzdCBvZiBhbGwgcmVnaXN0ZXJlZCBzZXJ2aWNlIHByb3ZpZGVyIGNvbnRyYWN0cyBpbXBsZW1lbnRlZCBhcyBhIG1hcCBmb3IgYmV0dGVyIGxvb2t1cC4KICAgIG1hcHBpbmcgKGFkZHJlc3M9PmJvb2wpIHB1YmxpYyBwcm92aWRlclJlZ2lzdHJ5OwoKICAgIC8vL0BkZXYgYWxsIHN1YnNjcmlwdGlvbnMgYW5kIG9mZmVycyAoaW5jbC4gRklOQUxJWkVEKS4KICAgIG1hcHBpbmcgKHVpbnQgPT4gU3Vic2NyaXB0aW9uKSBwdWJsaWMgc3Vic2NyaXB0aW9uczsKCiAgICAvLy9AZGV2IGFsbCBhY3RpdmUgc2ltcGxlIGRlcG9zaXRzIGdpdmVkIGJ5IGRlcG9zaXRJZC4KICAgIG1hcHBpbmcgKHVpbnQgPT4gRGVwb3NpdCkgcHVibGljIGRlcG9zaXRzOwoKICAgIC8vL0BkZXYgYWRkcmVzc2VzIG9mIHJlZ2lzdGVyZWQgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlcnMuCiAgICBYUmF0ZVByb3ZpZGVyW10gcHVibGljIHhyYXRlUHJvdmlkZXJzOwoKICAgIC8vL0BkZXYgb25nb2luZyBjb3VudGVyIGZvciBzdWJzY3JpcHRpb24gaWRzIHN0YXJ0aW5nIGZyb20gMS4KICAgIC8vLyAgICAgQ3VycmVudCB2YWx1ZSByZXByZXNlbnRzIGFuIGlkIG9mIGxhc3QgY3JlYXRlZCBzdWJzY3JpcHRpb24uCiAgICB1aW50IHB1YmxpYyBzdWJzY3JpcHRpb25Db3VudGVyID0gMDsKCiAgICAvLy9AZGV2IG9uZ29pbmcgY291bnRlciBmb3Igc2ltcGxlIGRlcG9zaXQgaWRzIHN0YXJ0aW5nIGZyb20gMS4KICAgIC8vLyAgICAgQ3VycmVudCB2YWx1ZSByZXByZXNlbnRzIGFuIGlkIG9mIGxhc3QgY3JlYXRlZCBkZXBvc2l0LgogICAgdWludCBwdWJsaWMgZGVwb3NpdENvdW50ZXIgPSAwOwoKICAgIC8vL0BkZXYgVG9rZW4gY29udHJhY3Qgd2l0aCBFUkMyME1vZHVsZVN1cHBvcnQgYWRkb24uCiAgICAvLy8gICAgIFN1YnNjcmlwdGlvbiBNb2R1bGUgb3BlcmF0ZXMgb24gaXRzIGJhbGFuY2VzIHZpYSBFUkMyME1vZHVsZVN1cHBvcnQgaW50ZXJmYWNlIGFzIHRydXN0ZWQgbW9kdWxlLgogICAgRVJDMjBNb2R1bGVTdXBwb3J0IHB1YmxpYyBzYW47CgoKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICByZWplY3QgYWxsIGV0aGVyIHNlbnQgdG8gdGhpcyBjb250cmFjdCAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CgoKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgICAgc2V0dXAgYW5kIGNvbmZpZ3VyYXRpb24gICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy8vQGRldiBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU3Vic2NyaXB0aW9uTW9kdWxlSW1wbCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgeHJhdGVQcm92aWRlcnMucHVzaChYUmF0ZVByb3ZpZGVyKHRoaXMpKTsgLy90aGlzIGlzIGEgZGVmYXVsdCBTQU46U0FOICgxOjEpIHByb3ZpZGVyIHdpdGggZGVmYXVsdCBpZCA9PSAwCiAgICB9CgoKICAgIC8vL0BkZXYgYXR0YWNoIFNBTiB0b2tlbiB0byB3b3JrIHdpdGg7IGNhbiBiZSBkb25lIG9ubHkgb25jZS4KICAgIGZ1bmN0aW9uIGF0dGFjaFRva2VuKGFkZHJlc3MgdG9rZW4pIHB1YmxpYyB7CiAgICAgICAgYXNzZXJ0KGFkZHJlc3Moc2FuKSA9PSAwKTsgLy9vbmx5IGluIG5ldyBkZXBsb3llZCBzdGF0ZQogICAgICAgIHNhbiA9IEVSQzIwTW9kdWxlU3VwcG9ydCh0b2tlbik7CiAgICB9CgoKICAgIC8vL0BkZXYgcmVnaXN0ZXIgYSBuZXcgc2VydmljZSBwcm92aWRlciB0byB0aGUgcGxhdGZvcm0uCiAgICBmdW5jdGlvbiBlbmFibGVTZXJ2aWNlUHJvdmlkZXIoU2VydmljZVByb3ZpZGVyIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKSBwdWJsaWMgbm90U3VzcGVuZGVkIG9ubHkob3duZXIpIHsKICAgICAgICBwcm92aWRlclJlZ2lzdHJ5W2FkZHJdID0gdHJ1ZTsKICAgICAgICBTZXJ2aWNlUHJvdmlkZXJFbmFibGVkKGFkZHIsIG1vcmVJbmZvKTsKICAgIH0KCgogICAgLy8vQGRldiBkZS1yZWdpc3RlciB0aGUgc2VydmljZSBwcm92aWRlciB3aXRoIGdpdmVuIGBhZGRyYC4KICAgIGZ1bmN0aW9uIGRpc2FibGVTZXJ2aWNlUHJvdmlkZXIoU2VydmljZVByb3ZpZGVyIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKSBwdWJsaWMgbm90U3VzcGVuZGVkIG9ubHkob3duZXIpIHsKICAgICAgICBkZWxldGUgcHJvdmlkZXJSZWdpc3RyeVthZGRyXTsKICAgICAgICBTZXJ2aWNlUHJvdmlkZXJEaXNhYmxlZChhZGRyLCBtb3JlSW5mbyk7CiAgICB9CgogICAgLy8vQGRldiBzdXNwZW5kIGFsbCBtb2R1bGUgb3BlcmF0aW9ucyBmb3IgZ2l2ZW4gdGltZS4KICAgIGZ1bmN0aW9uIHN1c3BlbmQodWludCBzdXNwZW5kVGltZVNlYykgcHVibGljIG9ubHkob3duZXIpIHsKICAgICAgICBzdXNwZW5kZWRVbnRpbCA9IG5vdyArIHN1c3BlbmRUaW1lU2VjOwogICAgICAgIFN1Yk1vZHVsZVN1c3BlbmRlZChzdXNwZW5kZWRVbnRpbCk7CiAgICB9CgogICAgLy8vQGRldiByZWdpc3RlciBuZXcgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlci4KICAgIC8vLyAgICAgWFJhdGVQcm92aWRlciBjYW4ndCBiZSBkZS1yZWdpc3RlcmVkLCBiZWNhdXNlIHRoZXkgY291bGQgYmUgc3RpbGwgaW4gdXNlIGJ5IHNvbWUgc3Vic2NyaXB0aW9uLgogICAgZnVuY3Rpb24gcmVnaXN0ZXJYUmF0ZVByb3ZpZGVyKFhSYXRlUHJvdmlkZXIgYWRkcikgcHVibGljIG5vdFN1c3BlbmRlZCBvbmx5KG93bmVyKSByZXR1cm5zICh1aW50MTYgeHJhdGVQcm92aWRlcklkKSB7CiAgICAgICAgeHJhdGVQcm92aWRlcklkID0gdWludDE2KHhyYXRlUHJvdmlkZXJzLmxlbmd0aCk7CiAgICAgICAgeHJhdGVQcm92aWRlcnMucHVzaChhZGRyKTsKICAgICAgICBOZXdYUmF0ZVByb3ZpZGVyKGFkZHIsIHhyYXRlUHJvdmlkZXJJZCwgbXNnLnNlbmRlcik7CiAgICB9CgoKICAgIC8vL0BkZXYgeHJhdGVQcm92aWRlcnMgbGVuZ3RoIGFjY2Vzc29yLgogICAgZnVuY3Rpb24gZ2V0WFJhdGVQcm92aWRlckxlbmd0aCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHhyYXRlUHJvdmlkZXJzLmxlbmd0aDsKICAgIH0KCgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgICAgICAgc2luZ2xlIHBheW1lbnQgbWV0aG9kcyAgICAgICAgICAgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vL0Bub3RpY2UgbWFrZXMgc2luZ2xlIHBheW1lbnQgdG8gc2VydmljZSBwcm92aWRlci4KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgU0FOIHRva2VuIHRvIHNlbnQKICAgIC8vL0BwYXJhbSBfcGF5bWVudERhdGEgLSAncGF5bWVudCBwdXJwb3NlJyBjb2RlIHVzdWFsbHkgaXNzdWVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gY3VzdG9tZXIgYmVmb3JlIHBheW1lbnQuCiAgICAvLy9AcGFyYW0gX3RvIC0gc2VydmljZSBwcm92aWRlciBjb250cmFjdAogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gcGF5bWVudFRvKHVpbnQgX3ZhbHVlLCBieXRlcyBfcGF5bWVudERhdGEsIFNlcnZpY2VQcm92aWRlciBfdG8pIHB1YmxpYyBub3RTdXNwZW5kZWQgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChzYW4uX2Z1bGZpbGxQYXltZW50KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCAwLCBtc2cuc2VuZGVyKSkgewogICAgICAgICAgICAvLyBhIFNlcnZpY2VQcm92aWRlciAoYSBTZXJ2aWNlUHJvdmlkZXIpIGhhcyBoZXJlIGFuIG9wcG9ydHVuaXR5IHZlcmlmeSBhbmQgcmVqZWN0IHRoZSBwYXltZW50CiAgICAgICAgICAgIGFzc2VydCAoU2VydmljZVByb3ZpZGVyKF90bykub25QYXltZW50KG1zZy5zZW5kZXIsIF92YWx1ZSwgX3BheW1lbnREYXRhKSk7ICAgICAgICAgICAgICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgbWFrZXMgc2luZ2xlIHByZWFwcHJvdmVkIHBheW1lbnQgdG8gc2VydmljZSBwcm92aWRlci4gQW4gYW1vdW50IG11c3QgYmUgYWxyZWFkeSBwcmVhcHByb3ZlZCBieSBwYXltZW50IHNlbmRlciB0byByZWNlcGllbnQuCiAgICAvLy9AcGFyYW0gX3ZhbHVlIC0gYW1vdW50IG9mIFNBTiB0b2tlbiB0byBzZW50CiAgICAvLy9AcGFyYW0gX3BheW1lbnREYXRhIC0gJ3BheW1lbnQgcHVycG9zZScgY29kZSB1c3VhbGx5IGlzc3VlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIGN1c3RvbWVyIGJlZm9yZSBwYXltZW50LgogICAgLy8vQHBhcmFtIF9mcm9tIC0gc2VuZGVyIG9mIHRoZSBwYXltZW50IChvdGhlciB0aGFuIG1zZy5zZW5kZXIpCiAgICAvLy9AcGFyYW0gX3RvIC0gc2VydmljZSBwcm92aWRlciBjb250cmFjdAogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gcGF5bWVudEZyb20odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgYWRkcmVzcyBfZnJvbSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIG5vdFN1c3BlbmRlZCByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKHNhbi5fZnVsZmlsbFByZWFwcHJvdmVkUGF5bWVudChfZnJvbSwgX3RvLCBfdmFsdWUsIG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgIC8vIGEgU2VydmljZVByb3ZpZGVyIChhIFNlcnZpY2VQcm92aWRlcikgaGFzIGhlcmUgYW4gb3Bwb3J0dW5pdHkgdmVyaWZ5IGFuZCByZWplY3QgdGhlIHBheW1lbnQKICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblBheW1lbnQoX2Zyb20sIF92YWx1ZSwgX3BheW1lbnREYXRhKSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgICAgICAgIHN1YnNjcmlwdGlvbiBoYW5kbGluZyAgICAgICAgICAgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vL0BkZXYgY29udmVuaWVuY2UgZ2V0dGVyIGZvciBzb21lIHN1YnNjcmlwdGlvbiBmaWVsZHMKICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkRldGFpbHModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKAogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJGcm9tLAogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJUbywKICAgICAgICB1aW50IHByaWNlUGVySG91ciwKICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX24sIC8vbm9taW5hdG9yCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kLCAvL2Rlbm9taW5hdG9yCiAgICAgICAgdWludDE2IHhyYXRlUHJvdmlkZXJJZCwKICAgICAgICB1aW50IGNoYXJnZVBlcmlvZCwKICAgICAgICB1aW50IHN0YXJ0T24sCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcgogICAgKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIHJldHVybiAoc3ViLnRyYW5zZmVyRnJvbSwgc3ViLnRyYW5zZmVyVG8sIHN1Yi5wcmljZVBlckhvdXIsIHN1Yi5pbml0aWFsWHJhdGVfbiwgc3ViLmluaXRpYWxYcmF0ZV9kLCBzdWIueHJhdGVQcm92aWRlcklkLCBzdWIuY2hhcmdlUGVyaW9kLCBzdWIuc3RhcnRPbiwgc3ViLmRlc2NyaXB0b3IpOwogICAgfQoKCiAgICAvLy9AZGV2IGNvbnZlbmllbmNlIGdldHRlciBmb3Igc29tZSBzdWJzY3JpcHRpb24gZmllbGRzCiAgICAvLy8gICAgIGEgY2FsbGVyIG11c3Qga25vdywgdGhhdCB0aGUgc3Vic2NyaXB0aW9uIHdpdGggZ2l2ZW4gaWQgZXhpc3RzLCBiZWNhdXNlIGFsbCB0aGVzZSBmaWVsZHMgY2FuIGJlIDAgZXZlbiB0aGUgc3Vic2NyaXB0aW9uIHdpdGggZ2l2ZW4gaWQgZXhpc3RzLgogICAgZnVuY3Rpb24gc3Vic2NyaXB0aW9uU3RhdHVzKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKAogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudCwKICAgICAgICB1aW50IGV4cGlyZU9uLAogICAgICAgIHVpbnQgZXhlY0NvdW50ZXIsCiAgICAgICAgdWludCBwYWlkVW50aWwsCiAgICAgICAgdWludCBvbkhvbGRTaW5jZQogICAgKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIHJldHVybiAoc3ViLmRlcG9zaXRBbW91bnQsIHN1Yi5leHBpcmVPbiwgc3ViLmV4ZWNDb3VudGVyLCBzdWIucGFpZFVudGlsLCBzdWIub25Ib2xkU2luY2UpOwogICAgfQoKCiAgICAvLy9Abm90aWNlIGV4ZWN1dGUgcGVyaW9kaWMgc3Vic2NyaXB0aW9uIHBheW1lbnQuCiAgICAvLy8gICAgICAgIEFueSBvZiBjdXN0b21lciwgc2VydmljZSBwcm92aWRlciBhbmQgcGxhdGZvcm0gb3duZXIgY2FuIGV4ZWN1dGUgdGhpcyBmdW5jdGlvbi4KICAgIC8vLyAgICAgICAgVGhpcyBlbnN1cmVzLCB0aGF0IHRoZSBzdWJzY3JpcHRpb24gY2hhcmdlIGRvZXNuJ3QgYmVjb21lIGRlbGF5ZWQuCiAgICAvLy8gICAgICAgIEF0IGxlYXN0IHRoZSBwbGF0Zm9ybSBvd25lciBoYXMgYW4gaW5jZW50aXZlIHRvIGdldCBmZWUgYW5kIHRodXMgY2FuIHRyaWdnZXIgdGhlIGZ1bmN0aW9uLgogICAgLy8vICAgICAgICBBbiBleGVjdXRpb24gZmFpbHMgaWYgc3Vic2NyaXB0aW9uIGlzIG5vdCBpbiBzdGF0dXMgYENIQVJHRUFCTEVgLgogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIHRvIGJlIGNoYXJnZWQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBleGVjdXRlU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgbm9SZWVudHJhbmN5KEwwMCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAobXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJGcm9tIHx8IG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyVG8gfHwgbXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgaWYgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpPT1TdWJTdGF0ZS5DSEFSR0VBQkxFKSB7CiAgICAgICAgICAgIHZhciBfZnJvbSA9IHN1Yi50cmFuc2ZlckZyb207CiAgICAgICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsKICAgICAgICAgICAgdmFyIF92YWx1ZSA9IF9hbW91bnRUb0NoYXJnZShzdWIpOwogICAgICAgICAgICBpZiAoc2FuLl9mdWxmaWxsUGF5bWVudChfZnJvbSwgX3RvLCBfdmFsdWUsIHN1YklkLCBtc2cuc2VuZGVyKSkgewogICAgICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCAgPSBtYXgoc3ViLnBhaWRVbnRpbCwgc3ViLnN0YXJ0T24pICsgc3ViLmNoYXJnZVBlcmlvZDsKICAgICAgICAgICAgICAgICsrc3ViLmV4ZWNDb3VudGVyOwogICAgICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB0byB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudAogICAgICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblN1YkV4ZWN1dGVkKHN1YklkKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBtb3ZlIGBwYWlkVW50aWxgIGZvcndhcmQgdG8gZ2l2ZW4gYG5ld0R1ZURhdGVgLiBJdCB3YWl2ZXMgcGF5bWVudHMgZm9yIGdpdmVuIHRpbWUuCiAgICAvLy8gICAgICAgIFRoaXMgZnVuY3Rpb24gY2FuIGJlIHVzZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBgZ2l2ZSBhd2F5YCBzb21lIHNlcnZpY2UgdGltZSBmb3IgZnJlZS4KICAgIC8vL0BwYXJhbSBzdWJJZCAtIGlkIG9mIHN1YnNjcmlwdGlvbiB0byBiZSBwb3N0cG9uZWQuCiAgICAvLy9AcGFyYW0gbmV3RHVlRGF0ZSAtIG5ldyBgcGFpZFVudGlsYCBkYXRldGltZTsgcmVxdWlyZSBgbmV3RHVlRGF0ZSA+IHBhaWRVbnRpbGAuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBwb3N0cG9uZUR1ZURhdGUodWludCBzdWJJZCwgdWludCBuZXdEdWVEYXRlKSBwdWJsaWMgbm90U3VzcGVuZGVkIHJldHVybnMgKGJvb2wgc3VjY2Vzcyl7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNTdWJzY3JpcHRpb24oc3ViKSk7CiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJUbyA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IFNlcnZpY2UgUHJvdmlkZXIgaXMgYWxsb3dlZCB0byBwb3N0cG9uZSB0aGUgRHVlRGF0ZQogICAgICAgIGlmIChzdWIucGFpZFVudGlsIDwgbmV3RHVlRGF0ZSkgewogICAgICAgICAgICBzdWIucGFpZFVudGlsID0gbmV3RHVlRGF0ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKICAgIC8vL0BkZXYgcmV0dXJuIGN1cnJlbnQgc3RhdHVzIGFzIGEgbmFtZSBvZiBhIHN1YnNjcmlwdGlvbiAob3IgYW4gb2ZmZXIpIHdpdGggZ2l2ZW4gaWQ7CiAgICBmdW5jdGlvbiBzdGF0ZSh1aW50IHN1Yk9yT2ZmZXJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoc3RyaW5nIHN0YXRlKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN1Yk9yT2ZmZXIgPSBzdWJzY3JpcHRpb25zW3N1Yk9yT2ZmZXJJZF07CiAgICAgICAgcmV0dXJuIF9pc09mZmVyKHN1Yk9yT2ZmZXIpCiAgICAgICAgICAgICAgPyBPRkZFUl9TVEFURVNbdWludChfb2ZmZXJTdGF0ZShzdWJPck9mZmVyKSldCiAgICAgICAgICAgICAgOiBTVUJfU1RBVEVTW3VpbnQoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yk9yT2ZmZXIpKV07CiAgICB9CgoKICAgIC8vL0BkZXYgcmV0dXJuIGN1cnJlbnQgc3RhdHVzIGFzIGEgY29kZSBvZiBhIHN1YnNjcmlwdGlvbiAob3IgYW4gb2ZmZXIpIHdpdGggZ2l2ZW4gaWQ7CiAgICBmdW5jdGlvbiBzdGF0ZUNvZGUodWludCBzdWJPck9mZmVySWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQgc3RhdGVDb2RlKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN1Yk9yT2ZmZXIgPSBzdWJzY3JpcHRpb25zW3N1Yk9yT2ZmZXJJZF07CiAgICAgICAgcmV0dXJuIF9pc09mZmVyKHN1Yk9yT2ZmZXIpCiAgICAgICAgICAgICAgPyB1aW50KF9vZmZlclN0YXRlKHN1Yk9yT2ZmZXIpKQogICAgICAgICAgICAgIDogdWludChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViT3JPZmZlcikpOwogICAgfQoKCiAgICBmdW5jdGlvbiBfb2ZmZXJTdGF0ZShTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMoT2ZmZXJTdGF0ZSBzdGF0dXMpIHsKICAgICAgICBpZiAoIV9pc09mZmVyKHN1YikpIHsKICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuTk9UX0VYSVNUOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLnN0YXJ0T24gPiBub3cpIHsKICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuQkVGT1JFX1NUQVJUOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgewogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5PTl9IT0xEOwogICAgICAgIH0gZWxzZSBpZiAobm93IDw9IHN1Yi5leHBpcmVPbikgewogICAgICAgICAgICByZXR1cm4gc3ViLmV4ZWNDb3VudGVyID4gMAogICAgICAgICAgICAgICAgPyBPZmZlclN0YXRlLkFDVElWRQogICAgICAgICAgICAgICAgOiBPZmZlclN0YXRlLlNPTERfT1VUOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLkVYUElSRUQ7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9zdWJzY3JpcHRpb25TdGF0ZShTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMoU3ViU3RhdGUgc3RhdHVzKSB7CiAgICAgICAgaWYgKCFfaXNTdWJzY3JpcHRpb24oc3ViKSkgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuTk9UX0VYSVNUOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLnN0YXJ0T24gPiBub3cpIHsKICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLkJFRk9SRV9TVEFSVDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLk9OX0hPTEQ7CiAgICAgICAgfSBlbHNlIGlmIChzdWIucGFpZFVudGlsID49IHN1Yi5leHBpcmVPbikgewogICAgICAgICAgICByZXR1cm4gbm93IDwgc3ViLmV4cGlyZU9uCiAgICAgICAgICAgICAgICA/IFN1YlN0YXRlLkNBTkNFTEVECiAgICAgICAgICAgICAgICA6IHN1Yi5kZXBvc2l0QW1vdW50ID4gMAogICAgICAgICAgICAgICAgICAgID8gU3ViU3RhdGUuRVhQSVJFRAogICAgICAgICAgICAgICAgICAgIDogU3ViU3RhdGUuRklOQUxJWkVEOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLnBhaWRVbnRpbCA8PSBub3cpIHsKICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLkNIQVJHRUFCTEU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFN1YlN0YXRlLlBBSUQ7CiAgICAgICAgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIGNyZWF0ZSBhIG5ldyBzdWJzY3JpcHRpb24gb2ZmZXIuCiAgICAvLy9AZGV2IG9ubHkgcmVnaXN0ZXJlZCBzZXJ2aWNlIHByb3ZpZGVyIGlzIGFsbG93ZWQgdG8gY3JlYXRlIG9mZmVycy4KICAgIC8vL0BkZXYgc3Vic2NyaXB0aW9uIHVzZXMgU0FOIHRva2VuIGZvciBwYXltZW50LCBidXQgYW4gZXhhY3QgYW1vdW50IHRvIGJlIHBhaWQgb3IgZGVwb3NpdCBpcyBjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUgZnJvbSBleHRlcm5hbCB4cmF0ZVByb3ZpZGVyIChwcmV2aW9zbHkgcmVnaXN0ZXJlZCBvbiBwbGF0Zm9ybSkuCiAgICAvLy8gICAgVGhpcyBhbGxvd3MgdG8gY3JlYXRlIGEgc3Vic2NyaXB0aW9uIGJvdW5kIHRvIGFub3RoZXIgdG9rZW4gb3IgZXZlbiBmaWF0IGN1cnJlbmN5LgogICAgLy8vQHBhcmFtIF9wcmljZVBlckhvdXIgLSBzdWJzY3JpcHRpb24gcHJpY2UgcGVyIGhvdXIgaW4gU0FOCiAgICAvLy9AcGFyYW0gX3hyYXRlUHJvdmlkZXJJZCAtIGlkIG9mIGV4dGVybmFsIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIgZnJvbSBzdWJzY3JpcHRpb24gY3VycmVuY3kgdG8gU0FOOyAiMCIgbWVhbnMgc3Vic2NyaXB0aW9uIGlzIHByaWNlZCBpbiBTQU4gbmF0aXZlbHkuCiAgICAvLy9AcGFyYW0gX2NoYXJnZVBlcmlvZCAtIHRpbWUgcGVyaW9kIHRvIGNoYXJnZTsgc3Vic2NyaXB0aW9uIGNhbid0IGJlIGNoYXJnZWQgbW9yZSBvZnRlbiB0aGFuIHRoaXMgcGVyaW9kLiBUaW1lIHVuaXRzIGFyZSBuYXRpdmUgZXRoZXJldW0gdGltZSwgcmV0dXJuaW5nIGJ5IGBub3dgLCBpLmUuIHNlY29uZHMuCiAgICAvLy9AcGFyYW0gX2V4cGlyZU9uIC0gb2ZmZXIgY2FuJ3QgYmUgYWNjZXB0ZWQgYWZ0ZXIgdGhpcyB0aW1lLgogICAgLy8vQHBhcmFtIF9vZmZlckxpbWl0IC0gaG93IG1hbnkgc3Vic2NyaXB0aW9uIGFyZSBhdmFpbGFibGUgdG8gY3JlYXRlZCBmcm9tIHRoaXMgb2ZmZXI7IHRoZXJlIGlzIG5vIG1hZ2ljIG51bWJlciBmb3IgdW5saW1pdGVkIG9mZmVyIC0tIHVzZSBiaWcgbnVtYmVyIGluc3RlYWQuCiAgICAvLy9AcGFyYW0gX2RlcG9zaXRBbW91bnQgLSB1cGZyb250IGRlcG9zaXQgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIGEgc3Vic2NyaXB0aW9uOyB0aGlzIGRlcG9zaXQgYmVjb21lcyBmdWxseSByZXR1cm5lZCBvbiBzdWJzY3JpcHRpb24gaXMgb3Zlci4KICAgIC8vLyAgICAgICBjdXJyZW50bHkgdGhpcyBkZXBvc2l0IGlzIG5vdCBzdWJqZWN0IG9mIHBsYXRmb3JtIGZlZXMgYW5kIHdpbGwgYmUgcmVmdW5kZWQgaW4gZnVsbC4gTmV4dCB2ZXJzaW9ucyBvZiB0aGlzIG1vZHVsZSBjYW4gdXNlIGRlcG9zaXQgaW4gY2FzZSBvZiBvdXRzdGFuZGluZyBwYXltZW50cy4KICAgIC8vL0BwYXJhbSBfc3RhcnRPbiAtIGEgc3Vic2NyaXB0aW9uIGZyb20gdGhpcyBvZmZlciBjYW4ndCBiZSBjcmVhdGVkIGJlZm9yZSB0aGlzIHRpbWUuIFRpbWUgdW5pdHMgYXJlIG5hdGl2ZSBldGhlcmV1bSB0aW1lLCByZXR1cm5pbmcgYnkgYG5vd2AsIGkuZS4gc2Vjb25kcy4KICAgIC8vL0BwYXJhbSBfZGVzY3JpcHRvciAtIGFyYml0cmFyeSBieXRlcyBhcyBhbiBvZmZlciBkZXNjcmlwdG9yLiBUaGlzIGRlc2NyaXB0b3IgaXMgY29waWVkIGludG8gc3Vic2NyaXB0aW9uIGFuZCB0aGVuIHNlcnZpY2UgcHJvdmlkZXIgYmVjb21lcyBpdCBwYXNzZWQgaW4gbm90aWZpY2F0aW9ucy4KICAgIC8vCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb25PZmZlcih1aW50IF9wcmljZVBlckhvdXIsIHVpbnQxNiBfeHJhdGVQcm92aWRlcklkLCB1aW50IF9jaGFyZ2VQZXJpb2QsIHVpbnQgX2V4cGlyZU9uLCB1aW50IF9vZmZlckxpbWl0LCB1aW50IF9kZXBvc2l0QW1vdW50LCB1aW50IF9zdGFydE9uLCBieXRlcyBfZGVzY3JpcHRvcikKICAgIHB1YmxpYwogICAgbm9SZWVudHJhbmN5KEwwMSkKICAgIG9ubHlSZWdpc3RlcmVkUHJvdmlkZXIKICAgIG5vdFN1c3BlbmRlZAogICAgcmV0dXJucyAodWludCBzdWJJZCkgewogICAgICAgIGFzc2VydCAoX3N0YXJ0T24gPCBfZXhwaXJlT24pOwogICAgICAgIGFzc2VydCAoX2NoYXJnZVBlcmlvZCA8PSAxMCB5ZWFycyk7IC8vc2FuaXR5IGNoZWNrCiAgICAgICAgdmFyIChfeHJhdGVfbiwgX3hyYXRlX2QpID0gX3hyYXRlUHJvdmlkZXJJZCA9PSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gKDEsMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBYUmF0ZVByb3ZpZGVyKHhyYXRlUHJvdmlkZXJzW194cmF0ZVByb3ZpZGVySWRdKS5nZXRSYXRlKCk7IC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgIGFzc2VydCAoX3hyYXRlX24gPiAwICYmIF94cmF0ZV9kID4gMCk7CiAgICAgICAgc3Vic2NyaXB0aW9uc1srK3N1YnNjcmlwdGlvbkNvdW50ZXJdID0gU3Vic2NyaXB0aW9uICh7CiAgICAgICAgICAgIHRyYW5zZmVyRnJvbSAgICA6IDAsICAgICAgICAgICAgICAgICAgLy8gZW1wdHkgdHJhbnNmZXJGcm9tIGZpZWxkIG1lYW5zIHdlIGhhdmUgYW4gb2ZmZXIsIG5vdCBhIHN1YnNjcmlwdGlvbgogICAgICAgICAgICB0cmFuc2ZlclRvICAgICAgOiBtc2cuc2VuZGVyLCAgICAgICAgIC8vIHNlcnZpY2UgcHJvdmlkZXIgaXMgYSBiZW5lZmljaWFyeSBvZiBzdWJzY3JpcHRvbiBwYXltZW50cwogICAgICAgICAgICBwcmljZVBlckhvdXIgICAgOiBfcHJpY2VQZXJIb3VyLCAgICAgIC8vIHByaWNlIHBlciBob3VyIGluIFNBTiAocmVjYWxjdWxhdGVkIGZyb20gYmFzZSBjdXJyZW5jeSBpZiBuZWVkZWQpCiAgICAgICAgICAgIHhyYXRlUHJvdmlkZXJJZCA6IF94cmF0ZVByb3ZpZGVySWQsICAgLy8gaWQgb2YgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVyIG9yIHplcm8gaWYgYW4gb2ZmZXIgaXMgbm9taW5hdGVkIGluIFNBTi4KICAgICAgICAgICAgaW5pdGlhbFhyYXRlX24gIDogX3hyYXRlX24sICAgICAgICAgICAvLyBmcmFjdGlvbiBub21pbmF0b3Igb2YgdGhlIGluaXRpYWwgZXhjaGFuZ2UgcmF0ZQogICAgICAgICAgICBpbml0aWFsWHJhdGVfZCAgOiBfeHJhdGVfZCwgICAgICAgICAgIC8vIGZyYWN0aW9uIGRlbm9taW5hdG9yIG9mIHRoZSBpbml0aWFsIGV4Y2hhbmdlIHJhdGUKICAgICAgICAgICAgcGFpZFVudGlsICAgICAgIDogMCwgICAgICAgICAgICAgICAgICAvLyBzZXJ2aWNlIGlzIGNvbnNpZGVyZWQgdG8gYmUgcGFpZCB1bnRpbCB0aGlzIHRpbWU7IG5vIGNoYXJnZSBpcyBwb3NzaWJsZSB3aGlsZSBzdWJzY3JpcHRpb24gaXMgcGFpZCBmb3Igbm93LgogICAgICAgICAgICBjaGFyZ2VQZXJpb2QgICAgOiBfY2hhcmdlUGVyaW9kLCAgICAgIC8vIHBlcmlvZCBpbiBzZWNvbmRzIChldGhlcmV1bSBibG9jayB0aW1lIHVuaXQpIHRvIGNoYXJnZS4KICAgICAgICAgICAgZGVwb3NpdEFtb3VudCAgIDogX2RlcG9zaXRBbW91bnQsICAgICAvLyBkZXBvc2l0IHJlcXVpcmVkIGZvciBzdWJzY3JpcHRpb24gYWNjZXB0LgogICAgICAgICAgICBzdGFydE9uICAgICAgICAgOiBfc3RhcnRPbiwKICAgICAgICAgICAgZXhwaXJlT24gICAgICAgIDogX2V4cGlyZU9uLAogICAgICAgICAgICBleGVjQ291bnRlciAgICAgOiBfb2ZmZXJMaW1pdCwKICAgICAgICAgICAgZGVzY3JpcHRvciAgICAgIDogX2Rlc2NyaXB0b3IsCiAgICAgICAgICAgIG9uSG9sZFNpbmNlICAgICA6IDAgICAgICAgICAgICAgICAgICAgLy8gb2ZmZXIgaXMgbm90IG9uIGhvbGQgYnkgZGVmYXVsdC4KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uQ291bnRlcjsgICAgICAgICAgICAgICAvLyByZXR1cm5zIGFuIGlkIG9mIHRoZSBuZXcgb2ZmZXIuCiAgICB9CgoKICAgIC8vL0Bub3RpY2UgdXBkYXRlcyBjdXJyZW50bHkgYXZhaWxhYmxlIG51bWJlciBvZiBzdWJzY3JpcHRpb24gZm9yIHRoaXMgb2ZmZXIuCiAgICAvLy8gICAgICAgIE90aGVyIG9mZmVyJ3MgcGFyYW1ldGVyIGNhbid0IGJlIHVwZGF0ZWQgYmVjYXVzZSB0aGV5IGFyZSBjb25zaWRlcmVkIHRvIGJlIGEgcHVibGljIG9mZmVyIHJldmlld2VkIGJ5IGN1c3RvbWVycy4KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgc2hvdWxkIHJlY3JlYXRlIHRoZSBvZmZlciBhcyBhIG5ldyBvbmUgaW4gY2FzZSBvZiBvdGhlciBjaGFuZ2VzLgogICAgLy8KICAgIGZ1bmN0aW9uIHVwZGF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX29mZmVySWQsIHVpbnQgX29mZmVyTGltaXQpIHB1YmxpYyBub3RTdXNwZW5kZWQgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tfb2ZmZXJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOwogICAgICAgIGFzc2VydCAob2ZmZXIudHJhbnNmZXJUbyA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IFByb3ZpZGVyIGlzIGFsbG93ZWQgdG8gdXBkYXRlIHRoZSBvZmZlci4KICAgICAgICBvZmZlci5leGVjQ291bnRlciA9IF9vZmZlckxpbWl0OwogICAgfQoKCiAgICAvLy9Abm90aWNlIGFjY2VwdCBnaXZlbiBvZmZlciBhbmQgY3JlYXRlIGEgbmV3IHN1YnNjcmlwdGlvbiBvbiB0aGUgYmFzZSBvZiBpdC4KICAgIC8vLwogICAgLy8vQGRldiB0aGUgc2VydmljZSBwcm92aWRlciAob2ZmZXIuYHRyYW5zZmVyVG9gKSBiZWNvbWVzIG5vdGlmaWVkIGFib3V0IG5ldyBzdWJzY3JpcHRpb24gYnkgY2FsbCBgb25TdWJOZXcobmV3U3ViSWQsIF9vZmZlcklkKWAuCiAgICAvLy8gICAgIEl0IGlzIHByb3ZpZGVyJ3MgcmVzcG9uc2liaWxpdHkgdG8gcmV0cmlldmUgYW5kIHN0b3JlIGFueSBuZWNlc3NhcnkgaW5mb3JtYXRpb24gYWJvdXQgb2ZmZXIgYW5kIHRoaXMgbmV3IHN1YnNjcmlwdGlvbi4gU29tZSBvZiBpbmZvIGlzIG9ubHkgYXZhaWxhYmxlIGF0IHRoaXMgcG9pbnQuCiAgICAvLy8gICAgIFRoZSBTZXJ2aWNlIFByb3ZpZGVyIGNhbiBhbHNvIHJlamVjdCB0aGUgbmV3IHN1YnNjcmlwdGlvbiBieSB0aHJvd2luZyBhbiBleGNlcHRpb24gb3IgcmV0dXJuaW5nIGBmYWxzZWAgZnJvbSBgb25TdWJOZXcobmV3U3ViSWQsIF9vZmZlcklkKWAgZXZlbnQgaGFuZGxlci4KICAgIC8vL0BwYXJhbSBfb2ZmZXJJZCAgIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIGFjY2VwdGVkCiAgICAvLy9AcGFyYW0gX2V4cGlyZU9uICAtIHN1YnNjcmlwdGlvbiBleHBpcmF0aW9uIHRpbWU7IG5vIGNoYXJnZXMgYXJlIHBvc3NpYmxlIGJlaGluZCB0aGlzIHRpbWUuCiAgICAvLy9AcGFyYW0gX3N0YXJ0T24gICAtIHN1YnNjcmlwdGlvbiBzdGFydCB0aW1lOyBubyBjaGFyZ2VzIGFyZSBwb3NzaWJsZSBiZWZvcmUgdGhpcyB0aW1lLgogICAgLy8vICAgICAgICAgICAgICAgICAgICBJZiB0aGUgYF9zdGFydE9uYCBpcyBpbiB0aGUgcGFzdCBvciBpcyB6ZXJvLCBpdCBtZWFucyBzdGFydCB0aGUgc3Vic2NyaXB0aW9uIEFTQVAuCiAgICAvLwogICAgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uKHVpbnQgX29mZmVySWQsIHVpbnQgX2V4cGlyZU9uLCB1aW50IF9zdGFydE9uKSBwdWJsaWMgbm90U3VzcGVuZGVkIG5vUmVlbnRyYW5jeShMMDIpIHJldHVybnMgKHVpbnQgbmV3U3ViSWQpIHsKICAgICAgICBhc3NlcnQgKF9zdGFydE9uIDwgX2V4cGlyZU9uKTsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbX29mZmVySWRdOwogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsKICAgICAgICBhc3NlcnQgKG9mZmVyLnN0YXJ0T24gPT0gMCAgICAgfHwgb2ZmZXIuc3RhcnRPbiAgPD0gbm93KTsKICAgICAgICBhc3NlcnQgKG9mZmVyLmV4cGlyZU9uID09IDAgICAgfHwgb2ZmZXIuZXhwaXJlT24gPj0gbm93KTsKICAgICAgICBhc3NlcnQgKG9mZmVyLm9uSG9sZFNpbmNlID09IDApOwogICAgICAgIGFzc2VydCAob2ZmZXIuZXhlY0NvdW50ZXIgPiAwKTsKICAgICAgICAtLW9mZmVyLmV4ZWNDb3VudGVyOwogICAgICAgIG5ld1N1YklkID0gKytzdWJzY3JpcHRpb25Db3VudGVyOwogICAgICAgIC8vY3JlYXRlIGEgY2xvbmUgb2YgdGhlIG9mZmVyLi4uCiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2UgbmV3U3ViID0gc3Vic2NyaXB0aW9uc1tuZXdTdWJJZF0gPSBvZmZlcjsKICAgICAgICAvLy4uLiBhbmQgYWRqdXN0IHNvbWUgZmllbGRzIHNwZWNpZmljIHRvIHN1YnNjcmlwdGlvbgogICAgICAgIG5ld1N1Yi50cmFuc2ZlckZyb20gPSBtc2cuc2VuZGVyOwogICAgICAgIG5ld1N1Yi5leGVjQ291bnRlciA9IDA7CiAgICAgICAgbmV3U3ViLnBhaWRVbnRpbCA9IG5ld1N1Yi5zdGFydE9uID0gbWF4KF9zdGFydE9uLCBub3cpOyAgICAgLy9ubyBkZWJ0cyBiZWZvcmUgYWN0dWFsIGNyZWF0aW9uIHRpbWUhCiAgICAgICAgbmV3U3ViLmV4cGlyZU9uID0gX2V4cGlyZU9uOwogICAgICAgIG5ld1N1Yi5kZXBvc2l0QW1vdW50ID0gX2FwcGx5WGNoYW5nZVJhdGUobmV3U3ViLmRlcG9zaXRBbW91bnQsIG5ld1N1Yik7ICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAvL2RlcG9zaXRBbW91bnQgaXMgbm93IHN0b3JlZCBpbiB0aGUgc3ViLCBzbyBidXJuIHRoZSBzYW1lIGFtb3VudCBmcm9tIGN1c3RvbWVyJ3MgYWNjb3VudC4KICAgICAgICBhc3NlcnQgKHNhbi5fYnVybkZvckRlcG9zaXQobXNnLnNlbmRlciwgbmV3U3ViLmRlcG9zaXRBbW91bnQpKTsKICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihuZXdTdWIudHJhbnNmZXJUbykub25TdWJOZXcobmV3U3ViSWQsIF9vZmZlcklkKSk7ICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5OyBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBzdGlsbCByZWplY3QgdGhlIG5ldyBzdWJzY3JpcHRpb24gaGVyZQoKICAgICAgICBOZXdTdWJzY3JpcHRpb24obmV3U3ViLnRyYW5zZmVyRnJvbSwgbmV3U3ViLnRyYW5zZmVyVG8sIF9vZmZlcklkLCBuZXdTdWJJZCk7CiAgICAgICAgcmV0dXJuIG5ld1N1YklkOwogICAgfQoKCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBvZmZlciBnaXZlbiBieSBgb2ZmZXJJZGAuCiAgICAvLy9AZGV2IHNldHMgb2ZmZXIuYGV4cGlyZU9uYCB0byBgZXhwaXJlT25gLgogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOwogICAgICAgIGFzc2VydCAob2ZmZXIudHJhbnNmZXJUbyA9PSBtc2cuc2VuZGVyIHx8IG93bmVyID09IG1zZy5zZW5kZXIpOyAvL29ubHkgc2VydmljZSBwcm92aWRlciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIGNhbmNlbCB0aGUgb2ZmZXIKICAgICAgICBpZiAob2ZmZXIuZXhwaXJlT24+bm93KXsKICAgICAgICAgICAgb2ZmZXIuZXhwaXJlT24gPSBub3c7CiAgICAgICAgICAgIE9mZmVyQ2FuY2VsZWQob2ZmZXJJZCwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBjYW5jZWwgYW4gc3Vic2NyaXB0aW9uIGdpdmVuIGJ5IGBzdWJJZGAgKGEgZ3JhY2VmdWwgdmVyc2lvbikuCiAgICAvLy9Abm90aWNlIElNUE9SVEFOVDogYSBtYWxpY2lvdXMgc2VydmljZSBwcm92aWRlciBjYW4gY29uc3VtZSBhbGwgZ2FzIGFuZCBwcmV2ZW50aW5nIHN1YnNjcmlwdGlvbiBmcm9tIGNhbmNlbGxhdGlvbi4KICAgIC8vLyAgICAgICAgSWYgc28sIHVzZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGFzIHRoZSBmb3JjZWQgdmVyc2lvbi4KICAgIC8vLyAgICAgICAgIHNlZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGZvciBtb3JlIGRvY3VtZW50YXRpb24uCiAgICAvLwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgewogICAgICAgIHJldHVybiBjYW5jZWxTdWJzY3JpcHRpb24oc3ViSWQsIDApOwogICAgfQoKCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBzdWJzY3JpcHRpb24gZ2l2ZW4gYnkgYHN1YklkYCAoYSBmb3JjZWQgdmVyc2lvbikuCiAgICAvLy8gICAgICAgIENhbmNlbGxhdGlvbiBtZWFucyBubyBmdXJ0aGVyIGNoYXJnZXMgdG8gdGhpcyBzdWJzY3JpcHRpb24gYXJlIHBvc3NpYmxlLiBUaGUgcHJvdmlkZWQgc3Vic2NyaXB0aW9uIGRlcG9zaXQgY2FuIGJlIHdpdGhkcmF3biBvbmx5IGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyLgogICAgLy8vICAgICAgICBEZXBlbmRpbmcgb24gbmF0dXJlIG9mIHRoZSBzZXJ2aWNlIHByb3ZpZGVkLCB0aGUgc2VydmljZSBwcm92aWRlciBjYW4gYWxsb3cgYW4gaW1tZWRpYXRlIGRlcG9zaXQgd2l0aGRyYXdhbCBieSBgcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQodWludCBzdWJJZClgIGNhbGwsIGJ1dCBpdHMgb24gaGlzIG93bi4KICAgIC8vLyAgICAgICAgSW4gc29tZSBidXNpbmVzcyBjYXNlcyBhIGRlcG9zaXQgbXVzdCByZW1haW4gbG9ja2VkIHVudGlsIGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyIGV2ZW4sIHRoZSBzdWJzY3JpcHRpb24gaXMgYWxyZWFkeSBjYW5jZWxlZC4KICAgIC8vL0Bub3RpY2UgZ2FzUmVzZXJ2ZSBpcyBhIGdhcyBhbW91bnQgcmVzZXJ2ZWQgZm9yIGNvbnRyYWN0IGV4ZWN1dGlvbiBBRlRFUiBzZXJ2aWNlIHByb3ZpZGVyIGJlY29tZXMgYG9uU3ViQ2FuY2VsZWQodWludDI1NixhZGRyZXNzKWAgbm90aWZpY2F0aW9uLgogICAgLy8vICAgICAgICBJdCBndWFyYW50ZWVzLCB0aGF0IGNhbmNlbGxhdGlvbiBiZWNvbWVzIGV4ZWN1dGVkIGV2ZW4gYSAobWFsaWNpb3VzKSBzZXJ2aWNlIHByb3ZpZGVyIGNvbnN1bWVzIGFsbCBnYXMgcHJvdmlkZWQuCiAgICAvLy8gICAgICAgIElmIHNvLCB1c2UgYGNhbmNlbFN1YnNjcmlwdGlvbih1aW50IHN1YklkLCB1aW50IGdhc1Jlc2VydmUpYCBhcyB0aGUgZm9yY2VkIHZlcnNpb24uCiAgICAvLy8gICAgICAgIFRoaXMgZGlmZmVyZW5jZSBpcyBiZWNhdXNlIHRoZSBjdXN0b21lciBtdXN0IGFsd2F5cyBoYXZlIGEgcG9zc2liaWxpdHkgdG8gY2FuY2VsIGhpcyBjb250cmFjdCBldmVuIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGRpc2FncmVlIG9uIGNhbmNlbGxhdGlvbi4KICAgIC8vL0BwYXJhbSBzdWJJZCAtIHN1YnNjcmlwdGlvbiB0byBiZSBjYW5jZWxsZWQKICAgIC8vL0BwYXJhbSBnYXNSZXNlcnZlIC0gZ2FzIHJlc2VydmVkIGZvciBjYWxsIGZpbmFsaXphdGlvbiAobWluaW11bSByZXNlcnZhdGlvbiBpcyAxMDAwMCBnYXMpCiAgICAvLwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSkgcHVibGljIG5vdFN1c3BlbmRlZCBub1JlZW50cmFuY3koTDAzKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJGcm9tID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzdWJzY3JpcHRpb24gb3duZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byBjYW5jZWwgaXQKICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsKICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87CiAgICAgICAgc3ViLmV4cGlyZU9uID0gbWF4KG5vdywgc3ViLnBhaWRVbnRpbCk7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gX3RvKSB7CiAgICAgICAgICAgIC8vc3VwcmVzcyByZS10aHJvd2luZyBvZiBleGNlcHRpb25zOyByZXNlcnZlIGVub3VnaCBnYXMgdG8gZmluaXNoIHRoaXMgZnVuY3Rpb24KICAgICAgICAgICAgZ2FzUmVzZXJ2ZSA9IG1heChnYXNSZXNlcnZlLDEwMDAwKTsgIC8vcmVzZXJ2ZSBtaW5pbXVtIDEwMDAwIGdhcwogICAgICAgICAgICBhc3NlcnQgKG1zZy5nYXMgPiBnYXNSZXNlcnZlKTsgICAgICAgLy9zYW5pdHkgY2hlY2sKICAgICAgICAgICAgaWYgKF90by5jYWxsLmdhcyhtc2cuZ2FzLWdhc1Jlc2VydmUpKGJ5dGVzNChzaGEzKCJvblN1YkNhbmNlbGVkKHVpbnQyNTYsYWRkcmVzcykiKSksIHN1YklkLCBtc2cuc2VuZGVyKSkgeyAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgICAgICAvL2RvIG5vdGhpbmcuIGl0IGlzIG5vdGlmaWNhdGlvbiBvbmx5LgogICAgICAgICAgICAgICAgLy9MYXRlcjogaXMgaXQgcG9zc2libGUgdG8gZXZhbHVhdGUgcmV0dXJuIHZhbHVlIGhlcmU/IElmIGlzIGJldHRlciB0byByZXR1cm4gdGhlIHN1YnNjcmlwdGlvbiBkZXBvc2l0IGhlcmUuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgU3ViQ2FuY2VsZWQoc3ViSWQsIG1zZy5zZW5kZXIpOwogICAgfQoKCiAgICAvLy9Abm90aWNlIHBsYWNlIGFuIGFjdGl2ZSBvZmZlciBvbiBob2xkOyBpdCBtZWFucyBubyBzdWJzY3JpcHRpb25zIGNhbiBiZSBjcmVhdGVkIGZyb20gdGhpcyBvZmZlci4KICAgIC8vLyAgICAgICAgT25seSBzZXJ2aWNlIHByb3ZpZGVyIChvciBwbGF0Zm9ybSBvd25lcikgaXMgYWxsb3dlZCB0byBob2xkL3VuaG9sZCBhIHN1YnNjcmlwdGlvbiBvZmZlci4KICAgIC8vL0BwYXJhbSBvZmZlcklkIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIHBsYWNlZCBvbiBob2xkLgogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOwogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb2ZmZXIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsgLy9vbmx5IG93bmVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBvZmZlciBvbiBob2xkLgogICAgICAgIGlmIChvZmZlci5vbkhvbGRTaW5jZSA9PSAwKSB7CiAgICAgICAgICAgIG9mZmVyLm9uSG9sZFNpbmNlID0gbm93OwogICAgICAgICAgICBPZmZlck9uSG9sZChvZmZlcklkLCB0cnVlLCBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIHJlc3VtZSBvbi1ob2xkIG9mZmVyOyBzdWJzY3JpcHRpb25zIGNhbiBiZSBjcmVhdGVkIGZyb20gdGhpcyBvZmZlciBhZ2FpbiAoaWYgb3RoZXIgY29uZGl0aW9ucyBhcmUgbWV0KS4KICAgIC8vLyAgICAgICAgT25seSBzZXJ2aWNlIHByb3ZpZGVyIChvciBwbGF0Zm9ybSBvd25lcikgaXMgYWxsb3dlZCB0byBob2xkL3VuaG9sZCBhIHN1YnNjcmlwdGlvbiBvZmZlci4KICAgIC8vL0BwYXJhbSBvZmZlcklkIC0gaWQgb2YgdGhlIG9mZmVyIHRvIGJlIHJlc3VtZWQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW29mZmVySWRdOwogICAgICAgIGFzc2VydCAoX2lzT2ZmZXIob2ZmZXIpKTsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IG9mZmVyLnRyYW5zZmVyVG8gfHwgbXNnLnNlbmRlciA9PSBvd25lcik7IC8vb25seSBvd25lciBvciBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWFjdGl2YXRlIHRoZSBvZmZlci4KICAgICAgICBpZiAob2ZmZXIub25Ib2xkU2luY2UgPiAwKSB7CiAgICAgICAgICAgIG9mZmVyLm9uSG9sZFNpbmNlID0gMDsKICAgICAgICAgICAgT2ZmZXJPbkhvbGQob2ZmZXJJZCwgZmFsc2UsIG1zZy5zZW5kZXIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY2FsbGVkIGJ5IGN1c3RvbWVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgdG8gcGxhY2UgYSBzdWJzY3JpcHRpb24gb24gaG9sZC4KICAgIC8vLyAgICAgICAgSWYgY2FsbCBpcyBvcmlnaW5hdGVkIGJ5IGN1c3RvbWVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiByZWplY3QgdGhlIHJlcXVlc3QuCiAgICAvLy8gICAgICAgIEEgc3Vic2NyaXB0aW9uIG9uIGhvbGQgd2lsbCBub3QgYmUgY2hhcmdlZC4gVGhlIHNlcnZpY2UgaXMgdXN1YWxseSBub3QgcHJvdmlkZWQgYXMgd2VsbC4KICAgIC8vLyAgICAgICAgRHVyaW5nIGhvbGQgdGltZSBhIHN1YnNjcmlwdGlvbiBwcmVzZXJ2ZSByZW1haW5pbmcgcGFpZCB0aW1lIHBlcmlvZCwgd2hpY2ggYmVjb21lcyBhdmFpbGFibGUgYWZ0ZXIgdW5ob2xkLgogICAgLy8vQHJldHVybiBgdHJ1ZWAgb24gc3VjY2VzczsgYGZhbHNlYCBvZiBmYWlsdXJlIChpZiBjYWxsZXIgaXMgYSBjb250cmFjdCkgb3IgdGhyb3cgYW4gZXhjZXB0aW9uIChpZiBjYWxsZXIgaXMgbm90IGEgY29udHJhY3QpCiAgICAvLwogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIG5vUmVlbnRyYW5jeShMMDQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOwogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IF90byB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20pOyAvL29ubHkgY3VzdG9tZXIgb3IgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBzdWJzY3JpcHRpb24gb24gaG9sZC4KICAgICAgICBpZiAoc3ViLm9uSG9sZFNpbmNlID09IDApIHsKICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViVW5Ib2xkKHN1YklkLCBtc2cuc2VuZGVyLCB0cnVlKSkgeyAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAgICAgICAgIHN1Yi5vbkhvbGRTaW5jZSA9IG5vdzsKICAgICAgICAgICAgICAgIFN1Yk9uSG9sZChzdWJJZCwgdHJ1ZSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb3Igc2VydmljZSBwcm92aWRlciB0byB1bmhvbGQgc3Vic2NyaXB0aW9uLgogICAgLy8vICAgICAgICBJZiBjYWxsIGlzIG9yaWdpbmF0ZWQgYnkgY3VzdG9tZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlamVjdCB0aGUgcmVxdWVzdC4KICAgIC8vLyAgICAgICAgQSBzdWJzY3JpcHRpb24gb24gaG9sZCB3aWxsIG5vdCBiZSBjaGFyZ2VkLiBUaGUgc2VydmljZSBpcyB1c3VhbGx5IG5vdCBwcm92aWRlZCBhcyB3ZWxsLgogICAgLy8vICAgICAgICBEdXJpbmcgaG9sZCB0aW1lIGEgc3Vic2NyaXB0aW9uIHByZXNlcnZlIHJlbWFpbmluZyBwYWlkIHRpbWUgcGVyaW9kLCB3aGljaCBiZWNvbWVzIGF2YWlsYWJsZSBhZnRlciB1bmhvbGQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCBub1JlZW50cmFuY3koTDA1KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsKICAgICAgICB2YXIgX3RvID0gc3ViLnRyYW5zZmVyVG87CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBfdG8gfHwgbXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJGcm9tKTsgLy9vbmx5IGN1c3RvbWVyIG9yIHByb3ZpZGVyIGNhbiBwbGFjZSB0aGUgc3Vic2NyaXB0aW9uIG9uIGhvbGQuCiAgICAgICAgaWYgKHN1Yi5vbkhvbGRTaW5jZSA+IDApIHsKICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViVW5Ib2xkKHN1YklkLCBtc2cuc2VuZGVyLCBmYWxzZSkpIHsgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAgICAgICAgIHN1Yi5wYWlkVW50aWwgKz0gbm93IC0gc3ViLm9uSG9sZFNpbmNlOwogICAgICAgICAgICAgICAgc3ViLm9uSG9sZFNpbmNlID0gMDsKICAgICAgICAgICAgICAgIFN1Yk9uSG9sZChzdWJJZCwgZmFsc2UsIG1zZy5zZW5kZXIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgICAgICBkZXBvc2l0IGhhbmRsaW5nICAgICAgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy8vQG5vdGljZSBjYW4gYmUgY2FsbGVkIGJ5IHByb3ZpZGVyIG9uIENBTkNFTEVEIHN1YnNjcmlwdGlvbiB0byByZXR1cm4gYSBzdWJzY3JpcHRpb24gZGVwb3NpdCB0byBjdXN0b21lciBpbW1lZGlhdGVseS4KICAgIC8vLyAgICAgICAgQ3VzdG9tZXIgY2FuIGFueXdheSBjb2xsZWN0IGhpcyBkZXBvc2l0IGFmdGVyIGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyLgogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIGhvbGRpbmcgdGhlIGRlcG9zaXQKICAgIC8vCiAgICBmdW5jdGlvbiByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpID09IFN1YlN0YXRlLkNBTkNFTEVEKTsKICAgICAgICBhc3NlcnQgKHN1Yi5kZXBvc2l0QW1vdW50ID4gMCk7IC8vc2FuaXR5IGNoZWNrCiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJUbyA9PSBtc2cuc2VuZGVyIHx8IG93bmVyID09IG1zZy5zZW5kZXIpOyAvL29ubHkgc3Vic2NyaXB0aW9uIG93bmVyIG9yIHBsYXRmb3JtIG93bmVyIGlzIGFsbG93ZWQgdG8gcmVsZWFzZSBkZXBvc2l0LgogICAgICAgIHN1Yi5leHBpcmVPbiA9IG5vdzsKICAgICAgICBfcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQoc3ViSWQsIHN1Yik7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY2FsbGVkIGJ5IGN1c3RvbWVyIG9uIEVYUElSRUQgc3Vic2NyaXB0aW9uIChgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3ZlcikgdG8gY29sbGVjdCBhIHN1YnNjcmlwdGlvbiBkZXBvc2l0LgogICAgLy8vICAgICAgICBDdXN0b21lciBjYW4gYW55d2F5IGNvbGxlY3QgaGlzIGRlcG9zaXQgYWZ0ZXIgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIuCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gaG9sZGluZyB0aGUgZGVwb3NpdAogICAgLy8KICAgIGZ1bmN0aW9uIGNsYWltU3Vic2NyaXB0aW9uRGVwb3NpdCh1aW50IHN1YklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKF9zdWJzY3JpcHRpb25TdGF0ZShzdWIpID09IFN1YlN0YXRlLkVYUElSRUQpOwogICAgICAgIGFzc2VydCAoc3ViLnRyYW5zZmVyRnJvbSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBhc3NlcnQgKHN1Yi5kZXBvc2l0QW1vdW50ID4gMCk7CiAgICAgICAgX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHN1YklkLCBzdWIpOwogICAgfQoKCiAgICAvL0BkZXYgcmV0dXJucyBzdWJzY3JpcHRpb24gZGVwb3NpdCB0byBjdXN0b21lcgogICAgZnVuY3Rpb24gX3JldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQsIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgewogICAgICAgIHVpbnQgZGVwb3NpdEFtb3VudCA9IHN1Yi5kZXBvc2l0QW1vdW50OwogICAgICAgIHN1Yi5kZXBvc2l0QW1vdW50ID0gMDsKICAgICAgICBzYW4uX21pbnRGcm9tRGVwb3NpdChzdWIudHJhbnNmZXJGcm9tLCBkZXBvc2l0QW1vdW50KTsKICAgICAgICBTdWJzY3JpcHRpb25EZXBvc2l0UmV0dXJuZWQoc3ViSWQsIGRlcG9zaXRBbW91bnQsIHN1Yi50cmFuc2ZlckZyb20sIG1zZy5zZW5kZXIpOwogICAgfQoKCiAgICAvLy9Abm90aWNlIGNyZWF0ZSBzaW1wbGUgdW5sb2NrZWQgZGVwb3NpdCwgcmVxdWlyZWQgYnkgc29tZSBzZXJ2aWNlcy4gSXQgY2FuIGJlIGNvbnNpZGVyZWQgYXMgcHJvdmUgb2YgY3VzdG9tZXIncyBzdGFrZS4KICAgIC8vLyAgICAgICAgVGhpcyBkZXNwb3NpdCBjYW4gYmUgY2xhaW1lZCBiYWNrIGJ5IHRoZSBjdXN0b21lciBhdCBhbnl0aW1lLgogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBpcyByZXNwb25zaWJsZSB0byBjaGVjayB0aGUgZGVwb3NpdCBiZWZvcmUgcHJvdmlkaW5nIHRoZSBzZXJ2aWNlLgogICAgLy8vQHBhcmFtIF92YWx1ZSAtIG5vbiB6ZXJvIGRlcG9zaXQgYW1vdW50LgogICAgLy8vQHBhcmFtIF9kZXNjcmlwdG9yIC0gaXMgYSB1bmlxIGtleSwgdXN1YWxseSBnaXZlbiBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIHRoZSBjdXN0b21lciBpbiBvcmRlciB0byBtYWtlIHRoaXMgZGVwb3NpdCB1bmlxdWUuCiAgICAvLy8gICAgICAgIFNlcnZpY2UgUHJvdmlkZXIgc2hvdWxkIHJlamVjdCBkZXBvc2l0IHdpdGggdW5rbm93biBkZXNjcmlwdG9yLCBiZWNhdXNlIG1vc3QgcHJvYmFibHkgaXQgaXMgaW4gdXNlIGZvciBzb21lIGFub3RoZXIgc2VydmljZS4KICAgIC8vL0ByZXR1cm4gZGVwb3NpdElkIC0gYSBoYW5kbGUgdG8gY2xhaW0gYmFjayB0aGUgZGVwb3NpdCBsYXRlci4KICAgIC8vCiAgICBmdW5jdGlvbiBjcmVhdGVEZXBvc2l0KHVpbnQgX3ZhbHVlLCB1aW50IF9sb2NrVGltZSwgYnl0ZXMgX2Rlc2NyaXB0b3IpIHB1YmxpYyBub3RTdXNwZW5kZWQgcmV0dXJucyAodWludCBkZXBvc2l0SWQpIHsKICAgICAgICByZXF1aXJlIChfdmFsdWUgPiAwKTsKICAgICAgICBhc3NlcnQgKHNhbi5fYnVybkZvckRlcG9zaXQobXNnLnNlbmRlcixfdmFsdWUpKTsKICAgICAgICBkZXBvc2l0c1srK2RlcG9zaXRDb3VudGVyXSA9IERlcG9zaXQgKHsKICAgICAgICAgICAgb3duZXIgOiBtc2cuc2VuZGVyLAogICAgICAgICAgICB2YWx1ZSA6IF92YWx1ZSwKICAgICAgICAgICAgY3JlYXRlZE9uIDogbm93LAogICAgICAgICAgICBsb2NrVGltZSA6IF9sb2NrVGltZSwKICAgICAgICAgICAgZGVzY3JpcHRvciA6IF9kZXNjcmlwdG9yCiAgICAgICAgfSk7CiAgICAgICAgTmV3RGVwb3NpdChkZXBvc2l0Q291bnRlciwgX3ZhbHVlLCBfbG9ja1RpbWUsIG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBkZXBvc2l0Q291bnRlcjsKICAgIH0KCgogICAgLy8vQG5vdGljZSByZXR1cm4gcHJldmlvdXNseSBjcmVhdGVkIGRlcG9zaXQgdG8gdGhlIHVzZXIuIFVzZXIgY2FuIGNvbGxlY3Qgb25seSBvd24gZGVwb3NpdC4KICAgIC8vLyAgICAgICAgVGhlIHNlcnZpY2UgcHJvdmlkZXIgaXMgcmVzcG9uc2libGUgdG8gY2hlY2sgdGhlIGRlcG9zaXQgYmVmb3JlIHByb3ZpZGluZyB0aGUgc2VydmljZS4KICAgIC8vL0BwYXJhbSBfZGVwb3NpdElkIC0gYW4gaWQgb2YgdGhlIGRlcG9zaXQgdG8gYmUgY29sbGVjdGVkLgogICAgLy8KICAgIGZ1bmN0aW9uIGNsYWltRGVwb3NpdCh1aW50IF9kZXBvc2l0SWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgewogICAgICAgIHZhciBkZXBvc2l0ID0gZGVwb3NpdHNbX2RlcG9zaXRJZF07CiAgICAgICAgcmVxdWlyZSAoZGVwb3NpdC5vd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBhc3NlcnQgKGRlcG9zaXQubG9ja1RpbWUgPT0gMCB8fCBkZXBvc2l0LmNyZWF0ZWRPbiArICBkZXBvc2l0LmxvY2tUaW1lIDwgbm93KTsKICAgICAgICB2YXIgdmFsdWUgPSBkZXBvc2l0c1tfZGVwb3NpdElkXS52YWx1ZTsKICAgICAgICBkZWxldGUgZGVwb3NpdHNbX2RlcG9zaXRJZF07CiAgICAgICAgc2FuLl9taW50RnJvbURlcG9zaXQobXNnLnNlbmRlciwgdmFsdWUpOwogICAgICAgIERlcG9zaXRSZXR1cm5lZChfZGVwb3NpdElkLCBtc2cuc2VuZGVyKTsKICAgIH0KCgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgICBzb21lIGludGVybmFsIGZ1bmN0aW9ucyAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICBmdW5jdGlvbiBfYW1vdW50VG9DaGFyZ2UoU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCByZWVudHJhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfYXBwbHlYY2hhbmdlUmF0ZShzdWIucHJpY2VQZXJIb3VyICogc3ViLmNoYXJnZVBlcmlvZCwgc3ViKSAvIDEgaG91cnM7ICAgICAgIC8vIDw9PT09IHJlZW50cmFudCBmdW5jdGlvbiB1c2FnZQogICAgfQoKICAgIGZ1bmN0aW9uIF9hcHBseVhjaGFuZ2VSYXRlKHVpbnQgYW1vdW50LCBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIHJlZW50cmFudCByZXR1cm5zICh1aW50KSB7ICAvLyA8PT0gYWN0dWFsbHkgY2FsbGVkIGZyb20gcmVlbnRyYW5jeSBndWFyZGVkIGNvbnRleHQgb25seSAoaS5lLiBleHRlcm5hbGx5IHNlY3VyZWQpCiAgICAgICAgaWYgKHN1Yi54cmF0ZVByb3ZpZGVySWQgPiAwKSB7CiAgICAgICAgICAgIC8vIHhyYXRlX246IG5vbWluYXRvcgogICAgICAgICAgICAvLyB4cmF0ZV9kOiBkZW5vbWluYXRvciBvZiB0aGUgZXhjaGFuZ2UgcmF0ZSBmcmFjdGlvbi4KICAgICAgICAgICAgdmFyICh4cmF0ZV9uLCB4cmF0ZV9kKSA9IFhSYXRlUHJvdmlkZXIoeHJhdGVQcm92aWRlcnNbc3ViLnhyYXRlUHJvdmlkZXJJZF0pLmdldFJhdGUoKTsgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgICAgICBhbW91bnQgPSBhbW91bnQgKiBzdWIuaW5pdGlhbFhyYXRlX24gKiB4cmF0ZV9kIC8gc3ViLmluaXRpYWxYcmF0ZV9kIC8geHJhdGVfbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICBmdW5jdGlvbiBfaXNPZmZlcihTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpewogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJGcm9tID09IDAgJiYgc3ViLnRyYW5zZmVyVG8gIT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBfaXNTdWJzY3JpcHRpb24oU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKXsKICAgICAgICByZXR1cm4gc3ViLnRyYW5zZmVyRnJvbSAhPSAwICYmIHN1Yi50cmFuc2ZlclRvICE9IDA7CiAgICB9CgogICAgZnVuY3Rpb24gX2V4aXN0cyhTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpewogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJUbyAhPSAwOyAgIC8vZXhpc3Rpbmcgc3Vic2NyaXB0aW9uIG9yIG9mZmVyIGhhcyBhbHdheXMgdHJhbnNmZXJUbyBzZXQuCiAgICB9CgogICAgbW9kaWZpZXIgb25seVJlZ2lzdGVyZWRQcm92aWRlcigpewogICAgICAgIGlmICghcHJvdmlkZXJSZWdpc3RyeVttc2cuc2VuZGVyXSkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBub3RTdXNwZW5kZWQgewogICAgICAgIGlmIChzdXNwZW5kZWRVbnRpbCA+IG5vdykgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCn0gLy9TdWJzY3JpcHRpb25Nb2R1bGVJbXBs'.
	

]
