Class {
	#name : #SRTe4e5388457a381eb608c09aa6e63330c9ff6fc09,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe4e5388457a381eb608c09aa6e63330c9ff6fc09 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8vaW1wb3J0ICJnaXRodWIuY29tL0FyYWNobmlkL3NvbGlkaXR5LXN0cmluZ3V0aWxzL3NyYy9zdHJpbmdzLnNvbCI7CgovKgogKiBAdGl0bGUgU3RyaW5nICYgc2xpY2UgdXRpbGl0eSBsaWJyYXJ5IGZvciBTb2xpZGl0eSBjb250cmFjdHMuCiAqIEBhdXRob3IgTmljayBKb2huc29uIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iM2U1ZjRjNWY1ZDU2NTA1NzVhN2U1MDUxNGE1YTUxNGExMDUwNWI0YSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CiAqCiAqIEBkZXYgRnVuY3Rpb25hbGl0eSBpbiB0aGlzIGxpYnJhcnkgaXMgbGFyZ2VseSBpbXBsZW1lbnRlZCB1c2luZyBhbgogKiAgICAgIGFic3RyYWN0aW9uIGNhbGxlZCBhICdzbGljZScuIEEgc2xpY2UgcmVwcmVzZW50cyBhIHBhcnQgb2YgYSBzdHJpbmcgLQogKiAgICAgIGFueXRoaW5nIGZyb20gdGhlIGVudGlyZSBzdHJpbmcgdG8gYSBzaW5nbGUgY2hhcmFjdGVyLCBvciBldmVuIG5vCiAqICAgICAgY2hhcmFjdGVycyBhdCBhbGwgKGEgMC1sZW5ndGggc2xpY2UpLiBTaW5jZSBhIHNsaWNlIG9ubHkgaGFzIHRvIHNwZWNpZnkKICogICAgICBhbiBvZmZzZXQgYW5kIGEgbGVuZ3RoLCBjb3B5aW5nIGFuZCBtYW5pcHVsYXRpbmcgc2xpY2VzIGlzIGEgbG90IGxlc3MKICogICAgICBleHBlbnNpdmUgdGhhbiBjb3B5aW5nIGFuZCBtYW5pcHVsYXRpbmcgdGhlIHN0cmluZ3MgdGhleSByZWZlcmVuY2UuCiAqCiAqICAgICAgVG8gZnVydGhlciByZWR1Y2UgZ2FzIGNvc3RzLCBtb3N0IGZ1bmN0aW9ucyBvbiBzbGljZSB0aGF0IG5lZWQgdG8gcmV0dXJuCiAqICAgICAgYSBzbGljZSBtb2RpZnkgdGhlIG9yaWdpbmFsIG9uZSBpbnN0ZWFkIG9mIGFsbG9jYXRpbmcgYSBuZXcgb25lOyBmb3IKICogICAgICBpbnN0YW5jZSwgYHMuc3BsaXQoIi4iKWAgd2lsbCByZXR1cm4gdGhlIHRleHQgdXAgdG8gdGhlIGZpcnN0ICcuJywKICogICAgICBtb2RpZnlpbmcgcyB0byBvbmx5IGNvbnRhaW4gdGhlIHJlbWFpbmRlciBvZiB0aGUgc3RyaW5nIGFmdGVyIHRoZSAnLicuCiAqICAgICAgSW4gc2l0dWF0aW9ucyB3aGVyZSB5b3UgZG8gbm90IHdhbnQgdG8gbW9kaWZ5IHRoZSBvcmlnaW5hbCBzbGljZSwgeW91CiAqICAgICAgY2FuIG1ha2UgYSBjb3B5IGZpcnN0IHdpdGggYC5jb3B5KClgLCBmb3IgZXhhbXBsZToKICogICAgICBgcy5jb3B5KCkuc3BsaXQoIi4iKWAuIFRyeSBhbmQgYXZvaWQgdXNpbmcgdGhpcyBpZGlvbSBpbiBsb29wczsgc2luY2UKICogICAgICBTb2xpZGl0eSBoYXMgbm8gbWVtb3J5IG1hbmFnZW1lbnQsIGl0IHdpbGwgcmVzdWx0IGluIGFsbG9jYXRpbmcgbWFueQogKiAgICAgIHNob3J0LWxpdmVkIHNsaWNlcyB0aGF0IGFyZSBsYXRlciBkaXNjYXJkZWQuCiAqCiAqICAgICAgRnVuY3Rpb25zIHRoYXQgcmV0dXJuIHR3byBzbGljZXMgY29tZSBpbiB0d28gdmVyc2lvbnM6IGEgbm9uLWFsbG9jYXRpbmcKICogICAgICB2ZXJzaW9uIHRoYXQgdGFrZXMgdGhlIHNlY29uZCBzbGljZSBhcyBhbiBhcmd1bWVudCwgbW9kaWZ5aW5nIGl0IGluCiAqICAgICAgcGxhY2UsIGFuZCBhbiBhbGxvY2F0aW5nIHZlcnNpb24gdGhhdCBhbGxvY2F0ZXMgYW5kIHJldHVybnMgdGhlIHNlY29uZAogKiAgICAgIHNsaWNlOyBzZWUgYG5leHRSdW5lYCBmb3IgZXhhbXBsZS4KICoKICogICAgICBGdW5jdGlvbnMgdGhhdCBoYXZlIHRvIGNvcHkgc3RyaW5nIGRhdGEgd2lsbCByZXR1cm4gc3RyaW5ncyByYXRoZXIgdGhhbgogKiAgICAgIHNsaWNlczsgdGhlc2UgY2FuIGJlIGNhc3QgYmFjayB0byBzbGljZXMgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZyBpZgogKiAgICAgIHJlcXVpcmVkLgogKgogKiAgICAgIEZvciBjb252ZW5pZW5jZSwgc29tZSBmdW5jdGlvbnMgYXJlIHByb3ZpZGVkIHdpdGggbm9uLW1vZGlmeWluZwogKiAgICAgIHZhcmlhbnRzIHRoYXQgY3JlYXRlIGEgbmV3IHNsaWNlIGFuZCByZXR1cm4gYm90aDsgZm9yIGluc3RhbmNlLAogKiAgICAgIGBzLnNwbGl0TmV3KCcuJylgIGxlYXZlcyBzIHVubW9kaWZpZWQsIGFuZCByZXR1cm5zIHR3byB2YWx1ZXMKICogICAgICBjb3JyZXNwb25kaW5nIHRvIHRoZSBsZWZ0IGFuZCByaWdodCBwYXJ0cyBvZiB0aGUgc3RyaW5nLgogKi8KIApwcmFnbWEgc29saWRpdHkgXjAuNC4xNDsKCmxpYnJhcnkgc3RyaW5ncyB7CiAgICBzdHJ1Y3Qgc2xpY2UgewogICAgICAgIHVpbnQgX2xlbjsKICAgICAgICB1aW50IF9wdHI7CiAgICB9CgogICAgZnVuY3Rpb24gbWVtY3B5KHVpbnQgZGVzdCwgdWludCBzcmMsIHVpbnQgbGVuKSBwcml2YXRlIHB1cmUgewogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlCiAgICAgICAgZm9yKDsgbGVuID49IDMyOyBsZW4gLT0gMzIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG1sb2FkKHNyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVzdCArPSAzMjsKICAgICAgICAgICAgc3JjICs9IDMyOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKICAgICAgICB1aW50IG1hc2sgPSAyNTYgKiogKDMyIC0gbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQogICAgICAgICAgICBsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKGRlc3QpLCBtYXNrKQogICAgICAgICAgICBtc3RvcmUoZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzdHJpbmcgdG8gbWFrZSBhIHNsaWNlIGZyb20uCiAgICAgKiBAcmV0dXJuIEEgbmV3bHkgYWxsb2NhdGVkIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRvU2xpY2Uoc3RyaW5nIHNlbGYpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZiwgMHgyMCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNsaWNlKGJ5dGVzKHNlbGYpLmxlbmd0aCwgcHRyKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBudWxsLXRlcm1pbmF0ZWQgYnl0ZXMzMiBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcsIGZyb20gMCB0byAzMi4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCByZXQ7CiAgICAgICAgaWYgKHNlbGYgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmID09IDApIHsKICAgICAgICAgICAgcmV0ICs9IDE2OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSA4OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDAwMDAwMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSA0OwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAyOwogICAgICAgICAgICBzZWxmID0gYnl0ZXMzMih1aW50KHNlbGYpIC8gMHgxMDAwMCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmICYgMHhmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMzIgLSByZXQ7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBieXRlczMyLCBpbnRlcnByZXRlZCBhcyBhCiAgICAgKiAgICAgIG51bGwtdGVybWludGFlZCB1dGYtOCBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgYnl0ZXMzMiB2YWx1ZSB0byBjb252ZXJ0IHRvIGEgc2xpY2UuCiAgICAgKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHZhbHVlIG9mIHRoZSBpbnB1dCBhcmd1bWVudCB1cCB0byB0aGUKICAgICAqICAgICAgICAgZmlyc3QgbnVsbC4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TbGljZUIzMihieXRlczMyIHNlbGYpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UgcmV0KSB7CiAgICAgICAgLy8gQWxsb2NhdGUgc3BhY2UgZm9yIGBzZWxmYCBpbiBtZW1vcnksIGNvcHkgaXQgdGhlcmUsIGFuZCBwb2ludCByZXQgYXQgaXQKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBwdHIgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChwdHIsIDB4MjApKQogICAgICAgICAgICBtc3RvcmUocHRyLCBzZWxmKQogICAgICAgICAgICBtc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikKICAgICAgICB9CiAgICAgICAgcmV0Ll9sZW4gPSBsZW4oc2VsZik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIG5ldyBzbGljZSBjb250YWluaW5nIHRoZSBzYW1lIGRhdGEgYXMgdGhlIGN1cnJlbnQgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY29weShzbGljZSBzZWxmKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgcmV0dXJuIHNsaWNlKHNlbGYuX2xlbiwgc2VsZi5fcHRyKTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBzdHJpbmcgbWVtb3J5IHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQoKICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggaW4gcnVuZXMgb2YgdGhlIHNsaWNlLiBOb3RlIHRoYXQgdGhpcyBvcGVyYXRpb24KICAgICAqICAgICAgdGFrZXMgdGltZSBwcm9wb3J0aW9uYWwgdG8gdGhlIGxlbmd0aCBvZiB0aGUgc2xpY2U7IGF2b2lkIHVzaW5nIGl0CiAgICAgKiAgICAgIGluIGxvb3BzLCBhbmQgY2FsbCBgc2xpY2UuZW1wdHkoKWAgaWYgeW91IG9ubHkgbmVlZCB0byBrbm93IHdoZXRoZXIKICAgICAqICAgICAgdGhlIHNsaWNlIGlzIGVtcHR5IG9yIG5vdC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzbGljZSBpbiBydW5lcy4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKHNsaWNlIHNlbGYpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCBsKSB7CiAgICAgICAgLy8gU3RhcnRpbmcgYXQgcHRyLTMxIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0CiAgICAgICAgdWludCBwdHIgPSBzZWxmLl9wdHIgLSAzMTsKICAgICAgICB1aW50IGVuZCA9IHB0ciArIHNlbGYuX2xlbjsKICAgICAgICBmb3IgKGwgPSAwOyBwdHIgPCBlbmQ7IGwrKykgewogICAgICAgICAgICB1aW50OCBiOwogICAgICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHB0ciksIDB4RkYpIH0KICAgICAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMTsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMjsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEYwKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gMzsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEY4KSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgICAgfSBlbHNlIGlmKGIgPCAweEZDKSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHB0ciArPSA2OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHkgKGhhcyBhIGxlbmd0aCBvZiAwKS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBpcyBlbXB0eSwgRmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBlbXB0eShzbGljZSBzZWxmKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc2VsZi5fbGVuID09IDA7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyBhIHBvc2l0aXZlIG51bWJlciBpZiBgb3RoZXJgIGNvbWVzIGxleGljb2dyYXBoaWNhbGx5IGFmdGVyCiAgICAgKiAgICAgIGBzZWxmYCwgYSBuZWdhdGl2ZSBudW1iZXIgaWYgaXQgY29tZXMgYmVmb3JlLCBvciB6ZXJvIGlmIHRoZQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwKICAgICAqICAgICAgb24gdW5pY29kZSBjb2RlcG9pbnRzLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uLgogICAgICovCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCkgewogICAgICAgIHVpbnQgc2hvcnRlc3QgPSBzZWxmLl9sZW47CiAgICAgICAgaWYgKG90aGVyLl9sZW4gPCBzZWxmLl9sZW4pCiAgICAgICAgICAgIHNob3J0ZXN0ID0gb3RoZXIuX2xlbjsKCiAgICAgICAgdWludCBzZWxmcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHVpbnQgb3RoZXJwdHIgPSBvdGhlci5fcHRyOwogICAgICAgIGZvciAodWludCBpZHggPSAwOyBpZHggPCBzaG9ydGVzdDsgaWR4ICs9IDMyKSB7CiAgICAgICAgICAgIHVpbnQgYTsKICAgICAgICAgICAgdWludCBiOwogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBhIDo9IG1sb2FkKHNlbGZwdHIpCiAgICAgICAgICAgICAgICBiIDo9IG1sb2FkKG90aGVycHRyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhICE9IGIpIHsKICAgICAgICAgICAgICAgIC8vIE1hc2sgb3V0IGlycmVsZXZhbnQgYnl0ZXMgYW5kIGNoZWNrIGFnYWluCiAgICAgICAgICAgICAgICB1aW50MjU2IG1hc2sgPSB+KDIgKiogKDggKiAoMzIgLSBzaG9ydGVzdCArIGlkeCkpIC0gMSk7CiAgICAgICAgICAgICAgICB1aW50MjU2IGRpZmYgPSAoYSAmIG1hc2spIC0gKGIgJiBtYXNrKTsKICAgICAgICAgICAgICAgIGlmIChkaWZmICE9IDApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChkaWZmKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmcHRyICs9IDMyOwogICAgICAgICAgICBvdGhlcnB0ciArPSAzMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGludChzZWxmLl9sZW4pIC0gaW50KG90aGVyLl9sZW4pOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgdHdvIHNsaWNlcyBjb250YWluIHRoZSBzYW1lIHRleHQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgZmlyc3Qgc2xpY2UgdG8gY29tcGFyZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29tcGFyZS4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2VzIGFyZSBlcXVhbCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBlcXVhbHMoc2xpY2Ugc2VsZiwgc2xpY2Ugb3RoZXIpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBjb21wYXJlKHNlbGYsIG90aGVyKSA9PSAwOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IEV4dHJhY3RzIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSBpbnRvIGBydW5lYCwgYWR2YW5jaW5nIHRoZQogICAgICogICAgICBzbGljZSB0byBwb2ludCB0byB0aGUgbmV4dCBydW5lIGFuZCByZXR1cm5pbmcgYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gcnVuZSBUaGUgc2xpY2UgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIGZpcnN0IHJ1bmUuCiAgICAgKiBAcmV0dXJuIGBydW5lYC4KICAgICAqLwogICAgZnVuY3Rpb24gbmV4dFJ1bmUoc2xpY2Ugc2VsZiwgc2xpY2UgcnVuZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzbGljZSkgewogICAgICAgIHJ1bmUuX3B0ciA9IHNlbGYuX3B0cjsKCiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7CiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IDA7CiAgICAgICAgICAgIHJldHVybiBydW5lOwogICAgICAgIH0KCiAgICAgICAgdWludCBsOwogICAgICAgIHVpbnQgYjsKICAgICAgICAvLyBMb2FkIHRoZSBmaXJzdCBieXRlIG9mIHRoZSBydW5lIGludG8gdGhlIExTQnMgb2YgYgogICAgICAgIGFzc2VtYmx5IHsgYiA6PSBhbmQobWxvYWQoc3ViKG1sb2FkKGFkZChzZWxmLCAzMikpLCAzMSkpLCAweEZGKSB9CiAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgIGwgPSAxOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICBsID0gMjsKICAgICAgICB9IGVsc2UgaWYoYiA8IDB4RjApIHsKICAgICAgICAgICAgbCA9IDM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbCA9IDQ7CiAgICAgICAgfQoKICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMKICAgICAgICBpZiAobCA+IHNlbGYuX2xlbikgewogICAgICAgICAgICBydW5lLl9sZW4gPSBzZWxmLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciArPSBzZWxmLl9sZW47CiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgICAgIHJldHVybiBydW5lOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5fcHRyICs9IGw7CiAgICAgICAgc2VsZi5fbGVuIC09IGw7CiAgICAgICAgcnVuZS5fbGVuID0gbDsKICAgICAgICByZXR1cm4gcnVuZTsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludAogICAgICogICAgICB0byB0aGUgbmV4dCBydW5lLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHNsaWNlIHJldCkgewogICAgICAgIG5leHRSdW5lKHNlbGYsIHJldCk7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBjb2RlcG9pbnQgaW4gdGhlIHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG9yZChzbGljZSBzZWxmKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgcmV0KSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgdWludCB3b3JkOwogICAgICAgIHVpbnQgbGVuZ3RoOwogICAgICAgIHVpbnQgZGl2aXNvciA9IDIgKiogMjQ4OwoKICAgICAgICAvLyBMb2FkIHRoZSBydW5lIGludG8gdGhlIE1TQnMgb2YgYgogICAgICAgIGFzc2VtYmx5IHsgd29yZDo9IG1sb2FkKG1sb2FkKGFkZChzZWxmLCAzMikpKSB9CiAgICAgICAgdWludCBiID0gd29yZCAvIGRpdmlzb3I7CiAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgIHJldCA9IGI7CiAgICAgICAgICAgIGxlbmd0aCA9IDE7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgIHJldCA9IGIgJiAweDFGOwogICAgICAgICAgICBsZW5ndGggPSAyOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICByZXQgPSBiICYgMHgwRjsKICAgICAgICAgICAgbGVuZ3RoID0gMzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXQgPSBiICYgMHgwNzsKICAgICAgICAgICAgbGVuZ3RoID0gNDsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cwogICAgICAgIGlmIChsZW5ndGggPiBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICBkaXZpc29yID0gZGl2aXNvciAvIDI1NjsKICAgICAgICAgICAgYiA9ICh3b3JkIC8gZGl2aXNvcikgJiAweEZGOwogICAgICAgICAgICBpZiAoYiAmIDB4QzAgIT0gMHg4MCkgewogICAgICAgICAgICAgICAgLy8gSW52YWxpZCBVVEYtOCBzZXF1ZW5jZQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0ID0gKHJldCAqIDY0KSB8IChiICYgMHgzRik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdGhlIGtlY2Nhay0yNTYgaGFzaCBvZiB0aGUgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gaGFzaC4KICAgICAqIEByZXR1cm4gVGhlIGhhc2ggb2YgdGhlIHNsaWNlLgogICAgICovCiAgICBmdW5jdGlvbiBrZWNjYWsoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChieXRlczMyIHJldCkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmV0IDo9IGtlY2NhazI1NihtbG9hZChhZGQoc2VsZiwgMzIpKSwgbWxvYWQoc2VsZikpCiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiBgc2VsZmAgc3RhcnRzIHdpdGggYG5lZWRsZWAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YXJ0c1dpdGgoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYuX3B0ciA9PSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWw7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbGVuZ3RoIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgbGV0IHNlbGZwdHIgOj0gbWxvYWQoYWRkKHNlbGYsIDB4MjApKQogICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICBlcXVhbCA6PSBlcShrZWNjYWsyNTYoc2VsZnB0ciwgbGVuZ3RoKSwga2VjY2FrMjU2KG5lZWRsZXB0ciwgbGVuZ3RoKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IElmIGBzZWxmYCBzdGFydHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQogICAgICogICAgICBiZWdpbm5pbmcgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAKICAgICAqLwogICAgZnVuY3Rpb24gYmV5b25kKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzbGljZSkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmLl9wdHIgIT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IGxlbmd0aCA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW5ndGgpLCBzaGEzKG5lZWRsZXB0ciwgbGVuZ3RoKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxdWFsKSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyICs9IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSBzbGljZSBlbmRzIHdpdGggYG5lZWRsZWAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHNsaWNlIHN0YXJ0cyB3aXRoIHRoZSBwcm92aWRlZCB0ZXh0LCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVuZHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHVpbnQgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwoKICAgICAgICBpZiAoc2VsZnB0ciA9PSBuZWVkbGUuX3B0cikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWw7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgbGVuZ3RoIDo9IG1sb2FkKG5lZWRsZSkKICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgZXF1YWwgOj0gZXEoa2VjY2FrMjU2KHNlbGZwdHIsIGxlbmd0aCksIGtlY2NhazI1NihuZWVkbGVwdHIsIGxlbmd0aCkpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZXF1YWw7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgSWYgYHNlbGZgIGVuZHMgd2l0aCBgbmVlZGxlYCwgYG5lZWRsZWAgaXMgcmVtb3ZlZCBmcm9tIHRoZQogICAgICogICAgICBlbmQgb2YgYHNlbGZgLiBPdGhlcndpc2UsIGBzZWxmYCBpcyB1bm1vZGlmaWVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAKICAgICAqLwogICAgZnVuY3Rpb24gdW50aWwoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA8IG5lZWRsZS5fbGVuKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0KCiAgICAgICAgdWludCBzZWxmcHRyID0gc2VsZi5fcHRyICsgc2VsZi5fbGVuIC0gbmVlZGxlLl9sZW47CiAgICAgICAgYm9vbCBlcXVhbCA9IHRydWU7CiAgICAgICAgaWYgKHNlbGZwdHIgIT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IGxlbmd0aCA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoa2VjY2FrMjU2KHNlbGZwdHIsIGxlbmd0aCksIGtlY2NhazI1NihuZWVkbGVwdHIsIGxlbmd0aCkpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcXVhbCkgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICBldmVudCBsb2dfYnl0ZW1hc2soYnl0ZXMzMiBtYXNrKTsKCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgZmlyc3QgYnl0ZSBhZnRlciBgc2VsZmAgaWYgbm90IGZvdW5kLgogICAgZnVuY3Rpb24gZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcHRyID0gc2VsZnB0cjsKICAgICAgICB1aW50IGlkeDsKCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7CiAgICAgICAgICAgIGlmIChuZWVkbGVsZW4gPD0gMzIpIHsKICAgICAgICAgICAgICAgIGJ5dGVzMzIgbWFzayA9IGJ5dGVzMzIofigyICoqICg4ICogKDMyIC0gbmVlZGxlbGVuKSkgLSAxKSk7CgogICAgICAgICAgICAgICAgYnl0ZXMzMiBuZWVkbGVkYXRhOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKSB9CgogICAgICAgICAgICAgICAgdWludCBlbmQgPSBzZWxmcHRyICsgc2VsZmxlbiAtIG5lZWRsZWxlbjsKICAgICAgICAgICAgICAgIGJ5dGVzMzIgcHRyZGF0YTsKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgcHRyZGF0YSA6PSBhbmQobWxvYWQocHRyKSwgbWFzaykgfQoKICAgICAgICAgICAgICAgIHdoaWxlIChwdHJkYXRhICE9IG5lZWRsZWRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocHRyID49IGVuZCkgCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmcHRyICsgc2VsZmxlbjsKICAgICAgICAgICAgICAgICAgICBwdHIrKzsKICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHB0cmRhdGEgOj0gYW5kKG1sb2FkKHB0ciksIG1hc2spIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgbG9uZyBuZWVkbGVzLCB1c2UgaGFzaGluZwogICAgICAgICAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBoYXNoIDo9IHNoYTMobmVlZGxlcHRyLCBuZWVkbGVsZW4pIH0KCiAgICAgICAgICAgICAgICBmb3IgKGlkeCA9IDA7IGlkeCA8PSBzZWxmbGVuIC0gbmVlZGxlbGVuOyBpZHgrKykgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHIgKyBzZWxmbGVuOwogICAgfQoKICAgIC8vIFJldHVybnMgdGhlIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBmaXJzdCBieXRlIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YKICAgIC8vIGBuZWVkbGVgIGluIGBzZWxmYCwgb3IgdGhlIGFkZHJlc3Mgb2YgYHNlbGZgIGlmIG5vdCBmb3VuZC4KICAgIGZ1bmN0aW9uIHJmaW5kUHRyKHVpbnQgc2VsZmxlbiwgdWludCBzZWxmcHRyLCB1aW50IG5lZWRsZWxlbiwgdWludCBuZWVkbGVwdHIpIHByaXZhdGUgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICBieXRlczMyIG1hc2sgPSBieXRlczMyKH4oMiAqKiAoOCAqICgzMiAtIG5lZWRsZWxlbikpIC0gMSkpOwoKICAgICAgICAgICAgICAgIGJ5dGVzMzIgbmVlZGxlZGF0YTsKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykgfQoKICAgICAgICAgICAgICAgIHB0ciA9IHNlbGZwdHIgKyBzZWxmbGVuIC0gbmVlZGxlbGVuOwogICAgICAgICAgICAgICAgYnl0ZXMzMiBwdHJkYXRhOwogICAgICAgICAgICAgICAgYXNzZW1ibHkgeyBwdHJkYXRhIDo9IGFuZChtbG9hZChwdHIpLCBtYXNrKSB9CgogICAgICAgICAgICAgICAgd2hpbGUgKHB0cmRhdGEgIT0gbmVlZGxlZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGlmIChwdHIgPD0gc2VsZnB0cikgCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmcHRyOwogICAgICAgICAgICAgICAgICAgIHB0ci0tOwogICAgICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsgcHRyZGF0YSA6PSBhbmQobWxvYWQocHRyKSwgbWFzaykgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0ciArIG5lZWRsZWxlbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0ciArIChzZWxmbGVuIC0gbmVlZGxlbGVuKTsKICAgICAgICAgICAgICAgIHdoaWxlIChwdHIgPj0gc2VsZnB0cikgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHIgKyBuZWVkbGVsZW47CiAgICAgICAgICAgICAgICAgICAgcHRyIC09IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHI7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gZXZlcnl0aGluZyBmcm9tIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mCiAgICAgKiAgICAgIGBuZWVkbGVgIHRvIHRoZSBlbmQgb2YgdGhlIHNsaWNlLiBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZQogICAgICogICAgICBpZiBgbmVlZGxlYCBpcyBub3QgZm91bmQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoIGFuZCBtb2RpZnkuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgc2VsZi5fbGVuIC09IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICBzZWxmLl9wdHIgPSBwdHI7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gdGhlIHBhcnQgb2YgdGhlIHN0cmluZyBmcm9tIHRoZSBzdGFydCBvZgogICAgICogICAgICBgc2VsZmAgdG8gdGhlIGVuZCBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYC4gSWYgYG5lZWRsZWAKICAgICAqICAgICAgaXMgbm90IGZvdW5kLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2ggYW5kIG1vZGlmeS4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiByZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IHJmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpOwogICAgICAgIHNlbGYuX2xlbiA9IHB0ciAtIHNlbGYuX3B0cjsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGFmdGVyIHRoZSBmaXJzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgYHRva2VuYCB0byBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSwgc2xpY2UgdG9rZW4pIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsKICAgICAgICB0b2tlbi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIC8vIE5vdCBmb3VuZAogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciA9IHB0ciArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBhZnRlciB0aGUgZmlyc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGJlZm9yZSBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAgaXMgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgcGFydCBvZiBgc2VsZmAgdXAgdG8gdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHNsaWNlIHRva2VuKSB7CiAgICAgICAgc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBhZnRlciBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICB0b2tlbi5fcHRyID0gcHRyOwogICAgICAgIHRva2VuLl9sZW4gPSBzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKTsKICAgICAgICBpZiAocHRyID09IHNlbGYuX3B0cikgewogICAgICAgICAgICAvLyBOb3QgZm91bmQKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gdG9rZW4uX2xlbiArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIHJldHVybmluZyBldmVyeXRoaW5nIGFmdGVyIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgdGhlIGVudGlyZXR5IG9mIGBzZWxmYCBpcyByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBwYXJ0IG9mIGBzZWxmYCBhZnRlciB0aGUgbGFzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICByc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7CiAgICB9CgogICAgLyoKICAgICAqIEBkZXYgQ291bnRzIHRoZSBudW1iZXIgb2Ygbm9ub3ZlcmxhcHBpbmcgb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRoZSBudW1iZXIgb2Ygb2NjdXJyZW5jZXMgb2YgYG5lZWRsZWAgZm91bmQgaW4gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBjb3VudChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCBjbnQpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgKyBuZWVkbGUuX2xlbjsKICAgICAgICB3aGlsZSAocHRyIDw9IHNlbGYuX3B0ciArIHNlbGYuX2xlbikgewogICAgICAgICAgICBjbnQrKzsKICAgICAgICAgICAgcHRyID0gZmluZFB0cihzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKSwgcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgVHJ1ZSBpZiBgc2VsZmAgY29udGFpbnMgYG5lZWRsZWAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc2VhcmNoLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBgbmVlZGxlYCBpcyBmb3VuZCBpbiBgc2VsZmAsIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gY29udGFpbnMoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cikgIT0gc2VsZi5fcHRyOwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGNvbmNhdGVuYXRpb24gb2YKICAgICAqICAgICAgYHNlbGZgIGFuZCBgb3RoZXJgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbmNhdGVuYXRlLgogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29uY2F0ZW5hdGUuCiAgICAgKiBAcmV0dXJuIFRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSB0d28gc3RyaW5ncy4KICAgICAqLwogICAgZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHN0cmluZyBtZW1vcnkgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICBtZW1jcHkocmV0cHRyICsgc2VsZi5fbGVuLCBvdGhlci5fcHRyLCBvdGhlci5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qCiAgICAgKiBAZGV2IEpvaW5zIGFuIGFycmF5IG9mIHNsaWNlcywgdXNpbmcgYHNlbGZgIGFzIGEgZGVsaW1pdGVyLCByZXR1cm5pbmcgYQogICAgICogICAgICBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGRlbGltaXRlciB0byB1c2UuCiAgICAgKiBAcGFyYW0gcGFydHMgQSBsaXN0IG9mIHNsaWNlcyB0byBqb2luLgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzdHJpbmcgY29udGFpbmluZyBhbGwgdGhlIHNsaWNlcyBpbiBgcGFydHNgLAogICAgICogICAgICAgICBqb2luZWQgd2l0aCBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGpvaW4oc2xpY2Ugc2VsZiwgc2xpY2VbXSBwYXJ0cykgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICBpZiAocGFydHMubGVuZ3RoID09IDApCiAgICAgICAgICAgIHJldHVybiAiIjsKCiAgICAgICAgdWludCBsZW5ndGggPSBzZWxmLl9sZW4gKiAocGFydHMubGVuZ3RoIC0gMSk7CiAgICAgICAgZm9yKHVpbnQgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgbGVuZ3RoICs9IHBhcnRzW2ldLl9sZW47CgogICAgICAgIHN0cmluZyBtZW1vcnkgcmV0ID0gbmV3IHN0cmluZyhsZW5ndGgpOwogICAgICAgIHVpbnQgcmV0cHRyOwogICAgICAgIGFzc2VtYmx5IHsgcmV0cHRyIDo9IGFkZChyZXQsIDMyKSB9CgogICAgICAgIGZvcihpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1lbWNweShyZXRwdHIsIHBhcnRzW2ldLl9wdHIsIHBhcnRzW2ldLl9sZW4pOwogICAgICAgICAgICByZXRwdHIgKz0gcGFydHNbaV0uX2xlbjsKICAgICAgICAgICAgaWYgKGkgPCBwYXJ0cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgICAgICAgICByZXRwdHIgKz0gc2VsZi5fbGVuOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQp9Cgpjb250cmFjdCBDcnlwdG9OdW1pc21hdCAKewogICAgCiAgICB1c2luZyBzdHJpbmdzIGZvciAqOwogICAgCiAgICBhZGRyZXNzIG93bmVyOwoKICAgIHN0cmluZyBwdWJsaWMgc3RhbmRhcmQgPSAnQ3J5cHRvTnVtaXNtYXQnOwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICBzdHJ1Y3QgQnV5IAogICAgewogICAgICAgIHVpbnQgY2FyZEluZGV4OwogICAgICAgIGFkZHJlc3Mgc2VsbGVyOwogICAgICAgIHVpbnQgbWluVmFsdWU7ICAvLyBpbiB3ZWkKICAgICAgICB1aW50IGludE5hbWU7CiAgICAgICAgc3RyaW5nIG5hbWU7CiAgICB9CiAgICAKICAgIHN0cnVjdCBVbml0ZWRCdXkgCiAgICB7CiAgICAgICAgdWludCBjYXJkSW5kZXg7CiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CiAgICAgICAgdWludCBpbnROYW1lOwogICAgICAgIHN0cmluZyBuYW1lOwogICAgfQoKICAgIG1hcHBpbmcgKHVpbnQgPT4gQnV5KSBwdWJsaWMgY2FyZHNGb3JTYWxlOwogICAgbWFwcGluZyAodWludCA9PiBVbml0ZWRCdXkpIHB1YmxpYyBVbml0ZWRDYXJkc0ZvclNhbGU7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBhZG1pbnM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHN0cmluZykgcHVibGljIG5pY2tuYW1lczsKCiAgICBldmVudCBBc3NpZ24odWludCBpbmRleGVkIF9jYXJkSW5kZXgsIGFkZHJlc3MgaW5kZXhlZCBfc2VsbGVyLCB1aW50MjU2IF92YWx1ZSwgdWludCBfaW50TmFtZSwgc3RyaW5nIF9uYW1lKTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludCBfY2FyZEluZGV4LCB1aW50MjU2IF92YWx1ZSk7CiAgICAKICAgIGZ1bmN0aW9uIENyeXB0b051bWlzbWF0KCkgcHVibGljIHBheWFibGUgCiAgICB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIGFkbWluc1tvd25lcl0gPSB0cnVlOwogICAgICAgIAogICAgICAgIHRvdGFsU3VwcGx5ID0gMTAwMDsgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRvdGFsIHN1cHBseQogICAgICAgIG5hbWUgPSAiY3J5cHRvbnVtaXNtYXQiOyAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICAgICAgc3ltYm9sID0gIiQiOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbCBmb3IgZGlzcGxheSBwdXJwb3NlcwogICAgICAgIGRlY2ltYWxzID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW1vdW50IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2VzCiAgICB9CiAgICAKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIAogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgb25seUFkbWlucygpIAogICAgewogICAgICAgIHJlcXVpcmUoYWRtaW5zW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRPd25lcihhZGRyZXNzIF9vd25lcikgb25seU93bmVyKCkgcHVibGljIAogICAgewogICAgICAgIG93bmVyID0gX293bmVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhZGRBZG1pbihhZGRyZXNzIF9hZG1pbikgb25seU93bmVyKCkgcHVibGljCiAgICB7CiAgICAgICAgYWRtaW5zW19hZG1pbl0gPSB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmVBZG1pbihhZGRyZXNzIF9hZG1pbikgb25seU93bmVyKCkgcHVibGljCiAgICB7CiAgICAgICAgZGVsZXRlIGFkbWluc1tfYWRtaW5dOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhd0FsbCgpIG9ubHlPd25lcigpIHB1YmxpYyAKICAgIHsKICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QW1vdW50KHVpbnQyNTYgX2Ftb3VudCkgb25seU93bmVyKCkgcHVibGljIAogICAgewogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA8PSB0aGlzLmJhbGFuY2UpOwogICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKF9hbW91bnQpOwogICAgfQogICAgCiAgICAvLy8gX3R5cGUgPT0gIkNvbW1vbiIKICAgIC8vLyBfdHlwZSA9PSAiVW5pdGVkIgoKICAgIGZ1bmN0aW9uIGFkZENhcmQoc3RyaW5nIF90eXBlLCB1aW50IF9pbnROYW1lLCBzdHJpbmcgX25hbWUsIHVpbnQgX2NhcmRJbmRleCwgdWludDI1NiBfdmFsdWUsIGFkZHJlc3MgX293bkFkZHJlc3MpIHB1YmxpYyBvbmx5QWRtaW5zKCkKICAgIHsKICAgICAgICByZXF1aXJlKF9jYXJkSW5kZXggPD0gMTAwMCk7CiAgICAgICAgcmVxdWlyZShfY2FyZEluZGV4ID4gMCk7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShjYXJkc0ZvclNhbGVbX2NhcmRJbmRleF0uY2FyZEluZGV4ICE9IF9jYXJkSW5kZXgpOwogICAgICAgIHJlcXVpcmUoVW5pdGVkQ2FyZHNGb3JTYWxlW19pbnROYW1lXS5pbnROYW1lICE9IF9pbnROYW1lKTsKICAgICAgICAKICAgICAgICBhZGRyZXNzIHNlbGxlciA9IF9vd25BZGRyZXNzOwogICAgICAgIHVpbnQyNTYgX3ZhbHVlMiA9IChfdmFsdWUgKiAxMDAwMDAwMDAwKTsKICAgICAgICAKICAgICAgICBpZiAoc3RyaW5ncy5lcXVhbHMoX3R5cGUudG9TbGljZSgpLCAiQ29tbW9uIi50b1NsaWNlKCkpKQogICAgICAgIHsKICAgICAgICAgICAgY2FyZHNGb3JTYWxlW19jYXJkSW5kZXhdID0gQnV5KF9jYXJkSW5kZXgsIHNlbGxlciwgX3ZhbHVlMiwgX2ludE5hbWUsIF9uYW1lKTsKICAgICAgICAgICAgQXNzaWduKF9jYXJkSW5kZXgsIHNlbGxlciwgX3ZhbHVlMiwgX2ludE5hbWUsIF9uYW1lKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoc3RyaW5ncy5lcXVhbHMoX3R5cGUudG9TbGljZSgpLCAiVW5pdGVkIi50b1NsaWNlKCkpKQogICAgICAgIHsKICAgICAgICAgICAgVW5pdGVkQ2FyZHNGb3JTYWxlW19pbnROYW1lXSA9IFVuaXRlZEJ1eShfY2FyZEluZGV4LCBzZWxsZXIsIF9pbnROYW1lLCBfbmFtZSk7CiAgICAgICAgICAgIGNhcmRzRm9yU2FsZVtfY2FyZEluZGV4XSA9IEJ1eShfY2FyZEluZGV4LCBzZWxsZXIsIF92YWx1ZTIsICBfaW50TmFtZSwgX25hbWUpOwogICAgICAgICAgICBBc3NpZ24oX2NhcmRJbmRleCwgc2VsbGVyLCBfdmFsdWUyLCBfaW50TmFtZSwgX25hbWUpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gZGlzcGxheUNhcmQodWludCBfY2FyZEluZGV4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50LCBhZGRyZXNzLCB1aW50MjU2LCB1aW50LCBzdHJpbmcpIAogICAgewogICAgICAgIHJlcXVpcmUoX2NhcmRJbmRleCA8PSAxMDAwKTsKICAgICAgICByZXF1aXJlKF9jYXJkSW5kZXggPiAwKTsKICAgICAgICAKICAgICAgICByZXF1aXJlIChjYXJkc0ZvclNhbGVbX2NhcmRJbmRleF0uY2FyZEluZGV4ID09IF9jYXJkSW5kZXgpOwogICAgICAgICAgICAKICAgICAgICByZXR1cm4oY2FyZHNGb3JTYWxlW19jYXJkSW5kZXhdLmNhcmRJbmRleCwgCiAgICAgICAgY2FyZHNGb3JTYWxlW19jYXJkSW5kZXhdLnNlbGxlciwKICAgICAgICBjYXJkc0ZvclNhbGVbX2NhcmRJbmRleF0ubWluVmFsdWUsCiAgICAgICAgY2FyZHNGb3JTYWxlW19jYXJkSW5kZXhdLmludE5hbWUsCiAgICAgICAgY2FyZHNGb3JTYWxlW19jYXJkSW5kZXhdLm5hbWUpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXROaWNrKHN0cmluZyBfbmV3TmljaykgcHVibGljCiAgICB7CiAgICAgICAgbmlja25hbWVzW21zZy5zZW5kZXJdID0gX25ld05pY2s7ICAgICAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGRpc3BsYXlOaWNrKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcpCiAgICB7CiAgICAgICAgcmV0dXJuIG5pY2tuYW1lc1tfb3duZXJdOwogICAgfQogICAgCiAgICAKICAgIHVpbnQyNTYgcHJpdmF0ZSBsaW1pdDEgPSAwLjA1IGV0aGVyOwogICAgdWludDI1NiBwcml2YXRlIGxpbWl0MiA9IDAuNSBldGhlcjsKICAgIHVpbnQyNTYgcHJpdmF0ZSBsaW1pdDMgPSA1IGV0aGVyOwogICAgdWludDI1NiBwcml2YXRlIGxpbWl0NCA9IDUwIGV0aGVyOwogICAgCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVOZXh0UHJpY2UodWludDI1NiBfc3RhcnRQcmljZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX2ZpbmFsUHJpY2UpCiAgICB7CiAgICAgICAgaWYgKF9zdGFydFByaWNlIDwgbGltaXQxKQogICAgICAgICAgICBfc3RhcnRQcmljZSA9ICBfc3RhcnRQcmljZSAqIDEwIC8gNDsKICAgICAgICBlbHNlIGlmIChfc3RhcnRQcmljZSA8IGxpbWl0MikKICAgICAgICAgICAgX3N0YXJ0UHJpY2UgPSAgX3N0YXJ0UHJpY2UgKiAxMCAvIDU7CiAgICAgICAgZWxzZSBpZiAoX3N0YXJ0UHJpY2UgPCBsaW1pdDMpCiAgICAgICAgICAgIF9zdGFydFByaWNlID0gIF9zdGFydFByaWNlICogMTAgLyA2OwogICAgICAgIGVsc2UgaWYgKF9zdGFydFByaWNlIDwgbGltaXQ0KQogICAgICAgICAgICBfc3RhcnRQcmljZSA9ICBfc3RhcnRQcmljZSAqIDEwIC8gNzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIF9zdGFydFByaWNlID0gIF9zdGFydFByaWNlICogMTAgLyA4OwogICAgICAgICAgICAKICAgICAgICByZXR1cm4gKF9zdGFydFByaWNlIC8gMTAwMDAwMCkgKiAxMDAwMDAwOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVEZXZDdXQodWludDI1NiBfc3RhcnRQcmljZSkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgX2N1dCkKICAgIHsKICAgICAgICBpZiAoX3N0YXJ0UHJpY2UgPCBsaW1pdDIpCiAgICAgICAgICAgIF9zdGFydFByaWNlID0gIF9zdGFydFByaWNlICogNSAvIDEwMDsKICAgICAgICBlbHNlIGlmIChfc3RhcnRQcmljZSA8IGxpbWl0MykKICAgICAgICAgICAgX3N0YXJ0UHJpY2UgPSAgX3N0YXJ0UHJpY2UgKiA0IC8gMTAwOwogICAgICAgIGVsc2UgaWYgKF9zdGFydFByaWNlIDwgbGltaXQ0KQogICAgICAgICAgICBfc3RhcnRQcmljZSA9ICBfc3RhcnRQcmljZSAqIDMgLyAxMDA7CiAgICAgICAgZWxzZQogICAgICAgICAgICBfc3RhcnRQcmljZSA9ICBfc3RhcnRQcmljZSAqIDIgLyAxMDA7CiAgICAgICAgICAgIAogICAgICAgIHJldHVybiAoX3N0YXJ0UHJpY2UgLyAxMDAwMDAwKSAqIDEwMDAwMDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJ1eSh1aW50IF9jYXJkSW5kZXgpIHB1YmxpYyBwYXlhYmxlCiAgICB7CiAgICAgICAgcmVxdWlyZShfY2FyZEluZGV4IDw9IDEwMDApOwogICAgICAgIHJlcXVpcmUoX2NhcmRJbmRleCA+IDApOwogICAgICAgIHJlcXVpcmUoY2FyZHNGb3JTYWxlW19jYXJkSW5kZXhdLmNhcmRJbmRleCA9PSBfY2FyZEluZGV4KTsKICAgICAgICByZXF1aXJlKGNhcmRzRm9yU2FsZVtfY2FyZEluZGV4XS5zZWxsZXIgIT0gbXNnLnNlbmRlcik7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBvd25lcik7CiAgICAgICAgcmVxdWlyZShjYXJkc0ZvclNhbGVbX2NhcmRJbmRleF0ubWluVmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBjYXJkc0ZvclNhbGVbX2NhcmRJbmRleF0ubWluVmFsdWUpOwogICAgICAgIAogICAgICAgIGFkZHJlc3MgX2J1eWVyID0gbXNnLnNlbmRlcjsKICAgICAgICBhZGRyZXNzIF9zZWxsZXIgPSBjYXJkc0ZvclNhbGVbX2NhcmRJbmRleF0uc2VsbGVyOwogICAgICAgIHN0cmluZyBfbmFtZSA9IGNhcmRzRm9yU2FsZVtfY2FyZEluZGV4XS5uYW1lOwogICAgICAgIHVpbnQgX2ludE5hbWUgPSBjYXJkc0ZvclNhbGVbX2NhcmRJbmRleF0uaW50TmFtZTsKICAgICAgICAKICAgICAgICBhZGRyZXNzIF9Vbml0ZWRPd25lciA9IFVuaXRlZENhcmRzRm9yU2FsZVtfaW50TmFtZV0uc2VsbGVyOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgX3ByaWNlID0gY2FyZHNGb3JTYWxlW19jYXJkSW5kZXhdLm1pblZhbHVlOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgX25leHRQcmljZSA9IGNhbGN1bGF0ZU5leHRQcmljZShfcHJpY2UpOwogICAgICAgIHVpbnQyNTYgX2RldkN1dCA9IGNhbGN1bGF0ZURldkN1dChfcHJpY2UpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgX3RvdGFsUHJpY2UgPSBfcHJpY2UgLSBfZGV2Q3V0IC0gKF9kZXZDdXQgLyA0KTsKICAgICAgICB1aW50MjU2IF9leHRyYSA9IG1zZy52YWx1ZSAtIF9wcmljZTsKICAgICAgICAKICAgICAgICBfc2VsbGVyLnRyYW5zZmVyKF90b3RhbFByaWNlKTsKICAgICAgICBfVW5pdGVkT3duZXIudHJhbnNmZXIoKF9kZXZDdXQgLyA0KSk7CiAgICAgICAgCiAgICAgICAgaWYgKF9leHRyYSA+IDApCiAgICAgICAgewogICAgICAgICAgICBUcmFuc2ZlcihfYnV5ZXIsIF9idXllciwgX2NhcmRJbmRleCwgX2V4dHJhKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIF9idXllci50cmFuc2ZlcihfZXh0cmEpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjYXJkc0ZvclNhbGVbX2NhcmRJbmRleF0uc2VsbGVyID0gX2J1eWVyOwogICAgICAgIGNhcmRzRm9yU2FsZVtfY2FyZEluZGV4XS5taW5WYWx1ZSA9IF9uZXh0UHJpY2U7CiAgICAgICAgCiAgICAgICAgaWYgKF9jYXJkSW5kZXggPT0gVW5pdGVkQ2FyZHNGb3JTYWxlW19pbnROYW1lXS5jYXJkSW5kZXgpCiAgICAgICAgICAgIFVuaXRlZENhcmRzRm9yU2FsZVtfaW50TmFtZV0uc2VsbGVyID0gX2J1eWVyOwogICAgICAgIAogICAgICAgIAogICAgICAgIFRyYW5zZmVyKF9idXllciwgX3NlbGxlciwgX2NhcmRJbmRleCwgX3RvdGFsUHJpY2UpOwogICAgICAgIEFzc2lnbihfY2FyZEluZGV4LCBfYnV5ZXIsIF9uZXh0UHJpY2UsIF9pbnROYW1lLCBfbmFtZSk7Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIH0KfQ=='.
	

]
