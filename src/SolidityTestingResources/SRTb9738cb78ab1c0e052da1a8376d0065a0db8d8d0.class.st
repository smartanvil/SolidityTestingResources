Class {
	#name : #SRTb9738cb78ab1c0e052da1a8376d0065a0db8d8d0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb9738cb78ab1c0e052da1a8376d0065a0db8d8d0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKCiAgICB1aW50MjU2IF9hbGxvd2FuY2UgPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXTsKCiAgICAvLyBDaGVjayBpcyBub3QgbmVlZGVkIGJlY2F1c2Ugc3ViKF9hbGxvd2FuY2UsIF92YWx1ZSkgd2lsbCBhbHJlYWR5IHRocm93IGlmIHRoaXMgY29uZGl0aW9uIGlzIG5vdCBtZXQKICAgIC8vIHJlcXVpcmUgKF92YWx1ZSA8PSBfYWxsb3dhbmNlKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCiAgLyoqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gaW5jcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKi8KICBmdW5jdGlvbiBpbmNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdLmFkZChfYWRkZWRWYWx1ZSk7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsIChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpCiAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHVpbnQgb2xkVmFsdWUgPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXTsKICAgIGlmIChfc3VidHJhY3RlZFZhbHVlID4gb2xkVmFsdWUpIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgfSBlbHNlIHsKICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICB9CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0pOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZENyb3dkc2FsZSAKICogQGRldiBTdGFuZGFyZENyb3dkc2FsZSBpcyBhIGJhc2UgY29udHJhY3QgZm9yIG1hbmFnaW5nIGEgdG9rZW4gY3Jvd2RzYWxlLgogKiBDcm93ZHNhbGVzIGhhdmUgYSBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMsIHdoZXJlIGludmVzdG9ycyBjYW4gbWFrZQogKiB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKICogb24gYSB0b2tlbiBwZXIgRVRIIHJhdGUuIEZ1bmRzIGNvbGxlY3RlZCBhcmUgZm9yd2FyZGVkIHRvIGEgd2FsbGV0CiAqIGFzIHRoZXkgYXJyaXZlLgogKi8KY29udHJhY3QgU3RhbmRhcmRDcm93ZHNhbGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKICAgIFN0YW5kYXJkVG9rZW4gcHVibGljIHRva2VuOyAKCiAgICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQgKGJvdGggaW5jbHVzaXZlKQogICAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lOwogICAgdWludDI1NiBwdWJsaWMgZW5kVGltZTsKCiAgICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgICAvLyBob3cgbWFueSB0b2tlbiB1bml0cyBhIGJ1eWVyIGdldHMgcGVyIHdlaQogICAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgICAvLyBhbW91bnQgb2YgcmFpc2VkIG1vbmV5IGluIHdlaQogICAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwoKICAgIC8qKgogICAgICogZXZlbnQgZm9yIHRva2VuIHB1cmNoYXNlIGxvZ2dpbmcKICAgICAqIEBwYXJhbSBwdXJjaGFzZXIgd2hvIHBhaWQgZm9yIHRoZSB0b2tlbnMKICAgICAqIEBwYXJhbSB2YWx1ZSB3ZWlzIHBhaWQgZm9yIHB1cmNoYXNlCiAgICAgKiBAcGFyYW0gYW1vdW50IGFtb3VudCBvZiB0b2tlbnMgcHVyY2hhc2VkCiAgICAgKi8KICAgIGV2ZW50IFRva2VuUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIHB1cmNoYXNlciwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwoKICAgIGZ1bmN0aW9uIFN0YW5kYXJkQ3Jvd2RzYWxlKAogICAgICAgIHVpbnQyNTYgX3N0YXJ0VGltZSwgCiAgICAgICAgdWludDI1NiBfZW5kVGltZSwgCiAgICAgICAgdWludDI1NiBfcmF0ZSwgCiAgICAgICAgYWRkcmVzcyBfd2FsbGV0KSAKICAgIHsKICAgICAgICByZXF1aXJlKF9zdGFydFRpbWUgPj0gbm93KTsKICAgICAgICByZXF1aXJlKF9lbmRUaW1lID49IF9zdGFydFRpbWUpOwogICAgICAgIHJlcXVpcmUoX3JhdGUgPiAwKTsKICAgICAgICByZXF1aXJlKF93YWxsZXQgIT0gMHgwKTsKCiAgICAgICAgc3RhcnRUaW1lID0gX3N0YXJ0VGltZTsKICAgICAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgICAgICAgcmF0ZSA9IF9yYXRlOwogICAgICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICAgICAgCiAgICAgICAgdG9rZW4gPSBjcmVhdGVUb2tlbkNvbnRyYWN0KCk7IAogICAgfQoKICAgIC8vIGNyZWF0ZXMgdGhlIHRva2VuIHRvIGJlIHNvbGQuCiAgICAvLyBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byBoYXZlIGNyb3dkc2FsZSBvZiBhIHNwZWNpZmljIG1pbnRhYmxlIHRva2VuLgogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCgpIAogICAgICAgIGludGVybmFsIAogICAgICAgIHJldHVybnMoU3RhbmRhcmRUb2tlbikgCiAgICB7CiAgICAgICAgcmV0dXJuIG5ldyBTdGFuZGFyZFRva2VuKCk7CiAgICB9CgogICAgLy8gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gYnV5IHRva2VucwogICAgZnVuY3Rpb24gKCkgCiAgICAgICBwYXlhYmxlIAogICAgewogICAgICAgIGJ1eVRva2VucygpOwogICAgfQoKICAgIC8vIGxvdyBsZXZlbCB0b2tlbiBwdXJjaGFzZSBmdW5jdGlvbgogICAgZnVuY3Rpb24gYnV5VG9rZW5zKCkgCiAgICAgICBwdWJsaWMgCiAgICAgICBwYXlhYmxlIAogICAgewogICAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlKTsKICAgICAgICB0b2tlbnMgKz0gZ2V0Qm9udXModG9rZW5zKTsKCiAgICAgICAgLy8gdXBkYXRlIHN0YXRlCiAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwoKICAgICAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRva2VucykpOyAKICAgICAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIHdlaUFtb3VudCwgdG9rZW5zKTsKCiAgICAgICAgZm9yd2FyZEZ1bmRzKCk7CgogICAgICAgIHBvc3RCdXlUb2tlbnMoKTsKICAgIH0KCiAgICAvLyBBY3Rpb24gYWZ0ZXIgYnV5aW5nIHRva2VucwogICAgZnVuY3Rpb24gcG9zdEJ1eVRva2VucyAoKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICB9CgogICAgLy8gc2VuZCBldGhlciB0byB0aGUgZnVuZCBjb2xsZWN0aW9uIHdhbGxldAogICAgLy8gb3ZlcnJpZGUgdG8gY3JlYXRlIGN1c3RvbSBmdW5kIGZvcndhcmRpbmcgbWVjaGFuaXNtcwogICAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgCiAgICAgICBpbnRlcm5hbCAKICAgIHsKICAgICAgICB3YWxsZXQudHJhbnNmZXIobXNnLnZhbHVlKTsKICAgIH0KCiAgICAvLyBAcmV0dXJuIHRydWUgaWYgdGhlIHRyYW5zYWN0aW9uIGNhbiBidXkgdG9rZW5zCiAgICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgCiAgICAgICAgaW50ZXJuYWwgCiAgICAgICAgcmV0dXJucyhib29sKSAKICAgIHsKICAgICAgICBib29sIHdpdGhpblBlcmlvZCA9IG5vdyA+PSBzdGFydFRpbWUgJiYgbm93IDw9IGVuZFRpbWU7CiAgICAgICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgICAgICByZXR1cm4gd2l0aGluUGVyaW9kICYmIG5vblplcm9QdXJjaGFzZTsKICAgIH0KCiAgICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogICAgZnVuY3Rpb24gaGFzRW5kZWQoKSAKICAgICAgICBwdWJsaWMgCiAgICAgICAgY29uc3RhbnQgCiAgICAgICAgcmV0dXJucyhib29sKSAKICAgIHsKICAgICAgICByZXR1cm4gbm93ID4gZW5kVGltZTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QmVmb3JlU2FsZSgpIHsKICAgICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5MjRIQmVmb3JlU2FsZSgpIHsKICAgICAgICByZXF1aXJlKG5vdyA8IHN0YXJ0VGltZS5zdWIoMSBkYXlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCb251cyh1aW50MjU2IF90b2tlbnMpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYm9udXMpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBDYXBwZWRDcm93ZHNhbGUKICogQGRldiBFeHRlbnNpb24gb2YgQ3Jvd2RzYWxlIHdpdGggYSBtYXggYW1vdW50IG9mIGZ1bmRzIHJhaXNlZAogKi8KY29udHJhY3QgQ2FwcGVkQ3Jvd2RzYWxlIGlzIFN0YW5kYXJkQ3Jvd2RzYWxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgdWludDI1NiBwdWJsaWMgY2FwOwoKICBmdW5jdGlvbiBDYXBwZWRDcm93ZHNhbGUodWludDI1NiBfY2FwKSB7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIGNhcCA9IF9jYXA7CiAgfQoKICAvLyBvdmVycmlkaW5nIENyb3dkc2FsZSN2YWxpZFB1cmNoYXNlIHRvIGFkZCBleHRyYSBjYXAgbG9naWMKICAvLyBAcmV0dXJuIHRydWUgaWYgaW52ZXN0b3JzIGNhbiBidXkgYXQgdGhlIG1vbWVudAogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICBib29sIHdpdGhpbkNhcCA9IHdlaVJhaXNlZC5hZGQobXNnLnZhbHVlKSA8PSBjYXA7CiAgICByZXR1cm4gc3VwZXIudmFsaWRQdXJjaGFzZSgpICYmIHdpdGhpbkNhcDsKICB9CgogIC8vIG92ZXJyaWRpbmcgQ3Jvd2RzYWxlI2hhc0VuZGVkIHRvIGFkZCBjYXAgbG9naWMKICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgY2FwUmVhY2hlZCA9IHdlaVJhaXNlZCA+PSBjYXA7CiAgICByZXR1cm4gc3VwZXIuaGFzRW5kZWQoKSB8fCBjYXBSZWFjaGVkOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgVGhlIE1JTkRUb2tlbiBjb250cmFjdAogKiBAZGV2IFRoZSBNSU5EVG9rZW4gVG9rZW4gY29udHJhY3QKICogQGRldiBpbmhlcml0ZSBmcm9tIFN0YW5kYXJkVG9rZW4gYW5kIE93bmFibGUgYnkgWmVwcGVsaW4KICovCmNvbnRyYWN0IE1JTkRUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICAgIHN0cmluZyAgcHVibGljICBjb25zdGFudCBuYW1lID0gIk1JTkQgVG9rZW4iOwogICAgc3RyaW5nICBwdWJsaWMgIGNvbnN0YW50IHN5bWJvbCA9ICJNSU5EIjsKICAgIHVpbnQ4ICAgIHB1YmxpYyAgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICB1aW50ICAgIHB1YmxpYyAgdHJhbnNmZXJhYmxlU3RhcnRUaW1lOwoKICAgIGFkZHJlc3MgcHVibGljICB0b2tlblNhbGVDb250cmFjdDsKICAgIGFkZHJlc3MgcHVibGljICBmdWxsVG9rZW5XYWxsZXQ7CgogICAgZnVuY3Rpb24gZ2V0dHJhbnNmZXJhYmxlU3RhcnRUaW1lKCkgY29uc3RhbnQgcmV0dXJucyAodWludCl7cmV0dXJuIG5vdyAtIHRyYW5zZmVyYWJsZVN0YXJ0VGltZTt9CgogICAgbW9kaWZpZXIgb25seVdoZW5UcmFuc2ZlckVuYWJsZWQoKSAKICAgIHsKICAgICAgICBpZiAoIG5vdyA8IHRyYW5zZmVyYWJsZVN0YXJ0VGltZSApIHsKICAgICAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHRva2VuU2FsZUNvbnRyYWN0IHx8IG1zZy5zZW5kZXIgPT0gZnVsbFRva2VuV2FsbGV0IHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIH0KICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkRGVzdGluYXRpb24oYWRkcmVzcyB0bykgCiAgICB7CiAgICAgICAgcmVxdWlyZSh0byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlTYWxlQ29udHJhY3QoKQogICAgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSB0b2tlblNhbGVDb250cmFjdCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBNSU5EVG9rZW4oCiAgICAgICAgdWludCB0b2tlblRvdGFsQW1vdW50LCAKICAgICAgICB1aW50IF90cmFuc2ZlcmFibGVTdGFydFRpbWUsIAogICAgICAgIGFkZHJlc3MgX2FkbWluLCAKICAgICAgICBhZGRyZXNzIF9mdWxsVG9rZW5XYWxsZXQpIAogICAgewogICAgICAgIAogICAgICAgIC8vIE1pbnQgYWxsIHRva2Vucy4gVGhlbiBkaXNhYmxlIG1pbnRpbmcgZm9yZXZlci4KICAgICAgICB0b3RhbFN1cHBseSA9IHRva2VuVG90YWxBbW91bnQgKiAoMTAgKiogdWludDI1NihkZWNpbWFscykpOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OwogICAgICAgIFRyYW5zZmVyKGFkZHJlc3MoMHgwKSwgbXNnLnNlbmRlciwgdG90YWxTdXBwbHkpOwoKICAgICAgICB0cmFuc2ZlcmFibGVTdGFydFRpbWUgPSBfdHJhbnNmZXJhYmxlU3RhcnRUaW1lOwogICAgICAgIHRva2VuU2FsZUNvbnRyYWN0ID0gbXNnLnNlbmRlcjsKICAgICAgICBmdWxsVG9rZW5XYWxsZXQgPSBfZnVsbFRva2VuV2FsbGV0OwoKICAgICAgICB0cmFuc2Zlck93bmVyc2hpcChfYWRtaW4pOyAvLyBhZG1pbiBjb3VsZCBkcmFpbiB0b2tlbnMgYW5kIGV0aCB0aGF0IHdlcmUgc2VudCBoZXJlIGJ5IG1pc3Rha2UKCiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IG92ZXJyaWRlIHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzIHRvIGFkZCBvbmx5V2hlblRyYW5zZmVyRW5hYmxlZCBhbmQgdmFsaWREZXN0aW5hdGlvbgogICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkRGVzdGluYXRpb24oX3RvKQogICAgICAgIG9ubHlXaGVuVHJhbnNmZXJFbmFibGVkCiAgICAgICAgcmV0dXJucyAoYm9vbCkgCiAgICB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgb3ZlcnJpZGUgdHJhbnNmZXJGcm9tIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzIHRvIGFkZCBvbmx5V2hlblRyYW5zZmVyRW5hYmxlZCBhbmQgdmFsaWREZXN0aW5hdGlvbgogICAgICogQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIGZyb20uCiAgICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkRGVzdGluYXRpb24oX3RvKQogICAgICAgIG9ubHlXaGVuVHJhbnNmZXJFbmFibGVkCiAgICAgICAgcmV0dXJucyAoYm9vbCkgCiAgICB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIF9idXJuZXIsIHVpbnQgX3ZhbHVlKTsKCiAgICAvKioKICAgICAqIEBkZXYgYnVybiB0b2tlbnMKICAgICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSBidXJuZWQuCiAgICAgKiBAcmV0dXJuIGFsd2F5cyB0cnVlIChuZWNlc3NhcnkgaW4gY2FzZSBvZiBvdmVycmlkZSkKICAgICAqLwogICAgZnVuY3Rpb24gYnVybih1aW50IF92YWx1ZSkgCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdoZW5UcmFuc2ZlckVuYWJsZWQKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX3ZhbHVlKTsKICAgICAgICBCdXJuKG1zZy5zZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgYWRkcmVzcygweDApLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBidXJuIHRva2VucyBpbiB0aGUgYmVoYWxmIG9mIHNvbWVvbmUKICAgICAqIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBvZiB0aGUgb3duZXIgb2YgdGhlIHRva2VuLgogICAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIGJ1cm5lZC4KICAgICAqIEByZXR1cm4gYWx3YXlzIHRydWUgKG5lY2Vzc2FyeSBpbiBjYXNlIG9mIG92ZXJyaWRlKQogICAgICovCiAgICBmdW5jdGlvbiBidXJuRnJvbShhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSkgCiAgICAgICAgcHVibGljCiAgICAgICAgb25seVdoZW5UcmFuc2ZlckVuYWJsZWQKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zKGJvb2wpIAogICAgewogICAgICAgIGFzc2VydCh0cmFuc2ZlckZyb20oX2Zyb20sIG1zZy5zZW5kZXIsIF92YWx1ZSkpOwogICAgICAgIHJldHVybiBidXJuKF92YWx1ZSk7CiAgICB9CgogICAgLyoqIAogICAgKiBlbmFibGUgdHJhbnNmZXIgZWFybGllciAob25seSBwcmVzYWxlIGNvbnRyYWN0IGNhbiBlbmFibGUgdGhlIHNhbGUgZWFybGllcikKICAgICovCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlckVhcmxpZXIgKCkKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5U2FsZUNvbnRyYWN0CiAgICB7CiAgICAgICAgdHJhbnNmZXJhYmxlU3RhcnRUaW1lID0gbm93ICsgMyBkYXlzOwogICAgfQoKCiAgICAvKioKICAgICAqIEBkZXYgdHJhbnNmZXIgdG8gb3duZXIgYW55IHRva2VucyBzZW5kIGJ5IG1pc3Rha2Ugb24gdGhpcyBjb250cmFjdHMKICAgICAqIEBwYXJhbSB0b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gYW1vdW50IFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJlZC4KICAgICAqLwogICAgZnVuY3Rpb24gZW1lcmdlbmN5RVJDMjBEcmFpbihFUkMyMCB0b2tlbiwgdWludCBhbW91bnQgKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlPd25lciAKICAgIHsKICAgICAgICB0b2tlbi50cmFuc2Zlcihvd25lciwgYW1vdW50KTsKICAgIH0KCn0KCi8qKgogKiBAdGl0bGUgTUlORFRva2VuQ3Jvd2RTYWxlCiAqIEBkZXYgCiAqIFdlIGFkZCBuZXcgZmVhdHVyZXMgdG8gYSBiYXNlIGNyb3dkc2FsZSB1c2luZyBtdWx0aXBsZSBpbmhlcml0YW5jZS4KICogV2UgYXJlIHVzaW5nIHRoZSBmb2xsb3dpbmcgZXh0ZW5zaW9uczoKICogQ2FwcGVkQ3Jvd2RzYWxlIC0gc2V0cyBhIG1heCBib3VuZGFyeSBmb3IgcmFpc2VkIGZ1bmRzCiAqCiAqIFRoZSBjb2RlIGlzIGJhc2VkIG9uIHRoZSBjb250cmFjdHMgb2YgT3BlbiBaZXBwZWxpbiBhbmQgd2UgYWRkIG91ciBjb250cmFjdHMgOiBNSU5EVG9rZW5Dcm93ZFNhbGUgYW5kIHRoZSBNSU5EIFRva2VuCiAqCiAqLwpjb250cmFjdCBNSU5EVG9rZW5Dcm93ZFNhbGUgaXMgT3duYWJsZSwgQ2FwcGVkQ3Jvd2RzYWxlIHsKCiAgICAvLyBoYXJkIGNhcCBvZiB0aGUgdG9rZW4gcHJlLXNhbGUgaW4gZXRoZXIKICAgIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBIQVJEX0NBUF9JTl9XRUkgPSAyMDAwIGV0aGVyOwogICAgCiAgICAvLyBUb2tlbiBzYWxlIHJhdGUgZnJvbSBFVEggdG8gTUlORAogICAgdWludCBwcml2YXRlIGNvbnN0YW50IFJBVEVfRVRIX01JTkQgPSAxMDAwMDsKCiAgICAvLyB3YWxsZXQgdXNlIGFsc28gdG8gZ2F0aGVyIHRoZSBldGhlciBvZiB0aGUgdG9rZW4gc2FsZQogICAgYWRkcmVzcyBwcml2YXRlIGNvbnN0YW50IE1JTkRfQ1JPV0RTQUxFX1dBTExFVCA9IDB4OTQyYjU2RTVBNmU5MkIzOTY0M2RDQjVGMjMyRUY1ODM2ODBGMEIwMTsKCiAgICBldmVudCBDcm93ZFNhbGVUb2tlblNvbGRvdXQoKTsKCiAgICBmdW5jdGlvbiBNSU5EVG9rZW5Dcm93ZFNhbGUodWludDI1NiBfc3RhcnRUaW1lLCB1aW50MjU2IF9lbmRUaW1lLCBhZGRyZXNzIF90b2tlbkFkZHIpCiAgICAgIENhcHBlZENyb3dkc2FsZShIQVJEX0NBUF9JTl9XRUkpCiAgICAgIFN0YW5kYXJkQ3Jvd2RzYWxlKF9zdGFydFRpbWUsIF9lbmRUaW1lLCBSQVRFX0VUSF9NSU5ELCBNSU5EX0NST1dEU0FMRV9XQUxMRVQpCiAgICB7CiAgICAgICAgdG9rZW4gPSBNSU5EVG9rZW4oX3Rva2VuQWRkcik7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VG9rZW4oKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgcmV0dXJuIHRva2VuOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDcmVhdGUgdGhlIE1JTkQgdG9rZW4gKG92ZXJyaWRlIGNyZWF0ZVRva2VuQ29udHJhY3Qgb2YgU3RhbmRhcmRDcm93ZHNhbGUpCiAgICAgKiBAcmV0dXJuIHRoZSBTdGFuZGFyZFRva2VuIGNyZWF0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW5Db250cmFjdCAoKSAKICAgICAgaW50ZXJuYWwgCiAgICAgIHJldHVybnMoU3RhbmRhcmRUb2tlbikgCiAgICB7CiAgICAgICAgcmV0dXJuIE1JTkRUb2tlbigweDApOyAvLyBObyB0b2tlbiBpcyBjcmVhdGVkCiAgICB9CgogICAgLyoqCiAgICAgICogQGRldiBHZXQgdGhlIGJvbnVzIGJhc2VkIG9uIHRoZSBidXkgdGltZSAob3ZlcnJpZGUgZ2V0Qm9udXMgb2YgU3RhbmRhcmRDcm93ZHNhbGUpCiAgICAgICogQHJldHVybiB0aGUgbnVtYmVyIG9mIGJvbnVzIHRva2VuCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0Qm9udXModWludDI1NiBfdG9rZW5zKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJvbnVzKSB7CiAgICAgICAgcmVxdWlyZShfdG9rZW5zICE9IDApOwogICAgICAgIGlmIChzdGFydFRpbWUgPD0gbm93ICYmIG5vdyA8IHN0YXJ0VGltZSArIDEgZGF5cykgewogICAgICAgICAgICAvLyAyMCUgYm9udXMKICAgICAgICAgICAgcmV0dXJuIF90b2tlbnMuZGl2KDUpOwogICAgICAgIH0gZWxzZSBpZiAoc3RhcnRUaW1lICsgMSBkYXlzIDw9IG5vdyAmJiBub3cgPCBzdGFydFRpbWUgKyAyIGRheXMgKSB7CiAgICAgICAgICAgIC8vIDE1JSBib251cwogICAgICAgICAgICByZXR1cm4gX3Rva2Vucy5tdWwoMykuZGl2KDIwKTsKICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0VGltZSArIDIgZGF5cyA8PSBub3cgJiYgbm93IDwgc3RhcnRUaW1lICsgMyBkYXlzICkgewogICAgICAgICAgICAvLyAxMCUgYm9udXMKICAgICAgICAgICAgcmV0dXJuIF90b2tlbnMuZGl2KDEwKTsKICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0VGltZSArIDMgZGF5cyA8PSBub3cgJiYgbm93IDwgc3RhcnRUaW1lICsgNCBkYXlzICkgewogICAgICAgICAgICAvLyA1JSBib251cwogICAgICAgICAgICByZXR1cm4gX3Rva2Vucy5kaXYoMjApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFRyYW5zZmVyIHRoZSB1bnNvbGQgdG9rZW5zIHRvIHRoZSBNSU5EIEZvdW5kYXRpb24gbXVsdGlzaWduIHdhbGxldCAKICAgICAqIEBkZXYgT25seSBmb3Igb3duZXIKICAgICAqIEByZXR1cm4gdGhlIFN0YW5kYXJkVG9rZW4gY3JlYXRlZAogICAgICovCiAgICBmdW5jdGlvbiBkcmFpblJlbWFpbmluZ1Rva2VuICgpIAogICAgICBwdWJsaWMKICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZShoYXNFbmRlZCgpKTsKICAgICAgICB0b2tlbi50cmFuc2ZlcihNSU5EX0NST1dEU0FMRV9XQUxMRVQsIHRva2VuLmJhbGFuY2VPZih0aGlzKSk7CiAgICB9CgoKICAgIC8qKgogICAgICAqIEBkZXYgQWN0aW9uIGFmdGVyIGJ1eWluZyB0b2tlbnM6IGNoZWNrIGlmIGFsbCBzb2xkIG91dCBhbmQgZW5hYmxlIHRyYW5zZmVyIGltbWVkaWF0ZWx5CiAgICAgICovCiAgICBmdW5jdGlvbiBwb3N0QnV5VG9rZW5zICgpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICBpZiAoIHRva2VuLmJhbGFuY2VPZih0aGlzKSA9PSAwICkgCiAgICAgICAgewogICAgICAgICAgICBDcm93ZFNhbGVUb2tlblNvbGRvdXQoKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIAogICAgICAgIGludGVybmFsIAogICAgICAgIHJldHVybnMoYm9vbCkgCiAgICB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnZhbGlkUHVyY2hhc2UoKSAmJiBtc2cudmFsdWUgPj0gMC4xIGV0aGVyOwogICAgfQp9'.
	

]
