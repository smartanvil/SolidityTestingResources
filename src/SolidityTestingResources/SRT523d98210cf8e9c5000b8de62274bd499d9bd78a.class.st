Class {
	#name : #SRT523d98210cf8e9c5000b8de62274bd499d9bd78a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT523d98210cf8e9c5000b8de62274bd499d9bd78a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogRGVhbEJveCBDcm93ZHNhbGUgQ29udHJhY3QKICoKICogVGhpcyBpcyB0aGUgY3Jvd2RzYWxlIGNvbnRyYWN0IGZvciB0aGUgRExCWCBUb2tlbi4gSXQgdXRpbGl6ZXMgTWFqb29scidzCiAqIENyb3dkc2FsZUxpYiBsaWJyYXJ5IHRvIHJlZHVjZSBjdXN0b20gc291cmNlIGNvZGUgc3VyZmFjZSBhcmVhIGFuZCBpbmNyZWFzZQogKiBvdmVyYWxsIHNlY3VyaXR5Lk1ham9vbHIgcHJvdmlkZXMgc21hcnQgY29udHJhY3Qgc2VydmljZXMgYW5kIHNlY3VyaXR5IHJldmlld3MKICogZm9yIGNvbnRyYWN0IGRlcGxveW1lbnRzIGluIGFkZGl0aW9uIHRvIHdvcmtpbmcgb24gb3BlbiBzb3VyY2UgcHJvamVjdHMgaW4gdGhlCiAqIEV0aGVyZXVtIGNvbW11bml0eS4KICogRm9yIGZ1cnRoZXIgaW5mb3JtYXRpb246IGRsYnguaW8sIG1ham9vbHIuaW8KICoKICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MKICogT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgogKiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuCiAqIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZCiAqIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsCiAqIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFCiAqIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgogKi8KCmNvbnRyYWN0IERMQlhDcm93ZHNhbGUgewogIHVzaW5nIERpcmVjdENyb3dkc2FsZUxpYiBmb3IgRGlyZWN0Q3Jvd2RzYWxlTGliLkRpcmVjdENyb3dkc2FsZVN0b3JhZ2U7CgogIERpcmVjdENyb3dkc2FsZUxpYi5EaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHNhbGU7CiAgdWludDI1NiBwdWJsaWMgZGlzY291bnRFbmRUaW1lOwoKICBmdW5jdGlvbiBETEJYQ3Jvd2RzYWxlKAogICAgICAgICAgICAgICAgYWRkcmVzcyBvd25lciwKICAgICAgICAgICAgICAgIHVpbnQyNTZbXSBzYWxlRGF0YSwgICAgICAgICAgIC8vIFsxNTA5OTM3MjAwLCA2NSwgMF0KICAgICAgICAgICAgICAgIHVpbnQyNTYgZmFsbGJhY2tFeGNoYW5nZVJhdGUsIC8vIDI4NjAwCiAgICAgICAgICAgICAgICB1aW50MjU2IGNhcEFtb3VudEluQ2VudHMsICAgICAvLyAzMDAwMDAwMDAwMAogICAgICAgICAgICAgICAgdWludDI1NiBlbmRUaW1lLCAgICAgICAgICAgICAgLy8gMTUxNjQxNzIwMAogICAgICAgICAgICAgICAgdWludDggcGVyY2VudEJ1cm4sICAgICAgICAgICAgLy8gMTAwCiAgICAgICAgICAgICAgICB1aW50MjU2IF9kaXNjb3VudEVuZFRpbWUsICAgICAvLyAxNTEzNzM4ODAwCiAgICAgICAgICAgICAgICBDcm93ZHNhbGVUb2tlbiB0b2tlbikgICAgICAgICAvLyAweGFiZTljZTViZTU0ZGUyZDU4ODY2NWI4YTRmOGM1NDg5ZDhkNTE1MDIKICB7CiAgCXNhbGUuaW5pdChvd25lciwgc2FsZURhdGEsIGZhbGxiYWNrRXhjaGFuZ2VSYXRlLCBjYXBBbW91bnRJbkNlbnRzLCBlbmRUaW1lLCBwZXJjZW50QnVybiwgdG9rZW4pOwogICAgZGlzY291bnRFbmRUaW1lID0gX2Rpc2NvdW50RW5kVGltZTsKICB9CgogIC8vRXZlbnRzCiAgZXZlbnQgTG9nVG9rZW5zQm91Z2h0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IExvZ0FkZHJlc3NDYXBFeGNlZWRlZChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKICBldmVudCBMb2dFcnJvck1zZyh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nVG9rZW5QcmljZUNoYW5nZSh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nVG9rZW5zV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfYmlkZGVyLCB1aW50MjU2IEFtb3VudCk7CiAgZXZlbnQgTG9nV2VpV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfYmlkZGVyLCB1aW50MjU2IEFtb3VudCk7CiAgZXZlbnQgTG9nT3duZXJFdGhXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nTm90aWNlTXNnKGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IHZhbHVlLCBzdHJpbmcgTXNnKTsKCiAgLy8gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gYnV5IHRva2VucwogIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgc2VuZFB1cmNoYXNlKCk7CiAgfQoKICBmdW5jdGlvbiBzZW5kUHVyY2hhc2UoKSBwYXlhYmxlIHJldHVybnMgKGJvb2wpIHsKICAgIGlmIChub3cgPiBkaXNjb3VudEVuZFRpbWUpewogICAgICBpZihtc2cudmFsdWUgPCAxNjY2NjY2NjY2NjY2NjY2NjY2Nil7CiAgICAgICAgc2FsZS5iYXNlLnRva2Vuc1BlckV0aCA9IDQwMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzYWxlLmJhc2UudG9rZW5zUGVyRXRoID0gNjAwOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZihtc2cudmFsdWUgPCAxNDMzMzMzMzMzMzMzMzMzMzMzMyl7CiAgICAgICAgc2FsZS5iYXNlLnRva2Vuc1BlckV0aCA9IDQ2MjsKICAgICAgfSBlbHNlIHsKICAgICAgICBzYWxlLmJhc2UudG9rZW5zUGVyRXRoID0gNjk4OwogICAgICB9CiAgICB9CiAgCXJldHVybiBzYWxlLnJlY2VpdmVQdXJjaGFzZShtc2cudmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoKSByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBzYWxlLndpdGhkcmF3VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiB3aXRoZHJhd0xlZnRvdmVyV2VpKCkgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNhbGUud2l0aGRyYXdMZWZ0b3ZlcldlaSgpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aCgpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLndpdGhkcmF3T3duZXJFdGgoKTsKICB9CgogIGZ1bmN0aW9uIGNyb3dkc2FsZUFjdGl2ZSgpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLmNyb3dkc2FsZUFjdGl2ZSgpOwogIH0KCiAgZnVuY3Rpb24gY3Jvd2RzYWxlRW5kZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZS5jcm93ZHNhbGVFbmRlZCgpOwogIH0KCiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUodWludDI1NiBfZXhjaGFuZ2VSYXRlKSByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc2FsZS5zZXRUb2tlbkV4Y2hhbmdlUmF0ZShfZXhjaGFuZ2VSYXRlKTsKICB9CgogIGZ1bmN0aW9uIHNldFRva2VucygpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzYWxlLnNldFRva2VucygpOwogIH0KCiAgZnVuY3Rpb24gZ2V0T3duZXIoKSBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzKSB7CiAgICByZXR1cm4gc2FsZS5iYXNlLm93bmVyOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zUGVyRXRoKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKG5vdyA+IGRpc2NvdW50RW5kVGltZSl7CiAgICAgIHJldHVybiA0MDA7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gNDYxOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0RXhjaGFuZ2VSYXRlKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5leGNoYW5nZVJhdGU7CiAgfQoKICBmdW5jdGlvbiBnZXRDYXBBbW91bnQoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIHJldHVybiBzYWxlLmJhc2UuY2FwQW1vdW50OwogIH0KCiAgZnVuY3Rpb24gZ2V0U3RhcnRUaW1lKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5zdGFydFRpbWU7CiAgfQoKICBmdW5jdGlvbiBnZXRFbmRUaW1lKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5lbmRUaW1lOwogIH0KCiAgZnVuY3Rpb24gZ2V0RXRoUmFpc2VkKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5vd25lckJhbGFuY2U7CiAgfQoKICBmdW5jdGlvbiBnZXRDb250cmlidXRpb24oYWRkcmVzcyBfYnV5ZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAJcmV0dXJuIHNhbGUuYmFzZS5oYXNDb250cmlidXRlZFtfYnV5ZXJdOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5QdXJjaGFzZShhZGRyZXNzIF9idXllcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogIAlyZXR1cm4gc2FsZS5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW19idXllcl07CiAgfQoKICBmdW5jdGlvbiBnZXRMZWZ0b3ZlcldlaShhZGRyZXNzIF9idXllcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5sZWZ0b3ZlcldlaVtfYnV5ZXJdOwogIH0KCiAgZnVuY3Rpb24gZ2V0U2FsZURhdGEoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAobm93ID4gZGlzY291bnRFbmRUaW1lKXsKICAgICAgcmV0dXJuIDc1OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIDY1OwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzYWxlLmJhc2Uuc3RhcnRpbmdUb2tlbkJhbGFuY2UgLSBzYWxlLmJhc2Uud2l0aGRyYXdUb2tlbnNNYXBbc2FsZS5iYXNlLm93bmVyXTsKICB9CgogIGZ1bmN0aW9uIGdldFBlcmNlbnRCdXJuKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNhbGUuYmFzZS5wZXJjZW50QnVybjsKICB9Cn0KCmxpYnJhcnkgRGlyZWN0Q3Jvd2RzYWxlTGliIHsKICB1c2luZyBCYXNpY01hdGhMaWIgZm9yIHVpbnQyNTY7CiAgdXNpbmcgQ3Jvd2RzYWxlTGliIGZvciBDcm93ZHNhbGVMaWIuQ3Jvd2RzYWxlU3RvcmFnZTsKCiAgc3RydWN0IERpcmVjdENyb3dkc2FsZVN0b3JhZ2UgewoKICAJQ3Jvd2RzYWxlTGliLkNyb3dkc2FsZVN0b3JhZ2UgYmFzZTsgLy8gYmFzZSBzdG9yYWdlIGZyb20gQ3Jvd2RzYWxlTGliCgogIH0KCiAgZXZlbnQgTG9nVG9rZW5zQm91Z2h0KGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IExvZ0FkZHJlc3NDYXBFeGNlZWRlZChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgYW1vdW50LCBzdHJpbmcgTXNnKTsKICBldmVudCBMb2dFcnJvck1zZyh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CiAgZXZlbnQgTG9nVG9rZW5QcmljZUNoYW5nZSh1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CgoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIGNlbnRzIGF0IHRoYXQgdGltZSwKICAvLy8gMyBpcyBhZGRyZXNzIHB1cmNoYXNlIGNhcCBhdCB0aGF0IHRpbWUsIDAgaWYgbm8gYWRkcmVzcyBjYXAKICAvLy8gQHBhcmFtIF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSBFeGNoYW5nZSByYXRlIG9mIGNlbnRzL0VUSAogIC8vLyBAcGFyYW0gX2NhcEFtb3VudEluQ2VudHMgVG90YWwgdG8gYmUgcmFpc2VkIGluIGNlbnRzCiAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaW1lc3RhbXAgb2Ygc2FsZSBlbmQgdGltZQogIC8vLyBAcGFyYW0gX3BlcmNlbnRCdXJuIFBlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHBhcmFtIF90b2tlbiBUb2tlbiBiZWluZyBzb2xkCiAgZnVuY3Rpb24gaW5pdChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICB1aW50OCBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICBDcm93ZHNhbGVUb2tlbiBfdG9rZW4pCiAgewogIAlzZWxmLmJhc2UuaW5pdChfb3duZXIsCiAgICAgICAgICAgICAgICBfc2FsZURhdGEsCiAgICAgICAgICAgICAgICBfZmFsbGJhY2tFeGNoYW5nZVJhdGUsCiAgICAgICAgICAgICAgICBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIF9lbmRUaW1lLAogICAgICAgICAgICAgICAgX3BlcmNlbnRCdXJuLAogICAgICAgICAgICAgICAgX3Rva2VuKTsKICB9CgogIC8vLyBAZGV2IENhbGxlZCB3aGVuIGFuIGFkZHJlc3Mgd2FudHMgdG8gcHVyY2hhc2UgdG9rZW5zCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIF9hbW91bnQgYW1vdW50IG9mIHdlaSB0aGF0IHRoZSBidXllciBpcyBzZW5kaW5nCiAgLy8vIEByZXR1cm4gdHJ1ZSBvbiBzdWNjZXNmdWwgcHVyY2hhc2UKICBmdW5jdGlvbiByZWNlaXZlUHVyY2hhc2UoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IHNlbGYuYmFzZS5vd25lcik7CiAgCXJlcXVpcmUoc2VsZi5iYXNlLnZhbGlkUHVyY2hhc2UoKSk7CgogICAgcmVxdWlyZSgoc2VsZi5iYXNlLm93bmVyQmFsYW5jZSArIF9hbW91bnQpIDw9IHNlbGYuYmFzZS5jYXBBbW91bnQpOwoKICAJLy8gaWYgdGhlIHRva2VuIHByaWNlIGluY3JlYXNlIGludGVydmFsIGhhcyBwYXNzZWQsIHVwZGF0ZSB0aGUgY3VycmVudCBkYXkgYW5kIGNoYW5nZSB0aGUgdG9rZW4gcHJpY2UKICAJaWYgKChzZWxmLmJhc2UubWlsZXN0b25lVGltZXMubGVuZ3RoID4gc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxKSAmJgogICAgICAgIChub3cgPiBzZWxmLmJhc2UubWlsZXN0b25lVGltZXNbc2VsZi5iYXNlLmN1cnJlbnRNaWxlc3RvbmUgKyAxXSkpCiAgICB7CiAgICAgICAgd2hpbGUoKHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lcy5sZW5ndGggPiBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDEpICYmCiAgICAgICAgICAgICAgKG5vdyA+IHNlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArIDFdKSkKICAgICAgICB7CiAgICAgICAgICBzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZSArPSAxOwogICAgICAgIH0KCiAgICAgICAgc2VsZi5iYXNlLmNoYW5nZVRva2VuUHJpY2Uoc2VsZi5iYXNlLnNhbGVEYXRhW3NlbGYuYmFzZS5taWxlc3RvbmVUaW1lc1tzZWxmLmJhc2UuY3VycmVudE1pbGVzdG9uZV1dWzBdKTsKICAgICAgICBMb2dUb2tlblByaWNlQ2hhbmdlKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgsIlRva2VuIFByaWNlIGhhcyBjaGFuZ2VkISIpOwogICAgfQoKICAJdWludDI1NiBfbnVtVG9rZW5zOyAvL251bWJlciBvZiB0b2tlbnMgdGhhdCB3aWxsIGJlIHB1cmNoYXNlZAogICAgdWludDI1NiBfbmV3QmFsYW5jZTsgLy90aGUgbmV3IGJhbGFuY2Ugb2YgdGhlIG93bmVyIG9mIHRoZSBjcm93ZHNhbGUKICAgIHVpbnQyNTYgX3dlaVRva2VuczsgLy90ZW1wIGNhbGMgaG9sZGVyCiAgICB1aW50MjU2IF96ZXJvczsgLy9mb3IgY2FsY3VsYXRpbmcgdG9rZW4KICAgIHVpbnQyNTYgX2xlZnRvdmVyV2VpOyAvL3dlaSBjaGFuZ2UgZm9yIHB1cmNoYXNlcgogICAgdWludDI1NiBfcmVtYWluZGVyOyAvL3RlbXAgY2FsYyBob2xkZXIKICAgIGJvb2wgZXJyOwoKICAgIC8vIEZpbmQgdGhlIG51bWJlciBvZiB0b2tlbnMgYXMgYSBmdW5jdGlvbiBpbiB3ZWkKICAgIChlcnIsX3dlaVRva2VucykgPSBfYW1vdW50LnRpbWVzKHNlbGYuYmFzZS50b2tlbnNQZXJFdGgpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBpZihzZWxmLmJhc2UudG9rZW5EZWNpbWFscyA8PSAxOCl7CiAgICAgIF9udW1Ub2tlbnMgPSBfd2VpVG9rZW5zLzEwMDAwMDAwMDAwMDAwMDAwMDA7CiAgICAgIF9sZWZ0b3ZlcldlaSA9IF93ZWlUb2tlbnMgJSAxMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgICBfbGVmdG92ZXJXZWkgPSBfbGVmdG92ZXJXZWkvc2VsZi5iYXNlLnRva2Vuc1BlckV0aDsKICAgICAgc2VsZi5iYXNlLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdICs9IF9sZWZ0b3ZlcldlaTsKICAgIH0gZWxzZSB7CiAgICAgIF96ZXJvcyA9IDEwKioodWludDI1NihzZWxmLmJhc2UudG9rZW5EZWNpbWFscyktMTgpOwogICAgICBfbnVtVG9rZW5zID0gX3dlaVRva2VucypfemVyb3M7CiAgICB9CgogICAgLy8gY2FuJ3Qgb3ZlcmZsb3cgYmVjYXVzZSBpdCBpcyB1bmRlciB0aGUgY2FwCiAgICBzZWxmLmJhc2UuaGFzQ29udHJpYnV0ZWRbbXNnLnNlbmRlcl0gKz0gX2Ftb3VudCAtIF9sZWZ0b3ZlcldlaTsKCiAgICByZXF1aXJlKF9udW1Ub2tlbnMgPD0gc2VsZi5iYXNlLnRva2VuLmJhbGFuY2VPZih0aGlzKSk7CgogICAgLy8gY2FsY3VsYXRlIHRoZSBhbW91bnQgb2YgZXRoZXIgaW4gdGhlIG93bmVycyBiYWxhbmNlCiAgICAoZXJyLF9uZXdCYWxhbmNlKSA9IHNlbGYuYmFzZS5vd25lckJhbGFuY2UucGx1cyhfYW1vdW50LV9sZWZ0b3ZlcldlaSk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYuYmFzZS5vd25lckJhbGFuY2UgPSBfbmV3QmFsYW5jZTsgICAvLyAiZGVwb3NpdCIgdGhlIGFtb3VudAoKICAgIC8vIGNhbid0IG92ZXJmbG93IGJlY2F1c2UgaXQgd2lsbCBiZSB1bmRlciB0aGUgY2FwCgkgIHNlbGYuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSArPSBfbnVtVG9rZW5zOwoKICAgIC8vc3VidHJhY3QgdG9rZW5zIGZyb20gb3duZXIncyBzaGFyZQogICAgKGVycixfcmVtYWluZGVyKSA9IHNlbGYuYmFzZS53aXRoZHJhd1Rva2Vuc01hcFtzZWxmLmJhc2Uub3duZXJdLm1pbnVzKF9udW1Ub2tlbnMpOwogICAgc2VsZi5iYXNlLndpdGhkcmF3VG9rZW5zTWFwW3NlbGYuYmFzZS5vd25lcl0gPSBfcmVtYWluZGVyOwoKCSAgTG9nVG9rZW5zQm91Z2h0KG1zZy5zZW5kZXIsIF9udW1Ub2tlbnMpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLypGdW5jdGlvbnMgImluaGVyaXRlZCIgZnJvbSBDcm93ZHNhbGVMaWIgbGlicmFyeSovCgogIGZ1bmN0aW9uIHNldFRva2VuRXhjaGFuZ2VSYXRlKERpcmVjdENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9leGNoYW5nZVJhdGUpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uuc2V0VG9rZW5FeGNoYW5nZVJhdGUoX2V4Y2hhbmdlUmF0ZSk7CiAgfQoKICBmdW5jdGlvbiBzZXRUb2tlbnMoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uuc2V0VG9rZW5zKCk7CiAgfQoKICBmdW5jdGlvbiBnZXRTYWxlRGF0YShEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiB0aW1lc3RhbXApIHJldHVybnMgKHVpbnQyNTZbM10pIHsKICAgIHJldHVybiBzZWxmLmJhc2UuZ2V0U2FsZURhdGEodGltZXN0YW1wKTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2Vuc1NvbGQoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuZ2V0VG9rZW5zU29sZCgpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdUb2tlbnMoKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3TGVmdG92ZXJXZWkoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2Uud2l0aGRyYXdMZWZ0b3ZlcldlaSgpOwogIH0KCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS53aXRoZHJhd093bmVyRXRoKCk7CiAgfQoKICBmdW5jdGlvbiBjcm93ZHNhbGVBY3RpdmUoRGlyZWN0Q3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzZWxmLmJhc2UuY3Jvd2RzYWxlQWN0aXZlKCk7CiAgfQoKICBmdW5jdGlvbiBjcm93ZHNhbGVFbmRlZChEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS5jcm93ZHNhbGVFbmRlZCgpOwogIH0KCiAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZShEaXJlY3RDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHNlbGYuYmFzZS52YWxpZFB1cmNoYXNlKCk7CiAgfQp9CgpsaWJyYXJ5IENyb3dkc2FsZUxpYiB7CiAgdXNpbmcgQmFzaWNNYXRoTGliIGZvciB1aW50MjU2OwoKICBzdHJ1Y3QgQ3Jvd2RzYWxlU3RvcmFnZSB7CiAgCWFkZHJlc3Mgb3duZXI7ICAgICAvL293bmVyIG9mIHRoZSBjcm93ZHNhbGUKCiAgCXVpbnQyNTYgdG9rZW5zUGVyRXRoOyAgLy9udW1iZXIgb2YgdG9rZW5zIHJlY2VpdmVkIHBlciBldGhlcgogIAl1aW50MjU2IGNhcEFtb3VudDsgLy9NYXhpbXVtIGFtb3VudCB0byBiZSByYWlzZWQgaW4gd2VpCiAgCXVpbnQyNTYgc3RhcnRUaW1lOyAvL0lDTyBzdGFydCB0aW1lLCB0aW1lc3RhbXAKICAJdWludDI1NiBlbmRUaW1lOyAvL0lDTyBlbmQgdGltZSwgdGltZXN0YW1wIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZAogICAgdWludDI1NiBleGNoYW5nZVJhdGU7IC8vY2VudHMvRVRIIGV4Y2hhbmdlIHJhdGUgYXQgdGhlIHRpbWUgb2YgdGhlIHNhbGUKICAgIHVpbnQyNTYgb3duZXJCYWxhbmNlOyAvL293bmVyIHdlaSBCYWxhbmNlCiAgICB1aW50MjU2IHN0YXJ0aW5nVG9rZW5CYWxhbmNlOyAvL2luaXRpYWwgYW1vdW50IG9mIHRva2VucyBmb3Igc2FsZQogICAgdWludDI1NltdIG1pbGVzdG9uZVRpbWVzOyAvL0FycmF5IG9mIHRpbWVzdGFtcHMgd2hlbiB0b2tlbiBwcmljZSBhbmQgYWRkcmVzcyBjYXAgY2hhbmdlcwogICAgdWludDggY3VycmVudE1pbGVzdG9uZTsgLy9Qb2ludGVyIHRvIHRoZSBjdXJyZW50IG1pbGVzdG9uZQogICAgdWludDggdG9rZW5EZWNpbWFsczsgLy9zdG9yZWQgdG9rZW4gZGVjaW1hbHMgZm9yIGNhbGN1bGF0aW9uIGxhdGVyCiAgICB1aW50OCBwZXJjZW50QnVybjsgLy9wZXJjZW50YWdlIG9mIGV4dHJhIHRva2VucyB0byBidXJuCiAgICBib29sIHRva2Vuc1NldDsgLy90cnVlIGlmIHRva2VucyBoYXZlIGJlZW4gcHJlcGFyZWQgZm9yIGNyb3dkc2FsZQogICAgYm9vbCByYXRlU2V0OyAvL3RydWUgaWYgZXhjaGFuZ2UgcmF0ZSBoYXMgYmVlbiBzZXQKCiAgICAvL01hcHMgdGltZXN0YW1wIHRvIHRva2VuIHByaWNlIGFuZCBhZGRyZXNzIHB1cmNoYXNlIGNhcCBzdGFydGluZyBhdCB0aGF0IHRpbWUKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NlsyXSkgc2FsZURhdGE7CgogICAgLy9zaG93cyBob3cgbXVjaCB3ZWkgYW4gYWRkcmVzcyBoYXMgY29udHJpYnV0ZWQKICAJbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBoYXNDb250cmlidXRlZDsKCiAgICAvL0ZvciB0b2tlbiB3aXRoZHJhdyBmdW5jdGlvbiwgbWFwcyBhIHVzZXIgYWRkcmVzcyB0byB0aGUgYW1vdW50IG9mIHRva2VucyB0aGV5IGNhbiB3aXRoZHJhdwogIAltYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHdpdGhkcmF3VG9rZW5zTWFwOwoKICAgIC8vIGFueSBsZWZ0b3ZlciB3ZWkgdGhhdCBidXllcnMgY29udHJpYnV0ZWQgdGhhdCBkaWRuJ3QgYWRkIHVwIHRvIGEgd2hvbGUgdG9rZW4gYW1vdW50CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGxlZnRvdmVyV2VpOwoKICAJQ3Jvd2RzYWxlVG9rZW4gdG9rZW47IC8vdG9rZW4gYmVpbmcgc29sZAogIH0KCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gYWRkcmVzcyBoYXMgd2l0aGRyYXduIHRoZWlyIHN1cHBseSBvZiB0b2tlbnMKICBldmVudCBMb2dUb2tlbnNXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9iaWRkZXIsIHVpbnQyNTYgQW1vdW50KTsKCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gYWRkcmVzcyBoYXMgd2l0aGRyYXduIHRoZWlyIHN1cHBseSBvZiBleHRyYSB3ZWkKICBldmVudCBMb2dXZWlXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIF9iaWRkZXIsIHVpbnQyNTYgQW1vdW50KTsKCiAgLy8gTG9ncyB3aGVuIG93bmVyIGhhcyBwdWxsZWQgZXRoCiAgZXZlbnQgTG9nT3duZXJFdGhXaXRoZHJhd24oYWRkcmVzcyBpbmRleGVkIG93bmVyLCB1aW50MjU2IGFtb3VudCwgc3RyaW5nIE1zZyk7CgogIC8vIEdlbmVyaWMgTm90aWNlIG1lc3NhZ2UgdGhhdCBpbmNsdWRlcyBhbmQgYWRkcmVzcyBhbmQgbnVtYmVyCiAgZXZlbnQgTG9nTm90aWNlTXNnKGFkZHJlc3MgX2J1eWVyLCB1aW50MjU2IHZhbHVlLCBzdHJpbmcgTXNnKTsKCiAgLy8gSW5kaWNhdGVzIHdoZW4gYW4gZXJyb3IgaGFzIG9jY3VycmVkIGluIHRoZSBleGVjdXRpb24gb2YgYSBmdW5jdGlvbgogIGV2ZW50IExvZ0Vycm9yTXNnKHN0cmluZyBNc2cpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgYSBjcm93ZHNhbGUgY29udHJhY3QgdXBvbiBjcmVhdGlvbi4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgY3Jvd2RzYWxlIG93bmVyCiAgLy8vIEBwYXJhbSBfc2FsZURhdGEgQXJyYXkgb2YgMyBpdGVtIHNldHMgc3VjaCB0aGF0LCBpbiBlYWNoIDMgZWxlbWVudAogIC8vLyBzZXQsIDEgaXMgdGltZXN0YW1wLCAyIGlzIHByaWNlIGluIGNlbnRzIGF0IHRoYXQgdGltZSwKICAvLy8gMyBpcyBhZGRyZXNzIHRva2VuIHB1cmNoYXNlIGNhcCBhdCB0aGF0IHRpbWUsIDAgaWYgbm8gYWRkcmVzcyBjYXAKICAvLy8gQHBhcmFtIF9mYWxsYmFja0V4Y2hhbmdlUmF0ZSBFeGNoYW5nZSByYXRlIG9mIGNlbnRzL0VUSAogIC8vLyBAcGFyYW0gX2NhcEFtb3VudEluQ2VudHMgVG90YWwgdG8gYmUgcmFpc2VkIGluIGNlbnRzCiAgLy8vIEBwYXJhbSBfZW5kVGltZSBUaW1lc3RhbXAgb2Ygc2FsZSBlbmQgdGltZQogIC8vLyBAcGFyYW0gX3BlcmNlbnRCdXJuIFBlcmNlbnRhZ2Ugb2YgZXh0cmEgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHBhcmFtIF90b2tlbiBUb2tlbiBiZWluZyBzb2xkCiAgZnVuY3Rpb24gaW5pdChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgdWludDI1NltdIF9zYWxlRGF0YSwKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2ZhbGxiYWNrRXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgdWludDI1NiBfY2FwQW1vdW50SW5DZW50cywKICAgICAgICAgICAgICAgIHVpbnQyNTYgX2VuZFRpbWUsCiAgICAgICAgICAgICAgICB1aW50OCBfcGVyY2VudEJ1cm4sCiAgICAgICAgICAgICAgICBDcm93ZHNhbGVUb2tlbiBfdG9rZW4pCiAgewogIAlyZXF1aXJlKHNlbGYuY2FwQW1vdW50ID09IDApOwogIAlyZXF1aXJlKHNlbGYub3duZXIgPT0gMCk7CiAgICByZXF1aXJlKF9zYWxlRGF0YS5sZW5ndGggPiAwKTsKICAgIHJlcXVpcmUoKF9zYWxlRGF0YS5sZW5ndGglMykgPT0gMCk7IC8vIGVuc3VyZSBzYWxlRGF0YSBpcyAzLWl0ZW0gc2V0cwogICAgcmVxdWlyZShfZW5kVGltZSA+IF9zYWxlRGF0YVswXSk7CiAgICByZXF1aXJlKF9jYXBBbW91bnRJbkNlbnRzID4gMCk7CiAgICByZXF1aXJlKF9vd25lciA+IDApOwogICAgcmVxdWlyZShfZmFsbGJhY2tFeGNoYW5nZVJhdGUgPiAwKTsKICAgIHJlcXVpcmUoX3BlcmNlbnRCdXJuIDw9IDEwMCk7CiAgICBzZWxmLm93bmVyID0gX293bmVyOwogICAgc2VsZi5jYXBBbW91bnQgPSAoKF9jYXBBbW91bnRJbkNlbnRzL19mYWxsYmFja0V4Y2hhbmdlUmF0ZSkgKyAxKSooMTAqKjE4KTsKICAgIHNlbGYuc3RhcnRUaW1lID0gX3NhbGVEYXRhWzBdOwogICAgc2VsZi5lbmRUaW1lID0gX2VuZFRpbWU7CiAgICBzZWxmLnRva2VuID0gX3Rva2VuOwogICAgc2VsZi50b2tlbkRlY2ltYWxzID0gX3Rva2VuLmRlY2ltYWxzKCk7CiAgICBzZWxmLnBlcmNlbnRCdXJuID0gX3BlcmNlbnRCdXJuOwogICAgc2VsZi5leGNoYW5nZVJhdGUgPSBfZmFsbGJhY2tFeGNoYW5nZVJhdGU7CgogICAgdWludDI1NiBfdGVtcFRpbWU7CiAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IF9zYWxlRGF0YS5sZW5ndGg7IGkgKz0gMyl7CiAgICAgIHJlcXVpcmUoX3NhbGVEYXRhW2ldID4gX3RlbXBUaW1lKTsKICAgICAgcmVxdWlyZShfc2FsZURhdGFbaSArIDFdID4gMCk7CiAgICAgIHJlcXVpcmUoKF9zYWxlRGF0YVtpICsgMl0gPT0gMCkgfHwgKF9zYWxlRGF0YVtpICsgMl0gPj0gMTAwKSk7CiAgICAgIHNlbGYubWlsZXN0b25lVGltZXMucHVzaChfc2FsZURhdGFbaV0pOwogICAgICBzZWxmLnNhbGVEYXRhW19zYWxlRGF0YVtpXV1bMF0gPSBfc2FsZURhdGFbaSArIDFdOwogICAgICBzZWxmLnNhbGVEYXRhW19zYWxlRGF0YVtpXV1bMV0gPSBfc2FsZURhdGFbaSArIDJdOwogICAgICBfdGVtcFRpbWUgPSBfc2FsZURhdGFbaV07CiAgICB9CiAgICBjaGFuZ2VUb2tlblByaWNlKHNlbGYsIF9zYWxlRGF0YVsxXSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGlzIGN1cnJlbnRseSBhY3RpdmUKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHN1Y2Nlc3MKICBmdW5jdGlvbiBjcm93ZHNhbGVBY3RpdmUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAJcmV0dXJuIChub3cgPj0gc2VsZi5zdGFydFRpbWUgJiYgbm93IDw9IHNlbGYuZW5kVGltZSk7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgY3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gc3VjY2VzcwogIGZ1bmN0aW9uIGNyb3dkc2FsZUVuZGVkKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmKSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgCXJldHVybiBub3cgPiBzZWxmLmVuZFRpbWU7CiAgfQoKICAvLy8gQGRldiBmdW5jdGlvbiB0byBjaGVjayBpZiBhIHB1cmNoYXNlIGlzIHZhbGlkCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgbm9uWmVyb1B1cmNoYXNlID0gbXNnLnZhbHVlICE9IDA7CiAgICBpZiAoY3Jvd2RzYWxlQWN0aXZlKHNlbGYpICYmIG5vblplcm9QdXJjaGFzZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIExvZ0Vycm9yTXNnKCJJbnZhbGlkIFB1cmNoYXNlISBDaGVjayBzZW5kIHRpbWUgYW5kIGFtb3VudCBvZiBldGhlci4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gY2FsbGVkIGJ5IHB1cmNoYXNlcnMgdG8gcHVsbCB0b2tlbnMKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHdlcmUgd2l0aGRyYXduCiAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgb2s7CgogICAgaWYgKHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPT0gMCkgewogICAgICBMb2dFcnJvck1zZygiU2VuZGVyIGhhcyBubyB0b2tlbnMgdG8gd2l0aGRyYXchIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKSB7CiAgICAgIGlmKCFjcm93ZHNhbGVFbmRlZChzZWxmKSl7CiAgICAgICAgTG9nRXJyb3JNc2coIk93bmVyIGNhbm5vdCB3aXRoZHJhdyBleHRyYSB0b2tlbnMgdW50aWwgYWZ0ZXIgdGhlIHNhbGUhIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIGlmKHNlbGYucGVyY2VudEJ1cm4gPiAwKXsKICAgICAgICAgIHVpbnQyNTYgX2J1cm5BbW91bnQgPSAoc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSAqIHNlbGYucGVyY2VudEJ1cm4pLzEwMDsKICAgICAgICAgIHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl0gPSBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdIC0gX2J1cm5BbW91bnQ7CiAgICAgICAgICBvayA9IHNlbGYudG9rZW4uYnVyblRva2VuKF9idXJuQW1vdW50KTsKICAgICAgICAgIHJlcXVpcmUob2spOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHZhciB0b3RhbCA9IHNlbGYud2l0aGRyYXdUb2tlbnNNYXBbbXNnLnNlbmRlcl07CiAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gMDsKICAgIG9rID0gc2VsZi50b2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXF1aXJlKG9rKTsKICAgIExvZ1Rva2Vuc1dpdGhkcmF3bihtc2cuc2VuZGVyLCB0b3RhbCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEZ1bmN0aW9uIGNhbGxlZCBieSBwdXJjaGFzZXJzIHRvIHB1bGwgbGVmdG92ZXIgd2VpIGZyb20gdGhlaXIgcHVyY2hhc2VzCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBjcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHJldHVybiB0cnVlIGlmIHdlaSB3YXMgd2l0aGRyYXduCiAgZnVuY3Rpb24gd2l0aGRyYXdMZWZ0b3ZlcldlaShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShzZWxmLmhhc0NvbnRyaWJ1dGVkW21zZy5zZW5kZXJdID4gMCk7CiAgICBpZiAoc2VsZi5sZWZ0b3ZlcldlaVttc2cuc2VuZGVyXSA9PSAwKSB7CiAgICAgIExvZ0Vycm9yTXNnKCJTZW5kZXIgaGFzIG5vIGV4dHJhIHdlaSB0byB3aXRoZHJhdyEiKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHZhciB0b3RhbCA9IHNlbGYubGVmdG92ZXJXZWlbbXNnLnNlbmRlcl07CiAgICBzZWxmLmxlZnRvdmVyV2VpW21zZy5zZW5kZXJdID0gMDsKICAgIG1zZy5zZW5kZXIudHJhbnNmZXIodG90YWwpOwogICAgTG9nV2VpV2l0aGRyYXduKG1zZy5zZW5kZXIsIHRvdGFsKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgc2VuZCBldGhlciBmcm9tIHRoZSBjb21wbGV0ZWQgY3Jvd2RzYWxlIHRvIHRoZSBvd25lcnMgd2FsbGV0IGFkZHJlc3MKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgb3duZXIgd2l0aGRyZXcgZXRoCiAgZnVuY3Rpb24gd2l0aGRyYXdPd25lckV0aChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgaWYgKCghY3Jvd2RzYWxlRW5kZWQoc2VsZikpICYmIChzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKT4wKSkgewogICAgICBMb2dFcnJvck1zZygiQ2Fubm90IHdpdGhkcmF3IG93bmVyIGV0aGVyIHVudGlsIGFmdGVyIHRoZSBzYWxlISIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgcmVxdWlyZShzZWxmLm93bmVyQmFsYW5jZSA+IDApOwoKICAgIHVpbnQyNTYgYW1vdW50ID0gc2VsZi5vd25lckJhbGFuY2U7CiAgICBzZWxmLm93bmVyQmFsYW5jZSA9IDA7CiAgICBzZWxmLm93bmVyLnRyYW5zZmVyKGFtb3VudCk7CiAgICBMb2dPd25lckV0aFdpdGhkcmF3bihtc2cuc2VuZGVyLGFtb3VudCwiQ3Jvd2RzYWxlIG93bmVyIGhhcyB3aXRoZHJhd24gYWxsIGZ1bmRzISIpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgRnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBwcmljZSBvZiB0aGUgdG9rZW4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIGNyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX25ld1ByaWNlIG5ldyB0b2tlbiBwcmljZSAoYW1vdW50IG9mIHRva2VucyBwZXIgZXRoZXIpCiAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdG9rZW4gcHJpY2UgY2hhbmdlZCBzdWNjZXNzZnVsbHkKICBmdW5jdGlvbiBjaGFuZ2VUb2tlblByaWNlKENyb3dkc2FsZVN0b3JhZ2Ugc3RvcmFnZSBzZWxmLHVpbnQyNTYgX25ld1ByaWNlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgCXJlcXVpcmUoX25ld1ByaWNlID4gMCk7CgogICAgdWludDI1NiByZXN1bHQ7CiAgICB1aW50MjU2IHJlbWFpbmRlcjsKCiAgICByZXN1bHQgPSBzZWxmLmV4Y2hhbmdlUmF0ZSAvIF9uZXdQcmljZTsKICAgIHJlbWFpbmRlciA9IHNlbGYuZXhjaGFuZ2VSYXRlICUgX25ld1ByaWNlOwogICAgaWYocmVtYWluZGVyID4gMCkgewogICAgICBzZWxmLnRva2Vuc1BlckV0aCA9IHJlc3VsdCArIDE7CiAgICB9IGVsc2UgewogICAgICBzZWxmLnRva2Vuc1BlckV0aCA9IHJlc3VsdDsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgdGhyZWUgZGF5cyBiZWZvcmUgdGhlIHNhbGUgdG8gc2V0IHRoZSB0b2tlbiBhbmQgcHJpY2UKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcGFyYW0gX2V4Y2hhbmdlUmF0ZSAgRVRIIGV4Y2hhbmdlIHJhdGUgZXhwcmVzc2VkIGluIGNlbnRzL0VUSAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdGhlIGV4Y2hhbmdlIHJhdGUgaGFzIGJlZW4gc2V0CiAgZnVuY3Rpb24gc2V0VG9rZW5FeGNoYW5nZVJhdGUoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYsIHVpbnQyNTYgX2V4Y2hhbmdlUmF0ZSkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHNlbGYub3duZXIpOwogICAgcmVxdWlyZSgobm93ID4gKHNlbGYuc3RhcnRUaW1lIC0gMyBkYXlzKSkgJiYgKG5vdyA8IChzZWxmLnN0YXJ0VGltZSkpKTsKICAgIHJlcXVpcmUoIXNlbGYucmF0ZVNldCk7ICAgLy8gdGhlIGV4Y2hhbmdlIHJhdGUgY2FuIG9ubHkgYmUgc2V0IG9uY2UhCiAgICByZXF1aXJlKHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpID4gMCk7CiAgICByZXF1aXJlKF9leGNoYW5nZVJhdGUgPiAwKTsKCiAgICB1aW50MjU2IF9jYXBBbW91bnRJbkNlbnRzOwogICAgdWludDI1NiBfdG9rZW5CYWxhbmNlOwogICAgYm9vbCBlcnI7CgogICAgKGVyciwgX2NhcEFtb3VudEluQ2VudHMpID0gc2VsZi5leGNoYW5nZVJhdGUudGltZXMoc2VsZi5jYXBBbW91bnQpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICBfdG9rZW5CYWxhbmNlID0gc2VsZi50b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICBzZWxmLndpdGhkcmF3VG9rZW5zTWFwW21zZy5zZW5kZXJdID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYuc3RhcnRpbmdUb2tlbkJhbGFuY2UgPSBfdG9rZW5CYWxhbmNlOwogICAgc2VsZi50b2tlbnNTZXQgPSB0cnVlOwoKICAgIHNlbGYuZXhjaGFuZ2VSYXRlID0gX2V4Y2hhbmdlUmF0ZTsKICAgIHNlbGYuY2FwQW1vdW50ID0gKF9jYXBBbW91bnRJbkNlbnRzL19leGNoYW5nZVJhdGUpICsgMTsKICAgIGNoYW5nZVRva2VuUHJpY2Uoc2VsZixzZWxmLnNhbGVEYXRhW3NlbGYubWlsZXN0b25lVGltZXNbMF1dWzBdKTsKICAgIHNlbGYucmF0ZVNldCA9IHRydWU7CgogICAgTG9nTm90aWNlTXNnKG1zZy5zZW5kZXIsc2VsZi50b2tlbnNQZXJFdGgsIk93bmVyIGhhcyBzZW50IHRoZSBleGNoYW5nZSBSYXRlIGFuZCB0b2tlbnMgYm91Z2h0IHBlciBFVEghIik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IGZhbGxiYWNrIGZ1bmN0aW9uIHRvIHNldCB0b2tlbnMgaWYgdGhlIGV4Y2hhbmdlIHJhdGUgZnVuY3Rpb24gd2FzIG5vdCBjYWxsZWQKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIENyb3dkc2FsZSBmcm9tIGNyb3dkc2FsZSBjb250cmFjdAogIC8vLyBAcmV0dXJuIHRydWUgaWYgdG9rZW5zIHNldCBzdWNjZXNzZnVsbHkKICBmdW5jdGlvbiBzZXRUb2tlbnMoQ3Jvd2RzYWxlU3RvcmFnZSBzdG9yYWdlIHNlbGYpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBzZWxmLm93bmVyKTsKICAgIHJlcXVpcmUoIXNlbGYudG9rZW5zU2V0KTsKCiAgICB1aW50MjU2IF90b2tlbkJhbGFuY2U7CgogICAgX3Rva2VuQmFsYW5jZSA9IHNlbGYudG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgc2VsZi53aXRoZHJhd1Rva2Vuc01hcFttc2cuc2VuZGVyXSA9IF90b2tlbkJhbGFuY2U7CiAgICBzZWxmLnN0YXJ0aW5nVG9rZW5CYWxhbmNlID0gX3Rva2VuQmFsYW5jZTsKICAgIHNlbGYudG9rZW5zU2V0ID0gdHJ1ZTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IEdldHMgdGhlIHByaWNlIGFuZCBidXkgY2FwIGZvciBpbmRpdmlkdWFsIGFkZHJlc3NlcyBhdCB0aGUgZ2l2ZW4gbWlsZXN0b25lIGluZGV4CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCBDcm93ZHNhbGUgZnJvbSBjcm93ZHNhbGUgY29udHJhY3QKICAvLy8gQHBhcmFtIHRpbWVzdGFtcCBUaW1lIGR1cmluZyBzYWxlIGZvciB3aGljaCBkYXRhIGlzIHJlcXVlc3RlZAogIC8vLyBAcmV0dXJuIEEgMy1lbGVtZW50IGFycmF5IHdpdGggMCB0aGUgdGltZXN0YW1wLCAxIHRoZSBwcmljZSBpbiBjZW50cywgMiB0aGUgYWRkcmVzcyBjYXAKICBmdW5jdGlvbiBnZXRTYWxlRGF0YShDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZiwgdWludDI1NiB0aW1lc3RhbXApIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTZbM10pIHsKICAgIHVpbnQyNTZbM10gbWVtb3J5IF90aGlzRGF0YTsKICAgIHVpbnQyNTYgaW5kZXg7CgogICAgd2hpbGUoKGluZGV4IDwgc2VsZi5taWxlc3RvbmVUaW1lcy5sZW5ndGgpICYmIChzZWxmLm1pbGVzdG9uZVRpbWVzW2luZGV4XSA8IHRpbWVzdGFtcCkpIHsKICAgICAgaW5kZXgrKzsKICAgIH0KICAgIGlmKGluZGV4ID09IDApCiAgICAgIGluZGV4Kys7CgogICAgX3RoaXNEYXRhWzBdID0gc2VsZi5taWxlc3RvbmVUaW1lc1tpbmRleCAtIDFdOwogICAgX3RoaXNEYXRhWzFdID0gc2VsZi5zYWxlRGF0YVtfdGhpc0RhdGFbMF1dWzBdOwogICAgX3RoaXNEYXRhWzJdID0gc2VsZi5zYWxlRGF0YVtfdGhpc0RhdGFbMF1dWzFdOwogICAgcmV0dXJuIF90aGlzRGF0YTsKICB9CgogIC8vLyBAZGV2IEdldHMgdGhlIG51bWJlciBvZiB0b2tlbnMgc29sZCB0aHVzIGZhcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgQ3Jvd2RzYWxlIGZyb20gY3Jvd2RzYWxlIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gTnVtYmVyIG9mIHRva2VucyBzb2xkCiAgZnVuY3Rpb24gZ2V0VG9rZW5zU29sZChDcm93ZHNhbGVTdG9yYWdlIHN0b3JhZ2Ugc2VsZikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHNlbGYuc3RhcnRpbmdUb2tlbkJhbGFuY2UgLSBzZWxmLnRva2VuLmJhbGFuY2VPZih0aGlzKTsKICB9Cn0KY29udHJhY3QgQ3Jvd2RzYWxlVG9rZW4gewogIHVzaW5nIFRva2VuTGliIGZvciBUb2tlbkxpYi5Ub2tlblN0b3JhZ2U7CgogIFRva2VuTGliLlRva2VuU3RvcmFnZSBwdWJsaWMgdG9rZW47CgogIGZ1bmN0aW9uIENyb3dkc2FsZVRva2VuKGFkZHJlc3Mgb3duZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHN5bWJvbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50OCBkZWNpbWFscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGluaXRpYWxTdXBwbHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBhbGxvd01pbnRpbmcpCiAgewogICAgdG9rZW4uaW5pdChvd25lciwgbmFtZSwgc3ltYm9sLCBkZWNpbWFscywgaW5pdGlhbFN1cHBseSwgYWxsb3dNaW50aW5nKTsKICB9CgogIGZ1bmN0aW9uIG5hbWUoKSBjb25zdGFudCByZXR1cm5zIChzdHJpbmcpIHsKICAgIHJldHVybiB0b2tlbi5uYW1lOwogIH0KCiAgZnVuY3Rpb24gc3ltYm9sKCkgY29uc3RhbnQgcmV0dXJucyAoc3RyaW5nKSB7CiAgICByZXR1cm4gdG9rZW4uc3ltYm9sOwogIH0KCiAgZnVuY3Rpb24gZGVjaW1hbHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50OCkgewogICAgcmV0dXJuIHRva2VuLmRlY2ltYWxzOwogIH0KCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4udG90YWxTdXBwbHk7CiAgfQoKICBmdW5jdGlvbiBpbml0aWFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHRva2VuLklOSVRJQUxfU1VQUExZOwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKHdobyk7CiAgfQoKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gdG9rZW4uYWxsb3dhbmNlKG93bmVyLCBzcGVuZGVyKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvaykgewogICAgcmV0dXJuIHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5jaGFuZ2VPd25lcihuZXdPd25lcik7CiAgfQoKICBmdW5jdGlvbiBidXJuVG9rZW4odWludDI1NiBhbW91bnQpIHJldHVybnMgKGJvb2wgb2spIHsKICAgIHJldHVybiB0b2tlbi5idXJuVG9rZW4oYW1vdW50KTsKICB9Cn0KCmxpYnJhcnkgVG9rZW5MaWIgewogIHVzaW5nIEJhc2ljTWF0aExpYiBmb3IgdWludDI1NjsKCiAgc3RydWN0IFRva2VuU3RvcmFnZSB7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIHN0cmluZyBuYW1lOwogICAgc3RyaW5nIHN5bWJvbDsKICAgIHVpbnQyNTYgdG90YWxTdXBwbHk7CiAgICB1aW50MjU2IElOSVRJQUxfU1VQUExZOwogICAgYWRkcmVzcyBvd25lcjsKICAgIHVpbnQ4IGRlY2ltYWxzOwogICAgYm9vbCBzdGlsbE1pbnRpbmc7CiAgfQoKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKICBldmVudCBPd25lckNoYW5nZShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8pOwogIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludDI1NiB2YWx1ZSk7CiAgZXZlbnQgTWludGluZ0Nsb3NlZChib29sIG1pbnRpbmdDbG9zZWQpOwoKICAvLy8gQGRldiBDYWxsZWQgYnkgdGhlIFN0YW5kYXJkIFRva2VuIHVwb24gY3JlYXRpb24uCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfbmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAvLy8gQHBhcmFtIF9zeW1ib2wgU3ltYm9sIG9mIHRoZSBuZXcgdG9rZW4KICAvLy8gQHBhcmFtIF9kZWNpbWFscyBEZWNpbWFsIHBsYWNlcyBmb3IgdGhlIHRva2VuIHJlcHJlc2VudGVkCiAgLy8vIEBwYXJhbSBfaW5pdGlhbF9zdXBwbHkgVGhlIGluaXRpYWwgdG9rZW4gc3VwcGx5CiAgLy8vIEBwYXJhbSBfYWxsb3dNaW50aW5nIFRydWUgaWYgYWRkaXRpb25hbCB0b2tlbnMgY2FuIGJlIGNyZWF0ZWQsIGZhbHNlIG90aGVyd2lzZQogIGZ1bmN0aW9uIGluaXQoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZiwKICAgICAgICAgICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgICAgICAgICAgc3RyaW5nIF9uYW1lLAogICAgICAgICAgICAgICAgc3RyaW5nIF9zeW1ib2wsCiAgICAgICAgICAgICAgICB1aW50OCBfZGVjaW1hbHMsCiAgICAgICAgICAgICAgICB1aW50MjU2IF9pbml0aWFsX3N1cHBseSwKICAgICAgICAgICAgICAgIGJvb2wgX2FsbG93TWludGluZykKICB7CiAgICByZXF1aXJlKHNlbGYuSU5JVElBTF9TVVBQTFkgPT0gMCk7CiAgICBzZWxmLm5hbWUgPSBfbmFtZTsKICAgIHNlbGYuc3ltYm9sID0gX3N5bWJvbDsKICAgIHNlbGYudG90YWxTdXBwbHkgPSBfaW5pdGlhbF9zdXBwbHk7CiAgICBzZWxmLklOSVRJQUxfU1VQUExZID0gX2luaXRpYWxfc3VwcGx5OwogICAgc2VsZi5kZWNpbWFscyA9IF9kZWNpbWFsczsKICAgIHNlbGYub3duZXIgPSBfb3duZXI7CiAgICBzZWxmLnN0aWxsTWludGluZyA9IF9hbGxvd01pbnRpbmc7CiAgICBzZWxmLmJhbGFuY2VzW19vd25lcl0gPSBfaW5pdGlhbF9zdXBwbHk7CiAgfQoKICAvLy8gQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBjYWxsZXIncyBhY2NvdW50IHRvIGFub3RoZXIgYWNjb3VudC4KICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF90byBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zCiAgLy8vIEBwYXJhbSBfdmFsdWUgTnVtYmVyIG9mIHRva2VucyB0byBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiB0cmFuc2ZlcihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIGJvb2wgZXJyOwogICAgdWludDI1NiBiYWxhbmNlOwoKICAgIChlcnIsYmFsYW5jZSkgPSBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdLm1pbnVzKF92YWx1ZSk7CiAgICByZXF1aXJlKCFlcnIpOwogICAgc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2U7CiAgICAvL0l0J3Mgbm90IHBvc3NpYmxlIHRvIG92ZXJmbG93IHRva2VuIHN1cHBseQogICAgc2VsZi5iYWxhbmNlc1tfdG9dID0gc2VsZi5iYWxhbmNlc1tfdG9dICsgX3ZhbHVlOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBBdXRob3JpemVkIGNhbGxlciB0cmFuc2ZlcnMgdG9rZW5zIGZyb20gb25lIGFjY291bnQgdG8gYW5vdGhlcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Zyb20gQWRkcmVzcyB0byBzZW5kIHRva2VucyBmcm9tCiAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byBzZW5kIHRva2VucyB0bwogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gc2VuZAogIC8vLyBAcmV0dXJuIFRydWUgaWYgY29tcGxldGVkCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX2Zyb20sCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF92YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJucyAoYm9vbCkKICB7CiAgICB2YXIgX2FsbG93YW5jZSA9IHNlbGYuYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICBib29sIGVycjsKICAgIHVpbnQyNTYgYmFsYW5jZU93bmVyOwogICAgdWludDI1NiBiYWxhbmNlU3BlbmRlcjsKCiAgICAoZXJyLGJhbGFuY2VPd25lcikgPSBzZWxmLmJhbGFuY2VzW19mcm9tXS5taW51cyhfdmFsdWUpOwogICAgcmVxdWlyZSghZXJyKTsKCiAgICAoZXJyLGJhbGFuY2VTcGVuZGVyKSA9IF9hbGxvd2FuY2UubWludXMoX3ZhbHVlKTsKICAgIHJlcXVpcmUoIWVycik7CgogICAgc2VsZi5iYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlT3duZXI7CiAgICBzZWxmLmFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYmFsYW5jZVNwZW5kZXI7CiAgICBzZWxmLmJhbGFuY2VzW190b10gPSBzZWxmLmJhbGFuY2VzW190b10gKyBfdmFsdWU7CgogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLy8vIEBkZXYgUmV0cmlldmUgdG9rZW4gYmFsYW5jZSBmb3IgYW4gYWNjb3VudAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3MgdG8gcmV0cmlldmUgYmFsYW5jZSBvZgogIC8vLyBAcmV0dXJuIGJhbGFuY2UgVGhlIG51bWJlciBvZiB0b2tlbnMgaW4gdGhlIHN1YmplY3QgYWNjb3VudAogIGZ1bmN0aW9uIGJhbGFuY2VPZihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gc2VsZi5iYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgLy8vIEBkZXYgQXV0aG9yaXplIGFuIGFjY291bnQgdG8gc2VuZCB0b2tlbnMgb24gY2FsbGVyJ3MgYmVoYWxmCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGF1dGhvcml6ZQogIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgYXV0aG9yaXplZCBhY2NvdW50IG1heSBzZW5kCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBhcHByb3ZlKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFJlbWFpbmluZyB0b2tlbnMgdGhpcmQgcGFydHkgc3BlbmRlciBoYXMgdG8gc2VuZAogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gaG9sZGVyCiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIG9mIGF1dGhvcml6ZWQgc3BlbmRlcgogIC8vLyBAcmV0dXJuIHJlbWFpbmluZyBOdW1iZXIgb2YgdG9rZW5zIHNwZW5kZXIgaGFzIGxlZnQgaW4gb3duZXIncyBhY2NvdW50CiAgZnVuY3Rpb24gYWxsb3dhbmNlKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIHNlbGYuYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8vLyBAZGV2IEF1dGhvcml6ZSB0aGlyZCBwYXJ0eSB0cmFuc2ZlciBieSBpbmNyZWFzaW5nL2RlY3JlYXNpbmcgYWxsb3dlZCByYXRoZXIgdGhhbiBzZXR0aW5nIGl0CiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEBwYXJhbSBfc3BlbmRlciBBZGRyZXNzIHRvIGF1dGhvcml6ZQogIC8vLyBAcGFyYW0gX3ZhbHVlQ2hhbmdlIEluY3JlYXNlIG9yIGRlY3JlYXNlIGluIG51bWJlciBvZiB0b2tlbnMgYXV0aG9yaXplZCBhY2NvdW50IG1heSBzZW5kCiAgLy8vIEBwYXJhbSBfaW5jcmVhc2UgVHJ1ZSBpZiBpbmNyZWFzaW5nIGFsbG93YW5jZSwgZmFsc2UgaWYgZGVjcmVhc2luZyBhbGxvd2FuY2UKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGFwcHJvdmVDaGFuZ2UgKFRva2VuU3RvcmFnZSBzdG9yYWdlIHNlbGYsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlQ2hhbmdlLCBib29sIF9pbmNyZWFzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5zIChib29sKQogIHsKICAgIHVpbnQyNTYgX25ld0FsbG93ZWQ7CiAgICBib29sIGVycjsKCiAgICBpZihfaW5jcmVhc2UpIHsKICAgICAgKGVyciwgX25ld0FsbG93ZWQpID0gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5wbHVzKF92YWx1ZUNoYW5nZSk7CiAgICAgIHJlcXVpcmUoIWVycik7CgogICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX25ld0FsbG93ZWQ7CiAgICB9IGVsc2UgewogICAgICBpZiAoX3ZhbHVlQ2hhbmdlID4gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSkgewogICAgICAgIHNlbGYuYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIF9uZXdBbGxvd2VkID0gc2VsZi5hbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSAtIF92YWx1ZUNoYW5nZTsKICAgICAgICBzZWxmLmFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX25ld0FsbG93ZWQ7CiAgICAgIH0KICAgIH0KCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX25ld0FsbG93ZWQpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBDaGFuZ2Ugb3duaW5nIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0LCBzcGVjaWZpY2FsbHkgZm9yIG1pbnRpbmcKICAvLy8gQHBhcmFtIHNlbGYgU3RvcmVkIHRva2VuIGZyb20gdG9rZW4gY29udHJhY3QKICAvLy8gQHBhcmFtIF9uZXdPd25lciBBZGRyZXNzIGZvciB0aGUgbmV3IG93bmVyCiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBjaGFuZ2VPd25lcihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCBhZGRyZXNzIF9uZXdPd25lcikgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZSgoc2VsZi5vd25lciA9PSBtc2cuc2VuZGVyKSAmJiAoX25ld093bmVyID4gMCkpOwoKICAgIHNlbGYub3duZXIgPSBfbmV3T3duZXI7CiAgICBPd25lckNoYW5nZShtc2cuc2VuZGVyLCBfbmV3T3duZXIpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBNaW50cyBhZGRpdGlvbmFsIHRva2VucywgbmV3IHRva2VucyBnbyB0byBvd25lcgogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBOdW1iZXIgb2YgdG9rZW5zIHRvIG1pbnQKICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIG1pbnRUb2tlbihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoKHNlbGYub3duZXIgPT0gbXNnLnNlbmRlcikgJiYgc2VsZi5zdGlsbE1pbnRpbmcpOwogICAgdWludDI1NiBfbmV3QW1vdW50OwogICAgYm9vbCBlcnI7CgogICAgKGVyciwgX25ld0Ftb3VudCkgPSBzZWxmLnRvdGFsU3VwcGx5LnBsdXMoX2Ftb3VudCk7CiAgICByZXF1aXJlKCFlcnIpOwoKICAgIHNlbGYudG90YWxTdXBwbHkgPSAgX25ld0Ftb3VudDsKICAgIHNlbGYuYmFsYW5jZXNbc2VsZi5vd25lcl0gPSBzZWxmLmJhbGFuY2VzW3NlbGYub3duZXJdICsgX2Ftb3VudDsKICAgIFRyYW5zZmVyKDB4MCwgc2VsZi5vd25lciwgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vLyBAZGV2IFBlcm1hbmVudCBzdG9wcyBtaW50aW5nCiAgLy8vIEBwYXJhbSBzZWxmIFN0b3JlZCB0b2tlbiBmcm9tIHRva2VuIGNvbnRyYWN0CiAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBjb21wbGV0ZWQKICBmdW5jdGlvbiBjbG9zZU1pbnQoVG9rZW5TdG9yYWdlIHN0b3JhZ2Ugc2VsZikgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShzZWxmLm93bmVyID09IG1zZy5zZW5kZXIpOwoKICAgIHNlbGYuc3RpbGxNaW50aW5nID0gZmFsc2U7CiAgICBNaW50aW5nQ2xvc2VkKHRydWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLy8gQGRldiBQZXJtYW5lbnRseSBidXJuIHRva2VucwogIC8vLyBAcGFyYW0gc2VsZiBTdG9yZWQgdG9rZW4gZnJvbSB0b2tlbiBjb250cmFjdAogIC8vLyBAcGFyYW0gX2Ftb3VudCBBbW91bnQgb2YgdG9rZW5zIHRvIGJ1cm4KICAvLy8gQHJldHVybiBUcnVlIGlmIGNvbXBsZXRlZAogIGZ1bmN0aW9uIGJ1cm5Ub2tlbihUb2tlblN0b3JhZ2Ugc3RvcmFnZSBzZWxmLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wpIHsKICAgICAgdWludDI1NiBfbmV3QmFsYW5jZTsKICAgICAgYm9vbCBlcnI7CgogICAgICAoZXJyLCBfbmV3QmFsYW5jZSkgPSBzZWxmLmJhbGFuY2VzW21zZy5zZW5kZXJdLm1pbnVzKF9hbW91bnQpOwogICAgICByZXF1aXJlKCFlcnIpOwoKICAgICAgc2VsZi5iYWxhbmNlc1ttc2cuc2VuZGVyXSA9IF9uZXdCYWxhbmNlOwogICAgICBzZWxmLnRvdGFsU3VwcGx5ID0gc2VsZi50b3RhbFN1cHBseSAtIF9hbW91bnQ7CiAgICAgIEJ1cm4obXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIDB4MCwgX2Ftb3VudCk7CiAgICAgIHJldHVybiB0cnVlOwogIH0KfQoKbGlicmFyeSBCYXNpY01hdGhMaWIgewogIGV2ZW50IEVycihzdHJpbmcgdHlwZUVycik7CgogIC8vLyBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyBvdmVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHByb2R1Y3Qgb2YgYSBhbmQgYiwgb3IgMCBpZiB0aGVyZSBpcyBvdmVyZmxvdwogIGZ1bmN0aW9uIHRpbWVzKHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHJlcyA6PSBtdWwoYSxiKQogICAgICBzd2l0Y2ggb3IoaXN6ZXJvKGIpLCBlcShkaXYocmVzLGIpLCBhKSkKICAgICAgY2FzZSAwIHsKICAgICAgICBlcnIgOj0gMQogICAgICAgIHJlcyA6PSAwCiAgICAgIH0KICAgIH0KICAgIGlmIChlcnIpCiAgICAgIEVycigidGltZXMgZnVuYyBvdmVyZmxvdyIpOwogIH0KCiAgLy8vIEBkZXYgRGl2aWRlcyB0d28gbnVtYmVycyBidXQgY2hlY2tzIGZvciAwIGluIHRoZSBkaXZpc29yIGZpcnN0LgogIC8vLyBEb2VzIG5vdCB0aHJvdyBidXQgcmF0aGVyIGxvZ3MgYW4gRXJyIGV2ZW50IGlmIDAgaXMgaW4gdGhlIGRpdmlzb3IuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIGBiYCBpcyAwCiAgLy8vIEByZXR1cm4gcmVzIFRoZSBxdW90aWVudCBvZiBhIGFuZCBiLCBvciAwIGlmIGBiYCBpcyAwCiAgZnVuY3Rpb24gZGl2aWRlZEJ5KHVpbnQyNTYgYSwgdWludDI1NiBiKSBjb25zdGFudCByZXR1cm5zIChib29sIGVycix1aW50MjU2IHJlcykgewogICAgYXNzZW1ibHl7CiAgICAgIHN3aXRjaCBpc3plcm8oYikKICAgICAgY2FzZSAwIHsKICAgICAgICByZXMgOj0gZGl2KGEsYikKICAgICAgICBtc3RvcmUoYWRkKG1sb2FkKDB4NDApLDB4MjApLHJlcykKICAgICAgICByZXR1cm4obWxvYWQoMHg0MCksMHg0MCkKICAgICAgfQogICAgfQogICAgRXJyKCJ0cmllZCB0byBkaXZpZGUgYnkgemVybyIpOwogICAgcmV0dXJuICh0cnVlLCAwKTsKICB9CgogIC8vLyBAZGV2IEFkZHMgdHdvIG51bWJlcnMgYW5kIGNoZWNrcyBmb3Igb3ZlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyBvdmVyZmxvdy4KICAvLy8gQHBhcmFtIGEgRmlyc3QgbnVtYmVyCiAgLy8vIEBwYXJhbSBiIFNlY29uZCBudW1iZXIKICAvLy8gQHJldHVybiBlcnIgRmFsc2Ugbm9ybWFsbHksIG9yIHRydWUgaWYgdGhlcmUgaXMgb3ZlcmZsb3cKICAvLy8gQHJldHVybiByZXMgVGhlIHN1bSBvZiBhIGFuZCBiLCBvciAwIGlmIHRoZXJlIGlzIG92ZXJmbG93CiAgZnVuY3Rpb24gcGx1cyh1aW50MjU2IGEsIHVpbnQyNTYgYikgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBlcnIsIHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IGFkZChhLGIpCiAgICAgIHN3aXRjaCBhbmQoZXEoc3ViKHJlcyxiKSwgYSksIG9yKGd0KHJlcyxiKSxlcShyZXMsYikpKQogICAgICBjYXNlIDAgewogICAgICAgIGVyciA6PSAxCiAgICAgICAgcmVzIDo9IDAKICAgICAgfQogICAgfQogICAgaWYgKGVycikKICAgICAgRXJyKCJwbHVzIGZ1bmMgb3ZlcmZsb3ciKTsKICB9CgogIC8vLyBAZGV2IFN1YnRyYWN0cyB0d28gbnVtYmVycyBhbmQgY2hlY2tzIGZvciB1bmRlcmZsb3cgYmVmb3JlIHJldHVybmluZy4KICAvLy8gRG9lcyBub3QgdGhyb3cgYnV0IHJhdGhlciBsb2dzIGFuIEVyciBldmVudCBpZiB0aGVyZSBpcyB1bmRlcmZsb3cuCiAgLy8vIEBwYXJhbSBhIEZpcnN0IG51bWJlcgogIC8vLyBAcGFyYW0gYiBTZWNvbmQgbnVtYmVyCiAgLy8vIEByZXR1cm4gZXJyIEZhbHNlIG5vcm1hbGx5LCBvciB0cnVlIGlmIHRoZXJlIGlzIHVuZGVyZmxvdwogIC8vLyBAcmV0dXJuIHJlcyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGEgYW5kIGIsIG9yIDAgaWYgdGhlcmUgaXMgdW5kZXJmbG93CiAgZnVuY3Rpb24gbWludXModWludDI1NiBhLCB1aW50MjU2IGIpIGNvbnN0YW50IHJldHVybnMgKGJvb2wgZXJyLHVpbnQyNTYgcmVzKSB7CiAgICBhc3NlbWJseXsKICAgICAgcmVzIDo9IHN1YihhLGIpCiAgICAgIHN3aXRjaCBlcShhbmQoZXEoYWRkKHJlcyxiKSwgYSksIG9yKGx0KHJlcyxhKSwgZXEocmVzLGEpKSksIDEpCiAgICAgIGNhc2UgMCB7CiAgICAgICAgZXJyIDo9IDEKICAgICAgICByZXMgOj0gMAogICAgICB9CiAgICB9CiAgICBpZiAoZXJyKQogICAgICBFcnIoIm1pbnVzIGZ1bmMgdW5kZXJmbG93Iik7CiAgfQp9'.
	

]
