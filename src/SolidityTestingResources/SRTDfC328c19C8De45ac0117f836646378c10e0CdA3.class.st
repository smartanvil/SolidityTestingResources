Class {
	#name : #SRTDfC328c19C8De45ac0117f836646378c10e0CdA3,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTDfC328c19C8De45ac0117f836646378c10e0CdA3 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCmNvbnRyYWN0IFdpbk1hdHJpeAogewogICBmdW5jdGlvbiBnZXRDb2VmZih1aW50MTYgbikgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7CiAgIGZ1bmN0aW9uIGdldEJldHNQcm9jZXNzZWQoKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MTYpOwogfQoKY29udHJhY3QgU21hcnRSb3VsZXR0ZVRva2VuIAp7CiAgIGZ1bmN0aW9uIGVtaXNzaW9uKGFkZHJlc3MgcGxheWVyLCBhZGRyZXNzIHBhcnRuZXIsIHVpbnQyNTYgdmFsdWVfYmV0LCB1aW50MjU2IGNvZWZfcGxheWVyLCB1aW50MjU2IGNvZWZfcGFydG5lcikgZXh0ZXJuYWwgcmV0dXJucyh1aW50MjU2LCB1aW50OCk7CiAgIGZ1bmN0aW9uIGlzT3BlcmF0aW9uQmxvY2tlZCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBTbWFydEFmZmlsaWF0ZSAKeyAgIAogICBmdW5jdGlvbiBnZXRBZmZpbGlhdGVJbmZvKGFkZHJlc3MgcGxheWVyKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MgYWZmaWxpYXRlLCB1aW50MTYgY29lZl9hZmZpbGlhdGUsIHVpbnQxNiBjb2VmX3BsYXllcik7Cn0KCi8qCioqIFVzZXIgaW50ZXJmYWNlIGZvciBTbWFydFJvdWxldHRlIGh0dHBzOi8vc21hcnRyb3VsZXR0ZS5pbwoqLwpjb250cmFjdCBTbWFydFJvdWxldHRlCnsKICBhZGRyZXNzIGRldmVsb3BlcjsKICBhZGRyZXNzIG9wZXJhdG9yOwoKICAvLyBXYWl0IEJsb2NrRGVsYXkgYmxvY2tzIGJlZm9yZSBnZW5lcmF0ZSByYW5kb20gbnVtYmVyCiAgdWludDggQmxvY2tEZWxheTsKCiAgLy8gTWF4aW11bSBiZXQgdmFsdWUgZm9yIGdhbWUgKG9uZSBjcmVkaXQgaXMgY3VycmVudE1heEJldC8yNTYpCiAgdWludDI1NiBjdXJyZW50TWF4QmV0OyAgICAKCiAgLy8gbWF4aW11bSBnYW1lcyBjb3VudCBwZXIgYmxvY2sKICB1aW50NjQgbWF4R2FtYmxlc1BlckJsb2NrOwogICAgICAgIAogIC8vIEVuYWJsZVxkaXNhYmxlIHRvIHBsYWNlIG5ldyBiZXRzCiAgYm9vbCBDb250cmFjdFN0YXRlOwoKICAvLyB0YWJsZSB3aXRoIHdpbm5lciBjb2VmZmljaWVudHMKICBXaW5NYXRyaXggd2luTWF0cml4OwoKICBTbWFydFJvdWxldHRlVG9rZW4gc21hcnRUb2tlbjsKCiAgYWRkcmVzcyBwdWJsaWMgcHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3Q7CgogIFNtYXJ0QWZmaWxpYXRlIHNtYXJ0QWZmaWxpYXRlQ29udHJhY3Q7CgogIHVpbnQxNiBjb25zdGFudCBtYXhUeXBlQmV0cyA9IDE1NzsKICAKICAvLyBEZWZhdWx0IGNvZWYgZm9yIHRva2VuIGVtaXNzaW9uIChpZiBTbWFydEFmZmlsaWF0ZSBjb250cmFjdCBpcyBub3Qgc2V0dXApCiAgdWludDE2IENvZWZQbGF5ZXJFbWlzc2lvbjsgICAKICAvLyAKICBtYXBwaW5nICh1aW50OCA9PiB1aW50OCkgcHJpdmF0ZSBtaW5DcmVkaXRzT25CZXQ7CiAgbWFwcGluZyAodWludDggPT4gdWludDgpIHByaXZhdGUgbWF4Q3JlZGl0c09uQmV0OwoKICBzdHJ1Y3QgR2FtZUluZm8KICB7CiAgICAgICBhZGRyZXNzIHBsYXllcjsKICAgICAgIHVpbnQyNTYgYmxvY2tOdW1iZXI7CiAgICAgICB1aW50OCB3aGVlbFJlc3VsdDsKICAgICAgIHVpbnQyNTYgYmV0czsKICAgICAgIGJ5dGVzMzIgdmFsdWVzOwogICAgICAgYnl0ZXMzMiB2YWx1ZXMyOwogIH0gCiAgICAgICAKICBHYW1lSW5mb1tdIHByaXZhdGUgZ2FtYmxlczsKCiAgIGVudW0gR2FtZVN0YXR1cyB7U3VjY2VzcywgU2tpcHBlZCwgU3RvcH0KCiAgIGVudW0gQmV0VHlwZXN7bnVtYmVyMCwgbnVtYmVyMSxudW1iZXIyLG51bWJlcjMsbnVtYmVyNCxudW1iZXI1LG51bWJlcjYsbnVtYmVyNyxudW1iZXI4LG51bWJlcjksCiAgICAgbnVtYmVyMTAsbnVtYmVyMTEsbnVtYmVyMTIsbnVtYmVyMTMsbnVtYmVyMTQsbnVtYmVyMTUsbnVtYmVyMTYsbnVtYmVyMTcsbnVtYmVyMTgsbnVtYmVyMTksbnVtYmVyMjAsbnVtYmVyMjEsCiAgICAgbnVtYmVyMjIsbnVtYmVyMjMsbnVtYmVyMjQsbnVtYmVyMjUsbnVtYmVyMjYsbnVtYmVyMjcsbnVtYmVyMjgsbnVtYmVyMjksbnVtYmVyMzAsbnVtYmVyMzEsbnVtYmVyMzIsbnVtYmVyMzMsCiAgICAgbnVtYmVyMzQsbnVtYmVyMzUsbnVtYmVyMzYsIHJlZCwgYmxhY2ssIG9kZCwgZXZlbiwgZG96ZW4xLGRvemVuMixkb3plbjMsIGNvbHVtbjEsY29sdW1uMixjb2x1bW4zLCBsb3csaGlnaCwKICAgICBwYWlyXzAxLCBwYWlyXzAyLCBwYWlyXzAzLCBwYWlyXzEyLCBwYWlyXzIzLCBwYWlyXzM2LCBwYWlyXzI1LCBwYWlyXzE0LCBwYWlyXzQ1LCBwYWlyXzU2LCBwYWlyXzY5LCBwYWlyXzU4LCBwYWlyXzQ3LAogICAgIHBhaXJfNzgsIHBhaXJfODksIHBhaXJfOTEyLCBwYWlyXzgxMSwgcGFpcl83MTAsIHBhaXJfMTAxMSwgcGFpcl8xMTEyLCBwYWlyXzEyMTUsIHBhaXJfMTUxOCwgcGFpcl8xNjE3LCBwYWlyXzE3MTgsIHBhaXJfMTcyMCwKICAgICBwYWlyXzE2MTksIHBhaXJfMTkyMiwgcGFpcl8yMDIzLCBwYWlyXzIxMjQsIHBhaXJfMjIyMywgcGFpcl8yMzI0LCBwYWlyXzI1MjgsIHBhaXJfMjYyOSwgcGFpcl8yNzMwLCBwYWlyXzI4MjksIHBhaXJfMjkzMCwgcGFpcl8xMTE0LAogICAgIHBhaXJfMTAxMywgcGFpcl8xMzE0LCBwYWlyXzE0MTUsIHBhaXJfMTMxNiwgcGFpcl8xNDE3LCBwYWlyXzE4MjEsIHBhaXJfMTkyMCwgcGFpcl8yMDIxLCBwYWlyXzIyMjUsIHBhaXJfMjMyNiwgcGFpcl8yNDI3LCBwYWlyXzI1MjYsCiAgICAgcGFpcl8yNjI3LCBwYWlyXzI4MzEsIHBhaXJfMjkzMiwgcGFpcl8zMDMzLCBwYWlyXzMxMzIsIHBhaXJfMzIzMywgcGFpcl8zMTM0LCBwYWlyXzMyMzUsIHBhaXJfMzMzNiwgcGFpcl8zNDM1LCBwYWlyXzM1MzYsIGNvcm5lcl8wXzFfMl8zLAogICAgIGNvcm5lcl8xXzJfNV80LCBjb3JuZXJfMl8zXzZfNSwgY29ybmVyXzRfNV84XzcsIGNvcm5lcl81XzZfOV84LCBjb3JuZXJfN184XzExXzEwLCBjb3JuZXJfOF85XzEyXzExLCBjb3JuZXJfMTBfMTFfMTRfMTMsIGNvcm5lcl8xMV8xMl8xNV8xNCwKICAgICBjb3JuZXJfMTNfMTRfMTdfMTYsIGNvcm5lcl8xNF8xNV8xOF8xNywgY29ybmVyXzE2XzE3XzIwXzE5LCBjb3JuZXJfMTdfMThfMjFfMjAsIGNvcm5lcl8xOV8yMF8yM18yMiwgY29ybmVyXzIwXzIxXzI0XzIzLCBjb3JuZXJfMjJfMjNfMjZfMjUsCiAgICAgY29ybmVyXzIzXzI0XzI3XzI2LCBjb3JuZXJfMjVfMjZfMjlfMjgsIGNvcm5lcl8yNl8yN18zMF8yOSwgY29ybmVyXzI4XzI5XzMyXzMxLCBjb3JuZXJfMjlfMzBfMzNfMzIsIGNvcm5lcl8zMV8zMl8zNV8zNCwgY29ybmVyXzMyXzMzXzM2XzM1LAogICAgIHRocmVlXzBfMl8zLCB0aHJlZV8wXzFfMiwgdGhyZWVfMV8yXzMsIHRocmVlXzRfNV82LCB0aHJlZV83XzhfOSwgdGhyZWVfMTBfMTFfMTIsIHRocmVlXzEzXzE0XzE1LCB0aHJlZV8xNl8xN18xOCwgdGhyZWVfMTlfMjBfMjEsIHRocmVlXzIyXzIzXzI0LAogICAgIHRocmVlXzI1XzI2XzI3LCB0aHJlZV8yOF8yOV8zMCwgdGhyZWVfMzFfMzJfMzMsIHRocmVlXzM0XzM1XzM2LCBzaXhfMV8yXzNfNF81XzYsIHNpeF80XzVfNl83XzhfOSwgc2l4XzdfOF85XzEwXzExXzEyLCBzaXhfMTBfMTFfMTJfMTNfMTRfMTUsCiAgICAgc2l4XzEzXzE0XzE1XzE2XzE3XzE4LCBzaXhfMTZfMTdfMThfMTlfMjBfMjEsIHNpeF8xOV8yMF8yMV8yMl8yM18yNCwgc2l4XzIyXzIzXzI0XzI1XzI2XzI3LCBzaXhfMjVfMjZfMjdfMjhfMjlfMzAsIHNpeF8yOF8yOV8zMF8zMV8zMl8zMywKICAgICBzaXhfMzFfMzJfMzNfMzRfMzVfMzZ9CiAgIAoKICAgZnVuY3Rpb24gU21hcnRSb3VsZXR0ZSgpIGludGVybmFsCiAgIHsgICAgICAgIAogICAgICAgIGRldmVsb3BlciAgPSBtc2cuc2VuZGVyOwogICAgICAgIG9wZXJhdG9yICAgPSBtc2cuc2VuZGVyOwogICAgICAgIAogICAgICAgIHdpbk1hdHJpeCA9IFdpbk1hdHJpeCgweDA3M0Q2NjIxRTkxNTBiRmY5ZDFENDUwY2FBZDNjNzkwYjZGMDcxRjIpOwogICAgICAgIGlmICh3aW5NYXRyaXguZ2V0QmV0c1Byb2Nlc3NlZCgpICE9IG1heFR5cGVCZXRzKSB0aHJvdzsKICAgICAgICAKICAgICAgICBzbWFydFRva2VuID0gU21hcnRSb3VsZXR0ZVRva2VuKDB4Y2NlZDViODI4ODA4NmJlOGMzOGUyMzU2N2U2ODRjMzc0MGJlNGQ0OCk7CgogICAgICAgIGN1cnJlbnRNYXhCZXQgPSAyNTYwIGZpbm5leTsgLy8gMi41NiBldGhlcgogICAgICAgIEJsb2NrRGVsYXkgPSAxOyAgICAgICAgCiAgICAgICAgbWF4R2FtYmxlc1BlckJsb2NrID0gNTsgICAgICAgIAogICAgICAgIENvbnRyYWN0U3RhdGUgID0gdHJ1ZTsgIAogICAgICAgIGJhbmtyb2xMaW1pdCA9IDI3NyBldGhlcjsKICAgICAgICBwcm9maXRMaW1pdCAgPSA1MCBldGhlcjsKICAgICAgICBDb2VmUGxheWVyRW1pc3Npb24gPSAxMDA7IC8vIGRlZmF1bHQgMSUKICAgfQoKICAgZnVuY3Rpb24gY2hhbmdlU2V0dGluZ3ModWludDI1NiBuZXdNYXhCZXQsIHVpbnQ4IG5ld0Jsb2NrRGVsYXkpIHB1YmxpYyBvbmx5RGV2ZWxvcGVyIAogICB7ICAgICAgICAgICAgIAogICAgICBCbG9ja0RlbGF5ID0gbmV3QmxvY2tEZWxheTsKICAgICAgLy8gcm91bmRzIHRvIDIgZGlndHMKICAgICAgbmV3TWF4QmV0ID0gbmV3TWF4QmV0IC8gMjU2MDAwMDAwMDAwMDAwMDAwMCAqIDI1NjAwMDAwMDAwMDAwMDAwMDA7ICAKICAgICAgaWYgKG5ld01heEJldCAhPSBjdXJyZW50TWF4QmV0KSAKICAgICAgewogICAgICAgIGN1cnJlbnRNYXhCZXQgPSBuZXdNYXhCZXQ7CiAgICAgICAgU2V0dGluZ3NDaGFuZ2VkKCk7CiAgICAgIH0KICAgfQoKICAgdWludDI1NiBiYW5rcm9sTGltaXQ7CiAgIHVpbnQyNTYgcHJvZml0TGltaXQ7CiAgIHVpbnQyNTYgbGFzdERpc3RyaWJ1dGVkUHJvZml0OwogICB1aW50MjU2IGxhc3REYXRlRGlzdHJpYnV0ZWRQcm9maXQ7CiAgIAogICBmdW5jdGlvbiBnZXREaXN0cmlidXRlUHJvZml0c0luZm8oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBsYXN0UHJvZml0LCB1aW50MjU2IGxhc3REYXRlKQogICB7CiAgICAgIGxhc3RQcm9maXQgPSBsYXN0RGlzdHJpYnV0ZWRQcm9maXQ7CiAgICAgIGxhc3REYXRlID0gbGFzdERhdGVEaXN0cmlidXRlZFByb2ZpdDsKICAgfQoKICAgZnVuY3Rpb24gc2V0UHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QoYWRkcmVzcyBjb250cmFjdEFkZHJlc3MpIG9ubHlEZXZlbG9wZXIKICAgewogICAgICBpZiAocHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QgPiAwKSB0aHJvdzsKICAgICAgcHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QgPSBjb250cmFjdEFkZHJlc3M7CiAgIH0KCiAgIGZ1bmN0aW9uIHNldFNtYXJ0QWZmaWxpYXRlQ29udHJhY3QoYWRkcmVzcyBjb250cmFjdEFkZHJlc3MpIG9ubHlEZXZlbG9wZXIKICAgewogICAgICBpZiAoYWRkcmVzcyhzbWFydEFmZmlsaWF0ZUNvbnRyYWN0KSA+IDApIHRocm93OwogICAgICBzbWFydEFmZmlsaWF0ZUNvbnRyYWN0ID0gU21hcnRBZmZpbGlhdGUoY29udHJhY3RBZGRyZXNzKTsKICAgfQoKICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVByb2ZpdHModWludDI1NiBnYXNWYWx1ZSkgb25seURldmVsb3Blck9yT3BlcmF0b3IKICAgewogICAgICBpZiAocHJvZml0RGlzdHJpYnV0aW9uQ29udHJhY3QgPiAwICYmIHRoaXMuYmFsYW5jZSA+PSAoYmFua3JvbExpbWl0K3Byb2ZpdExpbWl0KSkKICAgICAgewogICAgICAgICB1aW50MjU2IGRpZmYgPSB0aGlzLmJhbGFuY2UgLSBiYW5rcm9sTGltaXQ7CiAgICAgICAgIGlmIChhZGRyZXNzKHByb2ZpdERpc3RyaWJ1dGlvbkNvbnRyYWN0KS5jYWxsLmdhcyhnYXNWYWx1ZSkudmFsdWUoZGlmZikoKSA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgIGxhc3REaXN0cmlidXRlZFByb2ZpdCA9IGRpZmY7CiAgICAgICAgIGxhc3REYXRlRGlzdHJpYnV0ZWRQcm9maXQgPSBibG9jay50aW1lc3RhbXA7CiAgICAgIH0gICAgICAKICAgfQoKICAgZnVuY3Rpb24gZ2V0VG9rZW5TZXR0aW5ncygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQxNiBDb2VmX3BsYXllciwgdWludDI1NiBCYW5rcm9sTGltaXQsIHVpbnQyNTYgUHJvZml0TGltaXQpCiAgIHsKICAgICAgQ29lZl9wbGF5ZXIgPSBDb2VmUGxheWVyRW1pc3Npb247ICAgICAgCiAgICAgIEJhbmtyb2xMaW1pdCA9IGJhbmtyb2xMaW1pdDsKICAgICAgUHJvZml0TGltaXQgPSBwcm9maXRMaW1pdDsKICAgfQoKICAgZnVuY3Rpb24gY2hhbmdlVG9rZW5TZXR0aW5ncyh1aW50MTYgbmV3Q29lZl9wbGF5ZXIsIHVpbnQyNTYgbmV3QmFua3JvbExpbWl0LCB1aW50MjU2IG5ld1Byb2ZpdExpbWl0KSBvbmx5RGV2ZWxvcGVyCiAgIHsKICAgICAgQ29lZlBsYXllckVtaXNzaW9uICA9IG5ld0NvZWZfcGxheWVyOyAgICAgIAogICAgICBiYW5rcm9sTGltaXQgPSBuZXdCYW5rcm9sTGltaXQ7CiAgICAgIHByb2ZpdExpbWl0ICA9IG5ld1Byb2ZpdExpbWl0OwogICB9CgogICBmdW5jdGlvbiBjaGFuZ2VNaW5CZXQodWludDhbMTU3XSB2YWx1ZSkgb25seURldmVsb3BlcgogICB7CiAgICAgLy8gdmFsdWVbaV0gPT0gMCBtZWFucyBza2lwIHRoaXMgdmFsdWUKICAgICAvLyB2YWx1ZVtpXSA9PSAyNTUgbWVhbnMgdmFsdWUgd2lsbCBiZSAwCiAgICAgLy8gUmF3IG1hcHBpbmcgbWluQ3JlZGl0c09uQmV0IGNoYW5nZXMgZnJvbSAwIHRvIDI1NCwgCiAgICAgLy8gd2hlbiBjb21wYXJlIHdpdGggcmVhbCBiZXQgd2UgYWRkICsxLCBzbyBtaW4gY3JlZGl0cyBjaGFuZ2VzIGZyb20gMSB0byAyNTUKICAgICBmb3IodmFyIGk9MDtpPDE1NztpKyspIAogICAgIHsKICAgICAgICBpZiAodmFsdWVbaV0gPiAwKSAKICAgICAgICB7CiAgICAgICAgICAgaWYgKHZhbHVlW2ldID09IDI1NSkKICAgICAgICAgICAgIG1pbkNyZWRpdHNPbkJldFtpXSA9IDA7ICAgICAKICAgICAgICAgICBlbHNlICAKICAgICAgICAgICAgIG1pbkNyZWRpdHNPbkJldFtpXSA9IHZhbHVlW2ldOwogICAgICAgIH0KICAgICB9CiAgICAgU2V0dGluZ3NDaGFuZ2VkKCk7CiAgIH0KCiAgIGZ1bmN0aW9uIGNoYW5nZU1heEJldCh1aW50OFsxNTddIHZhbHVlKSBvbmx5RGV2ZWxvcGVyCiAgIHsKICAgICAvLyB2YWx1ZVtpXSA9PSAwIG1lYW5zIHNraXAgdGhpcyB2YWx1ZQogICAgIC8vIHZhbHVlW2ldID09IDI1NSBtZWFucyB2YWx1ZSB3aWxsIGJlIDAKICAgICAvLyBSYXcgbWFwcGluZyBtYXhDcmVkaXRzT25CZXQgaG9sZCB2YWx1ZXMgdGhhdCByZWR1Y2UgbWF4IGJldCBmcm9tIDI1NSB0byAwICAgICAKICAgICAvLyBJZiB3ZSB3YW50IHRvIGNhbGN1bGF0ZSByZWFsIG1heCBiZXQgdmFsdWUgd2Ugc2hvdWxkIGRvOiAyNTYgLSBtYXhDcmVkaXRzT25CZXRbaV0KICAgICAvLyBleGFtcGxlOiBpZiBtYXBwaW5nIGhvbGRzIDAgaXQgbWVhbnMsIHRoYXQgbWF4IGJldCB3aWxsIGJlIDI1NiAtIDAgPSAyNTYKICAgICAvLyAgICAgICAgICBpZiBtYXBwaW5nIGhvbGRzIDUwIGl0IG1lYW5zLCB0aGF0IG1heCBiZXQgd2lsbCBiZSAyNTYgLSA1MCA9IDIwNiAKICAgICBmb3IodmFyIGk9MDtpPDE1NztpKyspIAogICAgIHsKICAgICAgIGlmICh2YWx1ZVtpXSA+IDApIAogICAgICAgewogICAgICAgICAgaWYgKHZhbHVlW2ldID09IDI1NSkKICAgICAgICAgICAgIG1heENyZWRpdHNPbkJldFtpXSA9IDA7ICAgICAKICAgICAgICAgICBlbHNlICAKICAgICAgICAgICAgIG1heENyZWRpdHNPbkJldFtpXSA9IDI1NSAtIHZhbHVlW2ldOyAgICAgICAgICAgICAgCiAgICAgICB9CiAgICAgfQogICAgIFNldHRpbmdzQ2hhbmdlZCgpOwogICB9CiAgIAogICBmdW5jdGlvbiBkZWxldGVDb250cmFjdCgpIG9ubHlEZXZlbG9wZXIgIAogICB7CiAgICAgICAgc3VpY2lkZShtc2cuc2VuZGVyKTsKICAgfQoKICAgLy8gYml0IGZyb20gMCB0byAyNTUKICAgZnVuY3Rpb24gaXNCaXRTZXQodWludDI1NiBkYXRhLCB1aW50OCBiaXQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZXQpCiAgIHsKICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcmV0IDo9IGlzemVybyhpc3plcm8oYW5kKGRhdGEsIGV4cCgyLGJpdCkpKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldDsKICAgfQoKICAgLy8gdW5pcXVlIGNvbWJpbmF0aW9uIG9mIGJldCBhbmQgd2hlZWxSZXN1bHQsIHVzZWQgZm9yIGFjY2VzcyB0byBXaW5NYXRyaXgKICAgZnVuY3Rpb24gZ2V0SW5kZXgodWludDE2IGJldCwgdWludDE2IHdoZWVsUmVzdWx0KSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNikKICAgewogICAgICByZXR1cm4gKGJldCsxKSoyNTYgKyAod2hlZWxSZXN1bHQrMSk7CiAgIH0KCiAgIC8vIG4gZm9ybSAxIDw9IHRvIDw9IDMyCiAgIGZ1bmN0aW9uIGdldEJldFZhbHVlKGJ5dGVzMzIgdmFsdWVzLCB1aW50OCBuLCB1aW50OCBuQml0KSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgIHsKICAgICAgICAvLyBiZXQgaW4gY3JlZGl0cyAoMS4uMjU2KSAKICAgICAgICB1aW50MjU2IGJldCA9IHVpbnQyNTYodmFsdWVzWzMyIC0gbl0pICsgMTsKCiAgICAgICAgaWYgKGJldCA8IHVpbnQyNTYobWluQ3JlZGl0c09uQmV0W25CaXRdKzEpKSB0aHJvdzsgICAvL2RlZmF1bHQ6IGJldCA8IDArMQogICAgICAgIGlmIChiZXQgPiB1aW50MjU2KDI1Ni1tYXhDcmVkaXRzT25CZXRbbkJpdF0pKSB0aHJvdzsgLy9kZWZhdWx0OiBiZXQgPiAyNTYtMCAgICAgIAoKICAgICAgICByZXR1cm4gY3VycmVudE1heEJldCAqIGJldCAvIDI1NjsgICAgICAgIAogICB9CgogICAvLyBuIC0gbnVtYmVyIHBsYXllciBiZXQKICAgLy8gbkJpdCAtIGJldEluZGV4CiAgIGZ1bmN0aW9uIGdldEJldFZhbHVlQnlHYW1ibGUoR2FtZUluZm8gbWVtb3J5IGdhbWJsZSwgdWludDggbiwgdWludDggbkJpdCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSAKICAgewogICAgICBpZiAobiA8PSAzMikgcmV0dXJuIGdldEJldFZhbHVlKGdhbWJsZS52YWx1ZXMgLCBuLCBuQml0KTsKICAgICAgaWYgKG4gPD0gNjQpIHJldHVybiBnZXRCZXRWYWx1ZShnYW1ibGUudmFsdWVzMiwgbiAtIDMyLCBuQml0KTsKICAgICAgLy8gdGhlcmUgYXJlIDY0IG1heGltdW0gdW5pcXVlIGJldHMgKHBvc2l0aW9ucykgaW4gb25lIGdhbWUKICAgICAgdGhyb3c7CiAgIH0KICAKICAgZnVuY3Rpb24gdG90YWxHYW1lcygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpCiAgIHsKICAgICAgIHJldHVybiBnYW1ibGVzLmxlbmd0aDsKICAgfQogICAKICAgZnVuY3Rpb24gZ2V0U2V0dGluZ3MoKSBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgbWF4QmV0LCB1aW50MjU2IG9uZUNyZWRpdCwgdWludDhbMTU3XSBfbWluQ3JlZGl0c09uQmV0LCB1aW50OFsxNTddIF9tYXhDcmVkaXRzT25CZXQsIHVpbnQ4IGJsb2NrRGVsYXksIGJvb2wgY29udHJhY3RTdGF0ZSkKICAgIHsKICAgICAgICBtYXhCZXQgICAgPSBjdXJyZW50TWF4QmV0OwogICAgICAgIG9uZUNyZWRpdCA9IGN1cnJlbnRNYXhCZXQgLyAyNTY7IAogICAgICAgIGJsb2NrRGVsYXkgPSBCbG9ja0RlbGF5OyAgICAgIAogICAgICAgIGZvcih2YXIgaSA9IDA7aSA8IG1heFR5cGVCZXRzO2krKykgIAogICAgICAgIHsKICAgICAgICAgIF9taW5DcmVkaXRzT25CZXRbaV0gPSBtaW5DcmVkaXRzT25CZXRbaV0gKyAxOwogICAgICAgICAgX21heENyZWRpdHNPbkJldFtpXSA9IDI1NSAtIG1heENyZWRpdHNPbkJldFtpXTsKICAgICAgICB9ICAgICAKICAgICAgICBjb250cmFjdFN0YXRlICAgICAgICA9IENvbnRyYWN0U3RhdGU7CiAgICB9CiAgIAogICAgbW9kaWZpZXIgb25seURldmVsb3BlcigpIAogICAgewogICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gZGV2ZWxvcGVyKSB0aHJvdzsKICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seURldmVsb3Blck9yT3BlcmF0b3IoKSAKICAgIHsKICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGRldmVsb3BlciAmJiBtc2cuc2VuZGVyICE9IG9wZXJhdG9yKSB0aHJvdzsKICAgICAgIF87CiAgICB9CgogICBmdW5jdGlvbiBkaXNhYmxlQmV0dGluZ19vbmx5X0RldigpCiAgICBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcgogICAgewogICAgICAgIENvbnRyYWN0U3RhdGU9ZmFsc2U7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGNoYW5nZU9wZXJhdG9yKGFkZHJlc3MgbmV3T3BlcmF0b3IpIG9ubHlEZXZlbG9wZXIKICAgIHsKICAgICAgIG9wZXJhdG9yID0gbmV3T3BlcmF0b3I7CiAgICB9CgogICAgZnVuY3Rpb24gZW5hYmxlQmV0dGluZ19vbmx5X0RldigpCiAgICBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcgogICAgewogICAgICAgIENvbnRyYWN0U3RhdGU9dHJ1ZTsKCiAgICB9CgogICAgZXZlbnQgUGxheWVyQmV0KHVpbnQyNTYgZ2FtYmxlSWQsIHVpbnQyNTYgcGxheWVyVG9rZW5zKTsKICAgIGV2ZW50IEVuZEdhbWUoYWRkcmVzcyBwbGF5ZXIsIHVpbnQ4IHJlc3VsdCwgdWludDI1NiBnYW1ibGVJZCk7CiAgICBldmVudCBTZXR0aW5nc0NoYW5nZWQoKTsKICAgIGV2ZW50IEVycm9yTG9nKGFkZHJlc3MgcGxheWVyLCBzdHJpbmcgbWVzc2FnZSk7CiAgICBldmVudCBHYXNMb2coc3RyaW5nIG1zZywgdWludDI1NiBsZXZlbCwgdWludDI1NiBnYXMpOwoKICAgZnVuY3Rpb24gdG90YWxCZXRWYWx1ZShHYW1lSW5mbyBtZW1vcnkgZykgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KQogICB7ICAgICAgICAgICAgICAKICAgICAgIHVpbnQyNTYgdG90YWxCZXRzVmFsdWUgPSAwOyAKICAgICAgIHVpbnQ4IG5QbGF5ZXJCZXRObyA9IDA7CiAgICAgICB1aW50OCBiZXRzQ291bnQgPSB1aW50OChieXRlczMyKGcuYmV0cylbMF0pOwoKICAgICAgIGZvcih1aW50OCBpID0gMDsgaSA8IG1heFR5cGVCZXRzO2krKykgCiAgICAgICAgaWYgKGlzQml0U2V0KGcuYmV0cywgaSkpCiAgICAgICAgewogICAgICAgICAgdG90YWxCZXRzVmFsdWUgKz0gZ2V0QmV0VmFsdWVCeUdhbWJsZShnLCBuUGxheWVyQmV0Tm8rMSwgaSk7CiAgICAgICAgICBuUGxheWVyQmV0Tm8rKzsKCiAgICAgICAgICBpZiAoYmV0c0NvdW50ID09IDEpIGJyZWFrOwogICAgICAgICAgYmV0c0NvdW50LS07ICAgICAgICAgIAogICAgICAgIH0KCiAgICAgICByZXR1cm4gdG90YWxCZXRzVmFsdWU7CiAgIH0KCiAgIGZ1bmN0aW9uIHRvdGFsQmV0Q291bnQoR2FtZUluZm8gbWVtb3J5IGcpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikKICAgeyAgICAgICAgICAgICAgCiAgICAgICB1aW50MjU2IHRvdGFsQmV0cyA9IDA7IAogICAgICAgZm9yKHVpbnQ4IGk9MDsgaSA8IG1heFR5cGVCZXRzO2krKykgCiAgICAgICAgaWYgKGlzQml0U2V0KGcuYmV0cywgaSkpIHRvdGFsQmV0cysrOyAgICAgICAgICAKICAgICAgIHJldHVybiB0b3RhbEJldHM7ICAgCiAgIH0KCiAgIGZ1bmN0aW9uIHBsYWNlQmV0KHVpbnQyNTYgYmV0cywgYnl0ZXMzMiB2YWx1ZXMxLGJ5dGVzMzIgdmFsdWVzMikgcHVibGljIHBheWFibGUKICAgewogICAgICAgaWYgKENvbnRyYWN0U3RhdGUgPT0gZmFsc2UpCiAgICAgICB7CiAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJDb250cmFjdERpc2FibGVkIik7CiAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgIHJldHVybjsKICAgICAgIH0KCiAgICAgICB2YXIgZ2FtYmxlc0xlbmd0aCA9IGdhbWJsZXMubGVuZ3RoOwoKICAgICAgIGlmIChnYW1ibGVzTGVuZ3RoID4gMCkKICAgICAgIHsKICAgICAgICAgIHVpbnQ4IGdhbWJsZXNDb3VudEluQ3VycmVudEJsb2NrID0gMDsKICAgICAgICAgIGZvcih2YXIgaSA9IGdhbWJsZXNMZW5ndGggLSAxO2kgPiAwOyBpLS0pCiAgICAgICAgICB7CiAgICAgICAgICAgIGlmIChnYW1ibGVzW2ldLmJsb2NrTnVtYmVyID09IGJsb2NrLm51bWJlcikgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgaWYgKGdhbWJsZXNbaV0ucGxheWVyID09IG1zZy5zZW5kZXIpCiAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJQbGF5IHR3aWNlIHRoZSBzYW1lIGJsb2NrIik7CiAgICAgICAgICAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93OwogICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICBnYW1ibGVzQ291bnRJbkN1cnJlbnRCbG9jaysrOwogICAgICAgICAgICAgICBpZiAoZ2FtYmxlc0NvdW50SW5DdXJyZW50QmxvY2sgPj0gbWF4R2FtYmxlc1BlckJsb2NrKQogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJtYXhHYW1ibGVzUGVyQmxvY2siKTsKICAgICAgICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIuc2VuZChtc2cudmFsdWUpID09IGZhbHNlKSB0aHJvdzsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICB9CiAgICAgICAKICAgICAgIHZhciBfY3VycmVudE1heEJldCA9IGN1cnJlbnRNYXhCZXQ7CgogICAgICAgaWYgKG1zZy52YWx1ZSA8IF9jdXJyZW50TWF4QmV0LzI1NiB8fCBiZXRzID09IDApCiAgICAgICB7CiAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiV3JvbmcgYmV0IHZhbHVlIik7CiAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93OwogICAgICAgICAgcmV0dXJuOwogICAgICAgfQoKICAgICAgIGlmIChtc2cudmFsdWUgPiBfY3VycmVudE1heEJldCkKICAgICAgIHsKICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJMaW1pdCBmb3IgdGFibGUiKTsKICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgICByZXR1cm47CiAgICAgICB9CgogICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBHYW1lSW5mbyhtc2cuc2VuZGVyLCBibG9jay5udW1iZXIsIDM3LCBiZXRzLCB2YWx1ZXMxLHZhbHVlczIpOwoKICAgICAgIGlmICh0b3RhbEJldFZhbHVlKGcpICE9IG1zZy52YWx1ZSkKICAgICAgIHsKICAgICAgICAgIEVycm9yTG9nKG1zZy5zZW5kZXIsICJXcm9uZyBiZXQgdmFsdWUiKTsKICAgICAgICAgIGlmIChtc2cuc2VuZGVyLnNlbmQobXNnLnZhbHVlKSA9PSBmYWxzZSkgdGhyb3c7CiAgICAgICAgICByZXR1cm47CiAgICAgICB9ICAgICAgIAoKICAgICAgIGFkZHJlc3MgYWZmaWxpYXRlID0gMDsKICAgICAgIHVpbnQxNiBjb2VmX2FmZmlsaWF0ZSA9IDA7CiAgICAgICB1aW50MTYgY29lZl9wbGF5ZXI7CiAgICAgICBpZiAoYWRkcmVzcyhzbWFydEFmZmlsaWF0ZUNvbnRyYWN0KSA+IDApCiAgICAgICB7ICAgICAgICAKICAgICAgICAgKGFmZmlsaWF0ZSwgY29lZl9hZmZpbGlhdGUsIGNvZWZfcGxheWVyKSA9IHNtYXJ0QWZmaWxpYXRlQ29udHJhY3QuZ2V0QWZmaWxpYXRlSW5mbyhtc2cuc2VuZGVyKTsgICAKICAgICAgIH0KICAgICAgIGVsc2UKICAgICAgIHsKICAgICAgICAgY29lZl9wbGF5ZXIgPSBDb2VmUGxheWVyRW1pc3Npb247CiAgICAgICB9CgogICAgICAgdWludDI1NiBwbGF5ZXJUb2tlbnM7CiAgICAgICB1aW50OCBlcnJvckNvZGVFbWlzc2lvbjsKICAgICAgIAogICAgICAgKHBsYXllclRva2VucywgZXJyb3JDb2RlRW1pc3Npb24pID0gc21hcnRUb2tlbi5lbWlzc2lvbihtc2cuc2VuZGVyLCBhZmZpbGlhdGUsIG1zZy52YWx1ZSwgY29lZl9wbGF5ZXIsIGNvZWZfYWZmaWxpYXRlKTsKICAgICAgIGlmIChlcnJvckNvZGVFbWlzc2lvbiAhPSAwKQogICAgICAgewogICAgICAgICAgaWYgKGVycm9yQ29kZUVtaXNzaW9uID09IDEpIAogICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAidG9rZW4gb3BlcmF0aW9ucyBzdG9wcGVkIik7CiAgICAgICAgICBlbHNlIGlmIChlcnJvckNvZGVFbWlzc2lvbiA9PSAyKSAKICAgICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgImNvbnRyYWN0IGlzIG5vdCBpbiBhIGdhbWVzIGxpc3QiKTsKICAgICAgICAgIGVsc2UgaWYgKGVycm9yQ29kZUVtaXNzaW9uID09IDMpIAogICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiaW5jb3JlY3QgcGxheWVyIGFkZHJlc3MiKTsKICAgICAgICAgIGVsc2UgaWYgKGVycm9yQ29kZUVtaXNzaW9uID09IDQpIAogICAgICAgICAgICBFcnJvckxvZyhtc2cuc2VuZGVyLCAiaW5jb3JlY3QgdmFsdWUgYmV0Iik7CiAgICAgICAgICBlbHNlIGlmIChlcnJvckNvZGVFbWlzc2lvbiA9PSA1KSAKICAgICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgImluY29yZWN0IENvZWZmaWNpZW50IGVtaXNzaW9ucyIpOwogICAgICAgICAgCiAgICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKG1zZy52YWx1ZSkgPT0gZmFsc2UpIHRocm93OwogICAgICAgICAgcmV0dXJuOwogICAgICAgfQoKICAgICAgIGdhbWJsZXMucHVzaChnKTsKCiAgICAgICBQbGF5ZXJCZXQoZ2FtYmxlc0xlbmd0aCwgcGxheWVyVG9rZW5zKTsgCiAgIH0KCiAgICBmdW5jdGlvbiBJbnZlc3QoKSBwYXlhYmxlIG9ubHlEZXZlbG9wZXIKICAgIHsgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRHYW1lSW5kZXhlc1RvUHJvY2VzcygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2WzY0XSBnYW1lSW5kZXhlcykKICAgIHsgICAgICAgICAgIAogICAgICB1aW50OCBpbmRleCA9IDA7CiAgICAgIGZvcihpbnQyNTYgaSA9IGludDI1NihnYW1ibGVzLmxlbmd0aCkgLSAxO2kgPj0gMDtpLS0pCiAgICAgIHsgICAgICAKICAgICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW3VpbnQyNTYoaSldOwogICAgICAgICBpZiAoYmxvY2subnVtYmVyIC0gZy5ibG9ja051bWJlciA+PSAyNTYpIGJyZWFrOwoKICAgICAgICAgaWYgKGcud2hlZWxSZXN1bHQgPT0gMzcgJiYgYmxvY2subnVtYmVyID49IGcuYmxvY2tOdW1iZXIgKyBCbG9ja0RlbGF5KQogICAgICAgICB7IAogICAgICAgICAgICBnYW1lSW5kZXhlc1tpbmRleCsrXSA9IHVpbnQyNTYoaSArIDEpOwogICAgICAgICB9CiAgICAgIH0gICAgICAKICAgIH0KCiAgICB1aW50MjU2IGxhc3RCbG9ja0dhbWVzUHJvY2Vzc2VkOwoKICAgIGZ1bmN0aW9uIFByb2Nlc3NHYW1lcyh1aW50MjU2W10gZ2FtZUluZGV4ZXMsIGJvb2wgc2ltdWxhdGUpIAogICAgewogICAgICBpZiAoIXNpbXVsYXRlKQogICAgICB7CiAgICAgICAgIGlmIChsYXN0QmxvY2tHYW1lc1Byb2Nlc3NlZCA9PSBibG9jay5udW1iZXIpICByZXR1cm47CiAgICAgICAgIGxhc3RCbG9ja0dhbWVzUHJvY2Vzc2VkID0gYmxvY2subnVtYmVyOwogICAgICB9CgogICAgICB1aW50OCBkZWxheSA9IEJsb2NrRGVsYXk7CiAgICAgIHVpbnQyNTYgbGVuZ3RoID0gZ2FtZUluZGV4ZXMubGVuZ3RoOwogICAgICBib29sIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgZm9yKHVpbnQyNTYgaSA9IDA7aSA8IGxlbmd0aDtpKyspCiAgICAgIHsgICAgICAKICAgICAgICAgaWYgKFByb2Nlc3NHYW1lKGdhbWVJbmRleGVzW2ldLCBkZWxheSkgPT0gR2FtZVN0YXR1cy5TdWNjZXNzKSBzdWNjZXNzID0gdHJ1ZTsgICAgICAgICAKICAgICAgfSAgICAgIAogICAgICBpZiAoc2ltdWxhdGUgJiYgIXN1Y2Nlc3MpIHRocm93OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBQcm9jZXNzR2FtZUV4dCh1aW50MjU2IGluZGV4KSBwdWJsaWMgcmV0dXJucyAoR2FtZVN0YXR1cykKICAgIHsKICAgICAgcmV0dXJuIFByb2Nlc3NHYW1lKGluZGV4LCBCbG9ja0RlbGF5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBQcm9jZXNzR2FtZSh1aW50MjU2IGluZGV4LCB1aW50MjU2IGRlbGF5KSBwcml2YXRlIHJldHVybnMgKEdhbWVTdGF0dXMpCiAgICB7ICAgICAgICAgICAgCiAgICAgIEdhbWVJbmZvIG1lbW9yeSBnID0gZ2FtYmxlc1tpbmRleF07CiAgICAgIGlmIChibG9jay5udW1iZXIgLSBnLmJsb2NrTnVtYmVyID49IDI1NikgcmV0dXJuIEdhbWVTdGF0dXMuU3RvcDsKCiAgICAgIGlmIChnLndoZWVsUmVzdWx0ID09IDM3ICYmIGJsb2NrLm51bWJlciA+IGcuYmxvY2tOdW1iZXIgKyBkZWxheSkKICAgICAgeyAgICAgICAgICAgIAogICAgICAgICBnYW1ibGVzW2luZGV4XS53aGVlbFJlc3VsdCA9IGdldFJhbmRvbU51bWJlcihnLnBsYXllciwgZy5ibG9ja051bWJlcik7CiAgICAgICAgICAgICAgICAgCiAgICAgICAgIHVpbnQyNTYgcGxheWVyV2lubmluZ3MgPSBnZXRHYW1lUmVzdWx0KGdhbWJsZXNbaW5kZXhdKTsKICAgICAgICAgaWYgKHBsYXllcldpbm5pbmdzID4gMCkgCiAgICAgICAgIHsKICAgICAgICAgICAgaWYgKGcucGxheWVyLnNlbmQocGxheWVyV2lubmluZ3MpID09IGZhbHNlKSB0aHJvdzsKICAgICAgICAgfQoKICAgICAgICAgRW5kR2FtZShnLnBsYXllciwgZ2FtYmxlc1tpbmRleF0ud2hlZWxSZXN1bHQsIGluZGV4KTsKICAgICAgICAgcmV0dXJuIEdhbWVTdGF0dXMuU3VjY2VzczsKICAgICAgfQoKICAgICAgcmV0dXJuIEdhbWVTdGF0dXMuU2tpcHBlZDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSYW5kb21OdW1iZXIoYWRkcmVzcyBwbGF5ZXIsIHVpbnQyNTYgcGxheWVyYmxvY2spIHByaXZhdGUgcmV0dXJucyh1aW50OCB3aGVlbFJlc3VsdCkKICAgIHsKICAgICAgICAvLyBibG9jay5ibG9ja2hhc2ggLSBoYXNoIG9mIHRoZSBnaXZlbiBibG9jayAtIG9ubHkgd29ya3MgZm9yIDI1NiBtb3N0IHJlY2VudCBibG9ja3MgZXhjbHVkaW5nIGN1cnJlbnQKICAgICAgICBieXRlczMyIGJsb2NrSGFzaCA9IGJsb2NrLmJsb2NraGFzaChwbGF5ZXJibG9jaytCbG9ja0RlbGF5KTsgCiAgICAgICAgCiAgICAgICAgaWYgKGJsb2NrSGFzaD09MCkgCiAgICAgICAgewogICAgICAgICAgRXJyb3JMb2cobXNnLnNlbmRlciwgIkNhbm5vdCBnZW5lcmF0ZSByYW5kb20gbnVtYmVyIik7CiAgICAgICAgICB3aGVlbFJlc3VsdCA9IDIwMDsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIGJ5dGVzMzIgc2hhUGxheWVyID0gc2hhMyhwbGF5ZXIsIGJsb2NrSGFzaCk7CiAgICAKICAgICAgICAgIHdoZWVsUmVzdWx0ID0gdWludDgodWludDI1NihzaGFQbGF5ZXIpJTM3KTsKICAgICAgICB9ICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVJhbmRvbU51bWJlckJ5QmxvY2toYXNoKHVpbnQyNTYgYmxvY2tIYXNoLCBhZGRyZXNzIHBsYXllcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IHdoZWVsUmVzdWx0KSAKICAgIHsgCiAgICAgICAgICBieXRlczMyIHNoYVBsYXllciA9IHNoYTMocGxheWVyLCBibG9ja0hhc2gpOwogICAgCiAgICAgICAgICB3aGVlbFJlc3VsdCA9IHVpbnQ4KHVpbnQyNTYoc2hhUGxheWVyKSUzNyk7CiAgICB9CgogICAgZnVuY3Rpb24gZW1lcmdlbmN5Rml4R2FtZVJlc3VsdCh1aW50NjQgZ2FtYmxlSWQsIHVpbnQyNTYgYmxvY2tIYXNoKSBvbmx5RGV2ZWxvcGVyT3JPcGVyYXRvcgogICAgewogICAgICAvLyBQcm9iYWJseSB0aGlzIGZ1bmN0aW9uIHdpbGwgbmV2ZXIgYmUgY2FsbGVkLCBidXQKICAgICAgLy8gaWYgZ2FtZSB3YXMgbm90IHNwaW5uZWQgaW4gMjU2IGJsb2NrcyB0aGVuIGJsb2NrLmJsb2NraGFzaCB3aWxsIHJldHVybnMgYWx3YXlzIDAgYW5kIAogICAgICAvLyB3ZSBzaG91bGQgZml4IHRoaXMgbWFudWFsbHkgKHlvdSBjYW4gY2hlY2sgcmVzdWx0IHdpdGggcHVibGljIGZ1bmN0aW9uIGNhbGN1bGF0ZVJhbmRvbU51bWJlckJ5QmxvY2toYXNoKQogICAgICBHYW1lSW5mbyBtZW1vcnkgZ2FtYmxlID0gZ2FtYmxlc1tnYW1ibGVJZF07CiAgICAgIGlmIChnYW1ibGUud2hlZWxSZXN1bHQgIT0gMjAwKSB0aHJvdzsKCiAgICAgIGdhbWJsZXNbZ2FtYmxlSWRdLndoZWVsUmVzdWx0ID0gY2FsY3VsYXRlUmFuZG9tTnVtYmVyQnlCbG9ja2hhc2goYmxvY2tIYXNoLCBnYW1ibGUucGxheWVyKTsgICAgICAKCiAgICAgIHVpbnQyNTYgcGxheWVyV2lubmluZ3MgPSBnZXRHYW1lUmVzdWx0KGdhbWJsZXNbZ2FtYmxlSWRdKTsKICAgICAgaWYgKHBsYXllcldpbm5pbmdzID4gMCkKICAgICAgewogICAgICAgIGlmIChnYW1ibGUucGxheWVyLnNlbmQocGxheWVyV2lubmluZ3MpID09IGZhbHNlKSB0aHJvdzsKICAgICAgfSAgICAgIAoKICAgICAgRW5kR2FtZShnYW1ibGUucGxheWVyLCBnYW1ibGUud2hlZWxSZXN1bHQsIGdhbWJsZUlkKTsKICAgIH0KCgogICAgZnVuY3Rpb24gcHJlbGltaW5hcnlHYW1lUmVzdWx0KHVpbnQ2NCBnYW1ibGVJbmRleCkgY29uc3RhbnQgcmV0dXJucyAodWludDY0IGdhbWJsZUlkLCBhZGRyZXNzIHBsYXllciwgdWludDI1NiBibG9ja051bWJlciwgdWludDI1NiB0b3RhbFdpbiwgdWludDggd2hlZWxSZXN1bHQsIHVpbnQyNTYgYmV0cywgdWludDI1NiB2YWx1ZXMxLCB1aW50MjU2IHZhbHVlczIsIHVpbnQyNTYgblRvdGFsQmV0VmFsdWUsIHVpbnQyNTYgblRvdGFsQmV0Q291bnQpIAogICAgeyAKICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW3VpbnQyNTYoZ2FtYmxlSW5kZXgpXTsKICAgICAgCiAgICAgIGlmIChnLndoZWVsUmVzdWx0ID09IDM3ICYmIGJsb2NrLm51bWJlciA+IGcuYmxvY2tOdW1iZXIgKyBCbG9ja0RlbGF5KQogICAgICB7CiAgICAgICAgIGdhbWJsZXNbZ2FtYmxlSW5kZXhdLndoZWVsUmVzdWx0ID0gZ2V0UmFuZG9tTnVtYmVyKGcucGxheWVyLCBnLmJsb2NrTnVtYmVyKTsKICAgICAgICAgcmV0dXJuIGdldEdhbWUoZ2FtYmxlSW5kZXgpOwogICAgICB9CiAgICAgIHRocm93OyAgICAgIAogICAgfQoKICAgIC8vIFByZWxpbWluYXJ5IGdhbWUgcmVzdWx0IGJlZm9yZSByZWFsIHRyYW5zYWN0aW9uIGlzIG1pbmVkCiAgICBmdW5jdGlvbiBjYWxjUmFuZG9tTnVtYmVyQW5kR2V0UHJlbGltaW5hcnlHYW1lUmVzdWx0KHVpbnQyNTYgYmxvY2tIYXNoLCB1aW50NjQgZ2FtYmxlSW5kZXgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCBnYW1ibGVJZCwgYWRkcmVzcyBwbGF5ZXIsIHVpbnQyNTYgYmxvY2tOdW1iZXIsIHVpbnQyNTYgdG90YWxXaW4sIHVpbnQ4IHdoZWVsUmVzdWx0LCB1aW50MjU2IGJldHMsIHVpbnQyNTYgdmFsdWVzMSwgdWludDI1NiB2YWx1ZXMyLCB1aW50MjU2IG5Ub3RhbEJldFZhbHVlLCB1aW50MjU2IG5Ub3RhbEJldENvdW50KQogICAgeyAKICAgICAgR2FtZUluZm8gbWVtb3J5IGcgPSBnYW1ibGVzW3VpbnQyNTYoZ2FtYmxlSW5kZXgpXTsgICAgICAKICAgICAgZy53aGVlbFJlc3VsdCA9IGNhbGN1bGF0ZVJhbmRvbU51bWJlckJ5QmxvY2toYXNoKGJsb2NrSGFzaCwgZy5wbGF5ZXIpOyAgICAgIAoKICAgICAgZ2FtYmxlSWQgPSBnYW1ibGVJbmRleDsKICAgICAgcGxheWVyID0gZy5wbGF5ZXI7CiAgICAgIHdoZWVsUmVzdWx0ID0gZy53aGVlbFJlc3VsdDsgICAgICAKICAgICAgdG90YWxXaW4gPSBnZXRHYW1lUmVzdWx0KGcpOwogICAgICBibG9ja051bWJlciA9IGcuYmxvY2tOdW1iZXI7ICAgICAgICAgICAgICAKICAgICAgblRvdGFsQmV0VmFsdWUgPSB0b3RhbEJldFZhbHVlKGcpOwogICAgICBuVG90YWxCZXRDb3VudCA9IHRvdGFsQmV0Q291bnQoZyk7CiAgICAgIGJldHMgPSBnLmJldHM7CiAgICAgIHZhbHVlczEgPSB1aW50MjU2KGcudmFsdWVzKTsKICAgICAgdmFsdWVzMiA9IHVpbnQyNTYoZy52YWx1ZXMyKTsgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIGdldEdhbWVSZXN1bHQoR2FtZUluZm8gbWVtb3J5IGdhbWUpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiB0b3RhbFdpbikgCiAgICB7CiAgICAgICAgdG90YWxXaW4gPSAwOwogICAgICAgIHVpbnQ4IG5QbGF5ZXJCZXRObyA9IDA7CiAgICAgICAgLy8gd2Ugc2VudCBjb3VudCBiZXRzIGF0IGxhc3QgYnl0ZSAKICAgICAgICB1aW50OCBiZXRzQ291bnQgPSB1aW50OChieXRlczMyKGdhbWUuYmV0cylbMF0pOyAKICAgICAgICBmb3IodWludDggaT0wOyBpPG1heFR5cGVCZXRzOyBpKyspCiAgICAgICAgeyAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzQml0U2V0KGdhbWUuYmV0cywgaSkpCiAgICAgICAgICAgIHsgICAgICAgICAgICAgIAogICAgICAgICAgICAgIHZhciB3aW5NdWwgPSB3aW5NYXRyaXguZ2V0Q29lZmYoZ2V0SW5kZXgoaSwgZ2FtZS53aGVlbFJlc3VsdCkpOyAvLyBnZXQgd2luIGNvZWYKICAgICAgICAgICAgICBpZiAod2luTXVsID4gMCkgd2luTXVsKys7IC8vICsgcmV0dXJuIHBsYXllciBiZXQKICAgICAgICAgICAgICB0b3RhbFdpbiArPSB3aW5NdWwgKiBnZXRCZXRWYWx1ZUJ5R2FtYmxlKGdhbWUsIG5QbGF5ZXJCZXRObysxLGkpOwogICAgICAgICAgICAgIG5QbGF5ZXJCZXRObysrOyAKCiAgICAgICAgICAgICAgaWYgKGJldHNDb3VudCA9PSAxKSBicmVhazsKICAgICAgICAgICAgICBiZXRzQ291bnQtLTsKICAgICAgICAgICAgfQogICAgICAgIH0gICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIGdldEdhbWUodWludDY0IGluZGV4KSBjb25zdGFudCByZXR1cm5zICh1aW50NjQgZ2FtYmxlSWQsIGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IGJsb2NrTnVtYmVyLCB1aW50MjU2IHRvdGFsV2luLCB1aW50OCB3aGVlbFJlc3VsdCwgdWludDI1NiBiZXRzLCB1aW50MjU2IHZhbHVlczEsIHVpbnQyNTYgdmFsdWVzMiwgdWludDI1NiBuVG90YWxCZXRWYWx1ZSwgdWludDI1NiBuVG90YWxCZXRDb3VudCkgCiAgICB7CiAgICAgICAgZ2FtYmxlSWQgPSBpbmRleDsKICAgICAgICBwbGF5ZXIgPSBnYW1ibGVzW2luZGV4XS5wbGF5ZXI7CiAgICAgICAgdG90YWxXaW4gPSBnZXRHYW1lUmVzdWx0KGdhbWJsZXNbaW5kZXhdKTsKICAgICAgICBibG9ja051bWJlciA9IGdhbWJsZXNbaW5kZXhdLmJsb2NrTnVtYmVyOyAgICAgICAgCiAgICAgICAgd2hlZWxSZXN1bHQgPSBnYW1ibGVzW2luZGV4XS53aGVlbFJlc3VsdDsKICAgICAgICBuVG90YWxCZXRWYWx1ZSA9IHRvdGFsQmV0VmFsdWUoZ2FtYmxlc1tpbmRleF0pOwogICAgICAgIG5Ub3RhbEJldENvdW50ID0gdG90YWxCZXRDb3VudChnYW1ibGVzW2luZGV4XSk7CiAgICAgICAgYmV0cyA9IGdhbWJsZXNbaW5kZXhdLmJldHM7CiAgICAgICAgdmFsdWVzMSA9IHVpbnQyNTYoZ2FtYmxlc1tpbmRleF0udmFsdWVzKTsKICAgICAgICB2YWx1ZXMyID0gdWludDI1NihnYW1ibGVzW2luZGV4XS52YWx1ZXMyKTsgICAgICAgIAogICAgfQoKICAgZnVuY3Rpb24oKSAKICAgewogICAgICB0aHJvdzsKICAgfQogICAKCn0='.
	

]
