Class {
	#name : #SRT046c29984bebce5326e04dd16d23f33b527b0845,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT046c29984bebce5326e04dd16d23f33b527b0845 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTM7CgppbnRlcmZhY2UgRnVuZEludGVyZmFjZSB7CgogICAgLy8gRVZFTlRTCgogICAgZXZlbnQgUG9ydGZvbGlvQ29udGVudCh1aW50IGhvbGRpbmdzLCB1aW50IHByaWNlLCB1aW50IGRlY2ltYWxzKTsKICAgIGV2ZW50IFJlcXVlc3RVcGRhdGVkKHVpbnQgaWQpOwogICAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbmRleGVkIG9mUGFydGljaXBhbnQsIHVpbnQgYXRUaW1lc3RhbXAsIHVpbnQgc2hhcmVRdWFudGl0eSk7CiAgICBldmVudCBSZWRlZW1lZChhZGRyZXNzIGluZGV4ZWQgb2ZQYXJ0aWNpcGFudCwgdWludCBhdFRpbWVzdGFtcCwgdWludCBzaGFyZVF1YW50aXR5KTsKICAgIGV2ZW50IFNwZW5kaW5nQXBwcm92ZWQoYWRkcmVzcyBvbkNvbnNpZ25lZCwgYWRkcmVzcyBvZkFzc2V0LCB1aW50IGFtb3VudCk7CiAgICBldmVudCBGZWVzQ29udmVydGVkKHVpbnQgYXRUaW1lc3RhbXAsIHVpbnQgc2hhcmVRdWFudGl0eUNvbnZlcnRlZCwgdWludCB1bmNsYWltZWQpOwogICAgZXZlbnQgQ2FsY3VsYXRpb25VcGRhdGUodWludCBhdFRpbWVzdGFtcCwgdWludCBtYW5hZ2VtZW50RmVlLCB1aW50IHBlcmZvcm1hbmNlRmVlLCB1aW50IG5hdiwgdWludCBzaGFyZVByaWNlLCB1aW50IHRvdGFsU3VwcGx5KTsKICAgIGV2ZW50IE9yZGVyVXBkYXRlZCh1aW50IGlkKTsKICAgIGV2ZW50IExvZ0Vycm9yKHVpbnQgRVJST1JfQ09ERSk7CiAgICBldmVudCBFcnJvck1lc3NhZ2Uoc3RyaW5nIGVycm9yTWVzc2FnZSk7CgogICAgLy8gRVhURVJOQUwgTUVUSE9EUwogICAgLy8gQ29tcGxpYW5jZSBieSBJbnZlc3RvcgogICAgZnVuY3Rpb24gcmVxdWVzdEludmVzdG1lbnQodWludCBnaXZlUXVhbnRpdHksIHVpbnQgc2hhcmVRdWFudGl0eSwgYm9vbCBpc05hdGl2ZUFzc2V0KSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHJlcXVlc3RSZWRlbXB0aW9uKHVpbnQgc2hhcmVRdWFudGl0eSwgdWludCByZWNlaXZlUXVhbnRpdHksIGJvb2wgaXNOYXRpdmVBc3NldCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBleGVjdXRlUmVxdWVzdCh1aW50IHJlcXVlc3RJZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBjYW5jZWxSZXF1ZXN0KHVpbnQgcmVxdWVzdElkKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHJlZGVlbUFsbE93bmVkQXNzZXRzKHVpbnQgc2hhcmVRdWFudGl0eSkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7CiAgICAvLyBBZG1pbmlzdHJhdGlvbiBieSBNYW5hZ2VyCiAgICBmdW5jdGlvbiBlbmFibGVJbnZlc3RtZW50KCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBkaXNhYmxlSW52ZXN0bWVudCgpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gZW5hYmxlUmVkZW1wdGlvbigpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gZGlzYWJsZVJlZGVtcHRpb24oKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNodXREb3duKCkgZXh0ZXJuYWw7CiAgICAvLyBNYW5hZ2luZyBieSBNYW5hZ2VyCiAgICBmdW5jdGlvbiBtYWtlT3JkZXIodWludCBleGNoYW5nZUlkLCBhZGRyZXNzIHNlbGxBc3NldCwgYWRkcmVzcyBidXlBc3NldCwgdWludCBzZWxsUXVhbnRpdHksIHVpbnQgYnV5UXVhbnRpdHkpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdGFrZU9yZGVyKHVpbnQgZXhjaGFuZ2VJZCwgdWludCBpZCwgdWludCBxdWFudGl0eSkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcih1aW50IGV4Y2hhbmdlSWQsIHVpbnQgaWQpIGV4dGVybmFsOwoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCiAgICBmdW5jdGlvbiBlbWVyZ2VuY3lSZWRlZW0odWludCBzaGFyZVF1YW50aXR5LCBhZGRyZXNzW10gcmVxdWVzdGVkQXNzZXRzKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGNhbGNTaGFyZVByaWNlQW5kQWxsb2NhdGVGZWVzKCkgcHVibGljIHJldHVybnMgKHVpbnQpOwoKCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCiAgICAvLyBHZXQgZ2VuZXJhbCBpbmZvcm1hdGlvbgogICAgZnVuY3Rpb24gZ2V0TW9kdWxlcygpIHZpZXcgcmV0dXJucyAoYWRkcmVzcywgYWRkcmVzcywgYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRMYXN0T3JkZXJJZCgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRMYXN0UmVxdWVzdElkKCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGdldE5hbWVIYXNoKCkgdmlldyByZXR1cm5zIChieXRlczMyKTsKICAgIGZ1bmN0aW9uIGdldE1hbmFnZXIoKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwoKICAgIC8vIEdldCBhY2NvdW50aW5nIGluZm9ybWF0aW9uCiAgICBmdW5jdGlvbiBwZXJmb3JtQ2FsY3VsYXRpb25zKCkgdmlldyByZXR1cm5zICh1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50LCB1aW50KTsKICAgIGZ1bmN0aW9uIGNhbGNTaGFyZVByaWNlKCkgdmlldyByZXR1cm5zICh1aW50KTsKfQoKY29udHJhY3QgRnVuZFJhbmtpbmcgewoKICAgIFZlcnNpb24gcHVibGljIHZlcnNpb247CgogICAgLy8vIEBkZXYgSW5zdGFudGlhdGUgYWNjb3JkaW5nIHRvIGEgc3BlY2lmaWMgTWVsb24gcHJvdG9jb2wgdmVyc2lvbgogICAgLy8vIEBwYXJhbSBvZlZlcnNpb24gQWRkcmVzcyBvZiBNZWxvbiBwcm90b2NvbCB2ZXJzaW9uIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBGdW5kUmFua2luZyhhZGRyZXNzIG9mVmVyc2lvbikgewogICAgICAgIHZlcnNpb24gPSBWZXJzaW9uKG9mVmVyc2lvbik7CiAgICB9CgogICAgLyoqCiAgICBAbm90aWNlIFJldHVybnMgYW4gYXJyYXkgb2YgZnVuZCBhZGRyZXNzZXMgYW5kIGFzc29jaWF0ZWQgYXJyYXlzIG9mIHNoYXJlIHByaWNlcyBhbmQgY3JlYXRpb24gdGltZXMKICAgIEBkZXYgUmV0dXJuIHZhbHVlIG9ubHkgdy5yLnQuIHNwZWNpZmllZCB2ZXJzaW9uIGNvbnRyYWN0CiAgICBAcmV0dXJuIHsKICAgICAgImZ1bmRBZGRycyI6ICJBcnJheSBvZiBhZGRyZXNzZXMgb2YgTWVsb24gRnVuZHMiLAogICAgICAic2hhcmVQcmljZXMiOiAiQXJyYXkgb2YgdWludHMgY29udGFpbmluZyBzaGFyZSBwcmljZXMgb2YgYWJvdmUgTWVsb24gRnVuZCBhZGRyZXNzZXMiCiAgICAgICJjcmVhdGlvblRpbWVzIjogIkFycmF5IG9mIHVpbnRzIHJlcHJlc2VudGluZyB0aGUgdW5peCB0aW1lc3RhbXAgZm9yIGNyZWF0aW9uIG9mIGVhY2ggRnVuZCIKICAgIH0KICAgICovCiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzQW5kU2hhcmVQcmljZU9mRnVuZHMoKQogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKAogICAgICAgICAgICBhZGRyZXNzW10sCiAgICAgICAgICAgIHVpbnRbXSwKICAgICAgICAgICAgdWludFtdCiAgICAgICAgKQogICAgewogICAgICAgIHVpbnQgbm9mRnVuZHMgPSB2ZXJzaW9uLmdldExhc3RGdW5kSWQoKSArIDE7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSBmdW5kQWRkcnMgPSBuZXcgYWRkcmVzc1tdKG5vZkZ1bmRzKTsKICAgICAgICB1aW50W10gbWVtb3J5IHNoYXJlUHJpY2VzID0gbmV3IHVpbnRbXShub2ZGdW5kcyk7CiAgICAgICAgdWludFtdIG1lbW9yeSBjcmVhdGlvblRpbWVzID0gbmV3IHVpbnRbXShub2ZGdW5kcyk7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG5vZkZ1bmRzOyBpKyspIHsKICAgICAgICAgICAgYWRkcmVzcyBmdW5kQWRkcmVzcyA9IHZlcnNpb24uZ2V0RnVuZEJ5SWQoaSk7CiAgICAgICAgICAgIEZ1bmQgZnVuZCA9IEZ1bmQoZnVuZEFkZHJlc3MpOwogICAgICAgICAgICB1aW50IHNoYXJlUHJpY2UgPSBmdW5kLmNhbGNTaGFyZVByaWNlKCk7CiAgICAgICAgICAgIHVpbnQgY3JlYXRpb25UaW1lID0gZnVuZC5nZXRDcmVhdGlvblRpbWUoKTsKICAgICAgICAgICAgZnVuZEFkZHJzW2ldID0gZnVuZEFkZHJlc3M7CiAgICAgICAgICAgIHNoYXJlUHJpY2VzW2ldID0gc2hhcmVQcmljZTsKICAgICAgICAgICAgY3JlYXRpb25UaW1lc1tpXSA9IGNyZWF0aW9uVGltZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChmdW5kQWRkcnMsIHNoYXJlUHJpY2VzLCBjcmVhdGlvblRpbWVzKTsKICAgIH0KfQoKaW50ZXJmYWNlIEFzc2V0SW50ZXJmYWNlIHsKICAgIC8qCiAgICAgKiBJbXBsZW1lbnRzIEVSQyAyMCBzdGFuZGFyZC4KICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2Jsb2IvZjkwODY0YTNkMmIyYjQ1YzRkZWNmOTVlZmQyNmIzZjBjMjc2MDUxYS9FSVBTL2VpcC0yMC10b2tlbi1zdGFuZGFyZC5tZAogICAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAgICAgKgogICAgICogIEFkZGVkIHN1cHBvcnQgZm9yIHRoZSBFUkMgMjIzICJ0b2tlbkZhbGxiYWNrIiBtZXRob2QgaW4gYSAidHJhbnNmZXIiIGZ1bmN0aW9uIHdpdGggYSBwYXlsb2FkLgogICAgICogIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMjMKICAgICAqLwoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKCiAgICAvLyBUaGVyZSBpcyBubyBFUkMyMjMgY29tcGF0aWJsZSBUcmFuc2ZlciBldmVudCwgd2l0aCBgX2RhdGFgIGluY2x1ZGVkLgoKICAgIC8vRVJDIDIyMwogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vIEVSQyAyMAogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJlbWFpbmluZyk7Cn0KCmludGVyZmFjZSBFUkMyMjNJbnRlcmZhY2UgewogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKTsKfQoKaW50ZXJmYWNlIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHsKCiAgICAvLy8gQGRldiBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgdXNlciBvciBhbm90aGVyIGNvbnRyYWN0IHdhbnRzIHRvIHRyYW5zZmVyIGZ1bmRzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUcmFuc2FjdGlvbiBpbml0aWF0b3IsIGFuYWxvZ3VlIG9mIG1zZy5zZW5kZXIKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIF9kYXRhIERhdGEgY29udGFpbmluZyBhIGZ1bmN0aW9uIHNpZ25hdHVyZSBhbmQvb3IgcGFyYW1ldGVycwogICAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYzsKfQoKaW50ZXJmYWNlIE5hdGl2ZUFzc2V0SW50ZXJmYWNlIHsKCiAgICAvLyBQVUJMSUMgTUVUSE9EUwogICAgZnVuY3Rpb24gZGVwb3NpdCgpIHB1YmxpYyBwYXlhYmxlOwogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludCB3YWQpIHB1YmxpYzsKfQoKaW50ZXJmYWNlIFNoYXJlc0ludGVyZmFjZSB7CgogICAgZXZlbnQgQ3JlYXRlZChhZGRyZXNzIGluZGV4ZWQgb2ZQYXJ0aWNpcGFudCwgdWludCBhdFRpbWVzdGFtcCwgdWludCBzaGFyZVF1YW50aXR5KTsKICAgIGV2ZW50IEFubmloaWxhdGVkKGFkZHJlc3MgaW5kZXhlZCBvZlBhcnRpY2lwYW50LCB1aW50IGF0VGltZXN0YW1wLCB1aW50IHNoYXJlUXVhbnRpdHkpOwoKICAgIC8vIFZJRVcgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGdldE5hbWUoKSB2aWV3IHJldHVybnMgKHN0cmluZyk7CiAgICBmdW5jdGlvbiBnZXRTeW1ib2woKSB2aWV3IHJldHVybnMgKHN0cmluZyk7CiAgICBmdW5jdGlvbiBnZXREZWNpbWFscygpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRDcmVhdGlvblRpbWUoKSB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gdG9TbWFsbGVzdFNoYXJlVW5pdCh1aW50IHF1YW50aXR5KSB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gdG9XaG9sZVNoYXJlVW5pdCh1aW50IHF1YW50aXR5KSB2aWV3IHJldHVybnMgKHVpbnQpOwoKfQoKaW50ZXJmYWNlIENvbXBsaWFuY2VJbnRlcmZhY2UgewoKICAgIC8vIFBVQkxJQyBWSUVXIE1FVEhPRFMKCiAgICAvLy8gQG5vdGljZSBDaGVja3Mgd2hldGhlciBpbnZlc3RtZW50IGlzIHBlcm1pdHRlZCBmb3IgYSBwYXJ0aWNpcGFudAogICAgLy8vIEBwYXJhbSBvZlBhcnRpY2lwYW50IEFkZHJlc3MgcmVxdWVzdGluZyB0byBpbnZlc3QgaW4gYSBNZWxvbiBmdW5kCiAgICAvLy8gQHBhcmFtIGdpdmVRdWFudGl0eSBRdWFudGl0eSBvZiBNZWxvbiB0b2tlbiB0aW1lcyAxMCAqKiAxOCBvZmZlcmVkIHRvIHJlY2VpdmUgc2hhcmVRdWFudGl0eQogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IFF1YW50aXR5IG9mIHNoYXJlcyB0aW1lcyAxMCAqKiAxOCByZXF1ZXN0ZWQgdG8gYmUgcmVjZWl2ZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgaWRlbnRpdHkgaXMgZWxpZ2libGUgdG8gaW52ZXN0IGluIGEgTWVsb24gZnVuZC4KICAgIGZ1bmN0aW9uIGlzSW52ZXN0bWVudFBlcm1pdHRlZCgKICAgICAgICBhZGRyZXNzIG9mUGFydGljaXBhbnQsCiAgICAgICAgdWludDI1NiBnaXZlUXVhbnRpdHksCiAgICAgICAgdWludDI1NiBzaGFyZVF1YW50aXR5CiAgICApIHZpZXcgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIHdoZXRoZXIgcmVkZW1wdGlvbiBpcyBwZXJtaXR0ZWQgZm9yIGEgcGFydGljaXBhbnQKICAgIC8vLyBAcGFyYW0gb2ZQYXJ0aWNpcGFudCBBZGRyZXNzIHJlcXVlc3RpbmcgdG8gcmVkZWVtIGZyb20gYSBNZWxvbiBmdW5kCiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2hhcmVzIHRpbWVzIDEwICoqIDE4IG9mZmVyZWQgdG8gcmVkZWVtCiAgICAvLy8gQHBhcmFtIHJlY2VpdmVRdWFudGl0eSBRdWFudGl0eSBvZiBNZWxvbiB0b2tlbiB0aW1lcyAxMCAqKiAxOCByZXF1ZXN0ZWQgdG8gcmVjZWl2ZSBmb3Igc2hhcmVRdWFudGl0eQogICAgLy8vIEByZXR1cm4gV2hldGhlciBpZGVudGl0eSBpcyBlbGlnaWJsZSB0byByZWRlZW0gZnJvbSBhIE1lbG9uIGZ1bmQuCiAgICBmdW5jdGlvbiBpc1JlZGVtcHRpb25QZXJtaXR0ZWQoCiAgICAgICAgYWRkcmVzcyBvZlBhcnRpY2lwYW50LAogICAgICAgIHVpbnQyNTYgc2hhcmVRdWFudGl0eSwKICAgICAgICB1aW50MjU2IHJlY2VpdmVRdWFudGl0eQogICAgKSB2aWV3IHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBEQkMgewoKICAgIC8vIE1PRElGSUVSUwoKICAgIG1vZGlmaWVyIHByZV9jb25kKGJvb2wgY29uZGl0aW9uKSB7CiAgICAgICAgcmVxdWlyZShjb25kaXRpb24pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcG9zdF9jb25kKGJvb2wgY29uZGl0aW9uKSB7CiAgICAgICAgXzsKICAgICAgICBhc3NlcnQoY29uZGl0aW9uKTsKICAgIH0KCiAgICBtb2RpZmllciBpbnZhcmlhbnQoYm9vbCBjb25kaXRpb24pIHsKICAgICAgICByZXF1aXJlKGNvbmRpdGlvbik7CiAgICAgICAgXzsKICAgICAgICBhc3NlcnQoY29uZGl0aW9uKTsKICAgIH0KfQoKY29udHJhY3QgT3duZWQgaXMgREJDIHsKCiAgICAvLyBGSUVMRFMKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgICAvLyBOT04tQ09OU1RBTlQgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIE93bmVkKCkgeyBvd25lciA9IG1zZy5zZW5kZXI7IH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIG9mTmV3T3duZXIpIHByZV9jb25kKGlzT3duZXIoKSkgeyBvd25lciA9IG9mTmV3T3duZXI7IH0KCiAgICAvLyBQUkUsIFBPU1QsIElOVkFSSUFOVCBDT05ESVRJT05TCgogICAgZnVuY3Rpb24gaXNPd25lcigpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsgcmV0dXJuIG1zZy5zZW5kZXIgPT0gb3duZXI7IH0KCn0KCmludGVyZmFjZSBFeGNoYW5nZUludGVyZmFjZSB7CgogICAgLy8gRVZFTlRTCgogICAgZXZlbnQgT3JkZXJVcGRhdGVkKHVpbnQgaWQpOwoKICAgIC8vIE1FVEhPRFMKICAgIC8vIEVYVEVSTkFMIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBtYWtlT3JkZXIoCiAgICAgICAgYWRkcmVzcyBvbkV4Y2hhbmdlLAogICAgICAgIGFkZHJlc3Mgc2VsbEFzc2V0LAogICAgICAgIGFkZHJlc3MgYnV5QXNzZXQsCiAgICAgICAgdWludCBzZWxsUXVhbnRpdHksCiAgICAgICAgdWludCBidXlRdWFudGl0eQogICAgKSBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIHRha2VPcmRlcihhZGRyZXNzIG9uRXhjaGFuZ2UsIHVpbnQgaWQsIHVpbnQgcXVhbnRpdHkpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gY2FuY2VsT3JkZXIoYWRkcmVzcyBvbkV4Y2hhbmdlLCB1aW50IGlkKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKCgogICAgLy8gUFVCTElDIE1FVEhPRFMKICAgIC8vIFBVQkxJQyBWSUVXIE1FVEhPRFMKCiAgICBmdW5jdGlvbiBpc0FwcHJvdmVPbmx5KCkgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldExhc3RPcmRlcklkKGFkZHJlc3Mgb25FeGNoYW5nZSkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGlzQWN0aXZlKGFkZHJlc3Mgb25FeGNoYW5nZSwgdWludCBpZCkgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldE93bmVyKGFkZHJlc3Mgb25FeGNoYW5nZSwgdWludCBpZCkgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldE9yZGVyKGFkZHJlc3Mgb25FeGNoYW5nZSwgdWludCBpZCkgdmlldyByZXR1cm5zIChhZGRyZXNzLCBhZGRyZXNzLCB1aW50LCB1aW50KTsKICAgIGZ1bmN0aW9uIGdldFRpbWVzdGFtcChhZGRyZXNzIG9uRXhjaGFuZ2UsIHVpbnQgaWQpIHZpZXcgcmV0dXJucyAodWludCk7Cgp9CgppbnRlcmZhY2UgUHJpY2VGZWVkSW50ZXJmYWNlIHsKCiAgICAvLyBFVkVOVFMKCiAgICBldmVudCBQcmljZVVwZGF0ZWQodWludCB0aW1lc3RhbXApOwoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgZnVuY3Rpb24gdXBkYXRlKGFkZHJlc3NbXSBvZkFzc2V0cywgdWludFtdIG5ld1ByaWNlcyk7CgogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIC8vIEdldCBhc3NldCBzcGVjaWZpYyBpbmZvcm1hdGlvbgogICAgZnVuY3Rpb24gZ2V0TmFtZShhZGRyZXNzIG9mQXNzZXQpIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIGdldFN5bWJvbChhZGRyZXNzIG9mQXNzZXQpIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIGdldERlY2ltYWxzKGFkZHJlc3Mgb2ZBc3NldCkgdmlldyByZXR1cm5zICh1aW50KTsKICAgIC8vIEdldCBwcmljZSBmZWVkIG9wZXJhdGlvbiBzcGVjaWZpYyBpbmZvcm1hdGlvbgogICAgZnVuY3Rpb24gZ2V0UXVvdGVBc3NldCgpIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRJbnRlcnZhbCgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRWYWxpZGl0eSgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRMYXN0VXBkYXRlSWQoKSB2aWV3IHJldHVybnMgKHVpbnQpOwogICAgLy8gR2V0IGFzc2V0IHNwZWNpZmljIGluZm9ybWF0aW9uIGFzIHVwZGF0ZWQgaW4gcHJpY2UgZmVlZAogICAgZnVuY3Rpb24gaGFzUmVjZW50UHJpY2UoYWRkcmVzcyBvZkFzc2V0KSB2aWV3IHJldHVybnMgKGJvb2wgaXNSZWNlbnQpOwogICAgZnVuY3Rpb24gaGFzUmVjZW50UHJpY2VzKGFkZHJlc3NbXSBvZkFzc2V0cykgdmlldyByZXR1cm5zIChib29sIGFyZVJlY2VudCk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShhZGRyZXNzIG9mQXNzZXQpIHZpZXcgcmV0dXJucyAoYm9vbCBpc1JlY2VudCwgdWludCBwcmljZSwgdWludCBkZWNpbWFsKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlcyhhZGRyZXNzW10gb2ZBc3NldHMpIHZpZXcgcmV0dXJucyAoYm9vbCBhcmVSZWNlbnQsIHVpbnRbXSBwcmljZXMsIHVpbnRbXSBkZWNpbWFscyk7CiAgICBmdW5jdGlvbiBnZXRJbnZlcnRlZFByaWNlKGFkZHJlc3Mgb2ZBc3NldCkgdmlldyByZXR1cm5zIChib29sIGlzUmVjZW50LCB1aW50IGludmVydGVkUHJpY2UsIHVpbnQgZGVjaW1hbCk7CiAgICBmdW5jdGlvbiBnZXRSZWZlcmVuY2VQcmljZShhZGRyZXNzIG9mQmFzZSwgYWRkcmVzcyBvZlF1b3RlKSB2aWV3IHJldHVybnMgKGJvb2wgaXNSZWNlbnQsIHVpbnQgcmVmZXJlbmNlUHJpY2UsIHVpbnQgZGVjaW1hbCk7CiAgICBmdW5jdGlvbiBnZXRPcmRlclByaWNlKAogICAgICAgIGFkZHJlc3Mgc2VsbEFzc2V0LAogICAgICAgIGFkZHJlc3MgYnV5QXNzZXQsCiAgICAgICAgdWludCBzZWxsUXVhbnRpdHksCiAgICAgICAgdWludCBidXlRdWFudGl0eQogICAgKSB2aWV3IHJldHVybnMgKHVpbnQgb3JkZXJQcmljZSk7CiAgICBmdW5jdGlvbiBleGlzdHNQcmljZU9uQXNzZXRQYWlyKGFkZHJlc3Mgc2VsbEFzc2V0LCBhZGRyZXNzIGJ1eUFzc2V0KSB2aWV3IHJldHVybnMgKGJvb2wgaXNFeGlzdGVudCk7Cn0KCmludGVyZmFjZSBSaXNrTWdtdEludGVyZmFjZSB7CgogICAgLy8gTUVUSE9EUwogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIC8vLyBAbm90aWNlIENoZWNrcyBpZiB0aGUgbWFrZU9yZGVyIHByaWNlIGlzIHJlYXNvbmFibGUgYW5kIG5vdCBtYW5pcHVsYXRpdmUKICAgIC8vLyBAcGFyYW0gb3JkZXJQcmljZSBQcmljZSBvZiBPcmRlcgogICAgLy8vIEBwYXJhbSByZWZlcmVuY2VQcmljZSBSZWZlcmVuY2UgcHJpY2Ugb2J0YWluZWQgdGhyb3VnaCBQcmljZUZlZWQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gc2VsbEFzc2V0IEFzc2V0IChhcyByZWdpc3RlcmVkIGluIEFzc2V0IHJlZ2lzdHJhcikgdG8gYmUgc29sZAogICAgLy8vIEBwYXJhbSBidXlBc3NldCBBc3NldCAoYXMgcmVnaXN0ZXJlZCBpbiBBc3NldCByZWdpc3RyYXIpIHRvIGJlIGJvdWdodAogICAgLy8vIEBwYXJhbSBzZWxsUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2VsbEFzc2V0IHRvIGJlIHNvbGQKICAgIC8vLyBAcGFyYW0gYnV5UXVhbnRpdHkgUXVhbnRpdHkgb2YgYnV5QXNzZXQgdG8gYmUgYm91Z2h0CiAgICAvLy8gQHJldHVybiBJZiBtYWtlT3JkZXIgaXMgcGVybWl0dGVkCiAgICBmdW5jdGlvbiBpc01ha2VQZXJtaXR0ZWQoCiAgICAgICAgdWludCBvcmRlclByaWNlLAogICAgICAgIHVpbnQgcmVmZXJlbmNlUHJpY2UsCiAgICAgICAgYWRkcmVzcyBzZWxsQXNzZXQsCiAgICAgICAgYWRkcmVzcyBidXlBc3NldCwKICAgICAgICB1aW50IHNlbGxRdWFudGl0eSwKICAgICAgICB1aW50IGJ1eVF1YW50aXR5CiAgICApIHZpZXcgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgQ2hlY2tzIGlmIHRoZSB0YWtlT3JkZXIgcHJpY2UgaXMgcmVhc29uYWJsZSBhbmQgbm90IG1hbmlwdWxhdGl2ZQogICAgLy8vIEBwYXJhbSBvcmRlclByaWNlIFByaWNlIG9mIE9yZGVyCiAgICAvLy8gQHBhcmFtIHJlZmVyZW5jZVByaWNlIFJlZmVyZW5jZSBwcmljZSBvYnRhaW5lZCB0aHJvdWdoIFByaWNlRmVlZCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBzZWxsQXNzZXQgQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBzb2xkCiAgICAvLy8gQHBhcmFtIGJ1eUFzc2V0IEFzc2V0IChhcyByZWdpc3RlcmVkIGluIEFzc2V0IHJlZ2lzdHJhcikgdG8gYmUgYm91Z2h0CiAgICAvLy8gQHBhcmFtIHNlbGxRdWFudGl0eSBRdWFudGl0eSBvZiBzZWxsQXNzZXQgdG8gYmUgc29sZAogICAgLy8vIEBwYXJhbSBidXlRdWFudGl0eSBRdWFudGl0eSBvZiBidXlBc3NldCB0byBiZSBib3VnaHQKICAgIC8vLyBAcmV0dXJuIElmIHRha2VPcmRlciBpcyBwZXJtaXR0ZWQKICAgIGZ1bmN0aW9uIGlzVGFrZVBlcm1pdHRlZCgKICAgICAgICB1aW50IG9yZGVyUHJpY2UsCiAgICAgICAgdWludCByZWZlcmVuY2VQcmljZSwKICAgICAgICBhZGRyZXNzIHNlbGxBc3NldCwKICAgICAgICBhZGRyZXNzIGJ1eUFzc2V0LAogICAgICAgIHVpbnQgc2VsbFF1YW50aXR5LAogICAgICAgIHVpbnQgYnV5UXVhbnRpdHkKICAgICkgdmlldyByZXR1cm5zIChib29sKTsKfQoKaW50ZXJmYWNlIFZlcnNpb25JbnRlcmZhY2UgewoKICAgIC8vIEVWRU5UUwoKICAgIGV2ZW50IEZ1bmRVcGRhdGVkKHVpbnQgaWQpOwoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgZnVuY3Rpb24gc2h1dERvd24oKSBleHRlcm5hbDsKCiAgICBmdW5jdGlvbiBzZXR1cEZ1bmQoCiAgICAgICAgc3RyaW5nIG9mRnVuZE5hbWUsCiAgICAgICAgYWRkcmVzcyBvZlF1b3RlQXNzZXQsCiAgICAgICAgdWludCBvZk1hbmFnZW1lbnRGZWUsCiAgICAgICAgdWludCBvZlBlcmZvcm1hbmNlRmVlLAogICAgICAgIGFkZHJlc3Mgb2ZDb21wbGlhbmNlLAogICAgICAgIGFkZHJlc3Mgb2ZSaXNrTWdtdCwKICAgICAgICBhZGRyZXNzIG9mUHJpY2VGZWVkLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlcywKICAgICAgICBhZGRyZXNzW10gb2ZFeGNoYW5nZUFkYXB0ZXJzLAogICAgICAgIHVpbnQ4IHYsCiAgICAgICAgYnl0ZXMzMiByLAogICAgICAgIGJ5dGVzMzIgcwogICAgKTsKICAgIGZ1bmN0aW9uIHNodXREb3duRnVuZChhZGRyZXNzIG9mRnVuZCk7CgogICAgLy8gUFVCTElDIFZJRVcgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIGdldE5hdGl2ZUFzc2V0KCkgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldEZ1bmRCeUlkKHVpbnQgd2l0aElkKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gZ2V0TGFzdEZ1bmRJZCgpIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiBnZXRGdW5kQnlNYW5hZ2VyKGFkZHJlc3Mgb2ZNYW5hZ2VyKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpOwogICAgZnVuY3Rpb24gdGVybXNBbmRDb25kaXRpb25zQXJlU2lnbmVkKHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSB2aWV3IHJldHVybnMgKGJvb2wgc2lnbmVkKTsKCn0KCmNvbnRyYWN0IFZlcnNpb24gaXMgREJDLCBPd25lZCwgVmVyc2lvbkludGVyZmFjZSB7CiAgICAvLyBGSUVMRFMKCiAgICAvLyBDb25zdGFudCBmaWVsZHMKICAgIGJ5dGVzMzIgcHVibGljIGNvbnN0YW50IFRFUk1TX0FORF9DT05ESVRJT05TID0gMHg0NzE3MzI4NWE4ZDczNDFlNWU5NzJmYzY3NzI4NjM4NGY4MDJmOGVmNDJhNWVjNWYwM2JiZmEyNTRjYjAxZmFkOyAvLyBIYXNoZWQgdGVybXMgYW5kIGNvbmRpdGlvbnMgYXMgZGlzcGxheWVkIG9uIElQRlMuCiAgICAvLyBDb25zdHJ1Y3RvciBmaWVsZHMKICAgIHN0cmluZyBwdWJsaWMgVkVSU0lPTl9OVU1CRVI7IC8vIFNlbVZlciBvZiBNZWxvbiBwcm90b2NvbCB2ZXJzaW9uCiAgICBhZGRyZXNzIHB1YmxpYyBOQVRJVkVfQVNTRVQ7IC8vIEFkZHJlc3Mgb2Ygd3JhcHBlZCBuYXRpdmUgYXNzZXQgY29udHJhY3QKICAgIGFkZHJlc3MgcHVibGljIEdPVkVSTkFOQ0U7IC8vIEFkZHJlc3Mgb2YgTWVsb24gcHJvdG9jb2wgZ292ZXJuYW5jZSBjb250cmFjdAogICAgLy8gTWV0aG9kcyBmaWVsZHMKICAgIGJvb2wgcHVibGljIGlzU2h1dERvd247IC8vIEdvdmVybmFuY2UgZmVhdHVyZSwgaWYgeWVzIHRoYW4gc2V0dXBGdW5kIGdldHMgYmxvY2tlZCBhbmQgc2h1dERvd25GdW5kIGdldHMgb3BlbmVkCiAgICBhZGRyZXNzW10gcHVibGljIGxpc3RPZkZ1bmRzOyAvLyBBIGNvbXBsZXRlIGxpc3Qgb2YgZnVuZCBhZGRyZXNzZXMgY3JlYXRlZCB1c2luZyB0aGlzIHZlcnNpb24KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYWRkcmVzcykgcHVibGljIG1hbmFnZXJUb0Z1bmRzOyAvLyBMaW5rcyBtYW5hZ2VyIGFkZHJlc3MgdG8gZnVuZCBhZGRyZXNzIGNyZWF0ZWQgdXNpbmcgdGhpcyB2ZXJzaW9uCgogICAgLy8gRVZFTlRTCgogICAgZXZlbnQgRnVuZFVwZGF0ZWQoYWRkcmVzcyBvZkZ1bmQpOwoKICAgIC8vIE1FVEhPRFMKCiAgICAvLyBDT05TVFJVQ1RPUgoKICAgIC8vLyBAcGFyYW0gdmVyc2lvbk51bWJlciBTZW1WZXIgb2YgTWVsb24gcHJvdG9jb2wgdmVyc2lvbgogICAgLy8vIEBwYXJhbSBvZkdvdmVybmFuY2UgQWRkcmVzcyBvZiBNZWxvbiBnb3Zlcm5hbmNlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIG9mTmF0aXZlQXNzZXQgQWRkcmVzcyBvZiB3cmFwcGVkIG5hdGl2ZSBhc3NldCBjb250cmFjdAogICAgZnVuY3Rpb24gVmVyc2lvbigKICAgICAgICBzdHJpbmcgdmVyc2lvbk51bWJlciwKICAgICAgICBhZGRyZXNzIG9mR292ZXJuYW5jZSwKICAgICAgICBhZGRyZXNzIG9mTmF0aXZlQXNzZXQKICAgICkgewogICAgICAgIFZFUlNJT05fTlVNQkVSID0gdmVyc2lvbk51bWJlcjsKICAgICAgICBHT1ZFUk5BTkNFID0gb2ZHb3Zlcm5hbmNlOwogICAgICAgIE5BVElWRV9BU1NFVCA9IG9mTmF0aXZlQXNzZXQ7CiAgICB9CgogICAgLy8gRVhURVJOQUwgTUVUSE9EUwoKICAgIGZ1bmN0aW9uIHNodXREb3duKCkgZXh0ZXJuYWwgcHJlX2NvbmQobXNnLnNlbmRlciA9PSBHT1ZFUk5BTkNFKSB7IGlzU2h1dERvd24gPSB0cnVlOyB9CgogICAgLy8gUFVCTElDIE1FVEhPRFMKCiAgICAvLy8gQHBhcmFtIG9mRnVuZE5hbWUgaHVtYW4tcmVhZGFibGUgZGVzY3JpcHRpdmUgbmFtZSAobm90IG5lY2Vzc2FyaWx5IHVuaXF1ZSkKICAgIC8vLyBAcGFyYW0gb2ZRdW90ZUFzc2V0IEFzc2V0IGFnYWluc3Qgd2hpY2ggcGVyZm9ybWFuY2UgZmVlIGlzIG1lYXN1cmVkIGFnYWluc3QKICAgIC8vLyBAcGFyYW0gb2ZNYW5hZ2VtZW50RmVlIEEgdGltZSBiYXNlZCBmZWUsIGdpdmVuIGluIGEgbnVtYmVyIHdoaWNoIGlzIGRpdmlkZWQgYnkgMTAgKiogMTUKICAgIC8vLyBAcGFyYW0gb2ZQZXJmb3JtYW5jZUZlZSBBIHRpbWUgcGVyZm9ybWFuY2UgYmFzZWQgZmVlLCBwZXJmb3JtYW5jZSByZWxhdGl2ZSB0byBvZlF1b3RlQXNzZXQsIGdpdmVuIGluIGEgbnVtYmVyIHdoaWNoIGlzIGRpdmlkZWQgYnkgMTAgKiogMTUKICAgIC8vLyBAcGFyYW0gb2ZDb21wbGlhbmNlIEFkZHJlc3Mgb2YgcGFydGljaXBhdGlvbiBtb2R1bGUKICAgIC8vLyBAcGFyYW0gb2ZSaXNrTWdtdCBBZGRyZXNzIG9mIHJpc2sgbWFuYWdlbWVudCBtb2R1bGUKICAgIC8vLyBAcGFyYW0gb2ZQcmljZUZlZWQgQWRkcmVzcyBvZiBwcmljZSBmZWVkIG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZkV4Y2hhbmdlcyBBZGRyZXNzZXMgb2YgZXhjaGFuZ2Ugb24gd2hpY2ggdGhpcyBmdW5kIGNhbiB0cmFkZQogICAgLy8vIEBwYXJhbSBvZkV4Y2hhbmdlQWRhcHRlcnMgQWRkcmVzc2VzIG9mIGV4Y2hhbmdlIGFkYXB0ZXJzCiAgICAvLy8gQHBhcmFtIHYgZWxsaXBpdGMgY3VydmUgcGFyYW1ldGVyIHYKICAgIC8vLyBAcGFyYW0gciBlbGxpcGl0YyBjdXJ2ZSBwYXJhbWV0ZXIgcgogICAgLy8vIEBwYXJhbSBzIGVsbGlwaXRjIGN1cnZlIHBhcmFtZXRlciBzCiAgICBmdW5jdGlvbiBzZXR1cEZ1bmQoCiAgICAgICAgc3RyaW5nIG9mRnVuZE5hbWUsCiAgICAgICAgYWRkcmVzcyBvZlF1b3RlQXNzZXQsCiAgICAgICAgdWludCBvZk1hbmFnZW1lbnRGZWUsCiAgICAgICAgdWludCBvZlBlcmZvcm1hbmNlRmVlLAogICAgICAgIGFkZHJlc3Mgb2ZDb21wbGlhbmNlLAogICAgICAgIGFkZHJlc3Mgb2ZSaXNrTWdtdCwKICAgICAgICBhZGRyZXNzIG9mUHJpY2VGZWVkLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlcywKICAgICAgICBhZGRyZXNzW10gb2ZFeGNoYW5nZUFkYXB0ZXJzLAogICAgICAgIHVpbnQ4IHYsCiAgICAgICAgYnl0ZXMzMiByLAogICAgICAgIGJ5dGVzMzIgcwogICAgKSB7CiAgICAgICAgcmVxdWlyZSghaXNTaHV0RG93bik7CiAgICAgICAgcmVxdWlyZSh0ZXJtc0FuZENvbmRpdGlvbnNBcmVTaWduZWQodiwgciwgcykpOwogICAgICAgIC8vIEVpdGhlciBub3ZlbCBmdW5kIG5hbWUgb3IgcHJldmlvdXMgb3duZXIgb2YgZnVuZCBuYW1lCiAgICAgICAgcmVxdWlyZShtYW5hZ2VyVG9GdW5kc1ttc2cuc2VuZGVyXSA9PSAwKTsgLy8gQWRkIGxpbWl0YXRpb24gZm9yIHNpbXBsZXIgbWlncmF0aW9uIHByb2Nlc3Mgb2Ygc2h1dHRpbmcgZG93biBhbmQgc2V0dGluZyB1cCBmdW5kCiAgICAgICAgYWRkcmVzcyBvZkZ1bmQgPSBuZXcgRnVuZCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgb2ZGdW5kTmFtZSwKICAgICAgICAgICAgb2ZRdW90ZUFzc2V0LAogICAgICAgICAgICBvZk1hbmFnZW1lbnRGZWUsCiAgICAgICAgICAgIG9mUGVyZm9ybWFuY2VGZWUsCiAgICAgICAgICAgIE5BVElWRV9BU1NFVCwKICAgICAgICAgICAgb2ZDb21wbGlhbmNlLAogICAgICAgICAgICBvZlJpc2tNZ210LAogICAgICAgICAgICBvZlByaWNlRmVlZCwKICAgICAgICAgICAgb2ZFeGNoYW5nZXMsCiAgICAgICAgICAgIG9mRXhjaGFuZ2VBZGFwdGVycwogICAgICAgICk7CiAgICAgICAgbGlzdE9mRnVuZHMucHVzaChvZkZ1bmQpOwogICAgICAgIG1hbmFnZXJUb0Z1bmRzW21zZy5zZW5kZXJdID0gb2ZGdW5kOwogICAgICAgIEZ1bmRVcGRhdGVkKG9mRnVuZCk7CiAgICB9CgogICAgLy8vIEBkZXYgRGVyZWZlcmVuY2UgRnVuZCBhbmQgdHJpZ2dlciBzZWxmZGVzdHJ1Y3QKICAgIC8vLyBAcGFyYW0gb2ZGdW5kIEFkZHJlc3Mgb2YgdGhlIGZ1bmQgdG8gYmUgc2h1dCBkb3duCiAgICBmdW5jdGlvbiBzaHV0RG93bkZ1bmQoYWRkcmVzcyBvZkZ1bmQpCiAgICAgICAgcHJlX2NvbmQoaXNTaHV0RG93biB8fCBtYW5hZ2VyVG9GdW5kc1ttc2cuc2VuZGVyXSA9PSBvZkZ1bmQpCiAgICB7CiAgICAgICAgRnVuZCBmdW5kID0gRnVuZChvZkZ1bmQpOwogICAgICAgIGRlbGV0ZSBtYW5hZ2VyVG9GdW5kc1ttc2cuc2VuZGVyXTsKICAgICAgICBmdW5kLnNodXREb3duKCk7CiAgICAgICAgRnVuZFVwZGF0ZWQob2ZGdW5kKTsKICAgIH0KCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgLy8vIEBkZXYgUHJvb2YgdGhhdCB0ZXJtcyBhbmQgY29uZGl0aW9ucyBoYXZlIGJlZW4gcmVhZCBhbmQgdW5kZXJzdG9vZAogICAgLy8vIEBwYXJhbSB2IGVsbGlwaXRjIGN1cnZlIHBhcmFtZXRlciB2CiAgICAvLy8gQHBhcmFtIHIgZWxsaXBpdGMgY3VydmUgcGFyYW1ldGVyIHIKICAgIC8vLyBAcGFyYW0gcyBlbGxpcGl0YyBjdXJ2ZSBwYXJhbWV0ZXIgcwogICAgLy8vIEByZXR1cm4gc2lnbmVkIFdoZXRoZXIgb3Igbm90IHRlcm1zIGFuZCBjb25kaXRpb25zIGhhdmUgYmVlbiByZWFkIGFuZCB1bmRlcnN0b29kCiAgICBmdW5jdGlvbiB0ZXJtc0FuZENvbmRpdGlvbnNBcmVTaWduZWQodWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHZpZXcgcmV0dXJucyAoYm9vbCBzaWduZWQpIHsKICAgICAgICByZXR1cm4gZWNyZWNvdmVyKAogICAgICAgICAgICAvLyBQYXJpdHkgZG9lcyBwcmVwZW5kIFx4MTlFdGhlcmV1bSBTaWduZWQgTWVzc2FnZTpcbntsZW4obWVzc2FnZSl9IGJlZm9yZSBzaWduaW5nLgogICAgICAgICAgICAvLyAgU2lnbmF0dXJlIG9yZGVyIGhhcyBhbHNvIGJlZW4gY2hhbmdlZCBpbiAxLjYuNyBhbmQgdXBjb21pbmcgMS43LngsCiAgICAgICAgICAgIC8vICBpdCB3aWxsIHJldHVybiByc3YgKHNhbWUgYXMgZ2V0aDsgd2hlcmUgdiBpcyBbMjcsIDI4XSkuCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBpZiB5b3UgYXJlIHVzaW5nIGVjcmVjb3ZlciwgdiB3aWxsIGJlIGVpdGhlciAiMDAiIG9yICIwMSIuCiAgICAgICAgICAgIC8vICBBcyBhIHJlc3VsdCwgaW4gb3JkZXIgdG8gdXNlIHRoaXMgdmFsdWUsIHlvdSB3aWxsIGhhdmUgdG8gcGFyc2UgaXQgdG8gYW4KICAgICAgICAgICAgLy8gIGludGVnZXIgYW5kIHRoZW4gYWRkIDI3LiBUaGlzIHdpbGwgcmVzdWx0IGluIGVpdGhlciBhIDI3IG9yIGEgMjguCiAgICAgICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vd2lraS93aWtpL0phdmFTY3JpcHQtQVBJI3dlYjNldGhzaWduCiAgICAgICAgICAgIGtlY2NhazI1NigiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiLCBURVJNU19BTkRfQ09ORElUSU9OUyksCiAgICAgICAgICAgIHYsCiAgICAgICAgICAgIHIsCiAgICAgICAgICAgIHMKICAgICAgICApID09IG1zZy5zZW5kZXI7IC8vIEhhcyBzZW5kZXIgc2lnbmVkIFRFUk1TX0FORF9DT05ESVRJT05TCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TmF0aXZlQXNzZXQoKSB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsgcmV0dXJuIE5BVElWRV9BU1NFVDsgfQogICAgZnVuY3Rpb24gZ2V0RnVuZEJ5SWQodWludCB3aXRoSWQpIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgeyByZXR1cm4gbGlzdE9mRnVuZHNbd2l0aElkXTsgfQogICAgZnVuY3Rpb24gZ2V0TGFzdEZ1bmRJZCgpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gbGlzdE9mRnVuZHMubGVuZ3RoIC0gMTsgfQogICAgZnVuY3Rpb24gZ2V0RnVuZEJ5TWFuYWdlcihhZGRyZXNzIG9mTWFuYWdlcikgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7IHJldHVybiBtYW5hZ2VyVG9GdW5kc1tvZk1hbmFnZXJdOyB9Cn0KCmNvbnRyYWN0IERTTWF0aCB7CiAgICBmdW5jdGlvbiBhZGQodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmVxdWlyZSgoeiA9IHggKyB5KSA+PSB4KTsKICAgIH0KICAgIGZ1bmN0aW9uIHN1Yih1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICByZXF1aXJlKCh6ID0geCAtIHkpIDw9IHgpOwogICAgfQogICAgZnVuY3Rpb24gbXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJlcXVpcmUoeSA9PSAwIHx8ICh6ID0geCAqIHkpIC8geSA9PSB4KTsKICAgIH0KCiAgICBmdW5jdGlvbiBtaW4odWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gbWF4KHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHJldHVybiB4ID49IHkgPyB4IDogeTsKICAgIH0KICAgIGZ1bmN0aW9uIGltaW4oaW50IHgsIGludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCB6KSB7CiAgICAgICAgcmV0dXJuIHggPD0geSA/IHggOiB5OwogICAgfQogICAgZnVuY3Rpb24gaW1heChpbnQgeCwgaW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50IHopIHsKICAgICAgICByZXR1cm4geCA+PSB5ID8geCA6IHk7CiAgICB9CgogICAgdWludCBjb25zdGFudCBXQUQgPSAxMCAqKiAxODsKICAgIHVpbnQgY29uc3RhbnQgUkFZID0gMTAgKiogMjc7CgogICAgZnVuY3Rpb24gd211bCh1aW50IHgsIHVpbnQgeSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHopIHsKICAgICAgICB6ID0gYWRkKG11bCh4LCB5KSwgV0FEIC8gMikgLyBXQUQ7CiAgICB9CiAgICBmdW5jdGlvbiBybXVsKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgeikgewogICAgICAgIHogPSBhZGQobXVsKHgsIHkpLCBSQVkgLyAyKSAvIFJBWTsKICAgIH0KICAgIGZ1bmN0aW9uIHdkaXYodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgV0FEKSwgeSAvIDIpIC8geTsKICAgIH0KICAgIGZ1bmN0aW9uIHJkaXYodWludCB4LCB1aW50IHkpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IGFkZChtdWwoeCwgUkFZKSwgeSAvIDIpIC8geTsKICAgIH0KCiAgICAvLyBUaGlzIGZhbW91cyBhbGdvcml0aG0gaXMgY2FsbGVkICJleHBvbmVudGlhdGlvbiBieSBzcXVhcmluZyIKICAgIC8vIGFuZCBjYWxjdWxhdGVzIHhebiB3aXRoIHggYXMgZml4ZWQtcG9pbnQgYW5kIG4gYXMgcmVndWxhciB1bnNpZ25lZC4KICAgIC8vCiAgICAvLyBJdCdzIE8obG9nIG4pLCBpbnN0ZWFkIG9mIE8obikgZm9yIG5haXZlIHJlcGVhdGVkIG11bHRpcGxpY2F0aW9uLgogICAgLy8KICAgIC8vIFRoZXNlIGZhY3RzIGFyZSB3aHkgaXQgd29ya3M6CiAgICAvLwogICAgLy8gIElmIG4gaXMgZXZlbiwgdGhlbiB4Xm4gPSAoeF4yKV4obi8yKS4KICAgIC8vICBJZiBuIGlzIG9kZCwgIHRoZW4geF5uID0geCAqIHheKG4tMSksCiAgICAvLyAgIGFuZCBhcHBseWluZyB0aGUgZXF1YXRpb24gZm9yIGV2ZW4geCBnaXZlcwogICAgLy8gICAgeF5uID0geCAqICh4XjIpXigobi0xKSAvIDIpLgogICAgLy8KICAgIC8vICBBbHNvLCBFVk0gZGl2aXNpb24gaXMgZmxvb3JpbmcgYW5kCiAgICAvLyAgICBmbG9vclsobi0xKSAvIDJdID0gZmxvb3JbbiAvIDJdLgogICAgLy8KICAgIGZ1bmN0aW9uIHJwb3codWludCB4LCB1aW50IG4pIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCB6KSB7CiAgICAgICAgeiA9IG4gJSAyICE9IDAgPyB4IDogUkFZOwoKICAgICAgICBmb3IgKG4gLz0gMjsgbiAhPSAwOyBuIC89IDIpIHsKICAgICAgICAgICAgeCA9IHJtdWwoeCwgeCk7CgogICAgICAgICAgICBpZiAobiAlIDIgIT0gMCkgewogICAgICAgICAgICAgICAgeiA9IHJtdWwoeiwgeCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmNvbnRyYWN0IEFzc2V0IGlzIERTTWF0aCwgQXNzZXRJbnRlcmZhY2UsIEVSQzIyM0ludGVyZmFjZSB7CgogICAgLy8gREFUQSBTVFJVQ1RVUkVTCgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSkgYWxsb3dlZDsKICAgIHVpbnQgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgLyoqCiAgICAgKiBAbm90aWNlIFNlbmQgYF92YWx1ZWAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAgKiBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzCiAgICAgKiBAZGV2IFNpbWlsYXIgdG8gdHJhbnNmZXIoYWRkcmVzcywgdWludCwgYnl0ZXMpLCBidXQgd2l0aG91dCBfZGF0YSBwYXJhbWV0ZXIKICAgICAqIEBwYXJhbSBfdG8gQWRkcmVzcyBvZiB0b2tlbiByZWNlaXZlcgogICAgICogQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKiBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgdWludCBjb2RlTGVuZ3RoOwogICAgICAgIGJ5dGVzIG1lbW9yeSBlbXB0eTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseS4KICAgICAgICAgICAgY29kZUxlbmd0aCA6PSBleHRjb2Rlc2l6ZShfdG8pCiAgICAgICAgfQogCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOyAvLyBzYW5pdHkgY2hlY2tzCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID49IGJhbGFuY2VzW190b10pOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgLy8gaWYgKGNvZGVMZW5ndGggPiAwKSB7CiAgICAgICAgLy8gICAgIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHJlY2VpdmVyID0gRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QoX3RvKTsKICAgICAgICAvLyAgICAgcmVjZWl2ZXIudG9rZW5GYWxsYmFjayhtc2cuc2VuZGVyLCBfdmFsdWUsIGVtcHR5KTsKICAgICAgICAvLyB9CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIGVtcHR5KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBub3RpY2UgU2VuZCBgX3ZhbHVlYCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAgYW5kIHRyaWdnZXIgdG9rZW5GYWxsYmFjayBpZiBzZW5kZXIgaXMgYSBjb250cmFjdAogICAgICogQGRldiBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgdXNlciBvciBjb250cmFjdCB3YW50cyB0byB0cmFuc2ZlciBmdW5kcwogICAgICogQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyCiAgICAgKiBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICAqIEBwYXJhbSBfZGF0YSBEYXRhIHRvIGJlIHNlbnQgdG8gdG9rZW5GYWxsYmFjawogICAgICogQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICB1aW50IGNvZGVMZW5ndGg7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gUmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUgb24gdGFyZ2V0IGFkZHJlc3MsIHRoaXMgbmVlZHMgYXNzZW1ibHkuCiAgICAgICAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoX3RvKQogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOyAvLyBzYW5pdHkgY2hlY2tzCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID49IGJhbGFuY2VzW190b10pOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgLy8gaWYgKGNvZGVMZW5ndGggPiAwKSB7CiAgICAgICAgLy8gICAgIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHJlY2VpdmVyID0gRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QoX3RvKTsKICAgICAgICAvLyAgICAgcmVjZWl2ZXIudG9rZW5GYWxsYmFjayhtc2cuc2VuZGVyLCBfdmFsdWUsIF9kYXRhKTsKICAgICAgICAvLyB9CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGBfdmFsdWVgIHRva2VucyBmcm9tIGBfZnJvbWAgdG8gYF90b2AgaWYgYG1zZy5zZW5kZXJgIGlzIGFsbG93ZWQuCiAgICAvLy8gQG5vdGljZSBSZXN0cmljdGlvbjogQW4gYWNjb3VudCBjYW4gb25seSB1c2UgdGhpcyBmdW5jdGlvbiB0byBzZW5kIHRvIGl0c2VsZgogICAgLy8vIEBkZXYgQWxsb3dzIGZvciBhbiBhcHByb3ZlZCB0aGlyZCBwYXJ0eSB0byB0cmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUKICAgIC8vLyBhZGRyZXNzIHRvIGFub3RoZXIuIFJldHVybnMgc3VjY2Vzcy4KICAgIC8vLyBAcGFyYW0gX2Zyb20gQWRkcmVzcyBmcm9tIHdoZXJlIHRva2VucyBhcmUgd2l0aGRyYXduLgogICAgLy8vIEBwYXJhbSBfdG8gQWRkcmVzcyB0byB3aGVyZSB0b2tlbnMgYXJlIHNlbnQuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfZnJvbSAhPSAweDApOwogICAgICAgIHJlcXVpcmUoX3RvICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfZnJvbV0gPj0gX3ZhbHVlKTsKICAgICAgICByZXF1aXJlKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID49IF92YWx1ZSk7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID49IGJhbGFuY2VzW190b10pOwogICAgICAgIC8vIHJlcXVpcmUoX3RvID09IG1zZy5zZW5kZXIpOyAvLyBjYW4gb25seSB1c2UgdHJhbnNmZXJGcm9tIHRvIHNlbmQgdG8gc2VsZgoKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIC09IF92YWx1ZTsKCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbGxvd3MgYF9zcGVuZGVyYCB0byB0cmFuc2ZlciBgX3ZhbHVlYCB0b2tlbnMgZnJvbSBgbXNnLnNlbmRlcmAgdG8gYW55IGFkZHJlc3MuCiAgICAvLy8gQGRldiBTZXRzIGFwcHJvdmVkIGFtb3VudCBvZiB0b2tlbnMgZm9yIHNwZW5kZXIuIFJldHVybnMgc3VjY2Vzcy4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiBhbGxvd2VkIGFjY291bnQuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgYXBwcm92ZWQgdG9rZW5zLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3NwZW5kZXIgIT0gMHgwKTsKCiAgICAgICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgICAgICAvLyBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAgICAgLy8gYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIC8vIHJlcXVpcmUoX3ZhbHVlID09IDAgfHwgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCk7CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFBVQkxJQyBWSUVXIE1FVEhPRFMKCiAgICAvLy8gQGRldiBSZXR1cm5zIG51bWJlciBvZiBhbGxvd2VkIHRva2VucyB0aGF0IGEgc3BlbmRlciBjYW4gdHJhbnNmZXIgb24KICAgIC8vLyBiZWhhbGYgb2YgYSB0b2tlbiBvd25lci4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFkZHJlc3Mgb2YgdG9rZW4gb3duZXIuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIEFkZHJlc3Mgb2YgdG9rZW4gc3BlbmRlci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgcmVtYWluaW5nIGFsbG93YW5jZSBmb3Igc3BlbmRlci4KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikKICAgICAgICBjb25zdGFudAogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgLy8vIEBkZXYgUmV0dXJucyBudW1iZXIgb2YgdG9rZW5zIG93bmVkIGJ5IHRoZSBnaXZlbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgQWRkcmVzcyBvZiB0b2tlbiBvd25lci4KICAgIC8vLyBAcmV0dXJuIFJldHVybnMgYmFsYW5jZSBvZiBvd25lci4KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICAgIH0KfQoKY29udHJhY3QgU2hhcmVzIGlzIEFzc2V0LCBTaGFyZXNJbnRlcmZhY2UgewoKICAgIC8vIEZJRUxEUwoKICAgIC8vIENvbnN0cnVjdG9yIGZpZWxkcwogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50IHB1YmxpYyBkZWNpbWFsOwogICAgdWludCBwdWJsaWMgY3JlYXRpb25UaW1lOwoKICAgIC8vIE1FVEhPRFMKCiAgICAvLyBDT05TVFJVQ1RPUgoKICAgIC8vLyBAcGFyYW0gX25hbWUgTmFtZSB0aGVzZSBzaGFyZXMKICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBTeW1ib2wgb2Ygc2hhcmVzCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsIEFtb3VudCBvZiBkZWNpbWFscyBzaGFyZVByaWNlIGlzIGRlbm9taW5hdGVkIGluLCBkZWZpbmVkIHRvIGJlIGVxdWFsIGFzIGRlY2lhbWxzIGluIFJFRkVSRU5DRV9BU1NFVCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfY3JlYXRpb25UaW1lIFRpbWVzdGFtcCBvZiBzaGFyZSBjcmVhdGlvbgogICAgZnVuY3Rpb24gU2hhcmVzKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQgX2RlY2ltYWwsIHVpbnQgX2NyZWF0aW9uVGltZSkgewogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICBzeW1ib2wgPSBfc3ltYm9sOwogICAgICAgIGRlY2ltYWwgPSBfZGVjaW1hbDsKICAgICAgICBjcmVhdGlvblRpbWUgPSBfY3JlYXRpb25UaW1lOwogICAgfQoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgZnVuY3Rpb24gZ2V0TmFtZSgpIHZpZXcgcmV0dXJucyAoc3RyaW5nKSB7IHJldHVybiBuYW1lOyB9CiAgICBmdW5jdGlvbiBnZXRTeW1ib2woKSB2aWV3IHJldHVybnMgKHN0cmluZykgeyByZXR1cm4gc3ltYm9sOyB9CiAgICBmdW5jdGlvbiBnZXREZWNpbWFscygpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gZGVjaW1hbDsgfQogICAgZnVuY3Rpb24gZ2V0Q3JlYXRpb25UaW1lKCkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBjcmVhdGlvblRpbWU7IH0KICAgIGZ1bmN0aW9uIHRvU21hbGxlc3RTaGFyZVVuaXQodWludCBxdWFudGl0eSkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBtdWwocXVhbnRpdHksIDEwICoqIGdldERlY2ltYWxzKCkpOyB9CiAgICBmdW5jdGlvbiB0b1dob2xlU2hhcmVVbml0KHVpbnQgcXVhbnRpdHkpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gcXVhbnRpdHkgLyAoMTAgKiogZ2V0RGVjaW1hbHMoKSk7IH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsgcmVxdWlyZShfdG8gPT0gYWRkcmVzcyh0aGlzKSk7IH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sKSB7IHJlcXVpcmUoX3RvID09IGFkZHJlc3ModGhpcykpOyB9CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgeyByZXF1aXJlKF90byA9PSBhZGRyZXNzKHRoaXMpKTsgfQoKICAgIC8vIElOVEVSTkFMIE1FVEhPRFMKCiAgICAvLy8gQHBhcmFtIHJlY2lwaWVudCBBZGRyZXNzIHRoZSBuZXcgc2hhcmVzIHNob3VsZCBiZSBzZW50IHRvCiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgTnVtYmVyIG9mIHNoYXJlcyB0byBiZSBjcmVhdGVkCiAgICBmdW5jdGlvbiBjcmVhdGVTaGFyZXMoYWRkcmVzcyByZWNpcGllbnQsIHVpbnQgc2hhcmVRdWFudGl0eSkgaW50ZXJuYWwgewogICAgICAgIHRvdGFsU3VwcGx5ID0gYWRkKHRvdGFsU3VwcGx5LCBzaGFyZVF1YW50aXR5KTsKICAgICAgICBiYWxhbmNlc1tyZWNpcGllbnRdID0gYWRkKGJhbGFuY2VzW3JlY2lwaWVudF0sIHNoYXJlUXVhbnRpdHkpOwogICAgICAgIENyZWF0ZWQobXNnLnNlbmRlciwgbm93LCBzaGFyZVF1YW50aXR5KTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIHJlY2lwaWVudCBBZGRyZXNzIHRoZSBuZXcgc2hhcmVzIHNob3VsZCBiZSB0YWtlbiBmcm9tIHdoZW4gZGVzdHJveWVkCiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgTnVtYmVyIG9mIHNoYXJlcyB0byBiZSBhbm5paGlsYXRlZAogICAgZnVuY3Rpb24gYW5uaWhpbGF0ZVNoYXJlcyhhZGRyZXNzIHJlY2lwaWVudCwgdWludCBzaGFyZVF1YW50aXR5KSBpbnRlcm5hbCB7CiAgICAgICAgdG90YWxTdXBwbHkgPSBzdWIodG90YWxTdXBwbHksIHNoYXJlUXVhbnRpdHkpOwogICAgICAgIGJhbGFuY2VzW3JlY2lwaWVudF0gPSBzdWIoYmFsYW5jZXNbcmVjaXBpZW50XSwgc2hhcmVRdWFudGl0eSk7CiAgICAgICAgQW5uaWhpbGF0ZWQobXNnLnNlbmRlciwgbm93LCBzaGFyZVF1YW50aXR5KTsKICAgIH0KfQoKY29udHJhY3QgUmVzdHJpY3RlZFNoYXJlcyBpcyBTaGFyZXMgewoKICAgIC8vIENPTlNUUlVDVE9SCgogICAgLy8vIEBwYXJhbSBfbmFtZSBOYW1lIHRoZXNlIHNoYXJlcwogICAgLy8vIEBwYXJhbSBfc3ltYm9sIFN5bWJvbCBvZiBzaGFyZXMKICAgIC8vLyBAcGFyYW0gX2RlY2ltYWwgQW1vdW50IG9mIGRlY2ltYWxzIHNoYXJlUHJpY2UgaXMgZGVub21pbmF0ZWQgaW4sIGRlZmluZWQgdG8gYmUgZXF1YWwgYXMgZGVjaWFtbHMgaW4gUkVGRVJFTkNFX0FTU0VUIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9jcmVhdGlvblRpbWUgVGltZXN0YW1wIG9mIHNoYXJlIGNyZWF0aW9uCiAgICBmdW5jdGlvbiBSZXN0cmljdGVkU2hhcmVzKAogICAgICAgIHN0cmluZyBfbmFtZSwKICAgICAgICBzdHJpbmcgX3N5bWJvbCwKICAgICAgICB1aW50IF9kZWNpbWFsLAogICAgICAgIHVpbnQgX2NyZWF0aW9uVGltZQogICAgKSBTaGFyZXMoX25hbWUsIF9zeW1ib2wsIF9kZWNpbWFsLCBfY3JlYXRpb25UaW1lKSB7fQoKICAgIC8vIFBVQkxJQyBNRVRIT0RTCgogICAgLyoqCiAgICAgKiBAbm90aWNlIFNlbmQgYF92YWx1ZWAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAgKiBAZGV2IFRyYW5zZmVycyBzZW5kZXIncyB0b2tlbnMgdG8gYSBnaXZlbiBhZGRyZXNzCiAgICAgKiBAZGV2IFNpbWlsYXIgdG8gdHJhbnNmZXIoYWRkcmVzcywgdWludCwgYnl0ZXMpLCBidXQgd2l0aG91dCBfZGF0YSBwYXJhbWV0ZXIKICAgICAqIEBwYXJhbSBfdG8gQWRkcmVzcyBvZiB0b2tlbiByZWNlaXZlcgogICAgICogQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAgKiBAcmV0dXJuIFJldHVybnMgc3VjY2VzcyBvZiBmdW5jdGlvbiBjYWxsCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sIHN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykgfHwgX3RvID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIHVpbnQgY29kZUxlbmd0aDsKICAgICAgICBieXRlcyBtZW1vcnkgZW1wdHk7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgLy8gUmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUgb24gdGFyZ2V0IGFkZHJlc3MsIHRoaXMgbmVlZHMgYXNzZW1ibHkuCiAgICAgICAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoX3RvKQogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOyAvLyBzYW5pdHkgY2hlY2tzCiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID49IGJhbGFuY2VzW190b10pOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICAgICAgaWYgKGNvZGVMZW5ndGggPiAwKSB7CiAgICAgICAgICAgIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHJlY2VpdmVyID0gRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QoX3RvKTsKICAgICAgICAgICAgcmVjZWl2ZXIudG9rZW5GYWxsYmFjayhtc2cuc2VuZGVyLCBfdmFsdWUsIGVtcHR5KTsKICAgICAgICB9CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIGVtcHR5KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBub3RpY2UgU2VuZCBgX3ZhbHVlYCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgbXNnLnNlbmRlcmAgYW5kIHRyaWdnZXIgdG9rZW5GYWxsYmFjayBpZiBzZW5kZXIgaXMgYSBjb250cmFjdAogICAgICogQGRldiBGdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuIGEgdXNlciBvciBjb250cmFjdCB3YW50cyB0byB0cmFuc2ZlciBmdW5kcwogICAgICogQHBhcmFtIF90byBBZGRyZXNzIG9mIHRva2VuIHJlY2VpdmVyCiAgICAgKiBAcGFyYW0gX3ZhbHVlIE51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgICAqIEBwYXJhbSBfZGF0YSBEYXRhIHRvIGJlIHNlbnQgdG8gdG9rZW5GYWxsYmFjawogICAgICogQHJldHVybiBSZXR1cm5zIHN1Y2Nlc3Mgb2YgZnVuY3Rpb24gY2FsbAogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSB8fCBfdG8gPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgdWludCBjb2RlTGVuZ3RoOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIFJldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBjb2RlIG9uIHRhcmdldCBhZGRyZXNzLCB0aGlzIG5lZWRzIGFzc2VtYmx5LgogICAgICAgICAgICBjb2RlTGVuZ3RoIDo9IGV4dGNvZGVzaXplKF90bykKICAgICAgICB9CgogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbbXNnLnNlbmRlcl0gPj0gX3ZhbHVlKTsgLy8gc2FuaXR5IGNoZWNrcwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3RvXSArIF92YWx1ZSA+PSBiYWxhbmNlc1tfdG9dKTsKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBzdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgICAgIGlmIChjb2RlTGVuZ3RoID4gMCkgewogICAgICAgICAgICBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCByZWNlaXZlciA9IEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0KF90byk7CiAgICAgICAgICAgIHJlY2VpdmVyLnRva2VuRmFsbGJhY2sobXNnLnNlbmRlciwgX3ZhbHVlLCBfZGF0YSk7CiAgICAgICAgfQogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbGxvd3MgYF9zcGVuZGVyYCB0byB0cmFuc2ZlciBgX3ZhbHVlYCB0b2tlbnMgZnJvbSBgbXNnLnNlbmRlcmAgdG8gYW55IGFkZHJlc3MuCiAgICAvLy8gQGRldiBTZXRzIGFwcHJvdmVkIGFtb3VudCBvZiB0b2tlbnMgZm9yIHNwZW5kZXIuIFJldHVybnMgc3VjY2Vzcy4KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgQWRkcmVzcyBvZiBhbGxvd2VkIGFjY291bnQuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBOdW1iZXIgb2YgYXBwcm92ZWQgdG9rZW5zLgogICAgLy8vIEByZXR1cm4gUmV0dXJucyBzdWNjZXNzIG9mIGZ1bmN0aW9uIGNhbGwuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICByZXF1aXJlKF9zcGVuZGVyICE9IDB4MCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gYWxsb3dhbmNlIHRvIHplcm8gYnkgY2FsbGluZyBgYXBwcm92ZShfc3BlbmRlciwgMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vIGFscmVhZHkgMCB0byBtaXRpZ2F0ZSB0aGUgcmFjZSBjb25kaXRpb24gZGVzY3JpYmVkIGhlcmU6CiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgICAgICByZXF1aXJlKF92YWx1ZSA9PSAwIHx8IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApOwoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCmNvbnRyYWN0IEZ1bmQgaXMgRFNNYXRoLCBEQkMsIE93bmVkLCBSZXN0cmljdGVkU2hhcmVzLCBGdW5kSW50ZXJmYWNlLCBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCB7CiAgICAvLyBUWVBFUwoKICAgIHN0cnVjdCBNb2R1bGVzIHsgLy8gRGVzY3JpYmVzIGFsbCBtb2R1bGFyIHBhcnRzLCBzdGFuZGFyZGlzZWQgdGhyb3VnaCBhbiBpbnRlcmZhY2UKICAgICAgICBQcmljZUZlZWRJbnRlcmZhY2UgcHJpY2VmZWVkOyAvLyBQcm92aWRlcyBhbGwgZXh0ZXJuYWwgZGF0YQogICAgICAgIENvbXBsaWFuY2VJbnRlcmZhY2UgY29tcGxpYW5jZTsgLy8gQm9vbGVhbiBmdW5jdGlvbnMgcmVnYXJkaW5nIGludmVzdC9yZWRlZW0KICAgICAgICBSaXNrTWdtdEludGVyZmFjZSByaXNrbWdtdDsgLy8gQm9vbGVhbiBmdW5jdGlvbnMgcmVnYXJkaW5nIG1ha2UvdGFrZSBvcmRlcnMKICAgIH0KCiAgICBzdHJ1Y3QgQ2FsY3VsYXRpb25zIHsgLy8gTGlzdCBvZiBpbnRlcm5hbCBjYWxjdWxhdGlvbnMKICAgICAgICB1aW50IGdhdjsgLy8gR3Jvc3MgYXNzZXQgdmFsdWUKICAgICAgICB1aW50IG1hbmFnZW1lbnRGZWU7IC8vIFRpbWUgYmFzZWQgZmVlCiAgICAgICAgdWludCBwZXJmb3JtYW5jZUZlZTsgLy8gUGVyZm9ybWFuY2UgYmFzZWQgZmVlIG1lYXN1cmVkIGFnYWluc3QgUVVPVEVfQVNTRVQKICAgICAgICB1aW50IHVuY2xhaW1lZEZlZXM7IC8vIEZlZXMgbm90IHlldCBhbGxvY2F0ZWQgdG8gdGhlIGZ1bmQgbWFuYWdlcgogICAgICAgIHVpbnQgbmF2OyAvLyBOZXQgYXNzZXQgdmFsdWUKICAgICAgICB1aW50IGhpZ2hXYXRlck1hcms7IC8vIEEgcmVjb3JkIG9mIGJlc3QgYWxsLXRpbWUgZnVuZCBwZXJmb3JtYW5jZQogICAgICAgIHVpbnQgdG90YWxTdXBwbHk7IC8vIFRvdGFsIHN1cHBseSBvZiBzaGFyZXMKICAgICAgICB1aW50IHRpbWVzdGFtcDsgLy8gVGltZSB3aGVuIGNhbGN1bGF0aW9ucyBhcmUgcGVyZm9ybWVkIGluIHNlY29uZHMKICAgIH0KCiAgICBlbnVtIFJlcXVlc3RTdGF0dXMgeyBhY3RpdmUsIGNhbmNlbGxlZCwgZXhlY3V0ZWQgfQogICAgZW51bSBSZXF1ZXN0VHlwZSB7IGludmVzdCwgcmVkZWVtLCB0b2tlbkZhbGxiYWNrUmVkZWVtIH0KICAgIHN0cnVjdCBSZXF1ZXN0IHsgLy8gRGVzY3JpYmVzIGFuZCBsb2dzIHdoZW5ldmVyIGFzc2V0IGVudGVyIGFuZCBsZWF2ZSBmdW5kIGR1ZSB0byBQYXJ0aWNpcGFudHMKICAgICAgICBhZGRyZXNzIHBhcnRpY2lwYW50OyAvLyBQYXJ0aWNpcGFudCBpbiBNZWxvbiBmdW5kIHJlcXVlc3RpbmcgaW52ZXN0bWVudCBvciByZWRlbXB0aW9uCiAgICAgICAgUmVxdWVzdFN0YXR1cyBzdGF0dXM7IC8vIEVudW06IGFjdGl2ZSwgY2FuY2VsbGVkLCBleGVjdXRlZDsgU3RhdHVzIG9mIHJlcXVlc3QKICAgICAgICBSZXF1ZXN0VHlwZSByZXF1ZXN0VHlwZTsgLy8gRW51bTogaW52ZXN0LCByZWRlZW0sIHRva2VuRmFsbGJhY2tSZWRlZW0KICAgICAgICBhZGRyZXNzIHJlcXVlc3RBc3NldDsgLy8gQWRkcmVzcyBvZiB0aGUgYXNzZXQgYmVpbmcgcmVxdWVzdGVkCiAgICAgICAgdWludCBzaGFyZVF1YW50aXR5OyAvLyBRdWFudGl0eSBvZiBNZWxvbiBmdW5kIHNoYXJlcwogICAgICAgIHVpbnQgZ2l2ZVF1YW50aXR5OyAvLyBRdWFudGl0eSBpbiBNZWxvbiBhc3NldCB0byBnaXZlIHRvIE1lbG9uIGZ1bmQgdG8gcmVjZWl2ZSBzaGFyZVF1YW50aXR5CiAgICAgICAgdWludCByZWNlaXZlUXVhbnRpdHk7IC8vIFF1YW50aXR5IGluIE1lbG9uIGFzc2V0IHRvIHJlY2VpdmUgZnJvbSBNZWxvbiBmdW5kIGZvciBnaXZlbiBzaGFyZVF1YW50aXR5CiAgICAgICAgdWludCB0aW1lc3RhbXA7ICAgICAvLyBUaW1lIG9mIHJlcXVlc3QgY3JlYXRpb24gaW4gc2Vjb25kcwogICAgICAgIHVpbnQgYXRVcGRhdGVJZDsgICAgLy8gUHJpY2VmZWVkIHVwZGF0ZUlkIHdoZW4gdGhpcyByZXF1ZXN0IHdhcyBjcmVhdGVkCiAgICB9CgogICAgZW51bSBPcmRlclN0YXR1cyB7IGFjdGl2ZSwgcGFydGlhbGx5RmlsbGVkLCBmdWxseUZpbGxlZCwgY2FuY2VsbGVkIH0KICAgIGVudW0gT3JkZXJUeXBlIHsgbWFrZSwgdGFrZSB9CiAgICBzdHJ1Y3QgT3JkZXIgeyAvLyBEZXNjcmliZXMgYW5kIGxvZ3Mgd2hlbmV2ZXIgYXNzZXRzIGVudGVyIGFuZCBsZWF2ZSBmdW5kIGR1ZSB0byBNYW5hZ2VyCiAgICAgICAgdWludCBleGNoYW5nZUlkOyAvLyBJZCBhcyByZXR1cm5lZCBmcm9tIGV4Y2hhbmdlCiAgICAgICAgT3JkZXJTdGF0dXMgc3RhdHVzOyAvLyBFbnVtOiBhY3RpdmUsIHBhcnRpYWxseUZpbGxlZCwgZnVsbHlGaWxsZWQsIGNhbmNlbGxlZAogICAgICAgIE9yZGVyVHlwZSBvcmRlclR5cGU7IC8vIEVudW06IG1ha2UsIHRha2UKICAgICAgICBhZGRyZXNzIHNlbGxBc3NldDsgLy8gQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBzb2xkCiAgICAgICAgYWRkcmVzcyBidXlBc3NldDsgLy8gQXNzZXQgKGFzIHJlZ2lzdGVyZWQgaW4gQXNzZXQgcmVnaXN0cmFyKSB0byBiZSBib3VnaHQKICAgICAgICB1aW50IHNlbGxRdWFudGl0eTsgLy8gUXVhbnRpdHkgb2Ygc2VsbEFzc2V0IHRvIGJlIHNvbGQKICAgICAgICB1aW50IGJ1eVF1YW50aXR5OyAvLyBRdWFudGl0eSBvZiBzZWxsQXNzZXQgdG8gYmUgYm91Z2h0CiAgICAgICAgdWludCB0aW1lc3RhbXA7IC8vIFRpbWUgb2Ygb3JkZXIgY3JlYXRpb24gaW4gc2Vjb25kcwogICAgICAgIHVpbnQgZmlsbFF1YW50aXR5OyAvLyBCdXkgcXVhbnRpdHkgZmlsbGVkOyBBbHdheXMgbGVzcyB0aGFuIGJ1eV9xdWFudGl0eQogICAgfQoKICAgIHN0cnVjdCBFeGNoYW5nZSB7CiAgICAgICAgYWRkcmVzcyBleGNoYW5nZTsgLy8gQWRkcmVzcyBvZiB0aGUgZXhjaGFuZ2UKICAgICAgICBFeGNoYW5nZUludGVyZmFjZSBleGNoYW5nZUFkYXB0ZXI7IC8vRXhjaGFuZ2UgYWRhcHRlciBjb250cmFjdHMgcmVzcGVjdGl2ZSB0byB0aGUgZXhjaGFuZ2UKICAgICAgICBib29sIGlzQXBwcm92ZU9ubHk7IC8vIFRydWUgaW4gY2FzZSBvZiBleGNoYW5nZSBpbXBsZW1lbnRhdGlvbiB3aGljaCByZXF1aXJlcyAgYXJlIGFwcHJvdmVkIHdoZW4gYW4gb3JkZXIgaXMgbWFkZSBpbnN0ZWFkIG9mIHRyYW5zZmVyCiAgICB9CgogICAgLy8gRklFTERTCgogICAgLy8gQ29uc3RhbnQgZmllbGRzCiAgICB1aW50IHB1YmxpYyBjb25zdGFudCBNQVhfRlVORF9BU1NFVFMgPSA0OyAvLyBNYXggb3duYWJsZSBhc3NldHMgYnkgdGhlIGZ1bmQgc3VwcG9ydGVkIGJ5IGdhcyBsaW1pdHMKICAgIC8vIENvbnN0cnVjdG9yIGZpZWxkcwogICAgdWludCBwdWJsaWMgTUFOQUdFTUVOVF9GRUVfUkFURTsgLy8gRmVlIHJhdGUgaW4gUVVPVEVfQVNTRVQgcGVyIGRlbHRhIGltcHJvdmVtZW50IGluIFdBRAogICAgdWludCBwdWJsaWMgUEVSRk9STUFOQ0VfRkVFX1JBVEU7IC8vIEZlZSByYXRlIGluIFFVT1RFX0FTU0VUIHBlciBtYW5hZ2VkIHNlY29uZHMgaW4gV0FECiAgICBhZGRyZXNzIHB1YmxpYyBWRVJTSU9OOyAvLyBBZGRyZXNzIG9mIFZlcnNpb24gY29udHJhY3QKICAgIEFzc2V0IHB1YmxpYyBRVU9URV9BU1NFVDsgLy8gUVVPVEUgYXNzZXQgYXMgRVJDMjAgY29udHJhY3QKICAgIE5hdGl2ZUFzc2V0SW50ZXJmYWNlIHB1YmxpYyBOQVRJVkVfQVNTRVQ7IC8vIE5hdGl2ZSBhc3NldCBhcyBFUkMyMCBjb250cmFjdAogICAgLy8gTWV0aG9kcyBmaWVsZHMKICAgIE1vZHVsZXMgcHVibGljIG1vZHVsZTsgLy8gU3RydWN0IHdoaWNoIGhvbGRzIGFsbCB0aGUgaW5pdGlhbGlzZWQgbW9kdWxlIGluc3RhbmNlcwogICAgRXhjaGFuZ2VbXSBwdWJsaWMgZXhjaGFuZ2VzOyAvLyBBcnJheSBjb250YWluaW5nIGV4Y2hhbmdlcyB0aGlzIGZ1bmQgc3VwcG9ydHMKICAgIENhbGN1bGF0aW9ucyBwdWJsaWMgYXRMYXN0VW5jbGFpbWVkRmVlQWxsb2NhdGlvbjsgLy8gQ2FsY3VsYXRpb24gcmVzdWx0cyBhdCBsYXN0IGFsbG9jYXRlVW5jbGFpbWVkRmVlcygpIGNhbGwKICAgIGJvb2wgcHVibGljIGlzU2h1dERvd247IC8vIFNlY3VyaXR5IGZlYXR1cmUsIGlmIHllcyB0aGFuIGludmVzdGluZywgbWFuYWdpbmcsIGFsbG9jYXRlVW5jbGFpbWVkRmVlcyBnZXRzIGJsb2NrZWQKICAgIFJlcXVlc3RbXSBwdWJsaWMgcmVxdWVzdHM7IC8vIEFsbCB0aGUgcmVxdWVzdHMgdGhpcyBmdW5kIHJlY2VpdmVkIGZyb20gcGFydGljaXBhbnRzCiAgICBib29sIHB1YmxpYyBpc0ludmVzdEFsbG93ZWQ7IC8vIFVzZXIgb3B0aW9uLCBpZiBmYWxzZSBmdW5kIHJlamVjdHMgTWVsb24gaW52ZXN0bWVudHMKICAgIGJvb2wgcHVibGljIGlzUmVkZWVtQWxsb3dlZDsgLy8gVXNlciBvcHRpb24sIGlmIGZhbHNlIGZ1bmQgcmVqZWN0cyBNZWxvbiByZWRlbXB0aW9uczsgUmVkZW1wdGlvbnMgdXNpbmcgc2xpY2VzIGFsd2F5cyBwb3NzaWJsZQogICAgT3JkZXJbXSBwdWJsaWMgb3JkZXJzOyAvLyBBbGwgdGhlIG9yZGVycyB0aGlzIGZ1bmQgcGxhY2VkIG9uIGV4Y2hhbmdlcwogICAgbWFwcGluZyAodWludCA9PiBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkpIHB1YmxpYyBleGNoYW5nZUlkc1RvT3Blbk1ha2VPcmRlcklkczsgLy8gZXhjaGFuZ2VJbmRleCB0bzogYXNzZXQgdG8gb3BlbiBtYWtlIG9yZGVyIElEIDsgaWYgbm8gb3BlbiBtYWtlIG9yZGVycywgb3JkZXJJRCBpcyB6ZXJvCiAgICBhZGRyZXNzW10gcHVibGljIG93bmVkQXNzZXRzOyAvLyBMaXN0IG9mIGFsbCBhc3NldHMgb3duZWQgYnkgdGhlIGZ1bmQgb3IgZm9yIHdoaWNoIHRoZSBmdW5kIGhhcyBvcGVuIG1ha2Ugb3JkZXJzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0luQXNzZXRMaXN0OyAvLyBNYXBwaW5nIGZyb20gYXNzZXQgdG8gd2hldGhlciB0aGUgYXNzZXQgZXhpc3RzIGluIG93bmVkQXNzZXRzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBpc0luT3Blbk1ha2VPcmRlcjsgLy8gTWFwcGluZyBmcm9tIGFzc2V0IHRvIHdoZXRoZXIgdGhlIGFzc2V0IGlzIGluIGEgb3BlbiBtYWtlIG9yZGVyIGFzIGJ1eSBhc3NldAoKICAgIC8vIE1FVEhPRFMKCiAgICAvLyBDT05TVFJVQ1RPUgoKICAgIC8vLyBAZGV2IFNob3VsZCBvbmx5IGJlIGNhbGxlZCB2aWEgVmVyc2lvbi5zZXR1cEZ1bmQoLi4pCiAgICAvLy8gQHBhcmFtIHdpdGhOYW1lIGh1bWFuLXJlYWRhYmxlIGRlc2NyaXB0aXZlIG5hbWUgKG5vdCBuZWNlc3NhcmlseSB1bmlxdWUpCiAgICAvLy8gQHBhcmFtIG9mUXVvdGVBc3NldCBBc3NldCBhZ2FpbnN0IHdoaWNoIG1nbXQgYW5kIHBlcmZvcm1hbmNlIGZlZSBpcyBtZWFzdXJlZCBhZ2FpbnN0IGFuZCB3aGljaCBjYW4gYmUgdXNlZCB0byBpbnZlc3QvcmVkZWVtIHVzaW5nIHRoaXMgc2luZ2xlIGFzc2V0CiAgICAvLy8gQHBhcmFtIG9mTWFuYWdlbWVudEZlZSBBIHRpbWUgYmFzZWQgZmVlIGV4cHJlc3NlZCwgZ2l2ZW4gaW4gYSBudW1iZXIgd2hpY2ggaXMgZGl2aWRlZCBieSAxIFdBRAogICAgLy8vIEBwYXJhbSBvZlBlcmZvcm1hbmNlRmVlIEEgdGltZSBwZXJmb3JtYW5jZSBiYXNlZCBmZWUsIHBlcmZvcm1hbmNlIHJlbGF0aXZlIHRvIG9mUXVvdGVBc3NldCwgZ2l2ZW4gaW4gYSBudW1iZXIgd2hpY2ggaXMgZGl2aWRlZCBieSAxIFdBRAogICAgLy8vIEBwYXJhbSBvZkNvbXBsaWFuY2UgQWRkcmVzcyBvZiBjb21wbGlhbmNlIG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZlJpc2tNZ210IEFkZHJlc3Mgb2YgcmlzayBtYW5hZ2VtZW50IG1vZHVsZQogICAgLy8vIEBwYXJhbSBvZlByaWNlRmVlZCBBZGRyZXNzIG9mIHByaWNlIGZlZWQgbW9kdWxlCiAgICAvLy8gQHBhcmFtIG9mRXhjaGFuZ2VzIEFkZHJlc3NlcyBvZiBleGNoYW5nZSBvbiB3aGljaCB0aGlzIGZ1bmQgY2FuIHRyYWRlCiAgICAvLy8gQHBhcmFtIG9mRXhjaGFuZ2VBZGFwdGVycyBBZGRyZXNzZXMgb2YgZXhjaGFuZ2UgYWRhcHRlcnMKICAgIC8vLyBAcmV0dXJuIERlcGxveWVkIEZ1bmQgd2l0aCBtYW5hZ2VyIHNldCBhcyBvZk1hbmFnZXIKICAgIGZ1bmN0aW9uIEZ1bmQoCiAgICAgICAgYWRkcmVzcyBvZk1hbmFnZXIsCiAgICAgICAgc3RyaW5nIHdpdGhOYW1lLAogICAgICAgIGFkZHJlc3Mgb2ZRdW90ZUFzc2V0LAogICAgICAgIHVpbnQgb2ZNYW5hZ2VtZW50RmVlLAogICAgICAgIHVpbnQgb2ZQZXJmb3JtYW5jZUZlZSwKICAgICAgICBhZGRyZXNzIG9mTmF0aXZlQXNzZXQsCiAgICAgICAgYWRkcmVzcyBvZkNvbXBsaWFuY2UsCiAgICAgICAgYWRkcmVzcyBvZlJpc2tNZ210LAogICAgICAgIGFkZHJlc3Mgb2ZQcmljZUZlZWQsCiAgICAgICAgYWRkcmVzc1tdIG9mRXhjaGFuZ2VzLAogICAgICAgIGFkZHJlc3NbXSBvZkV4Y2hhbmdlQWRhcHRlcnMKICAgICkKICAgICAgICBSZXN0cmljdGVkU2hhcmVzKHdpdGhOYW1lLCAiTUxORiIsIDE4LCBub3cpCiAgICB7CiAgICAgICAgaXNJbnZlc3RBbGxvd2VkID0gdHJ1ZTsKICAgICAgICBpc1JlZGVlbUFsbG93ZWQgPSB0cnVlOwogICAgICAgIG93bmVyID0gb2ZNYW5hZ2VyOwogICAgICAgIHJlcXVpcmUob2ZNYW5hZ2VtZW50RmVlIDwgMTAgKiogMTgpOyAvLyBSZXF1aXJlIG1hbmFnZW1lbnQgZmVlIHRvIGJlIGxlc3MgdGhhbiAxMDAgcGVyY2VudAogICAgICAgIE1BTkFHRU1FTlRfRkVFX1JBVEUgPSBvZk1hbmFnZW1lbnRGZWU7IC8vIDEgcGVyY2VudCBpcyBleHByZXNzZWQgYXMgMC4wMSAqIDEwICoqIDE4CiAgICAgICAgcmVxdWlyZShvZlBlcmZvcm1hbmNlRmVlIDwgMTAgKiogMTgpOyAvLyBSZXF1aXJlIHBlcmZvcm1hbmNlIGZlZSB0byBiZSBsZXNzIHRoYW4gMTAwIHBlcmNlbnQKICAgICAgICBQRVJGT1JNQU5DRV9GRUVfUkFURSA9IG9mUGVyZm9ybWFuY2VGZWU7IC8vIDEgcGVyY2VudCBpcyBleHByZXNzZWQgYXMgMC4wMSAqIDEwICoqIDE4CiAgICAgICAgVkVSU0lPTiA9IG1zZy5zZW5kZXI7CiAgICAgICAgbW9kdWxlLmNvbXBsaWFuY2UgPSBDb21wbGlhbmNlSW50ZXJmYWNlKG9mQ29tcGxpYW5jZSk7CiAgICAgICAgbW9kdWxlLnJpc2ttZ210ID0gUmlza01nbXRJbnRlcmZhY2Uob2ZSaXNrTWdtdCk7CiAgICAgICAgbW9kdWxlLnByaWNlZmVlZCA9IFByaWNlRmVlZEludGVyZmFjZShvZlByaWNlRmVlZCk7CiAgICAgICAgLy8gQnJpZGdlZCB0byBNZWxvbiBleGNoYW5nZSBpbnRlcmZhY2UgYnkgZXhjaGFuZ2VBZGFwdGVyIGxpYnJhcnkKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBvZkV4Y2hhbmdlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBFeGNoYW5nZUludGVyZmFjZSBhZGFwdGVyID0gRXhjaGFuZ2VJbnRlcmZhY2Uob2ZFeGNoYW5nZUFkYXB0ZXJzW2ldKTsKICAgICAgICAgICAgYm9vbCBpc0FwcHJvdmVPbmx5ID0gYWRhcHRlci5pc0FwcHJvdmVPbmx5KCk7CiAgICAgICAgICAgIGV4Y2hhbmdlcy5wdXNoKEV4Y2hhbmdlKHsKICAgICAgICAgICAgICAgIGV4Y2hhbmdlOiBvZkV4Y2hhbmdlc1tpXSwKICAgICAgICAgICAgICAgIGV4Y2hhbmdlQWRhcHRlcjogYWRhcHRlciwKICAgICAgICAgICAgICAgIGlzQXBwcm92ZU9ubHk6IGlzQXBwcm92ZU9ubHkKICAgICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgICAvLyBSZXF1aXJlIFF1b3RlIGFzc2V0cyBleGlzdHMgaW4gcHJpY2VmZWVkCiAgICAgICAgUVVPVEVfQVNTRVQgPSBBc3NldChvZlF1b3RlQXNzZXQpOwogICAgICAgIE5BVElWRV9BU1NFVCA9IE5hdGl2ZUFzc2V0SW50ZXJmYWNlKG9mTmF0aXZlQXNzZXQpOwogICAgICAgIC8vIFF1b3RlIEFzc2V0IGFuZCBOYXRpdmUgYXNzZXQgYWx3YXlzIGluIG93bmVkIGFzc2V0cyBsaXN0CiAgICAgICAgb3duZWRBc3NldHMucHVzaChvZlF1b3RlQXNzZXQpOwogICAgICAgIGlzSW5Bc3NldExpc3Rbb2ZRdW90ZUFzc2V0XSA9IHRydWU7CiAgICAgICAgb3duZWRBc3NldHMucHVzaChvZk5hdGl2ZUFzc2V0KTsKICAgICAgICBpc0luQXNzZXRMaXN0W29mTmF0aXZlQXNzZXRdID0gdHJ1ZTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoUVVPVEVfQVNTRVQpID09IG1vZHVsZS5wcmljZWZlZWQuZ2V0UXVvdGVBc3NldCgpKTsgLy8gU2FuaXR5IGNoZWNrCiAgICAgICAgYXRMYXN0VW5jbGFpbWVkRmVlQWxsb2NhdGlvbiA9IENhbGN1bGF0aW9ucyh7CiAgICAgICAgICAgIGdhdjogMCwKICAgICAgICAgICAgbWFuYWdlbWVudEZlZTogMCwKICAgICAgICAgICAgcGVyZm9ybWFuY2VGZWU6IDAsCiAgICAgICAgICAgIHVuY2xhaW1lZEZlZXM6IDAsCiAgICAgICAgICAgIG5hdjogMCwKICAgICAgICAgICAgaGlnaFdhdGVyTWFyazogMTAgKiogZ2V0RGVjaW1hbHMoKSwKICAgICAgICAgICAgdG90YWxTdXBwbHk6IHRvdGFsU3VwcGx5LAogICAgICAgICAgICB0aW1lc3RhbXA6IG5vdwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIEVYVEVSTkFMIE1FVEhPRFMKCiAgICAvLyBFWFRFUk5BTCA6IEFETUlOSVNUUkFUSU9OCgogICAgZnVuY3Rpb24gZW5hYmxlSW52ZXN0bWVudCgpIGV4dGVybmFsIHByZV9jb25kKGlzT3duZXIoKSkgeyBpc0ludmVzdEFsbG93ZWQgPSB0cnVlOyB9CiAgICBmdW5jdGlvbiBkaXNhYmxlSW52ZXN0bWVudCgpIGV4dGVybmFsIHByZV9jb25kKGlzT3duZXIoKSkgeyBpc0ludmVzdEFsbG93ZWQgPSBmYWxzZTsgfQogICAgZnVuY3Rpb24gZW5hYmxlUmVkZW1wdGlvbigpIGV4dGVybmFsIHByZV9jb25kKGlzT3duZXIoKSkgeyBpc1JlZGVlbUFsbG93ZWQgPSB0cnVlOyB9CiAgICBmdW5jdGlvbiBkaXNhYmxlUmVkZW1wdGlvbigpIGV4dGVybmFsIHByZV9jb25kKGlzT3duZXIoKSkgeyBpc1JlZGVlbUFsbG93ZWQgPSBmYWxzZTsgfQogICAgZnVuY3Rpb24gc2h1dERvd24oKSBleHRlcm5hbCBwcmVfY29uZChtc2cuc2VuZGVyID09IFZFUlNJT04pIHsgaXNTaHV0RG93biA9IHRydWU7IH0KCgogICAgLy8gRVhURVJOQUwgOiBQQVJUSUNJUEFUSU9OCgogICAgLy8vIEBub3RpY2UgR2l2ZSBtZWxvbiB0b2tlbnMgdG8gcmVjZWl2ZSBzaGFyZXMgb2YgdGhpcyBmdW5kCiAgICAvLy8gQGRldiBSZWNvbW1lbmRlZCB0byBnaXZlIHNvbWUgbGVld2F5IGluIHByaWNlcyB0byBhY2NvdW50IGZvciBwb3NzaWJseSBzbGlnaHRseSBjaGFuZ2luZyBwcmljZXMKICAgIC8vLyBAcGFyYW0gZ2l2ZVF1YW50aXR5IFF1YW50aXR5IG9mIE1lbG9uIHRva2VuIHRpbWVzIDEwICoqIDE4IG9mZmVyZWQgdG8gcmVjZWl2ZSBzaGFyZVF1YW50aXR5CiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2hhcmVzIHRpbWVzIDEwICoqIDE4IHJlcXVlc3RlZCB0byBiZSByZWNlaXZlZAogICAgZnVuY3Rpb24gcmVxdWVzdEludmVzdG1lbnQoCiAgICAgICAgdWludCBnaXZlUXVhbnRpdHksCiAgICAgICAgdWludCBzaGFyZVF1YW50aXR5LAogICAgICAgIGJvb2wgaXNOYXRpdmVBc3NldAogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcHJlX2NvbmQoIWlzU2h1dERvd24pCiAgICAgICAgcHJlX2NvbmQoaXNJbnZlc3RBbGxvd2VkKSAvLyBpbnZlc3RtZW50IHVzaW5nIE1lbG9uIGhhcyBub3QgYmVlbiBkZWFjdGl2YXRlZCBieSB0aGUgTWFuYWdlcgogICAgICAgIHByZV9jb25kKG1vZHVsZS5jb21wbGlhbmNlLmlzSW52ZXN0bWVudFBlcm1pdHRlZChtc2cuc2VuZGVyLCBnaXZlUXVhbnRpdHksIHNoYXJlUXVhbnRpdHkpKSAgICAvLyBDb21wbGlhbmNlIE1vZHVsZTogSW52ZXN0bWVudCBwZXJtaXR0ZWQKICAgIHsKICAgICAgICByZXF1ZXN0cy5wdXNoKFJlcXVlc3QoewogICAgICAgICAgICBwYXJ0aWNpcGFudDogbXNnLnNlbmRlciwKICAgICAgICAgICAgc3RhdHVzOiBSZXF1ZXN0U3RhdHVzLmFjdGl2ZSwKICAgICAgICAgICAgcmVxdWVzdFR5cGU6IFJlcXVlc3RUeXBlLmludmVzdCwKICAgICAgICAgICAgcmVxdWVzdEFzc2V0OiBpc05hdGl2ZUFzc2V0ID8gYWRkcmVzcyhOQVRJVkVfQVNTRVQpIDogYWRkcmVzcyhRVU9URV9BU1NFVCksCiAgICAgICAgICAgIHNoYXJlUXVhbnRpdHk6IHNoYXJlUXVhbnRpdHksCiAgICAgICAgICAgIGdpdmVRdWFudGl0eTogZ2l2ZVF1YW50aXR5LAogICAgICAgICAgICByZWNlaXZlUXVhbnRpdHk6IHNoYXJlUXVhbnRpdHksCiAgICAgICAgICAgIHRpbWVzdGFtcDogbm93LAogICAgICAgICAgICBhdFVwZGF0ZUlkOiBtb2R1bGUucHJpY2VmZWVkLmdldExhc3RVcGRhdGVJZCgpCiAgICAgICAgfSkpOwogICAgICAgIFJlcXVlc3RVcGRhdGVkKGdldExhc3RSZXF1ZXN0SWQoKSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2l2ZSBzaGFyZXMgb2YgdGhpcyBmdW5kIHRvIHJlY2VpdmUgbWVsb24gdG9rZW5zCiAgICAvLy8gQGRldiBSZWNvbW1lbmRlZCB0byBnaXZlIHNvbWUgbGVld2F5IGluIHByaWNlcyB0byBhY2NvdW50IGZvciBwb3NzaWJseSBzbGlnaHRseSBjaGFuZ2luZyBwcmljZXMKICAgIC8vLyBAcGFyYW0gc2hhcmVRdWFudGl0eSBRdWFudGl0eSBvZiBzaGFyZXMgdGltZXMgMTAgKiogMTggb2ZmZXJlZCB0byByZWRlZW0KICAgIC8vLyBAcGFyYW0gcmVjZWl2ZVF1YW50aXR5IFF1YW50aXR5IG9mIE1lbG9uIHRva2VuIHRpbWVzIDEwICoqIDE4IHJlcXVlc3RlZCB0byByZWNlaXZlIGZvciBzaGFyZVF1YW50aXR5CiAgICBmdW5jdGlvbiByZXF1ZXN0UmVkZW1wdGlvbigKICAgICAgICB1aW50IHNoYXJlUXVhbnRpdHksCiAgICAgICAgdWludCByZWNlaXZlUXVhbnRpdHksCiAgICAgICAgYm9vbCBpc05hdGl2ZUFzc2V0CiAgICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHByZV9jb25kKCFpc1NodXREb3duKQogICAgICAgIHByZV9jb25kKGlzUmVkZWVtQWxsb3dlZCkgLy8gUmVkZW1wdGlvbiB1c2luZyBNZWxvbiBoYXMgbm90IGJlZW4gZGVhY3RpdmF0ZWQgYnkgTWFuYWdlcgogICAgICAgIHByZV9jb25kKG1vZHVsZS5jb21wbGlhbmNlLmlzUmVkZW1wdGlvblBlcm1pdHRlZChtc2cuc2VuZGVyLCBzaGFyZVF1YW50aXR5LCByZWNlaXZlUXVhbnRpdHkpKSAvLyBDb21wbGlhbmNlIE1vZHVsZTogUmVkZW1wdGlvbiBwZXJtaXR0ZWQKICAgIHsKICAgICAgICByZXF1ZXN0cy5wdXNoKFJlcXVlc3QoewogICAgICAgICAgICBwYXJ0aWNpcGFudDogbXNnLnNlbmRlciwKICAgICAgICAgICAgc3RhdHVzOiBSZXF1ZXN0U3RhdHVzLmFjdGl2ZSwKICAgICAgICAgICAgcmVxdWVzdFR5cGU6IFJlcXVlc3RUeXBlLnJlZGVlbSwKICAgICAgICAgICAgcmVxdWVzdEFzc2V0OiBpc05hdGl2ZUFzc2V0ID8gYWRkcmVzcyhOQVRJVkVfQVNTRVQpIDogYWRkcmVzcyhRVU9URV9BU1NFVCksCiAgICAgICAgICAgIHNoYXJlUXVhbnRpdHk6IHNoYXJlUXVhbnRpdHksCiAgICAgICAgICAgIGdpdmVRdWFudGl0eTogc2hhcmVRdWFudGl0eSwKICAgICAgICAgICAgcmVjZWl2ZVF1YW50aXR5OiByZWNlaXZlUXVhbnRpdHksCiAgICAgICAgICAgIHRpbWVzdGFtcDogbm93LAogICAgICAgICAgICBhdFVwZGF0ZUlkOiBtb2R1bGUucHJpY2VmZWVkLmdldExhc3RVcGRhdGVJZCgpCiAgICAgICAgfSkpOwogICAgICAgIFJlcXVlc3RVcGRhdGVkKGdldExhc3RSZXF1ZXN0SWQoKSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRXhlY3V0ZXMgYWN0aXZlIGludmVzdG1lbnQgYW5kIHJlZGVtcHRpb24gcmVxdWVzdHMsIGluIGEgd2F5IHRoYXQgbWluaW1pc2VzIGluZm9ybWF0aW9uIGFkdmFudGFnZXMgb2YgaW52ZXN0b3IKICAgIC8vLyBAZGV2IERpc3RyaWJ1dGVzIG1lbG9uIGFuZCBzaGFyZXMgYWNjb3JkaW5nIHRvIHRoZSByZXF1ZXN0CiAgICAvLy8gQHBhcmFtIGlkIEluZGV4IG9mIHJlcXVlc3QgdG8gYmUgZXhlY3V0ZWQKICAgIC8vLyBAZGV2IEFjdGl2ZSBpbnZlc3RtZW50IG9yIHJlZGVtcHRpb24gcmVxdWVzdCBleGVjdXRlZAogICAgZnVuY3Rpb24gZXhlY3V0ZVJlcXVlc3QodWludCBpZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHByZV9jb25kKCFpc1NodXREb3duKQogICAgICAgIHByZV9jb25kKHJlcXVlc3RzW2lkXS5zdGF0dXMgPT0gUmVxdWVzdFN0YXR1cy5hY3RpdmUpCiAgICAgICAgcHJlX2NvbmQocmVxdWVzdHNbaWRdLnJlcXVlc3RUeXBlICE9IFJlcXVlc3RUeXBlLnJlZGVlbSB8fCByZXF1ZXN0c1tpZF0uc2hhcmVRdWFudGl0eSA8PSBiYWxhbmNlc1tyZXF1ZXN0c1tpZF0ucGFydGljaXBhbnRdKSAvLyByZXF1ZXN0IG93bmVyIGRvZXMgbm90IG93biBlbm91Z2ggc2hhcmVzCiAgICAgICAgcHJlX2NvbmQoCiAgICAgICAgICAgIHRvdGFsU3VwcGx5ID09IDAgfHwKICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgbm93ID49IGFkZChyZXF1ZXN0c1tpZF0udGltZXN0YW1wLCBtb2R1bGUucHJpY2VmZWVkLmdldEludGVydmFsKCkpICYmCiAgICAgICAgICAgICAgICBtb2R1bGUucHJpY2VmZWVkLmdldExhc3RVcGRhdGVJZCgpID49IGFkZChyZXF1ZXN0c1tpZF0uYXRVcGRhdGVJZCwgMikKICAgICAgICAgICAgKQogICAgICAgICkgICAvLyBQcmljZUZlZWQgTW9kdWxlOiBXYWl0IGF0IGxlYXN0IG9uZSBpbnRlcnZhbCB0aW1lIGFuZCB0d28gdXBkYXRlcyBiZWZvcmUgY29udGludWluZyAodW5sZXNzIGl0IGlzIHRoZSBmaXJzdCBpbnZlc3RtZW50KQoKICAgIHsKICAgICAgICBSZXF1ZXN0IHJlcXVlc3QgPSByZXF1ZXN0c1tpZF07CiAgICAgICAgLy8gUHJpY2VGZWVkIE1vZHVsZTogTm8gcmVjZW50IHVwZGF0ZXMgZm9yIGZ1bmQgYXNzZXQgbGlzdAogICAgICAgIHJlcXVpcmUobW9kdWxlLnByaWNlZmVlZC5oYXNSZWNlbnRQcmljZShhZGRyZXNzKHJlcXVlc3QucmVxdWVzdEFzc2V0KSkpOwoKICAgICAgICAvLyBzaGFyZVByaWNlIHF1b3RlZCBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBmdW5kRGVjaW1hbHMKICAgICAgICB1aW50IGNvc3RRdWFudGl0eSA9IHRvV2hvbGVTaGFyZVVuaXQobXVsKHJlcXVlc3Quc2hhcmVRdWFudGl0eSwgY2FsY1NoYXJlUHJpY2VBbmRBbGxvY2F0ZUZlZXMoKSkpOyAvLyBCeSBkZWZpbml0aW9uIHF1b3RlRGVjaW1hbHMgPT0gZnVuZERlY2ltYWxzCiAgICAgICAgaWYgKHJlcXVlc3QucmVxdWVzdEFzc2V0ID09IGFkZHJlc3MoTkFUSVZFX0FTU0VUKSkgewogICAgICAgICAgICB2YXIgKGlzUHJpY2VSZWNlbnQsIGludmVydGVkTmF0aXZlQXNzZXRQcmljZSwgbmF0aXZlQXNzZXREZWNpbWFsKSA9IG1vZHVsZS5wcmljZWZlZWQuZ2V0SW52ZXJ0ZWRQcmljZShhZGRyZXNzKE5BVElWRV9BU1NFVCkpOwogICAgICAgICAgICBpZiAoIWlzUHJpY2VSZWNlbnQpIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvc3RRdWFudGl0eSA9IG11bChjb3N0UXVhbnRpdHksIGludmVydGVkTmF0aXZlQXNzZXRQcmljZSkgLyAxMCAqKiBuYXRpdmVBc3NldERlY2ltYWw7CiAgICAgICAgfQoKICAgICAgICBpZiAoCiAgICAgICAgICAgIGlzSW52ZXN0QWxsb3dlZCAmJgogICAgICAgICAgICByZXF1ZXN0LnJlcXVlc3RUeXBlID09IFJlcXVlc3RUeXBlLmludmVzdCAmJgogICAgICAgICAgICBjb3N0UXVhbnRpdHkgPD0gcmVxdWVzdC5naXZlUXVhbnRpdHkKICAgICAgICApIHsKICAgICAgICAgICAgcmVxdWVzdC5zdGF0dXMgPSBSZXF1ZXN0U3RhdHVzLmV4ZWN1dGVkOwogICAgICAgICAgICBhc3NlcnQoQXNzZXRJbnRlcmZhY2UocmVxdWVzdC5yZXF1ZXN0QXNzZXQpLnRyYW5zZmVyRnJvbShyZXF1ZXN0LnBhcnRpY2lwYW50LCB0aGlzLCBjb3N0UXVhbnRpdHkpKTsgLy8gQWxsb2NhdGUgVmFsdWUKICAgICAgICAgICAgY3JlYXRlU2hhcmVzKHJlcXVlc3QucGFydGljaXBhbnQsIHJlcXVlc3Quc2hhcmVRdWFudGl0eSk7IC8vIEFjY291bnRpbmcKICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICBpc1JlZGVlbUFsbG93ZWQgJiYKICAgICAgICAgICAgcmVxdWVzdC5yZXF1ZXN0VHlwZSA9PSBSZXF1ZXN0VHlwZS5yZWRlZW0gJiYKICAgICAgICAgICAgcmVxdWVzdC5yZWNlaXZlUXVhbnRpdHkgPD0gY29zdFF1YW50aXR5CiAgICAgICAgKSB7CiAgICAgICAgICAgIHJlcXVlc3Quc3RhdHVzID0gUmVxdWVzdFN0YXR1cy5leGVjdXRlZDsKICAgICAgICAgICAgYXNzZXJ0KEFzc2V0SW50ZXJmYWNlKHJlcXVlc3QucmVxdWVzdEFzc2V0KS50cmFuc2ZlcihyZXF1ZXN0LnBhcnRpY2lwYW50LCBjb3N0UXVhbnRpdHkpKTsgLy8gUmV0dXJuIHZhbHVlCiAgICAgICAgICAgIGFubmloaWxhdGVTaGFyZXMocmVxdWVzdC5wYXJ0aWNpcGFudCwgcmVxdWVzdC5zaGFyZVF1YW50aXR5KTsgLy8gQWNjb3VudGluZwogICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIGlzUmVkZWVtQWxsb3dlZCAmJgogICAgICAgICAgICByZXF1ZXN0LnJlcXVlc3RUeXBlID09IFJlcXVlc3RUeXBlLnRva2VuRmFsbGJhY2tSZWRlZW0gJiYKICAgICAgICAgICAgcmVxdWVzdC5yZWNlaXZlUXVhbnRpdHkgPD0gY29zdFF1YW50aXR5CiAgICAgICAgKSB7CiAgICAgICAgICAgIHJlcXVlc3Quc3RhdHVzID0gUmVxdWVzdFN0YXR1cy5leGVjdXRlZDsKICAgICAgICAgICAgYXNzZXJ0KEFzc2V0SW50ZXJmYWNlKHJlcXVlc3QucmVxdWVzdEFzc2V0KS50cmFuc2ZlcihyZXF1ZXN0LnBhcnRpY2lwYW50LCBjb3N0UXVhbnRpdHkpKTsgLy8gUmV0dXJuIHZhbHVlCiAgICAgICAgICAgIGFubmloaWxhdGVTaGFyZXModGhpcywgcmVxdWVzdC5zaGFyZVF1YW50aXR5KTsgLy8gQWNjb3VudGluZwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOyAvLyBJbnZhbGlkIFJlcXVlc3Qgb3IgaW52YWxpZCBnaXZlUXVhbnRpdHkgLyByZWNlaXZlUXVhbnRpdHkKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2FuY2VscyBhY3RpdmUgaW52ZXN0bWVudCBhbmQgcmVkZW1wdGlvbiByZXF1ZXN0cwogICAgLy8vIEBwYXJhbSBpZCBJbmRleCBvZiByZXF1ZXN0IHRvIGJlIGV4ZWN1dGVkCiAgICBmdW5jdGlvbiBjYW5jZWxSZXF1ZXN0KHVpbnQgaWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwcmVfY29uZChyZXF1ZXN0c1tpZF0uc3RhdHVzID09IFJlcXVlc3RTdGF0dXMuYWN0aXZlKSAvLyBSZXF1ZXN0IGlzIGFjdGl2ZQogICAgICAgIHByZV9jb25kKHJlcXVlc3RzW2lkXS5wYXJ0aWNpcGFudCA9PSBtc2cuc2VuZGVyIHx8IGlzU2h1dERvd24pIC8vIEVpdGhlciByZXF1ZXN0IGNyZWF0b3Igb3IgZnVuZCBpcyBzaHV0IGRvd24KICAgIHsKICAgICAgICByZXF1ZXN0c1tpZF0uc3RhdHVzID0gUmVxdWVzdFN0YXR1cy5jYW5jZWxsZWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmVkZWVtcyBieSBhbGxvY2F0aW5nIGFuIG93bmVyc2hpcCBwZXJjZW50YWdlIG9mIGVhY2ggYXNzZXQgdG8gdGhlIHBhcnRpY2lwYW50CiAgICAvLy8gQGRldiBJbmRlcGVuZGVudCBvZiBydW5uaW5nIHByaWNlIGZlZWQhCiAgICAvLy8gQHBhcmFtIHNoYXJlUXVhbnRpdHkgTnVtYmVyIG9mIHNoYXJlcyBvd25lZCBieSB0aGUgcGFydGljaXBhbnQsIHdoaWNoIHRoZSBwYXJ0aWNpcGFudCB3b3VsZCBsaWtlIHRvIHJlZGVlbSBmb3IgaW5kaXZpZHVhbCBhc3NldHMKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgYWxsIGFzc2V0cyBzZW50IHRvIHNoYXJlaG9sZGVyIG9yIG5vdAogICAgZnVuY3Rpb24gcmVkZWVtQWxsT3duZWRBc3NldHModWludCBzaGFyZVF1YW50aXR5KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJldHVybiBlbWVyZ2VuY3lSZWRlZW0oc2hhcmVRdWFudGl0eSwgb3duZWRBc3NldHMpOwogICAgfQoKICAgIC8vIEVYVEVSTkFMIDogTUFOQUdJTkcKCiAgICAvLy8gQG5vdGljZSBNYWtlcyBhbiBvcmRlciBvbiB0aGUgc2VsZWN0ZWQgZXhjaGFuZ2UKICAgIC8vLyBAZGV2IFRoZXNlIGFyZSBvcmRlcnMgdGhhdCBhcmUgbm90IGV4cGVjdGVkIHRvIHNldHRsZSBpbW1lZGlhdGVseS4gIFN1ZmZpY2llbnQgYmFsYW5jZSAoPT0gc2VsbFF1YW50aXR5KSBvZiBzZWxsQXNzZXQKICAgIC8vLyBAcGFyYW0gc2VsbEFzc2V0IEFzc2V0IChhcyByZWdpc3RlcmVkIGluIEFzc2V0IHJlZ2lzdHJhcikgdG8gYmUgc29sZAogICAgLy8vIEBwYXJhbSBidXlBc3NldCBBc3NldCAoYXMgcmVnaXN0ZXJlZCBpbiBBc3NldCByZWdpc3RyYXIpIHRvIGJlIGJvdWdodAogICAgLy8vIEBwYXJhbSBzZWxsUXVhbnRpdHkgUXVhbnRpdHkgb2Ygc2VsbEFzc2V0IHRvIGJlIHNvbGQKICAgIC8vLyBAcGFyYW0gYnV5UXVhbnRpdHkgUXVhbnRpdHkgb2YgYnV5QXNzZXQgdG8gYmUgYm91Z2h0CiAgICBmdW5jdGlvbiBtYWtlT3JkZXIoCiAgICAgICAgdWludCBleGNoYW5nZU51bWJlciwKICAgICAgICBhZGRyZXNzIHNlbGxBc3NldCwKICAgICAgICBhZGRyZXNzIGJ1eUFzc2V0LAogICAgICAgIHVpbnQgc2VsbFF1YW50aXR5LAogICAgICAgIHVpbnQgYnV5UXVhbnRpdHkKICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHByZV9jb25kKGlzT3duZXIoKSkKICAgICAgICBwcmVfY29uZCghaXNTaHV0RG93bikKICAgIHsKICAgICAgICByZXF1aXJlKGJ1eUFzc2V0ICE9IGFkZHJlc3ModGhpcykpOyAvLyBQcmV2ZW50IGJ1eWluZyBvZiBvd24gZnVuZCB0b2tlbgogICAgICAgIHJlcXVpcmUocXVhbnRpdHlIZWxkSW5DdXN0b2R5T2ZFeGNoYW5nZShzZWxsQXNzZXQpID09IDApOyAvLyBDdXJyIG9ubHkgb25lIG1ha2Ugb3JkZXIgcGVyIHNlbGxBc3NldCBhbGxvd2VkLiBQbGVhc2Ugd2FpdCBvciBjYW5jZWwgZXhpc3RpbmcgbWFrZSBvcmRlci4KICAgICAgICByZXF1aXJlKG1vZHVsZS5wcmljZWZlZWQuZXhpc3RzUHJpY2VPbkFzc2V0UGFpcihzZWxsQXNzZXQsIGJ1eUFzc2V0KSk7IC8vIFByaWNlRmVlZCBtb2R1bGU6IFJlcXVlc3RlZCBhc3NldCBwYWlyIG5vdCB2YWxpZAogICAgICAgIHZhciAoaXNSZWNlbnQsIHJlZmVyZW5jZVByaWNlLCApID0gbW9kdWxlLnByaWNlZmVlZC5nZXRSZWZlcmVuY2VQcmljZShzZWxsQXNzZXQsIGJ1eUFzc2V0KTsKICAgICAgICByZXF1aXJlKGlzUmVjZW50KTsgIC8vIFJlZmVyZW5jZSBwcmljZSBpcyByZXF1aXJlZCB0byBiZSByZWNlbnQKICAgICAgICByZXF1aXJlKAogICAgICAgICAgICBtb2R1bGUucmlza21nbXQuaXNNYWtlUGVybWl0dGVkKAogICAgICAgICAgICAgICAgbW9kdWxlLnByaWNlZmVlZC5nZXRPcmRlclByaWNlKAogICAgICAgICAgICAgICAgICAgIHNlbGxBc3NldCwKICAgICAgICAgICAgICAgICAgICBidXlBc3NldCwKICAgICAgICAgICAgICAgICAgICBzZWxsUXVhbnRpdHksCiAgICAgICAgICAgICAgICAgICAgYnV5UXVhbnRpdHkKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICByZWZlcmVuY2VQcmljZSwKICAgICAgICAgICAgICAgIHNlbGxBc3NldCwKICAgICAgICAgICAgICAgIGJ1eUFzc2V0LAogICAgICAgICAgICAgICAgc2VsbFF1YW50aXR5LAogICAgICAgICAgICAgICAgYnV5UXVhbnRpdHkKICAgICAgICAgICAgKQogICAgICAgICk7IC8vIFJpc2tNZ210IG1vZHVsZTogTWFrZSBvcmRlciBub3QgcGVybWl0dGVkCiAgICAgICAgcmVxdWlyZShpc0luQXNzZXRMaXN0W2J1eUFzc2V0XSB8fCBvd25lZEFzc2V0cy5sZW5ndGggPCBNQVhfRlVORF9BU1NFVFMpOyAvLyBMaW1pdCBmb3IgbWF4IG93bmFibGUgYXNzZXRzIGJ5IHRoZSBmdW5kIHJlYWNoZWQKICAgICAgICByZXF1aXJlKEFzc2V0SW50ZXJmYWNlKHNlbGxBc3NldCkuYXBwcm92ZShleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBzZWxsUXVhbnRpdHkpKTsgLy8gQXBwcm92ZSBleGNoYW5nZSB0byBzcGVuZCBhc3NldHMKCiAgICAgICAgLy8gU2luY2UgdGhlcmUgaXMgb25seSBvbmUgb3Blbk1ha2VPcmRlciBhbGxvd2VkIGZvciBlYWNoIGFzc2V0LCB3ZSBjYW4gYXNzdW1lIHRoYXQgb3Blbk1ha2VPcmRlcklkIGlzIHNldCBhcyB6ZXJvIGJ5IHF1YW50aXR5SGVsZEluQ3VzdG9keU9mRXhjaGFuZ2UoKSBmdW5jdGlvbgogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlQWRhcHRlcikuZGVsZWdhdGVjYWxsKGJ5dGVzNChrZWNjYWsyNTYoIm1ha2VPcmRlcihhZGRyZXNzLGFkZHJlc3MsYWRkcmVzcyx1aW50MjU2LHVpbnQyNTYpIikpLCBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBzZWxsQXNzZXQsIGJ1eUFzc2V0LCBzZWxsUXVhbnRpdHksIGJ1eVF1YW50aXR5KSk7CiAgICAgICAgZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHNbZXhjaGFuZ2VOdW1iZXJdW3NlbGxBc3NldF0gPSBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlQWRhcHRlci5nZXRMYXN0T3JkZXJJZChleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlKTsKCiAgICAgICAgLy8gU3VjY2VzcyBkZWZpbmVkIGFzIG5vbi16ZXJvIG9yZGVyIGlkCiAgICAgICAgcmVxdWlyZShleGNoYW5nZUlkc1RvT3Blbk1ha2VPcmRlcklkc1tleGNoYW5nZU51bWJlcl1bc2VsbEFzc2V0XSAhPSAwKTsKCiAgICAgICAgLy8gVXBkYXRlIG93bmVkQXNzZXRzIGFycmF5IGFuZCBpc0luQXNzZXRMaXN0LCBpc0luT3Blbk1ha2VPcmRlciBtYXBwaW5nCiAgICAgICAgaXNJbk9wZW5NYWtlT3JkZXJbYnV5QXNzZXRdID0gdHJ1ZTsKICAgICAgICBpZiAoIWlzSW5Bc3NldExpc3RbYnV5QXNzZXRdKSB7CiAgICAgICAgICAgIG93bmVkQXNzZXRzLnB1c2goYnV5QXNzZXQpOwogICAgICAgICAgICBpc0luQXNzZXRMaXN0W2J1eUFzc2V0XSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBvcmRlcnMucHVzaChPcmRlcih7CiAgICAgICAgICAgIGV4Y2hhbmdlSWQ6IGV4Y2hhbmdlSWRzVG9PcGVuTWFrZU9yZGVySWRzW2V4Y2hhbmdlTnVtYmVyXVtzZWxsQXNzZXRdLAogICAgICAgICAgICBzdGF0dXM6IE9yZGVyU3RhdHVzLmFjdGl2ZSwKICAgICAgICAgICAgb3JkZXJUeXBlOiBPcmRlclR5cGUubWFrZSwKICAgICAgICAgICAgc2VsbEFzc2V0OiBzZWxsQXNzZXQsCiAgICAgICAgICAgIGJ1eUFzc2V0OiBidXlBc3NldCwKICAgICAgICAgICAgc2VsbFF1YW50aXR5OiBzZWxsUXVhbnRpdHksCiAgICAgICAgICAgIGJ1eVF1YW50aXR5OiBidXlRdWFudGl0eSwKICAgICAgICAgICAgdGltZXN0YW1wOiBub3csCiAgICAgICAgICAgIGZpbGxRdWFudGl0eTogMAogICAgICAgIH0pKTsKCiAgICAgICAgT3JkZXJVcGRhdGVkKGV4Y2hhbmdlSWRzVG9PcGVuTWFrZU9yZGVySWRzW2V4Y2hhbmdlTnVtYmVyXVtzZWxsQXNzZXRdKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUYWtlcyBhbiBhY3RpdmUgb3JkZXIgb24gdGhlIHNlbGVjdGVkIGV4Y2hhbmdlCiAgICAvLy8gQGRldiBUaGVzZSBhcmUgb3JkZXJzIHRoYXQgYXJlIGV4cGVjdGVkIHRvIHNldHRsZSBpbW1lZGlhdGVseQogICAgLy8vIEBwYXJhbSBpZCBBY3RpdmUgb3JkZXIgaWQKICAgIC8vLyBAcGFyYW0gcmVjZWl2ZVF1YW50aXR5IEJ1eSBxdWFudGl0eSBvZiB3aGF0IG90aGVycyBhcmUgc2VsbGluZyBvbiBzZWxlY3RlZCBFeGNoYW5nZQogICAgZnVuY3Rpb24gdGFrZU9yZGVyKHVpbnQgZXhjaGFuZ2VOdW1iZXIsIHVpbnQgaWQsIHVpbnQgcmVjZWl2ZVF1YW50aXR5KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcHJlX2NvbmQoaXNPd25lcigpKQogICAgICAgIHByZV9jb25kKCFpc1NodXREb3duKQogICAgewogICAgICAgIC8vIEdldCBpbmZvcm1hdGlvbiBvZiBvcmRlciBieSBvcmRlciBpZAogICAgICAgIE9yZGVyIG1lbW9yeSBvcmRlcjsgLy8gSW52ZXJzZSB2YXJpYWJsZSB0ZXJtaW5vbG9neSEgQnV5aW5nIHdoYXQgYW5vdGhlciBwZXJzb24gaXMgc2VsbGluZwogICAgICAgICgKICAgICAgICAgICAgb3JkZXIuc2VsbEFzc2V0LAogICAgICAgICAgICBvcmRlci5idXlBc3NldCwKICAgICAgICAgICAgb3JkZXIuc2VsbFF1YW50aXR5LAogICAgICAgICAgICBvcmRlci5idXlRdWFudGl0eQogICAgICAgICkgPSBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlQWRhcHRlci5nZXRPcmRlcihleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBpZCk7CiAgICAgICAgLy8gQ2hlY2sgcHJlIGNvbmRpdGlvbnMKICAgICAgICByZXF1aXJlKG9yZGVyLnNlbGxBc3NldCAhPSBhZGRyZXNzKHRoaXMpKTsgLy8gUHJldmVudCBidXlpbmcgb2Ygb3duIGZ1bmQgdG9rZW4KICAgICAgICByZXF1aXJlKG1vZHVsZS5wcmljZWZlZWQuZXhpc3RzUHJpY2VPbkFzc2V0UGFpcihvcmRlci5idXlBc3NldCwgb3JkZXIuc2VsbEFzc2V0KSk7IC8vIFByaWNlRmVlZCBtb2R1bGU6IFJlcXVlc3RlZCBhc3NldCBwYWlyIG5vdCB2YWxpZAogICAgICAgIHJlcXVpcmUoaXNJbkFzc2V0TGlzdFtvcmRlci5zZWxsQXNzZXRdIHx8IG93bmVkQXNzZXRzLmxlbmd0aCA8IE1BWF9GVU5EX0FTU0VUUyk7IC8vIExpbWl0IGZvciBtYXggb3duYWJsZSBhc3NldHMgYnkgdGhlIGZ1bmQgcmVhY2hlZAogICAgICAgIHZhciAoaXNSZWNlbnQsIHJlZmVyZW5jZVByaWNlLCApID0gbW9kdWxlLnByaWNlZmVlZC5nZXRSZWZlcmVuY2VQcmljZShvcmRlci5idXlBc3NldCwgb3JkZXIuc2VsbEFzc2V0KTsKICAgICAgICByZXF1aXJlKGlzUmVjZW50KTsgLy8gUmVmZXJlbmNlIHByaWNlIGlzIHJlcXVpcmVkIHRvIGJlIHJlY2VudAogICAgICAgIHJlcXVpcmUocmVjZWl2ZVF1YW50aXR5IDw9IG9yZGVyLnNlbGxRdWFudGl0eSk7IC8vIE5vdCBlbm91Z2ggcXVhbnRpdHkgb2Ygb3JkZXIgZm9yIHdoYXQgaXMgdHJ5aW5nIHRvIGJlIGJvdWdodAogICAgICAgIHVpbnQgc3BlbmRRdWFudGl0eSA9IG11bChyZWNlaXZlUXVhbnRpdHksIG9yZGVyLmJ1eVF1YW50aXR5KSAvIG9yZGVyLnNlbGxRdWFudGl0eTsKICAgICAgICByZXF1aXJlKEFzc2V0SW50ZXJmYWNlKG9yZGVyLmJ1eUFzc2V0KS5hcHByb3ZlKGV4Y2hhbmdlc1tleGNoYW5nZU51bWJlcl0uZXhjaGFuZ2UsIHNwZW5kUXVhbnRpdHkpKTsgLy8gQ291bGQgbm90IGFwcHJvdmUgc3BlbmRpbmcgb2Ygc3BlbmRRdWFudGl0eSBvZiBvcmRlci5idXlBc3NldAogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1vZHVsZS5yaXNrbWdtdC5pc1Rha2VQZXJtaXR0ZWQoCiAgICAgICAgICAgIG1vZHVsZS5wcmljZWZlZWQuZ2V0T3JkZXJQcmljZSgKICAgICAgICAgICAgICAgIG9yZGVyLmJ1eUFzc2V0LAogICAgICAgICAgICAgICAgb3JkZXIuc2VsbEFzc2V0LAogICAgICAgICAgICAgICAgb3JkZXIuYnV5UXVhbnRpdHksIC8vIHNwZW5kUXVhbnRpdHkKICAgICAgICAgICAgICAgIG9yZGVyLnNlbGxRdWFudGl0eSAvLyByZWNlaXZlUXVhbnRpdHkKICAgICAgICAgICAgKSwKICAgICAgICAgICAgcmVmZXJlbmNlUHJpY2UsCiAgICAgICAgICAgIG9yZGVyLmJ1eUFzc2V0LAogICAgICAgICAgICBvcmRlci5zZWxsQXNzZXQsCiAgICAgICAgICAgIG9yZGVyLmJ1eVF1YW50aXR5LAogICAgICAgICAgICBvcmRlci5zZWxsUXVhbnRpdHkKICAgICAgICApKTsgLy8gUmlza01nbXQgbW9kdWxlOiBUYWtlIG9yZGVyIG5vdCBwZXJtaXR0ZWQKCiAgICAgICAgLy8gRXhlY3V0ZSByZXF1ZXN0CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKGV4Y2hhbmdlc1tleGNoYW5nZU51bWJlcl0uZXhjaGFuZ2VBZGFwdGVyKS5kZWxlZ2F0ZWNhbGwoYnl0ZXM0KGtlY2NhazI1NigidGFrZU9yZGVyKGFkZHJlc3MsdWludDI1Nix1aW50MjU2KSIpKSwgZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZSwgaWQsIHJlY2VpdmVRdWFudGl0eSkpOwoKICAgICAgICAvLyBVcGRhdGUgb3duZWRBc3NldHMgYXJyYXkgYW5kIGlzSW5Bc3NldExpc3QgbWFwcGluZwogICAgICAgIGlmICghaXNJbkFzc2V0TGlzdFtvcmRlci5zZWxsQXNzZXRdKSB7CiAgICAgICAgICAgIG93bmVkQXNzZXRzLnB1c2gob3JkZXIuc2VsbEFzc2V0KTsKICAgICAgICAgICAgaXNJbkFzc2V0TGlzdFtvcmRlci5zZWxsQXNzZXRdID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIG9yZGVyLmV4Y2hhbmdlSWQgPSBpZDsKICAgICAgICBvcmRlci5zdGF0dXMgPSBPcmRlclN0YXR1cy5mdWxseUZpbGxlZDsKICAgICAgICBvcmRlci5vcmRlclR5cGUgPSBPcmRlclR5cGUudGFrZTsKICAgICAgICBvcmRlci50aW1lc3RhbXAgPSBub3c7CiAgICAgICAgb3JkZXIuZmlsbFF1YW50aXR5ID0gcmVjZWl2ZVF1YW50aXR5OwogICAgICAgIG9yZGVycy5wdXNoKG9yZGVyKTsKICAgICAgICBPcmRlclVwZGF0ZWQoaWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENhbmNlbHMgb3JkZXJzIHRoYXQgd2VyZSBub3QgZXhwZWN0ZWQgdG8gc2V0dGxlIGltbWVkaWF0ZWx5LCBpLmUuIG1ha2VPcmRlcnMKICAgIC8vLyBAZGV2IFJlZHVjZSBleHBvc3VyZSB3aXRoIGV4Y2hhbmdlIGludGVyYWN0aW9uCiAgICAvLy8gQHBhcmFtIGlkIEFjdGl2ZSBvcmRlciBpZCBvZiB0aGlzIG9yZGVyIGFycmF5IHdpdGggb3JkZXIgb3duZXIgb2YgdGhpcyBjb250cmFjdCBvbiBzZWxlY3RlZCBFeGNoYW5nZQogICAgZnVuY3Rpb24gY2FuY2VsT3JkZXIodWludCBleGNoYW5nZU51bWJlciwgdWludCBpZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHByZV9jb25kKGlzT3duZXIoKSB8fCBpc1NodXREb3duKQogICAgewogICAgICAgIC8vIEdldCBpbmZvcm1hdGlvbiBvZiBmdW5kIG9yZGVyIGJ5IG9yZGVyIGlkCiAgICAgICAgT3JkZXIgb3JkZXIgPSBvcmRlcnNbaWRdOwoKICAgICAgICAvLyBFeGVjdXRlIHJlcXVlc3QKICAgICAgICByZXF1aXJlKGFkZHJlc3MoZXhjaGFuZ2VzW2V4Y2hhbmdlTnVtYmVyXS5leGNoYW5nZUFkYXB0ZXIpLmRlbGVnYXRlY2FsbChieXRlczQoa2VjY2FrMjU2KCJjYW5jZWxPcmRlcihhZGRyZXNzLHVpbnQyNTYpIikpLCBleGNoYW5nZXNbZXhjaGFuZ2VOdW1iZXJdLmV4Y2hhbmdlLCBvcmRlci5leGNoYW5nZUlkKSk7CgogICAgICAgIG9yZGVyLnN0YXR1cyA9IE9yZGVyU3RhdHVzLmNhbmNlbGxlZDsKICAgICAgICBPcmRlclVwZGF0ZWQoaWQpOwogICAgfQoKCiAgICAvLyBQVUJMSUMgTUVUSE9EUwoKICAgIC8vIFBVQkxJQyBNRVRIT0RTIDogRVJDMjIzCgogICAgLy8vIEBkZXYgU3RhbmRhcmQgRVJDMjIzIGZ1bmN0aW9uIHRoYXQgaGFuZGxlcyBpbmNvbWluZyB0b2tlbiB0cmFuc2ZlcnMuCiAgICAvLy8gQGRldiBUaGlzIHR5cGUgb2YgcmVkZW1wdGlvbiBjYW4gYmUgc2VlbiBhcyBhICJtYXJrZXQgb3JkZXIiLCB3aGVyZSBwcmljZSBpcyBjYWxjdWxhdGVkIGF0IGV4ZWN1dGlvbiB0aW1lCiAgICAvLy8gQHBhcmFtIG9mU2VuZGVyICBUb2tlbiBzZW5kZXIgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gdG9rZW5BbW91bnQgQW1vdW50IG9mIHRva2VucyBzZW50LgogICAgLy8vIEBwYXJhbSBtZXRhZGF0YSAgVHJhbnNhY3Rpb24gbWV0YWRhdGEuCiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKAogICAgICAgIGFkZHJlc3Mgb2ZTZW5kZXIsCiAgICAgICAgdWludCB0b2tlbkFtb3VudCwKICAgICAgICBieXRlcyBtZXRhZGF0YQogICAgKSB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICAvLyB3aGVuIG9mU2VuZGVyIGlzIGEgcmVjb2duaXplZCBleGNoYW5nZSwgcmVjZWl2ZSB0b2tlbnMsIG90aGVyd2lzZSByZXZlcnQKICAgICAgICAgICAgZm9yICh1aW50IGk7IGkgPCBleGNoYW5nZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChleGNoYW5nZXNbaV0uZXhjaGFuZ2UgPT0gb2ZTZW5kZXIpIHJldHVybjsgLy8gcmVjZWl2ZSB0b2tlbnMgYW5kIGRvIG5vdGhpbmcKICAgICAgICAgICAgfQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9IGVsc2UgeyAgICAvLyBvdGhlcndpc2UsIG1ha2UgYSByZWRlbXB0aW9uIHJlcXVlc3QKICAgICAgICAgICAgcmVxdWVzdHMucHVzaChSZXF1ZXN0KHsKICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50OiBvZlNlbmRlciwKICAgICAgICAgICAgICAgIHN0YXR1czogUmVxdWVzdFN0YXR1cy5hY3RpdmUsCiAgICAgICAgICAgICAgICByZXF1ZXN0VHlwZTogUmVxdWVzdFR5cGUudG9rZW5GYWxsYmFja1JlZGVlbSwKICAgICAgICAgICAgICAgIHJlcXVlc3RBc3NldDogYWRkcmVzcyhRVU9URV9BU1NFVCksIC8vIHJlZGVlbSBpbiBRVU9URV9BU1NFVAogICAgICAgICAgICAgICAgc2hhcmVRdWFudGl0eTogdG9rZW5BbW91bnQsCiAgICAgICAgICAgICAgICBnaXZlUXVhbnRpdHk6IHRva2VuQW1vdW50LCAgICAgICAgICAgICAgLy8gc2hhcmVzIGJlaW5nIHNlbnQKICAgICAgICAgICAgICAgIHJlY2VpdmVRdWFudGl0eTogMCwgICAgICAgICAgLy8gdmFsdWUgb2YgdGhlIHNoYXJlcyBhdCByZXF1ZXN0IHRpbWUKICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogbm93LAogICAgICAgICAgICAgICAgYXRVcGRhdGVJZDogbW9kdWxlLnByaWNlZmVlZC5nZXRMYXN0VXBkYXRlSWQoKQogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIFJlcXVlc3RVcGRhdGVkKGdldExhc3RSZXF1ZXN0SWQoKSk7CiAgICAgICAgfQogICAgfQoKCiAgICAvLyBQVUJMSUMgTUVUSE9EUyA6IEFDQ09VTlRJTkcKCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIGdyb3NzIGFzc2V0IHZhbHVlIG9mIHRoZSBmdW5kCiAgICAvLy8gQGRldiBEZWNpbWFscyBpbiBhc3NldHMgbXVzdCBiZSBlcXVhbCB0byBkZWNpbWFscyBpbiBQcmljZUZlZWQgZm9yIGFsbCBlbnRyaWVzIGluIEFzc2V0UmVnaXN0cmFyCiAgICAvLy8gQGRldiBBc3N1bWVzIHRoYXQgbW9kdWxlLnByaWNlZmVlZC5nZXRQcmljZSguLikgcmV0dXJucyByZWNlbnQgcHJpY2VzCiAgICAvLy8gQHJldHVybiBnYXYgR3Jvc3MgYXNzZXQgdmFsdWUgcXVvdGVkIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMKICAgIGZ1bmN0aW9uIGNhbGNHYXYoKSByZXR1cm5zICh1aW50IGdhdikgewogICAgICAgIC8vIHByaWNlcyBxdW90ZWQgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogYXNzZXREZWNpbWFsCiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSB0ZW1wT3duZWRBc3NldHM7IC8vIFRvIHN0b3JlIG93bmVkQXNzZXRzCiAgICAgICAgdGVtcE93bmVkQXNzZXRzID0gb3duZWRBc3NldHM7CiAgICAgICAgZGVsZXRlIG93bmVkQXNzZXRzOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHRlbXBPd25lZEFzc2V0cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBhZGRyZXNzIG9mQXNzZXQgPSB0ZW1wT3duZWRBc3NldHNbaV07CiAgICAgICAgICAgIC8vIGFzc2V0SG9sZGluZ3MgZm9ybWF0dGluZzogbXVsKGV4Y2hhbmdlSG9sZGluZ3MsIDEwICoqIGFzc2V0RGVjaW1hbCkKICAgICAgICAgICAgdWludCBhc3NldEhvbGRpbmdzID0gYWRkKAogICAgICAgICAgICAgICAgdWludChBc3NldEludGVyZmFjZShvZkFzc2V0KS5iYWxhbmNlT2YodGhpcykpLCAvLyBhc3NldCBiYXNlIHVuaXRzIGhlbGQgYnkgZnVuZAogICAgICAgICAgICAgICAgcXVhbnRpdHlIZWxkSW5DdXN0b2R5T2ZFeGNoYW5nZShvZkFzc2V0KQogICAgICAgICAgICApOwogICAgICAgICAgICAvLyBhc3NldFByaWNlIGZvcm1hdHRpbmc6IG11bChleGNoYW5nZVByaWNlLCAxMCAqKiBhc3NldERlY2ltYWwpCiAgICAgICAgICAgIHZhciAoaXNSZWNlbnQsIGFzc2V0UHJpY2UsIGFzc2V0RGVjaW1hbHMpID0gbW9kdWxlLnByaWNlZmVlZC5nZXRQcmljZShvZkFzc2V0KTsKICAgICAgICAgICAgaWYgKCFpc1JlY2VudCkgewogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZ2F2IGFzIHN1bSBvZiBtdWwoYXNzZXRIb2xkaW5ncywgYXNzZXRQcmljZSkgd2l0aCBmb3JtYXR0aW5nOiBtdWwobXVsKGV4Y2hhbmdlSG9sZGluZ3MsIGV4Y2hhbmdlUHJpY2UpLCAxMCAqKiBzaGFyZURlY2ltYWxzKQogICAgICAgICAgICBnYXYgPSBhZGQoZ2F2LCBtdWwoYXNzZXRIb2xkaW5ncywgYXNzZXRQcmljZSkgLyAoMTAgKiogdWludDI1Nihhc3NldERlY2ltYWxzKSkpOyAgIC8vIFN1bSB1cCBwcm9kdWN0IG9mIGFzc2V0IGhvbGRpbmdzIG9mIHRoaXMgdmF1bHQgYW5kIGFzc2V0IHByaWNlcwogICAgICAgICAgICBpZiAoYXNzZXRIb2xkaW5ncyAhPSAwIHx8IG9mQXNzZXQgPT0gYWRkcmVzcyhRVU9URV9BU1NFVCkgfHwgb2ZBc3NldCA9PSBhZGRyZXNzKE5BVElWRV9BU1NFVCkgfHwgaXNJbk9wZW5NYWtlT3JkZXJbb2ZBc3NldF0pIHsgLy8gQ2hlY2sgaWYgYXNzZXQgaG9sZGluZ3MgaXMgbm90IHplcm8gb3IgaXMgYWRkcmVzcyhRVU9URV9BU1NFVCkgb3IgaW4gb3BlbiBtYWtlIG9yZGVyCiAgICAgICAgICAgICAgICBvd25lZEFzc2V0cy5wdXNoKG9mQXNzZXQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXNJbkFzc2V0TGlzdFtvZkFzc2V0XSA9IGZhbHNlOyAvLyBSZW1vdmUgZnJvbSBvd25lZEFzc2V0cyBpZiBhc3NldCBob2xkaW5ncyBhcmUgemVybwogICAgICAgICAgICB9CiAgICAgICAgICAgIFBvcnRmb2xpb0NvbnRlbnQoYXNzZXRIb2xkaW5ncywgYXNzZXRQcmljZSwgYXNzZXREZWNpbWFscyk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgQG5vdGljZSBDYWxjdWxhdGVzIHVuY2xhaW1lZCBmZWVzIG9mIHRoZSBmdW5kIG1hbmFnZXIKICAgIEBwYXJhbSBnYXYgR3Jvc3MgYXNzZXQgdmFsdWUgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgQHJldHVybiB7CiAgICAgICJtYW5hZ2VtZW50RmVlcyI6ICJBIHRpbWUgKHNlY29uZHMpIGJhc2VkIGZlZSBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzIiwKICAgICAgInBlcmZvcm1hbmNlRmVlcyI6ICJBIHBlcmZvcm1hbmNlIChyaXNlIG9mIHNoYXJlUHJpY2UgbWVhc3VyZWQgaW4gUVVPVEVfQVNTRVQpIGJhc2VkIGZlZSBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzIiwKICAgICAgInVuY2xhaW1lZGZlZXMiOiAiVGhlIHN1bSBvZiBib3RoIG1hbmFnZW1lbnRmZWUgYW5kIHBlcmZvcm1hbmNlZmVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMiCiAgICB9CiAgICAqLwogICAgZnVuY3Rpb24gY2FsY1VuY2xhaW1lZEZlZXModWludCBnYXYpCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKAogICAgICAgICAgICB1aW50IG1hbmFnZW1lbnRGZWUsCiAgICAgICAgICAgIHVpbnQgcGVyZm9ybWFuY2VGZWUsCiAgICAgICAgICAgIHVpbnQgdW5jbGFpbWVkRmVlcykKICAgIHsKICAgICAgICAvLyBNYW5hZ2VtZW50IGZlZSBjYWxjdWxhdGlvbgogICAgICAgIHVpbnQgdGltZVBhc3NlZCA9IHN1Yihub3csIGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24udGltZXN0YW1wKTsKICAgICAgICB1aW50IGdhdlBlcmNlbnRhZ2UgPSBtdWwodGltZVBhc3NlZCwgZ2F2KSAvICgxIHllYXJzKTsKICAgICAgICBtYW5hZ2VtZW50RmVlID0gd211bChnYXZQZXJjZW50YWdlLCBNQU5BR0VNRU5UX0ZFRV9SQVRFKTsKCiAgICAgICAgLy8gUGVyZm9ybWFuY2UgZmVlIGNhbGN1bGF0aW9uCiAgICAgICAgLy8gSGFuZGxlIHBvdGVudGlhbCBkaXZpc2lvbiB0aHJvdWdoIHplcm8gYnkgZGVmaW5pbmcgYSBkZWZhdWx0IHZhbHVlCiAgICAgICAgdWludCB2YWx1ZVBlclNoYXJlRXhjbE1nbXRGZWVzID0gdG90YWxTdXBwbHkgPiAwID8gY2FsY1ZhbHVlUGVyU2hhcmUoc3ViKGdhdiwgbWFuYWdlbWVudEZlZSksIHRvdGFsU3VwcGx5KSA6IHRvU21hbGxlc3RTaGFyZVVuaXQoMSk7CiAgICAgICAgaWYgKHZhbHVlUGVyU2hhcmVFeGNsTWdtdEZlZXMgPiBhdExhc3RVbmNsYWltZWRGZWVBbGxvY2F0aW9uLmhpZ2hXYXRlck1hcmspIHsKICAgICAgICAgICAgdWludCBnYWluSW5TaGFyZVByaWNlID0gc3ViKHZhbHVlUGVyU2hhcmVFeGNsTWdtdEZlZXMsIGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24uaGlnaFdhdGVyTWFyayk7CiAgICAgICAgICAgIHVpbnQgaW52ZXN0bWVudFByb2ZpdHMgPSB3bXVsKGdhaW5JblNoYXJlUHJpY2UsIHRvdGFsU3VwcGx5KTsKICAgICAgICAgICAgcGVyZm9ybWFuY2VGZWUgPSB3bXVsKGludmVzdG1lbnRQcm9maXRzLCBQRVJGT1JNQU5DRV9GRUVfUkFURSk7CiAgICAgICAgfQoKICAgICAgICAvLyBTdW0gb2YgYWxsIEZFRVMKICAgICAgICB1bmNsYWltZWRGZWVzID0gYWRkKG1hbmFnZW1lbnRGZWUsIHBlcmZvcm1hbmNlRmVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBOZXQgYXNzZXQgdmFsdWUgb2YgdGhpcyBmdW5kCiAgICAvLy8gQHBhcmFtIGdhdiBHcm9zcyBhc3NldCB2YWx1ZSBvZiB0aGlzIGZ1bmQgaW4gUVVPVEVfQVNTRVQgYW5kIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgLy8vIEBwYXJhbSB1bmNsYWltZWRGZWVzIFRoZSBzdW0gb2YgYm90aCBtYW5hZ2VtZW50RmVlIGFuZCBwZXJmb3JtYW5jZUZlZSBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzCiAgICAvLy8gQHJldHVybiBuYXYgTmV0IGFzc2V0IHZhbHVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMKICAgIGZ1bmN0aW9uIGNhbGNOYXYodWludCBnYXYsIHVpbnQgdW5jbGFpbWVkRmVlcykKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAodWludCBuYXYpCiAgICB7CiAgICAgICAgbmF2ID0gc3ViKGdhdiwgdW5jbGFpbWVkRmVlcyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2FsY3VsYXRlcyB0aGUgc2hhcmUgcHJpY2Ugb2YgdGhlIGZ1bmQKICAgIC8vLyBAZGV2IENvbnZlbnRpb24gZm9yIHZhbHVlUGVyU2hhcmUgKD09IHNoYXJlUHJpY2UpIGZvcm1hdHRpbmc6IG11bCh0b3RhbFZhbHVlIC8gbnVtU2hhcmVzLCAxMCAqKiBkZWNpbWFsKSwgdG8gYXZvaWQgZmxvYXRpbmcgbnVtYmVycwogICAgLy8vIEBkZXYgTm9uLXplcm8gc2hhcmUgc3VwcGx5OyB2YWx1ZSBkZW5vbWluYXRlZCBpbiBbYmFzZSB1bml0IG9mIG1lbG9uQXNzZXRdCiAgICAvLy8gQHBhcmFtIHRvdGFsVmFsdWUgdGhlIHRvdGFsIHZhbHVlIGluIFFVT1RFX0FTU0VUIGFuZCBtdWx0aXBsaWVkIGJ5IDEwICoqIHNoYXJlRGVjaW1hbHMKICAgIC8vLyBAcGFyYW0gbnVtU2hhcmVzIHRoZSBudW1iZXIgb2Ygc2hhcmVzIG11bHRpcGxpZWQgYnkgMTAgKiogc2hhcmVEZWNpbWFscwogICAgLy8vIEByZXR1cm4gdmFsdWVQZXJTaGFyZSBTaGFyZSBwcmljZSBkZW5vbWluYXRlZCBpbiBRVU9URV9BU1NFVCBhbmQgbXVsdGlwbGllZCBieSAxMCAqKiBzaGFyZURlY2ltYWxzCiAgICBmdW5jdGlvbiBjYWxjVmFsdWVQZXJTaGFyZSh1aW50IHRvdGFsVmFsdWUsIHVpbnQgbnVtU2hhcmVzKQogICAgICAgIHZpZXcKICAgICAgICBwcmVfY29uZChudW1TaGFyZXMgPiAwKQogICAgICAgIHJldHVybnMgKHVpbnQgdmFsdWVQZXJTaGFyZSkKICAgIHsKICAgICAgICB2YWx1ZVBlclNoYXJlID0gdG9TbWFsbGVzdFNoYXJlVW5pdCh0b3RhbFZhbHVlKSAvIG51bVNoYXJlczsKICAgIH0KCiAgICAvKioKICAgIEBub3RpY2UgQ2FsY3VsYXRlcyBlc3NlbnRpYWwgZnVuZCBtZXRyaWNzCiAgICBAcmV0dXJuIHsKICAgICAgImdhdiI6ICJHcm9zcyBhc3NldCB2YWx1ZSBvZiB0aGlzIGZ1bmQgZGVub21pbmF0ZWQgaW4gW2Jhc2UgdW5pdCBvZiBtZWxvbkFzc2V0XSIsCiAgICAgICJtYW5hZ2VtZW50RmVlIjogIkEgdGltZSAoc2Vjb25kcykgYmFzZWQgZmVlIiwKICAgICAgInBlcmZvcm1hbmNlRmVlIjogIkEgcGVyZm9ybWFuY2UgKHJpc2Ugb2Ygc2hhcmVQcmljZSBtZWFzdXJlZCBpbiBRVU9URV9BU1NFVCkgYmFzZWQgZmVlIiwKICAgICAgInVuY2xhaW1lZEZlZXMiOiAiVGhlIHN1bSBvZiBib3RoIG1hbmFnZW1lbnRGZWUgYW5kIHBlcmZvcm1hbmNlRmVlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0iLAogICAgICAiZmVlc1NoYXJlUXVhbnRpdHkiOiAiVGhlIG51bWJlciBvZiBzaGFyZXMgdG8gYmUgZ2l2ZW4gYXMgZmVlcyB0byB0aGUgbWFuYWdlciIsCiAgICAgICJuYXYiOiAiTmV0IGFzc2V0IHZhbHVlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0iLAogICAgICAic2hhcmVQcmljZSI6ICJTaGFyZSBwcmljZSBkZW5vbWluYXRlZCBpbiBbYmFzZSB1bml0IG9mIG1lbG9uQXNzZXRdIgogICAgfQogICAgKi8KICAgIGZ1bmN0aW9uIHBlcmZvcm1DYWxjdWxhdGlvbnMoKQogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICgKICAgICAgICAgICAgdWludCBnYXYsCiAgICAgICAgICAgIHVpbnQgbWFuYWdlbWVudEZlZSwKICAgICAgICAgICAgdWludCBwZXJmb3JtYW5jZUZlZSwKICAgICAgICAgICAgdWludCB1bmNsYWltZWRGZWVzLAogICAgICAgICAgICB1aW50IGZlZXNTaGFyZVF1YW50aXR5LAogICAgICAgICAgICB1aW50IG5hdiwKICAgICAgICAgICAgdWludCBzaGFyZVByaWNlCiAgICAgICAgKQogICAgewogICAgICAgIGdhdiA9IGNhbGNHYXYoKTsgLy8gUmVmbGVjdHMgdmFsdWUgaW5kZXBlbmRlbnQgb2YgZmVlcwogICAgICAgIChtYW5hZ2VtZW50RmVlLCBwZXJmb3JtYW5jZUZlZSwgdW5jbGFpbWVkRmVlcykgPSBjYWxjVW5jbGFpbWVkRmVlcyhnYXYpOwogICAgICAgIG5hdiA9IGNhbGNOYXYoZ2F2LCB1bmNsYWltZWRGZWVzKTsKCiAgICAgICAgLy8gVGhlIHZhbHVlIG9mIHVuY2xhaW1lZEZlZXMgbWVhc3VyZWQgaW4gc2hhcmVzIG9mIHRoaXMgZnVuZCBhdCBjdXJyZW50IHZhbHVlCiAgICAgICAgZmVlc1NoYXJlUXVhbnRpdHkgPSAoZ2F2ID09IDApID8gMCA6IG11bCh0b3RhbFN1cHBseSwgdW5jbGFpbWVkRmVlcykgLyBnYXY7CiAgICAgICAgLy8gVGhlIHRvdGFsIHNoYXJlIHN1cHBseSBpbmNsdWRpbmcgdGhlIHZhbHVlIG9mIHVuY2xhaW1lZEZlZXMsIG1lYXN1cmVkIGluIHNoYXJlcyBvZiB0aGlzIGZ1bmQKICAgICAgICB1aW50IHRvdGFsU3VwcGx5QWNjb3VudGluZ0ZvckZlZXMgPSBhZGQodG90YWxTdXBwbHksIGZlZXNTaGFyZVF1YW50aXR5KTsKICAgICAgICBzaGFyZVByaWNlID0gbmF2ID4gMCA/IGNhbGNWYWx1ZVBlclNoYXJlKGdhdiwgdG90YWxTdXBwbHlBY2NvdW50aW5nRm9yRmVlcykgOiB0b1NtYWxsZXN0U2hhcmVVbml0KDEpOyAvLyBIYW5kbGUgcG90ZW50aWFsIGRpdmlzaW9uIHRocm91Z2ggemVybyBieSBkZWZpbmluZyBhIGRlZmF1bHQgdmFsdWUKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDb252ZXJ0cyB1bmNsYWltZWQgZmVlcyBvZiB0aGUgbWFuYWdlciBpbnRvIGZ1bmQgc2hhcmVzCiAgICAvLy8gQHJldHVybiBzaGFyZVByaWNlIFNoYXJlIHByaWNlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0KICAgIGZ1bmN0aW9uIGNhbGNTaGFyZVByaWNlQW5kQWxsb2NhdGVGZWVzKCkgcHVibGljIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdmFyICgKICAgICAgICAgICAgZ2F2LAogICAgICAgICAgICBtYW5hZ2VtZW50RmVlLAogICAgICAgICAgICBwZXJmb3JtYW5jZUZlZSwKICAgICAgICAgICAgdW5jbGFpbWVkRmVlcywKICAgICAgICAgICAgZmVlc1NoYXJlUXVhbnRpdHksCiAgICAgICAgICAgIG5hdiwKICAgICAgICAgICAgc2hhcmVQcmljZQogICAgICAgICkgPSBwZXJmb3JtQ2FsY3VsYXRpb25zKCk7CgogICAgICAgIGNyZWF0ZVNoYXJlcyhvd25lciwgZmVlc1NoYXJlUXVhbnRpdHkpOyAvLyBVcGRhdGVzIHRvdGFsU3VwcGx5IGJ5IGNyZWF0aW5nIHNoYXJlcyBhbGxvY2F0ZWQgdG8gbWFuYWdlcgoKICAgICAgICAvLyBVcGRhdGUgQ2FsY3VsYXRpb25zCiAgICAgICAgdWludCBoaWdoV2F0ZXJNYXJrID0gYXRMYXN0VW5jbGFpbWVkRmVlQWxsb2NhdGlvbi5oaWdoV2F0ZXJNYXJrID49IHNoYXJlUHJpY2UgPyBhdExhc3RVbmNsYWltZWRGZWVBbGxvY2F0aW9uLmhpZ2hXYXRlck1hcmsgOiBzaGFyZVByaWNlOwogICAgICAgIGF0TGFzdFVuY2xhaW1lZEZlZUFsbG9jYXRpb24gPSBDYWxjdWxhdGlvbnMoewogICAgICAgICAgICBnYXY6IGdhdiwKICAgICAgICAgICAgbWFuYWdlbWVudEZlZTogbWFuYWdlbWVudEZlZSwKICAgICAgICAgICAgcGVyZm9ybWFuY2VGZWU6IHBlcmZvcm1hbmNlRmVlLAogICAgICAgICAgICB1bmNsYWltZWRGZWVzOiB1bmNsYWltZWRGZWVzLAogICAgICAgICAgICBuYXY6IG5hdiwKICAgICAgICAgICAgaGlnaFdhdGVyTWFyazogaGlnaFdhdGVyTWFyaywKICAgICAgICAgICAgdG90YWxTdXBwbHk6IHRvdGFsU3VwcGx5LAogICAgICAgICAgICB0aW1lc3RhbXA6IG5vdwogICAgICAgIH0pOwoKICAgICAgICBGZWVzQ29udmVydGVkKG5vdywgZmVlc1NoYXJlUXVhbnRpdHksIHVuY2xhaW1lZEZlZXMpOwogICAgICAgIENhbGN1bGF0aW9uVXBkYXRlKG5vdywgbWFuYWdlbWVudEZlZSwgcGVyZm9ybWFuY2VGZWUsIG5hdiwgc2hhcmVQcmljZSwgdG90YWxTdXBwbHkpOwoKICAgICAgICByZXR1cm4gc2hhcmVQcmljZTsKICAgIH0KCiAgICAvLyBQVUJMSUMgOiBSRURFRU1JTkcKCiAgICAvLy8gQG5vdGljZSBSZWRlZW1zIGJ5IGFsbG9jYXRpbmcgYW4gb3duZXJzaGlwIHBlcmNlbnRhZ2Ugb25seSBvZiByZXF1ZXN0ZWRBc3NldHMgdG8gdGhlIHBhcnRpY2lwYW50CiAgICAvLy8gQGRldiBJbmRlcGVuZGVudCBvZiBydW5uaW5nIHByaWNlIGZlZWQhIE5vdGU6IGlmIHJlcXVlc3RlZEFzc2V0cyAhPSBvd25lZEFzc2V0cyB0aGVuIHBhcnRpY2lwYW50IG1pc3NlcyBvdXQgb24gc29tZSBvd25lZCB2YWx1ZQogICAgLy8vIEBwYXJhbSBzaGFyZVF1YW50aXR5IE51bWJlciBvZiBzaGFyZXMgb3duZWQgYnkgdGhlIHBhcnRpY2lwYW50LCB3aGljaCB0aGUgcGFydGljaXBhbnQgd291bGQgbGlrZSB0byByZWRlZW0gZm9yIGluZGl2aWR1YWwgYXNzZXRzCiAgICAvLy8gQHBhcmFtIHJlcXVlc3RlZEFzc2V0cyBMaXN0IG9mIGFkZHJlc3NlcyB0aGF0IGNvbnNpdHV0ZSBhIHN1YnNldCBvZiBvd25lZEFzc2V0cy4KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgYWxsIGFzc2V0cyBzZW50IHRvIHNoYXJlaG9sZGVyIG9yIG5vdAogICAgZnVuY3Rpb24gZW1lcmdlbmN5UmVkZWVtKHVpbnQgc2hhcmVRdWFudGl0eSwgYWRkcmVzc1tdIHJlcXVlc3RlZEFzc2V0cykKICAgICAgICBwdWJsaWMKICAgICAgICBwcmVfY29uZChiYWxhbmNlc1ttc2cuc2VuZGVyXSA+PSBzaGFyZVF1YW50aXR5KSAgLy8gc2VuZGVyIG93bnMgZW5vdWdoIHNoYXJlcwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgYWRkcmVzcyBvZkFzc2V0OwogICAgICAgIHVpbnRbXSBtZW1vcnkgb3duZXJzaGlwUXVhbnRpdGllcyA9IG5ldyB1aW50W10ocmVxdWVzdGVkQXNzZXRzLmxlbmd0aCk7CgogICAgICAgIC8vIENoZWNrIHdoZXRoZXIgZW5vdWdoIGFzc2V0cyBoZWxkIGJ5IGZ1bmQKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByZXF1ZXN0ZWRBc3NldHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgb2ZBc3NldCA9IHJlcXVlc3RlZEFzc2V0c1tpXTsKICAgICAgICAgICAgdWludCBhc3NldEhvbGRpbmdzID0gYWRkKAogICAgICAgICAgICAgICAgdWludChBc3NldEludGVyZmFjZShvZkFzc2V0KS5iYWxhbmNlT2YodGhpcykpLAogICAgICAgICAgICAgICAgcXVhbnRpdHlIZWxkSW5DdXN0b2R5T2ZFeGNoYW5nZShvZkFzc2V0KQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKGFzc2V0SG9sZGluZ3MgPT0gMCkgY29udGludWU7CgogICAgICAgICAgICAvLyBwYXJ0aWNpcGFudCdzIG93bmVyc2hpcCBwZXJjZW50YWdlIG9mIGFzc2V0IGhvbGRpbmdzCiAgICAgICAgICAgIG93bmVyc2hpcFF1YW50aXRpZXNbaV0gPSBtdWwoYXNzZXRIb2xkaW5ncywgc2hhcmVRdWFudGl0eSkgLyB0b3RhbFN1cHBseTsKCiAgICAgICAgICAgIC8vIENSSVRJQ0FMIEVSUjogTm90IGVub3VnaCBmdW5kIGFzc2V0IGJhbGFuY2UgZm9yIG93ZWQgb3duZXJzaGlwUXVhbnRpdGl5LCBlZyBpbiBjYXNlIG9mIHVucmV0dXJuZWQgYXNzZXQgcXVhbnRpdHkgYXQgYWRkcmVzcyhleGNoYW5nZXNbaV0uZXhjaGFuZ2UpIGFkZHJlc3MKICAgICAgICAgICAgaWYgKHVpbnQoQXNzZXRJbnRlcmZhY2Uob2ZBc3NldCkuYmFsYW5jZU9mKHRoaXMpKSA8IG93bmVyc2hpcFF1YW50aXRpZXNbaV0pIHsKICAgICAgICAgICAgICAgIGlzU2h1dERvd24gPSB0cnVlOwogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlKCJDUklUSUNBTCBFUlI6IE5vdCBlbm91Z2ggYXNzZXRIb2xkaW5ncyBmb3Igb3dlZCBvd25lcnNoaXBRdWFudGl0aXkiKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQW5uaWhpbGF0ZSBzaGFyZXMgYmVmb3JlIGV4dGVybmFsIGNhbGxzIHRvIHByZXZlbnQgcmVlbnRyYW5jeQogICAgICAgIGFubmloaWxhdGVTaGFyZXMobXNnLnNlbmRlciwgc2hhcmVRdWFudGl0eSk7CgogICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcFF1YW50aXR5IG9mIEFzc2V0cwogICAgICAgIGZvciAodWludCBqID0gMDsgaiA8IHJlcXVlc3RlZEFzc2V0cy5sZW5ndGg7ICsraikgewogICAgICAgICAgICAvLyBGYWlsZWQgdG8gc2VuZCBvd2VkIG93bmVyc2hpcFF1YW50aXR5IGZyb20gZnVuZCB0byBwYXJ0aWNpcGFudAogICAgICAgICAgICBvZkFzc2V0ID0gcmVxdWVzdGVkQXNzZXRzW2pdOwogICAgICAgICAgICBpZiAob3duZXJzaGlwUXVhbnRpdGllc1tqXSA9PSAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICghQXNzZXRJbnRlcmZhY2Uob2ZBc3NldCkudHJhbnNmZXIobXNnLnNlbmRlciwgb3duZXJzaGlwUXVhbnRpdGllc1tqXSkpIHsKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlZGVlbWVkKG1zZy5zZW5kZXIsIG5vdywgc2hhcmVRdWFudGl0eSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gUFVCTElDIDogRkVFUwoKICAgIC8vLyBAZGV2IFF1YW50aXR5IG9mIGFzc2V0IGhlbGQgaW4gZXhjaGFuZ2UgYWNjb3JkaW5nIHRvIGFzc29jaWF0ZWQgb3JkZXIgaWQKICAgIC8vLyBAcGFyYW0gb2ZBc3NldCBBZGRyZXNzIG9mIGFzc2V0CiAgICAvLy8gQHJldHVybiBRdWFudGl0eSBvZiBpbnB1dCBhc3NldCBoZWxkIGluIGV4Y2hhbmdlCiAgICBmdW5jdGlvbiBxdWFudGl0eUhlbGRJbkN1c3RvZHlPZkV4Y2hhbmdlKGFkZHJlc3Mgb2ZBc3NldCkgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgdG90YWxTZWxsUXVhbnRpdHk7ICAgICAvLyBxdWFudGl0eSBpbiBjdXN0b2R5IGFjcm9zcyBleGNoYW5nZXMKICAgICAgICB1aW50IHRvdGFsU2VsbFF1YW50aXR5SW5BcHByb3ZlOyAvLyBxdWFudGl0eSBvZiBhc3NldCBpbiBhcHByb3ZlIChhbGxvd2FuY2UpIGJ1dCBub3QgY3VzdG9keSBvZiBleGNoYW5nZQogICAgICAgIGZvciAodWludCBpOyBpIDwgZXhjaGFuZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChleGNoYW5nZUlkc1RvT3Blbk1ha2VPcmRlcklkc1tpXVtvZkFzc2V0XSA9PSAwKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgKHNlbGxBc3NldCwgLCBzZWxsUXVhbnRpdHksICkgPSBleGNoYW5nZXNbaV0uZXhjaGFuZ2VBZGFwdGVyLmdldE9yZGVyKGV4Y2hhbmdlc1tpXS5leGNoYW5nZSwgZXhjaGFuZ2VJZHNUb09wZW5NYWtlT3JkZXJJZHNbaV1bb2ZBc3NldF0pOwogICAgICAgICAgICBpZiAoc2VsbFF1YW50aXR5ID09IDApIHsKICAgICAgICAgICAgICAgIGV4Y2hhbmdlSWRzVG9PcGVuTWFrZU9yZGVySWRzW2ldW29mQXNzZXRdID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0b3RhbFNlbGxRdWFudGl0eSA9IGFkZCh0b3RhbFNlbGxRdWFudGl0eSwgc2VsbFF1YW50aXR5KTsKICAgICAgICAgICAgaWYgKGV4Y2hhbmdlc1tpXS5pc0FwcHJvdmVPbmx5KSB7CiAgICAgICAgICAgICAgICB0b3RhbFNlbGxRdWFudGl0eUluQXBwcm92ZSArPSBzZWxsUXVhbnRpdHk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRvdGFsU2VsbFF1YW50aXR5ID09IDApIHsKICAgICAgICAgICAgaXNJbk9wZW5NYWtlT3JkZXJbc2VsbEFzc2V0XSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3ViKHRvdGFsU2VsbFF1YW50aXR5LCB0b3RhbFNlbGxRdWFudGl0eUluQXBwcm92ZSk7IC8vIFNpbmNlIHF1YW50aXR5IGluIGFwcHJvdmUgaXMgbm90IGFjdHVhbGx5IGluIGN1c3RvZHkKICAgIH0KCiAgICAvLyBQVUJMSUMgVklFVyBNRVRIT0RTCgogICAgLy8vIEBub3RpY2UgQ2FsY3VsYXRlcyBzaGFyZVByaWNlIGRlbm9taW5hdGVkIGluIFtiYXNlIHVuaXQgb2YgbWVsb25Bc3NldF0KICAgIC8vLyBAcmV0dXJuIHNoYXJlUHJpY2UgU2hhcmUgcHJpY2UgZGVub21pbmF0ZWQgaW4gW2Jhc2UgdW5pdCBvZiBtZWxvbkFzc2V0XQogICAgZnVuY3Rpb24gY2FsY1NoYXJlUHJpY2UoKSB2aWV3IHJldHVybnMgKHVpbnQgc2hhcmVQcmljZSkgewogICAgICAgICgsICwgLCAsICwgc2hhcmVQcmljZSkgPSBwZXJmb3JtQ2FsY3VsYXRpb25zKCk7CiAgICAgICAgcmV0dXJuIHNoYXJlUHJpY2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TW9kdWxlcygpIHZpZXcgcmV0dXJucyAoYWRkcmVzcywgYWRkcmVzcywgYWRkcmVzcykgewogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGFkZHJlc3MobW9kdWxlLnByaWNlZmVlZCksCiAgICAgICAgICAgIGFkZHJlc3MobW9kdWxlLmNvbXBsaWFuY2UpLAogICAgICAgICAgICBhZGRyZXNzKG1vZHVsZS5yaXNrbWdtdCkKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldExhc3RPcmRlcklkKCkgdmlldyByZXR1cm5zICh1aW50KSB7IHJldHVybiBvcmRlcnMubGVuZ3RoIC0gMTsgfQogICAgZnVuY3Rpb24gZ2V0TGFzdFJlcXVlc3RJZCgpIHZpZXcgcmV0dXJucyAodWludCkgeyByZXR1cm4gcmVxdWVzdHMubGVuZ3RoIC0gMTsgfQogICAgZnVuY3Rpb24gZ2V0TmFtZUhhc2goKSB2aWV3IHJldHVybnMgKGJ5dGVzMzIpIHsgcmV0dXJuIGJ5dGVzMzIoa2VjY2FrMjU2KG5hbWUpKTsgfQogICAgZnVuY3Rpb24gZ2V0TWFuYWdlcigpIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgeyByZXR1cm4gb3duZXI7IH0KfQoKY29udHJhY3QgV0VUSDlfIHsKICAgIHN0cmluZyBwdWJsaWMgbmFtZSAgICAgPSAiV3JhcHBlZCBFdGhlciI7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbCAgID0gIldFVEgiOwogICAgdWludDggIHB1YmxpYyBkZWNpbWFscyA9IDE4OwoKICAgIGV2ZW50ICBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgc3JjLCBhZGRyZXNzIGluZGV4ZWQgZ3V5LCB1aW50IHdhZCk7CiAgICBldmVudCAgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIHNyYywgYWRkcmVzcyBpbmRleGVkIGRzdCwgdWludCB3YWQpOwogICAgZXZlbnQgIERlcG9zaXQoYWRkcmVzcyBpbmRleGVkIGRzdCwgdWludCB3YWQpOwogICAgZXZlbnQgIFdpdGhkcmF3YWwoYWRkcmVzcyBpbmRleGVkIHNyYywgdWludCB3YWQpOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyAgYmFsYW5jZU9mOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSAgcHVibGljICBhbGxvd2FuY2U7CgogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgZGVwb3NpdCgpOwogICAgfQogICAgZnVuY3Rpb24gZGVwb3NpdCgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gKz0gbXNnLnZhbHVlOwogICAgICAgIERlcG9zaXQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgd2FkKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZU9mW21zZy5zZW5kZXJdID49IHdhZCk7CiAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdIC09IHdhZDsKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHdhZCk7CiAgICAgICAgV2l0aGRyYXdhbChtc2cuc2VuZGVyLCB3YWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB0aGlzLmJhbGFuY2U7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIGd1eSwgdWludCB3YWQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWxsb3dhbmNlW21zZy5zZW5kZXJdW2d1eV0gPSB3YWQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgZ3V5LCB3YWQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgZHN0LCB1aW50IHdhZCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIGRzdCwgd2FkKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBzcmMsIGFkZHJlc3MgZHN0LCB1aW50IHdhZCkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZU9mW3NyY10gPj0gd2FkKTsKCiAgICAgICAgaWYgKHNyYyAhPSBtc2cuc2VuZGVyICYmIGFsbG93YW5jZVtzcmNdW21zZy5zZW5kZXJdICE9IHVpbnQoLTEpKSB7CiAgICAgICAgICAgIHJlcXVpcmUoYWxsb3dhbmNlW3NyY11bbXNnLnNlbmRlcl0gPj0gd2FkKTsKICAgICAgICAgICAgYWxsb3dhbmNlW3NyY11bbXNnLnNlbmRlcl0gLT0gd2FkOwogICAgICAgIH0KCiAgICAgICAgYmFsYW5jZU9mW3NyY10gLT0gd2FkOwogICAgICAgIGJhbGFuY2VPZltkc3RdICs9IHdhZDsKCiAgICAgICAgVHJhbnNmZXIoc3JjLCBkc3QsIHdhZCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9'.
	

]
