Class {
	#name : #SRT5890301587c4f9099d5ed4041cfc4bff332357a9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5890301587c4f9099d5ed4041cfc4bff332357a9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTY7CgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsICBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsICBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlICByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9Cgpjb250cmFjdCBCYXNlIHsKICAgIG1vZGlmaWVyIG9ubHkoYWRkcmVzcyBhbGxvd2VkKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFsbG93ZWQpOwogICAgICAgIF87CiAgICB9Cn0KCmNvbnRyYWN0IE93bmVkIGlzIEJhc2UgewoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgYWRkcmVzcyBuZXdPd25lcjsKCiAgICBmdW5jdGlvbiBPd25lZCgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBvbmx5KG93bmVyKSBwdWJsaWMgewogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOwogICAgfQoKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIG9ubHkobmV3T3duZXIpIHB1YmxpYyB7CiAgICAgICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKICAgIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90byk7Cgp9Cgpjb250cmFjdCBFUkMyMCBpcyBPd25lZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBib29sIHB1YmxpYyBpc1N0YXJ0ZWQgPSBmYWxzZTsKCiAgICBtb2RpZmllciBpc1N0YXJ0ZWRPbmx5KCkgewogICAgICAgIHJlcXVpcmUoaXNTdGFydGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGlzTm90U3RhcnRlZE9ubHkoKSB7CiAgICAgICAgcmVxdWlyZSghaXNTdGFydGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludCBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50IF92YWx1ZSk7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmVfZml4ZWQoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfY3VycmVudFZhbHVlLCB1aW50IF92YWx1ZSkgaXNTdGFydGVkT25seSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gX2N1cnJlbnRWYWx1ZSl7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBpc1N0YXJ0ZWRPbmx5IHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7Cn0KCmNvbnRyYWN0IFRva2VuIGlzIEVSQzIwIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwogICAgdWludDggcHVibGljIGRlY2ltYWxzOwoKCiAgICBmdW5jdGlvbiBUb2tlbihzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMpIHB1YmxpYyB7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICB9CgogICAgZnVuY3Rpb24gc3RhcnQoKSBwdWJsaWMgb25seShvd25lcikgaXNOb3RTdGFydGVkT25seSB7CiAgICAgICAgaXNTdGFydGVkID0gdHJ1ZTsKICAgIH0KCiAgICAvLz09PT09PT09PT09PT09PT09IENyb3dkc2FsZSBPbmx5ID09PT09PT09PT09PT09PT09CiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHB1YmxpYyBvbmx5KG93bmVyKSBpc05vdFN0YXJ0ZWRPbmx5IHJldHVybnMoYm9vbCkgewogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIG11bHRpbWludChhZGRyZXNzW10gZGVzdHMsIHVpbnRbXSB2YWx1ZXMpIHB1YmxpYyBvbmx5KG93bmVyKSBpc05vdFN0YXJ0ZWRPbmx5IHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgZGVzdHMubGVuZ3RoKSB7CiAgICAgICAgICAgbWludChkZXN0c1tpXSwgdmFsdWVzW2ldKTsKICAgICAgICAgICBpICs9IDE7CiAgICAgICAgfQogICAgICAgIHJldHVybihpKTsKICAgIH0KfQoKY29udHJhY3QgVG9rZW5XaXRob3V0U3RhcnQgaXMgT3duZWQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CgogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKTsKCiAgICBmdW5jdGlvbiBUb2tlbldpdGhvdXRTdGFydChzdHJpbmcgX25hbWUsIHN0cmluZyBfc3ltYm9sLCB1aW50OCBfZGVjaW1hbHMpIHB1YmxpYyB7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZV9maXhlZChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9jdXJyZW50VmFsdWUsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gX2N1cnJlbnRWYWx1ZSl7CiAgICAgICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpKSBhbGxvd2VkOwoKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcHVibGljIG9ubHkob3duZXIpIHJldHVybnMoYm9vbCkgewogICAgICAgIHRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKF9hbW91bnQpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIG11bHRpbWludChhZGRyZXNzW10gZGVzdHMsIHVpbnRbXSB2YWx1ZXMpIHB1YmxpYyBvbmx5KG93bmVyKSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGRlc3RzLmxlbmd0aCkgewogICAgICAgICAgIG1pbnQoZGVzdHNbaV0sIHZhbHVlc1tpXSk7CiAgICAgICAgICAgaSArPSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4oaSk7CiAgICB9Cgp9Cgpjb250cmFjdCBJQ09Db250cmFjdCB7CiAgICAKICAgIGFkZHJlc3MgcHVibGljIHByb2plY3RXYWxsZXQ7IC8vYmVuZWZpY2lhcnkgd2FsbGV0CiAgICBhZGRyZXNzIHB1YmxpYyBvcGVyYXRvciA9IDB4NEM2N0VCODZkNzAzNTQ3MzFmMTE5ODFhZUU5MWQ5NjllMzgyM2MzOTsgLy9hZGRyZXNzIG9mIHRoZSBJQ08gb3BlcmF0b3Ig4oCUIHRoZSBvbmUgd2hvIGFkZHMgbWlsZXN0b25lcyBhbmQgSW52ZXN0Q29udHJhY3RzCgogICAgdWludCBwdWJsaWMgY29uc3RhbnQgd2FpdFBlcmlvZCA9IDcgZGF5czsgLy93YWl0IHBlcmlvZCBhZnRlciBtaWxlc3RvbmUgZmluaXNoIGFuZCB1bnRpbGUgdGhlIG5leHQgb25lIGNhbiBiZSBzdGFydGVkCgogICAgYWRkcmVzc1tdIHB1YmxpYyBwZW5kaW5nSW52ZXN0Q29udHJhY3RzID0gWzB4MF07IC8vcGVuZGluZyBJbnZlc3RDb250cmFjdHMgbm90IHlldCBhY2NlcHRlZCBieSB0aGUgcHJvamVjdAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBwZW5kaW5nSW52ZXN0Q29udHJhY3RzSW5kaWNlczsKCiAgICBhZGRyZXNzW10gcHVibGljIGludmVzdENvbnRyYWN0cyA9IFsweDBdOyAvLyBhY2NlcHRlZCBJbnZlc3RDb250cmFjdHMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgaW52ZXN0Q29udHJhY3RzSW5kaWNlczsKCiAgICB1aW50IHB1YmxpYyBtaW5pbWFsSW52ZXN0bWVudCA9IDUgZXRoZXI7CiAgICAKICAgIHVpbnQgcHVibGljIHRvdGFsRXRoZXI7IC8vIEhvdyBtdWNoIEV0aGVyIGlzIGNvbGxlY3RlZCA9c3VtIG9mIGFsbCBtaWxlc3RvbmVzJyBldGhlckFtb3VudAogICAgdWludCBwdWJsaWMgdG90YWxUb2tlbjsgLy8gaG93IG1hbnkgdG9rZW5zIGFyZSBkaXN0cmlidXRlZCA9IHN1bSBvZiBhbGwgbWlsZXN0b25lcycgdG9rZW5BbW91bnQKCiAgICB1aW50IHB1YmxpYyB0b2tlbkxlZnQ7CiAgICB1aW50IHB1YmxpYyBldGhlckxlZnQ7CgogICAgVG9rZW4gcHVibGljIHRva2VuOwogICAgCiAgICAvLy9JQ08gY2FwcwogICAgdWludCBwdWJsaWMgbWluaW11bUNhcDsgLy8gc2V0IGluIGNvbnN0cnVjdG9yCiAgICB1aW50IHB1YmxpYyBtYXhpbXVtQ2FwOyAgLy8gc2V0IGluIGNvbnN0cnVjdG9yCgogICAgLy9TdHJ1Y3R1cmUgZm9yIG1pbGVzdG9uZQogICAgc3RydWN0IE1pbGVzdG9uZSB7CiAgICAgICAgdWludCBldGhlckFtb3VudDsgLy9ob3cgbWFueSBFdGhlciBpcyBuZWVkZWQgZm9yIHRoaXMgbWlsZXN0b25lCiAgICAgICAgdWludCB0b2tlbkFtb3VudDsgLy9ob3cgbWFueSB0b2tlbnMgcmVsZWFzZXMgdGhpcyBtaWxlc3RvbmUKICAgICAgICB1aW50IHN0YXJ0VGltZTsgLy9yZWFsIHRpbWUgd2hlbiBtaWxlc3RvbmUgaGFzIHN0YXJ0ZWQsIHNldCB1cG9uIHN0YXJ0CiAgICAgICAgdWludCBmaW5pc2hUaW1lOyAvL3JlYWwgdGltZSB3aGVuIG1pbGVzdG9uZSBoYXMgZmluaXNoZWQsIHNldCB1cG9uIGZpbmlzaAogICAgICAgIHVpbnQgZHVyYXRpb247IC8vYXNzdW1lZCBkdXJhdGlvbiBmb3IgbWlsZXN0b25lIGltcGxlbWVudGF0aW9uLCBzZXQgdXBvbiBtaWxlc3RvbmUgY3JlYXRpb24KICAgICAgICBzdHJpbmcgZGVzY3JpcHRpb247IAogICAgICAgIHN0cmluZyByZXN1bHRzOwogICAgfQoKICAgIE1pbGVzdG9uZVtdIHB1YmxpYyBtaWxlc3RvbmVzOwogICAgdWludCBwdWJsaWMgY3VycmVudE1pbGVzdG9uZTsKICAgIHVpbnQgcHVibGljIHNlYWxUaW1lc3RhbXA7IC8vVW50aWwgd2hlbiBpdCdzIHBvc3NpYmxlIHRvIGFkZCBuZXcgYW5kIGNoYW5nZSBleGlzdGluZyBtaWxlc3RvbmVzCgogICAgCiAgICBtb2RpZmllciBvbmx5KGFkZHJlc3MgX3NlbmRlcikgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBfc2VuZGVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdFNlYWxlZCgpIHsKICAgICAgICByZXF1aXJlKG5vdyA8PSBzZWFsVGltZXN0YW1wKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHNlYWxlZCgpIHsKICAgICAgICByZXF1aXJlKG5vdyA+IHNlYWxUaW1lc3RhbXApOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQ3JlYXRlIGFuIElDT0NvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIEFkZHJlc3Mgb2YgcHJvamVjdCB0b2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfcHJvamVjdFdhbGxldCBBZGRyZXNzIG9mIHByb2plY3QgZGV2ZWxvcGVycyB3YWxsZXQKICAgIC8vLyBAcGFyYW0gX3NlYWxUaW1lc3RhbXAgVW50aWwgdGhpcyB0aW1lc3RhbXAgaXQncyBwb3NzaWJsZSB0byBhbHRlciBtaWxlc3RvbmVzCiAgICAvLy8gQHBhcmFtIF9taW5pbXVtQ2FwIFdlaSB2YWx1ZSBvZiBtaW5pbXVtIGNhcCBmb3IgcmVzcG9uc2libGUgSUNPCiAgICAvLy8gQHBhcmFtIF9tYXhpbXVtQ2FwIFdlaSB2YWx1ZSBvZiBtYXhpbXVtIGNhcCBmb3IgcmVzcG9uc2libGUgSUNPCiAgICBmdW5jdGlvbiBJQ09Db250cmFjdChhZGRyZXNzIF90b2tlbkFkZHJlc3MsIGFkZHJlc3MgX3Byb2plY3RXYWxsZXQsIHVpbnQgX3NlYWxUaW1lc3RhbXAsIHVpbnQgX21pbmltdW1DYXAsCiAgICAgICAgICAgICAgICAgICAgICAgICB1aW50IF9tYXhpbXVtQ2FwKSBwdWJsaWMgewogICAgICAgIHRva2VuID0gVG9rZW4oX3Rva2VuQWRkcmVzcyk7CiAgICAgICAgcHJvamVjdFdhbGxldCA9IF9wcm9qZWN0V2FsbGV0OwogICAgICAgIHNlYWxUaW1lc3RhbXAgPSBfc2VhbFRpbWVzdGFtcDsKICAgICAgICBtaW5pbXVtQ2FwID0gX21pbmltdW1DYXA7CiAgICAgICAgbWF4aW11bUNhcCA9IF9tYXhpbXVtQ2FwOwogICAgfQoKICAgIC8vTUlMRVNUT05FUwogIAogICAgLy8vIEBkZXYgQWRkcyBhIG1pbGVzdG9uZS4KICAgIC8vLyBAcGFyYW0gX2V0aGVyQW1vdW50IGFtb3VudCBvZiBFdGhlciBuZWVkZWQgZm9yIHRoZSBhZGRlZCBtaWxlc3RvbmUKICAgIC8vLyBAcGFyYW0gX3Rva2VuQW1vdW50IGFtb3VudCBvZiB0b2tlbnMgd2hpY2ggd2lsbCBiZSByZWxlYXNlZCBmb3IgYWRkZWQgbWlsZXN0b25lCiAgICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgZmllbGQgZm9yIHN0YXJ0IHRpbWVzdGFtcCBvZiBhZGRlZCBtaWxlc3RvbmUKICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIGFzc3VtZWQgZHVyYXRpb24gb2YgdGhlIG1pbGVzdG9uZQogICAgLy8vIEBwYXJhbSBfZGVzY3JpcHRpb24gZGVzY3JpcHRpb24gb2YgYWRkZWQgbWlsZXN0b25lCiAgICAvLy8gQHBhcmFtIF9yZXN1bHQgcmVzdWx0IGRlc2NyaXB0aW9uIG9mIGFkZGVkIG1pbGVzdG9uZQogICAgZnVuY3Rpb24gYWRkTWlsZXN0b25lKHVpbnQgX2V0aGVyQW1vdW50LCB1aW50IF90b2tlbkFtb3VudCwgdWludCBfc3RhcnRUaW1lLCB1aW50IF9kdXJhdGlvbiwgc3RyaW5nIF9kZXNjcmlwdGlvbiwgc3RyaW5nIF9yZXN1bHQpICAgICAgICAKICAgIG5vdFNlYWxlZCBvbmx5KG9wZXJhdG9yKQogICAgcHVibGljIHJldHVybnModWludCkgewogICAgICAgIHRvdGFsRXRoZXIgKz0gX2V0aGVyQW1vdW50OwogICAgICAgIHRvdGFsVG9rZW4gKz0gX3Rva2VuQW1vdW50OwogICAgICAgIHJldHVybiBtaWxlc3RvbmVzLnB1c2goTWlsZXN0b25lKF9ldGhlckFtb3VudCwgX3Rva2VuQW1vdW50LCBfc3RhcnRUaW1lLCAwLCBfZHVyYXRpb24sIF9kZXNjcmlwdGlvbiwgX3Jlc3VsdCkpOwogICAgfQoKICAgIC8vLyBAZGV2IEVkaXRzIG1pbGVzdG9uZSBieSBnaXZlbiBpZCBhbmQgbmV3IHBhcmFtZXRlcnMuCiAgICAvLy8gQHBhcmFtIF9pZCBpZCBvZiBlZGl0aW5nIG1pbGVzdG9uZQogICAgLy8vIEBwYXJhbSBfZXRoZXJBbW91bnQgYW1vdW50IG9mIEV0aGVyIG5lZWRlZCBmb3IgdGhlIG1pbGVzdG9uZQogICAgLy8vIEBwYXJhbSBfdG9rZW5BbW91bnQgYW1vdW50IG9mIHRva2VucyB3aGljaCB3aWxsIGJlIHJlbGVhc2VkIGZvciB0aGUgbWlsZXN0b25lCiAgICAvLy8gQHBhcmFtIF9zdGFydFRpbWUgc3RhcnQgdGltZXN0YW1wIG9mIHRoZSBtaWxlc3RvbmUKICAgIC8vLyBAcGFyYW0gX2R1cmF0aW9uIGFzc3VtZWQgZHVyYXRpb24gb2YgdGhlIG1pbGVzdG9uZQogICAgLy8vIEBwYXJhbSBfZGVzY3JpcHRpb24gZGVzY3JpcHRpb24gb2YgdGhlIG1pbGVzdG9uZQogICAgLy8vIEBwYXJhbSBfcmVzdWx0cyByZXN1bHQgZGVzY3JpcHRpb24gb2YgdGhlIG1pbGVzdG9uZQogICAgZnVuY3Rpb24gZWRpdE1pbGVzdG9uZSh1aW50IF9pZCwgdWludCBfZXRoZXJBbW91bnQsIHVpbnQgX3Rva2VuQW1vdW50LCB1aW50IF9zdGFydFRpbWUsIHVpbnQgX2R1cmF0aW9uLCBzdHJpbmcgX2Rlc2NyaXB0aW9uLCBzdHJpbmcgX3Jlc3VsdHMpIAogICAgbm90U2VhbGVkIG9ubHkob3BlcmF0b3IpCiAgICBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoX2lkIDwgbWlsZXN0b25lcy5sZW5ndGgpOwogICAgICAgIHRvdGFsRXRoZXIgPSB0b3RhbEV0aGVyIC0gbWlsZXN0b25lc1tfaWRdLmV0aGVyQW1vdW50ICsgX2V0aGVyQW1vdW50OwogICAgICAgIHRvdGFsVG9rZW4gPSB0b3RhbFRva2VuIC0gbWlsZXN0b25lc1tfaWRdLnRva2VuQW1vdW50ICsgX3Rva2VuQW1vdW50OwogICAgICAgIG1pbGVzdG9uZXNbX2lkXS5ldGhlckFtb3VudCA9IF9ldGhlckFtb3VudDsKICAgICAgICBtaWxlc3RvbmVzW19pZF0udG9rZW5BbW91bnQgPSBfdG9rZW5BbW91bnQ7CiAgICAgICAgbWlsZXN0b25lc1tfaWRdLnN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICAgICAgbWlsZXN0b25lc1tfaWRdLmR1cmF0aW9uID0gX2R1cmF0aW9uOwogICAgICAgIG1pbGVzdG9uZXNbX2lkXS5kZXNjcmlwdGlvbiA9IF9kZXNjcmlwdGlvbjsKICAgICAgICBtaWxlc3RvbmVzW19pZF0ucmVzdWx0cyA9IF9yZXN1bHRzOwogICAgfQoKICAgIC8vVE9ETzogYWRkIGNoZWNrIGlmIElDT0NvbnRyYWN0IGhhcyB0b2tlbnMKICAgIC8vL0BkZXYgU2VhbHMgbWlsZXN0b25lIG1ha2luZyB0aGVtIG5vIGxvbmdlciBjaGFuZ2VhYmxlLiBXb3JrcyBieSBzZXR0aW5nIGNoYW5nZWFibGUgdGltZXN0YW1wIHRvIHRoZSBjdXJyZW50IG9uZSwgLy9zbyBpbiBmdXR1cmUgaXQgd291bGQgYmUgbm8gbG9uZ2VyIGNhbGxhYmxlLgogICAgZnVuY3Rpb24gc2VhbCgpIG9ubHkob3BlcmF0b3IpIG5vdFNlYWxlZCgpIHB1YmxpYyB7IAogICAgICAgIGFzc2VydChtaWxlc3RvbmVzLmxlbmd0aCA+IDApOwogICAgICAgIC8vYXNzZXJ0KHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSA+PSB0b3RhbFRva2VuOwogICAgICAgIHNlYWxUaW1lc3RhbXAgPSBub3c7CiAgICAgICAgZXRoZXJMZWZ0ID0gdG90YWxFdGhlcjsKICAgICAgICB0b2tlbkxlZnQgPSB0b3RhbFRva2VuOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmlzaE1pbGVzdG9uZShzdHJpbmcgX3Jlc3VsdHMpIG9ubHkob3BlcmF0b3IpIHB1YmxpYyB7CiAgICAgICAgdmFyIG1pbGVzdG9uZSA9IGdldEN1cnJlbnRNaWxlc3RvbmUoKTsKICAgICAgICBtaWxlc3RvbmVzW21pbGVzdG9uZV0uZmluaXNoVGltZSA9IG5vdzsKICAgICAgICBtaWxlc3RvbmVzW21pbGVzdG9uZV0ucmVzdWx0cyA9IF9yZXN1bHRzOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0YXJ0TmV4dE1pbGVzdG9uZSgpIHB1YmxpYyBvbmx5KG9wZXJhdG9yKSB7CiAgICAgICAgdWludCBtaWxlc3RvbmUgPSBnZXRDdXJyZW50TWlsZXN0b25lKCk7CiAgICAgICAgcmVxdWlyZShtaWxlc3RvbmVzW2N1cnJlbnRNaWxlc3RvbmVdLmZpbmlzaFRpbWUgPT0gMCk7CiAgICAgICAgY3VycmVudE1pbGVzdG9uZSArPTE7CiAgICAgICAgbWlsZXN0b25lc1tjdXJyZW50TWlsZXN0b25lXS5zdGFydFRpbWUgPSBub3c7CiAgICAgICAgZm9yKHVpbnQgaT0xOyBpIDwgaW52ZXN0Q29udHJhY3RzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBJbnZlc3RDb250cmFjdCBpbnZlc3RDb250cmFjdCA9ICBJbnZlc3RDb250cmFjdChpbnZlc3RDb250cmFjdHNbaV0pOyAKICAgICAgICAgICAgICAgIGludmVzdENvbnRyYWN0Lm1pbGVzdG9uZVN0YXJ0ZWQobWlsZXN0b25lKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vQGRldiBSZXR1cm5zIG51bWJlciBvZiB0aGUgY3VycmVudCBtaWxlc3RvbmUuIFN0YXJ0cyBmcm9tIDEuIDAgaW5kaWNhdGVzIHRoYXQgcHJvamVjdCBpbXBsZW1lbnRhdGlvbiBoYXMgbm90IHN0YXJ0ZWQgeWV0LgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudE1pbGVzdG9uZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICAvKgogICAgICAgIGZvcih1aW50IGk9MDsgaSA8IG1pbGVzdG9uZXMubGVuZ3RoOyBpKyspIHsgCiAgICAgICAgICAgIGlmIChtaWxlc3RvbmVzW2ldLnN0YXJ0VGltZSA8PSBub3cgJiYgbm93IDw9IG1pbGVzdG9uZXNbaV0uZmluaXNoVGltZSArIHdhaXRQZXJpb2QpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpKzE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICAgICAqLwogICAgICAgIHJldHVybiBjdXJyZW50TWlsZXN0b25lOwogICAgfQogICAKICAgIC8vLyBAZGV2IEdldHRlciBmdW5jdGlvbiBmb3IgbGVuZ3RoLiBGb3IgdGVzdGluZyBwdXJwb3Nlcy4KICAgIGZ1bmN0aW9uIG1pbGVzdG9uZXNMZW5ndGgoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gbWlsZXN0b25lcy5sZW5ndGg7CiAgICB9CgogICAgLy8vSW52ZXN0Q29udHJhY3QgcGFydAogICAgZnVuY3Rpb24gY3JlYXRlSW52ZXN0Q29udHJhY3QoYWRkcmVzcyBfaW52ZXN0b3IsIHVpbnQgX2V0aGVyQW1vdW50LCB1aW50IF90b2tlbkFtb3VudCkgcHVibGljIAogICAgICAgIHNlYWxlZCBvbmx5KG9wZXJhdG9yKQogICAgICAgIHJldHVybnMoYWRkcmVzcykKICAgIHsKICAgICAgICByZXF1aXJlKF9ldGhlckFtb3VudCA+PSBtaW5pbWFsSW52ZXN0bWVudCk7CiAgICAgICAgLy9yZXF1aXJlKG1pbGVzdG9uZXNbMF0uc3RhcnRUaW1lIC0gbm93ID49IDUgZGF5cyk7CiAgICAgICAgLy9yZXF1aXJlKG1heGltdW1DYXAgPj0gX2V0aGVyQW1vdW50ICsgaW52ZXN0b3JFdGhlcik7CiAgICAgICAgLy9yZXF1aXJlKHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSA+PSBfdG9rZW5BbW91bnQgKyBpbnZlc3RvclRva2Vucyk7CiAgICAgICAgYWRkcmVzcyBpbnZlc3RDb250cmFjdCA9IG5ldyBJbnZlc3RDb250cmFjdChhZGRyZXNzKHRoaXMpLCBfaW52ZXN0b3IsIF9ldGhlckFtb3VudCwgX3Rva2VuQW1vdW50KTsKICAgICAgICBwZW5kaW5nSW52ZXN0Q29udHJhY3RzLnB1c2goaW52ZXN0Q29udHJhY3QpOwogICAgICAgIHBlbmRpbmdJbnZlc3RDb250cmFjdHNJbmRpY2VzW2ludmVzdENvbnRyYWN0XT0ocGVuZGluZ0ludmVzdENvbnRyYWN0cy5sZW5ndGgtMSk7IC8vbm90ZSB0aGF0IGluZGljZXMgc3RhcnQgZnJvbSAxCiAgICAgICAgcmV0dXJuKGludmVzdENvbnRyYWN0KTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSBJbnZlc3RDb250cmFjdCB3aGVuIGl0IHJlY2VpdmVzIEV0aGVyLiBJdCBzaG9sZCBtb3ZlIHRoaXMgSW52ZXN0Q29udHJhY3QgZnJvbSBwZW5kaW5nIHRvIHRoZSByZWFsIG9uZXMuCiAgICBmdW5jdGlvbiBpbnZlc3RDb250cmFjdERlcG9zaXRlZCgpIHB1YmxpYyB7CiAgICAgICAgLy9yZXF1aXJlKG1heGltdW1DYXAgPj0gaW52ZXN0RXRoQW1vdW50ICsgaW52ZXN0b3JFdGhlcik7CiAgICAgICAgdWludCBpbmRleCA9IHBlbmRpbmdJbnZlc3RDb250cmFjdHNJbmRpY2VzW21zZy5zZW5kZXJdOwogICAgICAgIGFzc2VydChpbmRleCA+IDApOwogICAgICAgIHVpbnQgbGVuID0gcGVuZGluZ0ludmVzdENvbnRyYWN0cy5sZW5ndGg7CiAgICAgICAgSW52ZXN0Q29udHJhY3QgaW52ZXN0Q29udHJhY3QgPSBJbnZlc3RDb250cmFjdChwZW5kaW5nSW52ZXN0Q29udHJhY3RzW2luZGV4XSk7CiAgICAgICAgcGVuZGluZ0ludmVzdENvbnRyYWN0c1tpbmRleF0gPSBwZW5kaW5nSW52ZXN0Q29udHJhY3RzW2xlbi0xXTsKICAgICAgICBwZW5kaW5nSW52ZXN0Q29udHJhY3RzLmxlbmd0aCA9IGxlbi0xOwogICAgICAgIGludmVzdENvbnRyYWN0cy5wdXNoKG1zZy5zZW5kZXIpOwogICAgICAgIGludmVzdENvbnRyYWN0c0luZGljZXNbbXNnLnNlbmRlcl09aW52ZXN0Q29udHJhY3RzLmxlbmd0aC0xOyAvL25vdGUgdGhhdCBpbmRleGluZyBzdGFydHMgZnJvbSAxCgogICAgICAgIHVpbnQgaW52ZXN0bWVudFRva2VuID0gaW52ZXN0Q29udHJhY3QudG9rZW5BbW91bnQoKTsKICAgICAgICB1aW50IGludmVzdG1lbnRFdGhlciA9IGludmVzdENvbnRyYWN0LmV0aGVyQW1vdW50KCk7CgogICAgICAgIGV0aGVyTGVmdCAtPSBpbnZlc3RtZW50RXRoZXI7CiAgICAgICAgdG9rZW5MZWZ0IC09IGludmVzdG1lbnRUb2tlbjsKICAgICAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgaW52ZXN0bWVudFRva2VuKSk7IAogICAgfQoKICAgIGZ1bmN0aW9uIHJldHVyblRva2VucygpIHB1YmxpYyBvbmx5KG9wZXJhdG9yKSB7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKHByb2plY3RXYWxsZXQsIGJhbGFuY2UpOwogICAgfQoKfQoKCmNvbnRyYWN0IFB1bGxhYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwYXltZW50czsKCiAgLyoqCiAgKiBAZGV2IHdpdGhkcmF3IGFjY3VtdWxhdGVkIGJhbGFuY2UsIGNhbGxlZCBieSBwYXllZS4KICAqLwogIGZ1bmN0aW9uIHdpdGhkcmF3UGF5bWVudCgpIHB1YmxpYyB7CiAgICBhZGRyZXNzIHBheWVlID0gbXNnLnNlbmRlcjsKICAgIHVpbnQyNTYgcGF5bWVudCA9IHBheW1lbnRzW3BheWVlXTsKCiAgICByZXF1aXJlKHBheW1lbnQgIT0gMCk7CiAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+PSBwYXltZW50KTsKCiAgICBwYXltZW50c1twYXllZV0gPSAwOwoKICAgIGFzc2VydChwYXllZS5zZW5kKHBheW1lbnQpKTsKICB9CgogIC8qKgogICogQGRldiBDYWxsZWQgYnkgdGhlIHBheWVyIHRvIHN0b3JlIHRoZSBzZW50IGFtb3VudCBhcyBjcmVkaXQgdG8gYmUgcHVsbGVkLgogICogQHBhcmFtIF9kZXN0aW5hdGlvbiBUaGUgZGVzdGluYXRpb24gYWRkcmVzcyBvZiB0aGUgZnVuZHMuCiAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IHRvIHRyYW5zZmVyLgogICovCiAgZnVuY3Rpb24gYXN5bmNTZW5kKGFkZHJlc3MgX2Rlc3RpbmF0aW9uLCB1aW50MjU2IF9hbW91bnQpIGludGVybmFsIHsKICAgIHBheW1lbnRzW19kZXN0aW5hdGlvbl0gPSBwYXltZW50c1tfZGVzdGluYXRpb25dLmFkZChfYW1vdW50KTsKICB9Cn0KCmNvbnRyYWN0IFRva2VuUHVsbGFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIFRva2VuIHB1YmxpYyB0b2tlbjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlblBheW1lbnRzOwoKICBmdW5jdGlvbiBUb2tlblB1bGxhYmxlKGFkZHJlc3MgX2ljbykgcHVibGljIHsKICAgICAgSUNPQ29udHJhY3QgaWNvQ29udHJhY3QgPSBJQ09Db250cmFjdChfaWNvKTsKICAgICAgdG9rZW4gPSBpY29Db250cmFjdC50b2tlbigpOwogIH0KCiAgLyoqCiAgKiBAZGV2IHdpdGhkcmF3IGFjY3VtdWxhdGVkIGJhbGFuY2UsIGNhbGxlZCBieSBwYXllZS4KICAqLwogIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5QYXltZW50KCkgcHVibGljIHsKICAgIGFkZHJlc3MgdG9rZW5QYXllZSA9IG1zZy5zZW5kZXI7CiAgICB1aW50MjU2IHRva2VuUGF5bWVudCA9IHRva2VuUGF5bWVudHNbdG9rZW5QYXllZV07CgogICAgcmVxdWlyZSh0b2tlblBheW1lbnQgIT0gMCk7CiAgICByZXF1aXJlKHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSA+PSB0b2tlblBheW1lbnQpOwoKICAgIHRva2VuUGF5bWVudHNbdG9rZW5QYXllZV0gPSAwOwoKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0b2tlblBheWVlLCB0b2tlblBheW1lbnQpKTsKICB9CgogIGZ1bmN0aW9uIGFzeW5jVG9rZW5TZW5kKGFkZHJlc3MgX2Rlc3RpbmF0aW9uLCB1aW50IF9hbW91bnQpIGludGVybmFsIHsKICAgIHRva2VuUGF5bWVudHNbX2Rlc3RpbmF0aW9uXSA9IHRva2VuUGF5bWVudHNbX2Rlc3RpbmF0aW9uXS5hZGQoX2Ftb3VudCk7CiAgfQp9Cgpjb250cmFjdCBJbnZlc3RDb250cmFjdCBpcyBUb2tlblB1bGxhYmxlLCBQdWxsYWJsZSB7CgogICAgYWRkcmVzcyBwdWJsaWMgcHJvamVjdFdhbGxldDsgLy8gcGVyc29uIGZyb20gaWNvIHRlYW0KICAgIGFkZHJlc3MgcHVibGljIGludmVzdG9yOyAKCiAgICB1aW50IHB1YmxpYyBhcmJpdGVyQWNjZXB0Q291bnQgPSAwOwogICAgdWludCBwdWJsaWMgcXVvcnVtOwoKICAgIElDT0NvbnRyYWN0IHB1YmxpYyBpY29Db250cmFjdDsKICAgIC8vVG9rZW4gcHVibGljIHRva2VuOwoKICAgIHVpbnRbXSBwdWJsaWMgZXRoZXJQYXJ0aXRpb247IC8vd2VpcyAKICAgIHVpbnRbXSBwdWJsaWMgdG9rZW5QYXJ0aXRpb247IC8vdG9rZW5zCgogICAgLy9FYWNoIGFyYml0ZXIgaGFzIHBhcmFtZXRlciBkZWxheSB3aGljaCBlcXVhbHMgdGltZSBpbnRlcnZhbCBpbiBzZWNvbmRzIGJldHd3ZW4gZGlzcHV0ZSBvcGVuIGFuZCB3aGVuIHRoZSBhcmJpdGVyIGNhbiB2b3RlCiAgICBzdHJ1Y3QgQXJiaXRlckluZm8geyAKICAgICAgICB1aW50IGluZGV4OwogICAgICAgIGJvb2wgYWNjZXB0ZWQ7CiAgICAgICAgdWludCB2b3RlRGVsYXk7CiAgICB9CgogICAgbWFwcGluZyhhZGRyZXNzID0+IEFyYml0ZXJJbmZvKSBwdWJsaWMgYXJiaXRlcnM7IC8vYXJiaXRlckFkZHJlc3MgPT4gQXJiaXRlckluZm97YWNjZXB0YW5jZSwgdm90ZURlbGF5fQogICAgYWRkcmVzc1tdIHB1YmxpYyBhcmJpdGVyTGlzdCA9IFsweDBdOyAvL2l0J3MgbmVlZGVkIHRvIHNob3cgY29tcGxldGUgYXJiaXRlciBsaXN0CgoKICAgIC8vdGhpcyBzdHJ1Y3R1cmUgY2FuIGJlIG9wdGltaXplZAogICAgc3RydWN0IERpc3B1dGUgewogICAgICAgIHVpbnQgdGltZXN0YW1wOwogICAgICAgIHN0cmluZyByZWFzb247CiAgICAgICAgYWRkcmVzc1s1XSB2b3RlcnM7CiAgICAgICAgbWFwcGluZyhhZGRyZXNzID0+IGFkZHJlc3MpIHZvdGVzOyAKICAgICAgICB1aW50IHZvdGVzUHJvamVjdDsKICAgICAgICB1aW50IHZvdGVzSW52ZXN0b3I7CiAgICB9CgogICAgbWFwcGluZyh1aW50ID0+IERpc3B1dGUpIHB1YmxpYyBkaXNwdXRlczsKCiAgICB1aW50IHB1YmxpYyBldGhlckFtb3VudDsgLy9Ib3cgbXVjaCBFdGhlciBpbnZlc3RvciB3YW50cyB0byBpbnZlc3QKICAgIHVpbnQgcHVibGljIHRva2VuQW1vdW50OyAvL0hvdyBtYW55IHRva2VucyBpbnZlc3RvciB3YW50cyB0byByZWNlaXZlCgogICAgYm9vbCBwdWJsaWMgZGlzcHV0aW5nPWZhbHNlOwogICAgdWludCBwdWJsaWMgYW1vdW50VG9QYXk7IC8vaW52ZXN0QW1vdW50ICsgY29tbWlzc2lvbnMKICAgIAogICAgLy9Nb2RpZmllciB0aGF0IHJlc3RyaWN0cyBmdW5jdGlvbiBjYWxsZXIKICAgIG1vZGlmaWVyIG9ubHkoYWRkcmVzcyBfc2VuZGVyKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IF9zZW5kZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFyYml0ZXIoKSB7CiAgICAgICAgcmVxdWlyZShhcmJpdGVyc1ttc2cuc2VuZGVyXS52b3RlRGVsYXkgPiAwKTsKICAgICAgICBfOwogICAgfQogIAogICAgZnVuY3Rpb24gSW52ZXN0Q29udHJhY3QoYWRkcmVzcyBfSUNPQ29udHJhY3RBZGRyZXNzLCBhZGRyZXNzIF9pbnZlc3RvciwgIHVpbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgX2V0aGVyQW1vdW50LCB1aW50IF90b2tlbkFtb3VudCkgVG9rZW5QdWxsYWJsZShfSUNPQ29udHJhY3RBZGRyZXNzKQogICAgcHVibGljIHsKICAgICAgICBpY29Db250cmFjdCA9IElDT0NvbnRyYWN0KF9JQ09Db250cmFjdEFkZHJlc3MpOwogICAgICAgIHRva2VuID0gaWNvQ29udHJhY3QudG9rZW4oKTsKCQlldGhlckFtb3VudCA9IF9ldGhlckFtb3VudDsKICAgICAgICB0b2tlbkFtb3VudCA9IF90b2tlbkFtb3VudDsKICAgICAgICBwcm9qZWN0V2FsbGV0ID0gaWNvQ29udHJhY3QucHJvamVjdFdhbGxldCgpOwogICAgICAgIGludmVzdG9yID0gX2ludmVzdG9yOwogICAgICAgIGFtb3VudFRvUGF5ID0gZXRoZXJBbW91bnQqMTAxLzEwMDsgLy8xMDElIG9mIHRoZSBhZ3JlZWQgYW1vdW50CiAgICAgICAgcXVvcnVtID0gMzsKICAgICAgICAvL2hhcmRjb2RlZCBhcmJpdGVycwogICAgICAgIGFkZEFjY2VwdGVkQXJiaXRlcigweDQyZWZiYmEwNTYzQUU1YWEyMzEyQmVCY2UxQzE4QzY3MjJCNjc4NTcsIDEpOyAvL1J5YW4KICAgICAgICBhZGRBY2NlcHRlZEFyYml0ZXIoMHgzN0Q1OTUzYzI0YTJlZkQzNzJDOTdCMDZmMjI0MTZiNjhlODk2ZWFmLCAxKTsvLyBNYXhpbSBUZWxlZ2luCiAgICAgICAgYWRkQWNjZXB0ZWRBcmJpdGVyKDB4ZDBEMmUwNUZkMzRkNTY2NjEyNTI5NTEyRjdBZjFGOGE2MEVEQWI2QywgMSk7Ly8gVmxhZGltaXIgRHlha2luCiAgICAgICAgYWRkQWNjZXB0ZWRBcmJpdGVyKDB4QjY1MDhhRmFDZTgxNWU0ODFiZjNCM0ZhOUI0MTE3RDQ2Qzk2M0VjMywgMSk7Ly8gSW1tJiMyMjU7bnVlbCBGb2RvcgogICAgICAgIGFkZEFjY2VwdGVkQXJiaXRlcigweDczMzgwZGMxMkI2MjlGQjdmQkQyMjFFMDVEMjVFNDJmNWYzRkFCMTEsIDEpOy8vIEFsYmFuCgogICAgICAgIGFyYml0ZXJBY2NlcHRDb3VudCA9IDU7CgoJCXVpbnQgbWlsZXN0b25lRXRoZXJBbW91bnQ7IC8vSG93IG11Y2ggRXRoZXIgZG9lcyBpbnZlc3RvciBzZW5kIGZvciBhIG1pbGVzdG9uZQoJCXVpbnQgbWlsZXN0b25lVG9rZW5BbW91bnQ7IC8vSG93IG1hbnkgVG9rZW5zIGRvZXMgaW52ZXN0b3IgcmVjZWl2ZSBmb3IgYSBtaWxlc3RvbmUKCgkJdWludCBtaWxlc3RvbmVFdGhlclRhcmdldDsgLy9Ib3cgbXVjaCBUT1RBTCBFdGhlciBhIG1pbGVzdG9uZSBuZWVkcwoJCXVpbnQgbWlsZXN0b25lVG9rZW5UYXJnZXQ7IC8vSG93IG1hbnkgVE9UQUwgdG9rZW5zIGEgbWlsZXN0b25lIHJlbGVhc2VzCgoJCXVpbnQgdG90YWxFdGhlckludmVzdG1lbnQ7IAoJCXVpbnQgdG90YWxUb2tlbkludmVzdG1lbnQ7CgkJZm9yKHVpbnQgaT0wOyBpPGljb0NvbnRyYWN0Lm1pbGVzdG9uZXNMZW5ndGgoKTsgaSsrKSB7CgkJCShtaWxlc3RvbmVFdGhlclRhcmdldCwgbWlsZXN0b25lVG9rZW5UYXJnZXQsICwgLCAsICwgKSA9IGljb0NvbnRyYWN0Lm1pbGVzdG9uZXMoaSk7CgkJCW1pbGVzdG9uZUV0aGVyQW1vdW50ID0gX2V0aGVyQW1vdW50ICogbWlsZXN0b25lRXRoZXJUYXJnZXQgLyBpY29Db250cmFjdC50b3RhbEV0aGVyKCk7ICAKCQkJbWlsZXN0b25lVG9rZW5BbW91bnQgPSBfdG9rZW5BbW91bnQgKiBtaWxlc3RvbmVUb2tlblRhcmdldCAvIGljb0NvbnRyYWN0LnRvdGFsVG9rZW4oKTsKCQkJdG90YWxFdGhlckludmVzdG1lbnQgKz0gbWlsZXN0b25lRXRoZXJBbW91bnQ7IC8vdXNlZCB0byBwcmV2ZW50IHJvdW5kaW5nIGVycm9ycwoJCQl0b3RhbFRva2VuSW52ZXN0bWVudCArPSBtaWxlc3RvbmVUb2tlbkFtb3VudDsgLy91c2VkIHRvIHByZXZlbnQgcm91bmRpbmcgZXJyb3JzCgkJCWV0aGVyUGFydGl0aW9uLnB1c2gobWlsZXN0b25lRXRoZXJBbW91bnQpOyAgCgkJCXRva2VuUGFydGl0aW9uLnB1c2gobWlsZXN0b25lVG9rZW5BbW91bnQpOwoJCX0KCQlldGhlclBhcnRpdGlvblswXSArPSBfZXRoZXJBbW91bnQgLSB0b3RhbEV0aGVySW52ZXN0bWVudDsgLy9yb3VuZGluZyBlcnJvciBpcyBhZGRlZCB0byB0aGUgZmlyc3QgbWlsZXN0b25lCgkJdG9rZW5QYXJ0aXRpb25bMF0gKz0gX3Rva2VuQW1vdW50IC0gdG90YWxUb2tlbkludmVzdG1lbnQ7IC8vcm91bmRpbmcgZXJyb3IgaXMgYWRkZWQgdG8gdGhlIGZpcnN0IG1pbGVzdG9uZQogICAgfQoKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgb25seShpbnZlc3RvcikgeyAKICAgICAgICByZXF1aXJlKGFyYml0ZXJBY2NlcHRDb3VudCA+PSBxdW9ydW0pOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID09IGFtb3VudFRvUGF5KTsKICAgICAgICByZXF1aXJlKGdldEN1cnJlbnRNaWxlc3RvbmUoKSA9PSAwKTsgLy9iZWZvcmUgZmlyc3QKICAgICAgICBpY29Db250cmFjdC5pbnZlc3RDb250cmFjdERlcG9zaXRlZCgpOwogICAgfSAKCiAgICAvL0FkZGluZyBhbiBhcmJpdGVyIHdoaWNoIGhhcyBhbHJlYWR5IGFjY2VwdGVkIGhpcyBwYXJ0aWNpcGF0aW9uIGluIElDTy4KICAgIGZ1bmN0aW9uIGFkZEFjY2VwdGVkQXJiaXRlcihhZGRyZXNzIF9hcmJpdGVyLCB1aW50IF9kZWxheSkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUodG9rZW4uYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpPT0wKTsgLy9vbmx5IGNhbGxhYmxlIHdoZW4gdGhlcmUgYXJlIG5vIHRva2VucyBhdCB0aGlzIGNvbnRyYWN0CiAgICAgICAgcmVxdWlyZShfZGVsYXkgPiAwKTsgLy90byBkaWZmZXIgZnJvbSBub24tZXhpc3RlbnQgYXJiaXRlcnMKICAgICAgICB2YXIgaW5kZXggPSBhcmJpdGVyTGlzdC5wdXNoKF9hcmJpdGVyKTsKICAgICAgICBhcmJpdGVyc1tfYXJiaXRlcl0gPSBBcmJpdGVySW5mbyhpbmRleCwgdHJ1ZSwgX2RlbGF5KTsKICAgIH0KCiAgICAvKiBOb3QgdXNlZCBmb3Igb3VyIG93biBJQ08gYXMgYXJiaXRlcnMgYXJlIHRoZSBzYW1lIGFuZCBhbHJlYWR5IGFjY2VwdGVkIHRoZWlyIHBhcnRpY2lwYXRpb24KICAgIGZ1bmN0aW9uIGFyYml0ZXJBY2NlcHQoKSBwdWJsaWMgb25seUFyYml0ZXIgewogICAgICAgIHJlcXVpcmUoIWFyYml0ZXJzW21zZy5zZW5kZXJdLmFjY2VwdGVkKTsKICAgICAgICBhcmJpdGVyc1ttc2cuc2VuZGVyXS5hY2NlcHRlZCA9IHRydWU7CiAgICAgICAgYXJiaXRlckFjY2VwdENvdW50ICs9IDE7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkQXJiaXRlcihhZGRyZXNzIF9hcmJpdGVyLCB1aW50IF9kZWxheSkgcHVibGljIHsKICAgICAgICAvL29ubHkoaW52ZXN0b3IpCiAgICAgICAgcmVxdWlyZSh0b2tlbi5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSk9PTApOyAvL29ubHkgY2FsbGFibGUgd2hlbiB0aGVyZSBhcmUgbm8gdG9rZW5zIGF0IHRoaXMgY29udHJhY3QKICAgICAgICByZXF1aXJlKF9kZWxheSA+IDApOyAvL3RvIGRpZmZlciBmcm9tIG5vbi1leGlzdGVudCBhcmJpdGVycwogICAgICAgIHZhciBpbmRleCA9IGFyYml0ZXJMaXN0LnB1c2goX2FyYml0ZXIpOwogICAgICAgIGFyYml0ZXJzW19hcmJpdGVyXSA9IEFyYml0ZXJJbmZvKGluZGV4LCBmYWxzZSwgX2RlbGF5KTsKICAgIH0KCiAgICovCgogICAgZnVuY3Rpb24gdm90ZShhZGRyZXNzIF92b3RlQWRkcmVzcykgcHVibGljIG9ubHlBcmJpdGVyIHsgICAKICAgICAgICByZXF1aXJlKF92b3RlQWRkcmVzcyA9PSBpbnZlc3RvciB8fCBfdm90ZUFkZHJlc3MgPT0gcHJvamVjdFdhbGxldCk7CiAgICAgICAgcmVxdWlyZShkaXNwdXRpbmcpOwogICAgICAgIHVpbnQgbWlsZXN0b25lID0gZ2V0Q3VycmVudE1pbGVzdG9uZSgpOwogICAgICAgIHJlcXVpcmUobWlsZXN0b25lID4gMCk7CiAgICAgICAgcmVxdWlyZShkaXNwdXRlc1ttaWxlc3RvbmVdLnZvdGVzW21zZy5zZW5kZXJdID09IDApOyAKICAgICAgICByZXF1aXJlKG5vdyAtIGRpc3B1dGVzW21pbGVzdG9uZV0udGltZXN0YW1wID49IGFyYml0ZXJzW21zZy5zZW5kZXJdLnZvdGVEZWxheSk7IC8vY2hlY2tpbmcgaWYgZW5vdWdoIHRpbWUgaGFzIHBhc3NlZCBzaW5jZSBkaXNwdXRlIGhhZCBiZWVuIG9wZW5lZAogICAgICAgIGRpc3B1dGVzW21pbGVzdG9uZV0udm90ZXNbbXNnLnNlbmRlcl0gPSBfdm90ZUFkZHJlc3M7CiAgICAgICAgZGlzcHV0ZXNbbWlsZXN0b25lXS52b3RlcnNbZGlzcHV0ZXNbbWlsZXN0b25lXS52b3Rlc1Byb2plY3QrZGlzcHV0ZXNbbWlsZXN0b25lXS52b3Rlc0ludmVzdG9yXSA9IG1zZy5zZW5kZXI7CiAgICAgICAgaWYgKF92b3RlQWRkcmVzcyA9PSBwcm9qZWN0V2FsbGV0KSB7CiAgICAgICAgICAgIGRpc3B1dGVzW21pbGVzdG9uZV0udm90ZXNQcm9qZWN0ICs9IDE7CiAgICAgICAgfSBlbHNlIGlmIChfdm90ZUFkZHJlc3MgPT0gaW52ZXN0b3IpIHsKICAgICAgICAgICAgZGlzcHV0ZXNbbWlsZXN0b25lXS52b3Rlc0ludmVzdG9yICs9IDE7CiAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRpc3B1dGVzW21pbGVzdG9uZV0udm90ZXNQcm9qZWN0ID49IHF1b3J1bSkgewogICAgICAgICAgICBleGVjdXRlVmVyZGljdCh0cnVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRpc3B1dGVzW21pbGVzdG9uZV0udm90ZXNJbnZlc3RvciA+PSBxdW9ydW0pIHsKICAgICAgICAgICAgZXhlY3V0ZVZlcmRpY3QoZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBleGVjdXRlVmVyZGljdChib29sIF9wcm9qZWN0V29uKSBpbnRlcm5hbCB7CiAgICAgICAgLy91aW50IG1pbGVzdG9uZSA9IGdldEN1cnJlbnRNaWxlc3RvbmUoKTsKICAgICAgICBkaXNwdXRpbmcgPSBmYWxzZTsKICAgICAgICBpZiAoX3Byb2plY3RXb24pIHsKICAgICAgICAgICAgLy90b2tlbi50cmFuc2ZlcigweDAsIHRva2VuLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSk7CiAgICAgICAgfSBlbHNlICB7CgkJLy9hc3luY1Rva2VuU2VuZChpbnZlc3RvciwgdG9rZW5zVG9TZW5kKTsKCQkvL2FzeW5jU2VuZChwcm9qZWN0V2FsbGV0LCBldGhlclRvU2VuZCk7CiAgICAgICAgICAgIC8vdG9rZW4udHJhbnNmZXIoYWRkcmVzcyhpY29Db250cmFjdCksIHRva2VuLmJhbGFuY2VPZih0aGlzKSk7IC8vIHNlbmQgYWxsIHRva2VucyBiYWNrCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9wZW5EaXNwdXRlKHN0cmluZyBfcmVhc29uKSBwdWJsaWMgb25seShpbnZlc3RvcikgewogICAgICAgIGFzc2VydCghZGlzcHV0aW5nKTsKICAgICAgICB2YXIgbWlsZXN0b25lID0gZ2V0Q3VycmVudE1pbGVzdG9uZSgpOwogICAgICAgIGFzc2VydChtaWxlc3RvbmUgPiAwKTsKICAgICAgICBkaXNwdXRpbmcgPSB0cnVlOwogICAgICAgIGRpc3B1dGVzW21pbGVzdG9uZV0udGltZXN0YW1wID0gbm93OwogICAgICAgIGRpc3B1dGVzW21pbGVzdG9uZV0ucmVhc29uID0gX3JlYXNvbjsKICAgIH0KCglmdW5jdGlvbiBtaWxlc3RvbmVTdGFydGVkKHVpbnQgX21pbGVzdG9uZSkgcHVibGljIG9ubHkoYWRkcmVzcyhpY29Db250cmFjdCkpIHsKICAgICAgICByZXF1aXJlKCFkaXNwdXRpbmcpOwoJCXZhciBldGhlclRvU2VuZCA9IGV0aGVyUGFydGl0aW9uW19taWxlc3RvbmVdOwoJCXZhciB0b2tlbnNUb1NlbmQgPSB0b2tlblBhcnRpdGlvbltfbWlsZXN0b25lXTsKCgkJLy9hc3luYyBzZW5kCgkJYXN5bmNTZW5kKHByb2plY3RXYWxsZXQsIGV0aGVyVG9TZW5kKTsKCQlhc3luY1Rva2VuU2VuZChpbnZlc3RvciwgdG9rZW5zVG9TZW5kKTsKCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudE1pbGVzdG9uZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gaWNvQ29udHJhY3QuZ2V0Q3VycmVudE1pbGVzdG9uZSgpOwogICAgfQoKfQ=='.
	

]
