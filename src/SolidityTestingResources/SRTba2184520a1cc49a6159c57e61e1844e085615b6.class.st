Class {
	#name : #SRTba2184520a1cc49a6159c57e61e1844e085615b6,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTba2184520a1cc49a6159c57e61e1844e085615b6 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKY29udHJhY3QgRG9Ob3REZXBsb3lUaGlzR2V0VGhlUmlnaHRPbmVDb3NQYXJpdHlQdXRzVGhpc09uVG9wIHsKICAgIHVpbnQyNTYgbm90aGluZzsKCiAgICBmdW5jdGlvbiBEb05vdERlcGxveVRoaXNHZXRUaGVSaWdodE9uZUNvc1Bhcml0eVB1dHNUaGlzT25Ub3AoKSB7CiAgICAgICAgbm90aGluZyA9IDI3OwogICAgfQp9CgoKLy8qKioqKioqKioqKioqKiogT3duYWJsZQoKY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgCiAgICBfOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHsKICAgIGlmIChuZXdPd25lciAhPSBhZGRyZXNzKDApKSB7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQoKfQoKLy8qKioqKioqKioqKlBhdXNpYmxlCgpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlICghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCB7CiAgICByZXF1aXJlIChwYXVzZWQpIDsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCi8vKioqKioqKioqKioqKkVSQzIwCgpjb250cmFjdCBFUkMyMCB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludCB2YWx1ZSkgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHJldHVybnMgKGJvb2wgb2spOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQgdmFsdWUpOwp9CgovLyoqKioqKioqKioqKioqKiBTYWZlTWF0aAoKY29udHJhY3QgU2FmZU1hdGggewogIGZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc2FmZURpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPiAwKTsKICAgIHVpbnQgYyA9IGEgLyBiOwogICAgYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHNhZmVTdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgZnVuY3Rpb24gc2FmZUFkZCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSArIGI7CiAgICBhc3NlcnQoYz49YSAmJiBjPj1iKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gbWF4NjQodWludDY0IGEsIHVpbnQ2NCBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50NjQpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1heDI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOwogIH0KCiAgZnVuY3Rpb24gbWluMjU2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICB9Cgp9CgovLyoqKioqKioqKioqKioqKiogU3RhbmRhcmRUb2tlbgoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgU2FmZU1hdGggewoKICAvKioKICAgKiBAZGV2IEZpeCBmb3IgdGhlIEVSQzIwIHNob3J0IGFkZHJlc3MgYXR0YWNrLgogICAqLwogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IHNpemUpIHsKICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA+PSBzaXplICsgNCk7CiAgICAgXzsKICB9CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlczsKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seVBheWxvYWRTaXplKDIgKiAzMikgIHJldHVybnMgKGJvb2wgc3VjY2Vzcyl7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHNhZmVTdWIoYmFsYW5jZXNbbXNnLnNlbmRlcl0sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLCBfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBvbmx5UGF5bG9hZFNpemUoMyAqIDMyKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIHZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHNhZmVTdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gaWYgKF92YWx1ZSA+IF9hbGxvd2FuY2UpIHRocm93OwoKICAgIGJhbGFuY2VzW190b10gPSBzYWZlQWRkKGJhbGFuY2VzW190b10sIF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfZnJvbV0gPSBzYWZlU3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICByZXF1aXJlKChfdmFsdWUgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludCByZW1haW5pbmcpIHsKICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogIH0KCn0KCmNvbnRyYWN0IEdCVCB7CiAgZnVuY3Rpb24gcGFyZW50Q2hhbmdlKGFkZHJlc3MsdWludCk7CiAgZnVuY3Rpb24gcGFyZW50RmVlcyhhZGRyZXNzKTsKICBmdW5jdGlvbiBzZXRIR1QoYWRkcmVzcyBfaGd0KTsKfQoKLy8qKioqKioqKioqKiogSEVMTE9HT0xEVE9LRU4KCmNvbnRyYWN0IEhlbGxvR29sZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCwgUGF1c2FibGUsIFN0YW5kYXJkVG9rZW4gewoKICBzdHJpbmcgcHVibGljIG5hbWU7CiAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgdWludDggIHB1YmxpYyBkZWNpbWFsczsKCiAgR0JUICBnb2xkdG9rZW47CiAgCgogIGZ1bmN0aW9uIHNldEdCVChhZGRyZXNzIGdidF8pIG9ubHlPd25lciB7CiAgICBnb2xkdG9rZW4gPSBHQlQoZ2J0Xyk7CiAgfQoKICBmdW5jdGlvbiBHQlRBZGRyZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgcmV0dXJuIGFkZHJlc3MoZ29sZHRva2VuKTsKICB9CgogIGZ1bmN0aW9uIEhlbGxvR29sZFRva2VuKGFkZHJlc3MgX3Jlc2VydmUpIHsKICAgIG5hbWUgPSAiSGVsbG9Hb2xkIFRva2VuIjsKICAgIHN5bWJvbCA9ICJIR1QiOwogICAgZGVjaW1hbHMgPSA4OwogCiAgICB0b3RhbFN1cHBseSA9IDEgKiAxMCAqKiA5ICogMTAgKiogdWludDI1NihkZWNpbWFscyk7CiAgICBiYWxhbmNlc1tfcmVzZXJ2ZV0gPSB0b3RhbFN1cHBseTsKICB9CgoKICBmdW5jdGlvbiBwYXJlbnRDaGFuZ2UoYWRkcmVzcyBfdG8pIGludGVybmFsIHsKICAgIHJlcXVpcmUoYWRkcmVzcyhnb2xkdG9rZW4pICE9IDB4MCk7CiAgICBnb2xkdG9rZW4ucGFyZW50Q2hhbmdlKF90byxiYWxhbmNlc1tfdG9dKTsKICB9CiAgZnVuY3Rpb24gcGFyZW50RmVlcyhhZGRyZXNzIF90bykgaW50ZXJuYWwgewogICAgcmVxdWlyZShhZGRyZXNzKGdvbGR0b2tlbikgIT0gMHgwKTsKICAgIGdvbGR0b2tlbi5wYXJlbnRGZWVzKF90byk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpewogICAgcGFyZW50RmVlcyhfZnJvbSk7CiAgICBwYXJlbnRGZWVzKF90byk7CiAgICBzdWNjZXNzID0gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLF90byxfdmFsdWUpOwogICAgcGFyZW50Q2hhbmdlKF9mcm9tKTsKICAgIHBhcmVudENoYW5nZShfdG8pOwogICAgcmV0dXJuOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgIHsKICAgIHBhcmVudEZlZXMobXNnLnNlbmRlcik7CiAgICBwYXJlbnRGZWVzKF90byk7CiAgICBzdWNjZXNzID0gc3VwZXIudHJhbnNmZXIoX3RvLF92YWx1ZSk7CiAgICBwYXJlbnRDaGFuZ2UobXNnLnNlbmRlcik7CiAgICBwYXJlbnRDaGFuZ2UoX3RvKTsKICAgIHJldHVybjsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSAgewogICAgcmV0dXJuIHN1cGVyLmFwcHJvdmUoX3NwZW5kZXIsX3ZhbHVlKTsKICB9Cn0KCi8vKioqKioqKioqIEdPTERGRUVTICoqKioqKioqKioqKioqKioqKioqKioqKgoKY29udHJhY3QgR29sZEZlZXMgaXMgU2FmZU1hdGgsT3duYWJsZSB7CiAgICAvLyBlLmcuIGlmIHJhdGUgPSAwLjAwNTQKICAgIC8vdWludCByYXRlTiA9IDk5OTk0NTIwNTU7CiAgICB1aW50IHJhdGVOID0gOTk5OTQ1MjA1NDc5NDUyMDU0ODsKICAgIHVpbnQgcmF0ZUQgPSAxOTsKICAgIHVpbnQgcHVibGljIG1heERheXM7CiAgICB1aW50IHB1YmxpYyBtYXhSYXRlOwoKICAgIAogICAgZnVuY3Rpb24gR29sZEZlZXMoKSB7CiAgICAgICAgY2FsY01heCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNNYXgoKSB7CiAgICAgICAgbWF4RGF5cyA9IDE7CiAgICAgICAgbWF4UmF0ZSA9IHJhdGVOOwogICAgICAgIAogICAgICAgIAogICAgICAgIHVpbnQgcG93ID0gMjsKICAgICAgICBkbyB7CiAgICAgICAgICAgIHVpbnQgbmV3TiA9IHJhdGVOICoqIHBvdzsKICAgICAgICAgICAgaWYgKG5ld04gLyBtYXhSYXRlICE9IG1heFJhdGUpIHsKICAgICAgICAgICAgICAgIG1heERheXMgPSBwb3cgLyAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWF4UmF0ZSA9IG5ld047CiAgICAgICAgICAgIHBvdyAqPSAyOwogICAgICAgIH0gd2hpbGUgKHBvdyA8IDIwMDApOwogICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVJhdGUodWludDI1NiBfbiwgdWludDI1NiBfZCkgb25seU93bmVyewogICAgICAgIHJhdGVOID0gX247CiAgICAgICAgcmF0ZUQgPSBfZDsKICAgICAgICBjYWxjTWF4KCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJhdGVGb3JEYXlzKHVpbnQyNTYgbnVtRGF5cykgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByYXRlKSB7CiAgICAgICAgaWYgKG51bURheXMgPD0gbWF4RGF5cykgewogICAgICAgICAgICB1aW50IHIgPSByYXRlTiAqKiBudW1EYXlzOwogICAgICAgICAgICB1aW50IGQgPSByYXRlRCAqIG51bURheXM7CiAgICAgICAgICAgIGlmIChkID4gMTgpIHsKICAgICAgICAgICAgICAgIHVpbnQgZGl2ID0gIDEwICoqIChkLTE4KTsKICAgICAgICAgICAgICAgIHJhdGUgPSByIC8gZGl2OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGl2ID0gMTAgKiogKDE4IC0gZCk7CiAgICAgICAgICAgICAgICByYXRlID0gciAqIGRpdjsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTYgbWQxID0gbnVtRGF5cyAvIDI7CiAgICAgICAgICAgIHVpbnQyNTYgbWQyID0gbnVtRGF5cyAtIG1kMTsKICAgICAgICAgICAgIHVpbnQyNTYgcjI7CgogICAgICAgICAgICB1aW50MjU2IHIxID0gcmF0ZUZvckRheXMobWQxKTsKICAgICAgICAgICAgaWYgKG1kMSA9PSBtZDIpIHsKICAgICAgICAgICAgICAgIHIyID0gcjE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByMiA9IHJhdGVGb3JEYXlzKG1kMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAKCiAgICAgICAgICAgIC8vdWludDI1NiByMSA9IHJhdGVGb3JEYXlzKG1heERheXMpOwogICAgICAgICAgICAvL3VpbnQyNTYgcjIgPSByYXRlRm9yRGF5cyhudW1EYXlzLW1heERheXMpOwogICAgICAgICAgICByYXRlICA9IHNhZmVNdWwoIHIxICwgcjIpICAvIDEwICoqIDE4OwogICAgICAgIH0KICAgICAgICByZXR1cm47IAogICAgICAgIAogICAgfQoKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIFVUQzJNWVQgPSAxNDgzMjAwMDAwOwoKICAgIGZ1bmN0aW9uIHdvdERheSh1aW50MjU2IHRpbWUpIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKHRpbWUgLSBVVEMyTVlUKSAvICgxIGRheXMpOwogICAgfQoKICAgIC8vIG1pbmltdW0gZmVlIGlzIDEgdW5sZXNzIHNhbWUgZGF5CiAgICBmdW5jdGlvbiBjYWxjRmVlcyh1aW50MjU2IHN0YXJ0LCB1aW50MjU2IGVuZCwgdWludDI1NiBzdGFydEFtb3VudCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBhbW91bnQsIHVpbnQyNTYgZmVlKSB7CiAgICAgICAgaWYgKHN0YXJ0QW1vdW50ID09IDApIHJldHVybjsKICAgICAgICB1aW50MjU2IG51bWJlck9mRGF5cyA9IHdvdERheShlbmQpIC0gd290RGF5KHN0YXJ0KTsKICAgICAgICBpZiAobnVtYmVyT2ZEYXlzID09IDApIHsKICAgICAgICAgICAgYW1vdW50ID0gc3RhcnRBbW91bnQ7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYW1vdW50ID0gKHJhdGVGb3JEYXlzKG51bWJlck9mRGF5cykgKiBzdGFydEFtb3VudCkgLyAoMSBldGhlcik7CiAgICAgICAgaWYgKChmZWUgPT0gMCkgJiYgKGFtb3VudCAhPSAgMCkpIGFtb3VudC0tOwogICAgICAgIGZlZSA9IHNhZmVTdWIoc3RhcnRBbW91bnQsYW1vdW50KTsKICAgIH0KfQoKLy8qKioqKioqKioqKioqKioqKioqKiBHb2xkQmFja2VkVG9rZW4KCmNvbnRyYWN0IEdvbGRCYWNrZWRUb2tlbiBpcyBPd25hYmxlLCBTYWZlTWF0aCwgRVJDMjAsIFBhdXNhYmxlIHsKCiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7CiAgZXZlbnQgRGVkdWN0RmVlcyhhZGRyZXNzIGluZGV4ZWQgb3duZXIsdWludDI1NiBhbW91bnQpOwoKICBldmVudCBUb2tlbk1pbnRlZChhZGRyZXNzIGRlc3RpbmF0aW9uLCB1aW50MjU2IGFtb3VudCk7CiAgZXZlbnQgVG9rZW5CdXJuZWQoYWRkcmVzcyBzb3VyY2UsIHVpbnQyNTYgYW1vdW50KTsKICAKCXN0cmluZyBwdWJsaWMgbmFtZSA9ICJIZWxsb0dvbGQgR29sZCBCYWNrZWQgVG9rZW4iOwoJc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAiR0JUIjsKCXVpbnQyNTYgY29uc3RhbnQgcHVibGljICBkZWNpbWFscyA9IDE4OyAgLy8gc2FtZSBhcyBFVEgKCXVpbnQyNTYgY29uc3RhbnQgcHVibGljICBoZ3REZWNpbWFscyA9IDg7CgkJCgl1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBhbGxvY2F0aW9uUG9vbCA9IDEgKiAgMTAqKjkgKiAxMCoqaGd0RGVjaW1hbHM7ICAgICAgLy8gdG90YWwgSEdUIGhvbGRpbmdzCgl1aW50MjU2CWNvbnN0YW50IHB1YmxpYwltYXhBbGxvY2F0aW9uICA9IDM4ICogMTAqKjUgKiAxMCoqZGVjaW1hbHM7CQkJLy8gbWF4IEdCVCB0aGF0IGNhbiBldmVyIGV2ZXIgYmUgZ2l2ZW4gb3V0Cgl1aW50MjU2CSAgICAgICAgIHB1YmxpYwl0b3RBbGxvY2F0aW9uOwkJCS8vIGFtb3VudCBvZiBHQlQgc28gZmFyCgkKCWFkZHJlc3MJCQkgcHVibGljIGZlZUNhbGN1bGF0b3I7CglhZGRyZXNzCQkgICAgIHB1YmxpYyBIR1Q7CQkJCQkvLyBIR1QgY29udHJhY3QgYWRkcmVzcwoKCgoJZnVuY3Rpb24gc2V0RmVlQ2FsY3VsYXRvcihhZGRyZXNzIG5ld0ZDKSBvbmx5T3duZXIgewoJCWZlZUNhbGN1bGF0b3IgPSBuZXdGQzsKCX0KCgoJZnVuY3Rpb24gY2FsY0ZlZXModWludDI1NiBmcm9tLCB1aW50MjU2IHRvLCB1aW50MjU2IGFtb3VudCkgcmV0dXJucyAodWludDI1NiB2YWwsIHVpbnQyNTYgZmVlKSB7CgkJcmV0dXJuIEdvbGRGZWVzKGZlZUNhbGN1bGF0b3IpLmNhbGNGZWVzKGZyb20sdG8sYW1vdW50KTsKCX0KCglmdW5jdGlvbiBHb2xkQmFja2VkVG9rZW4oYWRkcmVzcyBmZWVDYWxjKSB7CgkJZmVlQ2FsY3VsYXRvciA9IGZlZUNhbGM7Cgl9CgogICAgc3RydWN0IGFsbG9jYXRpb24geyAKICAgICAgICB1aW50MjU2ICAgICBhbW91bnQ7CiAgICAgICAgdWludDI1NiAgICAgZGF0ZTsKICAgIH0KCQoJYWxsb2NhdGlvbltdICAgcHVibGljIGFsbG9jYXRpb25zT3ZlclRpbWU7CglhbGxvY2F0aW9uW10gICBwdWJsaWMgY3VycmVudEFsbG9jYXRpb25zOwoKCWZ1bmN0aW9uIGN1cnJlbnRBbGxvY2F0aW9uTGVuZ3RoKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGFvdExlbmd0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gYWxsb2NhdGlvbnNPdmVyVGltZS5sZW5ndGg7Cgl9CgoJCiAgICBzdHJ1Y3QgQmFsYW5jZSB7CiAgICAgICAgdWludDI1NiBhbW91bnQ7ICAgICAgICAgICAgICAgICAvLyBhbW91bnQgdGhyb3VnaCB1cGRhdGUgb3IgdHJhbnNmZXIKICAgICAgICB1aW50MjU2IGxhc3RVcGRhdGVkOyAgICAgICAgICAgIC8vIERBVEUgbGFzdCB1cGRhdGVkCiAgICAgICAgdWludDI1NiBuZXh0QWxsb2NhdGlvbkluZGV4OyAgICAvLyB3aGljaCBhbGxvY2F0aW9uc092ZXJUaW1lIHJlY29yZCBjb250YWlucyBuZXh0IHVwZGF0ZQogICAgICAgIHVpbnQyNTYgYWxsb2NhdGlvblNoYXJlOyAgICAgICAgLy8gdGhlIHNoYXJlIG9mIGFsbG9jYXRpb25Qb29sIHRoYXQgdGhpcyBob2xkZXIgZ2V0cyAobWVhbnMgdGhleSBob2xkIEhHVCkKICAgIH0KCgkvKkNyZWF0ZXMgYW4gYXJyYXkgd2l0aCBhbGwgYmFsYW5jZXMqLwoJbWFwcGluZyAoYWRkcmVzcyA9PiBCYWxhbmNlKSBwdWJsaWMgYmFsYW5jZXM7CgltYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGFsbG93ZWQ7CgkKCWZ1bmN0aW9uIHVwZGF0ZShhZGRyZXNzIHdoZXJlKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDI1NiBwb3M7CgkJdWludDI1NiBmZWVzOwoJCXVpbnQyNTYgdmFsOwogICAgICAgICh2YWwsZmVlcyxwb3MpID0gdXBkYXRlZEJhbGFuY2Uod2hlcmUpOwoJICAgIGJhbGFuY2VzW3doZXJlXS5uZXh0QWxsb2NhdGlvbkluZGV4ID0gcG9zOwoJICAgIGJhbGFuY2VzW3doZXJlXS5hbW91bnQgPSB2YWw7CiAgICAgICAgYmFsYW5jZXNbd2hlcmVdLmxhc3RVcGRhdGVkID0gbm93OwoJfQoJCglmdW5jdGlvbiB1cGRhdGVkQmFsYW5jZShhZGRyZXNzIHdoZXJlKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCB2YWwsIHVpbnQgZmVlcywgdWludCBwb3MpIHsKCQl1aW50MjU2IGNfdmFsOwoJCXVpbnQyNTYgY19mZWVzOwoJCXVpbnQyNTYgY19hbW91bnQ7CgoJCSh2YWwsIGZlZXMpID0gY2FsY0ZlZXMoYmFsYW5jZXNbd2hlcmVdLmxhc3RVcGRhdGVkLG5vdyxiYWxhbmNlc1t3aGVyZV0uYW1vdW50KTsKCgkgICAgcG9zID0gYmFsYW5jZXNbd2hlcmVdLm5leHRBbGxvY2F0aW9uSW5kZXg7CgkJaWYgKChwb3MgPCBjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoKSAmJiAgKGJhbGFuY2VzW3doZXJlXS5hbGxvY2F0aW9uU2hhcmUgIT0gMCkpIHsKCgkJCWNfYW1vdW50ID0gY3VycmVudEFsbG9jYXRpb25zW2JhbGFuY2VzW3doZXJlXS5uZXh0QWxsb2NhdGlvbkluZGV4XS5hbW91bnQgKiBiYWxhbmNlc1t3aGVyZV0uYWxsb2NhdGlvblNoYXJlIC8gYWxsb2NhdGlvblBvb2w7CgoJCQkoY192YWwsY19mZWVzKSAgID0gY2FsY0ZlZXMoY3VycmVudEFsbG9jYXRpb25zW2JhbGFuY2VzW3doZXJlXS5uZXh0QWxsb2NhdGlvbkluZGV4XS5kYXRlLG5vdyxjX2Ftb3VudCk7CgoJCX0gCgoJICAgIHZhbCAgKz0gY192YWw7CgkJZmVlcyArPSBjX2ZlZXM7CgkJcG9zICAgPSBjdXJyZW50QWxsb2NhdGlvbnMubGVuZ3RoOwoJfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdoZXJlKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHZhbCkgewogICAgICAgIHVpbnQyNTYgZmVlczsKCQl1aW50MjU2IHBvczsKICAgICAgICAodmFsLGZlZXMscG9zKSA9IHVwZGF0ZWRCYWxhbmNlKHdoZXJlKTsKICAgICAgICByZXR1cm4gOwogICAgfQoKCWV2ZW50IEFsbG9jYXRpb24odWludDI1NiBhbW91bnQsIHVpbnQyNTYgZGF0ZSk7CglldmVudCBGZWVPbkFsbG9jYXRpb24odWludDI1NiBmZWVzLCB1aW50MjU2IGRhdGUpOwoKCWV2ZW50IFBhcnRDb21wbGV0ZSgpOwoJZXZlbnQgU3RpbGxUb0dvKHVpbnQgbnVtTGVmdCk7Cgl1aW50MjU2IHB1YmxpYyBwYXJ0UG9zOwoJdWludDI1NiBwdWJsaWMgcGFydEZlZXM7Cgl1aW50MjU2IHBhcnRMOwoJYWxsb2NhdGlvbltdICAgcHVibGljIHBhcnRBbGxvY2F0aW9uczsKCglmdW5jdGlvbiBwYXJ0QWxsb2NhdGlvbkxlbmd0aCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKCQlyZXR1cm4gcGFydEFsbG9jYXRpb25zLmxlbmd0aDsKCX0KCglmdW5jdGlvbiBhZGRBbGxvY2F0aW9uUGFydE9uZSh1aW50IG5ld0FsbG9jYXRpb24sdWludCBudW1TdGVwcykgb25seU93bmVyewoJCXVpbnQyNTYgdGhpc0FsbG9jYXRpb24gPSBuZXdBbGxvY2F0aW9uOwoKCQlyZXF1aXJlKHRvdEFsbG9jYXRpb24gPCBtYXhBbGxvY2F0aW9uKTsJCS8vIGNhbm5vdCBhbGxvY2F0ZSBtb3JlIHRoYW4gdGhpczsKCgkJaWYgKGN1cnJlbnRBbGxvY2F0aW9ucy5sZW5ndGggPiBwYXJ0QWxsb2NhdGlvbnMubGVuZ3RoKSB7CgkJCXBhcnRBbGxvY2F0aW9ucyA9IGN1cnJlbnRBbGxvY2F0aW9uczsKCQl9CgoJCWlmICh0b3RBbGxvY2F0aW9uICsgdGhpc0FsbG9jYXRpb24gPiBtYXhBbGxvY2F0aW9uKSB7CgkJCXRoaXNBbGxvY2F0aW9uID0gbWF4QWxsb2NhdGlvbiAtIHRvdEFsbG9jYXRpb247CgkJCWxvZzAoIm1heCBhbGxvYyByZWFjaGVkIik7CgkJfQoJCXRvdEFsbG9jYXRpb24gKz0gdGhpc0FsbG9jYXRpb247CgoJCUFsbG9jYXRpb24odGhpc0FsbG9jYXRpb24sbm93KTsKCiAgICAgICAgYWxsb2NhdGlvbiBtZW1vcnkgbmV3RGl2OwogICAgICAgIG5ld0Rpdi5hbW91bnQgPSB0aGlzQWxsb2NhdGlvbjsKICAgICAgICBuZXdEaXYuZGF0ZSA9IG5vdzsKCQkvLyBzdG9yZSBpbnRvIGhpc3RvcnkKCSAgICBhbGxvY2F0aW9uc092ZXJUaW1lLnB1c2gobmV3RGl2KTsKCQkvLyBhZGQgdGhpcyByZWNvcmQgdG8gdGhlIGVuZCBvZiBjdXJyZW50QWxsb2NhdGlvbnMKCQlwYXJ0TCA9IHBhcnRBbGxvY2F0aW9ucy5wdXNoKG5ld0Rpdik7CgkJLy8gdXBkYXRlIGFsbCBvdGhlciByZWNvcmRzIHdpdGggY2FsY3MgZnJvbSBsYXN0IHJlY29yZAoJCWlmIChwYXJ0QWxsb2NhdGlvbnMubGVuZ3RoIDwgMikgeyAvLyBubyBmZWVzIHRvIGNvbnNpZGVyCgkJCVBhcnRDb21wbGV0ZSgpOwoJCQljdXJyZW50QWxsb2NhdGlvbnMgPSBwYXJ0QWxsb2NhdGlvbnM7CgkJCUZlZU9uQWxsb2NhdGlvbigwLG5vdyk7CgkJCXJldHVybjsKCQl9CgkJLy8KCQkvLyBUaGUgb25seSBmZWVzIHRoYXQgbmVlZCB0byBiZSBjb2xsZWN0ZWQgYXJlIHRoZSBmZWVzIG9uIGxvY2F0aW9uIHplcm8uCgkJLy8gU2luY2UgdGhleSBhcmUgdGhlIGxhc3QgY2FsY3VsYXRlZCA9IHRoZXkgY29tZSBvdXQgd2l0aCB0aGUgYnJlYWsKCQkvLwoJCWZvciAocGFydFBvcyA9IHBhcnRBbGxvY2F0aW9ucy5sZW5ndGggLSAyOyBwYXJ0UG9zID49IDA7IHBhcnRQb3MtLSApewoJCQkocGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmFtb3VudCxwYXJ0RmVlcykgPSBjYWxjRmVlcyhwYXJ0QWxsb2NhdGlvbnNbcGFydFBvc10uZGF0ZSxub3cscGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmFtb3VudCk7CgoJCQlwYXJ0QWxsb2NhdGlvbnNbcGFydFBvc10uYW1vdW50ICs9IHBhcnRBbGxvY2F0aW9uc1twYXJ0TCAtIDFdLmFtb3VudDsKCQkJcGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmRhdGUgICAgPSBub3c7CgkJCWlmICgocGFydFBvcyA9PSAwKSB8fCAocGFydFBvcyA9PSBwYXJ0QWxsb2NhdGlvbnMubGVuZ3RoLW51bVN0ZXBzKSl7CgkJCQlicmVhazsgCgkJCX0KCQl9CgkJaWYgKHBhcnRQb3MgIT0gMCkgewoJCQlTdGlsbFRvR28ocGFydFBvcyk7CgkJCXJldHVybjsgLy8gbm90IGRvbmUgeWV0CgkJfQoJCVBhcnRDb21wbGV0ZSgpOwoJCUZlZU9uQWxsb2NhdGlvbihwYXJ0RmVlcyxub3cpOwoJCWN1cnJlbnRBbGxvY2F0aW9ucyA9IHBhcnRBbGxvY2F0aW9uczsKCX0KCglmdW5jdGlvbiBhZGRBbGxvY2F0aW9uUGFydFR3byh1aW50IG51bVN0ZXBzKSBvbmx5T3duZXIgewoJCXJlcXVpcmUobnVtU3RlcHMgPiAwKTsKCQlyZXF1aXJlKHBhcnRQb3MgPiAwKTsKCQlmb3IgKHVpbnQgaSA9IDA7IGkgPCBudW1TdGVwczsgaSsrICl7CgkJCXBhcnRQb3MtLTsKCQkJKHBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5hbW91bnQscGFydEZlZXMpID0gY2FsY0ZlZXMocGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmRhdGUsbm93LHBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5hbW91bnQpOwoKCQkJcGFydEFsbG9jYXRpb25zW3BhcnRQb3NdLmFtb3VudCArPSBwYXJ0QWxsb2NhdGlvbnNbcGFydEwgLSAxXS5hbW91bnQ7CgkJCXBhcnRBbGxvY2F0aW9uc1twYXJ0UG9zXS5kYXRlICAgID0gbm93OwoJCQlpZiAocGFydFBvcyA9PSAwKSB7CgkJCQlicmVhazsgCgkJCX0KCQl9CgkJaWYgKHBhcnRQb3MgIT0gMCkgewoJCQlTdGlsbFRvR28ocGFydFBvcyk7CgkJCXJldHVybjsgLy8gbm90IGRvbmUgeWV0CgkJfQoJCVBhcnRDb21wbGV0ZSgpOwoJCUZlZU9uQWxsb2NhdGlvbihwYXJ0RmVlcyxub3cpOwoJCWN1cnJlbnRBbGxvY2F0aW9ucyA9IHBhcnRBbGxvY2F0aW9uczsKCX0KCgoJZnVuY3Rpb24gc2V0SEdUKGFkZHJlc3MgX2hndCkgb25seU93bmVyIHsKCQlIR1QgPSBfaGd0OwoJfQoKCWZ1bmN0aW9uIHBhcmVudEZlZXMoYWRkcmVzcyB3aGVyZSkgd2hlbk5vdFBhdXNlZCB7CgkJcmVxdWlyZShtc2cuc2VuZGVyID09IEhHVCk7CgkgICAgdXBkYXRlKHdoZXJlKTsJCQoJfQoJCglmdW5jdGlvbiBwYXJlbnRDaGFuZ2UoYWRkcmVzcyB3aGVyZSwgdWludCBuZXdWYWx1ZSkgd2hlbk5vdFBhdXNlZCB7IC8vIGNhbGxlZCB3aGVuIEhHVCBiYWxhbmNlIGNoYW5nZXMKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gSEdUKTsKCSAgICBiYWxhbmNlc1t3aGVyZV0uYWxsb2NhdGlvblNoYXJlID0gbmV3VmFsdWU7Cgl9CgkKCS8qIHNlbmQgR0JUICovCglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCBvaykgewoJICAgIHVwZGF0ZShtc2cuc2VuZGVyKTsgICAgICAgICAgICAgIC8vIERvIHRoaXMgdG8gZW5zdXJlIHNlbmRlciBoYXMgZW5vdWdoIGZ1bmRzLgoJCXVwZGF0ZShfdG8pOyAKCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0uYW1vdW50ID0gc2FmZVN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXS5hbW91bnQsIF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXS5hbW91bnQgPSBzYWZlQWRkKGJhbGFuY2VzW190b10uYW1vdW50LCBfdmFsdWUpOwoKCQlUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7IC8vTm90aWZ5IGFueW9uZSBsaXN0ZW5pbmcgdGhhdCB0aGlzIHRyYW5zZmVyIHRvb2sgcGxhY2UKICAgICAgICByZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCXZhciBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgoJICAgIHVwZGF0ZShfZnJvbSk7ICAgICAgICAgICAgICAvLyBEbyB0aGlzIHRvIGVuc3VyZSBzZW5kZXIgaGFzIGVub3VnaCBmdW5kcy4KCQl1cGRhdGUoX3RvKTsgCgoJCWJhbGFuY2VzW190b10uYW1vdW50ID0gc2FmZUFkZChiYWxhbmNlc1tfdG9dLmFtb3VudCwgX3ZhbHVlKTsKCQliYWxhbmNlc1tfZnJvbV0uYW1vdW50ID0gc2FmZVN1YihiYWxhbmNlc1tfZnJvbV0uYW1vdW50LCBfdmFsdWUpOwoJCWFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gc2FmZVN1YihfYWxsb3dhbmNlLCBfdmFsdWUpOwoJCVRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgogIAlmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoJCXJlcXVpcmUoKF92YWx1ZSA9PSAwKSB8fCAoYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPT0gMCkpOwogICAgCWFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgCUFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgCXJldHVybiB0cnVlOwogIAl9CgogIAlmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKSB7CiAgICAJcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgCX0KCgkvLyBNaW50aW5nIEZ1bmN0aW9ucyAKCWFkZHJlc3MgcHVibGljIGF1dGhvcmlzZWRNaW50ZXI7CgoJZnVuY3Rpb24gc2V0TWludGVyKGFkZHJlc3MgbWludGVyKSBvbmx5T3duZXIgewoJCWF1dGhvcmlzZWRNaW50ZXIgPSBtaW50ZXI7Cgl9CgkKCWZ1bmN0aW9uIG1pbnRUb2tlbnMoYWRkcmVzcyBkZXN0aW5hdGlvbiwgdWludDI1NiBhbW91bnQpIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gYXV0aG9yaXNlZE1pbnRlcik7CgkJdXBkYXRlKGRlc3RpbmF0aW9uKTsKCQliYWxhbmNlc1tkZXN0aW5hdGlvbl0uYW1vdW50ID0gc2FmZUFkZChiYWxhbmNlc1tkZXN0aW5hdGlvbl0uYW1vdW50LCBhbW91bnQpOwoJCWJhbGFuY2VzW2Rlc3RpbmF0aW9uXS5sYXN0VXBkYXRlZCA9IG5vdzsKCQliYWxhbmNlc1tkZXN0aW5hdGlvbl0ubmV4dEFsbG9jYXRpb25JbmRleCA9IGN1cnJlbnRBbGxvY2F0aW9ucy5sZW5ndGg7CgkJVG9rZW5NaW50ZWQoZGVzdGluYXRpb24sYW1vdW50KTsKCX0KCglmdW5jdGlvbiBidXJuVG9rZW5zKGFkZHJlc3Mgc291cmNlLCB1aW50MjU2IGFtb3VudCkgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBhdXRob3Jpc2VkTWludGVyKTsKCQl1cGRhdGUoc291cmNlKTsKCQliYWxhbmNlc1tzb3VyY2VdLmFtb3VudCA9IHNhZmVTdWIoYmFsYW5jZXNbc291cmNlXS5hbW91bnQsYW1vdW50KTsKCQliYWxhbmNlc1tzb3VyY2VdLmxhc3RVcGRhdGVkID0gbm93OwoJCWJhbGFuY2VzW3NvdXJjZV0ubmV4dEFsbG9jYXRpb25JbmRleCA9IGN1cnJlbnRBbGxvY2F0aW9ucy5sZW5ndGg7CgkJVG9rZW5CdXJuZWQoc291cmNlLGFtb3VudCk7Cgl9Cn0KCi8vKioqKioqKioqKioqKioqKiBIZWxsb0dvbGRTYWxlCgpjb250cmFjdCBIZWxsb0dvbGRTYWxlIGlzIFBhdXNhYmxlLCBTYWZlTWF0aCB7CgogIHVpbnQyNTYgcHVibGljIGRlY2ltYWxzID0gODsKCiAgdWludDI1NiBwdWJsaWMgc3RhcnREYXRlID0gMTUwMzg5MjgwMDsgICAgICAvLyBNb25kYXksIEF1Z3VzdCAyOCwgMjAxNyAxMjowMDowMCBQTSBHTVQrMDg6MDAKICB1aW50MjU2IHB1YmxpYyBlbmREYXRlICAgPSAxNTA0NDk3NjAwOyAgICAgIC8vIE1vbmRheSwgU2VwdGVtYmVyIDQsIDIwMTcgMTI6MDA6MDAgUE0gR01UKzA4OjAwCgogIHVpbnQyNTYgdHJhbmNoZVBlcmlvZCA9IDEgd2Vla3M7CgogIC8vIGFkZHJlc3Mgb2YgSEdUIFRva2VuLiBIR1QgbXVzdCBBcHByb3ZlIHRoaXMgY29udHJhY3QgdG8gZGlzYnVyc2UgMzAwTSB0b2tlbnMKICBIZWxsb0dvbGRUb2tlbiAgICAgICAgICB0b2tlbjsKCiAgdWludDI1NiBjb25zdGFudCBNYXhDb2luc1IxICAgICAgPSAxODAgKiAxMCoqNiAqIDEwKio4OyAgIC8vIDE4ME0gSEdUCiAgdWludDI1NiBwdWJsaWMgY29pbnNSZW1haW5pbmcgICAgPSAxODAgKiAxMCoqNiAqIDEwKio4OyAKICB1aW50MjU2IGNvaW5zUGVyVGllciAgICAgICAgICAgICA9ICAyMCAqIDEwKio2ICogMTAqKjg7ICAgLy8gMjBNIEhHVAogIHVpbnQyNTYgcHVibGljIGNvaW5zTGVmdEluVGllciAgID0gIDIwICogMTAqKjYgKiAxMCoqODsKCiAgdWludDI1NiBwdWJsaWMgbWluaW11bUNhcCAgICAgICAgPSAgMDsgICAvLyA0ME0gSEdUCgogIHVpbnQyNTYgbnVtVGllcnMgICAgICAgICAgICAgICAgICA9IDU7CiAgdWludDE2ICBwdWJsaWMgdGllck5vOwogIHVpbnQyNTYgcHVibGljIHByZWFsbG9jQ29pbnM7ICAgLy8gdXNlZCBmb3IgdGVzdGluZyBhZ2FpbnN0IGNhcCAoaW5jIHBsYWNlbWVudCkKICB1aW50MjU2IHB1YmxpYyBwdXJjaGFzZWRDb2luczsgIC8vIHVzZWQgZm9yIHRlc3RpbmcgYWdhaW5zdCB0aWVyIHByaWNpbmcKICB1aW50MjU2IHB1YmxpYyBldGhSYWlzZWQ7CiAgdWludDI1NiBwdWJsaWMgcGVyc29uYWxNYXggICAgICAgID0gMTAgKiAxIGV0aGVyOyAgICAgLy8gbWF4IGV0aGVyIHBlciBwZXJzb24gZHVyaW5nIHB1YmxpYyBzYWxlCiAgdWludDI1NiBwdWJsaWMgY29udHJpYnV0b3JzOwoKICBhZGRyZXNzIHB1YmxpYyBjczsKICBhZGRyZXNzIHB1YmxpYyBtdWx0aVNpZzsKICBhZGRyZXNzIHB1YmxpYyBIR1RfUmVzZXJ2ZTsKICAKICBzdHJ1Y3QgY3NBY3Rpb24gIHsKICAgICAgYm9vbCAgICAgICAgcGFzc2VkS1lDOwogICAgICBib29sICAgICAgICBibG9ja2VkOwogIH0KCiAgLyogVGhpcyBjcmVhdGVzIGFuIGFycmF5IHdpdGggYWxsIGJhbGFuY2VzICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBjc0FjdGlvbikgcHVibGljIHBlcm1pc3Npb25zOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgIHB1YmxpYyBkZXBvc2l0czsKCiAgbW9kaWZpZXIgTXVzdEJlRW5hYmxlZChhZGRyZXNzIHgpIHsKICAgICAgcmVxdWlyZSAoIXBlcm1pc3Npb25zW3hdLmJsb2NrZWQpIDsKICAgICAgcmVxdWlyZSAocGVybWlzc2lvbnNbeF0ucGFzc2VkS1lDKSA7CiAgICAgIAogICAgICBfOwogIH0KCiAgZnVuY3Rpb24gSGVsbG9Hb2xkU2FsZShhZGRyZXNzIF9jcywgYWRkcmVzcyBfaGd0LCBhZGRyZXNzIF9tdWx0aVNpZywgYWRkcmVzcyBfcmVzZXJ2ZSkgewogICAgY3MgICAgICAgICAgPSBfY3M7CiAgICB0b2tlbiAgICAgICA9IEhlbGxvR29sZFRva2VuKF9oZ3QpOwogICAgbXVsdGlTaWcgICAgPSBfbXVsdGlTaWc7CiAgICBIR1RfUmVzZXJ2ZSA9IF9yZXNlcnZlOwogIH0KCiAgLy8gV2Ugb25seSBleHBlY3QgdG8gdXNlIHRoaXMgdG8gc2V0L3Jlc2V0IHRoZSBzdGFydCBvZiB0aGUgY29udHJhY3QgdW5kZXIgZXhjZXB0aW9uYWwgY2lyY3Vtc3RhbmNlcwogIGZ1bmN0aW9uIHNldFN0YXJ0KHVpbnQyNTYgd2hlbl8pIG9ubHlPd25lciB7CiAgICAgIHN0YXJ0RGF0ZSA9IHdoZW5fOwogICAgICBlbmREYXRlID0gd2hlbl8gKyB0cmFuY2hlUGVyaW9kOwogIH0KCiAgbW9kaWZpZXIgTXVzdEJlQ3MoKSB7CiAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gY3MpIDsKICAgICAgCiAgICAgIF87CiAgfQoKCiAgLy8gMSBldGhlciA9IE4gSEdUIHRva2VucyAKICB1aW50MjU2WzVdIHB1YmxpYyBoZ3RSYXRlcyA9IFsxMjQ4OTAwMDAwMDAwLDExOTY5MDAwMDAwMDAsMTE0NDgwMDAwMDAwMCwxMDkyODAwMDAwMDAwLDEwNDA3MDAwMDAwMDBdOwogICAgICAgICAgICAgICAgICAgICAgCgogICAgLyogQXBwcm92ZSB0aGUgYWNjb3VudCBmb3Igb3BlcmF0aW9uICovCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgdXNlcikgTXVzdEJlQ3MgewogICAgICAgIHBlcm1pc3Npb25zW3VzZXJdLnBhc3NlZEtZQyA9IHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJsb2NrKGFkZHJlc3MgdXNlcikgTXVzdEJlQ3MgewogICAgICAgIHBlcm1pc3Npb25zW3VzZXJdLmJsb2NrZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVuYmxvY2soYWRkcmVzcyB1c2VyKSBNdXN0QmVDcyB7CiAgICAgICAgIHBlcm1pc3Npb25zW3VzZXJdLmJsb2NrZWQgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBuZXdDcyhhZGRyZXNzIG5ld0NzKSBvbmx5T3duZXIgewogICAgICAgIGNzID0gbmV3Q3M7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UGVyaW9kKHVpbnQyNTYgcGVyaW9kXykgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlICghZnVuZGluZygpKSA7CiAgICAgICAgdHJhbmNoZVBlcmlvZCA9IHBlcmlvZF87CiAgICAgICAgZW5kRGF0ZSA9IHN0YXJ0RGF0ZSArIHRyYW5jaGVQZXJpb2Q7CiAgICAgICAgaWYgKGVuZERhdGUgPCBub3cgKyB0cmFuY2hlUGVyaW9kKSB7CiAgICAgICAgICAgIGVuZERhdGUgPSBub3cgKyB0cmFuY2hlUGVyaW9kOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB3aGVuKCkgIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKICBmdW5jdGlvbiBmdW5kaW5nKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgeyAgICAgCiAgICBpZiAocGF1c2VkKSByZXR1cm4gZmFsc2U7ICAgICAgICAgICAgICAgLy8gZnJvemVuCiAgICBpZiAobm93IDwgc3RhcnREYXRlKSByZXR1cm4gZmFsc2U7ICAgICAgLy8gdG9vIGVhcmx5CiAgICBpZiAobm93ID4gZW5kRGF0ZSkgcmV0dXJuIGZhbHNlOyAgICAgICAgLy8gdG9vIGxhdGUKICAgIGlmIChjb2luc1JlbWFpbmluZyA9PSAwKSByZXR1cm4gZmFsc2U7ICAvLyBubyBtb3JlIGNvaW5zCiAgICBpZiAodGllck5vID49IG51bVRpZXJzICkgcmV0dXJuIGZhbHNlOyAgLy8gcGFzc2VkIGVuZCBvZiB0b3AgdGllci4gVGllcnMgc3RhcnQgYXQgemVybwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiBzdWNjZXNzKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBzdWNjZWVkZWQpIHsKICAgIGlmIChjb2luc1JlbWFpbmluZyA9PSAwKSByZXR1cm4gdHJ1ZTsKICAgIGJvb2wgY29tcGxldGUgPSAobm93ID4gZW5kRGF0ZSkgOwogICAgYm9vbCBkaWRPSyA9IChjb2luc1JlbWFpbmluZyA8PSAoTWF4Q29pbnNSMSAtIG1pbmltdW1DYXApKTsgLy8gbm90IGV2ZW4gNDBNIEdvbmU/PyBBYXJnaC4KICAgIHN1Y2NlZWRlZCA9IChjb21wbGV0ZSAmJiBkaWRPSykgIDsgIC8vIChvdXQgb2Ygc3RlYW0gYnV0IGVub3VnaCBzb2xkKSAKICAgIHJldHVybiA7CiAgfQoKICBmdW5jdGlvbiBmYWlsZWQoKSBjb25zdGFudCByZXR1cm5zIChib29sIGRpZE5vdFN1Y2NlZWQpIHsKICAgIGJvb2wgY29tcGxldGUgPSAobm93ID4gZW5kRGF0ZSAgKTsKICAgIGJvb2wgZGlkQmFkID0gKGNvaW5zUmVtYWluaW5nID4gKE1heENvaW5zUjEgLSBtaW5pbXVtQ2FwKSk7CiAgICBkaWROb3RTdWNjZWVkID0gKGNvbXBsZXRlICYmIGRpZEJhZCk7CiAgICByZXR1cm47CiAgfQoKICAKICBmdW5jdGlvbiAoKSBwYXlhYmxlIE11c3RCZUVuYWJsZWQobXNnLnNlbmRlcikgd2hlbk5vdFBhdXNlZCB7ICAgIAogICAgY3JlYXRlVG9rZW5zKG1zZy5zZW5kZXIsbXNnLnZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGxpbmtDb2luKGFkZHJlc3MgY29pbikgb25seU93bmVyIHsKICAgIHRva2VuID0gSGVsbG9Hb2xkVG9rZW4oY29pbik7CiAgfQoKICBmdW5jdGlvbiBjb2luQWRkcmVzcygpIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgcmV0dXJuIGFkZHJlc3ModG9rZW4pOwogIH0KCiAgLy8gaGd0UmF0ZXMgaW4gd2hvbGUgdG9rZW5zIHBlciBFVEgKICAvLyBtYXggaW5kaXZpZHVhbCBjb250cmlidXRpb24gaW4gd2hvbGUgRVRICiAgZnVuY3Rpb24gc2V0SGd0UmF0ZXModWludDI1NiBwMCx1aW50MjU2IHAxLHVpbnQyNTYgcDIsdWludDI1NiBwMyx1aW50MjU2IHA0LCB1aW50MjU2IF9tYXggKSBvbmx5T3duZXIgewogICAgICAgICAgICAgIHJlcXVpcmUgKG5vdyA8IHN0YXJ0RGF0ZSkgOwogICAgICAgICAgICAgIGhndFJhdGVzWzBdICAgPSBwMCAqIDEwKio4OwogICAgICAgICAgICAgIGhndFJhdGVzWzFdICAgPSBwMSAqIDEwKio4OwogICAgICAgICAgICAgIGhndFJhdGVzWzJdICAgPSBwMiAqIDEwKio4OwogICAgICAgICAgICAgIGhndFJhdGVzWzNdICAgPSBwMyAqIDEwKio4OwogICAgICAgICAgICAgIGhndFJhdGVzWzRdICAgPSBwNCAqIDEwKio4OwogICAgICAgICAgICAgIHBlcnNvbmFsTWF4ID0gX21heCAqIDEgZXRoZXI7ICAgICAgICAgICAvLyBtYXggRVRIIHBlciBwZXJzb24KICB9CgogIAogIGV2ZW50IFB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiBsZXZlbCx1aW50MjU2IHZhbHVlLCB1aW50MjU2IHRva2Vucyk7CiAgZXZlbnQgUmVkdWN0aW9uKHN0cmluZyBtc2csIGFkZHJlc3MgaW5kZXhlZCBidXllciwgdWludDI1NiB3YW50ZWQsIHVpbnQyNTYgYWxsb2NhdGVkKTsKICAKICBmdW5jdGlvbiBjcmVhdGVUb2tlbnMoYWRkcmVzcyByZWNpcGllbnQsIHVpbnQyNTYgdmFsdWUpIHByaXZhdGUgewogICAgdWludDI1NiB0b3RhbFRva2VuczsKICAgIHVpbnQyNTYgaGd0UmF0ZTsKICAgIHJlcXVpcmUgKGZ1bmRpbmcoKSkgOwogICAgcmVxdWlyZSAodmFsdWUgPiAxIGZpbm5leSkgOwogICAgcmVxdWlyZSAoZGVwb3NpdHNbcmVjaXBpZW50XSA8IHBlcnNvbmFsTWF4KTsKCiAgICB1aW50MjU2IG1heFJlZnVuZCA9IDA7CiAgICBpZiAoKGRlcG9zaXRzW21zZy5zZW5kZXJdICsgdmFsdWUpID4gcGVyc29uYWxNYXgpIHsKICAgICAgICBtYXhSZWZ1bmQgPSBkZXBvc2l0c1ttc2cuc2VuZGVyXSArIHZhbHVlIC0gcGVyc29uYWxNYXg7CiAgICAgICAgdmFsdWUgLT0gbWF4UmVmdW5kOwogICAgICAgIGxvZzAoIm1heGltdW0gZnVuZHMgZXhjZWVkZWQiKTsKICAgIH0gIAoKICAgIHVpbnQyNTYgdmFsID0gdmFsdWU7CgogICAgZXRoUmFpc2VkID0gc2FmZUFkZChldGhSYWlzZWQsdmFsdWUpOwogICAgaWYgKGRlcG9zaXRzW3JlY2lwaWVudF0gPT0gMCkgY29udHJpYnV0b3JzKys7CiAgICAKICAgIAogICAgZG8gewogICAgICBoZ3RSYXRlID0gaGd0UmF0ZXNbdGllck5vXTsgICAgICAgICAgICAgICAgIC8vIGhndFJhdGUgbXVzdCBpbmNsdWRlIHRoZSAxMF44CiAgICAgIHVpbnQgdG9rZW5zID0gc2FmZU11bCh2YWwsIGhndFJhdGUpOyAgICAgIC8vICh2YWwgaW4gZXRoICogMTBeMTgpICogI3Rva2VucyBwZXIgZXRoCiAgICAgIHRva2VucyA9IHNhZmVEaXYodG9rZW5zLCAxIGV0aGVyKTsgICAgICAvLyB2YWwgaXMgaW4gZXRoZXIsIG1zZy52YWx1ZSBpcyBpbiB3ZWkKICAgCiAgICAgIGlmICh0b2tlbnMgPD0gY29pbnNMZWZ0SW5UaWVyKSB7CiAgICAgICAgdWludDI1NiBhY3R1YWxUb2tlbnMgPSB0b2tlbnM7CiAgICAgICAgdWludCByZWZ1bmQgPSAwOwogICAgICAgIGlmICh0b2tlbnMgPiBjb2luc1JlbWFpbmluZykgeyAvL2Nhbid0IHNlbGwgZGVzaXJlZCAjIHRva2VucwogICAgICAgICAgICBSZWR1Y3Rpb24oImluIHRpZXIiLHJlY2lwaWVudCx0b2tlbnMsY29pbnNSZW1haW5pbmcpOwogICAgICAgICAgICBhY3R1YWxUb2tlbnMgPSBjb2luc1JlbWFpbmluZzsKICAgICAgICAgICAgcmVmdW5kID0gc2FmZVN1Yih0b2tlbnMsIGNvaW5zUmVtYWluaW5nICk7IC8vIHJlZnVuZCBhbW91bnQgaW4gdG9rZW5zCiAgICAgICAgICAgIHJlZnVuZCA9IHNhZmVEaXYocmVmdW5kKjEgZXRoZXIsaGd0UmF0ZSApOyAgLy8gcmVmdW5kIGFtb3VudCBpbiBFVEgKICAgICAgICAgICAgLy8gbmVlZCBhIHJlZnVuZCBtZWNoYW5pc20gaGVyZSB0b28KICAgICAgICAgICAgY29pbnNSZW1haW5pbmcgPSAwOwogICAgICAgICAgICB2YWwgPSBzYWZlU3ViKCB2YWwscmVmdW5kKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb2luc1JlbWFpbmluZyAgPSBzYWZlU3ViKGNvaW5zUmVtYWluaW5nLCAgYWN0dWFsVG9rZW5zKTsKICAgICAgICB9CiAgICAgICAgcHVyY2hhc2VkQ29pbnMgID0gc2FmZUFkZChwdXJjaGFzZWRDb2lucywgYWN0dWFsVG9rZW5zKTsKCiAgICAgICAgdG90YWxUb2tlbnMgPSBzYWZlQWRkKHRvdGFsVG9rZW5zLGFjdHVhbFRva2Vucyk7CgogICAgICAgIHJlcXVpcmUgKHRva2VuLnRyYW5zZmVyRnJvbShIR1RfUmVzZXJ2ZSwgcmVjaXBpZW50LHRvdGFsVG9rZW5zKSkgOwoKICAgICAgICBQdXJjaGFzZShyZWNpcGllbnQsdGllck5vLHZhbCxhY3R1YWxUb2tlbnMpOyAvLyBldmVudAoKICAgICAgICBkZXBvc2l0c1tyZWNpcGllbnRdID0gc2FmZUFkZChkZXBvc2l0c1tyZWNpcGllbnRdLHZhbCk7IC8vIGluIGNhc2Ugb2YgcmVmdW5kIC0gY291bGQgcHVsbCBvZmYgZXRoZXJzY2FuCiAgICAgICAgcmVmdW5kICs9IG1heFJlZnVuZDsKICAgICAgICBpZiAocmVmdW5kID4gMCkgewogICAgICAgICAgICBldGhSYWlzZWQgPSBzYWZlU3ViKGV0aFJhaXNlZCxyZWZ1bmQpOwogICAgICAgICAgICByZWNpcGllbnQudHJhbnNmZXIocmVmdW5kKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvaW5zUmVtYWluaW5nIDw9IChNYXhDb2luc1IxIC0gbWluaW11bUNhcCkpeyAvLyBoYXMgcGFzc2VkIHN1Y2Nlc3MgY3JpdGVyaWEKICAgICAgICAgICAgaWYgKCFtdWx0aVNpZy5zZW5kKHRoaXMuYmFsYW5jZSkpIHsgICAgICAgICAgICAgICAgLy8gc2VuZCBmdW5kcyB0byBIR0YKICAgICAgICAgICAgICAgIGxvZzAoImNhbm5vdCBmb3J3YXJkIGZ1bmRzIHRvIG93bmVyIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29pbnNMZWZ0SW5UaWVyID0gc2FmZVN1Yihjb2luc0xlZnRJblRpZXIsYWN0dWFsVG9rZW5zKTsKICAgICAgICBpZiAoKGNvaW5zTGVmdEluVGllciA9PSAwKSAmJiAoY29pbnNSZW1haW5pbmcgIT0gMCkpIHsgLy8gZXhhY3Qgc2VsbCBvdXQgb2Ygbm9uIGZpbmFsIHRpZXIKICAgICAgICAgICAgY29pbnNMZWZ0SW5UaWVyID0gY29pbnNQZXJUaWVyOwogICAgICAgICAgICB0aWVyTm8rKzsKICAgICAgICAgICAgZW5kRGF0ZSA9IG5vdyArIHRyYW5jaGVQZXJpb2Q7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAvLyBjaGVjayB0aGF0IGNvaW5zTGVmdEluVGllciA+PSBjb2luc1JlbWFpbmluZwoKICAgICAgdWludDI1NiBjb2luczJidXkgPSBtaW4yNTYoY29pbnNMZWZ0SW5UaWVyICwgY29pbnNSZW1haW5pbmcpOyAKCiAgICAgIGVuZERhdGUgPSBzYWZlQWRkKCBub3csIHRyYW5jaGVQZXJpb2QpOwogICAgICAvLyBIYXZlIGJ1bXBlZCBsZXZlbHMgLSBuZWVkIHRvIG1vZGlmeSBlbmQgZGF0ZSBoZXJlCiAgICAgIHB1cmNoYXNlZENvaW5zID0gc2FmZUFkZChwdXJjaGFzZWRDb2lucywgY29pbnMyYnV5KTsgIC8vIGdpdmUgYWxsIGNvaW5zIHJlbWFpbmluZyBpbiB0aGlzIHRpZXIKICAgICAgdG90YWxUb2tlbnMgICAgPSBzYWZlQWRkKHRvdGFsVG9rZW5zLGNvaW5zMmJ1eSk7CiAgICAgIGNvaW5zUmVtYWluaW5nID0gc2FmZVN1Yihjb2luc1JlbWFpbmluZyxjb2luczJidXkpOwoKICAgICAgdWludCB3ZWlDb2luc0xlZnRJblRoaXNUaWVyID0gc2FmZU11bChjb2luczJidXksMSBldGhlcik7CiAgICAgIHVpbnQgY29zdE9mVGhlc2VDb2lucyA9IHNhZmVEaXYod2VpQ29pbnNMZWZ0SW5UaGlzVGllciwgaGd0UmF0ZSk7ICAvLyBob3cgbXVjaCBkaWQgdGhhdCBjb3N0PwoKICAgICAgUHVyY2hhc2UocmVjaXBpZW50LCB0aWVyTm8sY29zdE9mVGhlc2VDb2lucyxjb2luczJidXkpOyAvLyBldmVudAoKICAgICAgZGVwb3NpdHNbcmVjaXBpZW50XSA9IHNhZmVBZGQoZGVwb3NpdHNbcmVjaXBpZW50XSxjb3N0T2ZUaGVzZUNvaW5zKTsKICAgICAgdmFsICAgID0gc2FmZVN1Yih2YWwsY29zdE9mVGhlc2VDb2lucyk7CiAgICAgIHRpZXJObyA9IHRpZXJObyArIDE7CiAgICAgIGNvaW5zTGVmdEluVGllciA9IGNvaW5zUGVyVGllcjsKICAgIH0gd2hpbGUgKCh2YWwgPiAwKSAmJiBmdW5kaW5nKCkpOwoKICAgIC8vIGVzY2FwZWQgYmVjYXVzZSB3ZSBwYXNzZWQgdGhlIGVuZCBvZiB0aGUgdW5pdmVyc2UuLi4uLgogICAgLy8gc28gZ2l2ZSB0aGVtIHRoZWlyIHRva2VucwogICAgcmVxdWlyZSAodG9rZW4udHJhbnNmZXJGcm9tKEhHVF9SZXNlcnZlLCByZWNpcGllbnQsdG90YWxUb2tlbnMpKSA7CgogICAgaWYgKCh2YWwgPiAwKSB8fCAobWF4UmVmdW5kID4gMCkpewogICAgICAgIFJlZHVjdGlvbigiZmluaXNoZWQgY3Jvd2RzYWxlLCByZXR1cm5pbmcgIixyZWNpcGllbnQsdmFsdWUsdG90YWxUb2tlbnMpOwogICAgICAgIC8vIHJldHVybiB0aGUgcmVtYWluZGVyICEKICAgICAgICByZWNpcGllbnQudHJhbnNmZXIodmFsK21heFJlZnVuZCk7IC8vIGlmIHlvdSBjYW4ndCByZXR1cm4gdGhlIGJhbGFuY2UsIGFib3J0IHdob2xlIHByb2Nlc3MKICAgIH0KICAgIGlmICghbXVsdGlTaWcuc2VuZCh0aGlzLmJhbGFuY2UpKSB7CiAgICAgICAgZXRoUmFpc2VkID0gc2FmZVN1YihldGhSYWlzZWQsdGhpcy5iYWxhbmNlKTsKICAgICAgICBsb2cwKCJjYW5ub3Qgc2VuZCBhdCB0aWVyIGp1bXAiKTsKICAgIH0KICB9CiAgCiAgZnVuY3Rpb24gYWxsb2NhdGVkVG9rZW5zKGFkZHJlc3MgZ3JhbnRlZSwgdWludDI1NiBudW1Ub2tlbnMpIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChub3cgPCBzdGFydERhdGUpIDsKICAgIGlmIChudW1Ub2tlbnMgPCBjb2luc1JlbWFpbmluZykgewogICAgICAgIGNvaW5zUmVtYWluaW5nID0gc2FmZVN1Yihjb2luc1JlbWFpbmluZywgbnVtVG9rZW5zKTsKICAgICAgIAogICAgfSBlbHNlIHsKICAgICAgICBudW1Ub2tlbnMgPSBjb2luc1JlbWFpbmluZzsKICAgICAgICBjb2luc1JlbWFpbmluZyA9IDA7CiAgICB9CiAgICBwcmVhbGxvY0NvaW5zID0gc2FmZUFkZChwcmVhbGxvY0NvaW5zLG51bVRva2Vucyk7CiAgICByZXF1aXJlICh0b2tlbi50cmFuc2ZlckZyb20oSEdUX1Jlc2VydmUsZ3JhbnRlZSxudW1Ub2tlbnMpKTsKICB9CgogIGZ1bmN0aW9uIHdpdGhkcmF3KCkgeyAvLyBpdCBmYWlsZWQuIENvbWUgYW5kIGdldCB5b3VyIGV0aGVyLgogICAgICBpZiAoZmFpbGVkKCkpIHsKICAgICAgICAgIGlmIChkZXBvc2l0c1ttc2cuc2VuZGVyXSA+IDApIHsKICAgICAgICAgICAgICB1aW50MjU2IHZhbCA9IGRlcG9zaXRzW21zZy5zZW5kZXJdOwogICAgICAgICAgICAgIGRlcG9zaXRzW21zZy5zZW5kZXJdID0gMDsKICAgICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHZhbCk7CiAgICAgICAgICB9CiAgICAgIH0KICB9CgogIGZ1bmN0aW9uIGNvbXBsZXRlKCkgb25seU93bmVyIHsgIC8vIHRoaXMgc2hvdWxkIG5vdCBoYXZlIHRvIGJlIGNhbGxlZC4gRXh0cmVtZSBtZWFzdXJlcy4KICAgICAgaWYgKHN1Y2Nlc3MoKSkgewogICAgICAgICAgdWludDI1NiB2YWwgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAgICBpZiAodmFsID4gMCkgewogICAgICAgICAgICBpZiAoIW11bHRpU2lnLnNlbmQodmFsKSkgewogICAgICAgICAgICAgICAgbG9nMCgiY2Fubm90IHdpdGhkcmF3Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2cwKCJmdW5kcyB3aXRoZHJhd24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBsb2cwKCJub3RoaW5nIHRvIHdpdGhkcmF3Iik7CiAgICAgICAgICB9CiAgICAgIH0KICB9Cgp9'.
	

]
