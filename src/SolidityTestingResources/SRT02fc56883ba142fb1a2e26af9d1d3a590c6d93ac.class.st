Class {
	#name : #SRT02fc56883ba142fb1a2e26af9d1d3a590c6d93ac,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT02fc56883ba142fb1a2e26af9d1d3a590c6d93ac >> base64 [
	^ 'Ly8gQ3JlYXRlZCB1c2luZyBJQ08gV2l6YXJkIGh0dHBzOi8vZ2l0aHViLmNvbS9vcmFjbGVzb3JnL2ljby13aXphcmQgYnkgT3JhY2xlcyBOZXR3b3JrIApwcmFnbWEgc29saWRpdHkgXjAuNC4xMTsKLyoqCiAqIEB0aXRsZSBFUkMyMEJhc2ljCiAqIEBkZXYgU2ltcGxlciB2ZXJzaW9uIG9mIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTc5CiAqLwpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIFNhZmUgdW5zaWduZWQgc2FmZSBtYXRoLgogKgogKiBodHRwczovL2Jsb2cuYXJhZ29uLm9uZS9saWJyYXJ5LWRyaXZlbi1kZXZlbG9wbWVudC1pbi1zb2xpZGl0eS0yYmViY2FmODg3MzYjLjc1MGd3dHdsaQogKgogKiBPcmlnaW5hbGx5IGZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0FyYWdvbk9uZS96ZXBwZWxpbi1zb2xpZGl0eS9tYXN0ZXIvY29udHJhY3RzL1NhZmVNYXRoTGliLnNvbAogKgogKiBNYWludGFpbmVkIGhlcmUgdW50aWwgbWVyZ2VkIHRvIG1haW5saW5lIHplcHBlbGluLXNvbGlkaXR5LgogKgogKi8KbGlicmFyeSBTYWZlTWF0aExpYkV4dCB7CiAgZnVuY3Rpb24gdGltZXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KICBmdW5jdGlvbiBkaXZpZGVzKHVpbnQgYSwgdWludCBiKSByZXR1cm5zICh1aW50KSB7CiAgICBhc3NlcnQoYiA+IDApOwogICAgdWludCBjID0gYSAvIGI7CiAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgIHJldHVybiBjOwogIH0KICBmdW5jdGlvbiBtaW51cyh1aW50IGEsIHVpbnQgYikgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQogIGZ1bmN0aW9uIHBsdXModWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGM+PWEpOwogICAgcmV0dXJuIGM7CiAgfQp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIFRoaXMgc21hcnQgY29udHJhY3QgY29kZSBpcyBDb3B5cmlnaHQgMjAxNyBUb2tlbk1hcmtldCBMdGQuIEZvciBtb3JlIGluZm9ybWF0aW9uIHNlZSBodHRwczovL3Rva2VubWFya2V0Lm5ldAogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIHZlcnNpb24gMi4wOiBodHRwczovL2dpdGh1Yi5jb20vVG9rZW5NYXJrZXROZXQvaWNvL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0CiAqLwovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCi8qCiAqIEhhbHRhYmxlCiAqCiAqIEFic3RyYWN0IGNvbnRyYWN0IHRoYXQgYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbgogKiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uIERpZmZlcnMgZnJvbSBQYXVzYWJsZSBieSBjYXVzaW5nIGEgdGhyb3cgd2hlbiBpbiBoYWx0IG1vZGUuCiAqCiAqCiAqIE9yaWdpbmFsbHkgZW52aXNpb25lZCBpbiBGaXJzdEJsb29kIElDTyBjb250cmFjdC4KICovCmNvbnRyYWN0IEhhbHRhYmxlIGlzIE93bmFibGUgewogIGJvb2wgcHVibGljIGhhbHRlZDsKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KICBtb2RpZmllciBzdG9wTm9uT3duZXJzSW5FbWVyZ2VuY3kgewogICAgaWYgKGhhbHRlZCAmJiBtc2cuc2VuZGVyICE9IG93bmVyKSB0aHJvdzsKICAgIF87CiAgfQogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBpZiAoIWhhbHRlZCkgdGhyb3c7CiAgICBfOwogIH0KICAvLyBjYWxsZWQgYnkgdGhlIG93bmVyIG9uIGVtZXJnZW5jeSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogIGZ1bmN0aW9uIGhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgaGFsdGVkID0gdHJ1ZTsKICB9CiAgLy8gY2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbmQgb2YgZW1lcmdlbmN5LCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogIGZ1bmN0aW9uIHVuaGFsdCgpIGV4dGVybmFsIG9ubHlPd25lciBvbmx5SW5FbWVyZ2VuY3kgewogICAgaGFsdGVkID0gZmFsc2U7CiAgfQp9Ci8qKgogKiBUaGlzIHNtYXJ0IGNvbnRyYWN0IGNvZGUgaXMgQ29weXJpZ2h0IDIwMTcgVG9rZW5NYXJrZXQgTHRkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBzZWUgaHR0cHM6Ly90b2tlbm1hcmtldC5uZXQKICoKICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCB2ZXJzaW9uIDIuMDogaHR0cHM6Ly9naXRodWIuY29tL1Rva2VuTWFya2V0TmV0L2ljby9ibG9iL21hc3Rlci9MSUNFTlNFLnR4dAogKi8KLyoqCiAqIEZpbmFsaXplIGFnZW50IGRlZmluZXMgd2hhdCBoYXBwZW5zIGF0IHRoZSBlbmQgb2Ygc3VjY2VzZWZ1bCBjcm93ZHNhbGUuCiAqCiAqIC0gQWxsb2NhdGUgdG9rZW5zIGZvciBmb3VuZGVycywgYm91bnRpZXMgYW5kIGNvbW11bml0eQogKiAtIE1ha2UgdG9rZW5zIHRyYW5zZmVyYWJsZQogKiAtIGV0Yy4KICovCmNvbnRyYWN0IEZpbmFsaXplQWdlbnQgewogIGZ1bmN0aW9uIGlzRmluYWxpemVBZ2VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICAvKiogUmV0dXJuIHRydWUgaWYgd2UgY2FuIHJ1biBmaW5hbGl6ZUNyb3dkc2FsZSgpIHByb3Blcmx5LgogICAqCiAgICogVGhpcyBpcyBhIHNhZmV0eSBjaGVjayBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgYWxsb3cgY3Jvd2RzYWxlIHRvIGJlZ2luCiAgICogdW5sZXNzIHRoZSBmaW5hbGl6ZXIgaGFzIGJlZW4gc2V0IHVwIHByb3Blcmx5LgogICAqLwogIGZ1bmN0aW9uIGlzU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKICAvKiogQ2FsbGVkIG9uY2UgYnkgY3Jvd2RzYWxlIGZpbmFsaXplKCkgaWYgdGhlIHNhbGUgd2FzIHN1Y2Nlc3MuICovCiAgZnVuY3Rpb24gZmluYWxpemVDcm93ZHNhbGUoKTsKfQovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Ci8qKgogKiBBIHRva2VuIHRoYXQgZGVmaW5lcyBmcmFjdGlvbmFsIHVuaXRzIGFzIGRlY2ltYWxzLgogKi8KY29udHJhY3QgRnJhY3Rpb25hbEVSQzIwRXh0IGlzIEVSQzIwIHsKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKICB1aW50IHB1YmxpYyBtaW5DYXA7Cn0KLyoqCiAqIEFic3RyYWN0IGJhc2UgY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKgogKiBIYW5kbGUKICogLSBzdGFydCBhbmQgZW5kIGRhdGVzCiAqIC0gYWNjZXB0aW5nIGludmVzdG1lbnRzCiAqIC0gbWluaW11bSBmdW5kaW5nIGdvYWwgYW5kIHJlZnVuZAogKiAtIHZhcmlvdXMgc3RhdGlzdGljcyBkdXJpbmcgdGhlIGNyb3dkZnVuZAogKiAtIGRpZmZlcmVudCBwcmljaW5nIHN0cmF0ZWdpZXMKICogLSBkaWZmZXJlbnQgaW52ZXN0bWVudCBwb2xpY2llcyAocmVxdWlyZSBzZXJ2ZXIgc2lkZSBjdXN0b21lciBpZCwgYWxsb3cgb25seSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMpCiAqCiAqLwpjb250cmFjdCBDcm93ZHNhbGVFeHQgaXMgSGFsdGFibGUgewogIC8qIE1heCBpbnZlc3RtZW50IGNvdW50IHdoZW4gd2UgYXJlIHN0aWxsIGFsbG93ZWQgdG8gY2hhbmdlIHRoZSBtdWx0aXNpZyBhZGRyZXNzICovCiAgdWludCBwdWJsaWMgTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UgPSA1OwogIHVzaW5nIFNhZmVNYXRoTGliRXh0IGZvciB1aW50OwogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIEZyYWN0aW9uYWxFUkMyMEV4dCBwdWJsaWMgdG9rZW47CiAgLyogSG93IHdlIGFyZSBnb2luZyB0byBwcmljZSBvdXIgb2ZmZXJpbmcgKi8KICBQcmljaW5nU3RyYXRlZ3kgcHVibGljIHByaWNpbmdTdHJhdGVneTsKICAvKiBQb3N0LXN1Y2Nlc3MgY2FsbGJhY2sgKi8KICBGaW5hbGl6ZUFnZW50IHB1YmxpYyBmaW5hbGl6ZUFnZW50OwogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKICAvKiBpZiB0aGUgZnVuZGluZyBnb2FsIGlzIG5vdCByZWFjaGVkLCBpbnZlc3RvcnMgbWF5IHdpdGhkcmF3IHRoZWlyIGZ1bmRzICovCiAgdWludCBwdWJsaWMgbWluaW11bUZ1bmRpbmdHb2FsOwogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBzdGFydCBkYXRlIG9mIHRoZSBjcm93ZHNhbGUgKi8KICB1aW50IHB1YmxpYyBzdGFydHNBdDsKICAvKiB0aGUgVU5JWCB0aW1lc3RhbXAgZW5kIGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIGVuZHNBdDsKICAvKiB0aGUgbnVtYmVyIG9mIHRva2VucyBhbHJlYWR5IHNvbGQgdGhyb3VnaCB0aGlzIGNvbnRyYWN0Ki8KICB1aW50IHB1YmxpYyB0b2tlbnNTb2xkID0gMDsKICAvKiBIb3cgbWFueSB3ZWkgb2YgZnVuZGluZyB3ZSBoYXZlIHJhaXNlZCAqLwogIHVpbnQgcHVibGljIHdlaVJhaXNlZCA9IDA7CiAgLyogQ2FsY3VsYXRlIGluY29taW5nIGZ1bmRzIGZyb20gcHJlc2FsZSBjb250cmFjdHMgYW5kIGFkZHJlc3NlcyAqLwogIHVpbnQgcHVibGljIHByZXNhbGVXZWlSYWlzZWQgPSAwOwogIC8qIEhvdyBtYW55IGRpc3RpbmN0IGFkZHJlc3NlcyBoYXZlIGludmVzdGVkICovCiAgdWludCBwdWJsaWMgaW52ZXN0b3JDb3VudCA9IDA7CiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgcmV0dXJuZWQgYmFjayB0byB0aGUgY29udHJhY3QgYWZ0ZXIgYSBmYWlsZWQgY3Jvd2RmdW5kLiAqLwogIHVpbnQgcHVibGljIGxvYWRlZFJlZnVuZCA9IDA7CiAgLyogSG93IG11Y2ggd2VpIHdlIGhhdmUgZ2l2ZW4gYmFjayB0byBpbnZlc3RvcnMuKi8KICB1aW50IHB1YmxpYyB3ZWlSZWZ1bmRlZCA9IDA7CiAgLyogSGFzIHRoaXMgY3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkICovCiAgYm9vbCBwdWJsaWMgZmluYWxpemVkOwogIC8qIERvIHdlIG5lZWQgdG8gaGF2ZSB1bmlxdWUgY29udHJpYnV0b3IgaWQgZm9yIGVhY2ggY3VzdG9tZXIgKi8KICBib29sIHB1YmxpYyByZXF1aXJlQ3VzdG9tZXJJZDsKICBib29sIHB1YmxpYyBpc1doaXRlTGlzdGVkOwogIGFkZHJlc3NbXSBwdWJsaWMgam9pbmVkQ3Jvd2RzYWxlczsKICB1aW50IHB1YmxpYyBqb2luZWRDcm93ZHNhbGVzTGVuID0gMDsKICBhZGRyZXNzIHB1YmxpYyBsYXN0Q3Jvd2RzYWxlOwogIC8qKgogICAgKiBEbyB3ZSB2ZXJpZnkgdGhhdCBjb250cmlidXRvciBoYXMgYmVlbiBjbGVhcmVkIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWNjcmVkaXRlZCBpbnZlc3RvcnMgb25seSkuCiAgICAqIFRoaXMgbWV0aG9kIHdhcyBmaXJzdCB1c2VkIGluIEZpcnN0Qmxvb2QgY3Jvd2RzYWxlIHRvIGVuc3VyZSBhbGwgY29udHJpYnV0b3JzIGhhdmUgYWNjZXB0ZWQgdGVybXMgb24gc2FsZSAob24gdGhlIHdlYikuCiAgICAqLwogIGJvb2wgcHVibGljIHJlcXVpcmVkU2lnbmVkQWRkcmVzczsKICAvKiBTZXJ2ZXIgc2lkZSBhZGRyZXNzIHRoYXQgc2lnbmVkIGFsbG93ZWQgY29udHJpYnV0b3JzIChFdGhlcmV1bSBhZGRyZXNzZXMpIHRoYXQgY2FuIHBhcnRpY2lwYXRlIHRoZSBjcm93ZHNhbGUgKi8KICBhZGRyZXNzIHB1YmxpYyBzaWduZXJBZGRyZXNzOwogIC8qKiBIb3cgbXVjaCBFVEggZWFjaCBhZGRyZXNzIGhhcyBpbnZlc3RlZCB0byB0aGlzIGNyb3dkc2FsZSAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGludmVzdGVkQW1vdW50T2Y7CiAgLyoqIEhvdyBtdWNoIHRva2VucyB0aGlzIGNyb3dkc2FsZSBoYXMgY3JlZGl0ZWQgZm9yIGVhY2ggaW52ZXN0b3IgYWRkcmVzcyAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHRva2VuQW1vdW50T2Y7CiAgc3RydWN0IFdoaXRlTGlzdERhdGEgewogICAgYm9vbCBzdGF0dXM7CiAgICB1aW50IG1pbkNhcDsKICAgIHVpbnQgbWF4Q2FwOwogIH0KICAvL2lzIGNyb3dkc2FsZSB1cGRhdGFibGUKICBib29sIHB1YmxpYyBpc1VwZGF0YWJsZTsKICAvKiogQWRkcmVzc2VzIHRoYXQgYXJlIGFsbG93ZWQgdG8gaW52ZXN0IGV2ZW4gYmVmb3JlIElDTyBvZmZpY2FsIG9wZW5zLiBGb3IgdGVzdGluZywgZm9yIElDTyBwYXJ0bmVycywgZXRjLiAqLwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gV2hpdGVMaXN0RGF0YSkgcHVibGljIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3Q7CiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVsIHRlc3RpbmcgZm9yIHRoZSBpbnRlcmFjdGlvbiBmcm9tIG93bmVyIHdhbGxldC4gWW91IGNhbiBzZXQgaXQgdG8gYW55IHZhbHVlIGFuZCBpbnNwZWN0IHRoaXMgaW4gYmxvY2tjaGFpbiBleHBsb3JlciB0byBzZWUgdGhhdCBjcm93ZHNhbGUgaW50ZXJhY3Rpb24gd29ya3MuICovCiAgdWludCBwdWJsaWMgb3duZXJUZXN0VmFsdWU7CiAgLyoqIFN0YXRlIG1hY2hpbmUKICAgKgogICAqIC0gUHJlcGFyaW5nOiBBbGwgY29udHJhY3QgaW5pdGlhbGl6YXRpb24gY2FsbHMgYW5kIHZhcmlhYmxlcyBoYXZlIG5vdCBiZWVuIHNldCB5ZXQKICAgKiAtIFByZWZ1bmRpbmc6IFdlIGhhdmUgbm90IHBhc3NlZCBzdGFydCB0aW1lIHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZAogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqIC0gUmVmdW5kaW5nOiBSZWZ1bmRzIGFyZSBsb2FkZWQgb24gdGhlIGNvbnRyYWN0IGZvciByZWNsYWltLgogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBQcmVGdW5kaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWQsIFJlZnVuZGluZ30KICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQxMjggY3VzdG9tZXJJZCk7CiAgLy8gUmVmdW5kIHdhcyBwcm9jZXNzZWQgZm9yIGEgY29udHJpYnV0b3IKICBldmVudCBSZWZ1bmQoYWRkcmVzcyBpbnZlc3RvciwgdWludCB3ZWlBbW91bnQpOwogIC8vIFRoZSBydWxlcyB3ZXJlIGNoYW5nZWQgd2hhdCBraW5kIG9mIGludmVzdG1lbnRzIHdlIGFjY2VwdAogIGV2ZW50IEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKGJvb2wgbmV3UmVxdWlyZUN1c3RvbWVySWQsIGJvb2wgbmV3UmVxdWlyZWRTaWduZWRBZGRyZXNzLCBhZGRyZXNzIG5ld1NpZ25lckFkZHJlc3MpOwogIC8vIEFkZHJlc3MgZWFybHkgcGFydGljaXBhdGlvbiB3aGl0ZWxpc3Qgc3RhdHVzIGNoYW5nZWQKICBldmVudCBXaGl0ZWxpc3RlZChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzKTsKICAvLyBDcm93ZHNhbGUgc3RhcnQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgU3RhcnRzQXRDaGFuZ2VkKHVpbnQgbmV3U3RhcnRzQXQpOwogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IG5ld0VuZHNBdCk7CiAgZnVuY3Rpb24gQ3Jvd2RzYWxlRXh0KGFkZHJlc3MgX3Rva2VuLCBQcmljaW5nU3RyYXRlZ3kgX3ByaWNpbmdTdHJhdGVneSwgYWRkcmVzcyBfbXVsdGlzaWdXYWxsZXQsIHVpbnQgX3N0YXJ0LCB1aW50IF9lbmQsIHVpbnQgX21pbmltdW1GdW5kaW5nR29hbCwgYm9vbCBfaXNVcGRhdGFibGUsIGJvb2wgX2lzV2hpdGVMaXN0ZWQpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIHRva2VuID0gRnJhY3Rpb25hbEVSQzIwRXh0KF90b2tlbik7CiAgICBzZXRQcmljaW5nU3RyYXRlZ3koX3ByaWNpbmdTdHJhdGVneSk7CiAgICBtdWx0aXNpZ1dhbGxldCA9IF9tdWx0aXNpZ1dhbGxldDsKICAgIGlmKG11bHRpc2lnV2FsbGV0ID09IDApIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIGlmKF9zdGFydCA9PSAwKSB7CiAgICAgICAgdGhyb3c7CiAgICB9CiAgICBzdGFydHNBdCA9IF9zdGFydDsKICAgIGlmKF9lbmQgPT0gMCkgewogICAgICAgIHRocm93OwogICAgfQogICAgZW5kc0F0ID0gX2VuZDsKICAgIC8vIERvbid0IG1lc3MgdGhlIGRhdGVzCiAgICBpZihzdGFydHNBdCA+PSBlbmRzQXQpIHsKICAgICAgICB0aHJvdzsKICAgIH0KICAgIC8vIE1pbmltdW0gZnVuZGluZyBnb2FsIGNhbiBiZSB6ZXJvCiAgICBtaW5pbXVtRnVuZGluZ0dvYWwgPSBfbWluaW11bUZ1bmRpbmdHb2FsOwogICAgaXNVcGRhdGFibGUgPSBfaXNVcGRhdGFibGU7CiAgICBpc1doaXRlTGlzdGVkID0gX2lzV2hpdGVMaXN0ZWQ7CiAgfQogIC8qKgogICAqIERvbid0IGV4cGVjdCB0byBqdXN0IHNlbmQgaW4gbW9uZXkgYW5kIGdldCB0b2tlbnMuCiAgICovCiAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgIHRocm93OwogIH0KICAvKioKICAgKiBNYWtlIGFuIGludmVzdG1lbnQuCiAgICoKICAgKiBDcm93ZHNhbGUgbXVzdCBiZSBydW5uaW5nIGZvciBvbmUgdG8gaW52ZXN0LgogICAqIFdlIG11c3QgaGF2ZSBub3QgcHJlc3NlZCB0aGUgZW1lcmdlbmN5IGJyYWtlLgogICAqCiAgICogQHBhcmFtIHJlY2VpdmVyIFRoZSBFdGhlcmV1bSBhZGRyZXNzIHdobyByZWNlaXZlcyB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGN1c3RvbWVySWQgKG9wdGlvbmFsKSBVVUlEIHY0IHRvIHRyYWNrIHRoZSBzdWNjZXNzZnVsIHBheW1lbnRzIG9uIHRoZSBzZXJ2ZXIgc2lkZQogICAqCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlciwgdWludDEyOCBjdXN0b21lcklkKSBzdG9wSW5FbWVyZ2VuY3kgcHJpdmF0ZSB7CiAgICAvLyBEZXRlcm1pbmUgaWYgaXQncyBhIGdvb2QgdGltZSB0byBhY2NlcHQgaW52ZXN0bWVudCBmcm9tIHRoaXMgcGFydGljaXBhbnQKICAgIGlmKGdldFN0YXRlKCkgPT0gU3RhdGUuUHJlRnVuZGluZykgewogICAgICAvLyBBcmUgd2Ugd2hpdGVsaXN0ZWQgZm9yIGVhcmx5IGRlcG9zaXQKICAgICAgdGhyb3c7CiAgICB9IGVsc2UgaWYoZ2V0U3RhdGUoKSA9PSBTdGF0ZS5GdW5kaW5nKSB7CiAgICAgIC8vIFJldGFpbCBwYXJ0aWNpcGFudHMgY2FuIG9ubHkgY29tZSBpbiB3aGVuIHRoZSBjcm93ZHNhbGUgaXMgcnVubmluZwogICAgICAvLyBwYXNzCiAgICAgIGlmKGlzV2hpdGVMaXN0ZWQpIHsKICAgICAgICBpZighZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0uc3RhdHVzKSB7CiAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIFVud2FudGVkIHN0YXRlCiAgICAgIHRocm93OwogICAgfQogICAgdWludCB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICAvLyBBY2NvdW50IHByZXNhbGUgc2FsZXMgc2VwYXJhdGVseSwgc28gdGhhdCB0aGV5IGRvIG5vdCBjb3VudCBhZ2FpbnN0IHByaWNpbmcgdHJhbmNoZXMKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBwcmljaW5nU3RyYXRlZ3kuY2FsY3VsYXRlUHJpY2Uod2VpQW1vdW50LCB3ZWlSYWlzZWQgLSBwcmVzYWxlV2VpUmFpc2VkLCB0b2tlbnNTb2xkLCBtc2cuc2VuZGVyLCB0b2tlbi5kZWNpbWFscygpKTsKICAgIGlmKHRva2VuQW1vdW50ID09IDApIHsKICAgICAgLy8gRHVzdCB0cmFuc2FjdGlvbgogICAgICB0aHJvdzsKICAgIH0KICAgIGlmKGlzV2hpdGVMaXN0ZWQpIHsKICAgICAgaWYodG9rZW5BbW91bnQgPCBlYXJseVBhcnRpY2lwYW50V2hpdGVsaXN0W3JlY2VpdmVyXS5taW5DYXAgJiYgdG9rZW5BbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgIC8vIHRva2VuQW1vdW50IDwgbWluQ2FwIGZvciBpbnZlc3RvcgogICAgICAgIHRocm93OwogICAgICB9CiAgICAgIGlmKHRva2VuQW1vdW50ID4gZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFtyZWNlaXZlcl0ubWF4Q2FwKSB7CiAgICAgICAgLy8gdG9rZW5BbW91bnQgPiBtYXhDYXAgZm9yIGludmVzdG9yCiAgICAgICAgdGhyb3c7CiAgICAgIH0KICAgICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGludmVzdG9yJ3MgY2FwCiAgICAgIGlmIChpc0JyZWFraW5nSW52ZXN0b3JDYXAocmVjZWl2ZXIsIHRva2VuQW1vdW50KSkgewogICAgICAgIHRocm93OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZih0b2tlbkFtb3VudCA8IHRva2VuLm1pbkNhcCgpICYmIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID09IDApIHsKICAgICAgICB0aHJvdzsKICAgICAgfQogICAgfQogICAgLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcAogICAgaWYoaXNCcmVha2luZ0NhcCh3ZWlBbW91bnQsIHRva2VuQW1vdW50LCB3ZWlSYWlzZWQsIHRva2Vuc1NvbGQpKSB7CiAgICAgIHRocm93OwogICAgfQogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KICAgIC8vIFVwZGF0ZSBpbnZlc3RvcgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOwogICAgLy8gVXBkYXRlIHRvdGFscwogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOwogICAgaWYocHJpY2luZ1N0cmF0ZWd5LmlzUHJlc2FsZVB1cmNoYXNlKHJlY2VpdmVyKSkgewogICAgICAgIHByZXNhbGVXZWlSYWlzZWQgPSBwcmVzYWxlV2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIH0KICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwogICAgLy8gUG9ja2V0IHRoZSBtb25leQogICAgaWYoIW11bHRpc2lnV2FsbGV0LnNlbmQod2VpQW1vdW50KSkgdGhyb3c7CiAgICBpZiAoaXNXaGl0ZUxpc3RlZCkgewogICAgICB1aW50IG51bSA9IDA7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMgPT0gam9pbmVkQ3Jvd2RzYWxlc1tpXSkgCiAgICAgICAgICBudW0gPSBpOwogICAgICB9CiAgICAgIGlmIChudW0gKyAxIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbikgewogICAgICAgIGZvciAodmFyIGogPSBudW0gKyAxOyBqIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaisrKSB7CiAgICAgICAgICBDcm93ZHNhbGVFeHQgY3Jvd2RzYWxlID0gQ3Jvd2RzYWxlRXh0KGpvaW5lZENyb3dkc2FsZXNbal0pOwogICAgICAgICAgY3Jvd2RzYWxlLnVwZGF0ZUVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChtc2cuc2VuZGVyLCB0aGlzLCB0b2tlbkFtb3VudCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIGN1c3RvbWVySWQpOwogIH0KICAvKioKICAgKiBQcmVhbGxvY2F0ZSB0b2tlbnMgZm9yIHRoZSBlYXJseSBpbnZlc3RvcnMuCiAgICoKICAgKiBQcmVhbGxvY2F0ZWQgdG9rZW5zIGhhdmUgYmVlbiBzb2xkIGJlZm9yZSB0aGUgYWN0dWFsIGNyb3dkc2FsZSBvcGVucy4KICAgKiBUaGlzIGZ1bmN0aW9uIG1pbnRzIHRoZSB0b2tlbnMgYW5kIG1vdmVzIHRoZSBjcm93ZHNhbGUgbmVlZGxlLgogICAqCiAgICogSW52ZXN0b3IgY291bnQgaXMgbm90IGhhbmRsZWQ7IGl0IGlzIGFzc3VtZWQgdGhpcyBnb2VzIGZvciBtdWx0aXBsZSBpbnZlc3RvcnMKICAgKiBhbmQgdGhlIHRva2VuIGRpc3RyaWJ1dGlvbiBoYXBwZW5zIG91dHNpZGUgdGhlIHNtYXJ0IGNvbnRyYWN0IGZsb3cuCiAgICoKICAgKiBObyBtb25leSBpcyBleGNoYW5nZWQsIGFzIHRoZSBjcm93ZHNhbGUgdGVhbSBhbHJlYWR5IGhhdmUgcmVjZWl2ZWQgdGhlIHBheW1lbnQuCiAgICoKICAgKiBAcGFyYW0gZnVsbFRva2VucyB0b2tlbnMgYXMgZnVsbCB0b2tlbnMgLSBkZWNpbWFsIHBsYWNlcyBhZGRlZCBpbnRlcm5hbGx5CiAgICogQHBhcmFtIHdlaVByaWNlIFByaWNlIG9mIGEgc2luZ2xlIGZ1bGwgdG9rZW4gaW4gd2VpCiAgICoKICAgKi8KICBmdW5jdGlvbiBwcmVhbGxvY2F0ZShhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGZ1bGxUb2tlbnMsIHVpbnQgd2VpUHJpY2UpIHB1YmxpYyBvbmx5T3duZXIgewogICAgdWludCB0b2tlbkFtb3VudCA9IGZ1bGxUb2tlbnMgKiAxMCoqdG9rZW4uZGVjaW1hbHMoKTsKICAgIHVpbnQgd2VpQW1vdW50ID0gd2VpUHJpY2UgKiBmdWxsVG9rZW5zOyAvLyBUaGlzIGNhbiBiZSBhbHNvIDAsIHdlIGdpdmUgb3V0IHRva2VucyBmb3IgZnJlZQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLnBsdXMod2VpQW1vdW50KTsKICAgIHRva2Vuc1NvbGQgPSB0b2tlbnNTb2xkLnBsdXModG9rZW5BbW91bnQpOwogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXS5wbHVzKHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLnBsdXModG9rZW5BbW91bnQpOwogICAgYXNzaWduVG9rZW5zKHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgSW52ZXN0ZWQocmVjZWl2ZXIsIHdlaUFtb3VudCwgdG9rZW5BbW91bnQsIDApOwogIH0KICAvKioKICAgKiBBbGxvdyBhbm9ueW1vdXMgY29udHJpYnV0aW9ucyB0byB0aGlzIGNyb3dkc2FsZS4KICAgKi8KICBmdW5jdGlvbiBpbnZlc3RXaXRoU2lnbmVkQWRkcmVzcyhhZGRyZXNzIGFkZHIsIHVpbnQxMjggY3VzdG9tZXJJZCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBwYXlhYmxlIHsKICAgICBieXRlczMyIGhhc2ggPSBzaGEyNTYoYWRkcik7CiAgICAgaWYgKGVjcmVjb3ZlcihoYXNoLCB2LCByLCBzKSAhPSBzaWduZXJBZGRyZXNzKSB0aHJvdzsKICAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgIGludmVzdEludGVybmFsKGFkZHIsIGN1c3RvbWVySWQpOwogIH0KICAvKioKICAgKiBUcmFjayB3aG8gaXMgdGhlIGN1c3RvbWVyIG1ha2luZyB0aGUgcGF5bWVudCBzbyB3ZSBjYW4gc2VuZCB0aGFuayB5b3UgZW1haWwuCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0V2l0aEN1c3RvbWVySWQoYWRkcmVzcyBhZGRyLCB1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVkU2lnbmVkQWRkcmVzcykgdGhyb3c7IC8vIENyb3dkc2FsZSBhbGxvd3Mgb25seSBzZXJ2ZXItc2lkZSBzaWduZWQgcGFydGljaXBhbnRzCiAgICBpZihjdXN0b21lcklkID09IDApIHRocm93OyAgLy8gVVVJRHY0IHNhbml0eSBjaGVjawogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgY3VzdG9tZXJJZCk7CiAgfQogIC8qKgogICAqIEFsbG93IGFub255bW91cyBjb250cmlidXRpb25zIHRvIHRoaXMgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGludmVzdChhZGRyZXNzIGFkZHIpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGlmKHJlcXVpcmVDdXN0b21lcklkKSB0aHJvdzsgLy8gQ3Jvd2RzYWxlIG5lZWRzIHRvIHRyYWNrIHBhcnRpY2lwYW50cyBmb3IgdGhhbmsgeW91IGVtYWlsCiAgICBpZihyZXF1aXJlZFNpZ25lZEFkZHJlc3MpIHRocm93OyAvLyBDcm93ZHNhbGUgYWxsb3dzIG9ubHkgc2VydmVyLXNpZGUgc2lnbmVkIHBhcnRpY2lwYW50cwogICAgaW52ZXN0SW50ZXJuYWwoYWRkciwgMCk7CiAgfQogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIgYW5kIGNsZWFyIGhpcyBhZGRyZXNzLgogICAqCiAgICovCiAgZnVuY3Rpb24gYnV5V2l0aFNpZ25lZEFkZHJlc3ModWludDEyOCBjdXN0b21lcklkLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljIHBheWFibGUgewogICAgaW52ZXN0V2l0aFNpZ25lZEFkZHJlc3MobXNnLnNlbmRlciwgY3VzdG9tZXJJZCwgdiwgciwgcyk7CiAgfQogIC8qKgogICAqIEludmVzdCB0byB0b2tlbnMsIHJlY29nbml6ZSB0aGUgcGF5ZXIuCiAgICoKICAgKi8KICBmdW5jdGlvbiBidXlXaXRoQ3VzdG9tZXJJZCh1aW50MTI4IGN1c3RvbWVySWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdFdpdGhDdXN0b21lcklkKG1zZy5zZW5kZXIsIGN1c3RvbWVySWQpOwogIH0KICAvKioKICAgKiBUaGUgYmFzaWMgZW50cnkgcG9pbnQgdG8gcGFydGljaXBhdGUgdGhlIGNyb3dkc2FsZSBwcm9jZXNzLgogICAqCiAgICogUGF5IGZvciBmdW5kaW5nLCBnZXQgaW52ZXN0ZWQgdG9rZW5zIGJhY2sgaW4gdGhlIHNlbmRlciBhZGRyZXNzLgogICAqLwogIGZ1bmN0aW9uIGJ1eSgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdChtc2cuc2VuZGVyKTsKICB9CiAgLyoqCiAgICogRmluYWxpemUgYSBzdWNjY2VzZnVsIGNyb3dkc2FsZS4KICAgKgogICAqIFRoZSBvd25lciBjYW4gdHJpZ2dyZSBhIGNhbGwgdGhlIGNvbnRyYWN0IHRoYXQgcHJvdmlkZXMgcG9zdC1jcm93ZHNhbGUgYWN0aW9ucywgbGlrZSByZWxlYXNpbmcgdGhlIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3MpIG9ubHlPd25lciBzdG9wSW5FbWVyZ2VuY3kgewogICAgLy8gQWxyZWFkeSBmaW5hbGl6ZWQKICAgIGlmKGZpbmFsaXplZCkgewogICAgICB0aHJvdzsKICAgIH0KICAgIC8vIEZpbmFsaXppbmcgaXMgb3B0aW9uYWwuIFdlIG9ubHkgY2FsbCBpdCBpZiB3ZSBhcmUgZ2l2ZW4gYSBmaW5hbGl6aW5nIGFnZW50LgogICAgaWYoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSAhPSAwKSB7CiAgICAgIGZpbmFsaXplQWdlbnQuZmluYWxpemVDcm93ZHNhbGUoKTsKICAgIH0KICAgIGZpbmFsaXplZCA9IHRydWU7CiAgfQogIC8qKgogICAqIEFsbG93IHRvIChyZSlzZXQgZmluYWxpemUgYWdlbnQuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gc2V0dGluZyB0aGlzLCBzbyB0aGF0IHdlIGNhbiBmaXggZmF0IGZpbmdlciBtaXN0YWtlcy4KICAgKi8KICBmdW5jdGlvbiBzZXRGaW5hbGl6ZUFnZW50KEZpbmFsaXplQWdlbnQgYWRkcikgb25seU93bmVyIHsKICAgIGZpbmFsaXplQWdlbnQgPSBhZGRyOwogICAgLy8gRG9uJ3QgYWxsb3cgc2V0dGluZyBiYWQgYWdlbnQKICAgIGlmKCFmaW5hbGl6ZUFnZW50LmlzRmluYWxpemVBZ2VudCgpKSB7CiAgICAgIHRocm93OwogICAgfQogIH0KICAvKioKICAgKiBTZXQgcG9saWN5IGRvIHdlIG5lZWQgdG8gaGF2ZSBzZXJ2ZXItc2lkZSBjdXN0b21lciBpZHMgZm9yIHRoZSBpbnZlc3RtZW50cy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVDdXN0b21lcklkKGJvb2wgdmFsdWUpIG9ubHlPd25lciB7CiAgICByZXF1aXJlQ3VzdG9tZXJJZCA9IHZhbHVlOwogICAgSW52ZXN0bWVudFBvbGljeUNoYW5nZWQocmVxdWlyZUN1c3RvbWVySWQsIHJlcXVpcmVkU2lnbmVkQWRkcmVzcywgc2lnbmVyQWRkcmVzcyk7CiAgfQogIC8qKgogICAqIFNldCBwb2xpY3kgaWYgYWxsIGludmVzdG9ycyBtdXN0IGJlIGNsZWFyZWQgb24gdGhlIHNlcnZlciBzaWRlIGZpcnN0LgogICAqCiAgICogVGhpcyBpcyBlLmcuIGZvciB0aGUgYWNjcmVkaXRlZCBpbnZlc3RvciBjbGVhcmluZy4KICAgKgogICAqLwogIGZ1bmN0aW9uIHNldFJlcXVpcmVTaWduZWRBZGRyZXNzKGJvb2wgdmFsdWUsIGFkZHJlc3MgX3NpZ25lckFkZHJlc3MpIG9ubHlPd25lciB7CiAgICByZXF1aXJlZFNpZ25lZEFkZHJlc3MgPSB2YWx1ZTsKICAgIHNpZ25lckFkZHJlc3MgPSBfc2lnbmVyQWRkcmVzczsKICAgIEludmVzdG1lbnRQb2xpY3lDaGFuZ2VkKHJlcXVpcmVDdXN0b21lcklkLCByZXF1aXJlZFNpZ25lZEFkZHJlc3MsIHNpZ25lckFkZHJlc3MpOwogIH0KICAvKioKICAgKiBBbGxvdyBhZGRyZXNzZXMgdG8gZG8gZWFybHkgcGFydGljaXBhdGlvbi4KICAgKgogICAqIFRPRE86IEZpeCBzcGVsbGluZyBlcnJvciBpbiB0aGUgbmFtZQogICAqLwogIGZ1bmN0aW9uIHNldEVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGJvb2wgc3RhdHVzLCB1aW50IG1pbkNhcCwgdWludCBtYXhDYXApIG9ubHlPd25lciB7CiAgICBpZiAoIWlzV2hpdGVMaXN0ZWQpIHRocm93OwogICAgZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXSA9IFdoaXRlTGlzdERhdGEoe3N0YXR1czpzdGF0dXMsIG1pbkNhcDptaW5DYXAsIG1heENhcDptYXhDYXB9KTsKICAgIFdoaXRlbGlzdGVkKGFkZHIsIHN0YXR1cyk7CiAgfQogIGZ1bmN0aW9uIHNldEVhcmx5UGFyaWNpcGFudHNXaGl0ZWxpc3QoYWRkcmVzc1tdIGFkZHJzLCBib29sW10gc3RhdHVzZXMsIHVpbnRbXSBtaW5DYXBzLCB1aW50W10gbWF4Q2Fwcykgb25seU93bmVyIHsKICAgIGlmICghaXNXaGl0ZUxpc3RlZCkgdGhyb3c7CiAgICBmb3IgKHVpbnQgaXRlcmF0b3IgPSAwOyBpdGVyYXRvciA8IGFkZHJzLmxlbmd0aDsgaXRlcmF0b3IrKykgewogICAgICBzZXRFYXJseVBhcmljaXBhbnRXaGl0ZWxpc3QoYWRkcnNbaXRlcmF0b3JdLCBzdGF0dXNlc1tpdGVyYXRvcl0sIG1pbkNhcHNbaXRlcmF0b3JdLCBtYXhDYXBzW2l0ZXJhdG9yXSk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHVwZGF0ZUVhcmx5UGFyaWNpcGFudFdoaXRlbGlzdChhZGRyZXNzIGFkZHIsIGFkZHJlc3MgY29udHJhY3RBZGRyLCB1aW50IHRva2Vuc0JvdWdodCkgewogICAgaWYgKHRva2Vuc0JvdWdodCA8IGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0ubWluQ2FwKSB0aHJvdzsKICAgIGlmICghaXNXaGl0ZUxpc3RlZCkgdGhyb3c7CiAgICBpZiAoYWRkciAhPSBtc2cuc2VuZGVyICYmIGNvbnRyYWN0QWRkciAhPSBtc2cuc2VuZGVyKSB0aHJvdzsKICAgIHVpbnQgbmV3TWF4Q2FwID0gZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXS5tYXhDYXA7CiAgICBuZXdNYXhDYXAgPSBuZXdNYXhDYXAubWludXModG9rZW5zQm91Z2h0KTsKICAgIGVhcmx5UGFydGljaXBhbnRXaGl0ZWxpc3RbYWRkcl0gPSBXaGl0ZUxpc3REYXRhKHtzdGF0dXM6ZWFybHlQYXJ0aWNpcGFudFdoaXRlbGlzdFthZGRyXS5zdGF0dXMsIG1pbkNhcDowLCBtYXhDYXA6bmV3TWF4Q2FwfSk7CiAgfQogIGZ1bmN0aW9uIHVwZGF0ZUpvaW5lZENyb3dkc2FsZXMoYWRkcmVzcyBhZGRyKSBvbmx5T3duZXIgewogICAgam9pbmVkQ3Jvd2RzYWxlc1tqb2luZWRDcm93ZHNhbGVzTGVuKytdID0gYWRkcjsKICB9CiAgZnVuY3Rpb24gc2V0TGFzdENyb3dkc2FsZShhZGRyZXNzIGFkZHIpIG9ubHlPd25lciB7CiAgICBsYXN0Q3Jvd2RzYWxlID0gYWRkcjsKICB9CiAgZnVuY3Rpb24gY2xlYXJKb2luZWRDcm93ZHNhbGVzKCkgb25seU93bmVyIHsKICAgIGpvaW5lZENyb3dkc2FsZXNMZW4gPSAwOwogIH0KICBmdW5jdGlvbiB1cGRhdGVKb2luZWRDcm93ZHNhbGVzTXVsdGlwbGUoYWRkcmVzc1tdIGFkZHJzKSBvbmx5T3duZXIgewogICAgY2xlYXJKb2luZWRDcm93ZHNhbGVzKCk7CiAgICBmb3IgKHVpbnQgaXRlciA9IDA7IGl0ZXIgPCBhZGRycy5sZW5ndGg7IGl0ZXIrKykgewogICAgICBpZihqb2luZWRDcm93ZHNhbGVzTGVuID09IGpvaW5lZENyb3dkc2FsZXMubGVuZ3RoKSB7CiAgICAgICAgICBqb2luZWRDcm93ZHNhbGVzLmxlbmd0aCArPSAxOwogICAgICB9CiAgICAgIGpvaW5lZENyb3dkc2FsZXNbam9pbmVkQ3Jvd2RzYWxlc0xlbisrXSA9IGFkZHJzW2l0ZXJdOwogICAgICBpZiAoaXRlciA9PSBhZGRycy5sZW5ndGggLSAxKQogICAgICAgIHNldExhc3RDcm93ZHNhbGUoYWRkcnNbaXRlcl0pOwogICAgfQogIH0KICBmdW5jdGlvbiBzZXRTdGFydHNBdCh1aW50IHRpbWUpIG9ubHlPd25lciB7CiAgICBpZiAoZmluYWxpemVkKSB0aHJvdzsKICAgIGlmICghaXNVcGRhdGFibGUpIHRocm93OwogICAgaWYobm93ID4gdGltZSkgewogICAgICB0aHJvdzsgLy8gRG9uJ3QgY2hhbmdlIHBhc3QKICAgIH0KICAgIGlmKHRpbWUgPiBlbmRzQXQpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBDcm93ZHNhbGVFeHQgbGFzdENyb3dkc2FsZUNudHJjdCA9IENyb3dkc2FsZUV4dChsYXN0Q3Jvd2RzYWxlKTsKICAgIGlmIChsYXN0Q3Jvd2RzYWxlQ250cmN0LmZpbmFsaXplZCgpKSB0aHJvdzsKICAgIHN0YXJ0c0F0ID0gdGltZTsKICAgIFN0YXJ0c0F0Q2hhbmdlZChzdGFydHNBdCk7CiAgfQogIC8qKgogICAqIEFsbG93IGNyb3dkc2FsZSBvd25lciB0byBjbG9zZSBlYXJseSBvciBleHRlbmQgdGhlIGNyb3dkc2FsZS4KICAgKgogICAqIFRoaXMgaXMgdXNlZnVsIGUuZy4gZm9yIGEgbWFudWFsIHNvZnQgY2FwIGltcGxlbWVudGF0aW9uOgogICAqIC0gYWZ0ZXIgWCBhbW91bnQgaXMgcmVhY2hlZCBkZXRlcm1pbmUgbWFudWFsIGNsb3NpbmcKICAgKgogICAqIFRoaXMgbWF5IHB1dCB0aGUgY3Jvd2RzYWxlIHRvIGFuIGludmFsaWQgc3RhdGUsCiAgICogYnV0IHdlIHRydXN0IG93bmVycyBrbm93IHdoYXQgdGhleSBhcmUgZG9pbmcuCiAgICoKICAgKi8KICBmdW5jdGlvbiBzZXRFbmRzQXQodWludCB0aW1lKSBvbmx5T3duZXIgewogICAgaWYgKGZpbmFsaXplZCkgdGhyb3c7CiAgICBpZiAoIWlzVXBkYXRhYmxlKSB0aHJvdzsKICAgIGlmKG5vdyA+IHRpbWUpIHsKICAgICAgdGhyb3c7IC8vIERvbid0IGNoYW5nZSBwYXN0CiAgICB9CiAgICBpZihzdGFydHNBdCA+IHRpbWUpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBDcm93ZHNhbGVFeHQgbGFzdENyb3dkc2FsZUNudHJjdCA9IENyb3dkc2FsZUV4dChsYXN0Q3Jvd2RzYWxlKTsKICAgIGlmIChsYXN0Q3Jvd2RzYWxlQ250cmN0LmZpbmFsaXplZCgpKSB0aHJvdzsKICAgIHVpbnQgbnVtID0gMDsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgam9pbmVkQ3Jvd2RzYWxlc0xlbjsgaSsrKSB7CiAgICAgIGlmICh0aGlzID09IGpvaW5lZENyb3dkc2FsZXNbaV0pIAogICAgICAgIG51bSA9IGk7CiAgICB9CiAgICBpZiAobnVtICsgMSA8IGpvaW5lZENyb3dkc2FsZXNMZW4pIHsKICAgICAgZm9yICh2YXIgaiA9IG51bSArIDE7IGogPCBqb2luZWRDcm93ZHNhbGVzTGVuOyBqKyspIHsKICAgICAgICBDcm93ZHNhbGVFeHQgY3Jvd2RzYWxlID0gQ3Jvd2RzYWxlRXh0KGpvaW5lZENyb3dkc2FsZXNbal0pOwogICAgICAgIGlmICh0aW1lID4gY3Jvd2RzYWxlLnN0YXJ0c0F0KCkpIHRocm93OwogICAgICB9CiAgICB9CiAgICBlbmRzQXQgPSB0aW1lOwogICAgRW5kc0F0Q2hhbmdlZChlbmRzQXQpOwogIH0KICAvKioKICAgKiBBbGxvdyB0byAocmUpc2V0IHByaWNpbmcgc3RyYXRlZ3kuCiAgICoKICAgKiBEZXNpZ24gY2hvaWNlOiBubyBzdGF0ZSByZXN0cmljdGlvbnMgb24gdGhlIHNldCwgc28gdGhhdCB3ZSBjYW4gZml4IGZhdCBmaW5nZXIgbWlzdGFrZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0UHJpY2luZ1N0cmF0ZWd5KFByaWNpbmdTdHJhdGVneSBfcHJpY2luZ1N0cmF0ZWd5KSBvbmx5T3duZXIgewogICAgcHJpY2luZ1N0cmF0ZWd5ID0gX3ByaWNpbmdTdHJhdGVneTsKICAgIC8vIERvbid0IGFsbG93IHNldHRpbmcgYmFkIGFnZW50CiAgICBpZighcHJpY2luZ1N0cmF0ZWd5LmlzUHJpY2luZ1N0cmF0ZWd5KCkpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgfQogIC8qKgogICAqIEFsbG93IHRvIGNoYW5nZSB0aGUgdGVhbSBtdWx0aXNpZyBhZGRyZXNzIGluIHRoZSBjYXNlIG9mIGVtZXJnZW5jeS4KICAgKgogICAqIFRoaXMgYWxsb3dzIHRvIHNhdmUgYSBkZXBsb3llZCBjcm93ZHNhbGUgd2FsbGV0IGluIHRoZSBjYXNlIHRoZSBjcm93ZHNhbGUgaGFzIG5vdCB5ZXQgYmVndW4KICAgKiAod2UgaGF2ZSBkb25lIG9ubHkgZmV3IHRlc3QgdHJhbnNhY3Rpb25zKS4gQWZ0ZXIgdGhlIGNyb3dkc2FsZSBpcyBnb2luZwogICAqIHRoZW4gbXVsdGlzaWcgYWRkcmVzcyBzdGF5cyBsb2NrZWQgZm9yIHRoZSBzYWZldHkgcmVhc29ucy4KICAgKi8KICBmdW5jdGlvbiBzZXRNdWx0aXNpZyhhZGRyZXNzIGFkZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgLy8gQ2hhbmdlCiAgICBpZihpbnZlc3RvckNvdW50ID4gTUFYX0lOVkVTVE1FTlRTX0JFRk9SRV9NVUxUSVNJR19DSEFOR0UpIHsKICAgICAgdGhyb3c7CiAgICB9CiAgICBtdWx0aXNpZ1dhbGxldCA9IGFkZHI7CiAgfQogIC8qKgogICAqIEFsbG93IGxvYWQgcmVmdW5kcyBiYWNrIG9uIHRoZSBjb250cmFjdCBmb3IgdGhlIHJlZnVuZGluZy4KICAgKgogICAqIFRoZSB0ZWFtIGNhbiB0cmFuc2ZlciB0aGUgZnVuZHMgYmFjayBvbiB0aGUgc21hcnQgY29udHJhY3QgaW4gdGhlIGNhc2UgdGhlIG1pbmltdW0gZ29hbCB3YXMgbm90IHJlYWNoZWQuLgogICAqLwogIGZ1bmN0aW9uIGxvYWRSZWZ1bmQoKSBwdWJsaWMgcGF5YWJsZSBpblN0YXRlKFN0YXRlLkZhaWx1cmUpIHsKICAgIGlmKG1zZy52YWx1ZSA9PSAwKSB0aHJvdzsKICAgIGxvYWRlZFJlZnVuZCA9IGxvYWRlZFJlZnVuZC5wbHVzKG1zZy52YWx1ZSk7CiAgfQogIC8qKgogICAqIEludmVzdG9ycyBjYW4gY2xhaW0gcmVmdW5kLgogICAqCiAgICogTm90ZSB0aGF0IGFueSByZWZ1bmRzIGZyb20gcHJveHkgYnV5ZXJzIHNob3VsZCBiZSBoYW5kbGVkIHNlcGFyYXRlbHksCiAgICogYW5kIG5vdCB0aHJvdWdoIHRoaXMgY29udHJhY3QuCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kKCkgcHVibGljIGluU3RhdGUoU3RhdGUuUmVmdW5kaW5nKSB7CiAgICB1aW50MjU2IHdlaVZhbHVlID0gaW52ZXN0ZWRBbW91bnRPZlttc2cuc2VuZGVyXTsKICAgIGlmICh3ZWlWYWx1ZSA9PSAwKSB0aHJvdzsKICAgIGludmVzdGVkQW1vdW50T2ZbbXNnLnNlbmRlcl0gPSAwOwogICAgd2VpUmVmdW5kZWQgPSB3ZWlSZWZ1bmRlZC5wbHVzKHdlaVZhbHVlKTsKICAgIFJlZnVuZChtc2cuc2VuZGVyLCB3ZWlWYWx1ZSk7CiAgICBpZiAoIW1zZy5zZW5kZXIuc2VuZCh3ZWlWYWx1ZSkpIHRocm93OwogIH0KICAvKioKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGNyb3dkc2FsZSBoYXMgcmFpc2VkIGVub3VnaCBtb25leSB0byBiZSBhIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gaXNNaW5pbXVtR29hbFJlYWNoZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCByZWFjaGVkKSB7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbmltdW1GdW5kaW5nR29hbDsKICB9CiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGNvbnRyYWN0IHJlbGF0aW9uc2hpcCBsb29rcyBnb29kLgogICAqLwogIGZ1bmN0aW9uIGlzRmluYWxpemVyU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBmaW5hbGl6ZUFnZW50LmlzU2FuZSgpOwogIH0KICAvKioKICAgKiBDaGVjayBpZiB0aGUgY29udHJhY3QgcmVsYXRpb25zaGlwIGxvb2tzIGdvb2QuCiAgICovCiAgZnVuY3Rpb24gaXNQcmljaW5nU2FuZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIHNhbmUpIHsKICAgIHJldHVybiBwcmljaW5nU3RyYXRlZ3kuaXNTYW5lKGFkZHJlc3ModGhpcykpOwogIH0KICAvKioKICAgKiBDcm93ZGZ1bmQgc3RhdGUgbWFjaGluZSBtYW5hZ2VtZW50LgogICAqCiAgICogV2UgbWFrZSBpdCBhIGZ1bmN0aW9uIGFuZCBkbyBub3QgYXNzaWduIHRoZSByZXN1bHQgdG8gYSB2YXJpYWJsZSwgc28gdGhlcmUgaXMgbm8gY2hhbmNlIG9mIHRoZSB2YXJpYWJsZSBiZWluZyBzdGFsZS4KICAgKi8KICBmdW5jdGlvbiBnZXRTdGF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgewogICAgaWYoZmluYWxpemVkKSByZXR1cm4gU3RhdGUuRmluYWxpemVkOwogICAgZWxzZSBpZiAoYWRkcmVzcyhmaW5hbGl6ZUFnZW50KSA9PSAwKSByZXR1cm4gU3RhdGUuUHJlcGFyaW5nOwogICAgZWxzZSBpZiAoIWZpbmFsaXplQWdlbnQuaXNTYW5lKCkpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmICghcHJpY2luZ1N0cmF0ZWd5LmlzU2FuZShhZGRyZXNzKHRoaXMpKSkgcmV0dXJuIFN0YXRlLlByZXBhcmluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IHN0YXJ0c0F0KSByZXR1cm4gU3RhdGUuUHJlRnVuZGluZzsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmRzQXQgJiYgIWlzQ3Jvd2RzYWxlRnVsbCgpKSByZXR1cm4gU3RhdGUuRnVuZGluZzsKICAgIGVsc2UgaWYgKGlzTWluaW11bUdvYWxSZWFjaGVkKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogICAgZWxzZSBpZiAoIWlzTWluaW11bUdvYWxSZWFjaGVkKCkgJiYgd2VpUmFpc2VkID4gMCAmJiBsb2FkZWRSZWZ1bmQgPj0gd2VpUmFpc2VkKSByZXR1cm4gU3RhdGUuUmVmdW5kaW5nOwogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICB9CiAgLyoqIFRoaXMgaXMgZm9yIG1hbnVhbCB0ZXN0aW5nIG9mIG11bHRpc2lnIHdhbGxldCBpbnRlcmFjdGlvbiAqLwogIGZ1bmN0aW9uIHNldE93bmVyVGVzdFZhbHVlKHVpbnQgdmFsKSBvbmx5T3duZXIgewogICAgb3duZXJUZXN0VmFsdWUgPSB2YWw7CiAgfQogIC8qKiBJbnRlcmZhY2UgbWFya2VyLiAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICAvLwogIC8vIE1vZGlmaWVycwogIC8vCiAgLyoqIE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcuICAqLwogIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGUpIHsKICAgIGlmKGdldFN0YXRlKCkgIT0gc3RhdGUpIHRocm93OwogICAgXzsKICB9CiAgLy8KICAvLyBBYnN0cmFjdCBmdW5jdGlvbnMKICAvLwogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IGludmVzdGVkIGJyZWFrcyBvdXIgY2FwIHJ1bGVzLgogICAqCiAgICoKICAgKiBUaGUgY2hpbGQgY29udHJhY3QgbXVzdCBkZWZpbmUgdGhlaXIgb3duIGNhcCBzZXR0aW5nIHJ1bGVzLgogICAqIFdlIGFsbG93IGEgbG90IG9mIGZsZXhpYmlsaXR5IHRocm91Z2ggZGlmZmVyZW50IGNhcHBpbmcgc3RyYXRlZ2llcyAoRVRILCB0b2tlbiBjb3VudCkKICAgKiBDYWxsZWQgZnJvbSBpbnZlc3QoKS4KICAgKgogICAqIEBwYXJhbSB3ZWlBbW91bnQgVGhlIGFtb3VudCBvZiB3ZWkgdGhlIGludmVzdG9yIHRyaWVzIHRvIGludmVzdCBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbkFtb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB3ZSB0cnkgdG8gZ2l2ZSB0byB0aGUgaW52ZXN0b3IgaW4gdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gd2VpUmFpc2VkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgcmFpc2VkIGJhbGFuY2UgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcwogICAqLwogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB3ZWlBbW91bnQsIHVpbnQgdG9rZW5BbW91bnQsIHVpbnQgd2VpUmFpc2VkVG90YWwsIHVpbnQgdG9rZW5zU29sZFRvdGFsKSBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKTsKICBmdW5jdGlvbiBpc0JyZWFraW5nSW52ZXN0b3JDYXAoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCBsaW1pdEJyb2tlbik7CiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIGZ1bGwgYW5kIHdlIGNhbiBubyBsb25nZXIgc2VsbCBhbnkgdG9rZW5zLgogICAqLwogIGZ1bmN0aW9uIGlzQ3Jvd2RzYWxlRnVsbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKTsKICAvKioKICAgKiBDcmVhdGUgbmV3IHRva2VucyBvciB0cmFuc2ZlciBpc3N1ZWQgdG9rZW5zIHRvIHRoZSBpbnZlc3RvciBkZXBlbmRpbmcgb24gdGhlIGNhcCBtb2RlbC4KICAgKi8KICBmdW5jdGlvbiBhc3NpZ25Ub2tlbnMoYWRkcmVzcyByZWNlaXZlciwgdWludCB0b2tlbkFtb3VudCkgcHJpdmF0ZTsKfQovKioKICogVGhpcyBzbWFydCBjb250cmFjdCBjb2RlIGlzIENvcHlyaWdodCAyMDE3IFRva2VuTWFya2V0IEx0ZC4gRm9yIG1vcmUgaW5mb3JtYXRpb24gc2VlIGh0dHBzOi8vdG9rZW5tYXJrZXQubmV0CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgdmVyc2lvbiAyLjA6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvTElDRU5TRS50eHQKICovCi8qKgogKiBJbnRlcmZhY2UgZm9yIGRlZmluaW5nIGNyb3dkc2FsZSBwcmljaW5nLgogKi8KY29udHJhY3QgUHJpY2luZ1N0cmF0ZWd5IHsKICAvKiogSW50ZXJmYWNlIGRlY2xhcmF0aW9uLiAqLwogIGZ1bmN0aW9uIGlzUHJpY2luZ1N0cmF0ZWd5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICAvKiogU2VsZiBjaGVjayBpZiBhbGwgcmVmZXJlbmNlcyBhcmUgY29ycmVjdGx5IHNldC4KICAgKgogICAqIENoZWNrcyB0aGF0IHByaWNpbmcgc3RyYXRlZ3kgbWF0Y2hlcyBjcm93ZHNhbGUgcGFyYW1ldGVycy4KICAgKi8KICBmdW5jdGlvbiBpc1NhbmUoYWRkcmVzcyBjcm93ZHNhbGUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgLyoqCiAgICogQGRldiBQcmljaW5nIHRlbGxzIGlmIHRoaXMgaXMgYSBwcmVzYWxlIHB1cmNoYXNlIG9yIG5vdC4KICAgICBAcGFyYW0gcHVyY2hhc2VyIEFkZHJlc3Mgb2YgdGhlIHB1cmNoYXNlcgogICAgIEByZXR1cm4gRmFsc2UgYnkgZGVmYXVsdCwgdHJ1ZSBpZiBhIHByZXNhbGUgcHVyY2hhc2VyCiAgICovCiAgZnVuY3Rpb24gaXNQcmVzYWxlUHVyY2hhc2UoYWRkcmVzcyBwdXJjaGFzZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIC8qKgogICAqIFdoZW4gc29tZWJvZHkgdHJpZXMgdG8gYnV5IHRva2VucyBmb3IgWCBldGgsIGNhbGN1bGF0ZSBob3cgbWFueSB0b2tlbnMgdGhleSBnZXQuCiAgICoKICAgKgogICAqIEBwYXJhbSB2YWx1ZSAtIFdoYXQgaXMgdGhlIHZhbHVlIG9mIHRoZSB0cmFuc2FjdGlvbiBzZW5kIGluIGFzIHdlaQogICAqIEBwYXJhbSB0b2tlbnNTb2xkIC0gaG93IG11Y2ggdG9rZW5zIGhhdmUgYmVlbiBzb2xkIHRoaXMgZmFyCiAgICogQHBhcmFtIHdlaVJhaXNlZCAtIGhvdyBtdWNoIG1vbmV5IGhhcyBiZWVuIHJhaXNlZCB0aGlzIGZhciBpbiB0aGUgbWFpbiB0b2tlbiBzYWxlIC0gdGhpcyBudW1iZXIgZXhjbHVkZXMgcHJlc2FsZQogICAqIEBwYXJhbSBtc2dTZW5kZXIgLSB3aG8gaXMgdGhlIGludmVzdG9yIG9mIHRoaXMgdHJhbnNhY3Rpb24KICAgKiBAcGFyYW0gZGVjaW1hbHMgLSBob3cgbWFueSBkZWNpbWFsIHVuaXRzIHRoZSB0b2tlbiBoYXMKICAgKiBAcmV0dXJuIEFtb3VudCBvZiB0b2tlbnMgdGhlIGludmVzdG9yIHJlY2VpdmVzCiAgICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludCB2YWx1ZSwgdWludCB3ZWlSYWlzZWQsIHVpbnQgdG9rZW5zU29sZCwgYWRkcmVzcyBtc2dTZW5kZXIsIHVpbnQgZGVjaW1hbHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50IHRva2VuQW1vdW50KTsKfQovKioKICogRml4ZWQgY3Jvd2RzYWxlIHByaWNpbmcgLSBldmVyeWJvZHkgZ2V0cyB0aGUgc2FtZSBwcmljZS4KICovCmNvbnRyYWN0IEZsYXRQcmljaW5nRXh0IGlzIFByaWNpbmdTdHJhdGVneSwgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGhMaWJFeHQgZm9yIHVpbnQ7CiAgLyogSG93IG1hbnkgd2VpcyBvbmUgdG9rZW4gY29zdHMgKi8KICB1aW50IHB1YmxpYyBvbmVUb2tlbkluV2VpOwogIGJvb2wgcHVibGljIGlzVXBkYXRhYmxlOwogIGFkZHJlc3MgcHVibGljIGxhc3RDcm93ZHNhbGU7CiAgLy8gQ3Jvd2RzYWxlIHJhdGUgaGFzIGJlZW4gY2hhbmdlZAogIGV2ZW50IFJhdGVDaGFuZ2VkKHVpbnQgbmV3T25lVG9rZW5JbldlaSk7CiAgZnVuY3Rpb24gRmxhdFByaWNpbmdFeHQodWludCBfb25lVG9rZW5JbldlaSwgYm9vbCBfaXNVcGRhdGFibGUpIG9ubHlPd25lciB7CiAgICByZXF1aXJlKF9vbmVUb2tlbkluV2VpID4gMCk7CiAgICBvbmVUb2tlbkluV2VpID0gX29uZVRva2VuSW5XZWk7CiAgICBpc1VwZGF0YWJsZSA9IF9pc1VwZGF0YWJsZTsKICB9CiAgZnVuY3Rpb24gc2V0TGFzdENyb3dkc2FsZShhZGRyZXNzIGFkZHIpIG9ubHlPd25lciB7CiAgICBsYXN0Q3Jvd2RzYWxlID0gYWRkcjsKICB9CiAgZnVuY3Rpb24gdXBkYXRlUmF0ZSh1aW50IG5ld09uZVRva2VuSW5XZWkpIG9ubHlPd25lciB7CiAgICBpZiAoIWlzVXBkYXRhYmxlKSB0aHJvdzsKICAgIENyb3dkc2FsZUV4dCBsYXN0Q3Jvd2RzYWxlQ250cmN0ID0gQ3Jvd2RzYWxlRXh0KGxhc3RDcm93ZHNhbGUpOwogICAgaWYgKGxhc3RDcm93ZHNhbGVDbnRyY3QuZmluYWxpemVkKCkpIHRocm93OwogICAgb25lVG9rZW5JbldlaSA9IG5ld09uZVRva2VuSW5XZWk7CiAgICBSYXRlQ2hhbmdlZChuZXdPbmVUb2tlbkluV2VpKTsKICB9CiAgLyoqCiAgICogQ2FsY3VsYXRlIHRoZSBjdXJyZW50IHByaWNlIGZvciBidXkgaW4gYW1vdW50LgogICAqCiAgICovCiAgZnVuY3Rpb24gY2FsY3VsYXRlUHJpY2UodWludCB2YWx1ZSwgdWludCB3ZWlSYWlzZWQsIHVpbnQgdG9rZW5zU29sZCwgYWRkcmVzcyBtc2dTZW5kZXIsIHVpbnQgZGVjaW1hbHMpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IG11bHRpcGxpZXIgPSAxMCAqKiBkZWNpbWFsczsKICAgIHJldHVybiB2YWx1ZS50aW1lcyhtdWx0aXBsaWVyKSAvIG9uZVRva2VuSW5XZWk7CiAgfQp9'.
	

]
