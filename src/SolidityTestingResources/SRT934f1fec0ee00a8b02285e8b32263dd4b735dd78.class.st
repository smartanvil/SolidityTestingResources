Class {
	#name : #SRT934f1fec0ee00a8b02285e8b32263dd4b735dd78,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT934f1fec0ee00a8b02285e8b32263dd4b735dd78 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciB7CiAgICBpZiAobmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewogICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogIH0KCn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIHBhdXNlZAogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgbW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuIAogKi8KY29udHJhY3QgQmFzaWNUb2tlbiBpcyBFUkMyMEJhc2ljIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpIHsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuIAogICogQHJldHVybiBBbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcy4KICAqLwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBCYXNpY1Rva2VuIHsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKCiAgLyoqCiAgICogQGRldiBUcmFuc2ZlciB0b2tlbnMgZnJvbSBvbmUgYWRkcmVzcyB0byBhbm90aGVyCiAgICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAqIEBwYXJhbSBfdG8gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAqIEBwYXJhbSBfdmFsdWUgdWludDI1NiB0aGUgYW1vdXQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CiAgICB2YXIgX2FsbG93YW5jZSA9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdOwoKICAgIC8vIENoZWNrIGlzIG5vdCBuZWVkZWQgYmVjYXVzZSBzdWIoX2FsbG93YW5jZSwgX3ZhbHVlKSB3aWxsIGFscmVhZHkgdGhyb3cgaWYgdGhpcyBjb25kaXRpb24gaXMgbm90IG1ldAogICAgLy8gcmVxdWlyZSAoX3ZhbHVlIDw9IF9hbGxvd2FuY2UpOwoKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBfYWxsb3dhbmNlLnN1YihfdmFsdWUpOwogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBBcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sKSB7CgogICAgLy8gVG8gY2hhbmdlIHRoZSBhcHByb3ZlIGFtb3VudCB5b3UgZmlyc3QgaGF2ZSB0byByZWR1Y2UgdGhlIGFkZHJlc3Nlc2AKICAgIC8vICBhbGxvd2FuY2UgdG8gemVybyBieSBjYWxsaW5nIGBhcHByb3ZlKF9zcGVuZGVyLCAwKWAgaWYgaXQgaXMgbm90CiAgICAvLyAgYWxyZWFkeSAwIHRvIG1pdGlnYXRlIHRoZSByYWNlIGNvbmRpdGlvbiBkZXNjcmliZWQgaGVyZToKICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgcmVxdWlyZSgoX3ZhbHVlID09IDApIHx8IChhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CgogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZpbmcgdGhlIGFtb3VudCBvZiB0b2tlbnMgc3RpbGwgYXZhaWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKfQoKCi8qKgogKiBQYXVzYWJsZSB0b2tlbgogKgogKiBTaW1wbGUgRVJDMjAgVG9rZW4gZXhhbXBsZSwgd2l0aCBwYXVzYWJsZSB0b2tlbiBjcmVhdGlvbgogKiovCgpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICB9Cn0KCgovLy8gQHRpdGxlIFRoZSBQYWxseUNvaW4KLy8vIEBhdXRob3IgTWVydW5hcyBHcmluY2FsYWl0aXMKY29udHJhY3QgUGFsbHlDb2luIGlzIFBhdXNhYmxlVG9rZW4gewogICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICdQYWxseUNvaW4nOwoKICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAnUEFMJzsKCiAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBkZWNpbWFscyA9IDE4OwoKICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgdG90YWxTdXBwbHkgPSAxMDBlMjQ7IC8vIDEwME0gdG9rZW5zIHdpdGggMTggZGVjaW1hbHMKCiAgIC8vIFRoZSB0b2tlbnMgYWxyZWFkeSB1c2VkIGZvciB0aGUgcHJlc2FsZSBidXllcnMKICAgdWludDI1NiBwdWJsaWMgdG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlID0gMDsKCiAgIC8vIFRoZSB0b2tlbnMgYWxyZWFkeSB1c2VkIGZvciB0aGUgSUNPIGJ1eWVycwogICB1aW50MjU2IHB1YmxpYyB0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZSA9IDA7CgogICBhZGRyZXNzIHB1YmxpYyBjcm93ZHNhbGU7CgogICAvLy8gQG5vdGljZSBPbmx5IGFsbG93cyB0aGUgZXhlY3V0aW9uIG9mIHRoZSBmdW5jdGlvbiBpZiBpdCdzIGNvbW1pbmcgZnJvbSBjcm93ZHNhbGUKICAgbW9kaWZpZXIgb25seUNyb3dkc2FsZSgpIHsKICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNyb3dkc2FsZSk7CiAgICAgIF87CiAgIH0KCiAgIC8vIFdoZW4gc29tZW9uZSByZWZ1bmRzIHRva2VucwogICBldmVudCBSZWZ1bmRlZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgdXNlciwgdWludDI1NiB0b2tlbnMpOwoKICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdXNlZCB0byBzZXQgdGhlIHBsYXRmb3JtICYgZGV2ZWxvcG1lbnQgdG9rZW5zLiBUaGlzIGlzCiAgIC8vLyBUaGUgMjAlICsgMjAlIG9mIHRoZSAxMDAgTSB0b2tlbnMgdXNlZCBmb3IgcGxhdGZvcm0gYW5kIGRldmVsb3BtZW50IHRlYW0uCiAgIC8vLyBUaGUgb3duZXIsIG1zZy5zZW5kZXIsIGlzIGFibGUgdG8gZG8gYWxsb3dhbmNlIGZvciBvdGhlciBjb250cmFjdHMuIFJlbWVtYmVyCiAgIC8vLyB0byB1c2UgYHRyYW5zZmVyRnJvbSgpYCBpZiB5b3UncmUgYWxsb3dlZAogICBmdW5jdGlvbiBQYWxseUNvaW4oKSB7CiAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gNDBlMjQ7IC8vIDQwTSB0b2tlbnMgd2VpCiAgIH0KCiAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNldCB0aGUgY3Jvd2RzYWxlIHNtYXJ0IGNvbnRyYWN0J3MgYWRkcmVzcyBvbmx5IGJ5IHRoZSBvd25lciBvZiB0aGlzIHRva2VuCiAgIC8vLyBAcGFyYW0gX2Nyb3dkc2FsZSBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgdXNlZAogICBmdW5jdGlvbiBzZXRDcm93ZHNhbGVBZGRyZXNzKGFkZHJlc3MgX2Nyb3dkc2FsZSkgZXh0ZXJuYWwgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgICByZXF1aXJlKF9jcm93ZHNhbGUgIT0gYWRkcmVzcygwKSk7CgogICAgICBjcm93ZHNhbGUgPSBfY3Jvd2RzYWxlOwogICB9CgogICAvLy8gQG5vdGljZSBEaXN0cmlidXRlcyB0aGUgcHJlc2FsZSB0b2tlbnMuIE9ubHkgdGhlIG93bmVyIGNhbiBkbyB0aGlzCiAgIC8vLyBAcGFyYW0gX2J1eWVyIFRoZSBhZGRyZXNzIG9mIHRoZSBidXllcgogICAvLy8gQHBhcmFtIHRva2VucyBUaGUgYW1vdW50IG9mIHRva2VucyBjb3JyZXNwb25kaW5nIHRvIHRoYXQgYnV5ZXIKICAgZnVuY3Rpb24gZGlzdHJpYnV0ZVByZXNhbGVUb2tlbnMoYWRkcmVzcyBfYnV5ZXIsIHVpbnQgdG9rZW5zKSBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDAgJiYgdG9rZW5zIDw9IDEwZTI0KTsKCiAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGxpbWl0IG9mIDEwTSBwcmVzYWxlIHRva2VucyBoYXNuJ3QgYmVlbiBtZXQgeWV0CiAgICAgIHJlcXVpcmUodG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlIDwgMTBlMjQpOwoKICAgICAgdG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlID0gdG9rZW5zRGlzdHJpYnV0ZWRQcmVzYWxlLmFkZCh0b2tlbnMpOwogICAgICBiYWxhbmNlc1tfYnV5ZXJdID0gYmFsYW5jZXNbX2J1eWVyXS5hZGQodG9rZW5zKTsKICAgfQoKICAgLy8vIEBub3RpY2UgRGlzdHJpYnV0ZXMgdGhlIElDTyB0b2tlbnMuIE9ubHkgdGhlIGNyb3dkc2FsZSBhZGRyZXNzIGNhbiBleGVjdXRlIHRoaXMKICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGJ1eWVyIGFkZHJlc3MKICAgLy8vIEBwYXJhbSB0b2tlbnMgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZCB0byB0aGF0IGFkZHJlc3MKICAgZnVuY3Rpb24gZGlzdHJpYnV0ZUlDT1Rva2VucyhhZGRyZXNzIF9idXllciwgdWludCB0b2tlbnMpIGV4dGVybmFsIG9ubHlDcm93ZHNhbGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUoX2J1eWVyICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKHRva2VucyA+IDApOwoKICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgbGltaXQgb2YgNTBNIElDTyB0b2tlbnMgaGFzbid0IGJlZW4gbWV0IHlldAogICAgICByZXF1aXJlKHRva2Vuc0Rpc3RyaWJ1dGVkQ3Jvd2RzYWxlIDwgNTBlMjQpOwoKICAgICAgdG9rZW5zRGlzdHJpYnV0ZWRDcm93ZHNhbGUgPSB0b2tlbnNEaXN0cmlidXRlZENyb3dkc2FsZS5hZGQodG9rZW5zKTsKICAgICAgYmFsYW5jZXNbX2J1eWVyXSA9IGJhbGFuY2VzW19idXllcl0uYWRkKHRva2Vucyk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIERlbGV0ZXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgcmVmdW5kZWQgZnJvbSB0aGF0IGJ1eWVyIGJhbGFuY2UKICAgLy8vIEBwYXJhbSBfYnV5ZXIgVGhlIGJ1eWVyIHRoYXQgd2FudHMgdGhlIHJlZnVuZAogICAvLy8gQHBhcmFtIHRva2VucyBUaGUgdG9rZW5zIHRvIHJldHVybgogICBmdW5jdGlvbiByZWZ1bmRUb2tlbnMoYWRkcmVzcyBfYnV5ZXIsIHVpbnQyNTYgdG9rZW5zKSBleHRlcm5hbCBvbmx5Q3Jvd2RzYWxlIHdoZW5Ob3RQYXVzZWQgewogICAgICByZXF1aXJlKF9idXllciAhPSBhZGRyZXNzKDApKTsKICAgICAgcmVxdWlyZSh0b2tlbnMgPiAwKTsKICAgICAgcmVxdWlyZShiYWxhbmNlc1tfYnV5ZXJdID49IHRva2Vucyk7CgogICAgICBiYWxhbmNlc1tfYnV5ZXJdID0gYmFsYW5jZXNbX2J1eWVyXS5zdWIodG9rZW5zKTsKICAgICAgUmVmdW5kZWRUb2tlbnMoX2J1eWVyLCB0b2tlbnMpOwogICB9Cn0KCgovKioKICogQHRpdGxlIFJlZnVuZFZhdWx0CiAqIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIGZvciBzdG9yaW5nIGZ1bmRzIHdoaWxlIGEgY3Jvd2RzYWxlCiAqIGlzIGluIHByb2dyZXNzLiBTdXBwb3J0cyByZWZ1bmRpbmcgdGhlIG1vbmV5IGlmIGNyb3dkc2FsZSBmYWlscywKICogYW5kIGZvcndhcmRpbmcgaXQgaWYgY3Jvd2RzYWxlIGlzIHN1Y2Nlc3NmdWwuCiAqLwpjb250cmFjdCBSZWZ1bmRWYXVsdCBpcyBPd25hYmxlIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgZW51bSBTdGF0ZSB7IEFjdGl2ZSwgUmVmdW5kaW5nLCBDbG9zZWQgfQoKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CiAgYWRkcmVzcyBwcml2YXRlIGNyb3dkc2FsZTsKICBTdGF0ZSBwdWJsaWMgc3RhdGU7CiAgdWludDI1NiBwdWJsaWMgd2VpQmFsYW5jZTsKCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZGVwb3NpdGVkOwoKICBldmVudCBSZWZ1bmRzRW5hYmxlZCgpOwogIGV2ZW50IFJlZnVuZGVkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpOwogIGV2ZW50IExvZ0RlcG9zaXRlZChhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBWYXVsdENsb3NlZCgpOwoKICBtb2RpZmllciBvbmx5Q3Jvd2RzYWxlKCkgewogICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3Jvd2RzYWxlKTsKICAgICAgXzsKICB9CgogIGZ1bmN0aW9uIFJlZnVuZFZhdWx0KGFkZHJlc3MgX3dhbGxldCkgewogICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CgogICAgd2FsbGV0ID0gX3dhbGxldDsKICAgIGNyb3dkc2FsZSA9IG1zZy5zZW5kZXI7CiAgICBzdGF0ZSA9IFN0YXRlLkFjdGl2ZTsKICB9CgogIGZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyBpbnZlc3RvcikgZXh0ZXJuYWwgcGF5YWJsZSBvbmx5Q3Jvd2RzYWxlIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKCiAgICB3ZWlCYWxhbmNlID0gd2VpQmFsYW5jZS5hZGQobXNnLnZhbHVlKTsKICAgIGRlcG9zaXRlZFtpbnZlc3Rvcl0gPSBkZXBvc2l0ZWRbaW52ZXN0b3JdLmFkZChtc2cudmFsdWUpOwogICAgTG9nRGVwb3NpdGVkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBjbG9zZSgpIGV4dGVybmFsIG9ubHlDcm93ZHNhbGUgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwoKICAgIHN0YXRlID0gU3RhdGUuQ2xvc2VkOwogICAgd2FsbGV0LnRyYW5zZmVyKHdlaUJhbGFuY2UpOwogICAgVmF1bHRDbG9zZWQoKTsKICB9CgogIGZ1bmN0aW9uIGVuYWJsZVJlZnVuZHMoKSBleHRlcm5hbCBvbmx5Q3Jvd2RzYWxlIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU3RhdGUuQWN0aXZlKTsKCiAgICBzdGF0ZSA9IFN0YXRlLlJlZnVuZGluZzsKICAgIFJlZnVuZHNFbmFibGVkKCk7CiAgfQoKICBmdW5jdGlvbiByZWZ1bmQoYWRkcmVzcyBpbnZlc3RvcikgZXh0ZXJuYWwgb25seUNyb3dkc2FsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFN0YXRlLlJlZnVuZGluZyk7CgogICAgdWludDI1NiBkZXBvc2l0ZWRWYWx1ZSA9IGRlcG9zaXRlZFtpbnZlc3Rvcl07CiAgICB3ZWlCYWxhbmNlID0gd2VpQmFsYW5jZS5zdWIoZGVwb3NpdGVkVmFsdWUpOwogICAgZGVwb3NpdGVkW2ludmVzdG9yXSA9IDA7CiAgICBpbnZlc3Rvci50cmFuc2ZlcihkZXBvc2l0ZWRWYWx1ZSk7CiAgICBSZWZ1bmRlZChpbnZlc3RvciwgZGVwb3NpdGVkVmFsdWUpOwogIH0KfQoKCi8vIDEuIEZpcnN0IHlvdSBzZXQgdGhlIGFkZHJlc3Mgb2YgdGhlIHdhbGxldCBpbiB0aGUgUmVmdW5kVmF1bHQgY29udHJhY3QgdGhhdCB3aWxsIHN0b3JlIHRoZSBkZXBvc2l0IG9mIGV0aGVyCi8vIDIuIElmIHRoZSBnb2FsIGlzIHJlYWNoZWQsIHRoZSBzdGF0ZSBvZiB0aGUgdmF1bHQgd2lsbCBjaGFuZ2UgYW5kIHRoZSBldGhlciB3aWxsIGJlIHNlbnQgdG8gdGhlIGFkZHJlc3MKLy8gMy4gSWYgdGhlIGdvYWwgaXMgbm90IHJlYWNoZWQgYWZ0ZXIgMjggZGF5cywgdGhlIHN0YXRlIG9mIHRoZSB2YXVsdCB3aWxsIGNoYW5nZSB0byByZWZ1bmRpbmcgYW5kIHRoZSB1c2VycyB3aWxsIGJlIGFibGUgdG8gY2FsbCBjbGFpbVJlZnVuZCgpIHRvIGdldCB0aGVpciBldGhlcgoKLy8vIEB0aXRsZSBDcm93ZHNhbGUgY29udHJhY3QgdG8gY2Fycnkgb3V0IGFuIElDTyB3aXRoIHRoZSBQYWxseUNvaW4KLy8vIENyb3dkc2FsZXMgaGF2ZSBhIHN0YXJ0IGFuZCBlbmQgdGltZXN0YW1wcywgd2hlcmUgaW52ZXN0b3JzIGNhbiBtYWtlCi8vLyB0b2tlbiBwdXJjaGFzZXMgYW5kIHRoZSBjcm93ZHNhbGUgd2lsbCBhc3NpZ24gdGhlbSB0b2tlbnMgYmFzZWQKLy8vIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAovLy8gYXMgdGhleSBhcnJpdmUuCi8vLyBAYXV0aG9yIE1lcnVuYXMgR3JpbmNhbGFpdGlzIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iODRlOWUxZjZmMWVhZTVmN2UzZjZlZGVhZTdlNWU4ZTVlZGYwZWRmN2M0ZTNlOWU1ZWRlOGFhZTdlYmU5Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgQ3Jvd2RzYWxlIGlzIFBhdXNhYmxlIHsKICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZAogICBQYWxseUNvaW4gcHVibGljIHRva2VuOwoKICAgLy8gVGhlIHZhdWx0IHRoYXQgd2lsbCBzdG9yZSB0aGUgZXRoZXIgdW50aWwgdGhlIGdvYWwgaXMgcmVhY2hlZAogICBSZWZ1bmRWYXVsdCBwdWJsaWMgdmF1bHQ7CgogICAvLyBUaGUgYmxvY2sgbnVtYmVyIG9mIHdoZW4gdGhlIGNyb3dkc2FsZSBzdGFydHMKICAgLy8gMTAvMTUvMjAxNyBAIDExOjAwYW0gKFVUQykKICAgLy8gMTAvMTUvMjAxNyBAIDEyOjAwYW0gKEdNVCArIDEpCiAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZSA9IDE1MDgwNjUyMDA7CgogICAvLyBUaGUgYmxvY2sgbnVtYmVyIG9mIHdoZW4gdGhlIGNyb3dkc2FsZSBlbmRzCiAgIC8vIDExLzEzLzIwMTcgQCAxMTowMGFtIChVVEMpCiAgIC8vIDExLzEzLzIwMTcgQCAxMjowMHBtIChHTVQgKyAxKQogICB1aW50MjU2IHB1YmxpYyBlbmRUaW1lID0gMTUxMDU3MDgwMDsKCiAgIC8vIFRoZSB3YWxsZXQgdGhhdCBob2xkcyB0aGUgV2VpIHJhaXNlZCBvbiB0aGUgY3Jvd2RzYWxlCiAgIGFkZHJlc3MgcHVibGljIHdhbGxldDsKCiAgIC8vIFRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIuIE9ubHkgYXBwbGllZCBmb3IgdGhlIGZpcnN0IHRpZXIsIHRoZSBmaXJzdAogICAvLyAxMi41IG1pbGxpb24gdG9rZW5zIHNvbGQKICAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgIC8vIFRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIuIE9ubHkgYXBwbGllZCBmb3IgdGhlIHNlY29uZCB0aWVyLCBhdCBiZXR3ZWVuCiAgIC8vIDEyLjUgbWlsbGlvbiB0b2tlbnMgc29sZCBhbmQgMjUgbWlsbGlvbiB0b2tlbnMgc29sZAogICB1aW50MjU2IHB1YmxpYyByYXRlVGllcjI7CgogICAvLyBUaGUgcmF0ZSBvZiB0b2tlbnMgcGVyIGV0aGVyLiBPbmx5IGFwcGxpZWQgZm9yIHRoZSB0aGlyZCB0aWVyLCBhdCBiZXR3ZWVuCiAgIC8vIDI1IG1pbGxpb24gdG9rZW5zIHNvbGQgYW5kIDM3LjUgbWlsbGlvbiB0b2tlbnMgc29sZAogICB1aW50MjU2IHB1YmxpYyByYXRlVGllcjM7CgogICAvLyBUaGUgcmF0ZSBvZiB0b2tlbnMgcGVyIGV0aGVyLiBPbmx5IGFwcGxpZWQgZm9yIHRoZSBmb3VydGggdGllciwgYXQgYmV0d2VlbgogICAvLyAzNy41IG1pbGxpb24gdG9rZW5zIHNvbGQgYW5kIDUwIG1pbGxpb24gdG9rZW5zIHNvbGQKICAgdWludDI1NiBwdWJsaWMgcmF0ZVRpZXI0OwoKICAgLy8gVGhlIGFtb3VudCBvZiB3ZWkgcmFpc2VkCiAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZCA9IDA7CgogICAvLyBUaGUgYW1vdW50IG9mIHRva2VucyByYWlzZWQKICAgdWludDI1NiBwdWJsaWMgdG9rZW5zUmFpc2VkID0gMDsKCiAgIC8vIFlvdSBjYW4gb25seSBidXkgdXAgdG8gNTAgTSB0b2tlbnMgZHVyaW5nIHRoZSBJQ08KICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgbWF4VG9rZW5zUmFpc2VkID0gNTBlMjQ7CgogICAvLyBUaGUgbWluaW11bSBhbW91bnQgb2YgV2VpIHlvdSBtdXN0IHBheSB0byBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlCiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pblB1cmNoYXNlID0gMTAwIGZpbm5leTsgLy8gMC4xIGV0aGVyCgogICAvLyBUaGUgbWF4IGFtb3VudCBvZiBXZWkgdGhhdCB5b3UgY2FuIHBheSB0byBwYXJ0aWNpcGF0ZSBpbiB0aGUgY3Jvd2RzYWxlCiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1heFB1cmNoYXNlID0gMTAwMCBldGhlcjsKCiAgIC8vIE1pbmltdW0gYW1vdW50IG9mIHRva2VucyB0byBiZSByYWlzZWQuIDcuNSBtaWxsaW9uIHRva2VucyB3aGljaCBpcyB0aGUgMTUlCiAgIC8vIG9mIHRoZSB0b3RhbCBvZiA1MCBtaWxsaW9uIHRva2VucyBzb2xkIGluIHRoZSBjcm93ZHNhbGUKICAgLy8gNy41ZTYgKyAxZTE4CiAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IG1pbmltdW1Hb2FsID0gNy41ZTI0OwoKICAgLy8gSWYgdGhlIGNyb3dkc2FsZSB3YXNuJ3Qgc3VjY2Vzc2Z1bCwgdGhpcyB3aWxsIGJlIHRydWUgYW5kIHVzZXJzIHdpbGwgYmUgYWJsZQogICAvLyB0byBjbGFpbSB0aGUgcmVmdW5kIG9mIHRoZWlyIGV0aGVyCiAgIGJvb2wgcHVibGljIGlzUmVmdW5kaW5nID0gZmFsc2U7CgogICAvLyBJZiB0aGUgY3Jvd2RzYWxlIGhhcyBlbmRlZCBvciBub3QKICAgYm9vbCBwdWJsaWMgaXNFbmRlZCA9IGZhbHNlOwoKICAgLy8gSG93IG11Y2ggZWFjaCB1c2VyIHBhaWQgZm9yIHRoZSBjcm93ZHNhbGUKICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjcm93ZHNhbGVCYWxhbmNlczsKCiAgIC8vIEhvdyBtYW55IHRva2VucyBlYWNoIHVzZXIgZ290IGZvciB0aGUgY3Jvd2RzYWxlCiAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5zQm91Z2h0OwoKICAgLy8gVG8gaW5kaWNhdGUgd2hvIHB1cmNoYXNlZCB3aGF0IGFtb3VudCBvZiB0b2tlbnMgYW5kIHdobyByZWNlaXZlZCB3aGF0IGFtb3VudCBvZiB3ZWkKICAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgYnV5ZXIsIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50T2ZUb2tlbnMpOwoKICAgLy8gSW5kaWNhdGVzIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkCiAgIGV2ZW50IEZpbmFsaXplZCgpOwoKICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3Igb2YgdGhlIGNyb3dzYWxlIHRvIHNldCB1cCB0aGUgbWFpbiB2YXJpYWJsZXMgYW5kIGNyZWF0ZSBhIHRva2VuCiAgIC8vLyBAcGFyYW0gX3dhbGxldCBUaGUgd2FsbGV0IGFkZHJlc3MgdGhhdCBzdG9yZXMgdGhlIFdlaSByYWlzZWQKICAgLy8vIEBwYXJhbSBfdG9rZW5BZGRyZXNzIFRoZSB0b2tlbiB1c2VkIGZvciB0aGUgSUNPCiAgIGZ1bmN0aW9uIENyb3dkc2FsZSgKICAgICAgYWRkcmVzcyBfd2FsbGV0LAogICAgICBhZGRyZXNzIF90b2tlbkFkZHJlc3MsCiAgICAgIHVpbnQyNTYgX3N0YXJ0VGltZSwKICAgICAgdWludDI1NiBfZW5kVGltZQogICApIHsKICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICByZXF1aXJlKF90b2tlbkFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CgogICAgICAvLyBJZiB5b3Ugc2VuZCB0aGUgc3RhcnQgYW5kIGVuZCB0aW1lIG9uIHRoZSBjb25zdHJ1Y3RvciwgdGhlIGVuZCBtdXN0IGJlIGxhcmdlcgogICAgICBpZihfc3RhcnRUaW1lID4gMCAmJiBfZW5kVGltZSA+IDApCiAgICAgICAgIHJlcXVpcmUoX3N0YXJ0VGltZSA8IF9lbmRUaW1lKTsKCiAgICAgIHdhbGxldCA9IF93YWxsZXQ7CiAgICAgIHRva2VuID0gUGFsbHlDb2luKF90b2tlbkFkZHJlc3MpOwogICAgICB2YXVsdCA9IG5ldyBSZWZ1bmRWYXVsdChfd2FsbGV0KTsKCiAgICAgIGlmKF9zdGFydFRpbWUgPiAwKQogICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwoKICAgICAgaWYoX2VuZFRpbWUgPiAwKQogICAgICAgICBlbmRUaW1lID0gX2VuZFRpbWU7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEZhbGxiYWNrIGZ1bmN0aW9uIHRvIGJ1eSB0b2tlbnMKICAgZnVuY3Rpb24gKCkgcGF5YWJsZSB7CiAgICAgIGJ1eVRva2VucygpOwogICB9CgogICAvLy8gQG5vdGljZSBUbyBidXkgdG9rZW5zIGdpdmVuIGFuIGFkZHJlc3MKICAgZnVuY3Rpb24gYnV5VG9rZW5zKCkgcHVibGljIHBheWFibGUgd2hlbk5vdFBhdXNlZCB7CiAgICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSgpKTsKCiAgICAgIHVpbnQyNTYgdG9rZW5zID0gMDsKICAgICAgdWludDI1NiBhbW91bnRQYWlkID0gY2FsY3VsYXRlRXhjZXNzQmFsYW5jZSgpOwoKICAgICAgaWYodG9rZW5zUmFpc2VkIDwgMTIuNWUyNCkgewoKICAgICAgICAgLy8gVGllciAxCiAgICAgICAgIHRva2VucyA9IGFtb3VudFBhaWQubXVsKHJhdGUpOwoKICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB5b3Ugd2FudCB0byBidXkgZ2V0cyBvdXQgb2YgdGhpcyB0aWVyCiAgICAgICAgIGlmKHRva2Vuc1JhaXNlZC5hZGQodG9rZW5zKSA+IDEyLjVlMjQpCiAgICAgICAgICAgIHRva2VucyA9IGNhbGN1bGF0ZUV4Y2Vzc1Rva2VucyhhbW91bnRQYWlkLCAxMi41ZTI0LCAxLCByYXRlKTsKICAgICAgfSBlbHNlIGlmKHRva2Vuc1JhaXNlZCA+PSAxMi41ZTI0ICYmIHRva2Vuc1JhaXNlZCA8IDI1ZTI0KSB7CgogICAgICAgICAvLyBUaWVyIDIKICAgICAgICAgdG9rZW5zID0gYW1vdW50UGFpZC5tdWwocmF0ZVRpZXIyKTsKCiAgICAgICAgIC8vIElmIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgeW91IHdhbnQgdG8gYnV5IGdldHMgb3V0IG9mIHRoaXMgdGllcgogICAgICAgICBpZih0b2tlbnNSYWlzZWQuYWRkKHRva2VucykgPiAyNWUyNCkKICAgICAgICAgICAgdG9rZW5zID0gY2FsY3VsYXRlRXhjZXNzVG9rZW5zKGFtb3VudFBhaWQsIDI1ZTI0LCAyLCByYXRlVGllcjIpOwogICAgICB9IGVsc2UgaWYodG9rZW5zUmFpc2VkID49IDI1ZTI0ICYmIHRva2Vuc1JhaXNlZCA8IDM3LjVlMjQpIHsKCiAgICAgICAgIC8vIFRpZXIgMwogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlVGllcjMpOwoKICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCB5b3Ugd2FudCB0byBidXkgZ2V0cyBvdXQgb2YgdGhpcyB0aWVyCiAgICAgICAgIGlmKHRva2Vuc1JhaXNlZC5hZGQodG9rZW5zKSA+IDM3LjVlMjQpCiAgICAgICAgICAgIHRva2VucyA9IGNhbGN1bGF0ZUV4Y2Vzc1Rva2VucyhhbW91bnRQYWlkLCAzNy41ZTI0LCAzLCByYXRlVGllcjMpOwogICAgICB9IGVsc2UgaWYodG9rZW5zUmFpc2VkID49IDM3LjVlMjQpIHsKCiAgICAgICAgIC8vIFRpZXIgNAogICAgICAgICB0b2tlbnMgPSBhbW91bnRQYWlkLm11bChyYXRlVGllcjQpOwogICAgICB9CgogICAgICB3ZWlSYWlzZWQgPSB3ZWlSYWlzZWQuYWRkKGFtb3VudFBhaWQpOwogICAgICB0b2tlbnNSYWlzZWQgPSB0b2tlbnNSYWlzZWQuYWRkKHRva2Vucyk7CiAgICAgIHRva2VuLmRpc3RyaWJ1dGVJQ09Ub2tlbnMobXNnLnNlbmRlciwgdG9rZW5zKTsKCiAgICAgIC8vIEtlZXAgYSByZWNvcmQgb2YgaG93IG1hbnkgdG9rZW5zIGV2ZXJ5Ym9keSBnZXRzIGluIGNhc2Ugd2UgbmVlZCB0byBkbyByZWZ1bmRzCiAgICAgIHRva2Vuc0JvdWdodFttc2cuc2VuZGVyXSA9IHRva2Vuc0JvdWdodFttc2cuc2VuZGVyXS5hZGQodG9rZW5zKTsKICAgICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBhbW91bnRQYWlkLCB0b2tlbnMpOwoKICAgICAgZm9yd2FyZEZ1bmRzKGFtb3VudFBhaWQpOwogICB9CgogICAvLy8gQG5vdGljZSBTZW5kcyB0aGUgZnVuZHMgdG8gdGhlIHdhbGxldCBvciB0byB0aGUgcmVmdW5kIHZhdWx0IHNtYXJ0IGNvbnRyYWN0CiAgIC8vLyBpZiB0aGUgbWluaW11bSBnb2FsIG9mIHRva2VucyBoYXNuJ3QgYmVlbiByZWFjaGVkIHlldAogICAvLy8gQHBhcmFtIGFtb3VudFBhaWQgVGhlIGFtb3VudCBvZiBldGhlciBwYWlkCiAgIGZ1bmN0aW9uIGZvcndhcmRGdW5kcyh1aW50MjU2IGFtb3VudFBhaWQpIGludGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICBpZihnb2FsUmVhY2hlZCgpKSB7CiAgICAgICAgIHdhbGxldC50cmFuc2ZlcihhbW91bnRQYWlkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAgdmF1bHQuZGVwb3NpdC52YWx1ZShhbW91bnRQYWlkKShtc2cuc2VuZGVyKTsKICAgICAgfQoKICAgICAgLy8gSWYgdGhlIG1pbmltdW0gZ29hbCBvZiB0aGUgSUNPIGhhcyBiZWVuIHJlYWNoLCBjbG9zZSB0aGUgdmF1bHQgdG8gc2VuZAogICAgICAvLyB0aGUgZXRoZXIgdG8gdGhlIHdhbGxldCBvZiB0aGUgY3Jvd2RzYWxlCiAgICAgIGNoZWNrQ29tcGxldGVkQ3Jvd2RzYWxlKCk7CiAgIH0KCiAgIC8vLyBAbm90aWNlIENhbGN1bGF0ZXMgaG93IG1hbnkgZXRoZXIgd2lsbCBiZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSB0b2tlbnMgaW4KICAgLy8vIGNhc2UgdGhlIGJ1eWVyIHNlbmRzIG1vcmUgdGhhbiB0aGUgbWF4aW11bSBiYWxhbmNlIGJ1dCBoYXMgc29tZSBiYWxhbmNlIGxlZnQKICAgLy8vIGFuZCB1cGRhdGVzIHRoZSBiYWxhbmNlIG9mIHRoYXQgYnV5ZXIuCiAgIC8vLyBGb3IgaW5zdGFuY2UgaWYgaGUncyA1MDAgYmFsYW5jZSBhbmQgaGUgc2VuZHMgMTAwMCwgaXQgd2lsbCByZXR1cm4gNTAwCiAgIC8vLyBhbmQgcmVmdW5kIHRoZSBvdGhlciA1MDAgZXRoZXIKICAgZnVuY3Rpb24gY2FsY3VsYXRlRXhjZXNzQmFsYW5jZSgpIGludGVybmFsIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgIHVpbnQyNTYgYW1vdW50UGFpZCA9IG1zZy52YWx1ZTsKICAgICAgdWludDI1NiBkaWZmZXJlbmNlV2VpID0gMDsKICAgICAgdWludDI1NiBleGNlZWRpbmdCYWxhbmNlID0gMDsKCiAgICAgIC8vIElmIHdlJ3JlIGluIHRoZSBsYXN0IHRpZXIsIGNoZWNrIHRoYXQgdGhlIGxpbWl0IGhhc24ndCBiZWVuIHJlYWNoZWQKICAgICAgLy8gYW5kIGlmIHNvLCByZWZ1bmQgdGhlIGRpZmZlcmVuY2UgYW5kIHJldHVybiB3aGF0IHdpbGwgYmUgdXNlZCB0bwogICAgICAvLyBidXkgdGhlIHJlbWFpbmluZyB0b2tlbnMKICAgICAgaWYodG9rZW5zUmFpc2VkID49IDM3LjVlMjQpIHsKICAgICAgICAgdWludDI1NiBhZGRlZFRva2VucyA9IHRva2Vuc1JhaXNlZC5hZGQoYW1vdW50UGFpZC5tdWwocmF0ZVRpZXI0KSk7CgogICAgICAgICAvLyBJZiB0b2tlbnNSYWlzZWQgKyB3aGF0IHlvdSBwYWlkIGNvbnZlcnRlZCB0byB0b2tlbnMgaXMgYmlnZ2VyIHRoYW4gdGhlIG1heAogICAgICAgICBpZihhZGRlZFRva2VucyA+IG1heFRva2Vuc1JhaXNlZCkgewoKICAgICAgICAgICAgLy8gUmVmdW5kIHRoZSBkaWZmZXJlbmNlCiAgICAgICAgICAgIHVpbnQyNTYgZGlmZmVyZW5jZSA9IGFkZGVkVG9rZW5zLnN1YihtYXhUb2tlbnNSYWlzZWQpOwogICAgICAgICAgICBkaWZmZXJlbmNlV2VpID0gZGlmZmVyZW5jZS5kaXYocmF0ZVRpZXI0KTsKCiAgICAgICAgICAgIGFtb3VudFBhaWQgPSBhbW91bnRQYWlkLnN1YihkaWZmZXJlbmNlV2VpKTsKICAgICAgICAgfQogICAgICB9CgogICAgICB1aW50MjU2IGFkZGVkQmFsYW5jZSA9IGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChhbW91bnRQYWlkKTsKCiAgICAgIGlmKGFkZGVkQmFsYW5jZSA8PSBtYXhQdXJjaGFzZSkgewogICAgICAgICBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGNyb3dkc2FsZUJhbGFuY2VzW21zZy5zZW5kZXJdLmFkZChhbW91bnRQYWlkKTsKICAgICAgfSBlbHNlIHsKCiAgICAgICAgIC8vIFN1YnN0cmFjdGluZyAxMDAwIGV0aGVyIGluIHdlaQogICAgICAgICBleGNlZWRpbmdCYWxhbmNlID0gYWRkZWRCYWxhbmNlLnN1YihtYXhQdXJjaGFzZSk7CiAgICAgICAgIGFtb3VudFBhaWQgPSBtc2cudmFsdWUuc3ViKGV4Y2VlZGluZ0JhbGFuY2UpOwoKICAgICAgICAgLy8gQWRkIHRoYXQgYmFsYW5jZSB0byB0aGUgYmFsYW5jZXMKICAgICAgICAgY3Jvd2RzYWxlQmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQoYW1vdW50UGFpZCk7CiAgICAgIH0KCiAgICAgIC8vIE1ha2UgdGhlIHRyYW5zZmVycyBhdCB0aGUgZW5kIG9mIHRoZSBmdW5jdGlvbiBmb3Igc2VjdXJpdHkgcHVycG9zZXMKICAgICAgaWYoZGlmZmVyZW5jZVdlaSA+IDApCiAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZGlmZmVyZW5jZVdlaSk7CgogICAgICBpZihleGNlZWRpbmdCYWxhbmNlID4gMCkgewoKICAgICAgICAgLy8gUmV0dXJuIHRoZSBleGNlZWRpbmcgYmFsYW5jZSB0byB0aGUgYnV5ZXIKICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlZWRpbmdCYWxhbmNlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGFtb3VudFBhaWQ7CiAgIH0KCiAgIC8vLyBAbm90aWNlIFNldCdzIHRoZSByYXRlIG9mIHRva2VucyBwZXIgZXRoZXIgZm9yIGVhY2ggdGllci4gVXNlIGl0IGFmdGVyIHRoZQogICAvLy8gc21hcnQgY29udHJhY3QgaXMgZGVwbG95ZWQgdG8gc2V0IHRoZSBwcmljZSBhY2NvcmRpbmcgdG8gdGhlIGV0aGVyIHByaWNlCiAgIC8vLyBhdCB0aGUgc3RhcnQgb2YgdGhlIElDTwogICAvLy8gQHBhcmFtIHRpZXIxIFRoZSBhbW91bnQgb2YgdG9rZW5zIHlvdSBnZXQgaW4gdGhlIHRpZXIgb25lCiAgIC8vLyBAcGFyYW0gdGllcjIgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciB0d28KICAgLy8vIEBwYXJhbSB0aWVyMyBUaGUgYW1vdW50IG9mIHRva2VucyB5b3UgZ2V0IGluIHRoZSB0aWVyIHRocmVlCiAgIC8vLyBAcGFyYW0gdGllcjQgVGhlIGFtb3VudCBvZiB0b2tlbnMgeW91IGdldCBpbiB0aGUgdGllciBmb3VyCiAgIGZ1bmN0aW9uIHNldFRpZXJSYXRlcyh1aW50MjU2IHRpZXIxLCB1aW50MjU2IHRpZXIyLCB1aW50MjU2IHRpZXIzLCB1aW50MjU2IHRpZXI0KQogICAgICBleHRlcm5hbCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZAogICB7CiAgICAgIHJlcXVpcmUodGllcjEgPiAwICYmIHRpZXIyID4gMCAmJiB0aWVyMyA+IDAgJiYgdGllcjQgPiAwKTsKCiAgICAgIHJhdGUgPSB0aWVyMTsKICAgICAgcmF0ZVRpZXIyID0gdGllcjI7CiAgICAgIHJhdGVUaWVyMyA9IHRpZXIzOwogICAgICByYXRlVGllcjQgPSB0aWVyNDsKICAgfQoKICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgdGhlIGNyb3dkc2FsZSBoYXMgZW5kZWQgYW5kIGVuYWJsZXMgcmVmdW5kcyBvbmx5IGluIGNhc2UgdGhlCiAgIC8vLyBnb2FsIGhhc24ndCBiZWVuIHJlYWNoZWQKICAgZnVuY3Rpb24gY2hlY2tDb21wbGV0ZWRDcm93ZHNhbGUoKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgIGlmKCFpc0VuZGVkKSB7CiAgICAgICAgIGlmKGhhc0VuZGVkKCkgJiYgIWdvYWxSZWFjaGVkKCkpewogICAgICAgICAgICB2YXVsdC5lbmFibGVSZWZ1bmRzKCk7CgogICAgICAgICAgICBpc1JlZnVuZGluZyA9IHRydWU7CiAgICAgICAgICAgIGlzRW5kZWQgPSB0cnVlOwogICAgICAgICAgICBGaW5hbGl6ZWQoKTsKICAgICAgICAgfSBlbHNlIGlmKGhhc0VuZGVkKCkgJiYgZ29hbFJlYWNoZWQoKSkgewogICAgICAgICAgICB2YXVsdC5jbG9zZSgpOwoKICAgICAgICAgICAgaXNFbmRlZCA9IHRydWU7CiAgICAgICAgICAgIEZpbmFsaXplZCgpOwogICAgICAgICB9CiAgICAgIH0KICAgfQoKICAgLy8vIEBub3RpY2UgSWYgY3Jvd2RzYWxlIGlzIHVuc3VjY2Vzc2Z1bCwgaW52ZXN0b3JzIGNhbiBjbGFpbSByZWZ1bmRzIGhlcmUKICAgZnVuY3Rpb24gY2xhaW1SZWZ1bmQoKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgcmVxdWlyZShoYXNFbmRlZCgpICYmICFnb2FsUmVhY2hlZCgpICYmIGlzUmVmdW5kaW5nKTsKCiAgICAgdmF1bHQucmVmdW5kKG1zZy5zZW5kZXIpOwogICAgIHRva2VuLnJlZnVuZFRva2Vucyhtc2cuc2VuZGVyLCB0b2tlbnNCb3VnaHRbbXNnLnNlbmRlcl0pOwogICB9CgogICAvLy8gQG5vdGljZSBCdXlzIHRoZSB0b2tlbnMgZm9yIHRoZSBzcGVjaWZpZWQgdGllciBhbmQgZm9yIHRoZSBuZXh0IG9uZQogICAvLy8gQHBhcmFtIGFtb3VudCBUaGUgYW1vdW50IG9mIGV0aGVyIHBhaWQgdG8gYnV5IHRoZSB0b2tlbnMKICAgLy8vIEBwYXJhbSB0b2tlbnNUaGlzVGllciBUaGUgbGltaXQgb2YgdG9rZW5zIG9mIHRoYXQgdGllcgogICAvLy8gQHBhcmFtIHRpZXJTZWxlY3RlZCBUaGUgdGllciBzZWxlY3RlZAogICAvLy8gQHBhcmFtIF9yYXRlIFRoZSByYXRlIHVzZWQgZm9yIHRoYXQgYHRpZXJTZWxlY3RlZGAKICAgLy8vIEByZXR1cm4gdWludCBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBib3VnaHQgY29tYmluaW5nIHRoZSB0aWVyIHByaWNlcwogICBmdW5jdGlvbiBjYWxjdWxhdGVFeGNlc3NUb2tlbnMoCiAgICAgIHVpbnQyNTYgYW1vdW50LAogICAgICB1aW50MjU2IHRva2Vuc1RoaXNUaWVyLAogICAgICB1aW50MjU2IHRpZXJTZWxlY3RlZCwKICAgICAgdWludDI1NiBfcmF0ZQogICApIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgdG90YWxUb2tlbnMpIHsKICAgICAgcmVxdWlyZShhbW91bnQgPiAwICYmIHRva2Vuc1RoaXNUaWVyID4gMCAmJiBfcmF0ZSA+IDApOwogICAgICByZXF1aXJlKHRpZXJTZWxlY3RlZCA+PSAxICYmIHRpZXJTZWxlY3RlZCA8PSA0KTsKCiAgICAgIHVpbnQgd2VpVGhpc1RpZXIgPSB0b2tlbnNUaGlzVGllci5zdWIodG9rZW5zUmFpc2VkKS5kaXYoX3JhdGUpOwogICAgICB1aW50IHdlaU5leHRUaWVyID0gYW1vdW50LnN1Yih3ZWlUaGlzVGllcik7CiAgICAgIHVpbnQgdG9rZW5zTmV4dFRpZXIgPSAwOwoKICAgICAgLy8gSWYgdGhlcmUncyBleGNlc3NpdmUgd2VpIGZvciB0aGUgbGFzdCB0aWVyLCByZWZ1bmQgdGhvc2UKICAgICAgaWYodGllclNlbGVjdGVkICE9IDQpCiAgICAgICAgIHRva2Vuc05leHRUaWVyID0gY2FsY3VsYXRlVG9rZW5zVGllcih3ZWlOZXh0VGllciwgdGllclNlbGVjdGVkLmFkZCgxKSk7CiAgICAgIGVsc2UKICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih3ZWlOZXh0VGllcik7CgogICAgICB0b3RhbFRva2VucyA9IHRva2Vuc1RoaXNUaWVyLnN1Yih0b2tlbnNSYWlzZWQpLmFkZCh0b2tlbnNOZXh0VGllcik7CiAgIH0KCiAgIC8vLyBAbm90aWNlIEJ1eXMgdGhlIHRva2VucyBnaXZlbiB0aGUgcHJpY2Ugb2YgdGhlIHRpZXIgb25lIGFuZCB0aGUgd2VpIHBhaWQKICAgLy8vIEBwYXJhbSB3ZWlQYWlkIFRoZSBhbW91bnQgb2Ygd2VpIHBhaWQgdGhhdCB3aWxsIGJlIHVzZWQgdG8gYnV5IHRva2VucwogICAvLy8gQHBhcmFtIHRpZXJTZWxlY3RlZCBUaGUgdGllciB0aGF0IHlvdSdsbCB1c2UgZm9yIHRoaXIgcHVyY2hhc2UKICAgLy8vIEByZXR1cm4gY2FsY3VsYXRlZFRva2VucyBSZXR1cm5zIGhvdyBtYW55IHRva2VucyB5b3UndmUgYm91Z2h0IGZvciB0aGF0IHdlaSBwYWlkCiAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2Vuc1RpZXIodWludDI1NiB3ZWlQYWlkLCB1aW50MjU2IHRpZXJTZWxlY3RlZCkKICAgICAgICBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgY2FsY3VsYXRlZFRva2VucykKICAgewogICAgICByZXF1aXJlKHdlaVBhaWQgPiAwKTsKICAgICAgcmVxdWlyZSh0aWVyU2VsZWN0ZWQgPj0gMSAmJiB0aWVyU2VsZWN0ZWQgPD0gNCk7CgogICAgICBpZih0aWVyU2VsZWN0ZWQgPT0gMSkKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGUpOwogICAgICBlbHNlIGlmKHRpZXJTZWxlY3RlZCA9PSAyKQogICAgICAgICBjYWxjdWxhdGVkVG9rZW5zID0gd2VpUGFpZC5tdWwocmF0ZVRpZXIyKTsKICAgICAgZWxzZSBpZih0aWVyU2VsZWN0ZWQgPT0gMykKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGVUaWVyMyk7CiAgICAgIGVsc2UKICAgICAgICAgY2FsY3VsYXRlZFRva2VucyA9IHdlaVBhaWQubXVsKHJhdGVUaWVyNCk7CiAgIH0KCgogICAvLy8gQG5vdGljZSBDaGVja3MgaWYgYSBwdXJjaGFzZSBpcyBjb25zaWRlcmVkIHZhbGlkCiAgIC8vLyBAcmV0dXJuIGJvb2wgSWYgdGhlIHB1cmNoYXNlIGlzIHZhbGlkIG9yIG5vdAogICBmdW5jdGlvbiB2YWxpZFB1cmNoYXNlKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgPiAwOwogICAgICBib29sIHdpdGhpblRva2VuTGltaXQgPSB0b2tlbnNSYWlzZWQgPCBtYXhUb2tlbnNSYWlzZWQ7CiAgICAgIGJvb2wgbWluaW11bVB1cmNoYXNlID0gbXNnLnZhbHVlID49IG1pblB1cmNoYXNlOwogICAgICBib29sIGhhc0JhbGFuY2VBdmFpbGFibGUgPSBjcm93ZHNhbGVCYWxhbmNlc1ttc2cuc2VuZGVyXSA8IG1heFB1cmNoYXNlOwoKICAgICAgcmV0dXJuIHdpdGhpblBlcmlvZCAmJiBub25aZXJvUHVyY2hhc2UgJiYgd2l0aGluVG9rZW5MaW1pdCAmJiBtaW5pbXVtUHVyY2hhc2UgJiYgaGFzQmFsYW5jZUF2YWlsYWJsZTsKICAgfQoKICAgLy8vIEBub3RpY2UgVG8gc2VlIGlmIHRoZSBtaW5pbXVtIGdvYWwgb2YgdG9rZW5zIG9mIHRoZSBJQ08gaGFzIGJlZW4gcmVhY2hlZAogICAvLy8gQHJldHVybiBib29sIFRydWUgaWYgdGhlIHRva2VucyByYWlzZWQgYXJlIGJpZ2dlciB0aGFuIHRoZSBnb2FsIG9yIGZhbHNlIG90aGVyd2lzZQogICBmdW5jdGlvbiBnb2FsUmVhY2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgcmV0dXJuIHRva2Vuc1JhaXNlZCA+PSBtaW5pbXVtR29hbDsKICAgfQoKICAgLy8vIEBub3RpY2UgUHVibGljIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBjcm93ZHNhbGUgaGFzIGVuZGVkIG9yIG5vdAogICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgcmV0dXJuIG5vdyA+IGVuZFRpbWUgfHwgdG9rZW5zUmFpc2VkID49IG1heFRva2Vuc1JhaXNlZDsKICAgfQp9'.
	

]
