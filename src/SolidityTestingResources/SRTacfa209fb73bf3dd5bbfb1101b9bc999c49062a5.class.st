Class {
	#name : #SRTacfa209fb73bf3dd5bbfb1101b9bc999c49062a5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTacfa209fb73bf3dd5bbfb1101b9bc999c49062a5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIFZlc3RlZFRva2VuCiAqIEBkZXYgVGhlIFZlc3RlZFRva2VuIGNvbnRyYWN0IGltcGxlbWVudHMgRVJDMjAgc3RhbmRhcmQgYmFzaWNzIGZ1bmN0aW9uIGFuZCAKICogLSB2ZXN0aW5nIGZvciBhbiBhZGRyZXNzCiAqIC0gdG9rZW4gdHJhZGFiaWxpdHkgZGVsYXkKICovCmNvbnRyYWN0IFZlc3RlZFRva2VuIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgCiAgICAvLyBWZXN0ZWQgd2FsbGV0IGFkZHJlc3MKICAgIGFkZHJlc3MgcHVibGljIHZlc3RlZEFkZHJlc3M7CiAgICAvLyBWZXN0aW5nIHRpbWUKICAgIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBWRVNUSU5HX0RFTEFZID0gMSB5ZWFyczsgIAogICAgLy8gVG9rZW4gd2lsbCBiZSB0cmFkYWJsZSBUT0tFTl9UUkFEQUJMRV9ERUxBWSBhZnRlciAKICAgIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBUT0tFTl9UUkFEQUJMRV9ERUxBWSA9IDEyIGRheXM7CgogICAgLy8gVHJ1ZSBpZiBhc2lkZSB0b2tlbnMgaGF2ZSBhbHJlYWR5IGJlZW4gbWludGVkIGFmdGVyIHNlY29uZCByb3VuZAogICAgYm9vbCBwdWJsaWMgYXNpZGVUb2tlbnNIYXZlQmVlbk1pbnRlZCA9IGZhbHNlOwogICAgLy8gV2hlbiBhc2lkZSB0b2tlbnMgaGF2ZSBiZWVuIG1pbnRlZCA/CiAgICB1aW50IHB1YmxpYyBhc2lkZVRva2Vuc01pbnREYXRlOwoKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwogICAgCiAgICBtb2RpZmllciB0cmFuc2ZlckFsbG93ZWQgeyByZXF1aXJlKGFzaWRlVG9rZW5zSGF2ZUJlZW5NaW50ZWQgJiYgbm93ID4gYXNpZGVUb2tlbnNNaW50RGF0ZSArIFRPS0VOX1RSQURBQkxFX0RFTEFZKTsgXzsgfQogICAgCiAgICAvLyBHZXQgdGhlIGJhbGFuY2UgZnJvbSBhbiBhZGRyZXNzCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7IHJldHVybiBiYWxhbmNlc1tfb3duZXJdOyB9ICAKCiAgICAvLyB0cmFuc2ZlciBFUkMyMCBmdW5jdGlvbgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSB0cmFuc2ZlckFsbG93ZWQgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUoX3RvICE9IDB4MCk7CiAgICAgICAgCiAgICAgICAgLy8gZm91bmRlcnMgd2FsbGV0cyBpcyBibG9ja2VkIDEgeWVhcgogICAgICAgIGlmIChtc2cuc2VuZGVyID09IHZlc3RlZEFkZHJlc3MgJiYgKG5vdyA8IChhc2lkZVRva2Vuc01pbnREYXRlICsgVkVTVElOR19ERUxBWSkpKSB7IHJldmVydCgpOyB9CgogICAgICAgIHJldHVybiBwcml2YXRlVHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vIHRyYW5zZmVyRnJvbSBFUkMyMCBmdW5jdGlvbgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgdHJhbnNmZXJBbGxvd2VkIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKF9mcm9tICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gMHgwKTsKICAgICAgICAKICAgICAgICAvLyBmb3VuZGVycyB3YWxsZXQgaXMgYmxvY2tlZCAxIHllYXIKICAgICAgICBpZiAoX2Zyb20gPT0gdmVzdGVkQWRkcmVzcyAmJiAobm93IDwgKGFzaWRlVG9rZW5zTWludERhdGUgKyBWRVNUSU5HX0RFTEFZKSkpIHsgcmV2ZXJ0KCk7IH0KCiAgICAgICAgdWludDI1NiBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gX2FsbG93YW5jZS5zdWIoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIGFwcHJvdmUgRVJDMjAgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBhbGxvd2FuY2UgRVJDMjAgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHByaXZhdGVUcmFuc2ZlciAoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwcml2YXRlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvLyBFdmVudHMgRVJDMjAKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgV2hpdGVsaXN0c1JlZ2lzdHJhdGlvbgogKiBAZGV2IFRoaXMgaXMgYW4gZXh0ZW5zaW9uIHRvIGFkZCAyIGxldmVscyB3aGl0ZWxpc3RzIHRvIHRoZSBjcm93ZHNhbGUKICovCmNvbnRyYWN0IFdoaXRlbGlzdHNSZWdpc3RyYXRpb24gaXMgT3duYWJsZSB7CiAgICAvLyBMaXN0IG9mIHdoaXRlbGlzdGVkIGFkZHJlc3NlcyBmb3IgS1lDIHVuZGVyIDEwIEVUSAogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHNpbHZlcldoaXRlTGlzdDsKICAgIAogICAgLy8gTGlzdCBvZiB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMgZm9yIEtZQyBvdmVyIDEwIEVUSAogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIGdvbGRXaGl0ZUxpc3Q7CiAgICAKICAgIC8vIERpZmZlcmVudCBzdGFnZSBmcm9tIHRoZSBJQ08KICAgIGVudW0gV2hpdGVMaXN0U3RhdGUgewogICAgICAgIC8vIFRoaXMgYWRkcmVzcyBpcyBub3Qgd2hpdGVsaXN0ZWQKICAgICAgICBOb25lLAogICAgICAgIC8vIHRoaXMgYWRkcmVzcyBpcyBvbiB0aGUgc2lsdmVyIHdoaXRlbGlzdAogICAgICAgIFNpbHZlciwKICAgICAgICAvLyB0aGlzIGFkZHJlc3MgaXMgb24gdGhlIGdvbGQgd2hpdGVsaXN0CiAgICAgICAgR29sZAogICAgfQogICAgCiAgICBhZGRyZXNzIHB1YmxpYyB3aGl0ZUxpc3RlcjsKCiAgICBldmVudCBTaWx2ZXJXaGl0ZWxpc3QoYWRkcmVzcyBpbmRleGVkIF9hZGRyZXNzLCBib29sIF9pc1JlZ2lzdGVyZWQpOwogICAgZXZlbnQgR29sZFdoaXRlbGlzdChhZGRyZXNzIGluZGV4ZWQgX2FkZHJlc3MsIGJvb2wgX2lzUmVnaXN0ZXJlZCk7ICAKICAgIGV2ZW50IFNldFdoaXRlbGlzdGVyKGFkZHJlc3MgaW5kZXhlZCBuZXdXaGl0ZUxpc3Rlcik7CiAgICAKICAgIC8qKgogICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIgb3IgdGhlIHdoaXRlbGlzdGVyLgogICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lck9yV2hpdGVMaXN0ZXIoKSB7CiAgICAgICAgcmVxdWlyZSgobXNnLnNlbmRlciA9PSBvd25lcikgfHwgKG1zZy5zZW5kZXIgPT0gd2hpdGVMaXN0ZXIpKTsKICAgIF87CiAgICB9CiAgICAKICAgIC8vIFJldHVybiByZWdpc3RyYXRpb24gc3RhdHVzIG9mIGFuIHNwZWNpZmllZCBhZGRyZXNzCiAgICBmdW5jdGlvbiBjaGVja1JlZ2lzdHJhdGlvblN0YXR1cyhhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoV2hpdGVMaXN0U3RhdGUpIHsKICAgICAgICBpZiAoZ29sZFdoaXRlTGlzdFtfYWRkcmVzc10pIHsgcmV0dXJuIFdoaXRlTGlzdFN0YXRlLkdvbGQ7IH0KICAgICAgICBpZiAoc2lsdmVyV2hpdGVMaXN0W19hZGRyZXNzXSkgeyByZXR1cm4gV2hpdGVMaXN0U3RhdGUuU2lsdmVyOyB9CiAgICAgICAgcmV0dXJuIFdoaXRlTGlzdFN0YXRlLk5vbmU7CiAgICB9CiAgICAKICAgIC8vIENoYW5nZSByZWdpc3RyYXRpb24gc3RhdHVzIGZvciBhbiBhZGRyZXNzIGluIHRoZSB3aGl0ZWxpc3QgZm9yIEtZQyB1bmRlciAxMCBFVEgKICAgIGZ1bmN0aW9uIGNoYW5nZVJlZ2lzdHJhdGlvblN0YXR1c0ZvclNpbHZlcldoaXRlTGlzdChhZGRyZXNzIF9hZGRyZXNzLCBib29sIF9pc1JlZ2lzdGVyZWQpIHB1YmxpYyBvbmx5T3duZXJPcldoaXRlTGlzdGVyIHsKICAgICAgICBzaWx2ZXJXaGl0ZUxpc3RbX2FkZHJlc3NdID0gX2lzUmVnaXN0ZXJlZDsKICAgICAgICBTaWx2ZXJXaGl0ZWxpc3QoX2FkZHJlc3MsIF9pc1JlZ2lzdGVyZWQpOwogICAgfQogICAgCiAgICAvLyBDaGFuZ2UgcmVnaXN0cmF0aW9uIHN0YXR1cyBmb3IgYW4gYWRkcmVzcyBpbiB0aGUgd2hpdGVsaXN0IGZvciBLWUMgb3ZlciAxMCBFVEgKICAgIGZ1bmN0aW9uIGNoYW5nZVJlZ2lzdHJhdGlvblN0YXR1c0ZvckdvbGRXaGl0ZUxpc3QoYWRkcmVzcyBfYWRkcmVzcywgYm9vbCBfaXNSZWdpc3RlcmVkKSBwdWJsaWMgb25seU93bmVyT3JXaGl0ZUxpc3RlciB7CiAgICAgICAgZ29sZFdoaXRlTGlzdFtfYWRkcmVzc10gPSBfaXNSZWdpc3RlcmVkOwogICAgICAgIEdvbGRXaGl0ZWxpc3QoX2FkZHJlc3MsIF9pc1JlZ2lzdGVyZWQpOwogICAgfQogICAgCiAgICAvLyBDaGFuZ2UgcmVnaXN0cmF0aW9uIHN0YXR1cyBmb3Igc2V2ZXJhbCBhZGRyZXNzZXMgaW4gdGhlIHdoaXRlbGlzdCBmb3IgS1lDIHVuZGVyIDEwIEVUSAogICAgZnVuY3Rpb24gbWFzc0NoYW5nZVJlZ2lzdHJhdGlvblN0YXR1c0ZvclNpbHZlcldoaXRlTGlzdChhZGRyZXNzW10gX3RhcmdldHMsIGJvb2wgX2lzUmVnaXN0ZXJlZCkgcHVibGljIG9ubHlPd25lck9yV2hpdGVMaXN0ZXIgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF90YXJnZXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNoYW5nZVJlZ2lzdHJhdGlvblN0YXR1c0ZvclNpbHZlcldoaXRlTGlzdChfdGFyZ2V0c1tpXSwgX2lzUmVnaXN0ZXJlZCk7CiAgICAgICAgfQogICAgfSAKICAgIAogICAgLy8gQ2hhbmdlIHJlZ2lzdHJhdGlvbiBzdGF0dXMgZm9yIHNldmVyYWwgYWRkcmVzc2VzIGluIHRoZSB3aGl0ZWxpc3QgZm9yIEtZQyBvdmVyIDEwIEVUSAogICAgZnVuY3Rpb24gbWFzc0NoYW5nZVJlZ2lzdHJhdGlvblN0YXR1c0ZvckdvbGRXaGl0ZUxpc3QoYWRkcmVzc1tdIF90YXJnZXRzLCBib29sIF9pc1JlZ2lzdGVyZWQpIHB1YmxpYyBvbmx5T3duZXJPcldoaXRlTGlzdGVyIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfdGFyZ2V0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjaGFuZ2VSZWdpc3RyYXRpb25TdGF0dXNGb3JHb2xkV2hpdGVMaXN0KF90YXJnZXRzW2ldLCBfaXNSZWdpc3RlcmVkKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciBvciB3aGl0ZUxpc3RlciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSB3aGl0ZWxpc3QgdG8gYSBuZXdXaGl0ZWxpc3Rlci4KICAgICogQHBhcmFtIF9uZXdXaGl0ZUxpc3RlciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB3aGl0ZWxpc3QgdG8uCiAgICAqLwogICAgZnVuY3Rpb24gc2V0V2hpdGVsaXN0ZXIoYWRkcmVzcyBfbmV3V2hpdGVMaXN0ZXIpIHB1YmxpYyBvbmx5T3duZXJPcldoaXRlTGlzdGVyIHsKICAgICAgcmVxdWlyZShfbmV3V2hpdGVMaXN0ZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgIFNldFdoaXRlbGlzdGVyKF9uZXdXaGl0ZUxpc3Rlcik7CiAgICAgIHdoaXRlTGlzdGVyID0gX25ld1doaXRlTGlzdGVyOwogICAgfQp9CgovKioKICogQHRpdGxlIEJDRFRva2VuCiAqIEBkZXYgVGhlIEJDRFQgY3Jvd2RzYWxlCiAqLwpjb250cmFjdCBCQ0RUb2tlbiBpcyBWZXN0ZWRUb2tlbiwgV2hpdGVsaXN0c1JlZ2lzdHJhdGlvbiB7CiAgICAKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJCbG9ja2NoYWluIENlcnRpZmllZCBEYXRhIFRva2VuIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIkJDRFQiOwogICAgdWludCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCiAgICAvLyBNYXhpbXVtIGNvbnRyaWJ1dGlvbiBpbiBFVEggZm9yIHNpbHZlciB3aGl0ZWxpc3QgCiAgICB1aW50IHByaXZhdGUgY29uc3RhbnQgTUFYX0VUSEVSX0ZPUl9TSUxWRVJfV0hJVEVMSVNUID0gMTAgZXRoZXI7CiAgICAKICAgIC8vIEVUSC9CQ0RUIHJhdGUKICAgIHVpbnQgcHVibGljIHJhdGVFVEhfQkNEVCA9IDEzMDAwOwoKICAgIC8vIFNvZnQgY2FwLCBpZiBub3QgcmVhY2hlZCBjb250cmlidXRvcnMgY2FuIHdpdGhkcmF3IHRoZWlyIGV0aGVycwogICAgdWludCBwdWJsaWMgc29mdENhcCA9IDE4MDAgZXRoZXI7CgogICAgLy8gQ2FwIGluIGV0aGVyIG9mIHByZXNhbGUKICAgIHVpbnQgcHVibGljIHByZXNhbGVDYXAgPSAxODAwIGV0aGVyOwogICAgCiAgICAvLyBDYXAgaW4gZXRoZXIgb2YgUm91bmQgMSAocHJlc2FsZSBjYXAgKyAxODAwIEVUSCkKICAgIHVpbnQgcHVibGljIHJvdW5kMUNhcCA9IDM2MDAgZXRoZXI7ICAgIAogICAgCiAgICAvLyBCQ0QgUmVzZXJ2ZS9Db21tdW5pdHkgV2FsbGV0cwogICAgYWRkcmVzcyBwdWJsaWMgcmVzZXJ2ZUFkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBjb21tdW5pdHlBZGRyZXNzOwoKICAgIC8vIERpZmZlcmVudCBzdGFnZSBmcm9tIHRoZSBJQ08KICAgIGVudW0gU3RhdGUgewogICAgICAgIC8vIElDTyBpc24ndCBzdGFydGVkIHlldCwgaW5pdGlhbCBzdGF0ZQogICAgICAgIEluaXQsCiAgICAgICAgLy8gUHJlc2FsZSBoYXMgc3RhcnRlZAogICAgICAgIFByZXNhbGVSdW5uaW5nLAogICAgICAgIC8vIFByZXNhbGUgaGFzIGVuZGVkCiAgICAgICAgUHJlc2FsZUZpbmlzaGVkLAogICAgICAgIC8vIFJvdW5kIDEgaGFzIHN0YXJ0ZWQKICAgICAgICBSb3VuZDFSdW5uaW5nLAogICAgICAgIC8vIFJvdW5kIDEgaGFzIGVuZGVkCiAgICAgICAgUm91bmQxRmluaXNoZWQsCiAgICAgICAgLy8gUm91bmQgMiBoYXMgc3RhcnRlZAogICAgICAgIFJvdW5kMlJ1bm5pbmcsCiAgICAgICAgLy8gUm91bmQgMiBoYXMgZW5kZWQKICAgICAgICBSb3VuZDJGaW5pc2hlZAogICAgfQogICAgCiAgICAvLyBJbml0aWFsIHN0YXRlIGlzIEluaXQKICAgIFN0YXRlIHB1YmxpYyBjdXJyZW50U3RhdGUgPSBTdGF0ZS5Jbml0OwogICAgCiAgICAvLyBCQ0RUIHRvdGFsIHN1cHBseQogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHkgPSBNQVhfVE9UQUxfQkNEVF9UT19TRUxMOwoKICAgIC8vIEhvdyBtdWNoIHRva2VucyBoYXZlIGJlZW4gc29sZAogICAgdWludDI1NiBwdWJsaWMgdG9rZW5zU29sZDsKICAgIAogICAgLy8gQW1vdW50IG9mIEVUSCByYWlzZWQgZHVyaW5nIElDTwogICAgdWludDI1NiBwcml2YXRlIGV0aGVyUmFpc2VkRHVyaW5nSUNPOwogICAgCiAgICAvLyBNYXhpbXVtIHRvdGFsIG9mIEJDRFQgVG9rZW4gc29sZCBkdXJpbmcgSVRTCiAgICB1aW50IHByaXZhdGUgY29uc3RhbnQgTUFYX1RPVEFMX0JDRFRfVE9fU0VMTCA9IDEwMDAwMDAwMCAqIDEgZXRoZXI7CgogICAgLy8gVG9rZW4gYWxsb2NhdGlvbiBwZXIgbWlsbGUgZm9yIHJlc2VydmUvY29tbXVuaXR5L2ZvdW5kZXJzCiAgICB1aW50IHByaXZhdGUgY29uc3RhbnQgUkVTRVJWRV9BTExPQ0FUSU9OX1BFUl9NSUxMRV9SQVRJTyA9ICAyMDA7CiAgICB1aW50IHByaXZhdGUgY29uc3RhbnQgQ09NTVVOSVRZX0FMTE9DQVRJT05fUEVSX01JTExFX1JBVElPID0gIDEwMzsKICAgIHVpbnQgcHJpdmF0ZSBjb25zdGFudCBGT1VOREVSU19BTExPQ0FUSU9OX1BFUl9NSUxMRV9SQVRJTyA9ICAzMDsKICAgIAogICAgLy8gTGlzdCBvZiBjb250cmlidXRvcnMvY29udHJpYnV0aW9uIGluIEVUSAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGNvbnRyaWJ1dG9yczsKCiAgICAvLyBVc2UgdG8gYWxsb3cgZnVuY3Rpb24gY2FsbCBvbmx5IGlmIGN1cnJlbnRTdGF0ZSBpcyB0aGUgb25lIHNwZWNpZmllZAogICAgbW9kaWZpZXIgaW5TdGF0ZUluaXQoKQogICAgewogICAgICAgIHJlcXVpcmUoY3VycmVudFN0YXRlID09IFN0YXRlLkluaXQpOyAKICAgICAgICBfOyAKICAgIH0KCQogICAgbW9kaWZpZXIgaW5TdGF0ZVJvdW5kMkZpbmlzaGVkKCkKICAgIHsKICAgICAgICByZXF1aXJlKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Sb3VuZDJGaW5pc2hlZCk7IAogICAgICAgIF87IAogICAgfQogICAgCiAgICAvLyBFdmVudCBjYWxsIHdoZW4gYXNpZGUgdG9rZW5zIGFyZSBtaW50ZWQKICAgIGV2ZW50IEFzaWRlVG9rZW5zSGF2ZUJlZW5BbGxvY2F0ZWQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGFtb3VudCk7CiAgICAvLyBFdmVudCBjYWxsIHdoZW4gYSBjb250cmlidXRvciB3aXRoZHJhdyBoaXMgZXRoZXJzCiAgICBldmVudCBXaXRoZHJhdyhhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICAgIC8vIEV2ZW50IGNhbGwgd2hlbiBJQ08gc3RhdGUgY2hhbmdlCiAgICBldmVudCBTdGF0ZUNoYW5nZWQodWludDI1NiB0aW1lc3RhbXAsIFN0YXRlIGN1cnJlbnRTdGF0ZSk7CgogICAgLy8gQ29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIEJDRFRva2VuKCkgcHVibGljIHsKICAgIH0KCiAgICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5QcmVzYWxlUnVubmluZyB8fCBjdXJyZW50U3RhdGUgPT0gU3RhdGUuUm91bmQxUnVubmluZyB8fCBjdXJyZW50U3RhdGUgPT0gU3RhdGUuUm91bmQyUnVubmluZyk7CgogICAgICAgIC8vIG1pbiB0cmFuc2FjdGlvbiBpcyAwLjEgRVRICiAgICAgICAgaWYgKG1zZy52YWx1ZSA8IDEwMCBmaW5uZXkpIHsgcmV2ZXJ0KCk7IH0KCiAgICAgICAgLy8gSWYgeW91J3JlIG5vdCBpbiBhbnkgd2hpdGVsaXN0LCB5b3UgY2Fubm90IGNvbnRpbnVlCiAgICAgICAgaWYgKCFzaWx2ZXJXaGl0ZUxpc3RbbXNnLnNlbmRlcl0gJiYgIWdvbGRXaGl0ZUxpc3RbbXNnLnNlbmRlcl0pIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvLyBFVEggc2VudCBieSBjb250cmlidXRvcgogICAgICAgIHVpbnQyNTYgZXRoU2VudCA9IG1zZy52YWx1ZTsKICAgICAgICAKICAgICAgICAvLyBob3cgbXVjaCBFVEggd2lsbCBiZSB1c2VkIGZvciBjb250cmlidXRpb24KICAgICAgICB1aW50MjU2IGV0aFRvVXNlID0gZXRoU2VudDsKCiAgICAgICAgLy8gQWRkcmVzcyBpcyBvbmx5IGluIHRoZSBzaWx2ZXIgd2hpdGVsaXN0OiBjb250cmlidXRpb24gaXMgY2FwcGVkCiAgICAgICAgaWYgKCFnb2xkV2hpdGVMaXN0W21zZy5zZW5kZXJdKSB7CiAgICAgICAgICAgIC8vIENoZWNrIGlmIGFkZHJlc3MgaGFzIGFscmVhZHkgY29udHJpYnV0ZWQgZm9yIG1heGltdW0gYWxsb3dhbmNlCiAgICAgICAgICAgIGlmIChjb250cmlidXRvcnNbbXNnLnNlbmRlcl0gPj0gTUFYX0VUSEVSX0ZPUl9TSUxWRVJfV0hJVEVMSVNUKSB7CiAgICAgICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBsaW1pdCB0aGUgdG90YWwgY29udHJpYnV0aW9uIHRvIE1BWF9FVEhFUl9GT1JfU0lMVkVSX1dISVRFTElTVAogICAgICAgICAgICBpZiAoY29udHJpYnV0b3JzW21zZy5zZW5kZXJdLmFkZChldGhUb1VzZSkgPiBNQVhfRVRIRVJfRk9SX1NJTFZFUl9XSElURUxJU1QpIHsKICAgICAgICAgICAgICAgIGV0aFRvVXNlID0gTUFYX0VUSEVSX0ZPUl9TSUxWRVJfV0hJVEVMSVNULnN1Yihjb250cmlidXRvcnNbbXNnLnNlbmRlcl0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgICAvLyBDYWxjdWxhdGUgaG93IG11Y2ggRVRIIGFyZSBhdmFpbGFibGUgZm9yIHRoaXMgc3RhZ2UKICAgICAgICB1aW50MjU2IGV0aEF2YWlsYWJsZSA9IGdldFJlbWFpbmluZ0V0aGVyc0ZvckN1cnJlbnRSb3VuZCgpOwogICAgICAgIHVpbnQgcmF0ZSA9IGdldEJDRFRSYXRlRm9yQ3VycmVudFJvdW5kKCk7CgogICAgICAgIC8vIElmIGNhcCBvZiB0aGUgcm91bmQgaGFzIGJlZW4gcmVhY2hlZAogICAgICAgIGlmIChldGhBdmFpbGFibGUgPD0gZXRoVG9Vc2UpIHsKICAgICAgICAgICAgLy8gRW5kIHRoZSByb3VuZAogICAgICAgICAgICBwcml2YXRlU2V0U3RhdGUoZ2V0RW5kZWRTdGF0ZUZvckN1cnJlbnRSb3VuZCgpKTsKICAgICAgICAgICAgLy8gT25seSBhdmFpbGFibGUgZXRoZXJzIHdpbGwgYmUgdXNlZCB0byByZWFjaCB0aGUgY2FwCiAgICAgICAgICAgIGV0aFRvVXNlID0gZXRoQXZhaWxhYmxlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIHNlbmQgaW4gYWNjb3JkYW5jZSB0byByYXRlCiAgICAgICAgdWludDI1NiB0b2tlblRvU2VuZCA9IGV0aFRvVXNlLm11bChyYXRlKTsKICAgICAgICAKICAgICAgICAvLyBBbW91bnQgb2YgdG9rZW5zIHNvbGQgdG8gdGhlIGN1cnJlbnQgY29udHJpYnV0b3JzIGlzIGFkZGVkIHRvIHRvdGFsIHNvbGQKICAgICAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5hZGQodG9rZW5Ub1NlbmQpOwogICAgICAgIC8vIEFtb3VudCBvZiBldGhlcnMgdXNlZCBmb3IgdGhlIGN1cnJlbnQgY29udHJpYnV0aW9uIGlzIGFkZGVkIHRoZSB0b3RhbCByYWlzZWQKICAgICAgICBldGhlclJhaXNlZER1cmluZ0lDTyA9IGV0aGVyUmFpc2VkRHVyaW5nSUNPLmFkZChldGhUb1VzZSk7CiAgICAgICAgLy8gVG9rZW4gYmFsYW5jZSB1cGRhdGVkIGZvciBjdXJyZW50IGNvbnRyaWJ1dG9yCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5hZGQodG9rZW5Ub1NlbmQpOwogICAgICAgIC8vIENvbnRyaWJ1dGlvbiBpcyBzdG9yZWQgZm9yIGFuIHBvdGVudGlhbCB3aXRoZHJhdwogICAgICAgIGNvbnRyaWJ1dG9yc1ttc2cuc2VuZGVyXSA9IGNvbnRyaWJ1dG9yc1ttc2cuc2VuZGVyXS5hZGQoZXRoVG9Vc2UpOwogICAgICAgIAogICAgICAgIC8vIFNlbmQgYmFjayB0aGUgdW51c2VkIGV0aGVycyAgICAgICAgCiAgICAgICAgaWYgKGV0aFRvVXNlIDwgZXRoU2VudCkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGV0aFNlbnQuc3ViKGV0aFRvVXNlKSk7CiAgICAgICAgfQogICAgICAgIC8vIExvZyB0b2tlbiB0cmFuc2ZlciBvcGVyYXRpb24KICAgICAgICBUcmFuc2ZlcigweDAsIG1zZy5zZW5kZXIsIHRva2VuVG9TZW5kKTsgCiAgICB9CgogICAgLy8gQWxsb3cgY29udHJpYnV0b3JzIHRvIHdpdGhkcmF3IGFmdGVyIHRoZSBlbmQgb2YgdGhlIElDTyBpZiB0aGUgc29mdGNhcCBoYXNuJ3QgYmVlbiByZWFjaGVkCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyBpblN0YXRlUm91bmQyRmluaXNoZWQgewogICAgICAgIC8vIE9ubHkgY29udHJpYnV0b3JzIHdpdGggcG9zaXRpdmUgRVRIIGJhbGFuY2UgY291bGQgV2l0aGRyYXcKICAgICAgICBpZihjb250cmlidXRvcnNbbXNnLnNlbmRlcl0gPT0gMCkgeyByZXZlcnQoKTsgfQogICAgICAgIAogICAgICAgIC8vIFdpdGhkcmF3IGlzIHBvc3NpYmxlIG9ubHkgaWYgc29mdGNhcCBoYXMgbm90IGJlZW4gcmVhY2hlZAogICAgICAgIHJlcXVpcmUoZXRoZXJSYWlzZWREdXJpbmdJQ08gPCBzb2Z0Q2FwKTsKICAgICAgICAKICAgICAgICAvLyBHZXQgaG93IG11Y2ggZXRoZXJzIHNlbmRlciBoYXMgY29udHJpYnV0ZQogICAgICAgIHVpbnQyNTYgZXRoVG9TZW5kQmFjayA9IGNvbnRyaWJ1dG9yc1ttc2cuc2VuZGVyXTsKICAgICAgICAKICAgICAgICAvLyBTZXQgY29udHJpYnV0aW9uIHRvIDAgZm9yIHRoZSBjb250cmlidXRvcgogICAgICAgIGNvbnRyaWJ1dG9yc1ttc2cuc2VuZGVyXSA9IDA7CiAgICAgICAgCiAgICAgICAgLy8gU2VuZCBiYWNrIGV0aGVycwogICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIoZXRoVG9TZW5kQmFjayk7CiAgICAgICAgCiAgICAgICAgLy8gTG9nIHdpdGhkcmF3IG9wZXJhdGlvbgogICAgICAgIFdpdGhkcmF3KG1zZy5zZW5kZXIsIGV0aFRvU2VuZEJhY2spOwogICAgfQoKICAgIC8vIEF0IHRoZSBlbmQgb2YgdGhlIHNhbGUsIG1pbnQgdGhlIGFzaWRlIHRva2VucyBmb3IgdGhlIHJlc2VydmUsIGNvbW11bml0eSBhbmQgZm91bmRlcnMKICAgIGZ1bmN0aW9uIG1pbnRBc2lkZVRva2VucygpIHB1YmxpYyBvbmx5T3duZXIgaW5TdGF0ZVJvdW5kMkZpbmlzaGVkIHsKCiAgICAgICAgLy8gUmVzZXJ2ZSwgY29tbXVuaXR5IGFuZCBmb3VuZGVycyBhZGRyZXNzIGhhdmUgdG8gYmUgc2V0IGJlZm9yZSBtaW50IGFzaWRlIHRva2VucwogICAgICAgIHJlcXVpcmUoKHJlc2VydmVBZGRyZXNzICE9IDB4MCkgJiYgKGNvbW11bml0eUFkZHJlc3MgIT0gMHgwKSAmJiAodmVzdGVkQWRkcmVzcyAhPSAweDApKTsKCiAgICAgICAgLy8gQXNpZGUgdG9rZW5zIGNhbiBiZSBtaW50ZWQgb25seSBpZiBzb2Z0Y2FwIGlzIHJlYWNoZWQKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+PSBzb2Z0Q2FwKTsKCiAgICAgICAgLy8gUmV2ZXJ0IGlmIGFzaWRlIHRva2VucyBoYXZlIGFscmVhZHkgYmVlbiBtaW50ZWQgCiAgICAgICAgaWYgKGFzaWRlVG9rZW5zSGF2ZUJlZW5NaW50ZWQpIHsgcmV2ZXJ0KCk7IH0KCiAgICAgICAgLy8gU2V0IG1pbnRlZCBmbGFnIGFuZCBkYXRlCiAgICAgICAgYXNpZGVUb2tlbnNIYXZlQmVlbk1pbnRlZCA9IHRydWU7CiAgICAgICAgYXNpZGVUb2tlbnNNaW50RGF0ZSA9IG5vdzsKCiAgICAgICAgLy8gSWYgMTAwTSBzb2xkLCA1ME0gbW9yZSBoYXZlIHRvIGJlIG1pbnQgKDE1IC8gMTAgPSAqIDEuNSA9ICs1MCUpCiAgICAgICAgdG90YWxTdXBwbHkgPSB0b2tlbnNTb2xkLm11bCgxNSkuZGl2KDEwKTsKCiAgICAgICAgLy8gMjAlIG9mIHRvdGFsIHN1cHBseSBpcyBhbGxvY2F0ZWQgdG8gcmVzZXJ2ZQogICAgICAgIHVpbnQyNTYgX2Ftb3VudE1pbnRlZCA9IHNldEFsbG9jYXRpb24ocmVzZXJ2ZUFkZHJlc3MsIFJFU0VSVkVfQUxMT0NBVElPTl9QRVJfTUlMTEVfUkFUSU8pOwoKICAgICAgICAvLyAxMC4zJSBvZiB0b3RhbCBzdXBwbHkgaXMgYWxsb2NhdGVkIHRvIGNvbW11bml0eQogICAgICAgIF9hbW91bnRNaW50ZWQgPSBfYW1vdW50TWludGVkLmFkZChzZXRBbGxvY2F0aW9uKGNvbW11bml0eUFkZHJlc3MsIENPTU1VTklUWV9BTExPQ0FUSU9OX1BFUl9NSUxMRV9SQVRJTykpOwoKICAgICAgICAvLyAzJSBvZiB0b3RhbCBzdXBwbHkgaXMgYWxsb2NhdGVkIHRvIGZvdW5kZXJzCiAgICAgICAgX2Ftb3VudE1pbnRlZCA9IF9hbW91bnRNaW50ZWQuYWRkKHNldEFsbG9jYXRpb24odmVzdGVkQWRkcmVzcywgRk9VTkRFUlNfQUxMT0NBVElPTl9QRVJfTUlMTEVfUkFUSU8pKTsKICAgICAgICAKICAgICAgICAvLyB0aGUgYWxsb2NhdGlvbiBpcyBvbmx5IDMzLjMlKjE1MC8xMDAgPSA0OS45NSUgb2YgdGhlIHRva2VuIHNvbGRzLiBJdCBpcyB0aGVyZWZvcmUgc2xpZ2h0bHkgaGlnaGVyIHRoYW4gaXQgc2hvdWxkLgogICAgICAgIC8vIHRvIGF2b2lkIHRoYXQsIHdlIGNvcnJlY3QgdGhlIHJlYWwgdG90YWwgbnVtYmVyIG9mIHRva2VucwogICAgICAgIHRvdGFsU3VwcGx5ID0gdG9rZW5zU29sZC5hZGQoX2Ftb3VudE1pbnRlZCk7CiAgICAgICAgLy8gU2VuZCB0aGUgZXRoIHRvIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QKICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRUb2tlbkFzaWRlQWRkcmVzc2VzKGFkZHJlc3MgX3Jlc2VydmVBZGRyZXNzLCBhZGRyZXNzIF9jb21tdW5pdHlBZGRyZXNzLCBhZGRyZXNzIF9mb3VuZGVyQWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfcmVzZXJ2ZUFkZHJlc3MgIT0gMHgwICYmIF9jb21tdW5pdHlBZGRyZXNzICE9IDB4MCAmJiBfZm91bmRlckFkZHJlc3MgIT0gMHgwKTsKCiAgICAgICAgLy8gUmV2ZXJ0IHdoZW4gYXNpZGUgdG9rZW5zIGhhdmUgYWxyZWFkeSBiZWVuIG1pbnRlZCAKICAgICAgICBpZiAoYXNpZGVUb2tlbnNIYXZlQmVlbk1pbnRlZCkgeyByZXZlcnQoKTsgfQoKICAgICAgICByZXNlcnZlQWRkcmVzcyA9IF9yZXNlcnZlQWRkcmVzczsKICAgICAgICBjb21tdW5pdHlBZGRyZXNzID0gX2NvbW11bml0eUFkZHJlc3M7CiAgICAgICAgdmVzdGVkQWRkcmVzcyA9IF9mb3VuZGVyQWRkcmVzczsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdXBkYXRlQ2Fwc0FuZFJhdGUodWludCBfcHJlc2FsZUNhcEluRVRILCB1aW50IF9yb3VuZDFDYXBJbkVUSCwgdWludCBfc29mdENhcEluRVRILCB1aW50IF9yYXRlRVRIX0JDRFQpIHB1YmxpYyBvbmx5T3duZXIgaW5TdGF0ZUluaXQgewogICAgICAgICAgICAKICAgICAgICAvLyBDYXBzIGFuZCByYXRlIGFyZSB1cGRhdGFibGUgdW50aWwgSUNPIHN0YXJ0cwogICAgICAgIHJlcXVpcmUoX3JvdW5kMUNhcEluRVRIID4gX3ByZXNhbGVDYXBJbkVUSCk7CiAgICAgICAgcmVxdWlyZShfcmF0ZUVUSF9CQ0RUICE9IDApOwogICAgICAgIAogICAgICAgIHByZXNhbGVDYXAgPSBfcHJlc2FsZUNhcEluRVRIICogMSBldGhlcjsKICAgICAgICByb3VuZDFDYXAgPSBfcm91bmQxQ2FwSW5FVEggKiAxIGV0aGVyOwogICAgICAgIHNvZnRDYXAgPSBfc29mdENhcEluRVRIICogMSBldGhlcjsKICAgICAgICByYXRlRVRIX0JDRFQgPSBfcmF0ZUVUSF9CQ0RUOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRSZW1haW5pbmdFdGhlcnNGb3JDdXJyZW50Um91bmQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoY3VycmVudFN0YXRlICE9IFN0YXRlLkluaXQpOyAKICAgICAgICByZXF1aXJlKCFhc2lkZVRva2Vuc0hhdmVCZWVuTWludGVkKTsKICAgICAgICAKICAgICAgICBpZigoY3VycmVudFN0YXRlID09IFN0YXRlLlByZXNhbGVSdW5uaW5nKSB8fCAoY3VycmVudFN0YXRlID09IFN0YXRlLlByZXNhbGVGaW5pc2hlZCkpIHsKICAgICAgICAgICAgLy8gUHJlc2FsZSBjYXAgaXMgZml4ZWQgaW4gRVRICiAgICAgICAgICAgIHJldHVybiBwcmVzYWxlQ2FwLnN1YihldGhlclJhaXNlZER1cmluZ0lDTyk7CiAgICAgICAgfQogICAgICAgIGlmKChjdXJyZW50U3RhdGUgPT0gU3RhdGUuUm91bmQxUnVubmluZykgfHwgKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Sb3VuZDFGaW5pc2hlZCkpIHsKICAgICAgICAgICAgLy8gUm91bmQgMSBjYXAgaXMgZml4ZWQgaW4gRVRICiAgICAgICAgICAgIHJldHVybiByb3VuZDFDYXAuc3ViKGV0aGVyUmFpc2VkRHVyaW5nSUNPKTsKICAgICAgICB9CiAgICAgICAgaWYoKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Sb3VuZDJSdW5uaW5nKSB8fCAoY3VycmVudFN0YXRlID09IFN0YXRlLlJvdW5kMkZpbmlzaGVkKSkgewogICAgICAgICAgICAvLyBSb3VuZCAyIGNhcCBpcyBsaW1pdGVkIGluIHRva2VucywgCiAgICAgICAgICAgIHVpbnQyNTYgcmVtYWluaW5nVG9rZW5zID0gdG90YWxTdXBwbHkuc3ViKHRva2Vuc1NvbGQpOwogICAgICAgICAgICAvLyBFVEggYXZhaWxhYmxlIGlzIGNhbGN1bGF0ZWQgZnJvbSB0aGUgbnVtYmVyIG9mIHJlbWFpbmluZyB0b2tlbnMgcmVnYXJkaW5nIHRoZSByYXRlCiAgICAgICAgICAgIHJldHVybiByZW1haW5pbmdUb2tlbnMuZGl2KHJhdGVFVEhfQkNEVCk7CiAgICAgICAgfSAgICAgICAgCiAgICB9ICAgCgogICAgZnVuY3Rpb24gZ2V0QkNEVFJhdGVGb3JDdXJyZW50Um91bmQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoY3VycmVudFN0YXRlID09IFN0YXRlLlByZXNhbGVSdW5uaW5nIHx8IGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Sb3VuZDFSdW5uaW5nIHx8IGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Sb3VuZDJSdW5uaW5nKTsgICAgICAgICAgICAgIAogICAgICAgIAogICAgICAgIC8vIEVUSC9CQ0RUIHJhdGUgZHVyaW5nIHByZXNhbGU6IDIwJSBib251cwogICAgICAgIGlmKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5QcmVzYWxlUnVubmluZykgewogICAgICAgICAgICByZXR1cm4gcmF0ZUVUSF9CQ0RUICsgcmF0ZUVUSF9CQ0RUICogMjAgLyAxMDA7CiAgICAgICAgfQogICAgICAgIC8vIEVUSC9CQ0RUIHJhdGUgZHVyaW5nIHByZXNhbGU6IDEwJSBib251cwogICAgICAgIGlmKGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Sb3VuZDFSdW5uaW5nKSB7CiAgICAgICAgICAgIHJldHVybiByYXRlRVRIX0JDRFQgKyByYXRlRVRIX0JDRFQgKiAxMCAvIDEwMDsKICAgICAgICB9CiAgICAgICAgaWYoY3VycmVudFN0YXRlID09IFN0YXRlLlJvdW5kMlJ1bm5pbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHJhdGVFVEhfQkNEVDsKICAgICAgICB9ICAgICAgICAKICAgIH0gIAoKICAgIGZ1bmN0aW9uIHNldFN0YXRlKFN0YXRlIF9uZXdTdGF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcHJpdmF0ZVNldFN0YXRlKF9uZXdTdGF0ZSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHByaXZhdGVTZXRTdGF0ZShTdGF0ZSBfbmV3U3RhdGUpIHByaXZhdGUgewogICAgICAgIC8vIG5vIHdheSB0byBnbyBiYWNrICAgIAogICAgICAgIGlmKF9uZXdTdGF0ZSA8PSBjdXJyZW50U3RhdGUpIHsgcmV2ZXJ0KCk7IH0KICAgICAgICAKICAgICAgICBjdXJyZW50U3RhdGUgPSBfbmV3U3RhdGU7CiAgICAgICAgU3RhdGVDaGFuZ2VkKG5vdywgY3VycmVudFN0YXRlKTsKICAgIH0KICAgIAogICAgCiAgICBmdW5jdGlvbiBnZXRFbmRlZFN0YXRlRm9yQ3VycmVudFJvdW5kKCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChTdGF0ZSkgewogICAgICAgIHJlcXVpcmUoY3VycmVudFN0YXRlID09IFN0YXRlLlByZXNhbGVSdW5uaW5nIHx8IGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Sb3VuZDFSdW5uaW5nIHx8IGN1cnJlbnRTdGF0ZSA9PSBTdGF0ZS5Sb3VuZDJSdW5uaW5nKTsKICAgICAgICAKICAgICAgICBpZihjdXJyZW50U3RhdGUgPT0gU3RhdGUuUHJlc2FsZVJ1bm5pbmcpIHsKICAgICAgICAgICAgcmV0dXJuIFN0YXRlLlByZXNhbGVGaW5pc2hlZDsKICAgICAgICB9CiAgICAgICAgaWYoY3VycmVudFN0YXRlID09IFN0YXRlLlJvdW5kMVJ1bm5pbmcpIHsKICAgICAgICAgICAgcmV0dXJuIFN0YXRlLlJvdW5kMUZpbmlzaGVkOwogICAgICAgIH0KICAgICAgICBpZihjdXJyZW50U3RhdGUgPT0gU3RhdGUuUm91bmQyUnVubmluZykgewogICAgICAgICAgICByZXR1cm4gU3RhdGUuUm91bmQyRmluaXNoZWQ7CiAgICAgICAgfSAgICAgICAgCiAgICB9ICAgCgogICAgZnVuY3Rpb24gc2V0QWxsb2NhdGlvbihhZGRyZXNzIF90bywgdWludCBfcmF0aW8pIHByaXZhdGUgb25seU93bmVyIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBBc2lkZSB0b2tlbiBpcyBhIHBlcmNlbnRhZ2Ugb2YgdG90YWxTdXBwbHkKICAgICAgICB1aW50MjU2IHRva2VuQW1vdW50VG9UcmFuc2ZlcnQgPSB0b3RhbFN1cHBseS5tdWwoX3JhdGlvKS5kaXYoMTAwMCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKHRva2VuQW1vdW50VG9UcmFuc2ZlcnQpOwogICAgICAgIEFzaWRlVG9rZW5zSGF2ZUJlZW5BbGxvY2F0ZWQoX3RvLCB0b2tlbkFtb3VudFRvVHJhbnNmZXJ0KTsKICAgICAgICBUcmFuc2ZlcigweDAsIF90bywgdG9rZW5BbW91bnRUb1RyYW5zZmVydCk7CiAgICAgICAgcmV0dXJuIHRva2VuQW1vdW50VG9UcmFuc2ZlcnQ7CiAgICB9Cn0='.
	

]
