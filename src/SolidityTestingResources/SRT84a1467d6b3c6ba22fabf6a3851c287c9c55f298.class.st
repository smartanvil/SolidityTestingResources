Class {
	#name : #SRT84a1467d6b3c6ba22fabf6a3851c287c9c55f298,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT84a1467d6b3c6ba22fabf6a3851c287c9c55f298 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKCmNvbnRyYWN0IFB1bGxQYXlJbnRlcmZhY2UgewogIGZ1bmN0aW9uIGFzeW5jU2VuZChhZGRyZXNzIF9kZXN0KSBwdWJsaWMgcGF5YWJsZTsKfQoKY29udHJhY3QgR292ZXJuYWJsZSB7CgogIC8vIGxpc3Qgb2YgYWRtaW5zLCBjb3VuY2lsIGF0IGZpcnN0IHNwb3QKICBhZGRyZXNzW10gcHVibGljIGFkbWluczsKCiAgZnVuY3Rpb24gR292ZXJuYWJsZSgpIHsKICAgIGFkbWlucy5sZW5ndGggPSAxOwogICAgYWRtaW5zWzBdID0gbXNnLnNlbmRlcjsKICB9CgogIG1vZGlmaWVyIG9ubHlBZG1pbnMoKSB7CiAgICBib29sIGlzQWRtaW4gPSBmYWxzZTsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGFkbWlucy5sZW5ndGg7IGkrKykgewogICAgICBpZiAobXNnLnNlbmRlciA9PSBhZG1pbnNbaV0pIHsKICAgICAgICBpc0FkbWluID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgcmVxdWlyZShpc0FkbWluID09IHRydWUpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIGFkZEFkbWluKGFkZHJlc3MgX2FkbWluKSBwdWJsaWMgb25seUFkbWlucyB7CiAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBhZG1pbnMubGVuZ3RoOyBpKyspIHsKICAgICAgcmVxdWlyZShfYWRtaW4gIT0gYWRtaW5zW2ldKTsKICAgIH0KICAgIHJlcXVpcmUoYWRtaW5zLmxlbmd0aCA8IDEwKTsKICAgIGFkbWluc1thZG1pbnMubGVuZ3RoKytdID0gX2FkbWluOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlQWRtaW4oYWRkcmVzcyBfYWRtaW4pIHB1YmxpYyBvbmx5QWRtaW5zIHsKICAgIHVpbnQyNTYgcG9zID0gYWRtaW5zLmxlbmd0aDsKICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGFkbWlucy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoX2FkbWluID09IGFkbWluc1tpXSkgewogICAgICAgIHBvcyA9IGk7CiAgICAgIH0KICAgIH0KICAgIHJlcXVpcmUocG9zIDwgYWRtaW5zLmxlbmd0aCk7CiAgICAvLyBpZiBub3QgbGFzdCBlbGVtZW50LCBzd2l0Y2ggd2l0aCBsYXN0CiAgICBpZiAocG9zIDwgYWRtaW5zLmxlbmd0aCAtIDEpIHsKICAgICAgYWRtaW5zW3Bvc10gPSBhZG1pbnNbYWRtaW5zLmxlbmd0aCAtIDFdOwogICAgfQogICAgLy8gdGhlbiBjdXQgb2ZmIHRoZSB0YWlsCiAgICBhZG1pbnMubGVuZ3RoLS07CiAgfQoKfQoKCgoKY29udHJhY3QgU3RvcmFnZUVuYWJsZWQgewoKICAvLyBzYXRlbGl0ZSBjb250cmFjdCBhZGRyZXNzZXMKICBhZGRyZXNzIHB1YmxpYyBzdG9yYWdlQWRkcjsKCiAgZnVuY3Rpb24gU3RvcmFnZUVuYWJsZWQoYWRkcmVzcyBfc3RvcmFnZUFkZHIpIHsKICAgIHN0b3JhZ2VBZGRyID0gX3N0b3JhZ2VBZGRyOwogIH0KCgogIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgLy8gIyMjIyMjIyMjIyMgTlVUWiBGVU5DVElPTlMgICMjIyMjIyMjIyMjIyMjIyMKICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKCiAgLy8gYWxsIE51dHogYmFsYW5jZXMKICBmdW5jdGlvbiBiYWJ6QmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gU3RvcmFnZShzdG9yYWdlQWRkcikuZ2V0QmFsKCdOdXR6JywgX293bmVyKTsKICB9CiAgZnVuY3Rpb24gX3NldEJhYnpCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX25ld1ZhbHVlKSBpbnRlcm5hbCB7CiAgICBTdG9yYWdlKHN0b3JhZ2VBZGRyKS5zZXRCYWwoJ051dHonLCBfb3duZXIsIF9uZXdWYWx1ZSk7CiAgfQogIC8vIGFjdGl2ZSBzdXBwbHkgLSBzdW0gb2YgYmFsYW5jZXMgYWJvdmUKICBmdW5jdGlvbiBhY3RpdmVTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gU3RvcmFnZShzdG9yYWdlQWRkcikuZ2V0VUludCgnTnV0eicsICdhY3RpdmVTdXBwbHknKTsKICB9CiAgZnVuY3Rpb24gX3NldEFjdGl2ZVN1cHBseSh1aW50MjU2IF9uZXdBY3RpdmVTdXBwbHkpIGludGVybmFsIHsKICAgIFN0b3JhZ2Uoc3RvcmFnZUFkZHIpLnNldFVJbnQoJ051dHonLCAnYWN0aXZlU3VwcGx5JywgX25ld0FjdGl2ZVN1cHBseSk7CiAgfQogIC8vIGJ1cm4gcG9vbCAtIGluYWN0aXZlIHN1cHBseQogIGZ1bmN0aW9uIGJ1cm5Qb29sKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIFN0b3JhZ2Uoc3RvcmFnZUFkZHIpLmdldFVJbnQoJ051dHonLCAnYnVyblBvb2wnKTsKICB9CiAgZnVuY3Rpb24gX3NldEJ1cm5Qb29sKHVpbnQyNTYgX25ld0J1cm5Qb29sKSBpbnRlcm5hbCB7CiAgICBTdG9yYWdlKHN0b3JhZ2VBZGRyKS5zZXRVSW50KCdOdXR6JywgJ2J1cm5Qb29sJywgX25ld0J1cm5Qb29sKTsKICB9CiAgLy8gcG93ZXIgcG9vbCAtIGluYWN0aXZlIHN1cHBseQogIGZ1bmN0aW9uIHBvd2VyUG9vbCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBTdG9yYWdlKHN0b3JhZ2VBZGRyKS5nZXRVSW50KCdOdXR6JywgJ3Bvd2VyUG9vbCcpOwogIH0KICBmdW5jdGlvbiBfc2V0UG93ZXJQb29sKHVpbnQyNTYgX25ld1Bvd2VyUG9vbCkgaW50ZXJuYWwgewogICAgU3RvcmFnZShzdG9yYWdlQWRkcikuc2V0VUludCgnTnV0eicsICdwb3dlclBvb2wnLCBfbmV3UG93ZXJQb29sKTsKICB9CgoKCgoKICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogIC8vICMjIyMjIyMjIyMjIFBPV0VSICAgRlVOQ1RJT05TICAjIyMjIyMjIyMjIyMjCiAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiAgLy8gYWxsIHBvd2VyIGJhbGFuY2VzCiAgZnVuY3Rpb24gcG93ZXJCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBTdG9yYWdlKHN0b3JhZ2VBZGRyKS5nZXRCYWwoJ1Bvd2VyJywgX293bmVyKTsKICB9CgogIGZ1bmN0aW9uIF9zZXRQb3dlckJhbGFuY2VPZihhZGRyZXNzIF9vd25lciwgdWludDI1NiBfbmV3VmFsdWUpIGludGVybmFsIHsKICAgIFN0b3JhZ2Uoc3RvcmFnZUFkZHIpLnNldEJhbCgnUG93ZXInLCBfb3duZXIsIF9uZXdWYWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBvdXRzdGFuZGluZ1Bvd2VyKCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIFN0b3JhZ2Uoc3RvcmFnZUFkZHIpLmdldFVJbnQoJ1Bvd2VyJywgJ291dHN0YW5kaW5nUG93ZXInKTsKICB9CgogIGZ1bmN0aW9uIF9zZXRPdXRzdGFuZGluZ1Bvd2VyKHVpbnQyNTYgX25ld091dHN0YW5kaW5nUG93ZXIpIGludGVybmFsIHsKICAgIFN0b3JhZ2Uoc3RvcmFnZUFkZHIpLnNldFVJbnQoJ1Bvd2VyJywgJ291dHN0YW5kaW5nUG93ZXInLCBfbmV3T3V0c3RhbmRpbmdQb3dlcik7CiAgfQoKICBmdW5jdGlvbiBhdXRob3JpemVkUG93ZXIoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gU3RvcmFnZShzdG9yYWdlQWRkcikuZ2V0VUludCgnUG93ZXInLCAnYXV0aG9yaXplZFBvd2VyJyk7CiAgfQoKICBmdW5jdGlvbiBfc2V0QXV0aG9yaXplZFBvd2VyKHVpbnQyNTYgX25ld0F1dGhvcml6ZWRQb3dlcikgaW50ZXJuYWwgewogICAgU3RvcmFnZShzdG9yYWdlQWRkcikuc2V0VUludCgnUG93ZXInLCAnYXV0aG9yaXplZFBvd2VyJywgX25ld0F1dGhvcml6ZWRQb3dlcik7CiAgfQoKCiAgZnVuY3Rpb24gZG93bnMoYWRkcmVzcyBfdXNlcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYgdG90YWwsIHVpbnQyNTYgbGVmdCwgdWludDI1NiBzdGFydCkgewogICAgdWludDI1NiByYXdCeXRlcyA9IFN0b3JhZ2Uoc3RvcmFnZUFkZHIpLmdldEJhbCgnUG93ZXJEb3duJywgX3VzZXIpOwogICAgc3RhcnQgPSB1aW50NjQocmF3Qnl0ZXMpOwogICAgbGVmdCA9IHVpbnQ5NihyYXdCeXRlcyA+PiAoNjQpKTsKICAgIHRvdGFsID0gdWludDk2KHJhd0J5dGVzID4+ICg5NiArIDY0KSk7CiAgICByZXR1cm47CiAgfQoKICBmdW5jdGlvbiBfc2V0RG93blJlcXVlc3QoYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IHRvdGFsLCB1aW50MjU2IGxlZnQsIHVpbnQyNTYgc3RhcnQpIGludGVybmFsIHsKICAgIHVpbnQyNTYgcmVzdWx0ID0gdWludDY0KHN0YXJ0KSArIChsZWZ0IDw8IDY0KSArICh0b3RhbCA8PCAoOTYgKyA2NCkpOwogICAgU3RvcmFnZShzdG9yYWdlQWRkcikuc2V0QmFsKCdQb3dlckRvd24nLCBfaG9sZGVyLCByZXN1bHQpOwogIH0KCn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIEdvdmVybmFibGUgewoKICBib29sIHB1YmxpYyBwYXVzZWQgPSB0cnVlOwoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IG1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBOT1QgcGF1c2VkCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlBZG1pbnMgd2hlbk5vdFBhdXNlZCB7CiAgICBwYXVzZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlBZG1pbnMgd2hlblBhdXNlZCB7CiAgICAvL1RPRE86IGRvIHNvbWUgY2hlY2tzCiAgICBwYXVzZWQgPSBmYWxzZTsKICB9Cgp9CgoKLyoKICogRVJDMjBCYXNpYwogKiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwp9Cgpjb250cmFjdCBFUkMyMjNCYXNpYyBpcyBFUkMyMEJhc2ljIHsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpIHJldHVybnMgKGJvb2wpOwp9CgovKgogKiBFUkMyMCBpbnRlcmZhY2UKICogc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjIzQmFzaWMgewogIC8vIGFjdGl2ZSBzdXBwbHkgb2YgdG9rZW5zCiAgZnVuY3Rpb24gYWN0aXZlU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsgICAgICAKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgUG93ZXIgaXMgT3duYWJsZSwgRVJDMjBCYXNpYyB7CgogIGV2ZW50IFNsYXNoaW5nKGFkZHJlc3MgaW5kZXhlZCBob2xkZXIsIHVpbnQgdmFsdWUsIGJ5dGVzMzIgZGF0YSk7CgogIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJBY2VidXN0ZXJzIFBvd2VyIjsKICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJBQlAiOwogIHVpbnQyNTYgcHVibGljIGRlY2ltYWxzID0gMTI7CgoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfaG9sZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gQ29udHJvbGxlckludGVyZmFjZShvd25lcikucG93ZXJCYWxhbmNlT2YoX2hvbGRlcik7CiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS5wb3dlclRvdGFsU3VwcGx5KCk7CiAgfQoKICBmdW5jdGlvbiBhY3RpdmVTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gQ29udHJvbGxlckludGVyZmFjZShvd25lcikub3V0c3RhbmRpbmdQb3dlcigpOwogIH0KCgogIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgLy8gIyMjIyMjIyMjIyMgQURNSU4gRlVOQ1RJT05TICMjIyMjIyMjIyMjIyMjIyMKICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKICBmdW5jdGlvbiBzbGFzaFBvd2VyKGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiBfdmFsdWUsIGJ5dGVzMzIgX2RhdGEpIHB1YmxpYyBvbmx5T3duZXIgewogICAgU2xhc2hpbmcoX2hvbGRlciwgX3ZhbHVlLCBfZGF0YSk7CiAgfQoKICBmdW5jdGlvbiBwb3dlclVwKGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgLy8gTlRaIHRyYW5zZmVyZWQgZnJvbSB1c2VyJ3MgYmFsYW5jZSB0byBwb3dlciBwb29sCiAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfaG9sZGVyLCBfdmFsdWUpOwogIH0KCiAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAvLyAjIyMjIyMjIyMjIyBQVUJMSUMgRlVOQ1RJT05TICMjIyMjIyMjIyMjIyMjIwogIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogIC8vIHJlZ2lzdGVycyBhIHBvd2VyZG93biByZXF1ZXN0CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudFBvd2VyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBtYWtlIFBvd2VyIG5vdCB0cmFuc2ZlcmFibGUKICAgIHJlcXVpcmUoX3RvID09IGFkZHJlc3MoMCkpOwogICAgQ29udHJvbGxlckludGVyZmFjZShvd25lcikuY3JlYXRlRG93blJlcXVlc3QobXNnLnNlbmRlciwgX2Ftb3VudFBvd2VyKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIGFkZHJlc3MoMCksIF9hbW91bnRQb3dlcik7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRvd250aW1lKCkgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIENvbnRyb2xsZXJJbnRlcmZhY2Uob3duZXIpLmRvd250aW1lOwogIH0KCiAgZnVuY3Rpb24gZG93blRpY2soYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB7CiAgICBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS5kb3duVGljayhfb3duZXIsIG5vdyk7CiAgfQoKICBmdW5jdGlvbiBkb3ducyhhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQyNTYsIHVpbnQyNTYsIHVpbnQyNTYpIHsKICAgIHJldHVybiBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS5kb3ducyhfb3duZXIpOwogIH0KCn0KCgpjb250cmFjdCBTdG9yYWdlIGlzIE93bmFibGUgewogICAgc3RydWN0IENyYXRlIHsKICAgICAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gdWludDI1NikgdWludHM7CiAgICAgICAgbWFwcGluZyhieXRlczMyID0+IGFkZHJlc3MpIGFkZHJlc3NlczsKICAgICAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gYm9vbCkgYm9vbHM7CiAgICAgICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIGJhbHM7CiAgICB9CgogICAgbWFwcGluZyhieXRlczMyID0+IENyYXRlKSBjcmF0ZXM7CgogICAgZnVuY3Rpb24gc2V0VUludChieXRlczMyIF9jcmF0ZSwgYnl0ZXMzMiBfa2V5LCB1aW50MjU2IF92YWx1ZSkgb25seU93bmVyIHsKICAgICAgICBjcmF0ZXNbX2NyYXRlXS51aW50c1tfa2V5XSA9IF92YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRVSW50KGJ5dGVzMzIgX2NyYXRlLCBieXRlczMyIF9rZXkpIGNvbnN0YW50IHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiBjcmF0ZXNbX2NyYXRlXS51aW50c1tfa2V5XTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBZGRyZXNzKGJ5dGVzMzIgX2NyYXRlLCBieXRlczMyIF9rZXksIGFkZHJlc3MgX3ZhbHVlKSBvbmx5T3duZXIgewogICAgICAgIGNyYXRlc1tfY3JhdGVdLmFkZHJlc3Nlc1tfa2V5XSA9IF92YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKGJ5dGVzMzIgX2NyYXRlLCBieXRlczMyIF9rZXkpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcykgewogICAgICAgIHJldHVybiBjcmF0ZXNbX2NyYXRlXS5hZGRyZXNzZXNbX2tleV07CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Qm9vbChieXRlczMyIF9jcmF0ZSwgYnl0ZXMzMiBfa2V5LCBib29sIF92YWx1ZSkgb25seU93bmVyIHsKICAgICAgICBjcmF0ZXNbX2NyYXRlXS5ib29sc1tfa2V5XSA9IF92YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCb29sKGJ5dGVzMzIgX2NyYXRlLCBieXRlczMyIF9rZXkpIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBjcmF0ZXNbX2NyYXRlXS5ib29sc1tfa2V5XTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRCYWwoYnl0ZXMzMiBfY3JhdGUsIGFkZHJlc3MgX2tleSwgdWludDI1NiBfdmFsdWUpIG9ubHlPd25lciB7CiAgICAgICAgY3JhdGVzW19jcmF0ZV0uYmFsc1tfa2V5XSA9IF92YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCYWwoYnl0ZXMzMiBfY3JhdGUsIGFkZHJlc3MgX2tleSkgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGNyYXRlc1tfY3JhdGVdLmJhbHNbX2tleV07CiAgICB9Cn0KCgpjb250cmFjdCBOdXR6RW5hYmxlZCBpcyBQYXVzYWJsZSwgU3RvcmFnZUVuYWJsZWQgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwoKICAvLyBzYXRlbGl0ZSBjb250cmFjdCBhZGRyZXNzZXMKICBhZGRyZXNzIHB1YmxpYyBudXR6QWRkcjsKCgogIG1vZGlmaWVyIG9ubHlOdXR6KCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG51dHpBZGRyKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBOdXR6RW5hYmxlZChhZGRyZXNzIF9udXR6QWRkciwgYWRkcmVzcyBfc3RvcmFnZUFkZHIpCiAgICBTdG9yYWdlRW5hYmxlZChfc3RvcmFnZUFkZHIpIHsKICAgIG51dHpBZGRyID0gX251dHpBZGRyOwogIH0KCiAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAvLyAjIyMjIyMjIyMjIyBOVVRaIEZVTkNUSU9OUyAgIyMjIyMjIyMjIyMjIyMjIwogIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgogIC8vIHRvdGFsIHN1cHBseShtb2RpZmllZCBmb3IgZXRoZXJzY2FuIGRpc3BsYXkpCiAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYWN0aXZlU3VwcGx5KCk7CiAgfQoKICAvLyB0b3RhbCBzdXBwbHkoZm9yIGludGVybmFsIGNhbGN1bGF0aW9ucykKICBmdW5jdGlvbiBjb21wbGV0ZVN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhY3RpdmVTdXBwbHkoKS5hZGQocG93ZXJQb29sKCkpLmFkZChidXJuUG9vbCgpKTsKICB9CgogIC8vIGFsbG93YW5jZXMgYWNjb3JkaW5nIHRvIEVSQzIwCiAgLy8gbm90IHdyaXR0ZW4gdG8gc3RvcmFnZSwgYXMgbm90IHZlcnkgY3JpdGljYWwKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkpIGludGVybmFsIGFsbG93ZWQ7CgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnRCYWJ6KSBwdWJsaWMgb25seU51dHogd2hlbk5vdFBhdXNlZCB7CiAgICByZXF1aXJlKF9vd25lciAhPSBfc3BlbmRlcik7CiAgICBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdID0gX2Ftb3VudEJhYno7CiAgfQoKICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudEJhYnosIGJ5dGVzIF9kYXRhKSBpbnRlcm5hbCB7CiAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfYW1vdW50QmFieiA+IDApOwogICAgcmVxdWlyZShfZnJvbSAhPSBfdG8pOwogICAgX3NldEJhYnpCYWxhbmNlT2YoX2Zyb20sIGJhYnpCYWxhbmNlT2YoX2Zyb20pLnN1YihfYW1vdW50QmFieikpOwogICAgX3NldEJhYnpCYWxhbmNlT2YoX3RvLCBiYWJ6QmFsYW5jZU9mKF90bykuYWRkKF9hbW91bnRCYWJ6KSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50QmFieiwgYnl0ZXMgX2RhdGEpIHB1YmxpYyBvbmx5TnV0eiB3aGVuTm90UGF1c2VkIHsKICAgIF90cmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50QmFieiwgX2RhdGEpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX3NlbmRlciwgYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudEJhYnosIGJ5dGVzIF9kYXRhKSBwdWJsaWMgb25seU51dHogd2hlbk5vdFBhdXNlZCB7CiAgICBhbGxvd2VkW19mcm9tXVtfc2VuZGVyXSA9IGFsbG93ZWRbX2Zyb21dW19zZW5kZXJdLnN1YihfYW1vdW50QmFieik7CiAgICBfdHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudEJhYnosIF9kYXRhKTsKICB9Cgp9CgoKCgogLyoKICogQ29udHJhY3QgdGhhdCBpcyB3b3JraW5nIHdpdGggRVJDMjIzIHRva2VucwogKi8KIApjb250cmFjdCBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCB7CiAgICBmdW5jdGlvbiB0b2tlbkZhbGxiYWNrKGFkZHJlc3MgX2Zyb20sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSk7Cn0KCgpjb250cmFjdCBDb250cm9sbGVySW50ZXJmYWNlIHsKCgogIC8vIFN0YXRlIFZhcmlhYmxlcwogIGJvb2wgcHVibGljIHBhdXNlZDsKICBhZGRyZXNzIHB1YmxpYyBudXR6QWRkcjsKCiAgLy8gTnV0eiBmdW5jdGlvbnMKICBmdW5jdGlvbiBiYWJ6QmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBhY3RpdmVTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBidXJuUG9vbCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHBvd2VyUG9vbCgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gY29tcGxldGVTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwoKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnRCYWJ6KSBwdWJsaWM7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudEJhYnosIGJ5dGVzIF9kYXRhKSBwdWJsaWM7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX3NlbmRlciwgYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudEJhYnosIGJ5dGVzIF9kYXRhKSBwdWJsaWM7CgogIC8vIE1hcmtldCBmdW5jdGlvbnMKICBmdW5jdGlvbiBmbG9vcigpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIGNlaWxpbmcoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKCiAgZnVuY3Rpb24gcHVyY2hhc2UoYWRkcmVzcyBfc2VuZGVyLCB1aW50MjU2IF92YWx1ZSwgdWludDI1NiBfcHJpY2UpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBzZWxsKGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3ByaWNlLCB1aW50MjU2IF9hbW91bnRCYWJ6KTsKCiAgLy8gUG93ZXIgZnVuY3Rpb25zCiAgZnVuY3Rpb24gcG93ZXJCYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIG91dHN0YW5kaW5nUG93ZXIoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBhdXRob3JpemVkUG93ZXIoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiBwb3dlclRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CgogIGZ1bmN0aW9uIHBvd2VyVXAoYWRkcmVzcyBfc2VuZGVyLCBhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9hbW91bnRCYWJ6KSBwdWJsaWM7CiAgZnVuY3Rpb24gZG93blRpY2soYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX25vdykgcHVibGljOwogIGZ1bmN0aW9uIGNyZWF0ZURvd25SZXF1ZXN0KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hbW91bnRQb3dlcikgcHVibGljOwogIGZ1bmN0aW9uIGRvd25zKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50MjU2LCB1aW50MjU2LCB1aW50MjU2KTsKICBmdW5jdGlvbiBkb3dudGltZSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwp9CgoKLyoqCiAqIEB0aXRsZSBQdWxsUGF5bWVudAogKiBAZGV2IEJhc2UgY29udHJhY3Qgc3VwcG9ydGluZyBhc3luYyBzZW5kIGZvciBwdWxsIHBheW1lbnRzLgogKi8KY29udHJhY3QgUHVsbFBheW1lbnQgaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoKICB1aW50IHB1YmxpYyBkYWlseUxpbWl0ID0gMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDsgIC8vIDEgRVRICiAgdWludCBwdWJsaWMgbGFzdERheTsKICB1aW50IHB1YmxpYyBzcGVudFRvZGF5OwoKICAvLyA4Ynl0ZXMgZGF0ZSwgMjQgYnl0ZXMgdmFsdWUKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgaW50ZXJuYWwgcGF5bWVudHM7CgogIG1vZGlmaWVyIG9ubHlOdXR6KCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IENvbnRyb2xsZXJJbnRlcmZhY2Uob3duZXIpLm51dHpBZGRyKCkpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQgKCkgewogICAgcmVxdWlyZSghQ29udHJvbGxlckludGVyZmFjZShvd25lcikucGF1c2VkKCkpOwogICAgIF87CiAgfQoKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdmFsdWUpIHsKICAgIHJldHVybiB1aW50MTkyKHBheW1lbnRzW19vd25lcl0pOwogIH0KCiAgZnVuY3Rpb24gcGF5bWVudE9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHZhbHVlLCB1aW50MjU2IGRhdGUpIHsKICAgIHZhbHVlID0gdWludDE5MihwYXltZW50c1tfb3duZXJdKTsKICAgIGRhdGUgPSAocGF5bWVudHNbX293bmVyXSA+PiAxOTIpOwogICAgcmV0dXJuOwogIH0KCiAgLy8vIEBkZXYgQWxsb3dzIHRvIGNoYW5nZSB0aGUgZGFpbHkgbGltaXQuIFRyYW5zYWN0aW9uIGhhcyB0byBiZSBzZW50IGJ5IHdhbGxldC4KICAvLy8gQHBhcmFtIF9kYWlseUxpbWl0IEFtb3VudCBpbiB3ZWkuCiAgZnVuY3Rpb24gY2hhbmdlRGFpbHlMaW1pdCh1aW50IF9kYWlseUxpbWl0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgZGFpbHlMaW1pdCA9IF9kYWlseUxpbWl0OwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlV2l0aGRyYXdhbERhdGUoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX25ld0RhdGUpICBwdWJsaWMgb25seU93bmVyIHsKICAgIC8vIGFsbG93IHRvIHdpdGhkcmF3IGltbWVkaWF0ZWx5CiAgICAvLyBtb3ZlIHdpdGRyYXdhbCBkYXRlIG1vcmUgZGF5cyBpbnRvIGZ1dHVyZQogICAgcGF5bWVudHNbX293bmVyXSA9IChfbmV3RGF0ZSA8PCAxOTIpICsgdWludDE5MihwYXltZW50c1tfb3duZXJdKTsKICB9CgogIGZ1bmN0aW9uIGFzeW5jU2VuZChhZGRyZXNzIF9kZXN0KSBwdWJsaWMgcGF5YWJsZSBvbmx5TnV0eiB7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgdWludDI1NiBuZXdWYWx1ZSA9IG1zZy52YWx1ZS5hZGQodWludDE5MihwYXltZW50c1tfZGVzdF0pKTsKICAgIHVpbnQyNTYgbmV3RGF0ZTsKICAgIGlmIChpc1VuZGVyTGltaXQobXNnLnZhbHVlKSkgewogICAgICB1aW50MjU2IGRhdGUgPSBwYXltZW50c1tfZGVzdF0gPj4gMTkyOwogICAgICBuZXdEYXRlID0gKGRhdGUgPiBub3cpID8gZGF0ZSA6IG5vdzsKICAgIH0gZWxzZSB7CiAgICAgIG5ld0RhdGUgPSBub3cuYWRkKDMgZGF5cyk7CiAgICB9CiAgICBzcGVudFRvZGF5ID0gc3BlbnRUb2RheS5hZGQobXNnLnZhbHVlKTsKICAgIHBheW1lbnRzW19kZXN0XSA9IChuZXdEYXRlIDw8IDE5MikgKyB1aW50MTkyKG5ld1ZhbHVlKTsKICB9CgoKICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgIGFkZHJlc3MgdW50cnVzdGVkUmVjaXBpZW50ID0gbXNnLnNlbmRlcjsKICAgIHVpbnQyNTYgYW1vdW50V2VpID0gdWludDE5MihwYXltZW50c1t1bnRydXN0ZWRSZWNpcGllbnRdKTsKCiAgICByZXF1aXJlKGFtb3VudFdlaSAhPSAwKTsKICAgIHJlcXVpcmUobm93ID49IChwYXltZW50c1t1bnRydXN0ZWRSZWNpcGllbnRdID4+IDE5MikpOwogICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gYW1vdW50V2VpKTsKCiAgICBwYXltZW50c1t1bnRydXN0ZWRSZWNpcGllbnRdID0gMDsKCiAgICBhc3NlcnQodW50cnVzdGVkUmVjaXBpZW50LmNhbGwuZ2FzKDEwMDApLnZhbHVlKGFtb3VudFdlaSkoKSk7CiAgfQoKICAvKgogICAqIEludGVybmFsIGZ1bmN0aW9ucwogICAqLwogIC8vLyBAZGV2IFJldHVybnMgaWYgYW1vdW50IGlzIHdpdGhpbiBkYWlseSBsaW1pdCBhbmQgcmVzZXRzIHNwZW50VG9kYXkgYWZ0ZXIgb25lIGRheS4KICAvLy8gQHBhcmFtIGFtb3VudCBBbW91bnQgdG8gd2l0aGRyYXcuCiAgLy8vIEByZXR1cm4gUmV0dXJucyBpZiBhbW91bnQgaXMgdW5kZXIgZGFpbHkgbGltaXQuCiAgZnVuY3Rpb24gaXNVbmRlckxpbWl0KHVpbnQgYW1vdW50KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICBpZiAobm93ID4gbGFzdERheS5hZGQoMjQgaG91cnMpKSB7CiAgICAgIGxhc3REYXkgPSBub3c7CiAgICAgIHNwZW50VG9kYXkgPSAwOwogICAgfQogICAgLy8gbm90IHVzaW5nIHNhZmUgbWF0aCBiZWNhdXNlIHdlIGRvbid0IHdhbnQgdG8gdGhyb3c7CiAgICBpZiAoc3BlbnRUb2RheSArIGFtb3VudCA+IGRhaWx5TGltaXQgfHwgc3BlbnRUb2RheSArIGFtb3VudCA8IHNwZW50VG9kYXkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKCi8qKgogKiBOdXR6IGltcGxlbWVudHMgYSBwcmljZSBmbG9vciBhbmQgYSBwcmljZSBjZWlsaW5nIG9uIHRoZSB0b2tlbiBiZWluZwogKiBzb2xkLiBJdCBpcyBiYXNlZCBvZiB0aGUgemVwcGVsaW4gdG9rZW4gY29udHJhY3QuCiAqLwpjb250cmFjdCBOdXR6IGlzIE93bmFibGUsIEVSQzIwIHsKCiAgZXZlbnQgU2VsbChhZGRyZXNzIGluZGV4ZWQgc2VsbGVyLCB1aW50MjU2IHZhbHVlKTsKCiAgc3RyaW5nIHB1YmxpYyBuYW1lID0gIkFjZWJ1c3RlcnMgTnV0eiI7CiAgLy8gYWNlYnVzdGVycyB1bml0czoKICAvLyAxMF4xMiAtIE51dHogICAoTlRaKQogIC8vIDEwXjkgLSBKb255egogIC8vIDEwXjYgLSBIZWxjegogIC8vIDEwXjMgLSBQYXNjYWx6CiAgLy8gMTBeMCAtIEJhYnoKICBzdHJpbmcgcHVibGljIHN5bWJvbCA9ICJOVFoiOwogIHVpbnQyNTYgcHVibGljIGRlY2ltYWxzID0gMTI7CgogIC8vIHJldHVybnMgYmFsYW5jZXMgb2YgYWN0aXZlIGhvbGRlcnMKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS5iYWJ6QmFsYW5jZU9mKF9vd25lcik7CiAgfQoKICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS50b3RhbFN1cHBseSgpOwogIH0KCiAgZnVuY3Rpb24gYWN0aXZlU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIENvbnRyb2xsZXJJbnRlcmZhY2Uob3duZXIpLmFjdGl2ZVN1cHBseSgpOwogIH0KCiAgLy8gcmV0dXJuIHJlbWFpbmluZyBhbGxvd2FuY2UKICAvLyBpZiBjYWxsaW5nIHJldHVybiBhbGxvd2VkW2FkZHJlc3ModGhpcyldW19zcGVuZGVyXTsKICAvLyByZXR1cm5zIGJhbGFuY2Ugb2YgZXRoZXIgcGFya2VkIHRvIGJlIHdpdGhkcmF3bgogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIENvbnRyb2xsZXJJbnRlcmZhY2Uob3duZXIpLmFsbG93YW5jZShfb3duZXIsIF9zcGVuZGVyKTsKICB9CgogIC8vIHJldHVybnMgZWl0aGVyIHRoZSBzYWxlUHJpY2UsIG9yIGlmIHJlc2VydmUgZG9lcyBub3Qgc3VmZmljZQogIC8vIGZvciBhY3RpdmUgc3VwcGx5LCByZXR1cm5zIG1heEZsb29yCiAgZnVuY3Rpb24gZmxvb3IoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gQ29udHJvbGxlckludGVyZmFjZShvd25lcikuZmxvb3IoKTsKICB9CgogIC8vIHJldHVybnMgZWl0aGVyIHRoZSBzYWxlUHJpY2UsIG9yIGlmIHJlc2VydmUgZG9lcyBub3Qgc3VmZmljZQogIC8vIGZvciBhY3RpdmUgc3VwcGx5LCByZXR1cm5zIG1heEZsb29yCiAgZnVuY3Rpb24gY2VpbGluZygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS5jZWlsaW5nKCk7CiAgfQoKICBmdW5jdGlvbiBwb3dlclBvb2woKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gQ29udHJvbGxlckludGVyZmFjZShvd25lcikucG93ZXJQb29sKCk7CiAgfQoKCiAgZnVuY3Rpb24gX2NoZWNrRGVzdGluYXRpb24oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgaW50ZXJuYWwgewogICAgLy8gZXJjMjIzOiBSZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSBvbiB0YXJnZXQgYWRkcmVzcywgdGhpcyBuZWVkcyBhc3NlbWJseSAuCiAgICB1aW50MjU2IGNvZGVMZW5ndGg7CiAgICBhc3NlbWJseSB7CiAgICAgIGNvZGVMZW5ndGggOj0gZXh0Y29kZXNpemUoX3RvKQogICAgfQogICAgaWYoY29kZUxlbmd0aD4wKSB7CiAgICAgIEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0IHVudHJ1c3RlZFJlY2VpdmVyID0gRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QoX3RvKTsKICAgICAgLy8gdW50cnVzdGVkIGNvbnRyYWN0IGNhbGwKICAgICAgdW50cnVzdGVkUmVjZWl2ZXIudG9rZW5GYWxsYmFjayhfZnJvbSwgX3ZhbHVlLCBfZGF0YSk7CiAgICB9CiAgfQoKCgogIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgLy8gIyMjIyMjIyMjIyMgQURNSU4gRlVOQ1RJT05TICMjIyMjIyMjIyMjIyMjIyMKICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKICBmdW5jdGlvbiBwb3dlckRvd24oYWRkcmVzcyBwb3dlckFkZHIsIGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiBfYW1vdW50QmFieikgcHVibGljIG9ubHlPd25lciB7CiAgICBieXRlcyBtZW1vcnkgZW1wdHk7CiAgICBfY2hlY2tEZXN0aW5hdGlvbihwb3dlckFkZHIsIF9ob2xkZXIsIF9hbW91bnRCYWJ6LCBlbXB0eSk7CiAgICAvLyBOVFogdHJhbnNmZXJlZCBmcm9tIHBvd2VyIHBvb2wgdG8gdXNlcidzIGJhbGFuY2UKICAgIFRyYW5zZmVyKHBvd2VyQWRkciwgX2hvbGRlciwgX2Ftb3VudEJhYnopOwogIH0KCgogIGZ1bmN0aW9uIGFzeW5jU2VuZChhZGRyZXNzIF9wdWxsQWRkciwgYWRkcmVzcyBfZGVzdCwgdWludDI1NiBfYW1vdW50V2VpKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGFzc2VydChfYW1vdW50V2VpIDw9IHRoaXMuYmFsYW5jZSk7CiAgICBQdWxsUGF5SW50ZXJmYWNlKF9wdWxsQWRkcikuYXN5bmNTZW5kLnZhbHVlKF9hbW91bnRXZWkpKF9kZXN0KTsKICB9CgoKICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogIC8vICMjIyMjIyMjIyMjIFBVQkxJQyBGVU5DVElPTlMgIyMjIyMjIyMjIyMjIyMjCiAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnRCYWJ6KSBwdWJsaWMgewogICAgQ29udHJvbGxlckludGVyZmFjZShvd25lcikuYXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudEJhYnopOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnRCYWJ6KTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnRCYWJ6LCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIENvbnRyb2xsZXJJbnRlcmZhY2Uob3duZXIpLnRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudEJhYnosIF9kYXRhKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudEJhYnopOwogICAgX2NoZWNrRGVzdGluYXRpb24obXNnLnNlbmRlciwgX3RvLCBfYW1vdW50QmFieiwgX2RhdGEpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50QmFieikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGJ5dGVzIG1lbW9yeSBlbXB0eTsKICAgIHJldHVybiB0cmFuc2ZlcihfdG8sIF9hbW91bnRCYWJ6LCBlbXB0eSk7CiAgfQoKICBmdW5jdGlvbiB0cmFuc0RhdGEoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudEJhYnosIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRyYW5zZmVyKF90bywgX2Ftb3VudEJhYnosIF9kYXRhKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50QmFieiwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgX2Zyb20sIF90bywgX2Ftb3VudEJhYnosIF9kYXRhKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnRCYWJ6KTsKICAgIF9jaGVja0Rlc3RpbmF0aW9uKF9mcm9tLCBfdG8sIF9hbW91bnRCYWJ6LCBfZGF0YSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50QmFieikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGJ5dGVzIG1lbW9yeSBlbXB0eTsKICAgIHJldHVybiB0cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX2Ftb3VudEJhYnosIGVtcHR5KTsKICB9CgogIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIHVpbnQyNTYgcHJpY2UgPSBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS5jZWlsaW5nKCk7CiAgICBwdXJjaGFzZShwcmljZSk7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogIH0KCiAgZnVuY3Rpb24gcHVyY2hhc2UodWludDI1NiBfcHJpY2UpIHB1YmxpYyBwYXlhYmxlIHsKICAgIHJlcXVpcmUobXNnLnZhbHVlID4gMCk7CiAgICB1aW50MjU2IGFtb3VudEJhYnogPSBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS5wdXJjaGFzZShtc2cuc2VuZGVyLCBtc2cudmFsdWUsIF9wcmljZSk7CiAgICBUcmFuc2Zlcihvd25lciwgbXNnLnNlbmRlciwgYW1vdW50QmFieik7CiAgICBieXRlcyBtZW1vcnkgZW1wdHk7CiAgICBfY2hlY2tEZXN0aW5hdGlvbihhZGRyZXNzKHRoaXMpLCBtc2cuc2VuZGVyLCBhbW91bnRCYWJ6LCBlbXB0eSk7CiAgfQoKICBmdW5jdGlvbiBzZWxsKHVpbnQyNTYgX3ByaWNlLCB1aW50MjU2IF9hbW91bnRCYWJ6KSBwdWJsaWMgewogICAgcmVxdWlyZShfYW1vdW50QmFieiAhPSAwKTsKICAgIENvbnRyb2xsZXJJbnRlcmZhY2Uob3duZXIpLnNlbGwobXNnLnNlbmRlciwgX3ByaWNlLCBfYW1vdW50QmFieik7CiAgICBTZWxsKG1zZy5zZW5kZXIsIF9hbW91bnRCYWJ6KTsKICB9CgogIGZ1bmN0aW9uIHBvd2VyVXAodWludDI1NiBfYW1vdW50QmFieikgcHVibGljIHsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIG93bmVyLCBfYW1vdW50QmFieik7CiAgICBDb250cm9sbGVySW50ZXJmYWNlKG93bmVyKS5wb3dlclVwKG1zZy5zZW5kZXIsIG1zZy5zZW5kZXIsIF9hbW91bnRCYWJ6KTsKICB9Cgp9CgoKY29udHJhY3QgTWFya2V0RW5hYmxlZCBpcyBOdXR6RW5hYmxlZCB7CgogIHVpbnQyNTYgY29uc3RhbnQgSU5GSU5JVFkgPSAweGZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmY7CgogIC8vIGFkZHJlc3Mgb2YgdGhlIHB1bGwgcGF5ZW1udCBzYXRlbGl0ZQogIGFkZHJlc3MgcHVibGljIHB1bGxBZGRyOwoKICAvLyB0aGUgVG9rZW4gc2FsZSBtZWNoYW5pc20gcGFyYW1ldGVyczoKICAvLyBwdXJjaGFzZVByaWNlIGlzIHRoZSBudW1iZXIgb2YgTlRaIHJlY2VpdmVkIGZvciBwdXJjaGFzZSB3aXRoIDEgRVRICiAgdWludDI1NiBpbnRlcm5hbCBwdXJjaGFzZVByaWNlOwoKICAvLyBmbG9vciBpcyB0aGUgbnVtYmVyIG9mIE5UWiBuZWVkZWQsIHRvIHJlY2VpdmUgMSBFVEggaW4gc2VsbAogIHVpbnQyNTYgaW50ZXJuYWwgc2FsZVByaWNlOwoKICBmdW5jdGlvbiBNYXJrZXRFbmFibGVkKGFkZHJlc3MgX3B1bGxBZGRyLCBhZGRyZXNzIF9zdG9yYWdlQWRkciwgYWRkcmVzcyBfbnV0ekFkZHIpCiAgICBOdXR6RW5hYmxlZChfbnV0ekFkZHIsIF9zdG9yYWdlQWRkcikgewogICAgcHVsbEFkZHIgPSBfcHVsbEFkZHI7CiAgfQoKCiAgZnVuY3Rpb24gY2VpbGluZygpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBwdXJjaGFzZVByaWNlOwogIH0KCiAgLy8gcmV0dXJucyBlaXRoZXIgdGhlIHNhbGVQcmljZSwgb3IgaWYgcmVzZXJ2ZSBkb2VzIG5vdCBzdWZmaWNlCiAgLy8gZm9yIGFjdGl2ZSBzdXBwbHksIHJldHVybnMgbWF4Rmxvb3IKICBmdW5jdGlvbiBmbG9vcigpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChudXR6QWRkci5iYWxhbmNlID09IDApIHsKICAgICAgcmV0dXJuIElORklOSVRZOwogICAgfQogICAgdWludDI1NiBtYXhGbG9vciA9IGFjdGl2ZVN1cHBseSgpLm11bCgxMDAwMDAwKS5kaXYobnV0ekFkZHIuYmFsYW5jZSk7IC8vIDEsMDAwLDAwMCBXRUksIHVzZWQgYXMgcHJpY2UgZmFjdG9yCiAgICAvLyByZXR1cm4gbWF4IG9mIG1heEZsb29yIG9yIHNhbGVQcmljZQogICAgcmV0dXJuIG1heEZsb29yID49IHNhbGVQcmljZSA/IG1heEZsb29yIDogc2FsZVByaWNlOwogIH0KCiAgZnVuY3Rpb24gbW92ZUNlaWxpbmcodWludDI1NiBfbmV3UHVyY2hhc2VQcmljZSkgcHVibGljIG9ubHlBZG1pbnMgewogICAgcmVxdWlyZShfbmV3UHVyY2hhc2VQcmljZSA8PSBzYWxlUHJpY2UpOwogICAgcHVyY2hhc2VQcmljZSA9IF9uZXdQdXJjaGFzZVByaWNlOwogIH0KCiAgZnVuY3Rpb24gbW92ZUZsb29yKHVpbnQyNTYgX25ld1NhbGVQcmljZSkgcHVibGljIG9ubHlBZG1pbnMgewogICAgcmVxdWlyZShfbmV3U2FsZVByaWNlID49IHB1cmNoYXNlUHJpY2UpOwogICAgLy8gbW92ZUZsb29yIGZhaWxzIGlmIHRoZSBhZG1pbmlzdHJhdG9yIHRyaWVzIHRvIHB1c2ggdGhlIGZsb29yIHNvIGxvdwogICAgLy8gdGhhdCB0aGUgc2FsZSBtZWNoYW5pc20gaXMgbm8gbG9uZ2VyIGFibGUgdG8gYnV5IGJhY2sgYWxsIHRva2VucyBhdAogICAgLy8gdGhlIGZsb29yIHByaWNlIGlmIHRob3NlIGZ1bmRzIHdlcmUgdG8gYmUgd2l0aGRyYXduLgogICAgaWYgKF9uZXdTYWxlUHJpY2UgPCBJTkZJTklUWSkgewogICAgICByZXF1aXJlKG51dHpBZGRyLmJhbGFuY2UgPj0gYWN0aXZlU3VwcGx5KCkubXVsKDEwMDAwMDApLmRpdihfbmV3U2FsZVByaWNlKSk7IC8vIDEsMDAwLDAwMCBXRUksIHVzZWQgYXMgcHJpY2UgZmFjdG9yCiAgICB9CiAgICBzYWxlUHJpY2UgPSBfbmV3U2FsZVByaWNlOwogIH0KCiAgZnVuY3Rpb24gcHVyY2hhc2UoYWRkcmVzcyBfc2VuZGVyLCB1aW50MjU2IF92YWx1ZSwgdWludDI1NiBfcHJpY2UpIHB1YmxpYyBvbmx5TnV0eiB3aGVuTm90UGF1c2VkIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGRpc2FibGUgcHVyY2hhc2VzIGlmIHB1cmNoYXNlUHJpY2Ugc2V0IHRvIDAKICAgIHJlcXVpcmUocHVyY2hhc2VQcmljZSA+IDApOwogICAgcmVxdWlyZShfcHJpY2UgPT0gcHVyY2hhc2VQcmljZSk7CgogICAgdWludDI1NiBhbW91bnRCYWJ6ID0gcHVyY2hhc2VQcmljZS5tdWwoX3ZhbHVlKS5kaXYoMTAwMDAwMCk7IC8vIDEsMDAwLDAwMCBXRUksIHVzZWQgYXMgcHJpY2UgZmFjdG9yCiAgICAvLyBhdm9pZCBkZXBvc2l0cyB0aGF0IGlzc3VlIG5vdGhpbmcKICAgIC8vIG1pZ2h0IGhhcHBlbiB3aXRoIHZlcnkgaGlnaCBwdXJjaGFzZSBwcmljZQogICAgcmVxdWlyZShhbW91bnRCYWJ6ID4gMCk7CgogICAgLy8gbWFrZSBzdXJlIHBvd2VyIHBvb2wgZ3Jvd3MgcHJvcG9ydGlvbmFsIHRvIGVjb25vbXkKICAgIHVpbnQyNTYgYWN0aXZlU3VwID0gYWN0aXZlU3VwcGx5KCk7CiAgICB1aW50MjU2IHBvd1Bvb2wgPSBwb3dlclBvb2woKTsKICAgIGlmIChwb3dQb29sID4gMCkgewogICAgICB1aW50MjU2IHBvd2VyU2hhcmUgPSBwb3dQb29sLm11bChhbW91bnRCYWJ6KS5kaXYoYWN0aXZlU3VwLmFkZChidXJuUG9vbCgpKSk7CiAgICAgIF9zZXRQb3dlclBvb2wocG93UG9vbC5hZGQocG93ZXJTaGFyZSkpOwogICAgfQogICAgX3NldEFjdGl2ZVN1cHBseShhY3RpdmVTdXAuYWRkKGFtb3VudEJhYnopKTsKICAgIF9zZXRCYWJ6QmFsYW5jZU9mKF9zZW5kZXIsIGJhYnpCYWxhbmNlT2YoX3NlbmRlcikuYWRkKGFtb3VudEJhYnopKTsKICAgIHJldHVybiBhbW91bnRCYWJ6OwogIH0KCiAgZnVuY3Rpb24gc2VsbChhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF9wcmljZSwgdWludDI1NiBfYW1vdW50QmFieikgcHVibGljIG9ubHlOdXR6IHdoZW5Ob3RQYXVzZWQgewogICAgdWludDI1NiBlZmZlY3RpdmVGbG9vciA9IGZsb29yKCk7CiAgICByZXF1aXJlKF9hbW91bnRCYWJ6ICE9IDApOwogICAgcmVxdWlyZShlZmZlY3RpdmVGbG9vciAhPSBJTkZJTklUWSk7CiAgICByZXF1aXJlKF9wcmljZSA9PSBlZmZlY3RpdmVGbG9vcik7CgogICAgdWludDI1NiBhbW91bnRXZWkgPSBfYW1vdW50QmFiei5tdWwoMTAwMDAwMCkuZGl2KGVmZmVjdGl2ZUZsb29yKTsgIC8vIDEsMDAwLDAwMCBXRUksIHVzZWQgYXMgcHJpY2UgZmFjdG9yCiAgICByZXF1aXJlKGFtb3VudFdlaSA+IDApOwogICAgLy8gbWFrZSBzdXJlIHBvd2VyIHBvb2wgc2hyaW5rcyBwcm9wb3J0aW9uYWwgdG8gZWNvbm9teQogICAgdWludDI1NiBwb3dQb29sID0gcG93ZXJQb29sKCk7CiAgICB1aW50MjU2IGFjdGl2ZVN1cCA9IGFjdGl2ZVN1cHBseSgpOwogICAgaWYgKHBvd1Bvb2wgPiAwKSB7CiAgICAgIHVpbnQyNTYgcG93ZXJTaGFyZSA9IHBvd1Bvb2wubXVsKF9hbW91bnRCYWJ6KS5kaXYoYWN0aXZlU3VwLmFkZChidXJuUG9vbCgpKSk7CiAgICAgIF9zZXRQb3dlclBvb2wocG93UG9vbC5zdWIocG93ZXJTaGFyZSkpOwogICAgfQogICAgX3NldEFjdGl2ZVN1cHBseShhY3RpdmVTdXAuc3ViKF9hbW91bnRCYWJ6KSk7CiAgICBfc2V0QmFiekJhbGFuY2VPZihfZnJvbSwgYmFiekJhbGFuY2VPZihfZnJvbSkuc3ViKF9hbW91bnRCYWJ6KSk7CiAgICBOdXR6KG51dHpBZGRyKS5hc3luY1NlbmQocHVsbEFkZHIsIF9mcm9tLCBhbW91bnRXZWkpOwogIH0KCgogIC8vIHdpdGhkcmF3IGV4Y2Vzc2l2ZSByZXNlcnZlIC0gaS5lLiBtaWxlc3RvbmVzCiAgZnVuY3Rpb24gYWxsb2NhdGVFdGhlcih1aW50MjU2IF9hbW91bnRXZWksIGFkZHJlc3MgX2JlbmVmaWNpYXJ5KSBwdWJsaWMgb25seUFkbWlucyB7CiAgICByZXF1aXJlKF9hbW91bnRXZWkgPiAwKTsKICAgIC8vIGFsbG9jYXRlRXRoZXIgZmFpbHMgaWYgYWxsb2NhdGluZyB0aG9zZSBmdW5kcyB3b3VsZCBtZWFuIHRoYXQgdGhlCiAgICAvLyBzYWxlIG1lY2hhbmlzbSBpcyBubyBsb25nZXIgYWJsZSB0byBidXkgYmFjayBhbGwgdG9rZW5zIGF0IHRoZSBmbG9vcgogICAgLy8gcHJpY2UgaWYgdGhvc2UgZnVuZHMgd2VyZSB0byBiZSB3aXRoZHJhd24uCiAgICByZXF1aXJlKG51dHpBZGRyLmJhbGFuY2Uuc3ViKF9hbW91bnRXZWkpID49IGFjdGl2ZVN1cHBseSgpLm11bCgxMDAwMDAwKS5kaXYoc2FsZVByaWNlKSk7IC8vIDEsMDAwLDAwMCBXRUksIHVzZWQgYXMgcHJpY2UgZmFjdG9yCiAgICBOdXR6KG51dHpBZGRyKS5hc3luY1NlbmQocHVsbEFkZHIsIF9iZW5lZmljaWFyeSwgX2Ftb3VudFdlaSk7CiAgfQoKfQoKCmNvbnRyYWN0IFBvd2VyRW5hYmxlZCBpcyBNYXJrZXRFbmFibGVkIHsKCiAgLy8gc2F0ZWxpdGUgY29udHJhY3QgYWRkcmVzc2VzCiAgYWRkcmVzcyBwdWJsaWMgcG93ZXJBZGRyOwoKICAvLyBtYXhQb3dlciBpcyBhIGxpbWl0IG9mIHRvdGFsIHBvd2VyIHRoYXQgY2FuIGJlIG91dHN0YW5kaW5nCiAgLy8gbWF4UG93ZXIgaGFzIGEgdmFsaWQgdmFsdWUgYmV0d2VlbiBvdXRzdGFuZGluZ1Bvd2VyIGFuZCBhdXRob3JpemVkUG93LzIKICB1aW50MjU2IHB1YmxpYyBtYXhQb3dlciA9IDA7CgogIC8vIHRpbWUgaXQgc2hvdWxkIHRha2UgdG8gcG93ZXIgZG93bgogIHVpbnQyNTYgcHVibGljIGRvd250aW1lOwoKICB1aW50IHB1YmxpYyBjb25zdGFudCBNSU5fU0hBUkVfT0ZfUE9XRVIgPSAxMDAwMDA7CgogIG1vZGlmaWVyIG9ubHlQb3dlcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwb3dlckFkZHIpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIFBvd2VyRW5hYmxlZChhZGRyZXNzIF9wb3dlckFkZHIsIGFkZHJlc3MgX3B1bGxBZGRyLCBhZGRyZXNzIF9zdG9yYWdlQWRkciwgYWRkcmVzcyBfbnV0ekFkZHIpCiAgICBNYXJrZXRFbmFibGVkKF9wdWxsQWRkciwgX251dHpBZGRyLCBfc3RvcmFnZUFkZHIpIHsKICAgIHBvd2VyQWRkciA9IF9wb3dlckFkZHI7CiAgfQoKICBmdW5jdGlvbiBzZXRNYXhQb3dlcih1aW50MjU2IF9tYXhQb3dlcikgcHVibGljIG9ubHlBZG1pbnMgewogICAgcmVxdWlyZShvdXRzdGFuZGluZ1Bvd2VyKCkgPD0gX21heFBvd2VyICYmIF9tYXhQb3dlciA8IGF1dGhvcml6ZWRQb3dlcigpKTsKICAgIG1heFBvd2VyID0gX21heFBvd2VyOwogIH0KCiAgZnVuY3Rpb24gc2V0RG93bnRpbWUodWludDI1NiBfZG93bnRpbWUpIHB1YmxpYyBvbmx5QWRtaW5zIHsKICAgIGRvd250aW1lID0gX2Rvd250aW1lOwogIH0KCiAgZnVuY3Rpb24gbWluaW11bVBvd2VyVXBTaXplQmFieigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGNvbXBsZXRlU3VwcGx5QmFieiA9IGNvbXBsZXRlU3VwcGx5KCk7CiAgICBpZiAoY29tcGxldGVTdXBwbHlCYWJ6ID09IDApIHsKICAgICAgcmV0dXJuIElORklOSVRZOwogICAgfQogICAgcmV0dXJuIGNvbXBsZXRlU3VwcGx5QmFiei5kaXYoTUlOX1NIQVJFX09GX1BPV0VSKTsKICB9CgogIC8vIHRoaXMgaXMgY2FsbGVkIHdoZW4gTlRaIGFyZSBkZXBvc2l0ZWQgaW50byB0aGUgYnVybiBwb29sCiAgZnVuY3Rpb24gZGlsdXRlUG93ZXIodWludDI1NiBfYW1vdW50QmFieiwgdWludDI1NiBfYW1vdW50UG93ZXIpIHB1YmxpYyBvbmx5QWRtaW5zIHsKICAgIHVpbnQyNTYgYXV0aG9yaXplZFBvdyA9IGF1dGhvcml6ZWRQb3dlcigpOwogICAgdWludDI1NiB0b3RhbEJhYnogPSBjb21wbGV0ZVN1cHBseSgpOwogICAgaWYgKGF1dGhvcml6ZWRQb3cgPT0gMCkgewogICAgICAvLyBkdXJpbmcgdGhlIGZpcnN0IGNhcGl0YWwgaW5jcmVhc2UsIHNldCB2YWx1ZSBkaXJlY3RseSBhcyBhdXRob3JpemVkIHNoYXJlcwogICAgICBfc2V0QXV0aG9yaXplZFBvd2VyKChfYW1vdW50UG93ZXIgPiAwKSA/IF9hbW91bnRQb3dlciA6IF9hbW91bnRCYWJ6LmFkZCh0b3RhbEJhYnopKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGluIGxhdGVyIGluY3JlYXNlcywgZXhwYW5kIGF1dGhvcml6ZWQgc2hhcmVzIGF0IHNhbWUgcmF0ZSBsaWtlIGVjb25vbXkKICAgICAgX3NldEF1dGhvcml6ZWRQb3dlcihhdXRob3JpemVkUG93Lm11bCh0b3RhbEJhYnouYWRkKF9hbW91bnRCYWJ6KSkuZGl2KHRvdGFsQmFieikpOwogICAgfQogICAgX3NldEJ1cm5Qb29sKGJ1cm5Qb29sKCkuYWRkKF9hbW91bnRCYWJ6KSk7CiAgfQoKICBmdW5jdGlvbiBfc2xhc2hQb3dlcihhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlczMyIF9kYXRhKSBpbnRlcm5hbCB7CiAgICB1aW50MjU2IHByZXZpb3VzbHlPdXRzdGFuZGluZyA9IG91dHN0YW5kaW5nUG93ZXIoKTsKICAgIF9zZXRPdXRzdGFuZGluZ1Bvd2VyKHByZXZpb3VzbHlPdXRzdGFuZGluZy5zdWIoX3ZhbHVlKSk7CiAgICAvLyBhZGp1c3Qgc2l6ZSBvZiBwb3dlciBwb29sCiAgICB1aW50MjU2IHBvd1Bvb2wgPSBwb3dlclBvb2woKTsKICAgIHVpbnQyNTYgc2xhc2hpbmdCYWJ6ID0gX3ZhbHVlLm11bChwb3dQb29sKS5kaXYocHJldmlvdXNseU91dHN0YW5kaW5nKTsKICAgIF9zZXRQb3dlclBvb2wocG93UG9vbC5zdWIoc2xhc2hpbmdCYWJ6KSk7CiAgICAvLyBwdXQgZXZlbnQgaW50byBzYXRlbGl0ZSBjb250cmFjdAogICAgUG93ZXIocG93ZXJBZGRyKS5zbGFzaFBvd2VyKF9ob2xkZXIsIF92YWx1ZSwgX2RhdGEpOwogIH0KCiAgZnVuY3Rpb24gc2xhc2hQb3dlcihhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlczMyIF9kYXRhKSBwdWJsaWMgb25seUFkbWlucyB7CiAgICBfc2V0UG93ZXJCYWxhbmNlT2YoX2hvbGRlciwgcG93ZXJCYWxhbmNlT2YoX2hvbGRlcikuc3ViKF92YWx1ZSkpOwogICAgX3NsYXNoUG93ZXIoX2hvbGRlciwgX3ZhbHVlLCBfZGF0YSk7CiAgfQoKICBmdW5jdGlvbiBzbGFzaERvd25SZXF1ZXN0KHVpbnQyNTYgX3BvcywgYWRkcmVzcyBfaG9sZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMzMiBfZGF0YSkgcHVibGljIG9ubHlBZG1pbnMgewogICAgdmFyICh0b3RhbCwgbGVmdCwgc3RhcnQpID0gZG93bnMoX2hvbGRlcik7CiAgICBsZWZ0ID0gbGVmdC5zdWIoX3ZhbHVlKTsKICAgIF9zZXREb3duUmVxdWVzdChfaG9sZGVyLCB0b3RhbCwgbGVmdCwgc3RhcnQpOwogICAgX3NsYXNoUG93ZXIoX2hvbGRlciwgX3ZhbHVlLCBfZGF0YSk7CiAgfQoKICAvLyB0aGlzIGlzIGNhbGxlZCB3aGVuIE5UWiBhcmUgZGVwb3NpdGVkIGludG8gdGhlIHBvd2VyIHBvb2wKICBmdW5jdGlvbiBwb3dlclVwKGFkZHJlc3MgX3NlbmRlciwgYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50QmFieikgcHVibGljIG9ubHlOdXR6IHdoZW5Ob3RQYXVzZWQgewogICAgdWludDI1NiBhdXRob3JpemVkUG93ID0gYXV0aG9yaXplZFBvd2VyKCk7CiAgICByZXF1aXJlKGF1dGhvcml6ZWRQb3cgIT0gMCk7CiAgICByZXF1aXJlKF9hbW91bnRCYWJ6ICE9IDApOwogICAgdWludDI1NiB0b3RhbEJhYnogPSBjb21wbGV0ZVN1cHBseSgpOwogICAgcmVxdWlyZSh0b3RhbEJhYnogIT0gMCk7CiAgICB1aW50MjU2IGFtb3VudFBvdyA9IF9hbW91bnRCYWJ6Lm11bChhdXRob3JpemVkUG93KS5kaXYodG90YWxCYWJ6KTsKICAgIC8vIGNoZWNrIHBvdyBsaW1pdHMKICAgIHVpbnQyNTYgb3V0c3RhbmRpbmdQb3cgPSBvdXRzdGFuZGluZ1Bvd2VyKCk7CiAgICByZXF1aXJlKG91dHN0YW5kaW5nUG93LmFkZChhbW91bnRQb3cpIDw9IG1heFBvd2VyKTsKICAgIHVpbnQyNTYgcG93QmFsID0gcG93ZXJCYWxhbmNlT2YoX2Zyb20pLmFkZChhbW91bnRQb3cpOwogICAgcmVxdWlyZShwb3dCYWwgPj0gYXV0aG9yaXplZFBvdy5kaXYoTUlOX1NIQVJFX09GX1BPV0VSKSk7CgogICAgaWYgKF9zZW5kZXIgIT0gX2Zyb20pIHsKICAgICAgYWxsb3dlZFtfZnJvbV1bX3NlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVtfc2VuZGVyXS5zdWIoX2Ftb3VudEJhYnopOwogICAgfQoKICAgIF9zZXRPdXRzdGFuZGluZ1Bvd2VyKG91dHN0YW5kaW5nUG93LmFkZChhbW91bnRQb3cpKTsKICAgIF9zZXRQb3dlckJhbGFuY2VPZihfZnJvbSwgcG93QmFsKTsKICAgIF9zZXRBY3RpdmVTdXBwbHkoYWN0aXZlU3VwcGx5KCkuc3ViKF9hbW91bnRCYWJ6KSk7CiAgICBfc2V0QmFiekJhbGFuY2VPZihfZnJvbSwgYmFiekJhbGFuY2VPZihfZnJvbSkuc3ViKF9hbW91bnRCYWJ6KSk7CiAgICBfc2V0UG93ZXJQb29sKHBvd2VyUG9vbCgpLmFkZChfYW1vdW50QmFieikpOwogICAgUG93ZXIocG93ZXJBZGRyKS5wb3dlclVwKF9mcm9tLCBhbW91bnRQb3cpOwogIH0KCiAgZnVuY3Rpb24gcG93ZXJUb3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgaXNzdWVkUG93ZXIgPSBhdXRob3JpemVkUG93ZXIoKS5kaXYoMik7CiAgICAvLyByZXR1cm4gbWF4IG9mIG1heFBvd2VyIG9yIGlzc3VlZFBvd2VyCiAgICByZXR1cm4gbWF4UG93ZXIgPj0gaXNzdWVkUG93ZXIgPyBtYXhQb3dlciA6IGlzc3VlZFBvd2VyOwogIH0KCiAgZnVuY3Rpb24gX3Zlc3RlZERvd24odWludDI1NiBfdG90YWwsIHVpbnQyNTYgX2xlZnQsIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9ub3cpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChfbm93IDw9IF9zdGFydCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIC8vIGNhbGN1bGF0ZSBhbW91bnRWZXN0ZWQKICAgIC8vIGFtb3VudFZlc3RlZCBpcyBhbW91bnQgdGhhdCBjYW4gYmUgd2l0aGRyYXduIGFjY29yZGluZyB0byB0aW1lIHBhc3NlZAogICAgdWludDI1NiB0aW1lUGFzc2VkID0gX25vdy5zdWIoX3N0YXJ0KTsKICAgIGlmICh0aW1lUGFzc2VkID4gZG93bnRpbWUpIHsKICAgICB0aW1lUGFzc2VkID0gZG93bnRpbWU7CiAgICB9CiAgICB1aW50MjU2IGFtb3VudFZlc3RlZCA9IF90b3RhbC5tdWwodGltZVBhc3NlZCkuZGl2KGRvd250aW1lKTsKICAgIHVpbnQyNTYgYW1vdW50RnJvemVuID0gX3RvdGFsLnN1YihhbW91bnRWZXN0ZWQpOwogICAgaWYgKF9sZWZ0IDw9IGFtb3VudEZyb3plbikgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHJldHVybiBfbGVmdC5zdWIoYW1vdW50RnJvemVuKTsKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZURvd25SZXF1ZXN0KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hbW91bnRQb3dlcikgcHVibGljIG9ubHlQb3dlciB3aGVuTm90UGF1c2VkIHsKICAgIC8vIHByZXZlbnQgcG93ZXJpbmcgZG93biB0aW55IGFtb3VudHMKICAgIC8vIHdoZW4gcG93ZXJpbmcgZG93biwgYXQgbGVhc3QgY29tcGxldGVTdXBwbHkvbWluU2hhcmUgUG93ZXIgc2hvdWxkIGJlIGNsYWltZWQKICAgIHJlcXVpcmUoX2Ftb3VudFBvd2VyID49IGF1dGhvcml6ZWRQb3dlcigpLmRpdihNSU5fU0hBUkVfT0ZfUE9XRVIpKTsKICAgIF9zZXRQb3dlckJhbGFuY2VPZihfb3duZXIsIHBvd2VyQmFsYW5jZU9mKF9vd25lcikuc3ViKF9hbW91bnRQb3dlcikpOwoKICAgIHZhciAoLCBsZWZ0LCApID0gZG93bnMoX293bmVyKTsKICAgIHVpbnQyNTYgdG90YWwgPSBfYW1vdW50UG93ZXIuYWRkKGxlZnQpOwogICAgX3NldERvd25SZXF1ZXN0KF9vd25lciwgdG90YWwsIHRvdGFsLCBub3cpOwogIH0KCiAgLy8gZXhlY3V0ZXMgYSBwb3dlcmRvd24gcmVxdWVzdAogIGZ1bmN0aW9uIGRvd25UaWNrKGFkZHJlc3MgX2hvbGRlciwgdWludDI1NiBfbm93KSBwdWJsaWMgb25seVBvd2VyIHdoZW5Ob3RQYXVzZWQgewogICAgdmFyICh0b3RhbCwgbGVmdCwgc3RhcnQpID0gZG93bnMoX2hvbGRlcik7CiAgICB1aW50MjU2IGFtb3VudFBvdyA9IF92ZXN0ZWREb3duKHRvdGFsLCBsZWZ0LCBzdGFydCwgX25vdyk7CgogICAgLy8gcHJldmVudCBwb3dlciBkb3duIGluIHRpbnkgc3RlcHMKICAgIHVpbnQyNTYgbWluU3RlcCA9IHRvdGFsLmRpdigxMCk7CiAgICByZXF1aXJlKGxlZnQgPD0gbWluU3RlcCB8fCBtaW5TdGVwIDw9IGFtb3VudFBvdyk7CgogICAgLy8gY2FsY3VsYXRlIHRva2VuIGFtb3VudCByZXByZXNlbnRpbmcgc2hhcmUgb2YgcG93ZXIKICAgIHVpbnQyNTYgYW1vdW50QmFieiA9IGFtb3VudFBvdy5tdWwoY29tcGxldGVTdXBwbHkoKSkuZGl2KGF1dGhvcml6ZWRQb3dlcigpKTsKCiAgICAvLyB0cmFuc2ZlciBwb3dlciBhbmQgdG9rZW5zCiAgICBfc2V0T3V0c3RhbmRpbmdQb3dlcihvdXRzdGFuZGluZ1Bvd2VyKCkuc3ViKGFtb3VudFBvdykpOwogICAgbGVmdCA9IGxlZnQuc3ViKGFtb3VudFBvdyk7CiAgICBfc2V0UG93ZXJQb29sKHBvd2VyUG9vbCgpLnN1YihhbW91bnRCYWJ6KSk7CiAgICBfc2V0QWN0aXZlU3VwcGx5KGFjdGl2ZVN1cHBseSgpLmFkZChhbW91bnRCYWJ6KSk7CiAgICBfc2V0QmFiekJhbGFuY2VPZihfaG9sZGVyLCBiYWJ6QmFsYW5jZU9mKF9ob2xkZXIpLmFkZChhbW91bnRCYWJ6KSk7CiAgICAvLyBkb3duIHJlcXVlc3QgY29tcGxldGVkCiAgICBpZiAobGVmdCA9PSAwKSB7CiAgICAgIHN0YXJ0ID0gMDsKICAgICAgdG90YWwgPSAwOwogICAgfQogICAgLy8gVE9ETwogICAgX3NldERvd25SZXF1ZXN0KF9ob2xkZXIsIHRvdGFsLCBsZWZ0LCBzdGFydCk7CiAgICBOdXR6KG51dHpBZGRyKS5wb3dlckRvd24ocG93ZXJBZGRyLCBfaG9sZGVyLCBhbW91bnRCYWJ6KTsKICB9Cn0KCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCgoKCmNvbnRyYWN0IENvbnRyb2xsZXIgaXMgUG93ZXJFbmFibGVkIHsKCiAgZnVuY3Rpb24gQ29udHJvbGxlcihhZGRyZXNzIF9wb3dlckFkZHIsIGFkZHJlc3MgX3B1bGxBZGRyLCBhZGRyZXNzIF9udXR6QWRkciwgYWRkcmVzcyBfc3RvcmFnZUFkZHIpIAogICAgUG93ZXJFbmFibGVkKF9wb3dlckFkZHIsIF9wdWxsQWRkciwgX251dHpBZGRyLCBfc3RvcmFnZUFkZHIpIHsKICB9CgogIGZ1bmN0aW9uIHNldENvbnRyYWN0cyhhZGRyZXNzIF9zdG9yYWdlQWRkciwgYWRkcmVzcyBfbnV0ekFkZHIsIGFkZHJlc3MgX3Bvd2VyQWRkciwgYWRkcmVzcyBfcHVsbEFkZHIpIHB1YmxpYyBvbmx5QWRtaW5zIHdoZW5QYXVzZWQgewogICAgc3RvcmFnZUFkZHIgPSBfc3RvcmFnZUFkZHI7CiAgICBudXR6QWRkciA9IF9udXR6QWRkcjsKICAgIHBvd2VyQWRkciA9IF9wb3dlckFkZHI7CiAgICBwdWxsQWRkciA9IF9wdWxsQWRkcjsKICB9CgogIGZ1bmN0aW9uIGNoYW5nZURhaWx5TGltaXQodWludDI1NiBfZGFpbHlMaW1pdCkgcHVibGljIG9ubHlBZG1pbnMgewogICAgUHVsbFBheW1lbnQocHVsbEFkZHIpLmNoYW5nZURhaWx5TGltaXQoX2RhaWx5TGltaXQpOwogIH0KCiAgZnVuY3Rpb24ga2lsbChhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBwdWJsaWMgb25seUFkbWlucyB3aGVuUGF1c2VkIHsKICAgIGlmIChwb3dlckFkZHIgIT0gYWRkcmVzcygwKSkgeyBPd25hYmxlKHBvd2VyQWRkcikudHJhbnNmZXJPd25lcnNoaXAobXNnLnNlbmRlcik7IH0KICAgIGlmIChwdWxsQWRkciAhPSBhZGRyZXNzKDApKSB7IE93bmFibGUocHVsbEFkZHIpLnRyYW5zZmVyT3duZXJzaGlwKG1zZy5zZW5kZXIpOyB9CiAgICBpZiAobnV0ekFkZHIgIT0gYWRkcmVzcygwKSkgeyBPd25hYmxlKG51dHpBZGRyKS50cmFuc2Zlck93bmVyc2hpcChtc2cuc2VuZGVyKTsgfQogICAgaWYgKHN0b3JhZ2VBZGRyICE9IGFkZHJlc3MoMCkpIHsgT3duYWJsZShzdG9yYWdlQWRkcikudHJhbnNmZXJPd25lcnNoaXAobXNnLnNlbmRlcik7IH0KICAgIHNlbGZkZXN0cnVjdChfbmV3Q29udHJvbGxlcik7CiAgfQoKfQoKY29udHJhY3QgVXBncmFkZUV2ZW50Q29tcGFjdCB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIC8vIHN0YXRlcwogIC8vICAtIHZlcmlmeWluZywgaW5pdGlhbCBzdGF0ZQogIC8vICAtIGNvbnRyb2xsaW5nLCBhZnRlciB2ZXJpZnlpbmcsIGJlZm9yZSBjb21wbGV0ZQogIC8vICAtIGNvbXBsZXRlLCBhZnRlciBjb250cm9sbGluZwogIGVudW0gRXZlbnRTdGF0ZSB7IFZlcmlmeWluZywgQ29tcGxldGUgfQogIEV2ZW50U3RhdGUgcHVibGljIHN0YXRlOwoKICAvLyBUZXJtcwogIGFkZHJlc3MgcHVibGljIG5leHRDb250cm9sbGVyOwogIGFkZHJlc3MgcHVibGljIG9sZENvbnRyb2xsZXI7CiAgYWRkcmVzcyBwdWJsaWMgY291bmNpbDsKCiAgLy8gUGFyYW1zCiAgYWRkcmVzcyBuZXh0UHVsbFBheW1lbnQ7CiAgYWRkcmVzcyBzdG9yYWdlQWRkcjsKICBhZGRyZXNzIG51dHpBZGRyOwogIGFkZHJlc3MgcG93ZXJBZGRyOwogIHVpbnQyNTYgbWF4UG93ZXI7CiAgdWludDI1NiBkb3dudGltZTsKICB1aW50MjU2IHB1cmNoYXNlUHJpY2U7CiAgdWludDI1NiBzYWxlUHJpY2U7CgogIGZ1bmN0aW9uIFVwZ3JhZGVFdmVudENvbXBhY3QoYWRkcmVzcyBfb2xkQ29udHJvbGxlciwgYWRkcmVzcyBfbmV4dENvbnRyb2xsZXIsIGFkZHJlc3MgX25leHRQdWxsUGF5bWVudCkgewogICAgc3RhdGUgPSBFdmVudFN0YXRlLlZlcmlmeWluZzsKICAgIG5leHRDb250cm9sbGVyID0gX25leHRDb250cm9sbGVyOwogICAgb2xkQ29udHJvbGxlciA9IF9vbGRDb250cm9sbGVyOwogICAgbmV4dFB1bGxQYXltZW50ID0gX25leHRQdWxsUGF5bWVudDsgLy90aGUgb3duZXJzaGlwIG9mIHRoaXMgc2F0ZWxsaXRlIHNob3VsZCBiZSB3aXRoIG9sZENvbnRyb2xsZXIKICAgIGNvdW5jaWwgPSBtc2cuc2VuZGVyOwogIH0KCiAgbW9kaWZpZXIgaXNTdGF0ZShFdmVudFN0YXRlIF9zdGF0ZSkgewogICAgcmVxdWlyZShzdGF0ZSA9PSBfc3RhdGUpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIHVwZ3JhZGUoKSBpc1N0YXRlKEV2ZW50U3RhdGUuVmVyaWZ5aW5nKSB7CiAgICAvLyBjaGVjayBvbGQgY29udHJvbGxlcgogICAgdmFyIG9sZCA9IENvbnRyb2xsZXIob2xkQ29udHJvbGxlcik7CiAgICBvbGQucGF1c2UoKTsKICAgIHJlcXVpcmUob2xkLmFkbWlucygxKSA9PSBhZGRyZXNzKHRoaXMpKTsKICAgIHJlcXVpcmUob2xkLnBhdXNlZCgpID09IHRydWUpOwogICAgLy8gY2hlY2sgbmV4dCBjb250cm9sbGVyCiAgICB2YXIgbmV4dCA9IENvbnRyb2xsZXIobmV4dENvbnRyb2xsZXIpOwogICAgcmVxdWlyZShuZXh0LmFkbWlucygxKSA9PSBhZGRyZXNzKHRoaXMpKTsKICAgIHJlcXVpcmUobmV4dC5wYXVzZWQoKSA9PSB0cnVlKTsKICAgIC8vIGtpbGwgb2xkIG9uZSwgYW5kIHRyYW5zZmVyIG93bmVyc2hpcAogICAgLy8gdHJhbnNmZXIgb3duZXJzaGlwIG9mIHBheW1lbnRzIGFuZCBzdG9yYWdlIHRvIGhlcmUKICAgIHN0b3JhZ2VBZGRyID0gb2xkLnN0b3JhZ2VBZGRyKCk7CiAgICBudXR6QWRkciA9IG9sZC5udXR6QWRkcigpOwogICAgcG93ZXJBZGRyID0gb2xkLnBvd2VyQWRkcigpOwogICAgbWF4UG93ZXIgPSBvbGQubWF4UG93ZXIoKTsKICAgIGRvd250aW1lID0gb2xkLmRvd250aW1lKCk7CiAgICBwdXJjaGFzZVByaWNlID0gb2xkLmNlaWxpbmcoKTsKICAgIHNhbGVQcmljZSA9IG9sZC5mbG9vcigpOwogICAgdWludCBuZXdQb3dlclBvb2wgPSAob2xkLm91dHN0YW5kaW5nUG93ZXIoKSkubXVsKG9sZC5hY3RpdmVTdXBwbHkoKS5hZGQob2xkLmJ1cm5Qb29sKCkpKS5kaXYob2xkLmF1dGhvcml6ZWRQb3dlcigpLnN1YihvbGQub3V0c3RhbmRpbmdQb3dlcigpKSk7CiAgICAvL3NldCBwdWxsIHBheW1lbnQgY29udHJhY3QgaW4gb2xkIGNvbnRyb2xsZXIKICAgIG9sZC5zZXRDb250cmFjdHMocG93ZXJBZGRyLCBuZXh0UHVsbFBheW1lbnQsIG51dHpBZGRyLCBzdG9yYWdlQWRkcik7CiAgICAvLyBraWxsIG9sZCBjb250cm9sbGVyLCBzZW5kaW5nIGFsbCBFVEggdG8gbmV3IGNvbnRyb2xsZXIKICAgIG9sZC5raWxsKG5leHRDb250cm9sbGVyKTsKICAgIC8vIHRyYW5zZmVyIG93bmVyc2hpcCBvZiBOdXR6L1Bvd2VyIGNvbnRyYWN0cyB0byBuZXh0IGNvbnRyb2xsZXIKICAgIE93bmFibGUobnV0ekFkZHIpLnRyYW5zZmVyT3duZXJzaGlwKG5leHRDb250cm9sbGVyKTsKICAgIE93bmFibGUocG93ZXJBZGRyKS50cmFuc2Zlck93bmVyc2hpcChuZXh0Q29udHJvbGxlcik7CiAgICAvLyB0cmFuc2ZlciBvd25lcnNoaXAgb2Ygc3RvcmFnZSB0byBuZXh0IGNvbnRyb2xsZXIKICAgIFN0b3JhZ2Uoc3RvcmFnZUFkZHIpLnNldFVJbnQoJ051dHonLCAncG93ZXJQb29sJywgbmV3UG93ZXJQb29sKTsKICAgIE93bmFibGUoc3RvcmFnZUFkZHIpLnRyYW5zZmVyT3duZXJzaGlwKG5leHRDb250cm9sbGVyKTsKICAgIC8vIGlmIGludGVuZGVkLCB0cmFuc2ZlciBvd25lcnNoaXAgb2YgcHVsbCBwYXltZW50IGFjY291bnQKICAgIE93bmFibGUobmV4dFB1bGxQYXltZW50KS50cmFuc2Zlck93bmVyc2hpcChuZXh0Q29udHJvbGxlcik7CiAgICAvLyByZXN1bWUgbmV4dCBjb250cm9sbGVyCiAgICBpZiAobWF4UG93ZXIgPiAwKSB7CiAgICAgIG5leHQuc2V0TWF4UG93ZXIobWF4UG93ZXIpOwogICAgfQogICAgbmV4dC5zZXREb3dudGltZShkb3dudGltZSk7CiAgICBuZXh0Lm1vdmVGbG9vcihzYWxlUHJpY2UpOwogICAgbmV4dC5tb3ZlQ2VpbGluZyhwdXJjaGFzZVByaWNlKTsKICAgIG5leHQudW5wYXVzZSgpOwogICAgLy8gcmVtb3ZlIGFjY2VzcwogICAgbmV4dC5yZW1vdmVBZG1pbihhZGRyZXNzKHRoaXMpKTsKICAgIC8vIHNldCBzdGF0ZQogICAgc3RhdGUgPSBFdmVudFN0YXRlLkNvbXBsZXRlOwogIH0KCn0='.
	

]
