Class {
	#name : #SRTE86C98C75450075d096580f843FCd67a858fFd5f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTE86C98C75450075d096580f843FCd67a858fFd5f >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuNjsKCmNvbnRyYWN0IFNhZmVNYXRoIHsKICAgIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgZnVuY3Rpb24gZGl2KHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KGIgPiAwKTsKICAgICAgICB1aW50IGMgPSBhIC8gYjsKICAgICAgICBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBhc3NlcnQoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBjID0gYSArIGI7CiAgICAgICAgYXNzZXJ0KGMgPj0gYSk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuQ29udHJvbGxlciB7CiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyAoYm9vbCk7CgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zIChib29sKTsKCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgIHJldHVybnMgKGJvb2wpOwp9CgoKY29udHJhY3QgQ29udHJvbGxlZCB7CiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlciB7aWYgKG1zZy5zZW5kZXIgIT0gY29udHJvbGxlcikgdGhyb3c7CiAgICAgICAgXzt9CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkge2NvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCgpjb250cmFjdCBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrIHsKICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIGZyb20sIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9kYXRhKTsKfQoKCmNvbnRyYWN0IFNoaW5lQ29pblRva2VuIGlzIENvbnRyb2xsZWQgewogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwogICAgdWludDggcHVibGljIGRlY2ltYWxzOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnU0hJTkVfMC4xJzsKCiAgICBzdHJ1Y3QgQ2hlY2twb2ludCB7CiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7CiAgICAgICAgdWludDEyOCB2YWx1ZTsKICAgIH0KCiAgICBTaGluZUNvaW5Ub2tlbiBwdWJsaWMgcGFyZW50VG9rZW47CgogICAgYWRkcmVzcyBwdWJsaWMgZnJvemVuUmVzZXJ2ZVRlYW1SZWNpcGllbnQ7CgogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsKCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIC8vIFBlcmlvZHMKICAgIHVpbnQgcHVibGljIGZpcnN0UmV3YXJkUGVyaW9kRW5kQmxvY2s7CgogICAgdWludCBwdWJsaWMgc2Vjb25kUmV3YXJkUGVyaW9kRW5kQmxvY2s7CgogICAgdWludCBwdWJsaWMgdGhpcmRSZXdhcmRQZXJpb2RFbmRCbG9jazsKCiAgICB1aW50IHB1YmxpYyBmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrOwoKICAgIC8vIExvb3MKICAgIHVpbnQgcHVibGljIGZpcnN0TG9vczsKCiAgICB1aW50IHB1YmxpYyBzZWNvbmRMb29zOwoKICAgIHVpbnQgcHVibGljIHRoaXJkTG9vczsKCiAgICB1aW50IHB1YmxpYyBmaW5hbExvb3M7CgoKICAgIC8vIFBlcmNlbnRzCiAgICB1aW50IHB1YmxpYyBmaXJzdFJld2FyZFBlcmlvZFBlcmNlbnQ7CgogICAgdWludCBwdWJsaWMgc2Vjb25kUmV3YXJkUGVyaW9kUGVyY2VudDsKCiAgICB1aW50IHB1YmxpYyB0aGlyZFJld2FyZFBlcmlvZFBlcmNlbnQ7CgogICAgdWludCBwdWJsaWMgZmluYWxSZXdhcmRQZXJpb2RQZXJjZW50OwoKICAgIC8vIFVuZnJlZXplIHRlYW0gd2FsbGV0IGZvciB0cmFuc2ZlcnMKICAgIHVpbnQgcHVibGljIHVuZnJlZXplVGVhbVJlY2VwaWVudEJsb2NrOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgQ2hlY2twb2ludFtdIHRvdGFsU3VwcGx5SGlzdG9yeTsKCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOwoKICAgIFNoaW5lQ29pblRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5OwoKICAgIGZ1bmN0aW9uIFNoaW5lQ29pblRva2VuKAogICAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBTaGluZUNvaW5Ub2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7CiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsKICAgICAgICBwYXJlbnRUb2tlbiA9IFNoaW5lQ29pblRva2VuKF9wYXJlbnRUb2tlbik7CiAgICAgICAgcGFyZW50U25hcFNob3RCbG9jayA9IF9wYXJlbnRTbmFwU2hvdEJsb2NrOwogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgICAgICBjcmVhdGlvbkJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIHVuZnJlZXplVGVhbVJlY2VwaWVudEJsb2NrID0gYmxvY2subnVtYmVyICsgKCgzOTYgKiAyNCAqIDM2MDApIC8gMTgpOyAvLyAzOTYgZGF5cwoKICAgICAgICBmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrID0gY3JlYXRpb25CbG9jayArICgoMTIxICogMjQgKiAzNjAwKSAvIDE4KTsgLy8gMTIxIGRheXMKICAgICAgICBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jayA9IGNyZWF0aW9uQmxvY2sgKyAoKDE4MSAqIDI0ICogMzYwMCkgLyAxOCk7IC8vIDE4MSBkYXlzCiAgICAgICAgdGhpcmRSZXdhcmRQZXJpb2RFbmRCbG9jayA9IGNyZWF0aW9uQmxvY2sgKyAoKDIxMSAqIDI0ICogMzYwMCkgLyAxOCk7IC8vIDIxMSBkYXlzCiAgICAgICAgZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayA9IGNyZWF0aW9uQmxvY2sgKyAoKDc2MCAqIDI0ICogMzYwMCkgLyAxOCk7IC8vIDIgeWVhcnMKCiAgICAgICAgZmlyc3RSZXdhcmRQZXJpb2RQZXJjZW50ID0gMjk7CiAgICAgICAgc2Vjb25kUmV3YXJkUGVyaW9kUGVyY2VudCA9IDIzOwogICAgICAgIHRoaXJkUmV3YXJkUGVyaW9kUGVyY2VudCA9IDE4OwogICAgICAgIGZpbmFsUmV3YXJkUGVyaW9kUGVyY2VudCA9IDEyOwoKICAgICAgICBmaXJzdExvb3MgPSAoKDE1ICogMjQgKiAzNjAwKSAvIDE4KTsgLy8gMTUgZGF5czsKICAgICAgICBzZWNvbmRMb29zID0gKCgxMCAqIDI0ICogMzYwMCkgLyAxOCk7IC8vIDEwIGRheXM7CiAgICAgICAgdGhpcmRMb29zID0gKCg1ICogMjQgKiAzNjAwKSAvIDE4KTsgLy8gNSBkYXlzOwogICAgICAgIGZpbmFsTG9vcyA9ICgoMSAqIDI0ICogMzYwMCkgLyAxOCk7IC8vIDEgZGF5czsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXNlcnZlVGVhbVJlY2VwaWVudChhZGRyZXNzIF9uZXdSZXNlcnZlVGVhbVJlY2lwaWVudCkgb25seUNvbnRyb2xsZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGZyb3plblJlc2VydmVUZWFtUmVjaXBpZW50ID0gX25ld1Jlc2VydmVUZWFtUmVjaXBpZW50OwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIEVSQzIwIE1ldGhvZHMKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoIXRyYW5zZmVyc0VuYWJsZWQpIHRocm93OwogICAgICAgIGlmICgoYWRkcmVzcyhtc2cuc2VuZGVyKSA9PSBmcm96ZW5SZXNlcnZlVGVhbVJlY2lwaWVudCkgJiYgKGJsb2NrLm51bWJlciA8IHVuZnJlZXplVGVhbVJlY2VwaWVudEJsb2NrKSkgdGhyb3c7CiAgICAgICAgaWYgKChfdG8gPT0gZnJvemVuUmVzZXJ2ZVRlYW1SZWNpcGllbnQpICYmIChibG9jay5udW1iZXIgPCB1bmZyZWV6ZVRlYW1SZWNlcGllbnRCbG9jaykpIHRocm93OwogICAgICAgIHJldHVybiBkb1RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsKCiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgZnVuY3Rpb24gZG9UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CgogICAgICAgIGlmIChfYW1vdW50ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAocGFyZW50U25hcFNob3RCbG9jayA+PSBibG9jay5udW1iZXIpIHRocm93OwoKICAgICAgICBpZiAoKF90byA9PSAwKSB8fCAoX3RvID09IGFkZHJlc3ModGhpcykpKSB0aHJvdzsKCiAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2ZBdChfZnJvbSwgYmxvY2subnVtYmVyKTsKICAgICAgICBpZiAocHJldmlvdXNCYWxhbmNlRnJvbSA8IF9hbW91bnQpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgaWYgKCFUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KSkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQoKICAgICAgICBDaGVja3BvaW50W10gY2hlY2twb2ludHMgPSBiYWxhbmNlc1tfZnJvbV07CiAgICAgICAgdWludCBsYXN0QmxvY2sgPSBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGggLSAxXS5mcm9tQmxvY2s7CiAgICAgICAgdWludCBibG9ja3NGcm9tTGFzdEJsb2NrID0gYmxvY2subnVtYmVyIC0gbGFzdEJsb2NrOwogICAgICAgIHVpbnQgcmV3YXJkQW1vdW50ID0gMDsKCiAgICAgICAgaWYgKGJsb2NrLm51bWJlciA8PSBmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CiAgICAgICAgICAgIGlmIChibG9ja3NGcm9tTGFzdEJsb2NrID4gZmlyc3RMb29zKSB7CiAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogZmlyc3RSZXdhcmRQZXJpb2RQZXJjZW50ICogYmxvY2tzRnJvbUxhc3RCbG9jazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChibG9jay5udW1iZXIgPD0gc2Vjb25kUmV3YXJkUGVyaW9kRW5kQmxvY2spIHsKICAgICAgICAgICAgaWYgKGJsb2Nrc0Zyb21MYXN0QmxvY2sgPiBzZWNvbmRMb29zKSB7CiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2NrIDwgZmlyc3RSZXdhcmRQZXJpb2RFbmRCbG9jaykgewogICAgICAgICAgICAgICAgICAgIHJld2FyZEFtb3VudCA9IHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaXJzdFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmlyc3RSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGxhc3RCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogc2Vjb25kUmV3YXJkUGVyaW9kUGVyY2VudCAqIChzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogc2Vjb25kUmV3YXJkUGVyaW9kUGVyY2VudCAqIGJsb2Nrc0Zyb21MYXN0QmxvY2s7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYmxvY2subnVtYmVyIDw9IHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2spIHsKICAgICAgICAgICAgaWYgKGJsb2Nrc0Zyb21MYXN0QmxvY2sgPiB0aGlyZExvb3MpIHsKICAgICAgICAgICAgICAgIGlmIChsYXN0QmxvY2sgPCBmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CiAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpcnN0UmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogdGhpcmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAobGFzdEJsb2NrIDwgc2Vjb25kUmV3YXJkUGVyaW9kRW5kQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogc2Vjb25kUmV3YXJkUGVyaW9kUGVyY2VudCAqIChzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGxhc3RCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogdGhpcmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIHRoaXJkUmV3YXJkUGVyaW9kUGVyY2VudCAqIGJsb2Nrc0Zyb21MYXN0QmxvY2s7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYmxvY2subnVtYmVyIDw9IGZpbmFsUmV3YXJkUGVyaW9kRW5kQmxvY2spIHsKICAgICAgICAgICAgaWYgKGJsb2Nrc0Zyb21MYXN0QmxvY2sgPiBmaW5hbExvb3MpIHsKICAgICAgICAgICAgICAgIGlmIChsYXN0QmxvY2sgPCBmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CiAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpcnN0UmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogdGhpcmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKGZpbmFsUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSB0aGlyZFJld2FyZFBlcmlvZEVuZEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaW5hbFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChsYXN0QmxvY2sgPCBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgewogICAgICAgICAgICAgICAgICAgIHJld2FyZEFtb3VudCA9IHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHNlY29uZFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiB0aGlyZFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2spICsgcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpbmFsUmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxhc3RCbG9jayA8IHNlY29uZFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CiAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIHRoaXJkUmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaW5hbFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogZmluYWxSZXdhcmRQZXJpb2RQZXJjZW50ICogYmxvY2tzRnJvbUxhc3RCbG9jazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKGJsb2Nrc0Zyb21MYXN0QmxvY2sgPiBmaW5hbExvb3MpIHsKICAgICAgICAgICAgICAgIGlmIChsYXN0QmxvY2sgPCBmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CiAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpcnN0UmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogdGhpcmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKGZpbmFsUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSB0aGlyZFJld2FyZFBlcmlvZEVuZEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaW5hbFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChsYXN0QmxvY2sgPCBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgewogICAgICAgICAgICAgICAgICAgIHJld2FyZEFtb3VudCA9IHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHNlY29uZFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiB0aGlyZFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2spICsgcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpbmFsUmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxhc3RCbG9jayA8IHNlY29uZFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CiAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIHRoaXJkUmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaW5hbFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogZmluYWxSZXdhcmRQZXJpb2RQZXJjZW50ICogKGZpbmFsUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSB0aGlyZFJld2FyZFBlcmlvZEVuZEJsb2NrKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV3YXJkQW1vdW50ID0gcmV3YXJkQW1vdW50IC8gMTAwMDA7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IDA7CgogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCArIHJld2FyZEFtb3VudCk7CgogICAgICAgIC8vIFVQREFURSBUT1RBTAogICAgICAgIGlmIChyZXdhcmRBbW91bnQgPiAwKSB7CiAgICAgICAgICAgIGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSArIHJld2FyZEFtb3VudCA8IGN1clRvdGFsU3VwcGx5KSB0aHJvdzsgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIHJld2FyZEFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICByZXdhcmRBbW91bnQgPSAwOwoKICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7CiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCA8IHByZXZpb3VzQmFsYW5jZVRvKSB0aHJvdzsKCiAgICAgICAgY2hlY2twb2ludHMgPSBiYWxhbmNlc1tfdG9dOwogICAgICAgIGlmIChjaGVja3BvaW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGxhc3RCbG9jayA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtIDFdLmZyb21CbG9jazsKICAgICAgICAgICAgYmxvY2tzRnJvbUxhc3RCbG9jayA9IGJsb2NrLm51bWJlciAtIGxhc3RCbG9jazsKCiAgICAgICAgICAgIGlmIChfYW1vdW50ID49IChwcmV2aW91c0JhbGFuY2VUbyAvIDMpKSB7CiAgICAgICAgICAgICAgICBpZiAoYmxvY2tzRnJvbUxhc3RCbG9jayA+IGZpbmFsTG9vcykgewoKICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2subnVtYmVyIDw9IGZpcnN0UmV3YXJkUGVyaW9kRW5kQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpcnN0UmV3YXJkUGVyaW9kUGVyY2VudCAqIGJsb2Nrc0Zyb21MYXN0QmxvY2s7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJsb2NrLm51bWJlciA8PSBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgewoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RCbG9jayA8IGZpcnN0UmV3YXJkUGVyaW9kRW5kQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJld2FyZEFtb3VudCA9IHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaXJzdFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmlyc3RSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGxhc3RCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogc2Vjb25kUmV3YXJkUGVyaW9kUGVyY2VudCAqIChzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogc2Vjb25kUmV3YXJkUGVyaW9kUGVyY2VudCAqIGJsb2Nrc0Zyb21MYXN0QmxvY2s7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJsb2NrLm51bWJlciA8PSB0aGlyZFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2NrIDwgZmlyc3RSZXdhcmRQZXJpb2RFbmRCbG9jaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpcnN0UmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogdGhpcmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxhc3RCbG9jayA8IHNlY29uZFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogc2Vjb25kUmV3YXJkUGVyaW9kUGVyY2VudCAqIChzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGxhc3RCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogdGhpcmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBibG9jay5udW1iZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIHRoaXJkUmV3YXJkUGVyaW9kUGVyY2VudCAqIGJsb2Nrc0Zyb21MYXN0QmxvY2s7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJsb2NrLm51bWJlciA8PSBmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2NrIDwgZmlyc3RSZXdhcmRQZXJpb2RFbmRCbG9jaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpcnN0UmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogdGhpcmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKGZpbmFsUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSB0aGlyZFJld2FyZFBlcmlvZEVuZEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaW5hbFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobGFzdEJsb2NrIDwgc2Vjb25kUmV3YXJkUGVyaW9kRW5kQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJld2FyZEFtb3VudCA9IHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHNlY29uZFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiB0aGlyZFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2spICsgcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpbmFsUmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChsYXN0QmxvY2sgPCBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIHRoaXJkUmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaW5hbFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogZmluYWxSZXdhcmRQZXJpb2RQZXJjZW50ICogYmxvY2tzRnJvbUxhc3RCbG9jazsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2NrIDwgZmlyc3RSZXdhcmRQZXJpb2RFbmRCbG9jaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpcnN0UmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaXJzdFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgKyBwcmV2aW91c0JhbGFuY2VGcm9tICogdGhpcmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKGZpbmFsUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSB0aGlyZFJld2FyZFBlcmlvZEVuZEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaW5hbFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobGFzdEJsb2NrIDwgc2Vjb25kUmV3YXJkUGVyaW9kRW5kQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJld2FyZEFtb3VudCA9IHByZXZpb3VzQmFsYW5jZUZyb20gKiBzZWNvbmRSZXdhcmRQZXJpb2RQZXJjZW50ICogKHNlY29uZFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiB0aGlyZFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIHRoaXJkUmV3YXJkUGVyaW9kRW5kQmxvY2spICsgcHJldmlvdXNCYWxhbmNlRnJvbSAqIGZpbmFsUmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChsYXN0QmxvY2sgPCBzZWNvbmRSZXdhcmRQZXJpb2RFbmRCbG9jaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV3YXJkQW1vdW50ID0gcHJldmlvdXNCYWxhbmNlRnJvbSAqIHRoaXJkUmV3YXJkUGVyaW9kUGVyY2VudCAqIChmaW5hbFJld2FyZFBlcmlvZEVuZEJsb2NrIC0gbGFzdEJsb2NrKSArIHByZXZpb3VzQmFsYW5jZUZyb20gKiBmaW5hbFJld2FyZFBlcmlvZFBlcmNlbnQgKiAoZmluYWxSZXdhcmRQZXJpb2RFbmRCbG9jayAtIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXdhcmRBbW91bnQgPSBwcmV2aW91c0JhbGFuY2VGcm9tICogZmluYWxSZXdhcmRQZXJpb2RQZXJjZW50ICogKGZpbmFsUmV3YXJkUGVyaW9kRW5kQmxvY2sgLSB0aGlyZFJld2FyZFBlcmlvZEVuZEJsb2NrKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgICAgICByZXdhcmRBbW91bnQgPSByZXdhcmRBbW91bnQgLyAxMDAwMDsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCArIHJld2FyZEFtb3VudCk7CgogICAgICAgIC8vIFVQREFURSBUT1RBTAogICAgICAgIGlmIChyZXdhcmRBbW91bnQgPiAwKSB7CiAgICAgICAgICAgIGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSArIHJld2FyZEFtb3VudCA8IGN1clRvdGFsU3VwcGx5KSB0aHJvdzsKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIG92ZXJmbG93CiAgICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIHJld2FyZEFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgICAgICByZXR1cm4gYmFsYW5jZU9mQXQoX293bmVyLCBibG9jay5udW1iZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoIXRyYW5zZmVyc0VuYWJsZWQpIHRocm93OwoKICAgICAgICBpZiAoKF9hbW91bnQgIT0gMCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9IDApKSB0aHJvdzsKCiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgaWYgKCFUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikub25BcHByb3ZlKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfYW1vdW50KSkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQoKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YQogICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoIWFwcHJvdmUoX3NwZW5kZXIsIF9hbW91bnQpKSB0aHJvdzsKCiAgICAgICAgQXBwcm92ZUFuZENhbGxGYWxsQmFjayhfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKAogICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgX2Ftb3VudCwKICAgICAgICB0aGlzLAogICAgICAgIF9leHRyYURhdGEKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJhbGFuY2VzT2ZBZGRyZXNzKGFkZHJlc3MgX293bmVyKSBvbmx5Q29udHJvbGxlciByZXR1cm5zICh1aW50MTI4LCB1aW50MTI4KSB7CiAgICAgICAgQ2hlY2twb2ludFtdIGNoZWNrcG9pbnRzID0gYmFsYW5jZXNbX293bmVyXTsKICAgICAgICByZXR1cm4gKGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtIDFdLnZhbHVlLCBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGggLSAxXS5mcm9tQmxvY2spOwogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQKICAgIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgaWYgKChiYWxhbmNlc1tfb3duZXJdLmxlbmd0aCA9PSAwKQogICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApCiAgICAgICAgfHwgKHRvdGFsU3VwcGx5SGlzdG9yeVswXS5mcm9tQmxvY2sgPiBfYmxvY2tOdW1iZXIpKSB7CiAgICAgICAgICAgIGlmIChhZGRyZXNzKHBhcmVudFRva2VuKSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdChtaW4oX2Jsb2NrTnVtYmVyLCBwYXJlbnRTbmFwU2hvdEJsb2NrKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCgogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX2Nsb25lVG9rZW5TeW1ib2wsCiAgICAgICAgdWludCBfc25hcHNob3RCbG9jaywKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3NuYXBzaG90QmxvY2sgPT0gMCkgX3NuYXBzaG90QmxvY2sgPSBibG9jay5udW1iZXI7CiAgICAgICAgU2hpbmVDb2luVG9rZW4gY2xvbmVUb2tlbiA9IHRva2VuRmFjdG9yeS5jcmVhdGVDbG9uZVRva2VuKAogICAgICAgIHRoaXMsCiAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgIF9jbG9uZURlY2ltYWxVbml0cywKICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICk7CgogICAgICAgIGNsb25lVG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKCiAgICAgICAgTmV3Q2xvbmVUb2tlbihhZGRyZXNzKGNsb25lVG9rZW4pLCBfc25hcHNob3RCbG9jayk7CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoY2xvbmVUb2tlbik7CiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBibG9jay5udW1iZXIpOwogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSArIF9hbW91bnQgPCBjdXJUb3RhbFN1cHBseSkgdGhyb3c7CgogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPCBwcmV2aW91c0JhbGFuY2VUbykgdGhyb3c7CgogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBibG9jay5udW1iZXIpOwogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSA8IF9hbW91bnQpIHRocm93OwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB0aHJvdzsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihfb3duZXIsIDAsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGVuYWJsZVRyYW5zZmVycyhib29sIF90cmFuc2ZlcnNFbmFibGVkKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFZhbHVlQXQoQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX2Jsb2NrCiAgICApIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOwoKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtIDFdLmZyb21CbG9jaykKICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0gMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aCAtIDE7CiAgICAgICAgd2hpbGUgKG1heCA+IG1pbikgewogICAgICAgICAgICB1aW50IG1pZCA9IChtYXggKyBtaW4gKyAxKSAvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jayA8PSBfYmxvY2spIHsKICAgICAgICAgICAgICAgIG1pbiA9IG1pZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1heCA9IG1pZCAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW21pbl0udmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlVmFsdWVBdE5vdyhDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfdmFsdWUKICAgICkgaW50ZXJuYWwgewogICAgICAgIGlmICgoY2hlY2twb2ludHMubGVuZ3RoID09IDApCiAgICAgICAgfHwgKGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtIDFdLmZyb21CbG9jayA8IGJsb2NrLm51bWJlcikpIHsKICAgICAgICAgICAgQ2hlY2twb2ludCBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoKytdOwogICAgICAgICAgICBuZXdDaGVja1BvaW50LmZyb21CbG9jayA9IHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIENoZWNrcG9pbnQgb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBvbGRDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNpemUgPiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiOwogICAgfQoKICAgIGZ1bmN0aW9uKCkgcGF5YWJsZSB7CiAgICAgICAgaWYgKGlzQ29udHJhY3QoY29udHJvbGxlcikpIHsKICAgICAgICAgICAgaWYgKCFUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpCiAgICAgICAgICAgIHRocm93OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgfQoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKCiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7CgogICAgZXZlbnQgQXBwcm92YWwoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9vd25lciwKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsCiAgICAgICAgdWludDI1NiBfYW1vdW50CiAgICApOwoKfQoKY29udHJhY3QgU2hpbmVDb2luVG9rZW5GYWN0b3J5IHsKICAgICAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3BhcmVudFRva2VuLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgdWludDggX2RlY2ltYWxVbml0cywKICAgICAgICBzdHJpbmcgX3Rva2VuU3ltYm9sLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICkgcmV0dXJucyAoU2hpbmVDb2luVG9rZW4pIHsKICAgICAgICBTaGluZUNvaW5Ub2tlbiBuZXdUb2tlbiA9IG5ldyBTaGluZUNvaW5Ub2tlbigKICAgICAgICB0aGlzLAogICAgICAgIF9wYXJlbnRUb2tlbiwKICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICBfdG9rZW5OYW1lLAogICAgICAgIF9kZWNpbWFsVW5pdHMsCiAgICAgICAgX3Rva2VuU3ltYm9sLAogICAgICAgIF90cmFuc2ZlcnNFbmFibGVkCiAgICAgICAgKTsKICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBuZXdUb2tlbjsKICAgIH0KfQoKCmNvbnRyYWN0IFNoaW5lQ3Jvd2RGdW5kZXIgaXMgQ29udHJvbGxlZCwgU2FmZU1hdGggewogICAgYWRkcmVzcyBwdWJsaWMgY3JlYXRvcjsKCiAgICBhZGRyZXNzIHB1YmxpYyBmdW5kUmVjaXBpZW50OwoKICAgIGFkZHJlc3MgcHVibGljIHJlc2VydmVUZWFtUmVjaXBpZW50OwoKICAgIGFkZHJlc3MgcHVibGljIHJlc2VydmVCb3VudHlSZWNpcGllbnQ7CgogICAgYm9vbCBwdWJsaWMgaXNSZXNlcnZlR2VuZXJhdGVkOwoKICAgIFN0YXRlIHB1YmxpYyBzdGF0ZSA9IFN0YXRlLkZ1bmRyYWlzaW5nOwoKICAgIHVpbnQgcHVibGljIG1pbkZ1bmRpbmdHb2FsOwoKICAgIHVpbnQgcHVibGljIGN1cnJlbnRCYWxhbmNlOwoKICAgIHVpbnQgcHVibGljIHRva2Vuc0lzc3VlZDsKCiAgICB1aW50IHB1YmxpYyBjYXBUb2tlbkFtb3VudDsKCiAgICB1aW50IHB1YmxpYyBzdGFydEJsb2NrTnVtYmVyOwoKICAgIHVpbnQgcHVibGljIGVuZEJsb2NrTnVtYmVyOwoKICAgIHVpbnQgcHVibGljIHRva2VuRXhjaGFuZ2VSYXRlOwoKICAgIFNoaW5lQ29pblRva2VuIHB1YmxpYyBleGNoYW5nZVRva2VuOwoKICAgIGV2ZW50IEdvYWxSZWFjaGVkKGFkZHJlc3MgZnVuZFJlY2lwaWVudCwgdWludCBhbW91bnRSYWlzZWQpOwoKICAgIGV2ZW50IEZ1bmRUcmFuc2ZlcihhZGRyZXNzIGJhY2tlciwgdWludCBhbW91bnQsIGJvb2wgaXNDb250cmlidXRpb24pOwoKICAgIGV2ZW50IEZyb3plbkZ1bmRzKGFkZHJlc3MgdGFyZ2V0LCBib29sIGZyb3plbik7CgogICAgZXZlbnQgTG9nRnVuZGluZ1JlY2VpdmVkKGFkZHJlc3MgYWRkciwgdWludCBhbW91bnQsIHVpbnQgY3VycmVudFRvdGFsKTsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgYmFsYW5jZU9mOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHJpdmF0ZSBmcm96ZW5BY2NvdW50OwoKICAgIGVudW0gU3RhdGUgewogICAgICAgIEZ1bmRyYWlzaW5nLAogICAgICAgIEV4cGlyZWRSZWZ1bmQsCiAgICAgICAgU3VjY2Vzc2Z1bCwKICAgICAgICBDbG9zZWQKICAgIH0KCiAgICBtb2RpZmllciBpblN0YXRlKFN0YXRlIF9zdGF0ZSkgewogICAgICAgIGlmIChzdGF0ZSAhPSBfc3RhdGUpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgYXRFbmRPZkZ1bmRyYWlzaW5nKCkgewogICAgICAgIGlmICghKChzdGF0ZSA9PSBTdGF0ZS5FeHBpcmVkUmVmdW5kIHx8IHN0YXRlID09IFN0YXRlLlN1Y2Nlc3NmdWwpICYmIGJsb2NrLm51bWJlciA+IGVuZEJsb2NrTnVtYmVyKQogICAgICAgICkgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBhY2NvdW50Tm90RnJvemVuKCkgewogICAgICAgIGlmIChmcm96ZW5BY2NvdW50W21zZy5zZW5kZXJdID09IHRydWUpIHRocm93OwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgbWluSW52ZXN0bWVudCgpIHsKICAgICAgICAvLyBVc2VyIGhhcyB0byBzZW5kIGF0IGxlYXN0IDAuMDEgRXRoCiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gMTAgKiogMTYpOwogICAgICAgIF87CiAgICB9CgoKICAgIGZ1bmN0aW9uIFNoaW5lQ3Jvd2RGdW5kZXIoCiAgICAgICAgYWRkcmVzcyBfZnVuZFJlY2lwaWVudCwKICAgICAgICBhZGRyZXNzIF9yZXNlcnZlVGVhbVJlY2lwaWVudCwKICAgICAgICBhZGRyZXNzIF9yZXNlcnZlQm91bnR5UmVjaXBpZW50LAogICAgICAgIFNoaW5lQ29pblRva2VuIF9hZGRyZXNzT2ZFeGNoYW5nZVRva2VuCiAgICApIHsKICAgICAgICBjcmVhdG9yID0gbXNnLnNlbmRlcjsKCiAgICAgICAgZnVuZFJlY2lwaWVudCA9IF9mdW5kUmVjaXBpZW50OwogICAgICAgIHJlc2VydmVUZWFtUmVjaXBpZW50ID0gX3Jlc2VydmVUZWFtUmVjaXBpZW50OwogICAgICAgIHJlc2VydmVCb3VudHlSZWNpcGllbnQgPSBfcmVzZXJ2ZUJvdW50eVJlY2lwaWVudDsKCiAgICAgICAgaXNSZXNlcnZlR2VuZXJhdGVkID0gZmFsc2U7CgogICAgICAgIG1pbkZ1bmRpbmdHb2FsID0gMTI1MCAqIDEgZXRoZXI7CiAgICAgICAgY2FwVG9rZW5BbW91bnQgPSAxMDAwMDAwMCAqIDEwICoqIDk7CgogICAgICAgIHN0YXRlID0gU3RhdGUuRnVuZHJhaXNpbmc7CgogICAgICAgIGN1cnJlbnRCYWxhbmNlID0gMDsKICAgICAgICB0b2tlbnNJc3N1ZWQgPSAwOwoKICAgICAgICBzdGFydEJsb2NrTnVtYmVyID0gYmxvY2subnVtYmVyOwogICAgICAgIGVuZEJsb2NrTnVtYmVyID0gc3RhcnRCbG9ja051bWJlciArICgoMzEgKiAyNCAqIDM2MDApIC8gMTgpOyAvLyAzMSBkYXlzCgogICAgICAgIHRva2VuRXhjaGFuZ2VSYXRlID0gNDAwICogMTAgKiogOTsKCiAgICAgICAgZXhjaGFuZ2VUb2tlbiA9IFNoaW5lQ29pblRva2VuKF9hZGRyZXNzT2ZFeGNoYW5nZVRva2VuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXNlcnZlVGVhbVJlY2lwaWVudChhZGRyZXNzIF9yZXNlcnZlVGVhbVJlY2lwaWVudCkgb25seUNvbnRyb2xsZXIgewogICAgICAgIHJlc2VydmVUZWFtUmVjaXBpZW50ID0gX3Jlc2VydmVUZWFtUmVjaXBpZW50OwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVJlc2VydmVCb3VudHlSZWNpcGllbnQoYWRkcmVzcyBfcmVzZXJ2ZUJvdW50eVJlY2lwaWVudCkgb25seUNvbnRyb2xsZXIgewogICAgICAgIHJlc2VydmVCb3VudHlSZWNpcGllbnQgPSBfcmVzZXJ2ZUJvdW50eVJlY2lwaWVudDsKICAgIH0KCiAgICBmdW5jdGlvbiBmcmVlemVBY2NvdW50KGFkZHJlc3MgdGFyZ2V0LCBib29sIGZyZWV6ZSkgb25seUNvbnRyb2xsZXIgewogICAgICAgIGZyb3plbkFjY291bnRbdGFyZ2V0XSA9IGZyZWV6ZTsKICAgICAgICBGcm96ZW5GdW5kcyh0YXJnZXQsIGZyZWV6ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXhjaGFuZ2VSYXRlKHVpbnQgYW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB0b2tlbkV4Y2hhbmdlUmF0ZSAqIGFtb3VudCAvIDEgZXRoZXI7CiAgICB9CgogICAgZnVuY3Rpb24gaW52ZXN0bWVudCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLkZ1bmRyYWlzaW5nKSBhY2NvdW50Tm90RnJvemVuIG1pbkludmVzdG1lbnQgcGF5YWJsZSByZXR1cm5zICh1aW50KSAgewogICAgICAgIHVpbnQgYW1vdW50ID0gbXNnLnZhbHVlOwogICAgICAgIGlmIChhbW91bnQgPT0gMCkgdGhyb3c7CgogICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSArPSBhbW91bnQ7CiAgICAgICAgY3VycmVudEJhbGFuY2UgKz0gYW1vdW50OwoKICAgICAgICB1aW50IHRva2VuQW1vdW50ID0gZ2V0RXhjaGFuZ2VSYXRlKGFtb3VudCk7CiAgICAgICAgZXhjaGFuZ2VUb2tlbi5nZW5lcmF0ZVRva2Vucyhtc2cuc2VuZGVyLCB0b2tlbkFtb3VudCk7CiAgICAgICAgdG9rZW5zSXNzdWVkICs9IHRva2VuQW1vdW50OwoKICAgICAgICBGdW5kVHJhbnNmZXIobXNnLnNlbmRlciwgYW1vdW50LCB0cnVlKTsKICAgICAgICBMb2dGdW5kaW5nUmVjZWl2ZWQobXNnLnNlbmRlciwgdG9rZW5BbW91bnQsIHRva2Vuc0lzc3VlZCk7CgogICAgICAgIGNoZWNrSWZGdW5kaW5nQ29tcGxldGVPckV4cGlyZWQoKTsKCiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZlttc2cuc2VuZGVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGVja0lmRnVuZGluZ0NvbXBsZXRlT3JFeHBpcmVkKCkgewogICAgICAgIGlmIChibG9jay5udW1iZXIgPiBlbmRCbG9ja051bWJlciB8fCB0b2tlbnNJc3N1ZWQgPj0gY2FwVG9rZW5BbW91bnQpIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRCYWxhbmNlID49IG1pbkZ1bmRpbmdHb2FsKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IFN0YXRlLlN1Y2Nlc3NmdWw7CiAgICAgICAgICAgICAgICBwYXlPdXQoKTsKCiAgICAgICAgICAgICAgICBHb2FsUmVhY2hlZChmdW5kUmVjaXBpZW50LCBjdXJyZW50QmFsYW5jZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IFN0YXRlLkV4cGlyZWRSZWZ1bmQ7IC8vIGJhY2tlcnMgY2FuIG5vdyBjb2xsZWN0IHJlZnVuZHMgYnkgY2FsbGluZyBnZXRSZWZ1bmQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBheU91dCgpIHB1YmxpYyBpblN0YXRlKFN0YXRlLlN1Y2Nlc3NmdWwpIG9ubHlDb250cm9sbGVyKCkgewogICAgICAgIHZhciBhbW91bnQgPSBjdXJyZW50QmFsYW5jZTsKICAgICAgICBjdXJyZW50QmFsYW5jZSA9IDA7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5DbG9zZWQ7CgogICAgICAgIGZ1bmRSZWNpcGllbnQudHJhbnNmZXIoYW1vdW50KTsKCiAgICAgICAgZ2VuZXJhdGVSZXNlcnZlKCk7CgogICAgICAgIGV4Y2hhbmdlVG9rZW4uZW5hYmxlVHJhbnNmZXJzKHRydWUpOwogICAgICAgIGV4Y2hhbmdlVG9rZW4uY2hhbmdlUmVzZXJ2ZVRlYW1SZWNlcGllbnQocmVzZXJ2ZVRlYW1SZWNpcGllbnQpOwogICAgICAgIGV4Y2hhbmdlVG9rZW4uY2hhbmdlQ29udHJvbGxlcihjb250cm9sbGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSZWZ1bmQoKSBwdWJsaWMgaW5TdGF0ZShTdGF0ZS5FeHBpcmVkUmVmdW5kKSB7CiAgICAgICAgdWludCBhbW91bnRUb1JlZnVuZCA9IGJhbGFuY2VPZlttc2cuc2VuZGVyXTsKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudFRvUmVmdW5kKTsKICAgICAgICBjdXJyZW50QmFsYW5jZSAtPSBhbW91bnRUb1JlZnVuZDsKCiAgICAgICAgRnVuZFRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudFRvUmVmdW5kLCBmYWxzZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVSZXNlcnZlKCkgewogICAgICAgIGlmIChpc1Jlc2VydmVHZW5lcmF0ZWQpIHsKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB1aW50IGlzc3VlZCA9IHRva2Vuc0lzc3VlZDsKICAgICAgICAgICAgdWludCBwZXJjZW50VGVhbSA9IDE1OwogICAgICAgICAgICB1aW50IHBlcmNlbnRCb3VudHkgPSAxOwogICAgICAgICAgICB1aW50IHJlc2VydmVBbW91bnRUZWFtID0gZGl2KG11bChpc3N1ZWQsIHBlcmNlbnRUZWFtKSwgODUpOwogICAgICAgICAgICB1aW50IHJlc2VydmVBbW91bnRCb3VudHkgPSBkaXYobXVsKGlzc3VlZCwgcGVyY2VudEJvdW50eSksIDk5KTsKICAgICAgICAgICAgZXhjaGFuZ2VUb2tlbi5nZW5lcmF0ZVRva2VucyhyZXNlcnZlVGVhbVJlY2lwaWVudCwgcmVzZXJ2ZUFtb3VudFRlYW0pOwogICAgICAgICAgICBleGNoYW5nZVRva2VuLmdlbmVyYXRlVG9rZW5zKHJlc2VydmVCb3VudHlSZWNpcGllbnQsIHJlc2VydmVBbW91bnRCb3VudHkpOwogICAgICAgICAgICBpc1Jlc2VydmVHZW5lcmF0ZWQgPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVDb250cmFjdCgpIHB1YmxpYyBhdEVuZE9mRnVuZHJhaXNpbmcgb25seUNvbnRyb2xsZXIoKSB7CiAgICAgICAgaWYgKHN0YXRlICE9IFN0YXRlLkNsb3NlZCkgewogICAgICAgICAgICBleGNoYW5nZVRva2VuLmNoYW5nZUNvbnRyb2xsZXIoY29udHJvbGxlcik7CiAgICAgICAgfQogICAgICAgIHNlbGZkZXN0cnVjdChtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKiBkZWZhdWx0ICovCiAgICBmdW5jdGlvbigpIGluU3RhdGUoU3RhdGUuRnVuZHJhaXNpbmcpIGFjY291bnROb3RGcm96ZW4gcGF5YWJsZSB7CiAgICAgICAgaW52ZXN0bWVudCgpOwogICAgfQoKfQ=='.
	

]
