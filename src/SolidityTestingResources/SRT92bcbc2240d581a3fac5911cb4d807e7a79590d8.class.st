Class {
	#name : #SRT92bcbc2240d581a3fac5911cb4d807e7a79590d8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT92bcbc2240d581a3fac5911cb4d807e7a79590d8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7Cgpjb250cmFjdCBQaXhlbCB7CiAgICAvKiBUaGlzIGNyZWF0ZXMgYW4gYXJyYXkgd2l0aCBhbGwgYmFsYW5jZXMgKi8KICAgIHN0cnVjdCBTZWN0aW9uIHsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIHVpbnQyNTYgcHJpY2U7CiAgICAgICAgYm9vbCBmb3Jfc2FsZTsKICAgICAgICBib29sIGluaXRpYWxfcHVyY2hhc2VfZG9uZTsKICAgICAgICB1aW50IGltYWdlX2lkOwogICAgICAgIHN0cmluZyBtZDU7CiAgICAgICAgdWludCBsYXN0X3VwZGF0ZTsKICAgICAgICBhZGRyZXNzIHNlbGxfb25seV90bzsKICAgICAgICB1aW50MTYgaW5kZXg7CiAgICAgICAgLy9ieXRlczMyWzEwXSBpbWFnZV9kYXRhOwogICAgfQogICAgc3RyaW5nIHB1YmxpYyBzdGFuZGFyZCA9ICJJUE8gMC45IjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJJbml0aWFsIFBpeGVsIE9mZmVyaW5nIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIklQTyI7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAwOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZU9mOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgZXRoQmFsYW5jZTsKICAgIGFkZHJlc3Mgb3duZXI7CiAgICB1aW50MjU2IHB1YmxpYyBpcG9fcHJpY2U7CiAgICBTZWN0aW9uWzEwMDAwXSBwdWJsaWMgc2VjdGlvbnM7CiAgICB1aW50MjU2IHB1YmxpYyBwb29sOwogICAgdWludCBwdWJsaWMgbWFwV2lkdGg7CiAgICB1aW50IHB1YmxpYyBtYXBIZWlnaHQ7CiAgICB1aW50MjU2IHRva2VuVG90YWxTdXBwbHkgPSAxMDAwMDsKCiAgICBldmVudCBCdXkodWludCBzZWN0aW9uX2lkKTsKICAgIGV2ZW50IE5ld0xpc3RpbmcodWludCBzZWN0aW9uX2lkLCB1aW50IHByaWNlKTsKICAgIGV2ZW50IERlbGlzdGVkKHVpbnQgc2VjdGlvbl9pZCk7CiAgICBldmVudCBOZXdJbWFnZSh1aW50IHNlY3Rpb25faWQpOwogICAgZXZlbnQgQXJlYVByaWNlKHVpbnQgc3RhcnRfc2VjdGlvbl9pbmRleCwgdWludCBlbmRfc2VjdGlvbl9pbmRleCwgdWludCBhcmVhX3ByaWNlKTsKICAgIGV2ZW50IFNlbnRWYWx1ZSh1aW50IHZhbHVlKTsKICAgIGV2ZW50IFByaWNlVXBkYXRlKHVpbnQyNTYgcHJpY2UpOwogICAgZXZlbnQgV2l0aGRyYXdFdmVudChzdHJpbmcgbXNnKTsKCiAgICBmdW5jdGlvbiBQaXhlbCgpIHsKICAgICAgICBwb29sID0gdG9rZW5Ub3RhbFN1cHBseTsgLy9OdW1iZXIgb2YgdG9rZW4gLyBzcGFjZXMKICAgICAgICBpcG9fcHJpY2UgPSAxMDAwMDAwMDAwMDAwMDAwMDA7IC8vIDAuMQogICAgICAgIG1hcFdpZHRoID0gMTAwMDsKICAgICAgICBtYXBIZWlnaHQgPSAxMDAwOwogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQgdG90YWxTdXBwbHkpCiAgICB7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b2tlblRvdGFsU3VwcGx5OwogICAgfQoKICAgIC8vLyBVcGRhdGVzIGEgcGl4ZWwgc2VjdGlvbidzIGluZGV4IG51bWJlcgogICAgLy8vIE5vdCB0byBiZSBjYWxsZWQgYnkgYW55b25lIGJ1dCB0aGUgY29udHJhY3Qgb3duZXIKICAgIGZ1bmN0aW9uIHVwZGF0ZVBpeGVsSW5kZXgoCiAgICAgICAgdWludDE2IF9zdGFydCwKICAgICAgICB1aW50MTYgX2VuZAogICAgKSB7CiAgICAgICAgaWYobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7IAogICAgICAgIGlmKF9lbmQgPCBfc3RhcnQpIHRocm93OwogICAgICAgIHdoaWxlKF9zdGFydCA8IF9lbmQpCiAgICAgICAgewogICAgICAgICAgICBzZWN0aW9uc1tfc3RhcnRdLmluZGV4ID0gX3N0YXJ0OwogICAgICAgICAgICBfc3RhcnQrKzsKICAgICAgICB9CiAgICB9CgogICAgLy8vIFVwZGF0ZSB0aGUgY3VycmVudCBJUE8gcHJpY2UKICAgIGZ1bmN0aW9uIHVwZGF0ZUlQT1ByaWNlKAogICAgICAgIHVpbnQyNTYgX25ld19wcmljZQogICAgKSB7CiAgICAgICAgaWYobXNnLnNlbmRlciAhPSBvd25lcikgdGhyb3c7CiAgICAgICAgaXBvX3ByaWNlID0gX25ld19wcmljZTsKICAgICAgICBQcmljZVVwZGF0ZShpcG9fcHJpY2UpOwogICAgfQoKICAgIC8qIEdldCB0aGUgaW5kZXggdG8gYWNjZXNzIGEgc2VjdGlvbiBvYmplY3QgZnJvbSB0aGUgcHJvdmlkZWQgcmF3IHgseSAqLwogICAgLy8vIENvbnZlcnQgZnJvbSBhIHBpeGVsJ3MgeCwgeSBjb29yZGluYXRlcyB0byBpdHMgc2VjdGlvbiBpbmRleAogICAgLy8vIFRoaXMgaXMgYSBoZWxwZXIgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIGdldFNlY3Rpb25JbmRleEZyb21SYXcoCiAgICAgICAgdWludCBfeCwKICAgICAgICB1aW50IF95CiAgICApIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoX3ggPj0gbWFwV2lkdGgpIHRocm93OwogICAgICAgIGlmIChfeSA+PSBtYXBIZWlnaHQpIHRocm93OwogICAgICAgIC8vIENvbnZlcnQgcmF3IHgsIHkgdG8gc2VjdGlvbiBpZGVudGlmZXIgeCB5CiAgICAgICAgX3ggPSBfeCAvIDEwOwogICAgICAgIF95ID0gX3kgLyAxMDsKICAgICAgICAvL0dldCBzZWN0aW9uX2lkZW50aWZpZXIgZnJvbSBjb29yZHMKICAgICAgICByZXR1cm4gX3ggKyAoX3kgKiAxMDApOwogICAgfQoKICAgIC8qIEdldCB0aGUgaW5kZXggdG8gYWNjZXNzIGEgc2VjdGlvbiBvYmplY3QgZnJvbSBpdHMgc2VjdGlvbiBpZGVudGlmaWVyICovCiAgICAvLy8gR2V0IFNlY3Rpb24gaW5kZXggYmFzZWQgb24gaXRzIHVwcGVyIGxlZnQgeCx5IGNvb3JkaW5hdGVzIG9yICJpZGVudGlmaWVyIgogICAgLy8vIGNvb3JkaW5hdGVzCiAgICAvLy8gVGhpcyBpcyBhIGhlbHBlciBmdW5jdGlvbgogICAgZnVuY3Rpb24gZ2V0U2VjdGlvbkluZGV4RnJvbUlkZW50aWZpZXIgKAogICAgICAgIHVpbnQgX3hfc2VjdGlvbl9pZGVudGlmaWVyLAogICAgICAgIHVpbnQgX3lfc2VjdGlvbl9pZGVudGlmaWVyCiAgICApIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoX3hfc2VjdGlvbl9pZGVudGlmaWVyID49IChtYXBXaWR0aCAvIDEwKSkgdGhyb3c7CiAgICAgICAgaWYgKF95X3NlY3Rpb25faWRlbnRpZmllciA+PSAobWFwSGVpZ2h0IC8gMTApKSB0aHJvdzsKICAgICAgICB1aW50IGluZGV4ID0gX3hfc2VjdGlvbl9pZGVudGlmaWVyICsgKF95X3NlY3Rpb25faWRlbnRpZmllciAqIDEwMCk7CiAgICAgICAgcmV0dXJuIGluZGV4OwogICAgfQoKICAgIC8qIEdldCB4LHkgc2VjdGlvbl9pZGVudGlmaWVyIGZyb20gYSBzZWN0aW9uIGluZGV4ICovCiAgICAvLy8gR2V0IFNlY3Rpb24gdXBwZXIgbGVmdCB4LHkgY29vcmRpbmF0ZXMgb3IgImlkZW50aWZpZXIiIGNvb3JkaW5hdGVzCiAgICAvLy8gYmFzZWQgb24gaXRzIGluZGV4IG51bWJlcgogICAgLy8vIFRoaXMgaXMgYSBoZWxwZXIgZnVuY3Rpb24KICAgIGZ1bmN0aW9uIGdldElkZW50aWZpZXJGcm9tU2VjdGlvbkluZGV4KAogICAgICAgIHVpbnQgX2luZGV4CiAgICApIHJldHVybnMgKHVpbnQgeCwgdWludCB5KSB7CiAgICAgICAgaWYgKF9pbmRleCA+IChtYXBXaWR0aCAqIG1hcEhlaWdodCkpIHRocm93OwogICAgICAgIHggPSBfaW5kZXggJSAxMDA7CiAgICAgICAgeSA9IChfaW5kZXggLSAoX2luZGV4ICUgMTAwKSkgLyAxMDA7CiAgICB9CgogICAgLyogQ2hlY2sgdG8gc2VlIGlmIFNlY3Rpb24gaXMgYXZhaWxhYmxlIGZvciBmaXJzdCBwdXJjaGFzZSAqLwogICAgLy8vIFJldHVybnMgd2hldGhlciBhIHNlY3Rpb24gaXMgYXZhaWxhYmxlIGZvciBwdXJjaGFzZSBhdCBJUE8gcHJpY2UKICAgIGZ1bmN0aW9uIHNlY3Rpb25BdmFpbGFibGUoCiAgICAgICAgdWludCBfc2VjdGlvbl9pbmRleAogICAgKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKF9zZWN0aW9uX2luZGV4ID49IHNlY3Rpb25zLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgU2VjdGlvbiBzID0gc2VjdGlvbnNbX3NlY3Rpb25faW5kZXhdOwogICAgICAgIC8vIFRoZSBzZWN0aW9uIGhhcyBub3QgYmVlbiBwdWNoYXNlZCBwcmV2aW91c2x5CiAgICAgICAgcmV0dXJuICFzLmluaXRpYWxfcHVyY2hhc2VfZG9uZTsKICAgIH0KCiAgICAvKiBDaGVjayB0byBzZWUgaWYgU2VjdGlvbiBpcyBhdmFpbGFibGUgZm9yIHB1cmNoYXNlICovCiAgICAvLy8gUmV0dXJucyB3aGV0aGVyIGEgc2VjdGlvbiBpcyBhdmFpbGFibGUgZm9yIHB1cmNoYXNlIGFzIGEgbWFya2V0IHNhbGUKICAgIGZ1bmN0aW9uIHNlY3Rpb25Gb3JTYWxlKAogICAgICAgIHVpbnQgX3NlY3Rpb25faW5kZXgKICAgICkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChfc2VjdGlvbl9pbmRleCA+PSBzZWN0aW9ucy5sZW5ndGgpIHRocm93OwogICAgICAgIFNlY3Rpb24gcyA9IHNlY3Rpb25zW19zZWN0aW9uX2luZGV4XTsKICAgICAgICAvLyBIYXMgdGhlIHVzZXIgc2V0IHRoZSBzZWN0aW9uIGFzIGZvcl9zYWxlCiAgICAgICAgaWYocy5mb3Jfc2FsZSkKICAgICAgICB7CiAgICAgICAgICAgIC8vIEhhcyB0aGUgb3duZXIgc2V0IGEgInNlbGwgb25seSB0byIgYWRkcmVzcz8KICAgICAgICAgICAgaWYocy5zZWxsX29ubHlfdG8gPT0gMHgwKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYocy5zZWxsX29ubHlfdG8gPT0gbXNnLnNlbmRlcikgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgLy8gTm90IGZvciBzYWxlCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyogR2V0IHRoZSBwcmljZSBvZiB0aGUgU2VjdGlvbiAqLwogICAgLy8vIFJldHVybnMgdGhlIHByaWNlIG9mIGEgc2VjdGlvbiBhdCBtYXJrZXQgcHJpY2UuCiAgICAvLy8gVGhpcyBpcyBhIGhlbHBlciBmdW5jdGlvbiwgaXQgaXMgbW9yZSBlZmZpY2llbnQgdG8ganVzdCBhY2Nlc3MgdGhlCiAgICAvLy8gY29udHJhY3QncyBzZWN0aW9ucyBhdHRyaWJ1dGUgZGlyZWN0bHkKICAgIGZ1bmN0aW9uIHNlY3Rpb25QcmljZSgKICAgICAgICB1aW50IF9zZWN0aW9uX2luZGV4CiAgICApIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoX3NlY3Rpb25faW5kZXggPj0gc2VjdGlvbnMubGVuZ3RoKSB0aHJvdzsKICAgICAgICBTZWN0aW9uIHMgPSBzZWN0aW9uc1tfc2VjdGlvbl9pbmRleF07CiAgICAgICAgcmV0dXJuIHMucHJpY2U7CiAgICB9CgogICAgLyoKICAgIENoZWNrIHRvIHNlZSBpZiBhIHJlZ2lvbiBpcyBhdmFpbGFibGUgcHJvdmlkZWQgdGhlCiAgICB0b3AtbGVmdCAoc3RhcnQpIHNlY3Rpb24gYW5kIHRoZSBib3R0b20tcmlnaHQgKGVuZCkKICAgIHNlY3Rpb24uCiAgICAqLwogICAgLy8vIFJldHVybnMgaWYgYSBzZWN0aW9uIGlzIGF2YWlsYWJsZSBmb3IgcHVyY2hhc2UsIGl0IHJldHVybnMgdGhlIGZvbGxvd2luZzoKICAgIC8vLyBib29sOiBpZiB0aGUgcmVnaW9uIGlzIGF2YWlsYWJsZSBmb3IgcHVyY2hhc2UKICAgIC8vLyB1aW50MjU2OiB0aGUgZXh0ZW5kZWQgcHJpY2UsIHN1bSBvZiBhbGwgb2YgdGhlIG1hcmtldCBwcmljZXMgb2YgdGhlIHNlY3Rpb25zCiAgICAvLy8gICBpbiB0aGUgcmVnaW9uCiAgICAvLy8gdWludDI1NjogdGhlIG51bWJlciBvZiBzZWN0aW9ucyBhdmFpbGFibGUgaW4gdGhlIHJlZ2lvbiBhdCB0aGUgSVBPIHByaWNlCiAgICBmdW5jdGlvbiByZWdpb25BdmFpbGFibGUoCiAgICAgICAgdWludCBfc3RhcnRfc2VjdGlvbl9pbmRleCwKICAgICAgICB1aW50IF9lbmRfc2VjdGlvbl9pbmRleAogICAgKSByZXR1cm5zIChib29sIGF2YWlsYWJsZSwgdWludCBleHRlbmRlZF9wcmljZSwgdWludCBpcG9fY291bnQpIHsKICAgICAgICBpZiAoX2VuZF9zZWN0aW9uX2luZGV4IDwgX3N0YXJ0X3NlY3Rpb25faW5kZXgpIHRocm93OwogICAgICAgIHZhciAoc3RhcnRfeCwgc3RhcnRfeSkgPSBnZXRJZGVudGlmaWVyRnJvbVNlY3Rpb25JbmRleChfc3RhcnRfc2VjdGlvbl9pbmRleCk7CiAgICAgICAgdmFyIChlbmRfeCwgZW5kX3kpID0gZ2V0SWRlbnRpZmllckZyb21TZWN0aW9uSW5kZXgoX2VuZF9zZWN0aW9uX2luZGV4KTsKICAgICAgICBpZiAoc3RhcnRfeCA+PSBtYXBXaWR0aCkgdGhyb3c7CiAgICAgICAgaWYgKHN0YXJ0X3kgPj0gbWFwSGVpZ2h0KSB0aHJvdzsKICAgICAgICBpZiAoZW5kX3ggPj0gbWFwV2lkdGgpIHRocm93OwogICAgICAgIGlmIChlbmRfeSA+PSBtYXBIZWlnaHQpIHRocm93OwogICAgICAgIHVpbnQgeV9wb3MgPSBzdGFydF95OwogICAgICAgIGF2YWlsYWJsZSA9IGZhbHNlOwogICAgICAgIGV4dGVuZGVkX3ByaWNlID0gMDsKICAgICAgICBpcG9fY291bnQgPSAwOwogICAgICAgIHdoaWxlICh5X3BvcyA8PSBlbmRfeSkKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgeF9wb3MgPSBzdGFydF94OwogICAgICAgICAgICB3aGlsZSAoeF9wb3MgPD0gZW5kX3gpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHVpbnQgaWRlbnRpZmllciA9ICh4X3BvcyArICh5X3BvcyAqIDEwMCkpOwogICAgICAgICAgICAgICAgLy8gSXMgdGhpcyBzZWN0aW9uIGF2YWlsYWJsZSBmb3IgZmlyc3QgKElQTykgcHVyY2hhc2U/CiAgICAgICAgICAgICAgICBpZihzZWN0aW9uQXZhaWxhYmxlKGlkZW50aWZpZXIpKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBzZWN0aW9uIGlzIGF2YWlsYWJsZSBhcyBhbiBJUE8KICAgICAgICAgICAgICAgICAgICBpcG9fY291bnQgPSBpcG9fY291bnQgKyAxOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHNlY3Rpb24gaGFzIGJlZW4gcHVyY2hhc2VkLCBpdCBjYW4gb25seSBiZSBhdmFpbGFibGUKICAgICAgICAgICAgICAgICAgICAvLyBhcyBhIG1hcmtldCBzYWxlLgogICAgICAgICAgICAgICAgICAgIGlmKHNlY3Rpb25Gb3JTYWxlKGlkZW50aWZpZXIpKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5kZWRfcHJpY2UgPSBleHRlbmRlZF9wcmljZSArIHNlY3Rpb25QcmljZShpZGVudGlmaWVyKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAvL0Rvbid0IHJldHVybiBhIHByaWNlIGlmIHRoZXJlIGlzIGFuIHVuYXZhaWxhYmxlIHNlY3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgLy90byByZWR1Y2UgY29uZnVzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuZGVkX3ByaWNlID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgaXBvX2NvdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHhfcG9zID0geF9wb3MgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHlfcG9zID0geV9wb3MgKyAxOwogICAgICAgIH0KICAgICAgICBhdmFpbGFibGUgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLy8gQnV5IGEgc2VjdGlvbiBiYXNlZCBvbiBpdHMgaW5kZXggYW5kIHNldCBpdHMgY2xvdWQgaW1hZ2VfaWQgYW5kIG1kNQogICAgLy8vIFRoaXMgZnVuY3Rpb24gaXMgcGF5YWJsZSwgYW55IG92ZXIgcGF5bWVudCB3aWxsIGJlIHdpdGhkcmF3LWFibGUKICAgIGZ1bmN0aW9uIGJ1eVNlY3Rpb24gKAogICAgICAgIHVpbnQgX3NlY3Rpb25faW5kZXgsCiAgICAgICAgdWludCBfaW1hZ2VfaWQsCiAgICAgICAgc3RyaW5nIF9tZDUKICAgICkgcGF5YWJsZSB7CiAgICAgICAgaWYgKF9zZWN0aW9uX2luZGV4ID49IHNlY3Rpb25zLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgU2VjdGlvbiBzZWN0aW9uID0gc2VjdGlvbnNbX3NlY3Rpb25faW5kZXhdOwogICAgICAgIGlmKCFzZWN0aW9uLmZvcl9zYWxlICYmIHNlY3Rpb24uaW5pdGlhbF9wdXJjaGFzZV9kb25lKQogICAgICAgIHsKICAgICAgICAgICAgLy9TZWN0aW9uIG5vdCBmb3Igc2FsZQogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICAgICAgLy8gUHJvY2VzcyBwYXltZW50CiAgICAgICAgLy8gSXMgdGhpcyBTZWN0aW9uIG9uIHRoZSBvcGVuIG1hcmtldD8KICAgICAgICBpZihzZWN0aW9uLmluaXRpYWxfcHVyY2hhc2VfZG9uZSkKICAgICAgICB7CiAgICAgICAgICAgIC8vIFNlY3Rpb24gc29sZCwgc2VsbCBmb3IgbWFya2V0IHByaWNlCiAgICAgICAgICAgIGlmKG1zZy52YWx1ZSA8IHNlY3Rpb24ucHJpY2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIE5vdCBlbm91Z2ggZnVuZHMgd2VyZSBzZW50CiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBGZWUKICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgbmVlZCB0byBjaGFuZ2UgdGhlIGJhbGFuY2UgaWYgdGhlIHNlY3Rpb24gcHJpY2UgaXMgbm9uLXplcm8KICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uLnByaWNlICE9IDApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdWludCBmZWUgPSBzZWN0aW9uLnByaWNlIC8gMTAwOwogICAgICAgICAgICAgICAgICAgIC8vIFBheSBjb250cmFjdCBvd25lciB0aGUgZmVlCiAgICAgICAgICAgICAgICAgICAgZXRoQmFsYW5jZVtvd25lcl0gKz0gZmVlOwogICAgICAgICAgICAgICAgICAgIC8vIFBheSB0aGUgc2VjdGlvbiBvd25lciB0aGUgcHJpY2UgbWludXMgdGhlIGZlZQogICAgICAgICAgICAgICAgICAgIGV0aEJhbGFuY2Vbc2VjdGlvbi5vd25lcl0gKz0gKG1zZy52YWx1ZSAtIGZlZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBSZWZ1bmQgYW55IG92ZXJwYXltZW50CiAgICAgICAgICAgICAgICAvL3JlcXVpcmUobXNnLnZhbHVlID4gKG1zZy52YWx1ZSAtIHNlY3Rpb24ucHJpY2UpKTsKICAgICAgICAgICAgICAgIGV0aEJhbGFuY2VbbXNnLnNlbmRlcl0gKz0gKG1zZy52YWx1ZSAtIHNlY3Rpb24ucHJpY2UpOwogICAgICAgICAgICAgICAgLy8gT3duZXIgbG9zZXMgYSB0b2tlbgogICAgICAgICAgICAgICAgYmFsYW5jZU9mW3NlY3Rpb24ub3duZXJdLS07CiAgICAgICAgICAgICAgICAvLyBCdXllciBnZXRzIGEgdG9rZW4KICAgICAgICAgICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSsrOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlCiAgICAgICAgewogICAgICAgICAgICAvLyBJbml0aWFsIHNhbGUsIHNlbGwgZm9yIElQTyBwcmljZQogICAgICAgICAgICBpZihtc2cudmFsdWUgPCBpcG9fcHJpY2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIE5vdCBlbm91Z2ggZnVuZHMgd2VyZSBzZW50CiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIFBheSB0aGUgY29udHJhY3Qgb3duZXIKICAgICAgICAgICAgICAgIGV0aEJhbGFuY2Vbb3duZXJdICs9IG1zZy52YWx1ZTsKICAgICAgICAgICAgICAgIC8vIFJlZnVuZCBhbnkgb3ZlcnBheW1lbnQKICAgICAgICAgICAgICAgIC8vcmVxdWlyZShtc2cudmFsdWUgPiAobXNnLnZhbHVlIC0gaXBvX3ByaWNlKSk7CiAgICAgICAgICAgICAgICBldGhCYWxhbmNlW21zZy5zZW5kZXJdICs9IChtc2cudmFsdWUgLSBpcG9fcHJpY2UpOwogICAgICAgICAgICAgICAgLy8gUmVkdWNlIHRva2VuIHBvb2wKICAgICAgICAgICAgICAgIHBvb2wtLTsKICAgICAgICAgICAgICAgIC8vIEJ1eWVyIGdldHMgYSB0b2tlbgogICAgICAgICAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy9QYXltZW50IGFuZCB0b2tlbiB0cmFuc2ZlciBjb21wbGV0ZQogICAgICAgIC8vVHJhbnNmZXIgb3duZXJzaGlwIGFuZCBzZXQgbm90IGZvciBzYWxlIGJ5IGRlZmF1bHQKICAgICAgICBzZWN0aW9uLm93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICBzZWN0aW9uLm1kNSA9IF9tZDU7CiAgICAgICAgc2VjdGlvbi5pbWFnZV9pZCA9IF9pbWFnZV9pZDsKICAgICAgICBzZWN0aW9uLmxhc3RfdXBkYXRlID0gYmxvY2sudGltZXN0YW1wOwogICAgICAgIHNlY3Rpb24uZm9yX3NhbGUgPSBmYWxzZTsKICAgICAgICBzZWN0aW9uLmluaXRpYWxfcHVyY2hhc2VfZG9uZSA9IHRydWU7IC8vIGV2ZW4gaWYgbm90IHRoZSBmaXJzdCwgd2UgY2FuIHByZXRlbmQgaXQgaXMKICAgIH0KCiAgICAvKiBCdXkgYW4gZW50aXJlIHJlZ2lvbiAqLwogICAgLy8vIEJ1eSBhIHJlZ2lvbiBvZiBzZWN0aW9ucyBzdGFydGluZyBhbmQgaW5jbHVkaW5nIHRoZSB0b3AgbGVmdCBzZWN0aW9uIGluZGV4CiAgICAvLy8gZW5kaW5nIGF0IGFuZCBpbmNsdWRpbmcgdGhlIGJvdHRvbSBsZWZ0IHNlY3Rpb24gaW5kZXguIEFuZCBzZXQgaXRzIGNsb3VkCiAgICAvLy8gaW1hZ2VfaWQgYW5kIG1kNS4gVGhpcyBmdW5jdGlvbiBpcyBwYXlhYmxlLCBpZiB0aGUgdmFsdWUgc2VudCBpcyBsZXNzCiAgICAvLy8gdGhhbiB0aGUgcHJpY2Ugb2YgdGhlIHJlZ2lvbiwgdGhlIGZ1bmN0aW9uIHdpbGwgdGhyb3cuCiAgICBmdW5jdGlvbiBidXlSZWdpb24oCiAgICAgICAgdWludCBfc3RhcnRfc2VjdGlvbl9pbmRleCwKICAgICAgICB1aW50IF9lbmRfc2VjdGlvbl9pbmRleCwKICAgICAgICB1aW50IF9pbWFnZV9pZCwKICAgICAgICBzdHJpbmcgX21kNQogICAgKSBwYXlhYmxlIHJldHVybnMgKHVpbnQgc3RhcnRfc2VjdGlvbl95LCB1aW50IHN0YXJ0X3NlY3Rpb25feCwKICAgIHVpbnQgZW5kX3NlY3Rpb25feSwgdWludCBlbmRfc2VjdGlvbl94KXsKICAgICAgICBpZiAoX2VuZF9zZWN0aW9uX2luZGV4IDwgX3N0YXJ0X3NlY3Rpb25faW5kZXgpIHRocm93OwogICAgICAgIGlmIChfc3RhcnRfc2VjdGlvbl9pbmRleCA+PSBzZWN0aW9ucy5sZW5ndGgpIHRocm93OwogICAgICAgIGlmIChfZW5kX3NlY3Rpb25faW5kZXggPj0gc2VjdGlvbnMubGVuZ3RoKSB0aHJvdzsKICAgICAgICAvLyBpY29fYW1tb3VudCByZWZmZXJzIHRvIHRoZSBudW1iZXIgb2Ygc2VjdGlvbnMgdGhhdCBhcmUgYXZhaWxhYmxlCiAgICAgICAgLy8gYXQgSUNPIHByaWNlCiAgICAgICAgdmFyIChhdmFpbGFibGUsIGV4dF9wcmljZSwgaWNvX2Ftb3VudCkgPSByZWdpb25BdmFpbGFibGUoX3N0YXJ0X3NlY3Rpb25faW5kZXgsIF9lbmRfc2VjdGlvbl9pbmRleCk7CiAgICAgICAgaWYgKCFhdmFpbGFibGUpIHRocm93OwoKICAgICAgICAvLyBDYWxjdWxhdGUgcHJpY2UKICAgICAgICB1aW50IGFyZWFfcHJpY2UgPSAgaWNvX2Ftb3VudCAqIGlwb19wcmljZTsKICAgICAgICBhcmVhX3ByaWNlID0gYXJlYV9wcmljZSArIGV4dF9wcmljZTsKICAgICAgICBBcmVhUHJpY2UoX3N0YXJ0X3NlY3Rpb25faW5kZXgsIF9lbmRfc2VjdGlvbl9pbmRleCwgYXJlYV9wcmljZSk7CiAgICAgICAgU2VudFZhbHVlKG1zZy52YWx1ZSk7CiAgICAgICAgaWYgKGFyZWFfcHJpY2UgPiBtc2cudmFsdWUpIHRocm93OwoKICAgICAgICAvLyBpY29fYW1tb3VudCByZWZmZXJzIHRvIHRoZSBhbW91bnQgaW4gd2VpIHRoYXQgdGhlIGNvbnRyYWN0IG93bmVyCiAgICAgICAgLy8gaXMgb3dlZAogICAgICAgIGljb19hbW91bnQgPSAwOwogICAgICAgIC8vIGV4dF9wcmljZSByZWZmZXJzIHRvIHRoZSBhbW91bnQgaW4gd2VpIHRoYXQgdGhlIGNvbnRyYWN0IG93bmVyIGlzCiAgICAgICAgLy8gb3dlZCBpbiBmZWVzIGZyb20gbWFya2V0IHNhbGVzCiAgICAgICAgZXh0X3ByaWNlID0gMDsKCiAgICAgICAgLy8gVXNlciBzZW50IGVub3VnaCBmdW5kcywgbGV0J3MgZ28KICAgICAgICBzdGFydF9zZWN0aW9uX3ggPSBfc3RhcnRfc2VjdGlvbl9pbmRleCAlIDEwMDsKICAgICAgICBlbmRfc2VjdGlvbl94ID0gX2VuZF9zZWN0aW9uX2luZGV4ICUgMTAwOwogICAgICAgIHN0YXJ0X3NlY3Rpb25feSA9IF9zdGFydF9zZWN0aW9uX2luZGV4IC0gKF9zdGFydF9zZWN0aW9uX2luZGV4ICUgMTAwKTsKICAgICAgICBzdGFydF9zZWN0aW9uX3kgPSBzdGFydF9zZWN0aW9uX3kgLyAxMDA7CiAgICAgICAgZW5kX3NlY3Rpb25feSA9IF9lbmRfc2VjdGlvbl9pbmRleCAtIChfZW5kX3NlY3Rpb25faW5kZXggJSAxMDApOwogICAgICAgIGVuZF9zZWN0aW9uX3kgPSBlbmRfc2VjdGlvbl95IC8gMTAwOwogICAgICAgIHVpbnQgeF9wb3MgPSBzdGFydF9zZWN0aW9uX3g7CiAgICAgICAgd2hpbGUgKHhfcG9zIDw9IGVuZF9zZWN0aW9uX3gpCiAgICAgICAgewogICAgICAgICAgICB1aW50IHlfcG9zID0gc3RhcnRfc2VjdGlvbl95OwogICAgICAgICAgICB3aGlsZSAoeV9wb3MgPD0gZW5kX3NlY3Rpb25feSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgLy8gSXMgdGhpcyBhbiBJUE8gc2VjdGlvbj8KICAgICAgICAgICAgICAgIFNlY3Rpb24gcyA9IHNlY3Rpb25zW3hfcG9zICsgKHlfcG9zICogMTAwKV07CiAgICAgICAgICAgICAgICBpZiAocy5pbml0aWFsX3B1cmNoYXNlX2RvbmUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2FsZSwgd2UgbmVlZCB0byB0cmFuc2ZlciBiYWxhbmNlCiAgICAgICAgICAgICAgICAgICAgLy8gV2Ugb25seSBuZWVkIHRvIG1vZGlmeSBiYWxhbmNlcyBpZiB0aGUgc2VjdGlvbidzIHByaWNlCiAgICAgICAgICAgICAgICAgICAgLy8gaXMgbm9uLXplcm8KICAgICAgICAgICAgICAgICAgICBpZihzLnByaWNlICE9IDApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBQYXkgdGhlIGNvbnRyYWN0IG93bmVyIHRoZSBwcmljZQogICAgICAgICAgICAgICAgICAgICAgICBldGhCYWxhbmNlW293bmVyXSArPSAocy5wcmljZSAvIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBheSB0aGUgb3duZXIgdGhlIHByaWNlIG1pbnVzIHRoZSBmZWUKICAgICAgICAgICAgICAgICAgICAgICAgZXRoQmFsYW5jZVtzLm93bmVyXSArPSAocy5wcmljZSAtIChzLnByaWNlIC8gMTAwKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFJlZnVuZCBhbnkgb3ZlcnBheW1lbnQKICAgICAgICAgICAgICAgICAgICAvL2lmKG1zZy52YWx1ZSA+IChtc2cudmFsdWUgLSBzLnByaWNlKSkgdGhyb3c7CiAgICAgICAgICAgICAgICAgICAgZXh0X3ByaWNlICs9IHMucHJpY2U7CiAgICAgICAgICAgICAgICAgICAgLy8gT3duZXIgbG9zZXMgYSB0b2tlbgogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VPZltzLm93bmVyXS0tOwogICAgICAgICAgICAgICAgICAgIC8vIEJ1eWVyIGdldHMgYSB0b2tlbgogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSsrOwogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gSVBPIHdlIGdldCB0byBrZWVwIHRoZSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIC8vIFBheSB0aGUgY29udHJhY3Qgb3duZXIKICAgICAgICAgICAgICAgICAgICBldGhCYWxhbmNlW293bmVyXSArPSBpcG9fcHJpY2U7CiAgICAgICAgICAgICAgICAgICAgLy8gUmVmdW5kIGFueSBvdmVycGF5bWVudAogICAgICAgICAgICAgICAgICAgIC8vaWYobXNnLnZhbHVlID4gKG1zZy52YWx1ZSAtIGlwb19wcmljZSkpIHRocm93OwogICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gRGVjcmVhc2UgdGhlIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgaWNvX2Ftb3VudCArPSBpcG9fcHJpY2U7CiAgICAgICAgICAgICAgICAgICAgLy8gUmVkdWNlIHRva2VuIHBvb2wKICAgICAgICAgICAgICAgICAgICBwb29sLS07CiAgICAgICAgICAgICAgICAgICAgLy8gQnV5ZXIgZ2V0cyBhIHRva2VuCiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZU9mW21zZy5zZW5kZXJdKys7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gUGF5bWVudCBhbmQgdG9rZW4gdHJhbnNmZXIgY29tcGxldGUKICAgICAgICAgICAgICAgIC8vIFRyYW5zZmVyIG93bmVyc2hpcCBhbmQgc2V0IG5vdCBmb3Igc2FsZSBieSBkZWZhdWx0CiAgICAgICAgICAgICAgICBzLm93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICAgICAgICAgIHMubWQ1ID0gX21kNTsKICAgICAgICAgICAgICAgIHMuaW1hZ2VfaWQgPSBfaW1hZ2VfaWQ7CiAgICAgICAgICAgICAgICAvL3MubGFzdF91cGRhdGUgPSBibG9jay50aW1lc3RhbXA7CiAgICAgICAgICAgICAgICBzLmZvcl9zYWxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBzLmluaXRpYWxfcHVyY2hhc2VfZG9uZSA9IHRydWU7IC8vIGV2ZW4gaWYgbm90IHRoZSBmaXJzdCwgd2UgY2FuIHByZXRlbmQgaXQgaXMKCiAgICAgICAgICAgICAgICBCdXkoeF9wb3MgKyAoeV9wb3MgKiAxMDApKTsKICAgICAgICAgICAgICAgIC8vIERvbmUKICAgICAgICAgICAgICAgIHlfcG9zID0geV9wb3MgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHhfcG9zID0geF9wb3MgKyAxOwogICAgICAgIH0KICAgICAgICBldGhCYWxhbmNlW21zZy5zZW5kZXJdICs9IG1zZy52YWx1ZSAtIChleHRfcHJpY2UgKyBpY29fYW1vdW50KTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLyogU2V0IHRoZSBmb3Igc2FsZSBmbGFnIGFuZCBhIHByaWNlIGZvciBhIHNlY3Rpb24gKi8KICAgIC8vLyBTZXQgYW4gaW5pZGl2aWR1YWwgc2VjdGlvbiBhcyBmb3Igc2FsZSBhdCB0aGUgcHJvdmlkZWQgcHJpY2UgaW4gd2VpLgogICAgLy8vIFRoZSBzZWN0aW9uIHdpbGwgYmUgYXZhaWxhYmxlIGZvciBwdXJjaGFzZSBieSBhbnkgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHNldFNlY3Rpb25Gb3JTYWxlKAogICAgICAgIHVpbnQgX3NlY3Rpb25faW5kZXgsCiAgICAgICAgdWludDI1NiBfcHJpY2UKICAgICkgewogICAgICAgIGlmIChfc2VjdGlvbl9pbmRleCA+PSBzZWN0aW9ucy5sZW5ndGgpIHRocm93OwogICAgICAgIFNlY3Rpb24gc2VjdGlvbiA9IHNlY3Rpb25zW19zZWN0aW9uX2luZGV4XTsKICAgICAgICBpZihzZWN0aW9uLm93bmVyICE9IG1zZy5zZW5kZXIpIHRocm93OwogICAgICAgIHNlY3Rpb24ucHJpY2UgPSBfcHJpY2U7CiAgICAgICAgc2VjdGlvbi5mb3Jfc2FsZSA9IHRydWU7CiAgICAgICAgc2VjdGlvbi5zZWxsX29ubHlfdG8gPSAweDA7CiAgICAgICAgTmV3TGlzdGluZyhfc2VjdGlvbl9pbmRleCwgX3ByaWNlKTsKICAgIH0KCiAgICAvKiBTZXQgdGhlIGZvciBzYWxlIGZsYWcgYW5kIHByaWNlIGZvciBhIHJlZ2lvbiAqLwogICAgLy8vIFNldCBhIHNlY3Rpb24gcmVnaW9uIGZvciBzYWxlIGF0IHRoZSBwcm92aWRlZCBwcmljZSBpbiB3ZWkuCiAgICAvLy8gVGhlIHNlY3Rpb25zIGluIHRoZSByZWdpb24gd2lsbCBiZSBhdmFpbGFibGUgZm9yIHB1cmNoYXNlIGJ5IGFueSBhZGRyZXNzLgogICAgZnVuY3Rpb24gc2V0UmVnaW9uRm9yU2FsZSgKICAgICAgICB1aW50IF9zdGFydF9zZWN0aW9uX2luZGV4LAogICAgICAgIHVpbnQgX2VuZF9zZWN0aW9uX2luZGV4LAogICAgICAgIHVpbnQgX3ByaWNlCiAgICApIHsKICAgICAgICBpZihfc3RhcnRfc2VjdGlvbl9pbmRleCA+IF9lbmRfc2VjdGlvbl9pbmRleCkgdGhyb3c7CiAgICAgICAgaWYoX2VuZF9zZWN0aW9uX2luZGV4ID4gOTk5OSkgdGhyb3c7CiAgICAgICAgdWludCB4X3BvcyA9IF9zdGFydF9zZWN0aW9uX2luZGV4ICUgMTAwOwogICAgICAgIHVpbnQgYmFzZV95X3BvcyA9IChfc3RhcnRfc2VjdGlvbl9pbmRleCAtIChfc3RhcnRfc2VjdGlvbl9pbmRleCAlIDEwMCkpIC8gMTAwOwogICAgICAgIHVpbnQgeF9tYXggPSBfZW5kX3NlY3Rpb25faW5kZXggJSAxMDA7CiAgICAgICAgdWludCB5X21heCA9IChfZW5kX3NlY3Rpb25faW5kZXggLSAoX2VuZF9zZWN0aW9uX2luZGV4ICUgMTAwKSkgLyAxMDA7CiAgICAgICAgd2hpbGUoeF9wb3MgPD0geF9tYXgpCiAgICAgICAgewogICAgICAgICAgICB1aW50IHlfcG9zID0gYmFzZV95X3BvczsKICAgICAgICAgICAgd2hpbGUoeV9wb3MgPD0geV9tYXgpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFNlY3Rpb24gc2VjdGlvbiA9IHNlY3Rpb25zW3hfcG9zICsgKHlfcG9zICogMTAwKV07CiAgICAgICAgICAgICAgICBpZihzZWN0aW9uLm93bmVyID09IG1zZy5zZW5kZXIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc2VjdGlvbi5wcmljZSA9IF9wcmljZTsKICAgICAgICAgICAgICAgICAgICBzZWN0aW9uLmZvcl9zYWxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzZWN0aW9uLnNlbGxfb25seV90byA9IDB4MDsKICAgICAgICAgICAgICAgICAgICBOZXdMaXN0aW5nKHhfcG9zICsgKHlfcG9zICogMTAwKSwgX3ByaWNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHlfcG9zKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeF9wb3MrKzsKICAgICAgICB9CiAgICB9CgogICAgLyogU2V0IHRoZSBmb3Igc2FsZSBmbGFnIGFuZCBwcmljZSBmb3IgYSByZWdpb24gKi8KICAgIC8vLyBTZXQgYSBzZWN0aW9uIHJlZ2lvbiBzdGFydGluZyBpbiB0aGUgdG9wIGxlZnQgYXQgdGhlIHN1cHBsaWVkIHN0YXJ0IHNlY3Rpb24KICAgIC8vLyBpbmRleCB0byBhbmQgaW5jbHVkaW5nIHRoZSBzdXBwbGllZCBib3R0b20gcmlnaHQgZW5kIHNlY3Rpb24gaW5kZXgKICAgIC8vLyBmb3Igc2FsZSBhdCB0aGUgcHJvdmlkZWQgcHJpY2UgaW4gd2VpLCB0byB0aGUgcHJvdmlkZWQgYWRkcmVzcy4KICAgIC8vLyBUaGUgc2VjdGlvbnMgaW4gdGhlIHJlZ2lvbiB3aWxsIGJlIGF2YWlsYWJsZSBmb3IgcHVyY2hhc2Ugb25seSBieSB0aGUKICAgIC8vLyBwcm92aWRlZCBhZGRyZXNzLgogICAgZnVuY3Rpb24gc2V0UmVnaW9uRm9yU2FsZVRvQWRkcmVzcygKICAgICAgICB1aW50IF9zdGFydF9zZWN0aW9uX2luZGV4LAogICAgICAgIHVpbnQgX2VuZF9zZWN0aW9uX2luZGV4LAogICAgICAgIHVpbnQgX3ByaWNlLAogICAgICAgIGFkZHJlc3MgX29ubHlfc2VsbF90bwogICAgKSB7CiAgICAgICAgaWYoX3N0YXJ0X3NlY3Rpb25faW5kZXggPiBfZW5kX3NlY3Rpb25faW5kZXgpIHRocm93OwogICAgICAgIGlmKF9lbmRfc2VjdGlvbl9pbmRleCA+IDk5OTkpIHRocm93OwogICAgICAgIHVpbnQgeF9wb3MgPSBfc3RhcnRfc2VjdGlvbl9pbmRleCAlIDEwMDsKICAgICAgICB1aW50IGJhc2VfeV9wb3MgPSAoX3N0YXJ0X3NlY3Rpb25faW5kZXggLSAoX3N0YXJ0X3NlY3Rpb25faW5kZXggJSAxMDApKSAvIDEwMDsKICAgICAgICB1aW50IHhfbWF4ID0gX2VuZF9zZWN0aW9uX2luZGV4ICUgMTAwOwogICAgICAgIHVpbnQgeV9tYXggPSAoX2VuZF9zZWN0aW9uX2luZGV4IC0gKF9lbmRfc2VjdGlvbl9pbmRleCAlIDEwMCkpIC8gMTAwOwogICAgICAgIHdoaWxlKHhfcG9zIDw9IHhfbWF4KQogICAgICAgIHsKICAgICAgICAgICAgdWludCB5X3BvcyA9IGJhc2VfeV9wb3M7CiAgICAgICAgICAgIHdoaWxlKHlfcG9zIDw9IHlfbWF4KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBTZWN0aW9uIHNlY3Rpb24gPSBzZWN0aW9uc1t4X3BvcyArICh5X3BvcyAqIDEwMCldOwogICAgICAgICAgICAgICAgaWYoc2VjdGlvbi5vd25lciA9PSBtc2cuc2VuZGVyKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHNlY3Rpb24ucHJpY2UgPSBfcHJpY2U7CiAgICAgICAgICAgICAgICAgICAgc2VjdGlvbi5mb3Jfc2FsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VjdGlvbi5zZWxsX29ubHlfdG8gPSBfb25seV9zZWxsX3RvOwogICAgICAgICAgICAgICAgICAgIE5ld0xpc3RpbmcoeF9wb3MgKyAoeV9wb3MgKiAxMDApLCBfcHJpY2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeV9wb3MrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICB4X3BvcysrOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgU2V0IGFuIGVudGlyZSByZWdpb24ncyBjbG91ZCBpbWFnZSBkYXRhCiAgICAqLwogICAgLy8vIFVwZGF0ZSBhIHJlZ2lvbiBvZiBzZWN0aW9ucycgY2xvdWQgaW1hZ2VfaWQgYW5kIG1kNSB0byBiZSByZWRyYXduIG9uIHRoZQogICAgLy8vIG1hcCBzdGFydGluZyBhdCB0aGUgdG9wIGxlZnQgc3RhcnQgc2VjdGlvbiBpbmRleCB0byBhbmQgaW5jbHVkaW5nIHRoZQogICAgLy8vIGJvdHRvbSByaWdodCBzZWN0aW9uIGluZGV4LiBGaXJlcyBhIE5ld0ltYWdlIGV2ZW50IHdpdGggdGhlIHRvcCBsZWZ0CiAgICAvLy8gc2VjdGlvbiBpbmRleC4gSWYgYW55IHNlY3Rpb25zIG5vdCBvd25lZCBieSB0aGUgc2VuZGVyIGFyZSBpbiB0aGUgcmVnaW9uCiAgICAvLy8gdGhleSBhcmUgaWdub3JlZC4KICAgIGZ1bmN0aW9uIHNldFJlZ2lvbkltYWdlRGF0YUNsb3VkKAogICAgICAgIHVpbnQgX3N0YXJ0X3NlY3Rpb25faW5kZXgsCiAgICAgICAgdWludCBfZW5kX3NlY3Rpb25faW5kZXgsCiAgICAgICAgdWludCBfaW1hZ2VfaWQsCiAgICAgICAgc3RyaW5nIF9tZDUKICAgICkgewogICAgICAgIGlmIChfZW5kX3NlY3Rpb25faW5kZXggPCBfc3RhcnRfc2VjdGlvbl9pbmRleCkgdGhyb3c7CiAgICAgICAgdmFyIChzdGFydF94LCBzdGFydF95KSA9IGdldElkZW50aWZpZXJGcm9tU2VjdGlvbkluZGV4KF9zdGFydF9zZWN0aW9uX2luZGV4KTsKICAgICAgICB2YXIgKGVuZF94LCBlbmRfeSkgPSBnZXRJZGVudGlmaWVyRnJvbVNlY3Rpb25JbmRleChfZW5kX3NlY3Rpb25faW5kZXgpOwogICAgICAgIGlmIChzdGFydF94ID49IG1hcFdpZHRoKSB0aHJvdzsKICAgICAgICBpZiAoc3RhcnRfeSA+PSBtYXBIZWlnaHQpIHRocm93OwogICAgICAgIGlmIChlbmRfeCA+PSBtYXBXaWR0aCkgdGhyb3c7CiAgICAgICAgaWYgKGVuZF95ID49IG1hcEhlaWdodCkgdGhyb3c7CiAgICAgICAgdWludCB5X3BvcyA9IHN0YXJ0X3k7CiAgICAgICAgd2hpbGUgKHlfcG9zIDw9IGVuZF95KQogICAgICAgIHsKICAgICAgICAgICAgdWludCB4X3BvcyA9IHN0YXJ0X3g7CiAgICAgICAgICAgIHdoaWxlICh4X3BvcyA8PSBlbmRfeCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdWludCBpZGVudGlmaWVyID0gKHhfcG9zICsgKHlfcG9zICogMTAwKSk7CiAgICAgICAgICAgICAgICBTZWN0aW9uIHMgPSBzZWN0aW9uc1tpZGVudGlmaWVyXTsKICAgICAgICAgICAgICAgIGlmKHMub3duZXIgPT0gbXNnLnNlbmRlcikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzLmltYWdlX2lkID0gX2ltYWdlX2lkOwogICAgICAgICAgICAgICAgICAgIHMubWQ1ID0gX21kNTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHhfcG9zID0geF9wb3MgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHlfcG9zID0geV9wb3MgKyAxOwogICAgICAgIH0KICAgICAgICBOZXdJbWFnZShfc3RhcnRfc2VjdGlvbl9pbmRleCk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8qIFNldCB0aGUgZm9yIHNhbGUgZmxhZyBhbmQgYSBwcmljZSBmb3IgYSBzZWN0aW9uIHRvIGEgc3BlY2lmaWMgYWRkcmVzcyAqLwogICAgLy8vIFNldCBhIHNpbmdsZSBzZWN0aW9uIGFzIGZvciBzYWxlIGF0IHRoZSBwcm92aWRlZCBwcmljZSBpbiB3ZWkgb25seQogICAgLy8vIHRvIHRoZSBzdXBwbGllZCBhZGRyZXNzLgogICAgZnVuY3Rpb24gc2V0U2VjdGlvbkZvclNhbGVUb0FkZHJlc3MoCiAgICAgICAgdWludCBfc2VjdGlvbl9pbmRleCwKICAgICAgICB1aW50MjU2IF9wcmljZSwKICAgICAgICBhZGRyZXNzIF90bwogICAgKSB7CiAgICAgICAgaWYgKF9zZWN0aW9uX2luZGV4ID49IHNlY3Rpb25zLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgU2VjdGlvbiBzZWN0aW9uID0gc2VjdGlvbnNbX3NlY3Rpb25faW5kZXhdOwogICAgICAgIGlmKHNlY3Rpb24ub3duZXIgIT0gbXNnLnNlbmRlcikgdGhyb3c7CiAgICAgICAgc2VjdGlvbi5wcmljZSA9IF9wcmljZTsKICAgICAgICBzZWN0aW9uLmZvcl9zYWxlID0gdHJ1ZTsKICAgICAgICBzZWN0aW9uLnNlbGxfb25seV90byA9IF90bzsKICAgICAgICBOZXdMaXN0aW5nKF9zZWN0aW9uX2luZGV4LCBfcHJpY2UpOwogICAgfQoKICAgIC8qIFJlbW92ZSB0aGUgZm9yIHNhbGUgZmxhZyBmcm9tIGEgc2VjdGlvbiAqLwogICAgLy8vIERlbGlzdCBhIHNlY3Rpb24gZm9yIHNhbGUuIE1ha2luZyBpdCBubyBsb25nZXIgYXZhaWxhYmxlIG9uIHRoZSBtYXJrZXQuCiAgICBmdW5jdGlvbiB1bnNldFNlY3Rpb25Gb3JTYWxlKAogICAgICAgIHVpbnQgX3NlY3Rpb25faW5kZXgKICAgICkgewogICAgICAgIGlmIChfc2VjdGlvbl9pbmRleCA+PSBzZWN0aW9ucy5sZW5ndGgpIHRocm93OwogICAgICAgIFNlY3Rpb24gc2VjdGlvbiA9IHNlY3Rpb25zW19zZWN0aW9uX2luZGV4XTsKICAgICAgICBpZihzZWN0aW9uLm93bmVyICE9IG1zZy5zZW5kZXIpIHRocm93OwogICAgICAgIHNlY3Rpb24uZm9yX3NhbGUgPSBmYWxzZTsKICAgICAgICBzZWN0aW9uLnByaWNlID0gMDsKICAgICAgICBzZWN0aW9uLnNlbGxfb25seV90byA9IDB4MDsKICAgICAgICBEZWxpc3RlZChfc2VjdGlvbl9pbmRleCk7CiAgICB9CgogICAgLyogU2V0IHRoZSBmb3Igc2FsZSBmbGFnIGFuZCBwcmljZSBmb3IgYSByZWdpb24gKi8KICAgIC8vLyBEZWxpc3QgYSByZWdpb24gb2Ygc2VjdGlvbnMgZm9yIHNhbGUuIE1ha2luZyB0aGUgc2VjdGlvbnMgbm8gbG9uZ2VyCiAgICAvLy8gbm8gbG9uZ2VyIGF2YWlsYWJsZSBvbiB0aGUgbWFya2V0LgogICAgZnVuY3Rpb24gdW5zZXRSZWdpb25Gb3JTYWxlKAogICAgICAgIHVpbnQgX3N0YXJ0X3NlY3Rpb25faW5kZXgsCiAgICAgICAgdWludCBfZW5kX3NlY3Rpb25faW5kZXgKICAgICkgewogICAgICAgIGlmKF9zdGFydF9zZWN0aW9uX2luZGV4ID4gX2VuZF9zZWN0aW9uX2luZGV4KSB0aHJvdzsKICAgICAgICBpZihfZW5kX3NlY3Rpb25faW5kZXggPiA5OTk5KSB0aHJvdzsKICAgICAgICB1aW50IHhfcG9zID0gX3N0YXJ0X3NlY3Rpb25faW5kZXggJSAxMDA7CiAgICAgICAgdWludCBiYXNlX3lfcG9zID0gKF9zdGFydF9zZWN0aW9uX2luZGV4IC0gKF9zdGFydF9zZWN0aW9uX2luZGV4ICUgMTAwKSkgLyAxMDA7CiAgICAgICAgdWludCB4X21heCA9IF9lbmRfc2VjdGlvbl9pbmRleCAlIDEwMDsKICAgICAgICB1aW50IHlfbWF4ID0gKF9lbmRfc2VjdGlvbl9pbmRleCAtIChfZW5kX3NlY3Rpb25faW5kZXggJSAxMDApKSAvIDEwMDsKICAgICAgICB3aGlsZSh4X3BvcyA8PSB4X21heCkKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgeV9wb3MgPSBiYXNlX3lfcG9zOwogICAgICAgICAgICB3aGlsZSh5X3BvcyA8PSB5X21heCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgU2VjdGlvbiBzZWN0aW9uID0gc2VjdGlvbnNbeF9wb3MgKyAoeV9wb3MgKiAxMDApXTsKICAgICAgICAgICAgICAgIGlmKHNlY3Rpb24ub3duZXIgPT0gbXNnLnNlbmRlcikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBzZWN0aW9uLmZvcl9zYWxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgc2VjdGlvbi5wcmljZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgRGVsaXN0ZWQoeF9wb3MgKyAoeV9wb3MgKiAxMDApKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHlfcG9zKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeF9wb3MrKzsKICAgICAgICB9CiAgICB9CgogICAgLy8vIERlcHJlY2lhdGVkLiBTdG9yZSB0aGUgcmF3IGltYWdlIGRhdGEgaW4gdGhlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gc2V0SW1hZ2VEYXRhKAogICAgICAgIHVpbnQgX3NlY3Rpb25faW5kZXgKICAgICAgICAvLyBieXRlczMyIF9yb3dfemVybywKICAgICAgICAvLyBieXRlczMyIF9yb3dfb25lLAogICAgICAgIC8vIGJ5dGVzMzIgX3Jvd190d28sCiAgICAgICAgLy8gYnl0ZXMzMiBfcm93X3RocmVlLAogICAgICAgIC8vIGJ5dGVzMzIgX3Jvd19mb3VyLAogICAgICAgIC8vIGJ5dGVzMzIgX3Jvd19maXZlLAogICAgICAgIC8vIGJ5dGVzMzIgX3Jvd19zaXgsCiAgICAgICAgLy8gYnl0ZXMzMiBfcm93X3NldmVuLAogICAgICAgIC8vIGJ5dGVzMzIgX3Jvd19laWdodCwKICAgICAgICAvLyBieXRlczMyIF9yb3dfbmluZQogICAgKSB7CiAgICAgICAgaWYgKF9zZWN0aW9uX2luZGV4ID49IHNlY3Rpb25zLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgU2VjdGlvbiBzZWN0aW9uID0gc2VjdGlvbnNbX3NlY3Rpb25faW5kZXhdOwogICAgICAgIGlmKHNlY3Rpb24ub3duZXIgIT0gbXNnLnNlbmRlcikgdGhyb3c7CiAgICAgICAgLy8gc2VjdGlvbi5pbWFnZV9kYXRhWzBdID0gX3Jvd196ZXJvOwogICAgICAgIC8vIHNlY3Rpb24uaW1hZ2VfZGF0YVsxXSA9IF9yb3dfb25lOwogICAgICAgIC8vIHNlY3Rpb24uaW1hZ2VfZGF0YVsyXSA9IF9yb3dfdHdvOwogICAgICAgIC8vIHNlY3Rpb24uaW1hZ2VfZGF0YVszXSA9IF9yb3dfdGhyZWU7CiAgICAgICAgLy8gc2VjdGlvbi5pbWFnZV9kYXRhWzRdID0gX3Jvd19mb3VyOwogICAgICAgIC8vIHNlY3Rpb24uaW1hZ2VfZGF0YVs1XSA9IF9yb3dfZml2ZTsKICAgICAgICAvLyBzZWN0aW9uLmltYWdlX2RhdGFbNl0gPSBfcm93X3NpeDsKICAgICAgICAvLyBzZWN0aW9uLmltYWdlX2RhdGFbN10gPSBfcm93X3NldmVuOwogICAgICAgIC8vIHNlY3Rpb24uaW1hZ2VfZGF0YVs4XSA9IF9yb3dfZWlnaHQ7CiAgICAgICAgLy8gc2VjdGlvbi5pbWFnZV9kYXRhWzldID0gX3Jvd19uaW5lOwogICAgICAgIHNlY3Rpb24uaW1hZ2VfaWQgPSAwOwogICAgICAgIHNlY3Rpb24ubWQ1ID0gIiI7CiAgICAgICAgc2VjdGlvbi5sYXN0X3VwZGF0ZSA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICBOZXdJbWFnZShfc2VjdGlvbl9pbmRleCk7CiAgICB9CgogICAgLy8vIFNldCBhIHNlY3Rpb24ncyBpbWFnZSBkYXRhIHRvIGJlIHJlZHJhd24gb24gdGhlIG1hcC4gRmlyZXMgYSBOZXdJbWFnZQogICAgLy8vIGV2ZW50LgogICAgZnVuY3Rpb24gc2V0SW1hZ2VEYXRhQ2xvdWQoCiAgICAgICAgdWludCBfc2VjdGlvbl9pbmRleCwKICAgICAgICB1aW50IF9pbWFnZV9pZCwKICAgICAgICBzdHJpbmcgX21kNQogICAgKSB7CiAgICAgICAgaWYgKF9zZWN0aW9uX2luZGV4ID49IHNlY3Rpb25zLmxlbmd0aCkgdGhyb3c7CiAgICAgICAgU2VjdGlvbiBzZWN0aW9uID0gc2VjdGlvbnNbX3NlY3Rpb25faW5kZXhdOwogICAgICAgIGlmKHNlY3Rpb24ub3duZXIgIT0gbXNnLnNlbmRlcikgdGhyb3c7CiAgICAgICAgc2VjdGlvbi5pbWFnZV9pZCA9IF9pbWFnZV9pZDsKICAgICAgICBzZWN0aW9uLm1kNSA9IF9tZDU7CiAgICAgICAgc2VjdGlvbi5sYXN0X3VwZGF0ZSA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICBOZXdJbWFnZShfc2VjdGlvbl9pbmRleCk7CiAgICB9CgogICAgLy8vIFdpdGhkcmF3IGV0aGVyZXVtIGZyb20gdGhlIHNlbmRlcidzIGV0aEJhbGFuY2UuCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB2YXIgYW1vdW50ID0gZXRoQmFsYW5jZVttc2cuc2VuZGVyXTsKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICAvLyBJdCBpcyBpbXBvcnRhbnQgdG8gc2V0IHRoaXMgdG8gemVybyBiZWNhdXNlIHRoZSByZWNpcGllbnQKICAgICAgICAgICAgLy8gY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiBhZ2FpbiBhcyBwYXJ0IG9mIHRoZSByZWNlaXZpbmcgY2FsbAogICAgICAgICAgICAvLyBiZWZvcmUgYHNlbmRgIHJldHVybnMuCiAgICAgICAgICAgIGV0aEJhbGFuY2VbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgICAgICBXaXRoZHJhd0V2ZW50KCJSZXNldCBTZW5kZXIiKTsKICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihhbW91bnQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gRGVwb3NpdCBldGhlcmV1bSBpbnRvIHRoZSBzZW5kZXIncyBldGhCYWxhbmNlLiBOb3QgcmVjb21tZW5kZWQuCiAgICBmdW5jdGlvbiBkZXBvc2l0KCkgcGF5YWJsZQogICAgewogICAgICAgIGV0aEJhbGFuY2VbbXNnLnNlbmRlcl0gKz0gbXNnLnZhbHVlOwogICAgfQoKICAgIC8vLyBUcmFuc2ZlciBhIHNlY3Rpb24gYW5kIGFuIElQTyB0b2tlbiB0byB0aGUgc3VwcGxpZWQgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKAogICAgICBhZGRyZXNzIF90bywKICAgICAgdWludCBfc2VjdGlvbl9pbmRleAogICAgKSB7CiAgICAgICAgaWYgKF9zZWN0aW9uX2luZGV4ID4gOTk5OSkgdGhyb3c7CiAgICAgICAgaWYgKHNlY3Rpb25zW19zZWN0aW9uX2luZGV4XS5vd25lciAhPSBtc2cuc2VuZGVyKSB0aHJvdzsKICAgICAgICBpZiAoYmFsYW5jZU9mW190b10gKyAxIDwgYmFsYW5jZU9mW190b10pIHRocm93OwogICAgICAgIHNlY3Rpb25zW19zZWN0aW9uX2luZGV4XS5vd25lciA9IF90bzsKICAgICAgICBzZWN0aW9uc1tfc2VjdGlvbl9pbmRleF0uZm9yX3NhbGUgPSBmYWxzZTsKICAgICAgICBiYWxhbmNlT2ZbbXNnLnNlbmRlcl0gLT0gMTsKICAgICAgICBiYWxhbmNlT2ZbX3RvXSArPSAxOwogICAgfQoKCgogICAgLy8vIFRyYW5zZmVyIGEgcmVnaW9uIG9mIHNlY3Rpb25zIGFuZCBJUE8gdG9rZW5zIHRvIHRoZSBzdXBwbGllZCBhZGRyZXNzLgogICAgZnVuY3Rpb24gdHJhbnNmZXJSZWdpb24oCiAgICAgICAgdWludCBfc3RhcnRfc2VjdGlvbl9pbmRleCwKICAgICAgICB1aW50IF9lbmRfc2VjdGlvbl9pbmRleCwKICAgICAgICBhZGRyZXNzIF90bwogICAgKSB7CiAgICAgICAgaWYoX3N0YXJ0X3NlY3Rpb25faW5kZXggPiBfZW5kX3NlY3Rpb25faW5kZXgpIHRocm93OwogICAgICAgIGlmKF9lbmRfc2VjdGlvbl9pbmRleCA+IDk5OTkpIHRocm93OwogICAgICAgIHVpbnQgeF9wb3MgPSBfc3RhcnRfc2VjdGlvbl9pbmRleCAlIDEwMDsKICAgICAgICB1aW50IGJhc2VfeV9wb3MgPSAoX3N0YXJ0X3NlY3Rpb25faW5kZXggLSAoX3N0YXJ0X3NlY3Rpb25faW5kZXggJSAxMDApKSAvIDEwMDsKICAgICAgICB1aW50IHhfbWF4ID0gX2VuZF9zZWN0aW9uX2luZGV4ICUgMTAwOwogICAgICAgIHVpbnQgeV9tYXggPSAoX2VuZF9zZWN0aW9uX2luZGV4IC0gKF9lbmRfc2VjdGlvbl9pbmRleCAlIDEwMCkpIC8gMTAwOwogICAgICAgIHdoaWxlKHhfcG9zIDw9IHhfbWF4KQogICAgICAgIHsKICAgICAgICAgICAgdWludCB5X3BvcyA9IGJhc2VfeV9wb3M7CiAgICAgICAgICAgIHdoaWxlKHlfcG9zIDw9IHlfbWF4KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBTZWN0aW9uIHNlY3Rpb24gPSBzZWN0aW9uc1t4X3BvcyArICh5X3BvcyAqIDEwMCldOwogICAgICAgICAgICAgICAgaWYoc2VjdGlvbi5vd25lciA9PSBtc2cuc2VuZGVyKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBpZiAoYmFsYW5jZU9mW190b10gKyAxIDwgYmFsYW5jZU9mW190b10pIHRocm93OwogICAgICAgICAgICAgICAgICBzZWN0aW9uLm93bmVyID0gX3RvOwogICAgICAgICAgICAgICAgICBzZWN0aW9uLmZvcl9zYWxlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJhbGFuY2VPZlttc2cuc2VuZGVyXSAtPSAxOwogICAgICAgICAgICAgICAgICBiYWxhbmNlT2ZbX3RvXSArPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeV9wb3MrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICB4X3BvcysrOwogICAgICAgIH0KICAgIH0KfQ=='.
	

]
