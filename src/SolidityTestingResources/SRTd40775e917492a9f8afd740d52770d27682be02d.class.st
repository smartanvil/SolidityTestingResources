Class {
	#name : #SRTd40775e917492a9f8afd740d52770d27682be02d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd40775e917492a9f8afd740d52770d27682be02d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyBXb2xmIENyeXB0byBwb29saW5nIGNvbnRyYWN0IGZvciBFbGVjdHJpZnkuQXNpYQovLyB3cml0dGVuIGJ5IEBpYW1kZWZpbml0ZWx5YWh1bWFuCgpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKCmNvbnRyYWN0IEVSQzIwIHsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkge30KICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcykge30KfQoKCmNvbnRyYWN0IFdoaXRlTGlzdCB7CiAgIGZ1bmN0aW9uIGNoZWNrTWVtYmVyTGV2ZWwgKGFkZHJlc3MgYWRkcikgdmlldyBwdWJsaWMgcmV0dXJucyAodWludCkge30KfQoKCmNvbnRyYWN0IFByZXNhbGVQb29sIHsKCiAgLy8gU2FmZU1hdGggaXMgYSBsaWJyYXJ5IHRvIGVuc3VyZSB0aGF0IG1hdGggb3BlcmF0aW9ucyBkbyBub3QgaGF2ZSBvdmVyZmxvdyBlcnJvcnMKICAvLyBodHRwczovL3plcHBlbGluLXNvbGlkaXR5LnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9zYWZlbWF0aC5odG1sCiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CiAgCiAgLy8gVGhlIGNvbnRyYWN0IGhhcyAzIHN0YWdlczoKICAvLyAxIC0gVGhlIGluaXRpYWwgc3RhdGUuIFRoZSBvd25lciBpcyBhYmxlIHRvIGFkZCBhZGRyZXNzZXMgdG8gdGhlIHdoaXRlbGlzdCwgYW5kIGFueSB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMgY2FuIGRlcG9zaXQgb3Igd2l0aGRyYXcgZXRoIHRvIHRoZSBjb250cmFjdC4KICAvLyAyIC0gVGhlIG93bmVyIGhhcyBjbG9zZWQgdGhlIGNvbnRyYWN0IGZvciBmdXJ0aGVyIGRlcG9zaXRzLiBXaGl0ZWxpc3RlZCBhZGRyZXNzZXMgY2FuIHN0aWxsIHdpdGhkcmF3IGV0aCBmcm9tIHRoZSBjb250cmFjdC4KICAvLyAzIC0gVGhlIGV0aCBpcyBzZW50IGZyb20gdGhlIGNvbnRyYWN0IHRvIHRoZSByZWNlaXZlci4gVW51c2VkIGV0aCBjYW4gYmUgY2xhaW1lZCBieSBjb250cmlidXRvcnMgaW1tZWRpYXRlbHkuIE9uY2UgdG9rZW5zIGFyZSBzZW50IHRvIHRoZSBjb250cmFjdCwKICAvLyAgICAgdGhlIG93bmVyIGVuYWJsZXMgd2l0aGRyYXdhbHMgYW5kIGNvbnRyaWJ1dG9ycyBjYW4gd2l0aGRyYXcgdGhlaXIgdG9rZW5zLgogIHVpbnQ4IHB1YmxpYyBjb250cmFjdFN0YWdlID0gMTsKICAKICAvLyBUaGVzZSB2YXJpYWJsZXMgYXJlIHNldCBhdCB0aGUgdGltZSBvZiBjb250cmFjdCBjcmVhdGlvbgogIC8vIGFkZHJlc3MgdGhhdCBjcmVhdGVzIHRoZSBjb250cmFjdAogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIC8vIG1heGltdW0gZXRoIGFtb3VudCAoaW4gd2VpKSB0aGF0IGNhbiBiZSBzZW50IGJ5IGEgd2hpdGVsaXN0ZWQgYWRkcmVzcwogIHVpbnRbXSBwdWJsaWMgY29udHJpYnV0aW9uQ2FwczsKICAvLyB0aGUgJSBvZiB0b2tlbnMga2VwdCBieSB0aGUgY29udHJhY3Qgb3duZXIKICB1aW50IHB1YmxpYyBmZWVQY3Q7CiAgLy8gdGhlIGFkZHJlc3MgdGhhdCB0aGUgcG9vbCB3aWxsIGJlIHBhaWQgb3V0IHRvCiAgYWRkcmVzcyBwdWJsaWMgcmVjZWl2ZXJBZGRyZXNzOwogIAogIC8vIFRoZXNlIGNvbnN0YW50IHZhcmlhYmxlcyBkbyBub3QgY2hhbmdlIHdpdGggZWFjaCBjb250cmFjdCBkZXBsb3ltZW50CiAgLy8gbWluaW11bSBldGggYW1vdW50IChpbiB3ZWkpIHRoYXQgY2FuIGJlIHNlbnQgYnkgYSB3aGl0ZWxpc3RlZCBhZGRyZXNzCiAgdWludCBjb25zdGFudCBwdWJsaWMgY29udHJpYnV0aW9uTWluID0gMTAwMDAwMDAwMDAwMDAwMDAwOwogIC8vIG1heGltdW0gZ2FzIHByaWNlIGFsbG93ZWQgZm9yIGRlcG9zaXRzIGluIHN0YWdlIDEKICB1aW50IGNvbnN0YW50IHB1YmxpYyBtYXhHYXNQcmljZSA9IDUwMDAwMDAwMDAwOwogIC8vIHdoaXRlbGlzdGluZyBjb250cmFjdAogIFdoaXRlTGlzdCBjb25zdGFudCBwdWJsaWMgd2hpdGVsaXN0Q29udHJhY3QgPSBXaGl0ZUxpc3QoMHg4RDk1QjAzOGNBODBBOTg2NDI1RkEyNDBDM0MxN0ZiMkI2ZTliYzYzKTsKICAKICAKICAvLyBUaGVzZSB2YXJpYWJsZXMgYXJlIGFsbCBpbml0aWFsbHkgc2V0IHRvIDAgYW5kIHdpbGwgYmUgc2V0IGF0IHNvbWUgcG9pbnQgZHVyaW5nIHRoZSBjb250cmFjdAogIC8vIGVwb2NoIHRpbWUgdGhhdCB0aGUgbmV4dCBjb250cmlidXRpb24gY2FwcyBiZWNvbWUgYWN0aXZlCiAgdWludCBwdWJsaWMgbmV4dENhcFRpbWU7CiAgLy8gcGVuZGluZyBjb250cmlidXRpb24gY2FwcwogIHVpbnQgW10gcHVibGljIG5leHRDb250cmlidXRpb25DYXBzOwogIC8vIGJsb2NrIG51bWJlciBvZiB0aGUgbGFzdCBjaGFuZ2UgdG8gdGhlIHJlY2VpdmluZyBhZGRyZXNzIChzZXQgaWYgcmVjZWl2aW5nIGFkZHJlc3MgaXMgY2hhbmdlZCwgc3RhZ2UgMSBvciAyKQogIHVpbnQgcHVibGljIGFkZHJlc3NDaGFuZ2VCbG9jazsKICAvLyBhbW91bnQgb2YgZXRoIChpbiB3ZWkpIHByZXNlbnQgaW4gdGhlIGNvbnRyYWN0IHdoZW4gaXQgd2FzIHN1Ym1pdHRlZAogIHVpbnQgcHVibGljIGZpbmFsQmFsYW5jZTsKICAvLyBhcnJheSBjb250YWluaW5nIGV0aCBhbW91bnRzIHRvIGJlIHJlZnVuZGVkIGluIHN0YWdlIDMKICB1aW50W10gcHVibGljIGV0aFJlZnVuZEFtb3VudDsKICAvLyBkZWZhdWx0IHRva2VuIGNvbnRyYWN0IHRvIGJlIHVzZWQgZm9yIHdpdGhkcmF3aW5nIHRva2VucyBpbiBzdGFnZSAzCiAgYWRkcmVzcyBwdWJsaWMgYWN0aXZlVG9rZW47CiAgCiAgLy8gZGF0YSBzdHJ1Y3R1cmUgZm9yIGhvbGRpbmcgdGhlIGNvbnRyaWJ1dGlvbiBhbW91bnQsIGNhcCwgZXRoIHJlZnVuZCBzdGF0dXMsIGFuZCB0b2tlbiB3aXRoZHJhd2FsIHN0YXR1cyBmb3IgZWFjaCB3aGl0ZWxpc3RlZCBhZGRyZXNzCiAgc3RydWN0IENvbnRyaWJ1dG9yIHsKICAgIGJvb2wgYXV0aG9yaXplZDsKICAgIHVpbnQgZXRoUmVmdW5kOwogICAgdWludCBiYWxhbmNlOwogICAgdWludCBjYXA7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHRva2Vuc0NsYWltZWQ7CiAgfQogIC8vIG1hcHBpbmcgdGhhdCBob2xkcyB0aGUgY29udHJpYnV0b3Igc3RydWN0IGZvciBlYWNoIHdoaXRlbGlzdGVkIGFkZHJlc3MKICBtYXBwaW5nIChhZGRyZXNzID0+IENvbnRyaWJ1dG9yKSB3aGl0ZWxpc3Q7CiAgCiAgLy8gZGF0YSBzdHJ1Y3R1cmUgZm9yIGhvbGRpbmcgaW5mb3JtYXRpb24gcmVsYXRlZCB0byB0b2tlbiB3aXRoZHJhd2Fscy4KICBzdHJ1Y3QgVG9rZW5BbGxvY2F0aW9uIHsKICAgIEVSQzIwIHRva2VuOwogICAgdWludFtdIHBjdDsKICAgIHVpbnQgYmFsYW5jZVJlbWFpbmluZzsKICB9CiAgLy8gbWFwcGluZyB0aGF0IGhvbGRzIHRoZSB0b2tlbiBhbGxvY2F0aW9uIHN0cnVjdCBmb3IgZWFjaCB0b2tlbiBhZGRyZXNzCiAgbWFwcGluZyAoYWRkcmVzcyA9PiBUb2tlbkFsbG9jYXRpb24pIGRpc3RyaWJ1dGlvbk1hcDsKICAKICAKICAvLyBtb2RpZmllciBmb3IgZnVuY3Rpb25zIHRoYXQgY2FuIG9ubHkgYmUgYWNjZXNzZWQgYnkgdGhlIGNvbnRyYWN0IGNyZWF0b3IKICBtb2RpZmllciBvbmx5T3duZXIgKCkgewogICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KICAKICAvLyBtb2RpZmllciB0byBwcmV2ZW50IHJlLWVudHJhbmN5IGV4cGxvaXRzIGR1cmluZyBjb250cmFjdCA+IGNvbnRyYWN0IGludGVyYWN0aW9uCiAgYm9vbCBsb2NrZWQ7CiAgbW9kaWZpZXIgbm9SZWVudHJhbmN5KCkgewogICAgcmVxdWlyZSghbG9ja2VkKTsKICAgIGxvY2tlZCA9IHRydWU7CiAgICBfOwogICAgbG9ja2VkID0gZmFsc2U7CiAgfQogIAogIC8vIEV2ZW50cyB0cmlnZ2VyZWQgdGhyb3VnaG91dCBjb250cmFjdCBleGVjdXRpb24KICAvLyBUaGVzZSBjYW4gYmUgd2F0Y2hlZCB2aWEgZ2V0aCBmaWx0ZXJzIHRvIGtlZXAgdXAtdG8tZGF0ZSB3aXRoIHRoZSBjb250cmFjdAogIGV2ZW50IENvbnRyaWJ1dG9yQmFsYW5jZUNoYW5nZWQgKGFkZHJlc3MgY29udHJpYnV0b3IsIHVpbnQgdG90YWxCYWxhbmNlKTsKICBldmVudCBSZWNlaXZlckFkZHJlc3NTZXQgKCBhZGRyZXNzIF9hZGRyKTsKICBldmVudCBQb29sU3VibWl0dGVkIChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgV2l0aGRyYXdhbHNPcGVuIChhZGRyZXNzIHRva2VuQWRkcik7CiAgZXZlbnQgVG9rZW5zV2l0aGRyYXduIChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgRXRoUmVmdW5kUmVjZWl2ZWQgKGFkZHJlc3Mgc2VuZGVyLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgRXRoUmVmdW5kZWQgKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KTsKICBldmVudCBFUkMyMjNSZWNlaXZlZCAoYWRkcmVzcyB0b2tlbiwgdWludCB2YWx1ZSk7CiAgIAogIC8vIFRoZXNlIGFyZSBpbnRlcm5hbCBmdW5jdGlvbnMgdXNlZCBmb3IgY2FsY3VsYXRpbmcgZmVlcywgZXRoIGFuZCB0b2tlbiBhbGxvY2F0aW9ucyBhcyAlCiAgLy8gcmV0dXJucyBhIHZhbHVlIGFzIGEgJSBhY2N1cmF0ZSB0byAyMCBkZWNpbWFsIHBvaW50cwogIGZ1bmN0aW9uIF90b1BjdCAodWludCBudW1lcmF0b3IsIHVpbnQgZGVub21pbmF0b3IgKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBudW1lcmF0b3IubXVsKDEwICoqIDIwKSAvIGRlbm9taW5hdG9yOwogIH0KICAKICAvLyByZXR1cm5zICUgb2YgYW55IG51bWJlciwgd2hlcmUgJSBnaXZlbiB3YXMgZ2VuZXJhdGVkIHdpdGggdG9QY3QKICBmdW5jdGlvbiBfYXBwbHlQY3QgKHVpbnQgbnVtZXJhdG9yLCB1aW50IHBjdCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gbnVtZXJhdG9yLm11bChwY3QpIC8gKDEwICoqIDIwKTsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYXQgdGhlIHRpbWUgb2YgY29udHJhY3QgY3JlYXRpb24sCiAgLy8gaXQgc2V0cyB0aGUgaW5pdGlhbCB2YXJpYWJsZXMgYW5kIHdoaXRlbGlzdHMgdGhlIGNvbnRyYWN0IG93bmVyLgogIGZ1bmN0aW9uIFByZXNhbGVQb29sKGFkZHJlc3MgcmVjZWl2ZXJBZGRyLCB1aW50W10gY2FwQW1vdW50cywgdWludCBmZWUpIHB1YmxpYyB7CiAgICByZXF1aXJlIChmZWUgPCAxMDApOwogICAgcmVxdWlyZSAoY2FwQW1vdW50cy5sZW5ndGg+MSAmJiBjYXBBbW91bnRzLmxlbmd0aDwyNTYpOwogICAgZm9yICh1aW50OCBpPTE7IGk8Y2FwQW1vdW50cy5sZW5ndGg7IGkrKykgewogICAgICByZXF1aXJlIChjYXBBbW91bnRzW2ldIDw9IGNhcEFtb3VudHNbMF0pOwogICAgfQogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgcmVjZWl2ZXJBZGRyZXNzID0gcmVjZWl2ZXJBZGRyOwogICAgY29udHJpYnV0aW9uQ2FwcyA9IGNhcEFtb3VudHM7CiAgICBmZWVQY3QgPSBfdG9QY3QoZmVlLDEwMCk7CiAgICB3aGl0ZWxpc3RbbXNnLnNlbmRlcl0uYXV0aG9yaXplZCA9IHRydWU7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyIGV0aCBpcyBzZW50IGludG8gdGhlIGNvbnRyYWN0LgogIC8vIFRoZSBzZW5kIHdpbGwgZmFpbCB1bmxlc3MgdGhlIGNvbnRyYWN0IGlzIGluIHN0YWdlIG9uZSBhbmQgdGhlIHNlbmRlciBoYXMgYmVlbiB3aGl0ZWxpc3RlZC4KICAvLyBUaGUgYW1vdW50IHNlbnQgaXMgYWRkZWQgdG8gdGhlIGJhbGFuY2UgaW4gdGhlIENvbnRyaWJ1dG9yIHN0cnVjdCBhc3NvY2lhdGVkIHdpdGggdGhlIHNlbmRpbmcgYWRkcmVzcy4KICBmdW5jdGlvbiAoKSBwYXlhYmxlIHB1YmxpYyB7CiAgICBpZiAoY29udHJhY3RTdGFnZSA9PSAxKSB7CiAgICAgIF9ldGhEZXBvc2l0KCk7CiAgICB9IGVsc2UgaWYgKGNvbnRyYWN0U3RhZ2UgPT0gMykgewogICAgICBfZXRoUmVmdW5kKCk7CiAgICB9IGVsc2UgcmV2ZXJ0KCk7CiAgfQogIAogIC8vIEludGVybmFsIGZ1bmN0aW9uIGZvciBoYW5kbGluZyBldGggZGVwb3NpdHMgZHVyaW5nIGNvbnRyYWN0IHN0YWdlIG9uZS4KICBmdW5jdGlvbiBfZXRoRGVwb3NpdCAoKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQgKGNvbnRyYWN0U3RhZ2UgPT0gMSk7CiAgICByZXF1aXJlICh0eC5nYXNwcmljZSA8PSBtYXhHYXNQcmljZSk7CiAgICByZXF1aXJlICh0aGlzLmJhbGFuY2UgPD0gY29udHJpYnV0aW9uQ2Fwc1swXSk7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFttc2cuc2VuZGVyXTsKICAgIHVpbnQgbmV3QmFsYW5jZSA9IGMuYmFsYW5jZS5hZGQobXNnLnZhbHVlKTsKICAgIHJlcXVpcmUgKG5ld0JhbGFuY2UgPj0gY29udHJpYnV0aW9uTWluKTsKICAgIHJlcXVpcmUgKG5ld0JhbGFuY2UgPD0gX2NoZWNrQ2FwKG1zZy5zZW5kZXIpKTsKICAgIGMuYmFsYW5jZSA9IG5ld0JhbGFuY2U7CiAgICBDb250cmlidXRvckJhbGFuY2VDaGFuZ2VkKG1zZy5zZW5kZXIsIG5ld0JhbGFuY2UpOwogIH0KICAKICAvLyBJbnRlcm5hbCBmdW5jdGlvbiBmb3IgaGFuZGxpbmcgZXRoIHJlZnVuZHMgZHVyaW5nIHN0YWdlIHRocmVlLgogIGZ1bmN0aW9uIF9ldGhSZWZ1bmQgKCkgaW50ZXJuYWwgewogICAgYXNzZXJ0IChjb250cmFjdFN0YWdlID09IDMpOwogICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvd25lciB8fCBtc2cuc2VuZGVyID09IHJlY2VpdmVyQWRkcmVzcyk7CiAgICByZXF1aXJlIChtc2cudmFsdWUgPj0gY29udHJpYnV0aW9uTWluKTsKICAgIGV0aFJlZnVuZEFtb3VudC5wdXNoKG1zZy52YWx1ZSk7CiAgICBFdGhSZWZ1bmRSZWNlaXZlZChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB0byB3aXRoZHJhdyBldGggb3IgdG9rZW5zIGZyb20gdGhlIGNvbnRyYWN0LgogIC8vIEl0IGNhbiBvbmx5IGJlIGNhbGxlZCBieSBhZGRyZXNzZXMgdGhhdCBhcmUgd2hpdGVsaXN0ZWQgYW5kIHNob3cgYSBiYWxhbmNlIGdyZWF0ZXIgdGhhbiAwLgogIC8vIElmIGNhbGxlZCBkdXJpbmcgc3RhZ2VzIG9uZSBvciB0d28sIHRoZSBmdWxsIGV0aCBiYWxhbmNlIGRlcG9zaXRlZCBpbnRvIHRoZSBjb250cmFjdCBpcyByZXR1cm5lZCBhbmQgdGhlIGNvbnRyaWJ1dG9yJ3MgYmFsYW5jZSByZXNldCB0byAwLgogIC8vIElmIGNhbGxlZCBkdXJpbmcgc3RhZ2UgdGhyZWUsIHRoZSBjb250cmlidXRvcidzIHVudXNlZCBldGggd2lsbCBiZSByZXR1cm5lZCwgYXMgd2VsbCBhcyBhbnkgYXZhaWxhYmxlIHRva2Vucy4KICAvLyBUaGUgdG9rZW4gYWRkcmVzcyBtYXkgYmUgcHJvdmlkZWQgb3B0aW9uYWxseSB0byB3aXRoZHJhdyB0b2tlbnMgdGhhdCBhcmUgbm90IGN1cnJlbnRseSB0aGUgZGVmYXVsdCB0b2tlbiAoYWlyZHJvcHMpLgogIGZ1bmN0aW9uIHdpdGhkcmF3IChhZGRyZXNzIHRva2VuQWRkcikgcHVibGljIHsKICAgIHZhciBjID0gd2hpdGVsaXN0W21zZy5zZW5kZXJdOwogICAgcmVxdWlyZSAoYy5iYWxhbmNlID4gMCk7CiAgICBpZiAoY29udHJhY3RTdGFnZSA8IDMpIHsKICAgICAgdWludCBhbW91bnRUb1RyYW5zZmVyID0gYy5iYWxhbmNlOwogICAgICBjLmJhbGFuY2UgPSAwOwogICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGFtb3VudFRvVHJhbnNmZXIpOwogICAgICBDb250cmlidXRvckJhbGFuY2VDaGFuZ2VkKG1zZy5zZW5kZXIsIDApOwogICAgfSBlbHNlIHsKICAgICAgX3dpdGhkcmF3KG1zZy5zZW5kZXIsdG9rZW5BZGRyKTsKICAgIH0gIAogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGFsbG93cyB0aGUgY29udHJhY3Qgb3duZXIgdG8gZm9yY2UgYSB3aXRoZHJhd2FsIHRvIGFueSBjb250cmlidXRvci4KICBmdW5jdGlvbiB3aXRoZHJhd0ZvciAoYWRkcmVzcyBjb250cmlidXRvciwgYWRkcmVzcyB0b2tlbkFkZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA9PSAzKTsKICAgIHJlcXVpcmUgKHdoaXRlbGlzdFtjb250cmlidXRvcl0uYmFsYW5jZSA+IDApOwogICAgX3dpdGhkcmF3KGNvbnRyaWJ1dG9yLHRva2VuQWRkcik7CiAgfQogIAogIC8vIFRoaXMgaW50ZXJuYWwgZnVuY3Rpb24gaGFuZGxlcyB3aXRoZHJhd2FscyBkdXJpbmcgc3RhZ2UgdGhyZWUuCiAgLy8gVGhlIGFzc29jaWF0ZWQgZXZlbnRzIHdpbGwgZmlyZSB0byBub3RpZnkgd2hlbiBhIHJlZnVuZCBvciB0b2tlbiBhbGxvY2F0aW9uIGlzIGNsYWltZWQuCiAgZnVuY3Rpb24gX3dpdGhkcmF3IChhZGRyZXNzIHJlY2VpdmVyLCBhZGRyZXNzIHRva2VuQWRkcikgaW50ZXJuYWwgewogICAgYXNzZXJ0IChjb250cmFjdFN0YWdlID09IDMpOwogICAgdmFyIGMgPSB3aGl0ZWxpc3RbcmVjZWl2ZXJdOwogICAgaWYgKHRva2VuQWRkciA9PSAweDAwKSB7CiAgICAgIHRva2VuQWRkciA9IGFjdGl2ZVRva2VuOwogICAgfQogICAgdmFyIGQgPSBkaXN0cmlidXRpb25NYXBbdG9rZW5BZGRyXTsKICAgIHJlcXVpcmUgKCAoZXRoUmVmdW5kQW1vdW50Lmxlbmd0aCA+IGMuZXRoUmVmdW5kKSB8fCBkLnBjdC5sZW5ndGggPiBjLnRva2Vuc0NsYWltZWRbdG9rZW5BZGRyXSApOwogICAgaWYgKGV0aFJlZnVuZEFtb3VudC5sZW5ndGggPiBjLmV0aFJlZnVuZCkgewogICAgICB1aW50IHBjdCA9IF90b1BjdChjLmJhbGFuY2UsZmluYWxCYWxhbmNlKTsKICAgICAgdWludCBldGhBbW91bnQgPSAwOwogICAgICBmb3IgKHVpbnQgaT1jLmV0aFJlZnVuZDsgaTxldGhSZWZ1bmRBbW91bnQubGVuZ3RoOyBpKyspIHsKICAgICAgICBldGhBbW91bnQgPSBldGhBbW91bnQuYWRkKF9hcHBseVBjdChldGhSZWZ1bmRBbW91bnRbaV0scGN0KSk7CiAgICAgIH0KICAgICAgYy5ldGhSZWZ1bmQgPSBldGhSZWZ1bmRBbW91bnQubGVuZ3RoOwogICAgICBpZiAoZXRoQW1vdW50ID4gMCkgewogICAgICAgIHJlY2VpdmVyLnRyYW5zZmVyKGV0aEFtb3VudCk7CiAgICAgICAgRXRoUmVmdW5kZWQocmVjZWl2ZXIsZXRoQW1vdW50KTsKICAgICAgfQogICAgfQogICAgaWYgKGQucGN0Lmxlbmd0aCA+IGMudG9rZW5zQ2xhaW1lZFt0b2tlbkFkZHJdKSB7CiAgICAgIHVpbnQgdG9rZW5BbW91bnQgPSAwOwogICAgICBmb3IgKGk9Yy50b2tlbnNDbGFpbWVkW3Rva2VuQWRkcl07IGk8ZC5wY3QubGVuZ3RoOyBpKyspIHsKICAgICAgICB0b2tlbkFtb3VudCA9IHRva2VuQW1vdW50LmFkZChfYXBwbHlQY3QoYy5iYWxhbmNlLGQucGN0W2ldKSk7CiAgICAgIH0KICAgICAgYy50b2tlbnNDbGFpbWVkW3Rva2VuQWRkcl0gPSBkLnBjdC5sZW5ndGg7CiAgICAgIGlmICh0b2tlbkFtb3VudCA+IDApIHsKICAgICAgICByZXF1aXJlKGQudG9rZW4udHJhbnNmZXIocmVjZWl2ZXIsdG9rZW5BbW91bnQpKTsKICAgICAgICBkLmJhbGFuY2VSZW1haW5pbmcgPSBkLmJhbGFuY2VSZW1haW5pbmcuc3ViKHRva2VuQW1vdW50KTsKICAgICAgICBUb2tlbnNXaXRoZHJhd24ocmVjZWl2ZXIsdG9rZW5BbW91bnQpOwogICAgICB9ICAKICAgIH0KICAgIAogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGV4ZWN1dGVkIGJ5IHRoZSBvd25lciwgaXQgYWRkcyBhbiBhZGRyZXNzIHRvIHRoZSB3aGl0ZWxpc3QuCiAgLy8gVG8gZXhlY3V0ZSwgdGhlIGNvbnRyYWN0IG11c3QgYmUgaW4gc3RhZ2UgMSwgdGhlIGFkZHJlc3MgY2Fubm90IGFscmVhZHkgYmUgd2hpdGVsaXN0ZWQsIGFuZCB0aGUgYWRkcmVzcyBjYW5ub3QgYmUgYSBjb250cmFjdCBpdHNlbGYuCiAgLy8gQmxvY2tpbmcgY29udHJhY3RzIGZyb20gYmVpbmcgd2hpdGVsaXN0ZWQgcHJldmVudHMgYXR0YWNrcyBmcm9tIHVuZXhwZWN0ZWQgY29udHJhY3QgdG8gY29udHJhY3QgaW50ZXJhY3Rpb24gLSB2ZXJ5IGltcG9ydGFudCEKICBmdW5jdGlvbiBhdXRob3JpemUgKGFkZHJlc3MgYWRkciwgdWludCBjYXApIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA9PSAxKTsKICAgIF9jaGVja1doaXRlbGlzdENvbnRyYWN0KGFkZHIpOwogICAgcmVxdWlyZSAoIXdoaXRlbGlzdFthZGRyXS5hdXRob3JpemVkKTsKICAgIHJlcXVpcmUgKChjYXAgPiAwICYmIGNhcCA8IGNvbnRyaWJ1dGlvbkNhcHMubGVuZ3RoKSB8fCAoY2FwID49IGNvbnRyaWJ1dGlvbk1pbiAmJiBjYXAgPD0gY29udHJpYnV0aW9uQ2Fwc1swXSkgKTsKICAgIHVpbnQgc2l6ZTsKICAgIGFzc2VtYmx5IHsgc2l6ZSA6PSBleHRjb2Rlc2l6ZShhZGRyKSB9CiAgICByZXF1aXJlIChzaXplID09IDApOwogICAgd2hpdGVsaXN0W2FkZHJdLmNhcCA9IGNhcDsKICAgIHdoaXRlbGlzdFthZGRyXS5hdXRob3JpemVkID0gdHJ1ZTsKICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBpcyB1c2VkIGJ5IHRoZSBvd25lciB0byBhdXRob3JpemUgbWFueSBhZGRyZXNzZXMgaW4gYSBzaW5nbGUgY2FsbC4KICAvLyBFYWNoIGFkZHJlc3Mgd2lsbCBiZSBnaXZlbiB0aGUgc2FtZSBjYXAsIGFuZCB0aGUgY2FwIG11c3QgYmUgb25lIG9mIHRoZSBzdGFuZGFyZCBsZXZlbHMuCiAgZnVuY3Rpb24gYXV0aG9yaXplTWFueSAoYWRkcmVzc1tdIGFkZHIsIHVpbnQgY2FwKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKGFkZHIubGVuZ3RoIDwgMjU1KTsKICAgIHJlcXVpcmUgKGNhcCA+IDAgJiYgY2FwIDwgY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpOwogICAgZm9yICh1aW50OCBpPTA7IGk8YWRkci5sZW5ndGg7IGkrKykgewogICAgICBhdXRob3JpemUoYWRkcltpXSwgY2FwKTsKICAgIH0KICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHJlbW92ZSBhbiBhZGRyZXNzIGZyb20gdGhlIHdoaXRlbGlzdC4KICAvLyBJdCBtYXkgb25seSBiZSBleGVjdXRlZCBkdXJpbmcgc3RhZ2VzIDEgYW5kIDIuICBBbnkgZXRoIHNlbnQgYnkgdGhlIGFkZHJlc3MgaXMgcmVmdW5kZWQgYW5kIHRoZWlyIHBlcnNvbmFsIGNhcCBpcyBzZXQgdG8gMC4KICAvLyBJdCB3aWxsIHRocm93IGlmIHRoZSBhZGRyZXNzIGlzIHN0aWxsIGF1dGhvcmlzZWQgaW4gdGhlIHdoaXRlbGlzdCBjb250cmFjdC4KICBmdW5jdGlvbiByZXZva2UgKGFkZHJlc3MgYWRkcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlIDwgMyk7CiAgICByZXF1aXJlICh3aGl0ZWxpc3RbYWRkcl0uYXV0aG9yaXplZCk7CiAgICByZXF1aXJlICh3aGl0ZWxpc3RDb250cmFjdC5jaGVja01lbWJlckxldmVsKGFkZHIpID09IDApOwogICAgd2hpdGVsaXN0W2FkZHJdLmF1dGhvcml6ZWQgPSBmYWxzZTsKICAgIGlmICh3aGl0ZWxpc3RbYWRkcl0uYmFsYW5jZSA+IDApIHsKICAgICAgdWludCBhbW91bnRUb1RyYW5zZmVyID0gd2hpdGVsaXN0W2FkZHJdLmJhbGFuY2U7CiAgICAgIHdoaXRlbGlzdFthZGRyXS5iYWxhbmNlID0gMDsKICAgICAgYWRkci50cmFuc2ZlcihhbW91bnRUb1RyYW5zZmVyKTsKICAgICAgQ29udHJpYnV0b3JCYWxhbmNlQ2hhbmdlZChhZGRyLCAwKTsKICAgIH0KICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIG1vZGlmeSB0aGUgY29udHJpYnV0aW9uIGNhcCBvZiBhIHdoaXRlbGlzdGVkIGFkZHJlc3MuCiAgLy8gSWYgdGhlIGN1cnJlbnQgY29udHJpYnV0aW9uIGJhbGFuY2UgZXhjZWVkcyB0aGUgbmV3IGNhcCwgdGhlIGV4Y2VzcyBiYWxhbmNlIGlzIHJlZnVuZGVkLgogIGZ1bmN0aW9uIG1vZGlmeUluZGl2aWR1YWxDYXAgKGFkZHJlc3MgYWRkciwgdWludCBjYXApIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA8IDMpOwogICAgcmVxdWlyZSAoY2FwIDwgY29udHJpYnV0aW9uQ2Fwcy5sZW5ndGggfHwgKGNhcCA+PSBjb250cmlidXRpb25NaW4gJiYgY2FwIDw9IGNvbnRyaWJ1dGlvbkNhcHNbMF0pICk7CiAgICBfY2hlY2tXaGl0ZWxpc3RDb250cmFjdChhZGRyKTsKICAgIHZhciBjID0gd2hpdGVsaXN0W2FkZHJdOwogICAgcmVxdWlyZSAoYy5hdXRob3JpemVkKTsKICAgIHVpbnQgYW1vdW50ID0gYy5iYWxhbmNlOwogICAgYy5jYXAgPSBjYXA7CiAgICB1aW50IGNhcEFtb3VudCA9IF9jaGVja0NhcChhZGRyKTsKICAgIGlmIChhbW91bnQgPiBjYXBBbW91bnQpIHsKICAgICAgYy5iYWxhbmNlID0gY2FwQW1vdW50OwogICAgICBhZGRyLnRyYW5zZmVyKGFtb3VudC5zdWIoY2FwQW1vdW50KSk7CiAgICAgIENvbnRyaWJ1dG9yQmFsYW5jZUNoYW5nZWQoYWRkciwgY2FwQW1vdW50KTsKICAgIH0KICB9CiAgCiAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIG1vZGlmeSB0aGUgY2FwIGZvciBhIGNvbnRyaWJ1dGlvbiBsZXZlbC4KICAvLyBUaGUgY2FwIGNhbm5vdCBiZSBkZWNyZWFzZWQgYmVsb3cgdGhlIGN1cnJlbnQgYmFsYW5jZSBvciBpbmNyZWFzZWQgcGFzdCB0aGUgY29udHJhY3QgbGltaXQuCiAgZnVuY3Rpb24gbW9kaWZ5TGV2ZWxDYXAgKHVpbnQgbGV2ZWwsIHVpbnQgY2FwKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPCAzKTsKICAgIHJlcXVpcmUgKGxldmVsID4gMCAmJiBsZXZlbCA8IGNvbnRyaWJ1dGlvbkNhcHMubGVuZ3RoKTsKICAgIHJlcXVpcmUgKHRoaXMuYmFsYW5jZSA8PSBjYXAgJiYgY29udHJpYnV0aW9uQ2Fwc1swXSA+PSBjYXApOwogICAgY29udHJpYnV0aW9uQ2Fwc1tsZXZlbF0gPSBjYXA7CiAgICBuZXh0Q2FwVGltZSA9IDA7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gY2hhbmdlcyBldmVyeSBsZXZlbCBjYXAgYXQgb25jZSwgd2l0aCBhbiBvcHRpb25hbCBkZWxheS4KICAvLyBNb2RpZnlpbmcgdGhlIGNhcHMgaW1tZWRpYXRlbHkgd2lsbCBjYW5jZWwgYW55IGRlbGF5ZWQgY2FwIGNoYW5nZS4KICBmdW5jdGlvbiBtb2RpZnlBbGxMZXZlbENhcHMgKHVpbnRbXSBjYXAsIHVpbnQgdGltZSkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlIChjb250cmFjdFN0YWdlIDwgMyk7CiAgICByZXF1aXJlIChjYXAubGVuZ3RoID09IGNvbnRyaWJ1dGlvbkNhcHMubGVuZ3RoLTEpOwogICAgcmVxdWlyZSAodGltZSA9PSAwIHx8IHRpbWU+YmxvY2sudGltZXN0YW1wKTsKICAgIGlmICh0aW1lID09IDApIHsKICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IGNhcC5sZW5ndGg7IGkrKykgewogICAgICAgIG1vZGlmeUxldmVsQ2FwKGkrMSwgY2FwW2ldKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbmV4dENvbnRyaWJ1dGlvbkNhcHMgPSBjb250cmlidXRpb25DYXBzOwogICAgICBuZXh0Q2FwVGltZSA9IHRpbWU7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjYXAubGVuZ3RoOyBpKyspIHsKICAgICAgICByZXF1aXJlIChjb250cmlidXRpb25DYXBzW2krMV0gPD0gY2FwW2ldICYmIGNvbnRyaWJ1dGlvbkNhcHNbMF0gPj0gY2FwW2ldKTsKICAgICAgICBuZXh0Q29udHJpYnV0aW9uQ2Fwc1tpKzFdID0gY2FwW2ldOwogICAgICB9CiAgICB9CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBkdXJpbmcgc3RhZ2VzIG9uZSBvciB0d28gdG8gbW9kaWZ5IHRoZSBtYXhpbXVtIGJhbGFuY2Ugb2YgdGhlIGNvbnRyYWN0LgogIC8vIEl0IGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIuIFRoZSBhbW91bnQgY2Fubm90IGJlIHNldCB0byBsb3dlciB0aGFuIHRoZSBjdXJyZW50IGJhbGFuY2Ugb2YgdGhlIGNvbnRyYWN0LgogIGZ1bmN0aW9uIG1vZGlmeU1heENvbnRyYWN0QmFsYW5jZSAodWludCBhbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA8IDMpOwogICAgcmVxdWlyZSAoYW1vdW50ID49IGNvbnRyaWJ1dGlvbk1pbik7CiAgICByZXF1aXJlIChhbW91bnQgPj0gdGhpcy5iYWxhbmNlKTsKICAgIGNvbnRyaWJ1dGlvbkNhcHNbMF0gPSBhbW91bnQ7CiAgICBuZXh0Q2FwVGltZSA9IDA7CiAgICBmb3IgKHVpbnQ4IGk9MTsgaTxjb250cmlidXRpb25DYXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChjb250cmlidXRpb25DYXBzW2ldPmFtb3VudCkgY29udHJpYnV0aW9uQ2Fwc1tpXT1hbW91bnQ7CiAgICB9CiAgfQogIAogIC8vIFRoaXMgaW50ZXJuYWwgZnVuY3Rpb24gcmV0dXJucyB0aGUgY2FwIGFtb3VudCBvZiBhIHdoaXRlbGlzdGVkIGFkZHJlc3MuCiAgZnVuY3Rpb24gX2NoZWNrQ2FwIChhZGRyZXNzIGFkZHIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIF9jaGVja1doaXRlbGlzdENvbnRyYWN0KGFkZHIpOwogICAgdmFyIGMgPSB3aGl0ZWxpc3RbYWRkcl07CiAgICBpZiAoIWMuYXV0aG9yaXplZCkgcmV0dXJuIDA7CiAgICBpZiAobmV4dENhcFRpbWU+MCAmJiBibG9jay50aW1lc3RhbXA+bmV4dENhcFRpbWUpIHsKICAgICAgY29udHJpYnV0aW9uQ2FwcyA9IG5leHRDb250cmlidXRpb25DYXBzOwogICAgICBuZXh0Q2FwVGltZSA9IDA7CiAgICB9CiAgICBpZiAoYy5jYXA8Y29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpIHJldHVybiBjb250cmlidXRpb25DYXBzW2MuY2FwXTsKICAgIHJldHVybiBjLmNhcDsgCiAgfQogIAogIC8vIFRoaXMgaW50ZXJuYWwgZnVuY3Rpb24gY2hlY2tzIGlmIGFuIGFkZHJlc3MgaXMgd2hpdGVsaXN0ZWQgaW4gdGhlIHdoaXRlbGlzdCBjb250cmFjdC4KICBmdW5jdGlvbiBfY2hlY2tXaGl0ZWxpc3RDb250cmFjdCAoYWRkcmVzcyBhZGRyKSBpbnRlcm5hbCB7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFthZGRyXTsKICAgIGlmICghYy5hdXRob3JpemVkKSB7CiAgICAgIHZhciBsZXZlbCA9IHdoaXRlbGlzdENvbnRyYWN0LmNoZWNrTWVtYmVyTGV2ZWwoYWRkcik7CiAgICAgIGlmIChsZXZlbCA9PSAwIHx8IGxldmVsID49IGNvbnRyaWJ1dGlvbkNhcHMubGVuZ3RoKSByZXR1cm47CiAgICAgIGMuY2FwID0gbGV2ZWw7CiAgICAgIGMuYXV0aG9yaXplZCA9IHRydWU7CiAgICB9CiAgfQogIAogIC8vIFRoaXMgY2FsbGFibGUgZnVuY3Rpb24gcmV0dXJucyB0aGUgdG90YWwgcG9vbCBjYXAsIGN1cnJlbnQgYmFsYW5jZSBhbmQgcmVtYWluaW5nIGJhbGFuY2UgdG8gYmUgZmlsbGVkLgogIGZ1bmN0aW9uIGNoZWNrUG9vbEJhbGFuY2UgKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludCBwb29sQ2FwLCB1aW50IGJhbGFuY2UsIHVpbnQgcmVtYWluaW5nKSB7CiAgICBpZiAoY29udHJhY3RTdGFnZSA9PSAxKSB7CiAgICAgIHJlbWFpbmluZyA9IGNvbnRyaWJ1dGlvbkNhcHNbMF0uc3ViKHRoaXMuYmFsYW5jZSk7CiAgICB9IGVsc2UgewogICAgICByZW1haW5pbmcgPSAwOwogICAgfQogICAgcmV0dXJuIChjb250cmlidXRpb25DYXBzWzBdLHRoaXMuYmFsYW5jZSxyZW1haW5pbmcpOwogIH0KICAKICAvLyBUaGlzIGNhbGxhYmxlIGZ1bmN0aW9uIHJldHVybnMgdGhlIGJhbGFuY2UsIGNvbnRyaWJ1dGlvbiBjYXAsIGFuZCByZW1haW5pbmcgYXZhaWxhYmxlIGJhbGFuY2Ugb2YgYW55IGNvbnRyaWJ1dG9yLgogIGZ1bmN0aW9uIGNoZWNrQ29udHJpYnV0b3JCYWxhbmNlIChhZGRyZXNzIGFkZHIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQgYmFsYW5jZSwgdWludCBjYXAsIHVpbnQgcmVtYWluaW5nKSB7CiAgICB2YXIgYyA9IHdoaXRlbGlzdFthZGRyXTsKICAgIGlmICghYy5hdXRob3JpemVkKSB7CiAgICAgIGNhcCA9IHdoaXRlbGlzdENvbnRyYWN0LmNoZWNrTWVtYmVyTGV2ZWwoYWRkcik7CiAgICAgIGlmIChjYXAgPT0gMCkgcmV0dXJuICgwLDAsMCk7CiAgICB9IGVsc2UgewogICAgICBjYXAgPSBjLmNhcDsKICAgIH0KICAgIGJhbGFuY2UgPSBjLmJhbGFuY2U7CiAgICBpZiAoY29udHJhY3RTdGFnZSA9PSAxKSB7CiAgICAgIGlmIChjYXA8Y29udHJpYnV0aW9uQ2Fwcy5sZW5ndGgpIHsgCiAgICAgICAgaWYgKG5leHRDYXBUaW1lID09IDAgfHwgbmV4dENhcFRpbWUgPiBibG9jay50aW1lc3RhbXApIHsKICAgICAgICAgIGNhcCA9IGNvbnRyaWJ1dGlvbkNhcHNbY2FwXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FwID0gbmV4dENvbnRyaWJ1dGlvbkNhcHNbY2FwXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmVtYWluaW5nID0gY2FwLnN1YihiYWxhbmNlKTsKICAgICAgaWYgKGNvbnRyaWJ1dGlvbkNhcHNbMF0uc3ViKHRoaXMuYmFsYW5jZSkgPCByZW1haW5pbmcpIHJlbWFpbmluZyA9IGNvbnRyaWJ1dGlvbkNhcHNbMF0uc3ViKHRoaXMuYmFsYW5jZSk7CiAgICB9IGVsc2UgewogICAgICByZW1haW5pbmcgPSAwOwogICAgfQogICAgcmV0dXJuIChiYWxhbmNlLCBjYXAsIHJlbWFpbmluZyk7CiAgfQogIAogIC8vIFRoaXMgY2FsbGFibGUgZnVuY3Rpb24gcmV0dXJucyB0aGUgdG9rZW4gYmFsYW5jZSB0aGF0IGEgY29udHJpYnV0b3IgY2FuIGN1cnJlbnRseSBjbGFpbS4KICBmdW5jdGlvbiBjaGVja0F2YWlsYWJsZVRva2VucyAoYWRkcmVzcyBhZGRyLCBhZGRyZXNzIHRva2VuQWRkcikgdmlldyBwdWJsaWMgcmV0dXJucyAodWludCB0b2tlbkFtb3VudCkgewogICAgdmFyIGMgPSB3aGl0ZWxpc3RbYWRkcl07CiAgICB2YXIgZCA9IGRpc3RyaWJ1dGlvbk1hcFt0b2tlbkFkZHJdOwogICAgZm9yICh1aW50IGkgPSBjLnRva2Vuc0NsYWltZWRbdG9rZW5BZGRyXTsgaSA8IGQucGN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHRva2VuQW1vdW50ID0gdG9rZW5BbW91bnQuYWRkKF9hcHBseVBjdChjLmJhbGFuY2UsIGQucGN0W2ldKSk7CiAgICB9CiAgICByZXR1cm4gdG9rZW5BbW91bnQ7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gY2xvc2VzIGZ1cnRoZXIgY29udHJpYnV0aW9ucyB0byB0aGUgY29udHJhY3QsIGFkdmFuY2luZyBpdCB0byBzdGFnZSB0d28uCiAgLy8gSXQgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lci4gIEFmdGVyIHRoaXMgY2FsbCBoYXMgYmVlbiBtYWRlLCB3aGl0ZWxpc3RlZCBhZGRyZXNzZXMKICAvLyBjYW4gc3RpbGwgcmVtb3ZlIHRoZWlyIGV0aCBmcm9tIHRoZSBjb250cmFjdCBidXQgY2Fubm90IGNvbnRyaWJ1dGUgYW55IG1vcmUuCiAgZnVuY3Rpb24gY2xvc2VDb250cmlidXRpb25zICgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA9PSAxKTsKICAgIGNvbnRyYWN0U3RhZ2UgPSAyOwogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIHJlb3BlbnMgdGhlIGNvbnRyYWN0IHRvIGNvbnRyaWJ1dGlvbnMgYW5kIGZ1cnRoZXIgd2hpdGVsaXN0aW5nLCByZXR1cm5pbmcgaXQgdG8gc3RhZ2Ugb25lLgogIC8vIEl0IGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIgZHVyaW5nIHN0YWdlIHR3by4KICBmdW5jdGlvbiByZW9wZW5Db250cmlidXRpb25zICgpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA9PSAyKTsKICAgIGNvbnRyYWN0U3RhZ2UgPSAxOwogIH0KICAKICAvLyBUaGlzIGZ1bmN0aW9uIHNldHMgdGhlIHJlY2VpdmluZyBhZGRyZXNzIHRoYXQgdGhlIGNvbnRyYWN0IHdpbGwgc2VuZCB0aGUgcG9vbGVkIGV0aCB0by4KICAvLyBJdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyIGlmIHRoZSByZWNlaXZlciBhZGRyZXNzIGhhcyBub3QgYWxyZWFkeSBiZWVuIHNldC4KICAvLyBBZnRlciBtYWtpbmcgdGhpcyBjYWxsLCB0aGUgY29udHJhY3Qgd2lsbCBiZSB1bmFibGUgdG8gc2VuZCB0aGUgcG9vbGVkIGV0aCBmb3IgNjAwMCBibG9ja3MuCiAgLy8gVGhpcyBsaW1pdGF0aW9uIGlzIHNvIHRoYXQgaWYgdGhlIG93bmVyIGFjdHMgbWFsaWNpb3VzbHkgaW4gbWFraW5nIHRoZSBjaGFuZ2UsIGFsbCB3aGl0ZWxpc3RlZAogIC8vIGFkZHJlc3NlcyBoYXZlIH4yNCBob3VycyB0byB3aXRoZHJhdyB0aGVpciBldGggZnJvbSB0aGUgY29udHJhY3QuCiAgZnVuY3Rpb24gc2V0UmVjZWl2ZXJBZGRyZXNzIChhZGRyZXNzIGFkZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSAoYWRkciAhPSAweDAwICYmIHJlY2VpdmVyQWRkcmVzcyA9PSAweDAwKTsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPCAzKTsKICAgIHJlY2VpdmVyQWRkcmVzcyA9IGFkZHI7CiAgICBhZGRyZXNzQ2hhbmdlQmxvY2sgPSBibG9jay5udW1iZXI7CiAgICBSZWNlaXZlckFkZHJlc3NTZXQoYWRkcik7CiAgfQoKICAvLyBUaGlzIGZ1bmN0aW9uIHNlbmRzIHRoZSBwb29sZWQgZXRoIHRvIHRoZSByZWNlaXZpbmcgYWRkcmVzcywgY2FsY3VsYXRlcyB0aGUgJSBvZiB1bnVzZWQgZXRoIHRvIGJlIHJldHVybmVkLAogIC8vIGFuZCBhZHZhbmNlcyB0aGUgY29udHJhY3QgdG8gc3RhZ2UgdGhyZWUuIEl0IGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIgZHVyaW5nIHN0YWdlcyBvbmUgb3IgdHdvLgogIC8vIFRoZSBhbW91bnQgdG8gc2VuZCAoZ2l2ZW4gaW4gd2VpKSBtdXN0IGJlIHNwZWNpZmllZCBkdXJpbmcgdGhlIGNhbGwuIEFzIHRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgZXhlY3V0ZWQgb25jZSwKICAvLyBpdCBpcyBWRVJZIElNUE9SVEFOVCBub3QgdG8gZ2V0IHRoZSBhbW91bnQgd3JvbmcuCiAgZnVuY3Rpb24gc3VibWl0UG9vbCAodWludCBhbW91bnRJbldlaSkgcHVibGljIG9ubHlPd25lciBub1JlZW50cmFuY3kgewogICAgcmVxdWlyZSAoY29udHJhY3RTdGFnZSA8IDMpOwogICAgcmVxdWlyZSAocmVjZWl2ZXJBZGRyZXNzICE9IDB4MDApOwogICAgcmVxdWlyZSAoYmxvY2subnVtYmVyID49IGFkZHJlc3NDaGFuZ2VCbG9jay5hZGQoNjAwMCkpOwogICAgcmVxdWlyZSAoY29udHJpYnV0aW9uTWluIDw9IGFtb3VudEluV2VpICYmIGFtb3VudEluV2VpIDw9IHRoaXMuYmFsYW5jZSk7CiAgICBmaW5hbEJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICByZXF1aXJlIChyZWNlaXZlckFkZHJlc3MuY2FsbC52YWx1ZShhbW91bnRJbldlaSkuZ2FzKG1zZy5nYXMuc3ViKDUwMDApKSgpKTsKICAgIGV0aFJlZnVuZEFtb3VudC5wdXNoKHRoaXMuYmFsYW5jZSk7CiAgICBjb250cmFjdFN0YWdlID0gMzsKICAgIFBvb2xTdWJtaXR0ZWQocmVjZWl2ZXJBZGRyZXNzLCBhbW91bnRJbldlaSk7CiAgfQogIAogIC8vIFRoaXMgZnVuY3Rpb24gb3BlbnMgdGhlIGNvbnRyYWN0IHVwIGZvciB0b2tlbiB3aXRoZHJhd2Fscy4KICAvLyBJdCBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIGR1cmluZyBzdGFnZSAzLiAgVGhlIG93bmVyIHNwZWNpZmllcyB0aGUgYWRkcmVzcyBvZiBhbiBFUkMyMCB0b2tlbgogIC8vIGNvbnRyYWN0IHRoYXQgdGhpcyBjb250cmFjdCBoYXMgYSBiYWxhbmNlIGluLCBhbmQgb3B0aW9uYWxseSBhIGJvb2wgdG8gcHJldmVudCB0aGlzIHRva2VuIGZyb20gYmVpbmcKICAvLyB0aGUgZGVmYXVsdCB3aXRoZHJhd2FsIChpbiB0aGUgZXZlbnQgb2YgYW4gYWlyZHJvcCwgZm9yIGV4YW1wbGUpLgogIGZ1bmN0aW9uIGVuYWJsZVRva2VuV2l0aGRyYXdhbHMgKGFkZHJlc3MgdG9rZW5BZGRyLCBib29sIG5vdERlZmF1bHQpIHB1YmxpYyBvbmx5T3duZXIgbm9SZWVudHJhbmN5IHsKICAgIHJlcXVpcmUgKGNvbnRyYWN0U3RhZ2UgPT0gMyk7CiAgICBpZiAobm90RGVmYXVsdCkgewogICAgICByZXF1aXJlIChhY3RpdmVUb2tlbiAhPSAweDAwKTsKICAgIH0gZWxzZSB7CiAgICAgIGFjdGl2ZVRva2VuID0gdG9rZW5BZGRyOwogICAgfQogICAgdmFyIGQgPSBkaXN0cmlidXRpb25NYXBbdG9rZW5BZGRyXTsgICAgCiAgICBpZiAoZC5wY3QubGVuZ3RoPT0wKSBkLnRva2VuID0gRVJDMjAodG9rZW5BZGRyKTsKICAgIHVpbnQgYW1vdW50ID0gZC50b2tlbi5iYWxhbmNlT2YodGhpcykuc3ViKGQuYmFsYW5jZVJlbWFpbmluZyk7CiAgICByZXF1aXJlIChhbW91bnQgPiAwKTsKICAgIGlmIChmZWVQY3QgPiAwKSB7CiAgICAgIHJlcXVpcmUgKGQudG9rZW4udHJhbnNmZXIob3duZXIsX2FwcGx5UGN0KGFtb3VudCxmZWVQY3QpKSk7CiAgICB9CiAgICBhbW91bnQgPSBkLnRva2VuLmJhbGFuY2VPZih0aGlzKS5zdWIoZC5iYWxhbmNlUmVtYWluaW5nKTsKICAgIGQuYmFsYW5jZVJlbWFpbmluZyA9IGQudG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgZC5wY3QucHVzaChfdG9QY3QoYW1vdW50LGZpbmFsQmFsYW5jZSkpOwogIH0KICAKICAvLyBUaGlzIGlzIGEgc3RhbmRhcmQgZnVuY3Rpb24gcmVxdWlyZWQgZm9yIEVSQzIyMyBjb21wYXRpYmlsaXR5LgogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2sgKGFkZHJlc3MgZnJvbSwgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSkgcHVibGljIHsKICAgIEVSQzIyM1JlY2VpdmVkIChmcm9tLCB2YWx1ZSk7CiAgfQogIAp9'.
	

]
