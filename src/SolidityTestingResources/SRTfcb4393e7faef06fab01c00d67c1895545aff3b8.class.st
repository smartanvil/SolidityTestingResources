Class {
	#name : #SRTfcb4393e7faef06fab01c00d67c1895545aff3b8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTfcb4393e7faef06fab01c00d67c1895545aff3b8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBVdGlscyB7CgogICAgRVJDMjAgY29uc3RhbnQgaW50ZXJuYWwgRVRIX1RPS0VOX0FERFJFU1MgPSBFUkMyMCgweDAwZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZSk7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBQUkVDSVNJT04gPSAoMTAqKjE4KTsKICAgIHVpbnQgIGNvbnN0YW50IGludGVybmFsIE1BWF9RVFkgICA9ICgxMCoqMjgpOyAvLyAxMEIgdG9rZW5zCiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBNQVhfUkFURSAgPSAoUFJFQ0lTSU9OICogMTAqKjYpOyAvLyB1cCB0byAxTSB0b2tlbnMgcGVyIEVUSAogICAgdWludCAgY29uc3RhbnQgaW50ZXJuYWwgTUFYX0RFQ0lNQUxTID0gMTg7CiAgICB1aW50ICBjb25zdGFudCBpbnRlcm5hbCBFVEhfREVDSU1BTFMgPSAxODsKICAgIG1hcHBpbmcoYWRkcmVzcz0+dWludCkgaW50ZXJuYWwgZGVjaW1hbHM7CgogICAgZnVuY3Rpb24gc2V0RGVjaW1hbHMoRVJDMjAgdG9rZW4pIGludGVybmFsIHsKICAgICAgICBpZiAodG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpIGRlY2ltYWxzW3Rva2VuXSA9IEVUSF9ERUNJTUFMUzsKICAgICAgICBlbHNlIGRlY2ltYWxzW3Rva2VuXSA9IHRva2VuLmRlY2ltYWxzKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGVjaW1hbHMoRVJDMjAgdG9rZW4pIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgaWYgKHRva2VuID09IEVUSF9UT0tFTl9BRERSRVNTKSByZXR1cm4gRVRIX0RFQ0lNQUxTOyAvLyBzYXZlIHN0b3JhZ2UgYWNjZXNzCiAgICAgICAgdWludCB0b2tlbkRlY2ltYWxzID0gZGVjaW1hbHNbdG9rZW5dOwogICAgICAgIC8vIHRlY2huaWNhbGx5LCB0aGVyZSBtaWdodCBiZSB0b2tlbiB3aXRoIGRlY2ltYWxzIDAKICAgICAgICAvLyBtb3Jlb3ZlciwgdmVyeSBwb3NzaWJsZSB0aGF0IG9sZCB0b2tlbnMgaGF2ZSBkZWNpbWFscyAwCiAgICAgICAgLy8gdGhlc2UgdG9rZW5zIHdpbGwganVzdCBoYXZlIGhpZ2hlciBnYXMgZmVlcy4KICAgICAgICBpZih0b2tlbkRlY2ltYWxzID09IDApIHJldHVybiB0b2tlbi5kZWNpbWFscygpOwoKICAgICAgICByZXR1cm4gdG9rZW5EZWNpbWFsczsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjRHN0UXR5KHVpbnQgc3JjUXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShzcmNRdHkgPD0gTUFYX1FUWSk7CiAgICAgICAgcmVxdWlyZShyYXRlIDw9IE1BWF9SQVRFKTsKCiAgICAgICAgaWYgKGRzdERlY2ltYWxzID49IHNyY0RlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIHJldHVybiAoc3JjUXR5ICogcmF0ZSAqICgxMCoqKGRzdERlY2ltYWxzIC0gc3JjRGVjaW1hbHMpKSkgLyBQUkVDSVNJT047CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoc3JjRGVjaW1hbHMgLSBkc3REZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgcmV0dXJuIChzcmNRdHkgKiByYXRlKSAvIChQUkVDSVNJT04gKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjU3JjUXR5KHVpbnQgZHN0UXR5LCB1aW50IHNyY0RlY2ltYWxzLCB1aW50IGRzdERlY2ltYWxzLCB1aW50IHJhdGUpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmVxdWlyZShkc3RRdHkgPD0gTUFYX1FUWSk7CiAgICAgICAgcmVxdWlyZShyYXRlIDw9IE1BWF9SQVRFKTsKCiAgICAgICAgLy9zb3VyY2UgcXVhbnRpdHkgaXMgcm91bmRlZCB1cC4gdG8gYXZvaWQgZGVzdCBxdWFudGl0eSBiZWluZyB0b28gbG93LgogICAgICAgIHVpbnQgbnVtZXJhdG9yOwogICAgICAgIHVpbnQgZGVub21pbmF0b3I7CiAgICAgICAgaWYgKHNyY0RlY2ltYWxzID49IGRzdERlY2ltYWxzKSB7CiAgICAgICAgICAgIHJlcXVpcmUoKHNyY0RlY2ltYWxzIC0gZHN0RGVjaW1hbHMpIDw9IE1BWF9ERUNJTUFMUyk7CiAgICAgICAgICAgIG51bWVyYXRvciA9IChQUkVDSVNJT04gKiBkc3RRdHkgKiAoMTAqKihzcmNEZWNpbWFscyAtIGRzdERlY2ltYWxzKSkpOwogICAgICAgICAgICBkZW5vbWluYXRvciA9IHJhdGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZSgoZHN0RGVjaW1hbHMgLSBzcmNEZWNpbWFscykgPD0gTUFYX0RFQ0lNQUxTKTsKICAgICAgICAgICAgbnVtZXJhdG9yID0gKFBSRUNJU0lPTiAqIGRzdFF0eSk7CiAgICAgICAgICAgIGRlbm9taW5hdG9yID0gKHJhdGUgKiAoMTAqKihkc3REZWNpbWFscyAtIHNyY0RlY2ltYWxzKSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKG51bWVyYXRvciArIGRlbm9taW5hdG9yIC0gMSkgLyBkZW5vbWluYXRvcjsgLy9hdm9pZCByb3VuZGluZyBkb3duIGVycm9ycwogICAgfQp9CgppbnRlcmZhY2UgRmVlQnVybmVySW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGhhbmRsZUZlZXMgKHVpbnQgdHJhZGVXZWlBbW91bnQsIGFkZHJlc3MgcmVzZXJ2ZSwgYWRkcmVzcyB3YWxsZXQpIHB1YmxpYyByZXR1cm5zKGJvb2wpOwp9CgppbnRlcmZhY2UgS3liZXJSZXNlcnZlSW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiB0cmFkZSgKICAgICAgICBFUkMyMCBzcmNUb2tlbiwKICAgICAgICB1aW50IHNyY0Ftb3VudCwKICAgICAgICBFUkMyMCBkZXN0VG9rZW4sCiAgICAgICAgYWRkcmVzcyBkZXN0QWRkcmVzcywKICAgICAgICB1aW50IGNvbnZlcnNpb25SYXRlLAogICAgICAgIGJvb2wgdmFsaWRhdGUKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgcmV0dXJucyhib29sKTsKCiAgICBmdW5jdGlvbiBnZXRDb252ZXJzaW9uUmF0ZShFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgc3JjUXR5LCB1aW50IGJsb2NrTnVtYmVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwp9CgppbnRlcmZhY2UgRVJDMjAgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByZW1haW5pbmcpOwogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgZGlnaXRzKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9CgppbnRlcmZhY2UgRXhwZWN0ZWRSYXRlSW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGdldEV4cGVjdGVkUmF0ZShFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgc3JjUXR5KSBwdWJsaWMgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQgZXhwZWN0ZWRSYXRlLCB1aW50IHNsaXBwYWdlUmF0ZSk7Cn0KCmNvbnRyYWN0IFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGFkZHJlc3MgcHVibGljIGFkbWluOwogICAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ0FkbWluOwogICAgbWFwcGluZyhhZGRyZXNzPT5ib29sKSBpbnRlcm5hbCBvcGVyYXRvcnM7CiAgICBtYXBwaW5nKGFkZHJlc3M9PmJvb2wpIGludGVybmFsIGFsZXJ0ZXJzOwogICAgYWRkcmVzc1tdIGludGVybmFsIG9wZXJhdG9yc0dyb3VwOwogICAgYWRkcmVzc1tdIGludGVybmFsIGFsZXJ0ZXJzR3JvdXA7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIE1BWF9HUk9VUF9TSVpFID0gNTA7CgogICAgZnVuY3Rpb24gUGVybWlzc2lvbkdyb3VwcygpIHB1YmxpYyB7CiAgICAgICAgYWRtaW4gPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBZG1pbigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRtaW4pOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seU9wZXJhdG9yKCkgewogICAgICAgIHJlcXVpcmUob3BlcmF0b3JzW21zZy5zZW5kZXJdKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBbGVydGVyKCkgewogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNbbXNnLnNlbmRlcl0pOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0T3BlcmF0b3JzICgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzW10pIHsKICAgICAgICByZXR1cm4gb3BlcmF0b3JzR3JvdXA7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWxlcnRlcnMgKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKGFkZHJlc3NbXSkgewogICAgICAgIHJldHVybiBhbGVydGVyc0dyb3VwOwogICAgfQoKICAgIGV2ZW50IFRyYW5zZmVyQWRtaW5QZW5kaW5nKGFkZHJlc3MgcGVuZGluZ0FkbWluKTsKCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IGFkbWluIHRvIHNldCB0aGUgcGVuZGluZ0FkbWluIGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gbmV3QWRtaW4gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckFkbWluKGFkZHJlc3MgbmV3QWRtaW4pIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUobmV3QWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgVHJhbnNmZXJBZG1pblBlbmRpbmcocGVuZGluZ0FkbWluKTsKICAgICAgICBwZW5kaW5nQWRtaW4gPSBuZXdBZG1pbjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IGFkbWluIHRvIHNldCB0aGUgYWRtaW4gaW4gb25lIHR4LiBVc2VmdWwgaW5pdGlhbCBkZXBsb3ltZW50LgogICAgICogQHBhcmFtIG5ld0FkbWluIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBZG1pblF1aWNrbHkoYWRkcmVzcyBuZXdBZG1pbikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShuZXdBZG1pbiAhPSBhZGRyZXNzKDApKTsKICAgICAgICBUcmFuc2ZlckFkbWluUGVuZGluZyhuZXdBZG1pbik7CiAgICAgICAgQWRtaW5DbGFpbWVkKG5ld0FkbWluLCBhZG1pbik7CiAgICAgICAgYWRtaW4gPSBuZXdBZG1pbjsKICAgIH0KCiAgICBldmVudCBBZG1pbkNsYWltZWQoIGFkZHJlc3MgbmV3QWRtaW4sIGFkZHJlc3MgcHJldmlvdXNBZG1pbik7CgogICAgLyoqCiAgICAgKiBAZGV2IEFsbG93cyB0aGUgcGVuZGluZ0FkbWluIGFkZHJlc3MgdG8gZmluYWxpemUgdGhlIGNoYW5nZSBhZG1pbiBwcm9jZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjbGFpbUFkbWluKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKHBlbmRpbmdBZG1pbiA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBBZG1pbkNsYWltZWQocGVuZGluZ0FkbWluLCBhZG1pbik7CiAgICAgICAgYWRtaW4gPSBwZW5kaW5nQWRtaW47CiAgICAgICAgcGVuZGluZ0FkbWluID0gYWRkcmVzcygwKTsKICAgIH0KCiAgICBldmVudCBBbGVydGVyQWRkZWQgKGFkZHJlc3MgbmV3QWxlcnRlciwgYm9vbCBpc0FkZCk7CgogICAgZnVuY3Rpb24gYWRkQWxlcnRlcihhZGRyZXNzIG5ld0FsZXJ0ZXIpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoIWFsZXJ0ZXJzW25ld0FsZXJ0ZXJdKTsgLy8gcHJldmVudCBkdXBsaWNhdGVzLgogICAgICAgIHJlcXVpcmUoYWxlcnRlcnNHcm91cC5sZW5ndGggPCBNQVhfR1JPVVBfU0laRSk7CgogICAgICAgIEFsZXJ0ZXJBZGRlZChuZXdBbGVydGVyLCB0cnVlKTsKICAgICAgICBhbGVydGVyc1tuZXdBbGVydGVyXSA9IHRydWU7CiAgICAgICAgYWxlcnRlcnNHcm91cC5wdXNoKG5ld0FsZXJ0ZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZUFsZXJ0ZXIgKGFkZHJlc3MgYWxlcnRlcikgcHVibGljIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZShhbGVydGVyc1thbGVydGVyXSk7CiAgICAgICAgYWxlcnRlcnNbYWxlcnRlcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYWxlcnRlcnNHcm91cC5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAoYWxlcnRlcnNHcm91cFtpXSA9PSBhbGVydGVyKSB7CiAgICAgICAgICAgICAgICBhbGVydGVyc0dyb3VwW2ldID0gYWxlcnRlcnNHcm91cFthbGVydGVyc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgYWxlcnRlcnNHcm91cC5sZW5ndGgtLTsKICAgICAgICAgICAgICAgIEFsZXJ0ZXJBZGRlZChhbGVydGVyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBldmVudCBPcGVyYXRvckFkZGVkKGFkZHJlc3MgbmV3T3BlcmF0b3IsIGJvb2wgaXNBZGQpOwoKICAgIGZ1bmN0aW9uIGFkZE9wZXJhdG9yKGFkZHJlc3MgbmV3T3BlcmF0b3IpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoIW9wZXJhdG9yc1tuZXdPcGVyYXRvcl0pOyAvLyBwcmV2ZW50IGR1cGxpY2F0ZXMuCiAgICAgICAgcmVxdWlyZShvcGVyYXRvcnNHcm91cC5sZW5ndGggPCBNQVhfR1JPVVBfU0laRSk7CgogICAgICAgIE9wZXJhdG9yQWRkZWQobmV3T3BlcmF0b3IsIHRydWUpOwogICAgICAgIG9wZXJhdG9yc1tuZXdPcGVyYXRvcl0gPSB0cnVlOwogICAgICAgIG9wZXJhdG9yc0dyb3VwLnB1c2gobmV3T3BlcmF0b3IpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU9wZXJhdG9yIChhZGRyZXNzIG9wZXJhdG9yKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICByZXF1aXJlKG9wZXJhdG9yc1tvcGVyYXRvcl0pOwogICAgICAgIG9wZXJhdG9yc1tvcGVyYXRvcl0gPSBmYWxzZTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgb3BlcmF0b3JzR3JvdXAubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKG9wZXJhdG9yc0dyb3VwW2ldID09IG9wZXJhdG9yKSB7CiAgICAgICAgICAgICAgICBvcGVyYXRvcnNHcm91cFtpXSA9IG9wZXJhdG9yc0dyb3VwW29wZXJhdG9yc0dyb3VwLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgb3BlcmF0b3JzR3JvdXAubGVuZ3RoIC09IDE7CiAgICAgICAgICAgICAgICBPcGVyYXRvckFkZGVkKG9wZXJhdG9yLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgV2hpdGVMaXN0SW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGdldFVzZXJDYXBJbldlaShhZGRyZXNzIHVzZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCB1c2VyQ2FwV2VpKTsKfQoKY29udHJhY3QgV2l0aGRyYXdhYmxlIGlzIFBlcm1pc3Npb25Hcm91cHMgewoKICAgIGV2ZW50IFRva2VuV2l0aGRyYXcoRVJDMjAgdG9rZW4sIHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IGFsbCBFUkMyMCBjb21wYXRpYmxlIHRva2VucwogICAgICogQHBhcmFtIHRva2VuIEVSQzIwIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdAogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VuKEVSQzIwIHRva2VuLCB1aW50IGFtb3VudCwgYWRkcmVzcyBzZW5kVG8pIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihzZW5kVG8sIGFtb3VudCkpOwogICAgICAgIFRva2VuV2l0aGRyYXcodG9rZW4sIGFtb3VudCwgc2VuZFRvKTsKICAgIH0KCiAgICBldmVudCBFdGhlcldpdGhkcmF3KHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbyk7CgogICAgLyoqCiAgICAgKiBAZGV2IFdpdGhkcmF3IEV0aGVycwogICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0V0aGVyKHVpbnQgYW1vdW50LCBhZGRyZXNzIHNlbmRUbykgZXh0ZXJuYWwgb25seUFkbWluIHsKICAgICAgICBzZW5kVG8udHJhbnNmZXIoYW1vdW50KTsKICAgICAgICBFdGhlcldpdGhkcmF3KGFtb3VudCwgc2VuZFRvKTsKICAgIH0KfQoKY29udHJhY3QgS3liZXJOZXR3b3JrIGlzIFdpdGhkcmF3YWJsZSwgVXRpbHMgewoKICAgIHVpbnQgcHVibGljIG5lZ2xpZ2libGVSYXRlRGlmZiA9IDEwOyAvLyBiYXNpYyByYXRlIHN0ZXBzIHdpbGwgYmUgaW4gMC4wMSUKICAgIEt5YmVyUmVzZXJ2ZUludGVyZmFjZVtdIHB1YmxpYyByZXNlcnZlczsKICAgIG1hcHBpbmcoYWRkcmVzcz0+Ym9vbCkgcHVibGljIGlzUmVzZXJ2ZTsKICAgIFdoaXRlTGlzdEludGVyZmFjZSBwdWJsaWMgd2hpdGVMaXN0Q29udHJhY3Q7CiAgICBFeHBlY3RlZFJhdGVJbnRlcmZhY2UgcHVibGljIGV4cGVjdGVkUmF0ZUNvbnRyYWN0OwogICAgRmVlQnVybmVySW50ZXJmYWNlICAgIHB1YmxpYyBmZWVCdXJuZXJDb250cmFjdDsKICAgIHVpbnQgICAgICAgICAgICAgICAgICBwdWJsaWMgbWF4R2FzUHJpY2UgPSA1MCAqIDEwMDAgKiAxMDAwICogMTAwMDsgLy8gNTAgZ3dlaQogICAgYm9vbCAgICAgICAgICAgICAgICAgIHB1YmxpYyBlbmFibGVkID0gZmFsc2U7IC8vIG5ldHdvcmsgaXMgZW5hYmxlZAogICAgbWFwcGluZyhieXRlczMyPT51aW50KSBwdWJsaWMgaW5mbzsgLy8gdGhpcyBpcyBvbmx5IGEgVUkgZmllbGQgZm9yIGV4dGVybmFsIGFwcC4KICAgIG1hcHBpbmcoYWRkcmVzcz0+bWFwcGluZyhieXRlczMyPT5ib29sKSkgcHVibGljIHBlclJlc2VydmVMaXN0ZWRQYWlyczsKCiAgICBmdW5jdGlvbiBLeWJlck5ldHdvcmsoYWRkcmVzcyBfYWRtaW4pIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfYWRtaW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgYWRtaW4gPSBfYWRtaW47CiAgICB9CgogICAgZXZlbnQgRXRoZXJSZWNlaXZhbChhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCB1aW50IGFtb3VudCk7CgogICAgLyogc29saGludC1kaXNhYmxlIG5vLWNvbXBsZXgtZmFsbGJhY2sgKi8KICAgIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgewogICAgICAgIHJlcXVpcmUoaXNSZXNlcnZlW21zZy5zZW5kZXJdKTsKICAgICAgICBFdGhlclJlY2VpdmFsKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CiAgICAvKiBzb2xoaW50LWVuYWJsZSBuby1jb21wbGV4LWZhbGxiYWNrICovCgogICAgZXZlbnQgRXhlY3V0ZVRyYWRlKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBhY3R1YWxTcmNBbW91bnQsIHVpbnQgYWN0dWFsRGVzdEFtb3VudCk7CgogICAgLy8vIEBub3RpY2UgdXNlIHRva2VuIGFkZHJlc3MgRVRIX1RPS0VOX0FERFJFU1MgZm9yIGV0aGVyCiAgICAvLy8gQGRldiBtYWtlcyBhIHRyYWRlIGJldHdlZW4gc3JjIGFuZCBkZXN0IHRva2VuIGFuZCBzZW5kIGRlc3QgdG9rZW4gdG8gZGVzdEFkZHJlc3MKICAgIC8vLyBAcGFyYW0gc3JjIFNyYyB0b2tlbgogICAgLy8vIEBwYXJhbSBzcmNBbW91bnQgYW1vdW50IG9mIHNyYyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gZGVzdCAgIERlc3RpbmF0aW9uIHRva2VuCiAgICAvLy8gQHBhcmFtIGRlc3RBZGRyZXNzIEFkZHJlc3MgdG8gc2VuZCB0b2tlbnMgdG8KICAgIC8vLyBAcGFyYW0gbWF4RGVzdEFtb3VudCBBIGxpbWl0IG9uIHRoZSBhbW91bnQgb2YgZGVzdCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gbWluQ29udmVyc2lvblJhdGUgVGhlIG1pbmltYWwgY29udmVyc2lvbiByYXRlLiBJZiBhY3R1YWwgcmF0ZSBpcyBsb3dlciwgdHJhZGUgaXMgY2FuY2VsZWQuCiAgICAvLy8gQHBhcmFtIHdhbGxldElkIGlzIHRoZSB3YWxsZXQgSUQgdG8gc2VuZCBwYXJ0IG9mIHRoZSBmZWVzCiAgICAvLy8gQHJldHVybiBhbW91bnQgb2YgYWN0dWFsIGRlc3QgdG9rZW5zCiAgICBmdW5jdGlvbiB0cmFkZSgKICAgICAgICBFUkMyMCBzcmMsCiAgICAgICAgdWludCBzcmNBbW91bnQsCiAgICAgICAgRVJDMjAgZGVzdCwKICAgICAgICBhZGRyZXNzIGRlc3RBZGRyZXNzLAogICAgICAgIHVpbnQgbWF4RGVzdEFtb3VudCwKICAgICAgICB1aW50IG1pbkNvbnZlcnNpb25SYXRlLAogICAgICAgIGFkZHJlc3Mgd2FsbGV0SWQKICAgICkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgcmV0dXJucyh1aW50KQogICAgewogICAgICAgIHJlcXVpcmUoZW5hYmxlZCk7CgogICAgICAgIHVpbnQgdXNlclNyY0JhbGFuY2VCZWZvcmU7CiAgICAgICAgdWludCB1c2VyU3JjQmFsYW5jZUFmdGVyOwogICAgICAgIHVpbnQgdXNlckRlc3RCYWxhbmNlQmVmb3JlOwogICAgICAgIHVpbnQgdXNlckRlc3RCYWxhbmNlQWZ0ZXI7CgogICAgICAgIHVzZXJTcmNCYWxhbmNlQmVmb3JlID0gZ2V0QmFsYW5jZShzcmMsIG1zZy5zZW5kZXIpOwogICAgICAgIGlmIChzcmMgPT0gRVRIX1RPS0VOX0FERFJFU1MpCiAgICAgICAgICAgIHVzZXJTcmNCYWxhbmNlQmVmb3JlICs9IG1zZy52YWx1ZTsKICAgICAgICB1c2VyRGVzdEJhbGFuY2VCZWZvcmUgPSBnZXRCYWxhbmNlKGRlc3QsIGRlc3RBZGRyZXNzKTsKCiAgICAgICAgdWludCBhY3R1YWxEZXN0QW1vdW50ID0gZG9UcmFkZShzcmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmNBbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhEZXN0QW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluQ29udmVyc2lvblJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWxsZXRJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICByZXF1aXJlKGFjdHVhbERlc3RBbW91bnQgPiAwKTsKCiAgICAgICAgdXNlclNyY0JhbGFuY2VBZnRlciA9IGdldEJhbGFuY2Uoc3JjLCBtc2cuc2VuZGVyKTsKICAgICAgICB1c2VyRGVzdEJhbGFuY2VBZnRlciA9IGdldEJhbGFuY2UoZGVzdCwgZGVzdEFkZHJlc3MpOwoKICAgICAgICByZXF1aXJlKHVzZXJTcmNCYWxhbmNlQWZ0ZXIgPD0gdXNlclNyY0JhbGFuY2VCZWZvcmUpOwogICAgICAgIHJlcXVpcmUodXNlckRlc3RCYWxhbmNlQWZ0ZXIgPj0gdXNlckRlc3RCYWxhbmNlQmVmb3JlKTsKCiAgICAgICAgcmVxdWlyZSgodXNlckRlc3RCYWxhbmNlQWZ0ZXIgLSB1c2VyRGVzdEJhbGFuY2VCZWZvcmUpID49CiAgICAgICAgICAgIGNhbGNEc3RRdHkoKHVzZXJTcmNCYWxhbmNlQmVmb3JlIC0gdXNlclNyY0JhbGFuY2VBZnRlciksIGdldERlY2ltYWxzKHNyYyksIGdldERlY2ltYWxzKGRlc3QpLAogICAgICAgICAgICAgICAgbWluQ29udmVyc2lvblJhdGUpKTsKCiAgICAgICAgcmV0dXJuIGFjdHVhbERlc3RBbW91bnQ7CiAgICB9CgogICAgZXZlbnQgQWRkUmVzZXJ2ZVRvTmV0d29yayhLeWJlclJlc2VydmVJbnRlcmZhY2UgcmVzZXJ2ZSwgYm9vbCBhZGQpOwoKICAgIC8vLyBAbm90aWNlIGNhbiBiZSBjYWxsZWQgb25seSBieSBhZG1pbgogICAgLy8vIEBkZXYgYWRkIG9yIGRlbGV0ZXMgYSByZXNlcnZlIHRvL2Zyb20gdGhlIG5ldHdvcmsuCiAgICAvLy8gQHBhcmFtIHJlc2VydmUgVGhlIHJlc2VydmUgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gYWRkIElmIHRydWUsIHRoZSBhZGQgcmVzZXJ2ZS4gT3RoZXJ3aXNlIGRlbGV0ZSByZXNlcnZlLgogICAgZnVuY3Rpb24gYWRkUmVzZXJ2ZShLeWJlclJlc2VydmVJbnRlcmZhY2UgcmVzZXJ2ZSwgYm9vbCBhZGQpIHB1YmxpYyBvbmx5QWRtaW4gewoKICAgICAgICBpZiAoYWRkKSB7CiAgICAgICAgICAgIHJlcXVpcmUoIWlzUmVzZXJ2ZVtyZXNlcnZlXSk7CiAgICAgICAgICAgIHJlc2VydmVzLnB1c2gocmVzZXJ2ZSk7CiAgICAgICAgICAgIGlzUmVzZXJ2ZVtyZXNlcnZlXSA9IHRydWU7CiAgICAgICAgICAgIEFkZFJlc2VydmVUb05ldHdvcmsocmVzZXJ2ZSwgdHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaXNSZXNlcnZlW3Jlc2VydmVdID0gZmFsc2U7CiAgICAgICAgICAgIC8vIHdpbGwgaGF2ZSB0cm91YmxlIGlmIG1vcmUgdGhhbiA1MGsgcmVzZXJ2ZXMuLi4KICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmVzZXJ2ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChyZXNlcnZlc1tpXSA9PSByZXNlcnZlKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZXNbaV0gPSByZXNlcnZlc1tyZXNlcnZlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgICAgICByZXNlcnZlcy5sZW5ndGgtLTsKICAgICAgICAgICAgICAgICAgICBBZGRSZXNlcnZlVG9OZXR3b3JrKHJlc2VydmUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBldmVudCBMaXN0UmVzZXJ2ZVBhaXJzKGFkZHJlc3MgcmVzZXJ2ZSwgRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCBib29sIGFkZCk7CgogICAgLy8vIEBub3RpY2UgY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGFkbWluCiAgICAvLy8gQGRldiBhbGxvdyBvciBwcmV2ZW50IGEgc3BlY2lmaWMgcmVzZXJ2ZSB0byB0cmFkZSBhIHBhaXIgb2YgdG9rZW5zCiAgICAvLy8gQHBhcmFtIHJlc2VydmUgVGhlIHJlc2VydmUgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gc3JjIFNyYyB0b2tlbgogICAgLy8vIEBwYXJhbSBkZXN0IERlc3RpbmF0aW9uIHRva2VuCiAgICAvLy8gQHBhcmFtIGFkZCBJZiB0cnVlIHRoZW4gZW5hYmxlIHRyYWRlLCBvdGhlcndpc2UgZGVsaXN0IHBhaXIuCiAgICBmdW5jdGlvbiBsaXN0UGFpckZvclJlc2VydmUoYWRkcmVzcyByZXNlcnZlLCBFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIGJvb2wgYWRkKSBwdWJsaWMgb25seUFkbWluIHsKICAgICAgICAocGVyUmVzZXJ2ZUxpc3RlZFBhaXJzW3Jlc2VydmVdKVtrZWNjYWsyNTYoc3JjLCBkZXN0KV0gPSBhZGQ7CgogICAgICAgIGlmIChzcmMgIT0gRVRIX1RPS0VOX0FERFJFU1MpIHsKICAgICAgICAgICAgaWYgKGFkZCkgewogICAgICAgICAgICAgICAgc3JjLmFwcHJvdmUocmVzZXJ2ZSwgMioqMjU1KTsgLy8gYXBwcm92ZSBpbmZpbml0eQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3JjLmFwcHJvdmUocmVzZXJ2ZSwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHNldERlY2ltYWxzKHNyYyk7CiAgICAgICAgc2V0RGVjaW1hbHMoZGVzdCk7CgogICAgICAgIExpc3RSZXNlcnZlUGFpcnMocmVzZXJ2ZSwgc3JjLCBkZXN0LCBhZGQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFBhcmFtcygKICAgICAgICBXaGl0ZUxpc3RJbnRlcmZhY2UgICAgX3doaXRlTGlzdCwKICAgICAgICBFeHBlY3RlZFJhdGVJbnRlcmZhY2UgX2V4cGVjdGVkUmF0ZSwKICAgICAgICBGZWVCdXJuZXJJbnRlcmZhY2UgICAgX2ZlZUJ1cm5lciwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgICAgX21heEdhc1ByaWNlLAogICAgICAgIHVpbnQgICAgICAgICAgICAgICAgICBfbmVnbGlnaWJsZVJhdGVEaWZmCiAgICApCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUFkbWluCiAgICB7CiAgICAgICAgcmVxdWlyZShfd2hpdGVMaXN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX2ZlZUJ1cm5lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9leHBlY3RlZFJhdGUgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfbmVnbGlnaWJsZVJhdGVEaWZmIDw9IDEwMCAqIDEwMCk7IC8vIGF0IG1vc3QgMTAwJQoKICAgICAgICB3aGl0ZUxpc3RDb250cmFjdCA9IF93aGl0ZUxpc3Q7CiAgICAgICAgZXhwZWN0ZWRSYXRlQ29udHJhY3QgPSBfZXhwZWN0ZWRSYXRlOwogICAgICAgIGZlZUJ1cm5lckNvbnRyYWN0ID0gX2ZlZUJ1cm5lcjsKICAgICAgICBtYXhHYXNQcmljZSA9IF9tYXhHYXNQcmljZTsKICAgICAgICBuZWdsaWdpYmxlUmF0ZURpZmYgPSBfbmVnbGlnaWJsZVJhdGVEaWZmOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEVuYWJsZShib29sIF9lbmFibGUpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIGlmIChfZW5hYmxlKSB7CiAgICAgICAgICAgIHJlcXVpcmUod2hpdGVMaXN0Q29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgICAgIHJlcXVpcmUoZmVlQnVybmVyQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgICAgIHJlcXVpcmUoZXhwZWN0ZWRSYXRlQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgfQogICAgICAgIGVuYWJsZWQgPSBfZW5hYmxlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEluZm8oYnl0ZXMzMiBmaWVsZCwgdWludCB2YWx1ZSkgcHVibGljIG9ubHlPcGVyYXRvciB7CiAgICAgICAgaW5mb1tmaWVsZF0gPSB2YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiByZXR1cm5zIG51bWJlciBvZiByZXNlcnZlcwogICAgLy8vIEByZXR1cm4gbnVtYmVyIG9mIHJlc2VydmVzCiAgICBmdW5jdGlvbiBnZXROdW1SZXNlcnZlcygpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiByZXNlcnZlcy5sZW5ndGg7CiAgICB9CgogICAgLy8vIEBub3RpY2Ugc2hvdWxkIGJlIGNhbGxlZCBvZmYgY2hhaW4gd2l0aCBhcyBtdWNoIGdhcyBhcyBuZWVkZWQKICAgIC8vLyBAZGV2IGdldCBhbiBhcnJheSBvZiBhbGwgcmVzZXJ2ZXMKICAgIC8vLyBAcmV0dXJuIEFuIGFycmF5IG9mIGFsbCByZXNlcnZlcwogICAgZnVuY3Rpb24gZ2V0UmVzZXJ2ZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zKEt5YmVyUmVzZXJ2ZUludGVyZmFjZVtdKSB7CiAgICAgICAgcmV0dXJuIHJlc2VydmVzOwogICAgfQoKICAgIC8vLyBAZGV2IGdldCB0aGUgYmFsYW5jZSBvZiBhIHVzZXIuCiAgICAvLy8gQHBhcmFtIHRva2VuIFRoZSB0b2tlbiB0eXBlCiAgICAvLy8gQHJldHVybiBUaGUgYmFsYW5jZQogICAgZnVuY3Rpb24gZ2V0QmFsYW5jZShFUkMyMCB0b2tlbiwgYWRkcmVzcyB1c2VyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICBpZiAodG9rZW4gPT0gRVRIX1RPS0VOX0FERFJFU1MpCiAgICAgICAgICAgIHJldHVybiB1c2VyLmJhbGFuY2U7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdG9rZW4uYmFsYW5jZU9mKHVzZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHVzZSB0b2tlbiBhZGRyZXNzIEVUSF9UT0tFTl9BRERSRVNTIGZvciBldGhlcgogICAgLy8vIEBkZXYgYmVzdCBjb252ZXJzaW9uIHJhdGUgZm9yIGEgcGFpciBvZiB0b2tlbnMsIGlmIG51bWJlciBvZiByZXNlcnZlcyBoYXZlIHNtYWxsIGRpZmZlcmVuY2VzLiByYW5kb21pemUKICAgIC8vLyBAcGFyYW0gc3JjIFNyYyB0b2tlbgogICAgLy8vIEBwYXJhbSBkZXN0IERlc3RpbmF0aW9uIHRva2VuCiAgICAvKiBzb2xoaW50LWRpc2FibGUgY29kZS1jb21wbGV4aXR5ICovCiAgICBmdW5jdGlvbiBmaW5kQmVzdFJhdGUoRVJDMjAgc3JjLCBFUkMyMCBkZXN0LCB1aW50IHNyY1F0eSkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50LCB1aW50KSB7CiAgICAgICAgdWludCBiZXN0UmF0ZSA9IDA7CiAgICAgICAgdWludCBiZXN0UmVzZXJ2ZSA9IDA7CiAgICAgICAgdWludCBudW1SZWxldmFudFJlc2VydmVzID0gMDsKICAgICAgICB1aW50IG51bVJlc2VydmVzID0gcmVzZXJ2ZXMubGVuZ3RoOwogICAgICAgIHVpbnRbXSBtZW1vcnkgcmF0ZXMgPSBuZXcgdWludFtdKG51bVJlc2VydmVzKTsKICAgICAgICB1aW50W10gbWVtb3J5IHJlc2VydmVDYW5kaWRhdGVzID0gbmV3IHVpbnRbXShudW1SZXNlcnZlcyk7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG51bVJlc2VydmVzOyBpKyspIHsKICAgICAgICAgICAgLy9saXN0IGFsbCByZXNlcnZlcyB0aGF0IGhhdmUgdGhpcyB0b2tlbi4KICAgICAgICAgICAgaWYgKCEocGVyUmVzZXJ2ZUxpc3RlZFBhaXJzW3Jlc2VydmVzW2ldXSlba2VjY2FrMjU2KHNyYywgZGVzdCldKSBjb250aW51ZTsKCiAgICAgICAgICAgIHJhdGVzW2ldID0gcmVzZXJ2ZXNbaV0uZ2V0Q29udmVyc2lvblJhdGUoc3JjLCBkZXN0LCBzcmNRdHksIGJsb2NrLm51bWJlcik7CgogICAgICAgICAgICBpZiAocmF0ZXNbaV0gPiBiZXN0UmF0ZSkgewogICAgICAgICAgICAgICAgLy9iZXN0IHJhdGUgaXMgaGlnaGVzdCByYXRlCiAgICAgICAgICAgICAgICBiZXN0UmF0ZSA9IHJhdGVzW2ldOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmVzdFJhdGUgPiAwKSB7CiAgICAgICAgICAgIHVpbnQgcmFuZG9tID0gMDsKICAgICAgICAgICAgdWludCBzbWFsbGVzdFJlbGV2YW50UmF0ZSA9IChiZXN0UmF0ZSAqIDEwMDAwKSAvICgxMDAwMCArIG5lZ2xpZ2libGVSYXRlRGlmZik7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtUmVzZXJ2ZXM7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHJhdGVzW2ldID49IHNtYWxsZXN0UmVsZXZhbnRSYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZUNhbmRpZGF0ZXNbbnVtUmVsZXZhbnRSZXNlcnZlcysrXSA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChudW1SZWxldmFudFJlc2VydmVzID4gMSkgewogICAgICAgICAgICAgICAgLy93aGVuIGVuY291bnRlcmluZyBzbWFsbCByYXRlIGRpZmYgZnJvbSBiZXN0UmF0ZS4gZHJhdyBmcm9tIHJlbGV2YW50IHJlc2VydmVzCiAgICAgICAgICAgICAgICByYW5kb20gPSB1aW50KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSkpICUgbnVtUmVsZXZhbnRSZXNlcnZlczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYmVzdFJlc2VydmUgPSByZXNlcnZlQ2FuZGlkYXRlc1tyYW5kb21dOwogICAgICAgICAgICBiZXN0UmF0ZSA9IHJhdGVzW2Jlc3RSZXNlcnZlXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAoYmVzdFJlc2VydmUsIGJlc3RSYXRlKTsKICAgIH0KICAgIC8qIHNvbGhpbnQtZW5hYmxlIGNvZGUtY29tcGxleGl0eSAqLwoKICAgIGZ1bmN0aW9uIGdldEV4cGVjdGVkUmF0ZShFUkMyMCBzcmMsIEVSQzIwIGRlc3QsIHVpbnQgc3JjUXR5KQogICAgICAgIHB1YmxpYyB2aWV3CiAgICAgICAgcmV0dXJucyAodWludCBleHBlY3RlZFJhdGUsIHVpbnQgc2xpcHBhZ2VSYXRlKQogICAgewogICAgICAgIHJlcXVpcmUoZXhwZWN0ZWRSYXRlQ29udHJhY3QgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmV0dXJuIGV4cGVjdGVkUmF0ZUNvbnRyYWN0LmdldEV4cGVjdGVkUmF0ZShzcmMsIGRlc3QsIHNyY1F0eSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VXNlckNhcEluV2VpKGFkZHJlc3MgdXNlcikgcHVibGljIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHdoaXRlTGlzdENvbnRyYWN0LmdldFVzZXJDYXBJbldlaSh1c2VyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkb1RyYWRlKAogICAgICAgIEVSQzIwIHNyYywKICAgICAgICB1aW50IHNyY0Ftb3VudCwKICAgICAgICBFUkMyMCBkZXN0LAogICAgICAgIGFkZHJlc3MgZGVzdEFkZHJlc3MsCiAgICAgICAgdWludCBtYXhEZXN0QW1vdW50LAogICAgICAgIHVpbnQgbWluQ29udmVyc2lvblJhdGUsCiAgICAgICAgYWRkcmVzcyB3YWxsZXRJZAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyh1aW50KQogICAgewogICAgICAgIHJlcXVpcmUodHguZ2FzcHJpY2UgPD0gbWF4R2FzUHJpY2UpOwogICAgICAgIHJlcXVpcmUodmFsaWRhdGVUcmFkZUlucHV0KHNyYywgc3JjQW1vdW50LCBkZXN0QWRkcmVzcykpOwoKICAgICAgICB1aW50IHJlc2VydmVJbmQ7CiAgICAgICAgdWludCByYXRlOwoKICAgICAgICAocmVzZXJ2ZUluZCwgcmF0ZSkgPSBmaW5kQmVzdFJhdGUoc3JjLCBkZXN0LCBzcmNBbW91bnQpOwogICAgICAgIEt5YmVyUmVzZXJ2ZUludGVyZmFjZSB0aGVSZXNlcnZlID0gcmVzZXJ2ZXNbcmVzZXJ2ZUluZF07CiAgICAgICAgcmVxdWlyZShyYXRlID4gMCk7CiAgICAgICAgcmVxdWlyZShyYXRlIDwgTUFYX1JBVEUpOwogICAgICAgIHJlcXVpcmUocmF0ZSA+PSBtaW5Db252ZXJzaW9uUmF0ZSk7CgogICAgICAgIHVpbnQgYWN0dWFsU3JjQW1vdW50ID0gc3JjQW1vdW50OwogICAgICAgIHVpbnQgYWN0dWFsRGVzdEFtb3VudCA9IGNhbGNEZXN0QW1vdW50KHNyYywgZGVzdCwgYWN0dWFsU3JjQW1vdW50LCByYXRlKTsKICAgICAgICBpZiAoYWN0dWFsRGVzdEFtb3VudCA+IG1heERlc3RBbW91bnQpIHsKICAgICAgICAgICAgYWN0dWFsRGVzdEFtb3VudCA9IG1heERlc3RBbW91bnQ7CiAgICAgICAgICAgIGFjdHVhbFNyY0Ftb3VudCA9IGNhbGNTcmNBbW91bnQoc3JjLCBkZXN0LCBhY3R1YWxEZXN0QW1vdW50LCByYXRlKTsKICAgICAgICAgICAgcmVxdWlyZShhY3R1YWxTcmNBbW91bnQgPD0gc3JjQW1vdW50KTsKICAgICAgICB9CgogICAgICAgIC8vIGRvIHRoZSB0cmFkZQogICAgICAgIC8vIHZlcmlmeSB0cmFkZSBzaXplIGlzIHNtYWxsZXIgdGhhbiB1c2VyIGNhcAogICAgICAgIHVpbnQgZXRoQW1vdW50OwogICAgICAgIGlmIChzcmMgPT0gRVRIX1RPS0VOX0FERFJFU1MpIHsKICAgICAgICAgICAgZXRoQW1vdW50ID0gYWN0dWFsU3JjQW1vdW50OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV0aEFtb3VudCA9IGFjdHVhbERlc3RBbW91bnQ7CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKGV0aEFtb3VudCA8PSBnZXRVc2VyQ2FwSW5XZWkobXNnLnNlbmRlcikpOwogICAgICAgIHJlcXVpcmUoZG9SZXNlcnZlVHJhZGUoCiAgICAgICAgICAgICAgICBzcmMsCiAgICAgICAgICAgICAgICBhY3R1YWxTcmNBbW91bnQsCiAgICAgICAgICAgICAgICBkZXN0LAogICAgICAgICAgICAgICAgZGVzdEFkZHJlc3MsCiAgICAgICAgICAgICAgICBhY3R1YWxEZXN0QW1vdW50LAogICAgICAgICAgICAgICAgdGhlUmVzZXJ2ZSwKICAgICAgICAgICAgICAgIHJhdGUsCiAgICAgICAgICAgICAgICB0cnVlKSk7CgogICAgICAgIGlmICgoYWN0dWFsU3JjQW1vdW50IDwgc3JjQW1vdW50KSAmJiAoc3JjID09IEVUSF9UT0tFTl9BRERSRVNTKSkgewogICAgICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHNyY0Ftb3VudCAtIGFjdHVhbFNyY0Ftb3VudCk7CiAgICAgICAgfQoKICAgICAgICByZXF1aXJlKGZlZUJ1cm5lckNvbnRyYWN0LmhhbmRsZUZlZXMoZXRoQW1vdW50LCB0aGVSZXNlcnZlLCB3YWxsZXRJZCkpOwoKICAgICAgICBFeGVjdXRlVHJhZGUobXNnLnNlbmRlciwgc3JjLCBkZXN0LCBhY3R1YWxTcmNBbW91bnQsIGFjdHVhbERlc3RBbW91bnQpOwogICAgICAgIHJldHVybiBhY3R1YWxEZXN0QW1vdW50OwogICAgfQoKICAgIC8vLyBAbm90aWNlIHVzZSB0b2tlbiBhZGRyZXNzIEVUSF9UT0tFTl9BRERSRVNTIGZvciBldGhlcgogICAgLy8vIEBkZXYgZG8gb25lIHRyYWRlIHdpdGggYSByZXNlcnZlCiAgICAvLy8gQHBhcmFtIHNyYyBTcmMgdG9rZW4KICAgIC8vLyBAcGFyYW0gYW1vdW50IGFtb3VudCBvZiBzcmMgdG9rZW5zCiAgICAvLy8gQHBhcmFtIGRlc3QgICBEZXN0aW5hdGlvbiB0b2tlbgogICAgLy8vIEBwYXJhbSBkZXN0QWRkcmVzcyBBZGRyZXNzIHRvIHNlbmQgdG9rZW5zIHRvCiAgICAvLy8gQHBhcmFtIHJlc2VydmUgUmVzZXJ2ZSB0byB1c2UKICAgIC8vLyBAcGFyYW0gdmFsaWRhdGUgSWYgdHJ1ZSwgYWRkaXRpb25hbCB2YWxpZGF0aW9ucyBhcmUgYXBwbGljYWJsZQogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiB0cmFkZSBpcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBkb1Jlc2VydmVUcmFkZSgKICAgICAgICBFUkMyMCBzcmMsCiAgICAgICAgdWludCBhbW91bnQsCiAgICAgICAgRVJDMjAgZGVzdCwKICAgICAgICBhZGRyZXNzIGRlc3RBZGRyZXNzLAogICAgICAgIHVpbnQgZXhwZWN0ZWREZXN0QW1vdW50LAogICAgICAgIEt5YmVyUmVzZXJ2ZUludGVyZmFjZSByZXNlcnZlLAogICAgICAgIHVpbnQgY29udmVyc2lvblJhdGUsCiAgICAgICAgYm9vbCB2YWxpZGF0ZQogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyhib29sKQogICAgewogICAgICAgIHVpbnQgY2FsbFZhbHVlID0gMDsKCiAgICAgICAgaWYgKHNyYyA9PSBFVEhfVE9LRU5fQUREUkVTUykgewogICAgICAgICAgICBjYWxsVmFsdWUgPSBhbW91bnQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gdGFrZSBzcmMgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QKICAgICAgICAgICAgc3JjLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBhbW91bnQpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVzZXJ2ZSBzZW5kcyB0b2tlbnMvZXRoIHRvIG5ldHdvcmsuIG5ldHdvcmsgc2VuZHMgaXQgdG8gZGVzdGluYXRpb24KICAgICAgICByZXF1aXJlKHJlc2VydmUudHJhZGUudmFsdWUoY2FsbFZhbHVlKShzcmMsIGFtb3VudCwgZGVzdCwgdGhpcywgY29udmVyc2lvblJhdGUsIHZhbGlkYXRlKSk7CgogICAgICAgIGlmIChkZXN0ID09IEVUSF9UT0tFTl9BRERSRVNTKSB7CiAgICAgICAgICAgIGRlc3RBZGRyZXNzLnRyYW5zZmVyKGV4cGVjdGVkRGVzdEFtb3VudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVxdWlyZShkZXN0LnRyYW5zZmVyKGRlc3RBZGRyZXNzLCBleHBlY3RlZERlc3RBbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGNEZXN0QW1vdW50KEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBzcmNBbW91bnQsIHVpbnQgcmF0ZSkgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gY2FsY0RzdFF0eShzcmNBbW91bnQsIGdldERlY2ltYWxzKHNyYyksIGdldERlY2ltYWxzKGRlc3QpLCByYXRlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjU3JjQW1vdW50KEVSQzIwIHNyYywgRVJDMjAgZGVzdCwgdWludCBkZXN0QW1vdW50LCB1aW50IHJhdGUpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGNhbGNTcmNRdHkoZGVzdEFtb3VudCwgZ2V0RGVjaW1hbHMoc3JjKSwgZ2V0RGVjaW1hbHMoZGVzdCksIHJhdGUpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHVzZSB0b2tlbiBhZGRyZXNzIEVUSF9UT0tFTl9BRERSRVNTIGZvciBldGhlcgogICAgLy8vIEBkZXYgY2hlY2tzIHRoYXQgdXNlciBzZW50IGV0aGVyL3Rva2VucyB0byBjb250cmFjdCBiZWZvcmUgdHJhZGUKICAgIC8vLyBAcGFyYW0gc3JjIFNyYyB0b2tlbgogICAgLy8vIEBwYXJhbSBzcmNBbW91bnQgYW1vdW50IG9mIHNyYyB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIHRydWUgaWYgaW5wdXQgaXMgdmFsaWQKICAgIGZ1bmN0aW9uIHZhbGlkYXRlVHJhZGVJbnB1dChFUkMyMCBzcmMsIHVpbnQgc3JjQW1vdW50LCBhZGRyZXNzIGRlc3RBZGRyZXNzKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCkgewogICAgICAgIGlmICgoc3JjQW1vdW50ID49IE1BWF9RVFkpIHx8IChzcmNBbW91bnQgPT0gMCkgfHwgKGRlc3RBZGRyZXNzID09IDApKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGlmIChzcmMgPT0gRVRIX1RPS0VOX0FERFJFU1MpIHsKICAgICAgICAgICAgaWYgKG1zZy52YWx1ZSAhPSBzcmNBbW91bnQpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKChtc2cudmFsdWUgIT0gMCkgfHwgKHNyYy5hbGxvd2FuY2UobXNnLnNlbmRlciwgdGhpcykgPCBzcmNBbW91bnQpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCgovLy8gQHRpdGxlIENvbnRyYWN0IGZvciBhIGJ1cm5hYmxlIEVSQwovLy8gQGRldiBGcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9LeWJlck5ldHdvcmsvc21hcnQtY29udHJhY3RzL2Jsb2IvbWFzdGVyL2NvbnRyYWN0cy9FUkMyMEludGVyZmFjZS5zb2wKLy8vIEBkZXYgQWRkZWQgYnVybiBmdW5jdGlvbgppbnRlcmZhY2UgQnVybmFibGVFcmMyMCB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgc3VwcGx5KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IHJlbWFpbmluZyk7CiAgICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyB2aWV3IHJldHVybnModWludCBkaWdpdHMpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIF9vd25lciwgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLCB1aW50IF92YWx1ZSk7CgogICAgZnVuY3Rpb24gYnVybih1aW50IF92YWx1ZSkgcHVibGljOwp9CgoKLy8vIEB0aXRsZSBBIGNvbnRyYWN0IHRvIGJ1cm4gRVJDMjAgdG9rZW5zIGZyb20gRVRIIG9uIHRoZSBjb250cmFjdAovLy8gQG5vdGljZSBTZW5kcyB0aGUgRVRIIG9uIHRoZSBjb250cmFjdCB0byBreWJlciBmb3IgY29udmVyc2lvbiB0byBFUkMyMAovLy8gIFRoZSBjb252ZXJ0ZWQgRVJDMjAgaXMgdGhlbiBidXJuZWQKLy8vIEBkZXYgVXNlZCB0byBidXJuIHRoZSBSRVEgZmVlcy4gUmVxdWVzdCBmZWVzIGFyZSBwYWlkIGluIEVUSC4gVGhlIEVUSCBpcyBzZW50IGJ5IHRoZSAKLy8vICBjdXJyZW5jeSBjb250cmFjdHMgdG8gdGhpcyBidXJuIGNvbnRyYWN0LiBXaGVuIHRoZSBidXJuIGNvbnRyYWN0IGlzIGNhbGxlZCwgaXQgY29udmVydHMKLy8vICB0aGUgRVRIIHRvIFJFUSBhbmQgYnVybiB0aGUgUkVRCi8vLyBAYXV0aG9yIFJlcXVlc3QgTmV0d29yawpjb250cmFjdCBCdXJuZXIgewogICAgLy8vIEt5YmVyIGNvbnRyYWN0IHRoYXQgd2lsbCBiZSB1c2VkIGZvciB0aGUgY29udmVyc2lvbgogICAgS3liZXJOZXR3b3JrIHB1YmxpYyBreWJlckNvbnRyYWN0OwoKICAgIC8vIENvbnRyYWN0IGZvciB0aGUgRVJDMjAKICAgIEJ1cm5hYmxlRXJjMjAgcHVibGljIGRlc3RFcmMyMDsKCiAgICAvLy8gQHBhcmFtIF9kZXN0RXJjMjAgRGVzdGluYXRpb24gdG9rZW4KICAgIC8vLyBAcGFyYW0gX2t5YmVyQ29udHJhY3QgS3liZXIgY29udHJhY3QgdG8gdXNlCiAgICBmdW5jdGlvbiBCdXJuZXIoYWRkcmVzcyBfZGVzdEVyYzIwLCBhZGRyZXNzIF9reWJlckNvbnRyYWN0KSBwdWJsaWMgewogICAgICAgIC8vIENoZWNrIGlucHV0cwogICAgICAgIHJlcXVpcmUoX2Rlc3RFcmMyMCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9reWJlckNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBkZXN0RXJjMjAgPSBCdXJuYWJsZUVyYzIwKF9kZXN0RXJjMjApOwogICAgICAgIGt5YmVyQ29udHJhY3QgPSBLeWJlck5ldHdvcmsoX2t5YmVyQ29udHJhY3QpOwogICAgfQogICAgCiAgICAvLy8gRmFsbGJhY2sgZnVuY3Rpb24gdG8gcmVjZWl2ZSB0aGUgRVRIIHRvIGJ1cm4gbGF0ZXIKICAgIGZ1bmN0aW9uKCkgcHVibGljIHBheWFibGUgeyB9CgogICAgLy8vIEBkZXYgTWFpbiBmdW5jdGlvbi4gVHJhZGUgdGhlIEVUSCBmb3IgRVJDMjAgYW5kIGJ1cm4gdGhlbQogICAgLy8vIEBwYXJhbSBtYXhTcmNBbW91bnQgTWF4aW11bSBhbW91bnQgb2YgRVRIIHRvIGNvbnZlcnQuIElmIHNldCB0byAwLCBhbGwgRVRIIG9uIHRoZQogICAgLy8vICBjb250cmFjdCB3aWxsIGJlIGJ1cm5lZAogICAgLy8vIEBwYXJhbSBtYXhEZXN0QW1vdW50IEEgbGltaXQgb24gdGhlIGFtb3VudCBvZiBjb252ZXJ0ZWQgRVJDMjAgdG9rZW5zLiBEZWZhdWx0IHZhbHVlIGlzIE1BWF9VSU5UCiAgICAvLy8gQHBhcmFtIG1pbkNvbnZlcnNpb25SYXRlIFRoZSBtaW5pbWFsIGNvbnZlcnNpb24gcmF0ZS4gRGVmYXVsdCB2YWx1ZSBpcyAxIChtYXJrZXQgcmF0ZSkKICAgIC8vLyBAcmV0dXJuIGFtb3VudCBvZiBkZXN0IEVSQzIwIHRva2VucyBidXJuZWQKICAgIGZ1bmN0aW9uIGJ1cm4odWludCBtYXhTcmNBbW91bnQsIHVpbnQgbWF4RGVzdEFtb3VudCwgdWludCBtaW5Db252ZXJzaW9uUmF0ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zKHVpbnQpCiAgICB7CiAgICAgICAgLy8gRVRIIHRvIGNvbnZlcnQgb24gS3liZXIsIGJ5IGRlZmF1bHQgdGhlIGFtb3VudCBvZiBFVEggb24gdGhlIGNvbnRyYWN0CiAgICAgICAgLy8gSWYgbWF4U3JjQW1vdW50IGlzIGRlZmluZWQsIGV0aFRvQ29udmVydCA9IG1pbihiYWxhbmNlIG9uIGNvbnRyYWN0LCBtYXhTcmNBbW91bnQpCiAgICAgICAgdWludCBldGhUb0NvbnZlcnQgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAgaWYgKG1heFNyY0Ftb3VudCAhPSAwICYmIG1heFNyY0Ftb3VudCA8IGV0aFRvQ29udmVydCkgewogICAgICAgICAgICBldGhUb0NvbnZlcnQgPSBtYXhTcmNBbW91bnQ7CiAgICAgICAgfQoKICAgICAgICAvLyBTZXQgbWF4RGVzdEFtb3VudCB0byBNQVhfVUlOVCBpZiBub3Qgc2VudCBhcyBwYXJhbWV0ZXIKICAgICAgICBpZiAobWF4RGVzdEFtb3VudCA9PSAwKSB7CiAgICAgICAgICAgIG1heERlc3RBbW91bnQgPSAyKioyNTYgLSAxOwogICAgICAgIH0KCiAgICAgICAgLy8gU2V0IG1pbkNvbnZlcnNpb25SYXRlIHRvIDEgaWYgbm90IHNlbnQgYXMgcGFyYW1ldGVyCiAgICAgICAgLy8gQSB2YWx1ZSBvZiAxIHdpbGwgZXhlY3V0ZSB0aGUgdHJhZGUgYWNjb3JkaW5nIHRvIG1hcmtldCBwcmljZSBpbiB0aGUgdGltZSBvZiB0aGUgdHJhbnNhY3Rpb24gY29uZmlybWF0aW9uCiAgICAgICAgaWYgKG1pbkNvbnZlcnNpb25SYXRlID09IDApIHsKICAgICAgICAgICAgbWluQ29udmVyc2lvblJhdGUgPSAxOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29udmVydCB0aGUgRVRIIHRvIEVSQzIwCiAgICAgICAgLy8gZXJjMjBUb0J1cm4gaXMgdGhlIGFtb3VudCBvZiB0aGUgRVJDMjAgdG9rZW5zIGNvbnZlcnRlZCBieSBLeWJlciB0aGF0IHdpbGwgYmUgYnVybmVkCiAgICAgICAgdWludCBlcmMyMFRvQnVybiA9IGt5YmVyQ29udHJhY3QudHJhZGUudmFsdWUoZXRoVG9Db252ZXJ0KSgKICAgICAgICAgICAgLy8gU291cmNlLiBGcm9tIEt5YmVyIGRvY3MsIHRoaXMgdmFsdWUgZGVub3RlcyBFVEgKICAgICAgICAgICAgRVJDMjAoMHgwMGVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWVlZWUpLAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU291cmNlIGFtb3VudAogICAgICAgICAgICBldGhUb0NvbnZlcnQsCgogICAgICAgICAgICAvLyBEZXN0aW5hdGlvbi4gRG93bmNhc3QgQnVybmFibGVFcmMyMCB0byBFUkMyMAogICAgICAgICAgICBFUkMyMChkZXN0RXJjMjApLAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gZGVzdEFkZHJlc3M6IHRoaXMgY29udHJhY3QKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIG1heERlc3RBbW91bnQKICAgICAgICAgICAgbWF4RGVzdEFtb3VudCwKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIG1pbkNvbnZlcnNpb25SYXRlIAogICAgICAgICAgICBtaW5Db252ZXJzaW9uUmF0ZSwKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHdhbGxldElkCiAgICAgICAgICAgIDAKICAgICAgICApOwoKICAgICAgICAvLyBCdXJuIHRoZSBjb252ZXJ0ZWQgRVJDMjAgdG9rZW5zCiAgICAgICAgZGVzdEVyYzIwLmJ1cm4oZXJjMjBUb0J1cm4pOwoKICAgICAgICByZXR1cm4gZXJjMjBUb0J1cm47CiAgICB9Cn0='.
	

]
