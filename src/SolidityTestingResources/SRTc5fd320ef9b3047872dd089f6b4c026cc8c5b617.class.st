Class {
	#name : #SRTc5fd320ef9b3047872dd089f6b4c026cc8c5b617,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc5fd320ef9b3047872dd089f6b4c026cc8c5b617 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKiAgICAKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAqLwoKIAovLy8gQGRldiBgT3duZWRgIGlzIGEgYmFzZSBsZXZlbCBjb250cmFjdCB0aGF0IGFzc2lnbnMgYW4gYG93bmVyYCB0aGF0IGNhbiBiZQovLy8gIGxhdGVyIGNoYW5nZWQKY29udHJhY3QgT3duZWQgewoKICAgIC8vLyBAZGV2IGBvd25lcmAgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsIGEgZnVuY3Rpb24gd2l0aCB0aGlzCiAgICAvLy8gbW9kaWZpZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgogICAgLy8vIEBub3RpY2UgVGhlIENvbnN0cnVjdG9yIGFzc2lnbnMgdGhlIG1lc3NhZ2Ugc2VuZGVyIHRvIGJlIGBvd25lcmAKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICAvLy8gQG5vdGljZSBgb3duZXJgIGNhbiBzdGVwIGRvd24gYW5kIGFzc2lnbiBzb21lIG90aGVyIGFkZHJlc3MgdG8gdGhpcyByb2xlCiAgICAvLy8gQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IG93bmVyLiAweDAgY2FuIGJlIHVzZWQgdG8gY3JlYXRlCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBpZihtc2cuc2VuZGVyID09IG93bmVyKSB7CiAgICAgICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgICAgIH0KICAgIH0KfQoKCgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgoKCgoKCi8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucwpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgLy8vIEBub3RpY2UgQ2FsbGVkIHdoZW4gYF9vd25lcmAgc2VuZHMgZXRoZXIgdG8gdGhlIE1pbmlNZSBUb2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBzZW50IHRoZSBldGhlciB0byBjcmVhdGUgdG9rZW5zCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBldGhlciBpcyBhY2NlcHRlZCwgZmFsc2UgaWYgaXQgdGhyb3dzCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcmV0dXJucyhib29sKTsKCiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhIHRva2VuIHRyYW5zZmVyIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIG9yaWdpbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBkZXN0aW5hdGlvbiBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSB0cmFuc2ZlcgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50KSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGFuIGFwcHJvdmFsIGFsbG93aW5nIHRoZQogICAgLy8vICBjb250cm9sbGVyIHRvIHJlYWN0IGlmIGRlc2lyZWQKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgY2FsbHMgYGFwcHJvdmUoKWAKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIHNwZW5kZXIgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIGFwcHJvdmFsCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX2Ftb3VudCkKICAgICAgICByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBDb250cm9sbGVkIHsKICAgIC8vLyBAbm90aWNlIFRoZSBhZGRyZXNzIG9mIHRoZSBjb250cm9sbGVyIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbAogICAgLy8vICBhIGZ1bmN0aW9uIHdpdGggdGhpcyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgeyByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY29udHJvbGxlcik7IF87IH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cm9sbGVyOwoKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSB7IGNvbnRyb2xsZXIgPSBtc2cuc2VuZGVyO30KCiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBjb250cm9sbGVyID0gX25ld0NvbnRyb2xsZXI7CiAgICB9Cn0KCmNvbnRyYWN0IEFwcHJvdmVBbmRDYWxsRmFsbEJhY2sgewogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgZnJvbSwgdWludDI1NiBfYW1vdW50LCBhZGRyZXNzIF90b2tlbiwgYnl0ZXMgX2RhdGEpOwp9CgovLy8gQGRldiBUaGUgYWN0dWFsIHRva2VuIGNvbnRyYWN0LCB0aGUgZGVmYXVsdCBjb250cm9sbGVyIGlzIHRoZSBtc2cuc2VuZGVyCi8vLyAgdGhhdCBkZXBsb3lzIHRoZSBjb250cmFjdCwgc28gdXN1YWxseSB0aGlzIHRva2VuIHdpbGwgYmUgZGVwbG95ZWQgYnkgYQovLy8gIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QsIHdoaWNoIEdpdmV0aCB3aWxsIGNhbGwgYSAiQ2FtcGFpZ24iCmNvbnRyYWN0IE1pbmlNZVRva2VuIGlzIENvbnRyb2xsZWQgewoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsgICAgICAgICAgICAgICAgLy9UaGUgVG9rZW4ncyBuYW1lOiBlLmcuIERpZ2l4REFPIFRva2VucwogICAgdWludDggcHVibGljIGRlY2ltYWxzOyAgICAgICAgICAgICAvL051bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7ICAgICAgICAgICAgICAvL0FuIGlkZW50aWZpZXI6IGUuZy4gUkVQCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnTU1UXzAuMSc7IC8vQW4gYXJiaXRyYXJ5IHZlcnNpb25pbmcgc2NoZW1lCgoKICAgIC8vLyBAZGV2IGBDaGVja3BvaW50YCBpcyB0aGUgc3RydWN0dXJlIHRoYXQgYXR0YWNoZXMgYSBibG9jayBudW1iZXIgdG8gYQogICAgLy8vICBnaXZlbiB2YWx1ZSwgdGhlIGJsb2NrIG51bWJlciBhdHRhY2hlZCBpcyB0aGUgb25lIHRoYXQgbGFzdCBjaGFuZ2VkIHRoZQogICAgLy8vICB2YWx1ZQogICAgc3RydWN0ICBDaGVja3BvaW50IHsKCiAgICAgICAgLy8gYGZyb21CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGZyb20KICAgICAgICB1aW50MTI4IGZyb21CbG9jazsKCiAgICAgICAgLy8gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGJsb2NrIG51bWJlcgogICAgICAgIHVpbnQxMjggdmFsdWU7CiAgICB9CgogICAgLy8gYHBhcmVudFRva2VuYCBpcyB0aGUgVG9rZW4gYWRkcmVzcyB0aGF0IHdhcyBjbG9uZWQgdG8gcHJvZHVjZSB0aGlzIHRva2VuOwogICAgLy8gIGl0IHdpbGwgYmUgMHgwIGZvciBhIHRva2VuIHRoYXQgd2FzIG5vdCBjbG9uZWQKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBwYXJlbnRUb2tlbjsKCiAgICAvLyBgcGFyZW50U25hcFNob3RCbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciBmcm9tIHRoZSBQYXJlbnQgVG9rZW4gdGhhdCB3YXMKICAgIC8vICB1c2VkIHRvIGRldGVybWluZSB0aGUgaW5pdGlhbCBkaXN0cmlidXRpb24gb2YgdGhlIENsb25lIFRva2VuCiAgICB1aW50IHB1YmxpYyBwYXJlbnRTbmFwU2hvdEJsb2NrOwoKICAgIC8vIGBjcmVhdGlvbkJsb2NrYCBpcyB0aGUgYmxvY2sgbnVtYmVyIHRoYXQgdGhlIENsb25lIFRva2VuIHdhcyBjcmVhdGVkCiAgICB1aW50IHB1YmxpYyBjcmVhdGlvbkJsb2NrOwoKICAgIC8vIGBiYWxhbmNlc2AgaXMgdGhlIG1hcCB0aGF0IHRyYWNrcyB0aGUgYmFsYW5jZSBvZiBlYWNoIGFkZHJlc3MsIGluIHRoaXMKICAgIC8vICBjb250cmFjdCB3aGVuIHRoZSBiYWxhbmNlIGNoYW5nZXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBjaGFuZ2UKICAgIC8vICBvY2N1cnJlZCBpcyBhbHNvIGluY2x1ZGVkIGluIHRoZSBtYXAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQ2hlY2twb2ludFtdKSBiYWxhbmNlczsKCiAgICAvLyBgYWxsb3dlZGAgdHJhY2tzIGFueSBleHRyYSB0cmFuc2ZlciByaWdodHMgYXMgaW4gYWxsIEVSQzIwIHRva2VucwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhbGxvd2VkOwoKICAgIC8vIFRyYWNrcyB0aGUgaGlzdG9yeSBvZiB0aGUgYHRvdGFsU3VwcGx5YCBvZiB0aGUgdG9rZW4KICAgIENoZWNrcG9pbnRbXSB0b3RhbFN1cHBseUhpc3Rvcnk7CgogICAgLy8gRmxhZyB0aGF0IGRldGVybWluZXMgaWYgdGhlIHRva2VuIGlzIHRyYW5zZmVyYWJsZSBvciBub3QuCiAgICBib29sIHB1YmxpYyB0cmFuc2ZlcnNFbmFibGVkOwoKICAgIC8vIFRoZSBmYWN0b3J5IHVzZWQgdG8gY3JlYXRlIG5ldyBjbG9uZSB0b2tlbnMKICAgIE1pbmlNZVRva2VuRmFjdG9yeSBwdWJsaWMgdG9rZW5GYWN0b3J5OwoKLy8vLy8vLy8vLy8vLy8vLwovLyBDb25zdHJ1Y3RvcgovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgTWluaU1lVG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuRmFjdG9yeSBUaGUgYWRkcmVzcyBvZiB0aGUgTWluaU1lVG9rZW5GYWN0b3J5IGNvbnRyYWN0IHRoYXQKICAgIC8vLyAgd2lsbCBjcmVhdGUgdGhlIENsb25lIHRva2VuIGNvbnRyYWN0cywgdGhlIHRva2VuIGZhY3RvcnkgbmVlZHMgdG8gYmUKICAgIC8vLyAgZGVwbG95ZWQgZmlyc3QKICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHBhcmVudCB0b2tlbiwgc2V0IHRvIDB4MCBpZiBpdCBpcyBhCiAgICAvLy8gIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfcGFyZW50U25hcFNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbiwgc2V0IHRvIDAgaWYgaXQKICAgIC8vLyAgaXMgYSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBOYW1lIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2RlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5TeW1ib2wgVG9rZW4gU3ltYm9sIGZvciB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIElmIHRydWUsIHRva2VucyB3aWxsIGJlIGFibGUgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIE1pbmlNZVRva2VuKAogICAgICAgIGFkZHJlc3MgX3Rva2VuRmFjdG9yeSwKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9wYXJlbnRTbmFwU2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHsKICAgICAgICB0b2tlbkZhY3RvcnkgPSBNaW5pTWVUb2tlbkZhY3RvcnkoX3Rva2VuRmFjdG9yeSk7CiAgICAgICAgbmFtZSA9IF90b2tlbk5hbWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBuYW1lCiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbFVuaXRzOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZWNpbWFscwogICAgICAgIHN5bWJvbCA9IF90b2tlblN5bWJvbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgc3ltYm9sCiAgICAgICAgcGFyZW50VG9rZW4gPSBNaW5pTWVUb2tlbihfcGFyZW50VG9rZW4pOwogICAgICAgIHBhcmVudFNuYXBTaG90QmxvY2sgPSBfcGFyZW50U25hcFNob3RCbG9jazsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICAgICAgY3JlYXRpb25CbG9jayA9IGJsb2NrLm51bWJlcjsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEVSQzIwIE1ldGhvZHMKLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bCBvciBub3QKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGBfYW1vdW50YCB0b2tlbnMgdG8gYF90b2AgZnJvbSBgX2Zyb21gIG9uIHRoZSBjb25kaXRpb24gaXQKICAgIC8vLyAgaXMgYXBwcm92ZWQgYnkgYF9mcm9tYAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50CiAgICApIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewoKICAgICAgICAvLyBUaGUgY29udHJvbGxlciBvZiB0aGlzIGNvbnRyYWN0IGNhbiBtb3ZlIHRva2VucyBhcm91bmQgYXQgd2lsbCwKICAgICAgICAvLyAgdGhpcyBpcyBpbXBvcnRhbnQgdG8gcmVjb2duaXplISBDb25maXJtIHRoYXQgeW91IHRydXN0IHRoZQogICAgICAgIC8vICBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QsIHdoaWNoIGluIG1vc3Qgc2l0dWF0aW9ucyBzaG91bGQgYmUKICAgICAgICAvLyAgYW5vdGhlciBvcGVuIHNvdXJjZSBzbWFydCBjb250cmFjdCBvciAweDAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBjb250cm9sbGVyKSB7CiAgICAgICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgICAgICAvLyBUaGUgc3RhbmRhcmQgRVJDIDIwIHRyYW5zZmVyRnJvbSBmdW5jdGlvbmFsaXR5CiAgICAgICAgICAgIGlmIChhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA8IF9hbW91bnQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX2Ftb3VudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRvVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBpcyB0aGUgYWN0dWFsIHRyYW5zZmVyIGZ1bmN0aW9uIGluIHRoZSB0b2tlbiBjb250cmFjdCwgaXQgY2FuCiAgICAvLy8gIG9ubHkgYmUgY2FsbGVkIGJ5IG90aGVyIGZ1bmN0aW9ucyBpbiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyBob2xkaW5nIHRoZSB0b2tlbnMgYmVpbmcgdHJhbnNmZXJyZWQKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIGRvVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudAogICAgKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKCiAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICB9CgogICAgICAgICAgIHJlcXVpcmUocGFyZW50U25hcFNob3RCbG9jayA8IGJsb2NrLm51bWJlcik7CgogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZgogICAgICAgICAgIHJlcXVpcmUoKF90byAhPSAwKSAmJiAoX3RvICE9IGFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgICAgLy8gSWYgdGhlIGFtb3VudCBiZWluZyB0cmFuc2ZlcmVkIGlzIG1vcmUgdGhhbiB0aGUgYmFsYW5jZSBvZiB0aGUKICAgICAgICAgICAvLyAgYWNjb3VudCB0aGUgdHJhbnNmZXIgcmV0dXJucyBmYWxzZQogICAgICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mQXQoX2Zyb20sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB7CiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXIKICAgICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vblRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpKTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHNlbmRpbmcgdGhlIHRva2VucwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CgogICAgICAgICAgIC8vIFRoZW4gdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGJsb2NrLm51bWJlcik7CiAgICAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW190b10sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CgogICAgICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRyYW5zZmVyIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpOwoKICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0J3MgYmFsYW5jZSBpcyBiZWluZyByZXF1ZXN0ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIGBfb3duZXJgIGF0IHRoZSBjdXJyZW50IGJsb2NrCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlT2ZBdChfb3duZXIsIGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJlcXVpcmUodHJhbnNmZXJzRW5hYmxlZCk7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIHJlcXVpcmUoKF9hbW91bnQgPT0gMCkgfHwgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID09IDApKTsKCiAgICAgICAgLy8gQWxlcnRzIHRoZSB0b2tlbiBjb250cm9sbGVyIG9mIHRoZSBhcHByb3ZlIGZ1bmN0aW9uIGNhbGwKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICByZXF1aXJlKFRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vbkFwcHJvdmUobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcwogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bwogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhcHByb3ZlKF9zcGVuZGVyLCBfYW1vdW50KSk7CgogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChibG9jay5udW1iZXIpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8KLy8gUXVlcnkgYmFsYW5jZSBhbmQgdG90YWxTdXBwbHkgaW4gSGlzdG9yeQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgUXVlcmllcyB0aGUgYmFsYW5jZSBvZiBgX293bmVyYCBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBmcm9tIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgcmV0cmlldmVkCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIGJhbGFuY2UgaXMgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UgYXQgYF9ibG9ja051bWJlcmAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIGJhbGFuY2Ugb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4uYmFsYW5jZU9mQXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoYXQgdG9rZW4gYXMgdGhpcyBjb250YWlucyBpbml0aWFsIGJhbGFuY2Ugb2YKICAgICAgICAvLyAgdGhpcyB0b2tlbgogICAgICAgIGlmICgoYmFsYW5jZXNbX293bmVyXS5sZW5ndGggPT0gMCkKICAgICAgICAgICAgfHwgKGJhbGFuY2VzW19vd25lcl1bMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLmJhbGFuY2VPZkF0KF9vd25lciwgbWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSGFzIG5vIHBhcmVudAogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgYmFsYW5jZSBkdXJpbmcgbm9ybWFsIHNpdHVhdGlvbnMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VmFsdWVBdChiYWxhbmNlc1tfb3duZXJdLCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBUb3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGEgc3BlY2lmaWMgYF9ibG9ja051bWJlcmAuCiAgICAvLy8gQHBhcmFtIF9ibG9ja051bWJlciBUaGUgYmxvY2sgbnVtYmVyIHdoZW4gdGhlIHRvdGFsU3VwcGx5IGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBhbW91bnQgb2YgdG9rZW5zIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKCiAgICAgICAgLy8gVGhlc2UgbmV4dCBmZXcgbGluZXMgYXJlIHVzZWQgd2hlbiB0aGUgdG90YWxTdXBwbHkgb2YgdGhlIHRva2VuIGlzCiAgICAgICAgLy8gIHJlcXVlc3RlZCBiZWZvcmUgYSBjaGVjayBwb2ludCB3YXMgZXZlciBjcmVhdGVkIGZvciB0aGlzIHRva2VuLCBpdAogICAgICAgIC8vICByZXF1aXJlcyB0aGF0IHRoZSBgcGFyZW50VG9rZW4udG90YWxTdXBwbHlBdGAgYmUgcXVlcmllZCBhdCB0aGUKICAgICAgICAvLyAgZ2VuZXNpcyBibG9jayBmb3IgdGhpcyB0b2tlbiBhcyB0aGF0IGNvbnRhaW5zIHRvdGFsU3VwcGx5IG9mIHRoaXMKICAgICAgICAvLyAgdG9rZW4gYXQgdGhpcyBibG9jayBudW1iZXIuCiAgICAgICAgaWYgKCh0b3RhbFN1cHBseUhpc3RvcnkubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8ICh0b3RhbFN1cHBseUhpc3RvcnlbMF0uZnJvbUJsb2NrID4gX2Jsb2NrTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoYWRkcmVzcyhwYXJlbnRUb2tlbikgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXQobWluKF9ibG9ja051bWJlciwgcGFyZW50U25hcFNob3RCbG9jaykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgLy8gVGhpcyB3aWxsIHJldHVybiB0aGUgZXhwZWN0ZWQgdG90YWxTdXBwbHkgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQodG90YWxTdXBwbHlIaXN0b3J5LCBfYmxvY2tOdW1iZXIpOwogICAgICAgIH0KICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ2xvbmUgVG9rZW4gTWV0aG9kCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBDcmVhdGVzIGEgbmV3IGNsb25lIHRva2VuIHdpdGggdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIGJlaW5nCiAgICAvLy8gIHRoaXMgdG9rZW4gYXQgYF9zbmFwc2hvdEJsb2NrYAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlbk5hbWUgTmFtZSBvZiB0aGUgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX2Nsb25lRGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgc21hbGxlc3QgdW5pdAogICAgLy8vIEBwYXJhbSBfY2xvbmVUb2tlblN5bWJvbCBTeW1ib2wgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9zbmFwc2hvdEJsb2NrIEJsb2NrIHdoZW4gdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgcGFyZW50IHRva2VuIGlzCiAgICAvLy8gIGNvcGllZCB0byBzZXQgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBuZXcgY2xvbmUgdG9rZW47CiAgICAvLy8gIGlmIHRoZSBibG9jayBpcyB6ZXJvIHRoYW4gdGhlIGFjdHVhbCBibG9jaywgdGhlIGN1cnJlbnQgYmxvY2sgaXMgdXNlZAogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBUcnVlIGlmIHRyYW5zZmVycyBhcmUgYWxsb3dlZCBpbiB0aGUgY2xvbmUKICAgIC8vLyBAcmV0dXJuIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgTWluaU1lVG9rZW4gQ29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lVG9rZW4oCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgIHVpbnQgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICkgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgaWYgKF9zbmFwc2hvdEJsb2NrID09IDApIF9zbmFwc2hvdEJsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgIE1pbmlNZVRva2VuIGNsb25lVG9rZW4gPSB0b2tlbkZhY3RvcnkuY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF9jbG9uZVRva2VuTmFtZSwKICAgICAgICAgICAgX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgICAgICBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgY2xvbmVUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwoKICAgICAgICAvLyBBbiBldmVudCB0byBtYWtlIHRoZSB0b2tlbiBlYXN5IHRvIGZpbmQgb24gdGhlIGJsb2NrY2hhaW4KICAgICAgICBOZXdDbG9uZVRva2VuKGFkZHJlc3MoY2xvbmVUb2tlbiksIF9zbmFwc2hvdEJsb2NrKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyhjbG9uZVRva2VuKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gR2VuZXJhdGUgYW5kIGRlc3Ryb3kgdG9rZW5zCi8vLy8vLy8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBHZW5lcmF0ZXMgYF9hbW91bnRgIHRva2VucyB0aGF0IGFyZSBhc3NpZ25lZCB0byBgX293bmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCB3aWxsIGJlIGFzc2lnbmVkIHRoZSBuZXcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyBnZW5lcmF0ZWQKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgZ2VuZXJhdGVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSArIF9hbW91bnQgPj0gY3VyVG90YWxTdXBwbHkpOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZVRvID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgcmVxdWlyZShwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPj0gcHJldmlvdXNCYWxhbmNlVG8pOyAvLyBDaGVjayBmb3Igb3ZlcmZsb3cKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KHRvdGFsU3VwcGx5SGlzdG9yeSwgY3VyVG90YWxTdXBwbHkgKyBfYW1vdW50KTsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZVRvICsgX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoMCwgX293bmVyLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgQnVybnMgYF9hbW91bnRgIHRva2VucyBmcm9tIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgbG9zZSB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIHF1YW50aXR5IG9mIHRva2VucyB0byBidXJuCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0b2tlbnMgYXJlIGJ1cm5lZCBjb3JyZWN0bHkKICAgIGZ1bmN0aW9uIGRlc3Ryb3lUb2tlbnMoYWRkcmVzcyBfb3duZXIsIHVpbnQgX2Ftb3VudAogICAgKSBvbmx5Q29udHJvbGxlciByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBjdXJUb3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5KCk7CiAgICAgICAgcmVxdWlyZShjdXJUb3RhbFN1cHBseSA+PSBfYW1vdW50KTsKICAgICAgICB1aW50IHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2YoX293bmVyKTsKICAgICAgICByZXF1aXJlKHByZXZpb3VzQmFsYW5jZUZyb20gPj0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyh0b3RhbFN1cHBseUhpc3RvcnksIGN1clRvdGFsU3VwcGx5IC0gX2Ftb3VudCk7CiAgICAgICAgdXBkYXRlVmFsdWVBdE5vdyhiYWxhbmNlc1tfb3duZXJdLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CiAgICAgICAgVHJhbnNmZXIoX293bmVyLCAwLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRW5hYmxlIHRva2VucyB0cmFuc2ZlcnMKLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAvLy8gQG5vdGljZSBFbmFibGVzIHRva2VuIGhvbGRlcnMgdG8gdHJhbnNmZXIgdGhlaXIgdG9rZW5zIGZyZWVseSBpZiB0cnVlCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcnNFbmFibGVkIFRydWUgaWYgdHJhbnNmZXJzIGFyZSBhbGxvd2VkIGluIHRoZSBjbG9uZQogICAgZnVuY3Rpb24gZW5hYmxlVHJhbnNmZXJzKGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQpIG9ubHlDb250cm9sbGVyIHsKICAgICAgICB0cmFuc2ZlcnNFbmFibGVkID0gX3RyYW5zZmVyc0VuYWJsZWQ7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEludGVybmFsIGhlbHBlciBmdW5jdGlvbnMgdG8gcXVlcnkgYW5kIHNldCBhIHZhbHVlIGluIGEgc25hcHNob3QgYXJyYXkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IGBnZXRWYWx1ZUF0YCByZXRyaWV2ZXMgdGhlIG51bWJlciBvZiB0b2tlbnMgYXQgYSBnaXZlbiBibG9jayBudW1iZXIKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgdmFsdWVzIGJlaW5nIHF1ZXJpZWQKICAgIC8vLyBAcGFyYW0gX2Jsb2NrIFRoZSBibG9jayBudW1iZXIgdG8gcmV0cmlldmUgdGhlIHZhbHVlIGF0CiAgICAvLy8gQHJldHVybiBUaGUgbnVtYmVyIG9mIHRva2VucyBiZWluZyBxdWVyaWVkCiAgICBmdW5jdGlvbiBnZXRWYWx1ZUF0KENoZWNrcG9pbnRbXSBzdG9yYWdlIGNoZWNrcG9pbnRzLCB1aW50IF9ibG9jawogICAgKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKSByZXR1cm4gMDsKCiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIHRoZSBhY3R1YWwgdmFsdWUKICAgICAgICBpZiAoX2Jsb2NrID49IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS5mcm9tQmxvY2spCiAgICAgICAgICAgIHJldHVybiBjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGgtMV0udmFsdWU7CiAgICAgICAgaWYgKF9ibG9jayA8IGNoZWNrcG9pbnRzWzBdLmZyb21CbG9jaykgcmV0dXJuIDA7CgogICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb2YgdGhlIHZhbHVlIGluIHRoZSBhcnJheQogICAgICAgIHVpbnQgbWluID0gMDsKICAgICAgICB1aW50IG1heCA9IGNoZWNrcG9pbnRzLmxlbmd0aC0xOwogICAgICAgIHdoaWxlIChtYXggPiBtaW4pIHsKICAgICAgICAgICAgdWludCBtaWQgPSAobWF4ICsgbWluICsgMSkvIDI7CiAgICAgICAgICAgIGlmIChjaGVja3BvaW50c1ttaWRdLmZyb21CbG9jazw9X2Jsb2NrKSB7CiAgICAgICAgICAgICAgICBtaW4gPSBtaWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXggPSBtaWQtMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2hlY2twb2ludHNbbWluXS52YWx1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBgdXBkYXRlVmFsdWVBdE5vd2AgdXNlZCB0byB1cGRhdGUgdGhlIGBiYWxhbmNlc2AgbWFwIGFuZCB0aGUKICAgIC8vLyAgYHRvdGFsU3VwcGx5SGlzdG9yeWAKICAgIC8vLyBAcGFyYW0gY2hlY2twb2ludHMgVGhlIGhpc3Rvcnkgb2YgZGF0YSBiZWluZyB1cGRhdGVkCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgbmV3IG51bWJlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHVwZGF0ZVZhbHVlQXROb3coQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX3ZhbHVlCiAgICApIGludGVybmFsICB7CiAgICAgICAgaWYgKChjaGVja3BvaW50cy5sZW5ndGggPT0gMCkKICAgICAgICB8fCAoY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoIC0xXS5mcm9tQmxvY2sgPCBibG9jay5udW1iZXIpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgc3RvcmFnZSBuZXdDaGVja1BvaW50ID0gY2hlY2twb2ludHNbIGNoZWNrcG9pbnRzLmxlbmd0aCsrIF07CiAgICAgICAgICAgICAgIG5ld0NoZWNrUG9pbnQuZnJvbUJsb2NrID0gIHVpbnQxMjgoYmxvY2subnVtYmVyKTsKICAgICAgICAgICAgICAgbmV3Q2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICBDaGVja3BvaW50IHN0b3JhZ2Ugb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uOiBJZiB0aGUgY29udHJhY3QncyBjb250cm9sbGVyIGhhcyBub3QgYmVlbgogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlCiAgICAvLy8gIGV0aGVyIGFuZCBjcmVhdGVzIHRva2VucyBhcyBkZXNjcmliZWQgaW4gdGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QKICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKGlzQ29udHJhY3QoY29udHJvbGxlcikpOwogICAgICAgIHJlcXVpcmUoVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLnByb3h5UGF5bWVudC52YWx1ZShtc2cudmFsdWUpKG1zZy5zZW5kZXIpKTsKICAgIH0KCi8vLy8vLy8vLy8KLy8gU2FmZXR5IE1ldGhvZHMKLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQogICAgLy8vICBzZW50IHRva2VucyB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogICAgLy8vICBzZXQgdG8gMCBpbiBjYXNlIHlvdSB3YW50IHRvIGV4dHJhY3QgZXRoZXIuCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgb25seUNvbnRyb2xsZXIgewogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIGNvbnRyb2xsZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTWluaU1lVG9rZW4gdG9rZW4gPSBNaW5pTWVUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgY29udHJvbGxlciwgYmFsYW5jZSk7CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIEV2ZW50cwovLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSAKICAgIHsKICAgICAgICBNaW5pTWVUb2tlbiBuZXdUb2tlbiA9IG5ldyBNaW5pTWVUb2tlbigKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX3BhcmVudFRva2VuLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX3Rva2VuTmFtZSwKICAgICAgICAgICAgX2RlY2ltYWxVbml0cywKICAgICAgICAgICAgX3Rva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwoKICAgICAgICBuZXdUb2tlbi5jaGFuZ2VDb250cm9sbGVyKG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiBuZXdUb2tlbjsKICAgIH0KfQoKCmNvbnRyYWN0IFNIUCBpcyBNaW5pTWVUb2tlbiB7CiAgICAvLyBAZGV2IFNIUCBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU0hQKGFkZHJlc3MgX3Rva2VuRmFjdG9yeSkKICAgICAgICAgICAgTWluaU1lVG9rZW4oCiAgICAgICAgICAgICAgICBfdG9rZW5GYWN0b3J5LAogICAgICAgICAgICAgICAgMHgwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gcGFyZW50IHRva2VuCiAgICAgICAgICAgICAgICAwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBubyBzbmFwc2hvdCBibG9jayBudW1iZXIgZnJvbSBwYXJlbnQKICAgICAgICAgICAgICAgICJTaGFycGUgUGxhdGZvcm0gVG9rZW4iLCAgICAgICAgIC8vIFRva2VuIG5hbWUKICAgICAgICAgICAgICAgIDE4LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlY2ltYWxzCiAgICAgICAgICAgICAgICAiU0hQIiwgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTeW1ib2wKICAgICAgICAgICAgICAgIHRydWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZSB0cmFuc2ZlcnMKICAgICAgICAgICAgKSB7fQp9CgoKCgoKLy8vIEB0aXRsZSBWZXN0aW5nIHRydXN0ZWUKY29udHJhY3QgVHJ1c3RlZSBpcyBPd25lZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgU0hQIEVSQzIwIHRva2VuLgogICAgU0hQIHB1YmxpYyBzaHA7CgogICAgc3RydWN0IEdyYW50IHsKICAgICAgICB1aW50MjU2IHZhbHVlOwogICAgICAgIHVpbnQyNTYgc3RhcnQ7CiAgICAgICAgdWludDI1NiBjbGlmZjsKICAgICAgICB1aW50MjU2IGVuZDsKICAgICAgICB1aW50MjU2IHRyYW5zZmVycmVkOwogICAgICAgIGJvb2wgcmV2b2thYmxlOwogICAgfQoKICAgIC8vIEdyYW50cyBob2xkZXIuCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IEdyYW50KSBwdWJsaWMgZ3JhbnRzOwoKICAgIC8vIFRvdGFsIHRva2VucyBhdmFpbGFibGUgZm9yIHZlc3RpbmcuCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFZlc3Rpbmc7CgogICAgZXZlbnQgTmV3R3JhbnQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBVbmxvY2tHcmFudChhZGRyZXNzIGluZGV4ZWQgX2hvbGRlciwgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgUmV2b2tlR3JhbnQoYWRkcmVzcyBpbmRleGVkIF9ob2xkZXIsIHVpbnQyNTYgX3JlZnVuZCk7CgogICAgLy8vIEBkZXYgQ29uc3RydWN0b3IgdGhhdCBpbml0aWFsaXplcyB0aGUgYWRkcmVzcyBvZiB0aGUgU0hQIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfc2hwIFNIUCBUaGUgYWRkcmVzcyBvZiB0aGUgcHJldmlvdXNseSBkZXBsb3llZCBTSFAgc21hcnQgY29udHJhY3QuCiAgICBmdW5jdGlvbiBUcnVzdGVlKFNIUCBfc2hwKSB7CiAgICAgICAgcmVxdWlyZShfc2hwICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHNocCA9IF9zaHA7CiAgICB9CgogICAgLy8vIEBkZXYgR3JhbnQgdG9rZW5zIHRvIGEgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHRvIGdyYW50IHRva2VucyB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgZ3JhbnRlZC4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0IHVpbnQyNTYgVGhlIGJlZ2lubmluZyBvZiB0aGUgdmVzdGluZyBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9jbGlmZiB1aW50MjU2IER1cmF0aW9uIG9mIHRoZSBjbGlmZiBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF9lbmQgdWludDI1NiBUaGUgZW5kIG9mIHRoZSB2ZXN0aW5nIHBlcmlvZC4KICAgIC8vLyBAcGFyYW0gX3Jldm9rYWJsZSBib29sIFdoZXRoZXIgdGhlIGdyYW50IGlzIHJldm9rYWJsZSBvciBub3QuCiAgICBmdW5jdGlvbiBncmFudChhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9jbGlmZiwgdWludDI1NiBfZW5kLCBib29sIF9yZXZva2FibGUpCiAgICAgICAgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgYSBzaW5nbGUgYWRkcmVzcyBjYW4gYmUgZ3JhbnRlZCB0b2tlbnMgb25seSBvbmNlLgogICAgICAgIHJlcXVpcmUoZ3JhbnRzW190b10udmFsdWUgPT0gMCk7CgogICAgICAgIC8vIENoZWNrIGZvciBkYXRlIGluY29uc2lzdGVuY2llcyB0aGF0IG1heSBjYXVzZSB1bmV4cGVjdGVkIGJlaGF2aW9yLgogICAgICAgIHJlcXVpcmUoX3N0YXJ0IDw9IF9jbGlmZiAmJiBfY2xpZmYgPD0gX2VuZCk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgdGhpcyBncmFudCBkb2Vzbid0IGV4Y2VlZCB0aGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBjdXJyZW50bHkgYXZhaWxhYmxlIGZvciB2ZXN0aW5nLgogICAgICAgIHJlcXVpcmUodG90YWxWZXN0aW5nLmFkZChfdmFsdWUpIDw9IHNocC5iYWxhbmNlT2YoYWRkcmVzcyh0aGlzKSkpOwoKICAgICAgICAvLyBBc3NpZ24gYSBuZXcgZ3JhbnQuCiAgICAgICAgZ3JhbnRzW190b10gPSBHcmFudCh7CiAgICAgICAgICAgIHZhbHVlOiBfdmFsdWUsCiAgICAgICAgICAgIHN0YXJ0OiBfc3RhcnQsCiAgICAgICAgICAgIGNsaWZmOiBfY2xpZmYsCiAgICAgICAgICAgIGVuZDogX2VuZCwKICAgICAgICAgICAgdHJhbnNmZXJyZWQ6IDAsCiAgICAgICAgICAgIHJldm9rYWJsZTogX3Jldm9rYWJsZQogICAgICAgIH0pOwoKICAgICAgICAvLyBUb2tlbnMgZ3JhbnRlZCwgcmVkdWNlIHRoZSB0b3RhbCBhbW91bnQgYXZhaWxhYmxlIGZvciB2ZXN0aW5nLgogICAgICAgIHRvdGFsVmVzdGluZyA9IHRvdGFsVmVzdGluZy5hZGQoX3ZhbHVlKTsKCiAgICAgICAgTmV3R3JhbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IFJldm9rZSB0aGUgZ3JhbnQgb2YgdG9rZW5zIG9mIGEgc3BlY2lmZWQgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIGhhdmUgaXRzIHRva2VucyByZXZva2VkLgogICAgZnVuY3Rpb24gcmV2b2tlKGFkZHJlc3MgX2hvbGRlcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl07CgogICAgICAgIHJlcXVpcmUoZ3JhbnQucmV2b2thYmxlKTsKCiAgICAgICAgLy8gU2VuZCB0aGUgcmVtYWluaW5nIFNIUCBiYWNrIHRvIHRoZSBvd25lci4KICAgICAgICB1aW50MjU2IHJlZnVuZCA9IGdyYW50LnZhbHVlLnN1YihncmFudC50cmFuc2ZlcnJlZCk7CgogICAgICAgIC8vIFJlbW92ZSB0aGUgZ3JhbnQuCiAgICAgICAgZGVsZXRlIGdyYW50c1tfaG9sZGVyXTsKCiAgICAgICAgdG90YWxWZXN0aW5nID0gdG90YWxWZXN0aW5nLnN1YihyZWZ1bmQpOwogICAgICAgIHNocC50cmFuc2Zlcihtc2cuc2VuZGVyLCByZWZ1bmQpOwoKICAgICAgICBSZXZva2VHcmFudChfaG9sZGVyLCByZWZ1bmQpOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgdG90YWwgYW1vdW50IG9mIHZlc3RlZCB0b2tlbnMgb2YgYSBob2xkZXIgYXQgYSBnaXZlbiB0aW1lLgogICAgLy8vIEBwYXJhbSBfaG9sZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgb2YgdGhlIGhvbGRlci4KICAgIC8vLyBAcGFyYW0gX3RpbWUgdWludDI1NiBUaGUgc3BlY2lmaWMgdGltZS4KICAgIC8vLyBAcmV0dXJuIGEgdWludDI1NiByZXByZXNlbnRpbmcgYSBob2xkZXIncyB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2Vucy4KICAgIGZ1bmN0aW9uIHZlc3RlZFRva2VucyhhZGRyZXNzIF9ob2xkZXIsIHVpbnQyNTYgX3RpbWUpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgR3JhbnQgZ3JhbnQgPSBncmFudHNbX2hvbGRlcl07CiAgICAgICAgaWYgKGdyYW50LnZhbHVlID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKGdyYW50LCBfdGltZSk7CiAgICB9CgogICAgLy8vIEBkZXYgQ2FsY3VsYXRlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIGF0IGEgc3BlY2lmYyB0aW1lLgogICAgLy8vIEBwYXJhbSBfZ3JhbnQgR3JhbnQgVGhlIHZlc3RpbmcgZ3JhbnQuCiAgICAvLy8gQHBhcmFtIF90aW1lIHVpbnQyNTYgVGhlIHRpbWUgdG8gYmUgY2hlY2tlZAogICAgLy8vIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIG9mIGEgc3BlY2lmaWMgZ3JhbnQuCiAgICAvLy8gICB8ICAgICAgICAgICAgICAgICAgICAgICAgIF8vLS0tLS0tLS0gICB2ZXN0ZWRUb2tlbnMgcmVjdAogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgICAgICBfLwogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgICBfLwogICAgLy8vICAgfCAgICAgICAgICAgICAgICAgXy8KICAgIC8vLyAgIHwgICAgICAgICAgICAgICAgLwogICAgLy8vICAgfCAgICAgICAgICAgICAgLnwKICAgIC8vLyAgIHwgICAgICAgICAgICAuICB8CiAgICAvLy8gICB8ICAgICAgICAgIC4gICAgfAogICAgLy8vICAgfCAgICAgICAgLiAgICAgIHwKICAgIC8vLyAgIHwgICAgICAuICAgICAgICB8CiAgICAvLy8gICB8ICAgIC4gICAgICAgICAgfAogICAgLy8vICAgKz09PSs9PT09PT09PT09PSstLS0tLS0tLS0rLS0tLS0tLS0tLT4gdGltZQogICAgLy8vICAgICBTdGFydCAgICAgICBDbGlmZiAgICAgIEVuZAogICAgZnVuY3Rpb24gY2FsY3VsYXRlVmVzdGVkVG9rZW5zKEdyYW50IF9ncmFudCwgdWludDI1NiBfdGltZSkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gSWYgd2UncmUgYmVmb3JlIHRoZSBjbGlmZiwgdGhlbiBub3RoaW5nIGlzIHZlc3RlZC4KICAgICAgICBpZiAoX3RpbWUgPCBfZ3JhbnQuY2xpZmYpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB3ZSdyZSBhZnRlciB0aGUgZW5kIG9mIHRoZSB2ZXN0aW5nIHBlcmlvZCAtIGV2ZXJ5dGhpbmcgaXMgdmVzdGVkOwogICAgICAgIGlmIChfdGltZSA+PSBfZ3JhbnQuZW5kKSB7CiAgICAgICAgICAgIHJldHVybiBfZ3JhbnQudmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLyBJbnRlcnBvbGF0ZSBhbGwgdmVzdGVkIHRva2VuczogdmVzdGVkVG9rZW5zID0gdG9rZW5zLy8vICh0aW1lIC0gc3RhcnQpIC8gKGVuZCAtIHN0YXJ0KQogICAgICAgICByZXR1cm4gX2dyYW50LnZhbHVlLm11bChfdGltZS5zdWIoX2dyYW50LnN0YXJ0KSkuZGl2KF9ncmFudC5lbmQuc3ViKF9ncmFudC5zdGFydCkpOwogICAgfQoKICAgIC8vLyBAZGV2IFVubG9jayB2ZXN0ZWQgdG9rZW5zIGFuZCB0cmFuc2ZlciB0aGVtIHRvIHRoZWlyIGhvbGRlci4KICAgIC8vLyBAcmV0dXJuIGEgdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvZiB2ZXN0ZWQgdG9rZW5zIHRyYW5zZmVycmVkIHRvIHRoZWlyIGhvbGRlci4KICAgIGZ1bmN0aW9uIHVubG9ja1Zlc3RlZFRva2VucygpIHB1YmxpYyB7CiAgICAgICAgR3JhbnQgZ3JhbnQgPSBncmFudHNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShncmFudC52YWx1ZSAhPSAwKTsKCiAgICAgICAgLy8gR2V0IHRoZSB0b3RhbCBhbW91bnQgb2YgdmVzdGVkIHRva2VucywgYWNjY29yZGluZyB0byBncmFudC4KICAgICAgICB1aW50MjU2IHZlc3RlZCA9IGNhbGN1bGF0ZVZlc3RlZFRva2VucyhncmFudCwgbm93KTsKICAgICAgICBpZiAodmVzdGVkID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBob2xkZXIgZG9lc24ndCB0cmFuc2ZlciBtb3JlIHRoYW4gd2hhdCBoZSBhbHJlYWR5IGhhcy4KICAgICAgICB1aW50MjU2IHRyYW5zZmVyYWJsZSA9IHZlc3RlZC5zdWIoZ3JhbnQudHJhbnNmZXJyZWQpOwogICAgICAgIGlmICh0cmFuc2ZlcmFibGUgPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBncmFudC50cmFuc2ZlcnJlZCA9IGdyYW50LnRyYW5zZmVycmVkLmFkZCh0cmFuc2ZlcmFibGUpOwogICAgICAgIHRvdGFsVmVzdGluZyA9IHRvdGFsVmVzdGluZy5zdWIodHJhbnNmZXJhYmxlKTsKICAgICAgICBzaHAudHJhbnNmZXIobXNnLnNlbmRlciwgdHJhbnNmZXJhYmxlKTsKCiAgICAgICAgVW5sb2NrR3JhbnQobXNnLnNlbmRlciwgdHJhbnNmZXJhYmxlKTsKICAgIH0KfQoKCmNvbnRyYWN0IFRva2VuU2FsZSBpcyBPd25lZCwgVG9rZW5Db250cm9sbGVyIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgCiAgICBTSFAgcHVibGljIHNocDsKICAgIFRydXN0ZWUgcHVibGljIHRydXN0ZWU7CgogICAgYWRkcmVzcyBwdWJsaWMgZXRoZXJFc2Nyb3dBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgYm91bnR5QWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIHRydXN0ZWVBZGRyZXNzOwoKICAgIHVpbnQyNTYgcHVibGljIGZvdW5kZXJUb2tlbkNvdW50ID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHJlc2VydmVUb2tlbkNvdW50ID0gMDsKICAgIHVpbnQyNTYgcHVibGljIHNocEV4Y2hhbmdlUmF0ZSA9IDA7CgogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgQ0FMTEVSX0VYQ0hBTkdFX1NIQVJFID0gNDA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBSRVNFUlZFX0VYQ0hBTkdFX1NIQVJFID0gMzA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBGT1VOREVSX0VYQ0hBTkdFX1NIQVJFID0gMjA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBCT1VOVFlfRVhDSEFOR0VfU0hBUkUgPSAxMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIE1BWF9HQVNfUFJJQ0UgPSA1MDAwMDAwMDAwMDAwOwoKICAgIGJvb2wgcHVibGljIHBhdXNlZDsKICAgIGJvb2wgcHVibGljIGNsb3NlZDsKICAgIGJvb2wgcHVibGljIGFsbG93VHJhbnNmZXI7CgogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBhcHByb3ZlZEFkZHJlc3NlczsKCiAgICBldmVudCBDb250cmlidXRpb24odWludDI1NiBldGhlckFtb3VudCwgYWRkcmVzcyBfY2FsbGVyKTsKICAgIGV2ZW50IE5ld1NhbGUoYWRkcmVzcyBpbmRleGVkIGNhbGxlciwgdWludDI1NiBldGhlckFtb3VudCwgdWludDI1NiB0b2tlbnNHZW5lcmF0ZWQpOwogICAgZXZlbnQgU2FsZUNsb3NlZCh1aW50MjU2IHdoZW4pOwogICAgCiAgICBtb2RpZmllciBub3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdENsb3NlZCgpIHsKICAgICAgICByZXF1aXJlKCFjbG9zZWQpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgaXNWYWxpZGF0ZWQoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKCFpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKTsgCiAgICAgICAgcmVxdWlyZSh0eC5nYXNwcmljZSA8PSBNQVhfR0FTX1BSSUNFKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNocEV4Y2hhbmdlUmF0ZSh1aW50MjU2IF9zaHBFeGNoYW5nZVJhdGUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHNocEV4Y2hhbmdlUmF0ZSA9IF9zaHBFeGNoYW5nZVJhdGU7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QWxsb3dUcmFuc2Zlcihib29sIF9hbGxvd1RyYW5zZmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBhbGxvd1RyYW5zZmVyID0gX2FsbG93VHJhbnNmZXI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2Qgc2VuZHMgdGhlIEV0aGVyIHJlY2VpdmVkIHRvIHRoZSBFdGhlciBlc2Nyb3cgYWRkcmVzcwogICAgLy8vIGFuZCBnZW5lcmF0ZXMgdGhlIGNhbGN1bGF0ZWQgbnVtYmVyIG9mIFNIUCB0b2tlbnMsIHNlbmRpbmcgdGhlbSB0byB0aGUgY2FsbGVyJ3MgYWRkcmVzcy4KICAgIC8vLyBJdCBhbHNvIGdlbmVyYXRlcyB0aGUgZm91bmRlcidzIHRva2VucyBhbmQgdGhlIHJlc2VydmUgdG9rZW5zIGF0IHRoZSBzYW1lIHRpbWUuCiAgICBmdW5jdGlvbiBkb0J1eSgKICAgICAgICBhZGRyZXNzIF9jYWxsZXIsCiAgICAgICAgdWludDI1NiBldGhlckFtb3VudAogICAgKQogICAgICAgIGludGVybmFsCiAgICB7CgogICAgICAgIENvbnRyaWJ1dGlvbihldGhlckFtb3VudCwgX2NhbGxlcik7CgogICAgICAgIHVpbnQyNTYgY2FsbGVyRXhjaGFuZ2VSYXRlID0gc2hwRXhjaGFuZ2VSYXRlLm11bChDQUxMRVJfRVhDSEFOR0VfU0hBUkUpLmRpdigxMDApOwogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZUV4Y2hhbmdlUmF0ZSA9IHNocEV4Y2hhbmdlUmF0ZS5tdWwoUkVTRVJWRV9FWENIQU5HRV9TSEFSRSkuZGl2KDEwMCk7CiAgICAgICAgdWludDI1NiBmb3VuZGVyRXhjaGFuZ2VSYXRlID0gc2hwRXhjaGFuZ2VSYXRlLm11bChGT1VOREVSX0VYQ0hBTkdFX1NIQVJFKS5kaXYoMTAwKTsKICAgICAgICB1aW50MjU2IGJvdW50eUV4Y2hhbmdlUmF0ZSA9IHNocEV4Y2hhbmdlUmF0ZS5tdWwoQk9VTlRZX0VYQ0hBTkdFX1NIQVJFKS5kaXYoMTAwKTsKCiAgICAgICAgdWludDI1NiBjYWxsZXJUb2tlbnMgPSBldGhlckFtb3VudC5tdWwoY2FsbGVyRXhjaGFuZ2VSYXRlKTsKICAgICAgICB1aW50MjU2IGNhbGxlclRva2Vuc1dpdGhEaXNjb3VudCA9IGFwcGx5RGlzY291bnQoZXRoZXJBbW91bnQsIGNhbGxlclRva2Vucyk7CgogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZVRva2VucyA9IGV0aGVyQW1vdW50Lm11bChyZXNlcnZlRXhjaGFuZ2VSYXRlKTsKICAgICAgICB1aW50MjU2IGZvdW5kZXJUb2tlbnMgPSBldGhlckFtb3VudC5tdWwoZm91bmRlckV4Y2hhbmdlUmF0ZSk7CiAgICAgICAgdWludDI1NiBib3VudHlUb2tlbnMgPSBldGhlckFtb3VudC5tdWwoYm91bnR5RXhjaGFuZ2VSYXRlKTsKICAgICAgICB1aW50MjU2IHZlc3RpbmdUb2tlbnMgPSBmb3VuZGVyVG9rZW5zLmFkZChyZXNlcnZlVG9rZW5zKTsKCiAgICAgICAgZm91bmRlclRva2VuQ291bnQgPSBmb3VuZGVyVG9rZW5Db3VudC5hZGQoZm91bmRlclRva2Vucyk7CiAgICAgICAgcmVzZXJ2ZVRva2VuQ291bnQgPSByZXNlcnZlVG9rZW5Db3VudC5hZGQocmVzZXJ2ZVRva2Vucyk7CgogICAgICAgIHNocC5nZW5lcmF0ZVRva2VucyhfY2FsbGVyLCBjYWxsZXJUb2tlbnNXaXRoRGlzY291bnQpOwogICAgICAgIHNocC5nZW5lcmF0ZVRva2Vucyhib3VudHlBZGRyZXNzLCBib3VudHlUb2tlbnMpOwogICAgICAgIHNocC5nZW5lcmF0ZVRva2Vucyh0cnVzdGVlQWRkcmVzcywgdmVzdGluZ1Rva2Vucyk7CgogICAgICAgIE5ld1NhbGUoX2NhbGxlciwgZXRoZXJBbW91bnQsIGNhbGxlclRva2Vuc1dpdGhEaXNjb3VudCk7CiAgICAgICAgTmV3U2FsZSh0cnVzdGVlQWRkcmVzcywgZXRoZXJBbW91bnQsIHZlc3RpbmdUb2tlbnMpOwogICAgICAgIE5ld1NhbGUoYm91bnR5QWRkcmVzcywgZXRoZXJBbW91bnQsIGJvdW50eVRva2Vucyk7CgogICAgICAgIGV0aGVyRXNjcm93QWRkcmVzcy50cmFuc2ZlcihldGhlckFtb3VudCk7CiAgICAgICAgdXBkYXRlQ291bnRlcnMoZXRoZXJBbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbG93cyB0aGUgb3duZXIgdG8gbWFudWFsbHkgbWludCBzb21lIFNIUCB0byBhbiBhZGRyZXNzIGlmIHNvbWV0aGluZyBnb2VzIHdyb25nCiAgICAvLy8gQHBhcmFtIF90b2tlbnMgdGhlIG51bWJlciBvZiB0b2tlbnMgdG8gbWludAogICAgLy8vIEBwYXJhbSBfZGVzdGluYXRpb24gdGhlIGFkZHJlc3MgdG8gc2VuZCB0aGUgdG9rZW5zIHRvCiAgICBmdW5jdGlvbiBtaW50VG9rZW5zKAogICAgICAgIHVpbnQyNTYgX3Rva2VucywgCiAgICAgICAgYWRkcmVzcyBfZGVzdGluYXRpb24KICAgICkgCiAgICAgICAgb25seU93bmVyIAogICAgewogICAgICAgIHNocC5nZW5lcmF0ZVRva2VucyhfZGVzdGluYXRpb24sIF90b2tlbnMpOwogICAgICAgIE5ld1NhbGUoX2Rlc3RpbmF0aW9uLCAwLCBfdG9rZW5zKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbGxvd3MgdGhlIG93bmVyIHRvIG1hbnVhbGx5IGRlc3Ryb3kgc29tZSBTSFAgdG8gYW4gYWRkcmVzcyBpZiBzb21ldGhpbmcgZ29lcyB3cm9uZwogICAgLy8vIEBwYXJhbSBfdG9rZW5zIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIG1pbnQKICAgIC8vLyBAcGFyYW0gX2Rlc3RpbmF0aW9uIHRoZSBhZGRyZXNzIHRvIHNlbmQgdGhlIHRva2VucyB0bwogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucygKICAgICAgICB1aW50MjU2IF90b2tlbnMsIAogICAgICAgIGFkZHJlc3MgX2Rlc3RpbmF0aW9uCiAgICApIAogICAgICAgIG9ubHlPd25lciAKICAgIHsKICAgICAgICBzaHAuZGVzdHJveVRva2VucyhfZGVzdGluYXRpb24sIF90b2tlbnMpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFwcGxpZXMgdGhlIGRpc2NvdW50IGJhc2VkIG9uIHRoZSBkaXNjb3VudCB0aWVycwogICAgLy8vIEBwYXJhbSBfZXRoZXJBbW91bnQgVGhlIGFtb3VudCBvZiBldGhlciB1c2VkIHRvIGV2YWx1YXRlIHRoZSB0aWVyIHRoZSBjb250cmlidXRpb24gbGllcyB3aXRoaW4KICAgIC8vLyBAcGFyYW0gX2NvbnRyaWJ1dG9yVG9rZW5zIFRoZSB0b2tlbnMgYWxsb2NhdGVkIGJhc2VkIG9uIHRoZSBjb250cmlidXRpb24KICAgIGZ1bmN0aW9uIGFwcGx5RGlzY291bnQodWludDI1NiBfZXRoZXJBbW91bnQsIHVpbnQyNTYgX2NvbnRyaWJ1dG9yVG9rZW5zKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKCiAgICAvLy8gQG5vdGljZSBVcGRhdGVzIHRoZSBjb3VudGVycyBmb3IgdGhlIGFtb3VudCBvZiBFdGhlciBwYWlkCiAgICAvLy8gQHBhcmFtIF9ldGhlckFtb3VudCB0aGUgYW1vdW50IG9mIEV0aGVyIHBhaWQKICAgIGZ1bmN0aW9uIHVwZGF0ZUNvdW50ZXJzKHVpbnQyNTYgX2V0aGVyQW1vdW50KSBpbnRlcm5hbDsKICAgIAogICAgLy8vIEBub3RpY2UgUGFyZW50IGNvbnN0cnVjdG9yLiBUaGlzIG5lZWRzIHRvIGJlIGV4dGVuZGVkIGZyb20gdGhlIGNoaWxkIGNvbnRyYWN0cwogICAgLy8vIEBwYXJhbSBfZXRoZXJFc2Nyb3dBZGRyZXNzIHRoZSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSBjcm93ZCBmdW5kZWQgRXRoZXIKICAgIC8vLyBAcGFyYW0gX2JvdW50eUFkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIGJvdW50eSBzY2hlbWUgU0hQCiAgICAvLy8gQHBhcmFtIF90cnVzdGVlQWRkcmVzcyB0aGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgdmVzdGluZyBTSFAKICAgIC8vLyBAcGFyYW0gX3NocEV4Y2hhbmdlUmF0ZSB0aGUgaW5pdGlhbCBTSFAgZXhjaGFuZ2UgcmF0ZQogICAgZnVuY3Rpb24gVG9rZW5TYWxlICgKICAgICAgICBhZGRyZXNzIF9ldGhlckVzY3Jvd0FkZHJlc3MsCiAgICAgICAgYWRkcmVzcyBfYm91bnR5QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF90cnVzdGVlQWRkcmVzcywKICAgICAgICB1aW50MjU2IF9zaHBFeGNoYW5nZVJhdGUKICAgICkgewogICAgICAgIGV0aGVyRXNjcm93QWRkcmVzcyA9IF9ldGhlckVzY3Jvd0FkZHJlc3M7CiAgICAgICAgYm91bnR5QWRkcmVzcyA9IF9ib3VudHlBZGRyZXNzOwogICAgICAgIHRydXN0ZWVBZGRyZXNzID0gX3RydXN0ZWVBZGRyZXNzOwogICAgICAgIHNocEV4Y2hhbmdlUmF0ZSA9IF9zaHBFeGNoYW5nZVJhdGU7CiAgICAgICAgdHJ1c3RlZSA9IFRydXN0ZWUoX3RydXN0ZWVBZGRyZXNzKTsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIGNsb3NlZCA9IGZhbHNlOwogICAgICAgIGFsbG93VHJhbnNmZXIgPSBmYWxzZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZXRzIHRoZSBTSFAgdG9rZW4gc21hcnQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX3NocCB0aGUgU0hQIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgIGZ1bmN0aW9uIHNldFNocChhZGRyZXNzIF9zaHApIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHNocCA9IFNIUChfc2hwKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlcnMgb3duZXJzaGlwIG9mIHRoZSB0b2tlbiBzbWFydCBjb250cmFjdCBhbmQgdHJ1c3RlZQogICAgLy8vIEBwYXJhbSBfdG9rZW5Db250cm9sbGVyIHRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdG9rZW4gY29udHJvbGxlcgogICAgLy8vIEBwYXJhbSBfdHJ1c3RlZU93bmVyIHRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgdHJ1c3RlZSBvd25lcgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfdG9rZW5Db250cm9sbGVyLCBhZGRyZXNzIF90cnVzdGVlT3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoY2xvc2VkKTsKICAgICAgICByZXF1aXJlKF90b2tlbkNvbnRyb2xsZXIgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF90cnVzdGVlT3duZXIgIT0gMHgwKTsKICAgICAgICBzaHAuY2hhbmdlQ29udHJvbGxlcihfdG9rZW5Db250cm9sbGVyKTsKICAgICAgICB0cnVzdGVlLmNoYW5nZU93bmVyKF90cnVzdGVlT3duZXIpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2NhbGxlciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBjYWxsZXJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfY2FsbGVyKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBzaXplOwogICAgICAgIGFzc2VtYmx5IHsgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfY2FsbGVyKSB9CiAgICAgICAgcmV0dXJuIHNpemUgPiAwOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFBhdXNlcyB0aGUgY29udHJpYnV0aW9uIGlmIHRoZXJlIGlzIGFueSBpc3N1ZQogICAgZnVuY3Rpb24gcGF1c2VDb250cmlidXRpb24oKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJlc3VtZXMgdGhlIGNvbnRyaWJ1dGlvbgogICAgZnVuY3Rpb24gcmVzdW1lQ29udHJpYnV0aW9uKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9CgogICAgLy8vLy8vLy8vLwogICAgLy8gTWluaU1lIENvbnRyb2xsZXIgSW50ZXJmYWNlIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLwoKICAgIC8vIEluIGJldHdlZW4gdGhlIG9mZmVyaW5nIGFuZCB0aGUgbmV0d29yay4gRGVmYXVsdCBzZXR0aW5ncyBmb3IgYWxsb3dpbmcgdG9rZW4gdHJhbnNmZXJzLgogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYWxsb3dUcmFuc2ZlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MsIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFsbG93VHJhbnNmZXI7CiAgICB9CgogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MsIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFsbG93VHJhbnNmZXI7CiAgICB9Cn0KCmNvbnRyYWN0IFNoYXJwZUNyb3dkc2FsZSBpcyBUb2tlblNhbGUgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAKICAgIHVpbnQyNTYgcHVibGljIGV0aGVyUGFpZCA9IDA7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbENvbnRyaWJ1dGlvbnMgPSAwOwoKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIEZJUlNUX1RJRVJfRElTQ09VTlQgPSA1OwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgU0VDT05EX1RJRVJfRElTQ09VTlQgPSAxMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIFRISVJEX1RJRVJfRElTQ09VTlQgPSAyMDsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIEZPVVJUSF9USUVSX0RJU0NPVU5UID0gMzA7CgogICAgdWludDI1NiBwdWJsaWMgbWluUHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgbWF4UHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgbWluRGlzY291bnRFdGhlcjsKICAgIHVpbnQyNTYgcHVibGljIGZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyOwogICAgdWludDI1NiBwdWJsaWMgdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CiAgICAKICAgIGVudW0gQ29udHJpYnV0aW9uU3RhdGUge1BhdXNlZCwgUmVzdW1lZH0KICAgIGV2ZW50IENvbnRyaWJ1dGlvblN0YXRlQ2hhbmdlZChhZGRyZXNzIGNhbGxlciwgQ29udHJpYnV0aW9uU3RhdGUgY29udHJpYnV0aW9uU3RhdGUpOwogICAgZW51bSBBbGxvd2VkQ29udHJpYnV0aW9uU3RhdGUge1doaXRlbGlzdGVkLCBOb3RXaGl0ZWxpc3RlZCwgQWJvdmVXaGl0ZWxpc3RlZCwgQmVsb3dXaGl0ZWxpc3RlZCwgV2hpdGVsaXN0Q2xvc2VkfQogICAgZXZlbnQgQWxsb3dlZENvbnRyaWJ1dGlvbkNoZWNrKHVpbnQyNTYgY29udHJpYnV0aW9uLCBBbGxvd2VkQ29udHJpYnV0aW9uU3RhdGUgYWxsb3dlZENvbnRyaWJ1dGlvblN0YXRlKTsKICAgIGV2ZW50IFZhbGlkQ29udHJpYnV0aW9uQ2hlY2sodWludDI1NiBjb250cmlidXRpb24sIGJvb2wgaXNDb250cmlidXRpb25WYWxpZCk7CiAgICBldmVudCBEaXNjb3VudEFwcGxpZWQodWludDI1NiBldGhlckFtb3VudCwgdWludDI1NiB0b2tlbnMsIHVpbnQyNTYgZGlzY291bnQpOwogICAgZXZlbnQgQ29udHJpYnV0aW9uUmVmdW5kKHVpbnQyNTYgZXRoZXJBbW91bnQsIGFkZHJlc3MgX2NhbGxlcik7CiAgICBldmVudCBDb3VudGVyc1VwZGF0ZWQodWludDI1NiBwcmVTYWxlRXRoZXJQYWlkLCB1aW50MjU2IHRvdGFsQ29udHJpYnV0aW9ucyk7CiAgICBldmVudCBXaGl0ZWxpc3RlZFVwZGF0ZWQodWludDI1NiBwbGFubmVkQ29udHJpYnV0aW9uLCBib29sIGNvbnRyaWJ1dGVkKTsKICAgIGV2ZW50IFdoaXRlbGlzdGVkQ291bnRlclVwZGF0ZWQodWludDI1NiB3aGl0ZWxpc3RlZFBsYW5uZWRDb250cmlidXRpb25zLCB1aW50MjU2IHVzZWRDb250cmlidXRpb25zKTsKCiAgICBtb2RpZmllciBpc1ZhbGlkQ29udHJpYnV0aW9uKCkgewogICAgICAgIHJlcXVpcmUodmFsaWRDb250cmlidXRpb24oKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjYWxsZWQgb25seSBvbmNlIHdoZW4gdGhlIGNvbnRyYWN0IGlzIGluaXRpYWxpemVkCiAgICAvLy8gQHBhcmFtIF9ldGhlckVzY3Jvd0FkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIGNyb3dkIGZ1bmRlZCBFdGhlcgogICAgLy8vIEBwYXJhbSBfYm91bnR5QWRkcmVzcyB0aGUgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCB0aGUgYm91bnR5IFNIUAogICAgLy8vIEBwYXJhbSBfdHJ1c3RlZUFkZHJlc3MgdGhlIGFkZHJlc3MgdGhhdCB3aWxsIGhvbGQgdGhlIHZlc3RpbmcgU0hQCiAgICAvLy8gQHBhcmFtIF9taW5EaXNjb3VudEV0aGVyIExvd2VyIGRpc2NvdW50IGxpbWl0IChXRUkpCiAgICAvLy8gQHBhcmFtIF9maXJzdFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciBGaXJzdCBkaXNjb3VudCBsaW1pdHMgKFdFSSkKICAgIC8vLyBAcGFyYW0gX3NlY29uZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciBTZWNvbmQgZGlzY291bnQgbGltaXRzIChXRUkpCiAgICAvLy8gQHBhcmFtIF90aGlyZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciBUaGlyZCBkaXNjb3VudCBsaW1pdHMgKFdFSSkKICAgIC8vLyBAcGFyYW0gX21pblByZXNhbGVDb250cmlidXRpb25FdGhlciBMb3dlciBjb250cmlidXRpb24gcmFuZ2UgKFdFSSkKICAgIC8vLyBAcGFyYW0gX21heFByZXNhbGVDb250cmlidXRpb25FdGhlciBVcHBlciBjb250cmlidXRpb24gcmFuZ2UgKFdFSSkKICAgIC8vLyBAcGFyYW0gX3NocEV4Y2hhbmdlUmF0ZSBUaGUgaW5pdGlhbCBTSFAgZXhjaGFuZ2UgcmF0ZQogICAgZnVuY3Rpb24gU2hhcnBlQ3Jvd2RzYWxlKAogICAgICAgIGFkZHJlc3MgX2V0aGVyRXNjcm93QWRkcmVzcywKICAgICAgICBhZGRyZXNzIF9ib3VudHlBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3RydXN0ZWVBZGRyZXNzLAogICAgICAgIHVpbnQyNTYgX21pbkRpc2NvdW50RXRoZXIsCiAgICAgICAgdWludDI1NiBfZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIsCiAgICAgICAgdWludDI1NiBfc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyLAogICAgICAgIHVpbnQyNTYgX3RoaXJkVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyLAogICAgICAgIHVpbnQyNTYgX21pblByZXNhbGVDb250cmlidXRpb25FdGhlciwKICAgICAgICB1aW50MjU2IF9tYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIsCiAgICAgICAgdWludDI1NiBfc2hwRXhjaGFuZ2VSYXRlKQogICAgICAgIFRva2VuU2FsZSAoCiAgICAgICAgICAgIF9ldGhlckVzY3Jvd0FkZHJlc3MsCiAgICAgICAgICAgIF9ib3VudHlBZGRyZXNzLAogICAgICAgICAgICBfdHJ1c3RlZUFkZHJlc3MsCiAgICAgICAgICAgIF9zaHBFeGNoYW5nZVJhdGUKICAgICAgICApCiAgICB7CiAgICAgICAgbWluRGlzY291bnRFdGhlciA9IF9taW5EaXNjb3VudEV0aGVyOwogICAgICAgIGZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyID0gX2ZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyOwogICAgICAgIHNlY29uZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciA9IF9zZWNvbmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CiAgICAgICAgdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgPSBfdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXI7CiAgICAgICAgbWluUHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyID0gX21pblByZXNhbGVDb250cmlidXRpb25FdGhlcjsKICAgICAgICBtYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgPSBfbWF4UHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIEFsbG93cyB0aGUgb3duZXIgdG8gcGVnIEV0aGVyIHZhbHVlcwogICAgLy8vIEBwYXJhbSBfbWluRGlzY291bnRFdGhlciBMb3dlciBkaXNjb3VudCBsaW1pdCAoV0VJKQogICAgLy8vIEBwYXJhbSBfZmlyc3RUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgRmlyc3QgZGlzY291bnQgbGltaXRzIChXRUkpCiAgICAvLy8gQHBhcmFtIF9zZWNvbmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgU2Vjb25kIGRpc2NvdW50IGxpbWl0cyAoV0VJKQogICAgLy8vIEBwYXJhbSBfdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgVGhpcmQgZGlzY291bnQgbGltaXRzIChXRUkpCiAgICAvLy8gQHBhcmFtIF9taW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgTG93ZXIgY29udHJpYnV0aW9uIHJhbmdlIChXRUkpCiAgICAvLy8gQHBhcmFtIF9tYXhQcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgVXBwZXIgY29udHJpYnV0aW9uIHJhbmdlIChXRUkpCiAgICBmdW5jdGlvbiBwZWdFdGhlclZhbHVlcygKICAgICAgICB1aW50MjU2IF9taW5EaXNjb3VudEV0aGVyLAogICAgICAgIHVpbnQyNTYgX2ZpcnN0VGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyLAogICAgICAgIHVpbnQyNTYgX3NlY29uZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciwKICAgICAgICB1aW50MjU2IF90aGlyZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciwKICAgICAgICB1aW50MjU2IF9taW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIsCiAgICAgICAgdWludDI1NiBfbWF4UHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyCiAgICApIAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIG1pbkRpc2NvdW50RXRoZXIgPSBfbWluRGlzY291bnRFdGhlcjsKICAgICAgICBmaXJzdFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciA9IF9maXJzdFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlcjsKICAgICAgICBzZWNvbmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIgPSBfc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyOwogICAgICAgIHRoaXJkVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyID0gX3RoaXJkVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyOwogICAgICAgIG1pblByZXNhbGVDb250cmlidXRpb25FdGhlciA9IF9taW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXI7CiAgICAgICAgbWF4UHJlc2FsZUNvbnRyaWJ1dGlvbkV0aGVyID0gX21heFByZXNhbGVDb250cmlidXRpb25FdGhlcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGZpcmVzIHdoZW4gc29tZW9uZSBzZW5kcyBFdGhlciB0byB0aGUgYWRkcmVzcyBvZiB0aGlzIGNvbnRyYWN0LgogICAgLy8vIFRoZSBFVEggd2lsbCBiZSBleGNoYW5nZWQgZm9yIFNIUCBhbmQgaXQgZW5zdXJlcyBjb250cmlidXRpb25zIGNhbm5vdCBiZSBtYWRlIGZyb20ga25vd24gYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgaXNWYWxpZGF0ZWQKICAgICAgICBub3RDbG9zZWQKICAgICAgICBub3RQYXVzZWQKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA+IDApOwogICAgICAgIGRvQnV5KG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUHVibGljIGZ1bmN0aW9uIGVuYWJsZXMgY2xvc2luZyBvZiB0aGUgcHJlLXNhbGUgbWFudWFsbHkgaWYgbmVjZXNzYXJ5CiAgICBmdW5jdGlvbiBjbG9zZVNhbGUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBjbG9zZWQgPSB0cnVlOwogICAgICAgIFNhbGVDbG9zZWQobm93KTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBFbnN1cmUgdGhlIGNvbnRyaWJ1dGlvbiBpcyB2YWxpZAogICAgLy8vIEByZXR1cm4gUmV0dXJucyB3aGV0aGVyIHRoZSBjb250cmlidXRpb24gaXMgdmFsaWQgb3Igbm90CiAgICBmdW5jdGlvbiB2YWxpZENvbnRyaWJ1dGlvbigpIHByaXZhdGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgaXNDb250cmlidXRpb25WYWxpZCA9IG1zZy52YWx1ZSA+PSBtaW5QcmVzYWxlQ29udHJpYnV0aW9uRXRoZXIgJiYgbXNnLnZhbHVlIDw9IG1heFByZXNhbGVDb250cmlidXRpb25FdGhlcjsKICAgICAgICBWYWxpZENvbnRyaWJ1dGlvbkNoZWNrKG1zZy52YWx1ZSwgaXNDb250cmlidXRpb25WYWxpZCk7CiAgICAgICAgcmV0dXJuIGlzQ29udHJpYnV0aW9uVmFsaWQ7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQXBwbGllcyB0aGUgZGlzY291bnQgYmFzZWQgb24gdGhlIGRpc2NvdW50IHRpZXJzCiAgICAvLy8gQHBhcmFtIF9ldGhlckFtb3VudCBUaGUgYW1vdW50IG9mIGV0aGVyIHVzZWQgdG8gZXZhbHVhdGUgdGhlIHRpZXIgdGhlIGNvbnRyaWJ1dGlvbiBsaWVzIHdpdGhpbgogICAgLy8vIEBwYXJhbSBfY29udHJpYnV0b3JUb2tlbnMgVGhlIHRva2VucyBhbGxvY2F0ZWQgYmFzZWQgb24gdGhlIGNvbnRyaWJ1dGlvbgogICAgZnVuY3Rpb24gYXBwbHlEaXNjb3VudCgKICAgICAgICB1aW50MjU2IF9ldGhlckFtb3VudCwgCiAgICAgICAgdWludDI1NiBfY29udHJpYnV0b3JUb2tlbnMKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKCiAgICAgICAgdWludDI1NiBkaXNjb3VudCA9IDA7CgogICAgICAgIGlmIChfZXRoZXJBbW91bnQgPiBtaW5EaXNjb3VudEV0aGVyICYmIF9ldGhlckFtb3VudCA8PSBmaXJzdFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlcikgewogICAgICAgICAgICBkaXNjb3VudCA9IF9jb250cmlidXRvclRva2Vucy5tdWwoRklSU1RfVElFUl9ESVNDT1VOVCkuZGl2KDEwMCk7IC8vIDUlCiAgICAgICAgfSBlbHNlIGlmIChfZXRoZXJBbW91bnQgPiBmaXJzdFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlciAmJiBfZXRoZXJBbW91bnQgPD0gc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyKSB7CiAgICAgICAgICAgIGRpc2NvdW50ID0gX2NvbnRyaWJ1dG9yVG9rZW5zLm11bChTRUNPTkRfVElFUl9ESVNDT1VOVCkuZGl2KDEwMCk7IC8vIDEwJQogICAgICAgIH0gZWxzZSBpZiAoX2V0aGVyQW1vdW50ID4gc2Vjb25kVGllckRpc2NvdW50VXBwZXJMaW1pdEV0aGVyICYmIF9ldGhlckFtb3VudCA8PSB0aGlyZFRpZXJEaXNjb3VudFVwcGVyTGltaXRFdGhlcikgewogICAgICAgICAgICBkaXNjb3VudCA9IF9jb250cmlidXRvclRva2Vucy5tdWwoVEhJUkRfVElFUl9ESVNDT1VOVCkuZGl2KDEwMCk7IC8vIDIwJQogICAgICAgIH0gZWxzZSBpZiAoX2V0aGVyQW1vdW50ID4gdGhpcmRUaWVyRGlzY291bnRVcHBlckxpbWl0RXRoZXIpIHsKICAgICAgICAgICAgZGlzY291bnQgPSBfY29udHJpYnV0b3JUb2tlbnMubXVsKEZPVVJUSF9USUVSX0RJU0NPVU5UKS5kaXYoMTAwKTsgLy8gMzAlCiAgICAgICAgfQoKICAgICAgICBEaXNjb3VudEFwcGxpZWQoX2V0aGVyQW1vdW50LCBfY29udHJpYnV0b3JUb2tlbnMsIGRpc2NvdW50KTsKICAgICAgICByZXR1cm4gZGlzY291bnQuYWRkKF9jb250cmlidXRvclRva2Vucyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVXBkYXRlcyB0aGUgY291bnRlcnMgZm9yIHRoZSBhbW91bnQgb2YgRXRoZXIgcGFpZAogICAgLy8vIEBwYXJhbSBfZXRoZXJBbW91bnQgdGhlIGFtb3VudCBvZiBFdGhlciBwYWlkCiAgICBmdW5jdGlvbiB1cGRhdGVDb3VudGVycyh1aW50MjU2IF9ldGhlckFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIGV0aGVyUGFpZCA9IGV0aGVyUGFpZC5hZGQoX2V0aGVyQW1vdW50KTsKICAgICAgICB0b3RhbENvbnRyaWJ1dGlvbnMgPSB0b3RhbENvbnRyaWJ1dGlvbnMuYWRkKDEpOwogICAgICAgIENvdW50ZXJzVXBkYXRlZChldGhlclBhaWQsIF9ldGhlckFtb3VudCk7CiAgICB9Cn0='.
	

]
