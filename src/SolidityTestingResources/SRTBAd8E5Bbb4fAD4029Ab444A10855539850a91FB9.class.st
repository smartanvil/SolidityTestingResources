Class {
	#name : #SRTBAd8E5Bbb4fAD4029Ab444A10855539850a91FB9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTBAd8E5Bbb4fAD4029Ab444A10855539850a91FB9 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCgovKioKICogQHRpdGxlIE93bmFibGUKICogQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljIGF1dGhvcml6YXRpb24gY29udHJvbAogKiBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YgInVzZXIgcGVybWlzc2lvbnMiLgogKi8KY29udHJhY3QgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CgoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgQ2xhaW1hYmxlCiAqIEBkZXYgRXh0ZW5zaW9uIGZvciB0aGUgT3duYWJsZSBjb250cmFjdCwgd2hlcmUgdGhlIG93bmVyc2hpcCBuZWVkcyB0byBiZSBjbGFpbWVkLgogKiBUaGlzIGFsbG93cyB0aGUgbmV3IG93bmVyIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIuCiAqLwpjb250cmFjdCBDbGFpbWFibGUgaXMgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ093bmVyOwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgcGVuZGluZ093bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlQZW5kaW5nT3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcGVuZGluZ093bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBzZXQgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICBwZW5kaW5nT3duZXIgPSBuZXdPd25lcjsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcyB0byBmaW5hbGl6ZSB0aGUgdHJhbnNmZXIuCiAgICovCiAgZnVuY3Rpb24gY2xhaW1Pd25lcnNoaXAoKSBvbmx5UGVuZGluZ093bmVyIHB1YmxpYyB7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgcGVuZGluZ093bmVyKTsKICAgIG93bmVyID0gcGVuZGluZ093bmVyOwogICAgcGVuZGluZ093bmVyID0gYWRkcmVzcygwKTsKICB9Cn0KCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgoKLyoqCiAqIEB0aXRsZSBTYWZlRVJDMjAKICogQGRldiBXcmFwcGVycyBhcm91bmQgRVJDMjAgb3BlcmF0aW9ucyB0aGF0IHRocm93IG9uIGZhaWx1cmUuCiAqIFRvIHVzZSB0aGlzIGxpYnJhcnkgeW91IGNhbiBhZGQgYSBgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMDtgIHN0YXRlbWVudCB0byB5b3VyIGNvbnRyYWN0LAogKiB3aGljaCBhbGxvd3MgeW91IHRvIGNhbGwgdGhlIHNhZmUgb3BlcmF0aW9ucyBhcyBgdG9rZW4uc2FmZVRyYW5zZmVyKC4uLilgLCBldGMuCiAqLwpsaWJyYXJ5IFNhZmVFUkMyMCB7CiAgZnVuY3Rpb24gc2FmZVRyYW5zZmVyKEVSQzIwQmFzaWMgdG9rZW4sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2Zlcih0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlckZyb20oRVJDMjAgdG9rZW4sIGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgewogICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyRnJvbShmcm9tLCB0bywgdmFsdWUpKTsKICB9CgogIGZ1bmN0aW9uIHNhZmVBcHByb3ZlKEVSQzIwIHRva2VuLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi5hcHByb3ZlKHNwZW5kZXIsIHZhbHVlKSk7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBDb250cmFjdHMgdGhhdCBzaG91bGQgYmUgYWJsZSB0byByZWNvdmVyIHRva2VucwogKiBAYXV0aG9yIFN5bFRpCiAqIEBkZXYgVGhpcyBhbGxvdyBhIGNvbnRyYWN0IHRvIHJlY292ZXIgYW55IEVSQzIwIHRva2VuIHJlY2VpdmVkIGluIGEgY29udHJhY3QgYnkgdHJhbnNmZXJyaW5nIHRoZSBiYWxhbmNlIHRvIHRoZSBjb250cmFjdCBvd25lci4KICogVGhpcyB3aWxsIHByZXZlbnQgYW55IGFjY2lkZW50YWwgbG9zcyBvZiB0b2tlbnMuCiAqLwpjb250cmFjdCBDYW5SZWNsYWltVG9rZW4gaXMgT3duYWJsZSB7CiAgdXNpbmcgU2FmZUVSQzIwIGZvciBFUkMyMEJhc2ljOwoKICAvKioKICAgKiBAZGV2IFJlY2xhaW0gYWxsIEVSQzIwQmFzaWMgY29tcGF0aWJsZSB0b2tlbnMKICAgKiBAcGFyYW0gdG9rZW4gRVJDMjBCYXNpYyBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QKICAgKi8KICBmdW5jdGlvbiByZWNsYWltVG9rZW4oRVJDMjBCYXNpYyB0b2tlbikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIHRva2VuLnNhZmVUcmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgfQoKfQoKCi8vLyBAZGV2IEltcGxlbWVudHMgYWNjZXNzIGNvbnRyb2wgdG8gdGhlIERXb3JsZCBjb250cmFjdC4KY29udHJhY3QgTWV0YUdhbWVBY2Nlc3NDb250cm9sIGlzIENsYWltYWJsZSwgUGF1c2FibGUsIENhblJlY2xhaW1Ub2tlbiB7CiAgICBhZGRyZXNzIHB1YmxpYyBjZm9BZGRyZXNzOwogICAgCiAgICBmdW5jdGlvbiBNZXRhR2FtZUFjY2Vzc0NvbnRyb2woKSBwdWJsaWMgewogICAgICAgIC8vIFRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDRk8uCiAgICAgICAgY2ZvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ0ZPLW9ubHkgZnVuY3Rpb25hbGl0eS4KICAgIG1vZGlmaWVyIG9ubHlDRk8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNmb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ0ZPLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBjb250cmFjdCBvd25lci4KICAgIC8vLyBAcGFyYW0gX25ld0NGTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENGTy4KICAgIGZ1bmN0aW9uIHNldENGTyhhZGRyZXNzIF9uZXdDRk8pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfbmV3Q0ZPICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjZm9BZGRyZXNzID0gX25ld0NGTzsKICAgIH0KfQoKCi8vLyBAZGV2IERlZmluZXMgYmFzZSBkYXRhIHN0cnVjdHVyZXMgZm9yIERXb3JsZC4KY29udHJhY3QgTWV0YUdhbWVCYXNlIGlzIE1ldGFHYW1lQWNjZXNzQ29udHJvbCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBpZGVudGlmaWVyVG9Pd25lcjsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgaWRlbnRpZmllclRvQXBwcm92ZWQ7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIG93bmVyc2hpcERlZWRDb3VudDsKICAgIAogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBpZGVudGlmaWVyVG9QYXJlbnRJZGVudGlmaWVyOwogICAgCiAgICAvLy8gQGRldiBBbGwgZXhpc3RpbmcgaWRlbnRpZmllcnMuCiAgICB1aW50MjU2W10gcHVibGljIGlkZW50aWZpZXJzOwogICAgCiAgICAvLy8gQG5vdGljZSBHZXQgYWxsIG1pbnRlZCBpZGVudGlmaWVyczsKICAgIGZ1bmN0aW9uIGdldEFsbElkZW50aWZpZXJzKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTZbXSkgewogICAgICAgIHJldHVybiBpZGVudGlmaWVyczsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgaWRlbnRpZmllciBvZiB0aGUgcGFyZW50IG9mIGFuIGlkZW50aWZpZXIuCiAgICAvLy8gVGhlIHBhcmVudCBpZGVudGlmaWVyIGlzIDAgaWYgdGhlIGlkZW50aWZpZXIgaGFzIG5vIHBhcmVudC4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciB0byBnZXQgdGhlIHBhcmVudCBpZGVudGlmaWVyIG9mLgogICAgZnVuY3Rpb24gcGFyZW50T2YodWludDI1NiBpZGVudGlmaWVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYgcGFyZW50SWRlbnRpZmllcikgewogICAgICAgIHBhcmVudElkZW50aWZpZXIgPSBpZGVudGlmaWVyVG9QYXJlbnRJZGVudGlmaWVyW2lkZW50aWZpZXJdOwogICAgfQp9CgoKLy8vIEB0aXRsZSBJbnRlcmZhY2UgZm9yIGNvbnRyYWN0cyBjb25mb3JtaW5nIHRvIEVSQy03MjE6IERlZWQgU3RhbmRhcmQKLy8vIEBhdXRob3IgV2lsbGlhbSBFbnRyaWtlbiAoaHR0cHM6Ly9waG9yLm5ldCksIGV0IGFsLgovLy8gQGRldiBTcGVjaWZpY2F0aW9uIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL3B1bGwvODQxIChEUkFGVCkKaW50ZXJmYWNlIEVSQzcyMSB7CgogICAgLy8gQ09NUExJQU5DRSBXSVRIIEVSQy0xNjUgKERSQUZUKSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBpdHNlbGYKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSA9IC8vIDB4MDFmZmM5YTcKICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSA9IC8vIDB4ZGE2NzFiOWIKICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgIC8vICAgICBieXRlczQoa2VjY2FrMjU2KCdjb3VudE9mRGVlZHMoKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NignY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NignZGVlZE9mT3duZXJCeUluZGV4KGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1NigndGFrZU93bmVyc2hpcCh1aW50MjU2KScpKTsKCiAgICAvLy8gQG5vdGljZSBRdWVyeSBhIGNvbnRyYWN0IHRvIHNlZSBpZiBpdCBzdXBwb3J0cyBhIGNlcnRhaW4gaW50ZXJmYWNlCiAgICAvLy8gQGRldiBSZXR1cm5zIGB0cnVlYCB0aGUgaW50ZXJmYWNlIGlzIHN1cHBvcnRlZCBhbmQgYGZhbHNlYCBvdGhlcndpc2UsCiAgICAvLy8gIHJldHVybnMgYHRydWVgIGZvciBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSBhbmQKICAgIC8vLyAgSU5URVJGQUNFX1NJR05BVFVSRV9FUkM3MjEsIHNlZSBFUkMtMTY1IGZvciBvdGhlciBpbnRlcmZhY2Ugc2lnbmF0dXJlcy4KICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHB1cmUgcmV0dXJucyAoYm9vbCk7CgogICAgLy8gUFVCTElDIFFVRVJZIEZVTkNUSU9OUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEZpbmQgdGhlIG93bmVyIG9mIGEgZGVlZAogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIGZvciBhIGRlZWQgd2UgYXJlIGluc3BlY3RpbmcKICAgIC8vLyBAZGV2IERlZWRzIGFzc2lnbmVkIHRvIHplcm8gYWRkcmVzcyBhcmUgY29uc2lkZXJlZCBkZXN0cm95ZWQsIGFuZAogICAgLy8vICBxdWVyaWVzIGFib3V0IHRoZW0gZG8gdGhyb3cuCiAgICAvLy8gQHJldHVybiBUaGUgbm9uLXplcm8gYWRkcmVzcyBvZiB0aGUgb3duZXIgb2YgZGVlZCBgX2RlZWRJZGAsIG9yIGB0aHJvd2AKICAgIC8vLyAgaWYgZGVlZCBgX2RlZWRJZGAgaXMgbm90IHRyYWNrZWQgYnkgdGhpcyBjb250cmFjdAogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpOwoKICAgIC8vLyBAbm90aWNlIENvdW50IGRlZWRzIHRyYWNrZWQgYnkgdGhpcyBjb250cmFjdAogICAgLy8vIEByZXR1cm4gQSBjb3VudCBvZiB0aGUgZGVlZHMgdHJhY2tlZCBieSB0aGlzIGNvbnRyYWN0LCB3aGVyZSBlYWNoIG9uZSBvZgogICAgLy8vICB0aGVtIGhhcyBhbiBhc3NpZ25lZCBhbmQgcXVlcnlhYmxlIG93bmVyCiAgICBmdW5jdGlvbiBjb3VudE9mRGVlZHMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IF9jb3VudCk7CgogICAgLy8vIEBub3RpY2UgQ291bnQgYWxsIGRlZWRzIGFzc2lnbmVkIHRvIGFuIG93bmVyCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgYF9vd25lcmAgaXMgdGhlIHplcm8gYWRkcmVzcywgcmVwcmVzZW50aW5nIGRlc3Ryb3llZCBkZWVkcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIEFuIGFkZHJlc3Mgd2hlcmUgd2UgYXJlIGludGVyZXN0ZWQgaW4gZGVlZHMgb3duZWQgYnkgdGhlbQogICAgLy8vIEByZXR1cm4gVGhlIG51bWJlciBvZiBkZWVkcyBvd25lZCBieSBgX293bmVyYCwgcG9zc2libHkgemVybwogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzQnlPd25lcihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBfY291bnQpOwoKICAgIC8vLyBAbm90aWNlIEVudW1lcmF0ZSBkZWVkcyBhc3NpZ25lZCB0byBhbiBvd25lcgogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBfaW5kZXhgID49IGBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcilgIG9yIGlmCiAgICAvLy8gIGBfb3duZXJgIGlzIHRoZSB6ZXJvIGFkZHJlc3MsIHJlcHJlc2VudGluZyBkZXN0cm95ZWQgZGVlZHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciBBbiBhZGRyZXNzIHdoZXJlIHdlIGFyZSBpbnRlcmVzdGVkIGluIGRlZWRzIG93bmVkIGJ5IHRoZW0KICAgIC8vLyBAcGFyYW0gX2luZGV4IEEgY291bnRlciBiZXR3ZWVuIHplcm8gYW5kIGBjb3VudE9mRGVlZHNCeU93bmVyKF9vd25lcilgLAogICAgLy8vICBpbmNsdXNpdmUKICAgIC8vLyBAcmV0dXJuIFRoZSBpZGVudGlmaWVyIGZvciB0aGUgYF9pbmRleGB0aCBkZWVkIGFzc2lnbmVkIHRvIGBfb3duZXJgLAogICAgLy8vICAgKHNvcnQgb3JkZXIgbm90IHNwZWNpZmllZCkKICAgIGZ1bmN0aW9uIGRlZWRPZk93bmVyQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NiBfZGVlZElkKTsKCiAgICAvLyBUUkFOU0ZFUiBNRUNIQU5JU00gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgVGhpcyBldmVudCBlbWl0cyB3aGVuIG93bmVyc2hpcCBvZiBhbnkgZGVlZCBjaGFuZ2VzIGJ5IGFueQogICAgLy8vICBtZWNoYW5pc20uIFRoaXMgZXZlbnQgZW1pdHMgd2hlbiBkZWVkcyBhcmUgY3JlYXRlZCAoYGZyb21gID09IDApIGFuZAogICAgLy8vICBkZXN0cm95ZWQgKGB0b2AgPT0gMCkuIEV4Y2VwdGlvbjogZHVyaW5nIGNvbnRyYWN0IGNyZWF0aW9uLCBhbnkKICAgIC8vLyAgdHJhbnNmZXJzIG1heSBvY2N1ciB3aXRob3V0IGVtaXR0aW5nIGBUcmFuc2ZlcmAuCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgZGVlZElkKTsKCiAgICAvLy8gQGRldiBUaGlzIGV2ZW50IGVtaXRzIG9uIGFueSBzdWNjZXNzZnVsIGNhbGwgdG8KICAgIC8vLyAgYGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfZGVlZElkKWAuIEV4Y2VwdGlvbjogZG9lcyBub3QgZW1pdAogICAgLy8vICBpZiBhbiBvd25lciByZXZva2VzIGFwcHJvdmFsIChgX3RvYCA9PSAweDApIG9uIGEgZGVlZCB3aXRoIG5vIGV4aXN0aW5nCiAgICAvLy8gIGFwcHJvdmFsLgogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgaW5kZXhlZCBkZWVkSWQpOwoKICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYSBuZXcgb3duZXIgdG8gdGFrZSB5b3VyIGRlZWQsIG9yIHJldm9rZSBhcHByb3ZhbCBieQogICAgLy8vICBzZXR0aW5nIHRoZSB6ZXJvIGFkZHJlc3MuIFlvdSBtYXkgYGFwcHJvdmVgIGFueSBudW1iZXIgb2YgdGltZXMgd2hpbGUKICAgIC8vLyAgdGhlIGRlZWQgaXMgYXNzaWduZWQgdG8geW91LCBvbmx5IHRoZSBtb3N0IHJlY2VudCBhcHByb3ZhbCBtYXR0ZXJzLgogICAgLy8vIEBkZXYgVGhyb3dzIGlmIGBtc2cuc2VuZGVyYCBkb2VzIG5vdCBvd24gZGVlZCBgX2RlZWRJZGAgb3IgaWYgYF90b2AgPT0KICAgIC8vLyAgYG1zZy5zZW5kZXJgLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBkZWVkIHlvdSBhcmUgZ3JhbnRpbmcgb3duZXJzaGlwIG9mCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsOwoKICAgIC8vLyBAbm90aWNlIEJlY29tZSBvd25lciBvZiBhIGRlZWQgZm9yIHdoaWNoIHlvdSBhcmUgY3VycmVudGx5IGFwcHJvdmVkCiAgICAvLy8gQGRldiBUaHJvd3MgaWYgYG1zZy5zZW5kZXJgIGlzIG5vdCBhcHByb3ZlZCB0byBiZWNvbWUgdGhlIG93bmVyIG9mCiAgICAvLy8gIGBkZWVkSWRgIG9yIGlmIGBtc2cuc2VuZGVyYCBjdXJyZW50bHkgb3ducyBgX2RlZWRJZGAuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGRlZWQgdGhhdCBpcyBiZWluZyB0cmFuc2ZlcnJlZAogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsOwogICAgCiAgICAvLyBTUEVDIEVYVEVOU0lPTlMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgZGVlZCB0byBhIG5ldyBvd25lci4KICAgIC8vLyBAZGV2IFRocm93cyBpZiBgbXNnLnNlbmRlcmAgZG9lcyBub3Qgb3duIGRlZWQgYF9kZWVkSWRgIG9yIGlmCiAgICAvLy8gIGBfdG9gID09IDB4MC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGRlZWQgeW91IGFyZSB0cmFuc2ZlcnJpbmcuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBleHRlcm5hbDsKfQoKCi8vLyBAdGl0bGUgTWV0YWRhdGEgZXh0ZW5zaW9uIHRvIEVSQy03MjEgaW50ZXJmYWNlCi8vLyBAYXV0aG9yIFdpbGxpYW0gRW50cmlrZW4gKGh0dHBzOi8vcGhvci5uZXQpCi8vLyBAZGV2IFNwZWNpZmljYXRpb24gYXQgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvcHVsbC84NDEgKERSQUZUKQppbnRlcmZhY2UgRVJDNzIxTWV0YWRhdGEgewoKICAgIC8vLyBAZGV2IEVSQy0xNjUgKGRyYWZ0KSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkM3MjEKICAgIC8vIGJ5dGVzNCBpbnRlcm5hbCBjb25zdGFudCBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU1ldGFkYXRhID0gLy8gMHgyYTc4NmYxMQogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICAvLyAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3ltYm9sKCknKSkgXgogICAgLy8gICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2RlZWRVcmkodWludDI1NiknKSk7CgogICAgLy8vIEBub3RpY2UgQSBkZXNjcmlwdGl2ZSBuYW1lIGZvciBhIGNvbGxlY3Rpb24gb2YgZGVlZHMgbWFuYWdlZCBieSB0aGlzCiAgICAvLy8gIGNvbnRyYWN0CiAgICAvLy8gQGRldiBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9kZWVkTmFtZSk7CgogICAgLy8vIEBub3RpY2UgQW4gYWJicmV2aWF0ZWQgbmFtZSBmb3IgZGVlZHMgbWFuYWdlZCBieSB0aGlzIGNvbnRyYWN0CiAgICAvLy8gQGRldiBXYWxsZXRzIGFuZCBleGNoYW5nZXMgTUFZIGRpc3BsYXkgdGhpcyB0byB0aGUgZW5kIHVzZXIuCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgcHVyZSByZXR1cm5zIChzdHJpbmcgX2RlZWRTeW1ib2wpOwoKICAgIC8vLyBAbm90aWNlIEEgZGlzdGluY3QgVVJJIChSRkMgMzk4NikgZm9yIGEgZ2l2ZW4gdG9rZW4uCiAgICAvLy8gQGRldiBJZjoKICAgIC8vLyAgKiBUaGUgVVJJIGlzIGEgVVJMCiAgICAvLy8gICogVGhlIFVSTCBpcyBhY2Nlc3NpYmxlCiAgICAvLy8gICogVGhlIFVSTCBwb2ludHMgdG8gYSB2YWxpZCBKU09OIGZpbGUgZm9ybWF0IChFQ01BLTQwNCAybmQgZWQuKQogICAgLy8vICAqIFRoZSBKU09OIGJhc2UgZWxlbWVudCBpcyBhbiBvYmplY3QKICAgIC8vLyAgdGhlbiB0aGVzZSBuYW1lcyBvZiB0aGUgYmFzZSBlbGVtZW50IFNIQUxMIGhhdmUgc3BlY2lhbCBtZWFuaW5nOgogICAgLy8vICAqICJuYW1lIjogQSBzdHJpbmcgaWRlbnRpZnlpbmcgdGhlIGl0ZW0gdG8gd2hpY2ggYF9kZWVkSWRgIGdyYW50cwogICAgLy8vICAgIG93bmVyc2hpcAogICAgLy8vICAqICJkZXNjcmlwdGlvbiI6IEEgc3RyaW5nIGRldGFpbGluZyB0aGUgaXRlbSB0byB3aGljaCBgX2RlZWRJZGAgZ3JhbnRzCiAgICAvLy8gICAgb3duZXJzaGlwCiAgICAvLy8gICogImltYWdlIjogQSBVUkkgcG9pbnRpbmcgdG8gYSBmaWxlIG9mIGltYWdlLyogbWltZSB0eXBlIHJlcHJlc2VudGluZwogICAgLy8vICAgIHRoZSBpdGVtIHRvIHdoaWNoIGBfZGVlZElkYCBncmFudHMgb3duZXJzaGlwCiAgICAvLy8gIFdhbGxldHMgYW5kIGV4Y2hhbmdlcyBNQVkgZGlzcGxheSB0aGlzIHRvIHRoZSBlbmQgdXNlci4KICAgIC8vLyAgQ29uc2lkZXIgbWFraW5nIGFueSBpbWFnZXMgYXQgYSB3aWR0aCBiZXR3ZWVuIDMyMCBhbmQgMTA4MCBwaXhlbHMgYW5kCiAgICAvLy8gIGFzcGVjdCByYXRpbyBiZXR3ZWVuIDEuOTE6MSBhbmQgNDo1IGluY2x1c2l2ZS4KICAgIGZ1bmN0aW9uIGRlZWRVcmkodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCBwdXJlIHJldHVybnMgKHN0cmluZyBfdXJpKTsKfQoKCi8vLyBAZGV2IEhvbGRzIGRlZWQgZnVuY3Rpb25hbGl0eSBzdWNoIGFzIGFwcHJvdmluZyBhbmQgdHJhbnNmZXJyaW5nLiBJbXBsZW1lbnRzIEVSQzcyMS4KY29udHJhY3QgTWV0YUdhbWVEZWVkIGlzIE1ldGFHYW1lQmFzZSwgRVJDNzIxLCBFUkM3MjFNZXRhZGF0YSB7CiAgICAKICAgIC8vLyBAbm90aWNlIE5hbWUgb2YgdGhlIGNvbGxlY3Rpb24gb2YgZGVlZHMgKG5vbi1mdW5naWJsZSB0b2tlbiksIGFzIGRlZmluZWQgaW4gRVJDNzIxTWV0YWRhdGEuCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHB1cmUgcmV0dXJucyAoc3RyaW5nIF9kZWVkTmFtZSkgewogICAgICAgIF9kZWVkTmFtZSA9ICJNZXRhR2FtZSI7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFN5bWJvbCBvZiB0aGUgY29sbGVjdGlvbiBvZiBkZWVkcyAobm9uLWZ1bmdpYmxlIHRva2VuKSwgYXMgZGVmaW5lZCBpbiBFUkM3MjFNZXRhZGF0YS4KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHN0cmluZyBfZGVlZFN5bWJvbCkgewogICAgICAgIF9kZWVkU3ltYm9sID0gIk1HIjsKICAgIH0KICAgIAogICAgLy8vIEBkZXYgRVJDLTE2NSAoZHJhZnQpIGludGVyZmFjZSBzaWduYXR1cmUgZm9yIGl0c2VsZgogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDMTY1ID0gLy8gMHgwMWZmYzlhNwogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3N1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCknKSk7CgogICAgLy8vIEBkZXYgRVJDLTE2NSAoZHJhZnQpIGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQzcyMQogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxID0gLy8gMHhkYTY3MWI5YgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ293bmVyT2YodWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2NvdW50T2ZEZWVkcygpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdjb3VudE9mRGVlZHNCeU93bmVyKGFkZHJlc3MpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdkZWVkT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignYXBwcm92ZShhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCd0YWtlT3duZXJzaGlwKHVpbnQyNTYpJykpOwogICAgICAgIAogICAgLy8vIEBkZXYgRVJDLTE2NSAoZHJhZnQpIGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQzcyMQogICAgYnl0ZXM0IGludGVybmFsIGNvbnN0YW50IElOVEVSRkFDRV9TSUdOQVRVUkVfRVJDNzIxTWV0YWRhdGEgPSAvLyAweDJhNzg2ZjExCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignbmFtZSgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignZGVlZFVyaSh1aW50MjU2KScpKTsKICAgIAogICAgLy8vIEBub3RpY2UgSW50cm9zcGVjdGlvbiBpbnRlcmZhY2UgYXMgcGVyIEVSQy0xNjUgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpLgogICAgLy8vIFJldHVybnMgdHJ1ZSBmb3IgYW55IHN0YW5kYXJkaXplZCBpbnRlcmZhY2VzIGltcGxlbWVudGVkIGJ5IHRoaXMgY29udHJhY3QuCiAgICAvLy8gKEVSQy0xNjUgYW5kIEVSQy03MjEuKQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgKF9pbnRlcmZhY2VJRCA9PSBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzE2NSkKICAgICAgICAgICAgfHwgKF9pbnRlcmZhY2VJRCA9PSBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMSkKICAgICAgICAgICAgfHwgKF9pbnRlcmZhY2VJRCA9PSBJTlRFUkZBQ0VfU0lHTkFUVVJFX0VSQzcyMU1ldGFkYXRhKQogICAgICAgICk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3Mgb3ducyBhIHBhcnRpY3VsYXIgZGVlZC4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBvd25lciB0byBjaGVjayBmb3IuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGRlZWQgaWRlbnRpZmllciB0byBjaGVjayBmb3IuCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9vd25lciwgdWludDI1NiBfZGVlZElkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF0gPT0gX293bmVyOwogICAgfQogICAgCiAgICAvLy8gQGRldiBBcHByb3ZlIGEgZ2l2ZW4gYWRkcmVzcyB0byB0YWtlIG93bmVyc2hpcCBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGFwcHJvdmluZyB0YWtpbmcgb3duZXJzaGlwLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYXBwcm92ZSB0YWtpbmcgb3duZXJzaGlwLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGdpdmUgYXBwcm92YWwgZm9yLgogICAgZnVuY3Rpb24gX2FwcHJvdmUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIGlkZW50aWZpZXJUb0FwcHJvdmVkW19kZWVkSWRdID0gX3RvOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgZXZlbnQuCiAgICAgICAgQXBwcm92YWwoX2Zyb20sIF90bywgX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgaGFzIGFwcHJvdmFsIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgZGVlZC4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IFRoZSBhZGRyZXNzIG9mIHRoZSBjbGFpbWFudCB0byBjaGVjayBmb3IuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gY2hlY2sgZm9yLgogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF9kZWVkSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBpZGVudGlmaWVyVG9BcHByb3ZlZFtfZGVlZElkXSA9PSBfY2xhaW1hbnQ7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IEFzc2lnbnMgb3duZXJzaGlwIG9mIGEgc3BlY2lmaWMgZGVlZCB0byBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0aGUgZGVlZCBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdGhlIGRlZWQgdG8uCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2RlZWRJZCkgaW50ZXJuYWwgewogICAgICAgIC8vIFRoZSBudW1iZXIgb2YgZGVlZHMgaXMgY2FwcGVkIGF0IHJvd3MgKiBjb2xzLCBzbyB0aGlzIGNhbm5vdAogICAgICAgIC8vIGJlIG92ZXJmbG93ZWQgaWYgdGhvc2UgcGFyYW1ldGVycyBhcmUgc2Vuc2libGUuCiAgICAgICAgb3duZXJzaGlwRGVlZENvdW50W190b10rKzsKICAgICAgICAKICAgICAgICAvLyBUcmFuc2ZlciBvd25lcnNoaXAuCiAgICAgICAgaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF0gPSBfdG87CiAgICAgICAgCiAgICAgICAgLy8gV2hlbiBhIG5ldyBkZWVkIGlzIG1pbnRlZCwgdGhlIF9mcm9tIGFkZHJlc3MgaXMgMHgwLCBidXQgd2UKICAgICAgICAvLyBkbyBub3QgdHJhY2sgZGVlZCBvd25lcnNoaXAgb2YgMHgwLgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyc2hpcERlZWRDb3VudFtfZnJvbV0tLTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENsZWFyIHRha2luZyBvd25lcnNoaXAgYXBwcm92YWwuCiAgICAgICAgICAgIGRlbGV0ZSBpZGVudGlmaWVyVG9BcHByb3ZlZFtfZGVlZElkXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gRW1pdCB0aGUgdHJhbnNmZXIgZXZlbnQuCiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2RlZWRJZCk7CiAgICB9CiAgICAKICAgIC8vIEVSQyA3MjEgaW1wbGVtZW50YXRpb24KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIGRlZWRzIGN1cnJlbnRseSBpbiBleGlzdGVuY2UuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gY291bnRPZkRlZWRzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBpZGVudGlmaWVycy5sZW5ndGg7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIG51bWJlciBvZiBkZWVkcyBvd25lZCBieSBhIHNwZWNpZmljIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgb3duZXIgYWRkcmVzcyB0byBjaGVjay4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UKICAgIGZ1bmN0aW9uIGNvdW50T2ZEZWVkc0J5T3duZXIoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gb3duZXJzaGlwRGVlZENvdW50W19vd25lcl07CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIGFkZHJlc3MgY3VycmVudGx5IGFzc2lnbmVkIG93bmVyc2hpcCBvZiBhIGdpdmVuIGRlZWQuCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBfb3duZXIpIHsKICAgICAgICBfb3duZXIgPSBpZGVudGlmaWVyVG9Pd25lcltfZGVlZElkXTsKCiAgICAgICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYSBnaXZlbiBhZGRyZXNzIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgZGVlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGFwcHJvdmUgdGFraW5nIG93ZXJuc2hpcC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byBnaXZlIGFwcHJvdmFsIGZvci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9kZWVkSWQpIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgX2RlZWRJZHMgPSBuZXcgdWludDI1NltdKDEpOwogICAgICAgIF9kZWVkSWRzWzBdID0gX2RlZWRJZDsKICAgICAgICAKICAgICAgICBhcHByb3ZlTXVsdGlwbGUoX3RvLCBfZGVlZElkcyk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYSBnaXZlbiBhZGRyZXNzIHRvIHRha2Ugb3duZXJzaGlwIG9mIG11bHRpcGxlIGRlZWRzLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gYXBwcm92ZSB0YWtpbmcgb3duZXJzaGlwLgogICAgLy8vIEBwYXJhbSBfZGVlZElkcyBUaGUgaWRlbnRpZmllcnMgb2YgdGhlIGRlZWRzIHRvIGdpdmUgYXBwcm92YWwgZm9yLgogICAgZnVuY3Rpb24gYXBwcm92ZU11bHRpcGxlKGFkZHJlc3MgX3RvLCB1aW50MjU2W10gX2RlZWRJZHMpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBFbnN1cmUgdGhlIHNlbmRlciBpcyBub3QgYXBwcm92aW5nIHRoZW1zZWx2ZXMuCiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyICE9IF90byk7CiAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfZGVlZElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50MjU2IF9kZWVkSWQgPSBfZGVlZElkc1tpXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlcXVpcmUgdGhlIHNlbmRlciBpcyB0aGUgb3duZXIgb2YgdGhlIGRlZWQuCiAgICAgICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2RlZWRJZCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUGVyZm9ybSB0aGUgYXBwcm92YWwuCiAgICAgICAgICAgIF9hcHByb3ZlKG1zZy5zZW5kZXIsIF90bywgX2RlZWRJZCk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBUcmFuc2ZlciBhIGRlZWQgdG8gYW5vdGhlciBhZGRyZXNzLiBJZiB0cmFuc2ZlcnJpbmcgdG8gYSBzbWFydAogICAgLy8vIGNvbnRyYWN0IGJlIFZFUlkgQ0FSRUZVTCB0byBlbnN1cmUgdGhhdCBpdCBpcyBhd2FyZSBvZiBFUkMtNzIxLCBvciB5b3VyCiAgICAvLy8gZGVlZCBtYXkgYmUgbG9zdCBmb3JldmVyLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudCwgY2FuIGJlIGEgdXNlciBvciBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX2RlZWRJZCBUaGUgaWRlbnRpZmllciBvZiB0aGUgZGVlZCB0byB0cmFuc2Zlci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IF9kZWVkSWRzID0gbmV3IHVpbnQyNTZbXSgxKTsKICAgICAgICBfZGVlZElkc1swXSA9IF9kZWVkSWQ7CiAgICAgICAgCiAgICAgICAgdHJhbnNmZXJNdWx0aXBsZShfdG8sIF9kZWVkSWRzKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVHJhbnNmZXJzIG11bHRpcGxlIGRlZWRzIHRvIGFub3RoZXIgYWRkcmVzcy4gSWYgdHJhbnNmZXJyaW5nIHRvCiAgICAvLy8gYSBzbWFydCBjb250cmFjdCBiZSBWRVJZIENBUkVGVUwgdG8gZW5zdXJlIHRoYXQgaXQgaXMgYXdhcmUgb2YgRVJDLTcyMSwKICAgIC8vLyBvciB5b3VyIGRlZWRzIG1heSBiZSBsb3N0IGZvcmV2ZXIuCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LCBjYW4gYmUgYSB1c2VyIG9yIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfZGVlZElkcyBUaGUgaWRlbnRpZmllcnMgb2YgdGhlIGRlZWRzIHRvIHRyYW5zZmVyLgogICAgZnVuY3Rpb24gdHJhbnNmZXJNdWx0aXBsZShhZGRyZXNzIF90bywgdWludDI1NltdIF9kZWVkSWRzKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIAogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfZGVlZElkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50MjU2IF9kZWVkSWQgPSBfZGVlZElkc1tpXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE9uZSBjYW4gb25seSB0cmFuc2ZlciB0aGVpciBvd24gZGVlZHMuCiAgICAgICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX2RlZWRJZCkpOwoKICAgICAgICAgICAgLy8gVHJhbnNmZXIgb3duZXJzaGlwCiAgICAgICAgICAgIF90cmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9kZWVkSWQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBkZWVkIG93bmVkIGJ5IGFub3RoZXIgYWRkcmVzcywgZm9yIHdoaWNoIHRoZSBjYWxsaW5nCiAgICAvLy8gYWRkcmVzcyBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZGVlZElkIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRha2VPd25lcnNoaXAodWludDI1NiBfZGVlZElkKSBleHRlcm5hbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICB1aW50MjU2W10gbWVtb3J5IF9kZWVkSWRzID0gbmV3IHVpbnQyNTZbXSgxKTsKICAgICAgICBfZGVlZElkc1swXSA9IF9kZWVkSWQ7CiAgICAgICAgCiAgICAgICAgdGFrZU93bmVyc2hpcE11bHRpcGxlKF9kZWVkSWRzKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgbXVsdGlwbGUgZGVlZHMgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlCiAgICAvLy8gY2FsbGluZyBhZGRyZXNzIGhhcyBwcmV2aW91c2x5IGJlZW4gZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbCBieSB0aGUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWRzIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIGJlIHRyYW5zZmVycmVkLgogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcE11bHRpcGxlKHVpbnQyNTZbXSBfZGVlZElkcykgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9kZWVkSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgX2RlZWRJZCA9IF9kZWVkSWRzW2ldOwogICAgICAgICAgICBhZGRyZXNzIF9mcm9tID0gaWRlbnRpZmllclRvT3duZXJbX2RlZWRJZF07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBDaGVjayBmb3IgdHJhbnNmZXIgYXBwcm92YWwKICAgICAgICAgICAgcmVxdWlyZShfYXBwcm92ZWRGb3IobXNnLnNlbmRlciwgX2RlZWRJZCkpOwoKICAgICAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgICAgICBfdHJhbnNmZXIoX2Zyb20sIG1zZy5zZW5kZXIsIF9kZWVkSWQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJucyBhIGxpc3Qgb2YgYWxsIGRlZWQgaWRlbnRpZmllcnMgYXNzaWduZWQgdG8gYW4gYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciB3aG9zZSBkZWVkcyB3ZSBhcmUgaW50ZXJlc3RlZCBpbi4KICAgIC8vLyBAZGV2IFRoaXMgbWV0aG9kIE1VU1QgTkVWRVIgYmUgY2FsbGVkIGJ5IHNtYXJ0IGNvbnRyYWN0IGNvZGUuIEl0J3MgdmVyeQogICAgLy8vIGV4cGVuc2l2ZSBhbmQgaXMgbm90IHN1cHBvcnRlZCBpbiBjb250cmFjdC10by1jb250cmFjdCBjYWxscyBhcyBpdCByZXR1cm5zCiAgICAvLy8gYSBkeW5hbWljIGFycmF5IChvbmx5IHN1cHBvcnRlZCBmb3Igd2ViMyBjYWxscykuCiAgICBmdW5jdGlvbiBkZWVkc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10pIHsKICAgICAgICB1aW50MjU2IGRlZWRDb3VudCA9IGNvdW50T2ZEZWVkc0J5T3duZXIoX293bmVyKTsKCiAgICAgICAgaWYgKGRlZWRDb3VudCA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheS4KICAgICAgICAgICAgcmV0dXJuIG5ldyB1aW50MjU2W10oMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NltdIG1lbW9yeSByZXN1bHQgPSBuZXcgdWludDI1NltdKGRlZWRDb3VudCk7CiAgICAgICAgICAgIHVpbnQyNTYgdG90YWxEZWVkcyA9IGNvdW50T2ZEZWVkcygpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAodWludDI1NiBkZWVkTnVtYmVyID0gMDsgZGVlZE51bWJlciA8IHRvdGFsRGVlZHM7IGRlZWROdW1iZXIrKykgewogICAgICAgICAgICAgICAgdWludDI1NiBpZGVudGlmaWVyID0gaWRlbnRpZmllcnNbZGVlZE51bWJlcl07CiAgICAgICAgICAgICAgICBpZiAoaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IGlkZW50aWZpZXI7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBkZWVkIGlkZW50aWZpZXIgb2YgdGhlIG93bmVyIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIG9mIHRoZSBvd25lciB3ZSB3YW50IHRvIGdldCBhIGRlZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfaW5kZXggVGhlIGluZGV4IG9mIHRoZSBkZWVkIHdlIHdhbnQuCiAgICBmdW5jdGlvbiBkZWVkT2ZPd25lckJ5SW5kZXgoYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICAvLyBUaGUgaW5kZXggc2hvdWxkIGJlIHZhbGlkLgogICAgICAgIHJlcXVpcmUoX2luZGV4IDwgY291bnRPZkRlZWRzQnlPd25lcihfb3duZXIpKTsKCiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBkZWVkcywgYWNjb3VudGluZyB0aGUgbnVtYmVyIG9mIGRlZWRzIG9mIHRoZSBvd25lciB3ZSd2ZSBzZWVuLgogICAgICAgIHVpbnQyNTYgc2VlbiA9IDA7CiAgICAgICAgdWludDI1NiB0b3RhbERlZWRzID0gY291bnRPZkRlZWRzKCk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGRlZWROdW1iZXIgPSAwOyBkZWVkTnVtYmVyIDwgdG90YWxEZWVkczsgZGVlZE51bWJlcisrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgaWRlbnRpZmllciA9IGlkZW50aWZpZXJzW2RlZWROdW1iZXJdOwogICAgICAgICAgICBpZiAoaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl0gPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VlbiA9PSBfaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWRlbnRpZmllcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VlbisrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIGFuIChvZmYtY2hhaW4pIG1ldGFkYXRhIHVybCBmb3IgdGhlIGdpdmVuIGRlZWQuCiAgICAvLy8gQHBhcmFtIF9kZWVkSWQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gZ2V0IHRoZSBtZXRhZGF0YQogICAgLy8vIHVybCBmb3IuCiAgICAvLy8gQGRldiBJbXBsZW1lbnRhdGlvbiBvZiBvcHRpb25hbCBFUkMtNzIxIGZ1bmN0aW9uYWxpdHkuCiAgICBmdW5jdGlvbiBkZWVkVXJpKHVpbnQyNTYgX2RlZWRJZCkgZXh0ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcgdXJpKSB7CiAgICAgICAgLy8gQXNzdW1lIGEgbWF4aW11bSBkZWVkIGlkIGxlbmd0aC4KICAgICAgICByZXF1aXJlIChfZGVlZElkIDwgMTAwMDAwMCk7CiAgICAgICAgCiAgICAgICAgdXJpID0gImh0dHBzOi8vbWV0YS5xdWF6ci5pby9jYXJkL3h4eHh4eHgiOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfdXJpID0gYnl0ZXModXJpKTsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCA3OyBpKyspIHsKICAgICAgICAgICAgX3VyaVszMyAtIGldID0gYnl0ZSg0OCArIChfZGVlZElkIC8gMTAgKiogaSkgJSAxMCk7CiAgICAgICAgfQogICAgfQp9CgoKLyoqCiAqIEB0aXRsZSBQdWxsUGF5bWVudAogKiBAZGV2IEJhc2UgY29udHJhY3Qgc3VwcG9ydGluZyBhc3luYyBzZW5kIGZvciBwdWxsIHBheW1lbnRzLiBJbmhlcml0IGZyb20gdGhpcwogKiBjb250cmFjdCBhbmQgdXNlIGFzeW5jU2VuZCBpbnN0ZWFkIG9mIHNlbmQuCiAqLwpjb250cmFjdCBQdWxsUGF5bWVudCB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgcGF5bWVudHM7CiAgdWludDI1NiBwdWJsaWMgdG90YWxQYXltZW50czsKCiAgLyoqCiAgKiBAZGV2IHdpdGhkcmF3IGFjY3VtdWxhdGVkIGJhbGFuY2UsIGNhbGxlZCBieSBwYXllZS4KICAqLwogIGZ1bmN0aW9uIHdpdGhkcmF3UGF5bWVudHMoKSBwdWJsaWMgewogICAgYWRkcmVzcyBwYXllZSA9IG1zZy5zZW5kZXI7CiAgICB1aW50MjU2IHBheW1lbnQgPSBwYXltZW50c1twYXllZV07CgogICAgcmVxdWlyZShwYXltZW50ICE9IDApOwogICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gcGF5bWVudCk7CgogICAgdG90YWxQYXltZW50cyA9IHRvdGFsUGF5bWVudHMuc3ViKHBheW1lbnQpOwogICAgcGF5bWVudHNbcGF5ZWVdID0gMDsKCiAgICBhc3NlcnQocGF5ZWUuc2VuZChwYXltZW50KSk7CiAgfQoKICAvKioKICAqIEBkZXYgQ2FsbGVkIGJ5IHRoZSBwYXllciB0byBzdG9yZSB0aGUgc2VudCBhbW91bnQgYXMgY3JlZGl0IHRvIGJlIHB1bGxlZC4KICAqIEBwYXJhbSBkZXN0IFRoZSBkZXN0aW5hdGlvbiBhZGRyZXNzIG9mIHRoZSBmdW5kcy4KICAqIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCB0byB0cmFuc2Zlci4KICAqLwogIGZ1bmN0aW9uIGFzeW5jU2VuZChhZGRyZXNzIGRlc3QsIHVpbnQyNTYgYW1vdW50KSBpbnRlcm5hbCB7CiAgICBwYXltZW50c1tkZXN0XSA9IHBheW1lbnRzW2Rlc3RdLmFkZChhbW91bnQpOwogICAgdG90YWxQYXltZW50cyA9IHRvdGFsUGF5bWVudHMuYWRkKGFtb3VudCk7CiAgfQp9CgoKLy8vIEBkZXYgRGVmaW5lcyBiYXNlIGRhdGEgc3RydWN0dXJlcyBmb3IgRFdvcmxkLgpjb250cmFjdCBNZXRhR2FtZUZpbmFuY2UgaXMgTWV0YUdhbWVEZWVkLCBQdWxsUGF5bWVudCB7CiAgICAvLy8gQG5vdGljZSBUaGUgZGl2aWRlbmQgZ2l2ZW4gdG8gYWxsIHBhcmVudHMgb2YgYSBkZWVkLCAKICAgIC8vLyBpbiAxLzEwMDB0aCBvZiBhIHBlcmNlbnRhZ2UuCiAgICB1aW50MjU2IHB1YmxpYyBkaXZpZGVuZFBlcmNlbnRhZ2UgPSAxMDAwOwogICAgCiAgICAvLy8gQG5vdGljZSBUaGUgbWluaW11bSBmZWUgZm9yIHRoZSBjb250cmFjdCBpbiAxLzEwMDB0aAogICAgLy8vIG9mIGEgcGVyY2VudGFnZS4KICAgIHVpbnQyNTYgcHVibGljIG1pbmltdW1GZWUgPSAyNTAwOwogICAgCiAgICAvLy8gQG5vdGljZSBUaGUgbWluaW11bSB0b3RhbCBwYWlkIGluIGZlZXMgYW5kIGRpdmlkZW5kcy4KICAgIC8vLyBJZiB0aGVyZSBhcmUgKGFsbW9zdCkgbm8gZGl2aWRlbmRzIHRvIGJlIHBhaWQsIHRoZSBmZWUKICAgIC8vLyBmb3IgdGhlIGNvbnRyYWN0IGlzIGhpZ2hlci4gVGhpcyBoYXBwZW5zIGZvciBkZWVkcyBhdAogICAgLy8vIG9yIG5lYXIgdGhlIHRvcCBvZiB0aGUgaGllcmFyY2h5LiBJbiAxLzEwMDB0aCBvZiBhCiAgICAvLy8gcGVyY2VudGFnZS4KICAgIHVpbnQyNTYgcHVibGljIG1pbmltdW1GZWVQbHVzRGl2aWRlbmRzID0gNzAwMDsKICAgIAogICAgLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBkZWVkIGlkZW50aWZpZXJzIHRvIHRoZSBidXlvdXQgcHJpY2UuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBpZGVudGlmaWVyVG9QcmljZTsKICAgIAogICAgLy8vIEBub3RpY2UgVGhlIHRocmVzaG9sZCBmb3IgYSBwYXltZW50IHRvIGJlIHNlbnQgZGlyZWN0bHksCiAgICAvLy8gaW5zdGVhZCBvZiBhZGRlZCB0byBhIGJlbmVmaWNpYXJ5J3MgYmFsYW5jZS4KICAgIHVpbnQyNTYgcHVibGljIGRpcmVjdFBheW1lbnRUaHJlc2hvbGQgPSAwIGV0aGVyOwogICAgCiAgICAvLy8gQG5vdGljZSBCb29sZWFuIGluZGljYXRpbmcgd2hldGhlciBkZWVkIHByaWNlIGNhbiBiZSBjaGFuZ2VkCiAgICAvLy8gbWFudWFsbHkuCiAgICBib29sIHB1YmxpYyBhbGxvd0NoYW5nZVByaWNlID0gZmFsc2U7CiAgICAKICAgIC8vLyBAbm90aWNlIFRoZSBtYXhpbXVtIGRlcHRoIGZvciB3aGljaCBkaXZpZGVuZHMgd2lsbCBiZSBwYWlkIHRvIHBhcmVudHMuCiAgICB1aW50MjU2IHB1YmxpYyBtYXhEaXZpZGVuZERlcHRoID0gNjsKICAgIAogICAgLy8vIEBkZXYgVGhpcyBldmVudCBpcyBlbWl0dGVkIHdoZW4gYSBkZWVkJ3MgYnV5b3V0IHByaWNlIGlzIGluaXRpYWxseSBzZXQgb3IgY2hhbmdlZC4KICAgIGV2ZW50IFByaWNlKHVpbnQyNTYgaW5kZXhlZCBpZGVudGlmaWVyLCB1aW50MjU2IHByaWNlLCB1aW50MjU2IG5leHRQcmljZSk7CiAgICAKICAgIC8vLyBAZGV2IFRoaXMgZXZlbnQgaXMgZW1pdHRlZCB3aGVuIGEgZGVlZCBpcyBib3VnaHQgb3V0LgogICAgZXZlbnQgQnV5KGFkZHJlc3MgaW5kZXhlZCBvbGRPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyLCB1aW50MjU2IGluZGV4ZWQgaWRlbnRpZmllciwgdWludDI1NiBwcmljZSwgdWludDI1NiBvd25lcldpbm5pbmdzKTsKICAgIAogICAgLy8vIEBkZXYgVGhpcyBldmVudCBpcyBlbWl0dGVkIHdoZW4gYSBkaXZpZGVuZCBpcyBwYWlkLgogICAgZXZlbnQgRGl2aWRlbmRQYWlkKGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiBpbmRleGVkIGlkZW50aWZpZXJCb3VnaHQsIHVpbnQyNTYgaW5kZXhlZCBpZGVudGlmaWVyLCB1aW50MjU2IGRpdmlkZW5kKTsKICAgIAogICAgLy8vIEBub3RpY2UgU2V0IHRoZSB0aHJlc2hvbGQgZm9yIGEgcGF5bWVudCB0byBiZSBzZW50IGRpcmVjdGx5LgogICAgLy8vIEBwYXJhbSB0aHJlc2hvbGQgVGhlIHRocmVzaG9sZCBmb3IgYSBwYXltZW50IHRvIGJlIHNlbnQgZGlyZWN0bHkuCiAgICBmdW5jdGlvbiBzZXREaXJlY3RQYXltZW50VGhyZXNob2xkKHVpbnQyNTYgdGhyZXNob2xkKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICBkaXJlY3RQYXltZW50VGhyZXNob2xkID0gdGhyZXNob2xkOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXQgd2hldGhlciBwcmljZXMgY2FuIGJlIGNoYW5nZWQgbWFudWFsbHkuCiAgICAvLy8gQHBhcmFtIF9hbGxvd0NoYW5nZVByaWNlIEJvb2wgaW5kaWNpYXRpbmcgd2V0aGVyIHByaWNlcyBjYW4gYmUgY2hhbmdlZCBtYW51YWxseS4KICAgIGZ1bmN0aW9uIHNldEFsbG93Q2hhbmdlUHJpY2UoYm9vbCBfYWxsb3dDaGFuZ2VQcmljZSkgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgYWxsb3dDaGFuZ2VQcmljZSA9IF9hbGxvd0NoYW5nZVByaWNlOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBTZXQgdGhlIG1heGltdW0gZGl2aWRlbmQgZGVwdGguCiAgICAvLy8gQHBhcmFtIF9tYXhEaXZpZGVuZERlcHRoIFRoZSBtYXhpbXVtIGRpdmlkZW5kIGRlcHRoLgogICAgZnVuY3Rpb24gc2V0TWF4RGl2aWRlbmREZXB0aCh1aW50MjU2IF9tYXhEaXZpZGVuZERlcHRoKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICBtYXhEaXZpZGVuZERlcHRoID0gX21heERpdmlkZW5kRGVwdGg7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIENhbGN1bGF0ZSB0aGUgbmV4dCBwcmljZSBnaXZlbiB0aGUgY3VycmVudCBwcmljZS4KICAgIC8vLyBAcGFyYW0gY3VycmVudFByaWNlIFRoZSBjdXJyZW50IHByaWNlLgogICAgZnVuY3Rpb24gbmV4dFByaWNlKHVpbnQyNTYgY3VycmVudFByaWNlKSBwdWJsaWMgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICBpZiAoY3VycmVudFByaWNlIDwgMSBldGhlcikgewogICAgICAgICAgICByZXR1cm4gY3VycmVudFByaWNlLm11bCgyMDApLmRpdigxMDApOyAvLyAxMDAlIGluY3JlYXNlCiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50UHJpY2UgPCA1IGV0aGVyKSB7CiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UHJpY2UubXVsKDE1MCkuZGl2KDEwMCk7IC8vIDUwJSBpbmNyZWFzZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBjdXJyZW50UHJpY2UubXVsKDEzNSkuZGl2KDEwMCk7IC8vIDM1JSBpbmNyZWFzZQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgU2V0IHRoZSBwcmljZSBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIGlkZW50aWZpZXIgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gY2hhbmdlIHRoZSBwcmljZSBvZi4KICAgIC8vLyBAcGFyYW0gbmV3UHJpY2UgVGhlIG5ldyBwcmljZSBvZiB0aGUgZGVlZC4KICAgIGZ1bmN0aW9uIGNoYW5nZURlZWRQcmljZSh1aW50MjU2IGlkZW50aWZpZXIsIHVpbnQyNTYgbmV3UHJpY2UpIHB1YmxpYyB7CiAgICAgICAgLy8gVGhlIG1lc3NhZ2Ugc2VuZGVyIG11c3QgYmUgdGhlIGRlZWQgb3duZXIuCiAgICAgICAgcmVxdWlyZShpZGVudGlmaWVyVG9Pd25lcltpZGVudGlmaWVyXSA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAKICAgICAgICAvLyBQcmljZSBjaGFuZ2VzIG11c3QgYmUgZW5hYmxlZC4KICAgICAgICByZXF1aXJlKGFsbG93Q2hhbmdlUHJpY2UpOwogICAgICAgIAogICAgICAgIC8vIFRoZSBuZXcgcHJpY2UgbXVzdCBiZSBsb3dlciB0aGFuIHRoZSBjdXJyZW50IHByaWNlLgogICAgICAgIHJlcXVpcmUobmV3UHJpY2UgPCBpZGVudGlmaWVyVG9QcmljZVtpZGVudGlmaWVyXSk7CiAgICAgICAgCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgcHJpY2UuCiAgICAgICAgaWRlbnRpZmllclRvUHJpY2VbaWRlbnRpZmllcl0gPSBuZXdQcmljZTsKICAgICAgICBQcmljZShpZGVudGlmaWVyLCBuZXdQcmljZSwgbmV4dFByaWNlKG5ld1ByaWNlKSk7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNldCB0aGUgaW5pdGlhbCBwcmljZSBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIGlkZW50aWZpZXIgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdG8gY2hhbmdlIHRoZSBwcmljZSBvZi4KICAgIC8vLyBAcGFyYW0gbmV3UHJpY2UgVGhlIG5ldyBwcmljZSBvZiB0aGUgZGVlZC4KICAgIGZ1bmN0aW9uIGNoYW5nZUluaXRpYWxQcmljZSh1aW50MjU2IGlkZW50aWZpZXIsIHVpbnQyNTYgbmV3UHJpY2UpIHB1YmxpYyBvbmx5Q0ZPIHsgICAgICAgIAogICAgICAgIC8vIFRoZSBkZWVkIG11c3QgYmUgb3duZWQgYnkgdGhlIGNvbnRyYWN0LgogICAgICAgIHJlcXVpcmUoaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl0gPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgCiAgICAgICAgLy8gU2V0IHRoZSBuZXcgcHJpY2UuCiAgICAgICAgaWRlbnRpZmllclRvUHJpY2VbaWRlbnRpZmllcl0gPSBuZXdQcmljZTsKICAgICAgICBQcmljZShpZGVudGlmaWVyLCBuZXdQcmljZSwgbmV4dFByaWNlKG5ld1ByaWNlKSk7CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFBheSBkaXZpZGVuZHMgdG8gcGFyZW50cyBvZiBhIGRlZWQuCiAgICAvLy8gQHBhcmFtIGlkZW50aWZpZXJCb3VnaHQgVGhlIGlkZW50aWZpZXIgb2YgdGhlIGRlZWQgdGhhdCB3YXMgYm91Z2h0LgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBkZWVkIHRvIHBheSBpdHMgcGFyZW50cyBkaXZpZGVuZHMgZm9yIChyZWN1cnNlZCkuCiAgICAvLy8gQHBhcmFtIGRpdmlkZW5kIFRoZSBkaXZpZGVuZCB0byBiZSBwYWlkIHRvIHBhcmVudHMgb2YgdGhlIGRlZWQuCiAgICAvLy8gQHBhcmFtIGRlcHRoIFRoZSBkZXB0aCBvZiB0aGlzIGRpdmlkZW5kLgogICAgZnVuY3Rpb24gX3BheURpdmlkZW5kcyh1aW50MjU2IGlkZW50aWZpZXJCb3VnaHQsIHVpbnQyNTYgaWRlbnRpZmllciwgdWludDI1NiBkaXZpZGVuZCwgdWludDI1NiBkZXB0aCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnModWludDI1NiB0b3RhbERpdmlkZW5kc1BhaWQpCiAgICB7CiAgICAgICAgdWludDI1NiBwYXJlbnRJZGVudGlmaWVyID0gaWRlbnRpZmllclRvUGFyZW50SWRlbnRpZmllcltpZGVudGlmaWVyXTsKICAgICAgICAKICAgICAgICBpZiAocGFyZW50SWRlbnRpZmllciAhPSAwICYmIGRlcHRoIDwgbWF4RGl2aWRlbmREZXB0aCkgewogICAgICAgICAgICBhZGRyZXNzIHBhcmVudE93bmVyID0gaWRlbnRpZmllclRvT3duZXJbcGFyZW50SWRlbnRpZmllcl07CiAgICAgICAgCiAgICAgICAgICAgIGlmIChwYXJlbnRPd25lciAhPSBhZGRyZXNzKHRoaXMpKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTZW5kIGRpdmlkZW5kIHRvIHRoZSBvd25lciBvZiB0aGUgcGFyZW50LgogICAgICAgICAgICAgICAgX3NlbmRGdW5kcyhwYXJlbnRPd25lciwgZGl2aWRlbmQpOwogICAgICAgICAgICAgICAgRGl2aWRlbmRQYWlkKHBhcmVudE93bmVyLCBpZGVudGlmaWVyQm91Z2h0LCBwYXJlbnRJZGVudGlmaWVyLCBkaXZpZGVuZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRvdGFsRGl2aWRlbmRzUGFpZCA9IGRpdmlkZW5kOwogICAgICAgIAogICAgICAgICAgICAvLyBSZWN1cnNpdmVseSBwYXkgZGl2aWRlbmRzIHRvIHBhcmVudHMgb2YgcGFyZW50cy4KICAgICAgICAgICAgdWludDI1NiBkaXZpZGVuZHNQYWlkID0gX3BheURpdmlkZW5kcyhpZGVudGlmaWVyQm91Z2h0LCBwYXJlbnRJZGVudGlmaWVyLCBkaXZpZGVuZCwgZGVwdGggKyAxKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRvdGFsRGl2aWRlbmRzUGFpZCA9IHRvdGFsRGl2aWRlbmRzUGFpZC5hZGQoZGl2aWRlbmRzUGFpZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gTm90IHN0cmljdGx5IG5lY2Vzc2FyeSB0byBzZXQgdGhpcyB0byAwIGV4cGxpY2l0bHkuLi4gYnV0IG1ha2VzCiAgICAgICAgICAgIC8vIGl0IGNsZWFyZXIgdG8gc2VlIHdoYXQgaGFwcGVucy4KICAgICAgICAgICAgdG90YWxEaXZpZGVuZHNQYWlkID0gMDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IENhbGN1bGF0ZSB0aGUgY29udHJhY3QgZmVlLgogICAgLy8vIEBwYXJhbSBwcmljZSBUaGUgcHJpY2Ugb2YgdGhlIGJ1eW91dC4KICAgIC8vLyBAcGFyYW0gZGl2aWRlbmRzUGFpZCBUaGUgdG90YWwgYW1vdW50IHBhaWQgaW4gZGl2aWRlbmRzLgogICAgZnVuY3Rpb24gY2FsY3VsYXRlRmVlKHVpbnQyNTYgcHJpY2UsIHVpbnQyNTYgZGl2aWRlbmRzUGFpZCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50MjU2IGZlZSkgewogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgYWJzb2x1dGUgbWluaW11bSBmZWUuCiAgICAgICAgZmVlID0gcHJpY2UubXVsKG1pbmltdW1GZWUpLmRpdigxMDAwMDApOwogICAgICAgIAogICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgbWluaW11bSBmZWUgcGx1cyBkaXZpZGVuZHMgcGF5YWJsZS4KICAgICAgICAvLyBTZWUgYWxzbyB0aGUgZXhwbGFuYXRpb24gYXQgdGhlIGRlZmluaXRpb24gb2YKICAgICAgICAvLyBtaW5pbXVtRmVlUGx1c0RpdmlkZW5kcy4KICAgICAgICB1aW50MjU2IF9taW5pbXVtRmVlUGx1c0RpdmlkZW5kcyA9IHByaWNlLm11bChtaW5pbXVtRmVlUGx1c0RpdmlkZW5kcykuZGl2KDEwMDAwMCk7CiAgICAgICAgCiAgICAgICAgaWYgKF9taW5pbXVtRmVlUGx1c0RpdmlkZW5kcyA+IGRpdmlkZW5kc1BhaWQpIHsKICAgICAgICAgICAgdWludDI1NiBmZWVNaW51c0RpdmlkZW5kcyA9IF9taW5pbXVtRmVlUGx1c0RpdmlkZW5kcy5zdWIoZGl2aWRlbmRzUGFpZCk7CiAgICAgICAgCiAgICAgICAgICAgIC8vIFRoZSBtaW5pbXVtIHRvdGFsIHBhaWQgaW4gJ2ZlZXMgcGx1cyBkaXZpZGVuZHMnLCBtaW51cyBkaXZpZGVuZHMsIGlzCiAgICAgICAgICAgIC8vIGdyZWF0ZXIgdGhhbiB0aGUgbWluaW11bSBmZWUuIFNldCB0aGUgZmVlIHRvIHRoaXMgdmFsdWUuCiAgICAgICAgICAgIGlmIChmZWVNaW51c0RpdmlkZW5kcyA+IGZlZSkgewogICAgICAgICAgICAgICAgZmVlID0gZmVlTWludXNEaXZpZGVuZHM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vLyBAZGV2IFNlbmQgZnVuZHMgdG8gYSBiZW5lZmljaWFyeS4gSWYgc2VuZGluZyBmYWlscywgYXNzaWduCiAgICAvLy8gZnVuZHMgdG8gdGhlIGJlbmVmaWNpYXJ5J3MgYmFsYW5jZSBmb3IgbWFudWFsIHdpdGhkcmF3YWwuCiAgICAvLy8gQHBhcmFtIGJlbmVmaWNpYXJ5IFRoZSBiZW5lZmljaWFyeSdzIGFkZHJlc3MgdG8gc2VuZCBmdW5kcyB0bwogICAgLy8vIEBwYXJhbSBhbW91bnQgVGhlIGFtb3VudCB0byBzZW5kLgogICAgZnVuY3Rpb24gX3NlbmRGdW5kcyhhZGRyZXNzIGJlbmVmaWNpYXJ5LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIGlmIChhbW91bnQgPCBkaXJlY3RQYXltZW50VGhyZXNob2xkKSB7CiAgICAgICAgICAgIC8vIEFtb3VudCBpcyB1bmRlciBzZW5kIHRocmVzaG9sZC4gU2VuZCBmdW5kcyBhc3luY2hyb25vdXNseQogICAgICAgICAgICAvLyBmb3IgbWFudWFsIHdpdGhkcmF3YWwgYnkgdGhlIGJlbmVmaWNpYXJ5LgogICAgICAgICAgICBhc3luY1NlbmQoYmVuZWZpY2lhcnksIGFtb3VudCk7CiAgICAgICAgfSBlbHNlIGlmICghYmVuZWZpY2lhcnkuc2VuZChhbW91bnQpKSB7CiAgICAgICAgICAgIC8vIEZhaWxlZCB0byBzZW5kIGZ1bmRzLiBUaGlzIGNhbiBoYXBwZW4gZHVlIHRvIGEgZmFpbHVyZSBpbgogICAgICAgICAgICAvLyBmYWxsYmFjayBjb2RlIG9mIHRoZSBiZW5lZmljaWFyeSwgb3IgYmVjYXVzZSBvZiBjYWxsc3RhY2sKICAgICAgICAgICAgLy8gZGVwdGguCiAgICAgICAgICAgIC8vIFNlbmQgZnVuZHMgYXN5bmNocm9ub3VzbHkgZm9yIG1hbnVhbCB3aXRoZHJhd2FsIGJ5IHRoZQogICAgICAgICAgICAvLyBiZW5lZmljaWFyeS4KICAgICAgICAgICAgYXN5bmNTZW5kKGJlbmVmaWNpYXJ5LCBhbW91bnQpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgV2l0aGRyYXcgKHVub3dlZCkgY29udHJhY3QgYmFsYW5jZS4KICAgIGZ1bmN0aW9uIHdpdGhkcmF3RnJlZUJhbGFuY2UoKSBleHRlcm5hbCBvbmx5Q0ZPIHsKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGZyZWUgKHVub3dlZCkgYmFsYW5jZS4gVGhpcyBuZXZlciB1bmRlcmZsb3dzLCBhcwogICAgICAgIC8vIHRvdGFsUGF5bWVudHMgaXMgZ3VhcmFudGVlZCB0byBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlCiAgICAgICAgLy8gY29udHJhY3QgYmFsYW5jZS4KICAgICAgICB1aW50MjU2IGZyZWVCYWxhbmNlID0gdGhpcy5iYWxhbmNlIC0gdG90YWxQYXltZW50czsKICAgICAgICAKICAgICAgICBjZm9BZGRyZXNzLnRyYW5zZmVyKGZyZWVCYWxhbmNlKTsKICAgIH0KfQoKCi8vLyBAZGV2IERlZmluZXMgY29yZSBtZXRhIGdhbWUgZnVuY3Rpb25hbGl0eS4KY29udHJhY3QgTWV0YUdhbWVDb3JlIGlzIE1ldGFHYW1lRmluYW5jZSB7CiAgICAKICAgIGZ1bmN0aW9uIE1ldGFHYW1lQ29yZSgpIHB1YmxpYyB7CiAgICAgICAgLy8gU3RhcnQgdGhlIGNvbnRyYWN0IHBhdXNlZC4KICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgYSBjb2xsZWN0aWJsZS4KICAgIC8vLyBAcGFyYW0gaWRlbnRpZmllciBUaGUgaWRlbnRpZmllciBvZiB0aGUgY29sbGVjdGlibGUgdGhhdCBpcyB0byBiZSBjcmVhdGVkLgogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgaW5pdGlhbCBvd25lci4gQmxhbmsgaWYgdGhpcyBjb250cmFjdCBzaG91bGQKICAgIC8vLyBiZSB0aGUgaW5pdGlhbCBvd25lci4KICAgIC8vLyBAcGFyYW0gcGFyZW50SWRlbnRpZmllciBUaGUgaWRlbnRpZmllciBvZiB0aGUgcGFyZW50IG9mIHRoZSBjb2xsZWN0aWJsZSwgd2hpY2gKICAgIC8vLyByZWNlaXZlcyBkaXZpZGVuZHMgd2hlbiB0aGlzIGNvbGxlY3RpYmxlIHRyYWRlcy4KICAgIC8vLyBAcGFyYW0gcHJpY2UgVGhlIGluaXRpYWwgcHJpY2Ugb2YgdGhlIGNvbGxlY3RpYmxlLgogICAgZnVuY3Rpb24gY3JlYXRlQ29sbGVjdGlibGUodWludDI1NiBpZGVudGlmaWVyLCBhZGRyZXNzIG93bmVyLCB1aW50MjU2IHBhcmVudElkZW50aWZpZXIsIHVpbnQyNTYgcHJpY2UpIGV4dGVybmFsIG9ubHlDRk8gewogICAgICAgIC8vIFRoZSBpZGVudGlmaWVyIG11c3QgYmUgdmFsaWQuIElkZW50aWZpZXIgMCBpcyByZXNlcnZlZAogICAgICAgIC8vIHRvIG1hcmsgYSBjb2xsZWN0aWJsZSBhcyBoYXZpbmcgbm8gcGFyZW50LgogICAgICAgIHJlcXVpcmUoaWRlbnRpZmllciA+PSAxKTsKICAgIAogICAgICAgIC8vIFRoZSBpZGVudGlmaWVyIG11c3Qgbm90IGV4aXN0IHlldC4KICAgICAgICByZXF1aXJlKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdID09IDB4MCk7CiAgICAgICAgCiAgICAgICAgLy8gQWRkIHRoZSBpZGVudGlmaWVyIHRvIHRoZSBsaXN0IG9mIGV4aXN0aW5nIGlkZW50aWZpZXJzLgogICAgICAgIGlkZW50aWZpZXJzLnB1c2goaWRlbnRpZmllcik7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBpbml0aWFsT3duZXIgPSBvd25lcjsKICAgICAgICAKICAgICAgICBpZiAoaW5pdGlhbE93bmVyID09IDB4MCkgewogICAgICAgICAgICAvLyBTZXQgdGhlIGluaXRpYWwgb3duZXIgdG8gYmUgdGhlIGNvbnRyYWN0IGl0c2VsZi4KICAgICAgICAgICAgaW5pdGlhbE93bmVyID0gYWRkcmVzcyh0aGlzKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgdGhlIGNvbGxlY3RpYmxlIHRvIHRoZSBpbml0aWFsIG93bmVyLgogICAgICAgIF90cmFuc2ZlcigweDAsIGluaXRpYWxPd25lciwgaWRlbnRpZmllcik7CiAgICAgICAgCiAgICAgICAgLy8gU2V0IHRoZSBwYXJlbnQgaWRlbnRpZmllci4KICAgICAgICBpZGVudGlmaWVyVG9QYXJlbnRJZGVudGlmaWVyW2lkZW50aWZpZXJdID0gcGFyZW50SWRlbnRpZmllcjsKICAgICAgICAKICAgICAgICAvLyBTZXQgdGhlIGluaXRpYWwgcHJpY2UuCiAgICAgICAgaWRlbnRpZmllclRvUHJpY2VbaWRlbnRpZmllcl0gPSBwcmljZTsKICAgICAgICAKICAgICAgICAvLyBFbWl0IHByaWNlIGV2ZW50LgogICAgICAgIFByaWNlKGlkZW50aWZpZXIsIHByaWNlLCBuZXh0UHJpY2UocHJpY2UpKTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgU2V0IHRoZSBwYXJlbnQgY29sbGVjdGlibGUgb2YgYSBjb2xsZWN0aWJsZS4KICAgIGZ1bmN0aW9uIHNldFBhcmVudCh1aW50MjU2IGlkZW50aWZpZXIsIHVpbnQyNTYgcGFyZW50SWRlbnRpZmllcikgZXh0ZXJuYWwgb25seUNGTyB7CiAgICAgICAgLy8gVGhlIGRlZWQgbXVzdCBleGlzdC4KICAgICAgICByZXF1aXJlKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdICE9IDB4MCk7CiAgICAgICAgCiAgICAgICAgaWRlbnRpZmllclRvUGFyZW50SWRlbnRpZmllcltpZGVudGlmaWVyXSA9IHBhcmVudElkZW50aWZpZXI7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIEJ1eSBhIGNvbGxlY3RpYmxlLgogICAgZnVuY3Rpb24gYnV5KHVpbnQyNTYgaWRlbnRpZmllcikgZXh0ZXJuYWwgcGF5YWJsZSB3aGVuTm90UGF1c2VkIHsKICAgICAgICAvLyBUaGUgY29sbGVjdGlibGUgbXVzdCBleGlzdC4KICAgICAgICByZXF1aXJlKGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdICE9IDB4MCk7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBvbGRPd25lciA9IGlkZW50aWZpZXJUb093bmVyW2lkZW50aWZpZXJdOwogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBpZGVudGlmaWVyVG9QcmljZVtpZGVudGlmaWVyXTsKICAgICAgICAKICAgICAgICAvLyBUaGUgb2xkIG93bmVyIG11c3Qgbm90IGJlIHRoZSBzYW1lIGFzIHRoZSBidXllci4KICAgICAgICByZXF1aXJlKG9sZE93bmVyICE9IG1zZy5zZW5kZXIpOwogICAgICAgIAogICAgICAgIC8vIEVub3VnaCBldGhlciBtdXN0IGJlIHByb3ZpZGVkLgogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHByaWNlKTsKICAgICAgICAKICAgICAgICAvLyBTZXQgdGhlIG5ldyBwcmljZS4KICAgICAgICB1aW50MjU2IG5ld1ByaWNlID0gbmV4dFByaWNlKHByaWNlKTsKICAgICAgICBpZGVudGlmaWVyVG9QcmljZVtpZGVudGlmaWVyXSA9IG5ld1ByaWNlOwogICAgICAgIAogICAgICAgIC8vIFRyYW5zZmVyIHRoZSBjb2xsZWN0aWJsZS4KICAgICAgICBfdHJhbnNmZXIob2xkT3duZXIsIG1zZy5zZW5kZXIsIGlkZW50aWZpZXIpOwogICAgICAgIAogICAgICAgIC8vIEVtaXQgcHJpY2UgY2hhbmdlIGV2ZW50LgogICAgICAgIFByaWNlKGlkZW50aWZpZXIsIG5ld1ByaWNlLCBuZXh0UHJpY2UobmV3UHJpY2UpKTsKICAgICAgICAKICAgICAgICAvLyBQYXkgZGl2aWRlbmRzLgogICAgICAgIHVpbnQyNTYgZGl2aWRlbmQgPSBwcmljZS5tdWwoZGl2aWRlbmRQZXJjZW50YWdlKS5kaXYoMTAwMDAwKTsKICAgICAgICB1aW50MjU2IGRpdmlkZW5kc1BhaWQgPSBfcGF5RGl2aWRlbmRzKGlkZW50aWZpZXIsIGlkZW50aWZpZXIsIGRpdmlkZW5kLCAwKTsKICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGNvbnRyYWN0IGZlZS4KICAgICAgICB1aW50MjU2IGZlZSA9IGNhbGN1bGF0ZUZlZShwcmljZSwgZGl2aWRlbmRzUGFpZCk7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSB3aW5uaW5ncyBmb3IgdGhlIHByZXZpb3VzIG93bmVyLgogICAgICAgIHVpbnQyNTYgb2xkT3duZXJXaW5uaW5ncyA9IHByaWNlLnN1YihkaXZpZGVuZHNQYWlkKS5zdWIoZmVlKTsKICAgICAgICAKICAgICAgICAvLyBFbWl0IGJ1eSBldmVudC4KICAgICAgICBCdXkob2xkT3duZXIsIG1zZy5zZW5kZXIsIGlkZW50aWZpZXIsIHByaWNlLCBvbGRPd25lcldpbm5pbmdzKTsKICAgICAgICAKICAgICAgICBpZiAob2xkT3duZXIgIT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICAvLyBUaGUgb2xkIG93bmVyIGlzIG5vdCB0aGlzIGNvbnRyYWN0IGl0c2VsZi4KICAgICAgICAgICAgLy8gUGF5IHRoZSBvbGQgb3duZXIuCiAgICAgICAgICAgIF9zZW5kRnVuZHMob2xkT3duZXIsIG9sZE93bmVyV2lubmluZ3MpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBDYWxjdWxhdGUgb3ZlcnNwZW50IGV0aGVyLiBUaGlzIGNhbm5vdCB1bmRlcmZsb3csIGFzIHRoZSByZXF1aXJlCiAgICAgICAgLy8gZ3VhcmFudGVlcyBwcmljZSB0byBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gbXNnLnZhbHVlLgogICAgICAgIHVpbnQyNTYgZXhjZXNzID0gcHJpY2UgLSBtc2cudmFsdWU7CiAgICAgICAgCiAgICAgICAgaWYgKGV4Y2VzcyA+IDApIHsKICAgICAgICAgICAgLy8gUmVmdW5kIG92ZXJzcGVudCBFdGhlci4KICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihleGNlc3MpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgUmV0dXJuIGEgY29sbGVjdGlibGUncyBkZXRhaWxzLgogICAgLy8vIEBwYXJhbSBpZGVudGlmaWVyIFRoZSBpZGVudGlmaWVyIG9mIHRoZSBjb2xsZWN0aWJsZSB0byBnZXQgZGV0YWlscyBmb3IuCiAgICBmdW5jdGlvbiBnZXREZWVkKHVpbnQyNTYgaWRlbnRpZmllcikKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKHVpbnQyNTYgZGVlZElkLCBhZGRyZXNzIG93bmVyLCB1aW50MjU2IGJ1eVByaWNlLCB1aW50MjU2IG5leHRCdXlQcmljZSkKICAgIHsKICAgICAgICBkZWVkSWQgPSBpZGVudGlmaWVyOwogICAgICAgIG93bmVyID0gaWRlbnRpZmllclRvT3duZXJbaWRlbnRpZmllcl07CiAgICAgICAgYnV5UHJpY2UgPSBpZGVudGlmaWVyVG9QcmljZVtpZGVudGlmaWVyXTsKICAgICAgICBuZXh0QnV5UHJpY2UgPSBuZXh0UHJpY2UoYnV5UHJpY2UpOwogICAgfQp9'.
	

]
