Class {
	#name : #SRT000000005fbe2cc9b1b684ec445caf176042348e,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT000000005fbe2cc9b1b684ec445caf176042348e >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjA7Ly8gYmxhemUgaXQKCmludGVyZmFjZSBFUkMyMCB7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQgc3VwcGx5KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIGV4dGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBleHRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50IHJlbWFpbmluZyk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8sIHVpbnQgX3ZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9CmNvbnRyYWN0IFRva2VuUmVzY3VlIHsKICAgIC8vIHVzZSB0aGlzIG1ldGhvZCB0byByZXNjdWUgeW91ciB0b2tlbnMgaWYgeW91IHNlbnQgdGhlbSBieSBtaXN0YWtlIGJ1dCBiZSBxdWljayBvciBzb21lb25lIGVsc2Ugd2lsbCBnZXQgdGhlbQogICAgZnVuY3Rpb24gcmVzY3VlVG9rZW4oRVJDMjAgX3Rva2VuKQogICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBfdG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgX3Rva2VuLmJhbGFuY2VPZih0aGlzKSk7CiAgICB9CiAgICAvLyByZXF1aXJlIGRhdGEgZm9yIHRyYW5zYWN0aW9ucwogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KfQppbnRlcmZhY2UgQWNjb3VudFJlZ2lzdHJ5SW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGNhblZvdGVPblByb3Bvc2FsKGFkZHJlc3MgX3ZvdGVyLCBhZGRyZXNzIF9wcm9wb3NhbCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQpjb250cmFjdCBWb3RlIGlzIEVSQzIwLCBUb2tlblJlc2N1ZSB7CiAgICB1aW50MjU2IHN1cHBseSA9IDA7CiAgICBBY2NvdW50UmVnaXN0cnlJbnRlcmZhY2UgcHVibGljIGFjY291bnRSZWdpc3RyeSA9IEFjY291bnRSZWdpc3RyeUludGVyZmFjZSgweDAwMDAwMDAwMmJiNDNjODNlQ2U2NTJkMTYxYWQwZmE4NjIxMjlBMkMpOwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIgPSAweDRhNmY2QjlmRjFmYzk3NDA5NmY5MDYzYTQ1RmQxMmJENUI5MjhBRDE7CgogICAgdWludDggcHVibGljIGNvbnN0YW50IGRlY2ltYWxzID0gMTsKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sID0gIkZWIjsKICAgIHN0cmluZyBwdWJsaWMgbmFtZSA9ICJGaW5uZXlWb3RlIjsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIGJhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhcHByb3ZlZDsKCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gc3VwcGx5OwogICAgfQogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBleHRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYXBwcm92ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFwcHJvdmVkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBleHRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdIDwgX3ZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwogICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoYmFsYW5jZXNbX2Zyb21dIDwgX3ZhbHVlCiAgICAgICAgIHx8IGFwcHJvdmVkW19mcm9tXVttc2cuc2VuZGVyXSA8IF92YWx1ZQogICAgICAgICB8fCBfdmFsdWUgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGFwcHJvdmVkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgYmFsYW5jZXNbX2Zyb21dIC09IF92YWx1ZTsKICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVuY3Rpb24gZ3JhbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2dyYW50KSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoYWNjb3VudFJlZ2lzdHJ5KSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSArPSBfZ3JhbnQ7CiAgICAgICAgc3VwcGx5ICs9IF9ncmFudDsKICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBfdG8sIF9ncmFudCk7CiAgICB9CiAgICAvLyB2b3RlNSBhbmQgdm90ZTEgYXJlIGF2YWlsYWJsZSBmb3IgZnV0dXJlIHVzZQogICAgZnVuY3Rpb24gdm90ZTUoYWRkcmVzcyBfdm90ZXIsIGFkZHJlc3MgX3ZvdGVlKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tfdm90ZXJdID49IDEwKTsKICAgICAgICByZXF1aXJlKGFjY291bnRSZWdpc3RyeS5jYW5Wb3RlT25Qcm9wb3NhbChfdm90ZXIsIG1zZy5zZW5kZXIpKTsKICAgICAgICBiYWxhbmNlc1tfdm90ZXJdIC09IDEwOwogICAgICAgIGJhbGFuY2VzW293bmVyXSArPSA1OwogICAgICAgIGJhbGFuY2VzW192b3RlZV0gKz0gNTsKICAgICAgICBUcmFuc2Zlcihfdm90ZXIsIG93bmVyLCA1KTsKICAgICAgICBUcmFuc2Zlcihfdm90ZXIsIF92b3RlZSwgNSk7CiAgICB9CiAgICBmdW5jdGlvbiB2b3RlMShhZGRyZXNzIF92b3RlciwgYWRkcmVzcyBfdm90ZWUpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGJhbGFuY2VzW192b3Rlcl0gPj0gMTApOwogICAgICAgIHJlcXVpcmUoYWNjb3VudFJlZ2lzdHJ5LmNhblZvdGVPblByb3Bvc2FsKF92b3RlciwgbXNnLnNlbmRlcikpOwogICAgICAgIGJhbGFuY2VzW192b3Rlcl0gLT0gMTA7CiAgICAgICAgYmFsYW5jZXNbb3duZXJdICs9IDk7CiAgICAgICAgYmFsYW5jZXNbX3ZvdGVlXSArPSAxOwogICAgICAgIFRyYW5zZmVyKF92b3Rlciwgb3duZXIsIDkpOwogICAgICAgIFRyYW5zZmVyKF92b3RlciwgX3ZvdGVlLCAxKTsKICAgIH0KICAgIGZ1bmN0aW9uIHZvdGU5KGFkZHJlc3MgX3ZvdGVyLCBhZGRyZXNzIF92b3RlZSkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbX3ZvdGVyXSA+PSAxMCk7CiAgICAgICAgcmVxdWlyZShhY2NvdW50UmVnaXN0cnkuY2FuVm90ZU9uUHJvcG9zYWwoX3ZvdGVyLCBtc2cuc2VuZGVyKSk7CiAgICAgICAgYmFsYW5jZXNbX3ZvdGVyXSAtPSAxMDsKICAgICAgICBiYWxhbmNlc1tvd25lcl0gKz0gMTsKICAgICAgICBiYWxhbmNlc1tfdm90ZWVdICs9IDk7CiAgICAgICAgVHJhbnNmZXIoX3ZvdGVyLCBvd25lciwgMSk7CiAgICAgICAgVHJhbnNmZXIoX3ZvdGVyLCBfdm90ZWUsIDkpOwogICAgfQogICAgbW9kaWZpZXIgb25seU93bmVyICgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICBldmVudCBPd25lcihhZGRyZXNzIGluZGV4ZWQgb3duZXIpOwogICAgZXZlbnQgUmVnaXN0cnkoYWRkcmVzcyBpbmRleGVkIHJlZ2lzdHJ5KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKQogICAgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBiYWxhbmNlc1tvd25lcl07CiAgICAgICAgYmFsYW5jZXNbX25ld093bmVyXSArPSBiYWxhbmNlOwogICAgICAgIGJhbGFuY2VzW293bmVyXSA9IDA7CiAgICAgICAgVHJhbnNmZXIob3duZXIsIF9uZXdPd25lciwgYmFsYW5jZSk7CiAgICAgICAgb3duZXIgPSBfbmV3T3duZXI7CiAgICAgICAgT3duZXIoX25ld093bmVyKTsKICAgIH0KICAgIGZ1bmN0aW9uIG1pZ3JhdGVBY2NvdW50UmVnaXN0cnkoQWNjb3VudFJlZ2lzdHJ5SW50ZXJmYWNlIF9uZXdBY2NvdW50UmVnaXN0cnkpCiAgICBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIGFjY291bnRSZWdpc3RyeSA9IF9uZXdBY2NvdW50UmVnaXN0cnk7CiAgICAgICAgUmVnaXN0cnkoX25ld0FjY291bnRSZWdpc3RyeSk7CiAgICB9Cn0KaW50ZXJmYWNlIFByb3Bvc2FsSW50ZXJmYWNlIHsKICAgIC8qIHVpbnQ4OgogICAgICAgIGVudW0gUG9zaXRpb24gewogICAgICAgICAgICBTS0lQLCAvLyBkZWZhdWx0CiAgICAgICAgICAgIEFQUFJPVkUsCiAgICAgICAgICAgIFJFSkVDVCwKICAgICAgICAgICAgQU1FTkQsIC8vID09IChBUFBST1ZFIHwgUkVKRUNUKQogICAgICAgICAgICBMT0wKICAgICAgICAgICAgLy8gbW9yZSB0byBiZSBkZXRlcm1pbmVkIGJ5IGNvbW11bml0eQogICAgICAgIH0KICAgICovCiAgICBmdW5jdGlvbiBnZXRQb3NpdGlvbihhZGRyZXNzIF91c2VyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGFyZ3VtZW50Q291bnQoKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gdm90ZSh1aW50MjU2IF9hcmd1bWVudElkKSBleHRlcm5hbDsKICAgIC8vIGJ5dGVzIGNvdWxkIGJlOgogICAgLy8gdXRmOCBzdHJpbmcKICAgIC8vIHN3YXJtIGhhc2gKICAgIC8vIGlwZnMgaGFzaAogICAgLy8gYW5kIG90aGVycyB0YmQKICAgIGV2ZW50IENhc2UoYnl0ZXMgY29udGVudCk7Cn0KY29udHJhY3QgUHJvcGVyUHJvcG9zYWwgaXMgUHJvcG9zYWxJbnRlcmZhY2UsIFRva2VuUmVzY3VlIHsKICAgIHN0cnVjdCBBcmd1bWVudCB7CiAgICAgICAgYWRkcmVzcyBzb3VyY2U7CiAgICAgICAgdWludDggcG9zaXRpb247CiAgICAgICAgdWludDI1NiBjb3VudDsKICAgIH0KICAgIEFyZ3VtZW50W10gcHVibGljIGFyZ3VtZW50czsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHZvdGVzOwogICAgVm90ZSBwdWJsaWMgY29uc3RhbnQgdm90ZVRva2VuID0gVm90ZSgweDAwMDAwMDAwMjY0N2UxNmQ5QmFCOWU0NjYwNEQ3NTU5MUQyODkyNzcpOwoKICAgIGZ1bmN0aW9uIGdldFBvc2l0aW9uKGFkZHJlc3MgX3VzZXIpCiAgICBleHRlcm5hbCB2aWV3CiAgICByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiBhcmd1bWVudHNbdm90ZXNbX3VzZXJdXS5wb3NpdGlvbjsKICAgIH0KCiAgICBmdW5jdGlvbiBhcmd1bWVudENvdW50KCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg7CiAgICB9CiAgICBmdW5jdGlvbiBhcmd1bWVudFNvdXJjZSh1aW50MjU2IF9pbmRleCkKICAgIGV4dGVybmFsIHZpZXcKICAgIHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzW19pbmRleF0uc291cmNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFyZ3VtZW50UG9zaXRpb24odWludDI1NiBfaW5kZXgpCiAgICBleHRlcm5hbCB2aWV3CiAgICByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiBhcmd1bWVudHNbX2luZGV4XS5wb3NpdGlvbjsKICAgIH0KCiAgICBmdW5jdGlvbiBhcmd1bWVudFZvdGVDb3VudCh1aW50MjU2IF9pbmRleCkKICAgIGV4dGVybmFsIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzW19pbmRleF0uY291bnQ7CiAgICB9CgogICAgZnVuY3Rpb24gc291cmNlKCkKICAgIGV4dGVybmFsIHZpZXcKICAgIHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzWzBdLnNvdXJjZTsKICAgIH0KCiAgICBmdW5jdGlvbiB2b3RlQ291bnQoKQogICAgZXh0ZXJuYWwgdmlldwogICAgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiAtYXJndW1lbnRzWzBdLmNvdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIHZvdGUodWludDI1NiBfYXJndW1lbnRJZCkKICAgIGV4dGVybmFsIHsKICAgICAgICBhZGRyZXNzIGRlc3RpbmF0aW9uID0gYXJndW1lbnRzW19hcmd1bWVudElkXS5zb3VyY2U7CiAgICAgICAgdm90ZVRva2VuLnZvdGU5KG1zZy5zZW5kZXIsIGRlc3RpbmF0aW9uKTsKICAgICAgICBhcmd1bWVudHNbdm90ZXNbbXNnLnNlbmRlcl1dLmNvdW50LS07CiAgICAgICAgYXJndW1lbnRzWwogICAgICAgICAgICB2b3Rlc1ttc2cuc2VuZGVyXSA9IF9hcmd1bWVudElkCiAgICAgICAgXS5jb3VudCsrOwogICAgfQoKICAgIGV2ZW50IENhc2UoYnl0ZXMgY29udGVudCk7CgogICAgZnVuY3Rpb24gYXJndWUodWludDggX3Bvc2l0aW9uLCBieXRlcyBfdGV4dCkKICAgIGV4dGVybmFsCiAgICByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYWRkcmVzcyBkZXN0aW5hdGlvbiA9IGFyZ3VtZW50c1swXS5zb3VyY2U7CiAgICAgICAgdm90ZVRva2VuLnZvdGU5KG1zZy5zZW5kZXIsIGRlc3RpbmF0aW9uKTsKICAgICAgICB1aW50MjU2IGFyZ3VtZW50SWQgPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICAgIGFyZ3VtZW50cy5wdXNoKEFyZ3VtZW50KG1zZy5zZW5kZXIsIF9wb3NpdGlvbiwgMSkpOwogICAgICAgIENhc2UoX3RleHQpOwogICAgICAgIGFyZ3VtZW50c1t2b3Rlc1ttc2cuc2VuZGVyXV0uY291bnQtLTsKICAgICAgICB2b3Rlc1ttc2cuc2VuZGVyXSA9IGFyZ3VtZW50SWQ7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50SWQ7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdChhZGRyZXNzIF9zb3VyY2UsIGJ5dGVzIF9yZXNvbHV0aW9uKQogICAgZXh0ZXJuYWwgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IDB4MDAwMDAwMDAyYmI0M2M4M2VDZTY1MmQxNjFhZDBmYTg2MjEyOUEyQyk7CiAgICAgICAgYXJndW1lbnRzLnB1c2goQXJndW1lbnQoX3NvdXJjZSwgMC8qU0tJUCovLCAwKSk7CiAgICAgICAgQ2FzZShfcmVzb2x1dGlvbik7CiAgICB9Cn0KaW50ZXJmYWNlIENhYmFsSW50ZXJmYWNlIHsKICAgIC8vIFRCRAogICAgZnVuY3Rpb24gY2Fub25Db3VudCgpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nik7Cn0KY29udHJhY3QgQWNjb3VudFJlZ2lzdHJ5IGlzIEFjY291bnRSZWdpc3RyeUludGVyZmFjZSwgVG9rZW5SZXNjdWUgewogICAgCiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyByZWdpc3RyYXRpb25EZXBvc2l0ID0gMSBmaW5uZXk7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBwcm9wb3NhbENlbnNvcnNoaXBGZWUgPSA1MCBmaW5uZXk7CgogICAgLy8gdGhpcyBpcyB0aGUgZmlyc3QgZGV0ZXJtaW5pc3RpYyBjb250cmFjdCBhZGRyZXNzIGZvciAweDI0QUU5MDc2NTY2ODkzODM1MTA3NWZCNDUwODkyODAwZDlBNTJFMzkKICAgIGFkZHJlc3MgY29uc3RhbnQgcHVibGljIGJ1cm4gPSAweDAwMDAwMDAwM0ZmYzE1Y2Q5ZUEwNzZkN2VjNDBCOGY1MTYzNjdDYTE7CgogICAgVm90ZSBwdWJsaWMgY29uc3RhbnQgdG9rZW4gPSBWb3RlKDB4MDAwMDAwMDAyNjQ3ZTE2ZDlCYUI5ZTQ2NjA0RDc1NTkxRDI4OTI3Nyk7CgogICAgLyogdWludDggbWVtYmVyc2hpcCBiaXRtYXA6CiAgICAgKiAwIC0gcHJvcG9zZXIKICAgICAqIDEgLSByZWdpc3RlcmVkIHRvIHZvdGUKICAgICAqIDIgLSBwZW5kaW5nIHByb3Bvc2FsCiAgICAgKiAzIC0gcHJvcG9zYWwKICAgICAqIDQgLSBib2FyZCBtZW1iZXIKICAgICAqIDUgLSBwZW5kaW5nIGNhYmFsCiAgICAgKiA2IC0gY2FiYWwKICAgICAqIDcgLSBib2FyZAogICAgICovCiAgICB1aW50OCBjb25zdGFudCBVTkNPTlRBQ1RFRCA9IDA7CiAgICB1aW50OCBjb25zdGFudCBQUk9QT1NFUiA9IDE7CiAgICB1aW50OCBjb25zdGFudCBWT1RFUiA9IDI7CiAgICB1aW50OCBjb25zdGFudCBQRU5ESU5HX1BST1BPU0FMID0gNDsKICAgIHVpbnQ4IGNvbnN0YW50IFBST1BPU0FMID0gODsKICAgIHVpbnQ4IGNvbnN0YW50IFBFTkRJTkdfQ0FCQUwgPSAxNjsKICAgIHVpbnQ4IGNvbnN0YW50IENBQkFMID0gMzI7CiAgICB1aW50OCBjb25zdGFudCBCT0FSRCA9IDY0OwogICAgc3RydWN0IEFjY291bnQgewogICAgICAgIHVpbnQyNTYgbGFzdEFjY2VzczsKICAgICAgICB1aW50OCBtZW1iZXJzaGlwOwogICAgICAgIGFkZHJlc3MgYXBwb2ludGVyOy8vbm9taW5hdGVkIHRoaXMgYWNjb3VudCBmb3IgQk9BUkQKICAgICAgICBhZGRyZXNzIGRlbm91bmNlcjsvL2Rlbm91bmNlZCB0aGlzIEJPQVJEIGFjY291bnQKICAgICAgICBhZGRyZXNzIHZvdWNoZXI7Ly9ub21pbmF0ZWQgdGhpcyBhY2NvdW50IGZvciBQUk9QT1NFUgogICAgICAgIGFkZHJlc3MgZGV2b3VjaGVyOy8vZGVub3VuY2VkIHRoaXMgYWNjb3VudCBmb3IgUFJPUE9TRVIKICAgIH0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gQWNjb3VudCkgYWNjb3VudHM7CgogICAgZnVuY3Rpb24gQWNjb3VudFJlZ2lzdHJ5KCkKICAgIHB1YmxpYwogICAgewogICAgICAgIGFjY291bnRzWzB4NGE2ZjZCOWZGMWZjOTc0MDk2ZjkwNjNhNDVGZDEyYkQ1QjkyOEFEMV0ubWVtYmVyc2hpcCA9IEJPQVJEOwogICAgICAgIEJvYXJkKDB4NGE2ZjZCOWZGMWZjOTc0MDk2ZjkwNjNhNDVGZDEyYkQ1QjkyOEFEMSk7CiAgICAgICAgYWNjb3VudHNbMHg5MEZhMzEwMzk3MTQ5QTdhOTA1OEFlMmQ1NmU2NmU3MDdCMTJEM0E3XS5tZW1iZXJzaGlwID0gQk9BUkQ7CiAgICAgICAgQm9hcmQoMHg5MEZhMzEwMzk3MTQ5QTdhOTA1OEFlMmQ1NmU2NmU3MDdCMTJEM0E3KTsKICAgICAgICBhY2NvdW50c1sweDQyNGE2ZTg3MUU4Y2VhOTM3OTEyNTNCNDcyOTExOTM2MzdENjk2NmFdLm1lbWJlcnNoaXAgPSBCT0FSRDsKICAgICAgICBCb2FyZCgweDQyNGE2ZTg3MUU4Y2VhOTM3OTEyNTNCNDcyOTExOTM2MzdENjk2NmEpOwogICAgICAgIGFjY291bnRzWzB4QTRjYURlNmVjYmVkOGY3NUY2ZkQ1MEI4YmU5MmZlYjE0NDQwMENDNF0ubWVtYmVyc2hpcCA9IEJPQVJEOwogICAgICAgIEJvYXJkKDB4QTRjYURlNmVjYmVkOGY3NUY2ZkQ1MEI4YmU5MmZlYjE0NDQwMENDNCk7CiAgICB9CgogICAgZXZlbnQgVm90ZXIoYWRkcmVzcyBpbmRleGVkIHZvdGVyKTsKICAgIGV2ZW50IERlcmVnaXN0ZXJlZChhZGRyZXNzIGluZGV4ZWQgdm90ZXIpOwogICAgZXZlbnQgTm9taW5hdGVkKGFkZHJlc3MgaW5kZXhlZCBib2FyZCwgc3RyaW5nIGVuZG9yc2VtZW50KTsKICAgIGV2ZW50IEJvYXJkKGFkZHJlc3MgaW5kZXhlZCBib2FyZCk7CiAgICBldmVudCBEZW5vdW5jZWQoYWRkcmVzcyBpbmRleGVkIGJvYXJkLCBzdHJpbmcgcmVhc29uKTsKICAgIGV2ZW50IFJldm9rZWQoYWRkcmVzcyBpbmRleGVkIGJvYXJkKTsKICAgIGV2ZW50IFByb3Bvc2FsKFByb3Bvc2FsSW50ZXJmYWNlIGluZGV4ZWQgcHJvcG9zYWwpOwogICAgZXZlbnQgQ2FiYWwoQ2FiYWxJbnRlcmZhY2UgaW5kZXhlZCBjYWJhbCk7CiAgICBldmVudCBCYW5uZWRQcm9wb3NhbChQcm9wb3NhbEludGVyZmFjZSBpbmRleGVkIHByb3Bvc2FsLCBzdHJpbmcgcmVhc29uKTsKICAgIGV2ZW50IFZvdWNoKGFkZHJlc3MgaW5kZXhlZCBwcm9wb3Nlciwgc3RyaW5nIHZvdWNoKTsKICAgIGV2ZW50IFByb3Bvc2VyKGFkZHJlc3MgaW5kZXhlZCBwcm9wb3Nlcik7CiAgICBldmVudCBEZXZvdWNoKGFkZHJlc3MgaW5kZXhlZCBwcm9wb3Nlciwgc3RyaW5nIHZvdWNoKTsKICAgIGV2ZW50IFNodXRkb3duKGFkZHJlc3MgaW5kZXhlZCBwcm9wb3Nlcik7CgogICAgLy8gVG8gcmVnaXN0ZXIgYSBDYWJhbCwgeW91IG11c3QKICAgIC8vIC0gaW1wbGVtZW50IENhYmFsSW50ZXJmYWNlCiAgICAvLyAtIG9wZW4tc291cmNlIHlvdXIgQ2FiYWwgb24gRXRoZXJzY2FuIG9yIGVxdWl2YWxlbnQKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQ2FiYWwoQ2FiYWxJbnRlcmZhY2UgX2NhYmFsKQogICAgZXh0ZXJuYWwgewogICAgICAgIEFjY291bnQgc3RvcmFnZSBhY2NvdW50ID0gYWNjb3VudHNbX2NhYmFsXTsKICAgICAgICByZXF1aXJlKGFjY291bnQubWVtYmVyc2hpcCAmIChQRU5ESU5HX0NBQkFMIHwgQ0FCQUwpID09IDApOwogICAgICAgIGFjY291bnQubWVtYmVyc2hpcCB8PSBQRU5ESU5HX0NBQkFMOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbmZpcm1DYWJhbChDYWJhbEludGVyZmFjZSBfY2FiYWwpCiAgICBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShhY2NvdW50c1ttc2cuc2VuZGVyXS5tZW1iZXJzaGlwICYgQk9BUkQgIT0gMCk7CiAgICAgICAgQWNjb3VudCBzdG9yYWdlIGFjY291bnQgPSBhY2NvdW50c1tfY2FiYWxdOwogICAgICAgIHJlcXVpcmUoYWNjb3VudC5tZW1iZXJzaGlwICYgUEVORElOR19DQUJBTCAhPSAwKTsKICAgICAgICBhY2NvdW50Lm1lbWJlcnNoaXAgXj0gKENBQkFMIHwgUEVORElOR19DQUJBTCk7CiAgICAgICAgQ2FiYWwoX2NhYmFsKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3RlcigpCiAgICBleHRlcm5hbCBwYXlhYmxlCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gcmVnaXN0cmF0aW9uRGVwb3NpdCk7CiAgICAgICAgQWNjb3VudCBzdG9yYWdlIGFjY291bnQgPSBhY2NvdW50c1ttc2cuc2VuZGVyXTsKICAgICAgICByZXF1aXJlKGFjY291bnQubWVtYmVyc2hpcCAmIFZPVEVSID09IDApOwogICAgICAgIGFjY291bnQubGFzdEFjY2VzcyA9IG5vdzsKICAgICAgICBhY2NvdW50Lm1lbWJlcnNoaXAgfD0gVk9URVI7CiAgICAgICAgdG9rZW4uZ3JhbnQobXNnLnNlbmRlciwgNDApOwogICAgICAgIFZvdGVyKG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIHNtYXJ0IGNvbnRyYWN0cyBtdXN0IGltcGxlbWVudCB0aGUgZmFsbGJhY2sgZnVuY3Rpb24gaW4gb3JkZXIgdG8gZGVyZWdpc3RlcgogICAgZnVuY3Rpb24gZGVyZWdpc3RlcigpCiAgICBleHRlcm5hbAogICAgewogICAgICAgIEFjY291bnQgc3RvcmFnZSBhY2NvdW50ID0gYWNjb3VudHNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShhY2NvdW50Lm1lbWJlcnNoaXAgJiBWT1RFUiAhPSAwKTsKICAgICAgICByZXF1aXJlKGFjY291bnQubGFzdEFjY2VzcyArIDcgZGF5cyA8PSBub3cpOwogICAgICAgIGFjY291bnQubWVtYmVyc2hpcCBePSBWT1RFUjsKICAgICAgICBhY2NvdW50Lmxhc3RBY2Nlc3MgPSAwOwogICAgICAgIC8vIHRoZSBNQU5EQVRPUlkgdHJhbnNmZXIga2VlcHMgcG9wdWxhdGlvbigpIG1lYW5pbmdmdWwKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHJlZ2lzdHJhdGlvbkRlcG9zaXQpOwogICAgICAgIERlcmVnaXN0ZXJlZChtc2cuc2VuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwb3B1bGF0aW9uKCkKICAgIGV4dGVybmFsIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZSAvIDEgZmlubmV5OwogICAgfQoKICAgIGZ1bmN0aW9uIGRlcmVnaXN0cmF0aW9uRGF0ZSgpCiAgICBleHRlcm5hbCB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBhY2NvdW50c1ttc2cuc2VuZGVyXS5sYXN0QWNjZXNzICsgNyBkYXlzOwogICAgfQoKICAgIC8vIGFsd2F5cyB0cnVlIGZvciBkZXJlZ2lzdGVyZWQgYWNjb3VudHMKICAgIGZ1bmN0aW9uIGNhbkRlcmVnaXN0ZXIoYWRkcmVzcyBfdm90ZXIpCiAgICBleHRlcm5hbCB2aWV3CiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBhY2NvdW50c1tfdm90ZXJdLmxhc3RBY2Nlc3MgKyA3IGRheXMgPD0gbm93OwogICAgfQoKICAgIGZ1bmN0aW9uIGNhblZvdGVPblByb3Bvc2FsKGFkZHJlc3MgX3ZvdGVyLCBhZGRyZXNzIF9wcm9wb3NhbCkKICAgIGV4dGVybmFsIHZpZXcKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIGFjY291bnRzW192b3Rlcl0ubWVtYmVyc2hpcCAmIFZPVEVSICE9IDAKICAgICAgICAgICAgJiYgYWNjb3VudHNbX3Byb3Bvc2FsXS5tZW1iZXJzaGlwICYgUFJPUE9TQUwgIT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5Wb3RlKGFkZHJlc3MgX3ZvdGVyKQogICAgZXh0ZXJuYWwgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYWNjb3VudHNbX3ZvdGVyXS5tZW1iZXJzaGlwICYgVk9URVIgIT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1Byb3Bvc2FsKGFkZHJlc3MgX3Byb3Bvc2FsKQogICAgZXh0ZXJuYWwgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYWNjb3VudHNbX3Byb3Bvc2FsXS5tZW1iZXJzaGlwICYgUFJPUE9TQUwgIT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1BlbmRpbmdQcm9wb3NhbChhZGRyZXNzIF9wcm9wb3NhbCkKICAgIGV4dGVybmFsIHZpZXcKICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIGFjY291bnRzW19wcm9wb3NhbF0ubWVtYmVyc2hpcCAmIFBFTkRJTkdfUFJPUE9TQUwgIT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1BlbmRpbmdDYWJhbChhZGRyZXNzIF9hY2NvdW50KQogICAgZXh0ZXJuYWwgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYWNjb3VudHNbX2FjY291bnRdLm1lbWJlcnNoaXAgJiBQRU5ESU5HX0NBQkFMICE9IDA7CiAgICB9CgogICAgZnVuY3Rpb24gaXNDYWJhbChhZGRyZXNzIF9hY2NvdW50KQogICAgZXh0ZXJuYWwgdmlldwogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYWNjb3VudHNbX2FjY291bnRdLm1lbWJlcnNoaXAgJiBDQUJBTCAhPSAwOwogICAgfQoKICAgIC8vIHVuZGVyIG5vIGNvbmRpdGlvbiBzaG91bGQgeW91IGxldCBhbnlvbmUgY29udHJvbCB0d28gQk9BUkQgYWNjb3VudHMKICAgIGZ1bmN0aW9uIGFwcG9pbnQoYWRkcmVzcyBfYm9hcmQsIHN0cmluZyBfdm91Y2gpCiAgICBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShhY2NvdW50c1ttc2cuc2VuZGVyXS5tZW1iZXJzaGlwICYgQk9BUkQgIT0gMCk7CiAgICAgICAgQWNjb3VudCBzdG9yYWdlIGNhbmRpZGF0ZSA9IGFjY291bnRzW19ib2FyZF07CiAgICAgICAgaWYgKGNhbmRpZGF0ZS5tZW1iZXJzaGlwICYgQk9BUkQgIT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGFkZHJlc3MgYXBwdCA9IGNhbmRpZGF0ZS5hcHBvaW50ZXI7CiAgICAgICAgaWYgKGFjY291bnRzW2FwcHRdLm1lbWJlcnNoaXAgJiBCT0FSRCA9PSAwKSB7CiAgICAgICAgICAgIGNhbmRpZGF0ZS5hcHBvaW50ZXIgPSBtc2cuc2VuZGVyOwogICAgICAgICAgICBOb21pbmF0ZWQoX2JvYXJkLCBfdm91Y2gpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChhcHB0ID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBOb21pbmF0ZWQoX2JvYXJkLCBfdm91Y2gpOwogICAgICAgIGNhbmRpZGF0ZS5tZW1iZXJzaGlwIHw9IEJPQVJEOwogICAgICAgIEJvYXJkKF9ib2FyZCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGVub3VuY2UoYWRkcmVzcyBfYm9hcmQsIHN0cmluZyBfcmVhc29uKQogICAgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoYWNjb3VudHNbbXNnLnNlbmRlcl0ubWVtYmVyc2hpcCAmIEJPQVJEICE9IDApOwogICAgICAgIEFjY291bnQgc3RvcmFnZSBib2FyZCA9IGFjY291bnRzW19ib2FyZF07CiAgICAgICAgaWYgKGJvYXJkLm1lbWJlcnNoaXAgJiBCT0FSRCA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYWRkcmVzcyBkbmNyID0gYm9hcmQuZGVub3VuY2VyOwogICAgICAgIGlmIChhY2NvdW50c1tkbmNyXS5tZW1iZXJzaGlwICYgQk9BUkQgPT0gMCkgewogICAgICAgICAgICBib2FyZC5kZW5vdW5jZXIgPSBtc2cuc2VuZGVyOwogICAgICAgICAgICBEZW5vdW5jZWQoX2JvYXJkLCBfcmVhc29uKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoZG5jciA9PSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgRGVub3VuY2VkKF9ib2FyZCwgX3JlYXNvbik7CiAgICAgICAgYm9hcmQubWVtYmVyc2hpcCBePSBCT0FSRDsKICAgICAgICBSZXZva2VkKF9ib2FyZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdm91Y2hQcm9wb3NlcihhZGRyZXNzIF9wcm9wb3Nlciwgc3RyaW5nIF92b3VjaCkKICAgIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGFjY291bnRzW21zZy5zZW5kZXJdLm1lbWJlcnNoaXAgJiBCT0FSRCAhPSAwKTsKICAgICAgICBBY2NvdW50IHN0b3JhZ2UgY2FuZGlkYXRlID0gYWNjb3VudHNbX3Byb3Bvc2VyXTsKICAgICAgICBpZiAoY2FuZGlkYXRlLm1lbWJlcnNoaXAgJiBQUk9QT1NFUiAhPSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYWRkcmVzcyBhcHB0ID0gY2FuZGlkYXRlLnZvdWNoZXI7CiAgICAgICAgaWYgKGFjY291bnRzW2FwcHRdLm1lbWJlcnNoaXAgJiBCT0FSRCA9PSAwKSB7CiAgICAgICAgICAgIGNhbmRpZGF0ZS52b3VjaGVyID0gbXNnLnNlbmRlcjsKICAgICAgICAgICAgVm91Y2goX3Byb3Bvc2VyLCBfdm91Y2gpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChhcHB0ID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBWb3VjaChfcHJvcG9zZXIsIF92b3VjaCk7CiAgICAgICAgY2FuZGlkYXRlLm1lbWJlcnNoaXAgfD0gUFJPUE9TRVI7CiAgICAgICAgUHJvcG9zZXIoX3Byb3Bvc2VyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZXZvdWNoUHJvcG9zZXIoYWRkcmVzcyBfcHJvcG9zZXIsIHN0cmluZyBfZGV2b3VjaCkKICAgIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKGFjY291bnRzW21zZy5zZW5kZXJdLm1lbWJlcnNoaXAgJiBCT0FSRCAhPSAwKTsKICAgICAgICBBY2NvdW50IHN0b3JhZ2UgY2FuZGlkYXRlID0gYWNjb3VudHNbX3Byb3Bvc2VyXTsKICAgICAgICBpZiAoY2FuZGlkYXRlLm1lbWJlcnNoaXAgJiBQUk9QT1NFUiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYWRkcmVzcyBhcHB0ID0gY2FuZGlkYXRlLmRldm91Y2hlcjsKICAgICAgICBpZiAoYWNjb3VudHNbYXBwdF0ubWVtYmVyc2hpcCAmIEJPQVJEID09IDApIHsKICAgICAgICAgICAgY2FuZGlkYXRlLmRldm91Y2hlciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgIERldm91Y2goX3Byb3Bvc2VyLCBfZGV2b3VjaCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGFwcHQgPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIERldm91Y2goX3Byb3Bvc2VyLCBfZGV2b3VjaCk7CiAgICAgICAgY2FuZGlkYXRlLm1lbWJlcnNoaXAgJj0gflBST1BPU0VSOwogICAgICAgIFNodXRkb3duKF9wcm9wb3Nlcik7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvcG9zZVByb3BlcihieXRlcyBfcmVzb2x1dGlvbikKICAgIGV4dGVybmFsCiAgICByZXR1cm5zIChQcm9wb3NhbEludGVyZmFjZSkKICAgIHsKICAgICAgICBQcm9wZXJQcm9wb3NhbCBwcm9wb3NhbCA9IG5ldyBQcm9wZXJQcm9wb3NhbCgpOwogICAgICAgIHByb3Bvc2FsLmluaXQobXNnLnNlbmRlciwgX3Jlc29sdXRpb24pOwogICAgICAgIGFjY291bnRzW3Byb3Bvc2FsXS5tZW1iZXJzaGlwIHw9IFBST1BPU0FMOwogICAgICAgIFByb3Bvc2FsKHByb3Bvc2FsKTsKICAgICAgICByZXR1cm4gcHJvcG9zYWw7CiAgICB9CgogICAgZnVuY3Rpb24gcHJvcG9zZVByb3h5KGJ5dGVzIF9yZXNvbHV0aW9uKQogICAgZXh0ZXJuYWwKICAgIHJldHVybnMgKFByb3Bvc2FsSW50ZXJmYWNlKQogICAgewogICAgICAgIFByb3BlclByb3Bvc2FsIHByb3Bvc2FsOwogICAgICAgIGJ5dGVzIG1lbW9yeSBjbG9uZSA9IGhleCI2MDAwMzQ2MDNiNTc2MDJmODA2MDBmODMzOTgxZjM2MDAwMzY4MTgwMzc4MDgwMzY4MTZmNWZiZTJjYzliMWI2ODRlYzQ0NWNhZjE3NjA0MjM0OGU1YWY0MTU2MDJjNTczZDgxODAzZTNkODFmMzViODBmZCI7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgZGF0YSA6PSBhZGQoY2xvbmUsIDB4MjApCiAgICAgICAgICAgIHByb3Bvc2FsIDo9IGNyZWF0ZSgwLCBkYXRhLCA1OCkKICAgICAgICB9CiAgICAgICAgcHJvcG9zYWwuaW5pdChtc2cuc2VuZGVyLCBfcmVzb2x1dGlvbik7CiAgICAgICAgYWNjb3VudHNbcHJvcG9zYWxdLm1lbWJlcnNoaXAgfD0gUFJPUE9TQUw7CiAgICAgICAgUHJvcG9zYWwocHJvcG9zYWwpOwogICAgICAgIHJldHVybiBwcm9wb3NhbDsKICAgIH0KCiAgICBmdW5jdGlvbiBzdWRvUHJvcG9zZShQcm9wb3NhbEludGVyZmFjZSBfcHJvcG9zYWwpCiAgICBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShhY2NvdW50c1ttc2cuc2VuZGVyXS5tZW1iZXJzaGlwICYgUFJPUE9TRVIgIT0gMCk7CiAgICAgICAgdWludDggbWVtYmVyc2hpcCA9IGFjY291bnRzW19wcm9wb3NhbF0ubWVtYmVyc2hpcDsKICAgICAgICByZXF1aXJlKG1lbWJlcnNoaXAgPT0gMCk7CiAgICAgICAgYWNjb3VudHNbX3Byb3Bvc2FsXS5tZW1iZXJzaGlwID0gUFJPUE9TQUw7CiAgICAgICAgUHJvcG9zYWwoX3Byb3Bvc2FsKTsKICAgIH0KCiAgICAvLyBUbyBzdWJtaXQgYW4gb3V0c2lkZSBwcm9wb3NhbCBjb250cmFjdCwgeW91IG11c3Q6CiAgICAvLyAtIGVuc3VyZSBpdCBjb25mb3JtcyB0byBQcm9wb3NhbEludGVyZmFjZQogICAgLy8gLSBlbnN1cmUgaXQgcHJvcGVybHkgdHJhbnNmZXJzIHRoZSBWT1RFIHRva2VuLCBjYWxsaW5nIFZvdGUudm90ZVgKICAgIC8vIC0gb3Blbi1zb3VyY2UgaXQgdXNpbmcgRXRoZXJzY2FuIG9yIGVxdWl2YWxlbnQKICAgIGZ1bmN0aW9uIHByb3Bvc2VFeHRlcm5hbChQcm9wb3NhbEludGVyZmFjZSBfcHJvcG9zYWwpCiAgICBleHRlcm5hbAogICAgewogICAgICAgIEFjY291bnQgc3RvcmFnZSBhY2NvdW50ID0gYWNjb3VudHNbX3Byb3Bvc2FsXTsKICAgICAgICByZXF1aXJlKGFjY291bnQubWVtYmVyc2hpcCAmIChQRU5ESU5HX1BST1BPU0FMIHwgUFJPUE9TQUwpID09IDApOwogICAgICAgIGFjY291bnQubWVtYmVyc2hpcCB8PSBQRU5ESU5HX1BST1BPU0FMOwogICAgfQoKICAgIGZ1bmN0aW9uIGNvbmZpcm1Qcm9wb3NhbChQcm9wb3NhbEludGVyZmFjZSBfcHJvcG9zYWwpCiAgICBleHRlcm5hbAogICAgewogICAgICAgIHJlcXVpcmUoYWNjb3VudHNbbXNnLnNlbmRlcl0ubWVtYmVyc2hpcCAmIEJPQVJEICE9IDApOwogICAgICAgIEFjY291bnQgc3RvcmFnZSBhY2NvdW50ID0gYWNjb3VudHNbX3Byb3Bvc2FsXTsKICAgICAgICByZXF1aXJlKGFjY291bnQubWVtYmVyc2hpcCAmIFBFTkRJTkdfUFJPUE9TQUwgIT0gMCk7CiAgICAgICAgYWNjb3VudC5tZW1iZXJzaGlwIF49IChQUk9QT1NBTCB8IFBFTkRJTkdfUFJPUE9TQUwpOwogICAgICAgIFByb3Bvc2FsKF9wcm9wb3NhbCk7CiAgICB9CgogICAgLy8gYmFucyBwcmV2ZW50IGFjY291bnRzIGZyb20gdm90aW5nIHRocm91Z2ggdGhpcyBwcm9wb3NhbAogICAgLy8gdGhpcyBzaG91bGQgb25seSBiZSB1c2VkIHRvIHN0b3AgYSBwcm9wb3NhbCB0aGF0IGlzIGFidXNpbmcgdGhlIFZPVEUgdG9rZW4KICAgIC8vIHRoZSBidXJuIGlzIHRvIHBlbmFsaXplIGJhbnMsIHNvIHRoYXQgdGhleSBjYW5ub3Qgc3VwcHJlc3MgaWRlYXMKICAgIGZ1bmN0aW9uIGJhblByb3Bvc2FsKFByb3Bvc2FsSW50ZXJmYWNlIF9wcm9wb3NhbCwgc3RyaW5nIF9yZWFzb24pCiAgICBleHRlcm5hbCBwYXlhYmxlCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gcHJvcG9zYWxDZW5zb3JzaGlwRmVlKTsKICAgICAgICByZXF1aXJlKGFjY291bnRzW21zZy5zZW5kZXJdLm1lbWJlcnNoaXAgJiBCT0FSRCAhPSAwKTsKICAgICAgICBBY2NvdW50IHN0b3JhZ2UgYWNjb3VudCA9IGFjY291bnRzW19wcm9wb3NhbF07CiAgICAgICAgcmVxdWlyZShhY2NvdW50Lm1lbWJlcnNoaXAgJiBQUk9QT1NBTCAhPSAwKTsKICAgICAgICBhY2NvdW50Lm1lbWJlcnNoaXAgJj0gflBST1BPU0FMOwogICAgICAgIGJ1cm4udHJhbnNmZXIocHJvcG9zYWxDZW5zb3JzaGlwRmVlKTsKICAgICAgICBCYW5uZWRQcm9wb3NhbChfcHJvcG9zYWwsIF9yZWFzb24pOwogICAgfQoKICAgIC8vIGJvYXJkIG1lbWJlcnMgcmVzZXJ2ZSB0aGUgcmlnaHQgdG8gcmVqZWN0IG91dHNpZGUgcHJvcG9zYWxzIGZvciBhbnkgcmVhc29uCiAgICBmdW5jdGlvbiByZWplY3RQcm9wb3NhbChQcm9wb3NhbEludGVyZmFjZSBfcHJvcG9zYWwpCiAgICBleHRlcm5hbAogICAgewogICAgICAgIHJlcXVpcmUoYWNjb3VudHNbbXNnLnNlbmRlcl0ubWVtYmVyc2hpcCAmIEJPQVJEICE9IDApOwogICAgICAgIEFjY291bnQgc3RvcmFnZSBhY2NvdW50ID0gYWNjb3VudHNbX3Byb3Bvc2FsXTsKICAgICAgICByZXF1aXJlKGFjY291bnQubWVtYmVyc2hpcCAmIFBFTkRJTkdfUFJPUE9TQUwgIT0gMCk7CiAgICAgICAgYWNjb3VudC5tZW1iZXJzaGlwICY9IFBFTkRJTkdfUFJPUE9TQUw7CiAgICB9CgogICAgLy8gdGhpcyBjb2RlIGxpdmVzIGhlcmUgaW5zdGVhZCBvZiBpbiB0aGUgdG9rZW4gc28gdGhhdCBpdCBjYW4gYmUgdXBncmFkZWQgd2l0aCBhY2NvdW50IHJlZ2lzdHJ5IG1pZ3JhdGlvbgogICAgZnVuY3Rpb24gZmF1Y2V0KCkKICAgIGV4dGVybmFsIHsKICAgICAgICBBY2NvdW50IHN0b3JhZ2UgYWNjb3VudCA9IGFjY291bnRzW21zZy5zZW5kZXJdOwogICAgICAgIHJlcXVpcmUoYWNjb3VudC5tZW1iZXJzaGlwICYgVk9URVIgIT0gMCk7CiAgICAgICAgdWludDI1NiBsYXN0QWNjZXNzID0gYWNjb3VudC5sYXN0QWNjZXNzOwogICAgICAgIHVpbnQyNTYgZ3JhbnQgPSAobm93IC0gbGFzdEFjY2VzcykgLyA3MiBtaW51dGVzOwogICAgICAgIGlmIChncmFudCA+IDQwKSB7CiAgICAgICAgICAgIGdyYW50ID0gNDA7CiAgICAgICAgICAgIGFjY291bnQubGFzdEFjY2VzcyA9IG5vdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhY2NvdW50Lmxhc3RBY2Nlc3MgPSBsYXN0QWNjZXNzICsgZ3JhbnQgKiA3MiBtaW51dGVzOwogICAgICAgIH0KICAgICAgICB0b2tlbi5ncmFudChtc2cuc2VuZGVyLCBncmFudCk7CiAgICB9CgogICAgZnVuY3Rpb24gYXZhaWxhYmxlRmF1Y2V0KGFkZHJlc3MgX2FjY291bnQpCiAgICBleHRlcm5hbCB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiBncmFudCA9IChub3cgLSBhY2NvdW50c1tfYWNjb3VudF0ubGFzdEFjY2VzcykgLyA3MiBtaW51dGVzOwogICAgICAgIGlmIChncmFudCA+IDQwKSB7CiAgICAgICAgICAgIGdyYW50ID0gNDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBncmFudDsKICAgIH0KfQ=='.
	

]
