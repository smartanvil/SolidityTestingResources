Class {
	#name : #SRT2d820ea3a6b9302c500feeb7f6361ba1ddfa5aba,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2d820ea3a6b9302c500feeb7f6361ba1ddfa5aba >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKgogICAgVXRpbGl0aWVzICYgQ29tbW9uIE1vZGlmaWVycwoqLwpjb250cmFjdCBVdGlscyB7CiAgICAvKioKICAgICAgICBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIFV0aWxzKCkgewogICAgfQoKICAgIC8vIHZlcmlmaWVzIHRoYXQgYW4gYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiB6ZXJvCiAgICBtb2RpZmllciBncmVhdGVyVGhhblplcm8odWludDI1NiBfYW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYW4gYWRkcmVzcyAtIGN1cnJlbnRseSBvbmx5IGNoZWNrcyB0aGF0IGl0IGlzbid0IG51bGwKICAgIG1vZGlmaWVyIHZhbGlkQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBpcyBkaWZmZXJlbnQgdGhhbiB0aGlzIGNvbnRyYWN0IGFkZHJlc3MKICAgIG1vZGlmaWVyIG5vdFRoaXMoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBPdmVyZmxvdyBwcm90ZWN0ZWQgbWF0aCBmdW5jdGlvbnMKCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIHN1bSBvZiBfeCBhbmQgX3ksIGFzc2VydHMgaWYgdGhlIGNhbGN1bGF0aW9uIG92ZXJmbG93cwoKICAgICAgICBAcGFyYW0gX3ggICB2YWx1ZSAxCiAgICAgICAgQHBhcmFtIF95ICAgdmFsdWUgMgoKICAgICAgICBAcmV0dXJuIHN1bQogICAgKi8KICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludDI1NiBfeCwgdWludDI1NiBfeSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgeiA9IF94ICsgX3k7CiAgICAgICAgYXNzZXJ0KHogPj0gX3gpOwogICAgICAgIHJldHVybiB6OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZGlmZmVyZW5jZSBvZiBfeCBtaW51cyBfeSwgYXNzZXJ0cyBpZiB0aGUgc3VidHJhY3Rpb24gcmVzdWx0cyBpbiBhIG5lZ2F0aXZlIG51bWJlcgoKICAgICAgICBAcGFyYW0gX3ggICBtaW51ZW5kCiAgICAgICAgQHBhcmFtIF95ICAgc3VidHJhaGVuZAoKICAgICAgICBAcmV0dXJuIGRpZmZlcmVuY2UKICAgICovCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoX3ggPj0gX3kpOwogICAgICAgIHJldHVybiBfeCAtIF95OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgcHJvZHVjdCBvZiBtdWx0aXBseWluZyBfeCBieSBfeSwgYXNzZXJ0cyBpZiB0aGUgY2FsY3VsYXRpb24gb3ZlcmZsb3dzCgogICAgICAgIEBwYXJhbSBfeCAgIGZhY3RvciAxCiAgICAgICAgQHBhcmFtIF95ICAgZmFjdG9yIDIKCiAgICAgICAgQHJldHVybiBwcm9kdWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiB6ID0gX3ggKiBfeTsKICAgICAgICBhc3NlcnQoX3ggPT0gMCB8fCB6IC8gX3ggPT0gX3kpOwogICAgICAgIHJldHVybiB6OwogICAgfQp9CgovKgogICAgT3duZWQgY29udHJhY3QgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElPd25lZCB7CiAgICAvLyB0aGlzIGZ1bmN0aW9uIGlzbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBvd25lcigpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIG93bmVyKSB7IG93bmVyOyB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYzsKfQoKLyoKICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3Qgb3duZXJzaGlwCiovCmNvbnRyYWN0IE93bmVkIGlzIElPd25lZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICAgIGV2ZW50IE93bmVyVXBkYXRlKGFkZHJlc3MgX3ByZXZPd25lciwgYWRkcmVzcyBfbmV3T3duZXIpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBieSB0aGUgb3duZXIgb25seQogICAgbW9kaWZpZXIgb3duZXJPbmx5IHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGFsbG93cyB0cmFuc2ZlcnJpbmcgdGhlIGNvbnRyYWN0IG93bmVyc2hpcAogICAgICAgIHRoZSBuZXcgb3duZXIgc3RpbGwgbmVlZHMgdG8gYWNjZXB0IHRoZSB0cmFuc2ZlcgogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF9uZXdPd25lciAgICBuZXcgY29udHJhY3Qgb3duZXIKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgcmVxdWlyZShfbmV3T3duZXIgIT0gb3duZXIpOwogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXNlZCBieSBhIG5ldyBvd25lciB0byBhY2NlcHQgYW4gb3duZXJzaGlwIHRyYW5zZmVyCiAgICAqLwogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmV3T3duZXIpOwogICAgICAgIE93bmVyVXBkYXRlKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgICAgICBuZXdPd25lciA9IDB4MDsKICAgIH0KfQoKLyoKICAgIFByb3ZpZGVzIHN1cHBvcnQgYW5kIHV0aWxpdGllcyBmb3IgY29udHJhY3QgbWFuYWdlbWVudAoqLwpjb250cmFjdCBNYW5hZ2VkIHsKICAgIGFkZHJlc3MgcHVibGljIG1hbmFnZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdNYW5hZ2VyOwoKICAgIGV2ZW50IE1hbmFnZXJVcGRhdGUoYWRkcmVzcyBfcHJldk1hbmFnZXIsIGFkZHJlc3MgX25ld01hbmFnZXIpOwoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBNYW5hZ2VkKCkgewogICAgICAgIG1hbmFnZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gYnkgdGhlIG1hbmFnZXIgb25seQogICAgbW9kaWZpZXIgbWFuYWdlck9ubHkgewogICAgICAgIGFzc2VydChtc2cuc2VuZGVyID09IG1hbmFnZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSBjb250cmFjdCBtYW5hZ2VtZW50CiAgICAgICAgdGhlIG5ldyBtYW5hZ2VyIHN0aWxsIG5lZWRzIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG1hbmFnZXIKCiAgICAgICAgQHBhcmFtIF9uZXdNYW5hZ2VyICAgIG5ldyBjb250cmFjdCBtYW5hZ2VyCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJNYW5hZ2VtZW50KGFkZHJlc3MgX25ld01hbmFnZXIpIHB1YmxpYyBtYW5hZ2VyT25seSB7CiAgICAgICAgcmVxdWlyZShfbmV3TWFuYWdlciAhPSBtYW5hZ2VyKTsKICAgICAgICBuZXdNYW5hZ2VyID0gX25ld01hbmFnZXI7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1c2VkIGJ5IGEgbmV3IG1hbmFnZXIgdG8gYWNjZXB0IGEgbWFuYWdlbWVudCB0cmFuc2ZlcgogICAgKi8KICAgIGZ1bmN0aW9uIGFjY2VwdE1hbmFnZW1lbnQoKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBuZXdNYW5hZ2VyKTsKICAgICAgICBNYW5hZ2VyVXBkYXRlKG1hbmFnZXIsIG5ld01hbmFnZXIpOwogICAgICAgIG1hbmFnZXIgPSBuZXdNYW5hZ2VyOwogICAgICAgIG5ld01hbmFnZXIgPSAweDA7CiAgICB9Cn0KCi8qCiAgICBUb2tlbiBIb2xkZXIgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElUb2tlbkhvbGRlciBpcyBJT3duZWQgewogICAgZnVuY3Rpb24gd2l0aGRyYXdUb2tlbnMoSUVSQzIwVG9rZW4gX3Rva2VuLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7Cn0KCi8qCiAgICBXZSBjb25zaWRlciBldmVyeSBjb250cmFjdCB0byBiZSBhICd0b2tlbiBob2xkZXInIHNpbmNlIGl0J3MgY3VycmVudGx5IG5vdCBwb3NzaWJsZQogICAgZm9yIGEgY29udHJhY3QgdG8gZGVueSByZWNlaXZpbmcgdG9rZW5zLgoKICAgIFRoZSBUb2tlbkhvbGRlcidzIGNvbnRyYWN0IHNvbGUgcHVycG9zZSBpcyB0byBwcm92aWRlIGEgc2FmZXR5IG1lY2hhbmlzbSB0aGF0IGFsbG93cwogICAgdGhlIG93bmVyIHRvIHNlbmQgdG9rZW5zIHRoYXQgd2VyZSBzZW50IHRvIHRoZSBjb250cmFjdCBieSBtaXN0YWtlIGJhY2sgdG8gdGhlaXIgc2VuZGVyLgoqLwpjb250cmFjdCBUb2tlbkhvbGRlciBpcyBJVG9rZW5Ib2xkZXIsIE93bmVkLCBVdGlscyB7CiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gVG9rZW5Ib2xkZXIoKSB7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB3aXRoZHJhd3MgdG9rZW5zIGhlbGQgYnkgdGhlIGNvbnRyYWN0IGFuZCBzZW5kcyB0aGVtIHRvIGFuIGFjY291bnQKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICBFUkMyMCB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF90byAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudAogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd1Rva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgICAgICB2YWxpZEFkZHJlc3MoX3RvKQogICAgICAgIG5vdFRoaXMoX3RvKQogICAgewogICAgICAgIGFzc2VydChfdG9rZW4udHJhbnNmZXIoX3RvLCBfYW1vdW50KSk7CiAgICB9Cn0KCi8qCiAgICBUaGUgc21hcnQgdG9rZW4gY29udHJvbGxlciBpcyBhbiB1cGdyYWRhYmxlIHBhcnQgb2YgdGhlIHNtYXJ0IHRva2VuIHRoYXQgYWxsb3dzCiAgICBtb3JlIGZ1bmN0aW9uYWxpdHkgYXMgd2VsbCBhcyBmaXhlcyBmb3IgYnVncy9leHBsb2l0cy4KICAgIE9uY2UgaXQgYWNjZXB0cyBvd25lcnNoaXAgb2YgdGhlIHRva2VuLCBpdCBiZWNvbWVzIHRoZSB0b2tlbidzIHNvbGUgY29udHJvbGxlcgogICAgdGhhdCBjYW4gZXhlY3V0ZSBhbnkgb2YgaXRzIGZ1bmN0aW9ucy4KCiAgICBUbyB1cGdyYWRlIHRoZSBjb250cm9sbGVyLCBvd25lcnNoaXAgbXVzdCBiZSB0cmFuc2ZlcnJlZCB0byBhIG5ldyBjb250cm9sbGVyLCBhbG9uZyB3aXRoCiAgICBhbnkgcmVsZXZhbnQgZGF0YS4KCiAgICBUaGUgc21hcnQgdG9rZW4gbXVzdCBiZSBzZXQgb24gY29uc3RydWN0aW9uIGFuZCBjYW5ub3QgYmUgY2hhbmdlZCBhZnRlcndhcmRzLgogICAgV3JhcHBlcnMgYXJlIHByb3ZpZGVkIChhcyBvcHBvc2VkIHRvIGEgc2luZ2xlICdleGVjdXRlJyBmdW5jdGlvbikgZm9yIGVhY2ggb2YgdGhlIHRva2VuJ3MgZnVuY3Rpb25zLCBmb3IgZWFzaWVyIGFjY2Vzcy4KCiAgICBOb3RlIHRoYXQgdGhlIGNvbnRyb2xsZXIgY2FuIHRyYW5zZmVyIHRva2VuIG93bmVyc2hpcCB0byBhIG5ldyBjb250cm9sbGVyIHRoYXQKICAgIGRvZXNuJ3QgYWxsb3cgZXhlY3V0aW5nIGFueSBmdW5jdGlvbiBvbiB0aGUgdG9rZW4sIGZvciBhIHRydXN0bGVzcyBzb2x1dGlvbi4KICAgIERvaW5nIHRoYXQgd2lsbCBhbHNvIHJlbW92ZSB0aGUgb3duZXIncyBhYmlsaXR5IHRvIHVwZ3JhZGUgdGhlIGNvbnRyb2xsZXIuCiovCmNvbnRyYWN0IFNtYXJ0VG9rZW5Db250cm9sbGVyIGlzIFRva2VuSG9sZGVyIHsKICAgIElTbWFydFRva2VuIHB1YmxpYyB0b2tlbjsgICAvLyBzbWFydCB0b2tlbgoKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBTbWFydFRva2VuQ29udHJvbGxlcihJU21hcnRUb2tlbiBfdG9rZW4pCiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgIHsKICAgICAgICB0b2tlbiA9IF90b2tlbjsKICAgIH0KCiAgICAvLyBlbnN1cmVzIHRoYXQgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIHRva2VuJ3Mgb3duZXIKICAgIG1vZGlmaWVyIGFjdGl2ZSgpIHsKICAgICAgICBhc3NlcnQodG9rZW4ub3duZXIoKSA9PSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGVuc3VyZXMgdGhhdCB0aGUgY29udHJvbGxlciBpcyBub3QgdGhlIHRva2VuJ3Mgb3duZXIKICAgIG1vZGlmaWVyIGluYWN0aXZlKCkgewogICAgICAgIGFzc2VydCh0b2tlbi5vd25lcigpICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSB0b2tlbiBvd25lcnNoaXAKICAgICAgICB0aGUgbmV3IG93bmVyIHN0aWxsIG5lZWQgdG8gYWNjZXB0IHRoZSB0cmFuc2ZlcgogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF9uZXdPd25lciAgICBuZXcgdG9rZW4gb3duZXIKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlclRva2VuT3duZXJzaGlwKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICB0b2tlbi50cmFuc2Zlck93bmVyc2hpcChfbmV3T3duZXIpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXNlZCBieSBhIG5ldyBvd25lciB0byBhY2NlcHQgYSB0b2tlbiBvd25lcnNoaXAgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCiAgICAqLwogICAgZnVuY3Rpb24gYWNjZXB0VG9rZW5Pd25lcnNoaXAoKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICB0b2tlbi5hY2NlcHRPd25lcnNoaXAoKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGRpc2FibGVzL2VuYWJsZXMgdG9rZW4gdHJhbnNmZXJzCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgoKICAgICAgICBAcGFyYW0gX2Rpc2FibGUgICAgdHJ1ZSB0byBkaXNhYmxlIHRyYW5zZmVycywgZmFsc2UgdG8gZW5hYmxlIHRoZW0KICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlVG9rZW5UcmFuc2ZlcnMoYm9vbCBfZGlzYWJsZSkgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgdG9rZW4uZGlzYWJsZVRyYW5zZmVycyhfZGlzYWJsZSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB3aXRoZHJhd3MgdG9rZW5zIGhlbGQgYnkgdGhlIHRva2VuIGFuZCBzZW5kcyB0aGVtIHRvIGFuIGFjY291bnQKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICBFUkMyMCB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF90byAgICAgIGFjY291bnQgdG8gcmVjZWl2ZSB0aGUgbmV3IGFtb3VudAogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgdG8gd2l0aGRyYXcKICAgICovCiAgICBmdW5jdGlvbiB3aXRoZHJhd0Zyb21Ub2tlbihJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHRva2VuLndpdGhkcmF3VG9rZW5zKF90b2tlbiwgX3RvLCBfYW1vdW50KTsKICAgIH0KfQoKLyoKICAgIEVSQzIwIFN0YW5kYXJkIFRva2VuIGludGVyZmFjZQoqLwpjb250cmFjdCBJRVJDMjBUb2tlbiB7CiAgICAvLyB0aGVzZSBmdW5jdGlvbnMgYXJlbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZyBuYW1lKSB7IG5hbWU7IH0KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChzdHJpbmcgc3ltYm9sKSB7IHN5bWJvbDsgfQogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDggZGVjaW1hbHMpIHsgZGVjaW1hbHM7IH0KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgdG90YWxTdXBwbHkpIHsgdG90YWxTdXBwbHk7IH0KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgeyBfb3duZXI7IGJhbGFuY2U7IH0KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7IF9vd25lcjsgX3NwZW5kZXI7IHJlbWFpbmluZzsgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwp9CgovKgogICAgRXRoZXIgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElFdGhlclRva2VuIGlzIElUb2tlbkhvbGRlciwgSUVSQzIwVG9rZW4gewogICAgZnVuY3Rpb24gZGVwb3NpdCgpIHB1YmxpYyBwYXlhYmxlOwogICAgZnVuY3Rpb24gd2l0aGRyYXcodWludDI1NiBfYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiB3aXRoZHJhd1RvKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpOwp9CgovKgogICAgU21hcnQgVG9rZW4gaW50ZXJmYWNlCiovCmNvbnRyYWN0IElTbWFydFRva2VuIGlzIElUb2tlbkhvbGRlciwgSUVSQzIwVG9rZW4gewogICAgZnVuY3Rpb24gZGlzYWJsZVRyYW5zZmVycyhib29sIF9kaXNhYmxlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpc3N1ZShhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBkZXN0cm95KGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgovKgogICAgQmFuY29yIEZvcm11bGEgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElCYW5jb3JGb3JtdWxhIHsKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVB1cmNoYXNlUmV0dXJuKHVpbnQyNTYgX3N1cHBseSwgdWludDI1NiBfcmVzZXJ2ZUJhbGFuY2UsIHVpbnQzMiBfcmVzZXJ2ZVJhdGlvLCB1aW50MjU2IF9kZXBvc2l0QW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBjYWxjdWxhdGVTYWxlUmV0dXJuKHVpbnQyNTYgX3N1cHBseSwgdWludDI1NiBfcmVzZXJ2ZUJhbGFuY2UsIHVpbnQzMiBfcmVzZXJ2ZVJhdGlvLCB1aW50MjU2IF9zZWxsQW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7Cn0KCi8qCiAgICBFSVAyMjggVG9rZW4gQ2hhbmdlciBpbnRlcmZhY2UKKi8KY29udHJhY3QgSVRva2VuQ2hhbmdlciB7CiAgICBmdW5jdGlvbiBjaGFuZ2VhYmxlVG9rZW5Db3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYgY291bnQpOwogICAgZnVuY3Rpb24gY2hhbmdlYWJsZVRva2VuKHVpbnQxNiBfdG9rZW5JbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MgdG9rZW5BZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldFJldHVybihJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBhbW91bnQpOwogICAgZnVuY3Rpb24gY2hhbmdlKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KTsKfQoKLyoKICAgIE9wZW4gaXNzdWVzOgogICAgLSBBZGQgbWluZXIgZnJvbnQtcnVubmluZyBhdHRhY2sgcHJvdGVjdGlvbi4gVGhlIGlzc3VlIGlzIHNvbWV3aGF0IG1pdGlnYXRlZCBieSB0aGUgdXNlIG9mIF9taW5SZXR1cm4gd2hlbiBjaGFuZ2luZwogICAgLSBQb3NzaWJseSBhZGQgZ2V0dGVycyBmb3IgcmVzZXJ2ZSBmaWVsZHMgc28gdGhhdCB0aGUgY2xpZW50IHdvbid0IG5lZWQgdG8gcmVseSBvbiB0aGUgb3JkZXIgaW4gdGhlIHN0cnVjdAoqLwoKLyoKICAgIEJhbmNvciBDaGFuZ2VyIHYwLjIKCiAgICBUaGUgQmFuY29yIHZlcnNpb24gb2YgdGhlIHRva2VuIGNoYW5nZXIsIGFsbG93cyBjaGFuZ2luZyBiZXR3ZWVuIGEgc21hcnQgdG9rZW4gYW5kIG90aGVyIEVSQzIwIHRva2VucyBhbmQgYmV0d2VlbiBkaWZmZXJlbnQgRVJDMjAgdG9rZW5zIGFuZCB0aGVtc2VsdmVzLgoKICAgIEVSQzIwIHJlc2VydmUgdG9rZW4gYmFsYW5jZSBjYW4gYmUgdmlydHVhbCwgbWVhbmluZyB0aGF0IHRoZSBjYWxjdWxhdGlvbnMgYXJlIGJhc2VkIG9uIHRoZSB2aXJ0dWFsIGJhbGFuY2UgaW5zdGVhZCBvZiByZWx5aW5nIG9uCiAgICB0aGUgYWN0dWFsIHJlc2VydmUgYmFsYW5jZS4gVGhpcyBpcyBhIHNlY3VyaXR5IG1lY2hhbmlzbSB0aGF0IHByZXZlbnRzIHRoZSBuZWVkIHRvIGtlZXAgYSB2ZXJ5IGxhcmdlIChhbmQgdmFsdWFibGUpIGJhbGFuY2UgaW4gYSBzaW5nbGUgY29udHJhY3QuCgogICAgVGhlIGNoYW5nZXIgaXMgdXBncmFkYWJsZSAoanVzdCBsaWtlIGFueSBTbWFydFRva2VuQ29udHJvbGxlcikuCgogICAgQSBub3RlIG9uIGNoYW5nZSBwYXRocyAtCiAgICBDaGFuZ2UgcGF0aCBpcyBhIGRhdGEgc3RydWN0dXJlIHRoYXQncyB1c2VkIHdoZW4gY2hhbmdpbmcgYSB0b2tlbiB0byBhbm90aGVyIHRva2VuIGluIHRoZSBiYW5jb3IgbmV0d29yawogICAgd2hlbiB0aGUgY2hhbmdlIGNhbm5vdCBuZWNlc3NhcmlseSBiZSBkb25lIGJ5IHNpbmdsZSBjaGFuZ2VyIGFuZCBtaWdodCByZXF1aXJlIG11bHRpcGxlICdob3BzJy4KICAgIFRoZSBwYXRoIGRlZmluZXMgd2hpY2ggY2hhbmdlcnMgc2hvdWxkIGJlIHVzZWQgYW5kIHdoYXQga2luZCBvZiBjaGFuZ2Ugc2hvdWxkIGJlIGRvbmUgaW4gZWFjaCBzdGVwLgoKICAgIFRoZSBwYXRoIGZvcm1hdCBkb2Vzbid0IGluY2x1ZGUgY29tcGxleCBzdHJ1Y3R1cmUgYW5kIGluc3RlYWQsIGl0IGlzIHJlcHJlc2VudGVkIGJ5IGEgc2luZ2xlIGFycmF5CiAgICBpbiB3aGljaCBlYWNoICdob3AnIGlzIHJlcHJlc2VudGVkIGJ5IGEgMi10dXBsZSAtIHNtYXJ0IHRva2VuICYgdG8gdG9rZW4uCiAgICBJbiBhZGRpdGlvbiwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgYWx3YXlzIHRoZSBzb3VyY2UgdG9rZW4uCiAgICBUaGUgc21hcnQgdG9rZW4gaXMgb25seSB1c2VkIGFzIGEgcG9pbnRlciB0byBhIGNoYW5nZXIgKHNpbmNlIGNoYW5nZXIgYWRkcmVzc2VzIGFyZSBtb3JlIGxpa2VseSB0byBjaGFuZ2UpLgoKICAgIEZvcm1hdDoKICAgIFtzb3VyY2UgdG9rZW4sIHNtYXJ0IHRva2VuLCB0byB0b2tlbiwgc21hcnQgdG9rZW4sIHRvIHRva2VuLi4uXQoKCiAgICBXQVJOSU5HOiBJdCBpcyBOT1QgUkVDT01NRU5ERUQgdG8gdXNlIHRoZSBjaGFuZ2VyIHdpdGggU21hcnQgVG9rZW5zIHRoYXQgaGF2ZSBsZXNzIHRoYW4gOCBkZWNpbWFsIGRpZ2l0cwogICAgICAgICAgICAgb3Igd2l0aCB2ZXJ5IHNtYWxsIG51bWJlcnMgYmVjYXVzZSBvZiBwcmVjaXNpb24gbG9zcwoqLwpjb250cmFjdCBCYW5jb3JDaGFuZ2VyIGlzIElUb2tlbkNoYW5nZXIsIFNtYXJ0VG9rZW5Db250cm9sbGVyLCBNYW5hZ2VkIHsKICAgIHVpbnQzMiBwcml2YXRlIGNvbnN0YW50IE1BWF9DUlIgPSAxMDAwMDAwOwogICAgdWludDMyIHByaXZhdGUgY29uc3RhbnQgTUFYX0NIQU5HRV9GRUUgPSAxMDAwMDAwOwoKICAgIHN0cnVjdCBSZXNlcnZlIHsKICAgICAgICB1aW50MjU2IHZpcnR1YWxCYWxhbmNlOyAgICAgICAgIC8vIHZpcnR1YWwgYmFsYW5jZQogICAgICAgIHVpbnQzMiByYXRpbzsgICAgICAgICAgICAgICAgICAgLy8gY29uc3RhbnQgcmVzZXJ2ZSByYXRpbyAoQ1JSKSwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBib29sIGlzVmlydHVhbEJhbGFuY2VFbmFibGVkOyAgIC8vIHRydWUgaWYgdmlydHVhbCBiYWxhbmNlIGlzIGVuYWJsZWQsIGZhbHNlIGlmIG5vdAogICAgICAgIGJvb2wgaXNQdXJjaGFzZUVuYWJsZWQ7ICAgICAgICAgLy8gaXMgcHVyY2hhc2Ugb2YgdGhlIHNtYXJ0IHRva2VuIGVuYWJsZWQgd2l0aCB0aGUgcmVzZXJ2ZSwgY2FuIGJlIHNldCBieSB0aGUgb3duZXIKICAgICAgICBib29sIGlzU2V0OyAgICAgICAgICAgICAgICAgICAgIC8vIHVzZWQgdG8gdGVsbCBpZiB0aGUgbWFwcGluZyBlbGVtZW50IGlzIGRlZmluZWQKICAgIH0KCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC4yJzsKICAgIHN0cmluZyBwdWJsaWMgY2hhbmdlclR5cGUgPSAnYmFuY29yJzsKCiAgICBJQmFuY29yRm9ybXVsYSBwdWJsaWMgZm9ybXVsYTsgICAgICAgICAgICAgICAgICAvLyBiYW5jb3IgY2FsY3VsYXRpb24gZm9ybXVsYSBjb250cmFjdAogICAgSUVSQzIwVG9rZW5bXSBwdWJsaWMgcmVzZXJ2ZVRva2VuczsgICAgICAgICAgICAgLy8gRVJDMjAgc3RhbmRhcmQgdG9rZW4gYWRkcmVzc2VzCiAgICBJRVJDMjBUb2tlbltdIHB1YmxpYyBxdWlja0J1eVBhdGg7ICAgICAgICAgICAgICAvLyBjaGFuZ2UgcGF0aCB0aGF0J3MgdXNlZCBpbiBvcmRlciB0byBidXkgdGhlIHRva2VuIHdpdGggRVRICiAgICBtYXBwaW5nIChhZGRyZXNzID0+IFJlc2VydmUpIHB1YmxpYyByZXNlcnZlczsgICAvLyByZXNlcnZlIHRva2VuIGFkZHJlc3NlcyAtPiByZXNlcnZlIGRhdGEKICAgIHVpbnQzMiBwcml2YXRlIHRvdGFsUmVzZXJ2ZVJhdGlvID0gMDsgICAgICAgICAgIC8vIHVzZWQgdG8gZWZmaWNpZW50bHkgcHJldmVudCBpbmNyZWFzaW5nIHRoZSB0b3RhbCByZXNlcnZlIHJhdGlvIGFib3ZlIDEwMCUKICAgIHVpbnQzMiBwdWJsaWMgbWF4Q2hhbmdlRmVlID0gMDsgICAgICAgICAgICAgICAgIC8vIG1heGltdW0gY2hhbmdlIGZlZSBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBjb250cmFjdCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAwLi4uMTAwMDAwMCAoMCA9IG5vIGZlZSwgMTAwID0gMC4wMSUsIDEwMDAwMDAgPSAxMDAlKQogICAgdWludDMyIHB1YmxpYyBjaGFuZ2VGZWUgPSAwOyAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudCBjaGFuZ2UgZmVlLCByZXByZXNlbnRlZCBpbiBwcG0sIDAuLi5tYXhDaGFuZ2VGZWUKICAgIGJvb2wgcHVibGljIGNoYW5naW5nRW5hYmxlZCA9IHRydWU7ICAgICAgICAgICAgIC8vIHRydWUgaWYgdG9rZW4gY2hhbmdpbmcgaXMgZW5hYmxlZCwgZmFsc2UgaWYgbm90CgogICAgLy8gdHJpZ2dlcmVkIHdoZW4gYSBjaGFuZ2UgYmV0d2VlbiB0d28gdG9rZW5zIG9jY3VycyAoVG9rZW5DaGFuZ2VyIGV2ZW50KQogICAgZXZlbnQgQ2hhbmdlKGFkZHJlc3MgaW5kZXhlZCBfZnJvbVRva2VuLCBhZGRyZXNzIGluZGV4ZWQgX3RvVG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfdHJhZGVyLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX3JldHVybiwKICAgICAgICAgICAgICAgICB1aW50MjU2IF9jdXJyZW50UHJpY2VOLCB1aW50MjU2IF9jdXJyZW50UHJpY2VEKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSAgX3Rva2VuICAgICAgICAgIHNtYXJ0IHRva2VuIGdvdmVybmVkIGJ5IHRoZSBjaGFuZ2VyCiAgICAgICAgQHBhcmFtICBfZm9ybXVsYSAgICAgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBmb3JtdWxhIGNvbnRyYWN0CiAgICAgICAgQHBhcmFtICBfbWF4Q2hhbmdlRmVlICAgbWF4aW11bSBjaGFuZ2UgZmVlLCByZXByZXNlbnRlZCBpbiBwcG0KICAgICAgICBAcGFyYW0gIF9yZXNlcnZlVG9rZW4gICBvcHRpb25hbCwgaW5pdGlhbCByZXNlcnZlLCBhbGxvd3MgZGVmaW5pbmcgdGhlIGZpcnN0IHJlc2VydmUgYXQgZGVwbG95bWVudCB0aW1lCiAgICAgICAgQHBhcmFtICBfcmVzZXJ2ZVJhdGlvICAgb3B0aW9uYWwsIHJhdGlvIGZvciB0aGUgaW5pdGlhbCByZXNlcnZlCiAgICAqLwogICAgZnVuY3Rpb24gQmFuY29yQ2hhbmdlcihJU21hcnRUb2tlbiBfdG9rZW4sIElCYW5jb3JGb3JtdWxhIF9mb3JtdWxhLCB1aW50MzIgX21heENoYW5nZUZlZSwgSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDMyIF9yZXNlcnZlUmF0aW8pCiAgICAgICAgU21hcnRUb2tlbkNvbnRyb2xsZXIoX3Rva2VuKQogICAgICAgIHZhbGlkQWRkcmVzcyhfZm9ybXVsYSkKICAgICAgICB2YWxpZE1heENoYW5nZUZlZShfbWF4Q2hhbmdlRmVlKQogICAgewogICAgICAgIGZvcm11bGEgPSBfZm9ybXVsYTsKICAgICAgICBtYXhDaGFuZ2VGZWUgPSBfbWF4Q2hhbmdlRmVlOwoKICAgICAgICBpZiAoYWRkcmVzcyhfcmVzZXJ2ZVRva2VuKSAhPSAweDApCiAgICAgICAgICAgIGFkZFJlc2VydmUoX3Jlc2VydmVUb2tlbiwgX3Jlc2VydmVSYXRpbywgZmFsc2UpOwogICAgfQoKICAgIC8vIHZhbGlkYXRlcyBhIHJlc2VydmUgdG9rZW4gYWRkcmVzcyAtIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgYmVsb25ncyB0byBvbmUgb2YgdGhlIHJlc2VydmUgdG9rZW5zCiAgICBtb2RpZmllciB2YWxpZFJlc2VydmUoSUVSQzIwVG9rZW4gX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKHJlc2VydmVzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSB0b2tlbiBhZGRyZXNzIC0gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBiZWxvbmdzIHRvIG9uZSBvZiB0aGUgY2hhbmdlYWJsZSB0b2tlbnMKICAgIG1vZGlmaWVyIHZhbGlkVG9rZW4oSUVSQzIwVG9rZW4gX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzID09IHRva2VuIHx8IHJlc2VydmVzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgbWF4aW11bSBjaGFuZ2UgZmVlCiAgICBtb2RpZmllciB2YWxpZE1heENoYW5nZUZlZSh1aW50MzIgX2NoYW5nZUZlZSkgewogICAgICAgIHJlcXVpcmUoX2NoYW5nZUZlZSA+PSAwICYmIF9jaGFuZ2VGZWUgPD0gTUFYX0NIQU5HRV9GRUUpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGNoYW5nZSBmZWUKICAgIG1vZGlmaWVyIHZhbGlkQ2hhbmdlRmVlKHVpbnQzMiBfY2hhbmdlRmVlKSB7CiAgICAgICAgcmVxdWlyZShfY2hhbmdlRmVlID49IDAgJiYgX2NoYW5nZUZlZSA8PSBtYXhDaGFuZ2VGZWUpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIHJlc2VydmUgcmF0aW8gcmFuZ2UKICAgIG1vZGlmaWVyIHZhbGlkUmVzZXJ2ZVJhdGlvKHVpbnQzMiBfcmF0aW8pIHsKICAgICAgICByZXF1aXJlKF9yYXRpbyA+IDAgJiYgX3JhdGlvIDw9IE1BWF9DUlIpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGEgY2hhbmdlIHBhdGggLSB2ZXJpZmllcyB0aGF0IHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaXMgb2RkIGFuZCB0aGF0IG1heGltdW0gbnVtYmVyIG9mICdob3BzJyBpcyAxMAogICAgbW9kaWZpZXIgdmFsaWRDaGFuZ2VQYXRoKElFUkMyMFRva2VuW10gX3BhdGgpIHsKICAgICAgICByZXF1aXJlKF9wYXRoLmxlbmd0aCA+IDIgJiYgX3BhdGgubGVuZ3RoIDw9ICgxICsgMiAqIDEwKSAmJiBfcGF0aC5sZW5ndGggJSAyID09IDEpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gYWxsb3dzIGV4ZWN1dGlvbiBvbmx5IHdoZW4gY2hhbmdpbmcgaXNuJ3QgZGlzYWJsZWQKICAgIG1vZGlmaWVyIGNoYW5naW5nQWxsb3dlZCB7CiAgICAgICAgYXNzZXJ0KGNoYW5naW5nRW5hYmxlZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIG51bWJlciBvZiByZXNlcnZlIHRva2VucyBkZWZpbmVkCgogICAgICAgIEByZXR1cm4gbnVtYmVyIG9mIHJlc2VydmUgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gcmVzZXJ2ZVRva2VuQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDE2IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQxNihyZXNlcnZlVG9rZW5zLmxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBudW1iZXIgb2YgY2hhbmdlYWJsZSB0b2tlbnMgc3VwcG9ydGVkIGJ5IHRoZSBjb250cmFjdAogICAgICAgIG5vdGUgdGhhdCB0aGUgbnVtYmVyIG9mIGNoYW5nZWFibGUgdG9rZW5zIGlzIHRoZSBudW1iZXIgb2YgcmVzZXJ2ZSB0b2tlbiwgcGx1cyAxICh0aGF0IHJlcHJlc2VudHMgdGhlIHNtYXJ0IHRva2VuKQoKICAgICAgICBAcmV0dXJuIG51bWJlciBvZiBjaGFuZ2VhYmxlIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZWFibGVUb2tlbkNvdW50KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNiBjb3VudCkgewogICAgICAgIHJldHVybiByZXNlcnZlVG9rZW5Db3VudCgpICsgMTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGdpdmVuIGEgY2hhbmdlYWJsZSB0b2tlbiBpbmRleCwgcmV0dXJucyB0aGUgY2hhbmdlYWJsZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEBwYXJhbSBfdG9rZW5JbmRleCAgY2hhbmdlYWJsZSB0b2tlbiBpbmRleAoKICAgICAgICBAcmV0dXJuIG51bWJlciBvZiBjaGFuZ2VhYmxlIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZWFibGVUb2tlbih1aW50MTYgX3Rva2VuSW5kZXgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzIHRva2VuQWRkcmVzcykgewogICAgICAgIGlmIChfdG9rZW5JbmRleCA9PSAwKQogICAgICAgICAgICByZXR1cm4gdG9rZW47CiAgICAgICAgcmV0dXJuIHJlc2VydmVUb2tlbnNbX3Rva2VuSW5kZXggLSAxXTsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgYWxsb3dzIHRoZSBvd25lciB0byB1cGRhdGUgdGhlIGZvcm11bGEgY29udHJhY3QgYWRkcmVzcwoKICAgICAgICBAcGFyYW0gX2Zvcm11bGEgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBmb3JtdWxhIGNvbnRyYWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2V0Rm9ybXVsYShJQmFuY29yRm9ybXVsYSBfZm9ybXVsYSkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZEFkZHJlc3MoX2Zvcm11bGEpCiAgICAgICAgbm90VGhpcyhfZm9ybXVsYSkKICAgIHsKICAgICAgICBmb3JtdWxhID0gX2Zvcm11bGE7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IGFsbG93cyB0aGUgbWFuYWdlciB0byB1cGRhdGUgdGhlIHF1aWNrIGJ1eSBwYXRoCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICBuZXcgcXVpY2sgYnV5IHBhdGgsIHNlZSBjaGFuZ2UgcGF0aCBmb3JtYXQgYWJvdmUKICAgICovCiAgICBmdW5jdGlvbiBzZXRRdWlja0J1eVBhdGgoSUVSQzIwVG9rZW5bXSBfcGF0aCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZENoYW5nZVBhdGgoX3BhdGgpCiAgICB7CiAgICAgICAgcXVpY2tCdXlQYXRoID0gX3BhdGg7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IGFsbG93cyB0aGUgbWFuYWdlciB0byBjbGVhciB0aGUgcXVpY2sgYnV5IHBhdGgKICAgICovCiAgICBmdW5jdGlvbiBjbGVhclF1aWNrQnV5UGF0aCgpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHF1aWNrQnV5UGF0aC5sZW5ndGggPSAwOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoZSBxdWljayBidXkgcGF0aCBhcnJheQoKICAgICAgICBAcmV0dXJuIHF1aWNrIGJ1eSBwYXRoIGxlbmd0aAogICAgKi8KICAgIGZ1bmN0aW9uIGdldFF1aWNrQnV5UGF0aExlbmd0aCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGxlbmd0aCkgewogICAgICAgIHJldHVybiBxdWlja0J1eVBhdGgubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0cnVlIGlmIGV0aGVyIHRva2VuIGV4aXN0cyBpbiB0aGUgcXVpY2sgYnV5IHBhdGgsIGZhbHNlIGlmIG5vdAogICAgICAgIG5vdGUgdGhhdCB0aGVyZSBzaG91bGQgYWx3YXlzIGJlIG9uZSBpbiB0aGUgcXVpY2sgYnV5IHBhdGgsIGlmIG9uZSBpcyBzZXQKCiAgICAgICAgQHJldHVybiB0cnVlIGlmIGV0aGVyIHRva2VuIGV4aXN0cywgZmFsc2UgaWYgbm90CiAgICAqLwogICAgZnVuY3Rpb24gaGFzUXVpY2tCdXlFdGhlclRva2VuKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gcXVpY2tCdXlQYXRoLmxlbmd0aCA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSBhZGRyZXNzIG9mIHRoZSBldGhlciB0b2tlbiB1c2VkIGJ5IHRoZSBxdWljayBidXkgZnVuY3Rpb25hbGl0eQogICAgICAgIG5vdGUgdGhhdCBpdCBzaG91bGQgYWx3YXlzIGJlIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBxdWljayBidXkgcGF0aCwgaWYgb25lIGlzIHNldAoKICAgICAgICBAcmV0dXJuIGV0aGVyIHRva2VuIGFkZHJlc3MKICAgICovCiAgICBmdW5jdGlvbiBnZXRRdWlja0J1eUV0aGVyVG9rZW4oKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoSUV0aGVyVG9rZW4gZXRoZXJUb2tlbikgewogICAgICAgIGFzc2VydChxdWlja0J1eVBhdGgubGVuZ3RoID4gMCk7CiAgICAgICAgcmV0dXJuIElFdGhlclRva2VuKHF1aWNrQnV5UGF0aFswXSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcyB0aGUgZW50aXJlIGNoYW5nZSBmdW5jdGlvbmFsaXR5CiAgICAgICAgdGhpcyBpcyBhIHNhZmV0eSBtZWNoYW5pc20gaW4gY2FzZSBvZiBhIGVtZXJnZW5jeQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgbWFuYWdlcgoKICAgICAgICBAcGFyYW0gX2Rpc2FibGUgdHJ1ZSB0byBkaXNhYmxlIGNoYW5naW5nLCBmYWxzZSB0byByZS1lbmFibGUgaXQKICAgICovCiAgICBmdW5jdGlvbiBkaXNhYmxlQ2hhbmdpbmcoYm9vbCBfZGlzYWJsZSkgcHVibGljIG1hbmFnZXJPbmx5IHsKICAgICAgICBjaGFuZ2luZ0VuYWJsZWQgPSAhX2Rpc2FibGU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1cGRhdGVzIHRoZSBjdXJyZW50IGNoYW5nZSBmZWUKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG1hbmFnZXIKCiAgICAgICAgQHBhcmFtIF9jaGFuZ2VGZWUgbmV3IGNoYW5nZSBmZWUsIHJlcHJlc2VudGVkIGluIHBwbQogICAgKi8KICAgIGZ1bmN0aW9uIHNldENoYW5nZUZlZSh1aW50MzIgX2NoYW5nZUZlZSkKICAgICAgICBwdWJsaWMKICAgICAgICBtYW5hZ2VyT25seQogICAgICAgIHZhbGlkQ2hhbmdlRmVlKF9jaGFuZ2VGZWUpCiAgICB7CiAgICAgICAgY2hhbmdlRmVlID0gX2NoYW5nZUZlZTsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgY2hhbmdlIGZlZSBhbW91bnQgZm9yIGEgZ2l2ZW4gcmV0dXJuIGFtb3VudAoKICAgICAgICBAcmV0dXJuIGNoYW5nZSBmZWUgYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0Q2hhbmdlRmVlQW1vdW50KHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgZmVlQW1vdW50KSB7CiAgICAgICAgcmV0dXJuIHNhZmVNdWwoX2Ftb3VudCwgY2hhbmdlRmVlKSAvIE1BWF9DSEFOR0VfRkVFOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZGVmaW5lcyBhIG5ldyByZXNlcnZlIGZvciB0aGUgdG9rZW4KICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIHdoaWxlIHRoZSBjaGFuZ2VyIGlzIGluYWN0aXZlCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICAgICAgICAgICAgICAgICBhZGRyZXNzIG9mIHRoZSByZXNlcnZlIHRva2VuCiAgICAgICAgQHBhcmFtIF9yYXRpbyAgICAgICAgICAgICAgICAgIGNvbnN0YW50IHJlc2VydmUgcmF0aW8sIHJlcHJlc2VudGVkIGluIHBwbSwgMS0xMDAwMDAwCiAgICAgICAgQHBhcmFtIF9lbmFibGVWaXJ0dWFsQmFsYW5jZSAgIHRydWUgdG8gZW5hYmxlIHZpcnR1YWwgYmFsYW5jZSBmb3IgdGhlIHJlc2VydmUsIGZhbHNlIHRvIGRpc2FibGUgaXQKICAgICovCiAgICBmdW5jdGlvbiBhZGRSZXNlcnZlKElFUkMyMFRva2VuIF90b2tlbiwgdWludDMyIF9yYXRpbywgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgaW5hY3RpdmUKICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgICAgIG5vdFRoaXMoX3Rva2VuKQogICAgICAgIHZhbGlkUmVzZXJ2ZVJhdGlvKF9yYXRpbykKICAgIHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSB0b2tlbiAmJiAhcmVzZXJ2ZXNbX3Rva2VuXS5pc1NldCAmJiB0b3RhbFJlc2VydmVSYXRpbyArIF9yYXRpbyA8PSBNQVhfQ1JSKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS52aXJ0dWFsQmFsYW5jZSA9IDA7CiAgICAgICAgcmVzZXJ2ZXNbX3Rva2VuXS5yYXRpbyA9IF9yYXRpbzsKICAgICAgICByZXNlcnZlc1tfdG9rZW5dLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkID0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlOwogICAgICAgIHJlc2VydmVzW190b2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSB0cnVlOwogICAgICAgIHJlc2VydmVzW190b2tlbl0uaXNTZXQgPSB0cnVlOwogICAgICAgIHJlc2VydmVUb2tlbnMucHVzaChfdG9rZW4pOwogICAgICAgIHRvdGFsUmVzZXJ2ZVJhdGlvICs9IF9yYXRpbzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVwZGF0ZXMgb25lIG9mIHRoZSB0b2tlbiByZXNlcnZlcwogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICAgICAgICAgIGFkZHJlc3Mgb2YgdGhlIHJlc2VydmUgdG9rZW4KICAgICAgICBAcGFyYW0gX3JhdGlvICAgICAgICAgICAgICAgICAgY29uc3RhbnQgcmVzZXJ2ZSByYXRpbywgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgcmVzZXJ2ZSwgZmFsc2UgdG8gZGlzYWJsZSBpdAogICAgICAgIEBwYXJhbSBfdmlydHVhbEJhbGFuY2UgICAgICAgICBuZXcgcmVzZXJ2ZSdzIHZpcnR1YWwgYmFsYW5jZQogICAgKi8KICAgIGZ1bmN0aW9uIHVwZGF0ZVJlc2VydmUoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDMyIF9yYXRpbywgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UsIHVpbnQyNTYgX3ZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIHZhbGlkUmVzZXJ2ZVJhdGlvKF9yYXRpbykKICAgIHsKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIHJlcXVpcmUodG90YWxSZXNlcnZlUmF0aW8gLSByZXNlcnZlLnJhdGlvICsgX3JhdGlvIDw9IE1BWF9DUlIpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICB0b3RhbFJlc2VydmVSYXRpbyA9IHRvdGFsUmVzZXJ2ZVJhdGlvIC0gcmVzZXJ2ZS5yYXRpbyArIF9yYXRpbzsKICAgICAgICByZXNlcnZlLnJhdGlvID0gX3JhdGlvOwogICAgICAgIHJlc2VydmUuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPSBfZW5hYmxlVmlydHVhbEJhbGFuY2U7CiAgICAgICAgcmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSA9IF92aXJ0dWFsQmFsYW5jZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGRpc2FibGVzIHB1cmNoYXNpbmcgd2l0aCB0aGUgZ2l2ZW4gcmVzZXJ2ZSB0b2tlbiBpbiBjYXNlIHRoZSByZXNlcnZlIHRva2VuIGdvdCBjb21wcm9taXNlZAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKICAgICAgICBub3RlIHRoYXQgc2VsbGluZyBpcyBzdGlsbCBlbmFibGVkIHJlZ2FyZGxlc3Mgb2YgdGhpcyBmbGFnIGFuZCBpdCBjYW5ub3QgYmUgZGlzYWJsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZVRva2VuICAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfZGlzYWJsZSAgICAgICAgIHRydWUgdG8gZGlzYWJsZSB0aGUgdG9rZW4sIGZhbHNlIHRvIHJlLWVuYWJsZSBpdAogICAgKi8KICAgIGZ1bmN0aW9uIGRpc2FibGVSZXNlcnZlUHVyY2hhc2VzKElFUkMyMFRva2VuIF9yZXNlcnZlVG9rZW4sIGJvb2wgX2Rpc2FibGUpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRSZXNlcnZlKF9yZXNlcnZlVG9rZW4pCiAgICB7CiAgICAgICAgcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSAhX2Rpc2FibGU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiByZXR1cm5zIHRoZSByZXNlcnZlJ3MgdmlydHVhbCBiYWxhbmNlIGlmIG9uZSBpcyBkZWZpbmVkLCBvdGhlcndpc2UgcmV0dXJucyB0aGUgYWN0dWFsIGJhbGFuY2UKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICAgcmVzZXJ2ZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEByZXR1cm4gcmVzZXJ2ZSBiYWxhbmNlCiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmVzZXJ2ZUJhbGFuY2UoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkKICAgIHsKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIHJldHVybiByZXNlcnZlLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkID8gcmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSA6IF9yZXNlcnZlVG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBjaGFuZ2luZyBhIHNwZWNpZmljIGFtb3VudCBvZiBfZnJvbVRva2VuIHRvIF90b1Rva2VuCgogICAgICAgIEBwYXJhbSBfZnJvbVRva2VuICBFUkMyMCB0b2tlbiB0byBjaGFuZ2UgZnJvbQogICAgICAgIEBwYXJhbSBfdG9Ub2tlbiAgICBFUkMyMCB0b2tlbiB0byBjaGFuZ2UgdG8KICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgYW1vdW50IHRvIGNoYW5nZSwgaW4gZnJvbVRva2VuCgogICAgICAgIEByZXR1cm4gZXhwZWN0ZWQgY2hhbmdlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRSZXR1cm4oSUVSQzIwVG9rZW4gX2Zyb21Ub2tlbiwgSUVSQzIwVG9rZW4gX3RvVG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfZnJvbVRva2VuICE9IF90b1Rva2VuKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgLy8gY2hhbmdlIGJldHdlZW4gdGhlIHRva2VuIGFuZCBvbmUgb2YgaXRzIHJlc2VydmVzCiAgICAgICAgaWYgKF90b1Rva2VuID09IHRva2VuKQogICAgICAgICAgICByZXR1cm4gZ2V0UHVyY2hhc2VSZXR1cm4oX2Zyb21Ub2tlbiwgX2Ftb3VudCk7CiAgICAgICAgZWxzZSBpZiAoX2Zyb21Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIGdldFNhbGVSZXR1cm4oX3RvVG9rZW4sIF9hbW91bnQpOwoKICAgICAgICAvLyBjaGFuZ2UgYmV0d2VlbiAyIHJlc2VydmVzCiAgICAgICAgdWludDI1NiBwdXJjaGFzZVJldHVybkFtb3VudCA9IGdldFB1cmNoYXNlUmV0dXJuKF9mcm9tVG9rZW4sIF9hbW91bnQpOwogICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF90b1Rva2VuLCBwdXJjaGFzZVJldHVybkFtb3VudCwgc2FmZUFkZCh0b2tlbi50b3RhbFN1cHBseSgpLCBwdXJjaGFzZVJldHVybkFtb3VudCkpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBidXlpbmcgdGhlIHRva2VuIGZvciBhIHJlc2VydmUgdG9rZW4KCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgIGFtb3VudCB0byBkZXBvc2l0IChpbiB0aGUgcmVzZXJ2ZSB0b2tlbikKCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBwdXJjaGFzZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UHVyY2hhc2VSZXR1cm4oSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDI1NiBfZGVwb3NpdEFtb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIGFjdGl2ZQogICAgICAgIHZhbGlkUmVzZXJ2ZShfcmVzZXJ2ZVRva2VuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIFJlc2VydmUgc3RvcmFnZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07CiAgICAgICAgcmVxdWlyZShyZXNlcnZlLmlzUHVyY2hhc2VFbmFibGVkKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgdWludDI1NiB0b2tlblN1cHBseSA9IHRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgdWludDI1NiByZXNlcnZlQmFsYW5jZSA9IGdldFJlc2VydmVCYWxhbmNlKF9yZXNlcnZlVG9rZW4pOwogICAgICAgIGFtb3VudCA9IGZvcm11bGEuY2FsY3VsYXRlUHVyY2hhc2VSZXR1cm4odG9rZW5TdXBwbHksIHJlc2VydmVCYWxhbmNlLCByZXNlcnZlLnJhdGlvLCBfZGVwb3NpdEFtb3VudCk7CgogICAgICAgIC8vIGRlZHVjdCB0aGUgZmVlIGZyb20gdGhlIHJldHVybiBhbW91bnQKICAgICAgICB1aW50MjU2IGZlZUFtb3VudCA9IGdldENoYW5nZUZlZUFtb3VudChhbW91bnQpOwogICAgICAgIHJldHVybiBzYWZlU3ViKGFtb3VudCwgZmVlQW1vdW50KTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGV4cGVjdGVkIHJldHVybiBmb3Igc2VsbGluZyB0aGUgdG9rZW4gZm9yIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3NlbGxBbW91bnQgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCgogICAgICAgIEByZXR1cm4gZXhwZWN0ZWQgc2FsZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0U2FsZVJldHVybihJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MjU2IF9zZWxsQW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBhbW91bnQpIHsKICAgICAgICByZXR1cm4gZ2V0U2FsZVJldHVybihfcmVzZXJ2ZVRva2VuLCBfc2VsbEFtb3VudCwgdG9rZW4udG90YWxTdXBwbHkoKSk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBjaGFuZ2VzIGEgc3BlY2lmaWMgYW1vdW50IG9mIF9mcm9tVG9rZW4gdG8gX3RvVG9rZW4KCiAgICAgICAgQHBhcmFtIF9mcm9tVG9rZW4gIEVSQzIwIHRva2VuIHRvIGNoYW5nZSBmcm9tCiAgICAgICAgQHBhcmFtIF90b1Rva2VuICAgIEVSQzIwIHRva2VuIHRvIGNoYW5nZSB0bwogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gY2hhbmdlLCBpbiBmcm9tVG9rZW4KICAgICAgICBAcGFyYW0gX21pblJldHVybiAgaWYgdGhlIGNoYW5nZSByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiBjaGFuZ2UgcmV0dXJuIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZShJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2IGFtb3VudCkgewogICAgICAgIHJlcXVpcmUoX2Zyb21Ub2tlbiAhPSBfdG9Ub2tlbik7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIC8vIGNoYW5nZSBiZXR3ZWVuIHRoZSB0b2tlbiBhbmQgb25lIG9mIGl0cyByZXNlcnZlcwogICAgICAgIGlmIChfdG9Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIGJ1eShfZnJvbVRva2VuLCBfYW1vdW50LCBfbWluUmV0dXJuKTsKICAgICAgICBlbHNlIGlmIChfZnJvbVRva2VuID09IHRva2VuKQogICAgICAgICAgICByZXR1cm4gc2VsbChfdG9Ub2tlbiwgX2Ftb3VudCwgX21pblJldHVybik7CgogICAgICAgIC8vIGNoYW5nZSBiZXR3ZWVuIDIgcmVzZXJ2ZXMKICAgICAgICB1aW50MjU2IHB1cmNoYXNlQW1vdW50ID0gYnV5KF9mcm9tVG9rZW4sIF9hbW91bnQsIDEpOwogICAgICAgIHJldHVybiBzZWxsKF90b1Rva2VuLCBwdXJjaGFzZUFtb3VudCwgX21pblJldHVybik7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBidXlzIHRoZSB0b2tlbiBieSBkZXBvc2l0aW5nIG9uZSBvZiBpdHMgcmVzZXJ2ZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9yZXNlcnZlVG9rZW4gICByZXNlcnZlIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX2RlcG9zaXRBbW91bnQgIGFtb3VudCB0byBkZXBvc2l0IChpbiB0aGUgcmVzZXJ2ZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgICAgIGlmIHRoZSBjaGFuZ2UgcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gYnV5IHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBidXkoSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDI1NiBfZGVwb3NpdEFtb3VudCwgdWludDI1NiBfbWluUmV0dXJuKQogICAgICAgIHB1YmxpYwogICAgICAgIGNoYW5naW5nQWxsb3dlZAogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfbWluUmV0dXJuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYgYW1vdW50KQogICAgewogICAgICAgIGFtb3VudCA9IGdldFB1cmNoYXNlUmV0dXJuKF9yZXNlcnZlVG9rZW4sIF9kZXBvc2l0QW1vdW50KTsKICAgICAgICBhc3NlcnQoYW1vdW50ICE9IDAgJiYgYW1vdW50ID49IF9taW5SZXR1cm4pOyAvLyBlbnN1cmUgdGhlIHRyYWRlIGdpdmVzIHNvbWV0aGluZyBpbiByZXR1cm4gYW5kIG1lZXRzIHRoZSBtaW5pbXVtIHJlcXVlc3RlZCBhbW91bnQKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIFJlc2VydmUgc3RvcmFnZSByZXNlcnZlID0gcmVzZXJ2ZXNbX3Jlc2VydmVUb2tlbl07CiAgICAgICAgaWYgKHJlc2VydmUuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQpCiAgICAgICAgICAgIHJlc2VydmUudmlydHVhbEJhbGFuY2UgPSBzYWZlQWRkKHJlc2VydmUudmlydHVhbEJhbGFuY2UsIF9kZXBvc2l0QW1vdW50KTsKCiAgICAgICAgYXNzZXJ0KF9yZXNlcnZlVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF9kZXBvc2l0QW1vdW50KSk7IC8vIHRyYW5zZmVyIF9kZXBvc2l0QW1vdW50IGZ1bmRzIGZyb20gdGhlIGNhbGxlciBpbiB0aGUgcmVzZXJ2ZSB0b2tlbgogICAgICAgIHRva2VuLmlzc3VlKG1zZy5zZW5kZXIsIGFtb3VudCk7IC8vIGlzc3VlIG5ldyBmdW5kcyB0byB0aGUgY2FsbGVyIGluIHRoZSBzbWFydCB0b2tlbgoKICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIG5ldyBwcmljZSB1c2luZyB0aGUgc2ltcGxlIHByaWNlIGZvcm11bGEKICAgICAgICAvLyBwcmljZSA9IHJlc2VydmUgYmFsYW5jZSAvIChzdXBwbHkgKiBDUlIpCiAgICAgICAgLy8gQ1JSIGlzIHJlcHJlc2VudGVkIGluIHBwbSwgc28gbXVsdGlwbHlpbmcgYnkgMTAwMDAwMAogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZUFtb3VudCA9IHNhZmVNdWwoZ2V0UmVzZXJ2ZUJhbGFuY2UoX3Jlc2VydmVUb2tlbiksIE1BWF9DUlIpOwogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBzYWZlTXVsKHRva2VuLnRvdGFsU3VwcGx5KCksIHJlc2VydmUucmF0aW8pOwogICAgICAgIENoYW5nZShfcmVzZXJ2ZVRva2VuLCB0b2tlbiwgbXNnLnNlbmRlciwgX2RlcG9zaXRBbW91bnQsIGFtb3VudCwgcmVzZXJ2ZUFtb3VudCwgdG9rZW5BbW91bnQpOwogICAgICAgIHJldHVybiBhbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBzZWxscyB0aGUgdG9rZW4gYnkgd2l0aGRyYXdpbmcgZnJvbSBvbmUgb2YgaXRzIHJlc2VydmUgdG9rZW5zCgogICAgICAgIEBwYXJhbSBfcmVzZXJ2ZVRva2VuICAgcmVzZXJ2ZSB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9zZWxsQW1vdW50ICAgICBhbW91bnQgdG8gc2VsbCAoaW4gdGhlIHNtYXJ0IHRva2VuKQogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICAgICAgaWYgdGhlIGNoYW5nZSByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gc2VsbCByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gc2VsbChJRVJDMjBUb2tlbiBfcmVzZXJ2ZVRva2VuLCB1aW50MjU2IF9zZWxsQW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pCiAgICAgICAgcHVibGljCiAgICAgICAgY2hhbmdpbmdBbGxvd2VkCiAgICAgICAgZ3JlYXRlclRoYW5aZXJvKF9taW5SZXR1cm4pCiAgICAgICAgcmV0dXJucyAodWludDI1NiBhbW91bnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShfc2VsbEFtb3VudCA8PSB0b2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcikpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICBhbW91bnQgPSBnZXRTYWxlUmV0dXJuKF9yZXNlcnZlVG9rZW4sIF9zZWxsQW1vdW50KTsKICAgICAgICBhc3NlcnQoYW1vdW50ICE9IDAgJiYgYW1vdW50ID49IF9taW5SZXR1cm4pOyAvLyBlbnN1cmUgdGhlIHRyYWRlIGdpdmVzIHNvbWV0aGluZyBpbiByZXR1cm4gYW5kIG1lZXRzIHRoZSBtaW5pbXVtIHJlcXVlc3RlZCBhbW91bnQKCiAgICAgICAgdWludDI1NiB0b2tlblN1cHBseSA9IHRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgdWludDI1NiByZXNlcnZlQmFsYW5jZSA9IGdldFJlc2VydmVCYWxhbmNlKF9yZXNlcnZlVG9rZW4pOwogICAgICAgIC8vIGVuc3VyZSB0aGF0IHRoZSB0cmFkZSB3aWxsIG9ubHkgZGVwbGV0ZSB0aGUgcmVzZXJ2ZSBpZiB0aGUgdG90YWwgc3VwcGx5IGlzIGRlcGxldGVkIGFzIHdlbGwKICAgICAgICBhc3NlcnQoYW1vdW50IDwgcmVzZXJ2ZUJhbGFuY2UgfHwgKGFtb3VudCA9PSByZXNlcnZlQmFsYW5jZSAmJiBfc2VsbEFtb3VudCA9PSB0b2tlblN1cHBseSkpOwoKICAgICAgICAvLyB1cGRhdGUgdmlydHVhbCBiYWxhbmNlIGlmIHJlbGV2YW50CiAgICAgICAgUmVzZXJ2ZSBzdG9yYWdlIHJlc2VydmUgPSByZXNlcnZlc1tfcmVzZXJ2ZVRva2VuXTsKICAgICAgICBpZiAocmVzZXJ2ZS5pc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZCkKICAgICAgICAgICAgcmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSA9IHNhZmVTdWIocmVzZXJ2ZS52aXJ0dWFsQmFsYW5jZSwgYW1vdW50KTsKCiAgICAgICAgdG9rZW4uZGVzdHJveShtc2cuc2VuZGVyLCBfc2VsbEFtb3VudCk7IC8vIGRlc3Ryb3kgX3NlbGxBbW91bnQgZnJvbSB0aGUgY2FsbGVyJ3MgYmFsYW5jZSBpbiB0aGUgc21hcnQgdG9rZW4KICAgICAgICBhc3NlcnQoX3Jlc2VydmVUb2tlbi50cmFuc2Zlcihtc2cuc2VuZGVyLCBhbW91bnQpKTsgLy8gdHJhbnNmZXIgZnVuZHMgdG8gdGhlIGNhbGxlciBpbiB0aGUgcmVzZXJ2ZSB0b2tlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBub3RlIHRoYXQgaXQgbWlnaHQgZmFpbCBpZiB0aGUgYWN0dWFsIHJlc2VydmUgYmFsYW5jZSBpcyBzbWFsbGVyIHRoYW4gdGhlIHZpcnR1YWwgYmFsYW5jZQogICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgbmV3IHByaWNlIHVzaW5nIHRoZSBzaW1wbGUgcHJpY2UgZm9ybXVsYQogICAgICAgIC8vIHByaWNlID0gcmVzZXJ2ZSBiYWxhbmNlIC8gKHN1cHBseSAqIENSUikKICAgICAgICAvLyBDUlIgaXMgcmVwcmVzZW50ZWQgaW4gcHBtLCBzbyBtdWx0aXBseWluZyBieSAxMDAwMDAwCiAgICAgICAgdWludDI1NiByZXNlcnZlQW1vdW50ID0gc2FmZU11bChnZXRSZXNlcnZlQmFsYW5jZShfcmVzZXJ2ZVRva2VuKSwgTUFYX0NSUik7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudCA9IHNhZmVNdWwodG9rZW4udG90YWxTdXBwbHkoKSwgcmVzZXJ2ZS5yYXRpbyk7CiAgICAgICAgQ2hhbmdlKHRva2VuLCBfcmVzZXJ2ZVRva2VuLCBtc2cuc2VuZGVyLCBfc2VsbEFtb3VudCwgYW1vdW50LCB0b2tlbkFtb3VudCwgcmVzZXJ2ZUFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGNoYW5nZXMgdGhlIHRva2VuIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsgYnkgZm9sbG93aW5nIGEgcHJlZGVmaW5lZCBjaGFuZ2UgcGF0aAogICAgICAgIG5vdGUgdGhhdCB3aGVuIGNoYW5naW5nIGZyb20gYW4gRVJDMjAgdG9rZW4gKGFzIG9wcG9zZWQgdG8gYSBzbWFydCB0b2tlbiksIGFsbG93YW5jZSBtdXN0IGJlIHNldCBiZWZvcmVoYW5kCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICAgICAgY2hhbmdlIHBhdGgsIHNlZSBjaGFuZ2UgcGF0aCBmb3JtYXQgYWJvdmUKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgIGFtb3VudCB0byBjaGFuZ2UgZnJvbSAoaW4gdGhlIGluaXRpYWwgc291cmNlIHRva2VuKQogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICAgaWYgdGhlIGNoYW5nZSByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KCiAgICAgICAgQHJldHVybiB0b2tlbnMgaXNzdWVkIGluIHJldHVybgogICAgKi8KICAgIGZ1bmN0aW9uIHF1aWNrQ2hhbmdlKElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkQ2hhbmdlUGF0aChfcGF0aCkKICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICAvLyB3ZSBuZWVkIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyIHRvIHRoZSBsb2NhbCBjb250cmFjdCBiZWZvcmUgd2UKICAgICAgICAvLyBmb2xsb3cgdGhlIGNoYW5nZSBwYXRoLCB0byBhbGxvdyBpdCB0byBleGVjdXRlIHRoZSBjaGFuZ2Ugb24gYmVoYWxmIG9mIHRoZSBjYWxsZXIKICAgICAgICBJRVJDMjBUb2tlbiBmcm9tVG9rZW4gPSBfcGF0aFswXTsKICAgICAgICBjbGFpbVRva2Vucyhmcm9tVG9rZW4sIG1zZy5zZW5kZXIsIF9hbW91bnQpOwoKICAgICAgICBJU21hcnRUb2tlbiBzbWFydFRva2VuOwogICAgICAgIElFUkMyMFRva2VuIHRvVG9rZW47CiAgICAgICAgQmFuY29yQ2hhbmdlciBjaGFuZ2VyOwogICAgICAgIHVpbnQyNTYgcGF0aExlbmd0aCA9IF9wYXRoLmxlbmd0aDsKCiAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBjaGFuZ2UgcGF0aAogICAgICAgIGZvciAodWludDI1NiBpID0gMTsgaSA8IHBhdGhMZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICBzbWFydFRva2VuID0gSVNtYXJ0VG9rZW4oX3BhdGhbaV0pOwogICAgICAgICAgICB0b1Rva2VuID0gX3BhdGhbaSArIDFdOwogICAgICAgICAgICBjaGFuZ2VyID0gQmFuY29yQ2hhbmdlcihzbWFydFRva2VuLm93bmVyKCkpOwoKICAgICAgICAgICAgLy8gaWYgdGhlIHNtYXJ0IHRva2VuIGlzbid0IHRoZSBzb3VyY2UgKGZyb20gdG9rZW4pLCB0aGUgY2hhbmdlciBkb2Vzbid0IGhhdmUgY29udHJvbCBvdmVyIGl0IGFuZCB0aHVzIHdlIG5lZWQgdG8gYXBwcm92ZSB0aGUgcmVxdWVzdAogICAgICAgICAgICBpZiAoc21hcnRUb2tlbiAhPSBmcm9tVG9rZW4pCiAgICAgICAgICAgICAgICBlbnN1cmVBbGxvd2FuY2UoZnJvbVRva2VuLCBjaGFuZ2VyLCBfYW1vdW50KTsKCiAgICAgICAgICAgIC8vIG1ha2UgdGhlIGNoYW5nZSAtIGlmIGl0J3MgdGhlIGxhc3Qgb25lLCBhbHNvIHByb3ZpZGUgdGhlIG1pbmltdW0gcmV0dXJuIHZhbHVlCiAgICAgICAgICAgIF9hbW91bnQgPSBjaGFuZ2VyLmNoYW5nZShmcm9tVG9rZW4sIHRvVG9rZW4sIF9hbW91bnQsIGkgPT0gcGF0aExlbmd0aCAtIDIgPyBfbWluUmV0dXJuIDogMSk7CiAgICAgICAgICAgIGZyb21Ub2tlbiA9IHRvVG9rZW47CiAgICAgICAgfQoKICAgICAgICAvLyBmaW5pc2hlZCB0aGUgY2hhbmdlLCB0cmFuc2ZlciB0aGUgZnVuZHMgYmFjayB0byB0aGUgY2FsbGVyCiAgICAgICAgLy8gaWYgdGhlIGxhc3QgY2hhbmdlIHJlc3VsdGVkIGluIGV0aGVyIHRva2Vucywgd2l0aGRyYXcgdGhlbSBhbmQgc2VuZCB0aGVtIGFzIEVUSCB0byB0aGUgY2FsbGVyCiAgICAgICAgaWYgKGNoYW5nZXIuaGFzUXVpY2tCdXlFdGhlclRva2VuKCkgJiYgY2hhbmdlci5nZXRRdWlja0J1eUV0aGVyVG9rZW4oKSA9PSB0b1Rva2VuKSB7CiAgICAgICAgICAgIElFdGhlclRva2VuIGV0aGVyVG9rZW4gPSBJRXRoZXJUb2tlbih0b1Rva2VuKTsKICAgICAgICAgICAgZXRoZXJUb2tlbi53aXRoZHJhd1RvKG1zZy5zZW5kZXIsIF9hbW91bnQpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gbm90IEVUSCwgdHJhbnNmZXIgdGhlIHRva2VucyB0byB0aGUgY2FsbGVyCiAgICAgICAgICAgIGFzc2VydCh0b1Rva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIF9hbW91bnQpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfYW1vdW50OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYnV5cyB0aGUgc21hcnQgdG9rZW4gd2l0aCBFVEggaWYgdGhlIHJldHVybiBhbW91bnQgbWVldHMgdGhlIG1pbmltdW0gcmVxdWVzdGVkCiAgICAgICAgbm90ZSB0aGF0IHRoaXMgZnVuY3Rpb24gY2FuIGV2ZW50dWFsbHkgYmUgbW92ZWQgaW50byBhIHNlcGFyYXRlIGNvbnRyYWN0CgogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICBpZiB0aGUgY2hhbmdlIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gcXVpY2tCdXkodWludDI1NiBfbWluUmV0dXJuKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50MjU2IGFtb3VudCkgewogICAgICAgIC8vIGVuc3VyZSB0aGF0IHRoZSBxdWljayBidXkgcGF0aCB3YXMgc2V0CiAgICAgICAgYXNzZXJ0KHF1aWNrQnV5UGF0aC5sZW5ndGggPiAwKTsKICAgICAgICAvLyB3ZSBhc3N1bWUgdGhhdCB0aGUgaW5pdGlhbCBzb3VyY2UgaW4gdGhlIHF1aWNrIGJ1eSBwYXRoIGlzIGFsd2F5cyBhbiBldGhlciB0b2tlbgogICAgICAgIElFdGhlclRva2VuIGV0aGVyVG9rZW4gPSBJRXRoZXJUb2tlbihxdWlja0J1eVBhdGhbMF0pOwogICAgICAgIC8vIGRlcG9zaXQgRVRIIGluIHRoZSBldGhlciB0b2tlbgogICAgICAgIGV0aGVyVG9rZW4uZGVwb3NpdC52YWx1ZShtc2cudmFsdWUpKCk7CiAgICAgICAgLy8gZ2V0IHRoZSBpbml0aWFsIGNoYW5nZXIgaW4gdGhlIHBhdGgKICAgICAgICBJU21hcnRUb2tlbiBzbWFydFRva2VuID0gSVNtYXJ0VG9rZW4ocXVpY2tCdXlQYXRoWzFdKTsKICAgICAgICBCYW5jb3JDaGFuZ2VyIGNoYW5nZXIgPSBCYW5jb3JDaGFuZ2VyKHNtYXJ0VG9rZW4ub3duZXIoKSk7CiAgICAgICAgLy8gYXBwcm92ZSBhbGxvd2FuY2UgZm9yIHRoZSBjaGFuZ2VyIGluIHRoZSBldGhlciB0b2tlbgogICAgICAgIGVuc3VyZUFsbG93YW5jZShldGhlclRva2VuLCBjaGFuZ2VyLCBtc2cudmFsdWUpOwogICAgICAgIC8vIGV4ZWN1dGUgdGhlIGNoYW5nZQogICAgICAgIHVpbnQyNTYgcmV0dXJuQW1vdW50ID0gY2hhbmdlci5xdWlja0NoYW5nZShxdWlja0J1eVBhdGgsIG1zZy52YWx1ZSwgX21pblJldHVybik7CiAgICAgICAgLy8gdHJhbnNmZXIgdGhlIHRva2VucyB0byB0aGUgY2FsbGVyCiAgICAgICAgYXNzZXJ0KHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHJldHVybkFtb3VudCkpOwogICAgICAgIHJldHVybiByZXR1cm5BbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1dGlsaXR5LCByZXR1cm5zIHRoZSBleHBlY3RlZCByZXR1cm4gZm9yIHNlbGxpbmcgdGhlIHRva2VuIGZvciBvbmUgb2YgaXRzIHJlc2VydmUgdG9rZW5zLCBnaXZlbiBhIHRvdGFsIHN1cHBseSBvdmVycmlkZQoKICAgICAgICBAcGFyYW0gX3Jlc2VydmVUb2tlbiAgIHJlc2VydmUgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfc2VsbEFtb3VudCAgICAgYW1vdW50IHRvIHNlbGwgKGluIHRoZSBzbWFydCB0b2tlbikKICAgICAgICBAcGFyYW0gX3RvdGFsU3VwcGx5ICAgIHRvdGFsIHRva2VuIHN1cHBseSwgb3ZlcnJpZGVzIHRoZSBhY3R1YWwgdG9rZW4gdG90YWwgc3VwcGx5IHdoZW4gY2FsY3VsYXRpbmcgdGhlIHJldHVybgoKICAgICAgICBAcmV0dXJuIHNhbGUgcmV0dXJuIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGdldFNhbGVSZXR1cm4oSUVSQzIwVG9rZW4gX3Jlc2VydmVUb2tlbiwgdWludDI1NiBfc2VsbEFtb3VudCwgdWludDI1NiBfdG90YWxTdXBwbHkpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIGNvbnN0YW50CiAgICAgICAgYWN0aXZlCiAgICAgICAgdmFsaWRSZXNlcnZlKF9yZXNlcnZlVG9rZW4pCiAgICAgICAgZ3JlYXRlclRoYW5aZXJvKF90b3RhbFN1cHBseSkKICAgICAgICByZXR1cm5zICh1aW50MjU2IGFtb3VudCkKICAgIHsKICAgICAgICBSZXNlcnZlIHN0b3JhZ2UgcmVzZXJ2ZSA9IHJlc2VydmVzW19yZXNlcnZlVG9rZW5dOwogICAgICAgIHVpbnQyNTYgcmVzZXJ2ZUJhbGFuY2UgPSBnZXRSZXNlcnZlQmFsYW5jZShfcmVzZXJ2ZVRva2VuKTsKICAgICAgICBhbW91bnQgPSBmb3JtdWxhLmNhbGN1bGF0ZVNhbGVSZXR1cm4oX3RvdGFsU3VwcGx5LCByZXNlcnZlQmFsYW5jZSwgcmVzZXJ2ZS5yYXRpbywgX3NlbGxBbW91bnQpOwoKICAgICAgICAvLyBkZWR1Y3QgdGhlIGZlZSBmcm9tIHRoZSByZXR1cm4gYW1vdW50CiAgICAgICAgdWludDI1NiBmZWVBbW91bnQgPSBnZXRDaGFuZ2VGZWVBbW91bnQoYW1vdW50KTsKICAgICAgICByZXR1cm4gc2FmZVN1YihhbW91bnQsIGZlZUFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiB1dGlsaXR5LCBjaGVja3Mgd2hldGhlciBhbGxvd2FuY2UgZm9yIHRoZSBnaXZlbiBzcGVuZGVyIGV4aXN0cyBhbmQgYXBwcm92ZXMgb25lIGlmIGl0IGRvZXNuJ3QKCiAgICAgICAgQHBhcmFtIF90b2tlbiAgIHRva2VuIHRvIGNoZWNrIHRoZSBhbGxvd2FuY2UgaW4KICAgICAgICBAcGFyYW0gX3NwZW5kZXIgYXBwcm92ZWQgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdmFsdWUgICBhbGxvd2FuY2UgYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZW5zdXJlQWxsb3dhbmNlKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHByaXZhdGUgewogICAgICAgIC8vIGNoZWNrIGlmIGFsbG93YW5jZSBmb3IgdGhlIGdpdmVuIGFtb3VudCBhbHJlYWR5IGV4aXN0cwogICAgICAgIGlmIChfdG9rZW4uYWxsb3dhbmNlKHRoaXMsIF9zcGVuZGVyKSA+PSBfdmFsdWUpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gaWYgdGhlIGFsbG93YW5jZSBpcyBub256ZXJvLCBtdXN0IHJlc2V0IGl0IHRvIDAgZmlyc3QKICAgICAgICBpZiAoX3Rva2VuLmFsbG93YW5jZSh0aGlzLCBfc3BlbmRlcikgIT0gMCkKICAgICAgICAgICAgYXNzZXJ0KF90b2tlbi5hcHByb3ZlKF9zcGVuZGVyLCAwKSk7CgogICAgICAgIC8vIGFwcHJvdmUgdGhlIG5ldyBhbGxvd2FuY2UKICAgICAgICBhc3NlcnQoX3Rva2VuLmFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSkpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXRpbGl0eSwgdHJhbnNmZXJzIHRva2VucyBmcm9tIGFuIGFjY291bnQgdG8gdGhlIGxvY2FsIGNvbnRyYWN0CgogICAgICAgIEBwYXJhbSBfdG9rZW4gICB0b2tlbiB0byBjbGFpbQogICAgICAgIEBwYXJhbSBfZnJvbSAgICBhY2NvdW50IHRvIGNsYWltIHRoZSB0b2tlbnMgZnJvbQogICAgICAgIEBwYXJhbSBfYW1vdW50ICBhbW91bnQgdG8gY2xhaW0KICAgICovCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX2Ftb3VudCkgcHJpdmF0ZSB7CiAgICAgICAgLy8gaWYgdGhlIHRva2VuIGlzIHRoZSBzbWFydCB0b2tlbiwgbm8gYWxsb3dhbmNlIGlzIHJlcXVpcmVkIC0gZGVzdHJveSB0aGUgdG9rZW5zIGZyb20gdGhlIGNhbGxlciBhbmQgaXNzdWUgdGhlbSB0byB0aGUgbG9jYWwgY29udHJhY3QKICAgICAgICBpZiAoX3Rva2VuID09IHRva2VuKSB7CiAgICAgICAgICAgIHRva2VuLmRlc3Ryb3koX2Zyb20sIF9hbW91bnQpOyAvLyBkZXN0cm95IF9hbW91bnQgdG9rZW5zIGZyb20gdGhlIGNhbGxlcidzIGJhbGFuY2UgaW4gdGhlIHNtYXJ0IHRva2VuCiAgICAgICAgICAgIHRva2VuLmlzc3VlKHRoaXMsIF9hbW91bnQpOyAvLyBpc3N1ZSBfYW1vdW50IG5ldyB0b2tlbnMgdG8gdGhlIGxvY2FsIGNvbnRyYWN0CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIG90aGVyd2lzZSwgd2UgYXNzdW1lIHdlIGFscmVhZHkgaGF2ZSBhbGxvd2FuY2UKICAgICAgICBhc3NlcnQoX3Rva2VuLnRyYW5zZmVyRnJvbShfZnJvbSwgdGhpcywgX2Ftb3VudCkpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZmFsbGJhY2ssIGJ1eXMgdGhlIHNtYXJ0IHRva2VuIHdpdGggRVRICiAgICAgICAgbm90ZSB0aGF0IHRoZSBwdXJjaGFzZSB3aWxsIHVzZSB0aGUgcHJpY2UgYXQgdGhlIHRpbWUgb2YgdGhlIHB1cmNoYXNlCiAgICAqLwogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICBxdWlja0J1eSgxKTsKICAgIH0KfQoKCi8vIFRoaXMgY29udHJhY3QgYWxsb3dzIHBlb3BsZSB0byBsZW5kIGFuZCBib3Jyb3cgYW55IEVSQy0yMCB0b2tlbnMgdGhhdCBmb2xsb3cKLy8gdGhlIEJhbmNvciBQcm90b2NvbCAoaS5lLiBhcmUgdHJhZGFibGUgb24tY2hhaW4pLgovLyBXaGVuIHByb3ZpZGluZyBhIGxvYW4sIHRoZSBsZW5kZXIgc2V0cyBhIGNvbGxhdGVyYWxSYXRpbywgd2hpY2ggaXMgdGhlIHNhZmV0eQovLyBtYXJnaW4gYWJvdmUgMTAwJSBjb2xsYXRlcmFsLiBGb3IgZXhhbXBsZSwgaWYgY29sbGF0ZXJhbFJhdGlvID0gMTAlLCB0aGUKLy8gbGVuZGVyIGNhbiBtYXJnaW4tY2FsbCB3aGVuZXZlciB0aGUgY29sbGF0ZXJhbCB2YWx1ZSBkcm9wcyBiZWxvdyAxMTAlIG9mIHRoZQovLyBsZW5kZWQgdG9rZW4gdmFsdWUuCi8vIFRoYXQgd2F5LCBldmVuIGlmIHRoZSBsZW5kZWQgdG9rZW4gaW5jcmVhc2VzIGluIHZhbHVlIHN1ZGRlbmx5LCB0aGVyZSBpcyBhCi8vIHNhZmV0eSBtYXJnaW4gZm9yIHRoZSBsZW5kZXIgdG8gcmVjb3ZlciB0aGVpciBsb2FuIGluIGZ1bGwuCgpjb250cmFjdCBCYW5jb3JMZW5kZXIgewogIC8vIEEgc3RydWN0IHRoYXQgcmVwcmVzZW50cyBhbiBhZ3JlZW1lbnQgYmV0d2VlbiB0d28gcGFydGllcyB0byBib3Jyb3cgQk5ULgogIC8vIE9mZmVycyB0byBib3Jyb3cgYXJlIHJlcHJlc2VudGVkIGluIHRoZSBzYW1lIHN0cnVjdCwgYXMgdW5maW5pc2hlZAogIC8vIGFncmVlbWVudHMuCiAgLy8gVE9ETzogaW5jb3Jwb3JhdGUgcHJlbWl1bXMgZm9yIHRoZSBsZW5kZXJzLgogIHN0cnVjdCBCb3Jyb3dBZ3JlZW1lbnQgewogICAgYWRkcmVzcyBsZW5kZXI7CiAgICBhZGRyZXNzIGJvcnJvd2VyOwogICAgdWludDI1NiB0b2tlbkFtb3VudDsKICAgIHVpbnQyNTYgY29sbGF0ZXJhbEFtb3VudDsKICAgIHVpbnQzMiBjb2xsYXRlcmFsUmF0aW87ICAvLyBFeHRyYSBjb2xsYXRlcmFsLCBpbiBpbnRlZ2VyIHBlcmNlbnQuCiAgICB1aW50IGV4cGlyYXRpb247CiAgfQoKICBJRVJDMjBUb2tlbiBjb25zdGFudCBwdWJsaWMgYmFuY29yVG9rZW4gPQogICAgICBJRVJDMjBUb2tlbigweDFGNTczRDZGYjNGMTNkNjg5RkY4NDRCNGNFMzc3OTRkNzlhN0ZGMUMpOwogIEJhbmNvckNoYW5nZXIgY29uc3RhbnQgcHVibGljIGJhbmNvckNoYW5nZXIgPQogICAgICBCYW5jb3JDaGFuZ2VyKDB4YjcyQTBGYTFFNTM3Yzk1NkRGY2E3MjcxMWM0NjhFZkQ4MTI3MDQ2OCk7CiAgQm9ycm93QWdyZWVtZW50W10gcHVibGljIGFncmVlbWVudHM7CgogIGZ1bmN0aW9uIGlzQ29sbGF0ZXJhbFdpdGhpbk1hcmdpbigKICAgICAgdWludDI1NiB0b2tlbkFtb3VudCwgdWludDI1NiBjb2xsYXRlcmFsQW1vdW50LCB1aW50MzIgY29sbGF0ZXJhbFJhdGlvKQogIHJldHVybnMoYm9vbCkgewogICAgSUVSQzIwVG9rZW4gZXRoZXJUb2tlbiA9IGJhbmNvckNoYW5nZXIuZ2V0UXVpY2tCdXlFdGhlclRva2VuKCk7CiAgICB1aW50MjU2IGNvbGxhdGVyYWxJblRva2VucyA9CiAgICAgICAgYmFuY29yQ2hhbmdlci5nZXRQdXJjaGFzZVJldHVybihldGhlclRva2VuLCBjb2xsYXRlcmFsQW1vdW50KTsKICAgIHVpbnQyNTYgbWluQ29sbGF0ZXJhbCA9IHRva2VuQW1vdW50ICogKDEwMCArIGNvbGxhdGVyYWxSYXRpbykgLyAxMDA7CiAgICByZXR1cm4gKGNvbGxhdGVyYWxJblRva2VucyA+IG1pbkNvbGxhdGVyYWwpOwogIH0KCiAgZnVuY3Rpb24gb2ZmZXJUb0xlbmQoCiAgICAgIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfY29sbGF0YXJhbF9yYXRpbywgdWludCBfZXhwaXJhdGlvbikgewogICAgYXNzZXJ0KGJhbmNvclRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBfYW1vdW50KSk7CiAgICBCb3Jyb3dBZ3JlZW1lbnQgYWdyZWVtZW50OwogICAgYWdyZWVtZW50LmxlbmRlciA9IG1zZy5zZW5kZXI7CiAgICBhZ3JlZW1lbnQuYm9ycm93ZXIgPSAwOwogICAgYWdyZWVtZW50LnRva2VuQW1vdW50ID0gX2Ftb3VudDsKICAgIGFncmVlbWVudC5leHBpcmF0aW9uID0gX2V4cGlyYXRpb247CiAgICBhZ3JlZW1lbnRzLnB1c2goYWdyZWVtZW50KTsKICB9CgogIGZ1bmN0aW9uIHRha2VPZmZlcih1aW50IF9vZmZlck51bWJlcikgcGF5YWJsZSB7CiAgICBhc3NlcnQoaXNDb2xsYXRlcmFsV2l0aGluTWFyZ2luKAogICAgICAgIGFncmVlbWVudHNbX29mZmVyTnVtYmVyXS50b2tlbkFtb3VudCwgbXNnLnZhbHVlLAogICAgICAgIGFncmVlbWVudHNbX29mZmVyTnVtYmVyXS5jb2xsYXRlcmFsUmF0aW8pKTsKICAgIGFzc2VydChiYW5jb3JUb2tlbi50cmFuc2ZlckZyb20oCiAgICAgICAgdGhpcywgbXNnLnNlbmRlciwgYWdyZWVtZW50c1tfb2ZmZXJOdW1iZXJdLnRva2VuQW1vdW50KSk7CiAgICBhZ3JlZW1lbnRzW19vZmZlck51bWJlcl0uYm9ycm93ZXIgPSBtc2cuc2VuZGVyOwogICAgYWdyZWVtZW50c1tfb2ZmZXJOdW1iZXJdLmNvbGxhdGVyYWxBbW91bnQgPSBtc2cudmFsdWU7CiAgfQoKICBmdW5jdGlvbiBhZGRDb2xsYXRlcmFsKHVpbnQgX29mZmVyTnVtYmVyKSBwYXlhYmxlIHsKICAgIGFncmVlbWVudHNbX29mZmVyTnVtYmVyXS5jb2xsYXRlcmFsQW1vdW50ICs9IG1zZy52YWx1ZTsKICB9CgogIGZ1bmN0aW9uIHJldHVybkxvYW4odWludCBfYWdyZWVtZW50TnVtYmVyKSB7CiAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBhZ3JlZW1lbnRzW19hZ3JlZW1lbnROdW1iZXJdLmJvcnJvd2VyKTsKICAgIGFzc2VydChiYW5jb3JUb2tlbi50cmFuc2ZlckZyb20oCiAgICAgICAgbXNnLnNlbmRlciwgYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS5sZW5kZXIsCiAgICAgICAgYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS50b2tlbkFtb3VudCkpOwogICAgYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS50b2tlbkFtb3VudCA9IDA7CiAgfQoKICBmdW5jdGlvbiBmb3JjZUNsb3NlKHVpbnQgX2FncmVlbWVudE51bWJlcikgewogICAgYXNzZXJ0KGFncmVlbWVudHNbX2FncmVlbWVudE51bWJlcl0udG9rZW5BbW91bnQgPiAwKTsKICAgIGJvb2wgbWFyZ2luQ2FsbCA9ICFpc0NvbGxhdGVyYWxXaXRoaW5NYXJnaW4oCiAgICAgICAgYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS50b2tlbkFtb3VudCwKICAgICAgICBhZ3JlZW1lbnRzW19hZ3JlZW1lbnROdW1iZXJdLmNvbGxhdGVyYWxBbW91bnQsCiAgICAgICAgYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS5jb2xsYXRlcmFsUmF0aW8pOwogICAgaWYgKG1hcmdpbkNhbGwgfHwgbm93ID4gYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS5leHBpcmF0aW9uKSB7CiAgICAgIHVpbnQyNTYgc2FsdmFnZWRBbW91bnQgPQogICAgICAgICAgYmFuY29yQ2hhbmdlci5xdWlja0J1eShhZ3JlZW1lbnRzW19hZ3JlZW1lbnROdW1iZXJdLmNvbGxhdGVyYWxBbW91bnQpOwogICAgICBpZiAoc2FsdmFnZWRBbW91bnQgPj0gYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS50b2tlbkFtb3VudCkgewogICAgICAgIC8vIEdvb2Q6IHRoZSBkZWJ0IGlzIHJldHVybmVkIGluIGZ1bGwuCiAgICAgICAgLy8gU2hvdWxkIGJlIHRoZSBtYWpvcml0eSBvZiBjYXNlcyBzaW5jZSB3ZSBwcm92aWRlIGEgc2FmZXR5IG1hcmdpbgogICAgICAgIC8vIGFuZCB0aGUgQk5UIHByaWNlIGlzIGNvbnRpbnVvdXMuCiAgICAgICAgYXNzZXJ0KGJhbmNvclRva2VuLnRyYW5zZmVyKAogICAgICAgICAgICBhZ3JlZW1lbnRzW19hZ3JlZW1lbnROdW1iZXJdLmxlbmRlciwKICAgICAgICAgICAgYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS50b2tlbkFtb3VudCkpOwogICAgICAgIGFzc2VydChiYW5jb3JUb2tlbi50cmFuc2ZlcigKICAgICAgICAgICAgYWdyZWVtZW50c1tfYWdyZWVtZW50TnVtYmVyXS5ib3Jyb3dlciwKICAgICAgICAgICAgc2FsdmFnZWRBbW91bnQgLSBhZ3JlZW1lbnRzW19hZ3JlZW1lbnROdW1iZXJdLnRva2VuQW1vdW50KSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQmFkOiBwYXJ0IG9mIHRoZSBkZWJ0IGlzIG5vdCByZXR1cm5lZC4KICAgICAgICBhc3NlcnQoYmFuY29yVG9rZW4udHJhbnNmZXIoCiAgICAgICAgICAgIGFncmVlbWVudHNbX2FncmVlbWVudE51bWJlcl0ubGVuZGVyLCBzYWx2YWdlZEFtb3VudCkpOwogICAgICB9CiAgICB9CiAgfQp9'.
	

]
