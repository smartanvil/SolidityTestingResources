Class {
	#name : #SRTc7c11eb6983787f7aa0c20abeeac8101cf621e47,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc7c11eb6983787f7aa0c20abeeac8101cf621e47 >> base64 [
	^ 'LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlwKCmZpbGU6ICAgUmVnQmFzZS5zb2wKdmVyOiAgICAwLjIuMQp1cGRhdGVkOjktTWF5LTIwMTcKYXV0aG9yOiBEYXJyeWwgTW9ycmlzIChvMHJhZ21hbjBvKQplbWFpbDogIG8wcmFnbWFuMG8gQVQgZ21haWwuY29tCgpUaGlzIGZpbGUgaXMgcGFydCBvZiB0aGUgU2FuZGFsU3RyYXBzIGZyYW1ld29yawoKYFJlZ0Jhc2VgIHByb3ZpZGVzIGFuIGluaGVyaXRpbmcgY29udHJhY3QgdGhlIG1pbmltYWwgQVBJIHRvIGJlIGNvbXBsaWFudCB3aXRoIApgUmVnaXN0cmFyYC4gIEl0IGluY2x1ZGVzIGEgc2V0LW9uY2UsIGBieXRlczMyIHB1YmxpYyByZWdOYW1lYCB3aGljaCBpcyByZWZlcmVkCnRvIGJ5IGBSZWdpc3RyYXJgIGxvb2t1cHMuCgpBbiBvd25lciB1cGRhdGFibGUgYGFkZHJlc3MgcHVibGljIG93bmVyYCBzdGF0ZSB2YXJpYWJsZSBpcyBhbHNvIHByb3ZpZGVkIGFuZCBpcwpyZXF1aXJlZCBieSBgRmFjdG9yeS5jcmVhdGVOZXcoKWAuCgpUaGlzIHNvZnR3YXJlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIApTZWUgTUlUIExpY2VuY2UgZm9yIGZ1cnRoZXIgZGV0YWlscy4KPGh0dHBzOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUPi4KClwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xMDsKCmNvbnRyYWN0IFJlZ0Jhc2UKewovLwovLyBDb25zdGFudHMKLy8KCiAgICBieXRlczMyIGNvbnN0YW50IHB1YmxpYyBWRVJTSU9OID0gIlJlZ0Jhc2UgdjAuMi4xIjsKCi8vCi8vIFN0YXRlIFZhcmlhYmxlcwovLwogICAgCiAgICAvLy8gQGRldiBBIHN0YXRpYyBpZGVudGlmaWVyLCBzZXQgaW4gdGhlIGNvbnN0cnVjdG9yIGFuZCB1c2VkIGZvciByZWdpc3RyYXIKICAgIC8vLyBsb29rdXAKICAgIC8vLyBAcmV0dXJuIFJlZ2lzdHJhciBuYW1lIFNhbmRhbFN0cmFwcyByZWdpc3RyYXJzCiAgICBieXRlczMyIHB1YmxpYyByZWdOYW1lOwoKICAgIC8vLyBAZGV2IEFuIGdlbmVyYWwgcHVycG9zZSByZXNvdXJjZSBzdWNoIGFzIHNob3J0IHRleHQgb3IgYSBrZXkgdG8gYQogICAgLy8vIHN0cmluZyBpbiBhIFN0cmluZ3NNYXAKICAgIC8vLyBAcmV0dXJuIHJlc291cmNlCiAgICBieXRlczMyIHB1YmxpYyByZXNvdXJjZTsKICAgIAogICAgLy8vIEBkZXYgQW4gYWRkcmVzcyBwZXJtaXNzaW9uZWQgdG8gZW5hY3Qgb3duZXIgcmVzdHJpY3RlZCBmdW5jdGlvbnMKICAgIC8vLyBAcmV0dXJuIG93bmVyCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCi8vCi8vIEV2ZW50cwovLwoKICAgIC8vIFRyaWdnZXJlZCBvbiBjaGFuZ2Ugb2Ygb3duZXIgYWRkcmVzcwogICAgZXZlbnQgQ2hhbmdlZE93bmVyKGFkZHJlc3MgaW5kZXhlZCBvbGRPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCiAgICAvLyBUcmlnZ2VyZWQgb24gY2hhbmdlIG9mIHJlc291cmNlCiAgICBldmVudCBDaGFuZ2VkUmVzb3VyY2UoYnl0ZXMzMiBpbmRleGVkIHJlc291cmNlKTsKCi8vCi8vIE1vZGlmaWVycwovLwoKICAgIC8vIFBlcm1pdHMgb25seSB0aGUgb3duZXIKICAgIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgovLwovLyBGdW5jdGlvbnMKLy8KCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yIFRoZSBjYWxsaW5nIGFkZHJlc3MgcGFzc2VkIHRocm91Z2ggYnkgYSBmYWN0b3J5LAogICAgLy8vIHR5cGljYWxseSBtc2cuc2VuZGVyCiAgICAvLy8gQHBhcmFtIF9yZWdOYW1lIEEgc3RhdGljIG5hbWUgcmVmZXJlbmNlZCBieSBhIFJlZ2lzdHJhcgogICAgLy8vIEBwYXJhbSBfb3duZXIgb3B0aW9uYWwgb3duZXIgYWRkcmVzcyBpZiBjcmVhdG9yIGlzIG5vdCB0aGUgaW50ZW5kZWQKICAgIC8vLyBvd25lcgogICAgLy8vIEBkZXYgT24gMHgwIHZhbHVlIGZvciBvd25lciwgb3duZXJzaGlwIHByZWNlZGVuY2UgaXM6CiAgICAvLy8gYF9vd25lcmAgZWxzZSBgX2NyZWF0b3JgIGVsc2UgbXNnLnNlbmRlcgogICAgZnVuY3Rpb24gUmVnQmFzZShhZGRyZXNzIF9jcmVhdG9yLCBieXRlczMyIF9yZWdOYW1lLCBhZGRyZXNzIF9vd25lcikKICAgIHsKICAgICAgICByZWdOYW1lID0gX3JlZ05hbWU7CiAgICAgICAgb3duZXIgPSBfb3duZXIgIT0gMHgwID8gX293bmVyIDogCiAgICAgICAgICAgICAgICBfY3JlYXRvciAhPSAweDAgPyBfY3JlYXRvciA6IG1zZy5zZW5kZXI7CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFdpbGwgc2VsZmRlc3RydWN0IHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gZGVzdHJveSgpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgc2VsZmRlc3RydWN0KG1zZy5zZW5kZXIpOwogICAgfQogICAgCiAgICAvLy8gQG5vdGljZSBDaGFuZ2UgdGhlIG93bmVyIHRvIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byB3aGljaCBvd25lcnNoaXAgaXMgdHJhbnNmZXJlZAogICAgZnVuY3Rpb24gY2hhbmdlT3duZXIoYWRkcmVzcyBfb3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBDaGFuZ2VkT3duZXIob3duZXIsIF9vd25lcik7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hhbmdlIHRoZSByZXNvdXJjZSB0byBgX3Jlc291cmNlYAogICAgLy8vIEBwYXJhbSBfcmVzb3VyY2UgQSBrZXkgb3Igc2hvcnQgdGV4dCB0byBiZSBzdG9yZWQgYXMgdGhlIHJlc291cmNlLgogICAgZnVuY3Rpb24gY2hhbmdlUmVzb3VyY2UoYnl0ZXMzMiBfcmVzb3VyY2UpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXNvdXJjZSA9IF9yZXNvdXJjZTsKICAgICAgICBDaGFuZ2VkUmVzb3VyY2UoX3Jlc291cmNlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlwKCmZpbGU6ICAgRmFjdG9yeS5zb2wKdmVyOiAgICAwLjIuMQp1cGRhdGVkOjktTWF5LTIwMTcKYXV0aG9yOiBEYXJyeWwgTW9ycmlzIChvMHJhZ21hbjBvKQplbWFpbDogIG8wcmFnbWFuMG8gQVQgZ21haWwuY29tCgpUaGlzIGZpbGUgaXMgcGFydCBvZiB0aGUgU2FuZGFsU3RyYXBzIGZyYW1ld29yawoKRmFjdG9yaWVzIGFyZSBhIGNvcmUgYnV0IGluZGVwZW5kYW50IGNvbmNlcHQgb2YgdGhlIFNhbmRhbFN0cmFwcyBmcmFtZXdvcmsgYW5kIApjYW4gYmUgdXNlZCB0byBjcmVhdGUgU2FuZGFsU3RyYXBzIGNvbXBsaWFudCAncHJvZHVjdCcgY29udHJhY3RzIGZyb20gZW1iZWQKYnl0ZWNvZGUuCgpUaGUgYWJzdHJhY3QgRmFjdG9yeSBjb250cmFjdCBpcyB0byBiZSB1c2VkIGFzIGEgU2FuZGFsU3RyYXBzIGNvbXBsaWFudCBiYXNlIGZvcgpwcm9kdWN0IHNwZWNpZmljIGZhY3RvcmllcyB3aGljaCBtdXN0IGltcGxpbWVudCB0aGUgY3JlYXRlTmV3KCkgZnVuY3Rpb24uCgppcyBpdHNlbGYgY29tcGxpYW50IHdpdGggYFJlZ2lzdHJhcmAgYnkgaW5oZXJldGluZyBgUmVnQmFzZWAgYW5kCmNvbXBpYW50IHdpdGggYEZhY3RvcnlgIHRocm91Z2ggdGhlIGBjcmVhdGVOZXcoYnl0ZXMzMiBfbmFtZSwgYWRkcmVzcyBfb3duZXIpYApBUEkuCgpBbiBvcHRpb25hbCBjcmVhdGlvbiBmZWUgY2FuIGJlIHNldCBhbmQgbWFudWFsbHkgY29sbGVjdGVkIGJ5IHRoZSBvd25lci4KClRoaXMgc29mdHdhcmUgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgClNlZSBNSVQgTGljZW5jZSBmb3IgZnVydGhlciBkZXRhaWxzLgo8aHR0cHM6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVQ+LgoKXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjEwOwoKLy8gaW1wb3J0ICJodHRwczovL2dpdGh1Yi5jb20vbzByYWdtYW4wby9TYW5kYWxTdHJhcHMvY29udHJhY3RzL1JlZ0Jhc2Uuc29sIjsKCmNvbnRyYWN0IEZhY3RvcnkgaXMgUmVnQmFzZQp7Ci8vCi8vIENvbnN0YW50cwovLwoKICAgIC8vIERlcml2aW5nIGZhY3RvcmllcyBzaG91bGQgaGF2ZSBgYnl0ZXMzMiBjb25zdGFudCBwdWJsaWMgcmVnTmFtZWAgYmVpbmcKICAgIC8vIHRoZSBwcm9kdWN0J3MgY29udHJhY3QgbmFtZSwgZS5nIGZvciBwcm9kdWN0cyAiRm9vIjoKICAgIC8vIGJ5dGVzMzIgY29uc3RhbnQgcHVibGljIHJlZ05hbWUgPSAiRm9vIjsKCiAgICAvLyBEZXJpdmluZyBmYWN0b3JpZXMgc2hvdWxkIGhhdmUgYGJ5dGVzMzIgY29uc3RhbnQgcHVibGljIFZFUlNJT05gIGJlaW5nCiAgICAvLyB0aGUgcHJvZHVjdCdzIGNvbnRyYWN0IG5hbWUgYXBwZW5kZWQgd2l0aCAnRmFjdG9yeWAgYW5kIHRoZSB2ZXJzaW9uCiAgICAvLyBvZiB0aGUgcHJvZHVjdCwgZS5nIGZvciBwcm9kdWN0cyAiRm9vIjoKICAgIC8vIGJ5dGVzMzIgY29uc3RhbnQgcHVibGljIFZFUlNJT04gIkZvb0ZhY3RvcnkgMC4wLjEiOwoKLy8KLy8gU3RhdGUgVmFyaWFibGVzCi8vCgogICAgLy8vIEByZXR1cm4gVGhlIHBheW1lbnQgaW4gd2VpIHJlcXVpcmVkIHRvIGNyZWF0ZSB0aGUgcHJvZHVjdCBjb250cmFjdC4KICAgIHVpbnQgcHVibGljIHZhbHVlOwoKLy8KLy8gRXZlbnRzCi8vCgogICAgLy8gSXMgdHJpZ2dlcmVkIHdoZW4gYSBwcm9kdWN0IGlzIGNyZWF0ZWQKICAgIGV2ZW50IENyZWF0ZWQoYWRkcmVzcyBfY3JlYXRvciwgYnl0ZXMzMiBfcmVnTmFtZSwgYWRkcmVzcyBfYWRkcmVzcyk7CgovLwovLyBNb2RpZmllcnMKLy8KCiAgICAvLyBUbyBjaGVjayB0aGF0IHRoZSBjb3JyZWN0IGZlZSBoYXMgYmVuZSBwYWlkCiAgICBtb2RpZmllciBmZWVQYWlkKCkgewogICAgCXJlcXVpcmUobXNnLnZhbHVlID09IHZhbHVlIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgCV87CiAgICB9CgovLwovLyBGdW5jdGlvbnMKLy8KCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yIFRoZSBjYWxsaW5nIGFkZHJlc3MgcGFzc2VkIHRocm91Z2ggYnkgYSBmYWN0b3J5LAogICAgLy8vIHR5cGljYWxseSBtc2cuc2VuZGVyCiAgICAvLy8gQHBhcmFtIF9yZWdOYW1lIEEgc3RhdGljIG5hbWUgcmVmZXJlbmNlZCBieSBhIFJlZ2lzdHJhcgogICAgLy8vIEBwYXJhbSBfb3duZXIgb3B0aW9uYWwgb3duZXIgYWRkcmVzcyBpZiBjcmVhdG9yIGlzIG5vdCB0aGUgaW50ZW5kZWQKICAgIC8vLyBvd25lcgogICAgLy8vIEBkZXYgT24gMHgwIHZhbHVlIGZvciBfb3duZXIgb3IgX2NyZWF0b3IsIG93bmVyc2hpcCBwcmVjZWRlbmNlIGlzOgogICAgLy8vIGBfb3duZXJgIGVsc2UgYF9jcmVhdG9yYCBlbHNlIG1zZy5zZW5kZXIKICAgIGZ1bmN0aW9uIEZhY3RvcnkoYWRkcmVzcyBfY3JlYXRvciwgYnl0ZXMzMiBfcmVnTmFtZSwgYWRkcmVzcyBfb3duZXIpCiAgICAgICAgUmVnQmFzZShfY3JlYXRvciwgX3JlZ05hbWUsIF9vd25lcikKICAgIHsKICAgICAgICAvLyBub3RoaW5nIGxlZnQgdG8gY29uc3RydWN0CiAgICB9CiAgICAKICAgIC8vLyBAbm90aWNlIFNldCB0aGUgcHJvZHVjdCBjcmVhdGlvbiBmZWUKICAgIC8vLyBAcGFyYW0gX2ZlZSBUaGUgZGVzaXJlZCBmZWUgaW4gd2VpCiAgICBmdW5jdGlvbiBzZXQodWludCBfZmVlKSAKICAgICAgICBvbmx5T3duZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHZhbHVlID0gX2ZlZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBTZW5kIGNvbnRyYWN0IGJhbGFuY2UgdG8gYG93bmVyYAogICAgZnVuY3Rpb24gd2l0aGRyYXcoKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgb3duZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgLy8vIEBub3RpY2UgQ3JlYXRlIGEgbmV3IHByb2R1Y3QgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX3JlZ05hbWUgQSB1bmlxdWUgbmFtZSBpZiB0aGUgdGhlIHByb2R1Y3QgaXMgdG8gYmUgcmVnaXN0ZXJlZCBpbgogICAgLy8vIGEgU2FuZGFsU3RyYXBzIHJlZ2lzdHJhcgogICAgLy8vIEBwYXJhbSBfb3duZXIgQW4gYWRkcmVzcyBvZiBhIHRoaXJkIHBhcnR5IG93bmVyLiAgV2lsbCBkZWZhdWx0IHRvCiAgICAvLy8gbXNnLnNlbmRlciBpZiAweDAKICAgIC8vLyBAcmV0dXJuIGtBZGRyXyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IHByb2R1Y3QgY29udHJhY3QKICAgIGZ1bmN0aW9uIGNyZWF0ZU5ldyhieXRlczMyIF9yZWdOYW1lLCBhZGRyZXNzIF9vd25lcikgCiAgICAgICAgcGF5YWJsZSByZXR1cm5zKGFkZHJlc3Mga0FkZHJfKTsKfQoKLyogRXhhbXBsZSBpbXBsaW1lbnRhdGlvbiBvZiBgY3JlYXRlTmV3KClgIGZvciBhIGRlcml2aW5nIGZhY3RvcnkKCiAgICBmdW5jdGlvbiBjcmVhdGVOZXcoYnl0ZXMzMiBfcmVnTmFtZSwgYWRkcmVzcyBfb3duZXIpCiAgICAgICAgcGF5YWJsZQogICAgICAgIGZlZVBhaWQKICAgICAgICByZXR1cm5zIChhZGRyZXNzIGtBZGRyXykKICAgIHsKICAgICAgICByZXF1aXJlKF9yZWdOYW1lICE9IDB4MCk7CiAgICAgICAgYWRkcmVzcyBrQWRkcl8gPSBhZGRyZXNzKG5ldyBGb28obXNnLnNlbmRlciwgX3JlZ05hbWUsIF9vd25lcikpOwogICAgICAgIENyZWF0ZWQobXNnLnNlbmRlciwgX3JlZ05hbWUsIGtBZGRyKTsKICAgIH0KCkV4YW1wbGUgcHJvZHVjdCBjb250cmFjdCB3aXRoIGBGYWN0b3J5YCBjb21waWFudCBjb25zdHJ1Y3RvciBhbmQgYFJlZ2lzdHJhcmAKY29tcGxpYW50IGByZWdOYW1lYC4KClRoZSBvd25lciB3aWxsIGJlIHRoZSBjYWxsZXIgYnkgZGVmYXVsdCBpZiB0aGUgYF9vd25lcmAgdmFsdWUgaXMgYDB4MGAuCgpJZiB0aGUgY29udHJhY3QgcmVxdWlyZXMgaW5pdGlhbGl6YXRpb24gdGhhdCB3b3VsZCBub3JtYWxseSBiZSBkb25lIGluIGEKY29uc3RydWN0b3IsIHRoZW4gYSBgaW5pdCgpYCBmdW5jdGlvbiBjYW4gYmUgdXNlZCBpbnN0ZWFkIHBvc3QgZGVwbG95bWVudC4KCiAgICBjb250cmFjdCBGb28gaXMgUmVnQmFzZQogICAgewogICAgICAgIGJ5dGVzMzIgY29uc3RhbnQgcHVibGljIFZFUlNJT04gPSAiRm9vIHYwLjAuMSI7CiAgICAgICAgdWludCB2YWw7CiAgICAgICAgdWludDggcHVibGljIF9faW5pdEZ1c2UgPSAxOwogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIEZvbyhhZGRyZXNzIF9jcmVhdG9yLCBieXRlczMyIF9yZWdOYW1lLCBhZGRyZXNzIF9vd25lcikKICAgICAgICAgICAgUmVnQmFzZShfY3JlYXRvciwgX3JlZ05hbWUsIF9vd25lcikKICAgICAgICB7CiAgICAgICAgICAgIC8vIHB1dCBub24tcGFyYW1ldHJpYyBjb25zdHJ1Y3RvciBjb2RlIGhlcmUuCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIF9pbml0KHVpbnQgX3ZhbCkKICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmUoX19pbml0RnVzZSA9PSAxKTsKCiAgICAgICAgICAgIC8vIHB1dCBwYXJhbWV0cmljIGNvbnN0cnVjdG9yIGNvZGUgaGVyZSBhbmQgY2FsbCBfaW5pdCgpIHBvc3QgCiAgICAgICAgICAgIC8vIGRlcGxveW1lbnQKICAgICAgICAgICAgdmFsID0gX3ZhbDsKICAgICAgICAgICAgZGVsZXRlIF9faW5pdEZ1c2U7CiAgICAgICAgfQogICAgfQoKKi8KCi8qCmZpbGU6ICAgQmFrdC5zb2wKdmVyOiAgICAwLjMuNC1iZXRhCnVwZGF0ZWQ6MTYtTWF5LTIwMTcKYXV0aG9yOiBEYXJyeWwgTW9ycmlzCmVtYWlsOiAgbzByYWdtYW4wbyBBVCBnbWFpbC5jb20KCkNvcHlyaWdodCBpcyByZXRhaW5lZCBieSB0aGUgYXV0aG9yLiAgQ29weWluZyBvciBydW5uaW5nIHRoaXMgc29mdHdhcmUgaXMgb25seQpieSBleHByZXNzIHBlcm1pc3Npb24uCgpUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQKd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiBUaGUgYXV0aG9yCmNhbm5vdCBiZSBoZWxkIGxpYWJsZSBmb3IgZGFtYWdlIG9yIGxvc3MuCgpEZXNpZ24gTm90ZXM6CgpUaGlzIGNvbnRyYWN0IERPRVMgTk9UIG9mZmVyIHRydXN0IHRvIGl0cyBob2xkZXJzLiBIb2xkZXJzIGluc3RlYWQgZWxlY3QgYQpUcnVzdGVlIGZyb20gYW1vbmcgdGhlIGhvbGRlcnMgYW5kIHRoZSBUcnVzdGVlIGlzIHJlc3BvbnNpYmxlIGZvciBmdW5kcy4KClRoZSBUcnVzdGVlIGhhcyB1bmlsYXRlcmFsIHBvd2VycyB0bzoKICAgIC0gcmVtb3ZlIGZ1bmRzCiAgICAtIHVzZSB0aGUgY29udHJhY3QgdG8gZXhlY3V0ZSBjb2RlIG9uIGFub3RoZXIgY29udHJhY3QKICAgIC0gcGF5IGRpdmlkZW5kcwogICAgLSBhZGQgaG9sZGVycwogICAgLSBpc3N1ZSBhIHRva2VuIG9mZmVyIHRvIGEgaG9sZGVyCiAgICAtIHNlbGZkZXN0cnVjdCB0aGUgY29udHJhY3QsIG9uIGNvbmRpdGlvbiBvZiAwIHN1cHBseSBhbmQgMCBldGhlciBiYWxhbmNlCiAgICAtIHZldG8gYSB0cmFuc2FjdGlvbgoKSG9sZGVycyBoYXZlIHRoZSBwb3dlciB0bzoKICAgIC0gdm90ZSBmb3IgYSBwcmVmZXJyZWQgVHJ1c3RlZQogICAgLSB2ZXRvIGEgdHJhbnNhY3Rpb24gaWYgb3duZWQgb3Igb3ducyA+IDEwJSBvZiB0b2tlbnMKICAgIC0gcHVyY2hhc2UgdG9rZW5zIG9mZmVyIHdpdGggZXRoZXIuCiAgICAtIHJlZGVlbSB0b2tlbnMgZm9yIGV0aGVyIGF0IHRoZSB0b2tlbiBwcmljZSBvciBhIHByaWNlIHByb3BvcnRpb25hbCB0bwogICAgICB0aGUgZnVuZC4KICAgIC0gd2l0aGRyYXcgdGhlaXIgYmFsYW5jZSBvZiBldGhlci4KICAgIC0gQ2F1c2UgYSBwYW5pYyBzdGF0ZSBpbiB0aGUgY29udHJhY3QgaWYgaG9sZHMgPiAxMCUgb2YgdG9rZW5zCgpUaGlzIGNvbnRyYWN0IHVzZXMgaW50ZWdlciB0b2tlbnMgc28gRVJDMjAgYGRlY2ltYWxQbGFjZXNgIGlzIDAuCgpNYXhpbXVtIG51bWJlciBvZiBob2xkZXJzIGlzIGxpbWl0ZWQgdG8gMjU0IHRvIHByZXZlbnQgcG90ZW50aWFsIE9PRyBsb29wcwpkdXJpbmcgZWxlY3Rpb25zLgpQZXJwZXR1YWwgZWxlY3Rpb24gb2YgdGhlIGBUcnVzdGVlYCBydW5zIGluIE8oMjU0KSB0aW1lIHRvIGRpc2NvdmVyIGEgd2lubmVyLgoKUmVsZWFzZSBOb3RlcyB2MC4zLjQtYmV0YToKLWZpeGVkIG1hZ25pdHVkZSBidWcgaW50cm9kdWNlZCB3aGVuIHVzaW5nIHNjaWVudGlmaWMgbm90YXRpb24gKDEwKioxOCAhPSAxMGUxOCkKLXVzaW5nIDEwKioxOCBub3RhdGlvbiByYXRoZXIgdGhhbiAxZTE4IGFzIGFscmVhZHkgdXNpbmcgMioqMjU2IG5vdGF0aW9uCi1JbnRlbmQgdG8gZGVwbG95IGZhY3RvcnkgdG8gUm9wc3RlbiwgUmlua2VieSBhbmQgTGl2ZSAKClJvcHN0ZW46IDAuMy40LWJldGEtdGVzdDEgQCAweGM0NDY1NzVmN2VkMTNmN2I0Yjg0OWY3MGZmYTlmMjA5YTY0ZGI3NDIKCiovCgovLyBpbXBvcnQgImh0dHBzOi8vZ2l0aHViLmNvbS9vMHJhZ21hbjBvL1NhbmRhbFN0cmFwcy9jb250cmFjdHMvRmFjdG9yeS5zb2wiOwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTA7CgoKY29udHJhY3QgQmFrdEludGVyZmFjZQp7CgovKiBTdHJ1Y3RzICovCgogICAgc3RydWN0IEhvbGRlciB7CiAgICAgICAgdWludDggaWQ7CiAgICAgICAgYWRkcmVzcyB2b3RpbmdGb3I7CiAgICAgICAgdWludDQwIG9mZmVyRXhwaXJ5OwogICAgICAgIHVpbnQgbGFzdENsYWltZWQ7CiAgICAgICAgdWludCB0b2tlbkJhbGFuY2U7CiAgICAgICAgdWludCBldGhlckJhbGFuY2U7CiAgICAgICAgdWludCB2b3RlczsKICAgICAgICB1aW50IG9mZmVyQW1vdW50OwogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgYWxsb3dhbmNlczsKICAgIH0KCiAgICBzdHJ1Y3QgVFggewogICAgICAgIGJvb2wgYmxvY2tlZDsKICAgICAgICB1aW50NDAgdGltZUxvY2s7CiAgICAgICAgYWRkcmVzcyBmcm9tOwogICAgICAgIGFkZHJlc3MgdG87CiAgICAgICAgdWludCB2YWx1ZTsKICAgICAgICBieXRlcyBkYXRhOwogICAgfQoKCi8qIENvbnN0YW50cyAqLwoKICAgIC8vIENvbnN0YW50IG1heCB0b2tlbnMgYW5kIG1heCBldGhlciB0byBwcmV2ZW50IHBvdGVudGlhbCBtdWx0aXBsaWNhdGlvbgogICAgLy8gb3ZlcmZsb3dzIGluIDEwZTE3IGZpeGVkIHBvaW50ICAgICAKICAgIHVpbnQgY29uc3RhbnQgTUFYVE9LRU5TID0gMioqMTI4IC0gMTAqKjE4OwogICAgdWludCBjb25zdGFudCBNQVhFVEhFUiA9IDIqKjEyODsKICAgIHVpbnQgY29uc3RhbnQgQkxPQ0tQQ05UID0gMTA7IC8vIDEwJSBob2xkaW5nIHJlcXVpcmVkIHRvIGJsb2NrIFRYJ3MKICAgIHVpbnQgY29uc3RhbnQgVE9LRU5QUklDRSA9IDEwMDAwMDAwMDAwMDAwMDA7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbFBsYWNlcyA9IDE1OwoKLyogU3RhdGUgVmFsaWFibGVzICovCgogICAgLy8gQSBtdXRleCB1c2VkIGZvciByZWVudHJ5IHByb3RlY3Rpb24KICAgIGJvb2wgX19yZU11dGV4OwoKICAgIC8vIEluaXRpYWxpc2F0aW9uIGZ1c2UuIEJsb3dzIG9uIGluaXRpYWxpc2F0aW9uIGFuZCB1c2VkIGZvciBlbnRyeSBjaGVjazsKICAgIGJvb2wgX19pbml0RnVzZSA9IHRydWU7CgogICAgLy8gQWxsb3dzIHRoZSBjb250cmFjdCB0byBhY2NlcHQgb3IgZGVueSBwYXltZW50cwogICAgYm9vbCBwdWJsaWMgYWNjZXB0aW5nUGF5bWVudHM7CgogICAgLy8gVGhlIHBlcmlvZCBmb3Igd2hpY2ggYSBwYW5pYyB3aWxsIHByZXZlbnQgZnVuY3Rpb25hbGl0eSB0byB0aGUgY29udHJhY3QKICAgIHVpbnQ0MCBwdWJsaWMgUEFOSUNQRVJJT0Q7CgogICAgLy8gVGhlIHBlcmlvZCBmb3Igd2hpY2ggYSBwZW5kaW5nIHRyYW5zYWN0aW9uIG11c3Qgd2FpdCBiZWZvcmUgYmVpbmcgc2VudCAKICAgIHVpbnQ0MCBwdWJsaWMgVFhERUxBWTsKCiAgICAvLy8gQHJldHVybiBUaGUgUGFuaWMgZmxhZyBzdGF0ZS4gZmFsc2UgPT0gY2FsbSwgdHJ1ZSA9PSBwYW5pY2tlZAogICAgYm9vbCBwdWJsaWMgcGFuaWNrZWQ7CgogICAgLy8vIEByZXR1cm4gVGhlIHBlbmRpbmcgdHJhbnNhY3Rpb24gcXVldWUgaGVhZCBwb2ludGVyCiAgICB1aW50OCBwdWJsaWMgcHR4SGVhZDsKCiAgICAvLy8gQHJldHVybiBUaGUgcGVuZGluZyB0cmFuc2FjdGlvbiBxdWV1ZSB0YWlsIHBvaW50ZXIKICAgIHVpbnQ4IHB1YmxpYyBwdHhUYWlsOwoKICAgIC8vLyBAcmV0dXJuIFRoZSBgUEFOSUNgIHRpbWVsb2NrIGV4cGlyeSBkYXRlL3RpbWUKICAgIHVpbnQ0MCBwdWJsaWMgdGltZVRvQ2FsbTsKCiAgICAvLy8gQHJldHVybiBUaGUgQWRkcmVzcyBvZiB0aGUgY3VycmVudCBlbGVjdGVkIHRydXN0ZWUKICAgIGFkZHJlc3MgcHVibGljIHRydXN0ZWU7CgogICAgLy8vIEByZXR1cm4gVG90YWwgY291bnQgb2YgdG9rZW5zCiAgICB1aW50IHB1YmxpYyB0b3RhbFN1cHBseTsKCiAgICAvLy8gQHJldHVybiBUaGUgY29tYmluZWQgYmFsYW5jZSBvZiBldGhlciBjb21taXR0ZWQgdG8gaG9sZGVyIGFjY291bnRzLCAKICAgIC8vLyB1bmNsYWltZWQgZGl2aWRlbmRzIGFuZCB2YWx1ZXMgaW4gcGVuZGluZyB0cmFuc2FjdGlvbnMuCiAgICB1aW50IHB1YmxpYyBjb21taXR0ZWRFdGhlcjsKCiAgICAvLy8gQGRldiBUaGUgcnVubmluZyB0YWxseSBvZiBkaXZpZGVuZHMgcG9pbnRzIGFjY3VyZWQgYnkgCiAgICAvLy8gZGl2aWRlbmQvdG90YWxTdXBwbHkgYXQgZWFjaCBkaXZpZGVuZCBwYXltZW50CiAgICB1aW50IGRpdmlkZW5kUG9pbnRzOwoKICAgIC8vLyBAcmV0dXJuIFRoZSBoaXN0b3JpYyB0YWxseSBvZiBwYWlkIGRpdmlkZW5kcwogICAgdWludCBwdWJsaWMgdG90YWxEaXZpZGVuZHM7CgogICAgLy8vIEByZXR1cm4gQSBzdGF0aWMgaWRlbnRpZmllciwgc2V0IGluIHRoZSBjb25zdHJ1Y3RvciBhbmQgdXNlZCBieQogICAgLy8vIHJlZ2lzdHJhcnMKICAgIGJ5dGVzMzIgcHVibGljIHJlZ05hbWU7CgogICAgLy8vIEByZXR1cm4gQW4gaW5mb3JtYXRpb25hbCByZXNvdXJjZS4gQ2FuIGJlIGEgc2hhMyBvZiBhIHN0cmluZyB0byBsb29rdXAKICAgIC8vLyBpbiBhIFN0cmluZ3NNYXAKICAgIGJ5dGVzMzIgcHVibGljIHJlc291cmNlOwoKICAgIC8vLyBAcGFyYW0gYWRkcmVzcyBUaGUgYWRkcmVzcyBvZiBhIGhvbGRlci4KICAgIC8vLyBAcmV0dXJuIEhvbGRlciBkYXRhIGNhc3QgZnJvbSBzdHJ1Y3QgSG9sZGVyIHRvIGFuIGFycmF5CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IEhvbGRlcikgcHVibGljIGhvbGRlcnM7CgogICAgLy8vIEBwYXJhbSB1aW50OCBUaGUgaW5kZXggb2YgYSBob2xkZXIKICAgIC8vLyBAcmV0dXJuIEFuIGFkZHJlc3Mgb2YgYSBob2xkZXIKICAgIGFkZHJlc3NbMjU2XSBwdWJsaWMgaG9sZGVySW5kZXg7CgogICAgLy8vIEBwYXJhbSB1aW50OCBUaGUgaW5kZXggb2YgYSBwZW5kaW5nIHRyYW5zYWN0aW9uCiAgICAvLy8gQHJldHVybiBUcmFuc2FjdGlvbiBkZXRhaWxzIGNhc3QgZnJvbSBzdHJ1Y3QgVFggdG8gYXJyYXkKICAgIFRYWzI1Nl0gcHVibGljIHBlbmRpbmdUeHM7CgovKiBFdmVudHMgKi8KCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0aGUgY29udHJhY3QgcmVjaWV2ZXMgYSBwYXltZW50CiAgICBldmVudCBEZXBvc2l0KHVpbnQgdmFsdWUpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIGV0aGVyIGlzIHNlbnQgZnJvbSB0aGUgY29udHJhY3QKICAgIGV2ZW50IFdpdGhkcmF3YWwoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgYWRkcmVzcyBpbmRleGVkIHJlY2lwaWVudCwKICAgICAgICB1aW50IHZhbHVlKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiBhIHRyYW5zYWN0aW9uIGlzIG9yZGVyZWQKICAgIGV2ZW50IFRyYW5zYWN0aW9uUGVuZGluZyh1aW50IGluZGV4ZWQgcFRYLCBhZGRyZXNzIGluZGV4ZWQgc2VuZGVyLCAKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgcmVjaXBpZW50LCB1aW50IHZhbHVlLCB1aW50IHRpbWVMb2NrKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiBhIHBlbmRpbmcgdHJhbnNhY3Rpb24gaXMgYmxvY2tlZAogICAgZXZlbnQgVHJhbnNhY3Rpb25CbG9ja2VkKGFkZHJlc3MgaW5kZXhlZCBieSwgdWludCBpbmRleGVkIHBUWCk7CgogICAgLy8gVHJpZ2dlcmVkIHdoZW4gYSB0cmFuc2FjdGlvbiBmYWlscyBlaXRoZXIgYnkgYmVpbmcgYmxvY2tlZCBvciBmYWlsdXJlIG9mIAogICAgLy8gcmVjaWVwdAogICAgZXZlbnQgVHJhbnNhY3Rpb25GYWlsZWQoYWRkcmVzcyBpbmRleGVkIHNlbmRlciwgYWRkcmVzcyBpbmRleGVkIHJlY2lwaWVudCwKICAgICAgICB1aW50IHZhbHVlKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiB0aGUgdHJ1c3RlZSBwYXlzIGRpdmlkZW5kcwogICAgZXZlbnQgRGl2aWRlbmRQYWlkKHVpbnQgdmFsdWUpOwoKICAgIC8vIEVSQzIwIHRyYW5zZmVyIG5vdGlmaWNhdGlvbgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludCB2YWx1ZSk7CgogICAgLy8gRVJDMjAgYXBwcm92YWwgbm90aWZpY2F0aW9uCiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50IHZhbHVlKTsKCiAgICAvLyBUcmlnZ2VyZWQgb24gY2hhbmdlIG9mIHRydXN0ZWUKICAgIGV2ZW50IFRydXN0ZWUoYWRkcmVzcyBpbmRleGVkIHRydXN0ZWUpOwoKICAgIC8vIFRyaWdnZXIgd2hlbiBhIG5ldyBob2xkZXIgaXMgYWRkZWQKICAgIGV2ZW50IE5ld0hvbGRlcihhZGRyZXNzIGluZGV4ZWQgaG9sZGVyKTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiBhIGhvbGRlciB2YWNhdGVzCiAgICBldmVudCBIb2xkZXJWYWNhdGVkKGFkZHJlc3MgaW5kZXhlZCBob2xkZXIpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIGEgb2ZmZXIgb2YgdG9rZW5zIGlzIGNyZWF0ZWQKICAgIGV2ZW50IElzc3VlT2ZmZXIoYWRkcmVzcyBpbmRleGVkIGhvbGRlcik7CgogICAgLy8gVHJpZ2dlcmVkIG9uIHRva2VuIGNyZWF0aW9uIHdoZW4gYW4gb2ZmZXIgaXMgYWNjZXB0ZWQKICAgIGV2ZW50IFRva2Vuc0NyZWF0ZWQoYWRkcmVzcyBpbmRleGVkIGhvbGRlciwgdWludCBhbW91bnQpOwoKICAgIC8vIFRyaWdnZXJlZCB3aGVuIHRva2VucyBhcmUgZGVzdHJveWVkIGR1cmluZyBhIHJlZGVlbWluZyByb3VuZAogICAgZXZlbnQgVG9rZW5zRGVzdHJveWVkKGFkZHJlc3MgaW5kZXhlZCBob2xkZXIsIHVpbnQgYW1vdW50KTsKCiAgICAvLyBUcmlnZ2VyZWQgd2hlbiBhIGhvbGQgY2F1c2VzIGEgcGFuaWMKICAgIGV2ZW50IFBhbmlja2VkKGFkZHJlc3MgaW5kZXhlZCBieSk7CgogICAgLy8gVHJpZ2dlcmVkIHdoZW4gYSBob2xkZXIgY2FsbXMgYSBwYW5pYwogICAgZXZlbnQgQ2FsbSgpOwoKLy8KLy8gQmFrdCBGdW5jdGlvbnMKLy8KCiAgICAvLy8gQGRldiBBY2NlcHQgcGF5bWVudCB0byB0aGUgZGVmYXVsdCBmdW5jdGlvbgogICAgZnVuY3Rpb24oKSBwYXlhYmxlOwoKICAgIC8vLyBAbm90aWNlIFRoaXMgd2lsbCBzZXQgdGhlIHBhbmljIGFuZCBwZW5kaW5nIHBlcmlvZHMuCiAgICAvLy8gVGhpcyBhY3Rpb24gaXMgYSBvbmUgb2ZmIGFuZCBpcyBpcnJldm9jYWJsZSEgCiAgICAvLy8gQHBhcmFtIF9wYW5pY0RlbGF5SW5TZWNvbmRzIFRoZSBwYW5pYyBkZWxheSBwZXJpb2QgaW4gc2Vjb25kcwogICAgLy8vIEBwYXJhbSBfcGVuZGluZ0RlbGF5SW5TZWNvbmRzIFRoZSBwZW5kaW5nIHBlcmlvZCBpbiBzZWNvbmRzCiAgICBmdW5jdGlvbiBfaW5pdCh1aW50NDAgX3BhbmljRGVsYXlJblNlY29uZHMsIHVpbnQ0MCBfcGVuZGluZ0RlbGF5SW5TZWNvbmRzKQogICAgICAgIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIG9mIHVuY29tbWl0dGVkIGV0aGVyIGZ1bmRzLgogICAgZnVuY3Rpb24gZnVuZEJhbGFuY2UoKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIAogICAgLy8vIEByZXR1cm4gVGhlIGNvbnN0YW50IFRPS0VOUFJJQ0UuCiAgICBmdW5jdGlvbiB0b2tlblByaWNlKCkgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgovLwovLyBFUkMyMCBBUEkgZnVuY3Rpb25zCi8vCgogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBvZiBhIGhvbGRlcgogICAgLy8vIEByZXR1cm4gVGhlIEVSQzIwIHRva2VuIGJhbGFuY2Ugb2YgdGhlIGhvbGRlcgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGBfYW1vdW50YCBvZiB0b2tlbnMgdG8gYF90b2AKICAgIC8vLyBAcGFyYW0gX3RvIHRoZSByZWNpcGllbnQgaG9sZGVyJ3MgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfYW1vdW50IHRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBzdWNjZXNzIHN0YXRlCiAgICAvLy8gQGRldiBgX3RvYCBtdXN0IGJlIGFuIGV4aXN0aW5nIGhvbGRlcgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYF9hbW91bnRgIG9mIHRva2VucyBmcm9tIGBfZnJvbWAgdG8gYF90b2AKICAgIC8vLyBAcGFyYW0gX2Zyb20gVGhlIGhvbGRlciBhZGRyZXNzIGZyb20gd2hpY2ggdG8gdGFrZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3RvIHRoZSByZWNpcGllbnQgaG9sZGVyJ3MgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfYW1vdW50IHRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBzdWNjZXNzIHN0YXRlCiAgICAvLy8gQGRldiBgX2Zyb21gIGFuZCBgX3RvYCBtdXN0IGJlIGV4aXN0aW5nIGhvbGRlcnMKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KQogICAgICAgIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIEFwcHJvdmUgYF9zcGVuZGVyYCB0byB0cmFuc2ZlciBgX2Ftb3VudGAgb2YgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIHRoZSBhcHByb3ZlZCBzcGVuZGVyIGFkZHJlc3MuIERvZXMgbm90IGhhdmUgdG8gYmUgYW4KICAgIC8vLyBleGlzdGluZyBob2xkZXIuCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgdGhlIG51bWJlciBvZiB0b2tlbnMgdG8gdHJhbnNmZXIKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sKTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkZHJlc3Mgb2YgdGhlIGhvbGRlciBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFsbG93ZWQgdG8gdHJhbnNmZXIgdG9rZW5zCiAgICAvLy8gQHJldHVybiBBbW91bnQgb2YgcmVtYWluaW5nIHRva2VuIHRoYXQgdGhlIF9zcGVuZGVyIGNhbiB0cmFuc2ZlcgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwoKLy8KLy8gU2VjdXJpdHkgRnVuY3Rpb25zCi8vCgogICAgLy8vIEBub3RpY2UgQ2F1c2UgdGhlIGNvbnRyYWN0IHRvIFBhbmljLiBUaGlzIHdpbGwgYmxvY2sgbW9zdCBzdGF0ZSBjaGFuZ2luZwogICAgLy8vIGZ1bmN0aW9ucyBmb3IgYSBzZXQgZGVsYXkuCiAgICAvLy8gRXhjZXB0aW9ucyBhcmUgYHZvdGUoKWAsIGBibG9ja1BlbmRpbmdUeCh1aW50IF90eElkeClgIGFuZCBgUEFOSUMoKWAuCiAgICBmdW5jdGlvbiBQQU5JQygpIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIFJlbGVhc2UgdGhlIGNvbnRyYWN0IGZyb20gYSBQYW5pYyBhZnRlciB0aGUgcGFuaWMgcGVyaW9kIGhhcwogICAgLy8vIGV4cGlyZWQuCiAgICBmdW5jdGlvbiBjYWxtKCkgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgRXhlY3V0ZSB0aGUgZmlyc3QgVFggaW4gdGhlIHBlbmRpbmdUeHMgcXVldWUuIFZhbHVlcyB3aWxsCiAgICAvLy8gcmV2ZXJ0IGlmIHRoZSB0cmFuc2FjdGlvbiBpcyBibG9ja2VkIG9yIGZhaWxzLgogICAgZnVuY3Rpb24gc2VuZFBlbmRpbmcoKSByZXR1cm5zIChib29sKTsKCiAgICAvLy8gQG5vdGljZSBCbG9jayBhIHBlbmRpbmcgdHJhbnNhY3Rpb24gd2l0aCBpZCBgX3R4SWR4YC4gUGVuZGluZwogICAgLy8vIHRyYW5zYWN0aW9ucyBjYW4gYmUgYmxvY2tlZCBieSBhbnkgaG9sZGVyIGF0IGFueSB0aW1lIGJ1dCBtdXN0CiAgICAvLy8gc3RpbGwgYmUgY2xlYXJlZCBmcm9tIHRoZSBwZW5kaW5nIHRyYW5zYWN0aW9ucyBxdWV1ZSBvbmNlIHRoZSB0aW1lbG9jawogICAgLy8vIGlzIGNsZWFyZWQuCiAgICAvLy8gQHBhcmFtIF90eElkeCBJbmRleCBvZiB0aGUgdHJhbnNhY3Rpb24gaW4gdGhlIHBlbmRpbmcgdHJhbnNhY3Rpb25zCiAgICAvLy8gdGFibGUKICAgIGZ1bmN0aW9uIGJsb2NrUGVuZGluZ1R4KHVpbnQgX3R4SWR4KSByZXR1cm5zIChib29sKTsKCi8vCi8vIFRydXN0ZWUgZnVuY3Rpb25zCi8vCgogICAgLy8vIEBub3RpY2UgU2VuZCBhIHRyYW5zYWN0aW9uIHRvIGBfdG9gIGNvbnRhaW5pbmcgYF92YWx1ZWAgd2l0aCBSTFAgZW5jb2RlZAogICAgLy8vICAgICBhcmd1bWVudHMgb2YgYF9kYXRhYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIHJlY2lwaWVudCBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF92YWx1ZSB2YWx1ZSBvZiBldGhlciB0byBzZW5kCiAgICAvLy8gQHBhcmFtIF9kYXRhIFJMUCBlbmNvZGVkIGRhdGEgdG8gc2VuZCB3aXRoIHRoZSB0cmFuc2FjdGlvbgogICAgLy8vIEBkZXYgQWxsb3dzIHRoZSB0cnVzdGVlIHRvIGluaXRpYXRlIGEgdHJhbnNhY3Rpb24gYXMgdGhlIEJha3QuIEl0IG11c3QKICAgIC8vLyBiZSBmb2xsb3dlZCBieSBzZW5kUGVuZGluZygpIGFmdGVyIHRoZSB0aW1lTG9jayBleHBpcmVzLgogICAgZnVuY3Rpb24gZXhlY3V0ZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSByZXR1cm5zICh1aW50OCk7CgogICAgLy8vIEBub3RpY2UgUGF5IGRpdmlkZW5kcyBvZiBgX3ZhbHVlYAogICAgLy8vIEBwYXJhbSBfdmFsdWUgYSB2YWx1ZSBvZiBldGhlciB1cHRvIHRoZSBmdW5kIGJhbGFuY2UKICAgIC8vLyBAZGV2IEFsbG93cyB0aGUgdHJ1c3RlZSB0byBjb21taXQgYSBwb3J0aW9uIG9mIGBmdW5kQmFsYW5jZWAgdG8gZGl2aWRlbmRzLgogICAgZnVuY3Rpb24gcGF5RGl2aWRlbmRzKHVpbnQgX3ZhbHVlKSByZXR1cm5zIChib29sKTsKCi8vCi8vIEhvbGRlciBGdW5jdGlvbnMKLy8KCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSBhcnJheSBvZiBob2xkZXIgYWRkcmVzc2VzLgogICAgZnVuY3Rpb24gZ2V0SG9sZGVycygpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzc1syNTZdKTsKCiAgICAvLy8gQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIG9mIGEgaG9sZGVyCiAgICAvLy8gQHJldHVybiBSZXR1cm5zIHRoZSBob2xkZXIncyB3aXRoZHJhd2FibGUgYmFsYW5jZSBvZiBldGhlcgogICAgZnVuY3Rpb24gZXRoZXJCYWxhbmNlT2YoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBub3RpY2UgSW5pdGlhdGUgYSB3aXRoZHJhd2FsIG9mIHRoZSBob2xkZXIncyBgZXRoZXJCYWxhbmNlYAogICAgLy8vIEZvbGxvdyB1cCB3aXRoIHNlbmRQZW5kaW5nKCkgb25jZSB0aGUgdGltZWxvY2sgaGFzIGV4cGlyZWQKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgcmV0dXJucyh1aW50OCk7CgogICAgLy8vIEBub3RpY2UgVmFjYXRlIGhvbGRlciBgX2FkZHJgCiAgICAvLy8gQHBhcmFtIF9hZGRyIFRoZSBhZGRyZXNzIG9mIGEgaG9sZGVyIHdpdGggZW1wdHkgYmFsYW5jZXMuCiAgICBmdW5jdGlvbiB2YWNhdGUoYWRkcmVzcyBfYWRkcikgcmV0dXJucyAoYm9vbCk7CgovLwovLyBUb2tlbiBDcmVhdGlvbi9EZXN0cnVjdGlvbiBGdW5jdGlvbnMKLy8KCiAgICAvLy8gQG5vdGljZSBDcmVhdGUgdG9rZW5zIHRvIHRoZSB2YWx1ZSBvZiBgbXNnLnZhbHVlYCArCiAgICAvLy8gYGhvbGRlci5ldGhlckJhbGFuY2VgCiAgICAvLy8gQHJldHVybiBzdWNjZXNzIHN0YXRlCiAgICAvLy8gQGRldiBUaGUgYW1vdW50IG9mIHRva2VucyBjcmVhdGVkIGlzOgogICAgLy8vICAgICB0b2tlbnMgPSBmbG9vcigoYGV0aGVyQmFsYW5jZWAgKyBgbXNnLnZhbHVlYCkvYHRva2VuUHJpY2VgKQogICAgLy8vICAgICBBbnkgcmVtYWluZGVyIG9mIGV0aGVyIGlzIGNyZWRpdGVkIHRvIHRoZSBob2xkZXIncyBgZXRoZXJCYWxhbmNlYAogICAgZnVuY3Rpb24gcHVyY2hhc2UoKSBwYXlhYmxlIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIFJlZGVlbSBgX2Ftb3VudGAgdG9rZW5zIGJhY2sgdG8gdGhlIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gcmVkZWVtCiAgICAvLy8gQGRldiBldGhlciA9IGBfYW1vdW50YCAqIGBmdW5kQmFsYW5jZSgpYCAvIGB0b3RhbFN1cHBseWAKICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3Mgc3RhdGUKICAgIGZ1bmN0aW9uIHJlZGVlbSh1aW50IF9hbW91bnQpIHJldHVybnMgKGJvb2wpOwoKLy8KLy8gQmFsbG90IGZ1bmN0aW9ucwovLwoKICAgIC8vLyBAbm90aWNlIFZvdGUgZm9yIGBfY2FuZGlkYXRlYCBhcyBwcmVmZXJyZWQgVHJ1c3RlZS4KICAgIC8vLyBAcGFyYW0gX2NhbmRpZGF0ZSBUaGUgYWRkcmVzcyBvZiB0aGUgcHJlZmVycmVkIGhvbGRlcgogICAgLy8vIEByZXR1cm4gc3VjY2VzcyBzdGF0ZQogICAgZnVuY3Rpb24gdm90ZShhZGRyZXNzIF9jYW5kaWRhdGUpIHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBCYWt0IGlzIEJha3RJbnRlcmZhY2UKewogICAgYnl0ZXMzMiBjb25zdGFudCBwdWJsaWMgVkVSU0lPTiA9ICJCYWt0IDAuMy40LWJldGEiOwoKLy8KLy8gQmFrdCBGdW5jdGlvbnMKLy8KCiAgICAvLyBTYW5kYWxTdHJhcHMgY29tcGxpYW50IGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBCYWt0KGFkZHJlc3MgX2NyZWF0b3IsIGJ5dGVzMzIgX3JlZ05hbWUsIGFkZHJlc3MgX3RydXN0ZWUpCiAgICB7CiAgICAgICAgcmVnTmFtZSA9IF9yZWdOYW1lOwogICAgICAgIHRydXN0ZWUgPSBfdHJ1c3RlZSAhPSAweDAgPyBfdHJ1c3RlZSA6IAogICAgICAgICAgICAgICAgX2NyZWF0b3IgIT0gMHgwID8gX2NyZWF0b3IgOiBtc2cuc2VuZGVyOwogICAgICAgIGpvaW4odHJ1c3RlZSk7CiAgICB9CgogICAgLy8gQWNjZXB0IHBheW1lbnQgdG8gdGhlIGRlZmF1bHQgZnVuY3Rpb24gb24gdGhlIGNvbmRpdGlvbiB0aGF0CiAgICAvLyBgYWNjZXB0aW5nUGF5bWVudHNgIGlzIHRydWUKICAgIGZ1bmN0aW9uKCkKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPiAwICYmCiAgICAgICAgICAgIG1zZy52YWx1ZSArIHRoaXMuYmFsYW5jZSA8IE1BWEVUSEVSICYmCiAgICAgICAgICAgIGFjY2VwdGluZ1BheW1lbnRzKTsKICAgICAgICBEZXBvc2l0KG1zZy52YWx1ZSk7CiAgICB9CgogICAgLy8gRGVzdHJ1Y3RvcgogICAgLy8gU2VsZmRlc3RydWN0cyBvbiB0aGUgY29uZGl0aW9uIHRoYXQgYHRvdGFsU3VwcGx5YCBhbmQgYGNvbW1pdHRlZEV0aGVyYAogICAgLy8gYXJlIDAKICAgIGZ1bmN0aW9uIGRlc3Ryb3koKQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbkVudGVyCiAgICAgICAgb25seVRydXN0ZWUKICAgIHsKICAgICAgICByZXF1aXJlKHRvdGFsU3VwcGx5ID09IDAgJiYgY29tbWl0dGVkRXRoZXIgPT0gMCk7CiAgICAgICAgCiAgICAgICAgZGVsZXRlIGhvbGRlcnNbdHJ1c3RlZV07CiAgICAgICAgc2VsZmRlc3RydWN0KG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIE9uZSBUaW1lIFByb2dyYW1hYmxlIHNob3QgdG8gc2V0IHRoZSBwYW5pYyBhbmQgcGVuZGluZyBwZXJpb2RzLgogICAgLy8gODY0MDAgPT0gMSBkYXkKICAgIGZ1bmN0aW9uIF9pbml0KHVpbnQ0MCBfcGFuaWNQZXJpb2RJblNlY29uZHMsIHVpbnQ0MCBfcGVuZGluZ1BlcmlvZEluU2Vjb25kcykKICAgICAgICBvbmx5VHJ1c3RlZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfX2luaXRGdXNlKTsKICAgICAgICBQQU5JQ1BFUklPRCA9IF9wYW5pY1BlcmlvZEluU2Vjb25kczsKICAgICAgICBUWERFTEFZID0gX3BlbmRpbmdQZXJpb2RJblNlY29uZHM7CiAgICAgICAgYWNjZXB0aW5nUGF5bWVudHMgPSB0cnVlOwogICAgICAgIGRlbGV0ZSBfX2luaXRGdXNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFJldHVybnMgY2FsY3VsYXRlZCBmdW5kIGJhbGFuY2UKICAgIGZ1bmN0aW9uIGZ1bmRCYWxhbmNlKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZSAtIGNvbW1pdHRlZEV0aGVyOwogICAgfQoKICAgIC8vIFJldHVybnMgdG9rZW4gcHJpY2UgY29uc3RhbnQKICAgIGZ1bmN0aW9uIHRva2VuUHJpY2UoKQogICAgICAgIHB1YmxpYwogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICByZXR1cm4gVE9LRU5QUklDRTsKICAgIH0KCiAgICAvLyBgUmVnQmFzZWAgY29tcGxpYW50IGBjaGFuZ2VSZXNvdXJjZSgpYCB0byByZXN0cmljdCBjYWxsZXIgdG8KICAgIC8vIGB0cnVzdGVlYCByYXRoZXIgdGhhbiBgb3duZXJgCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXNvdXJjZShieXRlczMyIF9yZXNvdXJjZSkKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5FbnRlcgogICAgICAgIG9ubHlUcnVzdGVlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXNvdXJjZSA9IF9yZXNvdXJjZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8vCi8vIEVSQzIwIEFQSSBmdW5jdGlvbnMKLy8KCiAgICAvLyBSZXR1cm5zIGhvbGRlciB0b2tlbiBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfYWRkcikgCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICByZXR1cm5zICh1aW50KQogICAgewogICAgICAgIHJldHVybiBob2xkZXJzW19hZGRyXS50b2tlbkJhbGFuY2U7CiAgICB9CgogICAgLy8gVG8gdHJhbnNmZXIgdG9rZW5zCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludCBfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbkVudGVyCiAgICAgICAgaXNIb2xkZXIoX3RvKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgSG9sZGVyIGZyb20gPSBob2xkZXJzW21zZy5zZW5kZXJdOwogICAgICAgIEhvbGRlciB0byA9IGhvbGRlcnNbX3RvXTsKCiAgICAgICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4geGZlcihmcm9tLCB0bywgX2Ftb3VudCk7CiAgICB9CgogICAgLy8gVG8gdHJhbnNmZXIgdG9rZW5zIGJ5IHByb3h5CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5FbnRlcgogICAgICAgIGlzSG9sZGVyKF90bykKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX2Ftb3VudCA8PSBob2xkZXJzW19mcm9tXS5hbGxvd2FuY2VzW21zZy5zZW5kZXJdKTsKICAgICAgICAKICAgICAgICBIb2xkZXIgZnJvbSA9IGhvbGRlcnNbX2Zyb21dOwogICAgICAgIEhvbGRlciB0byA9IGhvbGRlcnNbX3RvXTsKCiAgICAgICAgZnJvbS5hbGxvd2FuY2VzW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHhmZXIoZnJvbSwgdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vIFRvIGFwcHJvdmUgYSBwcm94eSBmb3IgdG9rZW4gdHJhbnNmZXJzCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5FbnRlcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgaG9sZGVyc1ttc2cuc2VuZGVyXS5hbGxvd2FuY2VzW19zcGVuZGVyXSA9IF9hbW91bnQ7CiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFJldHVybiB0aGUgYWxsb2FuY2Ugb2YgYSBwcm94eQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKQogICAgICAgIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICByZXR1cm4gaG9sZGVyc1tfb3duZXJdLmFsbG93YW5jZXNbX3NwZW5kZXJdOwogICAgfQoKICAgIC8vIFByb2Nlc3NlcyB0b2tlbiB0cmFuc2ZlcnMgYW5kIHN1YnNlcXVlbnQgY2hhbmdlIGluIHZvdGluZyBwb3dlcgogICAgZnVuY3Rpb24geGZlcihIb2xkZXIgc3RvcmFnZSBfZnJvbSwgSG9sZGVyIHN0b3JhZ2UgX3RvLCB1aW50IF9hbW91bnQpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIEVuc3VyZSBkaXZpZGVuZHMgYXJlIHVwIHRvIGRhdGUgYXQgY3VycmVudCBiYWxhbmNlcwogICAgICAgIHVwZGF0ZURpdmlkZW5kc0ZvcihfZnJvbSk7CiAgICAgICAgdXBkYXRlRGl2aWRlbmRzRm9yKF90byk7CgogICAgICAgIC8vIFJlbW92ZSBleGlzdGluZyB2b3RlcwogICAgICAgIHJldm9rZShfZnJvbSk7CiAgICAgICAgcmV2b2tlKF90byk7CgogICAgICAgIC8vIFRyYW5zZmVyIHRva2VucwogICAgICAgIF9mcm9tLnRva2VuQmFsYW5jZSAtPSBfYW1vdW50OwogICAgICAgIF90by50b2tlbkJhbGFuY2UgKz0gX2Ftb3VudDsKCiAgICAgICAgLy8gUmV2b3RlIGFjY29yaW5nIHRvIGNoYW5nZWQgdG9rZW4gYmFsYW5jZXMKICAgICAgICByZXZvdGUoX2Zyb20pOwogICAgICAgIHJldm90ZShfdG8pOwoKICAgICAgICAvLyBGb3JjZSBlbGVjdGlvbgogICAgICAgIGVsZWN0aW9uKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLwovLyBTZWN1cml0eSBGdW5jdGlvbnMKLy8KCiAgICAvLyBDYXVzZSB0aGUgY29udHJhY3QgdG8gUGFuaWMuIFRoaXMgd2lsbCBibG9jayBtb3N0IHN0YXRlIGNoYW5naW5nCiAgICAvLyBmdW5jdGlvbnMgZm9yIGEgc2V0IGRlbGF5LgogICAgZnVuY3Rpb24gUEFOSUMoKQogICAgICAgIHB1YmxpYwogICAgICAgIGlzSG9sZGVyKG1zZy5zZW5kZXIpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvLyBBIGJsb2NraW5nIGhvbGRlciByZXF1aXJlcyBhdCBsZWFzdCAxMCUgb2YgdG9rZW5zCiAgICAgICAgcmVxdWlyZShob2xkZXJzW21zZy5zZW5kZXJdLnRva2VuQmFsYW5jZSA+PSB0b3RhbFN1cHBseSAvIDEwKTsKICAgICAgICAKICAgICAgICBwYW5pY2tlZCA9IHRydWU7CiAgICAgICAgdGltZVRvQ2FsbSA9IHVpbnQ0MChub3cgKyBQQU5JQ1BFUklPRCk7CiAgICAgICAgUGFuaWNrZWQobXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gUmVsZWFzZSB0aGUgY29udHJhY3QgZnJvbSBhIFBhbmljIGFmdGVyIHRoZSBwYW5pYyBwZXJpb2QgaGFzIGV4cGlyZWQuCiAgICBmdW5jdGlvbiBjYWxtKCkKICAgICAgICBwdWJsaWMKICAgICAgICBpc0hvbGRlcihtc2cuc2VuZGVyKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZSh1aW50NDAobm93KSA+IHRpbWVUb0NhbG0gJiYgcGFuaWNrZWQpOwogICAgICAgIAogICAgICAgIHBhbmlja2VkID0gZmFsc2U7CiAgICAgICAgQ2FsbSgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIFF1ZXVlcyBhIHBlbmRpbmcgdHJhbnNhY3Rpb24gCiAgICBmdW5jdGlvbiB0aW1lTG9ja1NlbmQoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQ4KQogICAgewogICAgICAgIC8vIENoZWNrIHRoYXQgcXVldWUgaXMgbm90IGZ1bGwKICAgICAgICByZXF1aXJlKHB0eEhlYWQgKyAxICE9IHB0eFRhaWwpOwoKICAgICAgICBUWCBtZW1vcnkgdHggPSBUWCh7CiAgICAgICAgICAgIGZyb206IF9mcm9tLAogICAgICAgICAgICB0bzogX3RvLAogICAgICAgICAgICB2YWx1ZTogX3ZhbHVlLAogICAgICAgICAgICBkYXRhOiBfZGF0YSwKICAgICAgICAgICAgYmxvY2tlZDogZmFsc2UsCiAgICAgICAgICAgIHRpbWVMb2NrOiB1aW50NDAobm93ICsgVFhERUxBWSkKICAgICAgICB9KTsKICAgICAgICBUcmFuc2FjdGlvblBlbmRpbmcocHR4SGVhZCwgX2Zyb20sIF90bywgX3ZhbHVlLCBub3cgKyBUWERFTEFZKTsKICAgICAgICBwZW5kaW5nVHhzW3B0eEhlYWQrK10gPSB0eDsKICAgICAgICByZXR1cm4gIHB0eEhlYWQgLSAxOwogICAgfQoKICAgIC8vIEV4ZWN1dGUgdGhlIGZpcnN0IFRYIGluIHRoZSBwZW5kaW5nVHhzIHF1ZXVlLiBWYWx1ZXMgd2lsbAogICAgLy8gcmV2ZXJ0IGlmIHRoZSB0cmFuc2FjdGlvbiBpcyBibG9ja2VkIG9yIGZhaWxzLgogICAgZnVuY3Rpb24gc2VuZFBlbmRpbmcoKQogICAgICAgIHB1YmxpYwogICAgICAgIHByZXZlbnRSZWVudHJ5CiAgICAgICAgaXNIb2xkZXIobXNnLnNlbmRlcikKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChwdHhUYWlsID09IHB0eEhlYWQpIHJldHVybiBmYWxzZTsgLy8gVFggcXVldWUgaXMgZW1wdHkKICAgICAgICAKICAgICAgICBUWCBtZW1vcnkgdHggPSBwZW5kaW5nVHhzW3B0eFRhaWxdOwogICAgICAgIGlmKG5vdyA8IHR4LnRpbWVMb2NrKSByZXR1cm4gZmFsc2U7CiAgICAgICAgCiAgICAgICAgLy8gSGF2ZSBtZW1vcnkgY2FjaGVkIHRoZSBUWCBzbyBkZWxldGluZyBzdG9yZSBub3cgdG8gcHJldmVudCBhbnkgY2hhbmNlCiAgICAgICAgLy8gb2YgZG91YmxlIHNwZW5kcy4KICAgICAgICBkZWxldGUgcGVuZGluZ1R4c1twdHhUYWlsKytdOwogICAgICAgIAogICAgICAgIGlmKCF0eC5ibG9ja2VkKSB7CiAgICAgICAgICAgIGlmKHR4LnRvLmNhbGwudmFsdWUodHgudmFsdWUpKHR4LmRhdGEpKSB7CiAgICAgICAgICAgICAgICAvLyBUWCBzZW50IHN1Y2Nlc3NmdWxseQogICAgICAgICAgICAgICAgY29tbWl0dGVkRXRoZXIgLT0gdHgudmFsdWU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFdpdGhkcmF3YWwodHguZnJvbSwgdHgudG8sIHR4LnZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFRYIGlzIGJsb2NrZWQgb3IgZmFpbGVkIHNvIG1hbnVhbGx5IHJldmVydCBiYWxhbmNlcyB0byBwcmUtcGVuZGluZwogICAgICAgIC8vIHN0YXRlCiAgICAgICAgaWYgKHR4LmZyb20gPT0gYWRkcmVzcyh0aGlzKSkgewogICAgICAgICAgICAvLyBXYXMgc2VudCBmcm9tIGZ1bmQgYmFsYW5jZQogICAgICAgICAgICBjb21taXR0ZWRFdGhlciAtPSB0eC52YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBXYXMgc2VudCBmcm9tIGhvbGRlciBldGhlciBiYWxhbmNlCiAgICAgICAgICAgIGhvbGRlcnNbdHguZnJvbV0uZXRoZXJCYWxhbmNlICs9IHR4LnZhbHVlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBUcmFuc2FjdGlvbkZhaWxlZCh0eC5mcm9tLCB0eC50bywgdHgudmFsdWUpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBUbyBibG9jayBhIHBlbmRpbmcgdHJhbnNhY3Rpb24KICAgIGZ1bmN0aW9uIGJsb2NrUGVuZGluZ1R4KHVpbnQgX3R4SWR4KQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gT25seSBwcmV2ZW50IHJlZW50cnkgbm90IGVudHJ5IGR1cmluZyBwYW5pYwogICAgICAgIHJlcXVpcmUoIV9fcmVNdXRleCk7CiAgICAgICAgCiAgICAgICAgLy8gQSBibG9ja2luZyBob2xkZXIgcmVxdWlyZXMgYXQgbGVhc3QgMTAlIG9mIHRva2VucyBvciBpcyB0cnVzdGVlIG9yCiAgICAgICAgLy8gaXMgZnJvbSBvd24gYWNjb3VudAogICAgICAgIHJlcXVpcmUoaG9sZGVyc1ttc2cuc2VuZGVyXS50b2tlbkJhbGFuY2UgPj0gdG90YWxTdXBwbHkgLyBCTE9DS1BDTlQgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBwZW5kaW5nVHhzW3B0eFRhaWxdLmZyb20gfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSB0cnVzdGVlKTsKICAgICAgICAKICAgICAgICBwZW5kaW5nVHhzW190eElkeF0uYmxvY2tlZCA9IHRydWU7CiAgICAgICAgVHJhbnNhY3Rpb25CbG9ja2VkKG1zZy5zZW5kZXIsIF90eElkeCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgovLwovLyBUcnVzdGVlIGZ1bmN0aW9ucwovLwoKICAgIC8vIEZvciB0aGUgdHJ1c3RlZSB0byBzZW5kIGEgdHJhbnNhY3Rpb24gYXMgdGhlIGNvbnRyYWN0LiBSZXR1cm5zIHBlbmRpbmcKICAgIC8vIFRYIHF1ZXVlIGluZGV4CiAgICBmdW5jdGlvbiBleGVjdXRlKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpCiAgICAgICAgcHVibGljCiAgICAgICAgY2FuRW50ZXIKICAgICAgICBvbmx5VHJ1c3RlZQogICAgICAgIHJldHVybnMgKHVpbnQ4KQogICAgewogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGZ1bmRCYWxhbmNlKCkpOwoKICAgICAgICBjb21taXR0ZWRFdGhlciArPSBfdmFsdWU7CiAgICAgICAgcmV0dXJuIHRpbWVMb2NrU2VuZChhZGRyZXNzKHRoaXMpLCBfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgfQoKICAgIC8vIEZvciB0aGUgdHJ1c3RlZSB0byBjb21taXQgYW4gYW1vdW50IGZyb20gdGhlIGZ1bmQgYmFsYW5jZSBhcyBhIGRpdmlkZW5kCiAgICBmdW5jdGlvbiBwYXlEaXZpZGVuZHModWludCBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgY2FuRW50ZXIKICAgICAgICBvbmx5VHJ1c3RlZQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gZnVuZEJhbGFuY2UoKSk7CiAgICAgICAgLy8gQ2FsY3VsYXRlcyBkaXZpZGVuZCBhcyBwZXJjZW50IG9mIGN1cnJlbnQgYHRvdGFsU3VwcGx5YCBpbiAxMGUxNwogICAgICAgIC8vIGZpeGVkIHBvaW50IG1hdGgKICAgICAgICBkaXZpZGVuZFBvaW50cyArPSAxMCoqMTggKiBfdmFsdWUgLyB0b3RhbFN1cHBseTsKICAgICAgICB0b3RhbERpdmlkZW5kcyArPSBfdmFsdWU7CiAgICAgICAgY29tbWl0dGVkRXRoZXIgKz0gX3ZhbHVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICAvLyBGb3IgdGhlIHRydXN0ZWUgdG8gYWRkIGFuIGFkZHJlc3MgYXMgYSBob2xkZXIKICAgIGZ1bmN0aW9uIGFkZEhvbGRlcihhZGRyZXNzIF9hZGRyKQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbkVudGVyCiAgICAgICAgb25seVRydXN0ZWUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiBqb2luKF9hZGRyKTsKICAgIH0KCiAgICAvLyBDcmVhdGVzIGhvbGRlciBhY2NvdW50cy4gIENhbGxlZCBieSBhZGRIb2xkZXIoKSBhbmQgaXNzdWUoKQogICAgZnVuY3Rpb24gam9pbihhZGRyZXNzIF9hZGRyKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZigwICE9IGhvbGRlcnNbX2FkZHJdLmlkKSByZXR1cm4gdHJ1ZTsKICAgICAgICAKICAgICAgICByZXF1aXJlKF9hZGRyICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIAogICAgICAgIHVpbnQ4IGlkOwogICAgICAgIC8vIFNlYXJjaCBmb3IgdGhlIGZpcnN0IGF2YWlsYWJsZSBzbG90LgogICAgICAgIHdoaWxlIChob2xkZXJJbmRleFsrK2lkXSAhPSAwKSB7fQogICAgICAgIAogICAgICAgIC8vIGlmIGBpZGAgaXMgMCB0aGVuIHRoZXJlIGhhcyBiZWVuIGEgYXJyYXkgZnVsbCBvdmVyZmxvdy4KICAgICAgICBpZihpZCA9PSAwKSByZXZlcnQoKTsKICAgICAgICAKICAgICAgICBIb2xkZXIgaG9sZGVyID0gaG9sZGVyc1tfYWRkcl07CiAgICAgICAgaG9sZGVyLmlkID0gaWQ7CiAgICAgICAgaG9sZGVyLmxhc3RDbGFpbWVkID0gZGl2aWRlbmRQb2ludHM7CiAgICAgICAgaG9sZGVyLnZvdGluZ0ZvciA9IHRydXN0ZWU7CiAgICAgICAgaG9sZGVySW5kZXhbaWRdID0gX2FkZHI7CiAgICAgICAgTmV3SG9sZGVyKF9hZGRyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBGb3IgdGhlIHRydXN0ZWUgdG8gYWxsb3cgb3IgZGlzYWxsb3cgcGF5bWVudHMgbWFkZSB0byB0aGUgQmFrdAogICAgZnVuY3Rpb24gYWNjZXB0UGF5bWVudHMoYm9vbCBfYWNjZXB0aW5nKQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbkVudGVyCiAgICAgICAgb25seVRydXN0ZWUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGFjY2VwdGluZ1BheW1lbnRzID0gX2FjY2VwdGluZzsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBGb3IgdGhlIHRydXN0ZWUgdG8gaXNzdWUgYW4gb2ZmZXIgb2YgbmV3IHRva2VucyB0byBhIGhvbGRlcgogICAgZnVuY3Rpb24gaXNzdWUoYWRkcmVzcyBfYWRkciwgdWludCBfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbkVudGVyCiAgICAgICAgb25seVRydXN0ZWUKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIHByZXZlbnQgb3ZlcmZsb3dzIGluIHRvdGFsIHN1cHBseQogICAgICAgIGFzc2VydCh0b3RhbFN1cHBseSArIF9hbW91bnQgPCBNQVhUT0tFTlMpOwogICAgICAgIAogICAgICAgIGpvaW4oX2FkZHIpOwogICAgICAgIEhvbGRlciBob2xkZXIgPSBob2xkZXJzW19hZGRyXTsKICAgICAgICBob2xkZXIub2ZmZXJBbW91bnQgPSBfYW1vdW50OwogICAgICAgIGhvbGRlci5vZmZlckV4cGlyeSA9IHVpbnQ0MChub3cgKyA3IGRheXMpOwogICAgICAgIElzc3VlT2ZmZXIoX2FkZHIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIEZvciB0aGUgdHJ1c3RlZSB0byByZXZva2UgYW4gZWFybGllciBJc3N1ZSBPZmZlcgogICAgZnVuY3Rpb24gcmV2b2tlT2ZmZXIoYWRkcmVzcyBfYWRkcikKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5FbnRlcgogICAgICAgIG9ubHlUcnVzdGVlCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBIb2xkZXIgaG9sZGVyID0gaG9sZGVyc1tfYWRkcl07CiAgICAgICAgZGVsZXRlIGhvbGRlci5vZmZlckFtb3VudDsKICAgICAgICBkZWxldGUgaG9sZGVyLm9mZmVyRXhwaXJ5OwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8KLy8gSG9sZGVyIEZ1bmN0aW9ucwovLwoKICAgIC8vIFJldHVybnMgdGhlIGFycmF5IG9mIGhvbGRlciBhZGRyZXNzZXMuCiAgICBmdW5jdGlvbiBnZXRIb2xkZXJzKCkKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMoYWRkcmVzc1syNTZdKQogICAgewogICAgICAgIHJldHVybiBob2xkZXJJbmRleDsKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBob2xkZXIncyB3aXRoZHJhd2FibGUgYmFsYW5jZSBvZiBldGhlcgogICAgZnVuY3Rpb24gZXRoZXJCYWxhbmNlT2YoYWRkcmVzcyBfYWRkcikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgSG9sZGVyIGhvbGRlciA9IGhvbGRlcnNbX2FkZHJdOwogICAgICAgIHJldHVybiBob2xkZXIuZXRoZXJCYWxhbmNlICsgZGl2aWRlbmRzT3dpbmcoaG9sZGVyKTsKICAgIH0KCiAgICAvLyBGb3IgYSBob2xkZXIgdG8gaW5pdGlhdGUgYSB3aXRoZHJhd2FsIG9mIHRoZWlyIGV0aGVyIGJhbGFuY2UKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkKICAgICAgICBwdWJsaWMKICAgICAgICBjYW5FbnRlcgogICAgICAgIHJldHVybnModWludDggcFR4SWRfKQogICAgewogICAgICAgIEhvbGRlciBob2xkZXIgPSBob2xkZXJzW21zZy5zZW5kZXJdOwogICAgICAgIHVwZGF0ZURpdmlkZW5kc0Zvcihob2xkZXIpOwogICAgICAgIAogICAgICAgIHBUeElkXyA9IHRpbWVMb2NrU2VuZChtc2cuc2VuZGVyLCBtc2cuc2VuZGVyLCBob2xkZXIuZXRoZXJCYWxhbmNlLCAiIik7CiAgICAgICAgaG9sZGVyLmV0aGVyQmFsYW5jZSA9IDA7CiAgICB9CgogICAgLy8gVG8gY2xvc2UgYSBob2xkZXIgYWNjb3VudAogICAgZnVuY3Rpb24gdmFjYXRlKGFkZHJlc3MgX2FkZHIpCiAgICAgICAgcHVibGljCiAgICAgICAgY2FuRW50ZXIKICAgICAgICBpc0hvbGRlcihtc2cuc2VuZGVyKQogICAgICAgIGlzSG9sZGVyKF9hZGRyKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgSG9sZGVyIGhvbGRlciA9IGhvbGRlcnNbX2FkZHJdOwogICAgICAgIC8vIEVuc3VyZSBob2xkZXIgYWNjb3VudCBpcyBlbXB0eSwgaXMgbm90IHRoZSB0cnVzdGVlIGFuZCB0aGVyZSBhcmUgbm8KICAgICAgICAvLyBwZW5kaW5nIHRyYW5zYWN0aW9ucyBvciBkaXZpZGVuZHMKICAgICAgICByZXF1aXJlKF9hZGRyICE9IHRydXN0ZWUpOwogICAgICAgIHJlcXVpcmUoaG9sZGVyLnRva2VuQmFsYW5jZSA9PSAwKTsKICAgICAgICByZXF1aXJlKGhvbGRlci5ldGhlckJhbGFuY2UgPT0gMCk7CiAgICAgICAgcmVxdWlyZShob2xkZXIubGFzdENsYWltZWQgPT0gZGl2aWRlbmRQb2ludHMpOwogICAgICAgIHJlcXVpcmUocHR4SGVhZCA9PSBwdHhUYWlsKTsKICAgICAgICAKICAgICAgICBkZWxldGUgaG9sZGVySW5kZXhbaG9sZGVyLmlkXTsKICAgICAgICBkZWxldGUgaG9sZGVyc1tfYWRkcl07CiAgICAgICAgLy8gTkIgY2FuJ3QgZ2FyYmFnZSBjb2xsZWN0IGhvbGRlci5hbGxvd2FuY2VzIG1hcHBpbmcKICAgICAgICByZXR1cm4gKHRydWUpOwogICAgfQoKLy8KLy8gVG9rZW4gQ3JlYXRpb24vRGVzdHJ1Y3Rpb24gRnVuY3Rpb25zCi8vCgogICAgLy8gRm9yIGEgaG9sZGVyIHRvIGJ1eSBhbiBvZmZlciBvZiB0b2tlbnMKICAgIGZ1bmN0aW9uIHB1cmNoYXNlKCkKICAgICAgICBwYXlhYmxlCiAgICAgICAgY2FuRW50ZXIKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIEhvbGRlciBob2xkZXIgPSBob2xkZXJzW21zZy5zZW5kZXJdOwogICAgICAgIC8vIG9mZmVyIG11c3QgZXhpc3QKICAgICAgICByZXF1aXJlKGhvbGRlci5vZmZlckFtb3VudCA+IDApOwogICAgICAgIC8vIG9mZmVyIG5vdCBleHBpcmVkCiAgICAgICAgcmVxdWlyZShob2xkZXIub2ZmZXJFeHBpcnkgPiBub3cpOwogICAgICAgIC8vIGNvcnJlY3QgcGF5bWVudCBoYXMgYmVlbiBzZW50CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPT0gaG9sZGVyLm9mZmVyQW1vdW50ICogVE9LRU5QUklDRSk7CiAgICAgICAgCiAgICAgICAgdXBkYXRlRGl2aWRlbmRzRm9yKGhvbGRlcik7CiAgICAgICAgICAgICAgICAKICAgICAgICByZXZva2UoaG9sZGVyKTsKICAgICAgICAgICAgICAgIAogICAgICAgIHRvdGFsU3VwcGx5ICs9IGhvbGRlci5vZmZlckFtb3VudDsKICAgICAgICBob2xkZXIudG9rZW5CYWxhbmNlICs9IGhvbGRlci5vZmZlckFtb3VudDsKICAgICAgICBUb2tlbnNDcmVhdGVkKG1zZy5zZW5kZXIsIGhvbGRlci5vZmZlckFtb3VudCk7CiAgICAgICAgCiAgICAgICAgZGVsZXRlIGhvbGRlci5vZmZlckFtb3VudDsKICAgICAgICBkZWxldGUgaG9sZGVyLm9mZmVyRXhwaXJ5OwogICAgICAgIAogICAgICAgIHJldm90ZShob2xkZXIpOwogICAgICAgIGVsZWN0aW9uKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gRm9yIGhvbGRlcnMgdG8gZGVzdHJveSB0b2tlbnMgaW4gcmV0dXJuIGZvciBldGhlciBkdXJpbmcgYSByZWRlZW1pbmcKICAgIC8vIHJvdW5kCiAgICBmdW5jdGlvbiByZWRlZW0odWludCBfYW1vdW50KQogICAgICAgIHB1YmxpYwogICAgICAgIGNhbkVudGVyCiAgICAgICAgaXNIb2xkZXIobXNnLnNlbmRlcikKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHVpbnQgcmVkZWVtUHJpY2U7CiAgICAgICAgdWludCBldGg7CiAgICAgICAgCiAgICAgICAgSG9sZGVyIGhvbGRlciA9IGhvbGRlcnNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShfYW1vdW50IDw9IGhvbGRlci50b2tlbkJhbGFuY2UpOwogICAgICAgIAogICAgICAgIHVwZGF0ZURpdmlkZW5kc0Zvcihob2xkZXIpOwogICAgICAgIAogICAgICAgIHJldm9rZShob2xkZXIpOwogICAgICAgIAogICAgICAgIHJlZGVlbVByaWNlID0gZnVuZEJhbGFuY2UoKSAvIHRvdGFsU3VwcGx5OwogICAgICAgIC8vIHByZXZlbnQgcmVkZWVtaW5nIGFib3ZlIHRva2VuIHByaWNlIHdoaWNoIHdvdWxkIGFsbG93IGFuIGFyYml0cmFnZQogICAgICAgIC8vIGF0dGFjayBvbiB0aGUgZnVuZCBiYWxhbmNlCiAgICAgICAgcmVkZWVtUHJpY2UgPSByZWRlZW1QcmljZSA8IFRPS0VOUFJJQ0UgPyByZWRlZW1QcmljZSA6IFRPS0VOUFJJQ0U7CiAgICAgICAgCiAgICAgICAgZXRoID0gX2Ftb3VudCAqIHJlZGVlbVByaWNlOwogICAgICAgIAogICAgICAgIC8vIHdpbGwgdGhyb3cgaWYgZWl0aGVyIGBhbW91bnRgIG9yIGByZWRlZW1QUmljZWAgYXJlIDAKICAgICAgICByZXF1aXJlKGV0aCA+IDApOwogICAgICAgIAogICAgICAgIHRvdGFsU3VwcGx5IC09IF9hbW91bnQ7CiAgICAgICAgaG9sZGVyLnRva2VuQmFsYW5jZSAtPSBfYW1vdW50OwogICAgICAgIGhvbGRlci5ldGhlckJhbGFuY2UgKz0gZXRoOwogICAgICAgIGNvbW1pdHRlZEV0aGVyICs9IGV0aDsKICAgICAgICAKICAgICAgICBUb2tlbnNEZXN0cm95ZWQobXNnLnNlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV2b3RlKGhvbGRlcik7CiAgICAgICAgZWxlY3Rpb24oKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCi8vCi8vIERpdmlkZW5kIEZ1bmN0aW9ucwovLwoKICAgIGZ1bmN0aW9uIGRpdmlkZW5kc093aW5nKEhvbGRlciBzdG9yYWdlIF9ob2xkZXIpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBjb25zdGFudAogICAgICAgIHJldHVybnMgKHVpbnQgX3ZhbHVlKQogICAgewogICAgICAgIC8vIENhbGN1bGF0ZXMgb3dlZCBkaXZpZGVuZHMgaW4gMTBlMTcgZml4ZWQgcG9pbnQgbWF0aAogICAgICAgIHJldHVybiAoZGl2aWRlbmRQb2ludHMgLSBfaG9sZGVyLmxhc3RDbGFpbWVkKSAqIF9ob2xkZXIudG9rZW5CYWxhbmNlLwogICAgICAgICAgICAxMCoqMTg7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHVwZGF0ZURpdmlkZW5kc0ZvcihIb2xkZXIgc3RvcmFnZSBfaG9sZGVyKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgX2hvbGRlci5ldGhlckJhbGFuY2UgKz0gZGl2aWRlbmRzT3dpbmcoX2hvbGRlcik7CiAgICAgICAgX2hvbGRlci5sYXN0Q2xhaW1lZCA9IGRpdmlkZW5kUG9pbnRzOwogICAgfQoKLy8KLy8gQmFsbG90IGZ1bmN0aW9ucwovLwoKICAgIC8vIFRvIHZvdGUgZm9yIGEgcHJlZmVycmVkIFRydXN0ZWUuCiAgICBmdW5jdGlvbiB2b3RlKGFkZHJlc3MgX2NhbmRpZGF0ZSkKICAgICAgICBwdWJsaWMKICAgICAgICBpc0hvbGRlcihtc2cuc2VuZGVyKQogICAgICAgIGlzSG9sZGVyKF9jYW5kaWRhdGUpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvLyBPbmx5IHByZXZlbnQgcmVlbnRyeSBub3QgZW50cnkgZHVyaW5nIHBhbmljCiAgICAgICAgcmVxdWlyZSghX19yZU11dGV4KTsKICAgICAgICAKICAgICAgICBIb2xkZXIgaG9sZGVyID0gaG9sZGVyc1ttc2cuc2VuZGVyXTsKICAgICAgICByZXZva2UoaG9sZGVyKTsKICAgICAgICBob2xkZXIudm90aW5nRm9yID0gX2NhbmRpZGF0ZTsKICAgICAgICByZXZvdGUoaG9sZGVyKTsKICAgICAgICBlbGVjdGlvbigpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIExvb3BzIHRocm91Z2ggaG9sZGVycyB0byBmaW5kIHRoZSBob2xkZXIgd2l0aCBtb3N0IHZvdGVzIGFuZCBkZWNsYXJlcwogICAgLy8gdGhlbSB0byBiZSB0aGUgRXhlY3V0aXZlOwogICAgZnVuY3Rpb24gZWxlY3Rpb24oKQogICAgICAgIGludGVybmFsCiAgICB7CiAgICAgICAgdWludCBtYXg7CiAgICAgICAgdWludCB3aW5uZXI7CiAgICAgICAgdWludCB2b3RlczsKICAgICAgICB1aW50OCBpOwogICAgICAgIGFkZHJlc3MgYWRkcjsKICAgICAgICAKICAgICAgICBpZiAoMCA9PSB0b3RhbFN1cHBseSkgcmV0dXJuOwogICAgICAgIAogICAgICAgIHdoaWxlKCsraSAhPSAwKQogICAgICAgIHsKICAgICAgICAgICAgYWRkciA9IGhvbGRlckluZGV4W2ldOwogICAgICAgICAgICBpZiAoYWRkciAhPSAweDApIHsKICAgICAgICAgICAgICAgIHZvdGVzID0gaG9sZGVyc1thZGRyXS52b3RlczsKICAgICAgICAgICAgICAgIGlmICh2b3RlcyA+IG1heCkgewogICAgICAgICAgICAgICAgICAgIG1heCA9IHZvdGVzOwogICAgICAgICAgICAgICAgICAgIHdpbm5lciA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdHJ1c3RlZSA9IGhvbGRlckluZGV4W3dpbm5lcl07CiAgICAgICAgVHJ1c3RlZSh0cnVzdGVlKTsKICAgIH0KCiAgICAvLyBQdWxscyB2b3RlcyBmcm9tIHRoZSBwcmVmZXJyZWQgY2FuZGlkYXRlCiAgICAvLyByZXF1aXJlZCBiZWZvcmUgYW55IGFkanVzdG1lbnRzIHRvIGB0b2tlbkJhbGFuY2VgIG9yIHZvdGUgcHJlZmVyZW5jZS4KICAgIGZ1bmN0aW9uIHJldm9rZShIb2xkZXIgX2hvbGRlcikKICAgICAgICBpbnRlcm5hbAogICAgewogICAgICAgIGhvbGRlcnNbX2hvbGRlci52b3RpbmdGb3JdLnZvdGVzIC09IF9ob2xkZXIudG9rZW5CYWxhbmNlOwogICAgfQoKICAgIC8vIFBsYWNlcyB2b3RlcyB3aXRoIHByZWZlcnJlZCBjYW5kaWRhdGUKICAgIC8vIHJlcXVpcmVkIGFmdGVyIGFueSBhZGp1c3RtZW50cyB0byBgdG9rZW5CYWxhbmNlYCBvciB2b3RlIHByZWZlcmVuY2UuCiAgICBmdW5jdGlvbiByZXZvdGUoSG9sZGVyIF9ob2xkZXIpCiAgICAgICAgaW50ZXJuYWwKICAgIHsKICAgICAgICBob2xkZXJzW19ob2xkZXIudm90aW5nRm9yXS52b3RlcyArPSBfaG9sZGVyLnRva2VuQmFsYW5jZTsKICAgIH0KCi8vCi8vIE1vZGlmaWVycwovLwoKICAgIC8vIEJsb2NrcyBpZiByZWVudHJ5IG11dGV4IG9yIHBhbmlja2VkIGlzIHRydWUgb3Igc2V0cyByZW50cnkgbXV0ZXggdG8gdHJ1ZQogICAgbW9kaWZpZXIgcHJldmVudFJlZW50cnkoKSB7CiAgICAgICAgcmVxdWlyZSghKF9fcmVNdXRleCB8fCBwYW5pY2tlZCB8fCBfX2luaXRGdXNlKSk7CiAgICAgICAgX19yZU11dGV4ID0gdHJ1ZTsKICAgICAgICBfOwogICAgICAgIF9fcmVNdXRleCA9IGZhbHNlOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBCbG9ja3MgaWYgcmVlbnRyeSBtdXRleCBvciBwYW5pY2tlZCBpcyB0cnVlCiAgICBtb2RpZmllciBjYW5FbnRlcigpIHsKICAgICAgICByZXF1aXJlKCEoX19yZU11dGV4IHx8IHBhbmlja2VkIHx8IF9faW5pdEZ1c2UpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIEJsb2NrcyBpZiAnX2FkZHInIGlzIG5vdCBhIGhvbGRlcgogICAgbW9kaWZpZXIgaXNIb2xkZXIoYWRkcmVzcyBfYWRkcikgewogICAgICAgIHJlcXVpcmUoMCAhPSBob2xkZXJzW19hZGRyXS5pZCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBCbG9jayBub24tdHJ1c3RlZSBob2xkZXJzCiAgICBtb2RpZmllciBvbmx5VHJ1c3RlZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gdHJ1c3RlZSk7CiAgICAgICAgXzsKICAgIH0KfQoKCi8vIFNhbmRhbFN0cmFwcyBjb21wbGlhbnQgZmFjdG9yeSBmb3IgQmFrdApjb250cmFjdCBCYWt0RmFjdG9yeSBpcyBGYWN0b3J5CnsKICAgIC8vIExpdmU6IDB4YzdjMTFlYjY5ODM3ODdmN2FhMGMyMGFiZWVhYzgxMDFjZjYyMWU0NwogICAgLy8gaHR0cHM6Ly9ldGhlcnNjYW4uaW8vYWRkcmVzcy8weGM3YzExZWI2OTgzNzg3ZjdhYTBjMjBhYmVlYWM4MTAxY2Y2MjFlNDcKICAgIC8vIFJvcHN0ZW46IDB4ZGEzMzEyOTQ2NDY4OGI3YmQ3NTJjZTY0ZTllZDZiY2E2NWY0NDkwMiAoY291bGQgbm90IHZlcmlmeSksCiAgICAvLyAgICAgICAgICAweDE5MTI0ZGJhYjNmY2JhNzhiOGQyNDBlZDJmMmViODc2NTRlMjUyZDQKICAgIC8vIFJpbmtlYnk6IAoKLyogQ29uc3RhbnRzICovCgogICAgYnl0ZXMzMiBjb25zdGFudCBwdWJsaWMgcmVnTmFtZSA9ICJCYWt0IjsKICAgIGJ5dGVzMzIgY29uc3RhbnQgcHVibGljIFZFUlNJT04gPSAiQmFrdCBGYWN0b3J5IHYwLjMuNC1iZXRhIjsKCi8qIENvbnN0cnVjdG9yIERlc3RydWN0b3IqLwoKICAgIGZ1bmN0aW9uIEJha3RGYWN0b3J5KGFkZHJlc3MgX2NyZWF0b3IsIGJ5dGVzMzIgX3JlZ05hbWUsIGFkZHJlc3MgX293bmVyKQogICAgICAgIEZhY3RvcnkoX2NyZWF0b3IsIF9yZWdOYW1lLCBfb3duZXIpCiAgICB7CiAgICAgICAgLy8gbm90aGluZyB0byBjb25zdHJ1Y3QKICAgIH0KCi8qIFB1YmxpYyBGdW5jdGlvbnMgKi8KCiAgICBmdW5jdGlvbiBjcmVhdGVOZXcoYnl0ZXMzMiBfcmVnTmFtZSwgYWRkcmVzcyBfb3duZXIpCiAgICAgICAgcGF5YWJsZQogICAgICAgIGZlZVBhaWQKICAgICAgICByZXR1cm5zIChhZGRyZXNzIGtBZGRyXykKICAgIHsKICAgICAgICByZXF1aXJlKF9yZWdOYW1lICE9IDB4MCk7CiAgICAgICAga0FkZHJfID0gbmV3IEJha3Qob3duZXIsIF9yZWdOYW1lLCBtc2cuc2VuZGVyKTsKICAgICAgICBDcmVhdGVkKG1zZy5zZW5kZXIsIF9yZWdOYW1lLCBrQWRkcl8pOwogICAgfQp9'.
	

]
