Class {
	#name : #SRTe716209f5d62efa8ca4cacdda1284bfff8df9e42,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe716209f5d62efa8ca4cacdda1284bfff8df9e42 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovLy8gbm90ZTogZHVyaW5nIGFueSBvd25lcnNoaXAgY2hhbmdlcyBhbGwgcGVuZGluZyBvcGVyYXRpb25zICh3YWl0aW5nIGZvciBtb3JlIHNpZ25hdHVyZXMpIGFyZSBjYW5jZWxsZWQKLy8gVE9ETyBhY2NlcHRPd25lcnNoaXAKY29udHJhY3QgbXVsdGlvd25lZCB7CgoJLy8gVFlQRVMKCiAgICAvLyBzdHJ1Y3QgZm9yIHRoZSBzdGF0dXMgb2YgYSBwZW5kaW5nIG9wZXJhdGlvbi4KICAgIHN0cnVjdCBNdWx0aU93bmVkT3BlcmF0aW9uUGVuZGluZ1N0YXRlIHsKICAgICAgICAvLyBjb3VudCBvZiBjb25maXJtYXRpb25zIG5lZWRlZAogICAgICAgIHVpbnQgeWV0TmVlZGVkOwoKICAgICAgICAvLyBiaXRtYXAgb2YgY29uZmlybWF0aW9ucyB3aGVyZSBvd25lciAjb3duZXJJbmRleCdzIGRlY2lzaW9uIGNvcnJlc3BvbmRzIHRvIDIqKm93bmVySW5kZXggYml0CiAgICAgICAgdWludCBvd25lcnNEb25lOwoKICAgICAgICAvLyBwb3NpdGlvbiBvZiB0aGlzIG9wZXJhdGlvbiBrZXkgaW4gbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4CiAgICAgICAgdWludCBpbmRleDsKICAgIH0KCgkvLyBFVkVOVFMKCiAgICBldmVudCBDb25maXJtYXRpb24oYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwogICAgZXZlbnQgUmV2b2tlKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKICAgIGV2ZW50IEZpbmFsQ29uZmlybWF0aW9uKGFkZHJlc3Mgb3duZXIsIGJ5dGVzMzIgb3BlcmF0aW9uKTsKCiAgICAvLyBzb21lIG90aGVycyBhcmUgaW4gdGhlIGNhc2Ugb2YgYW4gb3duZXIgY2hhbmdpbmcuCiAgICBldmVudCBPd25lckNoYW5nZWQoYWRkcmVzcyBvbGRPd25lciwgYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lckFkZGVkKGFkZHJlc3MgbmV3T3duZXIpOwogICAgZXZlbnQgT3duZXJSZW1vdmVkKGFkZHJlc3Mgb2xkT3duZXIpOwoKICAgIC8vIHRoZSBsYXN0IG9uZSBpcyBlbWl0dGVkIGlmIHRoZSByZXF1aXJlZCBzaWduYXR1cmVzIGNoYW5nZQogICAgZXZlbnQgUmVxdWlyZW1lbnRDaGFuZ2VkKHVpbnQgbmV3UmVxdWlyZW1lbnQpOwoKCS8vIE1PRElGSUVSUwoKICAgIC8vIHNpbXBsZSBzaW5nbGUtc2lnIGZ1bmN0aW9uIG1vZGlmaWVyLgogICAgbW9kaWZpZXIgb25seW93bmVyIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIobXNnLnNlbmRlcikpOwogICAgICAgIF87CiAgICB9CiAgICAvLyBtdWx0aS1zaWcgZnVuY3Rpb24gbW9kaWZpZXI6IHRoZSBvcGVyYXRpb24gbXVzdCBoYXZlIGFuIGludHJpbnNpYyBoYXNoIGluIG9yZGVyCiAgICAvLyB0aGF0IGxhdGVyIGF0dGVtcHRzIGNhbiBiZSByZWFsaXNlZCBhcyB0aGUgc2FtZSB1bmRlcmx5aW5nIG9wZXJhdGlvbiBhbmQKICAgIC8vIHRodXMgY291bnQgYXMgY29uZmlybWF0aW9ucy4KICAgIG1vZGlmaWVyIG9ubHltYW55b3duZXJzKGJ5dGVzMzIgX29wZXJhdGlvbikgewogICAgICAgIGlmIChjb25maXJtQW5kQ2hlY2soX29wZXJhdGlvbikpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICAgICAgLy8gRXZlbiBpZiByZXF1aXJlZCBudW1iZXIgb2YgY29uZmlybWF0aW9ucyBoYXMndCBiZWVuIGNvbGxlY3RlZCB5ZXQsCiAgICAgICAgLy8gd2UgY2FuJ3QgdGhyb3cgaGVyZSAtIGJlY2F1c2UgY2hhbmdlcyB0byB0aGUgc3RhdGUgaGF2ZSB0byBiZSBwcmVzZXJ2ZWQuCiAgICAgICAgLy8gQnV0LCBjb25maXJtQW5kQ2hlY2sgaXRzZWxmIHdpbGwgdGhyb3cgaW4gY2FzZSBzZW5kZXIgaXMgbm90IGFuIG93bmVyLgogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkTnVtT3duZXJzKHVpbnQgX251bU93bmVycykgewogICAgICAgIHJlcXVpcmUoX251bU93bmVycyA+IDAgJiYgX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudCh1aW50IF9yZXF1aXJlZCwgdWludCBfbnVtT3duZXJzKSB7CiAgICAgICAgcmVxdWlyZShfcmVxdWlyZWQgPiAwICYmIF9yZXF1aXJlZCA8PSBfbnVtT3duZXJzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRXhpc3RzKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKGlzT3duZXIoX2FkZHJlc3MpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG93bmVyRG9lc05vdEV4aXN0KGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKCFpc093bmVyKF9hZGRyZXNzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSB7CiAgICAgICAgcmVxdWlyZShpc09wZXJhdGlvbkFjdGl2ZShfb3BlcmF0aW9uKSk7CiAgICAgICAgXzsKICAgIH0KCgkvLyBNRVRIT0RTCgogICAgLy8gY29uc3RydWN0b3IgaXMgZ2l2ZW4gbnVtYmVyIG9mIHNpZ3MgcmVxdWlyZWQgdG8gZG8gcHJvdGVjdGVkICJvbmx5bWFueW93bmVycyIgdHJhbnNhY3Rpb25zCiAgICAvLyBhcyB3ZWxsIGFzIHRoZSBzZWxlY3Rpb24gb2YgYWRkcmVzc2VzIGNhcGFibGUgb2YgY29uZmlybWluZyB0aGVtIChtc2cuc2VuZGVyIGlzIG5vdCBhZGRlZCB0byB0aGUgb3duZXJzISkuCiAgICBmdW5jdGlvbiBtdWx0aW93bmVkKGFkZHJlc3NbXSBfb3duZXJzLCB1aW50IF9yZXF1aXJlZCkKICAgICAgICB2YWxpZE51bU93bmVycyhfb3duZXJzLmxlbmd0aCkKICAgICAgICBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudChfcmVxdWlyZWQsIF9vd25lcnMubGVuZ3RoKQogICAgewogICAgICAgIGFzc2VydChjX21heE93bmVycyA8PSAyNTUpOwoKICAgICAgICBtX251bU93bmVycyA9IF9vd25lcnMubGVuZ3RoOwogICAgICAgIG1fbXVsdGlPd25lZFJlcXVpcmVkID0gX3JlcXVpcmVkOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfb3duZXJzLmxlbmd0aDsgKytpKQogICAgICAgIHsKICAgICAgICAgICAgYWRkcmVzcyBvd25lciA9IF9vd25lcnNbaV07CiAgICAgICAgICAgIC8vIGludmFsaWQgYW5kIGR1cGxpY2F0ZSBhZGRyZXNzZXMgYXJlIG5vdCBhbGxvd2VkCiAgICAgICAgICAgIHJlcXVpcmUoMCAhPSBvd25lciAmJiAhaXNPd25lcihvd25lcikgLyogbm90IGlzT3duZXIgeWV0ISAqLyk7CgogICAgICAgICAgICB1aW50IGN1cnJlbnRPd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KGkgKyAxIC8qIGZpcnN0IHNsb3QgaXMgdW51c2VkICovKTsKICAgICAgICAgICAgbV9vd25lcnNbY3VycmVudE93bmVySW5kZXhdID0gb3duZXI7CiAgICAgICAgICAgIG1fb3duZXJJbmRleFtvd25lcl0gPSBjdXJyZW50T3duZXJJbmRleDsKICAgICAgICB9CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgIH0KCiAgICAvLyBSZXBsYWNlcyBhbiBvd25lciBgX2Zyb21gIHdpdGggYW5vdGhlciBgX3RvYC4KICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb3duZXJFeGlzdHMoX2Zyb20pCiAgICAgICAgb3duZXJEb2VzTm90RXhpc3QoX3RvKQogICAgICAgIG9ubHltYW55b3duZXJzKHNoYTMobXNnLmRhdGEpKQogICAgewogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtfZnJvbV0pOwogICAgICAgIG1fb3duZXJzW293bmVySW5kZXhdID0gX3RvOwogICAgICAgIG1fb3duZXJJbmRleFtfZnJvbV0gPSAwOwogICAgICAgIG1fb3duZXJJbmRleFtfdG9dID0gb3duZXJJbmRleDsKCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgICAgIE93bmVyQ2hhbmdlZChfZnJvbSwgX3RvKTsKICAgIH0KCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBhZGRPd25lcihhZGRyZXNzIF9vd25lcikKICAgICAgICBleHRlcm5hbAogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KF9vd25lcikKICAgICAgICB2YWxpZE51bU93bmVycyhtX251bU93bmVycyArIDEpCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICBtX251bU93bmVycysrOwogICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IF9vd25lcjsKICAgICAgICBtX293bmVySW5kZXhbX293bmVyXSA9IGNoZWNrT3duZXJJbmRleChtX251bU93bmVycyk7CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgICAgICBPd25lckFkZGVkKF9vd25lcik7CiAgICB9CgogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gcmVtb3ZlT3duZXIoYWRkcmVzcyBfb3duZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvd25lckV4aXN0cyhfb3duZXIpCiAgICAgICAgdmFsaWROdW1Pd25lcnMobV9udW1Pd25lcnMgLSAxKQogICAgICAgIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KG1fbXVsdGlPd25lZFJlcXVpcmVkLCBtX251bU93bmVycyAtIDEpCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgobV9vd25lckluZGV4W19vd25lcl0pOwogICAgICAgIG1fb3duZXJzW293bmVySW5kZXhdID0gMDsKICAgICAgICBtX293bmVySW5kZXhbX293bmVyXSA9IDA7CiAgICAgICAgLy9tYWtlIHN1cmUgbV9udW1Pd25lcnMgaXMgZXF1YWwgdG8gdGhlIG51bWJlciBvZiBvd25lcnMgYW5kIGFsd2F5cyBwb2ludHMgdG8gdGhlIGxhc3Qgb3duZXIKICAgICAgICByZW9yZ2FuaXplT3duZXJzKCk7CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgICAgICBPd25lclJlbW92ZWQoX293bmVyKTsKICAgIH0KCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9uZXdSZXF1aXJlZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KF9uZXdSZXF1aXJlZCwgbV9udW1Pd25lcnMpCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgbV9tdWx0aU93bmVkUmVxdWlyZWQgPSBfbmV3UmVxdWlyZWQ7CiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgUmVxdWlyZW1lbnRDaGFuZ2VkKF9uZXdSZXF1aXJlZCk7CiAgICB9CgogICAgLy8gR2V0cyBhbiBvd25lciBieSAwLWluZGV4ZWQgcG9zaXRpb24KICAgIGZ1bmN0aW9uIGdldE93bmVyKHVpbnQgb3duZXJJbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gbV9vd25lcnNbb3duZXJJbmRleCArIDFdOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldE93bmVycygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IHJlc3VsdCA9IG5ldyBhZGRyZXNzW10obV9udW1Pd25lcnMpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1fbnVtT3duZXJzOyBpKyspCiAgICAgICAgICAgIHJlc3VsdFtpXSA9IGdldE93bmVyKGkpOwoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGlzT3duZXIoYWRkcmVzcyBfYWRkcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbV9vd25lckluZGV4W19hZGRyXSA+IDA7CiAgICB9CgogICAgLy8gVGVzdHMgb3duZXJzaGlwIG9mIHRoZSBjdXJyZW50IGNhbGxlci4KICAgIC8vIEl0J3MgYWR2aXNhYmxlIHRvIGNhbGwgaXQgYnkgbmV3IG93bmVyIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBzYW1lIGVycm9uZW91cyBhZGRyZXNzIGlzIG5vdCBjb3B5LXBhc3RlZCB0bwogICAgLy8gYWRkT3duZXIvY2hhbmdlT3duZXIgYW5kIHRvIGlzT3duZXIuCiAgICBmdW5jdGlvbiBhbUlPd25lcigpIGV4dGVybmFsIGNvbnN0YW50IG9ubHlvd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gUmV2b2tlcyBhIHByaW9yIGNvbmZpcm1hdGlvbiBvZiB0aGUgZ2l2ZW4gb3BlcmF0aW9uCiAgICBmdW5jdGlvbiByZXZva2UoYnl0ZXMzMiBfb3BlcmF0aW9uKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgbXVsdGlPd25lZE9wZXJhdGlvbklzQWN0aXZlKF9vcGVyYXRpb24pCiAgICAgICAgb25seW93bmVyCiAgICB7CiAgICAgICAgdWludCBvd25lckluZGV4Qml0ID0gbWFrZU93bmVyQml0bWFwQml0KG1zZy5zZW5kZXIpOwogICAgICAgIHZhciBwZW5kaW5nID0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXTsKICAgICAgICByZXF1aXJlKHBlbmRpbmcub3duZXJzRG9uZSAmIG93bmVySW5kZXhCaXQgPiAwKTsKCiAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwoKICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCsrOwogICAgICAgIHBlbmRpbmcub3duZXJzRG9uZSAtPSBvd25lckluZGV4Qml0OwoKICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgUmV2b2tlKG1zZy5zZW5kZXIsIF9vcGVyYXRpb24pOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc0NvbmZpcm1lZChieXRlczMyIF9vcGVyYXRpb24sIGFkZHJlc3MgX293bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoX29wZXJhdGlvbikKICAgICAgICBvd25lckV4aXN0cyhfb3duZXIpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gIShtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLm93bmVyc0RvbmUgJiBtYWtlT3duZXJCaXRtYXBCaXQoX293bmVyKSA9PSAwKTsKICAgIH0KCiAgICAvLyBJTlRFUk5BTCBNRVRIT0RTCgogICAgZnVuY3Rpb24gY29uZmlybUFuZENoZWNrKGJ5dGVzMzIgX29wZXJhdGlvbikKICAgICAgICBwcml2YXRlCiAgICAgICAgb25seW93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoNTEyID09IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGgpCiAgICAgICAgICAgIC8vIEluIGNhc2UgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4IGdyb3dzIHRvbyBtdWNoIHdlIGhhdmUgdG8gc2hyaW5rIGl0OiBvdGhlcndpc2UgYXQgc29tZSBwb2ludAogICAgICAgICAgICAvLyB3ZSB3b24ndCBiZSBhYmxlIHRvIGRvIGl0IGJlY2F1c2Ugb2YgYmxvY2sgZ2FzIGxpbWl0LgogICAgICAgICAgICAvLyBZZXMsIHBlbmRpbmcgY29uZmlybWF0aW9ucyB3aWxsIGJlIGxvc3QuIERvbnQgc2VlIGFueSBzZWN1cml0eSBvciBzdGFiaWxpdHkgaW1wbGljYXRpb25zLgogICAgICAgICAgICAvLyBUT0RPIHVzZSBtb3JlIGdyYWNlZnVsIGFwcHJvYWNoIGxpa2UgY29tcGFjdCBvciByZW1vdmFsIG9mIGNsZWFyUGVuZGluZyBjb21wbGV0ZWx5CiAgICAgICAgICAgIGNsZWFyUGVuZGluZygpOwoKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CgogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCB5ZXQgd29ya2luZyBvbiB0aGlzIG9wZXJhdGlvbiwgc3dpdGNoIG92ZXIgYW5kIHJlc2V0IHRoZSBjb25maXJtYXRpb24gc3RhdHVzLgogICAgICAgIGlmICghIGlzT3BlcmF0aW9uQWN0aXZlKF9vcGVyYXRpb24pKSB7CiAgICAgICAgICAgIC8vIHJlc2V0IGNvdW50IG9mIGNvbmZpcm1hdGlvbnMgbmVlZGVkLgogICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCA9IG1fbXVsdGlPd25lZFJlcXVpcmVkOwogICAgICAgICAgICAvLyByZXNldCB3aGljaCBvd25lcnMgaGF2ZSBjb25maXJtZWQgKG5vbmUpIC0gc2V0IG91ciBiaXRtYXAgdG8gMC4KICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lID0gMDsKICAgICAgICAgICAgcGVuZGluZy5pbmRleCA9IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGgrKzsKICAgICAgICAgICAgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W3BlbmRpbmcuaW5kZXhdID0gX29wZXJhdGlvbjsKICAgICAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwogICAgICAgIH0KCiAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBiaXQgdG8gc2V0IGZvciB0aGlzIG93bmVyLgogICAgICAgIHVpbnQgb3duZXJJbmRleEJpdCA9IG1ha2VPd25lckJpdG1hcEJpdChtc2cuc2VuZGVyKTsKICAgICAgICAvLyBtYWtlIHN1cmUgd2UgKHRoZSBtZXNzYWdlIHNlbmRlcikgaGF2ZW4ndCBjb25maXJtZWQgdGhpcyBvcGVyYXRpb24gcHJldmlvdXNseS4KICAgICAgICBpZiAocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA9PSAwKSB7CiAgICAgICAgICAgIC8vIG9rIC0gY2hlY2sgaWYgY291bnQgaXMgZW5vdWdoIHRvIGdvIGFoZWFkLgogICAgICAgICAgICBhc3NlcnQocGVuZGluZy55ZXROZWVkZWQgPiAwKTsKICAgICAgICAgICAgaWYgKHBlbmRpbmcueWV0TmVlZGVkID09IDEpIHsKICAgICAgICAgICAgICAgIC8vIGVub3VnaCBjb25maXJtYXRpb25zOiByZXNldCBhbmQgcnVuIGludGVyaW9yLgogICAgICAgICAgICAgICAgZGVsZXRlIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleFttX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLmluZGV4XTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dOwogICAgICAgICAgICAgICAgRmluYWxDb25maXJtYXRpb24obXNnLnNlbmRlciwgX29wZXJhdGlvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIG5vdCBlbm91Z2g6IHJlY29yZCB0aGF0IHRoaXMgb3duZXIgaW4gcGFydGljdWxhciBjb25maXJtZWQuCiAgICAgICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZC0tOwogICAgICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lIHw9IG93bmVySW5kZXhCaXQ7CiAgICAgICAgICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgICAgICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgX29wZXJhdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gUmVjbGFpbXMgZnJlZSBzbG90cyBiZXR3ZWVuIHZhbGlkIG93bmVycyBpbiBtX293bmVycy4KICAgIC8vIFRPRE8gZ2l2ZW4gdGhhdCBpdHMgY2FsbGVkIGFmdGVyIGVhY2ggcmVtb3ZhbCwgaXQgY291bGQgYmUgc2ltcGxpZmllZC4KICAgIGZ1bmN0aW9uIHJlb3JnYW5pemVPd25lcnMoKSBwcml2YXRlIHsKICAgICAgICB1aW50IGZyZWUgPSAxOwogICAgICAgIHdoaWxlIChmcmVlIDwgbV9udW1Pd25lcnMpCiAgICAgICAgewogICAgICAgICAgICAvLyBpdGVyYXRpbmcgdG8gdGhlIGZpcnN0IGZyZWUgc2xvdCBmcm9tIHRoZSBiZWdpbm5pbmcKICAgICAgICAgICAgd2hpbGUgKGZyZWUgPCBtX251bU93bmVycyAmJiBtX293bmVyc1tmcmVlXSAhPSAwKSBmcmVlKys7CgogICAgICAgICAgICAvLyBpdGVyYXRpbmcgdG8gdGhlIGZpcnN0IG9jY3VwaWVkIHNsb3QgZnJvbSB0aGUgZW5kCiAgICAgICAgICAgIHdoaWxlIChtX251bU93bmVycyA+IDEgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdID09IDApIG1fbnVtT3duZXJzLS07CgogICAgICAgICAgICAvLyBzd2FwLCBpZiBwb3NzaWJsZSwgc28gZnJlZSBzbG90IGlzIGxvY2F0ZWQgYXQgdGhlIGVuZCBhZnRlciB0aGUgc3dhcAogICAgICAgICAgICBpZiAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW21fbnVtT3duZXJzXSAhPSAwICYmIG1fb3duZXJzW2ZyZWVdID09IDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIG93bmVycyBiZXR3ZWVuIHN3YXBwZWQgc2xvdHMgc2hvdWxkJ3QgYmUgcmVudW1iZXJlZCAtIHRoYXQgc2F2ZXMgYSBsb3Qgb2YgZ2FzCiAgICAgICAgICAgICAgICBtX293bmVyc1tmcmVlXSA9IG1fb3duZXJzW21fbnVtT3duZXJzXTsKICAgICAgICAgICAgICAgIG1fb3duZXJJbmRleFttX293bmVyc1tmcmVlXV0gPSBmcmVlOwogICAgICAgICAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjbGVhclBlbmRpbmcoKSBwcml2YXRlIG9ubHlvd25lciB7CiAgICAgICAgdWludCBsZW5ndGggPSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbaV0gIT0gMCkKICAgICAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nW21fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtpXV07CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tPd25lckluZGV4KHVpbnQgb3duZXJJbmRleCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgYXNzZXJ0KDAgIT0gb3duZXJJbmRleCAmJiBvd25lckluZGV4IDw9IGNfbWF4T3duZXJzKTsKICAgICAgICByZXR1cm4gb3duZXJJbmRleDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlT3duZXJCaXRtYXBCaXQoYWRkcmVzcyBvd25lcikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtvd25lcl0pOwogICAgICAgIHJldHVybiAyICoqIG93bmVySW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gaXNPcGVyYXRpb25BY3RpdmUoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gMCAhPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLnlldE5lZWRlZDsKICAgIH0KCgogICAgZnVuY3Rpb24gYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpIHByaXZhdGUgY29uc3RhbnQgewogICAgICAgIGFzc2VydChtX251bU93bmVycyA+IDApOwogICAgICAgIGFzc2VydChtX251bU93bmVycyA8PSBjX21heE93bmVycyk7CiAgICAgICAgYXNzZXJ0KG1fb3duZXJzWzBdID09IDApOwogICAgICAgIGFzc2VydCgwICE9IG1fbXVsdGlPd25lZFJlcXVpcmVkICYmIG1fbXVsdGlPd25lZFJlcXVpcmVkIDw9IG1fbnVtT3duZXJzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoYnl0ZXMzMiBfb3BlcmF0aW9uKSBwcml2YXRlIGNvbnN0YW50IHsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgYXNzZXJ0KDAgIT0gcGVuZGluZy55ZXROZWVkZWQpOwogICAgICAgIGFzc2VydChtX211bHRpT3duZWRQZW5kaW5nSW5kZXhbcGVuZGluZy5pbmRleF0gPT0gX29wZXJhdGlvbik7CiAgICAgICAgYXNzZXJ0KHBlbmRpbmcueWV0TmVlZGVkIDw9IG1fbXVsdGlPd25lZFJlcXVpcmVkKTsKICAgIH0KCgogICAJLy8gRklFTERTCgogICAgdWludCBjb25zdGFudCBjX21heE93bmVycyA9IDI1MDsKCiAgICAvLyB0aGUgbnVtYmVyIG9mIG93bmVycyB0aGF0IG11c3QgY29uZmlybSB0aGUgc2FtZSBvcGVyYXRpb24gYmVmb3JlIGl0IGlzIHJ1bi4KICAgIHVpbnQgcHVibGljIG1fbXVsdGlPd25lZFJlcXVpcmVkOwoKCiAgICAvLyBwb2ludGVyIHVzZWQgdG8gZmluZCBhIGZyZWUgc2xvdCBpbiBtX293bmVycwogICAgdWludCBwdWJsaWMgbV9udW1Pd25lcnM7CgogICAgLy8gbGlzdCBvZiBvd25lcnMgKGFkZHJlc3NlcyksCiAgICAvLyBzbG90IDAgaXMgdW51c2VkIHNvIHRoZXJlIGFyZSBubyBvd25lciB3aGljaCBpbmRleCBpcyAwLgogICAgLy8gVE9ETyBjb3VsZCB3ZSBzYXZlIHNwYWNlIGF0IHRoZSBlbmQgb2YgdGhlIGFycmF5IGZvciB0aGUgY29tbW9uIGNhc2Ugb2YgPDEwIG93bmVycz8gYW5kIHNob3VsZCB3ZT8KICAgIGFkZHJlc3NbMjU2XSBpbnRlcm5hbCBtX293bmVyczsKCiAgICAvLyBpbmRleCBvbiB0aGUgbGlzdCBvZiBvd25lcnMgdG8gYWxsb3cgcmV2ZXJzZSBsb29rdXA6IG93bmVyIGFkZHJlc3MgPT4gaW5kZXggaW4gbV9vd25lcnMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBpbnRlcm5hbCBtX293bmVySW5kZXg7CgoKICAgIC8vIHRoZSBvbmdvaW5nIG9wZXJhdGlvbnMuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gTXVsdGlPd25lZE9wZXJhdGlvblBlbmRpbmdTdGF0ZSkgaW50ZXJuYWwgbV9tdWx0aU93bmVkUGVuZGluZzsKICAgIGJ5dGVzMzJbXSBpbnRlcm5hbCBtX211bHRpT3duZWRQZW5kaW5nSW5kZXg7Cn0KCgovKioKICogQHRpdGxlIENvbnRyYWN0IHdoaWNoIGlzIG93bmVkIGJ5IG93bmVycyBhbmQgb3BlcmF0ZWQgYnkgY29udHJvbGxlci4KICoKICogQG5vdGljZSBQcm92aWRlcyBhIHdheSB0byBzZXQgdXAgYW4gZW50aXR5ICh0eXBpY2FsbHkgb3RoZXIgY29udHJhY3QpIGVudGl0bGVkIHRvIGNvbnRyb2wgYWN0aW9ucyBvZiB0aGlzIGNvbnRyYWN0LgogKiBDb250cm9sbGVyIGlzIHNldCB1cCBieSBvd25lcnMgb3IgZHVyaW5nIGNvbnN0cnVjdGlvbi4KICoKICogQGRldiBjb250cm9sbGVyIGNoZWNrIGlzIHBlcmZvcm1lZCBieSBvbmx5Q29udHJvbGxlciBtb2RpZmllci4KICovCmNvbnRyYWN0IE11bHRpb3duZWRDb250cm9sbGVkIGlzIG11bHRpb3duZWQgewoKICAgIGV2ZW50IENvbnRyb2xsZXJTZXQoYWRkcmVzcyBjb250cm9sbGVyKTsKICAgIGV2ZW50IENvbnRyb2xsZXJSZXRpcmVkKGFkZHJlc3Mgd2FzKTsKCgogICAgbW9kaWZpZXIgb25seUNvbnRyb2xsZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBtX2NvbnRyb2xsZXIpOwogICAgICAgIF87CiAgICB9CgoKICAgIC8vIFBVQkxJQyBpbnRlcmZhY2UKCiAgICBmdW5jdGlvbiBNdWx0aW93bmVkQ29udHJvbGxlZChhZGRyZXNzW10gX293bmVycywgdWludCBfc2lnbmF0dXJlc1JlcXVpcmVkLCBhZGRyZXNzIF9jb250cm9sbGVyKQogICAgICAgIG11bHRpb3duZWQoX293bmVycywgX3NpZ25hdHVyZXNSZXF1aXJlZCkKICAgIHsKICAgICAgICBtX2NvbnRyb2xsZXIgPSBfY29udHJvbGxlcjsKICAgICAgICBDb250cm9sbGVyU2V0KG1fY29udHJvbGxlcik7CiAgICB9CgogICAgLy8vIEBub3RpY2Ugc2V0cyB0aGUgY29udHJvbGxlcgogICAgZnVuY3Rpb24gc2V0Q29udHJvbGxlcihhZGRyZXNzIF9jb250cm9sbGVyKSBleHRlcm5hbCBvbmx5bWFueW93bmVycyhzaGEzKG1zZy5kYXRhKSkgewogICAgICAgIG1fY29udHJvbGxlciA9IF9jb250cm9sbGVyOwogICAgICAgIENvbnRyb2xsZXJTZXQobV9jb250cm9sbGVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBhYmlsaXR5IGZvciBjb250cm9sbGVyIHRvIHN0ZXAgZG93bgogICAgZnVuY3Rpb24gZGV0YWNoQ29udHJvbGxlcigpIGV4dGVybmFsIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBhZGRyZXNzIHdhcyA9IG1fY29udHJvbGxlcjsKICAgICAgICBtX2NvbnRyb2xsZXIgPSBhZGRyZXNzKDApOwogICAgICAgIENvbnRyb2xsZXJSZXRpcmVkKHdhcyk7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIGFkZHJlc3Mgb2YgZW50aXR5IGVudGl0bGVkIHRvIG1pbnQgbmV3IHRva2VucwogICAgYWRkcmVzcyBwdWJsaWMgbV9jb250cm9sbGVyOwp9CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGEgPT0gMCB8fCBjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBIZWxwcyBjb250cmFjdHMgZ3VhcmQgYWdhaW5zIHJlbnRyYW5jeSBhdHRhY2tzLgogKiBAYXV0aG9yIFJlbWNvIEJsb2VtZW4gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIyMDUyNDU0ZDQzNGY2MDEyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPs+ALmNvbT4KICogQG5vdGljZSBJZiB5b3UgbWFyayBhIGZ1bmN0aW9uIGBub25SZWVudHJhbnRgLCB5b3Ugc2hvdWxkIGFsc28KICogbWFyayBpdCBgZXh0ZXJuYWxgLgogKi8KY29udHJhY3QgUmVlbnRyYW5jeUd1YXJkIHsKCiAgLyoqCiAgICogQGRldiBXZSB1c2UgYSBzaW5nbGUgbG9jayBmb3IgdGhlIHdob2xlIGNvbnRyYWN0LgogICAqLwogIGJvb2wgcHJpdmF0ZSByZW50cmFuY3lfbG9jayA9IGZhbHNlOwoKICAvKioKICAgKiBAZGV2IFByZXZlbnRzIGEgY29udHJhY3QgZnJvbSBjYWxsaW5nIGl0c2VsZiwgZGlyZWN0bHkgb3IgaW5kaXJlY3RseS4KICAgKiBAbm90aWNlIElmIHlvdSBtYXJrIGEgZnVuY3Rpb24gYG5vblJlZW50cmFudGAsIHlvdSBzaG91bGQgYWxzbwogICAqIG1hcmsgaXQgYGV4dGVybmFsYC4gQ2FsbGluZyBvbmUgbm9uUmVlbnRyYW50IGZ1bmN0aW9uIGZyb20KICAgKiBhbm90aGVyIGlzIG5vdCBzdXBwb3J0ZWQuIEluc3RlYWQsIHlvdSBjYW4gaW1wbGVtZW50IGEKICAgKiBgcHJpdmF0ZWAgZnVuY3Rpb24gZG9pbmcgdGhlIGFjdHVhbCB3b3JrLCBhbmQgYSBgZXh0ZXJuYWxgCiAgICogd3JhcHBlciBtYXJrZWQgYXMgYG5vblJlZW50cmFudGAuCiAgICovCiAgbW9kaWZpZXIgbm9uUmVlbnRyYW50KCkgewogICAgcmVxdWlyZSghcmVudHJhbmN5X2xvY2spOwogICAgcmVudHJhbmN5X2xvY2sgPSB0cnVlOwogICAgXzsKICAgIHJlbnRyYW5jeV9sb2NrID0gZmFsc2U7CiAgfQoKfQoKCgovLy8gQHRpdGxlIHJlZ2lzdHJ5IG9mIGZ1bmRzIHNlbnQgYnkgaW52ZXN0b3JzCmNvbnRyYWN0IEZ1bmRzUmVnaXN0cnkgaXMgTXVsdGlvd25lZENvbnRyb2xsZWQsIFJlZW50cmFuY3lHdWFyZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBlbnVtIFN0YXRlIHsKICAgICAgICAvLyBnYXRoZXJpbmcgZnVuZHMKICAgICAgICBHQVRIRVJJTkcsCiAgICAgICAgLy8gcmV0dXJuaW5nIGZ1bmRzIHRvIGludmVzdG9ycwogICAgICAgIFJFRlVORElORywKICAgICAgICAvLyBmdW5kcyBjYW4gYmUgcHVsbGVkIGJ5IG93bmVycwogICAgICAgIFNVQ0NFRURFRAogICAgfQoKICAgIGV2ZW50IFN0YXRlQ2hhbmdlZChTdGF0ZSBfc3RhdGUpOwogICAgZXZlbnQgSW52ZXN0ZWQoYWRkcmVzcyBpbmRleGVkIGludmVzdG9yLCB1aW50MjU2IGFtb3VudCk7CiAgICBldmVudCBFdGhlclNlbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKICAgIGV2ZW50IFJlZnVuZFNlbnQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlKTsKCgogICAgbW9kaWZpZXIgcmVxdWlyZXNTdGF0ZShTdGF0ZSBfc3RhdGUpIHsKICAgICAgICByZXF1aXJlKG1fc3RhdGUgPT0gX3N0YXRlKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBQVUJMSUMgaW50ZXJmYWNlCgogICAgZnVuY3Rpb24gRnVuZHNSZWdpc3RyeShhZGRyZXNzW10gX293bmVycywgdWludCBfc2lnbmF0dXJlc1JlcXVpcmVkLCBhZGRyZXNzIF9jb250cm9sbGVyKQogICAgICAgIE11bHRpb3duZWRDb250cm9sbGVkKF9vd25lcnMsIF9zaWduYXR1cmVzUmVxdWlyZWQsIF9jb250cm9sbGVyKQogICAgewogICAgfQoKICAgIC8vLyBAZGV2IHBlcmZvcm1zIG9ubHkgYWxsb3dlZCBzdGF0ZSB0cmFuc2l0aW9ucwogICAgZnVuY3Rpb24gY2hhbmdlU3RhdGUoU3RhdGUgX25ld1N0YXRlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUNvbnRyb2xsZXIKICAgIHsKICAgICAgICBhc3NlcnQobV9zdGF0ZSAhPSBfbmV3U3RhdGUpOwoKICAgICAgICBpZiAoU3RhdGUuR0FUSEVSSU5HID09IG1fc3RhdGUpIHsgICBhc3NlcnQoU3RhdGUuUkVGVU5ESU5HID09IF9uZXdTdGF0ZSB8fCBTdGF0ZS5TVUNDRUVERUQgPT0gX25ld1N0YXRlKTsgfQogICAgICAgIGVsc2UgYXNzZXJ0KGZhbHNlKTsKCiAgICAgICAgbV9zdGF0ZSA9IF9uZXdTdGF0ZTsKICAgICAgICBTdGF0ZUNoYW5nZWQobV9zdGF0ZSk7CiAgICB9CgogICAgLy8vIEBkZXYgcmVjb3JkcyBhbiBpbnZlc3RtZW50CiAgICBmdW5jdGlvbiBpbnZlc3RlZChhZGRyZXNzIF9pbnZlc3RvcikKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgICAgICBvbmx5Q29udHJvbGxlcgogICAgICAgIHJlcXVpcmVzU3RhdGUoU3RhdGUuR0FUSEVSSU5HKQogICAgewogICAgICAgIHVpbnQyNTYgYW1vdW50ID0gbXNnLnZhbHVlOwogICAgICAgIHJlcXVpcmUoMCAhPSBhbW91bnQpOwogICAgICAgIGFzc2VydChfaW52ZXN0b3IgIT0gbV9jb250cm9sbGVyKTsKCiAgICAgICAgLy8gcmVnaXN0ZXIgaW52ZXN0b3IKICAgICAgICBpZiAoMCA9PSBtX3dlaUJhbGFuY2VzW19pbnZlc3Rvcl0pCiAgICAgICAgICAgIG1faW52ZXN0b3JzLnB1c2goX2ludmVzdG9yKTsKCiAgICAgICAgLy8gcmVnaXN0ZXIgcGF5bWVudAogICAgICAgIHRvdGFsSW52ZXN0ZWQgPSB0b3RhbEludmVzdGVkLmFkZChhbW91bnQpOwogICAgICAgIG1fd2VpQmFsYW5jZXNbX2ludmVzdG9yXSA9IG1fd2VpQmFsYW5jZXNbX2ludmVzdG9yXS5hZGQoYW1vdW50KTsKCiAgICAgICAgSW52ZXN0ZWQoX2ludmVzdG9yLCBhbW91bnQpOwogICAgfQoKICAgIC8vLyBAZGV2IFNlbmQgYHZhbHVlYCBvZiBldGhlciB0byBhZGRyZXNzIGB0b2AKICAgIGZ1bmN0aW9uIHNlbmRFdGhlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seW1hbnlvd25lcnMoc2hhMyhtc2cuZGF0YSkpCiAgICAgICAgcmVxdWlyZXNTdGF0ZShTdGF0ZS5TVUNDRUVERUQpCiAgICB7CiAgICAgICAgcmVxdWlyZSgwICE9IHRvKTsKICAgICAgICByZXF1aXJlKHZhbHVlID4gMCAmJiB0aGlzLmJhbGFuY2UgPj0gdmFsdWUpOwogICAgICAgIHRvLnRyYW5zZmVyKHZhbHVlKTsKICAgICAgICBFdGhlclNlbnQodG8sIHZhbHVlKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB3aXRoZHJhdyBhY2N1bXVsYXRlZCBiYWxhbmNlLCBjYWxsZWQgYnkgcGF5ZWUuCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BheW1lbnRzKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG5vblJlZW50cmFudAogICAgICAgIHJlcXVpcmVzU3RhdGUoU3RhdGUuUkVGVU5ESU5HKQogICAgewogICAgICAgIGFkZHJlc3MgcGF5ZWUgPSBtc2cuc2VuZGVyOwogICAgICAgIHVpbnQyNTYgcGF5bWVudCA9IG1fd2VpQmFsYW5jZXNbcGF5ZWVdOwoKICAgICAgICByZXF1aXJlKHBheW1lbnQgIT0gMCk7CiAgICAgICAgcmVxdWlyZSh0aGlzLmJhbGFuY2UgPj0gcGF5bWVudCk7CgogICAgICAgIHRvdGFsSW52ZXN0ZWQgPSB0b3RhbEludmVzdGVkLnN1YihwYXltZW50KTsKICAgICAgICBtX3dlaUJhbGFuY2VzW3BheWVlXSA9IDA7CgogICAgICAgIHBheWVlLnRyYW5zZmVyKHBheW1lbnQpOwogICAgICAgIFJlZnVuZFNlbnQocGF5ZWUsIHBheW1lbnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEludmVzdG9yc0NvdW50KCkgZXh0ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludCkgeyByZXR1cm4gbV9pbnZlc3RvcnMubGVuZ3RoOyB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIHRvdGFsIGFtb3VudCBvZiBpbnZlc3RtZW50cyBpbiB3ZWkKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsSW52ZXN0ZWQ7CgogICAgLy8vIEBub3RpY2Ugc3RhdGUgb2YgdGhlIHJlZ2lzdHJ5CiAgICBTdGF0ZSBwdWJsaWMgbV9zdGF0ZSA9IFN0YXRlLkdBVEhFUklORzsKCiAgICAvLy8gQGRldiBiYWxhbmNlcyBvZiBpbnZlc3RvcnMgaW4gd2VpCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG1fd2VpQmFsYW5jZXM7CgogICAgLy8vIEBkZXYgbGlzdCBvZiB1bmlxdWUgaW52ZXN0b3JzCiAgICBhZGRyZXNzW10gcHVibGljIG1faW52ZXN0b3JzOwp9'.
	

]
