Class {
	#name : #SRT75f3dfd3948500d2133d2f0af3ad153c176ec2c4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT75f3dfd3948500d2133d2f0af3ad153c176ec2c4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CgogIC8qKgogICogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCiAgKi8KICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBTdWJzdHJhY3RzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cgKGkuZS4gaWYgc3VidHJhaGVuZCBpcyBncmVhdGVyIHRoYW4gbWludWVuZCkuCiAgKi8KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICAvKioKICAqIEBkZXYgQWRkcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCgogIGV2ZW50IE93bmVyc2hpcFRyYW5zZmVycmVkKGFkZHJlc3MgaW5kZXhlZCBwcmV2aW91c093bmVyLCBhZGRyZXNzIGluZGV4ZWQgbmV3T3duZXIpOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgoKaW50ZXJmYWNlIGl0b2tlbiB7CiAgICAvLyBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBmcm96ZW5BY2NvdW50OwogICAgZnVuY3Rpb24gZnJlZXplQWNjb3VudChhZGRyZXNzIF90YXJnZXQsIGJvb2wgX2ZyZWV6ZSkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nik7Cn0KCmNvbnRyYWN0IE93bmVyQ29udHJhY3QgaXMgT3duYWJsZSB7CiAgICBpdG9rZW4gcHVibGljIG93bmVkOwogICAgCiAgICAvKioKICAgICAqIEBkZXYgYmluZCBhIGNvbnRyYWN0IGFzIGl0cyBvd25lcgogICAgICoKICAgICAqIEBwYXJhbSBfY29udHJhY3QgdGhlIGNvbnRyYWN0IGFkZHJlc3MgdGhhdCB3aWxsIGJlIGJpbmRlZCBieSB0aGlzIE93bmVyIENvbnRyYWN0CiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldENvbnRyYWN0KGFkZHJlc3MgX2NvbnRyYWN0KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9jb250cmFjdCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBvd25lZCA9IGl0b2tlbihfY29udHJhY3QpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBjaGFuZ2UgdGhlIG93bmVyIG9mIHRoZSBjb250cmFjdCBmcm9tIHRoaXMgY29udHJhY3QgdG8gYW5vdGhlciAKICAgICAqCiAgICAgKiBAcGFyYW0gX25ld093bmVyIHRoZSBuZXcgY29udHJhY3QvYWNjb3VudCBhZGRyZXNzIHRoYXQgd2lsbCBiZSB0aGUgbmV3IG93bmVyCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyYWN0T3duZXIoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmVxdWlyZShfbmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgb3duZWQudHJhbnNmZXJPd25lcnNoaXAoX25ld093bmVyKTsKICAgICAgICBvd25lZCA9IGl0b2tlbihhZGRyZXNzKDApKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKY29udHJhY3QgUmVsZWFzZVRva2VuIGlzIE93bmVyQ29udHJhY3QgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgLy8gcmVjb3JkIGxvY2sgdGltZSBwZXJpb2QgYW5kIHJlbGF0ZWQgdG9rZW4gYW1vdW50CiAgICBzdHJ1Y3QgVGltZVJlYyB7CiAgICAgICAgdWludDI1NiBhbW91bnQ7CiAgICAgICAgdWludDI1NiByZW1haW47CiAgICAgICAgdWludDI1NiBlbmRUaW1lOwogICAgICAgIHVpbnQyNTYgZHVyYXRpb247CiAgICB9CgogICAgYWRkcmVzc1tdIHB1YmxpYyBmcm96ZW5BY2NvdW50czsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gVGltZVJlY1tdKSBmcm96ZW5UaW1lczsKICAgIC8vIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcmVsZWFzZWRBbW91bnRzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwcmVSZWxlYXNlQW1vdW50czsKCiAgICBldmVudCBSZWxlYXNlRnVuZHMoYWRkcmVzcyBfdGFyZ2V0LCB1aW50MjU2IF9hbW91bnQpOwoKICAgIGZ1bmN0aW9uIHJlbW92ZUFjY291bnQodWludCBfaW5kKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfaW5kID49IDApOwogICAgICAgIHJlcXVpcmUoX2luZCA8IGZyb3plbkFjY291bnRzLmxlbmd0aCk7CgogICAgICAgIC8vaWYgKF9pbmQgPj0gZnJvemVuQWNjb3VudHMubGVuZ3RoKSB7CiAgICAgICAgLy8gICAgcmV0dXJuIGZhbHNlOwogICAgICAgIC8vfQoKICAgICAgICB1aW50MjU2IGkgPSBfaW5kOwogICAgICAgIHdoaWxlIChpIDwgZnJvemVuQWNjb3VudHMubGVuZ3RoLnN1YigxKSkgewogICAgICAgICAgICBmcm96ZW5BY2NvdW50c1tpXSA9IGZyb3plbkFjY291bnRzW2kuYWRkKDEpXTsKICAgICAgICAgICAgaSA9IGkuYWRkKDEpOwogICAgICAgIH0KCiAgICAgICAgZnJvemVuQWNjb3VudHMubGVuZ3RoID0gZnJvemVuQWNjb3VudHMubGVuZ3RoLnN1YigxKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVMb2NrZWRUaW1lKGFkZHJlc3MgX3RhcmdldCwgdWludCBfaW5kKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfaW5kID49IDApOwogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgVGltZVJlY1tdIHN0b3JhZ2UgbG9ja2VkVGltZXMgPSBmcm96ZW5UaW1lc1tfdGFyZ2V0XTsKICAgICAgICByZXF1aXJlKF9pbmQgPCBsb2NrZWRUaW1lcy5sZW5ndGgpOwogICAgICAgIC8vaWYgKF9pbmQgPj0gbG9ja2VkVGltZXMubGVuZ3RoKSB7CiAgICAgICAgLy8gICAgcmV0dXJuIGZhbHNlOwogICAgICAgIC8vfQoKICAgICAgICB1aW50MjU2IGkgPSBfaW5kOwogICAgICAgIHdoaWxlIChpIDwgbG9ja2VkVGltZXMubGVuZ3RoLnN1YigxKSkgewogICAgICAgICAgICBsb2NrZWRUaW1lc1tpXSA9IGxvY2tlZFRpbWVzW2kuYWRkKDEpXTsKICAgICAgICAgICAgaSA9IGkuYWRkKDEpOwogICAgICAgIH0KCiAgICAgICAgbG9ja2VkVGltZXMubGVuZ3RoID0gbG9ja2VkVGltZXMubGVuZ3RoLnN1YigxKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgZ2V0IHRvdGFsIHJlbWFpbiBsb2NrZWQgdG9rZW5zIG9mIGFuIGFjY291bnQKICAgICAqCiAgICAgKiBAcGFyYW0gX2FjY291bnQgdGhlIG93bmVyIG9mIHNvbWUgYW1vdW50IG9mIHRva2VucwogICAgICovCiAgICBmdW5jdGlvbiBnZXRSZW1haW5Mb2NrZWRPZihhZGRyZXNzIF9hY2NvdW50KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShfYWNjb3VudCAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgdWludDI1NiB0b3RhbFJlbWFpbiA9IDA7CiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIGZyb3plbkFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgaWYgKGZyb3plbkFkZHIgPT0gX2FjY291bnQpIHsKICAgICAgICAgICAgICAgIHVpbnQyNTYgdGltZVJlY0xlbiA9IGZyb3plblRpbWVzW2Zyb3plbkFkZHJdLmxlbmd0aDsKICAgICAgICAgICAgICAgIHVpbnQyNTYgaiA9IDA7CiAgICAgICAgICAgICAgICB3aGlsZSAoaiA8IHRpbWVSZWNMZW4pIHsKICAgICAgICAgICAgICAgICAgICBUaW1lUmVjIHN0b3JhZ2UgdGltZVBhaXIgPSBmcm96ZW5UaW1lc1tmcm96ZW5BZGRyXVtqXTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFJlbWFpbiA9IHRvdGFsUmVtYWluLmFkZCh0aW1lUGFpci5yZW1haW4pOwoKICAgICAgICAgICAgICAgICAgICBqID0gai5hZGQoMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGkgPSBpLmFkZCgxKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3RhbFJlbWFpbjsKICAgIH0KCiAgICAvKioKICAgICAqIGp1ZGdlIHdoZXRoZXIgd2UgbmVlZCB0byByZWxlYXNlIHNvbWUgb2YgdGhlIGxvY2tlZCB0b2tlbgogICAgICoKICAgICAqLwogICAgZnVuY3Rpb24gbmVlZFJlbGVhc2UoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludDI1NiBsZW4gPSBmcm96ZW5BY2NvdW50cy5sZW5ndGg7CiAgICAgICAgdWludDI1NiBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhZGRyZXNzIGZyb3plbkFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgdWludDI1NiB0aW1lUmVjTGVuID0gZnJvemVuVGltZXNbZnJvemVuQWRkcl0ubGVuZ3RoOwogICAgICAgICAgICB1aW50MjU2IGogPSAwOwogICAgICAgICAgICB3aGlsZSAoaiA8IHRpbWVSZWNMZW4pIHsKICAgICAgICAgICAgICAgIFRpbWVSZWMgc3RvcmFnZSB0aW1lUGFpciA9IGZyb3plblRpbWVzW2Zyb3plbkFkZHJdW2pdOwogICAgICAgICAgICAgICAgaWYgKG5vdyA+PSB0aW1lUGFpci5lbmRUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaiA9IGouYWRkKDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IGZyZWV6ZSB0aGUgYW1vdW50IG9mIHRva2VucyBvZiBhbiBhY2NvdW50CiAgICAgKgogICAgICogQHBhcmFtIF90YXJnZXQgdGhlIG93bmVyIG9mIHNvbWUgYW1vdW50IG9mIHRva2VucwogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IG9mIHRoZSB0b2tlbnMKICAgICAqIEBwYXJhbSBfZnJvemVuRW5kVGltZSB0aGUgZW5kIHRpbWUgb2YgdGhlIGxvY2sgcGVyaW9kLCB1bml0IGlzIHNlY29uZAogICAgICogQHBhcmFtIF9yZWxlYXNlUGVyaW9kIHRoZSBsb2NraW5nIHBlcmlvZCwgdW5pdCBpcyBzZWNvbmQKICAgICAqLwogICAgZnVuY3Rpb24gZnJlZXplKGFkZHJlc3MgX3RhcmdldCwgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2Zyb3plbkVuZFRpbWUsIHVpbnQyNTYgX3JlbGVhc2VQZXJpb2QpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vcmVxdWlyZShfdG9rZW5BZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+IDApOwogICAgICAgIHJlcXVpcmUoX2Zyb3plbkVuZFRpbWUgPiAwICYmIF9yZWxlYXNlUGVyaW9kID49IDApOwoKICAgICAgICB1aW50MjU2IGxlbiA9IGZyb3plbkFjY291bnRzLmxlbmd0aDsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBsZW47IGkgPSBpLmFkZCgxKSkgewogICAgICAgICAgICBpZiAoZnJvemVuQWNjb3VudHNbaV0gPT0gX3RhcmdldCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIGlmIChpID49IGxlbikgewogICAgICAgICAgICBmcm96ZW5BY2NvdW50cy5wdXNoKF90YXJnZXQpOyAvLyBhZGQgbmV3IGFjY291bnQKCiAgICAgICAgICAgIC8vZnJvemVuVGltZXNbX3RhcmdldF0ucHVzaChUaW1lUmVjKF92YWx1ZSwgX3ZhbHVlLCBfZnJvemVuRW5kVGltZSwgX3JlbGVhc2VQZXJpb2QpKQogICAgICAgIH0gLyogZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTYgdGltZUFycmF5TGVuID0gZnJvemVuVGltZXNbX3RhcmdldF0ubGVuZ3RoOwogICAgICAgICAgICB1aW50MjU2IGogPSAwOwogICAgICAgICAgICB3aGlsZSAoaiA8IHRpbWVBcnJheUxlbikgewogICAgICAgICAgICAgICAgVGltZVJlYyBzdG9yYWdlIGxhc3RUaW1lID0gZnJvemVuVGltZXNbX3RhcmdldF1bal07CiAgICAgICAgICAgICAgICBpZiAobGFzdFRpbWUuYW1vdW50ID09IDAgJiYgbGFzdFRpbWUucmVtYWluID09IDAgJiYgbGFzdFRpbWUuZW5kVGltZSA9PSAwICYmIGxhc3RUaW1lLmR1cmF0aW9uID09IDApIHsKICAgICAgICAgICAgICAgICAgICBsYXN0VGltZS5hbW91bnQgPSBfdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgbGFzdFRpbWUucmVtYWluID0gX3ZhbHVlOwogICAgICAgICAgICAgICAgICAgIGxhc3RUaW1lLmVuZFRpbWUgPSBfZnJvemVuRW5kVGltZTsKICAgICAgICAgICAgICAgICAgICBsYXN0VGltZS5kdXJhdGlvbiA9IF9yZWxlYXNlUGVyaW9kOyAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBqID0gai5hZGQoMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChqID49IHRpbWVBcnJheUxlbikgewogICAgICAgICAgICAgICAgZnJvemVuVGltZXNbX3RhcmdldF0ucHVzaChUaW1lUmVjKF92YWx1ZSwgX3ZhbHVlLCBfZnJvemVuRW5kVGltZSwgX3JlbGVhc2VQZXJpb2QpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gKi8KCiAgICAgICAgLy8gZnJvemVuVGltZXNbX3RhcmdldF0gPSBfZnJvemVuRW5kVGltZTsKICAgICAgICAKICAgICAgICAvLyBlYWNoIHRpbWUgdGhlIG5ldyBsb2NrZWQgdGltZSB3aWxsIGJlIGFkZGVkIHRvIHRoZSBiYWNrZW5kCiAgICAgICAgZnJvemVuVGltZXNbX3RhcmdldF0ucHVzaChUaW1lUmVjKF92YWx1ZSwgX3ZhbHVlLCBfZnJvemVuRW5kVGltZSwgX3JlbGVhc2VQZXJpb2QpKTsKICAgICAgICBvd25lZC5mcmVlemVBY2NvdW50KF90YXJnZXQsIHRydWUpOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiB0cmFuc2ZlciBhbiBhbW91bnQgb2YgdG9rZW5zIHRvIGFuIGFjY291bnQsIGFuZCB0aGVuIGZyZWV6ZSB0aGUgdG9rZW5zCiAgICAgKgogICAgICogQHBhcmFtIF90YXJnZXQgdGhlIGFjY291bnQgYWRkcmVzcyB0aGF0IHdpbGwgaG9sZCBhbiBhbW91bnQgb2YgdGhlIHRva2VucwogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IG9mIHRoZSB0b2tlbnMgd2hpY2ggaGFzIGJlZW4gdHJhbnNmZXJyZWQKICAgICAqIEBwYXJhbSBfZnJvemVuRW5kVGltZSB0aGUgZW5kIHRpbWUgb2YgdGhlIGxvY2sgcGVyaW9kLCB1bml0IGlzIHNlY29uZAogICAgICogQHBhcmFtIF9yZWxlYXNlUGVyaW9kIHRoZSBsb2NraW5nIHBlcmlvZCwgdW5pdCBpcyBzZWNvbmQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJBbmRGcmVlemUoLyphZGRyZXNzIF90b2tlbk93bmVyLCAqL2FkZHJlc3MgX3RhcmdldCwgdWludDI1NiBfdmFsdWUsIHVpbnQyNTYgX2Zyb3plbkVuZFRpbWUsIHVpbnQyNTYgX3JlbGVhc2VQZXJpb2QpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vcmVxdWlyZShfdG9rZW5Pd25lciAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF90YXJnZXQgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPiAwKTsKICAgICAgICByZXF1aXJlKF9mcm96ZW5FbmRUaW1lID4gMCAmJiBfcmVsZWFzZVBlcmlvZCA+PSAwKTsKCiAgICAgICAgLy8gY2hlY2sgZmlyc3RseSB0aGF0IHRoZSBhbGxvd2FuY2Ugb2YgdGhpcyBjb250cmFjdCBoYXMgYmVlbiBzZXQKICAgICAgICBhc3NlcnQob3duZWQuYWxsb3dhbmNlKG1zZy5zZW5kZXIsIHRoaXMpID4gMCk7CgogICAgICAgIC8vIGZyZWV6ZSB0aGUgYWNjb3VudCBhdCBmaXJzdAogICAgICAgIGlmICghZnJlZXplKF90YXJnZXQsIF92YWx1ZSwgX2Zyb3plbkVuZFRpbWUsIF9yZWxlYXNlUGVyaW9kKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKG93bmVkLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBfdGFyZ2V0LCBfdmFsdWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIHJlbGVhc2UgdGhlIHRva2VuIHdoaWNoIGFyZSBsb2NrZWQgZm9yIG9uY2UgYW5kIHdpbGwgYmUgdG90YWwgcmVsZWFzZWQgYXQgb25jZSAKICAgICAqIGFmdGVyIHRoZSBlbmQgcG9pbnQgb2YgdGhlIGxvY2sgcGVyaW9kCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VBbGxPbmNlTG9jaygpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vcmVxdWlyZShfdG9rZW5BZGRyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB1aW50MjU2IGxlbiA9IGZyb3plbkFjY291bnRzLmxlbmd0aDsKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgICAgICAgIGFkZHJlc3MgdGFyZ2V0ID0gZnJvemVuQWNjb3VudHNbaV07CiAgICAgICAgICAgIGlmIChmcm96ZW5UaW1lc1t0YXJnZXRdLmxlbmd0aCA9PSAxICYmIDAgPT0gZnJvemVuVGltZXNbdGFyZ2V0XVswXS5kdXJhdGlvbiAmJiBmcm96ZW5UaW1lc1t0YXJnZXRdWzBdLmVuZFRpbWUgPiAwICYmIG5vdyA+PSBmcm96ZW5UaW1lc1t0YXJnZXRdWzBdLmVuZFRpbWUpIHsKICAgICAgICAgICAgICAgIGJvb2wgcmVzID0gcmVtb3ZlQWNjb3VudChpKTsKICAgICAgICAgICAgICAgIGlmICghcmVzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBvd25lZC5mcmVlemVBY2NvdW50KHRhcmdldCwgZmFsc2UpOwogICAgICAgICAgICAgICAgLy9mcm96ZW5UaW1lc1tkZXN0QWRkcl1bMF0uZW5kVGltZSA9IDA7CiAgICAgICAgICAgICAgICAvL2Zyb3plblRpbWVzW2Rlc3RBZGRyXVswXS5kdXJhdGlvbiA9IDA7CiAgICAgICAgICAgICAgICBSZWxlYXNlRnVuZHModGFyZ2V0LCBmcm96ZW5UaW1lc1t0YXJnZXRdWzBdLmFtb3VudCk7CiAgICAgICAgICAgICAgICBsZW4gPSBsZW4uc3ViKDEpOwogICAgICAgICAgICAgICAgLy9mcm96ZW5UaW1lc1tkZXN0QWRkcl1bMF0uYW1vdW50ID0gMDsKICAgICAgICAgICAgICAgIC8vZnJvemVuVGltZXNbZGVzdEFkZHJdWzBdLnJlbWFpbiA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgLy8gbm8gYWNjb3VudCBoYXMgYmVlbiByZW1vdmVkCiAgICAgICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgLy9yZXR1cm4gKHJlbGVhc2VNdWx0aUFjY291bnRzKGZyb3plbkFjY291bnRzKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHJlbGVhc2UgdGhlIGxvY2tlZCB0b2tlbnMgb3duZWQgYnkgYW4gYWNjb3VudCwgd2hpY2ggb25seSBoYXZlIG9ubHkgb25lIGxvY2tlZCB0aW1lCiAgICAgKiBhbmQgZG9uJ3QgaGF2ZSByZWxlYXNlIHN0YWdlLgogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0IHRoZSBhY2NvdW50IGFkZHJlc3MgdGhhdCBob2xkIGFuIGFtb3VudCBvZiBsb2NrZWQgdG9rZW5zCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VBY2NvdW50KGFkZHJlc3MgX3RhcmdldCkgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy9yZXF1aXJlKF90b2tlbkFkZHIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdGFyZ2V0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB1aW50MjU2IGxlbiA9IGZyb3plbkFjY291bnRzLmxlbmd0aDsKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgICAgICAgIGFkZHJlc3MgZGVzdEFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgaWYgKGRlc3RBZGRyID09IF90YXJnZXQpIHsKICAgICAgICAgICAgICAgIGlmIChmcm96ZW5UaW1lc1tkZXN0QWRkcl0ubGVuZ3RoID09IDEgJiYgMCA9PSBmcm96ZW5UaW1lc1tkZXN0QWRkcl1bMF0uZHVyYXRpb24gJiYgZnJvemVuVGltZXNbZGVzdEFkZHJdWzBdLmVuZFRpbWUgPiAwICYmIG5vdyA+PSBmcm96ZW5UaW1lc1tkZXN0QWRkcl1bMF0uZW5kVGltZSkgeyAKICAgICAgICAgICAgICAgICAgICBib29sIHJlcyA9IHJlbW92ZUFjY291bnQoaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgb3duZWQuZnJlZXplQWNjb3VudChkZXN0QWRkciwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIC8vIGZyb3plblRpbWVzW2Rlc3RBZGRyXVswXS5lbmRUaW1lID0gMDsKICAgICAgICAgICAgICAgICAgICAvLyBmcm96ZW5UaW1lc1tkZXN0QWRkcl1bMF0uZHVyYXRpb24gPSAwOwogICAgICAgICAgICAgICAgICAgIFJlbGVhc2VGdW5kcyhkZXN0QWRkciwgZnJvemVuVGltZXNbZGVzdEFkZHJdWzBdLmFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgLy8gZnJvemVuVGltZXNbZGVzdEFkZHJdWzBdLmFtb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgLy8gZnJvemVuVGltZXNbZGVzdEFkZHJdWzBdLnJlbWFpbiA9IDA7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBhY2NvdW50IGFyZSBub3QgbG9ja2VkIGZvciBvbmNlLCB3ZSB3aWxsIGRvIG5vdGhpbmcgaGVyZQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IAogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgcmVsZWFzZSB0aGUgbG9ja2VkIHRva2VucyBvd25lZCBieSBhIG51bWJlciBvZiBhY2NvdW50cwogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0cyB0aGUgYWNjb3VudHMgbGlzdCB0aGF0IGhvbGQgYW4gYW1vdW50IG9mIGxvY2tlZCB0b2tlbnMgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VNdWx0aUFjY291bnRzKGFkZHJlc3NbXSBfdGFyZ2V0cykgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgLy9yZXF1aXJlKF90b2tlbkFkZHIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdGFyZ2V0cy5sZW5ndGggIT0gMCk7CgogICAgICAgIHVpbnQyNTYgaSA9IDA7CiAgICAgICAgd2hpbGUgKGkgPCBfdGFyZ2V0cy5sZW5ndGgpIHsKICAgICAgICAgICAgaWYgKCFyZWxlYXNlQWNjb3VudChfdGFyZ2V0c1tpXSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaSA9IGkuYWRkKDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IHJlbGVhc2UgdGhlIGxvY2tlZCB0b2tlbnMgb3duZWQgYnkgYW4gYWNjb3VudCB3aXRoIHNldmVyYWwgc3RhZ2VzCiAgICAgKiB0aGlzIG5lZWQgdGhlIGNvbnRyYWN0IGdldCBhcHByb3ZhbCBmcm9tIHRoZSBhY2NvdW50IGJ5IGNhbGwgYXBwcm92ZSgpIGluIHRoZSB0b2tlbiBjb250cmFjdAogICAgICoKICAgICAqIEBwYXJhbSBfdGFyZ2V0IHRoZSBhY2NvdW50IGFkZHJlc3MgdGhhdCBob2xkIGFuIGFtb3VudCBvZiBsb2NrZWQgdG9rZW5zCiAgICAgKiBAcGFyYW0gX2Rlc3QgdGhlIHNlY29uZGFyeSBhZGRyZXNzIHRoYXQgd2lsbCBob2xkIHRoZSByZWxlYXNlZCB0b2tlbnMKICAgICAqLwogICAgZnVuY3Rpb24gcmVsZWFzZVdpdGhTdGFnZShhZGRyZXNzIF90YXJnZXQsIGFkZHJlc3MgX2Rlc3QpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vcmVxdWlyZShfdG9rZW5BZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3RhcmdldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKF9kZXN0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIHJlcXVpcmUoX3ZhbHVlID4gMCk7CiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgZmlyc3RseSB0aGF0IHRoZSBhbGxvd2FuY2Ugb2YgdGhpcyBjb250cmFjdCBmcm9tIF90YXJnZXQgYWNjb3VudCBoYXMgYmVlbiBzZXQKICAgICAgICBhc3NlcnQob3duZWQuYWxsb3dhbmNlKF90YXJnZXQsIHRoaXMpID4gMCk7CgogICAgICAgIHVpbnQyNTYgbGVuID0gZnJvemVuQWNjb3VudHMubGVuZ3RoOwogICAgICAgIHVpbnQyNTYgaSA9IDA7CiAgICAgICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgICAgICAgLy8gZmlyc3RseSBmaW5kIHRoZSB0YXJnZXQgYWRkcmVzcwogICAgICAgICAgICBhZGRyZXNzIGZyb3plbkFkZHIgPSBmcm96ZW5BY2NvdW50c1tpXTsKICAgICAgICAgICAgaWYgKGZyb3plbkFkZHIgPT0gX3RhcmdldCkgewogICAgICAgICAgICAgICAgdWludDI1NiB0aW1lUmVjTGVuID0gZnJvemVuVGltZXNbZnJvemVuQWRkcl0ubGVuZ3RoOwoKICAgICAgICAgICAgICAgIGJvb2wgcmVsZWFzZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGZvciAodWludDI1NiBqID0gMDsgaiA8IHRpbWVSZWNMZW47IHJlbGVhc2VkID0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpdGVyYXRlIGV2ZXJ5IHRpbWUgcmVjb3JkcyB0byBjYWN1bGF0ZSBob3cgbWFueSB0b2tlbnMgbmVlZCB0byBiZSByZWxlYXNlZC4KICAgICAgICAgICAgICAgICAgICBUaW1lUmVjIHN0b3JhZ2UgdGltZVBhaXIgPSBmcm96ZW5UaW1lc1tmcm96ZW5BZGRyXVtqXTsKICAgICAgICAgICAgICAgICAgICB1aW50MjU2IG5vd1RpbWUgPSBub3c7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vd1RpbWUgPiB0aW1lUGFpci5lbmRUaW1lICYmIHRpbWVQYWlyLmVuZFRpbWUgPiAwICYmIHRpbWVQYWlyLmR1cmF0aW9uID4gMCkgeyAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IHZhbHVlID0gdGltZVBhaXIuYW1vdW50ICogKG5vd1RpbWUgLSB0aW1lUGFpci5lbmRUaW1lKSAvIHRpbWVQYWlyLmR1cmF0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiB0aW1lUGFpci5yZW1haW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdGltZVBhaXIucmVtYWluOwogICAgICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3duZWQuZnJlZXplQWNjb3VudChmcm96ZW5BZGRyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lUGFpci5lbmRUaW1lID0gbm93VGltZTsgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lUGFpci5yZW1haW4gPSB0aW1lUGFpci5yZW1haW4uc3ViKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVQYWlyLnJlbWFpbiA8IDFlOCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZW1vdmVMb2NrZWRUaW1lKGZyb3plbkFkZHIsIGopKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVsZWFzZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVJlY0xlbiA9IHRpbWVSZWNMZW4uc3ViKDEpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmICghb3duZWQudHJhbnNmZXJGcm9tKF90YXJnZXQsIF9kZXN0LCB2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgICAgICAgICBSZWxlYXNlRnVuZHMoZnJvemVuQWRkciwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBwcmVSZWxlYXNlQW1vdW50c1tmcm96ZW5BZGRyXSA9IHByZVJlbGVhc2VBbW91bnRzW2Zyb3plbkFkZHJdLmFkZCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vb3duZWQuZnJlZXplQWNjb3VudChmcm96ZW5BZGRyLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5vd1RpbWUgPj0gdGltZVBhaXIuZW5kVGltZSAmJiB0aW1lUGFpci5lbmRUaW1lID4gMCAmJiB0aW1lUGFpci5kdXJhdGlvbiA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG93bmVkLmZyZWV6ZUFjY291bnQoZnJvemVuQWRkciwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZW1vdmVMb2NrZWRUaW1lKGZyb3plbkFkZHIsIGopKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmVsZWFzZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB0aW1lUmVjTGVuID0gdGltZVJlY0xlbi5zdWIoMSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiAoIW93bmVkLnRyYW5zZmVyRnJvbShfdGFyZ2V0LCBfZGVzdCwgdGltZVBhaXIuYW1vdW50KSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgICAgIFJlbGVhc2VGdW5kcyhmcm96ZW5BZGRyLCB0aW1lUGFpci5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBwcmVSZWxlYXNlQW1vdW50c1tmcm96ZW5BZGRyXSA9IHByZVJlbGVhc2VBbW91bnRzW2Zyb3plbkFkZHJdLmFkZCh0aW1lUGFpci5hbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICAvL293bmVkLmZyZWV6ZUFjY291bnQoZnJvemVuQWRkciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSAvL2Vsc2UgaWYgKHRpbWVQYWlyLmFtb3VudCA9PSAwICYmIHRpbWVQYWlyLnJlbWFpbiA9PSAwICYmIHRpbWVQYWlyLmVuZFRpbWUgPT0gMCAmJiB0aW1lUGFpci5kdXJhdGlvbiA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyAgcmVtb3ZlTG9ja2VkVGltZShmcm96ZW5BZGRyLCBqKTsKICAgICAgICAgICAgICAgICAgICAvL30KCiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZWxlYXNlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBqID0gai5hZGQoMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHdlIGdvdCBzb21lIGFtb3VudCBuZWVkIHRvIGJlIHJlbGVhc2VkCiAgICAgICAgICAgICAgICBpZiAocHJlUmVsZWFzZUFtb3VudHNbZnJvemVuQWRkcl0gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgb3duZWQuZnJlZXplQWNjb3VudChmcm96ZW5BZGRyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvd25lZC50cmFuc2ZlckZyb20oX3RhcmdldCwgX2Rlc3QsIHByZVJlbGVhc2VBbW91bnRzW2Zyb3plbkFkZHJdKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGlmIGFsbCB0aGUgZnJvemVuIGFtb3VudHMgaGFkIGJlZW4gcmVsZWFzZWQsIHRoZW4gdW5sb2NrIHRoZSBhY2NvdW50IGZpbmFsbHkKICAgICAgICAgICAgICAgIGlmIChmcm96ZW5UaW1lc1tmcm96ZW5BZGRyXS5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICghcmVtb3ZlQWNjb3VudChpKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGhhcyBzb21lIHRva2VucyBuZWVkIHRvIGJlIHJlbGVhc2VkIGluIGZ1dHVyZQogICAgICAgICAgICAgICAgICAgIG93bmVkLmZyZWV6ZUFjY291bnQoZnJvemVuQWRkciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gICAgICAgICAgCgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgcmVsZWFzZSB0aGUgbG9ja2VkIHRva2VucyBvd25lZCBieSBhbiBhY2NvdW50CiAgICAgKgogICAgICogQHBhcmFtIF90YXJnZXRzIHRoZSBhY2NvdW50IGFkZHJlc3NlcyBsaXN0IHRoYXQgaG9sZCBhbW91bnRzIG9mIGxvY2tlZCB0b2tlbnMKICAgICAqIEBwYXJhbSBfZGVzdHMgdGhlIHNlY29uZGFyeSBhZGRyZXNzZXMgbGlzdCB0aGF0IHdpbGwgaG9sZCB0aGUgcmVsZWFzZWQgdG9rZW5zIGZvciBlYWNoIHRhcmdldCBhY2NvdW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIHJlbGVhc2VNdWx0aVdpdGhTdGFnZShhZGRyZXNzW10gX3RhcmdldHMsIGFkZHJlc3NbXSBfZGVzdHMpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vcmVxdWlyZShfdG9rZW5BZGRyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3RhcmdldHMubGVuZ3RoICE9IDApOwogICAgICAgIHJlcXVpcmUoX2Rlc3RzLmxlbmd0aCAhPSAwKTsKICAgICAgICBhc3NlcnQoX3RhcmdldHMubGVuZ3RoID09IF9kZXN0cy5sZW5ndGgpOwoKICAgICAgICB1aW50MjU2IGkgPSAwOwogICAgICAgIHdoaWxlIChpIDwgX3RhcmdldHMubGVuZ3RoKSB7CiAgICAgICAgICAgIGlmICghcmVsZWFzZVdpdGhTdGFnZShfdGFyZ2V0c1tpXSwgX2Rlc3RzW2ldKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpID0gaS5hZGQoMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=='.
	

]
