Class {
	#name : #SRT5b2db92a43aa86fff2d9a3696a7ee264d03fc907,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT5b2db92a43aa86fff2d9a3696a7ee264d03fc907 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7CgovKgoKICogc291cmNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ibG9ja2JpdHNpby8KCiAqIEBuYW1lICAgICAgICBBcHBsaWNhdGlvbiBFbnRpdHkgR2VuZXJpYyBDb250cmFjdAogKiBAcGFja2FnZSAgICAgQmxvY2tCaXRzSU8KICogQGF1dGhvciAgICAgIE1pY2t5IFNvY2FjaSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImRlYjNiN2JkYjVhNzllYjBiMWE5YjJiN2E4YmJmMGFjYjEiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgoKICAgIFVzZWQgZm9yIHRoZSBBQkkgaW50ZXJmYWNlIHdoZW4gYXNzZXRzIG5lZWQgdG8gY2FsbCBBcHBsaWNhdGlvbiBFbnRpdHkuCgogICAgVGhpcyBpcyByZXF1aXJlZCwgb3RoZXJ3aXNlIHdlIGVuZCB1cCBsb2FkaW5nIHRoZSBhc3NldHMgdGhlbXNlbHZlcyB3aGVuIHdlIGxvYWQgdGhlIEFwcGxpY2F0aW9uRW50aXR5IGNvbnRyYWN0CiAgICBhbmQgZW5kIHVwIGluIGEgbG9vcAoqLwoKCgpjb250cmFjdCBBcHBsaWNhdGlvbkVudGl0eUFCSSB7CgogICAgYWRkcmVzcyBwdWJsaWMgUHJvcG9zYWxzRW50aXR5OwogICAgYWRkcmVzcyBwdWJsaWMgRnVuZGluZ0VudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIE1pbGVzdG9uZXNFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBNZWV0aW5nc0VudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIEJvdW50eU1hbmFnZXJFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBUb2tlbk1hbmFnZXJFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBMaXN0aW5nQ29udHJhY3RFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBGdW5kaW5nTWFuYWdlckVudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIE5ld3NDb250cmFjdEVudGl0eTsKCiAgICBib29sIHB1YmxpYyBfaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgIGJvb2wgcHVibGljIF9sb2NrZWQgPSBmYWxzZTsKICAgIHVpbnQ4IHB1YmxpYyBDdXJyZW50RW50aXR5U3RhdGU7CiAgICB1aW50OCBwdWJsaWMgQXNzZXRDb2xsZWN0aW9uTnVtOwogICAgYWRkcmVzcyBwdWJsaWMgR2F0ZXdheUludGVyZmFjZUFkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBkZXBsb3llckFkZHJlc3M7CiAgICBhZGRyZXNzIHRlc3RBZGRyZXNzQWxsb3dVcGdyYWRlRnJvbTsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDgpIHB1YmxpYyBFbnRpdHlTdGF0ZXM7CiAgICBtYXBwaW5nIChieXRlczMyID0+IGFkZHJlc3MpIHB1YmxpYyBBc3NldENvbGxlY3Rpb247CiAgICBtYXBwaW5nICh1aW50OCA9PiBieXRlczMyKSBwdWJsaWMgQXNzZXRDb2xsZWN0aW9uSWRUb05hbWU7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQyNTYpIHB1YmxpYyBCeWxhd3NVaW50MjU2OwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBieXRlczMyKSBwdWJsaWMgQnlsYXdzQnl0ZXMzMjsKCiAgICBmdW5jdGlvbiBBcHBsaWNhdGlvbkVudGl0eSgpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGdldEVudGl0eVN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gbGlua1RvR2F0ZXdheSggYWRkcmVzcyBfR2F0ZXdheUludGVyZmFjZUFkZHJlc3MsIGJ5dGVzMzIgX3NvdXJjZUNvZGVVcmwgKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldFVwZ3JhZGVTdGF0ZSh1aW50OCBzdGF0ZSkgcHVibGljIDsKICAgIGZ1bmN0aW9uIGFkZEFzc2V0UHJvcG9zYWxzKGFkZHJlc3MgX2Fzc2V0QWRkcmVzc2VzKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGFkZEFzc2V0RnVuZGluZyhhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBc3NldE1pbGVzdG9uZXMoYWRkcmVzcyBfYXNzZXRBZGRyZXNzZXMpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkQXNzZXRNZWV0aW5ncyhhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBc3NldEJvdW50eU1hbmFnZXIoYWRkcmVzcyBfYXNzZXRBZGRyZXNzZXMpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkQXNzZXRUb2tlbk1hbmFnZXIoYWRkcmVzcyBfYXNzZXRBZGRyZXNzZXMpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYWRkQXNzZXRGdW5kaW5nTWFuYWdlcihhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBc3NldExpc3RpbmdDb250cmFjdChhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBc3NldE5ld3NDb250cmFjdChhZGRyZXNzIF9hc3NldEFkZHJlc3NlcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBnZXRBc3NldEFkZHJlc3NCeU5hbWUoYnl0ZXMzMiBfbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBzZXRCeWxhd1VpbnQyNTYoYnl0ZXMzMiBuYW1lLCB1aW50MjU2IHZhbHVlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBnZXRCeWxhd1VpbnQyNTYoYnl0ZXMzMiBuYW1lKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHNldEJ5bGF3Qnl0ZXMzMihieXRlczMyIG5hbWUsIGJ5dGVzMzIgdmFsdWUpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGdldEJ5bGF3Qnl0ZXMzMihieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzMzIpOwogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UGFyZW50QWRkcmVzcygpIGV4dGVybmFsIHZpZXcgcmV0dXJucyhhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGNyZWF0ZUNvZGVVcGdyYWRlUHJvcG9zYWwoIGFkZHJlc3MgX25ld0FkZHJlc3MsIGJ5dGVzMzIgX3NvdXJjZUNvZGVVcmwgKSBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGFjY2VwdENvZGVVcGdyYWRlUHJvcG9zYWwoYWRkcmVzcyBfbmV3QWRkcmVzcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBpbml0aWFsaXplQXNzZXRzVG9UaGlzQXBwbGljYXRpb24oKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyQXNzZXRzVG9OZXdBcHBsaWNhdGlvbihhZGRyZXNzIF9uZXdBZGRyZXNzKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGxvY2soKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGNhbkluaXRpYXRlQ29kZVVwZ3JhZGUoYWRkcmVzcyBfc2VuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gZG9TdGF0ZUNoYW5nZXMoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBoYXNSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYW55QXNzZXRIYXNDaGFuZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBleHRlbmRlZEFueUFzc2V0SGFzQ2hhbmdlcygpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4LCB1aW50OCk7CiAgICBmdW5jdGlvbiBnZXRUaW1lc3RhbXAoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKCn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIEFwcGxpY2F0aW9uIEFzc2V0IENvbnRyYWN0CiAqIEBwYWNrYWdlICAgICBCbG9ja0JpdHNJTwogKiBAYXV0aG9yICAgICAgTWlja3kgU29jYWNpIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMzQ1OTVkNTc1ZjRkNzQ1YTViNDM1ODVkNDI1MTFhNDY1YiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CgogQW55IGNvbnRyYWN0IGluaGVyaXRpbmcgdGhpcyB3aWxsIGJlIHVzYWJsZSBhcyBhbiBBc3NldCBpbiB0aGUgQXBwbGljYXRpb24gRW50aXR5CgoqLwoKCgoKY29udHJhY3QgQXBwbGljYXRpb25Bc3NldCB7CgogICAgZXZlbnQgRXZlbnRBcHBBc3NldE93bmVyU2V0KGJ5dGVzMzIgaW5kZXhlZCBfbmFtZSwgYWRkcmVzcyBpbmRleGVkIF9vd25lcik7CiAgICBldmVudCBFdmVudFJ1bkJlZm9yZUluaXQoYnl0ZXMzMiBpbmRleGVkIF9uYW1lKTsKICAgIGV2ZW50IEV2ZW50UnVuQmVmb3JlQXBwbHlpbmdTZXR0aW5ncyhieXRlczMyIGluZGV4ZWQgX25hbWUpOwoKCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQ4KSBwdWJsaWMgRW50aXR5U3RhdGVzOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50OCkgcHVibGljIFJlY29yZFN0YXRlczsKICAgIHVpbnQ4IHB1YmxpYyBDdXJyZW50RW50aXR5U3RhdGU7CgogICAgZXZlbnQgRXZlbnRFbnRpdHlQcm9jZXNzb3IoYnl0ZXMzMiBpbmRleGVkIF9hc3NldE5hbWUsIHVpbnQ4IGluZGV4ZWQgX2N1cnJlbnQsIHVpbnQ4IGluZGV4ZWQgX3JlcXVpcmVkKTsKICAgIGV2ZW50IERlYnVnRW50aXR5UmVxdWlyZWRDaGFuZ2VzKCBieXRlczMyIF9hc3NldE5hbWUsIHVpbnQ4IGluZGV4ZWQgX2N1cnJlbnQsIHVpbnQ4IGluZGV4ZWQgX3JlcXVpcmVkICk7CgogICAgYnl0ZXMzMiBwdWJsaWMgYXNzZXROYW1lOwoKICAgIC8qIEFzc2V0IHJlY29yZHMgKi8KICAgIHVpbnQ4IHB1YmxpYyBSZWNvcmROdW0gPSAwOwoKICAgIC8qIEFzc2V0IGluaXRpYWxpc2VkIG9yIG5vdCAqLwogICAgYm9vbCBwdWJsaWMgX2luaXRpYWxpemVkID0gZmFsc2U7CgogICAgLyogQXNzZXQgc2V0dGluZ3MgcHJlc2VudCBvciBub3QgKi8KICAgIGJvb2wgcHVibGljIF9zZXR0aW5nc0FwcGxpZWQgPSBmYWxzZTsKCiAgICAvKiBBc3NldCBvd25lciAoIEFwcGxpY2F0aW9uRW50aXR5IGFkZHJlc3MgKSAqLwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXIgPSBhZGRyZXNzKDB4MCkgOwogICAgYWRkcmVzcyBwdWJsaWMgZGVwbG95ZXJBZGRyZXNzOwoKICAgIGZ1bmN0aW9uIEFwcGxpY2F0aW9uQXNzZXQoKSBwdWJsaWMgewogICAgICAgIGRlcGxveWVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0SW5pdGlhbEFwcGxpY2F0aW9uQWRkcmVzcyhhZGRyZXNzIF9vd25lckFkZHJlc3MpIHB1YmxpYyBvbmx5RGVwbG95ZXIgcmVxdWlyZU5vdEluaXRpYWxpc2VkIHsKICAgICAgICBvd25lciA9IF9vd25lckFkZHJlc3M7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0SW5pdGlhbE93bmVyQW5kTmFtZShieXRlczMyIF9uYW1lKSBleHRlcm5hbAogICAgICAgIHJlcXVpcmVOb3RJbml0aWFsaXNlZAogICAgICAgIG9ubHlPd25lcgogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgLy8gaW5pdCBzdGF0ZXMKICAgICAgICBzZXRBc3NldFN0YXRlcygpOwogICAgICAgIGFzc2V0TmFtZSA9IF9uYW1lOwogICAgICAgIC8vIHNldCBpbml0aWFsIHN0YXRlCiAgICAgICAgQ3VycmVudEVudGl0eVN0YXRlID0gZ2V0RW50aXR5U3RhdGUoIk5FVyIpOwogICAgICAgIHJ1bkJlZm9yZUluaXRpYWxpemF0aW9uKCk7CiAgICAgICAgX2luaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgICBFdmVudEFwcEFzc2V0T3duZXJTZXQoX25hbWUsIG93bmVyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRBc3NldFN0YXRlcygpIGludGVybmFsIHsKICAgICAgICAvLyBBc3NldCBTdGF0ZXMKICAgICAgICBFbnRpdHlTdGF0ZXNbIl9fSUdOT1JFRF9fIl0gICAgID0gMDsKICAgICAgICBFbnRpdHlTdGF0ZXNbIk5FVyJdICAgICAgICAgICAgID0gMTsKICAgICAgICAvLyBGdW5kaW5nIFN0YWdlIFN0YXRlcwogICAgICAgIFJlY29yZFN0YXRlc1siX19JR05PUkVEX18iXSAgICAgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJlY29yZFN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gUmVjb3JkU3RhdGVzW25hbWVdOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEVudGl0eVN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gRW50aXR5U3RhdGVzW25hbWVdOwogICAgfQoKICAgIGZ1bmN0aW9uIHJ1bkJlZm9yZUluaXRpYWxpemF0aW9uKCkgaW50ZXJuYWwgcmVxdWlyZU5vdEluaXRpYWxpc2VkICB7CiAgICAgICAgRXZlbnRSdW5CZWZvcmVJbml0KGFzc2V0TmFtZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwbHlBbmRMb2NrU2V0dGluZ3MoKQogICAgICAgIHB1YmxpYwogICAgICAgIG9ubHlEZXBsb3llcgogICAgICAgIHJlcXVpcmVJbml0aWFsaXNlZAogICAgICAgIHJlcXVpcmVTZXR0aW5nc05vdEFwcGxpZWQKICAgICAgICByZXR1cm5zKGJvb2wpCiAgICB7CiAgICAgICAgcnVuQmVmb3JlQXBwbHlpbmdTZXR0aW5ncygpOwogICAgICAgIF9zZXR0aW5nc0FwcGxpZWQgPSB0cnVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJ1bkJlZm9yZUFwcGx5aW5nU2V0dGluZ3MoKSBpbnRlcm5hbCByZXF1aXJlSW5pdGlhbGlzZWQgcmVxdWlyZVNldHRpbmdzTm90QXBwbGllZCAgewogICAgICAgIEV2ZW50UnVuQmVmb3JlQXBwbHlpbmdTZXR0aW5ncyhhc3NldE5hbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9OZXdPd25lcihhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIHJlcXVpcmVJbml0aWFsaXNlZCBvbmx5T3duZXIgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygweDApICYmIF9uZXdPd25lciAhPSBhZGRyZXNzKDB4MCkpOwogICAgICAgIG93bmVyID0gX25ld093bmVyOwogICAgICAgIEV2ZW50QXBwQXNzZXRPd25lclNldChhc3NldE5hbWUsIG93bmVyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvbkFzc2V0QWRkcmVzc0J5TmFtZShieXRlczMyIF9uYW1lKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zKGFkZHJlc3MpCiAgICB7CiAgICAgICAgYWRkcmVzcyBhc3NldCA9IEFwcGxpY2F0aW9uRW50aXR5QUJJKG93bmVyKS5nZXRBc3NldEFkZHJlc3NCeU5hbWUoX25hbWUpOwogICAgICAgIGlmKCBhc3NldCAhPSBhZGRyZXNzKDB4MCkgKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NldDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXBwbGljYXRpb25TdGF0ZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIEFwcGxpY2F0aW9uRW50aXR5QUJJKG93bmVyKS5DdXJyZW50RW50aXR5U3RhdGUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvbkVudGl0eVN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gQXBwbGljYXRpb25FbnRpdHlBQkkob3duZXIpLmdldEVudGl0eVN0YXRlKG5hbWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEFwcEJ5bGF3VWludDI1NihieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJlcXVpcmVJbml0aWFsaXNlZCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgQXBwbGljYXRpb25FbnRpdHlBQkkgQ3VycmVudEFwcCA9IEFwcGxpY2F0aW9uRW50aXR5QUJJKG93bmVyKTsKICAgICAgICByZXR1cm4gQ3VycmVudEFwcC5nZXRCeWxhd1VpbnQyNTYobmFtZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QXBwQnlsYXdCeXRlczMyKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmVxdWlyZUluaXRpYWxpc2VkIHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICBBcHBsaWNhdGlvbkVudGl0eUFCSSBDdXJyZW50QXBwID0gQXBwbGljYXRpb25FbnRpdHlBQkkob3duZXIpOwogICAgICAgIHJldHVybiBDdXJyZW50QXBwLmdldEJ5bGF3Qnl0ZXMzMihuYW1lKTsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG9ubHlBcHBsaWNhdGlvbkVudGl0eSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcmVxdWlyZUluaXRpYWxpc2VkKCkgewogICAgICAgIHJlcXVpcmUoX2luaXRpYWxpemVkID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcmVxdWlyZU5vdEluaXRpYWxpc2VkKCkgewogICAgICAgIHJlcXVpcmUoX2luaXRpYWxpemVkID09IGZhbHNlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHJlcXVpcmVTZXR0aW5nc0FwcGxpZWQoKSB7CiAgICAgICAgcmVxdWlyZShfc2V0dGluZ3NBcHBsaWVkID09IHRydWUpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgcmVxdWlyZVNldHRpbmdzTm90QXBwbGllZCgpIHsKICAgICAgICByZXF1aXJlKF9zZXR0aW5nc0FwcGxpZWQgPT0gZmFsc2UpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seURlcGxveWVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBkZXBsb3llckFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFzc2V0KGJ5dGVzMzIgX25hbWUpIHsKICAgICAgICBhZGRyZXNzIEFzc2V0QWRkcmVzcyA9IGdldEFwcGxpY2F0aW9uQXNzZXRBZGRyZXNzQnlOYW1lKF9uYW1lKTsKICAgICAgICByZXF1aXJlKCBtc2cuc2VuZGVyID09IEFzc2V0QWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUaW1lc3RhbXAoKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCgp9CgovKgoKICogc291cmNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ibG9ja2JpdHNpby8KCiAqIEBuYW1lICAgICAgICBUb2tlbiBDb250cmFjdAogKiBAcGFja2FnZSAgICAgQmxvY2tCaXRzSU8KICogQGF1dGhvciAgICAgIE1pY2t5IFNvY2FjaSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjAyNmY2YjYxNjk3YjQyNmM2ZDc1NmU2Yjc0NjcyYzcwNmQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgoKIFplcHBlbGluIEVSQzIwIFN0YW5kYXJkIFRva2VuCgoqLwoKCgpjb250cmFjdCBBQklUb2tlbiB7CgogICAgc3RyaW5nIHB1YmxpYyAgc3ltYm9sOwogICAgc3RyaW5nIHB1YmxpYyAgbmFtZTsKICAgIHVpbnQ4IHB1YmxpYyAgIGRlY2ltYWxzOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgICBzdHJpbmcgcHVibGljICB2ZXJzaW9uOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgYmFsYW5jZXM7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CiAgICBhZGRyZXNzIHB1YmxpYyBtYW5hZ2VyOwogICAgYWRkcmVzcyBwdWJsaWMgZGVwbG95ZXI7CiAgICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKICAgIGJvb2wgcHVibGljIGluaXRpYWxpemVkID0gZmFsc2U7CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKTsKICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGZpbmlzaE1pbnRpbmcoKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBpbmRleGVkIHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgaW5kZXhlZCB2YWx1ZSk7CiAgICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgTWludEZpbmlzaGVkKCk7Cn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIEFwcGxpY2F0aW9uIEFzc2V0IENvbnRyYWN0IEFCSQogKiBAcGFja2FnZSAgICAgQmxvY2tCaXRzSU8KICogQGF1dGhvciAgICAgIE1pY2t5IFNvY2FjaSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImMxYWNhOGEyYWFiODgxYWZhZWI2YWRhOGI3YTRlZmIzYWUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgoKIEFueSBjb250cmFjdCBpbmhlcml0aW5nIHRoaXMgd2lsbCBiZSB1c2FibGUgYXMgYW4gQXNzZXQgaW4gdGhlIEFwcGxpY2F0aW9uIEVudGl0eQoKKi8KCgoKY29udHJhY3QgQUJJQXBwbGljYXRpb25Bc3NldCB7CgogICAgYnl0ZXMzMiBwdWJsaWMgYXNzZXROYW1lOwogICAgdWludDggcHVibGljIEN1cnJlbnRFbnRpdHlTdGF0ZTsKICAgIHVpbnQ4IHB1YmxpYyBSZWNvcmROdW07CiAgICBib29sIHB1YmxpYyBfaW5pdGlhbGl6ZWQ7CiAgICBib29sIHB1YmxpYyBfc2V0dGluZ3NBcHBsaWVkOwogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBkZXBsb3llckFkZHJlc3M7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQ4KSBwdWJsaWMgRW50aXR5U3RhdGVzOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiB1aW50OCkgcHVibGljIFJlY29yZFN0YXRlczsKCiAgICBmdW5jdGlvbiBzZXRJbml0aWFsQXBwbGljYXRpb25BZGRyZXNzKGFkZHJlc3MgX293bmVyQWRkcmVzcykgcHVibGljOwogICAgZnVuY3Rpb24gc2V0SW5pdGlhbE93bmVyQW5kTmFtZShieXRlczMyIF9uYW1lKSBleHRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldFJlY29yZFN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZ2V0RW50aXR5U3RhdGUoYnl0ZXMzMiBuYW1lKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCk7CiAgICBmdW5jdGlvbiBhcHBseUFuZExvY2tTZXR0aW5ncygpIHB1YmxpYyByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gdHJhbnNmZXJUb05ld093bmVyKGFkZHJlc3MgX25ld093bmVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvbkFzc2V0QWRkcmVzc0J5TmFtZShieXRlczMyIF9uYW1lKSBwdWJsaWMgcmV0dXJucyhhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFwcGxpY2F0aW9uU3RhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCk7CiAgICBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvbkVudGl0eVN0YXRlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpOwogICAgZnVuY3Rpb24gZ2V0QXBwQnlsYXdVaW50MjU2KGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRBcHBCeWxhd0J5dGVzMzIoYnl0ZXMzMiBuYW1lKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczMyKTsKICAgIGZ1bmN0aW9uIGdldFRpbWVzdGFtcCgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpOwoKCn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIFRva2VuIE1hbmFnZXIgQ29udHJhY3QKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI5YmY2ZjJmOGYwZTJkYmY1ZjRlY2Y3ZjJlZGZlYjVlOWY0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiovCgoKCgoKY29udHJhY3QgQUJJVG9rZW5NYW5hZ2VyIGlzIEFCSUFwcGxpY2F0aW9uQXNzZXQgewoKICAgIGFkZHJlc3MgcHVibGljIFRva2VuU0NBREFFbnRpdHk7CiAgICBhZGRyZXNzIHB1YmxpYyBUb2tlbkVudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIE1hcmtldGluZ01ldGhvZEFkZHJlc3M7CiAgICBib29sIE93bmVyVG9rZW5CYWxhbmNlc1JlbGVhc2VkID0gZmFsc2U7CgogICAgZnVuY3Rpb24gYWRkU2V0dGluZ3MoYWRkcmVzcyBfc2NhZGFBZGRyZXNzLCBhZGRyZXNzIF90b2tlbkFkZHJlc3MsIGFkZHJlc3MgX21hcmtldGluZyApIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGdldFRva2VuU0NBREFSZXF1aXJlc0hhcmRDYXAoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIG1pbnRGb3JNYXJrZXRpbmdQb29sKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gUmVsZWFzZU93bmVyc0xvY2tlZFRva2VucyhhZGRyZXNzIF9tdWx0aVNpZ091dHB1dEFkZHJlc3MpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIExpc3RpbmcgQ29udHJhY3QgQUJJCiAqIEBwYWNrYWdlICAgICBCbG9ja0JpdHNJTwogKiBAYXV0aG9yICAgICAgTWlja3kgU29jYWNpIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMjQ0OTRkNDc0ZjVkNjQ0YTRiNTM0ODRkNTI0MTBhNTY0YiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+CgoqLwoKCgoKCmNvbnRyYWN0IEFCSUxpc3RpbmdDb250cmFjdCBpcyBBQklBcHBsaWNhdGlvbkFzc2V0IHsKCiAgICBhZGRyZXNzIHB1YmxpYyBtYW5hZ2VyQWRkcmVzczsKICAgIC8vIGNoaWxkIGl0ZW1zCiAgICBzdHJ1Y3QgaXRlbSB7CiAgICAgICAgYnl0ZXMzMiBuYW1lOwogICAgICAgIGFkZHJlc3MgaXRlbUFkZHJlc3M7CiAgICAgICAgYm9vbCAgICBzdGF0dXM7CiAgICAgICAgdWludDI1NiBpbmRleDsKICAgIH0KCiAgICBtYXBwaW5nICggdWludDI1NiA9PiBpdGVtICkgcHVibGljIGl0ZW1zOwogICAgdWludDI1NiBwdWJsaWMgaXRlbU51bTsKCiAgICBmdW5jdGlvbiBzZXRNYW5hZ2VyQWRkcmVzcyhhZGRyZXNzIF9tYW5hZ2VyKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBhZGRJdGVtKGJ5dGVzMzIgX25hbWUsIGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGdldE5ld3NDb250cmFjdEFkZHJlc3ModWludDI1NiBfY2hpbGRJZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKTsKICAgIGZ1bmN0aW9uIGNhbkJlRGVsaXN0ZWQodWludDI1NiBfY2hpbGRJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRDaGlsZFN0YXR1cyggdWludDI1NiBfY2hpbGRJZCApIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZGVsaXN0Q2hpbGQoIHVpbnQyNTYgX2NoaWxkSWQgKSBwdWJsaWM7Cgp9CgovKgoKICogc291cmNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ibG9ja2JpdHNpby8KCiAqIEBuYW1lICAgICAgICBGdW5kaW5nIENvbnRyYWN0IEFCSQogKiBAcGFja2FnZSAgICAgQmxvY2tCaXRzSU8KICogQGF1dGhvciAgICAgIE1pY2t5IFNvY2FjaSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjljZjFmNWZmZjdlNWRjZjJmM2ViZjBmNWVhZjliMmVlZjMiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgoKIENvbnRhaW5zIHRoZSBGdW5kaW5nIENvbnRyYWN0IGNvZGUgZGVwbG95ZWQgYW5kIGxpbmtlZCB0byB0aGUgQXBwbGljYXRpb24gRW50aXR5CgoKICAgICEhISBMaW5rcyBkaXJlY3RseSB0byBNaWxlc3RvbmVzCgoqLwoKCgoKCmNvbnRyYWN0IEFCSUZ1bmRpbmcgaXMgQUJJQXBwbGljYXRpb25Bc3NldCB7CgogICAgYWRkcmVzcyBwdWJsaWMgbXVsdGlTaWdPdXRwdXRBZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgRGlyZWN0SW5wdXQ7CiAgICBhZGRyZXNzIHB1YmxpYyBNaWxlc3RvbmVJbnB1dDsKICAgIGFkZHJlc3MgcHVibGljIFRva2VuTWFuYWdlckVudGl0eTsKICAgIGFkZHJlc3MgcHVibGljIEZ1bmRpbmdNYW5hZ2VyRW50aXR5OwoKICAgIHN0cnVjdCBGdW5kaW5nU3RhZ2UgewogICAgICAgIGJ5dGVzMzIgbmFtZTsKICAgICAgICB1aW50OCAgIHN0YXRlOwogICAgICAgIHVpbnQyNTYgdGltZV9zdGFydDsKICAgICAgICB1aW50MjU2IHRpbWVfZW5kOwogICAgICAgIHVpbnQyNTYgYW1vdW50X2NhcF9zb2Z0OyAgICAgICAgICAgIC8vIDAgPSBub3QgZW5mb3JjZWQKICAgICAgICB1aW50MjU2IGFtb3VudF9jYXBfaGFyZDsgICAgICAgICAgICAvLyAwID0gbm90IGVuZm9yY2VkCiAgICAgICAgdWludDI1NiBhbW91bnRfcmFpc2VkOyAgICAgICAgICAgICAgLy8gMCA9IG5vdCBlbmZvcmNlZAogICAgICAgIC8vIGZ1bmRpbmcgbWV0aG9kIHNldHRpbmdzCiAgICAgICAgdWludDI1NiBtaW5pbXVtX2VudHJ5OwogICAgICAgIHVpbnQ4ICAgbWV0aG9kczsgICAgICAgICAgICAgICAgICAgIC8vIEZ1bmRpbmdNZXRob2RJZHMKICAgICAgICAvLyB0b2tlbiBzZXR0aW5ncwogICAgICAgIHVpbnQyNTYgZml4ZWRfdG9rZW5zOwogICAgICAgIHVpbnQ4ICAgcHJpY2VfYWRkaXRpb25fcGVyY2VudGFnZTsgIC8vCiAgICAgICAgdWludDggICB0b2tlbl9zaGFyZV9wZXJjZW50YWdlOwogICAgICAgIHVpbnQ4ICAgaW5kZXg7CiAgICB9CgogICAgbWFwcGluZyAodWludDggPT4gRnVuZGluZ1N0YWdlKSBwdWJsaWMgQ29sbGVjdGlvbjsKICAgIHVpbnQ4IHB1YmxpYyBGdW5kaW5nU3RhZ2VOdW07CiAgICB1aW50OCBwdWJsaWMgY3VycmVudEZ1bmRpbmdTdGFnZTsKICAgIHVpbnQyNTYgcHVibGljIEFtb3VudFJhaXNlZDsKICAgIHVpbnQyNTYgcHVibGljIE1pbGVzdG9uZUFtb3VudFJhaXNlZDsKICAgIHVpbnQyNTYgcHVibGljIEdsb2JhbEFtb3VudENhcFNvZnQ7CiAgICB1aW50MjU2IHB1YmxpYyBHbG9iYWxBbW91bnRDYXBIYXJkOwogICAgdWludDggcHVibGljIFRva2VuU2VsbFBlcmNlbnRhZ2U7CiAgICB1aW50MjU2IHB1YmxpYyBGdW5kaW5nX1NldHRpbmdfZnVuZGluZ190aW1lX3N0YXJ0OwogICAgdWludDI1NiBwdWJsaWMgRnVuZGluZ19TZXR0aW5nX2Z1bmRpbmdfdGltZV9lbmQ7CiAgICB1aW50MjU2IHB1YmxpYyBGdW5kaW5nX1NldHRpbmdfY2FzaGJhY2tfdGltZV9zdGFydDsKICAgIHVpbnQyNTYgcHVibGljIEZ1bmRpbmdfU2V0dGluZ19jYXNoYmFja190aW1lX2VuZDsKICAgIHVpbnQyNTYgcHVibGljIEZ1bmRpbmdfU2V0dGluZ19jYXNoYmFja19iZWZvcmVfc3RhcnRfd2FpdF9kdXJhdGlvbjsKICAgIHVpbnQyNTYgcHVibGljIEZ1bmRpbmdfU2V0dGluZ19jYXNoYmFja19kdXJhdGlvbjsKCgogICAgZnVuY3Rpb24gYWRkRnVuZGluZ1N0YWdlKAogICAgICAgIGJ5dGVzMzIgX25hbWUsCiAgICAgICAgdWludDI1NiBfdGltZV9zdGFydCwKICAgICAgICB1aW50MjU2IF90aW1lX2VuZCwKICAgICAgICB1aW50MjU2IF9hbW91bnRfY2FwX3NvZnQsCiAgICAgICAgdWludDI1NiBfYW1vdW50X2NhcF9oYXJkLCAgIC8vIHJlcXVpcmVkID4gMAogICAgICAgIHVpbnQ4ICAgX21ldGhvZHMsCiAgICAgICAgdWludDI1NiBfbWluaW11bV9lbnRyeSwKICAgICAgICB1aW50MjU2IF9maXhlZF90b2tlbnMsCiAgICAgICAgdWludDggICBfcHJpY2VfYWRkaXRpb25fcGVyY2VudGFnZSwKICAgICAgICB1aW50OCAgIF90b2tlbl9zaGFyZV9wZXJjZW50YWdlCiAgICApCiAgICBwdWJsaWM7CgogICAgZnVuY3Rpb24gYWRkU2V0dGluZ3MoYWRkcmVzcyBfb3V0cHV0QWRkcmVzcywgdWludDI1NiBzb2Z0X2NhcCwgdWludDI1NiBoYXJkX2NhcCwgdWludDggc2FsZV9wZXJjZW50YWdlLCBhZGRyZXNzIF9kaXJlY3QsIGFkZHJlc3MgX21pbGVzdG9uZSApIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGdldFN0YWdlQW1vdW50KHVpbnQ4IFN0YWdlSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKCB1aW50MjU2ICk7CiAgICBmdW5jdGlvbiBhbGxvd2VkUGF5bWVudE1ldGhvZCh1aW50OCBfcGF5bWVudF9tZXRob2QpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gcmVjZWl2ZVBheW1lbnQoYWRkcmVzcyBfc2VuZGVyLCB1aW50OCBfcGF5bWVudF9tZXRob2QpIHBheWFibGUgcHVibGljIHJldHVybnMoYm9vbCk7CiAgICBmdW5jdGlvbiBjYW5BY2NlcHRQYXltZW50KHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRWYWx1ZU92ZXJDdXJyZW50Q2FwKHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBpc0Z1bmRpbmdTdGFnZVVwZGF0ZUFsbG93ZWQodWludDggX25ld19zdGF0ZSApIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UmVjb3JkU3RhdGVSZXF1aXJlZENoYW5nZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCk7CiAgICBmdW5jdGlvbiBkb1N0YXRlQ2hhbmdlcygpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGhhc1JlcXVpcmVkU3RhdGVDaGFuZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBnZXRSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4LCB1aW50OCwgdWludDgpOwoKfQoKLyoKCiAqIHNvdXJjZSAgICAgICBodHRwczovL2dpdGh1Yi5jb20vYmxvY2tiaXRzaW8vCgogKiBAbmFtZSAgICAgICAgRnVuZGluZyBDb250cmFjdCBBQkkKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIxZTczNzc3ZDc1Njc1ZTcwNzE2OTcyNzc2ODdiMzA2YzcxIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiBDb250YWlucyB0aGUgRnVuZGluZyBDb250cmFjdCBjb2RlIGRlcGxveWVkIGFuZCBsaW5rZWQgdG8gdGhlIEFwcGxpY2F0aW9uIEVudGl0eQoKKi8KCgoKCgpjb250cmFjdCBBQklGdW5kaW5nTWFuYWdlciBpcyBBQklBcHBsaWNhdGlvbkFzc2V0IHsKCiAgICBib29sIHB1YmxpYyBmdW5kaW5nUHJvY2Vzc2VkOwogICAgYm9vbCBGdW5kaW5nUG9vbEJhbGFuY2VzQWxsb2NhdGVkOwogICAgdWludDggcHVibGljIFZhdWx0Q291bnRQZXJQcm9jZXNzOwogICAgdWludDI1NiBwdWJsaWMgbGFzdFByb2Nlc3NlZFZhdWx0SWQ7CiAgICB1aW50MjU2IHB1YmxpYyB2YXVsdE51bTsKICAgIHVpbnQyNTYgcHVibGljIExvY2tlZFZvdGluZ1Rva2VuczsKICAgIGJ5dGVzMzIgcHVibGljIGN1cnJlbnRUYXNrOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBib29sKSBwdWJsaWMgdGFza0J5SGFzaDsKICAgIG1hcHBpbmcgIChhZGRyZXNzID0+IGFkZHJlc3MpIHB1YmxpYyB2YXVsdExpc3Q7CiAgICBtYXBwaW5nICAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgdmF1bHRCeUlkOwoKICAgIGZ1bmN0aW9uIHJlY2VpdmVQYXltZW50KGFkZHJlc3MgX3NlbmRlciwgdWludDggX3BheW1lbnRfbWV0aG9kLCB1aW50OCBfZnVuZGluZ19zdGFnZSkgcGF5YWJsZSBwdWJsaWMgcmV0dXJucyhib29sKTsKICAgIGZ1bmN0aW9uIGdldE15VmF1bHRBZGRyZXNzKGFkZHJlc3MgX3NlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBzZXRWYXVsdENvdW50UGVyUHJvY2Vzcyh1aW50OCBfcGVyUHJvY2VzcykgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBnZXRIYXNoKGJ5dGVzMzIgYWN0aW9uVHlwZSwgYnl0ZXMzMiBhcmcxKSBwdWJsaWMgcHVyZSByZXR1cm5zICggYnl0ZXMzMiApOwogICAgZnVuY3Rpb24gZ2V0Q3VycmVudE1pbGVzdG9uZVByb2Nlc3NlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gcHJvY2Vzc0Z1bmRpbmdGYWlsZWRGaW5pc2hlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gcHJvY2Vzc0Z1bmRpbmdTdWNjZXNzZnVsRmluaXNoZWQoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRNaWxlc3RvbmVJZEhhc2goKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJ5dGVzMzIpOwogICAgZnVuY3Rpb24gcHJvY2Vzc01pbGVzdG9uZUZpbmlzaGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBwcm9jZXNzRW1lcmdlbmN5RnVuZFJlbGVhc2VGaW5pc2hlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0QWZ0ZXJUcmFuc2ZlckxvY2tlZFRva2VuQmFsYW5jZXMoYWRkcmVzcyB2YXVsdEFkZHJlc3MsIGJvb2wgZXhjbHVkZUN1cnJlbnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gVmF1bHRSZXF1ZXN0ZWRVcGRhdGVGb3JMb2NrZWRWb3RpbmdUb2tlbnMoYWRkcmVzcyBvd25lcikgcHVibGljOwogICAgZnVuY3Rpb24gZG9TdGF0ZUNoYW5nZXMoKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBoYXNSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZ2V0UmVxdWlyZWRTdGF0ZUNoYW5nZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCwgdWludDgpOwogICAgZnVuY3Rpb24gQXBwbGljYXRpb25JbkZ1bmRpbmdPckRldmVsb3BtZW50KCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKTsKCn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIE1pbGVzdG9uZXMgQ29udHJhY3QKICogQHBhY2thZ2UgICAgIEJsb2NrQml0c0lPCiAqIEBhdXRob3IgICAgICBNaWNreSBTb2NhY2kgPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIxNDc5N2Q3NzdmNmQ1NDdhN2I2Mzc4N2Q2MjcxM2E2NjdiIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KCiBDb250YWlucyB0aGUgTWlsZXN0b25lcyBDb250cmFjdCBjb2RlIGRlcGxveWVkIGFuZCBsaW5rZWQgdG8gdGhlIEFwcGxpY2F0aW9uIEVudGl0eQoKKi8KCgoKCgpjb250cmFjdCBBQklNaWxlc3RvbmVzIGlzIEFCSUFwcGxpY2F0aW9uQXNzZXQgewoKICAgIHN0cnVjdCBSZWNvcmQgewogICAgICAgIGJ5dGVzMzIgbmFtZTsKICAgICAgICBzdHJpbmcgZGVzY3JpcHRpb247ICAgICAgICAgICAgICAgICAgICAgLy8gd2lsbCBjaGFuZ2UgdG8gaGFzaCBwb2ludGVyICggZXh0ZXJuYWwgc3RvcmFnZSApCiAgICAgICAgdWludDggc3RhdGU7CiAgICAgICAgdWludDI1NiBkdXJhdGlvbjsKICAgICAgICB1aW50MjU2IHRpbWVfc3RhcnQ7ICAgICAgICAgICAgICAgICAgICAgLy8gc3RhcnQgYXQgdW5peHRpbWVzdGFtcAogICAgICAgIHVpbnQyNTYgbGFzdF9zdGF0ZV9jaGFuZ2VfdGltZTsgICAgICAgICAvLyB0aW1lIG9mIGxhc3Qgc3RhdGUgY2hhbmdlCiAgICAgICAgdWludDI1NiB0aW1lX2VuZDsgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzdGltYXRlZCBlbmQgdGltZSA+PiBjYW4gYmUgaW5jcmVhc2VkIGJ5IHByb3Bvc2FsCiAgICAgICAgdWludDI1NiB0aW1lX2VuZGVkOyAgICAgICAgICAgICAgICAgICAgIC8vIGFjdHVhbCBlbmQgdGltZQogICAgICAgIHVpbnQyNTYgbWVldGluZ190aW1lOwogICAgICAgIHVpbnQ4IGZ1bmRpbmdfcGVyY2VudGFnZTsKICAgICAgICB1aW50OCBpbmRleDsKICAgIH0KCiAgICB1aW50OCBwdWJsaWMgY3VycmVudFJlY29yZDsKICAgIHVpbnQyNTYgcHVibGljIE1pbGVzdG9uZUNhc2hCYWNrVGltZSA9IDA7CiAgICBtYXBwaW5nICh1aW50OCA9PiBSZWNvcmQpIHB1YmxpYyBDb2xsZWN0aW9uOwogICAgbWFwcGluZyAoYnl0ZXMzMiA9PiBib29sKSBwdWJsaWMgTWlsZXN0b25lUG9zdHBvbmluZ0hhc2g7CiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQyNTYpIHB1YmxpYyBQcm9wb3NhbElkQnlIYXNoOwoKICAgIGZ1bmN0aW9uIGdldEJ5bGF3c1Byb2plY3REZXZlbG9wbWVudFN0YXJ0KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiBnZXRCeWxhd3NNaW5UaW1lSW5UaGVGdXR1cmVGb3JNZWV0aW5nQ3JlYXRpb24oKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGdldEJ5bGF3c0Nhc2hCYWNrVm90ZVJlamVjdGVkRHVyYXRpb24oKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGFkZFJlY29yZCggYnl0ZXMzMiBfbmFtZSwgc3RyaW5nIF9kZXNjcmlwdGlvbiwgdWludDI1NiBfZHVyYXRpb24sIHVpbnQ4IF9wZXJjICkgcHVibGljOwogICAgZnVuY3Rpb24gZ2V0TWlsZXN0b25lRnVuZGluZ1BlcmNlbnRhZ2UodWludDggcmVjb3JkSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGRvU3RhdGVDaGFuZ2VzKCkgcHVibGljOwogICAgZnVuY3Rpb24gZ2V0UmVjb3JkU3RhdGVSZXF1aXJlZENoYW5nZXMoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCk7CiAgICBmdW5jdGlvbiBoYXNSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gYWZ0ZXJWb3RlTm9DYXNoQmFja1RpbWUoKSBwdWJsaWMgdmlldyByZXR1cm5zICggYm9vbCApOwogICAgZnVuY3Rpb24gZ2V0SGFzaCh1aW50OCBhY3Rpb25UeXBlLCBieXRlczMyIGFyZzEsIGJ5dGVzMzIgYXJnMikgcHVibGljIHB1cmUgcmV0dXJucyAoIGJ5dGVzMzIgKTsKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRIYXNoKCkgcHVibGljIHZpZXcgcmV0dXJucyAoIGJ5dGVzMzIgKTsKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcm9wb3NhbElkKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICggdWludDI1NiApOwogICAgZnVuY3Rpb24gc2V0Q3VycmVudE1pbGVzdG9uZU1lZXRpbmdUaW1lKHVpbnQyNTYgX21lZXRpbmdfdGltZSkgcHVibGljOwogICAgZnVuY3Rpb24gaXNSZWNvcmRVcGRhdGVBbGxvd2VkKHVpbnQ4IF9uZXdfc3RhdGUgKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGdldFJlcXVpcmVkU3RhdGVDaGFuZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgsIHVpbnQ4LCB1aW50OCk7CiAgICBmdW5jdGlvbiBBcHBsaWNhdGlvbklzSW5EZXZlbG9wbWVudCgpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCk7CiAgICBmdW5jdGlvbiBNZWV0aW5nVGltZVNldEZhaWx1cmUoKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKCn0KCi8qCgogKiBzb3VyY2UgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Jsb2NrYml0c2lvLwoKICogQG5hbWUgICAgICAgIFByb3Bvc2FscyBDb250cmFjdAogKiBAcGFja2FnZSAgICAgQmxvY2tCaXRzSU8KICogQGF1dGhvciAgICAgIE1pY2t5IFNvY2FjaSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjAxNmM2ODYyNmE3ODQxNmY2ZTc2NmQ2ODc3NjQyZjczNmUiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgoKIENvbnRhaW5zIHRoZSBQcm9wb3NhbHMgQ29udHJhY3QgY29kZSBkZXBsb3llZCBhbmQgbGlua2VkIHRvIHRoZSBBcHBsaWNhdGlvbiBFbnRpdHkKCiovCgoKCgoKCgoKCgoKCgoKY29udHJhY3QgUHJvcG9zYWxzIGlzIEFwcGxpY2F0aW9uQXNzZXQgewoKICAgIEFwcGxpY2F0aW9uRW50aXR5QUJJIHB1YmxpYyBBcHBsaWNhdGlvbjsKICAgIEFCSUxpc3RpbmdDb250cmFjdCBwdWJsaWMgTGlzdGluZ0NvbnRyYWN0RW50aXR5OwogICAgQUJJRnVuZGluZyBwdWJsaWMgRnVuZGluZ0VudGl0eTsKICAgIEFCSUZ1bmRpbmdNYW5hZ2VyIHB1YmxpYyBGdW5kaW5nTWFuYWdlckVudGl0eTsKICAgIEFCSVRva2VuTWFuYWdlciBwdWJsaWMgVG9rZW5NYW5hZ2VyRW50aXR5OwogICAgQUJJVG9rZW4gcHVibGljIFRva2VuRW50aXR5OwogICAgQUJJTWlsZXN0b25lcyBwdWJsaWMgTWlsZXN0b25lc0VudGl0eTsKCiAgICBmdW5jdGlvbiBnZXRSZWNvcmRTdGF0ZShieXRlczMyIG5hbWUpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIFJlY29yZFN0YXRlc1tuYW1lXTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRBY3Rpb25UeXBlKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgpIHsKICAgICAgICByZXR1cm4gQWN0aW9uVHlwZXNbbmFtZV07CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UHJvcG9zYWxTdGF0ZSh1aW50MjU2IF9wcm9wb3NhbElkKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiBQcm9wb3NhbHNCeUlkW19wcm9wb3NhbElkXS5zdGF0ZTsKICAgIH0KCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQ4KSBwdWJsaWMgQWN0aW9uVHlwZXM7CgogICAgZnVuY3Rpb24gc2V0QWN0aW9uVHlwZXMoKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gb3duZXIgaW5pdGlhdGVkCiAgICAgICAgQWN0aW9uVHlwZXNbIk1JTEVTVE9ORV9ERUFETElORSJdID0gMTsKICAgICAgICBBY3Rpb25UeXBlc1siTUlMRVNUT05FX1BPU1RQT05JTkciXSA9IDI7CiAgICAgICAgQWN0aW9uVHlwZXNbIkVNRVJHRU5DWV9GVU5EX1JFTEVBU0UiXSA9IDYwOwogICAgICAgIEFjdGlvblR5cGVzWyJJTl9ERVZFTE9QTUVOVF9DT0RFX1VQR1JBREUiXSA9IDUwOwoKICAgICAgICAvLyBzaGFyZWhvbGRlciBpbml0aWF0ZWQKICAgICAgICBBY3Rpb25UeXBlc1siQUZURVJfQ09NUExFVEVfQ09ERV9VUEdSQURFIl0gPSA1MTsKICAgICAgICBBY3Rpb25UeXBlc1siUFJPSkVDVF9ERUxJU1RJTkciXSA9IDc1OwogICAgfQoKCiAgICBmdW5jdGlvbiBzZXRBc3NldFN0YXRlcygpIGludGVybmFsIHsKCiAgICAgICAgc2V0QWN0aW9uVHlwZXMoKTsKCiAgICAgICAgUmVjb3JkU3RhdGVzWyJORVciXSAgICAgICAgICAgICAgICAgPSAxOwogICAgICAgIFJlY29yZFN0YXRlc1siQUNDRVBUSU5HX1ZPVEVTIl0gICAgID0gMjsKICAgICAgICBSZWNvcmRTdGF0ZXNbIlZPVElOR19FTkRFRCJdICAgICAgICA9IDM7CiAgICAgICAgUmVjb3JkU3RhdGVzWyJWT1RJTkdfUkVTVUxUX1lFUyJdICAgPSAxMDsKICAgICAgICBSZWNvcmRTdGF0ZXNbIlZPVElOR19SRVNVTFRfTk8iXSAgICA9IDIwOwogICAgfQoKICAgIGV2ZW50IEV2ZW50TmV3UHJvcG9zYWxDcmVhdGVkICggYnl0ZXMzMiBpbmRleGVkIF9oYXNoLCB1aW50MjU2IGluZGV4ZWQgX3Byb3Bvc2FsSWQgKTsKCiAgICBmdW5jdGlvbiBydW5CZWZvcmVBcHBseWluZ1NldHRpbmdzKCkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJlcXVpcmVJbml0aWFsaXNlZAogICAgICAgIHJlcXVpcmVTZXR0aW5nc05vdEFwcGxpZWQKICAgIHsKICAgICAgICBhZGRyZXNzIEZ1bmRpbmdBZGRyZXNzID0gZ2V0QXBwbGljYXRpb25Bc3NldEFkZHJlc3NCeU5hbWUoJ0Z1bmRpbmcnKTsKICAgICAgICBGdW5kaW5nRW50aXR5ID0gQUJJRnVuZGluZyhGdW5kaW5nQWRkcmVzcyk7CgogICAgICAgIGFkZHJlc3MgRnVuZGluZ01hbmFnZXJBZGRyZXNzID0gZ2V0QXBwbGljYXRpb25Bc3NldEFkZHJlc3NCeU5hbWUoJ0Z1bmRpbmdNYW5hZ2VyJyk7CiAgICAgICAgRnVuZGluZ01hbmFnZXJFbnRpdHkgPSBBQklGdW5kaW5nTWFuYWdlcihGdW5kaW5nTWFuYWdlckFkZHJlc3MpOwoKICAgICAgICBhZGRyZXNzIFRva2VuTWFuYWdlckFkZHJlc3MgPSBnZXRBcHBsaWNhdGlvbkFzc2V0QWRkcmVzc0J5TmFtZSgnVG9rZW5NYW5hZ2VyJyk7CiAgICAgICAgVG9rZW5NYW5hZ2VyRW50aXR5ID0gQUJJVG9rZW5NYW5hZ2VyKFRva2VuTWFuYWdlckFkZHJlc3MpOwogICAgICAgIFRva2VuRW50aXR5ID0gQUJJVG9rZW4oVG9rZW5NYW5hZ2VyRW50aXR5LlRva2VuRW50aXR5KCkpOwoKICAgICAgICBhZGRyZXNzIExpc3RpbmdDb250cmFjdEFkZHJlc3MgPSBnZXRBcHBsaWNhdGlvbkFzc2V0QWRkcmVzc0J5TmFtZSgnTGlzdGluZ0NvbnRyYWN0Jyk7CiAgICAgICAgTGlzdGluZ0NvbnRyYWN0RW50aXR5ID0gQUJJTGlzdGluZ0NvbnRyYWN0KExpc3RpbmdDb250cmFjdEFkZHJlc3MpOwoKICAgICAgICBhZGRyZXNzIE1pbGVzdG9uZXNDb250cmFjdEFkZHJlc3MgPSBnZXRBcHBsaWNhdGlvbkFzc2V0QWRkcmVzc0J5TmFtZSgnTWlsZXN0b25lcycpOwogICAgICAgIE1pbGVzdG9uZXNFbnRpdHkgPSBBQklNaWxlc3RvbmVzKE1pbGVzdG9uZXNDb250cmFjdEFkZHJlc3MpOwoKICAgICAgICBFdmVudFJ1bkJlZm9yZUFwcGx5aW5nU2V0dGluZ3MoYXNzZXROYW1lKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCeWxhd3NQcm9wb3NhbFZvdGluZ0R1cmF0aW9uKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBnZXRBcHBCeWxhd1VpbnQyNTYoInByb3Bvc2FsX3ZvdGluZ19kdXJhdGlvbiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEJ5bGF3c01pbGVzdG9uZU1pblBvc3Rwb25pbmcoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGdldEFwcEJ5bGF3VWludDI1NigibWluX3Bvc3Rwb25pbmciKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRCeWxhd3NNaWxlc3RvbmVNYXhQb3N0cG9uaW5nKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBnZXRBcHBCeWxhd1VpbnQyNTYoIm1heF9wb3N0cG9uaW5nIik7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SGFzaCh1aW50OCBhY3Rpb25UeXBlLCBieXRlczMyIGFyZzEsIGJ5dGVzMzIgYXJnMikgcHVibGljIHB1cmUgcmV0dXJucyAoIGJ5dGVzMzIgKSB7CiAgICAgICAgcmV0dXJuIGtlY2NhazI1NihhY3Rpb25UeXBlLCBhcmcxLCBhcmcyKTsKICAgIH0KCgogICAgLy8gbmVlZCB0byBpbXBsZW1lbnQgYSB3YXkgdG8ganVzdCBpdGVyYXRlIHRocm91Z2ggYWN0aXZlIHByb3Bvc2FscywgYW5kIHJlbW92ZSB0aGUgb25lcyB3ZSBhbHJlYWR5IHByb2Nlc3NlZAogICAgLy8gb3RoZXJ3aXNlIHNvbWVvbmUgd2l0aCBtYWxpY2lvdXMgaW50ZW50IGNvdWxkIGFkZCBhIHRvbiBvZiBwcm9wb3NhbHMsIGp1c3QgdG8gbWFrZSBvdXIgY29udHJhY3QgY29zdCBhIHRvbiBvZiBnYXMuCgogICAgLy8gdG8gdGhhdCBlbmQsIHdlIGFsbG93IGluZGl2aWR1YWwgcHJvcG9zYWwgcHJvY2Vzc2luZy4gc28gdGhhdCB3ZSBkb24ndCBnZXQgYWZmZWN0ZWQgYnkgcGVvcGxlIHdpdGggdG9vIG11Y2gKICAgIC8vIG1vbmV5IGFuZCB0aW1lIG9uIHRoZWlyIGhhbmRzLgoKICAgIC8vIHdoZW5ldmVyIHRoZSBzeXN0ZW0gY3JlYXRlZCBhIHByb3Bvc2FsLCBpdCB3aWxsIHN0b3JlIHRoZSBpZCwgYW5kIHByb2Nlc3MgaXQgd2hlbiByZXF1aXJlZC4KCiAgICAvLyBub3QgdGhhdCBtdWNoIG9mIGFuIGlzc3VlIGF0IHRoaXMgc3RhZ2UgYmVjYXVzZToKICAgIC8vIE5PVzoKICAgIC8vIC0gb25seSB0aGUgc3lzdGVtIGNhbiBjcmVhdGUgLSBNSUxFU1RPTkVfREVBRExJTkUKICAgIC8vIC0gb25seSB0aGUgZGVwbG95ZXIgY2FuIGNyZWF0ZSAtIE1JTEVTVE9ORV9QT1NUUE9OSU5HIC8gRU1FUkdFTkNZX0ZVTkRfUkVMRUFTRSAvIElOX0RFVkVMT1BNRU5UX0NPREVfVVBHUkFERQoKICAgIC8vIEZVVFVSRToKICAgIC8vIC0gUFJPSkVDVF9ERUxJU1RJTkcgaXMgdGllZCBpbnRvIGFuIGV4aXN0aW5nICJsaXN0aW5nIGlkIiB3aGljaCB3aWxsIGJlIGNyZWF0ZWQgYnkgdGhlIHN5c3RlbSAoIGlmIHJlcXVlc3RlZCBieQogICAgLy8gc29tZW9uZSwgYnV0IGF0IHF1aXRlIGEgc2lnbmlmaWNhbnQgY29zdCApCiAgICAvLyAtIEFGVEVSX0NPTVBMRVRFX0NPREVfVVBHUkFERQoKICAgIG1hcHBpbmcgKHVpbnQ4ID0+IHVpbnQyNTYpIHB1YmxpYyBBY3RpdmVQcm9wb3NhbElkczsKICAgIHVpbnQ4IHB1YmxpYyBBY3RpdmVQcm9wb3NhbE51bSA9IDA7CgogICAgbWFwcGluZyAodWludDI1NiA9PiBib29sKSBwdWJsaWMgRXhwaXJlZFByb3Bvc2FsSWRzOwoKICAgIGZ1bmN0aW9uIHByb2Nlc3MoKSBwdWJsaWMgb25seUFwcGxpY2F0aW9uRW50aXR5IHsKICAgICAgICBmb3IodWludDggaSA9IDA7IGkgPCBBY3RpdmVQcm9wb3NhbE51bTsgaSsrKSB7CgogICAgICAgICAgICBpZigKICAgICAgICAgICAgICAgIGdldFByb3Bvc2FsVHlwZShBY3RpdmVQcm9wb3NhbElkc1tpXSkgPT0gZ2V0QWN0aW9uVHlwZSgiUFJPSkVDVF9ERUxJU1RJTkciKSB8fAogICAgICAgICAgICAgICAgZ2V0UHJvcG9zYWxUeXBlKEFjdGl2ZVByb3Bvc2FsSWRzW2ldKSA9PSBnZXRBY3Rpb25UeXBlKCJBRlRFUl9DT01QTEVURV9DT0RFX1VQR1JBREUiKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIFByb2Nlc3NWb3RlVG90YWxzKCBBY3RpdmVQcm9wb3NhbElkc1tpXSwgVm90ZUNvdW50UGVyUHJvY2VzcyApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gdHJ5IGV4cGlyeSBlbmRpbmcKICAgICAgICAgICAgICAgIHRyeUVuZFZvdGluZyhBY3RpdmVQcm9wb3NhbElkc1tpXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhc1JlcXVpcmVkU3RhdGVDaGFuZ2VzKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGZvcih1aW50OCBpID0gMDsgaSA8IEFjdGl2ZVByb3Bvc2FsTnVtOyBpKyspIHsKICAgICAgICAgICAgaWYoIG5lZWRzUHJvY2Vzc2luZyggQWN0aXZlUHJvcG9zYWxJZHNbaV0gKSApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSZXF1aXJlZFN0YXRlQ2hhbmdlcygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgaWYoaGFzUmVxdWlyZWRTdGF0ZUNoYW5nZXMoKSkgewogICAgICAgICAgICByZXR1cm4gQWN0aXZlUHJvcG9zYWxOdW07CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZENvZGVVcGdyYWRlUHJvcG9zYWwoYWRkcmVzcyBfYWRkciwgYnl0ZXMzMiBfc291cmNlQ29kZVVybCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlBcHBsaWNhdGlvbkVudGl0eSAgIC8vIHNoYXJlaG9sZGVyIGNoZWNrIGlzIGRvbmUgZGlyZWN0bHkgaW4gR2F0ZXdheSBieSBjYWxsaW5nIGFwcGxpY2F0aW9uRW50aXR5IHRvIGNvbmZpcm0KICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewoKICAgICAgICAvLyBoYXNoIGVuZm9yY2VzIG9ubHkgMSBwb3NzaWJsZSB2b3Rpbmcgb2YgdGhpcyB0eXBlIHBlciByZWNvcmQuCiAgICAgICAgLy8gYmFzaWNhbGx5IGlmIGEgdm90ZSBmYWlsZWQsIHlvdSBuZWVkIHRvIGRlcGxveSBpdCB3aXRoIGNoYW5nZXMgdG8gYSBuZXcgYWRkcmVzcy4gdGhhdCBzaW1wbGUuCgogICAgICAgIC8vIGRlcGVuZGluZyBvbiB0aGUgYXBwbGljYXRpb24gb3ZlcmFsbCBzdGF0ZSwgd2UgaGF2ZSAyIGRpZmZlcmVudCB2b3RpbmcgaW1wbGVtZW50YXRpb25zLgoKICAgICAgICB1aW50OCB0aGlzQWN0aW9uOwoKICAgICAgICBpZihnZXRBcHBsaWNhdGlvblN0YXRlKCkgPT0gZ2V0QXBwbGljYXRpb25FbnRpdHlTdGF0ZSgiSU5fREVWRUxPUE1FTlQiKSApIHsKICAgICAgICAgICAgdGhpc0FjdGlvbiA9IGdldEFjdGlvblR5cGUoIklOX0RFVkVMT1BNRU5UX0NPREVfVVBHUkFERSIpOwoKICAgICAgICB9IGVsc2UgaWYoZ2V0QXBwbGljYXRpb25TdGF0ZSgpID09IGdldEFwcGxpY2F0aW9uRW50aXR5U3RhdGUoIkRFVkVMT1BNRU5UX0NPTVBMRVRFIikgKSB7CiAgICAgICAgICAgIHRoaXNBY3Rpb24gPSBnZXRBY3Rpb25UeXBlKCJBRlRFUl9DT01QTEVURV9DT0RFX1VQR1JBREUiKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjcmVhdGVQcm9wb3NhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgIkNPREVfVVBHUkFERSIsCiAgICAgICAgICAgIGdldEhhc2goIHRoaXNBY3Rpb24sIGJ5dGVzMzIoX2FkZHIpLCAwICksCiAgICAgICAgICAgIHRoaXNBY3Rpb24sCiAgICAgICAgICAgIF9hZGRyLAogICAgICAgICAgICBfc291cmNlQ29kZVVybCwKICAgICAgICAgICAgMAogICAgICAgICk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGNyZWF0ZU1pbGVzdG9uZUFjY2VwdGFuY2VQcm9wb3NhbCgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5QXNzZXQoIk1pbGVzdG9uZXMiKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CgogICAgICAgIHVpbnQ4IHJlY29yZElkID0gTWlsZXN0b25lc0VudGl0eS5jdXJyZW50UmVjb3JkKCk7CiAgICAgICAgcmV0dXJuIGNyZWF0ZVByb3Bvc2FsKAogICAgICAgICAgICBtc2cuc2VuZGVyLAogICAgICAgICAgICAiTUlMRVNUT05FX0RFQURMSU5FIiwKICAgICAgICAgICAgZ2V0SGFzaCggZ2V0QWN0aW9uVHlwZSgiTUlMRVNUT05FX0RFQURMSU5FIiksIGJ5dGVzMzIoIHJlY29yZElkICksIDAgKSwKICAgICAgICAgICAgZ2V0QWN0aW9uVHlwZSgiTUlMRVNUT05FX0RFQURMSU5FIiksCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIHVpbnQyNTYocmVjb3JkSWQpCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVNaWxlc3RvbmVQb3N0cG9uaW5nUHJvcG9zYWwodWludDI1NiBfZHVyYXRpb24pCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RGVwbG95ZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIGlmKF9kdXJhdGlvbiA+PSBnZXRCeWxhd3NNaWxlc3RvbmVNaW5Qb3N0cG9uaW5nKCkgJiYgX2R1cmF0aW9uIDw9IGdldEJ5bGF3c01pbGVzdG9uZU1heFBvc3Rwb25pbmcoKSApIHsKCiAgICAgICAgICAgIHVpbnQ4IHJlY29yZElkID0gTWlsZXN0b25lc0VudGl0eS5jdXJyZW50UmVjb3JkKCk7CiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcm9wb3NhbCgKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgICAgICAiTUlMRVNUT05FX1BPU1RQT05JTkciLAogICAgICAgICAgICAgICAgZ2V0SGFzaCggZ2V0QWN0aW9uVHlwZSgiTUlMRVNUT05FX1BPU1RQT05JTkciKSwgYnl0ZXMzMiggcmVjb3JkSWQgKSwgMCApLAogICAgICAgICAgICAgICAgZ2V0QWN0aW9uVHlwZSgiTUlMRVNUT05FX1BPU1RQT05JTkciKSwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgX2R1cmF0aW9uCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRNaWxlc3RvbmVQb3N0cG9uaW5nUHJvcG9zYWxEdXJhdGlvbigpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50OCByZWNvcmRJZCA9IE1pbGVzdG9uZXNFbnRpdHkuY3VycmVudFJlY29yZCgpOwogICAgICAgIGJ5dGVzMzIgaGFzaCA9IGdldEhhc2goIGdldEFjdGlvblR5cGUoIk1JTEVTVE9ORV9QT1NUUE9OSU5HIiksIGJ5dGVzMzIoIHJlY29yZElkICksIDAgKTsKICAgICAgICBQcm9wb3NhbFJlY29yZCBtZW1vcnkgcHJvcG9zYWwgPSBQcm9wb3NhbHNCeUlkWyBQcm9wb3NhbElkQnlIYXNoW2hhc2hdIF07CiAgICAgICAgcmV0dXJuIHByb3Bvc2FsLmV4dHJhOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRNaWxlc3RvbmVQcm9wb3NhbFN0YXR1c0ZvclR5cGUodWludDggX2FjdGlvblR5cGUgKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCkgewoKICAgICAgICBpZihfYWN0aW9uVHlwZSA9PSBnZXRBY3Rpb25UeXBlKCJNSUxFU1RPTkVfREVBRExJTkUiKSB8fCBfYWN0aW9uVHlwZSA9PSBnZXRBY3Rpb25UeXBlKCJNSUxFU1RPTkVfUE9TVFBPTklORyIpKSB7CiAgICAgICAgICAgIHVpbnQ4IHJlY29yZElkID0gTWlsZXN0b25lc0VudGl0eS5jdXJyZW50UmVjb3JkKCk7CiAgICAgICAgICAgIGJ5dGVzMzIgaGFzaCA9IGdldEhhc2goIF9hY3Rpb25UeXBlLCBieXRlczMyKCByZWNvcmRJZCApLCAwICk7CiAgICAgICAgICAgIHVpbnQyNTYgUHJvcG9zYWxJZCA9IFByb3Bvc2FsSWRCeUhhc2hbaGFzaF07CiAgICAgICAgICAgIFByb3Bvc2FsUmVjb3JkIG1lbW9yeSBwcm9wb3NhbCA9IFByb3Bvc2Fsc0J5SWRbUHJvcG9zYWxJZF07CiAgICAgICAgICAgIHJldHVybiBwcm9wb3NhbC5zdGF0ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlRW1lcmdlbmN5RnVuZFJlbGVhc2VQcm9wb3NhbCgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5RGVwbG95ZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHJldHVybiBjcmVhdGVQcm9wb3NhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgIkVNRVJHRU5DWV9GVU5EX1JFTEVBU0UiLAogICAgICAgICAgICBnZXRIYXNoKCBnZXRBY3Rpb25UeXBlKCJFTUVSR0VOQ1lfRlVORF9SRUxFQVNFIiksIDAsIDAgKSwKICAgICAgICAgICAgZ2V0QWN0aW9uVHlwZSgiRU1FUkdFTkNZX0ZVTkRfUkVMRUFTRSIpLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwLAogICAgICAgICAgICAwCiAgICAgICAgKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVEZWxpc3RpbmdQcm9wb3NhbCh1aW50MjU2IF9wcm9qZWN0SWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5VG9rZW5Ib2xkZXIKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIGxldCdzIHZhbGlkYXRlIHRoZSBwcm9qZWN0IGlzIGFjdHVhbGx5IGxpc3RlZCBmaXJzdCBpbiBvcmRlciB0byByZW1vdmUgYW55IHNwYW1taW5nIGFiaWxpdHkuCiAgICAgICAgaWYoIExpc3RpbmdDb250cmFjdEVudGl0eS5jYW5CZURlbGlzdGVkKF9wcm9qZWN0SWQpID09IHRydWUpIHsKCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQcm9wb3NhbCgKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIsCiAgICAgICAgICAgICAgICAiUFJPSkVDVF9ERUxJU1RJTkciLAogICAgICAgICAgICAgICAgZ2V0SGFzaCggZ2V0QWN0aW9uVHlwZSgiUFJPSkVDVF9ERUxJU1RJTkciKSwgYnl0ZXMzMihfcHJvamVjdElkKSwgMCApLAogICAgICAgICAgICAgICAgZ2V0QWN0aW9uVHlwZSgiUFJPSkVDVF9ERUxJU1RJTkciKSwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgX3Byb2plY3RJZAogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KCiAgICBtb2RpZmllciBvbmx5VG9rZW5Ib2xkZXIoKSB7CiAgICAgICAgcmVxdWlyZSggZ2V0VG90YWxUb2tlblZvdGluZ1Bvd2VyKG1zZy5zZW5kZXIpID4gMCApOwogICAgICAgIF87CiAgICB9CgogICAgc3RydWN0IFByb3Bvc2FsUmVjb3JkIHsKICAgICAgICBhZGRyZXNzIGNyZWF0b3I7CiAgICAgICAgYnl0ZXMzMiBuYW1lOwogICAgICAgIHVpbnQ4IGFjdGlvblR5cGU7CiAgICAgICAgdWludDggc3RhdGU7CiAgICAgICAgYnl0ZXMzMiBoYXNoOyAgICAgICAgICAgICAgICAgICAgICAgLy8gYWN0aW9uIG5hbWUgKyBhcmdzIGhhc2gKICAgICAgICBhZGRyZXNzIGFkZHI7CiAgICAgICAgYnl0ZXMzMiBzb3VyY2VDb2RlVXJsOwogICAgICAgIHVpbnQyNTYgZXh0cmE7CiAgICAgICAgdWludDI1NiB0aW1lX3N0YXJ0OwogICAgICAgIHVpbnQyNTYgdGltZV9lbmQ7CiAgICAgICAgdWludDI1NiBpbmRleDsKICAgIH0KCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IFByb3Bvc2FsUmVjb3JkKSBwdWJsaWMgUHJvcG9zYWxzQnlJZDsKICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gdWludDI1NikgcHVibGljIFByb3Bvc2FsSWRCeUhhc2g7CgogICAgZnVuY3Rpb24gY3JlYXRlUHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfY3JlYXRvciwKICAgICAgICBieXRlczMyIF9uYW1lLAogICAgICAgIGJ5dGVzMzIgX2hhc2gsCiAgICAgICAgdWludDggICBfYWN0aW9uLAogICAgICAgIGFkZHJlc3MgX2FkZHIsCiAgICAgICAgYnl0ZXMzMiBfc291cmNlQ29kZVVybCwKICAgICAgICB1aW50MjU2IF9leHRyYQogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKCiAgICAgICAgLy8gaWYoX2FjdGlvbiA+IDApIHsKCiAgICAgICAgaWYoUHJvcG9zYWxJZEJ5SGFzaFtfaGFzaF0gPT0gMCkgewoKICAgICAgICAgICAgUHJvcG9zYWxSZWNvcmQgc3RvcmFnZSBwcm9wb3NhbCA9IFByb3Bvc2Fsc0J5SWRbKytSZWNvcmROdW1dOwogICAgICAgICAgICBwcm9wb3NhbC5jcmVhdG9yICAgICAgICA9IF9jcmVhdG9yOwogICAgICAgICAgICBwcm9wb3NhbC5uYW1lICAgICAgICAgICA9IF9uYW1lOwogICAgICAgICAgICBwcm9wb3NhbC5hY3Rpb25UeXBlICAgICA9IF9hY3Rpb247CiAgICAgICAgICAgIHByb3Bvc2FsLmFkZHIgICAgICAgICAgID0gX2FkZHI7CiAgICAgICAgICAgIHByb3Bvc2FsLnNvdXJjZUNvZGVVcmwgID0gX3NvdXJjZUNvZGVVcmw7CiAgICAgICAgICAgIHByb3Bvc2FsLmV4dHJhICAgICAgICAgID0gX2V4dHJhOwogICAgICAgICAgICBwcm9wb3NhbC5oYXNoICAgICAgICAgICA9IF9oYXNoOwogICAgICAgICAgICBwcm9wb3NhbC5zdGF0ZSAgICAgICAgICA9IGdldFJlY29yZFN0YXRlKCJORVciKTsKICAgICAgICAgICAgcHJvcG9zYWwudGltZV9zdGFydCAgICAgPSBnZXRUaW1lc3RhbXAoKTsKICAgICAgICAgICAgcHJvcG9zYWwudGltZV9lbmQgICAgICAgPSBnZXRUaW1lc3RhbXAoKSArIGdldEJ5bGF3c1Byb3Bvc2FsVm90aW5nRHVyYXRpb24oKTsKICAgICAgICAgICAgcHJvcG9zYWwuaW5kZXggICAgICAgICAgPSBSZWNvcmROdW07CgogICAgICAgICAgICBQcm9wb3NhbElkQnlIYXNoW19oYXNoXSA9IFJlY29yZE51bTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gYWxyZWFkeSBleGlzdHMhCiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KCiAgICAgICAgaW5pdFByb3Bvc2FsVm90aW5nKFJlY29yZE51bSk7CiAgICAgICAgRXZlbnROZXdQcm9wb3NhbENyZWF0ZWQgKCBfaGFzaCwgUmVjb3JkTnVtICk7CiAgICAgICAgcmV0dXJuIFJlY29yZE51bTsKCiAgICAgICAgLyoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBubyBhY3Rpb24/IQogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgKi8KICAgIH0KCiAgICBmdW5jdGlvbiBhY2NlcHRDb2RlVXBncmFkZSh1aW50MjU2IF9wcm9wb3NhbElkKSBpbnRlcm5hbCB7CiAgICAgICAgUHJvcG9zYWxSZWNvcmQgc3RvcmFnZSBwcm9wb3NhbCA9IFByb3Bvc2Fsc0J5SWRbX3Byb3Bvc2FsSWRdOwogICAgICAgIC8vIHJlaW5pdGlhbGl6ZSB0aGlzIGVhY2ggdGltZSwgYmVjYXVzZSB3ZSByZWx5IG9uICJvd25lciIgYXMgdGhlIGFkZHJlc3MsIGFuZCBpdCB3aWxsIGNoYW5nZQogICAgICAgIEFwcGxpY2F0aW9uID0gQXBwbGljYXRpb25FbnRpdHlBQkkob3duZXIpOwogICAgICAgIEFwcGxpY2F0aW9uLmFjY2VwdENvZGVVcGdyYWRlUHJvcG9zYWwocHJvcG9zYWwuYWRkcik7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGluaXRQcm9wb3NhbFZvdGluZyh1aW50MjU2IF9wcm9wb3NhbElkKSBpbnRlcm5hbCB7CgogICAgICAgIFJlc3VsdFJlY29yZCBzdG9yYWdlIHJlc3VsdCA9IFJlc3VsdHNCeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdOwogICAgICAgIFByb3Bvc2FsUmVjb3JkIHN0b3JhZ2UgcHJvcG9zYWwgPSBQcm9wb3NhbHNCeUlkW19wcm9wb3NhbElkXTsKCiAgICAgICAgaWYoZ2V0QXBwbGljYXRpb25TdGF0ZSgpID09IGdldEFwcGxpY2F0aW9uRW50aXR5U3RhdGUoIklOX0RFVkVMT1BNRU5UIikgKSB7CgogICAgICAgICAgICBpZihwcm9wb3NhbC5hY3Rpb25UeXBlID09IGdldEFjdGlvblR5cGUoIlBST0pFQ1RfREVMSVNUSU5HIikgKSB7CiAgICAgICAgICAgICAgICAvLyB3aGlsZSBpbiBkZXZlbG9wbWVudCBwcm9qZWN0IGRlbGlzdGluZyBjYW4gYmUgdm90ZWQgYnkgYWxsIGF2YWlsYWJsZSB0b2tlbnMsIGV4Y2VwdCBvd25lcgogICAgICAgICAgICAgICAgdWludDI1NiBvd25lckxvY2tlZFRva2VucyA9IFRva2VuRW50aXR5LmJhbGFuY2VPZihUb2tlbk1hbmFnZXJFbnRpdHkpOwogICAgICAgICAgICAgICAgcmVzdWx0LnRvdGFsQXZhaWxhYmxlID0gVG9rZW5FbnRpdHkudG90YWxTdXBwbHkoKSAtIG93bmVyTG9ja2VkVG9rZW5zOwoKICAgICAgICAgICAgICAgIC8vIHNpbmNlIHdlJ3JlIGNvdW50aW5nIHVubG9ja2VkIHRva2Vucywgd2UgbmVlZCB0byByZWNvdW50IHZvdGVzIGVhY2ggdGltZSB3ZSB3YW50IHRvIGVuZCB0aGUgdm90aW5nIHBlcmlvZAogICAgICAgICAgICAgICAgcmVzdWx0LnJlcXVpcmVzQ291bnRpbmcgPSB0cnVlOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGFueSBvdGhlciBwcm9wb3NhbCBpcyBvbmx5IHZvdGVkIGJ5ICJsb2NrZWQgZXRoZXIiLCB0aHVzIHdlIHVzZSBsb2NrZWQgdG9rZW5zCiAgICAgICAgICAgICAgICByZXN1bHQudG90YWxBdmFpbGFibGUgPSBGdW5kaW5nTWFuYWdlckVudGl0eS5Mb2NrZWRWb3RpbmdUb2tlbnMoKTsKCiAgICAgICAgICAgICAgICAvLyBsb2NrZWQgdG9rZW5zIGRvIG5vdCByZXF1aXJlIHJlY291bnRpbmcuCiAgICAgICAgICAgICAgICByZXN1bHQucmVxdWlyZXNDb3VudGluZyA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZSBpZihnZXRBcHBsaWNhdGlvblN0YXRlKCkgPT0gZ2V0QXBwbGljYXRpb25FbnRpdHlTdGF0ZSgiREVWRUxPUE1FTlRfQ09NUExFVEUiKSApIHsKICAgICAgICAgICAgLy8gcmVtb3ZlIHJlc2lkdWFsIHRva2VuIGJhbGFuY2UgZnJvbSBUb2tlbk1hbmFnZXJFbnRpdHkuCiAgICAgICAgICAgIHVpbnQyNTYgcmVzaWR1YWxMb2NrZWRUb2tlbnMgPSBUb2tlbkVudGl0eS5iYWxhbmNlT2YoVG9rZW5NYW5hZ2VyRW50aXR5KTsKICAgICAgICAgICAgcmVzdWx0LnRvdGFsQXZhaWxhYmxlID0gVG9rZW5FbnRpdHkudG90YWxTdXBwbHkoKSAtIHJlc2lkdWFsTG9ja2VkVG9rZW5zOwoKICAgICAgICAgICAgLy8gc2luY2Ugd2UncmUgY291bnRpbmcgdW5sb2NrZWQgdG9rZW5zLCB3ZSBuZWVkIHRvIHJlY291bnQgdm90ZXMgZWFjaCB0aW1lIHdlIHdhbnQgdG8gZW5kIHRoZSB2b3RpbmcgcGVyaW9kCiAgICAgICAgICAgIHJlc3VsdC5yZXF1aXJlc0NvdW50aW5nID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnJlcXVpcmVkRm9yUmVzdWx0ID0gcmVzdWx0LnRvdGFsQXZhaWxhYmxlIC8gMjsgICAvLyA1MCUKCiAgICAgICAgcHJvcG9zYWwuc3RhdGUgPSBnZXRSZWNvcmRTdGF0ZSgiQUNDRVBUSU5HX1ZPVEVTIik7CiAgICAgICAgYWRkQWN0aXZlUHJvcG9zYWwoX3Byb3Bvc2FsSWQpOwoKICAgICAgICB0cnlGaW5hbGlzZU5vbkxvY2tlZFRva2Vuc1Byb3Bvc2FsKF9wcm9wb3NhbElkKTsKICAgIH0KCgoKICAgIC8qCgogICAgVm90aW5nCgogICAgKi8KCiAgICBzdHJ1Y3QgVm90ZVN0cnVjdCB7CiAgICAgICAgYWRkcmVzcyB2b3RlcjsKICAgICAgICB1aW50MjU2IHRpbWU7CiAgICAgICAgYm9vbCAgICB2b3RlOwogICAgICAgIHVpbnQyNTYgcG93ZXI7CiAgICAgICAgYm9vbCAgICBhbm51bGxlZDsKICAgICAgICB1aW50MjU2IGluZGV4OwogICAgfQoKICAgIHN0cnVjdCBSZXN1bHRSZWNvcmQgewogICAgICAgIHVpbnQyNTYgdG90YWxBdmFpbGFibGU7CiAgICAgICAgdWludDI1NiByZXF1aXJlZEZvclJlc3VsdDsKICAgICAgICB1aW50MjU2IHRvdGFsU29GYXI7CiAgICAgICAgdWludDI1NiB5ZXM7CiAgICAgICAgdWludDI1NiBubzsKICAgICAgICBib29sICAgIHJlcXVpcmVzQ291bnRpbmc7CiAgICB9CgoKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gbWFwcGluZyAodWludDI1NiA9PiBWb3RlU3RydWN0KSApIHB1YmxpYyBWb3Rlc0J5UHJvcG9zYWxJZDsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiBWb3RlU3RydWN0KSApIHB1YmxpYyBWb3Rlc0J5Q2FzdGVyOwogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2ICkgcHVibGljIFZvdGVzTnVtQnlQcm9wb3NhbElkOwogICAgbWFwcGluZyAodWludDI1NiA9PiBSZXN1bHRSZWNvcmQgKSBwdWJsaWMgUmVzdWx0c0J5UHJvcG9zYWxJZDsKCiAgICBmdW5jdGlvbiBSZWdpc3RlclZvdGUodWludDI1NiBfcHJvcG9zYWxJZCwgYm9vbCBfbXlWb3RlKSBwdWJsaWMgewogICAgICAgIGFkZHJlc3MgVm90ZXIgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyBnZXQgdm90aW5nIHBvd2VyCiAgICAgICAgdWludDI1NiBWb3RlclBvd2VyID0gZ2V0Vm90aW5nUG93ZXIoX3Byb3Bvc2FsSWQsIFZvdGVyKTsKCiAgICAgICAgLy8gZ2V0IHByb3Bvc2FsIGZvciBzdGF0ZQogICAgICAgIFByb3Bvc2FsUmVjb3JkIHN0b3JhZ2UgcHJvcG9zYWwgPSBQcm9wb3NhbHNCeUlkW19wcm9wb3NhbElkXTsKCiAgICAgICAgLy8gbWFrZSBzdXJlIHZvdGluZyBwb3dlciBpcyBncmVhdGVyIHRoYW4gMAogICAgICAgIC8vIG1ha2Ugc3VyZSBwcm9wb3NhbC5zdGF0ZSBhbGxvd3MgcmVjZWl2aW5nIHZvdGVzCiAgICAgICAgLy8gbWFrZSBzdXJlIHByb3Bvc2FsLnRpbWVfZW5kIGhhcyBub3QgcGFzc2VkLgoKICAgICAgICBpZihWb3RlclBvd2VyID4gMCAmJiBwcm9wb3NhbC5zdGF0ZSA9PSBnZXRSZWNvcmRTdGF0ZSgiQUNDRVBUSU5HX1ZPVEVTIikpIHsKCiAgICAgICAgICAgIC8vIGZpcnN0IGNoZWNrIGlmIHRoaXMgVm90ZXIgaGFzIGEgcmVjb3JkIHJlZ2lzdGVyZWQsCiAgICAgICAgICAgIC8vIGFuZCBpZiB0aGV5IGRpZCwgYW5udWwgaW5pdGlhbCB2b3RlLCB1cGRhdGUgcmVzdWx0cywgYW5kIGFkZCBuZXcgb25lCiAgICAgICAgICAgIGlmKCBoYXNQcmV2aW91c1ZvdGUoX3Byb3Bvc2FsSWQsIFZvdGVyKSApIHsKICAgICAgICAgICAgICAgIHVuZG9QcmV2aW91c1ZvdGUoX3Byb3Bvc2FsSWQsIFZvdGVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVnaXN0ZXJOZXdWb3RlKF9wcm9wb3NhbElkLCBWb3RlciwgX215Vm90ZSwgVm90ZXJQb3dlcik7CgogICAgICAgICAgICAvLyB0aGlzIGlzIHdoZXJlIHdlIGNhbiBlbmQgdm90aW5nIGJlZm9yZSB0aW1lIGlmIHJlc3VsdC55ZXMgb3IgcmVzdWx0Lm5vID4gdG90YWxTb0ZhcgogICAgICAgICAgICB0cnlFbmRWb3RpbmcoX3Byb3Bvc2FsSWQpOwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaGFzUHJldmlvdXNWb3RlKHVpbnQyNTYgX3Byb3Bvc2FsSWQsIGFkZHJlc3MgX3ZvdGVyKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgVm90ZVN0cnVjdCBzdG9yYWdlIHByZXZpb3VzVm90ZUJ5Q2FzdGVyID0gVm90ZXNCeUNhc3RlcltfcHJvcG9zYWxJZF1bX3ZvdGVyXTsKICAgICAgICBpZiggcHJldmlvdXNWb3RlQnlDYXN0ZXIucG93ZXIgPiAwICkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIHVuZG9QcmV2aW91c1ZvdGUodWludDI1NiBfcHJvcG9zYWxJZCwgYWRkcmVzcyBfdm90ZXIpIGludGVybmFsIHsKCiAgICAgICAgVm90ZVN0cnVjdCBzdG9yYWdlIHByZXZpb3VzVm90ZUJ5Q2FzdGVyID0gVm90ZXNCeUNhc3RlcltfcHJvcG9zYWxJZF1bX3ZvdGVyXTsKCiAgICAgICAgLy8gaWYoIHByZXZpb3VzVm90ZUJ5Q2FzdGVyLnBvd2VyID4gMCApIHsKICAgICAgICAgICAgcHJldmlvdXNWb3RlQnlDYXN0ZXIuYW5udWxsZWQgPSB0cnVlOwoKICAgICAgICAgICAgVm90ZVN0cnVjdCBzdG9yYWdlIHByZXZpb3VzVm90ZUJ5UHJvcG9zYWxJZCA9IFZvdGVzQnlQcm9wb3NhbElkW19wcm9wb3NhbElkXVtwcmV2aW91c1ZvdGVCeUNhc3Rlci5pbmRleF07CiAgICAgICAgICAgIHByZXZpb3VzVm90ZUJ5UHJvcG9zYWxJZC5hbm51bGxlZCA9IHRydWU7CgogICAgICAgICAgICBSZXN1bHRSZWNvcmQgc3RvcmFnZSByZXN1bHQgPSBSZXN1bHRzQnlQcm9wb3NhbElkW19wcm9wb3NhbElkXTsKCiAgICAgICAgICAgIC8vIHVwZGF0ZSB0b3RhbCBzbyBmYXIgYXMgd2VsbAogICAgICAgICAgICByZXN1bHQudG90YWxTb0Zhci09IHByZXZpb3VzVm90ZUJ5UHJvcG9zYWxJZC5wb3dlcjsKCiAgICAgICAgICAgIGlmKHByZXZpb3VzVm90ZUJ5UHJvcG9zYWxJZC52b3RlID09IHRydWUpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC55ZXMtPSBwcmV2aW91c1ZvdGVCeVByb3Bvc2FsSWQucG93ZXI7CiAgICAgICAgICAgIC8vIH0gZWxzZSBpZihwcmV2aW91c1ZvdGVCeVByb3Bvc2FsSWQudm90ZSA9PSBmYWxzZSkgewogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVzdWx0Lm5vLT0gcHJldmlvdXNWb3RlQnlQcm9wb3NhbElkLnBvd2VyOwogICAgICAgICAgICB9CiAgICAgICAgLy8gfQoKICAgIH0KCiAgICBmdW5jdGlvbiByZWdpc3Rlck5ld1ZvdGUodWludDI1NiBfcHJvcG9zYWxJZCwgYWRkcmVzcyBfdm90ZXIsIGJvb2wgX215Vm90ZSwgdWludDI1NiBfcG93ZXIpIGludGVybmFsIHsKCiAgICAgICAgLy8gaGFuZGxlIG5ldyB2b3RlCiAgICAgICAgdWludDI1NiBjdXJyZW50Vm90ZUlkID0gVm90ZXNOdW1CeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdKys7CiAgICAgICAgVm90ZVN0cnVjdCBzdG9yYWdlIHZvdGUgPSBWb3Rlc0J5UHJvcG9zYWxJZFtfcHJvcG9zYWxJZF1bY3VycmVudFZvdGVJZF07CiAgICAgICAgICAgIHZvdGUudm90ZXIgPSBfdm90ZXI7CiAgICAgICAgICAgIHZvdGUudGltZSA9IGdldFRpbWVzdGFtcCgpOwogICAgICAgICAgICB2b3RlLnZvdGUgPSBfbXlWb3RlOwogICAgICAgICAgICB2b3RlLnBvd2VyID0gX3Bvd2VyOwogICAgICAgICAgICB2b3RlLmluZGV4ID0gY3VycmVudFZvdGVJZDsKCiAgICAgICAgVm90ZXNCeUNhc3RlcltfcHJvcG9zYWxJZF1bX3ZvdGVyXSA9IFZvdGVzQnlQcm9wb3NhbElkW19wcm9wb3NhbElkXVtjdXJyZW50Vm90ZUlkXTsKCiAgICAgICAgYWRkVm90ZUludG9SZXN1bHQoX3Byb3Bvc2FsSWQsIF9teVZvdGUsIF9wb3dlciApOwogICAgfQoKICAgIGV2ZW50IEV2ZW50QWRkVm90ZUludG9SZXN1bHQgKCB1aW50MjU2IGluZGV4ZWQgX3Byb3Bvc2FsSWQsIGJvb2wgaW5kZXhlZCBfdHlwZSwgdWludDI1NiBpbmRleGVkIF9wb3dlciApOwoKICAgIGZ1bmN0aW9uIGFkZFZvdGVJbnRvUmVzdWx0KHVpbnQyNTYgX3Byb3Bvc2FsSWQsIGJvb2wgX3R5cGUsIHVpbnQyNTYgX3Bvd2VyICkgaW50ZXJuYWwgewoKICAgICAgICBFdmVudEFkZFZvdGVJbnRvUmVzdWx0KF9wcm9wb3NhbElkLCBfdHlwZSwgX3Bvd2VyICk7CgogICAgICAgIFJlc3VsdFJlY29yZCBzdG9yYWdlIG5ld1Jlc3VsdCA9IFJlc3VsdHNCeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdOwogICAgICAgIG5ld1Jlc3VsdC50b3RhbFNvRmFyKz0gX3Bvd2VyOwogICAgICAgIGlmKF90eXBlID09IHRydWUpIHsKICAgICAgICAgICAgbmV3UmVzdWx0Lnllcys9IF9wb3dlcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdSZXN1bHQubm8rPSBfcG93ZXI7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRvdGFsVG9rZW5Wb3RpbmdQb3dlcihhZGRyZXNzIF92b3RlcikgcHVibGljIHZpZXcgcmV0dXJucyAoIHVpbnQyNTYgKSB7CiAgICAgICAgYWRkcmVzcyBWYXVsdEFkZHJlc3MgPSBGdW5kaW5nTWFuYWdlckVudGl0eS5nZXRNeVZhdWx0QWRkcmVzcyhfdm90ZXIpOwogICAgICAgIHVpbnQyNTYgVm90aW5nUG93ZXIgPSBUb2tlbkVudGl0eS5iYWxhbmNlT2YoVmF1bHRBZGRyZXNzKTsKICAgICAgICBWb3RpbmdQb3dlcis9IFRva2VuRW50aXR5LmJhbGFuY2VPZihfdm90ZXIpOwogICAgICAgIHJldHVybiBWb3RpbmdQb3dlcjsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRWb3RpbmdQb3dlcih1aW50MjU2IF9wcm9wb3NhbElkLCBhZGRyZXNzIF92b3RlcikgcHVibGljIHZpZXcgcmV0dXJucyAoIHVpbnQyNTYgKSB7CiAgICAgICAgdWludDI1NiBWb3RpbmdQb3dlciA9IDA7CiAgICAgICAgUHJvcG9zYWxSZWNvcmQgc3RvcmFnZSBwcm9wb3NhbCA9IFByb3Bvc2Fsc0J5SWRbX3Byb3Bvc2FsSWRdOwoKICAgICAgICBpZihwcm9wb3NhbC5hY3Rpb25UeXBlID09IGdldEFjdGlvblR5cGUoIkFGVEVSX0NPTVBMRVRFX0NPREVfVVBHUkFERSIpKSB7CgogICAgICAgICAgICByZXR1cm4gVG9rZW5FbnRpdHkuYmFsYW5jZU9mKF92b3Rlcik7CgogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICBhZGRyZXNzIFZhdWx0QWRkcmVzcyA9IEZ1bmRpbmdNYW5hZ2VyRW50aXR5LmdldE15VmF1bHRBZGRyZXNzKF92b3Rlcik7CiAgICAgICAgICAgIGlmKFZhdWx0QWRkcmVzcyAhPSBhZGRyZXNzKDB4MCkpIHsKICAgICAgICAgICAgICAgIFZvdGluZ1Bvd2VyID0gVG9rZW5FbnRpdHkuYmFsYW5jZU9mKFZhdWx0QWRkcmVzcyk7CgogICAgICAgICAgICAgICAgaWYoIHByb3Bvc2FsLmFjdGlvblR5cGUgPT0gZ2V0QWN0aW9uVHlwZSgiUFJPSkVDVF9ERUxJU1RJTkciKSApIHsKICAgICAgICAgICAgICAgICAgICAvLyBmb3IgcHJvamVjdCBkZWxpc3RpbmcsIHdlIHdhbnQgdG8gYWxzbyBpbmNsdWRlIHRva2VucyBpbiB0aGUgdm90ZXIncyB3YWxsZXQuCiAgICAgICAgICAgICAgICAgICAgVm90aW5nUG93ZXIrPSBUb2tlbkVudGl0eS5iYWxhbmNlT2YoX3ZvdGVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gVm90aW5nUG93ZXI7CiAgICB9CgoKICAgIG1hcHBpbmcoIHVpbnQyNTYgPT4gdWludDI1NiApIHB1YmxpYyBsYXN0UHJvY2Vzc2VkVm90ZUlkQnlQcm9wb3NhbDsKICAgIG1hcHBpbmcoIHVpbnQyNTYgPT4gdWludDI1NiApIHB1YmxpYyBQcm9jZXNzZWRWb3Rlc0J5UHJvcG9zYWw7CiAgICBtYXBwaW5nKCB1aW50MjU2ID0+IHVpbnQyNTYgKSBwdWJsaWMgVm90ZUNvdW50QXRQcm9jZXNzaW5nU3RhcnRCeVByb3Bvc2FsOwogICAgdWludDI1NiBwdWJsaWMgVm90ZUNvdW50UGVyUHJvY2VzcyA9IDEwOwoKICAgIGZ1bmN0aW9uIHNldFZvdGVDb3VudFBlclByb2Nlc3ModWludDI1NiBfcGVyUHJvY2VzcykgZXh0ZXJuYWwgb25seURlcGxveWVyIHsKICAgICAgICBpZihfcGVyUHJvY2VzcyA+IDApIHsKICAgICAgICAgICAgVm90ZUNvdW50UGVyUHJvY2VzcyA9IF9wZXJQcm9jZXNzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KCiAgICBldmVudCBFdmVudFByb2Nlc3NWb3RlVG90YWxzICggdWludDI1NiBpbmRleGVkIF9wcm9wb3NhbElkLCB1aW50MjU2IGluZGV4ZWQgc3RhcnQsIHVpbnQyNTYgaW5kZXhlZCBlbmQgKTsKCiAgICBmdW5jdGlvbiBQcm9jZXNzVm90ZVRvdGFscyh1aW50MjU2IF9wcm9wb3NhbElkLCB1aW50MjU2IGxlbmd0aCkgcHVibGljIG9ubHlBcHBsaWNhdGlvbkVudGl0eSB7CgogICAgICAgIHVpbnQyNTYgc3RhcnQgPSBsYXN0UHJvY2Vzc2VkVm90ZUlkQnlQcm9wb3NhbFtfcHJvcG9zYWxJZF0gKyAxOwogICAgICAgIHVpbnQyNTYgZW5kID0gc3RhcnQgKyBsZW5ndGggLSAxOwogICAgICAgIGlmKGVuZCA+IFZvdGVzTnVtQnlQcm9wb3NhbElkW19wcm9wb3NhbElkXSkgewogICAgICAgICAgICBlbmQgPSBWb3Rlc051bUJ5UHJvcG9zYWxJZFtfcHJvcG9zYWxJZF07CiAgICAgICAgfQoKICAgICAgICBFdmVudFByb2Nlc3NWb3RlVG90YWxzKF9wcm9wb3NhbElkLCBzdGFydCwgZW5kKTsKCiAgICAgICAgLy8gZmlyc3QgcnVuCiAgICAgICAgaWYoc3RhcnQgPT0gMSkgewogICAgICAgICAgICAvLyBzYXZlIHZvdGUgY291bnQgYXQgc3RhcnQsIHNvIHdlIGNhbiByZXNldCBpZiBpdCBjaGFuZ2VzCiAgICAgICAgICAgIFZvdGVDb3VudEF0UHJvY2Vzc2luZ1N0YXJ0QnlQcm9wb3NhbFtfcHJvcG9zYWxJZF0gPSBWb3Rlc051bUJ5UHJvcG9zYWxJZFtfcHJvcG9zYWxJZF07CgogICAgICAgICAgICAvLyByZXNldCB2b3RlIHRvdGFscyB0byAwCiAgICAgICAgICAgIFJlc3VsdFJlY29yZCBzdG9yYWdlIHJlc3VsdCA9IFJlc3VsdHNCeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdOwogICAgICAgICAgICByZXN1bHQueWVzID0gMDsKICAgICAgICAgICAgcmVzdWx0Lm5vID0gMDsKICAgICAgICAgICAgcmVzdWx0LnRvdGFsU29GYXIgPSAwOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVzZXQgdG8gc3RhcnQgaWYgdm90ZSBjb3VudCBoYXMgY2hhbmdlZCBpbiB0aGUgbWlkZGxlIG9mIHByb2Nlc3NpbmcgcnVuCiAgICAgICAgaWYoVm90ZUNvdW50QXRQcm9jZXNzaW5nU3RhcnRCeVByb3Bvc2FsW19wcm9wb3NhbElkXSAhPSBWb3Rlc051bUJ5UHJvcG9zYWxJZFtfcHJvcG9zYWxJZF0pIHsKICAgICAgICAgICAgLy8gd2UgcmVjZWl2ZWQgdm90ZXMgd2hpbGUgY291bnRpbmcKICAgICAgICAgICAgLy8gcmVzZXQgZnJvbSBzdGFydAogICAgICAgICAgICBsYXN0UHJvY2Vzc2VkVm90ZUlkQnlQcm9wb3NhbFtfcHJvcG9zYWxJZF0gPSAwOwogICAgICAgICAgICAvLyBleGl0CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGZvcih1aW50MjU2IGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykgewoKICAgICAgICAgICAgVm90ZVN0cnVjdCBzdG9yYWdlIHZvdGUgPSBWb3Rlc0J5UHJvcG9zYWxJZFtfcHJvcG9zYWxJZF1baSAtIDFdOwogICAgICAgICAgICAvLyBwcm9jZXNzIHZvdGUgaW50byB0b3RhbHMuCiAgICAgICAgICAgIGlmKHZvdGUuYW5udWxsZWQgIT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgYWRkVm90ZUludG9SZXN1bHQoX3Byb3Bvc2FsSWQsIHZvdGUudm90ZSwgdm90ZS5wb3dlciApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYXN0UHJvY2Vzc2VkVm90ZUlkQnlQcm9wb3NhbFtfcHJvcG9zYWxJZF0rKzsKICAgICAgICB9CgogICAgICAgIC8vIHJlc2V0IGl0ZXJhdG9yIHNvIHdlIGNhbiBjYWxsIGl0IGFnYWluLgogICAgICAgIGlmKGxhc3RQcm9jZXNzZWRWb3RlSWRCeVByb3Bvc2FsW19wcm9wb3NhbElkXSA+PSBWb3Rlc051bUJ5UHJvcG9zYWxJZFtfcHJvcG9zYWxJZF0gKSB7CgogICAgICAgICAgICBQcm9jZXNzZWRWb3Rlc0J5UHJvcG9zYWxbX3Byb3Bvc2FsSWRdID0gbGFzdFByb2Nlc3NlZFZvdGVJZEJ5UHJvcG9zYWxbX3Byb3Bvc2FsSWRdOwogICAgICAgICAgICBsYXN0UHJvY2Vzc2VkVm90ZUlkQnlQcm9wb3NhbFtfcHJvcG9zYWxJZF0gPSAwOwogICAgICAgICAgICB0cnlFbmRWb3RpbmcoX3Byb3Bvc2FsSWQpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjYW5FbmRWb3RpbmcodWludDI1NiBfcHJvcG9zYWxJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICBSZXN1bHRSZWNvcmQgbWVtb3J5IHJlc3VsdCA9IFJlc3VsdHNCeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdOwogICAgICAgIGlmKHJlc3VsdC5yZXF1aXJlc0NvdW50aW5nID09IGZhbHNlKSB7CiAgICAgICAgICAgIGlmKHJlc3VsdC55ZXMgPiByZXN1bHQucmVxdWlyZWRGb3JSZXN1bHQgfHwgcmVzdWx0Lm5vID4gcmVzdWx0LnJlcXVpcmVkRm9yUmVzdWx0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgIGlmKFByb2Nlc3NlZFZvdGVzQnlQcm9wb3NhbFtfcHJvcG9zYWxJZF0gPT0gVm90ZXNOdW1CeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdKSB7CiAgICAgICAgICAgICAgICBpZihyZXN1bHQueWVzID4gcmVzdWx0LnJlcXVpcmVkRm9yUmVzdWx0IHx8IHJlc3VsdC5ubyA+IHJlc3VsdC5yZXF1aXJlZEZvclJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0UHJvcG9zYWxUeXBlKHVpbnQyNTYgX3Byb3Bvc2FsSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIFByb3Bvc2Fsc0J5SWRbX3Byb3Bvc2FsSWRdLmFjdGlvblR5cGU7CiAgICB9CgogICAgZnVuY3Rpb24gZXhwaXJ5Q2hhbmdlc1N0YXRlKHVpbnQyNTYgX3Byb3Bvc2FsSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBQcm9wb3NhbFJlY29yZCBtZW1vcnkgcHJvcG9zYWwgPSBQcm9wb3NhbHNCeUlkW19wcm9wb3NhbElkXTsKICAgICAgICBpZiggcHJvcG9zYWwuc3RhdGUgPT0gZ2V0UmVjb3JkU3RhdGUoIkFDQ0VQVElOR19WT1RFUyIpICYmIHByb3Bvc2FsLnRpbWVfZW5kIDwgZ2V0VGltZXN0YW1wKCkgKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gbmVlZHNQcm9jZXNzaW5nKHVpbnQyNTYgX3Byb3Bvc2FsSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiggZXhwaXJ5Q2hhbmdlc1N0YXRlKF9wcm9wb3NhbElkKSApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBSZXN1bHRSZWNvcmQgbWVtb3J5IHJlc3VsdCA9IFJlc3VsdHNCeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdOwogICAgICAgIGlmKHJlc3VsdC5yZXF1aXJlc0NvdW50aW5nID09IHRydWUpIHsKICAgICAgICAgICAgaWYoIGxhc3RQcm9jZXNzZWRWb3RlSWRCeVByb3Bvc2FsW19wcm9wb3NhbElkXSA8IFZvdGVzTnVtQnlQcm9wb3NhbElkW19wcm9wb3NhbElkXSApIHsKICAgICAgICAgICAgICAgIGlmKFByb2Nlc3NlZFZvdGVzQnlQcm9wb3NhbFtfcHJvcG9zYWxJZF0gPT0gVm90ZXNOdW1CeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyeUVuZFZvdGluZyh1aW50MjU2IF9wcm9wb3NhbElkKSBpbnRlcm5hbCB7CiAgICAgICAgaWYoY2FuRW5kVm90aW5nKF9wcm9wb3NhbElkKSkgewogICAgICAgICAgICBmaW5hbGlzZVByb3Bvc2FsKF9wcm9wb3NhbElkKTsKICAgICAgICB9CgogICAgICAgIGlmKGV4cGlyeUNoYW5nZXNTdGF0ZShfcHJvcG9zYWxJZCkgKSB7CiAgICAgICAgICAgIGZpbmFsaXNlRXhwaXJlZFByb3Bvc2FsKF9wcm9wb3NhbElkKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZmluYWxpc2VQcm9wb3NhbCh1aW50MjU2IF9wcm9wb3NhbElkKSBpbnRlcm5hbCB7CgogICAgICAgIFJlc3VsdFJlY29yZCBzdG9yYWdlIHJlc3VsdCA9IFJlc3VsdHNCeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdOwogICAgICAgIFByb3Bvc2FsUmVjb3JkIHN0b3JhZ2UgcHJvcG9zYWwgPSBQcm9wb3NhbHNCeUlkW19wcm9wb3NhbElkXTsKCiAgICAgICAgLy8gTWlsZXN0b25lIERlYWRsaW5lIHByb3Bvc2FscyBjYW5ub3QgYmUgZW5kZWQgImJ5IG1ham9yaXR5IHZvdGUiLCB3ZSByZWx5IG9uIGZpbmFsaXNlRXhwaXJlZFByb3Bvc2FsIGhlcmUKICAgICAgICAvLyBiZWNhdXNlIHdlIHdhbnQgdG8gYWxsb3cgZXZlcnlvbmUgdG8gYmUgYWJsZSB0byB2b3RlICJOTyIgaWYgdGhleSBjaG9vc2UgdG8gY2FzaGJhY2suCgogICAgICAgIGlmKCBwcm9wb3NhbC5hY3Rpb25UeXBlICE9IGdldEFjdGlvblR5cGUoIk1JTEVTVE9ORV9ERUFETElORSIpKSB7CiAgICAgICAgICAgIC8vIHJlYWQgcmVzdWx0cywKICAgICAgICAgICAgaWYocmVzdWx0LnllcyA+IHJlc3VsdC5yZXF1aXJlZEZvclJlc3VsdCkgewogICAgICAgICAgICAgICAgLy8gdm90aW5nIHJlc3VsdGVkIGluIFlFUwogICAgICAgICAgICAgICAgcHJvcG9zYWwuc3RhdGUgPSBnZXRSZWNvcmRTdGF0ZSgiVk9USU5HX1JFU1VMVF9ZRVMiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQubm8gPj0gcmVzdWx0LnJlcXVpcmVkRm9yUmVzdWx0KSB7CiAgICAgICAgICAgICAgICAvLyB2b3RpbmcgcmVzdWx0ZWQgaW4gTk8KICAgICAgICAgICAgICAgIHByb3Bvc2FsLnN0YXRlID0gZ2V0UmVjb3JkU3RhdGUoIlZPVElOR19SRVNVTFRfTk8iKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcnVuQWN0aW9uQWZ0ZXJSZXN1bHQoX3Byb3Bvc2FsSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmFsaXNlRXhwaXJlZFByb3Bvc2FsKHVpbnQyNTYgX3Byb3Bvc2FsSWQpIGludGVybmFsIHsKCiAgICAgICAgUmVzdWx0UmVjb3JkIHN0b3JhZ2UgcmVzdWx0ID0gUmVzdWx0c0J5UHJvcG9zYWxJZFtfcHJvcG9zYWxJZF07CiAgICAgICAgUHJvcG9zYWxSZWNvcmQgc3RvcmFnZSBwcm9wb3NhbCA9IFByb3Bvc2Fsc0J5SWRbX3Byb3Bvc2FsSWRdOwoKICAgICAgICAvLyBhbiBleHBpcmVkIHByb3Bvc2FsIHdpdGggbm8gdm90ZXMgd2lsbCBlbmQgYXMgWUVTCiAgICAgICAgaWYocmVzdWx0LnllcyA9PSAwICYmIHJlc3VsdC5ubyA9PSAwKSB7CiAgICAgICAgICAgIHByb3Bvc2FsLnN0YXRlID0gZ2V0UmVjb3JkU3RhdGUoIlZPVElOR19SRVNVTFRfWUVTIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gcmVhZCByZXN1bHRzLAogICAgICAgICAgICBpZihyZXN1bHQueWVzID4gcmVzdWx0Lm5vKSB7CiAgICAgICAgICAgICAgICAvLyB2b3RpbmcgcmVzdWx0ZWQgaW4gWUVTCiAgICAgICAgICAgICAgICBwcm9wb3NhbC5zdGF0ZSA9IGdldFJlY29yZFN0YXRlKCJWT1RJTkdfUkVTVUxUX1lFUyIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5ubyA+PSByZXN1bHQueWVzKSB7CiAgICAgICAgICAgICAgICAvLyB0aWUgZXF1YWxzIG5vCiAgICAgICAgICAgICAgICAvLyB2b3RpbmcgcmVzdWx0ZWQgaW4gTk8KICAgICAgICAgICAgICAgIHByb3Bvc2FsLnN0YXRlID0gZ2V0UmVjb3JkU3RhdGUoIlZPVElOR19SRVNVTFRfTk8iKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBydW5BY3Rpb25BZnRlclJlc3VsdChfcHJvcG9zYWxJZCk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJ5RmluYWxpc2VOb25Mb2NrZWRUb2tlbnNQcm9wb3NhbCh1aW50MjU2IF9wcm9wb3NhbElkKSBpbnRlcm5hbCB7CgogICAgICAgIFJlc3VsdFJlY29yZCBzdG9yYWdlIHJlc3VsdCA9IFJlc3VsdHNCeVByb3Bvc2FsSWRbX3Byb3Bvc2FsSWRdOwogICAgICAgIFByb3Bvc2FsUmVjb3JkIHN0b3JhZ2UgcHJvcG9zYWwgPSBQcm9wb3NhbHNCeUlkW19wcm9wb3NhbElkXTsKCiAgICAgICAgaWYocmVzdWx0LnJlcXVpcmVkRm9yUmVzdWx0ID09IDApIHsKICAgICAgICAgICAgcHJvcG9zYWwuc3RhdGUgPSBnZXRSZWNvcmRTdGF0ZSgiVk9USU5HX1JFU1VMVF9ZRVMiKTsKICAgICAgICAgICAgcnVuQWN0aW9uQWZ0ZXJSZXN1bHQoX3Byb3Bvc2FsSWQpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhZGRBY3RpdmVQcm9wb3NhbCh1aW50MjU2IF9wcm9wb3NhbElkKSBpbnRlcm5hbCB7CiAgICAgICAgQWN0aXZlUHJvcG9zYWxJZHNbQWN0aXZlUHJvcG9zYWxOdW0rK109IF9wcm9wb3NhbElkOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZUFuZFJlaW5kZXhBY3RpdmUodWludDI1NiBfcHJvcG9zYWxJZCkgaW50ZXJuYWwgewoKICAgICAgICBib29sIGZvdW5kID0gZmFsc2U7CiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IEFjdGl2ZVByb3Bvc2FsTnVtOyBpKyspIHsKICAgICAgICAgICAgaWYoQWN0aXZlUHJvcG9zYWxJZHNbaV0gPT0gX3Byb3Bvc2FsSWQpIHsKICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZihmb3VuZCkgewogICAgICAgICAgICAgICAgQWN0aXZlUHJvcG9zYWxJZHNbaV0gPSBBY3RpdmVQcm9wb3NhbElkc1tpKzFdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBBY3RpdmVQcm9wb3NhbE51bS0tOwogICAgfQoKCiAgICBib29sIHB1YmxpYyBFbWVyZ2VuY3lGdW5kaW5nUmVsZWFzZUFwcHJvdmVkID0gZmFsc2U7CgogICAgZnVuY3Rpb24gcnVuQWN0aW9uQWZ0ZXJSZXN1bHQodWludDI1NiBfcHJvcG9zYWxJZCkgaW50ZXJuYWwgewoKICAgICAgICBQcm9wb3NhbFJlY29yZCBzdG9yYWdlIHByb3Bvc2FsID0gUHJvcG9zYWxzQnlJZFtfcHJvcG9zYWxJZF07CgogICAgICAgIGlmKHByb3Bvc2FsLnN0YXRlID09IGdldFJlY29yZFN0YXRlKCJWT1RJTkdfUkVTVUxUX1lFUyIpKSB7CgogICAgICAgICAgICBpZihwcm9wb3NhbC5hY3Rpb25UeXBlID09IGdldEFjdGlvblR5cGUoIk1JTEVTVE9ORV9ERUFETElORSIpKSB7CgogICAgICAgICAgICB9IGVsc2UgaWYgKHByb3Bvc2FsLmFjdGlvblR5cGUgPT0gZ2V0QWN0aW9uVHlwZSgiTUlMRVNUT05FX1BPU1RQT05JTkciKSkgewoKICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wb3NhbC5hY3Rpb25UeXBlID09IGdldEFjdGlvblR5cGUoIkVNRVJHRU5DWV9GVU5EX1JFTEVBU0UiKSkgewogICAgICAgICAgICAgICAgRW1lcmdlbmN5RnVuZGluZ1JlbGVhc2VBcHByb3ZlZCA9IHRydWU7CgogICAgICAgICAgICB9IGVsc2UgaWYgKHByb3Bvc2FsLmFjdGlvblR5cGUgPT0gZ2V0QWN0aW9uVHlwZSgiUFJPSkVDVF9ERUxJU1RJTkciKSkgewoKICAgICAgICAgICAgICAgIExpc3RpbmdDb250cmFjdEVudGl0eS5kZWxpc3RDaGlsZCggcHJvcG9zYWwuZXh0cmEgKTsKCiAgICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgICAgICBwcm9wb3NhbC5hY3Rpb25UeXBlID09IGdldEFjdGlvblR5cGUoIklOX0RFVkVMT1BNRU5UX0NPREVfVVBHUkFERSIpIHx8CiAgICAgICAgICAgICAgICBwcm9wb3NhbC5hY3Rpb25UeXBlID09IGdldEFjdGlvblR5cGUoIkFGVEVSX0NPTVBMRVRFX0NPREVfVVBHUkFERSIpCiAgICAgICAgICAgICkgewoKICAgICAgICAgICAgICAgIC8vIGluaXRpYXRlIGNvZGUgdXBncmFkZQogICAgICAgICAgICAgICAgYWNjZXB0Q29kZVVwZ3JhZGUoX3Byb3Bvc2FsSWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZW1vdmVBbmRSZWluZGV4QWN0aXZlKF9wcm9wb3NhbElkKTsKCiAgICAgICAgfSBlbHNlIGlmKHByb3Bvc2FsLnN0YXRlID09IGdldFJlY29yZFN0YXRlKCJWT1RJTkdfUkVTVUxUX05PIikpIHsKCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIGlmKHByb3Bvc2FsLmFjdGlvblR5cGUgPT0gZ2V0QWN0aW9uVHlwZSgiTUlMRVNUT05FX0RFQURMSU5FIikpIHsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZW1vdmVBbmRSZWluZGV4QWN0aXZlKF9wcm9wb3NhbElkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyB1c2VkIGJ5IHZhdWx0IGNhc2ggYmFjawogICAgZnVuY3Rpb24gZ2V0TXlWb3RlRm9yQ3VycmVudE1pbGVzdG9uZVJlbGVhc2UoYWRkcmVzcyBfdm90ZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBmaW5kIHByb3Bvc2FsIGlkIGZvciBjdXJyZW50IG1pbGVzdG9uZQogICAgICAgIHVpbnQ4IHJlY29yZElkID0gTWlsZXN0b25lc0VudGl0eS5jdXJyZW50UmVjb3JkKCk7CiAgICAgICAgYnl0ZXMzMiBoYXNoID0gZ2V0SGFzaCggZ2V0QWN0aW9uVHlwZSgiTUlMRVNUT05FX0RFQURMSU5FIiksIGJ5dGVzMzIoIHJlY29yZElkICksIDAgKTsKICAgICAgICB1aW50MjU2IHByb3Bvc2FsSWQgPSBQcm9wb3NhbElkQnlIYXNoW2hhc2hdOwogICAgICAgIC8vIGJhc2VkIG9uIHRoYXQgcHJvcG9zYWwgaWQsIGZpbmQgbXkgdm90ZQogICAgICAgIFZvdGVTdHJ1Y3QgbWVtb3J5IHZvdGUgPSBWb3Rlc0J5Q2FzdGVyW3Byb3Bvc2FsSWRdW192b3Rlcl07CiAgICAgICAgcmV0dXJuIHZvdGUudm90ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRIYXNWb3RlRm9yQ3VycmVudE1pbGVzdG9uZVJlbGVhc2UoYWRkcmVzcyBfdm90ZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBmaW5kIHByb3Bvc2FsIGlkIGZvciBjdXJyZW50IG1pbGVzdG9uZQogICAgICAgIHVpbnQ4IHJlY29yZElkID0gTWlsZXN0b25lc0VudGl0eS5jdXJyZW50UmVjb3JkKCk7CiAgICAgICAgYnl0ZXMzMiBoYXNoID0gZ2V0SGFzaCggZ2V0QWN0aW9uVHlwZSgiTUlMRVNUT05FX0RFQURMSU5FIiksIGJ5dGVzMzIoIHJlY29yZElkICksIDAgKTsKICAgICAgICB1aW50MjU2IHByb3Bvc2FsSWQgPSBQcm9wb3NhbElkQnlIYXNoW2hhc2hdOwogICAgICAgIHJldHVybiBoYXNQcmV2aW91c1ZvdGUocHJvcG9zYWxJZCwgX3ZvdGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRNeVZvdGUodWludDI1NiBfcHJvcG9zYWxJZCwgYWRkcmVzcyBfdm90ZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICBWb3RlU3RydWN0IG1lbW9yeSB2b3RlID0gVm90ZXNCeUNhc3RlcltfcHJvcG9zYWxJZF1bX3ZvdGVyXTsKICAgICAgICByZXR1cm4gdm90ZS52b3RlOwogICAgfQoKfQ=='.
	

]
