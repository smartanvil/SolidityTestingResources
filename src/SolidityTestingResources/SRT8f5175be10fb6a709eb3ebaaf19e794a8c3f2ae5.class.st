Class {
	#name : #SRT8f5175be10fb6a709eb3ebaaf19e794a8c3f2ae5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT8f5175be10fb6a709eb3ebaaf19e794a8c3f2ae5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyBGaWxlOiBjb250cmFjdHMvQ0FWUGxhdGZvcm1FbWl0dGVyLnNvbAoKLy9pbXBvcnQgJy4uL2V2ZW50L011bHRpRXZlbnRzSGlzdG9yeUFkYXB0ZXIuc29sJzsKCi8vLyBAdGl0bGUgQ0FWIFBsYXRmb3JtIEVtaXR0ZXIuCi8vLwovLy8gQ29udGFpbnMgYWxsIHRoZSBvcmlnaW5hbCBldmVudCBlbWl0dGluZyBmdW5jdGlvbiBkZWZpbml0aW9ucyBhbmQgZXZlbnRzLgovLy8gSW4gY2FzZSBvZiBuZXcgZXZlbnRzIG5lZWRlZCBsYXRlciwgYWRkaXRpb25hbCBlbWl0dGVycyBjYW4gYmUgZGV2ZWxvcGVkLgovLy8gQWxsIHRoZSBmdW5jdGlvbnMgaXMgbWVhbnQgdG8gYmUgY2FsbGVkIHVzaW5nIGRlbGVnYXRlY2FsbC4KY29udHJhY3QgQ0FWUGxhdGZvcm1FbWl0dGVyIHsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIGJ5dGVzMzIgaW5kZXhlZCBzeW1ib2wsIHVpbnQgdmFsdWUsIHN0cmluZyByZWZlcmVuY2UpOwogICAgZXZlbnQgSXNzdWUoYnl0ZXMzMiBpbmRleGVkIHN5bWJvbCwgdWludCB2YWx1ZSwgYWRkcmVzcyBpbmRleGVkIGJ5KTsKICAgIGV2ZW50IFJldm9rZShieXRlczMyIGluZGV4ZWQgc3ltYm9sLCB1aW50IHZhbHVlLCBhZGRyZXNzIGluZGV4ZWQgYnkpOwogICAgZXZlbnQgT3duZXJzaGlwQ2hhbmdlKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIGJ5dGVzMzIgaW5kZXhlZCBzeW1ib2wpOwogICAgZXZlbnQgQXBwcm92ZShhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIGJ5dGVzMzIgaW5kZXhlZCBzeW1ib2wsIHVpbnQgdmFsdWUpOwogICAgZXZlbnQgUmVjb3ZlcnkoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgYWRkcmVzcyBieSk7CiAgICBldmVudCBFcnJvcih1aW50IGVycm9yQ29kZSk7CgogICAgZnVuY3Rpb24gZW1pdFRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCBieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlLCBzdHJpbmcgX3JlZmVyZW5jZSkgcHVibGljIHsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfc3ltYm9sLCBfdmFsdWUsIF9yZWZlcmVuY2UpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVtaXRJc3N1ZShieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIF9ieSkgcHVibGljIHsKICAgICAgICBJc3N1ZShfc3ltYm9sLCBfdmFsdWUsIF9ieSk7CiAgICB9CgogICAgZnVuY3Rpb24gZW1pdFJldm9rZShieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlLCBhZGRyZXNzIF9ieSkgcHVibGljIHsKICAgICAgICBSZXZva2UoX3N5bWJvbCwgX3ZhbHVlLCBfYnkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGVtaXRPd25lcnNoaXBDaGFuZ2UoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIGJ5dGVzMzIgX3N5bWJvbCkgcHVibGljIHsKICAgICAgICBPd25lcnNoaXBDaGFuZ2UoX2Zyb20sIF90bywgX3N5bWJvbCk7CiAgICB9CgogICAgZnVuY3Rpb24gZW1pdEFwcHJvdmUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfc3BlbmRlciwgYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSkgcHVibGljIHsKICAgICAgICBBcHByb3ZlKF9mcm9tLCBfc3BlbmRlciwgX3N5bWJvbCwgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBlbWl0UmVjb3ZlcnkoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIGFkZHJlc3MgX2J5KSBwdWJsaWMgewogICAgICAgIFJlY292ZXJ5KF9mcm9tLCBfdG8sIF9ieSk7CiAgICB9CgogICAgZnVuY3Rpb24gZW1pdEVycm9yKHVpbnQgX2Vycm9yQ29kZSkgcHVibGljIHsKICAgICAgICBFcnJvcihfZXJyb3JDb2RlKTsKICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0VSQzIwSW50ZXJmYWNlLnNvbAoKY29udHJhY3QgRVJDMjBJbnRlcmZhY2UgewogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CgogICAgZnVuY3Rpb24gZGVjaW1hbHMoKSBjb25zdGFudCByZXR1cm5zICh1aW50OCk7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgc3VwcGx5KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9Pd25lZC5zb2wKCi8qKgogKiBAdGl0bGUgT3duZWQgY29udHJhY3Qgd2l0aCBzYWZlIG93bmVyc2hpcCBwYXNzLgogKgogKiBOb3RlOiBhbGwgdGhlIG5vbiBjb25zdGFudCBmdW5jdGlvbnMgcmV0dXJuIGZhbHNlIGluc3RlYWQgb2YgdGhyb3dpbmcgaW4gY2FzZSBpZiBzdGF0ZSBjaGFuZ2UKICogZGlkbid0IGhhcHBlbiB5ZXQuCiAqLwpjb250cmFjdCBPd25lZCB7CiAgICAvKioKICAgICAqIENvbnRyYWN0IG93bmVyIGFkZHJlc3MKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgY29udHJhY3RPd25lcjsKCiAgICAvKioKICAgICAqIENvbnRyYWN0IG93bmVyIGFkZHJlc3MKICAgICAqLwogICAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ0NvbnRyYWN0T3duZXI7CgogICAgZnVuY3Rpb24gT3duZWQoKSB7CiAgICAgICAgY29udHJhY3RPd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgT3duZXIgY2hlY2sgbW9kaWZpZXIKICAgICovCiAgICBtb2RpZmllciBvbmx5Q29udHJhY3RPd25lcigpIHsKICAgICAgICBpZiAoY29udHJhY3RPd25lciA9PSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBEZXN0cm95IGNvbnRyYWN0IGFuZCBzY3J1YiBhIGRhdGEKICAgICAqIEBub3RpY2UgT25seSBvd25lciBjYW4gY2FsbCBpdAogICAgICovCiAgICBmdW5jdGlvbiBkZXN0cm95KCkgb25seUNvbnRyYWN0T3duZXIgewogICAgICAgIHN1aWNpZGUobXNnLnNlbmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVwYXJlcyBvd25lcnNoaXAgcGFzcy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgY3VycmVudCBvd25lci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIGFkZHJlc3Mgb2YgdGhlIG5leHQgb3duZXIuIDB4MCBpcyBub3QgYWxsb3dlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNoYW5nZUNvbnRyYWN0T3duZXJzaGlwKGFkZHJlc3MgX3RvKSBvbmx5Q29udHJhY3RPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChfdG8gPT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHBlbmRpbmdDb250cmFjdE93bmVyID0gX3RvOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRmluYWxpemUgb3duZXJzaGlwIHBhc3MuCiAgICAgKgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHBlbmRpbmcgb3duZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjbGFpbUNvbnRyYWN0T3duZXJzaGlwKCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAocGVuZGluZ0NvbnRyYWN0T3duZXIgIT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBjb250cmFjdE93bmVyID0gcGVuZGluZ0NvbnRyYWN0T3duZXI7CiAgICAgICAgZGVsZXRlIHBlbmRpbmdDb250cmFjdE93bmVyOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBEaXJlY3Qgb3duZXJzaGlwIHBhc3Mgd2l0aG91dCBjaGFuZ2UvY2xhaW0gcGF0dGVybi4gQ2FuIGJlIGludm9rZWQgb25seSBieSBjdXJyZW50IGNvbnRyYWN0IG93bmVyCiAgICAqCiAgICAqIEBwYXJhbSBfdG8gdGhlIG5leHQgY29udHJhY3Qgb3duZXIKICAgICoKICAgICogQHJldHVybiBgdHJ1ZWAgaWYgc3VjY2VzcywgYGZhbHNlYCBvdGhlcndpc2UKICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckNvbnRyYWN0T3duZXJzaGlwKGFkZHJlc3MgX3RvKSBvbmx5Q29udHJhY3RPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChfdG8gPT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChwZW5kaW5nQ29udHJhY3RPd25lciAhPSAweDApIHsKICAgICAgICAgICAgcGVuZGluZ0NvbnRyYWN0T3duZXIgPSAweDA7CiAgICAgICAgfQoKICAgICAgICBjb250cmFjdE93bmVyID0gX3RvOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvT2JqZWN0LnNvbAoKLyoqCiAqIEB0aXRsZSBHZW5lcmljIG93bmVkIGRlc3Ryb3lhYmxlIGNvbnRyYWN0CiAqLwpjb250cmFjdCBPYmplY3QgaXMgT3duZWQgewogICAgLyoqCiAgICAqICBDb21tb24gcmVzdWx0IGNvZGUuIE1lYW5zIGV2ZXJ5dGhpbmcgaXMgZmluZS4KICAgICovCiAgICB1aW50IGNvbnN0YW50IE9LID0gMTsKCiAgICBmdW5jdGlvbiB3aXRoZHJhd25Ub2tlbnMoYWRkcmVzc1tdIHRva2VucywgYWRkcmVzcyBfdG8pIG9ubHlDb250cmFjdE93bmVyIHJldHVybnModWludCkgewogICAgICAgIGZvcih1aW50IGk9MDtpPHRva2Vucy5sZW5ndGg7aSsrKSB7CiAgICAgICAgICAgIGFkZHJlc3MgdG9rZW4gPSB0b2tlbnNbaV07CiAgICAgICAgICAgIHVpbnQgYmFsYW5jZSA9IEVSQzIwSW50ZXJmYWNlKHRva2VuKS5iYWxhbmNlT2YodGhpcyk7CiAgICAgICAgICAgIGlmKGJhbGFuY2UgIT0gMCkKICAgICAgICAgICAgICAgIEVSQzIwSW50ZXJmYWNlKHRva2VuKS50cmFuc2ZlcihfdG8sYmFsYW5jZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBPSzsKICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL1NhZmVNYXRoLnNvbAoKLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9DQVZQbGF0Zm9ybS5zb2wKCmNvbnRyYWN0IFByb3h5RXZlbnRzRW1pdHRlciB7CiAgICBmdW5jdGlvbiBlbWl0VHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBlbWl0QXBwcm92ZShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcHVibGljOwp9CgovLy8gIEB0aXRsZSBDQVYgUGxhdGZvcm0uCi8vLwovLy8gIFRoZSBvZmZpY2lhbCBDQVYgYXNzZXRzIHBsYXRmb3JtIHBvd2VyaW5nIFRJTUUgYW5kIExIVCB0b2tlbnMsIGFuZCBwb3NzaWJseQovLy8gIG90aGVyIHVua25vd24gdG9rZW5zIG5lZWRlZCBsYXRlci4KLy8vICBQbGF0Zm9ybSB1c2VzIE11bHRpRXZlbnRzSGlzdG9yeSBjb250cmFjdCB0byBrZWVwIGV2ZW50cywgc28gdGhhdCBpbiBjYXNlIGl0IG5lZWRzIHRvIGJlIHJlZGVwbG95ZWQKLy8vICBhdCBzb21lIHBvaW50LCBhbGwgdGhlIGV2ZW50cyBrZWVwIGFwcGVhcmluZyBhdCB0aGUgc2FtZSBwbGFjZS4KLy8vCi8vLyAgRXZlcnkgYXNzZXQgaXMgbWVhbnQgdG8gYmUgdXNlZCB0aHJvdWdoIGEgcHJveHkgY29udHJhY3QuIE9ubHkgb25lIHByb3h5IGNvbnRyYWN0IGhhdmUgYWNjZXNzCi8vLyAgcmlnaHRzIGZvciBhIHBhcnRpY3VsYXIgYXNzZXQuCi8vLwovLy8gIEZlYXR1cmVzOiB0cmFuc2ZlcnMsIGFsbG93YW5jZXMsIHN1cHBseSBhZGp1c3RtZW50cywgbG9zdCB3YWxsZXQgYWNjZXNzIHJlY292ZXJ5LgovLy8KLy8vICBOb3RlOiBhbGwgdGhlIG5vbiBjb25zdGFudCBmdW5jdGlvbnMgcmV0dXJuIGZhbHNlIGluc3RlYWQgb2YgdGhyb3dpbmcgaW4gY2FzZSBpZiBzdGF0ZSBjaGFuZ2UKLy8vIGRpZG4ndCBoYXBwZW4geWV0Lgpjb250cmFjdCBDQVZQbGF0Zm9ybSBpcyBPYmplY3QsIENBVlBsYXRmb3JtRW1pdHRlciB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICB1aW50IGNvbnN0YW50IENBVl9QTEFURk9STV9TQ09QRSA9IDE1MDAwOwogICAgdWludCBjb25zdGFudCBDQVZfUExBVEZPUk1fUFJPWFlfQUxSRUFEWV9FWElTVFMgPSBDQVZfUExBVEZPUk1fU0NPUEUgKyAwOwogICAgdWludCBjb25zdGFudCBDQVZfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYgPSBDQVZfUExBVEZPUk1fU0NPUEUgKyAxOwogICAgdWludCBjb25zdGFudCBDQVZfUExBVEZPUk1fSU5WQUxJRF9WQUxVRSA9IENBVl9QTEFURk9STV9TQ09QRSArIDI7CiAgICB1aW50IGNvbnN0YW50IENBVl9QTEFURk9STV9JTlNVRkZJQ0lFTlRfQkFMQU5DRSA9IENBVl9QTEFURk9STV9TQ09QRSArIDM7CiAgICB1aW50IGNvbnN0YW50IENBVl9QTEFURk9STV9OT1RfRU5PVUdIX0FMTE9XQU5DRSA9IENBVl9QTEFURk9STV9TQ09QRSArIDQ7CiAgICB1aW50IGNvbnN0YW50IENBVl9QTEFURk9STV9BU1NFVF9BTFJFQURZX0lTU1VFRCA9IENBVl9QTEFURk9STV9TQ09QRSArIDU7CiAgICB1aW50IGNvbnN0YW50IENBVl9QTEFURk9STV9DQU5OT1RfSVNTVUVfRklYRURfQVNTRVRfV0lUSF9JTlZBTElEX1ZBTFVFID0gQ0FWX1BMQVRGT1JNX1NDT1BFICsgNjsKICAgIHVpbnQgY29uc3RhbnQgQ0FWX1BMQVRGT1JNX0NBTk5PVF9SRUlTU1VFX0ZJWEVEX0FTU0VUID0gQ0FWX1BMQVRGT1JNX1NDT1BFICsgNzsKICAgIHVpbnQgY29uc3RhbnQgQ0FWX1BMQVRGT1JNX1NVUFBMWV9PVkVSRkxPVyA9IENBVl9QTEFURk9STV9TQ09QRSArIDg7CiAgICB1aW50IGNvbnN0YW50IENBVl9QTEFURk9STV9OT1RfRU5PVUdIX1RPS0VOUyA9IENBVl9QTEFURk9STV9TQ09QRSArIDk7CiAgICB1aW50IGNvbnN0YW50IENBVl9QTEFURk9STV9JTlZBTElEX05FV19PV05FUiA9IENBVl9QTEFURk9STV9TQ09QRSArIDEwOwogICAgdWludCBjb25zdGFudCBDQVZfUExBVEZPUk1fQUxSRUFEWV9UUlVTVEVEID0gQ0FWX1BMQVRGT1JNX1NDT1BFICsgMTE7CiAgICB1aW50IGNvbnN0YW50IENBVl9QTEFURk9STV9TSE9VTERfUkVDT1ZFUl9UT19ORVdfQUREUkVTUyA9IENBVl9QTEFURk9STV9TQ09QRSArIDEyOwogICAgdWludCBjb25zdGFudCBDQVZfUExBVEZPUk1fQVNTRVRfSVNfTk9UX0lTU1VFRCA9IENBVl9QTEFURk9STV9TQ09QRSArIDEzOwogICAgdWludCBjb25zdGFudCBDQVZfUExBVEZPUk1fSU5WQUxJRF9JTlZPQ0FUSU9OID0gQ0FWX1BMQVRGT1JNX1NDT1BFICsgMTc7CgogICAgLy8vIFN0cnVjdHVyZSBvZiBhIHBhcnRpY3VsYXIgYXNzZXQuCiAgICBzdHJ1Y3QgQXNzZXQgewogICAgICAgIHVpbnQgb3duZXI7ICAgICAgICAgICAgICAgICAgICAgICAvLyBBc3NldCdzIG93bmVyIGlkLgogICAgICAgIHVpbnQgdG90YWxTdXBwbHk7ICAgICAgICAgICAgICAgICAvLyBBc3NldCdzIHRvdGFsIHN1cHBseS4KICAgICAgICBzdHJpbmcgbmFtZTsgICAgICAgICAgICAgICAgICAgICAgLy8gQXNzZXQncyBuYW1lLCBmb3IgaW5mb3JtYXRpb24gcHVycG9zZXMuCiAgICAgICAgc3RyaW5nIGRlc2NyaXB0aW9uOyAgICAgICAgICAgICAgIC8vIEFzc2V0J3MgZGVzY3JpcHRpb24sIGZvciBpbmZvcm1hdGlvbiBwdXJwb3Nlcy4KICAgICAgICBib29sIGlzUmVpc3N1YWJsZTsgICAgICAgICAgICAgICAgLy8gSW5kaWNhdGVzIGlmIGFzc2V0IGhhdmUgZHluYW1pYyBvciBmaXhlZCBzdXBwbHkuCiAgICAgICAgdWludDggYmFzZVVuaXQ7ICAgICAgICAgICAgICAgICAgIC8vIFByb3Bvc2VkIG51bWJlciBvZiBkZWNpbWFscy4KICAgICAgICBtYXBwaW5nKHVpbnQgPT4gV2FsbGV0KSB3YWxsZXRzOyAgLy8gSG9sZGVycyB3YWxsZXRzLgogICAgICAgIG1hcHBpbmcodWludCA9PiBib29sKSBwYXJ0b3duZXJzOyAvLyBQYXJ0LW93bmVycyBvZiBhbiBhc3NldDsgaGF2ZSBsZXNzIGFjY2VzcyByaWdodHMgdGhhbiBvd25lcgogICAgfQoKICAgIC8vLyBTdHJ1Y3R1cmUgb2YgYW4gYXNzZXQgaG9sZGVyIHdhbGxldCBmb3IgcGFydGljdWxhciBhc3NldC4KICAgIHN0cnVjdCBXYWxsZXQgewogICAgICAgIHVpbnQgYmFsYW5jZTsKICAgICAgICBtYXBwaW5nKHVpbnQgPT4gdWludCkgYWxsb3dhbmNlOwogICAgfQoKICAgIC8vLyBTdHJ1Y3R1cmUgb2YgYW4gYXNzZXQgaG9sZGVyLgogICAgc3RydWN0IEhvbGRlciB7CiAgICAgICAgYWRkcmVzcyBhZGRyOyAgICAgICAgICAgICAgICAgICAgLy8gQ3VycmVudCBhZGRyZXNzIG9mIHRoZSBob2xkZXIuCiAgICAgICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHRydXN0OyAgLy8gQWRkcmVzc2VzIHRoYXQgYXJlIHRydXN0ZWQgd2l0aCByZWNvdmVyeSBwcm9vY2VkdXJlLgogICAgfQoKICAgIC8vLyBJdGVyYWJsZSBtYXBwaW5nIHBhdHRlcm4gaXMgdXNlZCBmb3IgaG9sZGVycy4KICAgIHVpbnQgcHVibGljIGhvbGRlcnNDb3VudDsKICAgIG1hcHBpbmcodWludCA9PiBIb2xkZXIpIHB1YmxpYyBob2xkZXJzOwoKICAgIC8vLyBUaGlzIGlzIGFuIGFjY2VzcyBhZGRyZXNzIG1hcHBpbmcuIE1hbnkgYWRkcmVzc2VzIG1heSBoYXZlIGFjY2VzcyB0byBhIHNpbmdsZSBob2xkZXIuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgaG9sZGVySW5kZXg7CgogICAgLy8vIExpc3Qgb2Ygc3ltYm9scyB0aGF0IGV4aXN0IGluIGEgcGxhdGZvcm0KICAgIGJ5dGVzMzJbXSBwdWJsaWMgc3ltYm9sczsKCiAgICAvLy8gQXNzZXQgc3ltYm9sIHRvIGFzc2V0IG1hcHBpbmcuCiAgICBtYXBwaW5nKGJ5dGVzMzIgPT4gQXNzZXQpIHB1YmxpYyBhc3NldHM7CgogICAgLy8vIEFzc2V0IHN5bWJvbCB0byBhc3NldCBwcm94eSBtYXBwaW5nLgogICAgbWFwcGluZyhieXRlczMyID0+IGFkZHJlc3MpIHB1YmxpYyBwcm94aWVzOwoKICAgIC8vLyBDby1vd25lcnMgb2YgYSBwbGF0Zm9ybS4gSGFzIGxlc3MgYWNjZXNzIHJpZ2h0cyB0aGFuIGEgcm9vdCBjb250cmFjdCBvd25lcgogICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBwYXJ0b3duZXJzOwoKICAgIC8vIFNob3VsZCB1c2UgaW50ZXJmYWNlIG9mIHRoZSBlbWl0dGVyLCBidXQgYWRkcmVzcyBvZiBldmVudHMgaGlzdG9yeS4KICAgIGFkZHJlc3MgcHVibGljIGV2ZW50c0hpc3Rvcnk7CgogICAgLy8vIEVtaXRzIEVycm9yIGV2ZW50IHdpdGggc3BlY2lmaWVkIGVycm9yIG1lc3NhZ2UuCiAgICAvLy8gU2hvdWxkIG9ubHkgYmUgdXNlZCBpZiBubyBzdGF0ZSBjaGFuZ2VzIGhhcHBlbmVkLgogICAgLy8vIEBwYXJhbSBfZXJyb3JDb2RlIGNvZGUgb2YgYW4gZXJyb3IKICAgIGZ1bmN0aW9uIF9lcnJvcih1aW50IF9lcnJvckNvZGUpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBDQVZQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdEVycm9yKF9lcnJvckNvZGUpOwogICAgICAgIHJldHVybiBfZXJyb3JDb2RlOwogICAgfQoKICAgIC8vLyBFbWl0cyBFcnJvciBpZiBjYWxsZWQgbm90IGJ5IGFzc2V0IG93bmVyLgogICAgbW9kaWZpZXIgb25seU93bmVyKGJ5dGVzMzIgX3N5bWJvbCkgewogICAgICAgIGlmIChpc093bmVyKG1zZy5zZW5kZXIsIF9zeW1ib2wpKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFVOQVVUSE9SSVpFRCBpZiBjYWxsZWQgbm90IGJ5IG9uZSBvZiBzeW1ib2wncyBwYXJ0b3duZXJzIG9yIG93bmVyCiAgICBtb2RpZmllciBvbmx5T25lT2ZPd25lcnMoYnl0ZXMzMiBfc3ltYm9sKSB7CiAgICAgICAgaWYgKGhhc0Fzc2V0UmlnaHRzKG1zZy5zZW5kZXIsIF9zeW1ib2wpKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAZGV2IFVOQVVUSE9SSVpFRCBpZiBjYWxsZWQgbm90IGJ5IG9uZSBvZiBwYXJ0b3duZXJzIG9yIGNvbnRyYWN0J3Mgb3duZXIKICAgIG1vZGlmaWVyIG9ubHlPbmVPZkNvbnRyYWN0T3duZXJzKCkgewogICAgICAgIGlmIChjb250cmFjdE93bmVyID09IG1zZy5zZW5kZXIgfHwgcGFydG93bmVyc1ttc2cuc2VuZGVyXSkgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gRW1pdHMgRXJyb3IgaWYgY2FsbGVkIG5vdCBieSBhc3NldCBwcm94eS4KICAgIG1vZGlmaWVyIG9ubHlQcm94eShieXRlczMyIF9zeW1ib2wpIHsKICAgICAgICBpZiAocHJveGllc1tfc3ltYm9sXSA9PSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBFbWl0cyBFcnJvciBpZiBfZnJvbSBkb2Vzbid0IHRydXN0IF90by4KICAgIG1vZGlmaWVyIGNoZWNrVHJ1c3QoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIHsKICAgICAgICBpZiAoaXNUcnVzdGVkKF9mcm9tLCBfdG8pKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBBZGRzIGEgY28tb3duZXIgb2YgYSBjb250cmFjdC4gTWlnaHQgYmUgbW9yZSB0aGFuIG9uZSBjby1vd25lcgogICAgLy8vIEBkZXYgQWxsb3dlZCB0byBvbmx5IGNvbnRyYWN0IG9ud2VyCiAgICAvLy8gQHBhcmFtIF9wYXJ0b3duZXIgYSBjby1vd25lciBvZiBhIGNvbnRyYWN0CiAgICAvLy8gQHJldHVybiByZXN1bHQgY29kZSBvZiBhbiBvcGVyYXRpb24KICAgIGZ1bmN0aW9uIGFkZFBhcnRPd25lcihhZGRyZXNzIF9wYXJ0b3duZXIpIG9ubHlDb250cmFjdE93bmVyIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcGFydG93bmVyc1tfcGFydG93bmVyXSA9IHRydWU7CiAgICAgICAgcmV0dXJuIE9LOwogICAgfQoKICAgIC8vLyBSZW1vdmVzIGEgY28tb3duZXIgb2YgYSBjb250cmFjdAogICAgLy8vIEBkZXYgU2hvdWxkIGJlIHBlcmZvcm1lZCBvbmx5IGJ5IHJvb3QgY29udHJhY3Qgb3duZXIKICAgIC8vLyBAcGFyYW0gX3BhcnRvd25lciBhIGNvLW93bmVyIG9mIGEgY29udHJhY3QKICAgIC8vLyBAcmV0dXJuIHJlc3VsdCBjb2RlIG9mIGFuIG9wZXJhdGlvbgogICAgZnVuY3Rpb24gcmVtb3ZlUGFydE93bmVyKGFkZHJlc3MgX3BhcnRvd25lcikgb25seUNvbnRyYWN0T3duZXIgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBkZWxldGUgcGFydG93bmVyc1tfcGFydG93bmVyXTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLy8vIFNldHMgRXZlbnRzSHN0b3J5IGNvbnRyYWN0IGFkZHJlc3MuCiAgICAvLy8KICAgIC8vLyBDYW4gYmUgc2V0IG9ubHkgYnkgZXZlbnRzIGhpc3RvcnkgYWRtb24gb3Igb3duZXIuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX2V2ZW50c0hpc3RvcnkgTXVsdGlFdmVudHNIaXN0b3J5IGNvbnRyYWN0IGFkZHJlc3MuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiBzZXR1cEV2ZW50c0hpc3RvcnkoYWRkcmVzcyBfZXZlbnRzSGlzdG9yeSkgb25seUNvbnRyYWN0T3duZXIgcHVibGljIHJldHVybnMgKHVpbnQgZXJyb3JDb2RlKSB7CiAgICAgICAgZXZlbnRzSGlzdG9yeSA9IF9ldmVudHNIaXN0b3J5OwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvLy8gUHJvdmlkZXMgYSBjaGVhcCB3YXkgdG8gZ2V0IG51bWJlciBvZiBzeW1ib2xzIHJlZ2lzdGVyZWQgaW4gYSBwbGF0Zm9ybQogICAgLy8vIEByZXR1cm4gbnVtYmVyIG9mIHN5bWJvbHMKICAgIGZ1bmN0aW9uIHN5bWJvbHNDb3VudCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gc3ltYm9scy5sZW5ndGg7CiAgICB9CgogICAgLy8vIENoZWNrIGFzc2V0IGV4aXN0YW5jZS4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gYXNzZXQgZXhpc3RhbmNlLgogICAgZnVuY3Rpb24gaXNDcmVhdGVkKGJ5dGVzMzIgX3N5bWJvbCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0ub3duZXIgIT0gMDsKICAgIH0KCiAgICAvLy8gUmV0dXJucyBhc3NldCBkZWNpbWFscy4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gYXNzZXQgZGVjaW1hbHMuCiAgICBmdW5jdGlvbiBiYXNlVW5pdChieXRlczMyIF9zeW1ib2wpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS5iYXNlVW5pdDsKICAgIH0KCiAgICAvLy8gUmV0dXJucyBhc3NldCBuYW1lLgogICAgLy8vCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBhc3NldCBuYW1lLgogICAgZnVuY3Rpb24gbmFtZShieXRlczMyIF9zeW1ib2wpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0ubmFtZTsKICAgIH0KCiAgICAvLy8gUmV0dXJucyBhc3NldCBkZXNjcmlwdGlvbi4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gYXNzZXQgZGVzY3JpcHRpb24uCiAgICBmdW5jdGlvbiBkZXNjcmlwdGlvbihieXRlczMyIF9zeW1ib2wpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0uZGVzY3JpcHRpb247CiAgICB9CgogICAgLy8vIFJldHVybnMgYXNzZXQgcmVpc3N1YWJpbGl0eS4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gYXNzZXQgcmVpc3N1YWJpbGl0eS4KICAgIGZ1bmN0aW9uIGlzUmVpc3N1YWJsZShieXRlczMyIF9zeW1ib2wpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLmlzUmVpc3N1YWJsZTsKICAgIH0KCiAgICAvLy8gUmV0dXJucyBhc3NldCBvd25lciBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLyBAcmV0dXJuIGFzc2V0IG93bmVyIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBvd25lcihieXRlczMyIF9zeW1ib2wpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gaG9sZGVyc1thc3NldHNbX3N5bWJvbF0ub3duZXJdLmFkZHI7CiAgICB9CgogICAgLy8vIENoZWNrIGlmIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBhc3NldCBvd25lciByaWdodHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLyBAcmV0dXJuIG93bmVyIHJpZ2h0cyBhdmFpbGFiaWxpdHkuCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX293bmVyLCBieXRlczMyIF9zeW1ib2wpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gaXNDcmVhdGVkKF9zeW1ib2wpICYmIChhc3NldHNbX3N5bWJvbF0ub3duZXIgPT0gZ2V0SG9sZGVySWQoX293bmVyKSk7CiAgICB9CgogICAgLy8vIENoZWNrcyBpZiBhIHNwZWNpZmllZCBhZGRyZXNzIGhhcyBhc3NldCBvd25lciBvciBjby1vd25lciByaWdodHMuCiAgICAvLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLyBAcmV0dXJuIG93bmVyIHJpZ2h0cyBhdmFpbGFiaWxpdHkuCiAgICBmdW5jdGlvbiBoYXNBc3NldFJpZ2h0cyhhZGRyZXNzIF9vd25lciwgYnl0ZXMzMiBfc3ltYm9sKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBob2xkZXJJZCA9IGdldEhvbGRlcklkKF9vd25lcik7CiAgICAgICAgcmV0dXJuIGlzQ3JlYXRlZChfc3ltYm9sKSAmJiAoYXNzZXRzW19zeW1ib2xdLm93bmVyID09IGhvbGRlcklkIHx8IGFzc2V0c1tfc3ltYm9sXS5wYXJ0b3duZXJzW2hvbGRlcklkXSk7CiAgICB9CgogICAgLy8vIFJldHVybnMgYXNzZXQgdG90YWwgc3VwcGx5LgogICAgLy8vCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBhc3NldCB0b3RhbCBzdXBwbHkuCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseShieXRlczMyIF9zeW1ib2wpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLnRvdGFsU3VwcGx5OwogICAgfQoKICAgIC8vLyBSZXR1cm5zIGFzc2V0IGJhbGFuY2UgZm9yIGEgcGFydGljdWxhciBob2xkZXIuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBob2xkZXIgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIGhvbGRlciBiYWxhbmNlLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX2hvbGRlciwgYnl0ZXMzMiBfc3ltYm9sKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9iYWxhbmNlT2YoZ2V0SG9sZGVySWQoX2hvbGRlciksIF9zeW1ib2wpOwogICAgfQoKICAgIC8vLyBSZXR1cm5zIGFzc2V0IGJhbGFuY2UgZm9yIGEgcGFydGljdWxhciBob2xkZXIgaWQuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX2hvbGRlcklkIGhvbGRlciBpZC4KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIGhvbGRlciBiYWxhbmNlLgogICAgZnVuY3Rpb24gX2JhbGFuY2VPZih1aW50IF9ob2xkZXJJZCwgYnl0ZXMzMiBfc3ltYm9sKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19ob2xkZXJJZF0uYmFsYW5jZTsKICAgIH0KCiAgICAvLy8gUmV0dXJucyBjdXJyZW50IGFkZHJlc3MgZm9yIGEgcGFydGljdWxhciBob2xkZXIgaWQuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX2hvbGRlcklkIGhvbGRlciBpZC4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gaG9sZGVyIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBfYWRkcmVzcyh1aW50IF9ob2xkZXJJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBob2xkZXJzW19ob2xkZXJJZF0uYWRkcjsKICAgIH0KCiAgICAvLy8gQWRkcyBhIGNvLW93bmVyIGZvciBhbiBhc3NldCB3aXRoIHByb3ZpZGVkIHN5bWJvbC4KICAgIC8vLyBAZGV2IFNob3VsZCBiZSBwZXJmb3JtZWQgYnkgYSBjb250cmFjdCBvd25lciBvciBpdHMgY28tb3duZXJzCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCdzIHN5bWJvbAogICAgLy8vIEBwYXJhbSBfcGFydG93bmVyIGEgY28tb3duZXIgb2YgYW4gYXNzZXQKICAgIC8vLwogICAgLy8vIEByZXR1cm4gZXJyb3JDb2RlIHJlc3VsdCBjb2RlIG9mIGFuIG9wZXJhdGlvbgogICAgZnVuY3Rpb24gYWRkQXNzZXRQYXJ0T3duZXIoYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9wYXJ0b3duZXIpIG9ubHlPbmVPZk93bmVycyhfc3ltYm9sKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgaG9sZGVySWQgPSBfY3JlYXRlSG9sZGVySWQoX3BhcnRvd25lcik7CiAgICAgICAgYXNzZXRzW19zeW1ib2xdLnBhcnRvd25lcnNbaG9sZGVySWRdID0gdHJ1ZTsKICAgICAgICBDQVZQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdE93bmVyc2hpcENoYW5nZSgweDAsIF9wYXJ0b3duZXIsIF9zeW1ib2wpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvLy8gUmVtb3ZlcyBhIGNvLW93bmVyIGZvciBhbiBhc3NldCB3aXRoIHByb3ZpZGVkIHN5bWJvbC4KICAgIC8vLyBAZGV2IFNob3VsZCBiZSBwZXJmb3JtZWQgYnkgYSBjb250cmFjdCBvd25lciBvciBpdHMgY28tb3duZXJzCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCdzIHN5bWJvbAogICAgLy8vIEBwYXJhbSBfcGFydG93bmVyIGEgY28tb3duZXIgb2YgYW4gYXNzZXQKICAgIC8vLwogICAgLy8vIEByZXR1cm4gZXJyb3JDb2RlIHJlc3VsdCBjb2RlIG9mIGFuIG9wZXJhdGlvbgogICAgZnVuY3Rpb24gcmVtb3ZlQXNzZXRQYXJ0T3duZXIoYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9wYXJ0b3duZXIpIG9ubHlPbmVPZk93bmVycyhfc3ltYm9sKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgaG9sZGVySWQgPSBnZXRIb2xkZXJJZChfcGFydG93bmVyKTsKICAgICAgICBkZWxldGUgYXNzZXRzW19zeW1ib2xdLnBhcnRvd25lcnNbaG9sZGVySWRdOwogICAgICAgIENBVlBsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0T3duZXJzaGlwQ2hhbmdlKF9wYXJ0b3duZXIsIDB4MCwgX3N5bWJvbCk7CiAgICAgICAgcmV0dXJuIE9LOwogICAgfQoKICAgIC8vLyBTZXRzIFByb3h5IGNvbnRyYWN0IGFkZHJlc3MgZm9yIGEgcGFydGljdWxhciBhc3NldC4KICAgIC8vLwogICAgLy8vIENhbiBiZSBzZXQgb25seSBvbmNlIGZvciBlYWNoIGFzc2V0LCBhbmQgb25seSBieSBjb250cmFjdCBvd25lci4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfcHJveHlBZGRyZXNzIFByb3h5IGNvbnRyYWN0IGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBzdWNjZXNzLgogICAgZnVuY3Rpb24gc2V0UHJveHkoYWRkcmVzcyBfcHJveHlBZGRyZXNzLCBieXRlczMyIF9zeW1ib2wpIHB1YmxpYyBvbmx5T25lT2ZDb250cmFjdE93bmVycyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKHByb3hpZXNbX3N5bWJvbF0gIT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBDQVZfUExBVEZPUk1fUFJPWFlfQUxSRUFEWV9FWElTVFM7CiAgICAgICAgfQoKICAgICAgICBwcm94aWVzW19zeW1ib2xdID0gX3Byb3h5QWRkcmVzczsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLy8vIFRyYW5zZmVycyBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycyB3YWxsZXRzLgogICAgLy8vCiAgICAvLy8gQHBhcmFtIF9mcm9tSWQgaG9sZGVyIGlkIHRvIHRha2UgZnJvbS4KICAgIC8vLyBAcGFyYW0gX3RvSWQgaG9sZGVyIGlkIHRvIGdpdmUgdG8uCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyRGlyZWN0KHVpbnQgX2Zyb21JZCwgdWludCBfdG9JZCwgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3N5bWJvbCkgaW50ZXJuYWwgewogICAgICAgIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19mcm9tSWRdLmJhbGFuY2UgPSBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfZnJvbUlkXS5iYWxhbmNlLnN1YihfdmFsdWUpOwogICAgICAgIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW190b0lkXS5iYWxhbmNlID0gYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX3RvSWRdLmJhbGFuY2UuYWRkKF92YWx1ZSk7CiAgICB9CgogICAgLy8vIFRyYW5zZmVycyBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycyB3YWxsZXRzLgogICAgLy8vCiAgICAvLy8gUGVyZm9ybXMgc2FuaXR5IGNoZWNrcyBhbmQgdGFrZXMgY2FyZSBvZiBhbGxvd2FuY2VzIGFkanVzdG1lbnQuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX2Zyb21JZCBob2xkZXIgaWQgdG8gdGFrZSBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG9JZCBob2xkZXIgaWQgdG8gZ2l2ZSB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAvLy8gQHBhcmFtIF9yZWZlcmVuY2UgdHJhbnNmZXIgY29tbWVudCB0byBiZSBpbmNsdWRlZCBpbiBhIFRyYW5zZmVyIGV2ZW50LgogICAgLy8vIEBwYXJhbSBfc2VuZGVySWQgdHJhbnNmZXIgaW5pdGlhdG9yIGhvbGRlciBpZC4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gc3VjY2Vzcy4KICAgIGZ1bmN0aW9uIF90cmFuc2Zlcih1aW50IF9mcm9tSWQsIHVpbnQgX3RvSWQsIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zeW1ib2wsIHN0cmluZyBfcmVmZXJlbmNlLCB1aW50IF9zZW5kZXJJZCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIFNob3VsZCBub3QgYWxsb3cgdG8gc2VuZCB0byBvbmVzZWxmLgogICAgICAgIGlmIChfZnJvbUlkID09IF90b0lkKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0FWX1BMQVRGT1JNX0NBTk5PVF9BUFBMWV9UT19PTkVTRUxGKTsKICAgICAgICB9CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgcG9zaXRpdmUgdmFsdWUuCiAgICAgICAgaWYgKF92YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0FWX1BMQVRGT1JNX0lOVkFMSURfVkFMVUUpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgaGF2ZSBlbm91Z2ggYmFsYW5jZS4KICAgICAgICBpZiAoX2JhbGFuY2VPZihfZnJvbUlkLCBfc3ltYm9sKSA8IF92YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENBVl9QTEFURk9STV9JTlNVRkZJQ0lFTlRfQkFMQU5DRSk7CiAgICAgICAgfQogICAgICAgIC8vIFNob3VsZCBoYXZlIGVub3VnaCBhbGxvd2FuY2UuCiAgICAgICAgaWYgKF9mcm9tSWQgIT0gX3NlbmRlcklkICYmIF9hbGxvd2FuY2UoX2Zyb21JZCwgX3NlbmRlcklkLCBfc3ltYm9sKSA8IF92YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENBVl9QTEFURk9STV9OT1RfRU5PVUdIX0FMTE9XQU5DRSk7CiAgICAgICAgfQoKICAgICAgICBfdHJhbnNmZXJEaXJlY3QoX2Zyb21JZCwgX3RvSWQsIF92YWx1ZSwgX3N5bWJvbCk7CiAgICAgICAgLy8gQWRqdXN0IGFsbG93YW5jZS4KICAgICAgICBpZiAoX2Zyb21JZCAhPSBfc2VuZGVySWQpIHsKICAgICAgICAgICAgYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX2Zyb21JZF0uYWxsb3dhbmNlW19zZW5kZXJJZF0gPSBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tfZnJvbUlkXS5hbGxvd2FuY2VbX3NlbmRlcklkXS5zdWIoX3ZhbHVlKTsKICAgICAgICB9CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBDQVZQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdFRyYW5zZmVyKF9hZGRyZXNzKF9mcm9tSWQpLCBfYWRkcmVzcyhfdG9JZCksIF9zeW1ib2wsIF92YWx1ZSwgX3JlZmVyZW5jZSk7CiAgICAgICAgX3Byb3h5VHJhbnNmZXJFdmVudChfZnJvbUlkLCBfdG9JZCwgX3ZhbHVlLCBfc3ltYm9sKTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLy8vIFRyYW5zZmVycyBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycyB3YWxsZXRzLgogICAgLy8vCiAgICAvLy8gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGFzc2V0IHByb3h5LgogICAgLy8vCiAgICAvLy8gQHBhcmFtIF90byBob2xkZXIgYWRkcmVzcyB0byBnaXZlIHRvLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLyBAcGFyYW0gX3JlZmVyZW5jZSB0cmFuc2ZlciBjb21tZW50IHRvIGJlIGluY2x1ZGVkIGluIGEgVHJhbnNmZXIgZXZlbnQuCiAgICAvLy8gQHBhcmFtIF9zZW5kZXIgdHJhbnNmZXIgaW5pdGlhdG9yIGFkZHJlc3MuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiBwcm94eVRyYW5zZmVyV2l0aFJlZmVyZW5jZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3N5bWJvbCwgc3RyaW5nIF9yZWZlcmVuY2UsIGFkZHJlc3MgX3NlbmRlcikgcHVibGljIG9ubHlQcm94eShfc3ltYm9sKSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF90cmFuc2ZlcihnZXRIb2xkZXJJZChfc2VuZGVyKSwgX2NyZWF0ZUhvbGRlcklkKF90byksIF92YWx1ZSwgX3N5bWJvbCwgX3JlZmVyZW5jZSwgZ2V0SG9sZGVySWQoX3NlbmRlcikpOwogICAgfQoKICAgIC8vLyBBc2sgYXNzZXQgUHJveHkgY29udHJhY3QgdG8gZW1pdCBFUkMyMCBjb21wbGlhbnQgVHJhbnNmZXIgZXZlbnQuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX2Zyb21JZCBob2xkZXIgaWQgdG8gdGFrZSBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG9JZCBob2xkZXIgaWQgdG8gZ2l2ZSB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICBmdW5jdGlvbiBfcHJveHlUcmFuc2ZlckV2ZW50KHVpbnQgX2Zyb21JZCwgdWludCBfdG9JZCwgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3N5bWJvbCkgaW50ZXJuYWwgewogICAgICAgIGlmIChwcm94aWVzW19zeW1ib2xdICE9IDB4MCkgewogICAgICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgICAgIC8vIFJlY3Vyc2l2ZSBDYWxsOiBzYWZlLCBhbGwgY2hhbmdlcyBhbHJlYWR5IG1hZGUuCiAgICAgICAgICAgIFByb3h5RXZlbnRzRW1pdHRlcihwcm94aWVzW19zeW1ib2xdKS5lbWl0VHJhbnNmZXIoX2FkZHJlc3MoX2Zyb21JZCksIF9hZGRyZXNzKF90b0lkKSwgX3ZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIFJldHVybnMgaG9sZGVyIGlkIGZvciB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX2hvbGRlciBob2xkZXIgYWRkcmVzcy4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gaG9sZGVyIGlkLgogICAgZnVuY3Rpb24gZ2V0SG9sZGVySWQoYWRkcmVzcyBfaG9sZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGhvbGRlckluZGV4W19ob2xkZXJdOwogICAgfQoKICAgIC8vLyBSZXR1cm5zIGhvbGRlciBpZCBmb3IgdGhlIHNwZWNpZmllZCBhZGRyZXNzLCBjcmVhdGVzIGl0IGlmIG5lZWRlZC4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfaG9sZGVyIGhvbGRlciBhZGRyZXNzLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBob2xkZXIgaWQuCiAgICBmdW5jdGlvbiBfY3JlYXRlSG9sZGVySWQoYWRkcmVzcyBfaG9sZGVyKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBob2xkZXJJZCA9IGhvbGRlckluZGV4W19ob2xkZXJdOwogICAgICAgIGlmIChob2xkZXJJZCA9PSAwKSB7CiAgICAgICAgICAgIGhvbGRlcklkID0gKytob2xkZXJzQ291bnQ7CiAgICAgICAgICAgIGhvbGRlcnNbaG9sZGVySWRdLmFkZHIgPSBfaG9sZGVyOwogICAgICAgICAgICBob2xkZXJJbmRleFtfaG9sZGVyXSA9IGhvbGRlcklkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaG9sZGVySWQ7CiAgICB9CgogICAgLy8vIElzc3VlcyBuZXcgYXNzZXQgdG9rZW4gb24gdGhlIHBsYXRmb3JtLgogICAgLy8vCiAgICAvLy8gVG9rZW5zIGlzc3VlZCB3aXRoIHRoaXMgY2FsbCBnbyBzdHJhaWdodCB0byBjb250cmFjdCBvd25lci4KICAgIC8vLyBFYWNoIHN5bWJvbCBjYW4gYmUgaXNzdWVkIG9ubHkgb25jZSwgYW5kIG9ubHkgYnkgY29udHJhY3Qgb3duZXIuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIHRvIGlzc3VlIGltbWVkaWF0ZWx5LgogICAgLy8vIEBwYXJhbSBfbmFtZSBuYW1lIG9mIHRoZSBhc3NldC4KICAgIC8vLyBAcGFyYW0gX2Rlc2NyaXB0aW9uIGRlc2NyaXB0aW9uIGZvciB0aGUgYXNzZXQuCiAgICAvLy8gQHBhcmFtIF9iYXNlVW5pdCBudW1iZXIgb2YgZGVjaW1hbHMuCiAgICAvLy8gQHBhcmFtIF9pc1JlaXNzdWFibGUgZHluYW1pYyBvciBmaXhlZCBzdXBwbHkuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiBpc3N1ZUFzc2V0KGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUsIHN0cmluZyBfbmFtZSwgc3RyaW5nIF9kZXNjcmlwdGlvbiwgdWludDggX2Jhc2VVbml0LCBib29sIF9pc1JlaXNzdWFibGUpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGlzc3VlQXNzZXQoX3N5bWJvbCwgX3ZhbHVlLCBfbmFtZSwgX2Rlc2NyaXB0aW9uLCBfYmFzZVVuaXQsIF9pc1JlaXNzdWFibGUsIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vLyBJc3N1ZXMgbmV3IGFzc2V0IHRva2VuIG9uIHRoZSBwbGF0Zm9ybS4KICAgIC8vLwogICAgLy8vIFRva2VucyBpc3N1ZWQgd2l0aCB0aGlzIGNhbGwgZ28gc3RyYWlnaHQgdG8gY29udHJhY3Qgb3duZXIuCiAgICAvLy8gRWFjaCBzeW1ib2wgY2FuIGJlIGlzc3VlZCBvbmx5IG9uY2UsIGFuZCBvbmx5IGJ5IGNvbnRyYWN0IG93bmVyLgogICAgLy8vCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBpc3N1ZSBpbW1lZGlhdGVseS4KICAgIC8vLyBAcGFyYW0gX25hbWUgbmFtZSBvZiB0aGUgYXNzZXQuCiAgICAvLy8gQHBhcmFtIF9kZXNjcmlwdGlvbiBkZXNjcmlwdGlvbiBmb3IgdGhlIGFzc2V0LgogICAgLy8vIEBwYXJhbSBfYmFzZVVuaXQgbnVtYmVyIG9mIGRlY2ltYWxzLgogICAgLy8vIEBwYXJhbSBfaXNSZWlzc3VhYmxlIGR5bmFtaWMgb3IgZml4ZWQgc3VwcGx5LgogICAgLy8vIEBwYXJhbSBfYWNjb3VudCBhZGRyZXNzIHdoZXJlIGlzc3VlZCBiYWxhbmNlIHdpbGwgYmUgaGVsZAogICAgLy8vCiAgICAvLy8gQHJldHVybiBzdWNjZXNzLgogICAgZnVuY3Rpb24gaXNzdWVBc3NldChieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlLCBzdHJpbmcgX25hbWUsIHN0cmluZyBfZGVzY3JpcHRpb24sIHVpbnQ4IF9iYXNlVW5pdCwgYm9vbCBfaXNSZWlzc3VhYmxlLCBhZGRyZXNzIF9hY2NvdW50KSBvbmx5T25lT2ZDb250cmFjdE93bmVycyBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIFNob3VsZCBoYXZlIHBvc2l0aXZlIHZhbHVlIGlmIHN1cHBseSBpcyBnb2luZyB0byBiZSBmaXhlZC4KICAgICAgICBpZiAoX3ZhbHVlID09IDAgJiYgIV9pc1JlaXNzdWFibGUpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDQVZfUExBVEZPUk1fQ0FOTk9UX0lTU1VFX0ZJWEVEX0FTU0VUX1dJVEhfSU5WQUxJRF9WQUxVRSk7CiAgICAgICAgfQogICAgICAgIC8vIFNob3VsZCBub3QgYmUgaXNzdWVkIHlldC4KICAgICAgICBpZiAoaXNDcmVhdGVkKF9zeW1ib2wpKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0FWX1BMQVRGT1JNX0FTU0VUX0FMUkVBRFlfSVNTVUVEKTsKICAgICAgICB9CiAgICAgICAgdWludCBob2xkZXJJZCA9IF9jcmVhdGVIb2xkZXJJZChfYWNjb3VudCk7CiAgICAgICAgdWludCBjcmVhdG9ySWQgPSBfYWNjb3VudCA9PSBtc2cuc2VuZGVyID8gaG9sZGVySWQgOiBfY3JlYXRlSG9sZGVySWQobXNnLnNlbmRlcik7CgogICAgICAgIHN5bWJvbHMucHVzaChfc3ltYm9sKTsKICAgICAgICBhc3NldHNbX3N5bWJvbF0gPSBBc3NldChjcmVhdG9ySWQsIF92YWx1ZSwgX25hbWUsIF9kZXNjcmlwdGlvbiwgX2lzUmVpc3N1YWJsZSwgX2Jhc2VVbml0KTsKICAgICAgICBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZSA9IF92YWx1ZTsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIENBVlBsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0SXNzdWUoX3N5bWJvbCwgX3ZhbHVlLCBfYWRkcmVzcyhob2xkZXJJZCkpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvLy8gSXNzdWVzIGFkZGl0aW9uYWwgYXNzZXQgdG9rZW5zIGlmIHRoZSBhc3NldCBoYXZlIGR5bmFtaWMgc3VwcGx5LgogICAgLy8vCiAgICAvLy8gVG9rZW5zIGlzc3VlZCB3aXRoIHRoaXMgY2FsbCBnbyBzdHJhaWdodCB0byBhc3NldCBvd25lci4KICAgIC8vLyBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXNzZXQgb3duZXIuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBhbW91bnQgb2YgYWRkaXRpb25hbCB0b2tlbnMgdG8gaXNzdWUuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiByZWlzc3VlQXNzZXQoYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSkgb25seU9uZU9mT3duZXJzKF9zeW1ib2wpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgcG9zaXRpdmUgdmFsdWUuCiAgICAgICAgaWYgKF92YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0FWX1BMQVRGT1JNX0lOVkFMSURfVkFMVUUpOwogICAgICAgIH0KICAgICAgICBBc3NldCBzdG9yYWdlIGFzc2V0ID0gYXNzZXRzW19zeW1ib2xdOwogICAgICAgIC8vIFNob3VsZCBoYXZlIGR5bmFtaWMgc3VwcGx5LgogICAgICAgIGlmICghYXNzZXQuaXNSZWlzc3VhYmxlKSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0FWX1BMQVRGT1JNX0NBTk5PVF9SRUlTU1VFX0ZJWEVEX0FTU0VUKTsKICAgICAgICB9CiAgICAgICAgLy8gUmVzdWx0aW5nIHRvdGFsIHN1cHBseSBzaG91bGQgbm90IG92ZXJmbG93LgogICAgICAgIGlmIChhc3NldC50b3RhbFN1cHBseSArIF92YWx1ZSA8IGFzc2V0LnRvdGFsU3VwcGx5KSB7CiAgICAgICAgICAgIHJldHVybiBfZXJyb3IoQ0FWX1BMQVRGT1JNX1NVUFBMWV9PVkVSRkxPVyk7CiAgICAgICAgfQogICAgICAgIHVpbnQgaG9sZGVySWQgPSBnZXRIb2xkZXJJZChtc2cuc2VuZGVyKTsKICAgICAgICBhc3NldC53YWxsZXRzW2hvbGRlcklkXS5iYWxhbmNlID0gYXNzZXQud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZS5hZGQoX3ZhbHVlKTsKICAgICAgICBhc3NldC50b3RhbFN1cHBseSA9IGFzc2V0LnRvdGFsU3VwcGx5LmFkZChfdmFsdWUpOwogICAgICAgIC8vIEludGVybmFsIE91dCBPZiBHYXMvVGhyb3c6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgIC8vIFJlY3Vyc2l2ZSBDYWxsOiBzYWZlLCBhbGwgY2hhbmdlcyBhbHJlYWR5IG1hZGUuCiAgICAgICAgQ0FWUGxhdGZvcm1FbWl0dGVyKGV2ZW50c0hpc3RvcnkpLmVtaXRJc3N1ZShfc3ltYm9sLCBfdmFsdWUsIF9hZGRyZXNzKGhvbGRlcklkKSk7CiAgICAgICAgX3Byb3h5VHJhbnNmZXJFdmVudCgwLCBob2xkZXJJZCwgX3ZhbHVlLCBfc3ltYm9sKTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLy8vIERlc3Ryb3lzIHNwZWNpZmllZCBhbW91bnQgb2Ygc2VuZGVycyBhc3NldCB0b2tlbnMuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlc3Ryb3kuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiByZXZva2VBc3NldChieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIFNob3VsZCBoYXZlIHBvc2l0aXZlIHZhbHVlLgogICAgICAgIGlmIChfdmFsdWUgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENBVl9QTEFURk9STV9JTlZBTElEX1ZBTFVFKTsKICAgICAgICB9CiAgICAgICAgQXNzZXQgc3RvcmFnZSBhc3NldCA9IGFzc2V0c1tfc3ltYm9sXTsKICAgICAgICB1aW50IGhvbGRlcklkID0gZ2V0SG9sZGVySWQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgZW5vdWdoIHRva2Vucy4KICAgICAgICBpZiAoYXNzZXQud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZSA8IF92YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENBVl9QTEFURk9STV9OT1RfRU5PVUdIX1RPS0VOUyk7CiAgICAgICAgfQogICAgICAgIGFzc2V0LndhbGxldHNbaG9sZGVySWRdLmJhbGFuY2UgPSBhc3NldC53YWxsZXRzW2hvbGRlcklkXS5iYWxhbmNlLnN1YihfdmFsdWUpOwogICAgICAgIGFzc2V0LnRvdGFsU3VwcGx5ID0gYXNzZXQudG90YWxTdXBwbHkuc3ViKF92YWx1ZSk7CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBDQVZQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdFJldm9rZShfc3ltYm9sLCBfdmFsdWUsIF9hZGRyZXNzKGhvbGRlcklkKSk7CiAgICAgICAgX3Byb3h5VHJhbnNmZXJFdmVudChob2xkZXJJZCwgMCwgX3ZhbHVlLCBfc3ltYm9sKTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLy8vIFBhc3NlcyBhc3NldCBvd25lcnNoaXAgdG8gc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAvLy8KICAgIC8vLyBPbmx5IG93bmVyc2hpcCBpcyBjaGFuZ2VkLCBiYWxhbmNlcyBhcmUgbm90IHRvdWNoZWQuCiAgICAvLy8gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGFzc2V0IG93bmVyLgogICAgLy8vCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgLy8vIEBwYXJhbSBfbmV3T3duZXIgYWRkcmVzcyB0byBiZWNvbWUgYSBuZXcgb3duZXIuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcnNoaXAoYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG9ubHlPd25lcihfc3ltYm9sKSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKF9uZXdPd25lciA9PSAweDApIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDQVZfUExBVEZPUk1fSU5WQUxJRF9ORVdfT1dORVIpOwogICAgICAgIH0KCiAgICAgICAgQXNzZXQgc3RvcmFnZSBhc3NldCA9IGFzc2V0c1tfc3ltYm9sXTsKICAgICAgICB1aW50IG5ld093bmVySWQgPSBfY3JlYXRlSG9sZGVySWQoX25ld093bmVyKTsKICAgICAgICAvLyBTaG91bGQgcGFzcyBvd25lcnNoaXAgdG8gYW5vdGhlciBob2xkZXIuCiAgICAgICAgaWYgKGFzc2V0Lm93bmVyID09IG5ld093bmVySWQpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDQVZfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYpOwogICAgICAgIH0KICAgICAgICBhZGRyZXNzIG9sZE93bmVyID0gX2FkZHJlc3MoYXNzZXQub3duZXIpOwogICAgICAgIGFzc2V0Lm93bmVyID0gbmV3T3duZXJJZDsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIENBVlBsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0T3duZXJzaGlwQ2hhbmdlKG9sZE93bmVyLCBfbmV3T3duZXIsIF9zeW1ib2wpOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvLy8gQ2hlY2sgaWYgc3BlY2lmaWVkIGhvbGRlciB0cnVzdHMgYW4gYWRkcmVzcyB3aXRoIHJlY292ZXJ5IHByb2NlZHVyZS4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfZnJvbSB0cnVzdGVyLgogICAgLy8vIEBwYXJhbSBfdG8gdHJ1c3RlZS4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gdHJ1c3QgZXhpc3RhbmNlLgogICAgZnVuY3Rpb24gaXNUcnVzdGVkKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGhvbGRlcnNbZ2V0SG9sZGVySWQoX2Zyb20pXS50cnVzdFtfdG9dOwogICAgfQoKICAgIC8vLyBUcnVzdCBhbiBhZGRyZXNzIHRvIHBlcmZvcm0gcmVjb3ZlcnkgcHJvY2VkdXJlIGZvciB0aGUgY2FsbGVyLgogICAgLy8vCiAgICAvLy8gQHBhcmFtIF90byB0cnVzdGVlLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBzdWNjZXNzLgogICAgZnVuY3Rpb24gdHJ1c3QoYWRkcmVzcyBfdG8pIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBmcm9tSWQgPSBfY3JlYXRlSG9sZGVySWQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gU2hvdWxkIHRydXN0IHRvIGFub3RoZXIgYWRkcmVzcy4KICAgICAgICBpZiAoZnJvbUlkID09IGdldEhvbGRlcklkKF90bykpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDQVZfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYpOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgdHJ1c3QgdG8geWV0IHVudHJ1c3RlZC4KICAgICAgICBpZiAoaXNUcnVzdGVkKG1zZy5zZW5kZXIsIF90bykpIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDQVZfUExBVEZPUk1fQUxSRUFEWV9UUlVTVEVEKTsKICAgICAgICB9CgogICAgICAgIGhvbGRlcnNbZnJvbUlkXS50cnVzdFtfdG9dID0gdHJ1ZTsKICAgICAgICByZXR1cm4gT0s7CiAgICB9CgogICAgLy8vIFJldm9rZSB0cnVzdCB0byBwZXJmb3JtIHJlY292ZXJ5IHByb2NlZHVyZSBmcm9tIGFuIGFkZHJlc3MuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX3RvIHRydXN0ZWUuCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiBkaXN0cnVzdChhZGRyZXNzIF90bykgY2hlY2tUcnVzdChtc2cuc2VuZGVyLCBfdG8pIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaG9sZGVyc1tnZXRIb2xkZXJJZChtc2cuc2VuZGVyKV0udHJ1c3RbX3RvXSA9IGZhbHNlOwogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICBmdW5jdGlvbiBtYXNzVHJhbnNmZXIoYWRkcmVzc1tdIGFkZHJlc3NlcywgdWludFtdIHZhbHVlcywgYnl0ZXMzMiBfc3ltYm9sKQogICAgZXh0ZXJuYWwKICAgIG9ubHlPbmVPZk93bmVycyhfc3ltYm9sKQogICAgcmV0dXJucyAodWludCBlcnJvckNvZGUsIHVpbnQgY291bnQpCiAgICB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzZXMubGVuZ3RoID09IHZhbHVlcy5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoX3N5bWJvbCAhPSAweDApOwoKICAgICAgICB1aW50IHNlbmRlcklkID0gX2NyZWF0ZUhvbGRlcklkKG1zZy5zZW5kZXIpOwoKICAgICAgICB1aW50IHN1Y2Nlc3MgPSAwOwogICAgICAgIGZvcih1aW50IGlkeCA9IDA7IGlkeCA8IGFkZHJlc3Nlcy5sZW5ndGggJiYgbXNnLmdhcyA+IDExMDAwMDsgaWR4KyspIHsKICAgICAgICAgICAgdWludCB2YWx1ZSA9IHZhbHVlc1tpZHhdOwoKICAgICAgICAgICAgaWYgKHZhbHVlID09IDApIHsKICAgICAgICAgICAgICBfZXJyb3IoQ0FWX1BMQVRGT1JNX0lOVkFMSURfVkFMVUUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoX2JhbGFuY2VPZihzZW5kZXJJZCwgX3N5bWJvbCkgPCB2YWx1ZSkgewogICAgICAgICAgICAgIF9lcnJvcihDQVZfUExBVEZPUk1fSU5TVUZGSUNJRU5UX0JBTEFOQ0UpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBhZGRyZXNzZXNbaWR4XSkgewogICAgICAgICAgICAgIF9lcnJvcihDQVZfUExBVEZPUk1fQ0FOTk9UX0FQUExZX1RPX09ORVNFTEYpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB1aW50IGhvbGRlcklkID0gX2NyZWF0ZUhvbGRlcklkKGFkZHJlc3Nlc1tpZHhdKTsKCiAgICAgICAgICAgIF90cmFuc2ZlckRpcmVjdChzZW5kZXJJZCwgaG9sZGVySWQsIHZhbHVlLCBfc3ltYm9sKTsKICAgICAgICAgICAgQ0FWUGxhdGZvcm1FbWl0dGVyKGV2ZW50c0hpc3RvcnkpLmVtaXRUcmFuc2Zlcihtc2cuc2VuZGVyLCBhZGRyZXNzZXNbaWR4XSwgX3N5bWJvbCwgdmFsdWUsICIiKTsKCiAgICAgICAgICAgIHN1Y2Nlc3MrKzsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKE9LLCBzdWNjZXNzKTsKICAgIH0KCiAgICAvLy8gUGVyZm9ybSByZWNvdmVyeSBwcm9jZWR1cmUuCiAgICAvLy8KICAgIC8vLyBUaGlzIGZ1bmN0aW9uIGxvZ2ljIGlzIGFjdHVhbGx5IG1vcmUgb2YgYW4gYWRkQWNjZXNzKHVpbnQgX2hvbGRlcklkLCBhZGRyZXNzIF90bykuCiAgICAvLy8gSXQgZ3JhbnRzIGFub3RoZXIgYWRkcmVzcyBhY2Nlc3MgdG8gcmVjb3Zlcnkgc3ViamVjdCB3YWxsZXRzLgogICAgLy8vIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0cnVzdGVlIG9mIHJlY292ZXJ5IHN1YmplY3QuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX2Zyb20gaG9sZGVyIGFkZHJlc3MgdG8gcmVjb3ZlciBmcm9tLgogICAgLy8vIEBwYXJhbSBfdG8gYWRkcmVzcyB0byBncmFudCBhY2Nlc3MgdG8uCiAgICAvLy8KICAgIC8vLyBAcmV0dXJuIHN1Y2Nlc3MuCiAgICBmdW5jdGlvbiByZWNvdmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvKSBjaGVja1RydXN0KF9mcm9tLCBtc2cuc2VuZGVyKSBwdWJsaWMgcmV0dXJucyAodWludCBlcnJvckNvZGUpIHsKICAgICAgICAvLyBTaG91bGQgcmVjb3ZlciB0byBwcmV2aW91c2x5IHVudXNlZCBhZGRyZXNzLgogICAgICAgIGlmIChnZXRIb2xkZXJJZChfdG8pICE9IDApIHsKICAgICAgICAgICAgcmV0dXJuIF9lcnJvcihDQVZfUExBVEZPUk1fU0hPVUxEX1JFQ09WRVJfVE9fTkVXX0FERFJFU1MpOwogICAgICAgIH0KICAgICAgICAvLyBXZSB0YWtlIGN1cnJlbnQgaG9sZGVyIGFkZHJlc3MgYmVjYXVzZSBpdCBtaWdodCBub3QgZXF1YWwgX2Zyb20uCiAgICAgICAgLy8gSXQgaXMgcG9zc2libGUgdG8gcmVjb3ZlciBmcm9tIGFueSBvbGQgaG9sZGVyIGFkZHJlc3MsIGJ1dCBldmVudCBzaG91bGQgaGF2ZSB0aGUgY3VycmVudCBvbmUuCiAgICAgICAgYWRkcmVzcyBmcm9tID0gaG9sZGVyc1tnZXRIb2xkZXJJZChfZnJvbSldLmFkZHI7CiAgICAgICAgaG9sZGVyc1tnZXRIb2xkZXJJZChfZnJvbSldLmFkZHIgPSBfdG87CiAgICAgICAgaG9sZGVySW5kZXhbX3RvXSA9IGdldEhvbGRlcklkKF9mcm9tKTsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBDQVZQbGF0Zm9ybUVtaXR0ZXIoZXZlbnRzSGlzdG9yeSkuZW1pdFJlY292ZXJ5KGZyb20sIF90bywgbXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIE9LOwogICAgfQoKICAgIC8vLyBTZXRzIGFzc2V0IHNwZW5kaW5nIGFsbG93YW5jZSBmb3IgYSBzcGVjaWZpZWQgc3BlbmRlci4KICAgIC8vLwogICAgLy8vIE5vdGU6IHRvIHJldm9rZSBhbGxvd2FuY2UsIG9uZSBuZWVkcyB0byBzZXQgYWxsb3dhbmNlIHRvIDAuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXJJZCBob2xkZXIgaWQgdG8gc2V0IGFsbG93YW5jZSBmb3IuCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gYWxsb3cuCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgLy8vIEBwYXJhbSBfc2VuZGVySWQgYXBwcm92ZSBpbml0aWF0b3IgaG9sZGVyIGlkLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBzdWNjZXNzLgogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludCBfc3BlbmRlcklkLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF9zZW5kZXJJZCkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIEFzc2V0IHNob3VsZCBleGlzdC4KICAgICAgICBpZiAoIWlzQ3JlYXRlZChfc3ltYm9sKSkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENBVl9QTEFURk9STV9BU1NFVF9JU19OT1RfSVNTVUVEKTsKICAgICAgICB9CiAgICAgICAgLy8gU2hvdWxkIGFsbG93IHRvIGFub3RoZXIgaG9sZGVyLgogICAgICAgIGlmIChfc2VuZGVySWQgPT0gX3NwZW5kZXJJZCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENBVl9QTEFURk9STV9DQU5OT1RfQVBQTFlfVE9fT05FU0VMRik7CiAgICAgICAgfQoKICAgICAgICAvLyBEb3VibGUgU3BlbmQgQXR0YWNrIGNoZWNrcG9pbnQKICAgICAgICBpZiAoYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX3NlbmRlcklkXS5hbGxvd2FuY2VbX3NwZW5kZXJJZF0gIT0gMCAmJiBfdmFsdWUgIT0gMCkgewogICAgICAgICAgICByZXR1cm4gX2Vycm9yKENBVl9QTEFURk9STV9JTlZBTElEX0lOVk9DQVRJT04pOwogICAgICAgIH0KCiAgICAgICAgYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX3NlbmRlcklkXS5hbGxvd2FuY2VbX3NwZW5kZXJJZF0gPSBfdmFsdWU7CgogICAgICAgIC8vIEludGVybmFsIE91dCBPZiBHYXMvVGhyb3c6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IHJldmVydCB0aGlzIHRyYW5zYWN0aW9uIHRvbzsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIENBVlBsYXRmb3JtRW1pdHRlcihldmVudHNIaXN0b3J5KS5lbWl0QXBwcm92ZShfYWRkcmVzcyhfc2VuZGVySWQpLCBfYWRkcmVzcyhfc3BlbmRlcklkKSwgX3N5bWJvbCwgX3ZhbHVlKTsKICAgICAgICBpZiAocHJveGllc1tfc3ltYm9sXSAhPSAweDApIHsKICAgICAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgICAgICBQcm94eUV2ZW50c0VtaXR0ZXIocHJveGllc1tfc3ltYm9sXSkuZW1pdEFwcHJvdmUoX2FkZHJlc3MoX3NlbmRlcklkKSwgX2FkZHJlc3MoX3NwZW5kZXJJZCksIF92YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBPSzsKICAgIH0KCiAgICAvLy8gU2V0cyBhc3NldCBzcGVuZGluZyBhbGxvd2FuY2UgZm9yIGEgc3BlY2lmaWVkIHNwZW5kZXIuCiAgICAvLy8KICAgIC8vLyBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXNzZXQgcHJveHkuCiAgICAvLy8KICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgaG9sZGVyIGFkZHJlc3MgdG8gc2V0IGFsbG93YW5jZSB0by4KICAgIC8vLyBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byBhbGxvdy4KICAgIC8vLyBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAvLy8gQHBhcmFtIF9zZW5kZXIgYXBwcm92ZSBpbml0aWF0b3IgYWRkcmVzcy4KICAgIC8vLwogICAgLy8vIEByZXR1cm4gc3VjY2Vzcy4KICAgIGZ1bmN0aW9uIHByb3h5QXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9zZW5kZXIpIG9ubHlQcm94eShfc3ltYm9sKSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBfYXBwcm92ZShfY3JlYXRlSG9sZGVySWQoX3NwZW5kZXIpLCBfdmFsdWUsIF9zeW1ib2wsIF9jcmVhdGVIb2xkZXJJZChfc2VuZGVyKSk7CiAgICB9CgogICAgLy8vIFJldHVybnMgYXNzZXQgYWxsb3dhbmNlIGZyb20gb25lIGhvbGRlciB0byBhbm90aGVyLgogICAgLy8vCiAgICAvLy8gQHBhcmFtIF9mcm9tIGhvbGRlciB0aGF0IGFsbG93ZWQgc3BlbmRpbmcuCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIGhvbGRlciB0aGF0IGlzIGFsbG93ZWQgdG8gc3BlbmQuCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBob2xkZXIgdG8gc3BlbmRlciBhbGxvd2FuY2UuCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfc3BlbmRlciwgYnl0ZXMzMiBfc3ltYm9sKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9hbGxvd2FuY2UoZ2V0SG9sZGVySWQoX2Zyb20pLCBnZXRIb2xkZXJJZChfc3BlbmRlciksIF9zeW1ib2wpOwogICAgfQoKICAgIC8vLyBSZXR1cm5zIGFzc2V0IGFsbG93YW5jZSBmcm9tIG9uZSBob2xkZXIgdG8gYW5vdGhlci4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfZnJvbUlkIGhvbGRlciBpZCB0aGF0IGFsbG93ZWQgc3BlbmRpbmcuCiAgICAvLy8gQHBhcmFtIF90b0lkIGhvbGRlciBpZCB0aGF0IGlzIGFsbG93ZWQgdG8gc3BlbmQuCiAgICAvLy8gQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBob2xkZXIgdG8gc3BlbmRlciBhbGxvd2FuY2UuCiAgICBmdW5jdGlvbiBfYWxsb3dhbmNlKHVpbnQgX2Zyb21JZCwgdWludCBfdG9JZCwgYnl0ZXMzMiBfc3ltYm9sKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX2Zyb21JZF0uYWxsb3dhbmNlW190b0lkXTsKICAgIH0KCiAgICAvLy8gUHJmb3JtcyBhbGxvd2FuY2UgdHJhbnNmZXIgb2YgYXNzZXQgYmFsYW5jZSBiZXR3ZWVuIGhvbGRlcnMgd2FsbGV0cy4KICAgIC8vLwogICAgLy8vIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhc3NldCBwcm94eS4KICAgIC8vLwogICAgLy8vIEBwYXJhbSBfZnJvbSBob2xkZXIgYWRkcmVzcyB0byB0YWtlIGZyb20uCiAgICAvLy8gQHBhcmFtIF90byBob2xkZXIgYWRkcmVzcyB0byBnaXZlIHRvLgogICAgLy8vIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIHRyYW5zZmVyLgogICAgLy8vIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgIC8vLyBAcGFyYW0gX3JlZmVyZW5jZSB0cmFuc2ZlciBjb21tZW50IHRvIGJlIGluY2x1ZGVkIGluIGEgVHJhbnNmZXIgZXZlbnQuCiAgICAvLy8gQHBhcmFtIF9zZW5kZXIgYWxsb3dhbmNlIHRyYW5zZmVyIGluaXRpYXRvciBhZGRyZXNzLgogICAgLy8vCiAgICAvLy8gQHJldHVybiBzdWNjZXNzLgogICAgZnVuY3Rpb24gcHJveHlUcmFuc2ZlckZyb21XaXRoUmVmZXJlbmNlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCBzdHJpbmcgX3JlZmVyZW5jZSwgYWRkcmVzcyBfc2VuZGVyKSBvbmx5UHJveHkoX3N5bWJvbCkgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gX3RyYW5zZmVyKGdldEhvbGRlcklkKF9mcm9tKSwgX2NyZWF0ZUhvbGRlcklkKF90byksIF92YWx1ZSwgX3N5bWJvbCwgX3JlZmVyZW5jZSwgZ2V0SG9sZGVySWQoX3NlbmRlcikpOwogICAgfQp9'.
	

]
