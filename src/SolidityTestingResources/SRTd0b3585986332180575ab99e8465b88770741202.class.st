Class {
	#name : #SRTd0b3585986332180575ab99e8465b88770741202,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTd0b3585986332180575ab99e8465b88770741202 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjsKCi8vIFRoZSBiZWxvdyB0d28gaW50ZXJmYWNlcyAoS2l0dHlDb3JlIGFuZCBTYWxlQ2xvY2tBdWN0aW9uKSBhcmUgZnJvbSBDcnlwdG8gS2l0dGllcy4gVGhpcyBjb250cmFjdCB3aWxsIGhhdmUgdG8gY2FsbCB0aGUgQ3J5cHRvIEtpdHRpZXMgY29udHJhY3RzIHRvIGZpbmQgdGhlIG93bmVyIG9mIGEgS2l0dHksIHRoZSBwcm9wZXJ0aWVzIG9mIGEgS2l0dHkgYW5kIGEgS2l0dGllcyBwcmljZS4KaW50ZXJmYWNlIEtpdHR5Q29yZSB7CgogICAgZnVuY3Rpb24gb3duZXJPZiAodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKTsKICAgIAogICAgZnVuY3Rpb24gZ2V0S2l0dHkgKHVpbnQyNTYgX2lkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wgaXNHZXN0YXRpbmcsIGJvb2wgaXNSZWFkeSwgdWludDI1NiBjb29sZG93bkluZGV4LCB1aW50MjU2IG5leHRBY3Rpb25BdCwgdWludDI1NiBzaXJpbmdXaXRoSWQsIHVpbnQyNTYgYmlydGhUaW1lLCB1aW50MjU2IG1hdHJvbklkLCB1aW50MjU2IHNpcmVJZCwgdWludDI1NiBnZW5lcmF0aW9uLCB1aW50MjU2IGdlbmVzKTsKICAgIAp9CgppbnRlcmZhY2UgU2FsZUNsb2NrQXVjdGlvbiB7CiAgICAKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQcmljZSAodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIAogICAgZnVuY3Rpb24gZ2V0QXVjdGlvbih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgc2VsbGVyLCB1aW50MjU2IHN0YXJ0aW5nUHJpY2UsIHVpbnQyNTYgZW5kaW5nUHJpY2UsIHVpbnQyNTYgZHVyYXRpb24sIHVpbnQyNTYgc3RhcnRlZEF0KTsKICAgIAp9CgovLyBFUkM3MjEgdG9rZW4gc3RhbmRhcmQgaXMgdXNlZCBmb3Igbm9uLWZ1bmdpYmxlIGFzc2V0cywgbGlrZSBTcHJpdGVzIChub24tZnVuZ2libGUgYmVjYXVzZSB0aGV5IGNhbid0IGJlIHNwbGl0IGludG8gcGllY2VzIGFuZCBkb24ndCBoYXZlIGVxdWFsIHZhbHVlKS4gVGVjaG5pY2FsbHkgdGhpcyBjb250cmFjdCB3aWxsIGFsc28gYmUgRVJDMjAgY29tcGxpYW50Lgpjb250cmFjdCBFUkM3MjEgewogICAgLy8gUmVxdWlyZWQgbWV0aG9kcwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbDsKICAgIAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSB2aWV3IHJldHVybnMgKHVpbnQgcmVtYWluaW5nKTsKCiAgICAvLyBFdmVudHMKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nKTsKICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyk7CiAgICAKICAgIC8vIGZ1bmN0aW9uIHRva2Vuc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NltdIHRva2VuSWRzKTsKICAgIC8vIGZ1bmN0aW9uIHRva2VuTWV0YWRhdGEodWludDI1NiBfdG9rZW5JZCwgc3RyaW5nIF9wcmVmZXJyZWRUcmFuc3BvcnQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKTsKCiAgICAvLyBFUkMtMTY1IENvbXBhdGliaWxpdHkgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpCiAgICBmdW5jdGlvbiBzdXBwb3J0c0ludGVyZmFjZShieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBDcnlwdG9TcHJpdGVzIGlzIEVSQzcyMSB7CiAgICAKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgCiAgICBhZGRyZXNzIEtpdHR5Q29yZUFkZHJlc3MgPSAweDA2MDEyYzhjZjk3QkVhRDVkZUFlMjM3MDcwRjk1ODdmOEU3QTI2NmQ7CgogICAgYWRkcmVzcyBTYWxlQ2xvY2tBdWN0aW9uQWRkcmVzcyA9IDB4YjE2OTBDMDhFMjEzYTM1RWQ5YkFiN0IzMThERTE0NDIwRkI1N2Q4QzsKCiAgICAvLyAxLjUlIG9mIFNwcml0ZSBzYWxlcyB0byBnbyB0byBIZWlmZXIgSW50ZXJuYXRpb25hbDogaHR0cHM6Ly93d3cuaGVpZmVyLm9yZy93aGF0LXlvdS1jYW4tZG8vZ2l2ZS9kaWdpdGFsLWN1cnJlbmN5Lmh0bWwgKG5vdCBhZmZpbGlhdGVkIHdpdGggdGhpcyBnYW1lKQogICAgYWRkcmVzcyBjaGFyaXR5QWRkcmVzcyA9IDB4YjMwY2IzYjNFMDNBNTA4RGIyQTBhM2UwN0JBMTI5N2I0N2JiMGZiMTsKICAgIAogICAgdWludCBwdWJsaWMgZXRoZXJGb3JPd25lcjsKICAgIHVpbnQgcHVibGljIGV0aGVyRm9yQ2hhcml0eTsKICAgIAogICAgdWludCBwdWJsaWMgb3duZXJDdXQgPSAxNTsgLy8gMS41JSAoMTUvMTAwMCAtIHNlZSB0aGUgYnV5U3ByaXRlKCkgZnVuY3Rpb24pIG9mIFNwcml0ZSBzYWxlcyBnbyB0byBvd25lciBvZiB0aGlzIGNvbnRyYWN0CiAgICB1aW50IHB1YmxpYyBjaGFyaXR5Q3V0ID0gMTU7IC8vIDEuNSUgb2YgU3ByaXRlIHNhbGVzIGFsc28gZ28gdG8gYW4gZXN0YWJsaXNoZWQgY2hhcml0eSAoSGVpZmVyIEludGVybmF0aW9uYWwpCiAgICAKICAgIHVpbnQgcHVibGljIGZlYXR1cmVQcmljZSA9IDEwKioxNjsgLy8gMC4wMSBFdGhlciB0byBmZWF0dXJlIGEgc3ByaXRlCiAgICAKICAgIC8vIFdpdGggdGhlIGJlbG93IHRoZSBkZWZhdWx0IHByaWNlIG9mIGEgU3ByaXRlIG9mIGEga2l0dHkgd291bGQgYmUgb25seSAxMCUgb2YgdGhlIGtpdHRpZXMgcHJpY2UuIElmIGZvciBleGFtcGxlIHByaWNlTXVsdGlwbGllciA9IDE1IGFuZCBwcmljZURpdmlkZXIgPSAxMCwgdGhlbiB0aGUgZGVmYXVsdCBwcmljZSBvZiBhIHNwcml0ZSB3b3VsZCBiZSAxLjUgdGltZXMgdGhlIHByaWNlIG9mIGl0cyBraXR0eS4gU2luY2UgU29saWRpdHkgZG9lc24ndCBhbGxvdyBkZWNpbWFscywgdHdvIG51bWJlcnMgYXJlIG5lZWRlZCBmb3IgIGZsZXhpYmlsaXR5IGluIHNldHRpbmcgdGhlIGRlZmF1bHQgcHJpY2UgYSBzcHJpdGUgd291bGQgYmUgaW4gcmVsYXRpb24gdG8gdGhlIHByaWNlIG9mIGl0cyBraXR0ZW4sIGluIGNhc2UgdGhhdCdzIG5lZWRlZCBsYXRlciAob3duZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gY2hhbmdlIHRoZSBkZWZhdWx0IHByaWNlIG9mIFNwcml0ZXMgYW55dGltZSkuIAogICAgLy8gVGhlIGRlZmF1bHQgcHJpY2Ugb2YgYSBTcHJpdGUgbWF5IGVhc2lseSBpbmNyZWFzZSBsYXRlciB0byBiZSBtb3JlIHRoYW4gMTAlCiAgICB1aW50IHB1YmxpYyBwcmljZU11bHRpcGxpZXIgPSAxOwogICAgdWludCBwdWJsaWMgcHJpY2VEaXZpZGVyID0gMTA7CiAgICAKICAgIG1vZGlmaWVyIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBDcnlwdG9TcHJpdGVzKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KICAgIAogICAgdWludFtdIHB1YmxpYyBmZWF0dXJlZFNwcml0ZXM7CiAgICAKICAgIHVpbnRbXSBwdWJsaWMgYWxsUHVyY2hhc2VkU3ByaXRlczsKICAgIAogICAgdWludCBwdWJsaWMgdG90YWxGZWF0dXJlczsKICAgIHVpbnQgcHVibGljIHRvdGFsQnV5czsKICAgIAogICAgc3RydWN0IEJyb3VnaHRTcHJpdGVzIHsKICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgIHVpbnQgc3ByaXRlSW1hZ2VJRDsKICAgICAgICBib29sIGZvclNhbGU7CiAgICAgICAgdWludCBwcmljZTsKICAgICAgICB1aW50IHRpbWVzVHJhZGVkOwogICAgICAgIGJvb2wgZmVhdHVyZWQ7CiAgICB9CiAgICAKICAgIG1hcHBpbmcgKHVpbnQgPT4gQnJvdWdodFNwcml0ZXMpIHB1YmxpYyBicm91Z2h0U3ByaXRlczsKICAgIAogICAgLy8gVGhpcyBtYXkgaW5jbHVkZSBTcHJpdGVzIHRoZSB1c2VyIHByZXZpb3VzbHkgb3duZWQgYnV0IGRvZXNuJ3QgYW55bW9yZQogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50W10pIHB1YmxpYyBzcHJpdGVPd25pbmdIaXN0b3J5OwogICAgCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBudW1iZXJPZlNwcml0ZXNPd25lZEJ5VXNlcjsKICAgIAogICAgLy8gRmlyc3QgYWRkcmVzcyBpcyB0aGUgYWRkcmVzcyBvZiBhIFNwcml0ZSBvd25lciwgc2Vjb25kIGFkZHJlc3MgaXMgYW4gYWRkcmVzcyBoYXZpbmcgYXBwcm92YWwgdG8gbW92ZSBhIHRva2VuIGJlbG9uZ2luZyB0byB0aGUgZmlyc3QgYWRkcmVzcywgdWludFtdIGlzIHRoZSBhcnJheSBvZiBTcHJpdGVzIGJlbG9uZ2luZyB0byB0aGUgZmlyc3QgYWRkcmVzcyB0aGF0IHRoZSBzZWNvbmQgYWRkcmVzcyBoYXMgYXBwcm92YWwgdG8gdHJhbnNmZXIKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50W10pKSBwdWJsaWMgYWxsb3dlZDsKICAgIAogICAgYnl0ZXM0IGNvbnN0YW50IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUgPSBieXRlczQoa2VjY2FrMjU2KCdzdXBwb3J0c0ludGVyZmFjZShieXRlczQpJykpOwogICAgCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG90YWxTdXBwbHkoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignYmFsYW5jZU9mKGFkZHJlc3MpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdhcHByb3ZlKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSk7CgogICAgZnVuY3Rpb24oKSBwYXlhYmxlIHsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRqdXN0RGVmYXVsdFNwcml0ZVByaWNlICh1aW50IF9wcmljZU11bHRpcGxpZXIsIHVpbnQgX3ByaWNlRGl2aWRlcikgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlIChfcHJpY2VNdWx0aXBsaWVyID4gMCk7CiAgICAgICAgcmVxdWlyZSAoX3ByaWNlRGl2aWRlciA+IDApOwogICAgICAgIHByaWNlTXVsdGlwbGllciA9IF9wcmljZU11bHRpcGxpZXI7CiAgICAgICAgcHJpY2VEaXZpZGVyID0gX3ByaWNlRGl2aWRlcjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRqdXN0Q3V0ICh1aW50IF9vd25lckN1dCwgdWludCBfY2hhcml0eUN1dCkgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlIChfb3duZXJDdXQgKyBfY2hhcml0eUN1dCA8IDUxKTsgLy8gS2VlcCB0aGlzIGNvbnRyYWN0IGhvbmVzdCBieSBhbGxvd2luZyB0aGUgbWF4aW11bSBjb21iaW5lZCBjdXQgdG8gYmUgbm8gbW9yZSB0aGFuIDUlICg1MC8xMDAwKSBvZiBzYWxlcwogICAgICAgIG93bmVyQ3V0ID0gX293bmVyQ3V0OwogICAgICAgIGNoYXJpdHlDdXQgPSBfY2hhcml0eUN1dDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRqdXN0RmVhdHVyZVByaWNlICh1aW50IF9mZWF0dXJlUHJpY2UpIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZSAoX2ZlYXR1cmVQcmljZSA+IDApOwogICAgICAgIGZlYXR1cmVQcmljZSA9IF9mZWF0dXJlUHJpY2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgb25seU93bmVyIHsKICAgICAgICBvd25lci50cmFuc2ZlcihldGhlckZvck93bmVyKTsKICAgICAgICBjaGFyaXR5QWRkcmVzcy50cmFuc2ZlcihldGhlckZvckNoYXJpdHkpOwogICAgICAgIGV0aGVyRm9yT3duZXIgPSAwOwogICAgICAgIGV0aGVyRm9yQ2hhcml0eSA9IDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGZlYXR1cmVTcHJpdGUgKHVpbnQgc3ByaXRlSWQpIHBheWFibGUgewogICAgICAgIC8vIERvIG5vdCBuZWVkIHRvIHJlcXVpcmUgdXNlciB0byBiZSB0aGUgb3duZXIgb2YgYSBTcHJpdGUgdG8gZmVhdHVyZSBpdAogICAgICAgIC8vIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLm93bmVyKTsKICAgICAgICByZXF1aXJlIChtc2cudmFsdWUgPT0gZmVhdHVyZVByaWNlKTsKICAgICAgICBicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0uZmVhdHVyZWQgPSB0cnVlOwoKICAgICAgICBpZiAoYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLnRpbWVzVHJhZGVkID09IDApIHsKICAgICAgICAgICAgYWRkcmVzcyBraXR0eU93bmVyID0gS2l0dHlDb3JlKEtpdHR5Q29yZUFkZHJlc3MpLm93bmVyT2Yoc3ByaXRlSWQpOwogICAgICAgICAgICB1aW50IHByaWNlSWZBbnkgPSBTYWxlQ2xvY2tBdWN0aW9uKFNhbGVDbG9ja0F1Y3Rpb25BZGRyZXNzKS5nZXRDdXJyZW50UHJpY2Uoc3ByaXRlSWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gV2hlbiBmZWF0dXJpbmcgYSBTcHJpdGUgdGhhdCBoYXNuJ3QgYmVlbiB0cmFkZWQgYmVmb3JlLCBpZiB0aGUgb3JpZ2luYWwgS2l0dHkgaXMgZm9yIHNhbGUsIHVwZGF0ZSB0aGlzIFNwcml0ZSB3aXRoIGEgcHJpY2UgYW5kIHNldCBmb3JTYWxlID0gdHJ1ZSAtIGFzIGxvbmcgYXMgbXNnLnNlbmRlciBpcyB0aGUgb3duZXIgb2YgdGhlIEtpdHR5LiBPdGhlcndpc2UgaXQgY291bGQgYmUgdGhhdCB0aGUgb3duZXIgb2YgdGhlIEtpdHR5IHJlbW92ZWQgdGhlIFNwcml0ZSBmb3Igc2FsZSBhbmQgYSBkaWZmZXJlbnQgdXNlciBjb3VsZCBmZWF0dXJlIHRoZSBTcHJpdGUgYW5kIGhhdmUgaXQgbGlzdGVkIGZvciBzYWxlCiAgICAgICAgICAgIGlmIChwcmljZUlmQW55ID4gMCAmJiBtc2cuc2VuZGVyID09IGtpdHR5T3duZXIpIHsKICAgICAgICAgICAgICAgIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5wcmljZSA9IHByaWNlSWZBbnkgKiBwcmljZU11bHRpcGxpZXIgLyBwcmljZURpdmlkZXI7CiAgICAgICAgICAgICAgICBicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0uZm9yU2FsZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5vd25lciA9IGtpdHR5T3duZXI7CiAgICAgICAgICAgIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5zcHJpdGVJbWFnZUlEID0gdWludChibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKSUzNjAgKyAxOwogICAgICAgICAgICAKICAgICAgICAgICAgbnVtYmVyT2ZTcHJpdGVzT3duZWRCeVVzZXJba2l0dHlPd25lcl0rKzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdG90YWxGZWF0dXJlcysrOwogICAgICAgIGV0aGVyRm9yT3duZXIgKz0gbXNnLnZhbHVlOwogICAgICAgIGZlYXR1cmVkU3ByaXRlcy5wdXNoKHNwcml0ZUlkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYnV5U3ByaXRlICh1aW50IHNwcml0ZUlkKSBwYXlhYmxlIHsKICAgICAgICAKICAgICAgICB1aW50IF9vd25lckN1dDsKICAgICAgICB1aW50IF9jaGFyaXR5Q3V0OwogICAgICAgIAogICAgICAgIGlmIChicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0uZm9yU2FsZSA9PSB0cnVlKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCdXlpbmcgYSBzcHJpdGUgdGhhdCBoYXMgYmVlbiBwdXJjaGFzZWQgb3IgZmVhdHVyZWQgYmVmb3JlLCBmcm9tIGEgcGxheWVyIG9mIHRoaXMgZ2FtZSB3aG8gaGFzIGxpc3RlZCBpdCBmb3Igc2FsZQogICAgICAgICAgICAKICAgICAgICAgICAgX293bmVyQ3V0ID0gKChicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0ucHJpY2UgLyAxMDAwKSAqIG93bmVyQ3V0KTsKICAgICAgICAgICAgX2NoYXJpdHlDdXQgPSAoKGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5wcmljZSAvIDEwMDApICogY2hhcml0eUN1dCk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXF1aXJlIChtc2cudmFsdWUgPT0gYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLnByaWNlICsgX293bmVyQ3V0ICsgX2NoYXJpdHlDdXQpOwogICAgICAgICAgICAKICAgICAgICAgICAgYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLm93bmVyLnRyYW5zZmVyKGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5wcmljZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBudW1iZXJPZlNwcml0ZXNPd25lZEJ5VXNlclticm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0ub3duZXJdLS07CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLnRpbWVzVHJhZGVkID09IDApIHsKICAgICAgICAgICAgICAgIC8vIEZlYXR1cmVkIHNwcml0ZSB0aGF0IGlzIGJlaW5nIHB1cmNoYXNlZCBmb3IgdGhlIGZpcnN0IHRpbWUKICAgICAgICAgICAgICAgIGFsbFB1cmNoYXNlZFNwcml0ZXMucHVzaChzcHJpdGVJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIFRyYW5zZmVyIChtc2cuc2VuZGVyLCBicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0ub3duZXIsIHNwcml0ZUlkKTsKICAgICAgICAgICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEJ1eWluZyBhIHNwcml0ZSB0aGF0IGhhcyBuZXZlciBiZWVuIGJyb3VnaHQgYmVmb3JlLCBmcm9tIGEga2l0dGVuIGN1cnJlbnRseSBsaXN0ZWQgZm9yIHNhbGUgaW4gdGhlIENyeXB0b0tpdHRpZXMgY29udHJhY3QuIFRoZSBzYWxlIHByaWNlIHdpbGwgZ28gdG8gdGhlIG93bmVyIG9mIHRoZSBraXR0ZW4gaW4gdGhlIENyeXB0b0tpdHRpZXMgY29udHJhY3QgKHdobyB2ZXJ5IHBvc3NpYmx5IHdvdWxkIGhhdmUgbmV2ZXIgZXZlbiBoZWFyZCBvZiB0aGlzIGdhbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXF1aXJlIChicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0udGltZXNUcmFkZWQgPT0gMCk7CiAgICAgICAgICAgIHJlcXVpcmUgKGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5wcmljZSA9PSAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEhlcmUgd2UgYXJlIGxvb2tpbmcgdXAgdGhlIHByaWNlIG9mIHRoZSBTcHJpdGUncyBjb3JyZXNwb25kaW5nIEtpdHR5CiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50IHByaWNlSWZBbnkgPSBTYWxlQ2xvY2tBdWN0aW9uKFNhbGVDbG9ja0F1Y3Rpb25BZGRyZXNzKS5nZXRDdXJyZW50UHJpY2Uoc3ByaXRlSWQpOwogICAgICAgICAgICByZXF1aXJlIChwcmljZUlmQW55ID4gMCk7IC8vIElmIHRoZSBraXR0ZW4gaW4gdGhlIENyeXB0b0tpdHRpZXMgY29udHJhY3QgaXNuJ3QgZm9yIHNhbGUsIGEgU3ByaXRlIGZvciBpdCB3b24ndCBiZSBmb3Igc2FsZSBlaXRoZXIKICAgICAgICAgICAgCiAgICAgICAgICAgIF9vd25lckN1dCA9ICgocHJpY2VJZkFueSAvIDEwMDApICogb3duZXJDdXQpICogcHJpY2VNdWx0aXBsaWVyIC8gcHJpY2VEaXZpZGVyOwogICAgICAgICAgICBfY2hhcml0eUN1dCA9ICgocHJpY2VJZkFueSAvIDEwMDApICogY2hhcml0eUN1dCkgKiBwcmljZU11bHRpcGxpZXIgLyBwcmljZURpdmlkZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXF1aXJlIChtc2cudmFsdWUgPT0gKHByaWNlSWZBbnkgKiBwcmljZU11bHRpcGxpZXIgLyBwcmljZURpdmlkZXIpICsgX293bmVyQ3V0ICsgX2NoYXJpdHlDdXQpOwogICAgICAgICAgICAKICAgICAgICAgICAgYWRkcmVzcyBraXR0eU93bmVyID0gS2l0dHlDb3JlKEtpdHR5Q29yZUFkZHJlc3MpLm93bmVyT2Yoc3ByaXRlSWQpOwogICAgICAgICAgICAKICAgICAgICAgICAga2l0dHlPd25lci50cmFuc2ZlcihwcmljZUlmQW55ICogcHJpY2VNdWx0aXBsaWVyIC8gcHJpY2VEaXZpZGVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFsbFB1cmNoYXNlZFNwcml0ZXMucHVzaChzcHJpdGVJZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0uc3ByaXRlSW1hZ2VJRCA9IHVpbnQoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSklMzYwICsgMTsgLy8gUmFuZG9tIG51bWJlciB0byBkZXRlcm1pbmUgd2hhdCBpbWFnZS9jaGFyYWN0ZXIgdGhlIHNwcml0ZSB3aWxsIGJlCiAgICAgICAgICAgIAogICAgICAgICAgICBUcmFuc2ZlciAoa2l0dHlPd25lciwgbXNnLnNlbmRlciwgc3ByaXRlSWQpOwogICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdG90YWxCdXlzKys7CiAgICAgICAgCiAgICAgICAgc3ByaXRlT3duaW5nSGlzdG9yeVttc2cuc2VuZGVyXS5wdXNoKHNwcml0ZUlkKTsKICAgICAgICBudW1iZXJPZlNwcml0ZXNPd25lZEJ5VXNlclttc2cuc2VuZGVyXSsrOwogICAgICAgIAogICAgICAgIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5vd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLmZvclNhbGUgPSBmYWxzZTsKICAgICAgICBicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0udGltZXNUcmFkZWQrKzsKICAgICAgICBicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0uZmVhdHVyZWQgPSBmYWxzZTsKICAgICAgICAgICAgCiAgICAgICAgZXRoZXJGb3JPd25lciArPSBfb3duZXJDdXQ7CiAgICAgICAgZXRoZXJGb3JDaGFyaXR5ICs9IF9jaGFyaXR5Q3V0OwogICAgICAgIAogICAgfQogICAgCiAgICAvLyBBbHNvIHVzZWQgdG8gYWRqdXN0IHByaWNlIGlmIGFscmVhZHkgZm9yIHNhbGUKICAgIGZ1bmN0aW9uIGxpc3RTcHJpdGVGb3JTYWxlICh1aW50IHNwcml0ZUlkLCB1aW50IHByaWNlKSB7CiAgICAgICAgcmVxdWlyZSAocHJpY2UgPiAwKTsKICAgICAgICBpZiAoYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLm93bmVyICE9IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgcmVxdWlyZSAoYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLnRpbWVzVHJhZGVkID09IDApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGhpcyB3aWxsIGJlIHRoZSBvd25lciBvZiBhIENyeXB0byBLaXR0eSwgd2hvIGNhbiBjb250cm9sIHRoZSBwcmljZSBvZiB0aGVpciB1bmJyb3VnaHQgU3ByaXRlCiAgICAgICAgICAgIGFkZHJlc3Mga2l0dHlPd25lciA9IEtpdHR5Q29yZShLaXR0eUNvcmVBZGRyZXNzKS5vd25lck9mKHNwcml0ZUlkKTsKICAgICAgICAgICAgcmVxdWlyZSAoa2l0dHlPd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5vd25lciA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5zcHJpdGVJbWFnZUlEID0gdWludChibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKSUzNjAgKyAxOyAKICAgICAgICB9CiAgICAgICAgYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLmZvclNhbGUgPSB0cnVlOwogICAgICAgIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5wcmljZSA9IHByaWNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByZW1vdmVTcHJpdGVGcm9tU2FsZSAodWludCBzcHJpdGVJZCkgewogICAgICAgIGlmIChicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0ub3duZXIgIT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICByZXF1aXJlIChicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0udGltZXNUcmFkZWQgPT0gMCk7CiAgICAgICAgICAgIGFkZHJlc3Mga2l0dHlPd25lciA9IEtpdHR5Q29yZShLaXR0eUNvcmVBZGRyZXNzKS5vd25lck9mKHNwcml0ZUlkKTsKICAgICAgICAgICAgcmVxdWlyZSAoa2l0dHlPd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLnByaWNlID0gMTsgLy8gV2hlbiBhIHVzZXIgYnV5cyBhIFNwcml0ZSBJZCB0aGF0IGlzbid0IGZvciBzYWxlIGluIHRoZSBidXlTcHJpdGUoKSBmdW5jdGlvbiAoaWUuIHdvdWxkIGJlIGEgU3ByaXRlIHRoYXQncyBuZXZlciBiZWVuIGJyb3VnaHQgYmVmb3JlLCBmb3IgYSBDcnlwdG8gS2l0dHkgdGhhdCdzIGZvciBzYWxlKSwgb25lIG9mIHRoZSByZXF1aXJlbWVudHMgaXMgYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLnByaWNlID09IDAsIHdoaWNoIHdpbGwgYmUgdGhlIGNhc2UgYnkgZGVmYXVsdC4gQnkgbWFraW5nIHRoZSBwcmljZSA9IDEgdGhpcyB3aWxsIHRocm93IGFuZCB0aGUgU3ByaXRlIHdvbid0IGJlIGFibGUgdG8gYmUgYnJvdWdodAogICAgICAgIH0gCiAgICAgICAgYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLmZvclNhbGUgPSBmYWxzZTsKICAgIH0KICAgIAogICAgLy8gVGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgYXJlIGluIGNhc2UgYSBkaWZmZXJlbnQgY29udHJhY3Qgd2FudHMgdG8gcHVsbCB0aGlzIGRhdGEsIHdoaWNoIHJlcXVpcmVzIGEgZnVuY3Rpb24gcmV0dXJuaW5nIGl0IChldmVuIGlmIHRoZSB2YXJpYWJsZXMgYXJlIHB1YmxpYykgc2luY2Ugc29saWRpdHkgY29udHJhY3RzIGNhbid0IGRpcmVjdGx5IHB1bGwgc3RvcmFnZSBvZiBhbm90aGVyIGNvbnRyYWN0CiAgICAKICAgIGZ1bmN0aW9uIGZlYXR1cmVkU3ByaXRlc0xlbmd0aCgpIHZpZXcgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBmZWF0dXJlZFNwcml0ZXMubGVuZ3RoOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1c2Vyc1Nwcml0ZU93bmluZ0hpc3RvcnkgKGFkZHJlc3MgdXNlcikgdmlldyBleHRlcm5hbCByZXR1cm5zICh1aW50W10pIHsKICAgICAgICByZXR1cm4gc3ByaXRlT3duaW5nSGlzdG9yeVt1c2VyXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbG9va3VwU3ByaXRlICh1aW50IHNwcml0ZUlkKSB2aWV3IGV4dGVybmFsIHJldHVybnMgKGFkZHJlc3MsIHVpbnQsIGJvb2wsIHVpbnQsIHVpbnQsIGJvb2wpIHsKICAgICAgICByZXR1cm4gKGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5vd25lciwgYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLnNwcml0ZUltYWdlSUQsIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS5mb3JTYWxlLCBicm91Z2h0U3ByaXRlc1tzcHJpdGVJZF0ucHJpY2UsIGJyb3VnaHRTcHJpdGVzW3Nwcml0ZUlkXS50aW1lc1RyYWRlZCwgYnJvdWdodFNwcml0ZXNbc3ByaXRlSWRdLmZlYXR1cmVkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbG9va3VwRmVhdHVyZWRTcHJpdGVzICh1aW50IHNwcml0ZUlkKSB2aWV3IGV4dGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gZmVhdHVyZWRTcHJpdGVzW3Nwcml0ZUlkXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbG9va3VwQWxsU3ByaXRlcyAodWludCBzcHJpdGVJZCkgdmlldyBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFsbFB1cmNoYXNlZFNwcml0ZXNbc3ByaXRlSWRdOwogICAgfQogICAgCiAgICAvLyBXaWxsIGNhbGwgU2FsZUNsb2NrQXVjdGlvbiB0byBnZXQgdGhlIG93bmVyIG9mIGEga2l0dGVuIGFuZCBjaGVjayBpdHMgcHJpY2UgKGlmIGl0J3MgZm9yIHNhbGUpLiBXZSdyZSBjYWxsaW5nIHRoZSBnZXRBdWN0aW9uKCkgZnVuY3Rpb24gaW4gdGhlIFNhbGVDbG9ja0F1Y3Rpb24gdG8gZ2V0IHRoZSBraXR0eSBvd25lciAodGhhdCBmdW5jdGlvbiByZXR1cm5zIDUgdmFyaWFibGVzLCB3ZSBvbmx5IHdhbnQgdGhlIG93bmVyKS4gb3duZXJPZigpIGluIHRoZSBLaXR0eUNvcmUgY29udHJhY3Qgd29uJ3QgcmV0dXJuIHRoZSBraXR0eSBvd25lciBpZiB0aGUga2l0dHkgaXMgZm9yIHNhbGUsIGFuZCB0aGlzIHByb2JhYmx5IHdvbid0IGJlIHVzZWQgKGluY2x1ZGluZyBpdCBpbiBjYXNlIGl0J3MgbmVlZGVkIHRvIGxvb2t1cCBhbiBvd25lciBvZiBhIGtpdHR5IG5vdCBmb3Igc2FsZSBsYXRlciBmb3IgYW55IHJlYXNvbikKICAgIAogICAgZnVuY3Rpb24gbG9va3VwS2l0dHkgKHVpbnQga2l0dHlJZCkgdmlldyByZXR1cm5zIChhZGRyZXNzLCB1aW50LCBhZGRyZXNzKSB7CiAgICAgICAgCiAgICAgICAgdmFyIChraXR0eU93bmVyLCwsLCkgPSBTYWxlQ2xvY2tBdWN0aW9uKFNhbGVDbG9ja0F1Y3Rpb25BZGRyZXNzKS5nZXRBdWN0aW9uKGtpdHR5SWQpOwoKICAgICAgICB1aW50IHByaWNlSWZBbnkgPSBTYWxlQ2xvY2tBdWN0aW9uKFNhbGVDbG9ja0F1Y3Rpb25BZGRyZXNzKS5nZXRDdXJyZW50UHJpY2Uoa2l0dHlJZCk7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBraXR0eU93bmVyTm90Rm9yU2FsZSA9IEtpdHR5Q29yZShLaXR0eUNvcmVBZGRyZXNzKS5vd25lck9mKGtpdHR5SWQpOwoKICAgICAgICByZXR1cm4gKGtpdHR5T3duZXIsIHByaWNlSWZBbnksIGtpdHR5T3duZXJOb3RGb3JTYWxlKTsKCiAgICB9CiAgICAKICAgIC8vIFRoZSBiZWxvdyB0d28gZnVuY3Rpb25zIHdpbGwgcHVsbCBhbGwgaW5mbyBvZiBhIGtpdHRlbi4gU3BsaXQgaW50byB0d28gZnVuY3Rpb25zIG90aGVyd2lzZSBzdGFjayB0b28gZGVlcCBlcnJvcnMuIFRoZXNlIG1heSBub3QgZXZlbiBiZSBuZWVkZWQsIG1heSBqdXN0IGJlIHVzZWQgc28gdGhlIHdlYnNpdGUgY2FuIGRpc3BsYXkgYWxsIGluZm8gb2YgYSBraXR0ZW4gd2hlbiBzb21lb25lIGxvb2tzIGl0IHVwLgogICAgCiAgICBmdW5jdGlvbiBsb29rdXBLaXR0eURldGFpbHMxICh1aW50IGtpdHR5SWQpIHZpZXcgcmV0dXJucyAoYm9vbCwgYm9vbCwgdWludCwgdWludCwgdWludCkgewogICAgICAgIAogICAgICAgIHZhciAoaXNHZXN0YXRpbmcsIGlzUmVhZHksIGNvb2xkb3duSW5kZXgsIG5leHRBY3Rpb25BdCwgc2lyaW5nV2l0aElkLCwsLCwpID0gS2l0dHlDb3JlKEtpdHR5Q29yZUFkZHJlc3MpLmdldEtpdHR5KGtpdHR5SWQpOwogICAgICAgIAogICAgICAgIHJldHVybiAoaXNHZXN0YXRpbmcsIGlzUmVhZHksIGNvb2xkb3duSW5kZXgsIG5leHRBY3Rpb25BdCwgc2lyaW5nV2l0aElkKTsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gbG9va3VwS2l0dHlEZXRhaWxzMiAodWludCBraXR0eUlkKSB2aWV3IHJldHVybnMgKHVpbnQsIHVpbnQsIHVpbnQsIHVpbnQsIHVpbnQpIHsKICAgICAgICAKICAgICAgICB2YXIoLCwsLCxiaXJ0aFRpbWUsIG1hdHJvbklkLCBzaXJlSWQsIGdlbmVyYXRpb24sIGdlbmVzKSA9IEtpdHR5Q29yZShLaXR0eUNvcmVBZGRyZXNzKS5nZXRLaXR0eShraXR0eUlkKTsKICAgICAgICAKICAgICAgICByZXR1cm4gKGJpcnRoVGltZSwgbWF0cm9uSWQsIHNpcmVJZCwgZ2VuZXJhdGlvbiwgZ2VuZXMpOwogICAgICAgIAogICAgfQogICAgCiAgICAvLyBFUkMtNzIxIHJlcXVpcmVkIGZ1bmN0aW9ucyBiZWxvdwogICAgCiAgICBzdHJpbmcgcHVibGljIG5hbWUgPSAnQ3J5cHRvIFNwcml0ZXMnOwogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2wgPSAnQ1JTJzsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFscyA9IDA7IC8vIFNwcml0ZXMgYXJlIG5vbi1mdW5naWJsZSwgaWUuIGNhbid0IGJlIGRpdmlkZWQgaW50byBwaWVjZXMKICAgIAogICAgZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBuYW1lOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzeW1ib2woKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3ltYm9sOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYWxsUHVyY2hhc2VkU3ByaXRlcy5sZW5ndGg7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZiAoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gbnVtYmVyT2ZTcHJpdGVzT3duZWRCeVVzZXJbX293bmVyXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3duZXJPZiAodWludCBfdG9rZW5JZCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKXsKICAgICAgICByZXR1cm4gYnJvdWdodFNwcml0ZXNbX3Rva2VuSWRdLm93bmVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhcHByb3ZlIChhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUgKGJyb3VnaHRTcHJpdGVzW190b2tlbklkXS5vd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICBhbGxvd2VkIFttc2cuc2VuZGVyXVtfdG9dLnB1c2goX3Rva2VuSWQpOwogICAgICAgIEFwcHJvdmFsIChtc2cuc2VuZGVyLCBfdG8sIF90b2tlbklkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXIgKGFkZHJlc3MgX3RvLCB1aW50IF90b2tlbklkKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSAoYnJvdWdodFNwcml0ZXNbX3Rva2VuSWRdLm93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIGJyb3VnaHRTcHJpdGVzW190b2tlbklkXS5vd25lciA9IF90bzsKICAgICAgICBudW1iZXJPZlNwcml0ZXNPd25lZEJ5VXNlclttc2cuc2VuZGVyXS0tOwogICAgICAgIG51bWJlck9mU3ByaXRlc093bmVkQnlVc2VyW190b10rKzsKICAgICAgICBzcHJpdGVPd25pbmdIaXN0b3J5W190b10ucHVzaChfdG9rZW5JZCk7CiAgICAgICAgVHJhbnNmZXIgKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSAoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHsKICAgICAgICAvLyBUaGlzIGFycmF5IHNob3VsZG4ndCBiZSBiaWcgYXQgYWxsIChpZiBpdCdzIGV2ZW4gbW9yZSB0aGFuIDEgaXRlbSkgdW5sZXNzIHNvbWVvbmUgb3ducyBhIGh1Z2UgbnVtYmVyIG9mIFNwcml0ZXMgYW5kIGhhcyBjYWxsZWQgYXBwcm92ZSgpIG9uIGVhY2ggb2YgdGhlaXIgU3ByaXRlcyB0byBhbGxvdyBhIGNlcnRhaW4gYWRkcmVzcyB0byB0cmFuc2ZlciBlYWNoIG9uZSBvZiB0aGVtCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdW2ldID09IF90b2tlbklkKSB7CiAgICAgICAgICAgICAgICByZXF1aXJlIChicm91Z2h0U3ByaXRlc1tfdG9rZW5JZF0ub3duZXIgPT0gX2Zyb20pOwogICAgICAgICAgICAgICAgbnVtYmVyT2ZTcHJpdGVzT3duZWRCeVVzZXJbYnJvdWdodFNwcml0ZXNbX3Rva2VuSWRdLm93bmVyXS0tOwogICAgICAgICAgICAgICAgbnVtYmVyT2ZTcHJpdGVzT3duZWRCeVVzZXJbX3RvXSsrOwogICAgICAgICAgICAgICAgc3ByaXRlT3duaW5nSGlzdG9yeVtfdG9dLnB1c2goX3Rva2VuSWQpOwogICAgICAgICAgICAgICAgYnJvdWdodFNwcml0ZXNbX3Rva2VuSWRdLm93bmVyID0gX3RvOwogICAgICAgICAgICAgICAgVHJhbnNmZXIgKGJyb3VnaHRTcHJpdGVzW190b2tlbklkXS5vd25lciwgX3RvLCBfdG9rZW5JZCk7CiAgICAgICAgICAgIH0gCiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UgKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXS5sZW5ndGg7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlIChieXRlczQgX2ludGVyZmFjZUlEKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKCiAgICAgICAgcmV0dXJuICgoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUpIHx8IChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSkpOwogICAgfQogICAgCn0='.
	

]
