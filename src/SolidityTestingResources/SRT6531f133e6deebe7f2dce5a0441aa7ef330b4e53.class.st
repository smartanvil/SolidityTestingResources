Class {
	#name : #SRT6531f133e6deebe7f2dce5a0441aa7ef330b4e53,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6531f133e6deebe7f2dce5a0441aa7ef330b4e53 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuNDsKCmNvbnRyYWN0IE93bmVkIHsKICAgIGFkZHJlc3MgcHVibGljIGNvbnRyYWN0T3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBwZW5kaW5nQ29udHJhY3RPd25lcjsKCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBjb250cmFjdE93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q29udHJhY3RPd25lcigpIHsKICAgICAgICBpZiAoY29udHJhY3RPd25lciA9PSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUHJlcGFyZXMgb3duZXJzaGlwIHBhc3MuCiAgICAgKgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGN1cnJlbnQgb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF90byBhZGRyZXNzIG9mIHRoZSBuZXh0IG93bmVyLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJhY3RPd25lcnNoaXAoYWRkcmVzcyBfdG8pIG9ubHlDb250cmFjdE93bmVyKCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgcGVuZGluZ0NvbnRyYWN0T3duZXIgPSBfdG87CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5hbGl6ZSBvd25lcnNoaXAgcGFzcy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgcGVuZGluZyBvd25lci4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsYWltQ29udHJhY3RPd25lcnNoaXAoKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAocGVuZGluZ0NvbnRyYWN0T3duZXIgIT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGNvbnRyYWN0T3duZXIgPSBwZW5kaW5nQ29udHJhY3RPd25lcjsKICAgICAgICBkZWxldGUgcGVuZGluZ0NvbnRyYWN0T3duZXI7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCgpjb250cmFjdCBFbWl0dGVyIHsKICAgIGZ1bmN0aW9uIGVtaXRUcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSwgc3RyaW5nIF9yZWZlcmVuY2UpOwogICAgZnVuY3Rpb24gZW1pdElzc3VlKGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUsIGFkZHJlc3MgX2J5KTsKICAgIGZ1bmN0aW9uIGVtaXRSZXZva2UoYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSwgYWRkcmVzcyBfYnkpOwogICAgZnVuY3Rpb24gZW1pdE93bmVyc2hpcENoYW5nZShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgYnl0ZXMzMiBfc3ltYm9sKTsKICAgIGZ1bmN0aW9uIGVtaXRBcHByb3ZlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3NwZW5kZXIsIGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUpOwogICAgZnVuY3Rpb24gZW1pdFJlY292ZXJ5KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCBhZGRyZXNzIF9ieSk7CiAgICBmdW5jdGlvbiBlbWl0RXJyb3IoYnl0ZXMzMiBfbWVzc2FnZSk7Cn0KCmNvbnRyYWN0IFByb3h5IHsKICAgIGZ1bmN0aW9uIGVtaXRUcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpOwogICAgZnVuY3Rpb24gZW1pdEFwcHJvdmUoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpOwp9CgovKioKICogQHRpdGxlIENocm9ub0JhbmsgUGxhdGZvcm0uCiAqCiAqIFRoZSBvZmZpY2lhbCBDaHJvbm9CYW5rIGFzc2V0cyBwbGF0Zm9ybSBwb3dlcmluZyBUSU1FIGFuZCBMSFQgdG9rZW5zLCBhbmQgcG9zc2libHkKICogb3RoZXIgdW5rbm93biB0b2tlbnMgbmVlZGVkIGxhdGVyLgogKiBQbGF0Zm9ybSB1c2VzIEV2ZW50c0hpc3RvcnkgY29udHJhY3QgdG8ga2VlcCBldmVudHMsIHNvIHRoYXQgaW4gY2FzZSBpdCBuZWVkcyB0byBiZSByZWRlcGxveWVkCiAqIGF0IHNvbWUgcG9pbnQsIGFsbCB0aGUgZXZlbnRzIGtlZXAgYXBwZWFyaW5nIGF0IHRoZSBzYW1lIHBsYWNlLgogKgogKiBFdmVyeSBhc3NldCBpcyBtZWFudCB0byBiZSB1c2VkIHRocm91Z2ggYSBwcm94eSBjb250cmFjdC4gT25seSBvbmUgcHJveHkgY29udHJhY3QgaGF2ZSBhY2Nlc3MKICogcmlnaHRzIGZvciBhIHBhcnRpY3VsYXIgYXNzZXQuCiAqCiAqIEZlYXR1cmVzOiB0cmFuc2ZlcnMsIGFsbG93YW5jZXMsIHN1cHBseSBhZGp1c3RtZW50cywgbG9zdCB3YWxsZXQgYWNjZXNzIHJlY292ZXJ5LgogKgogKiBOb3RlOiBhbGwgdGhlIG5vbiBjb25zdGFudCBmdW5jdGlvbnMgcmV0dXJuIGZhbHNlIGluc3RlYWQgb2YgdGhyb3dpbmcgaW4gY2FzZSBpZiBzdGF0ZSBjaGFuZ2UKICogZGlkbid0IGhhcHBlbiB5ZXQuCiAqLwpjb250cmFjdCBDaHJvbm9CYW5rUGxhdGZvcm0gaXMgT3duZWQgewogICAgLy8gU3RydWN0dXJlIG9mIGEgcGFydGljdWxhciBhc3NldC4KICAgIHN0cnVjdCBBc3NldCB7CiAgICAgICAgdWludCBvd25lcjsgICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc2V0J3Mgb3duZXIgaWQuCiAgICAgICAgdWludCB0b3RhbFN1cHBseTsgICAgICAgICAgICAgICAgIC8vIEFzc2V0J3MgdG90YWwgc3VwcGx5LgogICAgICAgIHN0cmluZyBuYW1lOyAgICAgICAgICAgICAgICAgICAgICAvLyBBc3NldCdzIG5hbWUsIGZvciBpbmZvcm1hdGlvbiBwdXJwb3Nlcy4KICAgICAgICBzdHJpbmcgZGVzY3JpcHRpb247ICAgICAgICAgICAgICAgLy8gQXNzZXQncyBkZXNjcmlwdGlvbiwgZm9yIGluZm9ybWF0aW9uIHB1cnBvc2VzLgogICAgICAgIGJvb2wgaXNSZWlzc3VhYmxlOyAgICAgICAgICAgICAgICAvLyBJbmRpY2F0ZXMgaWYgYXNzZXQgaGF2ZSBkeW5hbWljIG9mIGZpeGVkIHN1cHBseS4KICAgICAgICB1aW50OCBiYXNlVW5pdDsgICAgICAgICAgICAgICAgICAgLy8gUHJvcG9zZWQgbnVtYmVyIG9mIGRlY2ltYWxzLgogICAgICAgIG1hcHBpbmcodWludCA9PiBXYWxsZXQpIHdhbGxldHM7ICAvLyBIb2xkZXJzIHdhbGxldHMuCiAgICB9CgogICAgLy8gU3RydWN0dXJlIG9mIGFuIGFzc2V0IGhvbGRlciB3YWxsZXQgZm9yIHBhcnRpY3VsYXIgYXNzZXQuCiAgICBzdHJ1Y3QgV2FsbGV0IHsKICAgICAgICB1aW50IGJhbGFuY2U7CiAgICAgICAgbWFwcGluZyh1aW50ID0+IHVpbnQpIGFsbG93YW5jZTsKICAgIH0KCiAgICAvLyBTdHJ1Y3R1cmUgb2YgYW4gYXNzZXQgaG9sZGVyLgogICAgc3RydWN0IEhvbGRlciB7CiAgICAgICAgYWRkcmVzcyBhZGRyOyAgICAgICAgICAgICAgICAgICAgLy8gQ3VycmVudCBhZGRyZXNzIG9mIHRoZSBob2xkZXIuCiAgICAgICAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHRydXN0OyAgLy8gQWRkcmVzc2VzIHRoYXQgYXJlIHRydXN0ZWQgd2l0aCByZWNvdmVyeSBwcm9vY2VkdXJlLgogICAgfQoKICAgIC8vIEl0ZXJhYmxlIG1hcHBpbmcgcGF0dGVybiBpcyB1c2VkIGZvciBob2xkZXJzLgogICAgdWludCBwdWJsaWMgaG9sZGVyc0NvdW50OwogICAgbWFwcGluZyh1aW50ID0+IEhvbGRlcikgcHVibGljIGhvbGRlcnM7CgogICAgLy8gVGhpcyBpcyBhbiBhY2Nlc3MgYWRkcmVzcyBtYXBwaW5nLiBNYW55IGFkZHJlc3NlcyBtYXkgaGF2ZSBhY2Nlc3MgdG8gYSBzaW5nbGUgaG9sZGVyLgogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGhvbGRlckluZGV4OwoKICAgIC8vIEFzc2V0IHN5bWJvbCB0byBhc3NldCBtYXBwaW5nLgogICAgbWFwcGluZyhieXRlczMyID0+IEFzc2V0KSBwdWJsaWMgYXNzZXRzOwoKICAgIC8vIEFzc2V0IHN5bWJvbCB0byBhc3NldCBwcm94eSBtYXBwaW5nLgogICAgbWFwcGluZyhieXRlczMyID0+IGFkZHJlc3MpIHB1YmxpYyBwcm94aWVzOwoKICAgIC8vIFNob3VsZCB1c2UgaW50ZXJmYWNlIG9mIHRoZSBlbWl0dGVyLCBidXQgYWRkcmVzcyBvZiBldmVudHMgaGlzdG9yeS4KICAgIEVtaXR0ZXIgcHVibGljIGV2ZW50c0hpc3Rvcnk7CgogICAgLyoqCiAgICAgKiBFbWl0cyBFcnJvciBldmVudCB3aXRoIHNwZWNpZmllZCBlcnJvciBtZXNzYWdlLgogICAgICoKICAgICAqIFNob3VsZCBvbmx5IGJlIHVzZWQgaWYgbm8gc3RhdGUgY2hhbmdlcyBoYXBwZW5lZC4KICAgICAqCiAgICAgKiBAcGFyYW0gX21lc3NhZ2UgZXJyb3IgbWVzc2FnZS4KICAgICAqLwogICAgZnVuY3Rpb24gX2Vycm9yKGJ5dGVzMzIgX21lc3NhZ2UpIGludGVybmFsIHsKICAgICAgICBldmVudHNIaXN0b3J5LmVtaXRFcnJvcihfbWVzc2FnZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIEV2ZW50c0hzdG9yeSBjb250cmFjdCBhZGRyZXNzLgogICAgICoKICAgICAqIENhbiBiZSBzZXQgb25seSBvbmNlLCBhbmQgb25seSBieSBjb250cmFjdCBvd25lci4KICAgICAqCiAgICAgKiBAcGFyYW0gX2V2ZW50c0hpc3RvcnkgRXZlbnRzSGlzdG9yeSBjb250cmFjdCBhZGRyZXNzLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gc2V0dXBFdmVudHNIaXN0b3J5KGFkZHJlc3MgX2V2ZW50c0hpc3RvcnkpIG9ubHlDb250cmFjdE93bmVyKCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYgKGFkZHJlc3MoZXZlbnRzSGlzdG9yeSkgIT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGV2ZW50c0hpc3RvcnkgPSBFbWl0dGVyKF9ldmVudHNIaXN0b3J5KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEVtaXRzIEVycm9yIGlmIGNhbGxlZCBub3QgYnkgYXNzZXQgb3duZXIuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlPd25lcihieXRlczMyIF9zeW1ib2wpIHsKICAgICAgICBpZiAoaXNPd25lcihtc2cuc2VuZGVyLCBfc3ltYm9sKSkgewogICAgICAgICAgICBfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9lcnJvcigiT25seSBvd25lcjogYWNjZXNzIGRlbmllZCIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEVtaXRzIEVycm9yIGlmIGNhbGxlZCBub3QgYnkgYXNzZXQgcHJveHkuCiAgICAgKi8KICAgIG1vZGlmaWVyIG9ubHlQcm94eShieXRlczMyIF9zeW1ib2wpIHsKICAgICAgICBpZiAocHJveGllc1tfc3ltYm9sXSA9PSBtc2cuc2VuZGVyKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2Vycm9yKCJPbmx5IHByb3h5OiBhY2Nlc3MgZGVuaWVkIik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRW1pdHMgRXJyb3IgaWYgX2Zyb20gZG9lc24ndCB0cnVzdCBfdG8uCiAgICAgKi8KICAgIG1vZGlmaWVyIGNoZWNrVHJ1c3QoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8pIHsKICAgICAgICBpZiAoaXNUcnVzdGVkKF9mcm9tLCBfdG8pKSB7CiAgICAgICAgICAgIF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2Vycm9yKCJPbmx5IHRydXN0ZWQ6IGFjY2VzcyBkZW5pZWQiKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBhc3NldCBleGlzdGFuY2UuCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gYXNzZXQgZXhpc3RhbmNlLgogICAgICovCiAgICBmdW5jdGlvbiBpc0NyZWF0ZWQoYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLm93bmVyICE9IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGRlY2ltYWxzLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IGRlY2ltYWxzLgogICAgICovCiAgICBmdW5jdGlvbiBiYXNlVW5pdChieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnModWludDgpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLmJhc2VVbml0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBuYW1lLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IG5hbWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5hbWUoYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKHN0cmluZykgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0ubmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgZGVzY3JpcHRpb24uCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gYXNzZXQgZGVzY3JpcHRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlc2NyaXB0aW9uKGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLmRlc2NyaXB0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCByZWlzc3VhYmlsaXR5LgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IHJlaXNzdWFiaWxpdHkuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzUmVpc3N1YWJsZShieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBhc3NldHNbX3N5bWJvbF0uaXNSZWlzc3VhYmxlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBvd25lciBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IG93bmVyIGFkZHJlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG93bmVyKGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGhvbGRlcnNbYXNzZXRzW19zeW1ib2xdLm93bmVyXS5hZGRyOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgc3BlY2lmaWVkIGFkZHJlc3MgaGFzIGFzc2V0IG93bmVyIHJpZ2h0cy4KICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBvd25lciByaWdodHMgYXZhaWxhYmlsaXR5LgogICAgICovCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX293bmVyLCBieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBpc0NyZWF0ZWQoX3N5bWJvbCkgJiYgKGFzc2V0c1tfc3ltYm9sXS5vd25lciA9PSBnZXRIb2xkZXJJZChfb3duZXIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgdG90YWwgc3VwcGx5LgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IHRvdGFsIHN1cHBseS4KICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoYnl0ZXMzMiBfc3ltYm9sKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW19zeW1ib2xdLnRvdGFsU3VwcGx5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBiYWxhbmNlIGZvciBhIHBhcnRpY3VsYXIgaG9sZGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfaG9sZGVyIGhvbGRlciBhZGRyZXNzLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIGJhbGFuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9ob2xkZXIsIGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9iYWxhbmNlT2YoZ2V0SG9sZGVySWQoX2hvbGRlciksIF9zeW1ib2wpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBiYWxhbmNlIGZvciBhIHBhcnRpY3VsYXIgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEBwYXJhbSBfaG9sZGVySWQgaG9sZGVyIGlkLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIGJhbGFuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9iYWxhbmNlT2YodWludCBfaG9sZGVySWQsIGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19ob2xkZXJJZF0uYmFsYW5jZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgY3VycmVudCBhZGRyZXNzIGZvciBhIHBhcnRpY3VsYXIgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEBwYXJhbSBfaG9sZGVySWQgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIGFkZHJlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF9hZGRyZXNzKHVpbnQgX2hvbGRlcklkKSBjb25zdGFudCByZXR1cm5zKGFkZHJlc3MpIHsKICAgICAgICByZXR1cm4gaG9sZGVyc1tfaG9sZGVySWRdLmFkZHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIFByb3h5IGNvbnRyYWN0IGFkZHJlc3MgZm9yIGEgcGFydGljdWxhciBhc3NldC4KICAgICAqCiAgICAgKiBDYW4gYmUgc2V0IG9ubHkgb25jZSBmb3IgZWFjaCBhc3NldCwgYW5kIG9ubHkgYnkgY29udHJhY3Qgb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9hZGRyZXNzIFByb3h5IGNvbnRyYWN0IGFkZHJlc3MuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBzZXRQcm94eShhZGRyZXNzIF9hZGRyZXNzLCBieXRlczMyIF9zeW1ib2wpIG9ubHlDb250cmFjdE93bmVyKCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYgKHByb3hpZXNbX3N5bWJvbF0gIT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcHJveGllc1tfc3ltYm9sXSA9IF9hZGRyZXNzOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmZXJzIGFzc2V0IGJhbGFuY2UgYmV0d2VlbiBob2xkZXJzIHdhbGxldHMuCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tSWQgaG9sZGVyIGlkIHRvIHRha2UgZnJvbS4KICAgICAqIEBwYXJhbSBfdG9JZCBob2xkZXIgaWQgdG8gZ2l2ZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIHRyYW5zZmVyLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICovCiAgICBmdW5jdGlvbiBfdHJhbnNmZXJEaXJlY3QodWludCBfZnJvbUlkLCB1aW50IF90b0lkLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sKSBpbnRlcm5hbCB7CiAgICAgICAgYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX2Zyb21JZF0uYmFsYW5jZSAtPSBfdmFsdWU7CiAgICAgICAgYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX3RvSWRdLmJhbGFuY2UgKz0gX3ZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmZXJzIGFzc2V0IGJhbGFuY2UgYmV0d2VlbiBob2xkZXJzIHdhbGxldHMuCiAgICAgKgogICAgICogUGVyZm9ybXMgc2FuaXR5IGNoZWNrcyBhbmQgdGFrZXMgY2FyZSBvZiBhbGxvd2FuY2VzIGFkanVzdG1lbnQuCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tSWQgaG9sZGVyIGlkIHRvIHRha2UgZnJvbS4KICAgICAqIEBwYXJhbSBfdG9JZCBob2xkZXIgaWQgdG8gZ2l2ZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIHRyYW5zZmVyLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF9yZWZlcmVuY2UgdHJhbnNmZXIgY29tbWVudCB0byBiZSBpbmNsdWRlZCBpbiBhIFRyYW5zZmVyIGV2ZW50LgogICAgICogQHBhcmFtIF9zZW5kZXJJZCB0cmFuc2ZlciBpbml0aWF0b3IgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gX3RyYW5zZmVyKHVpbnQgX2Zyb21JZCwgdWludCBfdG9JZCwgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3N5bWJvbCwgc3RyaW5nIF9yZWZlcmVuY2UsIHVpbnQgX3NlbmRlcklkKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICAvLyBTaG91bGQgbm90IGFsbG93IHRvIHNlbmQgdG8gb25lc2VsZi4KICAgICAgICBpZiAoX2Zyb21JZCA9PSBfdG9JZCkgewogICAgICAgICAgICBfZXJyb3IoIkNhbm5vdCBzZW5kIHRvIG9uZXNlbGYiKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgaGF2ZSBwb3NpdGl2ZSB2YWx1ZS4KICAgICAgICBpZiAoX3ZhbHVlID09IDApIHsKICAgICAgICAgICAgX2Vycm9yKCJDYW5ub3Qgc2VuZCAwIHZhbHVlIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgZW5vdWdoIGJhbGFuY2UuCiAgICAgICAgaWYgKF9iYWxhbmNlT2YoX2Zyb21JZCwgX3N5bWJvbCkgPCBfdmFsdWUpIHsKICAgICAgICAgICAgX2Vycm9yKCJJbnN1ZmZpY2llbnQgYmFsYW5jZSIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIFNob3VsZCBoYXZlIGVub3VnaCBhbGxvd2FuY2UuCiAgICAgICAgaWYgKF9mcm9tSWQgIT0gX3NlbmRlcklkICYmIF9hbGxvd2FuY2UoX2Zyb21JZCwgX3NlbmRlcklkLCBfc3ltYm9sKSA8IF92YWx1ZSkgewogICAgICAgICAgICBfZXJyb3IoIk5vdCBlbm91Z2ggYWxsb3dhbmNlIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgX3RyYW5zZmVyRGlyZWN0KF9mcm9tSWQsIF90b0lkLCBfdmFsdWUsIF9zeW1ib2wpOwogICAgICAgIC8vIEFkanVzdCBhbGxvd2FuY2UuCiAgICAgICAgaWYgKF9mcm9tSWQgIT0gX3NlbmRlcklkKSB7CiAgICAgICAgICAgIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19mcm9tSWRdLmFsbG93YW5jZVtfc2VuZGVySWRdIC09IF92YWx1ZTsKICAgICAgICB9CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBldmVudHNIaXN0b3J5LmVtaXRUcmFuc2ZlcihfYWRkcmVzcyhfZnJvbUlkKSwgX2FkZHJlc3MoX3RvSWQpLCBfc3ltYm9sLCBfdmFsdWUsIF9yZWZlcmVuY2UpOwogICAgICAgIF9wcm94eVRyYW5zZmVyRXZlbnQoX2Zyb21JZCwgX3RvSWQsIF92YWx1ZSwgX3N5bWJvbCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYXNzZXQgYmFsYW5jZSBiZXR3ZWVuIGhvbGRlcnMgd2FsbGV0cy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXNzZXQgcHJveHkuCiAgICAgKgogICAgICogQHBhcmFtIF90byBob2xkZXIgYWRkcmVzcyB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKiBAcGFyYW0gX3JlZmVyZW5jZSB0cmFuc2ZlciBjb21tZW50IHRvIGJlIGluY2x1ZGVkIGluIGEgVHJhbnNmZXIgZXZlbnQuCiAgICAgKiBAcGFyYW0gX3NlbmRlciB0cmFuc2ZlciBpbml0aWF0b3IgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3h5VHJhbnNmZXJXaXRoUmVmZXJlbmNlKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCBzdHJpbmcgX3JlZmVyZW5jZSwgYWRkcmVzcyBfc2VuZGVyKSBvbmx5UHJveHkoX3N5bWJvbCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIF90cmFuc2ZlcihnZXRIb2xkZXJJZChfc2VuZGVyKSwgX2NyZWF0ZUhvbGRlcklkKF90byksIF92YWx1ZSwgX3N5bWJvbCwgX3JlZmVyZW5jZSwgZ2V0SG9sZGVySWQoX3NlbmRlcikpOwogICAgfQoKICAgIC8qKgogICAgICogQXNrIGFzc2V0IFByb3h5IGNvbnRyYWN0IHRvIGVtaXQgRVJDMjAgY29tcGxpYW50IFRyYW5zZmVyIGV2ZW50LgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbUlkIGhvbGRlciBpZCB0byB0YWtlIGZyb20uCiAgICAgKiBAcGFyYW0gX3RvSWQgaG9sZGVyIGlkIHRvIGdpdmUgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqLwogICAgZnVuY3Rpb24gX3Byb3h5VHJhbnNmZXJFdmVudCh1aW50IF9mcm9tSWQsIHVpbnQgX3RvSWQsIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zeW1ib2wpIGludGVybmFsIHsKICAgICAgICBpZiAocHJveGllc1tfc3ltYm9sXSAhPSAweDApIHsKICAgICAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgICAgICBQcm94eShwcm94aWVzW19zeW1ib2xdKS5lbWl0VHJhbnNmZXIoX2FkZHJlc3MoX2Zyb21JZCksIF9hZGRyZXNzKF90b0lkKSwgX3ZhbHVlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGhvbGRlciBpZCBmb3IgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBfaG9sZGVyIGhvbGRlciBhZGRyZXNzLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIGlkLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRIb2xkZXJJZChhZGRyZXNzIF9ob2xkZXIpIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBob2xkZXJJbmRleFtfaG9sZGVyXTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgaG9sZGVyIGlkIGZvciB0aGUgc3BlY2lmaWVkIGFkZHJlc3MsIGNyZWF0ZXMgaXQgaWYgbmVlZGVkLgogICAgICoKICAgICAqIEBwYXJhbSBfaG9sZGVyIGhvbGRlciBhZGRyZXNzLgogICAgICoKICAgICAqIEByZXR1cm4gaG9sZGVyIGlkLgogICAgICovCiAgICBmdW5jdGlvbiBfY3JlYXRlSG9sZGVySWQoYWRkcmVzcyBfaG9sZGVyKSBpbnRlcm5hbCByZXR1cm5zKHVpbnQpIHsKICAgICAgICB1aW50IGhvbGRlcklkID0gaG9sZGVySW5kZXhbX2hvbGRlcl07CiAgICAgICAgaWYgKGhvbGRlcklkID09IDApIHsKICAgICAgICAgICAgaG9sZGVySWQgPSArK2hvbGRlcnNDb3VudDsKICAgICAgICAgICAgaG9sZGVyc1tob2xkZXJJZF0uYWRkciA9IF9ob2xkZXI7CiAgICAgICAgICAgIGhvbGRlckluZGV4W19ob2xkZXJdID0gaG9sZGVySWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBob2xkZXJJZDsKICAgIH0KCiAgICAvKioKICAgICAqIElzc3VlcyBuZXcgYXNzZXQgdG9rZW4gb24gdGhlIHBsYXRmb3JtLgogICAgICoKICAgICAqIFRva2VucyBpc3N1ZWQgd2l0aCB0aGlzIGNhbGwgZ28gc3RyYWlnaHQgdG8gY29udHJhY3Qgb3duZXIuCiAgICAgKiBFYWNoIHN5bWJvbCBjYW4gYmUgaXNzdWVkIG9ubHkgb25jZSwgYW5kIG9ubHkgYnkgY29udHJhY3Qgb3duZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIHRvIGlzc3VlIGltbWVkaWF0ZWx5LgogICAgICogQHBhcmFtIF9uYW1lIG5hbWUgb2YgdGhlIGFzc2V0LgogICAgICogQHBhcmFtIF9kZXNjcmlwdGlvbiBkZXNjcmlwdGlvbiBmb3IgdGhlIGFzc2V0LgogICAgICogQHBhcmFtIF9iYXNlVW5pdCBudW1iZXIgb2YgZGVjaW1hbHMuCiAgICAgKiBAcGFyYW0gX2lzUmVpc3N1YWJsZSBkeW5hbWljIG9yIGZpeGVkIHN1cHBseS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzc3VlQXNzZXQoYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF92YWx1ZSwgc3RyaW5nIF9uYW1lLCBzdHJpbmcgX2Rlc2NyaXB0aW9uLCB1aW50OCBfYmFzZVVuaXQsIGJvb2wgX2lzUmVpc3N1YWJsZSkgb25seUNvbnRyYWN0T3duZXIoKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICAvLyBTaG91bGQgaGF2ZSBwb3NpdGl2ZSB2YWx1ZSBpZiBzdXBwbHkgaXMgZ29pbmcgdG8gYmUgZml4ZWQuCiAgICAgICAgaWYgKF92YWx1ZSA9PSAwICYmICFfaXNSZWlzc3VhYmxlKSB7CiAgICAgICAgICAgIF9lcnJvcigiQ2Fubm90IGlzc3VlIDAgdmFsdWUgZml4ZWQgYXNzZXQiKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBTaG91bGQgbm90IGJlIGlzc3VlZCB5ZXQuCiAgICAgICAgaWYgKGlzQ3JlYXRlZChfc3ltYm9sKSkgewogICAgICAgICAgICBfZXJyb3IoIkFzc2V0IGFscmVhZHkgaXNzdWVkIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdWludCBob2xkZXJJZCA9IF9jcmVhdGVIb2xkZXJJZChtc2cuc2VuZGVyKTsKCiAgICAgICAgYXNzZXRzW19zeW1ib2xdID0gQXNzZXQoaG9sZGVySWQsIF92YWx1ZSwgX25hbWUsIF9kZXNjcmlwdGlvbiwgX2lzUmVpc3N1YWJsZSwgX2Jhc2VVbml0KTsKICAgICAgICBhc3NldHNbX3N5bWJvbF0ud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZSA9IF92YWx1ZTsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIGV2ZW50c0hpc3RvcnkuZW1pdElzc3VlKF9zeW1ib2wsIF92YWx1ZSwgX2FkZHJlc3MoaG9sZGVySWQpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIElzc3VlcyBhZGRpdGlvbmFsIGFzc2V0IHRva2VucyBpZiB0aGUgYXNzZXQgaGF2ZSBkeW5hbWljIHN1cHBseS4KICAgICAqCiAgICAgKiBUb2tlbnMgaXNzdWVkIHdpdGggdGhpcyBjYWxsIGdvIHN0cmFpZ2h0IHRvIGFzc2V0IG93bmVyLgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGFzc2V0IG93bmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IG9mIGFkZGl0aW9uYWwgdG9rZW5zIHRvIGlzc3VlLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gcmVpc3N1ZUFzc2V0KGJ5dGVzMzIgX3N5bWJvbCwgdWludCBfdmFsdWUpIG9ubHlPd25lcihfc3ltYm9sKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICAvLyBTaG91bGQgaGF2ZSBwb3NpdGl2ZSB2YWx1ZS4KICAgICAgICBpZiAoX3ZhbHVlID09IDApIHsKICAgICAgICAgICAgX2Vycm9yKCJDYW5ub3QgcmVpc3N1ZSAwIHZhbHVlIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgQXNzZXQgYXNzZXQgPSBhc3NldHNbX3N5bWJvbF07CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgZHluYW1pYyBzdXBwbHkuCiAgICAgICAgaWYgKCFhc3NldC5pc1JlaXNzdWFibGUpIHsKICAgICAgICAgICAgX2Vycm9yKCJDYW5ub3QgcmVpc3N1ZSBmaXhlZCBhc3NldCIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIFJlc3VsdGluZyB0b3RhbCBzdXBwbHkgc2hvdWxkIG5vdCBvdmVyZmxvdy4KICAgICAgICBpZiAoYXNzZXQudG90YWxTdXBwbHkgKyBfdmFsdWUgPCBhc3NldC50b3RhbFN1cHBseSkgewogICAgICAgICAgICBfZXJyb3IoIlRvdGFsIHN1cHBseSBvdmVyZmxvdyIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHVpbnQgaG9sZGVySWQgPSBnZXRIb2xkZXJJZChtc2cuc2VuZGVyKTsKICAgICAgICBhc3NldC53YWxsZXRzW2hvbGRlcklkXS5iYWxhbmNlICs9IF92YWx1ZTsKICAgICAgICBhc3NldC50b3RhbFN1cHBseSArPSBfdmFsdWU7CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBldmVudHNIaXN0b3J5LmVtaXRJc3N1ZShfc3ltYm9sLCBfdmFsdWUsIF9hZGRyZXNzKGhvbGRlcklkKSk7CiAgICAgICAgX3Byb3h5VHJhbnNmZXJFdmVudCgwLCBob2xkZXJJZCwgX3ZhbHVlLCBfc3ltYm9sKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIERlc3Ryb3lzIHNwZWNpZmllZCBhbW91bnQgb2Ygc2VuZGVycyBhc3NldCB0b2tlbnMuCiAgICAgKgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzZXQgc3ltYm9sLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgb2YgdG9rZW5zIHRvIGRlc3Ryb3kuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiByZXZva2VBc3NldChieXRlczMyIF9zeW1ib2wsIHVpbnQgX3ZhbHVlKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICAvLyBTaG91bGQgaGF2ZSBwb3NpdGl2ZSB2YWx1ZS4KICAgICAgICBpZiAoX3ZhbHVlID09IDApIHsKICAgICAgICAgICAgX2Vycm9yKCJDYW5ub3QgcmV2b2tlIDAgdmFsdWUiKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBBc3NldCBhc3NldCA9IGFzc2V0c1tfc3ltYm9sXTsKICAgICAgICB1aW50IGhvbGRlcklkID0gZ2V0SG9sZGVySWQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gU2hvdWxkIGhhdmUgZW5vdWdoIHRva2Vucy4KICAgICAgICBpZiAoYXNzZXQud2FsbGV0c1tob2xkZXJJZF0uYmFsYW5jZSA8IF92YWx1ZSkgewogICAgICAgICAgICBfZXJyb3IoIk5vdCBlbm91Z2ggdG9rZW5zIHRvIHJldm9rZSIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGFzc2V0LndhbGxldHNbaG9sZGVySWRdLmJhbGFuY2UgLT0gX3ZhbHVlOwogICAgICAgIGFzc2V0LnRvdGFsU3VwcGx5IC09IF92YWx1ZTsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiBuL2EgYWZ0ZXIgSEYgNDsKICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgIGV2ZW50c0hpc3RvcnkuZW1pdFJldm9rZShfc3ltYm9sLCBfdmFsdWUsIF9hZGRyZXNzKGhvbGRlcklkKSk7CiAgICAgICAgX3Byb3h5VHJhbnNmZXJFdmVudChob2xkZXJJZCwgMCwgX3ZhbHVlLCBfc3ltYm9sKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhc3NlcyBhc3NldCBvd25lcnNoaXAgdG8gc3BlY2lmaWVkIGFkZHJlc3MuCiAgICAgKgogICAgICogT25seSBvd25lcnNoaXAgaXMgY2hhbmdlZCwgYmFsYW5jZXMgYXJlIG5vdCB0b3VjaGVkLgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGFzc2V0IG93bmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfbmV3T3duZXIgYWRkcmVzcyB0byBiZWNvbWUgYSBuZXcgb3duZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcnNoaXAoYnl0ZXMzMiBfc3ltYm9sLCBhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyKF9zeW1ib2wpIHJldHVybnMoYm9vbCkgewogICAgICAgIEFzc2V0IGFzc2V0ID0gYXNzZXRzW19zeW1ib2xdOwogICAgICAgIHVpbnQgbmV3T3duZXJJZCA9IF9jcmVhdGVIb2xkZXJJZChfbmV3T3duZXIpOwogICAgICAgIC8vIFNob3VsZCBwYXNzIG93bmVyc2hpcCB0byBhbm90aGVyIGhvbGRlci4KICAgICAgICBpZiAoYXNzZXQub3duZXIgPT0gbmV3T3duZXJJZCkgewogICAgICAgICAgICBfZXJyb3IoIkNhbm5vdCBwYXNzIG93bmVyc2hpcCB0byBvbmVzZWxmIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYWRkcmVzcyBvbGRPd25lciA9IF9hZGRyZXNzKGFzc2V0Lm93bmVyKTsKICAgICAgICBhc3NldC5vd25lciA9IG5ld093bmVySWQ7CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogbi9hIGFmdGVyIEhGIDQ7CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBldmVudHNIaXN0b3J5LmVtaXRPd25lcnNoaXBDaGFuZ2Uob2xkT3duZXIsIF9hZGRyZXNzKG5ld093bmVySWQpLCBfc3ltYm9sKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHNwZWNpZmllZCBob2xkZXIgdHJ1c3RzIGFuIGFkZHJlc3Mgd2l0aCByZWNvdmVyeSBwcm9jZWR1cmUuCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tIHRydXN0ZXIuCiAgICAgKiBAcGFyYW0gX3RvIHRydXN0ZWUuCiAgICAgKgogICAgICogQHJldHVybiB0cnVzdCBleGlzdGFuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzVHJ1c3RlZChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGhvbGRlcnNbZ2V0SG9sZGVySWQoX2Zyb20pXS50cnVzdFtfdG9dOwogICAgfQoKICAgIC8qKgogICAgICogVHJ1c3QgYW4gYWRkcmVzcyB0byBwZXJmb3JtIHJlY292ZXJ5IHByb2NlZHVyZSBmb3IgdGhlIGNhbGxlci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIHRydXN0ZWUuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiB0cnVzdChhZGRyZXNzIF90bykgcmV0dXJucyhib29sKSB7CiAgICAgICAgdWludCBmcm9tSWQgPSBfY3JlYXRlSG9sZGVySWQobXNnLnNlbmRlcik7CiAgICAgICAgLy8gU2hvdWxkIHRydXN0IHRvIGFub3RoZXIgYWRkcmVzcy4KICAgICAgICBpZiAoZnJvbUlkID09IGdldEhvbGRlcklkKF90bykpIHsKICAgICAgICAgICAgX2Vycm9yKCJDYW5ub3QgdHJ1c3QgdG8gb25lc2VsZiIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIFNob3VsZCB0cnVzdCB0byB5ZXQgdW50cnVzdGVkLgogICAgICAgIGlmIChpc1RydXN0ZWQobXNnLnNlbmRlciwgX3RvKSkgewogICAgICAgICAgICBfZXJyb3IoIkFscmVhZHkgdHJ1c3RlZCIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGhvbGRlcnNbZnJvbUlkXS50cnVzdFtfdG9dID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldm9rZSB0cnVzdCB0byBwZXJmb3JtIHJlY292ZXJ5IHByb2NlZHVyZSBmcm9tIGFuIGFkZHJlc3MuCiAgICAgKgogICAgICogQHBhcmFtIF90byB0cnVzdGVlLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gZGlzdHJ1c3QoYWRkcmVzcyBfdG8pIGNoZWNrVHJ1c3QobXNnLnNlbmRlciwgX3RvKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICBob2xkZXJzW2dldEhvbGRlcklkKG1zZy5zZW5kZXIpXS50cnVzdFtfdG9dID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtIHJlY292ZXJ5IHByb2NlZHVyZS4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGxvZ2ljIGlzIGFjdHVhbGx5IG1vcmUgb2YgYW4gYWRkQWNjZXNzKHVpbnQgX2hvbGRlcklkLCBhZGRyZXNzIF90bykuCiAgICAgKiBJdCBncmFudHMgYW5vdGhlciBhZGRyZXNzIGFjY2VzcyB0byByZWNvdmVyeSBzdWJqZWN0IHdhbGxldHMuCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdHJ1c3RlZSBvZiByZWNvdmVyeSBzdWJqZWN0LgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBob2xkZXIgYWRkcmVzcyB0byByZWNvdmVyIGZyb20uCiAgICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgdG8gZ3JhbnQgYWNjZXNzIHRvLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gcmVjb3ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykgY2hlY2tUcnVzdChfZnJvbSwgbXNnLnNlbmRlcikgcmV0dXJucyhib29sKSB7CiAgICAgICAgLy8gU2hvdWxkIHJlY292ZXIgdG8gcHJldmlvdXNseSB1bnVzZWQgYWRkcmVzcy4KICAgICAgICBpZiAoZ2V0SG9sZGVySWQoX3RvKSAhPSAwKSB7CiAgICAgICAgICAgIF9lcnJvcigiU2hvdWxkIHJlY292ZXIgdG8gbmV3IGFkZHJlc3MiKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBXZSB0YWtlIGN1cnJlbnQgaG9sZGVyIGFkZHJlc3MgYmVjYXVzZSBpdCBtaWdodCBub3QgZXF1YWwgX2Zyb20uCiAgICAgICAgLy8gSXQgaXMgcG9zc2libGUgdG8gcmVjb3ZlciBmcm9tIGFueSBvbGQgaG9sZGVyIGFkZHJlc3MsIGJ1dCBldmVudCBzaG91bGQgaGF2ZSB0aGUgY3VycmVudCBvbmUuCiAgICAgICAgYWRkcmVzcyBmcm9tID0gaG9sZGVyc1tnZXRIb2xkZXJJZChfZnJvbSldLmFkZHI7CiAgICAgICAgaG9sZGVyc1tnZXRIb2xkZXJJZChfZnJvbSldLmFkZHIgPSBfdG87CiAgICAgICAgaG9sZGVySW5kZXhbX3RvXSA9IGdldEhvbGRlcklkKF9mcm9tKTsKICAgICAgICAvLyBJbnRlcm5hbCBPdXQgT2YgR2FzL1Rocm93OiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gQ2FsbCBTdGFjayBEZXB0aCBMaW1pdCByZWFjaGVkOiByZXZlcnQgdGhpcyB0cmFuc2FjdGlvbiB0b287CiAgICAgICAgLy8gUmVjdXJzaXZlIENhbGw6IHNhZmUsIGFsbCBjaGFuZ2VzIGFscmVhZHkgbWFkZS4KICAgICAgICBldmVudHNIaXN0b3J5LmVtaXRSZWNvdmVyeShmcm9tLCBfdG8sIG1zZy5zZW5kZXIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogU2V0cyBhc3NldCBzcGVuZGluZyBhbGxvd2FuY2UgZm9yIGEgc3BlY2lmaWVkIHNwZW5kZXIuCiAgICAgKgogICAgICogTm90ZTogdG8gcmV2b2tlIGFsbG93YW5jZSwgb25lIG5lZWRzIHRvIHNldCBhbGxvd2FuY2UgdG8gMC4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXJJZCBob2xkZXIgaWQgdG8gc2V0IGFsbG93YW5jZSBmb3IuCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byBhbGxvdy4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfc2VuZGVySWQgYXBwcm92ZSBpbml0aWF0b3IgaG9sZGVyIGlkLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludCBfc3BlbmRlcklkLCB1aW50IF92YWx1ZSwgYnl0ZXMzMiBfc3ltYm9sLCB1aW50IF9zZW5kZXJJZCkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgLy8gQXNzZXQgc2hvdWxkIGV4aXN0LgogICAgICAgIGlmICghaXNDcmVhdGVkKF9zeW1ib2wpKSB7CiAgICAgICAgICAgIF9lcnJvcigiQXNzZXQgaXMgbm90IGlzc3VlZCIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIFNob3VsZCBhbGxvdyB0byBhbm90aGVyIGhvbGRlci4KICAgICAgICBpZiAoX3NlbmRlcklkID09IF9zcGVuZGVySWQpIHsKICAgICAgICAgICAgX2Vycm9yKCJDYW5ub3QgYXBwcm92ZSB0byBvbmVzZWxmIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYXNzZXRzW19zeW1ib2xdLndhbGxldHNbX3NlbmRlcklkXS5hbGxvd2FuY2VbX3NwZW5kZXJJZF0gPSBfdmFsdWU7CiAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIENhbGwgU3RhY2sgRGVwdGggTGltaXQgcmVhY2hlZDogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgIC8vIFJlY3Vyc2l2ZSBDYWxsOiBzYWZlLCBhbGwgY2hhbmdlcyBhbHJlYWR5IG1hZGUuCiAgICAgICAgZXZlbnRzSGlzdG9yeS5lbWl0QXBwcm92ZShfYWRkcmVzcyhfc2VuZGVySWQpLCBfYWRkcmVzcyhfc3BlbmRlcklkKSwgX3N5bWJvbCwgX3ZhbHVlKTsKICAgICAgICBpZiAocHJveGllc1tfc3ltYm9sXSAhPSAweDApIHsKICAgICAgICAgICAgLy8gSW50ZXJuYWwgT3V0IE9mIEdhcy9UaHJvdzogcmV2ZXJ0IHRoaXMgdHJhbnNhY3Rpb24gdG9vOwogICAgICAgICAgICAvLyBDYWxsIFN0YWNrIERlcHRoIExpbWl0IHJlYWNoZWQ6IG4vYSBhZnRlciBIRiA0OwogICAgICAgICAgICAvLyBSZWN1cnNpdmUgQ2FsbDogc2FmZSwgYWxsIGNoYW5nZXMgYWxyZWFkeSBtYWRlLgogICAgICAgICAgICBQcm94eShwcm94aWVzW19zeW1ib2xdKS5lbWl0QXBwcm92ZShfYWRkcmVzcyhfc2VuZGVySWQpLCBfYWRkcmVzcyhfc3BlbmRlcklkKSwgX3ZhbHVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIGFzc2V0IHNwZW5kaW5nIGFsbG93YW5jZSBmb3IgYSBzcGVjaWZpZWQgc3BlbmRlci4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXNzZXQgcHJveHkuCiAgICAgKgogICAgICogQHBhcmFtIF9zcGVuZGVyIGhvbGRlciBhZGRyZXNzIHRvIHNldCBhbGxvd2FuY2UgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byBhbGxvdy4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqIEBwYXJhbSBfc2VuZGVyIGFwcHJvdmUgaW5pdGlhdG9yIGFkZHJlc3MuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBwcm94eUFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUsIGJ5dGVzMzIgX3N5bWJvbCwgYWRkcmVzcyBfc2VuZGVyKSBvbmx5UHJveHkoX3N5bWJvbCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIF9hcHByb3ZlKF9jcmVhdGVIb2xkZXJJZChfc3BlbmRlciksIF92YWx1ZSwgX3N5bWJvbCwgX2NyZWF0ZUhvbGRlcklkKF9zZW5kZXIpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgYWxsb3dhbmNlIGZyb20gb25lIGhvbGRlciB0byBhbm90aGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBob2xkZXIgdGhhdCBhbGxvd2VkIHNwZW5kaW5nLgogICAgICogQHBhcmFtIF9zcGVuZGVyIGhvbGRlciB0aGF0IGlzIGFsbG93ZWQgdG8gc3BlbmQuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKgogICAgICogQHJldHVybiBob2xkZXIgdG8gc3BlbmRlciBhbGxvd2FuY2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF9zcGVuZGVyLCBieXRlczMyIF9zeW1ib2wpIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBfYWxsb3dhbmNlKGdldEhvbGRlcklkKF9mcm9tKSwgZ2V0SG9sZGVySWQoX3NwZW5kZXIpLCBfc3ltYm9sKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYXNzZXQgYWxsb3dhbmNlIGZyb20gb25lIGhvbGRlciB0byBhbm90aGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbUlkIGhvbGRlciBpZCB0aGF0IGFsbG93ZWQgc3BlbmRpbmcuCiAgICAgKiBAcGFyYW0gX3RvSWQgaG9sZGVyIGlkIHRoYXQgaXMgYWxsb3dlZCB0byBzcGVuZC4KICAgICAqIEBwYXJhbSBfc3ltYm9sIGFzc2V0IHN5bWJvbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhvbGRlciB0byBzcGVuZGVyIGFsbG93YW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gX2FsbG93YW5jZSh1aW50IF9mcm9tSWQsIHVpbnQgX3RvSWQsIGJ5dGVzMzIgX3N5bWJvbCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfc3ltYm9sXS53YWxsZXRzW19mcm9tSWRdLmFsbG93YW5jZVtfdG9JZF07CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmZvcm1zIGFsbG93YW5jZSB0cmFuc2ZlciBvZiBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycyB3YWxsZXRzLgogICAgICoKICAgICAqIENhbiBvbmx5IGJlIGNhbGxlZCBieSBhc3NldCBwcm94eS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gaG9sZGVyIGFkZHJlc3MgdG8gdGFrZSBmcm9tLgogICAgICogQHBhcmFtIF90byBob2xkZXIgYWRkcmVzcyB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gX3N5bWJvbCBhc3NldCBzeW1ib2wuCiAgICAgKiBAcGFyYW0gX3JlZmVyZW5jZSB0cmFuc2ZlciBjb21tZW50IHRvIGJlIGluY2x1ZGVkIGluIGEgVHJhbnNmZXIgZXZlbnQuCiAgICAgKiBAcGFyYW0gX3NlbmRlciBhbGxvd2FuY2UgdHJhbnNmZXIgaW5pdGlhdG9yIGFkZHJlc3MuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBwcm94eVRyYW5zZmVyRnJvbVdpdGhSZWZlcmVuY2UoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlczMyIF9zeW1ib2wsIHN0cmluZyBfcmVmZXJlbmNlLCBhZGRyZXNzIF9zZW5kZXIpIG9ubHlQcm94eShfc3ltYm9sKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gX3RyYW5zZmVyKGdldEhvbGRlcklkKF9mcm9tKSwgX2NyZWF0ZUhvbGRlcklkKF90byksIF92YWx1ZSwgX3N5bWJvbCwgX3JlZmVyZW5jZSwgZ2V0SG9sZGVySWQoX3NlbmRlcikpOwogICAgfQp9Cgpjb250cmFjdCBDaHJvbm9CYW5rQXNzZXQgewogICAgZnVuY3Rpb24gX190cmFuc2ZlcldpdGhSZWZlcmVuY2UoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBzdHJpbmcgX3JlZmVyZW5jZSwgYWRkcmVzcyBfc2VuZGVyKSByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gX190cmFuc2ZlckZyb21XaXRoUmVmZXJlbmNlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgc3RyaW5nIF9yZWZlcmVuY2UsIGFkZHJlc3MgX3NlbmRlcikgcmV0dXJucyhib29sKTsKICAgIGZ1bmN0aW9uIF9fYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSwgYWRkcmVzcyBfc2VuZGVyKSByZXR1cm5zKGJvb2wpOwogICAgZnVuY3Rpb24gX19wcm9jZXNzKGJ5dGVzIF9kYXRhLCBhZGRyZXNzIF9zZW5kZXIpIHBheWFibGUgewogICAgICAgIHRocm93OwogICAgfQp9Cgpjb250cmFjdCBFUkMyMCB7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CgogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHN1cHBseSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpOwp9Cgpjb250cmFjdCBDaHJvbm9CYW5rQXNzZXRQcm94eSBpcyBFUkMyMCB7CiAgICAvLyBBc3NpZ25lZCBwbGF0Zm9ybSwgaW1tdXRhYmxlLgogICAgQ2hyb25vQmFua1BsYXRmb3JtIHB1YmxpYyBjaHJvbm9CYW5rUGxhdGZvcm07CgogICAgLy8gQXNzaWduZWQgc3ltYm9sLCBpbW11dGFibGUuCiAgICBieXRlczMyIHNtYmw7CgogICAgLy8gQXNzaWduZWQgbmFtZSwgaW1tdXRhYmxlLgogICAgc3RyaW5nIHB1YmxpYyBuYW1lOwoKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOwoKICAgIC8qKgogICAgICogU2V0cyBwbGF0Zm9ybSBhZGRyZXNzLCBhc3NpZ25zIHN5bWJvbCBhbmQgbmFtZS4KICAgICAqCiAgICAgKiBDYW4gYmUgc2V0IG9ubHkgb25jZS4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Nocm9ub0JhbmtQbGF0Zm9ybSBwbGF0Zm9ybSBjb250cmFjdCBhZGRyZXNzLgogICAgICogQHBhcmFtIF9zeW1ib2wgYXNzaWduZWQgc3ltYm9sLgogICAgICogQHBhcmFtIF9uYW1lIGFzc2lnbmVkIG5hbWUuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBpbml0KENocm9ub0JhbmtQbGF0Zm9ybSBfY2hyb25vQmFua1BsYXRmb3JtLCBzdHJpbmcgX3N5bWJvbCwgc3RyaW5nIF9uYW1lKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAoYWRkcmVzcyhjaHJvbm9CYW5rUGxhdGZvcm0pICE9IDB4MCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGNocm9ub0JhbmtQbGF0Zm9ybSA9IF9jaHJvbm9CYW5rUGxhdGZvcm07CiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsKICAgICAgICBzbWJsID0gc3RyaW5nVG9CeXRlczMyKF9zeW1ib2wpOwogICAgICAgIG5hbWUgPSBfbmFtZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCmZ1bmN0aW9uIHN0cmluZ1RvQnl0ZXMzMihzdHJpbmcgbWVtb3J5IHNvdXJjZSkgcmV0dXJucyAoYnl0ZXMzMiByZXN1bHQpIHsKICAgIGFzc2VtYmx5IHsKICAgICAgICByZXN1bHQgOj0gbWxvYWQoYWRkKHNvdXJjZSwgMzIpKQogICAgfQp9CgogICAgLyoqCiAgICAgKiBPbmx5IHBsYXRmb3JtIGlzIGFsbG93ZWQgdG8gY2FsbC4KICAgICAqLwogICAgbW9kaWZpZXIgb25seUNocm9ub0JhbmtQbGF0Zm9ybSgpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBhZGRyZXNzKGNocm9ub0JhbmtQbGF0Zm9ybSkpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBPbmx5IGN1cnJlbnQgYXNzZXQgb3duZXIgaXMgYWxsb3dlZCB0byBjYWxsLgogICAgICovCiAgICBtb2RpZmllciBvbmx5QXNzZXRPd25lcigpIHsKICAgICAgICBpZiAoY2hyb25vQmFua1BsYXRmb3JtLmlzT3duZXIobXNnLnNlbmRlciwgc21ibCkpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGZvciBjdXJyZW50IGNhbGxlci4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0LgogICAgICovCiAgICBmdW5jdGlvbiBfZ2V0QXNzZXQoKSBpbnRlcm5hbCByZXR1cm5zKENocm9ub0JhbmtBc3NldCkgewogICAgICAgIHJldHVybiBDaHJvbm9CYW5rQXNzZXQoZ2V0VmVyc2lvbkZvcihtc2cuc2VuZGVyKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IHRvdGFsIHN1cHBseS4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IHRvdGFsIHN1cHBseS4KICAgICAqLwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gY2hyb25vQmFua1BsYXRmb3JtLnRvdGFsU3VwcGx5KHNtYmwpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBiYWxhbmNlIGZvciBhIHBhcnRpY3VsYXIgaG9sZGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfb3duZXIgaG9sZGVyIGFkZHJlc3MuCiAgICAgKgogICAgICogQHJldHVybiBob2xkZXIgYmFsYW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBjb25zdGFudCByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gY2hyb25vQmFua1BsYXRmb3JtLmJhbGFuY2VPZihfb3duZXIsIHNtYmwpOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhc3NldCBhbGxvd2FuY2UgZnJvbSBvbmUgaG9sZGVyIHRvIGFub3RoZXIuCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tIGhvbGRlciB0aGF0IGFsbG93ZWQgc3BlbmRpbmcuCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgaG9sZGVyIHRoYXQgaXMgYWxsb3dlZCB0byBzcGVuZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhvbGRlciB0byBzcGVuZGVyIGFsbG93YW5jZS4KICAgICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnModWludCkgewogICAgICAgIHJldHVybiBjaHJvbm9CYW5rUGxhdGZvcm0uYWxsb3dhbmNlKF9mcm9tLCBfc3BlbmRlciwgc21ibCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGRlY2ltYWxzLgogICAgICoKICAgICAqIEByZXR1cm4gYXNzZXQgZGVjaW1hbHMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlY2ltYWxzKCkgY29uc3RhbnQgcmV0dXJucyh1aW50OCkgewogICAgICAgIHJldHVybiBjaHJvbm9CYW5rUGxhdGZvcm0uYmFzZVVuaXQoc21ibCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2ZlcnMgYXNzZXQgYmFsYW5jZSBmcm9tIHRoZSBjYWxsZXIgdG8gc3BlY2lmaWVkIHJlY2VpdmVyLgogICAgICoKICAgICAqIEBwYXJhbSBfdG8gaG9sZGVyIGFkZHJlc3MgdG8gZ2l2ZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIHRyYW5zZmVyLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gX3RyYW5zZmVyV2l0aFJlZmVyZW5jZShfdG8sIF92YWx1ZSwgIiIpOwogICAgfQoKICAgIC8qKgogICAgICogVHJhbnNmZXJzIGFzc2V0IGJhbGFuY2UgZnJvbSB0aGUgY2FsbGVyIHRvIHNwZWNpZmllZCByZWNlaXZlciBhZGRpbmcgc3BlY2lmaWVkIGNvbW1lbnQuCiAgICAgKgogICAgICogQHBhcmFtIF90byBob2xkZXIgYWRkcmVzcyB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKiBAcGFyYW0gX3JlZmVyZW5jZSB0cmFuc2ZlciBjb21tZW50IHRvIGJlIGluY2x1ZGVkIGluIGEgcGxhdGZvcm0ncyBUcmFuc2ZlciBldmVudC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyV2l0aFJlZmVyZW5jZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHN0cmluZyBfcmVmZXJlbmNlKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gX3RyYW5zZmVyV2l0aFJlZmVyZW5jZShfdG8sIF92YWx1ZSwgX3JlZmVyZW5jZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXNvbHZlcyBhc3NldCBpbXBsZW1lbnRhdGlvbiBjb250cmFjdCBmb3IgdGhlIGNhbGxlciBhbmQgZm9yd2FyZHMgdGhlcmUgYXJndW1lbnRzIGFsb25nIHdpdGgKICAgICAqIHRoZSBjYWxsZXIgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIF90cmFuc2ZlcldpdGhSZWZlcmVuY2UoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBzdHJpbmcgX3JlZmVyZW5jZSkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIF9nZXRBc3NldCgpLl9fdHJhbnNmZXJXaXRoUmVmZXJlbmNlKF90bywgX3ZhbHVlLCBfcmVmZXJlbmNlLCBtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm1zIHRyYW5zZmVyIGNhbGwgb24gdGhlIHBsYXRmb3JtIGJ5IHRoZSBuYW1lIG9mIHNwZWNpZmllZCBzZW5kZXIuCiAgICAgKgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGFzc2lnbmVkIHRvIHNlbmRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIGhvbGRlciBhZGRyZXNzIHRvIGdpdmUgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSBfcmVmZXJlbmNlIHRyYW5zZmVyIGNvbW1lbnQgdG8gYmUgaW5jbHVkZWQgaW4gYSBwbGF0Zm9ybSdzIFRyYW5zZmVyIGV2ZW50LgogICAgICogQHBhcmFtIF9zZW5kZXIgaW5pdGlhbCBjYWxsZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBfX3RyYW5zZmVyV2l0aFJlZmVyZW5jZShhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHN0cmluZyBfcmVmZXJlbmNlLCBhZGRyZXNzIF9zZW5kZXIpIG9ubHlBY2Nlc3MoX3NlbmRlcikgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIGNocm9ub0JhbmtQbGF0Zm9ybS5wcm94eVRyYW5zZmVyV2l0aFJlZmVyZW5jZShfdG8sIF92YWx1ZSwgc21ibCwgX3JlZmVyZW5jZSwgX3NlbmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmZvcm1zIGFsbG93YW5jZSB0cmFuc2ZlciBvZiBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycy4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Zyb20gaG9sZGVyIGFkZHJlc3MgdG8gdGFrZSBmcm9tLgogICAgICogQHBhcmFtIF90byBob2xkZXIgYWRkcmVzcyB0byBnaXZlIHRvLgogICAgICogQHBhcmFtIF92YWx1ZSBhbW91bnQgdG8gdHJhbnNmZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gX3RyYW5zZmVyRnJvbVdpdGhSZWZlcmVuY2UoX2Zyb20sIF90bywgX3ZhbHVlLCAiIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmZvcm1zIGFsbG93YW5jZSB0cmFuc2ZlciBvZiBhc3NldCBiYWxhbmNlIGJldHdlZW4gaG9sZGVycyBhZGRpbmcgc3BlY2lmaWVkIGNvbW1lbnQuCiAgICAgKgogICAgICogQHBhcmFtIF9mcm9tIGhvbGRlciBhZGRyZXNzIHRvIHRha2UgZnJvbS4KICAgICAqIEBwYXJhbSBfdG8gaG9sZGVyIGFkZHJlc3MgdG8gZ2l2ZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIHRyYW5zZmVyLgogICAgICogQHBhcmFtIF9yZWZlcmVuY2UgdHJhbnNmZXIgY29tbWVudCB0byBiZSBpbmNsdWRlZCBpbiBhIHBsYXRmb3JtJ3MgVHJhbnNmZXIgZXZlbnQuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb21XaXRoUmVmZXJlbmNlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgc3RyaW5nIF9yZWZlcmVuY2UpIHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBfdHJhbnNmZXJGcm9tV2l0aFJlZmVyZW5jZShfZnJvbSwgX3RvLCBfdmFsdWUsIF9yZWZlcmVuY2UpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZXMgYXNzZXQgaW1wbGVtZW50YXRpb24gY29udHJhY3QgZm9yIHRoZSBjYWxsZXIgYW5kIGZvcndhcmRzIHRoZXJlIGFyZ3VtZW50cyBhbG9uZyB3aXRoCiAgICAgKiB0aGUgY2FsbGVyIGFkZHJlc3MuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBfdHJhbnNmZXJGcm9tV2l0aFJlZmVyZW5jZShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIHN0cmluZyBfcmVmZXJlbmNlKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gX2dldEFzc2V0KCkuX190cmFuc2ZlckZyb21XaXRoUmVmZXJlbmNlKF9mcm9tLCBfdG8sIF92YWx1ZSwgX3JlZmVyZW5jZSwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhbGxvd2FuY2UgdHJhbnNmZXIgY2FsbCBvbiB0aGUgcGxhdGZvcm0gYnkgdGhlIG5hbWUgb2Ygc3BlY2lmaWVkIHNlbmRlci4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgYXNzZXQgaW1wbGVtZW50YXRpb24gY29udHJhY3QgYXNzaWduZWQgdG8gc2VuZGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBob2xkZXIgYWRkcmVzcyB0byB0YWtlIGZyb20uCiAgICAgKiBAcGFyYW0gX3RvIGhvbGRlciBhZGRyZXNzIHRvIGdpdmUgdG8uCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCB0byB0cmFuc2Zlci4KICAgICAqIEBwYXJhbSBfcmVmZXJlbmNlIHRyYW5zZmVyIGNvbW1lbnQgdG8gYmUgaW5jbHVkZWQgaW4gYSBwbGF0Zm9ybSdzIFRyYW5zZmVyIGV2ZW50LgogICAgICogQHBhcmFtIF9zZW5kZXIgaW5pdGlhbCBjYWxsZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBfX3RyYW5zZmVyRnJvbVdpdGhSZWZlcmVuY2UoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBzdHJpbmcgX3JlZmVyZW5jZSwgYWRkcmVzcyBfc2VuZGVyKSBvbmx5QWNjZXNzKF9zZW5kZXIpIHJldHVybnMoYm9vbCkgewogICAgICAgIHJldHVybiBjaHJvbm9CYW5rUGxhdGZvcm0ucHJveHlUcmFuc2ZlckZyb21XaXRoUmVmZXJlbmNlKF9mcm9tLCBfdG8sIF92YWx1ZSwgc21ibCwgX3JlZmVyZW5jZSwgX3NlbmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIGFzc2V0IHNwZW5kaW5nIGFsbG93YW5jZSBmb3IgYSBzcGVjaWZpZWQgc3BlbmRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgaG9sZGVyIGFkZHJlc3MgdG8gc2V0IGFsbG93YW5jZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIGFsbG93LgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIF9hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzb2x2ZXMgYXNzZXQgaW1wbGVtZW50YXRpb24gY29udHJhY3QgZm9yIHRoZSBjYWxsZXIgYW5kIGZvcndhcmRzIHRoZXJlIGFyZ3VtZW50cyBhbG9uZyB3aXRoCiAgICAgKiB0aGUgY2FsbGVyIGFkZHJlc3MuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBfYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyhib29sKSB7CiAgICAgICAgcmV0dXJuIF9nZXRBc3NldCgpLl9fYXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlLCBtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm1zIGFsbG93YW5jZSBzZXR0aW5nIGNhbGwgb24gdGhlIHBsYXRmb3JtIGJ5IHRoZSBuYW1lIG9mIHNwZWNpZmllZCBzZW5kZXIuCiAgICAgKgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGFzc2lnbmVkIHRvIHNlbmRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgaG9sZGVyIGFkZHJlc3MgdG8gc2V0IGFsbG93YW5jZSB0by4KICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IHRvIGFsbG93LgogICAgICogQHBhcmFtIF9zZW5kZXIgaW5pdGlhbCBjYWxsZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdWNjZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBfX2FwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUsIGFkZHJlc3MgX3NlbmRlcikgb25seUFjY2Vzcyhfc2VuZGVyKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICByZXR1cm4gY2hyb25vQmFua1BsYXRmb3JtLnByb3h5QXBwcm92ZShfc3BlbmRlciwgX3ZhbHVlLCBzbWJsLCBfc2VuZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVtaXRzIEVSQzIwIFRyYW5zZmVyIGV2ZW50IG9uIHRoaXMgY29udHJhY3QuCiAgICAgKgogICAgICogQ2FuIG9ubHkgYmUsIGFuZCwgY2FsbGVkIGJ5IGFzc2lnbmVkIHBsYXRmb3JtIHdoZW4gYXNzZXQgdHJhbnNmZXIgaGFwcGVucy4KICAgICAqLwogICAgZnVuY3Rpb24gZW1pdFRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSkgb25seUNocm9ub0JhbmtQbGF0Zm9ybSgpIHsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogRW1pdHMgRVJDMjAgQXBwcm92YWwgZXZlbnQgb24gdGhpcyBjb250cmFjdC4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSwgYW5kLCBjYWxsZWQgYnkgYXNzaWduZWQgcGxhdGZvcm0gd2hlbiBhc3NldCBhbGxvd2FuY2Ugc2V0IGhhcHBlbnMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVtaXRBcHByb3ZlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3ZhbHVlKSBvbmx5Q2hyb25vQmFua1BsYXRmb3JtKCkgewogICAgICAgIEFwcHJvdmFsKF9mcm9tLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlc29sdmVzIGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGZvciB0aGUgY2FsbGVyIGFuZCBmb3J3YXJkcyB0aGVyZSB0cmFuc2FjdGlvbiBkYXRhLAogICAgICogYWxvbmcgd2l0aCB0aGUgdmFsdWUuIFRoaXMgYWxsb3dzIGZvciBwcm94eSBpbnRlcmZhY2UgZ3Jvd3RoLgogICAgICovCiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgICAgICBfZ2V0QXNzZXQoKS5fX3Byb2Nlc3MudmFsdWUobXNnLnZhbHVlKShtc2cuZGF0YSwgbXNnLnNlbmRlcik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgYW4gdXBncmFkZSBmcmVlemUtdGltZSBzdGFydCwgYW5kIHRoZSBuZXh0IGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0LgogICAgICovCiAgICBldmVudCBVcGdyYWRlUHJvcG9zYWwoYWRkcmVzcyBuZXdWZXJzaW9uKTsKCiAgICAvLyBDdXJyZW50IGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGFkZHJlc3MuCiAgICBhZGRyZXNzIGxhdGVzdFZlcnNpb247CgogICAgLy8gUHJvcG9zZWQgbmV4dCBhc3NldCBpbXBsZW1lbnRhdGlvbiBjb250cmFjdCBhZGRyZXNzLgogICAgYWRkcmVzcyBwZW5kaW5nVmVyc2lvbjsKCiAgICAvLyBVcGdyYWRlIGZyZWV6ZS10aW1lIHN0YXJ0LgogICAgdWludCBwZW5kaW5nVmVyc2lvblRpbWVzdGFtcDsKCiAgICAvLyBUaW1lc3BhbiBmb3IgdXNlcnMgdG8gcmV2aWV3IHRoZSBuZXcgaW1wbGVtZW50YXRpb24gYW5kIG1ha2UgZGVjaXNpb24uCiAgICB1aW50IGNvbnN0YW50IFVQR1JBREVfRlJFRVpFX1RJTUUgPSAzIGRheXM7CgogICAgLy8gQXNzZXQgaW1wbGVtZW50YXRpb24gY29udHJhY3QgYWRkcmVzcyB0aGF0IHVzZXIgZGVjaWRlZCB0byBzdGljayB3aXRoLgogICAgLy8gMHgwIG1lYW5zIHRoYXQgdXNlciB1c2VzIGxhdGVzdCB2ZXJzaW9uLgogICAgbWFwcGluZyhhZGRyZXNzID0+IGFkZHJlc3MpIHVzZXJPcHRPdXRWZXJzaW9uOwoKICAgIC8qKgogICAgICogT25seSBhc3NldCBpbXBsZW1lbnRhdGlvbiBjb250cmFjdCBhc3NpZ25lZCB0byBzZW5kZXIgaXMgYWxsb3dlZCB0byBjYWxsLgogICAgICovCiAgICBtb2RpZmllciBvbmx5QWNjZXNzKGFkZHJlc3MgX3NlbmRlcikgewogICAgICAgIGlmIChnZXRWZXJzaW9uRm9yKF9zZW5kZXIpID09IG1zZy5zZW5kZXIpIHsKICAgICAgICAgICAgXzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGFkZHJlc3MgYXNzaWduZWQgdG8gc2VuZGVyLgogICAgICoKICAgICAqIEBwYXJhbSBfc2VuZGVyIHNlbmRlciBhZGRyZXNzLgogICAgICoKICAgICAqIEByZXR1cm4gYXNzZXQgaW1wbGVtZW50YXRpb24gY29udHJhY3QgYWRkcmVzcy4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0VmVyc2lvbkZvcihhZGRyZXNzIF9zZW5kZXIpIGNvbnN0YW50IHJldHVybnMoYWRkcmVzcykgewogICAgICAgIHJldHVybiB1c2VyT3B0T3V0VmVyc2lvbltfc2VuZGVyXSA9PSAwID8gbGF0ZXN0VmVyc2lvbiA6IHVzZXJPcHRPdXRWZXJzaW9uW19zZW5kZXJdOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBjdXJyZW50IGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGFkZHJlc3MuCiAgICAgKgogICAgICogQHJldHVybiBhc3NldCBpbXBsZW1lbnRhdGlvbiBjb250cmFjdCBhZGRyZXNzLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRMYXRlc3RWZXJzaW9uKCkgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIGxhdGVzdFZlcnNpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHByb3Bvc2VkIG5leHQgYXNzZXQgaW1wbGVtZW50YXRpb24gY29udHJhY3QgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGFkZHJlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFBlbmRpbmdWZXJzaW9uKCkgY29uc3RhbnQgcmV0dXJucyhhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIHBlbmRpbmdWZXJzaW9uOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB1cGdyYWRlIGZyZWV6ZS10aW1lIHN0YXJ0LgogICAgICoKICAgICAqIEByZXR1cm4gZnJlZXplLXRpbWUgc3RhcnQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFBlbmRpbmdWZXJzaW9uVGltZXN0YW1wKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBlbmRpbmdWZXJzaW9uVGltZXN0YW1wOwogICAgfQoKICAgIC8qKgogICAgICogUHJvcG9zZSBuZXh0IGFzc2V0IGltcGxlbWVudGF0aW9uIGNvbnRyYWN0IGFkZHJlc3MuCiAgICAgKgogICAgICogQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IGN1cnJlbnQgYXNzZXQgb3duZXIuCiAgICAgKgogICAgICogTm90ZTogZnJlZXplLXRpbWUgc2hvdWxkIG5vdCBiZSBhcHBsaWVkIGZvciB0aGUgaW5pdGlhbCBzZXR1cC4KICAgICAqCiAgICAgKiBAcGFyYW0gX25ld1ZlcnNpb24gYXNzZXQgaW1wbGVtZW50YXRpb24gY29udHJhY3QgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHByb3Bvc2VVcGdyYWRlKGFkZHJlc3MgX25ld1ZlcnNpb24pIG9ubHlBc3NldE93bmVyKCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgLy8gU2hvdWxkIG5vdCBhbHJlYWR5IGJlIGluIHRoZSB1cGdyYWRpbmcgcHJvY2Vzcy4KICAgICAgICBpZiAocGVuZGluZ1ZlcnNpb24gIT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gTmV3IHZlcnNpb24gYWRkcmVzcyBzaG91bGQgYmUgb3RoZXIgdGhhbiAweDAuCiAgICAgICAgaWYgKF9uZXdWZXJzaW9uID09IDB4MCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vIERvbid0IGFwcGx5IGZyZWV6ZS10aW1lIGZvciB0aGUgaW5pdGlhbCBzZXR1cC4KICAgICAgICBpZiAobGF0ZXN0VmVyc2lvbiA9PSAweDApIHsKICAgICAgICAgICAgbGF0ZXN0VmVyc2lvbiA9IF9uZXdWZXJzaW9uOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcGVuZGluZ1ZlcnNpb24gPSBfbmV3VmVyc2lvbjsKICAgICAgICBwZW5kaW5nVmVyc2lvblRpbWVzdGFtcCA9IG5vdzsKICAgICAgICBVcGdyYWRlUHJvcG9zYWwoX25ld1ZlcnNpb24pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQ2FuY2VsIHRoZSBwZW5kaW5nIHVwZ3JhZGUgcHJvY2Vzcy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYnkgY3VycmVudCBhc3NldCBvd25lci4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHB1cmdlVXBncmFkZSgpIG9ubHlBc3NldE93bmVyKCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYgKHBlbmRpbmdWZXJzaW9uID09IDB4MCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSBwZW5kaW5nVmVyc2lvbjsKICAgICAgICBkZWxldGUgcGVuZGluZ1ZlcnNpb25UaW1lc3RhbXA7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5hbGl6ZSBhbiB1cGdyYWRlIHByb2Nlc3Mgc2V0dGluZyBuZXcgYXNzZXQgaW1wbGVtZW50YXRpb24gY29udHJhY3QgYWRkcmVzcy4KICAgICAqCiAgICAgKiBDYW4gb25seSBiZSBjYWxsZWQgYWZ0ZXIgYW4gdXBncmFkZSBmcmVlemUtdGltZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbW1pdFVwZ3JhZGUoKSByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAocGVuZGluZ1ZlcnNpb24gPT0gMHgwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHBlbmRpbmdWZXJzaW9uVGltZXN0YW1wICsgVVBHUkFERV9GUkVFWkVfVElNRSA+IG5vdykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGxhdGVzdFZlcnNpb24gPSBwZW5kaW5nVmVyc2lvbjsKICAgICAgICBkZWxldGUgcGVuZGluZ1ZlcnNpb247CiAgICAgICAgZGVsZXRlIHBlbmRpbmdWZXJzaW9uVGltZXN0YW1wOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogRGlzYWdyZWUgd2l0aCBwcm9wb3NlZCB1cGdyYWRlLCBhbmQgc3RpY2sgd2l0aCBjdXJyZW50IGFzc2V0IGltcGxlbWVudGF0aW9uCiAgICAgKiB1bnRpbCBmdXJ0aGVyIGV4cGxpY2l0IGFncmVlbWVudCB0byB1cGdyYWRlLgogICAgICoKICAgICAqIEByZXR1cm4gc3VjY2Vzcy4KICAgICAqLwogICAgZnVuY3Rpb24gb3B0T3V0KCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgaWYgKHVzZXJPcHRPdXRWZXJzaW9uW21zZy5zZW5kZXJdICE9IDB4MCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHVzZXJPcHRPdXRWZXJzaW9uW21zZy5zZW5kZXJdID0gbGF0ZXN0VmVyc2lvbjsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcGxpY2l0bHkgYWdyZWUgdG8gdXBncmFkZSB0byBjdXJyZW50IGFuZCBmdXR1cmUgYXNzZXQgaW1wbGVtZW50YXRpb24gdXBncmFkZXMsCiAgICAgKiB1bnRpbCBmdXJ0aGVyIGV4cGxpY2l0IGRpc2FncmVlbWVudC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN1Y2Nlc3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG9wdEluKCkgcmV0dXJucyhib29sKSB7CiAgICAgICAgZGVsZXRlIHVzZXJPcHRPdXRWZXJzaW9uW21zZy5zZW5kZXJdOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9'.
	

]
