Class {
	#name : #SRT40ae4acd08e65714b093bf2495fd7941aedfa231,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT40ae4acd08e65714b093bf2495fd7941aedfa231 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgppbnRlcmZhY2UgSUFwcHJvdmFsUmVjaXBpZW50IHsKICAgIC8qKgogICAgICogQG5vdGljZSBTaWduYWxzIHRoYXQgdG9rZW4gaG9sZGVyIGFwcHJvdmVkIHNwZW5kaW5nIG9mIHRva2VucyBhbmQgc29tZSBhY3Rpb24gc2hvdWxkIGJlIHRha2VuLgogICAgICoKICAgICAqIEBwYXJhbSBfc2VuZGVyIHRva2VuIGhvbGRlciB3aGljaCBhcHByb3ZlZCBzcGVuZGluZyBvZiBoaXMgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgYXBwcm92ZWQgdG8gYmUgc3BlbnQKICAgICAqIEBwYXJhbSBfZXh0cmFEYXRhIGFueSBleHRyYSBkYXRhIHRva2VuIGhvbGRlciBwcm92aWRlZCB0byB0aGUgY2FsbAogICAgICoKICAgICAqIEBkZXYgd2FybmluZzogaW1wbGVtZW50b3JzIHNob3VsZCB2YWxpZGF0ZSBzZW5kZXIgb2YgdGhpcyBtZXNzYWdlIChpdCBzaG91bGQgYmUgdGhlIHRva2VuKSBhbmQgbWFrZSBubyBmdXJ0aGVyCiAgICAgKiAgICAgIGFzc3VtcHRpb25zIHVubGVzcyB2YWxpZGF0ZWQgdGhlbSB2aWEgRVJDMjAgbWV0aG9kcy4KICAgICAqLwogICAgZnVuY3Rpb24gcmVjZWl2ZUFwcHJvdmFsKGFkZHJlc3MgX3NlbmRlciwgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9leHRyYURhdGEpIHB1YmxpYzsKfQoKaW50ZXJmYWNlIElLWUNQcm92aWRlciB7CiAgICBmdW5jdGlvbiBpc0tZQ1Bhc3NlZChhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKTsKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKY29udHJhY3QgQXJndW1lbnRzQ2hlY2tlciB7CgogICAgLy8vIEBkZXYgY2hlY2sgd2hpY2ggcHJldmVudHMgc2hvcnQgYWRkcmVzcyBhdHRhY2sKICAgIG1vZGlmaWVyIHBheWxvYWRTaXplSXModWludCBzaXplKSB7CiAgICAgICByZXF1aXJlKG1zZy5kYXRhLmxlbmd0aCA9PSBzaXplICsgNCAvKiBmdW5jdGlvbiBzZWxlY3RvciAqLyk7CiAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IGNoZWNrIHRoYXQgYWRkcmVzcyBpcyB2YWxpZAogICAgbW9kaWZpZXIgdmFsaWRBZGRyZXNzKGFkZHJlc3MgYWRkcikgewogICAgICAgIHJlcXVpcmUoYWRkciAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfOwogICAgfQp9Cgpjb250cmFjdCBtdWx0aW93bmVkIHsKCgkvLyBUWVBFUwoKICAgIC8vIHN0cnVjdCBmb3IgdGhlIHN0YXR1cyBvZiBhIHBlbmRpbmcgb3BlcmF0aW9uLgogICAgc3RydWN0IE11bHRpT3duZWRPcGVyYXRpb25QZW5kaW5nU3RhdGUgewogICAgICAgIC8vIGNvdW50IG9mIGNvbmZpcm1hdGlvbnMgbmVlZGVkCiAgICAgICAgdWludCB5ZXROZWVkZWQ7CgogICAgICAgIC8vIGJpdG1hcCBvZiBjb25maXJtYXRpb25zIHdoZXJlIG93bmVyICNvd25lckluZGV4J3MgZGVjaXNpb24gY29ycmVzcG9uZHMgdG8gMioqb3duZXJJbmRleCBiaXQKICAgICAgICB1aW50IG93bmVyc0RvbmU7CgogICAgICAgIC8vIHBvc2l0aW9uIG9mIHRoaXMgb3BlcmF0aW9uIGtleSBpbiBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgKICAgICAgICB1aW50IGluZGV4OwogICAgfQoKCS8vIEVWRU5UUwoKICAgIGV2ZW50IENvbmZpcm1hdGlvbihhZGRyZXNzIG93bmVyLCBieXRlczMyIG9wZXJhdGlvbik7CiAgICBldmVudCBSZXZva2UoYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwogICAgZXZlbnQgRmluYWxDb25maXJtYXRpb24oYWRkcmVzcyBvd25lciwgYnl0ZXMzMiBvcGVyYXRpb24pOwoKICAgIC8vIHNvbWUgb3RoZXJzIGFyZSBpbiB0aGUgY2FzZSBvZiBhbiBvd25lciBjaGFuZ2luZy4KICAgIGV2ZW50IE93bmVyQ2hhbmdlZChhZGRyZXNzIG9sZE93bmVyLCBhZGRyZXNzIG5ld093bmVyKTsKICAgIGV2ZW50IE93bmVyQWRkZWQoYWRkcmVzcyBuZXdPd25lcik7CiAgICBldmVudCBPd25lclJlbW92ZWQoYWRkcmVzcyBvbGRPd25lcik7CgogICAgLy8gdGhlIGxhc3Qgb25lIGlzIGVtaXR0ZWQgaWYgdGhlIHJlcXVpcmVkIHNpZ25hdHVyZXMgY2hhbmdlCiAgICBldmVudCBSZXF1aXJlbWVudENoYW5nZWQodWludCBuZXdSZXF1aXJlbWVudCk7CgoJLy8gTU9ESUZJRVJTCgogICAgLy8gc2ltcGxlIHNpbmdsZS1zaWcgZnVuY3Rpb24gbW9kaWZpZXIuCiAgICBtb2RpZmllciBvbmx5b3duZXIgewogICAgICAgIHJlcXVpcmUoaXNPd25lcihtc2cuc2VuZGVyKSk7CiAgICAgICAgXzsKICAgIH0KICAgIC8vIG11bHRpLXNpZyBmdW5jdGlvbiBtb2RpZmllcjogdGhlIG9wZXJhdGlvbiBtdXN0IGhhdmUgYW4gaW50cmluc2ljIGhhc2ggaW4gb3JkZXIKICAgIC8vIHRoYXQgbGF0ZXIgYXR0ZW1wdHMgY2FuIGJlIHJlYWxpc2VkIGFzIHRoZSBzYW1lIHVuZGVybHlpbmcgb3BlcmF0aW9uIGFuZAogICAgLy8gdGh1cyBjb3VudCBhcyBjb25maXJtYXRpb25zLgogICAgbW9kaWZpZXIgb25seW1hbnlvd25lcnMoYnl0ZXMzMiBfb3BlcmF0aW9uKSB7CiAgICAgICAgaWYgKGNvbmZpcm1BbmRDaGVjayhfb3BlcmF0aW9uKSkgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgICAgICAvLyBFdmVuIGlmIHJlcXVpcmVkIG51bWJlciBvZiBjb25maXJtYXRpb25zIGhhcyd0IGJlZW4gY29sbGVjdGVkIHlldCwKICAgICAgICAvLyB3ZSBjYW4ndCB0aHJvdyBoZXJlIC0gYmVjYXVzZSBjaGFuZ2VzIHRvIHRoZSBzdGF0ZSBoYXZlIHRvIGJlIHByZXNlcnZlZC4KICAgICAgICAvLyBCdXQsIGNvbmZpcm1BbmRDaGVjayBpdHNlbGYgd2lsbCB0aHJvdyBpbiBjYXNlIHNlbmRlciBpcyBub3QgYW4gb3duZXIuCiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWROdW1Pd25lcnModWludCBfbnVtT3duZXJzKSB7CiAgICAgICAgcmVxdWlyZShfbnVtT3duZXJzID4gMCAmJiBfbnVtT3duZXJzIDw9IGNfbWF4T3duZXJzKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KHVpbnQgX3JlcXVpcmVkLCB1aW50IF9udW1Pd25lcnMpIHsKICAgICAgICByZXF1aXJlKF9yZXF1aXJlZCA+IDAgJiYgX3JlcXVpcmVkIDw9IF9udW1Pd25lcnMpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJFeGlzdHMoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoaXNPd25lcihfYWRkcmVzcykpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb3duZXJEb2VzTm90RXhpc3QoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoIWlzT3duZXIoX2FkZHJlc3MpKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG11bHRpT3duZWRPcGVyYXRpb25Jc0FjdGl2ZShieXRlczMyIF9vcGVyYXRpb24pIHsKICAgICAgICByZXF1aXJlKGlzT3BlcmF0aW9uQWN0aXZlKF9vcGVyYXRpb24pKTsKICAgICAgICBfOwogICAgfQoKCS8vIE1FVEhPRFMKCiAgICAvLyBjb25zdHJ1Y3RvciBpcyBnaXZlbiBudW1iZXIgb2Ygc2lncyByZXF1aXJlZCB0byBkbyBwcm90ZWN0ZWQgIm9ubHltYW55b3duZXJzIiB0cmFuc2FjdGlvbnMKICAgIC8vIGFzIHdlbGwgYXMgdGhlIHNlbGVjdGlvbiBvZiBhZGRyZXNzZXMgY2FwYWJsZSBvZiBjb25maXJtaW5nIHRoZW0gKG1zZy5zZW5kZXIgaXMgbm90IGFkZGVkIHRvIHRoZSBvd25lcnMhKS4KICAgIGZ1bmN0aW9uIG11bHRpb3duZWQoYWRkcmVzc1tdIF9vd25lcnMsIHVpbnQgX3JlcXVpcmVkKQogICAgICAgIHB1YmxpYwogICAgICAgIHZhbGlkTnVtT3duZXJzKF9vd25lcnMubGVuZ3RoKQogICAgICAgIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KF9yZXF1aXJlZCwgX293bmVycy5sZW5ndGgpCiAgICB7CiAgICAgICAgYXNzZXJ0KGNfbWF4T3duZXJzIDw9IDI1NSk7CgogICAgICAgIG1fbnVtT3duZXJzID0gX293bmVycy5sZW5ndGg7CiAgICAgICAgbV9tdWx0aU93bmVkUmVxdWlyZWQgPSBfcmVxdWlyZWQ7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9vd25lcnMubGVuZ3RoOyArK2kpCiAgICAgICAgewogICAgICAgICAgICBhZGRyZXNzIG93bmVyID0gX293bmVyc1tpXTsKICAgICAgICAgICAgLy8gaW52YWxpZCBhbmQgZHVwbGljYXRlIGFkZHJlc3NlcyBhcmUgbm90IGFsbG93ZWQKICAgICAgICAgICAgcmVxdWlyZSgwICE9IG93bmVyICYmICFpc093bmVyKG93bmVyKSAvKiBub3QgaXNPd25lciB5ZXQhICovKTsKCiAgICAgICAgICAgIHVpbnQgY3VycmVudE93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgoaSArIDEgLyogZmlyc3Qgc2xvdCBpcyB1bnVzZWQgKi8pOwogICAgICAgICAgICBtX293bmVyc1tjdXJyZW50T3duZXJJbmRleF0gPSBvd25lcjsKICAgICAgICAgICAgbV9vd25lckluZGV4W293bmVyXSA9IGN1cnJlbnRPd25lckluZGV4OwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIHJlcGxhY2VzIGFuIG93bmVyIGBfZnJvbWAgd2l0aCBhbm90aGVyIGBfdG9gLgogICAgLy8vIEBwYXJhbSBfZnJvbSBhZGRyZXNzIG9mIG93bmVyIHRvIHJlcGxhY2UKICAgIC8vLyBAcGFyYW0gX3RvIGFkZHJlc3Mgb2YgbmV3IG93bmVyCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bykKICAgICAgICBleHRlcm5hbAogICAgICAgIG93bmVyRXhpc3RzKF9mcm9tKQogICAgICAgIG93bmVyRG9lc05vdEV4aXN0KF90bykKICAgICAgICBvbmx5bWFueW93bmVycyhrZWNjYWsyNTYobXNnLmRhdGEpKQogICAgewogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKCiAgICAgICAgY2xlYXJQZW5kaW5nKCk7CiAgICAgICAgdWludCBvd25lckluZGV4ID0gY2hlY2tPd25lckluZGV4KG1fb3duZXJJbmRleFtfZnJvbV0pOwogICAgICAgIG1fb3duZXJzW293bmVySW5kZXhdID0gX3RvOwogICAgICAgIG1fb3duZXJJbmRleFtfZnJvbV0gPSAwOwogICAgICAgIG1fb3duZXJJbmRleFtfdG9dID0gb3duZXJJbmRleDsKCiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwogICAgICAgIE93bmVyQ2hhbmdlZChfZnJvbSwgX3RvKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBhZGRzIGFuIG93bmVyCiAgICAvLy8gQHBhcmFtIF9vd25lciBhZGRyZXNzIG9mIG5ldyBvd25lcgogICAgLy8gQWxsIHBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIGJlIGNhbmNlbGVkIQogICAgZnVuY3Rpb24gYWRkT3duZXIoYWRkcmVzcyBfb3duZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvd25lckRvZXNOb3RFeGlzdChfb3duZXIpCiAgICAgICAgdmFsaWROdW1Pd25lcnMobV9udW1Pd25lcnMgKyAxKQogICAgICAgIG9ubHltYW55b3duZXJzKGtlY2NhazI1Nihtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICBtX251bU93bmVycysrOwogICAgICAgIG1fb3duZXJzW21fbnVtT3duZXJzXSA9IF9vd25lcjsKICAgICAgICBtX293bmVySW5kZXhbX293bmVyXSA9IGNoZWNrT3duZXJJbmRleChtX251bU93bmVycyk7CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgICAgICBPd25lckFkZGVkKF9vd25lcik7CiAgICB9CgogICAgLy8vIEBub3RpY2UgcmVtb3ZlcyBhbiBvd25lcgogICAgLy8vIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBvZiBvd25lciB0byByZW1vdmUKICAgIC8vIEFsbCBwZW5kaW5nIG9wZXJhdGlvbnMgd2lsbCBiZSBjYW5jZWxlZCEKICAgIGZ1bmN0aW9uIHJlbW92ZU93bmVyKGFkZHJlc3MgX293bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb3duZXJFeGlzdHMoX293bmVyKQogICAgICAgIHZhbGlkTnVtT3duZXJzKG1fbnVtT3duZXJzIC0gMSkKICAgICAgICBtdWx0aU93bmVkVmFsaWRSZXF1aXJlbWVudChtX211bHRpT3duZWRSZXF1aXJlZCwgbV9udW1Pd25lcnMgLSAxKQogICAgICAgIG9ubHltYW55b3duZXJzKGtlY2NhazI1Nihtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgYXNzZXJ0T3duZXJzQXJlQ29uc2lzdGVudCgpOwoKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICB1aW50IG93bmVySW5kZXggPSBjaGVja093bmVySW5kZXgobV9vd25lckluZGV4W19vd25lcl0pOwogICAgICAgIG1fb3duZXJzW293bmVySW5kZXhdID0gMDsKICAgICAgICBtX293bmVySW5kZXhbX293bmVyXSA9IDA7CiAgICAgICAgLy9tYWtlIHN1cmUgbV9udW1Pd25lcnMgaXMgZXF1YWwgdG8gdGhlIG51bWJlciBvZiBvd25lcnMgYW5kIGFsd2F5cyBwb2ludHMgdG8gdGhlIGxhc3Qgb3duZXIKICAgICAgICByZW9yZ2FuaXplT3duZXJzKCk7CgogICAgICAgIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKTsKICAgICAgICBPd25lclJlbW92ZWQoX293bmVyKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBjaGFuZ2VzIHRoZSByZXF1aXJlZCBudW1iZXIgb2Ygb3duZXIgc2lnbmF0dXJlcwogICAgLy8vIEBwYXJhbSBfbmV3UmVxdWlyZWQgbmV3IG51bWJlciBvZiBzaWduYXR1cmVzIHJlcXVpcmVkCiAgICAvLyBBbGwgcGVuZGluZyBvcGVyYXRpb25zIHdpbGwgYmUgY2FuY2VsZWQhCiAgICBmdW5jdGlvbiBjaGFuZ2VSZXF1aXJlbWVudCh1aW50IF9uZXdSZXF1aXJlZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG11bHRpT3duZWRWYWxpZFJlcXVpcmVtZW50KF9uZXdSZXF1aXJlZCwgbV9udW1Pd25lcnMpCiAgICAgICAgb25seW1hbnlvd25lcnMoa2VjY2FrMjU2KG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBtX211bHRpT3duZWRSZXF1aXJlZCA9IF9uZXdSZXF1aXJlZDsKICAgICAgICBjbGVhclBlbmRpbmcoKTsKICAgICAgICBSZXF1aXJlbWVudENoYW5nZWQoX25ld1JlcXVpcmVkKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBHZXRzIGFuIG93bmVyIGJ5IDAtaW5kZXhlZCBwb3NpdGlvbgogICAgLy8vIEBwYXJhbSBvd25lckluZGV4IDAtaW5kZXhlZCBvd25lciBwb3NpdGlvbgogICAgZnVuY3Rpb24gZ2V0T3duZXIodWludCBvd25lckluZGV4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBtX293bmVyc1tvd25lckluZGV4ICsgMV07CiAgICB9CgogICAgLy8vIEBub3RpY2UgR2V0cyBvd25lcnMKICAgIC8vLyBAcmV0dXJuIG1lbW9yeSBhcnJheSBvZiBvd25lcnMKICAgIGZ1bmN0aW9uIGdldE93bmVycygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IHJlc3VsdCA9IG5ldyBhZGRyZXNzW10obV9udW1Pd25lcnMpOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1fbnVtT3duZXJzOyBpKyspCiAgICAgICAgICAgIHJlc3VsdFtpXSA9IGdldE93bmVyKGkpOwoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIC8vLyBAbm90aWNlIGNoZWNrcyBpZiBwcm92aWRlZCBhZGRyZXNzIGlzIGFuIG93bmVyIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX2FkZHIgYWRkcmVzcyB0byBjaGVjawogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIGFuIG93bmVyCiAgICBmdW5jdGlvbiBpc093bmVyKGFkZHJlc3MgX2FkZHIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIG1fb3duZXJJbmRleFtfYWRkcl0gPiAwOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRlc3RzIG93bmVyc2hpcCBvZiB0aGUgY3VycmVudCBjYWxsZXIuCiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGl0J3MgYW4gb3duZXIKICAgIC8vIEl0J3MgYWR2aXNhYmxlIHRvIGNhbGwgaXQgYnkgbmV3IG93bmVyIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBzYW1lIGVycm9uZW91cyBhZGRyZXNzIGlzIG5vdCBjb3B5LXBhc3RlZCB0bwogICAgLy8gYWRkT3duZXIvY2hhbmdlT3duZXIgYW5kIHRvIGlzT3duZXIuCiAgICBmdW5jdGlvbiBhbUlPd25lcigpIGV4dGVybmFsIGNvbnN0YW50IG9ubHlvd25lciByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV2b2tlcyBhIHByaW9yIGNvbmZpcm1hdGlvbiBvZiB0aGUgZ2l2ZW4gb3BlcmF0aW9uCiAgICAvLy8gQHBhcmFtIF9vcGVyYXRpb24gb3BlcmF0aW9uIHZhbHVlLCB0eXBpY2FsbHkga2VjY2FrMjU2KG1zZy5kYXRhKQogICAgZnVuY3Rpb24gcmV2b2tlKGJ5dGVzMzIgX29wZXJhdGlvbikKICAgICAgICBleHRlcm5hbAogICAgICAgIG11bHRpT3duZWRPcGVyYXRpb25Jc0FjdGl2ZShfb3BlcmF0aW9uKQogICAgICAgIG9ubHlvd25lcgogICAgewogICAgICAgIHVpbnQgb3duZXJJbmRleEJpdCA9IG1ha2VPd25lckJpdG1hcEJpdChtc2cuc2VuZGVyKTsKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CiAgICAgICAgcmVxdWlyZShwZW5kaW5nLm93bmVyc0RvbmUgJiBvd25lckluZGV4Qml0ID4gMCk7CgogICAgICAgIGFzc2VydE9wZXJhdGlvbklzQ29uc2lzdGVudChfb3BlcmF0aW9uKTsKCiAgICAgICAgcGVuZGluZy55ZXROZWVkZWQrKzsKICAgICAgICBwZW5kaW5nLm93bmVyc0RvbmUgLT0gb3duZXJJbmRleEJpdDsKCiAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwogICAgICAgIFJldm9rZShtc2cuc2VuZGVyLCBfb3BlcmF0aW9uKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVja3MgaWYgb3duZXIgY29uZmlybWVkIGdpdmVuIG9wZXJhdGlvbgogICAgLy8vIEBwYXJhbSBfb3BlcmF0aW9uIG9wZXJhdGlvbiB2YWx1ZSwgdHlwaWNhbGx5IGtlY2NhazI1Nihtc2cuZGF0YSkKICAgIC8vLyBAcGFyYW0gX293bmVyIGFuIG93bmVyIGFkZHJlc3MKICAgIGZ1bmN0aW9uIGhhc0NvbmZpcm1lZChieXRlczMyIF9vcGVyYXRpb24sIGFkZHJlc3MgX293bmVyKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgY29uc3RhbnQKICAgICAgICBtdWx0aU93bmVkT3BlcmF0aW9uSXNBY3RpdmUoX29wZXJhdGlvbikKICAgICAgICBvd25lckV4aXN0cyhfb3duZXIpCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gIShtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLm93bmVyc0RvbmUgJiBtYWtlT3duZXJCaXRtYXBCaXQoX293bmVyKSA9PSAwKTsKICAgIH0KCiAgICAvLyBJTlRFUk5BTCBNRVRIT0RTCgogICAgZnVuY3Rpb24gY29uZmlybUFuZENoZWNrKGJ5dGVzMzIgX29wZXJhdGlvbikKICAgICAgICBwcml2YXRlCiAgICAgICAgb25seW93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAoNTEyID09IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGgpCiAgICAgICAgICAgIC8vIEluIGNhc2UgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4IGdyb3dzIHRvbyBtdWNoIHdlIGhhdmUgdG8gc2hyaW5rIGl0OiBvdGhlcndpc2UgYXQgc29tZSBwb2ludAogICAgICAgICAgICAvLyB3ZSB3b24ndCBiZSBhYmxlIHRvIGRvIGl0IGJlY2F1c2Ugb2YgYmxvY2sgZ2FzIGxpbWl0LgogICAgICAgICAgICAvLyBZZXMsIHBlbmRpbmcgY29uZmlybWF0aW9ucyB3aWxsIGJlIGxvc3QuIERvbnQgc2VlIGFueSBzZWN1cml0eSBvciBzdGFiaWxpdHkgaW1wbGljYXRpb25zLgogICAgICAgICAgICAvLyBUT0RPIHVzZSBtb3JlIGdyYWNlZnVsIGFwcHJvYWNoIGxpa2UgY29tcGFjdCBvciByZW1vdmFsIG9mIGNsZWFyUGVuZGluZyBjb21wbGV0ZWx5CiAgICAgICAgICAgIGNsZWFyUGVuZGluZygpOwoKICAgICAgICB2YXIgcGVuZGluZyA9IG1fbXVsdGlPd25lZFBlbmRpbmdbX29wZXJhdGlvbl07CgogICAgICAgIC8vIGlmIHdlJ3JlIG5vdCB5ZXQgd29ya2luZyBvbiB0aGlzIG9wZXJhdGlvbiwgc3dpdGNoIG92ZXIgYW5kIHJlc2V0IHRoZSBjb25maXJtYXRpb24gc3RhdHVzLgogICAgICAgIGlmICghIGlzT3BlcmF0aW9uQWN0aXZlKF9vcGVyYXRpb24pKSB7CiAgICAgICAgICAgIC8vIHJlc2V0IGNvdW50IG9mIGNvbmZpcm1hdGlvbnMgbmVlZGVkLgogICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZCA9IG1fbXVsdGlPd25lZFJlcXVpcmVkOwogICAgICAgICAgICAvLyByZXNldCB3aGljaCBvd25lcnMgaGF2ZSBjb25maXJtZWQgKG5vbmUpIC0gc2V0IG91ciBiaXRtYXAgdG8gMC4KICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lID0gMDsKICAgICAgICAgICAgcGVuZGluZy5pbmRleCA9IG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleC5sZW5ndGgrKzsKICAgICAgICAgICAgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W3BlbmRpbmcuaW5kZXhdID0gX29wZXJhdGlvbjsKICAgICAgICAgICAgYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KF9vcGVyYXRpb24pOwogICAgICAgIH0KCiAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBiaXQgdG8gc2V0IGZvciB0aGlzIG93bmVyLgogICAgICAgIHVpbnQgb3duZXJJbmRleEJpdCA9IG1ha2VPd25lckJpdG1hcEJpdChtc2cuc2VuZGVyKTsKICAgICAgICAvLyBtYWtlIHN1cmUgd2UgKHRoZSBtZXNzYWdlIHNlbmRlcikgaGF2ZW4ndCBjb25maXJtZWQgdGhpcyBvcGVyYXRpb24gcHJldmlvdXNseS4KICAgICAgICBpZiAocGVuZGluZy5vd25lcnNEb25lICYgb3duZXJJbmRleEJpdCA9PSAwKSB7CiAgICAgICAgICAgIC8vIG9rIC0gY2hlY2sgaWYgY291bnQgaXMgZW5vdWdoIHRvIGdvIGFoZWFkLgogICAgICAgICAgICBhc3NlcnQocGVuZGluZy55ZXROZWVkZWQgPiAwKTsKICAgICAgICAgICAgaWYgKHBlbmRpbmcueWV0TmVlZGVkID09IDEpIHsKICAgICAgICAgICAgICAgIC8vIGVub3VnaCBjb25maXJtYXRpb25zOiByZXNldCBhbmQgcnVuIGludGVyaW9yLgogICAgICAgICAgICAgICAgZGVsZXRlIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleFttX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dLmluZGV4XTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dOwogICAgICAgICAgICAgICAgRmluYWxDb25maXJtYXRpb24obXNnLnNlbmRlciwgX29wZXJhdGlvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIG5vdCBlbm91Z2g6IHJlY29yZCB0aGF0IHRoaXMgb3duZXIgaW4gcGFydGljdWxhciBjb25maXJtZWQuCiAgICAgICAgICAgICAgICBwZW5kaW5nLnlldE5lZWRlZC0tOwogICAgICAgICAgICAgICAgcGVuZGluZy5vd25lcnNEb25lIHw9IG93bmVySW5kZXhCaXQ7CiAgICAgICAgICAgICAgICBhc3NlcnRPcGVyYXRpb25Jc0NvbnNpc3RlbnQoX29wZXJhdGlvbik7CiAgICAgICAgICAgICAgICBDb25maXJtYXRpb24obXNnLnNlbmRlciwgX29wZXJhdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gUmVjbGFpbXMgZnJlZSBzbG90cyBiZXR3ZWVuIHZhbGlkIG93bmVycyBpbiBtX293bmVycy4KICAgIC8vIFRPRE8gZ2l2ZW4gdGhhdCBpdHMgY2FsbGVkIGFmdGVyIGVhY2ggcmVtb3ZhbCwgaXQgY291bGQgYmUgc2ltcGxpZmllZC4KICAgIGZ1bmN0aW9uIHJlb3JnYW5pemVPd25lcnMoKSBwcml2YXRlIHsKICAgICAgICB1aW50IGZyZWUgPSAxOwogICAgICAgIHdoaWxlIChmcmVlIDwgbV9udW1Pd25lcnMpCiAgICAgICAgewogICAgICAgICAgICAvLyBpdGVyYXRpbmcgdG8gdGhlIGZpcnN0IGZyZWUgc2xvdCBmcm9tIHRoZSBiZWdpbm5pbmcKICAgICAgICAgICAgd2hpbGUgKGZyZWUgPCBtX251bU93bmVycyAmJiBtX293bmVyc1tmcmVlXSAhPSAwKSBmcmVlKys7CgogICAgICAgICAgICAvLyBpdGVyYXRpbmcgdG8gdGhlIGZpcnN0IG9jY3VwaWVkIHNsb3QgZnJvbSB0aGUgZW5kCiAgICAgICAgICAgIHdoaWxlIChtX251bU93bmVycyA+IDEgJiYgbV9vd25lcnNbbV9udW1Pd25lcnNdID09IDApIG1fbnVtT3duZXJzLS07CgogICAgICAgICAgICAvLyBzd2FwLCBpZiBwb3NzaWJsZSwgc28gZnJlZSBzbG90IGlzIGxvY2F0ZWQgYXQgdGhlIGVuZCBhZnRlciB0aGUgc3dhcAogICAgICAgICAgICBpZiAoZnJlZSA8IG1fbnVtT3duZXJzICYmIG1fb3duZXJzW21fbnVtT3duZXJzXSAhPSAwICYmIG1fb3duZXJzW2ZyZWVdID09IDApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIG93bmVycyBiZXR3ZWVuIHN3YXBwZWQgc2xvdHMgc2hvdWxkJ3QgYmUgcmVudW1iZXJlZCAtIHRoYXQgc2F2ZXMgYSBsb3Qgb2YgZ2FzCiAgICAgICAgICAgICAgICBtX293bmVyc1tmcmVlXSA9IG1fb3duZXJzW21fbnVtT3duZXJzXTsKICAgICAgICAgICAgICAgIG1fb3duZXJJbmRleFttX293bmVyc1tmcmVlXV0gPSBmcmVlOwogICAgICAgICAgICAgICAgbV9vd25lcnNbbV9udW1Pd25lcnNdID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjbGVhclBlbmRpbmcoKSBwcml2YXRlIG9ubHlvd25lciB7CiAgICAgICAgdWludCBsZW5ndGggPSBtX211bHRpT3duZWRQZW5kaW5nSW5kZXgubGVuZ3RoOwogICAgICAgIC8vIFRPRE8gYmxvY2sgZ2FzIGxpbWl0CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgaWYgKG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleFtpXSAhPSAwKQogICAgICAgICAgICAgICAgZGVsZXRlIG1fbXVsdGlPd25lZFBlbmRpbmdbbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W2ldXTsKICAgICAgICB9CiAgICAgICAgZGVsZXRlIG1fbXVsdGlPd25lZFBlbmRpbmdJbmRleDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGVja093bmVySW5kZXgodWludCBvd25lckluZGV4KSBwcml2YXRlIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIGFzc2VydCgwICE9IG93bmVySW5kZXggJiYgb3duZXJJbmRleCA8PSBjX21heE93bmVycyk7CiAgICAgICAgcmV0dXJuIG93bmVySW5kZXg7CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZU93bmVyQml0bWFwQml0KGFkZHJlc3Mgb3duZXIpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgb3duZXJJbmRleCA9IGNoZWNrT3duZXJJbmRleChtX293bmVySW5kZXhbb3duZXJdKTsKICAgICAgICByZXR1cm4gMiAqKiBvd25lckluZGV4OwogICAgfQoKICAgIGZ1bmN0aW9uIGlzT3BlcmF0aW9uQWN0aXZlKGJ5dGVzMzIgX29wZXJhdGlvbikgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIDAgIT0gbV9tdWx0aU93bmVkUGVuZGluZ1tfb3BlcmF0aW9uXS55ZXROZWVkZWQ7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGFzc2VydE93bmVyc0FyZUNvbnNpc3RlbnQoKSBwcml2YXRlIGNvbnN0YW50IHsKICAgICAgICBhc3NlcnQobV9udW1Pd25lcnMgPiAwKTsKICAgICAgICBhc3NlcnQobV9udW1Pd25lcnMgPD0gY19tYXhPd25lcnMpOwogICAgICAgIGFzc2VydChtX293bmVyc1swXSA9PSAwKTsKICAgICAgICBhc3NlcnQoMCAhPSBtX211bHRpT3duZWRSZXF1aXJlZCAmJiBtX211bHRpT3duZWRSZXF1aXJlZCA8PSBtX251bU93bmVycyk7CiAgICB9CgogICAgZnVuY3Rpb24gYXNzZXJ0T3BlcmF0aW9uSXNDb25zaXN0ZW50KGJ5dGVzMzIgX29wZXJhdGlvbikgcHJpdmF0ZSBjb25zdGFudCB7CiAgICAgICAgdmFyIHBlbmRpbmcgPSBtX211bHRpT3duZWRQZW5kaW5nW19vcGVyYXRpb25dOwogICAgICAgIGFzc2VydCgwICE9IHBlbmRpbmcueWV0TmVlZGVkKTsKICAgICAgICBhc3NlcnQobV9tdWx0aU93bmVkUGVuZGluZ0luZGV4W3BlbmRpbmcuaW5kZXhdID09IF9vcGVyYXRpb24pOwogICAgICAgIGFzc2VydChwZW5kaW5nLnlldE5lZWRlZCA8PSBtX211bHRpT3duZWRSZXF1aXJlZCk7CiAgICB9CgoKICAgCS8vIEZJRUxEUwoKICAgIHVpbnQgY29uc3RhbnQgY19tYXhPd25lcnMgPSAyNTA7CgogICAgLy8gdGhlIG51bWJlciBvZiBvd25lcnMgdGhhdCBtdXN0IGNvbmZpcm0gdGhlIHNhbWUgb3BlcmF0aW9uIGJlZm9yZSBpdCBpcyBydW4uCiAgICB1aW50IHB1YmxpYyBtX211bHRpT3duZWRSZXF1aXJlZDsKCgogICAgLy8gcG9pbnRlciB1c2VkIHRvIGZpbmQgYSBmcmVlIHNsb3QgaW4gbV9vd25lcnMKICAgIHVpbnQgcHVibGljIG1fbnVtT3duZXJzOwoKICAgIC8vIGxpc3Qgb2Ygb3duZXJzIChhZGRyZXNzZXMpLAogICAgLy8gc2xvdCAwIGlzIHVudXNlZCBzbyB0aGVyZSBhcmUgbm8gb3duZXIgd2hpY2ggaW5kZXggaXMgMC4KICAgIC8vIFRPRE8gY291bGQgd2Ugc2F2ZSBzcGFjZSBhdCB0aGUgZW5kIG9mIHRoZSBhcnJheSBmb3IgdGhlIGNvbW1vbiBjYXNlIG9mIDwxMCBvd25lcnM/IGFuZCBzaG91bGQgd2U/CiAgICBhZGRyZXNzWzI1Nl0gaW50ZXJuYWwgbV9vd25lcnM7CgogICAgLy8gaW5kZXggb24gdGhlIGxpc3Qgb2Ygb3duZXJzIHRvIGFsbG93IHJldmVyc2UgbG9va3VwOiBvd25lciBhZGRyZXNzID0+IGluZGV4IGluIG1fb3duZXJzCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgaW50ZXJuYWwgbV9vd25lckluZGV4OwoKCiAgICAvLyB0aGUgb25nb2luZyBvcGVyYXRpb25zLgogICAgbWFwcGluZyhieXRlczMyID0+IE11bHRpT3duZWRPcGVyYXRpb25QZW5kaW5nU3RhdGUpIGludGVybmFsIG1fbXVsdGlPd25lZFBlbmRpbmc7CiAgICBieXRlczMyW10gaW50ZXJuYWwgbV9tdWx0aU93bmVkUGVuZGluZ0luZGV4Owp9Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpOwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKfQoKY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQoKfQoKY29udHJhY3QgQnVybmFibGVUb2tlbiBpcyBCYXNpY1Rva2VuIHsKCiAgICBldmVudCBCdXJuKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCB1aW50MjU2IGFtb3VudCk7CgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0byBidXJuIG1zZy5zZW5kZXIncyB0b2tlbnMuCiAgICAgKgogICAgICogQHBhcmFtIF9hbW91bnQgYW1vdW50IG9mIHRva2VucyB0byBidXJuCiAgICAgKgogICAgICogQHJldHVybiBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwKICAgICAqLwogICAgZnVuY3Rpb24gYnVybih1aW50MjU2IF9hbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBhZGRyZXNzIGZyb20gPSBtc2cuc2VuZGVyOwoKICAgICAgICByZXF1aXJlKF9hbW91bnQgPiAwKTsKICAgICAgICByZXF1aXJlKF9hbW91bnQgPD0gYmFsYW5jZXNbZnJvbV0pOwoKICAgICAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfYW1vdW50KTsKICAgICAgICBiYWxhbmNlc1tmcm9tXSA9IGJhbGFuY2VzW2Zyb21dLnN1YihfYW1vdW50KTsKICAgICAgICBCdXJuKGZyb20sIF9hbW91bnQpOwogICAgICAgIFRyYW5zZmVyKGZyb20sIGFkZHJlc3MoMCksIF9hbW91bnQpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1tfZnJvbV0pOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgIGJhbGFuY2VzW19mcm9tXSA9IGJhbGFuY2VzW19mcm9tXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBfdmFsdWU7CiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBjaGVjayB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqIEBwYXJhbSBfb3duZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCBvd25zIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX3NwZW5kZXIgYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcmV0dXJuIEEgdWludDI1NiBzcGVjaWZ5aW5nIHRoZSBhbW91bnQgb2YgdG9rZW5zIHN0aWxsIGF2YWlsYWJsZSBmb3IgdGhlIHNwZW5kZXIuCiAgICovCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCmNvbnRyYWN0IFRva2VuV2l0aEFwcHJvdmVBbmRDYWxsTWV0aG9kIGlzIFN0YW5kYXJkVG9rZW4gewoKICAgIC8qKgogICAgICogQG5vdGljZSBBcHByb3ZlcyBzcGVuZGluZyB0b2tlbnMgYW5kIGltbWVkaWF0ZWx5IHRyaWdnZXJzIHRva2VuIHJlY2lwaWVudCBsb2dpYy4KICAgICAqCiAgICAgKiBAcGFyYW0gX3NwZW5kZXIgY29udHJhY3Qgd2hpY2ggc3VwcG9ydHMgSUFwcHJvdmFsUmVjaXBpZW50IGFuZCBhbGxvd2VkIHRvIHJlY2VpdmUgdG9rZW5zCiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgYXBwcm92ZWQgdG8gYmUgc3BlbnQKICAgICAqIEBwYXJhbSBfZXh0cmFEYXRhIGFueSBleHRyYSBkYXRhIHdoaWNoIHRvIGJlIHByb3ZpZGVkIHRvIHRoZSBfc3BlbmRlcgogICAgICoKICAgICAqIEJ5IGludm9raW5nIHRoaXMgdXRpbGl0eSBmdW5jdGlvbiB0b2tlbiBob2xkZXIgY291bGQgZG8gdHdvIHRoaW5ncyBpbiBvbmUgdHJhbnNhY3Rpb246IGFwcHJvdmUgc3BlbmRpbmcgaGlzCiAgICAgKiB0b2tlbnMgYW5kIGV4ZWN1dGUgc29tZSBleHRlcm5hbCBjb250cmFjdCB3aGljaCBzcGVuZHMgdGhlbSBvbiB0b2tlbiBob2xkZXIncyBiZWhhbGYuCiAgICAgKiBJdCBjYW4ndCBiZSBrbm93biBpZiBfc3BlbmRlcidzIGludm9jYXRpb24gc3VjY2VlZCBvciBub3QuCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cgaWYgYXBwcm92YWwgZmFpbGVkLgogICAgICovCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSwgYnl0ZXMgX2V4dHJhRGF0YSkgcHVibGljIHsKICAgICAgICByZXF1aXJlKGFwcHJvdmUoX3NwZW5kZXIsIF92YWx1ZSkpOwogICAgICAgIElBcHByb3ZhbFJlY2lwaWVudChfc3BlbmRlcikucmVjZWl2ZUFwcHJvdmFsKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2V4dHJhRGF0YSk7CiAgICB9Cn0KCmNvbnRyYWN0IFNtYXJ0elRva2VuIGlzIEFyZ3VtZW50c0NoZWNrZXIsIG11bHRpb3duZWQsIEJ1cm5hYmxlVG9rZW4sIFN0YW5kYXJkVG9rZW4sIFRva2VuV2l0aEFwcHJvdmVBbmRDYWxsTWV0aG9kIHsKCiAgICAvLy8gQHRpdGxlIFVuaXQgb2YgZnJvemVuIHRva2VucyAtIHRva2VucyB3aGljaCBjYW4ndCBiZSBzcGVudCB1bnRpbCBjZXJ0YWluIGNvbmRpdGlvbnMgaXMgbWV0LgogICAgc3RydWN0IEZyb3plbkNlbGwgewogICAgICAgIC8vLyBAbm90aWNlIGFtb3VudCBvZiBmcm96ZW4gdG9rZW5zCiAgICAgICAgdWludCBhbW91bnQ7CgogICAgICAgIC8vLyBAbm90aWNlIHVudGlsIHRoaXMgdW5peCB0aW1lIHRoZSBjZWxsIGlzIGNvbnNpZGVyZWQgZnJvemVuCiAgICAgICAgdWludDEyOCB0aGF3VFM7CgogICAgICAgIC8vLyBAbm90aWNlIGlzIEtZQyByZXF1aXJlZCBmb3IgYSB0b2tlbiBob2xkZXIgdG8gc3BlbmQgdGhpcyBjZWxsPwogICAgICAgIHVpbnQxMjggaXNLWUNSZXF1aXJlZDsKICAgIH0KCgogICAgLy8gTU9ESUZJRVJTCgogICAgbW9kaWZpZXIgb25seVNhbGUoYWRkcmVzcyBhY2NvdW50KSB7CiAgICAgICAgcmVxdWlyZShpc1NhbGUoYWNjb3VudCkpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgdmFsaWRVbml4VFModWludCB0cykgewogICAgICAgIHJlcXVpcmUodHMgPj0gMTUyMjA0NjMyNiAmJiB0cyA8PSAxODAwMDAwMDAwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGNoZWNrVHJhbnNmZXJJbnZhcmlhbnQoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvKSB7CiAgICAgICAgdWludCBpbml0aWFsID0gYmFsYW5jZU9mKGZyb20pLmFkZChiYWxhbmNlT2YodG8pKTsKICAgICAgICBfOwogICAgICAgIGFzc2VydChiYWxhbmNlT2YoZnJvbSkuYWRkKGJhbGFuY2VPZih0bykpID09IGluaXRpYWwpOwogICAgfQoKICAgIG1vZGlmaWVyIHByaXZpbGVnZWRBbGxvd2VkIHsKICAgICAgICByZXF1aXJlKG1fYWxsb3dQcml2aWxlZ2VkKTsKICAgICAgICBfOwogICAgfQoKCiAgICAvLyBQVUJMSUMgRlVOQ1RJT05TCgogICAgLyoqCiAgICAgKiBAbm90aWNlIENvbnN0cnVjdHMgdG9rZW4uCiAgICAgKgogICAgICogSW5pdGlhbCBvd25lcnMgaGF2ZSBwb3dlciBvdmVyIHRoZSB0b2tlbiBjb250cmFjdCBvbmx5IGR1cmluZyBib290c3RyYXAgcGhhc2UgKGVhcmx5IGludmVzdG1lbnRzIGFuZCB0b2tlbgogICAgICogc2FsZXMpLiBUbyBiZSBwcmVjaXNlLCB0aGUgb3duZXJzIGNhbiBzZXQgS1lDIHByb3ZpZGVyIGFuZCBzYWxlcyAod2hpY2ggY2FuIGZyZWV6ZSB0cmFuc2ZlcmVkIHRva2VucykgZHVyaW5nCiAgICAgKiBib290c3RyYXAgcGhhc2UuIEFmdGVyIGZpbmFsIHRva2VuIHNhbGUgYW55IGNvbnRyb2wgb3ZlciB0aGUgdG9rZW4gcmVtb3ZlZCBieSBpc3N1aW5nIGRpc2FibGVQcml2aWxlZ2VkIGNhbGwuCiAgICAgKi8KICAgIGZ1bmN0aW9uIFNtYXJ0elRva2VuKCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgbXVsdGlvd25lZChnZXRJbml0aWFsT3duZXJzKCksIDIpCiAgICB7CiAgICAgICAgaWYgKDAgIT0gMTUwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKSB7CiAgICAgICAgICAgIHRvdGFsU3VwcGx5ID0gMTUwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwOwogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHRvdGFsU3VwcGx5OwogICAgICAgICAgICBUcmFuc2ZlcihhZGRyZXNzKDApLCBtc2cuc2VuZGVyLCB0b3RhbFN1cHBseSk7CiAgICAgICAgfQoKCnRvdGFsU3VwcGx5ID0gdG90YWxTdXBwbHkuYWRkKDApOwoKICAgICAgICBhZGRyZXNzKDB4YWFjZjc4ZjhlMWZiZGNmN2Q5NDFlODBmZjhiODE3YmUxZjA1NGFmNCkudHJhbnNmZXIoMzAwMDAwMDAwMDAwMDAwMDAwIHdlaSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0SW5pdGlhbE93bmVycygpIHByaXZhdGUgcHVyZSByZXR1cm5zIChhZGRyZXNzW10pIHsKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IHJlc3VsdCA9IG5ldyBhZGRyZXNzW10oMyk7CnJlc3VsdFswXSA9IGFkZHJlc3MoMHg0ZmY5QTY4YTgzMjM5OGM2YjAxMzYzM0JCNTY4MjU5NWViYjdCOTJFKTsKcmVzdWx0WzFdID0gYWRkcmVzcygweEU0MDc0YkI3YkQ0ODI4YkFlRDlkMmJlQ2UxZTM4NjQwODQyOGRmQjcpOwpyZXN1bHRbMl0gPSBhZGRyZXNzKDB4QUFDZjc4RjhlMWZiRGNmN2Q5NDFFODBGZjhCODE3QkUxRjA1NEFmNCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIEBub3RpY2UgVmVyc2lvbiBvZiBiYWxhbmNlT2YoKSB3aGljaCBpbmNsdWRlcyBhbGwgZnJvemVuIHRva2Vucy4KICAgICAqCiAgICAgKiBAcGFyYW0gX293bmVyIHRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSBiYWxhbmNlIG9mCiAgICAgKgogICAgICogQHJldHVybiBhbiB1aW50MjU2IHJlcHJlc2VudGluZyB0aGUgYW1vdW50IG93bmVkIGJ5IHRoZSBwYXNzZWQgYWRkcmVzcwogICAgICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBiYWxhbmNlc1tfb3duZXJdOwoKICAgICAgICBmb3IgKHVpbnQgY2VsbEluZGV4ID0gMDsgY2VsbEluZGV4IDwgZnJvemVuQmFsYW5jZXNbX293bmVyXS5sZW5ndGg7ICsrY2VsbEluZGV4KSB7CiAgICAgICAgICAgIGJhbGFuY2UgPSBiYWxhbmNlLmFkZChmcm96ZW5CYWxhbmNlc1tfb3duZXJdW2NlbGxJbmRleF0uYW1vdW50KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBiYWxhbmNlOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBWZXJzaW9uIG9mIGJhbGFuY2VPZigpIHdoaWNoIGluY2x1ZGVzIG9ubHkgY3VycmVudGx5IHNwZW5kYWJsZSB0b2tlbnMuCiAgICAgKgogICAgICogQHBhcmFtIF9vd25lciB0aGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgYmFsYW5jZSBvZgogICAgICoKICAgICAqIEByZXR1cm4gYW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBzcGVuZGFibGUgYnkgdGhlIHBhc3NlZCBhZGRyZXNzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGF2YWlsYWJsZUJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IGJhbGFuY2VzW19vd25lcl07CgogICAgICAgIGZvciAodWludCBjZWxsSW5kZXggPSAwOyBjZWxsSW5kZXggPCBmcm96ZW5CYWxhbmNlc1tfb3duZXJdLmxlbmd0aDsgKytjZWxsSW5kZXgpIHsKICAgICAgICAgICAgaWYgKGlzU3BlbmRhYmxlRnJvemVuQ2VsbChfb3duZXIsIGNlbGxJbmRleCkpCiAgICAgICAgICAgICAgICBiYWxhbmNlID0gYmFsYW5jZS5hZGQoZnJvemVuQmFsYW5jZXNbX293bmVyXVtjZWxsSW5kZXhdLmFtb3VudCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYmFsYW5jZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBub3RpY2UgU3RhbmRhcmQgdHJhbnNmZXIoKSBvdmVycmlkZGVuIHRvIGhhdmUgYSBjaGFuY2UgdG8gdGhhdyBzZW5kZXIncyB0b2tlbnMuCiAgICAgKgogICAgICogQHBhcmFtIF90byB0aGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0bwogICAgICogQHBhcmFtIF92YWx1ZSB0aGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmZiBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWxvYWRTaXplSXMoMiAqIDMyKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdGhhd1NvbWVUb2tlbnMobXNnLnNlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXIoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBTdGFuZGFyZCB0cmFuc2ZlckZyb20gb3ZlcnJpZGRlbiB0byBoYXZlIGEgY2hhbmNlIHRvIHRoYXcgc2VuZGVyJ3MgdG9rZW5zLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIHRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgICAqIEBwYXJhbSBfdG8gYWRkcmVzcyB0aGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0bwogICAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmZiBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlsb2FkU2l6ZUlzKDMgKiAzMikKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHRoYXdTb21lVG9rZW5zKF9mcm9tLCBfdmFsdWUpOwogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBGdW5jdGlvbiB0byBidXJuIG1zZy5zZW5kZXIncyB0b2tlbnMuIE92ZXJyaWRkZW4gdG8gaGF2ZSBhIGNoYW5jZSB0byB0aGF3IHNlbmRlcidzIHRva2Vucy4KICAgICAqCiAgICAgKiBAcGFyYW0gX2Ftb3VudCBhbW91bnQgb2YgdG9rZW5zIHRvIGJ1cm4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bAogICAgICovCiAgICBmdW5jdGlvbiBidXJuKHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlsb2FkU2l6ZUlzKDEgKiAzMikKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHRoYXdTb21lVG9rZW5zKG1zZy5zZW5kZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiBzdXBlci5idXJuKF9hbW91bnQpOwogICAgfQoKCiAgICAvLyBJTkZPUk1BVElPTkFMIEZVTkNUSU9OUyAoVklFV1MpCgogICAgLyoqCiAgICAgKiBAbm90aWNlIE51bWJlciBvZiBmcm96ZW4gY2VsbHMgb2YgYW4gYWNjb3VudC4KICAgICAqCiAgICAgKiBAcGFyYW0gb3duZXIgYWNjb3VudCBhZGRyZXNzCiAgICAgKgogICAgICogQHJldHVybiBudW1iZXIgb2YgZnJvemVuIGNlbGxzCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZyb3plbkNlbGxDb3VudChhZGRyZXNzIG93bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGZyb3plbkJhbGFuY2VzW293bmVyXS5sZW5ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBAbm90aWNlIFJldHJpZXZlcyBpbmZvcm1hdGlvbiBhYm91dCBhY2NvdW50IGZyb3plbiB0b2tlbnMuCiAgICAgKgogICAgICogQHBhcmFtIG93bmVyIGFjY291bnQgYWRkcmVzcwogICAgICogQHBhcmFtIGluZGV4IGluZGV4IG9mIHNvLWNhbGxlZCBmcm96ZW4gY2VsbCBmcm9tIDAgKGluY2x1c2l2ZSkgdXAgdG8gZnJvemVuQ2VsbENvdW50KG93bmVyKSBleGNsdXNpdmUKICAgICAqCiAgICAgKiBAcmV0dXJuIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIGZyb3plbiBpbiB0aGlzIGNlbGwKICAgICAqIEByZXR1cm4gdGhhd1RTIHVuaXggdGltZXN0YW1wIGF0IHdoaWNoIHRva2VucydsbCBiZWNvbWUgYXZhaWxhYmxlCiAgICAgKiBAcmV0dXJuIGlzS1lDUmVxdWlyZWQgaXQncyByZXF1aXJlZCB0byBwYXNzIEtZQyB0byBzcGVuZCB0b2tlbnMgaWZmIGlzS1lDUmVxdWlyZWQgaXMgdHJ1ZQogICAgICovCiAgICBmdW5jdGlvbiBmcm96ZW5DZWxsKGFkZHJlc3Mgb3duZXIsIHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgYW1vdW50LCB1aW50IHRoYXdUUywgYm9vbCBpc0tZQ1JlcXVpcmVkKSB7CiAgICAgICAgcmVxdWlyZShpbmRleCA8IGZyb3plbkNlbGxDb3VudChvd25lcikpOwoKICAgICAgICBhbW91bnQgPSBmcm96ZW5CYWxhbmNlc1tvd25lcl1baW5kZXhdLmFtb3VudDsKICAgICAgICB0aGF3VFMgPSB1aW50KGZyb3plbkJhbGFuY2VzW293bmVyXVtpbmRleF0udGhhd1RTKTsKICAgICAgICBpc0tZQ1JlcXVpcmVkID0gZGVjb2RlS1lDRmxhZyhmcm96ZW5CYWxhbmNlc1tvd25lcl1baW5kZXhdLmlzS1lDUmVxdWlyZWQpOwogICAgfQoKCiAgICAvLyBBRE1JTklTVFJBVElWRSBGVU5DVElPTlMKCiAgICAvKioKICAgICAqIEBub3RpY2UgU2V0cyBjdXJyZW50IEtZQyBwcm92aWRlciBvZiB0aGUgdG9rZW4uCiAgICAgKgogICAgICogQHBhcmFtIEtZQ1Byb3ZpZGVyIGFkZHJlc3Mgb2YgdGhlIElLWUNQcm92aWRlci1jb21wYXRpYmxlIGNvbnRyYWN0CiAgICAgKgogICAgICogRnVuY3Rpb24gaXMgdXNlZCBvbmx5IGR1cmluZyB0b2tlbiBzYWxlIHBoYXNlLCBiZWZvcmUgZGlzYWJsZVByaXZpbGVnZWQoKSBpcyBjYWxsZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldEtZQ1Byb3ZpZGVyKGFkZHJlc3MgS1lDUHJvdmlkZXIpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2YWxpZEFkZHJlc3MoS1lDUHJvdmlkZXIpCiAgICAgICAgcHJpdmlsZWdlZEFsbG93ZWQKICAgICAgICBvbmx5bWFueW93bmVycyhrZWNjYWsyNTYobXNnLmRhdGEpKQogICAgewogICAgICAgIG1fS1lDUHJvdmlkZXIgPSBJS1lDUHJvdmlkZXIoS1lDUHJvdmlkZXIpOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBTZXRzIHNhbGUgc3RhdHVzIG9mIGFuIGFjY291bnQuCiAgICAgKgogICAgICogQHBhcmFtIGFjY291bnQgYWNjb3VudCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gaXNTYWxlIGlzIHRoaXMgYWNjb3VudCBoYXMgYWNjZXNzIHRvIGZyb3plbiogZnVuY3Rpb25zCiAgICAgKgogICAgICogRnVuY3Rpb24gaXMgdXNlZCBvbmx5IGR1cmluZyB0b2tlbiBzYWxlIHBoYXNlLCBiZWZvcmUgZGlzYWJsZVByaXZpbGVnZWQoKSBpcyBjYWxsZWQuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNldFNhbGUoYWRkcmVzcyBhY2NvdW50LCBib29sIGlzU2FsZSkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZhbGlkQWRkcmVzcyhhY2NvdW50KQogICAgICAgIHByaXZpbGVnZWRBbGxvd2VkCiAgICAgICAgb25seW1hbnlvd25lcnMoa2VjY2FrMjU2KG1zZy5kYXRhKSkKICAgIHsKICAgICAgICBtX3NhbGVzW2FjY291bnRdID0gaXNTYWxlOwogICAgfQoKCiAgICAvKioKICAgICAqIEBub3RpY2UgVHJhbnNmZXJzIHRva2VucyB0byBhIHJlY2lwaWVudCBhbmQgZnJlZXplcyBpdC4KICAgICAqCiAgICAgKiBAcGFyYW0gX3RvIGFjY291bnQgdG8gd2hpY2ggdG9rZW5zIGFyZSBzZW50CiAgICAgKiBAcGFyYW0gX3ZhbHVlIGFtb3VudCBvZiB0b2tlbnMgdG8gc2VuZAogICAgICogQHBhcmFtIHRoYXdUUyB1bml4IHRpbWVzdGFtcCBhdCB3aGljaCB0b2tlbnMnbGwgYmVjb21lIGF2YWlsYWJsZQogICAgICogQHBhcmFtIGlzS1lDUmVxdWlyZWQgaXQncyByZXF1aXJlZCB0byBwYXNzIEtZQyB0byBzcGVuZCB0b2tlbnMgaWZmIGlzS1lDUmVxdWlyZWQgaXMgdHJ1ZQogICAgICoKICAgICAqIEZ1bmN0aW9uIGlzIHVzZWQgb25seSBkdXJpbmcgdG9rZW4gc2FsZSBwaGFzZSBhbmQgYXZhaWxhYmxlIG9ubHkgdG8gc2FsZSBhY2NvdW50cy4KICAgICAqLwogICAgZnVuY3Rpb24gZnJvemVuVHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCB1aW50IHRoYXdUUywgYm9vbCBpc0tZQ1JlcXVpcmVkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykKICAgICAgICB2YWxpZFVuaXhUUyh0aGF3VFMpCiAgICAgICAgcGF5bG9hZFNpemVJcyg0ICogMzIpCiAgICAgICAgcHJpdmlsZWdlZEFsbG93ZWQKICAgICAgICBvbmx5U2FsZShtc2cuc2VuZGVyKQogICAgICAgIGNoZWNrVHJhbnNmZXJJbnZhcmlhbnQobXNnLnNlbmRlciwgX3RvKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgICAgIGFkZEZyb3plbihfdG8sIF92YWx1ZSwgdGhhd1RTLCBpc0tZQ1JlcXVpcmVkKTsKICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQG5vdGljZSBUcmFuc2ZlcnMgZnJvemVuIHRva2VucyBiYWNrLgogICAgICoKICAgICAqIEBwYXJhbSBfZnJvbSBhY2NvdW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgICAqIEBwYXJhbSBfdG8gYWNjb3VudCB0byB3aGljaCB0b2tlbnMgYXJlIHNlbnQKICAgICAqIEBwYXJhbSBfdmFsdWUgYW1vdW50IG9mIHRva2VucyB0byBzZW5kCiAgICAgKiBAcGFyYW0gdGhhd1RTIHVuaXggdGltZXN0YW1wIGF0IHdoaWNoIHRva2VucydsbCBiZWNvbWUgYXZhaWxhYmxlCiAgICAgKiBAcGFyYW0gaXNLWUNSZXF1aXJlZCBpdCdzIHJlcXVpcmVkIHRvIHBhc3MgS1lDIHRvIHNwZW5kIHRva2VucyBpZmYgaXNLWUNSZXF1aXJlZCBpcyB0cnVlCiAgICAgKgogICAgICogRnVuY3Rpb24gaXMgdXNlZCBvbmx5IGR1cmluZyB0b2tlbiBzYWxlIHBoYXNlIHRvIG1ha2UgYSByZWZ1bmRzIGFuZCBhdmFpbGFibGUgb25seSB0byBzYWxlIGFjY291bnRzLgogICAgICogX2Zyb20gYWNjb3VudCBoYXMgdG8gZXhwbGljaXRseSBhcHByb3ZlIHNwZW5kaW5nIHdpdGggdGhlIGFwcHJvdmUoKSBjYWxsLgogICAgICogdGhhd1RTIGFuZCBpc0tZQ1JlcXVpcmVkIHBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkIHRvIHdpdGhkcmF3IGV4YWN0ICJzYW1lIiB0b2tlbnMgKHRvIG5vdCBhZmZlY3QgYXZhaWxhYmlsaXR5IG9mCiAgICAgKiBvdGhlciB0b2tlbnMgb2YgdGhlIGFjY291bnQpLgogICAgICovCiAgICBmdW5jdGlvbiBmcm96ZW5UcmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCB1aW50IHRoYXdUUywgYm9vbCBpc0tZQ1JlcXVpcmVkKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmFsaWRBZGRyZXNzKF90bykKICAgICAgICB2YWxpZFVuaXhUUyh0aGF3VFMpCiAgICAgICAgcGF5bG9hZFNpemVJcyg1ICogMzIpCiAgICAgICAgcHJpdmlsZWdlZEFsbG93ZWQKICAgICAgICAvL29ubHlTYWxlKG1zZy5zZW5kZXIpIHRvbyBtYW55IGxvY2FsIHZhcmlhYmxlcyAtIGNvbXBpbGVyIGZhaWxzCiAgICAgICAgLy9vbmx5U2FsZShfdG8pCiAgICAgICAgY2hlY2tUcmFuc2ZlckludmFyaWFudChfZnJvbSwgX3RvKQogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmVxdWlyZShpc1NhbGUobXNnLnNlbmRlcikgJiYgaXNTYWxlKF90bykpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBzdWJGcm96ZW4oX2Zyb20sIF92YWx1ZSwgdGhhd1RTLCBpc0tZQ1JlcXVpcmVkKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBEaXNhYmxlcyBmdXJ0aGVyIHVzZSBvZiBhbnkgcHJpdmlsZWdlZCBmdW5jdGlvbnMgbGlrZSBmcmVlemluZyB0b2tlbnMuCiAgICBmdW5jdGlvbiBkaXNhYmxlUHJpdmlsZWdlZCgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwcml2aWxlZ2VkQWxsb3dlZAogICAgICAgIG9ubHltYW55b3duZXJzKGtlY2NhazI1Nihtc2cuZGF0YSkpCiAgICB7CiAgICAgICAgbV9hbGxvd1ByaXZpbGVnZWQgPSBmYWxzZTsKICAgIH0KCgogICAgLy8gSU5URVJOQUwgRlVOQ1RJT05TCgogICAgZnVuY3Rpb24gaXNTYWxlKGFkZHJlc3MgYWNjb3VudCkgcHJpdmF0ZSB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbV9zYWxlc1thY2NvdW50XTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgVHJpZXMgdG8gZmluZCBleGlzdGVudCBGcm96ZW5DZWxsIHRoYXQgbWF0Y2hlcyAodGhhd1RTLCBpc0tZQ1JlcXVpcmVkKS4KICAgICAqCiAgICAgKiBAcmV0dXJuIGluZGV4IGluIGZyb3plbkJhbGFuY2VzW19vd25lcl0gd2hpY2ggZXF1YWxzIHRvIGZyb3plbkJhbGFuY2VzW19vd25lcl0ubGVuZ3RoIGluIGNhc2UgY2VsbCBpcyBub3QgZm91bmQKICAgICAqCiAgICAgKiBCZWNhdXNlIGZyb3plbiogZnVuY3Rpb25zIGFyZSBvbmx5IGZvciB0b2tlbiBzYWxlcyBhbmQgdG9rZW4gc2FsZSBudW1iZXIgaXMgbGltaXRlZCwgZXhwZWN0aW5nIGNlbGxJbmRleAogICAgICogdG8gYmUgfiAxLTUgYW5kIHRoZSBmb2xsb3dpbmcgbG9vcCB0byBiZSBPKDEpLgogICAgICovCiAgICBmdW5jdGlvbiBmaW5kRnJvemVuQ2VsbChhZGRyZXNzIG93bmVyLCB1aW50MTI4IHRoYXdUU0VuY29kZWQsIHVpbnQxMjggaXNLWUNSZXF1aXJlZEVuY29kZWQpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50IGNlbGxJbmRleCkKICAgIHsKICAgICAgICBmb3IgKGNlbGxJbmRleCA9IDA7IGNlbGxJbmRleCA8IGZyb3plbkJhbGFuY2VzW293bmVyXS5sZW5ndGg7ICsrY2VsbEluZGV4KSB7CiAgICAgICAgICAgIEZyb3plbkNlbGwgc3RvcmFnZSBjaGVja2VkQ2VsbCA9IGZyb3plbkJhbGFuY2VzW293bmVyXVtjZWxsSW5kZXhdOwogICAgICAgICAgICBpZiAoY2hlY2tlZENlbGwudGhhd1RTID09IHRoYXdUU0VuY29kZWQgJiYgY2hlY2tlZENlbGwuaXNLWUNSZXF1aXJlZCA9PSBpc0tZQ1JlcXVpcmVkRW5jb2RlZCkKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0KGNlbGxJbmRleCA8PSBmcm96ZW5CYWxhbmNlc1tvd25lcl0ubGVuZ3RoKTsKICAgIH0KCiAgICAvLy8gQGRldiBTYXlzIGlmIHRoZSBnaXZlbiBjZWxsIGNvdWxkIGJlIHNwZW50IG5vdwogICAgZnVuY3Rpb24gaXNTcGVuZGFibGVGcm96ZW5DZWxsKGFkZHJlc3Mgb3duZXIsIHVpbnQgY2VsbEluZGV4KQogICAgICAgIHByaXZhdGUKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBGcm96ZW5DZWxsIHN0b3JhZ2UgY2VsbCA9IGZyb3plbkJhbGFuY2VzW293bmVyXVtjZWxsSW5kZXhdOwogICAgICAgIGlmICh1aW50KGNlbGwudGhhd1RTKSA+IGdldFRpbWUoKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoMCA9PSBjZWxsLmFtb3VudCkgICAvLyBhbHJlYWR5IHNwZW50CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgaWYgKGRlY29kZUtZQ0ZsYWcoY2VsbC5pc0tZQ1JlcXVpcmVkKSAmJiAhbV9LWUNQcm92aWRlci5pc0tZQ1Bhc3NlZChvd25lcikpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gaW5jcmVtZW50IG9yIGNyZWF0ZSBmcm96ZW4gY2VsbC4KICAgIGZ1bmN0aW9uIGFkZEZyb3plbihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIHVpbnQgdGhhd1RTLCBib29sIGlzS1lDUmVxdWlyZWQpCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG8pCiAgICAgICAgdmFsaWRVbml4VFModGhhd1RTKQogICAgewogICAgICAgIHVpbnQxMjggdGhhd1RTRW5jb2RlZCA9IHVpbnQxMjgodGhhd1RTKTsKICAgICAgICB1aW50MTI4IGlzS1lDUmVxdWlyZWRFbmNvZGVkID0gZW5jb2RlS1lDRmxhZyhpc0tZQ1JlcXVpcmVkKTsKCiAgICAgICAgdWludCBjZWxsSW5kZXggPSBmaW5kRnJvemVuQ2VsbChfdG8sIHRoYXdUU0VuY29kZWQsIGlzS1lDUmVxdWlyZWRFbmNvZGVkKTsKCiAgICAgICAgLy8gSW4gY2FzZSBjZWxsIGlzIG5vdCBmb3VuZCAtIGNyZWF0aW5nIG5ldy4KICAgICAgICBpZiAoY2VsbEluZGV4ID09IGZyb3plbkJhbGFuY2VzW190b10ubGVuZ3RoKSB7CiAgICAgICAgICAgIGZyb3plbkJhbGFuY2VzW190b10ubGVuZ3RoKys7CiAgICAgICAgICAgIHRhcmdldENlbGwgPSBmcm96ZW5CYWxhbmNlc1tfdG9dW2NlbGxJbmRleF07CiAgICAgICAgICAgIGFzc2VydCgwID09IHRhcmdldENlbGwuYW1vdW50KTsKCiAgICAgICAgICAgIHRhcmdldENlbGwudGhhd1RTID0gdGhhd1RTRW5jb2RlZDsKICAgICAgICAgICAgdGFyZ2V0Q2VsbC5pc0tZQ1JlcXVpcmVkID0gaXNLWUNSZXF1aXJlZEVuY29kZWQ7CiAgICAgICAgfQoKICAgICAgICBGcm96ZW5DZWxsIHN0b3JhZ2UgdGFyZ2V0Q2VsbCA9IGZyb3plbkJhbGFuY2VzW190b11bY2VsbEluZGV4XTsKICAgICAgICBhc3NlcnQodGFyZ2V0Q2VsbC50aGF3VFMgPT0gdGhhd1RTRW5jb2RlZCAmJiB0YXJnZXRDZWxsLmlzS1lDUmVxdWlyZWQgPT0gaXNLWUNSZXF1aXJlZEVuY29kZWQpOwoKICAgICAgICB0YXJnZXRDZWxsLmFtb3VudCA9IHRhcmdldENlbGwuYW1vdW50LmFkZChfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRlY3JlbWVudCBmcm96ZW4gY2VsbC4KICAgIGZ1bmN0aW9uIHN1YkZyb3plbihhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF92YWx1ZSwgdWludCB0aGF3VFMsIGJvb2wgaXNLWUNSZXF1aXJlZCkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmFsaWRVbml4VFModGhhd1RTKQogICAgewogICAgICAgIHVpbnQgY2VsbEluZGV4ID0gZmluZEZyb3plbkNlbGwoX2Zyb20sIHVpbnQxMjgodGhhd1RTKSwgZW5jb2RlS1lDRmxhZyhpc0tZQ1JlcXVpcmVkKSk7CiAgICAgICAgcmVxdWlyZShjZWxsSW5kZXggIT0gZnJvemVuQmFsYW5jZXNbX2Zyb21dLmxlbmd0aCk7ICAgLy8gaGFzIHRvIGJlIGZvdW5kCgogICAgICAgIEZyb3plbkNlbGwgc3RvcmFnZSBjZWxsID0gZnJvemVuQmFsYW5jZXNbX2Zyb21dW2NlbGxJbmRleF07CiAgICAgICAgcmVxdWlyZShjZWxsLmFtb3VudCA+PSBfdmFsdWUpOwoKICAgICAgICBjZWxsLmFtb3VudCA9IGNlbGwuYW1vdW50LnN1YihfdmFsdWUpOwogICAgfQoKICAgIC8vLyBAZGV2IFRoYXdzIHRva2VucyBvZiBvd25lciB1bnRpbCBlbm91Z2ggdG9rZW5zIGNvdWxkIGJlIHNwZW50IG9yIG5vIG1vcmUgc3VjaCB0b2tlbnMgZm91bmQuCiAgICBmdW5jdGlvbiB0aGF3U29tZVRva2VucyhhZGRyZXNzIG93bmVyLCB1aW50IHJlcXVpcmVkQW1vdW50KQogICAgICAgIHByaXZhdGUKICAgIHsKICAgICAgICBpZiAoYmFsYW5jZXNbb3duZXJdID49IHJlcXVpcmVkQW1vdW50KQogICAgICAgICAgICByZXR1cm47ICAgICAvLyBmYXN0IHBhdGgKCiAgICAgICAgLy8gQ2hlY2tpbmcgdGhhdCBvdXIgZ29hbCBpcyByZWFjaGFibGUgYmVmb3JlIGlzc3VpbmcgZXhwZW5zaXZlIHN0b3JhZ2UgbW9kaWZpY2F0aW9ucy4KICAgICAgICByZXF1aXJlKGF2YWlsYWJsZUJhbGFuY2VPZihvd25lcikgPj0gcmVxdWlyZWRBbW91bnQpOwoKICAgICAgICBmb3IgKHVpbnQgY2VsbEluZGV4ID0gMDsgY2VsbEluZGV4IDwgZnJvemVuQmFsYW5jZXNbb3duZXJdLmxlbmd0aDsgKytjZWxsSW5kZXgpIHsKICAgICAgICAgICAgaWYgKGlzU3BlbmRhYmxlRnJvemVuQ2VsbChvd25lciwgY2VsbEluZGV4KSkgewogICAgICAgICAgICAgICAgdWludCBhbW91bnQgPSBmcm96ZW5CYWxhbmNlc1tvd25lcl1bY2VsbEluZGV4XS5hbW91bnQ7CiAgICAgICAgICAgICAgICBmcm96ZW5CYWxhbmNlc1tvd25lcl1bY2VsbEluZGV4XS5hbW91bnQgPSAwOwogICAgICAgICAgICAgICAgYmFsYW5jZXNbb3duZXJdID0gYmFsYW5jZXNbb3duZXJdLmFkZChhbW91bnQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBhc3NlcnQoYmFsYW5jZXNbb3duZXJdID49IHJlcXVpcmVkQW1vdW50KTsKICAgIH0KCiAgICAvLy8gQGRldiB0byBiZSBvdmVycmlkZGVuIGluIHRlc3RzCiAgICBmdW5jdGlvbiBnZXRUaW1lKCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCiAgICBmdW5jdGlvbiBlbmNvZGVLWUNGbGFnKGJvb2wgaXNLWUNSZXF1aXJlZCkgcHJpdmF0ZSBwdXJlIHJldHVybnMgKHVpbnQxMjgpIHsKICAgICAgICByZXR1cm4gaXNLWUNSZXF1aXJlZCA/IHVpbnQxMjgoMSkgOiB1aW50MTI4KDApOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlY29kZUtZQ0ZsYWcodWludDEyOCBpc0tZQ1JlcXVpcmVkKSBwcml2YXRlIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBpc0tZQ1JlcXVpcmVkICE9IHVpbnQxMjgoMCk7CiAgICB9CgoKICAgIC8vIEZJRUxEUwoKICAgIC8vLyBAbm90aWNlIGN1cnJlbnQgS1lDIHByb3ZpZGVyIG9mIHRoZSB0b2tlbgogICAgSUtZQ1Byb3ZpZGVyIHB1YmxpYyBtX0tZQ1Byb3ZpZGVyOwoKICAgIC8vLyBAbm90aWNlIHNldCBvZiBzYWxlIGFjY291bnRzIHdoaWNoIGNhbiBmcmVlemUgdG9rZW5zCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBtX3NhbGVzOwoKICAgIC8vLyBAbm90aWNlIGZyb3plbiB0b2tlbnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gRnJvemVuQ2VsbFtdKSBwdWJsaWMgZnJvemVuQmFsYW5jZXM7CgogICAgLy8vIEBub3RpY2UgYWxsb3dzIHByaXZpbGVnZWQgZnVuY3Rpb25zICh0b2tlbiBzYWxlIHBoYXNlKQogICAgYm9vbCBwdWJsaWMgbV9hbGxvd1ByaXZpbGVnZWQgPSB0cnVlOwoKCiAgICAvLyBDT05TVEFOVFMKCiAgICBzdHJpbmcgcHVibGljIGNvbnN0YW50IG5hbWUgPSAnU21hcnR6IHRva2VuJzsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gJ1NNUic7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKfQ=='.
	

]
