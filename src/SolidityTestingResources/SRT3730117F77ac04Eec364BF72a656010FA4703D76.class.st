Class {
	#name : #SRT3730117F77ac04Eec364BF72a656010FA4703D76,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT3730117F77ac04Eec364BF72a656010FA4703D76 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjsKCi8qCiAqCiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFBhc3MgREFPLgogKgogKiBUaGUgVG9rZW4gTWFuYWdlciBzbWFydCBjb250cmFjdCBpcyB1c2VkIGZvciB0aGUgbWFuYWdlbWVudCBvZiB0b2tlbnMKICogYnkgYSBjbGllbnQgc21hcnQgY29udHJhY3QgKHRoZSBEYW8pLiBEZWZpbmVzIHRoZSBmdW5jdGlvbnMgdG8gc2V0IG5ldyBmdW5kaW5nIHJ1bGVzLAogKiBjcmVhdGUgb3IgcmV3YXJkIHRva2VucywgY2hlY2sgdG9rZW4gYmFsYW5jZXMsIHNlbmQgdG9rZW5zIGFuZCBzZW5kCiAqIHRva2VucyBvbiBiZWhhbGYgb2YgYSAzcmQgcGFydHkgYW5kIHRoZSBjb3JyZXNwb25kaW5nIGFwcHJvdmFsIHByb2Nlc3MuCiAqCiovCgovLy8gQHRpdGxlIFRva2VuIE1hbmFnZXIgc21hcnQgY29udHJhY3Qgb2YgdGhlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbgpjb250cmFjdCBQYXNzVG9rZW5NYW5hZ2VySW50ZXJmYWNlIHsKICAgIAogICAgc3RydWN0IGZ1bmRpbmdEYXRhIHsKICAgICAgICAvLyBUcnVlIGlmIHB1YmxpYyBmdW5kaW5nIHdpdGhvdXQgYSBtYWluIHBhcnRuZXIKICAgICAgICBib29sIHB1YmxpY0NyZWF0aW9uOyAKICAgICAgICAvLyBUaGUgYWRkcmVzcyB3aGljaCBzZXRzIHBhcnRuZXJzIGFuZCBtYW5hZ2VzIHRoZSBmdW5kaW5nIGluIGNhc2Ugb2YgcHJpdmF0ZSBmdW5kaW5nCiAgICAgICAgYWRkcmVzcyBtYWluUGFydG5lcjsKICAgICAgICAvLyBUaGUgbWF4aW11bSBhbW91bnQgKGluIHdlaSkgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IG1heEFtb3VudFRvRnVuZDsKICAgICAgICAvLyBUaGUgYWN0dWFsIGZ1bmRlZCBhbW91bnQgKGluIHdlaSkKICAgICAgICB1aW50IGZ1bmRlZEFtb3VudDsKICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgc3RhcnQgdGltZSBvZiB0aGUgZnVuZGluZwogICAgICAgIHVpbnQgc3RhcnRUaW1lOyAKICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgY2xvc2luZyB0aW1lIG9mIHRoZSBmdW5kaW5nCiAgICAgICAgdWludCBjbG9zaW5nVGltZTsgIAogICAgICAgIC8vIFRoZSBwcmljZSBtdWx0aXBsaWVyIGZvciBhIHNoYXJlIG9yIGEgdG9rZW4gd2l0aG91dCBjb25zaWRlcmluZyB0aGUgaW5mbGF0aW9uIHJhdGUKICAgICAgICB1aW50IGluaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgLy8gUmF0ZSBwZXIgeWVhciBpbiBwZXJjZW50YWdlIGFwcGxpZWQgdG8gdGhlIHNoYXJlIG9yIHRva2VuIHByaWNlIAogICAgICAgIHVpbnQgaW5mbGF0aW9uUmF0ZTsgCiAgICAgICAgLy8gSW5kZXggb2YgdGhlIGNsaWVudCBwcm9wb3NhbAogICAgICAgIHVpbnQgcHJvcG9zYWxJRDsKICAgIH0gCgogICAgLy8gQWRkcmVzcyBvZiB0aGUgY3JlYXRvciBvZiB0aGUgc21hcnQgY29udHJhY3QKICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3I7CiAgICAvLyBBZGRyZXNzIG9mIHRoZSBEYW8gICAgCiAgICBhZGRyZXNzIHB1YmxpYyBjbGllbnQ7CiAgICAvLyBBZGRyZXNzIG9mIHRoZSByZWNpcGllbnQ7CiAgICBhZGRyZXNzIHB1YmxpYyByZWNpcGllbnQ7CiAgICAKICAgIC8vIFRoZSB0b2tlbiBuYW1lIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKICAgIC8vIFRoZSB0b2tlbiBzeW1ib2wgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgc3RyaW5nIHB1YmxpYyBzeW1ib2w7CiAgICAvLyBUaGUgcXVhbnRpdHkgb2YgZGVjaW1hbHMgZm9yIGRpc3BsYXkgcHVycG9zZQogICAgdWludDggcHVibGljIGRlY2ltYWxzOwoKICAgIC8vIFRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgdG90YWxTdXBwbHk7CgogICAgLy8gQXJyYXkgd2l0aCBhbGwgYmFsYW5jZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgICAvLyBBcnJheSB3aXRoIGFsbCBhbGxvd2FuY2VzCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgLy8gTWFwIG9mIHRoZSByZXN1bHQgKGluIHdlaSkgb2YgZnVuZGluZ3MKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgZnVuZGVkQW1vdW50OwogICAgCiAgICAvLyBJZiB0cnVlLCB0aGUgc2hhcmVzIG9yIHRva2VucyBjYW4gYmUgdHJhbnNmZXJlZAogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJhYmxlOwogICAgLy8gTWFwIG9mIGJsb2NrZWQgRGFvIHNoYXJlIGFjY291bnRzLiBQb2ludHMgdG8gdGhlIGRhdGUgd2hlbiB0aGUgc2hhcmUgaG9sZGVyIGNhbiB0cmFuc2ZlciBzaGFyZXMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJsb2NrZWREZWFkTGluZTsgCgogICAgLy8gUnVsZXMgZm9yIHRoZSBhY3R1YWwgZnVuZGluZyBhbmQgdGhlIGNvbnRyYWN0b3IgdG9rZW4gcHJpY2UKICAgIGZ1bmRpbmdEYXRhWzJdIHB1YmxpYyBGdW5kaW5nUnVsZXM7CiAgICAKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBzdXBwbHkgb2Ygc2hhcmVzIG9yIHRva2VucyAKICAgIGZ1bmN0aW9uIFRvdGFsU3VwcGx5KCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2UKICAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgb3duaW5nIHRva2VucwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFF1YW50aXR5IG9mIHJlbWFpbmluZyB0b2tlbnMgb2YgX293bmVyIHRoYXQgX3NwZW5kZXIgaXMgYWxsb3dlZCB0byBzcGVuZAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIERhbyBwcm9wb3NhbAogICAgLy8vIEByZXR1cm4gVGhlIHJlc3VsdCAoaW4gd2VpKSBvZiB0aGUgZnVuZGluZwogICAgZnVuY3Rpb24gRnVuZGVkQW1vdW50KHVpbnQgX3Byb3Bvc2FsSUQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAcGFyYW0gX3NhbGVEYXRlIGluIGNhc2Ugb2YgcHJlc2FsZSwgdGhlIGRhdGUgb2YgdGhlIHByZXNhbGUKICAgIC8vLyBAcmV0dXJuIHRoZSBzaGFyZSBvciB0b2tlbiBwcmljZSBkaXZpc29yIGNvbmRpZGVyaW5nIHRoZSBzYWxlIGRhdGUgYW5kIHRoZSBpbmZsYXRpb24gcmF0ZQogICAgZnVuY3Rpb24gcHJpY2VEaXZpc29yKHVpbnQgX3NhbGVEYXRlKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zICh1aW50KTsKICAgIAogICAgLy8vIEByZXR1cm4gdGhlIGFjdHVhbCBwcmljZSBkaXZpc29yIG9mIGEgc2hhcmUgb3IgdG9rZW4KICAgIGZ1bmN0aW9uIGFjdHVhbFByaWNlRGl2aXNvcigpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQpOwoKICAgIC8vLyBAcmV0dXJuIFRoZSBtYXhpbWFsIGFtb3VudCBhIG1haW4gcGFydG5lciBjYW4gZnVuZCBhdCB0aGlzIG1vbWVudAogICAgLy8vIEBwYXJhbSBfbWFpblBhcnRuZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG1haW4gcGFybmVyCiAgICBmdW5jdGlvbiBmdW5kaW5nTWF4QW1vdW50KGFkZHJlc3MgX21haW5QYXJ0bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KTsKCiAgICAvLyBNb2RpZmllciB0aGF0IGFsbG93cyBvbmx5IHRoZSBjbGllbnQgdG8gbWFuYWdlIHRoaXMgYWNjb3VudCBtYW5hZ2VyCiAgICBtb2RpZmllciBvbmx5Q2xpZW50IHtpZiAobXNnLnNlbmRlciAhPSBjbGllbnQpIHRocm93OyBfO30KCiAgICAvLyBNb2RpZmllciB0aGF0IGFsbG93cyBvbmx5IHRoZSBtYWluIHBhcnRuZXIgdG8gbWFuYWdlIHRoZSBhY3R1YWwgZnVuZGluZwogICAgbW9kaWZpZXIgb25seU1haW5QYXJ0bmVyIHtpZiAobXNnLnNlbmRlciAhPSAgRnVuZGluZ1J1bGVzWzBdLm1haW5QYXJ0bmVyKSB0aHJvdzsgXzt9CiAgICAKICAgIC8vIE1vZGlmaWVyIHRoYXQgYWxsb3dzIG9ubHkgdGhlIGNvbnRyYWN0b3IgcHJvcG9zZSBzZXQgdGhlIHRva2VuIHByaWNlIG9yIHdpdGhkcmF3CiAgICBtb2RpZmllciBvbmx5Q29udHJhY3RvciB7aWYgKHJlY2lwaWVudCA9PSAwIHx8IChtc2cuc2VuZGVyICE9IHJlY2lwaWVudCAmJiBtc2cuc2VuZGVyICE9IGNyZWF0b3IpKSB0aHJvdzsgXzt9CiAgICAKICAgIC8vIE1vZGlmaWVyIGZvciBEYW8gZnVuY3Rpb25zCiAgICBtb2RpZmllciBvbmx5RGFvIHtpZiAocmVjaXBpZW50ICE9IDApIHRocm93OyBfO30KICAgIAogICAgLy8vIEBkZXYgVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yIFRoZSBhZGRyZXNzIG9mIHRoZSBjcmVhdG9yIG9mIHRoZSBzbWFydCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfY2xpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSBjbGllbnQgb3IgRGFvCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIHJlY2lwaWVudCBvZiB0aGlzIG1hbmFnZXIKICAgIC8vZnVuY3Rpb24gVG9rZW5NYW5hZ2VyKAogICAgICAgIC8vYWRkcmVzcyBfY3JlYXRvciwKICAgICAgICAvL2FkZHJlc3MgX2NsaWVudCwKICAgICAgICAvL2FkZHJlc3MgX3JlY2lwaWVudAogICAgLy8pOwoKICAgIC8vLyBAcGFyYW0gX3Rva2VuTmFtZSBUaGUgdG9rZW4gbmFtZSBmb3IgZGlzcGxheSBwdXJwb3NlCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUaGUgdG9rZW4gc3ltYm9sIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIC8vLyBAcGFyYW0gX3Rva2VuRGVjaW1hbHMgVGhlIHF1YW50aXR5IG9mIGRlY2ltYWxzIGZvciBkaXNwbGF5IHB1cnBvc2UKICAgIC8vLyBAcGFyYW0gX2luaXRpYWxTdXBwbHlSZWNpcGllbnQgVGhlIHJlY2lwaWVudCBvZiB0aGUgaW5pdGlhbCBzdXBwbHkgKG5vdCBtYW5kYXRvcnkpCiAgICAvLy8gQHBhcmFtIF9pbml0aWFsU3VwcGx5IFRoZSBpbml0aWFsIHN1cHBseSBvZiB0b2tlbnMgZm9yIHRoZSByZWNpcGllbnQgKG5vdCBtYW5kYXRvcnkpCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcmFibGUgVHJ1ZSBpZiBhbGxvd3MgdGhlIHRyYW5zZmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gaW5pdFRva2VuKAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgdWludDggX3Rva2VuRGVjaW1hbHMsCiAgICAgICAgYWRkcmVzcyBfaW5pdGlhbFN1cHBseVJlY2lwaWVudCwKICAgICAgICB1aW50MjU2IF9pbml0aWFsU3VwcGx5LAogICAgICAgIGJvb2wgX3RyYW5zZmVyYWJsZQogICAgICAgKTsKCiAgICAvLy8gQHBhcmFtIF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyIFRoZSBpbml0aWFsIHByaWNlIG11bHRpcGxpZXIgb2YgY29udHJhY3RvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2luZmxhdGlvblJhdGUgSWYgMCwgdGhlIGNvbnRyYWN0b3IgdG9rZW4gcHJpY2UgZG9lc24ndCBjaGFuZ2UgZHVyaW5nIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9jbG9zaW5nVGltZSBUaGUgaW5pdGlhbCBwcmljZSBhbmQgaW5mbGF0aW9uIHJhdGUgY2FuIGJlIGNoYW5nZWQgYWZ0ZXIgdGhpcyBkYXRlCiAgICBmdW5jdGlvbiBzZXRUb2tlblByaWNlUHJvcG9zYWwoICAgICAgICAKICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX2Nsb3NpbmdUaW1lCiAgICApOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHNldCBhIGZ1bmRpbmcuIENhbiBiZSBwcml2YXRlIG9yIHB1YmxpYwogICAgLy8vIEBwYXJhbSBfbWFpblBhcnRuZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHNtYXJ0IGNvbnRyYWN0IHRvIG1hbmFnZSBhIHByaXZhdGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfcHVibGljQ3JlYXRpb24gVHJ1ZSBpZiBwdWJsaWMgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfaW5pdGlhbFByaWNlTXVsdGlwbGllciBQcmljZSBtdWx0aXBsaWVyIHdpdGhvdXQgY29uc2lkZXJpbmcgYW55IGluZmxhdGlvbiByYXRlCiAgICAvLy8gQHBhcmFtIF9tYXhBbW91bnRUb0Z1bmQgVGhlIG1heGltdW0gYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRnVuZGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfaW5mbGF0aW9uUmF0ZSBJZiAwLCB0aGUgdG9rZW4gcHJpY2UgZG9lc24ndCBjaGFuZ2UgZHVyaW5nIHRoZSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIEluZGV4IG9mIHRoZSBjbGllbnQgcHJvcG9zYWwgKG5vdCBtYW5kYXRvcnkpCiAgICBmdW5jdGlvbiBzZXRGdW5kaW5nUnVsZXMoCiAgICAgICAgYWRkcmVzcyBfbWFpblBhcnRuZXIsCiAgICAgICAgYm9vbCBfcHVibGljQ3JlYXRpb24sIAogICAgICAgIHVpbnQgX2luaXRpYWxQcmljZU11bHRpcGxpZXIsIAogICAgICAgIHVpbnQgX21heEFtb3VudFRvRnVuZCwgCiAgICAgICAgdWludCBfbWludXRlc0Z1bmRpbmdQZXJpb2QsIAogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsCiAgICAgICAgdWludCBfcHJvcG9zYWxJRAogICAgKSBleHRlcm5hbDsKICAgIAogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gZm9yIHRoZSBjcmVhdGlvbiBvZiBzaGFyZXMgb3IgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9yZWNpcGllbnQgVGhlIHJlY2lwaWVudCBhZGRyZXNzIG9mIHNoYXJlcyBvciB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgZnVuZGVkIGFtb3VudCAoaW4gd2VpKQogICAgLy8vIEBwYXJhbSBfc2FsZURhdGUgSW4gY2FzZSBvZiBwcmVzYWxlLCB0aGUgZGF0ZSBvZiB0aGUgcHJlc2FsZQogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgY3JlYXRpb24gd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbigKICAgICAgICBhZGRyZXNzIF9yZWNpcGllbnQsIAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICB1aW50IF9zYWxlRGF0ZQogICAgKSBpbnRlcm5hbCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIG1haW4gcGFydG5lciB0byBzZXQgdGhlIHN0YXJ0IHRpbWUgb2YgdGhlIGZ1bmRpbmcKICAgIC8vLyBAcGFyYW0gX3N0YXJ0VGltZSBUaGUgdW5peCBzdGFydCBkYXRlIG9mIHRoZSBmdW5kaW5nIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIG1haW4gcGFydG5lciB0byByZXdhcmQgc2hhcmVzIG9yIHRva2VucwogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQgb2Ygc2hhcmVzIG9yIHRva2VucwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIFdlaSkgdG8gY2FsY3VsYXRlIHRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGNyZWF0ZQogICAgLy8vIEBwYXJhbSBfZGF0ZSBUaGUgdW5peCBkYXRlIHRvIGNvbnNpZGVyIGZvciB0aGUgc2hhcmUgb3IgdG9rZW4gcHJpY2UgY2FsY3VsYXRpb24KICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gcmV3YXJkVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCAKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfZGF0ZQogICAgICAgICkgZXh0ZXJuYWw7CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gY2xvc2UgdGhlIGFjdHVhbCBmdW5kaW5nCiAgICBmdW5jdGlvbiBjbG9zZUZ1bmRpbmcoKSBpbnRlcm5hbDsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgbWFpbiBwYXJ0bmVyIHRvIHNldCB0aGUgZnVuZGluZyBmdWVsZWQKICAgIGZ1bmN0aW9uIHNldEZ1bmRpbmdGdWVsZWQoKSBleHRlcm5hbDsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzIG9yIGNvbnRyYWN0b3IgdG9rZW5zCiAgICBmdW5jdGlvbiBhYmxlVHJhbnNmZXIoKTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBkaXNhYmxlIHRoZSB0cmFuc2ZlciBvZiBEYW8gc2hhcmVzCiAgICBmdW5jdGlvbiBkaXNhYmxlVHJhbnNmZXIoKTsKCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB1c2VkIGJ5IHRoZSBjbGllbnQgdG8gYmxvY2sgdGhlIHRyYW5zZmVyIG9mIHNoYXJlcyBmcm9tIGFuZCB0byBhIHNoYXJlIGhvbGRlcgogICAgLy8vIEBwYXJhbSBfc2hhcmVIb2xkZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIHNoYXJlIGhvbGRlcgogICAgLy8vIEBwYXJhbSBfZGVhZExpbmUgV2hlbiB0aGUgYWNjb3VudCB3aWxsIGJlIHVuYmxvY2tlZAogICAgZnVuY3Rpb24gYmxvY2tUcmFuc2ZlcihhZGRyZXNzIF9zaGFyZUhvbGRlciwgdWludCBfZGVhZExpbmUpIGV4dGVybmFsOwoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIHNlbmQgYF92YWx1ZWAgdG9rZW4gdG8gYF90b2AgZnJvbSBgX0Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBmdW5jdGlvbiB3YXMgc3VjY2Vzc2Z1bCBvciBub3QgCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb21UbygKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLCAKICAgICAgICB1aW50MjU2IF92YWx1ZQogICAgICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIHF1YW50aXR5IG9mIHNoYXJlcyBvciB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBxdWFudGl0eSBvZiBzaGFyZXMgb3IgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgCiAgICAgICAgYWRkcmVzcyBfdG8sIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgICAgICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNwZW5kIGBfYW1vdW50YCB0b2tlbnMgb24gaXRzIGJlaGFsZgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIGFwcHJvdmVkIGZvciB0cmFuc2ZlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgYXBwcm92YWwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoKICAgIGV2ZW50IFRva2Vuc0NyZWF0ZWQoYWRkcmVzcyBpbmRleGVkIFNlbmRlciwgYWRkcmVzcyBpbmRleGVkIFRva2VuSG9sZGVyLCB1aW50IFF1YW50aXR5KTsKICAgIGV2ZW50IEZ1bmRpbmdSdWxlc1NldChhZGRyZXNzIGluZGV4ZWQgTWFpblBhcnRuZXIsIHVpbnQgaW5kZXhlZCBGdW5kaW5nUHJvcG9zYWxJZCwgdWludCBpbmRleGVkIFN0YXJ0VGltZSwgdWludCBDbG9zaW5nVGltZSk7CiAgICBldmVudCBGdW5kaW5nRnVlbGVkKHVpbnQgaW5kZXhlZCBGdW5kaW5nUHJvcG9zYWxJRCwgdWludCBGdW5kZWRBbW91bnQpOwogICAgZXZlbnQgVHJhbnNmZXJBYmxlKCk7CiAgICBldmVudCBUcmFuc2ZlckRpc2FibGUoKTsKCn0gICAgCgpjb250cmFjdCBQYXNzVG9rZW5NYW5hZ2VyIGlzIFBhc3NUb2tlbk1hbmFnZXJJbnRlcmZhY2UgewogICAgCiAgICBmdW5jdGlvbiBUb3RhbFN1cHBseSgpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHk7CiAgICB9CgogICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICAgfQoKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1NiByZW1haW5pbmcpIHsKICAgICAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiBGdW5kZWRBbW91bnQodWludCBfcHJvcG9zYWxJRCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBmdW5kZWRBbW91bnRbX3Byb3Bvc2FsSURdOwogICAgfQoKICAgIGZ1bmN0aW9uIHByaWNlRGl2aXNvcih1aW50IF9zYWxlRGF0ZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgX2RhdGUgPSBfc2FsZURhdGU7CiAgICAgICAgCiAgICAgICAgaWYgKF9zYWxlRGF0ZSA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgX2RhdGUgPSBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWU7CiAgICAgICAgaWYgKF9zYWxlRGF0ZSA8IEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUpIF9kYXRlID0gRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZTsKCiAgICAgICAgcmV0dXJuIDEwMCArIDEwMCpGdW5kaW5nUnVsZXNbMF0uaW5mbGF0aW9uUmF0ZSooX2RhdGUgLSBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lKS8oMTAwKjM2NSBkYXlzKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWN0dWFsUHJpY2VEaXZpc29yKCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwcmljZURpdmlzb3Iobm93KTsKICAgIH0KCiAgICBmdW5jdGlvbiBmdW5kaW5nTWF4QW1vdW50KGFkZHJlc3MgX21haW5QYXJ0bmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBub3cgPCBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lCiAgICAgICAgICAgIHx8IF9tYWluUGFydG5lciAhPSBGdW5kaW5nUnVsZXNbMF0ubWFpblBhcnRuZXIpIHsKICAgICAgICAgICAgcmV0dXJuIDA7ICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIEZ1bmRpbmdSdWxlc1swXS5tYXhBbW91bnRUb0Z1bmQ7CiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIGZ1bmN0aW9uIFBhc3NUb2tlbk1hbmFnZXIoCiAgICAgICAgYWRkcmVzcyBfY3JlYXRvciwKICAgICAgICBhZGRyZXNzIF9jbGllbnQsCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50CiAgICApIHsKICAgICAgICAKICAgICAgICBpZiAoX2NyZWF0b3IgPT0gMCAKICAgICAgICAgICAgfHwgX2NsaWVudCA9PSAwIAogICAgICAgICAgICB8fCBfY2xpZW50ID09IF9yZWNpcGllbnQgCiAgICAgICAgICAgIHx8IF9jbGllbnQgPT0gYWRkcmVzcyh0aGlzKSAKICAgICAgICAgICAgfHwgX3JlY2lwaWVudCA9PSBhZGRyZXNzKHRoaXMpKSB0aHJvdzsKCiAgICAgICAgY3JlYXRvciA9IF9jcmVhdG9yOyAKICAgICAgICBjbGllbnQgPSBfY2xpZW50OwogICAgICAgIHJlY2lwaWVudCA9IF9yZWNpcGllbnQ7CiAgICAgICAgCiAgICB9CiAgIAogICAgZnVuY3Rpb24gaW5pdFRva2VuKAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgdWludDggX3Rva2VuRGVjaW1hbHMsCiAgICAgICAgYWRkcmVzcyBfaW5pdGlhbFN1cHBseVJlY2lwaWVudCwKICAgICAgICB1aW50MjU2IF9pbml0aWFsU3VwcGx5LAogICAgICAgIGJvb2wgX3RyYW5zZmVyYWJsZSkgewogICAgICAgICAgIAogICAgICAgIGlmIChfaW5pdGlhbFN1cHBseVJlY2lwaWVudCA9PSBhZGRyZXNzKHRoaXMpCiAgICAgICAgICAgIHx8IGRlY2ltYWxzICE9IDAKICAgICAgICAgICAgfHwgbXNnLnNlbmRlciAhPSBjcmVhdG9yCiAgICAgICAgICAgIHx8IHRvdGFsU3VwcGx5ICE9IDApIHRocm93OwogICAgICAgICAgICAKICAgICAgICBuYW1lID0gX3Rva2VuTmFtZTsKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7CiAgICAgICAgZGVjaW1hbHMgPSBfdG9rZW5EZWNpbWFsczsKICAgICAgICAgIAogICAgICAgIGlmIChfdHJhbnNmZXJhYmxlKSB7CiAgICAgICAgICAgIHRyYW5zZmVyYWJsZSA9IHRydWU7CiAgICAgICAgICAgIFRyYW5zZmVyQWJsZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyYW5zZmVyYWJsZSA9IGZhbHNlOwogICAgICAgICAgICBUcmFuc2ZlckRpc2FibGUoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYmFsYW5jZXNbX2luaXRpYWxTdXBwbHlSZWNpcGllbnRdID0gX2luaXRpYWxTdXBwbHk7IAogICAgICAgIHRvdGFsU3VwcGx5ID0gX2luaXRpYWxTdXBwbHk7CiAgICAgICAgVG9rZW5zQ3JlYXRlZChtc2cuc2VuZGVyLCBfaW5pdGlhbFN1cHBseVJlY2lwaWVudCwgX2luaXRpYWxTdXBwbHkpOwogICAgICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRUb2tlblByaWNlUHJvcG9zYWwoICAgICAgICAKICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX2Nsb3NpbmdUaW1lCiAgICApIG9ubHlDb250cmFjdG9yIHsKICAgICAgICAKICAgICAgICBpZiAoX2Nsb3NpbmdUaW1lIDwgbm93IAogICAgICAgICAgICB8fCBub3cgPCBGdW5kaW5nUnVsZXNbMV0uY2xvc2luZ1RpbWUpIHRocm93OwogICAgICAgIAogICAgICAgIEZ1bmRpbmdSdWxlc1sxXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gX2luaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgRnVuZGluZ1J1bGVzWzFdLmluZmxhdGlvblJhdGUgPSBfaW5mbGF0aW9uUmF0ZTsKICAgICAgICBGdW5kaW5nUnVsZXNbMV0uc3RhcnRUaW1lID0gbm93OwogICAgICAgIEZ1bmRpbmdSdWxlc1sxXS5jbG9zaW5nVGltZSA9IF9jbG9zaW5nVGltZTsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1J1bGVzKAogICAgICAgIGFkZHJlc3MgX21haW5QYXJ0bmVyLAogICAgICAgIGJvb2wgX3B1YmxpY0NyZWF0aW9uLCAKICAgICAgICB1aW50IF9pbml0aWFsUHJpY2VNdWx0aXBsaWVyLAogICAgICAgIHVpbnQgX21heEFtb3VudFRvRnVuZCwgCiAgICAgICAgdWludCBfbWludXRlc0Z1bmRpbmdQZXJpb2QsIAogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsCiAgICAgICAgdWludCBfcHJvcG9zYWxJRAogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHsKCiAgICAgICAgaWYgKG5vdyA8IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBfbWFpblBhcnRuZXIgPT0gYWRkcmVzcyh0aGlzKQogICAgICAgICAgICB8fCBfbWFpblBhcnRuZXIgPT0gY2xpZW50CiAgICAgICAgICAgIHx8ICghX3B1YmxpY0NyZWF0aW9uICYmIF9tYWluUGFydG5lciA9PSAwKQogICAgICAgICAgICB8fCAoX3B1YmxpY0NyZWF0aW9uICYmIF9tYWluUGFydG5lciAhPSAwKQogICAgICAgICAgICB8fCAocmVjaXBpZW50ID09IDAgJiYgX2luaXRpYWxQcmljZU11bHRpcGxpZXIgPT0gMCkKICAgICAgICAgICAgfHwgKHJlY2lwaWVudCAhPSAwIAogICAgICAgICAgICAgICAgJiYgKEZ1bmRpbmdSdWxlc1sxXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID09IDAKICAgICAgICAgICAgICAgICAgICB8fCBfaW5mbGF0aW9uUmF0ZSA8IEZ1bmRpbmdSdWxlc1sxXS5pbmZsYXRpb25SYXRlCiAgICAgICAgICAgICAgICAgICAgfHwgbm93IDwgRnVuZGluZ1J1bGVzWzFdLnN0YXJ0VGltZQogICAgICAgICAgICAgICAgICAgIHx8IEZ1bmRpbmdSdWxlc1sxXS5jbG9zaW5nVGltZSA8IG5vdyArIChfbWludXRlc0Z1bmRpbmdQZXJpb2QgKiAxIG1pbnV0ZXMpKSkKICAgICAgICAgICAgfHwgX21heEFtb3VudFRvRnVuZCA9PSAwCiAgICAgICAgICAgIHx8IF9taW51dGVzRnVuZGluZ1BlcmlvZCA9PSAwCiAgICAgICAgICAgICkgdGhyb3c7CgogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUgPSBub3c7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLmNsb3NpbmdUaW1lID0gbm93ICsgX21pbnV0ZXNGdW5kaW5nUGVyaW9kICogMSBtaW51dGVzOwogICAgICAgICAgICAKICAgICAgICBGdW5kaW5nUnVsZXNbMF0ubWFpblBhcnRuZXIgPSBfbWFpblBhcnRuZXI7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnB1YmxpY0NyZWF0aW9uID0gX3B1YmxpY0NyZWF0aW9uOwogICAgICAgIAogICAgICAgIGlmIChyZWNpcGllbnQgPT0gMCkgRnVuZGluZ1J1bGVzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXIgPSBfaW5pdGlhbFByaWNlTXVsdGlwbGllcjsKICAgICAgICBlbHNlIEZ1bmRpbmdSdWxlc1swXS5pbml0aWFsUHJpY2VNdWx0aXBsaWVyID0gRnVuZGluZ1J1bGVzWzFdLmluaXRpYWxQcmljZU11bHRpcGxpZXI7CiAgICAgICAgCiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAwKSBGdW5kaW5nUnVsZXNbMF0uaW5mbGF0aW9uUmF0ZSA9IF9pbmZsYXRpb25SYXRlOwogICAgICAgIGVsc2UgRnVuZGluZ1J1bGVzWzBdLmluZmxhdGlvblJhdGUgPSBGdW5kaW5nUnVsZXNbMV0uaW5mbGF0aW9uUmF0ZTsKICAgICAgICAKICAgICAgICBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50ID0gMDsKICAgICAgICBGdW5kaW5nUnVsZXNbMF0ubWF4QW1vdW50VG9GdW5kID0gX21heEFtb3VudFRvRnVuZDsKCiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnByb3Bvc2FsSUQgPSBfcHJvcG9zYWxJRDsKCiAgICAgICAgRnVuZGluZ1J1bGVzU2V0KF9tYWluUGFydG5lciwgX3Byb3Bvc2FsSUQsIEZ1bmRpbmdSdWxlc1swXS5zdGFydFRpbWUsIEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSk7CiAgICAgICAgICAgIAogICAgfSAKICAgIAogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW4oCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LCAKICAgICAgICB1aW50IF9hbW91bnQsCiAgICAgICAgdWludCBfc2FsZURhdGUKICAgICkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIGlmIChub3cgPiBGdW5kaW5nUnVsZXNbMF0uY2xvc2luZ1RpbWUKICAgICAgICAgICAgfHwgbm93IDwgRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZQogICAgICAgICAgICB8fF9zYWxlRGF0ZSA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZQogICAgICAgICAgICB8fCBfc2FsZURhdGUgPCBGdW5kaW5nUnVsZXNbMF0uc3RhcnRUaW1lCiAgICAgICAgICAgIHx8IEZ1bmRpbmdSdWxlc1swXS5mdW5kZWRBbW91bnQgKyBfYW1vdW50ID4gRnVuZGluZ1J1bGVzWzBdLm1heEFtb3VudFRvRnVuZCkgcmV0dXJuOwoKICAgICAgICB1aW50IF9hID0gX2Ftb3VudCpGdW5kaW5nUnVsZXNbMF0uaW5pdGlhbFByaWNlTXVsdGlwbGllcjsKICAgICAgICB1aW50IF9tdWx0aXBsaWVyID0gMTAwKl9hOwogICAgICAgIHVpbnQgX3F1YW50aXR5ID0gX211bHRpcGxpZXIvcHJpY2VEaXZpc29yKF9zYWxlRGF0ZSk7CiAgICAgICAgaWYgKF9hL19hbW91bnQgIT0gRnVuZGluZ1J1bGVzWzBdLmluaXRpYWxQcmljZU11bHRpcGxpZXIKICAgICAgICAgICAgfHwgX211bHRpcGxpZXIvMTAwICE9IF9hCiAgICAgICAgICAgIHx8IHRvdGFsU3VwcGx5ICsgX3F1YW50aXR5IDw9IHRvdGFsU3VwcGx5IAogICAgICAgICAgICB8fCB0b3RhbFN1cHBseSArIF9xdWFudGl0eSA8PSBfcXVhbnRpdHkpIHJldHVybjsKCiAgICAgICAgYmFsYW5jZXNbX3JlY2lwaWVudF0gKz0gX3F1YW50aXR5OwogICAgICAgIHRvdGFsU3VwcGx5ICs9IF9xdWFudGl0eTsKICAgICAgICBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50ICs9IF9hbW91bnQ7CgogICAgICAgIFRva2Vuc0NyZWF0ZWQobXNnLnNlbmRlciwgX3JlY2lwaWVudCwgX3F1YW50aXR5KTsKICAgICAgICAKICAgICAgICBpZiAoRnVuZGluZ1J1bGVzWzBdLmZ1bmRlZEFtb3VudCA9PSBGdW5kaW5nUnVsZXNbMF0ubWF4QW1vdW50VG9GdW5kKSBjbG9zZUZ1bmRpbmcoKTsKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0RnVuZGluZ1N0YXJ0VGltZSh1aW50IF9zdGFydFRpbWUpIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgdGhyb3c7CiAgICAgICAgRnVuZGluZ1J1bGVzWzBdLnN0YXJ0VGltZSA9IF9zdGFydFRpbWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJld2FyZFRva2VuKAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfYW1vdW50LAogICAgICAgIHVpbnQgX2RhdGUKICAgICAgICApIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CgogICAgICAgIHVpbnQgX3NhbGVEYXRlOwogICAgICAgIGlmIChfZGF0ZSA9PSAwKSBfc2FsZURhdGUgPSBub3c7IGVsc2UgX3NhbGVEYXRlID0gX2RhdGU7CgogICAgICAgIGlmICghY3JlYXRlVG9rZW4oX3JlY2lwaWVudCwgX2Ftb3VudCwgX3NhbGVEYXRlKSkgdGhyb3c7CgogICAgfQoKICAgIGZ1bmN0aW9uIGNsb3NlRnVuZGluZygpIGludGVybmFsIHsKICAgICAgICBpZiAocmVjaXBpZW50ID09IDApIGZ1bmRlZEFtb3VudFtGdW5kaW5nUnVsZXNbMF0ucHJvcG9zYWxJRF0gPSBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50OwogICAgICAgIEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSA9IG5vdzsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc2V0RnVuZGluZ0Z1ZWxlZCgpIGV4dGVybmFsIG9ubHlNYWluUGFydG5lciB7CiAgICAgICAgaWYgKG5vdyA+IEZ1bmRpbmdSdWxlc1swXS5jbG9zaW5nVGltZSkgdGhyb3c7CiAgICAgICAgY2xvc2VGdW5kaW5nKCk7CiAgICAgICAgaWYgKHJlY2lwaWVudCA9PSAwKSBGdW5kaW5nRnVlbGVkKEZ1bmRpbmdSdWxlc1swXS5wcm9wb3NhbElELCBGdW5kaW5nUnVsZXNbMF0uZnVuZGVkQW1vdW50KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWJsZVRyYW5zZmVyKCkgb25seUNsaWVudCB7CiAgICAgICAgaWYgKCF0cmFuc2ZlcmFibGUpIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgVHJhbnNmZXJBYmxlKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGRpc2FibGVUcmFuc2ZlcigpIG9ubHlDbGllbnQgewogICAgICAgIGlmICh0cmFuc2ZlcmFibGUpIHsKICAgICAgICAgICAgdHJhbnNmZXJhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIFRyYW5zZmVyRGlzYWJsZSgpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gYmxvY2tUcmFuc2ZlcihhZGRyZXNzIF9zaGFyZUhvbGRlciwgdWludCBfZGVhZExpbmUpIGV4dGVybmFsIG9ubHlDbGllbnQgb25seURhbyB7CiAgICAgICAgaWYgKF9kZWFkTGluZSA+IGJsb2NrZWREZWFkTGluZVtfc2hhcmVIb2xkZXJdKSB7CiAgICAgICAgICAgIGJsb2NrZWREZWFkTGluZVtfc2hhcmVIb2xkZXJdID0gX2RlYWRMaW5lOwogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tVG8oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwKICAgICAgICBhZGRyZXNzIF90bywgCiAgICAgICAgdWludDI1NiBfdmFsdWUKICAgICAgICApIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsgIAoKICAgICAgICBpZiAodHJhbnNmZXJhYmxlCiAgICAgICAgICAgICYmIG5vdyA+IGJsb2NrZWREZWFkTGluZVtfZnJvbV0KICAgICAgICAgICAgJiYgbm93ID4gYmxvY2tlZERlYWRMaW5lW190b10KICAgICAgICAgICAgJiYgX3RvICE9IGFkZHJlc3ModGhpcykKICAgICAgICAgICAgJiYgYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZQogICAgICAgICAgICAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXQogICAgICAgICAgICAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID49IF92YWx1ZQogICAgICAgICkgewogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfdG9dICs9IF92YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHsgIAogICAgICAgIGlmICghdHJhbnNmZXJGcm9tVG8obXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpKSB0aHJvdzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oCiAgICAgICAgYWRkcmVzcyBfZnJvbSwgCiAgICAgICAgYWRkcmVzcyBfdG8sIAogICAgICAgIHVpbnQyNTYgX3ZhbHVlCiAgICAgICAgKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsgCiAgICAgICAgCiAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX3ZhbHVlCiAgICAgICAgICAgIHx8ICF0cmFuc2ZlckZyb21UbyhfZnJvbSwgX3RvLCBfdmFsdWUpKSB0aHJvdzsKICAgICAgICAgICAgCiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gLT0gX3ZhbHVlOwoKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0gICAgCiAgCgpwcmFnbWEgc29saWRpdHkgXjAuNC4yOwoKLyoKICoKICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uCiAqCiAqIFRoZSBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IGlzIHVzZWQgZm9yIHRoZSBtYW5hZ2VtZW50IG9mIGFjY291bnRzIGFuZCB0b2tlbnMuCiAqIEFsbG93cyB0byByZWNlaXZlIG9yIHdpdGhkcmF3IGV0aGVycyBhbmQgdG8gYnV5IERhbyBzaGFyZXMuCiAqIFRoZSBjb250cmFjdCBkZXJpdmVzIHRvIHRoZSBUb2tlbiBNYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0IGZvciB0aGUgbWFuYWdlbWVudCBvZiB0b2tlbnMuCiAqCiAqIFJlY2lwaWVudCBpcyAwIGZvciB0aGUgRGFvIGFjY291bnQgbWFuYWdlciBhbmQgdGhlIGFkZHJlc3Mgb2YKICogY29udHJhY3RvcidzIHJlY2lwaWVudCBmb3IgdGhlIGNvbnRyYWN0b3JzJ3MgbWFoYWdlcnMuCiAqCiovCgovLy8gQHRpdGxlIE1hbmFnZXIgc21hcnQgY29udHJhY3Qgb2YgdGhlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbgpjb250cmFjdCBQYXNzTWFuYWdlckludGVyZmFjZSBpcyBQYXNzVG9rZW5NYW5hZ2VySW50ZXJmYWNlIHsKCiAgICBzdHJ1Y3QgcHJvcG9zYWwgewogICAgICAgIC8vIEFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwKICAgICAgICB1aW50IGFtb3VudDsKICAgICAgICAvLyBBIGRlc2NyaXB0aW9uIG9mIHRoZSBwcm9wb3NhbAogICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbjsKICAgICAgICAvLyBUaGUgaGFzaCBvZiB0aGUgcHJvcG9zYWwncyBkb2N1bWVudAogICAgICAgIGJ5dGVzMzIgaGFzaE9mVGhlRG9jdW1lbnQ7CiAgICAgICAgLy8gQSB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIGRhdGUgd2hlbiB0aGUgcHJvcG9zYWwgd2FzIGNyZWF0ZWQKICAgICAgICB1aW50IGRhdGVPZlByb3Bvc2FsOwogICAgICAgIC8vIFRoZSBzdW0gYW1vdW50IChpbiB3ZWkpIG9yZGVyZWQgZm9yIHRoaXMgcHJvcG9zYWwgCiAgICAgICAgdWludCBvcmRlckFtb3VudDsKICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSBvZiB0aGUgbGFzdCBvcmRlciBmb3IgdGhlIGFwcHJvdmVkIHByb3Bvc2FsCiAgICAgICAgdWludCBkYXRlT2ZPcmRlcjsKICAgIH0KICAgICAgICAKICAgIC8vIFByb3Bvc2FscyB0byB3b3JrIGZvciB0aGUgY2xpZW50CiAgICBwcm9wb3NhbFtdIHB1YmxpYyBwcm9wb3NhbHM7CiAgICAKICAgIC8vLyBAZGV2IFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbgogICAgLy8vIEBwYXJhbSBfY3JlYXRvciBUaGUgYWRkcmVzcyBvZiB0aGUgY3JlYXRvcgogICAgLy8vIEBwYXJhbSBfY2xpZW50IFRoZSBhZGRyZXNzIG9mIHRoZSBEYW8KICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50LiAwIGZvciB0aGUgRGFvCiAgICAvL2Z1bmN0aW9uIFBhc3NNYW5hZ2VyKAogICAgICAgIC8vYWRkcmVzcyBfY3JlYXRvciwKICAgICAgICAvL2FkZHJlc3MgX2NsaWVudCwKICAgICAgICAvL2FkZHJlc3MgX3JlY2lwaWVudAogICAgLy8pIFBhc3NUb2tlbk1hbmFnZXIoCiAgICAgICAgLy9fY3JlYXRvciwKICAgICAgICAvL19jbGllbnQsCiAgICAgICAgLy9fcmVjaXBpZW50KTsKCiAgICAvLy8gQG5vdGljZSBGYWxsYmFjayBmdW5jdGlvbiB0byBhbGxvdyBzZW5kaW5nIGV0aGVycyB0byB0aGlzIHNtYXJ0IGNvbnRyYWN0CiAgICBmdW5jdGlvbiAoKSBwYXlhYmxlOwogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byB1cGRhdGUgdGhlIHJlY2lwZW50IGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX25ld1JlY2lwaWVudCBUaGUgYWRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIGZ1bmN0aW9uIHVwZGF0ZVJlY2lwaWVudChhZGRyZXNzIF9uZXdSZWNpcGllbnQpOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGJ1eSBEYW8gc2hhcmVzIGFjY29yZGluZyB0byB0aGUgZnVuZGluZyBydWxlcyAKICAgIC8vLyB3aXRoIGBtc2cuc2VuZGVyYCBhcyB0aGUgYmVuZWZpY2lhcnkKICAgIGZ1bmN0aW9uIGJ1eVNoYXJlcygpIHBheWFibGU7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGJ1eSBEYW8gc2hhcmVzIGFjY29yZGluZyB0byB0aGUgZnVuZGluZyBydWxlcyAKICAgIC8vLyBAcGFyYW0gX3JlY2lwaWVudCBUaGUgYmVuZWZpY2lhcnkgb2YgdGhlIGNyZWF0ZWQgc2hhcmVzCiAgICBmdW5jdGlvbiBidXlTaGFyZXNGb3IoYWRkcmVzcyBfcmVjaXBpZW50KSBwYXlhYmxlOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIG1ha2UgYSBwcm9wb3NhbCB0byB3b3JrIGZvciB0aGUgY2xpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX2Rlc2NyaXB0aW9uIFN0cmluZyBkZXNjcmliaW5nIHRoZSBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfaGFzaE9mVGhlRG9jdW1lbnQgVGhlIGhhc2ggb2YgdGhlIHByb3Bvc2FsIGRvY3VtZW50CiAgICAvLy8gQHJldHVybiBUaGUgaW5kZXggb2YgdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwKICAgIGZ1bmN0aW9uIG5ld1Byb3Bvc2FsKAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLCAKICAgICAgICBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudAogICAgKSByZXR1cm5zICh1aW50KTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdXNlZCBieSB0aGUgY2xpZW50IHRvIG9yZGVyIGFjY29yZGluZyB0byB0aGUgY29udHJhY3RvciBwcm9wb3NhbAogICAgLy8vIEBwYXJhbSBfcHJvcG9zYWxJRCBUaGUgaW5kZXggb2YgdGhlIGNvbnRyYWN0b3IgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIG9mIHRoZSBvcmRlcgogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgb3JkZXIgd2FzIG1hZGUgb3Igbm90CiAgICBmdW5jdGlvbiBvcmRlcigKICAgICAgICB1aW50IF9wcm9wb3NhbElELAogICAgICAgIHVpbnQgX2Ftb3VudAogICAgKSBleHRlcm5hbCByZXR1cm5zIChib29sKSA7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHVzZWQgYnkgdGhlIGNsaWVudCB0byBzZW5kIGV0aGVycyBmcm9tIHRoZSBEYW8gbWFuYWdlcgogICAgLy8vIEBwYXJhbSBfcmVjaXBpZW50IFRoZSBhZGRyZXNzIHRvIHNlbmQgdG8KICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IChpbiB3ZWkpIHRvIHNlbmQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gc2VuZFRvKAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudCwgCiAgICAgICAgdWludCBfYW1vdW50CiAgICApIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGFsbG93IGNvbnRyYWN0b3JzIHRvIHdpdGhkcmF3IGV0aGVycwogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgKGluIHdlaSkgdG8gd2l0aGRyYXcKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgX2Ftb3VudCk7CiAgICAKICAgIGV2ZW50IFByb3Bvc2FsQWRkZWQodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgQW1vdW50LCBzdHJpbmcgRGVzY3JpcHRpb24pOwogICAgZXZlbnQgT3JkZXIodWludCBpbmRleGVkIFByb3Bvc2FsSUQsIHVpbnQgQW1vdW50KTsKICAgIGV2ZW50IFdpdGhkYXdhbChhZGRyZXNzIGluZGV4ZWQgUmVjaXBpZW50LCB1aW50IEFtb3VudCk7Cgp9ICAgIAoKY29udHJhY3QgUGFzc01hbmFnZXIgaXMgUGFzc01hbmFnZXJJbnRlcmZhY2UsIFBhc3NUb2tlbk1hbmFnZXIgewoKICAgIGZ1bmN0aW9uIFBhc3NNYW5hZ2VyKAogICAgICAgIGFkZHJlc3MgX2NyZWF0b3IsCiAgICAgICAgYWRkcmVzcyBfY2xpZW50LAogICAgICAgIGFkZHJlc3MgX3JlY2lwaWVudAogICAgKSBQYXNzVG9rZW5NYW5hZ2VyKAogICAgICAgIF9jcmVhdG9yLAogICAgICAgIF9jbGllbnQsCiAgICAgICAgX3JlY2lwaWVudAogICAgICAgICkgewogICAgICAgIHByb3Bvc2Fscy5sZW5ndGggPSAxOwogICAgfQoKICAgIGZ1bmN0aW9uICgpIHBheWFibGUge30KCiAgICBmdW5jdGlvbiB1cGRhdGVSZWNpcGllbnQoYWRkcmVzcyBfbmV3UmVjaXBpZW50KSBvbmx5Q29udHJhY3RvciB7CgogICAgICAgIGlmIChfbmV3UmVjaXBpZW50ID09IDAgCiAgICAgICAgICAgIHx8IF9uZXdSZWNpcGllbnQgPT0gY2xpZW50KSB0aHJvdzsKCiAgICAgICAgcmVjaXBpZW50ID0gX25ld1JlY2lwaWVudDsKICAgIH0gCgogICAgZnVuY3Rpb24gYnV5U2hhcmVzKCkgcGF5YWJsZSB7CiAgICAgICAgYnV5U2hhcmVzRm9yKG1zZy5zZW5kZXIpOwogICAgfSAKICAgIAogICAgZnVuY3Rpb24gYnV5U2hhcmVzRm9yKGFkZHJlc3MgX3JlY2lwaWVudCkgcGF5YWJsZSBvbmx5RGFvIHsKICAgICAgICAKICAgICAgICBpZiAoIUZ1bmRpbmdSdWxlc1swXS5wdWJsaWNDcmVhdGlvbiAKICAgICAgICAgICAgfHwgIWNyZWF0ZVRva2VuKF9yZWNpcGllbnQsIG1zZy52YWx1ZSwgbm93KSkgdGhyb3c7CgogICAgfQogICAKICAgIGZ1bmN0aW9uIG5ld1Byb3Bvc2FsKAogICAgICAgIHVpbnQgX2Ftb3VudCwKICAgICAgICBzdHJpbmcgX2Rlc2NyaXB0aW9uLCAKICAgICAgICBieXRlczMyIF9oYXNoT2ZUaGVEb2N1bWVudAogICAgKSBvbmx5Q29udHJhY3RvciByZXR1cm5zICh1aW50KSB7CgogICAgICAgIHVpbnQgX3Byb3Bvc2FsSUQgPSBwcm9wb3NhbHMubGVuZ3RoKys7CiAgICAgICAgcHJvcG9zYWwgYyA9IHByb3Bvc2Fsc1tfcHJvcG9zYWxJRF07CgogICAgICAgIGMuYW1vdW50ID0gX2Ftb3VudDsKICAgICAgICBjLmRlc2NyaXB0aW9uID0gX2Rlc2NyaXB0aW9uOwogICAgICAgIGMuaGFzaE9mVGhlRG9jdW1lbnQgPSBfaGFzaE9mVGhlRG9jdW1lbnQ7IAogICAgICAgIGMuZGF0ZU9mUHJvcG9zYWwgPSBub3c7CiAgICAgICAgCiAgICAgICAgUHJvcG9zYWxBZGRlZChfcHJvcG9zYWxJRCwgYy5hbW91bnQsIGMuZGVzY3JpcHRpb24pOwogICAgICAgIAogICAgICAgIHJldHVybiBfcHJvcG9zYWxJRDsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JkZXIoCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwKICAgICAgICB1aW50IF9vcmRlckFtb3VudAogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IHJldHVybnMgKGJvb2wpIHsKICAgIAogICAgICAgIHByb3Bvc2FsIGMgPSBwcm9wb3NhbHNbX3Byb3Bvc2FsSURdOwogICAgICAgIAogICAgICAgIHVpbnQgX3N1bSA9IGMub3JkZXJBbW91bnQgKyBfb3JkZXJBbW91bnQ7CiAgICAgICAgaWYgKF9zdW0gPiBjLmFtb3VudAogICAgICAgICAgICB8fCBfc3VtIDwgYy5vcmRlckFtb3VudAogICAgICAgICAgICB8fCBfc3VtIDwgX29yZGVyQW1vdW50KSByZXR1cm47IAoKICAgICAgICBjLm9yZGVyQW1vdW50ID0gX3N1bTsKICAgICAgICBjLmRhdGVPZk9yZGVyID0gbm93OwogICAgICAgIAogICAgICAgIE9yZGVyKF9wcm9wb3NhbElELCBfb3JkZXJBbW91bnQpOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZW5kVG8oCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50LAogICAgICAgIHVpbnQgX2Ftb3VudAogICAgKSBleHRlcm5hbCBvbmx5Q2xpZW50IG9ubHlEYW8gcmV0dXJucyAoYm9vbCkgewogICAgCiAgICAgICAgaWYgKF9yZWNpcGllbnQuc2VuZChfYW1vdW50KSkgcmV0dXJuIHRydWU7CiAgICAgICAgZWxzZSByZXR1cm4gZmFsc2U7CgogICAgfQogICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgX2Ftb3VudCkgb25seUNvbnRyYWN0b3IgewogICAgICAgIGlmICghcmVjaXBpZW50LnNlbmQoX2Ftb3VudCkpIHRocm93OwogICAgICAgIFdpdGhkYXdhbChyZWNpcGllbnQsIF9hbW91bnQpOwogICAgfQogICAgCn0gICAgCgpjb250cmFjdCBQYXNzTWFuYWdlckNyZWF0b3IgewogICAgZXZlbnQgTmV3UGFzc01hbmFnZXIoYWRkcmVzcyBDcmVhdG9yLCBhZGRyZXNzIENsaWVudCwgYWRkcmVzcyBSZWNpcGllbnQsIGFkZHJlc3MgUGFzc01hbmFnZXIpOwogICAgZnVuY3Rpb24gY3JlYXRlTWFuYWdlcigKICAgICAgICBhZGRyZXNzIF9jbGllbnQsCiAgICAgICAgYWRkcmVzcyBfcmVjaXBpZW50CiAgICAgICAgKSByZXR1cm5zIChQYXNzTWFuYWdlcikgewogICAgICAgIFBhc3NNYW5hZ2VyIF9wYXNzTWFuYWdlciA9IG5ldyBQYXNzTWFuYWdlcigKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2NsaWVudCwKICAgICAgICAgICAgX3JlY2lwaWVudAogICAgICAgICk7CiAgICAgICAgTmV3UGFzc01hbmFnZXIobXNnLnNlbmRlciwgX2NsaWVudCwgX3JlY2lwaWVudCwgX3Bhc3NNYW5hZ2VyKTsKICAgICAgICByZXR1cm4gX3Bhc3NNYW5hZ2VyOwogICAgfQp9CgpwcmFnbWEgc29saWRpdHkgXjAuNC4yOwoKLyoKVGhpcyBmaWxlIGlzIHBhcnQgb2YgUGFzcyBEQU8uCgpQYXNzIERBTyBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5Cml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIGxlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQp0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgooYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoKUGFzcyBEQU8gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQpHTlUgbGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBsZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQphbG9uZyB3aXRoIFBhc3MgREFPLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgoqLwoKLyoKU21hcnQgY29udHJhY3QgZm9yIGEgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXphdGlvbiAoREFPKQp0byBhdXRvbWF0ZSBvcmdhbml6YXRpb25hbCBnb3Zlcm5hbmNlIGFuZCBkZWNpc2lvbi1tYWtpbmcuCiovCgovLy8gQHRpdGxlIFBhc3MgRGVjZW50cmFsaXplZCBBdXRvbm9tb3VzIE9yZ2FuaXNhdGlvbgpjb250cmFjdCBQYXNzRGFvSW50ZXJmYWNlIHsKCiAgICBzdHJ1Y3QgQm9hcmRNZWV0aW5nIHsgICAgICAgIAogICAgICAgIC8vIEFkZHJlc3Mgb2YgdGhlIGNyZWF0b3Igb2YgdGhlIGJvYXJkIG1lZXRpbmcgZm9yIGEgcHJvcG9zYWwKICAgICAgICBhZGRyZXNzIGNyZWF0b3I7ICAKICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSB0aGUgcHJvcG9zYWwgdG8gcGF5IGEgY29udHJhY3RvciBvciBmdW5kIHRoZSBEYW8KICAgICAgICB1aW50IHByb3Bvc2FsSUQ7CiAgICAgICAgLy8gSW5kZXggdG8gaWRlbnRpZnkgdGhlIHByb3Bvc2FsIHRvIHVwZGF0ZSB0aGUgRGFvIHJ1bGVzIAogICAgICAgIHVpbnQgZGFvUnVsZXNQcm9wb3NhbElEOyAKICAgICAgICAvLyB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIGVuZCBvZiB0aGUgc2V0IHBlcmlvZCBvZiBhIHByb3Bvc2FsIGJlZm9yZSB0aGUgYm9hcmQgbWVldGluZyAKICAgICAgICB1aW50IHNldERlYWRsaW5lOwogICAgICAgIC8vIEZlZXMgKGluIHdlaSkgcGFpZCBieSB0aGUgY3JlYXRvciBvZiB0aGUgYm9hcmQgbWVldGluZwogICAgICAgIHVpbnQgZmVlczsKICAgICAgICAvLyBUb3RhbCBvZiBmZWVzIChpbiB3ZWkpIHJld2FyZGVkIHRvIHRoZSB2b3RlcnMgb3IgdG8gdGhlIERhbyBhY2NvdW50IG1hbmFnZXIgZm9yIHRoZSBiYWxhbmNlCiAgICAgICAgdWludCB0b3RhbFJld2FyZGVkQW1vdW50OwogICAgICAgIC8vIEEgdW5peCB0aW1lc3RhbXAsIGRlbm90aW5nIHRoZSBlbmQgb2YgdGhlIHZvdGluZyBwZXJpb2QKICAgICAgICB1aW50IHZvdGluZ0RlYWRsaW5lOwogICAgICAgIC8vIFRydWUgaWYgdGhlIHByb3Bvc2FsJ3Mgdm90ZXMgaGF2ZSB5ZXQgdG8gYmUgY291bnRlZCwgb3RoZXJ3aXNlIEZhbHNlCiAgICAgICAgYm9vbCBvcGVuOyAKICAgICAgICAvLyBBIHVuaXggdGltZXN0YW1wLCBkZW5vdGluZyB0aGUgZGF0ZSBvZiB0aGUgZXhlY3V0aW9uIG9mIHRoZSBhcHByb3ZlZCBwcm9wb3NhbAogICAgICAgIHVpbnQgZGF0ZU9mRXhlY3V0aW9uOwogICAgICAgIC8vIE51bWJlciBvZiBzaGFyZXMgaW4gZmF2b3Igb2YgdGhlIHByb3Bvc2FsCiAgICAgICAgdWludCB5ZWE7IAogICAgICAgIC8vIE51bWJlciBvZiBzaGFyZXMgb3Bwb3NlZCB0byB0aGUgcHJvcG9zYWwKICAgICAgICB1aW50IG5heTsgCiAgICAgICAgLy8gbWFwcGluZyB0byBpbmRpY2F0ZSBpZiBhIHNoYXJlaG9sZGVyIGhhcyB2b3RlZAogICAgICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgaGFzVm90ZWQ7ICAKICAgIH0KCiAgICBzdHJ1Y3QgUHJvcG9zYWwgewogICAgICAgIC8vIEluZGV4IHRvIGlkZW50aWZ5IHRoZSBib2FyZCBtZWV0aW5nIG9mIHRoZSBwcm9wb3NhbAogICAgICAgIHVpbnQgYm9hcmRNZWV0aW5nSUQ7CiAgICAgICAgLy8gVGhlIGNvbnRyYWN0b3IgbWFuYWdlciBzbWFydCBjb250cmFjdAogICAgICAgIFBhc3NNYW5hZ2VyIGNvbnRyYWN0b3JNYW5hZ2VyOwogICAgICAgIC8vIFRoZSBpbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbAogICAgICAgIHVpbnQgY29udHJhY3RvclByb3Bvc2FsSUQ7CiAgICAgICAgLy8gVGhlIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwKICAgICAgICB1aW50IGFtb3VudDsgCiAgICAgICAgLy8gVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgZm9yZXNlZXMgYSBjb250cmFjdG9yIHRva2VuIGNyZWF0aW9uCiAgICAgICAgYm9vbCB0b2tlbkNyZWF0aW9uOwogICAgICAgIC8vIFRydWUgaWYgcHVibGljIGZ1bmRpbmcgd2l0aG91dCBhIG1haW4gcGFydG5lcgogICAgICAgIGJvb2wgcHVibGljU2hhcmVDcmVhdGlvbjsgCiAgICAgICAgLy8gVGhlIGFkZHJlc3Mgd2hpY2ggc2V0cyBwYXJ0bmVycyBhbmQgbWFuYWdlcyB0aGUgZnVuZGluZyBpbiBjYXNlIG9mIHByaXZhdGUgZnVuZGluZwogICAgICAgIGFkZHJlc3MgbWFpblBhcnRuZXI7CiAgICAgICAgLy8gVGhlIGluaXRpYWwgcHJpY2UgbXVsdGlwbGllciBvZiBEYW8gc2hhcmVzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IGluaXRpYWxTaGFyZVByaWNlTXVsdGlwbGllcjsgCiAgICAgICAgLy8gVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgYWN0dWFsIGNvbnRyYWN0b3Igc2hhcmUgcHJpY2UKICAgICAgICB1aW50IGluZmxhdGlvblJhdGU7CiAgICAgICAgLy8gQSB1bml4IHRpbWVzdGFtcCwgZGVub3RpbmcgdGhlIHN0YXJ0IHRpbWUgb2YgdGhlIGZ1bmRpbmcKICAgICAgICB1aW50IG1pbnV0ZXNGdW5kaW5nUGVyaW9kOwogICAgICAgIC8vIFRydWUgaWYgdGhlIHByb3Bvc2FsIGlzIGNsb3NlZAogICAgICAgIGJvb2wgb3BlbjsgCiAgICB9CgogICAgc3RydWN0IFJ1bGVzIHsKICAgICAgICAvLyBJbmRleCB0byBpZGVudGlmeSB0aGUgYm9hcmQgbWVldGluZyB0aGF0IGRlY2lkZXMgdG8gYXBwbHkgb3Igbm90IHRoZSBEYW8gcnVsZXMKICAgICAgICB1aW50IGJvYXJkTWVldGluZ0lEOyAgCiAgICAgICAgLy8gVGhlIHF1b3J1bSBuZWVkZWQgZm9yIGVhY2ggcHJvcG9zYWwgaXMgY2FsY3VsYXRlZCBieSB0b3RhbFN1cHBseSAvIG1pblF1b3J1bURpdmlzb3IKICAgICAgICB1aW50IG1pblF1b3J1bURpdmlzb3I7ICAKICAgICAgICAvLyBNaW5pbXVtIGZlZXMgKGluIHdlaSkgdG8gY3JlYXRlIGEgcHJvcG9zYWwKICAgICAgICB1aW50IG1pbkJvYXJkTWVldGluZ0ZlZXM7IAogICAgICAgIC8vIFBlcmlvZCBpbiBtaW51dGVzIHRvIGNvbnNpZGVyIG9yIHNldCBhIHByb3Bvc2FsIGJlZm9yZSB0aGUgdm90aW5nIHByb2NlZHVyZQogICAgICAgIHVpbnQgbWludXRlc1NldFByb3Bvc2FsUGVyaW9kOyAKICAgICAgICAvLyBUaGUgbWluaW11bSBkZWJhdGUgcGVyaW9kIGluIG1pbnV0ZXMgdGhhdCBhIGdlbmVyaWMgcHJvcG9zYWwgY2FuIGhhdmUKICAgICAgICB1aW50IG1pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7CiAgICAgICAgLy8gVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGJvYXJkIG1lZXRpbmcgCiAgICAgICAgdWludCBmZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZTsKICAgICAgICAvLyBUcnVlIGlmIHRoZSBkYW8gcnVsZXMgYWxsb3cgdGhlIHRyYW5zZmVyIG9mIHNoYXJlcwogICAgICAgIGJvb2wgdHJhbnNmZXJhYmxlOwogICAgfSAKCiAgICAvLyBUaGUgY3JlYXRvciBvZiB0aGUgRGFvCiAgICBhZGRyZXNzIGNyZWF0b3I7CiAgICAvLyBUaGUgbWluaW11bSBwZXJpb2RzIGluIG1pbnV0ZXMgCiAgICB1aW50IHB1YmxpYyBtaW5NaW51dGVzUGVyaW9kczsKICAgIC8vIFRoZSBtYXhpbXVtIHBlcmlvZCBpbiBtaW51dGVzIGZvciBwcm9wb3NhbHMgKHNldCtkZWJhdGUpCiAgICB1aW50IHB1YmxpYyBtYXhNaW51dGVzUHJvcG9zYWxQZXJpb2Q7CiAgICAvLyBUaGUgbWF4aW11bSBmdW5kaW5nIHBlcmlvZCBpbiBtaW51dGVzIGZvciBmdW5kaW5nIHByb3Bvc2FscwogICAgdWludCBwdWJsaWMgbWF4TWludXRlc0Z1bmRpbmdQZXJpb2Q7CiAgICAvLyBUaGUgbWF4aW11bSBpbmZsYXRpb24gcmF0ZSBmb3Igc2hhcmUgcHJpY2Ugb3IgcmV3YXJkcyB0byB2b3RlcnMKICAgIHVpbnQgcHVibGljIG1heEluZmxhdGlvblJhdGU7CgogICAgLy8gVGhlIERhbyBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0CiAgICBQYXNzTWFuYWdlciBwdWJsaWMgZGFvTWFuYWdlcjsKICAgIAogICAgLy8gTWFwIHRvIGFsbG93IHRoZSBzaGFyZSBob2xkZXJzIHRvIHdpdGhkcmF3IGJvYXJkIG1lZXRpbmcgZmVlcwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwdWJsaWMgcGVuZGluZ0ZlZXNXaXRoZHJhd2FsczsKCiAgICAvLyBCb2FyZCBtZWV0aW5ncyB0byB2b3RlIGZvciBvciBhZ2FpbnN0IGEgcHJvcG9zYWwKICAgIEJvYXJkTWVldGluZ1tdIHB1YmxpYyBCb2FyZE1lZXRpbmdzOyAKICAgIC8vIFByb3Bvc2FscyB0byBwYXkgYSBjb250cmFjdG9yIG9yIGZ1bmQgdGhlIERhbwogICAgUHJvcG9zYWxbXSBwdWJsaWMgUHJvcG9zYWxzOwogICAgLy8gUHJvcG9zYWxzIHRvIHVwZGF0ZSB0aGUgRGFvIHJ1bGVzCiAgICBSdWxlc1tdIHB1YmxpYyBEYW9SdWxlc1Byb3Bvc2FsczsKICAgIC8vIFRoZSBjdXJyZW50IERhbyBydWxlcwogICAgUnVsZXMgcHVibGljIERhb1J1bGVzOyAKICAgIAogICAgLy8vIEBkZXYgVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgICAvL2Z1bmN0aW9uIFBhc3NEYW8oKTsKCiAgICAvLy8gQGRldiBGdW5jdGlvbiB0byBpbml0aWFsaXplIHRoZSBEYW8KICAgIC8vLyBAcGFyYW0gX2Rhb01hbmFnZXIgQWRkcmVzcyBvZiB0aGUgRGFvIG1hbmFnZXIgc21hcnQgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX21heEluZmxhdGlvblJhdGUgVGhlIG1heGltdW0gaW5mbGF0aW9uIHJhdGUgZm9yIGNvbnRyYWN0b3IgYW5kIGZ1bmRpbmcgcHJvcG9zYWxzCiAgICAvLy8gQHBhcmFtIF9taW5NaW51dGVzUGVyaW9kcyBUaGUgbWluaW11bSBwZXJpb2RzIGluIG1pbnV0ZXMKICAgIC8vLyBAcGFyYW0gX21heE1pbnV0ZXNGdW5kaW5nUGVyaW9kIFRoZSBtYXhpbXVtIGZ1bmRpbmcgcGVyaW9kIGluIG1pbnV0ZXMgZm9yIGZ1bmRpbmcgcHJvcG9zYWxzCiAgICAvLy8gQHBhcmFtIF9tYXhNaW51dGVzUHJvcG9zYWxQZXJpb2QgVGhlIG1heGltdW0gcGVyaW9kIGluIG1pbnV0ZXMgZm9yIHByb3Bvc2FscyAoc2V0K2RlYmF0ZSkKICAgIC8vLyBAcGFyYW0gX21pblF1b3J1bURpdmlzb3IgVGhlIGluaXRpYWwgbWluaW11bSBxdW9ydW0gZGl2aXNvciBmb3IgdGhlIHByb3Bvc2FscwogICAgLy8vIEBwYXJhbSBfbWluQm9hcmRNZWV0aW5nRmVlcyBUaGUgYW1vdW50IChpbiB3ZWkpIHRvIG1ha2UgYSBwcm9wb3NhbCBhbmQgYXNrIGZvciBhIGJvYXJkIG1lZXRpbmcKICAgIC8vLyBAcGFyYW0gX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCBUaGUgbWluaW11bSBwZXJpb2QgaW4gbWludXRlcyBiZWZvcmUgYSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHBhcmFtIF9taW5NaW51dGVzRGViYXRlUGVyaW9kIFRoZSBtaW5pbXVtIHBlcmlvZCBpbiBtaW51dGVzIG9mIHRoZSBib2FyZCBtZWV0aW5ncwogICAgLy8vIEBwYXJhbSBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgVGhlIGluZmxhdGlvbiByYXRlIHRvIGNhbGN1bGF0ZSB0aGUgcmV3YXJkIG9mIGZlZXMgdG8gdm90ZXJzIGR1cmluZyBhIGJvYXJkIG1lZXRpbmcKICAgIGZ1bmN0aW9uIGluaXREYW8oCiAgICAgICAgYWRkcmVzcyBfZGFvTWFuYWdlciwKICAgICAgICB1aW50IF9tYXhJbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX21pbk1pbnV0ZXNQZXJpb2RzLAogICAgICAgIHVpbnQgX21heE1pbnV0ZXNGdW5kaW5nUGVyaW9kLAogICAgICAgIHVpbnQgX21heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZCwKICAgICAgICB1aW50IF9taW5RdW9ydW1EaXZpc29yLAogICAgICAgIHVpbnQgX21pbkJvYXJkTWVldGluZ0ZlZXMsCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLAogICAgICAgIHVpbnQgX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QsCiAgICAgICAgdWludCBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUKICAgICAgICApOwogICAgCiAgICAvLy8gQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byBjcmVhdGUgYSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHBhcmFtIF9wcm9wb3NhbElEIFRoZSBpbmRleCBvZiB0aGUgcHJvcG9zYWwgaWYgZm9yIGEgY29udHJhY3RvciBvciBmb3IgYSBmdW5kaW5nCiAgICAvLy8gQHBhcmFtIF9kYW9SdWxlc1Byb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbCBpZiBEYW8gcnVsZXMKICAgIC8vLyBAcGFyYW0gX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCBUaGUgZHVyYXRpb24gaW4gbWludXRlcyBvZiB0aGUgbWVldGluZwogICAgLy8vIEByZXR1cm4gdGhlIGluZGV4IG9mIHRoZSBib2FyZCBtZWV0aW5nCiAgICBmdW5jdGlvbiBuZXdCb2FyZE1lZXRpbmcoCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwgCiAgICAgICAgdWludCBfZGFvUnVsZXNQcm9wb3NhbElELCAKICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QKICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludCk7CiAgICAKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIG1ha2UgYSBwcm9wb3NhbCB0byBwYXkgYSBjb250cmFjdG9yIG9yIGZ1bmQgdGhlIERhbwogICAgLy8vIEBwYXJhbSBfY29udHJhY3Rvck1hbmFnZXIgQWRkcmVzcyBvZiB0aGUgY29udHJhY3RvciBtYW5hZ2VyIHNtYXJ0IGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9jb250cmFjdG9yUHJvcG9zYWxJRCBJbmRleCBvZiB0aGUgY29udHJhY3RvciBwcm9wb3NhbCBvZiB0aGUgY29udHJhY3RvciBtYW5hZ2VyCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCAoaW4gd2VpKSBvZiB0aGUgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX3Rva2VuQ3JlYXRpb24gVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgZm9yZXNlZXMgYSBjb250cmFjdG9yIHRva2VuIGNyZWF0aW9uCiAgICAvLy8gQHBhcmFtIF9wdWJsaWNTaGFyZUNyZWF0aW9uIFRydWUgaWYgcHVibGljIGZ1bmRpbmcgd2l0aG91dCBhIG1haW4gcGFydG5lcgogICAgLy8vIEBwYXJhbSBfbWFpblBhcnRuZXIgVGhlIGFkZHJlc3Mgd2hpY2ggc2V0cyBwYXJ0bmVycyBhbmQgbWFuYWdlIHRoZSBmdW5kaW5nIAogICAgLy8vIGluIGNhc2Ugb2YgcHJpdmF0ZSBmdW5kaW5nIChub3QgbWFuZGF0b3J5KQogICAgLy8vIEBwYXJhbSBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyIFRoZSBpbml0aWFsIHByaWNlIG11bHRpcGxpZXIgb2Ygc2hhcmVzCiAgICAvLy8gQHBhcmFtIF9pbmZsYXRpb25SYXRlIElmIDAsIHRoZSBzaGFyZSBwcmljZSBkb2Vzbid0IGNoYW5nZSBkdXJpbmcgdGhlIGZ1bmRpbmcgKG5vdCBtYW5kYXRvcnkpCiAgICAvLy8gQHBhcmFtIF9taW51dGVzRnVuZGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgZnVuZGluZwogICAgLy8vIEBwYXJhbSBfbWludXRlc0RlYmF0aW5nUGVyaW9kIFBlcmlvZCBpbiBtaW51dGVzIG9mIHRoZSBib2FyZCBtZWV0aW5nIHRvIHZvdGUgb24gdGhlIHByb3Bvc2FsCiAgICAvLy8gQHJldHVybiBUaGUgaW5kZXggb2YgdGhlIHByb3Bvc2FsCiAgICBmdW5jdGlvbiBuZXdQcm9wb3NhbCgKICAgICAgICBhZGRyZXNzIF9jb250cmFjdG9yTWFuYWdlciwKICAgICAgICB1aW50IF9jb250cmFjdG9yUHJvcG9zYWxJRCwKICAgICAgICB1aW50IF9hbW91bnQsIAogICAgICAgIGJvb2wgX3B1YmxpY1NoYXJlQ3JlYXRpb24sCiAgICAgICAgYm9vbCBfdG9rZW5DcmVhdGlvbiwKICAgICAgICBhZGRyZXNzIF9tYWluUGFydG5lciwKICAgICAgICB1aW50IF9pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIsIAogICAgICAgIHVpbnQgX2luZmxhdGlvblJhdGUsCiAgICAgICAgdWludCBfbWludXRlc0Z1bmRpbmdQZXJpb2QsCiAgICAgICAgdWludCBfbWludXRlc0RlYmF0aW5nUGVyaW9kCiAgICApIHBheWFibGUgcmV0dXJucyAodWludCk7CgogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gbWFrZSBhIHByb3Bvc2FsIHRvIGNoYW5nZSB0aGUgRGFvIHJ1bGVzIAogICAgLy8vIEBwYXJhbSBfbWluUXVvcnVtRGl2aXNvciBJZiA1LCB0aGUgbWluaW11bSBxdW9ydW0gaXMgMjAlCiAgICAvLy8gQHBhcmFtIF9taW5Cb2FyZE1lZXRpbmdGZWVzIFRoZSBhbW91bnQgKGluIHdlaSkgdG8gbWFrZSBhIHByb3Bvc2FsIGFuZCBhc2sgZm9yIGEgYm9hcmQgbWVldGluZwogICAgLy8vIEBwYXJhbSBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kIE1pbmltdW0gcGVyaW9kIGluIG1pbnV0ZXMgYmVmb3JlIGEgYm9hcmQgbWVldGluZwogICAgLy8vIEBwYXJhbSBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCBUaGUgbWluaW11bSBwZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgYm9hcmQgbWVldGluZ3MKICAgIC8vLyBAcGFyYW0gX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlIFRoZSBpbmZsYXRpb24gcmF0ZSB0byBjYWxjdWxhdGUgdGhlIHJld2FyZCBvZiBmZWVzIHRvIHZvdGVycyBkdXJpbmcgYSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHBhcmFtIF90cmFuc2ZlcmFibGUgVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgZm9yZXNlZXMgdG8gYWxsb3cgdGhlIHRyYW5zZmVyIG9mIERhbyBzaGFyZXMKICAgIC8vLyBAcGFyYW0gX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCBQZXJpb2QgaW4gbWludXRlcyBvZiB0aGUgYm9hcmQgbWVldGluZyB0byB2b3RlIG9uIHRoZSBwcm9wb3NhbAogICAgZnVuY3Rpb24gbmV3RGFvUnVsZXNQcm9wb3NhbCgKICAgICAgICB1aW50IF9taW5RdW9ydW1EaXZpc29yLCAKICAgICAgICB1aW50IF9taW5Cb2FyZE1lZXRpbmdGZWVzLAogICAgICAgIHVpbnQgX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCwKICAgICAgICB1aW50IF9taW5NaW51dGVzRGViYXRlUGVyaW9kLAogICAgICAgIHVpbnQgX2ZlZXNSZXdhcmRJbmZsYXRpb25SYXRlLAogICAgICAgIGJvb2wgX3RyYW5zZmVyYWJsZSwKICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QKICAgICkgcGF5YWJsZSByZXR1cm5zICh1aW50KTsKICAgIAogICAgLy8vIEBub3RpY2UgRnVuY3Rpb24gdG8gdm90ZSBkdXJpbmcgYSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHBhcmFtIF9ib2FyZE1lZXRpbmdJRCBUaGUgaW5kZXggb2YgdGhlIGJvYXJkIG1lZXRpbmcKICAgIC8vLyBAcGFyYW0gX3N1cHBvcnRzUHJvcG9zYWwgVHJ1ZSBpZiB0aGUgcHJvcG9zYWwgaXMgc3VwcG9ydGVkCiAgICBmdW5jdGlvbiB2b3RlKAogICAgICAgIHVpbnQgX2JvYXJkTWVldGluZ0lELCAKICAgICAgICBib29sIF9zdXBwb3J0c1Byb3Bvc2FsCiAgICApOwoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgYSBib2FyZCBtZWV0aW5nIGRlY2lzaW9uIGFuZCBjbG9zZSB0aGUgYm9hcmQgbWVldGluZwogICAgLy8vIEBwYXJhbSBfYm9hcmRNZWV0aW5nSUQgVGhlIGluZGV4IG9mIHRoZSBib2FyZCBtZWV0aW5nCiAgICAvLy8gQHJldHVybiBXaGV0aGVyIHRoZSBwcm9wb3NhbCB3YXMgZXhlY3V0ZWQgb3Igbm90CiAgICBmdW5jdGlvbiBleGVjdXRlRGVjaXNpb24odWludCBfYm9hcmRNZWV0aW5nSUQpIHJldHVybnMgKGJvb2wpOwogICAgCiAgICAvLy8gQG5vdGljZSBGdW5jdGlvbiB0byBvcmRlciBhIGNvbnRyYWN0b3IgcHJvcG9zYWwKICAgIC8vLyBAcGFyYW0gX3Byb3Bvc2FsSUQgVGhlIGluZGV4IG9mIHRoZSBwcm9wb3NhbAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgcHJvcG9zYWwgd2FzIG9yZGVyZWQgYW5kIHRoZSBwcm9wb3NhbCBhbW91bnQgc2VudCBvciBub3QKICAgIGZ1bmN0aW9uIG9yZGVyQ29udHJhY3RvclByb3Bvc2FsKHVpbnQgX3Byb3Bvc2FsSUQpIHJldHVybnMgKGJvb2wpOyAgIAoKICAgIC8vLyBAbm90aWNlIEZ1bmN0aW9uIHRvIHdpdGhkcmF3IHRoZSByZXdhcmRlZCBib2FyZCBtZWV0aW5nIGZlZXMKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHdpdGhkcmF3IHdhcyBzdWNjZXNzZnVsIG9yIG5vdCAgICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3Qm9hcmRNZWV0aW5nRmVlcygpIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAcmV0dXJuIFRoZSBtaW5pbXVtIHF1b3J1bSBmb3IgcHJvcG9zYWxzIHRvIHBhc3MgCiAgICBmdW5jdGlvbiBtaW5RdW9ydW0oKSBjb25zdGFudCByZXR1cm5zICh1aW50KTsKICAgIAogICAgZXZlbnQgUHJvcG9zYWxBZGRlZCh1aW50IGluZGV4ZWQgUHJvcG9zYWxJRCwgYWRkcmVzcyBpbmRleGVkIENvbnRyYWN0b3JNYW5hZ2VyLCB1aW50IENvbnRyYWN0b3JQcm9wb3NhbElELCAKICAgICAgICAgICAgdWludCBhbW91bnQsIGFkZHJlc3MgaW5kZXhlZCBNYWluUGFydG5lciwgdWludCBJbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIsIHVpbnQgTWludXRlc0Z1bmRpbmdQZXJpb2QpOwogICAgZXZlbnQgRGFvUnVsZXNQcm9wb3NhbEFkZGVkKHVpbnQgaW5kZXhlZCBEYW9SdWxlc1Byb3Bvc2FsSUQsIHVpbnQgTWluUXVvcnVtRGl2aXNvciwgdWludCBNaW5Cb2FyZE1lZXRpbmdGZWVzLCAKICAgICAgICAgICAgdWludCBNaW51dGVzU2V0UHJvcG9zYWxQZXJpb2QsIHVpbnQgTWluTWludXRlc0RlYmF0ZVBlcmlvZCwgdWludCBGZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSwgYm9vbCBUcmFuc2ZlcmFibGUpOwogICAgZXZlbnQgU2VudFRvQ29udHJhY3Rvcih1aW50IGluZGV4ZWQgQ29udHJhY3RvclByb3Bvc2FsSUQsIGFkZHJlc3MgaW5kZXhlZCBDb250cmFjdG9yTWFuYWdlckFkZHJlc3MsIHVpbnQgQW1vdW50U2VudCk7CiAgICBldmVudCBCb2FyZE1lZXRpbmdDbG9zZWQodWludCBpbmRleGVkIEJvYXJkTWVldGluZ0lELCB1aW50IEZlZXNHaXZlbkJhY2ssIGJvb2wgUHJvcG9zYWxFeGVjdXRlZCk7CiAgICAKfQoKY29udHJhY3QgUGFzc0RhbyBpcyBQYXNzRGFvSW50ZXJmYWNlIHsKCiAgICBmdW5jdGlvbiBQYXNzRGFvKCkge30KICAgIAogICAgZnVuY3Rpb24gaW5pdERhbygKICAgICAgICBhZGRyZXNzIF9kYW9NYW5hZ2VyLAogICAgICAgIHVpbnQgX21heEluZmxhdGlvblJhdGUsCiAgICAgICAgdWludCBfbWluTWludXRlc1BlcmlvZHMsCiAgICAgICAgdWludCBfbWF4TWludXRlc0Z1bmRpbmdQZXJpb2QsCiAgICAgICAgdWludCBfbWF4TWludXRlc1Byb3Bvc2FsUGVyaW9kLAogICAgICAgIHVpbnQgX21pblF1b3J1bURpdmlzb3IsCiAgICAgICAgdWludCBfbWluQm9hcmRNZWV0aW5nRmVlcywKICAgICAgICB1aW50IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QsCiAgICAgICAgdWludCBfbWluTWludXRlc0RlYmF0ZVBlcmlvZCwKICAgICAgICB1aW50IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZQogICAgICAgICkgewogICAgICAgICAgICAKICAgICAgICAKICAgICAgICBpZiAoRGFvUnVsZXMubWluUXVvcnVtRGl2aXNvciAhPSAwKSB0aHJvdzsKCiAgICAgICAgZGFvTWFuYWdlciA9IFBhc3NNYW5hZ2VyKF9kYW9NYW5hZ2VyKTsKCiAgICAgICAgbWF4SW5mbGF0aW9uUmF0ZSA9IF9tYXhJbmZsYXRpb25SYXRlOwogICAgICAgIG1pbk1pbnV0ZXNQZXJpb2RzID0gX21pbk1pbnV0ZXNQZXJpb2RzOwogICAgICAgIG1heE1pbnV0ZXNGdW5kaW5nUGVyaW9kID0gX21heE1pbnV0ZXNGdW5kaW5nUGVyaW9kOwogICAgICAgIG1heE1pbnV0ZXNQcm9wb3NhbFBlcmlvZCA9IF9tYXhNaW51dGVzUHJvcG9zYWxQZXJpb2Q7CiAgICAgICAgCiAgICAgICAgRGFvUnVsZXMubWluUXVvcnVtRGl2aXNvciA9IF9taW5RdW9ydW1EaXZpc29yOwogICAgICAgIERhb1J1bGVzLm1pbkJvYXJkTWVldGluZ0ZlZXMgPSBfbWluQm9hcmRNZWV0aW5nRmVlczsKICAgICAgICBEYW9SdWxlcy5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgPSBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kOwogICAgICAgIERhb1J1bGVzLm1pbk1pbnV0ZXNEZWJhdGVQZXJpb2QgPSBfbWluTWludXRlc0RlYmF0ZVBlcmlvZDsKICAgICAgICBEYW9SdWxlcy5mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSA9IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZTsKCiAgICAgICAgQm9hcmRNZWV0aW5ncy5sZW5ndGggPSAxOyAKICAgICAgICBQcm9wb3NhbHMubGVuZ3RoID0gMTsKICAgICAgICBEYW9SdWxlc1Byb3Bvc2Fscy5sZW5ndGggPSAxOwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiBuZXdCb2FyZE1lZXRpbmcoCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCwgCiAgICAgICAgdWludCBfZGFvUnVsZXNQcm9wb3NhbElELCAKICAgICAgICB1aW50IF9taW51dGVzRGViYXRpbmdQZXJpb2QKICAgICkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewoKICAgICAgICBpZiAobXNnLnZhbHVlIDwgRGFvUnVsZXMubWluQm9hcmRNZWV0aW5nRmVlcwogICAgICAgICAgICB8fCBEYW9SdWxlcy5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgKyBfbWludXRlc0RlYmF0aW5nUGVyaW9kID4gbWF4TWludXRlc1Byb3Bvc2FsUGVyaW9kCiAgICAgICAgICAgIHx8IG5vdyArICgoRGFvUnVsZXMubWludXRlc1NldFByb3Bvc2FsUGVyaW9kICsgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCkgKiAxIG1pbnV0ZXMpIDwgbm93CiAgICAgICAgICAgIHx8IF9taW51dGVzRGViYXRpbmdQZXJpb2QgPCBEYW9SdWxlcy5taW5NaW51dGVzRGViYXRlUGVyaW9kCiAgICAgICAgICAgIHx8IG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSkgdGhyb3c7CgogICAgICAgIHVpbnQgX2JvYXJkTWVldGluZ0lEID0gQm9hcmRNZWV0aW5ncy5sZW5ndGgrKzsKICAgICAgICBCb2FyZE1lZXRpbmcgYiA9IEJvYXJkTWVldGluZ3NbX2JvYXJkTWVldGluZ0lEXTsKCiAgICAgICAgYi5jcmVhdG9yID0gbXNnLnNlbmRlcjsKCiAgICAgICAgYi5wcm9wb3NhbElEID0gX3Byb3Bvc2FsSUQ7CiAgICAgICAgYi5kYW9SdWxlc1Byb3Bvc2FsSUQgPSBfZGFvUnVsZXNQcm9wb3NhbElEOwoKICAgICAgICBiLmZlZXMgPSBtc2cudmFsdWU7CiAgICAgICAgCiAgICAgICAgYi5zZXREZWFkbGluZSA9IG5vdyArIChEYW9SdWxlcy5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgKiAxIG1pbnV0ZXMpOyAgICAgICAgCiAgICAgICAgYi52b3RpbmdEZWFkbGluZSA9IGIuc2V0RGVhZGxpbmUgKyAoX21pbnV0ZXNEZWJhdGluZ1BlcmlvZCAqIDEgbWludXRlcyk7IAoKICAgICAgICBiLm9wZW4gPSB0cnVlOyAKCiAgICAgICAgcmV0dXJuIF9ib2FyZE1lZXRpbmdJRDsKCiAgICB9CgogICAgZnVuY3Rpb24gbmV3UHJvcG9zYWwoCiAgICAgICAgYWRkcmVzcyBfY29udHJhY3Rvck1hbmFnZXIsCiAgICAgICAgdWludCBfY29udHJhY3RvclByb3Bvc2FsSUQsCiAgICAgICAgdWludCBfYW1vdW50LCAKICAgICAgICBib29sIF90b2tlbkNyZWF0aW9uLAogICAgICAgIGJvb2wgX3B1YmxpY1NoYXJlQ3JlYXRpb24sCiAgICAgICAgYWRkcmVzcyBfbWFpblBhcnRuZXIsCiAgICAgICAgdWludCBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyLCAKICAgICAgICB1aW50IF9pbmZsYXRpb25SYXRlLAogICAgICAgIHVpbnQgX21pbnV0ZXNGdW5kaW5nUGVyaW9kLAogICAgICAgIHVpbnQgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZAogICAgKSBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsKCiAgICAgICAgaWYgKChfY29udHJhY3Rvck1hbmFnZXIgIT0gMCAmJiBfY29udHJhY3RvclByb3Bvc2FsSUQgPT0gMCkKICAgICAgICAgICAgfHwgKF9jb250cmFjdG9yTWFuYWdlciA9PSAwIAogICAgICAgICAgICAgICAgJiYgKF9pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgPT0gMAogICAgICAgICAgICAgICAgICAgIHx8IF9jb250cmFjdG9yUHJvcG9zYWxJRCAhPSAwKQogICAgICAgICAgICB8fCAoX3Rva2VuQ3JlYXRpb24gJiYgX3B1YmxpY1NoYXJlQ3JlYXRpb24pCiAgICAgICAgICAgIHx8IChfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyICE9IDAKICAgICAgICAgICAgICAgICYmIChfbWludXRlc0Z1bmRpbmdQZXJpb2QgPCBtaW5NaW51dGVzUGVyaW9kcwogICAgICAgICAgICAgICAgICAgIHx8IF9pbmZsYXRpb25SYXRlID4gbWF4SW5mbGF0aW9uUmF0ZQogICAgICAgICAgICAgICAgICAgIHx8IF9taW51dGVzRnVuZGluZ1BlcmlvZCA+IG1heE1pbnV0ZXNGdW5kaW5nUGVyaW9kKSkpKSB0aHJvdzsKCiAgICAgICAgdWludCBfcHJvcG9zYWxJRCA9IFByb3Bvc2Fscy5sZW5ndGgrKzsKICAgICAgICBQcm9wb3NhbCBwID0gUHJvcG9zYWxzW19wcm9wb3NhbElEXTsKCiAgICAgICAgcC5jb250cmFjdG9yTWFuYWdlciA9IFBhc3NNYW5hZ2VyKF9jb250cmFjdG9yTWFuYWdlcik7CiAgICAgICAgcC5jb250cmFjdG9yUHJvcG9zYWxJRCA9IF9jb250cmFjdG9yUHJvcG9zYWxJRDsKICAgICAgICAKICAgICAgICBwLmFtb3VudCA9IF9hbW91bnQ7CiAgICAgICAgcC50b2tlbkNyZWF0aW9uID0gX3Rva2VuQ3JlYXRpb247CgogICAgICAgIHAucHVibGljU2hhcmVDcmVhdGlvbiA9IF9wdWJsaWNTaGFyZUNyZWF0aW9uOwogICAgICAgIHAubWFpblBhcnRuZXIgPSBfbWFpblBhcnRuZXI7CiAgICAgICAgcC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgPSBfaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyOwogICAgICAgIHAuaW5mbGF0aW9uUmF0ZSA9IF9pbmZsYXRpb25SYXRlOwogICAgICAgIHAubWludXRlc0Z1bmRpbmdQZXJpb2QgPSBfbWludXRlc0Z1bmRpbmdQZXJpb2Q7CgogICAgICAgIHAuYm9hcmRNZWV0aW5nSUQgPSBuZXdCb2FyZE1lZXRpbmcoX3Byb3Bvc2FsSUQsIDAsIF9taW51dGVzRGViYXRpbmdQZXJpb2QpOyAgIAoKICAgICAgICBwLm9wZW4gPSB0cnVlOwogICAgICAgIAogICAgICAgIFByb3Bvc2FsQWRkZWQoX3Byb3Bvc2FsSUQsIHAuY29udHJhY3Rvck1hbmFnZXIsIHAuY29udHJhY3RvclByb3Bvc2FsSUQsIHAuYW1vdW50LCBwLm1haW5QYXJ0bmVyLCAKICAgICAgICAgICAgcC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIsIF9taW51dGVzRnVuZGluZ1BlcmlvZCk7CgogICAgICAgIHJldHVybiBfcHJvcG9zYWxJRDsKICAgICAgICAKICAgIH0KCiAgICBmdW5jdGlvbiBuZXdEYW9SdWxlc1Byb3Bvc2FsKAogICAgICAgIHVpbnQgX21pblF1b3J1bURpdmlzb3IsIAogICAgICAgIHVpbnQgX21pbkJvYXJkTWVldGluZ0ZlZXMsCiAgICAgICAgdWludCBfbWludXRlc1NldFByb3Bvc2FsUGVyaW9kLAogICAgICAgIHVpbnQgX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QsCiAgICAgICAgdWludCBfZmVlc1Jld2FyZEluZmxhdGlvblJhdGUsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJhYmxlLAogICAgICAgIHVpbnQgX21pbnV0ZXNEZWJhdGluZ1BlcmlvZAogICAgKSBwYXlhYmxlIHJldHVybnMgKHVpbnQpIHsKICAgIAogICAgICAgIGlmIChfbWluUXVvcnVtRGl2aXNvciA8PSAxCiAgICAgICAgICAgIHx8IF9taW5RdW9ydW1EaXZpc29yID4gMTAKICAgICAgICAgICAgfHwgX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCA8IG1pbk1pbnV0ZXNQZXJpb2RzCiAgICAgICAgICAgIHx8IF9taW5NaW51dGVzRGViYXRlUGVyaW9kIDwgbWluTWludXRlc1BlcmlvZHMKICAgICAgICAgICAgfHwgX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCArIF9taW5NaW51dGVzRGViYXRlUGVyaW9kID4gbWF4TWludXRlc1Byb3Bvc2FsUGVyaW9kCiAgICAgICAgICAgIHx8IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSA+IG1heEluZmxhdGlvblJhdGUKICAgICAgICAgICAgKSB0aHJvdzsgCiAgICAgICAgCiAgICAgICAgdWludCBfRGFvUnVsZXNQcm9wb3NhbElEID0gRGFvUnVsZXNQcm9wb3NhbHMubGVuZ3RoKys7CiAgICAgICAgUnVsZXMgciA9IERhb1J1bGVzUHJvcG9zYWxzW19EYW9SdWxlc1Byb3Bvc2FsSURdOwoKICAgICAgICByLm1pblF1b3J1bURpdmlzb3IgPSBfbWluUXVvcnVtRGl2aXNvcjsKICAgICAgICByLm1pbkJvYXJkTWVldGluZ0ZlZXMgPSBfbWluQm9hcmRNZWV0aW5nRmVlczsKICAgICAgICByLm1pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCA9IF9taW51dGVzU2V0UHJvcG9zYWxQZXJpb2Q7CiAgICAgICAgci5taW5NaW51dGVzRGViYXRlUGVyaW9kID0gX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7CiAgICAgICAgci5mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSA9IF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZTsKICAgICAgICByLnRyYW5zZmVyYWJsZSA9IF90cmFuc2ZlcmFibGU7CiAgICAgICAgCiAgICAgICAgci5ib2FyZE1lZXRpbmdJRCA9IG5ld0JvYXJkTWVldGluZygwLCBfRGFvUnVsZXNQcm9wb3NhbElELCBfbWludXRlc0RlYmF0aW5nUGVyaW9kKTsgICAgIAoKICAgICAgICBEYW9SdWxlc1Byb3Bvc2FsQWRkZWQoX0Rhb1J1bGVzUHJvcG9zYWxJRCwgX21pblF1b3J1bURpdmlzb3IsIF9taW5Cb2FyZE1lZXRpbmdGZWVzLCAKICAgICAgICAgICAgX21pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZCwgX21pbk1pbnV0ZXNEZWJhdGVQZXJpb2QsIF9mZWVzUmV3YXJkSW5mbGF0aW9uUmF0ZSAsX3RyYW5zZmVyYWJsZSk7CgogICAgICAgIHJldHVybiBfRGFvUnVsZXNQcm9wb3NhbElEOwogICAgICAgIAogICAgfQogICAgCiAgICBmdW5jdGlvbiB2b3RlKAogICAgICAgIHVpbnQgX2JvYXJkTWVldGluZ0lELCAKICAgICAgICBib29sIF9zdXBwb3J0c1Byb3Bvc2FsCiAgICApIHsKICAgICAgICAKICAgICAgICBCb2FyZE1lZXRpbmcgYiA9IEJvYXJkTWVldGluZ3NbX2JvYXJkTWVldGluZ0lEXTsKCiAgICAgICAgaWYgKGIuaGFzVm90ZWRbbXNnLnNlbmRlcl0gCiAgICAgICAgICAgIHx8IG5vdyA8IGIuc2V0RGVhZGxpbmUKICAgICAgICAgICAgfHwgbm93ID4gYi52b3RpbmdEZWFkbGluZSkgdGhyb3c7CgogICAgICAgIHVpbnQgX2JhbGFuY2UgPSB1aW50KGRhb01hbmFnZXIuYmFsYW5jZU9mKG1zZy5zZW5kZXIpKTsKICAgICAgICBpZiAoX2JhbGFuY2UgPT0gMCkgdGhyb3c7CiAgICAgICAgCiAgICAgICAgYi5oYXNWb3RlZFttc2cuc2VuZGVyXSA9IHRydWU7CgogICAgICAgIGlmIChfc3VwcG9ydHNQcm9wb3NhbCkgYi55ZWEgKz0gX2JhbGFuY2U7CiAgICAgICAgZWxzZSBiLm5heSArPSBfYmFsYW5jZTsgCgogICAgICAgIGlmIChiLmZlZXMgPiAwICYmIGIucHJvcG9zYWxJRCAhPSAwICYmIFByb3Bvc2Fsc1tiLnByb3Bvc2FsSURdLmNvbnRyYWN0b3JQcm9wb3NhbElEICE9IDApIHsKCiAgICAgICAgICAgIHVpbnQgX2EgPSAxMDAqYi5mZWVzOwogICAgICAgICAgICBpZiAoKF9hLzEwMCAhPSBiLmZlZXMpIHx8ICgoX2EqX2JhbGFuY2UpL19hICE9IF9iYWxhbmNlKSkgdGhyb3c7CiAgICAgICAgICAgIHVpbnQgX211bHRpcGxpZXIgPSAoX2EqX2JhbGFuY2UpL3VpbnQoZGFvTWFuYWdlci5Ub3RhbFN1cHBseSgpKTsKCiAgICAgICAgICAgIHVpbnQgX2Rpdmlzb3IgPSAxMDAgKyAxMDAqRGFvUnVsZXMuZmVlc1Jld2FyZEluZmxhdGlvblJhdGUqKG5vdyAtIGIuc2V0RGVhZGxpbmUpLygxMDAqMzY1IGRheXMpOwoKICAgICAgICAgICAgdWludCBfcmV3YXJkZWRhbW91bnQgPSBfbXVsdGlwbGllci9fZGl2aXNvcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChiLnRvdGFsUmV3YXJkZWRBbW91bnQgKyBfcmV3YXJkZWRhbW91bnQgPiBiLmZlZXMpIF9yZXdhcmRlZGFtb3VudCA9IGIuZmVlcyAtIGIudG90YWxSZXdhcmRlZEFtb3VudDsKICAgICAgICAgICAgYi50b3RhbFJld2FyZGVkQW1vdW50ICs9IF9yZXdhcmRlZGFtb3VudDsKICAgICAgICAgICAgcGVuZGluZ0ZlZXNXaXRoZHJhd2Fsc1ttc2cuc2VuZGVyXSArPSBfcmV3YXJkZWRhbW91bnQ7CiAgICAgICAgfQoKICAgICAgICBkYW9NYW5hZ2VyLmJsb2NrVHJhbnNmZXIobXNnLnNlbmRlciwgYi52b3RpbmdEZWFkbGluZSk7CgogICAgfQoKICAgIGZ1bmN0aW9uIGV4ZWN1dGVEZWNpc2lvbih1aW50IF9ib2FyZE1lZXRpbmdJRCkgcmV0dXJucyAoYm9vbCkgewoKICAgICAgICBCb2FyZE1lZXRpbmcgYiA9IEJvYXJkTWVldGluZ3NbX2JvYXJkTWVldGluZ0lEXTsKICAgICAgICBQcm9wb3NhbCBwID0gUHJvcG9zYWxzW2IucHJvcG9zYWxJRF07CiAgICAgICAgCiAgICAgICAgaWYgKG5vdyA8IGIudm90aW5nRGVhZGxpbmUgfHwgIWIub3BlbikgdGhyb3c7CiAgICAgICAgCiAgICAgICAgYi5vcGVuID0gZmFsc2U7CiAgICAgICAgaWYgKHAuY29udHJhY3RvclByb3Bvc2FsSUQgPT0gMCkgcC5vcGVuID0gZmFsc2U7CgogICAgICAgIHVpbnQgX2ZlZXM7CiAgICAgICAgdWludCBfbWluUXVvcnVtID0gbWluUXVvcnVtKCk7CgogICAgICAgIGlmIChiLmZlZXMgPiAwCiAgICAgICAgICAgICYmIChiLnByb3Bvc2FsSUQgPT0gMCB8fCBwLmNvbnRyYWN0b3JQcm9wb3NhbElEID09IDApCiAgICAgICAgICAgICYmIGIueWVhICsgYi5uYXkgPj0gX21pblF1b3J1bSkgewogICAgICAgICAgICAgICAgICAgIF9mZWVzID0gYi5mZWVzOwogICAgICAgICAgICAgICAgICAgIGIuZmVlcyA9IDA7CiAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0ZlZXNXaXRoZHJhd2Fsc1tiLmNyZWF0b3JdICs9IF9mZWVzOwogICAgICAgIH0gICAgICAgIAoKICAgICAgICBpZiAoYi5mZWVzIC0gYi50b3RhbFJld2FyZGVkQW1vdW50ID4gMCkgewogICAgICAgICAgICBpZiAoIWRhb01hbmFnZXIuc2VuZChiLmZlZXMgLSBiLnRvdGFsUmV3YXJkZWRBbW91bnQpKSB0aHJvdzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGIueWVhICsgYi5uYXkgPCBfbWluUXVvcnVtIHx8IGIueWVhIDw9IGIubmF5KSB7CiAgICAgICAgICAgIHAub3BlbiA9IGZhbHNlOwogICAgICAgICAgICBCb2FyZE1lZXRpbmdDbG9zZWQoX2JvYXJkTWVldGluZ0lELCBfZmVlcywgZmFsc2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBiLmRhdGVPZkV4ZWN1dGlvbiA9IG5vdzsKCiAgICAgICAgaWYgKGIucHJvcG9zYWxJRCAhPSAwKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIgIT0gMCkgewoKICAgICAgICAgICAgICAgIGRhb01hbmFnZXIuc2V0RnVuZGluZ1J1bGVzKHAubWFpblBhcnRuZXIsIHAucHVibGljU2hhcmVDcmVhdGlvbiwgcC5pbml0aWFsU2hhcmVQcmljZU11bHRpcGxpZXIsIAogICAgICAgICAgICAgICAgICAgIHAuYW1vdW50LCBwLm1pbnV0ZXNGdW5kaW5nUGVyaW9kLCBwLmluZmxhdGlvblJhdGUsIGIucHJvcG9zYWxJRCk7CgogICAgICAgICAgICAgICAgaWYgKHAuY29udHJhY3RvclByb3Bvc2FsSUQgIT0gMCAmJiBwLnRva2VuQ3JlYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBwLmNvbnRyYWN0b3JNYW5hZ2VyLnNldEZ1bmRpbmdSdWxlcyhwLm1haW5QYXJ0bmVyLCBwLnB1YmxpY1NoYXJlQ3JlYXRpb24sIDAsIAogICAgICAgICAgICAgICAgICAgICAgICBwLmFtb3VudCwgcC5taW51dGVzRnVuZGluZ1BlcmlvZCwgbWF4SW5mbGF0aW9uUmF0ZSwgYi5wcm9wb3NhbElEKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KCiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgIFJ1bGVzIHIgPSBEYW9SdWxlc1Byb3Bvc2Fsc1tiLmRhb1J1bGVzUHJvcG9zYWxJRF07CiAgICAgICAgICAgIERhb1J1bGVzLmJvYXJkTWVldGluZ0lEID0gci5ib2FyZE1lZXRpbmdJRDsKCiAgICAgICAgICAgIERhb1J1bGVzLm1pblF1b3J1bURpdmlzb3IgPSByLm1pblF1b3J1bURpdmlzb3I7CiAgICAgICAgICAgIERhb1J1bGVzLm1pbk1pbnV0ZXNEZWJhdGVQZXJpb2QgPSByLm1pbk1pbnV0ZXNEZWJhdGVQZXJpb2Q7IAogICAgICAgICAgICBEYW9SdWxlcy5taW5Cb2FyZE1lZXRpbmdGZWVzID0gci5taW5Cb2FyZE1lZXRpbmdGZWVzOwogICAgICAgICAgICBEYW9SdWxlcy5taW51dGVzU2V0UHJvcG9zYWxQZXJpb2QgPSByLm1pbnV0ZXNTZXRQcm9wb3NhbFBlcmlvZDsKICAgICAgICAgICAgRGFvUnVsZXMuZmVlc1Jld2FyZEluZmxhdGlvblJhdGUgPSByLmZlZXNSZXdhcmRJbmZsYXRpb25SYXRlOwoKICAgICAgICAgICAgRGFvUnVsZXMudHJhbnNmZXJhYmxlID0gci50cmFuc2ZlcmFibGU7CiAgICAgICAgICAgIGlmIChyLnRyYW5zZmVyYWJsZSkgZGFvTWFuYWdlci5hYmxlVHJhbnNmZXIoKTsKICAgICAgICAgICAgZWxzZSBkYW9NYW5hZ2VyLmRpc2FibGVUcmFuc2ZlcigpOwogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgQm9hcmRNZWV0aW5nQ2xvc2VkKF9ib2FyZE1lZXRpbmdJRCwgX2ZlZXMsIHRydWUpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JkZXJDb250cmFjdG9yUHJvcG9zYWwodWludCBfcHJvcG9zYWxJRCkgcmV0dXJucyAoYm9vbCkgewogICAgICAgIAogICAgICAgIFByb3Bvc2FsIHAgPSBQcm9wb3NhbHNbX3Byb3Bvc2FsSURdOwogICAgICAgIEJvYXJkTWVldGluZyBiID0gQm9hcmRNZWV0aW5nc1twLmJvYXJkTWVldGluZ0lEXTsKCiAgICAgICAgaWYgKGIub3BlbiB8fCAhcC5vcGVuKSB0aHJvdzsKICAgICAgICAKICAgICAgICB1aW50IF9hbW91bnQgPSBwLmFtb3VudDsKCiAgICAgICAgaWYgKHAuaW5pdGlhbFNoYXJlUHJpY2VNdWx0aXBsaWVyICE9IDApIHsKICAgICAgICAgICAgX2Ftb3VudCA9IGRhb01hbmFnZXIuRnVuZGVkQW1vdW50KF9wcm9wb3NhbElEKTsKICAgICAgICAgICAgaWYgKF9hbW91bnQgPT0gMCAmJiBub3cgPCBiLmRhdGVPZkV4ZWN1dGlvbiArIChwLm1pbnV0ZXNGdW5kaW5nUGVyaW9kICogMSBtaW51dGVzKSkgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwLm9wZW4gPSBmYWxzZTsgICAKCiAgICAgICAgaWYgKF9hbW91bnQgPT0gMCB8fCAhcC5jb250cmFjdG9yTWFuYWdlci5vcmRlcihwLmNvbnRyYWN0b3JQcm9wb3NhbElELCBfYW1vdW50KSkgcmV0dXJuOwogICAgICAgIAogICAgICAgIGlmICghZGFvTWFuYWdlci5zZW5kVG8ocC5jb250cmFjdG9yTWFuYWdlciwgX2Ftb3VudCkpIHRocm93OwogICAgICAgIFNlbnRUb0NvbnRyYWN0b3IocC5jb250cmFjdG9yUHJvcG9zYWxJRCwgYWRkcmVzcyhwLmNvbnRyYWN0b3JNYW5hZ2VyKSwgX2Ftb3VudCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CgogICAgfQogICAgCiAgICBmdW5jdGlvbiB3aXRoZHJhd0JvYXJkTWVldGluZ0ZlZXMoKSByZXR1cm5zIChib29sKSB7CgogICAgICAgIHVpbnQgX2Ftb3VudCA9IHBlbmRpbmdGZWVzV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl07CgogICAgICAgIHBlbmRpbmdGZWVzV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICBpZiAobXNnLnNlbmRlci5zZW5kKF9hbW91bnQpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBlbmRpbmdGZWVzV2l0aGRyYXdhbHNbbXNnLnNlbmRlcl0gPSBfYW1vdW50OwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgIH0KCiAgICBmdW5jdGlvbiBtaW5RdW9ydW0oKSBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuICh1aW50KGRhb01hbmFnZXIuVG90YWxTdXBwbHkoKSkgLyBEYW9SdWxlcy5taW5RdW9ydW1EaXZpc29yKTsKICAgIH0KICAgIAp9'.
	

]
