Class {
	#name : #SRTc598b180b358a8c1703144a3c1138f3531f3e6e4,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc598b180b358a8c1703144a3c1138f3531f3e6e4 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgoKCi8qKgogKiBAYXV0aG9yIEVtaWwgRHVkbnlrCiAqLwpjb250cmFjdCBFVEhQcmljZVdhdGNoZXIgewogIGFkZHJlc3MgcHVibGljIGV0aFByaWNlUHJvdmlkZXI7CgogIG1vZGlmaWVyIG9ubHlFdGhQcmljZVByb3ZpZGVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGV0aFByaWNlUHJvdmlkZXIpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIHJlY2VpdmVFdGhQcmljZSh1aW50IGV0aFVzZFByaWNlKSBleHRlcm5hbDsKCiAgZnVuY3Rpb24gc2V0RXRoUHJpY2VQcm92aWRlcihhZGRyZXNzIHByb3ZpZGVyKSBleHRlcm5hbDsKfQoKLy8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKLy8gVGhpcyBhcGkgaXMgY3VycmVudGx5IHRhcmdldGVkIGF0IDAuNC4xOCwgcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIG9yIG9yYWNsaXplQVBJXzAuNCB3aGVyZSBuZWNlc3NhcnkKCmNvbnRyYWN0IE9yYWNsaXplSSB7CiAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogIGZ1bmN0aW9uIHF1ZXJ5KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZykgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgZnVuY3Rpb24gcXVlcnlfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZywgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogIGZ1bmN0aW9uIHF1ZXJ5Tih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgYnl0ZXMgX2FyZ04pIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcHVibGljIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgcHVibGljIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpIGV4dGVybmFsOwogIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKSBleHRlcm5hbDsKICBmdW5jdGlvbiByYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMoYnl0ZXMzMik7Cn0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcHVibGljIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOwp9CmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgewogIHVpbnQgY29uc3RhbnQgZGF5ID0gNjAqNjAqMjQ7CiAgdWludCBjb25zdGFudCB3ZWVrID0gNjAqNjAqMjQqNzsKICB1aW50IGNvbnN0YW50IG1vbnRoID0gNjAqNjAqMjQqMzA7CiAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CiAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfVExTTm90YXJ5ID0gMHgxMDsKICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9BbmRyb2lkID0gMHgyMDsKICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9MZWRnZXIgPSAweDMwOwogIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX05hdGl2ZSA9IDB4RjA7CiAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2F1dG8gPSAwOwogIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9tYWlubmV0ID0gMTsKICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX21vcmRlbiA9IDI7CiAgdWludDggY29uc3RhbnQgbmV0d29ya0lEX2NvbnNlbnN5cyA9IDE2MTsKCiAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKCiAgT3JhY2xpemVJIG9yYWNsaXplOwogIG1vZGlmaWVyIG9yYWNsaXplQVBJIHsKICAgIGlmKChhZGRyZXNzKE9BUik9PTApfHwoZ2V0Q29kZVNpemUoYWRkcmVzcyhPQVIpKT09MCkpCiAgICAgIG9yYWNsaXplX3NldE5ldHdvcmsobmV0d29ya0lEX2F1dG8pOwoKICAgIGlmKGFkZHJlc3Mob3JhY2xpemUpICE9IE9BUi5nZXRBZGRyZXNzKCkpCiAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwoKICAgIF87CiAgfQogIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgIHJldHVybiBvcmFjbGl6ZV9zZXROZXR3b3JrKCk7CiAgICBuZXR3b3JrSUQ7IC8vIHNpbGVuY2UgdGhlIHdhcm5pbmcgYW5kIHJlbWFpbiBiYWNrd2FyZHMgY29tcGF0aWJsZQogIH0KICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgIGlmIChnZXRDb2RlU2l6ZSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpPjApeyAvL21haW5uZXQKICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk7CiAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfbWFpbm5ldCIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChnZXRDb2RlU2l6ZSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpPjApeyAvL2tvdmFuIHRlc3RuZXQKICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk7CiAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoZ2V0Q29kZVNpemUoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KT4wKXsgLy9yaW5rZWJ5IHRlc3RuZXQKICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk7CiAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcmlua2VieSIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKT4wKXsgLy9ldGhlci5jYW1wIGlkZQogICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoZ2V0Q29kZVNpemUoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKT4wKXsgLy9icm93c2VyLXNvbGlkaXR5CiAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSBwdWJsaWMgewogICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQpOwogIH0KCiAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogIH0KCiAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgcmV0dXJuIG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICB9CgogIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogIH0KICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICByZXR1cm4gb3JhY2xpemUucXVlcnlfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogIH0KCiAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICByZXR1cm4gb3JhY2xpemUuY2JBZGRyZXNzKCk7CiAgfQogIGZ1bmN0aW9uIG9yYWNsaXplX3NldFByb29mKGJ5dGUgcHJvb2ZQKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgfQogIGZ1bmN0aW9uIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKHVpbnQgZ2FzUHJpY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgfQoKICBmdW5jdGlvbiBnZXRDb2RlU2l6ZShhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKHVpbnQgX3NpemUpIHsKICAgIGFzc2VtYmx5IHsKICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICB9CiAgfQoKICAvLyBwYXJzZUludAogIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogIH0KCiAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgYnl0ZXMgbWVtb3J5IGJyZXN1bHQgPSBieXRlcyhfYSk7CiAgICB1aW50IG1pbnQgPSAwOwogICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOwogICAgZm9yICh1aW50IGk9MDsgaTxicmVzdWx0Lmxlbmd0aDsgaSsrKXsKICAgICAgaWYgKChicmVzdWx0W2ldID49IDQ4KSYmKGJyZXN1bHRbaV0gPD0gNTcpKXsKICAgICAgICBpZiAoZGVjaW1hbHMpewogICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOwogICAgICAgICAgZWxzZSBfYi0tOwogICAgICAgIH0KICAgICAgICBtaW50ICo9IDEwOwogICAgICAgIG1pbnQgKz0gdWludChicmVzdWx0W2ldKSAtIDQ4OwogICAgICB9IGVsc2UgaWYgKGJyZXN1bHRbaV0gPT0gNDYpIGRlY2ltYWxzID0gdHJ1ZTsKICAgIH0KICAgIGlmIChfYiA+IDApIG1pbnQgKj0gMTAqKl9iOwogICAgcmV0dXJuIG1pbnQ7CiAgfQoKICBzdHJpbmcgb3JhY2xpemVfbmV0d29ya19uYW1lOwogIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKHN0cmluZyBfbmV0d29ya19uYW1lKSBpbnRlcm5hbCB7CiAgICBvcmFjbGl6ZV9uZXR3b3JrX25hbWUgPSBfbmV0d29ya19uYW1lOwogIH0KCiAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgcmV0dXJuIG9yYWNsaXplX25ldHdvcmtfbmFtZTsKICB9Cgp9Ci8vIDwvT1JBQ0xJWkVfQVBJPgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgQnVpbGRpbmdTdGF0dXMgaXMgT3duYWJsZSB7CiAgLyogT2JzZXJ2ZXIgY29udHJhY3QgICovCiAgYWRkcmVzcyBwdWJsaWMgb2JzZXJ2ZXI7CgogIC8qIENyb3dkc2FsZSBjb250cmFjdCAqLwogIGFkZHJlc3MgcHVibGljIGNyb3dkc2FsZTsKCiAgZW51bSBzdGF0dXNFbnVtIHsKICAgICAgY3Jvd2RzYWxlLAogICAgICByZWZ1bmQsCiAgICAgIHByZXBhcmF0aW9uX3dvcmtzLAogICAgICBidWlsZGluZ19wZXJtaXQsCiAgICAgIGRlc2lnbl90ZWNobmljYWxfZG9jdW1lbnRhdGlvbiwKICAgICAgdXRpbGl0aWVzX291dHNpdGUsCiAgICAgIGNvbnN0cnVjdGlvbl9yZXNpZGVudGlhbCwKICAgICAgZnJhbWUyMCwKICAgICAgZnJhbWU0MCwKICAgICAgZnJhbWU2MCwKICAgICAgZnJhbWU4MCwKICAgICAgZnJhbWUxMDAsCiAgICAgIHN0YWdlMSwKICAgICAgc3RhZ2UyLAogICAgICBzdGFnZTMsCiAgICAgIHN0YWdlNCwKICAgICAgc3RhZ2U1LAogICAgICBmYWNhZGVzMjAsCiAgICAgIGZhY2FkZXM0MCwKICAgICAgZmFjYWRlczYwLAogICAgICBmYWNhZGVzODAsCiAgICAgIGZhY2FkZXMxMDAsCiAgICAgIGVuZ2luZWVyaW5nLAogICAgICBmaW5pc2hpbmcsCiAgICAgIGNvbnN0cnVjdGlvbl9wYXJraW5nLAogICAgICBjaXZpbF93b3JrcywKICAgICAgZW5naW5lZXJpbmdfZnVydGhlciwKICAgICAgY29tbWlzaW9uaW5nX3Byb2plY3QsCiAgICAgIGNvbXBsZXRlZAogIH0KCiAgbW9kaWZpZXIgbm90Q29tcGxldGVkKCkgewogICAgICByZXF1aXJlKHN0YXR1cyAhPSBzdGF0dXNFbnVtLmNvbXBsZXRlZCk7CiAgICAgIF87CiAgfQoKICBtb2RpZmllciBvbmx5T2JzZXJ2ZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb2JzZXJ2ZXIgfHwgbXNnLnNlbmRlciA9PSBvd25lciB8fCBtc2cuc2VuZGVyID09IGFkZHJlc3ModGhpcykpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlDcm93ZHNhbGUoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3Jvd2RzYWxlIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgbXNnLnNlbmRlciA9PSBhZGRyZXNzKHRoaXMpKTsKICAgIF87CiAgfQoKICBzdGF0dXNFbnVtIHB1YmxpYyBzdGF0dXM7CgogIGV2ZW50IFN0YXR1c0NoYW5nZWQoc3RhdHVzRW51bSBuZXdTdGF0dXMpOwoKICBmdW5jdGlvbiBzZXRTdGF0dXMoc3RhdHVzRW51bSBuZXdTdGF0dXMpIG9ubHlDcm93ZHNhbGUgIHB1YmxpYyB7CiAgICAgIHN0YXR1cyA9IG5ld1N0YXR1czsKICAgICAgU3RhdHVzQ2hhbmdlZChuZXdTdGF0dXMpOwogIH0KCiAgZnVuY3Rpb24gY2hhbmdlU3RhZ2UodWludDggc3RhZ2UpIHB1YmxpYyBvbmx5T2JzZXJ2ZXIgewogICAgICBpZiAoc3RhZ2U9PTEpIHN0YXR1cyA9IHN0YXR1c0VudW0uc3RhZ2UxOwogICAgICBpZiAoc3RhZ2U9PTIpIHN0YXR1cyA9IHN0YXR1c0VudW0uc3RhZ2UyOwogICAgICBpZiAoc3RhZ2U9PTMpIHN0YXR1cyA9IHN0YXR1c0VudW0uc3RhZ2UzOwogICAgICBpZiAoc3RhZ2U9PTQpIHN0YXR1cyA9IHN0YXR1c0VudW0uc3RhZ2U0OwogICAgICBpZiAoc3RhZ2U9PTUpIHN0YXR1cyA9IHN0YXR1c0VudW0uc3RhZ2U1OwogIH0KIAp9CgovKgogKiBNYW5hZ2VyIHRoYXQgc3RvcmVzIHBlcm1pdHRlZCBhZGRyZXNzZXMgCiAqLwpjb250cmFjdCBQZXJtaXNzaW9uTWFuYWdlciBpcyBPd25hYmxlIHsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcGVybWl0dGVkQWRkcmVzc2VzOwoKICAgIGZ1bmN0aW9uIGFkZEFkZHJlc3MoYWRkcmVzcyBuZXdBZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwZXJtaXR0ZWRBZGRyZXNzZXNbbmV3QWRkcmVzc10gPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZUFkZHJlc3MoYWRkcmVzcyByZW1BZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwZXJtaXR0ZWRBZGRyZXNzZXNbcmVtQWRkcmVzc10gPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1Blcm1pdHRlZChhZGRyZXNzIHBBZGRyZXNzKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2wpIHsKICAgICAgICBpZiAocGVybWl0dGVkQWRkcmVzc2VzW3BBZGRyZXNzXSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9Cgpjb250cmFjdCBSZWdpc3RyeSBpcyBPd25hYmxlIHsKCiAgc3RydWN0IENvbnRyaWJ1dG9yRGF0YSB7CiAgICBib29sIGlzQWN0aXZlOwogICAgdWludCBjb250cmlidXRpb25FVEg7CiAgICB1aW50IGNvbnRyaWJ1dGlvblVTRDsKICAgIHVpbnQgdG9rZW5zSXNzdWVkOwogICAgdWludCBxdW90ZVVTRDsKICAgIHVpbnQgY29udHJpYnV0aW9uUk5UQjsKICB9CiAgbWFwcGluZyhhZGRyZXNzID0+IENvbnRyaWJ1dG9yRGF0YSkgcHVibGljIGNvbnRyaWJ1dG9yTGlzdDsKICBtYXBwaW5nKHVpbnQgPT4gYWRkcmVzcykgcHJpdmF0ZSBjb250cmlidXRvckluZGV4ZXM7CgogIHVpbnQgcHJpdmF0ZSBuZXh0Q29udHJpYnV0b3JJbmRleDsKCiAgLyogUGVybWlzc2lvbiBtYW5hZ2VyIGNvbnRyYWN0ICovCiAgUGVybWlzc2lvbk1hbmFnZXIgcHVibGljIHBlcm1pc3Npb25NYW5hZ2VyOwoKICBib29sIHB1YmxpYyBjb21wbGV0ZWQ7CgogIG1vZGlmaWVyIG9ubHlQZXJtaXR0ZWQoKSB7CiAgICByZXF1aXJlKHBlcm1pc3Npb25NYW5hZ2VyLmlzUGVybWl0dGVkKG1zZy5zZW5kZXIpKTsKICAgIF87CiAgfQoKICBldmVudCBDb250cmlidXRpb25BZGRlZChhZGRyZXNzIF9jb250cmlidXRvciwgdWludCBvdmVyYWxsRXRoLCB1aW50IG92ZXJhbGxVU0QsIHVpbnQgb3ZlcmFsbFRva2VuLCB1aW50IHF1b3RlKTsKICBldmVudCBDb250cmlidXRpb25FZGl0ZWQoYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQgb3ZlcmFsbEV0aCwgdWludCBvdmVyYWxsVVNELCAgdWludCBvdmVyYWxsVG9rZW4sIHVpbnQgcXVvdGUpOwogIGZ1bmN0aW9uIFJlZ2lzdHJ5KGFkZHJlc3MgcE1hbmFnZXIpIHB1YmxpYyB7CiAgICBwZXJtaXNzaW9uTWFuYWdlciA9IFBlcm1pc3Npb25NYW5hZ2VyKHBNYW5hZ2VyKTsgCiAgICBjb21wbGV0ZWQgPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHNldFBlcm1pc3Npb25NYW5hZ2VyKGFkZHJlc3MgX3Blcm1hZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShfcGVybWFkciAhPSAweDApOwogICAgcGVybWlzc2lvbk1hbmFnZXIgPSBQZXJtaXNzaW9uTWFuYWdlcihfcGVybWFkcik7CiAgfQoKICBmdW5jdGlvbiBpc0FjdGl2ZUNvbnRyaWJ1dG9yKGFkZHJlc3MgY29udHJpYnV0b3IpIHB1YmxpYyB2aWV3IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIGNvbnRyaWJ1dG9yTGlzdFtjb250cmlidXRvcl0uaXNBY3RpdmU7CiAgfQoKICBmdW5jdGlvbiByZW1vdmVDb250cmlidXRpb24oYWRkcmVzcyBjb250cmlidXRvcikgcHVibGljIG9ubHlQZXJtaXR0ZWQgewogICAgY29udHJpYnV0b3JMaXN0W2NvbnRyaWJ1dG9yXS5pc0FjdGl2ZSA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gc2V0Q29tcGxldGVkKGJvb2wgY29tcGwpIHB1YmxpYyBvbmx5UGVybWl0dGVkIHsKICAgIGNvbXBsZXRlZCA9IGNvbXBsOwogIH0KCiAgZnVuY3Rpb24gYWRkQ29udHJpYnV0aW9uKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50IF9hbW91bnQsIHVpbnQgX2FtdXNkLCB1aW50IF90b2tlbnMsIHVpbnQgX3F1b3RlICkgcHVibGljIG9ubHlQZXJtaXR0ZWQgewogICAgCiAgICBpZiAoY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uaXNBY3RpdmUgPT0gZmFsc2UpIHsKICAgICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5pc0FjdGl2ZSA9IHRydWU7CiAgICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uRVRIID0gX2Ftb3VudDsKICAgICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25VU0QgPSBfYW11c2Q7CiAgICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0udG9rZW5zSXNzdWVkID0gX3Rva2VuczsKICAgICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5xdW90ZVVTRCA9IF9xdW90ZTsKCiAgICAgICAgY29udHJpYnV0b3JJbmRleGVzW25leHRDb250cmlidXRvckluZGV4XSA9IF9jb250cmlidXRvcjsKICAgICAgICBuZXh0Q29udHJpYnV0b3JJbmRleCsrOwogICAgfSBlbHNlIHsKICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uRVRIICs9IF9hbW91bnQ7CiAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvblVTRCArPSBfYW11c2Q7CiAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnRva2Vuc0lzc3VlZCArPSBfdG9rZW5zOwogICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5xdW90ZVVTRCA9IF9xdW90ZTsKICAgIH0KICAgIENvbnRyaWJ1dGlvbkFkZGVkKF9jb250cmlidXRvciwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uRVRILCBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25VU0QsIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnRva2Vuc0lzc3VlZCwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0ucXVvdGVVU0QpOwogIH0KCiAgZnVuY3Rpb24gZWRpdENvbnRyaWJ1dGlvbihhZGRyZXNzIF9jb250cmlidXRvciwgdWludCBfYW1vdW50LCB1aW50IF9hbXVzZCwgdWludCBfdG9rZW5zLCB1aW50IF9xdW90ZSkgcHVibGljIG9ubHlQZXJtaXR0ZWQgewogICAgaWYgKGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmlzQWN0aXZlID09IHRydWUpIHsKICAgICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25FVEggPSBfYW1vdW50OwogICAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvblVTRCA9IF9hbXVzZDsKICAgICAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS50b2tlbnNJc3N1ZWQgPSBfdG9rZW5zOwogICAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnF1b3RlVVNEID0gX3F1b3RlOwogICAgfQogICAgIENvbnRyaWJ1dGlvbkVkaXRlZChfY29udHJpYnV0b3IsIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvbkVUSCwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uVVNELCBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS50b2tlbnNJc3N1ZWQsIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnF1b3RlVVNEKTsKICB9CgogIGZ1bmN0aW9uIGFkZENvbnRyaWJ1dG9yKGFkZHJlc3MgX2NvbnRyaWJ1dG9yLCB1aW50IF9hbW91bnQsIHVpbnQgX2FtdXNkLCB1aW50IF90b2tlbnMsIHVpbnQgX3F1b3RlKSBwdWJsaWMgb25seVBlcm1pdHRlZCB7CiAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5pc0FjdGl2ZSA9IHRydWU7CiAgICBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25FVEggPSBfYW1vdW50OwogICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uVVNEID0gX2FtdXNkOwogICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0udG9rZW5zSXNzdWVkID0gX3Rva2VuczsKICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnF1b3RlVVNEID0gX3F1b3RlOwogICAgY29udHJpYnV0b3JJbmRleGVzW25leHRDb250cmlidXRvckluZGV4XSA9IF9jb250cmlidXRvcjsKICAgIG5leHRDb250cmlidXRvckluZGV4Kys7CiAgICBDb250cmlidXRpb25BZGRlZChfY29udHJpYnV0b3IsIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvbkVUSCwgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uY29udHJpYnV0aW9uVVNELCBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS50b2tlbnNJc3N1ZWQsIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnF1b3RlVVNEKTsKIAogIH0KCiAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0aW9uRVRIKGFkZHJlc3MgX2NvbnRyaWJ1dG9yKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgIHJldHVybiBjb250cmlidXRvckxpc3RbX2NvbnRyaWJ1dG9yXS5jb250cmlidXRpb25FVEg7CiAgfQoKICBmdW5jdGlvbiBnZXRDb250cmlidXRpb25VU0QoYWRkcmVzcyBfY29udHJpYnV0b3IpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvblVTRDsKICB9CgogIGZ1bmN0aW9uIGdldENvbnRyaWJ1dGlvblJOVEIoYWRkcmVzcyBfY29udHJpYnV0b3IpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvblJOVEI7CiAgfQoKICBmdW5jdGlvbiBnZXRDb250cmlidXRpb25Ub2tlbnMoYWRkcmVzcyBfY29udHJpYnV0b3IpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgcmV0dXJuIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLnRva2Vuc0lzc3VlZDsKICB9CgogIGZ1bmN0aW9uIGFkZFJOVEJDb250cmlidXRpb24oYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQgX2Ftb3VudCkgcHVibGljIG9ubHlQZXJtaXR0ZWQgewogICAgaWYgKGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmlzQWN0aXZlID09IGZhbHNlKSB7CiAgICAgICAgY29udHJpYnV0b3JMaXN0W19jb250cmlidXRvcl0uaXNBY3RpdmUgPSB0cnVlOwogICAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvblJOVEIgPSBfYW1vdW50OwogICAgICAgIGNvbnRyaWJ1dG9ySW5kZXhlc1tuZXh0Q29udHJpYnV0b3JJbmRleF0gPSBfY29udHJpYnV0b3I7CiAgICAgICAgbmV4dENvbnRyaWJ1dG9ySW5kZXgrKzsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnRyaWJ1dG9yTGlzdFtfY29udHJpYnV0b3JdLmNvbnRyaWJ1dGlvbkVUSCArPSBfYW1vdW50OwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0b3JCeUluZGV4KHVpbnQgaW5kZXgpIHB1YmxpYyB2aWV3ICByZXR1cm5zIChhZGRyZXNzKSB7CiAgICAgIHJldHVybiBjb250cmlidXRvckluZGV4ZXNbaW5kZXhdOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0b3JBbW91bnQoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpIHsKICAgICAgcmV0dXJuIG5leHRDb250cmlidXRvckluZGV4OwogIH0KCn0KCi8qKgogKiBAYXV0aG9yIEVtaWwgRHVkbnlrCiAqLwpjb250cmFjdCBPcmFjbGl6ZUMgaXMgT3duYWJsZSwgdXNpbmdPcmFjbGl6ZSB7CiAgdWludCBwdWJsaWMgdXBkYXRlSW50ZXJ2YWwgPSAzMDA7IC8vNSBtaW51dGVzIGJ5IGRlZmF1bHQKICB1aW50IHB1YmxpYyBnYXNMaW1pdCA9IDIwMDAwMDsgLy8gT3JhY2xpemUgR2FzIExpbWl0CiAgbWFwcGluZyAoYnl0ZXMzMiA9PiBib29sKSB2YWxpZElkczsKICBzdHJpbmcgcHVibGljIHVybDsKCiAgZW51bSBTdGF0ZSB7IE5ldywgU3RvcHBlZCwgQWN0aXZlIH0KCiAgU3RhdGUgcHVibGljIHN0YXRlID0gU3RhdGUuTmV3OwoKICBldmVudCBMb2dPcmFjbGl6ZVF1ZXJ5KHN0cmluZyBkZXNjcmlwdGlvbiwgdWludCBiYWxhbmNlLCB1aW50IGJsb2NrVGltZXN0YW1wKTsKICBldmVudCBMb2dPcmFjbGl6ZUFkZHJSZXNvbHZlckkoYWRkcmVzcyBvYXIpOwoKICBtb2RpZmllciBpbkFjdGl2ZVN0YXRlKCkgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5BY3RpdmUpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIGluU3RvcHBlZFN0YXRlKCkgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5TdG9wcGVkKTsKICAgIF87CiAgfQoKICBtb2RpZmllciBpbk5ld1N0YXRlKCkgewogICAgcmVxdWlyZShzdGF0ZSA9PSBTdGF0ZS5OZXcpOwogICAgXzsKICB9CgogIGZ1bmN0aW9uIHNldFVwZGF0ZUludGVydmFsKHVpbnQgbmV3SW50ZXJ2YWwpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld0ludGVydmFsID4gMCk7CiAgICB1cGRhdGVJbnRlcnZhbCA9IG5ld0ludGVydmFsOwogIH0KCiAgZnVuY3Rpb24gc2V0VXJsKHN0cmluZyBuZXdVcmwpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICByZXF1aXJlKGJ5dGVzKG5ld1VybCkubGVuZ3RoID4gMCk7CiAgICB1cmwgPSBuZXdVcmw7CiAgfQoKICBmdW5jdGlvbiBzZXRHYXNMaW1pdCh1aW50IF9nYXNMaW1pdCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIHJlcXVpcmUoX2dhc0xpbWl0ID4gNTAwMDApOwogICAgZ2FzTGltaXQgPSBfZ2FzTGltaXQ7CiAgfQoKICBmdW5jdGlvbiBzZXRHYXNQcmljZSh1aW50IGdhc1ByaWNlKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgcmVxdWlyZShnYXNQcmljZSA+PSAxMDAwMDAwMDAwKTsgLy8gMSBHd2VpCiAgICBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CiAgfQoKICAvL2xvY2FsIGRldmVsb3BtZW50CiAgZnVuY3Rpb24gc2V0T3JhY2xpemVBZGRyUmVzb2x2ZXJJKGFkZHJlc3MgX19vYXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShfX29hciAhPSAweDApOwogICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKF9fb2FyKTsKICAgIExvZ09yYWNsaXplQWRkclJlc29sdmVySShfX29hcik7CiAgfQoKICAvL3dlIG5lZWQgdG8gZ2V0IGJhY2sgb3VyIGZ1bmRzIGlmIHdlIGRvbid0IG5lZWQgdGhpcyBvcmFjbGUgYW55bW9yZQogIGZ1bmN0aW9uIHdpdGhkcmF3KGFkZHJlc3MgcmVjZWl2ZXIpIGV4dGVybmFsIG9ubHlPd25lciBpblN0b3BwZWRTdGF0ZSB7CiAgICByZXF1aXJlKHJlY2VpdmVyICE9IDB4MCk7CiAgICByZWNlaXZlci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogIH0KfQoKLyoqCiAqIEB0aXRsZSBQYXVzYWJsZQogKiBAZGV2IEJhc2UgY29udHJhY3Qgd2hpY2ggYWxsb3dzIGNoaWxkcmVuIHRvIGltcGxlbWVudCBhbiBlbWVyZ2VuY3kgc3RvcCBtZWNoYW5pc20uCiAqLwpjb250cmFjdCBQYXVzYWJsZSBpcyBPd25hYmxlIHsKICBldmVudCBQYXVzZSgpOwogIGV2ZW50IFVucGF1c2UoKTsKCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIG5vdCBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpIHsKICAgIHJlcXVpcmUoIXBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gcGF1c2UsIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBwYXVzZSgpIG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSB0cnVlOwogICAgUGF1c2UoKTsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHVucGF1c2UoKSBvbmx5T3duZXIgd2hlblBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gZmFsc2U7CiAgICBVbnBhdXNlKCk7CiAgfQp9CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCiAgLyoqCiAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQoKLyoqCiAqIEBhdXRob3IgRW1pbCBEdWRueWsKICovCmNvbnRyYWN0IEVUSFByaWNlUHJvdmlkZXIgaXMgT3JhY2xpemVDIHsKICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgdWludCBwdWJsaWMgY3VycmVudFByaWNlOwoKICBFVEhQcmljZVdhdGNoZXIgcHVibGljIHdhdGNoZXI7CgogIGV2ZW50IExvZ1ByaWNlVXBkYXRlZChzdHJpbmcgZ2V0UHJpY2UsIHVpbnQgc2V0UHJpY2UsIHVpbnQgYmxvY2tUaW1lc3RhbXApOwogIGV2ZW50IExvZ1N0YXJ0VXBkYXRlKHVpbnQgc3RhcnRpbmdQcmljZSwgdWludCB1cGRhdGVJbnRlcnZhbCwgdWludCBibG9ja1RpbWVzdGFtcCk7CgogIGZ1bmN0aW9uIG5vdGlmeVdhdGNoZXIoKSBpbnRlcm5hbDsKCiAgZnVuY3Rpb24gRVRIUHJpY2VQcm92aWRlcihzdHJpbmcgX3VybCkgcGF5YWJsZSBwdWJsaWMgewogICAgdXJsID0gX3VybDsKCiAgICAvL3VwZGF0ZSBpbW1lZGlhdGVseSBmaXJzdCB0aW1lIHRvIGJlIHN1cmUgZXZlcnl0aGluZyBpcyB3b3JraW5nIC0gZmlyc3Qgb3JhY2xpemUgcmVxdWVzdCBpcyBmcmVlLgogICAgLy91cGRhdGUoMCk7CiAgfQoKICAvL3NlbmQgc29tZSBmdW5kcyBhbG9uZyB3aXRoIHRoZSBjYWxsIHRvIGNvdmVyIG9yYWNsaXplIGZlZXMKICBmdW5jdGlvbiBzdGFydFVwZGF0ZSh1aW50IHN0YXJ0aW5nUHJpY2UpIHBheWFibGUgb25seU93bmVyIGluTmV3U3RhdGUgcHVibGljIHsKICAgIHN0YXRlID0gU3RhdGUuQWN0aXZlOwoKICAgIGN1cnJlbnRQcmljZSA9IHN0YXJ0aW5nUHJpY2U7CiAgICB1cGRhdGUodXBkYXRlSW50ZXJ2YWwpOwogICAgbm90aWZ5V2F0Y2hlcigpOwogICAgTG9nU3RhcnRVcGRhdGUoc3RhcnRpbmdQcmljZSwgdXBkYXRlSW50ZXJ2YWwsIGJsb2NrLnRpbWVzdGFtcCk7CiAgfQoKICBmdW5jdGlvbiBzdG9wVXBkYXRlKCkgZXh0ZXJuYWwgb25seU93bmVyIGluQWN0aXZlU3RhdGUgewogICAgc3RhdGUgPSBTdGF0ZS5TdG9wcGVkOwogIH0KCiAgZnVuY3Rpb24gc2V0V2F0Y2hlcihhZGRyZXNzIG5ld1dhdGNoZXIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld1dhdGNoZXIgIT0gMHgwKTsKICAgIHdhdGNoZXIgPSBFVEhQcmljZVdhdGNoZXIobmV3V2F0Y2hlcik7CiAgfQoKICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgcHVibGljIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSAmJiB2YWxpZElkc1tteWlkXSk7CiAgICBkZWxldGUgdmFsaWRJZHNbbXlpZF07CgogICAgdWludCBuZXdQcmljZSA9IHBhcnNlSW50KHJlc3VsdCwgMik7CgogICAgaWYgKHN0YXRlID09IFN0YXRlLkFjdGl2ZSkgewogICAgICB1cGRhdGUodXBkYXRlSW50ZXJ2YWwpOwogICAgfQoKICAgIHJlcXVpcmUobmV3UHJpY2UgPiAwKTsKCiAgICBjdXJyZW50UHJpY2UgPSBuZXdQcmljZTsKCiAgICBub3RpZnlXYXRjaGVyKCk7CiAgICBMb2dQcmljZVVwZGF0ZWQocmVzdWx0LG5ld1ByaWNlLGJsb2NrLnRpbWVzdGFtcCk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGUodWludCBkZWxheSkgcHJpdmF0ZSB7CiAgICBpZiAob3JhY2xpemVfZ2V0UHJpY2UoIlVSTCIpID4gdGhpcy5iYWxhbmNlKSB7CiAgICAgIC8vc3RvcCBpZiB3ZSBkb24ndCBoYXZlIGVub3VnaCBmdW5kcyBhbnltb3JlCiAgICAgIHN0YXRlID0gU3RhdGUuU3RvcHBlZDsKICAgICAgTG9nT3JhY2xpemVRdWVyeSgiT3JhY2xpemUgcXVlcnkgd2FzIE5PVCBzZW50IiwgdGhpcy5iYWxhbmNlLGJsb2NrLnRpbWVzdGFtcCk7CiAgICB9IGVsc2UgewogICAgICBieXRlczMyIHF1ZXJ5SWQgPSBvcmFjbGl6ZV9xdWVyeShkZWxheSwgIlVSTCIsIHVybCwgZ2FzTGltaXQpOwogICAgICB2YWxpZElkc1txdWVyeUlkXSA9IHRydWU7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRRdW90ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gY3VycmVudFByaWNlOwogIH0KCn0KCmNvbnRyYWN0IENvbnZlcnRRdW90ZSBpcyBFVEhQcmljZVByb3ZpZGVyIHsKICAvL0VuY3J5cHRlZCBRdWVyeQogIGZ1bmN0aW9uIENvbnZlcnRRdW90ZSh1aW50IF9jdXJyZW50UHJpY2UpIEVUSFByaWNlUHJvdmlkZXIoIkJJYS9ObmoxK2lwWkJyckxJZ3BUc0k2dWtRVGxUSk1kMWMwaUM3enZ4eCtuWnpxOU9EZ0JTbUNMbzNaYzBzWVp3RDhtbHJ1QWk1RGJsUXZ0MmNHc2ZWZUN5cWF4dSsxbFdEMzI1a2dONm8wTHhyT1VXOU9RV24yQ09CM1R6Y1JMNTFRK1pMQnNUOTU1UzFPSmJPcXNmUTRnZy9sMmF3ZTJFRlZ1TzNXVHBydndLaEFhOHRqbDJpUFlVL0FKODNUVlA5S3B6K3VnVEp1bWx6Mlk2U1BCR01OY3ZCb1JxM01sbnJSMmgvWGRxUGJoM1MyYnhqYlNUTHd5Wnp1MkRBZ1Z0eWJQTzFvSkVUWT0iKSBwYXlhYmxlIHB1YmxpYyB7CiAgICBjdXJyZW50UHJpY2UgPSBfY3VycmVudFByaWNlOwogIH0KCiAgZnVuY3Rpb24gbm90aWZ5V2F0Y2hlcigpIGludGVybmFsIHsKICAgIGlmKGFkZHJlc3Mod2F0Y2hlcikgIT0gMHgwKSB7CiAgICAgIHdhdGNoZXIucmVjZWl2ZUV0aFByaWNlKGN1cnJlbnRQcmljZSk7CiAgICB9CiAgfQp9CgovKioKICogQHRpdGxlIENvbnRyYWN0IHRoYXQgd2lsbCB3b3JrIHdpdGggRVJDMjIzIHRva2Vucy4KICovCiAKY29udHJhY3QgRVJDMjIzUmVjZWl2aW5nQ29udHJhY3QgewoKICBzdHJ1Y3QgVEtOIHsKICAgIGFkZHJlc3Mgc2VuZGVyOwogICAgdWludCB2YWx1ZTsKICAgIGJ5dGVzIGRhdGE7CiAgICBieXRlczQgc2lnOwogIH0KCiAgLyoqCiAgICogQGRldiBTdGFuZGFyZCBFUkMyMjMgZnVuY3Rpb24gdGhhdCB3aWxsIGhhbmRsZSBpbmNvbWluZyB0b2tlbiB0cmFuc2ZlcnMuCiAgICoKICAgKiBAcGFyYW0gX2Zyb20gIFRva2VuIHNlbmRlciBhZGRyZXNzLgogICAqIEBwYXJhbSBfdmFsdWUgQW1vdW50IG9mIHRva2Vucy4KICAgKiBAcGFyYW0gX2RhdGEgIFRyYW5zYWN0aW9uIG1ldGFkYXRhLgogICAqLwogIGZ1bmN0aW9uIHRva2VuRmFsbGJhY2soYWRkcmVzcyBfZnJvbSwgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcHVyZSB7CiAgICBUS04gbWVtb3J5IHRrbjsKICAgIHRrbi5zZW5kZXIgPSBfZnJvbTsKICAgIHRrbi52YWx1ZSA9IF92YWx1ZTsKICAgIHRrbi5kYXRhID0gX2RhdGE7CiAgICBpZihfZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgIHVpbnQzMiB1ID0gdWludDMyKF9kYXRhWzNdKSArICh1aW50MzIoX2RhdGFbMl0pIDw8IDgpICsgKHVpbnQzMihfZGF0YVsxXSkgPDwgMTYpICsgKHVpbnQzMihfZGF0YVswXSkgPDwgMjQpOwogICAgICB0a24uc2lnID0gYnl0ZXM0KHUpOwogICAgfQoKICAgIC8qIHRrbiB2YXJpYWJsZSBpcyBhbmFsb2d1ZSBvZiBtc2cgdmFyaWFibGUgb2YgRXRoZXIgdHJhbnNhY3Rpb24KICAgICogIHRrbi5zZW5kZXIgaXMgcGVyc29uIHdobyBpbml0aWF0ZWQgdGhpcyB0b2tlbiB0cmFuc2FjdGlvbiAgIChhbmFsb2d1ZSBvZiBtc2cuc2VuZGVyKQogICAgKiAgdGtuLnZhbHVlIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRoYXQgd2VyZSBzZW50ICAgKGFuYWxvZ3VlIG9mIG1zZy52YWx1ZSkKICAgICogIHRrbi5kYXRhIGlzIGRhdGEgb2YgdG9rZW4gdHJhbnNhY3Rpb24gICAoYW5hbG9ndWUgb2YgbXNnLmRhdGEpCiAgICAqICB0a24uc2lnIGlzIDQgYnl0ZXMgc2lnbmF0dXJlIG9mIGZ1bmN0aW9uCiAgICAqICBpZiBkYXRhIG9mIHRva2VuIHRyYW5zYWN0aW9uIGlzIGEgZnVuY3Rpb24gZXhlY3V0aW9uCiAgICAqLwogIH0KCn0KCmNvbnRyYWN0IEVSQzIyM0ludGVyZmFjZSB7CiAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKICBmdW5jdGlvbiBhbGxvd2VkQWRkcmVzc2VzT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGdldFRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIG9rKTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBvayk7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCB2YWx1ZSwgYnl0ZXMgZGF0YSwgc3RyaW5nIGN1c3RvbV9mYWxsYmFjaykgcHVibGljIHJldHVybnMgKGJvb2wgb2spOwoKICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50IHZhbHVlLCBieXRlcyBkYXRhKTsKICBldmVudCBUcmFuc2ZlckNvbnRyYWN0KGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUsIGJ5dGVzIGRhdGEpOwp9CgovKioKICogQHRpdGxlIFVuaXR5IFRva2VuIGlzIEVSQzIyMyB0b2tlbi4KICogQGF1dGhvciBWbGFkaW1pciBLb3ZhbGNodWsKICovCgpjb250cmFjdCBVbml0eVRva2VuIGlzIEVSQzIyM0ludGVyZmFjZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CgogIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJVbml0eSBUb2tlbiI7CiAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiVU5UIjsKICB1aW50OCBwdWJsaWMgY29uc3RhbnQgZGVjaW1hbHMgPSAxODsKCgogIC8qIFRoZSBzdXBwbHkgaXMgaW5pdGlhbGx5IDEwMFVOVCB0byB0aGUgcHJlY2lzaW9uIG9mIDE4IGRlY2ltYWxzICovCiAgdWludCBwdWJsaWMgY29uc3RhbnQgSU5JVElBTF9TVVBQTFkgPSAxMDAwMDAgKiAoMTAgKiogdWludChkZWNpbWFscykpOwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgYmFsYW5jZXM7IC8vIExpc3Qgb2YgdXNlciBiYWxhbmNlcy4KICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgYWxsb3dlZEFkZHJlc3NlczsKCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBhZGRBbGxvd2VkKGFkZHJlc3MgbmV3QWRkcmVzcykgcHVibGljIG9ubHlPd25lciB7CiAgICBhbGxvd2VkQWRkcmVzc2VzW25ld0FkZHJlc3NdID0gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZUFsbG93ZWQoYWRkcmVzcyByZW1BZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGFsbG93ZWRBZGRyZXNzZXNbcmVtQWRkcmVzc10gPSBmYWxzZTsKICB9CgoKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKCiAgLyogQ29uc3RydWN0b3IgaW5pdGlhbGl6ZXMgdGhlIG93bmVyJ3MgYmFsYW5jZSBhbmQgdGhlIHN1cHBseSAgKi8KICBmdW5jdGlvbiBVbml0eVRva2VuKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIHRvdGFsU3VwcGx5ID0gSU5JVElBTF9TVVBQTFk7CiAgICBiYWxhbmNlc1tvd25lcl0gPSBJTklUSUFMX1NVUFBMWTsKICB9CgogIGZ1bmN0aW9uIGdldFRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRvdGFsU3VwcGx5OwogIH0KCiAgLy8gRnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiBhIHVzZXIgb3IgYW5vdGhlciBjb250cmFjdCB3YW50cyB0byB0cmFuc2ZlciBmdW5kcyAuCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlLCBieXRlcyBfZGF0YSwgc3RyaW5nIF9jdXN0b21fZmFsbGJhY2spIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgIGlmIChpc0NvbnRyYWN0KF90bykpIHsKICAgICAgcmVxdWlyZShhbGxvd2VkQWRkcmVzc2VzW190b10pOwogICAgICBpZiAoYmFsYW5jZU9mKG1zZy5zZW5kZXIpIDwgX3ZhbHVlKQogICAgICAgIHJldmVydCgpOwoKICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgIGFzc2VydChfdG8uY2FsbC52YWx1ZSgwKShieXRlczQoa2VjY2FrMjU2KF9jdXN0b21fZmFsbGJhY2spKSwgbXNnLnNlbmRlciwgX3ZhbHVlLCBfZGF0YSkpOwogICAgICBUcmFuc2ZlckNvbnRyYWN0KG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZWxzZSB7CiAgICAgIHJldHVybiB0cmFuc2ZlclRvQWRkcmVzcyhfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgfQogIH0KCgogIC8vIEZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW4gYSB1c2VyIG9yIGFub3RoZXIgY29udHJhY3Qgd2FudHMgdG8gdHJhbnNmZXIgZnVuZHMgLgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKCiAgICBpZiAoaXNDb250cmFjdChfdG8pKSB7CiAgICAgIHJldHVybiB0cmFuc2ZlclRvQ29udHJhY3QoX3RvLCBfdmFsdWUsIF9kYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0cmFuc2ZlclRvQWRkcmVzcyhfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgfQogIH0KCiAgLy8gU3RhbmRhcmQgZnVuY3Rpb24gdHJhbnNmZXIgc2ltaWxhciB0byBFUkMyMCB0cmFuc2ZlciB3aXRoIG5vIF9kYXRhIC4KICAvLyBBZGRlZCBkdWUgdG8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgcmVhc29ucyAuCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvL3N0YW5kYXJkIGZ1bmN0aW9uIHRyYW5zZmVyIHNpbWlsYXIgdG8gRVJDMjAgdHJhbnNmZXIgd2l0aCBubyBfZGF0YQogICAgLy9hZGRlZCBkdWUgdG8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgcmVhc29ucwogICAgYnl0ZXMgbWVtb3J5IGVtcHR5OwogICAgaWYgKGlzQ29udHJhY3QoX3RvKSkgewogICAgICByZXR1cm4gdHJhbnNmZXJUb0NvbnRyYWN0KF90bywgX3ZhbHVlLCBlbXB0eSk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgcmV0dXJuIHRyYW5zZmVyVG9BZGRyZXNzKF90bywgX3ZhbHVlLCBlbXB0eSk7CiAgICB9CiAgfQoKICAvL2Fzc2VtYmxlIHRoZSBnaXZlbiBhZGRyZXNzIGJ5dGVjb2RlLiBJZiBieXRlY29kZSBleGlzdHMgdGhlbiB0aGUgX2FkZHIgaXMgYSBjb250cmFjdC4KICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIHByaXZhdGUgdmlldyByZXR1cm5zIChib29sIGlzX2NvbnRyYWN0KSB7CiAgICB1aW50IGxlbmd0aDsKICAgIGFzc2VtYmx5IHsKICAgIC8vcmV0cmlldmUgdGhlIHNpemUgb2YgdGhlIGNvZGUgb24gdGFyZ2V0IGFkZHJlc3MsIHRoaXMgbmVlZHMgYXNzZW1ibHkKICAgICAgbGVuZ3RoIDo9IGV4dGNvZGVzaXplKF9hZGRyKQogICAgfQogICAgcmV0dXJuIChsZW5ndGggPiAwKTsKICB9CgogIC8vZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0cmFuc2FjdGlvbiB0YXJnZXQgaXMgYW4gYWRkcmVzcwogIGZ1bmN0aW9uIHRyYW5zZmVyVG9BZGRyZXNzKGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYnl0ZXMgX2RhdGEpIHByaXZhdGUgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBpZiAoYmFsYW5jZU9mKG1zZy5zZW5kZXIpIDwgX3ZhbHVlKQogICAgICByZXZlcnQoKTsKICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlLCBfZGF0YSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8vZnVuY3Rpb24gdGhhdCBpcyBjYWxsZWQgd2hlbiB0cmFuc2FjdGlvbiB0YXJnZXQgaXMgYSBjb250cmFjdAogIGZ1bmN0aW9uIHRyYW5zZmVyVG9Db250cmFjdChhZGRyZXNzIF90bywgdWludCBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwcml2YXRlIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgcmVxdWlyZShhbGxvd2VkQWRkcmVzc2VzW190b10pOwogICAgaWYgKGJhbGFuY2VPZihtc2cuc2VuZGVyKSA8IF92YWx1ZSkKICAgICAgcmV2ZXJ0KCk7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IGJhbGFuY2VzW21zZy5zZW5kZXJdLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCByZWNlaXZlciA9IEVSQzIyM1JlY2VpdmluZ0NvbnRyYWN0KF90byk7CiAgICByZWNlaXZlci50b2tlbkZhbGxiYWNrKG1zZy5zZW5kZXIsIF92YWx1ZSwgX2RhdGEpOwogICAgVHJhbnNmZXJDb250cmFjdChtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSwgX2RhdGEpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCiAgZnVuY3Rpb24gYWxsb3dlZEFkZHJlc3Nlc09mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sIGFsbG93ZWQpIHsKICAgIHJldHVybiBhbGxvd2VkQWRkcmVzc2VzW19vd25lcl07CiAgfQp9CgovKioKICogQHRpdGxlIEhvbGQgIGNvbnRyYWN0LgogKiBAYXV0aG9yIFZsYWRpbWlyIEtvdmFsY2h1awogKi8KY29udHJhY3QgSG9sZCBpcyBPd25hYmxlIHsKCiAgICB1aW50OCBzdGFnZXMgPSA1OwogICAgdWludDggcHVibGljIHBlcmNlbnRhZ2U7CiAgICB1aW50OCBwdWJsaWMgY3VycmVudFN0YWdlOwogICAgdWludCBwdWJsaWMgaW5pdGlhbEJhbGFuY2U7CiAgICB1aW50IHB1YmxpYyB3aXRoZHJhd2VkOwogICAgCiAgICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZzsKICAgIFJlZ2lzdHJ5IHJlZ2lzdHJ5OwoKICAgIFBlcm1pc3Npb25NYW5hZ2VyIHB1YmxpYyBwZXJtaXNzaW9uTWFuYWdlcjsKICAgIHVpbnQgbmV4dENvbnRyaWJ1dG9yVG9UcmFuc2ZlckV0aDsKICAgIGFkZHJlc3MgcHVibGljIG9ic2VydmVyOwogICAgdWludCBkYXRlRGVwbG95ZWQ7CiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHJpdmF0ZSBoYXNXaXRoZHJhd2VkRXRoOwoKICAgIGV2ZW50IEluaXRpYWxCYWxhbmNlQ2hhbmdlZCh1aW50IGJhbGFuY2UpOwogICAgZXZlbnQgRXRoUmVsZWFzZWQodWludCBldGhyZWxlYXNlZCk7CiAgICBldmVudCBFdGhSZWZ1bmRlZChhZGRyZXNzIGNvbnRyaWJ1dG9yLCB1aW50IGV0aHJlZnVuZGVkKTsKICAgIGV2ZW50IFN0YWdlQ2hhbmdlZCh1aW50OCBuZXdTdGFnZSk7CiAgICBldmVudCBFdGhSZXR1cm5lZFRvT3duZXIoYWRkcmVzcyBvd25lciwgdWludCBiYWxhbmNlKTsKCiAgICBtb2RpZmllciBvbmx5UGVybWl0dGVkKCkgewogICAgICAgIHJlcXVpcmUocGVybWlzc2lvbk1hbmFnZXIuaXNQZXJtaXR0ZWQobXNnLnNlbmRlcikgfHwgbXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T2JzZXJ2ZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG9ic2VydmVyIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gSG9sZChhZGRyZXNzIF9tdWx0aXNpZywgdWludCBjYXAsIGFkZHJlc3MgcG0sIGFkZHJlc3MgcmVnaXN0cnlBZGRyZXNzLCBhZGRyZXNzIG9ic2VydmVyQWRkcikgcHVibGljIHsKICAgICAgICBwZXJjZW50YWdlID0gMTAwIC8gc3RhZ2VzOwogICAgICAgIGN1cnJlbnRTdGFnZSA9IDA7CiAgICAgICAgbXVsdGlzaWcgPSBfbXVsdGlzaWc7CiAgICAgICAgaW5pdGlhbEJhbGFuY2UgPSBjYXA7CiAgICAgICAgZGF0ZURlcGxveWVkID0gbm93OwogICAgICAgIHBlcm1pc3Npb25NYW5hZ2VyID0gUGVybWlzc2lvbk1hbmFnZXIocG0pOwogICAgICAgIHJlZ2lzdHJ5ID0gUmVnaXN0cnkocmVnaXN0cnlBZGRyZXNzKTsKICAgICAgICBvYnNlcnZlciA9IG9ic2VydmVyQWRkcjsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRQZXJtaXNzaW9uTWFuYWdlcihhZGRyZXNzIF9wZXJtYWRyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9wZXJtYWRyICE9IDB4MCk7CiAgICAgICAgcGVybWlzc2lvbk1hbmFnZXIgPSBQZXJtaXNzaW9uTWFuYWdlcihfcGVybWFkcik7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0T2JzZXJ2ZXIoYWRkcmVzcyBvYnNlcnZlckFkZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUob2JzZXJ2ZXJBZGRyICE9IDB4MCk7CiAgICAgICAgb2JzZXJ2ZXIgPSBvYnNlcnZlckFkZHI7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0SW5pdGlhbEJhbGFuY2UodWludCBpbkJhbCkgcHVibGljIHsKICAgICAgICBpbml0aWFsQmFsYW5jZSA9IGluQmFsOwogICAgICAgIEluaXRpYWxCYWxhbmNlQ2hhbmdlZChpbkJhbCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVsZWFzZUFsbEVUSCgpIG9ubHlQZXJtaXR0ZWQgcHVibGljIHsKICAgICAgICB1aW50IGJhbFJlbGVhc2VkID0gZ2V0QmFsYW5jZVJlbGVhc2VkKCk7CiAgICAgICAgcmVxdWlyZShiYWxSZWxlYXNlZCA+IDApOwogICAgICAgIHJlcXVpcmUodGhpcy5iYWxhbmNlID49IGJhbFJlbGVhc2VkKTsKICAgICAgICBtdWx0aXNpZy50cmFuc2ZlcihiYWxSZWxlYXNlZCk7CiAgICAgICAgd2l0aGRyYXdlZCArPSBiYWxSZWxlYXNlZDsKICAgICAgICBFdGhSZWxlYXNlZChiYWxSZWxlYXNlZCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVsZWFzZUVUSCh1aW50IG4pIG9ubHlQZXJtaXR0ZWQgcHVibGljIHsKICAgICAgICByZXF1aXJlKHRoaXMuYmFsYW5jZSA+PSBuKTsKICAgICAgICByZXF1aXJlKGdldEJhbGFuY2VSZWxlYXNlZCgpID49IG4pOwogICAgICAgIG11bHRpc2lnLnRyYW5zZmVyKG4pOwogICAgICAgIHdpdGhkcmF3ZWQgKz0gbjsKICAgICAgICBFdGhSZWxlYXNlZChuKTsKICAgIH0gCgogICAgZnVuY3Rpb24gZ2V0QmFsYW5jZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVN0YWdlQW5kUmVsZWFzZUVUSCgpIHB1YmxpYyBvbmx5T2JzZXJ2ZXIgewogICAgICAgIHVpbnQ4IG5ld1N0YWdlID0gY3VycmVudFN0YWdlICsgMTsKICAgICAgICByZXF1aXJlKG5ld1N0YWdlIDw9IHN0YWdlcyk7CiAgICAgICAgY3VycmVudFN0YWdlID0gbmV3U3RhZ2U7CiAgICAgICAgU3RhZ2VDaGFuZ2VkKG5ld1N0YWdlKTsKICAgICAgICByZWxlYXNlQWxsRVRIKCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlU3RhZ2UoKSBwdWJsaWMgb25seU9ic2VydmVyIHsKICAgICAgICB1aW50OCBuZXdTdGFnZSA9IGN1cnJlbnRTdGFnZSArIDE7CiAgICAgICAgcmVxdWlyZShuZXdTdGFnZSA8PSBzdGFnZXMpOwogICAgICAgIGN1cnJlbnRTdGFnZSA9IG5ld1N0YWdlOwogICAgICAgIFN0YWdlQ2hhbmdlZChuZXdTdGFnZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QmFsYW5jZVJlbGVhc2VkKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBpbml0aWFsQmFsYW5jZSAqIHBlcmNlbnRhZ2UgKiBjdXJyZW50U3RhZ2UgLyAxMDAgLSB3aXRoZHJhd2VkIDsKICAgIH0KCiAgICBmdW5jdGlvbiByZXR1cm5FVEhCeU93bmVyKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShub3cgPiBkYXRlRGVwbG95ZWQgKyAxODMgZGF5cyk7CiAgICAgICAgdWludCBiYWxhbmNlID0gZ2V0QmFsYW5jZSgpOwogICAgICAgIG93bmVyLnRyYW5zZmVyKGdldEJhbGFuY2UoKSk7CiAgICAgICAgRXRoUmV0dXJuZWRUb093bmVyKG93bmVyLCBiYWxhbmNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWZ1bmQodWludCBfbnVtYmVyT2ZSZXR1cm5zKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9udW1iZXJPZlJldHVybnMgPiAwKTsKICAgICAgICBhZGRyZXNzIGN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3M7CgogICAgICAgIGZvciAodWludCBjbnQgPSAwOyBjbnQgPCBfbnVtYmVyT2ZSZXR1cm5zOyBjbnQrKykgewogICAgICAgICAgICBjdXJyZW50UGFydGljaXBhbnRBZGRyZXNzID0gcmVnaXN0cnkuZ2V0Q29udHJpYnV0b3JCeUluZGV4KG5leHRDb250cmlidXRvclRvVHJhbnNmZXJFdGgpOwogICAgICAgICAgICBpZiAoY3VycmVudFBhcnRpY2lwYW50QWRkcmVzcyA9PSAweDApIAogICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgaWYgKCFoYXNXaXRoZHJhd2VkRXRoW2N1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3NdKSB7CiAgICAgICAgICAgICAgICB1aW50IEV0aEFtb3VudCA9IHJlZ2lzdHJ5LmdldENvbnRyaWJ1dGlvbkVUSChjdXJyZW50UGFydGljaXBhbnRBZGRyZXNzKTsKICAgICAgICAgICAgICAgIEV0aEFtb3VudCAtPSAgRXRoQW1vdW50ICogKHBlcmNlbnRhZ2UgLyAxMDAgKiBjdXJyZW50U3RhZ2UpOwoKICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3MudHJhbnNmZXIoRXRoQW1vdW50KTsKICAgICAgICAgICAgICAgIEV0aFJlZnVuZGVkKGN1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3MsIEV0aEFtb3VudCk7CiAgICAgICAgICAgICAgICBoYXNXaXRoZHJhd2VkRXRoW2N1cnJlbnRQYXJ0aWNpcGFudEFkZHJlc3NdID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0Q29udHJpYnV0b3JUb1RyYW5zZmVyRXRoICs9IDE7CiAgICAgICAgfQogICAgICAgIAogICAgfSAgCgogICAgZnVuY3Rpb24oKSBwdWJsaWMgcGF5YWJsZSB7CgogICAgfQoKICBmdW5jdGlvbiBnZXRXaXRoZHJhd2VkKGFkZHJlc3MgY29udHJpYikgcHVibGljIG9ubHlQZXJtaXR0ZWQgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gaGFzV2l0aGRyYXdlZEV0aFtjb250cmliXTsKICB9Cn0KCmNvbnRyYWN0IENyb3dkc2FsZSBpcyBQYXVzYWJsZSwgRVRIUHJpY2VXYXRjaGVyLCBFUkMyMjNSZWNlaXZpbmdDb250cmFjdCB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIFVuaXR5VG9rZW4gcHVibGljIHRva2VuOwoKICBIb2xkIGhvbGQ7CiAgQ29udmVydFF1b3RlIGNvbnZlcnQ7CiAgUmVnaXN0cnkgcmVnaXN0cnk7CgogIGVudW0gU2FsZVN0YXRlICB7TkVXLCBTQUxFLCBFTkRFRCwgUkVGVU5EfQoKICAvLyBtaW5pbXVtIGdvYWwgVVNECiAgdWludCBwdWJsaWMgc29mdENhcDsKICAvLyBtYXhpbXVtIGdvYWwgVVNECiAgdWludCBwdWJsaWMgaGFyZENhcDsKICAvLyBtYXhpbXVtIGdvYWwgVU5UCiAgdWludCBwdWJsaWMgaGFyZENhcFRva2VuOwoKICAvLyBzdGFydCBhbmQgZW5kIHRpbWVzdGFtcHMgd2hlcmUgaW52ZXN0bWVudHMgYXJlIGFsbG93ZWQKICB1aW50IHB1YmxpYyBzdGFydERhdGU7CiAgdWludCBwdWJsaWMgZW5kRGF0ZTsKCiAgdWludCBwdWJsaWMgZXRoVXNkUHJpY2U7IC8vIGluIGNlbnRzCiAgdWludCBwdWJsaWMgdG9rZW5VU0RSYXRlOyAvLyBpbiBjZW50cwoKICAvLyB0b3RhbCBFVEggY29sbGVjdGVkCiAgdWludCBwcml2YXRlIGV0aFJhaXNlZDsKICAvLyB0b3RhbCBVU0QgY29sbGVjdGVkCiAgdWludCBwcml2YXRlIHVzZFJhaXNlZDsKCiAgLy8gdG90YWwgdG9rZW4gc2FsZXMKICB1aW50IHByaXZhdGUgdG90YWxUb2tlbnM7CiAgLy8gaG93IG1hbnkgdG9rZW5zIHNlbnQgdG8gaW52ZXN0b3JzCiAgdWludCBwdWJsaWMgd2l0aGRyYXdlZFRva2VuczsKICAvLyBtaW5pbXVtIEVUSCBpbnZlc3RtZW50IGFtb3VudAogIHVpbnQgcHVibGljIG1pbmltYWxDb250cmlidXRpb247CgogIGJvb2wgcmVsZWFzZWRUb2tlbnM7CiAgQnVpbGRpbmdTdGF0dXMgcHVibGljIHN0YXR1c0k7CgogIFBlcm1pc3Npb25NYW5hZ2VyIHB1YmxpYyBwZXJtaXNzaW9uTWFuYWdlcjsKCiAgLy9taW5pbXVtIG9mIHRva2VucyB0aGF0IG11c3QgYmUgb24gdGhlIGNvbnRyYWN0IGZvciB0aGUgc3RhcnQKICB1aW50IHByaXZhdGUgbWluaW11bVRva2Vuc1RvU3RhcnQ7CiAgU2FsZVN0YXRlIHB1YmxpYyBzdGF0ZTsKCiAgdWludCBwcml2YXRlIG5leHRDb250cmlidXRvclRvQ2xhaW07CiAgdWludCBwcml2YXRlIG5leHRDb250cmlidXRvclRvVHJhbnNmZXJUb2tlbnM7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiBib29sKSBwcml2YXRlIGhhc1dpdGhkcmF3ZWRUb2tlbnM7IC8vYWRkcmVzcyB3aG8gZ290IGEgdG9rZW5zCiAgbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHByaXZhdGUgaGFzUmVmdW5kZWQ7IC8vYWRkcmVzcyB3aG8gZ290IGEgdG9rZW5zCgogIC8qIEV2ZW50cyAqLwogIGV2ZW50IENyb3dkc2FsZVN0YXJ0ZWQodWludCBibG9ja051bWJlcik7CiAgZXZlbnQgQ3Jvd2RzYWxlRW5kZWQodWludCBibG9ja051bWJlcik7CiAgZXZlbnQgU29mdENhcFJlYWNoZWQodWludCBibG9ja051bWJlcik7CiAgZXZlbnQgSGFyZENhcFJlYWNoZWQodWludCBibG9ja051bWJlcik7CiAgZXZlbnQgQ29udHJpYnV0aW9uQWRkZWQoYWRkcmVzcyBjb250cmliLCB1aW50IGFtb3VudCwgdWludCBhbXVzZCwgdWludCB0b2tlbnMsIHVpbnQgZXRodXNkcmF0ZSk7CiAgZXZlbnQgQ29udHJpYnV0aW9uQWRkZWRNYW51YWwoYWRkcmVzcyBjb250cmliLCB1aW50IGFtb3VudCwgdWludCBhbXVzZCwgdWludCB0b2tlbnMsIHVpbnQgZXRodXNkcmF0ZSk7CiAgZXZlbnQgQ29udHJpYnV0aW9uRWRpdChhZGRyZXNzIGNvbnRyaWIsIHVpbnQgYW1vdW50LCB1aW50IGFtdXNkLCB1aW50IHRva2VucywgdWludCBldGh1c2RyYXRlKTsKICBldmVudCBDb250cmlidXRpb25SZW1vdmVkKGFkZHJlc3MgY29udHJpYiwgdWludCBhbW91bnQsIHVpbnQgYW11c2QsIHVpbnQgdG9rZW5zKTsKICBldmVudCBUb2tlbnNUcmFuc2ZlcmVkKGFkZHJlc3MgY29udHJpYnV0b3IsIHVpbnQgYW1vdW50KTsKICBldmVudCBSZWZ1bmRlZChhZGRyZXNzIHJlZiwgdWludCBhbW91bnQpOwogIGV2ZW50IEVycm9yU2VuZGluZ0VUSChhZGRyZXNzIHRvLCB1aW50IGFtb3VudCk7CiAgZXZlbnQgV2l0aGRyYXdlZEV0aFRvSG9sZCh1aW50IGFtb3VudCk7CiAgZXZlbnQgTWFudWFsQ2hhbmdlU3RhcnREYXRlKHVpbnQgYmVmb3JlRGF0ZSwgdWludCBhZnRlckRhdGUpOwogIGV2ZW50IE1hbnVhbENoYW5nZUVuZERhdGUodWludCBiZWZvcmVEYXRlLCB1aW50IGFmdGVyRGF0ZSk7CiAgZXZlbnQgVG9rZW5zVHJhbnNmZXJlZFRvSG9sZChhZGRyZXNzIGhvbGQsIHVpbnQgYW1vdW50KTsKICBldmVudCBUb2tlbnNUcmFuc2ZlcmVkVG9Pd25lcihhZGRyZXNzIGhvbGQsIHVpbnQgYW1vdW50KTsKICBldmVudCBDaGFuZ2VNaW5BbW91bnQodWludCBvbGRNaW5BbW91bnQsIHVpbnQgbWluQW1vdW50KTsKICBldmVudCBDaGFuZ2VQcmVTYWxlKGFkZHJlc3MgcHJlU2FsZSk7CiAgZXZlbnQgQ2hhbmdlVG9rZW5VU0RSYXRlKHVpbnQgb2xkVG9rZW5VU0RSYXRlLCB1aW50IHRva2VuVVNEUmF0ZSk7CiAgZXZlbnQgQ2hhbmdlSGFyZENhcFRva2VuKHVpbnQgb2xkSGFyZENhcFRva2VuLCB1aW50IG5ld0hhcmRDYXBUb2tlbik7CiAgZXZlbnQgU29mdENhcENoYW5nZWQoKTsKICBldmVudCBIYXJkQ2FwQ2hhbmdlZCgpOwoKICBtb2RpZmllciBvbmx5UGVybWl0dGVkKCkgewogICAgcmVxdWlyZShwZXJtaXNzaW9uTWFuYWdlci5pc1Blcm1pdHRlZChtc2cuc2VuZGVyKSB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBDcm93ZHNhbGUoCiAgICBhZGRyZXNzIHRva2VuQWRkcmVzcywKICAgIGFkZHJlc3MgcmVnaXN0cnlBZGRyZXNzLAogICAgYWRkcmVzcyBfcGVybWlzc2lvbk1hbmFnZXIsCiAgICB1aW50IHN0YXJ0LAogICAgdWludCBlbmQsCiAgICB1aW50IF9zb2Z0Q2FwLAogICAgdWludCBfaGFyZENhcCwKICAgIGFkZHJlc3MgaG9sZENvbnQsCiAgICB1aW50IF9ldGhVc2RQcmljZSkgcHVibGljCiAgewogICAgdG9rZW4gPSBVbml0eVRva2VuKHRva2VuQWRkcmVzcyk7CiAgICBwZXJtaXNzaW9uTWFuYWdlciA9IFBlcm1pc3Npb25NYW5hZ2VyKF9wZXJtaXNzaW9uTWFuYWdlcik7CiAgICBzdGF0ZSA9IFNhbGVTdGF0ZS5ORVc7CgogICAgc3RhcnREYXRlID0gc3RhcnQ7CiAgICBlbmREYXRlID0gZW5kOwogICAgbWluaW1hbENvbnRyaWJ1dGlvbiA9IDAuMyAqIDEgZXRoZXI7CiAgICB0b2tlblVTRFJhdGUgPSA0NDUwMDsgLy80NDUuMDAkIGluIGNlbnRzCiAgICByZWxlYXNlZFRva2VucyA9IGZhbHNlOwoKICAgIHNvZnRDYXAgPSBfc29mdENhcCAqIDEgZXRoZXI7CiAgICBoYXJkQ2FwID0gX2hhcmRDYXAgKiAxIGV0aGVyOwogICAgaGFyZENhcFRva2VuID0gMTAwMDAwICogMSBldGhlcjsKCiAgICBldGhVc2RQcmljZSA9IF9ldGhVc2RQcmljZTsKCiAgICBob2xkID0gSG9sZChob2xkQ29udCk7CiAgICByZWdpc3RyeSA9IFJlZ2lzdHJ5KHJlZ2lzdHJ5QWRkcmVzcyk7CiAgfQoKCiAgZnVuY3Rpb24gc2V0UGVybWlzc2lvbk1hbmFnZXIoYWRkcmVzcyBfcGVybWFkcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKF9wZXJtYWRyICE9IDB4MCk7CiAgICBwZXJtaXNzaW9uTWFuYWdlciA9IFBlcm1pc3Npb25NYW5hZ2VyKF9wZXJtYWRyKTsKICB9CgoKICBmdW5jdGlvbiBzZXRSZWdpc3RyeShhZGRyZXNzIF9yZWdhZHIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShfcmVnYWRyICE9IDB4MCk7CiAgICByZWdpc3RyeSA9IFJlZ2lzdHJ5KF9yZWdhZHIpOwogIH0KCiAgZnVuY3Rpb24gc2V0VG9rZW5VU0RSYXRlKHVpbnQgX3Rva2VuVVNEUmF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKF90b2tlblVTRFJhdGUgPiAwKTsKICAgIHVpbnQgb2xkVG9rZW5VU0RSYXRlID0gdG9rZW5VU0RSYXRlOwogICAgdG9rZW5VU0RSYXRlID0gX3Rva2VuVVNEUmF0ZTsKICAgIENoYW5nZVRva2VuVVNEUmF0ZShvbGRUb2tlblVTRFJhdGUsIF90b2tlblVTRFJhdGUpOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5VU0RSYXRlKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRva2VuVVNEUmF0ZTsKICB9CgogIGZ1bmN0aW9uIHJlY2VpdmVFdGhQcmljZSh1aW50IF9ldGhVc2RQcmljZSkgZXh0ZXJuYWwgb25seUV0aFByaWNlUHJvdmlkZXIgewogICAgcmVxdWlyZShfZXRoVXNkUHJpY2UgPiAwKTsKICAgIGV0aFVzZFByaWNlID0gX2V0aFVzZFByaWNlOwogIH0KCiAgZnVuY3Rpb24gc2V0RXRoUHJpY2VQcm92aWRlcihhZGRyZXNzIHByb3ZpZGVyKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgcmVxdWlyZShwcm92aWRlciAhPSAweDApOwogICAgZXRoUHJpY2VQcm92aWRlciA9IHByb3ZpZGVyOwogIH0KCiAgLyogU2V0dGVycyAqLwogIGZ1bmN0aW9uIHNldEhvbGQoYWRkcmVzcyBob2xkQ29udCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKGhvbGRDb250ICE9IDB4MCk7CiAgICBob2xkID0gSG9sZChob2xkQ29udCk7CiAgfQoKICBmdW5jdGlvbiBzZXRUb2tlbihhZGRyZXNzIHRva0NvbnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZSh0b2tDb250ICE9IDB4MCk7CiAgICB0b2tlbiA9IFVuaXR5VG9rZW4odG9rQ29udCk7CiAgfQoKICBmdW5jdGlvbiBzZXRTdGF0dXNJKGFkZHJlc3Mgc3RhdEkpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShzdGF0SSAhPSAweDApOwogICAgc3RhdHVzSSA9IEJ1aWxkaW5nU3RhdHVzKHN0YXRJKTsKICB9CgogIGZ1bmN0aW9uIHNldFN0YXJ0RGF0ZSh1aW50IGRhdGUpIHB1YmxpYyBvbmx5T3duZXIgewogICAgdWludCBvbGRTdGFydERhdGUgPSBzdGFydERhdGU7CiAgICBzdGFydERhdGUgPSBkYXRlOwogICAgTWFudWFsQ2hhbmdlU3RhcnREYXRlKG9sZFN0YXJ0RGF0ZSwgZGF0ZSk7CiAgfQoKICBmdW5jdGlvbiBzZXRFbmREYXRlKHVpbnQgZGF0ZSkgcHVibGljIG9ubHlPd25lciB7CiAgICB1aW50IG9sZEVuZERhdGUgPSBlbmREYXRlOwogICAgZW5kRGF0ZSA9IGRhdGU7CiAgICBNYW51YWxDaGFuZ2VFbmREYXRlKG9sZEVuZERhdGUsIGRhdGUpOwogIH0KCiAgZnVuY3Rpb24gc2V0U29mdENhcCh1aW50IF9zb2Z0Q2FwKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHNvZnRDYXAgPSBfc29mdENhcCAqIDEgZXRoZXI7CiAgICBTb2Z0Q2FwQ2hhbmdlZCgpOwogIH0KCiAgZnVuY3Rpb24gc2V0SGFyZENhcCh1aW50IF9oYXJkQ2FwKSBwdWJsaWMgb25seU93bmVyIHsKICAgIGhhcmRDYXAgPSBfaGFyZENhcCAqIDEgZXRoZXI7CiAgICBIYXJkQ2FwQ2hhbmdlZCgpOwogIH0KCiAgZnVuY3Rpb24gc2V0TWluaW1hbENvbnRyaWJ1dGlvbih1aW50IG1pbmltdW1BbW91bnQpIHB1YmxpYyBvbmx5T3duZXIgewogICAgdWludCBvbGRNaW5BbW91bnQgPSBtaW5pbWFsQ29udHJpYnV0aW9uOwogICAgbWluaW1hbENvbnRyaWJ1dGlvbiA9IG1pbmltdW1BbW91bnQ7CiAgICBDaGFuZ2VNaW5BbW91bnQob2xkTWluQW1vdW50LCBtaW5pbWFsQ29udHJpYnV0aW9uKTsKICB9CgogIGZ1bmN0aW9uIHNldEhhcmRDYXBUb2tlbih1aW50IF9oYXJkQ2FwVG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShfaGFyZENhcFRva2VuID4gMSBldGhlcik7IC8vID4gMSBVTlQKICAgIHVpbnQgb2xkSGFyZENhcFRva2VuID0gX2hhcmRDYXBUb2tlbjsKICAgIGhhcmRDYXBUb2tlbiA9IF9oYXJkQ2FwVG9rZW47CiAgICBDaGFuZ2VIYXJkQ2FwVG9rZW4ob2xkSGFyZENhcFRva2VuLCBoYXJkQ2FwVG9rZW4pOwogIH0KCiAgLyogVGhlIGZ1bmN0aW9uIHdpdGhvdXQgbmFtZSBpcyB0aGUgZGVmYXVsdCBmdW5jdGlvbiB0aGF0IGlzIGNhbGxlZCB3aGVuZXZlciBhbnlvbmUgc2VuZHMgZnVuZHMgdG8gYSBjb250cmFjdCAqLwogIGZ1bmN0aW9uKCkgd2hlbk5vdFBhdXNlZCBwdWJsaWMgcGF5YWJsZSB7CiAgICByZXF1aXJlKHN0YXRlID09IFNhbGVTdGF0ZS5TQUxFKTsKICAgIHJlcXVpcmUobm93ID49IHN0YXJ0RGF0ZSk7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA+PSBtaW5pbWFsQ29udHJpYnV0aW9uKTsKCiAgICBib29sIGNrZWNrID0gY2hlY2tDcm93ZHNhbGVTdGF0ZShtc2cudmFsdWUpOwoKICAgIGlmKGNrZWNrKSB7CiAgICAgIHByb2Nlc3NUcmFuc2FjdGlvbihtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcihtc2cudmFsdWUpOwogICAgfQogIH0KCiAgLyoqCiAgICogQGRldiBDaGVja3MgaWYgdGhlIGdvYWwgb3IgdGltZSBsaW1pdCBoYXMgYmVlbiByZWFjaGVkIGFuZCBlbmRzIHRoZSBjYW1wYWlnbgogICAqIEByZXR1cm4gZmFsc2Ugd2hlbiBjb250cmFjdCBkb2VzIG5vdCBhY2NlcHQgdG9rZW5zCiAgICovCiAgZnVuY3Rpb24gY2hlY2tDcm93ZHNhbGVTdGF0ZSh1aW50IF9hbW91bnQpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgIHVpbnQgdXNkID0gX2Ftb3VudC5tdWwoZXRoVXNkUHJpY2UpOwogICAgaWYgKHVzZFJhaXNlZC5hZGQodXNkKSA+PSBoYXJkQ2FwKSB7CiAgICAgIHN0YXRlID0gU2FsZVN0YXRlLkVOREVEOwogICAgICBzdGF0dXNJLnNldFN0YXR1cyhCdWlsZGluZ1N0YXR1cy5zdGF0dXNFbnVtLnByZXBhcmF0aW9uX3dvcmtzKTsKICAgICAgSGFyZENhcFJlYWNoZWQoYmxvY2subnVtYmVyKTsKICAgICAgQ3Jvd2RzYWxlRW5kZWQoYmxvY2subnVtYmVyKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgaWYgKG5vdyA+IGVuZERhdGUpIHsKICAgICAgaWYgKHVzZFJhaXNlZC5hZGQodXNkKSA+PSBzb2Z0Q2FwKSB7CiAgICAgICAgc3RhdGUgPSBTYWxlU3RhdGUuRU5ERUQ7CiAgICAgICAgc3RhdHVzSS5zZXRTdGF0dXMoQnVpbGRpbmdTdGF0dXMuc3RhdHVzRW51bS5wcmVwYXJhdGlvbl93b3Jrcyk7CiAgICAgICAgQ3Jvd2RzYWxlRW5kZWQoYmxvY2subnVtYmVyKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RhdGUgPSBTYWxlU3RhdGUuUkVGVU5EOwogICAgICAgIHN0YXR1c0kuc2V0U3RhdHVzKEJ1aWxkaW5nU3RhdHVzLnN0YXR1c0VudW0ucmVmdW5kKTsKICAgICAgICBDcm93ZHNhbGVFbmRlZChibG9jay5udW1iZXIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICogQGRldiBUb2tlbiBwdXJjaGFzZQogKi8KICBmdW5jdGlvbiBwcm9jZXNzVHJhbnNhY3Rpb24oYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQgX2Ftb3VudCkgaW50ZXJuYWwgewoKICAgIHJlcXVpcmUobXNnLnZhbHVlID49IG1pbmltYWxDb250cmlidXRpb24pOwoKICAgIHVpbnQgbWF4Q29udHJpYnV0aW9uID0gY2FsY3VsYXRlTWF4Q29udHJpYnV0aW9uVXNkKCk7CiAgICB1aW50IGNvbnRyaWJ1dGlvbkFtb3VudFVzZCA9IF9hbW91bnQubXVsKGV0aFVzZFByaWNlKTsKICAgIHVpbnQgY29udHJpYnV0aW9uQW1vdW50RVRIID0gX2Ftb3VudDsKCiAgICB1aW50IHJldHVybkFtb3VudEVUSCA9IDA7CgogICAgaWYgKG1heENvbnRyaWJ1dGlvbiA8IGNvbnRyaWJ1dGlvbkFtb3VudFVzZCkgewogICAgICBjb250cmlidXRpb25BbW91bnRVc2QgPSBtYXhDb250cmlidXRpb247CiAgICAgIHVpbnQgcmV0dXJuQW1vdW50VXNkID0gX2Ftb3VudC5tdWwoZXRoVXNkUHJpY2UpIC0gbWF4Q29udHJpYnV0aW9uOwogICAgICByZXR1cm5BbW91bnRFVEggPSBjb250cmlidXRpb25BbW91bnRFVEggLSByZXR1cm5BbW91bnRVc2QuZGl2KGV0aFVzZFByaWNlKTsKICAgICAgY29udHJpYnV0aW9uQW1vdW50RVRIID0gY29udHJpYnV0aW9uQW1vdW50RVRILnN1YihyZXR1cm5BbW91bnRFVEgpOwogICAgfQoKICAgIGlmICh1c2RSYWlzZWQgKyBjb250cmlidXRpb25BbW91bnRVc2QgPj0gc29mdENhcCAmJiBzb2Z0Q2FwID4gdXNkUmFpc2VkKSB7CiAgICAgIFNvZnRDYXBSZWFjaGVkKGJsb2NrLm51bWJlcik7CiAgICB9CgogICAgLy8gZ2V0IHRva2VucyBmcm9tIGV0aCBVc2QgbXNnLnZhbHVlICogZXRoVXNkUHJpY2UgLyB0b2tlblVTRFJhdGUKICAgIC8vIDEgRVRIICogODYwICQgLyA0NDUgJCA9IDE5MzI1ODQyNjk2NjI5MjE2MCB3ZWkgPSAxLjkzIFVOVAogICAgdWludCB0b2tlbnMgPSBjb250cmlidXRpb25BbW91bnRVc2QuZGl2KHRva2VuVVNEUmF0ZSk7CgogICAgaWYodG90YWxUb2tlbnMgKyB0b2tlbnMgPiBoYXJkQ2FwVG9rZW4pIHsKICAgICAgX2NvbnRyaWJ1dG9yLnRyYW5zZmVyKF9hbW91bnQpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHRva2VucyA+IDApIHsKICAgICAgICByZWdpc3RyeS5hZGRDb250cmlidXRpb24oX2NvbnRyaWJ1dG9yLCBjb250cmlidXRpb25BbW91bnRFVEgsIGNvbnRyaWJ1dGlvbkFtb3VudFVzZCwgdG9rZW5zLCBldGhVc2RQcmljZSk7CiAgICAgICAgZXRoUmFpc2VkICs9IGNvbnRyaWJ1dGlvbkFtb3VudEVUSDsKICAgICAgICB0b3RhbFRva2VucyArPSB0b2tlbnM7CiAgICAgICAgdXNkUmFpc2VkICs9IGNvbnRyaWJ1dGlvbkFtb3VudFVzZDsKCiAgICAgICAgaWYodG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgdG9rZW5zKSkgewogICAgICAgICAgVG9rZW5zVHJhbnNmZXJlZChtc2cuc2VuZGVyLCB0b2tlbnMpOwogICAgICAgICAgd2l0aGRyYXdlZFRva2VucyArPSB0b2tlbnM7CiAgICAgICAgICBoYXNXaXRoZHJhd2VkVG9rZW5zW21zZy5zZW5kZXJdID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIENvbnRyaWJ1dGlvbkFkZGVkKF9jb250cmlidXRvciwgY29udHJpYnV0aW9uQW1vdW50RVRILCBjb250cmlidXRpb25BbW91bnRVc2QsIHRva2VucywgZXRoVXNkUHJpY2UpOwogICAgICB9CiAgICB9CgogICAgaWYgKHJldHVybkFtb3VudEVUSCAhPSAwKSB7CiAgICAgIF9jb250cmlidXRvci50cmFuc2ZlcihyZXR1cm5BbW91bnRFVEgpOwogICAgfQogIH0KCiAgLyoqCiAgICogQGRldiBJdCBpcyBuZWNlc3NhcnkgZm9yIGEgY29ycmVjdCBjaGFuZ2Ugb2Ygc3RhdHVzIGluIHRoZSBldmVudCBvZiBjb21wbGV0aW9uIG9mIHRoZSBjYW1wYWlnbi4KICAgKiBAcGFyYW0gX3N0YXRlQ2hhbmdlZCBpZiB0cnVlIHRyYW5zZmVyIEVUSCBiYWNrCiAgICovCiAgZnVuY3Rpb24gcmVmdW5kVHJhbnNhY3Rpb24oYm9vbCBfc3RhdGVDaGFuZ2VkKSBpbnRlcm5hbCB7CiAgICBpZiAoX3N0YXRlQ2hhbmdlZCkgewogICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICB9IGVsc2V7CiAgICAgIHJldmVydCgpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5zSXNzdWVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRvdGFsVG9rZW5zOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG90YWxVU0RJblRva2VucygpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b3RhbFRva2Vucy5tdWwodG9rZW5VU0RSYXRlKTsKICB9CgogIGZ1bmN0aW9uIGdldFVTRFJhaXNlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB1c2RSYWlzZWQ7CiAgfQoKICBmdW5jdGlvbiBjYWxjdWxhdGVNYXhDb250cmlidXRpb25Vc2QoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGhhcmRDYXAgLSB1c2RSYWlzZWQ7CiAgfQoKICBmdW5jdGlvbiBjYWxjdWxhdGVNYXhUb2tlbnNJc3N1ZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGhhcmRDYXBUb2tlbiAtIHRvdGFsVG9rZW5zOwogIH0KCiAgZnVuY3Rpb24gY2FsY3VsYXRlTWF4RXRoSXNzdWVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBoYXJkQ2FwLm11bChldGhVc2RQcmljZSkgLSB1c2RSYWlzZWQubXVsKGV0aFVzZFByaWNlKTsKICB9CgogIGZ1bmN0aW9uIGdldEV0aFJhaXNlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBldGhSYWlzZWQ7CiAgfQoKICBmdW5jdGlvbiBjaGVja0JhbGFuY2VDb250cmFjdCgpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICB9CgogIGZ1bmN0aW9uIGdldENvbnRyaWJ1dG9yVG9rZW5zKGFkZHJlc3MgY29udHJpYikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHJlZ2lzdHJ5LmdldENvbnRyaWJ1dGlvblRva2Vucyhjb250cmliKTsKICB9CgogIGZ1bmN0aW9uIGdldENvbnRyaWJ1dG9yRVRIKGFkZHJlc3MgY29udHJpYikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHJlZ2lzdHJ5LmdldENvbnRyaWJ1dGlvbkVUSChjb250cmliKTsKICB9CgogIGZ1bmN0aW9uIGdldENvbnRyaWJ1dG9yVVNEKGFkZHJlc3MgY29udHJpYikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHJlZ2lzdHJ5LmdldENvbnRyaWJ1dGlvblVTRChjb250cmliKTsKICB9CgogIGZ1bmN0aW9uIGdldFRva2VucygpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgIHJlcXVpcmUoKG5vdyA+IGVuZERhdGUgJiYgdXNkUmFpc2VkID49IHNvZnRDYXAgKSB8fCAodXNkUmFpc2VkID49IGhhcmRDYXApICApOwogICAgcmVxdWlyZShzdGF0ZSA9PSBTYWxlU3RhdGUuRU5ERUQpOwogICAgcmVxdWlyZSghaGFzV2l0aGRyYXdlZFRva2Vuc1ttc2cuc2VuZGVyXSAmJiByZWdpc3RyeS5pc0FjdGl2ZUNvbnRyaWJ1dG9yKG1zZy5zZW5kZXIpKTsKICAgIHJlcXVpcmUoZ2V0VG9rZW5CYWxhbmNlKCkgPj0gcmVnaXN0cnkuZ2V0Q29udHJpYnV0aW9uVG9rZW5zKG1zZy5zZW5kZXIpKTsKCiAgICB1aW50IG51bWJlck9mVU5UID0gcmVnaXN0cnkuZ2V0Q29udHJpYnV0aW9uVG9rZW5zKG1zZy5zZW5kZXIpOwoKICAgIGlmKHRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIG51bWJlck9mVU5UKSkgewogICAgICBUb2tlbnNUcmFuc2ZlcmVkKG1zZy5zZW5kZXIsIG51bWJlck9mVU5UKTsKICAgICAgd2l0aGRyYXdlZFRva2VucyArPSBudW1iZXJPZlVOVDsKICAgICAgaGFzV2l0aGRyYXdlZFRva2Vuc1ttc2cuc2VuZGVyXSA9IHRydWU7CiAgICB9CgogIH0KCiAgZnVuY3Rpb24gZ2V0T3ZlclRva2VucygpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShjaGVja0JhbGFuY2VDb250cmFjdCgpID4gKHRvdGFsVG9rZW5zIC0gd2l0aGRyYXdlZFRva2VucykpOwogICAgdWludCBiYWxhbmNlID0gY2hlY2tCYWxhbmNlQ29udHJhY3QoKSAtICh0b3RhbFRva2VucyAtIHdpdGhkcmF3ZWRUb2tlbnMpOwogICAgaWYoYmFsYW5jZSA+IDApIHsKICAgICAgaWYodG9rZW4udHJhbnNmZXIobXNnLnNlbmRlciwgYmFsYW5jZSkpIHsKICAgICAgICBUb2tlbnNUcmFuc2ZlcmVkKG1zZy5zZW5kZXIsICBiYWxhbmNlKTsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogQGRldiB0cmFuc2ZlciBmdW5kcyBFVEggdG8gbXVsdGlzaWcgd2FsbGV0IGlmIHJlYWNoZWQgbWluaW11bSBnb2FsCiAgICovCiAgZnVuY3Rpb24gd2l0aGRyYXdFdGgoKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU2FsZVN0YXRlLkVOREVEKTsKICAgIHVpbnQgYmFsID0gdGhpcy5iYWxhbmNlOwogICAgaG9sZC50cmFuc2ZlcihiYWwpOwogICAgaG9sZC5zZXRJbml0aWFsQmFsYW5jZShiYWwpOwogICAgV2l0aGRyYXdlZEV0aFRvSG9sZChiYWwpOwogIH0KCiAgZnVuY3Rpb24gbmV3Q3Jvd2RzYWxlKCkgcHVibGljIG9ubHlPd25lciB7CiAgICBzdGF0ZSA9IFNhbGVTdGF0ZS5ORVc7CiAgfQoKICAvKioKICAgKiBAZGV2IE1hbnVhbCBzdGFydCBjcm93ZHNhbGUuCiAgICovCiAgZnVuY3Rpb24gc3RhcnRDcm93ZHNhbGUoKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUobm93ID4gc3RhcnREYXRlICYmIG5vdyA8PSBlbmREYXRlKTsKICAgIHJlcXVpcmUoc3RhdGUgPT0gU2FsZVN0YXRlLk5FVyk7CgogICAgc3RhdHVzSS5zZXRTdGF0dXMoQnVpbGRpbmdTdGF0dXMuc3RhdHVzRW51bS5jcm93ZHNhbGUpOwogICAgc3RhdGUgPSBTYWxlU3RhdGUuU0FMRTsKICAgIENyb3dkc2FsZVN0YXJ0ZWQoYmxvY2subnVtYmVyKTsKICB9CgogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgZnVuY3Rpb24gaGFzRW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZERhdGUgfHwgc3RhdGUgPT0gU2FsZVN0YXRlLkVOREVEOwogIH0KCiAgZnVuY3Rpb24gZ2V0VG9rZW5CYWxhbmNlKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgfQoKICBmdW5jdGlvbiBnZXRTb2Z0Q2FwKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHNvZnRDYXA7CiAgfQoKICBmdW5jdGlvbiBnZXRIYXJkQ2FwKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIGhhcmRDYXA7CiAgfQoKICBmdW5jdGlvbiBnZXRTdGFydERhdGUoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gc3RhcnREYXRlOwogIH0KCiAgZnVuY3Rpb24gZ2V0RW5kRGF0ZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBlbmREYXRlOwogIH0KCiAgZnVuY3Rpb24gZ2V0Q29udHJpYnV0b3JBbW91bnQoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICByZXR1cm4gcmVnaXN0cnkuZ2V0Q29udHJpYnV0b3JBbW91bnQoKTsKICB9CgogIGZ1bmN0aW9uIGdldFdpdGhkcmF3ZWQoYWRkcmVzcyBjb250cmliKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gaGFzV2l0aGRyYXdlZFRva2Vuc1tjb250cmliXTsKICB9CgogIGZ1bmN0aW9uIGdldFJlZnVuZGVkKGFkZHJlc3MgY29udHJpYikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIGhhc1JlZnVuZGVkW2NvbnRyaWJdOwogIH0KCiAgZnVuY3Rpb24gYWRkQ29udHJpYnV0b3IoYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQgX2Ftb3VudCwgdWludCBfYW11c2QsIHVpbnQgX3Rva2VucywgdWludCBfcXVvdGUpIHB1YmxpYyBvbmx5UGVybWl0dGVkIHsKICAgIHJlZ2lzdHJ5LmFkZENvbnRyaWJ1dG9yKF9jb250cmlidXRvciwgX2Ftb3VudCwgX2FtdXNkLCBfdG9rZW5zLCBfcXVvdGUpOwogICAgZXRoUmFpc2VkICs9IF9hbW91bnQ7CiAgICB1c2RSYWlzZWQgKz0gX2FtdXNkOwogICAgdG90YWxUb2tlbnMgKz0gX3Rva2VuczsKICAgIENvbnRyaWJ1dGlvbkFkZGVkTWFudWFsKF9jb250cmlidXRvciwgZXRoUmFpc2VkLCB1c2RSYWlzZWQsIHRvdGFsVG9rZW5zLCBfcXVvdGUpOwoKICB9CgogIGZ1bmN0aW9uIGVkaXRDb250cmlidXRpb24oYWRkcmVzcyBfY29udHJpYnV0b3IsIHVpbnQgX2Ftb3VudCwgdWludCBfYW11c2QsIHVpbnQgX3Rva2VucywgdWludCBfcXVvdGUpIHB1YmxpYyBvbmx5UGVybWl0dGVkIHsKICAgIGV0aFJhaXNlZCAtPSByZWdpc3RyeS5nZXRDb250cmlidXRpb25FVEgoX2NvbnRyaWJ1dG9yKTsKICAgIHVzZFJhaXNlZCAtPSByZWdpc3RyeS5nZXRDb250cmlidXRpb25VU0QoX2NvbnRyaWJ1dG9yKTsKICAgIHRvdGFsVG9rZW5zIC09IHJlZ2lzdHJ5LmdldENvbnRyaWJ1dGlvblRva2VucyhfY29udHJpYnV0b3IpOwoKICAgIHJlZ2lzdHJ5LmVkaXRDb250cmlidXRpb24oX2NvbnRyaWJ1dG9yLCBfYW1vdW50LCBfYW11c2QsIF90b2tlbnMsIF9xdW90ZSk7CiAgICBldGhSYWlzZWQgKz0gX2Ftb3VudDsKICAgIHVzZFJhaXNlZCArPSBfYW11c2Q7CiAgICB0b3RhbFRva2VucyArPSBfdG9rZW5zOwogICAgQ29udHJpYnV0aW9uQWRkZWQoX2NvbnRyaWJ1dG9yLCBldGhSYWlzZWQsIHVzZFJhaXNlZCwgdG90YWxUb2tlbnMsIF9xdW90ZSk7CgogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlQ29udHJpYnV0b3IoYWRkcmVzcyBfY29udHJpYnV0b3IpIHB1YmxpYyBvbmx5UGVybWl0dGVkIHsKICAgIHJlZ2lzdHJ5LnJlbW92ZUNvbnRyaWJ1dGlvbihfY29udHJpYnV0b3IpOwogICAgZXRoUmFpc2VkIC09IHJlZ2lzdHJ5LmdldENvbnRyaWJ1dGlvbkVUSChfY29udHJpYnV0b3IpOwogICAgdXNkUmFpc2VkIC09IHJlZ2lzdHJ5LmdldENvbnRyaWJ1dGlvblVTRChfY29udHJpYnV0b3IpOwogICAgdG90YWxUb2tlbnMgLT0gcmVnaXN0cnkuZ2V0Q29udHJpYnV0aW9uVG9rZW5zKF9jb250cmlidXRvcik7CiAgICBDb250cmlidXRpb25SZW1vdmVkKF9jb250cmlidXRvciwgZXRoUmFpc2VkLCB1c2RSYWlzZWQsIHRvdGFsVG9rZW5zKTsKICB9Cgp9'.
	

]
