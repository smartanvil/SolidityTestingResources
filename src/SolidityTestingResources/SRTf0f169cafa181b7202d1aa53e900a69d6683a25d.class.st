Class {
	#name : #SRTf0f169cafa181b7202d1aa53e900a69d6683a25d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf0f169cafa181b7202d1aa53e900a69d6683a25d >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyBGaWxlOiBjb250cmFjdHMvQmRwQmFzZURhdGEuc29sCgpjb250cmFjdCBCZHBCYXNlRGF0YSB7CgoJYWRkcmVzcyBwdWJsaWMgb3duZXJBZGRyZXNzOwoKCWFkZHJlc3MgcHVibGljIG1hbmFnZXJBZGRyZXNzOwoKCWFkZHJlc3NbMTZdIHB1YmxpYyBjb250cmFjdHM7CgoJYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgoJYm9vbCBwdWJsaWMgc2V0dXBDb21wbGV0ZWQgPSBmYWxzZTsKCglieXRlczggcHVibGljIHZlcnNpb247Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvbGlicmFyaWVzL0JkcENvbnRyYWN0cy5zb2wKCmxpYnJhcnkgQmRwQ29udHJhY3RzIHsKCglmdW5jdGlvbiBnZXRCZHBFbnRyeVBvaW50KGFkZHJlc3NbMTZdIF9jb250cmFjdHMpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBfY29udHJhY3RzWzBdOwoJfQoKCWZ1bmN0aW9uIGdldEJkcENvbnRyb2xsZXIoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIF9jb250cmFjdHNbMV07Cgl9CgoJZnVuY3Rpb24gZ2V0QmRwQ29udHJvbGxlckhlbHBlcihhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1szXTsKCX0KCglmdW5jdGlvbiBnZXRCZHBEYXRhU3RvcmFnZShhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1s0XTsKCX0KCglmdW5jdGlvbiBnZXRCZHBJbWFnZVN0b3JhZ2UoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIF9jb250cmFjdHNbNV07Cgl9CgoJZnVuY3Rpb24gZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBwdXJlIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpIHsKCQlyZXR1cm4gX2NvbnRyYWN0c1s2XTsKCX0KCglmdW5jdGlvbiBnZXRCZHBQcmljZVN0b3JhZ2UoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgcHVyZSBpbnRlcm5hbCByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIF9jb250cmFjdHNbN107Cgl9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvQmRwQmFzZS5zb2wKCmNvbnRyYWN0IEJkcEJhc2UgaXMgQmRwQmFzZURhdGEgewoKCW1vZGlmaWVyIG9ubHlPd25lcigpIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXJBZGRyZXNzKTsKCQlfOwoJfQoKCW1vZGlmaWVyIG9ubHlBdXRob3JpemVkKCkgewoJCXJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lckFkZHJlc3MgfHwgbXNnLnNlbmRlciA9PSBtYW5hZ2VyQWRkcmVzcyk7CgkJXzsKCX0KCgltb2RpZmllciB3aGlsZUNvbnRyYWN0SXNBY3RpdmUoKSB7CgkJcmVxdWlyZSghcGF1c2VkICYmIHNldHVwQ29tcGxldGVkKTsKCQlfOwoJfQoKCW1vZGlmaWVyIHN0b3JhZ2VBY2Nlc3NDb250cm9sKCkgewoJCXJlcXVpcmUoCgkJCSghIHNldHVwQ29tcGxldGVkICYmIChtc2cuc2VuZGVyID09IG93bmVyQWRkcmVzcyB8fCBtc2cuc2VuZGVyID09IG1hbmFnZXJBZGRyZXNzKSkKCQkJfHwgKHNldHVwQ29tcGxldGVkICYmICFwYXVzZWQgJiYgKG1zZy5zZW5kZXIgPT0gQmRwQ29udHJhY3RzLmdldEJkcEVudHJ5UG9pbnQoY29udHJhY3RzKSkpCgkJKTsKCQlfOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVyKGFkZHJlc3MgX25ld093bmVyKSBleHRlcm5hbCBvbmx5T3duZXIgewoJCXJlcXVpcmUoX25ld093bmVyICE9IGFkZHJlc3MoMCkpOwoJCW93bmVyQWRkcmVzcyA9IF9uZXdPd25lcjsKCX0KCglmdW5jdGlvbiBzZXRNYW5hZ2VyKGFkZHJlc3MgX25ld01hbmFnZXIpIGV4dGVybmFsIG9ubHlPd25lciB7CgkJcmVxdWlyZShfbmV3TWFuYWdlciAhPSBhZGRyZXNzKDApKTsKCQltYW5hZ2VyQWRkcmVzcyA9IF9uZXdNYW5hZ2VyOwoJfQoKCWZ1bmN0aW9uIHNldENvbnRyYWN0cyhhZGRyZXNzWzE2XSBfY29udHJhY3RzKSBleHRlcm5hbCBvbmx5T3duZXIgewoJCWNvbnRyYWN0cyA9IF9jb250cmFjdHM7Cgl9CgoJZnVuY3Rpb24gcGF1c2UoKSBleHRlcm5hbCBvbmx5QXV0aG9yaXplZCB7CgkJcGF1c2VkID0gdHJ1ZTsKCX0KCglmdW5jdGlvbiB1bnBhdXNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKCQlwYXVzZWQgPSBmYWxzZTsKCX0KCglmdW5jdGlvbiBzZXRTZXR1cENvbXBsZXRlZCgpIGV4dGVybmFsIG9ubHlPd25lciB7CgkJc2V0dXBDb21wbGV0ZWQgPSB0cnVlOwoJfQoKCWZ1bmN0aW9uIGtpbGwoKSBwdWJsaWMgb25seU93bmVyIHsKCQlzZWxmZGVzdHJ1Y3Qob3duZXJBZGRyZXNzKTsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9saWJyYXJpZXMvU2FmZU1hdGguc29sCgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKCgkvKioKCSogQGRldiBNdWx0aXBsaWVzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCgkqLwoJZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQlpZiAoYSA9PSAwKSB7CgkJCXJldHVybiAwOwoJCX0KCQl1aW50MjU2IGMgPSBhICogYjsKCQlhc3NlcnQoYyAvIGEgPT0gYik7CgkJcmV0dXJuIGM7Cgl9CgoJLyoqCgkqIEBkZXYgSW50ZWdlciBkaXZpc2lvbiBvZiB0d28gbnVtYmVycywgdHJ1bmNhdGluZyB0aGUgcXVvdGllbnQuCgkqLwoJZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQkvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKCQl1aW50MjU2IGMgPSBhIC8gYjsKCQkvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAoJCXJldHVybiBjOwoJfQoKCS8qKgoJKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KCSovCglmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewoJCWFzc2VydChiIDw9IGEpOwoJCXJldHVybiBhIC0gYjsKCX0KCgkvKioKCSogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCgkqLwoJZnVuY3Rpb24gYWRkKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKCQl1aW50MjU2IGMgPSBhICsgYjsKCQlhc3NlcnQoYyA+PSBhKTsKCQlyZXR1cm4gYzsKCX0KfQoKLy8gRmlsZTogY29udHJhY3RzL3N0b3JhZ2UvQmRwRGF0YVN0b3JhZ2Uuc29sCgpjb250cmFjdCBCZHBEYXRhU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCglzdHJ1Y3QgUmVnaW9uIHsKCQl1aW50MjU2IHgxOwoJCXVpbnQyNTYgeTE7CgkJdWludDI1NiB4MjsKCQl1aW50MjU2IHkyOwoJCXVpbnQyNTYgY3VycmVudEltYWdlSWQ7CgkJdWludDI1NiBuZXh0SW1hZ2VJZDsKCQl1aW50OFsxMjhdIHVybDsKCQl1aW50MjU2IGN1cnJlbnRQaXhlbFByaWNlOwoJCXVpbnQyNTYgYmxvY2tVcGRhdGVkQXQ7CgkJdWludDI1NiB1cGRhdGVkQXQ7CgkJdWludDI1NiBwdXJjaGFzZWRBdDsKCQl1aW50MjU2IHB1cmNoYXNlZFBpeGVsUHJpY2U7Cgl9CgoJdWludDI1NiBwdWJsaWMgbGFzdFJlZ2lvbklkID0gMDsKCgltYXBwaW5nICh1aW50MjU2ID0+IFJlZ2lvbikgcHVibGljIGRhdGE7CgoKCWZ1bmN0aW9uIGdldExhc3RSZWdpb25JZCgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gbGFzdFJlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIGdldE5leHRSZWdpb25JZCgpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCByZXR1cm5zICh1aW50MjU2KSB7CgkJbGFzdFJlZ2lvbklkID0gbGFzdFJlZ2lvbklkLmFkZCgxKTsKCQlyZXR1cm4gbGFzdFJlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIGRlbGV0ZVJlZ2lvbkRhdGEodWludDI1NiBfaWQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGVsZXRlIGRhdGFbX2lkXTsKCX0KCglmdW5jdGlvbiBnZXRSZWdpb25Db29yZGluYXRlcyh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiwgdWludDI1NiwgdWludDI1NiwgdWludDI1NikgewoJCXJldHVybiAoZGF0YVtfaWRdLngxLCBkYXRhW19pZF0ueTEsIGRhdGFbX2lkXS54MiwgZGF0YVtfaWRdLnkyKTsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25Db29yZGluYXRlcyh1aW50MjU2IF9pZCwgdWludDI1NiBfeDEsIHVpbnQyNTYgX3kxLCB1aW50MjU2IF94MiwgdWludDI1NiBfeTIpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLngxID0gX3gxOwoJCWRhdGFbX2lkXS55MSA9IF95MTsKCQlkYXRhW19pZF0ueDIgPSBfeDI7CgkJZGF0YVtfaWRdLnkyID0gX3kyOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbkN1cnJlbnRJbWFnZUlkKHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5jdXJyZW50SW1hZ2VJZDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25DdXJyZW50SW1hZ2VJZCh1aW50MjU2IF9pZCwgdWludDI1NiBfY3VycmVudEltYWdlSWQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLmN1cnJlbnRJbWFnZUlkID0gX2N1cnJlbnRJbWFnZUlkOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbk5leHRJbWFnZUlkKHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5uZXh0SW1hZ2VJZDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25OZXh0SW1hZ2VJZCh1aW50MjU2IF9pZCwgdWludDI1NiBfbmV4dEltYWdlSWQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLm5leHRJbWFnZUlkID0gX25leHRJbWFnZUlkOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblVybCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDhbMTI4XSkgewoJCXJldHVybiBkYXRhW19pZF0udXJsOwoJfQoKCWZ1bmN0aW9uIHNldFJlZ2lvblVybCh1aW50MjU2IF9pZCwgdWludDhbMTI4XSBfdXJsKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS51cmwgPSBfdXJsOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbkN1cnJlbnRQaXhlbFByaWNlKHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5jdXJyZW50UGl4ZWxQcmljZTsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25DdXJyZW50UGl4ZWxQcmljZSh1aW50MjU2IF9pZCwgdWludDI1NiBfY3VycmVudFBpeGVsUHJpY2UpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLmN1cnJlbnRQaXhlbFByaWNlID0gX2N1cnJlbnRQaXhlbFByaWNlOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvbkJsb2NrVXBkYXRlZEF0KHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5ibG9ja1VwZGF0ZWRBdDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25CbG9ja1VwZGF0ZWRBdCh1aW50MjU2IF9pZCwgdWludDI1NiBfYmxvY2tVcGRhdGVkQXQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLmJsb2NrVXBkYXRlZEF0ID0gX2Jsb2NrVXBkYXRlZEF0OwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblVwZGF0ZWRBdCh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0udXBkYXRlZEF0OwoJfQoKCWZ1bmN0aW9uIHNldFJlZ2lvblVwZGF0ZWRBdCh1aW50MjU2IF9pZCwgdWludDI1NiBfdXBkYXRlZEF0KSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS51cGRhdGVkQXQgPSBfdXBkYXRlZEF0OwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblB1cmNoYXNlZEF0KHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIGRhdGFbX2lkXS5wdXJjaGFzZWRBdDsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25QdXJjaGFzZWRBdCh1aW50MjU2IF9pZCwgdWludDI1NiBfcHVyY2hhc2VkQXQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJZGF0YVtfaWRdLnB1cmNoYXNlZEF0ID0gX3B1cmNoYXNlZEF0OwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblVwZGF0ZWRBdFB1cmNoYXNlZEF0KHVpbnQyNTYgX2lkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2IF91cGRhdGVkQXQsIHVpbnQyNTYgX3B1cmNoYXNlZEF0KSB7CgkJcmV0dXJuIChkYXRhW19pZF0udXBkYXRlZEF0LCBkYXRhW19pZF0ucHVyY2hhc2VkQXQpOwoJfQoKCWZ1bmN0aW9uIGdldFJlZ2lvblB1cmNoYXNlUGl4ZWxQcmljZSh1aW50MjU2IF9pZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBkYXRhW19pZF0ucHVyY2hhc2VkUGl4ZWxQcmljZTsKCX0KCglmdW5jdGlvbiBzZXRSZWdpb25QdXJjaGFzZWRQaXhlbFByaWNlKHVpbnQyNTYgX2lkLCB1aW50MjU2IF9wdXJjaGFzZWRQaXhlbFByaWNlKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWRhdGFbX2lkXS5wdXJjaGFzZWRQaXhlbFByaWNlID0gX3B1cmNoYXNlZFBpeGVsUHJpY2U7Cgl9CgoJZnVuY3Rpb24gQmRwRGF0YVN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9zdG9yYWdlL0JkcEltYWdlU3RvcmFnZS5zb2wKCmNvbnRyYWN0IEJkcEltYWdlU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCglzdHJ1Y3QgSW1hZ2UgewoJCWFkZHJlc3Mgb3duZXI7CgkJdWludDI1NiByZWdpb25JZDsKCQl1aW50MjU2IGN1cnJlbnRSZWdpb25JZDsKCQltYXBwaW5nKHVpbnQxNiA9PiB1aW50MjU2WzEwMDBdKSBkYXRhOwoJCW1hcHBpbmcodWludDE2ID0+IHVpbnQxNikgZGF0YUxlbmd0aDsKCQl1aW50MTYgcGFydHNDb3VudDsKCQl1aW50MTYgd2lkdGg7CgkJdWludDE2IGhlaWdodDsKCQl1aW50MTYgaW1hZ2VEZXNjcmlwdG9yOwoJCXVpbnQyNTYgYmx1cnJlZEF0OwoJfQoKCXVpbnQyNTYgcHVibGljIGxhc3RJbWFnZUlkID0gMDsKCgltYXBwaW5nKHVpbnQyNTYgPT4gSW1hZ2UpIHB1YmxpYyBpbWFnZXM7CgoKCWZ1bmN0aW9uIGdldExhc3RJbWFnZUlkKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBsYXN0SW1hZ2VJZDsKCX0KCglmdW5jdGlvbiBnZXROZXh0SW1hZ2VJZCgpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCByZXR1cm5zICh1aW50MjU2KSB7CgkJbGFzdEltYWdlSWQgPSBsYXN0SW1hZ2VJZC5hZGQoMSk7CgkJcmV0dXJuIGxhc3RJbWFnZUlkOwoJfQoKCWZ1bmN0aW9uIGNyZWF0ZUltYWdlKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9yZWdpb25JZCwgdWludDE2IF93aWR0aCwgdWludDE2IF9oZWlnaHQsIHVpbnQxNiBfcGFydHNDb3VudCwgdWludDE2IF9pbWFnZURlc2NyaXB0b3IpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCByZXR1cm5zICh1aW50MjU2KSB7CgkJcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSAmJiBfd2lkdGggPiAwICYmIF9oZWlnaHQgPiAwICYmIF9wYXJ0c0NvdW50ID4gMCAmJiBfaW1hZ2VEZXNjcmlwdG9yID4gMCk7CgkJdWludDI1NiBpZCA9IGdldE5leHRJbWFnZUlkKCk7CgkJaW1hZ2VzW2lkXS5vd25lciA9IF9vd25lcjsKCQlpbWFnZXNbaWRdLnJlZ2lvbklkID0gX3JlZ2lvbklkOwoJCWltYWdlc1tpZF0ud2lkdGggPSBfd2lkdGg7CgkJaW1hZ2VzW2lkXS5oZWlnaHQgPSBfaGVpZ2h0OwoJCWltYWdlc1tpZF0ucGFydHNDb3VudCA9IF9wYXJ0c0NvdW50OwoJCWltYWdlc1tpZF0uaW1hZ2VEZXNjcmlwdG9yID0gX2ltYWdlRGVzY3JpcHRvcjsKCQlyZXR1cm4gaWQ7Cgl9CgoJZnVuY3Rpb24gaW1hZ2VFeGlzdHModWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCXJldHVybiBfaW1hZ2VJZCA+IDAgJiYgaW1hZ2VzW19pbWFnZUlkXS5vd25lciAhPSBhZGRyZXNzKDApOwoJfQoKCWZ1bmN0aW9uIGRlbGV0ZUltYWdlKHVpbnQyNTYgX2ltYWdlSWQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJcmVxdWlyZShpbWFnZUV4aXN0cyhfaW1hZ2VJZCkpOwoJCWRlbGV0ZSBpbWFnZXNbX2ltYWdlSWRdOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlT3duZXIodWludDI1NiBfaW1hZ2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlyZXR1cm4gaW1hZ2VzW19pbWFnZUlkXS5vd25lcjsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZU93bmVyKHVpbnQyNTYgX2ltYWdlSWQsIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLm93bmVyID0gX293bmVyOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlUmVnaW9uSWQodWludDI1NiBfaW1hZ2VJZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlyZXR1cm4gaW1hZ2VzW19pbWFnZUlkXS5yZWdpb25JZDsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZVJlZ2lvbklkKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQyNTYgX3JlZ2lvbklkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLnJlZ2lvbklkID0gX3JlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlQ3VycmVudFJlZ2lvbklkKHVpbnQyNTYgX2ltYWdlSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJcmV0dXJuIGltYWdlc1tfaW1hZ2VJZF0uY3VycmVudFJlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlQ3VycmVudFJlZ2lvbklkKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQyNTYgX2N1cnJlbnRSZWdpb25JZCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJaW1hZ2VzW19pbWFnZUlkXS5jdXJyZW50UmVnaW9uSWQgPSBfY3VycmVudFJlZ2lvbklkOwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlRGF0YSh1aW50MjU2IF9pbWFnZUlkLCB1aW50MTYgX3BhcnQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTZbMTAwMF0pIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJcmV0dXJuIGltYWdlc1tfaW1hZ2VJZF0uZGF0YVtfcGFydF07Cgl9CgoJZnVuY3Rpb24gc2V0SW1hZ2VEYXRhKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfcGFydCwgdWludDI1NltdIF9kYXRhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLmRhdGFMZW5ndGhbX3BhcnRdID0gdWludDE2KF9kYXRhLmxlbmd0aCk7CgkJZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2RhdGEubGVuZ3RoOyBpKyspIHsKCQkJaW1hZ2VzW19pbWFnZUlkXS5kYXRhW19wYXJ0XVtpXSA9IF9kYXRhW2ldOwoJCX0KCX0KCglmdW5jdGlvbiBnZXRJbWFnZURhdGFMZW5ndGgodWludDI1NiBfaW1hZ2VJZCwgdWludDE2IF9wYXJ0KSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MTYpIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJcmV0dXJuIGltYWdlc1tfaW1hZ2VJZF0uZGF0YUxlbmd0aFtfcGFydF07Cgl9CgoJZnVuY3Rpb24gc2V0SW1hZ2VEYXRhTGVuZ3RoKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfcGFydCwgdWludDE2IF9kYXRhTGVuZ3RoKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLmRhdGFMZW5ndGhbX3BhcnRdID0gX2RhdGFMZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0SW1hZ2VQYXJ0c0NvdW50KHVpbnQyNTYgX2ltYWdlSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQxNikgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlyZXR1cm4gaW1hZ2VzW19pbWFnZUlkXS5wYXJ0c0NvdW50OwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlUGFydHNDb3VudCh1aW50MjU2IF9pbWFnZUlkLCB1aW50MTYgX3BhcnRzQ291bnQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJcmVxdWlyZShpbWFnZUV4aXN0cyhfaW1hZ2VJZCkpOwoJCWltYWdlc1tfaW1hZ2VJZF0ucGFydHNDb3VudCA9IF9wYXJ0c0NvdW50OwoJfQoKCWZ1bmN0aW9uIGdldEltYWdlV2lkdGgodWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDE2KSB7CgkJcmVxdWlyZShpbWFnZUV4aXN0cyhfaW1hZ2VJZCkpOwoJCXJldHVybiBpbWFnZXNbX2ltYWdlSWRdLndpZHRoOwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlV2lkdGgodWludDI1NiBfaW1hZ2VJZCwgdWludDE2IF93aWR0aCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJaW1hZ2VzW19pbWFnZUlkXS53aWR0aCA9IF93aWR0aDsKCX0KCglmdW5jdGlvbiBnZXRJbWFnZUhlaWdodCh1aW50MjU2IF9pbWFnZUlkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MTYpIHsKCQlyZXF1aXJlKGltYWdlRXhpc3RzKF9pbWFnZUlkKSk7CgkJcmV0dXJuIGltYWdlc1tfaW1hZ2VJZF0uaGVpZ2h0OwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlSGVpZ2h0KHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfaGVpZ2h0KSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLmhlaWdodCA9IF9oZWlnaHQ7Cgl9CgoJZnVuY3Rpb24gZ2V0SW1hZ2VEZXNjcmlwdG9yKHVpbnQyNTYgX2ltYWdlSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQxNikgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlyZXR1cm4gaW1hZ2VzW19pbWFnZUlkXS5pbWFnZURlc2NyaXB0b3I7Cgl9CgoJZnVuY3Rpb24gc2V0SW1hZ2VEZXNjcmlwdG9yKHVpbnQyNTYgX2ltYWdlSWQsIHVpbnQxNiBfaW1hZ2VEZXNjcmlwdG9yKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlpbWFnZXNbX2ltYWdlSWRdLmltYWdlRGVzY3JpcHRvciA9IF9pbWFnZURlc2NyaXB0b3I7Cgl9CgoJZnVuY3Rpb24gZ2V0SW1hZ2VCbHVycmVkQXQodWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBpbWFnZXNbX2ltYWdlSWRdLmJsdXJyZWRBdDsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZUJsdXJyZWRBdCh1aW50MjU2IF9pbWFnZUlkLCB1aW50MjU2IF9ibHVycmVkQXQpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJaW1hZ2VzW19pbWFnZUlkXS5ibHVycmVkQXQgPSBfYmx1cnJlZEF0OwoJfQoKCWZ1bmN0aW9uIGltYWdlVXBsb2FkQ29tcGxldGUodWludDI1NiBfaW1hZ2VJZCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewoJCXJlcXVpcmUoaW1hZ2VFeGlzdHMoX2ltYWdlSWQpKTsKCQlmb3IgKHVpbnQxNiBpID0gMTsgaSA8PSBpbWFnZXNbX2ltYWdlSWRdLnBhcnRzQ291bnQ7IGkrKykgewoJCQlpZihpbWFnZXNbX2ltYWdlSWRdLmRhdGFbaV0ubGVuZ3RoID09IDApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0KCQlyZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiBCZHBJbWFnZVN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9zdG9yYWdlL0JkcFByaWNlU3RvcmFnZS5zb2wKCmNvbnRyYWN0IEJkcFByaWNlU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1aW50NjRbMTAwMV0gcHVibGljIHByaWNlUG9pbnRzOwoKCXVpbnQyNTYgcHVibGljIHByaWNlUG9pbnRzTGVuZ3RoID0gMDsKCglhZGRyZXNzIHB1YmxpYyBmb3J3YXJkUHVyY2hhc2VGZWVzVG8gPSBhZGRyZXNzKDApOwoKCWFkZHJlc3MgcHVibGljIGZvcndhcmRVcGRhdGVGZWVzVG8gPSBhZGRyZXNzKDApOwoKCglmdW5jdGlvbiBnZXRQcmljZVBvaW50c0xlbmd0aCgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gcHJpY2VQb2ludHNMZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0UHJpY2VQb2ludCh1aW50MjU2IF9pKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIHByaWNlUG9pbnRzW19pXTsKCX0KCglmdW5jdGlvbiBzZXRQcmljZVBvaW50cyh1aW50NjRbXSBfcHJpY2VQb2ludHMpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJcHJpY2VQb2ludHNMZW5ndGggPSAwOwoJCWFwcGVuZFByaWNlUG9pbnRzKF9wcmljZVBvaW50cyk7Cgl9CgoJZnVuY3Rpb24gYXBwZW5kUHJpY2VQb2ludHModWludDY0W10gX3ByaWNlUG9pbnRzKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWZvciAodWludCBpID0gMDsgaSA8IF9wcmljZVBvaW50cy5sZW5ndGg7IGkrKykgewoJCQlwcmljZVBvaW50c1twcmljZVBvaW50c0xlbmd0aCsrXSA9IF9wcmljZVBvaW50c1tpXTsKCQl9Cgl9CgoJZnVuY3Rpb24gZ2V0Rm9yd2FyZFB1cmNoYXNlRmVlc1RvKCkgdmlldyBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcykgewoJCXJldHVybiBmb3J3YXJkUHVyY2hhc2VGZWVzVG87Cgl9CgoJZnVuY3Rpb24gc2V0Rm9yd2FyZFB1cmNoYXNlRmVlc1RvKGFkZHJlc3MgX2ZvcndhcmRQdXJjaGFzZUZlZXNUbykgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlmb3J3YXJkUHVyY2hhc2VGZWVzVG8gPSBfZm9yd2FyZFB1cmNoYXNlRmVlc1RvOwoJfQoKCWZ1bmN0aW9uIGdldEZvcndhcmRVcGRhdGVGZWVzVG8oKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIGZvcndhcmRVcGRhdGVGZWVzVG87Cgl9CgoJZnVuY3Rpb24gc2V0Rm9yd2FyZFVwZGF0ZUZlZXNUbyhhZGRyZXNzIF9mb3J3YXJkVXBkYXRlRmVlc1RvKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCWZvcndhcmRVcGRhdGVGZWVzVG8gPSBfZm9yd2FyZFVwZGF0ZUZlZXNUbzsKCX0KCglmdW5jdGlvbiBCZHBQcmljZVN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9saWJyYXJpZXMvQmRwQ2FsY3VsYXRvci5zb2wKCmxpYnJhcnkgQmRwQ2FsY3VsYXRvciB7CgoJdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgoJZnVuY3Rpb24gY2FsY3VsYXRlQXJlYShhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiBfYXJlYSwgdWludDI1NiBfd2lkdGgsIHVpbnQyNTYgX2hlaWdodCkgewoJCXZhciAoeDEsIHkxLCB4MiwgeTIpID0gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRSZWdpb25Db29yZGluYXRlcyhfcmVnaW9uSWQpOwoJCV93aWR0aCA9IHgyIC0geDEgKyAxOwoJCV9oZWlnaHQgPSB5MiAtIHkxICsgMTsKCQlfYXJlYSA9IF93aWR0aCAqIF9oZWlnaHQ7Cgl9CgoJZnVuY3Rpb24gY291bnRQdXJjaGFzZWRQaXhlbHMoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cykgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NiBfY291bnQpIHsKCQl2YXIgbGFzdFJlZ2lvbklkID0gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRMYXN0UmVnaW9uSWQoKTsKCQlmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPD0gbGFzdFJlZ2lvbklkOyBpKyspIHsKCQkJaWYoQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRSZWdpb25QdXJjaGFzZWRBdChpKSA+IDApIHsgLy8gcmVnaW9uIGlzIHB1cmNoYXNlZAoJCQkJdmFyIChhcmVhLCwpID0gY2FsY3VsYXRlQXJlYShfY29udHJhY3RzLCBpKTsKCQkJCV9jb3VudCArPSBhcmVhOwoJCQl9CgkJfQoJfQoKCWZ1bmN0aW9uIGNhbGN1bGF0ZUN1cnJlbnRNYXJrZXRQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMpIHZpZXcgcHVibGljIHJldHVybnModWludCkgewoJCXJldHVybiBjYWxjdWxhdGVNYXJrZXRQaXhlbFByaWNlKF9jb250cmFjdHMsIGNvdW50UHVyY2hhc2VkUGl4ZWxzKF9jb250cmFjdHMpKTsKCX0KCglmdW5jdGlvbiBjYWxjdWxhdGVNYXJrZXRQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQgX3BpeGVsc1NvbGQpIHZpZXcgcHVibGljIHJldHVybnModWludCkgewoJCXZhciBwcmljZVBvaW50c0xlbmd0aCA9IEJkcFByaWNlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwUHJpY2VTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRQcmljZVBvaW50c0xlbmd0aCgpOwoJCXVpbnQgbW9kID0gX3BpeGVsc1NvbGQgJSAoMTAwMDAwMCAvIChwcmljZVBvaW50c0xlbmd0aCAtIDEpKTsKCQl1aW50IGRpdiA9IF9waXhlbHNTb2xkICogKHByaWNlUG9pbnRzTGVuZ3RoIC0gMSkgLyAxMDAwMDAwOwoJCXZhciBkaXZQb2ludCA9IEJkcFByaWNlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwUHJpY2VTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRQcmljZVBvaW50KGRpdik7CgkJaWYobW9kID09IDApIHJldHVybiBkaXZQb2ludDsKCQlyZXR1cm4gZGl2UG9pbnQgKyBtb2QgKiAoQmRwUHJpY2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBQcmljZVN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFByaWNlUG9pbnQoZGl2KzEpIC0gZGl2UG9pbnQpICogKHByaWNlUG9pbnRzTGVuZ3RoIC0gMSkgLyAxMDAwMDAwOwoJfQoKCWZ1bmN0aW9uIGNhbGN1bGF0ZUF2ZXJhZ2VQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQgX2EsIHVpbnQgX2IpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQgX3ByaWNlKSB7CgkJX3ByaWNlID0gKGNhbGN1bGF0ZU1hcmtldFBpeGVsUHJpY2UoX2NvbnRyYWN0cywgX2EpICsgY2FsY3VsYXRlTWFya2V0UGl4ZWxQcmljZShfY29udHJhY3RzLCBfYikpIC8gMjsKCX0KCgkvKiogQ3VycmVudCBtYXJrZXQgcHJpY2UgcGVyIHBpeGVsIGZvciB0aGlzIHJlZ2lvbiBpZiBpdCBpcyB0aGUgZmlyc3Qgc2FsZSBvZiB0aGlzIHJlZ2lvbgoJICAqLwoJZnVuY3Rpb24gY2FsY3VsYXRlUmVnaW9uSW5pdGlhbFNhbGVQaXhlbFByaWNlKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQyNTYgX3JlZ2lvbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmVxdWlyZShCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFJlZ2lvblVwZGF0ZWRBdChfcmVnaW9uSWQpID4gMCk7IC8vIHJlZ2lvbiBleGlzdHMKCQl2YXIgcHVyY2hhc2VkUGl4ZWxzID0gY291bnRQdXJjaGFzZWRQaXhlbHMoX2NvbnRyYWN0cyk7CgkJdmFyIChhcmVhLCwpID0gY2FsY3VsYXRlQXJlYShfY29udHJhY3RzLCBfcmVnaW9uSWQpOwoJCXJldHVybiBjYWxjdWxhdGVBdmVyYWdlUGl4ZWxQcmljZShfY29udHJhY3RzLCBwdXJjaGFzZWRQaXhlbHMsIHB1cmNoYXNlZFBpeGVscyArIGFyZWEpOwoJfQoKCS8qKiBDdXJyZW50IG1hcmtldCBwcmljZSBvciAoQ3VycmVudCBtYXJrZXQgcHJpY2UpKjMgaWYgdGhlIHJlZ2lvbiB3YXMgc29sZAoJICAqLwoJZnVuY3Rpb24gY2FsY3VsYXRlUmVnaW9uU2FsZVBpeGVsUHJpY2UoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfcmVnaW9uSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQl2YXIgcGl4ZWxQcmljZSA9IEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0UmVnaW9uQ3VycmVudFBpeGVsUHJpY2UoX3JlZ2lvbklkKTsKCQlpZihwaXhlbFByaWNlID4gMCkgewoJCQlyZXR1cm4gcGl4ZWxQcmljZSAqIDM7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIGNhbGN1bGF0ZVJlZ2lvbkluaXRpYWxTYWxlUGl4ZWxQcmljZShfY29udHJhY3RzLCBfcmVnaW9uSWQpOwoJCX0KCX0KCgkvKiogU2V0dXAgaXMgYWxsb3dlZCBvbmUgd2hpdGhpbiBvbmUgZGF5IGFmdGVyIHB1cmNoYXNlCgkgICovCglmdW5jdGlvbiBjYWxjdWxhdGVTZXR1cEFsbG93ZWRVbnRpbChhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXZhciAodXBkYXRlZEF0LCBwdXJjaGFzZWRBdCkgPSBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFJlZ2lvblVwZGF0ZWRBdFB1cmNoYXNlZEF0KF9yZWdpb25JZCk7CgkJaWYodXBkYXRlZEF0ICE9IHB1cmNoYXNlZEF0KSB7CgkJCXJldHVybiAwOwoJCX0gZWxzZSB7CgkJCXJldHVybiBwdXJjaGFzZWRBdCArIDEgZGF5czsKCQl9Cgl9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvc3RvcmFnZS9CZHBPd25lcnNoaXBTdG9yYWdlLnNvbAoKY29udHJhY3QgQmRwT3duZXJzaGlwU3RvcmFnZSBpcyBCZHBCYXNlIHsKCgl1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCgkvLyBNYXBwaW5nIGZyb20gdG9rZW4gSUQgdG8gb3duZXIKCW1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHRva2VuT3duZXI7CgoJLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGFwcHJvdmVkIGFkZHJlc3MKCW1hcHBpbmcgKHVpbnQyNTYgPT4gYWRkcmVzcykgcHVibGljIHRva2VuQXBwcm92YWxzOwoKCS8vIE1hcHBpbmcgZnJvbSBvd25lciB0byB0aGUgc3VtIG9mIG93bmVkIGFyZWEKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG93bmVkQXJlYTsKCgkvLyBNYXBwaW5nIGZyb20gb3duZXIgdG8gbGlzdCBvZiBvd25lZCB0b2tlbiBJRHMKCW1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NltdKSBwdWJsaWMgb3duZWRUb2tlbnM7CgoJLy8gTWFwcGluZyBmcm9tIHRva2VuIElEIHRvIGluZGV4IG9mIHRoZSBvd25lciB0b2tlbnMgbGlzdAoJbWFwcGluZyh1aW50MjU2ID0+IHVpbnQyNTYpIHB1YmxpYyBvd25lZFRva2Vuc0luZGV4OwoKCS8vIEFsbCB0b2tlbnMgbGlzdCB0b2tlbnMgaWRzCgl1aW50MjU2W10gcHVibGljIHRva2VuSWRzOwoKCS8vIE1hcHBpbmcgZnJvbSB0b2tlbklkIHRvIGluZGV4IG9mIHRoZSB0b2tlbnMgbGlzdAoJbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgdG9rZW5JZHNJbmRleDsKCgoJZnVuY3Rpb24gZ2V0VG9rZW5Pd25lcih1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIHRva2VuT3duZXJbX3Rva2VuSWRdOwoJfQoKCWZ1bmN0aW9uIHNldFRva2VuT3duZXIodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJdG9rZW5Pd25lcltfdG9rZW5JZF0gPSBfb3duZXI7Cgl9CgoJZnVuY3Rpb24gZ2V0VG9rZW5BcHByb3ZhbCh1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zIChhZGRyZXNzKSB7CgkJcmV0dXJuIHRva2VuQXBwcm92YWxzW190b2tlbklkXTsKCX0KCglmdW5jdGlvbiBzZXRUb2tlbkFwcHJvdmFsKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX3RvKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCXRva2VuQXBwcm92YWxzW190b2tlbklkXSA9IF90bzsKCX0KCglmdW5jdGlvbiBnZXRPd25lZEFyZWEoYWRkcmVzcyBfb3duZXIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gc2V0T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkQXJlYVtfb3duZXJdID0gX2FyZWE7Cgl9CgoJZnVuY3Rpb24gaW5jcmVtZW50T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkQXJlYVtfb3duZXJdID0gb3duZWRBcmVhW19vd25lcl0uYWRkKF9hcmVhKTsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gZGVjcmVtZW50T3duZWRBcmVhKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9hcmVhKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkQXJlYVtfb3duZXJdID0gb3duZWRBcmVhW19vd25lcl0uc3ViKF9hcmVhKTsKCQlyZXR1cm4gb3duZWRBcmVhW19vd25lcl07Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbnNMZW5ndGgoYWRkcmVzcyBfb3duZXIpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXS5sZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbihhZGRyZXNzIF9vd25lciwgdWludDI1NiBfaW5kZXgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gb3duZWRUb2tlbnNbX293bmVyXVtfaW5kZXhdOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVkVG9rZW4oYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX2luZGV4LCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkVG9rZW5zW19vd25lcl1bX2luZGV4XSA9IF90b2tlbklkOwoJfQoKCWZ1bmN0aW9uIHB1c2hPd25lZFRva2VuKGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgcmV0dXJucyAodWludDI1NikgewoJCW93bmVkVG9rZW5zW19vd25lcl0ucHVzaChfdG9rZW5JZCk7CgkJcmV0dXJuIG93bmVkVG9rZW5zW19vd25lcl0ubGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGRlY3JlbWVudE93bmVkVG9rZW5zTGVuZ3RoKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgc3RvcmFnZUFjY2Vzc0NvbnRyb2wgewoJCW93bmVkVG9rZW5zW19vd25lcl0ubGVuZ3RoLS07Cgl9CgoJZnVuY3Rpb24gZ2V0T3duZWRUb2tlbnNJbmRleCh1aW50MjU2IF90b2tlbklkKSB2aWV3IHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJcmV0dXJuIG93bmVkVG9rZW5zSW5kZXhbX3Rva2VuSWRdOwoJfQoKCWZ1bmN0aW9uIHNldE93bmVkVG9rZW5zSW5kZXgodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfdG9rZW5JbmRleCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQlvd25lZFRva2Vuc0luZGV4W190b2tlbklkXSA9IF90b2tlbkluZGV4OwoJfQoKCWZ1bmN0aW9uIGdldFRva2VuSWRzTGVuZ3RoKCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiB0b2tlbklkcy5sZW5ndGg7Cgl9CgoJZnVuY3Rpb24gZ2V0VG9rZW5JZEJ5SW5kZXgodWludDI1NiBfaW5kZXgpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gdG9rZW5JZHNbX2luZGV4XTsKCX0KCglmdW5jdGlvbiBzZXRUb2tlbklkQnlJbmRleCh1aW50MjU2IF9pbmRleCwgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQl0b2tlbklkc1tfaW5kZXhdID0gX3Rva2VuSWQ7Cgl9CgoJZnVuY3Rpb24gcHVzaFRva2VuSWQodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHJldHVybnMgKHVpbnQyNTYpIHsKCQl0b2tlbklkcy5wdXNoKF90b2tlbklkKTsKCQlyZXR1cm4gdG9rZW5JZHMubGVuZ3RoOwoJfQoKCWZ1bmN0aW9uIGRlY3JlbWVudFRva2VuSWRzTGVuZ3RoKCkgcHVibGljIHN0b3JhZ2VBY2Nlc3NDb250cm9sIHsKCQl0b2tlbklkcy5sZW5ndGgtLTsKCX0KCglmdW5jdGlvbiBnZXRUb2tlbklkc0luZGV4KHVpbnQyNTYgX3Rva2VuSWQpIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpIHsKCQlyZXR1cm4gdG9rZW5JZHNJbmRleFtfdG9rZW5JZF07Cgl9CgoJZnVuY3Rpb24gc2V0VG9rZW5JZHNJbmRleCh1aW50MjU2IF90b2tlbklkLCB1aW50MjU2IF90b2tlbklkSW5kZXgpIHB1YmxpYyBzdG9yYWdlQWNjZXNzQ29udHJvbCB7CgkJdG9rZW5JZHNJbmRleFtfdG9rZW5JZF0gPSBfdG9rZW5JZEluZGV4OwoJfQoKCWZ1bmN0aW9uIEJkcE93bmVyc2hpcFN0b3JhZ2UoYnl0ZXM4IF92ZXJzaW9uKSBwdWJsaWMgewoJCW93bmVyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgkJbWFuYWdlckFkZHJlc3MgPSBtc2cuc2VuZGVyOwoJCXZlcnNpb24gPSBfdmVyc2lvbjsKCX0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9saWJyYXJpZXMvQmRwT3duZXJzaGlwLnNvbAoKLyoqCiAqIE93bmVyc2hpcCBtYW5hZ2VyCiAqIERvZXMgbm90IGNoZWNrIGlmIHRoZSBjYWxsZXIgaXMgYWxsb3dlZCB0byBjYWxsIGZ1bmN0aW9ucwogKiBTdGF0ZSBjaGFuZ2luZyBtZXRob2RzIGFyZSBub3QgaW50ZW5kZWQgdG8gYmUgY2FsbGVkIGZyb20gY29udHJvbGxlcgogKi8KbGlicmFyeSBCZHBPd25lcnNoaXAgewoKCXVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKCWV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgaW5kZXhlZCB0b2tlbklkKTsKCglldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBhcHByb3ZlZCwgdWludDI1NiBpbmRleGVkIHRva2VuSWQpOwoKCWZ1bmN0aW9uIG93bmVyT2YoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcykgewoJCXZhciBvd25lciA9IEJkcE93bmVyc2hpcFN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcE93bmVyc2hpcFN0b3JhZ2UoX2NvbnRyYWN0cykpLmdldFRva2VuT3duZXIoX3Rva2VuSWQpOwoJCXJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CgkJcmV0dXJuIG93bmVyOwoJfQoKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCBhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewoJCXJldHVybiBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRPd25lZFRva2Vuc0xlbmd0aChfb3duZXIpOwoJfQoKCWZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CgkJdmFyIG93blN0b3JhZ2UgPSBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKTsKCgkJYWRkcmVzcyBvd25lciA9IG93bmVyT2YoX2NvbnRyYWN0cywgX3Rva2VuSWQpOwoJCXJlcXVpcmUoX3RvICE9IG93bmVyKTsKCQlpZiAob3duU3RvcmFnZS5nZXRUb2tlbkFwcHJvdmFsKF90b2tlbklkKSAhPSAwIHx8IF90byAhPSAwKSB7CgkJCW93blN0b3JhZ2Uuc2V0VG9rZW5BcHByb3ZhbChfdG9rZW5JZCwgX3RvKTsKCQkJQXBwcm92YWwob3duZXIsIF90bywgX3Rva2VuSWQpOwoJCX0KCX0KCgkvKioKCSAqIEBkZXYgQ2xlYXIgY3VycmVudCBhcHByb3ZhbCBvZiBhIGdpdmVuIHRva2VuIElECgkgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKCSAqLwoJZnVuY3Rpb24gY2xlYXJBcHByb3ZhbChhZGRyZXNzWzE2XSBfY29udHJhY3RzLCBhZGRyZXNzIF9vd25lciwgdWludDI1NiBfdG9rZW5JZCkgcHVibGljIHsKCQl2YXIgb3duU3RvcmFnZSA9IEJkcE93bmVyc2hpcFN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcE93bmVyc2hpcFN0b3JhZ2UoX2NvbnRyYWN0cykpOwoKCQlyZXF1aXJlKG93bmVyT2YoX2NvbnRyYWN0cywgX3Rva2VuSWQpID09IF9vd25lcik7CgkJaWYgKG93blN0b3JhZ2UuZ2V0VG9rZW5BcHByb3ZhbChfdG9rZW5JZCkgIT0gMCkgewoJCQlCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKS5zZXRUb2tlbkFwcHJvdmFsKF90b2tlbklkLCAwKTsKCQkJQXBwcm92YWwoX293bmVyLCAwLCBfdG9rZW5JZCk7CgkJfQoJfQoKCS8qKgoJICogQGRldiBDbGVhciBjdXJyZW50IGFwcHJvdmFsIGFuZCB0cmFuc2ZlciB0aGUgb3duZXJzaGlwIG9mIGEgZ2l2ZW4gdG9rZW4gSUQKCSAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KCSAqIEBwYXJhbSBfdG8gYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byB0cmFuc2ZlciB0aGUgdG9rZW4gdG8KCSAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAoJICovCglmdW5jdGlvbiBjbGVhckFwcHJvdmFsQW5kVHJhbnNmZXIoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CgkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgkJcmVxdWlyZShfdG8gIT0gb3duZXJPZihfY29udHJhY3RzLCBfdG9rZW5JZCkpOwoJCXJlcXVpcmUob3duZXJPZihfY29udHJhY3RzLCBfdG9rZW5JZCkgPT0gX2Zyb20pOwoKCQljbGVhckFwcHJvdmFsKF9jb250cmFjdHMsIF9mcm9tLCBfdG9rZW5JZCk7CgkJcmVtb3ZlVG9rZW4oX2NvbnRyYWN0cywgX2Zyb20sIF90b2tlbklkKTsKCQlhZGRUb2tlbihfY29udHJhY3RzLCBfdG8sIF90b2tlbklkKTsKCQlUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdG9rZW5JZCk7Cgl9CgoJLyoqCgkgKiBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGFkZCBhIHRva2VuIElEIHRvIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwoJICogQHBhcmFtIF90byBhZGRyZXNzIHJlcHJlc2VudGluZyB0aGUgbmV3IG93bmVyIG9mIHRoZSBnaXZlbiB0b2tlbiBJRAoJICogQHBhcmFtIF90b2tlbklkIHVpbnQyNTYgSUQgb2YgdGhlIHRva2VuIHRvIGJlIGFkZGVkIHRvIHRoZSB0b2tlbnMgbGlzdCBvZiB0aGUgZ2l2ZW4gYWRkcmVzcwoJICovCglmdW5jdGlvbiBhZGRUb2tlbihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCBhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgcHJpdmF0ZSB7CgkJdmFyIG93blN0b3JhZ2UgPSBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKTsKCgkJcmVxdWlyZShvd25TdG9yYWdlLmdldFRva2VuT3duZXIoX3Rva2VuSWQpID09IGFkZHJlc3MoMCkpOwoKCQkvLyBTZXQgdG9rZW4gb3duZXIKCQlvd25TdG9yYWdlLnNldFRva2VuT3duZXIoX3Rva2VuSWQsIF90byk7CgoJCS8vIEFkZCB0b2tlbiB0byB0b2tlbklkcyBsaXN0CgkJdmFyIHRva2VuSWRzTGVuZ3RoID0gb3duU3RvcmFnZS5wdXNoVG9rZW5JZChfdG9rZW5JZCk7CgkJb3duU3RvcmFnZS5zZXRUb2tlbklkc0luZGV4KF90b2tlbklkLCB0b2tlbklkc0xlbmd0aC5zdWIoMSkpOwoKCQl1aW50MjU2IG93bmVkVG9rZW5zTGVuZ3RoID0gb3duU3RvcmFnZS5nZXRPd25lZFRva2Vuc0xlbmd0aChfdG8pOwoKCQkvLyBBZGQgdG9rZW4gdG8gb3duZWRUb2tlbnMgbGlzdAoJCW93blN0b3JhZ2UucHVzaE93bmVkVG9rZW4oX3RvLCBfdG9rZW5JZCk7CgkJb3duU3RvcmFnZS5zZXRPd25lZFRva2Vuc0luZGV4KF90b2tlbklkLCBvd25lZFRva2Vuc0xlbmd0aCk7CgoJCS8vIEluY3JlbWVudCB0b3RhbCBvd25lZCBhcmVhCgkJdmFyIChhcmVhLCwpID0gQmRwQ2FsY3VsYXRvci5jYWxjdWxhdGVBcmVhKF9jb250cmFjdHMsIF90b2tlbklkKTsKCQlvd25TdG9yYWdlLmluY3JlbWVudE93bmVkQXJlYShfdG8sIGFyZWEpOwoJfQoKCS8qKgoJICogQGRldiBJbnRlcm5hbCBmdW5jdGlvbiB0byByZW1vdmUgYSB0b2tlbiBJRCBmcm9tIHRoZSBsaXN0IG9mIGEgZ2l2ZW4gYWRkcmVzcwoJICogQHBhcmFtIF9mcm9tIGFkZHJlc3MgcmVwcmVzZW50aW5nIHRoZSBwcmV2aW91cyBvd25lciBvZiB0aGUgZ2l2ZW4gdG9rZW4gSUQKCSAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiB0byBiZSByZW1vdmVkIGZyb20gdGhlIHRva2VucyBsaXN0IG9mIHRoZSBnaXZlbiBhZGRyZXNzCgkgKi8KCWZ1bmN0aW9uIHJlbW92ZVRva2VuKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIGFkZHJlc3MgX2Zyb20sIHVpbnQyNTYgX3Rva2VuSWQpIHByaXZhdGUgewoJCXZhciBvd25TdG9yYWdlID0gQmRwT3duZXJzaGlwU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwT3duZXJzaGlwU3RvcmFnZShfY29udHJhY3RzKSk7CgoJCXJlcXVpcmUob3duZXJPZihfY29udHJhY3RzLCBfdG9rZW5JZCkgPT0gX2Zyb20pOwoKCQkvLyBDbGVhciB0b2tlbiBvd25lcgoJCW93blN0b3JhZ2Uuc2V0VG9rZW5Pd25lcihfdG9rZW5JZCwgMCk7CgoJCXJlbW92ZUZyb21Ub2tlbklkcyhvd25TdG9yYWdlLCBfdG9rZW5JZCk7CgkJcmVtb3ZlRnJvbU93bmVkVG9rZW4ob3duU3RvcmFnZSwgX2Zyb20sIF90b2tlbklkKTsKCgkJLy8gRGVjcmVtZW50IHRvdGFsIG93bmVkIGFyZWEKCQl2YXIgKGFyZWEsLCkgPSBCZHBDYWxjdWxhdG9yLmNhbGN1bGF0ZUFyZWEoX2NvbnRyYWN0cywgX3Rva2VuSWQpOwoJCW93blN0b3JhZ2UuZGVjcmVtZW50T3duZWRBcmVhKF9mcm9tLCBhcmVhKTsKCX0KCgkvKioKCSAqIEBkZXYgUmVtb3ZlIHRva2VuIGZyb20gb3duZWRUb2tlbnMgbGlzdAoJICogTm90ZSB0aGF0IHRoaXMgd2lsbCBoYW5kbGUgc2luZ2xlLWVsZW1lbnQgYXJyYXlzLiBJbiB0aGF0IGNhc2UsIGJvdGggb3duZWRUb2tlbkluZGV4IGFuZCBsYXN0T3duZWRUb2tlbkluZGV4IGFyZSBnb2luZyB0bwoJICogYmUgemVyby4gVGhlbiB3ZSBjYW4gbWFrZSBzdXJlIHRoYXQgd2Ugd2lsbCByZW1vdmUgX3Rva2VuSWQgZnJvbSB0aGUgb3duZWRUb2tlbnMgbGlzdCBzaW5jZSB3ZSBhcmUgZmlyc3Qgc3dhcHBpbmcKCSAqIHRoZSBsYXN0T3duZWRUb2tlbiB0byB0aGUgZmlyc3QgcG9zaXRpb24sIGFuZCB0aGVuIGRyb3BwaW5nIHRoZSBlbGVtZW50IHBsYWNlZCBpbiB0aGUgbGFzdCBwb3NpdGlvbiBvZiB0aGUgbGlzdAoJICovCglmdW5jdGlvbiByZW1vdmVGcm9tT3duZWRUb2tlbihCZHBPd25lcnNoaXBTdG9yYWdlIF9vd25TdG9yYWdlLCBhZGRyZXNzIF9mcm9tLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKCQl2YXIgb3duZWRUb2tlbkluZGV4ID0gX293blN0b3JhZ2UuZ2V0T3duZWRUb2tlbnNJbmRleChfdG9rZW5JZCk7CgkJdmFyIGxhc3RPd25lZFRva2VuSW5kZXggPSBfb3duU3RvcmFnZS5nZXRPd25lZFRva2Vuc0xlbmd0aChfZnJvbSkuc3ViKDEpOwoJCXZhciBsYXN0T3duZWRUb2tlbiA9IF9vd25TdG9yYWdlLmdldE93bmVkVG9rZW4oX2Zyb20sIGxhc3RPd25lZFRva2VuSW5kZXgpOwoJCV9vd25TdG9yYWdlLnNldE93bmVkVG9rZW4oX2Zyb20sIG93bmVkVG9rZW5JbmRleCwgbGFzdE93bmVkVG9rZW4pOwoJCV9vd25TdG9yYWdlLnNldE93bmVkVG9rZW4oX2Zyb20sIGxhc3RPd25lZFRva2VuSW5kZXgsIDApOwoJCV9vd25TdG9yYWdlLmRlY3JlbWVudE93bmVkVG9rZW5zTGVuZ3RoKF9mcm9tKTsKCQlfb3duU3RvcmFnZS5zZXRPd25lZFRva2Vuc0luZGV4KF90b2tlbklkLCAwKTsKCQlfb3duU3RvcmFnZS5zZXRPd25lZFRva2Vuc0luZGV4KGxhc3RPd25lZFRva2VuLCBvd25lZFRva2VuSW5kZXgpOwoJfQoKCS8qKgoJICogQGRldiBSZW1vdmUgdG9rZW4gZnJvbSB0b2tlbklkcyBsaXN0CgkgKi8KCWZ1bmN0aW9uIHJlbW92ZUZyb21Ub2tlbklkcyhCZHBPd25lcnNoaXBTdG9yYWdlIF9vd25TdG9yYWdlLCB1aW50MjU2IF90b2tlbklkKSBwcml2YXRlIHsKCQl2YXIgdG9rZW5JbmRleCA9IF9vd25TdG9yYWdlLmdldFRva2VuSWRzSW5kZXgoX3Rva2VuSWQpOwoJCXZhciBsYXN0VG9rZW5JZEluZGV4ID0gX293blN0b3JhZ2UuZ2V0VG9rZW5JZHNMZW5ndGgoKS5zdWIoMSk7CgkJdmFyIGxhc3RUb2tlbklkID0gX293blN0b3JhZ2UuZ2V0VG9rZW5JZEJ5SW5kZXgobGFzdFRva2VuSWRJbmRleCk7CgkJX293blN0b3JhZ2Uuc2V0VG9rZW5JZEJ5SW5kZXgodG9rZW5JbmRleCwgbGFzdFRva2VuSWQpOwoJCV9vd25TdG9yYWdlLnNldFRva2VuSWRCeUluZGV4KGxhc3RUb2tlbklkSW5kZXgsIDApOwoJCV9vd25TdG9yYWdlLmRlY3JlbWVudFRva2VuSWRzTGVuZ3RoKCk7CgkJX293blN0b3JhZ2Uuc2V0VG9rZW5JZHNJbmRleChfdG9rZW5JZCwgMCk7CgkJX293blN0b3JhZ2Uuc2V0VG9rZW5JZHNJbmRleChsYXN0VG9rZW5JZCwgdG9rZW5JbmRleCk7Cgl9CgoJLyoqCgkgKiBAZGV2IE1pbnQgdG9rZW4gZnVuY3Rpb24KCSAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCB3aWxsIG93biB0aGUgbWludGVkIHRva2VuCgkgKiBAcGFyYW0gX3Rva2VuSWQgdWludDI1NiBJRCBvZiB0aGUgdG9rZW4gdG8gYmUgbWludGVkIGJ5IHRoZSBtc2cuc2VuZGVyCgkgKi8KCWZ1bmN0aW9uIG1pbnQoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CgkJcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgkJYWRkVG9rZW4oX2NvbnRyYWN0cywgX3RvLCBfdG9rZW5JZCk7CgkJVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfdG9rZW5JZCk7Cgl9CgoJLyoqCgkgKiBAZGV2IEJ1cm5zIGEgc3BlY2lmaWMgdG9rZW4KCSAqIEBwYXJhbSBfdG9rZW5JZCB1aW50MjU2IElEIG9mIHRoZSB0b2tlbiBiZWluZyBidXJuZWQKCSAqLwoJZnVuY3Rpb24gYnVybihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgewoJCWFkZHJlc3Mgb3duZXIgPSBCZHBPd25lcnNoaXBTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBPd25lcnNoaXBTdG9yYWdlKF9jb250cmFjdHMpKS5nZXRUb2tlbk93bmVyKF90b2tlbklkKTsKCQljbGVhckFwcHJvdmFsKF9jb250cmFjdHMsIG93bmVyLCBfdG9rZW5JZCk7CgkJcmVtb3ZlVG9rZW4oX2NvbnRyYWN0cywgb3duZXIsIF90b2tlbklkKTsKCQlUcmFuc2Zlcihvd25lciwgYWRkcmVzcygwKSwgX3Rva2VuSWQpOwoJfQoKfQoKLy8gRmlsZTogY29udHJhY3RzL2xpYnJhcmllcy9CZHBJbWFnZS5zb2wKCmxpYnJhcnkgQmRwSW1hZ2UgewoKCWZ1bmN0aW9uIGNoZWNrSW1hZ2VJbnB1dChhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCwgdWludDI1NiBfaW1hZ2VJZCwgdWludDI1NltdIF9pbWFnZURhdGEsIGJvb2wgX3N3YXBJbWFnZXMsIGJvb2wgX2NsZWFySW1hZ2UpIHZpZXcgcHVibGljIHsKCQl2YXIgZGF0YVN0b3JhZ2UgPSBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpOwoJCXZhciBpbWFnZVN0b3JhZ2UgPSBCZHBJbWFnZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcEltYWdlU3RvcmFnZShfY29udHJhY3RzKSk7CgoJCXJlcXVpcmUoIChfaW1hZ2VJZCA9PSAwICYmIF9pbWFnZURhdGEubGVuZ3RoID09IDAgJiYgIV9zd2FwSW1hZ2VzICYmICFfY2xlYXJJbWFnZSkgLy8gT25seSBvbmUgd2F5IHRvIGNoYW5nZSBpbWFnZSBjYW4gYmUgc3BlY2lmaWVkCgkJCXx8IChfaW1hZ2VJZCAhPSAwICYmIF9pbWFnZURhdGEubGVuZ3RoID09IDAgJiYgIV9zd2FwSW1hZ2VzICYmICFfY2xlYXJJbWFnZSkgLy8gSWYgaW1hZ2UgaGFzIHRvIGJlIGNoYW5nZWQKCQkJfHwgKF9pbWFnZUlkID09IDAgJiYgX2ltYWdlRGF0YS5sZW5ndGggIT0gMCAmJiAhX3N3YXBJbWFnZXMgJiYgIV9jbGVhckltYWdlKQoJCQl8fCAoX2ltYWdlSWQgPT0gMCAmJiBfaW1hZ2VEYXRhLmxlbmd0aCA9PSAwICYmIF9zd2FwSW1hZ2VzICYmICFfY2xlYXJJbWFnZSkKCQkJfHwgKF9pbWFnZUlkID09IDAgJiYgX2ltYWdlRGF0YS5sZW5ndGggPT0gMCAmJiAhX3N3YXBJbWFnZXMgJiYgX2NsZWFySW1hZ2UpICk7CgoJCXJlcXVpcmUoX2ltYWdlSWQgPT0gMCB8fCAvLyBDYW4gdXNlIG9ubHkgb3duIGltYWdlcyBub3QgdXNlZCBieSBvdGhlciByZWdpb25zCgkJCSggKG1zZy5zZW5kZXIgPT0gaW1hZ2VTdG9yYWdlLmdldEltYWdlT3duZXIoX2ltYWdlSWQpKSAmJiAoaW1hZ2VTdG9yYWdlLmdldEltYWdlQ3VycmVudFJlZ2lvbklkKF9pbWFnZUlkKSA9PSAwKSApICk7CgoJCXZhciBuZXh0SW1hZ2VJZCA9IGRhdGFTdG9yYWdlLmdldFJlZ2lvbk5leHRJbWFnZUlkKF9yZWdpb25JZCk7CgkJcmVxdWlyZSghX3N3YXBJbWFnZXMgfHwgaW1hZ2VVcGxvYWRDb21wbGV0ZShfY29udHJhY3RzLCBuZXh0SW1hZ2VJZCkpOyAvLyBDYW4gc3dhcCBpbWFnZXMgaWYgbmV4dCBpbWFnZSB1cGxvYWQgaXMgY29tcGxldGUKCX0KCglmdW5jdGlvbiBzZXROZXh0SW1hZ2VQYXJ0KGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQyNTYgX3JlZ2lvbklkLCB1aW50MTYgX3BhcnQsIHVpbnQxNiBfcGFydHNDb3VudCwgdWludDE2IF9pbWFnZURlc2NyaXB0b3IsIHVpbnQyNTZbXSBfaW1hZ2VEYXRhKSBwdWJsaWMgewoJCXZhciBkYXRhU3RvcmFnZSA9IEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShfY29udHJhY3RzKSk7CgkJdmFyIGltYWdlU3RvcmFnZSA9IEJkcEltYWdlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwSW1hZ2VTdG9yYWdlKF9jb250cmFjdHMpKTsKCgkJcmVxdWlyZShCZHBPd25lcnNoaXAub3duZXJPZihfY29udHJhY3RzLCBfcmVnaW9uSWQpID09IG1zZy5zZW5kZXIpOwoJCXJlcXVpcmUoX2ltYWdlRGF0YS5sZW5ndGggIT0gMCk7CgkJcmVxdWlyZShfcGFydCA+IDApOwoJCXJlcXVpcmUoX3BhcnQgPD0gX3BhcnRzQ291bnQpOwoKCQl2YXIgbmV4dEltYWdlSWQgPSBkYXRhU3RvcmFnZS5nZXRSZWdpb25OZXh0SW1hZ2VJZChfcmVnaW9uSWQpOwoJCWlmKG5leHRJbWFnZUlkID09IDAgfHwgX2ltYWdlRGVzY3JpcHRvciAhPSBpbWFnZVN0b3JhZ2UuZ2V0SW1hZ2VEZXNjcmlwdG9yKG5leHRJbWFnZUlkKSkgewoJCQl2YXIgKCwgd2lkdGgsIGhlaWdodCkgPSBCZHBDYWxjdWxhdG9yLmNhbGN1bGF0ZUFyZWEoX2NvbnRyYWN0cywgX3JlZ2lvbklkKTsKCQkJbmV4dEltYWdlSWQgPSBpbWFnZVN0b3JhZ2UuY3JlYXRlSW1hZ2UobXNnLnNlbmRlciwgX3JlZ2lvbklkLCB1aW50MTYod2lkdGgpLCB1aW50MTYoaGVpZ2h0KSwgX3BhcnRzQ291bnQsIF9pbWFnZURlc2NyaXB0b3IpOwoJCQlkYXRhU3RvcmFnZS5zZXRSZWdpb25OZXh0SW1hZ2VJZChfcmVnaW9uSWQsIG5leHRJbWFnZUlkKTsKCQl9CgoJCWltYWdlU3RvcmFnZS5zZXRJbWFnZURhdGEobmV4dEltYWdlSWQsIF9wYXJ0LCBfaW1hZ2VEYXRhKTsKCX0KCglmdW5jdGlvbiBzZXRJbWFnZU93bmVyKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQyNTYgX2ltYWdlSWQsIGFkZHJlc3MgX293bmVyKSBwdWJsaWMgewoJCXZhciBpbWFnZVN0b3JhZ2UgPSBCZHBJbWFnZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcEltYWdlU3RvcmFnZShfY29udHJhY3RzKSk7CgkJcmVxdWlyZShpbWFnZVN0b3JhZ2UuZ2V0SW1hZ2VPd25lcihfaW1hZ2VJZCkgPT0gbXNnLnNlbmRlcik7CgkJcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSk7CgoJCWltYWdlU3RvcmFnZS5zZXRJbWFnZU93bmVyKF9pbWFnZUlkLCBfb3duZXIpOwoJfQoKCWZ1bmN0aW9uIHNldEltYWdlRGF0YShhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9pbWFnZUlkLCB1aW50MTYgX3BhcnQsIHVpbnQyNTZbXSBfaW1hZ2VEYXRhKSBwdWJsaWMgcmV0dXJucyAoYWRkcmVzcykgewoJCXZhciBpbWFnZVN0b3JhZ2UgPSBCZHBJbWFnZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcEltYWdlU3RvcmFnZShfY29udHJhY3RzKSk7CgkJcmVxdWlyZShpbWFnZVN0b3JhZ2UuZ2V0SW1hZ2VPd25lcihfaW1hZ2VJZCkgPT0gbXNnLnNlbmRlcik7CgkJcmVxdWlyZShpbWFnZVN0b3JhZ2UuZ2V0SW1hZ2VDdXJyZW50UmVnaW9uSWQoX2ltYWdlSWQpID09IDApOwoJCXJlcXVpcmUoX2ltYWdlRGF0YS5sZW5ndGggIT0gMCk7CgkJcmVxdWlyZShfcGFydCA+IDApOwoJCXJlcXVpcmUoX3BhcnQgPD0gaW1hZ2VTdG9yYWdlLmdldEltYWdlUGFydHNDb3VudChfaW1hZ2VJZCkpOwoKCQlpbWFnZVN0b3JhZ2Uuc2V0SW1hZ2VEYXRhKF9pbWFnZUlkLCBfcGFydCwgX2ltYWdlRGF0YSk7Cgl9CgoJZnVuY3Rpb24gaW1hZ2VVcGxvYWRDb21wbGV0ZShhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9pbWFnZUlkKSB2aWV3IHB1YmxpYyByZXR1cm5zIChib29sKSB7CgkJdmFyIGltYWdlU3RvcmFnZSA9IEJkcEltYWdlU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwSW1hZ2VTdG9yYWdlKF9jb250cmFjdHMpKTsKCQl2YXIgcGFydHNDb3VudCA9IGltYWdlU3RvcmFnZS5nZXRJbWFnZVBhcnRzQ291bnQoX2ltYWdlSWQpOwoJCWZvciAodWludDE2IGkgPSAxOyBpIDw9IHBhcnRzQ291bnQ7IGkrKykgewoJCQlpZihpbWFnZVN0b3JhZ2UuZ2V0SW1hZ2VEYXRhTGVuZ3RoKF9pbWFnZUlkLCBpKSA9PSAwKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9CgkJcmV0dXJuIHRydWU7Cgl9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvbGlicmFyaWVzL0JkcENydWQuc29sCgpsaWJyYXJ5IEJkcENydWQgewoKCWZ1bmN0aW9uIGNyZWF0ZVJlZ2lvbihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCBhZGRyZXNzIF90bywgdWludDI1NiBfeDEsIHVpbnQyNTYgX3kxLCB1aW50MjU2IF94MiwgdWludDI1NiBfeTIpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CgkJdmFyIGRhdGFTdG9yYWdlID0gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKTsKCQlyZXF1aXJlKF94MiA8IDEwMDAgJiYgX3gxIDw9IF94Mik7CgkJcmVxdWlyZShfeTIgPCAxMDAwICYmIF95MSA8PSBfeTIpOwoKCQl2YXIgcmVnaW9uSWQgPSBkYXRhU3RvcmFnZS5nZXROZXh0UmVnaW9uSWQoKTsKCQlkYXRhU3RvcmFnZS5zZXRSZWdpb25Db29yZGluYXRlcyhyZWdpb25JZCwgX3gxLCBfeTEsIF94MiwgX3kyKTsKCQlkYXRhU3RvcmFnZS5zZXRSZWdpb25CbG9ja1VwZGF0ZWRBdChyZWdpb25JZCwgYmxvY2subnVtYmVyKTsKCQlkYXRhU3RvcmFnZS5zZXRSZWdpb25VcGRhdGVkQXQocmVnaW9uSWQsIGJsb2NrLnRpbWVzdGFtcCk7CgoJCUJkcE93bmVyc2hpcC5taW50KF9jb250cmFjdHMsIF90bywgcmVnaW9uSWQpOwoKCQlyZXR1cm4gcmVnaW9uSWQ7Cgl9CgoJZnVuY3Rpb24gZGVsZXRlUmVnaW9uKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQyNTYgX3JlZ2lvbklkKSBwdWJsaWMgewoJCXZhciBkYXRhU3RvcmFnZSA9IEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShfY29udHJhY3RzKSk7CgkJdmFyIHJlZ2lvblB1cmNoYXNlUGl4ZWxQcmljZSA9IGRhdGFTdG9yYWdlLmdldFJlZ2lvblB1cmNoYXNlUGl4ZWxQcmljZShfcmVnaW9uSWQpOwoJCXJlcXVpcmUocmVnaW9uUHVyY2hhc2VQaXhlbFByaWNlID09IDApOwoJCUJkcE93bmVyc2hpcC5idXJuKF9jb250cmFjdHMsIF9yZWdpb25JZCk7CgkJZGF0YVN0b3JhZ2UuZGVsZXRlUmVnaW9uRGF0YShfcmVnaW9uSWQpOwoJfQoKCWZ1bmN0aW9uIHNldHVwUmVnaW9uKGFkZHJlc3NbMTZdIF9jb250cmFjdHMsIHVpbnQyNTYgX3JlZ2lvbklkLCB1aW50MjU2IF9pbWFnZUlkLCB1aW50MjU2W10gX2ltYWdlRGF0YSwgYm9vbCBfc3dhcEltYWdlcywgdWludDhbMTI4XSBfdXJsKSBwdWJsaWMgewoJCXZhciBkYXRhU3RvcmFnZSA9IEJkcERhdGFTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBEYXRhU3RvcmFnZShfY29udHJhY3RzKSk7CgkJcmVxdWlyZShCZHBPd25lcnNoaXAub3duZXJPZihfY29udHJhY3RzLCBfcmVnaW9uSWQpID09IG1zZy5zZW5kZXIpOwoJCXJlcXVpcmUoX2ltYWdlSWQgIT0gMCB8fCBfaW1hZ2VEYXRhLmxlbmd0aCAhPSAwIHx8IF9zd2FwSW1hZ2VzIHx8IF91cmwubGVuZ3RoICE9IDApOyAvLyBPbmx5IGlmIGltYWdlIG9yIHVybCBpcyBzcGVjaWZpZWQKCQlyZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA8IEJkcENhbGN1bGF0b3IuY2FsY3VsYXRlU2V0dXBBbGxvd2VkVW50aWwoX2NvbnRyYWN0cywgX3JlZ2lvbklkKSk7IC8vIENhbiBvbmx5IGV4ZWN1dGUgaWYgc2V0dXAgaXMgYWxsb3dlZAoJCUJkcEltYWdlLmNoZWNrSW1hZ2VJbnB1dChfY29udHJhY3RzLCBfcmVnaW9uSWQsIF9pbWFnZUlkLCBfaW1hZ2VEYXRhLCBfc3dhcEltYWdlcywgZmFsc2UpOwoKCQlfdXBkYXRlUmVnaW9uSW1hZ2UoX2NvbnRyYWN0cywgZGF0YVN0b3JhZ2UsIF9yZWdpb25JZCwgX2ltYWdlSWQsIF9pbWFnZURhdGEsIF9zd2FwSW1hZ2VzLCBmYWxzZSk7CgkJX3VwZGF0ZVJlZ2lvblVybChkYXRhU3RvcmFnZSwgX3JlZ2lvbklkLCBfdXJsLCBmYWxzZSk7CgoJCWRhdGFTdG9yYWdlLnNldFJlZ2lvbkJsb2NrVXBkYXRlZEF0KF9yZWdpb25JZCwgYmxvY2subnVtYmVyKTsKCQlkYXRhU3RvcmFnZS5zZXRSZWdpb25VcGRhdGVkQXQoX3JlZ2lvbklkLCBibG9jay50aW1lc3RhbXApOwoJfQoKCWZ1bmN0aW9uIHVwZGF0ZVJlZ2lvbihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCwgdWludDI1NiBfaW1hZ2VJZCwgdWludDI1NltdIF9pbWFnZURhdGEsIGJvb2wgX3N3YXBJbWFnZXMsIGJvb2wgX2NsZWFySW1hZ2UsIHVpbnQ4WzEyOF0gX3VybCwgYm9vbCBfZGVsZXRlVXJsLCBhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIHsKCQl2YXIgZGF0YVN0b3JhZ2UgPSBCZHBEYXRhU3RvcmFnZShCZHBDb250cmFjdHMuZ2V0QmRwRGF0YVN0b3JhZ2UoX2NvbnRyYWN0cykpOwoJCXJlcXVpcmUoQmRwT3duZXJzaGlwLm93bmVyT2YoX2NvbnRyYWN0cywgX3JlZ2lvbklkKSA9PSBtc2cuc2VuZGVyKTsKCQlCZHBJbWFnZS5jaGVja0ltYWdlSW5wdXQoX2NvbnRyYWN0cywgX3JlZ2lvbklkLCBfaW1hZ2VJZCwgX2ltYWdlRGF0YSwgX3N3YXBJbWFnZXMsIF9jbGVhckltYWdlKTsKCQl2YXIgcmVnaW9uQ3VycmVudFBpeGVsUHJpY2UgPSBkYXRhU3RvcmFnZS5nZXRSZWdpb25DdXJyZW50UGl4ZWxQcmljZShfcmVnaW9uSWQpOwoJCXJlcXVpcmUocmVnaW9uQ3VycmVudFBpeGVsUHJpY2UgIT0gMCk7IC8vIHJlZ2lvbiB3YXMgcHVyY2hhc2VkCgoJCXZhciBtYXJrZXRQaXhlbFByaWNlID0gQmRwQ2FsY3VsYXRvci5jYWxjdWxhdGVDdXJyZW50TWFya2V0UGl4ZWxQcmljZShfY29udHJhY3RzKTsKCgkJdmFyIChhcmVhLCwpID0gQmRwQ2FsY3VsYXRvci5jYWxjdWxhdGVBcmVhKF9jb250cmFjdHMsIF9yZWdpb25JZCk7CgkJX3Byb2Nlc3NVcGRhdGVGZWUoX2NvbnRyYWN0cywgbWFya2V0UGl4ZWxQcmljZSAqIGFyZWEgLyAyMCk7CgoJCV91cGRhdGVSZWdpb25JbWFnZShfY29udHJhY3RzLCBkYXRhU3RvcmFnZSwgX3JlZ2lvbklkLCBfaW1hZ2VJZCwgX2ltYWdlRGF0YSwgX3N3YXBJbWFnZXMsIF9jbGVhckltYWdlKTsKCQlfdXBkYXRlUmVnaW9uVXJsKGRhdGFTdG9yYWdlLCBfcmVnaW9uSWQsIF91cmwsIF9kZWxldGVVcmwpOwoJCV91cGRhdGVSZWdpb25Pd25lcihfY29udHJhY3RzLCBfcmVnaW9uSWQsIF9uZXdPd25lcik7CgkJaWYobWFya2V0UGl4ZWxQcmljZSA+IHJlZ2lvbkN1cnJlbnRQaXhlbFByaWNlKSB7CgkJCWRhdGFTdG9yYWdlLnNldFJlZ2lvbkN1cnJlbnRQaXhlbFByaWNlKF9yZWdpb25JZCwgbWFya2V0UGl4ZWxQcmljZSk7CgkJfQoJCWRhdGFTdG9yYWdlLnNldFJlZ2lvbkJsb2NrVXBkYXRlZEF0KF9yZWdpb25JZCwgYmxvY2subnVtYmVyKTsKCQlkYXRhU3RvcmFnZS5zZXRSZWdpb25VcGRhdGVkQXQoX3JlZ2lvbklkLCBibG9jay50aW1lc3RhbXApOwoJfQoKCWZ1bmN0aW9uIHVwZGF0ZVJlZ2lvblBpeGVsUHJpY2UoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgdWludDI1NiBfcmVnaW9uSWQsIHVpbnQyNTYgX3BpeGVsUHJpY2UpIHB1YmxpYyB7CgkJdmFyIGRhdGFTdG9yYWdlID0gQmRwRGF0YVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcERhdGFTdG9yYWdlKF9jb250cmFjdHMpKTsKCQlyZXF1aXJlKEJkcE93bmVyc2hpcC5vd25lck9mKF9jb250cmFjdHMsIF9yZWdpb25JZCkgPT0gbXNnLnNlbmRlcik7CgkJdmFyIHJlZ2lvbkN1cnJlbnRQaXhlbFByaWNlID0gZGF0YVN0b3JhZ2UuZ2V0UmVnaW9uQ3VycmVudFBpeGVsUHJpY2UoX3JlZ2lvbklkKTsKCQlyZXF1aXJlKHJlZ2lvbkN1cnJlbnRQaXhlbFByaWNlICE9IDApOyAvLyByZWdpb24gd2FzIHB1cmNoYXNlZAoKCQl2YXIgbWFya2V0UGl4ZWxQcmljZSA9IEJkcENhbGN1bGF0b3IuY2FsY3VsYXRlQ3VycmVudE1hcmtldFBpeGVsUHJpY2UoX2NvbnRyYWN0cyk7CgkJcmVxdWlyZShfcGl4ZWxQcmljZSA+PSBtYXJrZXRQaXhlbFByaWNlKTsKCgkJdmFyIChhcmVhLCwpID0gQmRwQ2FsY3VsYXRvci5jYWxjdWxhdGVBcmVhKF9jb250cmFjdHMsIF9yZWdpb25JZCk7CgkJX3Byb2Nlc3NVcGRhdGVGZWUoX2NvbnRyYWN0cywgX3BpeGVsUHJpY2UgKiBhcmVhIC8gMjApOwoKCQlkYXRhU3RvcmFnZS5zZXRSZWdpb25DdXJyZW50UGl4ZWxQcmljZShfcmVnaW9uSWQsIF9waXhlbFByaWNlKTsKCX0KCglmdW5jdGlvbiBfcHJvY2Vzc1VwZGF0ZUZlZShhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF91cGRhdGVGZWUpIGludGVybmFsIHsKCQlyZXF1aXJlKG1zZy52YWx1ZSA+PSBfdXBkYXRlRmVlKTsKCgkJaWYobXNnLnZhbHVlID4gX3VwZGF0ZUZlZSkgewoJCQl2YXIgY2hhbmdlID0gbXNnLnZhbHVlIC0gX3VwZGF0ZUZlZTsKCQkJbXNnLnNlbmRlci50cmFuc2ZlcihjaGFuZ2UpOwoJCX0KCgkJdmFyIGZvcndhcmRVcGRhdGVGZWVzVG8gPSBCZHBQcmljZVN0b3JhZ2UoQmRwQ29udHJhY3RzLmdldEJkcFByaWNlU3RvcmFnZShfY29udHJhY3RzKSkuZ2V0Rm9yd2FyZFVwZGF0ZUZlZXNUbygpOwoJCWlmKGZvcndhcmRVcGRhdGVGZWVzVG8gIT0gYWRkcmVzcygwKSkgewoJCQlmb3J3YXJkVXBkYXRlRmVlc1RvLnRyYW5zZmVyKF91cGRhdGVGZWUpOwoJCX0KCX0KCglmdW5jdGlvbiBfdXBkYXRlUmVnaW9uSW1hZ2UoYWRkcmVzc1sxNl0gX2NvbnRyYWN0cywgQmRwRGF0YVN0b3JhZ2UgX2RhdGFTdG9yYWdlLCB1aW50MjU2IF9yZWdpb25JZCwgdWludDI1NiBfaW1hZ2VJZCwgdWludDI1NltdIF9pbWFnZURhdGEsIGJvb2wgX3N3YXBJbWFnZXMsIGJvb2wgX2NsZWFySW1hZ2UpIGludGVybmFsIHsKCQl2YXIgaW1hZ2VTdG9yYWdlID0gQmRwSW1hZ2VTdG9yYWdlKEJkcENvbnRyYWN0cy5nZXRCZHBJbWFnZVN0b3JhZ2UoX2NvbnRyYWN0cykpOwoJCXZhciBjdXJyZW50SW1hZ2VJZCA9IF9kYXRhU3RvcmFnZS5nZXRSZWdpb25DdXJyZW50SW1hZ2VJZChfcmVnaW9uSWQpOwoJCWlmKF9pbWFnZUlkICE9IDApIHsKCQkJaWYoY3VycmVudEltYWdlSWQgIT0gMCkgewoJCQkJaW1hZ2VTdG9yYWdlLnNldEltYWdlQ3VycmVudFJlZ2lvbklkKGN1cnJlbnRJbWFnZUlkLCAwKTsKCQkJfQoJCQlfZGF0YVN0b3JhZ2Uuc2V0UmVnaW9uQ3VycmVudEltYWdlSWQoX3JlZ2lvbklkLCBfaW1hZ2VJZCk7CgkJCWltYWdlU3RvcmFnZS5zZXRJbWFnZUN1cnJlbnRSZWdpb25JZChfaW1hZ2VJZCwgX3JlZ2lvbklkKTsKCQl9CgoJCWlmKF9pbWFnZURhdGEubGVuZ3RoID4gMCkgewoJCQlpZihjdXJyZW50SW1hZ2VJZCAhPSAwKSB7CgkJCQlpbWFnZVN0b3JhZ2Uuc2V0SW1hZ2VDdXJyZW50UmVnaW9uSWQoY3VycmVudEltYWdlSWQsIDApOwoJCQl9CgkJCXZhciAoLCB3aWR0aCwgaGVpZ2h0KSA9IEJkcENhbGN1bGF0b3IuY2FsY3VsYXRlQXJlYShfY29udHJhY3RzLCBfcmVnaW9uSWQpOwoJCQl2YXIgaW1hZ2VJZCA9IGltYWdlU3RvcmFnZS5jcmVhdGVJbWFnZShtc2cuc2VuZGVyLCBfcmVnaW9uSWQsIHVpbnQxNih3aWR0aCksIHVpbnQxNihoZWlnaHQpLCAxLCAxKTsKCQkJaW1hZ2VTdG9yYWdlLnNldEltYWdlRGF0YShpbWFnZUlkLCAxLCBfaW1hZ2VEYXRhKTsKCQkJX2RhdGFTdG9yYWdlLnNldFJlZ2lvbkN1cnJlbnRJbWFnZUlkKF9yZWdpb25JZCwgaW1hZ2VJZCk7CgkJCWltYWdlU3RvcmFnZS5zZXRJbWFnZUN1cnJlbnRSZWdpb25JZChpbWFnZUlkLCBfcmVnaW9uSWQpOwoJCX0KCgkJaWYoX3N3YXBJbWFnZXMpIHsKCQkJaWYoY3VycmVudEltYWdlSWQgIT0gMCkgewoJCQkJaW1hZ2VTdG9yYWdlLnNldEltYWdlQ3VycmVudFJlZ2lvbklkKGN1cnJlbnRJbWFnZUlkLCAwKTsKCQkJfQoJCQl2YXIgbmV4dEltYWdlSWQgPSBfZGF0YVN0b3JhZ2UuZ2V0UmVnaW9uTmV4dEltYWdlSWQoX3JlZ2lvbklkKTsKCQkJX2RhdGFTdG9yYWdlLnNldFJlZ2lvbkN1cnJlbnRJbWFnZUlkKF9yZWdpb25JZCwgbmV4dEltYWdlSWQpOwoJCQlpbWFnZVN0b3JhZ2Uuc2V0SW1hZ2VDdXJyZW50UmVnaW9uSWQobmV4dEltYWdlSWQsIF9yZWdpb25JZCk7CgkJCV9kYXRhU3RvcmFnZS5zZXRSZWdpb25OZXh0SW1hZ2VJZChfcmVnaW9uSWQsIDApOwoJCX0KCgkJaWYoX2NsZWFySW1hZ2UpIHsKCQkJaWYoY3VycmVudEltYWdlSWQgIT0gMCkgewoJCQkJaW1hZ2VTdG9yYWdlLnNldEltYWdlQ3VycmVudFJlZ2lvbklkKGN1cnJlbnRJbWFnZUlkLCAwKTsKCQkJfQoJCQlfZGF0YVN0b3JhZ2Uuc2V0UmVnaW9uQ3VycmVudEltYWdlSWQoX3JlZ2lvbklkLCAwKTsKCQl9Cgl9CgoJZnVuY3Rpb24gX3VwZGF0ZVJlZ2lvblVybChCZHBEYXRhU3RvcmFnZSBfZGF0YVN0b3JhZ2UsIHVpbnQyNTYgX3JlZ2lvbklkLCB1aW50OFsxMjhdIF91cmwsIGJvb2wgX2RlbGV0ZVVybCkgaW50ZXJuYWwgewoJCWlmKF91cmxbMF0gIT0gMCkgewoJCQlfZGF0YVN0b3JhZ2Uuc2V0UmVnaW9uVXJsKF9yZWdpb25JZCwgX3VybCk7CgkJfQoJCWlmKF9kZWxldGVVcmwpIHsKCQkJdWludDhbMTI4XSBtZW1vcnkgZW1wdHlVcmw7CgkJCV9kYXRhU3RvcmFnZS5zZXRSZWdpb25VcmwoX3JlZ2lvbklkLCBlbXB0eVVybCk7CgkJfQoJfQoKCWZ1bmN0aW9uIF91cGRhdGVSZWdpb25Pd25lcihhZGRyZXNzWzE2XSBfY29udHJhY3RzLCB1aW50MjU2IF9yZWdpb25JZCwgYWRkcmVzcyBfbmV3T3duZXIpIGludGVybmFsIHsKCQlpZihfbmV3T3duZXIgIT0gYWRkcmVzcygwKSkgewoJCQlCZHBPd25lcnNoaXAuY2xlYXJBcHByb3ZhbEFuZFRyYW5zZmVyKF9jb250cmFjdHMsIG1zZy5zZW5kZXIsIF9uZXdPd25lciwgX3JlZ2lvbklkKTsKCQl9Cgl9Cgp9'.
	

]
