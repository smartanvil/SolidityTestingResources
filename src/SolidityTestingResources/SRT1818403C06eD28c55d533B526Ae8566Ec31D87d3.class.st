Class {
	#name : #SRT1818403C06eD28c55d533B526Ae8566Ec31D87d3,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT1818403C06eD28c55d533B526Ae8566Ec31D87d3 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgovKioKICogQHRpdGxlIE93bmFibGUgY29udHJhY3QgLSBiYXNlIGNvbnRyYWN0IHdpdGggYW4gb3duZXIKICovCmNvbnRyYWN0IE93bmFibGUgewogIAogIGFkZHJlc3MgcHVibGljIG93bmVyOwogIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgX2Zyb20sIGFkZHJlc3MgaW5kZXhlZCBfdG8pOwogIAogIC8qKgogICAqIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QgdG8gdGhlIHNlbmRlcgogICAqIGFjY291bnQuCiAgICovCiAgZnVuY3Rpb24gT3duYWJsZSgpIHB1YmxpYyB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIF9uZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgYXNzZXJ0KF9uZXdPd25lciAhPSBhZGRyZXNzKDApKTsgICAgICAKICAgIG5ld093bmVyID0gX25ld093bmVyOwogIH0KCiAgLyoqCiAgICogQGRldiBBY2NlcHQgdHJhbnNmZXJPd25lcnNoaXAuCiAgICovCiAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgcHVibGljIHsKICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyKSB7CiAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CiAgfQp9CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpjb250cmFjdCBTYWZlTWF0aCB7CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IHgsIHVpbnQyNTYgeSkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiB6ID0geCAtIHk7CiAgICBhc3NlcnQoeiA8PSB4KTsKCSAgcmV0dXJuIHo7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiB4LCB1aW50MjU2IHkpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgeiA9IHggKyB5OwoJICBhc3NlcnQoeiA+PSB4KTsKCSAgcmV0dXJuIHo7CiAgfQoJCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgeCwgdWludDI1NiB5KSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IHogPSB4IC8geTsKICAgIHJldHVybiB6OwogIH0KCQogIGZ1bmN0aW9uIG11bCh1aW50MjU2IHgsIHVpbnQyNTYgeSkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiB6ID0geCAqIHk7CiAgICBhc3NlcnQoeCA9PSAwIHx8IHogLyB4ID09IHkpOwogICAgcmV0dXJuIHo7CiAgfQoKICBmdW5jdGlvbiBtaW4odWludDI1NiB4LCB1aW50MjU2IHkpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgeiA9IHggPD0geSA/IHggOiB5OwogICAgcmV0dXJuIHo7CiAgfQoKICBmdW5jdGlvbiBtYXgodWludDI1NiB4LCB1aW50MjU2IHkpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgeiA9IHggPj0geSA/IHggOiB5OwogICAgcmV0dXJuIHo7CiAgfQp9CgoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCB7CglmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50KTsKCWZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIG93bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CglmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludCk7CglmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCWZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoJZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwoJZnVuY3Rpb24gbWludChhZGRyZXNzIHRvLCB1aW50IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCWV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQgdmFsdWUpOwoJZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludCB2YWx1ZSk7Cn0KCgovKioKICogQHRpdGxlIFN0YW5kYXJkIEVSQzIwIHRva2VuCiAqIEBkZXYgSW1wbGVtZW50YXRpb24gb2YgdGhlIGJhc2ljIHN0YW5kYXJkIHRva2VuLgogKiBAZGV2IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKiBAZGV2IEJhc2VkIG9uIGNvZGUgYnkgRmlyc3RCbG9vZDogaHR0cHM6Ly9naXRodWIuY29tL0ZpcnN0Ymxvb2Rpby90b2tlbi9ibG9iL21hc3Rlci9zbWFydF9jb250cmFjdC9GaXJzdEJsb29kVG9rZW4uc29sCiAqLwpjb250cmFjdCBTdGFuZGFyZFRva2VuIGlzIEVSQzIwLCBTYWZlTWF0aCwgT3duYWJsZXsKCQogIHVpbnQyNTYgX3RvdGFsU3VwcGx5OwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CiAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBhcHByb3ZhbHM7CiAgYWRkcmVzcyBwdWJsaWMgY3Jvd2RzYWxlQWdlbnQ7CiAgYm9vbCBwdWJsaWMgcmVsZWFzZWQgPSBmYWxzZTsgIAogIAogIC8qKgogICAqIEBkZXYgRml4IGZvciB0aGUgRVJDMjAgc2hvcnQgYWRkcmVzcyBhdHRhY2sgaHR0cDovL3Zlc3NlbmVzLmNvbS90aGUtZXJjMjAtc2hvcnQtYWRkcmVzcy1hdHRhY2stZXhwbGFpbmVkLwogICAqIEBwYXJhbSBudW13b3JkcyBwYXlsb2FkIHNpemUgIAogICAqLwogIG1vZGlmaWVyIG9ubHlQYXlsb2FkU2l6ZSh1aW50IG51bXdvcmRzKSB7CiAgICBhc3NlcnQobXNnLmRhdGEubGVuZ3RoID09IG51bXdvcmRzICogMzIgKyA0KTsKICAgIF87CiAgfQogIAogIC8qKgogICAqIEBkZXYgVGhlIGZ1bmN0aW9uIGNhbiBiZSBjYWxsZWQgb25seSBieSBjcm93ZHNhbGUgYWdlbnQuCiAgICovCiAgbW9kaWZpZXIgb25seUNyb3dkc2FsZUFnZW50KCkgewogICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gY3Jvd2RzYWxlQWdlbnQpOwogICAgXzsKICB9CgogIC8qKiBMaW1pdCB0b2tlbiBtaW50IGFmdGVyIGZpbmlzaGluZyBjcm93ZHNhbGUKICAgKiBAZGV2IE1ha2Ugc3VyZSB3ZSBhcmUgbm90IGRvbmUgeWV0LgogICAqLwogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICBhc3NlcnQoIXJlbGVhc2VkKTsKICAgIF87CiAgfQogIAogIC8qKgogICAqIEBkZXYgTGltaXQgdG9rZW4gdHJhbnNmZXIgdW50aWwgdGhlIGNyb3dkc2FsZSBpcyBvdmVyLgogICAqLwogIG1vZGlmaWVyIGNhblRyYW5zZmVyKCkgewogICAgYXNzZXJ0KHJlbGVhc2VkKTsKICAgIF87CiAgfSAKICAKICAvKiogCiAgICogQGRldiBUb3RhbCBTdXBwbHkKICAgKiBAcmV0dXJuIF90b3RhbFN1cHBseSAKICAgKi8gIAogIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBfdG90YWxTdXBwbHk7CiAgfQogIAogIC8qKiAKICAgKiBAZGV2IFRva2VucyBiYWxhbmNlCiAgICogQHBhcmFtIF9vd25lciBob2xkZXIgYWRkcmVzcwogICAqIEByZXR1cm4gYmFsYW5jZSBhbW91bnQgCiAgICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgfQogIAogIC8qKiAKICAgKiBAZGV2IFRva2VuIGFsbG93YW5jZQogICAqIEBwYXJhbSBfb3duZXIgaG9sZGVyIGFkZHJlc3MKICAgKiBAcGFyYW0gX3NwZW5kZXIgc3BlbmRlciBhZGRyZXNzCiAgICogQHJldHVybiByZW1haW4gYW1vdW50CiAgICovICAgCiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFwcHJvdmFsc1tfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKiAKICAgKiBAZGV2IFRyYW5mZXIgdG9rZW5zIHRvIGFkZHJlc3MKICAgKiBAcGFyYW0gX3RvIGRlc3QgYWRkcmVzcwogICAqIEBwYXJhbSBfdmFsdWUgdG9rZW5zIGFtb3VudAogICAqIEByZXR1cm4gdHJhbnNmZXIgcmVzdWx0CiAgICovICAgCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgY2FuVHJhbnNmZXIgb25seVBheWxvYWRTaXplKDIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYXNzZXJ0KGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSk7CiAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSA9IHN1YihiYWxhbmNlc1ttc2cuc2VuZGVyXSwgX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgIAogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQogIAogIC8qKiAgICAKICAgKiBAZGV2IFRyYW5mZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gb3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gc291cmNlIGFkZHJlc3MKICAgKiBAcGFyYW0gX3RvIGRlc3QgYWRkcmVzcwogICAqIEBwYXJhbSBfdmFsdWUgdG9rZW5zIGFtb3VudAogICAqIEByZXR1cm4gdHJhbnNmZXIgcmVzdWx0CiAgICovICAgIAogIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfdmFsdWUpIHB1YmxpYyBjYW5UcmFuc2ZlciBvbmx5UGF5bG9hZFNpemUoMykgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICBhc3NlcnQoYmFsYW5jZXNbX2Zyb21dID49IF92YWx1ZSk7CiAgICBhc3NlcnQoYXBwcm92YWxzW19mcm9tXVttc2cuc2VuZGVyXSA+PSBfdmFsdWUpOwogICAgYXBwcm92YWxzW19mcm9tXVttc2cuc2VuZGVyXSA9IHN1YihhcHByb3ZhbHNbX2Zyb21dW21zZy5zZW5kZXJdLCBfdmFsdWUpOwogICAgYmFsYW5jZXNbX2Zyb21dID0gc3ViKGJhbGFuY2VzW19mcm9tXSwgX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgIAogICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KICAKICAvKiogCiAgICogQGRldiBBcHByb3ZlIHRyYW5zZmVyCiAgICogQHBhcmFtIF9zcGVuZGVyIGhvbGRlciBhZGRyZXNzCiAgICogQHBhcmFtIF92YWx1ZSB0b2tlbnMgYW1vdW50CiAgICogQHJldHVybiByZXN1bHQgIAogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfdmFsdWUpIHB1YmxpYyBvbmx5UGF5bG9hZFNpemUoMikgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAvLyBUbyBjaGFuZ2UgdGhlIGFwcHJvdmUgYW1vdW50IHlvdSBmaXJzdCBoYXZlIHRvIHJlZHVjZSB0aGUgYWRkcmVzc2VzYAogICAgLy8gIGFwcHJvdmFscyB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsIDApYCBpZiBpdCBpcyBub3QKICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgLy8gIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICBhc3NlcnQoKF92YWx1ZSA9PSAwKSB8fCAoYXBwcm92YWxzW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9PSAwKSk7CiAgICBhcHByb3ZhbHNbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgCiAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KICAKICAvKiogCiAgICogQGRldiBDcmVhdGUgbmV3IHRva2VucyBhbmQgYWxsb2NhdGUgdGhlbSB0byBhbiBhZGRyZXNzLiBPbmx5IGNhbGxhYmx5IGJ5IGEgY3Jvd2RzYWxlIGNvbnRyYWN0CiAgICogQHBhcmFtIF90byBkZXN0IGFkZHJlc3MKICAgKiBAcGFyYW0gX3ZhbHVlIHRva2VucyBhbW91bnQKICAgKiBAcmV0dXJuIG1pbnQgcmVzdWx0CiAgICovIAogIGZ1bmN0aW9uIG1pbnQoYWRkcmVzcyBfdG8sIHVpbnQgX3ZhbHVlKSBwdWJsaWMgb25seUNyb3dkc2FsZUFnZW50IGNhbk1pbnQgb25seVBheWxvYWRTaXplKDIpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgX3RvdGFsU3VwcGx5ID0gYWRkKF90b3RhbFN1cHBseSwgX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBhZGQoYmFsYW5jZXNbX3RvXSwgX3ZhbHVlKTsKICAgIAogICAgVHJhbnNmZXIoMCwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CgkKICB9CiAgCiAgLyoqCiAgICogQGRldiBTZXQgdGhlIGNvbnRyYWN0IHRoYXQgY2FuIGNhbGwgcmVsZWFzZSBhbmQgbWFrZSB0aGUgdG9rZW4gdHJhbnNmZXJhYmxlLgogICAqIEBwYXJhbSBfY3Jvd2RzYWxlQWdlbnQgY3Jvd2RzYWxlIGNvbnRyYWN0IGFkZHJlc3MKICAgKi8KICBmdW5jdGlvbiBzZXRDcm93ZHNhbGVBZ2VudChhZGRyZXNzIF9jcm93ZHNhbGVBZ2VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICBhc3NlcnQoIXJlbGVhc2VkKTsKICAgIGNyb3dkc2FsZUFnZW50ID0gX2Nyb3dkc2FsZUFnZW50OwogIH0KICAKICAvKioKICAgKiBAZGV2IE9uZSB3YXkgZnVuY3Rpb24gdG8gcmVsZWFzZSB0aGUgdG9rZW5zIHRvIHRoZSB3aWxkLiBDYW4gYmUgY2FsbGVkIG9ubHkgZnJvbSB0aGUgcmVsZWFzZSBhZ2VudCB0aGF0IGlzIHRoZSBmaW5hbCBJQ08gY29udHJhY3QuIAogICAqLwogIGZ1bmN0aW9uIHJlbGVhc2VUb2tlblRyYW5zZmVyKCkgcHVibGljIG9ubHlDcm93ZHNhbGVBZ2VudCB7CiAgICByZWxlYXNlZCA9IHRydWU7CiAgfQoKfQoKLyoqIAogKiBAdGl0bGUgREFPUGxheU1hcmtldDIuMCBjb250cmFjdCAtIHN0YW5kYXJkIEVSQzIwIHRva2VuIHdpdGggU2hvcnQgSGFuZCBBdHRhY2sgYW5kIGFwcHJvdmUoKSByYWNlIGNvbmRpdGlvbiBtaXRpZ2F0aW9uLgogKi8KY29udHJhY3QgREFPUGxheU1hcmtldFRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewogIAogIHN0cmluZyBwdWJsaWMgbmFtZTsKICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICB1aW50IHB1YmxpYyBkZWNpbWFsczsKICAKICAvKiogTmFtZSBhbmQgc3ltYm9sIHdlcmUgdXBkYXRlZC4gKi8KICBldmVudCBVcGRhdGVkVG9rZW5JbmZvcm1hdGlvbihzdHJpbmcgbmV3TmFtZSwgc3RyaW5nIG5ld1N5bWJvbCk7CgogIC8qKgogICAqIENvbnN0cnVjdCB0aGUgdG9rZW4uCiAgICoKICAgKiBUaGlzIHRva2VuIG11c3QgYmUgY3JlYXRlZCB0aHJvdWdoIGEgdGVhbSBtdWx0aXNpZyB3YWxsZXQsIHNvIHRoYXQgaXQgaXMgb3duZWQgYnkgdGhhdCB3YWxsZXQuCiAgICoKICAgKiBAcGFyYW0gX25hbWUgVG9rZW4gbmFtZQogICAqIEBwYXJhbSBfc3ltYm9sIFRva2VuIHN5bWJvbCAtIHNob3VsZCBiZSBhbGwgY2FwcwogICAqIEBwYXJhbSBfaW5pdGlhbFN1cHBseSBIb3cgbWFueSB0b2tlbnMgd2Ugc3RhcnQgd2l0aAogICAqIEBwYXJhbSBfZGVjaW1hbHMgTnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzCiAgICogQHBhcmFtIF9hZGRyIEFkZHJlc3MgZm9yIHRlYW0ncyB0b2tlbnMKICAgKi8KICAgCiAgZnVuY3Rpb24gREFPUGxheU1hcmtldFRva2VuKHN0cmluZyBfbmFtZSwgc3RyaW5nIF9zeW1ib2wsIHVpbnQgX2luaXRpYWxTdXBwbHksIHVpbnQgX2RlY2ltYWxzLCBhZGRyZXNzIF9hZGRyKSBwdWJsaWMgewogICAgcmVxdWlyZShfYWRkciAhPSAweDApOwogICAgbmFtZSA9IF9uYW1lOwogICAgc3ltYm9sID0gX3N5bWJvbDsKICAgIGRlY2ltYWxzID0gX2RlY2ltYWxzOwoJCiAgICBfdG90YWxTdXBwbHkgPSBfaW5pdGlhbFN1cHBseSoxMCoqX2RlY2ltYWxzOwoKICAgIC8vIENyZWF0aW5nIGluaXRpYWwgdG9rZW5zCiAgICBiYWxhbmNlc1tfYWRkcl0gPSBfdG90YWxTdXBwbHk7CiAgfSAgIAogIAogICAvKioKICAgKiBPd25lciBjYW4gdXBkYXRlIHRva2VuIGluZm9ybWF0aW9uIGhlcmUuCiAgICoKICAgKiBJdCBpcyBvZnRlbiB1c2VmdWwgdG8gY29uY2VhbCB0aGUgYWN0dWFsIHRva2VuIGFzc29jaWF0aW9uLCB1bnRpbAogICAqIHRoZSB0b2tlbiBvcGVyYXRpb25zLCBsaWtlIGNlbnRyYWwgaXNzdWFuY2Ugb3IgcmVpc3N1YW5jZSBoYXZlIGJlZW4gY29tcGxldGVkLgogICAqCiAgICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgdGhlIHRva2VuIG93bmVyIHRvIHJlbmFtZSB0aGUgdG9rZW4gYWZ0ZXIgdGhlIG9wZXJhdGlvbnMKICAgKiBoYXZlIGJlZW4gY29tcGxldGVkIGFuZCB0aGVuIHBvaW50IHRoZSBhdWRpZW5jZSB0byB1c2UgdGhlIHRva2VuIGNvbnRyYWN0LgogICAqLwogIGZ1bmN0aW9uIHNldFRva2VuSW5mb3JtYXRpb24oc3RyaW5nIF9uYW1lLCBzdHJpbmcgX3N5bWJvbCkgcHVibGljIG9ubHlPd25lciB7CiAgICBuYW1lID0gX25hbWU7CiAgICBzeW1ib2wgPSBfc3ltYm9sOwoKICAgIFVwZGF0ZWRUb2tlbkluZm9ybWF0aW9uKG5hbWUsIHN5bWJvbCk7CiAgfQoKfQoKCi8qKgogKiBAdGl0bGUgSGFsdGFibGUKICogQGRldiBBYnN0cmFjdCBjb250cmFjdCB0aGF0IGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4KICogZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLiBEaWZmZXJzIGZyb20gUGF1c2FibGUgYnkgY2F1c2luZyBhIHRocm93IHdoZW4gaW4gaGFsdCBtb2RlLgogKi8KY29udHJhY3QgSGFsdGFibGUgaXMgT3duYWJsZSB7CiAgYm9vbCBwdWJsaWMgaGFsdGVkOwoKICBtb2RpZmllciBzdG9wSW5FbWVyZ2VuY3kgewogICAgYXNzZXJ0KCFoYWx0ZWQpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIG9ubHlJbkVtZXJnZW5jeSB7CiAgICBhc3NlcnQoaGFsdGVkKTsKICAgIF87CiAgfQoKICAvKioKICAgKkBkZXYgQ2FsbGVkIGJ5IHRoZSBvd25lciBvbiBlbWVyZ2VuY3ksIHRyaWdnZXJzIHN0b3BwZWQgc3RhdGUKICAgKi8KICBmdW5jdGlvbiBoYWx0KCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgIGhhbHRlZCA9IHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IENhbGxlZCBieSB0aGUgb3duZXIgb24gZW5kIG9mIGVtZXJnZW5jeSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bmhhbHQoKSBleHRlcm5hbCBvbmx5T3duZXIgb25seUluRW1lcmdlbmN5IHsKICAgIGhhbHRlZCA9IGZhbHNlOwogIH0KfQoKCi8qKiAKICogQHRpdGxlIEtpbGxhYmxlIERBT1BsYXlNYXJrZXRUb2tlbkNyb3dkc2FsZSBjb250cmFjdAogKi8KY29udHJhY3QgS2lsbGFibGUgaXMgT3duYWJsZSB7CiAgZnVuY3Rpb24ga2lsbCgpIG9ubHlPd25lciB7CiAgICBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogIH0KfQoKLyoqIAogKiBAdGl0bGUgREFPUGxheU1hcmtldFRva2VuQ3Jvd2RzYWxlIGNvbnRyYWN0IC0gY29udHJhY3QgZm9yIHRva2VuIHNhbGVzLgogKi8KY29udHJhY3QgREFPUGxheU1hcmtldFRva2VuQ3Jvd2RzYWxlIGlzIEhhbHRhYmxlLCBTYWZlTWF0aCwgS2lsbGFibGUgewogIAogIC8qIFRoZSB0b2tlbiB3ZSBhcmUgc2VsbGluZyAqLwogIERBT1BsYXlNYXJrZXRUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8qIHRva2VucyB3aWxsIGJlIHRyYW5zZmVyZWQgZnJvbSB0aGlzIGFkZHJlc3MgKi8KICBhZGRyZXNzIHB1YmxpYyBtdWx0aXNpZ1dhbGxldDsKCiAgLyogdGhlIFVOSVggdGltZXN0YW1wIHN0YXJ0IGRhdGUgb2YgdGhlIGNyb3dkc2FsZSAqLwogIHVpbnQgcHVibGljIHN0YXJ0c0F0OwogIAogIC8qIHRoZSBVTklYIHRpbWVzdGFtcCBlbmQgZGF0ZSBvZiB0aGUgY3Jvd2RzYWxlICovCiAgdWludCBwdWJsaWMgZW5kc0F0OwogIAogIC8qIHRoZSBudW1iZXIgb2YgdG9rZW5zIGFscmVhZHkgc29sZCB0aHJvdWdoIHRoaXMgY29udHJhY3QqLwogIHVpbnQgcHVibGljIHRva2Vuc1NvbGQgPSAwOwogIAogIC8qIEhvdyBtYW55IHdlaSBvZiBmdW5kaW5nIHdlIGhhdmUgcmFpc2VkICovCiAgdWludCBwdWJsaWMgd2VpUmFpc2VkID0gMDsKICAKICAvKiBIb3cgbWFueSB1bmlxdWUgYWRkcmVzc2VzIHRoYXQgaGF2ZSBpbnZlc3RlZCAqLwogIHVpbnQgcHVibGljIGludmVzdG9yQ291bnQgPSAwOwogIAogIC8qIEhhcyB0aGlzIGNyb3dkc2FsZSBiZWVuIGZpbmFsaXplZCAqLwogIGJvb2wgcHVibGljIGZpbmFsaXplZDsKICAKICAvKiBDYXAgb2YgdG9rZW5zICovCiAgdWludCBwdWJsaWMgQ0FQOwogIAogIC8qIEhvdyBtdWNoIEVUSCBlYWNoIGFkZHJlc3MgaGFzIGludmVzdGVkIHRvIHRoaXMgY3Jvd2RzYWxlICovCiAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgaW52ZXN0ZWRBbW91bnRPZjsKICAKICAvKiBIb3cgbXVjaCB0b2tlbnMgdGhpcyBjcm93ZHNhbGUgaGFzIGNyZWRpdGVkIGZvciBlYWNoIGludmVzdG9yIGFkZHJlc3MgKi8KICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyB0b2tlbkFtb3VudE9mOwogIAogIC8qIENvbnRyYWN0IGFkZHJlc3MgdGhhdCBjYW4gY2FsbCBpbnZlc3Qgb3RoZXIgY3J5cHRvICovCiAgYWRkcmVzcyBwdWJsaWMgY3J5cHRvQWdlbnQ7CiAgCiAgLyoqIEhvdyBtYW55IHRva2VucyBoZSBjaGFyZ2VkIGZvciBlYWNoIGludmVzdG9yJ3MgYWRkcmVzcyBpbiBhIHBhcnRpY3VsYXIgcGVyaW9kICovCiAgbWFwcGluZyAodWludCA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBwdWJsaWMgdG9rZW5BbW91bnRPZlBlcmlvZDsKICAKICBzdHJ1Y3QgU3RhZ2UgewogICAgLy8gVU5JWCB0aW1lc3RhbXAgd2hlbiB0aGUgc3RhZ2UgYmVnaW5zCiAgICB1aW50IHN0YXJ0OwogICAgLy8gVU5JWCB0aW1lc3RhbXAgd2hlbiB0aGUgc3RhZ2UgaXMgb3ZlcgogICAgdWludCBlbmQ7CiAgICAvLyBOdW1iZXIgb2YgcGVyaW9kCiAgICB1aW50IHBlcmlvZDsKICAgIC8vIFByaWNlIzEgdG9rZW4gaW4gV0VJCiAgICB1aW50IHByaWNlMTsKICAgIC8vIFByaWNlIzIgdG9rZW4gaW4gV0VJCiAgICB1aW50IHByaWNlMjsKICAgIC8vIFByaWNlIzMgdG9rZW4gaW4gV0VJCiAgICB1aW50IHByaWNlMzsKICAgIC8vIFByaWNlIzQgdG9rZW4gaW4gV0VJCiAgICB1aW50IHByaWNlNDsKICAgIC8vIENhcCBvZiBwZXJpb2QKICAgIHVpbnQgY2FwOwogICAgLy8gVG9rZW4gc29sZCBpbiBwZXJpb2QKICAgIHVpbnQgdG9rZW5Tb2xkOwogIH0KICAKICAvKiogU3RhZ2VzICoqLwogIFN0YWdlW10gcHVibGljIHN0YWdlczsKICB1aW50IHB1YmxpYyBwZXJpb2RTdGFnZTsKICB1aW50IHB1YmxpYyBzdGFnZTsKICAKICAvKiogU3RhdGUgbWFjaGluZQogICAqCiAgICogLSBQcmVwYXJpbmc6IEFsbCBjb250cmFjdCBpbml0aWFsaXphdGlvbiBjYWxscyBhbmQgdmFyaWFibGVzIGhhdmUgbm90IGJlZW4gc2V0IHlldAogICAqIC0gRnVuZGluZzogQWN0aXZlIGNyb3dkc2FsZQogICAqIC0gU3VjY2VzczogTWluaW11bSBmdW5kaW5nIGdvYWwgcmVhY2hlZAogICAqIC0gRmFpbHVyZTogTWluaW11bSBmdW5kaW5nIGdvYWwgbm90IHJlYWNoZWQgYmVmb3JlIGVuZGluZyB0aW1lCiAgICogLSBGaW5hbGl6ZWQ6IFRoZSBmaW5hbGl6ZWQgaGFzIGJlZW4gY2FsbGVkIGFuZCBzdWNjZXNmdWxseSBleGVjdXRlZAogICAqLwogIGVudW0gU3RhdGV7VW5rbm93biwgUHJlcGFyaW5nLCBGdW5kaW5nLCBTdWNjZXNzLCBGYWlsdXJlLCBGaW5hbGl6ZWR9CiAgCiAgLy8gQSBuZXcgaW52ZXN0bWVudCB3YXMgbWFkZQogIGV2ZW50IEludmVzdGVkKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgd2VpQW1vdW50LCB1aW50IHRva2VuQW1vdW50KTsKICAKICAvLyBBIG5ldyBpbnZlc3RtZW50IHdhcyBtYWRlCiAgZXZlbnQgSW52ZXN0ZWRPdGhlckNyeXB0byhhZGRyZXNzIGludmVzdG9yLCB1aW50IHdlaUFtb3VudCwgdWludCB0b2tlbkFtb3VudCk7CgogIC8vIENyb3dkc2FsZSBlbmQgdGltZSBoYXMgYmVlbiBjaGFuZ2VkCiAgZXZlbnQgRW5kc0F0Q2hhbmdlZCh1aW50IF9lbmRzQXQpOwogIAogIC8vIE5ldyBkaXN0cmlidXRpb25zIHdlcmUgbWFkZQogIGV2ZW50IERpc3RyaWJ1dGVkVG9rZW5zKGFkZHJlc3MgaW52ZXN0b3IsIHVpbnQgdG9rZW5BbW91bnQpOwogIAogIC8qKiAKICAgKiBAZGV2IE1vZGlmaWVkIGFsbG93aW5nIGV4ZWN1dGlvbiBvbmx5IGlmIHRoZSBjcm93ZHNhbGUgaXMgY3VycmVudGx5IHJ1bm5pbmcKICAgKi8KICBtb2RpZmllciBpblN0YXRlKFN0YXRlIHN0YXRlKSB7CiAgICByZXF1aXJlKGdldFN0YXRlKCkgPT0gc3RhdGUpOwogICAgXzsKICB9CiAgCiAgLyoqCiAgICogQGRldiBUaGUgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBvbmx5IGJ5IGNyb3dkc2FsZSBhZ2VudC4KICAgKi8KICBtb2RpZmllciBvbmx5Q3J5cHRvQWdlbnQoKSB7CiAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBjcnlwdG9BZ2VudCk7CiAgICBfOwogIH0KICAKICAvKioKICAgKiBAZGV2IENvbnN0cnVjdG9yCiAgICogQHBhcmFtIF90b2tlbiBEQU9QbGF5TWFya2V0VG9rZW4gdG9rZW4gYWRkcmVzcwogICAqIEBwYXJhbSBfbXVsdGlzaWdXYWxsZXQgdGVhbSB3YWxsZXQKICAgKiBAcGFyYW0gX3N0YXJ0IHRva2VuIElDTyBzdGFydCBkYXRlCiAgICogQHBhcmFtIF9jYXAgdG9rZW4gSUNPIAogICAqIEBwYXJhbSBfcHJpY2UgYXJyYXkgb2YgcHJpY2UgCiAgICogQHBhcmFtIF9wZXJpb2RTdGFnZSBwZXJpb2Qgb2Ygc3RhZ2UKICAgKiBAcGFyYW0gX2NhcFBlcmlvZCBjYXAgb2YgcGVyaW9kCiAgICovCiAgZnVuY3Rpb24gREFPUGxheU1hcmtldFRva2VuQ3Jvd2RzYWxlKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9tdWx0aXNpZ1dhbGxldCwgdWludCBfc3RhcnQsIHVpbnQgX2NhcCwgdWludFsyMF0gX3ByaWNlLCB1aW50IF9wZXJpb2RTdGFnZSwgdWludCBfY2FwUGVyaW9kKSBwdWJsaWMgewogIAogICAgcmVxdWlyZShfbXVsdGlzaWdXYWxsZXQgIT0gMHgwKTsKICAgIHJlcXVpcmUoX3N0YXJ0ID49IGJsb2NrLnRpbWVzdGFtcCk7CiAgICByZXF1aXJlKF9jYXAgPiAwKTsKICAgIHJlcXVpcmUoX3BlcmlvZFN0YWdlID4gMCk7CiAgICByZXF1aXJlKF9jYXBQZXJpb2QgPiAwKTsKCQogICAgdG9rZW4gPSBEQU9QbGF5TWFya2V0VG9rZW4oX3Rva2VuKTsKICAgIG11bHRpc2lnV2FsbGV0ID0gX211bHRpc2lnV2FsbGV0OwogICAgc3RhcnRzQXQgPSBfc3RhcnQ7CiAgICBDQVAgPSBfY2FwKjEwKip0b2tlbi5kZWNpbWFscygpOwoJCiAgICBwZXJpb2RTdGFnZSA9IF9wZXJpb2RTdGFnZSoxIGRheXM7CiAgICB1aW50IGNhcFBlcmlvZCA9IF9jYXBQZXJpb2QqMTAqKnRva2VuLmRlY2ltYWxzKCk7CiAgICB1aW50IGogPSAwOwogICAgZm9yKHVpbnQgaT0wOyBpPF9wcmljZS5sZW5ndGg7IGk9aSs0KSB7CiAgICAgIHN0YWdlcy5wdXNoKFN0YWdlKHN0YXJ0c0F0K2oqcGVyaW9kU3RhZ2UsIHN0YXJ0c0F0KyhqKzEpKnBlcmlvZFN0YWdlLCBqLCBfcHJpY2VbaV0sIF9wcmljZVtpKzFdLCBfcHJpY2VbaSsyXSwgX3ByaWNlW2krM10sIGNhcFBlcmlvZCwgMCkpOwogICAgICBqKys7CiAgICB9CiAgICBlbmRzQXQgPSBzdGFnZXNbc3RhZ2VzLmxlbmd0aC0xXS5lbmQ7CiAgICBzdGFnZSA9IDA7CiAgfQogIAogIC8qKgogICAqIEJ1eSB0b2tlbnMgZnJvbSB0aGUgY29udHJhY3QKICAgKi8KICBmdW5jdGlvbigpIHB1YmxpYyBwYXlhYmxlIHsKICAgIGludmVzdEludGVybmFsKG1zZy5zZW5kZXIpOwogIH0KCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqCiAgICovCiAgZnVuY3Rpb24gaW52ZXN0SW50ZXJuYWwoYWRkcmVzcyByZWNlaXZlcikgcHJpdmF0ZSBzdG9wSW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZShtc2cudmFsdWUgPiAwKTsKCQogICAgYXNzZXJ0KGdldFN0YXRlKCkgPT0gU3RhdGUuRnVuZGluZyk7CgogICAgLy8gRGV0ZXJtaW5lIGluIHdoYXQgcGVyaW9kIHdlIGhpdAogICAgc3RhZ2UgPSBnZXRTdGFnZSgpOwoJCiAgICB1aW50IHdlaUFtb3VudCA9IG1zZy52YWx1ZTsKCiAgICAvLyBBY2NvdW50IHByZXNhbGUgc2FsZXMgc2VwYXJhdGVseSwgc28gdGhhdCB0aGV5IGRvIG5vdCBjb3VudCBhZ2FpbnN0IHByaWNpbmcgdHJhbmNoZXMKICAgIHVpbnQgdG9rZW5BbW91bnQgPSBjYWxjdWxhdGVUb2tlbih3ZWlBbW91bnQsIHN0YWdlLCB0b2tlbi5kZWNpbWFscygpKTsKCiAgICBhc3NlcnQodG9rZW5BbW91bnQgPiAwKTsKCgkvLyBDaGVjayB0aGF0IHdlIGRpZCBub3QgYnVzdCB0aGUgY2FwIGluIHRoZSBwZXJpb2QKICAgIGFzc2VydChzdGFnZXNbc3RhZ2VdLmNhcCA+PSBhZGQodG9rZW5BbW91bnQsIHN0YWdlc1tzdGFnZV0udG9rZW5Tb2xkKSk7CgkKICAgIHRva2VuQW1vdW50T2ZQZXJpb2Rbc3RhZ2VdW3JlY2VpdmVyXT1hZGQodG9rZW5BbW91bnRPZlBlcmlvZFtzdGFnZV1bcmVjZWl2ZXJdLHRva2VuQW1vdW50KTsKCQogICAgc3RhZ2VzW3N0YWdlXS50b2tlblNvbGQgPSBhZGQoc3RhZ2VzW3N0YWdlXS50b2tlblNvbGQsdG9rZW5BbW91bnQpOwoJCiAgICBpZiAoc3RhZ2VzW3N0YWdlXS5jYXAgPT0gc3RhZ2VzW3N0YWdlXS50b2tlblNvbGQpewogICAgICB1cGRhdGVTdGFnZShzdGFnZSk7CiAgICAgIGVuZHNBdCA9IHN0YWdlc1tzdGFnZXMubGVuZ3RoLTFdLmVuZDsKICAgIH0KCQoJLy8gQ2hlY2sgdGhhdCB3ZSBkaWQgbm90IGJ1c3QgdGhlIGNhcAogICAgLy9hc3NlcnQoIWlzQnJlYWtpbmdDYXAodG9rZW5BbW91bnQsIHRva2Vuc1NvbGQpKTsKCQogICAgaWYoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPT0gMCkgewogICAgICAgLy8gQSBuZXcgaW52ZXN0b3IKICAgICAgIGludmVzdG9yQ291bnQrKzsKICAgIH0KCiAgICAvLyBVcGRhdGUgaW52ZXN0b3IKICAgIGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdID0gYWRkKGludmVzdGVkQW1vdW50T2ZbcmVjZWl2ZXJdLHdlaUFtb3VudCk7CiAgICB0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSA9IGFkZCh0b2tlbkFtb3VudE9mW3JlY2VpdmVyXSx0b2tlbkFtb3VudCk7CgogICAgLy8gVXBkYXRlIHRvdGFscwogICAgd2VpUmFpc2VkID0gYWRkKHdlaVJhaXNlZCx3ZWlBbW91bnQpOwogICAgdG9rZW5zU29sZCA9IGFkZCh0b2tlbnNTb2xkLHRva2VuQW1vdW50KTsKCiAgICBhc3NpZ25Ub2tlbnMocmVjZWl2ZXIsIHRva2VuQW1vdW50KTsKCiAgICAvLyBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgICBtdWx0aXNpZ1dhbGxldC50cmFuc2Zlcih3ZWlBbW91bnQpOwoKICAgIC8vIFRlbGwgdXMgaW52ZXN0IHdhcyBzdWNjZXNzCiAgICBJbnZlc3RlZChyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCk7CgkKICB9CiAgCiAgLyoqCiAgICogTWFrZSBhbiBpbnZlc3RtZW50LgogICAqCiAgICogQ3Jvd2RzYWxlIG11c3QgYmUgcnVubmluZyBmb3Igb25lIHRvIGludmVzdC4KICAgKiBXZSBtdXN0IGhhdmUgbm90IHByZXNzZWQgdGhlIGVtZXJnZW5jeSBicmFrZS4KICAgKgogICAqIEBwYXJhbSByZWNlaXZlciBUaGUgRXRoZXJldW0gYWRkcmVzcyB3aG8gcmVjZWl2ZXMgdGhlIHRva2VucwogICAqIEBwYXJhbSBfd2VpQW1vdW50IGFtb3VudCBpbiBFdGgKICAgKgogICAqLwogIGZ1bmN0aW9uIGludmVzdE90aGVyQ3J5cHRvKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgX3dlaUFtb3VudCkgcHVibGljIG9ubHlDcnlwdG9BZ2VudCBzdG9wSW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZShfd2VpQW1vdW50ID4gMCk7CgkKICAgIGFzc2VydChnZXRTdGF0ZSgpID09IFN0YXRlLkZ1bmRpbmcpOwoKICAgIC8vIERldGVybWluZSBpbiB3aGF0IHBlcmlvZCB3ZSBoaXQKICAgIHN0YWdlID0gZ2V0U3RhZ2UoKTsKCQogICAgdWludCB3ZWlBbW91bnQgPSBfd2VpQW1vdW50OwoKICAgIC8vIEFjY291bnQgcHJlc2FsZSBzYWxlcyBzZXBhcmF0ZWx5LCBzbyB0aGF0IHRoZXkgZG8gbm90IGNvdW50IGFnYWluc3QgcHJpY2luZyB0cmFuY2hlcwogICAgdWludCB0b2tlbkFtb3VudCA9IGNhbGN1bGF0ZVRva2VuKHdlaUFtb3VudCwgc3RhZ2UsIHRva2VuLmRlY2ltYWxzKCkpOwoKICAgIGFzc2VydCh0b2tlbkFtb3VudCA+IDApOwoKCS8vIENoZWNrIHRoYXQgd2UgZGlkIG5vdCBidXN0IHRoZSBjYXAgaW4gdGhlIHBlcmlvZAogICAgYXNzZXJ0KHN0YWdlc1tzdGFnZV0uY2FwID49IGFkZCh0b2tlbkFtb3VudCwgc3RhZ2VzW3N0YWdlXS50b2tlblNvbGQpKTsKCQogICAgdG9rZW5BbW91bnRPZlBlcmlvZFtzdGFnZV1bcmVjZWl2ZXJdPWFkZCh0b2tlbkFtb3VudE9mUGVyaW9kW3N0YWdlXVtyZWNlaXZlcl0sdG9rZW5BbW91bnQpOwoJCiAgICBzdGFnZXNbc3RhZ2VdLnRva2VuU29sZCA9IGFkZChzdGFnZXNbc3RhZ2VdLnRva2VuU29sZCx0b2tlbkFtb3VudCk7CgkKICAgIGlmIChzdGFnZXNbc3RhZ2VdLmNhcCA9PSBzdGFnZXNbc3RhZ2VdLnRva2VuU29sZCl7CiAgICAgIHVwZGF0ZVN0YWdlKHN0YWdlKTsKICAgICAgZW5kc0F0ID0gc3RhZ2VzW3N0YWdlcy5sZW5ndGgtMV0uZW5kOwogICAgfQoJCgkvLyBDaGVjayB0aGF0IHdlIGRpZCBub3QgYnVzdCB0aGUgY2FwCiAgICAvL2Fzc2VydCghaXNCcmVha2luZ0NhcCh0b2tlbkFtb3VudCwgdG9rZW5zU29sZCkpOwoJCiAgICBpZihpbnZlc3RlZEFtb3VudE9mW3JlY2VpdmVyXSA9PSAwKSB7CiAgICAgICAvLyBBIG5ldyBpbnZlc3RvcgogICAgICAgaW52ZXN0b3JDb3VudCsrOwogICAgfQoKICAgIC8vIFVwZGF0ZSBpbnZlc3RvcgogICAgaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0gPSBhZGQoaW52ZXN0ZWRBbW91bnRPZltyZWNlaXZlcl0sd2VpQW1vdW50KTsKICAgIHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdID0gYWRkKHRva2VuQW1vdW50T2ZbcmVjZWl2ZXJdLHRva2VuQW1vdW50KTsKCiAgICAvLyBVcGRhdGUgdG90YWxzCiAgICB3ZWlSYWlzZWQgPSBhZGQod2VpUmFpc2VkLHdlaUFtb3VudCk7CiAgICB0b2tlbnNTb2xkID0gYWRkKHRva2Vuc1NvbGQsdG9rZW5BbW91bnQpOwoKICAgIGFzc2lnblRva2VucyhyZWNlaXZlciwgdG9rZW5BbW91bnQpOwoJCiAgICAvLyBUZWxsIHVzIGludmVzdCB3YXMgc3VjY2VzcwogICAgSW52ZXN0ZWRPdGhlckNyeXB0byhyZWNlaXZlciwgd2VpQW1vdW50LCB0b2tlbkFtb3VudCk7CiAgfQogIAogIC8qKgogICAqIENyZWF0ZSBuZXcgdG9rZW5zIG9yIHRyYW5zZmVyIGlzc3VlZCB0b2tlbnMgdG8gdGhlIGludmVzdG9yIGRlcGVuZGluZyBvbiB0aGUgY2FwIG1vZGVsLgogICAqLwogIGZ1bmN0aW9uIGFzc2lnblRva2VucyhhZGRyZXNzIHJlY2VpdmVyLCB1aW50IHRva2VuQW1vdW50KSBwcml2YXRlIHsKICAgICB0b2tlbi5taW50KHJlY2VpdmVyLCB0b2tlbkFtb3VudCk7CiAgfQogICAKICAvKioKICAgKiBDaGVjayBpZiB0aGUgY3VycmVudCBpbnZlc3RlZCBicmVha3Mgb3VyIGNhcCBydWxlcy4KICAgKgogICAqIENhbGxlZCBmcm9tIGludmVzdCgpLgogICAqCiAgICogQHBhcmFtIHRva2VuQW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHdlIHRyeSB0byBnaXZlIHRvIHRoZSBpbnZlc3RvciBpbiB0aGUgY3VycmVudCB0cmFuc2FjdGlvbgogICAqIEBwYXJhbSB0b2tlbnNTb2xkVG90YWwgV2hhdCB3b3VsZCBiZSBvdXIgdG90YWwgc29sZCB0b2tlbnMgY291bnQgYWZ0ZXIgdGhpcyB0cmFuc2FjdGlvbgogICAqCiAgICogQHJldHVybiB0cnVlIGlmIHRha2luZyB0aGlzIGludmVzdG1lbnQgd291bGQgYnJlYWsgb3VyIGNhcCBydWxlcwogICAqLwogIGZ1bmN0aW9uIGlzQnJlYWtpbmdDYXAodWludCB0b2tlbkFtb3VudCwgdWludCB0b2tlbnNTb2xkVG90YWwpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIGxpbWl0QnJva2VuKXsKCWlmKGFkZCh0b2tlbkFtb3VudCx0b2tlbnNTb2xkVG90YWwpIDw9IENBUCl7CgkgIHJldHVybiBmYWxzZTsKCX0KCXJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBEaXN0cmlidXRpb24gb2YgcmVtYWluaW5nIHRva2Vucy4KICAgKi8KICBmdW5jdGlvbiBkaXN0cmlidXRpb25PZlRva2VucygpIHB1YmxpYyBzdG9wSW5FbWVyZ2VuY3kgewogICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPj0gZW5kc0F0KTsKICAgIHJlcXVpcmUoIWZpbmFsaXplZCk7CiAgICB1aW50IGFtb3VudDsKICAgIGZvcih1aW50IGk9MDsgaTxzdGFnZXMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYodG9rZW5BbW91bnRPZlBlcmlvZFtzdGFnZXNbaV0ucGVyaW9kXVttc2cuc2VuZGVyXSAhPSAwKXsKICAgICAgICBhbW91bnQgPSBhZGQoYW1vdW50LGRpdihtdWwoc3ViKHN0YWdlc1tpXS5jYXAsc3RhZ2VzW2ldLnRva2VuU29sZCksdG9rZW5BbW91bnRPZlBlcmlvZFtzdGFnZXNbaV0ucGVyaW9kXVttc2cuc2VuZGVyXSksc3RhZ2VzW2ldLnRva2VuU29sZCkpOwogICAgICAgIHRva2VuQW1vdW50T2ZQZXJpb2Rbc3RhZ2VzW2ldLnBlcmlvZF1bbXNnLnNlbmRlcl0gPSAwOwogICAgICB9CiAgICB9CiAgICBhc3NlcnQoYW1vdW50ID4gMCk7CiAgICBhc3NpZ25Ub2tlbnMobXNnLnNlbmRlciwgYW1vdW50KTsKCQogICAgLy8gVGVsbCB1cyBkaXN0cmlidXRlZCB3YXMgc3VjY2VzcwogICAgRGlzdHJpYnV0ZWRUb2tlbnMobXNnLnNlbmRlciwgYW1vdW50KTsKICB9CiAgCiAgLyoqCiAgICogQGRldiBGaW5hbGl6ZSBhIHN1Y2NjZXNmdWwgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplKCkgcHVibGljIGluU3RhdGUoU3RhdGUuU3VjY2Vzcykgb25seU93bmVyIHN0b3BJbkVtZXJnZW5jeSB7CiAgICByZXF1aXJlKGJsb2NrLnRpbWVzdGFtcCA+PSAoZW5kc0F0K3BlcmlvZFN0YWdlKSk7CiAgICByZXF1aXJlKCFmaW5hbGl6ZWQpOwoJCiAgICBmaW5hbGl6ZUNyb3dkc2FsZSgpOwogICAgZmluYWxpemVkID0gdHJ1ZTsKICB9CiAgCiAgLyoqCiAgICogQGRldiBGaW5hbGl6ZSBhIHN1Y2NjZXNmdWwgY3Jvd2RzYWxlLgogICAqLwogIGZ1bmN0aW9uIGZpbmFsaXplQ3Jvd2RzYWxlKCkgaW50ZXJuYWwgewogICAgdG9rZW4ucmVsZWFzZVRva2VuVHJhbnNmZXIoKTsKICB9CiAgCiAgLyoqCiAgICogQGRldiBDaGVjayBpZiB0aGUgSUNPIGdvYWwgd2FzIHJlYWNoZWQuCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBjcm93ZHNhbGUgaGFzIHJhaXNlZCBlbm91Z2ggbW9uZXkgdG8gYmUgYSBzdWNjZXNzCiAgICovCiAgZnVuY3Rpb24gaXNDcm93ZHNhbGVGdWxsKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgIGlmKHRva2Vuc1NvbGQgPj0gQ0FQIHx8IGJsb2NrLnRpbWVzdGFtcCA+PSBlbmRzQXQpewogICAgICByZXR1cm4gdHJ1ZTsgIAogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICAKICAvKiogCiAgICogQGRldiBBbGxvdyBjcm93ZHNhbGUgb3duZXIgdG8gY2xvc2UgZWFybHkgb3IgZXh0ZW5kIHRoZSBjcm93ZHNhbGUuCiAgICogQHBhcmFtIHRpbWUgdGltZXN0YW1wCiAgICovCiAgZnVuY3Rpb24gc2V0RW5kc0F0KHVpbnQgdGltZSkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKCFmaW5hbGl6ZWQpOwogICAgcmVxdWlyZSh0aW1lID49IGJsb2NrLnRpbWVzdGFtcCk7CiAgICBlbmRzQXQgPSB0aW1lOwogICAgRW5kc0F0Q2hhbmdlZChlbmRzQXQpOwogIH0KICAKICAgLyoqCiAgICogQGRldiBBbGxvdyB0byBjaGFuZ2UgdGhlIHRlYW0gbXVsdGlzaWcgYWRkcmVzcyBpbiB0aGUgY2FzZSBvZiBlbWVyZ2VuY3kuCiAgICovCiAgZnVuY3Rpb24gc2V0TXVsdGlzaWcoYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoYWRkciAhPSAweDApOwogICAgbXVsdGlzaWdXYWxsZXQgPSBhZGRyOwogIH0KICAKICAvKioKICAgKiBAZGV2IEFsbG93IGNyb3dkc2FsZSBvd25lciB0byBjaGFuZ2UgdGhlIHRva2VuIGFkZHJlc3MuCiAgICovCiAgZnVuY3Rpb24gc2V0VG9rZW4oYWRkcmVzcyBhZGRyKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHJlcXVpcmUoYWRkciAhPSAweDApOwogICAgdG9rZW4gPSBEQU9QbGF5TWFya2V0VG9rZW4oYWRkcik7CiAgfQogIAogIC8qKiAKICAgKiBAZGV2IENyb3dkZnVuZCBzdGF0ZSBtYWNoaW5lIG1hbmFnZW1lbnQuCiAgICogQHJldHVybiBTdGF0ZSBjdXJyZW50IHN0YXRlCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhdGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoU3RhdGUpIHsKICAgIGlmIChmaW5hbGl6ZWQpIHJldHVybiBTdGF0ZS5GaW5hbGl6ZWQ7CiAgICBlbHNlIGlmIChhZGRyZXNzKHRva2VuKSA9PSAwIHx8IGFkZHJlc3MobXVsdGlzaWdXYWxsZXQpID09IDAgfHwgYmxvY2sudGltZXN0YW1wIDwgc3RhcnRzQXQpIHJldHVybiBTdGF0ZS5QcmVwYXJpbmc7CiAgICBlbHNlIGlmIChibG9jay50aW1lc3RhbXAgPD0gZW5kc0F0ICYmIGJsb2NrLnRpbWVzdGFtcCA+PSBzdGFydHNBdCAmJiAhaXNDcm93ZHNhbGVGdWxsKCkpIHJldHVybiBTdGF0ZS5GdW5kaW5nOwogICAgZWxzZSBpZiAoaXNDcm93ZHNhbGVGdWxsKCkpIHJldHVybiBTdGF0ZS5TdWNjZXNzOwogICAgZWxzZSByZXR1cm4gU3RhdGUuRmFpbHVyZTsKICB9CiAgCiAgLyoqIAogICAqIEBkZXYgU2V0IGJhc2UgcHJpY2UgZm9yIElDTy4KICAgKi8KICBmdW5jdGlvbiBzZXRCYXNlUHJpY2UodWludFsyMF0gX3ByaWNlLCB1aW50IF9zdGFydERhdGUsIHVpbnQgX3BlcmlvZFN0YWdlLCB1aW50IF9jYXAsIHVpbnQgX2RlY2ltYWxzKSBwdWJsaWMgb25seU93bmVyIHsKICAgIHBlcmlvZFN0YWdlID0gX3BlcmlvZFN0YWdlKjEgZGF5czsKICAgIHVpbnQgY2FwID0gX2NhcCoxMCoqX2RlY2ltYWxzOwogICAgdWludCBqID0gMDsKICAgIGRlbGV0ZSBzdGFnZXM7CiAgICBmb3IodWludCBpPTA7IGk8X3ByaWNlLmxlbmd0aDsgaT1pKzQpIHsKICAgICAgc3RhZ2VzLnB1c2goU3RhZ2UoX3N0YXJ0RGF0ZStqKnBlcmlvZFN0YWdlLCBfc3RhcnREYXRlKyhqKzEpKnBlcmlvZFN0YWdlLCBqLCBfcHJpY2VbaV0sIF9wcmljZVtpKzFdLCBfcHJpY2VbaSsyXSwgX3ByaWNlW2krM10sIGNhcCwgMCkpOwogICAgICBqKys7CiAgICB9CiAgICBlbmRzQXQgPSBzdGFnZXNbc3RhZ2VzLmxlbmd0aC0xXS5lbmQ7CiAgICBzdGFnZSA9MDsKICB9CiAgCiAgLyoqIAogICAqIEBkZXYgVXBkYXRlcyB0aGUgSUNPIHN0ZXBzIGlmIHRoZSBjYXAgaXMgcmVhY2hlZC4KICAgKi8KICBmdW5jdGlvbiB1cGRhdGVTdGFnZSh1aW50IG51bWJlcikgcHJpdmF0ZSB7CiAgICByZXF1aXJlKG51bWJlcj49MCk7CiAgICB1aW50IHRpbWUgPSBibG9jay50aW1lc3RhbXA7CiAgICB1aW50IGogPSAwOwogICAgc3RhZ2VzW251bWJlcl0uZW5kID0gdGltZTsKICAgIGZvciAodWludCBpID0gbnVtYmVyKzE7IGkgPCBzdGFnZXMubGVuZ3RoOyBpKyspIHsKICAgICAgc3RhZ2VzW2ldLnN0YXJ0ID0gdGltZStwZXJpb2RTdGFnZSpqOwogICAgICBzdGFnZXNbaV0uZW5kID0gdGltZStwZXJpb2RTdGFnZSooaisxKTsKICAgICAgaisrOwogICAgfQogIH0KICAKICAvKiogCiAgICogQGRldiBHZXRzIHRoZSBjdXJyZW50IHN0YWdlLgogICAqIEByZXR1cm4gdWludCBjdXJyZW50IHN0YWdlCiAgICovCiAgZnVuY3Rpb24gZ2V0U3RhZ2UoKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpewogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc3RhZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChibG9jay50aW1lc3RhbXAgPj0gc3RhZ2VzW2ldLnN0YXJ0ICYmIGJsb2NrLnRpbWVzdGFtcCA8IHN0YWdlc1tpXS5lbmQpIHsKICAgICAgICByZXR1cm4gc3RhZ2VzW2ldLnBlcmlvZDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHN0YWdlc1tzdGFnZXMubGVuZ3RoLTFdLnBlcmlvZDsKICB9CiAgCiAgLyoqIAogICAqIEBkZXYgR2V0cyB0aGUgY2FwIG9mIGFtb3VudC4KICAgKiBAcmV0dXJuIHVpbnQgY2FwIG9mIGFtb3VudAogICAqLwogIGZ1bmN0aW9uIGdldEFtb3VudENhcCh1aW50IHZhbHVlKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQgKSB7CiAgICBpZih2YWx1ZSA8PSAxMCoxMCoqMTgpewogICAgICByZXR1cm4gMDsKICAgIH1lbHNlIGlmICh2YWx1ZSA8PSA1MCoxMCoqMTgpewogICAgICByZXR1cm4gMTsKICAgIH1lbHNlIGlmICh2YWx1ZSA8PSAzMDAqMTAqKjE4KXsKICAgICAgcmV0dXJuIDI7CiAgICB9ZWxzZSB7CiAgICAgIHJldHVybiAzOwogICAgfQogIH0KICAKICAvKioKICAgKiBXaGVuIHNvbWVib2R5IHRyaWVzIHRvIGJ1eSB0b2tlbnMgZm9yIFggZXRoLCBjYWxjdWxhdGUgaG93IG1hbnkgdG9rZW5zIHRoZXkgZ2V0LgogICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gc2VuZCBpbiBhcyB3ZWkKICAgKiBAcGFyYW0gX3N0YWdlIC0gVGhlIHN0YWdlIG9mIElDTwogICAqIEBwYXJhbSBkZWNpbWFscyAtIEhvdyBtYW55IGRlY2ltYWwgcGxhY2VzIHRoZSB0b2tlbiBoYXMKICAgKiBAcmV0dXJuIEFtb3VudCBvZiB0b2tlbnMgdGhlIGludmVzdG9yIHJlY2VpdmVzCiAgICovCiAgIAogIGZ1bmN0aW9uIGNhbGN1bGF0ZVRva2VuKHVpbnQgdmFsdWUsIHVpbnQgX3N0YWdlLCB1aW50IGRlY2ltYWxzKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQpewogICAgdWludCB0b2tlbkFtb3VudCA9IDA7CiAgICB1aW50IHNhbGVBbW91bnRDYXAgPSBnZXRBbW91bnRDYXAodmFsdWUpOyAKCQogICAgaWYoc2FsZUFtb3VudENhcCA9PSAwKXsKICAgICAgdG9rZW5BbW91bnQgPSBkaXYodmFsdWUqMTAqKmRlY2ltYWxzLHN0YWdlc1tfc3RhZ2VdLnByaWNlMSk7CiAgICB9ZWxzZSBpZihzYWxlQW1vdW50Q2FwID09IDEpewogICAgICB0b2tlbkFtb3VudCA9IGRpdih2YWx1ZSoxMCoqZGVjaW1hbHMsc3RhZ2VzW19zdGFnZV0ucHJpY2UyKTsKICAgIH1lbHNlIGlmKHNhbGVBbW91bnRDYXAgPT0gMil7CiAgICAgIHRva2VuQW1vdW50ID0gZGl2KHZhbHVlKjEwKipkZWNpbWFscyxzdGFnZXNbX3N0YWdlXS5wcmljZTMpOwogICAgfWVsc2V7CiAgICAgIHRva2VuQW1vdW50ID0gZGl2KHZhbHVlKjEwKipkZWNpbWFscyxzdGFnZXNbX3N0YWdlXS5wcmljZTQpOwogICAgfQogICAgcmV0dXJuIHRva2VuQW1vdW50OwogIH0KIAogIC8qKgogICAqIEBkZXYgU2V0IHRoZSBjb250cmFjdCB0aGF0IGNhbiBjYWxsIHRoZSBpbnZlc3Qgb3RoZXIgY3J5cHRvIGZ1bmN0aW9uLgogICAqIEBwYXJhbSBfY3J5cHRvQWdlbnQgY3Jvd2RzYWxlIGNvbnRyYWN0IGFkZHJlc3MKICAgKi8KICBmdW5jdGlvbiBzZXRDcnlwdG9BZ2VudChhZGRyZXNzIF9jcnlwdG9BZ2VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKCFmaW5hbGl6ZWQpOwogICAgY3J5cHRvQWdlbnQgPSBfY3J5cHRvQWdlbnQ7CiAgfQp9'.
	

]
