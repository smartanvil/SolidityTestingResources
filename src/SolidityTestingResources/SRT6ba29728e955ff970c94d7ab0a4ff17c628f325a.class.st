Class {
	#name : #SRT6ba29728e955ff970c94d7ab0a4ff17c628f325a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT6ba29728e955ff970c94d7ab0a4ff17c628f325a >> base64 [
	^ 'LyoqCiAqIFRoZSBlZGdlbGVzcyBjYXNpbm8gY29udHJhY3QgdjIgaG9sZHMgdGhlIHBsYXllcnMncyBmdW5kcyBhbmQgcHJvdmlkZXMgc3RhdGUgY2hhbm5lbCBmdW5jdGlvbmFsaXR5LgogKiBUaGUgY2FzaW5vIGhhcyBhdCBubyB0aW1lIGNvbnRyb2wgb3ZlciB0aGUgcGxheWVycydzIGZ1bmRzLgogKiBTdGF0ZSBjaGFubmVscyBjYW4gYmUgdXBkYXRlZCBhbmQgY2xvc2VkIGZyb20gYm90aCBwYXJ0aWVzOiB0aGUgcGxheWVyIGFuZCB0aGUgY2FzaW5vLgogKiBhdXRob3I6IEp1bGlhIEFsdGVucmllZAogKiovCgpwcmFnbWEgc29saWRpdHkgXjAuNC4xOTsKCmNvbnRyYWN0IFNhZmVNYXRoIHsKCglmdW5jdGlvbiBzYWZlU3ViKHVpbnQgYSwgdWludCBiKSBwdXJlIGludGVybmFsIHJldHVybnModWludCkgewoJCWFzc2VydChiIDw9IGEpOwoJCXJldHVybiBhIC0gYjsKCX0KCQoJZnVuY3Rpb24gc2FmZVN1YihpbnQgYSwgaW50IGIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyhpbnQpIHsKCQlpZihiIDwgMCkgYXNzZXJ0KGEgLSBiID4gYSk7CgkJZWxzZSBhc3NlcnQoYSAtIGIgPD0gYSk7CgkJcmV0dXJuIGEgLSBiOwoJfQoKCWZ1bmN0aW9uIHNhZmVBZGQodWludCBhLCB1aW50IGIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyh1aW50KSB7CgkJdWludCBjID0gYSArIGI7CgkJYXNzZXJ0KGMgPj0gYSAmJiBjID49IGIpOwoJCXJldHVybiBjOwoJfQoKCWZ1bmN0aW9uIHNhZmVNdWwodWludCBhLCB1aW50IGIpIHB1cmUgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgdWludCBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQp9Cgpjb250cmFjdCBUb2tlbiB7CglmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBwdWJsaWMgcmV0dXJucyhib29sIHN1Y2Nlc3MpIHt9CgoJZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyByZWNlaXZlciwgdWludCBhbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wgc3VjY2Vzcykge30KCglmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBob2xkZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQpIHt9Cn0KCmNvbnRyYWN0IG93bmVkIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICBtb2RpZmllciBvbmx5T3duZXIgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKICBmdW5jdGlvbiBvd25lZCgpIHB1YmxpY3sKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9Cgp9CgovKiogb3duZXIgc2hvdWxkIGJlIGFibGUgdG8gY2xvc2UgdGhlIGNvbnRyYWN0IGlzIG5vYm9keSBoYXMgYmVlbiB1c2luZyBpdCBmb3IgYXQgbGVhc3QgMzAgZGF5cyAqLwpjb250cmFjdCBtb3J0YWwgaXMgb3duZWQgewoJLyoqIGNvbnRyYWN0IGNhbiBiZSBjbG9zZWQgYnkgdGhlIG93bmVyIGFueXRpbWUgYWZ0ZXIgdGhpcyB0aW1lc3RhbXAgaWYgbm9uLXplcm8gKi8KCXVpbnQgcHVibGljIGNsb3NlQXQ7CgkvKiogdGhlIGVkZ2VsZXNzIHRva2VuIGNvbnRyYWN0ICovCglUb2tlbiBlZGc7CgkKCWZ1bmN0aW9uIG1vcnRhbChhZGRyZXNzIHRva2VuQ29udHJhY3QpIGludGVybmFsewoJCWVkZyA9IFRva2VuKHRva2VuQ29udHJhY3QpOwoJfQoJLyoqCgkqIGxldHMgdGhlIG93bmVyIGNsb3NlIHRoZSBjb250cmFjdCBpZiB0aGVyZSBhcmUgbm8gcGxheWVyIGZ1bmRzIG9uIGl0IG9yIGlmIG5vYm9keSBoYXMgYmVlbiB1c2luZyBpdCBmb3IgYXQgbGVhc3QgMzAgZGF5cwoJKi8KICBmdW5jdGlvbiBjbG9zZUNvbnRyYWN0KHVpbnQgcGxheWVyQmFsYW5jZSkgaW50ZXJuYWx7CgkJaWYoY2xvc2VBdCA9PSAwKSBjbG9zZUF0ID0gbm93ICsgMzAgZGF5czsKCQlpZihjbG9zZUF0IDwgbm93IHx8IHBsYXllckJhbGFuY2UgPT0gMCl7CgkJCWVkZy50cmFuc2Zlcihvd25lciwgZWRnLmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSk7CgkJCXNlbGZkZXN0cnVjdChvd25lcik7CgkJfSAKICB9CgoJLyoqCgkqIGluIGNhc2UgY2xvc2UgaGFzIGJlZW4gY2FsbGVkIGFjY2lkZW50YWxseS4KCSoqLwoJZnVuY3Rpb24gb3BlbigpIG9ubHlPd25lciBwdWJsaWN7CgkJY2xvc2VBdCA9IDA7Cgl9CgoJLyoqCgkqIG1ha2Ugc3VyZSB0aGUgY29udHJhY3QgaXMgbm90IGluIHByb2Nlc3Mgb2YgYmVpbmcgY2xvc2VkLgoJKiovCgltb2RpZmllciBpc0FsaXZlIHsKCQlyZXF1aXJlKGNsb3NlQXQgPT0gMCk7CgkJXzsKCX0KCgkvKioKCSogZGVsYXlzIHRoZSB0aW1lIG9mIGNsb3NpbmcuCgkqKi8KCW1vZGlmaWVyIGtlZXBBbGl2ZSB7CgkJaWYoY2xvc2VBdCA+IDApIGNsb3NlQXQgPSBub3cgKyAzMCBkYXlzOwoJCV87Cgl9Cn0KCgpjb250cmFjdCByZXF1aXJpbmdBdXRob3JpemF0aW9uIGlzIG1vcnRhbCB7CgkvKiogaW5kaWNhdGVzIGlmIGFuIGFkZHJlc3MgaXMgYXV0aG9yaXplZCB0byBhY3QgaW4gdGhlIGNhc2lubydzIG5hbWUgICovCgltYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGF1dGhvcml6ZWQ7CgkvKiogdGVsbHMgaWYgYW4gYWRkcmVzcyBpcyBhbGxvd2VkIHRvIHJlY2VpdmUgZnVuZHMgZnJvbSB0aGUgYmFua3JvbGwgKiovCgltYXBwaW5nKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGFsbG93ZWRSZWNlaXZlcjsKCgltb2RpZmllciBvbmx5QXV0aG9yaXplZCB7CgkJcmVxdWlyZShhdXRob3JpemVkW21zZy5zZW5kZXJdKTsKCQlfOwoJfQoKCS8qKgoJICogQ29uc3RydWN0b3IuIEF1dGhvcml6ZSB0aGUgb3duZXIuCgkgKiAqLwoJZnVuY3Rpb24gcmVxdWlyaW5nQXV0aG9yaXphdGlvbigpIGludGVybmFsIHsKCQlhdXRob3JpemVkW21zZy5zZW5kZXJdID0gdHJ1ZTsKCQlhbGxvd2VkUmVjZWl2ZXJbbXNnLnNlbmRlcl0gPSB0cnVlOwoJfQoKCS8qKgoJICogYXV0aG9yaXplIGEgYWRkcmVzcyB0byBjYWxsIGdhbWUgZnVuY3Rpb25zIGFuZCBzZXQgY29uZmlncy4KCSAqIEBwYXJhbSBhZGRyIHRoZSBhZGRyZXNzIHRvIGJlIGF1dGhvcml6ZWQKCSAqKi8KCWZ1bmN0aW9uIGF1dGhvcml6ZShhZGRyZXNzIGFkZHIpIHB1YmxpYyBvbmx5T3duZXIgewoJCWF1dGhvcml6ZWRbYWRkcl0gPSB0cnVlOwoJfQoKCS8qKgoJICogZGVhdXRob3JpemUgYSBhZGRyZXNzIHRvIGNhbGwgZ2FtZSBmdW5jdGlvbnMgYW5kIHNldCBjb25maWdzLgoJICogQHBhcmFtIGFkZHIgdGhlIGFkZHJlc3MgdG8gYmUgZGVhdXRob3JpemVkCgkgKiovCglmdW5jdGlvbiBkZWF1dGhvcml6ZShhZGRyZXNzIGFkZHIpIHB1YmxpYyBvbmx5T3duZXIgewoJCWF1dGhvcml6ZWRbYWRkcl0gPSBmYWxzZTsKCX0KCgkvKioKCSAqIGFsbG93IGF1dGhvcml6ZWQgd2FsbGV0cyB0byB3aXRoZHJhdyBmdW5kcyBmcm9tIHRoZSBib25rcm9sbCB0byB0aGlzIGFkZHJlc3MKCSAqIEBwYXJhbSByZWNlaXZlciB0aGUgcmVjZWl2ZXIncyBhZGRyZXNzCgkgKiAqLwoJZnVuY3Rpb24gYWxsb3dSZWNlaXZlcihhZGRyZXNzIHJlY2VpdmVyKSBwdWJsaWMgb25seU93bmVyIHsKCQlhbGxvd2VkUmVjZWl2ZXJbcmVjZWl2ZXJdID0gdHJ1ZTsKCX0KCgkvKioKCSAqIGRpc2FsbG93IGF1dGhvcml6ZWQgd2FsbGV0cyB0byB3aXRoZHJhdyBmdW5kcyBmcm9tIHRoZSBib25rcm9sbCB0byB0aGlzIGFkZHJlc3MKCSAqIEBwYXJhbSByZWNlaXZlciB0aGUgcmVjZWl2ZXIncyBhZGRyZXNzCgkgKiAqLwoJZnVuY3Rpb24gZGlzYWxsb3dSZWNlaXZlcihhZGRyZXNzIHJlY2VpdmVyKSBwdWJsaWMgb25seU93bmVyIHsKCQlhbGxvd2VkUmVjZWl2ZXJbcmVjZWl2ZXJdID0gZmFsc2U7Cgl9CgoJLyoqCgkgKiBjaGFuZ2VzIHRoZSBvd25lciBvZiB0aGUgY29udHJhY3QuIHJldm9rZXMgYXV0aG9yaXphdGlvbiBvZiB0aGUgb2xkIG93bmVyIGFuZCBhdXRob3JpemVzIHRoZSBuZXcgb25lLgoJICogQHBhcmFtIG5ld093bmVyIHRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgb3duZXIKCSAqICovCglmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKCQlkZWF1dGhvcml6ZShvd25lcik7CgkJYXV0aG9yaXplKG5ld093bmVyKTsKCQlkaXNhbGxvd1JlY2VpdmVyKG93bmVyKTsKCQlhbGxvd1JlY2VpdmVyKG5ld093bmVyKTsKCQlvd25lciA9IG5ld093bmVyOwoJfQp9CgoKY29udHJhY3QgY2hhcmdpbmdHYXMgaXMgcmVxdWlyaW5nQXV0aG9yaXphdGlvbiwgU2FmZU1hdGggewoJLyoqIDEgRURHIGhhcyA1IGRlY2ltYWxzICoqLwoJdWludCBwdWJsaWMgY29uc3RhbnQgb25lRURHID0gMTAwMDAwOwoJLyoqIHRoZSBwcmljZSBwZXIga2dhcyBhbmQgR1dlaSBpbiB0b2tlbnMgKHdpdGggZGVjaW1hbHMpICovCgl1aW50IHB1YmxpYyBnYXNQcmljZTsKCS8qKiB0aGUgYW1vdW50IG9mIGdhcyB1c2VkIHBlciB0cmFuc2FjdGlvbiBpbiBrR2FzICovCgltYXBwaW5nKGJ5dGVzNCA9PiB1aW50KSBwdWJsaWMgZ2FzUGVyVHg7CgkvKiogdGhlIG51bWJlciBvZiB0b2tlbnMgKDUgZGVjaW1hbHMpIHBheWVkIGJ5IHRoZSB1c2VycyB0byBjb3ZlciB0aGUgZ2FzIGNvc3QgKi8KCXVpbnQgcHVibGljIGdhc1BheWJhY2s7CgkKCWZ1bmN0aW9uIGNoYXJnaW5nR2FzKHVpbnQga0dhc1ByaWNlKSBpbnRlcm5hbHsKCQkvL2RlcG9zaXQsIHdpdGhkcmF3Rm9yLCB1cGRhdGVDaGFubmVsLCB1cGRhdGVCYXRjaCwgdHJhbnNmZXJUb05ld0NvbnRyYWN0CgkgICAgYnl0ZXM0WzVdIG1lbW9yeSBzaWduYXR1cmVzID0gW2J5dGVzNCgweDNlZGQxMTI4KSwweDk2MDc2MTBhLCAweGRlNDhmZjUyLCAweGM5N2I2ZDFmLCAweDZiZjA2ZmRlXTsKCSAgICAvL2Ftb3VudCBvZiBnYXMgY29uc3VtZWQgYnkgdGhlIGFib3ZlIG1ldGhvZHMgaW4gR1dlaQoJICAgIHVpbnRbNV0gbWVtb3J5IGdhc1VzYWdlID0gW3VpbnQoMTQ2KSwgMTAwLCA2NSwgNTAsIDg1XTsKCSAgICBzZXRHYXNVc2FnZShzaWduYXR1cmVzLCBnYXNVc2FnZSk7CgkgICAgc2V0R2FzUHJpY2Uoa0dhc1ByaWNlKTsKCX0KCS8qKgoJICogc2V0cyB0aGUgYW1vdW50IG9mIGdhcyBjb25zdW1lZCBieSBtZXRob2RzIHdpdGggdGhlIGdpdmVuIHNpZ2FudHVyZXMuCgkgKiBvbmx5IGNhbGxlZCBmcm9tIHRoZSBlZGdlbGVzcyBjYXNpbm8gY29uc3RydWN0b3IuCgkgKiBAcGFyYW0gc2lnbmF0dXJlcyBhbiBhcnJheSBvZiBtZXRob2Qtc2lnbmF0dXJlcwoJICogICAgICAgIGdhc05lZWRlZCAgdGhlIGFtb3VudCBvZiBnYXMgY29uc3VtZWQgYnkgdGhlc2UgbWV0aG9kcwoJICogKi8KCWZ1bmN0aW9uIHNldEdhc1VzYWdlKGJ5dGVzNFs1XSBzaWduYXR1cmVzLCB1aW50WzVdIGdhc05lZWRlZCkgcHVibGljIG9ubHlPd25lciB7CgkJcmVxdWlyZShzaWduYXR1cmVzLmxlbmd0aCA9PSBnYXNOZWVkZWQubGVuZ3RoKTsKCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgc2lnbmF0dXJlcy5sZW5ndGg7IGkrKykKCQkJZ2FzUGVyVHhbc2lnbmF0dXJlc1tpXV0gPSBnYXNOZWVkZWRbaV07Cgl9CgoJLyoqCgkgKiB1cGRhdGVzIHRoZSBwcmljZSBwZXIgMTAwMCBnYXMgaW4gRURHLgoJICogQHBhcmFtIHByaWNlIHRoZSBuZXcgZ2FzIHByaWNlICh3aXRoIGRlY2ltYWxzLCBtYXggMC4xIEVERykKCSAqKi8KCWZ1bmN0aW9uIHNldEdhc1ByaWNlKHVpbnQgcHJpY2UpIHB1YmxpYyBvbmx5QXV0aG9yaXplZCB7CgkJcmVxdWlyZShwcmljZSA8IG9uZUVERy8xMCk7CgkJZ2FzUHJpY2UgPSBwcmljZTsKCX0KCgkvKioKCSAqIHJldHVybnMgdGhlIGdhcyBjb3N0IG9mIHRoZSBjYWxsZWQgZnVuY3Rpb24uCgkgKiAqLwoJZnVuY3Rpb24gZ2V0R2FzQ29zdCgpIGludGVybmFsIHZpZXcgcmV0dXJucyh1aW50KSB7CgkJcmV0dXJuIHNhZmVNdWwoc2FmZU11bChnYXNQZXJUeFttc2cuc2lnXSwgZ2FzUHJpY2UpLCB0eC5nYXNwcmljZSkgLyAxMDAwMDAwMDAwOwoJfQoKfQoKCmNvbnRyYWN0IENhc2lub0JhbmsgaXMgY2hhcmdpbmdHYXMgewoJLyoqIHRoZSB0b3RhbCBiYWxhbmNlIG9mIGFsbCBwbGF5ZXJzIHdpdGggdmlydHVhbCBkZWNpbWFscyAqKi8KCXVpbnQgcHVibGljIHBsYXllckJhbGFuY2U7CgkvKiogdGhlIGJhbGFuY2UgcGVyIHBsYXllciBpbiBlZGdlbGVzcyB0b2tlbnMgd2l0aCB2aXJ0dWFsIGRlY2ltYWxzICovCgltYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGJhbGFuY2VPZjsKCS8qKiBpbiBjYXNlIHRoZSB1c2VyIHdhbnRzL25lZWRzIHRvIGNhbGwgdGhlIHdpdGhkcmF3IGZ1bmN0aW9uIGZyb20gaGlzIG93biB3YWxsZXQsIGhlIGZpcnN0IG5lZWRzIHRvIHJlcXVlc3QgYSB3aXRoZHJhd2FsICovCgltYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgcHVibGljIHdpdGhkcmF3QWZ0ZXI7CgkvKiogYSBudW1iZXIgdG8gY291bnQgd2l0aGRyYXdhbCBzaWduYXR1cmVzIHRvIGVuc3VyZSBlYWNoIHNpZ25hdHVyZSBpcyBkaWZmZXJlbnQgZXZlbiBpZiB3aXRoZHJhd2luZyB0aGUgc2FtZSBhbW91bnQgdG8gdGhlIHNhbWUgYWRkcmVzcyAqLwoJbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyB3aXRoZHJhd0NvdW50OwoJLyoqIHRoZSBtYXhpbXVtIGFtb3VudCBvZiB0b2tlbnMgdGhlIHVzZXIgaXMgYWxsb3dlZCB0byBkZXBvc2l0ICh3aXRoIGRlY2ltYWxzKSAqLwoJdWludCBwdWJsaWMgbWF4RGVwb3NpdDsKCS8qKiB0aGUgbWF4aW11bSB3aXRoZHJhd2FsIG9mIHRva2VucyB0aGUgdXNlciBpcyBhbGxvd2VkIHRvIHdpdGhkcmF3IG9uIG9uZSBkYXkgKG9ubHkgZW5mb3JjZWQgd2hlbiB0aGUgdHggaXMgbm90IHNlbnQgZnJvbSBhbiBhdXRob3JpemVkIHdhbGxldCkgKiovCgl1aW50IHB1YmxpYyBtYXhXaXRoZHJhd2FsOwoJLyoqIHdhaXRpbmcgdGltZSBmb3Igd2l0aGRyYXdhbCBpZiBub3QgcmVxdWVzdGVkIHZpYSB0aGUgc2VydmVyICoqLwoJdWludCBwdWJsaWMgd2FpdGluZ1RpbWU7CgkvKiogdGhlIGFkZHJlc3Mgb2YgdGhlIHByZWRlY2Vzc29yICoqLwoJYWRkcmVzcyBwdWJsaWMgcHJlZGVjZXNzb3I7CgoJLyoqIGluZm9ybXMgbGlzdGVuZXJzIGhvdyBtYW55IHRva2VucyB3ZXJlIGRlcG9zaXRlZCBmb3IgYSBwbGF5ZXIgKi8KCWV2ZW50IERlcG9zaXQoYWRkcmVzcyBfcGxheWVyLCB1aW50IF9udW1Ub2tlbnMsIHVpbnQgX2dhc0Nvc3QpOwoJLyoqIGluZm9ybXMgbGlzdGVuZXJzIGhvdyBtYW55IHRva2VucyB3ZXJlIHdpdGhkcmF3biBmcm9tIHRoZSBwbGF5ZXIgdG8gdGhlIHJlY2VpdmVyIGFkZHJlc3MgKi8KCWV2ZW50IFdpdGhkcmF3YWwoYWRkcmVzcyBfcGxheWVyLCBhZGRyZXNzIF9yZWNlaXZlciwgdWludCBfbnVtVG9rZW5zLCB1aW50IF9nYXNDb3N0KTsKCQoJCgkvKioKCSAqIENvbnN0cnVjdG9yLgoJICogQHBhcmFtIGRlcG9zaXRMaW1pdCAgICB0aGUgbWF4aW11bSBkZXBvc2l0IGFsbG93ZWQKCSAqCQkgIHByZWRlY2Vzc29yQWRkciB0aGUgYWRkcmVzcyBvZiB0aGUgcHJlZGVjZXNzaW5nIGNvbnRyYWN0CgkgKiAqLwoJZnVuY3Rpb24gQ2FzaW5vQmFuayh1aW50IGRlcG9zaXRMaW1pdCwgYWRkcmVzcyBwcmVkZWNlc3NvckFkZHIpIGludGVybmFsIHsKCQltYXhEZXBvc2l0ID0gZGVwb3NpdExpbWl0ICogb25lRURHOwoJCW1heFdpdGhkcmF3YWwgPSBtYXhEZXBvc2l0OwoJCXdhaXRpbmdUaW1lID0gMjQgaG91cnM7CgkJcHJlZGVjZXNzb3IgPSBwcmVkZWNlc3NvckFkZHI7Cgl9CgoJLyoqCgkgKiBhY2NlcHRzIGRlcG9zaXRzIGZvciBhbiBhcmJpdHJhcnkgYWRkcmVzcy4KCSAqIHJldHJpZXZlcyB0b2tlbnMgZnJvbSB0aGUgbWVzc2FnZSBzZW5kZXIgYW5kIGFkZHMgdGhlbSB0byB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCgkgKiBlZGdlbGVzcyB0b2tlbnMgZG8gbm90IGhhdmUgYW55IGRlY2ltYWxzLCBidXQgYXJlIHJlcHJlc2VudGVkIG9uIHRoaXMgY29udHJhY3Qgd2l0aCBkZWNpbWFscy4KCSAqIEBwYXJhbSByZWNlaXZlciAgYWRkcmVzcyBvZiB0aGUgcmVjZWl2ZXIKCSAqICAgICAgICBudW1Ub2tlbnMgbnVtYmVyIG9mIHRva2VucyB0byBkZXBvc2l0ICgwIGRlY2ltYWxzKQoJICoJCQkJIGNoYXJnZUdhcyBpbmRpY2F0ZXMgaWYgdGhlIGdhcyBjb3N0IGlzIHN1YnRyYWN0ZWQgZnJvbSB0aGUgdXNlcidzIGVkZ2VsZXNzIHRva2VuIGJhbGFuY2UKCSAqKi8KCWZ1bmN0aW9uIGRlcG9zaXQoYWRkcmVzcyByZWNlaXZlciwgdWludCBudW1Ub2tlbnMsIGJvb2wgY2hhcmdlR2FzKSBwdWJsaWMgaXNBbGl2ZSB7CgkJcmVxdWlyZShudW1Ub2tlbnMgPiAwKTsKCQl1aW50IHZhbHVlID0gc2FmZU11bChudW1Ub2tlbnMsIG9uZUVERyk7CgkJdWludCBnYXNDb3N0OwoJCWlmIChjaGFyZ2VHYXMpIHsKCQkJZ2FzQ29zdCA9IGdldEdhc0Nvc3QoKTsKCQkJdmFsdWUgPSBzYWZlU3ViKHZhbHVlLCBnYXNDb3N0KTsKCQkJZ2FzUGF5YmFjayA9IHNhZmVBZGQoZ2FzUGF5YmFjaywgZ2FzQ29zdCk7CgkJfQoJCXVpbnQgbmV3QmFsYW5jZSA9IHNhZmVBZGQoYmFsYW5jZU9mW3JlY2VpdmVyXSwgdmFsdWUpOwoJCXJlcXVpcmUobmV3QmFsYW5jZSA8PSBtYXhEZXBvc2l0KTsKCQlhc3NlcnQoZWRnLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBhZGRyZXNzKHRoaXMpLCBudW1Ub2tlbnMpKTsKCQliYWxhbmNlT2ZbcmVjZWl2ZXJdID0gbmV3QmFsYW5jZTsKCQlwbGF5ZXJCYWxhbmNlID0gc2FmZUFkZChwbGF5ZXJCYWxhbmNlLCB2YWx1ZSk7CgkJRGVwb3NpdChyZWNlaXZlciwgbnVtVG9rZW5zLCBnYXNDb3N0KTsKCX0KCgkvKioKCSAqIElmIHRoZSB1c2VyIHdhbnRzL25lZWRzIHRvIHdpdGhkcmF3IGhpcyBmdW5kcyBoaW1zZWxmLCBoZSBuZWVkcyB0byByZXF1ZXN0IHRoZSB3aXRoZHJhd2FsIGZpcnN0LgoJICogVGhpcyBtZXRob2Qgc2V0cyB0aGUgZWFybGllc3QgcG9zc2libGUgd2l0aGRyYXdhbCBkYXRlIHRvICd3YWl0aW5nVGltZSBmcm9tIG5vdyAoZGVmYXVsdCA5MG0sIGJ1dCB1cCB0byAyNGgpLgoJICogUmVhc29uOiBUaGUgdXNlciBzaG91bGQgbm90IGJlIGFibGUgdG8gd2l0aGRyYXcgaGlzIGZ1bmRzLCB3aGlsZSB0aGUgdGhlIGxhc3QgZ2FtZSBtZXRob2RzIGhhdmUgbm90IHlldCBiZWVuIG1pbmVkLgoJICoqLwoJZnVuY3Rpb24gcmVxdWVzdFdpdGhkcmF3YWwoKSBwdWJsaWMgewoJCXdpdGhkcmF3QWZ0ZXJbbXNnLnNlbmRlcl0gPSBub3cgKyB3YWl0aW5nVGltZTsKCX0KCgkvKioKCSAqIEluIGNhc2UgdGhlIHVzZXIgcmVxdWVzdGVkIGEgd2l0aGRyYXdhbCBhbmQgY2hhbmdlcyBoaXMgbWluZC4KCSAqIE5lY2Vzc2FyeSB0byBiZSBhYmxlIHRvIGNvbnRpbnVlIHBsYXlpbmcuCgkgKiovCglmdW5jdGlvbiBjYW5jZWxXaXRoZHJhd2FsUmVxdWVzdCgpIHB1YmxpYyB7CgkJd2l0aGRyYXdBZnRlclttc2cuc2VuZGVyXSA9IDA7Cgl9CgoJLyoqCgkgKiB3aXRoZHJhd3MgYW4gYW1vdW50IGZyb20gdGhlIHVzZXIgYmFsYW5jZSBpZiB0aGUgd2FpdGluZyB0aW1lIHBhc3NlZCBzaW5jZSB0aGUgcmVxdWVzdC4KCSAqIEBwYXJhbSBhbW91bnQgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gd2l0aGRyYXcKCSAqKi8KCWZ1bmN0aW9uIHdpdGhkcmF3KHVpbnQgYW1vdW50KSBwdWJsaWMga2VlcEFsaXZlIHsKCQlyZXF1aXJlKGFtb3VudCA8PSBtYXhXaXRoZHJhd2FsKTsKCQlyZXF1aXJlKHdpdGhkcmF3QWZ0ZXJbbXNnLnNlbmRlcl0gPiAwICYmIG5vdyA+IHdpdGhkcmF3QWZ0ZXJbbXNnLnNlbmRlcl0pOwoJCXdpdGhkcmF3QWZ0ZXJbbXNnLnNlbmRlcl0gPSAwOwoJCXVpbnQgdmFsdWUgPSBzYWZlTXVsKGFtb3VudCwgb25lRURHKTsKCQliYWxhbmNlT2ZbbXNnLnNlbmRlcl0gPSBzYWZlU3ViKGJhbGFuY2VPZlttc2cuc2VuZGVyXSwgdmFsdWUpOwoJCXBsYXllckJhbGFuY2UgPSBzYWZlU3ViKHBsYXllckJhbGFuY2UsIHZhbHVlKTsKCQlhc3NlcnQoZWRnLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudCkpOwoJCVdpdGhkcmF3YWwobXNnLnNlbmRlciwgbXNnLnNlbmRlciwgYW1vdW50LCAwKTsKCX0KCgkvKioKCSAqIGxldHMgdGhlIG93bmVyIHdpdGhkcmF3IGZyb20gdGhlIGJhbmtyb2xsCgkgKiBAcGFyYW0gcmVjZWl2ZXIgdGhlIHJlY2VpdmVyJ3MgYWRkcmVzcwoJICoJCQkJbnVtVG9rZW5zIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIHdpdGhkcmF3ICgwIGRlY2ltYWxzKQoJICoqLwoJZnVuY3Rpb24gd2l0aGRyYXdCYW5rcm9sbChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IG51bVRva2VucykgcHVibGljIG9ubHlBdXRob3JpemVkIHsKCQlyZXF1aXJlKG51bVRva2VucyA8PSBiYW5rcm9sbCgpKTsKCQlyZXF1aXJlKGFsbG93ZWRSZWNlaXZlcltyZWNlaXZlcl0pOwoJCWFzc2VydChlZGcudHJhbnNmZXIocmVjZWl2ZXIsIG51bVRva2VucykpOwoJfQoKCS8qKgoJICogd2l0aGRyYXcgdGhlIGdhcyBwYXliYWNrIHRvIHRoZSBvd25lcgoJICoqLwoJZnVuY3Rpb24gd2l0aGRyYXdHYXNQYXliYWNrKCkgcHVibGljIG9ubHlBdXRob3JpemVkIHsKCQl1aW50IHBheWJhY2sgPSBnYXNQYXliYWNrIC8gb25lRURHOwoJCWFzc2VydChwYXliYWNrID4gMCk7CgkJZ2FzUGF5YmFjayA9IHNhZmVTdWIoZ2FzUGF5YmFjaywgcGF5YmFjayAqIG9uZUVERyk7CgkJYXNzZXJ0KGVkZy50cmFuc2Zlcihvd25lciwgcGF5YmFjaykpOwoJfQoKCS8qKgoJICogcmV0dXJucyB0aGUgY3VycmVudCBiYW5rcm9sbCBpbiB0b2tlbnMgd2l0aCAwIGRlY2ltYWxzCgkgKiovCglmdW5jdGlvbiBiYW5rcm9sbCgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpIHsKCQlyZXR1cm4gc2FmZVN1YihlZGcuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpLCBzYWZlQWRkKHBsYXllckJhbGFuY2UsIGdhc1BheWJhY2spIC8gb25lRURHKTsKCX0KCgoJLyoqCgkgKiB1cGRhdGVzIHRoZSBtYXhpbXVtIGRlcG9zaXQuCgkgKiBAcGFyYW0gbmV3TWF4IHRoZSBuZXcgbWF4aW11bSBkZXBvc2l0ICgwIGRlY2ltYWxzKQoJICoqLwoJZnVuY3Rpb24gc2V0TWF4RGVwb3NpdCh1aW50IG5ld01heCkgcHVibGljIG9ubHlBdXRob3JpemVkIHsKCQltYXhEZXBvc2l0ID0gbmV3TWF4ICogb25lRURHOwoJfQoJCgkvKioKCSAqIHVwZGF0ZXMgdGhlIG1heGltdW0gd2l0aGRyYXdhbC4KCSAqIEBwYXJhbSBuZXdNYXggdGhlIG5ldyBtYXhpbXVtIHdpdGhkcmF3YWwgKDAgZGVjaW1hbHMpCgkgKiovCglmdW5jdGlvbiBzZXRNYXhXaXRoZHJhd2FsKHVpbnQgbmV3TWF4KSBwdWJsaWMgb25seUF1dGhvcml6ZWQgewoJCW1heFdpdGhkcmF3YWwgPSBuZXdNYXggKiBvbmVFREc7Cgl9CgoJLyoqCgkgKiBzZXRzIHRoZSB0aW1lIHRoZSBwbGF5ZXIgaGFzIHRvIHdhaXQgZm9yIGhpcyBmdW5kcyB0byBiZSB1bmxvY2tlZCBiZWZvcmUgd2l0aGRyYXdhbCAoaWYgbm90IHdpdGhkcmF3aW5nIHdpdGggaGVscCBvZiB0aGUgY2FzaW5vIHNlcnZlcikuCgkgKiB0aGUgdGltZSBtYXkgbm90IGJlIGxvbmdlciB0aGFuIDI0IGhvdXJzLgoJICogQHBhcmFtIG5ld1dhaXRpbmdUaW1lIHRoZSBuZXcgd2FpdGluZyB0aW1lIGluIHNlY29uZHMKCSAqICovCglmdW5jdGlvbiBzZXRXYWl0aW5nVGltZSh1aW50IG5ld1dhaXRpbmdUaW1lKSBwdWJsaWMgb25seUF1dGhvcml6ZWQgIHsKCQlyZXF1aXJlKG5ld1dhaXRpbmdUaW1lIDw9IDI0IGhvdXJzKTsKCQl3YWl0aW5nVGltZSA9IG5ld1dhaXRpbmdUaW1lOwoJfQoKCS8qKgoJICogdHJhbnNmZXJzIGFuIGFtb3VudCBmcm9tIHRoZSBjb250cmFjdCBiYWxhbmNlIHRvIHRoZSBvd25lcidzIHdhbGxldC4KCSAqIEBwYXJhbSByZWNlaXZlciB0aGUgcmVjZWl2ZXIgYWRkcmVzcwoJICoJCQkJIGFtb3VudCAgIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIHdpdGhkcmF3ICgwIGRlY2ltYWxzKQoJICoJCQkJIHYscixzIAkJdGhlIHNpZ25hdHVyZSBvZiB0aGUgcGxheWVyCgkgKiovCglmdW5jdGlvbiB3aXRoZHJhd0ZvcihhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCwgdWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpIHB1YmxpYyBvbmx5QXV0aG9yaXplZCBrZWVwQWxpdmUgewoJCWFkZHJlc3MgcGxheWVyID0gZWNyZWNvdmVyKGtlY2NhazI1NihyZWNlaXZlciwgYW1vdW50LCB3aXRoZHJhd0NvdW50W3JlY2VpdmVyXSksIHYsIHIsIHMpOwoJCXdpdGhkcmF3Q291bnRbcmVjZWl2ZXJdKys7CgkJdWludCBnYXNDb3N0ID0gZ2V0R2FzQ29zdCgpOwoJCXVpbnQgdmFsdWUgPSBzYWZlQWRkKHNhZmVNdWwoYW1vdW50LCBvbmVFREcpLCBnYXNDb3N0KTsKCQlnYXNQYXliYWNrID0gc2FmZUFkZChnYXNQYXliYWNrLCBnYXNDb3N0KTsKCQliYWxhbmNlT2ZbcGxheWVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mW3BsYXllcl0sIHZhbHVlKTsKCQlwbGF5ZXJCYWxhbmNlID0gc2FmZVN1YihwbGF5ZXJCYWxhbmNlLCB2YWx1ZSk7CgkJYXNzZXJ0KGVkZy50cmFuc2ZlcihyZWNlaXZlciwgYW1vdW50KSk7CgkJV2l0aGRyYXdhbChwbGF5ZXIsIHJlY2VpdmVyLCBhbW91bnQsIGdhc0Nvc3QpOwoJfQoJCgkvKioKCSAqIHRyYW5zZmVycyB0aGUgcGxheWVyJ3MgdG9rZW5zIGRpcmVjdGx5IHRvIHRoZSBuZXcgY2FzaW5vIGNvbnRyYWN0IGFmdGVyIGFuIHVwZGF0ZS4KCSAqIEBwYXJhbSBuZXdDYXNpbm8gdGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBjYXNpbm8gY29udHJhY3QKCSAqCQkgIHYsIHIsIHMgICB0aGUgc2lnbmF0dXJlIG9mIHRoZSBwbGF5ZXIKCSAqCQkgIGNoYXJnZUdhcyBpbmRpY2F0ZXMgaWYgdGhlIGdhcyBjb3N0IGlzIHBheWVkIGJ5IHRoZSBwbGF5ZXIuCgkgKiAqLwoJZnVuY3Rpb24gdHJhbnNmZXJUb05ld0NvbnRyYWN0KGFkZHJlc3MgbmV3Q2FzaW5vLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcywgYm9vbCBjaGFyZ2VHYXMpIHB1YmxpYyBvbmx5QXV0aG9yaXplZCBrZWVwQWxpdmUgewoJCWFkZHJlc3MgcGxheWVyID0gZWNyZWNvdmVyKGtlY2NhazI1NihhZGRyZXNzKHRoaXMpLCBuZXdDYXNpbm8pLCB2LCByLCBzKTsKCQl1aW50IGdhc0Nvc3QgPSAwOwoJCWlmKGNoYXJnZUdhcykgZ2FzQ29zdCA9IGdldEdhc0Nvc3QoKTsKCQl1aW50IHZhbHVlID0gc2FmZVN1YihiYWxhbmNlT2ZbcGxheWVyXSwgZ2FzQ29zdCk7CgkJcmVxdWlyZSh2YWx1ZSA+IG9uZUVERyk7CgkJLy9mcmFjdGlvbnMgb2Ygb25lIEVERyBjYW5ub3QgYmUgd2l0aGRyYXduIAoJCXZhbHVlIC89IG9uZUVERzsKCQlwbGF5ZXJCYWxhbmNlID0gc2FmZVN1YihwbGF5ZXJCYWxhbmNlLCBiYWxhbmNlT2ZbcGxheWVyXSk7CgkJYmFsYW5jZU9mW3BsYXllcl0gPSAwOwoJCWFzc2VydChlZGcudHJhbnNmZXIobmV3Q2FzaW5vLCB2YWx1ZSkpOwoJCVdpdGhkcmF3YWwocGxheWVyLCBuZXdDYXNpbm8sIHZhbHVlLCBnYXNDb3N0KTsKCQlDYXNpbm9CYW5rIGNiID0gQ2FzaW5vQmFuayhuZXdDYXNpbm8pOwoJCWFzc2VydChjYi5jcmVkaXQocGxheWVyLCB2YWx1ZSkpOwoJfQoJCgkvKioKCSAqIHJlY2VpdmUgYSBwbGF5ZXIgYmFsYW5jZSBmcm9tIHRoZSBwcmVkZWNlc3NvciBjb250cmFjdC4KCSAqIEBwYXJhbSBwbGF5ZXIgdGhlIGFkZHJlc3Mgb2YgdGhlIHBsYXllciB0byBjcmVkaXQgdGhlIHZhbHVlIGZvcgoJICoJCQkJdmFsdWUgIHRoZSBudW1iZXIgb2YgdG9rZW5zIHRvIGNyZWRpdCAoMCBkZWNpbWFscykKCSAqICovCglmdW5jdGlvbiBjcmVkaXQoYWRkcmVzcyBwbGF5ZXIsIHVpbnQgdmFsdWUpIHB1YmxpYyByZXR1cm5zKGJvb2wpIHsKCQlyZXF1aXJlKG1zZy5zZW5kZXIgPT0gcHJlZGVjZXNzb3IpOwoJCXVpbnQgdmFsdWVXaXRoRGVjaW1hbHMgPSBzYWZlTXVsKHZhbHVlLCBvbmVFREcpOwoJCWJhbGFuY2VPZltwbGF5ZXJdID0gc2FmZUFkZChiYWxhbmNlT2ZbcGxheWVyXSwgdmFsdWVXaXRoRGVjaW1hbHMpOwoJCXBsYXllckJhbGFuY2UgPSBzYWZlQWRkKHBsYXllckJhbGFuY2UsIHZhbHVlV2l0aERlY2ltYWxzKTsKCQlEZXBvc2l0KHBsYXllciwgdmFsdWUsIDApOwoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogbGV0cyB0aGUgb3duZXIgY2xvc2UgdGhlIGNvbnRyYWN0IGlmIHRoZXJlIGFyZSBubyBwbGF5ZXIgZnVuZHMgb24gaXQgb3IgaWYgbm9ib2R5IGhhcyBiZWVuIHVzaW5nIGl0IGZvciBhdCBsZWFzdCAzMCBkYXlzCgkgKiAqLwoJZnVuY3Rpb24gY2xvc2UoKSBwdWJsaWMgb25seU93bmVyIHsKCQljbG9zZUNvbnRyYWN0KHBsYXllckJhbGFuY2UpOwoJfQp9CgoKY29udHJhY3QgRWRnZWxlc3NDYXNpbm8gaXMgQ2FzaW5vQmFua3sKCS8qKiB0aGUgbW9zdCByZWNlbnQga25vd24gc3RhdGUgb2YgYSBzdGF0ZSBjaGFubmVsICovCgltYXBwaW5nKGFkZHJlc3MgPT4gU3RhdGUpIHB1YmxpYyBsYXN0U3RhdGU7CgkvKiogZmlyZWQgd2hlbiB0aGUgc3RhdGUgaXMgdXBkYXRlZCAqLwoJZXZlbnQgU3RhdGVVcGRhdGUoYWRkcmVzcyBwbGF5ZXIsIHVpbnQxMjggY291bnQsIGludDEyOCB3aW5CYWxhbmNlLCBpbnQgZGlmZmVyZW5jZSwgdWludCBnYXNDb3N0KTsKICAvKiogZmlyZWQgaWYgb25lIG9mIHRoZSBwYXJ0aWVzIGNob29zZXMgdG8gbG9nIHRoZSBzZWVkcyBhbmQgcmVzdWx0cyAqLwogIGV2ZW50IEdhbWVEYXRhKGFkZHJlc3MgcGxheWVyLCBieXRlczMyW10gc2VydmVyU2VlZHMsIGJ5dGVzMzJbXSBjbGllbnRTZWVkcywgaW50W10gcmVzdWx0cywgdWludCBnYXNDb3N0KTsKICAKCXN0cnVjdCBTdGF0ZXsKCQl1aW50MTI4IGNvdW50OwoJCWludDEyOCB3aW5CYWxhbmNlOwoJfQoKCiAgLyoqCiAgKiBjcmVhdGVzIGEgbmV3IGVkZ2VsZXNzIGNhc2lubyBjb250cmFjdC4KICAqIEBwYXJhbSBwcmVkZWNlc3NvckFkZHJlc3MgdGhlIGFkZHJlc3Mgb2YgdGhlIHByZWRlY2Vzc2luZyBjb250cmFjdAoJKgkJCQkgdG9rZW5Db250cmFjdCAgICAgIHRoZSBhZGRyZXNzIG9mIHRoZSBFZGdlbGVzcyB0b2tlbiBjb250cmFjdAoJKiAJCQkgZGVwb3NpdExpbWl0ICAgICAgIHRoZSBtYXhpbXVtIGRlcG9zaXQgYWxsb3dlZAoJKiAJCQkga0dhc1ByaWNlCQkJCSAgdGhlIHByaWNlIHBlciBrR2FzIGluIFdFSQogICoqLwogIGZ1bmN0aW9uIEVkZ2VsZXNzQ2FzaW5vKGFkZHJlc3MgcHJlZGVjZXNzb3JBZGRyZXNzLCBhZGRyZXNzIHRva2VuQ29udHJhY3QsIHVpbnQgZGVwb3NpdExpbWl0LCB1aW50IGtHYXNQcmljZSkgQ2FzaW5vQmFuayhkZXBvc2l0TGltaXQsIHByZWRlY2Vzc29yQWRkcmVzcykgbW9ydGFsKHRva2VuQ29udHJhY3QpIGNoYXJnaW5nR2FzKGtHYXNQcmljZSkgcHVibGljewoKICB9CiAgCiAgLyoqCiAgICogdXBkYXRlcyBzZXZlcmFsIHN0YXRlIGNoYW5uZWxzIGF0IG9uY2UuIGNhbiBiZSBjYWxsZWQgYnkgYXV0aG9yaXplZCB3YWxsZXRzIG9ubHkuCiAgICogMS4gZGV0ZXJtaW5lcyB0aGUgcGxheWVyIGFkZHJlc3MgZnJvbSB0aGUgc2lnbmF0dXJlLgogICAqIDIuIHZlcmlmaWVzIGlmIHRoZSBzaWduZWQgZ2FtZS1jb3VudCBpcyBoaWdoZXIgdGhhbiB0aGUgbGFzdCBrbm93biBnYW1lLWNvdW50IG9mIHRoaXMgY2hhbm5lbC4KICAgKiAzLiB1cGRhdGVzIHRoZSBiYWxhbmNlcyBhY2NvcmRpbmdseS4gVGhpcyBtZWFuczogSXQgY2hlY2tzIHRoZSBhbHJlYWR5IHBlcmZvcm1lZCB1cGRhdGVzIGZvciB0aGlzIGNoYW5uZWwgYW5kIGNvbXB1dGVzCiAgICogICAgdGhlIG5ldyBiYWxhbmNlIGRpZmZlcmVuY2UgdG8gYWRkIG9yIHN1YnRyYWN0IGZyb20gdGhlIHBsYXllcuKAmHMgYmFsYW5jZS4KICAgKiBAcGFyYW0gd2luQmFsYW5jZXMgYXJyYXkgb2YgdGhlIGN1cnJlbnQgd2lucyBvciBsb3NzZXMKICAgKgkJCQlnYW1lQ291bnRzICBhcnJheSBvZiB0aGUgbnVtYmVycyBvZiBzaWduZWQgZ2FtZSBtb3ZlcwogICAqCQkJCXYscixzICAgICAgIGFycmF5IG9mIHRoZSBwbGF5ZXJzJ3Mgc2lnbmF0dXJlcwogICAqICAgICAgICBjaGFyZ2VHYXMgICBpbmRpY2F0ZXMgaWYgdGhlIGdhcyBjb3N0cyBzaG91bGQgYmUgc3VidHJhY3RlZCBmcm9tIHRoZSBwbGF5ZXJzJ3MgYmFsYW5jZXMKICAgKiAqLwogIGZ1bmN0aW9uIHVwZGF0ZUJhdGNoKGludDEyOFtdIHdpbkJhbGFuY2VzLCAgdWludDEyOFtdIGdhbWVDb3VudHMsIHVpbnQ4W10gdiwgYnl0ZXMzMltdIHIsIGJ5dGVzMzJbXSBzLCBib29sIGNoYXJnZUdhcykgcHVibGljIG9ubHlBdXRob3JpemVkewogICAgcmVxdWlyZSh3aW5CYWxhbmNlcy5sZW5ndGggPT0gZ2FtZUNvdW50cy5sZW5ndGgpOwogICAgcmVxdWlyZSh3aW5CYWxhbmNlcy5sZW5ndGggPT0gdi5sZW5ndGgpOwogICAgcmVxdWlyZSh3aW5CYWxhbmNlcy5sZW5ndGggPT0gci5sZW5ndGgpOwogICAgcmVxdWlyZSh3aW5CYWxhbmNlcy5sZW5ndGggPT0gcy5sZW5ndGgpOwogICAgcmVxdWlyZSh3aW5CYWxhbmNlcy5sZW5ndGggPD0gNTApOwogICAgYWRkcmVzcyBwbGF5ZXI7CiAgICB1aW50IGdhc0Nvc3QgPSAwOwogICAgaWYoY2hhcmdlR2FzKSAKICAgICAgZ2FzQ29zdCA9IGdldEdhc0Nvc3QoKTsKICAgIGdhc1BheWJhY2sgPSBzYWZlQWRkKGdhc1BheWJhY2ssIHNhZmVNdWwoZ2FzQ29zdCwgd2luQmFsYW5jZXMubGVuZ3RoKSk7CiAgICBmb3IodWludDggaSA9IDA7IGkgPCB3aW5CYWxhbmNlcy5sZW5ndGg7IGkrKyl7CiAgICAgIHBsYXllciA9IGVjcmVjb3ZlcihrZWNjYWsyNTYod2luQmFsYW5jZXNbaV0sIGdhbWVDb3VudHNbaV0pLCB2W2ldLCByW2ldLCBzW2ldKTsKICAgICAgX3VwZGF0ZVN0YXRlKHBsYXllciwgd2luQmFsYW5jZXNbaV0sIGdhbWVDb3VudHNbaV0sIGdhc0Nvc3QpOwogICAgfQogIH0KCiAgLyoqCiAgICogdXBkYXRlcyBhIHN0YXRlIGNoYW5uZWwuIGNhbiBiZSBjYWxsZWQgYnkgYm90aCBwYXJ0aWVzLgogICAqIDEuIHZlcmlmaWVzIHRoZSBzaWduYXR1cmUuCiAgICogMi4gdmVyaWZpZXMgaWYgdGhlIHNpZ25lZCBnYW1lLWNvdW50IGlzIGhpZ2hlciB0aGFuIHRoZSBsYXN0IGtub3duIGdhbWUtY291bnQgb2YgdGhpcyBjaGFubmVsLgogICAqIDMuIHVwZGF0ZXMgdGhlIGJhbGFuY2VzIGFjY29yZGluZ2x5LiBUaGlzIG1lYW5zOiBJdCBjaGVja3MgdGhlIGFscmVhZHkgcGVyZm9ybWVkIHVwZGF0ZXMgZm9yIHRoaXMgY2hhbm5lbCBhbmQgY29tcHV0ZXMKICAgKiAgICB0aGUgbmV3IGJhbGFuY2UgZGlmZmVyZW5jZSB0byBhZGQgb3Igc3VidHJhY3QgZnJvbSB0aGUgcGxheWVy4oCYcyBiYWxhbmNlLgogICAqIEBwYXJhbSB3aW5CYWxhbmNlIHRoZSBjdXJyZW50IHdpbiBvciBsb3NzCiAgICoJCQkJZ2FtZUNvdW50ICB0aGUgbnVtYmVyIG9mIHNpZ25lZCBnYW1lIG1vdmVzCiAgICoJCQkJdixyLHMgICAgICB0aGUgc2lnbmF0dXJlIG9mIGVpdGhlciB0aGUgY2FzaW5vIG9yIHRoZSBwbGF5ZXIKICAgKiAgICAgICAgY2hhcmdlR2FzICBpbmRpY2F0ZXMgaWYgdGhlIGdhcyBjb3N0cyBzaG91bGQgYmUgc3VidHJhY3RlZCBmcm9tIHRoZSBwbGF5ZXIncyBiYWxhbmNlCiAgICogKi8KICBmdW5jdGlvbiB1cGRhdGVTdGF0ZShpbnQxMjggd2luQmFsYW5jZSwgIHVpbnQxMjggZ2FtZUNvdW50LCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcywgYm9vbCBjaGFyZ2VHYXMpIHB1YmxpY3sKICAJYWRkcmVzcyBwbGF5ZXIgPSBkZXRlcm1pbmVQbGF5ZXIod2luQmFsYW5jZSwgZ2FtZUNvdW50LCB2LCByLCBzKTsKICAJdWludCBnYXNDb3N0ID0gMDsKICAJaWYocGxheWVyID09IG1zZy5zZW5kZXIpLy9pZiB0aGUgcGxheWVyIGNsb3NlcyB0aGUgc3RhdGUgY2hhbm5lbCBoaW1zZWxmLCBtYWtlIHN1cmUgdGhlIHNpZ25lciBpcyBhIGNhc2lubyB3YWxsZXQKICAJCXJlcXVpcmUoYXV0aG9yaXplZFtlY3JlY292ZXIoa2VjY2FrMjU2KHBsYXllciwgd2luQmFsYW5jZSwgZ2FtZUNvdW50KSwgdiwgciwgcyldKTsKICAJZWxzZSBpZiAoY2hhcmdlR2FzKXsvL3N1YnRyYWN0IHRoZSBnYXMgY29zdHMgZnJvbSB0aGUgcGxheWVyIGJhbGFuY2Ugb25seSBpZiB0aGUgY2FzaW5vIHdhbGxldCBpcyB0aGUgc2VuZGVyCiAgCQlnYXNDb3N0ID0gZ2V0R2FzQ29zdCgpOwogIAkJZ2FzUGF5YmFjayA9IHNhZmVBZGQoZ2FzUGF5YmFjaywgZ2FzQ29zdCk7CiAgCX0KICAJX3VwZGF0ZVN0YXRlKHBsYXllciwgd2luQmFsYW5jZSwgZ2FtZUNvdW50LCBnYXNDb3N0KTsKICB9CiAgCiAgLyoqCiAgICogaW50ZXJuYWwgbWV0aG9kIHRvIHBlcmZvcm0gdGhlIGFjdHVhbCBzdGF0ZSB1cGRhdGUuCiAgICogQHBhcmFtIHBsYXllciB0aGUgcGxheWVyIGFkZHJlc3MKICAgKiAgICAgICAgd2luQmFsYW5jZSB0aGUgcGxheWVyJ3Mgd2luIGJhbGFuY2UKICAgKiAgICAgICAgZ2FtZUNvdW50ICB0aGUgcGxheWVyJ3MgZ2FtZSBjb3VudAogICAqICovCiAgZnVuY3Rpb24gX3VwZGF0ZVN0YXRlKGFkZHJlc3MgcGxheWVyLCBpbnQxMjggd2luQmFsYW5jZSwgIHVpbnQxMjggZ2FtZUNvdW50LCB1aW50IGdhc0Nvc3QpIGludGVybmFsIHsKICAgIFN0YXRlIHN0b3JhZ2UgbGFzdCA9IGxhc3RTdGF0ZVtwbGF5ZXJdOwogIAlyZXF1aXJlKGdhbWVDb3VudCA+IGxhc3QuY291bnQpOwogIAlpbnQgZGlmZmVyZW5jZSA9IHVwZGF0ZVBsYXllckJhbGFuY2UocGxheWVyLCB3aW5CYWxhbmNlLCBsYXN0LndpbkJhbGFuY2UsIGdhc0Nvc3QpOwogIAlsYXN0U3RhdGVbcGxheWVyXSA9IFN0YXRlKGdhbWVDb3VudCwgd2luQmFsYW5jZSk7CiAgCVN0YXRlVXBkYXRlKHBsYXllciwgZ2FtZUNvdW50LCB3aW5CYWxhbmNlLCBkaWZmZXJlbmNlLCBnYXNDb3N0KTsKICB9CgogIC8qKgogICAqIGRldGVybWluZXMgaWYgdGhlIG1zZy5zZW5kZXIgb3IgdGhlIHNpZ25lciBvZiB0aGUgcGFzc2VkIHNpZ25hdHVyZSBpcyB0aGUgcGxheWVyLiByZXR1cm5zIHRoZSBwbGF5ZXIncyBhZGRyZXNzCiAgICogQHBhcmFtIHdpbkJhbGFuY2UgdGhlIGN1cnJlbnQgd2luQmFsYW5jZSwgdXNlZCB0byBjYWxjdWxhdGUgdGhlIG1zZyBoYXNoCiAgICoJCQkJZ2FtZUNvdW50ICB0aGUgY3VycmVudCBnYW1lQ291bnQsIHVzZWQgdG8gY2FsY3VsYXRlIHRoZSBtc2cuaGFzaAogICAqCQkJCXYsIHIsIHMgICAgdGhlIHNpZ25hdHVyZSBvZiB0aGUgbm9uLXNlbmRpbmcgcGFydHkKICAgKiAqLwogIGZ1bmN0aW9uIGRldGVybWluZVBsYXllcihpbnQxMjggd2luQmFsYW5jZSwgdWludDEyOCBnYW1lQ291bnQsIHVpbnQ4IHYsIGJ5dGVzMzIgciwgYnl0ZXMzMiBzKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGFkZHJlc3MpewogIAlpZiAoYXV0aG9yaXplZFttc2cuc2VuZGVyXSkvL2Nhc2lubyBpcyB0aGUgc2VuZGVyIC0+IHBsYXllciBpcyB0aGUgc2lnbmVyCiAgCQlyZXR1cm4gZWNyZWNvdmVyKGtlY2NhazI1Nih3aW5CYWxhbmNlLCBnYW1lQ291bnQpLCB2LCByLCBzKTsKICAJZWxzZQogIAkJcmV0dXJuIG1zZy5zZW5kZXI7CiAgfQoKCS8qKgoJICogY29tcHV0ZXMgdGhlIGRpZmZlcmVuY2Ugb2YgdGhlIHdpbiBiYWxhbmNlIHJlbGF0aXZlIHRvIHRoZSBsYXN0IGtub3duIHN0YXRlIGFuZCBhZGRzIGl0IHRvIHRoZSBwbGF5ZXIncyBiYWxhbmNlLgoJICogaW4gY2FzZSB0aGUgY2FzaW5vIGlzIHRoZSBzZW5kZXIsIHRoZSBnYXMgY29zdCBpbiBFREcgZ2V0cyBzdWJ0cmFjdGVkIGZyb20gdGhlIHBsYXllcidzIGJhbGFuY2UuCgkgKiBAcGFyYW0gcGxheWVyIHRoZSBhZGRyZXNzIG9mIHRoZSBwbGF5ZXIKCSAqCQkJCXdpbkJhbGFuY2UgdGhlIGN1cnJlbnQgd2luLWJhbGFuY2UKCSAqCQkJCWxhc3RXaW5CYWxhbmNlIHRoZSB3aW4tYmFsYW5jZSBvZiB0aGUgbGFzdCBrbm93biBzdGF0ZQoJICoJCQkJZ2FzQ29zdCB0aGUgZ2FzIGNvc3Qgb2YgdGhlIHR4CgkgKiAqLwogIGZ1bmN0aW9uIHVwZGF0ZVBsYXllckJhbGFuY2UoYWRkcmVzcyBwbGF5ZXIsIGludDEyOCB3aW5CYWxhbmNlLCBpbnQxMjggbGFzdFdpbkJhbGFuY2UsIHVpbnQgZ2FzQ29zdCkgaW50ZXJuYWwgcmV0dXJucyhpbnQgZGlmZmVyZW5jZSl7CiAgCWRpZmZlcmVuY2UgPSBzYWZlU3ViKHdpbkJhbGFuY2UsIGxhc3RXaW5CYWxhbmNlKTsKICAJaW50IG91dHN0YW5kaW5nID0gc2FmZVN1YihkaWZmZXJlbmNlLCBpbnQoZ2FzQ29zdCkpOwogIAl1aW50IG91dHM7CiAgCWlmKG91dHN0YW5kaW5nIDwgMCl7CiAgCQlvdXRzID0gdWludDI1NihvdXRzdGFuZGluZyAqICgtMSkpOwogIAkJcGxheWVyQmFsYW5jZSA9IHNhZmVTdWIocGxheWVyQmFsYW5jZSwgb3V0cyk7CiAgCQliYWxhbmNlT2ZbcGxheWVyXSA9IHNhZmVTdWIoYmFsYW5jZU9mW3BsYXllcl0sIG91dHMpOwogIAl9CiAgCWVsc2V7CiAgCQlvdXRzID0gdWludDI1NihvdXRzdGFuZGluZyk7CiAgCQlhc3NlcnQoYmFua3JvbGwoKSAqIG9uZUVERyA+IG91dHMpOwogIAkgIHBsYXllckJhbGFuY2UgPSBzYWZlQWRkKHBsYXllckJhbGFuY2UsIG91dHMpOwogIAkgIGJhbGFuY2VPZltwbGF5ZXJdID0gc2FmZUFkZChiYWxhbmNlT2ZbcGxheWVyXSwgb3V0cyk7CiAgCX0KICB9CiAgCiAgLyoqCiAgICogbG9ncyBzb21lIHNlZWRzIGFuZCBnYW1lIHJlc3VsdHMgZm9yIHBsYXllcnMgd2lzaGluZyB0byBoYXZlIHRoZWlyIGdhbWUgaGlzdG9yeSBsb2dnZWQgYnkgdGhlIGNvbnRyYWN0CiAgICogQHBhcmFtIHNlcnZlclNlZWRzIGFycmF5IGNvbnRhaW5pbmcgdGhlIHNlcnZlciBzZWVkcwogICAqICAgICAgICBjbGllbnRTZWVkcyBhcnJheSBjb250YWluaW5nIHRoZSBjbGllbnQgc2VlZHMKICAgKiAgICAgICAgcmVzdWx0cyAgICAgYXJyYXkgY29udGFpbmluZyB0aGUgcmVzdWx0cwogICAqICAgICAgICB2LCByLCBzICAgICB0aGUgc2lnbmF0dXJlIG9mIHRoZSBub24tc2VuZGluZyBwYXJ0eSAodG8gbWFrZSBzdXJlIHRoZSBjb3JyZWN0IHJlc3VsdHMgYXJlIGxvZ2dlZCkKICAgKiAqLwogIGZ1bmN0aW9uIGxvZ0dhbWVEYXRhKGJ5dGVzMzJbXSBzZXJ2ZXJTZWVkcywgYnl0ZXMzMltdIGNsaWVudFNlZWRzLCBpbnRbXSByZXN1bHRzLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgcHVibGljewogICAgYWRkcmVzcyBwbGF5ZXIgPSBkZXRlcm1pbmVQbGF5ZXIoc2VydmVyU2VlZHMsIGNsaWVudFNlZWRzLCByZXN1bHRzLCB2LCByLCBzKTsKICAgIHVpbnQgZ2FzQ29zdDsKICAgIC8vY2hhcmdlIGdhcyBpbiBjYXNlIHRoZSBzZXJ2ZXIgaXMgbG9nZ2luZyB0aGUgcmVzdWx0cyBmb3IgdGhlIHBsYXllcgogICAgaWYocGxheWVyICE9IG1zZy5zZW5kZXIpewogICAgICBnYXNDb3N0ID0gKDU3ICsgNzY4ICogc2VydmVyU2VlZHMubGVuZ3RoIC8gMTAwMCkqZ2FzUHJpY2U7CiAgICAgIGJhbGFuY2VPZltwbGF5ZXJdID0gc2FmZVN1YihiYWxhbmNlT2ZbcGxheWVyXSwgZ2FzQ29zdCk7CiAgICAgIHBsYXllckJhbGFuY2UgPSBzYWZlU3ViKHBsYXllckJhbGFuY2UsIGdhc0Nvc3QpOwogICAgICBnYXNQYXliYWNrID0gc2FmZUFkZChnYXNQYXliYWNrLCBnYXNDb3N0KTsKICAgIH0KICAgIEdhbWVEYXRhKHBsYXllciwgc2VydmVyU2VlZHMsIGNsaWVudFNlZWRzLCByZXN1bHRzLCBnYXNDb3N0KTsKICB9CiAgCiAgLyoqCiAgICogZGV0ZXJtaW5lcyBpZiB0aGUgbXNnLnNlbmRlciBvciB0aGUgc2lnbmVyIG9mIHRoZSBwYXNzZWQgc2lnbmF0dXJlIGlzIHRoZSBwbGF5ZXIuIHJldHVybnMgdGhlIHBsYXllcidzIGFkZHJlc3MKICAgKiBAcGFyYW0gc2VydmVyU2VlZHMgYXJyYXkgY29udGFpbmluZyB0aGUgc2VydmVyIHNlZWRzCiAgICogICAgICAgIGNsaWVudFNlZWRzIGFycmF5IGNvbnRhaW5pbmcgdGhlIGNsaWVudCBzZWVkcwogICAqICAgICAgICByZXN1bHRzICAgICBhcnJheSBjb250YWluaW5nIHRoZSByZXN1bHRzCiAgICoJCQkJdiwgciwgcyAgICB0aGUgc2lnbmF0dXJlIG9mIHRoZSBub24tc2VuZGluZyBwYXJ0eQogICAqICovCiAgZnVuY3Rpb24gZGV0ZXJtaW5lUGxheWVyKGJ5dGVzMzJbXSBzZXJ2ZXJTZWVkcywgYnl0ZXMzMltdIGNsaWVudFNlZWRzLCBpbnRbXSByZXN1bHRzLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyhhZGRyZXNzKXsKICAJYWRkcmVzcyBzaWduZXIgPSBlY3JlY292ZXIoa2VjY2FrMjU2KHNlcnZlclNlZWRzLCBjbGllbnRTZWVkcywgcmVzdWx0cyksIHYsIHIsIHMpOwogIAlpZiAoYXV0aG9yaXplZFttc2cuc2VuZGVyXSkvL2Nhc2lubyBpcyB0aGUgc2VuZGVyIC0+IHBsYXllciBpcyB0aGUgc2lnbmVyCiAgCQlyZXR1cm4gc2lnbmVyOwogIAllbHNlIGlmIChhdXRob3JpemVkW3NpZ25lcl0pCiAgCQlyZXR1cm4gbXNnLnNlbmRlcjsKICAJZWxzZSAKICAJICByZXZlcnQoKTsKICB9Cgp9'.
	

]
