Class {
	#name : #SRT2dc1d0fbcdbf1b08bedd2354f67b134a2285b6c5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT2dc1d0fbcdbf1b08bedd2354f67b134a2285b6c5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjE7CgovLyBFdGhlclZlZ2FzIFYzIAovLyBVcGRhdGVzOiB0aW1lIGlzIG5vdyBhIGhhcmQgcmVzZXQgYW5kIGlzIGJhc2VkIG9uIHRoZSBwcmljZSB5b3UgYnV5IHdpdGggbWluaW11bSAKLy8gTmFtZSBmZWF0dXJlIGludHJvZHVjZWQgcGx1cyBxdW90ZXMgW2FkZGVkIHRvIFVJIHNvb25dCi8vIFBva2VyIGZlYXR1cmUgYWRkZWQsIHBheXMgYWJvdXQgfjQvMjUgb2YgZW50aXJlIGNvbGxlY3RlZCBwb3QgY3VycmVudGx5IAovLyBjYW4gYmUgY2xhaW1lZCBtdWx0aXBsZSB0aW1lcyAoYnkgb3RoZXIgdXNlcnMpLiBMYXN0IHBva2VyIHdpbm5lciBnZXRzIAovLyByZW1haW5pbmcgcG90IHdoZW4gY29tcGxldGUgamFja3BvdCBpcyBwYWlkIG91dCAKCi8vIEhPU1Q6IGV0aGxhc3ZlZ2FzLnN1cmdlLnNoIAovLyBNYWRlIGJ5IEV0aGVyR3V5IAovLyBRdWVzdGlvbnMgb3Igc3VnZ2VzdGlvbnM/IDxzcGFuIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMDM2Njc3NmI2NjcxNjQ3NjdhNDM2ZTYyNmE2ZjJkNjA2YzZlIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9zcGFuPiAKCmNvbnRyYWN0IFJOR3sKICAgICB1aW50MjU2IHNlY3JldCA9IDA7CiAgICAgCiAgICAvLyBUaGFua3MgdG8gVGVjaG5pY2FsUmlzZQogICAgLy8gQmFuIGNvbnRyYWN0cwogICAgbW9kaWZpZXIgTm9Db250cmFjdCgpewogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBhZGRyZXNzIGFkZHIgPSBtc2cuc2VuZGVyOwogICAgICAgIGFzc2VtYmx5IHsgc2l6ZSA6PSBleHRjb2Rlc2l6ZShhZGRyKSB9CiAgICAgICAgcmVxdWlyZShzaXplID09IDApOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFJORygpIHB1YmxpYyBOb0NvbnRyYWN0ewogICAgICAgIHNlY3JldCA9IHVpbnQyNTYoa2VjY2FrMjU2KGJsb2NrLmNvaW5iYXNlKSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9naXZlUk5HKHVpbnQyNTYgbW9kdWxvLCB1aW50MjU2IHNlY3IpIHByaXZhdGUgdmlldyByZXR1cm5zICh1aW50MjU2LCB1aW50MjU2KXsKICAgICAgICB1aW50MjU2IHNlZWQxID0gdWludDI1NihibG9jay5jb2luYmFzZSk7CiAgICAgICAgdWludDI1NiBzZWVkMyA9IHNlY3I7IAogICAgICAgIHVpbnQyNTYgbmV3c2VjciA9ICh1aW50MjU2KGtlY2NhazI1NihzZWVkMSxzZWVkMykpKTsKICAgICAgICByZXR1cm4gKG5ld3NlY3IgJSBtb2R1bG8sIG5ld3NlY3IpOwogICAgfQogICAgCgogICAgZnVuY3Rpb24gR2l2ZVJORyh1aW50MjU2IG1heCkgaW50ZXJuYWwgTm9Db250cmFjdCByZXR1cm5zICh1aW50MjU2KXsKICAgICAgICB1aW50MjU2IG51bTsKICAgICAgICB1aW50MjU2IG5ld3NlY3JldCA9IHNlY3JldDsKCiAgICAgICAgKG51bSxuZXdzZWNyZXQpID0gX2dpdmVSTkcobWF4LCBuZXdzZWNyZXQpOwogICAgICAgIHNlY3JldD1uZXdzZWNyZXQ7CiAgICAgICAgcmV0dXJuIG51bTsgCiAgICB9CiAgICAKCn0KCmNvbnRyYWN0IFBva2VyIGlzIFJOR3sKICAgIC8vIHdhcm5pbmc7IG51bWJlciAwIGlzIGEgbm9uLWV4aXN0aW5nIGNhcmQ7IG1lYW5zIGVtcHR5OwoKICAgIHVpbnQ4WzVdIHB1YmxpYyBIb3VzZUNhcmRzOwogICAgCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDhbMl0pIHB1YmxpYyBQbGF5ZXJDYXJkczsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBwdWJsaWMgUGxheWVyUm91bmQ7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIFJvdW5kTnVtYmVyOwogICAgCiAgICB1aW50OFs2XSBwdWJsaWMgV2lubmluZ0hhbmQ7IC8vIHRyYWNrcyB3aW5uaW5nIGhhbmQuIElEIDEgZGVmaW5lcyB3aW5uaW5nIGxldmVsICg5PXN0cmFpZ2h0IGZsdXNoLCA4PTQgb2YgYSBraW5kLCBldGMpIGFuZCBvdGhlciBudW1iZXJzIAogICAgYWRkcmVzcyAgcHVibGljIFBva2VyV2lubmVyOwogICAgCiAgICB1aW50OFsyXSBwdWJsaWMgV2lubmluZ0NhcmRzOwogICAgLy8gZGVmaW5lIHRoZSBvdGhlciBjYXJkcyB3aGljaCBtaWdodCBwbGF5IGluIGRlZmluaW5nIHRoZSB3aW5uZXIuIAoKICAgIGZ1bmN0aW9uIEdldENhcmROdW1iZXIodWludDggcmFuaywgdWludDggc3VpdCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludDgpewogICAgICAgIGlmIChyYW5rPT0wKXsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiAoKHJhbmstMSkqNCsxKStzdWl0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBHZXRQbGF5ZXJSb3VuZChhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgcmV0dXJuIFBsYXllclJvdW5kW3dob107CiAgICB9CiAgICAKICAgIAogICAgCiAgICBmdW5jdGlvbiBHZXRDYXJkSW5mbyh1aW50OCBuKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCByYW5rLCB1aW50OCBzdWl0KXsKICAgICAgICBpZiAobj09MCl7CiAgICAgICAgICAgIHJldHVybiAoMCwwKTsKICAgICAgICB9CiAgICAgICAgc3VpdCA9IChuLTEpJTQ7CiAgICAgICAgcmFuayA9IChuLTEpLzQrMTsKICAgIH0KICAgIAogICAvLyBldmVudCBwdXNoaWZvKHVpbnQ4LCB1aW50OCwgdWludDgsdWludDgsdWludDgpOwogICAgLy8gcmVzZXRzIGdhbWUgCiAgICBmdW5jdGlvbiBEcmF3SG91c2UoKSBpbnRlcm5hbHsKICAgICAgICAvLyBEcmF3IHRhYmxlIGNhcmRzIAogICAgICAgIHVpbnQ4IGk7CiAgICAgICAgdWludDggcmFuazsKICAgICAgICB1aW50OCBzdWl0OwogICAgICAgIHVpbnQ4IG47CiAgICAgICAgZm9yIChpPTA7IGk8NTsgaSsrKXsKICAgICAgICAgICAgcmFuayA9IHVpbnQ4KEdpdmVSTkcoMTMpKzEpOwogICAgICAgICAgICBzdWl0ID0gdWludDgoR2l2ZVJORyg0KSk7CiAgICAgICAgICAgIG4gPSBHZXRDYXJkTnVtYmVyKHJhbmssc3VpdCk7CiAgICAgICAgICAgIEhvdXNlQ2FyZHNbaV09bjsKICAgICAgICB9CgogICAgICAgIHVpbnQ4WzJdIHN0b3JhZ2UgdGFyZ2V0ID0gUGxheWVyQ2FyZHNbYWRkcmVzcyh0aGlzKV07CiAgICAgICAgZm9yIChpPTA7IGk8MjsgaSsrKXsKICAgICAgICAgICAgcmFuayA9IHVpbnQ4KEdpdmVSTkcoMTMpKzEpOwogICAgICAgICAgICBzdWl0ID0gdWludDgoR2l2ZVJORyg0KSk7CiAgICAgICAgICAgIG4gPSBHZXRDYXJkTnVtYmVyKHJhbmssc3VpdCk7CgogICAgICAgICAgICB0YXJnZXRbaV09bjsKCiAgICAgICAgfQogICAgICAgIAogICAgICAgIFdpbm5pbmdIYW5kID0gUmFua1Njb3JlKGFkZHJlc3ModGhpcykpOwogICAgICAgIFdpbm5pbmdDYXJkcz1bdGFyZ2V0WzBdLHRhcmdldFsxXV07CiAgICAgICAgUG9rZXJXaW5uZXI9IGFkZHJlc3ModGhpcyk7CiAgICB9CiAgICAKICAgIGV2ZW50IERyYXduQ2FyZHMoYWRkcmVzcyBwbGF5ZXIsIHVpbnQ4IGNhcmQxLCB1aW50OCBjYXJkMik7CiAgICBmdW5jdGlvbiBEcmF3QWRkcigpIGludGVybmFsIHsKICAgICAgICB1aW50OCB0Y2FyZDE7CiAgICAgICAgdWludDggdGNhcmQyOwogICAgICAgIGZvciAodWludDggaT0wOyBpPDI7IGkrKyl7CiAgICAgICAgICAgIHVpbnQ4IHJhbmsgPSB1aW50OChHaXZlUk5HKDEzKSsxKTsKICAgICAgICAgICAgdWludDggc3VpdCA9IHVpbnQ4KEdpdmVSTkcoNCkpOwogICAgICAgICAgICB1aW50OCBuID0gR2V0Q2FyZE51bWJlcihyYW5rLHN1aXQpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGk9PTApewogICAgICAgICAgICAgICAgdGNhcmQxPW47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgIHRjYXJkMj1uOwogICAgICAgICAgICB9CgogICAgICAgICAgICBQbGF5ZXJDYXJkc1ttc2cuc2VuZGVyXVtpXT1uOwoKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKFBsYXllclJvdW5kW21zZy5zZW5kZXJdICE9IFJvdW5kTnVtYmVyKXsKICAgICAgICAgICAgUGxheWVyUm91bmRbbXNnLnNlbmRlcl0gPSBSb3VuZE51bWJlcjsKICAgICAgICB9CiAgICAgICAgZW1pdCBEcmF3bkNhcmRzKG1zZy5zZW5kZXIsdGNhcmQxLCB0Y2FyZDIpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBHZXRQbGF5ZXJDYXJkcyhhZGRyZXNzIHdobykgcHVibGljIHZpZXcgTm9Db250cmFjdCByZXR1cm5zICh1aW50OCwgdWludDgpewogICAgICAgIHVpbnQ4WzJdIG1lbW9yeSB0YXJnZXQgPSBQbGF5ZXJDYXJkc1t3aG9dOwogICAgICAgIAogICAgICAgIHJldHVybiAodGFyZ2V0WzBdLCB0YXJnZXRbMV0pOwogICAgfQoKICAgIGZ1bmN0aW9uIEdldFdpbkNhcmRzKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDgsIHVpbnQ4KXsKICAgICAgICByZXR1cm4gKFdpbm5pbmdDYXJkc1swXSwgV2lubmluZ0NhcmRzWzFdKTsKICAgIH0KICAgIAogICAgCiAgICAKICAgIC8vIHdlbHAgdGhpcyBpcyBoYW5keSAKICAgIHN0cnVjdCBDYXJkewogICAgICAgIHVpbnQ4IHJhbms7CiAgICAgICAgdWludDggc3VpdDsKICAgIH0KICAgIAogICAgLy8gd2ViIAogIC8vICBmdW5jdGlvbiBIYW5kV2luc1ZpZXcoYWRkcmVzcyBjaGVja2hhbmQpIHZpZXcgcmV0dXJucyAodWludDgpewogICAgLy8gICAgcmV0dXJuIEhhbmRXaW5zKGNoZWNraGFuZCk7CiAgICAvL30KICAgIAogICAgCiAgICBmdW5jdGlvbiBIYW5kV2lucyhhZGRyZXNzIGNoZWNraGFuZCkgaW50ZXJuYWwgcmV0dXJucyAodWludDgpewogICAgICAgIHVpbnQ4IHJlc3VsdCA9IEhhbmRXaW5zVmlldyhjaGVja2hhbmQpOwogICAgICAgIAogICAgICAgIHVpbnQ4WzZdIG1lbW9yeSBDdXJyU2NvcmUgPSBSYW5rU2NvcmUoY2hlY2toYW5kKTsKICAgICAgICAgICAgCiAgICAgICAgdWludDhbMl0gbWVtb3J5IHRhcmdldCA9IFBsYXllckNhcmRzW2NoZWNraGFuZF07CiAgICAgICAgCiAgICAgICAgaWYgKHJlc3VsdCA9PSAxKXsKICAgICAgICAgICAgV2lubmluZ0hhbmQgPSBDdXJyU2NvcmU7CiAgICAgICAgICAgIFdpbm5pbmdDYXJkcz0gW3RhcmdldFswXSx0YXJnZXRbMV1dOwogICAgICAgICAgICBQb2tlcldpbm5lcj1tc2cuc2VuZGVyOwogICAgICAgICAgICAvLyBjbGVhciBjYXJkcyAKICAgICAgICAgICAgLy9QbGF5ZXJDYXJkc1tjaGVja2hhbmRdWzBdPTA7CiAgICAgICAgICAgIC8vUGxheWVyQ2FyZHNbY2hlY2toYW5kXVsxXT0wOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAvLyByZXR1cm5zIDAgaWYgbG9zZSwgMSBpZiB3aW4sIDIgaWYgZXF1YWwgCiAgICAvLyBpZiB3aW5uZXIgZm91bmQgaW1tZWRpYXRlbHkgc2V0cyB3aW5uZXIgdmFsdWVzIAogICAgZnVuY3Rpb24gSGFuZFdpbnNWaWV3KGFkZHJlc3MgY2hlY2toYW5kKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50OCl7IAogICAgICAgIGlmIChQbGF5ZXJSb3VuZFtjaGVja2hhbmRdICE9IFJvdW5kTnVtYmVyKXsKICAgICAgICAgICAgcmV0dXJuIDA7IC8vIGVtcHR5IGNhcmRzIGluIG5ldyByb3VuZC4gCiAgICAgICAgfQogICAgICAgIHVpbnQ4WzZdIG1lbW9yeSBDdXJyZW50V2luSGFuZCA9IFdpbm5pbmdIYW5kOwogICAgICAgIAogICAgICAgIHVpbnQ4WzZdIG1lbW9yeSBDdXJyU2NvcmUgPSBSYW5rU2NvcmUoY2hlY2toYW5kKTsKICAgICAgICAKICAgICAgICAKICAgICAgICB1aW50OCByZXQgPSAyOwogICAgICAgIGlmIChDdXJyU2NvcmVbMF0gPiBDdXJyZW50V2luSGFuZFswXSl7CiAKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKEN1cnJTY29yZVswXSA9PSBDdXJyZW50V2luSGFuZFswXSl7CiAgICAgICAgICAgIGZvciAodWludCBpPTE7IGk8PTU7IGkrKyl7CiAgICAgICAgICAgICAgICBpZiAoQ3VyclNjb3JlW2ldID49IEN1cnJlbnRXaW5IYW5kW2ldKXsKICAgICAgICAgICAgICAgICAgICBpZiAoQ3VyclNjb3JlW2ldID4gQ3VycmVudFdpbkhhbmRbaV0pewoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZXsKICAgICAgICAgICAgICAgICAgICByZXQ9MDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICByZXQ9MDsKICAgICAgICB9CiAgICAgICAgLy8gMiBpcyBzYW1lIGhhbmQuIGNvbW1lbnRlZCBvdXQgaW4gcGF5IG1vZGUgCiAgICAgICAgLy8gb25seSB3aW5uZXIgZ2V0cyBwb3QuIAogICAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgICAKICAgIAoKICAgIGZ1bmN0aW9uIFJhbmtTY29yZShhZGRyZXNzIGNoZWNraGFuZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50OFs2XSBvdXRwdXQpewogICAgICAKICAgICAgICB1aW50OFs0XSBtZW1vcnkgRmx1c2hUcmFja2VyOwogICAgICAgIHVpbnQ4WzE0XSBtZW1vcnkgQ2FyZFRyYWNrZXI7CiAgICAgICAgCiAgICAgICAgdWludDggcmFuazsKICAgICAgICB1aW50OCBzdWl0OwogICAgICAgIAogICAgICAgIENhcmRbN10gbWVtb3J5IENhcmRzOwogICAgICAgIAogICAgICAgIGZvciAodWludDggaT0wOyBpPDc7IGkrKyl7CiAgICAgICAgICAgIGlmIChpPj01KXsKICAgICAgICAgICAgICAgIChyYW5rLHN1aXQpID0gR2V0Q2FyZEluZm8oUGxheWVyQ2FyZHNbY2hlY2toYW5kXVtpLTVdKTsKICAgICAgICAgICAgICAgIEZsdXNoVHJhY2tlcltzdWl0XSsrOwogICAgICAgICAgICAgICAgQ2FyZFRyYWNrZXJbcmFua10rKzsKICAgICAgICAgICAgICAgIENhcmRzW2ldID0gQ2FyZChyYW5rLHN1aXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAocmFuayxzdWl0KSA9IEdldENhcmRJbmZvKEhvdXNlQ2FyZHNbaV0pOwogICAgICAgICAgICAgICAgRmx1c2hUcmFja2VyW3N1aXRdKys7CiAgICAgICAgICAgICAgICBDYXJkVHJhY2tlcltyYW5rXSsrOwogICAgICAgICAgICAgICAgQ2FyZHNbaV0gPSBDYXJkKHJhbmssc3VpdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDggc3RyYWlnaHQgPSAwOwogICAgICAgIC8vIHNraXAgYWxsIHplcm8ncwogICAgICAgIHVpbnQ4WzNdIG1lbW9yeSBzdHJhaWdodF9zdGFydGNhcmQ7CiAgICAgICAgZm9yICh1aW50OCBzdGFydGNhcmQ9MTM7IGk+PTU7IGktLSl7CiAgICAgICAgICAgIGlmIChDYXJkVHJhY2tlcltzdGFydGNhcmRdID49IDEpewogICAgICAgICAgICAgICAgZm9yICh1aW50OCBjdXJyY2FyZD1zdGFydGNhcmQtMTsgY3VycmNhcmQ+PShzdGFydGNhcmQtNCk7IGN1cnJjYXJkLS0pewogICAgICAgICAgICAgICAgICAgIGlmIChDYXJkVHJhY2tlcltjdXJyY2FyZF0gPj0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyY2FyZCA9PSAoc3RhcnRjYXJkLTQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGF0IGVuZCwgc3RyYWlnaHQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJhaWdodF9zdGFydGNhcmRbc3RyYWlnaHRdID0gc3RhcnRjYXJkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyYWlnaHQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDggZmx1c2g9MDsKCiAgICAgICAgZm9yIChpPTA7aTw9MztpKyspewogICAgICAgICAgICBpZiAoRmx1c2hUcmFja2VyW2ldPj01KXsKICAgICAgICAgICAgICAgIGZsdXNoPWk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBkb25lIGluaXQuIAogICAgICAgIAogICAgICAgIC8vIHN0cmFpZ2h0IGZsdXNoPyAKICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICBpZiAoZmx1c2g+MCAmJiBzdHJhaWdodD4wKXsKICAgICAgICAgICAgLy8gc29tZW9uZSBoYXMgc3RyYWlnaHQgZmx1c2g/IAogICAgICAgICAgICAvLyBsZXZlbCBzY29yZSA5IAogICAgICAgICAgICBvdXRwdXRbMF0gPSA5OwogICAgICAgICAgICBjdXJyY2FyZD0wOwogICAgICAgICAgICBmb3IgKGk9MDsgaTwzOyBpKyspewogICAgICAgICAgICAgICAgc3RhcnRjYXJkPXN0cmFpZ2h0X3N0YXJ0Y2FyZFtpXTsKICAgICAgICAgICAgICAgIGN1cnJjYXJkPTU7IC8vIHRyYWNrIGZsdXNoLCBudW0gNSBpcyBzdGFuZGFyZC4gICAgCiAgICAgICAgICAgICAgICBmb3IgKHJhbms9MDsgaTw3OyBpKyspewogICAgICAgICAgICAgICAgICAgIGlmIChDYXJkc1tpXS5zdWl0ID09IGZsdXNoICYmIENhcmRzW2ldLnJhbmsgPD0gc3RhcnRjYXJkICYmIENhcmRzW2ldLnJhbms+PShzdGFydGNhcmQtNCkpewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyY2FyZC0tOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmNhcmQ9PTApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY3VycmNhcmQ9PTApewogICAgICAgICAgICAgICAgICAgIC8vIGZvdW5kIHN0cmFpZ2h0IGZsdXNoIGhpZ2guIAogICAgICAgICAgICAgICAgICAgIG91dHB1dFsxXSA9IHN0cmFpZ2h0X3N0YXJ0Y2FyZFtpXTsgLy8gc2F2ZSB0aGUgaGlnaCBjYXJkIAogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gb3V0cHV0OyAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gaGlnaCBjYXJkIAogICAgICAgIAogICAgICAgIC8vcmV1c2UgdGhlIHJhbmsgdmFyaWFibGUgdG8gc3VtIGNhcmRzOyAKICAgICAgICByYW5rPTA7CiAgICAgICAgZm9yIChpPTEzO2k+PTE7aS0tKXsKICAgICAgICAgICAgcmFuayA9IHJhbmsgKyBDYXJkVHJhY2tlcltpXTsKICAgICAgICAgICAgaWYgKENhcmRUcmFja2VyW2ldID49IDQpewogICAgICAgICAgICAgICAgb3V0cHV0WzBdID0gODsgLy8gaGlnaCBjYXJkIAogICAgICAgICAgICAgICAgb3V0cHV0WzFdID0gaTsgLy8gdGhlIHR5cGUgb2YgY2FyZCAKICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJhbmsgPj00KXsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGZ1bGwgaG91c2UgCiAgICAgICAgCiAgICAgICAgcmFuaz0wOyAvLyB0cmFjayAzLWtpbmQgCiAgICAgICAgc3VpdD0wOyAvLyB0cmFjayAyLWtpbmQgCiAgICAgICAgc3RhcnRjYXJkPTA7CiAgICAgICAgY3VycmNhcmQ9MDsKICAgICAgICAKICAgICAgICBmb3IgKGk9MTM7aT49MTtpLS0pewogICAgICAgICAgICBpZiAocmFuayA9PSAwICYmIENhcmRUcmFja2VyW2ldID49IDMpewogICAgICAgICAgICAgICAgcmFuayA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZihDYXJkVHJhY2tlcltpXSA+PSAyKXsKICAgICAgICAgICAgICAgIGlmIChzdWl0ID09IDApewogICAgICAgICAgICAgICAgICAgIHN1aXQgPSBDYXJkVHJhY2tlcltpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgLy8gZG91YmxlIG5pY2UgCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0Y2FyZD09MCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Y2FyZD1DYXJkVHJhY2tlcltpXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHJhbmsgIT0gMCAmJiBzdWl0ICE9IDApewogICAgICAgICAgICBvdXRwdXRbMF0gPSA3OwogICAgICAgICAgICBvdXRwdXRbMV0gPSByYW5rOyAvLyBmdWxsIGhvdXNlIHRyaXBwbGUgaGlnaCAKICAgICAgICAgICAgb3V0cHV0WzJdID0gc3VpdDsgLy8gZnVsbCBob3VzZSB0cmlwcGxlIGxvdyAKICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGZsdXNoPjApewogICAgICAgICAgICAvLyBmbHVzaCAKICAgICAgICAgICAgb3V0cHV0WzBdID0gNjsKICAgICAgICAgICAgb3V0cHV0WzFdID0gZmx1c2g7CiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoc3RyYWlnaHQ+MCl7CiAgICAgICAgICAgIC8vc3RyYWlnaHQgCiAgICAgICAgICAgIG91dHB1dFswXSA9IDU7CiAgICAgICAgICAgIG91dHB1dFsxXSA9IHN0cmFpZ2h0X3N0YXJ0Y2FyZFswXTsKICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHJhbms+MCl7CiAgICAgICAgICAgIC8vIHRyaXBwbGUgCiAgICAgICAgICAgIG91dHB1dFswXT00OwogICAgICAgICAgICBvdXRwdXRbMV09cmFuazsKICAgICAgICAgICAgY3VycmNhcmQ9MjsgLy8gdHJhY2sgaW5kZXg7IAogICAgICAgICAgICAvLyBnZXQgMiBoaWdoZXN0IGNhcmRzIAogICAgICAgICAgICBmb3IgKGk9MTM7aT49MTtpLS0pewogICAgICAgICAgICAgICAgaWYgKGkgIT0gcmFuayl7CiAgICAgICAgICAgICAgICAgICAgaWYgKENhcmRUcmFja2VyW2ldID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vdGUgYXQgdGhyZWUgb2YgYSBraW5kIHdlIGhhdmUgbm8gb3RoZXIgZG91YmxlczsgYWxsIG90aGVyIHJhbmtzIGFyZSBkaWZmZXJlbnQgc28gbm8gY2hlY2sgPiAxIAogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbY3VycmNhcmRdID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmNhcmQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY3VycmNhcmQ9PTQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoc3VpdCA+IDAgJiYgc3RhcnRjYXJkID4gMCl7CiAgICAgICAgICAgIC8vIGRvdWJsZSBwYWlyIAogICAgICAgICAgICBvdXRwdXRbMF0gPSAzOwogICAgICAgICAgICBvdXRwdXRbMV0gPSBzdWl0OwogICAgICAgICAgICBvdXRwdXRbMl0gPSBzdGFydGNhcmQ7CiAgICAgICAgICAgIC8vIGdldCBoaWdoZXN0IGNhcmQgCiAgICAgICAgICAgIGZvciAoaT0xMztpPj0xO2ktLSl7CiAgICAgICAgICAgICAgICBpZiAoaSE9c3VpdCAmJiBpIT1zdGFydGNhcmQgJiYgQ2FyZFRyYWNrZXJbaV0+MCl7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0WzNdPWk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoc3VpdCA+IDApewogICAgICAgICAgICAvLyBwYWlyIAogICAgICAgICAgICBvdXRwdXRbMF09MjsKICAgICAgICAgICAgb3V0cHV0WzFdPXN1aXQ7CiAgICAgICAgICAgIGN1cnJjYXJkPTI7CiAgICAgICAgICAgIC8vIGZpbGwgMyBvdGhlciBwb3NpdGlvbnMgd2l0aCBoaWdoIGNhcmRzLiAKICAgICAgICAgICAgZm9yIChpPTEzO2k+PTE7aS0tKXsKICAgICAgICAgICAgICAgIGlmIChpIT1zdWl0ICYmIENhcmRUcmFja2VyW2ldPjApewogICAgICAgICAgICAgICAgICAgIG91dHB1dFtjdXJyY2FyZF09aTsKICAgICAgICAgICAgICAgICAgICBjdXJyY2FyZCsrOwogICAgICAgICAgICAgICAgICAgIGlmKGN1cnJjYXJkPT01KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9ICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gd2VscCB5b3UgYXJlIGhlcmUgbm93LCBvbmx5IGhhdmUgaGlnaCBjYXJkPwogICAgICAgIC8vIGJvcmluZyAKICAgICAgICBvdXRwdXRbMF09MTsKICAgICAgICBjdXJyY2FyZD0xOwogICAgICAgIGZvciAoaT0xMztpPj0xO2ktLSl7CiAgICAgICAgICAgIGlmIChDYXJkVHJhY2tlcltpXT4wKXsKICAgICAgICAgICAgICAgIG91dHB1dFtjdXJyY2FyZF09aTsKICAgICAgICAgICAgICAgIGN1cnJjYXJkKys7CiAgICAgICAgICAgICAgICBpZiAoY3VycmNhcmQ9PTYpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKfQoKY29udHJhY3QgVmVnYXMgaXMgUG9rZXJ7CiAgICBhZGRyZXNzIG93bmVyOwogICAgYWRkcmVzcyBwdWJsaWMgZmVlc2VuZDsKICAgIAogICAgCiAgICB1aW50MjU2IHB1YmxpYyBUaW1lcjsKICAgIAogICAgdWludDggY29uc3RhbnQgTUFYUFJJQ0VQT1dFUiA9IDQwOyAvLyA8IDI1NQogICAgCiAgICBhZGRyZXNzIHB1YmxpYyBKYWNrcG90V2lubmVyOwogICAgCiAgICB1aW50MTYgcHVibGljIEphY2twb3RQYXlvdXQgPSA4MDAwOyAKICAgIHVpbnQxNiBwdWJsaWMgUG9rZXJQYXlvdXQgPSAyMDAwOwogICAgdWludDE2IHB1YmxpYyBQcmV2aW91c1BheW91dCA9IDY1MDA7CiAgICB1aW50MTYgcHVibGljIEluY3JlYXNlID0gOTcwMDsKICAgIHVpbnQxNiBwdWJsaWMgVGF4ID0gNTAwOwogICAgdWludDE2IHB1YmxpYyBQb3RQYXlvdXQgPSA4MDAwOwogICAgCiAgICB1aW50MjU2IHB1YmxpYyBCYXNlUHJpY2UgPSAoMC4wMDUgZXRoZXIpOwogICAgCiAgICB1aW50MjU2IHB1YmxpYyBUb3RhbFBvdDsKICAgIHVpbnQyNTYgcHVibGljIFBva2VyUGF5b3V0VmFsdWU7CiAgICAKICAgIC8vIG1haW5uZXQgCiAgICB1aW50MjU2WzldIFRpbWVBcnJheSA9IFt1aW50MjU2KDYgaG91cnMpLCB1aW50MjU2KDMgaG91cnMpLCB1aW50MjU2KDIgaG91cnMpLCB1aW50MjU2KDEgaG91cnMpLCB1aW50MjU2KDUwIG1pbnV0ZXMpLCB1aW50MjU2KDQwIG1pbnV0ZXMpLCB1aW50MjU2KDMwIG1pbnV0ZXMpLCB1aW50MjU2KDIwIG1pbnV0ZXMpLCB1aW50MjU2KDE1IG1pbnV0ZXMpXTsKICAgIC8vIHRlc3RuZXQgCiAgICAvL3VpbnQyNTZbM10gVGltZUFycmF5ID0gW3VpbnQyNTYoMyBtaW51dGVzKSwgdWludDI1NigzIG1pbnV0ZXMpLCB1aW50MjU2KDIgbWludXRlcyldOwogICAgCiAgICBzdHJ1Y3QgSXRlbXsKICAgICAgICBhZGRyZXNzIEhvbGRlcjsKICAgICAgICB1aW50OCBQcmljZUlEOwogICAgfQogICAgCiAgICBJdGVtWzE2XSBwdWJsaWMgTWFya2V0OwogICAgCiAgICB1aW50OCBwdWJsaWMgTWF4SXRlbXMgPSAxMjsgLy8gbWF4IElELCBpcyBOT1QgaW5kZXggYnV0IGFjdHVhbCBtYXggaXRlbXMgdG8gYnV5LiAwIG1lYW5zIHJlYWxseSBub3RoaW5nLCBub3QgMSBpdGVtIAogICAgCiAgICBldmVudCBJdGVtQm91Z2h0KHVpbnQyNTYgUm91bmQsIHVpbnQ4IElELCAgdWludDI1NiBQcmljZSwgYWRkcmVzcyBCb3VnaHRGcm9tLCBhZGRyZXNzIE5ld093bmVyLCB1aW50MjU2IE5ld1RpbWVyLCB1aW50MjU2IE5ld0pQLCBzdHJpbmcgUXVvdGUsIHN0cmluZyBOYW1lKTsKICAgIC8vIHF1b3RlcyBoZXJlID8gCiAgICBldmVudCBQb2tlclBhaWQodWludDI1NiBSb3VuZCwgdWludDI1NiBBbW91bnRXb24sIGFkZHJlc3MgV2hvLCBzdHJpbmcgUXVvdGUsIHN0cmluZyBOYW1lLCB1aW50OFs2XSBXaW5IYW5kKTsKICAgIGV2ZW50IEphY2twb3RQYWlkKHVpbnQyNTYgUm91bmQsIHVpbnQyNTYgQW1vdW50LCAgYWRkcmVzcyBXaG8sIHN0cmluZyBRdW90ZSwgc3RyaW5nIE5hbWUpOwogICAgZXZlbnQgTmV3Um91bmQoKTsKICAgIAogICAgYm9vbCBwdWJsaWMgRWRpdE1vZGU7CiAgICBib29sIHB1YmxpYyBTZXRFZGl0TW9kZTsKICAgIC8vIGRldiBmdW5jdGlvbnMgCiAgICAKICAgIG1vZGlmaWVyIE9ubHlPd25lcigpewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIAogICAgbW9kaWZpZXIgR2FtZUNsb3NlZCgpewogICAgICAgIHJlcXVpcmUgKGJsb2NrLnRpbWVzdGFtcCA+IFRpbWVyKTsKICAgICAgICBfOwogICAgfQogICAgCgogICAgCiAgICBmdW5jdGlvbiBWZWdhcygpIHB1YmxpY3sKICAgICAgICBvd25lcj1tc2cuc2VuZGVyOwogICAgICAgIGZlZXNlbmQ9MHhDMTA4NkZBOTc1NDlDRUE3YWNGN0MyYTdGYTc4MjBGRDA2RjNlNDQwOwogICAgICAgIC8vIHdpdGhkcmF3IGFsc28gc2V0dXBzIG5ldyBnYW1lLiAKICAgICAgICAvLyBwYXlzIG91dCAwIGV0aCBvZiBjb3Vyc2UgdG8gb3duZXIsIG5vIGV0aCBpbiBjb250cmFjdC4gCiAgICAgICAgVGltZXIgPSAxOyAvLyBtYWtlcyBzdXJlIHdpdGhkcmF3YWwgcnVucwogICAgICAgIC8vV2l0aGRyYXcoIkdhbWUgaW5pdCIsICJBZG1pbiIpOwogICAgfQogICAgCiAgICAvLyBhbGwgY29udHJhY3QgY2FsbHMgYXJlIGJhbm5lZCBmcm9tIGJ1eWluZyAKICAgIGZ1bmN0aW9uIEJ1eSh1aW50OCBJRCwgc3RyaW5nIFF1b3RlLCBzdHJpbmcgTmFtZSkgcHVibGljIHBheWFibGUgTm9Db250cmFjdCB7CiAgICAgICAgcmVxdWlyZShJRCA8IE1heEl0ZW1zKTsKICAgICAgICByZXF1aXJlKCFFZGl0TW9kZSk7CiAgICAgICAgLy8gZ2V0IHByaWNlIAogICAgICAgIC8vdWludDggcGlkID0gTWFya2V0W0lEXS5QcmljZUlEOwogICAgICAgIHVpbnQyNTYgcHJpY2UgPSBHZXRQcmljZShNYXJrZXRbSURdLlByaWNlSUQpOwogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHByaWNlKTsKICAgICAgICAKICAgICAgICBpZiAoYmxvY2sudGltZXN0YW1wID4gVGltZXIpewogICAgICAgICAgICBpZiAoVGltZXIgIT0gMCl7IC8vIHRpbWVyIDAgbWVhbnMgd2l0aGRyYXcgaXMgZ29uZTsgd2l0aGRyYXcgd2lsbCB0aHJvdyBvbiAwCiAgICAgICAgICAgICAgICBXaXRoZHJhdygiR2FtZUluaXQiLCAiQWRtaW4iKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyByZXR1cm4gZXhjZXNzIAogICAgICAgIGlmIChtc2cudmFsdWUgPiBwcmljZSl7CiAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIobXNnLnZhbHVlLXByaWNlKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDI1NiBQYXlUYXggPSAocHJpY2UgKiBUYXgpLzEwMDAwOwogICAgICAgIGZlZXNlbmQudHJhbnNmZXIoUGF5VGF4KTsKICAgICAgICB1aW50MjU2IExlZnQgPSAocHJpY2UtUGF5VGF4KTsKICAgICAgICAKICAgICAgICAKICAgICAgICBpZiAoTWFya2V0W0lEXS5QcmljZUlEIT0wKXsKICAgICAgICAgICAgLy8gdW56ZXJvLCBtb3ZlIHRvIHByZXZpb3VzIG93bmVyCiAgICAgICAgICAgIHVpbnQyNTYgcGF5ID0gKExlZnQqUHJldmlvdXNQYXlvdXQpLzEwMDAwOwogICAgICAgICAgICBUb3RhbFBvdCA9IFRvdGFsUG90ICsgKExlZnQtcGF5KTsKICAgICAgICAgICAvLyBMZWZ0PUxlZnQtcGF5OwogICAgICAgICAgICBNYXJrZXRbSURdLkhvbGRlci50cmFuc2ZlcihwYXkpOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICBUb3RhbFBvdCA9IFRvdGFsUG90ICsgTGVmdDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gcmVzZXQgdGltZXI7IAogICAgICAgIFRpbWVyID0gYmxvY2sudGltZXN0YW1wICsgR2V0VGltZShNYXJrZXRbSURdLlByaWNlSUQpOwogICAgICAgIC8vc2V0IGphY2twb3Qgd2lubmVyIAogICAgICAgIEphY2twb3RXaW5uZXIgPSBtc2cuc2VuZGVyOwoKCiAgICAgICAgLy8gZ2l2ZSB1c2VyIG5ldyBjYXJkOyAKICAgICAgICAKICAgICAgICBlbWl0IEl0ZW1Cb3VnaHQoUm91bmROdW1iZXIsSUQsICBwcmljZSwgIE1hcmtldFtJRF0uSG9sZGVyLCBtc2cuc2VuZGVyLCBUaW1lciwgIFRvdGFsUG90LCAgUXVvdGUsIE5hbWUpOwogICAgICAgIAogICAgICAgIERyYXdBZGRyKCk7IC8vIGdpdmUgcGxheWVyIGNhcmRzCiAgICAgICAgCiAgICAgICAgLy8gdXBkYXRlIHByaWNlIAogICAgICAgIE1hcmtldFtJRF0uUHJpY2VJRCsrOwogICAgICAgIC8vc2V0IGhvbGRlciAKICAgICAgICBNYXJrZXRbSURdLkhvbGRlcj1tc2cuc2VuZGVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBHZXRQcmljZSh1aW50OCBpZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nil7CiAgICAgICAgdWludDI1NiBwID0gQmFzZVByaWNlOwogICAgICAgIGlmIChpZCA+IDApewogICAgICAgICAgICAvLyBtYXggcHJpY2UgYmFzZXByaWNlICogaW5jcmVhc2VeMjAgaXMgcmVhc29uYWJsZQogICAgICAgICAgICBmb3IgKHVpbnQgaT0xOyBpPD1pZDsgaSsrKXsKICAgICAgICAgICAgICAgIGlmIChpPT1NQVhQUklDRVBPV0VSKXsKICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gcHJldmVudCBvdmVyZmxvdyAobm90IHN1cmUgd2h5IHNvbWVvbmUgd291bGQgYnV5IGF0IGluY3JlYXNlXjI1NSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHAgPSAocCAqICgxMDAwMCArIEluY3JlYXNlKSkvMTAwMDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIFBheVBva2VyKHN0cmluZyBRdW90ZSwgc3RyaW5nIE5hbWUpIHB1YmxpYyBOb0NvbnRyYWN0ewogICAgICAgIHVpbnQ4IHdpbnMgPSBIYW5kV2lucyhtc2cuc2VuZGVyKTsKICAgICAgICBpZiAod2lucz4wKXsKICAgICAgICAgICAgdWludDI1NiBhdmFpbGFibGVfYmFsYW5jZSA9IChUb3RhbFBvdCpQb3RQYXlvdXQpLzEwMDAwOwogICAgICAgICAgICB1aW50MjU2IHBheW1lbnQgPSBzdWIgKChhdmFpbGFibGVfYmFsYW5jZSAqIFBva2VyUGF5b3V0KS8xMDAwMCAsIFBva2VyUGF5b3V0VmFsdWUpOwogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBQb2tlclBheW91dFZhbHVlID0gUG9rZXJQYXlvdXRWYWx1ZSArIHBheW1lbnQ7CiAgICAgICAgICAgIGlmICh3aW5zPT0xKXsKICAgICAgICAgICAgICAgIG1zZy5zZW5kZXIudHJhbnNmZXIocGF5bWVudCk7CiAgICAgICAgICAgICAgICBlbWl0IFBva2VyUGFpZChSb3VuZE51bWJlciwgcGF5bWVudCwgbXNnLnNlbmRlciwgIFF1b3RlLCAgTmFtZSwgV2lubmluZ0hhbmQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgIGVsc2UgaWYgKHdpbnM9PTIpewogICAgICAgICAgICAgICAgdWludDI1NiBwdmFsID0gcGF5bWVudC8yOwogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihwdmFsKTsKICAgICAgICAgICAgICAgIFBva2VyV2lubmVyLnRyYW5zZmVyKHBheW1lbnQtcHZhbCk7Ly8gc2F2ZXMgMSB3ZWkgZXJyb3IgCiAgICAgICAgICAgICAgICBlbWl0IFBva2VyUGFpZChSb3VuZE51bWJlciwgcHZhbCwgbXNnLnNlbmRlciwgIFF1b3RlLCAgTmFtZSwgV2lubmluZ0hhbmQpOwogICAgICAgICAgICAgICAgZW1pdCBQb2tlclBhaWQoUm91bmROdW1iZXIsIHB2YWwsIG1zZy5zZW5kZXIsICIiLCAiIiwgV2lubmluZ0hhbmQpOwogICAgICAgICAgICB9Ki8KICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgLy8gbmljZSBibHVmZiBtYXRlIAogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIEdldFRpbWUodWludDggaWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpewogICAgICAgIGlmIChpZCA+PSBUaW1lQXJyYXkubGVuZ3RoKXsKICAgICAgICAgICAgcmV0dXJuIFRpbWVBcnJheVtUaW1lQXJyYXkubGVuZ3RoLTFdOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICByZXR1cm4gVGltZUFycmF5W2lkXTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vZnVuY3Rpb24gQ2FsbCgpIHB1YmxpYyB7CiAgIC8vICAgICBEcmF3SG91c2UoKTsKICAgLy8gfQogICAgCiAgICAKICAgIC8vIHBheXMgd2lubmVyLiAKICAgIC8vIGFsc28gc2V0cyB1cCBuZXcgZ2FtZSAKICAgIC8vIHdpbm5lciByZWNlaXZlcyBsb3RzIG9mIGV0aCBjb21wYXJlZCB0byBnYXMgc28gYSBzbWFsbCBwYXltZW50IHRvIGdhcyBpcyByZWFzb25hYmxlLgogICAgCiAgICBmdW5jdGlvbiBXaXRoZHJhdyhzdHJpbmcgUXVvdGUsIHN0cmluZyBOYW1lKSBwdWJsaWMgTm9Db250cmFjdCB7CiAgICAgICAgX3dpdGhkcmF3KFF1b3RlLE5hbWUsZmFsc2UpOwogICAgfQogICAgCiAgICAvLyBpbiBjYXNlIHRoZXJlIGlzIGEgcmV2ZXJ0IGJ1ZyBpbiB0aGUgcG9rZXIgY29udHJhY3QgCiAgICAvLyBhbGxvd3Mgd2lubmVyIHRvIGdldCBwYWlkIHdpdGhvdXQgY2FsbGluZyBwb2tlci4gc2hvdWxkIG5ldmVyIGJlIGNhbGxlZCAKICAgIC8vIGZvbGxvd3MgYWxsIG5vcm1hbCBydWxlcyBvZiBnYW1lIC4KICAgIGZ1bmN0aW9uIFdpdGhkcmF3RW1lcmdlbmN5KCkgcHVibGljIE9ubHlPd25lcnsKICAgICAgICBfd2l0aGRyYXcoIkVtZXJnZW5jeSB3aXRoZHJhdyBjYWxsIiwiQWRtaW4iLHRydWUpOwogICAgfQogICAgZnVuY3Rpb24gX3dpdGhkcmF3KHN0cmluZyBRdW90ZSwgc3RyaW5nIE5hbWUsIGJvb2wgRW1lcmdlbmN5KSBOb0NvbnRyYWN0IGludGVybmFsIHsKICAgICAgICAvLyBTZXR1cCBjYXJkcyBmb3IgbmV3IGdhbWUuIAogICAgICAgIAogICAgICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wID4gVGltZXIgJiYgVGltZXIgIT0gMCk7CiAgICAgICAgVGltZXI9MDsgLy8gcHJldmVudCByZS1lbnRyYW5jeSBpbW1lZGlhdGVseS4gCiAgICAgICAgCiAgICAgICAgLy8gc2VuZCBmcm9tIHRoaXMuYmFsYW5jZSAKICAgICAgICB1aW50MjU2IGF2YWlsYWJsZV9iYWxhbmNlID0gKFRvdGFsUG90KlBvdFBheW91dCkvMTAwMDA7CiAgICAgICAgdWludDI1NiBiYWwgPSAoYXZhaWxhYmxlX2JhbGFuY2UgKiBKYWNrcG90UGF5b3V0KS8xMDAwMDsKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBKYWNrcG90V2lubmVyLnRyYW5zZmVyKGJhbCk7CiAgICAgICAgZW1pdCBKYWNrcG90UGFpZChSb3VuZE51bWJlciwgYmFsLCAgSmFja3BvdFdpbm5lciwgUXVvdGUsIE5hbWUpOwogICAgICAgIAogICAgICAgIC8vIHBheSB0aGUgbGFzdCBwb2tlciB3aW5uZXIgcmVtYWluaW5nIHBva2VyIHBvdC4KICAgICAgICBiYWwgPSBzdWIoc3ViKGF2YWlsYWJsZV9iYWxhbmNlLCBiYWwpLFBva2VyUGF5b3V0VmFsdWUpOwogICAgICAgIGlmIChiYWwgPiAwICYmIFBva2VyV2lubmVyICE9IGFkZHJlc3ModGhpcykpewogICAgICAgICAgICAvLyB0aGlzIG9ubHkgaGFwcGVucyBhdCBzdGFydCBnYW1lLCAgc29tZSB3ZWkgZXJyb3IgCiAgICAgICAgICAgIGlmIChiYWwgPiBhZGRyZXNzKHRoaXMpLmJhbGFuY2UpewogICAgICAgICAgICAgICAgUG9rZXJXaW5uZXIudHJhbnNmZXIoYWRkcmVzcyh0aGlzKS5iYWxhbmNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgUG9rZXJXaW5uZXIudHJhbnNmZXIoYmFsKTsgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgCiAgICAgICAgICAgIGVtaXQgUG9rZXJQYWlkKFJvdW5kTnVtYmVyLCBiYWwsIFBva2VyV2lubmVyLCAgIlBhaWQgb3V0IGxlZnQgcG9rZXIgcG90IiwgIkRlYWxlciIsIFdpbm5pbmdIYW5kKTsKICAgICAgICB9CiAgICAgICAgVG90YWxQb3QgPSBhZGRyZXNzKHRoaXMpLmJhbGFuY2U7CiAgICAKICAgICAgICAvLyBuZXh0IHBva2VyIHBvdCBzdGFydHMgYXQgemVyby4gCiAgICAgICAgUG9rZXJQYXlvdXRWYWx1ZT0gKFRvdGFsUG90ICogUG90UGF5b3V0ICogUG9rZXJQYXlvdXQpLygxMDAwMCoxMDAwMCk7CgogICAgICAgIC8vIHJlc2V0IHByaWNlIAoKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPE1heEl0ZW1zOyBpKyspewogICAgICAgICAgICBNYXJrZXRbaV0uUHJpY2VJRD0wOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoIUVtZXJnZW5jeSl7CiAgICAgICAgICAgIERyYXdIb3VzZSgpOwogICAgICAgIH0KICAgICAgICBSb3VuZE51bWJlcisrOwogICAgICAgIC8vIGVuYWJsZSBlZGl0IG1vZGUgaWYgc2V0IGJ5IGRldi4KICAgICAgICBFZGl0TW9kZT1TZXRFZGl0TW9kZTsKICAgICAgICAKICAgICAgICBlbWl0IE5ld1JvdW5kKCk7CiAgICB9CiAgICAKICAgIC8vIGRldiBlZGl0IGZ1bmN0aW9ucyBiZWxvdyAKICAgIAogICAgCiAgICBmdW5jdGlvbiBzZXRFZGl0TW9kZUJvb2woYm9vbCBlZGl0bW9kZSkgcHVibGljIE9ubHlPd25lciB7CiAgICAgICAgLy8gc3RhcnQgZWRpdCBtb2RlIGNsb3NlcyB0aGUgd2hvbGUgZ2FtZS4gCiAgICAgICAgU2V0RWRpdE1vZGU9ZWRpdG1vZGU7CiAgICAgICAgaWYgKCFlZGl0bW9kZSl7CiAgICAgICAgICAgIC8vIGVuYWJsZSBnYW1lIHJvdW5kLgogICAgICAgICAgICBFZGl0TW9kZT1mYWxzZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGVtZXJnZW5jeURyb3BFdGgoKSBwdWJsaWMgcGF5YWJsZXsKICAgICAgICAvLyBhbnkgd2VpcmQgZXJyb3IgbWlnaHQgYmUgc29sdmVkIGJ5IGRyb3BwaW5nIGV0aCAoYW5kIG5vIHRoaXMgaXMgbm90IGV2ZW4gYSBzY2FtLCBpZiBjb250cmFjdCBuZWVkcyBhIHdlaSBtb3JlLCB3ZSBzZW5kIGEgd2VpLCBnZXQgZnVuZHMgb3V0IGFuZCBmaXggY29udHJhY3QpCiAgICB9CiAgICAgICAgCiAgICBmdW5jdGlvbiBlZGl0VGltZXIodWludDggSUQsIHVpbnQyNTYgVGltZSkgcHVibGljIE9ubHlPd25lciBHYW1lQ2xvc2VkewogICAgICAgIFRpbWVBcnJheVtJRF0gPSBUaW1lOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBlZGl0QmFzZVByaWNlKHVpbnQyNTYgTmV3QmFzZVByaWNlKSBwdWJsaWMgT25seU93bmVyIEdhbWVDbG9zZWR7CiAgICAgICAgQmFzZVByaWNlID0gTmV3QmFzZVByaWNlOyAgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGVkaXRNYXhJdGVtcyh1aW50OCBOZXdNYXgpIHB1YmxpYyBPbmx5T3duZXIgR2FtZUNsb3NlZHsKICAgICAgICBNYXhJdGVtcyA9IE5ld01heDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZWRpdFBheW91dFNldHRpbmcodWludDggc2V0dGluZywgdWludDE2IG5ld3YpIHB1YmxpYyBPbmx5T3duZXIgR2FtZUNsb3NlZHsKICAgICAgICByZXF1aXJlKHNldHRpbmcgPiAwKTsKICAgICAgICBpZiAoc2V0dGluZyA9PSAxKXsKICAgICAgICAgICAgcmVxdWlyZShuZXd2IDw9IDEwMDAwKTsKICAgICAgICAgICAgSmFja3BvdFBheW91dCA9IG5ld3Y7CiAgICAgICAgICAgIFBva2VyUGF5b3V0ID0gMTAwMDAtbmV3djsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoc2V0dGluZyA9PSAyKXsKICAgICAgICAgICAgcmVxdWlyZShuZXd2IDw9IDEwMDAwKTsKICAgICAgICAgICAKICAgICAgICAgICAgUG9rZXJQYXlvdXQgPSBuZXd2OwogICAgICAgICAgICBKYWNrcG90UGF5b3V0ID0gMTAwMDAtbmV3djsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoc2V0dGluZyA9PSAzKXsKICAgICAgICAgICAgcmVxdWlyZSAobmV3diA8PSAxMDAwMCk7CiAgICAgICAgICAgIFByZXZpb3VzUGF5b3V0ID0gbmV3djsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoc2V0dGluZyA9PSA0KXsKICAgICAgICAgICAgcmVxdWlyZShuZXd2IDw9IDMwMDAwKTsKICAgICAgICAgICAgSW5jcmVhc2UgPSBuZXd2OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChzZXR0aW5nID09IDUpewogICAgICAgICAgICByZXF1aXJlKG5ld3YgPD0xMDAwMCk7CiAgICAgICAgICAgIFBvdFBheW91dCA9IG5ld3Y7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHNldHRpbmcgPT0gNil7CiAgICAgICAgICAgIHJlcXVpcmUobmV3diA8IDcwMCk7CiAgICAgICAgICAgIFRheCA9IG5ld3Y7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgIH0KICAgIH0KICAgIAogIGZ1bmN0aW9uIG11bCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYSA9PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIC8qKgogICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAqLwogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IFN1YnN0cmFjdHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdyAoaS5lLiBpZiBzdWJ0cmFoZW5kIGlzIGdyZWF0ZXIgdGhhbiBtaW51ZW5kKS4KICAqLwogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIC8qKgogICogQGRldiBBZGRzIHR3byBudW1iZXJzLCB0aHJvd3Mgb24gb3ZlcmZsb3cuCiAgKi8KICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSArIGI7CiAgICBhc3NlcnQoYyA+PSBhKTsKICAgIHJldHVybiBjOwogIH0KfQ=='.
	

]
