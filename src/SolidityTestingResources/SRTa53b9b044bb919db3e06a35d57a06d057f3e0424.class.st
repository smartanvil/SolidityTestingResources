Class {
	#name : #SRTa53b9b044bb919db3e06a35d57a06d057f3e0424,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa53b9b044bb919db3e06a35d57a06d057f3e0424 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyA9PT09IERJU0NMQUlNRVIgPT09PQovLwovLyBFVEhFUkVVTSBJUyBTVElMTCBBTiBFWFBFUkVNRU5UQUwgVEVDSE5PTE9HWS4KLy8gQUxUSE9VR0ggVEhJUyBTTUFSVCBDT05UUkFDVCBXQVMgQ1JFQVRFRCBXSVRIIEdSRUFUIENBUkUgQU5EIElOIFRIRSBIT1BFIE9GIEJFSU5HIFVTRUZVTCwgTk8gR1VBUkFOVEVFUyBPRiBGTEFXTEVTUyBPUEVSQVRJT04gQ0FOIEJFIEdJVkVOLgovLyBJTiBQQVJUSUNVTEFSIC0gU1VCVElMRSBCVUdTLCBIQUNLRVIgQVRUQUNLUyBPUiBNQUxGVU5DVElPTiBPRiBVTkRFUkxZSU5HIFRFQ0hOT0xPR1kgQ0FOIENBVVNFIFVOSU5URU5USU9OQUwgQkVIQVZJT1VSLgovLyBZT1UgQVJFIFNUUk9OR0xZIEVOQ09VUkFHRUQgVE8gU1RVRFkgVEhJUyBTTUFSVCBDT05UUkFDVCBDQVJFRlVMTFkgSU4gT1JERVIgVE8gVU5ERVJTVEFORCBQT1NTSUJMRSBFREdFIENBU0VTIEFORCBSSVNLUy4KLy8gRE9OJ1QgVVNFIFRISVMgU01BUlQgQ09OVFJBQ1QgSUYgWU9VIEhBVkUgU1VCU1RBTlRJQUwgRE9VQlRTIE9SIElGIFlPVSBET04nVCBLTk9XIFdIQVQgWU9VIEFSRSBET0lORy4KLy8KLy8gVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQovLyBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsCi8vIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsCi8vIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLAovLyBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgovLyA9PT09Ci8vCgovLy8gQGF1dGhvciBldGhlcm5pYW4gZm9yIFNhbnRpbWVudCBMTEMKLy8vIEB0aXRsZSAgU3Vic2NyaXB0aW9uIE1vZHVsZSBmb3IgU0FOIC0gc2FudGltZW50IHRva2VuCi8vLyBAbm90aWNlIHJlcG9ydCBidWdzIHRvOiA8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMmE0ODVmNGQ1OTZhNGY1ZTQyNGY1ODQ0NDM0YjQ0MDQ0OTQ1NDciPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Cgpjb250cmFjdCBCYXNlIHsKCiAgICBmdW5jdGlvbiBtYXgodWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIGEgPj0gYiA/IGEgOiBiOyB9CiAgICBmdW5jdGlvbiBtaW4odWludCBhLCB1aW50IGIpIHJldHVybnMgKHVpbnQpIHsgcmV0dXJuIGEgPD0gYiA/IGEgOiBiOyB9CgogICAgbW9kaWZpZXIgb25seShhZGRyZXNzIGFsbG93ZWQpIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBhbGxvd2VkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKCiAgICAvLy9AcmV0dXJuIFRydWUgaWYgYF9hZGRyYCBpcyBhIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBpc0NvbnRyYWN0KGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoX2FkZHIgPT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHVpbnQgc2l6ZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiAoc2l6ZSA+IDApOwogICAgfQoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgcmVlbnRyYW5jeSBoYW5kbGluZyAgICAgICAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvL0BkZXYgcHJlZGVmaW5lZCBsb2NrcyAodXAgdG8gdWludCBiaXQgbGVuZ3RoLCBpLmUuIDI1NiBwb3NzaWJsZSkKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAwID0gMiAqKiAwOwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDEgPSAyICoqIDE7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwMiA9IDIgKiogMjsKICAgIHVpbnQgY29uc3RhbnQgaW50ZXJuYWwgTDAzID0gMiAqKiAzOwogICAgdWludCBjb25zdGFudCBpbnRlcm5hbCBMMDQgPSAyICoqIDQ7CiAgICB1aW50IGNvbnN0YW50IGludGVybmFsIEwwNSA9IDIgKiogNTsKCiAgICAvL3ByZXZlbnRzIHJlZW50cmFuY3kgYXR0YWNzOiBzcGVjaWZpYyBsb2NrcwogICAgdWludCBwcml2YXRlIGJpdGxvY2tzID0gMDsKICAgIG1vZGlmaWVyIG5vUmVlbnRyYW5jeSh1aW50IG0pIHsKICAgICAgICB2YXIgX2xvY2tzID0gYml0bG9ja3M7CiAgICAgICAgaWYgKF9sb2NrcyAmIG0gPiAwKSB0aHJvdzsKICAgICAgICBiaXRsb2NrcyB8PSBtOwogICAgICAgIF87CiAgICAgICAgYml0bG9ja3MgPSBfbG9ja3M7CiAgICB9CgogICAgbW9kaWZpZXIgbm9BbnlSZWVudHJhbmN5IHsKICAgICAgICB2YXIgX2xvY2tzID0gYml0bG9ja3M7CiAgICAgICAgaWYgKF9sb2NrcyA+IDApIHRocm93OwogICAgICAgIGJpdGxvY2tzID0gdWludCgtMSk7CiAgICAgICAgXzsKICAgICAgICBiaXRsb2NrcyA9IF9sb2NrczsKICAgIH0KCiAgICAvLy9AZGV2IGVtcHR5IG1hcmtpbmcgbW9kaWZpZXIgc2lnbmFsaW5nIHRvIHVzZXIgb2YgdGhlIG1hcmtlZCBmdW5jdGlvbiAsIHRoYXQgaXQgY2FuIGNhdXNlIGFuIHJlZW50cmFudCBjYWxsLgogICAgLy8vICAgICBkZXZlbG9wZXIgc2hvdWxkIG1ha2UgdGhlIGNhbGxlciBmdW5jdGlvbiByZWVudHJhbnQtc2FmZSBpZiBpdCB1c2UgYSByZWVudHJhbnQgZnVuY3Rpb24uCiAgICBtb2RpZmllciByZWVudHJhbnQgeyBfOyB9Cgp9Cgpjb250cmFjdCBPd25lZCBpcyBCYXNlIHsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIGFkZHJlc3MgcHVibGljIG5ld093bmVyOwoKICAgIGZ1bmN0aW9uIE93bmVkKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgb25seShvd25lcikgewogICAgICAgIG5ld093bmVyID0gX25ld093bmVyOwogICAgfQoKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIG9ubHkobmV3T3duZXIpIHsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CgogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvKTsKCn0KCgpjb250cmFjdCBFUkMyMCBpcyBPd25lZCB7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW21zZy5zZW5kZXJdID49IF92YWx1ZSAmJiBiYWxhbmNlc1tfdG9dICsgX3ZhbHVlID4gYmFsYW5jZXNbX3RvXSkgewogICAgICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGlzU3RhcnRlZE9ubHkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKGJhbGFuY2VzW19mcm9tXSA+PSBfdmFsdWUgJiYgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPj0gX3ZhbHVlICYmIGJhbGFuY2VzW190b10gKyBfdmFsdWUgPiBiYWxhbmNlc1tfdG9dKSB7CiAgICAgICAgICAgIGJhbGFuY2VzW190b10gKz0gX3ZhbHVlOwogICAgICAgICAgICBiYWxhbmNlc1tfZnJvbV0gLT0gX3ZhbHVlOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfdmFsdWU7CiAgICAgICAgICAgIFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQogICAgfQoKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VzW19vd25lcl07CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgaXNTdGFydGVkT25seSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IF92YWx1ZTsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICAgICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgICB9CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICAgIGJvb2wgICAgcHVibGljIGlzU3RhcnRlZCA9IGZhbHNlOwoKICAgIG1vZGlmaWVyIG9ubHlIb2xkZXIoYWRkcmVzcyBob2xkZXIpIHsKICAgICAgICBpZiAoYmFsYW5jZU9mKGhvbGRlcikgPT0gMCkgdGhyb3c7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBpc1N0YXJ0ZWRPbmx5KCkgewogICAgICAgIGlmICghaXNTdGFydGVkKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKfQoKLy9EZWNpc2lvbiBtYWRlLgovLyAxIC0gUHJvdmlkZXIgaXMgc29sZWx5IHJlc3BvbnNpYmxlIHRvIGNvbnNpZGVyIGZhaWxlZCBzdWIgY2hhcmdlIGFzIGFuIGVycm9yIGFuZCBzdG9wIHRoZSBzZXJ2aWNlLAovLyAgICB0aGVyZWZvcmUgdGhlcmUgaXMgbm8gc2VwYXJhdGUgZXJyb3Igc3RhdGUgb3IgY291bnRlciBmb3IgdGhhdCBpbiB0aGlzIFRva2VuIENvbnRyYWN0LgovLwovLyAyIC0gQSBjYWxsIG9yaWdpbmF0ZWQgZnJvbSB0aGUgdXNlciAoaXNDb250cmFjdChtc2cuc2VuZGVyKT09ZmFsc2UpIHNob3VsZCB0aHJvdyBhbiBleGNlcHRpb24gb24gZXJyb3IsCi8vICAgICBidXQgaXQgc2hvdWxkIHJldHVybiAiZmFsc2UiIG9uIGVycm9yIGlmIGNhbGxlZCBmcm9tIG90aGVyIGNvbnRyYWN0IChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpPT10cnVlKS4KLy8gICAgIFJlYXNvbjogdGhyb3duIGV4Y2VwdGlvbiBhcmUgZWFzaWVyIHRvIHNlZSBpbiB3YWxsZXRzLCByZXR1cm5lZCBib29sZWFuIHZhbHVlcyBhcmUgZWFzaWVyIHRvIGV2YWx1YXRlIGluIHRoZSBjb2RlIG9mIHRoZSBjYWxsaW5nIGNvbnRyYWN0LgovLwovLyAzIC0gU2VydmljZSBwcm92aWRlcnMgYXJlIHJlc3BvbnNpYmxlIGZvciBmaXJpbmcgZXZlbnRzIGluIGNhc2Ugb2Ygb2ZmZXIgY2hhbmdlczsKLy8gICAgIGl0IGlzIHRoZWlycyBkZWNpc2lvbiB0byBpbmZvcm0gREFwcHMgYWJvdXQgb2ZmZXIgY2hhbmdlcyBvciBub3QuCi8vCgoKLy8vQGRldiBhbiBiYXNlIGNsYXNzIHRvIGltcGxlbWVudCBieSBTZXJ2aWNlIFByb3ZpZGVyIGNvbnRyYWN0IHRvIGJlIG5vdGlmaWVkIGFib3V0IHN1YnNjcmlwdGlvbiBjaGFuZ2VzIChpbi1UeCBub3RpZmljYXRpb24pLgovLy8gICAgIEFkZGl0aW9uYWxseSBpdCBjb250YWlucyBzdGFuZGFyZCBldmVudHMgdG8gYmUgZmlyZWQgYnkgc2VydmljZSBwcm92aWRlciBvbiBvZmZlciBjaGFuZ2VzLgovLy8gICAgIHNlZSBhbHNlIEVWTSBldmVudHMgbG9nZ2VkIGJ5IHN1YnNjcmlwdGlvbiBtb2R1bGUuCi8vCmNvbnRyYWN0IFNlcnZpY2VQcm92aWRlciB7CgogICAgLy8vQGRldiBnZXQgaHVtYW4gcmVhZGFibGUgZGVzY3JpcHRvciAob3IgdXJsKSBmb3IgdGhpcyBTZXJ2aWNlIHByb3ZpZGVyCiAgICAvLwogICAgZnVuY3Rpb24gaW5mbygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHN0cmluZyk7CgogICAgLy8vQGRldiBjYWxsZWQgdG8gcG9zdC1hcHByb3ZlL3JlamVjdCBpbmNvbWluZyBzaW5nbGUgcGF5bWVudC4KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBwYXltZW50LgogICAgLy8KICAgIGZ1bmN0aW9uIG9uUGF5bWVudChhZGRyZXNzIF9mcm9tLCB1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vQGRldiBjYWxsZWQgdG8gcG9zdC1hcHByb3ZlL3JlamVjdCBzdWJzY3JpcHRpb24gY2hhcmdlLgogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4KICAgIC8vCiAgICBmdW5jdGlvbiBvblN1YkV4ZWN1dGVkKHVpbnQgc3ViSWQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCiAgICAvLy9AZGV2IGNhbGxlZCB0byBwb3N0LWFwcHJvdmUvcmVqZWN0IGEgY3JlYXRpb24gb2YgdGhlIHN1YnNjcmlwdGlvbi4KICAgIC8vL0ByZXR1cm4gYGZhbHNlYCBjYXVzZXMgYW4gZXhjZXB0aW9uIGFuZCByZXZlcnRzIHRoZSBvcGVyYXRpb24uCiAgICAvLwogICAgZnVuY3Rpb24gb25TdWJOZXcodWludCBuZXdTdWJJZCwgdWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CgogICAgLy8vQGRldiBjYWxsZWQgdG8gbm90aWZ5IHNlcnZpY2UgcHJvdmlkZXIgYWJvdXQgc3Vic2NyaXB0aW9uIGNhbmNlbGxhdGlvbi4KICAgIC8vLyAgICAgUHJvdmlkZXIgaXMgbm90IGFibGUgdG8gcHJldmVudCB0aGUgY2FuY2VsbGF0aW9uLgogICAgLy8vQHJldHVybiA8PHJlc2VydmVkIGZvciBmdXR1cmUgaW1wbGVtZW50YXRpb24+PgogICAgLy8KICAgIGZ1bmN0aW9uIG9uU3ViQ2FuY2VsZWQodWludCBzdWJJZCwgYWRkcmVzcyBjYWxsZXIpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCiAgICAvLy9AZGV2IGNhbGxlZCB0byBub3RpZnkgc2VydmljZSBwcm92aWRlciBhYm91dCBzdWJzY3JpcHRpb24gZ290IGhvbGQvdW5ob2xkLgogICAgLy8vQHJldHVybiBgZmFsc2VgIGNhdXNlcyBhbiBleGNlcHRpb24gYW5kIHJldmVydHMgdGhlIG9wZXJhdGlvbi4KICAgIC8vCiAgICBmdW5jdGlvbiBvblN1YlVuSG9sZCh1aW50IHN1YklkLCBhZGRyZXNzIGNhbGxlciwgYm9vbCBpc09uSG9sZCkgcHVibGljIHJldHVybnMgKGJvb2wpOwoKCiAgICAvLy9AZGV2IGZvbGxvd2luZyBldmVudHMgc2hvdWxkIGJlIHVzZWQgYnkgU2VydmljZVByb3ZpZGVyIGNvbnRyYWN0IHRvIG5vdGlmeSBEQXBwcyBhYm91dCBvZmZlciBjaGFuZ2VzLgogICAgLy8vICAgICBTdWJzY3JpcHRpb25Nb2R1bGUgZG8gbm90IHRoaXMgbm90aWZpY2F0aW9uIGFuZCBleHBlY3RzIGl0IGZyb20gU2VydmljZSBQcm92aWRlciBpZiBkZXNpcmVkLgogICAgLy8vCiAgICAvLy9AZGV2IHRvIGJlIGZpcmVkIGJ5IFNlcnZpY2VQcm92aWRlciBvbiBuZXcgT2ZmZXIgY3JlYXRlZCBpbiBhIHBsYXRmb3JtLgogICAgZXZlbnQgT2ZmZXJDcmVhdGVkKHVpbnQgb2ZmZXJJZCwgIGJ5dGVzIGRlc2NyaXB0b3IsIGFkZHJlc3MgcHJvdmlkZXIpOwoKICAgIC8vL0BkZXYgdG8gYmUgZmlyZWQgYnkgU2VydmljZVByb3ZpZGVyIG9uIE9mZmVyIHVwZGF0ZWQuCiAgICBldmVudCBPZmZlclVwZGF0ZWQodWludCBvZmZlcklkLCAgYnl0ZXMgZGVzY3JpcHRvciwgdWludCBvbGRFeGVjQ291bnRlciwgYWRkcmVzcyBwcm92aWRlcik7CgogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgY2FuY2VsZWQuCiAgICBldmVudCBPZmZlckNhbmNlbGVkKHVpbnQgb2ZmZXJJZCwgYnl0ZXMgZGVzY3JpcHRvciwgYWRkcmVzcyBwcm92aWRlcik7CgogICAgLy8vQGRldiB0byBiZSBmaXJlZCBieSBTZXJ2aWNlUHJvdmlkZXIgb24gT2ZmZXIgaG9sZC91bmhvbGQgc3RhdHVzIGNoYW5nZWQuCiAgICBldmVudCBPZmZlclVuSG9sZCh1aW50IG9mZmVySWQsICAgYnl0ZXMgZGVzY3JpcHRvciwgYm9vbCBpc09uSG9sZE5vdywgYWRkcmVzcyBwcm92aWRlcik7Cn0gLy9TZXJ2aWNlUHJvdmlkZXIKCi8vL0Bub3RpY2UgWFJhdGVQcm92aWRlciBpcyBhbiBleHRlcm5hbCBzZXJ2aWNlIHByb3ZpZGluZyBhbiBleGNoYW5nZSByYXRlIGZyb20gZXh0ZXJuYWwgY3VycmVuY3kgdG8gU0FOIHRva2VuLgovLy8gaXQgdXNlZCBmb3Igc3Vic2NyaXB0aW9ucyBwcmljZWQgaW4gb3RoZXIgY3VycmVuY3kgdGhhbiBTQU4gKGV2ZW4gY2FsY3VsYXRlZCBhbmQgcGFpZCBmb3JtYWxseSBpbiBTQU4pLgovLy8gaWYgbm9uLWRlZmF1bHQgWFJhdGVQcm92aWRlciBpcyBzZXQgZm9yIHNvbWUgc3Vic2NyaXB0aW9uLCB0aGVuIHRoZSBhbW91bnQgaW4gU0FOIGZvciBldmVyeSBwZXJpb2RpYyBwYXltZW50Ci8vLyB3aWxsIGJlIHJlY2FsY3VsYXRlZCB1c2luZyBwcm92aWRlZCBleGNoYW5nZSByYXRlLgovLy8KLy8vIFBsZWFzZSBub3RlLCB0aGF0IHRoZSBleGNoYW5nZSByYXRlIGZyYWN0aW9uIGlzICh1aW50MzIsdWludDMyKSBudW1iZXIuIEl0IHNob3VsZCBiZSBlbm91Z2ggdG8gZXhwcmVzcwovLy8gYW55IHJlYWwgZXhjaGFuZ2UgcmF0ZSB2b2xhdGlsaXR5LiBOZXZlcnRoZWxlc3MgeW91IGFyZSBhZHZpc2VkIHRvIGF2b2lkIHRvbyBiaWcgbnVtYmVycyBpbiB0aGUgZnJhY3Rpb24uCi8vLyBQb3NzaWlibHkgeW91IGNvdWxkIGltcGxlbWVudCB0aGUgcmF0aW8gb2YgbXVsdGlwbGUgdG9rZW4gcGVyIFNBTiBpbiBvcmRlciB0byBrZWVwIHRoZSBhdmVyYWdlIHJhdGlvIGFyb3VuZCAxOjEuCi8vLwovLy8gVGhlIGRlZmF1bHQgWFJhdGVQcm92aWRlciAod2l0aCBpZD09MCkgZGVmaW5lcyBleGNoYW5nZSByYXRlIDE6MSBhbmQgcmVwcmVzZW50cyBleGNoYW5nZSByYXRlIG9mIFNBTiB0b2tlbiB0byBpdHNlbGYuCi8vLyB0aGlzIHByb3ZpZGVyIGlzIHNldCBieSBkZWZhbHVsdCBhbmQgdGh1cyB0aGUgc3Vic2NyaXB0aW9uIGJlY29tZXMgbm9taW5hdGVkIGluIFNBTi4KLy8KY29udHJhY3QgWFJhdGVQcm92aWRlciB7CgogICAgLy9AZGV2IHJldHVybnMgY3VycmVudCBleGNoYW5nZSByYXRlIChpbiBmb3JtIG9mIGEgc2ltcGxlIGZyYWN0aW9uKSBmcm9tIG90aGVyIGN1cnJlbmN5IHRvIFNBTiAoZi5lLiBFVEg6U0FOKS4KICAgIC8vQGRldiBmcmFjdGlvbiBudW1iZXJzIGFyZSByZXN0cmljdGVkIHRvIHVpbnQxNiB0byBwcmV2ZW50IG92ZXJmbG93IGluIGNhbGN1bGF0aW9uczsKICAgIGZ1bmN0aW9uIGdldFJhdGUoKSBwdWJsaWMgcmV0dXJucyAodWludDMyIC8qbm9taW5hdG9yKi8sIHVpbnQzMiAvKmRlbm9taW5hdG9yKi8pOwoKICAgIC8vQGRldiBwcm92aWRlcyBhIGNvZGUgZm9yIGFub3RoZXIgY3VycmVuY3ksIGYuZS4gIkVUSCIgb3IgIlVTRCIKICAgIGZ1bmN0aW9uIGdldENvZGUoKSBwdWJsaWMgcmV0dXJucyAoc3RyaW5nKTsKfQoKCi8vQGRldiBkYXRhIHN0cnVjdHVyZSBmb3IgU3Vic2NyaXB0aW9uTW9kdWxlCmNvbnRyYWN0IFN1YnNjcmlwdGlvbkJhc2UgewoKICAgIGVudW0gU3ViU3RhdGUgICB7Tk9UX0VYSVNULCBCRUZPUkVfU1RBUlQsIFBBSUQsIENIQVJHRUFCTEUsIE9OX0hPTEQsIENBTkNFTEVELCBFWFBJUkVELCBGSU5BTElaRUR9CiAgICBlbnVtIE9mZmVyU3RhdGUge05PVF9FWElTVCwgQkVGT1JFX1NUQVJULCBBQ1RJVkUsIFNPTERfT1VULCBPTl9IT0xELCBFWFBJUkVEfQoKICAgIHN0cmluZ1tdIGludGVybmFsIFNVQl9TVEFURVMgICA9IFsiTk9UX0VYSVNUIiwgIkJFRk9SRV9TVEFSVCIsICJQQUlEIiwgIkNIQVJHRUFCTEUiLCAiT05fSE9MRCIsICJDQU5DRUxFRCIsICJFWFBJUkVEIiwgIkZJTkFMSVpFRCIgXTsKICAgIHN0cmluZ1tdIGludGVybmFsIE9GRkVSX1NUQVRFUyA9IFsiTk9UX0VYSVNUIiwgIkJFRk9SRV9TVEFSVCIsICJBQ1RJVkUiLCAiU09MRF9PVVQiLCAiT05fSE9MRCIsICJFWFBJUkVEIl07CgogICAgLy9AZGV2IHN1YnNjcmlwdGlvbiBhbmQgc3Vic2NyaXB0aW9uIG9mZmVyIHVzZSB0aGUgc2FtZSBzdHJ1Y3R1cmUuIE9mZmVyIGlzIHRlY2huaWNhbGx5IGEgdGVtcGxhdGUgZm9yIHN1YnNjcmlwdGlvbi4KICAgIHN0cnVjdCBTdWJzY3JpcHRpb24gewogICAgICAgIGFkZHJlc3MgdHJhbnNmZXJGcm9tOyAgIC8vIGN1c3RvbWVyICh1bnNldCBpbiBzdWJzY3JpcHRpb24gb2ZmZXIpCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvOyAgICAgLy8gc2VydmljZSBwcm92aWRlcgogICAgICAgIHVpbnQgcHJpY2VQZXJIb3VyOyAgICAgIC8vIHByaWNlIGluIFNBTiBwZXIgaG91ciAocG9zc2libHkgcmVjYWxjdWxhdGVkIHVzaW5nIGV4Y2hhbmdlIHJhdGUpCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9uOyAgLy8gbm9taW5hdG9yCiAgICAgICAgdWludDMyIGluaXRpYWxYcmF0ZV9kOyAgLy8gZGVub21pbmF0b3IKICAgICAgICB1aW50MTYgeHJhdGVQcm92aWRlcklkOyAvLyBpZCBvZiBhIHJlZ2lzdGVyZWQgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlcgogICAgICAgIHVpbnQgcGFpZFVudGlsOyAgICAgICAgIC8vIHN1YnNjcmlwdGlvbiBpcyBwYWlkIHVudGlsIHRpbWUKICAgICAgICB1aW50IGNoYXJnZVBlcmlvZDsgICAgICAvLyBzdWJzY3JpcHRpb24gY2FuJ3QgYmUgY2hhcmdlZCBtb3JlIG9mdGVuIHRoYW4gdGhpcyBwZXJpb2QKICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQ7ICAgICAvLyB1cGZyb250IGRlcG9zaXQgb24gY3JlYXRpbmcgc3Vic2NyaXB0aW9uIChwb3NzaWJseSByZWNhbGN1bGF0ZWQgdXNpbmcgZXhjaGFuZ2UgcmF0ZSkKCiAgICAgICAgdWludCBzdGFydE9uOyAgICAgICAgICAgLy8gZm9yIG9mZmVyOiBjYW4ndCBiZSBhY2NlcHRlZCBiZWZvcmUgIDxzdGFydE9uPiA7IGZvciBzdWJzY3JpcHRpb246IGNhbid0IGJlIGNoYXJnZWQgYmVmb3JlIDxzdGFydE9uPgogICAgICAgIHVpbnQgZXhwaXJlT247ICAgICAgICAgIC8vIGZvciBvZmZlcjogY2FuJ3QgYmUgYWNjZXB0ZWQgYWZ0ZXIgIDxleHBpcmVPbj4gOyBmb3Igc3Vic2NyaXB0aW9uOiBjYW4ndCBiZSBjaGFyZ2VkIGFmdGVyICA8ZXhwaXJlT24+CiAgICAgICAgdWludCBleGVjQ291bnRlcjsgICAgICAgLy8gZm9yIG9mZmVyOiBtYXggbnVtIG9mIHN1YnNjcmlwdGlvbnMgYXZhaWxhYmxlICA7IGZvciBzdWJzY3JpcHRpb246IG51bSBvZiBjaGFyZ2VzIG1hZGUuCiAgICAgICAgYnl0ZXMgZGVzY3JpcHRvcjsgICAgICAgLy8gc3Vic2NyaXB0aW9uIHBheWxvYWQgKHN1YmplY3QpOiBldmFsdWF0ZWQgYnkgc2VydmljZSBwcm92aWRlci4KICAgICAgICB1aW50IG9uSG9sZFNpbmNlOyAgICAgICAvLyBzdWJzY3JpcHRpb246IG9uLWhvbGQgc2luY2UgdGltZSBvciAwIGlmIG5vdCBvbkhvbGQuIG9mZmVyOiB1bnVzZWQ6IC8vVG9EbzogdG8gYmUgaW1wbGVtZW50ZWQKICAgIH0KCiAgICBzdHJ1Y3QgRGVwb3NpdCB7CiAgICAgICAgdWludCB2YWx1ZTsgICAgICAgICAvLyB2YWx1ZSBvbiBkZXBvc2l0CiAgICAgICAgYWRkcmVzcyBvd25lcjsgICAgICAvLyB1c3VhbGx5IGEgY3VzdG9tZXIKICAgICAgICB1aW50IGNyZWF0ZWRPbjsgICAgIC8vIGRlcG9zaXQgY3JlYXRlZCB0aW1lc3RhbXAKICAgICAgICB1aW50IGxvY2tUaW1lOyAgICAgIC8vIGRlcG9zaXQgbG9ja2VkIGZvciB0aW1lIHBlcmlvZAogICAgICAgIGJ5dGVzIGRlc2NyaXB0b3I7ICAgLy8gc2VydmljZSByZWxhdGVkIGRlc2NyaXB0b3IgdG8gYmUgZXZhbHVhdGVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIKICAgIH0KCiAgICBldmVudCBOZXdTdWJzY3JpcHRpb24oYWRkcmVzcyBjdXN0b21lciwgYWRkcmVzcyBzZXJ2aWNlLCB1aW50IG9mZmVySWQsIHVpbnQgc3ViSWQpOwogICAgZXZlbnQgTmV3RGVwb3NpdCh1aW50IGRlcG9zaXRJZCwgdWludCB2YWx1ZSwgdWludCBsb2NrVGltZSwgYWRkcmVzcyBzZW5kZXIpOwogICAgZXZlbnQgTmV3WFJhdGVQcm92aWRlcihhZGRyZXNzIGFkZHIsIHVpbnQxNiB4UmF0ZVByb3ZpZGVySWQsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IERlcG9zaXRSZXR1cm5lZCh1aW50IGRlcG9zaXRJZCwgYWRkcmVzcyByZXR1cm5lZFRvKTsKICAgIGV2ZW50IFN1YnNjcmlwdGlvbkRlcG9zaXRSZXR1cm5lZCh1aW50IHN1YklkLCB1aW50IGFtb3VudCwgYWRkcmVzcyByZXR1cm5lZFRvLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBPZmZlck9uSG9sZCh1aW50IG9mZmVySWQsIGJvb2wgb25Ib2xkLCBhZGRyZXNzIHNlbmRlcik7CiAgICBldmVudCBPZmZlckNhbmNlbGVkKHVpbnQgb2ZmZXJJZCwgYWRkcmVzcyBzZW5kZXIpOwogICAgZXZlbnQgU3ViT25Ib2xkKHVpbnQgb2ZmZXJJZCwgYm9vbCBvbkhvbGQsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IFN1YkNhbmNlbGVkKHVpbnQgc3ViSWQsIGFkZHJlc3Mgc2VuZGVyKTsKICAgIGV2ZW50IFN1Yk1vZHVsZVN1c3BlbmRlZCh1aW50IHN1c3BlbmRVbnRpbCk7Cgp9CgovLy9AZGV2IGFuIEludGVyZmFjZSBmb3IgU3Vic2NyaXB0aW9uTW9kdWxlLgovLy8gICAgIGV4dHJhY3RlZCBoZXJlIGZvciBiZXR0ZXIgb3ZlcnZpZXcuCi8vLyAgICAgc2VlIGRldGFpbGVkIGRvY3VtZW50YXRpb24gaW4gaW1wbGVtZW50YXRpb24gbW9kdWxlLgpjb250cmFjdCBTdWJzY3JpcHRpb25Nb2R1bGUgaXMgU3Vic2NyaXB0aW9uQmFzZSwgQmFzZSB7CgogICAgLy8vQGRldiAqKioqKiBtb2R1bGUgY29uZmlndXJhdGlvbiAqKioqKgogICAgZnVuY3Rpb24gYXR0YWNoVG9rZW4oYWRkcmVzcyB0b2tlbikgcHVibGljOwoKICAgIC8vL0BkZXYgKioqKiogc2luZ2xlIHBheW1lbnQgaGFuZGxpbmcgKioqKioKICAgIGZ1bmN0aW9uIHBheW1lbnRUbyh1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhLCBTZXJ2aWNlUHJvdmlkZXIgX3RvKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBwYXltZW50RnJvbSh1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhLCBhZGRyZXNzIF9mcm9tLCBTZXJ2aWNlUHJvdmlkZXIgX3RvKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vQGRldiAqKioqKiBzdWJzY3JpcHRpb24gaGFuZGxpbmcgKioqKioKICAgIC8vL0BkZXYgc29tZSBmdW5jdGlvbnMgYXJlIG1hcmtlZCBhcyByZWVudHJhbnQsIGV2ZW4gdGhlaXJzIGltcGxlbWVudGF0aW9uIGlzIG1hcmtlZCB3aXRoIG5vUmVlbnRyYW5jeShMT0NLKS4KICAgIC8vLyAgICAgVGhpcyBpcyBpbnRlbnRpb25hbGx5IGJlY2F1c2UgdGhlc2Ugbm9SZWVudHJhbmN5KExPQ0spIHJlc3RyaWN0aW9ucyBjYW4gYmUgbGlmdGVkIGluIHRoZSBmdXR1cmUuCiAgICAvLyAgICAgIEZ1bmN0aW9ucyB3b3VsZCBiZWNvbWUgcmVlbnRyYW50LgogICAgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uKHVpbnQgX29mZmVySWQsIHVpbnQgX2V4cGlyZU9uLCB1aW50IF9zdGFydE9uKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKHVpbnQgbmV3U3ViSWQpOwogICAgZnVuY3Rpb24gY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHJlZW50cmFudCBwdWJsaWM7CiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKSByZWVudHJhbnQgcHVibGljOwogICAgZnVuY3Rpb24gaG9sZFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1bmhvbGRTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZXhlY3V0ZVN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBwb3N0cG9uZUR1ZURhdGUodWludCBzdWJJZCwgdWludCBuZXdEdWVEYXRlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGNsYWltU3Vic2NyaXB0aW9uRGVwb3NpdCh1aW50IHN1YklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBzdGF0ZSh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcgc3RhdGUpOwogICAgZnVuY3Rpb24gc3RhdGVDb2RlKHVpbnQgc3ViSWQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQgc3RhdGVDb2RlKTsKCiAgICAvLy9AZGV2ICoqKioqIHN1YnNjcmlwdGlvbiBvZmZlciBoYW5kbGluZyAqKioqKgogICAgZnVuY3Rpb24gY3JlYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfcHJpY2UsIHVpbnQxNiBfeHJhdGVQcm92aWRlcklkLCB1aW50IF9jaGFyZ2VQZXJpb2QsIHVpbnQgX2V4cGlyZU9uLCB1aW50IF9vZmZlckxpbWl0LCB1aW50IF9kZXBvc2l0VmFsdWUsIHVpbnQgX3N0YXJ0T24sIGJ5dGVzIF9kZXNjcmlwdG9yKSBwdWJsaWMgcmVlbnRyYW50IHJldHVybnMgKHVpbnQgc3ViSWQpOwogICAgZnVuY3Rpb24gdXBkYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkLCB1aW50IF9vZmZlckxpbWl0KSBwdWJsaWM7CiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyByZXR1cm5zIChib29sKTsKCiAgICAvLy9AZGV2ICoqKioqIHNpbXBsZSBkZXBvc2l0IGhhbmRsaW5nICoqKioqCiAgICBmdW5jdGlvbiBjcmVhdGVEZXBvc2l0KHVpbnQgX3ZhbHVlLCB1aW50IGxvY2tUaW1lLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIHJldHVybnMgKHVpbnQgc3ViSWQpOwogICAgZnVuY3Rpb24gY2xhaW1EZXBvc2l0KHVpbnQgZGVwb3NpdElkKSBwdWJsaWM7CgogICAgLy8vQGRldiAqKioqKiBFeGNoYW5nZVJhdGUgcHJvdmlkZXIgKioqKioKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyWFJhdGVQcm92aWRlcihYUmF0ZVByb3ZpZGVyIGFkZHIpIHB1YmxpYyByZXR1cm5zICh1aW50MTYgeHJhdGVQcm92aWRlcklkKTsKCiAgICAvLy9AZGV2ICoqKioqIFNlcnZpY2UgcHJvdmlkZXIgKHBheW1lbnQgcmVjZWl2ZXIpICoqKioqCiAgICBmdW5jdGlvbiBlbmFibGVTZXJ2aWNlUHJvdmlkZXIoU2VydmljZVByb3ZpZGVyIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBkaXNhYmxlU2VydmljZVByb3ZpZGVyKFNlcnZpY2VQcm92aWRlciBhZGRyLCBieXRlcyBtb3JlSW5mbykgcHVibGljOwoKCiAgICAvLy9AZGV2ICoqKioqIGNvbnZlbmllbmNlIHN1YnNjcmlwdGlvbiBnZXR0ZXIgKioqKioKICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkRldGFpbHModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlckZyb20sCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvLAogICAgICAgIHVpbnQgcHJpY2VQZXJIb3VyLAogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfbiwgLy9ub21pbmF0b3IKICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2QsIC8vZGVub21pbmF0b3IKICAgICAgICB1aW50MTYgeHJhdGVQcm92aWRlcklkLAogICAgICAgIHVpbnQgY2hhcmdlUGVyaW9kLAogICAgICAgIHVpbnQgc3RhcnRPbiwKICAgICAgICBieXRlcyBkZXNjcmlwdG9yCiAgICApOwoKICAgIGZ1bmN0aW9uIHN1YnNjcmlwdGlvblN0YXR1cyh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucygKICAgICAgICB1aW50IGRlcG9zaXRBbW91bnQsCiAgICAgICAgdWludCBleHBpcmVPbiwKICAgICAgICB1aW50IGV4ZWNDb3VudGVyLAogICAgICAgIHVpbnQgcGFpZFVudGlsLAogICAgICAgIHVpbnQgb25Ib2xkU2luY2UKICAgICk7CgogICAgZW51bSBQYXltZW50U3RhdHVzIHtPSywgQkFMQU5DRV9FUlJPUiwgQVBQUk9WQUxfRVJST1J9CiAgICBldmVudCBQYXltZW50KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgdWludCBfZmVlLCBhZGRyZXNzIHNlbmRlciwgUGF5bWVudFN0YXR1cyBzdGF0dXMsIHVpbnQgc3ViSWQpOwogICAgZXZlbnQgU2VydmljZVByb3ZpZGVyRW5hYmxlZChhZGRyZXNzIGFkZHIsIGJ5dGVzIG1vcmVJbmZvKTsKICAgIGV2ZW50IFNlcnZpY2VQcm92aWRlckRpc2FibGVkKGFkZHJlc3MgYWRkciwgYnl0ZXMgbW9yZUluZm8pOwoKfSAvL1N1YnNjcmlwdGlvbk1vZHVsZQoKY29udHJhY3QgRVJDMjBNb2R1bGVTdXBwb3J0IHsKICAgIGZ1bmN0aW9uIF9mdWxmaWxsUHJlYXBwcm92ZWRQYXltZW50KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgYWRkcmVzcyBtc2dfc2VuZGVyKSBwdWJsaWMgcmV0dXJucyhib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gX2Z1bGZpbGxQYXltZW50KGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF92YWx1ZSwgdWludCBzdWJJZCwgYWRkcmVzcyBtc2dfc2VuZGVyKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIF9taW50RnJvbURlcG9zaXQoYWRkcmVzcyBvd25lciwgdWludCBhbW91bnQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIF9idXJuRm9yRGVwb3NpdChhZGRyZXNzIG93bmVyLCB1aW50IGFtb3VudCkgcHVibGljIHJldHVybnMoYm9vbCBzdWNjZXNzKTsKfQoKLy9AZGV2IGltcGxlbWVudGF0aW9uCmNvbnRyYWN0IFN1YnNjcmlwdGlvbk1vZHVsZUltcGwgaXMgU3Vic2NyaXB0aW9uTW9kdWxlLCBPd25lZCAgewoKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgVkVSU0lPTiA9ICIwLjIuMCI7CgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgICAgICAgICAgY29udHJhY3Qgc3RhdGVzICAgICAgICAgICAgICAgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIC8vL0BkZXYgc3VzcGVuZCBhbGwgbW9kdWxlIG9wZXJhdGlvbiB1bnRpbCB0aGlzIHRpbWUgKGlmIGluIGZ1dHVyZSk7IGlmIHRoZSB0aW1lIGlzIGluIHBhc3QgKG9yIHplcm8pIC0gb3BlcmF0ZXMgbm9ybWFsbHkuCiAgICB1aW50IHB1YmxpYyBzdXNwZW5kZWRVbnRpbCA9IDA7CiAgICBmdW5jdGlvbiBpc1N1c3BlbmRlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKGJvb2wpIHsgcmV0dXJuIHN1c3BlbmRlZFVudGlsID4gbm93OyB9CgogICAgLy8vQGRldiBsaXN0IG9mIGFsbCByZWdpc3RlcmVkIHNlcnZpY2UgcHJvdmlkZXIgY29udHJhY3RzIGltcGxlbWVudGVkIGFzIGEgbWFwIGZvciBiZXR0ZXIgbG9va3VwLgogICAgbWFwcGluZyAoYWRkcmVzcz0+Ym9vbCkgcHVibGljIHByb3ZpZGVyUmVnaXN0cnk7CgogICAgLy8vQGRldiBhbGwgc3Vic2NyaXB0aW9ucyBhbmQgb2ZmZXJzIChpbmNsLiBGSU5BTElaRUQpLgogICAgbWFwcGluZyAodWludCA9PiBTdWJzY3JpcHRpb24pIHB1YmxpYyBzdWJzY3JpcHRpb25zOwoKICAgIC8vL0BkZXYgYWxsIGFjdGl2ZSBzaW1wbGUgZGVwb3NpdHMgZ2l2ZWQgYnkgZGVwb3NpdElkLgogICAgbWFwcGluZyAodWludCA9PiBEZXBvc2l0KSBwdWJsaWMgZGVwb3NpdHM7CgogICAgLy8vQGRldiBhZGRyZXNzZXMgb2YgcmVnaXN0ZXJlZCBleGNoYW5nZSByYXRlIHByb3ZpZGVycy4KICAgIFhSYXRlUHJvdmlkZXJbXSBwdWJsaWMgeHJhdGVQcm92aWRlcnM7CgogICAgLy8vQGRldiBvbmdvaW5nIGNvdW50ZXIgZm9yIHN1YnNjcmlwdGlvbiBpZHMgc3RhcnRpbmcgZnJvbSAxLgogICAgLy8vICAgICBDdXJyZW50IHZhbHVlIHJlcHJlc2VudHMgYW4gaWQgb2YgbGFzdCBjcmVhdGVkIHN1YnNjcmlwdGlvbi4KICAgIHVpbnQgcHVibGljIHN1YnNjcmlwdGlvbkNvdW50ZXIgPSAwOwoKICAgIC8vL0BkZXYgb25nb2luZyBjb3VudGVyIGZvciBzaW1wbGUgZGVwb3NpdCBpZHMgc3RhcnRpbmcgZnJvbSAxLgogICAgLy8vICAgICBDdXJyZW50IHZhbHVlIHJlcHJlc2VudHMgYW4gaWQgb2YgbGFzdCBjcmVhdGVkIGRlcG9zaXQuCiAgICB1aW50IHB1YmxpYyBkZXBvc2l0Q291bnRlciA9IDA7CgogICAgLy8vQGRldiBUb2tlbiBjb250cmFjdCB3aXRoIEVSQzIwTW9kdWxlU3VwcG9ydCBhZGRvbi4KICAgIC8vLyAgICAgU3Vic2NyaXB0aW9uIE1vZHVsZSBvcGVyYXRlcyBvbiBpdHMgYmFsYW5jZXMgdmlhIEVSQzIwTW9kdWxlU3VwcG9ydCBpbnRlcmZhY2UgYXMgdHJ1c3RlZCBtb2R1bGUuCiAgICBFUkMyME1vZHVsZVN1cHBvcnQgcHVibGljIHNhbjsKCgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgIHJlamVjdCBhbGwgZXRoZXIgc2VudCB0byB0aGlzIGNvbnRyYWN0ICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdzsKICAgIH0KCgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgICBzZXR1cCBhbmQgY29uZmlndXJhdGlvbiAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvLy9AZGV2IGNvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBTdWJzY3JpcHRpb25Nb2R1bGVJbXBsKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB4cmF0ZVByb3ZpZGVycy5wdXNoKFhSYXRlUHJvdmlkZXIodGhpcykpOyAvL3RoaXMgaXMgYSBkZWZhdWx0IFNBTjpTQU4gKDE6MSkgcHJvdmlkZXIgd2l0aCBkZWZhdWx0IGlkID09IDAKICAgIH0KCgogICAgLy8vQGRldiBhdHRhY2ggU0FOIHRva2VuIHRvIHdvcmsgd2l0aDsgY2FuIGJlIGRvbmUgb25seSBvbmNlLgogICAgZnVuY3Rpb24gYXR0YWNoVG9rZW4oYWRkcmVzcyB0b2tlbikgcHVibGljIHsKICAgICAgICBhc3NlcnQoYWRkcmVzcyhzYW4pID09IDApOyAvL29ubHkgaW4gbmV3IGRlcGxveWVkIHN0YXRlCiAgICAgICAgc2FuID0gRVJDMjBNb2R1bGVTdXBwb3J0KHRva2VuKTsKICAgIH0KCgogICAgLy8vQGRldiByZWdpc3RlciBhIG5ldyBzZXJ2aWNlIHByb3ZpZGVyIHRvIHRoZSBwbGF0Zm9ybS4KICAgIGZ1bmN0aW9uIGVuYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYyBub3RTdXNwZW5kZWQgb25seShvd25lcikgewogICAgICAgIHByb3ZpZGVyUmVnaXN0cnlbYWRkcl0gPSB0cnVlOwogICAgICAgIFNlcnZpY2VQcm92aWRlckVuYWJsZWQoYWRkciwgbW9yZUluZm8pOwogICAgfQoKCiAgICAvLy9AZGV2IGRlLXJlZ2lzdGVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIHdpdGggZ2l2ZW4gYGFkZHJgLgogICAgZnVuY3Rpb24gZGlzYWJsZVNlcnZpY2VQcm92aWRlcihTZXJ2aWNlUHJvdmlkZXIgYWRkciwgYnl0ZXMgbW9yZUluZm8pIHB1YmxpYyBub3RTdXNwZW5kZWQgb25seShvd25lcikgewogICAgICAgIGRlbGV0ZSBwcm92aWRlclJlZ2lzdHJ5W2FkZHJdOwogICAgICAgIFNlcnZpY2VQcm92aWRlckRpc2FibGVkKGFkZHIsIG1vcmVJbmZvKTsKICAgIH0KCiAgICAvLy9AZGV2IHN1c3BlbmQgYWxsIG1vZHVsZSBvcGVyYXRpb25zIGZvciBnaXZlbiB0aW1lLgogICAgZnVuY3Rpb24gc3VzcGVuZCh1aW50IHN1c3BlbmRUaW1lU2VjKSBwdWJsaWMgb25seShvd25lcikgewogICAgICAgIHN1c3BlbmRlZFVudGlsID0gbm93ICsgc3VzcGVuZFRpbWVTZWM7CiAgICAgICAgU3ViTW9kdWxlU3VzcGVuZGVkKHN1c3BlbmRlZFVudGlsKTsKICAgIH0KCiAgICAvLy9AZGV2IHJlZ2lzdGVyIG5ldyBleGNoYW5nZSByYXRlIHByb3ZpZGVyLgogICAgLy8vICAgICBYUmF0ZVByb3ZpZGVyIGNhbid0IGJlIGRlLXJlZ2lzdGVyZWQsIGJlY2F1c2UgdGhleSBjb3VsZCBiZSBzdGlsbCBpbiB1c2UgYnkgc29tZSBzdWJzY3JpcHRpb24uCiAgICBmdW5jdGlvbiByZWdpc3RlclhSYXRlUHJvdmlkZXIoWFJhdGVQcm92aWRlciBhZGRyKSBwdWJsaWMgbm90U3VzcGVuZGVkIG9ubHkob3duZXIpIHJldHVybnMgKHVpbnQxNiB4cmF0ZVByb3ZpZGVySWQpIHsKICAgICAgICB4cmF0ZVByb3ZpZGVySWQgPSB1aW50MTYoeHJhdGVQcm92aWRlcnMubGVuZ3RoKTsKICAgICAgICB4cmF0ZVByb3ZpZGVycy5wdXNoKGFkZHIpOwogICAgICAgIE5ld1hSYXRlUHJvdmlkZXIoYWRkciwgeHJhdGVQcm92aWRlcklkLCBtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLy8vQGRldiB4cmF0ZVByb3ZpZGVycyBsZW5ndGggYWNjZXNzb3IuCiAgICBmdW5jdGlvbiBnZXRYUmF0ZVByb3ZpZGVyTGVuZ3RoKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4geHJhdGVQcm92aWRlcnMubGVuZ3RoOwogICAgfQoKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgICBzaW5nbGUgcGF5bWVudCBtZXRob2RzICAgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy8vQG5vdGljZSBtYWtlcyBzaW5nbGUgcGF5bWVudCB0byBzZXJ2aWNlIHByb3ZpZGVyLgogICAgLy8vQHBhcmFtIF92YWx1ZSAtIGFtb3VudCBvZiBTQU4gdG9rZW4gdG8gc2VudAogICAgLy8vQHBhcmFtIF9wYXltZW50RGF0YSAtICdwYXltZW50IHB1cnBvc2UnIGNvZGUgdXN1YWxseSBpc3N1ZWQgYnkgc2VydmljZSBwcm92aWRlciB0byBjdXN0b21lciBiZWZvcmUgcGF5bWVudC4KICAgIC8vL0BwYXJhbSBfdG8gLSBzZXJ2aWNlIHByb3ZpZGVyIGNvbnRyYWN0CiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBwYXltZW50VG8odWludCBfdmFsdWUsIGJ5dGVzIF9wYXltZW50RGF0YSwgU2VydmljZVByb3ZpZGVyIF90bykgcHVibGljIG5vdFN1c3BlbmRlZCByZWVudHJhbnQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKHNhbi5fZnVsZmlsbFBheW1lbnQobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUsIDAsIG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgIC8vIGEgU2VydmljZVByb3ZpZGVyIChhIFNlcnZpY2VQcm92aWRlcikgaGFzIGhlcmUgYW4gb3Bwb3J0dW5pdHkgdmVyaWZ5IGFuZCByZWplY3QgdGhlIHBheW1lbnQKICAgICAgICAgICAgYXNzZXJ0IChTZXJ2aWNlUHJvdmlkZXIoX3RvKS5vblBheW1lbnQobXNnLnNlbmRlciwgX3ZhbHVlLCBfcGF5bWVudERhdGEpKTsgICAgICAgICAgICAgICAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBtYWtlcyBzaW5nbGUgcHJlYXBwcm92ZWQgcGF5bWVudCB0byBzZXJ2aWNlIHByb3ZpZGVyLiBBbiBhbW91bnQgbXVzdCBiZSBhbHJlYWR5IHByZWFwcHJvdmVkIGJ5IHBheW1lbnQgc2VuZGVyIHRvIHJlY2VwaWVudC4KICAgIC8vL0BwYXJhbSBfdmFsdWUgLSBhbW91bnQgb2YgU0FOIHRva2VuIHRvIHNlbnQKICAgIC8vL0BwYXJhbSBfcGF5bWVudERhdGEgLSAncGF5bWVudCBwdXJwb3NlJyBjb2RlIHVzdWFsbHkgaXNzdWVkIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gY3VzdG9tZXIgYmVmb3JlIHBheW1lbnQuCiAgICAvLy9AcGFyYW0gX2Zyb20gLSBzZW5kZXIgb2YgdGhlIHBheW1lbnQgKG90aGVyIHRoYW4gbXNnLnNlbmRlcikKICAgIC8vL0BwYXJhbSBfdG8gLSBzZXJ2aWNlIHByb3ZpZGVyIGNvbnRyYWN0CiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBwYXltZW50RnJvbSh1aW50IF92YWx1ZSwgYnl0ZXMgX3BheW1lbnREYXRhLCBhZGRyZXNzIF9mcm9tLCBTZXJ2aWNlUHJvdmlkZXIgX3RvKSBwdWJsaWMgbm90U3VzcGVuZGVkIHJlZW50cmFudCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBpZiAoc2FuLl9mdWxmaWxsUHJlYXBwcm92ZWRQYXltZW50KF9mcm9tLCBfdG8sIF92YWx1ZSwgbXNnLnNlbmRlcikpIHsKICAgICAgICAgICAgLy8gYSBTZXJ2aWNlUHJvdmlkZXIgKGEgU2VydmljZVByb3ZpZGVyKSBoYXMgaGVyZSBhbiBvcHBvcnR1bml0eSB2ZXJpZnkgYW5kIHJlamVjdCB0aGUgcGF5bWVudAogICAgICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihfdG8pLm9uUGF5bWVudChfZnJvbSwgX3ZhbHVlLCBfcGF5bWVudERhdGEpKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAvLyAqICAgICAgICAgICAgc3Vic2NyaXB0aW9uIGhhbmRsaW5nICAgICAgICAgICAgICAqCiAgICAvLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgogICAgLy8vQGRldiBjb252ZW5pZW5jZSBnZXR0ZXIgZm9yIHNvbWUgc3Vic2NyaXB0aW9uIGZpZWxkcwogICAgZnVuY3Rpb24gc3Vic2NyaXB0aW9uRGV0YWlscyh1aW50IHN1YklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlckZyb20sCiAgICAgICAgYWRkcmVzcyB0cmFuc2ZlclRvLAogICAgICAgIHVpbnQgcHJpY2VQZXJIb3VyLAogICAgICAgIHVpbnQzMiBpbml0aWFsWHJhdGVfbiwgLy9ub21pbmF0b3IKICAgICAgICB1aW50MzIgaW5pdGlhbFhyYXRlX2QsIC8vZGVub21pbmF0b3IKICAgICAgICB1aW50MTYgeHJhdGVQcm92aWRlcklkLAogICAgICAgIHVpbnQgY2hhcmdlUGVyaW9kLAogICAgICAgIHVpbnQgc3RhcnRPbiwKICAgICAgICBieXRlcyBkZXNjcmlwdG9yCiAgICApIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgcmV0dXJuIChzdWIudHJhbnNmZXJGcm9tLCBzdWIudHJhbnNmZXJUbywgc3ViLnByaWNlUGVySG91ciwgc3ViLmluaXRpYWxYcmF0ZV9uLCBzdWIuaW5pdGlhbFhyYXRlX2QsIHN1Yi54cmF0ZVByb3ZpZGVySWQsIHN1Yi5jaGFyZ2VQZXJpb2QsIHN1Yi5zdGFydE9uLCBzdWIuZGVzY3JpcHRvcik7CiAgICB9CgoKICAgIC8vL0BkZXYgY29udmVuaWVuY2UgZ2V0dGVyIGZvciBzb21lIHN1YnNjcmlwdGlvbiBmaWVsZHMKICAgIC8vLyAgICAgYSBjYWxsZXIgbXVzdCBrbm93LCB0aGF0IHRoZSBzdWJzY3JpcHRpb24gd2l0aCBnaXZlbiBpZCBleGlzdHMsIGJlY2F1c2UgYWxsIHRoZXNlIGZpZWxkcyBjYW4gYmUgMCBldmVuIHRoZSBzdWJzY3JpcHRpb24gd2l0aCBnaXZlbiBpZCBleGlzdHMuCiAgICBmdW5jdGlvbiBzdWJzY3JpcHRpb25TdGF0dXModWludCBzdWJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoCiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50LAogICAgICAgIHVpbnQgZXhwaXJlT24sCiAgICAgICAgdWludCBleGVjQ291bnRlciwKICAgICAgICB1aW50IHBhaWRVbnRpbCwKICAgICAgICB1aW50IG9uSG9sZFNpbmNlCiAgICApIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgcmV0dXJuIChzdWIuZGVwb3NpdEFtb3VudCwgc3ViLmV4cGlyZU9uLCBzdWIuZXhlY0NvdW50ZXIsIHN1Yi5wYWlkVW50aWwsIHN1Yi5vbkhvbGRTaW5jZSk7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgZXhlY3V0ZSBwZXJpb2RpYyBzdWJzY3JpcHRpb24gcGF5bWVudC4KICAgIC8vLyAgICAgICAgQW55IG9mIGN1c3RvbWVyLCBzZXJ2aWNlIHByb3ZpZGVyIGFuZCBwbGF0Zm9ybSBvd25lciBjYW4gZXhlY3V0ZSB0aGlzIGZ1bmN0aW9uLgogICAgLy8vICAgICAgICBUaGlzIGVuc3VyZXMsIHRoYXQgdGhlIHN1YnNjcmlwdGlvbiBjaGFyZ2UgZG9lc24ndCBiZWNvbWUgZGVsYXllZC4KICAgIC8vLyAgICAgICAgQXQgbGVhc3QgdGhlIHBsYXRmb3JtIG93bmVyIGhhcyBhbiBpbmNlbnRpdmUgdG8gZ2V0IGZlZSBhbmQgdGh1cyBjYW4gdHJpZ2dlciB0aGUgZnVuY3Rpb24uCiAgICAvLy8gICAgICAgIEFuIGV4ZWN1dGlvbiBmYWlscyBpZiBzdWJzY3JpcHRpb24gaXMgbm90IGluIHN0YXR1cyBgQ0hBUkdFQUJMRWAuCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gdG8gYmUgY2hhcmdlZC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIGV4ZWN1dGVTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCBub1JlZW50cmFuY3koTDAwKSByZXR1cm5zIChib29sKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgYXNzZXJ0IChtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20gfHwgbXNnLnNlbmRlciA9PSBzdWIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBpZiAoX3N1YnNjcmlwdGlvblN0YXRlKHN1Yik9PVN1YlN0YXRlLkNIQVJHRUFCTEUpIHsKICAgICAgICAgICAgdmFyIF9mcm9tID0gc3ViLnRyYW5zZmVyRnJvbTsKICAgICAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOwogICAgICAgICAgICB2YXIgX3ZhbHVlID0gX2Ftb3VudFRvQ2hhcmdlKHN1Yik7CiAgICAgICAgICAgIGlmIChzYW4uX2Z1bGZpbGxQYXltZW50KF9mcm9tLCBfdG8sIF92YWx1ZSwgc3ViSWQsIG1zZy5zZW5kZXIpKSB7CiAgICAgICAgICAgICAgICBzdWIucGFpZFVudGlsICA9IG1heChzdWIucGFpZFVudGlsLCBzdWIuc3RhcnRPbikgKyBzdWIuY2hhcmdlUGVyaW9kOwogICAgICAgICAgICAgICAgKytzdWIuZXhlY0NvdW50ZXI7CiAgICAgICAgICAgICAgICAvLyBhIFNlcnZpY2VQcm92aWRlciAoYSBTZXJ2aWNlUHJvdmlkZXIpIGhhcyBoZXJlIGFuIG9wcG9ydHVuaXR5IHRvIHZlcmlmeSBhbmQgcmVqZWN0IHRoZSBwYXltZW50CiAgICAgICAgICAgICAgICBhc3NlcnQgKFNlcnZpY2VQcm92aWRlcihfdG8pLm9uU3ViRXhlY3V0ZWQoc3ViSWQpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIG1vdmUgYHBhaWRVbnRpbGAgZm9yd2FyZCB0byBnaXZlbiBgbmV3RHVlRGF0ZWAuIEl0IHdhaXZlcyBwYXltZW50cyBmb3IgZ2l2ZW4gdGltZS4KICAgIC8vLyAgICAgICAgVGhpcyBmdW5jdGlvbiBjYW4gYmUgdXNlZCBieSBzZXJ2aWNlIHByb3ZpZGVyIHRvIGBnaXZlIGF3YXlgIHNvbWUgc2VydmljZSB0aW1lIGZvciBmcmVlLgogICAgLy8vQHBhcmFtIHN1YklkIC0gaWQgb2Ygc3Vic2NyaXB0aW9uIHRvIGJlIHBvc3Rwb25lZC4KICAgIC8vL0BwYXJhbSBuZXdEdWVEYXRlIC0gbmV3IGBwYWlkVW50aWxgIGRhdGV0aW1lOyByZXF1aXJlIGBuZXdEdWVEYXRlID4gcGFpZFVudGlsYC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIHBvc3Rwb25lRHVlRGF0ZSh1aW50IHN1YklkLCB1aW50IG5ld0R1ZURhdGUpIHB1YmxpYyBub3RTdXNwZW5kZWQgcmV0dXJucyAoYm9vbCBzdWNjZXNzKXsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKF9pc1N1YnNjcmlwdGlvbihzdWIpKTsKICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIpOyAvL29ubHkgU2VydmljZSBQcm92aWRlciBpcyBhbGxvd2VkIHRvIHBvc3Rwb25lIHRoZSBEdWVEYXRlCiAgICAgICAgaWYgKHN1Yi5wYWlkVW50aWwgPCBuZXdEdWVEYXRlKSB7CiAgICAgICAgICAgIHN1Yi5wYWlkVW50aWwgPSBuZXdEdWVEYXRlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQGRldiByZXR1cm4gY3VycmVudCBzdGF0dXMgYXMgYSBuYW1lIG9mIGEgc3Vic2NyaXB0aW9uIChvciBhbiBvZmZlcikgd2l0aCBnaXZlbiBpZDsKICAgIGZ1bmN0aW9uIHN0YXRlKHVpbnQgc3ViT3JPZmZlcklkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhzdHJpbmcgc3RhdGUpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3ViT3JPZmZlciA9IHN1YnNjcmlwdGlvbnNbc3ViT3JPZmZlcklkXTsKICAgICAgICByZXR1cm4gX2lzT2ZmZXIoc3ViT3JPZmZlcikKICAgICAgICAgICAgICA/IE9GRkVSX1NUQVRFU1t1aW50KF9vZmZlclN0YXRlKHN1Yk9yT2ZmZXIpKV0KICAgICAgICAgICAgICA6IFNVQl9TVEFURVNbdWludChfc3Vic2NyaXB0aW9uU3RhdGUoc3ViT3JPZmZlcikpXTsKICAgIH0KCgogICAgLy8vQGRldiByZXR1cm4gY3VycmVudCBzdGF0dXMgYXMgYSBjb2RlIG9mIGEgc3Vic2NyaXB0aW9uIChvciBhbiBvZmZlcikgd2l0aCBnaXZlbiBpZDsKICAgIGZ1bmN0aW9uIHN0YXRlQ29kZSh1aW50IHN1Yk9yT2ZmZXJJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnModWludCBzdGF0ZUNvZGUpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3ViT3JPZmZlciA9IHN1YnNjcmlwdGlvbnNbc3ViT3JPZmZlcklkXTsKICAgICAgICByZXR1cm4gX2lzT2ZmZXIoc3ViT3JPZmZlcikKICAgICAgICAgICAgICA/IHVpbnQoX29mZmVyU3RhdGUoc3ViT3JPZmZlcikpCiAgICAgICAgICAgICAgOiB1aW50KF9zdWJzY3JpcHRpb25TdGF0ZShzdWJPck9mZmVyKSk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9vZmZlclN0YXRlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhPZmZlclN0YXRlIHN0YXR1cykgewogICAgICAgIGlmICghX2lzT2ZmZXIoc3ViKSkgewogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5OT1RfRVhJU1Q7CiAgICAgICAgfSBlbHNlIGlmIChzdWIuc3RhcnRPbiA+IG5vdykgewogICAgICAgICAgICByZXR1cm4gT2ZmZXJTdGF0ZS5CRUZPUkVfU1RBUlQ7CiAgICAgICAgfSBlbHNlIGlmIChzdWIub25Ib2xkU2luY2UgPiAwKSB7CiAgICAgICAgICAgIHJldHVybiBPZmZlclN0YXRlLk9OX0hPTEQ7CiAgICAgICAgfSBlbHNlIGlmIChub3cgPD0gc3ViLmV4cGlyZU9uKSB7CiAgICAgICAgICAgIHJldHVybiBzdWIuZXhlY0NvdW50ZXIgPiAwCiAgICAgICAgICAgICAgICA/IE9mZmVyU3RhdGUuQUNUSVZFCiAgICAgICAgICAgICAgICA6IE9mZmVyU3RhdGUuU09MRF9PVVQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIE9mZmVyU3RhdGUuRVhQSVJFRDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX3N1YnNjcmlwdGlvblN0YXRlKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyhTdWJTdGF0ZSBzdGF0dXMpIHsKICAgICAgICBpZiAoIV9pc1N1YnNjcmlwdGlvbihzdWIpKSB7CiAgICAgICAgICAgIHJldHVybiBTdWJTdGF0ZS5OT1RfRVhJU1Q7CiAgICAgICAgfSBlbHNlIGlmIChzdWIuc3RhcnRPbiA+IG5vdykgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuQkVGT1JFX1NUQVJUOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuT05fSE9MRDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi5wYWlkVW50aWwgPj0gc3ViLmV4cGlyZU9uKSB7CiAgICAgICAgICAgIHJldHVybiBub3cgPCBzdWIuZXhwaXJlT24KICAgICAgICAgICAgICAgID8gU3ViU3RhdGUuQ0FOQ0VMRUQKICAgICAgICAgICAgICAgIDogc3ViLmRlcG9zaXRBbW91bnQgPiAwCiAgICAgICAgICAgICAgICAgICAgPyBTdWJTdGF0ZS5FWFBJUkVECiAgICAgICAgICAgICAgICAgICAgOiBTdWJTdGF0ZS5GSU5BTElaRUQ7CiAgICAgICAgfSBlbHNlIGlmIChzdWIucGFpZFVudGlsIDw9IG5vdykgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuQ0hBUkdFQUJMRTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gU3ViU3RhdGUuUEFJRDsKICAgICAgICB9CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY3JlYXRlIGEgbmV3IHN1YnNjcmlwdGlvbiBvZmZlci4KICAgIC8vL0BkZXYgb25seSByZWdpc3RlcmVkIHNlcnZpY2UgcHJvdmlkZXIgaXMgYWxsb3dlZCB0byBjcmVhdGUgb2ZmZXJzLgogICAgLy8vQGRldiBzdWJzY3JpcHRpb24gdXNlcyBTQU4gdG9rZW4gZm9yIHBheW1lbnQsIGJ1dCBhbiBleGFjdCBhbW91bnQgdG8gYmUgcGFpZCBvciBkZXBvc2l0IGlzIGNhbGN1bGF0ZWQgdXNpbmcgZXhjaGFuZ2UgcmF0ZSBmcm9tIGV4dGVybmFsIHhyYXRlUHJvdmlkZXIgKHByZXZpb3NseSByZWdpc3RlcmVkIG9uIHBsYXRmb3JtKS4KICAgIC8vLyAgICBUaGlzIGFsbG93cyB0byBjcmVhdGUgYSBzdWJzY3JpcHRpb24gYm91bmQgdG8gYW5vdGhlciB0b2tlbiBvciBldmVuIGZpYXQgY3VycmVuY3kuCiAgICAvLy9AcGFyYW0gX3ByaWNlUGVySG91ciAtIHN1YnNjcmlwdGlvbiBwcmljZSBwZXIgaG91ciBpbiBTQU4KICAgIC8vL0BwYXJhbSBfeHJhdGVQcm92aWRlcklkIC0gaWQgb2YgZXh0ZXJuYWwgZXhjaGFuZ2UgcmF0ZSBwcm92aWRlciBmcm9tIHN1YnNjcmlwdGlvbiBjdXJyZW5jeSB0byBTQU47ICIwIiBtZWFucyBzdWJzY3JpcHRpb24gaXMgcHJpY2VkIGluIFNBTiBuYXRpdmVseS4KICAgIC8vL0BwYXJhbSBfY2hhcmdlUGVyaW9kIC0gdGltZSBwZXJpb2QgdG8gY2hhcmdlOyBzdWJzY3JpcHRpb24gY2FuJ3QgYmUgY2hhcmdlZCBtb3JlIG9mdGVuIHRoYW4gdGhpcyBwZXJpb2QuIFRpbWUgdW5pdHMgYXJlIG5hdGl2ZSBldGhlcmV1bSB0aW1lLCByZXR1cm5pbmcgYnkgYG5vd2AsIGkuZS4gc2Vjb25kcy4KICAgIC8vL0BwYXJhbSBfZXhwaXJlT24gLSBvZmZlciBjYW4ndCBiZSBhY2NlcHRlZCBhZnRlciB0aGlzIHRpbWUuCiAgICAvLy9AcGFyYW0gX29mZmVyTGltaXQgLSBob3cgbWFueSBzdWJzY3JpcHRpb24gYXJlIGF2YWlsYWJsZSB0byBjcmVhdGVkIGZyb20gdGhpcyBvZmZlcjsgdGhlcmUgaXMgbm8gbWFnaWMgbnVtYmVyIGZvciB1bmxpbWl0ZWQgb2ZmZXIgLS0gdXNlIGJpZyBudW1iZXIgaW5zdGVhZC4KICAgIC8vL0BwYXJhbSBfZGVwb3NpdEFtb3VudCAtIHVwZnJvbnQgZGVwb3NpdCByZXF1aXJlZCBmb3IgY3JlYXRpbmcgYSBzdWJzY3JpcHRpb247IHRoaXMgZGVwb3NpdCBiZWNvbWVzIGZ1bGx5IHJldHVybmVkIG9uIHN1YnNjcmlwdGlvbiBpcyBvdmVyLgogICAgLy8vICAgICAgIGN1cnJlbnRseSB0aGlzIGRlcG9zaXQgaXMgbm90IHN1YmplY3Qgb2YgcGxhdGZvcm0gZmVlcyBhbmQgd2lsbCBiZSByZWZ1bmRlZCBpbiBmdWxsLiBOZXh0IHZlcnNpb25zIG9mIHRoaXMgbW9kdWxlIGNhbiB1c2UgZGVwb3NpdCBpbiBjYXNlIG9mIG91dHN0YW5kaW5nIHBheW1lbnRzLgogICAgLy8vQHBhcmFtIF9zdGFydE9uIC0gYSBzdWJzY3JpcHRpb24gZnJvbSB0aGlzIG9mZmVyIGNhbid0IGJlIGNyZWF0ZWQgYmVmb3JlIHRoaXMgdGltZS4gVGltZSB1bml0cyBhcmUgbmF0aXZlIGV0aGVyZXVtIHRpbWUsIHJldHVybmluZyBieSBgbm93YCwgaS5lLiBzZWNvbmRzLgogICAgLy8vQHBhcmFtIF9kZXNjcmlwdG9yIC0gYXJiaXRyYXJ5IGJ5dGVzIGFzIGFuIG9mZmVyIGRlc2NyaXB0b3IuIFRoaXMgZGVzY3JpcHRvciBpcyBjb3BpZWQgaW50byBzdWJzY3JpcHRpb24gYW5kIHRoZW4gc2VydmljZSBwcm92aWRlciBiZWNvbWVzIGl0IHBhc3NlZCBpbiBub3RpZmljYXRpb25zLgogICAgLy8KICAgIGZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgX3ByaWNlUGVySG91ciwgdWludDE2IF94cmF0ZVByb3ZpZGVySWQsIHVpbnQgX2NoYXJnZVBlcmlvZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX29mZmVyTGltaXQsIHVpbnQgX2RlcG9zaXRBbW91bnQsIHVpbnQgX3N0YXJ0T24sIGJ5dGVzIF9kZXNjcmlwdG9yKQogICAgcHVibGljCiAgICBub1JlZW50cmFuY3koTDAxKQogICAgb25seVJlZ2lzdGVyZWRQcm92aWRlcgogICAgbm90U3VzcGVuZGVkCiAgICByZXR1cm5zICh1aW50IHN1YklkKSB7CiAgICAgICAgYXNzZXJ0IChfc3RhcnRPbiA8IF9leHBpcmVPbik7CiAgICAgICAgYXNzZXJ0IChfY2hhcmdlUGVyaW9kIDw9IDEwIHllYXJzKTsgLy9zYW5pdHkgY2hlY2sKICAgICAgICB2YXIgKF94cmF0ZV9uLCBfeHJhdGVfZCkgPSBfeHJhdGVQcm92aWRlcklkID09IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAoMSwxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFhSYXRlUHJvdmlkZXIoeHJhdGVQcm92aWRlcnNbX3hyYXRlUHJvdmlkZXJJZF0pLmdldFJhdGUoKTsgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgYXNzZXJ0IChfeHJhdGVfbiA+IDAgJiYgX3hyYXRlX2QgPiAwKTsKICAgICAgICBzdWJzY3JpcHRpb25zWysrc3Vic2NyaXB0aW9uQ291bnRlcl0gPSBTdWJzY3JpcHRpb24gKHsKICAgICAgICAgICAgdHJhbnNmZXJGcm9tICAgIDogMCwgICAgICAgICAgICAgICAgICAvLyBlbXB0eSB0cmFuc2ZlckZyb20gZmllbGQgbWVhbnMgd2UgaGF2ZSBhbiBvZmZlciwgbm90IGEgc3Vic2NyaXB0aW9uCiAgICAgICAgICAgIHRyYW5zZmVyVG8gICAgICA6IG1zZy5zZW5kZXIsICAgICAgICAgLy8gc2VydmljZSBwcm92aWRlciBpcyBhIGJlbmVmaWNpYXJ5IG9mIHN1YnNjcmlwdG9uIHBheW1lbnRzCiAgICAgICAgICAgIHByaWNlUGVySG91ciAgICA6IF9wcmljZVBlckhvdXIsICAgICAgLy8gcHJpY2UgcGVyIGhvdXIgaW4gU0FOIChyZWNhbGN1bGF0ZWQgZnJvbSBiYXNlIGN1cnJlbmN5IGlmIG5lZWRlZCkKICAgICAgICAgICAgeHJhdGVQcm92aWRlcklkIDogX3hyYXRlUHJvdmlkZXJJZCwgICAvLyBpZCBvZiByZWdpc3RlcmVkIGV4Y2hhbmdlIHJhdGUgcHJvdmlkZXIgb3IgemVybyBpZiBhbiBvZmZlciBpcyBub21pbmF0ZWQgaW4gU0FOLgogICAgICAgICAgICBpbml0aWFsWHJhdGVfbiAgOiBfeHJhdGVfbiwgICAgICAgICAgIC8vIGZyYWN0aW9uIG5vbWluYXRvciBvZiB0aGUgaW5pdGlhbCBleGNoYW5nZSByYXRlCiAgICAgICAgICAgIGluaXRpYWxYcmF0ZV9kICA6IF94cmF0ZV9kLCAgICAgICAgICAgLy8gZnJhY3Rpb24gZGVub21pbmF0b3Igb2YgdGhlIGluaXRpYWwgZXhjaGFuZ2UgcmF0ZQogICAgICAgICAgICBwYWlkVW50aWwgICAgICAgOiAwLCAgICAgICAgICAgICAgICAgIC8vIHNlcnZpY2UgaXMgY29uc2lkZXJlZCB0byBiZSBwYWlkIHVudGlsIHRoaXMgdGltZTsgbm8gY2hhcmdlIGlzIHBvc3NpYmxlIHdoaWxlIHN1YnNjcmlwdGlvbiBpcyBwYWlkIGZvciBub3cuCiAgICAgICAgICAgIGNoYXJnZVBlcmlvZCAgICA6IF9jaGFyZ2VQZXJpb2QsICAgICAgLy8gcGVyaW9kIGluIHNlY29uZHMgKGV0aGVyZXVtIGJsb2NrIHRpbWUgdW5pdCkgdG8gY2hhcmdlLgogICAgICAgICAgICBkZXBvc2l0QW1vdW50ICAgOiBfZGVwb3NpdEFtb3VudCwgICAgIC8vIGRlcG9zaXQgcmVxdWlyZWQgZm9yIHN1YnNjcmlwdGlvbiBhY2NlcHQuCiAgICAgICAgICAgIHN0YXJ0T24gICAgICAgICA6IF9zdGFydE9uLAogICAgICAgICAgICBleHBpcmVPbiAgICAgICAgOiBfZXhwaXJlT24sCiAgICAgICAgICAgIGV4ZWNDb3VudGVyICAgICA6IF9vZmZlckxpbWl0LAogICAgICAgICAgICBkZXNjcmlwdG9yICAgICAgOiBfZGVzY3JpcHRvciwKICAgICAgICAgICAgb25Ib2xkU2luY2UgICAgIDogMCAgICAgICAgICAgICAgICAgICAvLyBvZmZlciBpcyBub3Qgb24gaG9sZCBieSBkZWZhdWx0LgogICAgICAgIH0pOwogICAgICAgIHJldHVybiBzdWJzY3JpcHRpb25Db3VudGVyOyAgICAgICAgICAgICAgIC8vIHJldHVybnMgYW4gaWQgb2YgdGhlIG5ldyBvZmZlci4KICAgIH0KCgogICAgLy8vQG5vdGljZSB1cGRhdGVzIGN1cnJlbnRseSBhdmFpbGFibGUgbnVtYmVyIG9mIHN1YnNjcmlwdGlvbiBmb3IgdGhpcyBvZmZlci4KICAgIC8vLyAgICAgICAgT3RoZXIgb2ZmZXIncyBwYXJhbWV0ZXIgY2FuJ3QgYmUgdXBkYXRlZCBiZWNhdXNlIHRoZXkgYXJlIGNvbnNpZGVyZWQgdG8gYmUgYSBwdWJsaWMgb2ZmZXIgcmV2aWV3ZWQgYnkgY3VzdG9tZXJzLgogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBzaG91bGQgcmVjcmVhdGUgdGhlIG9mZmVyIGFzIGEgbmV3IG9uZSBpbiBjYXNlIG9mIG90aGVyIGNoYW5nZXMuCiAgICAvLwogICAgZnVuY3Rpb24gdXBkYXRlU3Vic2NyaXB0aW9uT2ZmZXIodWludCBfb2ZmZXJJZCwgdWludCBfb2ZmZXJMaW1pdCkgcHVibGljIG5vdFN1c3BlbmRlZCB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugb2ZmZXIgPSBzdWJzY3JpcHRpb25zW19vZmZlcklkXTsKICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7CiAgICAgICAgYXNzZXJ0IChvZmZlci50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIpOyAvL29ubHkgUHJvdmlkZXIgaXMgYWxsb3dlZCB0byB1cGRhdGUgdGhlIG9mZmVyLgogICAgICAgIG9mZmVyLmV4ZWNDb3VudGVyID0gX29mZmVyTGltaXQ7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgYWNjZXB0IGdpdmVuIG9mZmVyIGFuZCBjcmVhdGUgYSBuZXcgc3Vic2NyaXB0aW9uIG9uIHRoZSBiYXNlIG9mIGl0LgogICAgLy8vCiAgICAvLy9AZGV2IHRoZSBzZXJ2aWNlIHByb3ZpZGVyIChvZmZlci5gdHJhbnNmZXJUb2ApIGJlY29tZXMgbm90aWZpZWQgYWJvdXQgbmV3IHN1YnNjcmlwdGlvbiBieSBjYWxsIGBvblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpYC4KICAgIC8vLyAgICAgSXQgaXMgcHJvdmlkZXIncyByZXNwb25zaWJpbGl0eSB0byByZXRyaWV2ZSBhbmQgc3RvcmUgYW55IG5lY2Vzc2FyeSBpbmZvcm1hdGlvbiBhYm91dCBvZmZlciBhbmQgdGhpcyBuZXcgc3Vic2NyaXB0aW9uLiBTb21lIG9mIGluZm8gaXMgb25seSBhdmFpbGFibGUgYXQgdGhpcyBwb2ludC4KICAgIC8vLyAgICAgVGhlIFNlcnZpY2UgUHJvdmlkZXIgY2FuIGFsc28gcmVqZWN0IHRoZSBuZXcgc3Vic2NyaXB0aW9uIGJ5IHRocm93aW5nIGFuIGV4Y2VwdGlvbiBvciByZXR1cm5pbmcgYGZhbHNlYCBmcm9tIGBvblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpYCBldmVudCBoYW5kbGVyLgogICAgLy8vQHBhcmFtIF9vZmZlcklkICAgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgYWNjZXB0ZWQKICAgIC8vL0BwYXJhbSBfZXhwaXJlT24gIC0gc3Vic2NyaXB0aW9uIGV4cGlyYXRpb24gdGltZTsgbm8gY2hhcmdlcyBhcmUgcG9zc2libGUgYmVoaW5kIHRoaXMgdGltZS4KICAgIC8vL0BwYXJhbSBfc3RhcnRPbiAgIC0gc3Vic2NyaXB0aW9uIHN0YXJ0IHRpbWU7IG5vIGNoYXJnZXMgYXJlIHBvc3NpYmxlIGJlZm9yZSB0aGlzIHRpbWUuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgIElmIHRoZSBgX3N0YXJ0T25gIGlzIGluIHRoZSBwYXN0IG9yIGlzIHplcm8sIGl0IG1lYW5zIHN0YXJ0IHRoZSBzdWJzY3JpcHRpb24gQVNBUC4KICAgIC8vCiAgICBmdW5jdGlvbiBjcmVhdGVTdWJzY3JpcHRpb24odWludCBfb2ZmZXJJZCwgdWludCBfZXhwaXJlT24sIHVpbnQgX3N0YXJ0T24pIHB1YmxpYyBub3RTdXNwZW5kZWQgbm9SZWVudHJhbmN5KEwwMikgcmV0dXJucyAodWludCBuZXdTdWJJZCkgewogICAgICAgIGFzc2VydCAoX3N0YXJ0T24gPCBfZXhwaXJlT24pOwogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tfb2ZmZXJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOwogICAgICAgIGFzc2VydCAob2ZmZXIuc3RhcnRPbiA9PSAwICAgICB8fCBvZmZlci5zdGFydE9uICA8PSBub3cpOwogICAgICAgIGFzc2VydCAob2ZmZXIuZXhwaXJlT24gPT0gMCAgICB8fCBvZmZlci5leHBpcmVPbiA+PSBub3cpOwogICAgICAgIGFzc2VydCAob2ZmZXIub25Ib2xkU2luY2UgPT0gMCk7CiAgICAgICAgYXNzZXJ0IChvZmZlci5leGVjQ291bnRlciA+IDApOwogICAgICAgIC0tb2ZmZXIuZXhlY0NvdW50ZXI7CiAgICAgICAgbmV3U3ViSWQgPSArK3N1YnNjcmlwdGlvbkNvdW50ZXI7CiAgICAgICAgLy9jcmVhdGUgYSBjbG9uZSBvZiB0aGUgb2ZmZXIuLi4KICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBuZXdTdWIgPSBzdWJzY3JpcHRpb25zW25ld1N1YklkXSA9IG9mZmVyOwogICAgICAgIC8vLi4uIGFuZCBhZGp1c3Qgc29tZSBmaWVsZHMgc3BlY2lmaWMgdG8gc3Vic2NyaXB0aW9uCiAgICAgICAgbmV3U3ViLnRyYW5zZmVyRnJvbSA9IG1zZy5zZW5kZXI7CiAgICAgICAgbmV3U3ViLmV4ZWNDb3VudGVyID0gMDsKICAgICAgICBuZXdTdWIucGFpZFVudGlsID0gbmV3U3ViLnN0YXJ0T24gPSBtYXgoX3N0YXJ0T24sIG5vdyk7ICAgICAvL25vIGRlYnRzIGJlZm9yZSBhY3R1YWwgY3JlYXRpb24gdGltZSEKICAgICAgICBuZXdTdWIuZXhwaXJlT24gPSBfZXhwaXJlT247CiAgICAgICAgbmV3U3ViLmRlcG9zaXRBbW91bnQgPSBfYXBwbHlYY2hhbmdlUmF0ZShuZXdTdWIuZGVwb3NpdEFtb3VudCwgbmV3U3ViKTsgICAgICAgICAgICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgIC8vZGVwb3NpdEFtb3VudCBpcyBub3cgc3RvcmVkIGluIHRoZSBzdWIsIHNvIGJ1cm4gdGhlIHNhbWUgYW1vdW50IGZyb20gY3VzdG9tZXIncyBhY2NvdW50LgogICAgICAgIGFzc2VydCAoc2FuLl9idXJuRm9yRGVwb3NpdChtc2cuc2VuZGVyLCBuZXdTdWIuZGVwb3NpdEFtb3VudCkpOwogICAgICAgIGFzc2VydCAoU2VydmljZVByb3ZpZGVyKG5ld1N1Yi50cmFuc2ZlclRvKS5vblN1Yk5ldyhuZXdTdWJJZCwgX29mZmVySWQpKTsgICAgICAgICAgICAgICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3k7IHNlcnZpY2UgcHJvdmlkZXIgY2FuIHN0aWxsIHJlamVjdCB0aGUgbmV3IHN1YnNjcmlwdGlvbiBoZXJlCgogICAgICAgIE5ld1N1YnNjcmlwdGlvbihuZXdTdWIudHJhbnNmZXJGcm9tLCBuZXdTdWIudHJhbnNmZXJUbywgX29mZmVySWQsIG5ld1N1YklkKTsKICAgICAgICByZXR1cm4gbmV3U3ViSWQ7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY2FuY2VsIGFuIG9mZmVyIGdpdmVuIGJ5IGBvZmZlcklkYC4KICAgIC8vL0BkZXYgc2V0cyBvZmZlci5gZXhwaXJlT25gIHRvIGBleHBpcmVPbmAuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb25PZmZlcih1aW50IG9mZmVySWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsKICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7CiAgICAgICAgYXNzZXJ0IChvZmZlci50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzZXJ2aWNlIHByb3ZpZGVyIG9yIHBsYXRmb3JtIG93bmVyIGlzIGFsbG93ZWQgdG8gY2FuY2VsIHRoZSBvZmZlcgogICAgICAgIGlmIChvZmZlci5leHBpcmVPbj5ub3cpewogICAgICAgICAgICBvZmZlci5leHBpcmVPbiA9IG5vdzsKICAgICAgICAgICAgT2ZmZXJDYW5jZWxlZChvZmZlcklkLCBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIGNhbmNlbCBhbiBzdWJzY3JpcHRpb24gZ2l2ZW4gYnkgYHN1YklkYCAoYSBncmFjZWZ1bCB2ZXJzaW9uKS4KICAgIC8vL0Bub3RpY2UgSU1QT1JUQU5UOiBhIG1hbGljaW91cyBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBjb25zdW1lIGFsbCBnYXMgYW5kIHByZXZlbnRpbmcgc3Vic2NyaXB0aW9uIGZyb20gY2FuY2VsbGF0aW9uLgogICAgLy8vICAgICAgICBJZiBzbywgdXNlIGBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKWAgYXMgdGhlIGZvcmNlZCB2ZXJzaW9uLgogICAgLy8vICAgICAgICAgc2VlIGBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKWAgZm9yIG1vcmUgZG9jdW1lbnRhdGlvbi4KICAgIC8vCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCB7CiAgICAgICAgcmV0dXJuIGNhbmNlbFN1YnNjcmlwdGlvbihzdWJJZCwgMCk7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY2FuY2VsIGFuIHN1YnNjcmlwdGlvbiBnaXZlbiBieSBgc3ViSWRgIChhIGZvcmNlZCB2ZXJzaW9uKS4KICAgIC8vLyAgICAgICAgQ2FuY2VsbGF0aW9uIG1lYW5zIG5vIGZ1cnRoZXIgY2hhcmdlcyB0byB0aGlzIHN1YnNjcmlwdGlvbiBhcmUgcG9zc2libGUuIFRoZSBwcm92aWRlZCBzdWJzY3JpcHRpb24gZGVwb3NpdCBjYW4gYmUgd2l0aGRyYXduIG9ubHkgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIuCiAgICAvLy8gICAgICAgIERlcGVuZGluZyBvbiBuYXR1cmUgb2YgdGhlIHNlcnZpY2UgcHJvdmlkZWQsIHRoZSBzZXJ2aWNlIHByb3ZpZGVyIGNhbiBhbGxvdyBhbiBpbW1lZGlhdGUgZGVwb3NpdCB3aXRoZHJhd2FsIGJ5IGByZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdCh1aW50IHN1YklkKWAgY2FsbCwgYnV0IGl0cyBvbiBoaXMgb3duLgogICAgLy8vICAgICAgICBJbiBzb21lIGJ1c2luZXNzIGNhc2VzIGEgZGVwb3NpdCBtdXN0IHJlbWFpbiBsb2NrZWQgdW50aWwgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIgZXZlbiwgdGhlIHN1YnNjcmlwdGlvbiBpcyBhbHJlYWR5IGNhbmNlbGVkLgogICAgLy8vQG5vdGljZSBnYXNSZXNlcnZlIGlzIGEgZ2FzIGFtb3VudCByZXNlcnZlZCBmb3IgY29udHJhY3QgZXhlY3V0aW9uIEFGVEVSIHNlcnZpY2UgcHJvdmlkZXIgYmVjb21lcyBgb25TdWJDYW5jZWxlZCh1aW50MjU2LGFkZHJlc3MpYCBub3RpZmljYXRpb24uCiAgICAvLy8gICAgICAgIEl0IGd1YXJhbnRlZXMsIHRoYXQgY2FuY2VsbGF0aW9uIGJlY29tZXMgZXhlY3V0ZWQgZXZlbiBhIChtYWxpY2lvdXMpIHNlcnZpY2UgcHJvdmlkZXIgY29uc3VtZXMgYWxsIGdhcyBwcm92aWRlZC4KICAgIC8vLyAgICAgICAgSWYgc28sIHVzZSBgY2FuY2VsU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQsIHVpbnQgZ2FzUmVzZXJ2ZSlgIGFzIHRoZSBmb3JjZWQgdmVyc2lvbi4KICAgIC8vLyAgICAgICAgVGhpcyBkaWZmZXJlbmNlIGlzIGJlY2F1c2UgdGhlIGN1c3RvbWVyIG11c3QgYWx3YXlzIGhhdmUgYSBwb3NzaWJpbGl0eSB0byBjYW5jZWwgaGlzIGNvbnRyYWN0IGV2ZW4gdGhlIHNlcnZpY2UgcHJvdmlkZXIgZGlzYWdyZWUgb24gY2FuY2VsbGF0aW9uLgogICAgLy8vQHBhcmFtIHN1YklkIC0gc3Vic2NyaXB0aW9uIHRvIGJlIGNhbmNlbGxlZAogICAgLy8vQHBhcmFtIGdhc1Jlc2VydmUgLSBnYXMgcmVzZXJ2ZWQgZm9yIGNhbGwgZmluYWxpemF0aW9uIChtaW5pbXVtIHJlc2VydmF0aW9uIGlzIDEwMDAwIGdhcykKICAgIC8vCiAgICBmdW5jdGlvbiBjYW5jZWxTdWJzY3JpcHRpb24odWludCBzdWJJZCwgdWludCBnYXNSZXNlcnZlKSBwdWJsaWMgbm90U3VzcGVuZGVkIG5vUmVlbnRyYW5jeShMMDMpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIgPSBzdWJzY3JpcHRpb25zW3N1YklkXTsKICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlckZyb20gPT0gbXNnLnNlbmRlciB8fCBvd25lciA9PSBtc2cuc2VuZGVyKTsgLy9vbmx5IHN1YnNjcmlwdGlvbiBvd25lciBvciBwbGF0Zm9ybSBvd25lciBpcyBhbGxvd2VkIHRvIGNhbmNlbCBpdAogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOwogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsKICAgICAgICBzdWIuZXhwaXJlT24gPSBtYXgobm93LCBzdWIucGFpZFVudGlsKTsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBfdG8pIHsKICAgICAgICAgICAgLy9zdXByZXNzIHJlLXRocm93aW5nIG9mIGV4Y2VwdGlvbnM7IHJlc2VydmUgZW5vdWdoIGdhcyB0byBmaW5pc2ggdGhpcyBmdW5jdGlvbgogICAgICAgICAgICBnYXNSZXNlcnZlID0gbWF4KGdhc1Jlc2VydmUsMTAwMDApOyAgLy9yZXNlcnZlIG1pbmltdW0gMTAwMDAgZ2FzCiAgICAgICAgICAgIGFzc2VydCAobXNnLmdhcyA+IGdhc1Jlc2VydmUpOyAgICAgICAvL3Nhbml0eSBjaGVjawogICAgICAgICAgICBpZiAoX3RvLmNhbGwuZ2FzKG1zZy5nYXMtZ2FzUmVzZXJ2ZSkoYnl0ZXM0KHNoYTMoIm9uU3ViQ2FuY2VsZWQodWludDI1NixhZGRyZXNzKSIpKSwgc3ViSWQsIG1zZy5zZW5kZXIpKSB7ICAgICAvLyA8PT09IHBvc3NpYmxlIHJlZW50cmFuY3kKICAgICAgICAgICAgICAgIC8vZG8gbm90aGluZy4gaXQgaXMgbm90aWZpY2F0aW9uIG9ubHkuCiAgICAgICAgICAgICAgICAvL0xhdGVyOiBpcyBpdCBwb3NzaWJsZSB0byBldmFsdWF0ZSByZXR1cm4gdmFsdWUgaGVyZT8gSWYgaXMgYmV0dGVyIHRvIHJldHVybiB0aGUgc3Vic2NyaXB0aW9uIGRlcG9zaXQgaGVyZS4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBTdWJDYW5jZWxlZChzdWJJZCwgbXNnLnNlbmRlcik7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgcGxhY2UgYW4gYWN0aXZlIG9mZmVyIG9uIGhvbGQ7IGl0IG1lYW5zIG5vIHN1YnNjcmlwdGlvbnMgY2FuIGJlIGNyZWF0ZWQgZnJvbSB0aGlzIG9mZmVyLgogICAgLy8vICAgICAgICBPbmx5IHNlcnZpY2UgcHJvdmlkZXIgKG9yIHBsYXRmb3JtIG93bmVyKSBpcyBhbGxvd2VkIHRvIGhvbGQvdW5ob2xkIGEgc3Vic2NyaXB0aW9uIG9mZmVyLgogICAgLy8vQHBhcmFtIG9mZmVySWQgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgcGxhY2VkIG9uIGhvbGQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uT2ZmZXIodWludCBvZmZlcklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIG9mZmVyID0gc3Vic2NyaXB0aW9uc1tvZmZlcklkXTsKICAgICAgICBhc3NlcnQgKF9pc09mZmVyKG9mZmVyKSk7CiAgICAgICAgcmVxdWlyZSAobXNnLnNlbmRlciA9PSBvZmZlci50cmFuc2ZlclRvIHx8IG1zZy5zZW5kZXIgPT0gb3duZXIpOyAvL29ubHkgb3duZXIgb3Igc2VydmljZSBwcm92aWRlciBjYW4gcGxhY2UgdGhlIG9mZmVyIG9uIGhvbGQuCiAgICAgICAgaWYgKG9mZmVyLm9uSG9sZFNpbmNlID09IDApIHsKICAgICAgICAgICAgb2ZmZXIub25Ib2xkU2luY2UgPSBub3c7CiAgICAgICAgICAgIE9mZmVyT25Ib2xkKG9mZmVySWQsIHRydWUsIG1zZy5zZW5kZXIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzQ29udHJhY3QobXNnLnNlbmRlcikpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgZWxzZSB7IHRocm93OyB9CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgcmVzdW1lIG9uLWhvbGQgb2ZmZXI7IHN1YnNjcmlwdGlvbnMgY2FuIGJlIGNyZWF0ZWQgZnJvbSB0aGlzIG9mZmVyIGFnYWluIChpZiBvdGhlciBjb25kaXRpb25zIGFyZSBtZXQpLgogICAgLy8vICAgICAgICBPbmx5IHNlcnZpY2UgcHJvdmlkZXIgKG9yIHBsYXRmb3JtIG93bmVyKSBpcyBhbGxvd2VkIHRvIGhvbGQvdW5ob2xkIGEgc3Vic2NyaXB0aW9uIG9mZmVyLgogICAgLy8vQHBhcmFtIG9mZmVySWQgLSBpZCBvZiB0aGUgb2ZmZXIgdG8gYmUgcmVzdW1lZC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbk9mZmVyKHVpbnQgb2ZmZXJJZCkgcHVibGljIG5vdFN1c3BlbmRlZCByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICBTdWJzY3JpcHRpb24gc3RvcmFnZSBvZmZlciA9IHN1YnNjcmlwdGlvbnNbb2ZmZXJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNPZmZlcihvZmZlcikpOwogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gb2ZmZXIudHJhbnNmZXJUbyB8fCBtc2cuc2VuZGVyID09IG93bmVyKTsgLy9vbmx5IG93bmVyIG9yIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlYWN0aXZhdGUgdGhlIG9mZmVyLgogICAgICAgIGlmIChvZmZlci5vbkhvbGRTaW5jZSA+IDApIHsKICAgICAgICAgICAgb2ZmZXIub25Ib2xkU2luY2UgPSAwOwogICAgICAgICAgICBPZmZlck9uSG9sZChvZmZlcklkLCBmYWxzZSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb3Igc2VydmljZSBwcm92aWRlciB0byBwbGFjZSBhIHN1YnNjcmlwdGlvbiBvbiBob2xkLgogICAgLy8vICAgICAgICBJZiBjYWxsIGlzIG9yaWdpbmF0ZWQgYnkgY3VzdG9tZXIgdGhlIHNlcnZpY2UgcHJvdmlkZXIgY2FuIHJlamVjdCB0aGUgcmVxdWVzdC4KICAgIC8vLyAgICAgICAgQSBzdWJzY3JpcHRpb24gb24gaG9sZCB3aWxsIG5vdCBiZSBjaGFyZ2VkLiBUaGUgc2VydmljZSBpcyB1c3VhbGx5IG5vdCBwcm92aWRlZCBhcyB3ZWxsLgogICAgLy8vICAgICAgICBEdXJpbmcgaG9sZCB0aW1lIGEgc3Vic2NyaXB0aW9uIHByZXNlcnZlIHJlbWFpbmluZyBwYWlkIHRpbWUgcGVyaW9kLCB3aGljaCBiZWNvbWVzIGF2YWlsYWJsZSBhZnRlciB1bmhvbGQuCiAgICAvLy9AcmV0dXJuIGB0cnVlYCBvbiBzdWNjZXNzOyBgZmFsc2VgIG9mIGZhaWx1cmUgKGlmIGNhbGxlciBpcyBhIGNvbnRyYWN0KSBvciB0aHJvdyBhbiBleGNlcHRpb24gKGlmIGNhbGxlciBpcyBub3QgYSBjb250cmFjdCkKICAgIC8vCiAgICBmdW5jdGlvbiBob2xkU3Vic2NyaXB0aW9uKHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgbm9SZWVudHJhbmN5KEwwNCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViID0gc3Vic2NyaXB0aW9uc1tzdWJJZF07CiAgICAgICAgYXNzZXJ0IChfaXNTdWJzY3JpcHRpb24oc3ViKSk7CiAgICAgICAgdmFyIF90byA9IHN1Yi50cmFuc2ZlclRvOwogICAgICAgIHJlcXVpcmUgKG1zZy5zZW5kZXIgPT0gX3RvIHx8IG1zZy5zZW5kZXIgPT0gc3ViLnRyYW5zZmVyRnJvbSk7IC8vb25seSBjdXN0b21lciBvciBwcm92aWRlciBjYW4gcGxhY2UgdGhlIHN1YnNjcmlwdGlvbiBvbiBob2xkLgogICAgICAgIGlmIChzdWIub25Ib2xkU2luY2UgPT0gMCkgewogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBfdG8gfHwgU2VydmljZVByb3ZpZGVyKF90bykub25TdWJVbkhvbGQoc3ViSWQsIG1zZy5zZW5kZXIsIHRydWUpKSB7ICAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgICAgICAgICAgc3ViLm9uSG9sZFNpbmNlID0gbm93OwogICAgICAgICAgICAgICAgU3ViT25Ib2xkKHN1YklkLCB0cnVlLCBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChpc0NvbnRyYWN0KG1zZy5zZW5kZXIpKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIGVsc2UgeyB0aHJvdzsgfQogICAgfQoKCiAgICAvLy9Abm90aWNlIGNhbGxlZCBieSBjdXN0b21lciBvciBzZXJ2aWNlIHByb3ZpZGVyIHRvIHVuaG9sZCBzdWJzY3JpcHRpb24uCiAgICAvLy8gICAgICAgIElmIGNhbGwgaXMgb3JpZ2luYXRlZCBieSBjdXN0b21lciB0aGUgc2VydmljZSBwcm92aWRlciBjYW4gcmVqZWN0IHRoZSByZXF1ZXN0LgogICAgLy8vICAgICAgICBBIHN1YnNjcmlwdGlvbiBvbiBob2xkIHdpbGwgbm90IGJlIGNoYXJnZWQuIFRoZSBzZXJ2aWNlIGlzIHVzdWFsbHkgbm90IHByb3ZpZGVkIGFzIHdlbGwuCiAgICAvLy8gICAgICAgIER1cmluZyBob2xkIHRpbWUgYSBzdWJzY3JpcHRpb24gcHJlc2VydmUgcmVtYWluaW5nIHBhaWQgdGltZSBwZXJpb2QsIHdoaWNoIGJlY29tZXMgYXZhaWxhYmxlIGFmdGVyIHVuaG9sZC4KICAgIC8vL0ByZXR1cm4gYHRydWVgIG9uIHN1Y2Nlc3M7IGBmYWxzZWAgb2YgZmFpbHVyZSAoaWYgY2FsbGVyIGlzIGEgY29udHJhY3QpIG9yIHRocm93IGFuIGV4Y2VwdGlvbiAoaWYgY2FsbGVyIGlzIG5vdCBhIGNvbnRyYWN0KQogICAgLy8KICAgIGZ1bmN0aW9uIHVuaG9sZFN1YnNjcmlwdGlvbih1aW50IHN1YklkKSBwdWJsaWMgbm90U3VzcGVuZGVkIG5vUmVlbnRyYW5jeShMMDUpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoX2lzU3Vic2NyaXB0aW9uKHN1YikpOwogICAgICAgIHZhciBfdG8gPSBzdWIudHJhbnNmZXJUbzsKICAgICAgICByZXF1aXJlIChtc2cuc2VuZGVyID09IF90byB8fCBtc2cuc2VuZGVyID09IHN1Yi50cmFuc2ZlckZyb20pOyAvL29ubHkgY3VzdG9tZXIgb3IgcHJvdmlkZXIgY2FuIHBsYWNlIHRoZSBzdWJzY3JpcHRpb24gb24gaG9sZC4KICAgICAgICBpZiAoc3ViLm9uSG9sZFNpbmNlID4gMCkgewogICAgICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBfdG8gfHwgU2VydmljZVByb3ZpZGVyKF90bykub25TdWJVbkhvbGQoc3ViSWQsIG1zZy5zZW5kZXIsIGZhbHNlKSkgeyAgICAgICAgIC8vIDw9PT0gcG9zc2libGUgcmVlbnRyYW5jeQogICAgICAgICAgICAgICAgc3ViLnBhaWRVbnRpbCArPSBub3cgLSBzdWIub25Ib2xkU2luY2U7CiAgICAgICAgICAgICAgICBzdWIub25Ib2xkU2luY2UgPSAwOwogICAgICAgICAgICAgICAgU3ViT25Ib2xkKHN1YklkLCBmYWxzZSwgbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaXNDb250cmFjdChtc2cuc2VuZGVyKSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBlbHNlIHsgdGhyb3c7IH0KICAgIH0KCgoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIC8vICogICAgICAgICAgICAgIGRlcG9zaXQgaGFuZGxpbmcgICAgICAgICAgICAgICAgICoKICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAvLy9Abm90aWNlIGNhbiBiZSBjYWxsZWQgYnkgcHJvdmlkZXIgb24gQ0FOQ0VMRUQgc3Vic2NyaXB0aW9uIHRvIHJldHVybiBhIHN1YnNjcmlwdGlvbiBkZXBvc2l0IHRvIGN1c3RvbWVyIGltbWVkaWF0ZWx5LgogICAgLy8vICAgICAgICBDdXN0b21lciBjYW4gYW55d2F5IGNvbGxlY3QgaGlzIGRlcG9zaXQgYWZ0ZXIgYHBhaWRVbnRpbGAgcGVyaW9kIGlzIG92ZXIuCiAgICAvLy9AcGFyYW0gc3ViSWQgLSBzdWJzY3JpcHRpb24gaG9sZGluZyB0aGUgZGVwb3NpdAogICAgLy8KICAgIGZ1bmN0aW9uIHJldHVyblN1YnNjcmlwdGlvbkRlc3Bvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoX3N1YnNjcmlwdGlvblN0YXRlKHN1YikgPT0gU3ViU3RhdGUuQ0FOQ0VMRUQpOwogICAgICAgIGFzc2VydCAoc3ViLmRlcG9zaXRBbW91bnQgPiAwKTsgLy9zYW5pdHkgY2hlY2sKICAgICAgICBhc3NlcnQgKHN1Yi50cmFuc2ZlclRvID09IG1zZy5zZW5kZXIgfHwgb3duZXIgPT0gbXNnLnNlbmRlcik7IC8vb25seSBzdWJzY3JpcHRpb24gb3duZXIgb3IgcGxhdGZvcm0gb3duZXIgaXMgYWxsb3dlZCB0byByZWxlYXNlIGRlcG9zaXQuCiAgICAgICAgc3ViLmV4cGlyZU9uID0gbm93OwogICAgICAgIF9yZXR1cm5TdWJzY3JpcHRpb25EZXNwb3NpdChzdWJJZCwgc3ViKTsKICAgIH0KCgogICAgLy8vQG5vdGljZSBjYWxsZWQgYnkgY3VzdG9tZXIgb24gRVhQSVJFRCBzdWJzY3JpcHRpb24gKGBwYWlkVW50aWxgIHBlcmlvZCBpcyBvdmVyKSB0byBjb2xsZWN0IGEgc3Vic2NyaXB0aW9uIGRlcG9zaXQuCiAgICAvLy8gICAgICAgIEN1c3RvbWVyIGNhbiBhbnl3YXkgY29sbGVjdCBoaXMgZGVwb3NpdCBhZnRlciBgcGFpZFVudGlsYCBwZXJpb2QgaXMgb3Zlci4KICAgIC8vL0BwYXJhbSBzdWJJZCAtIHN1YnNjcmlwdGlvbiBob2xkaW5nIHRoZSBkZXBvc2l0CiAgICAvLwogICAgZnVuY3Rpb24gY2xhaW1TdWJzY3JpcHRpb25EZXBvc2l0KHVpbnQgc3ViSWQpIHB1YmxpYyBub3RTdXNwZW5kZWQgewogICAgICAgIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YiA9IHN1YnNjcmlwdGlvbnNbc3ViSWRdOwogICAgICAgIGFzc2VydCAoX3N1YnNjcmlwdGlvblN0YXRlKHN1YikgPT0gU3ViU3RhdGUuRVhQSVJFRCk7CiAgICAgICAgYXNzZXJ0IChzdWIudHJhbnNmZXJGcm9tID09IG1zZy5zZW5kZXIpOwogICAgICAgIGFzc2VydCAoc3ViLmRlcG9zaXRBbW91bnQgPiAwKTsKICAgICAgICBfcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQoc3ViSWQsIHN1Yik7CiAgICB9CgoKICAgIC8vQGRldiByZXR1cm5zIHN1YnNjcmlwdGlvbiBkZXBvc2l0IHRvIGN1c3RvbWVyCiAgICBmdW5jdGlvbiBfcmV0dXJuU3Vic2NyaXB0aW9uRGVzcG9zaXQodWludCBzdWJJZCwgU3Vic2NyaXB0aW9uIHN0b3JhZ2Ugc3ViKSBpbnRlcm5hbCB7CiAgICAgICAgdWludCBkZXBvc2l0QW1vdW50ID0gc3ViLmRlcG9zaXRBbW91bnQ7CiAgICAgICAgc3ViLmRlcG9zaXRBbW91bnQgPSAwOwogICAgICAgIHNhbi5fbWludEZyb21EZXBvc2l0KHN1Yi50cmFuc2ZlckZyb20sIGRlcG9zaXRBbW91bnQpOwogICAgICAgIFN1YnNjcmlwdGlvbkRlcG9zaXRSZXR1cm5lZChzdWJJZCwgZGVwb3NpdEFtb3VudCwgc3ViLnRyYW5zZmVyRnJvbSwgbXNnLnNlbmRlcik7CiAgICB9CgoKICAgIC8vL0Bub3RpY2UgY3JlYXRlIHNpbXBsZSB1bmxvY2tlZCBkZXBvc2l0LCByZXF1aXJlZCBieSBzb21lIHNlcnZpY2VzLiBJdCBjYW4gYmUgY29uc2lkZXJlZCBhcyBwcm92ZSBvZiBjdXN0b21lcidzIHN0YWtlLgogICAgLy8vICAgICAgICBUaGlzIGRlc3Bvc2l0IGNhbiBiZSBjbGFpbWVkIGJhY2sgYnkgdGhlIGN1c3RvbWVyIGF0IGFueXRpbWUuCiAgICAvLy8gICAgICAgIFRoZSBzZXJ2aWNlIHByb3ZpZGVyIGlzIHJlc3BvbnNpYmxlIHRvIGNoZWNrIHRoZSBkZXBvc2l0IGJlZm9yZSBwcm92aWRpbmcgdGhlIHNlcnZpY2UuCiAgICAvLy9AcGFyYW0gX3ZhbHVlIC0gbm9uIHplcm8gZGVwb3NpdCBhbW91bnQuCiAgICAvLy9AcGFyYW0gX2Rlc2NyaXB0b3IgLSBpcyBhIHVuaXEga2V5LCB1c3VhbGx5IGdpdmVuIGJ5IHNlcnZpY2UgcHJvdmlkZXIgdG8gdGhlIGN1c3RvbWVyIGluIG9yZGVyIHRvIG1ha2UgdGhpcyBkZXBvc2l0IHVuaXF1ZS4KICAgIC8vLyAgICAgICAgU2VydmljZSBQcm92aWRlciBzaG91bGQgcmVqZWN0IGRlcG9zaXQgd2l0aCB1bmtub3duIGRlc2NyaXB0b3IsIGJlY2F1c2UgbW9zdCBwcm9iYWJseSBpdCBpcyBpbiB1c2UgZm9yIHNvbWUgYW5vdGhlciBzZXJ2aWNlLgogICAgLy8vQHJldHVybiBkZXBvc2l0SWQgLSBhIGhhbmRsZSB0byBjbGFpbSBiYWNrIHRoZSBkZXBvc2l0IGxhdGVyLgogICAgLy8KICAgIGZ1bmN0aW9uIGNyZWF0ZURlcG9zaXQodWludCBfdmFsdWUsIHVpbnQgX2xvY2tUaW1lLCBieXRlcyBfZGVzY3JpcHRvcikgcHVibGljIG5vdFN1c3BlbmRlZCByZXR1cm5zICh1aW50IGRlcG9zaXRJZCkgewogICAgICAgIHJlcXVpcmUgKF92YWx1ZSA+IDApOwogICAgICAgIGFzc2VydCAoc2FuLl9idXJuRm9yRGVwb3NpdChtc2cuc2VuZGVyLF92YWx1ZSkpOwogICAgICAgIGRlcG9zaXRzWysrZGVwb3NpdENvdW50ZXJdID0gRGVwb3NpdCAoewogICAgICAgICAgICBvd25lciA6IG1zZy5zZW5kZXIsCiAgICAgICAgICAgIHZhbHVlIDogX3ZhbHVlLAogICAgICAgICAgICBjcmVhdGVkT24gOiBub3csCiAgICAgICAgICAgIGxvY2tUaW1lIDogX2xvY2tUaW1lLAogICAgICAgICAgICBkZXNjcmlwdG9yIDogX2Rlc2NyaXB0b3IKICAgICAgICB9KTsKICAgICAgICBOZXdEZXBvc2l0KGRlcG9zaXRDb3VudGVyLCBfdmFsdWUsIF9sb2NrVGltZSwgbXNnLnNlbmRlcik7CiAgICAgICAgcmV0dXJuIGRlcG9zaXRDb3VudGVyOwogICAgfQoKCiAgICAvLy9Abm90aWNlIHJldHVybiBwcmV2aW91c2x5IGNyZWF0ZWQgZGVwb3NpdCB0byB0aGUgdXNlci4gVXNlciBjYW4gY29sbGVjdCBvbmx5IG93biBkZXBvc2l0LgogICAgLy8vICAgICAgICBUaGUgc2VydmljZSBwcm92aWRlciBpcyByZXNwb25zaWJsZSB0byBjaGVjayB0aGUgZGVwb3NpdCBiZWZvcmUgcHJvdmlkaW5nIHRoZSBzZXJ2aWNlLgogICAgLy8vQHBhcmFtIF9kZXBvc2l0SWQgLSBhbiBpZCBvZiB0aGUgZGVwb3NpdCB0byBiZSBjb2xsZWN0ZWQuCiAgICAvLwogICAgZnVuY3Rpb24gY2xhaW1EZXBvc2l0KHVpbnQgX2RlcG9zaXRJZCkgcHVibGljIG5vdFN1c3BlbmRlZCB7CiAgICAgICAgdmFyIGRlcG9zaXQgPSBkZXBvc2l0c1tfZGVwb3NpdElkXTsKICAgICAgICByZXF1aXJlIChkZXBvc2l0Lm93bmVyID09IG1zZy5zZW5kZXIpOwogICAgICAgIGFzc2VydCAoZGVwb3NpdC5sb2NrVGltZSA9PSAwIHx8IGRlcG9zaXQuY3JlYXRlZE9uICsgIGRlcG9zaXQubG9ja1RpbWUgPCBub3cpOwogICAgICAgIHZhciB2YWx1ZSA9IGRlcG9zaXRzW19kZXBvc2l0SWRdLnZhbHVlOwogICAgICAgIGRlbGV0ZSBkZXBvc2l0c1tfZGVwb3NpdElkXTsKICAgICAgICBzYW4uX21pbnRGcm9tRGVwb3NpdChtc2cuc2VuZGVyLCB2YWx1ZSk7CiAgICAgICAgRGVwb3NpdFJldHVybmVkKF9kZXBvc2l0SWQsIG1zZy5zZW5kZXIpOwogICAgfQoKCgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgLy8gKiAgICAgICAgICAgIHNvbWUgaW50ZXJuYWwgZnVuY3Rpb25zICAgICAgICAgICAgKgogICAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKICAgIGZ1bmN0aW9uIF9hbW91bnRUb0NoYXJnZShTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIHJlZW50cmFudCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIF9hcHBseVhjaGFuZ2VSYXRlKHN1Yi5wcmljZVBlckhvdXIgKiBzdWIuY2hhcmdlUGVyaW9kLCBzdWIpIC8gMSBob3VyczsgICAgICAgLy8gPD09PT0gcmVlbnRyYW50IGZ1bmN0aW9uIHVzYWdlCiAgICB9CgogICAgZnVuY3Rpb24gX2FwcGx5WGNoYW5nZVJhdGUodWludCBhbW91bnQsIFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgcmVlbnRyYW50IHJldHVybnMgKHVpbnQpIHsgIC8vIDw9PSBhY3R1YWxseSBjYWxsZWQgZnJvbSByZWVudHJhbmN5IGd1YXJkZWQgY29udGV4dCBvbmx5IChpLmUuIGV4dGVybmFsbHkgc2VjdXJlZCkKICAgICAgICBpZiAoc3ViLnhyYXRlUHJvdmlkZXJJZCA+IDApIHsKICAgICAgICAgICAgLy8geHJhdGVfbjogbm9taW5hdG9yCiAgICAgICAgICAgIC8vIHhyYXRlX2Q6IGRlbm9taW5hdG9yIG9mIHRoZSBleGNoYW5nZSByYXRlIGZyYWN0aW9uLgogICAgICAgICAgICB2YXIgKHhyYXRlX24sIHhyYXRlX2QpID0gWFJhdGVQcm92aWRlcih4cmF0ZVByb3ZpZGVyc1tzdWIueHJhdGVQcm92aWRlcklkXSkuZ2V0UmF0ZSgpOyAgICAgICAgLy8gPD09PSBwb3NzaWJsZSByZWVudHJhbmN5CiAgICAgICAgICAgIGFtb3VudCA9IGFtb3VudCAqIHN1Yi5pbml0aWFsWHJhdGVfbiAqIHhyYXRlX2QgLyBzdWIuaW5pdGlhbFhyYXRlX2QgLyB4cmF0ZV9uOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc09mZmVyKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlckZyb20gPT0gMCAmJiBzdWIudHJhbnNmZXJUbyAhPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIF9pc1N1YnNjcmlwdGlvbihTdWJzY3JpcHRpb24gc3RvcmFnZSBzdWIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpewogICAgICAgIHJldHVybiBzdWIudHJhbnNmZXJGcm9tICE9IDAgJiYgc3ViLnRyYW5zZmVyVG8gIT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBfZXhpc3RzKFN1YnNjcmlwdGlvbiBzdG9yYWdlIHN1YikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgcmV0dXJuIHN1Yi50cmFuc2ZlclRvICE9IDA7ICAgLy9leGlzdGluZyBzdWJzY3JpcHRpb24gb3Igb2ZmZXIgaGFzIGFsd2F5cyB0cmFuc2ZlclRvIHNldC4KICAgIH0KCiAgICBtb2RpZmllciBvbmx5UmVnaXN0ZXJlZFByb3ZpZGVyKCl7CiAgICAgICAgaWYgKCFwcm92aWRlclJlZ2lzdHJ5W21zZy5zZW5kZXJdKSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdFN1c3BlbmRlZCB7CiAgICAgICAgaWYgKHN1c3BlbmRlZFVudGlsID4gbm93KSB0aHJvdzsKICAgICAgICBfOwogICAgfQoKfSAvL1N1YnNjcmlwdGlvbk1vZHVsZUltcGw='.
	

]
