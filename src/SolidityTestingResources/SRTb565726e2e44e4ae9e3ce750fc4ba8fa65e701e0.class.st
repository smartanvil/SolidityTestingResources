Class {
	#name : #SRTb565726e2e44e4ae9e3ce750fc4ba8fa65e701e0,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb565726e2e44e4ae9e3ce750fc4ba8fa65e701e0 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Ci8qKgogKiBAdGl0bGUgRVJDMjAKICogQGRldiBFUkMyMCBpbnRlcmZhY2UKICovCmNvbnRyYWN0IEVSQzIwIHsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBzcGVuZGVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9Ci8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KfQovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgdWludDI1NiBjID0gYSAqIGI7CiAgICBhc3NlcnQoYSA9PSAwIHx8IGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAvLyBhc3NlcnQoYiA+IDApOyAvLyBTb2xpZGl0eSBhdXRvbWF0aWNhbGx5IHRocm93cyB3aGVuIGRpdmlkaW5nIGJ5IDAKICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgLy8gYXNzZXJ0KGEgPT0gYiAqIGMgKyBhICUgYik7IC8vIFRoZXJlIGlzIG5vIGNhc2UgaW4gd2hpY2ggdGhpcyBkb2Vzbid0IGhvbGQKICAgIHJldHVybiBjOwogIH0KICBmdW5jdGlvbiBzdWIodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CmNvbnRyYWN0IENvbnRyb2xsZWQgewogICAgLy8vIEBub3RpY2UgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsCiAgICAvLy8gIGEgZnVuY3Rpb24gd2l0aCB0aGlzIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlciB7IHJlcXVpcmUobXNnLnNlbmRlciA9PSBjb250cm9sbGVyKTsgXzsgfQogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKICAgIGZ1bmN0aW9uIENvbnRyb2xsZWQoKSBwdWJsaWMgeyBjb250cm9sbGVyID0gbXNnLnNlbmRlcjt9CiAgICAvLy8gQG5vdGljZSBDaGFuZ2VzIHRoZSBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbmV3Q29udHJvbGxlciBUaGUgbmV3IGNvbnRyb2xsZXIgb2YgdGhlIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBjaGFuZ2VDb250cm9sbGVyKGFkZHJlc3MgX25ld0NvbnRyb2xsZXIpIHB1YmxpYyBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgY29udHJvbGxlciA9IF9uZXdDb250cm9sbGVyOwogICAgfQp9Ci8qKgogKiBAdGl0bGUgTWluaU1lIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwTWluaU1lIGlzIEVSQzIwLCBDb250cm9sbGVkIHsKICAgIGZ1bmN0aW9uIGFwcHJvdmVBbmRDYWxsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCwgYnl0ZXMgX2V4dHJhRGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZkF0KGFkZHJlc3MgX293bmVyLCB1aW50IF9ibG9ja051bWJlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludCk7CiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseUF0KHVpbnQgX2Jsb2NrTnVtYmVyKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbihzdHJpbmcgX2Nsb25lVG9rZW5OYW1lLCB1aW50OCBfY2xvbmVEZWNpbWFsVW5pdHMsIHN0cmluZyBfY2xvbmVUb2tlblN5bWJvbCwgdWludCBfc25hcHNob3RCbG9jaywgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgcHVibGljIHJldHVybnMoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50KSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBkZXN0cm95VG9rZW5zKGFkZHJlc3MgX293bmVyLCB1aW50IF9hbW91bnQpICBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgcHVibGljOwogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBpbnRlcm5hbCB2aWV3IHJldHVybnMoYm9vbCk7CiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgcHVibGljOwogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQgX2Ftb3VudCk7CiAgICBldmVudCBOZXdDbG9uZVRva2VuKGFkZHJlc3MgaW5kZXhlZCBfY2xvbmVUb2tlbiwgdWludCBfc25hcHNob3RCbG9jayk7Cn0KLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUKICogQGRldiBDcm93ZHNhbGUgaXMgYSBiYXNlIGNvbnRyYWN0IGZvciBtYW5hZ2luZyBhIHRva2VuIGNyb3dkc2FsZS4KICogQ3Jvd2RzYWxlcyBoYXZlIGEgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzLCB3aGVyZSBpbnZlc3RvcnMgY2FuIG1ha2UKICogdG9rZW4gcHVyY2hhc2VzIGFuZCB0aGUgY3Jvd2RzYWxlIHdpbGwgYXNzaWduIHRoZW0gdG9rZW5zIGJhc2VkCiAqIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAogKiBhcyB0aGV5IGFycml2ZS4KICovCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CiAgLy8gVGhlIHRva2VuIGJlaW5nIHNvbGQKICBFUkMyME1pbmlNZSBwdWJsaWMgdG9rZW47CiAgLy8gc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzIHdoZXJlIGludmVzdG1lbnRzIGFyZSBhbGxvd2VkIChib3RoIGluY2x1c2l2ZSkKICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7CiAgdWludDI1NiBwdWJsaWMgZW5kVGltZTsKICAvLyBhZGRyZXNzIHdoZXJlIGZ1bmRzIGFyZSBjb2xsZWN0ZWQKICBhZGRyZXNzIHB1YmxpYyB3YWxsZXQ7CiAgLy8gaG93IG1hbnkgdG9rZW4gdW5pdHMgYSBidXllciBnZXRzIHBlciB3ZWkKICB1aW50MjU2IHB1YmxpYyByYXRlOwogIC8vIGFtb3VudCBvZiByYWlzZWQgbW9uZXkgaW4gd2VpCiAgdWludDI1NiBwdWJsaWMgd2VpUmFpc2VkOwogIC8qKgogICAqIGV2ZW50IGZvciB0b2tlbiBwdXJjaGFzZSBsb2dnaW5nCiAgICogQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAqIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgKiBAcGFyYW0gdmFsdWUgd2VpcyBwYWlkIGZvciBwdXJjaGFzZQogICAqIEBwYXJhbSBhbW91bnQgYW1vdW50IG9mIHRva2VucyBwdXJjaGFzZWQKICAgKi8KICBldmVudCBUb2tlblB1cmNoYXNlKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCBiZW5lZmljaWFyeSwgdWludDI1NiB2YWx1ZSwgdWludDI1NiBhbW91bnQpOwogIGZ1bmN0aW9uIENyb3dkc2FsZSh1aW50MjU2IF9zdGFydFRpbWUsIHVpbnQyNTYgX2VuZFRpbWUsIHVpbnQyNTYgX3JhdGUsIGFkZHJlc3MgX3dhbGxldCkgewogICAgcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICByZXF1aXJlKF9lbmRUaW1lID49IF9zdGFydFRpbWUpOwogICAgcmVxdWlyZShfcmF0ZSA+IDApOwogICAgcmVxdWlyZShfd2FsbGV0ICE9IDB4MCk7CiAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgZW5kVGltZSA9IF9lbmRUaW1lOwogICAgcmF0ZSA9IF9yYXRlOwogICAgd2FsbGV0ID0gX3dhbGxldDsKICB9CiAgLy8gZmFsbGJhY2sgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gYnV5IHRva2VucwogIGZ1bmN0aW9uICgpIHBheWFibGUgewogICAgYnV5VG9rZW5zKG1zZy5zZW5kZXIpOwogIH0KICAvLyBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgewogICAgYnV5VG9rZW5zKGJlbmVmaWNpYXJ5LCBtc2cudmFsdWUpOwogIH0KICAvLyBpbXBsZW1lbnRhdGlvbiBvZiBsb3cgbGV2ZWwgdG9rZW4gcHVyY2hhc2UgZnVuY3Rpb24KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHsKICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkgIT0gMHgwKTsKICAgIHJlcXVpcmUodmFsaWRQdXJjaGFzZSh3ZWlBbW91bnQpKTsKICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwogICAgdHJhbnNmZXJUb2tlbihiZW5lZmljaWFyeSwgd2VpQW1vdW50KTsKICAgIGZvcndhcmRGdW5kcyh3ZWlBbW91bnQpOwogIH0KICAvLyBsb3cgbGV2ZWwgdHJhbnNmZXIgdG9rZW4KICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIHRva2VuIHRyYW5zZmVyIG1lY2hhbmlzbSwgZWcuIHB1bGwgcGF0dGVybgogIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHsKICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgdWludDI1NiB0b2tlbnMgPSB3ZWlBbW91bnQubXVsKHJhdGUpOwogICAgdG9rZW4uZ2VuZXJhdGVUb2tlbnMoYmVuZWZpY2lhcnksIHRva2Vucyk7CiAgICBUb2tlblB1cmNoYXNlKG1zZy5zZW5kZXIsIGJlbmVmaWNpYXJ5LCB3ZWlBbW91bnQsIHRva2Vucyk7CiAgfQogIC8vIHNlbmQgZXRoZXIgdG8gdGhlIGZ1bmQgY29sbGVjdGlvbiB3YWxsZXQKICAvLyBvdmVycmlkZSB0byBjcmVhdGUgY3VzdG9tIGZ1bmQgZm9yd2FyZGluZyBtZWNoYW5pc21zCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKHVpbnQyNTYgd2VpQW1vdW50KSBpbnRlcm5hbCB7CiAgICB3YWxsZXQudHJhbnNmZXIod2VpQW1vdW50KTsKICB9CiAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogIGZ1bmN0aW9uIHZhbGlkUHVyY2hhc2UodWludDI1NiB3ZWlBbW91bnQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgYm9vbCB3aXRoaW5QZXJpb2QgPSBub3cgPj0gc3RhcnRUaW1lICYmIG5vdyA8PSBlbmRUaW1lOwogICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSB3ZWlBbW91bnQgIT0gMDsKICAgIHJldHVybiB3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlOwogIH0KICAvLyBAcmV0dXJuIHRydWUgaWYgY3Jvd2RzYWxlIGV2ZW50IGhhcyBlbmRlZAogIGZ1bmN0aW9uIGhhc0VuZGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+IGVuZFRpbWU7CiAgfQogIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgaGFzIHN0YXJ0ZWQKICBmdW5jdGlvbiBoYXNTdGFydGVkKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIG5vdyA+PSBzdGFydFRpbWU7CiAgfQp9Ci8vLyBAZGV2IFRoZSB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0IG11c3QgaW1wbGVtZW50IHRoZXNlIGZ1bmN0aW9ucwpjb250cmFjdCBUb2tlbkNvbnRyb2xsZXIgewogICAgRVJDMjBNaW5pTWUgcHVibGljIGV0aGVhbFRva2VuOwogICAgYWRkcmVzcyBwdWJsaWMgU0FMRTsgLy8gYWRkcmVzcyB3aGVyZSBzYWxlIHRva2VucyBhcmUgbG9jYXRlZAogICAgLy8vIEBub3RpY2UgbmVlZGVkIGZvciBob2RsZXIgaGFuZGxpbmcKICAgIGZ1bmN0aW9uIGFkZEhvZGxlclN0YWtlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50IF9zdGFrZSkgcHVibGljOwogICAgZnVuY3Rpb24gc2V0SG9kbGVyU3Rha2UoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3N0YWtlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBzZXRIb2RsZXJUaW1lKHVpbnQyNTYgX3RpbWUpIHB1YmxpYzsKICAgIC8vLyBAbm90aWNlIENhbGxlZCB3aGVuIGBfb3duZXJgIHNlbmRzIGV0aGVyIHRvIHRoZSBNaW5pTWUgVG9rZW4gY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgc2VudCB0aGUgZXRoZXIgdG8gY3JlYXRlIHRva2VucwogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgZXRoZXIgaXMgYWNjZXB0ZWQsIGZhbHNlIGlmIGl0IHRocm93cwogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX293bmVyKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zKGJvb2wpOwogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYSB0b2tlbiB0cmFuc2ZlciBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBvcmlnaW4gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF90byBUaGUgZGVzdGluYXRpb24gb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0aGUgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgdHJhbnNmZXIKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQgX2Ftb3VudCkgcHVibGljIHJldHVybnMoYm9vbCk7CiAgICAvLy8gQG5vdGljZSBOb3RpZmllcyB0aGUgY29udHJvbGxlciBhYm91dCBhbiBhcHByb3ZhbCBhbGxvd2luZyB0aGUKICAgIC8vLyAgY29udHJvbGxlciB0byByZWFjdCBpZiBkZXNpcmVkCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IGNhbGxzIGBhcHByb3ZlKClgCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBzcGVuZGVyIGluIHRoZSBgYXBwcm92ZSgpYCBjYWxsCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEByZXR1cm4gRmFsc2UgaWYgdGhlIGNvbnRyb2xsZXIgZG9lcyBub3QgYXV0aG9yaXplIHRoZSBhcHByb3ZhbAogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hbW91bnQpIHB1YmxpYyByZXR1cm5zKGJvb2wpOwp9Ci8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBwYXVzZWQuCiAgICovCiAgbW9kaWZpZXIgd2hlblBhdXNlZCgpIHsKICAgIHJlcXVpcmUocGF1c2VkKTsKICAgIF87CiAgfQogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogIH0KfQovKioKICogQHRpdGxlIEhvZGxlcgogKiBAZGV2IEhhbmRsZXMgaG9kbGVyIHJld2FyZCwgVG9rZW5Db250cm9sbGVyIHNob3VsZCBjcmVhdGUgYW5kIG93biBpdC4KICovCmNvbnRyYWN0IEhvZGxlciBpcyBPd25hYmxlIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50OwogICAgLy8gSE9ETEVSIHJld2FyZCB0cmFja2VyCiAgICAvLyBzdGFrZSBhbW91bnQgcGVyIGFkZHJlc3MKICAgIHN0cnVjdCBIT0RMIHsKICAgICAgICB1aW50MjU2IHN0YWtlOwogICAgICAgIC8vIG1vdmluZyBBTlkgZnVuZHMgaW52YWxpZGF0ZXMgaG9kbGluZyBvZiB0aGUgYWRkcmVzcwogICAgICAgIGJvb2wgaW52YWxpZDsKICAgICAgICBib29sIGNsYWltZWQzTTsKICAgICAgICBib29sIGNsYWltZWQ2TTsKICAgICAgICBib29sIGNsYWltZWQ5TTsKICAgIH0KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gSE9ETCkgcHVibGljIGhvZGxlclN0YWtlczsKICAgIC8vIHRvdGFsIGN1cnJlbnQgc3Rha2luZyB2YWx1ZSBhbmQgaG9kbGVyIGFkZHJlc3NlcwogICAgdWludDI1NiBwdWJsaWMgaG9kbGVyVG90YWxWYWx1ZTsKICAgIHVpbnQyNTYgcHVibGljIGhvZGxlclRvdGFsQ291bnQ7CiAgICAvLyBzdG9yZSBkYXRlcyBhbmQgdG90YWwgc3Rha2UgdmFsdWVzIGZvciAzIC0gNiAtIDkgbW9udGhzIGFmdGVyIG5vcm1hbCBzYWxlCiAgICB1aW50MjU2IHB1YmxpYyBob2RsZXJUb3RhbFZhbHVlM007CiAgICB1aW50MjU2IHB1YmxpYyBob2RsZXJUb3RhbFZhbHVlNk07CiAgICB1aW50MjU2IHB1YmxpYyBob2RsZXJUb3RhbFZhbHVlOU07CiAgICB1aW50MjU2IHB1YmxpYyBob2RsZXJUaW1lU3RhcnQ7CiAgICB1aW50MjU2IHB1YmxpYyBob2RsZXJUaW1lM007CiAgICB1aW50MjU2IHB1YmxpYyBob2RsZXJUaW1lNk07CiAgICB1aW50MjU2IHB1YmxpYyBob2RsZXJUaW1lOU07CiAgICAvLyByZXdhcmQgSEVBTCB0b2tlbiBhbW91bnQKICAgIHVpbnQyNTYgcHVibGljIFRPS0VOX0hPRExfM007CiAgICB1aW50MjU2IHB1YmxpYyBUT0tFTl9IT0RMXzZNOwogICAgdWludDI1NiBwdWJsaWMgVE9LRU5fSE9ETF85TTsKICAgIC8vIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMgY2xhaW1lZCBzbyBmYXIKICAgIHVpbnQyNTYgcHVibGljIGNsYWltZWRUb2tlbnM7CiAgICAKICAgIGV2ZW50IExvZ0hvZGxTZXRTdGFrZShhZGRyZXNzIGluZGV4ZWQgX3NldHRlciwgYWRkcmVzcyBpbmRleGVkIF9iZW5lZmljaWFyeSwgdWludDI1NiBfdmFsdWUpOwogICAgZXZlbnQgTG9nSG9kbENsYWltZWQoYWRkcmVzcyBpbmRleGVkIF9zZXR0ZXIsIGFkZHJlc3MgaW5kZXhlZCBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3ZhbHVlKTsKICAgIGV2ZW50IExvZ0hvZGxTdGFydFNldChhZGRyZXNzIGluZGV4ZWQgX3NldHRlciwgdWludDI1NiBfdGltZSk7CiAgICAvLy8gQGRldiBPbmx5IGJlZm9yZSBob2RsIGlzIHN0YXJ0ZWQKICAgIG1vZGlmaWVyIGJlZm9yZUhvZGxTdGFydCgpIHsKICAgICAgICBpZiAoaG9kbGVyVGltZVN0YXJ0ID09IDAgfHwgbm93IDw9IGhvZGxlclRpbWVTdGFydCkKICAgICAgICAgICAgXzsKICAgIH0KICAgIC8vLyBAZGV2IENvbnRydWN0b3IsIGl0IHNob3VsZCBiZSBjcmVhdGVkIGJ5IGEgVG9rZW5Db250cm9sbGVyCiAgICBmdW5jdGlvbiBIb2RsZXIodWludDI1NiBfc3Rha2UzbSwgdWludDI1NiBfc3Rha2U2bSwgdWludDI1NiBfc3Rha2U5bSkgewogICAgICAgIFRPS0VOX0hPRExfM00gPSBfc3Rha2UzbTsKICAgICAgICBUT0tFTl9IT0RMXzZNID0gX3N0YWtlNm07CiAgICAgICAgVE9LRU5fSE9ETF85TSA9IF9zdGFrZTltOwogICAgfQogICAgLy8vIEBub3RpY2UgQWRkaW5nIGhvZGxlciBzdGFrZSB0byBhbiBhY2NvdW50CiAgICAvLy8gQGRldiBPbmx5IG93bmVyIGNvbnRyYWN0IGNhbiBjYWxsIGl0IGFuZCBiZWZvcmUgaG9kbGluZyBwZXJpb2Qgc3RhcnRzCiAgICAvLy8gQHBhcmFtIF9iZW5lZmljaWFyeSBSZWNlcGllbnQgYWRkcmVzcyBvZiBob2RsZXIgc3Rha2UKICAgIC8vLyBAcGFyYW0gX3N0YWtlIEFtb3VudCBvZiBhZGRpdGlvbmFsIGhvZGxlciBzdGFrZQogICAgZnVuY3Rpb24gYWRkSG9kbGVyU3Rha2UoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3N0YWtlKSBwdWJsaWMgb25seU93bmVyIGJlZm9yZUhvZGxTdGFydCB7CiAgICAgICAgLy8gcmVhbCBjaGFuZ2UgYW5kIHZhbGlkIF9iZW5lZmljaWFyeSBpcyBuZWVkZWQKICAgICAgICBpZiAoX3N0YWtlID09IDAgfHwgX2JlbmVmaWNpYXJ5ID09IGFkZHJlc3MoMCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAKICAgICAgICAvLyBhZGQgc3Rha2UgYW5kIG1haW50YWluIGNvdW50CiAgICAgICAgaWYgKGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlID09IDApCiAgICAgICAgICAgIGhvZGxlclRvdGFsQ291bnQgPSBob2RsZXJUb3RhbENvdW50LmFkZCgxKTsKICAgICAgICBob2RsZXJTdGFrZXNbX2JlbmVmaWNpYXJ5XS5zdGFrZSA9IGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlLmFkZChfc3Rha2UpOwogICAgICAgIGhvZGxlclRvdGFsVmFsdWUgPSBob2RsZXJUb3RhbFZhbHVlLmFkZChfc3Rha2UpOwogICAgICAgIExvZ0hvZGxTZXRTdGFrZShtc2cuc2VuZGVyLCBfYmVuZWZpY2lhcnksIGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIFNldHRpbmcgaG9kbGVyIHN0YWtlIG9mIGFuIGFjY291bnQKICAgIC8vLyBAZGV2IE9ubHkgb3duZXIgY29udHJhY3QgY2FuIGNhbGwgaXQgYW5kIGJlZm9yZSBob2RsaW5nIHBlcmlvZCBzdGFydHMKICAgIC8vLyBAcGFyYW0gX2JlbmVmaWNpYXJ5IFJlY2VwaWVudCBhZGRyZXNzIG9mIGhvZGxlciBzdGFrZQogICAgLy8vIEBwYXJhbSBfc3Rha2UgQW1vdW50IHRvIHNldCB0aGUgaG9kbGVyIHN0YWtlCiAgICBmdW5jdGlvbiBzZXRIb2RsZXJTdGFrZShhZGRyZXNzIF9iZW5lZmljaWFyeSwgdWludDI1NiBfc3Rha2UpIHB1YmxpYyBvbmx5T3duZXIgYmVmb3JlSG9kbFN0YXJ0IHsKICAgICAgICAvLyByZWFsIGNoYW5nZSBhbmQgdmFsaWQgX2JlbmVmaWNpYXJ5IGlzIG5lZWRlZAogICAgICAgIGlmIChob2RsZXJTdGFrZXNbX2JlbmVmaWNpYXJ5XS5zdGFrZSA9PSBfc3Rha2UgfHwgX2JlbmVmaWNpYXJ5ID09IGFkZHJlc3MoMCkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAKICAgICAgICAvLyBhZGQgc3Rha2UgYW5kIG1haW50YWluIGNvdW50CiAgICAgICAgaWYgKGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlID09IDAgJiYgX3N0YWtlID4gMCkgewogICAgICAgICAgICBob2RsZXJUb3RhbENvdW50ID0gaG9kbGVyVG90YWxDb3VudC5hZGQoMSk7CiAgICAgICAgfSBlbHNlIGlmIChob2RsZXJTdGFrZXNbX2JlbmVmaWNpYXJ5XS5zdGFrZSA+IDAgJiYgX3N0YWtlID09IDApIHsKICAgICAgICAgICAgaG9kbGVyVG90YWxDb3VudCA9IGhvZGxlclRvdGFsQ291bnQuc3ViKDEpOwogICAgICAgIH0KICAgICAgICB1aW50MjU2IF9kaWZmID0gX3N0YWtlID4gaG9kbGVyU3Rha2VzW19iZW5lZmljaWFyeV0uc3Rha2UgPyBfc3Rha2Uuc3ViKGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlKSA6IGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlLnN1Yihfc3Rha2UpOwogICAgICAgIGlmIChfc3Rha2UgPiBob2RsZXJTdGFrZXNbX2JlbmVmaWNpYXJ5XS5zdGFrZSkgewogICAgICAgICAgICBob2RsZXJUb3RhbFZhbHVlID0gaG9kbGVyVG90YWxWYWx1ZS5hZGQoX2RpZmYpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhvZGxlclRvdGFsVmFsdWUgPSBob2RsZXJUb3RhbFZhbHVlLnN1YihfZGlmZik7CiAgICAgICAgfQogICAgICAgIGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlID0gX3N0YWtlOwogICAgICAgIExvZ0hvZGxTZXRTdGFrZShtc2cuc2VuZGVyLCBfYmVuZWZpY2lhcnksIF9zdGFrZSk7CiAgICB9CiAgICAvLy8gQG5vdGljZSBTZXR0aW5nIGhvZGxlciBzdGFydCBwZXJpb2QuCiAgICAvLy8gQHBhcmFtIF90aW1lIFRoZSB0aW1lIHdoZW4gaG9kbGVyIHJld2FyZCBzdGFydHMgY291bnRpbmcKICAgIGZ1bmN0aW9uIHNldEhvZGxlclRpbWUodWludDI1NiBfdGltZSkgcHVibGljIG9ubHlPd25lciBiZWZvcmVIb2RsU3RhcnQgewogICAgICAgIHJlcXVpcmUoX3RpbWUgPj0gbm93KTsKICAgICAgICBob2RsZXJUaW1lU3RhcnQgPSBfdGltZTsKICAgICAgICBob2RsZXJUaW1lM00gPSBfdGltZS5hZGQoOTAgZGF5cyk7CiAgICAgICAgaG9kbGVyVGltZTZNID0gX3RpbWUuYWRkKDE4MCBkYXlzKTsKICAgICAgICBob2RsZXJUaW1lOU0gPSBfdGltZS5hZGQoMjcwIGRheXMpOwogICAgICAgIExvZ0hvZGxTdGFydFNldChtc2cuc2VuZGVyLCBfdGltZSk7CiAgICB9CiAgICAvLy8gQG5vdGljZSBJbnZhbGlkYXRlcyBob2RsZXIgYWNjb3VudCAKICAgIC8vLyBAZGV2IEdldHMgY2FsbGVkIGJ5IEV0aGVhbENvbnRyb2xsZXIjb25UcmFuc2ZlciBiZWZvcmUgZXZlcnkgdHJhbnNhY3Rpb24KICAgIGZ1bmN0aW9uIGludmFsaWRhdGUoYWRkcmVzcyBfYWNjb3VudCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgaWYgKGhvZGxlclN0YWtlc1tfYWNjb3VudF0uc3Rha2UgPiAwICYmICFob2RsZXJTdGFrZXNbX2FjY291bnRdLmludmFsaWQpIHsKICAgICAgICAgICAgaG9kbGVyU3Rha2VzW19hY2NvdW50XS5pbnZhbGlkID0gdHJ1ZTsKICAgICAgICAgICAgaG9kbGVyVG90YWxWYWx1ZSA9IGhvZGxlclRvdGFsVmFsdWUuc3ViKGhvZGxlclN0YWtlc1tfYWNjb3VudF0uc3Rha2UpOwogICAgICAgICAgICBob2RsZXJUb3RhbENvdW50ID0gaG9kbGVyVG90YWxDb3VudC5zdWIoMSk7CiAgICAgICAgfQogICAgICAgIC8vIHVwZGF0ZSBob2RsIHRvdGFsIHZhbHVlcyAiYXV0b21hdGljYWxseSIgLSB3aGVuZXZlciBzb21lb25lIHNlbmRzIGZ1bmRzIHRodXMKICAgICAgICB1cGRhdGVBbmRHZXRIb2RsVG90YWxWYWx1ZSgpOwogICAgfQogICAgLy8vIEBub3RpY2UgQ2xhaW1pbmcgSE9ETCByZXdhcmQgZm9yIG1zZy5zZW5kZXIKICAgIGZ1bmN0aW9uIGNsYWltSG9kbFJld2FyZCgpIHB1YmxpYyB7CiAgICAgICAgY2xhaW1Ib2RsUmV3YXJkRm9yKG1zZy5zZW5kZXIpOwogICAgfQogICAgLy8vIEBub3RpY2UgQ2xhaW1pbmcgSE9ETCByZXdhcmQgZm9yIGFuIGFkZHJlc3MKICAgIGZ1bmN0aW9uIGNsYWltSG9kbFJld2FyZEZvcihhZGRyZXNzIF9iZW5lZmljaWFyeSkgcHVibGljIHsKICAgICAgICAvLyBvbmx5IHdoZW4gdGhlIGFkZHJlc3MgaGFzIGEgdmFsaWQgc3Rha2UKICAgICAgICByZXF1aXJlKGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlID4gMCAmJiAhaG9kbGVyU3Rha2VzW19iZW5lZmljaWFyeV0uaW52YWxpZCk7CiAgICAgICAgdWludDI1NiBfc3Rha2UgPSAwOwogICAgICAgIAogICAgICAgIC8vIHVwZGF0ZSBob2RsIHRvdGFsIHZhbHVlcwogICAgICAgIHVwZGF0ZUFuZEdldEhvZGxUb3RhbFZhbHVlKCk7CiAgICAgICAgLy8gY2xhaW0gaG9kbCBpZiBub3QgY2xhaW1lZAogICAgICAgIGlmICghaG9kbGVyU3Rha2VzW19iZW5lZmljaWFyeV0uY2xhaW1lZDNNICYmIG5vdyA+PSBob2RsZXJUaW1lM00pIHsKICAgICAgICAgICAgX3N0YWtlID0gX3N0YWtlLmFkZChob2RsZXJTdGFrZXNbX2JlbmVmaWNpYXJ5XS5zdGFrZS5tdWwoVE9LRU5fSE9ETF8zTSkuZGl2KGhvZGxlclRvdGFsVmFsdWUzTSkpOwogICAgICAgICAgICBob2RsZXJTdGFrZXNbX2JlbmVmaWNpYXJ5XS5jbGFpbWVkM00gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoIWhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLmNsYWltZWQ2TSAmJiBub3cgPj0gaG9kbGVyVGltZTZNKSB7CiAgICAgICAgICAgIF9zdGFrZSA9IF9zdGFrZS5hZGQoaG9kbGVyU3Rha2VzW19iZW5lZmljaWFyeV0uc3Rha2UubXVsKFRPS0VOX0hPRExfNk0pLmRpdihob2RsZXJUb3RhbFZhbHVlNk0pKTsKICAgICAgICAgICAgaG9kbGVyU3Rha2VzW19iZW5lZmljaWFyeV0uY2xhaW1lZDZNID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFob2RsZXJTdGFrZXNbX2JlbmVmaWNpYXJ5XS5jbGFpbWVkOU0gJiYgbm93ID49IGhvZGxlclRpbWU5TSkgewogICAgICAgICAgICBfc3Rha2UgPSBfc3Rha2UuYWRkKGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLnN0YWtlLm11bChUT0tFTl9IT0RMXzlNKS5kaXYoaG9kbGVyVG90YWxWYWx1ZTlNKSk7CiAgICAgICAgICAgIGhvZGxlclN0YWtlc1tfYmVuZWZpY2lhcnldLmNsYWltZWQ5TSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChfc3Rha2UgPiAwKSB7CiAgICAgICAgICAgIC8vIGluY3JlYXNpbmcgY2xhaW1lZCB0b2tlbnMKICAgICAgICAgICAgY2xhaW1lZFRva2VucyA9IGNsYWltZWRUb2tlbnMuYWRkKF9zdGFrZSk7CiAgICAgICAgICAgIC8vIHRyYW5zZmVycmluZyB0b2tlbnMKICAgICAgICAgICAgcmVxdWlyZShUb2tlbkNvbnRyb2xsZXIob3duZXIpLmV0aGVhbFRva2VuKCkudHJhbnNmZXIoX2JlbmVmaWNpYXJ5LCBfc3Rha2UpKTsKICAgICAgICAgICAgLy8gbG9nCiAgICAgICAgICAgIExvZ0hvZGxDbGFpbWVkKG1zZy5zZW5kZXIsIF9iZW5lZmljaWFyeSwgX3N0YWtlKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQG5vdGljZSBjbGFpbUhvZGxSZXdhcmRGb3IoKSBmb3IgbXVsdGlwbGUgYWRkcmVzc2VzCiAgICAvLy8gQGRldiBBbnlvbmUgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiBhbmQgZGlzdHJpYnV0ZSBob2RsIHJld2FyZHMKICAgIC8vLyBAcGFyYW0gX2JlbmVmaWNpYXJpZXMgQXJyYXkgb2YgYWRkcmVzc2VzIGZvciB3aGljaCB3ZSB3YW50IHRvIGNsYWltIGhvZGwgcmV3YXJkcwogICAgZnVuY3Rpb24gY2xhaW1Ib2RsUmV3YXJkc0ZvcihhZGRyZXNzW10gX2JlbmVmaWNpYXJpZXMpIGV4dGVybmFsIHsKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfYmVuZWZpY2lhcmllcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgY2xhaW1Ib2RsUmV3YXJkRm9yKF9iZW5lZmljaWFyaWVzW2ldKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIFNldHRpbmcgMyAtIDYgLSA5IG1vbnRocyB0b3RhbCBzdGFraW5nIGhvZGwgdmFsdWUgaWYgdGltZSBpcyBjb21lCiAgICBmdW5jdGlvbiB1cGRhdGVBbmRHZXRIb2RsVG90YWxWYWx1ZSgpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgaWYgKG5vdyA+PSBob2RsZXJUaW1lM00gJiYgaG9kbGVyVG90YWxWYWx1ZTNNID09IDApIHsKICAgICAgICAgICAgaG9kbGVyVG90YWxWYWx1ZTNNID0gaG9kbGVyVG90YWxWYWx1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKG5vdyA+PSBob2RsZXJUaW1lNk0gJiYgaG9kbGVyVG90YWxWYWx1ZTZNID09IDApIHsKICAgICAgICAgICAgaG9kbGVyVG90YWxWYWx1ZTZNID0gaG9kbGVyVG90YWxWYWx1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKG5vdyA+PSBob2RsZXJUaW1lOU0gJiYgaG9kbGVyVG90YWxWYWx1ZTlNID09IDApIHsKICAgICAgICAgICAgaG9kbGVyVG90YWxWYWx1ZTlNID0gaG9kbGVyVG90YWxWYWx1ZTsKICAgICAgICAgICAgLy8gc2luY2Ugd2UgY2FuIHRyYW5zZmVyIG1vcmUgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QsIG1ha2UgaXQgcG9zc2libGUgdG8gcmV0YWluIG1vcmUgdGhhbiB0aGUgcHJlZGVmaW5lZCBsaW1pdAogICAgICAgICAgICBUT0tFTl9IT0RMXzlNID0gVG9rZW5Db250cm9sbGVyKG93bmVyKS5ldGhlYWxUb2tlbigpLmJhbGFuY2VPZih0aGlzKS5zdWIoVE9LRU5fSE9ETF8zTSkuc3ViKFRPS0VOX0hPRExfNk0pLmFkZChjbGFpbWVkVG9rZW5zKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhvZGxlclRvdGFsVmFsdWU7CiAgICB9Cn0KLyoqCiAqIEB0aXRsZSBUb2tlblZlc3RpbmcKICogQGRldiBBIHRva2VuIGhvbGRlciBjb250cmFjdCB0aGF0IGNhbiByZWxlYXNlIGl0cyB0b2tlbiBiYWxhbmNlIGdyYWR1YWxseSBsaWtlIGEKICogdHlwaWNhbCB2ZXN0aW5nIHNjaGVtZSwgd2l0aCBhIGNsaWZmIGFuZCB2ZXN0aW5nIHBlcmlvZC4gT3B0aW9uYWxseSByZXZvY2FibGUgYnkgdGhlCiAqIG93bmVyLgogKi8KY29udHJhY3QgVG9rZW5WZXN0aW5nIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogIGV2ZW50IFJlbGVhc2VkKHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBSZXZva2VkKCk7CiAgLy8gYmVuZWZpY2lhcnkgb2YgdG9rZW5zIGFmdGVyIHRoZXkgYXJlIHJlbGVhc2VkCiAgYWRkcmVzcyBwdWJsaWMgYmVuZWZpY2lhcnk7CiAgdWludDI1NiBwdWJsaWMgY2xpZmY7CiAgdWludDI1NiBwdWJsaWMgc3RhcnQ7CiAgdWludDI1NiBwdWJsaWMgZHVyYXRpb247CiAgYm9vbCBwdWJsaWMgcmV2b2NhYmxlOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlbGVhc2VkOwogIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHJldm9rZWQ7CiAgLyoqCiAgICogQGRldiBDcmVhdGVzIGEgdmVzdGluZyBjb250cmFjdCB0aGF0IHZlc3RzIGl0cyBiYWxhbmNlIG9mIGFueSBFUkMyMCB0b2tlbiB0byB0aGUKICAgKiBfYmVuZWZpY2lhcnksIGdyYWR1YWxseSBpbiBhIGxpbmVhciBmYXNoaW9uIHVudGlsIF9zdGFydCArIF9kdXJhdGlvbi4gQnkgdGhlbiBhbGwKICAgKiBvZiB0aGUgYmFsYW5jZSB3aWxsIGhhdmUgdmVzdGVkLgogICAqIEBwYXJhbSBfYmVuZWZpY2lhcnkgYWRkcmVzcyBvZiB0aGUgYmVuZWZpY2lhcnkgdG8gd2hvbSB2ZXN0ZWQgdG9rZW5zIGFyZSB0cmFuc2ZlcnJlZAogICAqIEBwYXJhbSBfY2xpZmYgZHVyYXRpb24gaW4gc2Vjb25kcyBvZiB0aGUgY2xpZmYgaW4gd2hpY2ggdG9rZW5zIHdpbGwgYmVnaW4gdG8gdmVzdAogICAqIEBwYXJhbSBfZHVyYXRpb24gZHVyYXRpb24gaW4gc2Vjb25kcyBvZiB0aGUgcGVyaW9kIGluIHdoaWNoIHRoZSB0b2tlbnMgd2lsbCB2ZXN0CiAgICogQHBhcmFtIF9yZXZvY2FibGUgd2hldGhlciB0aGUgdmVzdGluZyBpcyByZXZvY2FibGUgb3Igbm90CiAgICovCiAgZnVuY3Rpb24gVG9rZW5WZXN0aW5nKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9zdGFydCwgdWludDI1NiBfY2xpZmYsIHVpbnQyNTYgX2R1cmF0aW9uLCBib29sIF9yZXZvY2FibGUpIHsKICAgIHJlcXVpcmUoX2JlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfY2xpZmYgPD0gX2R1cmF0aW9uKTsKICAgIGJlbmVmaWNpYXJ5ID0gX2JlbmVmaWNpYXJ5OwogICAgcmV2b2NhYmxlID0gX3Jldm9jYWJsZTsKICAgIGR1cmF0aW9uID0gX2R1cmF0aW9uOwogICAgY2xpZmYgPSBfc3RhcnQuYWRkKF9jbGlmZik7CiAgICBzdGFydCA9IF9zdGFydDsKICB9CiAgLyoqCiAgICogQG5vdGljZSBUcmFuc2ZlcnMgdmVzdGVkIHRva2VucyB0byBiZW5lZmljaWFyeS4KICAgKiBAcGFyYW0gdG9rZW4gRVJDMjAgdG9rZW4gd2hpY2ggaXMgYmVpbmcgdmVzdGVkCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzZShFUkMyME1pbmlNZSB0b2tlbikgcHVibGljIHsKICAgIHVpbnQyNTYgdW5yZWxlYXNlZCA9IHJlbGVhc2FibGVBbW91bnQodG9rZW4pOwogICAgcmVxdWlyZSh1bnJlbGVhc2VkID4gMCk7CiAgICByZWxlYXNlZFt0b2tlbl0gPSByZWxlYXNlZFt0b2tlbl0uYWRkKHVucmVsZWFzZWQpOwogICAgcmVxdWlyZSh0b2tlbi50cmFuc2ZlcihiZW5lZmljaWFyeSwgdW5yZWxlYXNlZCkpOwogICAgUmVsZWFzZWQodW5yZWxlYXNlZCk7CiAgfQogIC8qKgogICAqIEBub3RpY2UgQWxsb3dzIHRoZSBvd25lciB0byByZXZva2UgdGhlIHZlc3RpbmcuIFRva2VucyBhbHJlYWR5IHZlc3RlZAogICAqIHJlbWFpbiBpbiB0aGUgY29udHJhY3QsIHRoZSByZXN0IGFyZSByZXR1cm5lZCB0byB0aGUgb3duZXIuCiAgICogQHBhcmFtIHRva2VuIEVSQzIwTWluaU1lIHRva2VuIHdoaWNoIGlzIGJlaW5nIHZlc3RlZAogICAqLwogIGZ1bmN0aW9uIHJldm9rZShFUkMyME1pbmlNZSB0b2tlbikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKHJldm9jYWJsZSk7CiAgICByZXF1aXJlKCFyZXZva2VkW3Rva2VuXSk7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB1aW50MjU2IHVucmVsZWFzZWQgPSByZWxlYXNhYmxlQW1vdW50KHRva2VuKTsKICAgIHVpbnQyNTYgcmVmdW5kID0gYmFsYW5jZS5zdWIodW5yZWxlYXNlZCk7CiAgICByZXZva2VkW3Rva2VuXSA9IHRydWU7CiAgICByZXF1aXJlKHRva2VuLnRyYW5zZmVyKG93bmVyLCByZWZ1bmQpKTsKICAgIFJldm9rZWQoKTsKICB9CiAgLyoqCiAgICogQGRldiBDYWxjdWxhdGVzIHRoZSBhbW91bnQgdGhhdCBoYXMgYWxyZWFkeSB2ZXN0ZWQgYnV0IGhhc24ndCBiZWVuIHJlbGVhc2VkIHlldC4KICAgKiBAcGFyYW0gdG9rZW4gRVJDMjBNaW5pTWUgdG9rZW4gd2hpY2ggaXMgYmVpbmcgdmVzdGVkCiAgICovCiAgZnVuY3Rpb24gcmVsZWFzYWJsZUFtb3VudChFUkMyME1pbmlNZSB0b2tlbikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIHZlc3RlZEFtb3VudCh0b2tlbikuc3ViKHJlbGVhc2VkW3Rva2VuXSk7CiAgfQogIC8qKgogICAqIEBkZXYgQ2FsY3VsYXRlcyB0aGUgYW1vdW50IHRoYXQgaGFzIGFscmVhZHkgdmVzdGVkLgogICAqIEBwYXJhbSB0b2tlbiBFUkMyME1pbmlNZSB0b2tlbiB3aGljaCBpcyBiZWluZyB2ZXN0ZWQKICAgKi8KICBmdW5jdGlvbiB2ZXN0ZWRBbW91bnQoRVJDMjBNaW5pTWUgdG9rZW4pIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgY3VycmVudEJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB1aW50MjU2IHRvdGFsQmFsYW5jZSA9IGN1cnJlbnRCYWxhbmNlLmFkZChyZWxlYXNlZFt0b2tlbl0pOwogICAgaWYgKG5vdyA8IGNsaWZmKSB7CiAgICAgIHJldHVybiAwOwogICAgfSBlbHNlIGlmIChub3cgPj0gc3RhcnQuYWRkKGR1cmF0aW9uKSB8fCByZXZva2VkW3Rva2VuXSkgewogICAgICByZXR1cm4gdG90YWxCYWxhbmNlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRvdGFsQmFsYW5jZS5tdWwobm93LnN1YihzdGFydCkpLmRpdihkdXJhdGlvbik7CiAgICB9CiAgfQp9Ci8qKgogKiBAdGl0bGUgY2xhaW0gYWNjaWRlbnRhbGx5IHNlbnQgdG9rZW5zCiAqLwpjb250cmFjdCBIYXNOb1Rva2VucyBpcyBPd25hYmxlIHsKICAgIGV2ZW50IEV4dHJhY3RlZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NsYWltZXIsIHVpbnQgX2Ftb3VudCk7CiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgLy8vIEBwYXJhbSBfY2xhaW1lciBBZGRyZXNzIHRoYXQgdG9rZW5zIHdpbGwgYmUgc2VuZCB0bwogICAgZnVuY3Rpb24gZXh0cmFjdFRva2VucyhhZGRyZXNzIF90b2tlbiwgYWRkcmVzcyBfY2xhaW1lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgaWYgKF90b2tlbiA9PSAweDApIHsKICAgICAgICAgICAgX2NsYWltZXIudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBFUkMyMCB0b2tlbiA9IEVSQzIwKF90b2tlbik7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKF9jbGFpbWVyLCBiYWxhbmNlKTsKICAgICAgICBFeHRyYWN0ZWRUb2tlbnMoX3Rva2VuLCBfY2xhaW1lciwgYmFsYW5jZSk7CiAgICB9Cn0KLyoqCiAqIEB0aXRsZSBFdGhlYWxDb250cm9sbGVyCiAqIEBhdXRob3IgdGhlc3ZlZAogKiBAbm90aWNlIENvbnRyb2xsZXIgb2YgdGhlIEV0aGVhbCBUb2tlbgogKiBAZGV2IENyb3dkc2FsZSBjYW4gYmUgb25seSByZXBsYWNlZCB3aGVuIG5vIGFjdGl2ZSBjcm93ZHNhbGUgaXMgcnVubmluZy4KICogIFRoZSBjb250cmFjdCBpcyBwYXVzZWQgYnkgZGVmYXVsdC4gSXQgaGFzIHRvIGJlIHVucGF1c2VkIHRvIGVuYWJsZSB0b2tlbiB0cmFuc2Zlci4KICovCmNvbnRyYWN0IEV0aGVhbENvbnRyb2xsZXIgaXMgUGF1c2FibGUsIEhhc05vVG9rZW5zLCBUb2tlbkNvbnRyb2xsZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQ7CiAgICAvLyB3aGVuIG1pZ3JhdGluZyB0aGlzIGNvbnRhaW5zIHRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgY29udHJvbGxlcgogICAgVG9rZW5Db250cm9sbGVyIHB1YmxpYyBuZXdDb250cm9sbGVyOwogICAgLy8gdG9rZW4gY29udHJhY3QKICAgIEVSQzIwTWluaU1lIHB1YmxpYyBldGhlYWxUb2tlbjsKICAgIC8vIGRpc3RyaWJ1dGlvbiBvZiB0b2tlbnMKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IEVUSEVBTF9VTklUID0gMTAqKjE4OwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVEhPVVNBTkQgPSAxMCoqMzsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IE1JTExJT04gPSAxMCoqNjsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1NBTEUxX1BSRSA9IDkgKiBNSUxMSU9OICogRVRIRUFMX1VOSVQ7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9TQUxFMV9OT1JNQUwgPSAyMCAqIE1JTExJT04gKiBFVEhFQUxfVU5JVDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1NBTEUyID0gOSAqIE1JTExJT04gKiBFVEhFQUxfVU5JVDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1NBTEUzID0gNSAqIE1JTExJT04gKiBFVEhFQUxfVU5JVDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX0hPRExfM00gPSAxICogTUlMTElPTiAqIEVUSEVBTF9VTklUOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fSE9ETF82TSA9IDIgKiBNSUxMSU9OICogRVRIRUFMX1VOSVQ7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9IT0RMXzlNID0gNyAqIE1JTExJT04gKiBFVEhFQUxfVU5JVDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX1JFRkVSUkFMID0gMiAqIE1JTExJT04gKiBFVEhFQUxfVU5JVDsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFRPS0VOX0JPVU5UWSA9IDE1MDAgKiBUSE9VU0FORCAqIEVUSEVBTF9VTklUOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fQ09NTVVOSVRZID0gMjAgKiBNSUxMSU9OICogRVRIRUFMX1VOSVQ7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9URUFNID0gMTQgKiBNSUxMSU9OICogRVRIRUFMX1VOSVQ7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBUT0tFTl9GT1VOREVSUyA9IDY1MDAgKiBUSE9VU0FORCAqIEVUSEVBTF9VTklUOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVE9LRU5fSU5WRVNUT1JTID0gMyAqIE1JTExJT04gKiBFVEhFQUxfVU5JVDsKICAgIC8vIGFkZHJlc3NlcyBvbmx5IFNBTEUgd2lsbCByZW1haW4sIHRoZSBvdGhlcnMgd2lsbCBiZSByZWFsIGV0aCBhZGRyZXNzZXMKICAgIGFkZHJlc3MgcHVibGljIFNBTEUgPSAwWDE7CiAgICBhZGRyZXNzIHB1YmxpYyBGT1VOREVSMSA9IDB4Mjk2ZEQyQTI4NzlmRUJlMmRGNjVmNDEzOTk5QjI4QzA1MzM5N2ZDNTsKICAgIGFkZHJlc3MgcHVibGljIEZPVU5ERVIyID0gMHgwRTJmZUY4ZTQxMjVlZDBmNDllRDQzQzk0YjJCMDAxQzM3M0Y3NEJmOwogICAgYWRkcmVzcyBwdWJsaWMgSU5WRVNUT1IxID0gMHhBQWQyN2VENmM5M2Q5MWFhNjBEYzgyN2JFNjQ3ZTY3MmQxNWU3NjFBOwogICAgYWRkcmVzcyBwdWJsaWMgSU5WRVNUT1IyID0gMHhiOTA2NjY1ZjRlZjYwOTE4OUEzMUNFNTVlMDFDMjY3RUM2MjkzQWE1OwogICAgLy8gYWRkcmVzc2VzIGZvciBtdWx0aXNpZyBhbmQgY3Jvd2RzYWxlCiAgICBhZGRyZXNzIHB1YmxpYyBldGhlYWxNdWx0aXNpZ1dhbGxldDsKICAgIENyb3dkc2FsZSBwdWJsaWMgY3Jvd2RzYWxlOwogICAgLy8gaG9kbGVyIHJld2FyZCBjb250cmFjdAogICAgSG9kbGVyIHB1YmxpYyBob2RsZXJSZXdhcmQ7CiAgICAvLyB0b2tlbiBncmFudHMKICAgIFRva2VuVmVzdGluZ1tdIHB1YmxpYyB0b2tlbkdyYW50czsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IFZFU1RJTkdfVEVBTV9DTElGRiA9IDM2NSBkYXlzOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVkVTVElOR19URUFNX0RVUkFUSU9OID0gNCAqIDM2NSBkYXlzOwogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgVkVTVElOR19BRFZJU09SX0NMSUZGID0gMyAqIDMwIGRheXM7CiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBWRVNUSU5HX0FEVklTT1JfRFVSQVRJT04gPSA2ICogMzAgZGF5czsKICAgIC8vLyBAZGV2IG9ubHkgdGhlIGNyb3dkc2FsZSBjYW4gY2FsbCBpdAogICAgbW9kaWZpZXIgb25seUNyb3dkc2FsZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhjcm93ZHNhbGUpKTsKICAgICAgICBfOwogICAgfQogICAgLy8vIEBkZXYgb25seSB0aGUgY3Jvd2RzYWxlIGNhbiBjYWxsIGl0CiAgICBtb2RpZmllciBvbmx5RXRoZWFsTXVsdGlzaWcoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkZHJlc3MoZXRoZWFsTXVsdGlzaWdXYWxsZXQpKTsKICAgICAgICBfOwogICAgfQogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8gQ29uc3RydWN0b3IsIG92ZXJyaWRlcwogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2UgQ29uc3RydWN0b3IgZm9yIEV0aGVhbCBDb250cm9sbGVyCiAgICBmdW5jdGlvbiBFdGhlYWxDb250cm9sbGVyKGFkZHJlc3MgX3dhbGxldCkgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgICAgIGV0aGVhbE11bHRpc2lnV2FsbGV0ID0gX3dhbGxldDsKICAgIH0KICAgIC8vLyBAZGV2IG92ZXJyaWRlcyBIYXNOb1Rva2VucyNleHRyYWN0VG9rZW5zIHRvIG1ha2UgaXQgcG9zc2libGUgdG8gZXh0cmFjdCBhbnkgdG9rZW5zIGFmdGVyIG1pZ3JhdGlvbiBvciBiZWZvcmUgdGhhdCBhbnkgdG9rZW5zIGV4Y2VwdCBldGhlYWwKICAgIGZ1bmN0aW9uIGV4dHJhY3RUb2tlbnMoYWRkcmVzcyBfdG9rZW4sIGFkZHJlc3MgX2NsYWltZXIpIG9ubHlPd25lciBwdWJsaWMgewogICAgICAgIHJlcXVpcmUobmV3Q29udHJvbGxlciAhPSBhZGRyZXNzKDApIHx8IF90b2tlbiAhPSBhZGRyZXNzKGV0aGVhbFRva2VuKSk7CiAgICAgICAgc3VwZXIuZXh0cmFjdFRva2VucyhfdG9rZW4sIF9jbGFpbWVyKTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE1hbmFnZSBjcm93ZHNhbGUKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAbm90aWNlIFNldCBjcm93ZHNhbGUgYWRkcmVzcyBhbmQgdHJhbnNmZXIgSEVBTCB0b2tlbnMgZnJvbSBldGhlYWxDb250cm9sbGVyJ3MgU0FMRSBhZGRyZXNzCiAgICAvLy8gQGRldiBDcm93ZHNhbGUgY2FuIGJlIG9ubHkgc2V0IHdoZW4gdGhlIGN1cnJlbnQgY3Jvd2RzYWxlIGlzIG5vdCBhY3RpdmUgYW5kIGV0aGVhbFRva2VuIGlzIHNldAogICAgZnVuY3Rpb24gc2V0Q3Jvd2RzYWxlVHJhbnNmZXIoYWRkcmVzcyBfc2FsZSwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlIChfc2FsZSAhPSBhZGRyZXNzKDApICYmICFpc0Nyb3dkc2FsZU9wZW4oKSAmJiBhZGRyZXNzKGV0aGVhbFRva2VuKSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBjcm93ZHNhbGUgPSBDcm93ZHNhbGUoX3NhbGUpOwogICAgICAgIC8vIHRyYW5zZmVyIEhFQUwgdG9rZW5zIHRvIGNyb3dkc2FsZSBhY2NvdW50IGZyb20gdGhlIGFjY291bnQgb2YgY29udHJvbGxlcgogICAgICAgIHJlcXVpcmUoZXRoZWFsVG9rZW4udHJhbnNmZXJGcm9tKFNBTEUsIF9zYWxlLCBfYW1vdW50KSk7CiAgICB9CiAgICAvLy8gQG5vdGljZSBJcyB0aGVyZSBhIG5vdCBlbmRlZCBjcm93ZHNhbGU/CiAgICAvLy8gQHJldHVybiB0cnVlIGlmIHRoZXJlIGlzIG5vIGNyb3dkc2FsZSBvciB0aGUgY3VycmVudCBjcm93ZHNhbGUgaXMgbm90IHlldCBlbmRlZCBidXQgc3RhcnRlZAogICAgZnVuY3Rpb24gaXNDcm93ZHNhbGVPcGVuKCkgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhZGRyZXNzKGNyb3dkc2FsZSkgIT0gYWRkcmVzcygwKSAmJiAhY3Jvd2RzYWxlLmhhc0VuZGVkKCkgJiYgY3Jvd2RzYWxlLmhhc1N0YXJ0ZWQoKTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE1hbmFnZSBncmFudHMKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAbm90aWNlIEdyYW50IHZlc3RpbmcgdG9rZW4gdG8gYW4gYWRkcmVzcwogICAgZnVuY3Rpb24gY3JlYXRlR3JhbnQoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3N0YXJ0LCB1aW50MjU2IF9hbW91bnQsIGJvb2wgX3Jldm9jYWJsZSwgYm9vbCBfYWR2aXNvcikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfYmVuZWZpY2lhcnkgIT0gYWRkcmVzcygwKSAmJiBfYW1vdW50ID4gMCAmJiBfc3RhcnQgPj0gbm93KTsKICAgICAgICAvLyBjcmVhdGUgdG9rZW4gZ3JhbnQKICAgICAgICBpZiAoX2Fkdmlzb3IpIHsKICAgICAgICAgICAgdG9rZW5HcmFudHMucHVzaChuZXcgVG9rZW5WZXN0aW5nKF9iZW5lZmljaWFyeSwgX3N0YXJ0LCBWRVNUSU5HX0FEVklTT1JfQ0xJRkYsIFZFU1RJTkdfQURWSVNPUl9EVVJBVElPTiwgX3Jldm9jYWJsZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRva2VuR3JhbnRzLnB1c2gobmV3IFRva2VuVmVzdGluZyhfYmVuZWZpY2lhcnksIF9zdGFydCwgVkVTVElOR19URUFNX0NMSUZGLCBWRVNUSU5HX1RFQU1fRFVSQVRJT04sIF9yZXZvY2FibGUpKTsKICAgICAgICB9CiAgICAgICAgLy8gdHJhbnNmZXIgZnVuZHMgdG8gdGhlIGdyYW50CiAgICAgICAgdHJhbnNmZXJUb0dyYW50KHRva2VuR3JhbnRzLmxlbmd0aC5zdWIoMSksIF9hbW91bnQpOwogICAgfQogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgdG9rZW5zIHRvIGEgZ3JhbnQgdW50aWwgaXQgaXMgc3RhcnRpbmcKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9HcmFudCh1aW50MjU2IF9pZCwgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9pZCA8IHRva2VuR3JhbnRzLmxlbmd0aCAmJiBfYW1vdW50ID4gMCAmJiBub3cgPD0gdG9rZW5HcmFudHNbX2lkXS5zdGFydCgpKTsKICAgICAgICAvLyB0cmFuc2ZlciBmdW5kcyB0byB0aGUgZ3JhbnQKICAgICAgICByZXF1aXJlKGV0aGVhbFRva2VuLnRyYW5zZmVyKGFkZHJlc3ModG9rZW5HcmFudHNbX2lkXSksIF9hbW91bnQpKTsKICAgIH0KICAgIC8vLyBAZGV2IFJldm9raW5nIGdyYW50CiAgICBmdW5jdGlvbiByZXZva2VHcmFudCh1aW50MjU2IF9pZCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfaWQgPCB0b2tlbkdyYW50cy5sZW5ndGgpOwogICAgICAgIHRva2VuR3JhbnRzW19pZF0ucmV2b2tlKGV0aGVhbFRva2VuKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIHRva2VuIGdyYW50IGNvdW50CiAgICBmdW5jdGlvbiBnZXRHcmFudENvdW50KCkgdmlldyBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiB0b2tlbkdyYW50cy5sZW5ndGg7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBCVVJOLCBoYW5kbGUgb3duZXJzaGlwIC0gb25seSBtdWx0c2lnIGNhbiBjYWxsIHRoZXNlIGZ1bmN0aW9ucyEKICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAbm90aWNlIGNvbnRyYWN0IGNhbiBidXJuIGl0cyBvd24gb3IgaXRzIHNhbGUgdG9rZW5zCiAgICBmdW5jdGlvbiBidXJuKGFkZHJlc3MgX3doZXJlLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBvbmx5RXRoZWFsTXVsdGlzaWcgewogICAgICAgIHJlcXVpcmUoX3doZXJlID09IGFkZHJlc3ModGhpcykgfHwgX3doZXJlID09IFNBTEUpOwogICAgICAgIHJlcXVpcmUoZXRoZWFsVG9rZW4uZGVzdHJveVRva2Vucyhfd2hlcmUsIF9hbW91bnQpKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIHJlcGxhY2VzIGNvbnRyb2xsZXIgd2hlbiBpdCB3YXMgbm90IHlldCByZXBsYWNlZCwgb25seSBtdWx0aXNpZyBjYW4gZG8gaXQKICAgIGZ1bmN0aW9uIHNldE5ld0NvbnRyb2xsZXIoYWRkcmVzcyBfY29udHJvbGxlcikgcHVibGljIG9ubHlFdGhlYWxNdWx0aXNpZyB7CiAgICAgICAgcmVxdWlyZShfY29udHJvbGxlciAhPSBhZGRyZXNzKDApICYmIG5ld0NvbnRyb2xsZXIgPT0gYWRkcmVzcygwKSk7CiAgICAgICAgbmV3Q29udHJvbGxlciA9IFRva2VuQ29udHJvbGxlcihfY29udHJvbGxlcik7CiAgICAgICAgZXRoZWFsVG9rZW4uY2hhbmdlQ29udHJvbGxlcihfY29udHJvbGxlcik7CiAgICAgICAgaG9kbGVyUmV3YXJkLnRyYW5zZmVyT3duZXJzaGlwKF9jb250cm9sbGVyKTsKICAgICAgICAvLyBzZW5kIGV0aAogICAgICAgIHVpbnQyNTYgX3N0YWtlID0gdGhpcy5iYWxhbmNlOwogICAgICAgIGlmIChfc3Rha2UgPiAwKSB7CiAgICAgICAgICAgIF9jb250cm9sbGVyLnRyYW5zZmVyKF9zdGFrZSk7CiAgICAgICAgfQogICAgICAgIC8vIHNlbmQgdG9rZW5zCiAgICAgICAgX3N0YWtlID0gZXRoZWFsVG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIGlmIChfc3Rha2UgPiAwKSB7CiAgICAgICAgICAgIGV0aGVhbFRva2VuLnRyYW5zZmVyKF9jb250cm9sbGVyLCBfc3Rha2UpOwogICAgICAgIH0KICAgIH0KICAgIC8vLyBAbm90aWNlIFNldCBuZXcgbXVsdGlzaWcgd2FsbGV0LCB0byBtYWtlIGl0IHVwZ3JhZGFibGUuCiAgICBmdW5jdGlvbiBzZXROZXdNdWx0aXNpZyhhZGRyZXNzIF93YWxsZXQpIHB1YmxpYyBvbmx5RXRoZWFsTXVsdGlzaWcgewogICAgICAgIHJlcXVpcmUoX3dhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgICAgICBldGhlYWxNdWx0aXNpZ1dhbGxldCA9IF93YWxsZXQ7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBXaGVuIFBBVVNFRAogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2Ugc2V0IHRoZSB0b2tlbiwgaWYgbm8gaG9kbGVyIHByb3ZpZGVkIHRoZW4gY3JlYXRlcyBhIGhvZGxlciByZXdhcmQgY29udHJhY3QKICAgIGZ1bmN0aW9uIHNldEV0aGVhbFRva2VuKGFkZHJlc3MgX3Rva2VuLCBhZGRyZXNzIF9ob2RsZXIpIHB1YmxpYyBvbmx5T3duZXIgd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgZXRoZWFsVG9rZW4gPSBFUkMyME1pbmlNZShfdG9rZW4pOwogICAgICAgIAogICAgICAgIGlmIChfaG9kbGVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgLy8gc2V0IGhvZGxlciByZXdhcmQgY29udHJhY3QgaWYgcHJvdmlkZWQKICAgICAgICAgICAgaG9kbGVyUmV3YXJkID0gSG9kbGVyKF9ob2RsZXIpOwogICAgICAgIH0gZWxzZSBpZiAoaG9kbGVyUmV3YXJkID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgLy8gY3JlYXRlIGhvZGxlciByZXdhcmQgY29udHJhY3QgaWYgbm90IHlldCBjcmVhdGVkCiAgICAgICAgICAgIGhvZGxlclJld2FyZCA9IG5ldyBIb2RsZXIoVE9LRU5fSE9ETF8zTSwgVE9LRU5fSE9ETF82TSwgVE9LRU5fSE9ETF85TSk7CiAgICAgICAgfQogICAgICAgIC8vIE1JTlQgdG9rZW5zIGlmIG5vdCBtaW50ZWQgeWV0CiAgICAgICAgaWYgKGV0aGVhbFRva2VuLnRvdGFsU3VwcGx5KCkgPT0gMCkgewogICAgICAgICAgICAvLyBzYWxlCiAgICAgICAgICAgIGV0aGVhbFRva2VuLmdlbmVyYXRlVG9rZW5zKFNBTEUsIFRPS0VOX1NBTEUxX1BSRS5hZGQoVE9LRU5fU0FMRTFfTk9STUFMKS5hZGQoVE9LRU5fU0FMRTIpLmFkZChUT0tFTl9TQUxFMykpOwogICAgICAgICAgICAvLyBob2RsZXIgcmV3YXJkCiAgICAgICAgICAgIGV0aGVhbFRva2VuLmdlbmVyYXRlVG9rZW5zKGFkZHJlc3MoaG9kbGVyUmV3YXJkKSwgVE9LRU5fSE9ETF8zTS5hZGQoVE9LRU5fSE9ETF82TSkuYWRkKFRPS0VOX0hPRExfOU0pKTsKICAgICAgICAgICAgLy8gYm91bnR5ICsgcmVmZXJyYWwKICAgICAgICAgICAgZXRoZWFsVG9rZW4uZ2VuZXJhdGVUb2tlbnMob3duZXIsIFRPS0VOX0JPVU5UWS5hZGQoVE9LRU5fUkVGRVJSQUwpKTsKICAgICAgICAgICAgLy8gY29tbXVuaXR5IGZ1bmQKICAgICAgICAgICAgZXRoZWFsVG9rZW4uZ2VuZXJhdGVUb2tlbnMoYWRkcmVzcyhldGhlYWxNdWx0aXNpZ1dhbGxldCksIFRPS0VOX0NPTU1VTklUWSk7CiAgICAgICAgICAgIC8vIHRlYW0gLT4gZ3JhbnRhYmxlCiAgICAgICAgICAgIGV0aGVhbFRva2VuLmdlbmVyYXRlVG9rZW5zKGFkZHJlc3ModGhpcyksIFRPS0VOX0ZPVU5ERVJTLmFkZChUT0tFTl9URUFNKSk7CiAgICAgICAgICAgIC8vIGludmVzdG9ycwogICAgICAgICAgICBldGhlYWxUb2tlbi5nZW5lcmF0ZVRva2VucyhJTlZFU1RPUjEsIFRPS0VOX0lOVkVTVE9SUy5kaXYoMykubXVsKDIpKTsKICAgICAgICAgICAgZXRoZWFsVG9rZW4uZ2VuZXJhdGVUb2tlbnMoSU5WRVNUT1IyLCBUT0tFTl9JTlZFU1RPUlMuZGl2KDMpKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAvLyBQcm94eSBmb3IgSG9kbGVyIGNvbnRyYWN0CiAgICAvLy8vLy8vLy8vLy8vLy8vCiAgICAKICAgIC8vLyBAbm90aWNlIFByb3h5IGNhbGwgZm9yIHNldHRpbmcgaG9kbGVyIHN0YXJ0IHRpbWUKICAgIGZ1bmN0aW9uIHNldEhvZGxlclRpbWUodWludDI1NiBfdGltZSkgcHVibGljIG9ubHlDcm93ZHNhbGUgewogICAgICAgIGhvZGxlclJld2FyZC5zZXRIb2RsZXJUaW1lKF90aW1lKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIFByb3h5IGNhbGwgZm9yIGFkZGluZyBob2RsZXIgc3Rha2UKICAgIGZ1bmN0aW9uIGFkZEhvZGxlclN0YWtlKGFkZHJlc3MgX2JlbmVmaWNpYXJ5LCB1aW50MjU2IF9zdGFrZSkgcHVibGljIG9ubHlDcm93ZHNhbGUgewogICAgICAgIGhvZGxlclJld2FyZC5hZGRIb2RsZXJTdGFrZShfYmVuZWZpY2lhcnksIF9zdGFrZSk7CiAgICB9CiAgICAvLy8gQG5vdGljZSBQcm94eSBjYWxsIGZvciBzZXR0aW5nIGhvZGxlciBzdGFrZQogICAgZnVuY3Rpb24gc2V0SG9kbGVyU3Rha2UoYWRkcmVzcyBfYmVuZWZpY2lhcnksIHVpbnQyNTYgX3N0YWtlKSBwdWJsaWMgb25seUNyb3dkc2FsZSB7CiAgICAgICAgaG9kbGVyUmV3YXJkLnNldEhvZGxlclN0YWtlKF9iZW5lZmljaWFyeSwgX3N0YWtlKTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8KICAgIC8vIE1pbmlNZSBDb250cm9sbGVyIGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBub3RpY2UgTm8gZXRoIHBheW1lbnQgdG8gdGhlIHRva2VuIGNvbnRyYWN0CiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcyBfb3duZXIpIHBheWFibGUgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIC8vLyBAbm90aWNlIEJlZm9yZSB0cmFuc2ZlcnMgYXJlIGVuYWJsZWQgZm9yIGV2ZXJ5b25lLCBvbmx5IHRoaXMgYW5kIHRoZSBjcm93ZHNhbGUgY29udHJhY3QgaXMgYWxsb3dlZCB0byBkaXN0cmlidXRlIEhFQUwKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBtb3ZpbmcgYW55IGZ1bmRzIG1ha2VzIGhvZGwgcGFydGljaXBhdGlvbiBpbnZhbGlkCiAgICAgICAgaG9kbGVyUmV3YXJkLmludmFsaWRhdGUoX2Zyb20pOwogICAgICAgIHJldHVybiAhcGF1c2VkIHx8IF9mcm9tID09IGFkZHJlc3ModGhpcykgfHwgX3RvID09IGFkZHJlc3ModGhpcykgfHwgX2Zyb20gPT0gYWRkcmVzcyhjcm93ZHNhbGUpIHx8IF90byA9PSBhZGRyZXNzKGNyb3dkc2FsZSk7CiAgICB9CiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gIXBhdXNlZDsKICAgIH0KICAgIC8vLyBAbm90aWNlIFJldHJpZXZlIG1pc3Rha2VubHkgc2VudCB0b2tlbnMgKG90aGVyIHRoYW4gdGhlIGV0aGVhbCB0b2tlbikgZnJvbSB0aGUgdG9rZW4gY29udHJhY3QgCiAgICBmdW5jdGlvbiBjbGFpbVRva2VuVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSBhZGRyZXNzKGV0aGVhbFRva2VuKSk7CiAgICAgICAgZXRoZWFsVG9rZW4uY2xhaW1Ub2tlbnMoX3Rva2VuKTsKICAgIH0KfQ=='.
	

]
