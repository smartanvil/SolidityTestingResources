Class {
	#name : #SRTe6eee1f6915bae8a4ec92f77ab07e2fd36dff850,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTe6eee1f6915bae8a4ec92f77ab07e2fd36dff850 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTc7Cgpjb250cmFjdCBTYWZlTWF0aCB7CiAgICBmdW5jdGlvbiBzYWZlQWRkKHVpbnQgeCwgdWludCB5KSBwdXJlIGludGVybmFsIHJldHVybnModWludCkgewogICAgICB1aW50IHogPSB4ICsgeTsKICAgICAgYXNzZXJ0KCh6ID49IHgpICYmICh6ID49IHkpKTsKICAgICAgcmV0dXJuIHo7CiAgICB9CgogICAgZnVuY3Rpb24gc2FmZVN1YnRyYWN0KHVpbnQgeCwgdWludCB5KSBwdXJlIGludGVybmFsIHJldHVybnModWludCkgewogICAgICBhc3NlcnQoeCA+PSB5KTsKICAgICAgdWludCB6ID0geCAtIHk7CiAgICAgIHJldHVybiB6OwogICAgfQoKICAgIGZ1bmN0aW9uIHNhZmVNdWx0KHVpbnQgeCwgdWludCB5KSBwdXJlIGludGVybmFsIHJldHVybnModWludCkgewogICAgICB1aW50IHogPSB4ICogeTsKICAgICAgYXNzZXJ0KCh4ID09IDApfHwoei94ID09IHkpKTsKICAgICAgcmV0dXJuIHo7CiAgICB9CiAgICAKICAgICBmdW5jdGlvbiBzYWZlRGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAgIGZ1bmN0aW9uIGdldFJhbmRvbU51bWJlcih1aW50MTYgbWF4UmFuZG9tLCB1aW50OCBtaW4sIGFkZHJlc3MgcHJpdmF0ZUFkZHJlc3MpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ4KSB7CiAgICAgICAgdWludDI1NiBnZW5OdW0gPSB1aW50MjU2KGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSkpICsgdWludDI1Nihwcml2YXRlQWRkcmVzcyk7CiAgICAgICAgcmV0dXJuIHVpbnQ4KGdlbk51bSAlIChtYXhSYW5kb20gLSBtaW4gKyAxKSttaW4pOwogICAgfQp9Cgpjb250cmFjdCBFbnVtcyB7CiAgICBlbnVtIFJlc3VsdENvZGUgewogICAgICAgIFNVQ0NFU1MsCiAgICAgICAgRVJST1JfQ0xBU1NfTk9UX0ZPVU5ELAogICAgICAgIEVSUk9SX0xPV19CQUxBTkNFLAogICAgICAgIEVSUk9SX1NFTkRfRkFJTCwKICAgICAgICBFUlJPUl9OT1RfT1dORVIsCiAgICAgICAgRVJST1JfTk9UX0VOT1VHSF9NT05FWSwKICAgICAgICBFUlJPUl9JTlZBTElEX0FNT1VOVAogICAgfQoKICAgIGVudW0gQW5nZWxBdXJhIHsgCiAgICAgICAgQmx1ZSwgCiAgICAgICAgWWVsbG93LCAKICAgICAgICBQdXJwbGUsIAogICAgICAgIE9yYW5nZSwgCiAgICAgICAgUmVkLCAKICAgICAgICBHcmVlbiAKICAgIH0KfQpjb250cmFjdCBBY2Nlc3NDb250cm9sIHsKICAgIGFkZHJlc3MgcHVibGljIGNyZWF0b3JBZGRyZXNzOwogICAgdWludDE2IHB1YmxpYyB0b3RhbFNlcmFwaGltcyA9IDA7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IGJvb2wpIHB1YmxpYyBzZXJhcGhpbXM7CgogICAgYm9vbCBwdWJsaWMgaXNNYWludGVuYW5jZU1vZGUgPSB0cnVlOwogCiAgICBtb2RpZmllciBvbmx5Q1JFQVRPUigpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3JlYXRvckFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgbW9kaWZpZXIgb25seVNFUkFQSElNKCkgewogICAgICAgIHJlcXVpcmUoc2VyYXBoaW1zW21zZy5zZW5kZXJdID09IHRydWUpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIG1vZGlmaWVyIGlzQ29udHJhY3RBY3RpdmUgewogICAgICAgIHJlcXVpcmUoIWlzTWFpbnRlbmFuY2VNb2RlKTsKICAgICAgICBfOwogICAgfQogICAgCiAgICAvLyBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gQWNjZXNzQ29udHJvbCgpIHB1YmxpYyB7CiAgICAgICAgY3JlYXRvckFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQogICAgCgogICAgZnVuY3Rpb24gYWRkU0VSQVBISU0oYWRkcmVzcyBfbmV3U2VyYXBoaW0pIG9ubHlDUkVBVE9SIHB1YmxpYyB7CiAgICAgICAgaWYgKHNlcmFwaGltc1tfbmV3U2VyYXBoaW1dID09IGZhbHNlKSB7CiAgICAgICAgICAgIHNlcmFwaGltc1tfbmV3U2VyYXBoaW1dID0gdHJ1ZTsKICAgICAgICAgICAgdG90YWxTZXJhcGhpbXMgKz0gMTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJlbW92ZVNFUkFQSElNKGFkZHJlc3MgX29sZFNlcmFwaGltKSBvbmx5Q1JFQVRPUiBwdWJsaWMgewogICAgICAgIGlmIChzZXJhcGhpbXNbX29sZFNlcmFwaGltXSA9PSB0cnVlKSB7CiAgICAgICAgICAgIHNlcmFwaGltc1tfb2xkU2VyYXBoaW1dID0gZmFsc2U7CiAgICAgICAgICAgIHRvdGFsU2VyYXBoaW1zIC09IDE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZU1haW50ZW5hbmNlTW9kZShib29sIF9pc01haW50YWluaW5nKSBvbmx5Q1JFQVRPUiBwdWJsaWMgewogICAgICAgIGlzTWFpbnRlbmFuY2VNb2RlID0gX2lzTWFpbnRhaW5pbmc7CiAgICB9CgogIAp9IAoKY29udHJhY3QgSUFuZ2VsQ2FyZERhdGEgaXMgQWNjZXNzQ29udHJvbCwgRW51bXMgewogICAgdWludDggcHVibGljIHRvdGFsQW5nZWxDYXJkU2VyaWVzOwogICAgdWludDY0IHB1YmxpYyB0b3RhbEFuZ2VsczsKCiAgICAKICAgIC8vIHdyaXRlCiAgICAvLyBhbmdlbHMKICAgIGZ1bmN0aW9uIGNyZWF0ZUFuZ2VsQ2FyZFNlcmllcyh1aW50OCBfYW5nZWxDYXJkU2VyaWVzSWQsIHVpbnQgX2Jhc2VQcmljZSwgIHVpbnQ2NCBfbWF4VG90YWwsIHVpbnQ4IF9iYXNlQXVyYSwgdWludDE2IF9iYXNlQmF0dGxlUG93ZXIsIHVpbnQ2NCBfbGl2ZVRpbWUpIG9ubHlDUkVBVE9SIGV4dGVybmFsIHJldHVybnModWludDgpOwogICAgZnVuY3Rpb24gdXBkYXRlQW5nZWxDYXJkU2VyaWVzKHVpbnQ4IF9hbmdlbENhcmRTZXJpZXNJZCwgdWludDY0IF9uZXdQcmljZSwgdWludDY0IF9uZXdNYXhUb3RhbCkgb25seUNSRUFUT1IgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBzZXRBbmdlbCh1aW50OCBfYW5nZWxDYXJkU2VyaWVzSWQsIGFkZHJlc3MgX293bmVyLCB1aW50IF9wcmljZSwgdWludDE2IF9iYXR0bGVQb3dlcikgb25seVNFUkFQSElNIGV4dGVybmFsIHJldHVybnModWludDY0KTsKICAgIGZ1bmN0aW9uIGFkZFRvQW5nZWxFeHBlcmllbmNlTGV2ZWwodWludDY0IF9hbmdlbElkLCB1aW50IF92YWx1ZSkgb25seVNFUkFQSElNIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0QW5nZWxMYXN0QmF0dGxlVGltZSh1aW50NjQgX2FuZ2VsSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldEFuZ2VsTGFzdFZzQmF0dGxlVGltZSh1aW50NjQgX2FuZ2VsSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldExhc3RCYXR0bGVSZXN1bHQodWludDY0IF9hbmdlbElkLCB1aW50MTYgX3ZhbHVlKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRBbmdlbElkTWFwcGluZyhhZGRyZXNzIF9vd25lciwgdWludDY0IF9hbmdlbElkKSBwcml2YXRlOwogICAgZnVuY3Rpb24gdHJhbnNmZXJBbmdlbChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDY0IF9hbmdlbElkKSBvbmx5U0VSQVBISU0gcHVibGljIHJldHVybnMoUmVzdWx0Q29kZSk7CiAgICBmdW5jdGlvbiBvd25lckFuZ2VsVHJhbnNmZXIgKGFkZHJlc3MgX3RvLCB1aW50NjQgX2FuZ2VsSWQpICBwdWJsaWM7CiAgICBmdW5jdGlvbiB1cGRhdGVBbmdlbExvY2sgKHVpbnQ2NCBfYW5nZWxJZCwgYm9vbCBuZXdWYWx1ZSkgcHVibGljOwogICAgZnVuY3Rpb24gcmVtb3ZlQ3JlYXRvcigpIG9ubHlDUkVBVE9SIGV4dGVybmFsOwoKICAgIC8vIHJlYWQKICAgIGZ1bmN0aW9uIGdldEFuZ2VsQ2FyZFNlcmllcyh1aW50OCBfYW5nZWxDYXJkU2VyaWVzSWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ4IGFuZ2VsQ2FyZFNlcmllc0lkLCB1aW50NjQgY3VycmVudEFuZ2VsVG90YWwsIHVpbnQgYmFzZVByaWNlLCB1aW50NjQgbWF4QW5nZWxUb3RhbCwgdWludDggYmFzZUF1cmEsIHVpbnQgYmFzZUJhdHRsZVBvd2VyLCB1aW50NjQgbGFzdFNlbGxUaW1lLCB1aW50NjQgbGl2ZVRpbWUpOwogICAgZnVuY3Rpb24gZ2V0QW5nZWwodWludDY0IF9hbmdlbElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50NjQgYW5nZWxJZCwgdWludDggYW5nZWxDYXJkU2VyaWVzSWQsIHVpbnQxNiBiYXR0bGVQb3dlciwgdWludDggYXVyYSwgdWludDE2IGV4cGVyaWVuY2UsIHVpbnQgcHJpY2UsIHVpbnQ2NCBjcmVhdGVkVGltZSwgdWludDY0IGxhc3RCYXR0bGVUaW1lLCB1aW50NjQgbGFzdFZzQmF0dGxlVGltZSwgdWludDE2IGxhc3RCYXR0bGVSZXN1bHQsIGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gZ2V0T3duZXJBbmdlbENvdW50KGFkZHJlc3MgX293bmVyKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50KTsKICAgIGZ1bmN0aW9uIGdldEFuZ2VsQnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludCBfaW5kZXgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQ2NCk7CiAgICBmdW5jdGlvbiBnZXRUb3RhbEFuZ2VsQ2FyZFNlcmllcygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50OCk7CiAgICBmdW5jdGlvbiBnZXRUb3RhbEFuZ2VscygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50NjQpOwogICAgZnVuY3Rpb24gZ2V0QW5nZWxMb2NrU3RhdHVzKHVpbnQ2NCBfYW5nZWxJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGJvb2wpOwp9CmNvbnRyYWN0IElQZXRDYXJkRGF0YSBpcyBBY2Nlc3NDb250cm9sLCBFbnVtcyB7CiAgICB1aW50OCBwdWJsaWMgdG90YWxQZXRDYXJkU2VyaWVzOyAgICAKICAgIHVpbnQ2NCBwdWJsaWMgdG90YWxQZXRzOwogICAgCiAgICAvLyB3cml0ZQogICAgZnVuY3Rpb24gY3JlYXRlUGV0Q2FyZFNlcmllcyh1aW50OCBfcGV0Q2FyZFNlcmllc0lkLCB1aW50MzIgX21heFRvdGFsKSBvbmx5Q1JFQVRPUiBwdWJsaWMgcmV0dXJucyh1aW50OCk7CiAgICBmdW5jdGlvbiBzZXRQZXQodWludDggX3BldENhcmRTZXJpZXNJZCwgYWRkcmVzcyBfb3duZXIsIHN0cmluZyBfbmFtZSwgdWludDggX2x1Y2ssIHVpbnQxNiBfYXVyYVJlZCwgdWludDE2IF9hdXJhWWVsbG93LCB1aW50MTYgX2F1cmFCbHVlKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWwgcmV0dXJucyh1aW50NjQpOwogICAgZnVuY3Rpb24gc2V0UGV0QXVyYXModWludDY0IF9wZXRJZCwgdWludDggX2F1cmFSZWQsIHVpbnQ4IF9hdXJhQmx1ZSwgdWludDggX2F1cmFZZWxsb3cpIG9ubHlTRVJBUEhJTSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIHNldFBldExhc3RUcmFpbmluZ1RpbWUodWludDY0IF9wZXRJZCkgb25seVNFUkFQSElNIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0UGV0TGFzdEJyZWVkaW5nVGltZSh1aW50NjQgX3BldElkKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiBhZGRQZXRJZE1hcHBpbmcoYWRkcmVzcyBfb3duZXIsIHVpbnQ2NCBfcGV0SWQpIHByaXZhdGU7CiAgICBmdW5jdGlvbiB0cmFuc2ZlclBldChhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDY0IF9wZXRJZCkgb25seVNFUkFQSElNIHB1YmxpYyByZXR1cm5zKFJlc3VsdENvZGUpOwogICAgZnVuY3Rpb24gb3duZXJQZXRUcmFuc2ZlciAoYWRkcmVzcyBfdG8sIHVpbnQ2NCBfcGV0SWQpICBwdWJsaWM7CiAgICBmdW5jdGlvbiBzZXRQZXROYW1lKHN0cmluZyBfbmFtZSwgdWludDY0IF9wZXRJZCkgcHVibGljOwoKICAgIC8vIHJlYWQKICAgIGZ1bmN0aW9uIGdldFBldENhcmRTZXJpZXModWludDggX3BldENhcmRTZXJpZXNJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnModWludDggcGV0Q2FyZFNlcmllc0lkLCB1aW50MzIgY3VycmVudFBldFRvdGFsLCB1aW50MzIgbWF4UGV0VG90YWwpOwogICAgZnVuY3Rpb24gZ2V0UGV0KHVpbnQgX3BldElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50IHBldElkLCB1aW50OCBwZXRDYXJkU2VyaWVzSWQsIHN0cmluZyBuYW1lLCB1aW50OCBsdWNrLCB1aW50MTYgYXVyYVJlZCwgdWludDE2IGF1cmFCbHVlLCB1aW50MTYgYXVyYVllbGxvdywgdWludDY0IGxhc3RUcmFpbmluZ1RpbWUsIHVpbnQ2NCBsYXN0QnJlZWRpbmdUaW1lLCBhZGRyZXNzIG93bmVyKTsKICAgIGZ1bmN0aW9uIGdldE93bmVyUGV0Q291bnQoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gZ2V0UGV0QnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludCBfaW5kZXgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpOwogICAgZnVuY3Rpb24gZ2V0VG90YWxQZXRDYXJkU2VyaWVzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4KTsKICAgIGZ1bmN0aW9uIGdldFRvdGFsUGV0cygpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zICh1aW50KTsKfQoKY29udHJhY3QgSUJhdHRsZWJvYXJkRGF0YSBpcyBBY2Nlc3NDb250cm9sICB7CgogIAoKICAgICAgLy8gd3JpdGUgZnVuY3Rpb25zCiAgCmZ1bmN0aW9uIGNyZWF0ZUJhdHRsZWJvYXJkKHVpbnQgcHJpemUsIHVpbnQ4IHJlc3RyaWN0aW9ucykgb25seVNFUkFQSElNIGV4dGVybmFsIHJldHVybnMgKHVpbnQxNik7CmZ1bmN0aW9uIGtpbGxNb25zdGVyKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCBtb25zdGVySWQpICBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CmZ1bmN0aW9uIGNyZWF0ZU51bGxUaWxlKHVpbnQxNiBfYmF0dGxlYm9hcmRJZCkgcHJpdmF0ZSA7CmZ1bmN0aW9uIGNyZWF0ZVRpbGUodWludDE2IF9iYXR0bGVib2FyZElkLCB1aW50OCBfdGlsZVR5cGUsIHVpbnQ4IF92YWx1ZSwgdWludDggX3Bvc2l0aW9uLCB1aW50MzIgX2hwLCB1aW50MTYgX3BldFBvd2VyLCB1aW50NjQgX2FuZ2VsSWQsIHVpbnQ2NCBfcGV0SWQsIGFkZHJlc3MgX293bmVyLCB1aW50OCBfdGVhbSkgb25seVNFUkFQSElNIGV4dGVybmFsICByZXR1cm5zICh1aW50OCk7CmZ1bmN0aW9uIGtpbGxUaWxlKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIGFkZFRlYW10b0JvYXJkKHVpbnQxNiBiYXR0bGVib2FyZElkLCBhZGRyZXNzIG93bmVyLCB1aW50OCB0ZWFtKSBvbmx5U0VSQVBISU0gZXh0ZXJuYWw7CmZ1bmN0aW9uIHNldFRpbGVQb3NpdGlvbiAodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCwgdWludDggX3Bvc2l0aW9uVG8pIG9ubHlTRVJBUEhJTSBwdWJsaWMgOwpmdW5jdGlvbiBzZXRUaWxlSHAodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCwgdWludDMyIF9ocCkgb25seVNFUkFQSElNIGV4dGVybmFsIDsKZnVuY3Rpb24gYWRkTWVkYWxCdXJuZWQodWludDE2IGJhdHRsZWJvYXJkSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIHNldExhc3RNb3ZlVGltZSh1aW50MTYgYmF0dGxlYm9hcmRJZCkgb25seVNFUkFQSElNIGV4dGVybmFsIDsKZnVuY3Rpb24gaXRlcmF0ZVR1cm4odWludDE2IGJhdHRsZWJvYXJkSWQpIG9ubHlTRVJBUEhJTSBleHRlcm5hbCA7CmZ1bmN0aW9uIGtpbGxCb2FyZCh1aW50MTYgYmF0dGxlYm9hcmRJZCkgb25seVNFUkFQSElNIGV4dGVybmFsIDsKZnVuY3Rpb24gY2xlYXJBbmdlbHNGcm9tQm9hcmQodWludDE2IGJhdHRsZWJvYXJkSWQpIHByaXZhdGU7Ci8vUmVhZCBmdW5jdGlvbnMKICAgICAKZnVuY3Rpb24gZ2V0VGlsZUhwKHVpbnQxNiBiYXR0bGVib2FyZElkLCB1aW50OCB0aWxlSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQzMikgOwpmdW5jdGlvbiBnZXRNZWRhbHNCdXJuZWQodWludDE2IGJhdHRsZWJvYXJkSWQpIGNvbnN0YW50IGV4dGVybmFsIHJldHVybnMgKHVpbnQ4KSA7CmZ1bmN0aW9uIGdldFRlYW0odWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCkgY29uc3RhbnQgZXh0ZXJuYWwgcmV0dXJucyAodWludDgpIDsKZnVuY3Rpb24gZ2V0TWF4RnJlZVRlYW1zKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4KTsKZnVuY3Rpb24gZ2V0QmFycmllck51bSh1aW50MTYgYmF0dGxlYm9hcmRJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4KSA7CmZ1bmN0aW9uIGdldFRpbGVGcm9tQmF0dGxlYm9hcmQodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQ4IHRpbGVUeXBlLCB1aW50OCB2YWx1ZSwgdWludDggaWQsIHVpbnQ4IHBvc2l0aW9uLCB1aW50MzIgaHAsIHVpbnQxNiBwZXRQb3dlciwgdWludDY0IGFuZ2VsSWQsIHVpbnQ2NCBwZXRJZCwgYm9vbCBpc0xpdmUsIGFkZHJlc3Mgb3duZXIpICAgOwpmdW5jdGlvbiBnZXRUaWxlSURCeU93bmVyKHVpbnQxNiBiYXR0bGVib2FyZElkLCBhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4KSA7CmZ1bmN0aW9uIGdldFBldGJ5VGlsZUlkKCB1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggdGlsZUlkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDY0KSA7CmZ1bmN0aW9uIGdldE93bmVyICh1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggdGVhbSwgIHVpbnQ4IG93bmVyTnVtYmVyKSBjb25zdGFudCBleHRlcm5hbCByZXR1cm5zIChhZGRyZXNzKTsKZnVuY3Rpb24gZ2V0VGlsZUlEYnlQb3NpdGlvbih1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggcG9zaXRpb24pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCkgOwpmdW5jdGlvbiBnZXRQb3NpdGlvbkZyb21CYXR0bGVib2FyZCh1aW50MTYgYmF0dGxlYm9hcmRJZCwgdWludDggX3Bvc2l0aW9uKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDggdGlsZVR5cGUsIHVpbnQ4IHZhbHVlLCB1aW50OCBpZCwgdWludDggcG9zaXRpb24sIHVpbnQzMiBocCwgdWludDMyIHBldFBvd2VyLCB1aW50NjQgYW5nZWxJZCwgdWludDY0IHBldElkLCBib29sIGlzTGl2ZSkgIDsKZnVuY3Rpb24gZ2V0QmF0dGxlYm9hcmQodWludDE2IGlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDggdHVybiwgYm9vbCBpc0xpdmUsIHVpbnQgcHJpemUsIHVpbnQ4IG51bVRlYW1zLCB1aW50OCBudW1UaWxlcywgdWludDggY3JlYXRlZEJhcnJpZXJzLCB1aW50OCByZXN0cmljdGlvbnMsIHVpbnQgbGFzdE1vdmVUaW1lLCB1aW50OCBudW1UZWFtczEsIHVpbnQ4IG51bVRlYW1zMiwgdWludDggbW9uc3RlcjEsIHVpbnQ4IG1vbnN0ZXIyKSA7CmZ1bmN0aW9uIGlzQmF0dGxlYm9hcmRMaXZlKHVpbnQxNiBiYXR0bGVib2FyZElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CmZ1bmN0aW9uIGlzVGlsZUxpdmUodWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRpbGVJZCkgY29uc3RhbnQgIGV4dGVybmFsIHJldHVybnMgKGJvb2wpIDsKZnVuY3Rpb24gZ2V0TGFzdE1vdmVUaW1lKHVpbnQxNiBiYXR0bGVib2FyZElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludCkgOwpmdW5jdGlvbiBnZXROdW1UaWxlc0Zyb21Cb2FyZCAodWludDE2IF9iYXR0bGVib2FyZElkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyAodWludDgpIDsgCmZ1bmN0aW9uIGFuZ2VsT25CYXR0bGVib2FyZHModWludDY0IGFuZ2VsSUQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIDsKZnVuY3Rpb24gZ2V0VHVybih1aW50MTYgYmF0dGxlYm9hcmRJZCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKGFkZHJlc3MpIDsKZnVuY3Rpb24gZ2V0TnVtVGVhbXModWludDE2IGJhdHRsZWJvYXJkSWQsIHVpbnQ4IHRlYW0pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCk7CmZ1bmN0aW9uIGdldE1vbnN0ZXJzKHVpbnQxNiBCYXR0bGVib2FyZElkKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50OCBtb25zdGVyMSwgdWludDggbW9uc3RlcjIpIDsKZnVuY3Rpb24gZ2V0VG90YWxCYXR0bGVib2FyZHMoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDE2KSA7CiAgCiAgICAgICAgCiAKICAgCn0KCgpjb250cmFjdCBJQWNjZXNzb3J5RGF0YSBpcyBBY2Nlc3NDb250cm9sLCBFbnVtcyB7CiAgICB1aW50OCBwdWJsaWMgdG90YWxBY2Nlc3NvcnlTZXJpZXM7ICAgIAogICAgdWludDMyIHB1YmxpYyB0b3RhbEFjY2Vzc29yaWVzOwogICAgCiAKICAgIC8qKiogRlVOQ1RJT05TICoqKi8KICAgIC8vKioqIFdyaXRlIEFjY2VzcyAqKiovLwogICAgZnVuY3Rpb24gY3JlYXRlQWNjZXNzb3J5U2VyaWVzKHVpbnQ4IF9BY2Nlc3NvcnlTZXJpZXNJZCwgdWludDMyIF9tYXhUb3RhbCwgdWludCBfcHJpY2UpIG9ubHlDUkVBVE9SIHB1YmxpYyByZXR1cm5zKHVpbnQ4KSA7CglmdW5jdGlvbiBzZXRBY2Nlc3NvcnkodWludDggX0FjY2Vzc29yeVNlcmllc0lkLCBhZGRyZXNzIF9vd25lcikgb25seVNFUkFQSElNIGV4dGVybmFsIHJldHVybnModWludDY0KTsKICAgZnVuY3Rpb24gYWRkQWNjZXNzb3J5SWRNYXBwaW5nKGFkZHJlc3MgX293bmVyLCB1aW50NjQgX2FjY2Vzc29yeUlkKSBwcml2YXRlOwoJZnVuY3Rpb24gdHJhbnNmZXJBY2Nlc3NvcnkoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQ2NCBfX2FjY2Vzc29yeUlkKSBvbmx5U0VSQVBISU0gcHVibGljIHJldHVybnMoUmVzdWx0Q29kZSk7CiAgICBmdW5jdGlvbiBvd25lckFjY2Vzc29yeVRyYW5zZmVyIChhZGRyZXNzIF90bywgdWludDY0IF9fYWNjZXNzb3J5SWQpICBwdWJsaWM7CiAgICBmdW5jdGlvbiB1cGRhdGVBY2Nlc3NvcnlMb2NrICh1aW50NjQgX2FjY2Vzc29yeUlkLCBib29sIG5ld1ZhbHVlKSBwdWJsaWM7CiAgICBmdW5jdGlvbiByZW1vdmVDcmVhdG9yKCkgb25seUNSRUFUT1IgZXh0ZXJuYWw7CiAgICAKICAgIC8vKioqIFJlYWQgQWNjZXNzICoqKi8vCiAgICBmdW5jdGlvbiBnZXRBY2Nlc3NvcnlTZXJpZXModWludDggX2FjY2Vzc29yeVNlcmllc0lkKSBjb25zdGFudCBwdWJsaWMgcmV0dXJucyh1aW50OCBhY2Nlc3NvcnlTZXJpZXNJZCwgdWludDMyIGN1cnJlbnRUb3RhbCwgdWludDMyIG1heFRvdGFsLCB1aW50IHByaWNlKSA7CglmdW5jdGlvbiBnZXRBY2Nlc3NvcnkodWludCBfYWNjZXNzb3J5SWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQgYWNjZXNzb3J5SUQsIHVpbnQ4IEFjY2Vzc29yeVNlcmllc0lELCBhZGRyZXNzIG93bmVyKTsKCWZ1bmN0aW9uIGdldE93bmVyQWNjZXNzb3J5Q291bnQoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpOwoJZnVuY3Rpb24gZ2V0QWNjZXNzb3J5QnlJbmRleChhZGRyZXNzIF9vd25lciwgdWludCBfaW5kZXgpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zKHVpbnQpIDsKICAgIGZ1bmN0aW9uIGdldFRvdGFsQWNjZXNzb3J5U2VyaWVzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQ4KSA7CiAgICBmdW5jdGlvbiBnZXRUb3RhbEFjY2Vzc29yaWVzKCkgY29uc3RhbnQgcHVibGljIHJldHVybnMgKHVpbnQpOwogICAgZnVuY3Rpb24gZ2V0QWNjZXNzb3J5TG9ja1N0YXR1cyh1aW50NjQgX2FjZXNzb3J5SWQpIGNvbnN0YW50IHB1YmxpYyByZXR1cm5zIChib29sKTsKfQoKCi8vVGhpcyBjb250cmFjdCBpcyB0byBNYW5hZ2UgKG9wZW4sIGNsb3NlLCBhZGQgdGVhbXMsIGV0YykgYmF0dGxlYm9hcmRzLiBDYWxsIHRoZSBCYXR0bGVib2FyZHMgY29udHJhY3QgdG8gbWFrZSBtb3Zlcy4gQm90aCBvZiB0aGVzZSBjb250cmFjdHMgCi8vaW50ZXJmYWNlIHdpdGggdGhlIGJhdHRsZWJvYXJkcyBkYXRhIGNvbnRyYWN0LiAKCmNvbnRyYWN0IE1hbmFnZUJhdHRsZWJvYXJkcyBpcyBBY2Nlc3NDb250cm9sLCBTYWZlTWF0aCAgewoKICAgIC8qKiogREFUQSBUWVBFUyAqKiovCiAgICBhZGRyZXNzIHB1YmxpYyBhbmdlbENhcmREYXRhQ29udHJhY3QgPSAweDZEMkU3NjIxMzYxNTkyNWM1ZmM0MzY1NjVCNWVlNzg4RWUwRTg2REM7CiAgICBhZGRyZXNzIHB1YmxpYyBwZXRDYXJkRGF0YUNvbnRyYWN0ID0gMHhCMzQwNjg2ZGE5OTZiOEIzZDQ4NmI0RDI3RTM4RTM4NTAwQTlFOTI2OwogICAgYWRkcmVzcyBwdWJsaWMgYWNjZXNzb3J5RGF0YUNvbnRyYWN0ID0gMHg0NjZjNDQ4MTI4MzVmNTdiNzM2ZWY5RjYzNTgyYjhhNjY5M0ExNEQwOwogICAgYWRkcmVzcyBwdWJsaWMgYmF0dGxlYm9hcmREYXRhQ29udHJhY3QgPSAweEU2MGZDNDYzMmJENjcxM0U5MjNGRTkzRjhjMjQ0NjM1RTZkNTAwOWU7CgogICAKICAgIAogICAgLy9UaGUgcmVzZXJ2ZWQgYmFsYW5jZSBpcyB0aGUgdG90YWwgYmFsYW5jZSBvdXRzdGFuZGluZyBvbiBhbGwgb3BlbiBiYXR0bGVib2FyZHMuIAogICAgLy9XZSBrZWVwIHRyYWNrIG9mIHRoaXMgZmlndXJlIHRvIHByZXZlbnQgdGhlIGRldmVsb3BlcnMgZnJvbSBwdWxsaW5nIG91dCBtb25leSBjdXJyZW50bHkgcGxlZGdlZAogICAgLy9UaGlzIG9ubHkgZmVhdHVyZXMgaW4gdGhlIHBhaWQgYm9hcmRzLiAKICAgIHVpbnQgcHVibGljIGNvbnRyYWN0UmVzZXJ2ZWRCYWxhbmNlOwogICAgCiAgICAKIAogICAgCiAgICAgIAogICAgICAgICAgLy8gVXRpbGl0eSBGdW5jdGlvbnMKICAgIGZ1bmN0aW9uIERhdGFDb250YWN0cyhhZGRyZXNzIF9hbmdlbENhcmREYXRhQ29udHJhY3QsIGFkZHJlc3MgX3BldENhcmREYXRhQ29udHJhY3QsIGFkZHJlc3MgX2FjY2Vzc29yeURhdGFDb250cmFjdCwgYWRkcmVzcyBfYmF0dGxlYm9hcmREYXRhQ29udHJhY3QpIG9ubHlDUkVBVE9SIGV4dGVybmFsIHsKICAgICAgICBhbmdlbENhcmREYXRhQ29udHJhY3QgPSBfYW5nZWxDYXJkRGF0YUNvbnRyYWN0OwogICAgICAgIHBldENhcmREYXRhQ29udHJhY3QgPSBfcGV0Q2FyZERhdGFDb250cmFjdDsKICAgICAgICBhY2Nlc3NvcnlEYXRhQ29udHJhY3QgPSBfYWNjZXNzb3J5RGF0YUNvbnRyYWN0OwogICAgICAgIGJhdHRsZWJvYXJkRGF0YUNvbnRyYWN0ID0gX2JhdHRsZWJvYXJkRGF0YUNvbnRyYWN0OwoKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2hlY2tFeGlzdHNPd25lZEFuZ2VsICh1aW50NjQgYW5nZWxJZCkgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgSUFuZ2VsQ2FyZERhdGEgYW5nZWxDYXJkRGF0YSA9IElBbmdlbENhcmREYXRhKGFuZ2VsQ2FyZERhdGFDb250cmFjdCk7CiAgICAgICAKICAgICAgICBpZiAoKGFuZ2VsSWQgPD0gMCkgfHwgKGFuZ2VsSWQgPiBhbmdlbENhcmREYXRhLmdldFRvdGFsQW5nZWxzKCkpKSB7cmV0dXJuIGZhbHNlO30KICAgICAgICBhZGRyZXNzIGFuZ2Vsb3duZXI7CiAgICAgICAgKCwsLCwsLCwsLCxhbmdlbG93bmVyKSA9IGFuZ2VsQ2FyZERhdGEuZ2V0QW5nZWwoYW5nZWxJZCk7CiAgICAgICAgaWYgKGFuZ2Vsb3duZXIgPT0gbXNnLnNlbmRlcikge3JldHVybiB0cnVlO30KICAgICAgICAKICAgICAgIGVsc2UgIHJldHVybiBmYWxzZTsKfQogIAogICAgZnVuY3Rpb24gY2hlY2tFeGlzdHNPd25lZFBldCAodWludDY0IHBldElkKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICAgIElQZXRDYXJkRGF0YSBwZXRDYXJkRGF0YSA9IElQZXRDYXJkRGF0YShwZXRDYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgIAogICAgICAgIGlmICgocGV0SWQgPD0gMCkgfHwgKHBldElkID4gcGV0Q2FyZERhdGEuZ2V0VG90YWxQZXRzKCkpKSB7cmV0dXJuIGZhbHNlO30KICAgICAgICBhZGRyZXNzIHBldG93bmVyOwogICAgICAgICAoLCwsLCwsLHBldG93bmVyKSA9IHBldENhcmREYXRhLmdldFBldChwZXRJZCk7CiAgICAgICAgaWYgKHBldG93bmVyID09IG1zZy5zZW5kZXIpIHtyZXR1cm4gdHJ1ZTt9CiAgICAgICAgCiAgICAgICBlbHNlICByZXR1cm4gZmFsc2U7Cn0KCiAgICBmdW5jdGlvbiBjaGVja0V4aXN0c093bmVkQWNjZXNzb3J5ICh1aW50NjQgYWNjZXNzb3J5SWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgICAgSUFjY2Vzc29yeURhdGEgYWNjZXNzb3J5RGF0YSA9IElBY2Nlc3NvcnlEYXRhKGFjY2Vzc29yeURhdGFDb250cmFjdCk7CiAgICAgICBpZiAoYWNjZXNzb3J5SWQgPT0gMCkge3JldHVybiB0cnVlO30KICAgICAgIC8vTm90IHNlbmRpbmcgYW4gYWNjZXNzb3J5IGlzIHZhbGlkLiAKICAgICAgICBpZiAoKGFjY2Vzc29yeUlkIDwgMCkgfHwgKGFjY2Vzc29yeUlkID4gYWNjZXNzb3J5RGF0YS5nZXRUb3RhbEFjY2Vzc29yaWVzKCkpKSB7cmV0dXJuIGZhbHNlO30KICAgICAgICBhZGRyZXNzIG93bmVyOwogICAgICAgICAoLCxvd25lcikgPSBhY2Nlc3NvcnlEYXRhLmdldEFjY2Vzc29yeShhY2Nlc3NvcnlJZCk7CiAgICAgICAgaWYgKG93bmVyID09IG1zZy5zZW5kZXIpIHtyZXR1cm4gdHJ1ZTt9CiAgICAgICAgCiAgICAgICBlbHNlICByZXR1cm4gZmFsc2U7Cn0KCgogZnVuY3Rpb24gdGFrZVBldCh1aW50NjQgcGV0SWQpIHByaXZhdGUgewogICAgICAgICAgIC8vVGhpcyBjb250cmFjdCB0YWtlcyBvd25lcnNoaXAgb2YgcGV0cyB3aG8gYXJlIGVudGVyZWQgaW50byBiYXR0bGVib2FyZHMgYW5kIGxhdGVyIGRpc3RyaWJ1dGVzIHRoZSBsb3NlcnMnIHBldHMgdG8gdGhlIHdpbm5lcnMuIAogICAgICAgICAgICAgICBJUGV0Q2FyZERhdGEgUGV0Q2FyZERhdGEgPSBJUGV0Q2FyZERhdGEocGV0Q2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgICAgICBQZXRDYXJkRGF0YS50cmFuc2ZlclBldChtc2cuc2VuZGVyLCBhZGRyZXNzKHRoaXMpLCBwZXRJZCk7CiAgICAgICAgfQogICAgICAgICAgIAogICAgICAgICAgIAogICAgICAgZnVuY3Rpb24gcmVzdHJpY3Rpb25zQWxsb3codWludDY0IGFuZ2VsSWQsIHVpbnQ4IHJlc3RyaWN0aW9ucykgcHJpdmF0ZSBjb25zdGFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAvL1RoaXMgZnVuY3Rpb24gcmV0dXJucyB0cnVlIGlmIHRoZSByZXN0cmljdGlvbnMgb2YgdGhlIGJvYXJkIGFsbG93IHRoZSBhbmdlbCBhbmQgZmFsc2UgaWYgbm90LiBCYXNpY2FsbHkKICAgICAgIC8vQW5nZWwgY2FyZCBzZXJpZXMgSURzIGdldCBzdHJvbmdlciBCUCBvdmVyIHRpbWUsIHdpdGggdGhlIGV4Y2VwdGlvbiBvZiBNaWNoYWVsIGFuZCBMdWNpZmVyLiAKICAgICAgIC8vTm90ZTogWmFka2llbCBpcyBhbGxvd2VkIG9uIGJvYXJkcyB3aGVyZSBzaGUgbWlnaHQgYmUgc3Ryb25nZXIgLSB0aGlzIGlzIGEgcmFyZSBjYXNlIHRoYXQgd2lsbCBiYWxhbmNlIGFnYWluc3QKICAgICAgIC8vRVZFUlkgcGxheWVyIG5lZWRpbmcgdG8gcGF5IHRoaXMgZ2FzIHRvIGNoZWNrIGV2ZXJ5IHRpbWUgQU5ZIGFuZ2VsIGlzIGFkZGVkIHRvIHRoZSBib2FyZC4gCiAgICAgICAKICAgICAgICBJQW5nZWxDYXJkRGF0YSBhbmdlbENhcmREYXRhID0gSUFuZ2VsQ2FyZERhdGEoYW5nZWxDYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgICB1aW50OCBhbmdlbENhcmRTZXJpZXM7CiAgICAgICAgKCxhbmdlbENhcmRTZXJpZXMsLCwsLCwsLCwpID0gYW5nZWxDYXJkRGF0YS5nZXRBbmdlbChhbmdlbElkKTsKICAgICAgICAKICAgICAgICBpZiAoYW5nZWxDYXJkU2VyaWVzID4gcmVzdHJpY3Rpb25zKSB7cmV0dXJuIGZhbHNlO30KICAgICAgICBpZiAoKGFuZ2VsQ2FyZFNlcmllcyA9PSAyKSAmJiAocmVzdHJpY3Rpb25zIDwgMTkpKSB7cmV0dXJuIGZhbHNlO30gLy9MdWNpZmVyIENhcmQgCiAgICAgICAgaWYgKChhbmdlbENhcmRTZXJpZXMgPT0gMykgJiYgKHJlc3RyaWN0aW9ucyA8IDIxKSkge3JldHVybiBmYWxzZTt9IC8vTWljaGFlbCBDYXJkCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICB9CiAgICAgICAKICAgICAgIAogICAgICAgLy9PcGVuaW5nIGFuZCBDbG9zaW5nIEZ1bmN0aW9ucwogICAgICAKICAKICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJhdHRsZWJvYXJkKHVpbnQ4IHJlc3RyaWN0aW9ucykgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zICh1aW50MTYpIHsKICAgICAgICAgICBpZiAocmVzdHJpY3Rpb25zIDwwKSB7cmV2ZXJ0KCk7fQogICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgcmV0dXJuIGJhdHRsZWJvYXJkRGF0YS5jcmVhdGVCYXR0bGVib2FyZChtc2cudmFsdWUsIHJlc3RyaWN0aW9ucyk7CiAgICAgICAgICAgCiAgICAgICB9CiAgICAgICAKICAgICAgICBmdW5jdGlvbiBjbG9zZUJhdHRsZWJvYXJkKHVpbnQxNiBiYXR0bGVib2FyZElkKSBleHRlcm5hbCB7CiAgICAgICAvL1RoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBieSBBTllPTkUgb25jZSBlaXRoZXIgdGVhbSAxIG9yIHRlYW0gMiBoYXMgbm8gbW9yZSB0ZWFtIG1lbWJlcnMgbGVmdC4gCiAgICAgICAgSUJhdHRsZWJvYXJkRGF0YSBiYXR0bGVib2FyZERhdGEgPSBJQmF0dGxlYm9hcmREYXRhKGJhdHRsZWJvYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgIAogICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5pc0JhdHRsZWJvYXJkTGl2ZShiYXR0bGVib2FyZElkKSA9PSBmYWxzZSkge3JldmVydCgpO30KICAgICAgIGJhdHRsZWJvYXJkRGF0YS5raWxsQm9hcmQoYmF0dGxlYm9hcmRJZCk7IAogICAgICAgIGlmICgoYmF0dGxlYm9hcmREYXRhLmdldE51bVRlYW1zKGJhdHRsZWJvYXJkSWQsMSkgIT0gMCkgJiYgKGJhdHRsZWJvYXJkRGF0YS5nZXROdW1UZWFtcyhiYXR0bGVib2FyZElkLDIpICE9IDApKSB7cmV2ZXJ0KCk7fQogICAgICAgIC8vTm8gdGVhbXMgYXJlIG91dCwgZnVuY3Rpb24gc2hvdWxkbid0IGJlIGNhbGxlZC4gCiAgICAgICAgdWludDggaWQ7CiAgICAgICAgdWludDY0IHBldElkOwogICAgICAgIGFkZHJlc3Mgb3duZXJXb247CiAgICAgICAgYWRkcmVzcyBvd25lckxvc3Q7CiAgICAgICAgdWludDggaSA9IDA7CiAgICAgICAgSVBldENhcmREYXRhIFBldENhcmREYXRhID0gSVBldENhcmREYXRhKHBldENhcmREYXRhQ29udHJhY3QpOwogICAgICAgIGlmICgoYmF0dGxlYm9hcmREYXRhLmdldE51bVRlYW1zKGJhdHRsZWJvYXJkSWQsMSkgPT0gMCkgJiYgKGJhdHRsZWJvYXJkRGF0YS5nZXROdW1UZWFtcyhiYXR0bGVib2FyZElkLDIpID09IDApKSB7CiAgICAgICAgICAgICAgLy9Tb21ldGhpbmcgb2RkIGhhcHBlbmVkIGFuZCBCT1RIIHRlYW1zIGhhdmUgbG9zdCAtIHRoaXMgaXMgYSB0aWUuIAogICAgICAgICAgICAgIAogICAgICAgICAgICAgIGZvciAoaSA9MDsgaTxiYXR0bGVib2FyZERhdGEuZ2V0TWF4RnJlZVRlYW1zKCk7IGkrKykgewogICAgICAgICAgICAgICAgICBvd25lcldvbiA9IGJhdHRsZWJvYXJkRGF0YS5nZXRPd25lcihiYXR0bGVib2FyZElkLCAwLCBpKTsKICAgICAgICAgICAgICAgICAgaWQgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUlEQnlPd25lcihiYXR0bGVib2FyZElkLG93bmVyV29uKTsKICAgICAgICAgICAgICAgICBwZXRJZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRQZXRieVRpbGVJZChiYXR0bGVib2FyZElkLCBpZCk7CiAgICAgICAgICAgICAgICAgUGV0Q2FyZERhdGEudHJhbnNmZXJQZXQoYWRkcmVzcyh0aGlzKSwgb3duZXJXb24sIHBldElkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgaWYgKChiYXR0bGVib2FyZERhdGEuZ2V0TnVtVGVhbXMoYmF0dGxlYm9hcmRJZCwxKSAhPSAwKSAmJiAoYmF0dGxlYm9hcmREYXRhLmdldE51bVRlYW1zKGJhdHRsZWJvYXJkSWQsMikgPT0gMCkpIHsKICAgICAgIC8vVGVhbSAxIHdvbiAKICAgICAgIC8vR2l2ZSB0ZWFtIDEgYmFjayB0aGVpciBwZXRzLiAKICAgICAgICBmb3IgKGkgPTA7IGk8MzsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIG93bmVyV29uID0gYmF0dGxlYm9hcmREYXRhLmdldE93bmVyKGJhdHRsZWJvYXJkSWQsIDEsIGkpOwogICAgICAgICAgICAgICAgICBpZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURCeU93bmVyKGJhdHRsZWJvYXJkSWQsb3duZXJXb24pOwogICAgICAgICAgICAgICAgIHBldElkID0gYmF0dGxlYm9hcmREYXRhLmdldFBldGJ5VGlsZUlkKGJhdHRsZWJvYXJkSWQsIGlkKTsKICAgICAgICAgICAgICAgICBQZXRDYXJkRGF0YS50cmFuc2ZlclBldChhZGRyZXNzKHRoaXMpLCBvd25lcldvbiwgcGV0SWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9naXZlIHRlYW0gMidzIHBldHMgdG8gdGVhbSAxLiAgIAogICAgICAgCiAgICAgICAgICAgICAgICAgIG93bmVyTG9zdCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRPd25lcihiYXR0bGVib2FyZElkLCAyLCBpKTsKICAgICAgICAgICAgICAgICAgaWQgPSBiYXR0bGVib2FyZERhdGEuZ2V0VGlsZUlEQnlPd25lcihiYXR0bGVib2FyZElkLG93bmVyTG9zdCk7CiAgICAgICAgICAgICAgICAgcGV0SWQgPSBiYXR0bGVib2FyZERhdGEuZ2V0UGV0YnlUaWxlSWQoYmF0dGxlYm9hcmRJZCwgaWQpOwogICAgICAgICAgICAgICAgIFBldENhcmREYXRhLnRyYW5zZmVyUGV0KGFkZHJlc3ModGhpcyksIG93bmVyV29uLCBwZXRJZCk7CiAgICAgICAgICAgICAgfSAgICAKICAgICAgIH0KICAgICAgICAgIGlmICgoYmF0dGxlYm9hcmREYXRhLmdldE51bVRlYW1zKGJhdHRsZWJvYXJkSWQsMSkgPT0gMCkgJiYgKGJhdHRsZWJvYXJkRGF0YS5nZXROdW1UZWFtcyhiYXR0bGVib2FyZElkLDIpICE9IDApKSB7CiAgICAgICAvL1RlYW0gMiB3b24gCiAgICAgICAgLy9HaXZlIHRlYW0gMiBiYWNrIHRoZWlyIHBldHMuIAogICAgICAgICAgICBmb3IgKGkgPTA7IGk8MzsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIG93bmVyV29uID0gYmF0dGxlYm9hcmREYXRhLmdldE93bmVyKGJhdHRsZWJvYXJkSWQsIDIgLGkpOwogICAgICAgICAgICAgICAgICBpZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURCeU93bmVyKGJhdHRsZWJvYXJkSWQsb3duZXJXb24pOwogICAgICAgICAgICAgICAgIHBldElkID0gYmF0dGxlYm9hcmREYXRhLmdldFBldGJ5VGlsZUlkKGJhdHRsZWJvYXJkSWQsIGlkKTsKICAgICAgICAgICAgICAgICBQZXRDYXJkRGF0YS50cmFuc2ZlclBldChhZGRyZXNzKHRoaXMpLCBvd25lcldvbiwgcGV0SWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9naXZlIHRlYW0gMSdzIHBldHMgdG8gdGVhbSAyICAgCiAgICAgICAKICAgICAgICAgICAgICAgICAgb3duZXJMb3N0ID0gYmF0dGxlYm9hcmREYXRhLmdldE93bmVyKGJhdHRsZWJvYXJkSWQsIDEsIGkpOwogICAgICAgICAgICAgICAgICBpZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURCeU93bmVyKGJhdHRsZWJvYXJkSWQsb3duZXJMb3N0KTsKICAgICAgICAgICAgICAgICBwZXRJZCA9IGJhdHRsZWJvYXJkRGF0YS5nZXRQZXRieVRpbGVJZChiYXR0bGVib2FyZElkLCBpZCk7CiAgICAgICAgICAgICAgICAgUGV0Q2FyZERhdGEudHJhbnNmZXJQZXQoYWRkcmVzcyh0aGlzKSwgb3duZXJXb24sIHBldElkKTsKICAgICAgICAgICAgICB9IAogICAgICAgICAKICAgICAgIH0KICAgfQogICAgICAgCiAgIAogICAgICAgIGZ1bmN0aW9uIGdldEluaXRpYWxIUCAodWludDY0IGFuZ2VsSWQsIHVpbnQ2NCBwZXRJZCwgdWludDY0IGFjY2Vzc29yeUlkKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDMyIGhwLCB1aW50MTYgcGV0QXVyYUNvbXBvc2l0ZSkgewogICAgICAgICAgIElBbmdlbENhcmREYXRhIGFuZ2VsQ2FyZERhdGEgPSBJQW5nZWxDYXJkRGF0YShhbmdlbENhcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgIAogICAgICAgICAgIC8vbmVlZCB0byByZXVzZSBsb2NhbCB2YXJpYWJsZXMgdG8gYXZvaWQgc3RhY2sgdG9vIGRlZXA7CiAgICAgICAgICAgdWludDE2IHRlbXA7CiAgICAgICAgICAgdWludDE2IHRlbXBDb21wb3NpdGU7CiAgICAgICAgICAgdWludDggYXVyYTsKICAgICAgICAgICAoLCx0ZW1wLGF1cmEsLCwsLCwsKSA9IGFuZ2VsQ2FyZERhdGEuZ2V0QW5nZWwoYW5nZWxJZCk7CiAgICAgICAgICAgaWYgKGF1cmEgPT0gMykge3RlbXAgKz0gMTAwO30gLy9wbHVzIDEwMCBpbml0aWFsIEhQIHRvIG9yYW5nZSBhdXJhIGFuZ2Vscy4gCiAgICAgICAgICAgdGVtcENvbXBvc2l0ZSA9IHRlbXA7CiAgICAgICAgICAgLy9maXJzdCBhZGQgYmF0dGxlUG93ZXI7CiAgICAgICAgICAgKCwsLCx0ZW1wLCwsLCwsKSA9IGFuZ2VsQ2FyZERhdGEuZ2V0QW5nZWwoYW5nZWxJZCk7CiAgICAgICAgICAgdGVtcENvbXBvc2l0ZSArPSB0ZW1wOwogICAgICAgICAgIC8vbm93IHRlbXAgaXMgZXhwZXJpZW5jZQogICAgICAgICAgICB1aW50OCBwZXRBdXJhQ29sb3I7CiAgICAgICAgICAgICAocGV0QXVyYUNvbXBvc2l0ZSwgcGV0QXVyYUNvbG9yKSA9IGZpbmRBdXJhQ29tcG9zaXRlIChwZXRJZCwgYWNjZXNzb3J5SWQpOwogICAgICAgICAgICBocCA9IChhdXJhc0NvbXBhdGlibGUoYW5nZWxJZCxwZXRBdXJhQ29sb3IpKyBwZXRBdXJhQ29tcG9zaXRlICsgdGVtcENvbXBvc2l0ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgCiAgICAgICBmdW5jdGlvbiBhZGRUZWFtMSh1aW50NjQgYW5nZWxJZCwgdWludDY0IHBldElkLCB1aW50NjQgYWNjZXNzb3J5SWQsIHVpbnQxNiBiYXR0bGVib2FyZElkKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAgICAvL2NhbGwgdGhpcyBmdW5jdGlvbiB0byBhZGQgeW91ciBhbmdlbC9wZXQvYWNjZXNzb3J5IHRvIHRlYW0gMS4gCiAgICAgICAgICAgY2hlY2tUZWFtVG9BZGQoYW5nZWxJZCxwZXRJZCxhY2Nlc3NvcnlJZCk7CiAgICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGJhdHRsZWJvYXJkIGlzIGZ1bGwvb3BlbiBmaXJzdCBhbmQgc2VlIHdoZXJlIHRoZSBuZXcgdGVzbSBzaG91bGQgYmUgcGxhY2VkLiAKICAgICAgICAgICB1aW50MzIgaHA7CiAgICAgICAgICAgdWludDE2IHBldFBvd2VyOwogICAgICAgICAgIHVpbnQxNiBzcGVlZCA9IGdldFNwZWVkKHBldElkLGFjY2Vzc29yeUlkKTsKICAgICAgICAgICAoaHAsIHBldFBvd2VyKSA9IGdldEluaXRpYWxIUChhbmdlbElkLHBldElkLCBhY2Nlc3NvcnlJZCk7CiAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLmNyZWF0ZVRpbGUoYmF0dGxlYm9hcmRJZCwgMSwgdWludDgoc3BlZWQpLCBnZXROZXdUZWFtUG9zaXRpb25BbmRDaGVjayhiYXR0bGVib2FyZElkLCAxLCBhbmdlbElkKSwgaHAsIHBldFBvd2VyICsgc3BlZWQsYW5nZWxJZCwgcGV0SWQsIG1zZy5zZW5kZXIsIDEpOwogICAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5hZGRUZWFtdG9Cb2FyZChiYXR0bGVib2FyZElkLCBtc2cuc2VuZGVyLDEpOwogICAgICAgICAgIC8vbm93IGFkZCBvbmUgcmFuZG9tIHRpbGUgdG8gdGhlIGJvYXJkLiAKICAgICAgICAgICBhZGRSYW5kb21UaWxlKGJhdHRsZWJvYXJkSWQsIDEpOwogICAgICAgICAgIHRha2VQZXQocGV0SWQpOwogICAgICAgfQogICAgICAgCiAgICAgICAgICBmdW5jdGlvbiBhZGRUZWFtMih1aW50NjQgYW5nZWxJZCwgdWludDY0IHBldElkLCB1aW50NjQgYWNjZXNzb3J5SWQsIHVpbnQxNiBiYXR0bGVib2FyZElkKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAgICAKICAgICAgICAgICBjaGVja1RlYW1Ub0FkZChhbmdlbElkLHBldElkLGFjY2Vzc29yeUlkKTsKICAgICAgICAgICAgSUJhdHRsZWJvYXJkRGF0YSBiYXR0bGVib2FyZERhdGEgPSBJQmF0dGxlYm9hcmREYXRhKGJhdHRsZWJvYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgICAgICAgLy8gY2hlY2sgaWYgYmF0dGxlYm9hcmQgaXMgZnVsbC9vcGVuIGZpcnN0IGFuZCBzZWUgd2hlcmUgdGhlIG5ldyB0ZXNtIHNob3VsZCBiZSBwbGFjZWQuIAogICAgICAgICAgIHVpbnQzMiBocDsKICAgICAgICAgICB1aW50MTYgcGV0UG93ZXI7CiAgICAgICAgICAgdWludDE2IHNwZWVkID0gZ2V0U3BlZWQocGV0SWQsYWNjZXNzb3J5SWQpOwogICAgICAgICAgIChocCwgcGV0UG93ZXIpID0gZ2V0SW5pdGlhbEhQKGFuZ2VsSWQscGV0SWQsIGFjY2Vzc29yeUlkKTsKICAgICAgICAgICBiYXR0bGVib2FyZERhdGEuY3JlYXRlVGlsZShiYXR0bGVib2FyZElkLCAxLCB1aW50OChzcGVlZCksIGdldE5ld1RlYW1Qb3NpdGlvbkFuZENoZWNrKGJhdHRsZWJvYXJkSWQsIDIsIGFuZ2VsSWQpLCBocCwgcGV0UG93ZXIgKyBzcGVlZCxhbmdlbElkLCBwZXRJZCwgbXNnLnNlbmRlciwgMik7CiAgICAgICAgICAgYmF0dGxlYm9hcmREYXRhLmFkZFRlYW10b0JvYXJkKGJhdHRsZWJvYXJkSWQsIG1zZy5zZW5kZXIsMik7CiAgICAgICAgICAgLy9ub3cgYWRkIG9uZSByYW5kb20gdGlsZSB0byB0aGUgYm9hcmQuIAogICAgICAgICAgIGFkZFJhbmRvbVRpbGUoYmF0dGxlYm9hcmRJZCwgMSk7CiAgICAgICAgICAgdGFrZVBldChwZXRJZCk7CiAgICAgICB9CiAgICAgICAKICAgICAgIGZ1bmN0aW9uIGdldFNwZWVkKHVpbnQ2NCBwZXRJZCwgdWludDY0IGFjY2Vzc29yeUlkKSBwcml2YXRlIGNvbnN0YW50IHJldHVybnMgKHVpbnQxNikgewogICAgICAgICAgIC8vdGhpcyBzcGVlZCBmdW5jdGlvbiByZXR1cm5zIHBldCdzIGJhc2UgTHVjayArIGFueSBhY2Nlc3NvcnkgYm9vc3QgZnJvbSB0aGUgY2xvdmVyczsKICAgICAgICAgICBJQWNjZXNzb3J5RGF0YSBhY2Nlc3NvcnlEYXRhID0gSUFjY2Vzc29yeURhdGEoYWNjZXNzb3J5RGF0YUNvbnRyYWN0KTsKICAgICAgICAgICBJUGV0Q2FyZERhdGEgcGV0Q2FyZERhdGEgPSBJUGV0Q2FyZERhdGEocGV0Q2FyZERhdGFDb250cmFjdCk7CgogICAgICAgdWludDE2IHRlbXA7CiAgICAgICB1aW50OCBhY2Nlc3NvcnlTZXJpZXNJZDsKICAgICAgICAgKCwsLHRlbXAsLCwsLCwpID0gcGV0Q2FyZERhdGEuZ2V0UGV0KHBldElkKTsKICAgICAgICAgLy9maXJzdCBnZXQgdGhlIHBldCdzIGJhc2UgbHVjay4gCiAgICAgICAgICAgKCxhY2Nlc3NvcnlTZXJpZXNJZCwpID0gYWNjZXNzb3J5RGF0YS5nZXRBY2Nlc3NvcnkoYWNjZXNzb3J5SWQpOwogICAgICAgICAgIGlmIChhY2Nlc3NvcnlTZXJpZXNJZCA9PSA1KSB7dGVtcCArPSA1O30KICAgICAgICAgICAgaWYgKGFjY2Vzc29yeVNlcmllc0lkID09IDYpIHt0ZW1wICs9IDEwO30KICAgICAgICAgICAgcmV0dXJuIHRlbXA7CiAgCiAgICAgICB9CiAgICAgICAgICAKICAgICAgICBmdW5jdGlvbiBnZXROZXdUZWFtUG9zaXRpb25BbmRDaGVjayAodWludDE2IGJhdHRsZWJvYXJkSWQsdWludDggdGVhbSwgdWludDY0IGFuZ2VsSWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgSUJhdHRsZWJvYXJkRGF0YSBiYXR0bGVib2FyZERhdGEgPSBJQmF0dGxlYm9hcmREYXRhKGJhdHRsZWJvYXJkRGF0YUNvbnRyYWN0KTsKICAgICAgICAgICAgdWludDggbnVtVGVhbXMxOwogICAgICAgICAgICB1aW50OCBudW1UZWFtczI7CiAgICAgICAgICAgICB1aW50OCBwb3NpdGlvbjsKICAgICAgICAgICAgIHVpbnQ4IHJlc3RyaWN0aW9uczsKICAgICAgICAgICAgYm9vbCBpc0xpdmU7CiAgICAgICAgCiAgICAgICAgICAgLy9Ob3cgc2VlIHdoaWNoIHRpbGUgdG8gYWRkIHRoZSBuZXcgdGVhbS4gVGVhbXMgYXJlIGFkZGVkIGluIGEgc3BlY2lmaWVkIHBsYWNlIGJlc2VkIG9uIHdoZW4gdGhleSBqb2luLiAKICAgICAgICAgICAgICgsaXNMaXZlLCwsLCxyZXN0cmljdGlvbnMsLCBudW1UZWFtczEsbnVtVGVhbXMyLCwpID0gYmF0dGxlYm9hcmREYXRhLmdldEJhdHRsZWJvYXJkKGJhdHRsZWJvYXJkSWQpOwogICAgICAgICAgICAgICAKICAgICAgICAgICAgIGlmIChyZXN0cmljdGlvbnNBbGxvdyhhbmdlbElkLCByZXN0cmljdGlvbnMpID09IGZhbHNlKSB7cmV2ZXJ0KCk7fSAKICAgICAgICAgICAgaWYgKGlzTGl2ZT09IHRydWUpIHtyZXZlcnQoKTt9IC8vQ2FuJ3QgYWRkIGEgdGVhbSB0byBhIGJvYXJkIHRoYXQncyBhbHJlYWR5IGxpdmUuCiAgICAgICAgICAgICBpZiAodGVhbSA9PSAxKSB7CiAgICAgICAgICAgICAgICBpZiAobnVtVGVhbXMxID09IDApIHtwb3NpdGlvbiA9IDEwO30KICAgICAgICAgICAgICAgaWYgKG51bVRlYW1zMSA9PTEpIHtwb3NpdGlvbiA9IDEyO30KICAgICAgICAgICAgICAgaWYgKG51bVRlYW1zMSA9PSAyKSB7cG9zaXRpb24gPSAxNDt9CiAgICAgICAgICAgICAgIGlmIChudW1UZWFtczEgPj0zKSB7cmV2ZXJ0KCk7fQogICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHRlYW0gPT0gMikgewogICAgICAgICAgICAgICBpZiAobnVtVGVhbXMyID09IDApIHtwb3NpdGlvbiA9IDUwO30KICAgICAgICAgICAgICAgaWYgKG51bVRlYW1zMiA9PSAxKSB7cG9zaXRpb24gPSA1Mjt9CiAgICAgICAgICAgICAgIGlmIChudW1UZWFtczIgPT0gMikge3Bvc2l0aW9uID0gNTQ7fQogICAgICAgICAgICAgICBpZiAobnVtVGVhbXMyID49Mykge3JldmVydCgpO30KICAgICAgICAgICB9CiAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9uOwogICAgICAgIH0gIAogICAgICAgICAgCiAgICAgICAgICBmdW5jdGlvbiBjaGVja1RlYW1Ub0FkZCh1aW50NjQgYW5nZWxJZCwgdWludDY0IHBldElkLCB1aW50NjQgYWNjZXNzb3J5SWQpIHByaXZhdGUgY29uc3RhbnQgewogICAgICAgICAgICAgICBpZiAoKGNoZWNrRXhpc3RzT3duZWRBbmdlbChhbmdlbElkKSA9PSBmYWxzZSkgfHwgKGNoZWNrRXhpc3RzT3duZWRQZXQocGV0SWQpPT0gZmFsc2UpIHx8IChjaGVja0V4aXN0c093bmVkQWNjZXNzb3J5KGFjY2Vzc29yeUlkKSA9PSBmYWxzZSkpIHtyZXZlcnQoKTt9CiAgICAgICAgICB9CiAgICAgICAgICAKICAgICAgICAgICAgIAogICAgICAgICAgICAgZnVuY3Rpb24gYWRkUmFuZG9tVGlsZSh1aW50MTYgX2JhdHRsZWJvYXJkSWQsIHVpbnQ4IHNlZWQpIHByaXZhdGUgIHsKICAgICAgICAgICAgIElCYXR0bGVib2FyZERhdGEgYmF0dGxlYm9hcmREYXRhID0gSUJhdHRsZWJvYXJkRGF0YShiYXR0bGVib2FyZERhdGFDb250cmFjdCk7CiAgICAKICAgICAgICAgICB1aW50OCBuZXdUaWxlVHlwZTsKICAgICAgICAgICB1aW50OCBuZXdUaWxlUG93ZXI7CiAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAgLy9UaWxlIFRZUEVTCiAgICAvLyAwIC0gRW1wdHkgU3BhY2UKICAgIC8vIDEgLSBUZWFtIChBbmdlbCArIFBldCkKICAgIC8vIDMgLSBSZWQgQmFycmllciAocmVkIGlzIGh1cnQpCiAgICAvLyA0IC0gWWVsbG93IGJhcnJpZXIgKHllbGxvdyBpcyBodXJ0KQogICAgLy8gNSAtIEJsdWUgYmFycmllciAoYmx1ZSBpcyBodXJ0KQogICAgLy8gNiAtIEV4cCBCb29zdCAocGVybWFuZW50KQogICAgLy8gNyAtIEhQIGJvb3N0ICh0ZW1wKQogICAgLy8gOCAtIEV0aCBib29zdAogICAgLy8gOSAtIFdhcnAKICAgIC8vIDEwIC0gTWVkYWwKICAgIC8vIDExIC0gUGV0IHBlcm1hbmVudCBBdXJhIGJvb3N0IHJhbmRvbSBjb2xvcgogICAgCiAgICAgICAgICAgCiAgICAgICAgICAgdWludDggY2hhbmNlID0gZ2V0UmFuZG9tTnVtYmVyKDEwMCwwLHNlZWQpOwogICAgICAgICAgICAgCiAgICAgICAgICAgICAgaWYgKGNoYW5jZSA8PTMwKSAgewogICAgICAgICAgICAgICAgLy9CYXJyaWVyIHRpbGUKICAgICAgICAgICAgICAgIG5ld1RpbGVUeXBlID0gZ2V0UmFuZG9tTnVtYmVyKDUsMyxzZWVkKTsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcigzMCwxMCxzZWVkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKChjaGFuY2UgPj0zMCkgJiYgKGNoYW5jZSA8NTApKSB7CiAgICAgICAgICAgICAgICAvL0hQIGJvb3N0CiAgICAgICAgICAgICAgICBuZXdUaWxlVHlwZSA9IDc7CiAgICAgICAgICAgICAgICBuZXdUaWxlUG93ZXIgPSBnZXRSYW5kb21OdW1iZXIoNDUsMTUsc2VlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgIGlmICgoY2hhbmNlID49NTApICYmIChjaGFuY2UgPDYwKSkgewogICAgICAgICAgICAgICAgLy9FWFAgYm9vc3QKICAgICAgICAgICAgICAgIG5ld1RpbGVUeXBlID0gNjsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcig1LDEsc2VlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChjaGFuY2UgPj02MCkgJiYgKGNoYW5jZSA8ODApKSB7CiAgICAgICAgICAgICAgICAvL1dhcnAKICAgICAgICAgICAgICAgIG5ld1RpbGVUeXBlID0gOTsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcig2NCwxLHNlZWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoY2hhbmNlID49ODApICYmIChjaGFuY2UgPDkwKSkgewogICAgICAgICAgICAgICAgLy9NZWRhbAogICAgICAgICAgICAgICAgbmV3VGlsZVR5cGUgPSAxMDsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcigyLDAsc2VlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNoYW5jZSA+PTkwKSB7CiAgICAgICAgICAgICAgICAvL1BldCBBdXJhIGJvb3N0IAogICAgICAgICAgICAgICAgbmV3VGlsZVR5cGUgPSAxMTsKICAgICAgICAgICAgICAgIG5ld1RpbGVQb3dlciA9IGdldFJhbmRvbU51bWJlcig0LDEsc2VlZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgdWludDggcG9zaXRpb24gPSBnZXRSYW5kb21OdW1iZXIoNDksMTUsc2VlZCk7CiAgICAgICAgICAvL2lmIGRlc2lkZWQgcG9zaXRpb24gaXMgYWxyZWFkeSBmdWxsLCB0cnkgdGhyZWUgdGltZXMgdG8gcGxhY2UgdGhlbSBpbiBhbiBvcGVuIHNwb3QuIE9kZHMgYXJlIG1heCAwLjYlIHRoYXQgdGhlIHR4IHJldmVydHMuIAogICAgICAgICAgLy9SYW5kb20gdGlsZXMgYXJlIGluIHRoZSBtaWRkbGUgb2YgdGhlIGJvYXJkIGFuZCB3b24ndCBjb25mbGljdCB3aXRoIGFuYW5nZWxzLiAKICAgICAgICAgIC8vUmFuZG9tIHRpZWxzIENBTiBiZSBvbiB0aGUgc2FtZSBwb3NpdGlvbiBhcyBhIG1vbnN0ZXIsIHRob3VnaC4gCiAgICAgICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURieVBvc2l0aW9uKF9iYXR0bGVib2FyZElkLCBwb3NpdGlvbikhPSAwKSB7CiAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgcG9zaXRpb24gPSBnZXRSYW5kb21OdW1iZXIoNDksMTUsbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURieVBvc2l0aW9uKF9iYXR0bGVib2FyZElkLCBwb3NpdGlvbikhPSAwKSB7CiAgICAgICAgICAgICAgIHBvc2l0aW9uID0gZ2V0UmFuZG9tTnVtYmVyKDQ5LDE1LG1zZy5zZW5kZXIpOwogICAgICAgICAgICAgICAgaWYgKGJhdHRsZWJvYXJkRGF0YS5nZXRUaWxlSURieVBvc2l0aW9uKF9iYXR0bGVib2FyZElkLCBwb3NpdGlvbikhPSAwKSB7IAogICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSBnZXRSYW5kb21OdW1iZXIoNDksMTUsbXNnLnNlbmRlcik7CiAgICAgICAgICAgICAgICBpZiAoYmF0dGxlYm9hcmREYXRhLmdldFRpbGVJRGJ5UG9zaXRpb24oX2JhdHRsZWJvYXJkSWQsIHBvc2l0aW9uKSE9IDApIHtyZXZlcnQoKTt9CiAgICAgICAgICAgICAgfQogICAgICAgICAgIH0KICAgICAgICAgICB9CiAgICAgICAgIGJhdHRsZWJvYXJkRGF0YS5jcmVhdGVUaWxlKF9iYXR0bGVib2FyZElkLG5ld1RpbGVUeXBlLCBuZXdUaWxlUG93ZXIsIHBvc2l0aW9uLCAwLCAwLCAwLCAwLCBhZGRyZXNzKHRoaXMpLDApOwogICAgICAgfQogICAgICAgCiAgICAgICBmdW5jdGlvbiBhdXJhc0NvbXBhdGlibGUodWludDY0IGFuZ2VsMUlELCB1aW50OCAgX3BldEF1cmFDb2xvciApIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDgpIHsKICAgICAgICAgICAgdWludDggY29tcGF0aWJpbGl0eSA9IDA7CiAgICAgICAgICAgIAogICAgICAgIElBbmdlbENhcmREYXRhIGFuZ2VsQ2FyZERhdGEgPSBJQW5nZWxDYXJkRGF0YShhbmdlbENhcmREYXRhQ29udHJhY3QpOwogICAgICAgICAgdWludDggX2FuZ2VsMUF1cmE7CiAgICAgICAgICgsLCxfYW5nZWwxQXVyYSwsLCwsLCwpID0gYW5nZWxDYXJkRGF0YS5nZXRBbmdlbChhbmdlbDFJRCk7CiAgICAgICAgICAgIGlmIChfcGV0QXVyYUNvbG9yID09IDEpIHsKICAgICAgICAgICAgICAgIGlmICgoX2FuZ2VsMUF1cmEgPT0gMikgfHwgKF9hbmdlbDFBdXJhID09IDMpIHx8IChfYW5nZWwxQXVyYSA9PSA0KSkge2NvbXBhdGliaWxpdHkrKzt9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF9wZXRBdXJhQ29sb3IgPT0gMikgewogICAgICAgICAgICAgICAgaWYgKChfYW5nZWwxQXVyYSA9PSAwKSB8fCAoX2FuZ2VsMUF1cmEgPT0gMikgfHwgKF9hbmdlbDFBdXJhID09IDUpKSB7Y29tcGF0aWJpbGl0eSsrO30KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX3BldEF1cmFDb2xvciA9PSAzKSB7CiAgICAgICAgICAgICAgICBpZiAoKF9hbmdlbDFBdXJhID09IDEpIHx8IChfYW5nZWwxQXVyYSA9PSAzKSB8fCAoX2FuZ2VsMUF1cmEgPT0gNSkpIHtjb21wYXRpYmlsaXR5Kys7fQogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbXBhdGliaWxpdHkqMTI7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBmaW5kQXVyYUNvbXBvc2l0ZSh1aW50NjQgcGV0MUlELCB1aW50NjQgYWNjZXNzb3J5SWQpIHByaXZhdGUgY29uc3RhbnQgcmV0dXJucyAodWludDE2IGNvbXBvc2l0ZSwgdWludDggY29sb3IpIHsKICAgICAgICBJUGV0Q2FyZERhdGEgcGV0Q2FyZERhdGEgPSBJUGV0Q2FyZERhdGEocGV0Q2FyZERhdGFDb250cmFjdCk7CiAgICAgICAgCiAgICAgICB1aW50MTYgcGV0MWF1cmFSZWQ7CiAgICAgICB1aW50MTYgcGV0MWF1cmFCbHVlOwogICAgICAgdWludDE2IHBldDFhdXJhWWVsbG93OwogICAgICAgICgsLCwscGV0MWF1cmFSZWQscGV0MWF1cmFCbHVlLHBldDFhdXJhWWVsbG93LCwsKSA9IHBldENhcmREYXRhLmdldFBldChwZXQxSUQpOwogICAgICAgIAogICAgICAgICAgSUFjY2Vzc29yeURhdGEgYWNjZXNzb3J5RGF0YSA9IElBY2Nlc3NvcnlEYXRhKGFjY2Vzc29yeURhdGFDb250cmFjdCk7CiAgICAgICAgICAgCiAgICAgICAgICAgdWludDggYWNjZXNzb3J5U2VyaWVzSUQ7CiAgICAgICAgICAgCiAgICAgICAgICAgKCxhY2Nlc3NvcnlTZXJpZXNJRCwpID0gYWNjZXNzb3J5RGF0YS5nZXRBY2Nlc3NvcnkoYWNjZXNzb3J5SWQpOwogICAgICAgIAogICAgICAgIGlmIChhY2Nlc3NvcnlTZXJpZXNJRCA9PSA3KSB7cGV0MWF1cmFSZWQgKz0gNjt9CiAgICAgICAgaWYgKGFjY2Vzc29yeVNlcmllc0lEID09IDgpIHtwZXQxYXVyYVJlZCArPSAxMjt9CiAgICAgICAgaWYgKGFjY2Vzc29yeVNlcmllc0lEID09IDkpIHtwZXQxYXVyYVllbGxvdyArPSA2O30KICAgICAgICBpZiAoYWNjZXNzb3J5U2VyaWVzSUQgPT0gMTApIHtwZXQxYXVyYVllbGxvdyArPSAxMjt9CiAgICAgICAgaWYgKGFjY2Vzc29yeVNlcmllc0lEID09IDExKSB7cGV0MWF1cmFCbHVlICs9IDY7fQogICAgICAgIGlmIChhY2Nlc3NvcnlTZXJpZXNJRCA9PSAxMikge3BldDFhdXJhQmx1ZSArPSAxMjt9CiAgICAgICAgCiAgICAgICAKICAgICAgICAgICAgY29sb3IgPSAxOyAvL2Fzc3VtZSByZWQgdG8gc3RhcnQgCiAgICAgICAgICAgIGlmICgoKHBldDFhdXJhQmx1ZSkgPiAocGV0MWF1cmFSZWQpKSAmJiAoKHBldDFhdXJhQmx1ZSkgPiAocGV0MWF1cmFZZWxsb3cpKSkge2NvbG9yID0gMjt9CiAgICAgICAgICAgIGlmICgoKHBldDFhdXJhWWVsbG93KT4gKHBldDFhdXJhUmVkKSkgJiYgKChwZXQxYXVyYVllbGxvdyk+IChwZXQxYXVyYUJsdWUpKSkge2NvbG9yID0gMzt9CiAgICAgICAgICAgIGNvbXBvc2l0ZSA9IChwZXQxYXVyYVJlZCkgKyAocGV0MWF1cmFZZWxsb3cpICsgKHBldDFhdXJhQmx1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgICAgZnVuY3Rpb24ga2lsbCgpIG9ubHlDUkVBVE9SIGV4dGVybmFsIHsKICAgICAgICBzZWxmZGVzdHJ1Y3QoY3JlYXRvckFkZHJlc3MpOwogICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gd2l0aGRyYXdFdGhlcigpICBvbmx5Q1JFQVRPUiBleHRlcm5hbCB7CiAgIC8vc2hvdWxkbid0IGhhdmUgYW55IGV0aCBoZXJlIGJ1dCBqdXN0IGluIGNhc2UuIAogICAgY3JlYXRvckFkZHJlc3MudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKfQogICAgICAgICAgCn0='.
	

]
