Class {
	#name : #SRTaD111a1D34045dF921259FF91F8096EeC1afD7A9,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTaD111a1D34045dF921259FF91F8096EeC1afD7A9 >> base64 [
	^ 'LyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Ci8vLyBAdGl0bGUgVXRpbGl0eSBGdW5jdGlvbnMgZm9yIHVpbnQKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjcwMTQxMTFlMTkxNTFjMzAxYzFmMWYwMDAyMTkxZTE3NWUxZjAyMTciPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PgpsaWJyYXJ5IE1hdGhVaW50IHsKICAgIGZ1bmN0aW9uIG11bCh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IGMpIHsKICAgICAgICBjID0gYSAqIGI7CiAgICAgICAgcmVxdWlyZShhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICB9CiAgICBmdW5jdGlvbiBzdWIodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoYiA8PSBhKTsKICAgICAgICByZXR1cm4gYSAtIGI7CiAgICB9CiAgICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCBjKSB7CiAgICAgICAgYyA9IGEgKyBiOwogICAgICAgIHJlcXVpcmUoYyA+PSBhKTsKICAgIH0KICAgIGZ1bmN0aW9uIHRvbGVyYW50U3ViKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQgYykgewogICAgICAgIHJldHVybiAoYSA+PSBiKSA/IGEgLSBiIDogMDsKICAgIH0KICAgIC8vLyBAZGV2IGNhbGN1bGF0ZSB0aGUgc3F1YXJlIG9mIENvZWZmaWNpZW50IG9mIFZhcmlhdGlvbiAoQ1YpCiAgICAvLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29lZmZpY2llbnRfb2ZfdmFyaWF0aW9uCiAgICBmdW5jdGlvbiBjdnNxdWFyZSgKICAgICAgICB1aW50W10gYXJyLAogICAgICAgIHVpbnQgc2NhbGUKICAgICAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAodWludCkKICAgIHsKICAgICAgICB1aW50IGxlbiA9IGFyci5sZW5ndGg7CiAgICAgICAgcmVxdWlyZShsZW4gPiAxKTsKICAgICAgICByZXF1aXJlKHNjYWxlID4gMCk7CiAgICAgICAgdWludCBhdmcgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGF2ZyArPSBhcnJbaV07CiAgICAgICAgfQogICAgICAgIGF2ZyA9IGF2ZyAvIGxlbjsKICAgICAgICBpZiAoYXZnID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQgY3ZzID0gMDsKICAgICAgICB1aW50IHM7CiAgICAgICAgdWludCBpdGVtOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpdGVtID0gYXJyW2ldOwogICAgICAgICAgICBzID0gaXRlbSA+IGF2ZyA/IGl0ZW0gLSBhdmcgOiBhdmcgLSBpdGVtOwogICAgICAgICAgICBjdnMgKz0gbXVsKHMsIHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKChtdWwobXVsKGN2cywgc2NhbGUpLCBzY2FsZSkgLyBhdmcpIC8gYXZnKSAvIChsZW4gLSAxKTsKICAgIH0KfQovKgogIENvcHlyaWdodCAyMDE3IExvb3ByaW5nIFByb2plY3QgTHRkIChMb29wcmluZyBGb3VuZGF0aW9uKS4KICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwovKgogIENvcHlyaWdodCAyMDE3IExvb3ByaW5nIFByb2plY3QgTHRkIChMb29wcmluZyBGb3VuZGF0aW9uKS4KICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqLwovLy8gQHRpdGxlIEVSQzIwIFRva2VuIEludGVyZmFjZQovLy8gQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1NzMzMzYzOTNlMzIzYjE3M2IzODM4MjcyNTNlMzkzMDc5MzgyNTMwIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgRVJDMjAgewogICAgdWludCBwdWJsaWMgdG90YWxTdXBwbHk7CgkKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHZpZXcgcHVibGljIHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgdmlldyBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwp9Ci8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8vLyBAdGl0bGUgTG9vcHJpbmcgVG9rZW4gRXhjaGFuZ2UgUHJvdG9jb2wgQ29udHJhY3QgSW50ZXJmYWNlCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI4NmUyZTdlOGVmZTNlYWM2ZWFlOWU5ZjZmNGVmZThlMWE4ZTlmNGUxIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJkM2I4YmNiZGI0YmZiYWIyYmRiNDkzYmZiY2JjYTNhMWJhYmRiNGZkYmNhMWI0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4KY29udHJhY3QgTG9vcHJpbmdQcm90b2NvbCB7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQ29uc3RhbnRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICB1aW50OCAgIHB1YmxpYyBjb25zdGFudCBGRUVfU0VMRUNUX0xSQyAgICAgICAgICAgICAgID0gMDsKICAgIHVpbnQ4ICAgcHVibGljIGNvbnN0YW50IEZFRV9TRUxFQ1RfTUFSR0lOX1NQTElUICAgICAgPSAxOwogICAgdWludDggICBwdWJsaWMgY29uc3RhbnQgRkVFX1NFTEVDVF9NQVhfVkFMVUUgICAgICAgICA9IDE7CiAgICB1aW50OCAgIHB1YmxpYyBjb25zdGFudCBNQVJHSU5fU1BMSVRfUEVSQ0VOVEFHRV9CQVNFID0gMTAwOwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEV2ZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBkZXYgRXZlbnQgdG8gZW1pdCBpZiBhIHJpbmcgaXMgc3VjY2Vzc2Z1bGx5IG1pbmVkLgogICAgLy8vIF9hbW91bnRzTGlzdCBpcyBhbiBhcnJheSBvZjoKICAgIC8vLyBbX2Ftb3VudFNMaXN0LCBfYW1vdW50Qkxpc3QsIF9scmNSZXdhcmRMaXN0LCBfbHJjRmVlTGlzdF0uCiAgICBldmVudCBSaW5nTWluZWQoCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfcmluZ0luZGV4LAogICAgICAgIGJ5dGVzMzIgICAgIGluZGV4ZWQgX3JpbmdoYXNoLAogICAgICAgIGFkZHJlc3MgICAgICAgICAgICAgX21pbmVyLAogICAgICAgIGFkZHJlc3MgICAgICAgICAgICAgX2ZlZVJlY2lwaWVudCwKICAgICAgICBib29sICAgICAgICAgICAgICAgIF9pc1JpbmdoYXNoUmVzZXJ2ZWQsCiAgICAgICAgYnl0ZXMzMltdICAgICAgICAgICBfb3JkZXJIYXNoTGlzdCwKICAgICAgICB1aW50WzRdW10gICAgICAgICAgIF9hbW91bnRzTGlzdAogICAgKTsKICAgIGV2ZW50IE9yZGVyQ2FuY2VsbGVkKAogICAgICAgIGJ5dGVzMzIgICAgIGluZGV4ZWQgX29yZGVySGFzaCwKICAgICAgICB1aW50ICAgICAgICAgICAgICAgIF9hbW91bnRDYW5jZWxsZWQKICAgICk7CiAgICBldmVudCBDdXRvZmZUaW1lc3RhbXBDaGFuZ2VkKAogICAgICAgIGFkZHJlc3MgICAgIGluZGV4ZWQgX2FkZHJlc3MsCiAgICAgICAgdWludCAgICAgICAgICAgICAgICBfY3V0b2ZmCiAgICApOwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEBkZXYgU3VibWl0IGEgb3JkZXItcmluZyBmb3IgdmFsaWRhdGlvbiBhbmQgc2V0dGxlbWVudC4KICAgIC8vLyBAcGFyYW0gYWRkcmVzc0xpc3QgIExpc3Qgb2YgZWFjaCBvcmRlcidzIG93bmVyIGFuZCB0b2tlblMuIE5vdGUgdGhhdCBuZXh0CiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvcmRlcidzIGB0b2tlblNgIGVxdWFscyB0aGlzIG9yZGVyJ3MgYHRva2VuQmAuCiAgICAvLy8gQHBhcmFtIHVpbnRBcmdzTGlzdCBMaXN0IG9mIHVpbnQtdHlwZSBhcmd1bWVudHMgaW4gdGhpcyBvcmRlcjoKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGFtb3VudFMsIGFtb3VudEIsIHRpbWVzdGFtcCwgdHRsLCBzYWx0LCBscmNGZWUsCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICByYXRlQW1vdW50Uy4KICAgIC8vLyBAcGFyYW0gdWludDhBcmdzTGlzdCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMaXN0IG9mIHVuaXQ4LXR5cGUgYXJndW1lbnRzLCBpbiB0aGlzIG9yZGVyOgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlTGlzdCwgZmVlU2VsZWN0aW9uTGlzdC4KICAgIC8vLyBAcGFyYW0gYnV5Tm9Nb3JlVGhhbkFtb3VudEJMaXN0IC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIFRoaXMgaW5kaWNhdGVzIHdoZW4gYSBvcmRlciBzaG91bGQgYmUgY29uc2lkZXJlZAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgYXMgJ2NvbXBsZXRlbHkgZmlsbGVkJy4KICAgIC8vLyBAcGFyYW0gdkxpc3QgICAgICAgIExpc3Qgb2YgdiBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdiB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHJMaXN0ICAgICAgICBMaXN0IG9mIHIgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHIgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSBzTGlzdCAgICAgICAgTGlzdCBvZiBzIGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBzIHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gcmluZ21pbmVyICAgIFRoZSBhZGRyZXNzIHRoYXQgc2lnbmVkIHRoaXMgdHguCiAgICAvLy8gQHBhcmFtIGZlZVJlY2VwaWVudCBUaGUgcmVjZXBpZW50IGFkZHJlc3MgZm9yIGZlZSBjb2xsZWN0aW9uLiBJZiB0aGlzIGlzCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAnMHgwJywgYWxsIGZlZXMgd2lsbCBiZSBwYWlkIHRvIHRoZSBhZGRyZXNzIHdobyBoYWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHNpZ25lZCB0aGlzIHRyYW5zYWN0aW9uLCBub3QgYG1zZy5zZW5kZXJgLiBOb3RlZCBpZgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgTFJDIG5lZWQgdG8gYmUgcGFpZCBiYWNrIHRvIG9yZGVyIG93bmVyIGFzIHRoZSByZXN1bHQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIG9mIGZlZSBzZWxlY3Rpb24gbW9kZWwsIExSQyB3aWxsIGFsc28gYmUgc2VudCBmcm9tCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGlzIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBzdWJtaXRSaW5nKAogICAgICAgIGFkZHJlc3NbMl1bXSAgICBhZGRyZXNzTGlzdCwKICAgICAgICB1aW50WzddW10gICAgICAgdWludEFyZ3NMaXN0LAogICAgICAgIHVpbnQ4WzJdW10gICAgICB1aW50OEFyZ3NMaXN0LAogICAgICAgIGJvb2xbXSAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgdWludDhbXSAgICAgICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICByTGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgc0xpc3QsCiAgICAgICAgYWRkcmVzcyAgICAgICAgIHJpbmdtaW5lciwKICAgICAgICBhZGRyZXNzICAgICAgICAgZmVlUmVjZXBpZW50CiAgICAgICAgKSBwdWJsaWM7CiAgICAvLy8gQGRldiBDYW5jZWwgYSBvcmRlci4gY2FuY2VsIGFtb3VudChhbW91bnRTIG9yIGFtb3VudEIpIGNhbiBiZSBzcGVjaWZpZWQKICAgIC8vLyAgICAgIGluIG9yZGVyVmFsdWVzLgogICAgLy8vIEBwYXJhbSBhZGRyZXNzZXMgICAgICAgICAgb3duZXIsIHRva2VuUywgdG9rZW5CCiAgICAvLy8gQHBhcmFtIG9yZGVyVmFsdWVzICAgICAgICBhbW91bnRTLCBhbW91bnRCLCB0aW1lc3RhbXAsIHR0bCwgc2FsdCwgbHJjRmVlLAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQW1vdW50UywgYW5kIGNhbmNlbEFtb3VudEIuCiAgICAvLy8gQHBhcmFtIGJ1eU5vTW9yZVRoYW5BbW91bnRCIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoaXMgaW5kaWNhdGVzIHdoZW4gYSBvcmRlciBzaG91bGQgYmUgY29uc2lkZXJlZAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgJ2NvbXBsZXRlbHkgZmlsbGVkJy4KICAgIC8vLyBAcGFyYW0gbWFyZ2luU3BsaXRQZXJjZW50YWdlIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIFBlcmNlbnRhZ2Ugb2YgbWFyZ2luIHNwbGl0IHRvIHNoYXJlIHdpdGggbWluZXIuCiAgICAvLy8gQHBhcmFtIHYgICAgICAgICAgICAgICAgICBPcmRlciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVyIHYuCiAgICAvLy8gQHBhcmFtIHIgICAgICAgICAgICAgICAgICBPcmRlciBFQ0RTQSBzaWduYXR1cmUgcGFyYW1ldGVycyByLgogICAgLy8vIEBwYXJhbSBzICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgcy4KICAgIGZ1bmN0aW9uIGNhbmNlbE9yZGVyKAogICAgICAgIGFkZHJlc3NbM10gYWRkcmVzc2VzLAogICAgICAgIHVpbnRbN10gICAgb3JkZXJWYWx1ZXMsCiAgICAgICAgYm9vbCAgICAgICBidXlOb01vcmVUaGFuQW1vdW50QiwKICAgICAgICB1aW50OCAgICAgIG1hcmdpblNwbGl0UGVyY2VudGFnZSwKICAgICAgICB1aW50OCAgICAgIHYsCiAgICAgICAgYnl0ZXMzMiAgICByLAogICAgICAgIGJ5dGVzMzIgICAgcwogICAgICAgICkgZXh0ZXJuYWw7CiAgICAvLy8gQGRldiAgIFNldCBhIGN1dG9mZiB0aW1lc3RhbXAgdG8gaW52YWxpZGF0ZSBhbGwgb3JkZXJzIHdob3NlIHRpbWVzdGFtcAogICAgLy8vICAgICAgICBpcyBzbWFsbGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIG5ldyB2YWx1ZSBvZiB0aGUgYWRkcmVzcydzIGN1dG9mZgogICAgLy8vICAgICAgICB0aW1lc3RhbXAuCiAgICAvLy8gQHBhcmFtIGN1dG9mZiBUaGUgY3V0b2ZmIHRpbWVzdGFtcCwgd2lsbCBkZWZhdWx0IHRvIGBibG9jay50aW1lc3RhbXBgCiAgICAvLy8gICAgICAgIGlmIGl0IGlzIDAuCiAgICBmdW5jdGlvbiBzZXRDdXRvZmYodWludCBjdXRvZmYpIGV4dGVybmFsOwp9Ci8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8vLyBAdGl0bGUgVXRpbGl0eSBGdW5jdGlvbnMgZm9yIGJ5dGUzMgovLy8gQGF1dGhvciBLb25nbGlhbmcgWmhvbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjdhMTExNTE0MWQxNjEzMWIxNDFkM2ExNjE1MTUwYTA4MTMxNDFkNTQxNTA4MWQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiwKLy8vIEBhdXRob3IgRGFuaWVsIFdhbmcgLSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9IjA1NjE2NDZiNmM2MDY5NDU2OTZhNmE3NTc3NmM2YjYyMmI2YTc3NjIiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+Pi4KbGlicmFyeSBNYXRoQnl0ZXMzMiB7CiAgICBmdW5jdGlvbiB4b3JSZWR1Y2UoCiAgICAgICAgYnl0ZXMzMltdICAgYXJyLAogICAgICAgIHVpbnQgICAgICAgIGxlbgogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zIChieXRlczMyIHJlcykKICAgIHsKICAgICAgICByZXMgPSBhcnJbMF07CiAgICAgICAgZm9yICh1aW50IGkgPSAxOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgcmVzIF49IGFycltpXTsKICAgICAgICB9CiAgICB9Cn0KLyoKICBDb3B5cmlnaHQgMjAxNyBMb29wcmluZyBQcm9qZWN0IEx0ZCAoTG9vcHJpbmcgRm91bmRhdGlvbikuCiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KKi8KLy8vIEB0aXRsZSBVdGlsaXR5IEZ1bmN0aW9ucyBmb3IgdWludDgKLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJiZGQ2ZDJkM2RhZDFkNGRjZDNkYWZkZDFkMmQyY2RjZmQ0ZDNkYTkzZDJjZmRhIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4sCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSI1NTMxMzQzYjNjMzAzOTE1MzkzYTNhMjUyNzNjM2IzMjdiM2EyNzMyIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmxpYnJhcnkgTWF0aFVpbnQ4IHsKICAgIGZ1bmN0aW9uIHhvclJlZHVjZSgKICAgICAgICB1aW50OFtdIGFyciwKICAgICAgICB1aW50ICAgIGxlbgogICAgICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50OCByZXMpCiAgICB7CiAgICAgICAgcmVzID0gYXJyWzBdOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIHJlcyBePSBhcnJbaV07CiAgICAgICAgfQogICAgfQp9Ci8vLyBAdGl0bGUgUmluZyBIYXNoIFJlZ2lzdHJ5IENvbnRyYWN0Ci8vLyBAZGV2IFRoaXMgY29udHJhY3RzIGhlbHAgcmVzZXJ2ZSByaW5naGFzaGVzIGZvciBtaW5lcnMuCi8vLyBAYXV0aG9yIEtvbmdsaWFuZyBaaG9uZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNDEyYTJlMmYyNjJkMjgyMDJmMjYwMTJkMmUyZTMxMzMyODJmMjY2ZjJlMzMyNiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+LAovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNTIzNjMzM2MzYjM3M2UxMjNlM2QzZDIyMjAzYjNjMzU3YzNkMjAzNSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+Lgpjb250cmFjdCBSaW5naGFzaFJlZ2lzdHJ5IHsKICAgIHVzaW5nIE1hdGhCeXRlczMyICAgZm9yIGJ5dGVzMzJbXTsKICAgIHVzaW5nIE1hdGhVaW50OCAgICAgZm9yIHVpbnQ4W107CiAgICB1aW50IHB1YmxpYyBibG9ja3NUb0xpdmU7CiAgICBzdHJ1Y3QgU3VibWlzc2lvbiB7CiAgICAgICAgYWRkcmVzcyByaW5nbWluZXI7CiAgICAgICAgdWludCBibG9jazsKICAgIH0KICAgIG1hcHBpbmcgKGJ5dGVzMzIgPT4gU3VibWlzc2lvbikgc3VibWlzc2lvbnM7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gRXZlbnRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBldmVudCBSaW5naGFzaFN1Ym1pdHRlZCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgX3JpbmdtaW5lciwKICAgICAgICBieXRlczMyIGluZGV4ZWQgX3JpbmdoYXNoCiAgICApOwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIENvbnN0cnVjdG9yICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgZnVuY3Rpb24gUmluZ2hhc2hSZWdpc3RyeSh1aW50IF9ibG9ja3NUb0xpdmUpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZShfYmxvY2tzVG9MaXZlID4gMCk7CiAgICAgICAgYmxvY2tzVG9MaXZlID0gX2Jsb2Nrc1RvTGl2ZTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBQdWJsaWMgRnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIGZ1bmN0aW9uIHN1Ym1pdFJpbmdoYXNoKAogICAgICAgIGFkZHJlc3MgICAgIHJpbmdtaW5lciwKICAgICAgICBieXRlczMyICAgICByaW5naGFzaAogICAgICAgICkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKGNhblN1Ym1pdChyaW5naGFzaCwgcmluZ21pbmVyKSk7IC8vLCAiUmluZ2hhc2ggc3VibWl0dGVkIik7CiAgICAgICAgc3VibWlzc2lvbnNbcmluZ2hhc2hdID0gU3VibWlzc2lvbihyaW5nbWluZXIsIGJsb2NrLm51bWJlcik7CiAgICAgICAgUmluZ2hhc2hTdWJtaXR0ZWQocmluZ21pbmVyLCByaW5naGFzaCk7CiAgICB9CiAgICBmdW5jdGlvbiBiYXRjaFN1Ym1pdFJpbmdoYXNoKAogICAgICAgIGFkZHJlc3NbXSAgICAgcmluZ21pbmVyTGlzdCwKICAgICAgICBieXRlczMyW10gICAgIHJpbmdoYXNoTGlzdAogICAgICAgICkKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIHVpbnQgc2l6ZSA9IHJpbmdtaW5lckxpc3QubGVuZ3RoOwogICAgICAgIHJlcXVpcmUoc2l6ZSA+IDApOwogICAgICAgIHJlcXVpcmUoc2l6ZSA9PSByaW5naGFzaExpc3QubGVuZ3RoKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICAgICAgc3VibWl0UmluZ2hhc2gocmluZ21pbmVyTGlzdFtpXSwgcmluZ2hhc2hMaXN0W2ldKTsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQGRldiBDYWxjdWxhdGUgdGhlIGhhc2ggb2YgYSByaW5nLgogICAgZnVuY3Rpb24gY2FsY3VsYXRlUmluZ2hhc2goCiAgICAgICAgdWludCAgICAgICAgcmluZ1NpemUsCiAgICAgICAgdWludDhbXSAgICAgdkxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgckxpc3QsCiAgICAgICAgYnl0ZXMzMltdICAgc0xpc3QKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zIChieXRlczMyKQogICAgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIHJpbmdTaXplID09IHZMaXN0Lmxlbmd0aCAtIDEgJiYgKAogICAgICAgICAgICByaW5nU2l6ZSA9PSByTGlzdC5sZW5ndGggLSAxICYmICgKICAgICAgICAgICAgcmluZ1NpemUgPT0gc0xpc3QubGVuZ3RoIC0gMSkpCiAgICAgICAgKTsgLy8sICJpbnZhbGlkIHJpbmcgZGF0YSIpOwogICAgICAgIHJldHVybiBrZWNjYWsyNTYoCiAgICAgICAgICAgIHZMaXN0LnhvclJlZHVjZShyaW5nU2l6ZSksCiAgICAgICAgICAgIHJMaXN0LnhvclJlZHVjZShyaW5nU2l6ZSksCiAgICAgICAgICAgIHNMaXN0LnhvclJlZHVjZShyaW5nU2l6ZSkKICAgICAgICApOwogICAgfQogICAgIC8vLyByZXR1cm4gdmFsdWUgYXR0cmlidXRlc1syXSBjb250YWlucyB0aGUgZm9sbG93aW5nIHZhbHVlcyBpbiB0aGlzIG9yZGVyOgogICAgIC8vLyBjYW5TdWJtaXQsIGlzUmVzZXJ2ZWQuCiAgICBmdW5jdGlvbiBjb21wdXRlQW5kR2V0UmluZ2hhc2hJbmZvKAogICAgICAgIHVpbnQgICAgICAgIHJpbmdTaXplLAogICAgICAgIGFkZHJlc3MgICAgIHJpbmdtaW5lciwKICAgICAgICB1aW50OFtdICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICByTGlzdCwKICAgICAgICBieXRlczMyW10gICBzTGlzdAogICAgICAgICkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChieXRlczMyIHJpbmdoYXNoLCBib29sWzJdIGF0dHJpYnV0ZXMpCiAgICB7CiAgICAgICAgcmluZ2hhc2ggPSBjYWxjdWxhdGVSaW5naGFzaCgKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIHZMaXN0LAogICAgICAgICAgICByTGlzdCwKICAgICAgICAgICAgc0xpc3QKICAgICAgICApOwogICAgICAgIGF0dHJpYnV0ZXNbMF0gPSBjYW5TdWJtaXQocmluZ2hhc2gsIHJpbmdtaW5lcik7CiAgICAgICAgYXR0cmlidXRlc1sxXSA9IGlzUmVzZXJ2ZWQocmluZ2hhc2gsIHJpbmdtaW5lcik7CiAgICB9CiAgICAvLy8gQHJldHVybiB0cnVlIGlmIGEgcmluZydzIGhhc2ggY2FuIGJlIHN1Ym1pdHRlZDsKICAgIC8vLyBmYWxzZSBvdGhlcndpc2UuCiAgICBmdW5jdGlvbiBjYW5TdWJtaXQoCiAgICAgICAgYnl0ZXMzMiByaW5naGFzaCwKICAgICAgICBhZGRyZXNzIHJpbmdtaW5lcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXF1aXJlKHJpbmdtaW5lciAhPSAweDApOwogICAgICAgIHZhciBzdWJtaXNzaW9uID0gc3VibWlzc2lvbnNbcmluZ2hhc2hdOwogICAgICAgIGFkZHJlc3MgbWluZXIgPSBzdWJtaXNzaW9uLnJpbmdtaW5lcjsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBtaW5lciA9PSAweDAgfHwgKAogICAgICAgICAgICBzdWJtaXNzaW9uLmJsb2NrICsgYmxvY2tzVG9MaXZlIDwgYmxvY2subnVtYmVyKSB8fCAoCiAgICAgICAgICAgIG1pbmVyID09IHJpbmdtaW5lcikKICAgICAgICApOwogICAgfQogICAgLy8vIEByZXR1cm4gdHJ1ZSBpZiBhIHJpbmcncyBoYXNoIHdhcyBzdWJtaXR0ZWQgYW5kIHN0aWxsIHZhbGlkOwogICAgLy8vIGZhbHNlIG90aGVyd2lzZS4KICAgIGZ1bmN0aW9uIGlzUmVzZXJ2ZWQoCiAgICAgICAgYnl0ZXMzMiByaW5naGFzaCwKICAgICAgICBhZGRyZXNzIHJpbmdtaW5lcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICB2YXIgc3VibWlzc2lvbiA9IHN1Ym1pc3Npb25zW3JpbmdoYXNoXTsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBzdWJtaXNzaW9uLmJsb2NrICsgYmxvY2tzVG9MaXZlID49IGJsb2NrLm51bWJlciAmJiAoCiAgICAgICAgICAgIHN1Ym1pc3Npb24ucmluZ21pbmVyID09IHJpbmdtaW5lcikKICAgICAgICApOwogICAgfQp9Ci8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8vLyBAdGl0bGUgT3duYWJsZQovLy8gQGRldiBUaGUgT3duYWJsZSBjb250cmFjdCBoYXMgYW4gb3duZXIgYWRkcmVzcywgYW5kIHByb3ZpZGVzIGJhc2ljCi8vLyAgICAgIGF1dGhvcml6YXRpb24gY29udHJvbCBmdW5jdGlvbnMsIHRoaXMgc2ltcGxpZmllcyB0aGUgaW1wbGVtZW50YXRpb24gb2YKLy8vICAgICAgInVzZXIgcGVybWlzc2lvbnMiLgpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwogICAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyCiAgICApOwogICAgLy8vIEBkZXYgVGhlIE93bmFibGUgY29uc3RydWN0b3Igc2V0cyB0aGUgb3JpZ2luYWwgYG93bmVyYCBvZiB0aGUgY29udHJhY3QKICAgIC8vLyAgICAgIHRvIHRoZSBzZW5kZXIuCiAgICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CiAgICAvLy8gQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KICAgIC8vLyBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhCiAgICAvLy8gICAgICBuZXdPd25lci4KICAgIC8vLyBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSAweDApOwogICAgICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KfQovLy8gQHRpdGxlIENsYWltYWJsZQovLy8gQGRldiBFeHRlbnNpb24gZm9yIHRoZSBPd25hYmxlIGNvbnRyYWN0LCB3aGVyZSB0aGUgb3duZXJzaGlwIG5lZWRzCi8vLyAgICAgIHRvIGJlIGNsYWltZWQuIFRoaXMgYWxsb3dzIHRoZSBuZXcgb3duZXIgdG8gYWNjZXB0IHRoZSB0cmFuc2Zlci4KY29udHJhY3QgQ2xhaW1hYmxlIGlzIE93bmFibGUgewogICAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ093bmVyOwogICAgLy8vIEBkZXYgTW9kaWZpZXIgdGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBwZW5kaW5nT3duZXIuCiAgICBtb2RpZmllciBvbmx5UGVuZGluZ093bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBwZW5kaW5nT3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICAvLy8gQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gc2V0IHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShuZXdPd25lciAhPSAweDAgJiYgbmV3T3duZXIgIT0gb3duZXIpOwogICAgICAgIHBlbmRpbmdPd25lciA9IG5ld093bmVyOwogICAgfQogICAgLy8vIEBkZXYgQWxsb3dzIHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcyB0byBmaW5hbGl6ZSB0aGUgdHJhbnNmZXIuCiAgICBmdW5jdGlvbiBjbGFpbU93bmVyc2hpcCgpIG9ubHlQZW5kaW5nT3duZXIgcHVibGljIHsKICAgICAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgcGVuZGluZ093bmVyKTsKICAgICAgICBvd25lciA9IHBlbmRpbmdPd25lcjsKICAgICAgICBwZW5kaW5nT3duZXIgPSAweDA7CiAgICB9Cn0KLy8vIEB0aXRsZSBUb2tlbiBSZWdpc3RlciBDb250cmFjdAovLy8gQGRldiBUaGlzIGNvbnRyYWN0IG1haW50YWlucyBhIGxpc3Qgb2YgdG9rZW5zIHRoZSBQcm90b2NvbCBzdXBwb3J0cy4KLy8vIEBhdXRob3IgS29uZ2xpYW5nIFpob25nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJiNmRkZDlkOGQxZGFkZmQ3ZDhkMWY2ZGFkOWQ5YzZjNGRmZDhkMTk4ZDljNGQxIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4sCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSJlYThlOGI4NDgzOGY4NmFhODY4NTg1OWE5ODgzODQ4ZGM0ODU5ODhkIj5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4uCmNvbnRyYWN0IFRva2VuUmVnaXN0cnkgaXMgQ2xhaW1hYmxlIHsKICAgIGFkZHJlc3NbXSBwdWJsaWMgdG9rZW5zOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSB0b2tlbk1hcDsKICAgIG1hcHBpbmcgKHN0cmluZyA9PiBhZGRyZXNzKSB0b2tlblN5bWJvbE1hcDsKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVG9rZW4oYWRkcmVzcyBfdG9rZW4sIHN0cmluZyBfc3ltYm9sKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gMHgwKTsKICAgICAgICByZXF1aXJlKCFpc1Rva2VuUmVnaXN0ZXJlZEJ5U3ltYm9sKF9zeW1ib2wpKTsKICAgICAgICByZXF1aXJlKCFpc1Rva2VuUmVnaXN0ZXJlZChfdG9rZW4pKTsKICAgICAgICB0b2tlbnMucHVzaChfdG9rZW4pOwogICAgICAgIHRva2VuTWFwW190b2tlbl0gPSB0cnVlOwogICAgICAgIHRva2VuU3ltYm9sTWFwW19zeW1ib2xdID0gX3Rva2VuOwogICAgfQogICAgZnVuY3Rpb24gdW5yZWdpc3RlclRva2VuKGFkZHJlc3MgX3Rva2VuLCBzdHJpbmcgX3N5bWJvbCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUoX3Rva2VuICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZSh0b2tlblN5bWJvbE1hcFtfc3ltYm9sXSA9PSBfdG9rZW4pOwogICAgICAgIGRlbGV0ZSB0b2tlblN5bWJvbE1hcFtfc3ltYm9sXTsKICAgICAgICBkZWxldGUgdG9rZW5NYXBbX3Rva2VuXTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHRva2Vuc1tpXSA9PSBfdG9rZW4pIHsKICAgICAgICAgICAgICAgIHRva2Vuc1tpXSA9IHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICB0b2tlbnMubGVuZ3RoIC0tOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpc1Rva2VuUmVnaXN0ZXJlZEJ5U3ltYm9sKHN0cmluZyBzeW1ib2wpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIHRva2VuU3ltYm9sTWFwW3N5bWJvbF0gIT0gMHgwOwogICAgfQogICAgZnVuY3Rpb24gaXNUb2tlblJlZ2lzdGVyZWQoYWRkcmVzcyBfdG9rZW4pCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgcmV0dXJuIHRva2VuTWFwW190b2tlbl07CiAgICB9CiAgICBmdW5jdGlvbiBhcmVBbGxUb2tlbnNSZWdpc3RlcmVkKGFkZHJlc3NbXSB0b2tlbkxpc3QpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbkxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCF0b2tlbk1hcFt0b2tlbkxpc3RbaV1dKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzQnlTeW1ib2woc3RyaW5nIHN5bWJvbCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChhZGRyZXNzKQogICAgewogICAgICAgIHJldHVybiB0b2tlblN5bWJvbE1hcFtzeW1ib2xdOwogICAgfQp9Ci8qCiAgQ29weXJpZ2h0IDIwMTcgTG9vcHJpbmcgUHJvamVjdCBMdGQgKExvb3ByaW5nIEZvdW5kYXRpb24pLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiovCi8vLyBAdGl0bGUgVG9rZW5UcmFuc2ZlckRlbGVnYXRlCi8vLyBAZGV2IEFjdHMgYXMgYSBtaWRkbGUgbWFuIHRvIHRyYW5zZmVyIEVSQzIwIHRva2VucyBvbiBiZWhhbGYgb2YgZGlmZmVyZW50Ci8vLyB2ZXJzaW9ucyBvZiBMb29wcmluZyBwcm90b2NvbCB0byBhdm9pZCBFUkMyMCByZS1hdXRob3JpemF0aW9uLgovLy8gQGF1dGhvciBEYW5pZWwgV2FuZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iMDg2YzY5NjY2MTZkNjQ0ODY0Njc2Nzc4N2E2MTY2NmYyNjY3N2E2ZiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+Lgpjb250cmFjdCBUb2tlblRyYW5zZmVyRGVsZWdhdGUgaXMgQ2xhaW1hYmxlIHsKICAgIHVzaW5nIE1hdGhVaW50IGZvciB1aW50OwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIFZhcmlhYmxlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgbWFwcGluZyhhZGRyZXNzID0+IEFkZHJlc3NJbmZvKSBwcml2YXRlIGFkZHJlc3NJbmZvczsKICAgIGFkZHJlc3MgcHVibGljIGxhdGVzdEFkZHJlc3M7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gU3RydWN0cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBzdHJ1Y3QgQWRkcmVzc0luZm8gewogICAgICAgIGFkZHJlc3MgcHJldmlvdXM7CiAgICAgICAgdWludDMyICBpbmRleDsKICAgICAgICBib29sICAgIGF1dGhvcml6ZWQ7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gTW9kaWZpZXJzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBtb2RpZmllciBvbmx5QXV0aG9yaXplZCgpIHsKICAgICAgICByZXF1aXJlKGFkZHJlc3NJbmZvc1ttc2cuc2VuZGVyXS5hdXRob3JpemVkKTsKICAgICAgICBfOwogICAgfQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIEV2ZW50cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgZXZlbnQgQWRkcmVzc0F1dGhvcml6ZWQoYWRkcmVzcyBpbmRleGVkIGFkZHIsIHVpbnQzMiBudW1iZXIpOwogICAgZXZlbnQgQWRkcmVzc0RlYXV0aG9yaXplZChhZGRyZXNzIGluZGV4ZWQgYWRkciwgdWludDMyIG51bWJlcik7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQGRldiBBZGQgYSBMb29wcmluZyBwcm90b2NvbCBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBhZGRyIEEgbG9vcHJpbmcgcHJvdG9jb2wgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIGF1dGhvcml6ZUFkZHJlc3MoYWRkcmVzcyBhZGRyKQogICAgICAgIG9ubHlPd25lcgogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgdmFyIGFkZHJJbmZvID0gYWRkcmVzc0luZm9zW2FkZHJdOwogICAgICAgIGlmIChhZGRySW5mby5pbmRleCAhPSAwKSB7IC8vIGV4aXN0aW5nCiAgICAgICAgICAgIGlmIChhZGRySW5mby5hdXRob3JpemVkID09IGZhbHNlKSB7IC8vIHJlLWF1dGhvcml6ZQogICAgICAgICAgICAgICAgYWRkckluZm8uYXV0aG9yaXplZCA9IHRydWU7CiAgICAgICAgICAgICAgICBBZGRyZXNzQXV0aG9yaXplZChhZGRyLCBhZGRySW5mby5pbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhZGRyZXNzIHByZXYgPSBsYXRlc3RBZGRyZXNzOwogICAgICAgICAgICBpZiAocHJldiA9PSAweDApIHsKICAgICAgICAgICAgICAgIGFkZHJJbmZvLmluZGV4ID0gMTsKICAgICAgICAgICAgICAgIGFkZHJJbmZvLmF1dGhvcml6ZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWRkckluZm8ucHJldmlvdXMgPSBwcmV2OwogICAgICAgICAgICAgICAgYWRkckluZm8uaW5kZXggPSBhZGRyZXNzSW5mb3NbcHJldl0uaW5kZXggKyAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZHJJbmZvLmF1dGhvcml6ZWQgPSB0cnVlOwogICAgICAgICAgICBsYXRlc3RBZGRyZXNzID0gYWRkcjsKICAgICAgICAgICAgQWRkcmVzc0F1dGhvcml6ZWQoYWRkciwgYWRkckluZm8uaW5kZXgpOwogICAgICAgIH0KICAgIH0KICAgIC8vLyBAZGV2IFJlbW92ZSBhIExvb3ByaW5nIHByb3RvY29sIGFkZHJlc3MuCiAgICAvLy8gQHBhcmFtIGFkZHIgQSBsb29wcmluZyBwcm90b2NvbCBhZGRyZXNzLgogICAgZnVuY3Rpb24gZGVhdXRob3JpemVBZGRyZXNzKGFkZHJlc3MgYWRkcikKICAgICAgICBvbmx5T3duZXIKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIHVpbnQzMiBpbmRleCA9IGFkZHJlc3NJbmZvc1thZGRyXS5pbmRleDsKICAgICAgICBpZiAoaW5kZXggIT0gMCkgewogICAgICAgICAgICBhZGRyZXNzSW5mb3NbYWRkcl0uYXV0aG9yaXplZCA9IGZhbHNlOwogICAgICAgICAgICBBZGRyZXNzRGVhdXRob3JpemVkKGFkZHIsIGluZGV4KTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpc0FkZHJlc3NBdXRob3JpemVkKGFkZHJlc3MgYWRkcikKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gYWRkcmVzc0luZm9zW2FkZHJdLmF1dGhvcml6ZWQ7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRMYXRlc3RBdXRob3JpemVkQWRkcmVzc2VzKHVpbnQgbWF4KQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKGFkZHJlc3NbXSBhZGRyZXNzZXMpCiAgICB7CiAgICAgICAgYWRkcmVzc2VzID0gbmV3IGFkZHJlc3NbXShtYXgpOwogICAgICAgIGFkZHJlc3MgYWRkciA9IGxhdGVzdEFkZHJlc3M7CiAgICAgICAgQWRkcmVzc0luZm8gbWVtb3J5IGFkZHJJbmZvOwogICAgICAgIHVpbnQgY291bnQgPSAwOwogICAgICAgIHdoaWxlIChhZGRyICE9IDB4MCAmJiBjb3VudCA8IG1heCkgewogICAgICAgICAgICBhZGRySW5mbyA9IGFkZHJlc3NJbmZvc1thZGRyXTsKICAgICAgICAgICAgaWYgKGFkZHJJbmZvLmluZGV4ID09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZHJlc3Nlc1tjb3VudCsrXSA9IGFkZHI7CiAgICAgICAgICAgIGFkZHIgPSBhZGRySW5mby5wcmV2aW91czsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQGRldiBJbnZva2UgRVJDMjAgdHJhbnNmZXJGcm9tIG1ldGhvZC4KICAgIC8vLyBAcGFyYW0gdG9rZW4gQWRkcmVzcyBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIC8vLyBAcGFyYW0gZnJvbSBBZGRyZXNzIHRvIHRyYW5zZmVyIHRva2VuIGZyb20uCiAgICAvLy8gQHBhcmFtIHRvIEFkZHJlc3MgdG8gdHJhbnNmZXIgdG9rZW4gdG8uCiAgICAvLy8gQHBhcmFtIHZhbHVlIEFtb3VudCBvZiB0b2tlbiB0byB0cmFuc2Zlci4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG9rZW4oCiAgICAgICAgYWRkcmVzcyB0b2tlbiwKICAgICAgICBhZGRyZXNzIGZyb20sCiAgICAgICAgYWRkcmVzcyB0bywKICAgICAgICB1aW50ICAgIHZhbHVlKQogICAgICAgIG9ubHlBdXRob3JpemVkCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICBpZiAodmFsdWUgPiAwICYmIGZyb20gIT0gdG8pIHsKICAgICAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgICAgIEVSQzIwKHRva2VuKS50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGJhdGNoVHJhbnNmZXJUb2tlbigKICAgICAgICBhZGRyZXNzIGxyY1Rva2VuQWRkcmVzcywKICAgICAgICBhZGRyZXNzIGZlZVJlY2lwaWVudCwKICAgICAgICBieXRlczMyW10gYmF0Y2gpCiAgICAgICAgb25seUF1dGhvcml6ZWQKICAgICAgICBleHRlcm5hbAogICAgewogICAgICAgIHVpbnQgbGVuID0gYmF0Y2gubGVuZ3RoOwogICAgICAgIHJlcXVpcmUobGVuICUgNiA9PSAwKTsKICAgICAgICB2YXIgbHJjID0gRVJDMjAobHJjVG9rZW5BZGRyZXNzKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBsZW47IGkgKz0gNikgewogICAgICAgICAgICBhZGRyZXNzIG93bmVyID0gYWRkcmVzcyhiYXRjaFtpXSk7CiAgICAgICAgICAgIGFkZHJlc3MgcHJldk93bmVyID0gYWRkcmVzcyhiYXRjaFsoaSArIGxlbiAtIDYpICUgbGVuXSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBQYXkgdG9rZW4gdG8gcHJldmlvdXMgb3JkZXIsIG9yIHRvIG1pbmVyIGFzIHByZXZpb3VzIG9yZGVyJ3MKICAgICAgICAgICAgLy8gbWFyZ2luIHNwbGl0IG9yL2FuZCB0aGlzIG9yZGVyJ3MgbWFyZ2luIHNwbGl0LgogICAgICAgICAgICB2YXIgdG9rZW4gPSBFUkMyMChhZGRyZXNzKGJhdGNoW2kgKyAxXSkpOwogICAgICAgICAgICAvLyBIZXJlIGJhdGNoW2krMl0gaGFzIGJlZW4gY2hlY2tlZCBub3QgdG8gYmUgMC4KICAgICAgICAgICAgaWYgKG93bmVyICE9IHByZXZPd25lcikgewogICAgICAgICAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgICAgICAgICB0b2tlbi50cmFuc2ZlckZyb20ob3duZXIsIHByZXZPd25lciwgdWludChiYXRjaFtpICsgMl0pKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3duZXIgIT0gZmVlUmVjaXBpZW50KSB7CiAgICAgICAgICAgICAgICBieXRlczMyIGl0ZW0gPSBiYXRjaFtpICsgM107CiAgICAgICAgICAgICAgICBpZiAoaXRlbSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4udHJhbnNmZXJGcm9tKG93bmVyLCBmZWVSZWNpcGllbnQsIHVpbnQoaXRlbSkpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICBpdGVtID0gYmF0Y2hbaSArIDRdOwogICAgICAgICAgICAgICAgaWYgKGl0ZW0gIT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgICAgICAgICAgICAgIGxyYy50cmFuc2ZlckZyb20oZmVlUmVjaXBpZW50LCBvd25lciwgdWludChpdGVtKSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaXRlbSA9IGJhdGNoW2kgKyA1XTsKICAgICAgICAgICAgICAgIGlmIChpdGVtICE9IDApIHsKICAgICAgICAgICAgICAgICAgICByZXF1aXJlKAogICAgICAgICAgICAgICAgICAgICAgICBscmMudHJhbnNmZXJGcm9tKG93bmVyLCBmZWVSZWNpcGllbnQsIHVpbnQoaXRlbSkpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQovLy8gQHRpdGxlIExvb3ByaW5nIFRva2VuIEV4Y2hhbmdlIFByb3RvY29sIEltcGxlbWVudGF0aW9uIENvbnRyYWN0IHYxCi8vLyBAYXV0aG9yIERhbmllbCBXYW5nIC0gPDxhIGhyZWY9Ii9jZG4tY2dpL2wvZW1haWwtcHJvdGVjdGlvbiIgY2xhc3M9Il9fY2ZfZW1haWxfXyIgZGF0YS1jZmVtYWlsPSIxMzc3NzI3ZDdhNzY3ZjUzN2Y3YzdjNjM2MTdhN2Q3NDNkN2M2MTc0Ij5bZW1haWwmIzE2MDtwcm90ZWN0ZWRdPC9hPj4sCi8vLyBAYXV0aG9yIEtvbmdsaWFuZyBaaG9uZyAtIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iM2E1MTU1NTQ1ZDU2NTM1YjU0NWQ3YTU2NTU1NTRhNDg1MzU0NWQxNDU1NDg1ZCI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+Ci8vLwovLy8gUmVjb2duaXplZCBjb250cmlidXRpbmcgZGV2ZWxvcGVycyBmcm9tIHRoZSBjb21tdW5pdHk6Ci8vLyAgICAgaHR0cHM6Ly9naXRodWIuY29tL0JyZWNodHBkCi8vLyAgICAgaHR0cHM6Ly9naXRodWIuY29tL3JhaW55ZGlvCi8vLyAgICAgaHR0cHM6Ly9naXRodWIuY29tL0JlbmphbWluUHJpY2UKLy8vICAgICBodHRwczovL2dpdGh1Yi5jb20vam9uYXNzaGVuCmNvbnRyYWN0IExvb3ByaW5nUHJvdG9jb2xJbXBsIGlzIExvb3ByaW5nUHJvdG9jb2wgewogICAgdXNpbmcgTWF0aFVpbnQgZm9yIHVpbnQ7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gVmFyaWFibGVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBhZGRyZXNzIHB1YmxpYyAgbHJjVG9rZW5BZGRyZXNzICAgICAgICAgICAgID0gMHgwOwogICAgYWRkcmVzcyBwdWJsaWMgIHRva2VuUmVnaXN0cnlBZGRyZXNzICAgICAgICA9IDB4MDsKICAgIGFkZHJlc3MgcHVibGljICByaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcyAgICAgPSAweDA7CiAgICBhZGRyZXNzIHB1YmxpYyAgZGVsZWdhdGVBZGRyZXNzICAgICAgICAgICAgID0gMHgwOwogICAgdWludCAgICBwdWJsaWMgIG1heFJpbmdTaXplICAgICAgICAgICAgICAgICA9IDA7CiAgICB1aW50NjQgIHB1YmxpYyAgcmluZ0luZGV4ICAgICAgICAgICAgICAgICAgID0gMDsKICAgIC8vIEV4Y2hhbmdlIHJhdGUgKHJhdGUpIGlzIHRoZSBhbW91bnQgdG8gc2VsbCBvciBzb2xkIGRpdmlkZWQgYnkgdGhlIGFtb3VudAogICAgLy8gdG8gYnV5IG9yIGJvdWdodC4KICAgIC8vCiAgICAvLyBSYXRlIHJhdGlvIGlzIHRoZSByYXRpbyBiZXR3ZWVuIGV4ZWN1dGVkIHJhdGUgYW5kIGFuIG9yZGVyJ3Mgb3JpZ2luYWwKICAgIC8vIHJhdGUuCiAgICAvLwogICAgLy8gVG8gcmVxdWlyZSBhbGwgb3JkZXJzJyByYXRlIHJhdGlvcyB0byBoYXZlIGNvZWZmaWNpZW50IG9mdmFyaWF0aW9uIChDVikKICAgIC8vIHNtYWxsZXIgdGhhbiAyLjUlLCBmb3IgYW4gZXhhbXBsZSAsIHJhdGVSYXRpb0NWU1RocmVzaG9sZCBzaG91bGQgYmU6CiAgICAvLyAgICAgYCgwLjAyNSAqIFJBVEVfUkFUSU9fU0NBTEUpXjJgIG9yIDYyNTAwLgogICAgdWludCAgICBwdWJsaWMgIHJhdGVSYXRpb0NWU1RocmVzaG9sZCAgICAgICA9IDA7CiAgICB1aW50ICAgIHB1YmxpYyBjb25zdGFudCBSQVRFX1JBVElPX1NDQUxFICAgID0gMTAwMDA7CiAgICB1aW50NjQgIHB1YmxpYyBjb25zdGFudCBFTlRFUkVEX01BU0sgICAgICAgID0gMSA8PCA2MzsKICAgIC8vIFRoZSBmb2xsb3dpbmcgbWFwIGlzIHVzZWQgdG8ga2VlcCB0cmFjZSBvZiBvcmRlciBmaWxsIGFuZCBjYW5jZWxsYXRpb24KICAgIC8vIGhpc3RvcnkuCiAgICBtYXBwaW5nIChieXRlczMyID0+IHVpbnQpIHB1YmxpYyBjYW5jZWxsZWRPckZpbGxlZDsKICAgIC8vIEEgbWFwIGZyb20gYWRkcmVzcyB0byBpdHMgY3V0b2ZmIHRpbWVzdGFtcC4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludCkgcHVibGljIGN1dG9mZnM7CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gU3RydWN0cyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICBzdHJ1Y3QgUmF0ZSB7CiAgICAgICAgdWludCBhbW91bnRTOwogICAgICAgIHVpbnQgYW1vdW50QjsKICAgIH0KICAgIC8vLyBAcGFyYW0gdG9rZW5TICAgICAgIFRva2VuIHRvIHNlbGwuCiAgICAvLy8gQHBhcmFtIHRva2VuQiAgICAgICBUb2tlbiB0byBidXkuCiAgICAvLy8gQHBhcmFtIGFtb3VudFMgICAgICBNYXhpbXVtIGFtb3VudCBvZiB0b2tlblMgdG8gc2VsbC4KICAgIC8vLyBAcGFyYW0gYW1vdW50QiAgICAgIE1pbmltdW0gYW1vdW50IG9mIHRva2VuQiB0byBidXkgaWYgYWxsIGFtb3VudFMgc29sZC4KICAgIC8vLyBAcGFyYW0gdGltZXN0YW1wICAgIEluZGljYXRpbmcgd2hlbiB0aGlzIG9yZGVyIGlzIGNyZWF0ZWQvc2lnbmVkLgogICAgLy8vIEBwYXJhbSB0dGwgICAgICAgICAgSW5kaWNhdGluZyBhZnRlciBob3cgbWFueSBzZWNvbmRzIGZyb20gYHRpbWVzdGFtcGAKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoaXMgb3JkZXIgd2lsbCBleHBpcmUuCiAgICAvLy8gQHBhcmFtIHNhbHQgICAgICAgICBBIHJhbmRvbSBudW1iZXIgdG8gbWFrZSB0aGlzIG9yZGVyJ3MgaGFzaCB1bmlxdWUuCiAgICAvLy8gQHBhcmFtIGxyY0ZlZSAgICAgICBNYXggYW1vdW50IG9mIExSQyB0byBwYXkgZm9yIG1pbmVyLiBUaGUgcmVhbCBhbW91bnQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRvIHBheSBpcyBwcm9wb3J0aW9uYWwgdG8gZmlsbCBhbW91bnQuCiAgICAvLy8gQHBhcmFtIGJ1eU5vTW9yZVRoYW5BbW91bnRCIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIElmIHRydWUsIHRoaXMgb3JkZXIgZG9lcyBub3QgYWNjZXB0IGJ1eWluZyBtb3JlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGFuIGBhbW91bnRCYC4KICAgIC8vLyBAcGFyYW0gbWFyZ2luU3BsaXRQZXJjZW50YWdlIC0KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIFRoZSBwZXJjZW50YWdlIG9mIG1hcmdpbiBwYWlkIHRvIG1pbmVyLgogICAgLy8vIEBwYXJhbSB2ICAgICAgICAgICAgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByICAgICAgICAgICAgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyAgICAgICAgICAgIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICBzdHJ1Y3QgT3JkZXIgewogICAgICAgIGFkZHJlc3Mgb3duZXI7CiAgICAgICAgYWRkcmVzcyB0b2tlblM7CiAgICAgICAgYWRkcmVzcyB0b2tlbkI7CiAgICAgICAgdWludCAgICBhbW91bnRTOwogICAgICAgIHVpbnQgICAgYW1vdW50QjsKICAgICAgICB1aW50ICAgIGxyY0ZlZTsKICAgICAgICBib29sICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCOwogICAgICAgIHVpbnQ4ICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlOwogICAgfQogICAgLy8vIEBwYXJhbSBvcmRlciAgICAgICAgVGhlIG9yaWdpbmFsIG9yZGVyCiAgICAvLy8gQHBhcmFtIG9yZGVySGFzaCAgICBUaGUgb3JkZXIncyBoYXNoCiAgICAvLy8gQHBhcmFtIGZlZVNlbGVjdGlvbiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBBIG1pbmVyLXN1cHBsaWVkIHZhbHVlIGluZGljYXRpbmcgaWYgTFJDICh2YWx1ZSA9IDApCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBvciBtYXJnaW4gc3BsaXQgaXMgY2hvb3NlbiBieSB0aGUgbWluZXIgKHZhbHVlID0gMSkuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBXZSBtYXkgc3VwcG9ydCBtb3JlIGZlZSBtb2RlbCBpbiB0aGUgZnV0dXJlLgogICAgLy8vIEBwYXJhbSByYXRlICAgICAgICAgRXhjaGFuZ2UgcmF0ZSBwcm92aWRlZCBieSBtaW5lci4KICAgIC8vLyBAcGFyYW0gZmlsbEFtb3VudFMgIEFtb3VudCBvZiB0b2tlblMgdG8gc2VsbCwgY2FsY3VsYXRlZCBieSBwcm90b2NvbC4KICAgIC8vLyBAcGFyYW0gbHJjUmV3YXJkICAgIFRoZSBhbW91bnQgb2YgTFJDIHBhaWQgYnkgbWluZXIgdG8gb3JkZXIgb3duZXIgaW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGV4Y2hhbmdlIGZvciBtYXJnaW4gc3BsaXQuCiAgICAvLy8gQHBhcmFtIGxyY0ZlZSAgICAgICBUaGUgYW1vdW50IG9mIExSIHBhaWQgYnkgb3JkZXIgb3duZXIgdG8gbWluZXIuCiAgICAvLy8gQHBhcmFtIHNwbGl0UyAgICAgIFRva2VuUyBwYWlkIHRvIG1pbmVyLgogICAgLy8vIEBwYXJhbSBzcGxpdEIgICAgICBUb2tlbkIgcGFpZCB0byBtaW5lci4KICAgIHN0cnVjdCBPcmRlclN0YXRlIHsKICAgICAgICBPcmRlciAgIG9yZGVyOwogICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoOwogICAgICAgIHVpbnQ4ICAgZmVlU2VsZWN0aW9uOwogICAgICAgIFJhdGUgICAgcmF0ZTsKICAgICAgICB1aW50ICAgIGZpbGxBbW91bnRTOwogICAgICAgIHVpbnQgICAgbHJjUmV3YXJkOwogICAgICAgIHVpbnQgICAgbHJjRmVlOwogICAgICAgIHVpbnQgICAgc3BsaXRTOwogICAgICAgIHVpbnQgICAgc3BsaXRCOwogICAgfQogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgLy8vIENvbnN0cnVjdG9yICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vLwogICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgZnVuY3Rpb24gTG9vcHJpbmdQcm90b2NvbEltcGwoCiAgICAgICAgYWRkcmVzcyBfbHJjVG9rZW5BZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3Rva2VuUmVnaXN0cnlBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX3JpbmdoYXNoUmVnaXN0cnlBZGRyZXNzLAogICAgICAgIGFkZHJlc3MgX2RlbGVnYXRlQWRkcmVzcywKICAgICAgICB1aW50ICAgIF9tYXhSaW5nU2l6ZSwKICAgICAgICB1aW50ICAgIF9yYXRlUmF0aW9DVlNUaHJlc2hvbGQKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgcmVxdWlyZSgweDAgIT0gX2xyY1Rva2VuQWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZSgweDAgIT0gX3Rva2VuUmVnaXN0cnlBZGRyZXNzKTsKICAgICAgICByZXF1aXJlKDB4MCAhPSBfcmluZ2hhc2hSZWdpc3RyeUFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoMHgwICE9IF9kZWxlZ2F0ZUFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoX21heFJpbmdTaXplID4gMSk7CiAgICAgICAgcmVxdWlyZShfcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkID4gMCk7CiAgICAgICAgbHJjVG9rZW5BZGRyZXNzID0gX2xyY1Rva2VuQWRkcmVzczsKICAgICAgICB0b2tlblJlZ2lzdHJ5QWRkcmVzcyA9IF90b2tlblJlZ2lzdHJ5QWRkcmVzczsKICAgICAgICByaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcyA9IF9yaW5naGFzaFJlZ2lzdHJ5QWRkcmVzczsKICAgICAgICBkZWxlZ2F0ZUFkZHJlc3MgPSBfZGVsZWdhdGVBZGRyZXNzOwogICAgICAgIG1heFJpbmdTaXplID0gX21heFJpbmdTaXplOwogICAgICAgIHJhdGVSYXRpb0NWU1RocmVzaG9sZCA9IF9yYXRlUmF0aW9DVlNUaHJlc2hvbGQ7CiAgICB9CiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gUHVibGljIEZ1bmN0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8vCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAvLy8gQGRldiBEaXNhYmxlIGRlZmF1bHQgZnVuY3Rpb24uCiAgICBmdW5jdGlvbiAoKQogICAgICAgIHBheWFibGUKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXZlcnQoKTsKICAgIH0KICAgIC8vLyBAZGV2IFN1Ym1pdCBhIG9yZGVyLXJpbmcgZm9yIHZhbGlkYXRpb24gYW5kIHNldHRsZW1lbnQuCiAgICAvLy8gQHBhcmFtIGFkZHJlc3NMaXN0ICBMaXN0IG9mIGVhY2ggb3JkZXIncyB0b2tlblMuIE5vdGUgdGhhdCBuZXh0IG9yZGVyJ3MKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGB0b2tlblNgIGVxdWFscyB0aGlzIG9yZGVyJ3MgYHRva2VuQmAuCiAgICAvLy8gQHBhcmFtIHVpbnRBcmdzTGlzdCBMaXN0IG9mIHVpbnQtdHlwZSBhcmd1bWVudHMgaW4gdGhpcyBvcmRlcjoKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIGFtb3VudFMsIGFtb3VudEIsIHRpbWVzdGFtcCwgdHRsLCBzYWx0LCBscmNGZWUsCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICByYXRlQW1vdW50Uy4KICAgIC8vLyBAcGFyYW0gdWludDhBcmdzTGlzdCAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMaXN0IG9mIHVuaXQ4LXR5cGUgYXJndW1lbnRzLCBpbiB0aGlzIG9yZGVyOgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgbWFyZ2luU3BsaXRQZXJjZW50YWdlTGlzdCxmZWVTZWxlY3Rpb25MaXN0LgogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QgLQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgVGhpcyBpbmRpY2F0ZXMgd2hlbiBhIG9yZGVyIHNob3VsZCBiZSBjb25zaWRlcmVkCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBhcyAnY29tcGxldGVseSBmaWxsZWQnLgogICAgLy8vIEBwYXJhbSB2TGlzdCAgICAgICAgTGlzdCBvZiB2IGZvciBlYWNoIG9yZGVyLiBUaGlzIGxpc3QgaXMgMS1sYXJnZXIgdGhhbgogICAgLy8vICAgICAgICAgICAgICAgICAgICAgdGhlIHByZXZpb3VzIGxpc3RzLCB3aXRoIHRoZSBsYXN0IGVsZW1lbnQgYmVpbmcgdGhlCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB2IHZhbHVlIG9mIHRoZSByaW5nIHNpZ25hdHVyZS4KICAgIC8vLyBAcGFyYW0gckxpc3QgICAgICAgIExpc3Qgb2YgciBmb3IgZWFjaCBvcmRlci4gVGhpcyBsaXN0IGlzIDEtbGFyZ2VyIHRoYW4KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoZSBwcmV2aW91cyBsaXN0cywgd2l0aCB0aGUgbGFzdCBlbGVtZW50IGJlaW5nIHRoZQogICAgLy8vICAgICAgICAgICAgICAgICAgICAgciB2YWx1ZSBvZiB0aGUgcmluZyBzaWduYXR1cmUuCiAgICAvLy8gQHBhcmFtIHNMaXN0ICAgICAgICBMaXN0IG9mIHMgZm9yIGVhY2ggb3JkZXIuIFRoaXMgbGlzdCBpcyAxLWxhcmdlciB0aGFuCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICB0aGUgcHJldmlvdXMgbGlzdHMsIHdpdGggdGhlIGxhc3QgZWxlbWVudCBiZWluZyB0aGUKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHMgdmFsdWUgb2YgdGhlIHJpbmcgc2lnbmF0dXJlLgogICAgLy8vIEBwYXJhbSByaW5nbWluZXIgICAgVGhlIGFkZHJlc3MgdGhhdCBzaWduZWQgdGhpcyB0eC4KICAgIC8vLyBAcGFyYW0gZmVlUmVjaXBpZW50IFRoZSBSZWNpcGllbnQgYWRkcmVzcyBmb3IgZmVlIGNvbGxlY3Rpb24uIElmIHRoaXMgaXMKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICcweDAnLCBhbGwgZmVlcyB3aWxsIGJlIHBhaWQgdG8gdGhlIGFkZHJlc3Mgd2hvIGhhZAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgc2lnbmVkIHRoaXMgdHJhbnNhY3Rpb24sIG5vdCBgbXNnLnNlbmRlcmAuIE5vdGVkIGlmCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICBMUkMgbmVlZCB0byBiZSBwYWlkIGJhY2sgdG8gb3JkZXIgb3duZXIgYXMgdGhlIHJlc3VsdAogICAgLy8vICAgICAgICAgICAgICAgICAgICAgb2YgZmVlIHNlbGVjdGlvbiBtb2RlbCwgTFJDIHdpbGwgYWxzbyBiZSBzZW50IGZyb20KICAgIC8vLyAgICAgICAgICAgICAgICAgICAgIHRoaXMgYWRkcmVzcy4KICAgIGZ1bmN0aW9uIHN1Ym1pdFJpbmcoCiAgICAgICAgYWRkcmVzc1syXVtdICBhZGRyZXNzTGlzdCwKICAgICAgICB1aW50WzddW10gICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICB1aW50OFsyXVtdICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgYm9vbFtdICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgdWludDhbXSAgICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgc0xpc3QsCiAgICAgICAgYWRkcmVzcyAgICAgICByaW5nbWluZXIsCiAgICAgICAgYWRkcmVzcyAgICAgICBmZWVSZWNpcGllbnQKICAgICAgICApCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGhpZ2hlc3QgYml0IG9mIHJpbmdJbmRleCBpcyAnMScuCiAgICAgICAgcmVxdWlyZShyaW5nSW5kZXggJiBFTlRFUkVEX01BU0sgIT0gRU5URVJFRF9NQVNLKTsgLy8gImF0dGVtcHRlZCB0byByZS1lbnQgc3VibWl0UmluZyBmdW5jdGlvbiIpOwogICAgICAgIC8vIFNldCB0aGUgaGlnaGVzdCBiaXQgb2YgcmluZ0luZGV4IHRvICcxJy4KICAgICAgICByaW5nSW5kZXggfD0gRU5URVJFRF9NQVNLOwogICAgICAgIC8vQ2hlY2sgcmluZyBzaXplCiAgICAgICAgdWludCByaW5nU2l6ZSA9IGFkZHJlc3NMaXN0Lmxlbmd0aDsKICAgICAgICByZXF1aXJlKHJpbmdTaXplID4gMSAmJiByaW5nU2l6ZSA8PSBtYXhSaW5nU2l6ZSk7IC8vICJpbnZhbGlkIHJpbmcgc2l6ZSIpOwogICAgICAgIHZlcmlmeUlucHV0RGF0YUludGVncml0eSgKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIGFkZHJlc3NMaXN0LAogICAgICAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CiAgICAgICAgdmVyaWZ5VG9rZW5zUmVnaXN0ZXJlZChyaW5nU2l6ZSwgYWRkcmVzc0xpc3QpOwogICAgICAgIHZhciAocmluZ2hhc2gsIHJpbmdoYXNoQXR0cmlidXRlcykgPSBSaW5naGFzaFJlZ2lzdHJ5KAogICAgICAgICAgICByaW5naGFzaFJlZ2lzdHJ5QWRkcmVzcwogICAgICAgICkuY29tcHV0ZUFuZEdldFJpbmdoYXNoSW5mbygKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIHJpbmdtaW5lciwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CiAgICAgICAgLy9DaGVjayBpZiB3ZSBjYW4gc3VibWl0IHRoaXMgcmluZ2hhc2guCiAgICAgICAgcmVxdWlyZShyaW5naGFzaEF0dHJpYnV0ZXNbMF0pOyAvLyAiUmluZyBjbGFpbWVkIGJ5IG90aGVycyIpOwogICAgICAgIHZlcmlmeVNpZ25hdHVyZSgKICAgICAgICAgICAgcmluZ21pbmVyLAogICAgICAgICAgICByaW5naGFzaCwKICAgICAgICAgICAgdkxpc3RbcmluZ1NpemVdLAogICAgICAgICAgICByTGlzdFtyaW5nU2l6ZV0sCiAgICAgICAgICAgIHNMaXN0W3JpbmdTaXplXQogICAgICAgICk7CiAgICAgICAgLy9Bc3NlbWJsZSBpbnB1dCBkYXRhIGludG8gc3RydWN0cyBzbyB3ZSBjYW4gcGFzcyB0aGVtIHRvIG90aGVyIGZ1bmN0aW9ucy4KICAgICAgICB2YXIgb3JkZXJzID0gYXNzZW1ibGVPcmRlcnMoCiAgICAgICAgICAgIGFkZHJlc3NMaXN0LAogICAgICAgICAgICB1aW50QXJnc0xpc3QsCiAgICAgICAgICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgICAgIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCwKICAgICAgICAgICAgdkxpc3QsCiAgICAgICAgICAgIHJMaXN0LAogICAgICAgICAgICBzTGlzdAogICAgICAgICk7CiAgICAgICAgaWYgKGZlZVJlY2lwaWVudCA9PSAweDApIHsKICAgICAgICAgICAgZmVlUmVjaXBpZW50ID0gcmluZ21pbmVyOwogICAgICAgIH0KICAgICAgICBoYW5kbGVSaW5nKAogICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICAgICAgcmluZ2hhc2gsCiAgICAgICAgICAgIG9yZGVycywKICAgICAgICAgICAgcmluZ21pbmVyLAogICAgICAgICAgICBmZWVSZWNpcGllbnQsCiAgICAgICAgICAgIHJpbmdoYXNoQXR0cmlidXRlc1sxXQogICAgICAgICk7CiAgICAgICAgcmluZ0luZGV4ID0gKHJpbmdJbmRleCBeIEVOVEVSRURfTUFTSykgKyAxOwogICAgfQogICAgLy8vIEBkZXYgQ2FuY2VsIGEgb3JkZXIuIGNhbmNlbCBhbW91bnQoYW1vdW50UyBvciBhbW91bnRCKSBjYW4gYmUgc3BlY2lmaWVkCiAgICAvLy8gICAgICBpbiBvcmRlclZhbHVlcy4KICAgIC8vLyBAcGFyYW0gYWRkcmVzc2VzICAgICAgICAgIG93bmVyLCB0b2tlblMsIHRva2VuQgogICAgLy8vIEBwYXJhbSBvcmRlclZhbHVlcyAgICAgICAgYW1vdW50UywgYW1vdW50QiwgdGltZXN0YW1wLCB0dGwsIHNhbHQsIGxyY0ZlZSwKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEFtb3VudFMsIGFuZCBjYW5jZWxBbW91bnRCLgogICAgLy8vIEBwYXJhbSBidXlOb01vcmVUaGFuQW1vdW50QiAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIGluZGljYXRlcyB3aGVuIGEgb3JkZXIgc2hvdWxkIGJlIGNvbnNpZGVyZWQKICAgIC8vLyAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzICdjb21wbGV0ZWx5IGZpbGxlZCcuCiAgICAvLy8gQHBhcmFtIG1hcmdpblNwbGl0UGVyY2VudGFnZSAtCiAgICAvLy8gICAgICAgICAgICAgICAgICAgICAgICAgICBQZXJjZW50YWdlIG9mIG1hcmdpbiBzcGxpdCB0byBzaGFyZSB3aXRoIG1pbmVyLgogICAgLy8vIEBwYXJhbSB2ICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlciB2LgogICAgLy8vIEBwYXJhbSByICAgICAgICAgICAgICAgICAgT3JkZXIgRUNEU0Egc2lnbmF0dXJlIHBhcmFtZXRlcnMgci4KICAgIC8vLyBAcGFyYW0gcyAgICAgICAgICAgICAgICAgIE9yZGVyIEVDRFNBIHNpZ25hdHVyZSBwYXJhbWV0ZXJzIHMuCiAgICBmdW5jdGlvbiBjYW5jZWxPcmRlcigKICAgICAgICBhZGRyZXNzWzNdIGFkZHJlc3NlcywKICAgICAgICB1aW50WzddICAgIG9yZGVyVmFsdWVzLAogICAgICAgIGJvb2wgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgdWludDggICAgICBtYXJnaW5TcGxpdFBlcmNlbnRhZ2UsCiAgICAgICAgdWludDggICAgICB2LAogICAgICAgIGJ5dGVzMzIgICAgciwKICAgICAgICBieXRlczMyICAgIHMKICAgICAgICApCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICB1aW50IGNhbmNlbEFtb3VudCA9IG9yZGVyVmFsdWVzWzZdOwogICAgICAgIHJlcXVpcmUoY2FuY2VsQW1vdW50ID4gMCk7IC8vICJhbW91bnQgdG8gY2FuY2VsIGlzIHplcm8iKTsKICAgICAgICB2YXIgb3JkZXIgPSBPcmRlcigKICAgICAgICAgICAgYWRkcmVzc2VzWzBdLAogICAgICAgICAgICBhZGRyZXNzZXNbMV0sCiAgICAgICAgICAgIGFkZHJlc3Nlc1syXSwKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbMF0sCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzFdLAogICAgICAgICAgICBvcmRlclZhbHVlc1s1XSwKICAgICAgICAgICAgYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgICAgIG1hcmdpblNwbGl0UGVyY2VudGFnZQogICAgICAgICk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG9yZGVyLm93bmVyKTsgLy8gImNhbmNlbE9yZGVyIG5vdCBzdWJtaXR0ZWQgYnkgb3JkZXIgb3duZXIiKTsKICAgICAgICBieXRlczMyIG9yZGVySGFzaCA9IGNhbGN1bGF0ZU9yZGVySGFzaCgKICAgICAgICAgICAgb3JkZXIsCiAgICAgICAgICAgIG9yZGVyVmFsdWVzWzJdLCAvLyB0aW1lc3RhbXAKICAgICAgICAgICAgb3JkZXJWYWx1ZXNbM10sIC8vIHR0bAogICAgICAgICAgICBvcmRlclZhbHVlc1s0XSAgLy8gc2FsdAogICAgICAgICk7CiAgICAgICAgdmVyaWZ5U2lnbmF0dXJlKAogICAgICAgICAgICBvcmRlci5vd25lciwKICAgICAgICAgICAgb3JkZXJIYXNoLAogICAgICAgICAgICB2LAogICAgICAgICAgICByLAogICAgICAgICAgICBzCiAgICAgICAgKTsKICAgICAgICBjYW5jZWxsZWRPckZpbGxlZFtvcmRlckhhc2hdID0gY2FuY2VsbGVkT3JGaWxsZWRbb3JkZXJIYXNoXS5hZGQoY2FuY2VsQW1vdW50KTsKICAgICAgICBPcmRlckNhbmNlbGxlZChvcmRlckhhc2gsIGNhbmNlbEFtb3VudCk7CiAgICB9CiAgICAvLy8gQGRldiAgIFNldCBhIGN1dG9mZiB0aW1lc3RhbXAgdG8gaW52YWxpZGF0ZSBhbGwgb3JkZXJzIHdob3NlIHRpbWVzdGFtcAogICAgLy8vICAgICAgICBpcyBzbWFsbGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIG5ldyB2YWx1ZSBvZiB0aGUgYWRkcmVzcydzIGN1dG9mZgogICAgLy8vICAgICAgICB0aW1lc3RhbXAuCiAgICAvLy8gQHBhcmFtIGN1dG9mZiBUaGUgY3V0b2ZmIHRpbWVzdGFtcCwgd2lsbCBkZWZhdWx0IHRvIGBibG9jay50aW1lc3RhbXBgCiAgICAvLy8gICAgICAgIGlmIGl0IGlzIDAuCiAgICBmdW5jdGlvbiBzZXRDdXRvZmYodWludCBjdXRvZmYpCiAgICAgICAgZXh0ZXJuYWwKICAgIHsKICAgICAgICB1aW50IHQgPSAoY3V0b2ZmID09IDAgfHwgY3V0b2ZmID49IGJsb2NrLnRpbWVzdGFtcCkgPyBibG9jay50aW1lc3RhbXAgOiBjdXRvZmY7CiAgICAgICAgcmVxdWlyZShjdXRvZmZzW21zZy5zZW5kZXJdIDwgdCk7IC8vICJhdHRlbXB0ZWQgdG8gc2V0IGN1dG9mZiB0byBhIHNtYWxsZXIgdmFsdWUiCiAgICAgICAgY3V0b2Zmc1ttc2cuc2VuZGVyXSA9IHQ7CiAgICAgICAgQ3V0b2ZmVGltZXN0YW1wQ2hhbmdlZChtc2cuc2VuZGVyLCB0KTsKICAgIH0KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBJbnRlcm5hbCAmIFByaXZhdGUgRnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLy8KICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgIC8vLyBAZGV2IFZhbGlkYXRlIGEgcmluZy4KICAgIGZ1bmN0aW9uIHZlcmlmeVJpbmdIYXNOb1N1YlJpbmcoCiAgICAgICAgdWludCAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICBPcmRlclN0YXRlW10gIG9yZGVycwogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgcHVyZQogICAgewogICAgICAgIC8vIENoZWNrIHRoZSByaW5nIGhhcyBubyBzdWItcmluZy4KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZSAtIDE7IGkrKykgewogICAgICAgICAgICBhZGRyZXNzIHRva2VuUyA9IG9yZGVyc1tpXS5vcmRlci50b2tlblM7CiAgICAgICAgICAgIGZvciAodWludCBqID0gaSArIDE7IGogPCByaW5nU2l6ZTsgaisrKSB7CiAgICAgICAgICAgICAgICByZXF1aXJlKHRva2VuUyAhPSBvcmRlcnNbal0ub3JkZXIudG9rZW5TKTsgLy8gImZvdW5kIHN1Yi1yaW5nIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB2ZXJpZnlUb2tlbnNSZWdpc3RlcmVkKAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgYWRkcmVzc1syXVtdICBhZGRyZXNzTGlzdAogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgewogICAgICAgIC8vIEV4dHJhY3QgdGhlIHRva2VuIGFkZHJlc3NlcwogICAgICAgIHZhciB0b2tlbnMgPSBuZXcgYWRkcmVzc1tdKHJpbmdTaXplKTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHRva2Vuc1tpXSA9IGFkZHJlc3NMaXN0W2ldWzFdOwogICAgICAgIH0KICAgICAgICAvLyBUZXN0IGFsbCB0b2tlbiBhZGRyZXNzZXMgYXQgb25jZQogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIFRva2VuUmVnaXN0cnkodG9rZW5SZWdpc3RyeUFkZHJlc3MpLmFyZUFsbFRva2Vuc1JlZ2lzdGVyZWQodG9rZW5zKQogICAgICAgICk7IC8vICJ0b2tlbiBub3QgcmVnaXN0ZXJlZCIpOwogICAgfQogICAgZnVuY3Rpb24gaGFuZGxlUmluZygKICAgICAgICB1aW50ICAgICAgICAgIHJpbmdTaXplLAogICAgICAgIGJ5dGVzMzIgICAgICAgcmluZ2hhc2gsCiAgICAgICAgT3JkZXJTdGF0ZVtdICBvcmRlcnMsCiAgICAgICAgYWRkcmVzcyAgICAgICBtaW5lciwKICAgICAgICBhZGRyZXNzICAgICAgIGZlZVJlY2lwaWVudCwKICAgICAgICBib29sICAgICAgICAgIGlzUmluZ2hhc2hSZXNlcnZlZAogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICB7CiAgICAgICAgdWludDY0IF9yaW5nSW5kZXggPSByaW5nSW5kZXggXiBFTlRFUkVEX01BU0s7CiAgICAgICAgYWRkcmVzcyBfbHJjVG9rZW5BZGRyZXNzID0gbHJjVG9rZW5BZGRyZXNzOwogICAgICAgIHZhciBkZWxlZ2F0ZSA9IFRva2VuVHJhbnNmZXJEZWxlZ2F0ZShkZWxlZ2F0ZUFkZHJlc3MpOwogICAgICAgICAgICAgICAgCiAgICAgICAgLy8gRG8gdGhlIGhhcmQgd29yay4KICAgICAgICB2ZXJpZnlSaW5nSGFzTm9TdWJSaW5nKHJpbmdTaXplLCBvcmRlcnMpOwogICAgICAgIC8vIEV4Y2hhbmdlIHJhdGVzIGNhbGN1bGF0aW9uIGFyZSBwZXJmb3JtZWQgYnkgcmluZy1taW5lcnMgYXMgc29saWRpdHkKICAgICAgICAvLyBjYW5ub3QgZ2V0IHBvd2VyLW9mLTEvbiBvcGVyYXRpb24sIHRoZXJlZm9yZSB3ZSBoYXZlIHRvIHZlcmlmeQogICAgICAgIC8vIHRoZXNlIHJhdGVzIGFyZSBjb3JyZWN0LgogICAgICAgIHZlcmlmeU1pbmVyU3VwcGxpZWRGaWxsUmF0ZXMocmluZ1NpemUsIG9yZGVycyk7CiAgICAgICAgLy8gU2NhbGUgZG93biBlYWNoIG9yZGVyIGluZGVwZW5kZW50bHkgYnkgc3Vic3RyYWN0aW5nIGFtb3VudC1maWxsZWQgYW5kCiAgICAgICAgLy8gYW1vdW50LWNhbmNlbGxlZC4gT3JkZXIgb3duZXIncyBjdXJyZW50IGJhbGFuY2UgYW5kIGFsbG93YW5jZSBhcmUKICAgICAgICAvLyBub3QgdGFrZW4gaW50byBjb25zaWRlcmF0aW9uIGluIHRoZXNlIG9wZXJhdGlvbnMuCiAgICAgICAgc2NhbGVSaW5nQmFzZWRPbkhpc3RvcmljYWxSZWNvcmRzKGRlbGVnYXRlLCByaW5nU2l6ZSwgb3JkZXJzKTsKICAgICAgICAvLyBCYXNlZCBvbiB0aGUgYWxyZWFkeSB2ZXJpZmllZCBleGNoYW5nZSByYXRlIHByb3ZpZGVkIGJ5IHJpbmctbWluZXJzLAogICAgICAgIC8vIHdlIGNhbiBmdXJ0aHVyIHNjYWxlIGRvd24gb3JkZXJzIGJhc2VkIG9uIHRva2VuIGJhbGFuY2UgYW5kIGFsbG93YW5jZSwKICAgICAgICAvLyB0aGVuIGZpbmQgdGhlIHNtYWxsZXN0IG9yZGVyIG9mIHRoZSByaW5nLCB0aGVuIGNhbGN1bGF0ZSBlYWNoIG9yZGVyJ3MKICAgICAgICAvLyBgZmlsbEFtb3VudFNgLgogICAgICAgIGNhbGN1bGF0ZVJpbmdGaWxsQW1vdW50KHJpbmdTaXplLCBvcmRlcnMpOwogICAgICAgIC8vIENhbGN1bGF0ZSBlYWNoIG9yZGVyJ3MgYGxyY0ZlZWAgYW5kIGBscmNSZXdyYXJkYCBhbmQgc3BsaWN0IGhvdyBtdWNoCiAgICAgICAgLy8gb2YgYGZpbGxBbW91bnRTYCBzaGFsbCBiZSBwYWlkIHRvIG1hdGNoaW5nIG9yZGVyIG9yIG1pbmVyIGFzIG1hcmdpbgogICAgICAgIC8vIHNwbGl0LgogICAgICAgIGNhbGN1bGF0ZVJpbmdGZWVzKAogICAgICAgICAgICBkZWxlZ2F0ZSwKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIG9yZGVycywKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICBfbHJjVG9rZW5BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICAvLy8gTWFrZSB0cmFuc2ZlcnMuCiAgICAgICAgdmFyIChvcmRlckhhc2hMaXN0LCBhbW91bnRzTGlzdCkgPSBzZXR0bGVSaW5nKAogICAgICAgICAgICBkZWxlZ2F0ZSwKICAgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgICAgIG9yZGVycywKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICBfbHJjVG9rZW5BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBSaW5nTWluZWQoCiAgICAgICAgICAgIF9yaW5nSW5kZXgsCiAgICAgICAgICAgIHJpbmdoYXNoLAogICAgICAgICAgICBtaW5lciwKICAgICAgICAgICAgZmVlUmVjaXBpZW50LAogICAgICAgICAgICBpc1JpbmdoYXNoUmVzZXJ2ZWQsCiAgICAgICAgICAgIG9yZGVySGFzaExpc3QsCiAgICAgICAgICAgIGFtb3VudHNMaXN0CiAgICAgICAgKTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldHRsZVJpbmcoCiAgICAgICAgVG9rZW5UcmFuc2ZlckRlbGVnYXRlIGRlbGVnYXRlLAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgT3JkZXJTdGF0ZVtdICBvcmRlcnMsCiAgICAgICAgYWRkcmVzcyAgICAgICBmZWVSZWNpcGllbnQsCiAgICAgICAgYWRkcmVzcyAgICAgICBfbHJjVG9rZW5BZGRyZXNzCiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICByZXR1cm5zKAogICAgICAgIGJ5dGVzMzJbXSBtZW1vcnkgb3JkZXJIYXNoTGlzdCwKICAgICAgICB1aW50WzRdW10gbWVtb3J5IGFtb3VudHNMaXN0KQogICAgewogICAgICAgIGJ5dGVzMzJbXSBtZW1vcnkgYmF0Y2ggPSBuZXcgYnl0ZXMzMltdKHJpbmdTaXplICogNik7IC8vIHJpbmdTaXplICogKG93bmVyICsgdG9rZW5TICsgNCBhbW91bnRzKQogICAgICAgIG9yZGVySGFzaExpc3QgPSBuZXcgYnl0ZXMzMltdKHJpbmdTaXplKTsKICAgICAgICBhbW91bnRzTGlzdCA9IG5ldyB1aW50WzRdW10ocmluZ1NpemUpOwogICAgICAgIHVpbnQgcCA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBvcmRlcnNbaV07CiAgICAgICAgICAgIHZhciBvcmRlciA9IHN0YXRlLm9yZGVyOwogICAgICAgICAgICB1aW50IHByZXZTcGxpdEIgPSBvcmRlcnNbKGkgKyByaW5nU2l6ZSAtIDEpICUgcmluZ1NpemVdLnNwbGl0QjsKICAgICAgICAgICAgdWludCBuZXh0RmlsbEFtb3VudFMgPSBvcmRlcnNbKGkgKyAxKSAlIHJpbmdTaXplXS5maWxsQW1vdW50UzsKICAgICAgICAgICAgLy8gU3RvcmUgb3duZXIgYW5kIHRva2VuUyBvZiBldmVyeSBvcmRlcgogICAgICAgICAgICBiYXRjaFtwXSA9IGJ5dGVzMzIob3JkZXIub3duZXIpOwogICAgICAgICAgICBiYXRjaFtwKzFdID0gYnl0ZXMzMihvcmRlci50b2tlblMpOwogICAgICAgICAgICAvLyBTdG9yZSBhbGwgYW1vdW50cwogICAgICAgICAgICBiYXRjaFtwKzJdID0gYnl0ZXMzMihzdGF0ZS5maWxsQW1vdW50UyAtIHByZXZTcGxpdEIpOwogICAgICAgICAgICBiYXRjaFtwKzNdID0gYnl0ZXMzMihwcmV2U3BsaXRCICsgc3RhdGUuc3BsaXRTKTsKICAgICAgICAgICAgYmF0Y2hbcCs0XSA9IGJ5dGVzMzIoc3RhdGUubHJjUmV3YXJkKTsKICAgICAgICAgICAgYmF0Y2hbcCs1XSA9IGJ5dGVzMzIoc3RhdGUubHJjRmVlKTsKICAgICAgICAgICAgcCArPSA2OwogICAgICAgICAgICAvLyBVcGRhdGUgZmlsbCByZWNvcmRzCiAgICAgICAgICAgIGlmIChvcmRlci5idXlOb01vcmVUaGFuQW1vdW50QikgewogICAgICAgICAgICAgICAgY2FuY2VsbGVkT3JGaWxsZWRbc3RhdGUub3JkZXJIYXNoXSArPSBuZXh0RmlsbEFtb3VudFM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjYW5jZWxsZWRPckZpbGxlZFtzdGF0ZS5vcmRlckhhc2hdICs9IHN0YXRlLmZpbGxBbW91bnRTOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9yZGVySGFzaExpc3RbaV0gPSBzdGF0ZS5vcmRlckhhc2g7CiAgICAgICAgICAgIGFtb3VudHNMaXN0W2ldWzBdID0gc3RhdGUuZmlsbEFtb3VudFMgKyBzdGF0ZS5zcGxpdFM7CiAgICAgICAgICAgIGFtb3VudHNMaXN0W2ldWzFdID0gbmV4dEZpbGxBbW91bnRTIC0gc3RhdGUuc3BsaXRCOwogICAgICAgICAgICBhbW91bnRzTGlzdFtpXVsyXSA9IHN0YXRlLmxyY1Jld2FyZDsKICAgICAgICAgICAgYW1vdW50c0xpc3RbaV1bM10gPSBzdGF0ZS5scmNGZWU7CiAgICAgICAgfQogICAgICAgIC8vIERvIGFsbCB0cmFuc2FjdGlvbnMKICAgICAgICBkZWxlZ2F0ZS5iYXRjaFRyYW5zZmVyVG9rZW4oX2xyY1Rva2VuQWRkcmVzcywgZmVlUmVjaXBpZW50LCBiYXRjaCk7CiAgICB9CiAgICAvLy8gQGRldiBWZXJpZnkgbWluZXIgaGFzIGNhbGN1bHRlIHRoZSByYXRlcyBjb3JyZWN0bHkuCiAgICBmdW5jdGlvbiB2ZXJpZnlNaW5lclN1cHBsaWVkRmlsbFJhdGVzKAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgT3JkZXJTdGF0ZVtdICBvcmRlcnMKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgIHsKICAgICAgICB2YXIgcmF0ZVJhdGlvcyA9IG5ldyB1aW50W10ocmluZ1NpemUpOwogICAgICAgIHVpbnQgX3JhdGVSYXRpb1NjYWxlID0gUkFURV9SQVRJT19TQ0FMRTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQgczFiMCA9IG9yZGVyc1tpXS5yYXRlLmFtb3VudFMubXVsKG9yZGVyc1tpXS5vcmRlci5hbW91bnRCKTsKICAgICAgICAgICAgdWludCBzMGIxID0gb3JkZXJzW2ldLm9yZGVyLmFtb3VudFMubXVsKG9yZGVyc1tpXS5yYXRlLmFtb3VudEIpOwogICAgICAgICAgICByZXF1aXJlKHMxYjAgPD0gczBiMSk7IC8vICJtaW5lciBzdXBwbGllZCBleGNoYW5nZSByYXRlIHByb3ZpZGVzIGludmFsaWQgZGlzY291bnQiKTsKICAgICAgICAgICAgcmF0ZVJhdGlvc1tpXSA9IF9yYXRlUmF0aW9TY2FsZS5tdWwoczFiMCkgLyBzMGIxOwogICAgICAgIH0KICAgICAgICB1aW50IGN2cyA9IE1hdGhVaW50LmN2c3F1YXJlKHJhdGVSYXRpb3MsIF9yYXRlUmF0aW9TY2FsZSk7CiAgICAgICAgcmVxdWlyZShjdnMgPD0gcmF0ZVJhdGlvQ1ZTVGhyZXNob2xkKTsgLy8gIm1pbmVyIHN1cHBsaWVkIGV4Y2hhbmdlIHJhdGUgaXMgbm90IGV2ZW5seSBkaXNjb3VudGVkIik7CiAgICB9CiAgICAvLy8gQGRldiBDYWxjdWxhdGUgZWFjaCBvcmRlcidzIGZlZSBvciBMUkMgcmV3YXJkLgogICAgZnVuY3Rpb24gY2FsY3VsYXRlUmluZ0ZlZXMoCiAgICAgICAgVG9rZW5UcmFuc2ZlckRlbGVnYXRlIGRlbGVnYXRlLAogICAgICAgIHVpbnQgICAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICBPcmRlclN0YXRlW10gICAgb3JkZXJzLAogICAgICAgIGFkZHJlc3MgICAgICAgICBmZWVSZWNpcGllbnQsCiAgICAgICAgYWRkcmVzcyAgICAgICAgIF9scmNUb2tlbkFkZHJlc3MKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgIHsKICAgICAgICBib29sIGNoZWNrZWRNaW5lckxyY1NwZW5kYWJsZSA9IGZhbHNlOwogICAgICAgIHVpbnQgbWluZXJMcmNTcGVuZGFibGUgPSAwOwogICAgICAgIHVpbnQ4IF9tYXJnaW5TcGxpdFBlcmNlbnRhZ2VCYXNlID0gTUFSR0lOX1NQTElUX1BFUkNFTlRBR0VfQkFTRTsKICAgICAgICB1aW50IG5leHRGaWxsQW1vdW50UzsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IG9yZGVyc1tpXTsKICAgICAgICAgICAgdWludCBscmNSZWNlaWFibGUgPSAwOwogICAgICAgICAgICBpZiAoc3RhdGUubHJjRmVlID09IDApIHsKICAgICAgICAgICAgICAgIC8vIFdoZW4gYW4gb3JkZXIncyBMUkMgZmVlIGlzIDAgb3Igc21hbGxlciB0aGFuIHRoZSBzcGVjaWZpZWQgZmVlLAogICAgICAgICAgICAgICAgLy8gd2UgaGVscCBtaW5lciBhdXRvbWF0aWNhbGx5IHNlbGVjdCBtYXJnaW4tc3BsaXQuCiAgICAgICAgICAgICAgICBzdGF0ZS5mZWVTZWxlY3Rpb24gPSBGRUVfU0VMRUNUX01BUkdJTl9TUExJVDsKICAgICAgICAgICAgICAgIHN0YXRlLm9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZSA9IF9tYXJnaW5TcGxpdFBlcmNlbnRhZ2VCYXNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdWludCBscmNTcGVuZGFibGUgPSBnZXRTcGVuZGFibGUoCiAgICAgICAgICAgICAgICAgICAgZGVsZWdhdGUsCiAgICAgICAgICAgICAgICAgICAgX2xyY1Rva2VuQWRkcmVzcywKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5vd25lcgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBvcmRlciBpcyBzZWxsaW5nIExSQywgd2UgbmVlZCB0byBjYWxjdWxhdGUgaG93IG11Y2ggTFJDCiAgICAgICAgICAgICAgICAvLyBpcyBsZWZ0IHRoYXQgY2FuIGJlIHVzZWQgYXMgZmVlLgogICAgICAgICAgICAgICAgaWYgKHN0YXRlLm9yZGVyLnRva2VuUyA9PSBfbHJjVG9rZW5BZGRyZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgbHJjU3BlbmRhYmxlIC09IHN0YXRlLmZpbGxBbW91bnRTOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gSWYgdGhlIG9yZGVyIGlzIGJ1eWlnbiBMUkMsIGl0IHdpbGwgaGFzIG1vcmUgdG8gcGF5IGFzIGZlZS4KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5vcmRlci50b2tlbkIgPT0gX2xyY1Rva2VuQWRkcmVzcykgewogICAgICAgICAgICAgICAgICAgIG5leHRGaWxsQW1vdW50UyA9IG9yZGVyc1soaSArIDEpICUgcmluZ1NpemVdLmZpbGxBbW91bnRTOwogICAgICAgICAgICAgICAgICAgIGxyY1JlY2VpYWJsZSA9IG5leHRGaWxsQW1vdW50UzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHVpbnQgbHJjVG90YWwgPSBscmNTcGVuZGFibGUgKyBscmNSZWNlaWFibGU7CiAgICAgICAgICAgICAgICAvLyBJZiBvcmRlciBkb2Vzbid0IGhhdmUgZW5vdWdoIExSQywgc2V0IG1hcmdpbiBzcGxpdCB0byAxMDAlLgogICAgICAgICAgICAgICAgaWYgKGxyY1RvdGFsIDwgc3RhdGUubHJjRmVlKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gbHJjVG90YWw7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIubWFyZ2luU3BsaXRQZXJjZW50YWdlID0gX21hcmdpblNwbGl0UGVyY2VudGFnZUJhc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubHJjRmVlID09IDApIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5mZWVTZWxlY3Rpb24gPSBGRUVfU0VMRUNUX01BUkdJTl9TUExJVDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuZmVlU2VsZWN0aW9uID09IEZFRV9TRUxFQ1RfTFJDKSB7CiAgICAgICAgICAgICAgICBpZiAobHJjUmVjZWlhYmxlID4gMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChscmNSZWNlaWFibGUgPj0gc3RhdGUubHJjRmVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnNwbGl0QiA9IHN0YXRlLmxyY0ZlZTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gMDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zcGxpdEIgPSBscmNSZWNlaWFibGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY0ZlZSAtPSBscmNSZWNlaWFibGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmZlZVNlbGVjdGlvbiA9PSBGRUVfU0VMRUNUX01BUkdJTl9TUExJVCkgewogICAgICAgICAgICAgICAgLy8gT25seSBjaGVjayB0aGUgYXZhaWxhYmxlIG1pbmVyIGJhbGFuY2Ugd2hlbiBhYnNvbHV0ZWx5IG5lZWRlZAogICAgICAgICAgICAgICAgaWYgKCFjaGVja2VkTWluZXJMcmNTcGVuZGFibGUgJiYgbWluZXJMcmNTcGVuZGFibGUgPCBzdGF0ZS5scmNGZWUpIHsKICAgICAgICAgICAgICAgICAgICBjaGVja2VkTWluZXJMcmNTcGVuZGFibGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIG1pbmVyTHJjU3BlbmRhYmxlID0gZ2V0U3BlbmRhYmxlKGRlbGVnYXRlLCBfbHJjVG9rZW5BZGRyZXNzLCBmZWVSZWNpcGllbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gT25seSBjYWxjdWxhdGUgc3BsaXQgd2hlbiBtaW5lciBoYXMgZW5vdWdoIExSQzsKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBhbGwgc3BsaXRzIGFyZSAwLgogICAgICAgICAgICAgICAgaWYgKG1pbmVyTHJjU3BlbmRhYmxlID49IHN0YXRlLmxyY0ZlZSkgewogICAgICAgICAgICAgICAgICAgIG5leHRGaWxsQW1vdW50UyA9IG9yZGVyc1soaSArIDEpICUgcmluZ1NpemVdLmZpbGxBbW91bnRTOwogICAgICAgICAgICAgICAgICAgIHVpbnQgc3BsaXQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm9yZGVyLmJ1eU5vTW9yZVRoYW5BbW91bnRCKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0ID0gKG5leHRGaWxsQW1vdW50Uy5tdWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5hbW91bnRTCiAgICAgICAgICAgICAgICAgICAgICAgICkgLyBzdGF0ZS5vcmRlci5hbW91bnRCKS5zdWIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50UwogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0ID0gbmV4dEZpbGxBbW91bnRTLnN1YigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmZpbGxBbW91bnRTLm11bCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vcmRlci5hbW91bnRCCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIC8gc3RhdGUub3JkZXIuYW1vdW50UwogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUub3JkZXIubWFyZ2luU3BsaXRQZXJjZW50YWdlICE9IF9tYXJnaW5TcGxpdFBlcmNlbnRhZ2VCYXNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0ID0gc3BsaXQubXVsKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUub3JkZXIubWFyZ2luU3BsaXRQZXJjZW50YWdlCiAgICAgICAgICAgICAgICAgICAgICAgICkgLyBfbWFyZ2luU3BsaXRQZXJjZW50YWdlQmFzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm9yZGVyLmJ1eU5vTW9yZVRoYW5BbW91bnRCKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnNwbGl0UyA9IHNwbGl0OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnNwbGl0QiA9IHNwbGl0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGltcGxpY2l0cyBvcmRlciB3aXRoIHNtYWxsZXIgaW5kZXggaW4gdGhlIHJpbmcgd2lsbAogICAgICAgICAgICAgICAgICAgIC8vIGJlIHBhaWQgTFJDIHJld2FyZCBmaXJzdCwgc28gdGhlIG9yZGVycyBpbiB0aGUgcmluZyBkb2VzCiAgICAgICAgICAgICAgICAgICAgLy8gbWF0ZXIuCiAgICAgICAgICAgICAgICAgICAgaWYgKHNwbGl0ID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBtaW5lckxyY1NwZW5kYWJsZSAtPSBzdGF0ZS5scmNGZWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmxyY1Jld2FyZCA9IHN0YXRlLmxyY0ZlZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5scmNGZWUgPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV2ZXJ0KCk7IC8vICJ1bnN1cHBvcnRlZCBmZWUgc2VsZWN0aW9uIHZhbHVlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAvLy8gQGRldiBDYWxjdWxhdGUgZWFjaCBvcmRlcidzIGZpbGwgYW1vdW50LgogICAgZnVuY3Rpb24gY2FsY3VsYXRlUmluZ0ZpbGxBbW91bnQoCiAgICAgICAgdWludCAgICAgICAgICByaW5nU2l6ZSwKICAgICAgICBPcmRlclN0YXRlW10gIG9yZGVycwogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgcHVyZQogICAgewogICAgICAgIHVpbnQgc21hbGxlc3RJZHggPSAwOwogICAgICAgIHVpbnQgaTsKICAgICAgICB1aW50IGo7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgaiA9IChpICsgMSkgJSByaW5nU2l6ZTsKICAgICAgICAgICAgc21hbGxlc3RJZHggPSBjYWxjdWxhdGVPcmRlckZpbGxBbW91bnQoCiAgICAgICAgICAgICAgICBvcmRlcnNbaV0sCiAgICAgICAgICAgICAgICBvcmRlcnNbal0sCiAgICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgICAgaiwKICAgICAgICAgICAgICAgIHNtYWxsZXN0SWR4CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBzbWFsbGVzdElkeDsgaSsrKSB7CiAgICAgICAgICAgIGNhbGN1bGF0ZU9yZGVyRmlsbEFtb3VudCgKICAgICAgICAgICAgICAgIG9yZGVyc1tpXSwKICAgICAgICAgICAgICAgIG9yZGVyc1soaSArIDEpICUgcmluZ1NpemVdLAogICAgICAgICAgICAgICAgMCwgICAgICAgICAgICAgICAvLyBOb3QgbmVlZGVkCiAgICAgICAgICAgICAgICAwLCAgICAgICAgICAgICAgIC8vIE5vdCBuZWVkZWQKICAgICAgICAgICAgICAgIDAgICAgICAgICAgICAgICAgLy8gTm90IG5lZWRlZAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KICAgIC8vLyBAcmV0dXJuIFRoZSBzbWFsbGVzdCBvcmRlcidzIGluZGV4LgogICAgZnVuY3Rpb24gY2FsY3VsYXRlT3JkZXJGaWxsQW1vdW50KAogICAgICAgIE9yZGVyU3RhdGUgICAgICAgIHN0YXRlLAogICAgICAgIE9yZGVyU3RhdGUgICAgICAgIG5leHQsCiAgICAgICAgdWludCAgICAgICAgICAgICAgaSwKICAgICAgICB1aW50ICAgICAgICAgICAgICBqLAogICAgICAgIHVpbnQgICAgICAgICAgICAgIHNtYWxsZXN0SWR4CiAgICAgICAgKQogICAgICAgIHByaXZhdGUKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAodWludCBuZXdTbWFsbGVzdElkeCkKICAgIHsKICAgICAgICAvLyBEZWZhdWx0IHRvIHRoZSBzYW1lIHNtYWxsZXN0IGluZGV4CiAgICAgICAgbmV3U21hbGxlc3RJZHggPSBzbWFsbGVzdElkeDsKICAgICAgICB1aW50IGZpbGxBbW91bnRCID0gc3RhdGUuZmlsbEFtb3VudFMubXVsKAogICAgICAgICAgICBzdGF0ZS5yYXRlLmFtb3VudEIKICAgICAgICApIC8gc3RhdGUucmF0ZS5hbW91bnRTOwogICAgICAgIGlmIChzdGF0ZS5vcmRlci5idXlOb01vcmVUaGFuQW1vdW50QikgewogICAgICAgICAgICBpZiAoZmlsbEFtb3VudEIgPiBzdGF0ZS5vcmRlci5hbW91bnRCKSB7CiAgICAgICAgICAgICAgICBmaWxsQW1vdW50QiA9IHN0YXRlLm9yZGVyLmFtb3VudEI7CiAgICAgICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50UyA9IGZpbGxBbW91bnRCLm11bCgKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5yYXRlLmFtb3VudFMKICAgICAgICAgICAgICAgICkgLyBzdGF0ZS5yYXRlLmFtb3VudEI7CiAgICAgICAgICAgICAgICBuZXdTbWFsbGVzdElkeCA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubHJjRmVlID0gc3RhdGUub3JkZXIubHJjRmVlLm11bCgKICAgICAgICAgICAgICAgIGZpbGxBbW91bnRCCiAgICAgICAgICAgICkgLyBzdGF0ZS5vcmRlci5hbW91bnRCOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlLmxyY0ZlZSA9IHN0YXRlLm9yZGVyLmxyY0ZlZS5tdWwoCiAgICAgICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50UwogICAgICAgICAgICApIC8gc3RhdGUub3JkZXIuYW1vdW50UzsKICAgICAgICB9CiAgICAgICAgaWYgKGZpbGxBbW91bnRCIDw9IG5leHQuZmlsbEFtb3VudFMpIHsKICAgICAgICAgICAgbmV4dC5maWxsQW1vdW50UyA9IGZpbGxBbW91bnRCOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld1NtYWxsZXN0SWR4ID0gajsKICAgICAgICB9CiAgICB9CiAgICAvLy8gQGRldiBTY2FsZSBkb3duIGFsbCBvcmRlcnMgYmFzZWQgb24gaGlzdG9yaWNhbCBmaWxsIG9yIGNhbmNlbGxhdGlvbgogICAgLy8vICAgICAgc3RhdHMgYnV0IGtleSB0aGUgb3JkZXIncyBvcmlnaW5hbCBleGNoYW5nZSByYXRlLgogICAgZnVuY3Rpb24gc2NhbGVSaW5nQmFzZWRPbkhpc3RvcmljYWxSZWNvcmRzKAogICAgICAgIFRva2VuVHJhbnNmZXJEZWxlZ2F0ZSBkZWxlZ2F0ZSwKICAgICAgICB1aW50IHJpbmdTaXplLAogICAgICAgIE9yZGVyU3RhdGVbXSBvcmRlcnMKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByaW5nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IG9yZGVyc1tpXTsKICAgICAgICAgICAgdmFyIG9yZGVyID0gc3RhdGUub3JkZXI7CiAgICAgICAgICAgIHVpbnQgYW1vdW50OwogICAgICAgICAgICBpZiAob3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIpIHsKICAgICAgICAgICAgICAgIGFtb3VudCA9IG9yZGVyLmFtb3VudEIudG9sZXJhbnRTdWIoCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkT3JGaWxsZWRbc3RhdGUub3JkZXJIYXNoXQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudFMgPSBhbW91bnQubXVsKG9yZGVyLmFtb3VudFMpIC8gb3JkZXIuYW1vdW50QjsKICAgICAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSA9IGFtb3VudC5tdWwob3JkZXIubHJjRmVlKSAvIG9yZGVyLmFtb3VudEI7CiAgICAgICAgICAgICAgICBvcmRlci5hbW91bnRCID0gYW1vdW50OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYW1vdW50ID0gb3JkZXIuYW1vdW50Uy50b2xlcmFudFN1YigKICAgICAgICAgICAgICAgICAgICBjYW5jZWxsZWRPckZpbGxlZFtzdGF0ZS5vcmRlckhhc2hdCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgb3JkZXIuYW1vdW50QiA9IGFtb3VudC5tdWwob3JkZXIuYW1vdW50QikgLyBvcmRlci5hbW91bnRTOwogICAgICAgICAgICAgICAgb3JkZXIubHJjRmVlID0gYW1vdW50Lm11bChvcmRlci5scmNGZWUpIC8gb3JkZXIuYW1vdW50UzsKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudFMgPSBhbW91bnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxdWlyZShvcmRlci5hbW91bnRTID4gMCk7IC8vICJhbW91bnRTIGlzIHplcm8iKTsKICAgICAgICAgICAgcmVxdWlyZShvcmRlci5hbW91bnRCID4gMCk7IC8vICJhbW91bnRCIGlzIHplcm8iKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVpbnQgYXZhaWxhYmxlQW1vdW50UyA9IGdldFNwZW5kYWJsZShkZWxlZ2F0ZSwgb3JkZXIudG9rZW5TLCBvcmRlci5vd25lcik7CiAgICAgICAgICAgIHJlcXVpcmUoYXZhaWxhYmxlQW1vdW50UyA+IDApOyAvLyAib3JkZXIgc3BlbmRhYmxlIGFtb3VudFMgaXMgemVybyIpOwogICAgICAgICAgICBzdGF0ZS5maWxsQW1vdW50UyA9ICgKICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudFMgPCBhdmFpbGFibGVBbW91bnRTID8KICAgICAgICAgICAgICAgIG9yZGVyLmFtb3VudFMgOiBhdmFpbGFibGVBbW91bnRTCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIEVSQzIwIHRva2VuIHRoYXQgY2FuIGJlIHNwZW50IGJ5IHRoaXMgY29udHJhY3QuCiAgICBmdW5jdGlvbiBnZXRTcGVuZGFibGUoCiAgICAgICAgVG9rZW5UcmFuc2ZlckRlbGVnYXRlIGRlbGVnYXRlLAogICAgICAgIGFkZHJlc3MgdG9rZW5BZGRyZXNzLAogICAgICAgIGFkZHJlc3MgdG9rZW5Pd25lcgogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgdmFyIHRva2VuID0gRVJDMjAodG9rZW5BZGRyZXNzKTsKICAgICAgICB1aW50IGFsbG93YW5jZSA9IHRva2VuLmFsbG93YW5jZSgKICAgICAgICAgICAgdG9rZW5Pd25lciwKICAgICAgICAgICAgYWRkcmVzcyhkZWxlZ2F0ZSkKICAgICAgICApOwogICAgICAgIHVpbnQgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0b2tlbk93bmVyKTsKICAgICAgICByZXR1cm4gKGFsbG93YW5jZSA8IGJhbGFuY2UgPyBhbGxvd2FuY2UgOiBiYWxhbmNlKTsKICAgIH0KICAgIC8vLyBAZGV2IHZlcmlmeSBpbnB1dCBkYXRhJ3MgYmFzaWMgaW50ZWdyaXR5LgogICAgZnVuY3Rpb24gdmVyaWZ5SW5wdXREYXRhSW50ZWdyaXR5KAogICAgICAgIHVpbnQgICAgICAgICAgcmluZ1NpemUsCiAgICAgICAgYWRkcmVzc1syXVtdICBhZGRyZXNzTGlzdCwKICAgICAgICB1aW50WzddW10gICAgIHVpbnRBcmdzTGlzdCwKICAgICAgICB1aW50OFsyXVtdICAgIHVpbnQ4QXJnc0xpc3QsCiAgICAgICAgYm9vbFtdICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgdWludDhbXSAgICAgICB2TGlzdCwKICAgICAgICBieXRlczMyW10gICAgIHJMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgc0xpc3QKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHB1cmUKICAgIHsKICAgICAgICByZXF1aXJlKHJpbmdTaXplID09IGFkZHJlc3NMaXN0Lmxlbmd0aCk7IC8vICJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gYWRkcmVzc0xpc3QiKTsKICAgICAgICByZXF1aXJlKHJpbmdTaXplID09IHVpbnRBcmdzTGlzdC5sZW5ndGgpOyAvLyAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHVpbnRBcmdzTGlzdCIpOwogICAgICAgIHJlcXVpcmUocmluZ1NpemUgPT0gdWludDhBcmdzTGlzdC5sZW5ndGgpOyAvLyAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHVpbnQ4QXJnc0xpc3QiKTsKICAgICAgICByZXF1aXJlKHJpbmdTaXplID09IGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdC5sZW5ndGgpOyAvLyAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIGJ1eU5vTW9yZVRoYW5BbW91bnRCTGlzdCIpOwogICAgICAgIHJlcXVpcmUocmluZ1NpemUgKyAxID09IHZMaXN0Lmxlbmd0aCk7IC8vICJyaW5nIGRhdGEgaXMgaW5jb25zaXN0ZW50IC0gdkxpc3QiKTsKICAgICAgICByZXF1aXJlKHJpbmdTaXplICsgMSA9PSByTGlzdC5sZW5ndGgpOyAvLyAicmluZyBkYXRhIGlzIGluY29uc2lzdGVudCAtIHJMaXN0Iik7CiAgICAgICAgcmVxdWlyZShyaW5nU2l6ZSArIDEgPT0gc0xpc3QubGVuZ3RoKTsgLy8gInJpbmcgZGF0YSBpcyBpbmNvbnNpc3RlbnQgLSBzTGlzdCIpOwogICAgICAgIC8vIFZhbGlkYXRlIHJpbmctbWluaW5nIHJlbGF0ZWQgYXJndW1lbnRzLgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IHJpbmdTaXplOyBpKyspIHsKICAgICAgICAgICAgcmVxdWlyZSh1aW50QXJnc0xpc3RbaV1bNl0gPiAwKTsgLy8gIm9yZGVyIHJhdGVBbW91bnRTIGlzIHplcm8iKTsKICAgICAgICAgICAgcmVxdWlyZSh1aW50OEFyZ3NMaXN0W2ldWzFdIDw9IEZFRV9TRUxFQ1RfTUFYX1ZBTFVFKTsgLy8gImludmFsaWQgb3JkZXIgZmVlIHNlbGVjdGlvbiIpOwogICAgICAgIH0KICAgIH0KICAgIC8vLyBAZGV2ICAgICAgICBhc3NtYmxlIG9yZGVyIHBhcmFtZXRlcnMgaW50byBPcmRlciBzdHJ1Y3QuCiAgICAvLy8gQHJldHVybiAgICAgQSBsaXN0IG9mIG9yZGVycy4KICAgIGZ1bmN0aW9uIGFzc2VtYmxlT3JkZXJzKAogICAgICAgIGFkZHJlc3NbMl1bXSAgICBhZGRyZXNzTGlzdCwKICAgICAgICB1aW50WzddW10gICAgICAgdWludEFyZ3NMaXN0LAogICAgICAgIHVpbnQ4WzJdW10gICAgICB1aW50OEFyZ3NMaXN0LAogICAgICAgIGJvb2xbXSAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3QsCiAgICAgICAgdWludDhbXSAgICAgICAgIHZMaXN0LAogICAgICAgIGJ5dGVzMzJbXSAgICAgICByTGlzdCwKICAgICAgICBieXRlczMyW10gICAgICAgc0xpc3QKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChPcmRlclN0YXRlW10gb3JkZXJzKQogICAgewogICAgICAgIHVpbnQgcmluZ1NpemUgPSBhZGRyZXNzTGlzdC5sZW5ndGg7CiAgICAgICAgb3JkZXJzID0gbmV3IE9yZGVyU3RhdGVbXShyaW5nU2l6ZSk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgcmluZ1NpemU7IGkrKykgewogICAgICAgICAgICB2YXIgdWludEFyZ3MgPSB1aW50QXJnc0xpc3RbaV07CiAgICAgICAgCiAgICAgICAgICAgIHZhciBvcmRlciA9IE9yZGVyKAogICAgICAgICAgICAgICAgYWRkcmVzc0xpc3RbaV1bMF0sCiAgICAgICAgICAgICAgICBhZGRyZXNzTGlzdFtpXVsxXSwKICAgICAgICAgICAgICAgIGFkZHJlc3NMaXN0WyhpICsgMSkgJSByaW5nU2l6ZV1bMV0sCiAgICAgICAgICAgICAgICB1aW50QXJnc1swXSwKICAgICAgICAgICAgICAgIHVpbnRBcmdzWzFdLAogICAgICAgICAgICAgICAgdWludEFyZ3NbNV0sCiAgICAgICAgICAgICAgICBidXlOb01vcmVUaGFuQW1vdW50Qkxpc3RbaV0sCiAgICAgICAgICAgICAgICB1aW50OEFyZ3NMaXN0W2ldWzBdCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJ5dGVzMzIgb3JkZXJIYXNoID0gY2FsY3VsYXRlT3JkZXJIYXNoKAogICAgICAgICAgICAgICAgb3JkZXIsCiAgICAgICAgICAgICAgICB1aW50QXJnc1syXSwgLy8gdGltZXN0YW1wCiAgICAgICAgICAgICAgICB1aW50QXJnc1szXSwgLy8gdHRsCiAgICAgICAgICAgICAgICB1aW50QXJnc1s0XSAgLy8gc2FsdAogICAgICAgICAgICApOwogICAgICAgICAgICB2ZXJpZnlTaWduYXR1cmUoCiAgICAgICAgICAgICAgICBvcmRlci5vd25lciwKICAgICAgICAgICAgICAgIG9yZGVySGFzaCwKICAgICAgICAgICAgICAgIHZMaXN0W2ldLAogICAgICAgICAgICAgICAgckxpc3RbaV0sCiAgICAgICAgICAgICAgICBzTGlzdFtpXQogICAgICAgICAgICApOwogICAgICAgICAgICB2YWxpZGF0ZU9yZGVyKAogICAgICAgICAgICAgICAgb3JkZXIsCiAgICAgICAgICAgICAgICB1aW50QXJnc1syXSwgLy8gdGltZXN0YW1wCiAgICAgICAgICAgICAgICB1aW50QXJnc1szXSwgLy8gdHRsCiAgICAgICAgICAgICAgICB1aW50QXJnc1s0XSAgLy8gc2FsdAogICAgICAgICAgICApOwogICAgICAgICAgICBvcmRlcnNbaV0gPSBPcmRlclN0YXRlKAogICAgICAgICAgICAgICAgb3JkZXIsCiAgICAgICAgICAgICAgICBvcmRlckhhc2gsCiAgICAgICAgICAgICAgICB1aW50OEFyZ3NMaXN0W2ldWzFdLCAgLy8gZmVlU2VsZWN0aW9uCiAgICAgICAgICAgICAgICBSYXRlKHVpbnRBcmdzWzZdLCBvcmRlci5hbW91bnRCKSwKICAgICAgICAgICAgICAgIDAsICAgLy8gZmlsbEFtb3VudFMKICAgICAgICAgICAgICAgIDAsICAgLy8gbHJjUmV3YXJkCiAgICAgICAgICAgICAgICAwLCAgIC8vIGxyY0ZlZQogICAgICAgICAgICAgICAgMCwgICAvLyBzcGxpdFMKICAgICAgICAgICAgICAgIDAgICAgLy8gc3BsaXRCCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQogICAgLy8vIEBkZXYgdmFsaWRhdGUgb3JkZXIncyBwYXJhbWV0ZXJzIGFyZSBPSy4KICAgIGZ1bmN0aW9uIHZhbGlkYXRlT3JkZXIoCiAgICAgICAgT3JkZXIgICAgICAgIG9yZGVyLAogICAgICAgIHVpbnQgICAgICAgICB0aW1lc3RhbXAsCiAgICAgICAgdWludCAgICAgICAgIHR0bCwKICAgICAgICB1aW50ICAgICAgICAgc2FsdAogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgewogICAgICAgIHJlcXVpcmUob3JkZXIub3duZXIgIT0gMHgwKTsgLy8gImludmFsaWQgb3JkZXIgb3duZXIiKTsKICAgICAgICByZXF1aXJlKG9yZGVyLnRva2VuUyAhPSAweDApOyAvLyAiaW52YWxpZCBvcmRlciB0b2tlblMiKTsKICAgICAgICByZXF1aXJlKG9yZGVyLnRva2VuQiAhPSAweDApOyAvLyAiaW52YWxpZCBvcmRlciB0b2tlbkIiKTsKICAgICAgICByZXF1aXJlKG9yZGVyLmFtb3VudFMgIT0gMCk7IC8vICJpbnZhbGlkIG9yZGVyIGFtb3VudFMiKTsKICAgICAgICByZXF1aXJlKG9yZGVyLmFtb3VudEIgIT0gMCk7IC8vICJpbnZhbGlkIG9yZGVyIGFtb3VudEIiKTsKICAgICAgICByZXF1aXJlKHRpbWVzdGFtcCA8PSBibG9jay50aW1lc3RhbXApOyAvLyAib3JkZXIgaXMgdG9vIGVhcmx5IHRvIG1hdGNoIik7CiAgICAgICAgcmVxdWlyZSh0aW1lc3RhbXAgPiBjdXRvZmZzW29yZGVyLm93bmVyXSk7IC8vICJvcmRlciBpcyBjdXQgb2ZmIik7CiAgICAgICAgcmVxdWlyZSh0dGwgIT0gMCk7IC8vICJvcmRlciB0dGwgaXMgMCIpOwogICAgICAgIHJlcXVpcmUodGltZXN0YW1wICsgdHRsID4gYmxvY2sudGltZXN0YW1wKTsgLy8gIm9yZGVyIGlzIGV4cGlyZWQiKTsKICAgICAgICByZXF1aXJlKHNhbHQgIT0gMCk7IC8vICJpbnZhbGlkIG9yZGVyIHNhbHQiKTsKICAgICAgICByZXF1aXJlKG9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZSA8PSBNQVJHSU5fU1BMSVRfUEVSQ0VOVEFHRV9CQVNFKTsgLy8gImludmFsaWQgb3JkZXIgbWFyZ2luU3BsaXRQZXJjZW50YWdlIik7CiAgICB9CiAgICAvLy8gQGRldiBHZXQgdGhlIEtlY2Nhay0yNTYgaGFzaCBvZiBvcmRlciB3aXRoIHNwZWNpZmllZCBwYXJhbWV0ZXJzLgogICAgZnVuY3Rpb24gY2FsY3VsYXRlT3JkZXJIYXNoKAogICAgICAgIE9yZGVyICAgICAgICBvcmRlciwKICAgICAgICB1aW50ICAgICAgICAgdGltZXN0YW1wLAogICAgICAgIHVpbnQgICAgICAgICB0dGwsCiAgICAgICAgdWludCAgICAgICAgIHNhbHQKICAgICAgICApCiAgICAgICAgcHJpdmF0ZQogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zIChieXRlczMyKQogICAgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoCiAgICAgICAgICAgIGFkZHJlc3ModGhpcyksCiAgICAgICAgICAgIG9yZGVyLm93bmVyLAogICAgICAgICAgICBvcmRlci50b2tlblMsCiAgICAgICAgICAgIG9yZGVyLnRva2VuQiwKICAgICAgICAgICAgb3JkZXIuYW1vdW50UywKICAgICAgICAgICAgb3JkZXIuYW1vdW50QiwKICAgICAgICAgICAgdGltZXN0YW1wLAogICAgICAgICAgICB0dGwsCiAgICAgICAgICAgIHNhbHQsCiAgICAgICAgICAgIG9yZGVyLmxyY0ZlZSwKICAgICAgICAgICAgb3JkZXIuYnV5Tm9Nb3JlVGhhbkFtb3VudEIsCiAgICAgICAgICAgIG9yZGVyLm1hcmdpblNwbGl0UGVyY2VudGFnZQogICAgICAgICk7CiAgICB9CiAgICAvLy8gQGRldiBWZXJpZnkgc2lnbmVyJ3Mgc2lnbmF0dXJlLgogICAgZnVuY3Rpb24gdmVyaWZ5U2lnbmF0dXJlKAogICAgICAgIGFkZHJlc3Mgc2lnbmVyLAogICAgICAgIGJ5dGVzMzIgaGFzaCwKICAgICAgICB1aW50OCAgIHYsCiAgICAgICAgYnl0ZXMzMiByLAogICAgICAgIGJ5dGVzMzIgcwogICAgICAgICkKICAgICAgICBwcml2YXRlCiAgICAgICAgcHVyZQogICAgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIHNpZ25lciA9PSBlY3JlY292ZXIoCiAgICAgICAgICAgICAgICBrZWNjYWsyNTYoIlx4MTlFdGhlcmV1bSBTaWduZWQgTWVzc2FnZTpcbjMyIiwgaGFzaCksCiAgICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICAgIHMKICAgICAgICAgICAgKQogICAgICAgICk7IC8vICJpbnZhbGlkIHNpZ25hdHVyZSIpOwogICAgfQp9'.
	

]
