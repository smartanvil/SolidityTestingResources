Class {
	#name : #SRTf04436b2edaa1b777045e1eefc6dba8bd2aebab8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf04436b2edaa1b777045e1eefc6dba8bd2aebab8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7CgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIFNhZmVNYXRoCiAqIEBkZXYgTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcyB0aGF0IHRocm93IG9uIGVycm9yCiAqLwpsaWJyYXJ5IFNhZmVNYXRoIHsKICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGEgPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgYXNzZXJ0KGMgLyBhID09IGIpOwogICAgcmV0dXJuIGM7CiAgfQoKICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICBhc3NlcnQoYiA8PSBhKTsKICAgIHJldHVybiBhIC0gYjsKICB9CgogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCi8qKgogKiBAdGl0bGUgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAogKi8KY29udHJhY3QgRVJDMjAgaXMgRVJDMjBCYXNpYyB7CiAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7Cn0KCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICBtYXBwaW5nIChhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGludGVybmFsIGFsbG93ZWQ7CgoKICAvKioKICAgKiBAZGV2IFRyYW5zZmVyIHRva2VucyBmcm9tIG9uZSBhZGRyZXNzIHRvIGFub3RoZXIKICAgKiBAcGFyYW0gX2Zyb20gYWRkcmVzcyBUaGUgYWRkcmVzcyB3aGljaCB5b3Ugd2FudCB0byBzZW5kIHRva2VucyBmcm9tCiAgICogQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICogQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbX2Zyb21dKTsKICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdKTsKCiAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGFsbG93ZWRbX293bmVyXVtfc3BlbmRlcl07CiAgfQoKICAvKioKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqLwogIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0uYWRkKF9hZGRlZFZhbHVlKTsKICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdWludCBvbGRWYWx1ZSA9IGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdOwogICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICB9IGVsc2UgewogICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IG9sZFZhbHVlLnN1Yihfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF9zcGVuZGVyLCBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cgp9CgovLwovLyBDUFlUb2tlbiBpcyBhIHN0YW5kYXJkIEVSQzIwIHRva2VuIHdpdGggYWRkaXRpb25hbCBmdW5jdGlvbmFsaXR5OgovLyAtIHRva2VuU2FsZUNvbnRyYWN0IHJlY2VpdmVzIHRoZSB3aG9sZSBiYWxhbmNlIGZvciBkaXN0cmlidXRpb24KLy8gLSBUb2tlbnMgYXJlIG9ubHkgdHJhbnNmZXJhYmxlIGJ5IHRoZSB0b2tlblNhbGVDb250cmFjdCB1bnRpbCBmaW5hbGl6YXRpb24KLy8gLSBUb2tlbiBob2xkZXJzIGNhbiBidXJuIHRoZWlyIHRva2VucyBhZnRlciBmaW5hbGl6YXRpb24KLy8KY29udHJhY3QgVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiB7CgogICAgc3RyaW5nICBwdWJsaWMgY29uc3RhbnQgbmFtZSAgID0gIkNPUFlUUkFDSyBUb2tlbiI7CiAgICBzdHJpbmcgIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiQ1BZIjsKCiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgICBkZWNpbWFscyA9IDE4OwoKICAgIHVpbnQyNTYgY29uc3RhbnQgRVhBICAgICAgID0gMTAgKiogMTg7CiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseSA9IDEwMCAqIDEwICoqIDYgKiBFWEE7CgogICAgYm9vbCBwdWJsaWMgZmluYWxpemVkID0gZmFsc2U7CgogICAgYWRkcmVzcyBwdWJsaWMgdG9rZW5TYWxlQ29udHJhY3Q7CgogICAgLy8KICAgIC8vIEVWRU5UUwogICAgLy8KICAgIGV2ZW50IEZpbmFsaXplZCgpOwoKICAgIGV2ZW50IEJ1cm50KGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgdWludDI1NiBfYW1vdW50KTsKCgogICAgLy8gSW5pdGlhbGl6ZSB0aGUgdG9rZW4gd2l0aCB0aGUgdG9rZW5TYWxlQ29udHJhY3QgYW5kIHRyYW5zZmVyIHRoZSB3aG9sZSBiYWxhbmNlIHRvIGl0CiAgICBmdW5jdGlvbiBUb2tlbihhZGRyZXNzIF90b2tlblNhbGVDb250cmFjdCkKICAgICAgICBwdWJsaWMKICAgIHsKICAgICAgICAvLyBNYWtlIHN1cmUgYWRkcmVzcyBpcyBzZXQKICAgICAgICByZXF1aXJlKF90b2tlblNhbGVDb250cmFjdCAhPSAwKTsKCiAgICAgICAgYmFsYW5jZXNbX3Rva2VuU2FsZUNvbnRyYWN0XSA9IHRvdGFsU3VwcGx5OwoKICAgICAgICB0b2tlblNhbGVDb250cmFjdCA9IF90b2tlblNhbGVDb250cmFjdDsKICAgIH0KCgogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgdGhlIHN0YW5kYXJkIHRyYW5zZmVyIG1ldGhvZCB0aGF0IHRha2VzIHRoZSBmaW5hbGl6ZSBmbGFnIGludG8gYWNjb3VudAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgICAgIHB1YmxpYwogICAgICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykKICAgIHsKICAgICAgICBjaGVja1RyYW5zZmVyQWxsb3dlZChtc2cuc2VuZGVyKTsKCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCgogICAgLy8gSW1wbGVtZW50YXRpb24gb2YgdGhlIHN0YW5kYXJkIHRyYW5zZmVyRnJvbSBtZXRob2QgdGhhdCB0YWtlcyBpbnRvIGFjY291bnQgdGhlIGZpbmFsaXplIGZsYWcKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGNoZWNrVHJhbnNmZXJBbGxvd2VkKG1zZy5zZW5kZXIpOwoKICAgICAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJGcm9tKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGNoZWNrVHJhbnNmZXJBbGxvd2VkKGFkZHJlc3MgX3NlbmRlcikKICAgICAgICBwcml2YXRlCiAgICAgICAgdmlldwogICAgewogICAgICAgIGlmIChmaW5hbGl6ZWQpIHsKICAgICAgICAgICAgLy8gRXZlcnkgdG9rZW4gaG9sZGVyIHNob3VsZCBiZSBhbGxvd2VkIHRvIHRyYW5zZmVyIHRva2VucyBvbmNlIHRva2VuIHdhcyBmaW5hbGl6ZWQKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gT25seSBhbGxvdyB0b2tlblNhbGVDb250cmFjdCB0byB0cmFuc2ZlciB0b2tlbnMgYmVmb3JlIGZpbmFsaXphdGlvbgogICAgICAgIHJlcXVpcmUoX3NlbmRlciA9PSB0b2tlblNhbGVDb250cmFjdCk7CiAgICB9CgoKICAgIC8vIEZpbmFsaXplIG1ldGhvZCBtYXJrcyB0aGUgcG9pbnQgd2hlcmUgdG9rZW4gdHJhbnNmZXJzIGFyZSBmaW5hbGx5IGFsbG93ZWQgZm9yIGV2ZXJ5Ym9keQogICAgZnVuY3Rpb24gZmluYWxpemUoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUoIWZpbmFsaXplZCk7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHRva2VuU2FsZUNvbnRyYWN0KTsKCiAgICAgICAgZmluYWxpemVkID0gdHJ1ZTsKCiAgICAgICAgRmluYWxpemVkKCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLyBJbXBsZW1lbnQgYSBidXJuIGZ1bmN0aW9uIHRvIHBlcm1pdCBtc2cuc2VuZGVyIHRvIHJlZHVjZSBpdHMgYmFsYW5jZSB3aGljaCBhbHNvIHJlZHVjZXMgdG90YWxTdXBwbHkKICAgIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIHJlcXVpcmUoZmluYWxpemVkKTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA8PSBiYWxhbmNlc1ttc2cuc2VuZGVyXSk7CgogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICAgICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5zdWIoX3ZhbHVlKTsKCiAgICAgICAgQnVybnQobXNnLnNlbmRlciwgX3ZhbHVlKTsKCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuU2FsZUNvbmZpZyAgewogICAgdWludCBwdWJsaWMgY29uc3RhbnQgRVhBID0gMTAgKiogMTg7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgUFVCTElDX1NUQVJUX1RJTUUgICAgICAgICA9IDE1MTU1NDI0MDA7IC8vV2VkLCAxMCBKYW4gMjAxOCAwMDowMDowMCArMDAwMAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgRU5EX1RJTUUgICAgICAgICAgICAgICAgICA9IDE1MTgyMjA4MDA7IC8vU2F0LCAxMCBGZWIgMjAxOCAwMDowMDowMCArMDAwMAogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgQ09OVFJJQlVUSU9OX01JTiAgICAgICAgICA9IDAuMSBldGhlcjsKICAgIHVpbnQyNTYgcHVibGljIGNvbnN0YW50IENPTlRSSUJVVElPTl9NQVggICAgICAgICAgPSAyNTAwLjAgZXRoZXI7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgQ09NUEFOWV9BTExPQ0FUSU9OICAgICAgICA9IDQwICogMTAgKiogNiAqIEVYQTsgLy80MCBtaWxsaW9uOwoKICAgIFRyYW5jaGVbNF0gcHVibGljIHRyYW5jaGVzOwoKICAgIHN0cnVjdCBUcmFuY2hlIHsKICAgICAgICAvLyBIb3cgbG9uZyB0aGlzIHRyYW5jaGUgd2lsbCBiZSBhY3RpdmUKICAgICAgICB1aW50IHVudGlsVG9rZW47CgogICAgICAgIC8vIEhvdyBtYW55IHRva2VucyBwZXIgZXRoZXIgeW91IHdpbGwgZ2V0IHdoaWxlIHRoaXMgdHJhbmNoZSBpcyBhY3RpdmUKICAgICAgICB1aW50IHRva2Vuc1BlckV0aGVyOwogICAgfQoKICAgIGZ1bmN0aW9uIFRva2VuU2FsZUNvbmZpZygpCiAgICAgICAgcHVibGljCiAgICB7CiAgICAgICAgdHJhbmNoZXNbMF0gPSBUcmFuY2hlKHt1bnRpbFRva2VuIDogNTAwMDAwMCAqIEVYQSwgdG9rZW5zUGVyRXRoZXIgOiAxNTU0fSk7CiAgICAgICAgdHJhbmNoZXNbMV0gPSBUcmFuY2hlKHt1bnRpbFRva2VuIDogMTAwMDAwMDAgKiBFWEEsIHRva2Vuc1BlckV0aGVyIDogMTE3OH0pOwogICAgICAgIHRyYW5jaGVzWzJdID0gVHJhbmNoZSh7dW50aWxUb2tlbiA6IDIwMDAwMDAwICogRVhBLCB0b2tlbnNQZXJFdGhlciA6IDEwMDB9KTsKICAgICAgICB0cmFuY2hlc1szXSA9IFRyYW5jaGUoe3VudGlsVG9rZW4gOiA2MDAwMDAwMCwgdG9rZW5zUGVyRXRoZXIgOiA3NDB9KTsKICAgIH0KfQoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCgogIC8qKgogICAqIEBkZXYgVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBvdGhlciB0aGFuIHRoZSBvd25lci4KICAgKi8KICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgXzsKICB9CgoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byB0cmFuc2ZlciBjb250cm9sIG9mIHRoZSBjb250cmFjdCB0byBhIG5ld093bmVyLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIG9ubHlPd25lciB7CiAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgIG93bmVyID0gbmV3T3duZXI7CiAgfQoKfQoKY29udHJhY3QgVG9rZW5TYWxlIGlzIFRva2VuU2FsZUNvbmZpZywgT3duYWJsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDsKCiAgICBUb2tlbiAgcHVibGljICB0b2tlbkNvbnRyYWN0OwoKICAgIC8vIFdlIGtlZXAgdHJhY2sgb2Ygd2hldGhlciB0aGUgc2FsZSBoYXMgYmVlbiBmaW5hbGl6ZWQsIGF0IHdoaWNoIHBvaW50CiAgICAvLyBubyBhZGRpdGlvbmFsIGNvbnRyaWJ1dGlvbnMgd2lsbCBiZSBwZXJtaXR0ZWQuCiAgICBib29sIHB1YmxpYyBmaW5hbGl6ZWQgPSBmYWxzZTsKCiAgICAvLyBsb29rdXAgZm9yIG1heCB3ZWkgYW1vdW50IHBlciB1c2VyIGFsbG93ZWQKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNvbnRyaWJ1dG9yczsKCiAgICAvLyB0aGUgdG90YWwgYW1vdW50IG9mIHdlaSByYWlzZWQKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsV2VpUmFpc2VkID0gMDsKCiAgICAvLyB0aGUgdG90YWwgYW1vdW50IG9mIHRva2VuIHJhaXNlZAogICAgdWludDI1NiBwdWJsaWMgdG90YWxUb2tlblNvbGQgPSAwOwoKICAgIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogICAgYWRkcmVzcyBwdWJsaWMgZnVuZGluZ1dhbGxldEFkZHJlc3M7CgogICAgLy8gYWRkcmVzcyB3aGljaCBtYW5hZ2VzIHRoZSB3aGl0ZWxpc3QgKEtZQykKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHdoaXRlbGlzdE9wZXJhdG9yczsKCiAgICAvLyBsb29rdXAgYWRkcmVzc2VzIGZvciB3aGl0ZWxpc3QKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIHdoaXRlbGlzdDsKCgogICAgLy8gZWFybHkgYmlyZCBpbnZlc3RtZW50cwogICAgYWRkcmVzc1tdIHB1YmxpYyBlYXJseUJpcmRzOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGVhcmx5QmlyZEludmVzdG1lbnRzOwoKCiAgICAvLwogICAgLy8gTU9ESUZJRVJTCiAgICAvLwoKICAgIC8vIFRocm93cyBpZiBwdXJjaGFzZSB3b3VsZCBleGNlZWQgdGhlIG1pbiBtYXggY29udHJpYnV0aW9uLgogICAgLy8gQHBhcmFtIF9jb250cmlidXRlIGFkZHJlc3MKICAgIC8vIEBwYXJhbSBfd2VpQW1vdW50IHRoZSBhbW91bnQgaW50ZW5kZWQgdG8gc3BlbmQKICAgIG1vZGlmaWVyIHdpdGhpbkNvbnRyaWJ1dGlvbkxpbWl0cyhhZGRyZXNzIF9jb250cmlidXRvckFkZHJlc3MsIHVpbnQyNTYgX3dlaUFtb3VudCkgewogICAgICAgIHVpbnQyNTYgdG90YWxDb250cmlidXRpb25BbW91bnQgPSBjb250cmlidXRvcnNbX2NvbnRyaWJ1dG9yQWRkcmVzc10uYWRkKF93ZWlBbW91bnQpOwogICAgICAgIHJlcXVpcmUoX3dlaUFtb3VudCA+PSBDT05UUklCVVRJT05fTUlOKTsKICAgICAgICByZXF1aXJlKHRvdGFsQ29udHJpYnV0aW9uQW1vdW50IDw9IENPTlRSSUJVVElPTl9NQVgpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gVGhyb3dzIGlmIGNhbGxlZCBieSBhbnkgYWNjb3VudCBub3Qgb24gdGhlIHdoaXRlbGlzdC4KICAgIC8vIEBwYXJhbSBfYWRkcmVzcyBBZGRyZXNzIHdoaWNoIHNob3VsZCBleGVjdXRlIHRoZSBmdW5jdGlvbgogICAgbW9kaWZpZXIgb25seVdoaXRlbGlzdGVkKGFkZHJlc3MgX2FkZHJlc3MpIHsKICAgICAgICByZXF1aXJlKHdoaXRlbGlzdFtfYWRkcmVzc10gPT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG5vdCBvbiB0aGUgd2hpdGVsaXN0T3BlcmF0b3JzIGxpc3QKICAgIG1vZGlmaWVyIG9ubHlXaGl0ZWxpc3RPcGVyYXRvcigpCiAgICB7CiAgICAgICAgcmVxdWlyZSh3aGl0ZWxpc3RPcGVyYXRvcnNbbXNnLnNlbmRlcl0gPT0gdHJ1ZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvL1Rocm93cyBpZiBzYWxlIGlzIGZpbmFsaXplZCBvciB0b2tlbiBzYWxlIGVuZCB0aW1lIGhhcyBiZWVuIHJlYWNoZWQKICAgIG1vZGlmaWVyIG9ubHlEdXJpbmdTYWxlKCkgewogICAgICAgIHJlcXVpcmUoZmluYWxpemVkID09IGZhbHNlKTsKICAgICAgICByZXF1aXJlKGN1cnJlbnRUaW1lKCkgPD0gRU5EX1RJTUUpOwogICAgICAgIF87CiAgICB9CgogICAgLy9UaHJvd3MgaWYgc2FsZSBpcyBmaW5hbGl6ZWQKICAgIG1vZGlmaWVyIG9ubHlBZnRlckZpbmFsaXplZCgpIHsKICAgICAgICByZXF1aXJlKGZpbmFsaXplZCk7CiAgICAgICAgXzsKICAgIH0KCgoKICAgIC8vCiAgICAvLyBFVkVOVFMKICAgIC8vCiAgICBldmVudCBMb2dXaGl0ZWxpc3RVcGRhdGVkKGFkZHJlc3MgaW5kZXhlZCBfYWNjb3VudCk7CgogICAgZXZlbnQgTG9nVG9rZW5zUHVyY2hhc2VkKGFkZHJlc3MgaW5kZXhlZCBfYWNjb3VudCwgdWludDI1NiBfY29zdCwgdWludDI1NiBfdG9rZW5zLCB1aW50MjU2IF90b3RhbFRva2VuU29sZCk7CgogICAgZXZlbnQgVW5zb2xkVG9rZW5zQnVybnQodWludDI1NiBfYW1vdW50KTsKCiAgICBldmVudCBGaW5hbGl6ZWQoKTsKCiAgICAvLyBJbml0aWFsaXplIGEgbmV3IFRva2VuU2FsZSBjb250cmFjdAogICAgLy8gQHBhcmFtIF9mdW5kaW5nV2FsbGV0QWRkcmVzcyBBZGRyZXNzIHdoaWNoIGFsbCBldGhlciB3aWxsIGJlIGZvcndhcmRlZCB0bwogICAgZnVuY3Rpb24gVG9rZW5TYWxlKGFkZHJlc3MgX2Z1bmRpbmdXYWxsZXRBZGRyZXNzKQogICAgICAgIHB1YmxpYwogICAgewogICAgICAgIC8vbWFrZSBzdXJlIF9mdW5kaW5nV2FsbGV0QWRkcmVzcyBpcyBzZXQKICAgICAgICByZXF1aXJlKF9mdW5kaW5nV2FsbGV0QWRkcmVzcyAhPSAwKTsKCiAgICAgICAgZnVuZGluZ1dhbGxldEFkZHJlc3MgPSBfZnVuZGluZ1dhbGxldEFkZHJlc3M7CiAgICB9CgogICAgLy8gQ29ubmVjdCBhIHRva2VuIHRvIHRoZSB0b2tlblNhbGUKICAgIC8vIEBwYXJhbSBfZnVuZGluZ1dhbGxldEFkZHJlc3MgQWRkcmVzcyB3aGljaCBhbGwgZXRoZXIgd2lsbCBiZSBmb3J3YXJkZWQgdG8KICAgIGZ1bmN0aW9uIGNvbm5lY3RUb2tlbihUb2tlbiBfdG9rZW5Db250cmFjdCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlPd25lcgogICAgewogICAgICAgIHJlcXVpcmUodG90YWxUb2tlblNvbGQgPT0gMCk7CiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0ID09IGFkZHJlc3MoMCkpOwoKICAgICAgICAvL21ha2Ugc3VyZSB0b2tlbiBpcyB1bnRvdWNoZWQKICAgICAgICByZXF1aXJlKF90b2tlbkNvbnRyYWN0LmJhbGFuY2VPZihhZGRyZXNzKHRoaXMpKSA9PSBfdG9rZW5Db250cmFjdC50b3RhbFN1cHBseSgpKTsKCiAgICAgICAgdG9rZW5Db250cmFjdCA9IF90b2tlbkNvbnRyYWN0OwoKICAgICAgICAvLyBzZW50IHRva2VucyB0byBjb21wYW55IHZhdWx0CiAgICAgICAgdG9rZW5Db250cmFjdC50cmFuc2ZlcihmdW5kaW5nV2FsbGV0QWRkcmVzcywgQ09NUEFOWV9BTExPQ0FUSU9OKTsKICAgICAgICBwcm9jZXNzRWFybHlCaXJkcygpOwogICAgfQoKICAgIGZ1bmN0aW9uKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICB1aW50MjU2IGNvc3QgPSBidXlUb2tlbnMobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKCiAgICAgICAgLy8gZm9yd2FyZCBjb250cmlidXRpb24gdG8gdGhlIGZ1bmRpbmdXYWxsZXRBZGRyZXNzCiAgICAgICAgZnVuZGluZ1dhbGxldEFkZHJlc3MudHJhbnNmZXIoY29zdCk7CiAgICB9CgogICAgLy8gZXhlY3V0aW9uIG9mIHRoZSBhY3R1YWwgdG9rZW4gcHVyY2hhc2UKICAgIGZ1bmN0aW9uIGJ1eVRva2VucyhhZGRyZXNzIGNvbnRyaWJ1dG9yQWRkcmVzcywgdWludDI1NiB3ZWlBbW91bnQpCiAgICAgICAgb25seUR1cmluZ1NhbGUKICAgICAgICBvbmx5V2hpdGVsaXN0ZWQoY29udHJpYnV0b3JBZGRyZXNzKQogICAgICAgIHdpdGhpbkNvbnRyaWJ1dGlvbkxpbWl0cyhjb250cmlidXRvckFkZHJlc3MsIHdlaUFtb3VudCkKICAgICAgICBwcml2YXRlCiAgICByZXR1cm5zICh1aW50MjU2IGNvc3RzKQogICAgewogICAgICAgIGFzc2VydCh0b2tlbkNvbnRyYWN0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB1aW50MjU2IHRva2Vuc0xlZnQgPSBnZXRUb2tlbnNMZWZ0KCk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBzdGlsbCBoYXZlIHRva2VucyBsZWZ0IGZvciBzYWxlCiAgICAgICAgcmVxdWlyZSh0b2tlbnNMZWZ0ID4gMCk7CgogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBjYWxjdWxhdGVUb2tlbkFtb3VudCh3ZWlBbW91bnQpOwogICAgICAgIHVpbnQyNTYgY29zdCA9IHdlaUFtb3VudDsKICAgICAgICB1aW50MjU2IHJlZnVuZCA9IDA7CgogICAgICAgIC8vIHdlIHNlbGwgdGlsbCB3ZSBkb250IGhhdmUgYW55dGhpbmcgbGVmdAogICAgICAgIGlmICh0b2tlbkFtb3VudCA+IHRva2Vuc0xlZnQpIHsKICAgICAgICAgICAgdG9rZW5BbW91bnQgPSB0b2tlbnNMZWZ0OwoKICAgICAgICAgICAgLy8gY2FsY3VsYXRlIGFjdHVhbCBjb3N0IGZvciBwYXJ0aWFsIGFtb3VudCBvZiB0b2tlbnMuCiAgICAgICAgICAgIGNvc3QgPSB0b2tlbkFtb3VudCAvIGdldEN1cnJlbnRUb2tlbnNQZXJFdGhlcigpOwoKICAgICAgICAgICAgLy8gY2FsY3VsYXRlIHJlZnVuZCBmb3IgY29udHJpYnV0b3IuCiAgICAgICAgICAgIHJlZnVuZCA9IHdlaUFtb3VudC5zdWIoY29zdCk7CiAgICAgICAgfQoKICAgICAgICAvLyB0cmFuc2ZlciB0aGUgdG9rZW5zIHRvIHRoZSBjb250cmlidXRvciBhZGRyZXNzCiAgICAgICAgdG9rZW5Db250cmFjdC50cmFuc2Zlcihjb250cmlidXRvckFkZHJlc3MsIHRva2VuQW1vdW50KTsKCiAgICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGUgYW1vdW50IGJvdWdodCBieSB0aGUgY29udHJpYnV0b3IKICAgICAgICBjb250cmlidXRvcnNbY29udHJpYnV0b3JBZGRyZXNzXSA9IGNvbnRyaWJ1dG9yc1tjb250cmlidXRvckFkZHJlc3NdLmFkZChjb3N0KTsKCgogICAgICAgIC8vaWYgd2UgZ290IGEgcmVmdW5kIHByb2Nlc3MgaXQgbm93CiAgICAgICAgaWYgKHJlZnVuZCA+IDApIHsKICAgICAgICAgICAgLy8gdHJhbnNmZXIgYmFjayBldmVyeXRoaW5nIHRoYXQgZXhjZWVkZWQgdGhlIGFtb3VudCBvZiB0b2tlbnMgbGVmdAogICAgICAgICAgICBjb250cmlidXRvckFkZHJlc3MudHJhbnNmZXIocmVmdW5kKTsKICAgICAgICB9CgogICAgICAgIC8vIGluY3JlYXNlIHN0YXRzCiAgICAgICAgdG90YWxXZWlSYWlzZWQgKz0gY29zdDsKICAgICAgICB0b3RhbFRva2VuU29sZCArPSB0b2tlbkFtb3VudDsKCiAgICAgICAgTG9nVG9rZW5zUHVyY2hhc2VkKGNvbnRyaWJ1dG9yQWRkcmVzcywgY29zdCwgdG9rZW5BbW91bnQsIHRvdGFsVG9rZW5Tb2xkKTsKCiAgICAgICAgLy8gSWYgYWxsIHRva2VucyBhdmFpbGFibGUgZm9yIHNhbGUgaGF2ZSBiZWVuIHNvbGQgb3V0LCBmaW5hbGl6ZSB0aGUgc2FsZSBhdXRvbWF0aWNhbGx5LgogICAgICAgIGlmICh0b2tlbnNMZWZ0LnN1Yih0b2tlbkFtb3VudCkgPT0gMCkgewogICAgICAgICAgICBmaW5hbGl6ZUludGVybmFsKCk7CiAgICAgICAgfQoKCiAgICAgICAgLy9yZXR1cm4gdGhlIGFjdHVhbCBjb3N0IG9mIHRoZSBzYWxlCiAgICAgICAgcmV0dXJuIGNvc3Q7CiAgICB9CgogICAgLy8gYXNrIHRoZSBjb25uZWN0ZWQgdG9rZW4gaG93IG1hbnkgdG9rZW5zIHdlIGhhdmUgbGVmdCAKICAgIGZ1bmN0aW9uIGdldFRva2Vuc0xlZnQoKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgIHJldHVybnMgKHVpbnQyNTYgdG9rZW5zTGVmdCkKICAgIHsKICAgICAgICByZXR1cm4gdG9rZW5Db250cmFjdC5iYWxhbmNlT2YodGhpcyk7CiAgICB9CgogICAgLy8gY2FsY3VsYXRlIHRoZSBjdXJyZW50IHRva2VucyBwZXIgZXRoZXIKICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRUb2tlbnNQZXJFdGhlcigpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgcmV0dXJucyAodWludDI1NiB0b2tlbnNQZXJFdGhlcikKICAgIHsKICAgICAgICB1aW50IGk7CiAgICAgICAgdWludCBkZWZhdWx0VG9rZW5zUGVyRXRoZXIgPSB0cmFuY2hlc1t0cmFuY2hlcy5sZW5ndGggLSAxXS50b2tlbnNQZXJFdGhlcjsKCiAgICAgICAgaWYgKGN1cnJlbnRUaW1lKCkgPj0gUFVCTElDX1NUQVJUX1RJTUUpIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRUb2tlbnNQZXJFdGhlcjsKICAgICAgICB9CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0cmFuY2hlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAodG90YWxUb2tlblNvbGQgPj0gdHJhbmNoZXNbaV0udW50aWxUb2tlbikgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vc2VsbCB1bnRpbCB0aGUgY29udHJhY3QgaGFzIG5vciBtb3JlIHRva2VucwogICAgICAgICAgICByZXR1cm4gdHJhbmNoZXNbaV0udG9rZW5zUGVyRXRoZXI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGVmYXVsdFRva2Vuc1BlckV0aGVyOwogICAgfQoKICAgIC8vIGNhbGN1bGF0ZSB0aGUgdG9rZW4gYW1vdW50IGZvciBhIGdpdmUgd2VpQW1vdW50CiAgICBmdW5jdGlvbiBjYWxjdWxhdGVUb2tlbkFtb3VudCh1aW50MjU2IHdlaUFtb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICByZXR1cm5zICh1aW50MjU2IHRva2VucykKICAgIHsKICAgICAgICByZXR1cm4gd2VpQW1vdW50ICogZ2V0Q3VycmVudFRva2Vuc1BlckV0aGVyKCk7CiAgICB9CgogICAgLy8KICAgIC8vIFdISVRFTElTVAogICAgLy8KCiAgICAvLyBhZGQgYSBuZXcgd2hpdGVsaXN0T3BlcmF0b3IKICAgIGZ1bmN0aW9uIGFkZFdoaXRlbGlzdE9wZXJhdG9yKGFkZHJlc3MgX2FkZHJlc3MpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgd2hpdGVsaXN0T3BlcmF0b3JzW19hZGRyZXNzXSA9IHRydWU7CiAgICB9CgogICAgLy8gcmVtb3ZlIGEgd2hpdGVsaXN0T3BlcmF0b3IKICAgIGZ1bmN0aW9uIHJlbW92ZVdoaXRlbGlzdE9wZXJhdG9yKGFkZHJlc3MgX2FkZHJlc3MpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seU93bmVyCiAgICB7CiAgICAgICAgcmVxdWlyZSh3aGl0ZWxpc3RPcGVyYXRvcnNbX2FkZHJlc3NdKTsKCiAgICAgICAgZGVsZXRlIHdoaXRlbGlzdE9wZXJhdG9yc1tfYWRkcmVzc107CiAgICB9CgoKICAgIC8vIEFsbG93cyB3aGl0ZWxpc3RPcGVyYXRvcnMgdG8gYWRkIGFuIGFjY291bnQgdG8gdGhlIHdoaXRlbGlzdC4KICAgIC8vIE9ubHkgdGhvc2UgYWNjb3VudHMgd2lsbCBiZSBhbGxvd2VkIHRvIGNvbnRyaWJ1dGUgZHVyaW5nIHRoZSBzYWxlLgogICAgZnVuY3Rpb24gYWRkVG9XaGl0ZWxpc3QoYWRkcmVzcyBfYWRkcmVzcykKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2hpdGVsaXN0T3BlcmF0b3IKICAgIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICB3aGl0ZWxpc3RbX2FkZHJlc3NdID0gdHJ1ZTsKICAgICAgICBMb2dXaGl0ZWxpc3RVcGRhdGVkKF9hZGRyZXNzKTsKICAgIH0KCiAgICAvLyBBbGxvd3Mgd2hpdGVsaXN0T3BlcmF0b3JzIHRvIHJlbW92ZSBhbiBhY2NvdW50IGZyb20gdGhlIHdoaXRlbGlzdC4KICAgIGZ1bmN0aW9uIHJlbW92ZUZyb21XaGl0ZWxpc3QoYWRkcmVzcyBfYWRkcmVzcykKICAgICAgICBwdWJsaWMKICAgICAgICBvbmx5V2hpdGVsaXN0T3BlcmF0b3IKICAgIHsKICAgICAgICByZXF1aXJlKF9hZGRyZXNzICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBkZWxldGUgd2hpdGVsaXN0W19hZGRyZXNzXTsKICAgIH0KCiAgICAvL3JldHVybnMgdGhlIGN1cnJlbnQgdGltZSwgbmVlZGVkIGZvciB0ZXN0cwogICAgZnVuY3Rpb24gY3VycmVudFRpbWUoKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2IF9jdXJyZW50VGltZSkKICAgIHsKICAgICAgICByZXR1cm4gbm93OwogICAgfQoKCiAgICAvLyBBbGxvd3MgdGhlIG93bmVyIHRvIGZpbmFsaXplIHRoZSBzYWxlLgogICAgZnVuY3Rpb24gZmluYWxpemUoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seU93bmVyCiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICAvL2FsbG93IG9ubHkgYWZ0ZXIgdGhlIGRlZmluZWQgZW5kX3RpbWUKICAgICAgICByZXF1aXJlKGN1cnJlbnRUaW1lKCkgPiBFTkRfVElNRSk7CgogICAgICAgIHJldHVybiBmaW5hbGl6ZUludGVybmFsKCk7CiAgICB9CgoKICAgIC8vIFRoZSBpbnRlcm5hbCBvbmUgd2lsbCBiZSBjYWxsZWQgaWYgdG9rZW5zIGFyZSBzb2xkIG91dCBvcgogICAgLy8gdGhlIGVuZCB0aW1lIGZvciB0aGUgc2FsZSBpcyByZWFjaGVkLCBpbiBhZGRpdGlvbiB0byBiZWluZyBjYWxsZWQKICAgIC8vIGZyb20gdGhlIHB1YmxpYyB2ZXJzaW9uIG9mIGZpbmFsaXplKCkuCiAgICBmdW5jdGlvbiBmaW5hbGl6ZUludGVybmFsKCkgcHJpdmF0ZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZSghZmluYWxpemVkKTsKCiAgICAgICAgZmluYWxpemVkID0gdHJ1ZTsKCiAgICAgICAgRmluYWxpemVkKCk7CgogICAgICAgIC8vYWxzbyBmaW5hbGl6ZSB0aGUgdG9rZW4gY29udHJhY3QKICAgICAgICB0b2tlbkNvbnRyYWN0LmZpbmFsaXplKCk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIHJlZ2lzdGVyIGFuIGVhcmx5IGJpcmQgaW52ZXN0bWVudAogICAgZnVuY3Rpb24gYWRkRWFybHlCaXJkKGFkZHJlc3MgX2FkZHJlc3MsIHVpbnQyNTYgd2VpQW1vdW50KQogICAgICAgIG9ubHlPd25lcgogICAgICAgIHdpdGhpbkNvbnRyaWJ1dGlvbkxpbWl0cyhfYWRkcmVzcywgd2VpQW1vdW50KQogICAgICAgIGV4dGVybmFsCiAgICB7CiAgICAgICAgLy8gb25seSBhbGxvd2VkIGFzIGxvbmcgYXMgd2UgZG9udCBoYXZlIGEgY29ubmVjdGVkIHRva2VuCiAgICAgICAgcmVxdWlyZSh0b2tlbkNvbnRyYWN0ID09IGFkZHJlc3MoMCkpOwoKICAgICAgICBlYXJseUJpcmRzLnB1c2goX2FkZHJlc3MpOwogICAgICAgIGVhcmx5QmlyZEludmVzdG1lbnRzW19hZGRyZXNzXSA9IHdlaUFtb3VudDsKCiAgICAgICAgLy8gYXV0byB3aGl0ZWxpc3QgZWFybHkgYmlyZDsKICAgICAgICB3aGl0ZWxpc3RbX2FkZHJlc3NdID0gdHJ1ZTsKICAgIH0KCiAgICAvLyB0cmFuc2ZlciB0aGUgdG9rZW5zIGJvdWdodCBieSB0aGUgZWFybHkgYmlyZHMgYmVmb3JlIGNvbnRyYWN0IGNyZWF0aW9uCiAgICBmdW5jdGlvbiBwcm9jZXNzRWFybHlCaXJkcygpCiAgICAgICAgcHJpdmF0ZQogICAgewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IGVhcmx5QmlyZHMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBhZGRyZXNzIGVhcmx5QmlyZEFkZHJlc3MgPSBlYXJseUJpcmRzW2ldOwogICAgICAgICAgICB1aW50MjU2IHdlaUFtb3VudCA9IGVhcmx5QmlyZEludmVzdG1lbnRzW2Vhcmx5QmlyZEFkZHJlc3NdOwoKICAgICAgICAgICAgYnV5VG9rZW5zKGVhcmx5QmlyZEFkZHJlc3MsIHdlaUFtb3VudCk7CiAgICAgICAgfQogICAgfQoKCiAgICAvLyBhbGxvd3MgZXZlcnlvbmUgdG8gYnVybiBhbGwgdW5zb2xkIHRva2VucyBpbiB0aGUgc2FsZSBjb250cmFjdCBhZnRlciBmaW5hbGl6ZWQuCiAgICBmdW5jdGlvbiBidXJuVW5zb2xkVG9rZW5zKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlBZnRlckZpbmFsaXplZAogICAgICAgIHJldHVybnMgKGJvb2wpCiAgICB7CiAgICAgICAgdWludDI1NiBsZWZ0VG9rZW5zID0gZ2V0VG9rZW5zTGVmdCgpOwoKICAgICAgICByZXF1aXJlKGxlZnRUb2tlbnMgPiAwKTsKCiAgICAgICAgLy8gbGV0J2VtIGJ1cm4KICAgICAgICByZXF1aXJlKHRva2VuQ29udHJhY3QuYnVybihsZWZ0VG9rZW5zKSk7CgogICAgICAgIFVuc29sZFRva2Vuc0J1cm50KGxlZnRUb2tlbnMpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfQ=='.
	

]
