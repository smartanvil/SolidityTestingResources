Class {
	#name : #SRT357f07ac89ee6329a70ca837d6bfc16b0275015f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT357f07ac89ee6329a70ca837d6bfc16b0275015f >> base64 [
	^ 'Ly8gMS4JVGhlIEV0aGVyZXVtIFN3ZWVwc3Rha2UgaXMgTk9UIGEgY29tcGFueSwgaXQgaXMgYSBzbWFydCBjb250cmFjdCB3cml0dGVuIHVzaW5nIHRoZSBFdGhlcmV1bSBwcm90b2NvbHMsIHdoaWNoIHJ1bnMgb24gdGhlIEV0aGVyZXVtIEJsb2NrY2hhaW4uIAovLyAyLglFdGhlcmV1bSBTd2VlcHN0YWtlcyBpcyBvbmx5IGF2YWlsYWJsZSB0byB1c2VycyBmcm9tIGNvdW50cmllcyB3aGVyZSBhcHBsaWNhYmxlIGxhdyBhbGxvd3MuCi8vIDMuCVlvdSBNdXN0IGJlIGF0IGxlYXN0IDE4IHllYXJzIG9mIGFnZSB0byBwYXJ0aWNpcGF0ZQovLyA0LglUaGUgRXRoZXJldW0gU3dlZXBzdGFrZSBpcyBhIHNtYXJ0IGNvbnRyYWN0IHRoYXQgZW5hYmxlcyBjb250cmlidXRvcnMgdG8gYWNxdWlyZSB1cCB0byA0LDAwMCwwMDAgU1dFRVAgY29pbnMsIGF0IGEgcHJpY2Ugb2YgMSBFVEhFUiBwZXIgMSBTV0VFUCB0b2tlbi4gIAovLyA1LglBIG1pbmltdW0gb2YgNTclIG9mIGFsbCBFVEhFUnMgcmVjZWl2ZWQgYXJlIGtlcHQgb24gc21hcnQgY29udHJhY3Qgd2FsbGV0IGFuZCBndWFyYW50ZWVkIHRvIGJlIHRyYW5zZmVycmVkIGFzIHByaXplcy4KLy8gNi4JVGhlIEV0aGVyZXVtIFN3ZWVwc3Rha2UgaXMgbm90IGFmZmlsaWF0ZWQgdG8gdGhlIEV0aGVyZXVtIEZvdW5kYXRpb24sIGFuZCBpcyBvbmx5IG1hZGUgcG9zc2libGUgYnkgdGhlIEV0aGVyZXVtIEJvY2tjaGFpbiBhbmQgaXRzIHNtYXJ0IGNvbnRyYWN0IGFwcGxpY2F0aW9uLiAgRXRoZXJldW0gaXMgYSB0cmFkZW1hcmsgb3duZWQgYnkgdGhlIEV0aGVyZXVtIEZvdW5kYXRpb24uIEEgdG90YWwgb2YgZml2ZSBwZXJjZW50ICg1JSkgb2YgdGhlIEV0aGVyZXVtIFN3ZWVwc3Rha2Ugc2FsZSB3aWxsIGJlIGRvbmF0ZWQgdG8gdGhlIEV0aGVyZXVtIEZvdW5kYXRpb24gZm9yIHRoZSBjb250aW51ZWQgc3VwcG9ydCBhbmQgZGV2ZWxvcG1lbnQgb2YgdGhlIEV0aGVyZXVtIEJsb2NrY2hhaW4uCi8vIDcuCVRoZSBFdGhlcmV1bSBTd2VlcHN0YWtlIHdhcyBpbnZlbnRlZCBieSBIbGFkdW4gUm9zdHlzbGF2IGEgY2l0aXplbiBvZiB0aGUgVWtyYWluZSwgcmVzaWRpbmcgaW4gdGhlIGNpdHkgb2YgTHZpdi4gIFRoZSBFdGhlcmV1bSBTd2VlcHN0YWtlIHdpbGwgcGF5IHRoZSBpbnZlbnRvciBhbmQgb3IgdG8gaGlzIG5vbWluZWUgYSB0b3RhbCBvZiBmaXZlIHBlcmNlbnQgKDUlKSBvZiB0aGUgcmVtYWluaW5nIEV0aGVycy4KLy8gOC4JVGhlIEV0aGVyZXVtIFN3ZWVwc3Rha2UgYW5kIGl0cyBTV0VFUCB0b2tlbiBhcmUgYSBzbWFydCBjb250cmFjdCB3aGljaCBpcyB0cmFuc2FjdGVkIG9uIHRoZSBFdGhlcmV1bSBCbG9ja2NoYWluIGFuZCBhcyBzdWNoIGFyZSBzdWJqZWN0IHRvIFByaXZhdGUgSW50ZXJuYXRpb25hbCBMYXcuICBUaGUgIGp1cmlzZGljdGlvbiBvZiB0aGUgdHJhbnNhY3Rpb24ocykgaW5jbHVkaW5nIHRoZSBwcm9tb3Rpb25zIHNlbnQgdG8gYW5kIG9yIHJlY2VpdmVkIGJ5IHRoZSB1c2VycywgdGhlIHB1cmNoYXNlcyBvZiBTV0VFUCBUb2tlbnMsIGRyYXdpbmcgb2YgdGhlIHdpbm5lcnMgYW5kIHRoZSBwYXltZW50IG9mIHRoZSB3aW5uaW5ncyBhcmUgZGVlbWVkIHRvIGJlIGluIHRoZSBqdXJpc2RpY3Rpb24gb2YgdGhlIGNvdW50cnkgb2YgQ29zdGEgUmljYSBhbmQgYWxsIHVzZXJzIG9mIHRoZSBFdGhlcmV1bSBTd2VlcHN0YWtlIGFncmVlIHRvIHNhaWQgbGVnYWwganVyaXNkaWN0aW9uIHJlZ2FyZGxlc3Mgb2YgY29uZmxpY3RzIG9mIGxhdyBpbmNsdWRpbmcgd2hldGhlciBtaW5pbXVtIGNvbnRhY3QgY2FuIGJlIGVzdGFibGlzaGVkIHdpdGhpbiBhbm90aGVyIGp1cmlzZGljdGlvbi4gCi8vIDkuCQovLyAxMC4JVXBvbiBzZWxsaW5nIHRoZSBsYXN0IFNXRUVQIGNvaW4sIGEgcmFuZG9tIHNlbGVjdGlvbiBydW5uaW5nIG9uIHRoZSBibG9ja2NoYWluIHdpbGwgYmUgYWN0aXZhdGVkIGFuZCB0aGUgd2lubmVycyBvZiB0aGUgRXRoZXJldW0gU3dlZXBzdGFrZSB3aWxsIGF1dG9tYXRpY2FsbHkgYmUgdHJhbnNmZXJyZWQgdGhlIG51bWJlciBvZiBFdGhlcnMgZm9yIHRoZSByZXNwZWN0aXZlIHByaXplcy4gIFdpbm5pbmcgRXRoZXJzIHdpbGwgb25seSBiZSBzZW50IHRvIHBlcnNvbmFsIHdhbGxldCBhZGRyZXNzIHVzZWQgdG8gZW50ZXIgdGhlIEV0aGVyZXVtIFN3ZWVwc3Rha2VzIGFuZCBwdXJjaGFzZSB0aGUgU1dFRVAgY29pbnMuCi8vIDExLglFdGhlcmV1bSBzZW50IGZyb20gYW4gZXhjaGFuZ2UgYW5kIG9yIGJyb2tlcmFnZSBhY2NvdW50cyB3aWxsIGJlIHZvaWQgYW5kIHdpbGwgbm90IHJlY2VpdmUgYW55IHBvdGVudGlhbCB3aW5uaW5ncy4gV2Ugd2lsbCBubyBiZSBsaWFibGUgZm9yIGFueSBsb3NzZXMgaW4gZW50cmllcyBvciBwb3RlbnRpYWwgd2lubmluZ3MgYXMgYSByZXN1bHQgb2YgRXRoZXJldW0gYmVpbmcgdHJhbnNmZXJyZWQgZnJvbSBhIGJyb2tlcmFnZSBhbmQgb3IgZXhjaGFuZ2Ugd2FsbGV0LgovLyAxMi4JVHJhbnNhY3Rpb25zIHRvIGVudGVyIEV0aGVyZXVtIFN3ZWVwc3Rha2VzIGFyZSBtYW5hZ2VkIGFuZCBjb25maXJtZWQgdmlhIHRoZSBFdGhlcmV1bSBibG9ja2NoYWluLiBZb3UgdW5kZXJzdGFuZCB0aGF0IHlvdXIgRXRoZXJldW0gcHVibGljIGFkZHJlc3Mgd2lsbCBiZSBtYWRlIHB1YmxpY2x5IHZpc2libGUgd2hlbiB5b3UgZW50ZXIgdGhlIEV0aGVyZXVtIFN3ZWVwc3Rha2UuCi8vIDEzLglJZiB5b3UgZGVjaWRlIHRvIGVudGVyIHRoZSBFdGhlcmV1bSBTd2VlcHN0YWtlLCB3ZSBoYXZlIG5vIGFiaWxpdHkgdG8gcmV2ZXJzZSB0aGUgdHJhbnNhY3Rpb25zLiAgV2UgYWxzbyBoYXZlIG5vIGFiaWxpdHkgdG8gcGF5b3V0IGFueSBwb3RlbnRpYWwgd2lubmluZ3MgdG8gd2FsbGV0IGFkZHJlc3Mgb3RoZXIgdGhhbiB0aGUgd2FsbGV0IHVzZWQgdG8gZW50ZXIgdGhlIEV0aGVyZXVtIHN3ZWVwc3Rha2UuIFdlIHdpbGwgaGF2ZSBubyBsaWFiaWxpdHkgdG8geW91IG9yIHRvIGFueSB0aGlyZCBwYXJ0eSBmb3IgYW55IGNsYWltcyBvciBkYW1hZ2VzIHRoYXQgbWF5IGFyaXNlIGFzIGEgcmVzdWx0IG9mIGFueSB0cmFuc2FjdGlvbnMgdGhhdCB5b3UgZW5nYWdlIGluIHZpYSBvdXIgd2Vic2l0ZSwgb3IgaW5kZXBlbmRlbnRseSB1c2luZyBvdXIgU21hcnQgQ29udHJhY3QuCi8vIDE0LglFdGhlcmV1bSByZXF1aXJlcyB0aGUgcGF5bWVudCBvZiBhIHRyYW5zYWN0aW9uIGZlZSAoYSDigJxHYXMgRmVl4oCdKSBmb3IgZXZlcnkgdHJhbnNhY3Rpb24gdGhhdCBvY2N1cnMgb24gdGhlIEV0aGVyZXVtIG5ldHdvcmsuIFRoZSBHYXMgRmVlIGZ1bmRzIHRoZSBuZXR3b3JrIG9mIGNvbXB1dGVycyB0aGF0IHJ1biB0aGUgZGVjZW50cmFsaXplZCBFdGhlcmV1bSBuZXR3b3JrLiBUaGlzIG1lYW5zIHRoYXQsIGV2ZW4gaWYgeW91IGVsZWN0IHRvIGludGVyYWN0IGRpcmVjdGx5IHZpYSB0aGUgRXRoZXJldW0gbmV0d29yaywgeW91IHdpbGwgc3RpbGwgbmVlZCB0byBwYXkgYSBHYXMgRmVlIGZvciBlYWNoIHRyYW5zYWN0aW9uIHRoYXQgb2NjdXJzIHZpYSB0aGUgRXRoZXJldW0gbmV0d29yay4KCi8vIERpc2NsYWltZXIgb2YgV2FycmFudGllcwovLyBZT1UgRVhQUkVTU0xZIFVOREVSU1RBTkQgQU5EIEFHUkVFIFRIQVQgWU9VUiBBQ0NFU1MgVE8gQU5EIFVTRSBPRiBUSEUgRVRIRVJFVU0gU1dFRVBTVEFLRSAgSVMgQVQgWU9VUiBTT0xFIFJJU0ssIEFORCBUSEFUIFRIRSBFVEhFUkVVTSBTV0VFUFNUQUtFIGlTIFBST1ZJREVEICJBUyBJUyIgQU5EICJBUyBBVkFJTEFCTEUiIFdJVEhPVVQgV0FSUkFOVElFUyBPRiBBTlkgS0lORCwgV0hFVEhFUiBFWFBSRVNTIE9SIElNUExJRUQuIFRPIFRIRSBGVUxMRVNUIEVYVEVOVCBQRVJNSVNTSUJMRSBQVVJTVUFOVCBUTyBBUFBMSUNBQkxFIExBVywgV0UsIFRIRSBJTlZFTlRPUiwgVEhFIE9XTkVSLCBUSEUgU0VSVklDRSBQUk9WSURFUlMsIE9GRklDRVJTLCBESVJFQ1RPUlMsIEVNUExPWUVFUywgTEVHQUwgQ09VTlNFTCwgT1VSIFNVQlNJRElBUklFUywgQUZGSUxJQVRFUywgQU5EIExJQ0VOU09SUyBNQUtFIE5PIEVYUFJFU1MgV0FSUkFOVElFUyBBTkQgSEVSRUJZIERJU0NMQUlNIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgUkVHQVJESU5HIFRIRSBFVEhFUkVVTSBTV0VFUFNUQUtFIEFORCBBTlkgUEFSVCBPRiBJVCAoSU5DTFVESU5HLCBXSVRIT1VUIExJTUlUQVRJT04sIFRIRSBTSVRFLCBBTlkgU01BUlQgQ09OVFJBQ1QsIE9SIEFOWSBFWFRFUk5BTCBXRUJTSVRFUyksIElOQ0xVRElORyBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsIE5PTi1JTkZSSU5HRU1FTlQsIENPUlJFQ1RORVNTLCBBQ0NVUkFDWSwgT1IgUkVMSUFCSUxJVFkuIFdJVEhPVVQgTElNSVRJTkcgVEhFIEdFTkVSQUxJVFkgT0YgVEhFIEZPUkVHT0lORywgV0UsIFRIRSBJTlZFTlRPUiwgVEhFIE9XTkVSLCBUSEUgU0VSVklDRSBQUk9WSURFUlMsIE9GRklDRVJTLCBESVJFQ1RPUlMsIEVNUExPWUVFUywgTEVHQUwgQ09VTlNFTCxPVVIgU1VCU0lESUFSSUVTLCBBRkZJTElBVEVTLCBBTkQgTElDRU5TT1JTIERPIE5PVCBSRVBSRVNFTlQgT1IgV0FSUkFOVCBUTyBZT1UgVEhBVDogKEkpIFlPVVIgQUNDRVNTIFRPIE9SIFVTRSBPRiBUSEUgQVBQLCBXRUJTSVRFLCBBTkQgT1IgU01BUlQgQ09OVFJBQ1QgV0lMTCBNRUVUIFlPVVIgUkVRVUlSRU1FTlRTLCAoSUkpIFlPVVIgQUNDRVNTIFRPIE9SIFVTRSBPRiBUSEUgQVBQLCBXRUJTSVRFLCBBTkQgT1IgU01BUlQgQ09OVFJBQ1QgV0lMTCBCRSBVTklOVEVSUlVQVEVELCBUSU1FTFksIFNFQ1VSRSBPUiBGUkVFIEZST00gRVJST1IsIChJSUkpIFVTQUdFIERBVEEgUFJPVklERUQgVEhST1VHSCBUSEUgQVBQLCBXRUJTSVRFLCBBTkQgT1IgU01BUlQgQ09OVFJBQ1QgV0lMTCBCRSBBQ0NVUkFURSwgT1IgKElJSSkgVEhFIEFQUCBPUiBBTlkgQ09OVEVOVCwgU0VSVklDRVMsIE9SIEZFQVRVUkVTIE1BREUgQVZBSUxBQkxFIE9OIE9SIFRIUk9VR0ggVEhFIEFQUCwgV0VCU0lURSBBTkQgT1IgU01BUlQgQ09OVFJBQ1QgQVJFIEZSRUUgT0YgVklSVVNFUyBPUiBPVEhFUiBIQVJNRlVMIENPTVBPTkVOVFMuCgovLyBMaW1pdGF0aW9uIG9mIExpYWJpbGl0eQovLyAxLglZT1UgVU5ERVJTVEFORCBBTkQgQUdSRUUgVEhBVCBXRSwgVEhFIElOVkVOVE9SLCBUSEUgT1dORVIsIFRIRSBTRVJWSUNFIFBST1ZJREVSUywgT0ZGSUNFUlMsIERJUkVDVE9SUywgRU1QTE9ZRUVTLCBMRUdBTCBDT1VOU0VMLCBPVVIgU1VCU0lESUFSSUVTLCBBRkZJTElBVEVTLCBBTkQgTElDRU5TT1JTIFdJTEwgTk9UIEJFIExJQUJMRSBUTyBZT1UgT1IgVE8gQU5ZIFRISVJEIFBBUlRZIEZPUiBBTlkgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIENPTlNFUVVFTlRJQUwsIE9SIEVYRU1QTEFSWSBEQU1BR0VTIFdISUNIIFlPVSBNQVkgSU5DVVIsIEhPV1NPRVZFUiBDQVVTRUQgQU5EIFVOREVSIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBJTkNMVURJTkcsIFdJVEhPVVQgTElNSVRBVElPTiwgQU5ZIExPU1MgT0YgUFJPRklUUyAoV0hFVEhFUiBJTkNVUlJFRCBESVJFQ1RMWSBPUiBJTkRJUkVDVExZKSwgTE9TUyBPRiBHT09EV0lMTCBPUiBCVVNJTkVTUyBSRVBVVEFUSU9OLCBMT1NTIE9GIERBVEEsIENPU1QgT0YgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUywgT1IgQU5ZIE9USEVSIElOVEFOR0lCTEUgTE9TUywgRVZFTiBJRiBXRSBIQVZFIEJFRU4gQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0VTLgovLyAyLglZT1UgQUNLTk9XTEVER0UgQU5EIEFHUkVFIFRIQVQgV0UgSEFWRSBNQURFIFRIRSBBUFAsIFdFQlNJVEUgQU5EIE9SIFNNQVJUIENPTlRSQUNUIEFWQUlMQUJMRSBUTyBZT1UgQU5EIEVOVEVSRUQgSU5UTyBUSEVTRSBURVJNUyBJTiBSRUxJQU5DRSBVUE9OIFRIRSBXQVJSQU5UWSBESVNDTEFJTUVSUyBBTkQgTElNSVRBVElPTlMgT0YgTElBQklMSVRZIFNFVCBGT1JUSCBIRVJFSU4sIFdISUNIIFJFRkxFQ1QgQSBSRUFTT05BQkxFIEFORCBGQUlSIEFMTE9DQVRJT04gT0YgUklTSyBCRVRXRUVOIFRIRSBQQVJUSUVTIEFORCBGT1JNIEFOIEVTU0VOVElBTCBCQVNJUyBPRiBUSEUgQkFSR0FJTiBCRVRXRUVOIFVTLiBXRSBXT1VMRCBOT1QgQkUgQUJMRSBUTyBQUk9WSURFIFRIRSBFVEhFUkVVTSBTV0VFUFNUQUtFIFRPIFlPVSBXSVRIT1VUIFRIRVNFIExJTUlUQVRJT05TLgoKLy8gSW5kZW1uaWZpY2F0aW9uCgovLyAxLglZb3UgYWdyZWUgdG8gaG9sZCBoYXJtbGVzcyBhbmQgaW5kZW1uaWZ5IFRIRSBFVEhFUkVVTSBTV0VFUFNUQUtFIGFuZCBpdHMgb3duZXIsIGludmVudG9yLCBzdWJzaWRpYXJpZXMsIGFmZmlsaWF0ZXMsIG9mZmljZXJzLCBkaXJlY3RvcnMsIGFnZW50cywgZW1wbG95ZWVzLCBhZHZlcnRpc2VycywgbGljZW5zb3JzLCBzdXBwbGllcnMgb3IgcGFydG5lcnMgZnJvbSBhbmQgYWdhaW5zdCBhbnkgY2xhaW0sIGxpYWJpbGl0eSwgbG9zcywgZGFtYWdlIChhY3R1YWwgYW5kIGNvbnNlcXVlbnRpYWwpIG9mIGFueSBraW5kIG9yIG5hdHVyZSwgc3VpdCwganVkZ21lbnQsIGxpdGlnYXRpb24gY29zdCwgYW5kIGF0dG9ybmV5c+KAmSBmZWVzIGFyaXNpbmcgb3V0IG9mIG9yIGluIGFueSB3YXkgcmVsYXRlZCB0byAoaSkgeW91ciBicmVhY2ggb2YgdGhlc2UgVGVybXMsIG9yIChpaSkgeW91ciB2aW9sYXRpb24gb2YgYXBwbGljYWJsZSBsYXdzLCBydWxlcyBvciByZWd1bGF0aW9ucyBpbiBjb25uZWN0aW9uIHdpdGggeW91ciBhY2Nlc3MgdG8gb3IgdXNlIG9mIHRoZSBFdGhlcmV1bSBTd2VlcHN0YWtlLgovLyAyLglUYXhhdGlvbi4gVGhlIFVzZXJzIGJlYXJzIHRoZSBzb2xlIHJlc3BvbnNpYmlsaXR5IHRvIGRldGVybWluZSBpZiB0aGUgRXRoZXJldW0gU3dlZXBzdGFrZSB3aW5uaW5ncyBzaGFsbCBiZSBhIHRheGFibGUgZXZlbnQgZm9yIHRoZSBVc2VyLiBUaGUgVXNlcnMgYmVhciBmdWxsIHJlc3BvbnNpYmlsaXR5IGZvciB0aW1lbHkgYW5kIGNvcnJlY3QgY2FsY3VsYXRpb24gYW5kIHBheW1lbnQgb2YgYWxsIHRheGVzIGR1ZSBpbiBhY2NvcmRhbmNlIHdpdGggdGhlIGxlZ2lzbGF0aW9uIGFwcGxpY2FibGUgdG8gdGhlIFVzZXJzLiBUaGUgU2VydmljZSBpcyBub3QgYSB0YXggYWdlbnQgb2YgdGhlIFVzZXIsIGFzIHdlbGwgYXMgaXQgZG9lcyBub3QgYWR2aXNlIHRoZSBVc2VyIG9uIHRoZSBvcmRlciBvZiBjYWxjdWxhdGlvbiBhbmQvb3IgdGhlIHBheW1lbnQgb2YgdGF4ZXMuCgovLyBOb3RpZmljYXRpb24gQWJvdXQgUmlza3MKLy8gMS4JVGhlIFVzZXIgdW5kZXJzdGFuZHMgYW5kIGFjY2VwdHMgdGhlIHJpc2tzIGluIGNvbm5lY3Rpb24gd2l0aCB0cmFuc2ZlcnJpbmcgRVRIRVJTIHRvIHRoZSBFdGhlcmV1bSBTd2VlcHN0YWtlIGFuZCBjcmVhdGluZyBhIFNXRUVQIFRva2VuIGFzIGV4ZW1wbGFyeSBzZXQgZm9ydGggYWJvdmUgYW5kIGhlcmVpbmFmdGVyLiBJbiBwYXJ0aWN1bGFyLCBidXQgbm90IGxpbWl0ZWQsIHRoZSBVc2VyIHVuZGVyc3RhbmRzIHRoZSBpbmhlcmVudCByaXNrcyBsaXN0ZWQgaGVyZWluYWZ0ZXI6Ci8vIDIuCVJpc2sgb2Ygc29mdHdhcmUgd2Vha25lc3NlczogVGhlIFVzZXIgdW5kZXJzdGFuZHMgYW5kIGFjY2VwdHMgdGhhdCB0aGUgRXRoZXJldW0gU3dlZXBzdGFrZSBjb25jZXB0LCB0aGUgdW5kZXJseWluZyBzb2Z0d2FyZSBhcHBsaWNhdGlvbiBhbmQgc29mdHdhcmUgcGxhdGZvcm0gKGkuZS4gdGhlIEV0aGVyZXVtIGJsb2NrY2hhaW4pIGlzIHN0aWxsIGluIGFuIGVhcmx5IGRldmVsb3BtZW50IHN0YWdlIGFuZCB1bnByb3Zlbiwgd2h5IHRoZXJlIGlzIG5vIHdhcnJhbnR5IHRoYXQgdGhlIHByb2Nlc3MgZm9yIGNyZWF0aW5nIFRva2VucyB3aWxsIGJlIHVuaW50ZXJydXB0ZWQgb3IgZXJyb3ItZnJlZSBhbmQgd2h5IHRoZXJlIGlzIGFuIGluaGVyZW50IHJpc2sgdGhhdCB0aGUgc29mdHdhcmUgY291bGQgY29udGFpbiB3ZWFrbmVzc2VzLCB2dWxuZXJhYmlsaXRpZXMgb3IgYnVncyBjYXVzaW5nLCBpbnRlciBhbGlhLCB0aGUgY29tcGxldGUgbG9zcyBvZiBFVEggYW5kL29yIFRva2Vucy4KLy8gMy4JUmVndWxhdG9yeSByaXNrOiBUaGUgVXNlciB1bmRlcnN0YW5kcyBhbmQgYWNjZXB0cyB0aGF0IHRoZSBibG9ja2NoYWluIHRlY2hub2xvZ3kgYWxsb3dzIG5ldyBmb3JtcyBvZiBpbnRlcmFjdGlvbiBhbmQgdGhhdCBpdCBpcyBwb3NzaWJsZSB0aGF0IGNlcnRhaW4ganVyaXNkaWN0aW9ucyB3aWxsIGFwcGx5IGV4aXN0aW5nIHJlZ3VsYXRpb25zIG9uLCBvciBpbnRyb2R1Y2UgbmV3IHJlZ3VsYXRpb25zIGFkZHJlc3NpbmcsIGJsb2NrY2hhaW4gdGVjaG5vbG9neSBiYXNlZCBhcHBsaWNhdGlvbnMsIHdoaWNoIG1heSBiZSBjb250cmFyeSB0byB0aGUgY3VycmVudCBzZXR1cCBvZiB0aGUgRXRoZXJldW0gU3dlZXBzdGFrZSBhbmQgd2hpY2ggbWF5LCBpbnRlciBhbGlhLCByZXN1bHQgaW4gc3Vic3RhbnRpYWwgbW9kaWZpY2F0aW9ucyBvZiB0aGUgRXRoZXJldW0gU3dlZXBzdGFrZXMsIGluY2x1ZGluZyBpdHMgdGVybWluYXRpb24gYW5kIHRoZSBsb3NzIG9mIEVUSEVSUy9Ub2tlbnMgZm9yIHRoZSBVc2VyLgovLyA0LglSaXNrIG9mIExvc3Mgb2YgcHJpdmF0ZSBrZXk6IFRva2VucyBjYW4gb25seSBiZSBhY2Nlc3NlZCB3aXRoIGEgd2FsbGV0IHNlZWQgb3IgY29tYmluYXRpb24gb2YgcHJpdmF0ZSBrZXkgYW5kIHBhc3N3b3JkLiBUaGUgcHJpdmF0ZSBrZXkgaXMgZW5jcnlwdGVkIHdpdGggYSBwYXNzd29yZC4gVGhlIFVzZXIgdW5kZXJzdGFuZHMgYW5kIGFjY2VwdHMgdGhhdCBpZiBoaXMgd2FsbGV0IGZpbGUgb3IgcGFzc3dvcmQgcmVzcGVjdGl2ZWx5IGhpcyBwcml2YXRlIGtleSBnb3QgbG9zdCBvciBzdG9sZW4sIHRoZSBvYnRhaW5lZCBUb2tlbnMgYXNzb2NpYXRlZCB3aXRoIHRoZSBVc2VyJ3MgV2FsbGV0IG9yIHBhc3N3b3JkIHdpbGwgYmUgdW5yZWNvdmVyYWJsZSBhbmQgd2lsbCBiZSBwZXJtYW5lbnRseSBsb3N0IHdpdGggdGhlIFJpc2sgb2YgdGhlZnQ6IFRoZSBVc2VyIHVuZGVyc3RhbmRzIGFuZCBhY2NlcHRzIHRoYXQgdGhlIEV0aGVyZXVtIFN3ZWVwc3Rha2UgY29uY2VwdCwgdGhlIHVuZGVybHlpbmcgc29mdHdhcmUgYXBwbGljYXRpb24gYW5kIHNvZnR3YXJlIHBsYXRmb3JtIChpLmUuIHRoZSBFdGhlcmV1bSBibG9ja2NoYWluKSBtYXkgYmUgZXhwb3NlZCB0byBhdHRhY2tzIGJ5IGhhY2tlcnMgb3Igb3RoZXIgaW5kaXZpZHVhbHMgdGhhdCB0aGF0IGNvdWxkIHJlc3VsdCBpbiB0aGVmdCBvciBsb3NzIG9mIFN3ZWVwIFRva2VucyBvciBFVEhFUlMsIGltcGFjdGluZyB0aGUgYWJpbGl0eSB0byBjb21wbGV0ZSB0aGUgRXRoZXJldW0gU3dlZXBzdGFrZS4KLy8gNS4gICBSaXNrIG9mIEV0aGVyZXVtIG1pbmluZyBhdHRhY2tzOiBUaGUgVXNlciB1bmRlcnN0YW5kcyBhbmQgYWNjZXB0cyB0aGF0LCBhcyB3aXRoIG90aGVyIGNyeXB0b2N1cnJlbmNpZXMsIHRoZSBibG9ja2NoYWluIHVzZWQgZm9yIHRoZSBFdGhlcmV1bSBTd2VlcHN0YWtlcyBpcyBzdXNjZXB0aWJsZSB0byBtaW5pbmcgYXR0YWNrcywgaW5jbHVkaW5nIGJ1dCBub3QgbGltaXRlZCB0byBkb3VibGUtc3BlbmQgYXR0YWNrcywgbWFqb3JpdHkgbWluaW5nIHBvd2VyIGF0dGFja3MsIOKAnHNlbGZpc2gtbWluaW5n4oCdIGF0dGFja3MsIGFuZCByYWNlIGNvbmRpdGlvbiBhdHRhY2tzLiBBbnkgc3VjY2Vzc2Z1bCBhdHRhY2tzIHByZXNlbnQgYSByaXNrIHRvIHRoZSBFdGhlcmV1bSBTd2VlcHN0YWtlLCBleHBlY3RlZCBwcm9wZXIgZXhlY3V0aW9uIGFuZCBzZXF1ZW5jaW5nIG9mIEVUSC9Ub2tlbiB0cmFuc2FjdGlvbnMsIGFuZCBleHBlY3RlZCBwcm9wZXIgZXhlY3V0aW9uIGFuZCBzZXF1ZW5jaW5nIG9mIGNvbnRyYWN0IGNvbXB1dGF0aW9ucy4KCnByYWdtYSBzb2xpZGl0eSBeMC40LjE4OwoKLy8gPE9SQUNMSVpFX0FQST4KLyoKQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgT3JhY2xpemUgU1JMCkNvcHlyaWdodCAoYykgMjAxNiBPcmFjbGl6ZSBMVEQKCgoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKLy8gVGhpcyBhcGkgaXMgY3VycmVudGx5IHRhcmdldGVkIGF0IDAuNC4xOCwgcGxlYXNlIGltcG9ydCBvcmFjbGl6ZUFQSV9wcmUwLjQuc29sIG9yIG9yYWNsaXplQVBJXzAuNCB3aGVyZSBuZWNlc3NhcnkKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMTg7Cgpjb250cmFjdCBPcmFjbGl6ZUkgewogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBleHRlcm5hbCBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Ml93aXRoR2FzTGltaXQodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnMSwgc3RyaW5nIF9hcmcyLCB1aW50IF9nYXNsaW1pdCkgZXh0ZXJuYWwgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU4odWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIGJ5dGVzIF9hcmdOKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIGV4dGVybmFsIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSBwdWJsaWMgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHB1YmxpYyByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gc2V0Q3VzdG9tR2FzUHJpY2UodWludCBfZ2FzUHJpY2UpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKSBleHRlcm5hbCBjb25zdGFudCByZXR1cm5zKGJ5dGVzMzIpOwp9CmNvbnRyYWN0IE9yYWNsaXplQWRkclJlc29sdmVySSB7CiAgICBmdW5jdGlvbiBnZXRBZGRyZXNzKCkgcHVibGljIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOwp9CmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgewogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsKICAgIHVpbnQgY29uc3RhbnQgd2VlayA9IDYwKjYwKjI0Kjc7CiAgICB1aW50IGNvbnN0YW50IG1vbnRoID0gNjAqNjAqMjQqMzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX1RMU05vdGFyeSA9IDB4MTA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9BbmRyb2lkID0gMHgyMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0xlZGdlciA9IDB4MzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OYXRpdmUgPSAweEYwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7CgogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKCiAgICBPcmFjbGl6ZUkgb3JhY2xpemU7CiAgICBtb2RpZmllciBvcmFjbGl6ZUFQSSB7CiAgICAgICAgaWYoKGFkZHJlc3MoT0FSKT09MCl8fChnZXRDb2RlU2l6ZShhZGRyZXNzKE9BUikpPT0wKSkKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CgogICAgICAgIGlmKGFkZHJlc3Mob3JhY2xpemUpICE9IE9BUi5nZXRBZGRyZXNzKCkpCiAgICAgICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwoKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldE5ldHdvcmsodWludDggbmV0d29ya0lEKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpewogICAgICByZXR1cm4gb3JhY2xpemVfc2V0TmV0d29yaygpOwogICAgICBuZXR3b3JrSUQ7IC8vIHNpbGVuY2UgdGhlIHdhcm5pbmcgYW5kIHJlbWFpbiBiYWNrd2FyZHMgY29tcGF0aWJsZQogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yaygpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzQjI2MzhhN2NDOWYyQ0IzRDI5OEEzREE3YTkwQjY3RTU1MDZlZCk+MCl7IC8vbWFpbm5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9tYWlubmV0Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKT4wKXsgLy9yb3BzdGVuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4YzAzQTI2MTVENWVmYWY1RjQ5RjYwQjdCQjY1ODNlYWVjMjEyZmRmMSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfcm9wc3RlbjMiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweEI3QTA3QmNGMkJhMmYyNzAzYjI0QzA2OTFiNTI3ODk5OUM1OUFDN2UpPjApeyAvL2tvdmFuIHRlc3RuZXQKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk7CiAgICAgICAgICAgIG9yYWNsaXplX3NldE5ldHdvcmtOYW1lKCJldGhfa292YW4iKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpPjApeyAvL3JpbmtlYnkgdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxNDY1MDBjZmQzNUIyMkU0QTM5MkZlMGFEYzA2RGUxYTEzNjhFZDQ4KTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yaW5rZWJ5Iik7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KT4wKXsgLy9ldGhlcmV1bS1icmlkZ2UKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NmY0ODVDOEJGNmZjNDNlQTIxMkU5M0JCRjhjZTA0NkM3ZjFjYjQ3NSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKT4wKXsgLy9ldGhlci5jYW1wIGlkZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgyMGUxMkExRjg1OUIzRmVhRTVGYjJBMEEzMkMxOEY1YTY1NTU1YkJGKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhRjRjOEIzQzlBZkJENWFCOUY0YmJDODI3ODRBYjZlZjhmQUEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQpIHB1YmxpYyB7CiAgICAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQsIG5ldyBieXRlcygwKSk7CiAgICB9CiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHB1YmxpYyB7CiAgICAgIHJldHVybjsKICAgICAgbXlpZDsgcmVzdWx0OyBwcm9vZjsgLy8gU2lsZW5jZSBjb21waWxlciB3YXJuaW5ncwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgYnl0ZXMgbWVtb3J5IHRtcCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50MTYwIGlhZGRyID0gMDsKICAgICAgICB1aW50MTYwIGIxOwogICAgICAgIHVpbnQxNjAgYjI7CiAgICAgICAgZm9yICh1aW50IGk9MjsgaTwyKzIqMjA7IGkrPTIpewogICAgICAgICAgICBpYWRkciAqPSAyNTY7CiAgICAgICAgICAgIGIxID0gdWludDE2MCh0bXBbaV0pOwogICAgICAgICAgICBiMiA9IHVpbnQxNjAodG1wW2krMV0pOwogICAgICAgICAgICBpZiAoKGIxID49IDk3KSYmKGIxIDw9IDEwMikpIGIxIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjEgPj0gNjUpJiYoYjEgPD0gNzApKSBiMSAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSYmKGIxIDw9IDU3KSkgYjEgLT0gNDg7CiAgICAgICAgICAgIGlmICgoYjIgPj0gOTcpJiYoYjIgPD0gMTAyKSkgYjIgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA2NSkmJihiMiA8PSA3MCkpIGIyIC09IDU1OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNDgpJiYoYjIgPD0gNTcpKSBiMiAtPSA0ODsKICAgICAgICAgICAgaWFkZHIgKz0gKGIxKjE2K2IyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFkZHJlc3MoaWFkZHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHB1cmUgcmV0dXJucyAoaW50KSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBieXRlcyhfYik7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPCBtaW5MZW5ndGgpIG1pbkxlbmd0aCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IG1pbkxlbmd0aDsgaSArKykKICAgICAgICAgICAgaWYgKGFbaV0gPCBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICBlbHNlIGlmIChhW2ldID4gYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmIChhLmxlbmd0aCA8IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbmRleE9mKHN0cmluZyBfaGF5c3RhY2ssIHN0cmluZyBfbmVlZGxlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JiID0gYnl0ZXMoX2IpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmMgPSBieXRlcyhfYyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZCA9IGJ5dGVzKF9kKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JlID0gYnl0ZXMoX2UpOwogICAgICAgIHN0cmluZyBtZW1vcnkgYWJjZGUgPSBuZXcgc3RyaW5nKF9iYS5sZW5ndGggKyBfYmIubGVuZ3RoICsgX2JjLmxlbmd0aCArIF9iZC5sZW5ndGggKyBfYmUubGVuZ3RoKTsKICAgICAgICBieXRlcyBtZW1vcnkgYmFiY2RlID0gYnl0ZXMoYWJjZGUpOwogICAgICAgIHVpbnQgayA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgX2JhLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYVtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JiLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iYltpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JjLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iY1tpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JkLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZFtpXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgX2JlLmxlbmd0aDsgaSsrKSBiYWJjZGVbaysrXSA9IF9iZVtpXTsKICAgICAgICByZXR1cm4gc3RyaW5nKGJhYmNkZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsIF9kLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7CiAgICB9CgogICAgLy8gcGFyc2VJbnQKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KF9hLCAwKTsKICAgIH0KCiAgICAvLyBwYXJzZUludChwYXJzZUZsb2F0KjEwXl9iKQogICAgZnVuY3Rpb24gcGFyc2VJbnQoc3RyaW5nIF9hLCB1aW50IF9iKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHB1cmUgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBpZiAoaSA9PSAwKSByZXR1cm4gIjAiOwogICAgICAgIHVpbnQgaiA9IGk7CiAgICAgICAgdWludCBsZW47CiAgICAgICAgd2hpbGUgKGogIT0gMCl7CiAgICAgICAgICAgIGxlbisrOwogICAgICAgICAgICBqIC89IDEwOwogICAgICAgIH0KICAgICAgICBieXRlcyBtZW1vcnkgYnN0ciA9IG5ldyBieXRlcyhsZW4pOwogICAgICAgIHVpbnQgayA9IGxlbiAtIDE7CiAgICAgICAgd2hpbGUgKGkgIT0gMCl7CiAgICAgICAgICAgIGJzdHJbay0tXSA9IGJ5dGUoNDggKyBpICUgMTApOwogICAgICAgICAgICBpIC89IDEwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyaW5nKGJzdHIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0cmEyY2JvcihzdHJpbmdbXSBhcnIpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAgICAgdWludCBhcnJsZW4gPSBhcnIubGVuZ3RoOwoKICAgICAgICAgICAgLy8gZ2V0IGNvcnJlY3QgY2JvciBvdXRwdXQgbGVuZ3RoCiAgICAgICAgICAgIHVpbnQgb3V0cHV0bGVuID0gMDsKICAgICAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZWxlbUFycmF5ID0gbmV3IGJ5dGVzW10oYXJybGVuKTsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsZW1BcnJheVtpXSA9IChieXRlcyhhcnJbaV0pKTsKICAgICAgICAgICAgICAgIG91dHB1dGxlbiArPSBlbGVtQXJyYXlbaV0ubGVuZ3RoICsgKGVsZW1BcnJheVtpXS5sZW5ndGggLSAxKS8yMyArIDM7IC8vKzMgYWNjb3VudHMgZm9yIHBhaXJlZCBpZGVudGlmaWVyIHR5cGVzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdWludCBjdHIgPSAwOwogICAgICAgICAgICB1aW50IGNib3JsZW4gPSBhcnJsZW4gKyAweDgwOwogICAgICAgICAgICBvdXRwdXRsZW4gKz0gYnl0ZShjYm9ybGVuKS5sZW5ndGg7CiAgICAgICAgICAgIGJ5dGVzIG1lbW9yeSByZXMgPSBuZXcgYnl0ZXMob3V0cHV0bGVuKTsKCiAgICAgICAgICAgIHdoaWxlIChieXRlKGNib3JsZW4pLmxlbmd0aCA+IGN0cikgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGNib3JsZW4pW2N0cl07CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYXJybGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHg1RjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgZm9yICh1aW50IHggPSAwOyB4IDwgZWxlbUFycmF5W2ldLmxlbmd0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhIGJ1ZyB3aXRoIGxhcmdlciBzdHJpbmdzLCB0aGlzIG1heSBiZSB0aGUgY3VscHJpdAogICAgICAgICAgICAgICAgICAgIGlmICh4ICUgMjMgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGVsZW1jYm9ybGVuID0gZWxlbUFycmF5W2ldLmxlbmd0aCAtIHggPj0gMjQgPyAyMyA6IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4OwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtY2JvcmxlbiArPSAweDQwOwogICAgICAgICAgICAgICAgICAgICAgICB1aW50IGxjdHIgPSBjdHI7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChieXRlKGVsZW1jYm9ybGVuKS5sZW5ndGggPiBjdHIgLSBsY3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoZWxlbWNib3JsZW4pW2N0ciAtIGxjdHJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBlbGVtQXJyYXlbaV1beF07CiAgICAgICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4RkY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBiYTJjYm9yKGJ5dGVzW10gYXJyKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgoKICAgIHN0cmluZyBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZShzdHJpbmcgX25ldHdvcmtfbmFtZSkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX25ldHdvcmtfbmFtZSA9IF9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfbmV3UmFuZG9tRFNRdWVyeSh1aW50IF9kZWxheSwgdWludCBfbmJ5dGVzLCB1aW50IF9jdXN0b21HYXNMaW1pdCkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMil7CiAgICAgICAgcmVxdWlyZSgoX25ieXRlcyA+IDApICYmIChfbmJ5dGVzIDw9IDMyKSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IG5ieXRlcyA9IG5ldyBieXRlcygxKTsKICAgICAgICBuYnl0ZXNbMF0gPSBieXRlKF9uYnl0ZXMpOwogICAgICAgIGJ5dGVzIG1lbW9yeSB1bm9uY2UgPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uS2V5SGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uS2V5SGFzaF9ieXRlczMyID0gb3JhY2xpemVfcmFuZG9tRFNfZ2V0U2Vzc2lvblB1YktleUhhc2goKTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG1zdG9yZSh1bm9uY2UsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQodW5vbmNlLCAweDIwKSwgeG9yKGJsb2NraGFzaChzdWIobnVtYmVyLCAxKSksIHhvcihjb2luYmFzZSwgdGltZXN0YW1wKSkpCiAgICAgICAgICAgIG1zdG9yZShzZXNzaW9uS2V5SGFzaCwgMHgyMCkKICAgICAgICAgICAgbXN0b3JlKGFkZChzZXNzaW9uS2V5SGFzaCwgMHgyMCksIHNlc3Npb25LZXlIYXNoX2J5dGVzMzIpCiAgICAgICAgfQogICAgICAgIGJ5dGVzWzNdIG1lbW9yeSBhcmdzID0gW3Vub25jZSwgbmJ5dGVzLCBzZXNzaW9uS2V5SGFzaF07CiAgICAgICAgYnl0ZXMzMiBxdWVyeUlkID0gb3JhY2xpemVfcXVlcnkoX2RlbGF5LCAicmFuZG9tIiwgYXJncywgX2N1c3RvbUdhc0xpbWl0KTsKICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KHF1ZXJ5SWQsIGtlY2NhazI1NihieXRlczgoX2RlbGF5KSwgYXJnc1sxXSwgc2hhMjU2KGFyZ3NbMF0pLCBhcmdzWzJdKSk7CiAgICAgICAgcmV0dXJuIHF1ZXJ5SWQ7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChieXRlczMyIHF1ZXJ5SWQsIGJ5dGVzMzIgY29tbWl0bWVudCkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX3JhbmRvbURTX2FyZ3NbcXVlcnlJZF0gPSBjb21taXRtZW50OwogICAgfQoKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ynl0ZXMzMikgb3JhY2xpemVfcmFuZG9tRFNfYXJnczsKICAgIG1hcHBpbmcoYnl0ZXMzMj0+Ym9vbCkgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWQ7CgogICAgZnVuY3Rpb24gdmVyaWZ5U2lnKGJ5dGVzMzIgdG9zaWduaCwgYnl0ZXMgZGVyc2lnLCBieXRlcyBwdWJrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgc2lnb2s7CiAgICAgICAgYWRkcmVzcyBzaWduZXI7CgogICAgICAgIGJ5dGVzMzIgc2lncjsKICAgICAgICBieXRlczMyIHNpZ3M7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdyXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgdWludCBvZmZzZXQgPSA0Kyh1aW50KGRlcnNpZ1szXSkgLSAweDIwKTsKICAgICAgICBzaWdyXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCwgMzIsIHNpZ3JfLCAwKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2lnc18gPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIG9mZnNldCArPSAzMiArIDI7CiAgICAgICAgc2lnc18gPSBjb3B5Qnl0ZXMoZGVyc2lnLCBvZmZzZXQrKHVpbnQoZGVyc2lnW29mZnNldC0xXSkgLSAweDIwKSwgMzIsIHNpZ3NfLCAwKTsKCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBzaWdyIDo9IG1sb2FkKGFkZChzaWdyXywgMzIpKQogICAgICAgICAgICBzaWdzIDo9IG1sb2FkKGFkZChzaWdzXywgMzIpKQogICAgICAgIH0KCgogICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyNywgc2lnciwgc2lncyk7CiAgICAgICAgaWYgKGFkZHJlc3Moa2VjY2FrMjU2KHB1YmtleSkpID09IHNpZ25lcikgcmV0dXJuIHRydWU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyOCwgc2lnciwgc2lncyk7CiAgICAgICAgICAgIHJldHVybiAoYWRkcmVzcyhrZWNjYWsyNTYocHVia2V5KSkgPT0gc2lnbmVyKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShieXRlcyBwcm9vZiwgdWludCBzaWcyb2Zmc2V0KSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYm9vbCBzaWdvazsKCiAgICAgICAgLy8gU3RlcCA2OiB2ZXJpZnkgdGhlIGF0dGVzdGF0aW9uIHNpZ25hdHVyZSwgQVBQS0VZMSBtdXN0IHNpZ24gdGhlIHNlc3Npb25LZXkgZnJvbSB0aGUgY29ycmVjdCBsZWRnZXIgYXBwIChDT0RFSEFTSCkKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMiA9IG5ldyBieXRlcyh1aW50KHByb29mW3NpZzJvZmZzZXQrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldCwgc2lnMi5sZW5ndGgsIHNpZzIsIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgYXBwa2V5MV9wdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMysxLCA2NCwgYXBwa2V5MV9wdWJrZXksIDApOwoKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMiA9IG5ldyBieXRlcygxKzY1KzMyKTsKICAgICAgICB0b3NpZ24yWzBdID0gYnl0ZSgxKTsgLy9yb2xlCiAgICAgICAgY29weUJ5dGVzKHByb29mLCBzaWcyb2Zmc2V0LTY1LCA2NSwgdG9zaWduMiwgMSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IENPREVIQVNIID0gaGV4ImZkOTRmYTcxYmMwYmExMGQzOWQ0NjRkMGQ4ZjQ2NWVmZWVmMGEyNzY0ZTM4ODdmY2M5ZGY0MWRlZDIwZjUwNWMiOwogICAgICAgIGNvcHlCeXRlcyhDT0RFSEFTSCwgMCwgMzIsIHRvc2lnbjIsIDErNjUpOwogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24yKSwgc2lnMiwgYXBwa2V5MV9wdWJrZXkpOwoKICAgICAgICBpZiAoc2lnb2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTsKCgogICAgICAgIC8vIFN0ZXAgNzogdmVyaWZ5IHRoZSBBUFBLRVkxIHByb3ZlbmFuY2UgKG11c3QgYmUgc2lnbmVkIGJ5IExlZGdlcikKICAgICAgICBieXRlcyBtZW1vcnkgTEVER0VSS0VZID0gaGV4IjdmYjk1NjQ2OWM1YzliODk4NDBkNTViNDM1MzdlNjZhOThkZDQ4MTFlYTBhMjcyMjQyNzJjMmU1NjIyOTExZTg1MzdhMmY4ZTg2YTQ2YmFlYzgyODY0ZTk4ZGQwMWU5Y2NjMmY4YmM1ZGZjOWNiZTVhOTFhMjkwNDk4ZGQ5NmU0IjsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjMgPSBuZXcgYnl0ZXMoMSs2NSk7CiAgICAgICAgdG9zaWduM1swXSA9IDB4RkU7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzLCA2NSwgdG9zaWduMywgMSk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWczID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbMys2NSsxXSkrMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCAzKzY1LCBzaWczLmxlbmd0aCwgc2lnMywgMCk7CgogICAgICAgIHNpZ29rID0gdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24zKSwgc2lnMywgTEVER0VSS0VZKTsKCiAgICAgICAgcmV0dXJuIHNpZ29rOwogICAgfQoKICAgIG1vZGlmaWVyIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5KGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIHsKICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQogICAgICAgIHJlcXVpcmUoKF9wcm9vZlswXSA9PSAiTCIpICYmIChfcHJvb2ZbMV0gPT0gIlAiKSAmJiAoX3Byb29mWzJdID09IDEpKTsKCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOwogICAgICAgIHJlcXVpcmUocHJvb2ZWZXJpZmllZCk7CgogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3JldHVybkNvZGUoYnl0ZXMzMiBfcXVlcnlJZCwgc3RyaW5nIF9yZXN1bHQsIGJ5dGVzIF9wcm9vZikgaW50ZXJuYWwgcmV0dXJucyAodWludDgpewogICAgICAgIC8vIFN0ZXAgMTogdGhlIHByZWZpeCBoYXMgdG8gbWF0Y2ggJ0xQXHgwMScgKExlZGdlciBQcm9vZiB2ZXJzaW9uIDEpCiAgICAgICAgaWYgKChfcHJvb2ZbMF0gIT0gIkwiKXx8KF9wcm9vZlsxXSAhPSAiUCIpfHwoX3Byb29mWzJdICE9IDEpKSByZXR1cm4gMTsKCiAgICAgICAgYm9vbCBwcm9vZlZlcmlmaWVkID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oX3Byb29mLCBfcXVlcnlJZCwgYnl0ZXMoX3Jlc3VsdCksIG9yYWNsaXplX2dldE5ldHdvcmtOYW1lKCkpOwogICAgICAgIGlmIChwcm9vZlZlcmlmaWVkID09IGZhbHNlKSByZXR1cm4gMjsKCiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgZnVuY3Rpb24gbWF0Y2hCeXRlczMyUHJlZml4KGJ5dGVzMzIgY29udGVudCwgYnl0ZXMgcHJlZml4LCB1aW50IG5fcmFuZG9tX2J5dGVzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJvb2wpewogICAgICAgIGJvb2wgbWF0Y2hfID0gdHJ1ZTsKICAgICAgICAKCiAgICAgICAgZm9yICh1aW50MjU2IGk9MDsgaTwgbl9yYW5kb21fYnl0ZXM7IGkrKykgewogICAgICAgICAgICBpZiAoY29udGVudFtpXSAhPSBwcmVmaXhbaV0pIG1hdGNoXyA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1hdGNoXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihieXRlcyBwcm9vZiwgYnl0ZXMzMiBxdWVyeUlkLCBieXRlcyByZXN1bHQsIHN0cmluZyBjb250ZXh0X25hbWUpIGludGVybmFsIHJldHVybnMgKGJvb2wpewoKICAgICAgICAvLyBTdGVwIDI6IHRoZSB1bmlxdWUga2V5aGFzaCBoYXMgdG8gbWF0Y2ggd2l0aCB0aGUgc2hhMjU2IG9mIChjb250ZXh0IG5hbWUgKyBxdWVyeUlkKQogICAgICAgIHVpbnQgbGVkZ2VyUHJvb2ZMZW5ndGggPSAzKzY1Kyh1aW50KHByb29mWzMrNjUrMV0pKzIpKzMyOwogICAgICAgIGJ5dGVzIG1lbW9yeSBrZXloYXNoID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMiwga2V5aGFzaCwgMCk7CiAgICAgICAgaWYgKCEoa2VjY2FrMjU2KGtleWhhc2gpID09IGtlY2NhazI1NihzaGEyNTYoY29udGV4dF9uYW1lLCBxdWVyeUlkKSkpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcxID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbbGVkZ2VyUHJvb2ZMZW5ndGgrKDMyKzgrMSszMikrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrKDMyKzgrMSszMiksIHNpZzEubGVuZ3RoLCBzaWcxLCAwKTsKCiAgICAgICAgLy8gU3RlcCAzOiB3ZSBhc3N1bWUgc2lnMSBpcyB2YWxpZCAoaXQgd2lsbCBiZSB2ZXJpZmllZCBkdXJpbmcgc3RlcCA1KSBhbmQgd2UgdmVyaWZ5IGlmICdyZXN1bHQnIGlzIHRoZSBwcmVmaXggb2Ygc2hhMjU2KHNpZzEpCiAgICAgICAgaWYgKCFtYXRjaEJ5dGVzMzJQcmVmaXgoc2hhMjU2KHNpZzEpLCByZXN1bHQsIHVpbnQocHJvb2ZbbGVkZ2VyUHJvb2ZMZW5ndGgrMzIrOF0pKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBTdGVwIDQ6IGNvbW1pdG1lbnQgbWF0Y2ggdmVyaWZpY2F0aW9uLCBrZWNjYWsyNTYoZGVsYXksIG5ieXRlcywgdW5vbmNlLCBzZXNzaW9uS2V5SGFzaCkgPT0gY29tbWl0bWVudCBpbiBzdG9yYWdlLgogICAgICAgIC8vIFRoaXMgaXMgdG8gdmVyaWZ5IHRoYXQgdGhlIGNvbXB1dGVkIGFyZ3MgbWF0Y2ggd2l0aCB0aGUgb25lcyBzcGVjaWZpZWQgaW4gdGhlIHF1ZXJ5LgogICAgICAgIGJ5dGVzIG1lbW9yeSBjb21taXRtZW50U2xpY2UxID0gbmV3IGJ5dGVzKDgrMSszMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCszMiwgOCsxKzMyLCBjb21taXRtZW50U2xpY2UxLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNlc3Npb25QdWJrZXkgPSBuZXcgYnl0ZXMoNjQpOwogICAgICAgIHVpbnQgc2lnMm9mZnNldCA9IGxlZGdlclByb29mTGVuZ3RoKzMyKyg4KzErMzIpK3NpZzEubGVuZ3RoKzY1OwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NCwgNjQsIHNlc3Npb25QdWJrZXksIDApOwoKICAgICAgICBieXRlczMyIHNlc3Npb25QdWJrZXlIYXNoID0gc2hhMjU2KHNlc3Npb25QdWJrZXkpOwogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdID09IGtlY2NhazI1Nihjb21taXRtZW50U2xpY2UxLCBzZXNzaW9uUHVia2V5SGFzaCkpeyAvL3Vub25jZSwgbmJ5dGVzIGFuZCBzZXNzaW9uS2V5SGFzaCBtYXRjaAogICAgICAgICAgICBkZWxldGUgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXTsKICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlOwoKCiAgICAgICAgLy8gU3RlcCA1OiB2YWxpZGl0eSB2ZXJpZmljYXRpb24gZm9yIHNpZzEgKGtleWhhc2ggYW5kIGFyZ3Mgc2lnbmVkIHdpdGggdGhlIHNlc3Npb25LZXkpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjEgPSBuZXcgYnl0ZXMoMzIrOCsxKzMyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIGxlZGdlclByb29mTGVuZ3RoLCAzMis4KzErMzIsIHRvc2lnbjEsIDApOwogICAgICAgIGlmICghdmVyaWZ5U2lnKHNoYTI1Nih0b3NpZ24xKSwgc2lnMSwgc2Vzc2lvblB1YmtleSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gdmVyaWZ5IGlmIHNlc3Npb25QdWJrZXlIYXNoIHdhcyB2ZXJpZmllZCBhbHJlYWR5LCBpZiBub3QuLiBsZXQncyBkbyBpdCEKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID09IGZhbHNlKXsKICAgICAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdID0gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX3Nlc3Npb25LZXlWYWxpZGl0eShwcm9vZiwgc2lnMm9mZnNldCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3JhY2xpemVfcmFuZG9tRFNfc2Vzc2lvbktleXNIYXNoVmVyaWZpZWRbc2Vzc2lvblB1YmtleUhhc2hdOwogICAgfQoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGxlbmd0aCArIHRvT2Zmc2V0OwoKICAgICAgICAvLyBCdWZmZXIgdG9vIHNtYWxsCiAgICAgICAgcmVxdWlyZSh0by5sZW5ndGggPj0gbWluTGVuZ3RoKTsgLy8gU2hvdWxkIGJlIGEgYmV0dGVyIHdheT8KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgdG1wIDo9IG1sb2FkKGFkZChmcm9tLCBpKSkKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgLy8gRHVwbGljYXRlIFNvbGlkaXR5J3MgZWNyZWNvdmVyLCBidXQgY2F0Y2hpbmcgdGhlIENBTEwgcmV0dXJuIHZhbHVlCiAgICBmdW5jdGlvbiBzYWZlcl9lY3JlY292ZXIoYnl0ZXMzMiBoYXNoLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgewogICAgICAgIC8vIFdlIGRvIG91ciBvd24gbWVtb3J5IG1hbmFnZW1lbnQgaGVyZS4gU29saWRpdHkgdXNlcyBtZW1vcnkgb2Zmc2V0CiAgICAgICAgLy8gMHg0MCB0byBzdG9yZSB0aGUgY3VycmVudCBlbmQgb2YgbWVtb3J5LiBXZSB3cml0ZSBwYXN0IGl0IChhcwogICAgICAgIC8vIHdyaXRlcyBhcmUgbWVtb3J5IGV4dGVuc2lvbnMpLCBidXQgZG9uJ3QgdXBkYXRlIHRoZSBvZmZzZXQgc28KICAgICAgICAvLyBTb2xpZGl0eSB3aWxsIHJldXNlIGl0LiBUaGUgbWVtb3J5IHVzZWQgaGVyZSBpcyBvbmx5IG5lZWRlZCBmb3IKICAgICAgICAvLyB0aGlzIGNvbnRleHQuCgogICAgICAgIC8vIEZJWE1FOiBpbmxpbmUgYXNzZW1ibHkgY2FuJ3QgYWNjZXNzIHJldHVybiB2YWx1ZXMKICAgICAgICBib29sIHJldDsKICAgICAgICBhZGRyZXNzIGFkZHI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNpemUgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKHNpemUsIGhhc2gpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgMzIpLCB2KQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDY0KSwgcikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA5NiksIHMpCgogICAgICAgICAgICAvLyBOT1RFOiB3ZSBjYW4gcmV1c2UgdGhlIHJlcXVlc3QgbWVtb3J5IGJlY2F1c2Ugd2UgZGVhbCB3aXRoCiAgICAgICAgICAgIC8vICAgICAgIHRoZSByZXR1cm4gY29kZQogICAgICAgICAgICByZXQgOj0gY2FsbCgzMDAwLCAxLCAwLCBzaXplLCAxMjgsIHNpemUsIDMyKQogICAgICAgICAgICBhZGRyIDo9IG1sb2FkKHNpemUpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CgogICAgICAgIC8vIFRoZSBzaWduYXR1cmUgZm9ybWF0IGlzIGEgY29tcGFjdCBmb3JtIG9mOgogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQogICAgICAgIC8vIENvbXBhY3QgbWVhbnMsIHVpbnQ4IGlzIG5vdCBwYWRkZWQgdG8gMzIgYnl0ZXMuCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCgogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQKICAgICAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQoKICAgICAgICAgICAgLy8gQWx0ZXJuYXRpdmUgc29sdXRpb246CiAgICAgICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cwogICAgICAgICAgICAvLyB1c2UgdGhlIHNlY29uZCBiZXN0IG9wdGlvbiwgJ2FuZCcKICAgICAgICAgICAgLy8gdiA6PSBhbmQobWxvYWQoYWRkKHNpZywgNjUpKSwgMjU1KQogICAgICAgIH0KCiAgICAgICAgLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0CiAgICAgICAgLy8gdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdCiAgICAgICAgLy8KICAgICAgICAvLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzCiAgICAgICAgaWYgKHYgPCAyNykKICAgICAgICAgIHYgKz0gMjc7CgogICAgICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICByZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwogICAgfQoKfQovLyA8L09SQUNMSVpFX0FQST4KCgovL0NvbnRyYWN0IGRlcGxveWVkIGFzIEV0aGVyZXVtU3dlZXBzdGFrZXMsIHJpbmtlYnkgbWF4IDQwMDAgYXQgLjAwMDAwMQovL0NvbnRyYWN0ICAKCmNvbnRyYWN0IENvaW5JbnRlcmZhY2UgewogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7Cn0KCi8vIEZpeGVkIHN1cHBseSB0b2tlbiBFUkMgc3RhbmRhcmQgY29tcGxpYW50IApjb250cmFjdCBTd2VlcHNUb2tlbiBpcyBDb2luSW50ZXJmYWNlIHsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgc3ltYm9sID0gIlNXRUVQIjsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJFdGhlcmV1bSBTd2VlcHN0YWtlcyBTV0VFUCBUb2tlbiI7CiAgICB1aW50MjU2IF90b3RhbFN1cHBseSA9IDQwMDAwMDA7CiAgICAKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIC8vIENhbiBoYXZlIG11bHRpcGxlIHRva2VucyBwZXIgYWRkcmVzcwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHRva0JhbGFuY2U7CgogICAgZnVuY3Rpb24gU3dlZXBzVG9rZW4oKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgICAgICB0b2tCYWxhbmNlW293bmVyXSA9IF90b3RhbFN1cHBseTsKICAgIH0KIAogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIHRva0JhbGFuY2VbX293bmVyXTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSByZXR1cm5zIChib29sIHN1Y2Nlc3MpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIGlmICh0b2tCYWxhbmNlW21zZy5zZW5kZXJdID49IF9hbW91bnQgJiYgX2Ftb3VudCA+IDAgJiYgdG9rQmFsYW5jZVtfdG9dICsgX2Ftb3VudCA+IHRva0JhbGFuY2VbX3RvXSkgewogICAgICAgICAgICB0b2tCYWxhbmNlW21zZy5zZW5kZXJdIC09IF9hbW91bnQ7CiAgICAgICAgICAgIHRva0JhbGFuY2VbX3RvXSArPSBfYW1vdW50OwogICAgICAgICAgICBUcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQp9CgovLyAKY29udHJhY3QgRXRoZXJldW1Td2VlcHN0YWtlcyBpcyB1c2luZ09yYWNsaXplIHsKICAgIHN0cmluZyBwdWJsaWMgY29uc3RhbnQgbmFtZSA9ICJFdGhlcmV1bSBTd2VlcHN0YWtlcyI7CiAgICB1aW50IGNvbnN0YW50IG1heF90aWNrZXRzID0gNDAwMDAwMDsKCiAgICBhZGRyZXNzIHB1YmxpYyBvd25lcjsKICAgIHVpbnQgcHVibGljIHN3ZWVwc0NyZWF0aW9uVGltZTsKICAgIHVpbnQyNTYgd2l0aGRyYXdhbW91bnQ7CgovL0NvbnRyYWN0IGNvbnRlc3Qgc3RhdGVzCgogICAgZW51bSBTd2VlcHNTdGF0ZXMgewogICAgICAgIE9QRU4sCiAgICAgICAgQ0xPU0VELAogICAgICAgIERSQVdJTkdfV0lOTkVSLAogICAgICAgIERSQVdJTkdfU0VDT05EQVJZX1dJTk5FUlMsCiAgICAgICAgRFJBV0lOR19URVJUSUFSWV9BX1dJTk5FUlMsCiAgICAgICAgRFJBV0lOR19URVJUSUFSWV9CX1dJTk5FUlMsCiAgICAgICAgRFJBV0lOR19URVJUSUFSWV9DX1dJTk5FUlMsCiAgICAgICAgRFJBV0lOR19URVJUSUFSWV9EX1dJTk5FUlMsCiAgICAgICAgV0lOTkVSU19QQUlEX1NXRUVQU19DT01QTEVURQogICAgfQogICAgCiAgICBzdHJ1Y3QgSmFja1BvdHMgewogICAgICAgIHVpbnQgcHJpbWFyeUphY2twb3Q7CiAgICAgICAgdWludCBzZWNvbmRKYWNrUG90OwogICAgICAgIHVpbnQgdGVydGlhcnlBSmFja1BvdDsKICAgICAgICB1aW50IHRlcnRpYXJ5QkphY2tQb3Q7CiAgICAgICAgdWludCB0ZXJ0aWFyeUNKYWNrUG90OwogICAgICAgIHVpbnQgdGVydGlhcnlESmFja1BvdDsKICAgICAgICAvLyB1aW50IG51bVByaW1hcnlXaW5uZXJzOyAvLyBBbHdheXMgMSB3aW5uZXIKICAgICAgICB1aW50IG51bVNlY29uZGFyeVdpbm5lcnM7CiAgICAgICAgdWludCBudW1UZXJ0aWFyeUFXaW5uZXJzOwogICAgICAgIHVpbnQgbnVtVGVydGlhcnlCV2lubmVyczsKICAgICAgICB1aW50IG51bVRlcnRpYXJ5Q1dpbm5lcnM7CiAgICAgICAgdWludCBudW1UZXJ0aWFyeURXaW5uZXJzOwogICAgfQogICAgCiAgICBKYWNrUG90cyBwdWJsaWMgamFja3BvdHM7CiAgICBTd2VlcHNTdGF0ZXMgcHVibGljIHN3ZWVwc1N0YXRlOwogICAgU3dlZXBzVG9rZW4gc3dlZXBzVG9rZW47ICAgIAogICAgYWRkcmVzc1tdIHB1YmxpYyBkcmF3UG9vbDsgIAogICAgdWludCBudW1Ub2tlbnNTb2xkOyAgICAgICAgIAogICAgdWludCBudW1UZXJ0aWFyeUFXaW5uZXJzUGFpZE91dDsKICAgIHVpbnQgbnVtVGVydGlhcnlCV2lubmVyc1BhaWRPdXQ7CiAgICB1aW50IG51bVRlcnRpYXJ5Q1dpbm5lcnNQYWlkT3V0OwogICAgdWludCBudW1UZXJ0aWFyeURXaW5uZXJzUGFpZE91dDsKICAgIHVpbnQgcmFuZG9tTnVtYmVyOwoKICAgIG1vZGlmaWVyIGF0U3RhdGUoU3dlZXBzU3RhdGVzIF9zdGF0ZSkgewogICAgICAgIHJlcXVpcmUoc3dlZXBzU3RhdGUgPT0gX3N0YXRlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIFN0YXRlVHJhbnNpdGlvbnMoKSB7CiAgICAgICAgaWYgKChub3cgPj0gc3dlZXBzQ3JlYXRpb25UaW1lICsgMzc1IGRheXMpICYmIHN3ZWVwc1N0YXRlID09IFN3ZWVwc1N0YXRlcy5PUEVOKSB7IHN3ZWVwc1N0YXRlID0gU3dlZXBzU3RhdGVzLkNMT1NFRDsgfQogICAgICAgIGlmIChzd2VlcHNTdGF0ZSA9PSBTd2VlcHNTdGF0ZXMuQ0xPU0VEKSB7IHN3ZWVwc1N0YXRlID0gU3dlZXBzU3RhdGVzLkRSQVdJTkdfV0lOTkVSOyB9CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5QnkoYWRkcmVzcyBfYWNjb3VudCkKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gX2FjY291bnQpOwogICAgICAgIF87CiAgICB9CgogICAgLy8gLS0tLS0tLSBFdmVudHMgLS0tLS0tLQogICAgZXZlbnQgdGlja2V0c19ib3VnaHQoc3RyaW5nIF9tc2csIHVpbnQgX251bVRpY2tldHMpOwogICAgZXZlbnQgd2lubmVyX2Fubm91bmNlZChhZGRyZXNzIF93aW5uZXIsIHVpbnQgX3dpbm5pbmdzKTsKCiAgICBmdW5jdGlvbiBFdGhlcmV1bVN3ZWVwc3Rha2VzICgpIHB1YmxpYyB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgICAgIG51bVRva2Vuc1NvbGQgPSAwOwogICAgICAgIHN3ZWVwc1N0YXRlID0gU3dlZXBzU3RhdGVzLk9QRU47CiAgICAgICAgc3dlZXBzVG9rZW4gPSBuZXcgU3dlZXBzVG9rZW4oKTsKICAgICAgICBzd2VlcHNDcmVhdGlvblRpbWUgPSBub3c7CiAgICB9CgogICAgZnVuY3Rpb24gIG1hbmFnZW1lbnQoKSBwdWJsaWMgcGF5YWJsZQogICAgICAgIG9ubHlCeShvd25lcikKICAgIHsKICAgICAgICByZXF1aXJlKHdpdGhkcmF3YW1vdW50ID4gMCk7CiAgICAgICAgb3duZXIudHJhbnNmZXIod2l0aGRyYXdhbW91bnQpOyAgICAvLyBMaW1pdGVkIHdpdGhkcmF3IGFtb3VudCBmb3IgbWFya2V0aW5nLCBleHBlbnNlcywgZmVlcywgZXRjLi4gCiAgICAgICAgd2l0aGRyYXdhbW91bnQgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG1pbih1aW50IGEsIHVpbnQgYikgcHJpdmF0ZSBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyBhIDogYjsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2FsY3VsYXRlSmFja3BvdHMoKSBwcml2YXRlIHsKICAgICAgICAvLyBqYWNrcG90cyBpbiB3ZWkKICAgICAgICBqYWNrcG90cy5wcmltYXJ5SmFja3BvdCAgICAgPSAoKG51bVRva2Vuc1NvbGQgKiAzNzUgKiAxMCoqMTgpLzEwMDApIDsgICAvLyAzNy41JSBvZiB0b2tlbnMgc29sZAogICAgICAgIGphY2twb3RzLnNlY29uZEphY2tQb3QgICAgICA9ICgobnVtVG9rZW5zU29sZCAqIDM3NSAqIDEwKioxOCkvMTAwMDAwKTsgICAgLy8gMTAgd2lubmVycyBvZiAxNSwgMDAwIHRva2VucyBvciAuMzc1JSBvZiB0b2tlbnMgc29sZAogICAgICAgIGphY2twb3RzLnRlcnRpYXJ5QUphY2tQb3QgICA9ICgobnVtVG9rZW5zU29sZCAqIDM3NSAqIDEwKioxOCkvMTAwMDAwMCk7ICAgLy8gMTAwIHdpbm5lcnMgb2YgMSw1MDAgdG9rZW5zIG9yIC4wMzc1JSBvZiB0b2tlbnMgc29sZAoJICAgIGphY2twb3RzLnRlcnRpYXJ5QkphY2tQb3QgICA9ICgobnVtVG9rZW5zU29sZCAqIDM3NSAqIDEwKioxOCkvMTAwMDAwMDApOyAgIC8vIDEsMDAwIHdpbm5lcnMgb2YgMTUwIHRva2VucyBvciAuMDAzNzUlIG9mIHRva2VucyBzb2xkCgkgICAgamFja3BvdHMudGVydGlhcnlDSmFja1BvdCAgID0gKChudW1Ub2tlbnNTb2xkICogMzc1ICogMTAqKjE4KS8xMDAwMDAwMDApOyAgIC8vIDEwLDAwMCB3aW5uZXJzIG9mIDE1IHRva2VucyBvciAuMDAwMzc1JSBvZiB0b2tlbnMgc29sZAoJICAgIGphY2twb3RzLnRlcnRpYXJ5REphY2tQb3QgICA9ICgobnVtVG9rZW5zU29sZCAqIDM3NSAqIDEwKioxOCkvMTAwMDAwMDAwMCk7ICAgLy8gMTAwLDAwMCB3aW5uZXJzIG9mIDEuNSB0b2tlbnMgb3IgLjAwMDAzNzUlIG9mIHRva2VucyBzb2xkCgogICAgICAgIC8vIFByZS1DYWxjdWxhdGUgbnVtYmVyIG9mIHdpbm5lcnMgaW4gZWFjaCBjYXRlZ29yeSBiYXNlZCBvbiBudW1iZXIgb2YgdGlja2V0cyBzb2xkCiAgICAgICAgLy9qYWNrcG90cy5udW1QcmltYXJ5V2lubmVycyA9IDE7CiAgICAgICAgamFja3BvdHMubnVtU2Vjb25kYXJ5V2lubmVycyA9IG1pbigxMCwgbnVtVG9rZW5zU29sZCA+IDEgPyAobnVtVG9rZW5zU29sZC0xKSA6IDApOwogICAgICAgIGphY2twb3RzLm51bVRlcnRpYXJ5QVdpbm5lcnMgPSBtaW4oMTAwLCBudW1Ub2tlbnNTb2xkID4gMTEgPyAobnVtVG9rZW5zU29sZC0xMSkgOiAwKTsKICAgICAgICBqYWNrcG90cy5udW1UZXJ0aWFyeUJXaW5uZXJzID0gbWluKDEwMDAsIG51bVRva2Vuc1NvbGQgPiAxMTEgPyAobnVtVG9rZW5zU29sZC0xMTEpIDogMCk7CiAgICAgICAgamFja3BvdHMubnVtVGVydGlhcnlDV2lubmVycyA9IG1pbigxMDAwMCwgbnVtVG9rZW5zU29sZCA+IDExMTEgPyAobnVtVG9rZW5zU29sZC0xMTExKSA6IDApOwogICAgICAgIGphY2twb3RzLm51bVRlcnRpYXJ5RFdpbm5lcnMgPSBtaW4oMTAwMDAwLCBudW1Ub2tlbnNTb2xkID4gMTExMTEgPyAobnVtVG9rZW5zU29sZC0xMTExMSkgOiAwKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYnV5VG9rZW5zKCkgcHVibGljIHBheWFibGUKICAgICAgICBTdGF0ZVRyYW5zaXRpb25zCiAgICAgICAgYXRTdGF0ZShTd2VlcHNTdGF0ZXMuT1BFTikKICAgICAgICByZXR1cm5zKGJvb2wgc3VjY2VzcykgCiAgICB7CiAgICAgICAgcmVxdWlyZShudW1Ub2tlbnNTb2xkIDwgbWF4X3RpY2tldHMpOwogICAgICAgIHVpbnQgdG9rZW5zQm91Z2h0ID0gMDsKCiAgICAgICAgLy8gT25seSB0YWtpbmcgcGF5bWVudCBpbiBtdWx0aXBsZSBvZiAxIGV0aGVyLCBhcyAxIGV0aGVyID0gMSB0b2tlbgogICAgICAgIHVpbnQgZXRoZXJSZWNlaXZlZCA9IG1zZy52YWx1ZS8oMTAqKjE4KTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCB3ZSBoYXZlIGVub3VnaCB0b2tlbnMgbGVmdAogICAgICAgIHVpbnQgdG9rZW5zUmVtYWluaW5nID0gc3dlZXBzVG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIGFzc2VydCh0b2tlbnNSZW1haW5pbmcgPiAwKTsKCSAgICByZXF1aXJlKGV0aGVyUmVjZWl2ZWQgPD0gMTApOwogICAgICAgIGlmICh0b2tlbnNSZW1haW5pbmcgPj0gZXRoZXJSZWNlaXZlZCkgewogICAgICAgICAgICB0b2tlbnNCb3VnaHQgPSBldGhlclJlY2VpdmVkOwogICAgICAgICAgICB0b2tlbnNSZW1haW5pbmcgLT0gZXRoZXJSZWNlaXZlZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0b2tlbnNCb3VnaHQgPSB0b2tlbnNSZW1haW5pbmc7CiAgICAgICAgICAgIHRva2Vuc1JlbWFpbmluZyA9IDA7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCB0b2tlbnNCb3VnaHQ7IGkrKykgewogICAgICAgICAgICBkcmF3UG9vbC5wdXNoKG1zZy5zZW5kZXIpOwogICAgICAgICAgICBudW1Ub2tlbnNTb2xkKys7CiAgICAgICAgfQoKICAgICAgICB0aWNrZXRzX2JvdWdodCgiUGF5bWVudCByZWNlaXZlZDsgU3dlZXBzIHRva2VucyBzZW50IiwgdG9rZW5zQm91Z2h0KTsKCiAgICAgICAgLy8gTm8gbW9yZSB0b2tlbnMgcmVtYWluaW5nIENsb3NlIHN3ZWVwcwogICAgICAgIGlmICh0b2tlbnNSZW1haW5pbmcgPD0gMCkgewogICAgICAgICAgICBzd2VlcHNTdGF0ZSA9IFN3ZWVwc1N0YXRlcy5DTE9TRUQ7CiAgICAgICAgfQoKICAgICAgICB3aXRoZHJhd2Ftb3VudCArPSAoKHRva2Vuc0JvdWdodCoxMCoqMTgpKjQwKS8xMDA7ICAKCiAgICAgICAgaWYgKHN3ZWVwc1Rva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIHRva2Vuc0JvdWdodCkgPT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1cGRhdGVSYW5kb21OdW1iZXIodWludCBudW1CeXRlcywgdWludCBjYWxsQmFja0dhcykgcHJpdmF0ZQogICAgICAgIG9ubHlCeShvd25lcikKICAgIHsKICAgICAgICB1aW50IE4gPSBudW1CeXRlczsKICAgICAgICB1aW50IGRlbGF5ID0gMDsKICAgICAgICBvcmFjbGl6ZV9uZXdSYW5kb21EU1F1ZXJ5KGRlbGF5LCBOLCBjYWxsQmFja0dhcyk7CiAgICB9CgogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKQogICAgeyAKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvcmFjbGl6ZV9jYkFkZHJlc3MoKSkgewogICAgICAgICAgICByZXZlcnQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19yZXR1cm5Db2RlKF9xdWVyeUlkLCBfcmVzdWx0LCBfcHJvb2YpICE9IDApIHsKICAgICAgICAgICAgcmFuZG9tTnVtYmVyID0gdWludChibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByYW5kb21OdW1iZXIgPSB1aW50KGtlY2NhazI1NihfcmVzdWx0KSk7CiAgICAgICAgfQoKICAgICAgICAvLyBQcmltYXJ5IFdpbm5lciAKICAgICAgICBpZiAoc3dlZXBzU3RhdGUgPT0gU3dlZXBzU3RhdGVzLkRSQVdJTkdfV0lOTkVSKSB7CiAgICAgICAgICAgIHJlcXVpcmUobnVtVG9rZW5zU29sZCA+PSAxKTsKICAgICAgICAgICAgc3dlZXBzU3RhdGUgPSBTd2VlcHNTdGF0ZXMuRFJBV0lOR19TRUNPTkRBUllfV0lOTkVSUzsKCiAgICAgICAgICAgIHVpbnQgcmFuZCA9IHJhbmRvbU51bWJlciAlIG51bVRva2Vuc1NvbGQ7CiAgICAgICAgICAgIHZhciBlbmRJbmRleCA9IG51bVRva2Vuc1NvbGQgLSAxOwogICAgICAgICAgICBhZGRyZXNzIHByaW1hcnlXaW5uZXIgPSBkcmF3UG9vbFtyYW5kXTsKICAgICAgICAgICAgZHJhd1Bvb2xbcmFuZF0gPSBkcmF3UG9vbFtlbmRJbmRleF07CiAgICAgICAgICAgIGRlbGV0ZSBkcmF3UG9vbFtlbmRJbmRleF07CiAgICAgICAgICAgIC0tbnVtVG9rZW5zU29sZDsKCiAgICAgICAgICAgIHdpbm5lcl9hbm5vdW5jZWQocHJpbWFyeVdpbm5lciwgamFja3BvdHMucHJpbWFyeUphY2twb3QpOwoKICAgICAgICAgICAgcHJpbWFyeVdpbm5lci50cmFuc2ZlcihqYWNrcG90cy5wcmltYXJ5SmFja3BvdCk7CiAgICAgICAgfQogICAgfQoKICAgZnVuY3Rpb24gY2xvc2VPdXRTd2VlcHMoKSBwdWJsaWMgcGF5YWJsZQogICAgICAgIFN0YXRlVHJhbnNpdGlvbnMKICAgICAgICBvbmx5Qnkob3duZXIpCiAgICAgICAgYXRTdGF0ZShTd2VlcHNTdGF0ZXMuRFJBV0lOR19XSU5ORVIpCiAgICAgICAgcmV0dXJucyhib29sIHJlc3VsdCkgCiAgICB7CiAgICAgICAgY2FsY3VsYXRlSmFja3BvdHMoKTsKICAgICAgICBvcmFjbGl6ZV9zZXRQcm9vZihwcm9vZlR5cGVfTGVkZ2VyKTsKICAgICAgICB1cGRhdGVSYW5kb21OdW1iZXIoMzIsIDEwMDAwMDApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRyYXdXaW5uZXJzKHVpbnQgbnVtV2lubmVycywgdWludCBqYWNrcG90LCB1aW50IHNoaWZ0KSBwYXlhYmxlIAogICAgICAgIG9ubHlCeShvd25lcikgICAgCiAgICB7CiAgICAgICAgcmVxdWlyZShudW1XaW5uZXJzID4gMCk7CgogICAgICAgIHVpbnQgcmFuZCA9IHJhbmRvbU51bWJlciBeIHVpbnQoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSk7CgogICAgICAgIHVpbnQgd2lubmVySW5kZXg7CiAgICAgICAgYWRkcmVzc1tdIG1lbW9yeSB3aW5uZXJBZGRyZXNzZXMgPSBuZXcgYWRkcmVzc1tdKG51bVdpbm5lcnMpOwogICAgICAgIHVpbnQgYml0TWFzayA9IHVpbnQoMHgzRkZGRkYpOwogICAgICAgIHVpbnQgZW5kSW5kZXggPSBudW1Ub2tlbnNTb2xkIC0gMTsKICAgICAgICBmb3IgKHVpbnQgaiA9IDA7IGogPCBudW1XaW5uZXJzOyBqKyspIHsKICAgICAgICAgICAgd2lubmVySW5kZXggPSB1aW50KHJhbmQgJiBiaXRNYXNrKSAlIG51bVRva2Vuc1NvbGQ7CiAgICAgICAgICAgIHJhbmQgPj49IHNoaWZ0OwoKICAgICAgICAgICAgaWYgKGogPiAyNTUpIHsKICAgICAgICAgICAgICAgIHJhbmQgXj0gKHJhbmQgPDwgMTA0KTsKICAgICAgICAgICAgICAgIHJhbmQgXj0gKHJhbmQgPj4gMTM2KTsKICAgICAgICAgICAgICAgIHJhbmQgXj0gKHJhbmQgPDwgNDApOwogICAgICAgICAgICAgICAgcmFuZCA9IChyYW5kIF4gdWludChibG9jay5ibG9ja2hhc2goYmxvY2subnVtYmVyLTEpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHdpbm5lckFkZHJlc3Nlc1tqXSA9IGRyYXdQb29sW3dpbm5lckluZGV4XTsKICAgICAgICAgICAgZHJhd1Bvb2xbd2lubmVySW5kZXhdID0gZHJhd1Bvb2xbZW5kSW5kZXhdOwogICAgICAgICAgICBkZWxldGUgZHJhd1Bvb2xbZW5kSW5kZXhdOwogICAgICAgICAgICAtLWVuZEluZGV4OwogICAgICAgICAgICAtLW51bVRva2Vuc1NvbGQ7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGogPSAwOyBqIDwgbnVtV2lubmVyczsgaisrKSB7CiAgICAgICAgICAgIHdpbm5lcl9hbm5vdW5jZWQod2lubmVyQWRkcmVzc2VzW2pdLCBqYWNrcG90KTsKICAgICAgICAgICAgd2lubmVyQWRkcmVzc2VzW2pdLnRyYW5zZmVyKGphY2twb3QpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyAxMCB3aW5uZXJzIG9mIDE1LDAwMCB0b2tlbnMgb3IgLjM3NSUgb2YgdG9rZW5zIHNvbGQKICAgIGZ1bmN0aW9uIGRyYXdTZWNvbmRhcnlXaW5uZXJzKCkgcHVibGljIHBheWFibGUKICAgICAgICBvbmx5Qnkob3duZXIpCiAgICAgICAgYXRTdGF0ZShTd2VlcHNTdGF0ZXMuRFJBV0lOR19TRUNPTkRBUllfV0lOTkVSUykKICAgIHsKICAgICAgICByZXF1aXJlKG51bVRva2Vuc1NvbGQgPiAxKTsKICAgICAgICBzd2VlcHNTdGF0ZSA9IFN3ZWVwc1N0YXRlcy5EUkFXSU5HX1RFUlRJQVJZX0FfV0lOTkVSUzsKCiAgICAgICAgZHJhd1dpbm5lcnMoamFja3BvdHMubnVtU2Vjb25kYXJ5V2lubmVycywgamFja3BvdHMuc2Vjb25kSmFja1BvdCwgMjIpOwogICAgfQoKICAgIC8vIDEwMCB3aW5uZXJzIG9mIDEsNTAwIHRva2VucyBvciAuMDM3NSUgb2YgdG9rZW5zIHNvbGQKICAgIGZ1bmN0aW9uIGRyYXdUZXJ0aWFyeUFXaW5uZXJzKHVpbnQgbnVtVG9Qcm9jZXNzKSBwdWJsaWMgcGF5YWJsZQogICAgICAgIG9ubHlCeShvd25lcikKICAgICAgICBhdFN0YXRlKFN3ZWVwc1N0YXRlcy5EUkFXSU5HX1RFUlRJQVJZX0FfV0lOTkVSUykKICAgIHsKICAgICAgICByZXF1aXJlKG51bVRva2Vuc1NvbGQgPiAxKTsKICAgICAgICByZXF1aXJlKG51bVRvUHJvY2VzcyA+IDApOwoKICAgICAgICB1aW50IG51bVdpbm5lcnNUb1Byb2Nlc3MgPSBtaW4obnVtVG9Qcm9jZXNzLCBqYWNrcG90cy5udW1UZXJ0aWFyeUFXaW5uZXJzIC0gbnVtVGVydGlhcnlBV2lubmVyc1BhaWRPdXQpOwogICAgICAgIGlmIChudW1XaW5uZXJzVG9Qcm9jZXNzIDwgbnVtVG9Qcm9jZXNzKSB7CiAgICAgICAgICAgIHN3ZWVwc1N0YXRlID0gU3dlZXBzU3RhdGVzLkRSQVdJTkdfVEVSVElBUllfQl9XSU5ORVJTOwogICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgIG51bVRlcnRpYXJ5QVdpbm5lcnNQYWlkT3V0ICs9IG51bVdpbm5lcnNUb1Byb2Nlc3M7CiAgICAgICAgZHJhd1dpbm5lcnMoamFja3BvdHMubnVtVGVydGlhcnlBV2lubmVycywgamFja3BvdHMudGVydGlhcnlBSmFja1BvdCwgMSk7CiAgICB9CgogICAgLy8gMSwwMDAgd2lubmVycyBvZiAxNTAgdG9rZW5zIG9yIC4wMDM3NSUgb2YgdG9rZW5zIHNvbGQKICAgIGZ1bmN0aW9uIGRyYXdUZXJ0aWFyeUJXaW5uZXJzKHVpbnQgbnVtVG9Qcm9jZXNzKSBwdWJsaWMgcGF5YWJsZQogICAgICAgIG9ubHlCeShvd25lcikKICAgICAgICBhdFN0YXRlKFN3ZWVwc1N0YXRlcy5EUkFXSU5HX1RFUlRJQVJZX0JfV0lOTkVSUykKICAgIHsKICAgICAgICByZXF1aXJlKG51bVRva2Vuc1NvbGQgPiAxKTsKICAgICAgICByZXF1aXJlKG51bVRvUHJvY2VzcyA+IDApOwoKICAgICAgICB1aW50IG51bVdpbm5lcnNUb1Byb2Nlc3MgPSBtaW4obnVtVG9Qcm9jZXNzLCBqYWNrcG90cy5udW1UZXJ0aWFyeUJXaW5uZXJzIC0gbnVtVGVydGlhcnlCV2lubmVyc1BhaWRPdXQpOwogICAgICAgIGlmIChudW1XaW5uZXJzVG9Qcm9jZXNzIDwgbnVtVG9Qcm9jZXNzKSB7CiAgICAgICAgICAgIHN3ZWVwc1N0YXRlID0gU3dlZXBzU3RhdGVzLkRSQVdJTkdfVEVSVElBUllfQ19XSU5ORVJTOwogICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgIG51bVRlcnRpYXJ5Qldpbm5lcnNQYWlkT3V0ICs9IG51bVdpbm5lcnNUb1Byb2Nlc3M7CiAgICAgICAgZHJhd1dpbm5lcnMobnVtV2lubmVyc1RvUHJvY2VzcywgamFja3BvdHMudGVydGlhcnlCSmFja1BvdCwgMSk7CiAgICB9CgogICAgLy8gMTAsMDAwIHdpbm5lcnMgb2YgMTUgdG9rZW5zIG9yIC4wMDAzNzUlIG9mIHRva2VucyBzb2xkCiAgICBmdW5jdGlvbiBkcmF3VGVydGlhcnlDV2lubmVycyh1aW50IG51bVRvUHJvY2VzcykgcHVibGljIHBheWFibGUKICAgICAgICBvbmx5Qnkob3duZXIpCiAgICAgICAgYXRTdGF0ZShTd2VlcHNTdGF0ZXMuRFJBV0lOR19URVJUSUFSWV9DX1dJTk5FUlMpCiAgICB7CiAgICAgICAgcmVxdWlyZShudW1Ub2tlbnNTb2xkID4gMSk7CiAgICAgICAgcmVxdWlyZShudW1Ub1Byb2Nlc3MgPiAwKTsKCiAgICAgICAgdWludCBudW1XaW5uZXJzVG9Qcm9jZXNzID0gbWluKG51bVRvUHJvY2VzcywgamFja3BvdHMubnVtVGVydGlhcnlDV2lubmVycyAtIG51bVRlcnRpYXJ5Q1dpbm5lcnNQYWlkT3V0KTsKICAgICAgICBpZiAobnVtV2lubmVyc1RvUHJvY2VzcyA8IG51bVRvUHJvY2VzcykgewogICAgICAgICAgICBzd2VlcHNTdGF0ZSA9IFN3ZWVwc1N0YXRlcy5EUkFXSU5HX1RFUlRJQVJZX0RfV0lOTkVSUzsKICAgICAgICB9CgogICAgICAgIG51bVRlcnRpYXJ5Q1dpbm5lcnNQYWlkT3V0ICs9IG51bVdpbm5lcnNUb1Byb2Nlc3M7CiAgICAgICAgZHJhd1dpbm5lcnMobnVtV2lubmVyc1RvUHJvY2VzcywgamFja3BvdHMudGVydGlhcnlDSmFja1BvdCwgMSk7CiAgICB9CgogICAgLy8gMTAwLDAwMCB3aW5uZXJzIG9mIDEuNSB0b2tlbnMgb3IgLjAwMDAzNzUlIG9mIHRva2VucyBzb2xkCiAgICBmdW5jdGlvbiBkcmF3VGVydGlhcnlEV2lubmVycyh1aW50IG51bVRvUHJvY2VzcykgcHVibGljIHBheWFibGUKICAgICAgICBvbmx5Qnkob3duZXIpCiAgICAgICAgYXRTdGF0ZShTd2VlcHNTdGF0ZXMuRFJBV0lOR19URVJUSUFSWV9EX1dJTk5FUlMpCiAgICB7CiAgICAgICAgcmVxdWlyZShudW1Ub2tlbnNTb2xkID4gMSk7CiAgICAgICAgcmVxdWlyZShudW1Ub1Byb2Nlc3MgPiAwKTsKCiAgICAgICAgdWludCBudW1XaW5uZXJzVG9Qcm9jZXNzID0gbWluKG51bVRvUHJvY2VzcywgamFja3BvdHMubnVtVGVydGlhcnlEV2lubmVycyAtIG51bVRlcnRpYXJ5RFdpbm5lcnNQYWlkT3V0KTsKICAgICAgICBpZiAobnVtV2lubmVyc1RvUHJvY2VzcyA8IG51bVRvUHJvY2VzcykgewogICAgICAgICAgICBzd2VlcHNTdGF0ZSA9IFN3ZWVwc1N0YXRlcy5XSU5ORVJTX1BBSURfU1dFRVBTX0NPTVBMRVRFOwogICAgICAgIH0KICAgICAgICBudW1UZXJ0aWFyeURXaW5uZXJzUGFpZE91dCArPSBudW1XaW5uZXJzVG9Qcm9jZXNzOwogICAgICAgIGRyYXdXaW5uZXJzKG51bVdpbm5lcnNUb1Byb2Nlc3MsIGphY2twb3RzLnRlcnRpYXJ5REphY2tQb3QsIDEpOwogICAgfQogICAgCiAgICAvL2Z1bmN0aW9uIHRvIGFkZCBldGhlciB0byBjb250cmFjdAogICAgZnVuY3Rpb24gRnVuZF9Db250cmFjdCAoKSBwdWJsaWMgcGF5YWJsZSB7fQoKICAgIGZ1bmN0aW9uICgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBidXlUb2tlbnMoKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2xlYW5VcCgpIHB1YmxpYyBwYXlhYmxlCiAgICAgICAgb25seUJ5KG93bmVyKQogICAgewogICAgICAgIHJlcXVpcmUoc3dlZXBzU3RhdGUgPiBTd2VlcHNTdGF0ZXMuRFJBV0lOR19XSU5ORVIpOwogICAgICAgCiAgICAgICAgLy8gVHJhbnNmZXIgRXRoIHRvIG93bmVyIGFuZCB0ZXJtaW5hdGUgY29udHJhY3QKICAgICAgICAvLypvbmx5IGFwbGxpY2FibGUgYWZ0ZXIgU21hcnQgQ29udHJhY3QgaGFzIGRyYXduIEphY2twb3Qgd2lubmVyCiAgICAgICAgc2VsZmRlc3RydWN0KG93bmVyKTsKICAgIH0KfQ=='.
	

]
