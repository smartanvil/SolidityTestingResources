Class {
	#name : #SRT9106708eb08a6fca144bcb45f8bcd020f903c0f5,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT9106708eb08a6fca144bcb45f8bcd020f903c0f5 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLyBGaWxlOiBjb250cmFjdHMvRVJDNzIxRHJhZnQuc29sCgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2Vucwpjb250cmFjdCBFUkM3MjEgewogICAgZnVuY3Rpb24gaW1wbGVtZW50c0VSQzcyMSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IHRvdGFsKTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKTsKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAoYWRkcmVzcyBvd25lcik7CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGluZGV4ZWQgZnJvbSwgYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IGluZGV4ZWQgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBhcHByb3ZlZCwgdWludDI1NiBpbmRleGVkIHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk9mT3duZXJCeUluZGV4KGFkZHJlc3MgX293bmVyLCB1aW50MjU2IF9pbmRleCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2IHRva2VuSWQpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9GaWdodGVyQ29yZUludGVyZmFjZS5zb2wKCmNvbnRyYWN0IEZpZ2h0ZXJDb3JlSW50ZXJmYWNlIGlzIEVSQzcyMSB7CiAgICBmdW5jdGlvbiBnZXRGaWdodGVyKHVpbnQyNTYgX2lkKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICgKICAgICAgICB1aW50MjU2IHByaXplQ29vbGRvd25FbmRUaW1lLAogICAgICAgIHVpbnQyNTYgYmF0dGxlQ29vbGRvd25FbmRUaW1lLAogICAgICAgIHVpbnQyNTYgcHJpemVDb29sZG93bkluZGV4LAogICAgICAgIHVpbnQyNTYgYmF0dGxlc0ZvdWdodCwKICAgICAgICB1aW50MjU2IGJhdHRsZXNXb24sCiAgICAgICAgdWludDI1NiBnZW5lcmF0aW9uLAogICAgICAgIHVpbnQyNTYgZ2VuZXMsCiAgICAgICAgdWludDI1NiBkZXh0ZXJpdHksCiAgICAgICAgdWludDI1NiBzdHJlbmd0aCwKICAgICAgICB1aW50MjU2IHZpdGFsaXR5LAogICAgICAgIHVpbnQyNTYgbHVjaywKICAgICAgICB1aW50MjU2IGV4cGVyaWVuY2UKICAgICk7CiAgICAKICAgIGZ1bmN0aW9uIGNyZWF0ZVByaXplRmlnaHRlcigKICAgICAgICB1aW50MTYgX2dlbmVyYXRpb24sCiAgICAgICAgdWludDI1NiBfZ2VuZXMsCiAgICAgICAgdWludDggX2RleHRlcml0eSwKICAgICAgICB1aW50OCBfc3RyZW5ndGgsCiAgICAgICAgdWludDggX3ZpdGFsaXR5LAogICAgICAgIHVpbnQ4IF9sdWNrLAogICAgICAgIGFkZHJlc3MgX293bmVyCiAgICApIHB1YmxpYzsKICAgIAogICAgZnVuY3Rpb24gdXBkYXRlRmlnaHRlcigKICAgICAgICB1aW50MjU2IF9maWdodGVySWQsCiAgICAgICAgdWludDggX2RleHRlcml0eSwKICAgICAgICB1aW50OCBfc3RyZW5ndGgsCiAgICAgICAgdWludDggX3ZpdGFsaXR5LAogICAgICAgIHVpbnQ4IF9sdWNrLAogICAgICAgIHVpbnQzMiBfZXhwZXJpZW5jZSwKICAgICAgICB1aW50NjQgX3ByaXplQ29vbGRvd25FbmRUaW1lLAogICAgICAgIHVpbnQxNiBfcHJpemVDb29sZG93bkluZGV4LAogICAgICAgIHVpbnQ2NCBfYmF0dGxlQ29vbGRvd25FbmRUaW1lLAogICAgICAgIHVpbnQxNiBfYmF0dGxlc0ZvdWdodCwKICAgICAgICB1aW50MTYgX2JhdHRsZXNXb24KICAgICkgcHVibGljOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUZpZ2h0ZXJCYXR0bGVTdGF0cygKICAgICAgICB1aW50MjU2IF9maWdodGVySWQsCiAgICAgICAgdWludDY0IF9wcml6ZUNvb2xkb3duRW5kVGltZSwKICAgICAgICB1aW50MTYgX3ByaXplQ29vbGRvd25JbmRleCwKICAgICAgICB1aW50NjQgX2JhdHRsZUNvb2xkb3duRW5kVGltZSwKICAgICAgICB1aW50MTYgX2JhdHRsZXNGb3VnaHQsCiAgICAgICAgdWludDE2IF9iYXR0bGVzV29uCiAgICApIHB1YmxpYzsKCiAgICBmdW5jdGlvbiB1cGRhdGVEZXh0ZXJpdHkodWludDI1NiBfZmlnaHRlcklkLCB1aW50OCBfZGV4dGVyaXR5KSBwdWJsaWM7CiAgICBmdW5jdGlvbiB1cGRhdGVTdHJlbmd0aCh1aW50MjU2IF9maWdodGVySWQsIHVpbnQ4IF9zdHJlbmd0aCkgcHVibGljOwogICAgZnVuY3Rpb24gdXBkYXRlVml0YWxpdHkodWludDI1NiBfZmlnaHRlcklkLCB1aW50OCBfdml0YWxpdHkpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHVwZGF0ZUx1Y2sodWludDI1NiBfZmlnaHRlcklkLCB1aW50OCBfbHVjaykgcHVibGljOwogICAgZnVuY3Rpb24gdXBkYXRlRXhwZXJpZW5jZSh1aW50MjU2IF9maWdodGVySWQsIHVpbnQzMiBfZXhwZXJpZW5jZSkgcHVibGljOwp9CgovLyBGaWxlOiBjb250cmFjdHMvQmF0dGxlL0JhdHRsZURlY2lkZXJJbnRlcmZhY2Uuc29sCgpjb250cmFjdCBCYXR0bGVEZWNpZGVySW50ZXJmYWNlIHsKICAgIGZ1bmN0aW9uIGlzQmF0dGxlRGVjaWRlcigpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwogICAgZnVuY3Rpb24gZGV0ZXJtaW5lV2lubmVyKHVpbnQyNTZbN11bXSB0ZWFtQXR0YWNrZXIsIHVpbnQyNTZbN11bXSB0ZWFtRGVmZW5kZXIpIHB1YmxpYyByZXR1cm5zICgKICAgICAgICBib29sIGF0dGFja2VyV29uLAogICAgICAgIHVpbnQyNTYgeHBGb3JBdHRhY2tlciwKICAgICAgICB1aW50MjU2IHhwRm9yRGVmZW5kZXIKICAgICk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9Pd25hYmxlLnNvbAoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgb3duZXIgPSBtc2cuc2VuZGVyOwogIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShuZXdPd25lciAhPSBhZGRyZXNzKDApKTsKICAgIE93bmVyc2hpcFRyYW5zZmVycmVkKG93bmVyLCBuZXdPd25lcik7CiAgICBvd25lciA9IG5ld093bmVyOwogIH0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9QYXVzYWJsZS5zb2wKCi8qKgogKiBAdGl0bGUgUGF1c2FibGUKICogQGRldiBCYXNlIGNvbnRyYWN0IHdoaWNoIGFsbG93cyBjaGlsZHJlbiB0byBpbXBsZW1lbnQgYW4gZW1lcmdlbmN5IHN0b3AgbWVjaGFuaXNtLgogKi8KY29udHJhY3QgUGF1c2FibGUgaXMgT3duYWJsZSB7CiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKCk7CgogIGJvb2wgcHVibGljIHBhdXNlZCA9IGZhbHNlOwoKCiAgLyoqCiAgICogQGRldiBNb2RpZmllciB0byBtYWtlIGEgZnVuY3Rpb24gY2FsbGFibGUgb25seSB3aGVuIHRoZSBjb250cmFjdCBpcyBub3QgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgcGF1c2VkLgogICAqLwogIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICByZXF1aXJlKHBhdXNlZCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHBhdXNlLCB0cmlnZ2VycyBzdG9wcGVkIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCBwdWJsaWMgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIFBhdXNlKCk7CiAgfQoKICAvKioKICAgKiBAZGV2IGNhbGxlZCBieSB0aGUgb3duZXIgdG8gdW5wYXVzZSwgcmV0dXJucyB0byBub3JtYWwgc3RhdGUKICAgKi8KICBmdW5jdGlvbiB1bnBhdXNlKCkgb25seU93bmVyIHdoZW5QYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IGZhbHNlOwogICAgVW5wYXVzZSgpOwogIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0JhdHRsZS9HZW5lU2NpZW5jZUludGVyZmFjZS5zb2wKCi8vLyBAdGl0bGUgZGVmaW5lZCB0aGUgaW50ZXJmYWNlIHRoYXQgd2lsbCBiZSByZWZlcmVuY2VkIGluIG1haW4gRmlnaHRlciBjb250cmFjdApjb250cmFjdCBHZW5lU2NpZW5jZUludGVyZmFjZSB7CiAgICAvLy8gQGRldiBzaW1wbHkgYSBib29sZWFuIHRvIGluZGljYXRlIHRoaXMgaXMgdGhlIGNvbnRyYWN0IHdlIGV4cGVjdCB0byBiZQogICAgZnVuY3Rpb24gaXNHZW5lU2NpZW5jZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJvb2wpOwoKICAgIC8vLyBAZGV2IGdpdmVuIGdlbmVzIG9mIGZpZ2h0ZXIgMSAmIDIsIHJldHVybiBhIGdlbmV0aWMgY29tYmluYXRpb24gLSBtYXkgaGF2ZSBhIHJhbmRvbSBmYWN0b3IKICAgIC8vLyBAcGFyYW0gZ2VuZXMxIGdlbmVzIG9mIGZpZ2h0ZXIxCiAgICAvLy8gQHBhcmFtIGdlbmVzMiBnZW5lcyBvZiBmaWdodGVyMQogICAgLy8vIEByZXR1cm4gdGhlIGdlbmVzIHRoYXQgYXJlIHN1cHBvc2VkIHRvIGJlIHBhc3NlZCBkb3duIHRoZSBuZXcgZmlnaHRlcgogICAgZnVuY3Rpb24gbWl4R2VuZXModWludDI1NiBnZW5lczEsIHVpbnQyNTYgZ2VuZXMyKSBwdWJsaWMgcmV0dXJucyAodWludDI1Nik7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9CYXR0bGUvQmF0dGxlQmFzZS5zb2wKCmNvbnRyYWN0IEJhdHRsZUJhc2UgaXMgT3duYWJsZSwgUGF1c2FibGUgewogICAgZXZlbnQgVGVhbUNyZWF0ZWQodWludDI1NiBpbmRleGVkIHRlYW1JZCwgdWludDI1NltdIGZpZ2h0ZXJJZHMpOwogICAgZXZlbnQgVGVhbURlbGV0ZWQodWludDI1NiBpbmRleGVkIHRlYW1JZCwgdWludDI1NltdIGZpZ2h0ZXJJZHMpOwogICAgZXZlbnQgQmF0dGxlUmVzdWx0KGFkZHJlc3MgaW5kZXhlZCB3aW5uZXJBZGRyZXNzLCBhZGRyZXNzIGluZGV4ZWQgbG9zZXJBZGRyZXNzLCB1aW50MjU2W10gYXR0YWNrZXJGaWdodGVySWRzLCB1aW50MjU2W10gZGVmZW5kZXJGaWdodGVySWRzLCBib29sIGF0dGFja2VyV29uLCB1aW50MTYgcHJpemVGaWdodGVyR2VuZXJhdGlvbiwgdWludDI1NiBwcml6ZUZpZ2h0ZXJHZW5lcywgdWludDMyIGF0dGFja2VyWHBHYWluZWQsIHVpbnQzMiBkZWZlbmRlclhwR2FpbmVkKTsKICAgIAogICAgc3RydWN0IFRlYW0gewogICAgICAgIGFkZHJlc3Mgb3duZXI7CiAgICAgICAgdWludDI1NltdIGZpZ2h0ZXJJZHM7CiAgICB9CgogICAgc3RydWN0IFJhY2VCYXNlU3RhdHMgewogICAgICAgIHVpbnQ4IHN0cmVuZ3RoOwogICAgICAgIHVpbnQ4IGRleHRlcml0eTsKICAgICAgICB1aW50OCB2aXRhbGl0eTsKICAgIH0KICAgIAogICAgVGVhbVtdIHB1YmxpYyB0ZWFtczsKICAgIC8vIGluZGV4ID0+IGJhc2Ugc3RhdHMgKHdoZXJlIGluZGV4IHJlcHJlc2VudHMgdGhlIHJhY2UpCiAgICBSYWNlQmFzZVN0YXRzW10gcHVibGljIHJhY2VCYXNlU3RhdHM7CiAgICAKICAgIHVpbnQyNTYgaW50ZXJuYWwgcmFuZG9tQ291bnRlciA9IDA7CiAgICAKICAgIEZpZ2h0ZXJDb3JlSW50ZXJmYWNlIHB1YmxpYyBmaWdodGVyQ29yZTsKICAgIEdlbmVTY2llbmNlSW50ZXJmYWNlIHB1YmxpYyBnZW5lU2NpZW5jZTsKICAgIEJhdHRsZURlY2lkZXJJbnRlcmZhY2UgcHVibGljIGJhdHRsZURlY2lkZXI7CiAgICAKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gdWludDI1NikgcHVibGljIGZpZ2h0ZXJJbmRleFRvVGVhbTsKICAgIG1hcHBpbmcgKHVpbnQyNTYgPT4gYm9vbCkgcHVibGljIHRlYW1JbmRleFRvRXhpc3Q7CiAgICAvLyBhbiBhcnJheSBvZiBkZWxldGVkIHRlYW1JZHMgb3duZWQgYnkgZWFjaCBhZGRyZXNzIHNvIHRoYXQgd2UgY2FuIHJldXNlIHRoZXNlIGFnYWluCiAgICAvLyBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTZbXSkgcHVibGljIGFkZHJlc3NUb0RlbGV0ZWRUZWFtczsKICAgIAogICAgLy8gYW4gYXJyYXkgb2YgZGVsZXRlZCB0ZWFtcyB3ZSBjYW4gcmV1c2UgbGF0ZXIKICAgIHVpbnQyNTZbXSBwdWJsaWMgZGVsZXRlZFRlYW1JZHM7CiAgICAKICAgIHVpbnQyNTYgcHVibGljIG1heFBlclRlYW0gPSA1OwoKICAgIHVpbnQ4W10gcHVibGljIGdlbkJhc2VTdGF0cyA9IFsKICAgICAgICAxNiwgLy8gZ2VuIDAKICAgICAgICAxMiwgLy8gZ2VuIDEKICAgICAgICAxMCwgLy8gZ2VuIDIKICAgICAgICA4LCAvLyBnZW4gMwogICAgICAgIDcsIC8vIGdlbiA0CiAgICAgICAgNiwgLy8gZ2VuIDUKICAgICAgICA1LCAvLyBnZW4gNgogICAgICAgIDQsIC8vIGdlbiA3CiAgICAgICAgMywgLy8gZ2VuIDgKICAgICAgICAyLCAvLyBnZW4gOQogICAgICAgIDEgLy8gZ2VuIDEwKwogICAgXTsKICAgIAogICAgLy8gbW9kaWZpZXIgb3duc0ZpZ2h0ZXJzKHVpbnQyNTZbXSBfZmlnaHRlcklkcykgewogICAgLy8gICAgIHVpbnQgbGVuID0gX2ZpZ2h0ZXJJZHMubGVuZ3RoOwogICAgLy8gICAgIGZvciAodWludCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAvLyAgICAgICByZXF1aXJlKGZpZ2h0ZXJDb3JlLm93bmVyT2YoX2ZpZ2h0ZXJJZHNbaV0pID09IG1zZy5zZW5kZXIpOwogICAgLy8gICAgIH0KICAgIC8vICAgICBfOwogICAgLy8gfQogICAgCiAgICBtb2RpZmllciBvbmx5VGVhbU93bmVyKHVpbnQyNTYgX3RlYW1JZCkgewogICAgICAgIHJlcXVpcmUodGVhbXNbX3RlYW1JZF0ub3duZXIgPT0gbXNnLnNlbmRlcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5RXhpc3RpbmdUZWFtKHVpbnQyNTYgX3RlYW1JZCkgewogICAgICAgIHJlcXVpcmUodGVhbUluZGV4VG9FeGlzdFtfdGVhbUlkXSA9PSB0cnVlKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIHRlYW1FeGlzdHModWludDI1NiBfdGVhbUlkKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRlYW1JbmRleFRvRXhpc3RbX3RlYW1JZF0gPT0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiByYW5kb20gbnVtYmVyIGZyb20gMCB0byAoX21vZHVsdXMgLSAxKQogICAgZnVuY3Rpb24gcmFuZE1vZCh1aW50MjU2IF9yYW5kQ291bnRlciwgdWludCBfbW9kdWx1cykgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KSB7IAogICAgICAgIHJldHVybiB1aW50KGtlY2NhazI1Nihub3csIG1zZy5zZW5kZXIsIF9yYW5kQ291bnRlcikpICUgX21vZHVsdXM7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RGVsZXRlZFRlYW1zKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NltdKSB7CiAgICAgICAgLy8gcmV0dXJuIGFkZHJlc3NUb0RlbGV0ZWRUZWFtc1tfYWRkcmVzc107CiAgICAgICAgcmV0dXJuIGRlbGV0ZWRUZWFtSWRzOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFJhY2VCYXNlU3RhdHModWludDI1NiBfaWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIHVpbnQyNTYgc3RyZW5ndGgsCiAgICAgICAgdWludDI1NiBkZXh0ZXJpdHksCiAgICAgICAgdWludDI1NiB2aXRhbGl0eQogICAgKSB7CiAgICAgICAgUmFjZUJhc2VTdGF0cyBzdG9yYWdlIHJhY2UgPSByYWNlQmFzZVN0YXRzW19pZF07CiAgICAgICAgCiAgICAgICAgc3RyZW5ndGggPSByYWNlLnN0cmVuZ3RoOwogICAgICAgIGRleHRlcml0eSA9IHJhY2UuZGV4dGVyaXR5OwogICAgICAgIHZpdGFsaXR5ID0gcmFjZS52aXRhbGl0eTsKICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL0JhdHRsZS9CYXR0bGVBZG1pbi5zb2wKCmNvbnRyYWN0IEJhdHRsZUFkbWluIGlzIEJhdHRsZUJhc2UgewogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwoKICAgIGFkZHJlc3MgcHVibGljIG5ld0NvbnRyYWN0QWRkcmVzczsKICAgIAogICAgLy8gQW4gYXBwcm94aW1hdGlvbiBvZiBjdXJyZW50bHkgaG93IG1hbnkgc2Vjb25kcyBhcmUgaW4gYmV0d2VlbiBibG9ja3MuCiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRzUGVyQmxvY2sgPSAxNTsKCiAgICB1aW50MzJbN10gcHVibGljIHByaXplQ29vbGRvd25zID0gWwogICAgICAgIHVpbnQzMigxIG1pbnV0ZXMpLAogICAgICAgIHVpbnQzMigzMCBtaW51dGVzKSwKICAgICAgICB1aW50MzIoMiBob3VycyksCiAgICAgICAgdWludDMyKDYgaG91cnMpLAogICAgICAgIHVpbnQzMigxMiBob3VycyksCiAgICAgICAgdWludDMyKDEgZGF5cyksCiAgICAgICAgdWludDMyKDMgZGF5cykKICAgIF07CgogICAgZnVuY3Rpb24gc2V0RmlnaHRlckNvcmVBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIF9zZXRGaWdodGVyQ29yZUFkZHJlc3MoX2FkZHJlc3MpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXRGaWdodGVyQ29yZUFkZHJlc3MoYWRkcmVzcyBfYWRkcmVzcykgaW50ZXJuYWwgewogICAgICAgIEZpZ2h0ZXJDb3JlSW50ZXJmYWNlIGNhbmRpZGF0ZUNvbnRyYWN0ID0gRmlnaHRlckNvcmVJbnRlcmZhY2UoX2FkZHJlc3MpOwoKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmltcGxlbWVudHNFUkM3MjEoKSk7CgogICAgICAgIGZpZ2h0ZXJDb3JlID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHNldEdlbmVTY2llbmNlQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBfc2V0R2VuZVNjaWVuY2VBZGRyZXNzKF9hZGRyZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfc2V0R2VuZVNjaWVuY2VBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIHsKICAgICAgICBHZW5lU2NpZW5jZUludGVyZmFjZSBjYW5kaWRhdGVDb250cmFjdCA9IEdlbmVTY2llbmNlSW50ZXJmYWNlKF9hZGRyZXNzKTsKCiAgICAgICAgcmVxdWlyZShjYW5kaWRhdGVDb250cmFjdC5pc0dlbmVTY2llbmNlKCkpOwoKICAgICAgICBnZW5lU2NpZW5jZSA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEJhdHRsZURlY2lkZXJBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIF9zZXRCYXR0bGVEZWNpZGVyQWRkcmVzcyhfYWRkcmVzcyk7CiAgICB9CgogICAgZnVuY3Rpb24gX3NldEJhdHRsZURlY2lkZXJBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGludGVybmFsIHsKICAgICAgICBCYXR0bGVEZWNpZGVySW50ZXJmYWNlIGRlY2lkZXJDYW5kaWRhdGVDb250cmFjdCA9IEJhdHRsZURlY2lkZXJJbnRlcmZhY2UoX2FkZHJlc3MpOwoKICAgICAgICByZXF1aXJlKGRlY2lkZXJDYW5kaWRhdGVDb250cmFjdC5pc0JhdHRsZURlY2lkZXIoKSk7CgogICAgICAgIGJhdHRsZURlY2lkZXIgPSBkZWNpZGVyQ2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkUmFjZSh1aW50OCBfc3RyZW5ndGgsIHVpbnQ4IF9kZXh0ZXJpdHksIHVpbnQ4IF92aXRhbGl0eSkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmFjZUJhc2VTdGF0cy5wdXNoKFJhY2VCYXNlU3RhdHMoewogICAgICAgICAgICBzdHJlbmd0aDogX3N0cmVuZ3RoLAogICAgICAgICAgICBkZXh0ZXJpdHk6IF9kZXh0ZXJpdHksCiAgICAgICAgICAgIHZpdGFsaXR5OiBfdml0YWxpdHkKICAgICAgICB9KSk7CiAgICB9CgogICAgLy8gaW4gY2FzZSB3ZSBldmVyIGFkZCBhIGJhZCByYWNlIHR5cGUKICAgIGZ1bmN0aW9uIHJlbW92ZUxhc3RSYWNlKCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgLy8gZG9uJ3QgYWxsb3cgdGhlIGZpcnN0IDQgcmFjZXMgdG8gYmUgcmVtb3ZlZAogICAgICAgIHJlcXVpcmUocmFjZUJhc2VTdGF0cy5sZW5ndGggPiA0KTsKICAgICAgICAKICAgICAgICBkZWxldGUgcmFjZUJhc2VTdGF0c1tyYWNlQmFzZVN0YXRzLmxlbmd0aCAtIDFdOwogICAgfQoKICAgIC8vLyBAZGV2IFVzZWQgdG8gbWFyayB0aGUgc21hcnQgY29udHJhY3QgYXMgdXBncmFkZWQsIGluIGNhc2UgdGhlcmUgaXMgYSBzZXJpb3VzCiAgICAvLy8gIGJyZWFraW5nIGJ1Zy4gVGhpcyBtZXRob2QgZG9lcyBub3RoaW5nIGJ1dCBrZWVwIHRyYWNrIG9mIHRoZSBuZXcgY29udHJhY3QgYW5kCiAgICAvLy8gIGVtaXQgYSBtZXNzYWdlIGluZGljYXRpbmcgdGhhdCB0aGUgbmV3IGFkZHJlc3MgaXMgc2V0LiBJdCdzIHVwIHRvIGNsaWVudHMgb2YgdGhpcwogICAgLy8vICBjb250cmFjdCB0byB1cGRhdGUgdG8gdGhlIG5ldyBjb250cmFjdCBhZGRyZXNzIGluIHRoYXQgY2FzZS4KICAgIC8vLyBAcGFyYW0gX3YyQWRkcmVzcyBuZXcgYWRkcmVzcwogICAgZnVuY3Rpb24gc2V0TmV3QWRkcmVzcyhhZGRyZXNzIF92MkFkZHJlc3MpIHB1YmxpYyBvbmx5T3duZXIgd2hlblBhdXNlZCB7CiAgICAgICAgbmV3Q29udHJhY3RBZGRyZXNzID0gX3YyQWRkcmVzczsKICAgICAgICAKICAgICAgICBDb250cmFjdFVwZ3JhZGUoX3YyQWRkcmVzcyk7CiAgICB9CgogICAgLy8gT3duZXIgY2FuIGZpeCBob3cgbWFueSBzZWNvbmRzIHBlciBibG9ja3MgYXJlIGN1cnJlbnRseSBvYnNlcnZlZC4KICAgIGZ1bmN0aW9uIHNldFNlY29uZHNQZXJCbG9jayh1aW50MjU2IF9zZWNzKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoX3NlY3MgPCBwcml6ZUNvb2xkb3duc1swXSk7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gX3NlY3M7CiAgICB9Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9CYXR0bGUvQmF0dGxlUHJpemUuc29sCgpjb250cmFjdCBCYXR0bGVQcml6ZSBpcyBCYXR0bGVBZG1pbiB7CiAgICAvLyBhcnJheSBpbmRleCBpcyBsZXZlbCwgdmFsdWUgaXMgZXhwZXJpZW5jZSB0byByZWFjaCB0aGF0IGxldmVsCiAgICB1aW50MzJbNTBdIHB1YmxpYyBzdGF0cyA9IFsKICAgICAgICAwLAogICAgICAgIDEwMCwKICAgICAgICAzMDAsCiAgICAgICAgNjAwLAogICAgICAgIDEwMDAsCiAgICAgICAgMTUwMCwKICAgICAgICAyMTAwLAogICAgICAgIDI4MDAsCiAgICAgICAgMzYwMCwKICAgICAgICA0NTAwLAogICAgICAgIDU1MDAsCiAgICAgICAgNjYwMCwKICAgICAgICA3ODAwLAogICAgICAgIDkxMDAsCiAgICAgICAgMTA1MDAsCiAgICAgICAgMTIwMDAsCiAgICAgICAgMTM2MDAsCiAgICAgICAgMTUzMDAsCiAgICAgICAgMTcxMDAsCiAgICAgICAgMTkwMDAsCiAgICAgICAgMjEwMDAsCiAgICAgICAgMjMxMDAsCiAgICAgICAgMjUzMDAsCiAgICAgICAgMjc2MDAsCiAgICAgICAgMzAwMDAsCiAgICAgICAgMzI1MDAsCiAgICAgICAgMzUxMDAsCiAgICAgICAgMzc4MDAsCiAgICAgICAgNDA2MDAsCiAgICAgICAgNDM1MDAsCiAgICAgICAgNDY1MDAsCiAgICAgICAgNDk2MDAsCiAgICAgICAgNTI4MDAsCiAgICAgICAgNTYxMDAsCiAgICAgICAgNTk1MDAsCiAgICAgICAgNjMwMDAsCiAgICAgICAgNjY2MDAsCiAgICAgICAgNzAzMDAsCiAgICAgICAgNzQxMDAsCiAgICAgICAgNzgwMDAsCiAgICAgICAgODIwMDAsCiAgICAgICAgODYxMDAsCiAgICAgICAgOTAzMDAsCiAgICAgICAgOTQ2MDAsCiAgICAgICAgOTkwMDAsCiAgICAgICAgMTAzNTAwLAogICAgICAgIDEwODEwMCwKICAgICAgICAxMTI4MDAsCiAgICAgICAgMTE3NjAwLAogICAgICAgIDEyMjUwMAogICAgXTsKCiAgICB1aW50OFsxMV0gcHVibGljIGV4dHJhU3RhdHNGb3JHZW4gPSBbCiAgICAgICAgMTYsIC8vIDAgLSBoZXJlIGZvciBlYXNlIG9mIHVzZSBldmVuIHRob3VnaCB3ZSBuZXZlciBjcmVhdGUgZ2VuMHMKICAgICAgICAxMiwgLy8gMQogICAgICAgIDEwLCAvLyAyCiAgICAgICAgOCwgLy8gMwogICAgICAgIDcsIC8vIDQKICAgICAgICA2LCAvLyA1CiAgICAgICAgNSwgLy8gNgogICAgICAgIDQsIC8vIDcKICAgICAgICAzLCAvLyA4CiAgICAgICAgMiwgLy8gOQogICAgICAgIDEgLy8gMTArCiAgICBdOwoKICAgIC8vIHRoZSBudW1iZXIgb2YgYmF0dGxlcyBiZWZvcmUgYSBkZWxheSB0byBnYWluIG5ldyBleHAga2lja3MgaW4KICAgIHVpbnQ4IHB1YmxpYyBiYXR0bGVzVGlsbEJhdHRsZUNvb2xkb3duID0gNTsKICAgIC8vIHRoZSBudW1iZXIgb2YgYmF0dGxlcyBiZWZvcmUgYSBkZWxheSB0byBnYWluIG5ldyBleHAga2lja3MgaW4KICAgIHVpbnQzMiBwdWJsaWMgZXhwZXJpZW5jZURlbGF5ID0gdWludDMyKDYgaG91cnMpOwoKICAgIC8vIEx1Y2sgaXMgZGV0ZXJtaW5lZCBhcyBmb2xsb3dzOgogICAgLy8gUmFuayAwICg1IHN0YXJzKSAtIHJhbmRvbSBiZXR3ZWVuIDR+NQogICAgLy8gUmFuayAxLTIgKDQgc3RhcnMpIC0gcmFuZG9tIGJldHdlZW4gMn40CiAgICAvLyBSYW5rIDMtOCAoMyBzdGFycykgLSByYW5kb20gYmV0d2VlbiAyfjMKICAgIC8vIFJhbmsgOS0xNSAoMiBzdGFycykgLSByYW5kb20gYmV0d2VlbiAxfjMKICAgIC8vIFJhbmsgMTYrICgxIHN0YXIpIC0gcmFuZG9tIGJldHdlZW4gMX4yCiAgICBmdW5jdGlvbiBnZW5Ub0x1Y2sodWludDI1NiBfZ2VuLCB1aW50MjU2IF9yYW5kKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgIGlmIChfZ2VuID49IDEgfHwgX2dlbiA8PSAyKSB7CiAgICAgICAgICAgIHJldHVybiAyICsgdWludDgoX3JhbmQpICUgMzsgLy8gMiB0byA0CiAgICAgICAgfSBlbHNlIGlmIChfZ2VuID49IDMgfHwgX2dlbiA8PSA4KSB7CiAgICAgICAgICAgIHJldHVybiAyICsgdWludDgoX3JhbmQpICUgMjsgLy8gMiB0byAzCiAgICAgICAgfSAgZWxzZSBpZiAoX2dlbiA+PSA5IHx8IF9nZW4gPD0gMTUpIHsKICAgICAgICAgICAgcmV0dXJuIDEgKyB1aW50OChfcmFuZCkgJSAzOyAvLyAxIHRvIDMKICAgICAgICB9IGVsc2UgeyAvLyAxNisKICAgICAgICAgICAgcmV0dXJuIDEgKyB1aW50OChfcmFuZCkgJSAyOyAvLyAxIHRvIDIKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmFjZVRvQmFzZVN0YXRzKHVpbnQgX3JhY2UpIHB1YmxpYyB2aWV3IHJldHVybnMgKAogICAgICAgIHVpbnQ4IHN0cmVuZ3RoLAogICAgICAgIHVpbnQ4IGRleHRlcml0eSwKICAgICAgICB1aW50OCB2aXRhbGl0eQogICAgKSB7CiAgICAgICAgLy8gaW4gY2FzZSB3ZSBldmVyIGhhdmUgYW4gdW5rbm93biByYWNlIGR1ZSB0byBuZXcgcmFjZXMgYWRkZWQKICAgICAgICBpZiAoX3JhY2UgPj0gcmFjZUJhc2VTdGF0cy5sZW5ndGgpIHsKICAgICAgICAgICAgX3JhY2UgPSAwOwogICAgICAgIH0KCiAgICAgICAgUmFjZUJhc2VTdGF0cyBtZW1vcnkgcmFjZVN0YXRzID0gcmFjZUJhc2VTdGF0c1tfcmFjZV07CgogICAgICAgIHN0cmVuZ3RoID0gcmFjZVN0YXRzLnN0cmVuZ3RoOwogICAgICAgIGRleHRlcml0eSA9IHJhY2VTdGF0cy5kZXh0ZXJpdHk7CiAgICAgICAgdml0YWxpdHkgPSByYWNlU3RhdHMudml0YWxpdHk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2VuVG9FeHRyYVN0YXRzKHVpbnQyNTYgX2dlbiwgdWludDI1NiBfcmFuZCkgcHVibGljIHZpZXcgcmV0dXJucyAoCiAgICAgICAgdWludDggZXh0cmFTdHJlbmd0aCwKICAgICAgICB1aW50OCBleHRyYURleHRlcml0eSwKICAgICAgICB1aW50OCBleHRyYVZpdGFsaXR5CiAgICApIHsKICAgICAgICAvLyBpbiBjYXNlIHdlIGV2ZXIgaGF2ZSBhbiB1bmtub3duIHJhY2UgZHVlIHRvIG5ldyByYWNlcyBhZGRlZAogICAgICAgIGlmIChfZ2VuID49IDEwKSB7CiAgICAgICAgICAgIF9nZW4gPSAxMDsKICAgICAgICB9CgogICAgICAgIHVpbnQ4IGV4dHJhU3RhdHMgPSBleHRyYVN0YXRzRm9yR2VuW19nZW5dOwoKICAgICAgICB1aW50MjU2IHJhbmQxID0gX3JhbmQgJiAweGZmOwogICAgICAgIHVpbnQyNTYgcmFuZDIgPSBfcmFuZCA+PiAxNiAmIDB4ZmY7CiAgICAgICAgdWludDI1NiByYW5kMyA9IF9yYW5kID4+IDE2ID4+IDE2ICYgMHhmZjsKCiAgICAgICAgdWludDI1NiBzdW0gPSByYW5kMSArIHJhbmQyICsgcmFuZDM7CgogICAgICAgIGV4dHJhU3RyZW5ndGggPSB1aW50OCgoZXh0cmFTdGF0cyAqIHJhbmQxKSAvIHN1bSk7CiAgICAgICAgZXh0cmFEZXh0ZXJpdHkgPSB1aW50OCgoZXh0cmFTdGF0cyAqIHJhbmQyKSAvIHN1bSk7CiAgICAgICAgZXh0cmFWaXRhbGl0eSA9IHVpbnQ4KChleHRyYVN0YXRzICogcmFuZDMpIC8gc3VtKTsKCiAgICAgICAgdWludDggcmVtYWluZGVyID0gZXh0cmFTdGF0cyAtIChleHRyYVN0cmVuZ3RoICsgZXh0cmFEZXh0ZXJpdHkgKyBleHRyYVZpdGFsaXR5KTsKCiAgICAgICAgaWYgKHJhbmQxID4gcmFuZDIgJiYgcmFuZDEgPiByYW5kMykgewogICAgICAgICAgICBleHRyYVN0cmVuZ3RoICs9IHJlbWFpbmRlcjsKICAgICAgICB9IGVsc2UgaWYgKHJhbmQyID4gcmFuZDMpIHsKICAgICAgICAgICAgZXh0cmFEZXh0ZXJpdHkgKz0gcmVtYWluZGVyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4dHJhVml0YWxpdHkgKz0gcmVtYWluZGVyOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBfZ2V0U3RyZW5ndGhEZXh0ZXJpdHlWaXRhbGl0eSh1aW50MjU2IF9yYWNlLCB1aW50MjU2IF9nZW5lcmF0aW9uLCB1aW50MjU2IF9yYW5kKSBwdWJsaWMgdmlldyByZXR1cm5zICgKICAgICAgICB1aW50MjU2IHN0cmVuZ3RoLAogICAgICAgIHVpbnQyNTYgZGV4dGVyaXR5LAogICAgICAgIHVpbnQyNTYgdml0YWxpdHkKICAgICkgewogICAgICAgIHVpbnQ4IGJhc2VTdHJlbmd0aDsKICAgICAgICB1aW50OCBiYXNlRGV4dGVyaXR5OwogICAgICAgIHVpbnQ4IGJhc2VWaXRhbGl0eTsKICAgICAgICB1aW50OCBleHRyYVN0cmVuZ3RoOwogICAgICAgIHVpbnQ4IGV4dHJhRGV4dGVyaXR5OwogICAgICAgIHVpbnQ4IGV4dHJhVml0YWxpdHk7CgogICAgICAgIChiYXNlU3RyZW5ndGgsIGJhc2VEZXh0ZXJpdHksIGJhc2VWaXRhbGl0eSkgPSByYWNlVG9CYXNlU3RhdHMoX3JhY2UpOwogICAgICAgIChleHRyYVN0cmVuZ3RoLCBleHRyYURleHRlcml0eSwgZXh0cmFWaXRhbGl0eSkgPSBnZW5Ub0V4dHJhU3RhdHMoX2dlbmVyYXRpb24sIF9yYW5kKTsKCiAgICAgICAgc3RyZW5ndGggPSBiYXNlU3RyZW5ndGggKyBleHRyYVN0cmVuZ3RoOwogICAgICAgIGRleHRlcml0eSA9IGJhc2VEZXh0ZXJpdHkgKyBleHRyYURleHRlcml0eTsKICAgICAgICB2aXRhbGl0eSA9IGJhc2VWaXRhbGl0eSArIGV4dHJhVml0YWxpdHk7CiAgICB9CgogICAgLy8gd2UgcmV0dXJuIGFuIGFycmF5IGhlcmUsIGJlY2F1c2Ugd2UgaGFkIGFuIGlzc3VlIG9mIHRvbyBtYW55IGxvY2FsIHZhcmlhYmxlcyB3aGVuIHJldHVybmluZyBhIHR1cGxlCiAgICAvLyBmdW5jdGlvbiBfZ2VuZXJhdGVGaWdodGVyU3RhdHModWludDI1NiBfYXR0YWNrZXJMZWFkZXJJZCwgdWludDI1NiBfZGVmZW5kZXJMZWFkZXJJZCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nls2XSkgewogICAgZnVuY3Rpb24gX2dlbmVyYXRlRmlnaHRlclN0YXRzKHVpbnQyNTYgZ2VuZXJhdGlvbjEsIHVpbnQyNTYgZ2VuZXMxLCB1aW50MjU2IGdlbmVyYXRpb24yLCB1aW50MjU2IGdlbmVzMikgaW50ZXJuYWwgcmV0dXJucyAodWludDI1Nls2XSkgewogICAgICAgIC8vIHVpbnQyNTYgZ2VuZXJhdGlvbjE7CiAgICAgICAgLy8gdWludDI1NiBnZW5lczE7CiAgICAgICAgLy8gdWludDI1NiBnZW5lcmF0aW9uMjsKICAgICAgICAvLyB1aW50MjU2IGdlbmVzMjsKCiAgICAgICAgdWludDI1NiBnZW5lcmF0aW9uMjU2ID0gKChnZW5lcmF0aW9uMSArIGdlbmVyYXRpb24yKSAvIDIpICsgMTsKCiAgICAgICAgLy8gbWFraW5nIHN1cmUgYSBnZW4gNjU1MzYgZG9lc24ndCB0dXJuIG91dCBhcyBhIGdlbiAwIDopCiAgICAgICAgaWYgKGdlbmVyYXRpb24yNTYgPiA2NTUzNSkKICAgICAgICAgICAgZ2VuZXJhdGlvbjI1NiA9IDY1NTM1OwogICAgICAgIAogICAgICAgIHVpbnQxNiBnZW5lcmF0aW9uID0gdWludDE2KGdlbmVyYXRpb24yNTYpOwoKICAgICAgICB1aW50MjU2IGdlbmVzID0gZ2VuZVNjaWVuY2UubWl4R2VuZXMoZ2VuZXMxLCBnZW5lczIpOwoKICAgICAgICB1aW50MjU2IHN0cmVuZ3RoOwogICAgICAgIHVpbnQyNTYgZGV4dGVyaXR5OwogICAgICAgIHVpbnQyNTYgdml0YWxpdHk7CgogICAgICAgIHVpbnQyNTYgcmFuZCA9IHVpbnQoa2VjY2FrMjU2KG5vdywgbXNnLnNlbmRlciwgcmFuZG9tQ291bnRlcisrKSk7CgogICAgICAgIChzdHJlbmd0aCwgZGV4dGVyaXR5LCB2aXRhbGl0eSkgPSBfZ2V0U3RyZW5ndGhEZXh0ZXJpdHlWaXRhbGl0eShfZ2V0UmFjZUZyb21HZW5lcyhnZW5lcyksIGdlbmVyYXRpb24sIHJhbmQpOwoKICAgICAgICB1aW50MjU2IGx1Y2sgPSBnZW5Ub0x1Y2soZ2VuZXMsIHJhbmQpOwoKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICBnZW5lcmF0aW9uLAogICAgICAgICAgICBnZW5lcywKICAgICAgICAgICAgc3RyZW5ndGgsCiAgICAgICAgICAgIGRleHRlcml0eSwKICAgICAgICAgICAgdml0YWxpdHksCiAgICAgICAgICAgIGx1Y2sKICAgICAgICBdOwogICAgfQoKICAgIC8vIHRha2VzIGluIGdlbmVzIGFuZCByZXR1cm5zIHJhY2VJZAogICAgLy8gcmFjZSBpcyBmaXJzdCBsb2NpIGFmdGVyIHZlcnNpb24uIAogICAgLy8gW11bXS4uLltdW3JhY2VdW3ZlcnNpb25dIAogICAgLy8gZWFjaCBsb2NpID0gMkIsIHJhY2UgaXMgYWxzbyAyQi4gZmF0aGVyJ3MgZ2VuZSBpcyBkZXRlcm1pbmluZyB0aGUgZmlnaHRlcidzIHJhY2UKICAgIGZ1bmN0aW9uIF9nZXRSYWNlRnJvbUdlbmVzKHVpbnQyNTYgX2dlbmVzKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gKF9nZW5lcyA+PiAoMTYpKSAmIDB4ZmY7CiAgICB9CgogICAgZnVuY3Rpb24gZXhwZXJpZW5jZVRvTGV2ZWwodWludDI1NiBfZXhwZXJpZW5jZSkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IHN0YXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChzdGF0c1tpXSA+IF9leHBlcmllbmNlKSB7CiAgICAgICAgICAgICAgICAvLyBjdXJyZW50IGxldmVsIGlzIGkKICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gNTA7CiAgICB9CgogICAgLy8gcmV0dXJucyBhIG51bWJlciBiZXR3ZWVuIDAgYW5kIDQgYmFzZWQgb24gd2hpY2ggc3RhdCB0byBpbmNyZWFzZQogICAgLy8gMCAtIG5vIHN0YXQgaW5jcmVhc2UKICAgIC8vIDEgLSBkZXh0ZXJpdHkKICAgIC8vIDIgLSBzdHJlbmd0aAogICAgLy8gMyAtIHZpdGFsaXR5CiAgICAvLyA0IC0gbHVjawogICAgZnVuY3Rpb24gX2NhbGN1bGF0ZU5ld1N0YXQodWludDMyIF9jdXJyZW50RXhwZXJpZW5jZSwgdWludDMyIF9uZXdFeHBlcmllbmNlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gZmluZCBjdXJyZW50IGxldmVsCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgc3RhdHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKHN0YXRzW2ldID4gX2N1cnJlbnRFeHBlcmllbmNlKSB7CiAgICAgICAgICAgICAgICAvLyBjdXJyZW50IGxldmVsIGlzIGkKICAgICAgICAgICAgICAgIGlmIChzdGF0c1tpXSA8PSBfbmV3RXhwZXJpZW5jZSkgewogICAgICAgICAgICAgICAgICAgIC8vIGxldmVsIHVwIGEgcmFuZG9tIHN0YXQKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMSArIHJhbmRNb2QocmFuZG9tQ291bnRlcisrLCA0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGF0IG1heCBsZXZlbAogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIC8vIGZ1bmN0aW9uIF9nZXRGaWdodGVyR2VuQW5kR2VuZXModWludDI1NiBfZmlnaHRlcklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgLy8gICAgIHVpbnQyNTYgZ2VuZXJhdGlvbiwKICAgIC8vICAgICB1aW50MjU2IGdlbmVzCiAgICAvLyApIHsKICAgIC8vICAgICAoLCwsLCwgZ2VuZXJhdGlvbiwgZ2VuZXMsLCwsLCkgPSBmaWdodGVyQ29yZS5nZXRGaWdodGVyKF9maWdodGVySWQpOwogICAgLy8gfQoKICAgIGZ1bmN0aW9uIF9nZXRGaWdodGVyU3RhdHNEYXRhKHVpbnQyNTYgX2ZpZ2h0ZXJJZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2WzZdKSB7CiAgICAgICAgdWludDI1NiBkZXh0ZXJpdHk7CiAgICAgICAgdWludDI1NiBzdHJlbmd0aDsKICAgICAgICB1aW50MjU2IHZpdGFsaXR5OwogICAgICAgIHVpbnQyNTYgbHVjazsKICAgICAgICB1aW50MjU2IGV4cGVyaWVuY2U7CiAgICAgICAgdWludDI1NiBiYXR0bGVDb29sZG93bkVuZFRpbWU7CiAgICAgICAgCiAgICAgICAgKAogICAgICAgICAgICAsCiAgICAgICAgICAgIGJhdHRsZUNvb2xkb3duRW5kVGltZSwKICAgICAgICAgICAgLAogICAgICAgICAgICAsCiAgICAgICAgICAgICwKICAgICAgICAgICAgLAogICAgICAgICAgICAsCiAgICAgICAgICAgIGRleHRlcml0eSwKICAgICAgICAgICAgc3RyZW5ndGgsCiAgICAgICAgICAgIHZpdGFsaXR5LAogICAgICAgICAgICBsdWNrLAogICAgICAgICAgICBleHBlcmllbmNlCiAgICAgICAgKSA9IGZpZ2h0ZXJDb3JlLmdldEZpZ2h0ZXIoX2ZpZ2h0ZXJJZCk7CgogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIGRleHRlcml0eSwKICAgICAgICAgICAgc3RyZW5ndGgsCiAgICAgICAgICAgIHZpdGFsaXR5LAogICAgICAgICAgICBsdWNrLAogICAgICAgICAgICBleHBlcmllbmNlLAogICAgICAgICAgICBiYXR0bGVDb29sZG93bkVuZFRpbWUKICAgICAgICBdOwogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRGaWdodGVyQmF0dGxlRGF0YSh1aW50MjU2IF9maWdodGVySWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1Nls3XSkgewogICAgICAgIHVpbnQyNTYgcHJpemVDb29sZG93bkVuZFRpbWU7CiAgICAgICAgdWludDI1NiBwcml6ZUNvb2xkb3duSW5kZXg7CiAgICAgICAgdWludDI1NiBiYXR0bGVDb29sZG93bkVuZFRpbWU7CiAgICAgICAgdWludDI1NiBiYXR0bGVzRm91Z2h0OwogICAgICAgIHVpbnQyNTYgYmF0dGxlc1dvbjsKICAgICAgICB1aW50MjU2IGdlbmVyYXRpb247CiAgICAgICAgdWludDI1NiBnZW5lczsKICAgICAgICAKICAgICAgICAoCiAgICAgICAgICAgIHByaXplQ29vbGRvd25FbmRUaW1lLAogICAgICAgICAgICBiYXR0bGVDb29sZG93bkVuZFRpbWUsCiAgICAgICAgICAgIHByaXplQ29vbGRvd25JbmRleCwKICAgICAgICAgICAgYmF0dGxlc0ZvdWdodCwKICAgICAgICAgICAgYmF0dGxlc1dvbiwKICAgICAgICAgICAgZ2VuZXJhdGlvbiwKICAgICAgICAgICAgZ2VuZXMsCiAgICAgICAgICAgICwKICAgICAgICAgICAgLAogICAgICAgICAgICAsCiAgICAgICAgICAgICwKICAgICAgICApID0gZmlnaHRlckNvcmUuZ2V0RmlnaHRlcihfZmlnaHRlcklkKTsKCiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgcHJpemVDb29sZG93bkVuZFRpbWUsCiAgICAgICAgICAgIHByaXplQ29vbGRvd25JbmRleCwKICAgICAgICAgICAgYmF0dGxlQ29vbGRvd25FbmRUaW1lLAogICAgICAgICAgICBiYXR0bGVzRm91Z2h0LAogICAgICAgICAgICBiYXR0bGVzV29uLAogICAgICAgICAgICBnZW5lcmF0aW9uLAogICAgICAgICAgICBnZW5lcwogICAgICAgIF07CiAgICB9CgogICAgZnVuY3Rpb24gX2luY3JlYXNlRmlnaHRlclN0YXRzKAogICAgICAgIHVpbnQyNTYgX2ZpZ2h0ZXJJZCwKICAgICAgICB1aW50MzIgX2V4cGVyaWVuY2VHYWluZWQsCiAgICAgICAgdWludFs2XSBtZW1vcnkgZGF0YQogICAgKSBpbnRlcm5hbCB7CiAgICAgICAgLy8gZG9udCB1cGRhdGUgaWYgb24gY29vbGRvd24KICAgICAgICBpZiAoZGF0YVs1XSA+PSBibG9jay5udW1iZXIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdWludDMyIGV4cGVyaWVuY2UgPSB1aW50MzIoZGF0YVs0XSk7CiAgICAgICAgdWludDMyIG5ld0V4cGVyaWVuY2UgPSBleHBlcmllbmNlICsgX2V4cGVyaWVuY2VHYWluZWQ7CiAgICAgICAgdWludDI1NiBfc3RhdEluY3JlYXNlID0gX2NhbGN1bGF0ZU5ld1N0YXQoZXhwZXJpZW5jZSwgbmV3RXhwZXJpZW5jZSk7CiAgICAgICAgCiAgICAgICAgZmlnaHRlckNvcmUudXBkYXRlRXhwZXJpZW5jZShfZmlnaHRlcklkLCBuZXdFeHBlcmllbmNlKTsKCiAgICAgICAgaWYgKF9zdGF0SW5jcmVhc2UgPT0gMSkgewogICAgICAgICAgICBmaWdodGVyQ29yZS51cGRhdGVEZXh0ZXJpdHkoX2ZpZ2h0ZXJJZCwgdWludDgoKytkYXRhWzBdKSk7CiAgICAgICAgfSBlbHNlIGlmIChfc3RhdEluY3JlYXNlID09IDIpIHsKICAgICAgICAgICAgZmlnaHRlckNvcmUudXBkYXRlU3RyZW5ndGgoX2ZpZ2h0ZXJJZCwgdWludDgoKytkYXRhWzFdKSk7CiAgICAgICAgfSBlbHNlIGlmIChfc3RhdEluY3JlYXNlID09IDMpIHsKICAgICAgICAgICAgZmlnaHRlckNvcmUudXBkYXRlVml0YWxpdHkoX2ZpZ2h0ZXJJZCwgdWludDgoKytkYXRhWzJdKSk7CiAgICAgICAgfSBlbHNlIGlmIChfc3RhdEluY3JlYXNlID09IDQpIHsKICAgICAgICAgICAgZmlnaHRlckNvcmUudXBkYXRlTHVjayhfZmlnaHRlcklkLCB1aW50OCgrK2RhdGFbM10pKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX2luY3JlYXNlVGVhbUZpZ2h0ZXJTdGF0cyh1aW50MjU2W10gbWVtb3J5IF9maWdodGVySWRzLCB1aW50MzIgX2V4cGVyaWVuY2VHYWluZWQpIHByaXZhdGUgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9maWdodGVySWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIF9pbmNyZWFzZUZpZ2h0ZXJTdGF0cyhfZmlnaHRlcklkc1tpXSwgX2V4cGVyaWVuY2VHYWluZWQsIF9nZXRGaWdodGVyU3RhdHNEYXRhKF9maWdodGVySWRzW2ldKSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF91cGRhdGVGaWdodGVyQmF0dGxlU3RhdHMoCiAgICAgICAgdWludDI1NiBfZmlnaHRlcklkLAogICAgICAgIGJvb2wgX3dpbm5lciwKICAgICAgICBib29sIF9sZWFkZXIsCiAgICAgICAgdWludFs3XSBtZW1vcnkgZGF0YSwKICAgICAgICBib29sIF9za2lwQXdhcmRQcml6ZQogICAgKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDY0IHByaXplQ29vbGRvd25FbmRUaW1lID0gdWludDY0KGRhdGFbMF0pOwogICAgICAgIHVpbnQxNiBwcml6ZUNvb2xkb3duSW5kZXggPSB1aW50MTYoZGF0YVsxXSk7CiAgICAgICAgdWludDY0IGJhdHRsZUNvb2xkb3duRW5kVGltZSA9IHVpbnQ2NChkYXRhWzJdKTsKICAgICAgICB1aW50MTYgdXBkYXRlZEJhdHRsZXNGb3VnaHQgPSB1aW50MTYoZGF0YVszXSkgKyAxOwoKICAgICAgICAvLyB0cmlnZ2VyIHByaXplIGNvb2xkb3duCiAgICAgICAgaWYgKF93aW5uZXIgJiYgX2xlYWRlciAmJiAhX3NraXBBd2FyZFByaXplKSB7CiAgICAgICAgICAgIHByaXplQ29vbGRvd25FbmRUaW1lID0gdWludDY0KChwcml6ZUNvb2xkb3duc1twcml6ZUNvb2xkb3duSW5kZXhdIC8gc2Vjb25kc1BlckJsb2NrKSArIGJsb2NrLm51bWJlcik7CgogICAgICAgICAgICBpZiAocHJpemVDb29sZG93bkluZGV4IDwgNikgewogICAgICAgICAgICAgICBwcml6ZUNvb2xkb3duSW5kZXggKz0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHVwZGF0ZWRCYXR0bGVzRm91Z2h0ICUgYmF0dGxlc1RpbGxCYXR0bGVDb29sZG93biA9PSAwKSB7CiAgICAgICAgICAgIGJhdHRsZUNvb2xkb3duRW5kVGltZSA9IHVpbnQ2NCgoZXhwZXJpZW5jZURlbGF5IC8gc2Vjb25kc1BlckJsb2NrKSArIGJsb2NrLm51bWJlcik7CiAgICAgICAgfQoKICAgICAgICBmaWdodGVyQ29yZS51cGRhdGVGaWdodGVyQmF0dGxlU3RhdHMoCiAgICAgICAgICAgIF9maWdodGVySWQsCiAgICAgICAgICAgIHByaXplQ29vbGRvd25FbmRUaW1lLAogICAgICAgICAgICBwcml6ZUNvb2xkb3duSW5kZXgsCiAgICAgICAgICAgIGJhdHRsZUNvb2xkb3duRW5kVGltZSwKICAgICAgICAgICAgdXBkYXRlZEJhdHRsZXNGb3VnaHQsCiAgICAgICAgICAgIHVpbnQxNihkYXRhWzRdKSArIChfd2lubmVyID8gMSA6IDApIC8vIGJhdHRsZXNXb24KICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIF91cGRhdGVUZWFtQmF0dGxlU3RhdHModWludDI1NltdIG1lbW9yeSBfZmlnaHRlcklkcywgYm9vbCBfYXR0YWNrZXJXaW4sIGJvb2wgX3NraXBBd2FyZFByaXplKSBwcml2YXRlIHsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfZmlnaHRlcklkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBfdXBkYXRlRmlnaHRlckJhdHRsZVN0YXRzKF9maWdodGVySWRzW2ldLCBfYXR0YWNrZXJXaW4sIGkgPT0gMCwgX2dldEZpZ2h0ZXJCYXR0bGVEYXRhKF9maWdodGVySWRzW2ldKSwgX3NraXBBd2FyZFByaXplKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gX2F3YXJkUHJpemVGaWdodGVyKAogICAgICAgIGFkZHJlc3MgX3dpbm5lciwgdWludDI1Nls3XSBfYXR0YWNrZXJMZWFkZXIsIHVpbnQyNTZbN10gX2RlZmVuZGVyTGVhZGVyCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICByZXR1cm5zICh1aW50MTYgcHJpemVHZW4sIHVpbnQyNTYgcHJpemVHZW5lcykKICAgIHsKICAgICAgICB1aW50MjU2WzZdIG1lbW9yeSBuZXdGaWdodGVyRGF0YSA9IF9nZW5lcmF0ZUZpZ2h0ZXJTdGF0cyhfYXR0YWNrZXJMZWFkZXJbNV0sIF9hdHRhY2tlckxlYWRlcls2XSwgX2RlZmVuZGVyTGVhZGVyWzVdLCBfZGVmZW5kZXJMZWFkZXJbNl0pOwoKICAgICAgICBwcml6ZUdlbiA9IHVpbnQxNihuZXdGaWdodGVyRGF0YVswXSk7CiAgICAgICAgcHJpemVHZW5lcyA9IG5ld0ZpZ2h0ZXJEYXRhWzFdOwoKICAgICAgICBmaWdodGVyQ29yZS5jcmVhdGVQcml6ZUZpZ2h0ZXIoCiAgICAgICAgICAgIHByaXplR2VuLAogICAgICAgICAgICBwcml6ZUdlbmVzLAogICAgICAgICAgICB1aW50OChuZXdGaWdodGVyRGF0YVsyXSksCiAgICAgICAgICAgIHVpbnQ4KG5ld0ZpZ2h0ZXJEYXRhWzNdKSwKICAgICAgICAgICAgdWludDgobmV3RmlnaHRlckRhdGFbNF0pLAogICAgICAgICAgICB1aW50OChuZXdGaWdodGVyRGF0YVs1XSksCiAgICAgICAgICAgIF93aW5uZXIKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIF91cGRhdGVGaWdodGVyc0FuZEF3YXJkUHJpemVzKAogICAgICAgIHVpbnQyNTZbXSBfYXR0YWNrZXJGaWdodGVySWRzLAogICAgICAgIHVpbnQyNTZbXSBfZGVmZW5kZXJGaWdodGVySWRzLAogICAgICAgIGJvb2wgX2F0dGFja2VyV2luLAogICAgICAgIGFkZHJlc3MgX3dpbm5lckFkZHJlc3MsCiAgICAgICAgdWludDMyIF9hdHRhY2tlckV4cGVyaWVuY2VHYWluZWQsCiAgICAgICAgdWludDMyIF9kZWZlbmRlckV4cGVyaWVuY2VHYWluZWQKICAgICkKICAgICAgICBpbnRlcm5hbAogICAgICAgIHJldHVybnMgKHVpbnQxNiBwcml6ZUdlbiwgdWludDI1NiBwcml6ZUdlbmVzKQogICAgewogICAgICAgIC8vIGdyYWIgcHJpemUgY29vbGRvd24gaW5mbyBiZWZvcmUgaXQgZ2V0cyB1cGRhdGVkCiAgICAgICAgdWludDI1Nls3XSBtZW1vcnkgYXR0YWNrZXJMZWFkZXIgPSBfZ2V0RmlnaHRlckJhdHRsZURhdGEoX2F0dGFja2VyRmlnaHRlcklkc1swXSk7CiAgICAgICAgdWludDI1Nls3XSBtZW1vcnkgZGVmZW5kZXJMZWFkZXIgPSBfZ2V0RmlnaHRlckJhdHRsZURhdGEoX2RlZmVuZGVyRmlnaHRlcklkc1swXSk7CgogICAgICAgIGJvb2wgc2tpcEF3YXJkUHJpemUgPSAoX2F0dGFja2VyV2luICYmIGF0dGFja2VyTGVhZGVyWzBdID49IGJsb2NrLm51bWJlcikgfHwgKCFfYXR0YWNrZXJXaW4gJiYgZGVmZW5kZXJMZWFkZXJbMF0gPj0gYmxvY2subnVtYmVyKTsKICAgICAgICAKICAgICAgICBfaW5jcmVhc2VUZWFtRmlnaHRlclN0YXRzKF9hdHRhY2tlckZpZ2h0ZXJJZHMsIF9hdHRhY2tlckV4cGVyaWVuY2VHYWluZWQpOwogICAgICAgIF9pbmNyZWFzZVRlYW1GaWdodGVyU3RhdHMoX2RlZmVuZGVyRmlnaHRlcklkcywgX2RlZmVuZGVyRXhwZXJpZW5jZUdhaW5lZCk7CiAgICAgICAgCiAgICAgICAgX3VwZGF0ZVRlYW1CYXR0bGVTdGF0cyhfYXR0YWNrZXJGaWdodGVySWRzLCBfYXR0YWNrZXJXaW4sIHNraXBBd2FyZFByaXplKTsKICAgICAgICBfdXBkYXRlVGVhbUJhdHRsZVN0YXRzKF9kZWZlbmRlckZpZ2h0ZXJJZHMsICFfYXR0YWNrZXJXaW4sIHNraXBBd2FyZFByaXplKTsKICAgICAgICAKICAgICAgICAvLyBwcml6ZXMKCiAgICAgICAgLy8gZG9udCBhd2FyZCBwcml6ZSBpZiBvbiBjb29sZG93bgogICAgICAgIGlmIChza2lwQXdhcmRQcml6ZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gX2F3YXJkUHJpemVGaWdodGVyKF93aW5uZXJBZGRyZXNzLCBhdHRhY2tlckxlYWRlciwgZGVmZW5kZXJMZWFkZXIpOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvQmF0dGxlL0JhdHRsZUNvcmUuc29sCgpjb250cmFjdCBCYXR0bGVDb3JlIGlzIEJhdHRsZVByaXplIHsKICAgIGZ1bmN0aW9uIEJhdHRsZUNvcmUoYWRkcmVzcyBfY29yZUFkZHJlc3MsIGFkZHJlc3MgX2dlbmVTY2llbmNlQWRkcmVzcywgYWRkcmVzcyBfYmF0dGxlRGVjaWRlckFkZHJlc3MpIHB1YmxpYyB7CiAgICAgICAgYWRkUmFjZSg0LCA0LCA0KTsgLy8gaGFsZiBlbGYKICAgICAgICBhZGRSYWNlKDYsIDIsIDQpOyAvLyBvcmMKICAgICAgICBhZGRSYWNlKDQsIDUsIDMpOyAvLyBzdWNjdWJidXMKICAgICAgICBhZGRSYWNlKDYsIDQsIDIpOyAvLyBtYWdlCiAgICAgICAgYWRkUmFjZSg3LCAxLCA0KTsKCiAgICAgICAgX3NldEZpZ2h0ZXJDb3JlQWRkcmVzcyhfY29yZUFkZHJlc3MpOwogICAgICAgIF9zZXRHZW5lU2NpZW5jZUFkZHJlc3MoX2dlbmVTY2llbmNlQWRkcmVzcyk7CiAgICAgICAgX3NldEJhdHRsZURlY2lkZXJBZGRyZXNzKF9iYXR0bGVEZWNpZGVyQWRkcmVzcyk7CiAgICAgICAgCiAgICAgICAgLy8gbm8gdGVhbSAwCiAgICAgICAgdWludDI1NltdIG1lbW9yeSBmaWdodGVySWRzID0gbmV3IHVpbnQyNTZbXSgxKTsKICAgICAgICBmaWdodGVySWRzWzBdID0gdWludDI1NigwKTsKICAgICAgICBfY3JlYXRlVGVhbShhZGRyZXNzKDApLCBmaWdodGVySWRzKTsKICAgICAgICB0ZWFtSW5kZXhUb0V4aXN0WzBdID0gZmFsc2U7CiAgICB9CgogICAgLy8vIEBkZXYgRE9OJ1QgZ2l2ZSBtZSB5b3VyIG1vbmV5LgogICAgZnVuY3Rpb24oKSBleHRlcm5hbCB7fQogICAgCiAgICBmdW5jdGlvbiB0b3RhbFRlYW1zKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIHRlYW0gMCBkb2Vzbid0IGV4aXN0CiAgICAgICAgcmV0dXJuIHRlYW1zLmxlbmd0aCAtIDE7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzVmFsaWRUZWFtKHVpbnQyNTZbXSBfZmlnaHRlcklkcykgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9maWdodGVySWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgZmlnaHRlcklkID0gX2ZpZ2h0ZXJJZHNbaV07CiAgICAgICAgICAgIGlmIChmaWdodGVyQ29yZS5vd25lck9mKGZpZ2h0ZXJJZCkgIT0gbXNnLnNlbmRlcikKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGZpZ2h0ZXJJbmRleFRvVGVhbVtmaWdodGVySWRdID4gMCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBkdXBsaWNhdGUgZmlnaHRlcnMKICAgICAgICAgICAgZm9yICh1aW50IGogPSBpICsgMTsgaiA8IF9maWdodGVySWRzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBpZiAoX2ZpZ2h0ZXJJZHNbaV0gPT0gX2ZpZ2h0ZXJJZHNbal0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGNyZWF0ZVRlYW0odWludDI1NltdIF9maWdodGVySWRzKQogICAgICAgIHB1YmxpYwogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgICAgICByZXR1cm5zKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmVxdWlyZShfZmlnaHRlcklkcy5sZW5ndGggPiAwICYmIF9maWdodGVySWRzLmxlbmd0aCA8PSBtYXhQZXJUZWFtKTsKICAgICAgICAKICAgICAgICByZXF1aXJlKGlzVmFsaWRUZWFtKF9maWdodGVySWRzKSk7CgogICAgICAgIHJldHVybiBfY3JlYXRlVGVhbShtc2cuc2VuZGVyLCBfZmlnaHRlcklkcyk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9jcmVhdGVUZWFtKGFkZHJlc3MgX293bmVyLCB1aW50MjU2W10gX2ZpZ2h0ZXJJZHMpIGludGVybmFsIHJldHVybnModWludDI1NikgewogICAgICAgIFRlYW0gbWVtb3J5IF90ZWFtID0gVGVhbSh7CiAgICAgICAgICAgIG93bmVyOiBfb3duZXIsCiAgICAgICAgICAgIGZpZ2h0ZXJJZHM6IF9maWdodGVySWRzCiAgICAgICAgfSk7CgogICAgICAgIHVpbnQyNTYgbmV3VGVhbUlkOwoKICAgICAgICAvLyByZXVzZSB0ZWFtSWQgaWYgYWRkcmVzcyBoYXMgZGVsZXRlZCB0ZWFtcwogICAgICAgIGlmIChkZWxldGVkVGVhbUlkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIG5ld1RlYW1JZCA9IGRlbGV0ZWRUZWFtSWRzW2RlbGV0ZWRUZWFtSWRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBkZWxldGUgZGVsZXRlZFRlYW1JZHNbZGVsZXRlZFRlYW1JZHMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIGRlbGV0ZWRUZWFtSWRzLmxlbmd0aC0tOwogICAgICAgICAgICB0ZWFtc1tuZXdUZWFtSWRdID0gX3RlYW07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3VGVhbUlkID0gdGVhbXMucHVzaChfdGVhbSkgLSAxOwogICAgICAgIH0KCiAgICAgICAgcmVxdWlyZShuZXdUZWFtSWQgPD0gNDI5NDk2NzI5NSk7CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9maWdodGVySWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHVpbnQyNTYgZmlnaHRlcklkID0gX2ZpZ2h0ZXJJZHNbaV07CgogICAgICAgICAgICBmaWdodGVySW5kZXhUb1RlYW1bZmlnaHRlcklkXSA9IG5ld1RlYW1JZDsKICAgICAgICB9CgogICAgICAgIHRlYW1JbmRleFRvRXhpc3RbbmV3VGVhbUlkXSA9IHRydWU7CgogICAgICAgIFRlYW1DcmVhdGVkKG5ld1RlYW1JZCwgX2ZpZ2h0ZXJJZHMpOwoKICAgICAgICByZXR1cm4gbmV3VGVhbUlkOwogICAgfQoKICAgIGZ1bmN0aW9uIGRlbGV0ZVRlYW0odWludDI1NiBfdGVhbUlkKQogICAgICAgIHB1YmxpYwogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgICAgICBvbmx5VGVhbU93bmVyKF90ZWFtSWQpCiAgICAgICAgb25seUV4aXN0aW5nVGVhbShfdGVhbUlkKQogICAgewogICAgICAgIF9kZWxldGVUZWFtKF90ZWFtSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9kZWxldGVUZWFtKHVpbnQyNTYgX3RlYW1JZCkgcHJpdmF0ZSB7CiAgICAgICAgVGVhbSBtZW1vcnkgdGVhbSA9IHRlYW1zW190ZWFtSWRdOwoKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCB0ZWFtLmZpZ2h0ZXJJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZmlnaHRlckluZGV4VG9UZWFtW3RlYW0uZmlnaHRlcklkc1tpXV0gPSAwOwogICAgICAgIH0KCiAgICAgICAgVGVhbURlbGV0ZWQoX3RlYW1JZCwgdGVhbS5maWdodGVySWRzKTsKCiAgICAgICAgZGVsZXRlIHRlYW1zW190ZWFtSWRdOwoKICAgICAgICBkZWxldGVkVGVhbUlkcy5wdXNoKF90ZWFtSWQpOwogICAgICAgIAogICAgICAgIHRlYW1JbmRleFRvRXhpc3RbX3RlYW1JZF0gPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYXR0bGUodWludDI1NltdIF9hdHRhY2tlckZpZ2h0ZXJJZHMsIHVpbnQyNTYgX2RlZmVuZGVyVGVhbUlkKQogICAgICAgIHB1YmxpYwogICAgICAgIHdoZW5Ob3RQYXVzZWQKICAgICAgICBvbmx5RXhpc3RpbmdUZWFtKF9kZWZlbmRlclRlYW1JZCkKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJlcXVpcmUoX2F0dGFja2VyRmlnaHRlcklkcy5sZW5ndGggPiAwICYmIF9hdHRhY2tlckZpZ2h0ZXJJZHMubGVuZ3RoIDw9IG1heFBlclRlYW0pOwogICAgICAgIHJlcXVpcmUoaXNWYWxpZFRlYW0oX2F0dGFja2VyRmlnaHRlcklkcykpOwoKICAgICAgICBUZWFtIG1lbW9yeSBkZWZlbmRlclRlYW0gPSB0ZWFtc1tfZGVmZW5kZXJUZWFtSWRdOwoKICAgICAgICAvLyBjaGVjayB0aGF0IGEgdXNlciBpc24ndCBhdHRhY2tpbmcgaGltc2VsZgogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciAhPSBkZWZlbmRlclRlYW0ub3duZXIpOwoKICAgICAgICB1aW50MjU2W10gbWVtb3J5IGRlZmVuZGVyRmlnaHRlcklkcyA9IGRlZmVuZGVyVGVhbS5maWdodGVySWRzOwogICAgICAgIAogICAgICAgIGJvb2wgYXR0YWNrZXJXb247CiAgICAgICAgdWludDI1NiB4cEZvckF0dGFja2VyOwogICAgICAgIHVpbnQyNTYgeHBGb3JEZWZlbmRlcjsKCiAgICAgICAgX2RlbGV0ZVRlYW0oX2RlZmVuZGVyVGVhbUlkKTsKCiAgICAgICAgKAogICAgICAgICAgICBhdHRhY2tlcldvbiwKICAgICAgICAgICAgeHBGb3JBdHRhY2tlciwKICAgICAgICAgICAgeHBGb3JEZWZlbmRlcgogICAgICAgICkgPSBiYXR0bGVEZWNpZGVyLmRldGVybWluZVdpbm5lcihnZXRGaWdodGVyQXJyYXkoX2F0dGFja2VyRmlnaHRlcklkcyksIGdldEZpZ2h0ZXJBcnJheShkZWZlbmRlckZpZ2h0ZXJJZHMpKTsKICAgICAgICAKICAgICAgICBhZGRyZXNzIHdpbm5lckFkZHJlc3M7CiAgICAgICAgYWRkcmVzcyBsb3NlckFkZHJlc3M7CgogICAgICAgIGlmIChhdHRhY2tlcldvbikgewogICAgICAgICAgICB3aW5uZXJBZGRyZXNzID0gbXNnLnNlbmRlcjsKICAgICAgICAgICAgbG9zZXJBZGRyZXNzID0gZGVmZW5kZXJUZWFtLm93bmVyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdpbm5lckFkZHJlc3MgPSBkZWZlbmRlclRlYW0ub3duZXI7CiAgICAgICAgICAgIGxvc2VyQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHVpbnQxNiBwcml6ZUdlbjsKICAgICAgICB1aW50MjU2IHByaXplR2VuZXM7CiAgICAgICAgKHByaXplR2VuLCBwcml6ZUdlbmVzKSA9IF91cGRhdGVGaWdodGVyc0FuZEF3YXJkUHJpemVzKF9hdHRhY2tlckZpZ2h0ZXJJZHMsIGRlZmVuZGVyRmlnaHRlcklkcywgYXR0YWNrZXJXb24sIHdpbm5lckFkZHJlc3MsIHVpbnQzMih4cEZvckF0dGFja2VyKSwgdWludDMyKHhwRm9yRGVmZW5kZXIpKTsKICAgICAgICAKICAgICAgICBCYXR0bGVSZXN1bHQod2lubmVyQWRkcmVzcywgbG9zZXJBZGRyZXNzLCBfYXR0YWNrZXJGaWdodGVySWRzLCBkZWZlbmRlckZpZ2h0ZXJJZHMsIGF0dGFja2VyV29uLCBwcml6ZUdlbiwgcHJpemVHZW5lcywgdWludDMyKHhwRm9yQXR0YWNrZXIpLCB1aW50MzIoeHBGb3JEZWZlbmRlcikpOwoKICAgICAgICByZXR1cm4gYXR0YWNrZXJXb247CiAgICB9CiAgICAgICAgCiAgICAvLy8gQHBhcmFtIF9pZCBUaGUgSUQgb2YgdGhlIHRlYW0gb2YgaW50ZXJlc3QuCiAgICBmdW5jdGlvbiBnZXRUZWFtKHVpbnQyNTYgX2lkKQogICAgICAgIHB1YmxpYwogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICgKICAgICAgICBhZGRyZXNzIG93bmVyLAogICAgICAgIHVpbnQyNTZbXSBmaWdodGVySWRzCiAgICApIHsKICAgICAgICBUZWFtIHN0b3JhZ2UgX3RlYW0gPSB0ZWFtc1tfaWRdOwoKICAgICAgICBvd25lciA9IF90ZWFtLm93bmVyOwogICAgICAgIGZpZ2h0ZXJJZHMgPSBfdGVhbS5maWdodGVySWRzOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEZpZ2h0ZXJBcnJheSh1aW50MjU2W10gX2ZpZ2h0ZXJJZHMpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTZbN11bXSkgewogICAgICAgIHVpbnQyNTZbN11bXSBtZW1vcnkgcmVzID0gbmV3IHVpbnQyNTZbN11bXShfZmlnaHRlcklkcy5sZW5ndGgpOwoKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfZmlnaHRlcklkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB1aW50MjU2IGdlbmVyYXRpb247CiAgICAgICAgICAgIHVpbnQyNTYgZ2VuZXM7CiAgICAgICAgICAgIHVpbnQyNTYgZGV4dGVyaXR5OwogICAgICAgICAgICB1aW50MjU2IHN0cmVuZ3RoOwogICAgICAgICAgICB1aW50MjU2IHZpdGFsaXR5OwogICAgICAgICAgICB1aW50MjU2IGx1Y2s7CiAgICAgICAgICAgIHVpbnQyNTYgZXhwZXJpZW5jZTsKICAgICAgICAgICAgCiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgIGdlbmVyYXRpb24sCiAgICAgICAgICAgICAgICBnZW5lcywKICAgICAgICAgICAgICAgIGRleHRlcml0eSwKICAgICAgICAgICAgICAgIHN0cmVuZ3RoLAogICAgICAgICAgICAgICAgdml0YWxpdHksCiAgICAgICAgICAgICAgICBsdWNrLAogICAgICAgICAgICAgICAgZXhwZXJpZW5jZQogICAgICAgICAgICApID0gZmlnaHRlckNvcmUuZ2V0RmlnaHRlcihfZmlnaHRlcklkc1tpXSk7CgogICAgICAgICAgICB1aW50MjU2IGxldmVsID0gZXhwZXJpZW5jZVRvTGV2ZWwoZXhwZXJpZW5jZSk7CgogICAgICAgICAgICByZXNbaV0gPSBbCiAgICAgICAgICAgICAgICBsZXZlbCwKICAgICAgICAgICAgICAgIGdlbmVyYXRpb24sCiAgICAgICAgICAgICAgICBzdHJlbmd0aCwKICAgICAgICAgICAgICAgIGRleHRlcml0eSwKICAgICAgICAgICAgICAgIHZpdGFsaXR5LAogICAgICAgICAgICAgICAgbHVjaywKICAgICAgICAgICAgICAgIGdlbmVzCiAgICAgICAgICAgIF07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzOwogICAgfQp9'.
	

]
