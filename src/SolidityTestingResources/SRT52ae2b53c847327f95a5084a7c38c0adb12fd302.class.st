Class {
	#name : #SRT52ae2b53c847327f95a5084a7c38c0adb12fd302,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT52ae2b53c847327f95a5084a7c38c0adb12fd302 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKLy8vIEBkZXYgYE93bmVkYCBpcyBhIGJhc2UgbGV2ZWwgY29udHJhY3QgdGhhdCBhc3NpZ25zIGFuIGBvd25lcmAgdGhhdCBjYW4gYmUKLy8vICBsYXRlciBjaGFuZ2VkCmNvbnRyYWN0IE93bmVkIHsKCiAgICAvLy8gQGRldiBgb3duZXJgIGlzIHRoZSBvbmx5IGFkZHJlc3MgdGhhdCBjYW4gY2FsbCBhIGZ1bmN0aW9uIHdpdGggdGhpcwogICAgLy8vIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5T3duZXIoKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBfOwogICAgfQoKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIC8vLyBAbm90aWNlIFRoZSBDb25zdHJ1Y3RvciBhc3NpZ25zIHRoZSBtZXNzYWdlIHNlbmRlciB0byBiZSBgb3duZXJgCiAgICBmdW5jdGlvbiBPd25lZCgpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgYWRkcmVzcyBwdWJsaWMgbmV3T3duZXI7CgogICAgLy8vIEBub3RpY2UgYG93bmVyYCBjYW4gc3RlcCBkb3duIGFuZCBhc3NpZ24gc29tZSBvdGhlciBhZGRyZXNzIHRvIHRoaXMgcm9sZQogICAgLy8vIEBwYXJhbSBfbmV3T3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBvd25lci4gMHgwIGNhbiBiZSB1c2VkIHRvIGNyZWF0ZQogICAgLy8vICBhbiB1bm93bmVkIG5ldXRyYWwgdmF1bHQsIGhvd2V2ZXIgdGhhdCBjYW5ub3QgYmUgdW5kb25lCiAgICBmdW5jdGlvbiBjaGFuZ2VPd25lcihhZGRyZXNzIF9uZXdPd25lcikgb25seU93bmVyIHsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KCgogICAgZnVuY3Rpb24gYWNjZXB0T3duZXJzaGlwKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG5ld093bmVyKSB7CiAgICAgICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgfQogICAgfQp9CgovLyBBYnN0cmFjdCBjb250cmFjdCBmb3IgdGhlIGZ1bGwgRVJDIDIwIFRva2VuIHN0YW5kYXJkCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMAoKY29udHJhY3QgRVJDMjBUb2tlbiB7CiAgICAvKiBUaGlzIGlzIGEgc2xpZ2h0IGNoYW5nZSB0byB0aGUgRVJDMjAgYmFzZSBzdGFuZGFyZC4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBzdXBwbHkpOwogICAgaXMgcmVwbGFjZWQgd2l0aDoKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwogICAgVGhpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZXMgYSBnZXR0ZXIgZnVuY3Rpb24gZm9yIHRoZSB0b3RhbFN1cHBseS4KICAgIFRoaXMgaXMgbW92ZWQgdG8gdGhlIGJhc2UgY29udHJhY3Qgc2luY2UgcHVibGljIGdldHRlciBmdW5jdGlvbnMgYXJlIG5vdAogICAgY3VycmVudGx5IHJlY29nbmlzZWQgYXMgYW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIG1hdGNoaW5nIGFic3RyYWN0CiAgICBmdW5jdGlvbiBieSB0aGUgY29tcGlsZXIuCiAgICAqLwogICAgLy8vIHRvdGFsIGFtb3VudCBvZiB0b2tlbnMKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsU3VwcGx5OwoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIGZyb20gd2hpY2ggdGhlIGJhbGFuY2Ugd2lsbCBiZSByZXRyaWV2ZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBtc2cuc2VuZGVyYAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbiB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gV2hldGhlciB0aGUgdHJhbnNmZXIgd2FzIHN1Y2Nlc3NmdWwgb3Igbm90CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7CgogICAgLy8vIEBub3RpY2Ugc2VuZCBgX3ZhbHVlYCB0b2tlbiB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdCBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIG9mIHRoZSBzZW5kZXIKICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgb2YgdG9rZW4gdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQG5vdGljZSBgbXNnLnNlbmRlcmAgYXBwcm92ZXMgYF9zcGVuZGVyYCB0byBzcGVuZCBgX3ZhbHVlYCB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBhcHByb3ZlZCBmb3IgdHJhbnNmZXIKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIGFwcHJvdmFsIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBvd25pbmcgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIG9mIHRoZSBhY2NvdW50IGFibGUgdG8gdHJhbnNmZXIgdGhlIHRva2VucwogICAgLy8vIEByZXR1cm4gQW1vdW50IG9mIHJlbWFpbmluZyB0b2tlbnMgYWxsb3dlZCB0byBzcGVudAogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZyk7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIF9mcm9tLCBhZGRyZXNzIGluZGV4ZWQgX3RvLCB1aW50MjU2IF92YWx1ZSk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgX293bmVyLCBhZGRyZXNzIGluZGV4ZWQgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKTsKfQoKCgovKioKICogTWF0aCBvcGVyYXRpb25zIHdpdGggc2FmZXR5IGNoZWNrcwogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICB1aW50IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludCBhLCB1aW50IGIpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgIHVpbnQgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIG1heDY0KHVpbnQ2NCBhLCB1aW50NjQgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDY0KSB7CiAgICByZXR1cm4gYSA+PSBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtaW42NCh1aW50NjQgYSwgdWludDY0IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQ2NCkgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQoKICBmdW5jdGlvbiBtYXgyNTYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHJldHVybiBhID49IGIgPyBhIDogYjsKICB9CgogIGZ1bmN0aW9uIG1pbjI1Nih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgfQp9CgoKLyoKICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCgovLy8gQHRpdGxlIER5bmFtaWNDZWlsaW5nIENvbnRyYWN0Ci8vLyBAYXV0aG9yIEpvcmRpIEJheWxpbmEKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBjYWxjdWxhdGVzIHRoZSBjZWlsaW5nIGZyb20gYSBzZXJpZXMgb2YgY3VydmVzLgovLy8gIFRoZXNlIGN1cnZlcyBhcmUgY29tbWl0dGVkIGZpcnN0IGFuZCByZXZlYWxlZCBsYXRlci4KLy8vICBBbGwgdGhlIGN1cnZlcyBtdXN0IGJlIGluIGluY3JlYXNpbmcgb3JkZXIgYW5kIHRoZSBsYXN0IGN1cnZlIGlzIG1hcmtlZAovLy8gIGFzIHRoZSBsYXN0IG9uZS4KLy8vICBUaGlzIGNvbnRyYWN0IGFsbG93cyB0byBoaWRlIGFuZCByZXZlYWwgdGhlIGNlaWxpbmcgYXQgd2lsbCBvZiB0aGUgb3duZXIuCgoKCmNvbnRyYWN0IER5bmFtaWNDZWlsaW5nIGlzIE93bmVkIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIHN0cnVjdCBDdXJ2ZSB7CiAgICAgICAgYnl0ZXMzMiBoYXNoOwogICAgICAgIC8vIEFic29sdXRlIGxpbWl0IGZvciB0aGlzIGN1cnZlCiAgICAgICAgdWludDI1NiBsaW1pdDsKICAgICAgICAvLyBUaGUgZnVuZHMgcmVtYWluaW5nIHRvIGJlIGNvbGxlY3RlZCBhcmUgZGl2aWRlZCBieSBgc2xvcGVGYWN0b3JgIHNtb290aCBjZWlsaW5nCiAgICAgICAgLy8gd2l0aCBhIGxvbmcgdGFpbCB3aGVyZSBiaWcgYW5kIHNtYWxsIGJ1eWVycyBjYW4gdGFrZSBwYXJ0LgogICAgICAgIHVpbnQyNTYgc2xvcGVGYWN0b3I7CiAgICAgICAgLy8gVGhpcyBrZWVwcyB0aGUgY3VydmUgZmxhdCBhdCB0aGlzIG51bWJlciwgdW50aWwgZnVuZHMgdG8gYmUgY29sbGVjdGVkIGlzIGxlc3MgdGhhbiB0aGlzCiAgICAgICAgdWludDI1NiBjb2xsZWN0TWluaW11bTsKICAgIH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjb250cmlidXRpb247CgogICAgQ3VydmVbXSBwdWJsaWMgY3VydmVzOwogICAgdWludDI1NiBwdWJsaWMgY3VycmVudEluZGV4OwogICAgdWludDI1NiBwdWJsaWMgcmV2ZWFsZWRDdXJ2ZXM7CiAgICBib29sIHB1YmxpYyBhbGxSZXZlYWxlZDsKCiAgICAvLy8gQGRldiBgY29udHJpYnV0aW9uYCBpcyB0aGUgb25seSBhZGRyZXNzIHRoYXQgY2FuIGNhbGwgYSBmdW5jdGlvbiB3aXRoIHRoaXMKICAgIC8vLyBtb2RpZmllcgogICAgbW9kaWZpZXIgb25seUNvbnRyaWJ1dGlvbiB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNvbnRyaWJ1dGlvbik7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBEeW5hbWljQ2VpbGluZyhhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfY29udHJpYnV0aW9uKSB7CiAgICAgICAgb3duZXIgPSBfb3duZXI7CiAgICAgICAgY29udHJpYnV0aW9uID0gX2NvbnRyaWJ1dGlvbjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYnkgdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IHRvIGNvbW1pdAogICAgLy8vICBhbGwgdGhlIGN1cnZlcy4KICAgIC8vLyBAcGFyYW0gX2N1cnZlSGFzaGVzIEFycmF5IG9mIGhhc2hlcyBvZiBlYWNoIGN1cnZlLiBFYWNoIGhhc2ggaXMgY2FsY3VsYXRlZAogICAgLy8vICBieSB0aGUgYGNhbGN1bGF0ZUhhc2hgIG1ldGhvZC4gTW9yZSBoYXNoZXMgdGhhbiBhY3R1YWwgY3VydmVzIGNhbiBiZQogICAgLy8vICBjb21taXR0ZWQgaW4gb3JkZXIgdG8gaGlkZSBhbHNvIHRoZSBudW1iZXIgb2YgY3VydmVzLgogICAgLy8vICBUaGUgcmVtYWluaW5nIGhhc2hlcyBjYW4gYmUganVzdCByYW5kb20gbnVtYmVycy4KICAgIGZ1bmN0aW9uIHNldEhpZGRlbkN1cnZlcyhieXRlczMyW10gX2N1cnZlSGFzaGVzKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKGN1cnZlcy5sZW5ndGggPT0gMCk7CgogICAgICAgIGN1cnZlcy5sZW5ndGggPSBfY3VydmVIYXNoZXMubGVuZ3RoOwogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IF9jdXJ2ZUhhc2hlcy5sZW5ndGg7IGkgPSBpLmFkZCgxKSkgewogICAgICAgICAgICBjdXJ2ZXNbaV0uaGFzaCA9IF9jdXJ2ZUhhc2hlc1tpXTsKICAgICAgICB9CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEFueWJvZHkgY2FuIHJldmVhbCB0aGUgbmV4dCBjdXJ2ZSBpZiBoZSBrbm93cyBpdC4KICAgIC8vLyBAcGFyYW0gX2xpbWl0IENlaWxpbmcgY2FwLgogICAgLy8vICAobXVzdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSBwcmV2aW91cyBvbmUpLgogICAgLy8vIEBwYXJhbSBfbGFzdCBgdHJ1ZWAgaWYgaXQncyB0aGUgbGFzdCBjdXJ2ZS4KICAgIC8vLyBAcGFyYW0gX3NhbHQgUmFuZG9tIG51bWJlciB1c2VkIHRvIGNvbW1pdCB0aGUgY3VydmUKICAgIGZ1bmN0aW9uIHJldmVhbEN1cnZlKHVpbnQyNTYgX2xpbWl0LCB1aW50MjU2IF9zbG9wZUZhY3RvciwgdWludDI1NiBfY29sbGVjdE1pbmltdW0sCiAgICAgICAgICAgICAgICAgICAgICAgICBib29sIF9sYXN0LCBieXRlczMyIF9zYWx0KSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoIWFsbFJldmVhbGVkKTsKCiAgICAgICAgcmVxdWlyZShjdXJ2ZXNbcmV2ZWFsZWRDdXJ2ZXNdLmhhc2ggPT0gY2FsY3VsYXRlSGFzaChfbGltaXQsIF9zbG9wZUZhY3RvciwgX2NvbGxlY3RNaW5pbXVtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2xhc3QsIF9zYWx0KSk7CgogICAgICAgIHJlcXVpcmUoX2xpbWl0ICE9IDAgJiYgX3Nsb3BlRmFjdG9yICE9IDAgJiYgX2NvbGxlY3RNaW5pbXVtICE9IDApOwogICAgICAgIGlmIChyZXZlYWxlZEN1cnZlcyA+IDApIHsKICAgICAgICAgICAgcmVxdWlyZShfbGltaXQgPj0gY3VydmVzW3JldmVhbGVkQ3VydmVzLnN1YigxKV0ubGltaXQpOwogICAgICAgIH0KCiAgICAgICAgY3VydmVzW3JldmVhbGVkQ3VydmVzXS5saW1pdCA9IF9saW1pdDsKICAgICAgICBjdXJ2ZXNbcmV2ZWFsZWRDdXJ2ZXNdLnNsb3BlRmFjdG9yID0gX3Nsb3BlRmFjdG9yOwogICAgICAgIGN1cnZlc1tyZXZlYWxlZEN1cnZlc10uY29sbGVjdE1pbmltdW0gPSBfY29sbGVjdE1pbmltdW07CiAgICAgICAgcmV2ZWFsZWRDdXJ2ZXMgPSByZXZlYWxlZEN1cnZlcy5hZGQoMSk7CgogICAgICAgIGlmIChfbGFzdCkgYWxsUmV2ZWFsZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldmVhbCBtdWx0aXBsZSBjdXJ2ZXMgYXQgb25jZQogICAgZnVuY3Rpb24gcmV2ZWFsTXVsdGkodWludDI1NltdIF9saW1pdHMsIHVpbnQyNTZbXSBfc2xvcGVGYWN0b3JzLCB1aW50MjU2W10gX2NvbGxlY3RNaW5pbXVtcywKICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xbXSBfbGFzdHMsIGJ5dGVzMzJbXSBfc2FsdHMpIHB1YmxpYyB7CiAgICAgICAgLy8gRG8gbm90IGFsbG93IG5vbmUgYW5kIG5lZWRzIHRvIGJlIHNhbWUgbGVuZ3RoIGZvciBhbGwgcGFyYW1ldGVycwogICAgICAgIHJlcXVpcmUoX2xpbWl0cy5sZW5ndGggIT0gMCAmJgogICAgICAgICAgICAgICAgX2xpbWl0cy5sZW5ndGggPT0gX3Nsb3BlRmFjdG9ycy5sZW5ndGggJiYKICAgICAgICAgICAgICAgIF9saW1pdHMubGVuZ3RoID09IF9jb2xsZWN0TWluaW11bXMubGVuZ3RoICYmCiAgICAgICAgICAgICAgICBfbGltaXRzLmxlbmd0aCA9PSBfbGFzdHMubGVuZ3RoICYmCiAgICAgICAgICAgICAgICBfbGltaXRzLmxlbmd0aCA9PSBfc2FsdHMubGVuZ3RoKTsKCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSAwOyBpIDwgX2xpbWl0cy5sZW5ndGg7IGkgPSBpLmFkZCgxKSkgewogICAgICAgICAgICByZXZlYWxDdXJ2ZShfbGltaXRzW2ldLCBfc2xvcGVGYWN0b3JzW2ldLCBfY29sbGVjdE1pbmltdW1zW2ldLAogICAgICAgICAgICAgICAgICAgICAgICBfbGFzdHNbaV0sIF9zYWx0c1tpXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBAbm90aWNlIE1vdmUgdG8gY3VydmUsIHVzZWQgYXMgYSBmYWlsc2FmZQogICAgZnVuY3Rpb24gbW92ZVRvKHVpbnQyNTYgX2luZGV4KSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9pbmRleCA8IHJldmVhbGVkQ3VydmVzICYmICAgICAgIC8vIE5vIG1vcmUgY3VydmVzCiAgICAgICAgICAgICAgICBfaW5kZXggPT0gY3VycmVudEluZGV4LmFkZCgxKSk7ICAvLyBPbmx5IG1vdmUgb25lIGluZGV4IGF0IGEgdGltZQogICAgICAgIGN1cnJlbnRJbmRleCA9IF9pbmRleDsKICAgIH0KCiAgICAvLy8gQHJldHVybiBSZXR1cm4gdGhlIGZ1bmRzIHRvIGNvbGxlY3QgZm9yIHRoZSBjdXJyZW50IHBvaW50IG9uIHRoZSBjdXJ2ZQogICAgLy8vICAob3IgMCBpZiBubyBjdXJ2ZXMgcmV2ZWFsZWQgeWV0KQogICAgZnVuY3Rpb24gdG9Db2xsZWN0KHVpbnQyNTYgY29sbGVjdGVkKSBwdWJsaWMgb25seUNvbnRyaWJ1dGlvbiByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgaWYgKHJldmVhbGVkQ3VydmVzID09IDApIHJldHVybiAwOwoKICAgICAgICAvLyBNb3ZlIHRvIHRoZSBuZXh0IGN1cnZlCiAgICAgICAgaWYgKGNvbGxlY3RlZCA+PSBjdXJ2ZXNbY3VycmVudEluZGV4XS5saW1pdCkgeyAgLy8gQ2F0Y2hlcyBgbGltaXQgPT0gMGAKICAgICAgICAgICAgdWludDI1NiBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXguYWRkKDEpOwogICAgICAgICAgICBpZiAobmV4dEluZGV4ID49IHJldmVhbGVkQ3VydmVzKSByZXR1cm4gMDsgIC8vIE5vIG1vcmUgY3VydmVzCiAgICAgICAgICAgIGN1cnJlbnRJbmRleCA9IG5leHRJbmRleDsKICAgICAgICAgICAgaWYgKGNvbGxlY3RlZCA+PSBjdXJ2ZXNbY3VycmVudEluZGV4XS5saW1pdCkgcmV0dXJuIDA7ICAvLyBDYXRjaGVzIGBsaW1pdCA9PSAwYAogICAgICAgIH0KCiAgICAgICAgLy8gRXZlcnl0aGluZyBsZWZ0IHRvIGNvbGxlY3QgZnJvbSB0aGlzIGxpbWl0CiAgICAgICAgdWludDI1NiBkaWZmZXJlbmNlID0gY3VydmVzW2N1cnJlbnRJbmRleF0ubGltaXQuc3ViKGNvbGxlY3RlZCk7CgogICAgICAgIC8vIEN1cnJlbnQgcG9pbnQgb24gdGhlIGN1cnZlCiAgICAgICAgdWludDI1NiBjb2xsZWN0ID0gZGlmZmVyZW5jZS5kaXYoY3VydmVzW2N1cnJlbnRJbmRleF0uc2xvcGVGYWN0b3IpOwoKICAgICAgICAvLyBQcmV2ZW50cyBwYXlpbmcgdG9vIG11Y2ggZmVlcyB2cyB0byBiZSBjb2xsZWN0ZWQ7IGJyZWFrcyBsb25nIHRhaWwKICAgICAgICBpZiAoY29sbGVjdCA8PSBjdXJ2ZXNbY3VycmVudEluZGV4XS5jb2xsZWN0TWluaW11bSkgewogICAgICAgICAgICBpZiAoZGlmZmVyZW5jZSA+IGN1cnZlc1tjdXJyZW50SW5kZXhdLmNvbGxlY3RNaW5pbXVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY3VydmVzW2N1cnJlbnRJbmRleF0uY29sbGVjdE1pbmltdW07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGlmZmVyZW5jZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBjb2xsZWN0OwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGVzIHRoZSBoYXNoIG9mIGEgY3VydmUuCiAgICAvLy8gQHBhcmFtIF9saW1pdCBDZWlsaW5nIGNhcC4KICAgIC8vLyBAcGFyYW0gX2xhc3QgYHRydWVgIGlmIGl0J3MgdGhlIGxhc3QgY3VydmUuCiAgICAvLy8gQHBhcmFtIF9zYWx0IFJhbmRvbSBudW1iZXIgdGhhdCB3aWxsIGJlIG5lZWRlZCB0byByZXZlYWwgdGhpcyBjdXJ2ZS4KICAgIC8vLyBAcmV0dXJuIFRoZSBjYWxjdWxhdGVkIGhhc2ggb2YgdGhpcyBjdXJ2ZSB0byBiZSB1c2VkIGluIHRoZSBgc2V0SGlkZGVuQ3VydmVzYCBtZXRob2QKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUhhc2godWludDI1NiBfbGltaXQsIHVpbnQyNTYgX3Nsb3BlRmFjdG9yLCB1aW50MjU2IF9jb2xsZWN0TWluaW11bSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBfbGFzdCwgYnl0ZXMzMiBfc2FsdCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGJ5dGVzMzIpIHsKICAgICAgICByZXR1cm4ga2VjY2FrMjU2KF9saW1pdCwgX3Nsb3BlRmFjdG9yLCBfY29sbGVjdE1pbmltdW0sIF9sYXN0LCBfc2FsdCk7CiAgICB9CgogICAgLy8vIEByZXR1cm4gUmV0dXJuIHRoZSB0b3RhbCBudW1iZXIgb2YgY3VydmVzIGNvbW1pdHRlZAogICAgLy8vICAoY2FuIGJlIGxhcmdlciB0aGFuIHRoZSBudW1iZXIgb2YgYWN0dWFsIGN1cnZlcyBvbiB0aGUgY3VydmUgdG8gaGlkZQogICAgLy8vICB0aGUgcmVhbCBudW1iZXIgb2YgY3VydmVzKQogICAgZnVuY3Rpb24gbkN1cnZlcygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGN1cnZlcy5sZW5ndGg7CiAgICB9Cgp9CgoKLyoKICAgIENvcHlyaWdodCAyMDE2LCBKb3JkaSBCYXlsaW5hCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCgovLy8gQHRpdGxlIE1pbmlNZVRva2VuIENvbnRyYWN0Ci8vLyBAYXV0aG9yIEpvcmRpIEJheWxpbmEKLy8vIEBkZXYgVGhpcyB0b2tlbiBjb250cmFjdCdzIGdvYWwgaXMgdG8gbWFrZSBpdCBlYXN5IGZvciBhbnlvbmUgdG8gY2xvbmUgdGhpcwovLy8gIHRva2VuIHVzaW5nIHRoZSB0b2tlbiBkaXN0cmlidXRpb24gYXQgYSBnaXZlbiBibG9jaywgdGhpcyB3aWxsIGFsbG93IERBTydzCi8vLyAgYW5kIERBcHBzIHRvIHVwZ3JhZGUgdGhlaXIgZmVhdHVyZXMgaW4gYSBkZWNlbnRyYWxpemVkIG1hbm5lciB3aXRob3V0Ci8vLyAgYWZmZWN0aW5nIHRoZSBvcmlnaW5hbCB0b2tlbgovLy8gQGRldiBJdCBpcyBFUkMyMCBjb21wbGlhbnQsIGJ1dCBzdGlsbCBuZWVkcyB0byB1bmRlciBnbyBmdXJ0aGVyIHRlc3RpbmcuCgoKLy8vIEBkZXYgVGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QgbXVzdCBpbXBsZW1lbnQgdGhlc2UgZnVuY3Rpb25zCmNvbnRyYWN0IFRva2VuQ29udHJvbGxlciB7CiAgICAvLy8gQG5vdGljZSBDYWxsZWQgd2hlbiBgX293bmVyYCBzZW5kcyBldGhlciB0byB0aGUgTWluaU1lIFRva2VuIGNvbnRyYWN0CiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHNlbnQgdGhlIGV0aGVyIHRvIGNyZWF0ZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIGV0aGVyIGlzIGFjY2VwdGVkLCBmYWxzZSBpZiBpdCB0aHJvd3MKICAgIGZ1bmN0aW9uIHByb3h5UGF5bWVudChhZGRyZXNzIF9vd25lcikgcGF5YWJsZSByZXR1cm5zKGJvb2wpOwoKICAgIC8vLyBAbm90aWNlIE5vdGlmaWVzIHRoZSBjb250cm9sbGVyIGFib3V0IGEgdG9rZW4gdHJhbnNmZXIgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgb3JpZ2luIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGRlc3RpbmF0aW9uIG9mIHRoZSB0cmFuc2ZlcgogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdGhlIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBGYWxzZSBpZiB0aGUgY29udHJvbGxlciBkb2VzIG5vdCBhdXRob3JpemUgdGhlIHRyYW5zZmVyCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50IF9hbW91bnQpIHJldHVybnMoYm9vbCk7CgogICAgLy8vIEBub3RpY2UgTm90aWZpZXMgdGhlIGNvbnRyb2xsZXIgYWJvdXQgYW4gYXBwcm92YWwgYWxsb3dpbmcgdGhlCiAgICAvLy8gIGNvbnRyb2xsZXIgdG8gcmVhY3QgaWYgZGVzaXJlZAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgdGhhdCBjYWxscyBgYXBwcm92ZSgpYAogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgc3BlbmRlciBpbiB0aGUgYGFwcHJvdmUoKWAgY2FsbAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgaW4gdGhlIGBhcHByb3ZlKClgIGNhbGwKICAgIC8vLyBAcmV0dXJuIEZhbHNlIGlmIHRoZSBjb250cm9sbGVyIGRvZXMgbm90IGF1dGhvcml6ZSB0aGUgYXBwcm92YWwKICAgIGZ1bmN0aW9uIG9uQXBwcm92ZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYW1vdW50KQogICAgICAgIHJldHVybnMoYm9vbCk7Cn0KCmNvbnRyYWN0IENvbnRyb2xsZWQgewogICAgLy8vIEBub3RpY2UgVGhlIGFkZHJlc3Mgb2YgdGhlIGNvbnRyb2xsZXIgaXMgdGhlIG9ubHkgYWRkcmVzcyB0aGF0IGNhbiBjYWxsCiAgICAvLy8gIGEgZnVuY3Rpb24gd2l0aCB0aGlzIG1vZGlmaWVyCiAgICBtb2RpZmllciBvbmx5Q29udHJvbGxlciB7IGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHRocm93OyBfOyB9CgogICAgYWRkcmVzcyBwdWJsaWMgY29udHJvbGxlcjsKCiAgICBmdW5jdGlvbiBDb250cm9sbGVkKCkgeyBjb250cm9sbGVyID0gbXNnLnNlbmRlcjt9CgogICAgLy8vIEBub3RpY2UgQ2hhbmdlcyB0aGUgY29udHJvbGxlciBvZiB0aGUgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIG5ldyBjb250cm9sbGVyIG9mIHRoZSBjb250cmFjdAogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBvbmx5Q29udHJvbGxlciB7CiAgICAgICAgY29udHJvbGxlciA9IF9uZXdDb250cm9sbGVyOwogICAgfQp9Cgpjb250cmFjdCBBcHByb3ZlQW5kQ2FsbEZhbGxCYWNrIHsKICAgIGZ1bmN0aW9uIHJlY2VpdmVBcHByb3ZhbChhZGRyZXNzIGZyb20sIHVpbnQyNTYgX2Ftb3VudCwgYWRkcmVzcyBfdG9rZW4sIGJ5dGVzIF9kYXRhKTsKfQoKLy8vIEBkZXYgVGhlIGFjdHVhbCB0b2tlbiBjb250cmFjdCwgdGhlIGRlZmF1bHQgY29udHJvbGxlciBpcyB0aGUgbXNnLnNlbmRlcgovLy8gIHRoYXQgZGVwbG95cyB0aGUgY29udHJhY3QsIHNvIHVzdWFsbHkgdGhpcyB0b2tlbiB3aWxsIGJlIGRlcGxveWVkIGJ5IGEKLy8vICB0b2tlbiBjb250cm9sbGVyIGNvbnRyYWN0LCB3aGljaCBHaXZldGggd2lsbCBjYWxsIGEgIkNhbXBhaWduIgpjb250cmFjdCBNaW5pTWVUb2tlbiBpcyBDb250cm9sbGVkIHsKCiAgICBzdHJpbmcgcHVibGljIG5hbWU7ICAgICAgICAgICAgICAgIC8vVGhlIFRva2VuJ3MgbmFtZTogZS5nLiBEaWdpeERBTyBUb2tlbnMKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsgICAgICAgICAgICAgLy9OdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIHN0cmluZyBwdWJsaWMgc3ltYm9sOyAgICAgICAgICAgICAgLy9BbiBpZGVudGlmaWVyOiBlLmcuIFJFUAogICAgc3RyaW5nIHB1YmxpYyB2ZXJzaW9uID0gJ01NVF8wLjEnOyAvL0FuIGFyYml0cmFyeSB2ZXJzaW9uaW5nIHNjaGVtZQoKCiAgICAvLy8gQGRldiBgQ2hlY2twb2ludGAgaXMgdGhlIHN0cnVjdHVyZSB0aGF0IGF0dGFjaGVzIGEgYmxvY2sgbnVtYmVyIHRvIGEKICAgIC8vLyAgZ2l2ZW4gdmFsdWUsIHRoZSBibG9jayBudW1iZXIgYXR0YWNoZWQgaXMgdGhlIG9uZSB0aGF0IGxhc3QgY2hhbmdlZCB0aGUKICAgIC8vLyAgdmFsdWUKICAgIHN0cnVjdCAgQ2hlY2twb2ludCB7CgogICAgICAgIC8vIGBmcm9tQmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgdmFsdWUgd2FzIGdlbmVyYXRlZCBmcm9tCiAgICAgICAgdWludDEyOCBmcm9tQmxvY2s7CgogICAgICAgIC8vIGB2YWx1ZWAgaXMgdGhlIGFtb3VudCBvZiB0b2tlbnMgYXQgYSBzcGVjaWZpYyBibG9jayBudW1iZXIKICAgICAgICB1aW50MTI4IHZhbHVlOwogICAgfQoKICAgIC8vIGBwYXJlbnRUb2tlbmAgaXMgdGhlIFRva2VuIGFkZHJlc3MgdGhhdCB3YXMgY2xvbmVkIHRvIHByb2R1Y2UgdGhpcyB0b2tlbjsKICAgIC8vICBpdCB3aWxsIGJlIDB4MCBmb3IgYSB0b2tlbiB0aGF0IHdhcyBub3QgY2xvbmVkCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgcGFyZW50VG9rZW47CgogICAgLy8gYHBhcmVudFNuYXBTaG90QmxvY2tgIGlzIHRoZSBibG9jayBudW1iZXIgZnJvbSB0aGUgUGFyZW50IFRva2VuIHRoYXQgd2FzCiAgICAvLyAgdXNlZCB0byBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBDbG9uZSBUb2tlbgogICAgdWludCBwdWJsaWMgcGFyZW50U25hcFNob3RCbG9jazsKCiAgICAvLyBgY3JlYXRpb25CbG9ja2AgaXMgdGhlIGJsb2NrIG51bWJlciB0aGF0IHRoZSBDbG9uZSBUb2tlbiB3YXMgY3JlYXRlZAogICAgdWludCBwdWJsaWMgY3JlYXRpb25CbG9jazsKCiAgICAvLyBgYmFsYW5jZXNgIGlzIHRoZSBtYXAgdGhhdCB0cmFja3MgdGhlIGJhbGFuY2Ugb2YgZWFjaCBhZGRyZXNzLCBpbiB0aGlzCiAgICAvLyAgY29udHJhY3Qgd2hlbiB0aGUgYmFsYW5jZSBjaGFuZ2VzIHRoZSBibG9jayBudW1iZXIgdGhhdCB0aGUgY2hhbmdlCiAgICAvLyAgb2NjdXJyZWQgaXMgYWxzbyBpbmNsdWRlZCBpbiB0aGUgbWFwCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IENoZWNrcG9pbnRbXSkgYmFsYW5jZXM7CgogICAgLy8gYGFsbG93ZWRgIHRyYWNrcyBhbnkgZXh0cmEgdHJhbnNmZXIgcmlnaHRzIGFzIGluIGFsbCBFUkMyMCB0b2tlbnMKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCiAgICAvLyBUcmFja3MgdGhlIGhpc3Rvcnkgb2YgdGhlIGB0b3RhbFN1cHBseWAgb2YgdGhlIHRva2VuCiAgICBDaGVja3BvaW50W10gdG90YWxTdXBwbHlIaXN0b3J5OwoKICAgIC8vIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIHRoZSB0b2tlbiBpcyB0cmFuc2ZlcmFibGUgb3Igbm90LgogICAgYm9vbCBwdWJsaWMgdHJhbnNmZXJzRW5hYmxlZDsKCiAgICAvLyBUaGUgZmFjdG9yeSB1c2VkIHRvIGNyZWF0ZSBuZXcgY2xvbmUgdG9rZW5zCiAgICBNaW5pTWVUb2tlbkZhY3RvcnkgcHVibGljIHRva2VuRmFjdG9yeTsKCi8vLy8vLy8vLy8vLy8vLy8KLy8gQ29uc3RydWN0b3IKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIE1pbmlNZVRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbkZhY3RvcnkgVGhlIGFkZHJlc3Mgb2YgdGhlIE1pbmlNZVRva2VuRmFjdG9yeSBjb250cmFjdCB0aGF0CiAgICAvLy8gIHdpbGwgY3JlYXRlIHRoZSBDbG9uZSB0b2tlbiBjb250cmFjdHMsIHRoZSB0b2tlbiBmYWN0b3J5IG5lZWRzIHRvIGJlCiAgICAvLy8gIGRlcGxveWVkIGZpcnN0CiAgICAvLy8gQHBhcmFtIF9wYXJlbnRUb2tlbiBBZGRyZXNzIG9mIHRoZSBwYXJlbnQgdG9rZW4sIHNldCB0byAweDAgaWYgaXQgaXMgYQogICAgLy8vICBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFNuYXBTaG90QmxvY2sgQmxvY2sgb2YgdGhlIHBhcmVudCB0b2tlbiB0aGF0IHdpbGwKICAgIC8vLyAgZGV0ZXJtaW5lIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgY2xvbmUgdG9rZW4sIHNldCB0byAwIGlmIGl0CiAgICAvLy8gIGlzIGEgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlbk5hbWUgTmFtZSBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF9kZWNpbWFsVW5pdHMgTnVtYmVyIG9mIGRlY2ltYWxzIG9mIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuU3ltYm9sIFRva2VuIFN5bWJvbCBmb3IgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfdHJhbnNmZXJzRW5hYmxlZCBJZiB0cnVlLCB0b2tlbnMgd2lsbCBiZSBhYmxlIHRvIGJlIHRyYW5zZmVycmVkCiAgICBmdW5jdGlvbiBNaW5pTWVUb2tlbigKICAgICAgICBhZGRyZXNzIF90b2tlbkZhY3RvcnksCiAgICAgICAgYWRkcmVzcyBfcGFyZW50VG9rZW4sCiAgICAgICAgdWludCBfcGFyZW50U25hcFNob3RCbG9jaywKICAgICAgICBzdHJpbmcgX3Rva2VuTmFtZSwKICAgICAgICB1aW50OCBfZGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfdG9rZW5TeW1ib2wsCiAgICAgICAgYm9vbCBfdHJhbnNmZXJzRW5hYmxlZAogICAgKSB7CiAgICAgICAgdG9rZW5GYWN0b3J5ID0gTWluaU1lVG9rZW5GYWN0b3J5KF90b2tlbkZhY3RvcnkpOwogICAgICAgIG5hbWUgPSBfdG9rZW5OYW1lOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgbmFtZQogICAgICAgIGRlY2ltYWxzID0gX2RlY2ltYWxVbml0czsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZGVjaW1hbHMKICAgICAgICBzeW1ib2wgPSBfdG9rZW5TeW1ib2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHN5bWJvbAogICAgICAgIHBhcmVudFRva2VuID0gTWluaU1lVG9rZW4oX3BhcmVudFRva2VuKTsKICAgICAgICBwYXJlbnRTbmFwU2hvdEJsb2NrID0gX3BhcmVudFNuYXBTaG90QmxvY2s7CiAgICAgICAgdHJhbnNmZXJzRW5hYmxlZCA9IF90cmFuc2ZlcnNFbmFibGVkOwogICAgICAgIGNyZWF0aW9uQmxvY2sgPSBnZXRCbG9ja051bWJlcigpOwogICAgfQoKCi8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gRVJDMjAgTWV0aG9kcwovLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgU2VuZCBgX2Ftb3VudGAgdG9rZW5zIHRvIGBfdG9gIGZyb20gYG1zZy5zZW5kZXJgCiAgICAvLy8gQHBhcmFtIF90byBUaGUgYWRkcmVzcyBvZiB0aGUgcmVjaXBpZW50CiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgIC8vLyBAcmV0dXJuIFdoZXRoZXIgdGhlIHRyYW5zZmVyIHdhcyBzdWNjZXNzZnVsIG9yIG5vdAogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsKICAgICAgICByZXR1cm4gZG9UcmFuc2Zlcihtc2cuc2VuZGVyLCBfdG8sIF9hbW91bnQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFNlbmQgYF9hbW91bnRgIHRva2VucyB0byBgX3RvYCBmcm9tIGBfZnJvbWAgb24gdGhlIGNvbmRpdGlvbiBpdAogICAgLy8vICBpcyBhcHByb3ZlZCBieSBgX2Zyb21gCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CgogICAgICAgIC8vIFRoZSBjb250cm9sbGVyIG9mIHRoaXMgY29udHJhY3QgY2FuIG1vdmUgdG9rZW5zIGFyb3VuZCBhdCB3aWxsLAogICAgICAgIC8vICB0aGlzIGlzIGltcG9ydGFudCB0byByZWNvZ25pemUhIENvbmZpcm0gdGhhdCB5b3UgdHJ1c3QgdGhlCiAgICAgICAgLy8gIGNvbnRyb2xsZXIgb2YgdGhpcyBjb250cmFjdCwgd2hpY2ggaW4gbW9zdCBzaXR1YXRpb25zIHNob3VsZCBiZQogICAgICAgIC8vICBhbm90aGVyIG9wZW4gc291cmNlIHNtYXJ0IGNvbnRyYWN0IG9yIDB4MAogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGNvbnRyb2xsZXIpIHsKICAgICAgICAgICAgaWYgKCF0cmFuc2ZlcnNFbmFibGVkKSB0aHJvdzsKCiAgICAgICAgICAgIC8vIFRoZSBzdGFuZGFyZCBFUkMgMjAgdHJhbnNmZXJGcm9tIGZ1bmN0aW9uYWxpdHkKICAgICAgICAgICAgaWYgKGFsbG93ZWRbX2Zyb21dW21zZy5zZW5kZXJdIDwgX2Ftb3VudCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSAtPSBfYW1vdW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gZG9UcmFuc2ZlcihfZnJvbSwgX3RvLCBfYW1vdW50KTsKICAgIH0KCiAgICAvLy8gQGRldiBUaGlzIGlzIHRoZSBhY3R1YWwgdHJhbnNmZXIgZnVuY3Rpb24gaW4gdGhlIHRva2VuIGNvbnRyYWN0LCBpdCBjYW4KICAgIC8vLyAgb25seSBiZSBjYWxsZWQgYnkgb3RoZXIgZnVuY3Rpb25zIGluIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIGhvbGRpbmcgdGhlIHRva2VucyBiZWluZyB0cmFuc2ZlcnJlZAogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgb2YgdGhlIHJlY2lwaWVudAogICAgLy8vIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHRyYW5zZmVycmVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSB0cmFuc2ZlciB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gZG9UcmFuc2ZlcihhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludCBfYW1vdW50CiAgICApIGludGVybmFsIHJldHVybnMoYm9vbCkgewoKICAgICAgICAgICBpZiAoX2Ftb3VudCA9PSAwKSB7CiAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgIH0KCiAgICAgICAgICAgaWYgKHBhcmVudFNuYXBTaG90QmxvY2sgPj0gZ2V0QmxvY2tOdW1iZXIoKSkgdGhyb3c7CgogICAgICAgICAgIC8vIERvIG5vdCBhbGxvdyB0cmFuc2ZlciB0byAweDAgb3IgdGhlIHRva2VuIGNvbnRyYWN0IGl0c2VsZgogICAgICAgICAgIGlmICgoX3RvID09IDApIHx8IChfdG8gPT0gYWRkcmVzcyh0aGlzKSkpIHRocm93OwoKICAgICAgICAgICAvLyBJZiB0aGUgYW1vdW50IGJlaW5nIHRyYW5zZmVyZWQgaXMgbW9yZSB0aGFuIHRoZSBiYWxhbmNlIG9mIHRoZQogICAgICAgICAgIC8vICBhY2NvdW50IHRoZSB0cmFuc2ZlciByZXR1cm5zIGZhbHNlCiAgICAgICAgICAgdmFyIHByZXZpb3VzQmFsYW5jZUZyb20gPSBiYWxhbmNlT2ZBdChfZnJvbSwgZ2V0QmxvY2tOdW1iZXIoKSk7CiAgICAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB7CiAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEFsZXJ0cyB0aGUgdG9rZW4gY29udHJvbGxlciBvZiB0aGUgdHJhbnNmZXIKICAgICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICAgICBpZiAoIVRva2VuQ29udHJvbGxlcihjb250cm9sbGVyKS5vblRyYW5zZmVyKF9mcm9tLCBfdG8sIF9hbW91bnQpKQogICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICAgICB9CgogICAgICAgICAgIC8vIEZpcnN0IHVwZGF0ZSB0aGUgYmFsYW5jZSBhcnJheSB3aXRoIHRoZSBuZXcgdmFsdWUgZm9yIHRoZSBhZGRyZXNzCiAgICAgICAgICAgLy8gIHNlbmRpbmcgdGhlIHRva2VucwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX2Zyb21dLCBwcmV2aW91c0JhbGFuY2VGcm9tIC0gX2Ftb3VudCk7CgogICAgICAgICAgIC8vIFRoZW4gdXBkYXRlIHRoZSBiYWxhbmNlIGFycmF5IHdpdGggdGhlIG5ldyB2YWx1ZSBmb3IgdGhlIGFkZHJlc3MKICAgICAgICAgICAvLyAgcmVjZWl2aW5nIHRoZSB0b2tlbnMKICAgICAgICAgICB2YXIgcHJldmlvdXNCYWxhbmNlVG8gPSBiYWxhbmNlT2ZBdChfdG8sIGdldEJsb2NrTnVtYmVyKCkpOwogICAgICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPCBwcmV2aW91c0JhbGFuY2VUbykgdGhyb3c7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX3RvXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKCiAgICAgICAgICAgLy8gQW4gZXZlbnQgdG8gbWFrZSB0aGUgdHJhbnNmZXIgZWFzeSB0byBmaW5kIG9uIHRoZSBibG9ja2NoYWluCiAgICAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX2Ftb3VudCk7CgogICAgICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQncyBiYWxhbmNlIGlzIGJlaW5nIHJlcXVlc3RlZAogICAgLy8vIEByZXR1cm4gVGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgdGhlIGN1cnJlbnQgYmxvY2sKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIF9vd25lcikgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICAgICAgcmV0dXJuIGJhbGFuY2VPZkF0KF9vd25lciwgZ2V0QmxvY2tOdW1iZXIoKSk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgYG1zZy5zZW5kZXJgIGFwcHJvdmVzIGBfc3BlbmRlcmAgdG8gc3BlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLiBUaGlzIGlzIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgRVJDMjAgYXBwcm92ZSBmdW5jdGlvbgogICAgLy8vICB0byBiZSBhIGxpdHRsZSBiaXQgc2FmZXIKICAgIC8vLyBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBhcHByb3ZhbCB3YXMgc3VjY2Vzc2Z1bAogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQpIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIGlmICghdHJhbnNmZXJzRW5hYmxlZCkgdGhyb3c7CgogICAgICAgIC8vIFRvIGNoYW5nZSB0aGUgYXBwcm92ZSBhbW91bnQgeW91IGZpcnN0IGhhdmUgdG8gcmVkdWNlIHRoZSBhZGRyZXNzZXNgCiAgICAgICAgLy8gIGFsbG93YW5jZSB0byB6ZXJvIGJ5IGNhbGxpbmcgYGFwcHJvdmUoX3NwZW5kZXIsMClgIGlmIGl0IGlzIG5vdAogICAgICAgIC8vICBhbHJlYWR5IDAgdG8gbWl0aWdhdGUgdGhlIHJhY2UgY29uZGl0aW9uIGRlc2NyaWJlZCBoZXJlOgogICAgICAgIC8vICBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAjaXNzdWVjb21tZW50LTI2MzUyNDcyOQogICAgICAgIGlmICgoX2Ftb3VudCE9MCkgJiYgKGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdICE9MCkpIHRocm93OwoKICAgICAgICAvLyBBbGVydHMgdGhlIHRva2VuIGNvbnRyb2xsZXIgb2YgdGhlIGFwcHJvdmUgZnVuY3Rpb24gY2FsbAogICAgICAgIGlmIChpc0NvbnRyYWN0KGNvbnRyb2xsZXIpKSB7CiAgICAgICAgICAgIGlmICghVG9rZW5Db250cm9sbGVyKGNvbnRyb2xsZXIpLm9uQXBwcm92ZShtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCkpCiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CgogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX2Ftb3VudDsKICAgICAgICBBcHByb3ZhbChtc2cuc2VuZGVyLCBfc3BlbmRlciwgX2Ftb3VudCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBkZXYgVGhpcyBmdW5jdGlvbiBtYWtlcyBpdCBlYXN5IHRvIHJlYWQgdGhlIGBhbGxvd2VkW11gIG1hcAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIGFjY291bnQgdGhhdCBvd25zIHRoZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgYWNjb3VudCBhYmxlIHRvIHRyYW5zZmVyIHRoZSB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIEFtb3VudCBvZiByZW1haW5pbmcgdG9rZW5zIG9mIF9vd25lciB0aGF0IF9zcGVuZGVyIGlzIGFsbG93ZWQKICAgIC8vLyAgdG8gc3BlbmQKICAgIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcgogICAgKSBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IHJlbWFpbmluZykgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGBtc2cuc2VuZGVyYCBhcHByb3ZlcyBgX3NwZW5kZXJgIHRvIHNlbmQgYF9hbW91bnRgIHRva2VucyBvbgogICAgLy8vICBpdHMgYmVoYWxmLCBhbmQgdGhlbiBhIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpbiB0aGUgY29udHJhY3QgdGhhdCBpcwogICAgLy8vICBiZWluZyBhcHByb3ZlZCwgYF9zcGVuZGVyYC4gVGhpcyBhbGxvd3MgdXNlcnMgdG8gdXNlIHRoZWlyIHRva2VucyB0bwogICAgLy8vICBpbnRlcmFjdCB3aXRoIGNvbnRyYWN0cyBpbiBvbmUgZnVuY3Rpb24gY2FsbCBpbnN0ZWFkIG9mIHR3bwogICAgLy8vIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgYWJsZSB0byB0cmFuc2ZlciB0aGUgdG9rZW5zCiAgICAvLy8gQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYXBwcm92ZWQgZm9yIHRyYW5zZmVyCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIHRoZSBmdW5jdGlvbiBjYWxsIHdhcyBzdWNjZXNzZnVsCiAgICBmdW5jdGlvbiBhcHByb3ZlQW5kQ2FsbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF9hbW91bnQsIGJ5dGVzIF9leHRyYURhdGEKICAgICkgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgaWYgKCFhcHByb3ZlKF9zcGVuZGVyLCBfYW1vdW50KSkgdGhyb3c7CgogICAgICAgIEFwcHJvdmVBbmRDYWxsRmFsbEJhY2soX3NwZW5kZXIpLnJlY2VpdmVBcHByb3ZhbCgKICAgICAgICAgICAgbXNnLnNlbmRlciwKICAgICAgICAgICAgX2Ftb3VudCwKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgX2V4dHJhRGF0YQogICAgICAgICk7CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFRoaXMgZnVuY3Rpb24gbWFrZXMgaXQgZWFzeSB0byBnZXQgdGhlIHRvdGFsIG51bWJlciBvZiB0b2tlbnMKICAgIC8vLyBAcmV0dXJuIFRoZSB0b3RhbCBudW1iZXIgb2YgdG9rZW5zCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIGNvbnN0YW50IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlBdChnZXRCbG9ja051bWJlcigpKTsKICAgIH0KCgovLy8vLy8vLy8vLy8vLy8vCi8vIFF1ZXJ5IGJhbGFuY2UgYW5kIHRvdGFsU3VwcGx5IGluIEhpc3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAZGV2IFF1ZXJpZXMgdGhlIGJhbGFuY2Ugb2YgYF9vd25lcmAgYXQgYSBzcGVjaWZpYyBgX2Jsb2NrTnVtYmVyYAogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIGFkZHJlc3MgZnJvbSB3aGljaCB0aGUgYmFsYW5jZSB3aWxsIGJlIHJldHJpZXZlZAogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSBiYWxhbmNlIGlzIHF1ZXJpZWQKICAgIC8vLyBAcmV0dXJuIFRoZSBiYWxhbmNlIGF0IGBfYmxvY2tOdW1iZXJgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2ZBdChhZGRyZXNzIF9vd25lciwgdWludCBfYmxvY2tOdW1iZXIpIGNvbnN0YW50CiAgICAgICAgcmV0dXJucyAodWludCkgewoKICAgICAgICAvLyBUaGVzZSBuZXh0IGZldyBsaW5lcyBhcmUgdXNlZCB3aGVuIHRoZSBiYWxhbmNlIG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLmJhbGFuY2VPZkF0YCBiZSBxdWVyaWVkIGF0IHRoZQogICAgICAgIC8vICBnZW5lc2lzIGJsb2NrIGZvciB0aGF0IHRva2VuIGFzIHRoaXMgY29udGFpbnMgaW5pdGlhbCBiYWxhbmNlIG9mCiAgICAgICAgLy8gIHRoaXMgdG9rZW4KICAgICAgICBpZiAoKGJhbGFuY2VzW19vd25lcl0ubGVuZ3RoID09IDApCiAgICAgICAgICAgIHx8IChiYWxhbmNlc1tfb3duZXJdWzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi5iYWxhbmNlT2ZBdChfb3duZXIsIG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEhhcyBubyBwYXJlbnQKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIGJhbGFuY2UgZHVyaW5nIG5vcm1hbCBzaXR1YXRpb25zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlQXQoYmFsYW5jZXNbX293bmVyXSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8vIEBub3RpY2UgVG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBhIHNwZWNpZmljIGBfYmxvY2tOdW1iZXJgLgogICAgLy8vIEBwYXJhbSBfYmxvY2tOdW1iZXIgVGhlIGJsb2NrIG51bWJlciB3aGVuIHRoZSB0b3RhbFN1cHBseSBpcyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUaGUgdG90YWwgYW1vdW50IG9mIHRva2VucyBhdCBgX2Jsb2NrTnVtYmVyYAogICAgZnVuY3Rpb24gdG90YWxTdXBwbHlBdCh1aW50IF9ibG9ja051bWJlcikgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CgogICAgICAgIC8vIFRoZXNlIG5leHQgZmV3IGxpbmVzIGFyZSB1c2VkIHdoZW4gdGhlIHRvdGFsU3VwcGx5IG9mIHRoZSB0b2tlbiBpcwogICAgICAgIC8vICByZXF1ZXN0ZWQgYmVmb3JlIGEgY2hlY2sgcG9pbnQgd2FzIGV2ZXIgY3JlYXRlZCBmb3IgdGhpcyB0b2tlbiwgaXQKICAgICAgICAvLyAgcmVxdWlyZXMgdGhhdCB0aGUgYHBhcmVudFRva2VuLnRvdGFsU3VwcGx5QXRgIGJlIHF1ZXJpZWQgYXQgdGhlCiAgICAgICAgLy8gIGdlbmVzaXMgYmxvY2sgZm9yIHRoaXMgdG9rZW4gYXMgdGhhdCBjb250YWlucyB0b3RhbFN1cHBseSBvZiB0aGlzCiAgICAgICAgLy8gIHRva2VuIGF0IHRoaXMgYmxvY2sgbnVtYmVyLgogICAgICAgIGlmICgodG90YWxTdXBwbHlIaXN0b3J5Lmxlbmd0aCA9PSAwKQogICAgICAgICAgICB8fCAodG90YWxTdXBwbHlIaXN0b3J5WzBdLmZyb21CbG9jayA+IF9ibG9ja051bWJlcikpIHsKICAgICAgICAgICAgaWYgKGFkZHJlc3MocGFyZW50VG9rZW4pICE9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRUb2tlbi50b3RhbFN1cHBseUF0KG1pbihfYmxvY2tOdW1iZXIsIHBhcmVudFNuYXBTaG90QmxvY2spKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgIC8vIFRoaXMgd2lsbCByZXR1cm4gdGhlIGV4cGVjdGVkIHRvdGFsU3VwcGx5IGR1cmluZyBub3JtYWwgc2l0dWF0aW9ucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRWYWx1ZUF0KHRvdGFsU3VwcGx5SGlzdG9yeSwgX2Jsb2NrTnVtYmVyKTsKICAgICAgICB9CiAgICB9CgovLy8vLy8vLy8vLy8vLy8vCi8vIENsb25lIFRva2VuIE1ldGhvZAovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgQ3JlYXRlcyBhIG5ldyBjbG9uZSB0b2tlbiB3aXRoIHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBiZWluZwogICAgLy8vICB0aGlzIHRva2VuIGF0IGBfc25hcHNob3RCbG9ja2AKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5OYW1lIE5hbWUgb2YgdGhlIGNsb25lIHRva2VuCiAgICAvLy8gQHBhcmFtIF9jbG9uZURlY2ltYWxVbml0cyBOdW1iZXIgb2YgZGVjaW1hbHMgb2YgdGhlIHNtYWxsZXN0IHVuaXQKICAgIC8vLyBAcGFyYW0gX2Nsb25lVG9rZW5TeW1ib2wgU3ltYm9sIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayB3aGVuIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBhcmVudCB0b2tlbiBpcwogICAgLy8vICBjb3BpZWQgdG8gc2V0IHRoZSBpbml0aWFsIGRpc3RyaWJ1dGlvbiBvZiB0aGUgbmV3IGNsb25lIHRva2VuOwogICAgLy8vICBpZiB0aGUgYmxvY2sgaXMgemVybyB0aGFuIHRoZSBhY3R1YWwgYmxvY2ssIHRoZSBjdXJyZW50IGJsb2NrIGlzIHVzZWQKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICAvLy8gQHJldHVybiBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IE1pbmlNZVRva2VuIENvbnRyYWN0CiAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZVRva2VuKAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlbk5hbWUsCiAgICAgICAgdWludDggX2Nsb25lRGVjaW1hbFVuaXRzLAogICAgICAgIHN0cmluZyBfY2xvbmVUb2tlblN5bWJvbCwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIGJvb2wgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICApIHJldHVybnMoYWRkcmVzcykgewogICAgICAgIGlmIChfc25hcHNob3RCbG9jayA9PSAwKSBfc25hcHNob3RCbG9jayA9IGdldEJsb2NrTnVtYmVyKCk7CiAgICAgICAgTWluaU1lVG9rZW4gY2xvbmVUb2tlbiA9IHRva2VuRmFjdG9yeS5jcmVhdGVDbG9uZVRva2VuKAogICAgICAgICAgICB0aGlzLAogICAgICAgICAgICBfc25hcHNob3RCbG9jaywKICAgICAgICAgICAgX2Nsb25lVG9rZW5OYW1lLAogICAgICAgICAgICBfY2xvbmVEZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF9jbG9uZVRva2VuU3ltYm9sLAogICAgICAgICAgICBfdHJhbnNmZXJzRW5hYmxlZAogICAgICAgICAgICApOwoKICAgICAgICBjbG9uZVRva2VuLmNoYW5nZUNvbnRyb2xsZXIobXNnLnNlbmRlcik7CgogICAgICAgIC8vIEFuIGV2ZW50IHRvIG1ha2UgdGhlIHRva2VuIGVhc3kgdG8gZmluZCBvbiB0aGUgYmxvY2tjaGFpbgogICAgICAgIE5ld0Nsb25lVG9rZW4oYWRkcmVzcyhjbG9uZVRva2VuKSwgX3NuYXBzaG90QmxvY2spOwogICAgICAgIHJldHVybiBhZGRyZXNzKGNsb25lVG9rZW4pOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBHZW5lcmF0ZSBhbmQgZGVzdHJveSB0b2tlbnMKLy8vLy8vLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIEdlbmVyYXRlcyBgX2Ftb3VudGAgdG9rZW5zIHRoYXQgYXJlIGFzc2lnbmVkIHRvIGBfb3duZXJgCiAgICAvLy8gQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgYmUgYXNzaWduZWQgdGhlIG5ldyB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIGdlbmVyYXRlZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiB0aGUgdG9rZW5zIGFyZSBnZW5lcmF0ZWQgY29ycmVjdGx5CiAgICBmdW5jdGlvbiBnZW5lcmF0ZVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGdldEJsb2NrTnVtYmVyKCkpOwogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSArIF9hbW91bnQgPCBjdXJUb3RhbFN1cHBseSkgdGhyb3c7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSArIF9hbW91bnQpOwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VUbyA9IGJhbGFuY2VPZihfb3duZXIpOwogICAgICAgIGlmIChwcmV2aW91c0JhbGFuY2VUbyArIF9hbW91bnQgPCBwcmV2aW91c0JhbGFuY2VUbykgdGhyb3c7IC8vIENoZWNrIGZvciBvdmVyZmxvdwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3coYmFsYW5jZXNbX293bmVyXSwgcHJldmlvdXNCYWxhbmNlVG8gKyBfYW1vdW50KTsKICAgICAgICBUcmFuc2ZlcigwLCBfb3duZXIsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBCdXJucyBgX2Ftb3VudGAgdG9rZW5zIGZyb20gYF9vd25lcmAKICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCBsb3NlIHRoZSB0b2tlbnMKICAgIC8vLyBAcGFyYW0gX2Ftb3VudCBUaGUgcXVhbnRpdHkgb2YgdG9rZW5zIHRvIGJ1cm4KICAgIC8vLyBAcmV0dXJuIFRydWUgaWYgdGhlIHRva2VucyBhcmUgYnVybmVkIGNvcnJlY3RseQogICAgZnVuY3Rpb24gZGVzdHJveVRva2VucyhhZGRyZXNzIF9vd25lciwgdWludCBfYW1vdW50CiAgICApIG9ubHlDb250cm9sbGVyIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IGN1clRvdGFsU3VwcGx5ID0gZ2V0VmFsdWVBdCh0b3RhbFN1cHBseUhpc3RvcnksIGdldEJsb2NrTnVtYmVyKCkpOwogICAgICAgIGlmIChjdXJUb3RhbFN1cHBseSA8IF9hbW91bnQpIHRocm93OwogICAgICAgIHVwZGF0ZVZhbHVlQXROb3codG90YWxTdXBwbHlIaXN0b3J5LCBjdXJUb3RhbFN1cHBseSAtIF9hbW91bnQpOwogICAgICAgIHZhciBwcmV2aW91c0JhbGFuY2VGcm9tID0gYmFsYW5jZU9mKF9vd25lcik7CiAgICAgICAgaWYgKHByZXZpb3VzQmFsYW5jZUZyb20gPCBfYW1vdW50KSB0aHJvdzsKICAgICAgICB1cGRhdGVWYWx1ZUF0Tm93KGJhbGFuY2VzW19vd25lcl0sIHByZXZpb3VzQmFsYW5jZUZyb20gLSBfYW1vdW50KTsKICAgICAgICBUcmFuc2Zlcihfb3duZXIsIDAsIF9hbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKLy8vLy8vLy8vLy8vLy8vLwovLyBFbmFibGUgdG9rZW5zIHRyYW5zZmVycwovLy8vLy8vLy8vLy8vLy8vCgoKICAgIC8vLyBAbm90aWNlIEVuYWJsZXMgdG9rZW4gaG9sZGVycyB0byB0cmFuc2ZlciB0aGVpciB0b2tlbnMgZnJlZWx5IGlmIHRydWUKICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgVHJ1ZSBpZiB0cmFuc2ZlcnMgYXJlIGFsbG93ZWQgaW4gdGhlIGNsb25lCiAgICBmdW5jdGlvbiBlbmFibGVUcmFuc2ZlcnMoYm9vbCBfdHJhbnNmZXJzRW5hYmxlZCkgb25seUNvbnRyb2xsZXIgewogICAgICAgIHRyYW5zZmVyc0VuYWJsZWQgPSBfdHJhbnNmZXJzRW5hYmxlZDsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gSW50ZXJuYWwgaGVscGVyIGZ1bmN0aW9ucyB0byBxdWVyeSBhbmQgc2V0IGEgdmFsdWUgaW4gYSBzbmFwc2hvdCBhcnJheQovLy8vLy8vLy8vLy8vLy8vCgogICAgLy8vIEBkZXYgYGdldFZhbHVlQXRgIHJldHJpZXZlcyB0aGUgbnVtYmVyIG9mIHRva2VucyBhdCBhIGdpdmVuIGJsb2NrIG51bWJlcgogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiB2YWx1ZXMgYmVpbmcgcXVlcmllZAogICAgLy8vIEBwYXJhbSBfYmxvY2sgVGhlIGJsb2NrIG51bWJlciB0byByZXRyaWV2ZSB0aGUgdmFsdWUgYXQKICAgIC8vLyBAcmV0dXJuIFRoZSBudW1iZXIgb2YgdG9rZW5zIGJlaW5nIHF1ZXJpZWQKICAgIGZ1bmN0aW9uIGdldFZhbHVlQXQoQ2hlY2twb2ludFtdIHN0b3JhZ2UgY2hlY2twb2ludHMsIHVpbnQgX2Jsb2NrCiAgICApIGNvbnN0YW50IGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBpZiAoY2hlY2twb2ludHMubGVuZ3RoID09IDApIHJldHVybiAwOwoKICAgICAgICAvLyBTaG9ydGN1dCBmb3IgdGhlIGFjdHVhbCB2YWx1ZQogICAgICAgIGlmIChfYmxvY2sgPj0gY2hlY2twb2ludHNbY2hlY2twb2ludHMubGVuZ3RoLTFdLmZyb21CbG9jaykKICAgICAgICAgICAgcmV0dXJuIGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXS52YWx1ZTsKICAgICAgICBpZiAoX2Jsb2NrIDwgY2hlY2twb2ludHNbMF0uZnJvbUJsb2NrKSByZXR1cm4gMDsKCiAgICAgICAgLy8gQmluYXJ5IHNlYXJjaCBvZiB0aGUgdmFsdWUgaW4gdGhlIGFycmF5CiAgICAgICAgdWludCBtaW4gPSAwOwogICAgICAgIHVpbnQgbWF4ID0gY2hlY2twb2ludHMubGVuZ3RoLTE7CiAgICAgICAgd2hpbGUgKG1heCA+IG1pbikgewogICAgICAgICAgICB1aW50IG1pZCA9IChtYXggKyBtaW4gKyAxKS8gMjsKICAgICAgICAgICAgaWYgKGNoZWNrcG9pbnRzW21pZF0uZnJvbUJsb2NrPD1fYmxvY2spIHsKICAgICAgICAgICAgICAgIG1pbiA9IG1pZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1heCA9IG1pZC0xOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjaGVja3BvaW50c1ttaW5dLnZhbHVlOwogICAgfQoKICAgIC8vLyBAZGV2IGB1cGRhdGVWYWx1ZUF0Tm93YCB1c2VkIHRvIHVwZGF0ZSB0aGUgYGJhbGFuY2VzYCBtYXAgYW5kIHRoZQogICAgLy8vICBgdG90YWxTdXBwbHlIaXN0b3J5YAogICAgLy8vIEBwYXJhbSBjaGVja3BvaW50cyBUaGUgaGlzdG9yeSBvZiBkYXRhIGJlaW5nIHVwZGF0ZWQKICAgIC8vLyBAcGFyYW0gX3ZhbHVlIFRoZSBuZXcgbnVtYmVyIG9mIHRva2VucwogICAgZnVuY3Rpb24gdXBkYXRlVmFsdWVBdE5vdyhDaGVja3BvaW50W10gc3RvcmFnZSBjaGVja3BvaW50cywgdWludCBfdmFsdWUKICAgICkgaW50ZXJuYWwgIHsKICAgICAgICBpZiAoKGNoZWNrcG9pbnRzLmxlbmd0aCA9PSAwKQogICAgICAgIHx8IChjaGVja3BvaW50c1tjaGVja3BvaW50cy5sZW5ndGggLTFdLmZyb21CbG9jayA8IGdldEJsb2NrTnVtYmVyKCkpKSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgbmV3Q2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzWyBjaGVja3BvaW50cy5sZW5ndGgrKyBdOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LmZyb21CbG9jayA9ICB1aW50MTI4KGdldEJsb2NrTnVtYmVyKCkpOwogICAgICAgICAgICAgICBuZXdDaGVja1BvaW50LnZhbHVlID0gdWludDEyOChfdmFsdWUpOwogICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIENoZWNrcG9pbnQgb2xkQ2hlY2tQb2ludCA9IGNoZWNrcG9pbnRzW2NoZWNrcG9pbnRzLmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgb2xkQ2hlY2tQb2ludC52YWx1ZSA9IHVpbnQxMjgoX3ZhbHVlKTsKICAgICAgICAgICB9CiAgICB9CgogICAgLy8vIEBkZXYgSW50ZXJuYWwgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGFuIGFkZHJlc3MgaXMgYSBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfYWRkciBUaGUgYWRkcmVzcyBiZWluZyBxdWVyaWVkCiAgICAvLy8gQHJldHVybiBUcnVlIGlmIGBfYWRkcmAgaXMgYSBjb250cmFjdAogICAgZnVuY3Rpb24gaXNDb250cmFjdChhZGRyZXNzIF9hZGRyKSBjb25zdGFudCBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICB1aW50IHNpemU7CiAgICAgICAgaWYgKF9hZGRyID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBzaXplPjA7CiAgICB9CgogICAgLy8vIEBkZXYgSGVscGVyIGZ1bmN0aW9uIHRvIHJldHVybiBhIG1pbiBiZXR3ZW4gdGhlIHR3byB1aW50cwogICAgZnVuY3Rpb24gbWluKHVpbnQgYSwgdWludCBiKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgPCBiID8gYSA6IGI7CiAgICB9CgogICAgLy8vIEBub3RpY2UgVGhlIGZhbGxiYWNrIGZ1bmN0aW9uOiBJZiB0aGUgY29udHJhY3QncyBjb250cm9sbGVyIGhhcyBub3QgYmVlbgogICAgLy8vICBzZXQgdG8gMCwgdGhlbiB0aGUgYHByb3h5UGF5bWVudGAgbWV0aG9kIGlzIGNhbGxlZCB3aGljaCByZWxheXMgdGhlCiAgICAvLy8gIGV0aGVyIGFuZCBjcmVhdGVzIHRva2VucyBhcyBkZXNjcmliZWQgaW4gdGhlIHRva2VuIGNvbnRyb2xsZXIgY29udHJhY3QKICAgIGZ1bmN0aW9uICgpICBwYXlhYmxlIHsKICAgICAgICBpZiAoaXNDb250cmFjdChjb250cm9sbGVyKSkgewogICAgICAgICAgICBpZiAoISBUb2tlbkNvbnRyb2xsZXIoY29udHJvbGxlcikucHJveHlQYXltZW50LnZhbHVlKG1zZy52YWx1ZSkobXNnLnNlbmRlcikpCiAgICAgICAgICAgICAgICB0aHJvdzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdzsKICAgICAgICB9CiAgICB9CgoKLy8vLy8vLy8vLwovLyBUZXN0aW5nIHNwZWNpZmljIG1ldGhvZHMKLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbiBieSB0aGUgdGVzdCBNb2Nrcy4KICAgIGZ1bmN0aW9uIGdldEJsb2NrTnVtYmVyKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBibG9jay5udW1iZXI7CiAgICB9CgovLy8vLy8vLy8vCi8vIFNhZmV0eSBNZXRob2RzCi8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIG9ubHlDb250cm9sbGVyIHsKICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgewogICAgICAgICAgICBjb250cm9sbGVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIEVSQzIwVG9rZW4gdG9rZW4gPSBFUkMyMFRva2VuKF90b2tlbik7CiAgICAgICAgdWludCBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKGNvbnRyb2xsZXIsIGJhbGFuY2UpOwogICAgICAgIENsYWltZWRUb2tlbnMoX3Rva2VuLCBjb250cm9sbGVyLCBiYWxhbmNlKTsKICAgIH0KCi8vLy8vLy8vLy8vLy8vLy8KLy8gRXZlbnRzCi8vLy8vLy8vLy8vLy8vLy8KCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludCBfYW1vdW50KTsKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBfZnJvbSwgYWRkcmVzcyBpbmRleGVkIF90bywgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IE5ld0Nsb25lVG9rZW4oYWRkcmVzcyBpbmRleGVkIF9jbG9uZVRva2VuLCB1aW50IF9zbmFwc2hvdEJsb2NrKTsKICAgIGV2ZW50IEFwcHJvdmFsKAogICAgICAgIGFkZHJlc3MgaW5kZXhlZCBfb3duZXIsCiAgICAgICAgYWRkcmVzcyBpbmRleGVkIF9zcGVuZGVyLAogICAgICAgIHVpbnQyNTYgX2Ftb3VudAogICAgICAgICk7Cgp9CgoKLy8vLy8vLy8vLy8vLy8vLwovLyBNaW5pTWVUb2tlbkZhY3RvcnkKLy8vLy8vLy8vLy8vLy8vLwoKLy8vIEBkZXYgVGhpcyBjb250cmFjdCBpcyB1c2VkIHRvIGdlbmVyYXRlIGNsb25lIGNvbnRyYWN0cyBmcm9tIGEgY29udHJhY3QuCi8vLyAgSW4gc29saWRpdHkgdGhpcyBpcyB0aGUgd2F5IHRvIGNyZWF0ZSBhIGNvbnRyYWN0IGZyb20gYSBjb250cmFjdCBvZiB0aGUKLy8vICBzYW1lIGNsYXNzCmNvbnRyYWN0IE1pbmlNZVRva2VuRmFjdG9yeSB7CgogICAgLy8vIEBub3RpY2UgVXBkYXRlIHRoZSBEQXBwIGJ5IGNyZWF0aW5nIGEgbmV3IHRva2VuIHdpdGggbmV3IGZ1bmN0aW9uYWxpdGllcwogICAgLy8vICB0aGUgbXNnLnNlbmRlciBiZWNvbWVzIHRoZSBjb250cm9sbGVyIG9mIHRoaXMgY2xvbmUgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3BhcmVudFRva2VuIEFkZHJlc3Mgb2YgdGhlIHRva2VuIGJlaW5nIGNsb25lZAogICAgLy8vIEBwYXJhbSBfc25hcHNob3RCbG9jayBCbG9jayBvZiB0aGUgcGFyZW50IHRva2VuIHRoYXQgd2lsbAogICAgLy8vICBkZXRlcm1pbmUgdGhlIGluaXRpYWwgZGlzdHJpYnV0aW9uIG9mIHRoZSBjbG9uZSB0b2tlbgogICAgLy8vIEBwYXJhbSBfdG9rZW5OYW1lIE5hbWUgb2YgdGhlIG5ldyB0b2tlbgogICAgLy8vIEBwYXJhbSBfZGVjaW1hbFVuaXRzIE51bWJlciBvZiBkZWNpbWFscyBvZiB0aGUgbmV3IHRva2VuCiAgICAvLy8gQHBhcmFtIF90b2tlblN5bWJvbCBUb2tlbiBTeW1ib2wgZm9yIHRoZSBuZXcgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3RyYW5zZmVyc0VuYWJsZWQgSWYgdHJ1ZSwgdG9rZW5zIHdpbGwgYmUgYWJsZSB0byBiZSB0cmFuc2ZlcnJlZAogICAgLy8vIEByZXR1cm4gVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyB0b2tlbiBjb250cmFjdAogICAgZnVuY3Rpb24gY3JlYXRlQ2xvbmVUb2tlbigKICAgICAgICBhZGRyZXNzIF9wYXJlbnRUb2tlbiwKICAgICAgICB1aW50IF9zbmFwc2hvdEJsb2NrLAogICAgICAgIHN0cmluZyBfdG9rZW5OYW1lLAogICAgICAgIHVpbnQ4IF9kZWNpbWFsVW5pdHMsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICBib29sIF90cmFuc2ZlcnNFbmFibGVkCiAgICApIHJldHVybnMgKE1pbmlNZVRva2VuKSB7CiAgICAgICAgTWluaU1lVG9rZW4gbmV3VG9rZW4gPSBuZXcgTWluaU1lVG9rZW4oCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIF9wYXJlbnRUb2tlbiwKICAgICAgICAgICAgX3NuYXBzaG90QmxvY2ssCiAgICAgICAgICAgIF90b2tlbk5hbWUsCiAgICAgICAgICAgIF9kZWNpbWFsVW5pdHMsCiAgICAgICAgICAgIF90b2tlblN5bWJvbCwKICAgICAgICAgICAgX3RyYW5zZmVyc0VuYWJsZWQKICAgICAgICAgICAgKTsKCiAgICAgICAgbmV3VG9rZW4uY2hhbmdlQ29udHJvbGxlcihtc2cuc2VuZGVyKTsKICAgICAgICByZXR1cm4gbmV3VG9rZW47CiAgICB9Cn0KCgovKgogICAgQ29weXJpZ2h0IDIwMTcsIEphcnJhZCBIb3BlIChTdGF0dXMgUmVzZWFyY2ggJiBEZXZlbG9wbWVudCBHbWJIKQoqLwoKCmNvbnRyYWN0IFNOVCBpcyBNaW5pTWVUb2tlbiB7CiAgICAvLyBAZGV2IFNOVCBjb25zdHJ1Y3RvciBqdXN0IHBhcmFtZXRyaXplcyB0aGUgTWluaU1lSXJyZXZvY2FibGVWZXN0ZWRUb2tlbiBjb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gU05UKGFkZHJlc3MgX3Rva2VuRmFjdG9yeSkKICAgICAgICAgICAgTWluaU1lVG9rZW4oCiAgICAgICAgICAgICAgICBfdG9rZW5GYWN0b3J5LAogICAgICAgICAgICAgICAgMHgwLCAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHBhcmVudCB0b2tlbgogICAgICAgICAgICAgICAgMCwgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIHNuYXBzaG90IGJsb2NrIG51bWJlciBmcm9tIHBhcmVudAogICAgICAgICAgICAgICAgIlN0YXR1cyBOZXR3b3JrIFRva2VuIiwgIC8vIFRva2VuIG5hbWUKICAgICAgICAgICAgICAgIDE4LCAgICAgICAgICAgICAgICAgICAgICAvLyBEZWNpbWFscwogICAgICAgICAgICAgICAgIlNOVCIsICAgICAgICAgICAgICAgICAgIC8vIFN5bWJvbAogICAgICAgICAgICAgICAgdHJ1ZSAgICAgICAgICAgICAgICAgICAgIC8vIEVuYWJsZSB0cmFuc2ZlcnMKICAgICAgICAgICAgKSB7fQp9CgoKLyoKICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCgovLy8gQHRpdGxlIFN0YXR1c0NvbnRyaWJ1dGlvbiBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoaXMgY29udHJhY3Qgd2lsbCBiZSB0aGUgU05UIGNvbnRyb2xsZXIgZHVyaW5nIHRoZSBjb250cmlidXRpb24gcGVyaW9kLgovLy8gIFRoaXMgY29udHJhY3Qgd2lsbCBkZXRlcm1pbmUgdGhlIHJ1bGVzIGR1cmluZyB0aGlzIHBlcmlvZC4KLy8vICBGaW5hbCB1c2VycyB3aWxsIGdlbmVyYWxseSBub3QgaW50ZXJhY3QgZGlyZWN0bHkgd2l0aCB0aGlzIGNvbnRyYWN0LiBFVEggd2lsbAovLy8gIGJlIHNlbnQgdG8gdGhlIFNOVCB0b2tlbiBjb250cmFjdC4gVGhlIEVUSCBpcyBzZW50IHRvIHRoaXMgY29udHJhY3QgYW5kIGZyb20gaGVyZSwKLy8vICBFVEggaXMgc2VudCB0byB0aGUgY29udHJpYnV0aW9uIHdhbGxlZCBhbmQgU05UcyBhcmUgbWluZWQgYWNjb3JkaW5nIHRvIHRoZSBkZWZpbmVkCi8vLyAgcnVsZXMuCgoKY29udHJhY3QgU3RhdHVzQ29udHJpYnV0aW9uIGlzIE93bmVkLCBUb2tlbkNvbnRyb2xsZXIgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgZmFpbFNhZmVMaW1pdCA9IDMwMDAwMCBldGhlcjsKICAgIHVpbnQyNTYgY29uc3RhbnQgcHVibGljIG1heEd1YXJhbnRlZWRMaW1pdCA9IDMwMDAwIGV0aGVyOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgZXhjaGFuZ2VSYXRlID0gMTAwMDA7CiAgICB1aW50MjU2IGNvbnN0YW50IHB1YmxpYyBtYXhHYXNQcmljZSA9IDUwMDAwMDAwMDAwOwogICAgdWludDI1NiBjb25zdGFudCBwdWJsaWMgbWF4Q2FsbEZyZXF1ZW5jeSA9IDEwMDsKCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgU0dUOwogICAgTWluaU1lVG9rZW4gcHVibGljIFNOVDsKICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0QmxvY2s7CiAgICB1aW50MjU2IHB1YmxpYyBlbmRCbG9jazsKCiAgICBhZGRyZXNzIHB1YmxpYyBkZXN0RXRoRGV2czsKCiAgICBhZGRyZXNzIHB1YmxpYyBkZXN0VG9rZW5zRGV2czsKICAgIGFkZHJlc3MgcHVibGljIGRlc3RUb2tlbnNSZXNlcnZlOwogICAgdWludDI1NiBwdWJsaWMgbWF4U0dUU3VwcGx5OwogICAgYWRkcmVzcyBwdWJsaWMgZGVzdFRva2Vuc1NndDsKICAgIER5bmFtaWNDZWlsaW5nIHB1YmxpYyBkeW5hbWljQ2VpbGluZzsKCiAgICBhZGRyZXNzIHB1YmxpYyBzbnRDb250cm9sbGVyOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGd1YXJhbnRlZWRCdXllcnNMaW1pdDsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGd1YXJhbnRlZWRCdXllcnNCb3VnaHQ7CgogICAgdWludDI1NiBwdWJsaWMgdG90YWxHdWFyYW50ZWVkQ29sbGVjdGVkOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxOb3JtYWxDb2xsZWN0ZWQ7CgogICAgdWludDI1NiBwdWJsaWMgZmluYWxpemVkQmxvY2s7CiAgICB1aW50MjU2IHB1YmxpYyBmaW5hbGl6ZWRUaW1lOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGxhc3RDYWxsQmxvY2s7CgogICAgYm9vbCBwdWJsaWMgcGF1c2VkOwoKICAgIG1vZGlmaWVyIGluaXRpYWxpemVkKCkgewogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhTTlQpICE9IDB4MCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBjb250cmlidXRpb25PcGVuKCkgewogICAgICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA+PSBzdGFydEJsb2NrICYmCiAgICAgICAgICAgICAgICBnZXRCbG9ja051bWJlcigpIDw9IGVuZEJsb2NrICYmCiAgICAgICAgICAgICAgICBmaW5hbGl6ZWRCbG9jayA9PSAwICYmCiAgICAgICAgICAgICAgICBhZGRyZXNzKFNOVCkgIT0gMHgwKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIG5vdFBhdXNlZCgpIHsKICAgICAgICByZXF1aXJlKCFwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gU3RhdHVzQ29udHJpYnV0aW9uKCkgewogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgfQoKCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciBiZWZvcmUgdGhlIGNvbnRyaWJ1dGlvbgogICAgLy8vICBwZXJpb2Qgc3RhcnRzIFRoaXMgaW5pdGlhbGl6ZXMgbW9zdCBvZiB0aGUgcGFyYW1ldGVycwogICAgLy8vIEBwYXJhbSBfc250IEFkZHJlc3Mgb2YgdGhlIFNOVCB0b2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfc250Q29udHJvbGxlciBUb2tlbiBjb250cm9sbGVyIGZvciB0aGUgU05UIHRoYXQgd2lsbCBiZSB0cmFuc2ZlcnJlZCBhZnRlcgogICAgLy8vICB0aGUgY29udHJpYnV0aW9uIGZpbmFsaXplcy4KICAgIC8vLyBAcGFyYW0gX3N0YXJ0QmxvY2sgQmxvY2sgd2hlbiB0aGUgY29udHJpYnV0aW9uIHBlcmlvZCBzdGFydHMKICAgIC8vLyBAcGFyYW0gX2VuZEJsb2NrIFRoZSBsYXN0IGJsb2NrIHRoYXQgdGhlIGNvbnRyaWJ1dGlvbiBwZXJpb2QgaXMgYWN0aXZlCiAgICAvLy8gQHBhcmFtIF9keW5hbWljQ2VpbGluZyBBZGRyZXNzIG9mIHRoZSBjb250cmFjdCB0aGF0IGNvbnRyb2xzIHRoZSBjZWlsaW5nCiAgICAvLy8gQHBhcmFtIF9kZXN0RXRoRGV2cyBEZXN0aW5hdGlvbiBhZGRyZXNzIHdoZXJlIHRoZSBjb250cmlidXRpb24gZXRoZXIgaXMgc2VudAogICAgLy8vIEBwYXJhbSBfZGVzdFRva2Vuc1Jlc2VydmUgQWRkcmVzcyB3aGVyZSB0aGUgdG9rZW5zIGZvciB0aGUgcmVzZXJ2ZSBhcmUgc2VudAogICAgLy8vIEBwYXJhbSBfZGVzdFRva2Vuc1NndCBBZGRyZXNzIG9mIHRoZSBleGNoYW5nZXIgU0dULVNOVCB3aGVyZSB0aGUgU05UIGFyZSBzZW50CiAgICAvLy8gIHRvIGJlIGRpc3RyaWJ1dGVkIHRvIHRoZSBTR1QgaG9sZGVycy4KICAgIC8vLyBAcGFyYW0gX2Rlc3RUb2tlbnNEZXZzIEFkZHJlc3Mgd2hlcmUgdGhlIHRva2VucyBmb3IgdGhlIGRldiBhcmUgc2VudAogICAgLy8vIEBwYXJhbSBfc2d0IEFkZHJlc3Mgb2YgdGhlIFNHVCB0b2tlbiBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfbWF4U0dUU3VwcGx5IFF1YW50aXR5IG9mIFNHVCB0b2tlbnMgdGhhdCB3b3VsZCByZXByZXNlbnQgMTAlIG9mIHN0YXR1cy4KICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoCiAgICAgICAgYWRkcmVzcyBfc250LAogICAgICAgIGFkZHJlc3MgX3NudENvbnRyb2xsZXIsCgogICAgICAgIHVpbnQyNTYgX3N0YXJ0QmxvY2ssCiAgICAgICAgdWludDI1NiBfZW5kQmxvY2ssCgogICAgICAgIGFkZHJlc3MgX2R5bmFtaWNDZWlsaW5nLAoKICAgICAgICBhZGRyZXNzIF9kZXN0RXRoRGV2cywKCiAgICAgICAgYWRkcmVzcyBfZGVzdFRva2Vuc1Jlc2VydmUsCiAgICAgICAgYWRkcmVzcyBfZGVzdFRva2Vuc1NndCwKICAgICAgICBhZGRyZXNzIF9kZXN0VG9rZW5zRGV2cywKCiAgICAgICAgYWRkcmVzcyBfc2d0LAogICAgICAgIHVpbnQyNTYgX21heFNHVFN1cHBseQogICAgKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICAvLyBJbml0aWFsaXplIG9ubHkgb25jZQogICAgICAgIHJlcXVpcmUoYWRkcmVzcyhTTlQpID09IDB4MCk7CgogICAgICAgIFNOVCA9IE1pbmlNZVRva2VuKF9zbnQpOwogICAgICAgIHJlcXVpcmUoU05ULnRvdGFsU3VwcGx5KCkgPT0gMCk7CiAgICAgICAgcmVxdWlyZShTTlQuY29udHJvbGxlcigpID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJlcXVpcmUoU05ULmRlY2ltYWxzKCkgPT0gMTgpOyAgLy8gU2FtZSBhbW91bnQgb2YgZGVjaW1hbHMgYXMgRVRICgogICAgICAgIHJlcXVpcmUoX3NudENvbnRyb2xsZXIgIT0gMHgwKTsKICAgICAgICBzbnRDb250cm9sbGVyID0gX3NudENvbnRyb2xsZXI7CgogICAgICAgIHJlcXVpcmUoX3N0YXJ0QmxvY2sgPj0gZ2V0QmxvY2tOdW1iZXIoKSk7CiAgICAgICAgcmVxdWlyZShfc3RhcnRCbG9jayA8IF9lbmRCbG9jayk7CiAgICAgICAgc3RhcnRCbG9jayA9IF9zdGFydEJsb2NrOwogICAgICAgIGVuZEJsb2NrID0gX2VuZEJsb2NrOwoKICAgICAgICByZXF1aXJlKF9keW5hbWljQ2VpbGluZyAhPSAweDApOwogICAgICAgIGR5bmFtaWNDZWlsaW5nID0gRHluYW1pY0NlaWxpbmcoX2R5bmFtaWNDZWlsaW5nKTsKCiAgICAgICAgcmVxdWlyZShfZGVzdEV0aERldnMgIT0gMHgwKTsKICAgICAgICBkZXN0RXRoRGV2cyA9IF9kZXN0RXRoRGV2czsKCiAgICAgICAgcmVxdWlyZShfZGVzdFRva2Vuc1Jlc2VydmUgIT0gMHgwKTsKICAgICAgICBkZXN0VG9rZW5zUmVzZXJ2ZSA9IF9kZXN0VG9rZW5zUmVzZXJ2ZTsKCiAgICAgICAgcmVxdWlyZShfZGVzdFRva2Vuc1NndCAhPSAweDApOwogICAgICAgIGRlc3RUb2tlbnNTZ3QgPSBfZGVzdFRva2Vuc1NndDsKCiAgICAgICAgcmVxdWlyZShfZGVzdFRva2Vuc0RldnMgIT0gMHgwKTsKICAgICAgICBkZXN0VG9rZW5zRGV2cyA9IF9kZXN0VG9rZW5zRGV2czsKCiAgICAgICAgcmVxdWlyZShfc2d0ICE9IDB4MCk7CiAgICAgICAgU0dUID0gTWluaU1lVG9rZW4oX3NndCk7CgogICAgICAgIHJlcXVpcmUoX21heFNHVFN1cHBseSA+PSBNaW5pTWVUb2tlbihTR1QpLnRvdGFsU3VwcGx5KCkpOwogICAgICAgIG1heFNHVFN1cHBseSA9IF9tYXhTR1RTdXBwbHk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgU2V0cyB0aGUgbGltaXQgZm9yIGEgZ3VhcmFudGVlZCBhZGRyZXNzLiBBbGwgdGhlIGd1YXJhbnRlZWQgYWRkcmVzc2VzCiAgICAvLy8gIHdpbGwgYmUgYWJsZSB0byBnZXQgU05UcyBkdXJpbmcgdGhlIGNvbnRyaWJ1dGlvbiBwZXJpb2Qgd2l0aCBoaXMgb3duCiAgICAvLy8gIHNwZWNpZmljIGxpbWl0LgogICAgLy8vICBUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciBhZnRlciB0aGUgaW5pdGlhbGl6YXRpb24KICAgIC8vLyAgYW5kIGJlZm9yZSB0aGUgY29udHJpYnV0aW9uIHN0YXJ0cy4KICAgIC8vLyBAcGFyYW0gX3RoIEd1YXJhbnRlZWQgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfbGltaXQgTGltaXQgZm9yIHRoZSBndWFyYW50ZWVkIGFkZHJlc3MuCiAgICBmdW5jdGlvbiBzZXRHdWFyYW50ZWVkQWRkcmVzcyhhZGRyZXNzIF90aCwgdWludDI1NiBfbGltaXQpIHB1YmxpYyBpbml0aWFsaXplZCBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA8IHN0YXJ0QmxvY2spOwogICAgICAgIHJlcXVpcmUoX2xpbWl0ID4gMCAmJiBfbGltaXQgPD0gbWF4R3VhcmFudGVlZExpbWl0KTsKICAgICAgICBndWFyYW50ZWVkQnV5ZXJzTGltaXRbX3RoXSA9IF9saW1pdDsKICAgICAgICBHdWFyYW50ZWVkQWRkcmVzcyhfdGgsIF9saW1pdCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgSWYgYW55Ym9keSBzZW5kcyBFdGhlciBkaXJlY3RseSB0byB0aGlzIGNvbnRyYWN0LCBjb25zaWRlciBoZSBpcwogICAgLy8vICBnZXR0aW5nIFNOVHMuCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSBub3RQYXVzZWQgewogICAgICAgIHByb3h5UGF5bWVudChtc2cuc2VuZGVyKTsKICAgIH0KCgogICAgLy8vLy8vLy8vLwogICAgLy8gTWluaU1lIENvbnRyb2xsZXIgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2Qgd2lsbCBnZW5lcmFsbHkgYmUgY2FsbGVkIGJ5IHRoZSBTTlQgdG9rZW4gY29udHJhY3QgdG8KICAgIC8vLyAgYWNxdWlyZSBTTlRzLiBPciBkaXJlY3RseSBmcm9tIHRoaXJkIHBhcnRpZXMgdGhhdCB3YW50IHRvIGFjcXVpcmUgU05UcyBpbgogICAgLy8vICBiZWhhbGYgb2YgYSB0b2tlbiBob2xkZXIuCiAgICAvLy8gQHBhcmFtIF90aCBTTlQgaG9sZGVyIHdoZXJlIHRoZSBTTlRzIHdpbGwgYmUgbWludGVkLgogICAgZnVuY3Rpb24gcHJveHlQYXltZW50KGFkZHJlc3MgX3RoKSBwdWJsaWMgcGF5YWJsZSBub3RQYXVzZWQgaW5pdGlhbGl6ZWQgY29udHJpYnV0aW9uT3BlbiByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdGggIT0gMHgwKTsKICAgICAgICBpZiAoZ3VhcmFudGVlZEJ1eWVyc0xpbWl0W190aF0gPiAwKSB7CiAgICAgICAgICAgIGJ1eUd1YXJhbnRlZWQoX3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidXlOb3JtYWwoX3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gb25UcmFuc2ZlcihhZGRyZXNzLCBhZGRyZXNzLCB1aW50MjU2KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbkFwcHJvdmUoYWRkcmVzcywgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5Tm9ybWFsKGFkZHJlc3MgX3RoKSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSh0eC5nYXNwcmljZSA8PSBtYXhHYXNQcmljZSk7CgogICAgICAgIC8vIEFudGlzcGFtIG1lY2hhbmlzbQogICAgICAgIGFkZHJlc3MgY2FsbGVyOwogICAgICAgIGlmIChtc2cuc2VuZGVyID09IGFkZHJlc3MoU05UKSkgewogICAgICAgICAgICBjYWxsZXIgPSBfdGg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2FsbGVyID0gbXNnLnNlbmRlcjsKICAgICAgICB9CgogICAgICAgIC8vIERvIG5vdCBhbGxvdyBjb250cmFjdHMgdG8gZ2FtZSB0aGUgc3lzdGVtCiAgICAgICAgcmVxdWlyZSghaXNDb250cmFjdChjYWxsZXIpKTsKCiAgICAgICAgcmVxdWlyZShnZXRCbG9ja051bWJlcigpLnN1YihsYXN0Q2FsbEJsb2NrW2NhbGxlcl0pID49IG1heENhbGxGcmVxdWVuY3kpOwogICAgICAgIGxhc3RDYWxsQmxvY2tbY2FsbGVyXSA9IGdldEJsb2NrTnVtYmVyKCk7CgogICAgICAgIHVpbnQyNTYgdG9Db2xsZWN0ID0gZHluYW1pY0NlaWxpbmcudG9Db2xsZWN0KHRvdGFsTm9ybWFsQ29sbGVjdGVkKTsKCiAgICAgICAgdWludDI1NiB0b0Z1bmQ7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA8PSB0b0NvbGxlY3QpIHsKICAgICAgICAgICAgdG9GdW5kID0gbXNnLnZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvRnVuZCA9IHRvQ29sbGVjdDsKICAgICAgICB9CgogICAgICAgIHRvdGFsTm9ybWFsQ29sbGVjdGVkID0gdG90YWxOb3JtYWxDb2xsZWN0ZWQuYWRkKHRvRnVuZCk7CiAgICAgICAgZG9CdXkoX3RoLCB0b0Z1bmQsIGZhbHNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXlHdWFyYW50ZWVkKGFkZHJlc3MgX3RoKSBpbnRlcm5hbCB7CiAgICAgICAgdWludDI1NiB0b0NvbGxlY3QgPSBndWFyYW50ZWVkQnV5ZXJzTGltaXRbX3RoXTsKCiAgICAgICAgdWludDI1NiB0b0Z1bmQ7CiAgICAgICAgaWYgKGd1YXJhbnRlZWRCdXllcnNCb3VnaHRbX3RoXS5hZGQobXNnLnZhbHVlKSA+IHRvQ29sbGVjdCkgewogICAgICAgICAgICB0b0Z1bmQgPSB0b0NvbGxlY3Quc3ViKGd1YXJhbnRlZWRCdXllcnNCb3VnaHRbX3RoXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9GdW5kID0gbXNnLnZhbHVlOwogICAgICAgIH0KCiAgICAgICAgZ3VhcmFudGVlZEJ1eWVyc0JvdWdodFtfdGhdID0gZ3VhcmFudGVlZEJ1eWVyc0JvdWdodFtfdGhdLmFkZCh0b0Z1bmQpOwogICAgICAgIHRvdGFsR3VhcmFudGVlZENvbGxlY3RlZCA9IHRvdGFsR3VhcmFudGVlZENvbGxlY3RlZC5hZGQodG9GdW5kKTsKICAgICAgICBkb0J1eShfdGgsIHRvRnVuZCwgdHJ1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZG9CdXkoYWRkcmVzcyBfdGgsIHVpbnQyNTYgX3RvRnVuZCwgYm9vbCBfZ3VhcmFudGVlZCkgaW50ZXJuYWwgewogICAgICAgIGFzc2VydChtc2cudmFsdWUgPj0gX3RvRnVuZCk7ICAvLyBOb3QgbmVlZGVkLCBidXQgZG91YmxlIGNoZWNrLgogICAgICAgIGFzc2VydCh0b3RhbENvbGxlY3RlZCgpIDw9IGZhaWxTYWZlTGltaXQpOwoKICAgICAgICBpZiAoX3RvRnVuZCA+IDApIHsKICAgICAgICAgICAgdWludDI1NiB0b2tlbnNHZW5lcmF0ZWQgPSBfdG9GdW5kLm11bChleGNoYW5nZVJhdGUpOwogICAgICAgICAgICBhc3NlcnQoU05ULmdlbmVyYXRlVG9rZW5zKF90aCwgdG9rZW5zR2VuZXJhdGVkKSk7CiAgICAgICAgICAgIGRlc3RFdGhEZXZzLnRyYW5zZmVyKF90b0Z1bmQpOwogICAgICAgICAgICBOZXdTYWxlKF90aCwgX3RvRnVuZCwgdG9rZW5zR2VuZXJhdGVkLCBfZ3VhcmFudGVlZCk7CiAgICAgICAgfQoKICAgICAgICB1aW50MjU2IHRvUmV0dXJuID0gbXNnLnZhbHVlLnN1YihfdG9GdW5kKTsKICAgICAgICBpZiAodG9SZXR1cm4gPiAwKSB7CiAgICAgICAgICAgIC8vIElmIHRoZSBjYWxsIGNvbWVzIGZyb20gdGhlIFRva2VuIGNvbnRyb2xsZXIsCiAgICAgICAgICAgIC8vIHRoZW4gd2UgcmV0dXJuIGl0IHRvIHRoZSB0b2tlbiBIb2xkZXIuCiAgICAgICAgICAgIC8vIE90aGVyd2lzZSB3ZSByZXR1cm4gdG8gdGhlIHNlbmRlci4KICAgICAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhTTlQpKSB7CiAgICAgICAgICAgICAgICBfdGgudHJhbnNmZXIodG9SZXR1cm4pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbXNnLnNlbmRlci50cmFuc2Zlcih0b1JldHVybik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gTk9URSBvbiBQZXJjZW50YWdlIGZvcm1hdAogICAgLy8gUmlnaHQgbm93LCBTb2xpZGl0eSBkb2VzIG5vdCBzdXBwb3J0IGRlY2ltYWwgbnVtYmVycy4gKFRoaXMgd2lsbCBjaGFuZ2UgdmVyeSBzb29uKQogICAgLy8gIFNvIGluIHRoaXMgY29udHJhY3Qgd2UgdXNlIGEgcmVwcmVzZW50YXRpb24gb2YgYSBwZXJjZW50YWdlIHRoYXQgY29uc2lzdCBpbgogICAgLy8gIGV4cHJlc3NpbmcgdGhlIHBlcmNlbnRhZ2UgaW4gInggcGVyIDEwKioxOCIKICAgIC8vIFRoaXMgZm9ybWF0IGhhcyBhIHByZWNpc2lvbiBvZiAxNiBkaWdpdHMgZm9yIGEgcGVyY2VudC4KICAgIC8vIEV4YW1wbGVzOgogICAgLy8gIDMlICAgPSAgIDMqKDEwKioxNikKICAgIC8vICAxMDAlID0gMTAwKigxMCoqMTYpID0gMTAqKjE4CiAgICAvLwogICAgLy8gVG8gZ2V0IGEgcGVyY2VudGFnZSBvZiBhIHZhbHVlIHdlIGRvIGl0IGJ5IGZpcnN0IG11bHRpcGx5aW5nIGl0IGJ5IHRoZSBwZXJjZW50YWdlIGluICAoeCBwZXIgMTBeMTgpCiAgICAvLyAgYW5kIHRoZW4gZGl2aWRlIGl0IGJ5IDEwKioxOAogICAgLy8KICAgIC8vICAgICAgICAgICAgICBZICogWChpbiB4IHBlciAxMCoqMTgpCiAgICAvLyAgWCUgb2YgWSA9IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIC8vICAgICAgICAgICAgICAgMTAwKGluIHggcGVyIDEwKioxOCkKICAgIC8vCgoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIHdpbGwgY2FuIGJlIGNhbGxlZCBieSB0aGUgb3duZXIgYmVmb3JlIHRoZSBjb250cmlidXRpb24gcGVyaW9kCiAgICAvLy8gIGVuZCBvciBieSBhbnlib2R5IGFmdGVyIHRoZSBgZW5kQmxvY2tgLiBUaGlzIG1ldGhvZCBmaW5hbGl6ZXMgdGhlIGNvbnRyaWJ1dGlvbiBwZXJpb2QKICAgIC8vLyAgYnkgY3JlYXRpbmcgdGhlIHJlbWFpbmluZyB0b2tlbnMgYW5kIHRyYW5zZmVycmluZyB0aGUgY29udHJvbGxlciB0byB0aGUgY29uZmlndXJlZAogICAgLy8vICBjb250cm9sbGVyLgogICAgZnVuY3Rpb24gZmluYWxpemUoKSBwdWJsaWMgaW5pdGlhbGl6ZWQgewogICAgICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA+PSBzdGFydEJsb2NrKTsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgfHwgZ2V0QmxvY2tOdW1iZXIoKSA+IGVuZEJsb2NrKTsKICAgICAgICByZXF1aXJlKGZpbmFsaXplZEJsb2NrID09IDApOwoKICAgICAgICAvLyBEbyBub3QgYWxsb3cgdGVybWluYXRpb24gdW50aWwgYWxsIGN1cnZlcyByZXZlYWxlZC4KICAgICAgICByZXF1aXJlKGR5bmFtaWNDZWlsaW5nLmFsbFJldmVhbGVkKCkpOwoKICAgICAgICAvLyBBbGxvdyBwcmVtYXR1cmUgZmluYWxpemF0aW9uIGlmIGZpbmFsIGxpbWl0IGlzIHJlYWNoZWQKICAgICAgICBpZiAoZ2V0QmxvY2tOdW1iZXIoKSA8PSBlbmRCbG9jaykgewogICAgICAgICAgICB2YXIgKCxsYXN0TGltaXQsLCkgPSBkeW5hbWljQ2VpbGluZy5jdXJ2ZXMoZHluYW1pY0NlaWxpbmcucmV2ZWFsZWRDdXJ2ZXMoKS5zdWIoMSkpOwogICAgICAgICAgICByZXF1aXJlKHRvdGFsTm9ybWFsQ29sbGVjdGVkID49IGxhc3RMaW1pdCk7CiAgICAgICAgfQoKICAgICAgICBmaW5hbGl6ZWRCbG9jayA9IGdldEJsb2NrTnVtYmVyKCk7CiAgICAgICAgZmluYWxpemVkVGltZSA9IG5vdzsKCiAgICAgICAgdWludDI1NiBwZXJjZW50YWdlVG9TZ3Q7CiAgICAgICAgaWYgKFNHVC50b3RhbFN1cHBseSgpID49IG1heFNHVFN1cHBseSkgewogICAgICAgICAgICBwZXJjZW50YWdlVG9TZ3QgPSBwZXJjZW50KDEwKTsgIC8vIDEwJQogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgIFNHVC50b3RhbFN1cHBseSgpCiAgICAgICAgICAgIC8vICBwZXJjZW50YWdlVG9TZ3QgPSAxMCUgKiAtLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhTR1RTdXBwbHkKICAgICAgICAgICAgLy8KICAgICAgICAgICAgcGVyY2VudGFnZVRvU2d0ID0gcGVyY2VudCgxMCkubXVsKFNHVC50b3RhbFN1cHBseSgpKS5kaXYobWF4U0dUU3VwcGx5KTsKICAgICAgICB9CgogICAgICAgIHVpbnQyNTYgcGVyY2VudGFnZVRvRGV2cyA9IHBlcmNlbnQoMjApOyAgLy8gMjAlCgoKICAgICAgICAvLwogICAgICAgIC8vICAlIFRvIENvbnRyaWJ1dG9ycyA9IDQxJSArICgxMCUgLSAlIHRvIFNHVCBob2xkZXJzKQogICAgICAgIC8vCiAgICAgICAgdWludDI1NiBwZXJjZW50YWdlVG9Db250cmlidXRvcnMgPSBwZXJjZW50KDQxKS5hZGQocGVyY2VudCgxMCkuc3ViKHBlcmNlbnRhZ2VUb1NndCkpOwoKICAgICAgICB1aW50MjU2IHBlcmNlbnRhZ2VUb1Jlc2VydmUgPSBwZXJjZW50KDI5KTsKCgogICAgICAgIC8vIFNOVC50b3RhbFN1cHBseSgpIC0+IFRva2VucyBtaW50ZWQgZHVyaW5nIHRoZSBjb250cmlidXRpb24KICAgICAgICAvLyAgdG90YWxUb2tlbnMgIC0+IFRvdGFsIHRva2VucyB0aGF0IHNob3VsZCBiZSBhZnRlciB0aGUgYWxsb2NhdGlvbgogICAgICAgIC8vICAgICAgICAgICAgICAgICAgIG9mIGRldlRva2Vucywgc2d0VG9rZW5zIGFuZCByZXNlcnZlCiAgICAgICAgLy8gIHBlcmNlbnRhZ2VUb0NvbnRyaWJ1dG9ycyAtPiBXaGljaCBwZXJjZW50YWdlIHNob3VsZCBnbyB0byB0aGUKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cmlidXRpb24gcGFydGljaXBhbnRzCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHggcGVyIDEwKioxOCBmb3JtYXQpCiAgICAgICAgLy8gIHBlcmNlbnQoMTAwKSAtPiAxMDAlIGluICh4IHBlciAxMCoqMTggZm9ybWF0KQogICAgICAgIC8vCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2VUb0NvbnRyaWJ1dG9ycwogICAgICAgIC8vICBTTlQudG90YWxTdXBwbHkoKSA9IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICogdG90YWxUb2tlbnMgID0+CiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnQoMTAwKQogICAgICAgIC8vCiAgICAgICAgLy8KICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50KDEwMCkKICAgICAgICAvLyAgPT4gIHRvdGFsVG9rZW5zID0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqIFNOVC50b3RhbFN1cHBseSgpCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZVRvQ29udHJpYnV0b3JzCiAgICAgICAgLy8KICAgICAgICB1aW50MjU2IHRvdGFsVG9rZW5zID0gU05ULnRvdGFsU3VwcGx5KCkubXVsKHBlcmNlbnQoMTAwKSkuZGl2KHBlcmNlbnRhZ2VUb0NvbnRyaWJ1dG9ycyk7CgoKICAgICAgICAvLyBHZW5lcmF0ZSB0b2tlbnMgZm9yIFNHVCBIb2xkZXJzLgoKICAgICAgICAvLwogICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlVG9SZXNlcnZlCiAgICAgICAgLy8gIHJlc2VydmVUb2tlbnMgPSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqIHRvdGFsVG9rZW5zCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZSgxMDApCiAgICAgICAgLy8KICAgICAgICBhc3NlcnQoU05ULmdlbmVyYXRlVG9rZW5zKAogICAgICAgICAgICBkZXN0VG9rZW5zUmVzZXJ2ZSwKICAgICAgICAgICAgdG90YWxUb2tlbnMubXVsKHBlcmNlbnRhZ2VUb1Jlc2VydmUpLmRpdihwZXJjZW50KDEwMCkpKSk7CgogICAgICAgIC8vCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICBwZXJjZW50YWdlVG9TZ3QKICAgICAgICAvLyAgc2d0VG9rZW5zID0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKiB0b3RhbFRva2VucwogICAgICAgIC8vICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2UoMTAwKQogICAgICAgIC8vCiAgICAgICAgYXNzZXJ0KFNOVC5nZW5lcmF0ZVRva2VucygKICAgICAgICAgICAgZGVzdFRva2Vuc1NndCwKICAgICAgICAgICAgdG90YWxUb2tlbnMubXVsKHBlcmNlbnRhZ2VUb1NndCkuZGl2KHBlcmNlbnQoMTAwKSkpKTsKCgogICAgICAgIC8vCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZVRvRGV2cwogICAgICAgIC8vICBkZXZUb2tlbnMgPSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqIHRvdGFsVG9rZW5zCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZSgxMDApCiAgICAgICAgLy8KICAgICAgICBhc3NlcnQoU05ULmdlbmVyYXRlVG9rZW5zKAogICAgICAgICAgICBkZXN0VG9rZW5zRGV2cywKICAgICAgICAgICAgdG90YWxUb2tlbnMubXVsKHBlcmNlbnRhZ2VUb0RldnMpLmRpdihwZXJjZW50KDEwMCkpKSk7CgogICAgICAgIFNOVC5jaGFuZ2VDb250cm9sbGVyKHNudENvbnRyb2xsZXIpOwoKICAgICAgICBGaW5hbGl6ZWQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwZXJjZW50KHVpbnQyNTYgcCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBwLm11bCgxMCoqMTYpOwogICAgfQoKICAgIC8vLyBAZGV2IEludGVybmFsIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBhbiBhZGRyZXNzIGlzIGEgY29udHJhY3QKICAgIC8vLyBAcGFyYW0gX2FkZHIgVGhlIGFkZHJlc3MgYmVpbmcgcXVlcmllZAogICAgLy8vIEByZXR1cm4gVHJ1ZSBpZiBgX2FkZHJgIGlzIGEgY29udHJhY3QKICAgIGZ1bmN0aW9uIGlzQ29udHJhY3QoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChfYWRkciA9PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgdWludDI1NiBzaXplOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChzaXplID4gMCk7CiAgICB9CgoKICAgIC8vLy8vLy8vLy8KICAgIC8vIENvbnN0YW50IGZ1bmN0aW9ucwogICAgLy8vLy8vLy8vLwoKICAgIC8vLyBAcmV0dXJuIFRvdGFsIHRva2VucyBpc3N1ZWQgaW4gd2Vpcy4KICAgIGZ1bmN0aW9uIHRva2Vuc0lzc3VlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIFNOVC50b3RhbFN1cHBseSgpOwogICAgfQoKICAgIC8vLyBAcmV0dXJuIFRvdGFsIEV0aGVyIGNvbGxlY3RlZC4KICAgIGZ1bmN0aW9uIHRvdGFsQ29sbGVjdGVkKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxOb3JtYWxDb2xsZWN0ZWQuYWRkKHRvdGFsR3VhcmFudGVlZENvbGxlY3RlZCk7CiAgICB9CgoKICAgIC8vLy8vLy8vLy8KICAgIC8vIFRlc3Rpbmcgc3BlY2lmaWMgbWV0aG9kcwogICAgLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbiBieSB0aGUgdGVzdCBNb2Nrcy4KICAgIGZ1bmN0aW9uIGdldEJsb2NrTnVtYmVyKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBibG9jay5udW1iZXI7CiAgICB9CgoKICAgIC8vLy8vLy8vLy8KICAgIC8vIFNhZmV0eSBNZXRob2RzCiAgICAvLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBpZiAoU05ULmNvbnRyb2xsZXIoKSA9PSBhZGRyZXNzKHRoaXMpKSB7CiAgICAgICAgICAgIFNOVC5jbGFpbVRva2VucyhfdG9rZW4pOwogICAgICAgIH0KICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgewogICAgICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgICAgICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIG93bmVyLCBiYWxhbmNlKTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgUGF1c2VzIHRoZSBjb250cmlidXRpb24gaWYgdGhlcmUgaXMgYW55IGlzc3VlCiAgICBmdW5jdGlvbiBwYXVzZUNvbnRyaWJ1dGlvbigpIG9ubHlPd25lciB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBSZXN1bWVzIHRoZSBjb250cmlidXRpb24KICAgIGZ1bmN0aW9uIHJlc3VtZUNvbnRyaWJ1dGlvbigpIG9ubHlPd25lciB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICB9CgogICAgZXZlbnQgQ2xhaW1lZFRva2VucyhhZGRyZXNzIGluZGV4ZWQgX3Rva2VuLCBhZGRyZXNzIGluZGV4ZWQgX2NvbnRyb2xsZXIsIHVpbnQyNTYgX2Ftb3VudCk7CiAgICBldmVudCBOZXdTYWxlKGFkZHJlc3MgaW5kZXhlZCBfdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfdG9rZW5zLCBib29sIF9ndWFyYW50ZWVkKTsKICAgIGV2ZW50IEd1YXJhbnRlZWRBZGRyZXNzKGFkZHJlc3MgaW5kZXhlZCBfdGgsIHVpbnQyNTYgX2xpbWl0KTsKICAgIGV2ZW50IEZpbmFsaXplZCgpOwp9CgoKLyoKICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCgovLy8gQHRpdGxlIENvbnRyaWJ1dGlvbldhbGxldCBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoaXMgY29udHJhY3Qgd2lsbCBiZSBob2xkIHRoZSBFdGhlciBkdXJpbmcgdGhlIGNvbnRyaWJ1dGlvbiBwZXJpb2QuCi8vLyAgVGhlIGlkZWEgb2YgdGhpcyBjb250cmFjdCBpcyB0byBhdm9pZCByZWN5Y2xpbmcgRXRoZXIgZHVyaW5nIHRoZSBjb250cmlidXRpb24KLy8vICBwZXJpb2QuIFNvIGFsbCB0aGUgRVRIIGNvbGxlY3RlZCB3aWxsIGJlIGxvY2tlZCBoZXJlIHVudGlsIHRoZSBjb250cmlidXRpb24KLy8vICBwZXJpb2QgZW5kcwoKLy8gQGRldiBDb250cmFjdCB0byBob2xkIHNhbGUgcmFpc2VkIGZ1bmRzIGR1cmluZyB0aGUgc2FsZSBwZXJpb2QuCi8vIFByZXZlbnRzIGF0dGFjayBpbiB3aGljaCB0aGUgQXJhZ29uIE11bHRpc2lnIHNlbmRzIHJhaXNlZCBldGhlcgovLyB0byB0aGUgc2FsZSBjb250cmFjdCB0byBtaW50IHRva2VucyB0byBpdHNlbGYsIGFuZCBnZXR0aW5nIHRoZQovLyBmdW5kcyBiYWNrIGltbWVkaWF0ZWx5LgoKCgpjb250cmFjdCBDb250cmlidXRpb25XYWxsZXQgewoKICAgIC8vIFB1YmxpYyB2YXJpYWJsZXMKICAgIGFkZHJlc3MgcHVibGljIG11bHRpc2lnOwogICAgdWludDI1NiBwdWJsaWMgZW5kQmxvY2s7CiAgICBTdGF0dXNDb250cmlidXRpb24gcHVibGljIGNvbnRyaWJ1dGlvbjsKCiAgICAvLyBAZGV2IENvbnN0cnVjdG9yIGluaXRpYWxpemVzIHB1YmxpYyB2YXJpYWJsZXMKICAgIC8vIEBwYXJhbSBfbXVsdGlzaWcgVGhlIGFkZHJlc3Mgb2YgdGhlIG11bHRpc2lnIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBmdW5kcwogICAgLy8gQHBhcmFtIF9lbmRCbG9jayBCbG9jayBhZnRlciB3aGljaCB0aGUgbXVsdGlzaWcgY2FuIHJlcXVlc3QgdGhlIGZ1bmRzCiAgICAvLyBAcGFyYW0gX2NvbnRyaWJ1dGlvbiBBZGRyZXNzIG9mIHRoZSBTdGF0dXNDb250cmlidXRpb24gY29udHJhY3QKICAgIGZ1bmN0aW9uIENvbnRyaWJ1dGlvbldhbGxldChhZGRyZXNzIF9tdWx0aXNpZywgdWludDI1NiBfZW5kQmxvY2ssIGFkZHJlc3MgX2NvbnRyaWJ1dGlvbikgewogICAgICAgIHJlcXVpcmUoX211bHRpc2lnICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfY29udHJpYnV0aW9uICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfZW5kQmxvY2sgIT0gMCAmJiBfZW5kQmxvY2sgPD0gNDAwMDAwMCk7CiAgICAgICAgbXVsdGlzaWcgPSBfbXVsdGlzaWc7CiAgICAgICAgZW5kQmxvY2sgPSBfZW5kQmxvY2s7CiAgICAgICAgY29udHJpYnV0aW9uID0gU3RhdHVzQ29udHJpYnV0aW9uKF9jb250cmlidXRpb24pOwogICAgfQoKICAgIC8vIEBkZXYgUmVjZWl2ZSBhbGwgc2VudCBmdW5kcyB3aXRob3V0IGFueSBmdXJ0aGVyIGxvZ2ljCiAgICBmdW5jdGlvbiAoKSBwdWJsaWMgcGF5YWJsZSB7fQoKICAgIC8vIEBkZXYgV2l0aGRyYXcgZnVuY3Rpb24gc2VuZHMgYWxsIHRoZSBmdW5kcyB0byB0aGUgd2FsbGV0IGlmIGNvbmRpdGlvbnMgYXJlIGNvcnJlY3QKICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbXVsdGlzaWcpOyAgICAgICAgICAgICAgLy8gT25seSB0aGUgbXVsdGlzaWcgY2FuIHJlcXVlc3QgaXQKICAgICAgICByZXF1aXJlKGJsb2NrLm51bWJlciA+IGVuZEJsb2NrIHx8ICAgICAgICAgICAgLy8gQWxsb3cgYWZ0ZXIgZW5kIGJsb2NrCiAgICAgICAgICAgICAgICBjb250cmlidXRpb24uZmluYWxpemVkQmxvY2soKSAhPSAwKTsgIC8vIEFsbG93IHdoZW4gc2FsZSBpcyBmaW5hbGl6ZWQKICAgICAgICBtdWx0aXNpZy50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKfQoKCi8qCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAqLwoKLy8vIEB0aXRsZSBEZXZUb2tlbnNIb2xkZXIgQ29udHJhY3QKLy8vIEBhdXRob3IgSm9yZGkgQmF5bGluYQovLy8gQGRldiBUaGlzIGNvbnRyYWN0IHdpbGwgaG9sZCB0aGUgdG9rZW5zIG9mIHRoZSBkZXZlbG9wZXJzLgovLy8gIFRva2VucyB3aWxsIG5vdCBiZSBhYmxlIHRvIGJlIGNvbGxlY3RlZCB1bnRpbCA2IG1vbnRocyBhZnRlciB0aGUgY29udHJpYnV0aW9uCi8vLyAgcGVyaW9kIGVuZHMuIEFuZCBpdCB3aWxsIGJlIGluY3JlYXNpbmcgbGluZWFybHkgdW50aWwgMiB5ZWFycy4KCgovLyAgY29sbGVjdGFibGUgdG9rZW5zCi8vICAgfCAgICAgICAgICAgICAgICAgICAgICAgICBfLy0tLS0tLS0tICAgdmVzdGVkVG9rZW5zIHJlY3QKLy8gICB8ICAgICAgICAgICAgICAgICAgICAgICBfLwovLyAgIHwgICAgICAgICAgICAgICAgICAgICBfLwovLyAgIHwgICAgICAgICAgICAgICAgICAgXy8KLy8gICB8ICAgICAgICAgICAgICAgICBfLwovLyAgIHwgICAgICAgICAgICAgICBfLwovLyAgIHwgICAgICAgICAgICAgXy8KLy8gICB8ICAgICAgICAgICBfLwovLyAgIHwgICAgICAgICAgfAovLyAgIHwgICAgICAgIC4gfAovLyAgIHwgICAgICAuICAgfAovLyAgIHwgICAgLiAgICAgfAovLyAgICs9PT0rPT09PT09Ky0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0+IHRpbWUKLy8gICAgIENvbnRyaWIgICA2IE1vbnRocyAgICAgICAyNCBNb250aHMKLy8gICAgICAgRW5kCgoKCmNvbnRyYWN0IERldlRva2Vuc0hvbGRlciBpcyBPd25lZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICB1aW50MjU2IGNvbGxlY3RlZFRva2VuczsKICAgIFN0YXR1c0NvbnRyaWJ1dGlvbiBjb250cmlidXRpb247CiAgICBNaW5pTWVUb2tlbiBzbnQ7CgogICAgZnVuY3Rpb24gRGV2VG9rZW5zSG9sZGVyKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9jb250cmlidXRpb24sIGFkZHJlc3MgX3NudCkgewogICAgICAgIG93bmVyID0gX293bmVyOwogICAgICAgIGNvbnRyaWJ1dGlvbiA9IFN0YXR1c0NvbnRyaWJ1dGlvbihfY29udHJpYnV0aW9uKTsKICAgICAgICBzbnQgPSBNaW5pTWVUb2tlbihfc250KTsKICAgIH0KCgogICAgLy8vIEBub3RpY2UgVGhlIERldiAoT3duZXIpIHdpbGwgY2FsbCB0aGlzIG1ldGhvZCB0byBleHRyYWN0IHRoZSB0b2tlbnMKICAgIGZ1bmN0aW9uIGNvbGxlY3RUb2tlbnMoKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSBzbnQuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpOwogICAgICAgIHVpbnQyNTYgdG90YWwgPSBjb2xsZWN0ZWRUb2tlbnMuYWRkKGJhbGFuY2UpOwoKICAgICAgICB1aW50MjU2IGZpbmFsaXplZFRpbWUgPSBjb250cmlidXRpb24uZmluYWxpemVkVGltZSgpOwoKICAgICAgICByZXF1aXJlKGZpbmFsaXplZFRpbWUgPiAwICYmIGdldFRpbWUoKSA+IGZpbmFsaXplZFRpbWUuYWRkKG1vbnRocyg2KSkpOwoKICAgICAgICB1aW50MjU2IGNhbkV4dHJhY3QgPSB0b3RhbC5tdWwoZ2V0VGltZSgpLnN1YihmaW5hbGl6ZWRUaW1lKSkuZGl2KG1vbnRocygyNCkpOwoKICAgICAgICBjYW5FeHRyYWN0ID0gY2FuRXh0cmFjdC5zdWIoY29sbGVjdGVkVG9rZW5zKTsKCiAgICAgICAgaWYgKGNhbkV4dHJhY3QgPiBiYWxhbmNlKSB7CiAgICAgICAgICAgIGNhbkV4dHJhY3QgPSBiYWxhbmNlOwogICAgICAgIH0KCiAgICAgICAgY29sbGVjdGVkVG9rZW5zID0gY29sbGVjdGVkVG9rZW5zLmFkZChjYW5FeHRyYWN0KTsKICAgICAgICBhc3NlcnQoc250LnRyYW5zZmVyKG93bmVyLCBjYW5FeHRyYWN0KSk7CgogICAgICAgIFRva2Vuc1dpdGhkcmF3bihvd25lciwgY2FuRXh0cmFjdCk7CiAgICB9CgogICAgZnVuY3Rpb24gbW9udGhzKHVpbnQyNTYgbSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBtLm11bCgzMCBkYXlzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUaW1lKCkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBub3c7CiAgICB9CgoKICAgIC8vLy8vLy8vLy8KICAgIC8vIFNhZmV0eSBNZXRob2RzCiAgICAvLy8vLy8vLy8vCgogICAgLy8vIEBub3RpY2UgVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgYnkgdGhlIGNvbnRyb2xsZXIgdG8gZXh0cmFjdCBtaXN0YWtlbmx5CiAgICAvLy8gIHNlbnQgdG9rZW5zIHRvIHRoaXMgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbiBUaGUgYWRkcmVzcyBvZiB0aGUgdG9rZW4gY29udHJhY3QgdGhhdCB5b3Ugd2FudCB0byByZWNvdmVyCiAgICAvLy8gIHNldCB0byAwIGluIGNhc2UgeW91IHdhbnQgdG8gZXh0cmFjdCBldGhlci4KICAgIGZ1bmN0aW9uIGNsYWltVG9rZW5zKGFkZHJlc3MgX3Rva2VuKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF90b2tlbiAhPSBhZGRyZXNzKHNudCkpOwogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIEVSQzIwVG9rZW4gdG9rZW4gPSBFUkMyMFRva2VuKF90b2tlbik7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgb3duZXIsIGJhbGFuY2UpOwogICAgfQoKICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgVG9rZW5zV2l0aGRyYXduKGFkZHJlc3MgaW5kZXhlZCBfaG9sZGVyLCB1aW50MjU2IF9hbW91bnQpOwp9CgoKLyoKICAgIENvcHlyaWdodCAyMDE3LCBKb3JkaSBCYXlsaW5hCgogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAgICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAgICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoKICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAgICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICovCgovLy8gQHRpdGxlIFNHVEV4Y2hhbmdlciBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoaXMgY29udHJhY3Qgd2lsbCBiZSB1c2VkIHRvIGRpc3RyaWJ1dGUgU05UIGJldHdlZW4gU0dUIGhvbGRlcnMuCi8vLyAgU0dUIHRva2VuIGlzIG5vdCB0cmFuc2ZlcmFibGUsIGFuZCB3ZSBqdXN0IGtlZXAgYW4gYWNjb3VudGluZyBiZXR3ZWVuIGFsbCB0b2tlbnMKLy8vICBkZXBvc2l0ZWQgYW5kIHRoZSB0b2tlbnMgY29sbGVjdGVkLgovLy8gIFRoZSBjb250cm9sbGVyU2hpcCBvZiBTR1Qgc2hvdWxkIGJlIHRyYW5zZmVycmVkIHRvIHRoaXMgY29udHJhY3QgYmVmb3JlIHRoZQovLy8gIGNvbnRyaWJ1dGlvbiBwZXJpb2Qgc3RhcnRzLgoKCmNvbnRyYWN0IFNHVEV4Y2hhbmdlciBpcyBUb2tlbkNvbnRyb2xsZXIsIE93bmVkIHsKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIGNvbGxlY3RlZDsKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsQ29sbGVjdGVkOwogICAgTWluaU1lVG9rZW4gcHVibGljIHNndDsKICAgIE1pbmlNZVRva2VuIHB1YmxpYyBzbnQ7CiAgICBTdGF0dXNDb250cmlidXRpb24gcHVibGljIHN0YXR1c0NvbnRyaWJ1dGlvbjsKCiAgICBmdW5jdGlvbiBTR1RFeGNoYW5nZXIoYWRkcmVzcyBfc2d0LCBhZGRyZXNzIF9zbnQsIGFkZHJlc3MgX3N0YXR1c0NvbnRyaWJ1dGlvbikgewogICAgICAgIHNndCA9IE1pbmlNZVRva2VuKF9zZ3QpOwogICAgICAgIHNudCA9IE1pbmlNZVRva2VuKF9zbnQpOwogICAgICAgIHN0YXR1c0NvbnRyaWJ1dGlvbiA9IFN0YXR1c0NvbnRyaWJ1dGlvbihfc3RhdHVzQ29udHJpYnV0aW9uKTsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkIGJ5IHRoZSBTR1QgaG9sZGVycyB0byBjb2xsZWN0IHRoZWlyCiAgICAvLy8gIGNvcnJlc3BvbmRpbmcgU05UcwogICAgZnVuY3Rpb24gY29sbGVjdCgpIHB1YmxpYyB7CiAgICAgICAgdWludDI1NiBmaW5hbGl6ZWRCbG9jayA9IHN0YXR1c0NvbnRyaWJ1dGlvbi5maW5hbGl6ZWRCbG9jaygpOwoKICAgICAgICByZXF1aXJlKGZpbmFsaXplZEJsb2NrICE9IDApOwogICAgICAgIHJlcXVpcmUoZ2V0QmxvY2tOdW1iZXIoKSA+IGZpbmFsaXplZEJsb2NrKTsKCiAgICAgICAgdWludDI1NiB0b3RhbCA9IHRvdGFsQ29sbGVjdGVkLmFkZChzbnQuYmFsYW5jZU9mKGFkZHJlc3ModGhpcykpKTsKCiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gc2d0LmJhbGFuY2VPZkF0KG1zZy5zZW5kZXIsIGZpbmFsaXplZEJsb2NrKTsKCiAgICAgICAgLy8gRmlyc3QgY2FsY3VsYXRlIGhvdyBtdWNoIGNvcnJlc3BvbmQgdG8gaGltCiAgICAgICAgdWludDI1NiBhbW91bnQgPSB0b3RhbC5tdWwoYmFsYW5jZSkuZGl2KHNndC50b3RhbFN1cHBseUF0KGZpbmFsaXplZEJsb2NrKSk7CgogICAgICAgIC8vIEFuZCB0aGVuIHN1YnRyYWN0IHRoZSBhbW91bnQgYWxyZWFkeSBjb2xsZWN0ZWQKICAgICAgICBhbW91bnQgPSBhbW91bnQuc3ViKGNvbGxlY3RlZFttc2cuc2VuZGVyXSk7CgogICAgICAgIHJlcXVpcmUoYW1vdW50ID4gMCk7ICAvLyBOb3RpZnkgdGhlIHVzZXIgdGhhdCB0aGVyZSBhcmUgbm8gdG9rZW5zIHRvIGV4Y2hhbmdlCgogICAgICAgIHRvdGFsQ29sbGVjdGVkID0gdG90YWxDb2xsZWN0ZWQuYWRkKGFtb3VudCk7CiAgICAgICAgY29sbGVjdGVkW21zZy5zZW5kZXJdID0gY29sbGVjdGVkW21zZy5zZW5kZXJdLmFkZChhbW91bnQpOwoKICAgICAgICBhc3NlcnQoc250LnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudCkpOwoKICAgICAgICBUb2tlbnNDb2xsZWN0ZWQobXNnLnNlbmRlciwgYW1vdW50KTsKICAgIH0KCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcykgcHVibGljIHBheWFibGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHRocm93OwogICAgfQoKICAgIGZ1bmN0aW9uIG9uVHJhbnNmZXIoYWRkcmVzcywgYWRkcmVzcywgdWludDI1NikgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MsIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vLy8vLy8vLy8KICAgIC8vIFRlc3Rpbmcgc3BlY2lmaWMgbWV0aG9kcwogICAgLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbiBieSB0aGUgdGVzdCBNb2Nrcy4KICAgIGZ1bmN0aW9uIGdldEJsb2NrTnVtYmVyKCkgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBibG9jay5udW1iZXI7CiAgICB9CgogICAgLy8vLy8vLy8vLwogICAgLy8gU2FmZXR5IE1ldGhvZAogICAgLy8vLy8vLy8vLwoKICAgIC8vLyBAbm90aWNlIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIGJ5IHRoZSBjb250cm9sbGVyIHRvIGV4dHJhY3QgbWlzdGFrZW5seQogICAgLy8vICBzZW50IHRva2VucyB0byB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdG9rZW4gVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0IHRoYXQgeW91IHdhbnQgdG8gcmVjb3ZlcgogICAgLy8vICBzZXQgdG8gMCBpbiBjYXNlIHlvdSB3YW50IHRvIGV4dHJhY3QgZXRoZXIuCiAgICBmdW5jdGlvbiBjbGFpbVRva2VucyhhZGRyZXNzIF90b2tlbikgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgcmVxdWlyZShfdG9rZW4gIT0gYWRkcmVzcyhzbnQpKTsKICAgICAgICBpZiAoX3Rva2VuID09IDB4MCkgewogICAgICAgICAgICBvd25lci50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBFUkMyMFRva2VuIHRva2VuID0gRVJDMjBUb2tlbihfdG9rZW4pOwogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgICAgICB0b2tlbi50cmFuc2Zlcihvd25lciwgYmFsYW5jZSk7CiAgICAgICAgQ2xhaW1lZFRva2VucyhfdG9rZW4sIG93bmVyLCBiYWxhbmNlKTsKICAgIH0KCiAgICBldmVudCBDbGFpbWVkVG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBfdG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfY29udHJvbGxlciwgdWludDI1NiBfYW1vdW50KTsKICAgIGV2ZW50IFRva2Vuc0NvbGxlY3RlZChhZGRyZXNzIGluZGV4ZWQgX2hvbGRlciwgdWludDI1NiBfYW1vdW50KTsKCn0KCi8qCiAgICBDb3B5cmlnaHQgMjAxNywgSm9yZGkgQmF5bGluYQoKICAgIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IKICAgIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiAgICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAqLwoKLy8vIEB0aXRsZSBTTlRQbGFjZWhvbGRlciBDb250cmFjdAovLy8gQGF1dGhvciBKb3JkaSBCYXlsaW5hCi8vLyBAZGV2IFRoZSBTTlRQbGFjZWhvbGRlciBjb250cmFjdCB3aWxsIHRha2UgY29udHJvbCBvdmVyIHRoZSBTTlQgYWZ0ZXIgdGhlIGNvbnRyaWJ1dGlvbgovLy8gIGlzIGZpbmFsaXplZCBhbmQgYmVmb3JlIHRoZSBTdGF0dXMgTmV0d29yayBpcyBkZXBsb3llZC4KLy8vICBUaGUgY29udHJhY3QgYWxsb3dzIGZvciBTTlQgdHJhbnNmZXJzIGFuZCB0cmFuc2ZlckZyb20gYW5kIGltcGxlbWVudHMgdGhlCi8vLyAgbG9naWMgZm9yIHRyYW5zZmVycmluZyBjb250cm9sIG9mIHRoZSB0b2tlbiB0byB0aGUgbmV0d29yayB3aGVuIHRoZSBvZmZlcmluZwovLy8gIGFza3MgaXQgdG8gZG8gc28uCgoKY29udHJhY3QgU05UUGxhY2VIb2xkZXIgaXMgVG9rZW5Db250cm9sbGVyLCBPd25lZCB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBNaW5pTWVUb2tlbiBwdWJsaWMgc250OwogICAgU3RhdHVzQ29udHJpYnV0aW9uIHB1YmxpYyBjb250cmlidXRpb247CiAgICB1aW50MjU2IHB1YmxpYyBhY3RpdmF0aW9uVGltZTsKICAgIGFkZHJlc3MgcHVibGljIHNndEV4Y2hhbmdlcjsKCiAgICAvLy8gQG5vdGljZSBDb25zdHJ1Y3RvcgogICAgLy8vIEBwYXJhbSBfb3duZXIgVHJ1c3RlZCBvd25lciBmb3IgdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3NudCBTTlQgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgLy8vIEBwYXJhbSBfY29udHJpYnV0aW9uIFN0YXR1c0NvbnRyaWJ1dGlvbiBjb250cmFjdCBhZGRyZXNzCiAgICAvLy8gQHBhcmFtIF9zZ3RFeGNoYW5nZXIgU0dULVNOVCBFeGNoYW5nZSBhZGRyZXNzLiAoRHVyaW5nIHRoZSBmaXJzdCB3ZWVrCiAgICAvLy8gIG9ubHkgdGhpcyBleGNoYW5nZXIgd2lsbCBiZSBhYmxlIHRvIG1vdmUgdG9rZW5zKQogICAgZnVuY3Rpb24gU05UUGxhY2VIb2xkZXIoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NudCwgYWRkcmVzcyBfY29udHJpYnV0aW9uLCBhZGRyZXNzIF9zZ3RFeGNoYW5nZXIpIHsKICAgICAgICBvd25lciA9IF9vd25lcjsKICAgICAgICBzbnQgPSBNaW5pTWVUb2tlbihfc250KTsKICAgICAgICBjb250cmlidXRpb24gPSBTdGF0dXNDb250cmlidXRpb24oX2NvbnRyaWJ1dGlvbik7CiAgICAgICAgc2d0RXhjaGFuZ2VyID0gX3NndEV4Y2hhbmdlcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBUaGUgb3duZXIgb2YgdGhpcyBjb250cmFjdCBjYW4gY2hhbmdlIHRoZSBjb250cm9sbGVyIG9mIHRoZSBTTlQgdG9rZW4KICAgIC8vLyAgUGxlYXNlLCBiZSBzdXJlIHRoYXQgdGhlIG93bmVyIGlzIGEgdHJ1c3RlZCBhZ2VudCBvciAweDAgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX25ld0NvbnRyb2xsZXIgVGhlIGFkZHJlc3Mgb2YgdGhlIG5ldyBjb250cm9sbGVyCgogICAgZnVuY3Rpb24gY2hhbmdlQ29udHJvbGxlcihhZGRyZXNzIF9uZXdDb250cm9sbGVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBzbnQuY2hhbmdlQ29udHJvbGxlcihfbmV3Q29udHJvbGxlcik7CiAgICAgICAgQ29udHJvbGxlckNoYW5nZWQoX25ld0NvbnRyb2xsZXIpOwogICAgfQoKCiAgICAvLy8vLy8vLy8vCiAgICAvLyBNaW5pTWUgQ29udHJvbGxlciBJbnRlcmZhY2UgZnVuY3Rpb25zCiAgICAvLy8vLy8vLy8vCgogICAgLy8gSW4gYmV0d2VlbiB0aGUgb2ZmZXJpbmcgYW5kIHRoZSBuZXR3b3JrLiBEZWZhdWx0IHNldHRpbmdzIGZvciBhbGxvd2luZyB0b2tlbiB0cmFuc2ZlcnMuCiAgICBmdW5jdGlvbiBwcm94eVBheW1lbnQoYWRkcmVzcykgcHVibGljIHBheWFibGUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBvblRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRyYW5zZmVyYWJsZShfZnJvbSk7CiAgICB9CgogICAgZnVuY3Rpb24gb25BcHByb3ZlKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MsIHVpbnQyNTYpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRyYW5zZmVyYWJsZShfZnJvbSk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJhYmxlKGFkZHJlc3MgX2Zyb20pIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvLyBBbGxvdyB0aGUgZXhjaGFuZ2VyIHRvIHdvcmsgZnJvbSB0aGUgYmVnaW5uaW5nCiAgICAgICAgaWYgKGFjdGl2YXRpb25UaW1lID09IDApIHsKICAgICAgICAgICAgdWludDI1NiBmID0gY29udHJpYnV0aW9uLmZpbmFsaXplZFRpbWUoKTsKICAgICAgICAgICAgaWYgKGYgPiAwKSB7CiAgICAgICAgICAgICAgICBhY3RpdmF0aW9uVGltZSA9IGYuYWRkKDEgd2Vla3MpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAoZ2V0VGltZSgpID4gYWN0aXZhdGlvblRpbWUpIHx8IChfZnJvbSA9PSBzZ3RFeGNoYW5nZXIpOwogICAgfQoKCiAgICAvLy8vLy8vLy8vCiAgICAvLyBUZXN0aW5nIHNwZWNpZmljIG1ldGhvZHMKICAgIC8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIGZ1bmN0aW9uIGlzIG92ZXJyaWRlZCBieSB0aGUgdGVzdCBNb2Nrcy4KICAgIGZ1bmN0aW9uIGdldFRpbWUoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIG5vdzsKICAgIH0KCgogICAgLy8vLy8vLy8vLwogICAgLy8gU2FmZXR5IE1ldGhvZHMKICAgIC8vLy8vLy8vLy8KCiAgICAvLy8gQG5vdGljZSBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBieSB0aGUgY29udHJvbGxlciB0byBleHRyYWN0IG1pc3Rha2VubHkKICAgIC8vLyAgc2VudCB0b2tlbnMgdG8gdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3Rva2VuIFRoZSBhZGRyZXNzIG9mIHRoZSB0b2tlbiBjb250cmFjdCB0aGF0IHlvdSB3YW50IHRvIHJlY292ZXIKICAgIC8vLyAgc2V0IHRvIDAgaW4gY2FzZSB5b3Ugd2FudCB0byBleHRyYWN0IGV0aGVyLgogICAgZnVuY3Rpb24gY2xhaW1Ub2tlbnMoYWRkcmVzcyBfdG9rZW4pIHB1YmxpYyBvbmx5T3duZXIgewogICAgICAgIGlmIChzbnQuY29udHJvbGxlcigpID09IGFkZHJlc3ModGhpcykpIHsKICAgICAgICAgICAgc250LmNsYWltVG9rZW5zKF90b2tlbik7CiAgICAgICAgfQogICAgICAgIGlmIChfdG9rZW4gPT0gMHgwKSB7CiAgICAgICAgICAgIG93bmVyLnRyYW5zZmVyKHRoaXMuYmFsYW5jZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIEVSQzIwVG9rZW4gdG9rZW4gPSBFUkMyMFRva2VuKF90b2tlbik7CiAgICAgICAgdWludDI1NiBiYWxhbmNlID0gdG9rZW4uYmFsYW5jZU9mKHRoaXMpOwogICAgICAgIHRva2VuLnRyYW5zZmVyKG93bmVyLCBiYWxhbmNlKTsKICAgICAgICBDbGFpbWVkVG9rZW5zKF90b2tlbiwgb3duZXIsIGJhbGFuY2UpOwogICAgfQoKICAgIGV2ZW50IENsYWltZWRUb2tlbnMoYWRkcmVzcyBpbmRleGVkIF90b2tlbiwgYWRkcmVzcyBpbmRleGVkIF9jb250cm9sbGVyLCB1aW50MjU2IF9hbW91bnQpOwogICAgZXZlbnQgQ29udHJvbGxlckNoYW5nZWQoYWRkcmVzcyBpbmRleGVkIF9uZXdDb250cm9sbGVyKTsKfQ=='.
	

]
