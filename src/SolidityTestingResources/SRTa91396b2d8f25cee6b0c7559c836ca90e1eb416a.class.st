Class {
	#name : #SRTa91396b2d8f25cee6b0c7559c836ca90e1eb416a,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTa91396b2d8f25cee6b0c7559c836ca90e1eb416a >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovLyA8T1JBQ0xJWkVfQVBJPgovKgpDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNiBPcmFjbGl6ZSBTUkwKQ29weXJpZ2h0IChjKSAyMDE2IE9yYWNsaXplIExURAoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCmFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKCgpUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgpJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMIFRIRQpBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KVEhFIFNPRlRXQVJFLgoqLwoKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMDsvL3BsZWFzZSBpbXBvcnQgb3JhY2xpemVBUElfcHJlMC40LnNvbCB3aGVuIHNvbGlkaXR5IDwgMC40LjAKCmNvbnRyYWN0IE9yYWNsaXplSSB7CiAgICBhZGRyZXNzIHB1YmxpYyBjYkFkZHJlc3M7CiAgICBmdW5jdGlvbiBxdWVyeSh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZywgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMikgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeTJfd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBzdHJpbmcgX2FyZzEsIHN0cmluZyBfYXJnMiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnlOKHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTikgcGF5YWJsZSByZXR1cm5zIChieXRlczMyIF9pZCk7CiAgICBmdW5jdGlvbiBxdWVyeU5fd2l0aEdhc0xpbWl0KHVpbnQgX3RpbWVzdGFtcCwgc3RyaW5nIF9kYXRhc291cmNlLCBieXRlcyBfYXJnTiwgdWludCBfZ2FzbGltaXQpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gZ2V0UHJpY2Uoc3RyaW5nIF9kYXRhc291cmNlKSByZXR1cm5zICh1aW50IF9kc3ByaWNlKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSwgdWludCBnYXNsaW1pdCkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiB1c2VDb3Vwb24oc3RyaW5nIF9jb3Vwb24pOwogICAgZnVuY3Rpb24gc2V0UHJvb2ZUeXBlKGJ5dGUgX3Byb29mVHlwZSk7CiAgICBmdW5jdGlvbiBzZXRDb25maWcoYnl0ZXMzMiBfY29uZmlnKTsKICAgIGZ1bmN0aW9uIHNldEN1c3RvbUdhc1ByaWNlKHVpbnQgX2dhc1ByaWNlKTsKICAgIGZ1bmN0aW9uIHJhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCkgcmV0dXJucyhieXRlczMyKTsKfQpjb250cmFjdCBPcmFjbGl6ZUFkZHJSZXNvbHZlckkgewogICAgZnVuY3Rpb24gZ2V0QWRkcmVzcygpIHJldHVybnMgKGFkZHJlc3MgX2FkZHIpOwp9CmNvbnRyYWN0IHVzaW5nT3JhY2xpemUgewogICAgdWludCBjb25zdGFudCBkYXkgPSA2MCo2MCoyNDsKICAgIHVpbnQgY29uc3RhbnQgd2VlayA9IDYwKjYwKjI0Kjc7CiAgICB1aW50IGNvbnN0YW50IG1vbnRoID0gNjAqNjAqMjQqMzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OT05FID0gMHgwMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX1RMU05vdGFyeSA9IDB4MTA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9BbmRyb2lkID0gMHgyMDsKICAgIGJ5dGUgY29uc3RhbnQgcHJvb2ZUeXBlX0xlZGdlciA9IDB4MzA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9OYXRpdmUgPSAweEYwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7CgogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKCiAgICBPcmFjbGl6ZUkgb3JhY2xpemU7CiAgICBtb2RpZmllciBvcmFjbGl6ZUFQSSB7CiAgICAgICAgaWYoKGFkZHJlc3MoT0FSKT09MCl8fChnZXRDb2RlU2l6ZShhZGRyZXNzKE9BUikpPT0wKSkKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CgogICAgICAgIGlmKGFkZHJlc3Mob3JhY2xpemUpICE9IE9BUi5nZXRBZGRyZXNzKCkpCiAgICAgICAgICAgIG9yYWNsaXplID0gT3JhY2xpemVJKE9BUi5nZXRBZGRyZXNzKCkpOwoKICAgICAgICBfOwogICAgfQogICAgbW9kaWZpZXIgY291cG9uKHN0cmluZyBjb2RlKXsKICAgICAgICBvcmFjbGl6ZSA9IE9yYWNsaXplSShPQVIuZ2V0QWRkcmVzcygpKTsKICAgICAgICBvcmFjbGl6ZS51c2VDb3Vwb24oY29kZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrKHVpbnQ4IG5ldHdvcmtJRCkgaW50ZXJuYWwgcmV0dXJucyhib29sKXsKICAgICAgICBpZiAoZ2V0Q29kZVNpemUoMHgxZDNCMjYzOGE3Y0M5ZjJDQjNEMjk4QTNEQTdhOTBCNjdFNTUwNmVkKT4wKXsgLy9tYWlubmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDFkM0IyNjM4YTdjQzlmMkNCM0QyOThBM0RBN2E5MEI2N0U1NTA2ZWQpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX21haW5uZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM0EyNjE1RDVlZmFmNUY0OUY2MEI3QkI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNBMjYxNUQ1ZWZhZjVGNDlGNjBCN0JCNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9yb3BzdGVuMyIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4QjdBMDdCY0YyQmEyZjI3MDNiMjRDMDY5MWI1Mjc4OTk5QzU5QUM3ZSk+MCl7IC8va292YW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhCN0EwN0JjRjJCYTJmMjcwM2IyNEMwNjkxYjUyNzg5OTlDNTlBQzdlKTsKICAgICAgICAgICAgb3JhY2xpemVfc2V0TmV0d29ya05hbWUoImV0aF9rb3ZhbiIpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MTQ2NTAwY2ZkMzVCMjJFNEEzOTJGZTBhRGMwNkRlMWExMzY4RWQ0OCk+MCl7IC8vcmlua2VieSB0ZXN0bmV0CiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDE0NjUwMGNmZDM1QjIyRTRBMzkyRmUwYURjMDZEZTFhMTM2OEVkNDgpOwogICAgICAgICAgICBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZSgiZXRoX3JpbmtlYnkiKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDZmNDg1QzhCRjZmYzQzZUEyMTJFOTNCQkY4Y2UwNDZDN2YxY2I0NzUpPjApeyAvL2V0aGVyZXVtLWJyaWRnZQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg2ZjQ4NUM4QkY2ZmM0M2VBMjEyRTkzQkJGOGNlMDQ2QzdmMWNiNDc1KTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyQTFGODU5QjNGZWFFNUZiMkEwQTMyQzE4RjVhNjU1NTViQkYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4NTFlZmFGNGM4QjNDOUFmQkQ1YUI5RjRiYkM4Mjc4NEFiNmVmOGZBQSk+MCl7IC8vYnJvd3Nlci1zb2xpZGl0eQogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg1MWVmYUY0YzhCM0M5QWZCRDVhQjlGNGJiQzgyNzg0QWI2ZWY4ZkFBKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewogICAgICAgIF9fY2FsbGJhY2sobXlpZCwgcmVzdWx0LCBuZXcgYnl0ZXMoMCkpOwogICAgfQogICAgZnVuY3Rpb24gX19jYWxsYmFjayhieXRlczMyIG15aWQsIHN0cmluZyByZXN1bHQsIGJ5dGVzIHByb29mKSB7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfdXNlQ291cG9uKHN0cmluZyBjb2RlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeV93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcxLCBhcmcyLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ml93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKDAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Ti52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04pIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqMjAwMDAwKSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBzdHJhMmNib3IoYXJnTik7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Tl93aXRoR2FzTGltaXQudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1tdIGFyZ04sIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICBieXRlcyBtZW1vcnkgYXJncyA9IHN0cmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1sxXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMV0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDEpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1syXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbMl0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDIpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzNdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1szXSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oMyk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzRdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZ1s0XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgc3RyaW5nW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgc3RyaW5nW10oNCk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmdbNV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIHN0cmluZ1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IHN0cmluZ1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nWzVdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBzdHJpbmdbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBzdHJpbmdbXSg1KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICBkeW5hcmdzWzRdID0gYXJnc1s0XTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOLnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU4udmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzW10gYXJnTiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIGJ5dGVzIG1lbW9yeSBhcmdzID0gYmEyY2JvcihhcmdOKTsKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnlOX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbXSBhcmdOLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFyZ3MgPSBiYTJjYm9yKGFyZ04pOwogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeU5fd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSgwLCBkYXRhc291cmNlLCBhcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMV0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgxKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzFdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbMl0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgyKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncyk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzJdIGFyZ3MsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oMik7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1szXSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDMpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbM10gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSgzKTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s0XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDQpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkodGltZXN0YW1wLCBkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgYnl0ZXNbNF0gYXJncywgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCkgewogICAgICAgIGJ5dGVzW10gbWVtb3J5IGR5bmFyZ3MgPSBuZXcgYnl0ZXNbXSg0KTsKICAgICAgICBkeW5hcmdzWzBdID0gYXJnc1swXTsKICAgICAgICBkeW5hcmdzWzFdID0gYXJnc1sxXTsKICAgICAgICBkeW5hcmdzWzJdID0gYXJnc1syXTsKICAgICAgICBkeW5hcmdzWzNdID0gYXJnc1szXTsKICAgICAgICByZXR1cm4gb3JhY2xpemVfcXVlcnkoZGF0YXNvdXJjZSwgZHluYXJncywgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkoc3RyaW5nIGRhdGFzb3VyY2UsIGJ5dGVzWzVdIGFyZ3MpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpIHsKICAgICAgICBieXRlc1tdIG1lbW9yeSBkeW5hcmdzID0gbmV3IGJ5dGVzW10oNSk7CiAgICAgICAgZHluYXJnc1swXSA9IGFyZ3NbMF07CiAgICAgICAgZHluYXJnc1sxXSA9IGFyZ3NbMV07CiAgICAgICAgZHluYXJnc1syXSA9IGFyZ3NbMl07CiAgICAgICAgZHluYXJnc1szXSA9IGFyZ3NbM107CiAgICAgICAgZHluYXJnc1s0XSA9IGFyZ3NbNF07CiAgICAgICAgcmV0dXJuIG9yYWNsaXplX3F1ZXJ5KGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGR5bmFyZ3MsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBieXRlc1s1XSBhcmdzLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKSB7CiAgICAgICAgYnl0ZXNbXSBtZW1vcnkgZHluYXJncyA9IG5ldyBieXRlc1tdKDUpOwogICAgICAgIGR5bmFyZ3NbMF0gPSBhcmdzWzBdOwogICAgICAgIGR5bmFyZ3NbMV0gPSBhcmdzWzFdOwogICAgICAgIGR5bmFyZ3NbMl0gPSBhcmdzWzJdOwogICAgICAgIGR5bmFyZ3NbM10gPSBhcmdzWzNdOwogICAgICAgIGR5bmFyZ3NbNF0gPSBhcmdzWzRdOwogICAgICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeShkYXRhc291cmNlLCBkeW5hcmdzLCBnYXNsaW1pdCk7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3NldENvbmZpZyhieXRlczMyIGNvbmZpZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5zZXRDb25maWcoY29uZmlnKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5yYW5kb21EU19nZXRTZXNzaW9uUHViS2V5SGFzaCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENvZGVTaXplKGFkZHJlc3MgX2FkZHIpIGNvbnN0YW50IGludGVybmFsIHJldHVybnModWludCBfc2l6ZSkgewogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgX3NpemUgOj0gZXh0Y29kZXNpemUoX2FkZHIpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDY1KSYmKGIxIDw9IDcwKSkgYjEgLT0gNTU7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMSA+PSA0OCkmJihiMSA8PSA1NykpIGIxIC09IDQ4OwogICAgICAgICAgICBpZiAoKGIyID49IDk3KSYmKGIyIDw9IDEwMikpIGIyIC09IDg3OwogICAgICAgICAgICBlbHNlIGlmICgoYjIgPj0gNjUpJiYoYjIgPD0gNzApKSBiMiAtPSA1NTsKICAgICAgICAgICAgZWxzZSBpZiAoKGIyID49IDQ4KSYmKGIyIDw9IDU3KSkgYjIgLT0gNDg7CiAgICAgICAgICAgIGlhZGRyICs9IChiMSoxNitiMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhZGRyZXNzKGlhZGRyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb21wYXJlKHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYSA9IGJ5dGVzKF9hKTsKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IGJ5dGVzKF9iKTsKICAgICAgICB1aW50IG1pbkxlbmd0aCA9IGEubGVuZ3RoOwogICAgICAgIGlmIChiLmxlbmd0aCA8IG1pbkxlbmd0aCkgbWluTGVuZ3RoID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbWluTGVuZ3RoOyBpICsrKQogICAgICAgICAgICBpZiAoYVtpXSA8IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGVsc2UgaWYgKGFbaV0gPiBiW2ldKQogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEubGVuZ3RoIDwgYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICBlbHNlIGlmIChhLmxlbmd0aCA+IGIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGluZGV4T2Yoc3RyaW5nIF9oYXlzdGFjaywgc3RyaW5nIF9uZWVkbGUpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZihoLmxlbmd0aCA+ICgyKioxMjggLTEpKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdWludCBzdWJpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGgubGVuZ3RoOyBpICsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoaFtpXSA9PSBuWzBdKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YmluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB3aGlsZShzdWJpbmRleCA8IG4ubGVuZ3RoICYmIChpICsgc3ViaW5kZXgpIDwgaC5sZW5ndGggJiYgaFtpICsgc3ViaW5kZXhdID09IG5bc3ViaW5kZXhdKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoc3ViaW5kZXggPT0gbi5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYywgc3RyaW5nIF9kLCBzdHJpbmcgX2UpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmEgPSBieXRlcyhfYSk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYiA9IGJ5dGVzKF9iKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JjID0gYnl0ZXMoX2MpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmQgPSBieXRlcyhfZCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iZSA9IGJ5dGVzKF9lKTsKICAgICAgICBzdHJpbmcgbWVtb3J5IGFiY2RlID0gbmV3IHN0cmluZyhfYmEubGVuZ3RoICsgX2JiLmxlbmd0aCArIF9iYy5sZW5ndGggKyBfYmQubGVuZ3RoICsgX2JlLmxlbmd0aCk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJhYmNkZSA9IGJ5dGVzKGFiY2RlKTsKICAgICAgICB1aW50IGsgPSAwOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IF9iYS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmFbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYi5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmJbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iYy5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmNbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZC5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmRbaV07CiAgICAgICAgZm9yIChpID0gMDsgaSA8IF9iZS5sZW5ndGg7IGkrKykgYmFiY2RlW2srK10gPSBfYmVbaV07CiAgICAgICAgcmV0dXJuIHN0cmluZyhiYWJjZGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIHJldHVybiBzdHJDb25jYXQoX2EsIF9iLCBfYywgX2QsICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJDb25jYXQoc3RyaW5nIF9hLCBzdHJpbmcgX2IsIHN0cmluZyBfYykgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCAiIiwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsICIiLCAiIiwgIiIpOwogICAgfQoKICAgIC8vIHBhcnNlSW50CiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQoX2EsIDApOwogICAgfQoKICAgIC8vIHBhcnNlSW50KHBhcnNlRmxvYXQqMTBeX2IpCiAgICBmdW5jdGlvbiBwYXJzZUludChzdHJpbmcgX2EsIHVpbnQgX2IpIGludGVybmFsIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBieXRlcyBtZW1vcnkgYnJlc3VsdCA9IGJ5dGVzKF9hKTsKICAgICAgICB1aW50IG1pbnQgPSAwOwogICAgICAgIGJvb2wgZGVjaW1hbHMgPSBmYWxzZTsKICAgICAgICBmb3IgKHVpbnQgaT0wOyBpPGJyZXN1bHQubGVuZ3RoOyBpKyspewogICAgICAgICAgICBpZiAoKGJyZXN1bHRbaV0gPj0gNDgpJiYoYnJlc3VsdFtpXSA8PSA1NykpewogICAgICAgICAgICAgICAgaWYgKGRlY2ltYWxzKXsKICAgICAgICAgICAgICAgICAgIGlmIChfYiA9PSAwKSBicmVhazsKICAgICAgICAgICAgICAgICAgICBlbHNlIF9iLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtaW50ICo9IDEwOwogICAgICAgICAgICAgICAgbWludCArPSB1aW50KGJyZXN1bHRbaV0pIC0gNDg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYnJlc3VsdFtpXSA9PSA0NikgZGVjaW1hbHMgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoX2IgPiAwKSBtaW50ICo9IDEwKipfYjsKICAgICAgICByZXR1cm4gbWludDsKICAgIH0KCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzdHJhMmNib3Ioc3RyaW5nW10gYXJyKSBpbnRlcm5hbCByZXR1cm5zIChieXRlcykgewogICAgICAgICAgICB1aW50IGFycmxlbiA9IGFyci5sZW5ndGg7CgogICAgICAgICAgICAvLyBnZXQgY29ycmVjdCBjYm9yIG91dHB1dCBsZW5ndGgKICAgICAgICAgICAgdWludCBvdXRwdXRsZW4gPSAwOwogICAgICAgICAgICBieXRlc1tdIG1lbW9yeSBlbGVtQXJyYXkgPSBuZXcgYnl0ZXNbXShhcnJsZW4pOwogICAgICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgZWxlbUFycmF5W2ldID0gKGJ5dGVzKGFycltpXSkpOwogICAgICAgICAgICAgICAgb3V0cHV0bGVuICs9IGVsZW1BcnJheVtpXS5sZW5ndGggKyAoZWxlbUFycmF5W2ldLmxlbmd0aCAtIDEpLzIzICsgMzsgLy8rMyBhY2NvdW50cyBmb3IgcGFpcmVkIGlkZW50aWZpZXIgdHlwZXMKICAgICAgICAgICAgfQogICAgICAgICAgICB1aW50IGN0ciA9IDA7CiAgICAgICAgICAgIHVpbnQgY2JvcmxlbiA9IGFycmxlbiArIDB4ODA7CiAgICAgICAgICAgIG91dHB1dGxlbiArPSBieXRlKGNib3JsZW4pLmxlbmd0aDsKICAgICAgICAgICAgYnl0ZXMgbWVtb3J5IHJlcyA9IG5ldyBieXRlcyhvdXRwdXRsZW4pOwoKICAgICAgICAgICAgd2hpbGUgKGJ5dGUoY2JvcmxlbikubGVuZ3RoID4gY3RyKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGJ5dGUoY2JvcmxlbilbY3RyXTsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnJsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweDVGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgICAgICBmb3IgKHVpbnQgeCA9IDA7IHggPCBlbGVtQXJyYXlbaV0ubGVuZ3RoOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGEgYnVnIHdpdGggbGFyZ2VyIHN0cmluZ3MsIHRoaXMgbWF5IGJlIHRoZSBjdWxwcml0CiAgICAgICAgICAgICAgICAgICAgaWYgKHggJSAyMyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgZWxlbWNib3JsZW4gPSBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geCA+PSAyNCA/IDIzIDogZWxlbUFycmF5W2ldLmxlbmd0aCAtIHg7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1jYm9ybGVuICs9IDB4NDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQgbGN0ciA9IGN0cjsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGJ5dGUoZWxlbWNib3JsZW4pLmxlbmd0aCA+IGN0ciAtIGxjdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShlbGVtY2JvcmxlbilbY3RyIC0gbGN0cl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXNbY3RyXSA9IGVsZW1BcnJheVtpXVt4XTsKICAgICAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gMHhGRjsKICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgfQoKICAgIGZ1bmN0aW9uIGJhMmNib3IoYnl0ZXNbXSBhcnIpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgICAgIHVpbnQgYXJybGVuID0gYXJyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIGdldCBjb3JyZWN0IGNib3Igb3V0cHV0IGxlbmd0aAogICAgICAgICAgICB1aW50IG91dHB1dGxlbiA9IDA7CiAgICAgICAgICAgIGJ5dGVzW10gbWVtb3J5IGVsZW1BcnJheSA9IG5ldyBieXRlc1tdKGFycmxlbik7CiAgICAgICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbGVtQXJyYXlbaV0gPSAoYnl0ZXMoYXJyW2ldKSk7CiAgICAgICAgICAgICAgICBvdXRwdXRsZW4gKz0gZWxlbUFycmF5W2ldLmxlbmd0aCArIChlbGVtQXJyYXlbaV0ubGVuZ3RoIC0gMSkvMjMgKyAzOyAvLyszIGFjY291bnRzIGZvciBwYWlyZWQgaWRlbnRpZmllciB0eXBlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVpbnQgY3RyID0gMDsKICAgICAgICAgICAgdWludCBjYm9ybGVuID0gYXJybGVuICsgMHg4MDsKICAgICAgICAgICAgb3V0cHV0bGVuICs9IGJ5dGUoY2JvcmxlbikubGVuZ3RoOwogICAgICAgICAgICBieXRlcyBtZW1vcnkgcmVzID0gbmV3IGJ5dGVzKG91dHB1dGxlbik7CgogICAgICAgICAgICB3aGlsZSAoYnl0ZShjYm9ybGVuKS5sZW5ndGggPiBjdHIpIHsKICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gYnl0ZShjYm9ybGVuKVtjdHJdOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFycmxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICByZXNbY3RyXSA9IDB4NUY7CiAgICAgICAgICAgICAgICBjdHIrKzsKICAgICAgICAgICAgICAgIGZvciAodWludCB4ID0gMDsgeCA8IGVsZW1BcnJheVtpXS5sZW5ndGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3MgYSBidWcgd2l0aCBsYXJnZXIgc3RyaW5ncywgdGhpcyBtYXkgYmUgdGhlIGN1bHByaXQKICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIDIzID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBlbGVtY2JvcmxlbiA9IGVsZW1BcnJheVtpXS5sZW5ndGggLSB4ID49IDI0ID8gMjMgOiBlbGVtQXJyYXlbaV0ubGVuZ3RoIC0geDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWNib3JsZW4gKz0gMHg0MDsKICAgICAgICAgICAgICAgICAgICAgICAgdWludCBsY3RyID0gY3RyOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYnl0ZShlbGVtY2JvcmxlbikubGVuZ3RoID4gY3RyIC0gbGN0cikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzW2N0cl0gPSBieXRlKGVsZW1jYm9ybGVuKVtjdHIgLSBsY3RyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc1tjdHJdID0gZWxlbUFycmF5W2ldW3hdOwogICAgICAgICAgICAgICAgICAgIGN0cisrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzW2N0cl0gPSAweEZGOwogICAgICAgICAgICAgICAgY3RyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICB9CgoKICAgIHN0cmluZyBvcmFjbGl6ZV9uZXR3b3JrX25hbWU7CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXROZXR3b3JrTmFtZShzdHJpbmcgX25ldHdvcmtfbmFtZSkgaW50ZXJuYWwgewogICAgICAgIG9yYWNsaXplX25ldHdvcmtfbmFtZSA9IF9uZXR3b3JrX25hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gb3JhY2xpemVfbmV0d29ya19uYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX25ld1JhbmRvbURTUXVlcnkodWludCBfZGVsYXksIHVpbnQgX25ieXRlcywgdWludCBfY3VzdG9tR2FzTGltaXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIpewogICAgICAgIGlmICgoX25ieXRlcyA9PSAwKXx8KF9uYnl0ZXMgPiAzMikpIHRocm93OwogICAgICAgIGJ5dGVzIG1lbW9yeSBuYnl0ZXMgPSBuZXcgYnl0ZXMoMSk7CiAgICAgICAgbmJ5dGVzWzBdID0gYnl0ZShfbmJ5dGVzKTsKICAgICAgICBieXRlcyBtZW1vcnkgdW5vbmNlID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICBieXRlcyBtZW1vcnkgc2Vzc2lvbktleUhhc2ggPSBuZXcgYnl0ZXMoMzIpOwogICAgICAgIGJ5dGVzMzIgc2Vzc2lvbktleUhhc2hfYnl0ZXMzMiA9IG9yYWNsaXplX3JhbmRvbURTX2dldFNlc3Npb25QdWJLZXlIYXNoKCk7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBtc3RvcmUodW5vbmNlLCAweDIwKQogICAgICAgICAgICBtc3RvcmUoYWRkKHVub25jZSwgMHgyMCksIHhvcihibG9ja2hhc2goc3ViKG51bWJlciwgMSkpLCB4b3IoY29pbmJhc2UsIHRpbWVzdGFtcCkpKQogICAgICAgICAgICBtc3RvcmUoc2Vzc2lvbktleUhhc2gsIDB4MjApCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2Vzc2lvbktleUhhc2gsIDB4MjApLCBzZXNzaW9uS2V5SGFzaF9ieXRlczMyKQogICAgICAgIH0KICAgICAgICBieXRlc1szXSBtZW1vcnkgYXJncyA9IFt1bm9uY2UsIG5ieXRlcywgc2Vzc2lvbktleUhhc2hdOwogICAgICAgIGJ5dGVzMzIgcXVlcnlJZCA9IG9yYWNsaXplX3F1ZXJ5KF9kZWxheSwgInJhbmRvbSIsIGFyZ3MsIF9jdXN0b21HYXNMaW1pdCk7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfc2V0Q29tbWl0bWVudChxdWVyeUlkLCBzaGEzKGJ5dGVzOChfZGVsYXkpLCBhcmdzWzFdLCBzaGEyNTYoYXJnc1swXSksIGFyZ3NbMl0pKTsKICAgICAgICByZXR1cm4gcXVlcnlJZDsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9yYW5kb21EU19zZXRDb21taXRtZW50KGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMzMiBjb21taXRtZW50KSBpbnRlcm5hbCB7CiAgICAgICAgb3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9IGNvbW1pdG1lbnQ7CiAgICB9CgogICAgbWFwcGluZyhieXRlczMyPT5ieXRlczMyKSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzOwogICAgbWFwcGluZyhieXRlczMyPT5ib29sKSBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZDsKCiAgICBmdW5jdGlvbiB2ZXJpZnlTaWcoYnl0ZXMzMiB0b3NpZ25oLCBieXRlcyBkZXJzaWcsIGJ5dGVzIHB1YmtleSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBzaWdvazsKICAgICAgICBhZGRyZXNzIHNpZ25lcjsKCiAgICAgICAgYnl0ZXMzMiBzaWdyOwogICAgICAgIGJ5dGVzMzIgc2lnczsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZ3JfID0gbmV3IGJ5dGVzKDMyKTsKICAgICAgICB1aW50IG9mZnNldCA9IDQrKHVpbnQoZGVyc2lnWzNdKSAtIDB4MjApOwogICAgICAgIHNpZ3JfID0gY29weUJ5dGVzKGRlcnNpZywgb2Zmc2V0LCAzMiwgc2lncl8sIDApOwogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWdzXyA9IG5ldyBieXRlcygzMik7CiAgICAgICAgb2Zmc2V0ICs9IDMyICsgMjsKICAgICAgICBzaWdzXyA9IGNvcHlCeXRlcyhkZXJzaWcsIG9mZnNldCsodWludChkZXJzaWdbb2Zmc2V0LTFdKSAtIDB4MjApLCAzMiwgc2lnc18sIDApOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHNpZ3IgOj0gbWxvYWQoYWRkKHNpZ3JfLCAzMikpCiAgICAgICAgICAgIHNpZ3MgOj0gbWxvYWQoYWRkKHNpZ3NfLCAzMikpCiAgICAgICAgfQoKCiAgICAgICAgKHNpZ29rLCBzaWduZXIpID0gc2FmZXJfZWNyZWNvdmVyKHRvc2lnbmgsIDI3LCBzaWdyLCBzaWdzKTsKICAgICAgICBpZiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcikgcmV0dXJuIHRydWU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIChzaWdvaywgc2lnbmVyKSA9IHNhZmVyX2VjcmVjb3Zlcih0b3NpZ25oLCAyOCwgc2lnciwgc2lncyk7CiAgICAgICAgICAgIHJldHVybiAoYWRkcmVzcyhzaGEzKHB1YmtleSkpID09IHNpZ25lcik7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19zZXNzaW9uS2V5VmFsaWRpdHkoYnl0ZXMgcHJvb2YsIHVpbnQgc2lnMm9mZnNldCkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgc2lnb2s7CgogICAgICAgIC8vIFN0ZXAgNjogdmVyaWZ5IHRoZSBhdHRlc3RhdGlvbiBzaWduYXR1cmUsIEFQUEtFWTEgbXVzdCBzaWduIHRoZSBzZXNzaW9uS2V5IGZyb20gdGhlIGNvcnJlY3QgbGVkZ2VyIGFwcCAoQ09ERUhBU0gpCiAgICAgICAgYnl0ZXMgbWVtb3J5IHNpZzIgPSBuZXcgYnl0ZXModWludChwcm9vZltzaWcyb2Zmc2V0KzFdKSsyKTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQsIHNpZzIubGVuZ3RoLCBzaWcyLCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGFwcGtleTFfcHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIDMrMSwgNjQsIGFwcGtleTFfcHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IHRvc2lnbjIgPSBuZXcgYnl0ZXMoMSs2NSszMik7CiAgICAgICAgdG9zaWduMlswXSA9IDE7IC8vcm9sZQogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgc2lnMm9mZnNldC02NSwgNjUsIHRvc2lnbjIsIDEpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBDT0RFSEFTSCA9IGhleCJmZDk0ZmE3MWJjMGJhMTBkMzlkNDY0ZDBkOGY0NjVlZmVlZjBhMjc2NGUzODg3ZmNjOWRmNDFkZWQyMGY1MDVjIjsKICAgICAgICBjb3B5Qnl0ZXMoQ09ERUhBU0gsIDAsIDMyLCB0b3NpZ24yLCAxKzY1KTsKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMiksIHNpZzIsIGFwcGtleTFfcHVia2V5KTsKCiAgICAgICAgaWYgKHNpZ29rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDc6IHZlcmlmeSB0aGUgQVBQS0VZMSBwcm92ZW5hbmNlIChtdXN0IGJlIHNpZ25lZCBieSBMZWRnZXIpCiAgICAgICAgYnl0ZXMgbWVtb3J5IExFREdFUktFWSA9IGhleCI3ZmI5NTY0NjljNWM5Yjg5ODQwZDU1YjQzNTM3ZTY2YTk4ZGQ0ODExZWEwYTI3MjI0MjcyYzJlNTYyMjkxMWU4NTM3YTJmOGU4NmE0NmJhZWM4Mjg2NGU5OGRkMDFlOWNjYzJmOGJjNWRmYzljYmU1YTkxYTI5MDQ5OGRkOTZlNCI7CgogICAgICAgIGJ5dGVzIG1lbW9yeSB0b3NpZ24zID0gbmV3IGJ5dGVzKDErNjUpOwogICAgICAgIHRvc2lnbjNbMF0gPSAweEZFOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMywgNjUsIHRvc2lnbjMsIDEpOwoKICAgICAgICBieXRlcyBtZW1vcnkgc2lnMyA9IG5ldyBieXRlcyh1aW50KHByb29mWzMrNjUrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgMys2NSwgc2lnMy5sZW5ndGgsIHNpZzMsIDApOwoKICAgICAgICBzaWdvayA9IHZlcmlmeVNpZyhzaGEyNTYodG9zaWduMyksIHNpZzMsIExFREdFUktFWSk7CgogICAgICAgIHJldHVybiBzaWdvazsKICAgIH0KCiAgICBtb2RpZmllciBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeShieXRlczMyIF9xdWVyeUlkLCBzdHJpbmcgX3Jlc3VsdCwgYnl0ZXMgX3Byb29mKSB7CiAgICAgICAgLy8gU3RlcCAxOiB0aGUgcHJlZml4IGhhcyB0byBtYXRjaCAnTFBceDAxJyAoTGVkZ2VyIFByb29mIHZlcnNpb24gMSkKICAgICAgICBpZiAoKF9wcm9vZlswXSAhPSAiTCIpfHwoX3Byb29mWzFdICE9ICJQIil8fChfcHJvb2ZbMl0gIT0gMSkpIHRocm93OwoKICAgICAgICBib29sIHByb29mVmVyaWZpZWQgPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fbWFpbihfcHJvb2YsIF9xdWVyeUlkLCBieXRlcyhfcmVzdWx0KSwgb3JhY2xpemVfZ2V0TmV0d29ya05hbWUoKSk7CiAgICAgICAgaWYgKHByb29mVmVyaWZpZWQgPT0gZmFsc2UpIHRocm93OwoKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19yZXR1cm5Db2RlKGJ5dGVzMzIgX3F1ZXJ5SWQsIHN0cmluZyBfcmVzdWx0LCBieXRlcyBfcHJvb2YpIGludGVybmFsIHJldHVybnMgKHVpbnQ4KXsKICAgICAgICAvLyBTdGVwIDE6IHRoZSBwcmVmaXggaGFzIHRvIG1hdGNoICdMUFx4MDEnIChMZWRnZXIgUHJvb2YgdmVyc2lvbiAxKQogICAgICAgIGlmICgoX3Byb29mWzBdICE9ICJMIil8fChfcHJvb2ZbMV0gIT0gIlAiKXx8KF9wcm9vZlsyXSAhPSAxKSkgcmV0dXJuIDE7CgogICAgICAgIGJvb2wgcHJvb2ZWZXJpZmllZCA9IG9yYWNsaXplX3JhbmRvbURTX3Byb29mVmVyaWZ5X19tYWluKF9wcm9vZiwgX3F1ZXJ5SWQsIGJ5dGVzKF9yZXN1bHQpLCBvcmFjbGl6ZV9nZXROZXR3b3JrTmFtZSgpKTsKICAgICAgICBpZiAocHJvb2ZWZXJpZmllZCA9PSBmYWxzZSkgcmV0dXJuIDI7CgogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGZ1bmN0aW9uIG1hdGNoQnl0ZXMzMlByZWZpeChieXRlczMyIGNvbnRlbnQsIGJ5dGVzIHByZWZpeCwgdWludCBuX3JhbmRvbV9ieXRlcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCl7CiAgICAgICAgYm9vbCBtYXRjaF8gPSB0cnVlOwogICAgICAgIAogICAgICAgIGZvciAodWludDI1NiBpPTA7IGk8IG5fcmFuZG9tX2J5dGVzOyBpKyspIHsKICAgICAgICAgICAgaWYgKGNvbnRlbnRbaV0gIT0gcHJlZml4W2ldKSBtYXRjaF8gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfcmFuZG9tRFNfcHJvb2ZWZXJpZnlfX21haW4oYnl0ZXMgcHJvb2YsIGJ5dGVzMzIgcXVlcnlJZCwgYnl0ZXMgcmVzdWx0LCBzdHJpbmcgY29udGV4dF9uYW1lKSBpbnRlcm5hbCByZXR1cm5zIChib29sKXsKCiAgICAgICAgLy8gU3RlcCAyOiB0aGUgdW5pcXVlIGtleWhhc2ggaGFzIHRvIG1hdGNoIHdpdGggdGhlIHNoYTI1NiBvZiAoY29udGV4dCBuYW1lICsgcXVlcnlJZCkKICAgICAgICB1aW50IGxlZGdlclByb29mTGVuZ3RoID0gMys2NSsodWludChwcm9vZlszKzY1KzFdKSsyKSszMjsKICAgICAgICBieXRlcyBtZW1vcnkga2V5aGFzaCA9IG5ldyBieXRlcygzMik7CiAgICAgICAgY29weUJ5dGVzKHByb29mLCBsZWRnZXJQcm9vZkxlbmd0aCwgMzIsIGtleWhhc2gsIDApOwogICAgICAgIGlmICghKHNoYTMoa2V5aGFzaCkgPT0gc2hhMyhzaGEyNTYoY29udGV4dF9uYW1lLCBxdWVyeUlkKSkpKSByZXR1cm4gZmFsc2U7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzaWcxID0gbmV3IGJ5dGVzKHVpbnQocHJvb2ZbbGVkZ2VyUHJvb2ZMZW5ndGgrKDMyKzgrMSszMikrMV0pKzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrKDMyKzgrMSszMiksIHNpZzEubGVuZ3RoLCBzaWcxLCAwKTsKCiAgICAgICAgLy8gU3RlcCAzOiB3ZSBhc3N1bWUgc2lnMSBpcyB2YWxpZCAoaXQgd2lsbCBiZSB2ZXJpZmllZCBkdXJpbmcgc3RlcCA1KSBhbmQgd2UgdmVyaWZ5IGlmICdyZXN1bHQnIGlzIHRoZSBwcmVmaXggb2Ygc2hhMjU2KHNpZzEpCiAgICAgICAgaWYgKCFtYXRjaEJ5dGVzMzJQcmVmaXgoc2hhMjU2KHNpZzEpLCByZXN1bHQsIHVpbnQocHJvb2ZbbGVkZ2VyUHJvb2ZMZW5ndGgrMzIrOF0pKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBTdGVwIDQ6IGNvbW1pdG1lbnQgbWF0Y2ggdmVyaWZpY2F0aW9uLCBzaGEzKGRlbGF5LCBuYnl0ZXMsIHVub25jZSwgc2Vzc2lvbktleUhhc2gpID09IGNvbW1pdG1lbnQgaW4gc3RvcmFnZS4KICAgICAgICAvLyBUaGlzIGlzIHRvIHZlcmlmeSB0aGF0IHRoZSBjb21wdXRlZCBhcmdzIG1hdGNoIHdpdGggdGhlIG9uZXMgc3BlY2lmaWVkIGluIHRoZSBxdWVyeS4KICAgICAgICBieXRlcyBtZW1vcnkgY29tbWl0bWVudFNsaWNlMSA9IG5ldyBieXRlcyg4KzErMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgrMzIsIDgrMSszMiwgY29tbWl0bWVudFNsaWNlMSwgMCk7CgogICAgICAgIGJ5dGVzIG1lbW9yeSBzZXNzaW9uUHVia2V5ID0gbmV3IGJ5dGVzKDY0KTsKICAgICAgICB1aW50IHNpZzJvZmZzZXQgPSBsZWRnZXJQcm9vZkxlbmd0aCszMisoOCsxKzMyKStzaWcxLmxlbmd0aCs2NTsKICAgICAgICBjb3B5Qnl0ZXMocHJvb2YsIHNpZzJvZmZzZXQtNjQsIDY0LCBzZXNzaW9uUHVia2V5LCAwKTsKCiAgICAgICAgYnl0ZXMzMiBzZXNzaW9uUHVia2V5SGFzaCA9IHNoYTI1NihzZXNzaW9uUHVia2V5KTsKICAgICAgICBpZiAob3JhY2xpemVfcmFuZG9tRFNfYXJnc1txdWVyeUlkXSA9PSBzaGEzKGNvbW1pdG1lbnRTbGljZTEsIHNlc3Npb25QdWJrZXlIYXNoKSl7IC8vdW5vbmNlLCBuYnl0ZXMgYW5kIHNlc3Npb25LZXlIYXNoIG1hdGNoCiAgICAgICAgICAgIGRlbGV0ZSBvcmFjbGl6ZV9yYW5kb21EU19hcmdzW3F1ZXJ5SWRdOwogICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7CgoKICAgICAgICAvLyBTdGVwIDU6IHZhbGlkaXR5IHZlcmlmaWNhdGlvbiBmb3Igc2lnMSAoa2V5aGFzaCBhbmQgYXJncyBzaWduZWQgd2l0aCB0aGUgc2Vzc2lvbktleSkKICAgICAgICBieXRlcyBtZW1vcnkgdG9zaWduMSA9IG5ldyBieXRlcygzMis4KzErMzIpOwogICAgICAgIGNvcHlCeXRlcyhwcm9vZiwgbGVkZ2VyUHJvb2ZMZW5ndGgsIDMyKzgrMSszMiwgdG9zaWduMSwgMCk7CiAgICAgICAgaWYgKCF2ZXJpZnlTaWcoc2hhMjU2KHRvc2lnbjEpLCBzaWcxLCBzZXNzaW9uUHVia2V5KSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyB2ZXJpZnkgaWYgc2Vzc2lvblB1YmtleUhhc2ggd2FzIHZlcmlmaWVkIGFscmVhZHksIGlmIG5vdC4uIGxldCdzIGRvIGl0IQogICAgICAgIGlmIChvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPT0gZmFsc2UpewogICAgICAgICAgICBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF0gPSBvcmFjbGl6ZV9yYW5kb21EU19wcm9vZlZlcmlmeV9fc2Vzc2lvbktleVZhbGlkaXR5KHByb29mLCBzaWcyb2Zmc2V0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvcmFjbGl6ZV9yYW5kb21EU19zZXNzaW9uS2V5c0hhc2hWZXJpZmllZFtzZXNzaW9uUHVia2V5SGFzaF07CiAgICB9CgoKICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gaGFzIGJlZW4gd3JpdHRlbiBieSBBbGV4IEJlcmVnc3phc3ppIChAYXhpYyksIHVzZSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlCiAgICBmdW5jdGlvbiBjb3B5Qnl0ZXMoYnl0ZXMgZnJvbSwgdWludCBmcm9tT2Zmc2V0LCB1aW50IGxlbmd0aCwgYnl0ZXMgdG8sIHVpbnQgdG9PZmZzZXQpIGludGVybmFsIHJldHVybnMgKGJ5dGVzKSB7CiAgICAgICAgdWludCBtaW5MZW5ndGggPSBsZW5ndGggKyB0b09mZnNldDsKCiAgICAgICAgaWYgKHRvLmxlbmd0aCA8IG1pbkxlbmd0aCkgewogICAgICAgICAgICAvLyBCdWZmZXIgdG9vIHNtYWxsCiAgICAgICAgICAgIHRocm93OyAvLyBTaG91bGQgYmUgYSBiZXR0ZXIgd2F5PwogICAgICAgIH0KCiAgICAgICAgLy8gTk9URTogdGhlIG9mZnNldCAzMiBpcyBhZGRlZCB0byBza2lwIHRoZSBgc2l6ZWAgZmllbGQgb2YgYm90aCBieXRlcyB2YXJpYWJsZXMKICAgICAgICB1aW50IGkgPSAzMiArIGZyb21PZmZzZXQ7CiAgICAgICAgdWludCBqID0gMzIgKyB0b09mZnNldDsKCiAgICAgICAgd2hpbGUgKGkgPCAoMzIgKyBmcm9tT2Zmc2V0ICsgbGVuZ3RoKSkgewogICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICBsZXQgdG1wIDo9IG1sb2FkKGFkZChmcm9tLCBpKSkKICAgICAgICAgICAgICAgIG1zdG9yZShhZGQodG8sIGopLCB0bXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSArPSAzMjsKICAgICAgICAgICAgaiArPSAzMjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0bzsKICAgIH0KCiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGhhcyBiZWVuIHdyaXR0ZW4gYnkgQWxleCBCZXJlZ3N6YXN6aSAoQGF4aWMpLCB1c2UgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZQogICAgLy8gRHVwbGljYXRlIFNvbGlkaXR5J3MgZWNyZWNvdmVyLCBidXQgY2F0Y2hpbmcgdGhlIENBTEwgcmV0dXJuIHZhbHVlCiAgICBmdW5jdGlvbiBzYWZlcl9lY3JlY292ZXIoYnl0ZXMzMiBoYXNoLCB1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCwgYWRkcmVzcykgewogICAgICAgIC8vIFdlIGRvIG91ciBvd24gbWVtb3J5IG1hbmFnZW1lbnQgaGVyZS4gU29saWRpdHkgdXNlcyBtZW1vcnkgb2Zmc2V0CiAgICAgICAgLy8gMHg0MCB0byBzdG9yZSB0aGUgY3VycmVudCBlbmQgb2YgbWVtb3J5LiBXZSB3cml0ZSBwYXN0IGl0IChhcwogICAgICAgIC8vIHdyaXRlcyBhcmUgbWVtb3J5IGV4dGVuc2lvbnMpLCBidXQgZG9uJ3QgdXBkYXRlIHRoZSBvZmZzZXQgc28KICAgICAgICAvLyBTb2xpZGl0eSB3aWxsIHJldXNlIGl0LiBUaGUgbWVtb3J5IHVzZWQgaGVyZSBpcyBvbmx5IG5lZWRlZCBmb3IKICAgICAgICAvLyB0aGlzIGNvbnRleHQuCgogICAgICAgIC8vIEZJWE1FOiBpbmxpbmUgYXNzZW1ibHkgY2FuJ3QgYWNjZXNzIHJldHVybiB2YWx1ZXMKICAgICAgICBib29sIHJldDsKICAgICAgICBhZGRyZXNzIGFkZHI7CgogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IHNpemUgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKHNpemUsIGhhc2gpCiAgICAgICAgICAgIG1zdG9yZShhZGQoc2l6ZSwgMzIpLCB2KQogICAgICAgICAgICBtc3RvcmUoYWRkKHNpemUsIDY0KSwgcikKICAgICAgICAgICAgbXN0b3JlKGFkZChzaXplLCA5NiksIHMpCgogICAgICAgICAgICAvLyBOT1RFOiB3ZSBjYW4gcmV1c2UgdGhlIHJlcXVlc3QgbWVtb3J5IGJlY2F1c2Ugd2UgZGVhbCB3aXRoCiAgICAgICAgICAgIC8vICAgICAgIHRoZSByZXR1cm4gY29kZQogICAgICAgICAgICByZXQgOj0gY2FsbCgzMDAwLCAxLCAwLCBzaXplLCAxMjgsIHNpemUsIDMyKQogICAgICAgICAgICBhZGRyIDo9IG1sb2FkKHNpemUpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKHJldCwgYWRkcik7CiAgICB9CgogICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbiBoYXMgYmVlbiB3cml0dGVuIGJ5IEFsZXggQmVyZWdzemFzemkgKEBheGljKSwgdXNlIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UKICAgIGZ1bmN0aW9uIGVjcmVjb3ZlcnkoYnl0ZXMzMiBoYXNoLCBieXRlcyBzaWcpIGludGVybmFsIHJldHVybnMgKGJvb2wsIGFkZHJlc3MpIHsKICAgICAgICBieXRlczMyIHI7CiAgICAgICAgYnl0ZXMzMiBzOwogICAgICAgIHVpbnQ4IHY7CgogICAgICAgIGlmIChzaWcubGVuZ3RoICE9IDY1KQogICAgICAgICAgcmV0dXJuIChmYWxzZSwgMCk7CgogICAgICAgIC8vIFRoZSBzaWduYXR1cmUgZm9ybWF0IGlzIGEgY29tcGFjdCBmb3JtIG9mOgogICAgICAgIC8vICAge2J5dGVzMzIgcn17Ynl0ZXMzMiBzfXt1aW50OCB2fQogICAgICAgIC8vIENvbXBhY3QgbWVhbnMsIHVpbnQ4IGlzIG5vdCBwYWRkZWQgdG8gMzIgYnl0ZXMuCiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCgogICAgICAgICAgICAvLyBIZXJlIHdlIGFyZSBsb2FkaW5nIHRoZSBsYXN0IDMyIGJ5dGVzLiBXZSBleHBsb2l0IHRoZSBmYWN0IHRoYXQKICAgICAgICAgICAgLy8gJ21sb2FkJyB3aWxsIHBhZCB3aXRoIHplcm9lcyBpZiB3ZSBvdmVycmVhZC4KICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gJ21sb2FkOCcgdG8gZG8gdGhpcywgYnV0IHRoYXQgd291bGQgYmUgbmljZXIuCiAgICAgICAgICAgIHYgOj0gYnl0ZSgwLCBtbG9hZChhZGQoc2lnLCA5NikpKQoKICAgICAgICAgICAgLy8gQWx0ZXJuYXRpdmUgc29sdXRpb246CiAgICAgICAgICAgIC8vICdieXRlJyBpcyBub3Qgd29ya2luZyBkdWUgdG8gdGhlIFNvbGlkaXR5IHBhcnNlciwgc28gbGV0cwogICAgICAgICAgICAvLyB1c2UgdGhlIHNlY29uZCBiZXN0IG9wdGlvbiwgJ2FuZCcKICAgICAgICAgICAgLy8gdiA6PSBhbmQobWxvYWQoYWRkKHNpZywgNjUpKSwgMjU1KQogICAgICAgIH0KCiAgICAgICAgLy8gYWxiZWl0IG5vbi10cmFuc2FjdGlvbmFsIHNpZ25hdHVyZXMgYXJlIG5vdCBzcGVjaWZpZWQgYnkgdGhlIFlQLCBvbmUgd291bGQgZXhwZWN0IGl0CiAgICAgICAgLy8gdG8gbWF0Y2ggdGhlIFlQIHJhbmdlIG9mIFsyNywgMjhdCiAgICAgICAgLy8KICAgICAgICAvLyBnZXRoIHVzZXMgWzAsIDFdIGFuZCBzb21lIGNsaWVudHMgaGF2ZSBmb2xsb3dlZC4gVGhpcyBtaWdodCBjaGFuZ2UsIHNlZToKICAgICAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVtL2lzc3Vlcy8yMDUzCiAgICAgICAgaWYgKHYgPCAyNykKICAgICAgICAgIHYgKz0gMjc7CgogICAgICAgIGlmICh2ICE9IDI3ICYmIHYgIT0gMjgpCiAgICAgICAgICAgIHJldHVybiAoZmFsc2UsIDApOwoKICAgICAgICByZXR1cm4gc2FmZXJfZWNyZWNvdmVyKGhhc2gsIHYsIHIsIHMpOwogICAgfQoKfQovLyA8L09SQUNMSVpFX0FQST4KCmNvbnRyYWN0IERlYWRwb29sMlJvdHRlbm9yRnJlc2ggaXMgdXNpbmdPcmFjbGl6ZSB7CgogIC8qIERlY2xhcmF0aW9uICovCgogIGFkZHJlc3MgcHVibGljIE9XTkVSUyA9IDB4QzNlRDJkNDgxQjlkNzU4MzVFQzA0MTc0YjAxOUE3ZUFGMkZhZjc4QTsKCiAgdWludCBwdWJsaWMgY29uc3RhbnQgQ09NTUlTU0lPTiA9IDA7IC8vIENvbW1pc3Npb24gZm9yIHRoZSBvd25lcgogIHVpbnQgcHVibGljIGNvbnN0YW50IE1JTl9CRVQgPSAwLjAxIGV0aGVyOwoKICB1aW50IHB1YmxpYyBFWFBFQ1RFRF9TVEFSVCA9IDE1MjM4MTg4MDA7IC8vIFdoZW4gdGhlIGJldCdzIGV2ZW50IGlzIGV4cGVjdGVkIHRvIHN0YXJ0CiAgdWludCBwdWJsaWMgRVhQRUNURURfRU5EID0gMTUyNzI3NDgwMDsgLy8gV2hlbiB0aGUgYmV0J3MgZXZlbnQgaXMgZXhwZWN0ZWQgdG8gZW5kCgogIHVpbnQgcHVibGljIGNvbnN0YW50IEJFVFRJTkdfT1BFTlMgPSAxNTIyOTkwOTIzOwogIHVpbnQgcHVibGljIEJFVFRJTkdfQ0xPU0VTID0gRVhQRUNURURfU1RBUlQgLSA2MDsgLy8gQmV0dGluZyBjbG9zZXMgYSBtaW51dGUgYmVmb3JlIHRoZSBiZXQgZXZlbnQgc3RhcnRzCgogIHVpbnQgcHVibGljIGNvbnN0YW50IFBJTkdfT1JBQ0xFX0lOVEVSVkFMID0gNjAgKiA2MCAqIDI0OyAvLyBQaW5nIG9yYWNsZSBldmVyeSAyNCBob3VycyB1bnRpbCBjb21wbGV0aW9uIChvciBjYW5jZWxhdGlvbikKICB1aW50IHB1YmxpYyBPUkFDTElaRV9HQVMgPSAyMDAwMDA7CiAgdWludCBwdWJsaWMgQ0FOQ0VMQVRJT05fREFURSA9IEVYUEVDVEVEX0VORCArIDYwICogNjAgKiAyNDsgLy8gQ2FuY2VsYXRpb24gZGF0ZSBpcyAyNCBob3VycyBhZnRlciB0aGUgZXhwZWN0ZWQgZW5kCiAgdWludCBwdWJsaWMgUkVUVVJOX0RBVEUgPSBFWFBFQ1RFRF9FTkQgKyA2MCAqIDYwICogMjQgKiAzMDsgLy8gQW55IGxlZnRvdmVyIG1vbmV5IGlzIHJldHVybmVkIHRvIG93bmVycyAxIG1vbnRoIGFmdGVyIGJldCBlbmRzCgogIGJvb2wgcHVibGljIGNvbXBsZXRlZDsKICBib29sIHB1YmxpYyBjYW5jZWxlZDsKICBib29sIHB1YmxpYyBvd25lcnNQYXllZDsKICB1aW50IHB1YmxpYyBvd25lclBheW91dDsKICBib29sIHB1YmxpYyByZXR1cm5lZFRvT3duZXJzOwogIHVpbnQgcHVibGljIHdpbm5lckRldGVybWluZWREYXRlOwogIHVpbnQgcHVibGljIG51bUNvbGxlY3RlZCA9IDA7CgogIGJ5dGVzMzIgcHVibGljIG5leHRTY2hlZHVsZWRRdWVyeTsKICB1aW50IHB1YmxpYyBvcmFjbGl6ZUZlZXM7CiAgdWludCBwdWJsaWMgY29sbGVjdGlvbkZlZXM7CgogIHN0cnVjdCBCZXR0ZXIgewogICAgdWludCBiZXRBbW91bnQ7CiAgICB1aW50IGJldE9wdGlvbjsKICAgIGJvb2wgd2l0aGRyYXduOwogIH0KICBtYXBwaW5nKGFkZHJlc3MgPT4gQmV0dGVyKSBiZXR0ZXJJbmZvOwoKICBhZGRyZXNzW10gcHVibGljIGJldHRlcnM7CgogIHVpbnRbMl0gcHVibGljIHRvdGFsQW1vdW50c0JldDsKICB1aW50WzJdIHB1YmxpYyBudW1iZXJPZkJldHM7CiAgdWludCBwdWJsaWMgdG90YWxCZXRBbW91bnQ7CgogIHVpbnQgcHVibGljIHdpbm5pbmdPcHRpb24gPSAyOwoKICAvKiBFdmVudHMgKi8KCiAgZXZlbnQgQmV0TWFkZSgpOwoKICAvKiBNb2RpZmllcnMgKi8KCiAgLy8gTW9kaWZpZXIgdG8gb25seSBhbGxvdyB0aGUKICAvLyBkZXRlcm1pbmF0aW9uIG9mIHRoZSB3aW5uZXIKICBtb2RpZmllciBjYW5EZXRlcm1pbmVXaW5uZXIoKSB7CiAgICByZXF1aXJlICh3aW5uaW5nT3B0aW9uID09IDIgJiYgIWNvbXBsZXRlZCAmJiAhY2FuY2VsZWQgJiYgbm93ID4gQkVUVElOR19DTE9TRVMgJiYgbm93ID49IEVYUEVDVEVEX0VORCk7CiAgICBfOwogIH0KCiAgLy8gTW9kaWZpZXIgdG8gb25seSBhbGxvdyBlbXB0eWluZwogIC8vIHRoZSByZW1haW5pbmcgdmFsdWUgb2YgdGhlIGNvbnRyYWN0CiAgLy8gdG8gb3duZXJzLgogIG1vZGlmaWVyIGNhbkVtcHR5UmVtYWluaW5ncygpIHsKICAgIHJlcXVpcmUoY2FuY2VsZWQgfHwgY29tcGxldGVkKTsKICAgIHVpbnQgbnVtUmVxdWlyZWRUb0NvbGxlY3QgPSBjYW5jZWxlZCA/IChudW1iZXJPZkJldHNbMF0gKyBudW1iZXJPZkJldHNbMV0pIDogbnVtYmVyT2ZCZXRzW3dpbm5pbmdPcHRpb25dOwogICAgcmVxdWlyZSAoKG5vdyA+PSBSRVRVUk5fREFURSAmJiAhY2FuY2VsZWQpIHx8IChudW1Db2xsZWN0ZWQgPT0gbnVtUmVxdWlyZWRUb0NvbGxlY3QpKTsKICAgIF87CiAgfQoKICAvLyBNb2RpZmllciB0byBvbmx5IGFsbG93IHRoZSBjb2xsZWN0aW9uCiAgLy8gb2YgYmV0IHBheW91dHMgd2hlbiB3aW5uZXIgaXMgZGV0ZXJtaW5lZCwKICAvLyAob3Igd2l0aGRyYXdhbHMgaWYgdGhlIGJldCBpcyBjYW5jZWxlZCkKICBtb2RpZmllciBjb2xsZWN0aW9uc0VuYWJsZWQoKSB7CiAgICByZXF1aXJlIChjYW5jZWxlZCB8fCAod2lubmluZ09wdGlvbiAhPSAyICYmIGNvbXBsZXRlZCAmJiBub3cgPiBCRVRUSU5HX0NMT1NFUykpOwogICAgXzsKICB9CgogIC8vIE1vZGlmaWVyIHRvIG9ubHkgYWxsb3cgdGhlIGV4ZWN1dGlvbiBvZgogIC8vIG93bmVyIHBheW91dCB3aGVuIHdpbm5lciBpcyBkZXRlcm1pbmVkCiAgbW9kaWZpZXIgY2FuUGF5T3duZXJzKCkgewogICAgcmVxdWlyZSAoIWNhbmNlbGVkICYmIHdpbm5pbmdPcHRpb24gIT0gMiAmJiBjb21wbGV0ZWQgJiYgIW93bmVyc1BheWVkICYmIG5vdyA+IEJFVFRJTkdfQ0xPU0VTKTsKICAgIF87CiAgfQoKICAvLyBNb2RpZmllciB0byBvbmx5IGFsbG93IHRoZSBleGVjdXRpb24gb2YKICAvLyBjZXJ0YWluIGZ1bmN0aW9ucyB3aGVuIGJldHRpbmcgaXMgY2xvc2VkCiAgbW9kaWZpZXIgYmV0dGluZ0lzQ2xvc2VkKCkgewogICAgcmVxdWlyZSAobm93ID49IEJFVFRJTkdfQ0xPU0VTKTsKICAgIF87CiAgfQoKICAvLyBNb2RpZmllciB0byBvbmx5IGFsbG93IHRoZSBleGVjdXRpb24gb2YKICAvLyBjZXJ0YWluIGZ1bmN0aW9ucyByZXN0cmljdGVkIHRvIHRoZSBvd25lcnMKICBtb2RpZmllciBvbmx5T3duZXJMZXZlbCgpIHsKICAgIHJlcXVpcmUoCiAgICAgIE9XTkVSUyA9PSBtc2cuc2VuZGVyCiAgICApOwogICAgXzsKICB9CgogIC8qIEZ1bmN0aW9ucyAqLwogIAogIC8vIENvbnN0cnVjdG9yCiAgZnVuY3Rpb24gRGVhZHBvb2wyUm90dGVub3JGcmVzaCgpIHB1YmxpYyBwYXlhYmxlIHsKICAgIG9yYWNsaXplX3NldEN1c3RvbUdhc1ByaWNlKDEwMDAwMDAwMDApOwogICAgY2FsbE9yYWNsZShFWFBFQ1RFRF9FTkQsIE9SQUNMSVpFX0dBUyk7IC8vIEtpY2tvZmYgT3JhY2xlIGNoZWNraW5nIGZvciBvdXRjb21lCiAgfQoKICBmdW5jdGlvbiBjaGFuZ2VHYXNMaW1pdEFuZFByaWNlKHVpbnQgZ2FzLCB1aW50IHByaWNlKSBwdWJsaWMgb25seU93bmVyTGV2ZWwgewogICAgT1JBQ0xJWkVfR0FTID0gZ2FzOwogICAgb3JhY2xpemVfc2V0Q3VzdG9tR2FzUHJpY2UocHJpY2UpOwogIH0KCiAgLy8gQ2hhbmdlIGJldCBleHBlY3RlZCB0aW1lcwogIGZ1bmN0aW9uIHNldEV4cGVjdGVkVGltZXModWludCBfRVhQRUNURURfU1RBUlQsIHVpbnQgX0VYUEVDVEVEX0VORCkgcHVibGljIG9ubHlPd25lckxldmVsIHsKICAgIHNldEV4cGVjdGVkU3RhcnQoX0VYUEVDVEVEX1NUQVJUKTsKICAgIHNldEV4cGVjdGVkRW5kKF9FWFBFQ1RFRF9FTkQpOwogIH0KCiAgLy8gQ2hhbmdlIGJldCBleHBlY3RlZCBzdGFydCB0aW1lCiAgZnVuY3Rpb24gc2V0RXhwZWN0ZWRTdGFydCh1aW50IF9FWFBFQ1RFRF9TVEFSVCkgcHVibGljIG9ubHlPd25lckxldmVsIHsKICAgIEVYUEVDVEVEX1NUQVJUID0gX0VYUEVDVEVEX1NUQVJUOwogICAgQkVUVElOR19DTE9TRVMgPSBFWFBFQ1RFRF9TVEFSVCAtIDYwOwogIH0KCiAgLy8gQ2hhbmdlIGJldCBleHBlY3RlZCBlbmQgdGltZQogIGZ1bmN0aW9uIHNldEV4cGVjdGVkRW5kKHVpbnQgX0VYUEVDVEVEX0VORCkgcGF5YWJsZSBwdWJsaWMgb25seU93bmVyTGV2ZWwgewogICAgcmVxdWlyZShfRVhQRUNURURfRU5EID4gRVhQRUNURURfU1RBUlQpOwoKICAgIEVYUEVDVEVEX0VORCA9IF9FWFBFQ1RFRF9FTkQ7CiAgICBDQU5DRUxBVElPTl9EQVRFID0gRVhQRUNURURfRU5EICsgNjAgKiA2MCAqIDI0OwogICAgUkVUVVJOX0RBVEUgPSBFWFBFQ1RFRF9FTkQgKyA2MCAqIDYwICogMjQgKiAzMDsKCiAgICBjYWxsT3JhY2xlKEVYUEVDVEVEX0VORCwgT1JBQ0xJWkVfR0FTKTsgLy8gS2lja29mZiBPcmFjbGUgY2hlY2tpbmcgZm9yIHdpbm5lcgogIH0KCiAgZnVuY3Rpb24gY2FsbE9yYWNsZSh1aW50IHRpbWVPckRlbGF5LCB1aW50IGdhcykgcHJpdmF0ZSB7CiAgICByZXF1aXJlKGNhbmNlbGVkICE9IHRydWUgJiYgY29tcGxldGVkICE9IHRydWUpOwoKICAgIC8vIE1ha2UgYSBjYWxsIHRvIHRoZSBvcmFjbGUg4oCUCiAgICAvLyB1c3VhbGx5IGEgc2NyaXB0IGhvc3RlZCBvbiBJUEZTIHRoYXQKICAgIC8vIE9yYWNsaXplIGRlcGxveXMsIGFmdGVyIGEgZ2l2ZW4gZGVsYXkuIFdlCiAgICAvLyBsZWF2ZSBuZXN0ZWQgcXVlcnkgYXMgZGVmYXVsdCB0byBtYXhpbWl6ZQogICAgLy8gb3B0aW9uYWxpdHkgZm9yIHF1ZXJpZXMuCgogICAgLy8gVG8gcmVhZGVycyBvZiB0aGUgY29kZSAoYWthIHByb3NwZWN0aXZlIGJldHRlcnMpCiAgICAvLyBpZiB0aGlzIGlzIGEgY29tcHV0YXRpb24gcXVlcnksIHlvdSBjYW4gdmlldyB0aGUKICAgIC8vIHNjcmlwdCB3ZSB1c2UgdG8gY29tcHV0ZSB0aGUgd2lubmVyLCBhcyBpdCBpcyBob3N0ZWQKICAgIC8vIG9uIElQRlMuIFRoZSBmaXJzdCBhcmd1bWVudCBpbiB0aGUgY29tcHV0YXRpb24gcXVlcnkKICAgIC8vIGlzIHRoZSBJUEZTIGhhc2ggKHNjcmlwdCB3b3VsZCBiZSBsb2NhdGVkIGF0CiAgICAvLyBpcGZzLmlvL2lwZnMvPEhBU0g+KS4gVGhlIGZpbGUgaG9zdGVkIGF0IHRoaXMgaGFzaAogICAgLy8gaXMgYWN0dWFsbHkgYSB6aXBwZWQgZm9sZGVyIHRoYXQgY29udGFpbnMgYSBEb2NrZXJmaWxlIGFuZAogICAgLy8gdGhlIHNjcmlwdC4gU28sIGlmIHlvdSBkb3dubG9hZCB0aGUgZmlsZSBhdCB0aGUgaGFzaCBwcm92aWRlZCwKICAgIC8vIGVuc3VyZSB0byBjb252ZXJ0IGl0IHRvIGEgLnppcCwgdW56aXAgaXQsIGFuZCByZWFkIHRoZSBjb2RlLgoKICAgIC8vIE9yYWNsaXplIHVzZXMgdGhlIERvY2tlcmZpbGUgdG8gZGVwbG95IHRoaXMgc2NyaXB0LgogICAgLy8gTG9vayBvdmVyIHRoZSBPcmFjbGl6ZSBkb2N1bWVudGF0aW9uIHRvIHZlcmlmeSB0aGlzCiAgICAvLyBmb3IgeW91cnNlbGYuCiAgICBuZXh0U2NoZWR1bGVkUXVlcnkgPSBtYWtlT3JhY2xpemVRdWVyeSh0aW1lT3JEZWxheSwgIm5lc3RlZCIsICJbY29tcHV0YXRpb25dIFsnUW1WcVNqTlk2NFZmcG5FM3NaWlo3cnYxdVVwWlJXOUQ4QlhzYmlObndTR2dtTicsICdkZWFkcG9vbF8yJ10iLCBnYXMpOwogIH0KCiAgZnVuY3Rpb24gbWFrZU9yYWNsaXplUXVlcnkodWludCB0aW1lT3JEZWxheSwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBxdWVyeSwgdWludCBnYXMpIHByaXZhdGUgcmV0dXJucyhieXRlczMyKSB7CiAgICBvcmFjbGl6ZUZlZXMgKz0gb3JhY2xpemVfZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzKTsKICAgIHJldHVybiBvcmFjbGl6ZV9xdWVyeSh0aW1lT3JEZWxheSwgZGF0YXNvdXJjZSwgcXVlcnksIGdhcyk7CiAgfQoKICAvLyBEZXRlcm1pbmUgdGhlIG91dGNvbWUgbWFudWFsbHksCiAgLy8gaW1tZWRpYXRlbHkKICBmdW5jdGlvbiBkZXRlcm1pbmVXaW5uZXIodWludCBnYXMsIHVpbnQgZ2FzUHJpY2UpIHBheWFibGUgcHVibGljIG9ubHlPd25lckxldmVsIGNhbkRldGVybWluZVdpbm5lciB7CiAgICBPUkFDTElaRV9HQVMgPSBnYXM7CiAgICBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZShnYXNQcmljZSk7CgogICAgY2FsbE9yYWNsZSgwLCBPUkFDTElaRV9HQVMpOwogIH0KCiAgLy8gQ2FsbGJhY2sgZnJvbSBPcmFjbGl6ZQogIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBxdWVyeUlkLCBzdHJpbmcgcmVzdWx0LCBieXRlcyBwcm9vZikgcHVibGljIGNhbkRldGVybWluZVdpbm5lciB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3JhY2xpemVfY2JBZGRyZXNzKCkpOwoKICAgIC8vIFRoZSBPcmFjbGUgbXVzdCBhbHdheXMgcmV0dXJuCiAgICAvLyBhbiBpbnRlZ2VyIChlaXRoZXIgMCBvciAxLCBvciBpZiBub3QgdGhlbikKICAgIC8vIGl0IHNob3VsZCBiZSAyCiAgICBpZiAoa2VjY2FrMjU2KHJlc3VsdCkgIT0ga2VjY2FrMjU2KCIwIikgJiYga2VjY2FrMjU2KHJlc3VsdCkgIT0ga2VjY2FrMjU2KCIxIikpIHsKICAgICAgLy8gUmVzY2hlZHVsZSB3aW5uZXIgZGV0ZXJtaW5hdGlvbiwKICAgICAgLy8gdW5sZXNzIHdlJ3JlIHBhc3QgdGhlIHBvaW50IG9mCiAgICAgIC8vIGNhbmNlbGF0aW9uLiBJZiBuZXh0U2NoZWR1bGVkUXVlcnkgaXMKICAgICAgLy8gbm90IHRoZSBjdXJyZW50IHF1ZXJ5LCBpdCBtZWFucyB0aGF0CiAgICAgIC8vIHRoZXJlJ3MgYSBzY2hlZHVsZWQgZnV0dXJlIHF1ZXJ5LCBzbwogICAgICAvLyB3ZSBjYW4gd2FpdCBmb3IgdGhhdCBpbnN0ZWFkIG9mIHNjaGVkdWxpbmcKICAgICAgLy8gYW5vdGhlciBvbmUgbm93IChvdGhlcndpc2UgdGhpcyB3b3VsZCBjYXVzZQogICAgICAvLyBkdXBlIHF1ZXJpZXMpLgoKICAgICAgaWYgKG5vdyA+PSBDQU5DRUxBVElPTl9EQVRFKSB7CiAgICAgICAgY2FuY2VsKCk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAobmV4dFNjaGVkdWxlZFF1ZXJ5ID09IHF1ZXJ5SWQpIHsKICAgICAgICBjYWxsT3JhY2xlKFBJTkdfT1JBQ0xFX0lOVEVSVkFMLCBPUkFDTElaRV9HQVMpOwogICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgc2V0V2lubmVyKHBhcnNlSW50KHJlc3VsdCkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0V2lubmVyKHVpbnQgd2lubmVyKSBwcml2YXRlIHsKICAgIGNvbXBsZXRlZCA9IHRydWU7CiAgICBjYW5jZWxlZCA9IGZhbHNlOwogICAgd2lubmluZ09wdGlvbiA9IHdpbm5lcjsKICAgIHdpbm5lckRldGVybWluZWREYXRlID0gbm93OwoKICAgIHBheU93bmVycygpOwogIH0KCiAgLy8gUmV0dXJucyB0aGUgdG90YWwgYW1vdW50cyBiZXR0ZWQKICAvLyBmb3IgdGhlIHNlbmRlcgogIGZ1bmN0aW9uIGdldFVzZXJCZXQoYWRkcmVzcyBhZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50W10pIHsKICAgIHVpbnRbXSBtZW1vcnkgYmV0cyA9IG5ldyB1aW50W10oMik7CiAgICBiZXRzW2JldHRlckluZm9bYWRkcl0uYmV0T3B0aW9uXSA9IGJldHRlckluZm9bYWRkcl0uYmV0QW1vdW50OwoKICAgIHJldHVybiBiZXRzOwogIH0KCiAgLy8gUmV0dXJucyB3aGV0aGVyIGEgdXNlciBoYXMgd2l0aGRyYXduCiAgLy8gbW9uZXkgb3Igbm90LgogIGZ1bmN0aW9uIHVzZXJIYXNXaXRoZHJhd24oYWRkcmVzcyBhZGRyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gYmV0dGVySW5mb1thZGRyXS53aXRoZHJhd247CiAgfQoKICAvLyBSZXR1cm5zIHdoZXRoZXIgd2lubmluZyBjb2xsZWN0aW9ucyBhcmUKICAvLyBub3cgYXZhaWxhYmxlLCBvciBub3QuCiAgZnVuY3Rpb24gY29sbGVjdGlvbnNBdmFpbGFibGUoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyhib29sKSB7CiAgICByZXR1cm4gKGNvbXBsZXRlZCAmJiB3aW5uaW5nT3B0aW9uICE9IDIgJiYgbm93ID49ICh3aW5uZXJEZXRlcm1pbmVkRGF0ZSArIDYwMCkpOyAvLyBBdCBsZWFzdCAxMCBtaW5zIGhhcyB0byBwYXNzIGJldHdlZW4gZGV0ZXJtaW5pbmcgd2lubmVyIGFuZCBlbmFibGluZyBwYXlvdXQsIHNvIHRoYXQgd2UgaGF2ZSB0aW1lIHRvIHJldmVydCB0aGUgYmV0IGluIGNhc2Ugd2UgZGV0ZWN0IHN1c3BpY2lvdXMgYmV0dGluZyBhY3RpdnR5IChlZy4gYSBoYWNrZXIgYmV0cyBhIGxvdCB0byBzdGVhbCB0aGUgZW50aXJlIGxvc2luZyBwb3QsIGFuZCBoYWNrcyB0aGUgb3JhY2xlKQogIH0KICAKICAvLyBSZXR1cm5zIHRydWUgaWYgd2UgY2FuIGJldCAoaW4gYmV0dGluZyB3aW5kb3cpCiAgZnVuY3Rpb24gY2FuQmV0KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMoYm9vbCkgewogICAgcmV0dXJuIChub3cgPj0gQkVUVElOR19PUEVOUyAmJiBub3cgPCBCRVRUSU5HX0NMT1NFUyAmJiAhY2FuY2VsZWQgJiYgIWNvbXBsZXRlZCk7CiAgfQoKICAvLyBGdW5jdGlvbiBmb3IgdXNlciB0byBiZXQgb24gbGF1bmNoCiAgLy8gb3V0Y29tZQogIGZ1bmN0aW9uIGJldCh1aW50IG9wdGlvbikgcHVibGljIHBheWFibGUgewogICAgcmVxdWlyZShjYW5CZXQoKSA9PSB0cnVlKTsKICAgIHJlcXVpcmUobXNnLnZhbHVlID49IE1JTl9CRVQpOwogICAgcmVxdWlyZShiZXR0ZXJJbmZvW21zZy5zZW5kZXJdLmJldEFtb3VudCA9PSAwIHx8IGJldHRlckluZm9bbXNnLnNlbmRlcl0uYmV0T3B0aW9uID09IG9wdGlvbik7CgogICAgLy8gQWRkIGJldHRlciB0byBiZXR0ZXIgbGlzdCBpZiB0aGV5CiAgICAvLyBhcmVuJ3QgYWxyZWFkeSBpbiBpdAogICAgaWYgKGJldHRlckluZm9bbXNnLnNlbmRlcl0uYmV0QW1vdW50ID09IDApIHsKICAgICAgYmV0dGVySW5mb1ttc2cuc2VuZGVyXS5iZXRPcHRpb24gPSBvcHRpb247CiAgICAgIG51bWJlck9mQmV0c1tvcHRpb25dKys7CgogICAgICBiZXR0ZXJzLnB1c2gobXNnLnNlbmRlcik7CiAgICB9CgogICAgLy8gUGVyZm9ybSBiZXQKICAgIGJldHRlckluZm9bbXNnLnNlbmRlcl0uYmV0QW1vdW50ICs9IG1zZy52YWx1ZTsKICAgIHRvdGFsQmV0QW1vdW50ICs9IG1zZy52YWx1ZTsKICAgIHRvdGFsQW1vdW50c0JldFtvcHRpb25dICs9IG1zZy52YWx1ZTsKCiAgICBCZXRNYWRlKCk7IC8vIFRyaWdnZXIgZXZlbnQKICB9CgogIC8vIEVtcHR5IHJlbWFpbmRlciBvZiB0aGUgdmFsdWUgaW4gdGhlCiAgLy8gY29udHJhY3QgdG8gdGhlIG93bmVycy4KICBmdW5jdGlvbiBlbXB0eVJlbWFpbmluZ3NUb093bmVycygpIHByaXZhdGUgY2FuRW1wdHlSZW1haW5pbmdzIHsKICAgIE9XTkVSUy50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgcmV0dXJuZWRUb093bmVycyA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiByZXR1cm5Ub093bmVycygpIHB1YmxpYyBvbmx5T3duZXJMZXZlbCBjYW5FbXB0eVJlbWFpbmluZ3MgewogICAgZW1wdHlSZW1haW5pbmdzVG9Pd25lcnMoKTsKICB9CgogIC8vIFBlcmZvcm1zIHBheW91dCB0byBvd25lcnMKICBmdW5jdGlvbiBwYXlPd25lcnMoKSBwcml2YXRlIGNhblBheU93bmVycyB7CiAgICBpZiAoQ09NTUlTU0lPTiA9PSAwKSB7CiAgICAgIG93bmVyc1BheWVkID0gdHJ1ZTsKICAgICAgb3duZXJQYXlvdXQgPSAwOwogICAgICBjb2xsZWN0aW9uRmVlcyA9ICgob3JhY2xpemVGZWVzICE9IDApID8gKG9yYWNsaXplRmVlcyAvIG51bWJlck9mQmV0c1t3aW5uaW5nT3B0aW9uXSArIDEpIDogMCk7IC8vIFdlIGFkZCAxIHdlaSB0byBhY3QgYXMgYSBjZWlsIGZvciB0aGUgaW50ZWdlciBkaXYgLS0gaW1wb3J0YW50IGJlY2F1c2UgdGhlIGNvbnRyYWN0IGNhbm5vdCBhZmZvcmQgdG8gbG9zZSB0aGF0IHNwYXJlIGNoYW5nZSwgYXMgaXQgd2lsbCBnYXVyYW50ZWUgdGhhdCB0aGUgZmluYWwgcGF5b3V0IGNvbGxlY3Rpb24gd2lsbCBmYWlsLgoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBwb29sIG9mIEVUSAogICAgLy8gYmV0dGVkIGZvciB0aGUgdHdvIG91dGNvbWVzLiAgICAKICAgIHVpbnQgbG9zaW5nQ2h1bmsgPSB0b3RhbEFtb3VudHNCZXRbMSAtIHdpbm5pbmdPcHRpb25dOwogICAgb3duZXJQYXlvdXQgPSAobG9zaW5nQ2h1bmsgLSBvcmFjbGl6ZUZlZXMpIC8gQ09NTUlTU0lPTjsgLy8gUGF5b3V0IHRvIHRoZSBvd25lcjsgY29tbWlzc2lvbiBvZiBsb3NpbmcgcG90LCBtaW51cyB0aGUgc2FtZSAlIG9mIHRoZSBmZWVzCgogICAgY29sbGVjdGlvbkZlZXMgPSAoKG9yYWNsaXplRmVlcyAhPSAwKSA/ICgob3JhY2xpemVGZWVzIC0gb3JhY2xpemVGZWVzIC8gQ09NTUlTU0lPTikgLyBudW1iZXJPZkJldHNbd2lubmluZ09wdGlvbl0gKyAxKSA6IDApOyAvLyBUaGUgZmVlcyB0byBiZSBkaXN0cmlidXRlZCB0byB0aGUgY29sbGVjdG9ycywgYWZ0ZXIgb3duZXIgcGF5b3V0LiBTZWUgcmVhc29uaW5nIGFib3ZlIGZvciBhZGRpbmcgdGhlIDEgd2VpLgoKICAgIC8vIEVxdWFsIHdlaWdodCBwYXlvdXQgdG8gdGhlIG93bmVycwogICAgT1dORVJTLnRyYW5zZmVyKG93bmVyUGF5b3V0KTsKICAgIG93bmVyc1BheWVkID0gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIGNhbmNlbEJldCgpIHBheWFibGUgcHVibGljIG9ubHlPd25lckxldmVsIHsKICAgIGNhbmNlbCgpOwogIH0KCiAgLy8gQ2FuY2VsIGJldCBhbmQgcmVsYXNlIGFsbCB0aGUgYmV0cyBiYWNrIHRvCiAgLy8gdGhlIGJldHRlcnMgaWYsIGZvciBhbnkgcmVhc29uLCBwYXlvdXRzIGNhbm5vdCBiZQogIC8vIGNvbXBsZXRlZC4gKEZvciBleGFtcGxlIE9yYWNsZSBmYWlscy4pIFRyaWdnZXJlZCBieSBvd25lcnMuCiAgZnVuY3Rpb24gY2FuY2VsKCkgcHJpdmF0ZSB7CiAgICBjYW5jZWxlZCA9IHRydWU7CiAgICBjb21wbGV0ZWQgPSBmYWxzZTsKICB9CgogIC8vIEZhbGxiYWNrIGZ1bmN0aW9uIGluIGNhc2Ugc29tZW9uZSBzZW5kcwogIC8vIGV0aGVyIHRvIHRoZSBjb250cmFjdCBzbyBpdCBkb2Vzbid0IGdldAogIC8vIGxvc3QuIENvdWxkIGJlIHVzZWQgYnkgdXMgb3duZXJzIGFzIGJ1ZmZlcgogIC8vIHZhbHVlIGluIGNhc2UgcGF5b3V0cyBmYWlsLgogIGZ1bmN0aW9uKCkgcGF5YWJsZSBwdWJsaWMgewogIH0KCiAgLy8gRnVuY3Rpb24gdGhhdCBsZXRzIGJldHRlcnMgY29sbGVjdCB0aGVpcgogIC8vIG1vbmV5LCBlaXRoZXIgaWYgdGhlIGJldCB3YXMgY2FuY2VsZWQsCiAgLy8gb3IgaWYgdGhleSB3b24uCiAgZnVuY3Rpb24gY29sbGVjdCgpIHB1YmxpYyBjb2xsZWN0aW9uc0VuYWJsZWQgewogICAgYWRkcmVzcyBiZXR0ZXIgPSBtc2cuc2VuZGVyOwoKICAgIHJlcXVpcmUoYmV0dGVySW5mb1tiZXR0ZXJdLmJldEFtb3VudCA+IDApOwogICAgcmVxdWlyZSghYmV0dGVySW5mb1tiZXR0ZXJdLndpdGhkcmF3bik7CiAgICByZXF1aXJlKGNhbmNlbGVkICE9IGNvbXBsZXRlZCk7CiAgICByZXF1aXJlKGNhbmNlbGVkIHx8IChjb21wbGV0ZWQgJiYgYmV0dGVySW5mb1tiZXR0ZXJdLmJldE9wdGlvbiA9PSB3aW5uaW5nT3B0aW9uKSk7CiAgICByZXF1aXJlKG5vdyA+PSAod2lubmVyRGV0ZXJtaW5lZERhdGUgKyA2MDApKTsKCiAgICB1aW50IHBheW91dCA9IDA7CiAgICBpZiAoIWNhbmNlbGVkKSB7CiAgICAgIC8vIE9uIHRvcCBvZiB0aGVpciBvcmlnaW5hbCBiZXQsCiAgICAgIC8vIGFkZCBpbiBwcm9maXQsIHdoaWNoIGlzIGEgd2VpZ2h0ZWQKICAgICAgLy8gcHJvcG9ydGlvbiBvZiB0aGUgbG9zaW5nIHBvdCwgcmVsYXRpdmUKICAgICAgLy8gdG8gdGhlaXIgY29udHJpYnV0aW9uIHRvIHRoZSB3aW5uaW5nIHBvdCwKICAgICAgLy8gbWludXMgb3duZXIgY29tbWlzc2lvbi4KICAgICAgdWludCBsb3NpbmdDaHVuayA9IHRvdGFsQW1vdW50c0JldFsxIC0gd2lubmluZ09wdGlvbl07CiAgICAgIHBheW91dCA9IGJldHRlckluZm9bYmV0dGVyXS5iZXRBbW91bnQgKyAoYmV0dGVySW5mb1tiZXR0ZXJdLmJldEFtb3VudCAqIChsb3NpbmdDaHVuayAtIG93bmVyUGF5b3V0KSAvIHRvdGFsQW1vdW50c0JldFt3aW5uaW5nT3B0aW9uXSkgLSBjb2xsZWN0aW9uRmVlczsKICAgIH0KICAgIGVsc2UgewogICAgICBwYXlvdXQgPSBiZXR0ZXJJbmZvW2JldHRlcl0uYmV0QW1vdW50OwogICAgfQoKICAgIGlmIChwYXlvdXQgPiAwKSB7CiAgICAgIGJldHRlci50cmFuc2ZlcihwYXlvdXQpOwogICAgICBiZXR0ZXJJbmZvW2JldHRlcl0ud2l0aGRyYXduID0gdHJ1ZTsKCiAgICAgIG51bUNvbGxlY3RlZCsrOwogICAgfQogIH0KCn0='.
	

]
