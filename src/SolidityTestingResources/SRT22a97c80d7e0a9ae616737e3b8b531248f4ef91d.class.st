Class {
	#name : #SRT22a97c80d7e0a9ae616737e3b8b531248f4ef91d,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT22a97c80d7e0a9ae616737e3b8b531248f4ef91d >> base64 [
	^ 'Y29udHJhY3QgUmVlbnRyYW5jeUd1YXJkIHsKCiAgLyoqCiAgICogQGRldiBXZSB1c2UgYSBzaW5nbGUgbG9jayBmb3IgdGhlIHdob2xlIGNvbnRyYWN0LgogICAqLwogIGJvb2wgcHJpdmF0ZSByZW50cmFuY3lfbG9jayA9IGZhbHNlOwoKICAvKioKICAgKiBAZGV2IFByZXZlbnRzIGEgY29udHJhY3QgZnJvbSBjYWxsaW5nIGl0c2VsZiwgZGlyZWN0bHkgb3IgaW5kaXJlY3RseS4KICAgKiBAbm90aWNlIElmIHlvdSBtYXJrIGEgZnVuY3Rpb24gYG5vblJlZW50cmFudGAsIHlvdSBzaG91bGQgYWxzbwogICAqIG1hcmsgaXQgYGV4dGVybmFsYC4gQ2FsbGluZyBvbmUgbm9uUmVlbnRyYW50IGZ1bmN0aW9uIGZyb20KICAgKiBhbm90aGVyIGlzIG5vdCBzdXBwb3J0ZWQuIEluc3RlYWQsIHlvdSBjYW4gaW1wbGVtZW50IGEKICAgKiBgcHJpdmF0ZWAgZnVuY3Rpb24gZG9pbmcgdGhlIGFjdHVhbCB3b3JrLCBhbmQgYSBgZXh0ZXJuYWxgCiAgICogd3JhcHBlciBtYXJrZWQgYXMgYG5vblJlZW50cmFudGAuCiAgICovCiAgbW9kaWZpZXIgbm9uUmVlbnRyYW50KCkgewogICAgcmVxdWlyZSghcmVudHJhbmN5X2xvY2spOwogICAgcmVudHJhbmN5X2xvY2sgPSB0cnVlOwogICAgXzsKICAgIHJlbnRyYW5jeV9sb2NrID0gZmFsc2U7CiAgfQoKfQoKbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9Cgpjb250cmFjdCBDbGFpbWFibGUgaXMgT3duYWJsZSB7CiAgYWRkcmVzcyBwdWJsaWMgcGVuZGluZ093bmVyOwoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgcGVuZGluZ093bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlQZW5kaW5nT3duZXIoKSB7CiAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gcGVuZGluZ093bmVyKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEFsbG93cyB0aGUgY3VycmVudCBvd25lciB0byBzZXQgdGhlIHBlbmRpbmdPd25lciBhZGRyZXNzLgogICAqIEBwYXJhbSBuZXdPd25lciBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciBvd25lcnNoaXAgdG8uCiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgb25seU93bmVyIHB1YmxpYyB7CiAgICBwZW5kaW5nT3duZXIgPSBuZXdPd25lcjsKICB9CgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBwZW5kaW5nT3duZXIgYWRkcmVzcyB0byBmaW5hbGl6ZSB0aGUgdHJhbnNmZXIuCiAgICovCiAgZnVuY3Rpb24gY2xhaW1Pd25lcnNoaXAoKSBvbmx5UGVuZGluZ093bmVyIHB1YmxpYyB7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgcGVuZGluZ093bmVyKTsKICAgIG93bmVyID0gcGVuZGluZ093bmVyOwogICAgcGVuZGluZ093bmVyID0gMHgwOwogIH0KfQoKY29udHJhY3QgSGFzTm9Db250cmFjdHMgaXMgT3duYWJsZSB7CgogIC8qKgogICAqIEBkZXYgUmVjbGFpbSBvd25lcnNoaXAgb2YgT3duYWJsZSBjb250cmFjdHMKICAgKiBAcGFyYW0gY29udHJhY3RBZGRyIFRoZSBhZGRyZXNzIG9mIHRoZSBPd25hYmxlIHRvIGJlIHJlY2xhaW1lZC4KICAgKi8KICBmdW5jdGlvbiByZWNsYWltQ29udHJhY3QoYWRkcmVzcyBjb250cmFjdEFkZHIpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICBPd25hYmxlIGNvbnRyYWN0SW5zdCA9IE93bmFibGUoY29udHJhY3RBZGRyKTsKICAgIGNvbnRyYWN0SW5zdC50cmFuc2Zlck93bmVyc2hpcChvd25lcik7CiAgfQp9Cgpjb250cmFjdCBIYXNOb0V0aGVyIGlzIE93bmFibGUgewoKICAvKioKICAqIEBkZXYgQ29uc3RydWN0b3IgdGhhdCByZWplY3RzIGluY29taW5nIEV0aGVyCiAgKiBAZGV2IFRoZSBgcGF5YWJsZWAgZmxhZyBpcyBhZGRlZCBzbyB3ZSBjYW4gYWNjZXNzIGBtc2cudmFsdWVgIHdpdGhvdXQgY29tcGlsZXIgd2FybmluZy4gSWYgd2UKICAqIGxlYXZlIG91dCBwYXlhYmxlLCB0aGVuIFNvbGlkaXR5IHdpbGwgYWxsb3cgaW5oZXJpdGluZyBjb250cmFjdHMgdG8gaW1wbGVtZW50IGEgcGF5YWJsZQogICogY29uc3RydWN0b3IuIEJ5IGRvaW5nIGl0IHRoaXMgd2F5IHdlIHByZXZlbnQgYSBwYXlhYmxlIGNvbnN0cnVjdG9yIGZyb20gd29ya2luZy4gQWx0ZXJuYXRpdmVseQogICogd2UgY291bGQgdXNlIGFzc2VtYmx5IHRvIGFjY2VzcyBtc2cudmFsdWUuCiAgKi8KICBmdW5jdGlvbiBIYXNOb0V0aGVyKCkgcGF5YWJsZSB7CiAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwKTsKICB9CgogIC8qKgogICAqIEBkZXYgRGlzYWxsb3dzIGRpcmVjdCBzZW5kIGJ5IHNldHRpbmdzIGEgZGVmYXVsdCBmdW5jdGlvbiB3aXRob3V0IHRoZSBgcGF5YWJsZWAgZmxhZy4KICAgKi8KICBmdW5jdGlvbigpIGV4dGVybmFsIHsKICB9CgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgYWxsIEV0aGVyIGhlbGQgYnkgdGhlIGNvbnRyYWN0IHRvIHRoZSBvd25lci4KICAgKi8KICBmdW5jdGlvbiByZWNsYWltRXRoZXIoKSBleHRlcm5hbCBvbmx5T3duZXIgewogICAgYXNzZXJ0KG93bmVyLnNlbmQodGhpcy5iYWxhbmNlKSk7CiAgfQp9Cgpjb250cmFjdCBFUkMyMEJhc2ljIHsKICB1aW50MjU2IHB1YmxpYyB0b3RhbFN1cHBseTsKICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB3aG8pIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKCiAgLyoqCiAgKiBAZGV2IHRyYW5zZmVyIHRva2VuIGZvciBhIHNwZWNpZmllZCBhZGRyZXNzCiAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIHRvLgogICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkLgogICovCiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgLy8gU2FmZU1hdGguc3ViIHdpbGwgdGhyb3cgaWYgdGhlcmUgaXMgbm90IGVub3VnaCBiYWxhbmNlLgogICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfdmFsdWUpOwogICAgVHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAqIEBkZXYgR2V0cyB0aGUgYmFsYW5jZSBvZiB0aGUgc3BlY2lmaWVkIGFkZHJlc3MuCiAgKiBAcGFyYW0gX293bmVyIFRoZSBhZGRyZXNzIHRvIHF1ZXJ5IHRoZSB0aGUgYmFsYW5jZSBvZi4KICAqIEByZXR1cm4gQW4gdWludDI1NiByZXByZXNlbnRpbmcgdGhlIGFtb3VudCBvd25lZCBieSB0aGUgcGFzc2VkIGFkZHJlc3MuCiAgKi8KICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpIHsKICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogIH0KCn0KCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKbGlicmFyeSBTYWZlRVJDMjAgewogIGZ1bmN0aW9uIHNhZmVUcmFuc2ZlcihFUkMyMEJhc2ljIHRva2VuLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4udHJhbnNmZXIodG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlVHJhbnNmZXJGcm9tKEVSQzIwIHRva2VuLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHsKICAgIGFzc2VydCh0b2tlbi50cmFuc2ZlckZyb20oZnJvbSwgdG8sIHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiBzYWZlQXBwcm92ZShFUkMyMCB0b2tlbiwgYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCB7CiAgICBhc3NlcnQodG9rZW4uYXBwcm92ZShzcGVuZGVyLCB2YWx1ZSkpOwogIH0KfQoKY29udHJhY3QgQ2FuUmVjbGFpbVRva2VuIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVFUkMyMCBmb3IgRVJDMjBCYXNpYzsKCiAgLyoqCiAgICogQGRldiBSZWNsYWltIGFsbCBFUkMyMEJhc2ljIGNvbXBhdGlibGUgdG9rZW5zCiAgICogQHBhcmFtIHRva2VuIEVSQzIwQmFzaWMgVGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0CiAgICovCiAgZnVuY3Rpb24gcmVjbGFpbVRva2VuKEVSQzIwQmFzaWMgdG9rZW4pIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICB1aW50MjU2IGJhbGFuY2UgPSB0b2tlbi5iYWxhbmNlT2YodGhpcyk7CiAgICB0b2tlbi5zYWZlVHJhbnNmZXIob3duZXIsIGJhbGFuY2UpOwogIH0KCn0KCmNvbnRyYWN0IEhhc05vVG9rZW5zIGlzIENhblJlY2xhaW1Ub2tlbiB7CgogLyoqCiAgKiBAZGV2IFJlamVjdCBhbGwgRVJDMjMgY29tcGF0aWJsZSB0b2tlbnMKICAqIEBwYXJhbSBmcm9tXyBhZGRyZXNzIFRoZSBhZGRyZXNzIHRoYXQgaXMgdHJhbnNmZXJyaW5nIHRoZSB0b2tlbnMKICAqIEBwYXJhbSB2YWx1ZV8gdWludDI1NiB0aGUgYW1vdW50IG9mIHRoZSBzcGVjaWZpZWQgdG9rZW4KICAqIEBwYXJhbSBkYXRhXyBCeXRlcyBUaGUgZGF0YSBwYXNzZWQgZnJvbSB0aGUgY2FsbGVyLgogICovCiAgZnVuY3Rpb24gdG9rZW5GYWxsYmFjayhhZGRyZXNzIGZyb21fLCB1aW50MjU2IHZhbHVlXywgYnl0ZXMgZGF0YV8pIGV4dGVybmFsIHsKICAgIHJldmVydCgpOwogIH0KCn0KCmNvbnRyYWN0IE5vT3duZXIgaXMgSGFzTm9FdGhlciwgSGFzTm9Ub2tlbnMsIEhhc05vQ29udHJhY3RzIHsKfQoKY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgdWludDI1NiBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCmNvbnRyYWN0IE1pbnRhYmxlVG9rZW4gaXMgU3RhbmRhcmRUb2tlbiwgT3duYWJsZSB7CiAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICBldmVudCBNaW50RmluaXNoZWQoKTsKCiAgYm9vbCBwdWJsaWMgbWludGluZ0ZpbmlzaGVkID0gZmFsc2U7CgoKICBtb2RpZmllciBjYW5NaW50KCkgewogICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IEZ1bmN0aW9uIHRvIG1pbnQgdG9rZW5zCiAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgKiBAcGFyYW0gX2Ftb3VudCBUaGUgYW1vdW50IG9mIHRva2VucyB0byBtaW50LgogICAqIEByZXR1cm4gQSBib29sZWFuIHRoYXQgaW5kaWNhdGVzIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gbWludChhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBvbmx5T3duZXIgY2FuTWludCBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgdG90YWxTdXBwbHkgPSB0b3RhbFN1cHBseS5hZGQoX2Ftb3VudCk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICBNaW50KF90bywgX2Ftb3VudCk7CiAgICBUcmFuc2ZlcigweDAsIF90bywgX2Ftb3VudCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICogQHJldHVybiBUcnVlIGlmIHRoZSBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWwuCiAgICovCiAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgbWludGluZ0ZpbmlzaGVkID0gdHJ1ZTsKICAgIE1pbnRGaW5pc2hlZCgpOwogICAgcmV0dXJuIHRydWU7CiAgfQp9Cgpjb250cmFjdCBDYW1wYWlnbiBpcyBDbGFpbWFibGUsIEhhc05vVG9rZW5zLCBSZWVudHJhbmN5R3VhcmQgewogICAgdXNpbmcgU2FmZU1hdGggZm9yIHVpbnQyNTY7CgogICAgc3RyaW5nIGNvbnN0YW50IHB1YmxpYyB2ZXJzaW9uID0gIjEuMC4wIjsKCiAgICBzdHJpbmcgcHVibGljIGlkOwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKCiAgICBzdHJpbmcgcHVibGljIHdlYnNpdGU7CgogICAgYnl0ZXMzMiBwdWJsaWMgd2hpdGVQYXBlckhhc2g7CgogICAgdWludDI1NiBwdWJsaWMgZnVuZGluZ1RocmVzaG9sZDsKCiAgICB1aW50MjU2IHB1YmxpYyBmdW5kaW5nR29hbDsKCiAgICB1aW50MjU2IHB1YmxpYyB0b2tlblByaWNlOwoKICAgIGVudW0gVGltZU1vZGUgewogICAgICAgIEJsb2NrLAogICAgICAgIFRpbWVzdGFtcAogICAgfQoKICAgIFRpbWVNb2RlIHB1YmxpYyB0aW1lTW9kZTsKCiAgICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWU7CgogICAgdWludDI1NiBwdWJsaWMgZmluaXNoVGltZTsKCiAgICBlbnVtIEJvbnVzTW9kZSB7CiAgICAgICAgRmxhdCwKICAgICAgICBCbG9jaywKICAgICAgICBUaW1lc3RhbXAsCiAgICAgICAgQW1vdW50UmFpc2VkLAogICAgICAgIENvbnRyaWJ1dGlvbkFtb3VudAogICAgfQoKICAgIEJvbnVzTW9kZSBwdWJsaWMgYm9udXNNb2RlOwoKICAgIHVpbnQyNTZbXSBwdWJsaWMgYm9udXNMZXZlbHM7CgogICAgdWludDI1NltdIHB1YmxpYyBib251c1JhdGVzOyAvLyBjb2VmZmljaWVudHMgaW4gZXRoZXIKCiAgICBhZGRyZXNzIHB1YmxpYyBiZW5lZmljaWFyeTsKCiAgICB1aW50MjU2IHB1YmxpYyBhbW91bnRSYWlzZWQ7CgogICAgdWludDI1NiBwdWJsaWMgbWluQ29udHJpYnV0aW9uOwoKICAgIHVpbnQyNTYgcHVibGljIGVhcmx5U3VjY2Vzc1RpbWVzdGFtcDsKCiAgICB1aW50MjU2IHB1YmxpYyBlYXJseVN1Y2Nlc3NCbG9jazsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBjb250cmlidXRpb25zOwoKICAgIFRva2VuIHB1YmxpYyB0b2tlbjsKCiAgICBlbnVtIFN0YWdlIHsKICAgICAgICBJbml0LAogICAgICAgIFJlYWR5LAogICAgICAgIEluUHJvZ3Jlc3MsCiAgICAgICAgRmFpbHVyZSwKICAgICAgICBTdWNjZXNzCiAgICB9CgogICAgZnVuY3Rpb24gc3RhZ2UoKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAoU3RhZ2UpCiAgICB7CiAgICAgICAgaWYgKHRva2VuID09IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgcmV0dXJuIFN0YWdlLkluaXQ7CiAgICAgICAgfQoKICAgICAgICB2YXIgX3RpbWUgPSB0aW1lTW9kZSA9PSBUaW1lTW9kZS5UaW1lc3RhbXAgPyBibG9jay50aW1lc3RhbXAgOiBibG9jay5udW1iZXI7CgogICAgICAgIGlmIChfdGltZSA8IHN0YXJ0VGltZSkgewogICAgICAgICAgICByZXR1cm4gU3RhZ2UuUmVhZHk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmluaXNoVGltZSA8PSBfdGltZSkgewogICAgICAgICAgICBpZiAoYW1vdW50UmFpc2VkIDwgZnVuZGluZ1RocmVzaG9sZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFN0YWdlLkZhaWx1cmU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFN0YWdlLlN1Y2Nlc3M7CiAgICAgICAgfQoKICAgICAgICBpZiAoZnVuZGluZ0dvYWwgPD0gYW1vdW50UmFpc2VkKSB7CiAgICAgICAgICAgIHJldHVybiBTdGFnZS5TdWNjZXNzOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFN0YWdlLkluUHJvZ3Jlc3M7CiAgICB9CgogICAgbW9kaWZpZXIgYXRTdGFnZShTdGFnZSBfc3RhZ2UpIHsKICAgICAgICByZXF1aXJlKHN0YWdlKCkgPT0gX3N0YWdlKTsKICAgICAgICBfOwogICAgfQoKICAgIGV2ZW50IENvbnRyaWJ1dGlvbihhZGRyZXNzIHNlbmRlciwgdWludDI1NiBhbW91bnQpOwoKICAgIGV2ZW50IFJlZnVuZChhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBhbW91bnQpOwoKICAgIGV2ZW50IFBheW91dChhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBhbW91bnQpOwoKICAgIGV2ZW50IEVhcmx5U3VjY2VzcygpOwoKICAgIGZ1bmN0aW9uIENhbXBhaWduKAogICAgICAgIHN0cmluZyBfaWQsCiAgICAgICAgYWRkcmVzcyBfYmVuZWZpY2lhcnksCiAgICAgICAgc3RyaW5nIF9uYW1lLAogICAgICAgIHN0cmluZyBfd2Vic2l0ZSwKICAgICAgICBieXRlczMyIF93aGl0ZVBhcGVySGFzaAogICAgKQogICAgcHVibGljCiAgICB7CiAgICAgICAgaWQgPSBfaWQ7CiAgICAgICAgYmVuZWZpY2lhcnkgPSBfYmVuZWZpY2lhcnk7CiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHdlYnNpdGUgPSBfd2Vic2l0ZTsKICAgICAgICB3aGl0ZVBhcGVySGFzaCA9IF93aGl0ZVBhcGVySGFzaDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRQYXJhbXMoCiAgICAgICAgLy8gUGFyYW1zIGFyZSBjb21iaW5lZCB0byB0aGUgYXJyYXkgdG8gYXZvaWQgdGhlIOKAnFN0YWNrIHRvbyBkZWVw4oCdIGVycm9yCiAgICAgICAgdWludDI1NltdIF9mdW5kaW5nVGhyZXNob2xkX2Z1bmRpbmdHb2FsX3Rva2VuUHJpY2Vfc3RhcnRUaW1lX2ZpbmlzaFRpbWUsCiAgICAgICAgdWludDhbXSBfdGltZU1vZGVfYm9udXNNb2RlLAogICAgICAgIHVpbnQyNTZbXSBfYm9udXNMZXZlbHMsCiAgICAgICAgdWludDI1NltdIF9ib251c1JhdGVzCiAgICApCiAgICBwdWJsaWMKICAgIG9ubHlPd25lcgogICAgYXRTdGFnZShTdGFnZS5Jbml0KQogICAgewogICAgICAgIGFzc2VydChmdW5kaW5nR29hbCA9PSAwKTsKCiAgICAgICAgZnVuZGluZ1RocmVzaG9sZCA9IF9mdW5kaW5nVGhyZXNob2xkX2Z1bmRpbmdHb2FsX3Rva2VuUHJpY2Vfc3RhcnRUaW1lX2ZpbmlzaFRpbWVbMF07CiAgICAgICAgZnVuZGluZ0dvYWwgPSBfZnVuZGluZ1RocmVzaG9sZF9mdW5kaW5nR29hbF90b2tlblByaWNlX3N0YXJ0VGltZV9maW5pc2hUaW1lWzFdOwogICAgICAgIHRva2VuUHJpY2UgPSBfZnVuZGluZ1RocmVzaG9sZF9mdW5kaW5nR29hbF90b2tlblByaWNlX3N0YXJ0VGltZV9maW5pc2hUaW1lWzJdOwogICAgICAgIHRpbWVNb2RlID0gVGltZU1vZGUoX3RpbWVNb2RlX2JvbnVzTW9kZVswXSk7CiAgICAgICAgc3RhcnRUaW1lID0gX2Z1bmRpbmdUaHJlc2hvbGRfZnVuZGluZ0dvYWxfdG9rZW5QcmljZV9zdGFydFRpbWVfZmluaXNoVGltZVszXTsKICAgICAgICBmaW5pc2hUaW1lID0gX2Z1bmRpbmdUaHJlc2hvbGRfZnVuZGluZ0dvYWxfdG9rZW5QcmljZV9zdGFydFRpbWVfZmluaXNoVGltZVs0XTsKICAgICAgICBib251c01vZGUgPSBCb251c01vZGUoX3RpbWVNb2RlX2JvbnVzTW9kZVsxXSk7CiAgICAgICAgYm9udXNMZXZlbHMgPSBfYm9udXNMZXZlbHM7CiAgICAgICAgYm9udXNSYXRlcyA9IF9ib251c1JhdGVzOwoKICAgICAgICByZXF1aXJlKGZ1bmRpbmdUaHJlc2hvbGQgPiAwKTsKICAgICAgICByZXF1aXJlKGZ1bmRpbmdUaHJlc2hvbGQgPD0gZnVuZGluZ0dvYWwpOwogICAgICAgIHJlcXVpcmUoc3RhcnRUaW1lIDwgZmluaXNoVGltZSk7CiAgICAgICAgcmVxdWlyZSgodGltZU1vZGUgPT0gVGltZU1vZGUuQmxvY2sgPyBibG9jay5udW1iZXIgOiBibG9jay50aW1lc3RhbXApIDwgc3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKGJvbnVzTGV2ZWxzLmxlbmd0aCA9PSBib251c1JhdGVzLmxlbmd0aCk7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlVG9rZW4oCiAgICAgICAgc3RyaW5nIF90b2tlbk5hbWUsCiAgICAgICAgc3RyaW5nIF90b2tlblN5bWJvbCwKICAgICAgICB1aW50OCBfdG9rZW5EZWNpbWFscywKICAgICAgICBhZGRyZXNzW10gX2Rpc3RyaWJ1dGlvblJlY2lwaWVudHMsCiAgICAgICAgdWludDI1NltdIF9kaXN0cmlidXRpb25BbW91bnRzLAogICAgICAgIHVpbnQyNTZbXSBfcmVsZWFzZVRpbWVzCiAgICApCiAgICBwdWJsaWMKICAgIG9ubHlPd25lcgogICAgYXRTdGFnZShTdGFnZS5Jbml0KQogICAgewogICAgICAgIGFzc2VydChmdW5kaW5nR29hbCA+IDApOwoKICAgICAgICB0b2tlbiA9IG5ldyBUb2tlbigKICAgICAgICAgICAgX3Rva2VuTmFtZSwKICAgICAgICAgICAgX3Rva2VuU3ltYm9sLAogICAgICAgICAgICBfdG9rZW5EZWNpbWFscywKICAgICAgICAgICAgX2Rpc3RyaWJ1dGlvblJlY2lwaWVudHMsCiAgICAgICAgICAgIF9kaXN0cmlidXRpb25BbW91bnRzLAogICAgICAgICAgICBfcmVsZWFzZVRpbWVzLAogICAgICAgICAgICB1aW50OCh0aW1lTW9kZSkKICAgICAgICApOwoKICAgICAgICBtaW5Db250cmlidXRpb24gPSB0b2tlblByaWNlLmRpdigxMCAqKiB1aW50MjU2KHRva2VuLmRlY2ltYWxzKCkpKTsKICAgICAgICBpZiAobWluQ29udHJpYnV0aW9uIDwgMSB3ZWkpIHsKICAgICAgICAgICAgbWluQ29udHJpYnV0aW9uID0gMSB3ZWk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uKCkKICAgIHB1YmxpYwogICAgcGF5YWJsZQogICAgYXRTdGFnZShTdGFnZS5JblByb2dyZXNzKQogICAgewogICAgICAgIHJlcXVpcmUobWluQ29udHJpYnV0aW9uIDw9IG1zZy52YWx1ZSk7CgogICAgICAgIGNvbnRyaWJ1dGlvbnNbbXNnLnNlbmRlcl0gPSBjb250cmlidXRpb25zW21zZy5zZW5kZXJdLmFkZChtc2cudmFsdWUpOwoKICAgICAgICAvLyBDYWxjdWxhdGUgYm9udXMKICAgICAgICB1aW50MjU2IF9sZXZlbDsKICAgICAgICB1aW50MjU2IF90b2tlbnNBbW91bnQ7CiAgICAgICAgdWludCBpOwogICAgICAgIGlmIChib251c01vZGUgPT0gQm9udXNNb2RlLkFtb3VudFJhaXNlZCkgewogICAgICAgICAgICBfbGV2ZWwgPSBhbW91bnRSYWlzZWQ7CiAgICAgICAgICAgIHVpbnQyNTYgX3ZhbHVlID0gbXNnLnZhbHVlOwogICAgICAgICAgICB1aW50MjU2IF93ZWlnaHRlZFJhdGVTdW0gPSAwOwogICAgICAgICAgICB1aW50MjU2IF9zdGVwQW1vdW50OwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYm9udXNMZXZlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChfbGV2ZWwgPD0gYm9udXNMZXZlbHNbaV0pIHsKICAgICAgICAgICAgICAgICAgICBfc3RlcEFtb3VudCA9IGJvbnVzTGV2ZWxzW2ldLnN1YihfbGV2ZWwpOwogICAgICAgICAgICAgICAgICAgIGlmIChfdmFsdWUgPD0gX3N0ZXBBbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2xldmVsID0gX2xldmVsLmFkZChfdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBfd2VpZ2h0ZWRSYXRlU3VtID0gX3dlaWdodGVkUmF0ZVN1bS5hZGQoX3ZhbHVlLm11bChib251c1JhdGVzW2ldKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIF92YWx1ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9sZXZlbCA9IF9sZXZlbC5hZGQoX3N0ZXBBbW91bnQpOwogICAgICAgICAgICAgICAgICAgICAgICBfd2VpZ2h0ZWRSYXRlU3VtID0gX3dlaWdodGVkUmF0ZVN1bS5hZGQoX3N0ZXBBbW91bnQubXVsKGJvbnVzUmF0ZXNbaV0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgX3ZhbHVlID0gX3ZhbHVlLnN1Yihfc3RlcEFtb3VudCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF93ZWlnaHRlZFJhdGVTdW0gPSBfd2VpZ2h0ZWRSYXRlU3VtLmFkZChfdmFsdWUubXVsKDEgZXRoZXIpKTsKCiAgICAgICAgICAgIF90b2tlbnNBbW91bnQgPSBfd2VpZ2h0ZWRSYXRlU3VtLmRpdigxIGV0aGVyKS5tdWwoMTAgKiogdWludDI1Nih0b2tlbi5kZWNpbWFscygpKSkuZGl2KHRva2VuUHJpY2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90b2tlbnNBbW91bnQgPSBtc2cudmFsdWUubXVsKDEwICoqIHVpbnQyNTYodG9rZW4uZGVjaW1hbHMoKSkpLmRpdih0b2tlblByaWNlKTsKCiAgICAgICAgICAgIGlmIChib251c01vZGUgPT0gQm9udXNNb2RlLkJsb2NrKSB7CiAgICAgICAgICAgICAgICBfbGV2ZWwgPSBibG9jay5udW1iZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJvbnVzTW9kZSA9PSBCb251c01vZGUuVGltZXN0YW1wKSB7CiAgICAgICAgICAgICAgICBfbGV2ZWwgPSBibG9jay50aW1lc3RhbXA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJvbnVzTW9kZSA9PSBCb251c01vZGUuQ29udHJpYnV0aW9uQW1vdW50KSB7CiAgICAgICAgICAgICAgICBfbGV2ZWwgPSBtc2cudmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBib251c0xldmVscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKF9sZXZlbCA8PSBib251c0xldmVsc1tpXSkgewogICAgICAgICAgICAgICAgICAgIF90b2tlbnNBbW91bnQgPSBfdG9rZW5zQW1vdW50Lm11bChib251c1JhdGVzW2ldKS5kaXYoMSBldGhlcik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGFtb3VudFJhaXNlZCA9IGFtb3VudFJhaXNlZC5hZGQobXNnLnZhbHVlKTsKCiAgICAgICAgLy8gV2UgZG9u4oCZdCB3YW50IG1vcmUgdGhhbiB0aGUgZnVuZGluZyBnb2FsCiAgICAgICAgcmVxdWlyZShhbW91bnRSYWlzZWQgPD0gZnVuZGluZ0dvYWwpOwoKICAgICAgICByZXF1aXJlKHRva2VuLm1pbnQobXNnLnNlbmRlciwgX3Rva2Vuc0Ftb3VudCkpOwoKICAgICAgICBDb250cmlidXRpb24obXNnLnNlbmRlciwgbXNnLnZhbHVlKTsKCiAgICAgICAgaWYgKGZ1bmRpbmdHb2FsIDw9IGFtb3VudFJhaXNlZCkgewogICAgICAgICAgICBlYXJseVN1Y2Nlc3NUaW1lc3RhbXAgPSBibG9jay50aW1lc3RhbXA7CiAgICAgICAgICAgIGVhcmx5U3VjY2Vzc0Jsb2NrID0gYmxvY2subnVtYmVyOwogICAgICAgICAgICB0b2tlbi5maW5pc2hNaW50aW5nKCk7CiAgICAgICAgICAgIEVhcmx5U3VjY2VzcygpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd1BheW91dCgpCiAgICBwdWJsaWMKICAgIGF0U3RhZ2UoU3RhZ2UuU3VjY2VzcykKICAgIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYmVuZWZpY2lhcnkpOwoKICAgICAgICBpZiAoIXRva2VuLm1pbnRpbmdGaW5pc2hlZCgpKSB7CiAgICAgICAgICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKICAgICAgICB9CgogICAgICAgIHZhciBfYW1vdW50ID0gdGhpcy5iYWxhbmNlOwogICAgICAgIHJlcXVpcmUoYmVuZWZpY2lhcnkuY2FsbC52YWx1ZShfYW1vdW50KSgpKTsKICAgICAgICBQYXlvdXQoYmVuZWZpY2lhcnksIF9hbW91bnQpOwogICAgfQoKICAgIC8vIEFueW9uZSBjYW4gbWFrZSB0b2tlbnMgYXZhaWxhYmxlIHdoZW4gdGhlIGNhbXBhaWduIGlzIHN1Y2Nlc3NmdWwKICAgIGZ1bmN0aW9uIHJlbGVhc2VUb2tlbnMoKQogICAgcHVibGljCiAgICBhdFN0YWdlKFN0YWdlLlN1Y2Nlc3MpCiAgICB7CiAgICAgICAgcmVxdWlyZSghdG9rZW4ubWludGluZ0ZpbmlzaGVkKCkpOwogICAgICAgIHRva2VuLmZpbmlzaE1pbnRpbmcoKTsKICAgIH0KCiAgICBmdW5jdGlvbiB3aXRoZHJhd1JlZnVuZCgpCiAgICBwdWJsaWMKICAgIGF0U3RhZ2UoU3RhZ2UuRmFpbHVyZSkKICAgIG5vblJlZW50cmFudAogICAgewogICAgICAgIHZhciBfYW1vdW50ID0gY29udHJpYnV0aW9uc1ttc2cuc2VuZGVyXTsKCiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CgogICAgICAgIGNvbnRyaWJ1dGlvbnNbbXNnLnNlbmRlcl0gPSAwOwoKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKF9hbW91bnQpOwogICAgICAgIFJlZnVuZChtc2cuc2VuZGVyLCBfYW1vdW50KTsKICAgIH0KfQoKY29udHJhY3QgVG9rZW4gaXMgTWludGFibGVUb2tlbiwgTm9Pd25lciB7CiAgICBzdHJpbmcgY29uc3RhbnQgcHVibGljIHZlcnNpb24gPSAiMS4wLjAiOwoKICAgIHN0cmluZyBwdWJsaWMgbmFtZTsKCiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKCiAgICB1aW50OCBwdWJsaWMgZGVjaW1hbHM7CgogICAgZW51bSBUaW1lTW9kZSB7CiAgICAgICAgQmxvY2ssCiAgICAgICAgVGltZXN0YW1wCiAgICB9CgogICAgVGltZU1vZGUgcHVibGljIHRpbWVNb2RlOwoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIHJlbGVhc2VUaW1lczsKCiAgICBmdW5jdGlvbiBUb2tlbigKICAgICAgICBzdHJpbmcgX25hbWUsCiAgICAgICAgc3RyaW5nIF9zeW1ib2wsCiAgICAgICAgdWludDggX2RlY2ltYWxzLAogICAgICAgIGFkZHJlc3NbXSBfcmVjaXBpZW50cywKICAgICAgICB1aW50MjU2W10gX2Ftb3VudHMsCiAgICAgICAgdWludDI1NltdIF9yZWxlYXNlVGltZXMsCiAgICAgICAgdWludDggX3RpbWVNb2RlCiAgICApCiAgICBwdWJsaWMKICAgIHsKICAgICAgICByZXF1aXJlKF9yZWNpcGllbnRzLmxlbmd0aCA9PSBfYW1vdW50cy5sZW5ndGgpOwogICAgICAgIHJlcXVpcmUoX3JlY2lwaWVudHMubGVuZ3RoID09IF9yZWxlYXNlVGltZXMubGVuZ3RoKTsKCiAgICAgICAgbmFtZSA9IF9uYW1lOwogICAgICAgIHN5bWJvbCA9IF9zeW1ib2w7CiAgICAgICAgZGVjaW1hbHMgPSBfZGVjaW1hbHM7CiAgICAgICAgdGltZU1vZGUgPSBUaW1lTW9kZShfdGltZU1vZGUpOwoKICAgICAgICAvLyBNaW50IHByZS1kaXN0cmlidXRlZCB0b2tlbnMKICAgICAgICBmb3IgKHVpbnQyNTYgaSA9IDA7IGkgPCBfcmVjaXBpZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtaW50KF9yZWNpcGllbnRzW2ldLCBfYW1vdW50c1tpXSk7CiAgICAgICAgICAgIGlmIChfcmVsZWFzZVRpbWVzW2ldID4gMCkgewogICAgICAgICAgICAgICAgcmVsZWFzZVRpbWVzW19yZWNpcGllbnRzW2ldXSA9IF9yZWxlYXNlVGltZXNbaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIFRyYW5zZmVyIGlzIGZvcmJpZGRlbiB1bnRpbCBtaW50aW5nIGlzIGZpbmlzaGVkCiAgICAgICAgcmVxdWlyZShtaW50aW5nRmluaXNoZWQpOwoKICAgICAgICAvLyBUcmFuc2ZlciBvZiB0aW1lLWxvY2tlZCBmdW5kcyBpcyBmb3JiaWRkZW4KICAgICAgICByZXF1aXJlKCF0aW1lTG9ja2VkKG1zZy5zZW5kZXIpKTsKCiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKQogICAgcHVibGljCiAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIC8vIFRyYW5zZmVyIGlzIGZvcmJpZGRlbiB1bnRpbCBtaW50aW5nIGlzIGZpbmlzaGVkCiAgICAgICAgcmVxdWlyZShtaW50aW5nRmluaXNoZWQpOwoKICAgICAgICAvLyBUcmFuc2ZlciBvZiB0aW1lLWxvY2tlZCBmdW5kcyBpcyBmb3JiaWRkZW4KICAgICAgICByZXF1aXJlKCF0aW1lTG9ja2VkKF9mcm9tKSk7CgogICAgICAgIHJldHVybiBzdXBlci50cmFuc2ZlckZyb20oX2Zyb20sIF90bywgX3ZhbHVlKTsKICAgIH0KCiAgICAvLyBDaGVja3MgaWYgZnVuZHMgb2YgYSBnaXZlbiBhZGRyZXNzIGFyZSB0aW1lLWxvY2tlZAogICAgZnVuY3Rpb24gdGltZUxvY2tlZChhZGRyZXNzIF9zcGVuZGVyKQogICAgcHVibGljCiAgICBjb25zdGFudAogICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBpZiAocmVsZWFzZVRpbWVzW19zcGVuZGVyXSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRpbWUtbG9jayBpcyBleHBpcmVkLCBkZWxldGUgaXQKICAgICAgICB2YXIgX3RpbWUgPSB0aW1lTW9kZSA9PSBUaW1lTW9kZS5UaW1lc3RhbXAgPyBibG9jay50aW1lc3RhbXAgOiBibG9jay5udW1iZXI7CiAgICAgICAgaWYgKHJlbGVhc2VUaW1lc1tfc3BlbmRlcl0gPD0gX3RpbWUpIHsKICAgICAgICAgICAgZGVsZXRlIHJlbGVhc2VUaW1lc1tfc3BlbmRlcl07CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9'.
	

]
