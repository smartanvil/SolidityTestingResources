Class {
	#name : #SRTf94ec2fbad0f7ac9edd4d5d7e909fddc78c8f2e8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTf94ec2fbad0f7ac9edd4d5d7e909fddc78c8f2e8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgovKgogICAgVXRpbGl0aWVzICYgQ29tbW9uIE1vZGlmaWVycwoqLwpjb250cmFjdCBVdGlscyB7CiAgICAvKioKICAgICAgICBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIFV0aWxzKCkgewogICAgfQoKICAgIC8vIHZlcmlmaWVzIHRoYXQgYW4gYW1vdW50IGlzIGdyZWF0ZXIgdGhhbiB6ZXJvCiAgICBtb2RpZmllciBncmVhdGVyVGhhblplcm8odWludDI1NiBfYW1vdW50KSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYW4gYWRkcmVzcyAtIGN1cnJlbnRseSBvbmx5IGNoZWNrcyB0aGF0IGl0IGlzbid0IG51bGwKICAgIG1vZGlmaWVyIHZhbGlkQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyAhPSAweDApOwogICAgICAgIF87CiAgICB9CgogICAgLy8gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBpcyBkaWZmZXJlbnQgdGhhbiB0aGlzIGNvbnRyYWN0IGFkZHJlc3MKICAgIG1vZGlmaWVyIG5vdFRoaXMoYWRkcmVzcyBfYWRkcmVzcykgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBPdmVyZmxvdyBwcm90ZWN0ZWQgbWF0aCBmdW5jdGlvbnMKCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIHN1bSBvZiBfeCBhbmQgX3ksIGFzc2VydHMgaWYgdGhlIGNhbGN1bGF0aW9uIG92ZXJmbG93cwoKICAgICAgICBAcGFyYW0gX3ggICB2YWx1ZSAxCiAgICAgICAgQHBhcmFtIF95ICAgdmFsdWUgMgoKICAgICAgICBAcmV0dXJuIHN1bQogICAgKi8KICAgIGZ1bmN0aW9uIHNhZmVBZGQodWludDI1NiBfeCwgdWludDI1NiBfeSkgaW50ZXJuYWwgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgeiA9IF94ICsgX3k7CiAgICAgICAgYXNzZXJ0KHogPj0gX3gpOwogICAgICAgIHJldHVybiB6OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZGlmZmVyZW5jZSBvZiBfeCBtaW51cyBfeSwgYXNzZXJ0cyBpZiB0aGUgc3VidHJhY3Rpb24gcmVzdWx0cyBpbiBhIG5lZ2F0aXZlIG51bWJlcgoKICAgICAgICBAcGFyYW0gX3ggICBtaW51ZW5kCiAgICAgICAgQHBhcmFtIF95ICAgc3VidHJhaGVuZAoKICAgICAgICBAcmV0dXJuIGRpZmZlcmVuY2UKICAgICovCiAgICBmdW5jdGlvbiBzYWZlU3ViKHVpbnQyNTYgX3gsIHVpbnQyNTYgX3kpIGludGVybmFsIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICBhc3NlcnQoX3ggPj0gX3kpOwogICAgICAgIHJldHVybiBfeCAtIF95OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgcHJvZHVjdCBvZiBtdWx0aXBseWluZyBfeCBieSBfeSwgYXNzZXJ0cyBpZiB0aGUgY2FsY3VsYXRpb24gb3ZlcmZsb3dzCgogICAgICAgIEBwYXJhbSBfeCAgIGZhY3RvciAxCiAgICAgICAgQHBhcmFtIF95ICAgZmFjdG9yIDIKCiAgICAgICAgQHJldHVybiBwcm9kdWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2FmZU11bCh1aW50MjU2IF94LCB1aW50MjU2IF95KSBpbnRlcm5hbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgdWludDI1NiB6ID0gX3ggKiBfeTsKICAgICAgICBhc3NlcnQoX3ggPT0gMCB8fCB6IC8gX3ggPT0gX3kpOwogICAgICAgIHJldHVybiB6OwogICAgfQp9CgoKCi8qCiAgICBPd25lZCBjb250cmFjdCBpbnRlcmZhY2UKKi8KY29udHJhY3QgSU93bmVkIHsKICAgIC8vIHRoaXMgZnVuY3Rpb24gaXNuJ3QgYWJzdHJhY3Qgc2luY2UgdGhlIGNvbXBpbGVyIGVtaXRzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGdldHRlciBmdW5jdGlvbnMgYXMgZXh0ZXJuYWwKICAgIGZ1bmN0aW9uIG93bmVyKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHt9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYzsKfQoKCi8qCiAgICBQcm92aWRlcyBzdXBwb3J0IGFuZCB1dGlsaXRpZXMgZm9yIGNvbnRyYWN0IG93bmVyc2hpcAoqLwpjb250cmFjdCBPd25lZCBpcyBJT3duZWQgewogICAgYWRkcmVzcyBwdWJsaWMgb3duZXI7CiAgICBhZGRyZXNzIHB1YmxpYyBuZXdPd25lcjsKCiAgICBldmVudCBPd25lclVwZGF0ZShhZGRyZXNzIF9wcmV2T3duZXIsIGFkZHJlc3MgX25ld093bmVyKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gT3duZWQoKSB7CiAgICAgICAgb3duZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gYnkgdGhlIG93bmVyIG9ubHkKICAgIG1vZGlmaWVyIG93bmVyT25seSB7CiAgICAgICAgYXNzZXJ0KG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBhbGxvd3MgdHJhbnNmZXJyaW5nIHRoZSBjb250cmFjdCBvd25lcnNoaXAKICAgICAgICB0aGUgbmV3IG93bmVyIHN0aWxsIG5lZWRzIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCgogICAgICAgIEBwYXJhbSBfbmV3T3duZXIgICAgbmV3IGNvbnRyYWN0IG93bmVyCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBfbmV3T3duZXIpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHJlcXVpcmUoX25ld093bmVyICE9IG93bmVyKTsKICAgICAgICBuZXdPd25lciA9IF9uZXdPd25lcjsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVzZWQgYnkgYSBuZXcgb3duZXIgdG8gYWNjZXB0IGFuIG93bmVyc2hpcCB0cmFuc2ZlcgogICAgKi8KICAgIGZ1bmN0aW9uIGFjY2VwdE93bmVyc2hpcCgpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG5ld093bmVyKTsKICAgICAgICBPd25lclVwZGF0ZShvd25lciwgbmV3T3duZXIpOwogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgbmV3T3duZXIgPSAweDA7CiAgICB9Cn0KCgoKLyoKICAgIEVSQzIwIFN0YW5kYXJkIFRva2VuIGludGVyZmFjZQoqLwpjb250cmFjdCBJRVJDMjBUb2tlbiB7CiAgICAvLyB0aGVzZSBmdW5jdGlvbnMgYXJlbid0IGFic3RyYWN0IHNpbmNlIHRoZSBjb21waWxlciBlbWl0cyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBnZXR0ZXIgZnVuY3Rpb25zIGFzIGV4dGVybmFsCiAgICBmdW5jdGlvbiBuYW1lKCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHN0cmluZykge30KICAgIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChzdHJpbmcpIHt9CiAgICBmdW5jdGlvbiBkZWNpbWFscygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50OCkge30KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHt9CiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7IF9vd25lcjsgfQogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3MgX293bmVyLCBhZGRyZXNzIF9zcGVuZGVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgeyBfb3duZXI7IF9zcGVuZGVyOyB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCBzdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sIHN1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wgc3VjY2Vzcyk7Cn0KCgovKgogICAgVG9rZW4gSG9sZGVyIGludGVyZmFjZQoqLwpjb250cmFjdCBJVG9rZW5Ib2xkZXIgaXMgSU93bmVkIHsKICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljOwp9CgoKLyoKICAgIFdlIGNvbnNpZGVyIGV2ZXJ5IGNvbnRyYWN0IHRvIGJlIGEgJ3Rva2VuIGhvbGRlcicgc2luY2UgaXQncyBjdXJyZW50bHkgbm90IHBvc3NpYmxlCiAgICBmb3IgYSBjb250cmFjdCB0byBkZW55IHJlY2VpdmluZyB0b2tlbnMuCgogICAgVGhlIFRva2VuSG9sZGVyJ3MgY29udHJhY3Qgc29sZSBwdXJwb3NlIGlzIHRvIHByb3ZpZGUgYSBzYWZldHkgbWVjaGFuaXNtIHRoYXQgYWxsb3dzCiAgICB0aGUgb3duZXIgdG8gc2VuZCB0b2tlbnMgdGhhdCB3ZXJlIHNlbnQgdG8gdGhlIGNvbnRyYWN0IGJ5IG1pc3Rha2UgYmFjayB0byB0aGVpciBzZW5kZXIuCiovCmNvbnRyYWN0IFRva2VuSG9sZGVyIGlzIElUb2tlbkhvbGRlciwgT3duZWQsIFV0aWxzIHsKICAgIC8qKgogICAgICAgIEBkZXYgY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBUb2tlbkhvbGRlcigpIHsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHdpdGhkcmF3cyB0b2tlbnMgaGVsZCBieSB0aGUgY29udHJhY3QgYW5kIHNlbmRzIHRoZW0gdG8gYW4gYWNjb3VudAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKCiAgICAgICAgQHBhcmFtIF90b2tlbiAgIEVSQzIwIHRva2VuIGNvbnRyYWN0IGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3RvICAgICAgYWNjb3VudCB0byByZWNlaXZlIHRoZSBuZXcgYW1vdW50CiAgICAgICAgQHBhcmFtIF9hbW91bnQgIGFtb3VudCB0byB3aXRoZHJhdwogICAgKi8KICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG9rZW5zKElFUkMyMFRva2VuIF90b2tlbiwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZEFkZHJlc3MoX3Rva2VuKQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG8pCiAgICAgICAgbm90VGhpcyhfdG8pCiAgICB7CiAgICAgICAgYXNzZXJ0KF90b2tlbi50cmFuc2ZlcihfdG8sIF9hbW91bnQpKTsKICAgIH0KfQoKCgoKCi8qCiAgICBTbWFydCBUb2tlbiBpbnRlcmZhY2UKKi8KY29udHJhY3QgSVNtYXJ0VG9rZW4gaXMgSU93bmVkLCBJRVJDMjBUb2tlbiB7CiAgICBmdW5jdGlvbiBkaXNhYmxlVHJhbnNmZXJzKGJvb2wgX2Rpc2FibGUpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGlzc3VlKGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGRlc3Ryb3koYWRkcmVzcyBfZnJvbSwgdWludDI1NiBfYW1vdW50KSBwdWJsaWM7Cn0KCgovKgogICAgVGhlIHNtYXJ0IHRva2VuIGNvbnRyb2xsZXIgaXMgYW4gdXBncmFkYWJsZSBwYXJ0IG9mIHRoZSBzbWFydCB0b2tlbiB0aGF0IGFsbG93cwogICAgbW9yZSBmdW5jdGlvbmFsaXR5IGFzIHdlbGwgYXMgZml4ZXMgZm9yIGJ1Z3MvZXhwbG9pdHMuCiAgICBPbmNlIGl0IGFjY2VwdHMgb3duZXJzaGlwIG9mIHRoZSB0b2tlbiwgaXQgYmVjb21lcyB0aGUgdG9rZW4ncyBzb2xlIGNvbnRyb2xsZXIKICAgIHRoYXQgY2FuIGV4ZWN1dGUgYW55IG9mIGl0cyBmdW5jdGlvbnMuCgogICAgVG8gdXBncmFkZSB0aGUgY29udHJvbGxlciwgb3duZXJzaGlwIG11c3QgYmUgdHJhbnNmZXJyZWQgdG8gYSBuZXcgY29udHJvbGxlciwgYWxvbmcgd2l0aAogICAgYW55IHJlbGV2YW50IGRhdGEuCgogICAgVGhlIHNtYXJ0IHRva2VuIG11c3QgYmUgc2V0IG9uIGNvbnN0cnVjdGlvbiBhbmQgY2Fubm90IGJlIGNoYW5nZWQgYWZ0ZXJ3YXJkcy4KICAgIFdyYXBwZXJzIGFyZSBwcm92aWRlZCAoYXMgb3Bwb3NlZCB0byBhIHNpbmdsZSAnZXhlY3V0ZScgZnVuY3Rpb24pIGZvciBlYWNoIG9mIHRoZSB0b2tlbidzIGZ1bmN0aW9ucywgZm9yIGVhc2llciBhY2Nlc3MuCgogICAgTm90ZSB0aGF0IHRoZSBjb250cm9sbGVyIGNhbiB0cmFuc2ZlciB0b2tlbiBvd25lcnNoaXAgdG8gYSBuZXcgY29udHJvbGxlciB0aGF0CiAgICBkb2Vzbid0IGFsbG93IGV4ZWN1dGluZyBhbnkgZnVuY3Rpb24gb24gdGhlIHRva2VuLCBmb3IgYSB0cnVzdGxlc3Mgc29sdXRpb24uCiAgICBEb2luZyB0aGF0IHdpbGwgYWxzbyByZW1vdmUgdGhlIG93bmVyJ3MgYWJpbGl0eSB0byB1cGdyYWRlIHRoZSBjb250cm9sbGVyLgoqLwpjb250cmFjdCBTbWFydFRva2VuQ29udHJvbGxlciBpcyBUb2tlbkhvbGRlciB7CiAgICBJU21hcnRUb2tlbiBwdWJsaWMgdG9rZW47ICAgLy8gc21hcnQgdG9rZW4KCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gU21hcnRUb2tlbkNvbnRyb2xsZXIoSVNtYXJ0VG9rZW4gX3Rva2VuKQogICAgICAgIHZhbGlkQWRkcmVzcyhfdG9rZW4pCiAgICB7CiAgICAgICAgdG9rZW4gPSBfdG9rZW47CiAgICB9CgogICAgLy8gZW5zdXJlcyB0aGF0IHRoZSBjb250cm9sbGVyIGlzIHRoZSB0b2tlbidzIG93bmVyCiAgICBtb2RpZmllciBhY3RpdmUoKSB7CiAgICAgICAgYXNzZXJ0KHRva2VuLm93bmVyKCkgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBlbnN1cmVzIHRoYXQgdGhlIGNvbnRyb2xsZXIgaXMgbm90IHRoZSB0b2tlbidzIG93bmVyCiAgICBtb2RpZmllciBpbmFjdGl2ZSgpIHsKICAgICAgICBhc3NlcnQodG9rZW4ub3duZXIoKSAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYWxsb3dzIHRyYW5zZmVycmluZyB0aGUgdG9rZW4gb3duZXJzaGlwCiAgICAgICAgdGhlIG5ldyBvd25lciBzdGlsbCBuZWVkIHRvIGFjY2VwdCB0aGUgdHJhbnNmZXIKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIGNvbnRyYWN0IG93bmVyCgogICAgICAgIEBwYXJhbSBfbmV3T3duZXIgICAgbmV3IHRva2VuIG93bmVyCiAgICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJUb2tlbk93bmVyc2hpcChhZGRyZXNzIF9uZXdPd25lcikgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgdG9rZW4udHJhbnNmZXJPd25lcnNoaXAoX25ld093bmVyKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHVzZWQgYnkgYSBuZXcgb3duZXIgdG8gYWNjZXB0IGEgdG9rZW4gb3duZXJzaGlwIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBvd25lcgogICAgKi8KICAgIGZ1bmN0aW9uIGFjY2VwdFRva2VuT3duZXJzaGlwKCkgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgdG9rZW4uYWNjZXB0T3duZXJzaGlwKCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkaXNhYmxlcy9lbmFibGVzIHRva2VuIHRyYW5zZmVycwogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3Qgb3duZXIKCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgIHRydWUgdG8gZGlzYWJsZSB0cmFuc2ZlcnMsIGZhbHNlIHRvIGVuYWJsZSB0aGVtCiAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZVRva2VuVHJhbnNmZXJzKGJvb2wgX2Rpc2FibGUpIHB1YmxpYyBvd25lck9ubHkgewogICAgICAgIHRva2VuLmRpc2FibGVUcmFuc2ZlcnMoX2Rpc2FibGUpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgd2l0aGRyYXdzIHRva2VucyBoZWxkIGJ5IHRoZSB0b2tlbiBhbmQgc2VuZHMgdGhlbSB0byBhbiBhY2NvdW50CiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lcgoKICAgICAgICBAcGFyYW0gX3Rva2VuICAgRVJDMjAgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfdG8gICAgICBhY2NvdW50IHRvIHJlY2VpdmUgdGhlIG5ldyBhbW91bnQKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgYW1vdW50IHRvIHdpdGhkcmF3CiAgICAqLwogICAgZnVuY3Rpb24gd2l0aGRyYXdGcm9tVG9rZW4oSUVSQzIwVG9rZW4gX3Rva2VuLCBhZGRyZXNzIF90bywgdWludDI1NiBfYW1vdW50KSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICBJVG9rZW5Ib2xkZXIodG9rZW4pLndpdGhkcmF3VG9rZW5zKF90b2tlbiwgX3RvLCBfYW1vdW50KTsKICAgIH0KfQoKCi8qCiAgICBQcm92aWRlcyBzdXBwb3J0IGFuZCB1dGlsaXRpZXMgZm9yIGNvbnRyYWN0IG1hbmFnZW1lbnQKKi8KY29udHJhY3QgTWFuYWdlZCB7CiAgICBhZGRyZXNzIHB1YmxpYyBtYW5hZ2VyOwogICAgYWRkcmVzcyBwdWJsaWMgbmV3TWFuYWdlcjsKCiAgICBldmVudCBNYW5hZ2VyVXBkYXRlKGFkZHJlc3MgX3ByZXZNYW5hZ2VyLCBhZGRyZXNzIF9uZXdNYW5hZ2VyKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gTWFuYWdlZCgpIHsKICAgICAgICBtYW5hZ2VyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICAvLyBhbGxvd3MgZXhlY3V0aW9uIGJ5IHRoZSBtYW5hZ2VyIG9ubHkKICAgIG1vZGlmaWVyIG1hbmFnZXJPbmx5IHsKICAgICAgICBhc3NlcnQobXNnLnNlbmRlciA9PSBtYW5hZ2VyKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgYWxsb3dzIHRyYW5zZmVycmluZyB0aGUgY29udHJhY3QgbWFuYWdlbWVudAogICAgICAgIHRoZSBuZXcgbWFuYWdlciBzdGlsbCBuZWVkcyB0byBhY2NlcHQgdGhlIHRyYW5zZmVyCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBjb250cmFjdCBtYW5hZ2VyCgogICAgICAgIEBwYXJhbSBfbmV3TWFuYWdlciAgICBuZXcgY29udHJhY3QgbWFuYWdlcgogICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyTWFuYWdlbWVudChhZGRyZXNzIF9uZXdNYW5hZ2VyKSBwdWJsaWMgbWFuYWdlck9ubHkgewogICAgICAgIHJlcXVpcmUoX25ld01hbmFnZXIgIT0gbWFuYWdlcik7CiAgICAgICAgbmV3TWFuYWdlciA9IF9uZXdNYW5hZ2VyOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXNlZCBieSBhIG5ldyBtYW5hZ2VyIHRvIGFjY2VwdCBhIG1hbmFnZW1lbnQgdHJhbnNmZXIKICAgICovCiAgICBmdW5jdGlvbiBhY2NlcHRNYW5hZ2VtZW50KCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbmV3TWFuYWdlcik7CiAgICAgICAgTWFuYWdlclVwZGF0ZShtYW5hZ2VyLCBuZXdNYW5hZ2VyKTsKICAgICAgICBtYW5hZ2VyID0gbmV3TWFuYWdlcjsKICAgICAgICBuZXdNYW5hZ2VyID0gMHgwOwogICAgfQp9CgoKLyoKICAgIEVJUDIyOCBUb2tlbiBDb252ZXJ0ZXIgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElUb2tlbkNvbnZlcnRlciB7CiAgICBmdW5jdGlvbiBjb252ZXJ0aWJsZVRva2VuQ291bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDE2KTsKICAgIGZ1bmN0aW9uIGNvbnZlcnRpYmxlVG9rZW4odWludDE2IF90b2tlbkluZGV4KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYWRkcmVzcyk7CiAgICBmdW5jdGlvbiBnZXRSZXR1cm4oSUVSQzIwVG9rZW4gX2Zyb21Ub2tlbiwgSUVSQzIwVG9rZW4gX3RvVG9rZW4sIHVpbnQyNTYgX2Ftb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gY29udmVydChJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKICAgIC8vIGRlcHJlY2F0ZWQsIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkKICAgIGZ1bmN0aW9uIGNoYW5nZShJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KTsKfQoKCi8qCiAgICBCYW5jb3IgRm9ybXVsYSBpbnRlcmZhY2UKKi8KY29udHJhY3QgSUJhbmNvckZvcm11bGEgewogICAgZnVuY3Rpb24gY2FsY3VsYXRlUHVyY2hhc2VSZXR1cm4odWludDI1NiBfc3VwcGx5LCB1aW50MjU2IF9jb25uZWN0b3JCYWxhbmNlLCB1aW50MzIgX2Nvbm5lY3RvcldlaWdodCwgdWludDI1NiBfZGVwb3NpdEFtb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gY2FsY3VsYXRlU2FsZVJldHVybih1aW50MjU2IF9zdXBwbHksIHVpbnQyNTYgX2Nvbm5lY3RvckJhbGFuY2UsIHVpbnQzMiBfY29ubmVjdG9yV2VpZ2h0LCB1aW50MjU2IF9zZWxsQW1vdW50KSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7Cn0KCgovKgogICAgQmFuY29yIEdhcyBQcmljZSBMaW1pdCBpbnRlcmZhY2UKKi8KY29udHJhY3QgSUJhbmNvckdhc1ByaWNlTGltaXQgewogICAgZnVuY3Rpb24gZ2FzUHJpY2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nikge30KfQoKCi8qCiAgICBUaGUgQmFuY29yR2FzUHJpY2VMaW1pdCBjb250cmFjdCBzZXJ2ZXMgYXMgYW4gZXh0cmEgZnJvbnQtcnVubmluZyBhdHRhY2sgbWl0aWdhdGlvbiBtZWNoYW5pc20uCiAgICBJdCBzZXRzIGEgbWF4aW11bSBnYXMgcHJpY2Ugb24gYWxsIGJhbmNvciBjb252ZXJzaW9ucywgd2hpY2ggcHJldmVudHMgdXNlcnMgZnJvbSAiY3V0dGluZyBpbiBsaW5lIgogICAgaW4gb3JkZXIgdG8gZnJvbnQtcnVuIG90aGVyIHRyYW5zYWN0aW9ucy4KICAgIFRoZSBnYXMgcHJpY2UgbGltaXQgaXMgdW5pdmVyc2FsIHRvIGFsbCBjb252ZXJ0ZXJzIGFuZCBpdCBjYW4gYmUgdXBkYXRlZCBieSB0aGUgb3duZXIgdG8gYmUgaW4gbGluZQogICAgd2l0aCB0aGUgbmV0d29yaydzIGN1cnJlbnQgZ2FzIHByaWNlLgoqLwpjb250cmFjdCBCYW5jb3JHYXNQcmljZUxpbWl0IGlzIElCYW5jb3JHYXNQcmljZUxpbWl0LCBPd25lZCwgVXRpbHMgewogICAgdWludDI1NiBwdWJsaWMgZ2FzUHJpY2UgPSAwIHdlaTsgICAgLy8gbWF4aW11bSBnYXMgcHJpY2UgZm9yIGJhbmNvciB0cmFuc2FjdGlvbnMKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSBfZ2FzUHJpY2UgICAgZ2FzIHByaWNlIGxpbWl0CiAgICAqLwogICAgZnVuY3Rpb24gQmFuY29yR2FzUHJpY2VMaW1pdCh1aW50MjU2IF9nYXNQcmljZSkKICAgICAgICBncmVhdGVyVGhhblplcm8oX2dhc1ByaWNlKQogICAgewogICAgICAgIGdhc1ByaWNlID0gX2dhc1ByaWNlOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG93bmVyIHRvIHVwZGF0ZSB0aGUgZ2FzIHByaWNlIGxpbWl0CgogICAgICAgIEBwYXJhbSBfZ2FzUHJpY2UgICAgbmV3IGdhcyBwcmljZSBsaW1pdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldEdhc1ByaWNlKHVpbnQyNTYgX2dhc1ByaWNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfZ2FzUHJpY2UpCiAgICB7CiAgICAgICAgZ2FzUHJpY2UgPSBfZ2FzUHJpY2U7CiAgICB9Cn0KCgovKgogICAgQmFuY29yIFF1aWNrIENvbnZlcnRlciBpbnRlcmZhY2UKKi8KY29udHJhY3QgSUJhbmNvclF1aWNrQ29udmVydGVyIHsKICAgIGZ1bmN0aW9uIGNvbnZlcnQoSUVSQzIwVG9rZW5bXSBfcGF0aCwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQyNTYpOwogICAgZnVuY3Rpb24gY29udmVydEZvcihJRVJDMjBUb2tlbltdIF9wYXRoLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybiwgYWRkcmVzcyBfZm9yKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50MjU2KTsKfQoKCi8qCiAgICBCYW5jb3IgQ29udmVydGVyIEV4dGVuc2lvbnMgaW50ZXJmYWNlCiovCmNvbnRyYWN0IElCYW5jb3JDb252ZXJ0ZXJFeHRlbnNpb25zIHsKICAgIGZ1bmN0aW9uIGZvcm11bGEoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoSUJhbmNvckZvcm11bGEpIHt9CiAgICBmdW5jdGlvbiBnYXNQcmljZUxpbWl0KCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKElCYW5jb3JHYXNQcmljZUxpbWl0KSB7fQogICAgZnVuY3Rpb24gcXVpY2tDb252ZXJ0ZXIoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoSUJhbmNvclF1aWNrQ29udmVydGVyKSB7fQp9CgoKCi8qCiAgICBFdGhlciBUb2tlbiBpbnRlcmZhY2UKKi8KY29udHJhY3QgSUV0aGVyVG9rZW4gaXMgSVRva2VuSG9sZGVyLCBJRVJDMjBUb2tlbiB7CiAgICBmdW5jdGlvbiBkZXBvc2l0KCkgcHVibGljIHBheWFibGU7CiAgICBmdW5jdGlvbiB3aXRoZHJhdyh1aW50MjU2IF9hbW91bnQpIHB1YmxpYzsKICAgIGZ1bmN0aW9uIHdpdGhkcmF3VG8oYWRkcmVzcyBfdG8sIHVpbnQyNTYgX2Ftb3VudCk7Cn0KCgovKgogICAgVGhlIEJhbmNvclF1aWNrQ29udmVydGVyIGNvbnRyYWN0IHByb3ZpZGVzIGFsbG93cyBjb252ZXJ0aW5nIGJldHdlZW4gYW55IHRva2VuIGluIHRoZSAKICAgIGJhbmNvciBuZXR3b3JrIGluIGEgc2luZ2xlIHRyYW5zYWN0aW9uLgoKICAgIEEgbm90ZSBvbiBjb252ZXJzaW9uIHBhdGhzIC0KICAgIENvbnZlcnNpb24gcGF0aCBpcyBhIGRhdGEgc3RydWN0dXJlIHRoYXQncyB1c2VkIHdoZW4gY29udmVydGluZyBhIHRva2VuIHRvIGFub3RoZXIgdG9rZW4gaW4gdGhlIGJhbmNvciBuZXR3b3JrCiAgICB3aGVuIHRoZSBjb252ZXJzaW9uIGNhbm5vdCBuZWNlc3NhcmlseSBiZSBkb25lIGJ5IHNpbmdsZSBjb252ZXJ0ZXIgYW5kIG1pZ2h0IHJlcXVpcmUgbXVsdGlwbGUgJ2hvcHMnLgogICAgVGhlIHBhdGggZGVmaW5lcyB3aGljaCBjb252ZXJ0ZXJzIHNob3VsZCBiZSB1c2VkIGFuZCB3aGF0IGtpbmQgb2YgY29udmVyc2lvbiBzaG91bGQgYmUgZG9uZSBpbiBlYWNoIHN0ZXAuCgogICAgVGhlIHBhdGggZm9ybWF0IGRvZXNuJ3QgaW5jbHVkZSBjb21wbGV4IHN0cnVjdHVyZSBhbmQgaW5zdGVhZCwgaXQgaXMgcmVwcmVzZW50ZWQgYnkgYSBzaW5nbGUgYXJyYXkKICAgIGluIHdoaWNoIGVhY2ggJ2hvcCcgaXMgcmVwcmVzZW50ZWQgYnkgYSAyLXR1cGxlIC0gc21hcnQgdG9rZW4gJiB0byB0b2tlbi4KICAgIEluIGFkZGl0aW9uLCB0aGUgZmlyc3QgZWxlbWVudCBpcyBhbHdheXMgdGhlIHNvdXJjZSB0b2tlbi4KICAgIFRoZSBzbWFydCB0b2tlbiBpcyBvbmx5IHVzZWQgYXMgYSBwb2ludGVyIHRvIGEgY29udmVydGVyIChzaW5jZSBjb252ZXJ0ZXIgYWRkcmVzc2VzIGFyZSBtb3JlIGxpa2VseSB0byBjaGFuZ2UpLgoKICAgIEZvcm1hdDoKICAgIFtzb3VyY2UgdG9rZW4sIHNtYXJ0IHRva2VuLCB0byB0b2tlbiwgc21hcnQgdG9rZW4sIHRvIHRva2VuLi4uXQoqLwpjb250cmFjdCBCYW5jb3JRdWlja0NvbnZlcnRlciBpcyBJQmFuY29yUXVpY2tDb252ZXJ0ZXIsIFRva2VuSG9sZGVyIHsKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gYm9vbCkgcHVibGljIGV0aGVyVG9rZW5zOyAgIC8vIGxpc3Qgb2YgYWxsIHN1cHBvcnRlZCBldGhlciB0b2tlbnMKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gQmFuY29yUXVpY2tDb252ZXJ0ZXIoKSB7CiAgICB9CgogICAgLy8gdmFsaWRhdGVzIGEgY29udmVyc2lvbiBwYXRoIC0gdmVyaWZpZXMgdGhhdCB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGlzIG9kZCBhbmQgdGhhdCBtYXhpbXVtIG51bWJlciBvZiAnaG9wcycgaXMgMTAKICAgIG1vZGlmaWVyIHZhbGlkQ29udmVyc2lvblBhdGgoSUVSQzIwVG9rZW5bXSBfcGF0aCkgewogICAgICAgIHJlcXVpcmUoX3BhdGgubGVuZ3RoID4gMiAmJiBfcGF0aC5sZW5ndGggPD0gKDEgKyAyICogMTApICYmIF9wYXRoLmxlbmd0aCAlIDIgPT0gMSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGFsbG93cyB0aGUgb3duZXIgdG8gcmVnaXN0ZXIvdW5yZWdpc3RlciBldGhlciB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF90b2tlbiAgICAgICBldGhlciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9yZWdpc3RlciAgICB0cnVlIHRvIHJlZ2lzdGVyLCBmYWxzZSB0byB1bnJlZ2lzdGVyCiAgICAqLwogICAgZnVuY3Rpb24gcmVnaXN0ZXJFdGhlclRva2VuKElFdGhlclRva2VuIF90b2tlbiwgYm9vbCBfcmVnaXN0ZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgICAgICBub3RUaGlzKF90b2tlbikKICAgIHsKICAgICAgICBldGhlclRva2Vuc1tfdG9rZW5dID0gX3JlZ2lzdGVyOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgdGhlIHRva2VuIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsgYnkgZm9sbG93aW5nCiAgICAgICAgYSBwcmVkZWZpbmVkIGNvbnZlcnNpb24gcGF0aCBhbmQgdHJhbnNmZXJzIHRoZSByZXN1bHQgdG9rZW5zIHRvIGEgdGFyZ2V0IGFjY291bnQKICAgICAgICBub3RlIHRoYXQgdGhlIGNvbnZlcnRlciBzaG91bGQgYWxyZWFkeSBvd24gdGhlIHNvdXJjZSB0b2tlbnMKCiAgICAgICAgQHBhcmFtIF9wYXRoICAgICAgICBjb252ZXJzaW9uIHBhdGgsIHNlZSBjb252ZXJzaW9uIHBhdGggZm9ybWF0IGFib3ZlCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgICBhbW91bnQgdG8gY29udmVydCBmcm9tIChpbiB0aGUgaW5pdGlhbCBzb3VyY2UgdG9rZW4pCiAgICAgICAgQHBhcmFtIF9taW5SZXR1cm4gICBpZiB0aGUgY29udmVyc2lvbiByZXN1bHRzIGluIGFuIGFtb3VudCBzbWFsbGVyIHRoYW4gdGhlIG1pbmltdW0gcmV0dXJuIC0gaXQgaXMgY2FuY2VsbGVkLCBtdXN0IGJlIG5vbnplcm8KICAgICAgICBAcGFyYW0gX2ZvciAgICAgICAgIGFjY291bnQgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIGNvbnZlcnNpb24gcmVzdWx0CgogICAgICAgIEByZXR1cm4gdG9rZW5zIGlzc3VlZCBpbiByZXR1cm4KICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0Rm9yKElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuLCBhZGRyZXNzIF9mb3IpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIHZhbGlkQ29udmVyc2lvblBhdGgoX3BhdGgpCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBpZiBFVEggaXMgcHJvdmlkZWQsIGVuc3VyZSB0aGF0IHRoZSBhbW91bnQgaXMgaWRlbnRpY2FsIHRvIF9hbW91bnQgYW5kIHZlcmlmeSB0aGF0IHRoZSBzb3VyY2UgdG9rZW4gaXMgYW4gZXRoZXIgdG9rZW4KICAgICAgICBJRVJDMjBUb2tlbiBmcm9tVG9rZW4gPSBfcGF0aFswXTsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSA9PSAwIHx8IChfYW1vdW50ID09IG1zZy52YWx1ZSAmJiBldGhlclRva2Vuc1tmcm9tVG9rZW5dKSk7CgogICAgICAgIElTbWFydFRva2VuIHNtYXJ0VG9rZW47CiAgICAgICAgSUVSQzIwVG9rZW4gdG9Ub2tlbjsKICAgICAgICBJVG9rZW5Db252ZXJ0ZXIgY29udmVydGVyOwogICAgICAgIHVpbnQyNTYgcGF0aExlbmd0aCA9IF9wYXRoLmxlbmd0aDsKCiAgICAgICAgLy8gaWYgRVRIIHdhcyBzZW50IHdpdGggdGhlIGNhbGwsIHRoZSBzb3VyY2UgaXMgYW4gZXRoZXIgdG9rZW4gLSBkZXBvc2l0IHRoZSBFVEggaW4gaXQKICAgICAgICAvLyBvdGhlcndpc2UsIHdlIGFzc3VtZSB3ZSBhbHJlYWR5IGhhdmUgdGhlIHRva2VucwogICAgICAgIGlmIChtc2cudmFsdWUgPiAwKQogICAgICAgICAgICBJRXRoZXJUb2tlbihmcm9tVG9rZW4pLmRlcG9zaXQudmFsdWUobXNnLnZhbHVlKSgpOwoKICAgICAgICAvLyBpdGVyYXRlIG92ZXIgdGhlIGNvbnZlcnNpb24gcGF0aAogICAgICAgIGZvciAodWludDI1NiBpID0gMTsgaSA8IHBhdGhMZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICBzbWFydFRva2VuID0gSVNtYXJ0VG9rZW4oX3BhdGhbaV0pOwogICAgICAgICAgICB0b1Rva2VuID0gX3BhdGhbaSArIDFdOwogICAgICAgICAgICBjb252ZXJ0ZXIgPSBJVG9rZW5Db252ZXJ0ZXIoc21hcnRUb2tlbi5vd25lcigpKTsKCiAgICAgICAgICAgIC8vIGlmIHRoZSBzbWFydCB0b2tlbiBpc24ndCB0aGUgc291cmNlIChmcm9tIHRva2VuKSwgdGhlIGNvbnZlcnRlciBkb2Vzbid0IGhhdmUgY29udHJvbCBvdmVyIGl0IGFuZCB0aHVzIHdlIG5lZWQgdG8gYXBwcm92ZSB0aGUgcmVxdWVzdAogICAgICAgICAgICBpZiAoc21hcnRUb2tlbiAhPSBmcm9tVG9rZW4pCiAgICAgICAgICAgICAgICBlbnN1cmVBbGxvd2FuY2UoZnJvbVRva2VuLCBjb252ZXJ0ZXIsIF9hbW91bnQpOwoKICAgICAgICAgICAgLy8gbWFrZSB0aGUgY29udmVyc2lvbiAtIGlmIGl0J3MgdGhlIGxhc3Qgb25lLCBhbHNvIHByb3ZpZGUgdGhlIG1pbmltdW0gcmV0dXJuIHZhbHVlCiAgICAgICAgICAgIF9hbW91bnQgPSBjb252ZXJ0ZXIuY2hhbmdlKGZyb21Ub2tlbiwgdG9Ub2tlbiwgX2Ftb3VudCwgaSA9PSBwYXRoTGVuZ3RoIC0gMiA/IF9taW5SZXR1cm4gOiAxKTsKICAgICAgICAgICAgZnJvbVRva2VuID0gdG9Ub2tlbjsKICAgICAgICB9CgogICAgICAgIC8vIGZpbmlzaGVkIHRoZSBjb252ZXJzaW9uLCB0cmFuc2ZlciB0aGUgZnVuZHMgdG8gdGhlIHRhcmdldCBhY2NvdW50CiAgICAgICAgLy8gaWYgdGhlIHRhcmdldCB0b2tlbiBpcyBhbiBldGhlciB0b2tlbiwgd2l0aGRyYXcgdGhlIHRva2VucyBhbmQgc2VuZCB0aGVtIGFzIEVUSAogICAgICAgIC8vIG90aGVyd2lzZSwgdHJhbnNmZXIgdGhlIHRva2VucyBhcyBpcwogICAgICAgIGlmIChldGhlclRva2Vuc1t0b1Rva2VuXSkKICAgICAgICAgICAgSUV0aGVyVG9rZW4odG9Ub2tlbikud2l0aGRyYXdUbyhfZm9yLCBfYW1vdW50KTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFzc2VydCh0b1Rva2VuLnRyYW5zZmVyKF9mb3IsIF9hbW91bnQpKTsKCiAgICAgICAgcmV0dXJuIF9hbW91bnQ7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBjbGFpbXMgdGhlIGNhbGxlcidzIHRva2VucywgY29udmVydHMgdGhlbSB0byBhbnkgb3RoZXIgdG9rZW4gaW4gdGhlIGJhbmNvciBuZXR3b3JrCiAgICAgICAgYnkgZm9sbG93aW5nIGEgcHJlZGVmaW5lZCBjb252ZXJzaW9uIHBhdGggYW5kIHRyYW5zZmVycyB0aGUgcmVzdWx0IHRva2VucyB0byBhIHRhcmdldCBhY2NvdW50CiAgICAgICAgbm90ZSB0aGF0IGFsbG93YW5jZSBtdXN0IGJlIHNldCBiZWZvcmVoYW5kCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICAgICAgY29udmVyc2lvbiBwYXRoLCBzZWUgY29udmVyc2lvbiBwYXRoIGZvcm1hdCBhYm92ZQogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICAgYW1vdW50IHRvIGNvbnZlcnQgZnJvbSAoaW4gdGhlIGluaXRpYWwgc291cmNlIHRva2VuKQogICAgICAgIEBwYXJhbSBfbWluUmV0dXJuICAgaWYgdGhlIGNvbnZlcnNpb24gcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCiAgICAgICAgQHBhcmFtIF9mb3IgICAgICAgICBhY2NvdW50IHRoYXQgd2lsbCByZWNlaXZlIHRoZSBjb252ZXJzaW9uIHJlc3VsdAoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BbmRDb252ZXJ0Rm9yKElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuLCBhZGRyZXNzIF9mb3IpIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgLy8gd2UgbmVlZCB0byB0cmFuc2ZlciB0aGUgdG9rZW5zIGZyb20gdGhlIGNhbGxlciB0byB0aGUgY29udmVydGVyIGJlZm9yZSB3ZSBmb2xsb3cKICAgICAgICAvLyB0aGUgY29udmVyc2lvbiBwYXRoLCB0byBhbGxvdyBpdCB0byBleGVjdXRlIHRoZSBjb252ZXJzaW9uIG9uIGJlaGFsZiBvZiB0aGUgY2FsbGVyCiAgICAgICAgLy8gbm90ZTogd2UgYXNzdW1lIHdlIGFscmVhZHkgaGF2ZSBhbGxvd2FuY2UKICAgICAgICBJRVJDMjBUb2tlbiBmcm9tVG9rZW4gPSBfcGF0aFswXTsKICAgICAgICBhc3NlcnQoZnJvbVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCB0aGlzLCBfYW1vdW50KSk7CiAgICAgICAgcmV0dXJuIGNvbnZlcnRGb3IoX3BhdGgsIF9hbW91bnQsIF9taW5SZXR1cm4sIF9mb3IpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgdGhlIHRva2VuIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsgYnkgZm9sbG93aW5nCiAgICAgICAgYSBwcmVkZWZpbmVkIGNvbnZlcnNpb24gcGF0aCBhbmQgdHJhbnNmZXJzIHRoZSByZXN1bHQgdG9rZW5zIGJhY2sgdG8gdGhlIHNlbmRlcgogICAgICAgIG5vdGUgdGhhdCB0aGUgY29udmVydGVyIHNob3VsZCBhbHJlYWR5IG93biB0aGUgc291cmNlIHRva2VucwoKICAgICAgICBAcGFyYW0gX3BhdGggICAgICAgIGNvbnZlcnNpb24gcGF0aCwgc2VlIGNvbnZlcnNpb24gcGF0aCBmb3JtYXQgYWJvdmUKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgIGFtb3VudCB0byBjb252ZXJ0IGZyb20gKGluIHRoZSBpbml0aWFsIHNvdXJjZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgIGlmIHRoZSBjb252ZXJzaW9uIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydChJRVJDMjBUb2tlbltdIF9wYXRoLCB1aW50MjU2IF9hbW91bnQsIHVpbnQyNTYgX21pblJldHVybikgcHVibGljIHBheWFibGUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjb252ZXJ0Rm9yKF9wYXRoLCBfYW1vdW50LCBfbWluUmV0dXJuLCBtc2cuc2VuZGVyKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGNsYWltcyB0aGUgY2FsbGVyJ3MgdG9rZW5zLCBjb252ZXJ0cyB0aGVtIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsKICAgICAgICBieSBmb2xsb3dpbmcgYSBwcmVkZWZpbmVkIGNvbnZlcnNpb24gcGF0aCBhbmQgdHJhbnNmZXJzIHRoZSByZXN1bHQgdG9rZW5zIGJhY2sgdG8gdGhlIHNlbmRlcgogICAgICAgIG5vdGUgdGhhdCBhbGxvd2FuY2UgbXVzdCBiZSBzZXQgYmVmb3JlaGFuZAoKICAgICAgICBAcGFyYW0gX3BhdGggICAgICAgIGNvbnZlcnNpb24gcGF0aCwgc2VlIGNvbnZlcnNpb24gcGF0aCBmb3JtYXQgYWJvdmUKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgIGFtb3VudCB0byBjb252ZXJ0IGZyb20gKGluIHRoZSBpbml0aWFsIHNvdXJjZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgIGlmIHRoZSBjb252ZXJzaW9uIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gY2xhaW1BbmRDb252ZXJ0KElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuKSBwdWJsaWMgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBjbGFpbUFuZENvbnZlcnRGb3IoX3BhdGgsIF9hbW91bnQsIF9taW5SZXR1cm4sIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXRpbGl0eSwgY2hlY2tzIHdoZXRoZXIgYWxsb3dhbmNlIGZvciB0aGUgZ2l2ZW4gc3BlbmRlciBleGlzdHMgYW5kIGFwcHJvdmVzIG9uZSBpZiBpdCBkb2Vzbid0CgogICAgICAgIEBwYXJhbSBfdG9rZW4gICB0b2tlbiB0byBjaGVjayB0aGUgYWxsb3dhbmNlIGluCiAgICAgICAgQHBhcmFtIF9zcGVuZGVyIGFwcHJvdmVkIGFkZHJlc3MKICAgICAgICBAcGFyYW0gX3ZhbHVlICAgYWxsb3dhbmNlIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIGVuc3VyZUFsbG93YW5jZShJRVJDMjBUb2tlbiBfdG9rZW4sIGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBwcml2YXRlIHsKICAgICAgICAvLyBjaGVjayBpZiBhbGxvd2FuY2UgZm9yIHRoZSBnaXZlbiBhbW91bnQgYWxyZWFkeSBleGlzdHMKICAgICAgICBpZiAoX3Rva2VuLmFsbG93YW5jZSh0aGlzLCBfc3BlbmRlcikgPj0gX3ZhbHVlKQogICAgICAgICAgICByZXR1cm47CgogICAgICAgIC8vIGlmIHRoZSBhbGxvd2FuY2UgaXMgbm9uemVybywgbXVzdCByZXNldCBpdCB0byAwIGZpcnN0CiAgICAgICAgaWYgKF90b2tlbi5hbGxvd2FuY2UodGhpcywgX3NwZW5kZXIpICE9IDApCiAgICAgICAgICAgIGFzc2VydChfdG9rZW4uYXBwcm92ZShfc3BlbmRlciwgMCkpOwoKICAgICAgICAvLyBhcHByb3ZlIHRoZSBuZXcgYWxsb3dhbmNlCiAgICAgICAgYXNzZXJ0KF90b2tlbi5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpKTsKICAgIH0KfQoKCi8qKgogICAgQGRldiB0aGUgQmFuY29yQ29udmVydGVyRXh0ZW5zaW9ucyBjb250cmFjdCBpcyBhbiBvd25lZCBjb250cmFjdCB0aGF0IHNlcnZlcyBhcyBhIHNpbmdsZSBwb2ludCBvZiBhY2Nlc3MKICAgIHRvIHRoZSBCYW5jb3JGb3JtdWxhLCBCYW5jb3JHYXNQcmljZUxpbWl0IGFuZCBCYW5jb3JRdWlja0NvbnZlcnRlciBjb250cmFjdHMgZnJvbSBhbGwgQmFuY29yQ29udmVydGVyIGNvbnRyYWN0IGluc3RhbmNlcy4KICAgIGl0IGFsbG93cyB1cGdyYWRpbmcgdGhlc2UgY29udHJhY3RzIHdpdGhvdXQgdGhlIG5lZWQgdG8gdXBkYXRlIGVhY2ggYW5kIGV2ZXJ5CiAgICBCYW5jb3JDb252ZXJ0ZXIgY29udHJhY3QgaW5zdGFuY2UgaW5kaXZpZHVhbGx5LgoqLwpjb250cmFjdCBCYW5jb3JDb252ZXJ0ZXJFeHRlbnNpb25zIGlzIElCYW5jb3JDb252ZXJ0ZXJFeHRlbnNpb25zLCBUb2tlbkhvbGRlciB7CiAgICBJQmFuY29yRm9ybXVsYSBwdWJsaWMgZm9ybXVsYTsgIC8vIGJhbmNvciBjYWxjdWxhdGlvbiBmb3JtdWxhIGNvbnRyYWN0CiAgICBJQmFuY29yR2FzUHJpY2VMaW1pdCBwdWJsaWMgZ2FzUHJpY2VMaW1pdDsgLy8gYmFuY29yIHVuaXZlcnNhbCBnYXMgcHJpY2UgbGltaXQgY29udHJhY3QKICAgIElCYW5jb3JRdWlja0NvbnZlcnRlciBwdWJsaWMgcXVpY2tDb252ZXJ0ZXI7IC8vIGJhbmNvciBxdWljayBjb252ZXJ0ZXIgY29udHJhY3QKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSBfZm9ybXVsYSAgICAgICAgIGFkZHJlc3Mgb2YgYSBiYW5jb3IgZm9ybXVsYSBjb250cmFjdAogICAgICAgIEBwYXJhbSBfZ2FzUHJpY2VMaW1pdCAgIGFkZHJlc3Mgb2YgYSBiYW5jb3IgZ2FzIHByaWNlIGxpbWl0IGNvbnRyYWN0CiAgICAgICAgQHBhcmFtIF9xdWlja0NvbnZlcnRlciAgYWRkcmVzcyBvZiBhIGJhbmNvciBxdWljayBjb252ZXJ0ZXIgY29udHJhY3QKICAgICovCiAgICBmdW5jdGlvbiBCYW5jb3JDb252ZXJ0ZXJFeHRlbnNpb25zKElCYW5jb3JGb3JtdWxhIF9mb3JtdWxhLCBJQmFuY29yR2FzUHJpY2VMaW1pdCBfZ2FzUHJpY2VMaW1pdCwgSUJhbmNvclF1aWNrQ29udmVydGVyIF9xdWlja0NvbnZlcnRlcikKICAgICAgICB2YWxpZEFkZHJlc3MoX2Zvcm11bGEpCiAgICAgICAgdmFsaWRBZGRyZXNzKF9nYXNQcmljZUxpbWl0KQogICAgICAgIHZhbGlkQWRkcmVzcyhfcXVpY2tDb252ZXJ0ZXIpCiAgICB7CiAgICAgICAgZm9ybXVsYSA9IF9mb3JtdWxhOwogICAgICAgIGdhc1ByaWNlTGltaXQgPSBfZ2FzUHJpY2VMaW1pdDsKICAgICAgICBxdWlja0NvbnZlcnRlciA9IF9xdWlja0NvbnZlcnRlcjsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgYWxsb3dzIHRoZSBvd25lciB0byB1cGRhdGUgdGhlIGZvcm11bGEgY29udHJhY3QgYWRkcmVzcwoKICAgICAgICBAcGFyYW0gX2Zvcm11bGEgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBmb3JtdWxhIGNvbnRyYWN0CiAgICAqLwogICAgZnVuY3Rpb24gc2V0Rm9ybXVsYShJQmFuY29yRm9ybXVsYSBfZm9ybXVsYSkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZEFkZHJlc3MoX2Zvcm11bGEpCiAgICAgICAgbm90VGhpcyhfZm9ybXVsYSkKICAgIHsKICAgICAgICBmb3JtdWxhID0gX2Zvcm11bGE7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IGFsbG93cyB0aGUgb3duZXIgdG8gdXBkYXRlIHRoZSBnYXMgcHJpY2UgbGltaXQgY29udHJhY3QgYWRkcmVzcwoKICAgICAgICBAcGFyYW0gX2dhc1ByaWNlTGltaXQgICBhZGRyZXNzIG9mIGEgYmFuY29yIGdhcyBwcmljZSBsaW1pdCBjb250cmFjdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldEdhc1ByaWNlTGltaXQoSUJhbmNvckdhc1ByaWNlTGltaXQgX2dhc1ByaWNlTGltaXQpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF9nYXNQcmljZUxpbWl0KQogICAgICAgIG5vdFRoaXMoX2dhc1ByaWNlTGltaXQpCiAgICB7CiAgICAgICAgZ2FzUHJpY2VMaW1pdCA9IF9nYXNQcmljZUxpbWl0OwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG93bmVyIHRvIHVwZGF0ZSB0aGUgcXVpY2sgY29udmVydGVyIGNvbnRyYWN0IGFkZHJlc3MKCiAgICAgICAgQHBhcmFtIF9xdWlja0NvbnZlcnRlciAgYWRkcmVzcyBvZiBhIGJhbmNvciBxdWljayBjb252ZXJ0ZXIgY29udHJhY3QKICAgICovCiAgICBmdW5jdGlvbiBzZXRRdWlja0NvbnZlcnRlcihJQmFuY29yUXVpY2tDb252ZXJ0ZXIgX3F1aWNrQ29udmVydGVyKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQWRkcmVzcyhfcXVpY2tDb252ZXJ0ZXIpCiAgICAgICAgbm90VGhpcyhfcXVpY2tDb252ZXJ0ZXIpCiAgICB7CiAgICAgICAgcXVpY2tDb252ZXJ0ZXIgPSBfcXVpY2tDb252ZXJ0ZXI7CiAgICB9Cn0KCi8qCiAgICBCYW5jb3IgQ29udmVydGVyIHYwLjQKCiAgICBUaGUgQmFuY29yIHZlcnNpb24gb2YgdGhlIHRva2VuIGNvbnZlcnRlciwgYWxsb3dzIGNvbnZlcnNpb24gYmV0d2VlbiBhIHNtYXJ0IHRva2VuIGFuZCBvdGhlciBFUkMyMCB0b2tlbnMgYW5kIGJldHdlZW4gZGlmZmVyZW50IEVSQzIwIHRva2VucyBhbmQgdGhlbXNlbHZlcy4KCiAgICBFUkMyMCBjb25uZWN0b3IgYmFsYW5jZSBjYW4gYmUgdmlydHVhbCwgbWVhbmluZyB0aGF0IHRoZSBjYWxjdWxhdGlvbnMgYXJlIGJhc2VkIG9uIHRoZSB2aXJ0dWFsIGJhbGFuY2UgaW5zdGVhZCBvZiByZWx5aW5nIG9uCiAgICB0aGUgYWN0dWFsIGNvbm5lY3RvciBiYWxhbmNlLiBUaGlzIGlzIGEgc2VjdXJpdHkgbWVjaGFuaXNtIHRoYXQgcHJldmVudHMgdGhlIG5lZWQgdG8ga2VlcCBhIHZlcnkgbGFyZ2UgKGFuZCB2YWx1YWJsZSkgYmFsYW5jZSBpbiBhIHNpbmdsZSBjb250cmFjdC4KCiAgICBUaGUgY29udmVydGVyIGlzIHVwZ3JhZGFibGUgKGp1c3QgbGlrZSBhbnkgU21hcnRUb2tlbkNvbnRyb2xsZXIpLgoKICAgIFdBUk5JTkc6IEl0IGlzIE5PVCBSRUNPTU1FTkRFRCB0byB1c2UgdGhlIGNvbnZlcnRlciB3aXRoIFNtYXJ0IFRva2VucyB0aGF0IGhhdmUgbGVzcyB0aGFuIDggZGVjaW1hbCBkaWdpdHMKICAgICAgICAgICAgIG9yIHdpdGggdmVyeSBzbWFsbCBudW1iZXJzIGJlY2F1c2Ugb2YgcHJlY2lzaW9uIGxvc3MKCgogICAgT3BlbiBpc3N1ZXM6CiAgICAtIEZyb250LXJ1bm5pbmcgYXR0YWNrcyBhcmUgY3VycmVudGx5IG1pdGlnYXRlZCBieSB0aGUgZm9sbG93aW5nIG1lY2hhbmlzbXM6CiAgICAgICAgLSBtaW5pbXVtIHJldHVybiBhcmd1bWVudCBmb3IgZWFjaCBjb252ZXJzaW9uIHByb3ZpZGVzIGEgd2F5IHRvIGRlZmluZSBhIG1pbmltdW0vbWF4aW11bSBwcmljZSBmb3IgdGhlIHRyYW5zYWN0aW9uCiAgICAgICAgLSBnYXMgcHJpY2UgbGltaXQgcHJldmVudHMgdXNlcnMgZnJvbSBoYXZpbmcgY29udHJvbCBvdmVyIHRoZSBvcmRlciBvZiBleGVjdXRpb24KICAgICAgT3RoZXIgcG90ZW50aWFsIHNvbHV0aW9ucyBtaWdodCBpbmNsdWRlIGEgY29tbWl0L3JldmVhbCBiYXNlZCBzY2hlbWVzCiAgICAtIFBvc3NpYmx5IGFkZCBnZXR0ZXJzIGZvciB0aGUgY29ubmVjdG9yIGZpZWxkcyBzbyB0aGF0IHRoZSBjbGllbnQgd29uJ3QgbmVlZCB0byByZWx5IG9uIHRoZSBvcmRlciBpbiB0aGUgc3RydWN0CiovCmNvbnRyYWN0IEJhbmNvckNvbnZlcnRlciBpcyBJVG9rZW5Db252ZXJ0ZXIsIFNtYXJ0VG9rZW5Db250cm9sbGVyLCBNYW5hZ2VkIHsKICAgIHVpbnQzMiBwcml2YXRlIGNvbnN0YW50IE1BWF9XRUlHSFQgPSAxMDAwMDAwOwogICAgdWludDMyIHByaXZhdGUgY29uc3RhbnQgTUFYX0NPTlZFUlNJT05fRkVFID0gMTAwMDAwMDsKCiAgICBzdHJ1Y3QgQ29ubmVjdG9yIHsKICAgICAgICB1aW50MjU2IHZpcnR1YWxCYWxhbmNlOyAgICAgICAgIC8vIGNvbm5lY3RvciB2aXJ0dWFsIGJhbGFuY2UKICAgICAgICB1aW50MzIgd2VpZ2h0OyAgICAgICAgICAgICAgICAgIC8vIGNvbm5lY3RvciB3ZWlnaHQsIHJlcHJlc2VudGVkIGluIHBwbSwgMS0xMDAwMDAwCiAgICAgICAgYm9vbCBpc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZDsgICAvLyB0cnVlIGlmIHZpcnR1YWwgYmFsYW5jZSBpcyBlbmFibGVkLCBmYWxzZSBpZiBub3QKICAgICAgICBib29sIGlzUHVyY2hhc2VFbmFibGVkOyAgICAgICAgIC8vIGlzIHB1cmNoYXNlIG9mIHRoZSBzbWFydCB0b2tlbiBlbmFibGVkIHdpdGggdGhlIGNvbm5lY3RvciwgY2FuIGJlIHNldCBieSB0aGUgb3duZXIKICAgICAgICBib29sIGlzU2V0OyAgICAgICAgICAgICAgICAgICAgIC8vIHVzZWQgdG8gdGVsbCBpZiB0aGUgbWFwcGluZyBlbGVtZW50IGlzIGRlZmluZWQKICAgIH0KCiAgICBzdHJpbmcgcHVibGljIHZlcnNpb24gPSAnMC41JzsKICAgIHN0cmluZyBwdWJsaWMgY29udmVydGVyVHlwZSA9ICdiYW5jb3InOwoKICAgIElCYW5jb3JDb252ZXJ0ZXJFeHRlbnNpb25zIHB1YmxpYyBleHRlbnNpb25zOyAgICAgICAvLyBiYW5jb3IgY29udmVydGVyIGV4dGVuc2lvbnMgY29udHJhY3QKICAgIElFUkMyMFRva2VuW10gcHVibGljIGNvbm5lY3RvclRva2VuczsgICAgICAgICAgICAgICAvLyBFUkMyMCBzdGFuZGFyZCB0b2tlbiBhZGRyZXNzZXMKICAgIElFUkMyMFRva2VuW10gcHVibGljIHF1aWNrQnV5UGF0aDsgICAgICAgICAgICAgICAgICAvLyBjb252ZXJzaW9uIHBhdGggdGhhdCdzIHVzZWQgaW4gb3JkZXIgdG8gYnV5IHRoZSB0b2tlbiB3aXRoIEVUSAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBDb25uZWN0b3IpIHB1YmxpYyBjb25uZWN0b3JzOyAgIC8vIGNvbm5lY3RvciB0b2tlbiBhZGRyZXNzZXMgLT4gY29ubmVjdG9yIGRhdGEKICAgIHVpbnQzMiBwcml2YXRlIHRvdGFsQ29ubmVjdG9yV2VpZ2h0ID0gMDsgICAgICAgICAgICAvLyB1c2VkIHRvIGVmZmljaWVudGx5IHByZXZlbnQgaW5jcmVhc2luZyB0aGUgdG90YWwgY29ubmVjdG9yIHdlaWdodCBhYm92ZSAxMDAlCiAgICB1aW50MzIgcHVibGljIG1heENvbnZlcnNpb25GZWUgPSAwOyAgICAgICAgICAgICAgICAgLy8gbWF4aW11bSBjb252ZXJzaW9uIGZlZSBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZSBjb250cmFjdCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAwLi4uMTAwMDAwMCAoMCA9IG5vIGZlZSwgMTAwID0gMC4wMSUsIDEwMDAwMDAgPSAxMDAlKQogICAgdWludDMyIHB1YmxpYyBjb252ZXJzaW9uRmVlID0gMDsgICAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgY29udmVyc2lvbiBmZWUsIHJlcHJlc2VudGVkIGluIHBwbSwgMC4uLm1heENvbnZlcnNpb25GZWUKICAgIGJvb2wgcHVibGljIGNvbnZlcnNpb25zRW5hYmxlZCA9IHRydWU7ICAgICAgICAgICAgICAvLyB0cnVlIGlmIHRva2VuIGNvbnZlcnNpb25zIGlzIGVuYWJsZWQsIGZhbHNlIGlmIG5vdAoKICAgIC8vIHRyaWdnZXJlZCB3aGVuIGEgY29udmVyc2lvbiBiZXR3ZWVuIHR3byB0b2tlbnMgb2NjdXJzIChUb2tlbkNvbnZlcnRlciBldmVudCkKICAgIGV2ZW50IENvbnZlcnNpb24oYWRkcmVzcyBpbmRleGVkIF9mcm9tVG9rZW4sIGFkZHJlc3MgaW5kZXhlZCBfdG9Ub2tlbiwgYWRkcmVzcyBpbmRleGVkIF90cmFkZXIsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfcmV0dXJuLAogICAgICAgICAgICAgICAgICAgICB1aW50MjU2IF9jdXJyZW50UHJpY2VOLCB1aW50MjU2IF9jdXJyZW50UHJpY2VEKTsKCiAgICAvKioKICAgICAgICBAZGV2IGNvbnN0cnVjdG9yCgogICAgICAgIEBwYXJhbSAgX3Rva2VuICAgICAgICAgICAgICBzbWFydCB0b2tlbiBnb3Zlcm5lZCBieSB0aGUgY29udmVydGVyCiAgICAgICAgQHBhcmFtICBfZXh0ZW5zaW9ucyAgICAgICAgIGFkZHJlc3Mgb2YgYSBiYW5jb3IgY29udmVydGVyIGV4dGVuc2lvbnMgY29udHJhY3QKICAgICAgICBAcGFyYW0gIF9tYXhDb252ZXJzaW9uRmVlICAgbWF4aW11bSBjb252ZXJzaW9uIGZlZSwgcmVwcmVzZW50ZWQgaW4gcHBtCiAgICAgICAgQHBhcmFtICBfY29ubmVjdG9yVG9rZW4gICAgIG9wdGlvbmFsLCBpbml0aWFsIGNvbm5lY3RvciwgYWxsb3dzIGRlZmluaW5nIHRoZSBmaXJzdCBjb25uZWN0b3IgYXQgZGVwbG95bWVudCB0aW1lCiAgICAgICAgQHBhcmFtICBfY29ubmVjdG9yV2VpZ2h0ICAgIG9wdGlvbmFsLCB3ZWlnaHQgZm9yIHRoZSBpbml0aWFsIGNvbm5lY3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIEJhbmNvckNvbnZlcnRlcihJU21hcnRUb2tlbiBfdG9rZW4sIElCYW5jb3JDb252ZXJ0ZXJFeHRlbnNpb25zIF9leHRlbnNpb25zLCB1aW50MzIgX21heENvbnZlcnNpb25GZWUsIElFUkMyMFRva2VuIF9jb25uZWN0b3JUb2tlbiwgdWludDMyIF9jb25uZWN0b3JXZWlnaHQpCiAgICAgICAgU21hcnRUb2tlbkNvbnRyb2xsZXIoX3Rva2VuKQogICAgICAgIHZhbGlkQWRkcmVzcyhfZXh0ZW5zaW9ucykKICAgICAgICB2YWxpZE1heENvbnZlcnNpb25GZWUoX21heENvbnZlcnNpb25GZWUpCiAgICB7CiAgICAgICAgZXh0ZW5zaW9ucyA9IF9leHRlbnNpb25zOwogICAgICAgIG1heENvbnZlcnNpb25GZWUgPSBfbWF4Q29udmVyc2lvbkZlZTsKCiAgICAgICAgaWYgKGFkZHJlc3MoX2Nvbm5lY3RvclRva2VuKSAhPSAweDApCiAgICAgICAgICAgIGFkZENvbm5lY3RvcihfY29ubmVjdG9yVG9rZW4sIF9jb25uZWN0b3JXZWlnaHQsIGZhbHNlKTsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSBjb25uZWN0b3IgdG9rZW4gYWRkcmVzcyAtIHZlcmlmaWVzIHRoYXQgdGhlIGFkZHJlc3MgYmVsb25ncyB0byBvbmUgb2YgdGhlIGNvbm5lY3RvciB0b2tlbnMKICAgIG1vZGlmaWVyIHZhbGlkQ29ubmVjdG9yKElFUkMyMFRva2VuIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShjb25uZWN0b3JzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSB0b2tlbiBhZGRyZXNzIC0gdmVyaWZpZXMgdGhhdCB0aGUgYWRkcmVzcyBiZWxvbmdzIHRvIG9uZSBvZiB0aGUgY29udmVydGlibGUgdG9rZW5zCiAgICBtb2RpZmllciB2YWxpZFRva2VuKElFUkMyMFRva2VuIF9hZGRyZXNzKSB7CiAgICAgICAgcmVxdWlyZShfYWRkcmVzcyA9PSB0b2tlbiB8fCBjb25uZWN0b3JzW19hZGRyZXNzXS5pc1NldCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2ZXJpZmllcyB0aGF0IHRoZSBnYXMgcHJpY2UgaXMgbG93ZXIgdGhhbiB0aGUgdW5pdmVyc2FsIGxpbWl0CiAgICBtb2RpZmllciB2YWxpZEdhc1ByaWNlKCkgewogICAgICAgIGFzc2VydCh0eC5nYXNwcmljZSA8PSBleHRlbnNpb25zLmdhc1ByaWNlTGltaXQoKS5nYXNQcmljZSgpKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIHZhbGlkYXRlcyBtYXhpbXVtIGNvbnZlcnNpb24gZmVlCiAgICBtb2RpZmllciB2YWxpZE1heENvbnZlcnNpb25GZWUodWludDMyIF9jb252ZXJzaW9uRmVlKSB7CiAgICAgICAgcmVxdWlyZShfY29udmVyc2lvbkZlZSA+PSAwICYmIF9jb252ZXJzaW9uRmVlIDw9IE1BWF9DT05WRVJTSU9OX0ZFRSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgY29udmVyc2lvbiBmZWUKICAgIG1vZGlmaWVyIHZhbGlkQ29udmVyc2lvbkZlZSh1aW50MzIgX2NvbnZlcnNpb25GZWUpIHsKICAgICAgICByZXF1aXJlKF9jb252ZXJzaW9uRmVlID49IDAgJiYgX2NvbnZlcnNpb25GZWUgPD0gbWF4Q29udmVyc2lvbkZlZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgY29ubmVjdG9yIHdlaWdodCByYW5nZQogICAgbW9kaWZpZXIgdmFsaWRDb25uZWN0b3JXZWlnaHQodWludDMyIF93ZWlnaHQpIHsKICAgICAgICByZXF1aXJlKF93ZWlnaHQgPiAwICYmIF93ZWlnaHQgPD0gTUFYX1dFSUdIVCk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLyB2YWxpZGF0ZXMgYSBjb252ZXJzaW9uIHBhdGggLSB2ZXJpZmllcyB0aGF0IHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaXMgb2RkIGFuZCB0aGF0IG1heGltdW0gbnVtYmVyIG9mICdob3BzJyBpcyAxMAogICAgbW9kaWZpZXIgdmFsaWRDb252ZXJzaW9uUGF0aChJRVJDMjBUb2tlbltdIF9wYXRoKSB7CiAgICAgICAgcmVxdWlyZShfcGF0aC5sZW5ndGggPiAyICYmIF9wYXRoLmxlbmd0aCA8PSAoMSArIDIgKiAxMCkgJiYgX3BhdGgubGVuZ3RoICUgMiA9PSAxKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vIGFsbG93cyBleGVjdXRpb24gb25seSB3aGVuIGNvbnZlcnNpb25zIGFyZW4ndCBkaXNhYmxlZAogICAgbW9kaWZpZXIgY29udmVyc2lvbnNBbGxvd2VkIHsKICAgICAgICBhc3NlcnQoY29udmVyc2lvbnNFbmFibGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgbnVtYmVyIG9mIGNvbm5lY3RvciB0b2tlbnMgZGVmaW5lZAoKICAgICAgICBAcmV0dXJuIG51bWJlciBvZiBjb25uZWN0b3IgdG9rZW5zCiAgICAqLwogICAgZnVuY3Rpb24gY29ubmVjdG9yVG9rZW5Db3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYpIHsKICAgICAgICByZXR1cm4gdWludDE2KGNvbm5lY3RvclRva2Vucy5sZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgbnVtYmVyIG9mIGNvbnZlcnRpYmxlIHRva2VucyBzdXBwb3J0ZWQgYnkgdGhlIGNvbnRyYWN0CiAgICAgICAgbm90ZSB0aGF0IHRoZSBudW1iZXIgb2YgY29udmVydGlibGUgdG9rZW5zIGlzIHRoZSBudW1iZXIgb2YgY29ubmVjdG9yIHRva2VuLCBwbHVzIDEgKHRoYXQgcmVwcmVzZW50cyB0aGUgc21hcnQgdG9rZW4pCgogICAgICAgIEByZXR1cm4gbnVtYmVyIG9mIGNvbnZlcnRpYmxlIHRva2VucwogICAgKi8KICAgIGZ1bmN0aW9uIGNvbnZlcnRpYmxlVG9rZW5Db3VudCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MTYpIHsKICAgICAgICByZXR1cm4gY29ubmVjdG9yVG9rZW5Db3VudCgpICsgMTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGdpdmVuIGEgY29udmVydGlibGUgdG9rZW4gaW5kZXgsIHJldHVybnMgaXRzIGNvbnRyYWN0IGFkZHJlc3MKCiAgICAgICAgQHBhcmFtIF90b2tlbkluZGV4ICBjb252ZXJ0aWJsZSB0b2tlbiBpbmRleAoKICAgICAgICBAcmV0dXJuIGNvbnZlcnRpYmxlIHRva2VuIGFkZHJlc3MKICAgICovCiAgICBmdW5jdGlvbiBjb252ZXJ0aWJsZVRva2VuKHVpbnQxNiBfdG9rZW5JbmRleCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKGFkZHJlc3MpIHsKICAgICAgICBpZiAoX3Rva2VuSW5kZXggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRva2VuOwogICAgICAgIHJldHVybiBjb25uZWN0b3JUb2tlbnNbX3Rva2VuSW5kZXggLSAxXTsKICAgIH0KCiAgICAvKgogICAgICAgIEBkZXYgYWxsb3dzIHRoZSBvd25lciB0byB1cGRhdGUgdGhlIGV4dGVuc2lvbnMgY29udHJhY3QgYWRkcmVzcwoKICAgICAgICBAcGFyYW0gX2V4dGVuc2lvbnMgICAgYWRkcmVzcyBvZiBhIGJhbmNvciBjb252ZXJ0ZXIgZXh0ZW5zaW9ucyBjb250cmFjdAogICAgKi8KICAgIGZ1bmN0aW9uIHNldEV4dGVuc2lvbnMoSUJhbmNvckNvbnZlcnRlckV4dGVuc2lvbnMgX2V4dGVuc2lvbnMpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRBZGRyZXNzKF9leHRlbnNpb25zKQogICAgICAgIG5vdFRoaXMoX2V4dGVuc2lvbnMpCiAgICB7CiAgICAgICAgZXh0ZW5zaW9ucyA9IF9leHRlbnNpb25zOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG1hbmFnZXIgdG8gdXBkYXRlIHRoZSBxdWljayBidXkgcGF0aAoKICAgICAgICBAcGFyYW0gX3BhdGggICAgbmV3IHF1aWNrIGJ1eSBwYXRoLCBzZWUgY29udmVyc2lvbiBwYXRoIGZvcm1hdCBpbiB0aGUgQmFuY29yUXVpY2tDb252ZXJ0ZXIgY29udHJhY3QKICAgICovCiAgICBmdW5jdGlvbiBzZXRRdWlja0J1eVBhdGgoSUVSQzIwVG9rZW5bXSBfcGF0aCkKICAgICAgICBwdWJsaWMKICAgICAgICBvd25lck9ubHkKICAgICAgICB2YWxpZENvbnZlcnNpb25QYXRoKF9wYXRoKQogICAgewogICAgICAgIHF1aWNrQnV5UGF0aCA9IF9wYXRoOwogICAgfQoKICAgIC8qCiAgICAgICAgQGRldiBhbGxvd3MgdGhlIG1hbmFnZXIgdG8gY2xlYXIgdGhlIHF1aWNrIGJ1eSBwYXRoCiAgICAqLwogICAgZnVuY3Rpb24gY2xlYXJRdWlja0J1eVBhdGgoKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICBxdWlja0J1eVBhdGgubGVuZ3RoID0gMDsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGUgcXVpY2sgYnV5IHBhdGggYXJyYXkKCiAgICAgICAgQHJldHVybiBxdWljayBidXkgcGF0aCBsZW5ndGgKICAgICovCiAgICBmdW5jdGlvbiBnZXRRdWlja0J1eVBhdGhMZW5ndGgoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBxdWlja0J1eVBhdGgubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZGlzYWJsZXMgdGhlIGVudGlyZSBjb252ZXJzaW9uIGZ1bmN0aW9uYWxpdHkKICAgICAgICB0aGlzIGlzIGEgc2FmZXR5IG1lY2hhbmlzbSBpbiBjYXNlIG9mIGEgZW1lcmdlbmN5CiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBtYW5hZ2VyCgogICAgICAgIEBwYXJhbSBfZGlzYWJsZSB0cnVlIHRvIGRpc2FibGUgY29udmVyc2lvbnMsIGZhbHNlIHRvIHJlLWVuYWJsZSB0aGVtCiAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZUNvbnZlcnNpb25zKGJvb2wgX2Rpc2FibGUpIHB1YmxpYyBtYW5hZ2VyT25seSB7CiAgICAgICAgY29udmVyc2lvbnNFbmFibGVkID0gIV9kaXNhYmxlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXBkYXRlcyB0aGUgY3VycmVudCBjb252ZXJzaW9uIGZlZQogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgbWFuYWdlcgoKICAgICAgICBAcGFyYW0gX2NvbnZlcnNpb25GZWUgbmV3IGNvbnZlcnNpb24gZmVlLCByZXByZXNlbnRlZCBpbiBwcG0KICAgICovCiAgICBmdW5jdGlvbiBzZXRDb252ZXJzaW9uRmVlKHVpbnQzMiBfY29udmVyc2lvbkZlZSkKICAgICAgICBwdWJsaWMKICAgICAgICBtYW5hZ2VyT25seQogICAgICAgIHZhbGlkQ29udmVyc2lvbkZlZShfY29udmVyc2lvbkZlZSkKICAgIHsKICAgICAgICBjb252ZXJzaW9uRmVlID0gX2NvbnZlcnNpb25GZWU7CiAgICB9CgogICAgLyoKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGNvbnZlcnNpb24gZmVlIGFtb3VudCBmb3IgYSBnaXZlbiByZXR1cm4gYW1vdW50CgogICAgICAgIEByZXR1cm4gY29udmVyc2lvbiBmZWUgYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0Q29udmVyc2lvbkZlZUFtb3VudCh1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHNhZmVNdWwoX2Ftb3VudCwgY29udmVyc2lvbkZlZSkgLyBNQVhfQ09OVkVSU0lPTl9GRUU7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBkZWZpbmVzIGEgbmV3IGNvbm5lY3RvciBmb3IgdGhlIHRva2VuCiAgICAgICAgY2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBvd25lciB3aGlsZSB0aGUgY29udmVydGVyIGlzIGluYWN0aXZlCgogICAgICAgIEBwYXJhbSBfdG9rZW4gICAgICAgICAgICAgICAgICBhZGRyZXNzIG9mIHRoZSBjb25uZWN0b3IgdG9rZW4KICAgICAgICBAcGFyYW0gX3dlaWdodCAgICAgICAgICAgICAgICAgY29uc3RhbnQgY29ubmVjdG9yIHdlaWdodCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgY29ubmVjdG9yLCBmYWxzZSB0byBkaXNhYmxlIGl0CiAgICAqLwogICAgZnVuY3Rpb24gYWRkQ29ubmVjdG9yKElFUkMyMFRva2VuIF90b2tlbiwgdWludDMyIF93ZWlnaHQsIGJvb2wgX2VuYWJsZVZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIGluYWN0aXZlCiAgICAgICAgdmFsaWRBZGRyZXNzKF90b2tlbikKICAgICAgICBub3RUaGlzKF90b2tlbikKICAgICAgICB2YWxpZENvbm5lY3RvcldlaWdodChfd2VpZ2h0KQogICAgewogICAgICAgIHJlcXVpcmUoX3Rva2VuICE9IHRva2VuICYmICFjb25uZWN0b3JzW190b2tlbl0uaXNTZXQgJiYgdG90YWxDb25uZWN0b3JXZWlnaHQgKyBfd2VpZ2h0IDw9IE1BWF9XRUlHSFQpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICBjb25uZWN0b3JzW190b2tlbl0udmlydHVhbEJhbGFuY2UgPSAwOwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS53ZWlnaHQgPSBfd2VpZ2h0OwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS5pc1ZpcnR1YWxCYWxhbmNlRW5hYmxlZCA9IF9lbmFibGVWaXJ0dWFsQmFsYW5jZTsKICAgICAgICBjb25uZWN0b3JzW190b2tlbl0uaXNQdXJjaGFzZUVuYWJsZWQgPSB0cnVlOwogICAgICAgIGNvbm5lY3RvcnNbX3Rva2VuXS5pc1NldCA9IHRydWU7CiAgICAgICAgY29ubmVjdG9yVG9rZW5zLnB1c2goX3Rva2VuKTsKICAgICAgICB0b3RhbENvbm5lY3RvcldlaWdodCArPSBfd2VpZ2h0OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXBkYXRlcyBvbmUgb2YgdGhlIHRva2VuIGNvbm5lY3RvcnMKICAgICAgICBjYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gICAgICAgICBhZGRyZXNzIG9mIHRoZSBjb25uZWN0b3IgdG9rZW4KICAgICAgICBAcGFyYW0gX3dlaWdodCAgICAgICAgICAgICAgICAgY29uc3RhbnQgY29ubmVjdG9yIHdlaWdodCwgcmVwcmVzZW50ZWQgaW4gcHBtLCAxLTEwMDAwMDAKICAgICAgICBAcGFyYW0gX2VuYWJsZVZpcnR1YWxCYWxhbmNlICAgdHJ1ZSB0byBlbmFibGUgdmlydHVhbCBiYWxhbmNlIGZvciB0aGUgY29ubmVjdG9yLCBmYWxzZSB0byBkaXNhYmxlIGl0CiAgICAgICAgQHBhcmFtIF92aXJ0dWFsQmFsYW5jZSAgICAgICAgIG5ldyBjb25uZWN0b3IncyB2aXJ0dWFsIGJhbGFuY2UKICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVDb25uZWN0b3IoSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MzIgX3dlaWdodCwgYm9vbCBfZW5hYmxlVmlydHVhbEJhbGFuY2UsIHVpbnQyNTYgX3ZpcnR1YWxCYWxhbmNlKQogICAgICAgIHB1YmxpYwogICAgICAgIG93bmVyT25seQogICAgICAgIHZhbGlkQ29ubmVjdG9yKF9jb25uZWN0b3JUb2tlbikKICAgICAgICB2YWxpZENvbm5lY3RvcldlaWdodChfd2VpZ2h0KQogICAgewogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICByZXF1aXJlKHRvdGFsQ29ubmVjdG9yV2VpZ2h0IC0gY29ubmVjdG9yLndlaWdodCArIF93ZWlnaHQgPD0gTUFYX1dFSUdIVCk7IC8vIHZhbGlkYXRlIGlucHV0CgogICAgICAgIHRvdGFsQ29ubmVjdG9yV2VpZ2h0ID0gdG90YWxDb25uZWN0b3JXZWlnaHQgLSBjb25uZWN0b3Iud2VpZ2h0ICsgX3dlaWdodDsKICAgICAgICBjb25uZWN0b3Iud2VpZ2h0ID0gX3dlaWdodDsKICAgICAgICBjb25uZWN0b3IuaXNWaXJ0dWFsQmFsYW5jZUVuYWJsZWQgPSBfZW5hYmxlVmlydHVhbEJhbGFuY2U7CiAgICAgICAgY29ubmVjdG9yLnZpcnR1YWxCYWxhbmNlID0gX3ZpcnR1YWxCYWxhbmNlOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgZGlzYWJsZXMgcHVyY2hhc2luZyB3aXRoIHRoZSBnaXZlbiBjb25uZWN0b3IgdG9rZW4gaW4gY2FzZSB0aGUgY29ubmVjdG9yIHRva2VuIGdvdCBjb21wcm9taXNlZAogICAgICAgIGNhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgb3duZXIKICAgICAgICBub3RlIHRoYXQgc2VsbGluZyBpcyBzdGlsbCBlbmFibGVkIHJlZ2FyZGxlc3Mgb2YgdGhpcyBmbGFnIGFuZCBpdCBjYW5ub3QgYmUgZGlzYWJsZWQgYnkgdGhlIG93bmVyCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9kaXNhYmxlICAgICAgICAgdHJ1ZSB0byBkaXNhYmxlIHRoZSB0b2tlbiwgZmFsc2UgdG8gcmUtZW5hYmxlIGl0CiAgICAqLwogICAgZnVuY3Rpb24gZGlzYWJsZUNvbm5lY3RvclB1cmNoYXNlcyhJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIGJvb2wgX2Rpc2FibGUpCiAgICAgICAgcHVibGljCiAgICAgICAgb3duZXJPbmx5CiAgICAgICAgdmFsaWRDb25uZWN0b3IoX2Nvbm5lY3RvclRva2VuKQogICAgewogICAgICAgIGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXS5pc1B1cmNoYXNlRW5hYmxlZCA9ICFfZGlzYWJsZTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGNvbm5lY3RvcidzIHZpcnR1YWwgYmFsYW5jZSBpZiBvbmUgaXMgZGVmaW5lZCwgb3RoZXJ3aXNlIHJldHVybnMgdGhlIGFjdHVhbCBiYWxhbmNlCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCgogICAgICAgIEByZXR1cm4gY29ubmVjdG9yIGJhbGFuY2UKICAgICovCiAgICBmdW5jdGlvbiBnZXRDb25uZWN0b3JCYWxhbmNlKElFUkMyMFRva2VuIF9jb25uZWN0b3JUb2tlbikKICAgICAgICBwdWJsaWMKICAgICAgICBjb25zdGFudAogICAgICAgIHZhbGlkQ29ubmVjdG9yKF9jb25uZWN0b3JUb2tlbikKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICByZXR1cm4gY29ubmVjdG9yLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkID8gY29ubmVjdG9yLnZpcnR1YWxCYWxhbmNlIDogX2Nvbm5lY3RvclRva2VuLmJhbGFuY2VPZih0aGlzKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHJldHVybnMgdGhlIGV4cGVjdGVkIHJldHVybiBmb3IgY29udmVydGluZyBhIHNwZWNpZmljIGFtb3VudCBvZiBfZnJvbVRva2VuIHRvIF90b1Rva2VuCgogICAgICAgIEBwYXJhbSBfZnJvbVRva2VuICBFUkMyMCB0b2tlbiB0byBjb252ZXJ0IGZyb20KICAgICAgICBAcGFyYW0gX3RvVG9rZW4gICAgRVJDMjAgdG9rZW4gdG8gY29udmVydCB0bwogICAgICAgIEBwYXJhbSBfYW1vdW50ICAgICBhbW91bnQgdG8gY29udmVydCwgaW4gZnJvbVRva2VuCgogICAgICAgIEByZXR1cm4gZXhwZWN0ZWQgY29udmVyc2lvbiByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0UmV0dXJuKElFUkMyMFRva2VuIF9mcm9tVG9rZW4sIElFUkMyMFRva2VuIF90b1Rva2VuLCB1aW50MjU2IF9hbW91bnQpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShfZnJvbVRva2VuICE9IF90b1Rva2VuKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgLy8gY29udmVyc2lvbiBiZXR3ZWVuIHRoZSB0b2tlbiBhbmQgb25lIG9mIGl0cyBjb25uZWN0b3JzCiAgICAgICAgaWYgKF90b1Rva2VuID09IHRva2VuKQogICAgICAgICAgICByZXR1cm4gZ2V0UHVyY2hhc2VSZXR1cm4oX2Zyb21Ub2tlbiwgX2Ftb3VudCk7CiAgICAgICAgZWxzZSBpZiAoX2Zyb21Ub2tlbiA9PSB0b2tlbikKICAgICAgICAgICAgcmV0dXJuIGdldFNhbGVSZXR1cm4oX3RvVG9rZW4sIF9hbW91bnQpOwoKICAgICAgICAvLyBjb252ZXJzaW9uIGJldHdlZW4gMiBjb25uZWN0b3JzCiAgICAgICAgdWludDI1NiBwdXJjaGFzZVJldHVybkFtb3VudCA9IGdldFB1cmNoYXNlUmV0dXJuKF9mcm9tVG9rZW4sIF9hbW91bnQpOwogICAgICAgIHJldHVybiBnZXRTYWxlUmV0dXJuKF90b1Rva2VuLCBwdXJjaGFzZVJldHVybkFtb3VudCwgc2FmZUFkZCh0b2tlbi50b3RhbFN1cHBseSgpLCBwdXJjaGFzZVJldHVybkFtb3VudCkpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBidXlpbmcgdGhlIHRva2VuIGZvciBhIGNvbm5lY3RvciB0b2tlbgoKICAgICAgICBAcGFyYW0gX2Nvbm5lY3RvclRva2VuICBjb25uZWN0b3IgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfZGVwb3NpdEFtb3VudCAgIGFtb3VudCB0byBkZXBvc2l0IChpbiB0aGUgY29ubmVjdG9yIHRva2VuKQoKICAgICAgICBAcmV0dXJuIGV4cGVjdGVkIHB1cmNoYXNlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRQdXJjaGFzZVJldHVybihJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX2RlcG9zaXRBbW91bnQpCiAgICAgICAgcHVibGljCiAgICAgICAgY29uc3RhbnQKICAgICAgICBhY3RpdmUKICAgICAgICB2YWxpZENvbm5lY3RvcihfY29ubmVjdG9yVG9rZW4pCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICBDb25uZWN0b3Igc3RvcmFnZSBjb25uZWN0b3IgPSBjb25uZWN0b3JzW19jb25uZWN0b3JUb2tlbl07CiAgICAgICAgcmVxdWlyZShjb25uZWN0b3IuaXNQdXJjaGFzZUVuYWJsZWQpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICB1aW50MjU2IHRva2VuU3VwcGx5ID0gdG9rZW4udG90YWxTdXBwbHkoKTsKICAgICAgICB1aW50MjU2IGNvbm5lY3RvckJhbGFuY2UgPSBnZXRDb25uZWN0b3JCYWxhbmNlKF9jb25uZWN0b3JUb2tlbik7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBleHRlbnNpb25zLmZvcm11bGEoKS5jYWxjdWxhdGVQdXJjaGFzZVJldHVybih0b2tlblN1cHBseSwgY29ubmVjdG9yQmFsYW5jZSwgY29ubmVjdG9yLndlaWdodCwgX2RlcG9zaXRBbW91bnQpOwoKICAgICAgICAvLyBkZWR1Y3QgdGhlIGZlZSBmcm9tIHRoZSByZXR1cm4gYW1vdW50CiAgICAgICAgdWludDI1NiBmZWVBbW91bnQgPSBnZXRDb252ZXJzaW9uRmVlQW1vdW50KGFtb3VudCk7CiAgICAgICAgcmV0dXJuIHNhZmVTdWIoYW1vdW50LCBmZWVBbW91bnQpOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9zZWxsQW1vdW50ICAgICAgYW1vdW50IHRvIHNlbGwgKGluIHRoZSBzbWFydCB0b2tlbikKCiAgICAgICAgQHJldHVybiBleHBlY3RlZCBzYWxlIHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBnZXRTYWxlUmV0dXJuKElFUkMyMFRva2VuIF9jb25uZWN0b3JUb2tlbiwgdWludDI1NiBfc2VsbEFtb3VudCkgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gZ2V0U2FsZVJldHVybihfY29ubmVjdG9yVG9rZW4sIF9zZWxsQW1vdW50LCB0b2tlbi50b3RhbFN1cHBseSgpKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGNvbnZlcnRzIGEgc3BlY2lmaWMgYW1vdW50IG9mIF9mcm9tVG9rZW4gdG8gX3RvVG9rZW4KCiAgICAgICAgQHBhcmFtIF9mcm9tVG9rZW4gIEVSQzIwIHRva2VuIHRvIGNvbnZlcnQgZnJvbQogICAgICAgIEBwYXJhbSBfdG9Ub2tlbiAgICBFUkMyMCB0b2tlbiB0byBjb252ZXJ0IHRvCiAgICAgICAgQHBhcmFtIF9hbW91bnQgICAgIGFtb3VudCB0byBjb252ZXJ0LCBpbiBmcm9tVG9rZW4KICAgICAgICBAcGFyYW0gX21pblJldHVybiAgaWYgdGhlIGNvbnZlcnNpb24gcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gY29udmVyc2lvbiByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gY29udmVydChJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmVxdWlyZShfZnJvbVRva2VuICE9IF90b1Rva2VuKTsgLy8gdmFsaWRhdGUgaW5wdXQKCiAgICAgICAgLy8gY29udmVyc2lvbiBiZXR3ZWVuIHRoZSB0b2tlbiBhbmQgb25lIG9mIGl0cyBjb25uZWN0b3JzCiAgICAgICAgaWYgKF90b1Rva2VuID09IHRva2VuKQogICAgICAgICAgICByZXR1cm4gYnV5KF9mcm9tVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOwogICAgICAgIGVsc2UgaWYgKF9mcm9tVG9rZW4gPT0gdG9rZW4pCiAgICAgICAgICAgIHJldHVybiBzZWxsKF90b1Rva2VuLCBfYW1vdW50LCBfbWluUmV0dXJuKTsKCiAgICAgICAgLy8gY29udmVyc2lvbiBiZXR3ZWVuIDIgY29ubmVjdG9ycwogICAgICAgIHVpbnQyNTYgcHVyY2hhc2VBbW91bnQgPSBidXkoX2Zyb21Ub2tlbiwgX2Ftb3VudCwgMSk7CiAgICAgICAgcmV0dXJuIHNlbGwoX3RvVG9rZW4sIHB1cmNoYXNlQW1vdW50LCBfbWluUmV0dXJuKTsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IGJ1eXMgdGhlIHRva2VuIGJ5IGRlcG9zaXRpbmcgb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zCgogICAgICAgIEBwYXJhbSBfY29ubmVjdG9yVG9rZW4gIGNvbm5lY3RvciB0b2tlbiBjb250cmFjdCBhZGRyZXNzCiAgICAgICAgQHBhcmFtIF9kZXBvc2l0QW1vdW50ICAgYW1vdW50IHRvIGRlcG9zaXQgKGluIHRoZSBjb25uZWN0b3IgdG9rZW4pCiAgICAgICAgQHBhcmFtIF9taW5SZXR1cm4gICAgICAgaWYgdGhlIGNvbnZlcnNpb24gcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGFuIHRoZSBtaW5pbXVtIHJldHVybiAtIGl0IGlzIGNhbmNlbGxlZCwgbXVzdCBiZSBub256ZXJvCgogICAgICAgIEByZXR1cm4gYnV5IHJldHVybiBhbW91bnQKICAgICovCiAgICBmdW5jdGlvbiBidXkoSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MjU2IF9kZXBvc2l0QW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pCiAgICAgICAgcHVibGljCiAgICAgICAgY29udmVyc2lvbnNBbGxvd2VkCiAgICAgICAgdmFsaWRHYXNQcmljZQogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfbWluUmV0dXJuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgdWludDI1NiBhbW91bnQgPSBnZXRQdXJjaGFzZVJldHVybihfY29ubmVjdG9yVG9rZW4sIF9kZXBvc2l0QW1vdW50KTsKICAgICAgICBhc3NlcnQoYW1vdW50ICE9IDAgJiYgYW1vdW50ID49IF9taW5SZXR1cm4pOyAvLyBlbnN1cmUgdGhlIHRyYWRlIGdpdmVzIHNvbWV0aGluZyBpbiByZXR1cm4gYW5kIG1lZXRzIHRoZSBtaW5pbXVtIHJlcXVlc3RlZCBhbW91bnQKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICBpZiAoY29ubmVjdG9yLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQogICAgICAgICAgICBjb25uZWN0b3IudmlydHVhbEJhbGFuY2UgPSBzYWZlQWRkKGNvbm5lY3Rvci52aXJ0dWFsQmFsYW5jZSwgX2RlcG9zaXRBbW91bnQpOwoKICAgICAgICAvLyB0cmFuc2ZlciBfZGVwb3NpdEFtb3VudCBmdW5kcyBmcm9tIHRoZSBjYWxsZXIgaW4gdGhlIGNvbm5lY3RvciB0b2tlbgogICAgICAgIGFzc2VydChfY29ubmVjdG9yVG9rZW4udHJhbnNmZXJGcm9tKG1zZy5zZW5kZXIsIHRoaXMsIF9kZXBvc2l0QW1vdW50KSk7CiAgICAgICAgLy8gaXNzdWUgbmV3IGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIHNtYXJ0IHRva2VuCiAgICAgICAgdG9rZW4uaXNzdWUobXNnLnNlbmRlciwgYW1vdW50KTsKCiAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBuZXcgcHJpY2UgdXNpbmcgdGhlIHNpbXBsZSBwcmljZSBmb3JtdWxhCiAgICAgICAgLy8gcHJpY2UgPSBjb25uZWN0b3IgYmFsYW5jZSAvIChzdXBwbHkgKiB3ZWlnaHQpCiAgICAgICAgLy8gd2VpZ2h0IGlzIHJlcHJlc2VudGVkIGluIHBwbSwgc28gbXVsdGlwbHlpbmcgYnkgMTAwMDAwMAogICAgICAgIHVpbnQyNTYgY29ubmVjdG9yQW1vdW50ID0gc2FmZU11bChnZXRDb25uZWN0b3JCYWxhbmNlKF9jb25uZWN0b3JUb2tlbiksIE1BWF9XRUlHSFQpOwogICAgICAgIHVpbnQyNTYgdG9rZW5BbW91bnQgPSBzYWZlTXVsKHRva2VuLnRvdGFsU3VwcGx5KCksIGNvbm5lY3Rvci53ZWlnaHQpOwogICAgICAgIENvbnZlcnNpb24oX2Nvbm5lY3RvclRva2VuLCB0b2tlbiwgbXNnLnNlbmRlciwgX2RlcG9zaXRBbW91bnQsIGFtb3VudCwgY29ubmVjdG9yQW1vdW50LCB0b2tlbkFtb3VudCk7CiAgICAgICAgcmV0dXJuIGFtb3VudDsKICAgIH0KCiAgICAvKioKICAgICAgICBAZGV2IHNlbGxzIHRoZSB0b2tlbiBieSB3aXRoZHJhd2luZyBmcm9tIG9uZSBvZiBpdHMgY29ubmVjdG9yIHRva2VucwoKICAgICAgICBAcGFyYW0gX2Nvbm5lY3RvclRva2VuICBjb25uZWN0b3IgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfc2VsbEFtb3VudCAgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCiAgICAgICAgQHBhcmFtIF9taW5SZXR1cm4gICAgICAgaWYgdGhlIGNvbnZlcnNpb24gcmVzdWx0cyBpbiBhbiBhbW91bnQgc21hbGxlciB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHNlbGwgcmV0dXJuIGFtb3VudAogICAgKi8KICAgIGZ1bmN0aW9uIHNlbGwoSUVSQzIwVG9rZW4gX2Nvbm5lY3RvclRva2VuLCB1aW50MjU2IF9zZWxsQW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pCiAgICAgICAgcHVibGljCiAgICAgICAgY29udmVyc2lvbnNBbGxvd2VkCiAgICAgICAgdmFsaWRHYXNQcmljZQogICAgICAgIGdyZWF0ZXJUaGFuWmVybyhfbWluUmV0dXJuKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgcmVxdWlyZShfc2VsbEFtb3VudCA8PSB0b2tlbi5iYWxhbmNlT2YobXNnLnNlbmRlcikpOyAvLyB2YWxpZGF0ZSBpbnB1dAoKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGdldFNhbGVSZXR1cm4oX2Nvbm5lY3RvclRva2VuLCBfc2VsbEFtb3VudCk7CiAgICAgICAgYXNzZXJ0KGFtb3VudCAhPSAwICYmIGFtb3VudCA+PSBfbWluUmV0dXJuKTsgLy8gZW5zdXJlIHRoZSB0cmFkZSBnaXZlcyBzb21ldGhpbmcgaW4gcmV0dXJuIGFuZCBtZWV0cyB0aGUgbWluaW11bSByZXF1ZXN0ZWQgYW1vdW50CgogICAgICAgIHVpbnQyNTYgdG9rZW5TdXBwbHkgPSB0b2tlbi50b3RhbFN1cHBseSgpOwogICAgICAgIHVpbnQyNTYgY29ubmVjdG9yQmFsYW5jZSA9IGdldENvbm5lY3RvckJhbGFuY2UoX2Nvbm5lY3RvclRva2VuKTsKICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgdHJhZGUgd2lsbCBvbmx5IGRlcGxldGUgdGhlIGNvbm5lY3RvciBpZiB0aGUgdG90YWwgc3VwcGx5IGlzIGRlcGxldGVkIGFzIHdlbGwKICAgICAgICBhc3NlcnQoYW1vdW50IDwgY29ubmVjdG9yQmFsYW5jZSB8fCAoYW1vdW50ID09IGNvbm5lY3RvckJhbGFuY2UgJiYgX3NlbGxBbW91bnQgPT0gdG9rZW5TdXBwbHkpKTsKCiAgICAgICAgLy8gdXBkYXRlIHZpcnR1YWwgYmFsYW5jZSBpZiByZWxldmFudAogICAgICAgIENvbm5lY3RvciBzdG9yYWdlIGNvbm5lY3RvciA9IGNvbm5lY3RvcnNbX2Nvbm5lY3RvclRva2VuXTsKICAgICAgICBpZiAoY29ubmVjdG9yLmlzVmlydHVhbEJhbGFuY2VFbmFibGVkKQogICAgICAgICAgICBjb25uZWN0b3IudmlydHVhbEJhbGFuY2UgPSBzYWZlU3ViKGNvbm5lY3Rvci52aXJ0dWFsQmFsYW5jZSwgYW1vdW50KTsKCiAgICAgICAgLy8gZGVzdHJveSBfc2VsbEFtb3VudCBmcm9tIHRoZSBjYWxsZXIncyBiYWxhbmNlIGluIHRoZSBzbWFydCB0b2tlbgogICAgICAgIHRva2VuLmRlc3Ryb3kobXNnLnNlbmRlciwgX3NlbGxBbW91bnQpOwogICAgICAgIC8vIHRyYW5zZmVyIGZ1bmRzIHRvIHRoZSBjYWxsZXIgaW4gdGhlIGNvbm5lY3RvciB0b2tlbgogICAgICAgIC8vIHRoZSB0cmFuc2ZlciBtaWdodCBmYWlsIGlmIHRoZSBhY3R1YWwgY29ubmVjdG9yIGJhbGFuY2UgaXMgc21hbGxlciB0aGFuIHRoZSB2aXJ0dWFsIGJhbGFuY2UKICAgICAgICBhc3NlcnQoX2Nvbm5lY3RvclRva2VuLnRyYW5zZmVyKG1zZy5zZW5kZXIsIGFtb3VudCkpOwoKICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIG5ldyBwcmljZSB1c2luZyB0aGUgc2ltcGxlIHByaWNlIGZvcm11bGEKICAgICAgICAvLyBwcmljZSA9IGNvbm5lY3RvciBiYWxhbmNlIC8gKHN1cHBseSAqIHdlaWdodCkKICAgICAgICAvLyB3ZWlnaHQgaXMgcmVwcmVzZW50ZWQgaW4gcHBtLCBzbyBtdWx0aXBseWluZyBieSAxMDAwMDAwCiAgICAgICAgdWludDI1NiBjb25uZWN0b3JBbW91bnQgPSBzYWZlTXVsKGdldENvbm5lY3RvckJhbGFuY2UoX2Nvbm5lY3RvclRva2VuKSwgTUFYX1dFSUdIVCk7CiAgICAgICAgdWludDI1NiB0b2tlbkFtb3VudCA9IHNhZmVNdWwodG9rZW4udG90YWxTdXBwbHkoKSwgY29ubmVjdG9yLndlaWdodCk7CiAgICAgICAgQ29udmVyc2lvbih0b2tlbiwgX2Nvbm5lY3RvclRva2VuLCBtc2cuc2VuZGVyLCBfc2VsbEFtb3VudCwgYW1vdW50LCB0b2tlbkFtb3VudCwgY29ubmVjdG9yQW1vdW50KTsKICAgICAgICByZXR1cm4gYW1vdW50OwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgY29udmVydHMgdGhlIHRva2VuIHRvIGFueSBvdGhlciB0b2tlbiBpbiB0aGUgYmFuY29yIG5ldHdvcmsgYnkgZm9sbG93aW5nIGEgcHJlZGVmaW5lZCBjb252ZXJzaW9uIHBhdGgKICAgICAgICBub3RlIHRoYXQgd2hlbiBjb252ZXJ0aW5nIGZyb20gYW4gRVJDMjAgdG9rZW4gKGFzIG9wcG9zZWQgdG8gYSBzbWFydCB0b2tlbiksIGFsbG93YW5jZSBtdXN0IGJlIHNldCBiZWZvcmVoYW5kCgogICAgICAgIEBwYXJhbSBfcGF0aCAgICAgICAgY29udmVyc2lvbiBwYXRoLCBzZWUgY29udmVyc2lvbiBwYXRoIGZvcm1hdCBpbiB0aGUgQmFuY29yUXVpY2tDb252ZXJ0ZXIgY29udHJhY3QKICAgICAgICBAcGFyYW0gX2Ftb3VudCAgICAgIGFtb3VudCB0byBjb252ZXJ0IGZyb20gKGluIHRoZSBpbml0aWFsIHNvdXJjZSB0b2tlbikKICAgICAgICBAcGFyYW0gX21pblJldHVybiAgIGlmIHRoZSBjb252ZXJzaW9uIHJlc3VsdHMgaW4gYW4gYW1vdW50IHNtYWxsZXIgdGhhbiB0aGUgbWluaW11bSByZXR1cm4gLSBpdCBpcyBjYW5jZWxsZWQsIG11c3QgYmUgbm9uemVybwoKICAgICAgICBAcmV0dXJuIHRva2VucyBpc3N1ZWQgaW4gcmV0dXJuCiAgICAqLwogICAgZnVuY3Rpb24gcXVpY2tDb252ZXJ0KElFUkMyMFRva2VuW10gX3BhdGgsIHVpbnQyNTYgX2Ftb3VudCwgdWludDI1NiBfbWluUmV0dXJuKQogICAgICAgIHB1YmxpYwogICAgICAgIHBheWFibGUKICAgICAgICB2YWxpZENvbnZlcnNpb25QYXRoKF9wYXRoKQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgSUVSQzIwVG9rZW4gZnJvbVRva2VuID0gX3BhdGhbMF07CiAgICAgICAgSUJhbmNvclF1aWNrQ29udmVydGVyIHF1aWNrQ29udmVydGVyID0gZXh0ZW5zaW9ucy5xdWlja0NvbnZlcnRlcigpOwoKICAgICAgICAvLyB3ZSBuZWVkIHRvIHRyYW5zZmVyIHRoZSBzb3VyY2UgdG9rZW5zIGZyb20gdGhlIGNhbGxlciB0byB0aGUgcXVpY2sgY29udmVydGVyLAogICAgICAgIC8vIHNvIGl0IGNhbiBleGVjdXRlIHRoZSBjb252ZXJzaW9uIG9uIGJlaGFsZiBvZiB0aGUgY2FsbGVyCiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB7CiAgICAgICAgICAgIC8vIG5vdCBFVEgsIHNlbmQgdGhlIHNvdXJjZSB0b2tlbnMgdG8gdGhlIHF1aWNrIGNvbnZlcnRlcgogICAgICAgICAgICAvLyBpZiB0aGUgdG9rZW4gaXMgdGhlIHNtYXJ0IHRva2VuLCBubyBhbGxvd2FuY2UgaXMgcmVxdWlyZWQgLSBkZXN0cm95IHRoZSB0b2tlbnMgZnJvbSB0aGUgY2FsbGVyIGFuZCBpc3N1ZSB0aGVtIHRvIHRoZSBxdWljayBjb252ZXJ0ZXIKICAgICAgICAgICAgaWYgKGZyb21Ub2tlbiA9PSB0b2tlbikgewogICAgICAgICAgICAgICAgdG9rZW4uZGVzdHJveShtc2cuc2VuZGVyLCBfYW1vdW50KTsgLy8gZGVzdHJveSBfYW1vdW50IHRva2VucyBmcm9tIHRoZSBjYWxsZXIncyBiYWxhbmNlIGluIHRoZSBzbWFydCB0b2tlbgogICAgICAgICAgICAgICAgdG9rZW4uaXNzdWUocXVpY2tDb252ZXJ0ZXIsIF9hbW91bnQpOyAvLyBpc3N1ZSBfYW1vdW50IG5ldyB0b2tlbnMgdG8gdGhlIHF1aWNrIGNvbnZlcnRlcgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCB3ZSBhc3N1bWUgd2UgYWxyZWFkeSBoYXZlIGFsbG93YW5jZSwgdHJhbnNmZXIgdGhlIHRva2VucyBkaXJlY3RseSB0byB0aGUgcXVpY2sgY29udmVydGVyCiAgICAgICAgICAgICAgICBhc3NlcnQoZnJvbVRva2VuLnRyYW5zZmVyRnJvbShtc2cuc2VuZGVyLCBxdWlja0NvbnZlcnRlciwgX2Ftb3VudCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBleGVjdXRlIHRoZSBjb252ZXJzaW9uIGFuZCBwYXNzIG9uIHRoZSBFVEggd2l0aCB0aGUgY2FsbAogICAgICAgIHJldHVybiBxdWlja0NvbnZlcnRlci5jb252ZXJ0Rm9yLnZhbHVlKG1zZy52YWx1ZSkoX3BhdGgsIF9hbW91bnQsIF9taW5SZXR1cm4sIG1zZy5zZW5kZXIpOwogICAgfQoKICAgIC8vIGRlcHJlY2F0ZWQsIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkKICAgIGZ1bmN0aW9uIGNoYW5nZShJRVJDMjBUb2tlbiBfZnJvbVRva2VuLCBJRVJDMjBUb2tlbiBfdG9Ub2tlbiwgdWludDI1NiBfYW1vdW50LCB1aW50MjU2IF9taW5SZXR1cm4pIHB1YmxpYyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGNvbnZlcnQoX2Zyb21Ub2tlbiwgX3RvVG9rZW4sIF9hbW91bnQsIF9taW5SZXR1cm4pOwogICAgfQoKICAgIC8qKgogICAgICAgIEBkZXYgdXRpbGl0eSwgcmV0dXJucyB0aGUgZXhwZWN0ZWQgcmV0dXJuIGZvciBzZWxsaW5nIHRoZSB0b2tlbiBmb3Igb25lIG9mIGl0cyBjb25uZWN0b3IgdG9rZW5zLCBnaXZlbiBhIHRvdGFsIHN1cHBseSBvdmVycmlkZQoKICAgICAgICBAcGFyYW0gX2Nvbm5lY3RvclRva2VuICBjb25uZWN0b3IgdG9rZW4gY29udHJhY3QgYWRkcmVzcwogICAgICAgIEBwYXJhbSBfc2VsbEFtb3VudCAgICAgIGFtb3VudCB0byBzZWxsIChpbiB0aGUgc21hcnQgdG9rZW4pCiAgICAgICAgQHBhcmFtIF90b3RhbFN1cHBseSAgICAgdG90YWwgdG9rZW4gc3VwcGx5LCBvdmVycmlkZXMgdGhlIGFjdHVhbCB0b2tlbiB0b3RhbCBzdXBwbHkgd2hlbiBjYWxjdWxhdGluZyB0aGUgcmV0dXJuCgogICAgICAgIEByZXR1cm4gc2FsZSByZXR1cm4gYW1vdW50CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0U2FsZVJldHVybihJRVJDMjBUb2tlbiBfY29ubmVjdG9yVG9rZW4sIHVpbnQyNTYgX3NlbGxBbW91bnQsIHVpbnQyNTYgX3RvdGFsU3VwcGx5KQogICAgICAgIHByaXZhdGUKICAgICAgICBjb25zdGFudAogICAgICAgIGFjdGl2ZQogICAgICAgIHZhbGlkQ29ubmVjdG9yKF9jb25uZWN0b3JUb2tlbikKICAgICAgICBncmVhdGVyVGhhblplcm8oX3RvdGFsU3VwcGx5KQogICAgICAgIHJldHVybnMgKHVpbnQyNTYpCiAgICB7CiAgICAgICAgQ29ubmVjdG9yIHN0b3JhZ2UgY29ubmVjdG9yID0gY29ubmVjdG9yc1tfY29ubmVjdG9yVG9rZW5dOwogICAgICAgIHVpbnQyNTYgY29ubmVjdG9yQmFsYW5jZSA9IGdldENvbm5lY3RvckJhbGFuY2UoX2Nvbm5lY3RvclRva2VuKTsKICAgICAgICB1aW50MjU2IGFtb3VudCA9IGV4dGVuc2lvbnMuZm9ybXVsYSgpLmNhbGN1bGF0ZVNhbGVSZXR1cm4oX3RvdGFsU3VwcGx5LCBjb25uZWN0b3JCYWxhbmNlLCBjb25uZWN0b3Iud2VpZ2h0LCBfc2VsbEFtb3VudCk7CgogICAgICAgIC8vIGRlZHVjdCB0aGUgZmVlIGZyb20gdGhlIHJldHVybiBhbW91bnQKICAgICAgICB1aW50MjU2IGZlZUFtb3VudCA9IGdldENvbnZlcnNpb25GZWVBbW91bnQoYW1vdW50KTsKICAgICAgICByZXR1cm4gc2FmZVN1YihhbW91bnQsIGZlZUFtb3VudCk7CiAgICB9CgogICAgLyoqCiAgICAgICAgQGRldiBmYWxsYmFjaywgYnV5cyB0aGUgc21hcnQgdG9rZW4gd2l0aCBFVEgKICAgICAgICBub3RlIHRoYXQgdGhlIHB1cmNoYXNlIHdpbGwgdXNlIHRoZSBwcmljZSBhdCB0aGUgdGltZSBvZiB0aGUgcHVyY2hhc2UKICAgICovCiAgICBmdW5jdGlvbigpIHBheWFibGUgewogICAgICAgIHF1aWNrQ29udmVydChxdWlja0J1eVBhdGgsIG1zZy52YWx1ZSwgMSk7CiAgICB9Cn0='.
	

]
