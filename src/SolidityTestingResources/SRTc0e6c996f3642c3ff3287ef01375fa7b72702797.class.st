Class {
	#name : #SRTc0e6c996f3642c3ff3287ef01375fa7b72702797,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTc0e6c996f3642c3ff3287ef01375fa7b72702797 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7Cgpjb250cmFjdCBCaXRPcHRlcmF0aW9ucyB7CiAgICAgICAgICAgIAogICAgICAgIC8vIGhlbHBlciBmdW5jdGlvbnMgc2V0CiAgICAgICAgLy8gdG8gbWFuaXB1bGF0ZSBvbiBiaXRzIAogICAgICAgIC8vIHdpdGggZGlmZmVyZW50IHdpZGh0IG9mIGFsbG9jYXRvcgogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHNldDUxMihieXRlczMyWzJdIHN0b3JhZ2UgYWxsb2NhdG9yLHVpbnQxNiBwb3MsdWludDggdmFsdWUpIGludGVybmFsIHJldHVybnMoIGJ5dGVzMzJbMl0gc3RvcmFnZSkgewogICAgICAgICAgICAKICAgICAgICAgICAgYnl0ZXMzMiB2YWx1ZUJpdHMgPSAoYnl0ZXMzMikodmFsdWUpOwogICAgICAgIAogICAgICAgICAgICB1aW50OCBwb3NPZmZzZXQgPSB1aW50OChwb3MlMjU1KTsKICAgICAgICAKICAgICAgICAgICAgYnl0ZXMzMiBvbmUgPSAxOwogICAgICAgICAgICBieXRlczMyIGNsZWFyQml0ID0gKGJ5dGVzMzIpKH4ob25lIDw8IHBvc09mZnNldCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgdWludDggYnl0ZXNJbmRleCA9IHBvcz4yNTU/MTowOwogICAgICAgICAgICAKICAgICAgICAgICAgYWxsb2NhdG9yW2J5dGVzSW5kZXhdID0gKGFsbG9jYXRvcltieXRlc0luZGV4XSAmIGNsZWFyQml0KSB8ICh2YWx1ZUJpdHMgPDwgcG9zT2Zmc2V0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBhbGxvY2F0b3I7CiAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gZ2V0NTEyKGJ5dGVzMzJbMl0gYWxsb2NhdG9yLHVpbnQxNiBwb3MpIGludGVybmFsIHB1cmUgcmV0dXJucyh1aW50OCl7CiAgICAgICAgICAgIAogICAgICAgICAgICB1aW50OCBwb3NPZmZzZXQgPSB1aW50OChwb3MlMjU1KTsKICAgICAgICAgICAgdWludDggYnl0ZXNJbmRleCA9IHBvcz4yNTU/MTowOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuICgoKGFsbG9jYXRvcltieXRlc0luZGV4XSA+PiBwb3NPZmZzZXQpICYgMSkgPT0gMSk/MTowOyAgIAogICAgICAgIH0gICAgCiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gY2xlYXI1MTIoYnl0ZXMzMlsyXSBzdG9yYWdlIGFsbG9jYXRvcikgaW50ZXJuYWwgewogICAgICAgICAgICBhbGxvY2F0b3JbMF0gPSAweDA7CiAgICAgICAgICAgIGFsbG9jYXRvclsxXSA9IDB4MDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gc2V0MzIoYnl0ZXM0IGFsbG9jYXRvcix1aW50OCBwb3MsIHVpbnQ4IHZhbHVlKSBpbnRlcm5hbCBwdXJlIHJldHVybnMoYnl0ZXM0KSB7CiAgICAgICAgICAgIAogICAgICAgICAgICBieXRlczQgdmFsdWVCaXRzID0gKGJ5dGVzNCkodmFsdWUpOwogICAgICAgIAogICAgICAgICAgICBieXRlczQgb25lID0gMTsKICAgICAgICAgICAgYnl0ZXM0IGNsZWFyQml0ID0gKGJ5dGVzNCkofihvbmUgPDwgcG9zKSk7CiAgICAgICAgICAgIGFsbG9jYXRvciA9IChhbGxvY2F0b3IgJiBjbGVhckJpdCkgfCAodmFsdWVCaXRzIDw8IHBvcyk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gYWxsb2NhdG9yOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBnZXQzMihieXRlczQgYWxsb2NhdG9yLHVpbnQ4IHBvcykgaW50ZXJuYWwgcHVyZSByZXR1cm5zKHVpbnQ4KXsKICAgICAgICAgICByZXR1cm4gKCgoYWxsb2NhdG9yID4+IHBvcykgJiAxKSA9PSAxKT8xOjA7CiAgICAgICAgfQp9Cgpjb250cmFjdCBSYW5kb20zMkJpZ0ludGVnZXIgaXMgQml0T3B0ZXJhdGlvbnMgewogICAgCiAgICB1aW50MjU2WzEwXSBwdWJsaWMgcmFuZG9tQmxvY2tTdGFydDsKICAgIGJ5dGVzNFsxMF0gcHJpdmF0ZSBudW1iZXJBbGxvY2F0b3I7CiAgICBib29sWzEwXSBpbnRlcm5hbCBnZW5lcmF0ZWQ7CiAgICAKICAgIHVpbnQyNTYgcHJpdmF0ZSBnZW5lcmF0aW9uTnVtYmVyID0gMDsKICAgIAogICAgZnVuY3Rpb24gZ2VuZXJhdGUodWludDggbG90dGVyeUlkKSBpbnRlcm5hbCByZXR1cm5zKGJvb2wpIHsKICAgICAgICAKICAgICAgICAvLyB0byBlbGltaW5hdGUgcHJvYmxlbSBvZiBgc2FtZSByYW5kb20gbnVtYmVyc2AgbGV0cyBhZGQgCiAgICAgICAgLy8gc29tZSBvZmZzZXQgb24gZWFjaCBudW1iZXIgZ2VuZXJhdGlvbgogICAgICAgIHVpbnQ4IHN0YXJ0T2Zmc2V0ID0gdWludDgoKGdlbmVyYXRpb25OdW1iZXIrKykgJSAxMCk7IAogICAgICAgIAogICAgICAgIGlmIChyYW5kb21CbG9ja1N0YXJ0W2xvdHRlcnlJZF0gPT0gMCkgewogICAgICAgICAgICAvLyBzdGFydCByYW5kb20gbnVtYmVyIGdlbmVyYXRpb24gZnJvbSBuZXh0IGJsb2NrLCAKICAgICAgICAgICAgLy8gc28gd2UgY2FuJ3QgaW5mbHVlbmNlIGl0IAogICAgICAgICAgICAgcmFuZG9tQmxvY2tTdGFydFtsb3R0ZXJ5SWRdID0gYmxvY2subnVtYmVyICsgc3RhcnRPZmZzZXQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdWludDI1NiBibG9ja0RpZmZOdW1iZXIgPSBibG9jay5udW1iZXIgLSByYW5kb21CbG9ja1N0YXJ0W2xvdHRlcnlJZF07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyByZXZlcnQgdHggaWYgd2UgaGF2ZW4ndCBlbm91Z2ggYmxvY2tzIHRvIGNhbGMgcmFuZCBpbnQKICAgICAgICAgICAgcmVxdWlyZShibG9ja0RpZmZOdW1iZXIgPj0gMzIpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gaXRzIG5vdCBwb3NzaWJsZSB0byBjYWxjIGZhaXIgcmFuZG9tIG51bWJlciB3aXRoIHN0YXJ0IGF0IHJhbmRvbUJsb2NrU3RhcnQKICAgICAgICAgICAgLy8gYmVjYXVzZSBwYXJ0IG9mIGJsb2NrcyBvciBhbGwgYmxvY2tzIGFyZSBub3QgdmlzaWJsZSBmcm9tIHNvbGlkaXR5IGFueW1vcmUgCiAgICAgICAgICAgIC8vIHN0YXJ0IGdlbmVyYXRpb24gcHJvY2VzcyBvbmUgbW9yZSB0aW1lCiAgICAgICAgICAgIGlmIChibG9ja0RpZmZOdW1iZXIgPiAyNTYpIHsKICAgICAgICAgICAgICAgIHJhbmRvbUJsb2NrU3RhcnRbbG90dGVyeUlkXSA9IGJsb2NrLm51bWJlciArIHN0YXJ0T2Zmc2V0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IDMyOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBnZXQgaGFzaCBvZiBhcHByb3ByaWF0ZSBibG9jawogICAgICAgICAgICAgICAgICAgIHVpbnQyNTYgYmxvY2tIYXNoID0gdWludDI1NihibG9jay5ibG9ja2hhc2gocmFuZG9tQmxvY2tTdGFydFtsb3R0ZXJ5SWRdK2kpKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBzZXQgYXBwcm9wcmlhdGUgYml0IGluIHJlc3VsdCBudW1iZXIKICAgICAgICAgICAgICAgICAgICBudW1iZXJBbGxvY2F0b3JbbG90dGVyeUlkXSA9IHNldDMyKG51bWJlckFsbG9jYXRvcltsb3R0ZXJ5SWRdLGksdWludDgoYmxvY2tIYXNoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnZW5lcmF0ZWRbbG90dGVyeUlkXSA9IHRydWU7CiAgICAgICAgICAgICAgICByYW5kb21CbG9ja1N0YXJ0W2xvdHRlcnlJZF0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBnZW5lcmF0ZWRbbG90dGVyeUlkXTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gY2xlYXJOdW1iZXIodWludDggbG90dGVyeUlkKSBpbnRlcm5hbCB7CiAgICAgICAgcmFuZG9tQmxvY2tTdGFydFtsb3R0ZXJ5SWRdID0gMDsKICAgICAgICBnZW5lcmF0ZWRbbG90dGVyeUlkXSA9IGZhbHNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXROdW1iZXJWYWx1ZSh1aW50OCBsb3R0ZXJ5SWQpIGludGVybmFsIGNvbnN0YW50IHJldHVybnModWludDMyKSB7CiAgICAgICAgcmVxdWlyZShnZW5lcmF0ZWRbbG90dGVyeUlkXSk7CiAgICAgICAgcmV0dXJuIHVpbnQzMihudW1iZXJBbGxvY2F0b3JbbG90dGVyeUlkXSk7CiAgICB9Cn0KCmNvbnRyYWN0IEV0aGVyZXVtSmFja3BvdCBpcyBSYW5kb20zMkJpZ0ludGVnZXIgewogICAgCiAgICBhZGRyZXNzIHByaXZhdGUgb3duZXI7CiAgICAKICAgIGV2ZW50IFdpbm5lclBpY2tlZCh1aW50OCBpbmRleGVkIHJvb21JZCxhZGRyZXNzIHdpbm5lcix1aW50MTYgbnVtYmVyKTsKICAgIGV2ZW50IFRpY2tldHNCb3VnaHQodWludDggaW5kZXhlZCByb29tSWQsYWRkcmVzcyBvd25lcix1aW50MTZbXSB0aWNrZXROdW1iZXJzKTsKICAgIGV2ZW50IExvc3RQYXltZW50KGFkZHJlc3MgZGVzdCx1aW50MjU2IGFtb3VudCk7CiAgICAKICAgIHN0cnVjdCBXaW5uZXIgewogICAgICAgIHVpbnQyNTYgcHJpemU7CiAgICAgICAgdWludDI1NiB0aW1lc3RhbXA7CiAgICAgICAgYWRkcmVzcyBhZGRyOwogICAgICAgIAogICAgICAgIHVpbnQxNiBudW1iZXI7CiAgICAgICAgdWludDggcGVyY2VudDsKICAgIH0KICAgIAogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBhZGRyZXNzKSBwdWJsaWMgYWZmaWxpYXRlczsKICAgIAogICAgV2lubmVyW10gcHJpdmF0ZSB3aW5uZXJzOwogICAgCiAgICB1aW50MzIgcHVibGljIHdpbm5lcnNDb3VudDsKICAgIAogICAgbW9kaWZpZXIgb3duZXJPbmx5IHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIpOwogICAgICAgIF87CiAgICB9CiAgICAKICAgIHVpbnQ4IHB1YmxpYyBhZmZpbGlhdGVQZXJjZW50ID0gMTsKICAgIHVpbnQ4IHB1YmxpYyBtYXhQZXJjZW50UGVyUGxheWVyID0gNDk7CiAgICB1aW50OCBwdWJsaWMgb3duZXJDb21pc3Npb24gPSAyMDsKICAgIAogICAgLy8gdGltZSBvbiB3aGljaCBsb3R0ZXJ5IGhhcyBzdGFydGVkCiAgICB1aW50MjU2WzEwXSBwdWJsaWMgc3RhcnRlZDsKICAgIAogICAgLy8gbGFzdCBhY3Rpdml0eSB0aW1lIG9uIGxvdHRlcnkKICAgIHVpbnQyNTZbMTBdIHB1YmxpYyBsYXN0VGlja2V0Qm91Z2h0OwogICAgCiAgICAvLyBvbmUgdGlja2V0IHByaWNlCiAgICB1aW50MjU2WzEwXSBwdWJsaWMgdGlja2V0UHJpY2U7CiAgICAKICAgIC8vIG1heCBudW1iZXIgb2YgdGlja2V0cyBpbiB0aGlzIGxvdHRlcnkKICAgIHVpbnQxNlsxMF0gcHVibGljIG1heFRpY2tldHM7CiAgICAKICAgIC8vIHRpbWUgdG8gbGl2ZSBiZWZvcmUgcmVmdW5kIGNhbiBiZSByZXF1ZXN0ZWQKICAgIHVpbnQyNTZbMTBdIHB1YmxpYyBsaWZldGltZTsKICAgIAogICAgYWRkcmVzc1tdWzEwXSB0aWNrZXRzQWxsb2NhdG9yOwogICAgCiAgICBzdHJ1Y3QgUGxheWVyIHsKICAgICAgICB1aW50MjU2IGNoYW5nZWRPbjsKICAgICAgICB1aW50MTYgdGlja2V0c0NvdW50OwogICAgfQogICAgCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gUGxheWVyKVsxMF0gcHJpdmF0ZSBwbGF5ZXJJbmZvTWFwcGluZ3M7CiAgICAKICAgIGJ5dGVzMzJbMl1bMTBdIGJpdE1hc2tGb3JQbGF5RmllbGRzOwogICAgCiAgICBlbnVtIFN0YXRlIHtVbmluaXRpYWxpemVkLFJ1bm5pbmcsUGF1c2VkLEZpbmlzaGVkLFJlZnVuZH0KICAgIAogICAgU3RhdGVbMTBdIHB1YmxpYyBzdGF0ZTsgCiAgICAKICAgIC8vIGZsYWcgdGhhdCBpbmRpY2F0ZXMgcmVxdWVzdCBmb3IgcGF1c2Ugb2YgbG90dGVyeVtpZF0KICAgIGJvb2xbMTBdIHByaXZhdGUgcmVxdWVzdFBhdXNlOyAKICAgIAogICAgLy8gbnVtYmVyIG9mIHNvbGQgdGlja2V0cyAKICAgIHVpbnQxNlsxMF0gcHVibGljIHRpY2tldHNTb2xkOwogICAgCiAgICAvLyB0aGlzIGZ1bmN0aW9uIHNldCBmbGFnIHRvIHBhdXNlIHJvb20gb24gbmV4dCBjbGVhclN0YXRlIGNhbGwgKGF0IHRoZSBnYW1lIHN0YXJ0KQogICAgZnVuY3Rpb24gcGF1c2VMb3R0ZXJ5KHVpbnQ4IGxvdHRlcnlJZCkgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgcmVxdWVzdFBhdXNlW2xvdHRlcnlJZF0gPSB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRPd25lcihhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBnZXRUaWNrZXRzKHVpbnQ4IGxvdHRlcnlJZCkgcHVibGljIHZpZXcgcmV0dXJucyh1aW50OFtdKSB7CiAgICAgICAgdWludDhbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQ4W10obWF4VGlja2V0c1tsb3R0ZXJ5SWRdKTsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQxNiBpID0gMDsgaSA8IG1heFRpY2tldHNbbG90dGVyeUlkXTsgaSsrKSB7CiAgICAgICAgICAgIHJlc3VsdFtpXSA9IGdldDUxMihiaXRNYXNrRm9yUGxheUZpZWxkc1tsb3R0ZXJ5SWRdLGkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRMb3R0ZXJ5T3B0aW9ucyh1aW50OCBsb3R0ZXJ5SWQsdWludDI1NiBwcmljZSx1aW50MTYgdGlja2V0cyx1aW50MjU2IHRpbWVUb1JlZnVuZCkgcHVibGljIG93bmVyT25seSB7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShsb3R0ZXJ5SWQgPj0gMCAmJiBsb3R0ZXJ5SWQgPCAxMCk7CiAgICAgICAgLy8gb25seSBhbGxvdyBjaGFuZ2Ugb2YgbG90dGVyeSBvcHRzIHdoZW4gaXQncyBpbiBwYXVzZSBzdGF0ZSwgdW5pdGlhbGl6ZWQgb3Igbm8gdGlja2V0cyBhcmUgc29sZCB0aGVyZSB5ZXQKICAgICAgICByZXF1aXJlKHN0YXRlW2xvdHRlcnlJZF0gPT0gU3RhdGUuUGF1c2VkIHx8IHN0YXRlW2xvdHRlcnlJZF0gPT0gU3RhdGUuVW5pbml0aWFsaXplZCB8fCB0aWNrZXRzU29sZFtsb3R0ZXJ5SWRdID09IDApOwogICAgICAgIHJlcXVpcmUocHJpY2UgPiAwKTsKICAgICAgICByZXF1aXJlKHRpY2tldHMgPiAwICYmIHRpY2tldHMgPD0gNTAwKTsKICAgICAgICByZXF1aXJlKHRpbWVUb1JlZnVuZCA+PSA4NjQwMCk7IC8vIHJlcXVpcmUgYXQgbGVhc3Qgb25lIGRheSB0byBzZWxsIGFsbCB0aWNrZXRzCiAgICAgICAgCiAgICAgICAgdGlja2V0UHJpY2VbbG90dGVyeUlkXSA9IHByaWNlOwogICAgICAgIG1heFRpY2tldHNbbG90dGVyeUlkXSA9IHRpY2tldHM7CiAgICAgICAgbGlmZXRpbWVbbG90dGVyeUlkXSA9IHRpbWVUb1JlZnVuZDsKICAgICAgICAKICAgICAgICB0aWNrZXRzQWxsb2NhdG9yW2xvdHRlcnlJZF0ubGVuZ3RoID0gdGlja2V0czsKICAgICAgICAKICAgICAgICBjbGVhclN0YXRlKGxvdHRlcnlJZCk7CiAgICB9CiAgICAKICAgIC8vIHRoaXMgbWV0aG9kcyBjbGVhcnMgdGhlIHN0YXRlIAogICAgLy8gb2YgY3VycmVudCBsb3R0ZXJ5CiAgICBmdW5jdGlvbiBjbGVhclN0YXRlKHVpbnQ4IGxvdHRlcnlJZCkgcHJpdmF0ZSB7CiAgICAgICAgCiAgICAgICAgaWYgKCFyZXF1ZXN0UGF1c2VbbG90dGVyeUlkXSkgewogICAgICAgICAgICAKICAgICAgICAgICAgLy8gc2V0IHN0YXRlIG9mIGxvdHRlcnkgdG8gYHJ1bm5pbmdgCiAgICAgICAgICAgIHN0YXRlW2xvdHRlcnlJZF0gPSBTdGF0ZS5SdW5uaW5nOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gY2xlYXIgcmFuZG9tIG51bWJlciBkYXRhCiAgICAgICAgICAgIGNsZWFyTnVtYmVyKGxvdHRlcnlJZCk7CiAgICAgICAgCiAgICAgICAgICAgIC8vIHNldCBjdXJyZW50IHRpbWVzdGFtcCBhcyBzdGFydCB0aW1lCiAgICAgICAgICAgIHN0YXJ0ZWRbbG90dGVyeUlkXSAgPSBibG9jay50aW1lc3RhbXA7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBjbGVhciB0aW1lIG9mIGxhc3QgdGlja2V0IGJvdWdodAogICAgICAgICAgICBsYXN0VGlja2V0Qm91Z2h0W2xvdHRlcnlJZF0gPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gY2xlYXIgbnVtYmVyIG9mIHNvbGQgdGlja2V0cwogICAgICAgICAgICB0aWNrZXRzU29sZFtsb3R0ZXJ5SWRdID0gMDsKICAgICAgICAgICAKICAgICAgICAgICAgLy8gcmVtb3ZlIHByZXZpb3VzIHRpY2tldHMgb3duZXIgaW5mbwogICAgICAgICAgICBjbGVhcjUxMihiaXRNYXNrRm9yUGxheUZpZWxkc1tsb3R0ZXJ5SWRdKTsKICAgICAgICAgICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gc2V0IHN0YXRlIHRvIGBwYXVzZWAKICAgICAgICAgICAgc3RhdGVbbG90dGVyeUlkXSA9IFN0YXRlLlBhdXNlZDsKICAgICAgICAgICAgcmVxdWVzdFBhdXNlW2xvdHRlcnlJZF0gPSBmYWxzZTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBpc0luTGlzdChhZGRyZXNzIGVsZW1lbnQsYWRkcmVzc1tdIG1lbW9yeSBsaXN0KSBwcml2YXRlIHB1cmUgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGZvciAodWludDE2IGkgPTA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChsaXN0W2ldID09IGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFBsYXllcnModWludDggbG90dGVyeUlkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQxNixhZGRyZXNzW10sdWludDE2W10pIHsKICAgICAgICAKICAgICAgICBpZiAodGlja2V0c1NvbGRbbG90dGVyeUlkXSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDE2IGN1cnJlbnRVc2VyID0gMDsKICAgICAgICBhZGRyZXNzW10gbWVtb3J5IHJlc3VsdEFkZHIgPSBuZXcgYWRkcmVzc1tdKG1heFRpY2tldHNbbG90dGVyeUlkXSk7CiAgICAgICAgdWludDE2W10gbWVtb3J5IHJlc3VsdENvdW50ID0gbmV3IHVpbnQxNltdKG1heFRpY2tldHNbbG90dGVyeUlkXSk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MTYgdCA9IDA7IHQgPCBtYXhUaWNrZXRzW2xvdHRlcnlJZF07IHQrKykgewogICAgICAgICAgICB1aW50OCB0aWNrZXRCb3VnaHRIZXJlID0gZ2V0NTEyKGJpdE1hc2tGb3JQbGF5RmllbGRzW2xvdHRlcnlJZF0sdCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodGlja2V0Qm91Z2h0SGVyZSAhPSAwKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFkZHJlc3MgY3VycmVudEFkZHIgPSB0aWNrZXRzQWxsb2NhdG9yW2xvdHRlcnlJZF1bdF07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICghaXNJbkxpc3QoY3VycmVudEFkZHIscmVzdWx0QWRkcikpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIFBsYXllciBzdG9yYWdlIHBJbmZvID0gcGxheWVySW5mb01hcHBpbmdzW2xvdHRlcnlJZF1bY3VycmVudEFkZHJdOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJlc3VsdEFkZHJbY3VycmVudFVzZXJdID0gY3VycmVudEFkZHI7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Q291bnRbY3VycmVudFVzZXJdID0gcEluZm8udGlja2V0c0NvdW50OwogICAgICAgICAgICAgICAgICAgICsrY3VycmVudFVzZXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIChjdXJyZW50VXNlcixyZXN1bHRBZGRyLHJlc3VsdENvdW50KTsKICAgIH0KICAgIAogICAgLy8gaW4gY2FzZSBsb3R0ZXJ5IHRpY2tldHMgd2VyZW4ndCBzb2xkIGR1ZSBzb21lIHRpbWUgCiAgICAvLyBhbnlib2R5IHdobyBib3VnaHQgYSB0aWNrZXQgY2FuIAogICAgLy8gYXNrIHRvIHJlZnVuZCBtb25leSAoLSBjb21pc3Npb24gdG8gc2VuZCB0aGVtKSAKICAgIC8vIGZ1bmN0aW9uIHJlZnVuZCh1aW50OCBsb3R0ZXJ5SWQpIHB1YmxpYyB7CiAgICAgICAgCiAgICAvLyAgICAgLy8gcmVmdW5kIHN0YXRlIGNvdWxkIGJlIHJlYWNoZWQgb25seSBmcm9tIGBydW5uaW5nYCBzdGF0ZQogICAgLy8gICAgIHJlcXVpcmUgKHN0YXRlW2xvdHRlcnlJZF0gPT0gU3RhdGUuUnVubmluZyk7CiAgICAvLyAgICAgcmVxdWlyZSAoYmxvY2sudGltZXN0YW1wID4gKHN0YXJ0ZWRbbG90dGVyeUlkXSArIGxpZmV0aW1lW2xvdHRlcnlJZF0pKTsKICAgIC8vICAgICByZXF1aXJlICh0aWNrZXRzU29sZFtsb3R0ZXJ5SWRdIDwgbWF4VGlja2V0c1tsb3R0ZXJ5SWRdKTsKICAgICAgICAKICAgIC8vICAgICAvLyBjaGVjayBpZiBpdHMgYSBwZXJzb24gd2hpY2ggcGxheXMgdGhpcyBsb3R0ZXJ5CiAgICAvLyAgICAgLy8gb3IgaXQncyBhIGxvdHRlcnkgb3duZXIKICAgICAgICAKICAgIC8vICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3duZXIgIHx8IHBsYXllckluZm9NYXBwaW5nc1tsb3R0ZXJ5SWRdW21zZy5zZW5kZXJdLmNoYW5nZWRPbiA+IHN0YXJ0ZWRbbG90dGVyeUlkXSk7CiAgICAgICAgCiAgICAvLyAgICAgdWludDI1NiBub3RTZW5kID0gMDsKICAgICAgICAKICAgIC8vICAgICAvLyBkaXNhbGxvdyByZS1lbnRyYW5jeQogICAgLy8gICAgIC8vIHJlZnVuZCBwcm9jZXNzCiAgICAvLyAgICAgc3RhdGVbbG90dGVyeUlkXSA9IFN0YXRlLlJlZnVuZDsgCiAgICAgICAgCiAgICAvLyAgICAgZm9yICh1aW50MTYgaSA9IDA7IGkgPCBtYXhUaWNrZXRzW2xvdHRlcnlJZF07IGkrKykgewogICAgICAgICAgICAKICAgIC8vICAgICAgICAgYWRkcmVzcyB0T3duZXIgPSB0aWNrZXRzQWxsb2NhdG9yW2xvdHRlcnlJZF1baV07CiAgICAgICAgICAgIAogICAgLy8gICAgICAgICBpZiAodE93bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgIC8vICAgICAgICAgICAgIHVpbnQyNTYgdmFsdWUgPSBwbGF5ZXJJbmZvTWFwcGluZ3NbbG90dGVyeUlkXVt0T3duZXJdLnRpY2tldHNDb3VudCp0aWNrZXRQcmljZVtsb3R0ZXJ5SWRdOwogICAgICAgICAgICAgICAgICAgIAogICAgLy8gICAgICAgICAgICAgYm9vbCBzZW5kUmVzdWx0ID0gdE93bmVyLnNlbmQodmFsdWUpOwogICAgLy8gICAgICAgICAgICAgaWYgKCFzZW5kUmVzdWx0KSB7CiAgICAvLyAgICAgICAgICAgICAgICAgTG9zdFBheW1lbnQodE93bmVyLHZhbHVlKTsKICAgIC8vICAgICAgICAgICAgICAgICBub3RTZW5kICs9IHZhbHVlOwogICAgLy8gICAgICAgICAgICAgfQogICAgLy8gICAgICAgICB9CiAgICAvLyAgICAgfQogICAgICAgIAogICAgLy8gICAgIC8vIHNlbmQgcmVzdCB0byBvd25lciBpZiB0aGVyZSBhbnkKICAgIC8vICAgICBpZiAobm90U2VuZCA+IDApIHsKICAgIC8vICAgICAgICAgb3duZXIuc2VuZChub3RTZW5kKTsKICAgIC8vICAgICB9CiAgICAgICAgCiAgICAvLyAgICAgLy8gc3RhcnQgbmV3IGxvdHRlcnkgCiAgICAvLyAgICAgY2xlYXJTdGF0ZShsb3R0ZXJ5SWQpOwogICAgLy8gfQogICAgCiAgICAvLyB0aGlzIG1ldGhvZCBkZXRlcm1pbmVzIGN1cnJlbnQgZ2FtZSB3aW5uZXIKICAgIGZ1bmN0aW9uIGdldFdpbm5lcih1aW50OCBsb3R0ZXJ5SWQpIHByaXZhdGUgdmlldyByZXR1cm5zKHVpbnQxNixhZGRyZXNzKSB7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShzdGF0ZVtsb3R0ZXJ5SWRdID09IFN0YXRlLkZpbmlzaGVkKTsKICAgICAgCiAgICAgICAgLy8gYXBwbHkgbW9kdWxvIG9wZXJhdGlvbiAKICAgICAgICAvLyBzbyBhbnkgdGlja2V0IG51bWJlciB3b3VsZCBiZSB3aXRoaW4gMCBhbmQgdG90YWxUaWNrZXRzIHNvbGQKICAgICAgICB1aW50MTYgd2lubmluZ1RpY2tldCA9IHVpbnQxNihnZXROdW1iZXJWYWx1ZShsb3R0ZXJ5SWQpKSAlIG1heFRpY2tldHNbbG90dGVyeUlkXTsKICAgICAgICAKICAgICAgICByZXR1cm4gKHdpbm5pbmdUaWNrZXQsdGlja2V0c0FsbG9jYXRvcltsb3R0ZXJ5SWRdW3dpbm5pbmdUaWNrZXRdKTsKICAgIH0KICAgIAogICAgLy8gdGhpcyBtZXRob2QgaXMgdXNlZCB0byBmaW5hbGl6ZSBMb3R0ZXJ5CiAgICAvLyBpdCBnZW5lcmF0ZXMgcmFuZG9tIG51bWJlciBhbmQgc2VuZHMgcHJpemUKICAgIC8vIGl0IHVzZXMgMzIgYmxvY2tzIHRvIGdlbmVyYXRlIHBzZXVkbyByYW5kb20gCiAgICAvLyB2YWx1ZSB0byBkZXRlcm1pbmUgd2lubmVyIG9mIGxvdHRlcnkKICAgIGZ1bmN0aW9uIGZpbmFsaXplUm9vbSh1aW50OCBsb3R0ZXJ5SWQpIHB1YmxpYyB7CiAgICAgICAgCiAgICAgICAgLy8gaGVyZSB3ZSBjaGVjayBmb3IgcmUtZW50cmFuY3kKICAgICAgICByZXF1aXJlKHN0YXRlW2xvdHRlcnlJZF0gPT0gU3RhdGUuUnVubmluZyk7CiAgICAgICAgCiAgICAgICAgLy8gb25seSBpZiBhbGwgdGlja2V0cyBhcmUgc29sZAogICAgICAgIGlmICh0aWNrZXRzU29sZFtsb3R0ZXJ5SWRdID09IG1heFRpY2tldHNbbG90dGVyeUlkXSkgewogICAgICAgICAgICAKICAgICAgICAgICAgLy8gaWYgcmFuZCBudW1iZXIgaXMgbm90IHlldCBnZW5lcmF0ZWQKICAgICAgICAgICAgaWYgKGdlbmVyYXRlKGxvdHRlcnlJZCkpIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gcmFuZCBudW1iZXIgaXMgZ2VuZXJhdGVkCiAgICAgICAgICAgICAgICAvLyBzZXQgZmxhZyB0byBhbGxvdyBnZXR0aW5nIHdpbm5lcgogICAgICAgICAgICAgICAgLy8gZGlzYWJsZSByZS1lbnRyYW5jeQogICAgICAgICAgICAgICAgc3RhdGVbbG90dGVyeUlkXSA9IFN0YXRlLkZpbmlzaGVkOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB2YXIgKHdpbk51bWJlciwgd2lubmVyKSA9IGdldFdpbm5lcihsb3R0ZXJ5SWQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB1aW50MjU2IHByaXplVG90YWwgPSB0aWNrZXRzU29sZFtsb3R0ZXJ5SWRdKnRpY2tldFByaWNlW2xvdHRlcnlJZF07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIGF0IHN0YXJ0LCBvd25lciBjb21taXNpb24gdmFsdWUgZXF1YWxzIHRvIHRoZSBhcHByb3Byb2F0ZSBwZXJjZW50IG9mIHRoZSBqYWNrcG90CiAgICAgICAgICAgICAgICB1aW50MjU2IG93bmVyQ29tVmFsdWUgPSAoKHByaXplVG90YWwqb3duZXJDb21pc3Npb24pLzEwMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIHdpbm5lciBwcml6ZSBlcXVhbHMgdG90YWwgamFja3BvdCBzdW0gLSBvd25lciBjb21taXNpb24gdmFsdWUgaW4gYW55IGNhc2UKICAgICAgICAgICAgICAgIHVpbnQyNTYgcHJpemUgPSBwcml6ZVRvdGFsIC0gb3duZXJDb21WYWx1ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYWRkcmVzcyBhZmZpbGlhdGUgPSBhZmZpbGlhdGVzW3dpbm5lcl07CiAgICAgICAgICAgICAgICBpZiAoYWZmaWxpYXRlICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgICAgICAgICB1aW50MjU2IGFmZmlsaWF0ZVByaXplID0gKHByaXplVG90YWwqYWZmaWxpYXRlUGVyY2VudCkvMTAwOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGJvb2wgYWZQUmVzdWx0ID0gYWZmaWxpYXRlLnNlbmQoYWZmaWxpYXRlUHJpemUpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmICghYWZQUmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExvc3RQYXltZW50KGFmZmlsaWF0ZSxhZmZpbGlhdGVQcml6ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWludXMgYWZmaWxpYXRlIHByaXplIGFuZCAiZ2FzIHByaWNlIiBmb3IgdGhhdCB0eCBmcm9tIG93bmVycyBjb20gdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgb3duZXJDb21WYWx1ZSAtPSBhZmZpbGlhdGVQcml6ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIHBheSBwcml6ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBib29sIHByaXplU2VuZFJlc3VsdCA9IHdpbm5lci5zZW5kKHByaXplKTsKICAgICAgICAgICAgICAgIGlmICghcHJpemVTZW5kUmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgTG9zdFBheW1lbnQod2lubmVyLHByaXplKTsKICAgICAgICAgICAgICAgICAgICBvd25lckNvbVZhbHVlICs9IHByaXplOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBwdXQgd2lubmVyIHRvIHdpbm5lcnMKICAgICAgICAgICAgICAgIHVpbnQ4IHdpblBlcmNlbnQgPSB1aW50OCgoKHBsYXllckluZm9NYXBwaW5nc1tsb3R0ZXJ5SWRdW3dpbm5lcl0udGlja2V0c0NvdW50KjEwMCkvbWF4VGlja2V0c1tsb3R0ZXJ5SWRdKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFkZFdpbm5lcihwcml6ZSx3aW5uZXIsd2luTnVtYmVyLHdpblBlcmNlbnQpOwogICAgICAgICAgICAgICAgV2lubmVyUGlja2VkKGxvdHRlcnlJZCx3aW5uZXIsd2luTnVtYmVyKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gc2VuZCBvd25lciBjb21taXNpb24KICAgICAgICAgICAgICAgIG93bmVyLnNlbmQob3duZXJDb21WYWx1ZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNsZWFyU3RhdGUobG90dGVyeUlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgICAgICAgCiAgICBmdW5jdGlvbiBidXlUaWNrZXQodWludDggbG90dGVyeUlkLHVpbnQxNltdIHRpY2tldHMsYWRkcmVzcyByZWZlcmVyKSBwYXlhYmxlIHB1YmxpYyB7CiAgICAgICAgCiAgICAgICAgLy8gd2UncmUgYWN0dWFsbHkgaW4gYHJ1bm5pbmdgIHN0YXRlCiAgICAgICAgcmVxdWlyZShzdGF0ZVtsb3R0ZXJ5SWRdID09IFN0YXRlLlJ1bm5pbmcpOwogICAgICAgIAogICAgICAgIC8vIG5vdCBhbGwgdGlja2V0cyBhcmUgc29sZCB5ZXQKICAgICAgICByZXF1aXJlKG1heFRpY2tldHNbbG90dGVyeUlkXSA+IHRpY2tldHNTb2xkW2xvdHRlcnlJZF0pOwogICAgICAgIAogICAgICAgIGlmIChyZWZlcmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgc2V0UmVmZXJlcihyZWZlcmVyKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdWludDE2IHRpY2tldHNUb0J1eSA9IHVpbnQxNih0aWNrZXRzLmxlbmd0aCk7CiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgcGF5bWVudCBmb3IgdGlja2V0CiAgICAgICAgdWludDI1NiB2YWx1ZVJlcXVpcmVkID0gdGlja2V0c1RvQnV5KnRpY2tldFByaWNlW2xvdHRlcnlJZF07CiAgICAgICAgcmVxdWlyZSh2YWx1ZVJlcXVpcmVkIDw9IG1zZy52YWx1ZSk7CiAgICAgICAgCiAgICAgICAgLy8gc29mdCBjaGVjayBpZiBwbGF5ZXIgd2FudCB0byBidXkgZnJlZSB0aWNrZXRzCiAgICAgICAgcmVxdWlyZSgobWF4VGlja2V0c1tsb3R0ZXJ5SWRdIC0gdGlja2V0c1NvbGRbbG90dGVyeUlkXSkgPj0gdGlja2V0c1RvQnV5KTsgCiAgICAgICAgCiAgICAgICAgUGxheWVyIHN0b3JhZ2UgcEluZm8gPSBwbGF5ZXJJbmZvTWFwcGluZ3NbbG90dGVyeUlkXVttc2cuc2VuZGVyXTsKICAgICAgICBpZiAocEluZm8uY2hhbmdlZE9uIDwgc3RhcnRlZFtsb3R0ZXJ5SWRdKSB7CiAgICAgICAgICAgIHBJbmZvLmNoYW5nZWRPbiA9IGJsb2NrLnRpbWVzdGFtcDsKICAgICAgICAgICAgcEluZm8udGlja2V0c0NvdW50ID0gMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gY2hlY2sgcGVyY2VudGFnZSBvZiB1c2VyJ3MgdGlja2V0cwogICAgICAgIHJlcXVpcmUgKChwSW5mby50aWNrZXRzQ291bnQrdGlja2V0c1RvQnV5KSA8PSAoKG1heFRpY2tldHNbbG90dGVyeUlkXSptYXhQZXJjZW50UGVyUGxheWVyKS8xMDApKTsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQxNiBpOyBpIDwgdGlja2V0c1RvQnV5OyBpKyspIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlcXVpcmUoKHRpY2tldHNbaV0gLSAxKSA+PSAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGlmIHRoZSB0aWNrZXQgaXMgdGFrZW4geW91IHdvdWxkIGdldCB5b3VyIGV0aGVycyBiYWNrCiAgICAgICAgICAgIHJlcXVpcmUgKGdldDUxMihiaXRNYXNrRm9yUGxheUZpZWxkc1tsb3R0ZXJ5SWRdLHRpY2tldHNbaV0tMSkgPT0gMCk7CiAgICAgICAgICAgIHNldDUxMihiaXRNYXNrRm9yUGxheUZpZWxkc1tsb3R0ZXJ5SWRdLHRpY2tldHNbaV0tMSwxKTsKICAgICAgICAgICAgdGlja2V0c0FsbG9jYXRvcltsb3R0ZXJ5SWRdW3RpY2tldHNbaV0tMV0gPSBtc2cuc2VuZGVyOwogICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgcEluZm8udGlja2V0c0NvdW50ICs9IHRpY2tldHNUb0J1eTsKCiAgICAgICAgLy8gc2V0IGxhc3QgdGltZSBvZiBidXkKICAgICAgICBsYXN0VGlja2V0Qm91Z2h0W2xvdHRlcnlJZF0gPSBibG9jay50aW1lc3RhbXA7CiAgICAgICAgCiAgICAgICAgLy8gc2V0IG5ldyBhbW91bnQgb2YgdGlja2V0cwogICAgICAgIHRpY2tldHNTb2xkW2xvdHRlcnlJZF0gKz0gIHRpY2tldHNUb0J1eTsKICAgICAgICAKICAgICAgICAvLyBzdGFydCBwcm9jZXNzIG9mIHJhbmRvbSBudW1iZXIgZ2VuZXJhdGlvbiBpZiBsYXN0IHRpY2tldCB3YXMgc29sZCAKICAgICAgICBpZiAodGlja2V0c1NvbGRbbG90dGVyeUlkXSA9PSBtYXhUaWNrZXRzW2xvdHRlcnlJZF0pIHsKICAgICAgICAgICAgZmluYWxpemVSb29tKGxvdHRlcnlJZCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIGZpcmUgZXZlbnQKICAgICAgICBUaWNrZXRzQm91Z2h0KGxvdHRlcnlJZCxtc2cuc2VuZGVyLHRpY2tldHMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiByb29tTmVlZHNGaW5hbGl6YXRpb24odWludDggbG90dGVyeUlkKSBpbnRlcm5hbCB2aWV3ICByZXR1cm5zIChib29sKXsKICAgICAgICAgIHJldHVybiAoc3RhdGVbbG90dGVyeUlkXSA9PSBTdGF0ZS5SdW5uaW5nICYmICh0aWNrZXRzU29sZFtsb3R0ZXJ5SWRdID49IG1heFRpY2tldHNbbG90dGVyeUlkXSkgJiYgKChyYW5kb21CbG9ja1N0YXJ0W2xvdHRlcnlJZF0gPT0gMCkgfHwgKChyYW5kb21CbG9ja1N0YXJ0W2xvdHRlcnlJZF0gPiAwKSAmJiAoYmxvY2subnVtYmVyIC0gcmFuZG9tQmxvY2tTdGFydFtsb3R0ZXJ5SWRdKSA+PSAzMikpKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gRXRoZXJldW1KYWNrcG90KGFkZHJlc3Mgb3duZXJBZGRyZXNzKSBwdWJsaWMgewogICAgICAgIAogICAgICAgIHJlcXVpcmUob3duZXJBZGRyZXNzICE9IGFkZHJlc3MoMCkpOwogICAgICAgICAgICAKICAgICAgICBvd25lciA9IG93bmVyQWRkcmVzczsKICAgICAgICAKICAgICAgICB3aW5uZXJzLmxlbmd0aCA9IDU7CiAgICAgICAgd2lubmVyc0NvdW50ID0gMDsKICAgICAgICAKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYWRkV2lubmVyKHVpbnQyNTYgcHJpemUsYWRkcmVzcyB3aW5uZXIsdWludDE2IG51bWJlcix1aW50OCBwZXJjZW50KSBwcml2YXRlIHsKICAgICAgICAKICAgICAgICAvLyBjaGVjayB3aW5uZXJzIHNpemUgIGFuZCByZXNpemUgaXQgaWYgbmVlZGVkCiAgICAgICAgaWYgKHdpbm5lcnMubGVuZ3RoID09IHdpbm5lcnNDb3VudCkgewogICAgICAgICAgICB3aW5uZXJzLmxlbmd0aCArPSAxMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgd2lubmVyc1t3aW5uZXJzQ291bnQrK10gPSAgV2lubmVyKHByaXplLGJsb2NrLnRpbWVzdGFtcCx3aW5uZXIsbnVtYmVyLHBlcmNlbnQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBzZXRSZWZlcmVyKGFkZHJlc3MgYSkgcHJpdmF0ZSB7CiAgICAgICAgaWYgKGEgIT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICBhZGRyZXNzIGFkZHIgPSBhZmZpbGlhdGVzW21zZy5zZW5kZXJdOwogICAgICAgICAgICBpZiAoYWRkciA9PSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgICAgICBhZmZpbGlhdGVzW21zZy5zZW5kZXJdID0gYTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gLy8gcmV0dXJucyBvbmx5IHggbGFzdCB3aW5uZXJzIHRvIHByZXZlbnQgc3RhY2sgb3ZlcmZsb3cgb2Ygdm0KICAgIGZ1bmN0aW9uIGdldFdpbm5lcnModWludDI1NiBwYWdlKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTZbXSxhZGRyZXNzW10sdWludDI1NltdLHVpbnQxNltdLHVpbnQ4W10pIHsKICAgICAgICAKICAgICAgICBpbnQyNTYgc3RhcnQgPSB3aW5uZXJzQ291bnQgLSBpbnQyNTYoMTAqKHBhZ2UrMSkpOwogICAgICAgIGludDI1NiBlbmQgPSBzdGFydCsxMDsKICAgICAgICAKICAgICAgICBpZiAoc3RhcnQgPCAwKSB7CiAgICAgICAgICAgIHN0YXJ0ID0gMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGVuZCA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgIAogICAgICAgIGFkZHJlc3NbXSBtZW1vcnkgYWRkciA9IG5ldyBhZGRyZXNzW10odWludDI1NihlbmQtIHN0YXJ0KSk7CiAgICAgICAgdWludDI1NltdIG1lbW9yeSBzdW0gPSBuZXcgdWludDI1NltdKHVpbnQyNTYoZW5kLSBzdGFydCkpOwogICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgdGltZSA9IG5ldyB1aW50MjU2W10odWludDI1NihlbmQtIHN0YXJ0KSk7CiAgICAgICAgdWludDE2W10gbWVtb3J5IG51bWJlciA9IG5ldyB1aW50MTZbXSh1aW50MjU2KGVuZC0gc3RhcnQpKTsKICAgICAgICB1aW50OFtdIG1lbW9yeSBwZXJjZW50ID0gbmV3IHVpbnQ4W10odWludDI1NihlbmQtIHN0YXJ0KSk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50MjU2IGkgPSB1aW50MjU2KHN0YXJ0KTsgaSA8IHVpbnQyNTYoZW5kKTsgaSsrKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICBXaW5uZXIgc3RvcmFnZSB3aW5uZXIgPSB3aW5uZXJzW2ldOwogICAgICAgICAgICBhZGRyW2kgLSB1aW50MjU2KHN0YXJ0KV0gPSB3aW5uZXIuYWRkcjsKICAgICAgICAgICAgc3VtW2kgLSB1aW50MjU2KHN0YXJ0KV0gPSB3aW5uZXIucHJpemU7CiAgICAgICAgICAgIHRpbWVbaSAtIHVpbnQyNTYoc3RhcnQpXSA9IHdpbm5lci50aW1lc3RhbXA7CiAgICAgICAgICAgIG51bWJlcltpIC0gdWludDI1NihzdGFydCldID0gd2lubmVyLm51bWJlcjsKICAgICAgICAgICAgcGVyY2VudFtpIC0gdWludDI1NihzdGFydCldID0gd2lubmVyLnBlcmNlbnQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiAoc3VtLGFkZHIsdGltZSxudW1iZXIscGVyY2VudCk7CiAgICB9CiAgICAKICAgIAogICAgZnVuY3Rpb24gZ2V0Um9tbXMoKSBwdWJsaWMgdmlldyByZXR1cm5zKGJvb2xbXSBhY3RpdmUsdWludDI1NltdIHByaWNlLHVpbnQxNltdIHRpY2tldHMsdWludDE2W10gdGlja2V0c0JvdWdodCx1aW50MjU2W10gcHJpemUsdWludDI1NltdIGxhc3RBY3Rpdml0eSx1aW50OFtdIGNvbWlzc2lvbikgewogICAgICAgIAogICAgICAgIHVpbnQ4IHJvb21zQ291bnQgPSAxMDsKICAgICAgICAKICAgICAgICBwcmljZSA9IG5ldyB1aW50MjU2W10ocm9vbXNDb3VudCk7CiAgICAgICAgdGlja2V0cyA9IG5ldyB1aW50MTZbXShyb29tc0NvdW50KTsKICAgICAgICBsYXN0QWN0aXZpdHkgPSBuZXcgdWludDI1NltdKHJvb21zQ291bnQpOwogICAgICAgIHByaXplID0gbmV3IHVpbnQyNTZbXShyb29tc0NvdW50KTsKICAgICAgICBjb21pc3Npb24gPSBuZXcgdWludDhbXShyb29tc0NvdW50KTsKICAgICAgICBhY3RpdmUgPSBuZXcgYm9vbFtdKHJvb21zQ291bnQpOwogICAgICAgIHRpY2tldHNCb3VnaHQgPSBuZXcgdWludDE2W10ocm9vbXNDb3VudCk7CiAgICAgICAgCiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IHJvb21zQ291bnQ7IGkrKykgewogICAgICAgICAgICBwcmljZVtpXSA9IHRpY2tldFByaWNlW2ldOwogICAgICAgICAgICB0aWNrZXRzQm91Z2h0W2ldID0gdGlja2V0c1NvbGRbaV07CiAgICAgICAgICAgIHRpY2tldHNbaV0gPSBtYXhUaWNrZXRzW2ldOwogICAgICAgICAgICBwcml6ZVtpXSA9IG1heFRpY2tldHNbaV0qdGlja2V0UHJpY2VbaV07CiAgICAgICAgICAgIGxhc3RBY3Rpdml0eVtpXSAgPSBsYXN0VGlja2V0Qm91Z2h0W2ldOwogICAgICAgICAgICBjb21pc3Npb25baV0gPSBvd25lckNvbWlzc2lvbjsKICAgICAgICAgICAgYWN0aXZlW2ldID0gc3RhdGVbaV0gIT0gU3RhdGUuUGF1c2VkICYmIHN0YXRlW2ldICE9IFN0YXRlLlVuaW5pdGlhbGl6ZWQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiAoYWN0aXZlLHByaWNlLHRpY2tldHMsdGlja2V0c0JvdWdodCxwcml6ZSxsYXN0QWN0aXZpdHksY29taXNzaW9uKTsKICAgIH0KICAgIAogICAgLy8gdGhpcyBmdW5jdGlvbiBhbGxvd3MgdG8gZGVzdHJveSBjdXJyZW50IGNvbnRyYWN0IGluIGNhc2UgYWxsIHJvb21zIGFyZSBwYXVzZWQgb3Igbm90IHVzZWQKICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSBwdWJsaWMgb3duZXJPbmx5IHsKICAgICAgICAKICAgICAgICBmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICAvLyBwYXVzZWQgb3IgdW5pbml0aWFsaXplZCAKICAgICAgICAgICAgcmVxdWlyZShzdGF0ZVtpXSA9PSBTdGF0ZS5QYXVzZWQgfHwgc3RhdGVbaV0gPT0gU3RhdGUuVW5pbml0aWFsaXplZCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNlbGZkZXN0cnVjdChvd25lcik7CiAgICB9CiAgICAKICAgIC8vIGZpbmFsaXplIG1ldGhvZHMKICAgIGZ1bmN0aW9uIG5lZWRzRmluYWxpemF0aW9uKCkgcHVibGljIHZpZXcgcmV0dXJucyhib29sKSB7CiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgaWYgKHJvb21OZWVkc0ZpbmFsaXphdGlvbihpKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyB7CiAgICAgICAgZm9yICh1aW50OCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgaWYgKHJvb21OZWVkc0ZpbmFsaXphdGlvbihpKSkgewogICAgICAgICAgICAgICAgZmluYWxpemVSb29tKGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgfQp9'.
	

]
