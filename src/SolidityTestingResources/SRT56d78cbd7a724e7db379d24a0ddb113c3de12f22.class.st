Class {
	#name : #SRT56d78cbd7a724e7db379d24a0ddb113c3de12f22,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT56d78cbd7a724e7db379d24a0ddb113c3de12f22 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMjA7CgovLyBGaWxlOiBjb250cmFjdHMvT3duYWJsZS5zb2wKCi8qKgogKiBAdGl0bGUgT3duYWJsZQogKiBAZGV2IFRoZSBPd25hYmxlIGNvbnRyYWN0IGhhcyBhbiBvd25lciBhZGRyZXNzLCBhbmQgcHJvdmlkZXMgYmFzaWMgYXV0aG9yaXphdGlvbiBjb250cm9sCiAqIGZ1bmN0aW9ucywgdGhpcyBzaW1wbGlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiAidXNlciBwZXJtaXNzaW9ucyIuCiAqLwpjb250cmFjdCBPd25hYmxlIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgICBldmVudCBPd25lcnNoaXBUcmFuc2ZlcnJlZChhZGRyZXNzIGluZGV4ZWQgcHJldmlvdXNPd25lciwgYWRkcmVzcyBpbmRleGVkIG5ld093bmVyKTsKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICAgIGZ1bmN0aW9uIE93bmFibGUoKSBwdWJsaWMgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogICAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogICAgZnVuY3Rpb24gdHJhbnNmZXJPd25lcnNoaXAoYWRkcmVzcyBuZXdPd25lcikgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG5ld093bmVyICE9IGFkZHJlc3MoMCkpOwogICAgICAgIGVtaXQgT3duZXJzaGlwVHJhbnNmZXJyZWQob3duZXIsIG5ld093bmVyKTsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQoKfQoKLy8gRmlsZTogY29udHJhY3RzL0VSQzIwQmFzaWMuc29sCgovKioKICogQHRpdGxlIEVSQzIwQmFzaWMKICogQGRldiBTaW1wbGVyIHZlcnNpb24gb2YgRVJDMjAgaW50ZXJmYWNlCiAqIEBkZXYgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNzkKICovCmNvbnRyYWN0IEVSQzIwQmFzaWMgewogICAgZnVuY3Rpb24gdG90YWxTdXBwbHkoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIGJhbGFuY2VPZihhZGRyZXNzIHdobykgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1Nik7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckludGVybmFsKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUpIGludGVybmFsIHJldHVybnMgKGJvb2wpOwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB2YWx1ZSk7Cn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9TYWZlTWF0aC5zb2wKCi8qKgogKiBAdGl0bGUgU2FmZU1hdGgKICogQGRldiBNYXRoIG9wZXJhdGlvbnMgd2l0aCBzYWZldHkgY2hlY2tzIHRoYXQgdGhyb3cgb24gZXJyb3IKICovCmxpYnJhcnkgU2FmZU1hdGggewoKICAvKioKICAqIEBkZXYgTXVsdGlwbGllcyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93LgogICovCiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGlmIChhID09IDApIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgIHJldHVybiBjOwogIH0KCiAgLyoqCiAgKiBAZGV2IEludGVnZXIgZGl2aXNpb24gb2YgdHdvIG51bWJlcnMsIHRydW5jYXRpbmcgdGhlIHF1b3RpZW50LgogICovCiAgZnVuY3Rpb24gZGl2KHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgdWludDI1NiBjID0gYSAvIGI7CiAgICAvLyBhc3NlcnQoYSA9PSBiICogYyArIGEgJSBiKTsgLy8gVGhlcmUgaXMgbm8gY2FzZSBpbiB3aGljaCB0aGlzIGRvZXNuJ3QgaG9sZAogICAgcmV0dXJuIGM7CiAgfQoKICAvKioKICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICovCiAgZnVuY3Rpb24gc3ViKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgIGFzc2VydChiIDw9IGEpOwogICAgcmV0dXJuIGEgLSBiOwogIH0KCiAgLyoqCiAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAqLwogIGZ1bmN0aW9uIGFkZCh1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICsgYjsKICAgIGFzc2VydChjID49IGEpOwogICAgcmV0dXJuIGM7CiAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvQmFzaWNUb2tlbi5zb2wKCi8qKgogKiBAdGl0bGUgQmFzaWMgdG9rZW4KICogQGRldiBCYXNpYyB2ZXJzaW9uIG9mIFN0YW5kYXJkVG9rZW4sIHdpdGggbm8gYWxsb3dhbmNlcy4KICovCmNvbnRyYWN0IEJhc2ljVG9rZW4gaXMgRVJDMjBCYXNpYyB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogICAgdWludDI1NiB0b3RhbFN1cHBseV87CgogIC8qKgogICogQGRldiB0b3RhbCBudW1iZXIgb2YgdG9rZW5zIGluIGV4aXN0ZW5jZQogICovCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gdG90YWxTdXBwbHlfOwogICAgfQoKICAvKioKICAqIEBkZXYgdHJhbnNmZXIgdG9rZW4gZm9yIGEgc3BlY2lmaWVkIGFkZHJlc3MKICAqIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgdG8uCiAgKiBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91bnQgdG8gYmUgdHJhbnNmZXJyZWQuCiAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVySW50ZXJuYWwoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYmFsYW5jZXNbbXNnLnNlbmRlcl0pOwoKICAgICAgICAvLyBTYWZlTWF0aC5zdWIgd2lsbCB0aHJvdyBpZiB0aGVyZSBpcyBub3QgZW5vdWdoIGJhbGFuY2UuCiAgICAgICAgYmFsYW5jZXNbbXNnLnNlbmRlcl0gPSBiYWxhbmNlc1ttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgICAgICBlbWl0IFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1tfb3duZXJdOwogICAgfQoKfQoKLy8gRmlsZTogY29udHJhY3RzL0VSQzIwLnNvbAoKLyoqCiAqIEB0aXRsZSBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqLwpjb250cmFjdCBFUkMyMCBpcyBFUkMyMEJhc2ljIHsKICAgIGZ1bmN0aW9uIGFsbG93YW5jZUludGVybmFsKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2KTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbUludGVybmFsKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCk7CiAgICBmdW5jdGlvbiBhcHByb3ZlSW50ZXJuYWwoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKTsKICAgIGV2ZW50IEFwcHJvdmFsKGFkZHJlc3MgaW5kZXhlZCBvd25lciwgYWRkcmVzcyBpbmRleGVkIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpOwp9CgovLyBGaWxlOiBjb250cmFjdHMvU3RhbmRhcmRUb2tlbi5zb2wKCi8qKgogKiBAdGl0bGUgU3RhbmRhcmQgRVJDMjAgdG9rZW4KICoKICogQGRldiBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgYmFzaWMgc3RhbmRhcmQgdG9rZW4uCiAqIEBkZXYgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwCiAqIEBkZXYgQmFzZWQgb24gY29kZSBieSBGaXJzdEJsb29kOiBodHRwczovL2dpdGh1Yi5jb20vRmlyc3RibG9vZGlvL3Rva2VuL2Jsb2IvbWFzdGVyL3NtYXJ0X2NvbnRyYWN0L0ZpcnN0Qmxvb2RUb2tlbi5zb2wKICovCmNvbnRyYWN0IFN0YW5kYXJkVG9rZW4gaXMgRVJDMjAsIEJhc2ljVG9rZW4gewoKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgaW50ZXJuYWwgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbUludGVybmFsKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHJlcXVpcmUoX3ZhbHVlIDw9IGJhbGFuY2VzW19mcm9tXSk7CiAgICAgICAgcmVxdWlyZShfdmFsdWUgPD0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0pOwoKICAgICAgICBiYWxhbmNlc1tfZnJvbV0gPSBiYWxhbmNlc1tfZnJvbV0uc3ViKF92YWx1ZSk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICAgICAgYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl0gPSBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXS5zdWIoX3ZhbHVlKTsKICAgICAgICBlbWl0IFRyYW5zZmVyKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogIC8qKgogICAqIEBkZXYgQXBwcm92ZSB0aGUgcGFzc2VkIGFkZHJlc3MgdG8gc3BlbmQgdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgdG9rZW5zIG9uIGJlaGFsZiBvZiBtc2cuc2VuZGVyLgogICAqCiAgICogQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQgc29tZW9uZSBtYXkgdXNlIGJvdGggdGhlIG9sZAogICAqIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZSB0cmFuc2FjdGlvbiBvcmRlcmluZy4gT25lIHBvc3NpYmxlIHNvbHV0aW9uIHRvIG1pdGlnYXRlIHRoaXMKICAgKiByYWNlIGNvbmRpdGlvbiBpcyB0byBmaXJzdCByZWR1Y2UgdGhlIHNwZW5kZXIncyBhbGxvd2FuY2UgdG8gMCBhbmQgc2V0IHRoZSBkZXNpcmVkIHZhbHVlIGFmdGVyd2FyZHM6CiAgICogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzIwI2lzc3VlY29tbWVudC0yNjM1MjQ3MjkKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF92YWx1ZSBUaGUgYW1vdW50IG9mIHRva2VucyB0byBiZSBzcGVudC4KICAgKi8KICAgIGZ1bmN0aW9uIGFwcHJvdmVJbnRlcm5hbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogICAgZnVuY3Rpb24gYWxsb3dhbmNlSW50ZXJuYWwoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhbGxvd2VkW19vd25lcl1bX3NwZW5kZXJdOwogICAgfQoKICAvKioKICAgKiBAZGV2IEluY3JlYXNlIHRoZSBhbW91bnQgb2YgdG9rZW5zIHRoYXQgYW4gb3duZXIgYWxsb3dlZCB0byBhIHNwZW5kZXIuCiAgICoKICAgKiBhcHByb3ZlIHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhbGxvd2VkW19zcGVuZGVyXSA9PSAwLiBUbyBpbmNyZW1lbnQKICAgKiBhbGxvd2VkIHZhbHVlIGlzIGJldHRlciB0byB1c2UgdGhpcyBmdW5jdGlvbiB0byBhdm9pZCAyIGNhbGxzIChhbmQgd2FpdCB1bnRpbAogICAqIHRoZSBmaXJzdCB0cmFuc2FjdGlvbiBpcyBtaW5lZCkKICAgKiBGcm9tIE1vbm9saXRoREFPIFRva2VuLnNvbAogICAqIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB3aGljaCB3aWxsIHNwZW5kIHRoZSBmdW5kcy4KICAgKiBAcGFyYW0gX2FkZGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gaW5jcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgKi8KICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWxJbnRlcm5hbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgLyoqCiAgICogQGRldiBEZWNyZWFzZSB0aGUgYW1vdW50IG9mIHRva2VucyB0aGF0IGFuIG93bmVyIGFsbG93ZWQgdG8gYSBzcGVuZGVyLgogICAqCiAgICogYXBwcm92ZSBzaG91bGQgYmUgY2FsbGVkIHdoZW4gYWxsb3dlZFtfc3BlbmRlcl0gPT0gMC4gVG8gZGVjcmVtZW50CiAgICogYWxsb3dlZCB2YWx1ZSBpcyBiZXR0ZXIgdG8gdXNlIHRoaXMgZnVuY3Rpb24gdG8gYXZvaWQgMiBjYWxscyAoYW5kIHdhaXQgdW50aWwKICAgKiB0aGUgZmlyc3QgdHJhbnNhY3Rpb24gaXMgbWluZWQpCiAgICogRnJvbSBNb25vbGl0aERBTyBUb2tlbi5zb2wKICAgKiBAcGFyYW0gX3NwZW5kZXIgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zdWJ0cmFjdGVkVmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gZGVjcmVhc2UgdGhlIGFsbG93YW5jZSBieS4KICAgKi8KICAgIGZ1bmN0aW9uIGRlY3JlYXNlQXBwcm92YWxJbnRlcm5hbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9zdWJ0cmFjdGVkVmFsdWUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICAgICAgaWYgKF9zdWJ0cmFjdGVkVmFsdWUgPiBvbGRWYWx1ZSkgewogICAgICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXSA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBvbGRWYWx1ZS5zdWIoX3N1YnRyYWN0ZWRWYWx1ZSk7CiAgICAgICAgfQogICAgICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCn0KCi8vIEZpbGU6IGNvbnRyYWN0cy9NaW50YWJsZVRva2VuLnNvbAoKLy9pbXBvcnQgIi4vU3RhbmRhcmRUb2tlbi5zb2wiOwovL2ltcG9ydCAiLi4vLi4vb3duZXJzaGlwL093bmFibGUuc29sIjsKCgoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbgogKiBAZGV2IFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqIEBkZXYgSXNzdWU6ICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9pc3N1ZXMvMTIwCiAqIEJhc2VkIG9uIGNvZGUgYnkgVG9rZW5NYXJrZXROZXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvY29udHJhY3RzL01pbnRhYmxlVG9rZW4uc29sCiAqLwpjb250cmFjdCBNaW50YWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIE93bmFibGUgewogICAgZXZlbnQgTWludChhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgYW1vdW50KTsKICAgIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICAgIGJvb2wgcHVibGljIG1pbnRpbmdGaW5pc2hlZCA9IGZhbHNlOwogICAgYWRkcmVzcyBwdWJsaWMgaWNvQ29udHJhY3RBZGRyZXNzOwoKICAgIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICAgICAgcmVxdWlyZSghbWludGluZ0ZpbmlzaGVkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgaWNvQ29udHJhY3QuCiAgICAqLwogICAgbW9kaWZpZXIgb25seUljb0NvbnRyYWN0KCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBpY29Db250cmFjdEFkZHJlc3MpOwogICAgICAgIF87CiAgICB9CiAgCgogICAgLyoqCiAgICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWludGVkIHRva2Vucy4KICAgICogQHBhcmFtIF9hbW91bnQgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gbWludC4KICAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgICovCiAgICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlJY29Db250cmFjdCBjYW5NaW50IGV4dGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAvL3JldHVybiB0cnVlOwogICAgICAgIHRvdGFsU3VwcGx5XyA9IHRvdGFsU3VwcGx5Xy5hZGQoX2Ftb3VudCk7CiAgICAgICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF9hbW91bnQpOwogICAgICAgIGVtaXQgTWludChfdG8sIF9hbW91bnQpOwogICAgICAgIGVtaXQgVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgRnVuY3Rpb24gdG8gc3RvcCBtaW50aW5nIG5ldyB0b2tlbnMuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgICAqLwogICAgZnVuY3Rpb24gZmluaXNoTWludGluZygpIG9ubHlPd25lciBjYW5NaW50IGV4dGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgICAgIGVtaXQgTWludEZpbmlzaGVkKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvUGF1c2FibGUuc29sCgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogICAgZXZlbnQgUGF1c2UoKTsKICAgIGV2ZW50IFVucGF1c2UoKTsKCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICAgIG1vZGlmaWVyIHdoZW5QYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZShwYXVzZWQpOwogICAgICAgIF87CiAgICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogICAgZnVuY3Rpb24gcGF1c2UoKSBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCBleHRlcm5hbCB7CiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICBlbWl0IFBhdXNlKCk7CiAgICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byB1bnBhdXNlLCByZXR1cm5zIHRvIG5vcm1hbCBzdGF0ZQogICAqLwogICAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIGV4dGVybmFsIHsKICAgICAgICBwYXVzZWQgPSBmYWxzZTsKICAgICAgICBlbWl0IFVucGF1c2UoKTsKICAgIH0KfQoKLy8gRmlsZTogY29udHJhY3RzL1BhdXNhYmxlVG9rZW4uc29sCgovKioKICogQHRpdGxlIFBhdXNhYmxlIHRva2VuCiAqIEBkZXYgU3RhbmRhcmRUb2tlbiBtb2RpZmllZCB3aXRoIHBhdXNhYmxlIHRyYW5zZmVycy4KICoqLwpjb250cmFjdCBQYXVzYWJsZVRva2VuIGlzIFN0YW5kYXJkVG9rZW4sIFBhdXNhYmxlIHsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlckludGVybmFsKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVySW50ZXJuYWwoX3RvLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbUludGVybmFsKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgaW50ZXJuYWwgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbUludGVybmFsKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwcm92ZUludGVybmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBpbnRlcm5hbCB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gc3VwZXIuYXBwcm92ZUludGVybmFsKF9zcGVuZGVyLCBfdmFsdWUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWxJbnRlcm5hbChhZGRyZXNzIF9zcGVuZGVyLCB1aW50IF9hZGRlZFZhbHVlKSBpbnRlcm5hbCB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiBzdXBlci5pbmNyZWFzZUFwcHJvdmFsSW50ZXJuYWwoX3NwZW5kZXIsIF9hZGRlZFZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsSW50ZXJuYWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKSBpbnRlcm5hbCB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHJldHVybiBzdXBlci5kZWNyZWFzZUFwcHJvdmFsSW50ZXJuYWwoX3NwZW5kZXIsIF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQp9CgovLyBGaWxlOiBjb250cmFjdHMvUmVlbnRyYW5jeUd1YXJkLnNvbAoKLyoqCiAqIEB0aXRsZSBIZWxwcyBjb250cmFjdHMgZ3VhcmQgYWdhaW5zIHJlZW50cmFuY3kgYXR0YWNrcy4KICogQGF1dGhvciBSZW1jbyBCbG9lbWVuIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iNTAyMjM1M2QzMzNmMTA2MiI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT7PgC5jb20+CiAqIEBub3RpY2UgSWYgeW91IG1hcmsgYSBmdW5jdGlvbiBgbm9uUmVlbnRyYW50YCwgeW91IHNob3VsZCBhbHNvCiAqIG1hcmsgaXQgYGV4dGVybmFsYC4KICovCmNvbnRyYWN0IFJlZW50cmFuY3lHdWFyZCB7CgogIC8qKgogICAqIEBkZXYgV2UgdXNlIGEgc2luZ2xlIGxvY2sgZm9yIHRoZSB3aG9sZSBjb250cmFjdC4KICAgKi8KICBib29sIHByaXZhdGUgcmVlbnRyYW5jeV9sb2NrID0gZmFsc2U7CgogIC8qKgogICAqIEBkZXYgUHJldmVudHMgYSBjb250cmFjdCBmcm9tIGNhbGxpbmcgaXRzZWxmLCBkaXJlY3RseSBvciBpbmRpcmVjdGx5LgogICAqIEBub3RpY2UgSWYgeW91IG1hcmsgYSBmdW5jdGlvbiBgbm9uUmVlbnRyYW50YCwgeW91IHNob3VsZCBhbHNvCiAgICogbWFyayBpdCBgZXh0ZXJuYWxgLiBDYWxsaW5nIG9uZSBub25SZWVudHJhbnQgZnVuY3Rpb24gZnJvbQogICAqIGFub3RoZXIgaXMgbm90IHN1cHBvcnRlZC4gSW5zdGVhZCwgeW91IGNhbiBpbXBsZW1lbnQgYQogICAqIGBwcml2YXRlYCBmdW5jdGlvbiBkb2luZyB0aGUgYWN0dWFsIHdvcmssIGFuZCBhIGBleHRlcm5hbGAKICAgKiB3cmFwcGVyIG1hcmtlZCBhcyBgbm9uUmVlbnRyYW50YC4KICAgKi8KICBtb2RpZmllciBub25SZWVudHJhbnQoKSB7CiAgICByZXF1aXJlKCFyZWVudHJhbmN5X2xvY2spOwogICAgcmVlbnRyYW5jeV9sb2NrID0gdHJ1ZTsKICAgIF87CiAgICByZWVudHJhbmN5X2xvY2sgPSBmYWxzZTsKICB9Cgp9CgovLyBGaWxlOiBjb250cmFjdHMvSWlpbm9Db2luLnNvbAoKY29udHJhY3QgSWlpbm9Db2luIGlzIE1pbnRhYmxlVG9rZW4sIFBhdXNhYmxlVG9rZW4sIFJlZW50cmFuY3lHdWFyZCB7CiAgICBldmVudCBSZXdhcmRNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogICAgZXZlbnQgUmV3YXJkTWludGluZ0FtdCh1aW50MjU2IF9hbW91bnRPZlRva2Vuc01pbnRlZFByZUN5Y2xlKTsKICAgIGV2ZW50IFJlc2V0UmV3YXJkKCk7CiAgICBldmVudCBSZWRlZW1SZXdhcmQoYWRkcmVzcyBpbmRleGVkIHRvLCB1aW50MjU2IHZhbHVlKTsKCiAgICBldmVudCBDcmVhdGVkRXNjcm93KGJ5dGVzMzIgX3RyYWRlSGFzaCk7CiAgICBldmVudCBSZWxlYXNlZEVzY3JvdyhieXRlczMyIF90cmFkZUhhc2gpOwogICAgZXZlbnQgRGlzcHV0ZShieXRlczMyIF90cmFkZUhhc2gpOwogICAgZXZlbnQgQ2FuY2VsbGVkQnlTZWxsZXIoYnl0ZXMzMiBfdHJhZGVIYXNoKTsKICAgIGV2ZW50IENhbmNlbGxlZEJ5QnV5ZXIoYnl0ZXMzMiBfdHJhZGVIYXNoKTsKICAgIGV2ZW50IEJ1eWVyQXJiaXRyYXRvclNldChieXRlczMyIF90cmFkZUhhc2gpOwogICAgZXZlbnQgU2VsbGVyQXJiaXRyYXRvclNldChieXRlczMyIF90cmFkZUhhc2gpOwogICAgZXZlbnQgRGlzcHV0ZVJlc29sdmVkIChieXRlczMyIF90cmFkZUhhc2gpOwogICAgZXZlbnQgSWNvQ29udHJhY3RBZGRyZXNzU2V0IChhZGRyZXNzIF9pY29Db250cmFjdEFkZHJlc3MpOwogICAgCiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIAogICAgLy8gTWFwcGluZyBvZiByZXdhcmRzIHRvIGJlbmVmaWNpYXJpZXMgb2YgdGhlIHJld2FyZAogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyByZXdhcmQ7CiAgCiAgICBzdHJpbmcgcHVibGljIG5hbWU7CiAgICBzdHJpbmcgcHVibGljIHN5bWJvbDsKICAgIHVpbnQ4IHB1YmxpYyBkZWNpbWFsczsKCiAgICB1aW50MjU2IHB1YmxpYyBhbW91bnRNaW50UGVyRHVyYXRpb247IC8vIGFtb3VudCB0byBtaW50IGR1cmluZyBvbmUgbWludGluZyBjeWNsZQogICAgdWludDI1NiBwdWJsaWMgZHVyYXRpb25CZXR3ZWVuUmV3YXJkTWludHM7IC8vIHJld2FyZCBtaW5pdGluZyBjeWNsZSBkdXJhdGlvbgogICAgdWludDI1NiBwdWJsaWMgcHJldmlvdXNEaXN0cmlidXRpb247IC8vRVBPQ0ggdGltZSBvZiB0aGUgcHJldmlvdXMgZGlzdHJpYnV0aW9uCiAgICB1aW50MjU2IHB1YmxpYyB0b3RhbFJld2FyZHNEaXN0cmlidXRlZDsgLy9Ub3RhbCBhbW91bnQgb2YgdGhlIHJld2FyZHMgZGlzdHJpYnV0ZWQKICAgIHVpbnQyNTYgcHVibGljIHRvdGFsUmV3YXJkc1JlZGVlbWVkOyAvL1RvdGFsIGFtb3VudCBvZiB0aGUgcmV3YXJkcyByZWRlZW1lZAogICAgdWludDI1NiBwdWJsaWMgbWluaW11bVJld2FyZFdpdGhkcmF3YWxMaW1pdDsgLy9UaGUgbWluaW11bSBsaW1pdCBvZiByZXdhcmRzIHRoYXQgY2FuIGJlIHdpdGhkcmF3bgogICAgdWludDI1NiBwdWJsaWMgcmV3YXJkQXZhaWxhYmxlQ3VycmVudERpc3RyaWJ1dGlvbjsgLy9UaGUgYW1vdW50IG9mIHJld2FyZHMgYXZhaWxhYmxlIGZvciB0aGUgY3VycmVudCBEaXN0cmlidXRpb24uCgogICAgZnVuY3Rpb24gSWlpbm9Db2luKAogICAgICAgIHN0cmluZyBfbmFtZSwgCiAgICAgICAgc3RyaW5nIF9zeW1ib2wsIAogICAgICAgIHVpbnQ4IF9kZWNpbWFscywgCiAgICAgICAgdWludDI1NiBfYW1vdW50TWludFBlckR1cmF0aW9uLCAKICAgICAgICB1aW50MjU2IF9kdXJhdGlvbkJldHdlZW5SZXdhcmRNaW50cyAKICAgICkgcHVibGljIHsKICAgICAgICBuYW1lID0gX25hbWU7CiAgICAgICAgc3ltYm9sID0gX3N5bWJvbDsKICAgICAgICBkZWNpbWFscyA9IF9kZWNpbWFsczsKCiAgICAgICAgYW1vdW50TWludFBlckR1cmF0aW9uID0gX2Ftb3VudE1pbnRQZXJEdXJhdGlvbjsKICAgICAgICBkdXJhdGlvbkJldHdlZW5SZXdhcmRNaW50cyA9IF9kdXJhdGlvbkJldHdlZW5SZXdhcmRNaW50czsKICAgICAgICBwcmV2aW91c0Rpc3RyaWJ1dGlvbiA9IG5vdzsgLy8gVG8gaW5pdGlhbGl6ZSB0aGUgcHJldmlvdXMgZGlzdHJpYnV0aW9uIHRvIHRoZSB0aW1lIG9mIHRoZSBjcmVhdGlvbiBvZiB0aGUgY29udHJhY3QKICAgICAgICB0b3RhbFJld2FyZHNEaXN0cmlidXRlZCA9IDA7CiAgICAgICAgdG90YWxSZXdhcmRzUmVkZWVtZWQgPSAwOwogICAgICAgIG1pbmltdW1SZXdhcmRXaXRoZHJhd2FsTGltaXQgPSAxMCBldGhlcjsgLy9EZWZhdWx0ZWQgdG8gMTAgaWlpbm9zIHJlcHJlc2VudGVkIGluIGlpaQogICAgICAgIHJld2FyZEF2YWlsYWJsZUN1cnJlbnREaXN0cmlidXRpb24gPSBhbW91bnRNaW50UGVyRHVyYXRpb247CiAgICAgICAgaWNvQ29udHJhY3RBZGRyZXNzID0gbXNnLnNlbmRlcjsgCiAgICB9CiAgICAKICAgIC8qKgogICAgKiBAZGV2IHNldCB0aGUgaWNvQ29udHJhY3RBZGRyZXNzIGluIHRoZSB0b2tlbiBzbyB0aGF0IHRoZSBpY28gQ29udHJhY3QgY2FuIG1pbnQgdGhlIHRva2VuCiAgICAqIEBwYXJhbSBfaWNvQ29udHJhY3RBZGRyZXNzIGFycmF5IG9mIGFkZHJlc3MuIFRoZSBhZGRyZXNzIHRvIHdoaWNoIHRoZSByZXdhcmQgbmVlZHMgdG8gYmUgZGlzdHJpYnV0ZWQKICAgICovCiAgICBmdW5jdGlvbiBzZXRJY29Db250cmFjdEFkZHJlc3MoCiAgICAgICAgYWRkcmVzcyBfaWNvQ29udHJhY3RBZGRyZXNzCiAgICApIGV4dGVybmFsIG5vblJlZW50cmFudCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcmVxdWlyZSAoX2ljb0NvbnRyYWN0QWRkcmVzcyAhPSBhZGRyZXNzKDApKTsKICAgICAgICBlbWl0IEljb0NvbnRyYWN0QWRkcmVzc1NldChfaWNvQ29udHJhY3RBZGRyZXNzKTsKICAgICAgICBpY29Db250cmFjdEFkZHJlc3MgPSBfaWNvQ29udHJhY3RBZGRyZXNzOyAgICAKICAgIH0KCiAgICAvKioKICAgICogQGRldiBkaXN0cmlidXRlIHJld2FyZCB0b2tlbnMgdG8gdGhlIGxpc3Qgb2YgYWRkcmVzc2VzIGJhc2VkIG9uIHRoZWlyIHByb3BvcnRpb24KICAgICogQHBhcmFtIF9yZXdhcmRBZHJlc3NlcyBhcnJheSBvZiBhZGRyZXNzLiBUaGUgYWRkcmVzcyB0byB3aGljaCB0aGUgcmV3YXJkIG5lZWRzIHRvIGJlIGRpc3RyaWJ1dGVkCiAgICAqLwogICAgZnVuY3Rpb24gYmF0Y2hEaXN0cmlidXRlUmV3YXJkKAogICAgICAgIGFkZHJlc3NbXSBfcmV3YXJkQWRyZXNzZXMsCiAgICAgICAgdWludDI1NltdIF9hbW91bnRPZlJld2FyZCwgCiAgICAgICAgdWludDI1NiBfdGltZXN0YW1wT2ZEaXN0cmlidXRpb24KICAgICkgZXh0ZXJuYWwgbm9uUmVlbnRyYW50IG9ubHlPd25lciB3aGVuTm90UGF1c2VkIHsKICAgICAgICByZXF1aXJlKF90aW1lc3RhbXBPZkRpc3RyaWJ1dGlvbiA+IHByZXZpb3VzRGlzdHJpYnV0aW9uLmFkZChkdXJhdGlvbkJldHdlZW5SZXdhcmRNaW50cykpOyAvL1RvIG9ubHkgYWxsb3cgYSBkaXN0cmlidXRpb24gdG8gaGFwcGVuIDMwIGRheXMgKDI1OTIwMDAgc2Vjb25kcykgYWZ0ZXIgdGhlIHByZXZpb3VzIGRpc3RyaWJ1dGlvbgogICAgICAgIHJlcXVpcmUoX3RpbWVzdGFtcE9mRGlzdHJpYnV0aW9uIDwgbm93KTsgLy8gVG8gb25seSBhbGxvdyBhIGRpc3RyaWJ1dGlvbiB0aW1lIGluIHRoZSBwYXN0CiAgICAgICAgcmVxdWlyZShfcmV3YXJkQWRyZXNzZXMubGVuZ3RoID09IF9hbW91bnRPZlJld2FyZC5sZW5ndGgpOyAvLyBUbyB2ZXJpZnkgdGhlIGxlbmd0aCBvZiB0aGUgYXJyYXlzIGFyZSB0aGUgc2FtZS4KICAgICAgICAKICAgICAgICB1aW50MjU2IHJld2FyZERpc3RyaWJ1dGVkID0gMDsKCiAgICAgICAgZm9yICh1aW50IGogPSAwOyBqIDwgX3Jld2FyZEFkcmVzc2VzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIHJld2FyZE1pbnQoX3Jld2FyZEFkcmVzc2VzW2pdLCBfYW1vdW50T2ZSZXdhcmRbal0pOwogICAgICAgICAgICByZXdhcmREaXN0cmlidXRlZCA9IHJld2FyZERpc3RyaWJ1dGVkLmFkZChfYW1vdW50T2ZSZXdhcmRbal0pOwogICAgICAgIH0KICAgICAgICByZXF1aXJlKHJld2FyZEF2YWlsYWJsZUN1cnJlbnREaXN0cmlidXRpb24gPj0gcmV3YXJkRGlzdHJpYnV0ZWQpOwogICAgICAgIHRvdGFsUmV3YXJkc0Rpc3RyaWJ1dGVkID0gdG90YWxSZXdhcmRzRGlzdHJpYnV0ZWQuYWRkKHJld2FyZERpc3RyaWJ1dGVkKTsKICAgICAgICByZXdhcmRBdmFpbGFibGVDdXJyZW50RGlzdHJpYnV0aW9uID0gcmV3YXJkQXZhaWxhYmxlQ3VycmVudERpc3RyaWJ1dGlvbi5zdWIocmV3YXJkRGlzdHJpYnV0ZWQpOwogICAgfQogICAgCiAgICAvKioKICAgICogQGRldiBkaXN0cmlidXRlIHJld2FyZCB0b2tlbnMgdG8gYSBhZGRyZXNzZSBiYXNlZCBvbiB0aGUgcHJvcG9ydGlvbgogICAgKiBAcGFyYW0gX3Jld2FyZEFkZHJlc3MgVGhlIGFkZHJlc3MgdG8gd2hpY2ggdGhlIHJld2FyZCBuZWVkcyB0byBiZSBkaXN0cmlidXRlZAogICAgKi8KICAgIGZ1bmN0aW9uIGRpc3RyaWJ1dGVSZXdhcmQoCiAgICAgICAgYWRkcmVzcyBfcmV3YXJkQWRkcmVzcywgCiAgICAgICAgdWludDI1NiBfYW1vdW50T2ZSZXdhcmQsIAogICAgICAgIHVpbnQyNTYgX3RpbWVzdGFtcE9mRGlzdHJpYnV0aW9uCiAgICApIGV4dGVybmFsIG5vblJlZW50cmFudCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgCiAgICAgICAgcmVxdWlyZShfdGltZXN0YW1wT2ZEaXN0cmlidXRpb24gPiBwcmV2aW91c0Rpc3RyaWJ1dGlvbik7CiAgICAgICAgcmVxdWlyZShfdGltZXN0YW1wT2ZEaXN0cmlidXRpb24gPCBwcmV2aW91c0Rpc3RyaWJ1dGlvbi5hZGQoZHVyYXRpb25CZXR3ZWVuUmV3YXJkTWludHMpKTsgLy9UbyBvbmx5IGFsbG93IGEgZGlzdHJpYnV0aW9uIHRvIGhhcHBlbiAzMCBkYXlzICgyNTkyMDAwIHNlY29uZHMpIGFmdGVyIHRoZSBwcmV2aW91cyBkaXN0cmlidXRpb24KICAgICAgICByZXF1aXJlKF90aW1lc3RhbXBPZkRpc3RyaWJ1dGlvbiA8IG5vdyk7IC8vIFRvIG9ubHkgYWxsb3cgYSBkaXN0cmlidXRpb24gdGltZSBpbiB0aGUgcGFzdAogICAgICAgIC8vcmV3YXJkW19yZXdhcmRBZGRyZXNzXSA9IHJld2FyZFtfcmV3YXJkQWRkcmVzc10uYWRkKF9hbW91bnRPZlJld2FyZCk7CiAgICAgICAgcmV3YXJkTWludChfcmV3YXJkQWRkcmVzcywgX2Ftb3VudE9mUmV3YXJkKTsKICAgICAgICAKICAgIH0KCiAgICAvKioKICAgICogQGRldiByZXNldCByZXdhcmQgdG9rZW5zZm9yIHRoZSBuZXcgZHVyYXRpb24KICAgICovCiAgICBmdW5jdGlvbiByZXNldFJld2FyZCgpIGV4dGVybmFsIG5vblJlZW50cmFudCBvbmx5T3duZXIgd2hlbk5vdFBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShub3cgPiBwcmV2aW91c0Rpc3RyaWJ1dGlvbi5hZGQoZHVyYXRpb25CZXR3ZWVuUmV3YXJkTWludHMpKTsgLy9UbyBvbmx5IGFsbG93IGEgZGlzdHJpYnV0aW9uIHRvIGhhcHBlbiAzMCBkYXlzICgyNTkyMDAwIHNlY29uZHMpIGFmdGVyIHRoZSBwcmV2aW91cyBkaXN0cmlidXRpb24KICAgICAgICBwcmV2aW91c0Rpc3RyaWJ1dGlvbiA9IHByZXZpb3VzRGlzdHJpYnV0aW9uLmFkZChkdXJhdGlvbkJldHdlZW5SZXdhcmRNaW50cyk7IC8vIFRvIHNldCB0aGUgbmV3IGRpc3RyaWJ1dGlvbiBwZXJpb2QgYXMgdGhlIHByZXZpb3VzIGRpc3RyaWJ1dGlvbiB0aW1lc3RhbXAKICAgICAgICByZXdhcmRBdmFpbGFibGVDdXJyZW50RGlzdHJpYnV0aW9uID0gYW1vdW50TWludFBlckR1cmF0aW9uOwogICAgICAgIGVtaXQgUmVzZXRSZXdhcmQoKTsKICAgIH0KCiAgICAvKioKICAgKiBAZGV2IFJlZGVlbSBSZXdhcmQgdG9rZW5zIGZyb20gb25lIHJld2FyZHMgYXJyYXkgdG8gYmFsYW5jZXMgYXJyYXkKICAgKiBAcGFyYW0gX2JlbmVmaWNpYXJ5IGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggY29udGFpbnMgdGhlIHJld2FyZCBhcyB3ZWxsIGFzIHRoZSBhZGRyZXNzIHRvIHdoaWNoIHRoZSBiYWxhbmNlIHdpbGwgYmUgdHJhbnNmZXJyZWQKICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgcmVkZWVtZWQKICAgKi8KICAgIGZ1bmN0aW9uIHJlZGVlbVJld2FyZCgKICAgICAgICBhZGRyZXNzIF9iZW5lZmljaWFyeSwgCiAgICAgICAgdWludDI1NiBfdmFsdWUKICAgICkgZXh0ZXJuYWwgbm9uUmVlbnRyYW50IHdoZW5Ob3RQYXVzZWR7CiAgICAgICAgLy9OZWVkIHRvIGNvbnNpZGVyIHdoYXQgaGFwcGVucyB0byByZXdhcmRzIGFmdGVyIHRoZSBzdG9wcGluZyBvZiBtaW50aW5nIHByb2Nlc3MKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gX2JlbmVmaWNpYXJ5KTsKICAgICAgICByZXF1aXJlKF92YWx1ZSA+PSBtaW5pbXVtUmV3YXJkV2l0aGRyYXdhbExpbWl0KTsKICAgICAgICByZXF1aXJlKHJld2FyZFtfYmVuZWZpY2lhcnldID49IF92YWx1ZSk7CiAgICAgICAgcmV3YXJkW19iZW5lZmljaWFyeV0gPSByZXdhcmRbX2JlbmVmaWNpYXJ5XS5zdWIoX3ZhbHVlKTsKICAgICAgICBiYWxhbmNlc1tfYmVuZWZpY2lhcnldID0gYmFsYW5jZXNbX2JlbmVmaWNpYXJ5XS5hZGQoX3ZhbHVlKTsKICAgICAgICB0b3RhbFJld2FyZHNSZWRlZW1lZCA9IHRvdGFsUmV3YXJkc1JlZGVlbWVkLmFkZChfdmFsdWUpOwogICAgICAgIGVtaXQgUmVkZWVtUmV3YXJkKF9iZW5lZmljaWFyeSwgX3ZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZXdhcmRNaW50KAogICAgICAgIGFkZHJlc3MgX3RvLCAKICAgICAgICB1aW50MjU2IF9hbW91bnQKICAgICkgb25seU93bmVyIGNhbk1pbnQgd2hlbk5vdFBhdXNlZCBpbnRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfYW1vdW50ID4gMCk7CiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShyZXdhcmRBdmFpbGFibGVDdXJyZW50RGlzdHJpYnV0aW9uID49IF9hbW91bnQpOwogICAgICAgIHRvdGFsU3VwcGx5XyA9IHRvdGFsU3VwcGx5Xy5hZGQoX2Ftb3VudCk7CiAgICAgICAgcmV3YXJkW190b10gPSByZXdhcmRbX3RvXS5hZGQoX2Ftb3VudCk7CiAgICAgICAgdG90YWxSZXdhcmRzRGlzdHJpYnV0ZWQgPSB0b3RhbFJld2FyZHNEaXN0cmlidXRlZC5hZGQoX2Ftb3VudCk7CiAgICAgICAgcmV3YXJkQXZhaWxhYmxlQ3VycmVudERpc3RyaWJ1dGlvbiA9IHJld2FyZEF2YWlsYWJsZUN1cnJlbnREaXN0cmlidXRpb24uc3ViKF9hbW91bnQpOwogICAgICAgIGVtaXQgUmV3YXJkTWludChfdG8sIF9hbW91bnQpOwogICAgICAgIC8vVHJhbnNmZXIoYWRkcmVzcygwKSwgX3RvLCBfYW1vdW50KTsgLy9iYWxhbmNlIG9mIHRoZSB1c2VyIHdpbGwgb25seSBiZSB1cGRhdGVkIG9uIGNsYWltaW5nIHRoZSBjb2luCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiB1c2VyUmV3YXJkQWNjb3VudEJhbGFuY2UoCiAgICAgICAgYWRkcmVzcyBfYWRkcmVzcwogICAgKSB3aGVuTm90UGF1c2VkIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJlcXVpcmUoX2FkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmV0dXJuIHJld2FyZFtfYWRkcmVzc107CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VSZXdhcmRNaW50aW5nQW1vdW50KAogICAgICAgIHVpbnQyNTYgX25ld1Jld2FyZE1pbnRBbXQKICAgICkgd2hlbk5vdFBhdXNlZCBub25SZWVudHJhbnQgb25seU93bmVyIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKF9uZXdSZXdhcmRNaW50QW10IDwgYW1vdW50TWludFBlckR1cmF0aW9uKTsKICAgICAgICBhbW91bnRNaW50UGVyRHVyYXRpb24gPSBfbmV3UmV3YXJkTWludEFtdDsKICAgICAgICBlbWl0IFJld2FyZE1pbnRpbmdBbXQoX25ld1Jld2FyZE1pbnRBbXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUpIGV4dGVybmFsIG5vblJlZW50cmFudCByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRyYW5zZmVyRnJvbUludGVybmFsKF9mcm9tLCBfdG8sIF92YWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlKSBleHRlcm5hbCBub25SZWVudHJhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBhcHByb3ZlSW50ZXJuYWwoX3NwZW5kZXIsIF92YWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBhbGxvd2FuY2UoYWRkcmVzcyBfb3duZXIsIGFkZHJlc3MgX3NwZW5kZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhbGxvd2FuY2VJbnRlcm5hbChfb3duZXIsIF9zcGVuZGVyKTsKICAgIH0KICAgIGZ1bmN0aW9uIGluY3JlYXNlQXBwcm92YWwoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkgZXh0ZXJuYWwgbm9uUmVlbnRyYW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gaW5jcmVhc2VBcHByb3ZhbEludGVybmFsKF9zcGVuZGVyLCBfYWRkZWRWYWx1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBkZWNyZWFzZUFwcHJvdmFsKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQgX3N1YnRyYWN0ZWRWYWx1ZSkgZXh0ZXJuYWwgbm9uUmVlbnRyYW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZGVjcmVhc2VBcHByb3ZhbEludGVybmFsKF9zcGVuZGVyLCBfc3VidHJhY3RlZFZhbHVlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgZXh0ZXJuYWwgbm9uUmVlbnRyYW50IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gdHJhbnNmZXJJbnRlcm5hbChfdG8sIF92YWx1ZSk7CiAgICB9IAp9CgovLyBGaWxlOiBjb250cmFjdHMvQ3Jvd2RzYWxlLnNvbAoKLyoqCiAqIEB0aXRsZSBDcm93ZHNhbGUKICogQGRldiBDcm93ZHNhbGUgaXMgYSBiYXNlIGNvbnRyYWN0IGZvciBtYW5hZ2luZyBhIHRva2VuIGNyb3dkc2FsZS4KICogQ3Jvd2RzYWxlcyBoYXZlIGEgc3RhcnQgYW5kIGVuZCB0aW1lc3RhbXBzLCB3aGVyZSBpbnZlc3RvcnMgY2FuIG1ha2UKICogdG9rZW4gcHVyY2hhc2VzIGFuZCB0aGUgY3Jvd2RzYWxlIHdpbGwgYXNzaWduIHRoZW0gdG9rZW5zIGJhc2VkCiAqIG9uIGEgdG9rZW4gcGVyIEVUSCByYXRlLiBGdW5kcyBjb2xsZWN0ZWQgYXJlIGZvcndhcmRlZCB0byBhIHdhbGxldAogKiBhcyB0aGV5IGFycml2ZS4KICovCmNvbnRyYWN0IENyb3dkc2FsZSB7CiAgICB1c2luZyBTYWZlTWF0aCBmb3IgdWludDI1NjsKICAgIElpaW5vQ29pbiBwdWJsaWMgdG9rZW47CiAgICBhZGRyZXNzIHB1YmxpYyBpaWlub1Rva2VuQWRkcmVzczsKICAgIHVpbnQyNTYgcHVibGljIHN0YXJ0VGltZTsKICAgIHVpbnQyNTYgcHVibGljIGVuZFRpbWU7CgogIC8vIGFkZHJlc3Mgd2hlcmUgZnVuZHMgYXJlIGNvbGxlY3RlZAogICAgYWRkcmVzcyBwdWJsaWMgd2FsbGV0OwoKICAvLyBob3cgbWFueSB0b2tlbiB1bml0cyBhIGJ1eWVyIGdldHMgcGVyIHdlaQogICAgdWludDI1NiBwdWJsaWMgcmF0ZTsKCiAgLy8gYW1vdW50IG9mIHJhaXNlZCBtb25leSBpbiB3ZWkKICAgIHVpbnQyNTYgcHVibGljIHdlaVJhaXNlZDsKCiAgLyoqCiAgICogZXZlbnQgZm9yIHRva2VuIHB1cmNoYXNlIGxvZ2dpbmcKICAgKiBAcGFyYW0gcHVyY2hhc2VyIHdobyBwYWlkIGZvciB0aGUgdG9rZW5zCiAgICogQHBhcmFtIGJlbmVmaWNpYXJ5IHdobyBnb3QgdGhlIHRva2VucwogICAqIEBwYXJhbSB2YWx1ZSB3ZWlzIHBhaWQgZm9yIHB1cmNoYXNlCiAgICogQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAqLwogICAgZXZlbnQgVG9rZW5QdXJjaGFzZShhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLCBhZGRyZXNzIGluZGV4ZWQgYmVuZWZpY2lhcnksIHVpbnQyNTYgdmFsdWUsIHVpbnQyNTYgYW1vdW50KTsKCgogICAgZnVuY3Rpb24gQ3Jvd2RzYWxlKHVpbnQyNTYgX3N0YXJ0VGltZSwgdWludDI1NiBfZW5kVGltZSwgdWludDI1NiBfcmF0ZSwgYWRkcmVzcyBfd2FsbGV0KSBwdWJsaWMgewogICAgICAgIC8vcmVxdWlyZShfc3RhcnRUaW1lID49IG5vdyk7CiAgICAgICAgcmVxdWlyZShfZW5kVGltZSA+PSBfc3RhcnRUaW1lKTsKICAgICAgICByZXF1aXJlKF9yYXRlID4gMCk7CiAgICAgICAgcmVxdWlyZShfd2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBzdGFydFRpbWUgPSBfc3RhcnRUaW1lOwogICAgICAgIGVuZFRpbWUgPSBfZW5kVGltZTsKICAgICAgICByYXRlID0gX3JhdGU7CiAgICAgICAgd2FsbGV0ID0gX3dhbGxldDsKICAgIH0KCiAgICAvLyBmYWxsYmFjayBmdW5jdGlvbiBjYW4gYmUgdXNlZCB0byBidXkgdG9rZW5zCiAgICBmdW5jdGlvbiAoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBidXlUb2tlbnNJbnRlcm5hbChtc2cuc2VuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBidXlUb2tlbnNJbnRlcm5hbChhZGRyZXNzIGJlbmVmaWNpYXJ5KSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gKDAuMDEgZXRoZXIpKTsKCiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CiAgICAgICAgdWludDI1NiB0b2tlbnMgPSBnZXRUb2tlbkFtb3VudCh3ZWlBbW91bnQpOwogICAgICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKICAgICAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgICAgIGVtaXQgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwogICAgICAgIGZvcndhcmRGdW5kcygpOwogICAgfQoKICAgIC8vIEByZXR1cm4gdHJ1ZSBpZiBjcm93ZHNhbGUgZXZlbnQgaGFzIGVuZGVkCiAgICBmdW5jdGlvbiBoYXNFbmRlZCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbm93ID4gZW5kVGltZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb2tlbkFtb3VudCh1aW50MjU2IHdlaUFtb3VudCkgaW50ZXJuYWwgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gd2VpQW1vdW50Lm11bChyYXRlKTsKICAgIH0KCiAgICAvLyBzZW5kIGV0aGVyIHRvIHRoZSBmdW5kIGNvbGxlY3Rpb24gd2FsbGV0CiAgICBmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSBpbnRlcm5hbCB7CiAgICAgICAgd2FsbGV0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICB9CgogICAgLy8gQHJldHVybiB0cnVlIGlmIHRoZSB0cmFuc2FjdGlvbiBjYW4gYnV5IHRva2VucwogICAgZnVuY3Rpb24gdmFsaWRQdXJjaGFzZSgpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZSAmJiBub3cgPD0gZW5kVGltZTsKICAgICAgICBib29sIG5vblplcm9QdXJjaGFzZSA9IG1zZy52YWx1ZSAhPSAwOwogICAgICAgIHJldHVybiB3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlOwogICAgfQoKfQoKLy8gRmlsZTogY29udHJhY3RzL0lpaW5vQ29pbkNyb3dkc2FsZS5zb2wKCmNvbnRyYWN0IElpaW5vQ29pbkNyb3dkc2FsZSBpcyBDcm93ZHNhbGUsIFBhdXNhYmxlLCBSZWVudHJhbmN5R3VhcmQgewogICAgZXZlbnQgUmVmZXJyYWxBd2FyZGVkKGFkZHJlc3MgaW5kZXhlZCBwdXJjaGFzZXIsIGFkZHJlc3MgaW5kZXhlZCByZWZlcnJlciwgdWludDI1NiBpaWlub1B1cmNoYXNlZCwgdWludDI1NiBpaWlub0F3YXJkZWQpOwoKICAgIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwogICAgCiAgICBhZGRyZXNzIGRldldhbGxldDsKICAgIHVpbnQyNTYgbm9PZlRva2VuQWxvY2F0ZWRGb3JEZXY7CiAgICB1aW50MjU2IHB1YmxpYyBub09mVG9rZW5BbG9jYXRlZEZvclNlZWRSb3VuZDsKICAgIHVpbnQyNTYgcHVibGljIG5vT2ZUb2tlbkFsb2NhdGVkRm9yUHJlc2FsZVJvdW5kOwogICAgdWludDI1NiBwdWJsaWMgdG90YWxOb09mVG9rZW5BbG9jYXRlZDsKICAgIHVpbnQyNTYgcHVibGljIG5vT2ZUb2tlbkFsb2NhdGVkUGVySUNPUGhhc2U7IC8vVGhlIHRva2VuIGFsbG9jYXRpb24gZm9yIGVhY2ggcGhhc2Ugb2YgdGhlIElDTwogICAgdWludDI1NiBwdWJsaWMgbm9PZklDT1BoYXNlczsgLy9Oby4gb2YgSUNPIHBoYXNlcwogICAgdWludDI1NiBwdWJsaWMgc2VlZFJvdW5kRW5kVGltZTsgLy8gdG8gYmUgaW4gc2Vjb25kcwogICAgdWludDI1NiBwdWJsaWMgdGhyZXNob2xkRXRoZXJMaW1pdEZvclNlZWRSb3VuZDsgLy9taW5pbXVtIGFtb3VudCBvZiB3ZWkgbmVlZGVkIHRvIHBhcnRpY2lwYXRlCiAgICB1aW50MjU2IHB1YmxpYyBtb3JlVG9rZW5QZXJFdGhlckZvclNlZWRSb3VuZDsgLy8gdGhlIG1vcmUgYW1vdW50IG9mIElpaW5vcyBnaXZlbiBwZXIgZXRoZXIgZHVyaW5nIHNlZWQgcm91bmQKICAgIHVpbnQyNTYgcHVibGljIG1vcmVUb2tlblBlckV0aGVyRm9yUHJlc2FsZVJvdW5kOyAvL3RoZSBtb3JlIGFtb3VudCBvZiBJaWlub3MgZ2l2ZW4gcGVyIGV0aGVyIGR1cmluZyBwcmVzYWxlIHJvdW5kCiAgICAKICAgIHVpbnQyNTYgcHVibGljIHJlZmVycmFsVG9rZW5zQXZhaWxhYmxlOyAvL1RvIGhvbGQgdGhlIHZhbHVlIG9mIHRoZSByZWZlcnJhbCB0b2tlbiBsaW1pdC4KICAgIHVpbnQyNTYgcHVibGljIHJlZmVycmFsUGVyY2VudDsgLy9UaGUgcGVyY2VudGFnZSBvZiByZWZlcnJhbCB0byBiZSBhd2FyZGVkIG9uIGVhY2ggb3JkZXIgd2l0aCBhIHJlZmVycmVyCiAgICB1aW50MjU2IHB1YmxpYyByZWZlcnJhbFRva2Vuc0FsbG9jYXRlZDsgLy8gVG8gaG9sZCB0aGUgdG90YWwgbnVtYmVyIG9mIHRva2VuIGFsbG9jYXRlZCB0byByZWZlcnJhbHMKCiAgICB1aW50MjU2IHB1YmxpYyBwcmVzYWxlRW5kVGltZTsgLy8gdG8gYmUgaW4gc2Vjb25kcwogICAgdWludDI1NiBwdWJsaWMgaXNzdWVSYXRlRGVjRHVyaW5nSUNPOyAvL1RoZSBudW1iZXIgb2YgaWlpbm8gdGhhdCBuZWVkcyB0byBiZSBkZWNyZWFzZWQgZm9yIGV2ZXJ5IG5leHQgcGhhc2Ugb2YgdGhlIElDTyAKICAgIC8vdWludDI1NiBwdWJsaWMgcGVyY2VudFRvTWludFBlckR1cmF0aW9uOyAvL1RoZSBwZXJjZW50YWdlIG9mIEdlbmVzaXMgSUNPIHRoYXQgd2lsbCBiZSBtaW50ZWQgZXZlcnkgbWludGluZyBjeWNsZQogICAgLy91aW50MjU2IHB1YmxpYyBkdXJhdGlvbkJldHdlZW5SZXdhcmRNaW50czsgLy9UaGUgbGVuZ3RoIG9mIGEgcmV3YXJkIG1pbnRpbmcgY3ljbGUKICAgIAoKICAgIGZ1bmN0aW9uIElpaW5vQ29pbkNyb3dkc2FsZSgKICAgICAgICB1aW50MjU2W10gX3BhcmFtcywgLy8gQWxsIHRoZSBwYXJhbXMgdGhhdCBuZWVkIHRvIGluaXRpYWxpemUgdGhlIGNyb3dkc2FsZSBhcyB3ZWxsIGFzIHRoZSBpaWlubyBUb2tlbgogICAgICAgIGFkZHJlc3MgX3dhbGxldCwgCiAgICAgICAgYWRkcmVzcyBfZGV2VGVhbVdhbGxldCwKICAgICAgICBhZGRyZXNzIF9paWlub1Rva2VuQWRkcmVzcwogICAgKSBwdWJsaWMgQ3Jvd2RzYWxlKF9wYXJhbXNbMF0sIF9wYXJhbXNbMV0sIF9wYXJhbXNbNF0sIF93YWxsZXQpIHsKICAgICAgICBkZXZXYWxsZXQgPSBfZGV2VGVhbVdhbGxldDsKICAgICAgICBpc3N1ZVJhdGVEZWNEdXJpbmdJQ08gPSBfcGFyYW1zWzVdOwogICAgICAgIHNlZWRSb3VuZEVuZFRpbWUgPSBfcGFyYW1zWzJdOwogICAgICAgIHByZXNhbGVFbmRUaW1lID0gX3BhcmFtc1szXTsKICAgICAgICAgIAogICAgICAgIG1vcmVUb2tlblBlckV0aGVyRm9yU2VlZFJvdW5kID0gX3BhcmFtc1sxM107CiAgICAgICAgbW9yZVRva2VuUGVyRXRoZXJGb3JQcmVzYWxlUm91bmQgPSBfcGFyYW1zWzE0XTsKICAgICAgICAgIAogICAgICAgIHJlZmVycmFsVG9rZW5zQXZhaWxhYmxlID0gX3BhcmFtc1sxNV07CiAgICAgICAgcmVmZXJyYWxUb2tlbnNBbGxvY2F0ZWQgPSBfcGFyYW1zWzE1XTsgLy9Jbml0aWFsbHkgYWxsIHRoZSBhbGxvY2F0ZWQgdG9rZW5zIGFyZSBhdmFpbGFibGUKICAgICAgICByZWZlcnJhbFBlcmNlbnQgPSBfcGFyYW1zWzE2XTsKCiAgICAgICAgbm9PZlRva2VuQWxvY2F0ZWRGb3JEZXYgPSBfcGFyYW1zWzZdOwogICAgICAgIG5vT2ZUb2tlbkFsb2NhdGVkRm9yU2VlZFJvdW5kID0gX3BhcmFtc1s3XTsKICAgICAgICBub09mVG9rZW5BbG9jYXRlZEZvclByZXNhbGVSb3VuZCA9IF9wYXJhbXNbOF07CiAgICAgICAgdG90YWxOb09mVG9rZW5BbG9jYXRlZCA9IF9wYXJhbXNbMTBdOwogICAgICAgIG5vT2ZUb2tlbkFsb2NhdGVkUGVySUNPUGhhc2UgPSBfcGFyYW1zWzldOwogICAgICAgIG5vT2ZJQ09QaGFzZXMgPSBfcGFyYW1zWzExXTsKICAgICAgICB0aHJlc2hvbGRFdGhlckxpbWl0Rm9yU2VlZFJvdW5kID0gX3BhcmFtc1sxMl07CgogICAgICAgIC8vTmVlZWQgdG8gdGVzdCB0aGUgdG90YWwgYWxsb2NhdGlvbiB3aXRoIHRoZSBzdW0gb2YgYWxsIGFsbG9jYXRpb25zLgogICAgICAgIC8vdG9rZW4udHJhbnNmZXJPd25lcnNoaXAobXNnLnNlbmRlcik7CgogICAgICAgIC8vdG9rZW4ubWludChfZGV2VGVhbVdhbGxldCwgbm9PZlRva2VuQWxvY2F0ZWRGb3JEZXYpOwogICAgICAgIC8vaWlpbm9Ub2tlbkFkZHJlc3MgPSBfaWlpbm9Ub2tlbkFkZHJlc3M7CiAgICAgICAgdG9rZW4gPSBJaWlub0NvaW4oX2lpaW5vVG9rZW5BZGRyZXNzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0aWFsVHJhbnNmZXJUb0RldlRlYW0oKSBub25SZWVudHJhbnQgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoZGV2V2FsbGV0ICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vVG8gYXNzaWduIHRoZSBpbml0aWFsIGRldiB0b2tlbnMgdG8gdGhlIGRldiB3YWxsZXQKICAgICAgICB0b2tlbi5taW50KGRldldhbGxldCwgbm9PZlRva2VuQWxvY2F0ZWRGb3JEZXYpOwogICAgICAgIC8vU2V0cyB0aGUgZGV2VGVhbVdhbGxldCB0byAweDAwLCB0byByZXN0cmljdCBmdXR1cmUgdHJhbnNmZXJzCiAgICAgICAgZGV2V2FsbGV0ID0gYWRkcmVzcygwKTsKICAgIH0KCiAgICAvKgogICAgLy9UZW1wIEZ1bmN0aW9uIHRvIHJldHJlaXZlIHZhbHVlcwogICAgZnVuY3Rpb24gdGVtcEdldERhdGFUb0NoZWNrICh1aW50IGluZHgsIHVpbnQyNTYgd2VpQW10KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgIC8vc3RyaW5nIHRlbXAgPSAidGhyZXNob2xkRXRoZXJMaW1pdEZvclNlZWRSb3VuZCA9PiIgKyB0aHJlc2hvbGRFdGhlckxpbWl0Rm9yU2VlZFJvdW5kICsgIlRvdGFsIFN1cHBseSA9PiAiICsgdG9rZW4udG90YWxTdXBwbHkoKSArICJub09mVG9rZW5BbG9jYXRlZEZvclNlZWRSb3VuZCA9PiAiICsgbm9PZlRva2VuQWxvY2F0ZWRGb3JTZWVkUm91bmQgKyAibm9PZlRva2VuQWxvY2F0ZWRGb3JEZXYgPT4gIiArIG5vT2ZUb2tlbkFsb2NhdGVkRm9yRGV2ICsgInJhdGUgPT4gIiArIHJhdGU7CiAgICAgICAgaWYgKGluZHggPT0gMCkKICAgICAgICAgIHJldHVybiBpc3N1ZVJhdGVEZWNEdXJpbmdJQ087CiAgICAgICAgZWxzZSBpZiAoaW5keCA9PSAxKQogICAgICAgICAgcmV0dXJuIHNlZWRSb3VuZEVuZFRpbWU7CiAgICAgICAgZWxzZSBpZiAoaW5keCA9PSAyKQogICAgICAgICAgcmV0dXJuIHByZXNhbGVFbmRUaW1lOwogICAgICAgIGVsc2UgaWYgKGluZHggPT0gMykKICAgICAgICAgIHJldHVybiBtb3JlVG9rZW5QZXJFdGhlckZvclNlZWRSb3VuZDsKICAgICAgICBlbHNlIGlmIChpbmR4ID09IDQpCiAgICAgICAgICByZXR1cm4gbW9yZVRva2VuUGVyRXRoZXJGb3JQcmVzYWxlUm91bmQ7CiAgICAgICAgZWxzZSBpZiAoaW5keCA9PSA1KQogICAgICAgICAgcmV0dXJuIG5vT2ZUb2tlbkFsb2NhdGVkRm9yRGV2OwogICAgICAgIGVsc2UgaWYgKGluZHggPT0gNikKICAgICAgICAgIHJldHVybiBub09mVG9rZW5BbG9jYXRlZEZvclNlZWRSb3VuZDsKICAgICAgICBlbHNlIGlmIChpbmR4ID09IDYxKQogICAgICAgICAgcmV0dXJuIG5vT2ZUb2tlbkFsb2NhdGVkRm9yUHJlc2FsZVJvdW5kOwogICAgICAgIGVsc2UgaWYgKGluZHggPT0gNykKICAgICAgICAgIHJldHVybiB0b3RhbE5vT2ZUb2tlbkFsb2NhdGVkOwogICAgICAgIGVsc2UgaWYgKGluZHggPT0gOCkKICAgICAgICAgIHJldHVybiBub09mVG9rZW5BbG9jYXRlZFBlcklDT1BoYXNlOwogICAgICAgIGVsc2UgaWYgKGluZHggPT0gOSkKICAgICAgICAgIHJldHVybiBub09mSUNPUGhhc2VzOwogICAgICAgIGVsc2UgaWYgKGluZHggPT0gMTApCiAgICAgICAgICByZXR1cm4gdGhyZXNob2xkRXRoZXJMaW1pdEZvclNlZWRSb3VuZDsKICAgICAgICBlbHNlIGlmIChpbmR4ID09IDExKQogICAgICAgICAgcmV0dXJuIDA7Ly9wZXJjZW50VG9NaW50UGVyRHVyYXRpb247CiAgICAgICAgZWxzZSBpZiAoaW5keCA9PSAxMikKICAgICAgICB7CiAgICAgICAgICAgIHVpbnQgY3VycmVudFJhdGU7CiAgICAgICAgICAgIHVpbnQyNTYgaWNvTXVsdGlwbGllcjsKICAgICAgICAgICAgKGN1cnJlbnRSYXRlLCBpY29NdWx0aXBsaWVyKSA9IGdldEN1cnJlbnRSYXRlSW50ZXJuYWwoKTsKICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRSYXRlOy8vZHVyYXRpb25CZXR3ZWVuUmV3YXJkTWludHM7CiAgICAgICAgfSAgCiAgICAgICAgZWxzZSBpZiAoaW5keCA9PSAxMykKICAgICAgICAgIHJldHVybiB0b2tlbi50b3RhbFN1cHBseSgpOwogICAgICAgIGVsc2UgaWYgKGluZHggPT0gMTQpCiAgICAgICAgICByZXR1cm4gZ2V0VG9rZW5BbW91bnQod2VpQW10KTsKICAgICAgICBlbHNlIGlmIChpbmR4ID09IDE1KQogICAgICAgICAgcmV0dXJuIG5vdzsKICAgICAgICBlbHNlIGlmIChpbmR4ID09IDE2KQogICAgICAgICAgcmV0dXJuIHN0YXJ0VGltZTsKICAgICAgICBlbHNlIGlmIChpbmR4ID09IDE3KQogICAgICAgICAgcmV0dXJuIGVuZFRpbWU7CiAgICAgICAgCiAgICB9CiAgICAqLwogICAgZnVuY3Rpb24gZ2V0VG9rZW5BbW91bnQgKHVpbnQyNTYgd2VpQW1vdW50KSB3aGVuTm90UGF1c2VkIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQgY3VyclJhdGU7CiAgICAgICAgdWludDI1NiBtdWx0aXBsaWVyRm9ySUNPOwogICAgICAgIHVpbnQyNTYgYW1vdW50T2ZJaWlubyA9IDA7CiAgICAgICAgdWludDI1NiByZWZlcnJhbHNEaXN0cmlidXRlZCA9IHJlZmVycmFsVG9rZW5zQWxsb2NhdGVkLnN1YihyZWZlcnJhbFRva2Vuc0F2YWlsYWJsZSk7CiAgICAgICAgdWludDI1NiBfdG90YWxTdXBwbHkgPSAodG9rZW4udG90YWxTdXBwbHkoKSkuc3ViKHJlZmVycmFsc0Rpc3RyaWJ1dGVkKTsKICAgICAgICBpZiAobm93IDw9IHNlZWRSb3VuZEVuZFRpbWUpIHsKICAgICAgICAgIAogICAgICAgICAgICByZXF1aXJlKHdlaUFtb3VudCA+PSB0aHJlc2hvbGRFdGhlckxpbWl0Rm9yU2VlZFJvdW5kKTsKICAgICAgICAgICAgcmVxdWlyZShfdG90YWxTdXBwbHkgPCBub09mVG9rZW5BbG9jYXRlZEZvclNlZWRSb3VuZC5hZGQobm9PZlRva2VuQWxvY2F0ZWRGb3JEZXYpKTsKICAgICAgICAgICAgKGN1cnJSYXRlLCBtdWx0aXBsaWVyRm9ySUNPKSA9IGdldEN1cnJlbnRSYXRlSW50ZXJuYWwoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFtb3VudE9mSWlpbm8gPSB3ZWlBbW91bnQubXVsKGN1cnJSYXRlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vT25seSBpZiB0aGVyZSBpcyBlbm91Z2ggYXZhaWxhYmxlIGFtb3VudCBvZiBpaWlubyBpbiB0aGUgcGhhc2Ugd2lsbCBpdCBhbGxvY2F0ZSBpdCwgZWxzZSBpdCB3aWxsIGp1c3QgcmV2ZXJ0IHRoZSB0cmFuc2FjdGlvbiBhbmQgcmV0dXJuIHRoZSBldGhlciAKICAgICAgICAgICAgcmVxdWlyZSAoX3RvdGFsU3VwcGx5LmFkZChhbW91bnRPZklpaW5vKSA8PSBub09mVG9rZW5BbG9jYXRlZEZvclNlZWRSb3VuZC5hZGQobm9PZlRva2VuQWxvY2F0ZWRGb3JEZXYpKTsKICAgICAgICAgICAgcmV0dXJuIGFtb3VudE9mSWlpbm87CgogICAgICAgIH0gZWxzZSBpZiAobm93IDw9IHByZXNhbGVFbmRUaW1lKSB7CiAgICAgICAgICAgIHJlcXVpcmUoX3RvdGFsU3VwcGx5IDwgbm9PZlRva2VuQWxvY2F0ZWRGb3JTZWVkUm91bmQuYWRkKG5vT2ZUb2tlbkFsb2NhdGVkRm9yUHJlc2FsZVJvdW5kKS5hZGQobm9PZlRva2VuQWxvY2F0ZWRGb3JEZXYpKTsKICAgICAgICAgICAgKGN1cnJSYXRlLCBtdWx0aXBsaWVyRm9ySUNPKSA9IGdldEN1cnJlbnRSYXRlSW50ZXJuYWwoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFtb3VudE9mSWlpbm8gPSB3ZWlBbW91bnQubXVsKGN1cnJSYXRlKTsKICAgICAgICAgICAgLy9Pbmx5IGlmIHRoZXJlIGlzIGVub3VnaCBhdmFpbGFibGUgYW1vdW50IG9mIGlpaW5vIGluIHRoZSBwaGFzZSB3aWxsIGl0IGFsbG9jYXRlIGl0LCBlbHNlIGl0IHdpbGwganVzdCByZXZlcnQgdGhlIHRyYW5zYWN0aW9uIGFuZCByZXR1cm4gdGhlIGV0aGVyIAogICAgICAgICAgICByZXF1aXJlIChfdG90YWxTdXBwbHkuYWRkKGFtb3VudE9mSWlpbm8pIDw9IG5vT2ZUb2tlbkFsb2NhdGVkRm9yU2VlZFJvdW5kLmFkZChub09mVG9rZW5BbG9jYXRlZEZvclByZXNhbGVSb3VuZCkuYWRkKG5vT2ZUb2tlbkFsb2NhdGVkRm9yRGV2KSk7CiAgICAgICAgICAgIHJldHVybiBhbW91bnRPZklpaW5vOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIAogICAgICAgICAgIAogICAgICAgICAgICByZXF1aXJlKF90b3RhbFN1cHBseSA8IG5vT2ZUb2tlbkFsb2NhdGVkRm9yU2VlZFJvdW5kLmFkZChub09mVG9rZW5BbG9jYXRlZEZvclByZXNhbGVSb3VuZCkuYWRkKG5vT2ZUb2tlbkFsb2NhdGVkRm9yRGV2KSk7CiAgICAgICAgICAgIHJlcXVpcmUobm93IDwgZW5kVGltZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAoY3VyclJhdGUsbXVsdGlwbGllckZvcklDTykgPSBnZXRDdXJyZW50UmF0ZUludGVybmFsKCk7CiAgICAgICAgICAgIC8vVG8gY2hlY2sgaWYgdGhlIGFtb3VudCBvZiB0b2tlbnMgZm9yIHRoZSBjdXJyZW50IElDTyBwaGFzZSBpcyBleGhhdXN0ZWQKICAgICAgICAgICAgLy91aW50MjU2IGEgPSAxOwogICAgICAgICAgICAvL2Ftb3VudE9mSWlpbm8gPSAod2VpQW1vdW50Lm11bChjdXJyUmF0ZSkpLmRpdihhKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGFtb3VudE9mSWlpbm8gPSB3ZWlBbW91bnQgKiBjdXJyUmF0ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlcXVpcmUoX3RvdGFsU3VwcGx5LmFkZChhbW91bnRPZklpaW5vKSA8PSBub09mVG9rZW5BbG9jYXRlZEZvclNlZWRSb3VuZC5hZGQobm9PZlRva2VuQWxvY2F0ZWRGb3JQcmVzYWxlUm91bmQpLmFkZChub09mVG9rZW5BbG9jYXRlZEZvckRldikuYWRkKG5vT2ZUb2tlbkFsb2NhdGVkUGVySUNPUGhhc2UubXVsKG11bHRpcGxpZXJGb3JJQ08uYWRkKDEpKSkpOwogICAgICAgICAgICByZXR1cm4gYW1vdW50T2ZJaWlubzsKICAgICAgICAgIAogICAgICAgIH0KICAgICAgCiAgICB9CgogIC8vZnVuY3Rpb24gZ2V0Q3VycmVudFJhdGUgcmV0dXJucyB0aGUgYW1vdW50IG9mIGlpaSBmb3IgdGhlIGFtb3VudCBvZiB3ZWkgYXQgdGhlIGN1cnJlbnQgcG9pbnQgaW4gdGltZSAobm93KQogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFJhdGVJbnRlcm5hbCgpIHdoZW5Ob3RQYXVzZWQgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50LHVpbnQyNTYpIHsKICAgICAgICB1aW50IGN1cnJSYXRlOwogICAgICAgIHVpbnQyNTYgbXVsdGlwbGllckZvcklDTyA9IDA7IAoKICAgICAgICBpZiAobm93IDw9IHNlZWRSb3VuZEVuZFRpbWUpIHsKICAgICAgICAgICAgY3VyclJhdGUgPSByYXRlLmFkZChtb3JlVG9rZW5QZXJFdGhlckZvclNlZWRSb3VuZCk7CiAgICAgICAgfSBlbHNlIGlmIChub3cgPD0gcHJlc2FsZUVuZFRpbWUpIHsKICAgICAgICAgICAgY3VyclJhdGUgPSByYXRlLmFkZChtb3JlVG9rZW5QZXJFdGhlckZvclByZXNhbGVSb3VuZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbXVsdGlwbGllckZvcklDTyA9IChub3cuc3ViKHByZXNhbGVFbmRUaW1lKSkuZGl2KDMwIGRheXMpOyAvLzg2NDAwIHNlY29uZHMgaW4gYSBkYXkKICAgICAgICAgICAgY3VyclJhdGUgPSByYXRlLnN1YigoaXNzdWVSYXRlRGVjRHVyaW5nSUNPLm11bChtdWx0aXBsaWVyRm9ySUNPKSkpOwogICAgICAgICAgICByZXF1aXJlKG11bHRpcGxpZXJGb3JJQ08gPCBub09mSUNPUGhhc2VzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChjdXJyUmF0ZSxtdWx0aXBsaWVyRm9ySUNPKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYnV5VG9rZW5zV2l0aFJlZmVycmVyKGFkZHJlc3MgcmVmZXJyZXIpIG5vblJlZW50cmFudCB3aGVuTm90UGF1c2VkIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIGFkZHJlc3MgYmVuZWZpY2lhcnkgPSBtc2cuc2VuZGVyOwogICAgICAgIHJlcXVpcmUocmVmZXJyZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgcmVxdWlyZShiZW5lZmljaWFyeSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKHZhbGlkUHVyY2hhc2UoKSk7CiAgICAgICAgcmVxdWlyZShtc2cudmFsdWUgPj0gKDAuMDEgZXRoZXIpKTsKCiAgICAgICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgICAgIC8vIGNhbGN1bGF0ZSB0b2tlbiBhbW91bnQgdG8gYmUgY3JlYXRlZAogICAgICAgIHVpbnQyNTYgdG9rZW5zID0gZ2V0VG9rZW5BbW91bnQod2VpQW1vdW50KTsKCiAgICAgICAgLy8gdXBkYXRlIHN0YXRlCiAgICAgICAgd2VpUmFpc2VkID0gd2VpUmFpc2VkLmFkZCh3ZWlBbW91bnQpOwoKICAgICAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgICAgIGVtaXQgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwoKICAgICAgICAvL1RvIHNlbmQgdGhlIHJlZmVycmVyIGhpcyBwZXJjZW50YWdlIG9mIHRva2Vucy4KICAgICAgICB1aW50MjU2IHJlZmVycmVyVG9rZW5zID0gdG9rZW5zLm11bChyZWZlcnJhbFBlcmNlbnQpLmRpdigxMDApOwogICAgICAgIGlmIChyZWZlcnJhbFRva2Vuc0F2YWlsYWJsZSA+IDApIHsKICAgICAgICAgICAgaWYgKHJlZmVycmVyVG9rZW5zID4gcmVmZXJyYWxUb2tlbnNBdmFpbGFibGUpIHsKICAgICAgICAgICAgICAgIHJlZmVycmVyVG9rZW5zID0gcmVmZXJyYWxUb2tlbnNBdmFpbGFibGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRva2VuLm1pbnQocmVmZXJyZXIsIHJlZmVycmVyVG9rZW5zKTsKICAgICAgICAgICAgcmVmZXJyYWxUb2tlbnNBdmFpbGFibGUgPSByZWZlcnJhbFRva2Vuc0F2YWlsYWJsZS5zdWIocmVmZXJyZXJUb2tlbnMpOwogICAgICAgICAgICBlbWl0IFJlZmVycmFsQXdhcmRlZChtc2cuc2VuZGVyLCByZWZlcnJlciwgdG9rZW5zLCByZWZlcnJlclRva2Vucyk7CgogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3J3YXJkRnVuZHMoKTsKCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q3VycmVudFJhdGUoKSB3aGVuTm90UGF1c2VkIGV4dGVybmFsIHZpZXcgcmV0dXJucyAodWludCx1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRSYXRlSW50ZXJuYWwgKCk7CiAgICB9CgogICAgZnVuY3Rpb24gYnV5VG9rZW5zKGFkZHJlc3MgYmVuZWZpY2lhcnkpIG5vblJlZW50cmFudCB3aGVuTm90UGF1c2VkIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIGJ1eVRva2Vuc0ludGVybmFsKGJlbmVmaWNpYXJ5KTsKICAgIH0KCiAgICBmdW5jdGlvbiBmb3J3YXJkRnVuZHMoKSB3aGVuTm90UGF1c2VkIGludGVybmFsIHsKICAgICAgICBzdXBlci5mb3J3YXJkRnVuZHMoKTsKICAgIH0KCn0='.
	

]
