Class {
	#name : #SRT14dBDe02e1CAAc6C1B8B543577eBf0Af6A7a5c7f,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT14dBDe02e1CAAc6C1B8B543577eBf0Af6A7a5c7f >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTU7CgoKLyoqCiAqIEB0aXRsZSBPd25hYmxlCiAqIEBkZXYgVGhlIE93bmFibGUgY29udHJhY3QgaGFzIGFuIG93bmVyIGFkZHJlc3MsIGFuZCBwcm92aWRlcyBiYXNpYyBhdXRob3JpemF0aW9uIGNvbnRyb2wKICogZnVuY3Rpb25zLCB0aGlzIHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uIG9mICJ1c2VyIHBlcm1pc3Npb25zIi4KICovCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgZXZlbnQgT3duZXJzaGlwVHJhbnNmZXJyZWQoYWRkcmVzcyBpbmRleGVkIHByZXZpb3VzT3duZXIsIGFkZHJlc3MgaW5kZXhlZCBuZXdPd25lcik7CgoKICAvKioKICAgKiBAZGV2IFRoZSBPd25hYmxlIGNvbnN0cnVjdG9yIHNldHMgdGhlIG9yaWdpbmFsIGBvd25lcmAgb2YgdGhlIGNvbnRyYWN0IHRvIHRoZSBzZW5kZXIKICAgKiBhY2NvdW50LgogICAqLwogIGZ1bmN0aW9uIE93bmFibGUoKSB7CiAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgfQoKCiAgLyoqCiAgICogQGRldiBUaHJvd3MgaWYgY2FsbGVkIGJ5IGFueSBhY2NvdW50IG90aGVyIHRoYW4gdGhlIG93bmVyLgogICAqLwogIG1vZGlmaWVyIG9ubHlPd25lcigpIHsKICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICBfOwogIH0KCgogIC8qKgogICAqIEBkZXYgQWxsb3dzIHRoZSBjdXJyZW50IG93bmVyIHRvIHRyYW5zZmVyIGNvbnRyb2wgb2YgdGhlIGNvbnRyYWN0IHRvIGEgbmV3T3duZXIuCiAgICogQHBhcmFtIG5ld093bmVyIFRoZSBhZGRyZXNzIHRvIHRyYW5zZmVyIG93bmVyc2hpcCB0by4KICAgKi8KICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBvbmx5T3duZXIgcHVibGljIHsKICAgIHJlcXVpcmUobmV3T3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICBPd25lcnNoaXBUcmFuc2ZlcnJlZChvd25lciwgbmV3T3duZXIpOwogICAgb3duZXIgPSBuZXdPd25lcjsKICB9Cgp9CgovKioKICogQHRpdGxlIFBhdXNhYmxlCiAqIEBkZXYgQmFzZSBjb250cmFjdCB3aGljaCBhbGxvd3MgY2hpbGRyZW4gdG8gaW1wbGVtZW50IGFuIGVtZXJnZW5jeSBzdG9wIG1lY2hhbmlzbS4KICovCmNvbnRyYWN0IFBhdXNhYmxlIGlzIE93bmFibGUgewogIGV2ZW50IFBhdXNlKCk7CiAgZXZlbnQgVW5wYXVzZSgpOwoKICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCgogIC8qKgogICAqIEBkZXYgTW9kaWZpZXIgdG8gbWFrZSBhIGZ1bmN0aW9uIGNhbGxhYmxlIG9ubHkgd2hlbiB0aGUgY29udHJhY3QgaXMgbm90IHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuTm90UGF1c2VkKCkgewogICAgcmVxdWlyZSghcGF1c2VkKTsKICAgIF87CiAgfQoKICAvKioKICAgKiBAZGV2IE1vZGlmaWVyIHRvIG1ha2UgYSBmdW5jdGlvbiBjYWxsYWJsZSBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IGlzIHBhdXNlZC4KICAgKi8KICBtb2RpZmllciB3aGVuUGF1c2VkKCkgewogICAgcmVxdWlyZShwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgY2FsbGVkIGJ5IHRoZSBvd25lciB0byBwYXVzZSwgdHJpZ2dlcnMgc3RvcHBlZCBzdGF0ZQogICAqLwogIGZ1bmN0aW9uIHBhdXNlKCkgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgcHVibGljIHsKICAgIHBhdXNlZCA9IHRydWU7CiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICogQGRldiBjYWxsZWQgYnkgdGhlIG93bmVyIHRvIHVucGF1c2UsIHJldHVybnMgdG8gbm9ybWFsIHN0YXRlCiAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIG9ubHlPd25lciB3aGVuUGF1c2VkIHB1YmxpYyB7CiAgICBwYXVzZWQgPSBmYWxzZTsKICAgIFVucGF1c2UoKTsKICB9Cn0KLyoqCiAqIEB0aXRsZSBTYWZlTWF0aAogKiBAZGV2IE1hdGggb3BlcmF0aW9ucyB3aXRoIHNhZmV0eSBjaGVja3MgdGhhdCB0aHJvdyBvbiBlcnJvcgogKi8KbGlicmFyeSBTYWZlTWF0aCB7CiAgZnVuY3Rpb24gbXVsKHVpbnQyNTYgYSwgdWludDI1NiBiKSBpbnRlcm5hbCBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IGMgPSBhICogYjsKICAgIGFzc2VydChhID09IDAgfHwgYyAvIGEgPT0gYik7CiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIGRpdih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgLy8gYXNzZXJ0KGIgPiAwKTsgLy8gU29saWRpdHkgYXV0b21hdGljYWxseSB0aHJvd3Mgd2hlbiBkaXZpZGluZyBieSAwCiAgICB1aW50MjU2IGMgPSBhIC8gYjsKICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICByZXR1cm4gYzsKICB9CgogIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgYXNzZXJ0KGIgPD0gYSk7CiAgICByZXR1cm4gYSAtIGI7CiAgfQoKICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYpIHsKICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgYXNzZXJ0KGMgPj0gYSk7CiAgICByZXR1cm4gYzsKICB9Cn0KCi8qKgogKiBAdGl0bGUgRVJDMjBCYXNpYwogKiBAZGV2IFNpbXBsZXIgdmVyc2lvbiBvZiBFUkMyMCBpbnRlcmZhY2UKICogQGRldiBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE3OQogKi8KY29udHJhY3QgRVJDMjBCYXNpYyB7CiAgdWludDI1NiBwdWJsaWMgdG90YWxTdXBwbHk7CiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3Mgd2hvKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1Nik7CiAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiB2YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpOwogIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwp9CgovKioKICogQHRpdGxlIEJhc2ljIHRva2VuCiAqIEBkZXYgQmFzaWMgdmVyc2lvbiBvZiBTdGFuZGFyZFRva2VuLCB3aXRoIG5vIGFsbG93YW5jZXMuCiAqLwpjb250cmFjdCBCYXNpY1Rva2VuIGlzIEVSQzIwQmFzaWMgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludDI1NikgYmFsYW5jZXM7CgogIC8qKgogICogQGRldiB0cmFuc2ZlciB0b2tlbiBmb3IgYSBzcGVjaWZpZWQgYWRkcmVzcwogICogQHBhcmFtIF90byBUaGUgYWRkcmVzcyB0byB0cmFuc2ZlciB0by4KICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCB0byBiZSB0cmFuc2ZlcnJlZC4KICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwoKICAgIC8vIFNhZmVNYXRoLnN1YiB3aWxsIHRocm93IGlmIHRoZXJlIGlzIG5vdCBlbm91Z2ggYmFsYW5jZS4KICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gYmFsYW5jZXNbbXNnLnNlbmRlcl0uc3ViKF92YWx1ZSk7CiAgICBiYWxhbmNlc1tfdG9dID0gYmFsYW5jZXNbX3RvXS5hZGQoX3ZhbHVlKTsKICAgIFRyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3ZhbHVlKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgKiBAZGV2IEdldHMgdGhlIGJhbGFuY2Ugb2YgdGhlIHNwZWNpZmllZCBhZGRyZXNzLgogICogQHBhcmFtIF9vd25lciBUaGUgYWRkcmVzcyB0byBxdWVyeSB0aGUgdGhlIGJhbGFuY2Ugb2YuCiAgKiBAcmV0dXJuIEFuIHVpbnQyNTYgcmVwcmVzZW50aW5nIHRoZSBhbW91bnQgb3duZWQgYnkgdGhlIHBhc3NlZCBhZGRyZXNzLgogICovCiAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBiYWxhbmNlKSB7CiAgICByZXR1cm4gYmFsYW5jZXNbX293bmVyXTsKICB9Cgp9CgovKioKICogQHRpdGxlIEVSQzIwIGludGVyZmFjZQogKiBAZGV2IHNlZSBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICovCmNvbnRyYWN0IEVSQzIwIGlzIEVSQzIwQmFzaWMgewogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KTsKICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCk7CiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIHNwZW5kZXIsIHVpbnQyNTYgdmFsdWUpIHB1YmxpYyByZXR1cm5zIChib29sKTsKICBldmVudCBBcHByb3ZhbChhZGRyZXNzIGluZGV4ZWQgb3duZXIsIGFkZHJlc3MgaW5kZXhlZCBzcGVuZGVyLCB1aW50MjU2IHZhbHVlKTsKfQoKLyoqCiAqIEB0aXRsZSBTdGFuZGFyZCBFUkMyMCB0b2tlbgogKgogKiBAZGV2IEltcGxlbWVudGF0aW9uIG9mIHRoZSBiYXNpYyBzdGFuZGFyZCB0b2tlbi4KICogQGRldiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMjAKICogQGRldiBCYXNlZCBvbiBjb2RlIGJ5IEZpcnN0Qmxvb2Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9GaXJzdGJsb29kaW8vdG9rZW4vYmxvYi9tYXN0ZXIvc21hcnRfY29udHJhY3QvRmlyc3RCbG9vZFRva2VuLnNvbAogKi8KY29udHJhY3QgU3RhbmRhcmRUb2tlbiBpcyBFUkMyMCwgQmFzaWNUb2tlbiB7CgogIG1hcHBpbmcgKGFkZHJlc3MgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50MjU2KSkgYWxsb3dlZDsKCgogIC8qKgogICAqIEBkZXYgVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8gYW5vdGhlcgogICAqIEBwYXJhbSBfZnJvbSBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHNlbmQgdG9rZW5zIGZyb20KICAgKiBAcGFyYW0gX3RvIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgKiBAcGFyYW0gX3ZhbHVlIHVpbnQyNTYgdGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CgogICAgdWludDI1NiBfYWxsb3dhbmNlID0gYWxsb3dlZFtfZnJvbV1bbXNnLnNlbmRlcl07CgogICAgLy8gQ2hlY2sgaXMgbm90IG5lZWRlZCBiZWNhdXNlIHN1YihfYWxsb3dhbmNlLCBfdmFsdWUpIHdpbGwgYWxyZWFkeSB0aHJvdyBpZiB0aGlzIGNvbmRpdGlvbiBpcyBub3QgbWV0CiAgICAvLyByZXF1aXJlIChfdmFsdWUgPD0gX2FsbG93YW5jZSk7CgogICAgYmFsYW5jZXNbX2Zyb21dID0gYmFsYW5jZXNbX2Zyb21dLnN1YihfdmFsdWUpOwogICAgYmFsYW5jZXNbX3RvXSA9IGJhbGFuY2VzW190b10uYWRkKF92YWx1ZSk7CiAgICBhbGxvd2VkW19mcm9tXVttc2cuc2VuZGVyXSA9IF9hbGxvd2FuY2Uuc3ViKF92YWx1ZSk7CiAgICBUcmFuc2ZlcihfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBAZGV2IEFwcHJvdmUgdGhlIHBhc3NlZCBhZGRyZXNzIHRvIHNwZW5kIHRoZSBzcGVjaWZpZWQgYW1vdW50IG9mIHRva2VucyBvbiBiZWhhbGYgb2YgbXNnLnNlbmRlci4KICAgKgogICAqIEJld2FyZSB0aGF0IGNoYW5naW5nIGFuIGFsbG93YW5jZSB3aXRoIHRoaXMgbWV0aG9kIGJyaW5ncyB0aGUgcmlzayB0aGF0IHNvbWVvbmUgbWF5IHVzZSBib3RoIHRoZSBvbGQKICAgKiBhbmQgdGhlIG5ldyBhbGxvd2FuY2UgYnkgdW5mb3J0dW5hdGUgdHJhbnNhY3Rpb24gb3JkZXJpbmcuIE9uZSBwb3NzaWJsZSBzb2x1dGlvbiB0byBtaXRpZ2F0ZSB0aGlzCiAgICogcmFjZSBjb25kaXRpb24gaXMgdG8gZmlyc3QgcmVkdWNlIHRoZSBzcGVuZGVyJ3MgYWxsb3dhbmNlIHRvIDAgYW5kIHNldCB0aGUgZGVzaXJlZCB2YWx1ZSBhZnRlcndhcmRzOgogICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CiAgICogQHBhcmFtIF9zcGVuZGVyIFRoZSBhZGRyZXNzIHdoaWNoIHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAqIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICovCiAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF9zcGVuZGVyLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gX3ZhbHVlOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gY2hlY2sgdGhlIGFtb3VudCBvZiB0b2tlbnMgdGhhdCBhbiBvd25lciBhbGxvd2VkIHRvIGEgc3BlbmRlci4KICAgKiBAcGFyYW0gX293bmVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggb3ducyB0aGUgZnVuZHMuCiAgICogQHBhcmFtIF9zcGVuZGVyIGFkZHJlc3MgVGhlIGFkZHJlc3Mgd2hpY2ggd2lsbCBzcGVuZCB0aGUgZnVuZHMuCiAgICogQHJldHVybiBBIHVpbnQyNTYgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHRva2VucyBzdGlsbCBhdmFpbGFibGUgZm9yIHRoZSBzcGVuZGVyLgogICAqLwogIGZ1bmN0aW9uIGFsbG93YW5jZShhZGRyZXNzIF9vd25lciwgYWRkcmVzcyBfc3BlbmRlcikgcHVibGljIGNvbnN0YW50IHJldHVybnMgKHVpbnQyNTYgcmVtYWluaW5nKSB7CiAgICByZXR1cm4gYWxsb3dlZFtfb3duZXJdW19zcGVuZGVyXTsKICB9CgogIC8qKgogICAqIGFwcHJvdmUgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGFsbG93ZWRbX3NwZW5kZXJdID09IDAuIFRvIGluY3JlbWVudAogICAqIGFsbG93ZWQgdmFsdWUgaXMgYmV0dGVyIHRvIHVzZSB0aGlzIGZ1bmN0aW9uIHRvIGF2b2lkIDIgY2FsbHMgKGFuZCB3YWl0IHVudGlsCiAgICogdGhlIGZpcnN0IHRyYW5zYWN0aW9uIGlzIG1pbmVkKQogICAqIEZyb20gTW9ub2xpdGhEQU8gVG9rZW4uc29sCiAgICovCiAgZnVuY3Rpb24gaW5jcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfYWRkZWRWYWx1ZSkKICAgIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl0gPSBhbGxvd2VkW21zZy5zZW5kZXJdW19zcGVuZGVyXS5hZGQoX2FkZGVkVmFsdWUpOwogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gZGVjcmVhc2VBcHByb3ZhbCAoYWRkcmVzcyBfc3BlbmRlciwgdWludCBfc3VidHJhY3RlZFZhbHVlKQogICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICB1aW50IG9sZFZhbHVlID0gYWxsb3dlZFttc2cuc2VuZGVyXVtfc3BlbmRlcl07CiAgICBpZiAoX3N1YnRyYWN0ZWRWYWx1ZSA+IG9sZFZhbHVlKSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdID0gb2xkVmFsdWUuc3ViKF9zdWJ0cmFjdGVkVmFsdWUpOwogICAgfQogICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3NwZW5kZXIsIGFsbG93ZWRbbXNnLnNlbmRlcl1bX3NwZW5kZXJdKTsKICAgIHJldHVybiB0cnVlOwogIH0KCn0KCi8qKgogICBAdGl0bGUgU21hcnRUb2tlbiwgYW4gZXh0ZW5zaW9uIG9mIEVSQzIwIHRva2VuIHN0YW5kYXJkCgogICBJbXBsZW1lbnRhdGlvbiB0aGUgU21hcnRUb2tlbiwgZm9sbG93aW5nIHRoZSBFUkMyMCBzdGFuZGFyZCB3aXRoIGV4dHJhCiAgIG1ldGhvZHMgdG8gdHJhbnNmZXIgdmFsdWUgYW5kIGRhdGEgYW5kIGV4ZWN1dGUgY2FsbHMgaW4gdHJhbnNmZXJzIGFuZAogICBhcHByb3ZhbHMuCiAgIFVzZXMgT3BlblplcHBlbGluIFN0YW5kYXJkVG9rZW4uCiAqLwpjb250cmFjdCBTbWFydFRva2VuIGlzIFN0YW5kYXJkVG9rZW4gewoKICAvKioKICAgICBAZGV2IGBhcHByb3ZlRGF0YWAgaXMgYW4gYWRkaXRpb24gdG8gRVJDMjAgdG9rZW4gbWV0aG9kcy4gSXQgYWxsb3dzIHRvCiAgICAgYXBwcm92ZSB0aGUgdHJhbnNmZXIgb2YgdmFsdWUgYW5kIGV4ZWN1dGUgYSBjYWxsIHdpdGggdGhlIHNlbnQgZGF0YS4KCiAgICAgQmV3YXJlIHRoYXQgY2hhbmdpbmcgYW4gYWxsb3dhbmNlIHdpdGggdGhpcyBtZXRob2QgYnJpbmdzIHRoZSByaXNrIHRoYXQKICAgICBzb21lb25lIG1heSB1c2UgYm90aCB0aGUgb2xkIGFuZCB0aGUgbmV3IGFsbG93YW5jZSBieSB1bmZvcnR1bmF0ZQogICAgIHRyYW5zYWN0aW9uIG9yZGVyaW5nLiBPbmUgcG9zc2libGUgc29sdXRpb24gdG8gbWl0aWdhdGUgdGhpcyByYWNlIGNvbmRpdGlvbgogICAgIGlzIHRvIGZpcnN0IHJlZHVjZSB0aGUgc3BlbmRlcidzIGFsbG93YW5jZSB0byAwIGFuZCBzZXQgdGhlIGRlc2lyZWQgdmFsdWUKICAgICBhZnRlcndhcmRzOgogICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8yMCNpc3N1ZWNvbW1lbnQtMjYzNTI0NzI5CgogICAgIEBwYXJhbSBfc3BlbmRlciBUaGUgYWRkcmVzcyB0aGF0IHdpbGwgc3BlbmQgdGhlIGZ1bmRzLgogICAgIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgc3BlbnQuCiAgICAgQHBhcmFtIF9kYXRhIEFCSS1lbmNvZGVkIGNvbnRyYWN0IGNhbGwgdG8gY2FsbCBgX3RvYCBhZGRyZXNzLgoKICAgICBAcmV0dXJuIHRydWUgaWYgdGhlIGNhbGwgZnVuY3Rpb24gd2FzIGV4ZWN1dGVkIHN1Y2Nlc3NmdWxseQogICAqLwogIGZ1bmN0aW9uIGFwcHJvdmVEYXRhKGFkZHJlc3MgX3NwZW5kZXIsIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfc3BlbmRlciAhPSBhZGRyZXNzKHRoaXMpKTsKCiAgICBzdXBlci5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpOwoKICAgIHJlcXVpcmUoX3NwZW5kZXIuY2FsbChfZGF0YSkpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICAgQGRldiBBZGRpdGlvbiB0byBFUkMyMCB0b2tlbiBtZXRob2RzLiBUcmFuc2ZlciB0b2tlbnMgdG8gYSBzcGVjaWZpZWQKICAgICBhZGRyZXNzIGFuZCBleGVjdXRlIGEgY2FsbCB3aXRoIHRoZSBzZW50IGRhdGEgb24gdGhlIHNhbWUgdHJhbnNhY3Rpb24KCiAgICAgQHBhcmFtIF90byBhZGRyZXNzIFRoZSBhZGRyZXNzIHdoaWNoIHlvdSB3YW50IHRvIHRyYW5zZmVyIHRvCiAgICAgQHBhcmFtIF92YWx1ZSB1aW50MjU2IHRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJlZAogICAgIEBwYXJhbSBfZGF0YSBBQkktZW5jb2RlZCBjb250cmFjdCBjYWxsIHRvIGNhbGwgYF90b2AgYWRkcmVzcy4KCiAgICAgQHJldHVybiB0cnVlIGlmIHRoZSBjYWxsIGZ1bmN0aW9uIHdhcyBleGVjdXRlZCBzdWNjZXNzZnVsbHkKICAgKi8KICBmdW5jdGlvbiB0cmFuc2ZlckRhdGEoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3ZhbHVlLCBieXRlcyBfZGF0YSkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwoKICAgIHJlcXVpcmUoX3RvLmNhbGwoX2RhdGEpKTsKCiAgICBzdXBlci50cmFuc2ZlcihfdG8sIF92YWx1ZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAgIEBkZXYgQWRkaXRpb24gdG8gRVJDMjAgdG9rZW4gbWV0aG9kcy4gVHJhbnNmZXIgdG9rZW5zIGZyb20gb25lIGFkZHJlc3MgdG8KICAgICBhbm90aGVyIGFuZCBtYWtlIGEgY29udHJhY3QgY2FsbCBvbiB0aGUgc2FtZSB0cmFuc2FjdGlvbgoKICAgICBAcGFyYW0gX2Zyb20gVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gc2VuZCB0b2tlbnMgZnJvbQogICAgIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gdHJhbnNmZXIgdG8KICAgICBAcGFyYW0gX3ZhbHVlIFRoZSBhbW91dCBvZiB0b2tlbnMgdG8gYmUgdHJhbnNmZXJyZWQKICAgICBAcGFyYW0gX2RhdGEgQUJJLWVuY29kZWQgY29udHJhY3QgY2FsbCB0byBjYWxsIGBfdG9gIGFkZHJlc3MuCgogICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgY2FsbCBmdW5jdGlvbiB3YXMgZXhlY3V0ZWQgc3VjY2Vzc2Z1bGx5CiAgICovCiAgZnVuY3Rpb24gdHJhbnNmZXJEYXRhRnJvbShhZGRyZXNzIF9mcm9tLCBhZGRyZXNzIF90bywgdWludDI1NiBfdmFsdWUsIGJ5dGVzIF9kYXRhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyh0aGlzKSk7CgogICAgcmVxdWlyZShfdG8uY2FsbChfZGF0YSkpOwoKICAgIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfQoKfQoKLyoqCiAqIEB0aXRsZSBNaW50YWJsZSB0b2tlbgogKiBAZGV2IFNpbXBsZSBFUkMyMCBUb2tlbiBleGFtcGxlLCB3aXRoIG1pbnRhYmxlIHRva2VuIGNyZWF0aW9uCiAqIEBkZXYgSXNzdWU6ICogaHR0cHM6Ly9naXRodWIuY29tL09wZW5aZXBwZWxpbi96ZXBwZWxpbi1zb2xpZGl0eS9pc3N1ZXMvMTIwCiAqIEJhc2VkIG9uIGNvZGUgYnkgVG9rZW5NYXJrZXROZXQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9Ub2tlbk1hcmtldE5ldC9pY28vYmxvYi9tYXN0ZXIvY29udHJhY3RzL01pbnRhYmxlVG9rZW4uc29sCiAqLwoKY29udHJhY3QgTWludGFibGVUb2tlbiBpcyBTdGFuZGFyZFRva2VuLCBPd25hYmxlIHsKICBldmVudCBNaW50KGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiBhbW91bnQpOwogIGV2ZW50IE1pbnRGaW5pc2hlZCgpOwoKICBib29sIHB1YmxpYyBtaW50aW5nRmluaXNoZWQgPSBmYWxzZTsKCgogIG1vZGlmaWVyIGNhbk1pbnQoKSB7CiAgICByZXF1aXJlKCFtaW50aW5nRmluaXNoZWQpOwogICAgXzsKICB9CgogIC8qKgogICAqIEBkZXYgRnVuY3Rpb24gdG8gbWludCB0b2tlbnMKICAgKiBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgd2lsbCByZWNlaXZlIHRoZSBtaW50ZWQgdG9rZW5zLgogICAqIEBwYXJhbSBfYW1vdW50IFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIG1pbnQuCiAgICogQHJldHVybiBBIGJvb2xlYW4gdGhhdCBpbmRpY2F0ZXMgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBtaW50KGFkZHJlc3MgX3RvLCB1aW50MjU2IF9hbW91bnQpIG9ubHlPd25lciBjYW5NaW50IHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LmFkZChfYW1vdW50KTsKICAgIGJhbGFuY2VzW190b10gPSBiYWxhbmNlc1tfdG9dLmFkZChfYW1vdW50KTsKICAgIE1pbnQoX3RvLCBfYW1vdW50KTsKICAgIFRyYW5zZmVyKDB4MCwgX3RvLCBfYW1vdW50KTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyoqCiAgICogQGRldiBGdW5jdGlvbiB0byBzdG9wIG1pbnRpbmcgbmV3IHRva2Vucy4KICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bC4KICAgKi8KICBmdW5jdGlvbiBmaW5pc2hNaW50aW5nKCkgb25seU93bmVyIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICBtaW50aW5nRmluaXNoZWQgPSB0cnVlOwogICAgTWludEZpbmlzaGVkKCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCgoKLyoqCiAgIEB0aXRsZSBMJiMyMzc7ZiwgdGhlIFdpbmRpbmcgVHJlZSB0b2tlbgoKICAgSW1wbGVtZW50YXRpb24gb2YgTCYjMjM3O2YsIHRoZSBFUkMyMCB0b2tlbiBmb3IgV2luZGluZyBUcmVlLCB3aXRoIGV4dHJhIG1ldGhvZHMKICAgdG8gdHJhbnNmZXIgdmFsdWUgYW5kIGRhdGEgdG8gZXhlY3V0ZSBhIGNhbGwgb24gdHJhbnNmZXIuCiAgIFVzZXMgT3BlblplcHBlbGluIE1pbnRhYmxlVG9rZW4gYW5kIFBhdXNhYmxlLgogKi8KY29udHJhY3QgTGlmVG9rZW4gaXMgU21hcnRUb2tlbiwgTWludGFibGVUb2tlbiwgUGF1c2FibGUgewogIC8vIFRva2VuIE5hbWUKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IE5BTUUgPSAiTCYjMjM3O2YiOwoKICAvLyBUb2tlbiBTeW1ib2wKICBzdHJpbmcgcHVibGljIGNvbnN0YW50IFNZTUJPTCA9ICJMSUYiOwoKICAvLyBUb2tlbiBkZWNpbWFscwogIHVpbnQgcHVibGljIGNvbnN0YW50IERFQ0lNQUxTID0gMTg7CgogIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyKF90bywgX3ZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfc3BlbmRlciwgdWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci5hcHByb3ZlKF9zcGVuZGVyLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF92YWx1ZSkgcHVibGljIHdoZW5Ob3RQYXVzZWQgcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHN1cGVyLnRyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gYXBwcm92ZURhdGEoYWRkcmVzcyBzcGVuZGVyLCB1aW50MjU2IHZhbHVlLCBieXRlcyBkYXRhKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIuYXBwcm92ZURhdGEoc3BlbmRlciwgdmFsdWUsIGRhdGEpOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNmZXJEYXRhKGFkZHJlc3MgdG8sIHVpbnQyNTYgdmFsdWUsIGJ5dGVzIGRhdGEpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHJldHVybnMgKGJvb2wpIHsKICAgIHJldHVybiBzdXBlci50cmFuc2ZlckRhdGEodG8sIHZhbHVlLCBkYXRhKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZmVyRGF0YUZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHZhbHVlLCBieXRlcyBkYXRhKSBwdWJsaWMgd2hlbk5vdFBhdXNlZCByZXR1cm5zIChib29sKSB7CiAgICByZXR1cm4gc3VwZXIudHJhbnNmZXJEYXRhRnJvbShmcm9tLCB0bywgdmFsdWUsIGRhdGEpOwogIH0KCiAgLyoqCiAgICAgQGRldiBCdXJucyBhIHNwZWNpZmljIGFtb3VudCBvZiB0b2tlbnMuCgogICAgIEBwYXJhbSBfdmFsdWUgVGhlIGFtb3VudCBvZiB0b2tlbnMgdG8gYmUgYnVybmVkLgogICAqLwogIGZ1bmN0aW9uIGJ1cm4odWludDI1NiBfdmFsdWUpIHB1YmxpYyB3aGVuTm90UGF1c2VkIHsKICAgIHJlcXVpcmUoX3ZhbHVlID4gMCk7CgogICAgYWRkcmVzcyBidXJuZXIgPSBtc2cuc2VuZGVyOwogICAgYmFsYW5jZXNbYnVybmVyXSA9IGJhbGFuY2VzW2J1cm5lcl0uc3ViKF92YWx1ZSk7CiAgICB0b3RhbFN1cHBseSA9IHRvdGFsU3VwcGx5LnN1YihfdmFsdWUpOwogICAgQnVybihidXJuZXIsIF92YWx1ZSk7CgogICAgLy8gYSBUcmFuc2ZlciBldmVudCB0byAweDAgY2FuIGJlIHVzZWZ1bCBmb3Igb2JzZXJ2ZXJzIHRvIGtlZXAgdHJhY2sgb2YKICAgIC8vIGFsbCB0aGUgTGlmIGJ5IGp1c3QgbG9va2luZyBhdCB0aG9zZSBldmVudHMKICAgIFRyYW5zZmVyKGJ1cm5lciwgYWRkcmVzcygwKSwgX3ZhbHVlKTsKICB9CgogIGV2ZW50IEJ1cm4oYWRkcmVzcyBpbmRleGVkIGJ1cm5lciwgdWludCB2YWx1ZSk7Cgp9CgoKLyoqCiAgIEB0aXRsZSBWZXN0ZWQgUGF5bWVudCBTY2hlZHVsZSBmb3IgTGlmVG9rZW4KCiAgIEFuIG93bmFibGUgdmVzdGluZyBzY2hlZHVsZSBmb3IgdGhlIExpZlRva2VuLCB0aGUgdG9rZW5zIGNhbiBvbmx5IGJlCiAgIGNsYWltZWQgYnkgdGhlIG93bmVyLiBUaGUgY29udHJhY3QgaGFzIGEgc3RhcnQgdGltZXN0YW1wLCBhIGR1cmF0aW9uCiAgIG9mIGVhY2ggcGVyaW9kIGluIHNlY29uZHMgKGl0IGNhbiBiZSBkYXlzLCBtb250aHMsIHllYXJzKSwgYSB0b3RhbAogICBhbW91bnQgb2YgcGVyaW9kcyBhbmQgYSBjbGlmZi4gVGhlIGF2YWlsYWJsZSBhbW91bnQgb2YgdG9rZW5zIHdpbGwKICAgYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGUgYmFsYW5jZSBvZiBMaWZUb2tlbnMgb2YgdGhlIGNvbnRyYWN0IGF0CiAgIHRoYXQgdGltZS4KICovCgpjb250cmFjdCBWZXN0ZWRQYXltZW50IGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBXaGVuIHRoZSB2ZXN0ZWQgc2NoZWR1bGUgc3RhcnRzCiAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lc3RhbXA7CgogIC8vIEhvdyBtYW55IHNlY29uZHMgZWFjaCBwZXJpb2Qgd2lsbCBsYXN0CiAgdWludDI1NiBwdWJsaWMgc2Vjb25kc1BlclBlcmlvZDsKCiAgLy8gSG93IG1hbnkgcGVyaW9kcyB3aWxsIGhhdmUgaW4gdG90YWwKICB1aW50MjU2IHB1YmxpYyB0b3RhbFBlcmlvZHM7CgogIC8vIFRoZSBhbW91bnQgb2YgdG9rZW5zIHRvIGJlIHZlc3RlZCBpbiB0b3RhbAogIHVpbnQyNTYgcHVibGljIHRva2VuczsKCiAgLy8gSG93IG1hbnkgdG9rZW5zIHdlcmUgY2xhaW1lZAogIHVpbnQyNTYgcHVibGljIGNsYWltZWQ7CgogIC8vIFRoZSB0b2tlbiBjb250cmFjdAogIExpZlRva2VuIHB1YmxpYyB0b2tlbjsKCiAgLy8gRHVyYXRpb24gKGluIHBlcmlvZHMpIG9mIHRoZSBpbml0aWFsIGNsaWZmIGluIHRoZSB2ZXN0aW5nIHNjaGVkdWxlCiAgdWludDI1NiBwdWJsaWMgY2xpZmZEdXJhdGlvbjsKCiAgLyoqCiAgICAgQGRldiBDb25zdHJ1Y3Rvci4KCiAgICAgQHBhcmFtIF9zdGFydFRpbWVzdGFtcCBzZWUgYHN0YXJ0VGltZXN0YW1wYAogICAgIEBwYXJhbSBfc2Vjb25kc1BlclBlcmlvZCBzZWUgYHNlY29uZHNQZXJQZXJpb2RgCiAgICAgQHBhcmFtIF90b3RhbFBlcmlvZHMgc2VlIGB0b3RhbFBlcmlvZHMKICAgICBAcGFyYW0gX2NsaWZmRHVyYXRpb24gc2VlIGBjbGlmZkR1cmF0aW9uYAogICAgIEBwYXJhbSBfdG9rZW5zIHNlZSBgdG9rZW5zYAogICAgIEBwYXJhbSB0b2tlbkFkZHJlc3MgdGhlIGFkZHJlc3Mgb2YgdGhlIHRva2VuIGNvbnRyYWN0CiAgICovCiAgZnVuY3Rpb24gVmVzdGVkUGF5bWVudCgKICAgIHVpbnQyNTYgX3N0YXJ0VGltZXN0YW1wLCB1aW50MjU2IF9zZWNvbmRzUGVyUGVyaW9kLAogICAgdWludDI1NiBfdG90YWxQZXJpb2RzLCB1aW50MjU2IF9jbGlmZkR1cmF0aW9uLAogICAgdWludDI1NiBfdG9rZW5zLCBhZGRyZXNzIHRva2VuQWRkcmVzcwogICkgewogICAgcmVxdWlyZShfc3RhcnRUaW1lc3RhbXAgPj0gYmxvY2sudGltZXN0YW1wKTsKICAgIHJlcXVpcmUoX3NlY29uZHNQZXJQZXJpb2QgPiAwKTsKICAgIHJlcXVpcmUoX3RvdGFsUGVyaW9kcyA+IDApOwogICAgcmVxdWlyZSh0b2tlbkFkZHJlc3MgIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF9jbGlmZkR1cmF0aW9uIDwgX3RvdGFsUGVyaW9kcyk7CiAgICByZXF1aXJlKF90b2tlbnMgPiAwKTsKCiAgICBzdGFydFRpbWVzdGFtcCA9IF9zdGFydFRpbWVzdGFtcDsKICAgIHNlY29uZHNQZXJQZXJpb2QgPSBfc2Vjb25kc1BlclBlcmlvZDsKICAgIHRvdGFsUGVyaW9kcyA9IF90b3RhbFBlcmlvZHM7CiAgICBjbGlmZkR1cmF0aW9uID0gX2NsaWZmRHVyYXRpb247CiAgICB0b2tlbnMgPSBfdG9rZW5zOwogICAgdG9rZW4gPSBMaWZUb2tlbih0b2tlbkFkZHJlc3MpOwogIH0KCiAgLyoqCiAgICAgQGRldiBHZXQgaG93IG1hbnkgdG9rZW5zIGFyZSBhdmFpbGFibGUgdG8gYmUgY2xhaW1lZAogICAqLwogIGZ1bmN0aW9uIGdldEF2YWlsYWJsZVRva2VucygpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICB1aW50MjU2IHBlcmlvZCA9IGJsb2NrLnRpbWVzdGFtcC5zdWIoc3RhcnRUaW1lc3RhbXApCiAgICAgIC5kaXYoc2Vjb25kc1BlclBlcmlvZCk7CgogICAgaWYgKHBlcmlvZCA8IGNsaWZmRHVyYXRpb24pIHsKICAgICAgcmV0dXJuIDA7CiAgICB9IGVsc2UgaWYgKHBlcmlvZCA+PSB0b3RhbFBlcmlvZHMpIHsKICAgICAgcmV0dXJuIHRva2Vucy5zdWIoY2xhaW1lZCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gdG9rZW5zLm11bChwZXJpb2QuYWRkKDEpKS5kaXYodG90YWxQZXJpb2RzKS5zdWIoY2xhaW1lZCk7CiAgICB9CiAgfQoKICAvKioKICAgICBAZGV2IENsYWltIHRoZSB0b2tlbnMsIHRoZXkgY2FuIGJlIGNsYWltZWQgb25seSBieSB0aGUgb3duZXIKICAgICBvZiB0aGUgY29udHJhY3QKCiAgICAgQHBhcmFtIGFtb3VudCBob3cgbWFueSB0b2tlbnMgdG8gYmUgY2xhaW1lZAogICAqLwogIGZ1bmN0aW9uIGNsYWltVG9rZW5zKHVpbnQyNTYgYW1vdW50KSBwdWJsaWMgb25seU93bmVyIHsKICAgIGFzc2VydChnZXRBdmFpbGFibGVUb2tlbnMoKSA+PSBhbW91bnQpOwoKICAgIGNsYWltZWQgPSBjbGFpbWVkLmFkZChhbW91bnQpOwogICAgdG9rZW4udHJhbnNmZXIob3duZXIsIGFtb3VudCk7CiAgfQoKfQoKCi8qKgogICBAdGl0bGUgTWFya2V0IFZhbGlkYXRpb24gTWVjaGFuaXNtIChNVk0pCiAqLwpjb250cmFjdCBMaWZNYXJrZXRWYWxpZGF0aW9uTWVjaGFuaXNtIGlzIE93bmFibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBUaGUgTGlmIHRva2VuIGNvbnRyYWN0CiAgTGlmVG9rZW4gcHVibGljIGxpZlRva2VuOwoKICAvLyBUaGUgYWRkcmVzcyBvZiB0aGUgZm91bmRhdGlvbiB3YWxsZXQuIEl0IGNhbiBjbGFpbSBwYXJ0IG9mIHRoZSBldGggZnVuZHMKICAvLyBmb2xsb3dpbmcgYW4gZXhwb25lbnRpYWwgY3VydmUgdW50aWwgdGhlIGVuZCBvZiB0aGUgTVZNIGxpZmV0aW1lICgyNCBvciA0OAogIC8vIG1vbnRocykuIEFmdGVyIHRoYXQgaXQgY2FuIGNsYWltIDEwMCUgb2YgdGhlIHJlbWFpbmluZyBldGggaW4gdGhlIE1WTS4KICBhZGRyZXNzIHB1YmxpYyBmb3VuZGF0aW9uQWRkcjsKCiAgLy8gVGhlIGFtb3VudCBvZiB3ZWkgdGhhdCB0aGUgTVZNIHJlY2VpdmVkIGluaXRpYWxseQogIHVpbnQyNTYgcHVibGljIGluaXRpYWxXZWk7CgogIC8vIFN0YXJ0IHRpbWVzdGFtcCBzaW5jZSB3aGljaCB0aGUgTVZNIGJlZ2lucyB0byBhY2NlcHQgdG9rZW5zIHZpYSBzZW5kVG9rZW5zCiAgdWludDI1NiBwdWJsaWMgc3RhcnRUaW1lc3RhbXA7CgogIC8vIFF1YW50aXR5IG9mIHNlY29uZHMgaW4gZXZlcnkgcGVyaW9kLCB1c3VhbGx5IGVxdWl2YWxlbnQgdG8gMzAgZGF5cwogIHVpbnQyNTYgcHVibGljIHNlY29uZHNQZXJQZXJpb2Q7CgogIC8vIE51bWJlciBvZiBwZXJpb2RzLiBJdCBzaG91bGQgYmUgMjQgb3IgNDggKGVhY2ggcGVyaW9kIGlzIHJvdWdobHkgYSBtb250aCkKICB1aW50OCBwdWJsaWMgdG90YWxQZXJpb2RzOwoKICAvLyBUaGUgdG90YWwgYW1vdW50IG9mIHdlaSB0aGF0IHdhcyBjbGFpbWVkIGJ5IHRoZSBmb3VuZGF0aW9uIHNvIGZhcgogIHVpbnQyNTYgcHVibGljIHRvdGFsV2VpQ2xhaW1lZCA9IDA7CgogIC8vIFRoZSBwcmljZSBhdCB3aGljaCB0aGUgTVZNIGJ1eXMgdG9rZW5zIGF0IHRoZSBiZWdpbm5pbmcgb2YgaXRzIGxpZmV0aW1lCiAgdWludDI1NiBwdWJsaWMgaW5pdGlhbEJ1eVByaWNlID0gMDsKCiAgLy8gQW1vdW50IG9mIHRva2VucyB0aGF0IHdlcmUgYnVybmVkIGJ5IHRoZSBNVk0KICB1aW50MjU2IHB1YmxpYyB0b3RhbEJ1cm5lZFRva2VucyA9IDA7CgogIC8vIEFtb3VudCBvZiB3ZWkgdGhhdCB3YXMgcmVpbWJ1cnNlZCB2aWEgc2VuZFRva2VucyBjYWxscwogIHVpbnQyNTYgcHVibGljIHRvdGFsUmVpbWJ1cnNlZFdlaSA9IDA7CgogIC8vIFRvdGFsIHN1cHBseSBvZiB0b2tlbnMgd2hlbiB0aGUgTVZNIHdhcyBjcmVhdGVkCiAgdWludDI1NiBwdWJsaWMgb3JpZ2luYWxUb3RhbFN1cHBseTsKCiAgdWludDI1NiBjb25zdGFudCBQUklDRV9GQUNUT1IgPSAxMDAwMDA7CgogIC8vIEhhcyB0aGUgTVZNIGJlZW4gZnVuZGVkIGJ5IGNhbGxpbmcgYGZ1bmRgPyBJdCBjYW4gYmUgZnVuZGVkIG9ubHkgb25jZQogIGJvb2wgcHVibGljIGZ1bmRlZCA9IGZhbHNlOwoKICAvLyB0cnVlIHdoZW4gdGhlIG1hcmtldCBNVk0gaXMgcGF1c2VkCiAgYm9vbCBwdWJsaWMgcGF1c2VkID0gZmFsc2U7CgogIC8vIHRvdGFsIGFtb3VudCBvZiBzZWNvbmRzIHRoYXQgdGhlIE1WTSB3YXMgcGF1c2VkCiAgdWludDI1NiBwdWJsaWMgdG90YWxQYXVzZWRTZWNvbmRzID0gMDsKCiAgLy8gdGhlIHRpbWVzdGFtcCB3aGVyZSB0aGUgTVZNIHdhcyBwYXVzZWQKICB1aW50MjU2IHB1YmxpYyBwYXVzZWRUaW1lc3RhbXA7CgogIHVpbnQyNTZbXSBwdWJsaWMgcGVyaW9kczsKCiAgLy8gRXZlbnRzCiAgZXZlbnQgUGF1c2UoKTsKICBldmVudCBVbnBhdXNlKHVpbnQyNTYgcGF1c2VkU2Vjb25kcyk7CgogIGV2ZW50IENsYWltZWRXZWkodWludDI1NiBjbGFpbWVkV2VpKTsKICBldmVudCBTZW50VG9rZW5zKGFkZHJlc3MgaW5kZXhlZCBzZW5kZXIsIHVpbnQyNTYgcHJpY2UsIHVpbnQyNTYgdG9rZW5zLCB1aW50MjU2IHJldHVybmVkV2VpKTsKCiAgbW9kaWZpZXIgd2hlbk5vdFBhdXNlZCgpewogICAgYXNzZXJ0KCFwYXVzZWQpOwogICAgXzsKICB9CgogIG1vZGlmaWVyIHdoZW5QYXVzZWQoKXsKICAgIGFzc2VydChwYXVzZWQpOwogICAgXzsKICB9CgogIC8qKgogICAgIEBkZXYgQ29uc3RydWN0b3IKCiAgICAgQHBhcmFtIGxpZkFkZHIgdGhlIGxpZiB0b2tlbiBhZGRyZXNzCiAgICAgQHBhcmFtIF9zdGFydFRpbWVzdGFtcCBzZWUgYHN0YXJ0VGltZXN0YW1wYAogICAgIEBwYXJhbSBfc2Vjb25kc1BlclBlcmlvZCBzZWUgYHNlY29uZHNQZXJQZXJpb2RgCiAgICAgQHBhcmFtIF90b3RhbFBlcmlvZHMgc2VlIGB0b3RhbFBlcmlvZHNgCiAgICAgQHBhcmFtIF9mb3VuZGF0aW9uQWRkciBzZWUgYGZvdW5kYXRpb25BZGRyYAogICAgKi8KICBmdW5jdGlvbiBMaWZNYXJrZXRWYWxpZGF0aW9uTWVjaGFuaXNtKAogICAgYWRkcmVzcyBsaWZBZGRyLCB1aW50MjU2IF9zdGFydFRpbWVzdGFtcCwgdWludDI1NiBfc2Vjb25kc1BlclBlcmlvZCwKICAgIHVpbnQ4IF90b3RhbFBlcmlvZHMsIGFkZHJlc3MgX2ZvdW5kYXRpb25BZGRyCiAgKSB7CiAgICByZXF1aXJlKGxpZkFkZHIgIT0gYWRkcmVzcygwKSk7CiAgICByZXF1aXJlKF9zdGFydFRpbWVzdGFtcCA+IGJsb2NrLnRpbWVzdGFtcCk7CiAgICByZXF1aXJlKF9zZWNvbmRzUGVyUGVyaW9kID4gMCk7CiAgICByZXF1aXJlKF90b3RhbFBlcmlvZHMgPT0gMjQgfHwgX3RvdGFsUGVyaW9kcyA9PSA0OCk7CiAgICByZXF1aXJlKF9mb3VuZGF0aW9uQWRkciAhPSBhZGRyZXNzKDApKTsKCiAgICBsaWZUb2tlbiA9IExpZlRva2VuKGxpZkFkZHIpOwogICAgc3RhcnRUaW1lc3RhbXAgPSBfc3RhcnRUaW1lc3RhbXA7CiAgICBzZWNvbmRzUGVyUGVyaW9kID0gX3NlY29uZHNQZXJQZXJpb2Q7CiAgICB0b3RhbFBlcmlvZHMgPSBfdG90YWxQZXJpb2RzOwogICAgZm91bmRhdGlvbkFkZHIgPSBfZm91bmRhdGlvbkFkZHI7CgogIH0KCiAgLyoqCiAgICAgQGRldiBSZWNlaXZlcyB0aGUgaW5pdGlhbCBmdW5kaW5nIGZyb20gdGhlIENyb3dkc2FsZS4gQ2FsY3VsYXRlcyB0aGUKICAgICBpbml0aWFsIGJ1eSBwcmljZSBhcyBpbml0aWFsV2VpIC8gdG90YWxTdXBwbHkKICAgICovCiAgZnVuY3Rpb24gZnVuZCgpIHB1YmxpYyBwYXlhYmxlIG9ubHlPd25lciB7CiAgICBhc3NlcnQoIWZ1bmRlZCk7CgogICAgb3JpZ2luYWxUb3RhbFN1cHBseSA9IGxpZlRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICBpbml0aWFsV2VpID0gbXNnLnZhbHVlOwogICAgaW5pdGlhbEJ1eVByaWNlID0gaW5pdGlhbFdlaS4KICAgICAgbXVsKFBSSUNFX0ZBQ1RPUikuCiAgICAgIGRpdihvcmlnaW5hbFRvdGFsU3VwcGx5KTsKCiAgICBmdW5kZWQgPSB0cnVlOwogIH0KCiAgLyoqCiAgICAgQGRldiBjYWxjdWxhdGVzIHRoZSBleHBvbmVudGlhbCBkaXN0cmlidXRpb24gY3VydmUuIEl0IGRldGVybWluZXMgaG93IG11Y2gKICAgICB3ZWkgY2FuIGJlIGRpc3RyaWJ1dGVkIGJhY2sgdG8gdGhlIGZvdW5kYXRpb24gZXZlcnkgbW9udGguIEl0IHN0YXJ0cyB3aXRoCiAgICAgdmVyeSBsb3cgYW1vdW50cyBlbmRpbmcgd2l0aCBoaWdoZXIgY2h1bmtzIGF0IHRoZSBlbmQgb2YgdGhlIE1WTSBsaWZldGltZQogICAgKi8KICBmdW5jdGlvbiBjYWxjdWxhdGVEaXN0cmlidXRpb25QZXJpb2RzKCkgcHVibGljIHsKICAgIGFzc2VydCh0b3RhbFBlcmlvZHMgPT0gMjQgfHwgdG90YWxQZXJpb2RzID09IDQ4KTsKICAgIGFzc2VydChwZXJpb2RzLmxlbmd0aCA9PSAwKTsKCiAgICAvLyBUYWJsZSB3aXRoIHRoZSBtYXggZGVsdGEgJSB0aGF0IGNhbiBiZSBkaXN0cmlidXRlZCBiYWNrIHRvIHRoZSBmb3VuZGF0aW9uIG9uCiAgICAvLyBlYWNoIHBlcmlvZC4gSXQgZm9sbG93cyBhbiBleHBvbmVudGlhbCBjdXJ2ZSAoc3RhcnRzIHdpdGggbG93ZXIgJSBhbmQgZW5kcwogICAgLy8gd2l0aCBoaWdoZXIgJSkgdG8ga2VlcCB0aGUgZnVuZHMgaW4gdGhlIE1WTSBsb25nZXIuIGRlbHRhczI0CiAgICAvLyBpcyB1c2VkIHdoZW4gTVZNIGxpZmV0aW1lIGlzIDI0IG1vbnRocywgZGVsdGFzNDggd2hlbiBpdCdzIDQ4IG1vbnRocy4KICAgIC8vIFRoZSBzdW0gaXMgbGVzcyB0aGFuIDEwMCUgYmVjYXVzZSB0aGUgbGFzdCAlIGlzIG1pc3Npbmc6IGFmdGVyIHRoZSBsYXN0IHBlcmlvZAogICAgLy8gdGhlIDEwMCUgcmVtYWluaW5nIGNhbiBiZSBjbGFpbWVkIGJ5IHRoZSBmb3VuZGF0aW9uLiBWYWx1ZXMgbXVsdGlwbGVkIGJ5IDEwXjUKCiAgICB1aW50MjU2WzI0XSBtZW1vcnkgYWNjdW1EaXN0cmlidXRpb24yNCA9IFsKICAgICAgdWludDI1NigwKSwgMTgsIDExNywgMzUxLCA3NjcsIDE0MDcsCiAgICAgIDIzMDksIDM1MTEsIDUwNDcsIDY5NTIsIDkyNTcsIDExOTk1LAogICAgICAxNTE5NiwgMTg4ODksIDIzMTA0LCAyNzg3MCwgMzMyMTUsIDM5MTY2LAogICAgICA0NTc0OSwgNTI5OTIsIDYwOTIxLCA2OTU2MSwgNzg5MzgsIDg5MDc2CiAgICBdOwoKICAgIHVpbnQyNTZbNDhdIG1lbW9yeSBhY2N1bURpc3RyaWJ1dGlvbjQ4ID0gWwogICAgICB1aW50MjU2KDApLCAzLCAxOCwgNTQsIDExNywgMjE0LCAzNTEsIDUzNCwKICAgICAgNzY3LCAxMDU2LCAxNDA2LCAxODIyLCAyMzA4LCAyODY5LCAzNTEwLCA0MjM0LAogICAgICA1MDQ2LCA1OTUwLCA2OTUwLCA4MDUxLCA5MjU2LCAxMDU2OSwgMTE5OTQsIDEzNTM1LAogICAgICAxNTE5NSwgMTY5NzgsIDE4ODg4LCAyMDkyOSwgMjMxMDQsIDI1NDE2LCAyNzg3MCwgMzA0NjgsCiAgICAgIDMzMjE0LCAzNjExMiwgMzkxNjUsIDQyMzc2LCA0NTc0OSwgNDkyODYsIDUyOTkyLCA1Njg2OSwKICAgICAgNjA5MjEsIDY1MTUwLCA2OTU2MCwgNzQxNTUsIDc4OTM3LCA4MzkwOSwgODkwNzUsIDk0NDM4CiAgICBdOwoKICAgIGZvciAodWludDggaSA9IDA7IGkgPCB0b3RhbFBlcmlvZHM7IGkrKykgewoKICAgICAgaWYgKHRvdGFsUGVyaW9kcyA9PSAyNCkgewogICAgICAgIHBlcmlvZHMucHVzaChhY2N1bURpc3RyaWJ1dGlvbjI0W2ldKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwZXJpb2RzLnB1c2goYWNjdW1EaXN0cmlidXRpb240OFtpXSk7CiAgICAgIH0KCiAgICB9CiAgfQoKICAvKioKICAgICBAZGV2IFJldHVybnMgdGhlIGN1cnJlbnQgcGVyaW9kIGFzIGEgbnVtYmVyIGZyb20gMCB0byB0b3RhbFBlcmlvZHMKCiAgICAgQHJldHVybiB0aGUgY3VycmVudCBwZXJpb2QgYXMgYSBudW1iZXIgZnJvbSAwIHRvIHRvdGFsUGVyaW9kcwogICAgKi8KICBmdW5jdGlvbiBnZXRDdXJyZW50UGVyaW9kSW5kZXgoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyh1aW50MjU2KSB7CiAgICBhc3NlcnQoYmxvY2sudGltZXN0YW1wID49IHN0YXJ0VGltZXN0YW1wKTsKICAgIHJldHVybiBibG9jay50aW1lc3RhbXAuc3ViKHN0YXJ0VGltZXN0YW1wKS4KICAgICAgc3ViKHRvdGFsUGF1c2VkU2Vjb25kcykuCiAgICAgIGRpdihzZWNvbmRzUGVyUGVyaW9kKTsKICB9CgogIC8qKgogICAgIEBkZXYgY2FsY3VsYXRlcyB0aGUgYWNjdW11bGF0ZWQgZGlzdHJpYnV0aW9uIHBlcmNlbnRhZ2UgYXMgb2Ygbm93LAogICAgIGZvbGxvd2luZyB0aGUgZXhwb25lbnRpYWwgZGlzdHJpYnV0aW9uIGN1cnZlCgogICAgIEByZXR1cm4gdGhlIGFjY3VtdWxhdGVkIGRpc3RyaWJ1dGlvbiBwZXJjZW50YWdlLCB1c2VkIHRvIGNhbGN1bGF0ZSB0aGluZ3MKICAgICBsaWtlIHRoZSBtYXhpbXVtIGFtb3VudCB0aGF0IGNhbiBiZSBjbGFpbWVkIGJ5IHRoZSBmb3VuZGF0aW9uCiAgICAqLwogIGZ1bmN0aW9uIGdldEFjY3VtdWxhdGVkRGlzdHJpYnV0aW9uUGVyY2VudGFnZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zKHVpbnQyNTYgcGVyY2VudGFnZSkgewogICAgdWludDI1NiBwZXJpb2QgPSBnZXRDdXJyZW50UGVyaW9kSW5kZXgoKTsKCiAgICBhc3NlcnQocGVyaW9kIDwgdG90YWxQZXJpb2RzKTsKCiAgICByZXR1cm4gcGVyaW9kc1twZXJpb2RdOwogIH0KCiAgLyoqCiAgICAgQGRldiByZXR1cm5zIHRoZSBjdXJyZW50IGJ1eSBwcmljZSBhdCB3aGljaCB0aGUgTVZNIG9mZmVycyB0byBidXkgdG9rZW5zIHRvCiAgICAgYnVybiB0aGVtCgogICAgIEByZXR1cm4gdGhlIGN1cnJlbnQgYnV5IHByaWNlIChpbiBldGgvbGlmLCBtdWx0aXBsaWVkIGJ5IFBSSUNFX0ZBQ1RPUikKICAgICovCiAgZnVuY3Rpb24gZ2V0QnV5UHJpY2UoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NiBwcmljZSkgewogICAgdWludDI1NiBhY2N1bXVsYXRlZERpc3RyaWJ1dGlvblBlcmNlbnRhZ2UgPSBnZXRBY2N1bXVsYXRlZERpc3RyaWJ1dGlvblBlcmNlbnRhZ2UoKTsKCiAgICByZXR1cm4gaW5pdGlhbEJ1eVByaWNlLgogICAgICBtdWwoUFJJQ0VfRkFDVE9SLnN1YihhY2N1bXVsYXRlZERpc3RyaWJ1dGlvblBlcmNlbnRhZ2UpKS4KICAgICAgZGl2KFBSSUNFX0ZBQ1RPUik7CiAgfQoKICAvKioKICAgICBAZGV2IFJldHVybnMgdGhlIG1heGltdW0gYW1vdW50IG9mIHdlaSB0aGF0IHRoZSBmb3VuZGF0aW9uIGNhbiBjbGFpbS4gSXQncwogICAgIGEgcG9ydGlvbiBvZiB0aGUgRVRIIHRoYXQgd2FzIG5vdCBjbGFpbWVkIGJ5IHRva2VuIGhvbGRlcnMKCiAgICAgQHJldHVybiB0aGUgbWF4aW11bSB3ZWkgY2xhaW1hYmxlIGJ5IHRoZSBmb3VuZGF0aW9uIGFzIG9mIG5vdwogICAgKi8KICBmdW5jdGlvbiBnZXRNYXhDbGFpbWFibGVXZWlBbW91bnQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAodWludDI1NikgewogICAgaWYgKGlzRmluaXNoZWQoKSkgewogICAgICByZXR1cm4gdGhpcy5iYWxhbmNlOwogICAgfSBlbHNlIHsKICAgICAgdWludDI1NiBjbGFpbWFibGVGcm9tUmVpbWJ1cnNlZCA9IGluaXRpYWxCdXlQcmljZS4KICAgICAgICBtdWwodG90YWxCdXJuZWRUb2tlbnMpLmRpdihQUklDRV9GQUNUT1IpLgogICAgICAgIHN1Yih0b3RhbFJlaW1idXJzZWRXZWkpOwogICAgICB1aW50MjU2IGN1cnJlbnRDaXJjdWxhdGlvbiA9IGxpZlRva2VuLnRvdGFsU3VwcGx5KCk7CiAgICAgIHVpbnQyNTYgYWNjdW11bGF0ZWREaXN0cmlidXRpb25QZXJjZW50YWdlID0gZ2V0QWNjdW11bGF0ZWREaXN0cmlidXRpb25QZXJjZW50YWdlKCk7CiAgICAgIHVpbnQyNTYgbWF4Q2xhaW1hYmxlID0gaW5pdGlhbFdlaS4KICAgICAgICBtdWwoYWNjdW11bGF0ZWREaXN0cmlidXRpb25QZXJjZW50YWdlKS5kaXYoUFJJQ0VfRkFDVE9SKS4KICAgICAgICBtdWwoY3VycmVudENpcmN1bGF0aW9uKS5kaXYob3JpZ2luYWxUb3RhbFN1cHBseSkuCiAgICAgICAgYWRkKGNsYWltYWJsZUZyb21SZWltYnVyc2VkKTsKCiAgICAgIGlmIChtYXhDbGFpbWFibGUgPiB0b3RhbFdlaUNsYWltZWQpIHsKICAgICAgICByZXR1cm4gbWF4Q2xhaW1hYmxlLnN1Yih0b3RhbFdlaUNsYWltZWQpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgICBAZGV2IGFsbG93cyB0byBzZW5kIHRva2VucyB0byB0aGUgTVZNIGluIGV4Y2hhbmdlIG9mIEV0aCBhdCB0aGUgcHJpY2UKICAgICBkZXRlcm1pbmVkIGJ5IGdldEJ1eVByaWNlLiBUaGUgdG9rZW5zIGFyZSBidXJuZWQKICAgICovCiAgZnVuY3Rpb24gc2VuZFRva2Vucyh1aW50MjU2IHRva2VucykgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgcmVxdWlyZSh0b2tlbnMgPiAwKTsKCiAgICB1aW50MjU2IHByaWNlID0gZ2V0QnV5UHJpY2UoKTsKICAgIHVpbnQyNTYgdG90YWxXZWkgPSB0b2tlbnMubXVsKHByaWNlKS5kaXYoUFJJQ0VfRkFDVE9SKTsKCiAgICBsaWZUb2tlbi50cmFuc2ZlckZyb20obXNnLnNlbmRlciwgYWRkcmVzcyh0aGlzKSwgdG9rZW5zKTsKICAgIGxpZlRva2VuLmJ1cm4odG9rZW5zKTsKICAgIHRvdGFsQnVybmVkVG9rZW5zID0gdG90YWxCdXJuZWRUb2tlbnMuYWRkKHRva2Vucyk7CgogICAgU2VudFRva2Vucyhtc2cuc2VuZGVyLCBwcmljZSwgdG9rZW5zLCB0b3RhbFdlaSk7CgogICAgdG90YWxSZWltYnVyc2VkV2VpID0gdG90YWxSZWltYnVyc2VkV2VpLmFkZCh0b3RhbFdlaSk7CiAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvdGFsV2VpKTsKICB9CgogIC8qKgogICAgIEBkZXYgUmV0dXJucyB3aGV0aGVyIHRoZSBNVk0gZW5kLW9mLWxpZmUgaGFzIGJlZW4gcmVhY2hlZC4gV2hlbiB0aGF0CiAgICAgaGFwcGVucyBubyBtb3JlIHRva2VucyBjYW4gYmUgc2VudCB0byB0aGUgTVZNIGFuZCB0aGUgZm91bmRhdGlvbiBjYW4gY2xhaW0KICAgICAxMDAlIG9mIHRoZSByZW1haW5pbmcgYmFsYW5jZSBpbiB0aGUgTVZNCgogICAgIEByZXR1cm4gdHJ1ZSBpZiB0aGUgTVZNIGVuZC1vZi1saWZlIGhhcyBiZWVuIHJlYWNoZWQKICAgICovCiAgZnVuY3Rpb24gaXNGaW5pc2hlZCgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zIChib29sIGZpbmlzaGVkKSB7CiAgICByZXR1cm4gZ2V0Q3VycmVudFBlcmlvZEluZGV4KCkgPj0gdG90YWxQZXJpb2RzOwogIH0KCiAgLyoqCiAgICAgQGRldiBDYWxsZWQgZnJvbSB0aGUgZm91bmRhdGlvbiB3YWxsZXQgdG8gY2xhaW0gZXRoIGJhY2sgZnJvbSB0aGUgTVZNLgogICAgIE1heGltdW0gYW1vdW50IHRoYXQgY2FuIGJlIGNsYWltZWQgaXMgZGV0ZXJtaW5lZCBieQogICAgIGdldE1heENsYWltYWJsZVdlaUFtb3VudAogICAgKi8KICBmdW5jdGlvbiBjbGFpbVdlaSh1aW50MjU2IHdlaUFtb3VudCkgcHVibGljIHdoZW5Ob3RQYXVzZWQgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGZvdW5kYXRpb25BZGRyKTsKCiAgICB1aW50MjU2IGNsYWltYWJsZSA9IGdldE1heENsYWltYWJsZVdlaUFtb3VudCgpOwoKICAgIGFzc2VydChjbGFpbWFibGUgPj0gd2VpQW1vdW50KTsKCiAgICBmb3VuZGF0aW9uQWRkci50cmFuc2Zlcih3ZWlBbW91bnQpOwoKICAgIHRvdGFsV2VpQ2xhaW1lZCA9IHRvdGFsV2VpQ2xhaW1lZC5hZGQod2VpQW1vdW50KTsKCiAgICBDbGFpbWVkV2VpKHdlaUFtb3VudCk7CiAgfQoKICAvKioKICAgICBAZGV2IFBhdXNlcyB0aGUgTVZNLiBObyB0b2tlbnMgY2FuIGJlIHNlbnQgdG8gdGhlIE1WTSBhbmQgbm8gZXRoIGNhbiBiZQogICAgIGNsYWltZWQgZnJvbSB0aGUgTVZNIHdoaWxlIHBhdXNlZC4gTVZNIHRvdGFsIGxpZmV0aW1lIGlzIGV4dGVuZGVkIGJ5IHRoZQogICAgIHBlcmlvZCBpdCBzdGF5cyBwYXVzZWQKICAgICovCiAgZnVuY3Rpb24gcGF1c2UoKSBwdWJsaWMgb25seU93bmVyIHdoZW5Ob3RQYXVzZWQgewogICAgcGF1c2VkID0gdHJ1ZTsKICAgIHBhdXNlZFRpbWVzdGFtcCA9IGJsb2NrLnRpbWVzdGFtcDsKCiAgICBQYXVzZSgpOwogIH0KCiAgLyoqCiAgICAgQGRldiBVbnBhdXNlcyB0aGUgTVZNLiBTZWUgYHBhdXNlYCBmb3IgbW9yZSBkZXRhaWxzIGFib3V0IHBhdXNpbmcKICAgICovCiAgZnVuY3Rpb24gdW5wYXVzZSgpIHB1YmxpYyBvbmx5T3duZXIgd2hlblBhdXNlZCB7CiAgICB1aW50MjU2IHBhdXNlZFNlY29uZHMgPSBibG9jay50aW1lc3RhbXAuc3ViKHBhdXNlZFRpbWVzdGFtcCk7CiAgICB0b3RhbFBhdXNlZFNlY29uZHMgPSB0b3RhbFBhdXNlZFNlY29uZHMuYWRkKHBhdXNlZFNlY29uZHMpOwogICAgcGF1c2VkID0gZmFsc2U7CgogICAgVW5wYXVzZShwYXVzZWRTZWNvbmRzKTsKICB9Cgp9CgovKioKICAgQHRpdGxlIENyb3dkc2FsZSBmb3IgdGhlIExpZiBUb2tlbiBHZW5lcmF0aW9uIEV2ZW50CgogICBJbXBsZW1lbnRhdGlvbiBvZiB0aGUgTGlmIFRva2VuIEdlbmVyYXRpb24gRXZlbnQgKFRHRSkgQ3Jvd2RzYWxlOiBBIDIgd2VlawogICBmaXhlZCBwcmljZSwgdW5jYXBwZWQgdG9rZW4gc2FsZSwgd2l0aCBhIGRpc2NvdW50ZWQgcmF0ZWZvciBjb250cmlidXRpb25zCiAgICYjMjM2O24gdGhlIHByaXZhdGUgcHJlc2FsZSBhbmQgYSBNYXJrZXQgVmFsaWRhdGlvbiBNZWNoYW5pc20gdGhhdCB3aWxsIHJlY2VpdmUKICAgdGhlIGZ1bmRzIG92ZXIgdGhlIFVTRCAxME0gc29mdCBjYXAuCiAgIFRoZSBjcm93ZHNhbGUgaGFzIGEgbWluaW11bSBjYXAgb2YgVVNEIDVNIHdoaWNoIGluIGNhc2Ugb2Ygbm90IGJlaW5nIHJlYWNoZWQKICAgYnkgcHVyY2hhc2VzIG1hZGUgZHVyaW5nIHRoZSAyIHdlZWsgcGVyaW9kIHRoZSB0b2tlbiB3aWxsIG5vdCBzdGFydCBvcGVyYXRpbmcKICAgYW5kIGFsbCBmdW5kcyBzZW50IGR1cmluZyB0aGF0IHBlcmlvZCB3aWxsIGJlIG1hZGUgYXZhaWxhYmxlIHRvIGJlIGNsYWltZWQgYnkKICAgdGhlIG9yaWdpbmF0aW5nIGFkZHJlc3Nlcy4KICAgRnVuZHMgdXAgdG8gdGhlIFVTRCAxME0gc29mdCBjYXAgd2lsbCBiZSBzZW50IHRvIHRoZSBXaW5kaW5nIFRyZWUgRm91bmRhdGlvbgogICB3YWxsZXQgYXQgdGhlIGVuZCBvZiB0aGUgY3Jvd2RzYWxlLgogICBGdW5kcyBvdmVyIHRoYXQgYW1vdW50IHdpbGwgYmUgcHV0IGluIGEgTWFya2V0VmFsaWRhdGlvbk1lY2hhbmlzbSAoTVZNKSBzbWFydAogICBjb250cmFjdCB0aGF0IGd1YXJhbnRlZXMgYSBwcmljZSBmbG9vciBmb3IgYSBwZXJpb2Qgb2YgMiBvciA0IHllYXJzLCBhbGxvd2luZwogICBhbnkgdG9rZW4gaG9sZGVyIHRvIGJ1cm4gdGhlaXIgdG9rZW5zIGluIGV4Y2hhbmdlIG9mIHBhcnQgb2YgdGhlIGV0aCBhbW91bnQKICAgc2VudCBkdXJpbmcgdGhlIFRHRSBpbiBleGNoYW5nZSBvZiB0aG9zZSB0b2tlbnMuCiAqLwpjb250cmFjdCBMaWZDcm93ZHNhbGUgaXMgT3duYWJsZSwgUGF1c2FibGUgewogIHVzaW5nIFNhZmVNYXRoIGZvciB1aW50MjU2OwoKICAvLyBUaGUgdG9rZW4gYmVpbmcgc29sZC4KICBMaWZUb2tlbiBwdWJsaWMgdG9rZW47CgogIC8vIEJlZ2lubmluZyBvZiB0aGUgcGVyaW9kIHdoZXJlIHRva2VucyBjYW4gYmUgcHVyY2hhc2VkIGF0IHJhdGUgYHJhdGUxYC4KICB1aW50MjU2IHB1YmxpYyBzdGFydFRpbWVzdGFtcDsKICAvLyBNb21lbnQgYWZ0ZXIgd2hpY2ggdGhlIHJhdGUgdG8gYnV5IHRva2VucyBnb2VzIGZyb20gYHJhdGUxYCB0byBgcmF0ZTJgLgogIHVpbnQyNTYgcHVibGljIGVuZDFUaW1lc3RhbXA7CiAgLy8gTWFya3MgdGhlIGVuZCBvZiB0aGUgVG9rZW4gR2VuZXJhdGlvbiBFdmVudC4KICB1aW50MjU2IHB1YmxpYyBlbmQyVGltZXN0YW1wOwoKICAvLyBBZGRyZXNzIG9mIHRoZSBXaW5kaW5nIFRyZWUgRm91bmRhdGlvbiB3YWxsZXQuIEZ1bmRzIHVwIHRvIHRoZSBzb2Z0IGNhcCBhcmUKICAvLyBzZW50IHRvIHRoaXMgYWRkcmVzcy4gSXQncyBhbHNvIHRoZSBhZGRyZXNzIHRvIHdoaWNoIHRoZSBNVk0gZGlzdHJpYnV0ZXMKICAvLyB0aGUgZnVuZHMgdGhhdCBhcmUgbWFkZSBhdmFpbGFibGUgbW9udGggYWZ0ZXIgbW9udGguIEFuIGV4dHJhIDUlIG9mIHRva2VucwogIC8vIGFyZSBwdXQgaW4gYSBWZXN0ZWQgUGF5bWVudCB3aXRoIHRoaXMgYWRkcmVzcyBhcyBiZW5lZmljaWFyeSwgYWN0aW5nIGFzIGEKICAvLyBsb25nLXRlcm0gcmVzZXJ2ZSBmb3IgdGhlIGZvdW5kYXRpb24uCiAgYWRkcmVzcyBwdWJsaWMgZm91bmRhdGlvbldhbGxldDsKCiAgLy8gQWRkcmVzcyBvZiB0aGUgV2luZGluZyBUcmVlIEZvdW5kZXJzIHdhbGxldC4gQW4gZXh0cmEgMTIuOCUgb2YgdG9rZW5zCiAgLy8gYXJlIHB1dCBpbiBhIFZlc3RlZCBQYXltZW50IHdpdGggdGhpcyBhZGRyZXNzIGFzIGJlbmVmaWNpYXJ5LCB3aXRoIDEgeWVhcgogIC8vIGNsaWZmIGFuZCA0IHllYXJzIGR1cmF0aW9uLgogIGFkZHJlc3MgcHVibGljIGZvdW5kZXJzV2FsbGV0OwoKICAvLyBUR0UgbWluIGNhcCwgaW4gVVNELiBDb252ZXJ0ZWQgdG8gd2VpIHVzaW5nIGB3ZWlQZXJVU0RpblRHRWAuCiAgdWludDI1NiBwdWJsaWMgbWluQ2FwVVNEID0gNTAwMDAwMDsKCiAgLy8gTWF4aW11biBhbW91bnQgZnJvbSB0aGUgVEdFIHRoYXQgdGhlIGZvdW5kYXRpb24gcmVjZWl2ZXMsIGluIFVTRC4gQ29udmVydGVkCiAgLy8gdG8gd2VpIHVzaW5nIGB3ZWlQZXJVU0RpblRHRWAuIEZ1bmRzIG92ZXIgdGhpcyBjYXAgZ28gdG8gdGhlIE1WTS4KICB1aW50MjU2IHB1YmxpYyBtYXhGb3VuZGF0aW9uQ2FwVVNEID0gMTAwMDAwMDA7CgogIC8vIE1heGltdW0gYW1vdW50IGZyb20gdGhlIFRHRSB0aGF0IG1ha2VzIHRoZSBNVk0gdG8gbGFzdCBmb3IgMjQgbW9udGhzLiBJZgogIC8vIGZ1bmRzIGZyb20gdGhlIFRHRSBleGNlZWQgdGhpcyBhbW91bnQsIHRoZSBNVk0gd2lsbCBsYXN0IGZvciAyNCBtb250aHMuCiAgdWludDI1NiBwdWJsaWMgTVZNMjRQZXJpb2RzQ2FwVVNEID0gNDAwMDAwMDA7CgogIC8vIENvbnZlcnNpb24gcmF0ZSBmcm9tIFVTRCB0byB3ZWkgdG8gdXNlIGR1cmluZyB0aGUgVEdFLgogIHVpbnQyNTYgcHVibGljIHdlaVBlclVTRGluVEdFID0gMDsKCiAgLy8gU2Vjb25kcyBiZWZvcmUgdGhlIFRHRSBzaW5jZSB3aGVuIHRoZSBjb3JyZXNwb25kaW5nIFVTRCB0bwogIC8vIHdlaSByYXRlIGNhbm5vdCBiZSBzZXQgYnkgdGhlIG93bmVyIGFueW1vcmUuCiAgdWludDI1NiBwdWJsaWMgc2V0V2VpTG9ja1NlY29uZHMgPSAwOwoKICAvLyBRdWFudGl0eSBvZiBMaWYgdGhhdCBpcyByZWNlaXZlZCBpbiBleGNoYWdlIG9mIDEgRXRoZXIgZHVyaW5nIHRoZSBmaXJzdAogIC8vIHdlZWsgb2YgdGhlIDIgd2Vla3MgVEdFCiAgdWludDI1NiBwdWJsaWMgcmF0ZTE7CgogIC8vIFF1YW50aXR5IG9mIExpZiB0aGF0IGlzIHJlY2VpdmVkIGluIGV4Y2hhZ2Ugb2YgMSBFdGhlciBkdXJpbmcgdGhlIHNlY29uZAogIC8vIHdlZWsgb2YgdGhlIDIgd2Vla3MgVEdFCiAgdWludDI1NiBwdWJsaWMgcmF0ZTI7CgogIC8vIEFtb3VudCBvZiB3ZWkgcmVjZWl2ZWQgaW4gZXhjaGFuZ2Ugb2YgdG9rZW5zIGR1cmluZyB0aGUgMiB3ZWVrcyBUR0UKICB1aW50MjU2IHB1YmxpYyB3ZWlSYWlzZWQ7CgogIC8vIEFtb3VudCBvZiBsaWYgbWludGVkIGFuZCB0cmFuc2ZlcnJlZCBkdXJpbmcgdGhlIFRHRQogIHVpbnQyNTYgcHVibGljIHRva2Vuc1NvbGQ7CgogIC8vIEFtb3VudCBvZiB3ZWkgcmVjZWl2ZWQgYXMgcHJpdmF0ZSBwcmVzYWxlIHBheW1lbnRzCiAgdWludDI1NiBwdWJsaWMgdG90YWxQcmVzYWxlV2VpOwoKICAvLyBBZGRyZXNzIG9mIHRoZSB2ZXN0aW5nIHNjaGVkdWxlIGZvciB0aGUgZm91bmRhdGlvbiBjcmVhdGVkIGF0IHRoZQogIC8vIGVuZCBvZiB0aGUgY3Jvd2RzYWxlCiAgVmVzdGVkUGF5bWVudCBwdWJsaWMgZm91bmRhdGlvblZlc3RlZFBheW1lbnQ7CgogIC8vIEFkZHJlc3Mgb2YgdGhlIHZlc3Rpbmcgc2NoZWR1bGUgZm9yIGZvdW5kZXJzIGNyZWF0ZWQgYXQgdGhlCiAgLy8gZW5kIG9mIHRoZSBjcm93ZHNhbGUKICBWZXN0ZWRQYXltZW50IHB1YmxpYyBmb3VuZGVyc1Zlc3RlZFBheW1lbnQ7CgogIC8vIEFkZHJlc3Mgb2YgdGhlIE1WTSBjcmVhdGVkIGF0IHRoZSBlbmQgb2YgdGhlIGNyb3dkc2FsZQogIExpZk1hcmtldFZhbGlkYXRpb25NZWNoYW5pc20gcHVibGljIE1WTTsKCiAgLy8gVHJhY2tzIHRoZSB3ZWkgc2VudCBwZXIgYWRkcmVzcyBkdXJpbmcgdGhlIDIgd2VlayBUR0UuIFRoaXMgaXMgdGhlIGFtb3VudAogIC8vIHRoYXQgY2FuIGJlIGNsYWltZWQgYnkgZWFjaCBhZGRyZXNzIGluIGNhc2UgdGhlIG1pbmltdW0gY2FwIGlzIG5vdCByZWFjaGVkCiAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBwdXJjaGFzZXM7CgogIC8vIEhhcyB0aGUgQ3Jvd2RzYWxlIGJlZW4gZmluYWxpemVkIGJ5IGEgc3VjY2Vzc2Z1bCBjYWxsIHRvIGBmaW5hbGl6ZWA/CiAgYm9vbCBwdWJsaWMgaXNGaW5hbGl6ZWQgPSBmYWxzZTsKCiAgLyoqCiAgICAgQGRldiBFdmVudCB0cmlnZ2VyZWQgKGF0IG1vc3Qgb25jZSkgb24gYSBzdWNjZXNzZnVsIGNhbGwgdG8gYGZpbmFsaXplYAogICoqLwogIGV2ZW50IEZpbmFsaXplZCgpOwoKICAvKioKICAgICBAZGV2IEV2ZW50IHRyaWdnZXJlZCBldmVyeSB0aW1lIGEgcHJlc2FsZSBwdXJjaGFzZSBpcyBkb25lCiAgKiovCiAgZXZlbnQgVG9rZW5QcmVzYWxlUHVyY2hhc2UoYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LCB1aW50MjU2IHdlaUFtb3VudCwgdWludDI1NiByYXRlKTsKCiAgLyoqCiAgICAgQGRldiBFdmVudCB0cmlnZ2VyZWQgb24gZXZlcnkgcHVyY2hhc2UgZHVyaW5nIHRoZSBUR0UKCiAgICAgQHBhcmFtIHB1cmNoYXNlciB3aG8gcGFpZCBmb3IgdGhlIHRva2VucwogICAgIEBwYXJhbSBiZW5lZmljaWFyeSB3aG8gZ290IHRoZSB0b2tlbnMKICAgICBAcGFyYW0gdmFsdWUgYW1vdW50IG9mIHdlaSBwYWlkCiAgICAgQHBhcmFtIGFtb3VudCBhbW91bnQgb2YgdG9rZW5zIHB1cmNoYXNlZAogICAqLwogIGV2ZW50IFRva2VuUHVyY2hhc2UoCiAgICBhZGRyZXNzIGluZGV4ZWQgcHVyY2hhc2VyLAogICAgYWRkcmVzcyBpbmRleGVkIGJlbmVmaWNpYXJ5LAogICAgdWludDI1NiB2YWx1ZSwKICAgIHVpbnQyNTYgYW1vdW50CiAgKTsKCiAgLyoqCiAgICAgQGRldiBDb25zdHJ1Y3Rvci4gQ3JlYXRlcyB0aGUgdG9rZW4gaW4gYSBwYXVzZWQgc3RhdGUKCiAgICAgQHBhcmFtIF9zdGFydFRpbWVzdGFtcCBzZWUgYHN0YXJ0VGltZXN0YW1wYAogICAgIEBwYXJhbSBfZW5kMVRpbWVzdGFtcCBzZWUgYGVuZDFUaW1lc3RhbXBgCiAgICAgQHBhcmFtIF9lbmQyVGltZXN0YW1wIHNlZSBgZW5kMlRpbWVzdGFtcAogICAgIEBwYXJhbSBfcmF0ZTEgc2VlIGByYXRlMWAKICAgICBAcGFyYW0gX3JhdGUyIHNlZSBgcmF0ZTJgCiAgICAgQHBhcmFtIF9mb3VuZGF0aW9uV2FsbGV0IHNlZSBgZm91bmRhdGlvbldhbGxldGAKICAgKi8KICBmdW5jdGlvbiBMaWZDcm93ZHNhbGUoCiAgICB1aW50MjU2IF9zdGFydFRpbWVzdGFtcCwKICAgIHVpbnQyNTYgX2VuZDFUaW1lc3RhbXAsCiAgICB1aW50MjU2IF9lbmQyVGltZXN0YW1wLAogICAgdWludDI1NiBfcmF0ZTEsCiAgICB1aW50MjU2IF9yYXRlMiwKICAgIHVpbnQyNTYgX3NldFdlaUxvY2tTZWNvbmRzLAogICAgYWRkcmVzcyBfZm91bmRhdGlvbldhbGxldCwKICAgIGFkZHJlc3MgX2ZvdW5kZXJzV2FsbGV0CiAgKSB7CgogICAgcmVxdWlyZShfc3RhcnRUaW1lc3RhbXAgPiBibG9jay50aW1lc3RhbXApOwogICAgcmVxdWlyZShfZW5kMVRpbWVzdGFtcCA+IF9zdGFydFRpbWVzdGFtcCk7CiAgICByZXF1aXJlKF9lbmQyVGltZXN0YW1wID4gX2VuZDFUaW1lc3RhbXApOwogICAgcmVxdWlyZShfcmF0ZTEgPiAwKTsKICAgIHJlcXVpcmUoX3JhdGUyID4gMCk7CiAgICByZXF1aXJlKF9zZXRXZWlMb2NrU2Vjb25kcyA+IDApOwogICAgcmVxdWlyZShfZm91bmRhdGlvbldhbGxldCAhPSBhZGRyZXNzKDApKTsKICAgIHJlcXVpcmUoX2ZvdW5kZXJzV2FsbGV0ICE9IGFkZHJlc3MoMCkpOwoKICAgIHRva2VuID0gbmV3IExpZlRva2VuKCk7CiAgICB0b2tlbi5wYXVzZSgpOwoKICAgIHN0YXJ0VGltZXN0YW1wID0gX3N0YXJ0VGltZXN0YW1wOwogICAgZW5kMVRpbWVzdGFtcCA9IF9lbmQxVGltZXN0YW1wOwogICAgZW5kMlRpbWVzdGFtcCA9IF9lbmQyVGltZXN0YW1wOwogICAgcmF0ZTEgPSBfcmF0ZTE7CiAgICByYXRlMiA9IF9yYXRlMjsKICAgIHNldFdlaUxvY2tTZWNvbmRzID0gX3NldFdlaUxvY2tTZWNvbmRzOwogICAgZm91bmRhdGlvbldhbGxldCA9IF9mb3VuZGF0aW9uV2FsbGV0OwogICAgZm91bmRlcnNXYWxsZXQgPSBfZm91bmRlcnNXYWxsZXQ7CiAgfQoKICAvKioKICAgICBAZGV2IFNldCB0aGUgd2VpIHBlciBVU0QgcmF0ZSBmb3IgdGhlIFRHRS4gSGFzIHRvIGJlIGNhbGxlZCBieQogICAgIHRoZSBvd25lciB1cCB0byBgc2V0V2VpTG9ja1NlY29uZHNgIGJlZm9yZSBgc3RhcnRUaW1lc3RhbXBgCgogICAgIEBwYXJhbSBfd2VpUGVyVVNEIHdlaSBwZXIgVVNEIHJhdGUgdmFsaWQgZHVyaW5nIHRoZSBUR0UKICAgKi8KICBmdW5jdGlvbiBzZXRXZWlQZXJVU0RpblRHRSh1aW50MjU2IF93ZWlQZXJVU0QpIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShfd2VpUGVyVVNEID4gMCk7CiAgICBhc3NlcnQoYmxvY2sudGltZXN0YW1wIDwgc3RhcnRUaW1lc3RhbXAuc3ViKHNldFdlaUxvY2tTZWNvbmRzKSk7CgogICAgd2VpUGVyVVNEaW5UR0UgPSBfd2VpUGVyVVNEOwogIH0KCiAgLyoqCiAgICAgQGRldiBSZXR1cm5zIHRoZSBjdXJyZW50IExpZiBwZXIgRXRoIHJhdGUgZHVyaW5nIHRoZSBUR0UKCiAgICAgQHJldHVybiB0aGUgY3VycmVudCBMaWYgcGVyIEV0aCByYXRlIG9yIDAgd2hlbiBub3QgaW4gVEdFCiAgICovCiAgZnVuY3Rpb24gZ2V0UmF0ZSgpIHB1YmxpYyBjb25zdGFudCByZXR1cm5zICh1aW50MjU2KSB7CiAgICBpZiAoYmxvY2sudGltZXN0YW1wIDwgc3RhcnRUaW1lc3RhbXApCiAgICAgIHJldHVybiAwOwogICAgZWxzZSBpZiAoYmxvY2sudGltZXN0YW1wIDw9IGVuZDFUaW1lc3RhbXApCiAgICAgIHJldHVybiByYXRlMTsKICAgIGVsc2UgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSBlbmQyVGltZXN0YW1wKQogICAgICByZXR1cm4gcmF0ZTI7CiAgICBlbHNlCiAgICAgIHJldHVybiAwOwogIH0KCiAgLyoqCiAgICAgQGRldiBGYWxsYmFjayBmdW5jdGlvbiwgcGF5YWJsZS4gQ2FsbHMgYGJ1eVRva2Vuc2AKICAgKi8KICBmdW5jdGlvbiAoKSBwYXlhYmxlIHsKICAgIGJ1eVRva2Vucyhtc2cuc2VuZGVyKTsKICB9CgogIC8qKgogICAgIEBkZXYgQWxsb3dzIHRvIGdldCB0b2tlbnMgZHVyaW5nIHRoZSBUR0UuIFBheWFibGUuIFRoZSB2YWx1ZSBpcyBjb252ZXJ0ZWQgdG8KICAgICBMaWYgdXNpbmcgdGhlIGN1cnJlbnQgcmF0ZSBvYnRhaW5lZCBieSBjYWxsaW5nIGBnZXRSYXRlKClgLgoKICAgICBAcGFyYW0gYmVuZWZpY2lhcnkgQWRkcmVzcyB0byB3aGljaCBMaWYgc2hvdWxkIGJlIHNlbnQKICAgKi8KICBmdW5jdGlvbiBidXlUb2tlbnMoYWRkcmVzcyBiZW5lZmljaWFyeSkgcHVibGljIHBheWFibGUgdmFsaWRQdXJjaGFzZSB7CiAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgYXNzZXJ0KHdlaVBlclVTRGluVEdFID4gMCk7CgogICAgdWludDI1NiB3ZWlBbW91bnQgPSBtc2cudmFsdWU7CgogICAgLy8gZ2V0IGN1cnJlbnQgcHJpY2UgKGl0IGRlcGVuZHMgb24gY3VycmVudCBibG9jayBudW1iZXIpCiAgICB1aW50MjU2IHJhdGUgPSBnZXRSYXRlKCk7CgogICAgYXNzZXJ0KHJhdGUgPiAwKTsKCiAgICAvLyBjYWxjdWxhdGUgdG9rZW4gYW1vdW50IHRvIGJlIGNyZWF0ZWQKICAgIHVpbnQyNTYgdG9rZW5zID0gd2VpQW1vdW50Lm11bChyYXRlKTsKCiAgICAvLyBzdG9yZSB3ZWkgYW1vdW50IGluIGNhc2Ugb2YgVEdFIG1pbiBjYXAgbm90IHJlYWNoZWQKICAgIHdlaVJhaXNlZCA9IHdlaVJhaXNlZC5hZGQod2VpQW1vdW50KTsKICAgIHB1cmNoYXNlc1tiZW5lZmljaWFyeV0gPSB3ZWlBbW91bnQ7CiAgICB0b2tlbnNTb2xkID0gdG9rZW5zU29sZC5hZGQodG9rZW5zKTsKCiAgICB0b2tlbi5taW50KGJlbmVmaWNpYXJ5LCB0b2tlbnMpOwogICAgVG9rZW5QdXJjaGFzZShtc2cuc2VuZGVyLCBiZW5lZmljaWFyeSwgd2VpQW1vdW50LCB0b2tlbnMpOwogIH0KCiAgLyoqCiAgICAgQGRldiBBbGxvd3MgdG8gYWRkIHRoZSBhZGRyZXNzIGFuZCB0aGUgYW1vdW50IG9mIHdlaSBzZW50IGJ5IGEgY29udHJpYnV0b3IKICAgICBpbiB0aGUgcHJpdmF0ZSBwcmVzYWxlLiBDYW4gb25seSBiZSBjYWxsZWQgYnkgdGhlIG93bmVyIGJlZm9yZSB0aGUgYmVnaW5uaW5nCiAgICAgb2YgVEdFCgogICAgIEBwYXJhbSBiZW5lZmljaWFyeSBBZGRyZXNzIHRvIHdoaWNoIExpZiB3aWxsIGJlIHNlbnQKICAgICBAcGFyYW0gd2VpU2VudCBBbW91bnQgb2Ygd2VpIGNvbnRyaWJ1dGVkCiAgICAgQHBhcmFtIHJhdGUgTGlmIHBlciBldGhlciByYXRlIGF0IHRoZSBtb21lbnQgb2YgdGhlIGNvbnRyaWJ1dGlvbgogICAqLwogIGZ1bmN0aW9uIGFkZFByaXZhdGVQcmVzYWxlVG9rZW5zKAogICAgYWRkcmVzcyBiZW5lZmljaWFyeSwgdWludDI1NiB3ZWlTZW50LCB1aW50MjU2IHJhdGUKICApIHB1YmxpYyBvbmx5T3duZXIgewogICAgcmVxdWlyZShibG9jay50aW1lc3RhbXAgPCBzdGFydFRpbWVzdGFtcCk7CiAgICByZXF1aXJlKGJlbmVmaWNpYXJ5ICE9IGFkZHJlc3MoMCkpOwogICAgcmVxdWlyZSh3ZWlTZW50ID4gMCk7CgogICAgLy8gdmFsaWRhdGUgdGhhdCByYXRlIGlzIGhpZ2hlciB0aGFuIFRHRSByYXRlCiAgICByZXF1aXJlKHJhdGUgPiByYXRlMSk7CgogICAgdWludDI1NiB0b2tlbnMgPSB3ZWlTZW50Lm11bChyYXRlKTsKCiAgICB0b3RhbFByZXNhbGVXZWkgPSB0b3RhbFByZXNhbGVXZWkuYWRkKHdlaVNlbnQpOwoKICAgIHRva2VuLm1pbnQoYmVuZWZpY2lhcnksIHRva2Vucyk7CgogICAgVG9rZW5QcmVzYWxlUHVyY2hhc2UoYmVuZWZpY2lhcnksIHdlaVNlbnQsIHJhdGUpOwogIH0KCiAgLyoqCiAgICAgQGRldiBJbnRlcm5hbC4gRm9yd2FyZHMgZnVuZHMgdG8gdGhlIGZvdW5kYXRpb24gd2FsbGV0IGFuZCBpbiBjYXNlIHRoZSBzb2Z0CiAgICAgY2FwIHdhcyBleGNlZWRlZCBpdCBhbHNvIGNyZWF0ZXMgYW5kIGZ1bmRzIHRoZSBNYXJrZXQgVmFsaWRhdGlvbiBNZWNoYW5pc20uCiAgICovCiAgZnVuY3Rpb24gZm9yd2FyZEZ1bmRzKCkgaW50ZXJuYWwgewoKICAgIC8vIGNhbGN1bGF0ZSB0aGUgbWF4IGFtb3VudCBvZiB3ZWkgZm9yIHRoZSBmb3VuZGF0aW9uCiAgICB1aW50MjU2IGZvdW5kYXRpb25CYWxhbmNlQ2FwV2VpID0gbWF4Rm91bmRhdGlvbkNhcFVTRC5tdWwod2VpUGVyVVNEaW5UR0UpOwoKICAgIC8vIGlmIHRoZSBtaW5pbWl1biBjYXAgZm9yIHRoZSBNVk0gaXMgbm90IHJlYWNoZWQgdHJhbnNmZXIgYWxsIGZ1bmRzIHRvIGZvdW5kYXRpb24KICAgIC8vIGVsc2UgaWYgdGhlIG1pbiBjYXAgZm9yIHRoZSBNVk0gaXMgcmVhY2hlZCwgY3JlYXRlIGl0IGFuZCBzZW5kIHRoZSByZW1haW5pbmcgZnVuZHMKICAgIGlmICh3ZWlSYWlzZWQgPD0gZm91bmRhdGlvbkJhbGFuY2VDYXBXZWkpIHsKCiAgICAgIGZvdW5kYXRpb25XYWxsZXQudHJhbnNmZXIodGhpcy5iYWxhbmNlKTsKCiAgICAgIG1pbnRFeHRyYVRva2Vucyh1aW50MjU2KDI0KSk7CgogICAgfSBlbHNlIHsKCiAgICAgIHVpbnQyNTYgbW1GdW5kQmFsYW5jZSA9IHRoaXMuYmFsYW5jZS5zdWIoZm91bmRhdGlvbkJhbGFuY2VDYXBXZWkpOwoKICAgICAgLy8gY2hlY2sgaG93IG11Y2ggcHJlaW9kcyB3ZSBoYXZlIHRvIHVzZSBvbiB0aGUgTVZNCiAgICAgIHVpbnQ4IE1WTVBlcmlvZHMgPSAyNDsKICAgICAgaWYgKG1tRnVuZEJhbGFuY2UgPiBNVk0yNFBlcmlvZHNDYXBVU0QubXVsKHdlaVBlclVTRGluVEdFKSkKICAgICAgICBNVk1QZXJpb2RzID0gNDg7CgogICAgICBmb3VuZGF0aW9uV2FsbGV0LnRyYW5zZmVyKGZvdW5kYXRpb25CYWxhbmNlQ2FwV2VpKTsKCiAgICAgIE1WTSA9IG5ldyBMaWZNYXJrZXRWYWxpZGF0aW9uTWVjaGFuaXNtKAogICAgICAgIGFkZHJlc3ModG9rZW4pLCBibG9jay50aW1lc3RhbXAuYWRkKDM2MDApLCAzNjAwLCBNVk1QZXJpb2RzLCBmb3VuZGF0aW9uV2FsbGV0CiAgICAgICk7CiAgICAgIE1WTS5jYWxjdWxhdGVEaXN0cmlidXRpb25QZXJpb2RzKCk7CgogICAgICBtaW50RXh0cmFUb2tlbnModWludDI1NihNVk1QZXJpb2RzKSk7CgogICAgICBNVk0uZnVuZC52YWx1ZShtbUZ1bmRCYWxhbmNlKSgpOwogICAgICBNVk0udHJhbnNmZXJPd25lcnNoaXAoZm91bmRhdGlvbldhbGxldCk7CgogICAgfQogIH0KCiAgLyoqCiAgICAgQGRldiBJbnRlcm5hbC4gRGlzdHJpYnV0ZSBleHRyYSB0b2tlbnMgYW1vbmcgZm91bmRlcnMsCiAgICAgdGVhbSBhbmQgdGhlIGZvdW5kYXRpb24gbG9uZy10ZXJtIHJlc2VydmUuIEZvdW5kZXJzIHJlY2VpdmUKICAgICAxMi44JSBvZiB0b2tlbnMgaW4gYSA0eSAoMXkgY2xpZmYpIHZlc3Rpbmcgc2NoZWR1bGUuCiAgICAgRm91bmRhdGlvbiBsb25nLXRlcm0gcmVzZXJ2ZSByZWNlaXZlcyA1JSBvZiB0b2tlbnMgaW4gYQogICAgIHZlc3Rpbmcgc2NoZWR1bGUgd2l0aCB0aGUgc2FtZSBkdXJhdGlvbiBhcyB0aGUgTVZNIHRoYXQKICAgICBzdGFydHMgd2hlbiB0aGUgTVZNIGVuZHMuIEFuIGV4dHJhIDcuMiUgaXMgdHJhbnNmZXJyZWQgdG8KICAgICB0aGUgZm91bmRhdGlvbiB0byBiZSBkaXN0cmlidXRlZCBhbW9uZyBhZHZpc29ycyBhbmQgZnV0dXJlIGhpcmVzCiAgICovCiAgZnVuY3Rpb24gbWludEV4dHJhVG9rZW5zKHVpbnQyNTYgZm91bmRhdGlvbk1vbnRoc1N0YXJ0KSBpbnRlcm5hbCB7CiAgICAvLyBjYWxjdWxhdGUgaG93IG11Y2ggdG9rZW5zIHdpbGwgdGhlIGZvdW5kZXJzLAogICAgLy8gZm91bmRhdGlvbiBhbmQgYWR2aXNvcnMgd2lsbCByZWNlaXZlCiAgICB1aW50MjU2IGZvdW5kZXJzVG9rZW5zID0gdG9rZW4udG90YWxTdXBwbHkoKS5tdWwoMTI4KS5kaXYoMTAwMCk7CiAgICB1aW50MjU2IGZvdW5kYXRpb25Ub2tlbnMgPSB0b2tlbi50b3RhbFN1cHBseSgpLm11bCg1MCkuZGl2KDEwMDApOwogICAgdWludDI1NiB0ZWFtVG9rZW5zID0gdG9rZW4udG90YWxTdXBwbHkoKS5tdWwoNzIpLmRpdigxMDAwKTsKCiAgICAvLyBjcmVhdGUgdGhlIHZlc3RlZCBwYXltZW50IHNjaGVkdWxlIGZvciB0aGUgZm91bmRlcnMKICAgIGZvdW5kZXJzVmVzdGVkUGF5bWVudCA9IG5ldyBWZXN0ZWRQYXltZW50KAogICAgICBibG9jay50aW1lc3RhbXAsIDM2MDAsIDQ4LCAxMiwgZm91bmRlcnNUb2tlbnMsIHRva2VuCiAgICApOwogICAgdG9rZW4ubWludChmb3VuZGVyc1Zlc3RlZFBheW1lbnQsIGZvdW5kZXJzVG9rZW5zKTsKICAgIGZvdW5kZXJzVmVzdGVkUGF5bWVudC50cmFuc2Zlck93bmVyc2hpcChmb3VuZGVyc1dhbGxldCk7CgogICAgLy8gY3JlYXRlIHRoZSB2ZXN0ZWQgcGF5bWVudCBzY2hlZHVsZSBmb3IgdGhlIGZvdW5kYXRpb24KICAgIHVpbnQyNTYgZm91bmRhdGlvblBheW1lbnRTdGFydCA9IGZvdW5kYXRpb25Nb250aHNTdGFydC5tdWwoMzYwMCk7CiAgICBmb3VuZGF0aW9uVmVzdGVkUGF5bWVudCA9IG5ldyBWZXN0ZWRQYXltZW50KAogICAgICBibG9jay50aW1lc3RhbXAuYWRkKGZvdW5kYXRpb25QYXltZW50U3RhcnQpLCAzNjAwLAogICAgICBmb3VuZGF0aW9uTW9udGhzU3RhcnQsIDAsIGZvdW5kYXRpb25Ub2tlbnMsIHRva2VuCiAgICApOwogICAgdG9rZW4ubWludChmb3VuZGF0aW9uVmVzdGVkUGF5bWVudCwgZm91bmRhdGlvblRva2Vucyk7CiAgICBmb3VuZGF0aW9uVmVzdGVkUGF5bWVudC50cmFuc2Zlck93bmVyc2hpcChmb3VuZGF0aW9uV2FsbGV0KTsKCiAgICAvLyB0cmFuc2ZlciB0aGUgdG9rZW4gZm9yIGFkdmlzb3JzIGFuZCBmdXR1cmUgZW1wbG95ZWVzIHRvIHRoZSBmb3VuZGF0aW9uCiAgICB0b2tlbi5taW50KGZvdW5kYXRpb25XYWxsZXQsIHRlYW1Ub2tlbnMpOwoKICB9CgogIC8qKgogICAgIEBkZXYgTW9kaWZpZXIKICAgICBvayBpZiB0aGUgdHJhbnNhY3Rpb24gY2FuIGJ1eSB0b2tlbnMgb24gVEdFCiAgICovCiAgbW9kaWZpZXIgdmFsaWRQdXJjaGFzZSgpIHsKICAgIGJvb2wgd2l0aGluUGVyaW9kID0gbm93ID49IHN0YXJ0VGltZXN0YW1wICYmIG5vdyA8PSBlbmQyVGltZXN0YW1wOwogICAgYm9vbCBub25aZXJvUHVyY2hhc2UgPSBtc2cudmFsdWUgIT0gMDsKICAgIGFzc2VydCh3aXRoaW5QZXJpb2QgJiYgbm9uWmVyb1B1cmNoYXNlKTsKCiAgICBfOwogIH0KCiAgLyoqCiAgICAgQGRldiBNb2RpZmllcgogICAgIG9rIHdoZW4gYmxvY2sudGltZXN0YW1wIGlzIHBhc3QgZW5kMlRpbWVzdGFtcAogICovCiAgbW9kaWZpZXIgaGFzRW5kZWQoKSB7CiAgICBhc3NlcnQoYmxvY2sudGltZXN0YW1wID4gZW5kMlRpbWVzdGFtcCk7CiAgICBfOwogIH0KCiAgLyoqCiAgICAgQGRldiBNb2RpZmllcgogICAgIEByZXR1cm4gdHJ1ZSBpZiBtaW5DYXBVU0QgaGFzIGJlZW4gcmVhY2hlZCBieSBjb250cmlidXRpb25zIGR1cmluZyB0aGUgVEdFCiAgKi8KICBmdW5jdGlvbiBmdW5kZWQoKSBwdWJsaWMgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgYXNzZXJ0KHdlaVBlclVTRGluVEdFID4gMCk7CiAgICByZXR1cm4gd2VpUmFpc2VkID49IG1pbkNhcFVTRC5tdWwod2VpUGVyVVNEaW5UR0UpOwogIH0KCiAgLyoqCiAgICAgQGRldiBBbGxvd3MgYSBUR0UgY29udHJpYnV0b3IgdG8gY2xhaW0gdGhlaXIgY29udHJpYnV0ZWQgZXRoIGluIGNhc2UgdGhlCiAgICAgVEdFIGhhcyBmaW5pc2hlZCB3aXRob3V0IHJlYWNoaW5nIHRoZSBtaW5DYXBVU0QKICAgKi8KICBmdW5jdGlvbiBjbGFpbUV0aCgpIHB1YmxpYyBoYXNFbmRlZCB7CiAgICByZXF1aXJlKGlzRmluYWxpemVkKTsKICAgIHJlcXVpcmUoIWZ1bmRlZCgpKTsKCiAgICB1aW50MjU2IHRvUmV0dXJuID0gcHVyY2hhc2VzW21zZy5zZW5kZXJdOwogICAgYXNzZXJ0KHRvUmV0dXJuID4gMCk7CgogICAgcHVyY2hhc2VzW21zZy5zZW5kZXJdID0gMDsKCiAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKHRvUmV0dXJuKTsKICB9CgogIC8qKgogICAgIEBkZXYgRmluYWxpemVzIHRoZSBjcm93ZHNhbGUsIHRha2luZyBjYXJlIG9mIHRyYW5zZmVyIG9mIGZ1bmRzIHRvIHRoZQogICAgIFdpbmRpbmcgVHJlZSBGb3VuZGF0aW9uIGFuZCBjcmVhdGlvbiBhbmQgZnVuZGluZyBvZiB0aGUgTWFya2V0IFZhbGlkYXRpb24KICAgICBNZWNoYW5pc20gaW4gY2FzZSB0aGUgc29mdCBjYXAgd2FzIGV4Y2VlZGVkLiBJdCBhbHNvIHVucGF1c2VzIHRoZSB0b2tlbiB0bwogICAgIGVuYWJsZSB0cmFuc2ZlcnMuIEl0IGNhbiBiZSBjYWxsZWQgb25seSBvbmNlLCBhZnRlciBgZW5kMlRpbWVzdGFtcGAKICAgKi8KICBmdW5jdGlvbiBmaW5hbGl6ZSgpIHB1YmxpYyBoYXNFbmRlZCB7CiAgICByZXF1aXJlKCFpc0ZpbmFsaXplZCk7CgogICAgLy8gZm93YXJkIGZvdW5kcyBhbmQgdW5wYXVzZSB0b2tlbiBvbmx5IGlmIG1pbkNhcCBpcyByZWFjaGVkCiAgICBpZiAoZnVuZGVkKCkpIHsKCiAgICAgIGZvcndhcmRGdW5kcygpOwoKICAgICAgLy8gZmluaXNoIHRoZSBtaW50aW5nIG9mIHRoZSB0b2tlbiBhbmQgdW5wYXVzZSBpdAogICAgICB0b2tlbi5maW5pc2hNaW50aW5nKCk7CiAgICAgIHRva2VuLnVucGF1c2UoKTsKCiAgICAgIC8vIHRyYW5zZmVyIHRoZSBvd25lcnNoaXAgb2YgdGhlIHRva2VuIHRvIHRoZSBmb3VuZGF0aW9uCiAgICAgIHRva2VuLnRyYW5zZmVyT3duZXJzaGlwKG93bmVyKTsKCiAgICB9CgogICAgRmluYWxpemVkKCk7CiAgICBpc0ZpbmFsaXplZCA9IHRydWU7CiAgfQoKfQ=='.
	

]
