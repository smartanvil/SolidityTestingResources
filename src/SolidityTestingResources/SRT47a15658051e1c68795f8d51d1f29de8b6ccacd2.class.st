Class {
	#name : #SRT47a15658051e1c68795f8d51d1f29de8b6ccacd2,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT47a15658051e1c68795f8d51d1f29de8b6ccacd2 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTk7CgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBFdGhlcm5hdXRzCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gdGFrZU93bmVyc2hpcCh1aW50MjU2IF90b2tlbklkKSBwdWJsaWM7CiAgICBmdW5jdGlvbiBpbXBsZW1lbnRzRVJDNzIxKCkgcHVibGljIHB1cmUgcmV0dXJucyAoYm9vbCk7CgogICAgLy8gRXZlbnRzCiAgICBldmVudCBUcmFuc2ZlcihhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQyNTYgdG9rZW5JZCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIGFwcHJvdmVkLCB1aW50MjU2IHRva2VuSWQpOwoKICAgIC8vIE9wdGlvbmFsCiAgICAvLyBmdW5jdGlvbiBuYW1lKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIG5hbWUpOwogICAgLy8gZnVuY3Rpb24gc3ltYm9sKCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIHN5bWJvbCk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQyNTZbXSB0b2tlbklkcyk7CiAgICAvLyBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBwdWJsaWMgdmlldyByZXR1cm5zIChzdHJpbmcgaW5mb1VybCk7CgogICAgLy8gRVJDLTE2NSBDb21wYXRpYmlsaXR5IChodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvMTY1KQogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKTsKfQoKLy8gRXh0ZW5kIHRoaXMgbGlicmFyeSBmb3IgY2hpbGQgY29udHJhY3RzCmxpYnJhcnkgU2FmZU1hdGggewoKICAgIC8qKgogICAgKiBAZGV2IE11bHRpcGxpZXMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBtdWwodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIGlmIChhID09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHVpbnQyNTYgYyA9IGEgKiBiOwogICAgICAgIGFzc2VydChjIC8gYSA9PSBiKTsKICAgICAgICByZXR1cm4gYzsKICAgIH0KCiAgICAvKioKICAgICogQGRldiBJbnRlZ2VyIGRpdmlzaW9uIG9mIHR3byBudW1iZXJzLCB0cnVuY2F0aW5nIHRoZSBxdW90aWVudC4KICAgICovCiAgICBmdW5jdGlvbiBkaXYodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIGFzc2VydChiID4gMCk7IC8vIFNvbGlkaXR5IGF1dG9tYXRpY2FsbHkgdGhyb3dzIHdoZW4gZGl2aWRpbmcgYnkgMAogICAgICAgIHVpbnQyNTYgYyA9IGEgLyBiOwogICAgICAgIC8vIGFzc2VydChhID09IGIgKiBjICsgYSAlIGIpOyAvLyBUaGVyZSBpcyBubyBjYXNlIGluIHdoaWNoIHRoaXMgZG9lc24ndCBob2xkCiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAgLyoqCiAgICAqIEBkZXYgU3Vic3RyYWN0cyB0d28gbnVtYmVycywgdGhyb3dzIG9uIG92ZXJmbG93IChpLmUuIGlmIHN1YnRyYWhlbmQgaXMgZ3JlYXRlciB0aGFuIG1pbnVlbmQpLgogICAgKi8KICAgIGZ1bmN0aW9uIHN1Yih1aW50MjU2IGEsIHVpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgYXNzZXJ0KGIgPD0gYSk7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IEFkZHMgdHdvIG51bWJlcnMsIHRocm93cyBvbiBvdmVyZmxvdy4KICAgICovCiAgICBmdW5jdGlvbiBhZGQodWludDI1NiBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHVpbnQyNTYgYyA9IGEgKyBiOwogICAgICAgIGFzc2VydChjID49IGEpOwogICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENvbXBhcmEgdHdvIG51bWJlcnMsIGFuZCByZXR1cm4gdGhlIGJpZ2dlciBvbmUuCiAgICAqLwogICAgZnVuY3Rpb24gbWF4KGludDI1NiBhLCBpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpZiAoYSA+IGIpIHsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBAZGV2IENvbXBhcmEgdHdvIG51bWJlcnMsIGFuZCByZXR1cm4gdGhlIGJpZ2dlciBvbmUuCiAgICAqLwogICAgZnVuY3Rpb24gbWluKGludDI1NiBhLCBpbnQyNTYgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpZiAoYSA8IGIpIHsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfQogICAgfQoKCn0KCi8vLyBAZGV2IEJhc2UgY29udHJhY3QgZm9yIGFsbCBFdGhlcm5hdXRzIGNvbnRyYWN0cyBob2xkaW5nIGdsb2JhbCBjb25zdGFudHMgYW5kIGZ1bmN0aW9ucy4KY29udHJhY3QgRXRoZXJuYXV0c0Jhc2UgewoKICAgIC8qKiogQ09OU1RBTlRTIFVTRUQgQUNST1NTIENPTlRSQUNUUyAqKiovCgogICAgLy8vIEBkZXYgVXNlZCBieSBhbGwgY29udHJhY3RzIHRoYXQgaW50ZXJmYWNlcyB3aXRoIEV0aGVybmF1dHMKICAgIC8vLyAgICAgIFRoZSBFUkMtMTY1IGludGVyZmFjZSBzaWduYXR1cmUgZm9yIEVSQy03MjEuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NQogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy83MjEKICAgIGJ5dGVzNCBjb25zdGFudCBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxID0KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ25hbWUoKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b3RhbFN1cHBseSgpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2JhbGFuY2VPZihhZGRyZXNzKScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ2FwcHJvdmUoYWRkcmVzcyx1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0cmFuc2ZlcihhZGRyZXNzLHVpbnQyNTYpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgYnl0ZXM0KGtlY2NhazI1NigndGFrZU93bmVyc2hpcCh1aW50MjU2KScpKSBeCiAgICBieXRlczQoa2VjY2FrMjU2KCd0b2tlbnNPZk93bmVyKGFkZHJlc3MpJykpIF4KICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpJykpOwoKICAgIC8vLyBAZGV2IGR1ZSBzb2xpZGl0eSBsaW1pdGF0aW9uIHdlIGNhbm5vdCByZXR1cm4gZHluYW1pYyBhcnJheSBmcm9tIG1ldGhvZHMKICAgIC8vLyBzbyBpdCBjcmVhdGVzIGluY29tcGFiaWxpdHkgYmV0d2VlbiBmdW5jdGlvbnMgYWNyb3NzIGRpZmZlcmVudCBjb250cmFjdHMKICAgIHVpbnQ4IHB1YmxpYyBjb25zdGFudCBTVEFUU19TSVpFID0gMTA7CiAgICB1aW50OCBwdWJsaWMgY29uc3RhbnQgU0hJUF9TTE9UUyA9IDU7CgogICAgLy8gUG9zc2libGUgc3RhdGUgb2YgYW55IGFzc2V0CiAgICBlbnVtIEFzc2V0U3RhdGUgeyBBdmFpbGFibGUsIFVwRm9yTGVhc2UsIFVzZWQgfQoKICAgIC8vIFBvc3NpYmxlIHN0YXRlIG9mIGFueSBhc3NldAogICAgLy8gTm90VmFsaWQgaXMgdG8gYXZvaWQgMCBpbiBwbGFjZXMgd2hlcmUgY2F0ZWdvcnkgbXVzdCBiZSBiaWdnZXIgdGhhbiB6ZXJvCiAgICBlbnVtIEFzc2V0Q2F0ZWdvcnkgeyBOb3RWYWxpZCwgU2VjdG9yLCBNYW51ZmFjdHVyZXIsIFNoaXAsIE9iamVjdCwgRmFjdG9yeSwgQ3Jld01lbWJlciB9CgogICAgLy8vIEBkZXYgU2VjdG9yIHN0YXRzCiAgICBlbnVtIFNoaXBTdGF0cyB7TGV2ZWwsIEF0dGFjaywgRGVmZW5zZSwgU3BlZWQsIFJhbmdlLCBMdWNrfQogICAgLy8vIEBub3RpY2UgUG9zc2libGUgYXR0cmlidXRlcyBmb3IgZWFjaCBhc3NldAogICAgLy8vIDAwMDAwMDAxIC0gU2VlZGVkIC0gT2ZmZXJlZCB0byB0aGUgZWNvbm9teSBieSB1cywgdGhlIGRldmVsb3BlcnMuIFBvdGVudGlhbGx5IGF0IHJlZ3VsYXIgaW50ZXJ2YWxzLgogICAgLy8vIDAwMDAwMDEwIC0gUHJvZHVjaWJsZSAtIFByb2R1Y3Qgb2YgYSBmYWN0b3J5IGFuZC9vciBmYWN0b3J5IGNvbnRyYWN0LgogICAgLy8vIDAwMDAwMTAwIC0gRXhwbG9yYWJsZS0gUHJvZHVjdCBvZiBleHBsb3JhdGlvbi4KICAgIC8vLyAwMDAwMTAwMCAtIExlYXNhYmxlIC0gQ2FuIGJlIHJlbnRlZCB0byBvdGhlciB1c2VycyBhbmQgd2lsbCByZXR1cm4gdG8gdGhlIG9yaWdpbmFsIG93bmVyIG9uY2UgdGhlIGFjdGlvbiBpcyBjb21wbGV0ZS4KICAgIC8vLyAwMDAxMDAwMCAtIFBlcm1hbmVudCAtIENhbm5vdCBiZSByZW1vdmVkLCBhbHdheXMgb3duZWQgYnkgYSB1c2VyLgogICAgLy8vIDAwMTAwMDAwIC0gQ29uc3VtYWJsZSAtIERlc3Ryb3llZCBhZnRlciBOIGV4cGxvcmF0aW9uIGV4cGVkaXRpb25zLgogICAgLy8vIDAxMDAwMDAwIC0gVHJhZGFibGUgLSBCdXlhYmxlIGFuZCBzZWxsYWJsZSBvbiB0aGUgbWFya2V0LgogICAgLy8vIDEwMDAwMDAwIC0gSG90IFBvdGF0byAtIEF1dG9tYXRpY2FsbHkgZ2V0cyBwdXQgdXAgZm9yIHNhbGUgYWZ0ZXIgYWNxdWlyaW5nLgogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX1NFRURFRCAgICAgPSBieXRlczIoMioqMCk7CiAgICBieXRlczIgcHVibGljIEFUVFJfUFJPRFVDSUJMRSA9IGJ5dGVzMigyKioxKTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9FWFBMT1JBQkxFID0gYnl0ZXMyKDIqKjIpOwogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX0xFQVNBQkxFICAgPSBieXRlczIoMioqMyk7CiAgICBieXRlczIgcHVibGljIEFUVFJfUEVSTUFORU5UICA9IGJ5dGVzMigyKio0KTsKICAgIGJ5dGVzMiBwdWJsaWMgQVRUUl9DT05TVU1BQkxFID0gYnl0ZXMyKDIqKjUpOwogICAgYnl0ZXMyIHB1YmxpYyBBVFRSX1RSQURBQkxFICAgPSBieXRlczIoMioqNik7CiAgICBieXRlczIgcHVibGljIEFUVFJfR09MREVOR09PU0UgPSBieXRlczIoMioqNyk7Cn0KCgovLy8gQG5vdGljZSBUaGlzIGNvbnRyYWN0IG1hbmFnZXMgdGhlIHZhcmlvdXMgYWRkcmVzc2VzIGFuZCBjb25zdHJhaW50cyBmb3Igb3BlcmF0aW9ucwovLyAgICAgICAgICB0aGF0IGNhbiBiZSBleGVjdXRlZCBvbmx5IGJ5IHNwZWNpZmljIHJvbGVzLiBOYW1lbHkgQ0VPIGFuZCBDVE8uIGl0IGFsc28gaW5jbHVkZXMgcGF1c2FibGUgcGF0dGVybi4KY29udHJhY3QgRXRoZXJuYXV0c0FjY2Vzc0NvbnRyb2wgaXMgRXRoZXJuYXV0c0Jhc2UgewoKICAgIC8vIFRoaXMgZmFjZXQgY29udHJvbHMgYWNjZXNzIGNvbnRyb2wgZm9yIEV0aGVybmF1dHMuCiAgICAvLyBBbGwgcm9sZXMgaGF2ZSBzYW1lIHJlc3BvbnNpYmlsaXRpZXMgYW5kIHJpZ2h0cywgYnV0IHRoZXJlIGlzIHNsaWdodCBkaWZmZXJlbmNlcyBiZXR3ZWVuIHRoZW06CiAgICAvLwogICAgLy8gICAgIC0gVGhlIENFTzogVGhlIENFTyBjYW4gcmVhc3NpZ24gb3RoZXIgcm9sZXMgYW5kIG9ubHkgcm9sZSB0aGF0IGNhbiB1bnBhdXNlIHRoZSBzbWFydCBjb250cmFjdC4KICAgIC8vICAgICAgIEl0IGlzIGluaXRpYWxseSBzZXQgdG8gdGhlIGFkZHJlc3MgdGhhdCBjcmVhdGVkIHRoZSBzbWFydCBjb250cmFjdC4KICAgIC8vCiAgICAvLyAgICAgLSBUaGUgQ1RPOiBUaGUgQ1RPIGNhbiBjaGFuZ2UgY29udHJhY3QgYWRkcmVzcywgb3JhY2xlIGFkZHJlc3MgYW5kIHBsYW4gZm9yIHVwZ3JhZGVzLgogICAgLy8KICAgIC8vICAgICAtIFRoZSBDT086IFRoZSBDT08gY2FuIGNoYW5nZSBjb250cmFjdCBhZGRyZXNzIGFuZCBhZGQgY3JlYXRlIGFzc2V0cy4KICAgIC8vCiAgICAvLy8gQGRldiBFbWl0ZWQgd2hlbiBjb250cmFjdCBpcyB1cGdyYWRlZCAtIFNlZSBSRUFETUUubWQgZm9yIHVwZGdyYWRlIHBsYW4KICAgIC8vLyBAcGFyYW0gbmV3Q29udHJhY3QgYWRkcmVzcyBwb2ludGluZyB0byBuZXcgY29udHJhY3QKICAgIGV2ZW50IENvbnRyYWN0VXBncmFkZShhZGRyZXNzIG5ld0NvbnRyYWN0KTsKCiAgICAvLyBUaGUgYWRkcmVzc2VzIG9mIHRoZSBhY2NvdW50cyAob3IgY29udHJhY3RzKSB0aGF0IGNhbiBleGVjdXRlIGFjdGlvbnMgd2l0aGluIGVhY2ggcm9sZXMuCiAgICBhZGRyZXNzIHB1YmxpYyBjZW9BZGRyZXNzOwogICAgYWRkcmVzcyBwdWJsaWMgY3RvQWRkcmVzczsKICAgIGFkZHJlc3MgcHVibGljIGNvb0FkZHJlc3M7CiAgICBhZGRyZXNzIHB1YmxpYyBvcmFjbGVBZGRyZXNzOwoKICAgIC8vIEBkZXYgS2VlcHMgdHJhY2sgd2hldGhlciB0aGUgY29udHJhY3QgaXMgcGF1c2VkLiBXaGVuIHRoYXQgaXMgdHJ1ZSwgbW9zdCBhY3Rpb25zIGFyZSBibG9ja2VkCiAgICBib29sIHB1YmxpYyBwYXVzZWQgPSBmYWxzZTsKCiAgICAvLy8gQGRldiBBY2Nlc3MgbW9kaWZpZXIgZm9yIENFTy1vbmx5IGZ1bmN0aW9uYWxpdHkKICAgIG1vZGlmaWVyIG9ubHlDRU8oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGNlb0FkZHJlc3MpOwogICAgICAgIF87CiAgICB9CgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDVE8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5Q1RPKCkgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBjdG9BZGRyZXNzKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFjY2VzcyBtb2RpZmllciBmb3IgQ1RPLW9ubHkgZnVuY3Rpb25hbGl0eQogICAgbW9kaWZpZXIgb25seU9yYWNsZSgpIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gb3JhY2xlQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5Q0xldmVsKCkgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGN0b0FkZHJlc3MgfHwKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjb29BZGRyZXNzCiAgICAgICAgKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENFTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q0VPIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ0VPCiAgICBmdW5jdGlvbiBzZXRDRU8oYWRkcmVzcyBfbmV3Q0VPKSBleHRlcm5hbCBvbmx5Q0VPIHsKICAgICAgICByZXF1aXJlKF9uZXdDRU8gIT0gYWRkcmVzcygwKSk7CgogICAgICAgIGNlb0FkZHJlc3MgPSBfbmV3Q0VPOwogICAgfQoKICAgIC8vLyBAZGV2IEFzc2lnbnMgYSBuZXcgYWRkcmVzcyB0byBhY3QgYXMgdGhlIENUTy4gT25seSBhdmFpbGFibGUgdG8gdGhlIGN1cnJlbnQgQ1RPIG9yIENFTy4KICAgIC8vLyBAcGFyYW0gX25ld0NUTyBUaGUgYWRkcmVzcyBvZiB0aGUgbmV3IENUTwogICAgZnVuY3Rpb24gc2V0Q1RPKGFkZHJlc3MgX25ld0NUTykgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY2VvQWRkcmVzcyB8fAogICAgICAgICAgICBtc2cuc2VuZGVyID09IGN0b0FkZHJlc3MKICAgICAgICApOwogICAgICAgIHJlcXVpcmUoX25ld0NUTyAhPSBhZGRyZXNzKDApKTsKCiAgICAgICAgY3RvQWRkcmVzcyA9IF9uZXdDVE87CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBhIG5ldyBhZGRyZXNzIHRvIGFjdCBhcyB0aGUgQ09PLiBPbmx5IGF2YWlsYWJsZSB0byB0aGUgY3VycmVudCBDT08gb3IgQ0VPLgogICAgLy8vIEBwYXJhbSBfbmV3Q09PIFRoZSBhZGRyZXNzIG9mIHRoZSBuZXcgQ09PCiAgICBmdW5jdGlvbiBzZXRDT08oYWRkcmVzcyBfbmV3Q09PKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgbXNnLnNlbmRlciA9PSBjZW9BZGRyZXNzIHx8CiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY29vQWRkcmVzcwogICAgICAgICk7CiAgICAgICAgcmVxdWlyZShfbmV3Q09PICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBjb29BZGRyZXNzID0gX25ld0NPTzsKICAgIH0KCiAgICAvLy8gQGRldiBBc3NpZ25zIGEgbmV3IGFkZHJlc3MgdG8gYWN0IGFzIG9yYWNsZS4KICAgIC8vLyBAcGFyYW0gX25ld09yYWNsZSBUaGUgYWRkcmVzcyBvZiBvcmFjbGUKICAgIGZ1bmN0aW9uIHNldE9yYWNsZShhZGRyZXNzIF9uZXdPcmFjbGUpIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gY3RvQWRkcmVzcyk7CiAgICAgICAgcmVxdWlyZShfbmV3T3JhY2xlICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICBvcmFjbGVBZGRyZXNzID0gX25ld09yYWNsZTsKICAgIH0KCiAgICAvKioqIFBhdXNhYmxlIGZ1bmN0aW9uYWxpdHkgYWRhcHRlZCBmcm9tIE9wZW5aZXBwZWxpbiAqKiovCgogICAgLy8vIEBkZXYgTW9kaWZpZXIgdG8gYWxsb3cgYWN0aW9ucyBvbmx5IHdoZW4gdGhlIGNvbnRyYWN0IElTIE5PVCBwYXVzZWQKICAgIG1vZGlmaWVyIHdoZW5Ob3RQYXVzZWQoKSB7CiAgICAgICAgcmVxdWlyZSghcGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IE1vZGlmaWVyIHRvIGFsbG93IGFjdGlvbnMgb25seSB3aGVuIHRoZSBjb250cmFjdCBJUyBwYXVzZWQKICAgIG1vZGlmaWVyIHdoZW5QYXVzZWQgewogICAgICAgIHJlcXVpcmUocGF1c2VkKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBAZGV2IENhbGxlZCBieSBhbnkgIkMtbGV2ZWwiIHJvbGUgdG8gcGF1c2UgdGhlIGNvbnRyYWN0LiBVc2VkIG9ubHkgd2hlbgogICAgLy8vICBhIGJ1ZyBvciBleHBsb2l0IGlzIGRldGVjdGVkIGFuZCB3ZSBuZWVkIHRvIGxpbWl0IGRhbWFnZS4KICAgIGZ1bmN0aW9uIHBhdXNlKCkgZXh0ZXJuYWwgb25seUNMZXZlbCB3aGVuTm90UGF1c2VkIHsKICAgICAgICBwYXVzZWQgPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IFVucGF1c2VzIHRoZSBzbWFydCBjb250cmFjdC4gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBDRU8sIHNpbmNlCiAgICAvLy8gIG9uZSByZWFzb24gd2UgbWF5IHBhdXNlIHRoZSBjb250cmFjdCBpcyB3aGVuIENUTyBhY2NvdW50IGlzIGNvbXByb21pc2VkLgogICAgLy8vIEBub3RpY2UgVGhpcyBpcyBwdWJsaWMgcmF0aGVyIHRoYW4gZXh0ZXJuYWwgc28gaXQgY2FuIGJlIGNhbGxlZCBieQogICAgLy8vICBkZXJpdmVkIGNvbnRyYWN0cy4KICAgIGZ1bmN0aW9uIHVucGF1c2UoKSBwdWJsaWMgb25seUNFTyB3aGVuUGF1c2VkIHsKICAgICAgICAvLyBjYW4ndCB1bnBhdXNlIGlmIGNvbnRyYWN0IHdhcyB1cGdyYWRlZAogICAgICAgIHBhdXNlZCA9IGZhbHNlOwogICAgfQoKfQoKCi8vLyBAdGl0bGUgVGhlIGZhY2V0IG9mIHRoZSBFdGhlcm5hdXRzIGNvbnRyYWN0IHRoYXQgbWFuYWdlcyBvd25lcnNoaXAsIEVSQy03MjEgY29tcGxpYW50LgovLy8gQG5vdGljZSBUaGlzIHByb3ZpZGVzIHRoZSBtZXRob2RzIHJlcXVpcmVkIGZvciBiYXNpYyBub24tZnVuZ2libGUgdG9rZW4KLy8gICAgICAgICAgdHJhbnNhY3Rpb25zLCBmb2xsb3dpbmcgdGhlIGRyYWZ0IEVSQy03MjEgc3BlYyAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkuCi8vICAgICAgICAgIEl0IGludGVyZmFjZXMgd2l0aCBFdGhlcm5hdXRzU3RvcmFnZSBwcm92aW5kaW5nIGJhc2ljIGZ1bmN0aW9ucyBhcyBjcmVhdGUgYW5kIGxpc3QsIGFsc28gaG9sZHMKLy8gICAgICAgICAgcmVmZXJlbmNlIHRvIGxvZ2ljIGNvbnRyYWN0cyBhcyBBdWN0aW9uLCBFeHBsb3JlIGFuZCBzbyBvbgovLy8gQGF1dGhvciBFdGhlcm5hdHVzIC0gRmVybmFuZG8gUGF1ZXIKLy8vIEBkZXYgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCmNvbnRyYWN0IEV0aGVybmF1dHNPd25lcnNoaXAgaXMgRXRoZXJuYXV0c0FjY2Vzc0NvbnRyb2wsIEVSQzcyMSB7CgogICAgLy8vIEBkZXYgQ29udHJhY3QgaG9sZGluZyBvbmx5IGRhdGEuCiAgICBFdGhlcm5hdXRzU3RvcmFnZSBwdWJsaWMgZXRoZXJuYXV0c1N0b3JhZ2U7CgogICAgLyoqKiBDT05TVEFOVFMgKioqLwogICAgLy8vIEBub3RpY2UgTmFtZSBhbmQgc3ltYm9sIG9mIHRoZSBub24gZnVuZ2libGUgdG9rZW4sIGFzIGRlZmluZWQgaW4gRVJDNzIxLgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkV0aGVybmF1dHMiOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiRVROVCI7CgogICAgLyoqKioqKioqKiBFUkMgNzIxIC0gQ09NUExJQU5DRSBDT05TVEFOVFMgQU5EIEZVTkNUSU9OUyAqKioqKioqKioqKioqKiovCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9IGJ5dGVzNChrZWNjYWsyNTYoJ3N1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCknKSk7CgogICAgLyoqKiBFVkVOVFMgKioqLwoKICAgIC8vIEV2ZW50cyBhcyBwZXIgRVJDLTcyMQogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBpbmRleGVkIGZyb20sIGFkZHJlc3MgaW5kZXhlZCB0bywgdWludDI1NiB0b2tlbnMpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgYXBwcm92ZWQsIHVpbnQyNTYgdG9rZW5zKTsKCiAgICAvLy8gQGRldiBXaGVuIGEgbmV3IGFzc2V0IGlzIGNyZWF0ZSBpdCBlbWl0cyBidWlsZCBldmVudAogICAgLy8vIEBwYXJhbSBvd25lciBUaGUgYWRkcmVzcyBvZiBhc3NldCBvd25lcgogICAgLy8vIEBwYXJhbSB0b2tlbklkIEFzc2V0IFVuaXF1ZUlECiAgICAvLy8gQHBhcmFtIGFzc2V0SWQgSUQgdGhhdCBkZWZpbmVzIGFzc2V0IGxvb2sgYW5kIGZlZWwKICAgIC8vLyBAcGFyYW0gcHJpY2UgYXNzZXQgcHJpY2UKICAgIGV2ZW50IEJ1aWxkKGFkZHJlc3Mgb3duZXIsIHVpbnQyNTYgdG9rZW5JZCwgdWludDE2IGFzc2V0SWQsIHVpbnQyNTYgcHJpY2UpOwoKICAgIGZ1bmN0aW9uIGltcGxlbWVudHNFUkM3MjEoKSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgSW50cm9zcGVjdGlvbiBpbnRlcmZhY2UgYXMgcGVyIEVSQy0xNjUgKGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUpLgogICAgLy8vICBSZXR1cm5zIHRydWUgZm9yIGFueSBzdGFuZGFyZGl6ZWQgaW50ZXJmYWNlcyBpbXBsZW1lbnRlZCBieSB0aGlzIGNvbnRyYWN0LiBFUkMtMTY1IGFuZCBFUkMtNzIxLgogICAgLy8vIEBwYXJhbSBfaW50ZXJmYWNlSUQgaW50ZXJmYWNlIHNpZ25hdHVyZSBJRAogICAgZnVuY3Rpb24gc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0IF9pbnRlcmZhY2VJRCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChib29sKQogICAgewogICAgICAgIHJldHVybiAoKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDMTY1KSB8fCAoX2ludGVyZmFjZUlEID09IEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEpKTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGlzIHRoZSBjdXJyZW50IG93bmVyIG9mIGEgcGFydGljdWxhciBBc3NldC4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IHRoZSBhZGRyZXNzIHdlIGFyZSB2YWxpZGF0aW5nIGFnYWluc3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkLCBvbmx5IHZhbGlkIHdoZW4gPiAwCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGV0aGVybmF1dHNTdG9yYWdlLm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIEFzc2V0LgogICAgLy8vIEBwYXJhbSBfY2xhaW1hbnQgdGhlIGFkZHJlc3Mgd2UgYXJlIGNvbmZpcm1pbmcgYXNzZXQgaXMgYXBwcm92ZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZCwgb25seSB2YWxpZCB3aGVuID4gMAogICAgZnVuY3Rpb24gX2FwcHJvdmVkRm9yKGFkZHJlc3MgX2NsYWltYW50LCB1aW50MjU2IF90b2tlbklkKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gZXRoZXJuYXV0c1N0b3JhZ2UuYXBwcm92ZWRGb3IoX3Rva2VuSWQpID09IF9jbGFpbWFudDsKICAgIH0KCiAgICAvLy8gQGRldiBNYXJrcyBhbiBhZGRyZXNzIGFzIGJlaW5nIGFwcHJvdmVkIGZvciB0cmFuc2ZlckZyb20oKSwgb3ZlcndyaXRpbmcgYW55IHByZXZpb3VzCiAgICAvLy8gIGFwcHJvdmFsLiBTZXR0aW5nIF9hcHByb3ZlZCB0byBhZGRyZXNzKDApIGNsZWFycyBhbGwgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAvLy8gIE5PVEU6IF9hcHByb3ZlKCkgZG9lcyBOT1Qgc2VuZCB0aGUgQXBwcm92YWwgZXZlbnQuIFRoaXMgaXMgaW50ZW50aW9uYWwgYmVjYXVzZQogICAgLy8vICBfYXBwcm92ZSgpIGFuZCB0cmFuc2ZlckZyb20oKSBhcmUgdXNlZCB0b2dldGhlciBmb3IgcHV0dGluZyBBc3NldHMgb24gYXVjdGlvbiwgYW5kCiAgICAvLy8gIHRoZXJlIGlzIG5vIHZhbHVlIGluIHNwYW1taW5nIHRoZSBsb2cgd2l0aCBBcHByb3ZhbCBldmVudHMgaW4gdGhhdCBjYXNlLgogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfYXBwcm92ZWQpIGludGVybmFsIHsKICAgICAgICBldGhlcm5hdXRzU3RvcmFnZS5hcHByb3ZlKF90b2tlbklkLCBfYXBwcm92ZWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgdGhlIG51bWJlciBvZiBBc3NldHMgb3duZWQgYnkgYSBzcGVjaWZpYyBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfb3duZXIgVGhlIG93bmVyIGFkZHJlc3MgdG8gY2hlY2suCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgY291bnQpIHsKICAgICAgICByZXR1cm4gZXRoZXJuYXV0c1N0b3JhZ2UuYmFsYW5jZU9mKF9vd25lcik7CiAgICB9CgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIC8vLyBAbm90aWNlIFRyYW5zZmVycyBhIEFzc2V0IHRvIGFub3RoZXIgYWRkcmVzcy4gSWYgdHJhbnNmZXJyaW5nIHRvIGEgc21hcnQKICAgIC8vLyAgY29udHJhY3QgYmUgVkVSWSBDQVJFRlVMIHRvIGVuc3VyZSB0aGF0IGl0IGlzIGF3YXJlIG9mIEVSQy03MjEgKG9yCiAgICAvLy8gIEV0aGVybmF1dHMgc3BlY2lmaWNhbGx5KSBvciB5b3VyIEFzc2V0IG1heSBiZSBsb3N0IGZvcmV2ZXIuIFNlcmlvdXNseS4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIG9mIHRoZSByZWNpcGllbnQsIGNhbiBiZSBhIHVzZXIgb3IgY29udHJhY3QuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgQXNzZXQgdG8gdHJhbnNmZXIuCiAgICBmdW5jdGlvbiB0cmFuc2ZlcigKICAgICAgICBhZGRyZXNzIF90bywKICAgICAgICB1aW50MjU2IF90b2tlbklkCiAgICApCiAgICBleHRlcm5hbAogICAgd2hlbk5vdFBhdXNlZAogICAgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBhc3NldHMKICAgICAgICAvLyAoZXhjZXB0IHZlcnkgYnJpZWZseSBhZnRlciBpdCBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhlIHN0b3JhZ2UgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsCiAgICAgICAgLy8gbWlzdXNlLiBBdWN0aW9uIG9yIFVwZ3JhZGUgY29udHJhY3RzIHNob3VsZCBvbmx5IHRha2Ugb3duZXJzaGlwIG9mIGFzc2V0cwogICAgICAgIC8vIHRocm91Z2ggdGhlIGFsbG93ICsgdHJhbnNmZXJGcm9tIGZsb3cuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcyhldGhlcm5hdXRzU3RvcmFnZSkpOwoKICAgICAgICAvLyBZb3UgY2FuIG9ubHkgc2VuZCB5b3VyIG93biBhc3NldC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCwgY2xlYXIgcGVuZGluZyBhcHByb3ZhbHMsIGVtaXQgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgZXRoZXJuYXV0c1N0b3JhZ2UudHJhbnNmZXIobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIC8vLyBAbm90aWNlIEdyYW50IGFub3RoZXIgYWRkcmVzcyB0aGUgcmlnaHQgdG8gdHJhbnNmZXIgYSBzcGVjaWZpYyBBc3NldCB2aWEKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIFRoaXMgaXMgdGhlIHByZWZlcnJlZCBmbG93IGZvciB0cmFuc2ZlcmluZyBORlRzIHRvIGNvbnRyYWN0cy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGJlIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwuIFBhc3MgYWRkcmVzcygwKSB0bwogICAgLy8vICBjbGVhciBhbGwgYXBwcm92YWxzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIEFzc2V0IHRoYXQgY2FuIGJlIHRyYW5zZmVycmVkIGlmIHRoaXMgY2FsbCBzdWNjZWVkcy4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoCiAgICAgICAgYWRkcmVzcyBfdG8sCiAgICAgICAgdWludDI1NiBfdG9rZW5JZAogICAgKQogICAgZXh0ZXJuYWwKICAgIHdoZW5Ob3RQYXVzZWQKICAgIHsKICAgICAgICAvLyBPbmx5IGFuIG93bmVyIGNhbiBncmFudCB0cmFuc2ZlciBhcHByb3ZhbC4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlZ2lzdGVyIHRoZSBhcHByb3ZhbCAocmVwbGFjaW5nIGFueSBwcmV2aW91cyBhcHByb3ZhbCkuCiAgICAgICAgX2FwcHJvdmUoX3Rva2VuSWQsIF90byk7CgogICAgICAgIC8vIEVtaXQgYXBwcm92YWwgZXZlbnQuCiAgICAgICAgQXBwcm92YWwobXNnLnNlbmRlciwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgQXNzZXQgb3duZWQgYnkgYW5vdGhlciBhZGRyZXNzLCBmb3Igd2hpY2ggdGhlIGNhbGxpbmcgYWRkcmVzcwogICAgLy8vICBoYXMgcHJldmlvdXNseSBiZWVuIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwgYnkgdGhlIG93bmVyLgogICAgLy8vIEBwYXJhbSBfZnJvbSBUaGUgYWRkcmVzcyB0aGF0IG93bnMgdGhlIEFzc2V0IHRvIGJlIHRyYW5zZmVycmVkLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCBzaG91bGQgdGFrZSBvd25lcnNoaXAgb2YgdGhlIEFzc2V0LiBDYW4gYmUgYW55IGFkZHJlc3MsCiAgICAvLy8gIGluY2x1ZGluZyB0aGUgY2FsbGVyLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIEFzc2V0IHRvIGJlIHRyYW5zZmVycmVkLgogICAgZnVuY3Rpb24gX3RyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgIGludGVybmFsCiAgICB7CiAgICAgICAgLy8gU2FmZXR5IGNoZWNrIHRvIHByZXZlbnQgYWdhaW5zdCBhbiB1bmV4cGVjdGVkIDB4MCBkZWZhdWx0LgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3MoMCkpOwogICAgICAgIC8vIERpc2FsbG93IHRyYW5zZmVycyB0byB0aGlzIGNvbnRyYWN0IHRvIHByZXZlbnQgYWNjaWRlbnRhbCBtaXN1c2UuCiAgICAgICAgLy8gVGhlIGNvbnRyYWN0IHNob3VsZCBuZXZlciBvd24gYW55IGFzc2V0cyAoZXhjZXB0IGZvciB1c2VkIGFzc2V0cykuCiAgICAgICAgcmVxdWlyZShfb3ducyhfZnJvbSwgX3Rva2VuSWQpKTsKICAgICAgICAvLyBDaGVjayBmb3IgYXBwcm92YWwgYW5kIHZhbGlkIG93bmVyc2hpcAogICAgICAgIHJlcXVpcmUoX2FwcHJvdmVkRm9yKF90bywgX3Rva2VuSWQpKTsKCiAgICAgICAgLy8gUmVhc3NpZ24gb3duZXJzaGlwIChhbHNvIGNsZWFycyBwZW5kaW5nIGFwcHJvdmFscyBhbmQgZW1pdHMgVHJhbnNmZXIgZXZlbnQpLgogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlLnRyYW5zZmVyKF9mcm9tLCBfdG8sIF90b2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlLgogICAgLy8vIEBub3RpY2UgVHJhbnNmZXIgYSBBc3NldCBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUgY2FsbGluZyBhZGRyZXNzCiAgICAvLy8gIGhhcyBwcmV2aW91c2x5IGJlZW4gZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbCBieSB0aGUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGUgQXNzZXQgdG8gYmUgdHJhbnNmZXJlZC4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRoYXQgc2hvdWxkIHRha2Ugb3duZXJzaGlwIG9mIHRoZSBBc3NldC4gQ2FuIGJlIGFueSBhZGRyZXNzLAogICAgLy8vICBpbmNsdWRpbmcgdGhlIGNhbGxlci4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBBc3NldCB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIGZ1bmN0aW9uIHRyYW5zZmVyRnJvbSgKICAgICAgICBhZGRyZXNzIF9mcm9tLAogICAgICAgIGFkZHJlc3MgX3RvLAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQKICAgICkKICAgIGV4dGVybmFsCiAgICB3aGVuTm90UGF1c2VkCiAgICB7CiAgICAgICAgX3RyYW5zZmVyRnJvbShfZnJvbSwgX3RvLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIC8vLyBAbm90aWNlIEFsbG93IHByZS1hcHByb3ZlZCB1c2VyIHRvIHRha2Ugb3duZXJzaGlwIG9mIGEgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG9mIHRoZSBUb2tlbiB0aGF0IGNhbiBiZSB0cmFuc2ZlcnJlZCBpZiB0aGlzIGNhbGwgc3VjY2VlZHMuCiAgICBmdW5jdGlvbiB0YWtlT3duZXJzaGlwKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB7CiAgICAgICAgYWRkcmVzcyBfZnJvbSA9IGV0aGVybmF1dHNTdG9yYWdlLm93bmVyT2YoX3Rva2VuSWQpOwoKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfZnJvbSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBfdHJhbnNmZXJGcm9tKF9mcm9tLCBtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIEFzc2V0cyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBldGhlcm5hdXRzU3RvcmFnZS50b3RhbFN1cHBseSgpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgb3duZXIgb2YgYSBnaXZlbiBBc3NldChUb2tlbikuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRva2VuIElEIHRvIGdldCBvd25lci4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpCiAgICBleHRlcm5hbAogICAgdmlldwogICAgcmV0dXJucyAoYWRkcmVzcyBvd25lcikKICAgIHsKICAgICAgICBvd25lciA9IGV0aGVybmF1dHNTdG9yYWdlLm93bmVyT2YoX3Rva2VuSWQpOwoKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwogICAgfQoKICAgIC8vLyBAZGV2IENyZWF0ZXMgYSBuZXcgQXNzZXQgd2l0aCB0aGUgZ2l2ZW4gZmllbGRzLiBPTmx5IGF2YWlsYWJsZSBmb3IgQyBMZXZlbHMKICAgIC8vLyBAcGFyYW0gX2NyZWF0b3JUb2tlbklEIFRoZSBhc3NldCB3aG8gaXMgZmF0aGVyIG9mIHRoaXMgYXNzZXQKICAgIC8vLyBAcGFyYW0gX3ByaWNlIGFzc2V0IHByaWNlCiAgICAvLy8gQHBhcmFtIF9hc3NldElEIGFzc2V0IElECiAgICAvLy8gQHBhcmFtIF9jYXRlZ29yeSBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9hdHRyaWJ1dGVzIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIC8vLyBAcGFyYW0gX3N0YXRzIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld0Fzc2V0KAogICAgICAgIHVpbnQyNTYgX2NyZWF0b3JUb2tlbklELAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQyNTYgX3ByaWNlLAogICAgICAgIHVpbnQxNiBfYXNzZXRJRCwKICAgICAgICB1aW50OCBfY2F0ZWdvcnksCiAgICAgICAgdWludDggX2F0dHJpYnV0ZXMsCiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gX3N0YXRzCiAgICApCiAgICBleHRlcm5hbCBvbmx5Q0xldmVsCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIG93bmVyIG11c3QgYmUgc2VuZGVyCiAgICAgICAgcmVxdWlyZShfb3duZXIgIT0gYWRkcmVzcygwKSk7CgogICAgICAgIHVpbnQyNTYgdG9rZW5JRCA9IGV0aGVybmF1dHNTdG9yYWdlLmNyZWF0ZUFzc2V0KAogICAgICAgICAgICBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgICAgIF9vd25lciwKICAgICAgICAgICAgX3ByaWNlLAogICAgICAgICAgICBfYXNzZXRJRCwKICAgICAgICAgICAgX2NhdGVnb3J5LAogICAgICAgICAgICB1aW50OChBc3NldFN0YXRlLkF2YWlsYWJsZSksCiAgICAgICAgICAgIF9hdHRyaWJ1dGVzLAogICAgICAgICAgICBfc3RhdHMsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIDAKICAgICAgICApOwoKICAgICAgICAvLyBlbWl0IHRoZSBidWlsZCBldmVudAogICAgICAgIEJ1aWxkKAogICAgICAgICAgICBfb3duZXIsCiAgICAgICAgICAgIHRva2VuSUQsCiAgICAgICAgICAgIF9hc3NldElELAogICAgICAgICAgICBfcHJpY2UKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdG9rZW5JRDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSB2ZXJpZnkgaWYgdG9rZW4gaXMgaW4gZXhwbG9yYXRpb24gdGltZQogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVG9rZW4gSUQgdGhhdCBjYW4gYmUgdXBncmFkZWQKICAgIGZ1bmN0aW9uIGlzRXhwbG9yaW5nKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICB1aW50MjU2IGNvb2xkb3duOwogICAgICAgIHVpbnQ2NCBjb29sZG93bkVuZEJsb2NrOwogICAgICAgICgsLCwsLGNvb2xkb3duRW5kQmxvY2ssIGNvb2xkb3duLCkgPSBldGhlcm5hdXRzU3RvcmFnZS5hc3NldHMoX3Rva2VuSWQpOwogICAgICAgIHJldHVybiAoY29vbGRvd24gPiBub3cpIHx8IChjb29sZG93bkVuZEJsb2NrID4gdWludDY0KGJsb2NrLm51bWJlcikpOwogICAgfQp9CgoKLy8vIEB0aXRsZSBUaGUgZmFjZXQgb2YgdGhlIEV0aGVybmF1dHMgTG9naWMgY29udHJhY3QgaGFuZGxlIGFsbCBjb21tb24gY29kZSBmb3IgbG9naWMvYnVzaW5lc3MgY29udHJhY3RzCi8vLyBAYXV0aG9yIEV0aGVybmF0dXMgLSBGZXJuYW5kbyBQYXVlcgpjb250cmFjdCBFdGhlcm5hdXRzTG9naWMgaXMgRXRoZXJuYXV0c093bmVyc2hpcCB7CgogICAgLy8gU2V0IGluIGNhc2UgdGhlIGxvZ2ljIGNvbnRyYWN0IGlzIGJyb2tlbiBhbmQgYW4gdXBncmFkZSBpcyByZXF1aXJlZAogICAgYWRkcmVzcyBwdWJsaWMgbmV3Q29udHJhY3RBZGRyZXNzOwoKICAgIC8vLyBAZGV2IENvbnN0cnVjdG9yCiAgICBmdW5jdGlvbiBFdGhlcm5hdXRzTG9naWMoKSBwdWJsaWMgewogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBDRU8sIENPTywgQ1RPCiAgICAgICAgY2VvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgY3RvQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7CiAgICAgICAgb3JhY2xlQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIFN0YXJ0cyBwYXVzZWQuCiAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gQGRldiBVc2VkIHRvIG1hcmsgdGhlIHNtYXJ0IGNvbnRyYWN0IGFzIHVwZ3JhZGVkLCBpbiBjYXNlIHRoZXJlIGlzIGEgc2VyaW91cwogICAgLy8vICBicmVha2luZyBidWcuIFRoaXMgbWV0aG9kIGRvZXMgbm90aGluZyBidXQga2VlcCB0cmFjayBvZiB0aGUgbmV3IGNvbnRyYWN0IGFuZAogICAgLy8vICBlbWl0IGEgbWVzc2FnZSBpbmRpY2F0aW5nIHRoYXQgdGhlIG5ldyBhZGRyZXNzIGlzIHNldC4gSXQncyB1cCB0byBjbGllbnRzIG9mIHRoaXMKICAgIC8vLyAgY29udHJhY3QgdG8gdXBkYXRlIHRvIHRoZSBuZXcgY29udHJhY3QgYWRkcmVzcyBpbiB0aGF0IGNhc2UuIChUaGlzIGNvbnRyYWN0IHdpbGwKICAgIC8vLyAgYmUgcGF1c2VkIGluZGVmaW5pdGVseSBpZiBzdWNoIGFuIHVwZ3JhZGUgdGFrZXMgcGxhY2UuKQogICAgLy8vIEBwYXJhbSBfdjJBZGRyZXNzIG5ldyBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZXROZXdBZGRyZXNzKGFkZHJlc3MgX3YyQWRkcmVzcykgZXh0ZXJuYWwgb25seUNUTyB3aGVuUGF1c2VkIHsKICAgICAgICAvLyBTZWUgUkVBRE1FLm1kIGZvciB1cGRncmFkZSBwbGFuCiAgICAgICAgbmV3Q29udHJhY3RBZGRyZXNzID0gX3YyQWRkcmVzczsKICAgICAgICBDb250cmFjdFVwZ3JhZGUoX3YyQWRkcmVzcyk7CiAgICB9CgogICAgLy8vIEBkZXYgc2V0IGEgbmV3IHJlZmVyZW5jZSB0byB0aGUgTkZUIG93bmVyc2hpcCBjb250cmFjdAogICAgLy8vIEBwYXJhbSBfQ1N0b3JhZ2VBZGRyZXNzIC0gYWRkcmVzcyBvZiBhIGRlcGxveWVkIGNvbnRyYWN0IGltcGxlbWVudGluZyBFdGhlcm5hdXRzU3RvcmFnZS4KICAgIGZ1bmN0aW9uIHNldEV0aGVybmF1dHNTdG9yYWdlQ29udHJhY3QoYWRkcmVzcyBfQ1N0b3JhZ2VBZGRyZXNzKSBwdWJsaWMgb25seUNMZXZlbCB3aGVuUGF1c2VkIHsKICAgICAgICBFdGhlcm5hdXRzU3RvcmFnZSBjYW5kaWRhdGVDb250cmFjdCA9IEV0aGVybmF1dHNTdG9yYWdlKF9DU3RvcmFnZUFkZHJlc3MpOwogICAgICAgIHJlcXVpcmUoY2FuZGlkYXRlQ29udHJhY3QuaXNFdGhlcm5hdXRzU3RvcmFnZSgpKTsKICAgICAgICBldGhlcm5hdXRzU3RvcmFnZSA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgfQoKICAgIC8vLyBAZGV2IE92ZXJyaWRlIHVucGF1c2Ugc28gaXQgcmVxdWlyZXMgYWxsIGV4dGVybmFsIGNvbnRyYWN0IGFkZHJlc3NlcwogICAgLy8vICB0byBiZSBzZXQgYmVmb3JlIGNvbnRyYWN0IGNhbiBiZSB1bnBhdXNlZC4gQWxzbywgd2UgY2FuJ3QgaGF2ZQogICAgLy8vICBuZXdDb250cmFjdEFkZHJlc3Mgc2V0IGVpdGhlciwgYmVjYXVzZSB0aGVuIHRoZSBjb250cmFjdCB3YXMgdXBncmFkZWQuCiAgICAvLy8gQG5vdGljZSBUaGlzIGlzIHB1YmxpYyByYXRoZXIgdGhhbiBleHRlcm5hbCBzbyB3ZSBjYW4gY2FsbCBzdXBlci51bnBhdXNlCiAgICAvLy8gIHdpdGhvdXQgdXNpbmcgYW4gZXhwZW5zaXZlIENBTEwuCiAgICBmdW5jdGlvbiB1bnBhdXNlKCkgcHVibGljIG9ubHlDRU8gd2hlblBhdXNlZCB7CiAgICAgICAgcmVxdWlyZShldGhlcm5hdXRzU3RvcmFnZSAhPSBhZGRyZXNzKDApKTsKICAgICAgICByZXF1aXJlKG5ld0NvbnRyYWN0QWRkcmVzcyA9PSBhZGRyZXNzKDApKTsKICAgICAgICAvLyByZXF1aXJlIHRoaXMgY29udHJhY3QgdG8gaGF2ZSBhY2Nlc3MgdG8gc3RvcmFnZSBjb250cmFjdAogICAgICAgIHJlcXVpcmUoZXRoZXJuYXV0c1N0b3JhZ2UuY29udHJhY3RzR3JhbnRlZEFjY2VzcyhhZGRyZXNzKHRoaXMpKSA9PSB0cnVlKTsKCiAgICAgICAgLy8gQWN0dWFsbHkgdW5wYXVzZSB0aGUgY29udHJhY3QuCiAgICAgICAgc3VwZXIudW5wYXVzZSgpOwogICAgfQoKICAgIC8vIEBkZXYgQWxsb3dzIHRoZSBDT08gdG8gY2FwdHVyZSB0aGUgYmFsYW5jZSBhdmFpbGFibGUgdG8gdGhlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlcyhhZGRyZXNzIF90bykgcHVibGljIG9ubHlDTGV2ZWwgewogICAgICAgIF90by50cmFuc2Zlcih0aGlzLmJhbGFuY2UpOwogICAgfQoKICAgIC8vLyByZXR1cm4gY3VycmVudCBjb250cmFjdCBiYWxhbmNlCiAgICBmdW5jdGlvbiBnZXRCYWxhbmNlKCkgcHVibGljIHZpZXcgb25seUNMZXZlbCByZXR1cm5zICh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFsYW5jZTsKICAgIH0KfQoKLy8vIEB0aXRsZSBTdG9yYWdlIGNvbnRyYWN0IGZvciBFdGhlcm5hdXRzIERhdGEuIENvbW1vbiBzdHJ1Y3RzIGFuZCBjb25zdGFudHMuCi8vLyBAbm90aWNlIFRoaXMgaXMgb3VyIG1haW4gZGF0YSBzdG9yYWdlLCBjb25zdGFudHMgYW5kIGRhdGEgdHlwZXMsIHBsdXMKLy8gICAgICAgICAgaW50ZXJuYWwgZnVuY3Rpb25zIGZvciBtYW5hZ2luZyB0aGUgYXNzZXRzLiBJdCBpcyBpc29sYXRlZCBhbmQgb25seSBpbnRlcmZhY2Ugd2l0aAovLyAgICAgICAgICBhIGxpc3Qgb2YgZ3JhbnRlZCBjb250cmFjdHMgZGVmaW5lZCBieSBDVE8KLy8vIEBhdXRob3IgRXRoZXJuYXV0cyAtIEZlcm5hbmRvIFBhdWVyCmNvbnRyYWN0IEV0aGVybmF1dHNTdG9yYWdlIGlzIEV0aGVybmF1dHNBY2Nlc3NDb250cm9sIHsKCiAgICBmdW5jdGlvbiBFdGhlcm5hdXRzU3RvcmFnZSgpIHB1YmxpYyB7CiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENFTwogICAgICAgIGNlb0FkZHJlc3MgPSBtc2cuc2VuZGVyOwoKICAgICAgICAvLyB0aGUgY3JlYXRvciBvZiB0aGUgY29udHJhY3QgaXMgdGhlIGluaXRpYWwgQ1RPIGFzIHdlbGwKICAgICAgICBjdG9BZGRyZXNzID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gdGhlIGNyZWF0b3Igb2YgdGhlIGNvbnRyYWN0IGlzIHRoZSBpbml0aWFsIENUTyBhcyB3ZWxsCiAgICAgICAgY29vQWRkcmVzcyA9IG1zZy5zZW5kZXI7CgogICAgICAgIC8vIHRoZSBjcmVhdG9yIG9mIHRoZSBjb250cmFjdCBpcyB0aGUgaW5pdGlhbCBPcmFjbGUgYXMgd2VsbAogICAgICAgIG9yYWNsZUFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vLyBAbm90aWNlIE5vIHRpcHBpbmchCiAgICAvLy8gQGRldiBSZWplY3QgYWxsIEV0aGVyIGZyb20gYmVpbmcgc2VudCBoZXJlLiBIb3BlZnVsbHksIHdlIGNhbiBwcmV2ZW50IHVzZXIgYWNjaWRlbnRzLgogICAgZnVuY3Rpb24oKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyh0aGlzKSk7CiAgICB9CgogICAgLyoqKiBNYXBwaW5nIGZvciBDb250cmFjdHMgd2l0aCBncmFudGVkIHBlcm1pc3Npb24gKioqLwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSBwdWJsaWMgY29udHJhY3RzR3JhbnRlZEFjY2VzczsKCiAgICAvLy8gQGRldiBncmFudCBhY2Nlc3MgZm9yIGEgY29udHJhY3QgdG8gaW50ZXJhY3Qgd2l0aCB0aGlzIGNvbnRyYWN0LgogICAgLy8vIEBwYXJhbSBfdjJBZGRyZXNzIFRoZSBjb250cmFjdCBhZGRyZXNzIHRvIGdyYW50IGFjY2VzcwogICAgZnVuY3Rpb24gZ3JhbnRBY2Nlc3MoYWRkcmVzcyBfdjJBZGRyZXNzKSBwdWJsaWMgb25seUNUTyB7CiAgICAgICAgLy8gU2VlIFJFQURNRS5tZCBmb3IgdXBkZ3JhZGUgcGxhbgogICAgICAgIGNvbnRyYWN0c0dyYW50ZWRBY2Nlc3NbX3YyQWRkcmVzc10gPSB0cnVlOwogICAgfQoKICAgIC8vLyBAZGV2IHJlbW92ZSBhY2Nlc3MgZnJvbSBhIGNvbnRyYWN0IHRvIGludGVyYWN0IHdpdGggdGhpcyBjb250cmFjdC4KICAgIC8vLyBAcGFyYW0gX3YyQWRkcmVzcyBUaGUgY29udHJhY3QgYWRkcmVzcyB0byBiZSByZW1vdmVkCiAgICBmdW5jdGlvbiByZW1vdmVBY2Nlc3MoYWRkcmVzcyBfdjJBZGRyZXNzKSBwdWJsaWMgb25seUNUTyB7CiAgICAgICAgLy8gU2VlIFJFQURNRS5tZCBmb3IgdXBkZ3JhZGUgcGxhbgogICAgICAgIGRlbGV0ZSBjb250cmFjdHNHcmFudGVkQWNjZXNzW192MkFkZHJlc3NdOwogICAgfQoKICAgIC8vLyBAZGV2IE9ubHkgYWxsb3cgcGVybWl0dGVkIGNvbnRyYWN0cyB0byBpbnRlcmFjdCB3aXRoIHRoaXMgY29udHJhY3QKICAgIG1vZGlmaWVyIG9ubHlHcmFudGVkQ29udHJhY3RzKCkgewogICAgICAgIHJlcXVpcmUoY29udHJhY3RzR3JhbnRlZEFjY2Vzc1ttc2cuc2VuZGVyXSA9PSB0cnVlKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIHZhbGlkQXNzZXQodWludDI1NiBfdG9rZW5JZCkgewogICAgICAgIHJlcXVpcmUoYXNzZXRzW190b2tlbklkXS5JRCA+IDApOwogICAgICAgIF87CiAgICB9CiAgICAvKioqIERBVEEgVFlQRVMgKioqLwoKICAgIC8vLyBAZGV2IFRoZSBtYWluIEV0aGVybmF1dHMgYXNzZXQgc3RydWN0LiBFdmVyeSBhc3NldCBpbiBFdGhlcm5hdXRzIGlzIHJlcHJlc2VudGVkIGJ5IGEgY29weQogICAgLy8vICBvZiB0aGlzIHN0cnVjdHVyZS4gTm90ZSB0aGF0IHRoZSBvcmRlciBvZiB0aGUgbWVtYmVycyBpbiB0aGlzIHN0cnVjdHVyZQogICAgLy8vICBpcyBpbXBvcnRhbnQgYmVjYXVzZSBvZiB0aGUgYnl0ZS1wYWNraW5nIHJ1bGVzIHVzZWQgYnkgRXRoZXJldW0uCiAgICAvLy8gIFJlZjogaHR0cDovL3NvbGlkaXR5LnJlYWR0aGVkb2NzLmlvL2VuL2RldmVsb3AvbWlzY2VsbGFuZW91cy5odG1sCiAgICBzdHJ1Y3QgQXNzZXQgewoKICAgICAgICAvLyBBc3NldCBJRCBpcyBhIGlkZW50aWZpZXIgZm9yIGxvb2sgYW5kIGZlZWwgaW4gZnJvbnRlbmQKICAgICAgICB1aW50MTYgSUQ7CgogICAgICAgIC8vIENhdGVnb3J5ID0gU2VjdG9ycywgTWFudWZhY3R1cmVycywgU2hpcHMsIE9iamVjdHMgKFVwZ3JhZGVzL01pc2MpLCBGYWN0b3JpZXMgYW5kIENyZXdNZW1iZXJzCiAgICAgICAgdWludDggY2F0ZWdvcnk7CgogICAgICAgIC8vIFRoZSBTdGF0ZSBvZiBhbiBhc3NldDogQXZhaWxhYmxlLCBPbiBzYWxlLCBVcCBmb3IgbGVhc2UsIENvb2xkb3duLCBFeHBsb3JpbmcKICAgICAgICB1aW50OCBzdGF0ZTsKCiAgICAgICAgLy8gQXR0cmlidXRlcwogICAgICAgIC8vIGJ5dGUgcG9zIC0gRGVmaW5pdGlvbgogICAgICAgIC8vIDAwMDAwMDAxIC0gU2VlZGVkIC0gT2ZmZXJlZCB0byB0aGUgZWNvbm9teSBieSB1cywgdGhlIGRldmVsb3BlcnMuIFBvdGVudGlhbGx5IGF0IHJlZ3VsYXIgaW50ZXJ2YWxzLgogICAgICAgIC8vIDAwMDAwMDEwIC0gUHJvZHVjaWJsZSAtIFByb2R1Y3Qgb2YgYSBmYWN0b3J5IGFuZC9vciBmYWN0b3J5IGNvbnRyYWN0LgogICAgICAgIC8vIDAwMDAwMTAwIC0gRXhwbG9yYWJsZS0gUHJvZHVjdCBvZiBleHBsb3JhdGlvbi4KICAgICAgICAvLyAwMDAwMTAwMCAtIExlYXNhYmxlIC0gQ2FuIGJlIHJlbnRlZCB0byBvdGhlciB1c2VycyBhbmQgd2lsbCByZXR1cm4gdG8gdGhlIG9yaWdpbmFsIG93bmVyIG9uY2UgdGhlIGFjdGlvbiBpcyBjb21wbGV0ZS4KICAgICAgICAvLyAwMDAxMDAwMCAtIFBlcm1hbmVudCAtIENhbm5vdCBiZSByZW1vdmVkLCBhbHdheXMgb3duZWQgYnkgYSB1c2VyLgogICAgICAgIC8vIDAwMTAwMDAwIC0gQ29uc3VtYWJsZSAtIERlc3Ryb3llZCBhZnRlciBOIGV4cGxvcmF0aW9uIGV4cGVkaXRpb25zLgogICAgICAgIC8vIDAxMDAwMDAwIC0gVHJhZGFibGUgLSBCdXlhYmxlIGFuZCBzZWxsYWJsZSBvbiB0aGUgbWFya2V0LgogICAgICAgIC8vIDEwMDAwMDAwIC0gSG90IFBvdGF0byAtIEF1dG9tYXRpY2FsbHkgZ2V0cyBwdXQgdXAgZm9yIHNhbGUgYWZ0ZXIgYWNxdWlyaW5nLgogICAgICAgIGJ5dGVzMiBhdHRyaWJ1dGVzOwoKICAgICAgICAvLyBUaGUgdGltZXN0YW1wIGZyb20gdGhlIGJsb2NrIHdoZW4gdGhpcyBhc3NldCB3YXMgY3JlYXRlZC4KICAgICAgICB1aW50NjQgY3JlYXRlZEF0OwoKICAgICAgICAvLyBUaGUgbWluaW11bSB0aW1lc3RhbXAgYWZ0ZXIgd2hpY2ggdGhpcyBhc3NldCBjYW4gZW5nYWdlIGluIGV4cGxvcmluZyBhY3Rpdml0aWVzIGFnYWluLgogICAgICAgIHVpbnQ2NCBjb29sZG93bkVuZEJsb2NrOwoKICAgICAgICAvLyBUaGUgQXNzZXQncyBzdGF0cyBjYW4gYmUgdXBncmFkZWQgb3IgY2hhbmdlZCBiYXNlZCBvbiBleHBsb3JhdGlvbiBjb25kaXRpb25zLgogICAgICAgIC8vIEl0IHdpbGwgYmUgZGVmaW5lZCBwZXIgY2hpbGQgY29udHJhY3QsIGJ1dCBhbGwgc3RhdHMgaGF2ZSBhIHJhbmdlIGZyb20gMCB0byAyNTUKICAgICAgICAvLyBFeGFtcGxlcwogICAgICAgIC8vIDAgPSBTaGlwIExldmVsCiAgICAgICAgLy8gMSA9IFNoaXAgQXR0YWNrCiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gc3RhdHM7CgogICAgICAgIC8vIFNldCB0byB0aGUgY29vbGRvd24gdGltZSB0aGF0IHJlcHJlc2VudHMgZXhwbG9yYXRpb24gZHVyYXRpb24gZm9yIHRoaXMgYXNzZXQuCiAgICAgICAgLy8gRGVmaW5lZCBieSBhIHN1Y2Nlc3NmdWwgZXhwbG9yYXRpb24gYWN0aW9uLCByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhpcyBhc3NldCBpcyBhY3RpbmcgYXMgc2hpcCBvciBhIHBhcnQuCiAgICAgICAgdWludDI1NiBjb29sZG93bjsKCiAgICAgICAgLy8gYSByZWZlcmVuY2UgdG8gYSBzdXBlciBhc3NldCB0aGF0IG1hbnVmYWN0dXJlZCB0aGUgYXNzZXQKICAgICAgICB1aW50MjU2IGJ1aWx0Qnk7CiAgICB9CgogICAgLyoqKiBDT05TVEFOVFMgKioqLwoKICAgIC8vIEBkZXYgU2FuaXR5IGNoZWNrIHRoYXQgYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIGFyZSBwb2ludGluZyB0byB0aGUKICAgIC8vICByaWdodCBzdG9yYWdlIGNvbnRyYWN0IGluIG91ciBFdGhlcm5hdXRzTG9naWMoYWRkcmVzcyBfQ1N0b3JhZ2VBZGRyZXNzKSBjYWxsLgogICAgYm9vbCBwdWJsaWMgaXNFdGhlcm5hdXRzU3RvcmFnZSA9IHRydWU7CgogICAgLyoqKiBTVE9SQUdFICoqKi8KCiAgICAvLy8gQGRldiBBbiBhcnJheSBjb250YWluaW5nIHRoZSBBc3NldCBzdHJ1Y3QgZm9yIGFsbCBhc3NldHMgaW4gZXhpc3RlbmNlLiBUaGUgQXNzZXQgVW5pcXVlSWQKICAgIC8vLyAgb2YgZWFjaCBhc3NldCBpcyBhY3R1YWxseSBhbiBpbmRleCBpbnRvIHRoaXMgYXJyYXkuCiAgICBBc3NldFtdIHB1YmxpYyBhc3NldHM7CgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gQXNzZXQgVW5pcXVlSURzIHRvIHRoZSBwcmljZSBvZiB0aGUgdG9rZW4uCiAgICAvLy8gc3RvcmVkIG91dHNpZGUgQXNzZXQgU3RydWN0IHRvIHNhdmUgZ2FzLCBiZWNhdXNlIHByaWNlIGNhbiBjaGFuZ2UgZnJlcXVlbnRseQogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBpbnRlcm5hbCBhc3NldEluZGV4VG9QcmljZTsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBhc3NldCBVbmlxdWVJRHMgdG8gdGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZW0uIEFsbCBhc3NldHMgaGF2ZSBzb21lIHZhbGlkIG93bmVyIGFkZHJlc3MuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIGludGVybmFsIGFzc2V0SW5kZXhUb093bmVyOwoKICAgIC8vIEBkZXYgQSBtYXBwaW5nIGZyb20gb3duZXIgYWRkcmVzcyB0byBjb3VudCBvZiB0b2tlbnMgdGhhdCBhZGRyZXNzIG93bnMuCiAgICAvLyAgVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgaW50ZXJuYWwgb3duZXJzaGlwVG9rZW5Db3VudDsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBBc3NldFVuaXF1ZUlEcyB0byBhbiBhZGRyZXNzIHRoYXQgaGFzIGJlZW4gYXBwcm92ZWQgdG8gY2FsbAogICAgLy8vICB0cmFuc2ZlckZyb20oKS4gRWFjaCBBc3NldCBjYW4gb25seSBoYXZlIG9uZSBhcHByb3ZlZCBhZGRyZXNzIGZvciB0cmFuc2ZlcgogICAgLy8vICBhdCBhbnkgdGltZS4gQSB6ZXJvIHZhbHVlIG1lYW5zIG5vIGFwcHJvdmFsIGlzIG91dHN0YW5kaW5nLgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBpbnRlcm5hbCBhc3NldEluZGV4VG9BcHByb3ZlZDsKCgogICAgLyoqKiBTRVRURVJTICoqKi8KCiAgICAvLy8gQGRldiBzZXQgbmV3IGFzc2V0IHByaWNlCiAgICAvLy8gQHBhcmFtIF90b2tlbklkICBhc3NldCBVbmlxdWVJZAogICAgLy8vIEBwYXJhbSBfcHJpY2UgICAgYXNzZXQgcHJpY2UKICAgIGZ1bmN0aW9uIHNldFByaWNlKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX3ByaWNlKSBwdWJsaWMgb25seUdyYW50ZWRDb250cmFjdHMgewogICAgICAgIGFzc2V0SW5kZXhUb1ByaWNlW190b2tlbklkXSA9IF9wcmljZTsKICAgIH0KCiAgICAvLy8gQGRldiBNYXJrIHRyYW5zZmVyIGFzIGFwcHJvdmVkCiAgICAvLy8gQHBhcmFtIF90b2tlbklkICBhc3NldCBVbmlxdWVJZAogICAgLy8vIEBwYXJhbSBfYXBwcm92ZWQgYWRkcmVzcyBhcHByb3ZlZAogICAgZnVuY3Rpb24gYXBwcm92ZSh1aW50MjU2IF90b2tlbklkLCBhZGRyZXNzIF9hcHByb3ZlZCkgcHVibGljIG9ubHlHcmFudGVkQ29udHJhY3RzIHsKICAgICAgICBhc3NldEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF0gPSBfYXBwcm92ZWQ7CiAgICB9CgogICAgLy8vIEBkZXYgQXNzaWducyBvd25lcnNoaXAgb2YgYSBzcGVjaWZpYyBBc3NldCB0byBhbiBhZGRyZXNzLgogICAgLy8vIEBwYXJhbSBfZnJvbSAgICBjdXJyZW50IG93bmVyIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX3RvICAgICAgbmV3IG93bmVyIGFkZHJlc3MKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkKSBwdWJsaWMgb25seUdyYW50ZWRDb250cmFjdHMgewogICAgICAgIC8vIFNpbmNlIHRoZSBudW1iZXIgb2YgYXNzZXRzIGlzIGNhcHBlZCB0byAyXjMyIHdlIGNhbid0IG92ZXJmbG93IHRoaXMKICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W190b10rKzsKICAgICAgICAvLyB0cmFuc2ZlciBvd25lcnNoaXAKICAgICAgICBhc3NldEluZGV4VG9Pd25lcltfdG9rZW5JZF0gPSBfdG87CiAgICAgICAgLy8gV2hlbiBjcmVhdGluZyBuZXcgYXNzZXRzIF9mcm9tIGlzIDB4MCwgYnV0IHdlIGNhbid0IGFjY291bnQgdGhhdCBhZGRyZXNzLgogICAgICAgIGlmIChfZnJvbSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIG93bmVyc2hpcFRva2VuQ291bnRbX2Zyb21dLS07CiAgICAgICAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICAgICAgICBkZWxldGUgYXNzZXRJbmRleFRvQXBwcm92ZWRbX3Rva2VuSWRdOwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBIHB1YmxpYyBtZXRob2QgdGhhdCBjcmVhdGVzIGEgbmV3IGFzc2V0IGFuZCBzdG9yZXMgaXQuIFRoaXMKICAgIC8vLyAgbWV0aG9kIGRvZXMgYmFzaWMgY2hlY2tpbmcgYW5kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCBmcm9tIG90aGVyIGNvbnRyYWN0IHdoZW4gdGhlCiAgICAvLy8gIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuIFdpbGwgTk9UIGdlbmVyYXRlIGFueSBldmVudCBpdCBpcyBkZWxlZ2F0ZSB0byBidXNpbmVzcyBsb2dpYyBjb250cmFjdHMuCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yVG9rZW5JRCBUaGUgYXNzZXQgd2hvIGlzIGZhdGhlciBvZiB0aGlzIGFzc2V0CiAgICAvLy8gQHBhcmFtIF9vd25lciBGaXJzdCBvd25lciBvZiB0aGlzIGFzc2V0CiAgICAvLy8gQHBhcmFtIF9wcmljZSBhc3NldCBwcmljZQogICAgLy8vIEBwYXJhbSBfSUQgYXNzZXQgSUQKICAgIC8vLyBAcGFyYW0gX2NhdGVnb3J5IHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIC8vLyBAcGFyYW0gX3N0YXRlIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIC8vLyBAcGFyYW0gX2F0dHJpYnV0ZXMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfc3RhdHMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gY3JlYXRlQXNzZXQoCiAgICAgICAgdWludDI1NiBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgYWRkcmVzcyBfb3duZXIsCiAgICAgICAgdWludDI1NiBfcHJpY2UsCiAgICAgICAgdWludDE2IF9JRCwKICAgICAgICB1aW50OCBfY2F0ZWdvcnksCiAgICAgICAgdWludDggX3N0YXRlLAogICAgICAgIHVpbnQ4IF9hdHRyaWJ1dGVzLAogICAgICAgIHVpbnQ4W1NUQVRTX1NJWkVdIF9zdGF0cywKICAgICAgICB1aW50MjU2IF9jb29sZG93biwKICAgICAgICB1aW50NjQgX2Nvb2xkb3duRW5kQmxvY2sKICAgICkKICAgIHB1YmxpYyBvbmx5R3JhbnRlZENvbnRyYWN0cwogICAgcmV0dXJucyAodWludDI1NikKICAgIHsKICAgICAgICAvLyBFbnN1cmUgb3VyIGRhdGEgc3RydWN0dXJlcyBhcmUgYWx3YXlzIHZhbGlkLgogICAgICAgIHJlcXVpcmUoX0lEID4gMCk7CiAgICAgICAgcmVxdWlyZShfY2F0ZWdvcnkgPiAwKTsKICAgICAgICByZXF1aXJlKF9hdHRyaWJ1dGVzICE9IDB4MCk7CiAgICAgICAgcmVxdWlyZShfc3RhdHMubGVuZ3RoID4gMCk7CgogICAgICAgIEFzc2V0IG1lbW9yeSBhc3NldCA9IEFzc2V0KHsKICAgICAgICAgICAgSUQ6IF9JRCwKICAgICAgICAgICAgY2F0ZWdvcnk6IF9jYXRlZ29yeSwKICAgICAgICAgICAgYnVpbHRCeTogX2NyZWF0b3JUb2tlbklELAogICAgICAgICAgICBhdHRyaWJ1dGVzOiBieXRlczIoX2F0dHJpYnV0ZXMpLAogICAgICAgICAgICBzdGF0czogX3N0YXRzLAogICAgICAgICAgICBzdGF0ZTogX3N0YXRlLAogICAgICAgICAgICBjcmVhdGVkQXQ6IHVpbnQ2NChub3cpLAogICAgICAgICAgICBjb29sZG93bkVuZEJsb2NrOiBfY29vbGRvd25FbmRCbG9jaywKICAgICAgICAgICAgY29vbGRvd246IF9jb29sZG93bgogICAgICAgIH0pOwoKICAgICAgICB1aW50MjU2IG5ld0Fzc2V0VW5pcXVlSWQgPSBhc3NldHMucHVzaChhc3NldCkgLSAxOwoKICAgICAgICAvLyBDaGVjayBpdCByZWFjaGVkIDQgYmlsbGlvbiBhc3NldHMgYnV0IGxldCdzIGp1c3QgYmUgMTAwJSBzdXJlLgogICAgICAgIHJlcXVpcmUobmV3QXNzZXRVbmlxdWVJZCA9PSB1aW50MjU2KHVpbnQzMihuZXdBc3NldFVuaXF1ZUlkKSkpOwoKICAgICAgICAvLyBzdG9yZSBwcmljZQogICAgICAgIGFzc2V0SW5kZXhUb1ByaWNlW25ld0Fzc2V0VW5pcXVlSWRdID0gX3ByaWNlOwoKICAgICAgICAvLyBUaGlzIHdpbGwgYXNzaWduIG93bmVyc2hpcAogICAgICAgIHRyYW5zZmVyKGFkZHJlc3MoMCksIF9vd25lciwgbmV3QXNzZXRVbmlxdWVJZCk7CgogICAgICAgIHJldHVybiBuZXdBc3NldFVuaXF1ZUlkOwogICAgfQoKICAgIC8vLyBAZGV2IEEgcHVibGljIG1ldGhvZCB0aGF0IGVkaXQgYXNzZXQgaW4gY2FzZSBvZiBhbnkgbWlzdGFrZSBpcyBkb25lIGR1cmluZyBwcm9jZXNzIG9mIGNyZWF0aW9uIGJ5IHRoZSBkZXZlbG9wZXIuIFRoaXMKICAgIC8vLyBUaGlzIG1ldGhvZCBkb2Vzbid0IGRvIGFueSBjaGVja2luZyBhbmQgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIHdoZW4gdGhlCiAgICAvLy8gIGlucHV0IGRhdGEgaXMga25vd24gdG8gYmUgdmFsaWQuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSB0b2tlbiBJRAogICAgLy8vIEBwYXJhbSBfY3JlYXRvclRva2VuSUQgVGhlIGFzc2V0IHRoYXQgY3JlYXRlIHRoYXQgdG9rZW4KICAgIC8vLyBAcGFyYW0gX3ByaWNlIGFzc2V0IHByaWNlCiAgICAvLy8gQHBhcmFtIF9JRCBhc3NldCBJRAogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfc3RhdGUgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0cyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9jb29sZG93biBhc3NldCBjb29sZG93biBpbmRleAogICAgZnVuY3Rpb24gZWRpdEFzc2V0KAogICAgICAgIHVpbnQyNTYgX3Rva2VuSWQsCiAgICAgICAgdWludDI1NiBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgdWludDI1NiBfcHJpY2UsCiAgICAgICAgdWludDE2IF9JRCwKICAgICAgICB1aW50OCBfY2F0ZWdvcnksCiAgICAgICAgdWludDggX3N0YXRlLAogICAgICAgIHVpbnQ4IF9hdHRyaWJ1dGVzLAogICAgICAgIHVpbnQ4W1NUQVRTX1NJWkVdIF9zdGF0cywKICAgICAgICB1aW50MTYgX2Nvb2xkb3duCiAgICApCiAgICBleHRlcm5hbCB2YWxpZEFzc2V0KF90b2tlbklkKSBvbmx5Q0xldmVsCiAgICByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIC8vIEVuc3VyZSBvdXIgZGF0YSBzdHJ1Y3R1cmVzIGFyZSBhbHdheXMgdmFsaWQuCiAgICAgICAgcmVxdWlyZShfSUQgPiAwKTsKICAgICAgICByZXF1aXJlKF9jYXRlZ29yeSA+IDApOwogICAgICAgIHJlcXVpcmUoX2F0dHJpYnV0ZXMgIT0gMHgwKTsKICAgICAgICByZXF1aXJlKF9zdGF0cy5sZW5ndGggPiAwKTsKCiAgICAgICAgLy8gc3RvcmUgcHJpY2UKICAgICAgICBhc3NldEluZGV4VG9QcmljZVtfdG9rZW5JZF0gPSBfcHJpY2U7CgogICAgICAgIEFzc2V0IHN0b3JhZ2UgYXNzZXQgPSBhc3NldHNbX3Rva2VuSWRdOwogICAgICAgIGFzc2V0LklEID0gX0lEOwogICAgICAgIGFzc2V0LmNhdGVnb3J5ID0gX2NhdGVnb3J5OwogICAgICAgIGFzc2V0LmJ1aWx0QnkgPSBfY3JlYXRvclRva2VuSUQ7CiAgICAgICAgYXNzZXQuYXR0cmlidXRlcyA9IGJ5dGVzMihfYXR0cmlidXRlcyk7CiAgICAgICAgYXNzZXQuc3RhdHMgPSBfc3RhdHM7CiAgICAgICAgYXNzZXQuc3RhdGUgPSBfc3RhdGU7CiAgICAgICAgYXNzZXQuY29vbGRvd24gPSBfY29vbGRvd247CiAgICB9CgogICAgLy8vIEBkZXYgVXBkYXRlIG9ubHkgc3RhdHMKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIC8vLyBAcGFyYW0gX3N0YXRzIGFzc2V0IHN0YXRlLCBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiB1cGRhdGVTdGF0cyh1aW50MjU2IF90b2tlbklkLCB1aW50OFtTVEFUU19TSVpFXSBfc3RhdHMpIHB1YmxpYyB2YWxpZEFzc2V0KF90b2tlbklkKSBvbmx5R3JhbnRlZENvbnRyYWN0cyB7CiAgICAgICAgYXNzZXRzW190b2tlbklkXS5zdGF0cyA9IF9zdGF0czsKICAgIH0KCiAgICAvLy8gQGRldiBVcGRhdGUgb25seSBhc3NldCBzdGF0ZQogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgLy8vIEBwYXJhbSBfc3RhdGUgYXNzZXQgc3RhdGUsIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQ4IF9zdGF0ZSkgcHVibGljIHZhbGlkQXNzZXQoX3Rva2VuSWQpIG9ubHlHcmFudGVkQ29udHJhY3RzIHsKICAgICAgICBhc3NldHNbX3Rva2VuSWRdLnN0YXRlID0gX3N0YXRlOwogICAgfQoKICAgIC8vLyBAZGV2IFVwZGF0ZSBDb29sZG93biBmb3IgYSBzaW5nbGUgYXNzZXQKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIC8vLyBAcGFyYW0gX2Nvb2xkb3duIGFzc2V0IHN0YXRlLCBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICBmdW5jdGlvbiBzZXRBc3NldENvb2xkb3duKHVpbnQyNTYgX3Rva2VuSWQsIHVpbnQyNTYgX2Nvb2xkb3duLCB1aW50NjQgX2Nvb2xkb3duRW5kQmxvY2spCiAgICBwdWJsaWMgdmFsaWRBc3NldChfdG9rZW5JZCkgb25seUdyYW50ZWRDb250cmFjdHMgewogICAgICAgIGFzc2V0c1tfdG9rZW5JZF0uY29vbGRvd24gPSBfY29vbGRvd247CiAgICAgICAgYXNzZXRzW190b2tlbklkXS5jb29sZG93bkVuZEJsb2NrID0gX2Nvb2xkb3duRW5kQmxvY2s7CiAgICB9CgogICAgLyoqKiBHRVRURVJTICoqKi8KCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIG9ubHkgc3RhdHMgZGF0YSBhYm91dCBhIHNwZWNpZmljIGFzc2V0LgogICAgLy8vIEBkZXYgaXQgaXMgbmVjZXNzYXJ5IGR1ZSBzb2xpZGl0eSBjb21waWxlciBsaW1pdGF0aW9ucwogICAgLy8vICAgICAgd2hlbiB3ZSBoYXZlIGxhcmdlIHF0eSBvZiBwYXJhbWV0ZXJzIGl0IHRocm93cyBTdGFja1Rvb0RlZXBFeGNlcHRpb24KICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIGZ1bmN0aW9uIGdldFN0YXRzKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQ4W1NUQVRTX1NJWkVdKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uc3RhdHM7CiAgICB9CgogICAgLy8vIEBkZXYgcmV0dXJuIGN1cnJlbnQgcHJpY2Ugb2YgYW4gYXNzZXQKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgYXNzZXQgVW5pcXVlSWQKICAgIGZ1bmN0aW9uIHByaWNlT2YodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NiBwcmljZSkgewogICAgICAgIHJldHVybiBhc3NldEluZGV4VG9QcmljZVtfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYXNzZXQgaGFzIGFsbCBhdHRyaWJ1dGVzIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX2F0dHJpYnV0ZXMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gaGFzQWxsQXR0cnModWludDI1NiBfdG9rZW5JZCwgYnl0ZXMyIF9hdHRyaWJ1dGVzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uYXR0cmlidXRlcyAmIF9hdHRyaWJ1dGVzID09IF9hdHRyaWJ1dGVzOwogICAgfQoKICAgIC8vLyBAbm90aWNlIENoZWNrIGlmIGFzc2V0IGhhcyBhbnkgYXR0cmlidXRlIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX2F0dHJpYnV0ZXMgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgZnVuY3Rpb24gaGFzQW55QXR0cnModWludDI1NiBfdG9rZW5JZCwgYnl0ZXMyIF9hdHRyaWJ1dGVzKSBwdWJsaWMgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0c1tfdG9rZW5JZF0uYXR0cmlidXRlcyAmIF9hdHRyaWJ1dGVzICE9IDB4MDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBDaGVjayBpZiBhc3NldCBpcyBpbiB0aGUgc3RhdGUgcGFzc2VkIGJ5IHBhcmFtZXRlcgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgVW5pcXVlSWQgb2YgdGhlIGFzc2V0IG9mIGludGVyZXN0LgogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0Q2F0ZWdvcnkgaW4gRXRoZXJuYXV0c0Jhc2UgZm9yIHBvc3NpYmxlIHN0YXRlcwogICAgZnVuY3Rpb24gaXNDYXRlZ29yeSh1aW50MjU2IF90b2tlbklkLCB1aW50OCBfY2F0ZWdvcnkpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5jYXRlZ29yeSA9PSBfY2F0ZWdvcnk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgQ2hlY2sgaWYgYXNzZXQgaXMgaW4gdGhlIHN0YXRlIHBhc3NlZCBieSBwYXJhbWV0ZXIKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIFVuaXF1ZUlkIG9mIHRoZSBhc3NldCBvZiBpbnRlcmVzdC4KICAgIC8vLyBAcGFyYW0gX3N0YXRlIHNlZSBlbnVtIEFzc2V0U3RhdGUgaW4gRXRoZXJuYXV0c0Jhc2UgZm9yIHBvc3NpYmxlIHN0YXRlcwogICAgZnVuY3Rpb24gaXNTdGF0ZSh1aW50MjU2IF90b2tlbklkLCB1aW50OCBfc3RhdGUpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gYXNzZXRzW190b2tlbklkXS5zdGF0ZSA9PSBfc3RhdGU7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyBvd25lciBvZiBhIGdpdmVuIEFzc2V0KFRva2VuKS4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIGFzc2V0IFVuaXF1ZUlkCiAgICBmdW5jdGlvbiBvd25lck9mKHVpbnQyNTYgX3Rva2VuSWQpIHB1YmxpYyB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpCiAgICB7CiAgICAgICAgcmV0dXJuIGFzc2V0SW5kZXhUb093bmVyW190b2tlbklkXTsKICAgIH0KCiAgICAvLy8gQGRldiBSZXF1aXJlZCBmb3IgRVJDLTcyMSBjb21wbGlhbmNlCiAgICAvLy8gQG5vdGljZSBSZXR1cm5zIHRoZSBudW1iZXIgb2YgQXNzZXRzIG93bmVkIGJ5IGEgc3BlY2lmaWMgYWRkcmVzcy4KICAgIC8vLyBAcGFyYW0gX293bmVyIFRoZSBvd25lciBhZGRyZXNzIHRvIGNoZWNrLgogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGNvdW50KSB7CiAgICAgICAgcmV0dXJuIG93bmVyc2hpcFRva2VuQ291bnRbX293bmVyXTsKICAgIH0KCiAgICAvLy8gQGRldiBDaGVja3MgaWYgYSBnaXZlbiBhZGRyZXNzIGN1cnJlbnRseSBoYXMgdHJhbnNmZXJBcHByb3ZhbCBmb3IgYSBwYXJ0aWN1bGFyIEFzc2V0LgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBhc3NldCBVbmlxdWVJZAogICAgZnVuY3Rpb24gYXBwcm92ZWRGb3IodWludDI1NiBfdG9rZW5JZCkgcHVibGljIHZpZXcgb25seUdyYW50ZWRDb250cmFjdHMgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIHJldHVybiBhc3NldEluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIEFzc2V0cyBjdXJyZW50bHkgaW4gZXhpc3RlbmNlLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBhc3NldHMubGVuZ3RoOwogICAgfQoKICAgIC8vLyBAbm90aWNlIExpc3QgYWxsIGV4aXN0aW5nIHRva2Vucy4gSXQgY2FuIGJlIGZpbHRlcmVkIGJ5IGF0dHJpYnV0ZXMgb3IgYXNzZXRzIHdpdGggb3duZXIKICAgIC8vLyBAcGFyYW0gX293bmVyIGZpbHRlciBhbGwgYXNzZXRzIGJ5IG93bmVyCiAgICBmdW5jdGlvbiBnZXRUb2tlbkxpc3QoYWRkcmVzcyBfb3duZXIsIHVpbnQ4IF93aXRoQXR0cmlidXRlcywgdWludDI1NiBzdGFydCwgdWludDI1NiBjb3VudCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zKAogICAgICAgIHVpbnQyNTZbNl1bXQogICAgKSB7CiAgICAgICAgdWludDI1NiB0b3RhbEFzc2V0cyA9IGFzc2V0cy5sZW5ndGg7CgogICAgICAgIGlmICh0b3RhbEFzc2V0cyA9PSAwKSB7CiAgICAgICAgICAgIC8vIFJldHVybiBhbiBlbXB0eSBhcnJheQogICAgICAgICAgICByZXR1cm4gbmV3IHVpbnQyNTZbNl1bXSgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1aW50MjU2WzZdW10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2WzZdW10odG90YWxBc3NldHMgPiBjb3VudCA/IGNvdW50IDogdG90YWxBc3NldHMpOwogICAgICAgICAgICB1aW50MjU2IHJlc3VsdEluZGV4ID0gMDsKICAgICAgICAgICAgYnl0ZXMyIGhhc0F0dHJpYnV0ZXMgID0gYnl0ZXMyKF93aXRoQXR0cmlidXRlcyk7CiAgICAgICAgICAgIEFzc2V0IG1lbW9yeSBhc3NldDsKCiAgICAgICAgICAgIGZvciAodWludDI1NiB0b2tlbklkID0gc3RhcnQ7IHRva2VuSWQgPCB0b3RhbEFzc2V0cyAmJiByZXN1bHRJbmRleCA8IGNvdW50OyB0b2tlbklkKyspIHsKICAgICAgICAgICAgICAgIGFzc2V0ID0gYXNzZXRzW3Rva2VuSWRdOwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIChhc3NldC5zdGF0ZSAhPSB1aW50OChBc3NldFN0YXRlLlVzZWQpKSAmJgogICAgICAgICAgICAgICAgICAgIChhc3NldEluZGV4VG9Pd25lclt0b2tlbklkXSA9PSBfb3duZXIgfHwgX293bmVyID09IGFkZHJlc3MoMCkpICYmCiAgICAgICAgICAgICAgICAgICAgKGFzc2V0LmF0dHJpYnV0ZXMgJiBoYXNBdHRyaWJ1dGVzID09IGhhc0F0dHJpYnV0ZXMpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzBdID0gdG9rZW5JZDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzFdID0gYXNzZXQuSUQ7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XVsyXSA9IGFzc2V0LmNhdGVnb3J5OwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bM10gPSB1aW50MjU2KGFzc2V0LmF0dHJpYnV0ZXMpOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRJbmRleF1bNF0gPSBhc3NldC5jb29sZG93bjsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdWzVdID0gYXNzZXRJbmRleFRvUHJpY2VbdG9rZW5JZF07CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SW5kZXgrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9Cn0KCgovLy8gQHRpdGxlIFRoZSBmYWNldCBvZiB0aGUgRXRoZXJuYXV0cyBFeHBsb3JlIGNvbnRyYWN0IHRoYXQgc2VuZCBhIHNoaXAgdG8gZXhwbG9yZSB0aGUgZGVlcCBzcGFjZS4KLy8vIEBub3RpY2UgQW4gb3duZWQgc2hpcCBjYW4gYmUgc2VuZCBvbiBhbiBleHBlZGl0aW9uLiBFeHBsb3JhdGlvbiB0YWtlcyB0aW1lCi8vICAgICAgICAgIGFuZCB3aWxsIGFsd2F5cyByZXN1bHQgaW4g4oCcc3VjY2Vzc+KAnS4gVGhpcyBtZWFucyB0aGUgc2hpcCBjYW4gbmV2ZXIgYmUgZGVzdHJveWVkCi8vICAgICAgICAgIGFuZCBhbHdheXMgcmV0dXJucyB3aXRoIGEgY29sbGVjdGlvbiBvZiBsb290LiBUaGUgZGVncmVlIG9mIHN1Y2Nlc3MgaXMgZGVwZW5kZW50Ci8vICAgICAgICAgIG9uIGRpZmZlcmVudCBmYWN0b3JzIGFzIHNlY3RvciBzdGF0cywgZ2FtbWEgcmF5IGJ1cnN0IG51bWJlciBhbmQgc2hpcCBzdGF0cy4KLy8gICAgICAgICAgV2hpbGUgdGhlIHNoaXAgaXMgZXhwbG9yaW5nIGl0IGNhbm5vdCBiZSBhY3RlZCBvbiBpbiBhbnkgd2F5IHVudGlsIHRoZSBleHBlZGl0aW9uIGNvbXBsZXRlcy4KLy8gICAgICAgICAgQWZ0ZXIgdGhlIHNoaXAgcmV0dXJucyBmcm9tIGFuIGV4cGVkaXRpb24gdGhlIHVzZXIgaXMgdGhlbiByZXdhcmRlZCB3aXRoIGEgbnVtYmVyIG9mIG9iamVjdHMgKGFzc2V0cykuCi8vLyBAYXV0aG9yIEV0aGVybmF0dXMgLSBGZXJuYW5kbyBQYXVlcgpjb250cmFjdCBFdGhlcm5hdXRzRXhwbG9yZSBpcyBFdGhlcm5hdXRzTG9naWMgewoKICAgIC8vLyBAZGV2IERlbGVnYXRlIGNvbnN0cnVjdG9yIHRvIE5vbmZ1bmdpYmxlIGNvbnRyYWN0LgogICAgZnVuY3Rpb24gRXRoZXJuYXV0c0V4cGxvcmUoKSBwdWJsaWMKICAgIEV0aGVybmF1dHNMb2dpYygpIHt9CgogICAgLyoqKiBFVkVOVFMgKioqLwogICAgLy8vIGVtaXQgc2lnbmFsIHRvIGFueW9uZSBsaXN0ZW5pbmcgaW4gdGhlIHVuaXZlcnNlCiAgICBldmVudCBFeHBsb3JlKHVpbnQyNTYgaW5kZXhlZCBzaGlwSWQsIHVpbnQyNTYgaW5kZXhlZCBzZWN0b3JJRCwgdWludDI1NiB0aW1lKTsKCiAgICBldmVudCBSZXN1bHQodWludDI1NiBpbmRleGVkIHNoaXBJZCwgdWludDI1NiBpbmRleGVkIHNlY3RvcklEKTsKCiAgICAvKioqIENPTlNUQU5UUyAqKiovCgogICAgLy8gQW4gYXBwcm94aW1hdGlvbiBvZiBjdXJyZW50bHkgaG93IG1hbnkgc2Vjb25kcyBhcmUgaW4gYmV0d2VlbiBibG9ja3MuCiAgICB1aW50MjU2IHB1YmxpYyBzZWNvbmRzUGVyQmxvY2sgPSAxNTsKCiAgICB1aW50MjU2IHB1YmxpYyBUSUNLX1RJTUUgPSAxNTsgLy8gdGltZSBpcyBhbHdheXMgaW4gbWludXRlcwoKICAgIC8vIGV4cGxvcmF0aW9uIGZlZQogICAgdWludDI1NiBwdWJsaWMgcGVyY2VudGFnZUN1dCAgPSA5MDsKICAgIHVpbnQyNTYgcHVibGljIG9yYWNsZUZlZSAgICAgID0gMjAwMDAwMDsgLy8gd2VpCiAgICB1aW50MjU2IHB1YmxpYyBzZWN0b3JPd25lckN1dCA9IDAuMDEgZXRoZXI7CgogICAgaW50MjU2IHB1YmxpYyBTUEVFRF9TVEFUX01BWCA9IDMwOwogICAgaW50MjU2IHB1YmxpYyBSQU5HRV9TVEFUX01BWCA9IDIwOwogICAgaW50MjU2IHB1YmxpYyBNSU5fVElNRV9FWFBMT1JFID0gNjA7CiAgICBpbnQyNTYgcHVibGljIE1BWF9USU1FX0VYUExPUkUgPSAyMTYwOwogICAgaW50MjU2IHB1YmxpYyBSQU5HRV9TQ0FMRSA9IDI7CgogICAgLy8vIEBkZXYgU2VjdG9yIHN0YXRzCiAgICBlbnVtIFNlY3RvclN0YXRzIHtWb2x1bWUsIFRocmVhdCwgRGlmZmljdWx0eX0KCiAgICAvLy8gQGRldiBob2xkIGFsbCBzaGlwcyBpbiBleHBsb3JhdGlvbgogICAgdWludDI1NltdIGV4cGxvcmVyczsKCiAgICAvLy8gQGRldiBBIG1hcHBpbmcgZnJvbSBBc3NldCBVbmlxdWVJRHMgdG8gdGhlIGV4cGxvcmF0aW9uIGluZGV4LgogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBpbnRlcm5hbCB0b2tlbkluZGV4VG9FeHBsb3JlOwoKICAgIC8vLyBAZGV2IEEgbWFwcGluZyBmcm9tIEFzc2V0IFVuaXF1ZUlEcyB0byB0aGUgc2VjdG9yIHRva2VuIGlkLgogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBpbnRlcm5hbCB0b2tlbkluZGV4VG9TZWN0b3I7CgogICAgLy8vIEBkZXYgR2V0IGEgbGlzdCBvZiBzaGlwIGV4cGxvcmluZyBvdXIgdW5pdmVyc2UKICAgIGZ1bmN0aW9uIGdldEV4cGxvcmVyTGlzdCgpIHB1YmxpYyB2aWV3IHJldHVybnMoCiAgICAgICAgdWludDI1Nls0XVtdCiAgICApIHsKICAgICAgICB1aW50MjU2WzRdW10gbWVtb3J5IHRva2VucyA9IG5ldyB1aW50MjU2WzRdW10oZXhwbG9yZXJzLmxlbmd0aCk7CiAgICAgICAgdWludDI1NiBpbmRleCA9IDA7CiAgICAgICAgdWludDE2IElEOwogICAgICAgIHVpbnQ4IHN0YXRlOwoKICAgICAgICBmb3IodWludDI1NiBpID0gMDsgaSA8IGV4cGxvcmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoZXhwbG9yZXJzW2ldICE9IDApIHsKICAgICAgICAgICAgICAgIChJRCwsc3RhdGUsLCwsLCkgPSBldGhlcm5hdXRzU3RvcmFnZS5hc3NldHMoZXhwbG9yZXJzW2ldKTsKICAgICAgICAgICAgICAgIHRva2Vuc1tpbmRleF1bMF0gPSBleHBsb3JlcnNbaV07CiAgICAgICAgICAgICAgICB0b2tlbnNbaW5kZXhdWzFdID0gSUQ7CiAgICAgICAgICAgICAgICB0b2tlbnNbaW5kZXhdWzJdID0gc3RhdGU7CiAgICAgICAgICAgICAgICB0b2tlbnNbaW5kZXhdWzNdID0gdG9rZW5JbmRleFRvU2VjdG9yW2V4cGxvcmVyc1tpXV07CgogICAgICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGluZGV4ID09IDApIHsKICAgICAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1Nls0XVtdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0b2tlbnM7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldFRpY2tUaW1lKHVpbnQyNTYgX3RpY2tUaW1lKSBleHRlcm5hbCBvbmx5Q0xldmVsIHsKICAgICAgICBUSUNLX1RJTUUgPSBfdGlja1RpbWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0U2VjdG9yT3duZXJDdXQodWludDI1NiBfc2VjdG9yT3duZXJDdXQpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIHNlY3Rvck93bmVyQ3V0ID0gX3NlY3Rvck93bmVyQ3V0OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE9yYWNsZUZlZSh1aW50MjU2IF9vcmFjbGVGZWUpIGV4dGVybmFsIG9ubHlDTGV2ZWwgewogICAgICAgIG9yYWNsZUZlZSA9IF9vcmFjbGVGZWU7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0UGVyY2VudGFnZUN1dCh1aW50MjU2IF9wZXJjZW50YWdlQ3V0KSBleHRlcm5hbCBvbmx5Q0xldmVsIHsKICAgICAgICBwZXJjZW50YWdlQ3V0ID0gX3BlcmNlbnRhZ2VDdXQ7CiAgICB9CgoKICAgIC8vLyBAbm90aWNlIEV4cGxvcmUgYSBzZWN0b3Igd2l0aCBhIGRlZmluZWQgc2hpcC4gU2VjdG9ycyBjb250YWluIGEgbGlzdCBvZiBPYmplY3RzIHRoYXQgY2FuIGJlIGdpdmVuIHRvIHRoZSBwbGF5ZXJzCiAgICAvLy8gd2hlbiBleHBsb3JpbmcuIEVhY2ggZW50cnkgaGFzIGEgRHJvcCBSYXRlIGFuZCBhcmUgc29ydGVkIGJ5IFNlY3RvciBJRCBhbmQgRHJvcCByYXRlLgogICAgLy8vIFRoZSBkcm9wIHJhdGUgaXMgYSB3aG9sZSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLDAwMCwwMDAuIDAgaXMgMCUgYW5kIDEsMDAwLDAwMCBpcyAxMDAlLgogICAgLy8vIEV2ZXJ5IHRpbWUgYSBTZWN0b3IgaXMgZXhwbG9yZWQgYSByYW5kb20gbnVtYmVyIGJldHdlZW4gMCBhbmQgMSwwMDAsMDAwIGlzIGNhbGN1bGF0ZWQgZm9yIGVhY2ggYXZhaWxhYmxlIE9iamVjdC4KICAgIC8vLyBJZiB0aGUgZmluYWwgcmVzdWx0IGlzIGxvd2VyIHRoYW4gdGhlIERyb3AgUmF0ZSBvZiB0aGUgT2JqZWN0LCB0aGF0IE9iamVjdCB3aWxsIGJlIHJld2FyZGVkIHRvIHRoZSBwbGF5ZXIgb25jZQogICAgLy8vIEV4cGxvcmF0aW9uIGlzIGNvbXBsZXRlLiBPbmx5IDEgdG8gNSBPYmplY3RzIG1heGltdW0gY2FuIGJlIGRyb3BwZWQgZHVyaW5nIG9uZSBleHBsb3JhdGlvbi4KICAgIC8vLyAoRlVUVVJFIFZFUlNJT05TKSBUaGUgZmluYWwgbnVtYmVyIHdpbGwgYmUgYWZmZWN0ZWQgYnkgdGhlIHVzZXLigJlzIFNoaXAgU3RhdHMuCiAgICAvLy8gQHBhcmFtIF9zaGlwVG9rZW5JZCBUaGUgVG9rZW4gSUQgdGhhdCByZXByZXNlbnRzIGEgc2hpcCBhbmQgY2FuIGV4cGxvcmUKICAgIC8vLyBAcGFyYW0gX3NlY3RvclRva2VuSWQgVGhlIFRva2VuIElEIHRoYXQgcmVwcmVzZW50cyBhIHNlY3RvciBhbmQgY2FuIGJlIGV4cGxvcmVkCiAgICBmdW5jdGlvbiBleHBsb3JlKHVpbnQyNTYgX3NoaXBUb2tlbklkLCB1aW50MjU2IF9zZWN0b3JUb2tlbklkKSBwYXlhYmxlIGV4dGVybmFsIHdoZW5Ob3RQYXVzZWQgewogICAgICAgIC8vIGNoYXJnZSBhIGZlZSBmb3IgZWFjaCBleHBsb3JhdGlvbiB3aGVuIHRoZSByZXN1bHRzIGFyZSByZWFkeQogICAgICAgIHJlcXVpcmUobXNnLnZhbHVlID49IHNlY3Rvck93bmVyQ3V0KTsKCiAgICAgICAgLy8gY2hlY2sgaWYgQXNzZXQgaXMgYSBzaGlwIG9yIG5vdAogICAgICAgIHJlcXVpcmUoZXRoZXJuYXV0c1N0b3JhZ2UuaXNDYXRlZ29yeShfc2hpcFRva2VuSWQsIHVpbnQ4KEFzc2V0Q2F0ZWdvcnkuU2hpcCkpKTsKCiAgICAgICAgLy8gY2hlY2sgaWYgX3NlY3RvclRva2VuSWQgaXMgYSBzZWN0b3Igb3Igbm90CiAgICAgICAgcmVxdWlyZShldGhlcm5hdXRzU3RvcmFnZS5pc0NhdGVnb3J5KF9zZWN0b3JUb2tlbklkLCB1aW50OChBc3NldENhdGVnb3J5LlNlY3RvcikpKTsKCiAgICAgICAgLy8gRW5zdXJlIHRoZSBTaGlwIGlzIGluIGF2YWlsYWJsZSBzdGF0ZSwgb3RoZXJ3aXNlIGl0IGNhbm5vdCBleHBsb3JlCiAgICAgICAgcmVxdWlyZShldGhlcm5hdXRzU3RvcmFnZS5pc1N0YXRlKF9zaGlwVG9rZW5JZCwgdWludDgoQXNzZXRTdGF0ZS5BdmFpbGFibGUpKSk7CgogICAgICAgIC8vIHNoaXAgY291bGQgbm90IGJlIGluIGV4cGxvcmF0aW9uCiAgICAgICAgcmVxdWlyZSghaXNFeHBsb3JpbmcoX3NoaXBUb2tlbklkKSk7CgogICAgICAgIC8vIGNoZWNrIGlmIGV4cGxvcmVyIGlzIHNoaXAgb3duZXIKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZXRoZXJuYXV0c1N0b3JhZ2Uub3duZXJPZihfc2hpcFRva2VuSWQpKTsKCiAgICAgICAgLy8gY2hlY2sgaWYgb3duZXIgc2VjdG9yIGlzIG5vdCBlbXB0eQogICAgICAgIGFkZHJlc3Mgc2VjdG9yT3duZXIgPSBldGhlcm5hdXRzU3RvcmFnZS5vd25lck9mKF9zZWN0b3JUb2tlbklkKTsKICAgICAgICByZXF1aXJlKHNlY3Rvck93bmVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLy8gbWFyayBhcyBleHBsb3JpbmcKICAgICAgICB0b2tlbkluZGV4VG9FeHBsb3JlW19zaGlwVG9rZW5JZF0gPSBleHBsb3JlcnMucHVzaChfc2hpcFRva2VuSWQpIC0gMTsKICAgICAgICB0b2tlbkluZGV4VG9TZWN0b3JbX3NoaXBUb2tlbklkXSA9IF9zZWN0b3JUb2tlbklkOwoKICAgICAgICB1aW50OFtTVEFUU19TSVpFXSBtZW1vcnkgX3NoaXBTdGF0cyA9IGV0aGVybmF1dHNTdG9yYWdlLmdldFN0YXRzKF9zaGlwVG9rZW5JZCk7CiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gbWVtb3J5IF9zZWN0b3JTdGF0cyA9IGV0aGVybmF1dHNTdG9yYWdlLmdldFN0YXRzKF9zZWN0b3JUb2tlbklkKTsKCiAgICAgICAgLy8vIHNldCBleHBsb3JhdGlvbiB0aW1lCiAgICAgICAgdWludDI1NiB0aW1lID0gdWludDI1NihfZXhwbG9yYXRpb25UaW1lKAogICAgICAgICAgICAgICAgX3NoaXBTdGF0c1t1aW50MjU2KFNoaXBTdGF0cy5SYW5nZSldLAogICAgICAgICAgICAgICAgX3NoaXBTdGF0c1t1aW50MjU2KFNoaXBTdGF0cy5TcGVlZCldLAogICAgICAgICAgICAgICAgX3NlY3RvclN0YXRzW3VpbnQyNTYoU2VjdG9yU3RhdHMuVm9sdW1lKV0KICAgICAgICAgICAgKSk7CiAgICAgICAgLy8gZXhwbG9yYXRpb24gdGltZSBpbiBtaW51dGVzIGNvbnZlcnRlZCB0byBzZWNvbmRzCiAgICAgICAgdGltZSAqPSA2MDsKCiAgICAgICAgdWludDY0IF9jb29sZG93bkVuZEJsb2NrID0gdWludDY0KCh0aW1lL3NlY29uZHNQZXJCbG9jaykgKyBibG9jay5udW1iZXIpOwogICAgICAgIGV0aGVybmF1dHNTdG9yYWdlLnNldEFzc2V0Q29vbGRvd24oX3NoaXBUb2tlbklkLCBub3cgKyB0aW1lLCBfY29vbGRvd25FbmRCbG9jayk7CgogICAgICAgIC8vIHRvIGF2b2lkIG1pc3Rha2VzIGFuZCBjaGFyZ2UgdW5uZWNlc3NhcnkgZXh0cmEgZmVlcwogICAgICAgIHVpbnQyNTYgZmVlRXhjZXNzID0gU2FmZU1hdGguc3ViKG1zZy52YWx1ZSwgc2VjdG9yT3duZXJDdXQpOwogICAgICAgIHVpbnQyNTYgcGF5bWVudCA9IHVpbnQyNTYoU2FmZU1hdGguZGl2KFNhZmVNYXRoLm11bChtc2cudmFsdWUsIHBlcmNlbnRhZ2VDdXQpLCAxMDApKSAtIG9yYWNsZUZlZTsKCiAgICAgICAgLy8vIGVtaXQgc2lnbmFsIHRvIGFueW9uZSBsaXN0ZW5pbmcgaW4gdGhlIHVuaXZlcnNlCiAgICAgICAgRXhwbG9yZShfc2hpcFRva2VuSWQsIF9zZWN0b3JUb2tlbklkLCBub3cgKyB0aW1lKTsKCiAgICAgICAgLy8ga2VlcGluZyBvcmFjbGUgYWNjb3VudHMgd2l0aCBiYWxhbmNlCiAgICAgICAgb3JhY2xlQWRkcmVzcy50cmFuc2ZlcihvcmFjbGVGZWUpOwoKICAgICAgICAvLyBwYXlpbmcgc2VjdG9yIG93bmVyCiAgICAgICAgc2VjdG9yT3duZXIudHJhbnNmZXIocGF5bWVudCk7CgogICAgICAgIC8vIHNlbmQgZXhjZXNzIGJhY2sgdG8gZXhwbG9yZXIKICAgICAgICBtc2cuc2VuZGVyLnRyYW5zZmVyKGZlZUV4Y2Vzcyk7CiAgICB9CgogICAgLy8vIEBub3RpY2UgRXhwbG9yYXRpb24gaXMgY29tcGxldGUgYW5kIDUgT2JqZWN0cyBtYXhpbXVtIHdpbGwgYmUgZHJvcHBlZCBkdXJpbmcgb25lIGV4cGxvcmF0aW9uLgogICAgLy8vIEBwYXJhbSBfc2hpcFRva2VuSWQgVGhlIFRva2VuIElEIHRoYXQgcmVwcmVzZW50cyBhIHNoaXAgYW5kIGNhbiBleHBsb3JlCiAgICAvLy8gQHBhcmFtIF9zZWN0b3JUb2tlbklkIFRoZSBUb2tlbiBJRCB0aGF0IHJlcHJlc2VudHMgYSBzZWN0b3IgYW5kIGNhbiBiZSBleHBsb3JlZAogICAgLy8vIEBwYXJhbSBfSURzIHRoYXQgcmVwcmVzZW50cyBhIG9iamVjdCByZXR1cm5lZCBmcm9tIGV4cGxvcmF0aW9uCiAgICAvLy8gQHBhcmFtIF9hdHRyaWJ1dGVzIHRoYXQgcmVwcmVzZW50cyBhdHRyaWJ1dGVzIGZvciBlYWNoIG9iamVjdCByZXR1cm5lZCBmcm9tIGV4cGxvcmF0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0cyB0aGF0IHJlcHJlc2VudHMgYWxsIHN0YXRzIGZvciBlYWNoIG9iamVjdCByZXR1cm5lZCBmcm9tIGV4cGxvcmF0aW9uCiAgICBmdW5jdGlvbiBleHBsb3JhdGlvblJlc3VsdHMoCiAgICAgICAgdWludDI1NiBfc2hpcFRva2VuSWQsCiAgICAgICAgdWludDI1NiBfc2VjdG9yVG9rZW5JZCwKICAgICAgICB1aW50MTZbNV0gX0lEcywKICAgICAgICB1aW50OFs1XSBfYXR0cmlidXRlcywKICAgICAgICB1aW50OFtTVEFUU19TSVpFXVs1XSBfc3RhdHMKICAgICkKICAgIGV4dGVybmFsIG9ubHlPcmFjbGUKICAgIHsKICAgICAgICB1aW50MjU2IGNvb2xkb3duOwogICAgICAgIHVpbnQ2NCBjb29sZG93bkVuZEJsb2NrOwogICAgICAgIHVpbnQyNTYgYnVpbHRCeTsKICAgICAgICAoLCwsLCxjb29sZG93bkVuZEJsb2NrLCBjb29sZG93biwgYnVpbHRCeSkgPSBldGhlcm5hdXRzU3RvcmFnZS5hc3NldHMoX3NoaXBUb2tlbklkKTsKCiAgICAgICAgYWRkcmVzcyBvd25lciA9IGV0aGVybmF1dHNTdG9yYWdlLm93bmVyT2YoX3NoaXBUb2tlbklkKTsKICAgICAgICByZXF1aXJlKG93bmVyICE9IGFkZHJlc3MoMCkpOwoKICAgICAgICAvLy8gY3JlYXRlIG9iamVjdHMgcmV0dXJuZWQgZnJvbSBleHBsb3JhdGlvbgogICAgICAgIGZvciAodWludDI1NiBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgICAgICBfYnVpbGRBc3NldCgKICAgICAgICAgICAgICAgIF9zZWN0b3JUb2tlbklkLAogICAgICAgICAgICAgICAgb3duZXIsCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgX0lEc1tpXSwKICAgICAgICAgICAgICAgIHVpbnQ4KEFzc2V0Q2F0ZWdvcnkuT2JqZWN0KSwKICAgICAgICAgICAgICAgIHVpbnQ4KF9hdHRyaWJ1dGVzW2ldKSwKICAgICAgICAgICAgICAgIF9zdGF0c1tpXSwKICAgICAgICAgICAgICAgIGNvb2xkb3duLAogICAgICAgICAgICAgICAgY29vbGRvd25FbmRCbG9jawogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgLy8vIHJlbW92ZSBmcm9tIGV4cGxvcmUgbGlzdAogICAgICAgIGRlbGV0ZSBleHBsb3JlcnNbdG9rZW5JbmRleFRvRXhwbG9yZVtfc2hpcFRva2VuSWRdXTsKICAgICAgICBkZWxldGUgdG9rZW5JbmRleFRvU2VjdG9yW19zaGlwVG9rZW5JZF07CgogICAgICAgIC8vLyBlbWl0IHNpZ25hbCB0byBhbnlvbmUgbGlzdGVuaW5nIGluIHRoZSB1bml2ZXJzZQogICAgICAgIFJlc3VsdChfc2hpcFRva2VuSWQsIF9zZWN0b3JUb2tlbklkKTsKICAgIH0KCiAgICAvLy8gQGRldiBDcmVhdGVzIGEgbmV3IEFzc2V0IHdpdGggdGhlIGdpdmVuIGZpZWxkcy4gT05seSBhdmFpbGFibGUgZm9yIEMgTGV2ZWxzCiAgICAvLy8gQHBhcmFtIF9jcmVhdG9yVG9rZW5JRCBUaGUgYXNzZXQgd2hvIGlzIGZhdGhlciBvZiB0aGlzIGFzc2V0CiAgICAvLy8gQHBhcmFtIF9wcmljZSBhc3NldCBwcmljZQogICAgLy8vIEBwYXJhbSBfYXNzZXRJRCBhc3NldCBJRAogICAgLy8vIEBwYXJhbSBfY2F0ZWdvcnkgc2VlIEFzc2V0IFN0cnVjdCBkZXNjcmlwdGlvbgogICAgLy8vIEBwYXJhbSBfYXR0cmlidXRlcyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9zdGF0cyBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9jb29sZG93biBzZWUgQXNzZXQgU3RydWN0IGRlc2NyaXB0aW9uCiAgICAvLy8gQHBhcmFtIF9jb29sZG93bkVuZEJsb2NrIHNlZSBBc3NldCBTdHJ1Y3QgZGVzY3JpcHRpb24KICAgIGZ1bmN0aW9uIF9idWlsZEFzc2V0KAogICAgICAgIHVpbnQyNTYgX2NyZWF0b3JUb2tlbklELAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQyNTYgX3ByaWNlLAogICAgICAgIHVpbnQxNiBfYXNzZXRJRCwKICAgICAgICB1aW50OCBfY2F0ZWdvcnksCiAgICAgICAgdWludDggX2F0dHJpYnV0ZXMsCiAgICAgICAgdWludDhbU1RBVFNfU0laRV0gX3N0YXRzLAogICAgICAgIHVpbnQyNTYgX2Nvb2xkb3duLAogICAgICAgIHVpbnQ2NCBfY29vbGRvd25FbmRCbG9jawogICAgKQogICAgcHJpdmF0ZSByZXR1cm5zICh1aW50MjU2KQogICAgewogICAgICAgIHVpbnQyNTYgdG9rZW5JRCA9IGV0aGVybmF1dHNTdG9yYWdlLmNyZWF0ZUFzc2V0KAogICAgICAgICAgICBfY3JlYXRvclRva2VuSUQsCiAgICAgICAgICAgIF9vd25lciwKICAgICAgICAgICAgX3ByaWNlLAogICAgICAgICAgICBfYXNzZXRJRCwKICAgICAgICAgICAgX2NhdGVnb3J5LAogICAgICAgICAgICB1aW50OChBc3NldFN0YXRlLkF2YWlsYWJsZSksCiAgICAgICAgICAgIF9hdHRyaWJ1dGVzLAogICAgICAgICAgICBfc3RhdHMsCiAgICAgICAgICAgIF9jb29sZG93biwKICAgICAgICAgICAgX2Nvb2xkb3duRW5kQmxvY2sKICAgICAgICApOwoKICAgICAgICAvLyBlbWl0IHRoZSBidWlsZCBldmVudAogICAgICAgIEJ1aWxkKAogICAgICAgICAgICBfb3duZXIsCiAgICAgICAgICAgIHRva2VuSUQsCiAgICAgICAgICAgIF9hc3NldElELAogICAgICAgICAgICBfcHJpY2UKICAgICAgICApOwoKICAgICAgICByZXR1cm4gdG9rZW5JRDsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBFeHBsb3JhdGlvbiBUaW1lOiBUaGUgdGltZSBpdCB0YWtlcyB0byBleHBsb3JlIGEgU2VjdG9yIGlzIGRlcGVuZGVudCBvbiB0aGUgU2VjdG9yIFZvbHVtZQogICAgLy8vICAgICAgICAgYWxvbmcgd2l0aCB0aGUgU2hpcOKAmXMgUmFuZ2UgYW5kIFNwZWVkLgogICAgLy8vIEBwYXJhbSBfc2hpcFJhbmdlIHNoaXAgcmFuZ2UKICAgIC8vLyBAcGFyYW0gX3NoaXBTcGVlZCBzaGlwIHNwZWVkCiAgICAvLy8gQHBhcmFtIF9zZWN0b3JWb2x1bWUgc2VjdG9yIHZvbHVtZQogICAgZnVuY3Rpb24gX2V4cGxvcmF0aW9uVGltZSgKICAgICAgICB1aW50OCBfc2hpcFJhbmdlLAogICAgICAgIHVpbnQ4IF9zaGlwU3BlZWQsCiAgICAgICAgdWludDggX3NlY3RvclZvbHVtZQogICAgKSBwcml2YXRlIHZpZXcgcmV0dXJucyAoaW50MjU2KSB7CiAgICAgICAgaW50MjU2IG1pblRvRXhwbG9yZSA9IDA7CgogICAgICAgIG1pblRvRXhwbG9yZSA9IFNhZmVNYXRoLm1pbihfc2hpcFNwZWVkLCBTUEVFRF9TVEFUX01BWCkgLSAxOwogICAgICAgIG1pblRvRXhwbG9yZSA9IC03MiAqIG1pblRvRXhwbG9yZTsKICAgICAgICBtaW5Ub0V4cGxvcmUgKz0gTUFYX1RJTUVfRVhQTE9SRTsKCiAgICAgICAgdWludDI1NiBtaW5SYW5nZSA9IHVpbnQyNTYoU2FmZU1hdGgubWluKF9zaGlwUmFuZ2UsIFJBTkdFX1NUQVRfTUFYKSk7CiAgICAgICAgdWludDI1NiBzY2FsZWRSYW5nZSA9IHVpbnQyNTYoUkFOR0VfU1RBVF9NQVggKiBSQU5HRV9TQ0FMRSk7CiAgICAgICAgaW50MjU2IG1pbkV4cGxvcmUgPSAobWluVG9FeHBsb3JlIC0gTUlOX1RJTUVfRVhQTE9SRSk7CgogICAgICAgIG1pblRvRXhwbG9yZSAtPSBmcmFjdGlvbihtaW5FeHBsb3JlLCBpbnQyNTYobWluUmFuZ2UpLCBpbnQyNTYoc2NhbGVkUmFuZ2UpKTsKICAgICAgICBtaW5Ub0V4cGxvcmUgKz0gZnJhY3Rpb24obWluVG9FeHBsb3JlLCAoX3NlY3RvclZvbHVtZSAtIDEwKSwgMTApOwogICAgICAgIG1pblRvRXhwbG9yZSA9IFNhZmVNYXRoLm1heChtaW5Ub0V4cGxvcmUsIE1JTl9USU1FX0VYUExPUkUpOwoKICAgICAgICByZXR1cm4gbWluVG9FeHBsb3JlOwogICAgfQoKICAgIC8vLyBAbm90aWNlIGNhbGNzIGEgcGVyYyB3aXRob3V0IGZsb2F0IG9yIGRvdWJsZSA6KAogICAgZnVuY3Rpb24gZnJhY3Rpb24oaW50MjU2IF9zdWJqZWN0LCBpbnQyNTYgX251bWVyYXRvciwgaW50MjU2IF9kZW5vbWluYXRvcikKICAgIHByaXZhdGUgcHVyZSByZXR1cm5zIChpbnQyNTYpIHsKICAgICAgICBpbnQyNTYgZGl2aXNpb24gPSBfc3ViamVjdCAqIF9udW1lcmF0b3IgLSBfc3ViamVjdCAqIF9kZW5vbWluYXRvcjsKICAgICAgICBpbnQyNTYgdG90YWwgPSBfc3ViamVjdCAqIF9kZW5vbWluYXRvciArIGRpdmlzaW9uOwogICAgICAgIHJldHVybiB0b3RhbCAvIF9kZW5vbWluYXRvcjsKICAgIH0KCiAgICAvLy8gQG5vdGljZSBBbnkgQy1sZXZlbCBjYW4gZml4IGhvdyBtYW55IHNlY29uZHMgcGVyIGJsb2NrcyBhcmUgY3VycmVudGx5IG9ic2VydmVkLgogICAgLy8vIEBwYXJhbSBfc2VjcyBUaGUgc2Vjb25kcyBwZXIgYmxvY2sKICAgIGZ1bmN0aW9uIHNldFNlY29uZHNQZXJCbG9jayh1aW50MjU2IF9zZWNzKSBleHRlcm5hbCBvbmx5Q0xldmVsIHsKICAgICAgICByZXF1aXJlKF9zZWNzID4gMCk7CiAgICAgICAgc2Vjb25kc1BlckJsb2NrID0gX3NlY3M7CiAgICB9Cn0='.
	

]
