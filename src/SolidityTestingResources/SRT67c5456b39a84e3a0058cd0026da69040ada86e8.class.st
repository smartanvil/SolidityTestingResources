Class {
	#name : #SRT67c5456b39a84e3a0058cd0026da69040ada86e8,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRT67c5456b39a84e3a0058cd0026da69040ada86e8 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuMTE7CgoKCmNvbnRyYWN0IE93bmFibGUgewogIGFkZHJlc3MgcHVibGljIG93bmVyOwoKCiAgLyoqCiAgICogQGRldiBUaGUgT3duYWJsZSBjb25zdHJ1Y3RvciBzZXRzIHRoZSBvcmlnaW5hbCBgb3duZXJgIG9mIHRoZSBjb250cmFjdCB0byB0aGUgc2VuZGVyCiAgICogYWNjb3VudC4KICAgKi8KICBmdW5jdGlvbiBPd25hYmxlKCkgcHVibGljIHsKICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICB9CgoKICAvKioKICAgKiBAZGV2IFRocm93cyBpZiBjYWxsZWQgYnkgYW55IGFjY291bnQgb3RoZXIgdGhhbiB0aGUgb3duZXIuCiAgICovCiAgbW9kaWZpZXIgb25seU93bmVyKCkgewogICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgIF87CiAgfQoKCiAgLyoqCiAgICogQGRldiBBbGxvd3MgdGhlIGN1cnJlbnQgb3duZXIgdG8gdHJhbnNmZXIgY29udHJvbCBvZiB0aGUgY29udHJhY3QgdG8gYSBuZXdPd25lci4KICAgKiBAcGFyYW0gbmV3T3duZXIgVGhlIGFkZHJlc3MgdG8gdHJhbnNmZXIgb3duZXJzaGlwIHRvLgogICAqLwogIGZ1bmN0aW9uIHRyYW5zZmVyT3duZXJzaGlwKGFkZHJlc3MgbmV3T3duZXIpIHB1YmxpYyBvbmx5T3duZXIgewogICAgaWYgKG5ld093bmVyICE9IGFkZHJlc3MoMCkpIHsKICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KICB9Cgp9CgovLy8gQHRpdGxlIEludGVyZmFjZSBmb3IgY29udHJhY3RzIGNvbmZvcm1pbmcgdG8gRVJDLTcyMTogTm9uLUZ1bmdpYmxlIFRva2VucwovLy8gQGF1dGhvciBEaWV0ZXIgU2hpcmxleSA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImMyYTZhN2I2YTc4MmEzYmFhYmFkYWZiOGE3YWNlY2ExYWQiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PiAoaHR0cHM6Ly9naXRodWIuY29tL2RldGUpCmNvbnRyYWN0IEVSQzcyMSB7CiAgICAvLyBSZXF1aXJlZCBtZXRob2RzCiAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgdG90YWwpOwogICAgZnVuY3Rpb24gYmFsYW5jZU9mKGFkZHJlc3MgX293bmVyKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50MjU2IGJhbGFuY2UpOwogICAgZnVuY3Rpb24gb3duZXJPZih1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGFkZHJlc3Mgb3duZXIpOwogICAgZnVuY3Rpb24gYXBwcm92ZShhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIF90bywgdWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWw7CiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsOwoKICAgIC8vIEV2ZW50cwogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50MjU2IHRva2VuSWQpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBvd25lciwgYWRkcmVzcyBhcHByb3ZlZCwgdWludDI1NiB0b2tlbklkKTsKCiAgICAvLyBPcHRpb25hbAogICAgLy8gZnVuY3Rpb24gbmFtZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBuYW1lKTsKICAgIC8vIGZ1bmN0aW9uIHN5bWJvbCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHN0cmluZyBzeW1ib2wpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5zT2ZPd25lcihhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgdmlldyByZXR1cm5zICh1aW50MjU2W10gdG9rZW5JZHMpOwogICAgLy8gZnVuY3Rpb24gdG9rZW5NZXRhZGF0YSh1aW50MjU2IF90b2tlbklkLCBzdHJpbmcgX3ByZWZlcnJlZFRyYW5zcG9ydCkgcHVibGljIHZpZXcgcmV0dXJucyAoc3RyaW5nIGluZm9VcmwpOwoKICAgIC8vIEVSQy0xNjUgQ29tcGF0aWJpbGl0eSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzE2NSkKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCk7Cn0KCgoKCgoKCgoKCgpjb250cmFjdCBNb25zdGVyQWNjZXNzQ29udHJvbCB7CgogICAgZXZlbnQgQ29udHJhY3RVcGdyYWRlKGFkZHJlc3MgbmV3Q29udHJhY3QpOwoKICAgICAvLyBUaGUgYWRkcmVzc2VzIG9mIHRoZSBhY2NvdW50cyAob3IgY29udHJhY3RzKSB0aGF0IGNhbiBleGVjdXRlIGFjdGlvbnMgd2l0aGluIGVhY2ggcm9sZXMuCiAgICBhZGRyZXNzIHB1YmxpYyBhZG1pbkFkZHJlc3M7CiAgICAKCiAgCgogICAgLy8vIEBkZXYgQWNjZXNzIG1vZGlmaWVyIGZvciBDRU8tb25seSBmdW5jdGlvbmFsaXR5CiAgICBtb2RpZmllciBvbmx5QWRtaW4oKSB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IGFkbWluQWRkcmVzcyk7CiAgICAgICAgXzsKICAgIH0KCiAgCgogICAgCn0KCi8vIFRoaXMgY29udHJhY3Qgc3RvcmVzIGFsbCBkYXRhIG9uIHRoZSBibG9ja2NoYWluCi8vIG9ubHkgb3VyIG90aGVyIGNvbnRyYWN0cyBjYW4gaW50ZXJhY3Qgd2l0aCB0aGlzCi8vIHRoZSBkYXRhIGhlcmUgd2lsbCBiZSB2YWxpZCBmb3IgYWxsIGV0ZXJuaXR5IGV2ZW4gaWYgb3RoZXIgY29udHJhY3RzIGdldCB1cGRhdGVkCi8vIHRoaXMgd2F5IHdlIGNhbiBtYWtlIHN1cmUgdGhhdCBvdXIgTW9uc3RlcnMgaGF2ZSBhIGhhcmQtY29kZWQgdmFsdWUgYXR0YWNoZWQgdG8gdGhlbQovLyB0aGF0IG5vIG9uZSBpbmNsdWRpbmcgdXMgY2FuIGNoYW5nZSghKQpjb250cmFjdCBNb25zdGVyc0RhdGEgewoKICAgIGFkZHJlc3MgY29yZUNvbnRyYWN0OyAvLyAKICAgIAoKCiAgICBzdHJ1Y3QgTW9uc3RlciB7CiAgICAgICAgLy8gdGltZXN0YW1wIG9mIGJsb2NrIHdoZW4gdGhpcyBtb25zdGVyIHdhcyBzcGF3bmVkL2NyZWF0ZWQKICAgICAgICB1aW50NjQgYmlydGhUaW1lOwoKICAgICAgICAvLyBnZW5lcmF0aW9uIG51bWJlcgogICAgICAgIC8vIGdlbjAgaXMgdGhlIHZlcnkgZmlyc3QgZ2VuZXJhdGlvbiAtIHRoZSBsYXRlciBtb25zdGVyIHNwYXduIHRoZSBsZXNzIGxpa2VseSB0aGV5IGFyZSB0byBoYXZlCiAgICAgICAgLy8gc3BlY2lhbCBhdHRyaWJ1dGVzIGFuZCBzdGF0cwogICAgICAgLy8gdWludDE2IGdlbmVyYXRpb247CgogICAgICAgIHVpbnQxNiBocDsgLy8gaGVhbHRoIHBvaW50cyAKICAgICAgICB1aW50MTYgYXR0YWNrOyAvLyBhdHRhY2sgcG9pbnRzCiAgICAgICAgdWludDE2IGRlZmVuc2U7IC8vIGRlZmVuc2UgcG9pbnRzCiAgICAgICAgdWludDE2IHNwQXR0YWNrOyAvLyBzcGVjaWFsIGF0dGFjawogICAgICAgIHVpbnQxNiBzcERlZmVuc2U7IC8vIHNwZWNpYWwgZGVmZW5zZQogICAgICAgIHVpbnQxNiBzcGVlZDsgLy8gc3BlZWQgcmVzcG9uc2libGUgb2Ygd2hvIGF0dGFja3MgZmlyc3QoISkKICAgICAgICAKCiAgICAgICAgdWludDE2IHR5cGVPbmU7CiAgICAgICAgdWludDE2IHR5cGVUd287CgogICAgICAgIHVpbnQxNiBtSUQ7IC8vIHRoaXMgaWQgKGZyb20gMSB0byAxNTEpIGlzIHJlc3BvbnNpYmxlIGZvciBldmVyeXRoaW5nIHZpc3VhbGx5IGxpa2Ugc2hvd2luZyB0aGUgcmVhbCBkZWFsIQogICAgICAgIGJvb2wgdHJhZGVhYmxlOwogICAgICAgIC8vdWludDE2IHVJRDsgLy8gdW5pcXVlIGlkCiAgICAgICAgCiAgICAgICAgLy8gVGhlc2UgYXR0cmlidXRlcyBhcmUgaGFuZGxlZCBieSBtYXBwaW5ncyBzaW5jZSB0aGV5IHdvdWxkIG92ZXJmbG93IHRoZSBtYXhpbXVtIHN0YWNrCiAgICAgICAgLy9ib29sIGZlbWFsZQogICAgICAgIC8vIHN0cmluZyBuaWNrbmFtZQogICAgICAgIAoKICAgIH0KCiAgICAvLyBsdjEgYmFzZSBzdGF0cwogICAgc3RydWN0IE1vbnN0ZXJCYXNlU3RhdHMgewogICAgICAgIHVpbnQxNiBocDsKICAgICAgICB1aW50MTYgYXR0YWNrOwogICAgICAgIHVpbnQxNiBkZWZlbnNlOwogICAgICAgIHVpbnQxNiBzcEF0dGFjazsKICAgICAgICB1aW50MTYgc3BEZWZlbnNlOwogICAgICAgIHVpbnQxNiBzcGVlZDsKICAgICAgICAKICAgIH0KCiAgICAvLyBsb21vbnN0ZXJpb24gc3RydWN0IHVzZWQgZm9yIHRyYXZlbGxpbmcgYXJvdW5kIHRoZSAid29ybGQiCiAgICAvLyAKICAgIHN0cnVjdCBBcmVhIHsKICAgICAgICAvLyBhcmVhSUQgdXNlZCBpbi1lbmdpbmUgdG8gZGV0ZXJtaW5lIHdvcmxkIHBvc2l0aW9uCiAgICAgICAKICAgICAgICAgICAgIAogICAgICAgIC8vIG1pbmltdW0gbGV2ZWwgdG8gZW50ZXIgdGhpcyBhcmVhLi4uCiAgICAgICAgdWludDE2IG1pbkxldmVsOwogICAgfQoKICAgIHN0cnVjdCBUcmFpbmVyIHsKICAgICAgICAvLyB0aW1lc3RhbXAgb2YgYmxvY2sgd2hlbiB0aGlzIHBsYXllci90cmFpbmVyIHdhcyBjcmVhdGVkCiAgICAgICAgdWludDY0IGJpcnRoVGltZTsKICAgICAgICAKICAgICAgICAvLyBhZGQgdXNlcm5hbWUKICAgICAgICBzdHJpbmcgdXNlcm5hbWU7CiAgICAgICAKICAgICAgICAKICAgICAgICAvLyBjdXJyZW50IGFyZWEgaW4gdGhlICJ3b3JsZCIKICAgICAgICB1aW50MTYgY3VyckFyZWE7CiAgICAgICAgCiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICAKICAgICAgIAogICAgICAgIAogICAgfQoKCiAgIAoKCiAgICAvLyB0YWtlIHRpbWVzdGFtcCBvZiBibG9jayB0aGlzIGdhbWUgd2FzIGNyZWF0ZWQgb24gdGhlIGJsb2NrY2hhaW4KICAgIHVpbnQ2NCBjcmVhdGlvbkJsb2NrID0gdWludDY0KG5vdyk7CiAgIAogICAKCiAgIAogIAogICAgCgoKICAgIAogIAogICAgICAgIAoKCn0KCgoKCmNvbnRyYWN0IE1vbnN0ZXJzQmFzZSBpcyBNb25zdGVyQWNjZXNzQ29udHJvbCwgTW9uc3RlcnNEYXRhIHsKCiAgICAvLy8gQGRldiBUcmFuc2ZlciBldmVudCBhcyBkZWZpbmVkIGluIGN1cnJlbnQgZHJhZnQgb2YgRVJDNzIxLiBFbWl0dGVkIGV2ZXJ5IHRpbWUgYSBtb25zdGVyCiAgICAvLy8gIG93bmVyc2hpcCBpcyBhc3NpZ25lZCwgaW5jbHVkaW5nIGJpcnRocy4KICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgZnJvbSwgYWRkcmVzcyB0bywgdWludDI1NiB0b2tlbklkKTsKCiAgICBib29sIGxvY2tlZE1vbnN0ZXJDcmVhdG9yID0gZmFsc2U7CgogICAgTW9uc3RlckF1Y3Rpb24gcHVibGljIG1vbnN0ZXJBdWN0aW9uOwoKICAgIE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlIHB1YmxpYyBtb25zdGVyQ3JlYXRvcjsKCgogICAgZnVuY3Rpb24gc2V0TW9uc3RlckNyZWF0b3JBZGRyZXNzKGFkZHJlc3MgX2FkZHJlc3MpIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAgLy8gb25seSBzZXQgdGhpcyBvbmNlIHNvIHdlICh0aGUgZGV2cykgY2FuJ3QgY2hlYXQhCiAgICAgICAgcmVxdWlyZSghbG9ja2VkTW9uc3RlckNyZWF0b3IpOwogICAgICAgIE1vbnN0ZXJDcmVhdG9ySW50ZXJmYWNlIGNhbmRpZGF0ZUNvbnRyYWN0ID0gTW9uc3RlckNyZWF0b3JJbnRlcmZhY2UoX2FkZHJlc3MpOwoKICAgICAgIAoKICAgICAgICBtb25zdGVyQ3JlYXRvciA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgICAgIGxvY2tlZE1vbnN0ZXJDcmVhdG9yID0gdHJ1ZTsKCiAgICB9CiAgICAKICAgIC8vIEFuIGFwcHJveGltYXRpb24gb2YgY3VycmVudGx5IGhvdyBtYW55IHNlY29uZHMgYXJlIGluIGJldHdlZW4gYmxvY2tzLgogICAgdWludDI1NiBwdWJsaWMgc2Vjb25kc1BlckJsb2NrID0gMTU7CiAgCgogICAgLy8gYXJyYXkgY29udGFpbmluZyBhbGwgbW9uc3RlcnMgaW4gZXhpc3RlbmNlCiAgICBNb25zdGVyW10gbW9uc3RlcnM7CgogICAgdWludDhbXSBhcmVhczsKCiAgICB1aW50OCBhcmVhSW5kZXggPSAwOwogICAgCgoKICAgICAgbWFwcGluZyhhZGRyZXNzID0+IFRyYWluZXIpIHB1YmxpYyBhZGRyZXNzVG9UcmFpbmVyOwogICAgCgogICAgLy8vIEBkZXYgQSBtYXBwaW5nIGZyb20gbW9uc3RlciBJRHMgdG8gdGhlIGFkZHJlc3MgdGhhdCBvd25zIHRoZW0uIEFsbCBtb25zdGVyIGhhdmUKICAgIC8vLyAgc29tZSB2YWxpZCBvd25lciBhZGRyZXNzLCBldmVuIGdlbjAgbW9uc3RlciBhcmUgY3JlYXRlZCB3aXRoIGEgbm9uLXplcm8gb3duZXIuCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGFkZHJlc3MpIHB1YmxpYyBtb25zdGVySW5kZXhUb093bmVyOwoKICAgIC8vIEBkZXYgQSBtYXBwaW5nIGZyb20gb3duZXIgYWRkcmVzcyB0byBjb3VudCBvZiB0b2tlbnMgdGhhdCBhZGRyZXNzIG93bnMuCiAgICAvLyAgVXNlZCBpbnRlcm5hbGx5IGluc2lkZSBiYWxhbmNlT2YoKSB0byByZXNvbHZlIG93bmVyc2hpcCBjb3VudC4KICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1Nikgb3duZXJzaGlwVG9rZW5Db3VudDsKCgogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgbW9uc3RlckluZGV4VG9BcHByb3ZlZDsKICAgIAogICAgbWFwcGluZyAodWludDI1NiA9PiBzdHJpbmcpIHB1YmxpYyBtb25zdGVySWRUb05pY2tuYW1lOwogICAgCiAgICBtYXBwaW5nICh1aW50MjU2ID0+IGJvb2wpIHB1YmxpYyBtb25zdGVySWRUb1RyYWRlYWJsZTsKICAgIAogICAgbWFwcGluZyAodWludDI1NiA9PiB1aW50MjU2KSBwdWJsaWMgbW9uc3RlcklkVG9HZW5lcmF0aW9uOwoKCiAgICAgbWFwcGluZyAodWludDI1NiA9PiBNb25zdGVyQmFzZVN0YXRzKSBwdWJsaWMgYmFzZVN0YXRzOwoKICAgICBtYXBwaW5nICh1aW50MjU2ID0+IHVpbnQ4WzddKSBwdWJsaWMgbW9uc3RlcklkVG9JVnM7CiAgICAKCgogICAgLy8gYWRkcyBuZXcgYXJlYSB0byB3b3JsZCAKICAgIGZ1bmN0aW9uIF9jcmVhdGVBcmVhKCkgaW50ZXJuYWwgewogICAgICAgICAgICAKICAgICAgICAgICAgYXJlYUluZGV4Kys7CiAgICAgICAgICAgIGFyZWFzLnB1c2goYXJlYUluZGV4KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgIH0KCiAgICAKCgogICAgZnVuY3Rpb24gX2NyZWF0ZU1vbnN0ZXIoCiAgICAgICAgdWludDI1NiBfZ2VuZXJhdGlvbiwKICAgICAgICB1aW50MjU2IF9ocCwKICAgICAgICB1aW50MjU2IF9hdHRhY2ssCiAgICAgICAgdWludDI1NiBfZGVmZW5zZSwKICAgICAgICB1aW50MjU2IF9zcEF0dGFjaywKICAgICAgICB1aW50MjU2IF9zcERlZmVuc2UsCiAgICAgICAgdWludDI1NiBfc3BlZWQsCiAgICAgICAgdWludDI1NiBfdHlwZU9uZSwKICAgICAgICB1aW50MjU2IF90eXBlVHdvLAogICAgICAgIGFkZHJlc3MgX293bmVyLAogICAgICAgIHVpbnQyNTYgX21JRCwKICAgICAgICBib29sIHRyYWRlYWJsZQogICAgICAgIAogICAgKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludCkKICAgICAgICB7CiAgICAgICAgICAgCgogICAgICAgICAgICBNb25zdGVyIG1lbW9yeSBfbW9uc3RlciA9IE1vbnN0ZXIoewogICAgICAgICAgICAgICAgYmlydGhUaW1lOiB1aW50NjQobm93KSwKICAgICAgICAgICAgICAgIGhwOiB1aW50MTYoX2hwKSwKICAgICAgICAgICAgICAgIGF0dGFjazogdWludDE2KF9hdHRhY2spLAogICAgICAgICAgICAgICAgZGVmZW5zZTogdWludDE2KF9kZWZlbnNlKSwKICAgICAgICAgICAgICAgIHNwQXR0YWNrOiB1aW50MTYoX3NwQXR0YWNrKSwKICAgICAgICAgICAgICAgIHNwRGVmZW5zZTogdWludDE2KF9zcERlZmVuc2UpLAogICAgICAgICAgICAgICAgc3BlZWQ6IHVpbnQxNihfc3BlZWQpLAogICAgICAgICAgICAgICAgdHlwZU9uZTogdWludDE2KF90eXBlT25lKSwKICAgICAgICAgICAgICAgIHR5cGVUd286IHVpbnQxNihfdHlwZVR3byksCiAgICAgICAgICAgICAgICBtSUQ6IHVpbnQxNihfbUlEKSwKICAgICAgICAgICAgICAgIHRyYWRlYWJsZTogdHJhZGVhYmxlCiAgICAgICAgICAgICAgICAKCgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdWludDI1NiBuZXdNb25zdGVySWQgPSBtb25zdGVycy5wdXNoKF9tb25zdGVyKSAtIDE7CiAgICAgICAgICAgIG1vbnN0ZXJJZFRvVHJhZGVhYmxlW25ld01vbnN0ZXJJZF0gPSB0cmFkZWFibGU7CiAgICAgICAgICAgIG1vbnN0ZXJJZFRvR2VuZXJhdGlvbltuZXdNb25zdGVySWRdID0gX2dlbmVyYXRpb247CiAgICAgICAgICAgCgogICAgICAgICAgICByZXF1aXJlKG5ld01vbnN0ZXJJZCA9PSB1aW50MjU2KHVpbnQzMihuZXdNb25zdGVySWQpKSk7CiAgICAgICAgICAgIAogICAgICAgICAgIAogICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAgbW9uc3RlcklkVG9OaWNrbmFtZVtuZXdNb25zdGVySWRdID0gIiI7CgogICAgICAgICAgICBfdHJhbnNmZXIoMCwgX293bmVyLCBuZXdNb25zdGVySWQpOwoKICAgICAgICAgICAgcmV0dXJuIG5ld01vbnN0ZXJJZDsKCgogICAgICAgIH0KICAgIAogICAgZnVuY3Rpb24gX2NyZWF0ZVRyYWluZXIoc3RyaW5nIF91c2VybmFtZSwgdWludDE2IF9zdGFydGVySWQsIGFkZHJlc3MgX293bmVyKQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludCBtb24pCiAgICAgICAgewogICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgICAgVHJhaW5lciBtZW1vcnkgX3RyYWluZXIgPSBUcmFpbmVyKHsKICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBiaXJ0aFRpbWU6IHVpbnQ2NChub3cpLAogICAgICAgICAgICAgICAgdXNlcm5hbWU6IHN0cmluZyhfdXNlcm5hbWUpLAogICAgICAgICAgICAgICAgY3VyckFyZWE6IHVpbnQxNigxKSwgLy8gc2V0cyB0byBmaXJzdCBhcmVhISwKICAgICAgICAgICAgICAgIG93bmVyOiBhZGRyZXNzKF9vd25lcikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIHN0YXJ0ZXIgc3RhdHMgYXJlIGhhcmRjb2RlZCEKICAgICAgICAgICAgaWYgKF9zdGFydGVySWQgPT0gMSkgewogICAgICAgICAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzID0gdWludDhbOF0obW9uc3RlckNyZWF0b3IuZ2V0TW9uc3RlclN0YXRzKDEpKTsKICAgICAgICAgICAgICAgIG1vbiA9IF9jcmVhdGVNb25zdGVyKDAsIFN0YXRzWzBdLCBTdGF0c1sxXSwgU3RhdHNbMl0sIFN0YXRzWzNdLCBTdGF0c1s0XSwgU3RhdHNbNV0sIFN0YXRzWzZdLCBTdGF0c1s3XSwgX293bmVyLCAxLCBmYWxzZSk7CiAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgaWYgKF9zdGFydGVySWQgPT0gMikgewogICAgICAgICAgICAgICAgdWludDhbOF0gbWVtb3J5IFN0YXRzMiA9IHVpbnQ4WzhdKG1vbnN0ZXJDcmVhdG9yLmdldE1vbnN0ZXJTdGF0cyg0KSk7CiAgICAgICAgICAgICAgICBtb24gPSBfY3JlYXRlTW9uc3RlcigwLCBTdGF0czJbMF0sIFN0YXRzMlsxXSwgU3RhdHMyWzJdLCBTdGF0czJbM10sIFN0YXRzMls0XSwgU3RhdHMyWzVdLCBTdGF0czJbNl0sIFN0YXRzMls3XSwgX293bmVyLCA0LCBmYWxzZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfSBlbHNlIGlmIChfc3RhcnRlcklkID09IDMpIHsKICAgICAgICAgICAgICAgIHVpbnQ4WzhdIG1lbW9yeSBTdGF0czMgPSB1aW50OFs4XShtb25zdGVyQ3JlYXRvci5nZXRNb25zdGVyU3RhdHMoNykpOwogICAgICAgICAgICAgICAgbW9uID0gX2NyZWF0ZU1vbnN0ZXIoMCwgU3RhdHMzWzBdLCBTdGF0czNbMV0sIFN0YXRzM1syXSwgU3RhdHMzWzNdLCBTdGF0czNbNF0sIFN0YXRzM1s1XSwgU3RhdHMzWzZdLCBTdGF0czNbN10sIF9vd25lciwgNywgZmFsc2UpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfQoKCiAgICBmdW5jdGlvbiBfbW92ZVRvQXJlYSh1aW50MTYgX25ld0FyZWEsIGFkZHJlc3MgcGxheWVyKSBpbnRlcm5hbCB7CiAgICAgICAgICAgIAogICAgICAgICAgICBhZGRyZXNzVG9UcmFpbmVyW3BsYXllcl0uY3VyckFyZWEgPSBfbmV3QXJlYTsKICAgICAgICAgIAogICAgICAgIH0gICAKICAgICAgICAKICAgIAogICAgIAoKICAgIAogICAgLy8gYXNzaWducyBvd25lcnNoaXAgb2YgbW9uc3RlciB0byBhZGRyZXNzCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfZnJvbSwgYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICBvd25lcnNoaXBUb2tlbkNvdW50W190b10rKzsKICAgICAgICBtb25zdGVySW5kZXhUb093bmVyW190b2tlbklkXSA9IF90bzsKCiAgICAgICAgaWYgKF9mcm9tICE9IGFkZHJlc3MoMCkpIHsKICAgICAgICAgICAgb3duZXJzaGlwVG9rZW5Db3VudFtfZnJvbV0tLTsKCiAgICAgICAgICAgIC8vIGNsZWFyIGFueSBwcmV2aW91c2x5IGFwcHJvdmVkIG93bmVyc2hpcCBleGNoYW5nZQogICAgICAgICAgICBkZWxldGUgbW9uc3RlckluZGV4VG9BcHByb3ZlZFtfdG9rZW5JZF07CiAgICAgICAgfQoKICAgICAgICAvLyBFbWl0IFRyYW5zZmVyIGV2ZW50CiAgICAgICAgVHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKCiAgICAvLyBPbmx5IGFkbWluIGNhbiBmaXggaG93IG1hbnkgc2Vjb25kcyBwZXIgYmxvY2tzIGFyZSBjdXJyZW50bHkgb2JzZXJ2ZWQuCiAgICBmdW5jdGlvbiBzZXRTZWNvbmRzUGVyQmxvY2sodWludDI1NiBzZWNzKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIC8vcmVxdWlyZShzZWNzIDwgY29vbGRvd25zWzBdKTsKICAgICAgICBzZWNvbmRzUGVyQmxvY2sgPSBzZWNzOwogICAgfQoKCiAgICAKCgp9CgovLy8gQHRpdGxlIFRoZSBleHRlcm5hbCBjb250cmFjdCB0aGF0IGlzIHJlc3BvbnNpYmxlIGZvciBnZW5lcmF0aW5nIG1ldGFkYXRhIGZvciB0aGUgbW9uc3RlcnMsCi8vLyAgaXQgaGFzIG9uZSBmdW5jdGlvbiB0aGF0IHdpbGwgcmV0dXJuIHRoZSBkYXRhIGFzIGJ5dGVzLgpjb250cmFjdCBFUkM3MjFNZXRhZGF0YSB7CiAgICAvLy8gQGRldiBHaXZlbiBhIHRva2VuIElkLCByZXR1cm5zIGEgYnl0ZSBhcnJheSB0aGF0IGlzIHN1cHBvc2VkIHRvIGJlIGNvbnZlcnRlZCBpbnRvIHN0cmluZy4KICAgIGZ1bmN0aW9uIGdldE1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZykgcHVibGljIHZpZXcgcmV0dXJucyAoYnl0ZXMzMls0XSBidWZmZXIsIHVpbnQyNTYgY291bnQpIHsKICAgICAgICBpZiAoX3Rva2VuSWQgPT0gMSkgewogICAgICAgICAgICBidWZmZXJbMF0gPSAiSGVsbG8gV29ybGQhIDpEIjsKICAgICAgICAgICAgY291bnQgPSAxNTsKICAgICAgICB9IGVsc2UgaWYgKF90b2tlbklkID09IDIpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkkgd291bGQgZGVmaW5pdGVseSBjaG9vc2UgYSBtZWRpIjsKICAgICAgICAgICAgYnVmZmVyWzFdID0gInVtIGxlbmd0aCBzdHJpbmcuIjsKICAgICAgICAgICAgY291bnQgPSA0OTsKICAgICAgICB9IGVsc2UgaWYgKF90b2tlbklkID09IDMpIHsKICAgICAgICAgICAgYnVmZmVyWzBdID0gIkxvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBtaSBlIjsKICAgICAgICAgICAgYnVmZmVyWzFdID0gInN0IGFjY3Vtc2FuIGRhcGlidXMgYXVndWUgbG9yZW0sIjsKICAgICAgICAgICAgYnVmZmVyWzJdID0gIiB0cmlzdGlxdWUgdmVzdGlidWx1bSBpZCwgbGliZXJvIjsKICAgICAgICAgICAgYnVmZmVyWzNdID0gIiBzdXNjaXBpdCB2YXJpdXMgc2FwaWVuIGFsaXF1YW0uIjsKICAgICAgICAgICAgY291bnQgPSAxMjg7CiAgICAgICAgfQogICAgfQp9CgoKY29udHJhY3QgTW9uc3Rlck93bmVyc2hpcCBpcyBNb25zdGVyc0Jhc2UsIEVSQzcyMSB7CgogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBuYW1lID0gIkNoYWluTW9uc3RlcnMiOwogICAgc3RyaW5nIHB1YmxpYyBjb25zdGFudCBzeW1ib2wgPSAiQ0hNTyI7CgoKICAgIC8vIFRoZSBjb250cmFjdCB0aGF0IHdpbGwgcmV0dXJuIG1vbnN0ZXIgbWV0YWRhdGEKICAgIEVSQzcyMU1ldGFkYXRhIHB1YmxpYyBlcmM3MjFNZXRhZGF0YTsKCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1Nignc3VwcG9ydHNJbnRlcmZhY2UoYnl0ZXM0KScpKTsKCgoKCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9CiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignbmFtZSgpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdzeW1ib2woKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NigndG90YWxTdXBwbHkoKScpKSBeCiAgICAgICAgYnl0ZXM0KGtlY2NhazI1NignYmFsYW5jZU9mKGFkZHJlc3MpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdvd25lck9mKHVpbnQyNTYpJykpIF4KICAgICAgICBieXRlczQoa2VjY2FrMjU2KCdhcHByb3ZlKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyKGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3RyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NiknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2Vuc09mT3duZXIoYWRkcmVzcyknKSkgXgogICAgICAgIGJ5dGVzNChrZWNjYWsyNTYoJ3Rva2VuTWV0YWRhdGEodWludDI1NixzdHJpbmcpJykpOwoKCgoKICAgIGZ1bmN0aW9uIHN1cHBvcnRzSW50ZXJmYWNlKGJ5dGVzNCBfaW50ZXJmYWNlSUQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vIERFQlVHIE9OTFkKICAgICAgICAvL3JlcXVpcmUoKEludGVyZmFjZVNpZ25hdHVyZV9FUkMxNjUgPT0gMHgwMWZmYzlhNykgJiYgKEludGVyZmFjZVNpZ25hdHVyZV9FUkM3MjEgPT0gMHg5YTIwNDgzZCkpOwoKICAgICAgICByZXR1cm4gKChfaW50ZXJmYWNlSUQgPT0gSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzE2NSkgfHwgKF9pbnRlcmZhY2VJRCA9PSBJbnRlcmZhY2VTaWduYXR1cmVfRVJDNzIxKSk7CiAgICB9CgogICAgLy8vIEBkZXYgU2V0IHRoZSBhZGRyZXNzIG9mIHRoZSBzaWJsaW5nIGNvbnRyYWN0IHRoYXQgdHJhY2tzIG1ldGFkYXRhLgogICAgLy8vICBDRU8gb25seS4KICAgIGZ1bmN0aW9uIHNldE1ldGFkYXRhQWRkcmVzcyhhZGRyZXNzIF9jb250cmFjdEFkZHJlc3MpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgIGVyYzcyMU1ldGFkYXRhID0gRVJDNzIxTWV0YWRhdGEoX2NvbnRyYWN0QWRkcmVzcyk7CiAgICB9CgogICAgZnVuY3Rpb24gX293bnMoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtb25zdGVySW5kZXhUb093bmVyW190b2tlbklkXSA9PSBfY2xhaW1hbnQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9pc1RyYWRlYWJsZSh1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKGJvb2wpIHsKICAgICAgICByZXR1cm4gbW9uc3RlcklkVG9UcmFkZWFibGVbX3Rva2VuSWRdOwogICAgfQogICAgCiAgICAKICAgIC8vLyBAZGV2IENoZWNrcyBpZiBhIGdpdmVuIGFkZHJlc3MgY3VycmVudGx5IGhhcyB0cmFuc2ZlckFwcHJvdmFsIGZvciBhIHBhcnRpY3VsYXIgbW9uc3Rlci4KICAgIC8vLyBAcGFyYW0gX2NsYWltYW50IHRoZSBhZGRyZXNzIHdlIGFyZSBjb25maXJtaW5nIG1vbnN0ZXIgaXMgYXBwcm92ZWQgZm9yLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBtb25zdGVyIGlkLCBvbmx5IHZhbGlkIHdoZW4gPiAwCiAgICBmdW5jdGlvbiBfYXBwcm92ZWRGb3IoYWRkcmVzcyBfY2xhaW1hbnQsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBtb25zdGVySW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9PSBfY2xhaW1hbnQ7CiAgICB9CgogICAgLy8vIEBkZXYgTWFya3MgYW4gYWRkcmVzcyBhcyBiZWluZyBhcHByb3ZlZCBmb3IgdHJhbnNmZXJGcm9tKCksIG92ZXJ3cml0aW5nIGFueSBwcmV2aW91cwogICAgLy8vICBhcHByb3ZhbC4gU2V0dGluZyBfYXBwcm92ZWQgdG8gYWRkcmVzcygwKSBjbGVhcnMgYWxsIHRyYW5zZmVyIGFwcHJvdmFsLgogICAgLy8vICBOT1RFOiBfYXBwcm92ZSgpIGRvZXMgTk9UIHNlbmQgdGhlIEFwcHJvdmFsIGV2ZW50LiBUaGlzIGlzIGludGVudGlvbmFsIGJlY2F1c2UKICAgIC8vLyAgX2FwcHJvdmUoKSBhbmQgdHJhbnNmZXJGcm9tKCkgYXJlIHVzZWQgdG9nZXRoZXIgZm9yIHB1dHRpbmcgbW9uc3RlcnMgb24gYXVjdGlvbiwgYW5kCiAgICAvLy8gIHRoZXJlIGlzIG5vIHZhbHVlIGluIHNwYW1taW5nIHRoZSBsb2cgd2l0aCBBcHByb3ZhbCBldmVudHMgaW4gdGhhdCBjYXNlLgogICAgZnVuY3Rpb24gX2FwcHJvdmUodWludDI1NiBfdG9rZW5JZCwgYWRkcmVzcyBfYXBwcm92ZWQpIGludGVybmFsIHsKICAgICAgICBtb25zdGVySW5kZXhUb0FwcHJvdmVkW190b2tlbklkXSA9IF9hcHByb3ZlZDsKICAgIH0KICAgIAogICAgCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyBfb3duZXIpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQyNTYgY291bnQpIHsKICAgICAgICByZXR1cm4gb3duZXJzaGlwVG9rZW5Db3VudFtfb3duZXJdOwogICAgfQoKCiAgICBmdW5jdGlvbiB0cmFuc2ZlciAoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHsKICAgICAgICAvLyBTYWZldHkgY2hlY2sgdG8gcHJldmVudCBhZ2FpbnN0IGFuIHVuZXhwZWN0ZWQgMHgwIGRlZmF1bHQuCiAgICAgICAgcmVxdWlyZShfdG8gIT0gYWRkcmVzcygwKSk7CiAgICAgICAgLy8gRGlzYWxsb3cgdHJhbnNmZXJzIHRvIHRoaXMgY29udHJhY3QgdG8gcHJldmVudCBhY2NpZGVudGFsIG1pc3VzZS4KICAgICAgICAvLyBUaGUgY29udHJhY3Qgc2hvdWxkIG5ldmVyIG93biBhbnkgbW9uc3RlcnMgKGV4Y2VwdCB2ZXJ5IGJyaWVmbHkKICAgICAgICAvLyBhZnRlciBhIGdlbjAgbW9uc3RlciBpcyBjcmVhdGVkIGFuZCBiZWZvcmUgaXQgZ29lcyBvbiBhdWN0aW9uKS4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKHRoaXMpKTsKICAgICAgICAKCiAgICAgICAgLy8gWW91IGNhbiBvbmx5IHNlbmQgeW91ciBvd24gbW9uc3Rlci4KICAgICAgICByZXF1aXJlKF9vd25zKG1zZy5zZW5kZXIsIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCwgY2xlYXIgcGVuZGluZyBhcHByb3ZhbHMsIGVtaXQgVHJhbnNmZXIgZXZlbnQuCiAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIAogICAgCgovLy8gQG5vdGljZSBHcmFudCBhbm90aGVyIGFkZHJlc3MgdGhlIHJpZ2h0IHRvIHRyYW5zZmVyIGEgc3BlY2lmaWMgbW9uc3RlciB2aWEKICAgIC8vLyAgdHJhbnNmZXJGcm9tKCkuIFRoaXMgaXMgdGhlIHByZWZlcnJlZCBmbG93IGZvciB0cmFuc2ZlcmluZyBORlRzIHRvIGNvbnRyYWN0cy4KICAgIC8vLyBAcGFyYW0gX3RvIFRoZSBhZGRyZXNzIHRvIGJlIGdyYW50ZWQgdHJhbnNmZXIgYXBwcm92YWwuIFBhc3MgYWRkcmVzcygwKSB0bwogICAgLy8vICBjbGVhciBhbGwgYXBwcm92YWxzLgogICAgLy8vIEBwYXJhbSBfdG9rZW5JZCBUaGUgSUQgb2YgdGhlIG1vbnN0ZXIgdGhhdCBjYW4gYmUgdHJhbnNmZXJyZWQgaWYgdGhpcyBjYWxsIHN1Y2NlZWRzLgogICAgLy8vIEBkZXYgUmVxdWlyZWQgZm9yIEVSQy03MjEgY29tcGxpYW5jZS4KICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBfdG8sIHVpbnQyNTYgX3Rva2VuSWQgKSBleHRlcm5hbCB7CiAgICAgICAgLy8gT25seSBhbiBvd25lciBjYW4gZ3JhbnQgdHJhbnNmZXIgYXBwcm92YWwuCiAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwoKICAgICAgICAvLyBSZWdpc3RlciB0aGUgYXBwcm92YWwgKHJlcGxhY2luZyBhbnkgcHJldmlvdXMgYXBwcm92YWwpLgogICAgICAgIF9hcHByb3ZlKF90b2tlbklkLCBfdG8pOwoKICAgICAgICAvLyBFbWl0IGFwcHJvdmFsIGV2ZW50LgogICAgICAgIEFwcHJvdmFsKG1zZy5zZW5kZXIsIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFRyYW5zZmVyIGEgbW9uc3RlciBvd25lZCBieSBhbm90aGVyIGFkZHJlc3MsIGZvciB3aGljaCB0aGUgY2FsbGluZyBhZGRyZXNzCiAgICAvLy8gIGhhcyBwcmV2aW91c2x5IGJlZW4gZ3JhbnRlZCB0cmFuc2ZlciBhcHByb3ZhbCBieSB0aGUgb3duZXIuCiAgICAvLy8gQHBhcmFtIF9mcm9tIFRoZSBhZGRyZXNzIHRoYXQgb3ducyB0aGUgbW9uc3RlciB0byBiZSB0cmFuc2ZlcmVkLgogICAgLy8vIEBwYXJhbSBfdG8gVGhlIGFkZHJlc3MgdGhhdCBzaG91bGQgdGFrZSBvd25lcnNoaXAgb2YgdGhlIG1vbnN0ZXIuIENhbiBiZSBhbnkgYWRkcmVzcywKICAgIC8vLyAgaW5jbHVkaW5nIHRoZSBjYWxsZXIuCiAgICAvLy8gQHBhcmFtIF90b2tlbklkIFRoZSBJRCBvZiB0aGUgbW9uc3RlciB0byBiZSB0cmFuc2ZlcnJlZC4KICAgIC8vLyBAZGV2IFJlcXVpcmVkIGZvciBFUkMtNzIxIGNvbXBsaWFuY2UuCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20gKGFkZHJlc3MgX2Zyb20sIGFkZHJlc3MgX3RvLCB1aW50MjU2IF90b2tlbklkICkgZXh0ZXJuYWwgewogICAgICAgIC8vIFNhZmV0eSBjaGVjayB0byBwcmV2ZW50IGFnYWluc3QgYW4gdW5leHBlY3RlZCAweDAgZGVmYXVsdC4KICAgICAgICByZXF1aXJlKF90byAhPSBhZGRyZXNzKDApKTsKICAgICAgICAvLyBEaXNhbGxvdyB0cmFuc2ZlcnMgdG8gdGhpcyBjb250cmFjdCB0byBwcmV2ZW50IGFjY2lkZW50YWwgbWlzdXNlLgogICAgICAgIC8vIFRoZSBjb250cmFjdCBzaG91bGQgbmV2ZXIgb3duIGFueSBtb25zdGVycyAoZXhjZXB0IHZlcnkgYnJpZWZseQogICAgICAgIC8vIGFmdGVyIGEgZ2VuMCBtb25zdGVyIGlzIGNyZWF0ZWQgYW5kIGJlZm9yZSBpdCBnb2VzIG9uIGF1Y3Rpb24pLgogICAgICAgIHJlcXVpcmUoX3RvICE9IGFkZHJlc3ModGhpcykpOwogICAgICAgIC8vIENoZWNrIGZvciBhcHByb3ZhbCBhbmQgdmFsaWQgb3duZXJzaGlwCiAgICAgICAgLy9yZXF1aXJlKF9hcHByb3ZlZEZvcihtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgIHJlcXVpcmUoX293bnMoX2Zyb20sIF90b2tlbklkKSk7CgogICAgICAgIC8vIFJlYXNzaWduIG93bmVyc2hpcCAoYWxzbyBjbGVhcnMgcGVuZGluZyBhcHByb3ZhbHMgYW5kIGVtaXRzIFRyYW5zZmVyIGV2ZW50KS4KICAgICAgICBfdHJhbnNmZXIoX2Zyb20sIF90bywgX3Rva2VuSWQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBtb25zdGVycy5sZW5ndGg7CiAgICB9CgoKICAgIGZ1bmN0aW9uIG93bmVyT2YodWludDI1NiBfdG9rZW5JZCkKICAgICAgICAgICAgZXh0ZXJuYWwKICAgICAgICAgICAgdmlldwogICAgICAgICAgICByZXR1cm5zIChhZGRyZXNzIG93bmVyKQogICAgICAgIHsKICAgICAgICAgICAgb3duZXIgPSBtb25zdGVySW5kZXhUb093bmVyW190b2tlbklkXTsKCiAgICAgICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSk7CiAgICAgICAgfQoKICAgICBmdW5jdGlvbiB0b2tlbnNPZk93bmVyKGFkZHJlc3MgX293bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnModWludDI1NltdIG93bmVyVG9rZW5zKSB7CiAgICAgICAgdWludDI1NiB0b2tlbkNvdW50ID0gYmFsYW5jZU9mKF9vd25lcik7CgogICAgICAgIGlmICh0b2tlbkNvdW50ID09IDApIHsKICAgICAgICAgICAgLy8gUmV0dXJuIGFuIGVtcHR5IGFycmF5CiAgICAgICAgICAgIHJldHVybiBuZXcgdWludDI1NltdKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpbnQyNTZbXSBtZW1vcnkgcmVzdWx0ID0gbmV3IHVpbnQyNTZbXSh0b2tlbkNvdW50KTsKICAgICAgICAgICAgdWludDI1NiB0b3RhbE1vbnN0ZXJzID0gdG90YWxTdXBwbHkoKTsKICAgICAgICAgICAgdWludDI1NiByZXN1bHRJbmRleCA9IDA7CgogICAgICAgICAgICAKICAgICAgICAgICAgdWludDI1NiBtb25zdGVySWQ7CgogICAgICAgICAgICBmb3IgKG1vbnN0ZXJJZCA9IDA7IG1vbnN0ZXJJZCA8PSB0b3RhbE1vbnN0ZXJzOyBtb25zdGVySWQrKykgewogICAgICAgICAgICAgICAgaWYgKG1vbnN0ZXJJbmRleFRvT3duZXJbbW9uc3RlcklkXSA9PSBfb3duZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0SW5kZXhdID0gbW9uc3RlcklkOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQoKCiAgIAoKICAgIC8vLyBAZGV2IEFkYXB0ZWQgZnJvbSBtZW1jcHkoKSBieSBAYXJhY2huaWQgKE5pY2sgSm9obnNvbiA8PGEgaHJlZj0iL2Nkbi1jZ2kvbC9lbWFpbC1wcm90ZWN0aW9uIiBjbGFzcz0iX19jZl9lbWFpbF9fIiBkYXRhLWNmZW1haWw9ImE3YzZkNWM2YzRjZmM5Y2VjM2U3YzljOGQzYzNjOGQzODljOWMyZDMiPltlbWFpbCYjMTYwO3Byb3RlY3RlZF08L2E+PikKICAgIC8vLyAgVGhpcyBtZXRob2QgaXMgbGljZW5jZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9BcmFjaG5pZC9zb2xpZGl0eS1zdHJpbmd1dGlscy9ibG9iLzJmNmNhOWFjY2I0OGFlMTRjNjZmMTQzN2VjNTBlZDE5YTA2MTZmNzgvc3RyaW5ncy5zb2wKICAgIGZ1bmN0aW9uIF9tZW1jcHkodWludCBfZGVzdCwgdWludCBfc3JjLCB1aW50IF9sZW4pIHByaXZhdGUgdmlldyB7CiAgICAgICAgLy8gQ29weSB3b3JkLWxlbmd0aCBjaHVua3Mgd2hpbGUgcG9zc2libGUKICAgICAgICBmb3IoOyBfbGVuID49IDMyOyBfbGVuIC09IDMyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgbWxvYWQoX3NyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX2Rlc3QgKz0gMzI7CiAgICAgICAgICAgIF9zcmMgKz0gMzI7CiAgICAgICAgfQoKICAgICAgICAvLyBDb3B5IHJlbWFpbmluZyBieXRlcwogICAgICAgIHVpbnQyNTYgbWFzayA9IDI1NiAqKiAoMzIgLSBfbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoX3NyYyksIG5vdChtYXNrKSkKICAgICAgICAgICAgbGV0IGRlc3RwYXJ0IDo9IGFuZChtbG9hZChfZGVzdCksIG1hc2spCiAgICAgICAgICAgIG1zdG9yZShfZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvLy8gQGRldiBBZGFwdGVkIGZyb20gdG9TdHJpbmcoc2xpY2UpIGJ5IEBhcmFjaG5pZCAoTmljayBKb2huc29uIDw8YSBocmVmPSIvY2RuLWNnaS9sL2VtYWlsLXByb3RlY3Rpb24iIGNsYXNzPSJfX2NmX2VtYWlsX18iIGRhdGEtY2ZlbWFpbD0iYWRjY2RmY2NjZWM1YzNjNGM5ZWRjM2MyZDljOWMyZDk4M2MzYzhkOSI+W2VtYWlsJiMxNjA7cHJvdGVjdGVkXTwvYT4+KQogICAgLy8vICBUaGlzIG1ldGhvZCBpcyBsaWNlbmNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UuCiAgICAvLy8gIFJlZjogaHR0cHM6Ly9naXRodWIuY29tL0FyYWNobmlkL3NvbGlkaXR5LXN0cmluZ3V0aWxzL2Jsb2IvMmY2Y2E5YWNjYjQ4YWUxNGM2NmYxNDM3ZWM1MGVkMTlhMDYxNmY3OC9zdHJpbmdzLnNvbAogICAgZnVuY3Rpb24gX3RvU3RyaW5nKGJ5dGVzMzJbNF0gX3Jhd0J5dGVzLCB1aW50MjU2IF9zdHJpbmdMZW5ndGgpIHByaXZhdGUgdmlldyByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgb3V0cHV0U3RyaW5nID0gbmV3IHN0cmluZyhfc3RyaW5nTGVuZ3RoKTsKICAgICAgICB1aW50MjU2IG91dHB1dFB0cjsKICAgICAgICB1aW50MjU2IGJ5dGVzUHRyOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIG91dHB1dFB0ciA6PSBhZGQob3V0cHV0U3RyaW5nLCAzMikKICAgICAgICAgICAgYnl0ZXNQdHIgOj0gX3Jhd0J5dGVzCiAgICAgICAgfQoKICAgICAgICBfbWVtY3B5KG91dHB1dFB0ciwgYnl0ZXNQdHIsIF9zdHJpbmdMZW5ndGgpOwoKICAgICAgICByZXR1cm4gb3V0cHV0U3RyaW5nOwogICAgfQoKICAgIC8vLyBAbm90aWNlIFJldHVybnMgYSBVUkkgcG9pbnRpbmcgdG8gYSBtZXRhZGF0YSBwYWNrYWdlIGZvciB0aGlzIHRva2VuIGNvbmZvcm1pbmcgdG8KICAgIC8vLyAgRVJDLTcyMSAoaHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL0VJUHMvaXNzdWVzLzcyMSkKICAgIC8vLyBAcGFyYW0gX3Rva2VuSWQgVGhlIElEIG51bWJlciBvZiB0aGUgbW9uc3RlciB3aG9zZSBtZXRhZGF0YSBzaG91bGQgYmUgcmV0dXJuZWQuCiAgICBmdW5jdGlvbiB0b2tlbk1ldGFkYXRhKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfcHJlZmVycmVkVHJhbnNwb3J0KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHN0cmluZyBpbmZvVXJsKSB7CiAgICAgICAgcmVxdWlyZShlcmM3MjFNZXRhZGF0YSAhPSBhZGRyZXNzKDApKTsKICAgICAgICBieXRlczMyWzRdIG1lbW9yeSBidWZmZXI7CiAgICAgICAgdWludDI1NiBjb3VudDsKICAgICAgICAoYnVmZmVyLCBjb3VudCkgPSBlcmM3MjFNZXRhZGF0YS5nZXRNZXRhZGF0YShfdG9rZW5JZCwgX3ByZWZlcnJlZFRyYW5zcG9ydCk7CgogICAgICAgIHJldHVybiBfdG9TdHJpbmcoYnVmZmVyLCBjb3VudCk7CiAgICB9Cgp9Cgpjb250cmFjdCBNb25zdGVyQXVjdGlvbkJhc2UgewogICAgCiAgICAKICAgIC8vIFJlZmVyZW5jZSB0byBjb250cmFjdCB0cmFja2luZyBORlQgb3duZXJzaGlwCiAgICBFUkM3MjEgcHVibGljIG5vbkZ1bmdpYmxlQ29udHJhY3Q7CiAgICBDaGFpbk1vbnN0ZXJzQ29yZSBwdWJsaWMgY29yZTsKICAgIAogICAgc3RydWN0IEF1Y3Rpb24gewoKICAgICAgICAvLyBjdXJyZW50IG93bmVyCiAgICAgICAgYWRkcmVzcyBzZWxsZXI7CgogICAgICAgIC8vIHByaWNlIGluIHdlaQogICAgICAgIHVpbnQyNTYgcHJpY2U7CgogICAgICAgIC8vIHRpbWUgd2hlbiBhdWN0aW9uIHN0YXJ0ZWQKICAgICAgICB1aW50NjQgc3RhcnRlZEF0OwoKICAgICAgICB1aW50MjU2IGlkOwogICAgfQoKICAKCiAgICAvLyBDdXQgb3duZXIgdGFrZXMgb24gZWFjaCBhdWN0aW9uLCBtZWFzdXJlZCBpbiBiYXNpcyBwb2ludHMgKDEvMTAwIG9mIGEgcGVyY2VudCkuCiAgICAvLyBWYWx1ZXMgMC0xMCwwMDAgbWFwIHRvIDAlLTEwMCUKICAgIHVpbnQyNTYgcHVibGljIG93bmVyQ3V0OwoKICAgIC8vIE1hcCBmcm9tIHRva2VuIElEIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmcgYXVjdGlvbi4KICAgIG1hcHBpbmcodWludDI1NiA9PiBBdWN0aW9uKSB0b2tlbklkVG9BdWN0aW9uOwoKICAgIG1hcHBpbmcodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgYXVjdGlvbklkVG9TZWxsZXI7CiAgICAKICAgIG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikgcHVibGljIG93bmVyc2hpcEF1Y3Rpb25Db3VudDsKCgogICAgZXZlbnQgQXVjdGlvbkNyZWF0ZWQodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHByaWNlLCB1aW50MjU2IHVJRCwgYWRkcmVzcyBzZWxsZXIpOwogICAgZXZlbnQgQXVjdGlvblN1Y2Nlc3NmdWwodWludDI1NiB0b2tlbklkLCB1aW50MjU2IHByaWNlLCBhZGRyZXNzIG5ld093bmVyLCB1aW50MjU2IHVJRCk7CiAgICBldmVudCBBdWN0aW9uQ2FuY2VsbGVkKHVpbnQyNTYgdG9rZW5JZCwgdWludDI1NiB1SUQpOwoKCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBfcmVjZWl2ZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBpdCB3aWxsIHRocm93IGlmIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2ZlcihfcmVjZWl2ZXIsIF90b2tlbklkKTsKICAgIH0KCgogICAgZnVuY3Rpb24gX2FkZEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCwgQXVjdGlvbiBfYXVjdGlvbikgaW50ZXJuYWwgewogICAgICAgIAogICAgICAgIHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdID0gX2F1Y3Rpb247CgogICAgICAgIEF1Y3Rpb25DcmVhdGVkKAogICAgICAgICAgICB1aW50MjU2KF90b2tlbklkKSwKICAgICAgICAgICAgdWludDI1NihfYXVjdGlvbi5wcmljZSksCiAgICAgICAgICAgIHVpbnQyNTYoX2F1Y3Rpb24uaWQpLAogICAgICAgICAgICBhZGRyZXNzKF9hdWN0aW9uLnNlbGxlcikKICAgICAgICApOwogICAgICAgCiAgICB9CgoKICAgIGZ1bmN0aW9uIF9jYW5jZWxBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQsIGFkZHJlc3MgX3NlbGxlcikgaW50ZXJuYWwgewogICAgICAgIAogICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwoKICAgICAgICB1aW50MjU2IHVJRCA9IF9hdWN0aW9uLmlkOwogICAgICAgIAogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKICAgICAgICBvd25lcnNoaXBBdWN0aW9uQ291bnRbX3NlbGxlcl0tLTsKICAgICAgICBfdHJhbnNmZXIoX3NlbGxlciwgX3Rva2VuSWQpOwogICAgICAgIAogICAgICAgIEF1Y3Rpb25DYW5jZWxsZWQoX3Rva2VuSWQsIHVJRCk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIF9idXkodWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfYmlkQW1vdW50KQogICAgICAgIGludGVybmFsCiAgICAgICAgcmV0dXJucyAodWludDI1NikKICAgICAgICB7CiAgICAgICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgCgogICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKCiAgICAgICAgdWludDI1NiBwcmljZSA9IGF1Y3Rpb24ucHJpY2U7CiAgICAgICAgcmVxdWlyZShfYmlkQW1vdW50ID49IHByaWNlKTsKCiAgICAgICAgYWRkcmVzcyBzZWxsZXIgPSBhdWN0aW9uLnNlbGxlcjsKCiAgICAgICAgdWludDI1NiB1SUQgPSBhdWN0aW9uLmlkOwogICAgICAgIC8vIEF1Y3Rpb24gQmlkIGxvb2tzIGZpbmUhIHNvIHJlbW92ZQogICAgICAgIF9yZW1vdmVBdWN0aW9uKF90b2tlbklkKTsKICAgICAgICBvd25lcnNoaXBBdWN0aW9uQ291bnRbc2VsbGVyXS0tOwoKICAgICAgICBpZiAocHJpY2UgPiAwKSB7CgogICAgICAgICAgICB1aW50MjU2IGF1Y3Rpb25lZXJDdXQgPSBfY29tcHV0ZUN1dChwcmljZSk7CiAgICAgICAgICAgIHVpbnQyNTYgc2VsbGVyUHJvY2VlZHMgPSBwcmljZSAtIGF1Y3Rpb25lZXJDdXQ7CgogICAgICAgICAgICAvLyBOT1RFOiBEb2luZyBhIHRyYW5zZmVyKCkgaW4gdGhlIG1pZGRsZSBvZiBhIGNvbXBsZXgKICAgICAgICAgICAgLy8gbWV0aG9kIGxpa2UgdGhpcyBpcyBnZW5lcmFsbHkgZGlzY291cmFnZWQgYmVjYXVzZSBvZgogICAgICAgICAgICAvLyByZWVudHJhbmN5IGF0dGFja3MgYW5kIERvUyBhdHRhY2tzIGlmIHRoZSBzZWxsZXIgaXMKICAgICAgICAgICAgLy8gYSBjb250cmFjdCB3aXRoIGFuIGludmFsaWQgZmFsbGJhY2sgZnVuY3Rpb24uIFdlIGV4cGxpY2l0bHkKICAgICAgICAgICAgLy8gZ3VhcmQgYWdhaW5zdCByZWVudHJhbmN5IGF0dGFja3MgYnkgcmVtb3ZpbmcgdGhlIGF1Y3Rpb24KICAgICAgICAgICAgLy8gYmVmb3JlIGNhbGxpbmcgdHJhbnNmZXIoKSwgYW5kIHRoZSBvbmx5IHRoaW5nIHRoZSBzZWxsZXIKICAgICAgICAgICAgLy8gY2FuIERvUyBpcyB0aGUgc2FsZSBvZiB0aGVpciBvd24gYXNzZXQhIChBbmQgaWYgaXQncyBhbgogICAgICAgICAgICAvLyBhY2NpZGVudCwgdGhleSBjYW4gY2FsbCBjYW5jZWxBdWN0aW9uKCkuICkKICAgICAgICAgICAgaWYoc2VsbGVyICE9IGFkZHJlc3MoY29yZSkpIHsKICAgICAgICAgICAgICAgIHNlbGxlci50cmFuc2ZlcihzZWxsZXJQcm9jZWVkcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIENhbGN1bGF0ZSBhbnkgZXhjZXNzIGZ1bmRzIGluY2x1ZGVkIHdpdGggdGhlIGJpZC4gSWYgdGhlIGV4Y2VzcwogICAgICAgIC8vIGlzIGFueXRoaW5nIHdvcnRoIHdvcnJ5aW5nIGFib3V0LCB0cmFuc2ZlciBpdCBiYWNrIHRvIGJpZGRlci4KICAgICAgICAvLyBOT1RFOiBXZSBjaGVja2VkIGFib3ZlIHRoYXQgdGhlIGJpZCBhbW91bnQgaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAgICAgLy8gZXF1YWwgdG8gdGhlIHByaWNlIHNvIHRoaXMgY2Fubm90IHVuZGVyZmxvdy4KICAgICAgICB1aW50MjU2IGJpZEV4Y2VzcyA9IF9iaWRBbW91bnQgLSBwcmljZTsKCiAgICAgICAgLy8gUmV0dXJuIHRoZSBmdW5kcy4gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgdHJhbnNmZXIsIHRoaXMgaXMKICAgICAgICAvLyBub3Qgc3VzY2VwdGlibGUgdG8gYSByZS1lbnRyeSBhdHRhY2sgYmVjYXVzZSB0aGUgYXVjdGlvbiBpcwogICAgICAgIC8vIHJlbW92ZWQgYmVmb3JlIGFueSB0cmFuc2ZlcnMgb2NjdXIuCiAgICAgICAgbXNnLnNlbmRlci50cmFuc2ZlcihiaWRFeGNlc3MpOwoKICAgICAgICAvLyBUZWxsIHRoZSB3b3JsZCEKICAgICAgICBBdWN0aW9uU3VjY2Vzc2Z1bChfdG9rZW5JZCwgcHJpY2UsIG1zZy5zZW5kZXIsIHVJRCk7CgogICAgICAgIHJldHVybiBwcmljZTsKCgogICAgfQoKICAgIGZ1bmN0aW9uIF9yZW1vdmVBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICBkZWxldGUgdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICB9CgogICAgZnVuY3Rpb24gX2lzT25BdWN0aW9uKEF1Y3Rpb24gc3RvcmFnZSBfYXVjdGlvbikgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChfYXVjdGlvbi5zdGFydGVkQXQgPiAwKTsKICAgIH0KCiAgICAgZnVuY3Rpb24gX2NvbXB1dGVDdXQodWludDI1NiBfcHJpY2UpIGludGVybmFsIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBTYWZlTWF0aCAob3Igc2ltaWxhcikgaW4gdGhpcyBmdW5jdGlvbiBiZWNhdXNlCiAgICAgICAgLy8gIGFsbCBvZiBvdXIgZW50cnkgZnVuY3Rpb25zIGNhcmVmdWxseSBjYXAgdGhlIG1heGltdW0gdmFsdWVzIGZvcgogICAgICAgIC8vICBjdXJyZW5jeSAoYXQgMTI4LWJpdHMpLCBhbmQgb3duZXJDdXQgPD0gMTAwMDAgKHNlZSB0aGUgcmVxdWlyZSgpCiAgICAgICAgLy8gIHN0YXRlbWVudCBpbiB0aGUgQ2xvY2tBdWN0aW9uIGNvbnN0cnVjdG9yKS4gVGhlIHJlc3VsdCBvZiB0aGlzCiAgICAgICAgLy8gIGZ1bmN0aW9uIGlzIGFsd2F5cyBndWFyYW50ZWVkIHRvIGJlIDw9IF9wcmljZS4KICAgICAgICByZXR1cm4gX3ByaWNlICogb3duZXJDdXQgLyAxMDAwMDsKICAgIH0KCiAgICAKCn0KCgpjb250cmFjdCBNb25zdGVyQXVjdGlvbiBpcyAgTW9uc3RlckF1Y3Rpb25CYXNlLCBPd25hYmxlIHsKCgogICAgYm9vbCBwdWJsaWMgaXNNb25zdGVyQXVjdGlvbiA9IHRydWU7CiAgICAgdWludDI1NiBwdWJsaWMgYXVjdGlvbkluZGV4ID0gMDsKCiAgICAvLy8gQGRldiBUaGUgRVJDLTE2NSBpbnRlcmZhY2Ugc2lnbmF0dXJlIGZvciBFUkMtNzIxLgogICAgLy8vICBSZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9ldGhlcmV1bS9FSVBzL2lzc3Vlcy8xNjUKICAgIC8vLyAgUmVmOiBodHRwczovL2dpdGh1Yi5jb20vZXRoZXJldW0vRUlQcy9pc3N1ZXMvNzIxCiAgICBieXRlczQgY29uc3RhbnQgSW50ZXJmYWNlU2lnbmF0dXJlX0VSQzcyMSA9IGJ5dGVzNCgweDlhMjA0ODNkKTsKCiAgICBmdW5jdGlvbiBNb25zdGVyQXVjdGlvbihhZGRyZXNzIF9uZnRBZGRyZXNzLCB1aW50MjU2IF9jdXQpIHB1YmxpYyB7CiAgICAgICAgcmVxdWlyZShfY3V0IDw9IDEwMDAwKTsKICAgICAgICBvd25lckN1dCA9IF9jdXQ7CgogICAgICAgIEVSQzcyMSBjYW5kaWRhdGVDb250cmFjdCA9IEVSQzcyMShfbmZ0QWRkcmVzcyk7CiAgICAgICAgCiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdCA9IGNhbmRpZGF0ZUNvbnRyYWN0OwogICAgICAgIENoYWluTW9uc3RlcnNDb3JlIGNhbmRpZGF0ZUNvcmVDb250cmFjdCA9IENoYWluTW9uc3RlcnNDb3JlKF9uZnRBZGRyZXNzKTsKICAgICAgICBjb3JlID0gY2FuZGlkYXRlQ29yZUNvbnRyYWN0OwoKICAgICAgICAKICAgIH0KICAgIAogICAgLy8gb25seSBwb3NzaWJsZSB0byBkZWNyZWFzZSBvd25lckN1dCEKICAgIGZ1bmN0aW9uIHNldE93bmVyQ3V0KHVpbnQyNTYgX2N1dCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKF9jdXQgPD0gb3duZXJDdXQpOwogICAgICAgIG93bmVyQ3V0ID0gX2N1dDsKICAgIH0KICAgIAogICAgCiAgICBmdW5jdGlvbiBfb3ducyhhZGRyZXNzIF9jbGFpbWFudCwgdWludDI1NiBfdG9rZW5JZCkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIChub25GdW5naWJsZUNvbnRyYWN0Lm93bmVyT2YoX3Rva2VuSWQpID09IF9jbGFpbWFudCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9lc2Nyb3coYWRkcmVzcyBfb3duZXIsIHVpbnQyNTYgX3Rva2VuSWQpIGludGVybmFsIHsKICAgICAgICAvLyBpdCB3aWxsIHRocm93IGlmIHRyYW5zZmVyIGZhaWxzCiAgICAgICAgbm9uRnVuZ2libGVDb250cmFjdC50cmFuc2ZlckZyb20oX293bmVyLCB0aGlzLCBfdG9rZW5JZCk7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgIAogICAgICAgCiAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAKICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKGJhbGFuY2UpOwoKICAgICAgICAKICAgICAgIAogICAgfQoKICAgIAogICAgZnVuY3Rpb24gdG9rZW5zSW5BdWN0aW9uc09mT3duZXIoYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIHZpZXcgcmV0dXJucyh1aW50MjU2W10gYXVjdGlvblRva2VucykgewogICAgICAgIAogICAgICAgICAgIHVpbnQyNTYgbnVtQXVjdGlvbnMgPSBvd25lcnNoaXBBdWN0aW9uQ291bnRbX293bmVyXTsKCiAgICAgICAgICAgIAogICAgICAgIAogICAgICAgICAgICB1aW50MjU2W10gbWVtb3J5IHJlc3VsdCA9IG5ldyB1aW50MjU2W10obnVtQXVjdGlvbnMpOwogICAgICAgICAgICB1aW50MjU2IHRvdGFsQXVjdGlvbnMgPSBjb3JlLnRvdGFsU3VwcGx5KCk7CiAgICAgICAgICAgIHVpbnQyNTYgcmVzdWx0SW5kZXggPSAwOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIHVpbnQyNTYgYXVjdGlvbklkOwoKICAgICAgICAgICAgZm9yIChhdWN0aW9uSWQgPSAwOyBhdWN0aW9uSWQgPD0gdG90YWxBdWN0aW9uczsgYXVjdGlvbklkKyspIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW2F1Y3Rpb25JZF07CiAgICAgICAgICAgICAgICBpZiAoYXVjdGlvbi5zZWxsZXIgPT0gX293bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Jlc3VsdEluZGV4XSA9IGF1Y3Rpb25JZDsKICAgICAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIAogICAgICAgIAogICAgfQoKCgoKICAgIGZ1bmN0aW9uIGNyZWF0ZUF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCwgdWludDI1NiBfcHJpY2UsIGFkZHJlc3MgX3NlbGxlcikgZXh0ZXJuYWwgewogICAgICAgICAgICAgcmVxdWlyZShfcHJpY2UgPT0gdWludDI1NihfcHJpY2UpKTsKICAgICAgICAgICAgcmVxdWlyZShjb3JlLl9pc1RyYWRlYWJsZShfdG9rZW5JZCkpOwogICAgICAgICAgICAgcmVxdWlyZShfb3ducyhtc2cuc2VuZGVyLCBfdG9rZW5JZCkpOwogICAgICAgICAgICAgX2VzY3Jvdyhtc2cuc2VuZGVyLCBfdG9rZW5JZCk7CgogICAgICAgICAgICAKCiAgICAgICAgICAgIAogICAgICAgICAgICAgQXVjdGlvbiBtZW1vcnkgYXVjdGlvbiA9IEF1Y3Rpb24oCiAgICAgICAgICAgICAgICAgX3NlbGxlciwKICAgICAgICAgICAgICAgICB1aW50MjU2KF9wcmljZSksCiAgICAgICAgICAgICAgICAgdWludDY0KG5vdyksCiAgICAgICAgICAgICAgICAgdWludDI1NihhdWN0aW9uSW5kZXgpCiAgICAgICAgICAgICApOwoKICAgICAgICAgICAgYXVjdGlvbklkVG9TZWxsZXJbYXVjdGlvbkluZGV4XSA9IF9zZWxsZXI7CiAgICAgICAgICAgIG93bmVyc2hpcEF1Y3Rpb25Db3VudFtfc2VsbGVyXSsrOwogICAgICAgICAgICAKICAgICAgICAgICAgIGF1Y3Rpb25JbmRleCsrOwogICAgICAgICAgICAgX2FkZEF1Y3Rpb24oX3Rva2VuSWQsIGF1Y3Rpb24pOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBidXkodWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgICAgIC8vZGVsZXRlIGF1Y3Rpb25JZFRvU2VsbGVyW190b2tlbklkXTsKICAgICAgICAgICAgLy8gYnV5IHdpbGwgdGhyb3cgaWYgdGhlIGJpZCBvciBmdW5kcyB0cmFuc2ZlciBmYWlscwogICAgICAgICAgICBfYnV5IChfdG9rZW5JZCwgbXNnLnZhbHVlKTsKICAgICAgICAgICAgX3RyYW5zZmVyKG1zZy5zZW5kZXIsIF90b2tlbklkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgIH0KCiAgICAKICAgIGZ1bmN0aW9uIGNhbmNlbEF1Y3Rpb24odWludDI1NiBfdG9rZW5JZCkgZXh0ZXJuYWwgewogICAgICAgICAgICBBdWN0aW9uIHN0b3JhZ2UgYXVjdGlvbiA9IHRva2VuSWRUb0F1Y3Rpb25bX3Rva2VuSWRdOwogICAgICAgICAgICByZXF1aXJlKF9pc09uQXVjdGlvbihhdWN0aW9uKSk7CgogICAgICAgICAgICBhZGRyZXNzIHNlbGxlciA9IGF1Y3Rpb24uc2VsbGVyOwogICAgICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VsbGVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBfY2FuY2VsQXVjdGlvbihfdG9rZW5JZCwgc2VsbGVyKTsKICAgICAgICB9CgogICAgCiAgICBmdW5jdGlvbiBnZXRBdWN0aW9uKHVpbnQyNTYgX3Rva2VuSWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucwogICAgICAgICgKICAgICAgICAgICAgYWRkcmVzcyBzZWxsZXIsCiAgICAgICAgICAgIHVpbnQyNTYgcHJpY2UsCiAgICAgICAgICAgIHVpbnQyNTYgc3RhcnRlZEF0CiAgICAgICAgKSB7CiAgICAgICAgICAgIEF1Y3Rpb24gc3RvcmFnZSBhdWN0aW9uID0gdG9rZW5JZFRvQXVjdGlvbltfdG9rZW5JZF07CiAgICAgICAgICAgIHJlcXVpcmUoX2lzT25BdWN0aW9uKGF1Y3Rpb24pKTsKCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBhdWN0aW9uLnNlbGxlciwKICAgICAgICAgICAgICAgIGF1Y3Rpb24ucHJpY2UsCiAgICAgICAgICAgICAgICBhdWN0aW9uLnN0YXJ0ZWRBdAogICAgICAgICAgICApOwogICAgICAgIH0KCgogICAgZnVuY3Rpb24gZ2V0UHJpY2UodWludDI1NiBfdG9rZW5JZCkKICAgICAgICBleHRlcm5hbAogICAgICAgIHZpZXcKICAgICAgICByZXR1cm5zICh1aW50MjU2KQogICAgICAgIHsKICAgICAgICAgICAgQXVjdGlvbiBzdG9yYWdlIGF1Y3Rpb24gPSB0b2tlbklkVG9BdWN0aW9uW190b2tlbklkXTsKICAgICAgICAgICAgcmVxdWlyZShfaXNPbkF1Y3Rpb24oYXVjdGlvbikpOwogICAgICAgICAgICByZXR1cm4gYXVjdGlvbi5wcmljZTsKICAgICAgICB9Cn0KCgpjb250cmFjdCBDaGFpbk1vbnN0ZXJzQXVjdGlvbiBpcyBNb25zdGVyT3duZXJzaGlwIHsKCiAgCgoKICAgIGZ1bmN0aW9uIHNldE1vbnN0ZXJBdWN0aW9uQWRkcmVzcyhhZGRyZXNzIF9hZGRyZXNzKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIE1vbnN0ZXJBdWN0aW9uIGNhbmRpZGF0ZUNvbnRyYWN0ID0gTW9uc3RlckF1Y3Rpb24oX2FkZHJlc3MpOwoKICAgICAgICByZXF1aXJlKGNhbmRpZGF0ZUNvbnRyYWN0LmlzTW9uc3RlckF1Y3Rpb24oKSk7CgogICAgICAgIG1vbnN0ZXJBdWN0aW9uID0gY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgoKCiAgICB1aW50MjU2IHB1YmxpYyBjb25zdGFudCBQUk9NT19DUkVBVElPTl9MSU1JVCA9IDUwMDA7CgogICAgdWludDI1NiBwdWJsaWMgY29uc3RhbnQgR0VOMF9DUkVBVElPTl9MSU1JVCA9IDUwMDA7CgogICAgLy8gQ291bnRzIHRoZSBudW1iZXIgb2YgbW9uc3RlciB0aGUgY29udHJhY3Qgb3duZXIgaGFzIGNyZWF0ZWQuCiAgICB1aW50MjU2IHB1YmxpYyBwcm9tb0NyZWF0ZWRDb3VudDsKICAgIHVpbnQyNTYgcHVibGljIGdlbjBDcmVhdGVkQ291bnQ7CgoKICAgIAogICAgLy8gaXRzIHN0YXRzIGFyZSBjb21wbGV0ZWx5IGRlcGVuZGVudCBvbiB0aGUgc3Bhd24gYWxnaG9yaXRobQogICAgZnVuY3Rpb24gY3JlYXRlUHJvbW9Nb25zdGVyKHVpbnQyNTYgX21JZCwgYWRkcmVzcyBfb3duZXIpIGV4dGVybmFsIG9ubHlBZG1pbiB7CiAgICAgICAKCiAgICAgICAvLyBkdXJpbmcgZ2VuZXJhdGlvbiB3ZSBoYXZlIHRvIGtlZXAgaW4gbWluZCB0aGF0IHdlIGhhdmUgb25seSAxMCwwMDAgdG9rZW5zIGF2YWlsYWJsZQogICAgICAgLy8gd2hpY2ggaGF2ZSB0byBiZSBkaXZpZGVkIGJ5IDE1MSBtb25zdGVycywgc29tZSByYXJlciB0aGFuIG90aGVycwogICAgICAgLy8gc2VlIFdoaXRlUGFwZXIgZm9yIGdlbjAvcHJvbW8gbW9uc3RlciBwbGFuCiAgICAgICAgCiAgICAgICAgcmVxdWlyZShwcm9tb0NyZWF0ZWRDb3VudCA8IFBST01PX0NSRUFUSU9OX0xJTUlUKTsKCiAgICAgICAgcHJvbW9DcmVhdGVkQ291bnQrKzsKICAgICAgICB1aW50OFs4XSBtZW1vcnkgU3RhdHMgPSB1aW50OFs4XShtb25zdGVyQ3JlYXRvci5nZXRNb25zdGVyU3RhdHModWludDI1NihfbUlkKSkpOwogICAgICAgIHVpbnQ4WzddIG1lbW9yeSBJVnMgPSB1aW50OFs3XShtb25zdGVyQ3JlYXRvci5nZXRHZW4wSVZzKCkpOwogICAgICAgIAogICAgICAgIHVpbnQyNTYgbW9uc3RlcklkID0gX2NyZWF0ZU1vbnN0ZXIoMCwgU3RhdHNbMF0sIFN0YXRzWzFdLCBTdGF0c1syXSwgU3RhdHNbM10sIFN0YXRzWzRdLCBTdGF0c1s1XSwgU3RhdHNbNl0sIFN0YXRzWzddLCBfb3duZXIsIF9tSWQsIHRydWUpOwogICAgICAgIG1vbnN0ZXJJZFRvVHJhZGVhYmxlW21vbnN0ZXJJZF0gPSB0cnVlOwoKICAgICAgICBtb25zdGVySWRUb0lWc1ttb25zdGVySWRdID0gSVZzOwogICAgICAgIAogICAgICAgCiAgICB9CgogICAKCgogICAgZnVuY3Rpb24gY3JlYXRlR2VuMEF1Y3Rpb24odWludDI1NiBfbUlkLCB1aW50MjU2IHByaWNlKSBleHRlcm5hbCBvbmx5QWRtaW4gewogICAgICAgIHJlcXVpcmUoZ2VuMENyZWF0ZWRDb3VudCA8IEdFTjBfQ1JFQVRJT05fTElNSVQpOwoKICAgICAgICB1aW50OFs4XSBtZW1vcnkgU3RhdHMgPSB1aW50OFs4XShtb25zdGVyQ3JlYXRvci5nZXRNb25zdGVyU3RhdHModWludDI1NihfbUlkKSkpOwogICAgICAgIHVpbnQ4WzddIG1lbW9yeSBJVnMgPSB1aW50OFs3XShtb25zdGVyQ3JlYXRvci5nZXRHZW4wSVZzKCkpOwogICAgICAgIHVpbnQyNTYgbW9uc3RlcklkID0gX2NyZWF0ZU1vbnN0ZXIoMCwgU3RhdHNbMF0sIFN0YXRzWzFdLCBTdGF0c1syXSwgU3RhdHNbM10sIFN0YXRzWzRdLCBTdGF0c1s1XSwgU3RhdHNbNl0sIFN0YXRzWzddLCB0aGlzLCBfbUlkLCB0cnVlKTsKICAgICAgICBtb25zdGVySWRUb1RyYWRlYWJsZVttb25zdGVySWRdID0gdHJ1ZTsKCiAgICAgICAgbW9uc3RlcklkVG9JVnNbbW9uc3RlcklkXSA9IElWczsKCiAgICAgICAgbW9uc3RlckF1Y3Rpb24uY3JlYXRlQXVjdGlvbihtb25zdGVySWQsIHByaWNlLCBhZGRyZXNzKHRoaXMpKTsKCgogICAgICAgIGdlbjBDcmVhdGVkQ291bnQrKzsKICAgICAgICAKICAgIH0KCiAgICAKfQoKCi8vIHVzZWQgZHVyaW5nIGxhdW5jaCBmb3Igd29ybGQgY2hhbXBpb25zaGlwCi8vIGNhbiBhbmQgd2lsbCBiZSB1cGdyYWRlZCBkdXJpbmcgZGV2ZWxvcG1lbnQgd2l0aCBuZXcgYmF0dGxlIHN5c3RlbSEKLy8gdGhpcyBpcyBqdXN0IHRvIGdpdmUgcGxheWVycyBzb21ldGhpbmcgdG8gZG8gYW5kIHRlc3QgdGhlaXIgbW9uc3RlcnMKLy8gYWxzbyBkZW1vbnN0cmF0ZXMgaG93IHdlIGNhbiBidWlsZCB1cCBtb3JlIG1lY2hhbmljcyBvbiB0b3Agb2Ygb3VyIGxvY2tlZCBjb3JlIGNvbnRyYWN0IQpjb250cmFjdCBNb25zdGVyQ2hhbXBpb25zaGlwIGlzIE93bmFibGUgewoKICAgIGJvb2wgcHVibGljIGlzTW9uc3RlckNoYW1waW9uc2hpcCA9IHRydWU7CiAgICAKICAgIENoYWluTW9uc3RlcnNDb3JlIGNvcmU7CiAgICAKICAgIC8vIGxpc3Qgb2YgdG9wIHRlbiAKICAgIGFkZHJlc3NbMTBdIHRvcFRlbjsKCiAgICAvLyBob2xkcyB0aGUgYWRkcmVzcyBjdXJyZW50ICJ3b3JsZCIgY2hhbXBpb24KICAgIGFkZHJlc3MgcHVibGljIGN1cnJDaGFtcGlvbjsKICAgIAogICAgCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHB1YmxpYyBhZGRyZXNzVG9Qb3dlcmxldmVsOwogICAgbWFwcGluZyAodWludDI1NiA9PiBhZGRyZXNzKSBwdWJsaWMgcmFua1RvQWRkcmVzczsKICAgIAoKICAgCiAgICAKICAgIAogICAgIC8vIHRyeSB0byBiZWF0IGV2ZXJ5IG90aGVyIHBsYXllciBpbiB0aGUgdG9wMTAgd2l0aCB5b3VyIHN0cm9uZ2VzdCBtb25zdGVyIQogICAgLy8gZWZmZWN0aXZlbHkgbG9vcGluZyB0aHJvdWdoIGFsbCB0b3AxMCBwbGF5ZXJzLCBiZWF0aW5nIHRoZW0gb25lIGJ5IG9uZSAKICAgIC8vIGFuZCBpZiBzdHJvbmcgZW5vdWdoIHBsYWNpbmcgeW91ciBpbiB0aGUgdG9wMTAgYXMgd2VsbAogICAgZnVuY3Rpb24gY29udGVzdENoYW1waW9uKHVpbnQyNTYgX3Rva2VuSWQpIGV4dGVybmFsIHsKICAgICAgICAgICAgdWludCBtYXhJbmRleCA9IDk7CiAgICAgICAgICAgIAogICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGZhaWwgdHggaWYgcGxheWVyIGlzIGFscmVhZHkgY2hhbXBpb24hCiAgICAgICAgICAgIC8vIGluIHRoZW9yeSBwbGF5ZXJzIGNvdWxkIGluY3JlYXNlIHRoZWlyIHBvd2VybGV2ZWwgYnkgY29udGVzdGluZyB0aGVtc2VsdmVzIGJ1dAogICAgICAgICAgICAvLyB0aGlzIGNoZWNrIHN0b3BzIHRoYXQgZnJvbSBoYXBwZW5pbmcgc28gb3RoZXIgcGxheWVycyBoYXZlIHRoZSBjaGFuY2UgdG8KICAgICAgICAgICAgLy8gYmVjb21lIHRoZSB0ZW1wb3JhcnkgY2hhbXBpb24hCiAgICAgICAgICAgIGlmIChjdXJyQ2hhbXBpb24gPT0gbXNnLnNlbmRlcikKICAgICAgICAgICAgICAgIHJldmVydCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgIHJlcXVpcmUoY29yZS5pc1RyYWluZXIobXNnLnNlbmRlcikpOyAgICAgICAgCiAgICAgICAgICAgcmVxdWlyZShjb3JlLm1vbnN0ZXJJbmRleFRvT3duZXIoX3Rva2VuSWQpID09IG1zZy5zZW5kZXIpOwogICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgICB1aW50IG15UG93ZXJsZXZlbCA9IGNvcmUuZ2V0TW9uc3RlclBvd2VyTGV2ZWwoX3Rva2VuSWQpOwoKICAgICAgICAgICAKICAgICAgICAgICAvLyBjaGVja3MgaWYgdGhpcyB0cmFuc2FjdGlvbiBpcyB1c2VsZXNzCiAgICAgICAgICAgLy8gc2luY2Ugd2UgY2FuJ3QgZmlnaHQgYWdhaW5zdCBvdXJzZWxmIQogICAgICAgICAgIC8vIGFsc28gc3RvcHMgcmVlbnRyYW5jeSBhdHRhY2tzCiAgICAgICAgICAgcmVxdWlyZShteVBvd2VybGV2ZWwgPiBhZGRyZXNzVG9Qb3dlcmxldmVsW21zZy5zZW5kZXJdKTsKICAgICAgICAgICAKICAgICAgICAgIAogICAgICAgICAgIHVpbnQgbXlSYW5rID0gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAodWludCBpPTA7IGk8PW1heEluZGV4OyBpKyspIHsKICAgICAgICAgICAgICAgIC8vaWYgKGFkZHJlcykKICAgICAgICAgICAgICAgIGlmICggbXlQb3dlcmxldmVsID4gYWRkcmVzc1RvUG93ZXJsZXZlbFt0b3BUZW5baV1dICkgewogICAgICAgICAgICAgICAgICAgIC8vIHlvdSBoYXZlIGJlYXRlbiB0aGlzIG9uZSBzbyBpbmNyZWFzZSB0ZW1wb3JhcnkgcmFuawogICAgICAgICAgICAgICAgICAgIG15UmFuayA9IGk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKG15UmFuayA9PSBtYXhJbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyQ2hhbXBpb24gPSBtc2cuc2VuZGVyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGFkZHJlc3NUb1Bvd2VybGV2ZWxbbXNnLnNlbmRlcl0gPSBteVBvd2VybGV2ZWw7CiAgICAgICAgICAgIAogICAgICAgICAgICBhZGRyZXNzWzEwXSBzdG9yYWdlIG5ld1RvcFRlbiA9IHRvcFRlbjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjdXJyQ2hhbXBpb24gPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICAgICAgZm9yICh1aW50IGo9MDsgajxtYXhJbmRleDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIG91cnNlbHZlcyBmcm9tIHRoaXMgbGlzdCBpbiBjYXNlIAogICAgICAgICAgICAgICAgICAgIGlmIChuZXdUb3BUZW5bal0gPT0gbXNnLnNlbmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdUb3BUZW5bal0gPSAweDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAodWludCB4PTA7IHg8PW15UmFuazsgeCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoeCA9PSBteVJhbmspIHsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG5ld1RvcFRlblt4XSA9IG1zZy5zZW5kZXI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh4IDwgbWF4SW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1RvcFRlblt4XSA9IHRvcFRlblt4KzFdOyAgICAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICB0b3BUZW4gPSBuZXdUb3BUZW47CiAgICAgICAgICAgIAogICAgICAgIH0KICAgIAogICAgCiAgICAKICAgIGZ1bmN0aW9uIGdldFRvcFBsYXllcnMoKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKAogICAgICAgICAgICBhZGRyZXNzWzEwXSBwbGF5ZXJzCiAgICAgICAgKSB7CiAgICAgICAgICAgIHBsYXllcnMgPSB0b3BUZW47CiAgICAgICAgfQogICAgCgoKCiAgICAKICAgIAogICAgCiAgICAKICAgIGZ1bmN0aW9uIE1vbnN0ZXJDaGFtcGlvbnNoaXAoYWRkcmVzcyBjb3JlQ29udHJhY3QpIHB1YmxpYyB7CiAgICAgICBjb3JlID0gQ2hhaW5Nb25zdGVyc0NvcmUoY29yZUNvbnRyYWN0KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgIAogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRoaXMuYmFsYW5jZTsKICAgICAgIAogICAgICAgCiAgICAgICAgb3duZXIudHJhbnNmZXIoYmFsYW5jZSk7CiAgICAgICAgCiAgICB9CgoKCgp9CgoKLy8gd2hlcmUgdGhlIG5vdC1zby1tdWNoICJoaWRkZW4iIG1hZ2ljIGhhcHBlbnMKY29udHJhY3QgTW9uc3RlckNyZWF0b3JJbnRlcmZhY2UgaXMgT3duYWJsZSB7CgogICAgdWludDggcHVibGljIGxvY2tlZE1vbnN0ZXJTdGF0c0NvdW50ID0gMDsKICAgIHVpbnQgbm9uY2UgPSAwOwoKICAgIGZ1bmN0aW9uIHJhbmQodWludDggbWluLCB1aW50OCBtYXgpIHB1YmxpYyByZXR1cm5zICh1aW50OCkgewogICAgICAgIG5vbmNlKys7CiAgICAgICAgdWludDggcmVzdWx0ID0gKHVpbnQ4KHNoYTMoYmxvY2suYmxvY2toYXNoKGJsb2NrLm51bWJlci0xKSwgbm9uY2UgKSklbWF4KTsKICAgICAgICAKICAgICAgICBpZiAocmVzdWx0IDwgbWluKQogICAgICAgIHsKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0K21pbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIAogICAgCgoKICAgIGZ1bmN0aW9uIHNoaW55UmFuZCh1aW50MTYgbWluLCB1aW50MTYgbWF4KSBwdWJsaWMgcmV0dXJucyAodWludDE2KSB7CiAgICAgICAgbm9uY2UrKzsKICAgICAgICB1aW50MTYgcmVzdWx0ID0gKHVpbnQxNihzaGEzKGJsb2NrLmJsb2NraGFzaChibG9jay5udW1iZXItMSksIG5vbmNlICkpJW1heCk7CiAgICAgICAgCiAgICAgICAgaWYgKHJlc3VsdCA8IG1pbikKICAgICAgICB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCttaW47CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIAogICAgCiAgICBtYXBwaW5nKHVpbnQyNTYgPT4gdWludDhbOF0pIHB1YmxpYyBiYXNlU3RhdHM7CgogICAgZnVuY3Rpb24gYWRkQmFzZVN0YXRzKHVpbnQyNTYgX21JZCwgdWludDhbOF0gZGF0YSkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICAvLyBsb2NrIiB0aGUgc3RhdHMgZG93biBmb3JldmVyCiAgICAgICAgLy8gc2luY2UgaHAgaXMgbmV2ZXIgZ29pbmcgdG8gYmUgMCB0aGlzIGlzIGEgdmFsaWQgY2hlY2sKICAgICAgICAvLyBzbyB3ZSBoYXZlIHRvIGJlIGV4dHJhIGNhcmVmdWwgd2hlbiBhZGRpbmcgbmV3IGJhc2VTdGF0cyEKICAgICAgICByZXF1aXJlKGRhdGFbMF0gPiAwKTsKICAgICAgICByZXF1aXJlKGJhc2VTdGF0c1tfbUlkXVswXSA9PSAwKTsKICAgICAgICBiYXNlU3RhdHNbX21JZF0gPSBkYXRhOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBfYWRkQmFzZVN0YXRzKHVpbnQyNTYgX21JZCwgdWludDhbOF0gZGF0YSkgaW50ZXJuYWwgewogICAgICAgIAogICAgICAgIAogICAgICAgIGJhc2VTdGF0c1tfbUlkXSA9IGRhdGE7CiAgICAgICAgbG9ja2VkTW9uc3RlclN0YXRzQ291bnQrKzsKICAgIH0KCgogICAgCgoKICAgIAogICAgZnVuY3Rpb24gTW9uc3RlckNyZWF0b3JJbnRlcmZhY2UoKSBwdWJsaWMgewogICAgICAgIAogICAgICAgLy8gdGhlc2UgbW9uc3RlcnMgYXJlIGFscmVhZHkgZG93biBhbmQgImxvY2tlZCIgZG93biBzdGF0cy9kZXNpZ24gd2lzZQogICAgICAgIF9hZGRCYXNlU3RhdHMoMSwgWzQ1LCA0OSwgNDksIDY1LCA2NSwgNDUsIDEyLCA0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cygyLCBbNjAsIDYyLCA2MywgODAsIDgwLCA2MCwgMTIsIDRdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDMsIFs4MCwgODIsIDgzLCAxMDAsIDEwMCwgODAsIDEyLCA0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cyg0LCBbMzksIDUyLCA0MywgNjAsIDUwLCA2NSwgMTAsIDZdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDUsIFs1OCwgNjQsIDU4LCA4MCwgNjUsIDgwLCAxMCwgNl0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoNiwgWzc4LCA4NCwgNzgsIDEwOSwgODUsIDEwMCwgMTAsIDZdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDcsIFs0NCwgNDgsIDY1LCA1MCwgNjQsIDQzLCAxMSwgMTRdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDgsIFs1OSwgNjMsIDgwLCA2NSwgODAsIDU4LCAxMSwgMTRdKTsKICAgICAgICBfYWRkQmFzZVN0YXRzKDksIFs3OSwgODMsIDEwMCwgODUsIDEwNSwgNzgsIDExLCAxNF0pOwogICAgICAgIF9hZGRCYXNlU3RhdHMoMTAsIFs0MCwgMzUsIDMwLCAyMCwgMjAsIDUwLCA3LCA0XSk7CiAgICAgICAgCiAgICAgICAgX2FkZEJhc2VTdGF0cygxNDksIFs1NSwgNTAsIDQ1LCAxMzUsIDk1LCAxMjAsIDgsIDE0XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cygxNTAsIFs5MSwgMTM0LCA5NSwgMTAwLCAxMDAsIDgwLCAyLCA1XSk7CiAgICAgICAgX2FkZEJhc2VTdGF0cygxNTEsIFsxMDAsIDEwMCwgMTAwLCAxMDAsIDEwMCwgMTAwLCA1LCAxOV0pOwogICAgfQogICAgCiAgICAvLyB0aGlzIHNlcnZlcyBhcyBhIGxvb2t1cCBmb3IgbmV3IG1vbnN0ZXJzIHRvIGJlIGdlbmVyYXRlZCBzaW5jZSBhbGwgbW9uc3RlcnMgCiAgICAvLyBvZiB0aGUgc2FtZSBpZCBzaGFyZSB0aGUgYmFzZSBzdGF0cwogICAgZnVuY3Rpb24gZ2V0TW9uc3RlclN0YXRzKCB1aW50MjU2IF9tSUQpIGV4dGVybmFsIGNvbnN0YW50IHJldHVybnModWludDhbOF0gc3RhdHMpIHsKICAgICAgICAgICBzdGF0c1swXSA9IGJhc2VTdGF0c1tfbUlEXVswXTsKICAgICAgICAgICBzdGF0c1sxXSA9IGJhc2VTdGF0c1tfbUlEXVsxXTsKICAgICAgICAgICBzdGF0c1syXSA9IGJhc2VTdGF0c1tfbUlEXVsyXTsKICAgICAgICAgICBzdGF0c1szXSA9IGJhc2VTdGF0c1tfbUlEXVszXTsKICAgICAgICAgICBzdGF0c1s0XSA9IGJhc2VTdGF0c1tfbUlEXVs0XTsKICAgICAgICAgICBzdGF0c1s1XSA9IGJhc2VTdGF0c1tfbUlEXVs1XTsKICAgICAgICAgICBzdGF0c1s2XSA9IGJhc2VTdGF0c1tfbUlEXVs2XTsKICAgICAgICAgICBzdGF0c1s3XSA9IGJhc2VTdGF0c1tfbUlEXVs3XTsKICAgICAgICAgICAKICAgICAgICAgIAoKICAgICAgICB9CgogICAgICAgIC8vIGdlbmVyYXRlcyByYW5kb21pemVkIElWcyBmb3IgYSBuZXcgbW9uc3RlcgogICAgICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXJJVnMoKSBleHRlcm5hbCByZXR1cm5zKHVpbnQ4WzddIGl2cykgewoKICAgICAgICAgICAgYm9vbCBzaGlueSA9IGZhbHNlOwoKICAgICAgICAgICAgdWludDE2IGNoYW5jZSA9IHNoaW55UmFuZCgxLCA4MTkyKTsKCiAgICAgICAgICAgIGlmIChjaGFuY2UgPT0gNDIpIHsKICAgICAgICAgICAgICAgIHNoaW55ID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSVZzIHJhbmdlIGJldHdlZW4gMCBhbmQgMzEKICAgICAgICAgICAgLy8gc3RhdCByYW5nZSBtb2RpZmllZCBmb3Igc2hpbnkgbW9uc3RlcnMhCiAgICAgICAgICAgIGlmIChzaGlueSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBpdnNbMF0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzFdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1syXSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbM10gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzRdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s1XSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNl0gPSAxOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpdnNbMF0gPSB1aW50OChyYW5kKDAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMV0gPSB1aW50OChyYW5kKDAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMl0gPSB1aW50OChyYW5kKDAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbM10gPSB1aW50OChyYW5kKDAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNF0gPSB1aW50OChyYW5kKDAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNV0gPSB1aW50OChyYW5kKDAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNl0gPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAKCiAgICAgICAgfQoKCiAgICAgICAgLy8gZ2VuMCBtb25zdGVycyBwcm9maXQgZnJvbSBzaGlueSBib29zdCB3aGlsZSBzaGlueSBnZW4wcyBoYXZlIHBvdGVudGlhbGx5IGV2ZW4gaGlnaGVyIElWcyEKICAgICAgICAvLyBmdXJ0aGVyIGluY3JlYXNpbmcgdGhlIHJhcml0eSBieSBhbHNvIGRvdWJsaW5nIHRoZSBzaGlueSBjaGFuY2UhCiAgICAgICAgZnVuY3Rpb24gZ2V0R2VuMElWcygpIGV4dGVybmFsIHJldHVybnMgKHVpbnQ4WzddIGl2cykgewogICAgICAgICAgICAKICAgICAgICAgICAgYm9vbCBzaGlueSA9IGZhbHNlOwoKICAgICAgICAgICAgdWludDE2IGNoYW5jZSA9IHNoaW55UmFuZCgxLCA0MDk2KTsKCiAgICAgICAgICAgIGlmIChjaGFuY2UgPT0gNDIpIHsKICAgICAgICAgICAgICAgIHNoaW55ID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHNoaW55KSB7CiAgICAgICAgICAgICAgICAgaXZzWzBdID0gdWludDgocmFuZCgxNSwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1sxXSA9IHVpbnQ4KHJhbmQoMTUsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMl0gPSB1aW50OChyYW5kKDE1LCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzNdID0gdWludDgocmFuZCgxNSwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s0XSA9IHVpbnQ4KHJhbmQoMTUsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNV0gPSB1aW50OChyYW5kKDE1LCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzZdID0gMTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXZzWzBdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1sxXSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbMl0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzNdID0gdWludDgocmFuZCgxMCwgMzEpKTsKICAgICAgICAgICAgICAgIGl2c1s0XSA9IHVpbnQ4KHJhbmQoMTAsIDMxKSk7CiAgICAgICAgICAgICAgICBpdnNbNV0gPSB1aW50OChyYW5kKDEwLCAzMSkpOwogICAgICAgICAgICAgICAgaXZzWzZdID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gd2l0aGRyYXdCYWxhbmNlKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgIAogICAgICAgIHVpbnQyNTYgYmFsYW5jZSA9IHRoaXMuYmFsYW5jZTsKICAgICAgIAogICAgICAgCiAgICAgICAgb3duZXIudHJhbnNmZXIoYmFsYW5jZSk7CiAgICAgICAgCiAgICB9Cn0KCmNvbnRyYWN0IEdhbWVMb2dpY0NvbnRyYWN0IHsKICAgIAogICAgYm9vbCBwdWJsaWMgaXNHYW1lTG9naWNDb250cmFjdCA9IHRydWU7CiAgICAKICAgIGZ1bmN0aW9uIEdhbWVMb2dpY0NvbnRyYWN0KCkgcHVibGljIHsKICAgICAgICAKICAgIH0KfQoKY29udHJhY3QgQ2hhaW5Nb25zdGVyc0NvcmUgaXMgQ2hhaW5Nb25zdGVyc0F1Y3Rpb24sIE93bmFibGUgewoKCiAgIC8vIHVzaW5nIGEgYm9vbCB0byBlbmFibGUgdXMgdG8gcHJlcGFyZSB0aGUgZ2FtZSAKICAgYm9vbCBoYXNMYXVuY2hlZCA9IGZhbHNlOwoKCiAgICAvLyB0aGlzIGFkZHJlc3Mgd2lsbCBob2xkIGZ1dHVyZSBnYW1lbG9naWMgaW4gcGxhY2UKICAgIGFkZHJlc3MgZ2FtZUNvbnRyYWN0OwogICAgCgogICAgZnVuY3Rpb24gQ2hhaW5Nb25zdGVyc0NvcmUoKSBwdWJsaWMgewoKICAgICAgICBhZG1pbkFkZHJlc3MgPSBtc2cuc2VuZGVyOwogICAgICAgIAoKICAgICAgICBfY3JlYXRlQXJlYSgpOyAvLyBhcmVhIDEKICAgICAgICBfY3JlYXRlQXJlYSgpOyAvLyBhcmVhIDIKICAgICAgICAKICAgIAoKICAgICAgICAKICAgIH0KICAgIAogICAgLy8gd2UgZG9uJ3Qga25vdyB0aGUgZXhhY3QgaW50ZXJmYWNlcyB5ZXQgc28gdXNlIHRoZSBsb2NrZWRNb25zdGVyU3RhdHMgdmFsdWUgdG8gZGV0ZXJtaW5lIGlmIHRoZSBnYW1lIGlzICJyZWFkeSIKICAgIC8vIHNlZSBXaGl0ZVBhcGVyIGZvciBleHBsYWluYXRpb24gZm9yIG91ciB1cGdyYWRlIGFuZCBkZXZlbG9wbWVudCByb2FkbWFwCiAgICBmdW5jdGlvbiBzZXRHYW1lTG9naWNDb250cmFjdChhZGRyZXNzIF9jYW5kaWRhdGVDb250cmFjdCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICByZXF1aXJlKG1vbnN0ZXJDcmVhdG9yLmxvY2tlZE1vbnN0ZXJTdGF0c0NvdW50KCkgPT0gMTUxKTsKICAgICAgICAKICAgICAgICByZXF1aXJlKEdhbWVMb2dpY0NvbnRyYWN0KF9jYW5kaWRhdGVDb250cmFjdCkuaXNHYW1lTG9naWNDb250cmFjdCgpKTsKICAgICAgICBnYW1lQ29udHJhY3QgPSBfY2FuZGlkYXRlQ29udHJhY3Q7CiAgICB9CgogICAgLy8gb25seSBjYWxsYWJsZSBieSBnYW1lQ29udHJhY3QgYWZ0ZXIgdGhlIGZ1bGwgZ2FtZSBpcyBsYXVuY2hlZAogICAgLy8gc2luY2UgYWxsIGFkZGl0aW9uYWwgbW9uc3RlcnMgYWZ0ZXIgdGhlIHByb21vL2dlbjAgb25lcyBuZWVkIHRvIHVzZSB0aGlzIGNvcmVDb250cmFjdAogICAgLy8gY29udHJhY3QgYXMgd2VsbCB3ZSBoYXZlIHRvIHByZXBhcmUgdGhpcyBjb3JlIGZvciBvdXIgZnV0dXJlIHVwZGF0ZXMgd2hlcmUKICAgIC8vIHBsYXllcnMgY2FuIGZyZWVseSByb2FtIHRoZSB3b3JsZCBhbmQgaHVudCBDaGFpbk1vbnN0ZXJzIHRodXMgZ2VuZXJhdGluZyBtb3JlCiAgICBmdW5jdGlvbiBzcGF3bk1vbnN0ZXIodWludDI1NiBfbUlkLCBhZGRyZXNzIF9vd25lcikgZXh0ZXJuYWwgewogICAgICAgICAKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gZ2FtZUNvbnRyYWN0KTsKICAgICAgICAKICAgICAgICB1aW50OFs4XSBtZW1vcnkgU3RhdHMgPSB1aW50OFs4XShtb25zdGVyQ3JlYXRvci5nZXRNb25zdGVyU3RhdHModWludDI1NihfbUlkKSkpOwogICAgICAgIHVpbnQ4WzddIG1lbW9yeSBJVnMgPSB1aW50OFs3XShtb25zdGVyQ3JlYXRvci5nZXRNb25zdGVySVZzKCkpOwogICAgICAgIAogICAgICAgIC8vIGltcG9ydGFudCB0byBub3RlIHRoYXQgdGhlIElWIGdlbmVyYXRvcnMgZG8gbm90IHVzZSBHZW4wIG1ldGhvZHMgYW5kIGFyZSBHZW5lcmF0aW9uIDEgCiAgICAgICAgLy8gdGhpcyBtZWFucyB0aGVyZSB3b24ndCBiZSBtb3JlIHRoYW4gdGhlIDEwLDAwMCBHZW4wIG1vbnN0ZXJzIHNvbGQgZHVyaW5nIHRoZSBkZXZlbG9wbWVudCB0aHJvdWdoIHRoZSBtYXJrZXRwbGFjZQogICAgICAgIHVpbnQyNTYgbW9uc3RlcklkID0gX2NyZWF0ZU1vbnN0ZXIoMSwgU3RhdHNbMF0sIFN0YXRzWzFdLCBTdGF0c1syXSwgU3RhdHNbM10sIFN0YXRzWzRdLCBTdGF0c1s1XSwgU3RhdHNbNl0sIFN0YXRzWzddLCBfb3duZXIsIF9tSWQsIHRydWUpOwogICAgICAgIG1vbnN0ZXJJZFRvVHJhZGVhYmxlW21vbnN0ZXJJZF0gPSB0cnVlOwoKICAgICAgICBtb25zdGVySWRUb0lWc1ttb25zdGVySWRdID0gSVZzOwogICAgfQogICAgCiAgICAKICAgIC8vIHVzZWQgdG8gYWRkIHBsYXlhYmxlIGNvbnRlbnQgdG8gdGhlIGdhbWUgCiAgICAvLyBtb25zdGVycyB3aWxsIG9ubHkgc3Bhd24gaW4gY2VydGFpbiBhcmVhcyBzbyBzb21lIGFyZSBsb2NrZWQgb24gcmVsZWFzZQogICAgLy8gZHVlIHRvIHRoZSBnYW1lIGJlaW5nIGluIGFjdGl2ZSBkZXZlbG9wbWVudCBvbiAibGF1bmNoIgogICAgLy8gZWFjaCBtb25zdGVyIGhhcyBhIG1heGltdW0gbnVtYmVyIG9mIDMgYXJlYXMgd2hlcmUgaXQgY2FuIGFwcGVhcgogICAgLy8gCiAgICAgZnVuY3Rpb24gY3JlYXRlQXJlYSgpIHB1YmxpYyBvbmx5QWRtaW4gewogICAgICAgICAgICBfY3JlYXRlQXJlYSgpOwogICAgICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVUcmFpbmVyKHN0cmluZyBfdXNlcm5hbWUsIHVpbnQxNiBfc3RhcnRlcklkKSBwdWJsaWMgewogICAgICAgICAgICAKICAgICAgICAgICAgcmVxdWlyZShoYXNMYXVuY2hlZCk7CgogICAgICAgICAgICAvLyBvbmx5IG9uZSB0cmFpbmVyL2FjY291bnQgcGVyIGV0aGVyZXVtIGFkZHJlc3MKICAgICAgICAgICAgcmVxdWlyZShhZGRyZXNzVG9UcmFpbmVyW21zZy5zZW5kZXJdLm93bmVyID09IDApOwogICAgICAgICAgIAogICAgICAgICAgIC8vIHZhbGlkIGlucHV0IGNoZWNrCiAgICAgICAgICAgIHJlcXVpcmUoX3N0YXJ0ZXJJZCA9PSAxIHx8IF9zdGFydGVySWQgPT0gMiB8fCBfc3RhcnRlcklkID09IDMgKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVpbnQyNTYgbW9uID0gX2NyZWF0ZVRyYWluZXIoX3VzZXJuYW1lLCBfc3RhcnRlcklkLCBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGR1ZSB0byBzdGFjayBsaW1pdGF0aW9ucyB3ZSBoYXZlIHRvIGFzc2lnbiB0aGUgSVZzIGhlcmU6CiAgICAgICAgICAgIHVpbnQ4WzddIG1lbW9yeSBJVnMgPSB1aW50OFs3XShtb25zdGVyQ3JlYXRvci5nZXRNb25zdGVySVZzKCkpOwogICAgICAgICAgICBtb25zdGVySWRUb0lWc1ttb25dID0gSVZzOwogICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgCiAgICBmdW5jdGlvbiBjaGFuZ2VVc2VybmFtZShzdHJpbmcgX25hbWUpIHB1YmxpYyB7CiAgICAgICAgICAgIHJlcXVpcmUoYWRkcmVzc1RvVHJhaW5lclttc2cuc2VuZGVyXS5vd25lciA9PSBtc2cuc2VuZGVyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICBhZGRyZXNzVG9UcmFpbmVyW21zZy5zZW5kZXJdLnVzZXJuYW1lID0gX25hbWU7CiAgICAgICAgfQogICAgICAgIAogICAgZnVuY3Rpb24gY2hhbmdlTW9uc3Rlck5pY2tuYW1lKHVpbnQyNTYgX3Rva2VuSWQsIHN0cmluZyBfbmFtZSkgcHVibGljIHsKICAgICAgICAgICAgLy8gdXNlcnMgd29uJ3QgYmUgYWJsZSB0byByZW5hbWUgYSBtb25zdGVyIHRoYXQgaXMgcGFydCBvZiBhbiBhdWN0aW9uCiAgICAgICAgICAgIHJlcXVpcmUoX293bnMobXNnLnNlbmRlciwgX3Rva2VuSWQpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBzb21lIHN0cmluZyBjaGVja3MuLi4/CiAgICAgICAgICAgIG1vbnN0ZXJJZFRvTmlja25hbWVbX3Rva2VuSWRdID0gX25hbWU7CiAgICAgICAgfQoKICAgIGZ1bmN0aW9uIG1vdmVUb0FyZWEodWludDE2IF9uZXdBcmVhKSBwdWJsaWMgewogICAgICAgICAgIAogICAgICAgICAgICAvLyBuZXZlciBhbGxvdyBhbnlvbmUgdG8gbW92ZSB0byBhcmVhIDAgb3IgYmVsb3cgc2luY2UgdGhpcyBpcyB1c2VkCiAgICAgICAgICAgIC8vIHRvIGRldGVybWluZSBpZiBhIHRyYWluZXIgcHJvZmlsZSBleGlzdHMgaW4gYW5vdGhlciBtZXRob2QhCiAgICAgICAgICAgIHJlcXVpcmUoX25ld0FyZWEgPiAwKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IHRoaXMgYXJlYSBleGlzdHMgeWV0IQogICAgICAgICAgICByZXF1aXJlKGFyZWFzLmxlbmd0aCA+PSBfbmV3QXJlYSk7CiAgICAgICAgICAgICAKICAgICAgICAgICAgLy8gd2hlbiBwbGF5ZXIgaXMgbm90IHN0dWNrIGRvaW5nIHNvbWV0aGluZyBlbHNlIGhlIGNhbiBtb3ZlIGZyZWVseSEKICAgICAgICAgICAgX21vdmVUb0FyZWEoX25ld0FyZWEsIG1zZy5zZW5kZXIpOwogICAgICAgIH0KCiAgICAKICAgIC8vIHRvIGJlIGNoYW5nZWQgdG8gcmV0cmlldmUgY3VycmVudCBzdGF0cyEKICAgIGZ1bmN0aW9uIGdldE1vbnN0ZXIodWludDI1NiBfaWQpIGV4dGVybmFsIHZpZXcgcmV0dXJucyAoCiAgICAgICAgdWludDI1NiBiaXJ0aFRpbWUsCiAgICAgICAgdWludDI1NiBnZW5lcmF0aW9uLAogICAgICAgIHVpbnQyNTYgaHAsCiAgICAgICAgdWludDI1NiBhdHRhY2ssCiAgICAgICAgdWludDI1NiBkZWZlbnNlLAogICAgICAgIHVpbnQyNTYgc3BBdHRhY2ssCiAgICAgICAgdWludDI1NiBzcERlZmVuc2UsCiAgICAgICAgdWludDI1NiBzcGVlZCwKICAgICAgICB1aW50MjU2IHR5cGVPbmUsCiAgICAgICAgdWludDI1NiB0eXBlVHdvLAogICAgICAgIAogICAgICAgIHVpbnQyNTYgbUlELAogICAgICAgIGJvb2wgdHJhZGVhYmxlLCAKICAgICAgICB1aW50MjU2IHVJRAogICAgICAgIAogICAgICAgICAgICAKICAgICAgICApIHsgICAgCiAgICAgICBNb25zdGVyIHN0b3JhZ2UgbW9uID0gbW9uc3RlcnNbX2lkXTsKICAgICAgICBiaXJ0aFRpbWUgPSB1aW50MjU2KG1vbi5iaXJ0aFRpbWUpOwogICAgICAgIGdlbmVyYXRpb24gPSAwOyAvLyBoYXJkY29kaW5nIGR1ZSB0byBzdGFjayB0b28gZGVlcCBlcnJvcgogICAgICAgIGhwID0gdWludDI1Nihtb24uaHApOwogICAgICAgIGF0dGFjayA9IHVpbnQyNTYobW9uLmF0dGFjayk7CiAgICAgICAgZGVmZW5zZSA9IHVpbnQyNTYobW9uLmRlZmVuc2UpOwogICAgICAgIHNwQXR0YWNrID0gdWludDI1Nihtb24uc3BBdHRhY2spOwogICAgICAgIHNwRGVmZW5zZSA9IHVpbnQyNTYobW9uLnNwRGVmZW5zZSk7CiAgICAgICAgc3BlZWQgPSB1aW50MjU2KG1vbi5zcGVlZCk7CiAgICAgICAgdHlwZU9uZSA9IHVpbnQyNTYobW9uLnR5cGVPbmUpOwogICAgICAgIHR5cGVUd28gPSB1aW50MjU2KG1vbi50eXBlVHdvKTsKICAgICAgICBtSUQgPSB1aW50MjU2KG1vbi5tSUQpOwogICAgICAgIHRyYWRlYWJsZSA9IGJvb2wobW9uLnRyYWRlYWJsZSk7CiAgICAgICAgCiAgICAgICAgLy8gaGFjayB0byBvdmVyY29tZSBzb2xpZGl0eSdzIHN0YWNrIGxpbWl0YXRpb24gaW4gbW9uc3RlciBzdHJ1Y3QuLi4uCiAgICAgICAgdUlEID0gX2lkOwogICAgICAgICAgICAKICAgICAgICB9CgogICAgICAgIAogICAgICAgIC8vIHRoaXMgbWV0aG9kIG9ubHkgcmV0dXJucyB0aGUgImJhc2UiIHBvd2VybGV2ZWwgb2YgYSBtb25zdGVyIHdoaWNoIHdpbGwgYmUgdXNlZAogICAgICAgIC8vIGluIG1vcmUgYWR2YW5jZWQgZmlnaHRpbmcgY2FsY3VsYXRpb25zIGxhdGVyIG9uCiAgICBmdW5jdGlvbiBnZXRNb25zdGVyUG93ZXJMZXZlbCh1aW50MjU2IF90b2tlbklkKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKAogICAgICAgICAgICB1aW50MjU2IHBvd2VybGV2ZWwKICAgICAgICApIHsKICAgICAgICAgICAgTW9uc3RlciBzdG9yYWdlIG1vbiA9IG1vbnN0ZXJzW190b2tlbklkXTsKICAgICAgICAgICAgdWludDhbN10gc3RvcmFnZSBJVnMgPSBtb25zdGVySWRUb0lWc1tfdG9rZW5JZF07CgogICAgICAgICAgICAKICAgICAgICAgICAgcG93ZXJsZXZlbCA9IG1vbi5ocCArIElWc1swXSArIG1vbi5hdHRhY2sgKyBJVnNbMV0gKyBtb24uZGVmZW5zZSArIElWc1syXSArIG1vbi5zcEF0dGFjayArIElWc1szXSArIG1vbi5zcERlZmVuc2UgKyBJVnNbNF0gKyBtb24uc3BlZWQgKyBJVnNbNV07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIAoKICAgCiAgICAKICAgIGZ1bmN0aW9uIGlzVHJhaW5lcihhZGRyZXNzIF9jaGVjaykKICAgIGV4dGVybmFsIAogICAgdmlldyAKICAgIHJldHVybnMgKAogICAgICAgIGJvb2wgaXNUcmFpbmVyCiAgICApIHsKICAgICAgICBUcmFpbmVyIHN0b3JhZ2UgdHJhaW5lciA9IGFkZHJlc3NUb1RyYWluZXJbX2NoZWNrXTsKCiAgICAgICAgaWYgKHRyYWluZXIuY3VyckFyZWEgPiAwKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgCgogICAgCiAgIAogICAKICAgIGZ1bmN0aW9uIHdpdGhkcmF3QmFsYW5jZSgpIGV4dGVybmFsIG9ubHlPd25lciB7CiAgICAgICAKICAgICAgICB1aW50MjU2IGJhbGFuY2UgPSB0aGlzLmJhbGFuY2U7CiAgICAgICAKICAgICAgIAogICAgICAgIG93bmVyLnRyYW5zZmVyKGJhbGFuY2UpOwogICAgICAgIAogICAgfQoKICAgIC8vIGFmdGVyIHdlIGhhdmUgc2V0dXAgZXZlcnl0aGluZyB3ZSBjYW4gdW5sb2NrIHRoZSBnYW1lCiAgICAvLyBmb3IgcHVibGljCiAgICBmdW5jdGlvbiBsYXVuY2hHYW1lKCkgZXh0ZXJuYWwgb25seU93bmVyIHsKICAgICAgICBoYXNMYXVuY2hlZCA9IHRydWU7CiAgICB9Cn0='.
	

]
