Class {
	#name : #SRTb919b2903e07293bc84372471a7081ecb69e8d36,
	#superclass : #SRTContracts,
	#category : #SolidityTestingResources
}

{ #category : #base64 }
SRTb919b2903e07293bc84372471a7081ecb69e8d36 >> base64 [
	^ 'cHJhZ21hIHNvbGlkaXR5IF4wLjQuODsKCi8vIDxPUkFDTElaRV9BUEk+Ci8qCkNvcHlyaWdodCAoYykgMjAxNS0yMDE2IE9yYWNsaXplIFNSTApDb3B5cmlnaHQgKGMpIDIwMTYgT3JhY2xpemUgTFRECgoKClBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwp0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwpmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKCgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgphbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOClRIRSBTT0ZUV0FSRS4KKi8KCnByYWdtYSBzb2xpZGl0eSBeMC40LjA7Ly9wbGVhc2UgaW1wb3J0IG9yYWNsaXplQVBJX3ByZTAuNC5zb2wgd2hlbiBzb2xpZGl0eSA8IDAuNC4wCgpjb250cmFjdCBPcmFjbGl6ZUkgewogICAgYWRkcmVzcyBwdWJsaWMgY2JBZGRyZXNzOwogICAgZnVuY3Rpb24gcXVlcnkodWludCBfdGltZXN0YW1wLCBzdHJpbmcgX2RhdGFzb3VyY2UsIHN0cmluZyBfYXJnKSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5X3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIHF1ZXJ5Mih1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIpIHBheWFibGUgcmV0dXJucyAoYnl0ZXMzMiBfaWQpOwogICAgZnVuY3Rpb24gcXVlcnkyX3dpdGhHYXNMaW1pdCh1aW50IF90aW1lc3RhbXAsIHN0cmluZyBfZGF0YXNvdXJjZSwgc3RyaW5nIF9hcmcxLCBzdHJpbmcgX2FyZzIsIHVpbnQgX2dhc2xpbWl0KSBwYXlhYmxlIHJldHVybnMgKGJ5dGVzMzIgX2lkKTsKICAgIGZ1bmN0aW9uIGdldFByaWNlKHN0cmluZyBfZGF0YXNvdXJjZSkgcmV0dXJucyAodWludCBfZHNwcmljZSk7CiAgICBmdW5jdGlvbiBnZXRQcmljZShzdHJpbmcgX2RhdGFzb3VyY2UsIHVpbnQgZ2FzbGltaXQpIHJldHVybnMgKHVpbnQgX2RzcHJpY2UpOwogICAgZnVuY3Rpb24gdXNlQ291cG9uKHN0cmluZyBfY291cG9uKTsKICAgIGZ1bmN0aW9uIHNldFByb29mVHlwZShieXRlIF9wcm9vZlR5cGUpOwogICAgZnVuY3Rpb24gc2V0Q29uZmlnKGJ5dGVzMzIgX2NvbmZpZyk7CiAgICBmdW5jdGlvbiBzZXRDdXN0b21HYXNQcmljZSh1aW50IF9nYXNQcmljZSk7Cn0KY29udHJhY3QgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIHsKICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoKSByZXR1cm5zIChhZGRyZXNzIF9hZGRyKTsKfQpjb250cmFjdCB1c2luZ09yYWNsaXplIHsKICAgIHVpbnQgY29uc3RhbnQgZGF5ID0gNjAqNjAqMjQ7CiAgICB1aW50IGNvbnN0YW50IHdlZWsgPSA2MCo2MCoyNCo3OwogICAgdWludCBjb25zdGFudCBtb250aCA9IDYwKjYwKjI0KjMwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlR5cGVfTk9ORSA9IDB4MDA7CiAgICBieXRlIGNvbnN0YW50IHByb29mVHlwZV9UTFNOb3RhcnkgPSAweDEwOwogICAgYnl0ZSBjb25zdGFudCBwcm9vZlN0b3JhZ2VfSVBGUyA9IDB4MDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfYXV0byA9IDA7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbWFpbm5ldCA9IDE7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfdGVzdG5ldCA9IDI7CiAgICB1aW50OCBjb25zdGFudCBuZXR3b3JrSURfbW9yZGVuID0gMjsKICAgIHVpbnQ4IGNvbnN0YW50IG5ldHdvcmtJRF9jb25zZW5zeXMgPSAxNjE7CgogICAgT3JhY2xpemVBZGRyUmVzb2x2ZXJJIE9BUjsKICAgIAogICAgT3JhY2xpemVJIG9yYWNsaXplOwogICAgbW9kaWZpZXIgb3JhY2xpemVBUEkgewogICAgICAgIGlmKGFkZHJlc3MoT0FSKT09MCkgb3JhY2xpemVfc2V0TmV0d29yayhuZXR3b3JrSURfYXV0byk7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgXzsKICAgIH0KICAgIG1vZGlmaWVyIGNvdXBvbihzdHJpbmcgY29kZSl7CiAgICAgICAgb3JhY2xpemUgPSBPcmFjbGl6ZUkoT0FSLmdldEFkZHJlc3MoKSk7CiAgICAgICAgb3JhY2xpemUudXNlQ291cG9uKGNvZGUpOwogICAgICAgIF87CiAgICB9CgogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0TmV0d29yayh1aW50OCBuZXR3b3JrSUQpIGludGVybmFsIHJldHVybnMoYm9vbCl7CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4MWQzYjI2MzhhN2NjOWYyY2IzZDI5OGEzZGE3YTkwYjY3ZTU1MDZlZCk+MCl7IC8vbWFpbm5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHgxZDNiMjYzOGE3Y2M5ZjJjYjNkMjk4YTNkYTdhOTBiNjdlNTUwNmVkKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweGMwM2EyNjE1ZDVlZmFmNWY0OWY2MGI3YmI2NTgzZWFlYzIxMmZkZjEpPjApeyAvL3JvcHN0ZW4gdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHhjMDNhMjYxNWQ1ZWZhZjVmNDlmNjBiN2JiNjU4M2VhZWMyMTJmZGYxKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDIwZTEyYTFmODU5YjNmZWFlNWZiMmEwYTMyYzE4ZjVhNjU1NTViYmYpPjApeyAvL2V0aGVyLmNhbXAgaWRlCiAgICAgICAgICAgIE9BUiA9IE9yYWNsaXplQWRkclJlc29sdmVySSgweDIwZTEyYTFmODU5YjNmZWFlNWZiMmEwYTMyYzE4ZjVhNjU1NTViYmYpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGdldENvZGVTaXplKDB4OTNiYmJlNWNlNzcwMzRlMzA5NWYwNDc5OTE5OTYyYTkwM2Y4OThhZCk+MCl7IC8vbm9yc2JvcmcgdGVzdG5ldAogICAgICAgICAgICBPQVIgPSBPcmFjbGl6ZUFkZHJSZXNvbHZlckkoMHg5M2JiYmU1Y2U3NzAzNGUzMDk1ZjA0Nzk5MTk5NjJhOTAzZjg5OGFkKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChnZXRDb2RlU2l6ZSgweDUxZWZhZjRjOGIzYzlhZmJkNWFiOWY0YmJjODI3ODRhYjZlZjhmYWEpPjApeyAvL2Jyb3dzZXItc29saWRpdHkKICAgICAgICAgICAgT0FSID0gT3JhY2xpemVBZGRyUmVzb2x2ZXJJKDB4NTFlZmFmNGM4YjNjOWFmYmQ1YWI5ZjRiYmM4Mjc4NGFiNmVmOGZhYSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIF9fY2FsbGJhY2soYnl0ZXMzMiBteWlkLCBzdHJpbmcgcmVzdWx0KSB7CiAgICAgICAgX19jYWxsYmFjayhteWlkLCByZXN1bHQsIG5ldyBieXRlcygwKSk7CiAgICB9CiAgICBmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCwgYnl0ZXMgcHJvb2YpIHsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gb3JhY2xpemVfZ2V0UHJpY2Uoc3RyaW5nIGRhdGFzb3VyY2UpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKHVpbnQpewogICAgICAgIHJldHVybiBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX2dldFByaWNlKHN0cmluZyBkYXRhc291cmNlLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zICh1aW50KXsKICAgICAgICByZXR1cm4gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnKTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHVpbnQgdGltZXN0YW1wLCBzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZykgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeS52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfcXVlcnkodWludCB0aW1lc3RhbXAsIHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkodGltZXN0YW1wLCBkYXRhc291cmNlLCBhcmcsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnLCB1aW50IGdhc2xpbWl0KSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSwgZ2FzbGltaXQpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSpnYXNsaW1pdCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5X3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnLCBnYXNsaW1pdCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeShzdHJpbmcgZGF0YXNvdXJjZSwgc3RyaW5nIGFyZzEsIHN0cmluZyBhcmcyKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCByZXR1cm5zIChieXRlczMyIGlkKXsKICAgICAgICB1aW50IHByaWNlID0gb3JhY2xpemUuZ2V0UHJpY2UoZGF0YXNvdXJjZSk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKjIwMDAwMCkgcmV0dXJuIDA7IC8vIHVuZXhwZWN0ZWRseSBoaWdoIHByaWNlCiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnF1ZXJ5Mi52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMikgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UpOwogICAgICAgIGlmIChwcmljZSA+IDEgZXRoZXIgKyB0eC5nYXNwcmljZSoyMDAwMDApIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTIudmFsdWUocHJpY2UpKHRpbWVzdGFtcCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMik7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9xdWVyeSh1aW50IHRpbWVzdGFtcCwgc3RyaW5nIGRhdGFzb3VyY2UsIHN0cmluZyBhcmcxLCBzdHJpbmcgYXJnMiwgdWludCBnYXNsaW1pdCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYnl0ZXMzMiBpZCl7CiAgICAgICAgdWludCBwcmljZSA9IG9yYWNsaXplLmdldFByaWNlKGRhdGFzb3VyY2UsIGdhc2xpbWl0KTsKICAgICAgICBpZiAocHJpY2UgPiAxIGV0aGVyICsgdHguZ2FzcHJpY2UqZ2FzbGltaXQpIHJldHVybiAwOyAvLyB1bmV4cGVjdGVkbHkgaGlnaCBwcmljZQogICAgICAgIHJldHVybiBvcmFjbGl6ZS5xdWVyeTJfd2l0aEdhc0xpbWl0LnZhbHVlKHByaWNlKSh0aW1lc3RhbXAsIGRhdGFzb3VyY2UsIGFyZzEsIGFyZzIsIGdhc2xpbWl0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9yYWNsaXplX3F1ZXJ5KHN0cmluZyBkYXRhc291cmNlLCBzdHJpbmcgYXJnMSwgc3RyaW5nIGFyZzIsIHVpbnQgZ2FzbGltaXQpIG9yYWNsaXplQVBJIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgaWQpewogICAgICAgIHVpbnQgcHJpY2UgPSBvcmFjbGl6ZS5nZXRQcmljZShkYXRhc291cmNlLCBnYXNsaW1pdCk7CiAgICAgICAgaWYgKHByaWNlID4gMSBldGhlciArIHR4Lmdhc3ByaWNlKmdhc2xpbWl0KSByZXR1cm4gMDsgLy8gdW5leHBlY3RlZGx5IGhpZ2ggcHJpY2UKICAgICAgICByZXR1cm4gb3JhY2xpemUucXVlcnkyX3dpdGhHYXNMaW1pdC52YWx1ZShwcmljZSkoMCwgZGF0YXNvdXJjZSwgYXJnMSwgYXJnMiwgZ2FzbGltaXQpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfY2JBZGRyZXNzKCkgb3JhY2xpemVBUEkgaW50ZXJuYWwgcmV0dXJucyAoYWRkcmVzcyl7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLmNiQWRkcmVzcygpOwogICAgfQogICAgZnVuY3Rpb24gb3JhY2xpemVfc2V0UHJvb2YoYnl0ZSBwcm9vZlApIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0UHJvb2ZUeXBlKHByb29mUCk7CiAgICB9CiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDdXN0b21HYXNQcmljZSh1aW50IGdhc1ByaWNlKSBvcmFjbGl6ZUFQSSBpbnRlcm5hbCB7CiAgICAgICAgcmV0dXJuIG9yYWNsaXplLnNldEN1c3RvbUdhc1ByaWNlKGdhc1ByaWNlKTsKICAgIH0gICAgCiAgICBmdW5jdGlvbiBvcmFjbGl6ZV9zZXRDb25maWcoYnl0ZXMzMiBjb25maWcpIG9yYWNsaXplQVBJIGludGVybmFsIHsKICAgICAgICByZXR1cm4gb3JhY2xpemUuc2V0Q29uZmlnKGNvbmZpZyk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q29kZVNpemUoYWRkcmVzcyBfYWRkcikgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50IF9zaXplKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBfc2l6ZSA6PSBleHRjb2Rlc2l6ZShfYWRkcikKICAgICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIHBhcnNlQWRkcihzdHJpbmcgX2EpIGludGVybmFsIHJldHVybnMgKGFkZHJlc3MpewogICAgICAgIGJ5dGVzIG1lbW9yeSB0bXAgPSBieXRlcyhfYSk7CiAgICAgICAgdWludDE2MCBpYWRkciA9IDA7CiAgICAgICAgdWludDE2MCBiMTsKICAgICAgICB1aW50MTYwIGIyOwogICAgICAgIGZvciAodWludCBpPTI7IGk8MisyKjIwOyBpKz0yKXsKICAgICAgICAgICAgaWFkZHIgKj0gMjU2OwogICAgICAgICAgICBiMSA9IHVpbnQxNjAodG1wW2ldKTsKICAgICAgICAgICAgYjIgPSB1aW50MTYwKHRtcFtpKzFdKTsKICAgICAgICAgICAgaWYgKChiMSA+PSA5NykmJihiMSA8PSAxMDIpKSBiMSAtPSA4NzsKICAgICAgICAgICAgZWxzZSBpZiAoKGIxID49IDQ4KSYmKGIxIDw9IDU3KSkgYjEgLT0gNDg7CiAgICAgICAgICAgIGlmICgoYjIgPj0gOTcpJiYoYjIgPD0gMTAyKSkgYjIgLT0gODc7CiAgICAgICAgICAgIGVsc2UgaWYgKChiMiA+PSA0OCkmJihiMiA8PSA1NykpIGIyIC09IDQ4OwogICAgICAgICAgICBpYWRkciArPSAoYjEqMTYrYjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWRkcmVzcyhpYWRkcik7CiAgICB9CgoKICAgIGZ1bmN0aW9uIHN0ckNvbXBhcmUoc3RyaW5nIF9hLCBzdHJpbmcgX2IpIGludGVybmFsIHJldHVybnMgKGludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiID0gYnl0ZXMoX2IpOwogICAgICAgIHVpbnQgbWluTGVuZ3RoID0gYS5sZW5ndGg7CiAgICAgICAgaWYgKGIubGVuZ3RoIDwgbWluTGVuZ3RoKSBtaW5MZW5ndGggPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBtaW5MZW5ndGg7IGkgKyspCiAgICAgICAgICAgIGlmIChhW2ldIDwgYltpXSkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgZWxzZSBpZiAoYVtpXSA+IGJbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICBpZiAoYS5sZW5ndGggPCBiLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIDA7CiAgIH0gCgogICAgZnVuY3Rpb24gaW5kZXhPZihzdHJpbmcgX2hheXN0YWNrLCBzdHJpbmcgX25lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoaW50KQogICAgewogICAgICAgIGJ5dGVzIG1lbW9yeSBoID0gYnl0ZXMoX2hheXN0YWNrKTsKICAgICAgICBieXRlcyBtZW1vcnkgbiA9IGJ5dGVzKF9uZWVkbGUpOwogICAgICAgIGlmKGgubGVuZ3RoIDwgMSB8fCBuLmxlbmd0aCA8IDEgfHwgKG4ubGVuZ3RoID4gaC5sZW5ndGgpKSAKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgaWYoaC5sZW5ndGggPiAoMioqMTI4IC0xKSkKICAgICAgICAgICAgcmV0dXJuIC0xOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICB1aW50IHN1YmluZGV4ID0gMDsKICAgICAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgaC5sZW5ndGg7IGkgKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChoW2ldID09IG5bMF0pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPSAxOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKHN1YmluZGV4IDwgbi5sZW5ndGggJiYgKGkgKyBzdWJpbmRleCkgPCBoLmxlbmd0aCAmJiBoW2kgKyBzdWJpbmRleF0gPT0gbltzdWJpbmRleF0pCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCsrOwogICAgICAgICAgICAgICAgICAgIH0gICAKICAgICAgICAgICAgICAgICAgICBpZihzdWJpbmRleCA9PSBuLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGludChpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfSAgIAogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jLCBzdHJpbmcgX2QsIHN0cmluZyBfZSkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKXsKICAgICAgICBieXRlcyBtZW1vcnkgX2JhID0gYnl0ZXMoX2EpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmIgPSBieXRlcyhfYik7CiAgICAgICAgYnl0ZXMgbWVtb3J5IF9iYyA9IGJ5dGVzKF9jKTsKICAgICAgICBieXRlcyBtZW1vcnkgX2JkID0gYnl0ZXMoX2QpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBfYmUgPSBieXRlcyhfZSk7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBhYmNkZSA9IG5ldyBzdHJpbmcoX2JhLmxlbmd0aCArIF9iYi5sZW5ndGggKyBfYmMubGVuZ3RoICsgX2JkLmxlbmd0aCArIF9iZS5sZW5ndGgpOwogICAgICAgIGJ5dGVzIG1lbW9yeSBiYWJjZGUgPSBieXRlcyhhYmNkZSk7CiAgICAgICAgdWludCBrID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBfYmEubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JhW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmIubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JiW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmMubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JjW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmQubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JkW2ldOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBfYmUubGVuZ3RoOyBpKyspIGJhYmNkZVtrKytdID0gX2JlW2ldOwogICAgICAgIHJldHVybiBzdHJpbmcoYmFiY2RlKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iLCBzdHJpbmcgX2MsIHN0cmluZyBfZCkgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIHN0ckNvbmNhdChfYSwgX2IsIF9jLCBfZCwgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0ckNvbmNhdChzdHJpbmcgX2EsIHN0cmluZyBfYiwgc3RyaW5nIF9jKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgX2MsICIiLCAiIik7CiAgICB9CgogICAgZnVuY3Rpb24gc3RyQ29uY2F0KHN0cmluZyBfYSwgc3RyaW5nIF9iKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gc3RyQ29uY2F0KF9hLCBfYiwgIiIsICIiLCAiIik7CiAgICB9CgogICAgLy8gcGFyc2VJbnQKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSkgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBwYXJzZUludChfYSwgMCk7CiAgICB9CgogICAgLy8gcGFyc2VJbnQocGFyc2VGbG9hdCoxMF5fYikKICAgIGZ1bmN0aW9uIHBhcnNlSW50KHN0cmluZyBfYSwgdWludCBfYikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIGJ5dGVzIG1lbW9yeSBicmVzdWx0ID0gYnl0ZXMoX2EpOwogICAgICAgIHVpbnQgbWludCA9IDA7CiAgICAgICAgYm9vbCBkZWNpbWFscyA9IGZhbHNlOwogICAgICAgIGZvciAodWludCBpPTA7IGk8YnJlc3VsdC5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGlmICgoYnJlc3VsdFtpXSA+PSA0OCkmJihicmVzdWx0W2ldIDw9IDU3KSl7CiAgICAgICAgICAgICAgICBpZiAoZGVjaW1hbHMpewogICAgICAgICAgICAgICAgICAgaWYgKF9iID09IDApIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGVsc2UgX2ItLTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1pbnQgKj0gMTA7CiAgICAgICAgICAgICAgICBtaW50ICs9IHVpbnQoYnJlc3VsdFtpXSkgLSA0ODsKICAgICAgICAgICAgfSBlbHNlIGlmIChicmVzdWx0W2ldID09IDQ2KSBkZWNpbWFscyA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChfYiA+IDApIG1pbnQgKj0gMTAqKl9iOwogICAgICAgIHJldHVybiBtaW50OwogICAgfQogICAgCiAgICBmdW5jdGlvbiB1aW50MnN0cih1aW50IGkpIGludGVybmFsIHJldHVybnMgKHN0cmluZyl7CiAgICAgICAgaWYgKGkgPT0gMCkgcmV0dXJuICIwIjsKICAgICAgICB1aW50IGogPSBpOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHdoaWxlIChqICE9IDApewogICAgICAgICAgICBsZW4rKzsKICAgICAgICAgICAgaiAvPSAxMDsKICAgICAgICB9CiAgICAgICAgYnl0ZXMgbWVtb3J5IGJzdHIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICB1aW50IGsgPSBsZW4gLSAxOwogICAgICAgIHdoaWxlIChpICE9IDApewogICAgICAgICAgICBic3RyW2stLV0gPSBieXRlKDQ4ICsgaSAlIDEwKTsKICAgICAgICAgICAgaSAvPSAxMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cmluZyhic3RyKTsKICAgIH0KICAgIAogICAgCgp9Ci8vIDwvT1JBQ0xJWkVfQVBJPgoKbGlicmFyeSBzdHJpbmdzIHsKICAgIHN0cnVjdCBzbGljZSB7CiAgICAgICAgdWludCBfbGVuOwogICAgICAgIHVpbnQgX3B0cjsKICAgIH0KCiAgICBmdW5jdGlvbiBtZW1jcHkodWludCBkZXN0LCB1aW50IHNyYywgdWludCBsZW4pIHByaXZhdGUgewogICAgICAgIC8vIENvcHkgd29yZC1sZW5ndGggY2h1bmtzIHdoaWxlIHBvc3NpYmxlCiAgICAgICAgZm9yKDsgbGVuID49IDMyOyBsZW4gLT0gMzIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbXN0b3JlKGRlc3QsIG1sb2FkKHNyYykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVzdCArPSAzMjsKICAgICAgICAgICAgc3JjICs9IDMyOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29weSByZW1haW5pbmcgYnl0ZXMKICAgICAgICB1aW50IG1hc2sgPSAyNTYgKiogKDMyIC0gbGVuKSAtIDE7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBsZXQgc3JjcGFydCA6PSBhbmQobWxvYWQoc3JjKSwgbm90KG1hc2spKQogICAgICAgICAgICBsZXQgZGVzdHBhcnQgOj0gYW5kKG1sb2FkKGRlc3QpLCBtYXNrKQogICAgICAgICAgICBtc3RvcmUoZGVzdCwgb3IoZGVzdHBhcnQsIHNyY3BhcnQpKQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBhIHNsaWNlIGNvbnRhaW5pbmcgdGhlIGVudGlyZSBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc3RyaW5nIHRvIG1ha2UgYSBzbGljZSBmcm9tLgogICAgICogQHJldHVybiBBIG5ld2x5IGFsbG9jYXRlZCBzbGljZSBjb250YWluaW5nIHRoZSBlbnRpcmUgc3RyaW5nLgogICAgICovCiAgICBmdW5jdGlvbiB0b1NsaWNlKHN0cmluZyBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgcHRyIDo9IGFkZChzZWxmLCAweDIwKQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2xpY2UoYnl0ZXMoc2VsZikubGVuZ3RoLCBwdHIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBudWxsLXRlcm1pbmF0ZWQgYnl0ZXMzMiBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgdmFsdWUgdG8gZmluZCB0aGUgbGVuZ3RoIG9mLgogICAgICogQHJldHVybiBUaGUgbGVuZ3RoIG9mIHRoZSBzdHJpbmcsIGZyb20gMCB0byAzMi4KICAgICAqLwogICAgZnVuY3Rpb24gbGVuKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgcmV0OwogICAgICAgIGlmIChzZWxmID09IDApCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIGlmIChzZWxmICYgMHhmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZiA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSAxNjsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmZmZmZmZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gODsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwMDAwMDAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmZmZmZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gNDsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDAwMDAwKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYgJiAweGZmZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMjsKICAgICAgICAgICAgc2VsZiA9IGJ5dGVzMzIodWludChzZWxmKSAvIDB4MTAwMDApOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZiAmIDB4ZmYgPT0gMCkgewogICAgICAgICAgICByZXQgKz0gMTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDMyIC0gcmV0OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIGEgc2xpY2UgY29udGFpbmluZyB0aGUgZW50aXJlIGJ5dGVzMzIsIGludGVycHJldGVkIGFzIGEKICAgICAqICAgICAgbnVsbC10ZXJtaW50YWVkIHV0Zi04IHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBieXRlczMyIHZhbHVlIHRvIGNvbnZlcnQgdG8gYSBzbGljZS4KICAgICAqIEByZXR1cm4gQSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IGFyZ3VtZW50IHVwIHRvIHRoZQogICAgICogICAgICAgICBmaXJzdCBudWxsLgogICAgICovCiAgICBmdW5jdGlvbiB0b1NsaWNlQjMyKGJ5dGVzMzIgc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgcmV0KSB7CiAgICAgICAgLy8gQWxsb2NhdGUgc3BhY2UgZm9yIGBzZWxmYCBpbiBtZW1vcnksIGNvcHkgaXQgdGhlcmUsIGFuZCBwb2ludCByZXQgYXQgaXQKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBwdHIgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChwdHIsIDB4MjApKQogICAgICAgICAgICBtc3RvcmUocHRyLCBzZWxmKQogICAgICAgICAgICBtc3RvcmUoYWRkKHJldCwgMHgyMCksIHB0cikKICAgICAgICB9CiAgICAgICAgcmV0Ll9sZW4gPSBsZW4oc2VsZik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXcgc2xpY2UgY29udGFpbmluZyB0aGUgc2FtZSBkYXRhIGFzIHRoZSBjdXJyZW50IHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGNvcHkuCiAgICAgKiBAcmV0dXJuIEEgbmV3IHNsaWNlIGNvbnRhaW5pbmcgdGhlIHNhbWUgZGF0YSBhcyBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvcHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICByZXR1cm4gc2xpY2Uoc2VsZi5fbGVuLCBzZWxmLl9wdHIpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBDb3BpZXMgYSBzbGljZSB0byBhIG5ldyBzdHJpbmcuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gY29weS4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHNsaWNlJ3MgdGV4dC4KICAgICAqLwogICAgZnVuY3Rpb24gdG9TdHJpbmcoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoc3RyaW5nKSB7CiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcoc2VsZi5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQoKICAgICAgICBtZW1jcHkocmV0cHRyLCBzZWxmLl9wdHIsIHNlbGYuX2xlbik7CiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0aGUgbGVuZ3RoIGluIHJ1bmVzIG9mIHRoZSBzbGljZS4gTm90ZSB0aGF0IHRoaXMgb3BlcmF0aW9uCiAgICAgKiAgICAgIHRha2VzIHRpbWUgcHJvcG9ydGlvbmFsIHRvIHRoZSBsZW5ndGggb2YgdGhlIHNsaWNlOyBhdm9pZCB1c2luZyBpdAogICAgICogICAgICBpbiBsb29wcywgYW5kIGNhbGwgYHNsaWNlLmVtcHR5KClgIGlmIHlvdSBvbmx5IG5lZWQgdG8ga25vdyB3aGV0aGVyCiAgICAgKiAgICAgIHRoZSBzbGljZSBpcyBlbXB0eSBvciBub3QuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gVGhlIGxlbmd0aCBvZiB0aGUgc2xpY2UgaW4gcnVuZXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxlbihzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gU3RhcnRpbmcgYXQgcHRyLTMxIG1lYW5zIHRoZSBMU0Igd2lsbCBiZSB0aGUgYnl0ZSB3ZSBjYXJlIGFib3V0CiAgICAgICAgdmFyIHB0ciA9IHNlbGYuX3B0ciAtIDMxOwogICAgICAgIHZhciBlbmQgPSBwdHIgKyBzZWxmLl9sZW47CiAgICAgICAgZm9yICh1aW50IGxlbiA9IDA7IHB0ciA8IGVuZDsgbGVuKyspIHsKICAgICAgICAgICAgdWludDggYjsKICAgICAgICAgICAgYXNzZW1ibHkgeyBiIDo9IGFuZChtbG9hZChwdHIpLCAweEZGKSB9CiAgICAgICAgICAgIGlmIChiIDwgMHg4MCkgewogICAgICAgICAgICAgICAgcHRyICs9IDE7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICAgICAgcHRyICs9IDI7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICAgICAgcHRyICs9IDM7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGOCkgewogICAgICAgICAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgICAgIH0gZWxzZSBpZihiIDwgMHhGQykgewogICAgICAgICAgICAgICAgcHRyICs9IDU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwdHIgKz0gNjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGVuOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgdGhlIHNsaWNlIGlzIGVtcHR5IChoYXMgYSBsZW5ndGggb2YgMCkuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgc2xpY2UgaXMgZW1wdHksIEZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgZnVuY3Rpb24gZW1wdHkoc2xpY2Ugc2VsZikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBzZWxmLl9sZW4gPT0gMDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyBhIHBvc2l0aXZlIG51bWJlciBpZiBgb3RoZXJgIGNvbWVzIGxleGljb2dyYXBoaWNhbGx5IGFmdGVyCiAgICAgKiAgICAgIGBzZWxmYCwgYSBuZWdhdGl2ZSBudW1iZXIgaWYgaXQgY29tZXMgYmVmb3JlLCBvciB6ZXJvIGlmIHRoZQogICAgICogICAgICBjb250ZW50cyBvZiB0aGUgdHdvIHNsaWNlcyBhcmUgZXF1YWwuIENvbXBhcmlzb24gaXMgZG9uZSBwZXItcnVuZSwKICAgICAqICAgICAgb24gdW5pY29kZSBjb2RlcG9pbnRzLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbXBhcmUuCiAgICAgKiBAcGFyYW0gb3RoZXIgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUaGUgcmVzdWx0IG9mIHRoZSBjb21wYXJpc29uLgogICAgICovCiAgICBmdW5jdGlvbiBjb21wYXJlKHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChpbnQpIHsKICAgICAgICB1aW50IHNob3J0ZXN0ID0gc2VsZi5fbGVuOwogICAgICAgIGlmIChvdGhlci5fbGVuIDwgc2VsZi5fbGVuKQogICAgICAgICAgICBzaG9ydGVzdCA9IG90aGVyLl9sZW47CgogICAgICAgIHZhciBzZWxmcHRyID0gc2VsZi5fcHRyOwogICAgICAgIHZhciBvdGhlcnB0ciA9IG90aGVyLl9wdHI7CiAgICAgICAgZm9yICh1aW50IGlkeCA9IDA7IGlkeCA8IHNob3J0ZXN0OyBpZHggKz0gMzIpIHsKICAgICAgICAgICAgdWludCBhOwogICAgICAgICAgICB1aW50IGI7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGEgOj0gbWxvYWQoc2VsZnB0cikKICAgICAgICAgICAgICAgIGIgOj0gbWxvYWQob3RoZXJwdHIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEgIT0gYikgewogICAgICAgICAgICAgICAgLy8gTWFzayBvdXQgaXJyZWxldmFudCBieXRlcyBhbmQgY2hlY2sgYWdhaW4KICAgICAgICAgICAgICAgIHVpbnQgbWFzayA9IH4oMiAqKiAoOCAqICgzMiAtIHNob3J0ZXN0ICsgaWR4KSkgLSAxKTsKICAgICAgICAgICAgICAgIHZhciBkaWZmID0gKGEgJiBtYXNrKSAtIChiICYgbWFzayk7CiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPSAwKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbnQoZGlmZik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZnB0ciArPSAzMjsKICAgICAgICAgICAgb3RoZXJwdHIgKz0gMzI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnQoc2VsZi5fbGVuKSAtIGludChvdGhlci5fbGVuKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgUmV0dXJucyB0cnVlIGlmIHRoZSB0d28gc2xpY2VzIGNvbnRhaW4gdGhlIHNhbWUgdGV4dC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBmaXJzdCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNlY29uZCBzbGljZSB0byBjb21wYXJlLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZXMgYXJlIGVxdWFsLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGVxdWFscyhzbGljZSBzZWxmLCBzbGljZSBvdGhlcikgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBjb21wYXJlKHNlbGYsIG90aGVyKSA9PSAwOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBFeHRyYWN0cyB0aGUgZmlyc3QgcnVuZSBpbiB0aGUgc2xpY2UgaW50byBgcnVuZWAsIGFkdmFuY2luZyB0aGUKICAgICAqICAgICAgc2xpY2UgdG8gcG9pbnQgdG8gdGhlIG5leHQgcnVuZSBhbmQgcmV0dXJuaW5nIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIHJ1bmUgVGhlIHNsaWNlIHRoYXQgd2lsbCBjb250YWluIHRoZSBmaXJzdCBydW5lLgogICAgICogQHJldHVybiBgcnVuZWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5leHRSdW5lKHNsaWNlIHNlbGYsIHNsaWNlIHJ1bmUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgcnVuZS5fcHRyID0gc2VsZi5fcHRyOwoKICAgICAgICBpZiAoc2VsZi5fbGVuID09IDApIHsKICAgICAgICAgICAgcnVuZS5fbGVuID0gMDsKICAgICAgICAgICAgcmV0dXJuIHJ1bmU7CiAgICAgICAgfQoKICAgICAgICB1aW50IGxlbjsKICAgICAgICB1aW50IGI7CiAgICAgICAgLy8gTG9hZCB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgcnVuZSBpbnRvIHRoZSBMU0JzIG9mIGIKICAgICAgICBhc3NlbWJseSB7IGIgOj0gYW5kKG1sb2FkKHN1YihtbG9hZChhZGQoc2VsZiwgMzIpKSwgMzEpKSwgMHhGRikgfQogICAgICAgIGlmIChiIDwgMHg4MCkgewogICAgICAgICAgICBsZW4gPSAxOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhFMCkgewogICAgICAgICAgICBsZW4gPSAyOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICBsZW4gPSAzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxlbiA9IDQ7CiAgICAgICAgfQoKICAgICAgICAvLyBDaGVjayBmb3IgdHJ1bmNhdGVkIGNvZGVwb2ludHMKICAgICAgICBpZiAobGVuID4gc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIHJ1bmUuX2xlbiA9IHNlbGYuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyICs9IHNlbGYuX2xlbjsKICAgICAgICAgICAgc2VsZi5fbGVuID0gMDsKICAgICAgICAgICAgcmV0dXJuIHJ1bmU7CiAgICAgICAgfQoKICAgICAgICBzZWxmLl9wdHIgKz0gbGVuOwogICAgICAgIHNlbGYuX2xlbiAtPSBsZW47CiAgICAgICAgcnVuZS5fbGVuID0gbGVuOwogICAgICAgIHJldHVybiBydW5lOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBmaXJzdCBydW5lIGluIHRoZSBzbGljZSwgYWR2YW5jaW5nIHRoZSBzbGljZSB0byBwb2ludAogICAgICogICAgICB0byB0aGUgbmV4dCBydW5lLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcmV0dXJuIEEgc2xpY2UgY29udGFpbmluZyBvbmx5IHRoZSBmaXJzdCBydW5lIGZyb20gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBuZXh0UnVuZShzbGljZSBzZWxmKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSByZXQpIHsKICAgICAgICBuZXh0UnVuZShzZWxmLCByZXQpOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgdGhlIGZpcnN0IGNvZGVwb2ludCBpbiB0aGUgc2xpY2UuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEByZXR1cm4gVGhlIG51bWJlciBvZiB0aGUgZmlyc3QgY29kZXBvaW50IGluIHRoZSBzbGljZS4KICAgICAqLwogICAgZnVuY3Rpb24gb3JkKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKHVpbnQgcmV0KSB7CiAgICAgICAgaWYgKHNlbGYuX2xlbiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgdWludCB3b3JkOwogICAgICAgIHVpbnQgbGVuOwogICAgICAgIHVpbnQgZGl2ID0gMiAqKiAyNDg7CgogICAgICAgIC8vIExvYWQgdGhlIHJ1bmUgaW50byB0aGUgTVNCcyBvZiBiCiAgICAgICAgYXNzZW1ibHkgeyB3b3JkOj0gbWxvYWQobWxvYWQoYWRkKHNlbGYsIDMyKSkpIH0KICAgICAgICB2YXIgYiA9IHdvcmQgLyBkaXY7CiAgICAgICAgaWYgKGIgPCAweDgwKSB7CiAgICAgICAgICAgIHJldCA9IGI7CiAgICAgICAgICAgIGxlbiA9IDE7CiAgICAgICAgfSBlbHNlIGlmKGIgPCAweEUwKSB7CiAgICAgICAgICAgIHJldCA9IGIgJiAweDFGOwogICAgICAgICAgICBsZW4gPSAyOwogICAgICAgIH0gZWxzZSBpZihiIDwgMHhGMCkgewogICAgICAgICAgICByZXQgPSBiICYgMHgwRjsKICAgICAgICAgICAgbGVuID0gMzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXQgPSBiICYgMHgwNzsKICAgICAgICAgICAgbGVuID0gNDsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNrIGZvciB0cnVuY2F0ZWQgY29kZXBvaW50cwogICAgICAgIGlmIChsZW4gPiBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHVpbnQgaSA9IDE7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBkaXYgPSBkaXYgLyAyNTY7CiAgICAgICAgICAgIGIgPSAod29yZCAvIGRpdikgJiAweEZGOwogICAgICAgICAgICBpZiAoYiAmIDB4QzAgIT0gMHg4MCkgewogICAgICAgICAgICAgICAgLy8gSW52YWxpZCBVVEYtOCBzZXF1ZW5jZQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0ID0gKHJldCAqIDY0KSB8IChiICYgMHgzRik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRoZSBrZWNjYWstMjU2IGhhc2ggb2YgdGhlIHNsaWNlLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIGhhc2guCiAgICAgKiBAcmV0dXJuIFRoZSBoYXNoIG9mIHRoZSBzbGljZS4KICAgICAqLwogICAgZnVuY3Rpb24ga2VjY2FrKHNsaWNlIHNlbGYpIGludGVybmFsIHJldHVybnMgKGJ5dGVzMzIgcmV0KSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICByZXQgOj0gc2hhMyhtbG9hZChhZGQoc2VsZiwgMzIpKSwgbWxvYWQoc2VsZikpCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIHRydWUgaWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBzdGFydHNXaXRoKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5fcHRyID09IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgYm9vbCBlcXVhbDsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgfQogICAgICAgIHJldHVybiBlcXVhbDsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgSWYgYHNlbGZgIHN0YXJ0cyB3aXRoIGBuZWVkbGVgLCBgbmVlZGxlYCBpcyByZW1vdmVkIGZyb20gdGhlCiAgICAgKiAgICAgIGJlZ2lubmluZyBvZiBgc2VsZmAuIE90aGVyd2lzZSwgYHNlbGZgIGlzIHVubW9kaWZpZWQuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gb3BlcmF0ZSBvbi4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHNsaWNlIHRvIHNlYXJjaCBmb3IuCiAgICAgKiBAcmV0dXJuIGBzZWxmYAogICAgICovCiAgICBmdW5jdGlvbiBiZXlvbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIGlmIChzZWxmLl9sZW4gPCBuZWVkbGUuX2xlbikgewogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CgogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmLl9wdHIgIT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgICAgICBsZXQgc2VsZnB0ciA6PSBtbG9hZChhZGQoc2VsZiwgMHgyMCkpCiAgICAgICAgICAgICAgICBsZXQgbmVlZGxlcHRyIDo9IG1sb2FkKGFkZChuZWVkbGUsIDB4MjApKQogICAgICAgICAgICAgICAgZXF1YWwgOj0gZXEoc2hhMyhzZWxmcHRyLCBsZW4pLCBzaGEzKG5lZWRsZXB0ciwgbGVuKSkKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxdWFsKSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSBuZWVkbGUuX2xlbjsKICAgICAgICAgICAgc2VsZi5fcHRyICs9IG5lZWRsZS5fbGVuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgdHJ1ZSBpZiB0aGUgc2xpY2UgZW5kcyB3aXRoIGBuZWVkbGVgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIG9wZXJhdGUgb24uCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSBzbGljZSB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBzbGljZSBzdGFydHMgd2l0aCB0aGUgcHJvdmlkZWQgdGV4dCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBmdW5jdGlvbiBlbmRzV2l0aChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKGJvb2wpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNlbGZwdHIgPSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4gLSBuZWVkbGUuX2xlbjsKCiAgICAgICAgaWYgKHNlbGZwdHIgPT0gbmVlZGxlLl9wdHIpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBib29sIGVxdWFsOwogICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgbGV0IGxlbiA6PSBtbG9hZChuZWVkbGUpCiAgICAgICAgICAgIGxldCBuZWVkbGVwdHIgOj0gbWxvYWQoYWRkKG5lZWRsZSwgMHgyMCkpCiAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZXF1YWw7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IElmIGBzZWxmYCBlbmRzIHdpdGggYG5lZWRsZWAsIGBuZWVkbGVgIGlzIHJlbW92ZWQgZnJvbSB0aGUKICAgICAqICAgICAgZW5kIG9mIGBzZWxmYC4gT3RoZXJ3aXNlLCBgc2VsZmAgaXMgdW5tb2RpZmllZC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBvcGVyYXRlIG9uLgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgc2xpY2UgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgCiAgICAgKi8KICAgIGZ1bmN0aW9uIHVudGlsKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICBpZiAoc2VsZi5fbGVuIDwgbmVlZGxlLl9sZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfQoKICAgICAgICB2YXIgc2VsZnB0ciA9IHNlbGYuX3B0ciArIHNlbGYuX2xlbiAtIG5lZWRsZS5fbGVuOwogICAgICAgIGJvb2wgZXF1YWwgPSB0cnVlOwogICAgICAgIGlmIChzZWxmcHRyICE9IG5lZWRsZS5fcHRyKSB7CiAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgIGxldCBsZW4gOj0gbWxvYWQobmVlZGxlKQogICAgICAgICAgICAgICAgbGV0IG5lZWRsZXB0ciA6PSBtbG9hZChhZGQobmVlZGxlLCAweDIwKSkKICAgICAgICAgICAgICAgIGVxdWFsIDo9IGVxKHNoYTMoc2VsZnB0ciwgbGVuKSwgc2hhMyhuZWVkbGVwdHIsIGxlbikpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcXVhbCkgewogICAgICAgICAgICBzZWxmLl9sZW4gLT0gbmVlZGxlLl9sZW47CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvLyBSZXR1cm5zIHRoZSBtZW1vcnkgYWRkcmVzcyBvZiB0aGUgZmlyc3QgYnl0ZSBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgZmlyc3QgYnl0ZSBhZnRlciBgc2VsZmAgaWYgbm90IGZvdW5kLgogICAgZnVuY3Rpb24gZmluZFB0cih1aW50IHNlbGZsZW4sIHVpbnQgc2VsZnB0ciwgdWludCBuZWVkbGVsZW4sIHVpbnQgbmVlZGxlcHRyKSBwcml2YXRlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICB1aW50IHB0cjsKICAgICAgICB1aW50IGlkeDsKCiAgICAgICAgaWYgKG5lZWRsZWxlbiA8PSBzZWxmbGVuKSB7CiAgICAgICAgICAgIGlmIChuZWVkbGVsZW4gPD0gMzIpIHsKICAgICAgICAgICAgICAgIC8vIE9wdGltaXplZCBhc3NlbWJseSBmb3IgNjggZ2FzIHBlciBieXRlIG9uIHNob3J0IHN0cmluZ3MKICAgICAgICAgICAgICAgIGFzc2VtYmx5IHsKICAgICAgICAgICAgICAgICAgICBsZXQgbWFzayA6PSBub3Qoc3ViKGV4cCgyLCBtdWwoOCwgc3ViKDMyLCBuZWVkbGVsZW4pKSksIDEpKQogICAgICAgICAgICAgICAgICAgIGxldCBuZWVkbGVkYXRhIDo9IGFuZChtbG9hZChuZWVkbGVwdHIpLCBtYXNrKQogICAgICAgICAgICAgICAgICAgIGxldCBlbmQgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzZWxmcHRyCiAgICAgICAgICAgICAgICAgICAgbG9vcDoKICAgICAgICAgICAgICAgICAgICBqdW1waShleGl0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQocHRyLCAxKQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGx0KHN1YihwdHIsIDEpLCBlbmQpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBhZGQoc2VsZnB0ciwgc2VsZmxlbikKICAgICAgICAgICAgICAgICAgICBleGl0OgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0cjsKICAgICAgICAgICAgICAgIGZvciAoaWR4ID0gMDsgaWR4IDw9IHNlbGZsZW4gLSBuZWVkbGVsZW47IGlkeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgYnl0ZXMzMiB0ZXN0SGFzaDsKICAgICAgICAgICAgICAgICAgICBhc3NlbWJseSB7IHRlc3RIYXNoIDo9IHNoYTMocHRyLCBuZWVkbGVsZW4pIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaCA9PSB0ZXN0SGFzaCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgICAgICAgICBwdHIgKz0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VsZnB0ciArIHNlbGZsZW47CiAgICB9CgogICAgLy8gUmV0dXJucyB0aGUgbWVtb3J5IGFkZHJlc3Mgb2YgdGhlIGZpcnN0IGJ5dGUgYWZ0ZXIgdGhlIGxhc3Qgb2NjdXJyZW5jZSBvZgogICAgLy8gYG5lZWRsZWAgaW4gYHNlbGZgLCBvciB0aGUgYWRkcmVzcyBvZiBgc2VsZmAgaWYgbm90IGZvdW5kLgogICAgZnVuY3Rpb24gcmZpbmRQdHIodWludCBzZWxmbGVuLCB1aW50IHNlbGZwdHIsIHVpbnQgbmVlZGxlbGVuLCB1aW50IG5lZWRsZXB0cikgcHJpdmF0ZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCBwdHI7CgogICAgICAgIGlmIChuZWVkbGVsZW4gPD0gc2VsZmxlbikgewogICAgICAgICAgICBpZiAobmVlZGxlbGVuIDw9IDMyKSB7CiAgICAgICAgICAgICAgICAvLyBPcHRpbWl6ZWQgYXNzZW1ibHkgZm9yIDY5IGdhcyBwZXIgYnl0ZSBvbiBzaG9ydCBzdHJpbmdzCiAgICAgICAgICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1hc2sgOj0gbm90KHN1YihleHAoMiwgbXVsKDgsIHN1YigzMiwgbmVlZGxlbGVuKSkpLCAxKSkKICAgICAgICAgICAgICAgICAgICBsZXQgbmVlZGxlZGF0YSA6PSBhbmQobWxvYWQobmVlZGxlcHRyKSwgbWFzaykKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gYWRkKHNlbGZwdHIsIHN1YihzZWxmbGVuLCBuZWVkbGVsZW4pKQogICAgICAgICAgICAgICAgICAgIGxvb3A6CiAgICAgICAgICAgICAgICAgICAganVtcGkocmV0LCBlcShhbmQobWxvYWQocHRyKSwgbWFzayksIG5lZWRsZWRhdGEpKQogICAgICAgICAgICAgICAgICAgIHB0ciA6PSBzdWIocHRyLCAxKQogICAgICAgICAgICAgICAgICAgIGp1bXBpKGxvb3AsIGd0KGFkZChwdHIsIDEpLCBzZWxmcHRyKSkKICAgICAgICAgICAgICAgICAgICBwdHIgOj0gc2VsZnB0cgogICAgICAgICAgICAgICAgICAgIGp1bXAoZXhpdCkKICAgICAgICAgICAgICAgICAgICByZXQ6CiAgICAgICAgICAgICAgICAgICAgcHRyIDo9IGFkZChwdHIsIG5lZWRsZWxlbikKICAgICAgICAgICAgICAgICAgICBleGl0OgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHB0cjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEZvciBsb25nIG5lZWRsZXMsIHVzZSBoYXNoaW5nCiAgICAgICAgICAgICAgICBieXRlczMyIGhhc2g7CiAgICAgICAgICAgICAgICBhc3NlbWJseSB7IGhhc2ggOj0gc2hhMyhuZWVkbGVwdHIsIG5lZWRsZWxlbikgfQogICAgICAgICAgICAgICAgcHRyID0gc2VsZnB0ciArIChzZWxmbGVuIC0gbmVlZGxlbGVuKTsKICAgICAgICAgICAgICAgIHdoaWxlIChwdHIgPj0gc2VsZnB0cikgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzMzIgdGVzdEhhc2g7CiAgICAgICAgICAgICAgICAgICAgYXNzZW1ibHkgeyB0ZXN0SGFzaCA6PSBzaGEzKHB0ciwgbmVlZGxlbGVuKSB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2ggPT0gdGVzdEhhc2gpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwdHIgKyBuZWVkbGVsZW47CiAgICAgICAgICAgICAgICAgICAgcHRyIC09IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlbGZwdHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IE1vZGlmaWVzIGBzZWxmYCB0byBjb250YWluIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZgogICAgICogICAgICBgbmVlZGxlYCB0byB0aGUgZW5kIG9mIHRoZSBzbGljZS4gYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UKICAgICAqICAgICAgaWYgYG5lZWRsZWAgaXMgbm90IGZvdW5kLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaCBhbmQgbW9kaWZ5LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yLgogICAgICogQHJldHVybiBgc2VsZmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZpbmQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICBzZWxmLl9sZW4gLT0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIHNlbGYuX3B0ciA9IHB0cjsKICAgICAgICByZXR1cm4gc2VsZjsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgTW9kaWZpZXMgYHNlbGZgIHRvIGNvbnRhaW4gdGhlIHBhcnQgb2YgdGhlIHN0cmluZyBmcm9tIHRoZSBzdGFydCBvZgogICAgICogICAgICBgc2VsZmAgdG8gdGhlIGVuZCBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYC4gSWYgYG5lZWRsZWAKICAgICAqICAgICAgaXMgbm90IGZvdW5kLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZS4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2ggYW5kIG1vZGlmeS4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvci4KICAgICAqIEByZXR1cm4gYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiByZmluZChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUpIGludGVybmFsIHJldHVybnMgKHNsaWNlKSB7CiAgICAgICAgdWludCBwdHIgPSByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKTsKICAgICAgICBzZWxmLl9sZW4gPSBwdHIgLSBzZWxmLl9wdHI7CiAgICAgICAgcmV0dXJuIHNlbGY7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCBgdG9rZW5gIHRvIGV2ZXJ5dGhpbmcgYmVmb3JlIGl0LiBJZgogICAgICogICAgICBgbmVlZGxlYCBkb2VzIG5vdCBvY2N1ciBpbiBgc2VsZmAsIGBzZWxmYCBpcyBzZXQgdG8gdGhlIGVtcHR5IHNsaWNlLAogICAgICogICAgICBhbmQgYHRva2VuYCBpcyBzZXQgdG8gdGhlIGVudGlyZXR5IG9mIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzcGxpdC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gdG9rZW4gQW4gb3V0cHV0IHBhcmFtZXRlciB0byB3aGljaCB0aGUgZmlyc3QgdG9rZW4gaXMgd3JpdHRlbi4KICAgICAqIEByZXR1cm4gYHRva2VuYC4KICAgICAqLwogICAgZnVuY3Rpb24gc3BsaXQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlLCBzbGljZSB0b2tlbikgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UpIHsKICAgICAgICB1aW50IHB0ciA9IGZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgdG9rZW4uX3B0ciA9IHNlbGYuX3B0cjsKICAgICAgICB0b2tlbi5fbGVuID0gcHRyIC0gc2VsZi5fcHRyOwogICAgICAgIGlmIChwdHIgPT0gc2VsZi5fcHRyICsgc2VsZi5fbGVuKSB7CiAgICAgICAgICAgIC8vIE5vdCBmb3VuZAogICAgICAgICAgICBzZWxmLl9sZW4gPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGYuX2xlbiAtPSB0b2tlbi5fbGVuICsgbmVlZGxlLl9sZW47CiAgICAgICAgICAgIHNlbGYuX3B0ciA9IHB0ciArIG5lZWRsZS5fbGVuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFNwbGl0cyB0aGUgc2xpY2UsIHNldHRpbmcgYHNlbGZgIHRvIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0CiAgICAgKiAgICAgIG9jY3VycmVuY2Ugb2YgYG5lZWRsZWAsIGFuZCByZXR1cm5pbmcgZXZlcnl0aGluZyBiZWZvcmUgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIHVwIHRvIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGBkZWxpbWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICBzcGxpdChzZWxmLCBuZWVkbGUsIHRva2VuKTsKICAgIH0KCiAgICAvKioKICAgICAqIEBkZXYgU3BsaXRzIHRoZSBzbGljZSwgc2V0dGluZyBgc2VsZmAgdG8gZXZlcnl0aGluZyBiZWZvcmUgdGhlIGxhc3QKICAgICAqICAgICAgb2NjdXJyZW5jZSBvZiBgbmVlZGxlYCwgYW5kIGB0b2tlbmAgdG8gZXZlcnl0aGluZyBhZnRlciBpdC4gSWYKICAgICAqICAgICAgYG5lZWRsZWAgZG9lcyBub3Qgb2NjdXIgaW4gYHNlbGZgLCBgc2VsZmAgaXMgc2V0IHRvIHRoZSBlbXB0eSBzbGljZSwKICAgICAqICAgICAgYW5kIGB0b2tlbmAgaXMgc2V0IHRvIHRoZSBlbnRpcmV0eSBvZiBgc2VsZmAuCiAgICAgKiBAcGFyYW0gc2VsZiBUaGUgc2xpY2UgdG8gc3BsaXQuCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHBhcmFtIHRva2VuIEFuIG91dHB1dCBwYXJhbWV0ZXIgdG8gd2hpY2ggdGhlIGZpcnN0IHRva2VuIGlzIHdyaXR0ZW4uCiAgICAgKiBAcmV0dXJuIGB0b2tlbmAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIHJzcGxpdChzbGljZSBzZWxmLCBzbGljZSBuZWVkbGUsIHNsaWNlIHRva2VuKSBpbnRlcm5hbCByZXR1cm5zIChzbGljZSkgewogICAgICAgIHVpbnQgcHRyID0gcmZpbmRQdHIoc2VsZi5fbGVuLCBzZWxmLl9wdHIsIG5lZWRsZS5fbGVuLCBuZWVkbGUuX3B0cik7CiAgICAgICAgdG9rZW4uX3B0ciA9IHB0cjsKICAgICAgICB0b2tlbi5fbGVuID0gc2VsZi5fbGVuIC0gKHB0ciAtIHNlbGYuX3B0cik7CiAgICAgICAgaWYgKHB0ciA9PSBzZWxmLl9wdHIpIHsKICAgICAgICAgICAgLy8gTm90IGZvdW5kCiAgICAgICAgICAgIHNlbGYuX2xlbiA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2VsZi5fbGVuIC09IHRva2VuLl9sZW4gKyBuZWVkbGUuX2xlbjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRva2VuOwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBTcGxpdHMgdGhlIHNsaWNlLCBzZXR0aW5nIGBzZWxmYCB0byBldmVyeXRoaW5nIGJlZm9yZSB0aGUgbGFzdAogICAgICogICAgICBvY2N1cnJlbmNlIG9mIGBuZWVkbGVgLCBhbmQgcmV0dXJuaW5nIGV2ZXJ5dGhpbmcgYWZ0ZXIgaXQuIElmCiAgICAgKiAgICAgIGBuZWVkbGVgIGRvZXMgbm90IG9jY3VyIGluIGBzZWxmYCwgYHNlbGZgIGlzIHNldCB0byB0aGUgZW1wdHkgc2xpY2UsCiAgICAgKiAgICAgIGFuZCB0aGUgZW50aXJldHkgb2YgYHNlbGZgIGlzIHJldHVybmVkLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNwbGl0LgogICAgICogQHBhcmFtIG5lZWRsZSBUaGUgdGV4dCB0byBzZWFyY2ggZm9yIGluIGBzZWxmYC4KICAgICAqIEByZXR1cm4gVGhlIHBhcnQgb2YgYHNlbGZgIGFmdGVyIHRoZSBsYXN0IG9jY3VycmVuY2Ugb2YgYGRlbGltYC4KICAgICAqLwogICAgZnVuY3Rpb24gcnNwbGl0KHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoc2xpY2UgdG9rZW4pIHsKICAgICAgICByc3BsaXQoc2VsZiwgbmVlZGxlLCB0b2tlbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IENvdW50cyB0aGUgbnVtYmVyIG9mIG5vbm92ZXJsYXBwaW5nIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGluIGBzZWxmYC4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBzbGljZSB0byBzZWFyY2guCiAgICAgKiBAcGFyYW0gbmVlZGxlIFRoZSB0ZXh0IHRvIHNlYXJjaCBmb3IgaW4gYHNlbGZgLgogICAgICogQHJldHVybiBUaGUgbnVtYmVyIG9mIG9jY3VycmVuY2VzIG9mIGBuZWVkbGVgIGZvdW5kIGluIGBzZWxmYC4KICAgICAqLwogICAgZnVuY3Rpb24gY291bnQoc2xpY2Ugc2VsZiwgc2xpY2UgbmVlZGxlKSBpbnRlcm5hbCByZXR1cm5zICh1aW50IGNvdW50KSB7CiAgICAgICAgdWludCBwdHIgPSBmaW5kUHRyKHNlbGYuX2xlbiwgc2VsZi5fcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CiAgICAgICAgd2hpbGUgKHB0ciA8PSBzZWxmLl9wdHIgKyBzZWxmLl9sZW4pIHsKICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgcHRyID0gZmluZFB0cihzZWxmLl9sZW4gLSAocHRyIC0gc2VsZi5fcHRyKSwgcHRyLCBuZWVkbGUuX2xlbiwgbmVlZGxlLl9wdHIpICsgbmVlZGxlLl9sZW47CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQGRldiBSZXR1cm5zIFRydWUgaWYgYHNlbGZgIGNvbnRhaW5zIGBuZWVkbGVgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIHNsaWNlIHRvIHNlYXJjaC4KICAgICAqIEBwYXJhbSBuZWVkbGUgVGhlIHRleHQgdG8gc2VhcmNoIGZvciBpbiBgc2VsZmAuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYG5lZWRsZWAgaXMgZm91bmQgaW4gYHNlbGZgLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNvbnRhaW5zKHNsaWNlIHNlbGYsIHNsaWNlIG5lZWRsZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiByZmluZFB0cihzZWxmLl9sZW4sIHNlbGYuX3B0ciwgbmVlZGxlLl9sZW4sIG5lZWRsZS5fcHRyKSAhPSBzZWxmLl9wdHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBAZGV2IFJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGNvbmNhdGVuYXRpb24gb2YKICAgICAqICAgICAgYHNlbGZgIGFuZCBgb3RoZXJgLgogICAgICogQHBhcmFtIHNlbGYgVGhlIGZpcnN0IHNsaWNlIHRvIGNvbmNhdGVuYXRlLgogICAgICogQHBhcmFtIG90aGVyIFRoZSBzZWNvbmQgc2xpY2UgdG8gY29uY2F0ZW5hdGUuCiAgICAgKiBAcmV0dXJuIFRoZSBjb25jYXRlbmF0aW9uIG9mIHRoZSB0d28gc3RyaW5ncy4KICAgICAqLwogICAgZnVuY3Rpb24gY29uY2F0KHNsaWNlIHNlbGYsIHNsaWNlIG90aGVyKSBpbnRlcm5hbCByZXR1cm5zIChzdHJpbmcpIHsKICAgICAgICB2YXIgcmV0ID0gbmV3IHN0cmluZyhzZWxmLl9sZW4gKyBvdGhlci5fbGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQogICAgICAgIG1lbWNweShyZXRwdHIsIHNlbGYuX3B0ciwgc2VsZi5fbGVuKTsKICAgICAgICBtZW1jcHkocmV0cHRyICsgc2VsZi5fbGVuLCBvdGhlci5fcHRyLCBvdGhlci5fbGVuKTsKICAgICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIC8qKgogICAgICogQGRldiBKb2lucyBhbiBhcnJheSBvZiBzbGljZXMsIHVzaW5nIGBzZWxmYCBhcyBhIGRlbGltaXRlciwgcmV0dXJuaW5nIGEKICAgICAqICAgICAgbmV3bHkgYWxsb2NhdGVkIHN0cmluZy4KICAgICAqIEBwYXJhbSBzZWxmIFRoZSBkZWxpbWl0ZXIgdG8gdXNlLgogICAgICogQHBhcmFtIHBhcnRzIEEgbGlzdCBvZiBzbGljZXMgdG8gam9pbi4KICAgICAqIEByZXR1cm4gQSBuZXdseSBhbGxvY2F0ZWQgc3RyaW5nIGNvbnRhaW5pbmcgYWxsIHRoZSBzbGljZXMgaW4gYHBhcnRzYCwKICAgICAqICAgICAgICAgam9pbmVkIHdpdGggYHNlbGZgLgogICAgICovCiAgICBmdW5jdGlvbiBqb2luKHNsaWNlIHNlbGYsIHNsaWNlW10gcGFydHMpIGludGVybmFsIHJldHVybnMgKHN0cmluZykgewogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT0gMCkKICAgICAgICAgICAgcmV0dXJuICIiOwoKICAgICAgICB1aW50IGxlbiA9IHNlbGYuX2xlbiAqIChwYXJ0cy5sZW5ndGggLSAxKTsKICAgICAgICBmb3IodWludCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBsZW4gKz0gcGFydHNbaV0uX2xlbjsKCiAgICAgICAgdmFyIHJldCA9IG5ldyBzdHJpbmcobGVuKTsKICAgICAgICB1aW50IHJldHB0cjsKICAgICAgICBhc3NlbWJseSB7IHJldHB0ciA6PSBhZGQocmV0LCAzMikgfQoKICAgICAgICBmb3IoaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtZW1jcHkocmV0cHRyLCBwYXJ0c1tpXS5fcHRyLCBwYXJ0c1tpXS5fbGVuKTsKICAgICAgICAgICAgcmV0cHRyICs9IHBhcnRzW2ldLl9sZW47CiAgICAgICAgICAgIGlmIChpIDwgcGFydHMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgbWVtY3B5KHJldHB0ciwgc2VsZi5fcHRyLCBzZWxmLl9sZW4pOwogICAgICAgICAgICAgICAgcmV0cHRyICs9IHNlbGYuX2xlbjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH0KfQoKCmNvbnRyYWN0IG1vcnRhbCB7CglhZGRyZXNzIG93bmVyOwoKCWZ1bmN0aW9uIG1vcnRhbCgpIHsKCQlvd25lciA9IG1zZy5zZW5kZXI7Cgl9CgoJZnVuY3Rpb24ga2lsbCgpIGludGVybmFsIHsKCQlzdWljaWRlKG93bmVyKTsKCX0KfQoKY29udHJhY3QgUHJheTRQcmV5IGlzIG1vcnRhbCwgdXNpbmdPcmFjbGl6ZSB7Cgl1c2luZyBzdHJpbmdzCglmb3IgKiA7CgoJc3RydWN0IEFuaW1hbCB7CgkJdWludDggYW5pbWFsVHlwZTsKCQl1aW50MTI4IHZhbHVlOwoJCWFkZHJlc3Mgb3duZXI7Cgl9CgoJLyoqIGFycmF5IGhvbGRpbmcgaWRzIG9mIHRoZSBjdXJyZXQgYW5pbWFscyovCgl1aW50MzJbXSBwdWJsaWMgaWRzOwoJLyoqIHRoZSBpZCB0byBiZSBnaXZlbiB0byB0aGUgbmV0IGFuaW1hbCAqKi8KCXVpbnQzMiBwdWJsaWMgbmV4dElkOwoJLyoqIHRoZSBpZCBvZiB0aGUgb2xkZXN0IGFuaW1hbCAqLwoJdWludDMyIHB1YmxpYyBvbGRlc3Q7CgkvKiogdGhlIGFuaW1hbCBiZWxvbmdpbmcgdG8gYSBnaXZlbiBpZCAqLwoJbWFwcGluZyh1aW50MzIgPT4gQW5pbWFsKSBhbmltYWxzOwoJLyoqIHRoZSBjb3N0IG9mIGVhY2ggYW5pbWFsIHR5cGUgKi8KCXVpbnQxMjhbXSBwdWJsaWMgY29zdHM7CgkvKiogdGhlIHZhbHVlIG9mIGVhY2ggYW5pbWFsIHR5cGUgKGNvc3QgLSBmZWUpLCBzbyBpdCdzIG5vdCBuZWNlc3NhcnkgdG8gY29tcHV0ZSBpdCBlYWNoIHRpbWUqLwoJdWludDEyOFtdIHB1YmxpYyB2YWx1ZXM7CgkvKiogdGhlIGZlZSB0byBiZSBwYWlkIGVhY2ggdGltZSBhbiBhbmltYWwgaXMgYm91Z2h0IGluIHBlcmNlbnQqLwoJdWludDggIGZlZTsKCgkvKiogdG90YWwgbnVtYmVyIG9mIGFuaW1hbHMgaW4gdGhlIGdhbWUgCgkoIT1zdW0gb2YgdGhlIGxlbmd0aHMgb2YgdGhlIHByZXkgYW5pbWFscyBhcnJheXMsIHNpbmNlIHRob3NlIGFycmF5cyBjb250YWluIGhvbGVzKSAqLwoJdWludDE2IHB1YmxpYyBudW1BbmltYWxzOwoJLyoqIFRoZSBtYXhpbXVtIG9mIGFuaW1hbHMgYWxsb3dlZCBpbiB0aGUgZ2FtZSAqLwoJdWludDE2IHB1YmxpYyBtYXhBbmltYWxzOwoJLyoqIG51bWJlciBvZiBhbmltYWxzIHBlciB0eXBlICovCgltYXBwaW5nKHVpbnQ4ID0+IHVpbnQxNikgcHVibGljIG51bUFuaW1hbHNYVHlwZTsKCgoJLyoqIHRoZSBxdWVyeSBzdHJpbmcgZ2V0dGluZyB0aGUgcmFuZG9tIG51bWJlcnMgZnJvbSBvcmFjbGl6ZSoqLwoJc3RyaW5nICByYW5kb21RdWVyeTsKCS8qKiB0aGUgdHlwZSBvZiB0aGUgb3JhY2xpemUgcXVlcnkqKi8KCXN0cmluZyAgcXVlcnlUeXBlOwoJLyoqIHRoZSB0aW1lc3RhbXAgb2YgdGhlIG5leHQgYXR0YWNrICoqLwoJdWludCBwdWJsaWMgbmV4dEF0dGFja1RpbWVzdGFtcDsKCS8qKiBnYXMgcHJvdmlkZWQgZm9yIG9yYWNsaXplIGNhbGxiYWNrIChhdHRhY2spKiovCgl1aW50MzIgcHVibGljIG9yYWNsaXplR2FzOwoJLyoqIHRoZSBpZCBvZiB0aGUgbmV4dCBvcmFjbGl6ZSBjYWxsYmFjayovCglieXRlczMyIG5leHRBdHRhY2tJZDsKCgoJLyoqIGlzIGZpcmVkIHdoZW4gbmV3IGFuaW1hbHMgYXJlIHB1cmNoYXNlZCAod2hvIGJvdWdodCBob3cgbWFueSBhbmltYWxzIG9mIHdoaWNoIHR5cGU/KSAqLwoJZXZlbnQgbmV3UHVyY2hhc2UoYWRkcmVzcyBwbGF5ZXIsIHVpbnQ4IGFuaW1hbFR5cGUsIHVpbnQ4IGFtb3VudCwgdWludDMyIHN0YXJ0SWQpOwoJLyoqIGlzIGZpcmVkIHdoZW4gYSBwbGF5ZXIgbGVhdmVzIHRoZSBnYW1lICovCglldmVudCBuZXdFeGl0KGFkZHJlc3MgcGxheWVyLCB1aW50MjU2IHRvdGFsQmFsYW5jZSk7CgkvKiogaXMgZmlyZWQgd2hlbiBhbiBhdHRhY2sgb2NjdXJlcyovCglldmVudCBuZXdBdHRhY2sodWludDMyW10ga2lsbGVkQW5pbWFscyk7CgoKCS8qKiBleHBlY3RlZCBwYXJhbWV0ZXJzOiB0aGUgY29zdHMgcGVyIGFuaW1hbCB0eXBlIGFuZCB0aGUgZ2FtZSBmZWUgaW4gcGVyY2VudCAKCSAqICAgYXNzdW1lcyB0aGF0IHRoZSBjaGVhcGVzdCBhbmltYWwgaXMgc3RvcmVkIGluIFswXQoJICovCglmdW5jdGlvbiBQcmF5NFByZXkoKSB7CgkJY29zdHMgPSBbMTAwMDAwMDAwMDAwMDAwMDAwLDIwMDAwMDAwMDAwMDAwMDAwMCw1MDAwMDAwMDAwMDAwMDAwMDAsMTAwMDAwMDAwMDAwMDAwMDAwMCw1MDAwMDAwMDAwMDAwMDAwMDAwXTsKCQlmZWUgPSA1OwoJCWZvciAodWludDggaSA9IDA7IGkgPCBjb3N0cy5sZW5ndGg7IGkrKykgewoJCQl2YWx1ZXMucHVzaChjb3N0c1tpXSAtIGNvc3RzW2ldIC8gMTAwICogZmVlKTsKCQl9CgkJbWF4QW5pbWFscyA9IDMwMDsKCQkvKnJhbmRvbVF1ZXJ5ID0gImh0dHBzOi8vd3d3LnJhbmRvbS5vcmcvaW50ZWdlcnMvP251bT0xMCZtaW49MCZtYXg9MTAwMDAmY29sPTEmYmFzZT0xMCZmb3JtYXQ9cGxhaW4mcm5kPW5ldyI7CgkJcXVlcnlUeXBlID0gIlVSTCI7Ki8KCQlyYW5kb21RdWVyeSA9ICIxMCByYW5kb20gbnVtYmVycyBiZXR3ZWVuIDEgYW5kIDEwMDAiOwoJCXF1ZXJ5VHlwZSA9ICJXb2xmcmFtQWxwaGEiOwoJCW9yYWNsaXplR2FzID0gNDAwMDAwOwoJCW5leHRJZCA9IDE7CgkJb2xkZXN0ID0gMTsKCX0KCgkvKiogVGhlIGZhbGxiYWNrIGZ1bmN0aW9uIHJ1bnMgd2hlbmV2ZXIgc29tZW9uZSBzZW5kcyBldGhlcgoJICAgRGVwZW5kaW5nIG9mIHRoZSB2YWx1ZSBvZiB0aGUgdHJhbnNhY3Rpb24gdGhlIHNlbmRlciBpcyBlaXRoZXIgZ3JhbnRlZCBhIHByZXkgb3IgCgkgICB0aGUgdHJhbnNhY3Rpb24gaXMgZGlzY2FyZGVkIGFuZCBubyBldGhlciBhY2NlcHRlZAoJICAgSW4gdGhlIGZpcnN0IGNhc2UgZmVlcyBoYXZlIHRvIGJlIHBhaWQqLwoJZnVuY3Rpb24oKSBwYXlhYmxlIHsKCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgY29zdHMubGVuZ3RoOyBpKyspCgkJCWlmIChtc2cudmFsdWUgPT0gY29zdHNbaV0pCgkJCQlhZGRBbmltYWxzKGkpOwoKCQlpZiAobXNnLnZhbHVlID09IDEwMDAwMDAwMDAwMDAwMDApCgkJCWV4aXQoKTsKCQllbHNlCgkJCXRocm93OwoKCX0KCgkvKiogYnV5IGFuaW1hbHMgb2YgYSBnaXZlbiB0eXBlIAoJICogIGFzIG1hbnkgYW5pbWFscyBhcyBwb3NzaWJsZSBhcmUgYm91Z2h0IHdpdGggbXNnLnZhbHVlCgkgKi8KCWZ1bmN0aW9uIGFkZEFuaW1hbHModWludDggYW5pbWFsVHlwZSkgcGF5YWJsZSB7CgkJdWludDggYW1vdW50ID0gdWludDgobXNnLnZhbHVlIC8gY29zdHNbYW5pbWFsVHlwZV0pOwoJCWlmIChhbmltYWxUeXBlID49IGNvc3RzLmxlbmd0aCB8fCBtc2cudmFsdWUgPCBjb3N0c1thbmltYWxUeXBlXSB8fCAgbnVtQW5pbWFscyArIGFtb3VudCA+PSBtYXhBbmltYWxzKSB0aHJvdzsKCQkvL2lmIHR5cGUgZXhpc3RzLCBlbm91Z2ggZXRoZXIgd2FzIHRyYW5zZmVycmVkIGFuZCB0aGVyZSBhcmUgbGVzcyB0aGFuIG1heEFuaW1hbHMgYW5pbWFscyBpbiB0aGUgZ2FtZQoJCWZvciAodWludDggaiA9IDA7IGogPCBhbW91bnQ7IGorKykgewoJCQlhZGRBbmltYWwoYW5pbWFsVHlwZSk7CgkJfQoJCW51bUFuaW1hbHNYVHlwZVthbmltYWxUeXBlXSArPSBhbW91bnQ7CgkJbmV3UHVyY2hhc2UobXNnLnNlbmRlciwgYW5pbWFsVHlwZSwgYW1vdW50LCBuZXh0SWQtYW1vdW50KTsKCX0KCgkvKioKCSAqICBhZGRzIGEgc2luZ2xlIGFuaW1hbCBvZiB0aGUgZ2l2ZW4gdHlwZQoJICovCglmdW5jdGlvbiBhZGRBbmltYWwodWludDggYW5pbWFsVHlwZSkgaW50ZXJuYWwgewoJCWlmIChudW1BbmltYWxzIDwgaWRzLmxlbmd0aCkKCQkJaWRzW251bUFuaW1hbHNdID0gbmV4dElkOwoJCWVsc2UKCQkJaWRzLnB1c2gobmV4dElkKTsKCQlhbmltYWxzW25leHRJZF0gPSBBbmltYWwoYW5pbWFsVHlwZSwgdmFsdWVzW2FuaW1hbFR5cGVdLCBtc2cuc2VuZGVyKTsKCQluZXh0SWQrKzsKCQludW1BbmltYWxzKys7Cgl9CgoKCS8qKiBsZWF2ZSB0aGUgZ2FtZQoJICogcGF5cyBvdXQgdGhlIHNlbmRlcidzIHdpbkJhbGFuY2UgYW5kIHJlbW92ZXMgaGltIGFuZCBoaXMgYW5pbWFscyBmcm9tIHRoZSBnYW1lCgkgKiAqLwoJZnVuY3Rpb24gZXhpdCgpIHsKCQl1aW50IGJhbGFuY2UgPSBjbGVhblVwKG1zZy5zZW5kZXIpOyAvL2RlbGV0ZSB0aGUgYW5pbWFscwoJCW5ld0V4aXQobXNnLnNlbmRlciwgYmFsYW5jZSk7IC8vZmlyZSB0aGUgZXZlbnQgdG8gbm90aWZ5IHRoZSBjbGllbnQKCQlpZiAoIW1zZy5zZW5kZXIuc2VuZChiYWxhbmNlKSkgdGhyb3c7Cgl9CgoJLyoqCgkgKiBEZWxldGVzIHRoZSBhbmltYWxzIG9mIGEgZ2l2ZW4gcGxheWVyCgkgKiAqLwoJZnVuY3Rpb24gY2xlYW5VcChhZGRyZXNzIHBsYXllckFkZHJlc3MpIGludGVybmFsIHJldHVybnModWludCBwbGF5ZXJCYWxhbmNlKXsKCQl1aW50MzIgbGFzdElkOwoJCWZvciAodWludDE2IGkgPSAwOyBpIDwgbnVtQW5pbWFsczsgaSsrKSB7CgkJCWlmIChhbmltYWxzW2lkc1tpXV0ub3duZXIgPT0gcGxheWVyQWRkcmVzcykgewoJCQkJLy9maXJzdCBkZWxldGUgYWxsIGFuaW1hbHMgYXQgdGhlIGVuZCBvZiB0aGUgYXJyYXkKCQkJCXdoaWxlIChudW1BbmltYWxzID4gMCAmJiBhbmltYWxzW2lkc1tudW1BbmltYWxzIC0gMV1dLm93bmVyID09IHBsYXllckFkZHJlc3MpIHsKCQkJCQludW1BbmltYWxzLS07CgkJCQkJbGFzdElkID0gaWRzW251bUFuaW1hbHNdOwoJCQkJCW51bUFuaW1hbHNYVHlwZVthbmltYWxzW2xhc3RJZF0uYW5pbWFsVHlwZV0tLTsKCQkJCQlwbGF5ZXJCYWxhbmNlKz1hbmltYWxzW2xhc3RJZF0udmFsdWU7CgkJCQkJZGVsZXRlIGFuaW1hbHNbbGFzdElkXTsKCQkJCX0KCQkJCS8vaWYgdGhlIGxhc3QgYW5pbWFsIGRvZXMgbm90IGJlbG9uZyB0byB0aGUgcGxheWVyLCByZXBsYWNlIHRoZSBwbGF5ZXJzIGFuaW1hbCBieSB0aGlzIGxhc3Qgb25lCgkJCQlpZiAobnVtQW5pbWFscyA+IGkgKyAxKSB7CgkJCQkgICAgcGxheWVyQmFsYW5jZSs9YW5pbWFsc1tpZHNbaV1dLnZhbHVlOwoJCQkJCXJlcGxhY2VBbmltYWwoaSk7CgkJCQl9CgkJCX0KCQl9Cgl9CgoKCS8qKgoJICogUmVwbGFjZXMgdGhlIGFuaW1hbCB3aXRoIHRoZSBnaXZlbiBpZCB3aXRoIHRoZSBsYXN0IGFuaW1hbCBpbiB0aGUgYXJyYXkKCSAqICovCglmdW5jdGlvbiByZXBsYWNlQW5pbWFsKHVpbnQxNiBpbmRleCkgaW50ZXJuYWwgewoJCW51bUFuaW1hbHNYVHlwZVthbmltYWxzW2lkc1tpbmRleF1dLmFuaW1hbFR5cGVdLS07CgkJbnVtQW5pbWFscy0tOwoJCXVpbnQzMiBsYXN0SWQgPSBpZHNbbnVtQW5pbWFsc107CgkJYW5pbWFsc1tpZHNbaW5kZXhdXSA9IGFuaW1hbHNbbGFzdElkXTsKCQlpZHNbaW5kZXhdID0gbGFzdElkOwoJCWRlbGV0ZSBpZHNbbnVtQW5pbWFsc107Cgl9CgoKCS8qKgoJICogbWFudWFsbHkgdHJpZ2dlcnMgdGhlIGF0dGFjay4gY2Fubm90IGJlIGNhbGxlZCBhZnRlcndhcmRzLCBleGNlcHQKCSAqIGJ5IHRoZSBvd25lciBpZiBhbmQgb25seSBpZiB0aGUgYXR0YWNrIHdhc24ndCBsYXVuY2hlZCBhcyBzdXBwb3NlZCwgc2lnbmlmeWluZwoJICogYW4gZXJyb3Igb2N1cnJlZCBkdXJpbmcgdGhlIGxhc3QgaW52b2NhdGlvbiBvZiBvcmFjbGl6ZSwgb3IgdGhlcmUgd2Fzbid0IGVub3VnaCBldGhlciB0byBwYXkgdGhlIGdhcwoJICogKi8KCWZ1bmN0aW9uIHRyaWdnZXJBdHRhY2tNYW51YWxseSh1aW50MzIgaW5zZWNvbmRzKSB7CgkJaWYgKCEobXNnLnNlbmRlciA9PSBvd25lciAmJiBuZXh0QXR0YWNrVGltZXN0YW1wIDwgbm93ICsgMzAwKSkgdGhyb3c7CgkJdHJpZ2dlckF0dGFjayhpbnNlY29uZHMsIChvcmFjbGl6ZUdhcyArIDEwMDAwICogbnVtQW5pbWFscykpOwoJfQoKCS8qKgoJICogc2VuZHMgYSBxdWVyeSB0byBvcmFjbGl6ZSBpbiBvcmRlciB0byBnZXQgcmFuZG9tIG51bWJlcnMgaW4gJ2luc2Vjb25kcycgc2Vjb25kcwoJICovCglmdW5jdGlvbiB0cmlnZ2VyQXR0YWNrKHVpbnQzMiBpbnNlY29uZHMsIHVpbnQxMjggZ2FzQW1vdW50KSBpbnRlcm5hbCB7CgkJbmV4dEF0dGFja1RpbWVzdGFtcCA9IG5vdyArIGluc2Vjb25kczsKCQluZXh0QXR0YWNrSWQgPSBvcmFjbGl6ZV9xdWVyeShuZXh0QXR0YWNrVGltZXN0YW1wLCBxdWVyeVR5cGUsIHJhbmRvbVF1ZXJ5LCBnYXNBbW91bnQgKTsKCX0KCgkvKioKCSAqIFRoZSBhY3R1YWwgcHJlZGF0b3IgYXR0YWNrLgoJICogVGhlIHByZWRhdG9yIGtpbGxzIHVwIHRvIDEwIGFuaW1hbHMsIGJ1dCBpbiBjYXNlIHRoZXJlIGFyZSBsZXNzIHRoYW4gMTAwIGFuaW1hbHMgaW4gdGhlIGdhbWUgdXAgdG8gMTAlIGdldCBlYXRlbi4KCSAqICovCglmdW5jdGlvbiBfX2NhbGxiYWNrKGJ5dGVzMzIgbXlpZCwgc3RyaW5nIHJlc3VsdCkgewoJCWlmIChtc2cuc2VuZGVyICE9IG9yYWNsaXplX2NiQWRkcmVzcygpIHx8IG15aWQgIT0gbmV4dEF0dGFja0lkKSB0aHJvdzsgLy8ganVzdCB0byBiZSBzdXJlIHRoZSBjYWxsaW5nIGFkZHJlc3MgaXMgdGhlIE9yYWNsaXplIGF1dGhvcml6ZWQgb25lIGFuZCB0aGUgY2FsbGJhY2sgaXMgdGhlIGV4cGVjdGVkIG9uZSAgIAoJCXVpbnQxMjggcG90OwoJCXVpbnQxNiByYW5kb207CgkJdWludDE2IGhvd21hbnkgPSBudW1BbmltYWxzIDwgMTAwID8gKG51bUFuaW1hbHMgPCAxMCA/IDEgOiBudW1BbmltYWxzIC8gMTApIDogMTA7IC8vZG8gbm90IGtpbGwgbW9yZSB0aGFuIDEwJSwgYnV0IGF0IGxlYXN0IG9uZQoJCXVpbnQxNltdIG1lbW9yeSByYW5kb21OdW1iZXJzID0gZ2V0TnVtYmVyc0Zyb21TdHJpbmcocmVzdWx0LCAiLCIsIGhvd21hbnkpOwoJCXVpbnQzMltdIG1lbW9yeSBraWxsZWRBbmltYWxzID0gbmV3IHVpbnQzMltdKGhvd21hbnkpOwoJCWZvciAodWludDggaSA9IDA7IGkgPCBob3dtYW55OyBpKyspIHsKCQkJcmFuZG9tID0gbWFwVG9OZXdSYW5nZShyYW5kb21OdW1iZXJzW2ldLCBudW1BbmltYWxzKTsKCQkJa2lsbGVkQW5pbWFsc1tpXSA9IGlkc1tyYW5kb21dOwoJCQlwb3QgKz0ga2lsbEFuaW1hbChyYW5kb20pOwoJCX0KCQl1aW50MTI4IG5lZWRlZEdhcyA9IG9yYWNsaXplR2FzICsgMTAwMDAqbnVtQW5pbWFsczsKCQl1aW50MTI4IGdhc0Nvc3QgPSB1aW50MTI4KG5lZWRlZEdhcyAqIHR4Lmdhc3ByaWNlKTsKCQlpZiAocG90ID4gZ2FzQ29zdCkKCQkJZGlzdHJpYnV0ZSh1aW50MTI4KHBvdCAtIGdhc0Nvc3QpKTsgLy9kaXN0cmlidXRlIHRoZSBwb3QgbWludXMgdGhlIG9yYWNsaXplIGdhcyBjb3N0cwoJCXRyaWdnZXJBdHRhY2sodGltZVRpbGxOZXh0QXR0YWNrKCksIG5lZWRlZEdhcyk7CgkJbmV3QXR0YWNrKGtpbGxlZEFuaW1hbHMpOwoJfQoKCS8qKgoJICogdGhlIGZyZXF1ZW5jeSBvZiB0aGUgc2hhcmsgYXR0YWNrcyBkZXBlbmRzIG9uIHRoZSBudW1iZXIgb2YgYW5pbWFscyBpbiB0aGUgZ2FtZS4gCgkgKiBtYW55IGFuaW1hbHMgLT4gbWFueSBzaGFyayBhdHRhY2tzCgkgKiBhdCBsZWFzdCBvbmUgYXR0YWNrIGluIDI0IGhvdXJzCgkgKiAqLwoJZnVuY3Rpb24gdGltZVRpbGxOZXh0QXR0YWNrKCkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50MzIpIHsKCQlyZXR1cm4gKDg2NDAwIC8gKDEgKyBudW1BbmltYWxzIC8gMTAwKSk7Cgl9CgoKCS8qKgoJICoga2lsbHMgdGhlIGFuaW1hbCBvZiB0aGUgZ2l2ZW4gdHlwZSBhdCB0aGUgZ2l2ZW4gaW5kZXguIAoJICogKi8KCWZ1bmN0aW9uIGtpbGxBbmltYWwodWludDE2IGluZGV4KSBpbnRlcm5hbCByZXR1cm5zKHVpbnQxMjggYW5pbWFsVmFsdWUpIHsKCQlhbmltYWxWYWx1ZSA9IGFuaW1hbHNbaWRzW2luZGV4XV0udmFsdWU7CgkJcmVwbGFjZUFuaW1hbChpbmRleCk7CgkJaWYgKGlkc1tpbmRleF0gPT0gb2xkZXN0KQoJCQlvbGRlc3QgPSAwOwoJfQoKCS8qKgoJICogZmluZHMgdGhlIG9sZGVzdCBhbmltYWwKCSAqICovCglmdW5jdGlvbiBmaW5kT2xkZXN0KCkgaW50ZXJuYWwgcmV0dXJucyh1aW50MTI4IGFuaW1hbFZhbHVlKSB7CgkJb2xkZXN0ID0gaWRzWzBdOwoJCWZvciAodWludDE2IGkgPSAxOyBpIDwgbnVtQW5pbWFsczsgaSsrKXsKCQkJaWYoaWRzW2ldIDwgb2xkZXN0KS8vdGhlIG9sZGVzdCBhbmltYWwgaGFzIHRoZSBsb3dlc3QgaWQKCQkJCW9sZGVzdCA9IGlkc1tpXTsKCQl9Cgl9CgoKCS8qKiBkaXN0cmlidXRlcyB0aGUgZ2l2ZW4gYW1vdW50IGFtb25nIHRoZSBzdXJ2aXZpbmcgZmlzaGVzKi8KCWZ1bmN0aW9uIGRpc3RyaWJ1dGUodWludDEyOCBhbW91bnQpIGludGVybmFsIHsKCQkvL3BheSAxMCUgdG8gdGhlIG9sZGVzdCBmaXNoCgkJaWYgKG9sZGVzdCA9PSAwKQoJCQlmaW5kT2xkZXN0KCk7CgkJYW5pbWFsc1tvbGRlc3RdLnZhbHVlICs9IGFtb3VudCAvIDEwOwoJCWFtb3VudCA9IGFtb3VudCAvIDEwICogOTsKCQkvL2Rpc3RyaWJ1dGUgdGhlIHJlc3QgYWNjb3JkaW5nIHRvIHRoZWlyIHR5cGUKCQl1aW50MTI4IHZhbHVlU3VtOwoJCXVpbnQxMjhbXSBtZW1vcnkgc2hhcmVzID0gbmV3IHVpbnQxMjhbXSh2YWx1ZXMubGVuZ3RoKTsKCQlmb3IgKHVpbnQ4IHYgPSAwOyB2IDwgdmFsdWVzLmxlbmd0aDsgdisrKSB7CgkJCWlmIChudW1BbmltYWxzWFR5cGVbdl0gPiAwKSB2YWx1ZVN1bSArPSB2YWx1ZXNbdl07CgkJfQoJCWZvciAodWludDggbSA9IDA7IG0gPCB2YWx1ZXMubGVuZ3RoOyBtKyspIHsKCQkgICAgaWYobnVtQW5pbWFsc1hUeXBlW21dID4gMCkKCQkJICAgIHNoYXJlc1ttXSA9IGFtb3VudCAvIHZhbHVlU3VtICogdmFsdWVzW21dIC8gbnVtQW5pbWFsc1hUeXBlW21dOwoJCX0KCQkKCgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBudW1BbmltYWxzOyBpKyspIHsKCQkJYW5pbWFsc1tpZHNbaV1dLnZhbHVlICs9IHNoYXJlc1thbmltYWxzW2lkc1tpXV0uYW5pbWFsVHlwZV07CgkJfQoKCX0KCgkvKioKCSAqIGFsbG93cyB0aGUgb3duZXIgdG8gY29sbGVjdCB0aGUgYWNjdW11bGF0ZWQgZmVlcwoJICogc2VuZHMgdGhlIGdpdmVuIGFtb3VudCB0byB0aGUgb3duZXIncyBhZGRyZXNzIGlmIHRoZSBhbW91bnQgZG9lcyBub3QgZXhjZWVkIHRoZQoJICogZmVlcyAoY2Fubm90IHRvdWNoIHRoZSBwbGF5ZXJzJyBiYWxhbmNlcykgbWludXMgMTAwIGZpbm5leSAoZW5zdXJlIHRoYXQgb3JhY2xpemUgZmVlcyBjYW4gYmUgcGFpZCkKCSAqICovCglmdW5jdGlvbiBjb2xsZWN0RmVlcyh1aW50MTI4IGFtb3VudCkgewoJCWlmICghKG1zZy5zZW5kZXIgPT0gb3duZXIpKSB0aHJvdzsKCQl1aW50IGNvbGxlY3RlZEZlZXMgPSBnZXRGZWVzKCk7CgkJaWYgKGFtb3VudCArIDEwMCBmaW5uZXkgPCBjb2xsZWN0ZWRGZWVzKSB7CgkJCWlmICghb3duZXIuc2VuZChhbW91bnQpKSB0aHJvdzsKCQl9Cgl9CgoJLyoqCgkgKiBwYXlzIG91dCB0aGUgcGxheWVycyBhbmQga2lsbHMgdGhlIGdhbWUuCgkgKiAqLwoJZnVuY3Rpb24gc3RvcCgpIHsKCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7CgkJZm9yICh1aW50MTYgaSA9IDA7IGkgPCBudW1BbmltYWxzOyBpKyspIHsKCQkJYW5pbWFsc1tpZHNbaV1dLm93bmVyLnNlbmQoYW5pbWFsc1tpZHNbaV1dLnZhbHVlKTsKCQl9CgkJa2lsbCgpOwoJfQoKCS8qKgoJICogYWRkcyBhIG5ldyBhbmltYWwgdHlwZSB0byB0aGUgZ2FtZQoJICogbWF4LiBudW1iZXIgb2YgYW5pbWFsIHR5cGVzOiAxMDAKCSAqIHRoZSBjb3N0IG1heSBub3QgYmUgbG93ZXIgdGhhbiBjb3N0c1swXQoJICogKi8KCWZ1bmN0aW9uIGFkZEFuaW1hbFR5cGUodWludDEyOCBjb3N0KSB7CgkJaWYgKCEobXNnLnNlbmRlciA9PSBvd25lcikpIHRocm93OwoJCWNvc3RzLnB1c2goY29zdCk7CgkJdmFsdWVzLnB1c2goY29zdCAvIDEwMCAqIGZlZSk7Cgl9CgoJZnVuY3Rpb24gc2VsbEFuaW1hbCh1aW50MzIgYW5pbWFsSWQpewogICAgICAgIGlmKG1zZy5zZW5kZXIhPWFuaW1hbHNbYW5pbWFsSWRdLm93bmVyKSB0aHJvdzsKICAgICAgICB1aW50MTI4IHZhbCA9IGFuaW1hbHNbYW5pbWFsSWRdLnZhbHVlOwogICAgICAgIHVpbnQxNiBhbmltYWxJbmRleDsKICAgICAgICBmb3IodWludDE2IGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgaWYoaWRzW2ldPT1hbmltYWxJZCl7CiAgICAgICAgICAgICAgICBhbmltYWxJbmRleCA9IGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXBsYWNlQW5pbWFsKGFuaW1hbEluZGV4KTsKICAgICAgICBpZighbXNnLnNlbmRlci5zZW5kKHZhbCkpIHRocm93OwogICAgfQoKCS8qKioqKioqKioqKioqKioqKiogR0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCglmdW5jdGlvbiBnZXRQbGF5ZXJCYWxhbmNlKGFkZHJlc3MgcGxheWVyQWRkcmVzcykgY29uc3RhbnQgcmV0dXJucyh1aW50MTI4IHBsYXllckJhbGFuY2UpIHsKCQlmb3IgKHVpbnQxNiBpID0gMDsgaSA8IG51bUFuaW1hbHM7IGkrKykgewoJCQlpZiAoYW5pbWFsc1tpZHNbaV1dLm93bmVyID09IHBsYXllckFkZHJlc3MpIHBsYXllckJhbGFuY2UgKz0gYW5pbWFsc1tpZHNbaV1dLnZhbHVlOwoJCX0KCX0KCQoJZnVuY3Rpb24gZ2V0QW5pbWFsKHVpbnQzMiBhbmltYWxJZCkgY29uc3RhbnQgcmV0dXJucyh1aW50OCwgdWludDEyOCwgYWRkcmVzcyl7CgkJcmV0dXJuIChhbmltYWxzW2FuaW1hbElkXS5hbmltYWxUeXBlLGFuaW1hbHNbYW5pbWFsSWRdLnZhbHVlLGFuaW1hbHNbYW5pbWFsSWRdLm93bmVyKTsKCX0KCQoJZnVuY3Rpb24gZ2V0MTBBbmltYWxzKHVpbnQxNiBzdGFydEluZGV4KSBjb25zdGFudCByZXR1cm5zKHVpbnQzMlsxMF0gYW5pbWFsSWRzLCB1aW50OFsxMF0gdHlwZXMsIHVpbnQxMjhbMTBdIHZhbHVlcywgYWRkcmVzc1sxMF0gb3duZXJzKSB7CgkJdWludDE2IGVuZEluZGV4PSBzdGFydEluZGV4KzEwID4gbnVtQW5pbWFscz8gbnVtQW5pbWFsczogc3RhcnRJbmRleCsxMDsKCQl1aW50OCBqID0gMDsKCQl1aW50MzIgaWQ7CgkJZm9yICh1aW50MTYgaSA9IHN0YXJ0SW5kZXg7IGkgPCBlbmRJbmRleDsgaSsrKXsKCQkJaWQ9aWRzW2ldOwoJCQlhbmltYWxJZHNbal0gPSBpZDsKCQkJdHlwZXNbal0gPSBhbmltYWxzW2lkXS5hbmltYWxUeXBlOwoJCQl2YWx1ZXNbal0gPSBhbmltYWxzW2lkXS52YWx1ZTsKCQkJb3duZXJzW2pdID0gYW5pbWFsc1tpZF0ub3duZXI7CgkJCWorKzsKCQl9CgkJCgl9CgkKCglmdW5jdGlvbiBnZXRGZWVzKCkgY29uc3RhbnQgcmV0dXJucyh1aW50KSB7CgkJdWludCByZXNlcnZlZCA9IDA7CgkJZm9yICh1aW50MTYgaiA9IDA7IGogPCBudW1BbmltYWxzOyBqKyspCgkJCXJlc2VydmVkICs9IGFuaW1hbHNbaWRzW2pdXS52YWx1ZTsKCQlyZXR1cm4gYWRkcmVzcyh0aGlzKS5iYWxhbmNlIC0gcmVzZXJ2ZWQ7Cgl9CgoKCS8qKioqKioqKioqKioqKioqKiogU0VUVEVSUyAqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCWZ1bmN0aW9uIHNldE9yYWNsaXplR2FzKHVpbnQzMiBuZXdHYXMpIHsKCQlpZiAoIShtc2cuc2VuZGVyID09IG93bmVyKSkgdGhyb3c7CgkJb3JhY2xpemVHYXMgPSBuZXdHYXM7Cgl9CgoJZnVuY3Rpb24gc2V0TWF4QW5pbWFscyh1aW50MTYgbnVtYmVyKSB7CgkJaWYgKCEobXNnLnNlbmRlciA9PSBvd25lcikpIHRocm93OwoJCW1heEFuaW1hbHMgPSBudW1iZXI7Cgl9CgoKCS8qKioqKioqKioqKioqIEhFTFBFUlMgKioqKioqKioqKioqKioqKi8KCgkvKioKCSAqIG1hcHMgYSBnaXZlbiBudW1iZXIgdG8gdGhlIG5ldyByYW5nZSAob2xkIHJhbmdlIDEwMDApCgkgKiAqLwoJZnVuY3Rpb24gbWFwVG9OZXdSYW5nZSh1aW50IG51bWJlciwgdWludCByYW5nZSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50MTYgcmFuZG9tTnVtYmVyKSB7CgkJcmV0dXJuIHVpbnQxNihudW1iZXIgKiByYW5nZSAvIDEwMDApOwoJfQoKCS8qKgoJICogY29udmVydHMgYSBzdHJpbmcgb2YgbnVtYmVycyBiZWluZyBzZXBhcmF0ZWQgYnkgYSBnaXZlbiBkZWxpbWl0ZXIgaW50byBhbiBhcnJheSBvZiBudW1iZXJzICgjaG93bWFueSkgCgkgKi8KCWZ1bmN0aW9uIGdldE51bWJlcnNGcm9tU3RyaW5nKHN0cmluZyBzLCBzdHJpbmcgZGVsaW1pdGVyLCB1aW50MTYgaG93bWFueSkgY29uc3RhbnQgaW50ZXJuYWwgcmV0dXJucyh1aW50MTZbXSBudW1iZXJzKSB7CgkJc3RyaW5ncy5zbGljZSBtZW1vcnkgbXlyZXN1bHQgPSBzLnRvU2xpY2UoKTsKCQlzdHJpbmdzLnNsaWNlIG1lbW9yeSBkZWxpbSA9IGRlbGltaXRlci50b1NsaWNlKCk7CgkJbnVtYmVycyA9IG5ldyB1aW50MTZbXShob3dtYW55KTsKCQlmb3IgKHVpbnQ4IGkgPSAwOyBpIDwgaG93bWFueTsgaSsrKSB7CgkJCW51bWJlcnNbaV0gPSB1aW50MTYocGFyc2VJbnQobXlyZXN1bHQuc3BsaXQoZGVsaW0pLnRvU3RyaW5nKCkpKTsKCQl9CgkJcmV0dXJuIG51bWJlcnM7Cgl9Cgp9'.
	

]
